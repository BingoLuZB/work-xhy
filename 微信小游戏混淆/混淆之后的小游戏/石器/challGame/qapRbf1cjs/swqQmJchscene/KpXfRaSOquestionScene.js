;"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _wenIOsErquestions=_interopRequireDefault(require("../orsfnpj1data/wenIOsErquestions"));var _kxrMwBNKindex=require("../X5gHYJsdutils/kxrMwBNKindex");var _XWmM6a3Obackground=_interopRequireDefault(require("../IRjSr6J6runtime/XWmM6a3Obackground"));var _WOklGuAdSprite=_interopRequireDefault(require("../QycaeVLxbase/WOklGuAdSprite"));var _JowmRIGiDataStore=_interopRequireDefault(require("../QycaeVLxbase/JowmRIGiDataStore"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _instanceof(a,b){if(b!=null&&typeof Symbol!=="undefined"&&b[Symbol.hasInstance]){return b[Symbol.hasInstance](a)}else{return a instanceof b}}function _classCallCheck(a,b){if(!_instanceof(a,b)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(a,b){for(var i=0;i<b.length;i++){var c=b[i];c.enumerable=c.enumerable||false;c.configurable=true;if("value"in c)c.writable=true;Object.defineProperty(a,c.key,c)}}function _createClass(a,b,c){if(b)_defineProperties(a.prototype,b);if(c)_defineProperties(a,c);return a}var screenWidth=window.innerWidth;var screenHeight=window.innerHeight;var ratio=750/screenWidth;var scale=750/screenWidth;var CHOICE_WIDTH=288;var CHOICE_HEIGHT=88;var QuestionPage=function(){function QuestionPage(a,b,c){_classCallCheck(this,QuestionPage);this.background=new _XWmM6a3Obackground.default(a,scale);this.question=b;this.index=c;this.ctx=a;this.selected=false;this.init(this.question);this.drawProgress();this.drawPic();this.drawTitle();this.drawChoice();this.addTouch()}_createClass(QuestionPage,[{key:"init",value:function init(a){this.img=a.pic;this.title=a.title;this.choices=a.choices;this.answer=a.answer}},{key:"drawProgress",value:function drawProgress(){var a=_WOklGuAdSprite.default.getImage('progress_bar');var b=new _WOklGuAdSprite.default(a,(750-a.width)/2,20,a.width,a.height);b.draw(this.ctx);var c=(this.index+1)/10;this.ctx.fillStyle='#fed443';this.ctx.fillRect(b.x+4,b.y+82,(b.width-8)*c,16);this.bar=b}},{key:"drawPic",value:function drawPic(){var a=this;var b=_WOklGuAdSprite.default.getImage('question_bg');this.offset=(750-b.width)/2;var c=new _WOklGuAdSprite.default(b,this.offset,20+this.bar.height+20,b.width,b.height);c.draw(this.ctx);this.bg=c;var d=new Image();d.src=this.img;d.onload=function(){a.centerImg(d,c.x+20,c.y+20,c.width-40,c.height-40);a.reDrawCanvas()}}},{key:"drawTitle",value:function drawTitle(){(0,_kxrMwBNKindex.drawText)(this.title,this.offset,this.bg.y+this.bg.height+20,750-2*this.bg.x,this.ctx,ratio)}},{key:"centerImg",value:function centerImg(a,x,y,b,c){var d=a.width;var e=a.height;if(d/e>1){e=b*(e/d);d=b;y=y+(c-e)/2}else{d=c*(d/e);e=c;x=x+(b-d)/2}this.ctx.drawImage(a,x,y,d,e)}},{key:"drawChoiceItem",value:function drawChoiceItem(a,b,c){this.ctx.globalCompositeOperation='source-over';var d=['A','B','C','D'];var e=_WOklGuAdSprite.default.getImage(b);var x=a%2===0?this.offset:750-CHOICE_WIDTH-this.offset;this.firstY=this.bg.y+this.bg.height+20*ratio+90;this.secondY=this.firstY+20*ratio;var y=a<2?this.firstY:this.secondY+CHOICE_HEIGHT;var f=new _WOklGuAdSprite.default(e,x,y,CHOICE_WIDTH,CHOICE_HEIGHT);f.draw(this.ctx);this.drawCircle(this.ctx,x+40,y+50,d[a]);this.ctx.fillStyle='#654e01';this.ctx.fillText(this.choices[a],x+80,y+50);if(b!='select_bg'){c&&c();return}if(!this.selectArea){console.log(f);this.selectArea={x:f.x/ratio,y:f.y/ratio,endX:screenWidth-this.offset/ratio,endY:this.firstY/ratio+f.height/ratio*2+20,width:f.width/ratio,height:f.height/ratio}}if(a===1){this.selectArea.rightX=screenWidth-f.width/ratio-this.offset/ratio}if(a===2){this.selectArea.bottomY=this.secondY+f.height/ratio}}},{key:"drawChoice",value:function drawChoice(a){this.ctx.font='24px Arial';for(var i=0;i<4;i++){this.drawChoiceItem(i,'select_bg')}}},{key:"drawCircle",value:function drawCircle(a,x,y,b,c){a.fillStyle='#ecb020';a.beginPath();a.arc(x,y,20,0,Math.PI*2,true);a.closePath();a.fill();a.save();a.fillStyle="#654e01";a.font='24px Arial';a.fillText(b,x-8,y)}},{key:"judgeAnswer",value:function judgeAnswer(x,y){var a=this;var b;var c=1000;if(x<=this.selectArea.x+this.selectArea.width){b=y<this.selectArea.y+this.selectArea.height?0:2}else if(x>this.selectArea.rightX){b=y<this.selectArea.y+this.selectArea.height?1:3}else{this.selected=false;return}console.log('select: '+b);if(b===this.answer){_JowmRIGiDataStore.default.getInstance().score+=10;this.drawChoiceItem(b,'select_right',this.reDrawCanvas)}else{this.drawChoiceItem(b,'select_error',this.reDrawCanvas);c+=800;setTimeout(function(){a.drawChoiceItem(a.answer,'right_choice',a.reDrawCanvas)},800)}setTimeout(function(){_JowmRIGiDataStore.default.getInstance().director.nextQuestionScene()},c)}},{key:"reDrawCanvas",value:function reDrawCanvas(){_JowmRIGiDataStore.default.getInstance().ctx.drawImage(_JowmRIGiDataStore.default.getInstance().offScreenCanvas,0,0,screenWidth,screenHeight)}},{key:"addTouch",value:function addTouch(){var a=this;var b=this;wx.offTouchStart();wx.onTouchStart(function(e){console.log(b.selectArea.endY);if(!a.selected&&e.touches[0].clientX>=b.selectArea.x&&e.touches[0].clientX<=b.selectArea.endX&&e.touches[0].clientY>=b.selectArea.y&&e.touches[0].clientY<=b.selectArea.endY){a.selected=true;b.judgeAnswer(e.touches[0].clientX,e.touches[0].clientY)}})}}]);return QuestionPage}();exports.default=QuestionPage;;