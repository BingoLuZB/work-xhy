var egret = window.egret;var BinaryData=function(){function o(){this.builderMap={},this.handlerMap={},this.ProtoBuf=dcodeIO.ProtoBuf}return o.prototype.registerProtocol=function(o){var e=this;if(!window.egret_quickgame){try{var l=this.ProtoBuf.loadProtoFile(o);if(!l)return console.log("load proto file failed: "+o),null;var t=o.split("/"),r=o;t&&t.length>0&&(r=t[t.length-1]);var n=r.split(".")[0];return this.builderMap[n]=l,console.log("load proto file ok: "+o),l}catch(a){console.log("exception: "+a.toString())}return null}try{this.ProtoBuf.loadProtoFile(o,function(l,t){if(l)return console.log("load proto file failed: "+o),null;var r=o.split("/"),n=o;r&&r.length>0&&(n=r[r.length-1]);var a=n.split(".")[0];e.builderMap[a]=t,console.log("load proto file ok: "+o)})}catch(a){console.log("exception: "+a.toString())}},o.prototype.registerHandler=function(o,e,l,t){var r=this.handlerMap[o];return r?(console.log("protocol handler is exist: "+o+", message: "+e),!1):(this.handlerMap[o]={handler:l,caller:t,messageName:e},!0)},o.prototype.handlerProtocol=function(o){try{var e=this.handlerMap[o.getType()];if(!e)return console.log("protocol handler is null: "+o.getType()),!1;var l=this.getBuilderClass(e.messageName);if(!l)return console.log("protocol class is null: "+o.getType()),!1;var t=null;try{t=l.decode(o.getMsgBuffer())}catch(r){console.log("protocol decode failed: "+o.getType()),console.error(r)}if(t){HawkProtocolManager.onConsoleLog&&console.log("recv protocol: "+o.getType()+", msg: "+t.toString());var n=e.handler,a=e.caller;return n?(a?n.call(a,o.getType(),t):n(o.getType(),t),!0):(console.log("protocol handler is null: "+o.getType()),!1)}console.log("protocol decode failed: "+o.getType())}catch(r){console.log("exception: "+r.toString()),console.error(r)}return!1},o.prototype.newBuilder=function(o){var e=this.getBuilderClass(o);return null!=e?new e:null},o.prototype.getBuilderClass=function(o){var e=o.split("."),l=this.builderMap[e[0]];return null!=l?l.build(e[1]):null},o.prototype.calcCrc=function(o){var e=0;if(o){for(var l=o.offset,t=o.offset;t<o.limit;t++){var r=o.readByte();e^=0==(1&t)?e<<7^255&r^e>>>3:~(e<<11^255&r^e>>>5)}o.offset=l}return e},o}();window.BinaryData=BinaryData;