var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};return function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}}(),__spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,i=arguments.length;e<i;e++)t+=arguments[e].length;var n=Array(t),s=0;for(e=0;e<i;e++)for(var o=arguments[e],a=0,r=o.length;a<r;a++,s++)n[s]=o[a];return n},define=window.definejs,require=window.requirejs;define("src/g/Effects/GameUIEffectCtrl",["require","exports","../../core/E","../../enum/EventName","../../utils/ItemUtils","../../manager/LayerManager","../../utils/SoundUtils"],function(t,e,i,n,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this.baseUIEffectsPath="dynamic2/uieffect",this.init()}return t.prototype.init=function(){i.E.ins.on(n.EventName.TASK_COMPLETE_EFFECT_POP,this,this.showEffectOnce,[7]),i.E.ins.on(n.EventName.EFFECT_POP_ONCE,this,this.onPopEffectOnce)},t.prototype.onPopEffectOnce=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i=0),t&&this.showEffectOnce(t,e,i)},t.prototype.showEffectOnce=function(t,e,i){var n=this;void 0===e&&(e=1),void 0===i&&(i=0);var s=r.ItemUtils.getUIEffectsVoById(t);if(s.soundId&&h.SoundUtils.getInstance().playSoundById(s.soundId),s){this._taskAni&&(this._taskAni.removeSelf(),this._taskAni.clear(),this._taskAni=null);var o=new Laya.Animation;o.autoPlay=!0,o.interval=s.interval,o.width=s.width,o.height=s.height,this._taskAni=o;var a=(s.urlPath?s.urlPath:this.baseUIEffectsPath)+"/"+s.name+".json";this._taskAni.source=a,this._taskAni.x=(Laya.stage.width-this._taskAni.width*e)/2,this._taskAni.y=(Laya.stage.height-this._taskAni.height*e)/2+i,this._taskAni.scale(e,e),l.LayerManager.addAlertLayer(this._taskAni),this._taskAni.on(Laya.Event.COMPLETE,this,function(t,e){t.removeSelf(),t.clear(),n._taskAni==t&&(n._taskAni=null)},[o])}},t}();e.GameUIEffectCtrl=s}),define("src/g/Effects/PressTutorialEffectProxy",["require","exports","../../component/UDEffect"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){this.ef=new i.UDEffect,this._state=0,this.ui=t}return t.prototype.run=function(){this.running||(this.running=!0,this.setState(0),this.ef.effect(this.ui.box_prompt,20,300))},t.prototype.stop=function(){this.running&&(this.running=!1,Laya.Tween.clearAll(this.ui),Laya.timer.clear(this,this.loopEffect),this.ef.clear())},t.prototype.setState=function(t){this.running&&(this._state=t,this.ui&&(Laya.Tween.clearAll(this.ui),Laya.timer.clear(this,this.loopEffect),1==this._state?Laya.Tween.to(this.ui.img_circular,{scaleX:.5,scaleY:.5},1e3):this.loopEffect()))},t.prototype.loopEffect=function(){Laya.Tween.clearAll(this.ui),this.ui.img_circular.scale(2,2),Laya.Tween.to(this.ui.img_circular,{scaleX:.5,scaleY:.5},1e3),Laya.timer.once(1500,this,this.loopEffect)},t}();e.PressTutorialEffectProxy=n}),define("src/g/Effects/UIEffectsEnum",["require","exports"],function(t,e){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.UIEffectsEnum||(e.UIEffectsEnum={}))[i.nan=0]="nan",i[i.btn_zhuan=1]="btn_zhuan",i[i.port=2]="port",i[i.putNewEquip=3]="putNewEquip",i[i.recover=33]="recover",i[i.jingmai=4]="jingmai",i[i.jingmaiNext=5]="jingmaiNext",i[i.btn_beginGame=7]="btn_beginGame",i[i.strongOK=8]="strongOK",i[i.soulOK=9]="soulOK",i[i.levelupOk=11]="levelupOk",i[i.fire=13]="fire",i[i.levelup=15]="levelup",i[i.giftBg=17]="giftBg",i[i.gift=18]="gift",i[i.guide=24]="guide",i[i.activeItem=22]="activeItem",i[i.portBar=29]="portBar",i[i.targetPoint=23]="targetPoint",i[i.godcast=32]="godcast",i[i.equipEffect=21]="equipEffect",i[i.equipEffect_huang=22]="equipEffect_huang",i[i.btnEffect=19]="btnEffect",i[i.artifactsBtm=34]="artifactsBtm",i[i.getTip_Big=42]="getTip_Big",i[i.equipEffect_bule=47]="equipEffect_bule",i[i.redbag=48]="redbag",i[i.paralysis=49]="paralysis",i[i.flak=50]="flak",i[i.design=53]="design",i[i.scales=54]="scales",i[i.fail=35]="fail",i[i.shenyu=89]="shenyu",i[i.artifactsItemBase=90]="artifactsItemBase",i[i.btn_001=40]="btn_001",i[i.pkbox=39]="pkbox",i[i.btn_effect_circle=41]="btn_effect_circle",i[i.dice_effect=100]="dice_effect",i[i.taskBar_effect=52]="taskBar_effect",i[i.wingUp=58]="wingUp",i[i.shenzhuUpState=59]="shenzhuUpState",i[i.shenqisuipianjihuo=60]="shenqisuipianjihuo",i[i.hunyinsuipianjihuo=47]="hunyinsuipianjihuo",i[i.shenqibg=61]="shenqibg",i[i.fuwenUpLv=67]="fuwenUpLv",i[i.governUpLv=70]="governUpLv",i[i.governUpStage=71]="governUpStage",i[i.reincamation=73]="reincamation",i[i.showoff=74]="showoff",i[i.hunComeRoleDi=78]="hunComeRoleDi",i[i.upSkill=37]="upSkill",i[i.upHeji=30]="upHeji",i[i.hunyinopen=38]="hunyinopen",i[i.effect39=39]="effect39",i[i.effect36=36]="effect36",i[i.wingcomp=68]="wingcomp",i[i.chop=72]="chop",i[i.pass=45]="pass",i[i.hunyincompose=105]="hunyincompose",i[i.helper=117]="helper",i[i.attackerheadeff=118]="attackerheadeff",i[i.login_effect_78=80]="login_effect_78",i[i.govern=83]="govern",i[i.vip_limit_79=79]="vip_limit_79",i[i.shengwu1=131]="shengwu1",i[i.shengwu2=132]="shengwu2",i[i.shengwu3=133]="shengwu3",i[i.shengwu4=134]="shengwu4",i[i.shengwu5=135]="shengwu5",i[i.tjk1=143]="tjk1",i[i.tjk2=144]="tjk2",i[i.tjk3=145]="tjk3",i[i.tjk4=146]="tjk4",i[i.xwEqItemAddRx=153]="xwEqItemAddRx",i[i.shenshi=161]="shenshi",i[i.shenyou=200]="shenyou",i[i.shenyu1=201]="shenyu1",i[i.shenyu2=202]="shenyu2",i[i.shenyu3=203]="shenyu3",i[i.shenyu4=204]="shenyu4",i[i.shenyu5=205]="shenyu5",i[i.shenyu6=206]="shenyu6",i[i.shenyu7=207]="shenyu7",i[i.shenyu8=208]="shenyu8",i[i.xingwang1=211]="xingwang1",i[i.xingwang2=212]="xingwang2",i[i.xingwang3=213]="xingwang3",i[i.xingwang4=214]="xingwang4",i[i.xingwang5=215]="xingwang5",i[i.xingwang6=216]="xingwang6",i[i.xingwang7=217]="xingwang7",i[i.xingwang8=218]="xingwang8",i[i.shenshiW=411]="shenshiW",i[i.shenshiY=421]="shenshiY",i[i.shenshiD=431]="shenshiD",i[i.shenshiYD=441]="shenshiYD",i[i.shenshiFK=451]="shenshiFK",i[i.mjollnir=998]="mjollnir",i[i.sylmEnter=1113]="sylmEnter",i[i.FirstRechargeGift=3800]="FirstRechargeGift",i[i.VipUp=1119]="VipUp",i[i.EXBar=1160]="EXBar",i[i.wipes=4064]="wipes",i[i.icon_0008=4008]="icon_0008",i[i.effect4069=4069]="effect4069",i[i.btn_0002=4002]="btn_0002",i[i.turnBtn_0001=3001]="turnBtn_0001"}),define("src/g/fight/osprite/obj/UnitState",["require","exports"],function(t,e){"use strict";var i,n;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.UnitState||(e.UnitState={}))[i.LAZY=0]="LAZY",i[i.STAND=1]="STAND",i[i.MOVE=2]="MOVE",i[i.FIGHT=3]="FIGHT",i[i.PICKUP=6]="PICKUP",i[i.TALKING=7]="TALKING",i[i.DEATH=8]="DEATH",(n=e.BattleState||(e.BattleState={}))[n.LAZY=0]="LAZY",n[n.FIGHT=1]="FIGHT",n[n.PICKUP_ITEM=2]="PICKUP_ITEM",n[n.NPC_TARGET=3]="NPC_TARGET",n[n.MOVE=4]="MOVE"}),define("src/g/fight/base/RES",["require","exports","../../../enum/JobEnum","src/g/clearRes/ClearResM"],function(t,e,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function a(){}return a.clearSceneRoleInfo=function(){var t=0;for(var e in this.sceneRolePath)i.ClearResM.clearUnit(e),delete this.sceneRolePath[e],t++;console.log("场景切换，释放 "+t+" 个URL数据.")},a.rolePath=function(t,e,i,n,s){var o;return o=a.ROLE_PATH+a.sexPath(e)+t+"/"+a.getMinFace(n)+"_"+a.getActionToString(i,s)+".json",this.sceneRolePath[o]=1,o},a.setResUrl=function(t){this.sceneRolePath[t]=1},a.monsterPath=function(t,e,i){var n;return n=a.MONSTER_PATH+t+"/"+i+"_"+a.getActionToString(e,0)+".json",this.sceneRolePath[n]=1,n},a.petPath=function(t,e,i){return a.PET_PATH+t+"/"+i+"_"+a.getActionToString(e,0)+".json"},a.ringPath=function(t,e,i){var n;return n=a.RING_PATH+t+"/"+i+"_"+a.getActionToString(e,0)+".json",this.sceneRolePath[n]=1,n},a.npcPath=function(t,e,i){var n=null;return n=-1==i?a.NPC_PATH+t+".json":a.NPC_PATH+t+"/"+a.getMinFace(i)+"_"+a.getActionToString(e,0)+".json",this.sceneRolePath[n]=1,n},a.wingPath=function(t,e,i,n){var s;return s=a.WING_PATH+t+"/"+a.getMinFace(i)+"_"+a.getActionToString(e,n)+".json",this.sceneRolePath[s]=1,s},a.weaponRes=function(t,e,i,n){var s;return s=a.WEAPON_PATH+t+"/"+a.getMinFace(i)+"_"+a.getActionToString(e,n)+".json",this.sceneRolePath[s]=1,s},a.getSdurl=function(t,e){var i;return void 0===e&&(e=0),t&&(i=a.EFFECT_PATH+t+".json"),i},a.getSdul0=function(t,e){var i=a.EFFECT_PATH+t+".json";return-1!=t.indexOf("E8")&&(i=a.EFFECT_PATH+t+"/"+this.getMinFace(e)+".json"),this.sceneRolePath[i]=1,i},a.getPetSdul0=function(t,e){var i=a.EFFECT_PATH+t+"/"+this.getMinFace(e)+".json";return this.sceneRolePath[i]=1,i},a.sexPath=function(t){var e="male/";return t==n.Sex.female&&(e="female/"),e},a.getMinFace=function(t){var e=t;return 4<t&&(e=8-t),e},a.getActionToString=function(t,e){var i="r";switch(t){case 1:case 6:case 0:case 7:i="s";break;case 2:i="r";break;case 8:i="s";break;case 3:switch(e){case n.JobEnum.ZHANSHI:i="a";break;case n.JobEnum.DAOSHI:case n.JobEnum.FASHI:i="m";break;default:i="a"}}return i},a.ROLE_PATH="dynamic2/role/",a.MONSTER_PATH="dynamic2/monster/",a.WING_PATH="dynamic2/wing/",a.WEAPON_PATH="dynamic2/weapon/",a.EFFECT_PATH="dynamic2/effect/",a.NPC_PATH="dynamic2/npc/",a.PET_PATH="dynamic2/pet/",a.RING_PATH="dynamic2/jieling/",a.sceneRolePath={},a}();e.RES=s}),define("src/init/ResManager",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._useForceLimitMemeryKey=!0,this._limitMemerySize=536870912,this.ctrlList=[],this.roleCtrlList=[]}return t.getInstance=function(){return t._instance?t._instance:t._instance=new t},t.prototype.checkIsInLimitMemery=function(){return!!(this._useForceLimitMemeryKey&&Laya.ResourceManager.currentResourceManager.memorySize<this._limitMemerySize)},t.prototype.showPageCtrl=function(t){-1==this.ctrlList.indexOf(t)&&this.ctrlList.push(t),20<this.roleCtrlList.length&&this.roleCtrlList.splice(0,this.roleCtrlList.length)},t.prototype.hidePanelCtrl=function(t){},t.prototype.destroyPanelCtrl=function(t){var e=this.ctrlList.indexOf(t);-1<e&&this.ctrlList.splice(e,1)},t.prototype.showRolePageCtrl=function(t){-1==this.roleCtrlList.indexOf(t)&&this.roleCtrlList.push(t),20<this.roleCtrlList.length&&this.roleCtrlList.splice(0,this.roleCtrlList.length)},t.prototype.hidePageCtrl=function(t){},t.prototype.destroyPageCtrl=function(t){var e=this.roleCtrlList.indexOf(t);-1<e&&this.roleCtrlList.splice(e,1)},t.prototype.outDebugInfo=function(){for(var t=0;t<this.ctrlList.length;t++)this.ctrlList[t],console.log(t+"PageCtrl");for(t=0;t<this.roleCtrlList.length;t++)this.roleCtrlList[t],console.log(t+"RolePage")},t.maxPeopleNum=60,t._instance=null,t}();e.ResManager=i}),define("src/g/clearRes/ClearResM",["require","exports","src/g/fight/base/RES","../../manager/LayerManager","src/init/ResManager"],function(t,e,n,r,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function a(){}return a.addCachUrl=function(t){this.cachUrlRes[t]=1},a.delCachUrl=function(t){this.cachUrlRes[t]=0},a.getFolder=function(t){var e=Laya.ResourceVersion.manifest,i=this.reskeys,n=i[t];if(n)return n;for(var s in i[t]=n=[],e)-1!=s.indexOf(t)&&n.push(s);return n},a.resetViewImg=function(t){t&&!t.destroyed&&(0==t.numChildren?t.restskin&&t.restskin():this.resetViewImgs(t))},a.resetViewImgs=function(t){for(var e=t.numChildren,i=0;i<e;i++){var n=t.getChildAt(i);n.restskin?(n.restskin(),this.resetViewImgs(n)):n instanceof Laya.Sprite&&this.resetViewImgs(n)}},a.addBgUrl=function(t){this.bigBg[t]=1,this._bgs.length},a.clearBgUrl=function(){for(var t in this.bigBg)this.clearUrl(t);this.clearFolderByUrl("dynamic2/zhiwawa/")},a.clearAniUrl=function(t){this._aniObj[t]=1},a.clearUrl=function(t){Laya.loader.cancelLoadByUrl(t),Laya.loader.clearTextureRes(t)},a.clearLogin=function(){Laya.timer.once(3e3,this,function(){Laya.loader.clearRes("dynamic2/uieffect/EUI1_28.json",!0),Laya.loader.clearRes("dynamic2/uieffect/EUI1_2.json",!0),Laya.loader.clearRes("res/atlas/res/kaichang.json",!0),Laya.loader.clearRes("res/atlas/res/createrole/new.json",!0),Laya.loader.clearRes("res/atlas/res/login/new.json",!0),Laya.loader.clearRes("res/atlas/res/login.json",!0),this.clearResFolder("createrole/"),this.clearResFolder("login/"),this.clearResFolder("loginpre/"),this.clearResFolder("kaichang/"),Laya.loader.clearRes("res/atlas/res/loginpre.json",!0)})},a.clearResFolder=function(t,e){var i="res/"+t;if(e)this.clearRes(i);else{var n=this._waitList;if(r.LayerManager.getWindowLayerNumChildren()<=0){for(var s=0;s<n.length;s++){var o=n[s];this.clearRes(o)}n.length=0,this.clearRes(i),this.mLimit(),a.clearBgUrl()}else n.push(i)}},a.mLimit=function(){i.ResManager.getInstance().checkIsInLimitMemery()||this.clearFolderByUrl(n.RES.EFFECT_PATH)},a.clearRes=function(t){var e=this.getFolder(t),i=Laya.loader;i.cancelLoadByUrls(e);for(var n=0;n<e.length;n++)i.clearTextureRes(e[n]);var s=this._bgs;s.length||(this._bgs=s=this.getFolder("res/bg/")),i.cancelLoadByUrls(s);for(var o=0;o<s.length;o++)i.clearTextureRes(s[o]);for(var a in this._aniObj)this.clearUrl(a)},a.clearFolderByUrl=function(t){r.LayerManager.getWindowLayerNumChildren()<=0?this.clearRes(t):this._waitList.push(t)},a.clearChengHao=function(){this.clearFolderByUrl("dynamic2/chenghao/")},a.clearEqICON=function(t){},a.clearGuide=function(){Laya.loader.clearRes("res/atlas/res/guide.json",!0)},a.setCachUrl=function(t){this.cachUrl[t]=1},a.clearCachUrl=function(t){this.cachUrl[t]=0},a.clearUnit=function(t){this.cachUrl[t]||Laya.loader.clearRes(t,!0)},a.clearMonster=function(t){for(var e=0;e<8;e++){var i=n.RES.monsterPath(t,1,e);this.cachUrl[i]||(Laya.loader.clearRes(i,!0),i=n.RES.monsterPath(t,2,e),this.cachUrl[i]||(Laya.loader.clearRes(i,!0),i=n.RES.monsterPath(t,3,e),this.cachUrl[i]||Laya.loader.clearRes(i,!0)))}},a.clearRole=function(t,e,i){},a.clearWing=function(t,e){},a.clearWeapon=function(t,e){},a.clearViewSkin=function(t){t&&!t.destroyed&&(0==t.numChildren?t.skin&&this.clearUrl(t.skin):this.clearViewSkins(t))},a.clearViewSkins=function(t){for(var e=t.numChildren,i=0;i<e;i++){var n=t.getChildAt(i);n.skin?this.clearUrl(t.skin):n instanceof Laya.Sprite&&this.clearViewSkins(n)}},a.bigBg={},a.cachUrlRes={},a.reskeys={},a._bgs=[],a._aniObj={},a._waitList=[],a.cachUrl={},a}();e.ClearResM=s}),define("src/g/Effects/UIEffectsFactory",["require","exports","../../utils/ItemUtils","../../utils/SoundUtils","../../component/SAnimation","src/g/clearRes/ClearResM","src/init/ResManager"],function(t,e,u,s,p,r,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.baseUIEffectsPath="dynamic2/uieffect",this.templet_up=null,this.templet_upLoadState=!1,t._ins=this}return Object.defineProperty(t,"Ins",{get:function(){return t._ins||new t},enumerable:!0,configurable:!0}),t.prototype.getSourceUrlById=function(t){var e=u.ItemUtils.getUIEffectsVoById(t);return(e.urlPath?e.urlPath:this.baseUIEffectsPath)+"/"+e.name+".json"},t.prototype.playSkeleton_UP_AutoCenter=function(t,e,i,n){void 0===e&&(e="up"),void 0===i&&(i=1),void 0===n&&(n=1)},t.prototype.createSAniById=function(t,e,i,n,s,o,a){var r=this;void 0===e&&(e=1),void 0===i&&(i=1),void 0===n&&(n="ani"),void 0===s&&(s=!0),void 0===o&&(o=0),void 0===a&&(a=0);var l=u.ItemUtils.getUIEffectsVoById(t),h=new p.SAnimation;h.setPropertyByVo(l,s,e,i,o),h.aniUrl=this.getSourceUrlById(t),this.loadSource(h,h.aniUrl),h.name=n;var c=0<a?a:l.playInterval;return 0==c||h.on(Laya.Event.COMPLETE,this,function(t,e){t.stop(),Laya.timer.once(e,r,function(t){t.play()},[t])},[h,c]),h},t.prototype.createSAniAndCenter=function(t,e,i,n,s,o,a,r){void 0===i&&(i=1),void 0===n&&(n=1),void 0===s&&(s="ani"),void 0===o&&(o=!0),void 0===a&&(a=0),void 0===r&&(r=0);var l=this.createSAniById(e,i,n,s,o,a,r);return this.centerSAni4Parent(l,t),l},t.prototype.centerSAni4Parent=function(t,e){t.x=e.width/2,t.y=e.height/2,e.addChild(t)},t.prototype.createCenterSAniAndMonopolize=function(t,e,i,n,s,o,a,r){void 0===i&&(i=1),void 0===n&&(n=1),void 0===s&&(s="ani"),void 0===o&&(o=!0),void 0===a&&(a=0),void 0===r&&(r=0);var l=t.getChildByName(s);return l&&l.aniUrl==this.getSourceUrlById(e)?(this.loadSource(l,l.aniUrl),l):(l&&l.destroy(),l=this.createSAniAndCenter(t,e,i,n,s,o,a,r))},t.prototype.playAniOnce=function(t,e,i,n,s,o){void 0===i&&(i=1),void 0===n&&(n=1),void 0===s&&(s="onceAni"),void 0===o&&(o=!0);var a=e.getChildByName(s);return a&&a.aniUrl==this.getSourceUrlById(t)?o&&a.play(0):(a&&r.ClearResM.addBgUrl(a.aniUrl),a&&r.ClearResM.clearAniUrl(a.aniUrl),a&&a.destroy(),a=this.createSAniAndCenter(e,t,i,n,s,!0),r.ClearResM.addBgUrl(a.aniUrl),a.once(Laya.Event.COMPLETE,this,function(){a.autoClear&&r.ClearResM.clearAniUrl(a.aniUrl),a.destroy(),a=null})),a},t.prototype.createUIAniById=function(t,e,i,n,s,o){var a=this;void 0===e&&(e=!1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=1),void 0===o&&(o=1);var r=u.ItemUtils.getUIEffectsVoById(t),l=new p.SAnimation;l.soundId=r.soundId,l.autoPlay=e||r.autoPlay,l.interval=0<i?i:r.interval,l.width=r.width*s,l.height=r.height*o,l.scale(s,o);var h=(r.urlPath?r.urlPath:this.baseUIEffectsPath)+"/"+r.name+".json";l.aniUrl=h,this.loadSource(l,h);var c=0<n?n:r.playInterval;return 0==c||l.on(Laya.Event.COMPLETE,this,function(t,e){t.stop(),Laya.timer.once(e,a,function(t){t.play()},[t])},[l,c]),l},t.prototype.createAndCenter=function(t,e,i,n,s,o,a,r){void 0===i&&(i=!1),void 0===n&&(n=1),void 0===s&&(s=1),void 0===o&&(o=0),void 0===a&&(a=0),void 0===r&&(r="uiani");var l=this.getSourceUrlById(e),h=t.getChildByName(r);if(h&&h.aniUrl==l)return h;h&&(h.removeSelf(),h.destroy());var c=this.createUIAniById(e,i,o,a,n,s);return this.centered4Parent(c,t,!0),c.name=r,c},t.prototype.playAnim=function(t,e){var i=u.ItemUtils.getUIEffectsVoById(t);if(i){var n=(i.urlPath?i.urlPath:this.baseUIEffectsPath)+"/"+i.name+".json";e.load(n),i.soundId&&s.SoundUtils.getInstance().playSoundById(i.soundId)}},t.prototype.clearAniRes=function(t,e){void 0===e&&(e=!1);var i=this.getSourceUrlById(t);Laya.loader.cancelLoadByUrl(i),Laya.loader.clearRes(this.getSourceUrlById(t),e)},t.prototype.centered4Parent=function(t,e,i){void 0===i&&(i=!1),t.x=(e.width-t.width)/2,t.y=(e.height-t.height)/2,i&&e.addChild(t)},t.prototype.alignCenter=function(t,e,i){void 0===i&&(i=1),t.pivotX=t.width/2,t.pivotY=t.height/2,t.x=e.width/2,t.y=e.height/2,t.scale(i,i)},t.prototype.loadSource=function(t,e,i){void 0===i&&(i=!0),Laya.loader.getRes(e)||!i?t.source=e:n.ResManager.getInstance().checkIsInLimitMemery()&&Laya.loader.load(e,Laya.Handler.create(this,this.loadSource,[t,e,!1]),null,Laya.Loader.ATLAS)},t}();e.UIEffectsFactory=i}),define("src/g/accessctrl/AccessListenner",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this._value=t}return t.prototype.addListenner=function(t){this._backHandler=t},t.prototype.check=function(){return!1},t.prototype.removeListenner=function(){},t}();e.AccessListenner=i}),define("src/g/accessctrl/AccessLevelListenner",["require","exports","src/g/accessctrl/AccessListenner","../../manager/RoleCenter","../../core/E","../../enum/EventName"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.addListenner=function(t){e.prototype.addListenner.call(this,t),t&&(s.E.ins.on(o.EventName.ADDED_LEVEL,this,this.onLvChangedHandler),s.E.ins.on(o.EventName.ADDED_ZHUANSHENG,this,this.onLvChangedHandler))},t.prototype.onLvChangedHandler=function(){this._backHandler&&this._backHandler.runWith(this)},t.prototype.check=function(){return n.RoleCenter.instans.vo.getCurLv()>=this._value},t.prototype.removeListenner=function(){s.E.ins.off(o.EventName.ADDED_LEVEL,this,this.onLvChangedHandler),s.E.ins.off(o.EventName.ADDED_ZHUANSHENG,this,this.onLvChangedHandler),this._backHandler=null},t}(i.AccessListenner);e.AccessLevelListenner=a}),define("src/g/accessctrl/AccessTaskListenner",["require","exports","src/g/accessctrl/AccessListenner","../../core/E","../../enum/EventName","../../manager/TaskManager"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.addListenner=function(t){e.prototype.addListenner.call(this,t),t&&n.E.ins.on(s.EventName.CURRENT_TASK_CHANGE,this,this.onChangedHandler)},t.prototype.onChangedHandler=function(){this._backHandler&&this._backHandler.runWith(this)},t.prototype.check=function(){return!o.TaskManager.ins.currentTask||o.TaskManager.ins.currentTask.id>=this._value},t.prototype.removeListenner=function(){n.E.ins.off(s.EventName.CURRENT_TASK_CHANGE,this,this.onChangedHandler),this._backHandler=null},t}(i.AccessListenner);e.AccessTaskListenner=a}),define("src/g/accessctrl/AccessShenqiListenner",["require","exports","src/g/accessctrl/AccessListenner","../../core/E","../../enum/EventName","../../manager/RoleCenter"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.addListenner=function(t){e.prototype.addListenner.call(this,t),t&&n.E.ins.on(s.EventName.ACHIVATERELIC,this,this.onChangedHandler)},t.prototype.onChangedHandler=function(){this._backHandler&&this._backHandler.runWith(this)},t.prototype.check=function(){return o.RoleCenter.instans.vo.Relic.relicId>=this._value},t.prototype.removeListenner=function(){n.E.ins.off(s.EventName.ACHIVATERELIC,this,this.onChangedHandler),this._backHandler=null},t}(i.AccessListenner);e.AccessShenqiListenner=a}),define("src/g/accessctrl/AccessPortListenner",["require","exports","src/g/accessctrl/AccessListenner","../../manager/RoleCenter","../../core/E","../../enum/EventName"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.addListenner=function(t){e.prototype.addListenner.call(this,t),t&&s.E.ins.on(o.EventName.PLAY_TYPE_CHANGED,this,this.onChangedHandler)},t.prototype.onChangedHandler=function(){this._backHandler&&this._backHandler.runWith(this)},t.prototype.check=function(){return n.RoleCenter.instans.self.portstatus.portindex>=this._value},t.prototype.removeListenner=function(){s.E.ins.off(o.EventName.PLAY_TYPE_CHANGED,this,this.onChangedHandler),this._backHandler=null},t}(i.AccessListenner);e.AccessPortListenner=a}),define("src/g/accessctrl/AccessVipListenner",["require","exports","src/g/accessctrl/AccessListenner","../../manager/RoleCenter","../../core/E","../../enum/EventName"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.addListenner=function(t){e.prototype.addListenner.call(this,t),t&&s.E.ins.on(o.EventName.VIP_EXP_CHANGED,this,this.onChangedHandler)},t.prototype.onChangedHandler=function(){this._backHandler&&this._backHandler.runWith(this)},t.prototype.check=function(){return n.RoleCenter.instans.vo.VIP>=this._value},t.prototype.removeListenner=function(){s.E.ins.off(o.EventName.VIP_EXP_CHANGED,this,this.onChangedHandler),this._backHandler=null},t}(i.AccessListenner);e.AccessVipListenner=a}),define("src/g/accessctrl/AccessSuperMonthListenner",["require","exports","src/g/accessctrl/AccessListenner","../../manager/RoleCenter","../net/messages/sbkFormula","../../enum/EventName","../../core/E"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.addListenner=function(t){e.prototype.addListenner.call(this,t),t&&(a.E.ins.on(o.EventName.SUPER_MONTH_CARD_END_TIME_CHANGE,this,this.endTimeChanged),this.checkTime())},t.prototype.endTimeChanged=function(){Laya.timer.clearAll(this),this.checkTime(),this.onChangedHandler()},t.prototype.onChangedHandler=function(){this._backHandler&&this._backHandler.runWith(this)},t.prototype.checkTime=function(){var t=n.RoleCenter.instans.vo.superMonthCardEndTime-s.sbkFormula.secNow();0<t&&t<28800&&Laya.timer.once(1e3*t,this,this.timeOver)},t.prototype.timeOver=function(){this.onChangedHandler()},t.prototype.check=function(){return s.sbkFormula.secNow()<n.RoleCenter.instans.vo.superMonthCardEndTime},t.prototype.removeListenner=function(){Laya.timer.clearAll(this),a.E.ins.off(o.EventName.SUPER_MONTH_CARD_END_TIME_CHANGE,this,this.endTimeChanged),this._backHandler=null},t}(i.AccessListenner);e.AccessSuperMonthListenner=r}),define("src/g/login/event/LoginE",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e,"ins",{get:function(){return e.self?e.self:e.self=new e},enumerable:!0,configurable:!0}),e.OPENVIEW_LOGIN_STARTGAME="openview_login_startgame",e.OPENVIEW_LOGIN_NOTICE="openview_login_notice",e.OPENVIEW_LOGIN_PRECONCT="openview_login_preconct",e.CHG_PRECONCT="chg_preconct",e.DESTROY_LOGIN="destroy_login",e.WEBSOCKET_ZHUCE="websocket_zhuce",e.CLOSE_ZHUCE="close_zhuce",e.WEBSOCKET_LOGIN="websocket_login",e.CLOSE_LOGIN="close_login",e}(Laya.EventDispatcher);e.LoginE=i}),define("src/g/datacollection/ctrl/DataCollections",["require","exports","../../../manager/RoleCenter"],function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function a(){}return Object.defineProperty(a,"SvrData",{get:function(){return this._svrdata},set:function(t){this._svrdata=t},enumerable:!0,configurable:!0}),Object.defineProperty(a,"username",{get:function(){return o.RoleCenter.instans.vo?o.RoleCenter.instans.vo.nickname:Date.now()+"test"},enumerable:!0,configurable:!0}),Object.defineProperty(a,"channel_l",{get:function(){return window.KtChannelId||1},enumerable:!0,configurable:!0}),a.init=function(){},a.payEvent=function(){},a.getParamData=function(t){return void 0===t&&(t="event_user"),{app_id_s:this.app_id_s,app_version_code_s:this.app_version_code_s,category_s:t,channel_s:this.channel_l+"",create_unix:Date.now()/1e3>>0,data_from_s:"LOG",data_unix:Date.now()/1e3>>0,platform_s:this.platform_s,region_s:this._svrdata.svrID,sdk_version_code_s:this.sdk_version_code_s,server_s:this._svrdata.svrID}},a.customEventApp=function(t){console.log("%c 发送自定义事件 ++++++","background:#222;color:#bada55");var e={param_data:this.getParamData("event_custom"),param_event:{event_s:["custom_0"],custom:{custom_s:JSON.stringify(t)}}};this.sendServer(e)},a.sendAppStart=function(){console.log("%c 发送app启动事件 ++++++","background:#222;color:#bada55");var t={param_data:this.getParamData("event_app"),param_event:{event_s:["booting_0"]}};this.sendServer(t)},a.roleRegister=function(){var t=o.RoleCenter.instans.vo.username,e=o.RoleCenter.instans.vo.nickname,i=o.RoleCenter.instans.vo.getJobId(0),n="W";if(0<o.RoleCenter.instans.vo.getSex())n="M";console.log("%c 发送角色注册事件 ++++++","background:#222;color:#bada55");var s={param_data:this.getParamData("event_role"),param_event:{event_s:["register_0"]},param_role:{role_name_s:e,role_id_s:t,sex_s:n,role_class_s:i},param_user:{user_id_s:t}};this.sendServer(s)},a.sendLogin=function(t,e){void 0===t&&(t="6872"),void 0===e&&(e="event_user")},a.sendLoginOut=function(t,e){void 0===t&&(t="6872"),void 0===e&&(e="event_user")},a.sendServer=function(t){if(!window.ktgamepreloadjdk.debug){var e=this.app_id_s,i=Date.now()/1e3>>0,n={gid:e,time:i,sign:window.md5(""+a.md5key+e+i),jsonStr:t},s=JSON.stringify(n),o=new XMLHttpRequest;o.open("post",this.url,!0),o.responseType="json",o.setRequestHeader("Content-Type","application/json"),o.onreadystatechange=function(){4==o.readyState&&(200==o.status||console.log("HTTP请求错误！错误码："+o.status))},o.send(s)}},a.url="http://test.gskuld.receiver.extranet.kt007.com:8080/skuld/game/common",a.md5key="0A008C48E74E8A399F1F80DBED71161C",a.app_id_s="sbk_h5_test",a.app_version_code_s="0.1.0",a.category_s="event_user",a.region_s="123",a.server_s="123",a.sdk_version_code_s="1.0.0",a.ADR="ADR",a.IOS="IOS",a.H5="H5",a.IOS_YY="IOS_YY",a.iscreateRole=!1,a.platform_s="H5",a.sex_s="M",a}();e.DataCollections=i}),define("src/g/role/vo/GovernStruct",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._data={},t._ins=this}return Object.defineProperty(t,"Ins",{get:function(){return t._ins||new t},enumerable:!0,configurable:!0}),t.prototype.addVo4Data=function(t){this._data[t.type]||(this._data[t.type]={}),this._data[t.type][t.level]||(this._data[t.type][t.level]={}),this._data[t.type][t.level]=t},t.prototype.getGovernVo=function(t,e){return this._data[t][e]||null},t}();e.GovernStruct=i}),define("src/g/lottery/Vo/ShengShiVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._data={},this.LvArr=[],this._ssEquIdArr=[],t._ins=this}return Object.defineProperty(t,"Ins",{get:function(){return t._ins||new t},enumerable:!0,configurable:!0}),t.prototype.addShengShi=function(t){this._data[t.pos]||(this._data[t.pos]={}),this._data[t.pos][t.job]||(this._data[t.pos][t.job]={}),this._data[t.pos][t.job][t.nowLv]=t,this._ssEquIdArr.push(t.id)},t.prototype.isShengShi=function(t){return-1<this._ssEquIdArr.indexOf(t)},t.prototype.getShengShiVo=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=0),7!=t&&8!=t||(t=6),1==t&&0==e&&0==i&&(i=1),0==e?this._data[t][i][5080]:this._data[t][i][e]||null},t.prototype.getNextShengShiVo=function(t,e,i){void 0===i&&(i=0),7!=t&&8!=t||(t=6);var n=this.getShengShiVo(t,e,i),s=this.LvArr.indexOf(n.nowLv)+1;return this._data[t][i][this.LvArr[s]]||null},t.prototype.getNextLvByLv=function(t){var e=this.LvArr.indexOf(t);return e<0?0:this.LvArr[e+1]||0},t}();e.ShengShiStruct=i;var n=function(t,e,i,n){this.id=t,this.job=i,this.pos=e,this.nowLv=n};e.ShengShiVo=n}),define("src/g/lottery/Vo/ChengZhuangVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this._data={},this._suitData={},this.LvArr=[],this._czEquArr=[],t._ins=this}return Object.defineProperty(t,"Ins",{get:function(){return t._ins||new t},enumerable:!0,configurable:!0}),t.prototype.getMinLv=function(){return this.LvArr[0]},t.prototype.addSuit=function(t){this._suitData[t.id]=t},t.prototype.getSuitById=function(t){return this._suitData[t]||null},t.prototype.getSuitByLv=function(t){for(var e in this._suitData)if(this._suitData[e].level==t)return this._suitData[e];return null},t.prototype.addChengZhuang=function(t){this._data[t.job]||(this._data[t.job]={}),this._data[t.job][t.pos]||(this._data[t.job][t.pos]={}),this._data[t.job][t.pos][t.nowLv]=t,this._czEquArr.push(t.id)},t.prototype.isChengZhuang=function(t){return-1<this._czEquArr.indexOf(t)},t.prototype.getChengZhuangVo=function(t,e,i,n){return 0<i?this.retCopyCz(this._data[t][e][1e3*i+80])||null:n<10?this.retCopyCz(this._data[t][e][1])||null:80<n?this.retCopyCz(this._data[t][e][80])||null:this.retCopyCz(this._data[t][e][10*Math.floor(n/10)])||null},t.prototype.retCopyCz=function(t){if(!t)return null;var e=new s(0,0,0,0);return e.id=t.id,e.job=t.job,e.nowLv=t.nowLv,e.pos=t.pos,e},t.prototype.getNextChengZhuangVo=function(t,e,i,n){var s,o=e;if(6==e?o=5:7==e?o=6:8==e&&(o=6),0==n){var a=this.getChengZhuangVo(t,o,i,n);s=this.LvArr.indexOf(a.nowLv)}else{a=this.getChengZhuangVo(t,o,i,n);s=this.LvArr.indexOf(a.nowLv)+1}return this._data[t][o][this.LvArr[s]]||null},t.prototype.getLastChengZhuangVo=function(t,e,i,n){var s=this.getChengZhuangVo(t,e,i,n),o=this.LvArr.indexOf(s.nowLv)-1;return this._data[t][e][this.LvArr[o]]||null},t.prototype.getChengZhuangVoByLv=function(t,e,i){return 6==e?e=5:7==e?e=6:8==e&&(e=6),this.retCopyCz(this._data[t][e][i])||null},t.prototype.getNextLvByLv=function(t){var e=this.LvArr.indexOf(t);return e<0?0:this.LvArr[e+1]||0},t.prototype.getLastLvByLv=function(t){var e=this.LvArr.indexOf(t);return e<0?0:this.LvArr[e-1]||0},t}();e.ChengZhuangStruct=n;var i=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.id=t[i++],this.name=t[i++],this.level=t[i++],this.need=t[i++],this.prop=t[i++],n.Ins.addSuit(this)},t}();e.EquipSuitVo=i;var s=function(t,e,i,n){this.id=t,this.job=e,this.pos=i,this.nowLv=n||0};e.ChengZhuangVo=s}),define("src/g/skill/vo/PassiveStruct",["require","exports","../../../utils/ItemUtils"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.lowPassArr=[],this.higPassArr=[],t._ins=this}return Object.defineProperty(t,"Ins",{get:function(){return t._ins||new t},enumerable:!0,configurable:!0}),t.prototype.add4Arr=function(t){1==t.id2&&(5<t.quality?this.higPassArr.push(t):this.lowPassArr.push(t))},t.prototype.getLowPassArr=function(){return this.lowPassArr},t.prototype.getHigPassArr=function(){return this.higPassArr},t.prototype.getLowPassVoByType=function(t){for(var e=0;e<this.lowPassArr.length;e++)if(t==this.lowPassArr[e].type)return this.lowPassArr[e];return null},t.prototype.getHigPassVoByType=function(t){for(var e=0;e<this.lowPassArr.length;e++)if(t==this.higPassArr[e].type)return this.higPassArr[e];return null},t.prototype.getPvo4ItemId=function(t){var e=t%240%8+1;return 5==i.ItemUtils.getItemVoById(t).quality?this.getLowPassVoByType(e):this.getHigPassVoByType(e)},t}();e.PassiveStruct=n}),define("src/g/copy/vo/EXPAttributeCardVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.isShowPercentage=!1}return t.prototype.init=function(t,e){var i=0;this.id=t[i++],this.name=t[i++],this.prop=t[i++],this.res=t[i++],this.imagc=t[i++],this.percent=t[i++],this.showType=t[i++],this.isShowPercentage=1==t[i++],e[this.id]=this},t}();e.EXPAttributeCardVo=i}),define("src/g/copy/vo/EXPMonsterVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.id=t[i++],this.section=t[i++],this.child_section=t[i++],this.type=t[i++],this.monsterid=t[i++],this.delay=t[i++],this.drop=t[i++],e[this.id]=this},t}();e.EXPMonsterVo=i}),define("src/g/copy/vo/EXPEnviromentVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.id=t[i++],this.twocost=t[i++],this.threecost=t[i++],this.viplevel=t[i++],this.cardtime=t[i++],this.monster_scene=t[i++],this.opendelay=t[i++],this.carddelay=t[i++],this.serverdelaymax=t[i++],this.monster_time=t[i++],this.gametime=t[i++],e[this.id]=this},t}();e.EXPEnviromentVo=i}),define("src/g/helper/vo/HelperStruct",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._typeLen=0,this._typedata=[],this._voData={},this._target_idArr=[],this._target_voArr=[],t._instance=this}return Object.defineProperty(t,"ins",{get:function(){return t._instance||new t},enumerable:!0,configurable:!0}),t.prototype.addTargetVo=function(t){this._target_idArr.push(t.id),this._target_voArr.push(t)},t.prototype.getTargetVoById=function(t){var e=this._target_idArr.indexOf(t);return this._target_voArr[e]},t.prototype.getNextTargetId=function(t){if(void 0===t&&(t=0),0==t)return this._target_idArr[0];var e=this._target_idArr.indexOf(t);return this._target_idArr[e]?this._target_idArr[e]:-1},t.prototype.getNextTargetVo=function(t){if(void 0===t&&(t=0),0==t)return this._target_voArr[0];var e=this._target_idArr.indexOf(t);return this._target_voArr[e]},t.prototype.addHelperVo=function(t){this._voData[t.type]||(this._voData[t.type]={}),this._voData[t.type][t.id]=t},t.prototype.getHelperVo=function(t,e,i){if(void 0===t&&(t=-1),void 0===e&&(e=1),void 0===i&&(i=!1),i){var n=[];for(var s in this._voData[e])n.push(this._voData[e][s]);return n}return-1==t?this._voData[e]:this._voData[e][t]},Object.defineProperty(t.prototype,"typeLen",{get:function(){return this._typeLen},enumerable:!0,configurable:!0}),t.prototype.addTypeVo=function(t){this._typeLen++,this._typedata.push(t),this._typedata.sort(this.sortByHelperType)},t.prototype.getTypeVo=function(t){return void 0===t&&(t=-1),-1==t?this._typedata:this._typedata[t]||null},t.prototype.sortByHelperType=function(t,e){return t.type-e.type},t}();e.HelperStruct=i;var n=function(){function t(){}return t.prototype.init=function(t){var e=0;this.id=t[e++],this.type=t[e++],this.img=t[e++],this.check=t[e++],this.pos=t[e++],this.des=t[e++],i.ins.addTypeVo(this)},t}();e.HelperTypeVo=n;var s=function(){function t(){}return t.prototype.init=function(t){var e=0;this.id=t[e++],this.priority=t[e++],this.type=t[e++],this.childtype=t[e++],this.checkType=t[e++],this.port=t[e++],this.tips=t[e++],this.nameurl=t[e++],this.giftBgSrc=t[e++],this.advertSrc=t[e++],this.moduleid=t[e++],this.gift=t[e++],this.des=t[e++],i.ins.addHelperVo(this)},t}();e.HelperVo=s}),define("src/init/VoAsyncLoader",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,i,n){void 0===n&&(n=100),this._content={},this._clz=t,this._loadAllCallback=e,this._data=i,this._maxTimeout=n}return t.prototype.load=function(){return this.stepLoad(0),this},t.prototype.stepLoad=function(t){for(var e=Date.now(),i=this._data.length;t<i;){if((new this._clz).init(this._data[t],this._content),++t==i)return void this._loadAllCallback.runWith(this._content);if(Date.now()-e>this._maxTimeout)return void Laya.timer.frameOnce(1,this,this.stepLoad,[t],!1)}},t}();e.VoAsyncLoader=i}),define("src/g/lottery/Vo/SySuitVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.id=t[i++],this.name=t[i++],this.type=t[i++],this.level=t[i++],this.skill_id=t[i++],this.pos=t[i++],e[this.id]=this},t}();e.SySuitVo=i}),define("src/g/lottery/Vo/SyLevelVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.id=t[i++],this.name=t[i++],this.type=t[i++],this.level=t[i++],this.prop=t[i++],this.upcost=t[i++],this.power=t[i++],this.suit=t[i++],e[this.id]=this},t}();e.SyLevelVo=i}),define("src/g/zhanling/vo/ZlTypeVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.id=t[i++],this.name=t[i++],this.res=t[i++],this.skill=t[i++],this.image=t[i++],e[this.id]=this},t}();e.ZlTypeVo=i}),define("src/g/zhanling/vo/ZlSkillVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.id=t[i++],this.name=t[i++],this.type=t[i++],this.icon=t[i++],this.specialSkill=t[i++],this.prop1=t[i++],this.desc=t[i++],e[this.id]=this},t}();e.ZlSkillVo=i}),define("src/g/zhanling/vo/ZlDrugVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.id=t[i++],this.type=t[i++],this.level=t[i++],this.prop=t[i++],this.cost=t[i++],this.power=t[i++],e[this.id]=this},t}();e.ZlDrugVo=i}),define("src/g/zhanling/vo/ZlStarVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.id=t[i++],this.type=t[i++],this.name=t[i++],this.level=t[i++]||0,this.star=t[i++],this.activationcost=t[i++],this.prop=t[i++],this.cost=t[i++],this.perExp=t[i++],this.exp=t[i++],this.power=t[i++],e[this.id]=this},t}();e.ZlStarVo=i}),define("src/g/zhanling/vo/ZlCopyVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.name=t[i++],this.portid=t[i++],this.level=t[i++],this.chance=t[i++],this.cost=t[i++],e[this.portid]=this},t}();e.ZlCopyVo=i}),define("src/g/fight/osprite/map/MapConst",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.MAP_CW=256,t.MAP_CH=256,t.MAP_TILED_W=64,t.MAP_TILED_OPPOSITE=95,t.SCREEN_WIDTH=1e3,t.SCREEN_HEIGHT=1500,t.TILED_WEIGHT_NOPASS=0,t.TILED_WEIGHT_PASS=1,t.TILED_WEIGHT_TRANSLUCENT=2,t}();e.MapConst=i}),define("src/g/fight/osprite/UnitType",["require","exports"],function(t,e){"use strict";var i,n;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.UnitType||(e.UnitType={}))[i.NONE=99]="NONE",i[i.PLAYER=1]="PLAYER",i[i.MONSTER=2]="MONSTER",i[i.SELF=3]="SELF",i[i.NPC=4]="NPC",i[i.DROPS=5]="DROPS",i[i.ROBOT=6]="ROBOT",i[i.SOUL=7]="SOUL",(n=e.MonsterType||(e.MonsterType={}))[n.MONSTER=1]="MONSTER",n[n.BOSS=2]="BOSS"}),define("src/g/fight/info/DropVo",["require","exports","../../../utils/ItemUtils","../../../meta/QualiyVo","../../../meta/ItemVo","../../../enum/ItemExtType"],function(t,e,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.color="#ffffff",this.type=1,this.qnum=0}return t.prototype.init=function(t,e){var i;if(t!=this.itemID){if(this.itemID=t,i=o.ItemUtils.getItemOrEq(t)){this.itemName=i.name;var n=a.QualityStruct.Ins.getQualityVo(i.quality);this.color=n.color,this.icon=o.ItemUtils.getIconByIconId(i.icon),this.count=e;var s=n.dropEff;i instanceof r.ItemVo&&(s=i.getExtVal(l.ItemExtType.DROP),isNaN(s)&&(s=0)),this.qnum=s}}else this.count=e},t}();e.DropVo=i}),define("src/g/fight/osprite/obj/DropSprite",["require","exports","src/g/fight/osprite/GameScene","../../../../utils/ItemUtils","src/g/fight/info/DropVo","src/g/fight/osprite/obj/BaseSprite","../../../../manager/LayerManager","src/g/fight/osprite/map/MapConst","src/g/fight/osprite/SceneObjManager","../../../../utils/effects/BesselEffect","../../../../utils/DropUtil","src/g/Effects/UIEffectsFactory"],function(t,e,c,r,i,n,o,u,a,p,d,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=laya.utils.Ease,s=function(s){function t(){var t=s.call(this)||this;t.head=new Laya.Text,t.icon=new Laya.Sprite,t._eff=new Laya.Sprite,t._ani=new Laya.Animation,t._vo=new i.DropVo,t.flying=!1,t.finalPos=[],t._step=.1;var e=t.head;return t.icon.pivotX=25,t.icon.pivotY=-15,e.align="center",e.valign="middle",e.color="#ffffff",e.fontSize=18,e.strokeColor="#000000",e.stroke=2,t._eff.pivot(10,8),t}return __extends(t,s),t.prototype.setData=function(t,e){var i=this.vo,n=this.head,s=this._ani;s.alpha=1,s.scaleY=1,i.init(t,e),n.color=i.color,n.text=i.itemName;var o=i.qnum,a=i.itemID;a==d.DropUtil.MONEYID&&(n.text=e+""),a==d.DropUtil.GOLDID&&(n.text=e+""),0<o&&(s.loadAtlas(l.UIEffectsFactory.Ins.getSourceUrlById(o)),s.play(),s.pivot(150,430),s.scale(1.3,1.3),s.interval=120,this.view.skilleffectLayer.addChild(s)),this.unit_uid=r.ItemUtils.ID,this.actorType=5,this.action=0,this.canSelect=!0},Object.defineProperty(t.prototype,"vo",{get:function(){return this._vo},enumerable:!0,configurable:!0}),t.prototype.ginit=function(){this.action=0;var t=this.icon,e=this.head,i=this._eff;t.graphics.clear(!0),t.loadImage(this._vo.icon,0,0,50,50),i.loadImage("res/unpack/cir.png",0,0,21,21),e.width=90,e.align="center",e.pivotX=45;var n=this.view;n.nameLayer.addChild(e),n.dropLayer.addChild(t),n.dropLayer.addChild(i),i.alpha=Math.random()-.2},Object.defineProperty(t.prototype,"scaleAll",{get:function(){var t=this.icon;return t?t.scaleX:1},set:function(t){var e=this.icon,i=this.head;e&&i&&(e.scaleX=t,e.scaleY=t,i.scaleX=t,i.scaleY=t)},enumerable:!0,configurable:!0}),t.prototype.fallToMapPos=function(t,e,i){void 0===i&&(i=0),this.flying=!1;var n=Math.floor(t/u.MapConst.MAP_TILED_W),s=Math.floor(e/u.MapConst.MAP_TILED_W);c.GameScene.ins.map.isCross([n,s])||(d.DropUtil.isfly=!0),this.ginit();var o=this.mapX,a=this.mapY;this.nextPos={x:o,y:a};var r=t,l=e;this.finalPos[0]=r,this.finalPos[1]=l;var h=new laya.maths.Point(o,a).distance(r,l)/90*100+500;p.BesselEffect.fly(this.nextPos,new laya.maths.Point(r,l),-(o-r)/2,-(a-l)/2-(100*Math.random()+100),h,Laya.Handler.create(this,this.setCan),g.bounceOut)},t.prototype.setCan=function(){this.canSelect=!0},t.prototype.draw=function(){s.prototype.draw.call(this);var t=this._eff,e=this.nextPos,i=this.gridX,n=this.gridY;this.head.x=this.icon.x=i,this.head.y=this.icon.y=n-32,t.x=i-5,t.y=n+15,this._ani.x=i,this._ani.y=n,t.rotation+=1,1<=t.alpha&&(this._step=-.2),t.alpha<=0&&(this._step=.01),t.alpha+=this._step,e&&this.setMapXY(e.x,e.y)},t.prototype.flyToUnit=function(t,e){this.flying||Laya.Tween.to(this,{mapX:t+20,mapY:e+20,scaleAll:.6},600,Laya.Ease.cubicOut,new Laya.Handler(this,this.bePickUp)),this.flying=!0,this._eff.removeSelf()},t.prototype.bePickUp=function(){a.SceneObjManager.instans.deleDrops(this),this.action=8,Laya.Tween.clearAll(this),Laya.Tween.clearTween(this),this.icon.graphics.clear(!0),this.scaleAll=1,this.head.pos(0,0),this.icon.pos(0,0),this.head.removeSelf(),this.icon.removeSelf(),this.flying=!1,d.DropUtil.addPool(this),this._eff.removeSelf(),this._ani.removeSelf()},Object.defineProperty(t.prototype,"view",{get:function(){return o.LayerManager.fightLayer},enumerable:!0,configurable:!0}),t}(n.BaseSprite);e.DropSprite=s}),define("src/g/fight/osprite/obj/FaceDirection",["require","exports"],function(t,e){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.FaceDirection||(e.FaceDirection={}))[i.D0=0]="D0",i[i.D1=1]="D1",i[i.D2=2]="D2",i[i.D3=3]="D3",i[i.D4=4]="D4",i[i.D5=5]="D5",i[i.D6=6]="D6",i[i.D7=7]="D7"}),define("src/g/fight/osprite/obj/UnitCovert",["require","exports","src/g/fight/osprite/map/MapConst","src/g/fight/osprite/GameScene"],function(t,e,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function r(){}return r.calcFace=function(t,e){var i=t[0],n=t[1],s=e[0],o=e[1],a=Math.atan2(o-n,s-i);return r.radiansToFace(a)},r.getFace=function(t,e,i,n){},r.radiansToFace=function(t){var e=t+Math.PI,i=Math.PI/8,n=6;return e<1*i?n=6:e<3*i?n=7:e<5*i?n=0:e<7*i?n=1:e<9*i?n=2:e<11*i?n=3:e<13*i?n=4:e<15*i&&(n=5),n},r.addies=function(t,e){var i=0,n=0;switch(t){case 0:n=-1/e;break;case 1:i=1/e,n=-1/e;break;case 2:i=1/e;break;case 3:n=i=1/e;break;case 4:n=1/e;break;case 5:i=-1/e,n=1/e;break;case 6:i=-1/e;break;case 7:n=i=-1/e}return[i,n]},r.parseWorldToGrid=function(t,e){var i=0;return[t<=.5*n.MapConst.SCREEN_WIDTH?t*n.MapConst.MAP_TILED_W:t>=s.GameScene.ins.map.width-.5*n.MapConst.SCREEN_WIDTH?t*n.MapConst.MAP_TILED_W:.5*n.MapConst.SCREEN_WIDTH,i=e<=.6*n.MapConst.SCREEN_HEIGHT?e*n.MapConst.MAP_TILED_W:i>=s.GameScene.ins.map.height-.6*n.MapConst.SCREEN_HEIGHT?e*n.MapConst.MAP_TILED_W:.6*n.MapConst.SCREEN_HEIGHT]},r.ic=Math.atan2(3,3)/2,r}();e.UnitCovert=i}),define("src/g/fight/osprite/map/MapLoadQueue",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.mapJsonIndex=new Object,this.loaderTasks=[],this.delay=100,this.perLoaderCount=2,this._isRunning=!1}return Object.defineProperty(t,"instans",{get:function(){return this._self||(this._self=new t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isRunning",{set:function(t){this._isRunning!=t&&(this._isRunning=t,this._isRunning?Laya.timer.loop(this.delay,this,this.processLoaderTasks):Laya.timer.clear(this,this.processLoaderTasks))},enumerable:!0,configurable:!0}),t.prototype.processLoaderTasks=function(){for(var t=this.loaderTasks.length-1;0<=t;t--)this.loaderTasks[t].load();this.loaderTasks.length=0,this.isRunning=!1},t.prototype.addLoaderTask=function(t){this.loaderTasks.push(t),this.isRunning=!0},t}();e.MapLoadQueue=i}),define("src/g/fight/osprite/map/MapGrid",["require","exports","src/g/fight/osprite/map/MapLoadQueue","../../../../enum/LoadPriority","src/g/configjson/ctrl/ConfigJsonCtrl"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.relativeX=0,t.relativeY=0,t._map=null,t.urlStr="",t._isLoading=!1,t._isdraw=!1,t._isclear=!1,t}return __extends(t,e),t.prototype.initData=function(t,e,i){this._map=i,this._isdraw=!1,this._isclear=!1,this.urlStr="dynamic/map/"+this.checkSameMap(this._map.id+"/"+t+"_"+e)+".jpg"},t.prototype.checkSameMap=function(t){return-1<s.ConfigJsonCtrl.ins.sameMap.indexOf(t)?"custom/basemap":t},t.prototype.show=function(){if(this.urlStr&&!this._isLoading)if(this.res=Laya.loader.getRes(this.urlStr),this.res)this.onBigLoaded();else{this._isLoading=!0;2==i.MapLoadQueue.instans.mapJsonIndex[this._map.id]?this.load():i.MapLoadQueue.instans.addLoaderTask(this)}},t.prototype.load=function(){Laya.loader.load(this.urlStr,Laya.Handler.create(this,this.onBigLoaded),null,null,n.LoadPriority.MAP)},t.prototype.onBigLoaded=function(){this.destroyed||this._isclear||(this._isLoading=!1,this._isdraw?this.visible=!0:(this.res=Laya.loader.getRes(this.urlStr),this.res&&this.res.bitmap?(this._isdraw=!0,this.graphics.drawTexture(this.res,0,0,this._map.gridWidth,this._map.gridHeight),this.visible=!0):console.error("缺少地图。。。。。")))},t.prototype.hide=function(){this.visible=!1,this._isdraw=!1,this.graphics.clear(!0),Laya.loader.cancelLoadByUrl(this.urlStr),this._isLoading=!1},t.prototype.updatePos=function(){this._map&&(this.x=this.relativeX+this._map.viewPortX,this.y=this.relativeY+this._map.viewPortY)},t.prototype.clearRes=function(){Laya.loader.clearRes(this.urlStr,!0),this.res&&this.res.destroy(!0),this.res=null},t.prototype.clearAll=function(){this._map=null,this._isclear=!0,this.relativeX=0,this.relativeY=0,this.graphics.clear(!0),Laya.loader.cancelLoadByUrl(this.urlStr),this.clearRes(),this.urlStr="",this._isLoading=!1},t}(Laya.Sprite);e.MapGrid=o}),define("src/g/fight/osprite/map/MapLayers",["require","exports","../../../../manager/LayerManager","src/g/fight/osprite/map/MapGrid"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t._gridSpriteArray=[],t}return __extends(t,e),t.prototype.init=function(t){this._map=t},t.prototype.showSmallMap=function(){i.LayerManager.smallMap.graphics.clear(!0),i.LayerManager.smallMap.loadImage(t.mapsmallurl,0,0,100,100),i.LayerManager.smallMap.scale(200,200)},t.prototype.setSmallSize=function(t,e){i.LayerManager.smallMap.scale(t/100,e/100)},t.prototype.getDrawSprite=function(t,e){var i=new n.MapGrid;return i.width=this._map.gridWidth,i.height=this._map.gridHeight,i.relativeX=t*this._map.gridWidth,i.relativeY=e*this._map.gridHeight,i.initData(t,e,this._map),this._gridSpriteArray.push(i),i},t.prototype.updateGridPos=function(){if(this._map){for(var t,e=0;e<this._gridSpriteArray.length;e++)(t=this._gridSpriteArray[e])&&t.updatePos();i.LayerManager.smallMap.x=this._map.viewPortX,i.LayerManager.smallMap.y=this._map.viewPortY}},t.prototype.delGrid=function(t){t.hide()},t.prototype.clearAll=function(){this._map=null},t.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this._map=null,this._gridSpriteArray&&(this._gridSpriteArray.length=0)},t.smallMap=new Laya.Sprite,t.mapsmallurl="",t}(Laya.Sprite);e.MapLayers=s}),define("src/g/fight/osprite/obj/MapTargetPoint",["require","exports","src/g/fight/osprite/SceneObjManager","src/g/Effects/UIEffectsFactory","src/g/fight/osprite/obj/BaseSprite","../../../../manager/LayerManager"],function(t,e,n,s,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function i(){var t=e.call(this)||this;return t.ani=s.UIEffectsFactory.Ins.createSAniById(23),t.ani.loop=!1,t}return __extends(i,e),i.prototype.addToMap=function(t){n.SceneObjManager.instans.regObject(this),this.ani.play(0,!1),t?this.ani.loadAtlas(i.walkableurl):this.ani.loadAtlas(i.diswalkableurl),this.ani.once(Laya.Event.COMPLETE,this,this.remove),o.LayerManager.fightLayer.shadowLayer.addChild(this.ani)},i.prototype.remove=function(){this.ani.removeSelf(),n.SceneObjManager.instans.unregObject(this),this.ani.stop()},Object.defineProperty(i.prototype,"alpha",{get:function(){return this.ani.alpha},set:function(t){this.ani.alpha=t},enumerable:!0,configurable:!0}),i.prototype.frameMove=function(t){this.updatePoint(),this.ani.x=this.gridX,this.ani.y=this.gridY},i.prototype.destory=function(){e.prototype.destory.call(this),this.ani&&(this.ani.destroy(),Laya.loader.clearRes(i.walkableurl,!0),Laya.loader.clearRes(i.diswalkableurl,!0))},i.walkableurl="dynamic2/uieffect/EUI1_23.json",i.diswalkableurl="dynamic2/uieffect/EUI1_46.json",i}(i.BaseSprite);e.MapTargetPoint=a}),define("src/g/fight/osprite/obj/SelfBaseUnit",["require","exports","src/g/fight/osprite/obj/HeroUnit","../../../../enum/LoadPriority","../../../../core/E","../../../../enum/EventName"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(i){function t(t){void 0===t&&(t=null);var e=i.call(this,t,!0)||this;return e.isSelfUnit=!0,e.strong=1,e.loadPriority=n.LoadPriority.ROLE_ANI,s.E.ins.on(o.EventName.CHANGE_HP,e,e.onHpMaxChange),e}return __extends(t,i),t.prototype.onHpMaxChange=function(){},t.prototype.setHp=function(t){i.prototype.setHp.call(this,t),s.E.ins.event(o.EventName.ROLE_HP_CHANGE)},t.prototype.destroyUnit=function(){s.E.ins.off(o.EventName.CHANGE_HP,this,this.onHpMaxChange),i.prototype.destroyUnit.call(this)},t.prototype.frameMove=function(t,e){this.newSkillKey?this.newFrameMove(t,e):i.prototype.frameMove.call(this,t,e)},t}(i.HeroUnit);e.SelfBaseUnit=a}),define("src/g/fight/osprite/obj/MonsterUnit_New",["require","exports","../../../../component/GAnimation","src/g/fight/osprite/obj/Unit_New","src/g/fight/osprite/obj/UnitCovert","src/g/fight/base/RES","../../../../utils/ItemUtils","../../../../enum/JobEnum","../../../../enum/LoadPriority","src/g/clearRes/ClearResM","../../../../component/MonsterHpBar","../../../../config/vo/gameSettingVo"],function(t,e,i,s,o,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(a){function n(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1);var i=a.call(this,t,e)||this;return i.scaleXRate=-1,i.alphaStep=.1,i.hurtNum=0,i.maxHurtNum=0,i._atttime=120,i.data=l.ItemUtils.getMonsterVOById(1001),i.coat.interval=d.gameSettingVo.m_stand_framerate,i.status=0,i.actorType=2,i.face=1,i.setWorldXY(0,0),i.loadPriority=c.LoadPriority.OTHER_ROLE_ANI,i.alphaStep=n.alphas[4*Math.random()>>0],i}return __extends(n,a),n.prototype.initHpBar=function(){this.topHpBar=new p.MonsterHpBar},Object.defineProperty(n.prototype,"beFocusEffect",{set:function(t){this.setFocusEff()},enumerable:!0,configurable:!0}),n.prototype.setFocusEff=function(){var t,e="dynamic2/uieffect/EUI1_";if(2==this.vo.type)t=e+"63.json";else if(3==this.vo.type)t=e+"64.json";else if(4==this.vo.type)t=e+"65.json";else{if(5!=this.vo.type)return;t=e+"66.json"}this.beFocus||(this.beFocus=new i.GAnimation,r.RES.setResUrl(t),this.beFocus.load(t,!0)),this.beFocus.zOrder=0,this.view.shadowLayer.addChild(this.beFocus)},n.prototype.set_DATA=function(t){a.prototype.set_DATA.call(this,t),this.monid=t.id,this.status=0,this.strong=0,this.setHp(t.HP),this.job=h.JobEnum.MONSTER,this.monsterUrl=t.moResVo.res,this.coat.randStart=!0,this.stand(),this.coat.interval=d.gameSettingVo.m_stand_framerate,this._atttime=t.moResVo.attackrate,this.avatarId=t.res,this.actorName=t.name+" Lv."+t.lv,this.coat.scale(t.zoom,t.zoom),this.topHpBar&&(this.topHpBar.headName=this.actorName,this.topHpBar.totalHp=t.HP,this.topHpBar.offY=-t.moResVo.position*t.zoom,this.resetHpBar(),this.topHpBar.visible=!1),t.moResVo&&(this.attackDis=t.moResVo.value,this.station=t.moResVo.station,this.useColorFilterKey=0==t.moResVo.effect),this.sk_Manager.register_skill([t.skill],[1]),this.drawDebugCircle()},n.prototype.resetHP=function(){this.setHp(this.vo.HP),this.resetHpBar()},n.prototype.resetHpBar=function(){if(this.getHp()<=0)return this.topHpBar&&(this.topHpBar.visible=!1),void this.clearBeFocus()},n.prototype.get_ATT=function(){return 0|this.data.ATT},n.prototype.get_ATT_MULTI=function(){return 0},n.prototype.get_PDEF=function(){return 0},n.prototype.get_PDEF_MULTI=function(){return 0},n.prototype.get_SDEF=function(){return 0},n.prototype.get_SDEF_MULTI=function(){return 0},n.prototype.get_INCHURT=function(){return 0},n.prototype.get_DECHURT=function(){return 0},n.prototype.get_HIT=function(){return 0},n.prototype.get_MISS=function(){return 0},n.prototype.get_CHAOS=function(){return 0},n.prototype.get_ANTICHAOS=function(){return 0},n.prototype.get_HITBACKRATE=function(){return 0},n.prototype.get_HITBACK=function(){return 0},n.prototype.get_STRONG=function(){return 0},n.prototype.get_ANTISTRONG=function(){return 0},n.prototype.get_STRONGHURT=function(){return 0},n.prototype.get_extHURT=function(){return 0},n.prototype.chg_HP=function(t,e,i,n,s){if(void 0===s&&(s=!1),!this._constantHp){var o=this.getHp()+t;0<this.hurtNum&&(this.hurtNum--,o=this.hurtNum/this.maxHurtNum*this.getTotalHp()),o<0&&(o=0),this.setHp(o),a.prototype.chg_HP.call(this,t,e,i,n,s),this.floatBlood(t,e?e.job:0,i,n,s),this.resetHpBar(),this.getHp()<=0&&this.clearBeFocus(),this.topHpBar&&(this.topHpBar.visible=!0)}},Object.defineProperty(n.prototype,"move_speed",{get:function(){return s.Unit_New.move_SPEED/8},enumerable:!0,configurable:!0}),n.prototype.playAnimation=function(t,e){if(void 0===e&&(e=-1),this.action=t,1==this.action?this.coat.interval=d.gameSettingVo.m_stand_framerate:this.coat.interval=this._atttime,3==this.action){if(0<=e){this.face=o.UnitCovert.calcFace(this.getMapPos(),this.fightTarget.getMapPos()),this.coat.load(this.getRoleRes(t),!0,t,"",this.loadPriority),this.calSkillHurt(e);var i=this.getSkillId(e);if(i&&i.sdur0){this.weaponEff.clear();var n=r.RES.getSdul0(i.sdur0,this.face);this.weaponEff.load(n)}this.coat.isLoop=!1}}else this.coat.load(this.getRoleRes(t),!0,t,"",this.loadPriority),this.coat.isLoop=!0},n.prototype.setUnitVis=function(t){this.body&&(a.prototype.setUnitVis.call(this,t),!t&&this.cancelLoad(),!t&&u.ClearResM.clearMonster(this.monsterUrl),t||this.clearBeFocus(),this.topHpBar&&(this.topHpBar.visible=!1))},n.prototype.svrSetHP=function(t){this.setHp(t),this.getHp()<=0&&this.clearBeFocus()},n.prototype.cancelLoad=function(){this.coat&&this.coat.cancelLoad(),this.weapon&&this.weapon.cancelLoad()},n.prototype.resetUnit=function(t,e){a.prototype.resetUnit.call(this,t,e),this.stand(),this.setHp(this.data.HP),this.sk_Manager.clear_buff(),this.setWorldXY(t,e),this.resetHpBar(),this.body&&(this.body.visible=!0,this.body.alpha=0),this.shadow&&(this.shadow.visible=!0),this.topHpBar&&(this.topHpBar.visible=!1),this.setFocusEff()},n.prototype.frameMove=function(t,e){if(!this.destoryed){if(a.prototype.frameMove.call(this,t,e),this.body.scaleX=this.scaleX*this.scaleXRate,this.fightTarget){var i=this.getMapPos(),n=this.fightTarget.getMapPos();this.face=o.UnitCovert.calcFace(i,n)}this.body.alpha<1&&(this.body.alpha+=this.alphaStep)}},n.prototype.getRoleRes=function(t){var e=0,i=this.face,n=this.data;if(n){var s=n.moResVo.dir;5==s.length?e=i<=4&&0!=i?8-i:i:-1!=s.indexOf(1)?(this.scaleXRate=1,e=i<3||6<i?1:3):(e=3<=i&&i<=6?5:7,this.scaleXRate=-1)}return r.RES.monsterPath(this.monsterUrl,t,e)},Object.defineProperty(n.prototype,"vo",{get:function(){return this.data},enumerable:!0,configurable:!0}),n.prototype.destroyUnit=function(){u.ClearResM.clearMonster(this.monsterUrl),a.prototype.destroyUnit.call(this),this.clearBeFocus()},n.prototype.setHurtNum=function(t){this.maxHurtNum=this.hurtNum=t},n.MON_UIDVAL=800,n.alphas=[.05,.02,.03,.1],n}(s.Unit_New);e.MonsterUnit_New=n}),define("src/g/fight/osprite/obj/PlayerUnit",["require","exports","src/g/fight/osprite/obj/HeroUnit"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.onMoveEnd=function(){this.ability.checkNearNpc()},e.prototype.putOnWeapon=function(t){this.weaponId=t},e.prototype.putOnCoat=function(t){this.avatarId=t},e}(i.HeroUnit);e.PlayerUnit=n}),define("src/g/fight/osprite/play/SceneNPCFight",["require","exports","src/g/fight/osprite/obj/HeroUnit","src/g/fight/osprite/obj/MonsterUnit_New","../../../../utils/ItemUtils","src/g/fight/osprite/obj/UnitCovert","src/g/fight/osprite/GameScene","../../../../manager/LayerManager","src/g/fight/osprite/obj/PlayerUnit"],function(t,e,i,c,u,p,a,d,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.bossid=0,this.boss=null}return t.prototype.createBoss=function(t,e){this.boss&&(d.LayerManager.fightLayer.removeUnit(this.boss),this.boss.destroyUnit(),this.boss=null),this.boss=new c.MonsterUnit_New;var i=u.ItemUtils.getPortVoById(t).boss,n=u.ItemUtils.getMonsterVOById(i);this.boss.set_DATA(n),this.boss.setWorldXY(e[0],e[1]),this.boss.face=Math.floor(7*Math.random()),this.bossid=t,d.LayerManager.fightLayer.addUnit(this.boss)},t.prototype.resetPos=function(t){this.boss&&this.boss.setWorldXY(t[0],t[1])},t.prototype.destroy=function(){this.bossid=0,this.boss&&(this.boss.destroyUnit(),this.boss=null)},t.MEETBOSS_INDEX=-1688,t}();e.SceneBossData=n;var g=function(){function t(){this.player=new i.HeroUnit,this.otherUnit=[]}return t.prototype.setVis=function(t){this.fight&&this.fight.setFightVis(t)},t.prototype.destroy=function(){this.fight&&this.fight.destroy(),this.fight=null,this.player&&this.player.destroyUnit();for(var t=0;t<this.otherUnit.length;t++)this.otherUnit[t].destroyUnit(),this.otherUnit[t]=null;this.player=null,this.otherUnit=[]},t.prototype.readyToPK=function(t,e){this.fight&&this.fight.destroy(),this.fight=null,this.player.setAsShow(!1);for(var i=t.openhero,n=i.length,s=1;s<n;s++){var o=i[s],a=new r.PlayerUnit;e.addFightUnit(a),a.initHeroData(o,t.chopLv,0),e.resetFightGroup(this.player.get_POS())}},t.prototype.resetPos=function(t){this.fight&&this.fight.resetPos(t)},t}();e.SceneNPCData=g;var s=function(){function t(){this._mid=0}return t.prototype.getFreePos=function(t,e){var i,n;void 0===e&&(e=2),i=Math.random()<.5?t[0]+e:t[0]-e,n=Math.random()<.5?t[1]+e:t[1]-e;var s=0,o=a.GameScene.ins.map;if(o.isCross([i,n]))return[i,n];for(;;){if(i=Math.random()<.5?t[0]+e:t[0]-e,n=Math.random()<.5?t[1]+e:t[1]-e,o.isCross([i,n]))return[i,n];if(15<++s)break}for(e--;;){if(i=Math.random()<.5?t[0]+e:t[0]-e,n=Math.random()<.5?t[1]+e:t[1]-e,o.isCross([i,n]))return[i,n];if(15<++s)break}return t},t.prototype.resetMonster=function(t){if(!(t<0||this._mid==t)){var e=u.ItemUtils.getMonsterVOById(t);if(e){var i=this._monster.worldX,n=this._monster.worldY;d.LayerManager.fightLayer.removeUnit(this._monster),this._monster.destory(),this._monster=new c.MonsterUnit_New,this._monster.set_DATA(e),this._monster.setWorldXY(i,n),this._monster.setAsShow(!0),this._npcdata.player.setFightTarget(this._monster),this._monster.setFightTarget(this._npcdata.player),d.LayerManager.fightLayer.addUnit(this._monster),this._mid=t}}},t.prototype.createFight=function(t,e,i){var n=new g;try{var s=t.openhero[0],o=s.openSkill,a=o.indexOf(4),r=s.skillLvl;if(-1<a&&(o.splice(a,1),r.splice(a,1)),n.player.initHeroData(s,t.chopLv,0,t.nickname,6),n.player.setAsShow(!0),n.player.face=Math.floor(7*Math.random()),n.player.setWorldXY(i[0],i[1]),n.fight=this,d.LayerManager.fightLayer.addUnit(n.player),this._npcdata=n,e<0)return;var l=u.ItemUtils.getMonsterVOById(e);if(!l)return;var h=this.getFreePos(i,n.player.get_ATTACKDISTANCE()-1);this._monster=new c.MonsterUnit_New(!1),this._monster.set_DATA(l),this._monster.setWorldXY(h[0],h[1]),this._monster.setAsShow(!0),d.LayerManager.fightLayer.addUnit(this._monster),n.player.setFightTarget(this._monster),this._monster.setFightTarget(n.player),this._mid=e,n.player.setSkillRandomDelay(),this._monster.face=p.UnitCovert.calcFace(this._monster.getMapPos(),n.player.getMapPos())}catch(t){console.log("创建NPC异常...")}},t.prototype.resetPos=function(t){this._npcdata.player.setWorldXY(t[0],t[1]);var e=this.getFreePos(t,this._npcdata.player.get_ATTACKDISTANCE());this._monster.setWorldXY(e[0],e[1])},t.prototype.setFightVis=function(t){t?(this._npcdata.player.setFightTarget(this._monster),this._monster.setFightTarget(this._npcdata.player),d.LayerManager.fightLayer.addUnit(this._monster),d.LayerManager.fightLayer.addUnit(this._npcdata.player)):(this._npcdata.player.setFightTarget(null),this._monster.setFightTarget(null)),this._npcdata.player.setUnitVis(t),this._monster.setUnitVis(t)},Object.defineProperty(t.prototype,"npcData",{get:function(){return this._npcdata},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._monster&&this._monster.destroyUnit(),this._monster=null,this._npcdata.player.setFightTarget(null)},t}();e.SceneNPCFight=s}),define("src/g/accessctrl/AccessData",["require","exports","../../meta/AccessCfgVo","../../config/GameConfig","../../utils/ItemUtils","../../utils/system/FloatEffect","../../plugin/view/ToolTip","../../utils/system/DateUitl","src/init/TextConst"],function(t,e,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.setAccessOpen=function(t,e){return this._data[t-1]!=e&&(this._data[t-1]=e,!0)},t.checkOpen=function(t,e){void 0===e&&(e=!1);var i=!1;if(0<t&&t<=this._data.length&&(i=1==this._data[t-1]),!i&&e){var n=u.GameConfig.accessCtrlCfg[t];502==t&&((n=new c.AccessCfgVo).forceopen=!0);var s=n.prompt;if(n&&s){var o=n.require,a=o[0][0],r=o[0][1],l=r.toString();if(3==a){var h=u.GameConfig.taskJSON[r];h&&(l=" "+h.name+" ")}else if(1==a)l=p.ItemUtils.getLVString(r);else if(2==a)l=f.TextConst.get(2,r-100);else if(7==a){if(r<=v.DateUtil.getKFDay())return this._data[t-1]=1,!0}d.FE.upItems(n.prompt.replace("{0}",l),g.BubbleEnum.center)}}return i},t._data=[],t}();e.AccessData=i}),define("src/init/Switches",["require","exports","../component/NumberEventDispatcher","../config/GameConfig","../meta/AccessCfgVo","src/g/accessctrl/AccessData","../utils/SoundUtils"],function(t,e,i,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(r){function t(){var t=r.call(this)||this;return t._payfilters={12:!0,13:!0,14:!0,101:!0,109:!0,111:!0,122:!0,155:!0},t}return __extends(t,r),Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t),this._ins},enumerable:!0,configurable:!0}),t.prototype.event=function(t,e){void 0===e&&(e=null);var i=parseInt(t);if(window.enabledpay||!this._payfilters[i]){var n=l.GameConfig.accessCtrlCfg[i];if(502==i&&((n=new h.AccessCfgVo).forceopen=!0),n){var s,o=c.AccessData.checkOpen(i,!n.forceopen);if(n.forceopen&&(o=!0),o){var a=[o];e&&(a=a.concat(e)),s=r.prototype.event.call(this,t,a),n.accessibleSound&&u.SoundUtils.getInstance().playSoundById(n.accessibleSound)}else n.unaccessibleSound&&u.SoundUtils.getInstance().playSoundById(n.unaccessibleSound);return s}return console.log("错误：没有这个模块"),!1}},t}(i.NumberEventDispatcher);e.Switches=n}),define("src/g/account/view/FailView",["require","exports","src/g/accessctrl/AccessCenter","../../../manager/RoleCenter","src/init/Switches","src/init/TextConst","../../../config/GameConfig","../../net/messages/TeamMsg"],function(t,e,n,l,s,o,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function i(){var t=e.call(this)||this;return t.emid=0,t.addEvent(),t.popupEffect=null,t.animation.visible=t.bg.visible=t.items.visible=window.enabledpay,t}return __extends(i,e),i.prototype.callBack=function(){this.handler&&(this.handler.runWith(this.handler.args),this.handler=null)},i.prototype.addEvent=function(){this.btn_boss.on(Laya.Event.CLICK,this,function(){n.AccessCenter.ins.checkOpen(23,!0)&&(this.close(),s.Switches.ins.event(23))}),this.btn_lilian.on(Laya.Event.CLICK,this,function(){n.AccessCenter.ins.checkOpen(18,!0)&&(this.close(),s.Switches.ins.event(18))}),this.btn_shouchong.on(Laya.Event.CLICK,this,function(){this.close(),s.Switches.ins.event(109)}),this.btn_xunbao.on(Laya.Event.CLICK,this,function(){n.AccessCenter.ins.checkOpen(9,!0)&&(this.close(),s.Switches.ins.event(9))}),this.bg.on(Laya.Event.CLICK,this,function(){this.close(),s.Switches.ins.event(this.emid)}),this.btn_get.on(Laya.Event.CLICK,this,function(){this.close()})},i.prototype.close=function(){e.prototype.close.call(this),this.callBack()},i.prototype.setState=function(t){switch(t){case i.NORMAL:this.normalState();break;case i.AWARD:this.awardState()}},i.prototype.normalState=function(){this.items.y=275,this.award.removeChildren(),this.award.visible=!1;var t=l.RoleCenter.instans.vo,e=h.GameConfig.commonJson.failViewLink.value.split(",");t.vipData&&!t.vipData.isFirstCharge?(this.emid=13,window.oldversion?this.bg.skin="res/jiesuan/shouchong_old.png":this.bg.skin="res/jiesuan/shouchong.png",this.img_firstRecharge.skin="res/jiesuan/"+e[0]+".png",this.lab_firstRecharge.text=e[1]):1==t._vo.openhero.length?(this.emid=15,this.bg.skin="res/jiesuan/dazhuzai_zi01_liangjuese.png",this.img_firstRecharge.skin="res/jiesuan/"+e[2]+".png",this.lab_firstRecharge.text=e[3]):2==t._vo.openhero.length?(this.emid=15,this.bg.skin="res/jiesuan/dazhuzai_zi01_sanjuese.png",this.img_firstRecharge.skin="res/jiesuan/"+e[4]+".png",this.lab_firstRecharge.text=e[5]):(this.emid=99,this.bg.skin="res/jiesuan/dazhuzai_zi01_jinzhuang.png",this.img_firstRecharge.skin="res/jiesuan/"+e[6]+".png",this.lab_firstRecharge.text=e[7])},i.prototype.awardState=function(){this.items.y=530,this.award.removeChildren(),this.award.visible=!0},i.prototype.showView=function(t,e){this.handler=t,this.lab_get.text=o.TextConst.get(202),this.hBox_get.resetLayoutY(),this.hBox_get.resetLayoutX(),this.btn_get.offAll(),this.btn_get.once(Laya.Event.CLICK,this,this.onCloseHandler),this.popup()},i.prototype.showHelp=function(t){var e=h.GameConfig.commonJson.porthelp.value,i=!1,n=0,s=l.RoleCenter.instans.vo.portstatus.hfData.HELPFIGHT_ME;t==c.enumTeamType.helpFight&&(i=+e<=(n=l.RoleCenter.instans.vo.portstatus.portindex));var o=211,a=!1,r=!1;i?(a=!0,o=322,0==s&&(r=!0)):n=0,this.copyid=n,this.btn_get.x=o,this.btn_help.disabled=r,this.btn_help.visible=a,this.lab_helpTime.text="("+s+"/"+h.GameConfig.commonJson.appealtime.value+")"},i.prototype.cdHandler=function(){this._cooldown--,this._cooldown<1?this.onCloseHandler():(this.lab_get.text=o.TextConst.get(202),this.hBox_get.centerX=0,this.hBox_get.centerY=-2)},i.prototype.onCloseHandler=function(){this._stopHandler&&this._stopHandler.run(),this._stopHandler=null,this._cooldown=0,Laya.timer.clear(this,this.cdHandler),this.btn_get.offAll(),this.close()},i.NORMAL=0,i.AWARD=1,i}(ui.account.GameFailViewUI);e.FailView=i}),define("src/g/createrole/view/ChangeRoleNew",["require","exports","../../../manager/LayerManager","../../../manager/RoleCenter","../../../manager/GameSocketManager","../../net/messages/share/transformJobMsg","../../../enum/JobEnum"],function(t,e,i,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t._resurl={},t.enabledchange=!0,t.vo=new a.transformJobC2GS,t.img_zy_zhan_male.on(Laya.Event.CLICK,t,t.selectHandler,[t.img_zy_zhan_male,1,r.Sex.male]),t.img_zy_zhan_female.on(Laya.Event.CLICK,t,t.selectHandler,[t.img_zy_zhan_female,1,r.Sex.female]),t.img_zy_fa_male.on(Laya.Event.CLICK,t,t.selectHandler,[t.img_zy_fa_male,2,r.Sex.male]),t.img_zy_fa_female.on(Laya.Event.CLICK,t,t.selectHandler,[t.img_zy_fa_female,2,r.Sex.female]),t.img_zy_dao_male.on(Laya.Event.CLICK,t,t.selectHandler,[t.img_zy_dao_male,3,r.Sex.male]),t.img_zy_dao_female.on(Laya.Event.CLICK,t,t.selectHandler,[t.img_zy_dao_female,3,r.Sex.female]);var e=[t.img_zy_zhan_male,t.img_zy_zhan_female,t.img_zy_fa_male,t.img_zy_fa_female,t.img_zy_dao_male,t.img_zy_dao_female],i=2*((t.thisjob=s.RoleCenter.instans.jobID)-1);return t.btn_startGame.on(Laya.Event.CLICK,t,t.onChangeRole),Laya.UIUtils.gray(e[i],!0),Laya.UIUtils.gray(e[i+1],!0),t.selectHandler(t.img_zy_zhan_male,1,r.Sex.male),t}return __extends(t,n),t.prototype.onChangeRole=function(){this.enabledchange&&(s.RoleCenter.instans.jobID=this.thisjob,o.GSM.sendServer(this.vo),this.destroyView())},t.prototype.selectHandler=function(t,e,i){var n="res/createrole/new/"+e+"_"+i+".jpg";this.role_bg.skin=n,this._resurl[n]=1,this.selectimg.x=t.x,this.selectimg.y=t.y,this.enabledchange=e!=this.thisjob,Laya.UIUtils.gray(this.btn_startGame,e==this.thisjob),this.vo.jobid=e,this.vo.sex=i},t.show=function(){Laya.loader.load([{url:"res/atlas/res/createrole/new.json",type:Laya.Loader.ATLAS}],new Laya.Handler(t,t.onloadeHandl))},t.onloadeHandl=function(){(new t).showView()},t.prototype.showView=function(){this.graphics.clear(),this.graphics.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),i.LayerManager.addAlertLayer(this)},t.prototype.onloadeHandl=function(){},t.prototype.destroyView=function(){for(var t in Laya.timer.clearAll(this),this.removeSelf(),this._resurl)Laya.loader.clearRes(t);this.destroy()},t}(ui.createrole.ChangeRoleViewUI);e.ChangeRoleNew=n}),define("src/g/custom/detailDlgs/Details_Item",["require","exports","../../../manager/GameSocketManager","../../net/messages/UseItemC2GS","../../../utils/ItemUtils","../../../meta/MainButtonVo","../../../manager/RoleCenter","../../../utils/system/ErrCodeView","../../net/messages/ErrConst","src/init/Switches","../../../utils/UIUtils","../../../utils/system/ServerTime","../../../utils/system/DateUitl","../../../meta/QualiyVo","../../../manager/AM","../../../enum/BagItemType","src/init/TextConst","src/g/createrole/view/ChangeRoleNew","../../../utils/system/FloatEffect"],function(t,e,p,d,i,g,v,f,y,m,n,s,o,a,_,C,I,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r,l=function(e){function t(){var t=e.call(this)||this;return t.time=-1,t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){this.btn_sub.on(Laya.Event.CLICK,this,this.onChangeNum,[0]),this.btn_add.on(Laya.Event.CLICK,this,this.onChangeNum,[1]),this.btn_min.on(Laya.Event.CLICK,this,this.onChangeNum,[2]),this.btn_max.on(Laya.Event.CLICK,this,this.onChangeNum,[3]),this.btn_decTen.on(Laya.Event.CLICK,this,this.onChangeNum,[4]),this.btn_addTen.on(Laya.Event.CLICK,this,this.onChangeNum,[5]),this.btn_use.on(Laya.Event.CLICK,this,this.onSend)},t.prototype.close=function(){Laya.timer.clearAll(this),e.prototype.close.call(this)},t.prototype.loopTime=function(){var t=s.ServerTime.serverTime,e=this.time-t;e<=0?this.lab_time.text=I.TextConst.get(805):e>o.DateUtil.oneDateSec?this.lab_time.text=I.TextConst.get(37,o.DateUtil.remainingDayStr(e)):this.lab_time.text=I.TextConst.get(37,o.DateUtil.S2HMSstr(e))},t.prototype.initData=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=-1),this.iVo=t,this.num=e||1,this.showBase(),-1!=(this.time=n)?(this.loopTime(),Laya.timer.loop(1e3,this,this.loopTime)):this.lab_time.text="";var s=t.type;if(1<this.num&&s==C.BagItemType.locked_box){var o=t.effect[1][0],a=t.effect[1][1],r=v.RoleCenter.instans.vo.bagdata.getItemCount(o),l=0;0<r&&(l=Math.floor(r/a)),this.num=0<l?Math.min(l,this.num):1}(i=(t.type==C.BagItemType.gonghuiling||t.type==C.BagItemType.baoxiang||t.type==C.BagItemType.rmb||t.type==C.BagItemType.gaimingka||t.type==C.BagItemType.baoxiangSpecial2||t.type==C.BagItemType.useItem||t.type==C.BagItemType.shizhuang||t.type==C.BagItemType.lvUp||t.type==C.BagItemType.xhybqnlb||t.type==C.BagItemType.xhybxzlb||t.type==C.BagItemType.bxhybxzlb||t.type==C.BagItemType.fcname||t.type==C.BagItemType.zhuangshika||t.type==C.BagItemType.locked_box)&&i)||this.btn_use.removeSelf(),i&&this.onChangeNum(3),this.rechangeLSize(i),this.rechangeSize()},t.prototype.initData_CurrencyVo=function(t,e){this.cVo=t,this.num=e,this.showBase_CurrencyVo();this.rechangeLSize(!1),this.rechangeSize()},t.prototype.showBase_CurrencyVo=function(){this.item_.img_item.skin=i.ItemUtils.getIconByDefine(this.cVo.define),this.item_.img_quality.skin=i.ItemUtils.getQualitybjByQualityId(this.cVo.quality),this.item_.lab_num.changeText(""),this.lab_num.changeText(0==this.num?"":this.num+""),this.lab_name.changeText(this.cVo.name),this.lab_name.color=i.ItemUtils.getQualityColorByDefin(this.cVo.define),this.lab_lv.changeText(a.QualityStruct.Ins.getQDesById(this.cVo.quality)),this.lab_lv.color=i.ItemUtils.getColorByQuality(this.cVo.quality),this.lab_desc.text=this.cVo.desc},t.prototype.showBase=function(){this.lab_html.style.font=this.lab_desc.font,this.lab_html.style.fontSize=this.lab_desc.fontSize,this.lab_html.style.color=this.lab_desc.color,this.lab_html.style.leading=10,this.item_.img_item.skin=i.ItemUtils.getIconById(this.iVo.id),this.item_.img_quality.skin=i.ItemUtils.getQualitybjByQualityId(this.iVo.quality),this.item_.lab_num.changeText(""),this.lab_num.changeText(0==this.num?"":this.num+""),this.lab_name.changeText(this.iVo.name),this.lab_name.color=i.ItemUtils.getQualityColorById(this.iVo.id),this.lab_lv.changeText(a.QualityStruct.Ins.getQDesById(this.iVo.quality)),this.lab_lv.color=i.ItemUtils.getColorByQuality(this.iVo.quality);var t=this.iVo.desc||"";this.lab_desc.text=n.UIUtils.replaceHtml(t),this.lab_html.innerHTML=n.UIUtils.replaceBr(t),this.lab_tipsDi.height=this.lab_desc.height+30,7!=this.iVo.type&&26!=this.iVo.type||(this.lab_num.text="1",this.btn_sub.visible=!1,this.btn_add.visible=!1,this.img_di.visible=!1,this.lab_size.visible=!1,this.btn_min.visible=!1,this.btn_max.visible=!1,this.btn_decTen.visible=!1,this.btn_addTen.visible=!1)},t.prototype.onSend=function(){t.UseItem(this.iVo,parseInt(this.lab_size.text),-1<this.time?this.time:0),this.close()},t.UseItem=function(t,e,i){if(void 0===e&&(e=1),void 0===i&&(i=0),1==t.type)g.MainButtonStruct.Ins.OpenModule(t.link[2][0],t.link[2][1]);else if(21==t.type||22==t.type||23==t.type)m.Switches.ins.event(194,[!1,!0,t.id,i,e]);else if(7==t.type||14==t.type||26==t.type){if(910==t.id)return void(20<v.RoleCenter.instans.vo.getCurLv()&&v.RoleCenter.instans.vo.getCurLv()<60?b.ChangeRoleNew.show():_.AM.show("条件不足，使用失败！"));g.MainButtonStruct.Ins.OpenModule(t.link[2][0],t.link[2][1])}else if(15==t.type)m.Switches.ins.event(60);else if(13==t.type){for(var n=v.RoleCenter.instans.vo,s=0;s<t.uselimit.length;s++){var o=t.uselimit[s][1];switch(t.uselimit[s][0]){case"PRICERMB":if(n.vipData.allPriceGold<o)return void f.ErrCodeView.show(y.enumErrConst.code_3407);break;case"GOLD":if(n.GOLD<o)return f.ErrCodeView.show(y.enumErrConst.code_2101),void m.Switches.ins.event(155);n.GOLD-=o;break;case"LV":if(n.getCurLv()<o)return void f.ErrCodeView.show(y.enumErrConst.code_2102);break;case"OPENDAY":if(((Date.now()/1e3>>0)-ktgameconfig.LoginVo.SvrCreateTime)/86400>o)return void f.ErrCodeView.show(y.enumErrConst.code_2110);break;case"GUILD":if(!v.RoleCenter.instans.ufVo.inFamily)return void _.AM.show(I.TextConst.get(369),Laya.Handler.create(this,function(){m.Switches.ins.event(31)}));break;default:var a=parseInt(t.uselimit[s][0]);if(n.bagdata.getItemCount(a)<o)return void f.ErrCodeView.show(y.enumErrConst.code_2207)}}(u=new d.UseItemC2GS).cfgId=t.id,u.count=e,p.GSM.sendServer(u)}else{if(t.type==C.BagItemType.locked_box){var r=t.effect[1][0],l=t.effect[1][1],h=v.RoleCenter.instans.vo.bagdata.getItemCount(r),c=0;if(0<h&&(c=Math.floor(h/l)),c<e)return void w.FE.upItems(I.TextConst.get(370))}var u;(u=new d.UseItemC2GS).cfgId=t.id,u.count=e,p.GSM.sendServer(u)}},t.prototype.onChangeNum=function(t){var e=parseInt(this.lab_size.text);switch(t){case 0:e<=1?e=1:e-=1;break;case 1:e<this.num&&(e+1>this.iVo.usecount||e++);break;case 2:e=1;break;case 3:e=this.num>this.iVo.usecount?this.iVo.usecount:this.num;break;case 4:e<=10?e=1:e-=10;break;case 5:e+10<=this.iVo.usecount&&e+10<=this.num?e+=10:e=this.num}1==this.iVo.type&&(e=1),this.lab_size.changeText(e+"")},t.prototype.rechangeLSize=function(t){this.box_selectNum.visible=t,this.box_selectNum.layoutEnabled=t,this.box_v.height=this.lab_desc.height+(t?this.box_selectNum.height:0)},t.prototype.rechangeSize=function(){this.height=this.box_v.y+this.box_v.height+20,this.img_bg.height=this.height},t.prototype.onClose=function(){this.close()},t}(ui.custom.DetailsDlg.Details_itemUI);e.Details_Item=l,(r=e.enumUseLimitType||(e.enumUseLimitType={})).PRICERMB="PRICERMB",r.GOLD="GOLD",r.LV="LV",r.OPENDAY="OPENDAY",r.GUILD="GUILD"}),define("src/g/jineng/vo/SkillOpenVo",["require","exports","../../../config/GameConfig"],function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.type=t[i++],this.level=t[i++],this.skillId=t[i++],e[this.type+"_"+this.level]=this},t.getSkillList=function(t){var e=[],i=s.GameConfig.skillOpen;for(var n in i){+n.split("_")[0]==t&&e.push(i[n])}return e},t.getLevelByID=function(t){var e=s.GameConfig.skillOpen;for(var i in e){var n=e[i];if(n.skillId==t)return n.level}return 0},t}();e.SkillOpenVo=i}),define("src/g/custom/detailDlgs/Details_Equip",["require","exports","../../net/messages/sbkEquipIns","../../net/messages/PropFightMain","../../../meta/BlessVo","../../../meta/StoneVo","../../../enum/enumItem","../../net/messages/sbkFormula","../../../utils/ItemUtils","../../../meta/EquipVo","../../../vo/ReXueUtil","src/init/TextConst","../../../config/GameConfig","src/g/Effects/UIEffectsFactory","../../../component/AnimationFrameUI","../../../component/SAnimation","../../../meta/QualiyVo"],function(t,e,_,r,s,f,l,C,I,o,i,y,b,w,S,a,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;return t._fumoSKillIndex=[1,4,7,11],t}return __extends(t,n),t.prototype.initData=function(t,e,i,n){void 0===t&&(t=null),void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=null),this._position=t,this._hvo=n;var s=e||(this._position?this._position.equins:null);if(i&&(s=I.ItemUtils.eVo2Eins(i)),this._equip=s){var o=s.equtemplet;if(this._evo=I.ItemUtils.getEquipVoById(o)||I.ItemUtils.getXwEquipVoById(o)||I.ItemUtils.getSrEquipVoById(o)||I.ItemUtils.getFsEquipVoById(o),this._evo){this.initBaseInfo(),this.initIntensify(),this.initStone(),this.initStoneRefine(),this.initSoul(),this.initShenZhu(),this.initEquip(),this.initFuMo(),this.initZhanwen();var a=I.ItemUtils.getEquipVoById(o);if(a)a.quality>=l.enumItem.orange||this.lab_tip.removeSelf();Laya.timer.frameOnce(1,this,this.changeDlgSize)}}},t.prototype.initHolyDress=function(t){this.lab_name.changeText(t.name),this.lab_name.color=I.ItemUtils.getColorByQuality(t.quality);var e=t.prop[5][1];this.lab_grade.changeText(e+"");var i=C.sbkFormula.calEquipCombat(t.prop[0][1],t.prop[1][1],t.prop[2][1],t.prop[3][1]);this.fightNum.value=i+"",this.lab_lv.changeText(I.ItemUtils.getEquipLv(t.limit)),this.lab_pos.changeText(l.enumItem.arr_fsEquipPosNameNs[t.pos-1]),this.lab_lvInfo.text=y.TextConst.get(364),this.lab_job.changeText(l.enumItem.arr_Job[t.job]),this.item_.img_item.skin=I.ItemUtils.getIconByIconId(t.icon),this.item_.img_quality.skin=I.ItemUtils.getQualitybjByQualityId(t.quality),this.item_.img_fs_job.skin=I.ItemUtils.getfsJobIcon(t.job),this.item_.img_fs_job.visible=!0,this.item_.lab_num.changeText(""),this._evo=new o.EquipVo,this._evo.prop=t.prop,this.initBaseInfo(),this.vbox_intensify.removeSelf(),this.vbox_stone.removeSelf(),this.vbox_soul.removeSelf(),this.vbox_shenzhu.removeSelf(),this.vbox_fumo.removeSelf(),this.vbox_fmProp.removeSelf(),this.vbox_zhanwen.removeSelf(),this.vbox_stoneRefine.removeSelf(),this.lab_tip.visible=!1,Laya.timer.frameOnce(1,this,this.changeDlgSize)},t.prototype.initWing=function(t){this.lab_name.changeText(t.name),this.lab_name.color=I.ItemUtils.getColorByQuality(t.quality),this.lab_grade.changeText(t.combat+""),this.fightNum.value=t.combat+"",this.lab_lv.changeText(y.TextConst.get(363,t.limit)),this.lab_pos.changeText(y.TextConst.get(362)),this.lab_lvInfo.text=y.TextConst.get(364),this.lab_job.changeText(I.ItemUtils.getJobCNById(0)),this.item_.img_item.skin=I.ItemUtils.getIconByIconId(t.icon),this.item_.img_quality.skin=I.ItemUtils.getQualitybjByQualityId(t.quality),this.item_.lab_num.changeText(""),this._evo=new o.EquipVo,this._evo.prop=t.prop,this.initBaseInfo(),this.initIntensify(),this.initStone(),this.initStoneRefine(),this.initSoul(),this.initShenZhu(),this.vbox_fumo.removeSelf(),this.vbox_fmProp.removeSelf(),this.vbox_zhanwen.removeSelf(),this.lab_tip.visible=!1,Laya.timer.frameOnce(1,this,this.changeDlgSize)},t.prototype.initReXue=function(t){var e=i.ReXueUtil.getEquipVoById(t.equtemplet);this.lab_name.changeText(e.name),this.lab_name.color=I.ItemUtils.getColorByQuality(e.quality),this.lab_grade.changeText(t.calEquipCombat()+""),this.changeEquipLv(e.limit,this.lab_lvInfo),this.lab_lv.changeText(I.ItemUtils.getEquipLv(e.limit)),this.lab_pos.changeText(l.enumItem.arr_equipPosName[e.pos]),this.lab_job.changeText(I.ItemUtils.getJobCNById(0)),this.item_.img_item.skin=I.ItemUtils.getIconByIconId(e.icon),this.item_.img_quality.skin=I.ItemUtils.getQualitybjByQualityId(e.quality),this.item_.lab_num.changeText(""),this.fightNum.value=t.calEquipCombat()+"",this._evo=new o.EquipVo,this._evo.prop=e.prop,this.initBaseInfo(),this.initIntensify(),this.initStone(),this.initSoul(),this.initShenZhu(),this.lab_tip.visible=!1,Laya.timer.frameOnce(1,this,this.changeDlgSize)},t.prototype.initEquip=function(){var t=this._evo.quality;0==(t=h.QualityStruct.Ins.transEquipQuality(this._evo))&&(t=1),this.lab_name.changeText(this._evo.name),this.lab_name.color=h.QualityStruct.Ins.getQColorById(t),this.lab_grade.changeText(this._equip.calEquipCombat()+""),this.changeEquipLv(this._evo.limit,this.lab_lvInfo),this.lab_lv.changeText(I.ItemUtils.getEquipLv(this._evo.limit)),this.lab_pos.changeText(l.enumItem.arr_equipPosName[I.ItemUtils.getItemOrEq(this._evo.id).pos]),this.lab_job.changeText(I.ItemUtils.getJobCNById(this._evo.id)),this.item_.img_item.skin=I.ItemUtils.getIconById(this._evo.id),this.item_.img_quality.skin=I.ItemUtils.getQualitybjByQualityId(t),this.item_.lab_num.changeText(""),this.fightNum.value=this.calGrade()},t.prototype.initBaseInfo=function(){for(var t=this._evo.prop,e=this._equip,i=(this._position,0);i<5;i++){var n=this.vbox_base.getChildByName("box_"+i),s=n.getChildByName("ss"),o=n.getChildByName("base"),a=t[i];if(a){var r=a[1];s.visible=!1;var l=0;l=e?e[a[0]]-a[1]:0;var h=I.ItemUtils.getShuXingByName(a[0]);"%"==h.unit&&(r=a[1]/100,l/=100),o.text=h.desc+" : "+r+(l<=0?"":" + "+l)+h.unit,o.visible=!0}else n.removeSelf()}},t.prototype.initIntensify=function(){var t=this._position;if(t&&0!=t.stronglv)for(var e=I.ItemUtils.getEquipEnHanceVoById(1e3*(t.equpos-1)+t.stronglv),i=0;i<4;i++){var n=this.vbox_intensify.getChildByName("lab_"+i),s=e?e.prop[i]:null;e&&s?n.text=I.ItemUtils.getShuXingByName(s[0]).desc+" : "+s[1]:n.removeSelf()}else this.vbox_intensify.removeSelf()},t.prototype.initStone=function(){var t=this._position,e=this.vbox_stone,i=t?t.gemlv:0;if(t&&0!=i){for(var n=[y.TextConst.get(148),y.TextConst.get(149),y.TextConst.get(150),y.TextConst.get(151)],s=I.ItemUtils.getHeroVoById(1),o=s.stone,a=s.stoneMaxNum,r=[],l=0;l<a;l++)r.push(o[(t.equpos-1)*a+l]);var h=i/a>>0,c=i%a,u=null;for(l=0;l<a;l++){var p=e.getChildByName("item_"+l),d=p.getChildByName("lab"),g=p.getChildByName("img");if(u=f.StoneStruct.getStoneVo(r[l],h+(l<c?1:0))){d.color="#149b14";var v=u.prop;d.text="LV."+u.level+"     "+I.ItemUtils.getShuXingByName(v[0][0]).desc+"+"+v[0][1]}else d.text=y.TextConst.get(365,n[r[l]-1]),d.color="#b5a999";u||(u=f.StoneStruct.getStoneVo(r[l],1)),g.skin=I.ItemUtils.getStoneIconByIconId(u.icon)}}else e.removeSelf()},t.prototype.initStoneRefine=function(){this._position;this.vbox_stoneRefine.removeSelf()},t.prototype.initSoul=function(){var t=this._position;if(t&&0!=t.soullv)for(var e=I.ItemUtils.getEquipSoulVoById(1e3*(t.equpos-1)+t.soullv),i=0;i<4;i++){var n=this.vbox_soul.getChildByName("lab_"+i),s=e?e.prop[i]:null;e&&s?n.text=I.ItemUtils.getShuXingByName(s[0]).desc+" : "+s[1]:n.removeSelf()}else this.vbox_soul.removeSelf()},t.prototype.initShenZhu=function(){var t=this._position;if(!this._hvo||0==this._hvo.blessSuitLv&&0==t.shenzhulv)this.vbox_shenzhu.removeSelf();else for(var e=s.BlessStruct.Ins.getVo(t.equpos,this._hvo.blessSuitLv+t.shenzhulv-1).prop,i=0;i<4;i++){var n=this.vbox_shenzhu.getChildByName("lab_"+i);e[i]?n.text=I.ItemUtils.getShuXingByName(e[i][0]).desc+": "+e[i][1]:n.removeSelf()}},t.prototype.initFuMo=function(){var t=!0,e=this._position,i=this.vbox_fmProp;if(e&&this._equip){var n=e.equpos,s=e.fumoLv,o=this._evo.prop;if(this._equip.quality>=_.enumQuality.hong&&this._evo&&5080<=this._evo.limit){t=!1;for(var a,r,l,h=this._fumoSKillIndex.length,c=0,u=0,p=void 0;c<h;){if(r=this["img_fumo_skill"+c],l=this["sp_ani"+c],u=10*(this._fumoSKillIndex[c]+1)+1,(p=b.GameConfig.skillOpen["11_"+(1e3*n+u)])&&(a=I.ItemUtils.getSkillDefItem(p.skillId))&&(r.skin=I.ItemUtils.getSkillIconByIconId(a.icon)),r.disabled=s<u,this.clearFuMoAni(l),u<=s)w.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(l,127+c);else{var d=new S.AnimationFrameUI,g=I.ItemUtils.getUIEffectsVoById(127+c);d.width=g.width,d.height=g.height,d.pivot(g.width/2,g.height/2),d.load(w.UIEffectsFactory.Ins.getSourceUrlById(127+c)),d.gray=!0,d.x=l.pivotX,d.y=l.pivotY,d.alpha=.5,l.addChild(d)}c++}}if(0<s&&this._hvo){var v=this._hvo.getEquipPos_MILTI(n,2)/C.sbkFormula.BASEDIV_VAL;for(c=0;c<4;c++){var f=i.getChildByName("lab_"+c),y=o[c];if(y){var m=I.ItemUtils.getShuXingByName(y[0]);f.text=m.desc+": "+Math.floor(v*y[1])}else f.removeSelf()}}else i.removeSelf()}t&&(this.vbox_fumo.removeSelf(),i.removeSelf())},t.prototype.clearFuMoAni=function(t){for(var e,i=t.numChildren-1;0<=i;){if((e=t.removeChildAt(i))instanceof a.SAnimation){e.stop(),e.clear();break}if(e instanceof S.AnimationFrameUI){e.clear();break}i--}},t.prototype.initZhanwen=function(){var t=this._position,e=this.vbox_zhanwen;if(t&&this._equip){var i=this._evo.prop,n=t.equpos,s=this._hvo?this._hvo.getEquipPos_MILTI(n,1)/C.sbkFormula.BASEDIV_VAL:0;if(0<s)for(var o=0;o<4;o++){var a=e.getChildByName("lab_"+o),r=i[o];if(r){var l=I.ItemUtils.getShuXingByName(r[0]);a.text=l.desc+": "+Math.floor(s*r[1])}else a.removeSelf()}else e.removeSelf()}else e.removeSelf()},t.prototype.calGrade=function(){var t=this._equip,e=t.calEquipCombat(),i=this._position;if(i){var n=i.equpos;e+=C.sbkFormula.calPropFightMainCombat(i.strongPro),e+=C.sbkFormula.calPropFightMainCombat(i.gemPro),e+=C.sbkFormula.calPropFightMainCombat(i.soulPro),e+=C.sbkFormula.calPropFightMainCombat(i.shenzhuPro);var s=this._hvo;if(s){var o=s.getEquipPos_MILTI(n)/C.sbkFormula.BASEDIV_VAL,a=r.PropFightMain.getins();a.HP+=t.HP+o*t.HP,a.ATT+=t.ATT+o*t.ATT,a.PDEF+=t.PDEF+o*t.PDEF,a.SDEF+=t.SDEF+o*t.SDEF,e+=C.sbkFormula.calPropFightMainCombat(a),a.release()}}return e+""},t.prototype.changeDlgSize=function(){for(var t,e=this.vbox_show,i=e.numChildren,n=0,s=0,o=0;n<i;)(t=e.getChildAt(n)).visible&&(t.y=o,o+=t.height,t.width>s&&(s=t.width)),n++;e.width=s,e.refresh(),this.height=e.y+e.height+30+(this.vbox_fumo.parent?40:0),this.img_bg.height=this.height},t.prototype.changeEquipLv=function(t,e){0<Math.floor(t/1e3)?e.changeText(y.TextConst.get(367)):e.changeText(y.TextConst.get(368))},t.prototype.popup=function(t,e){var i=this;Laya.timer.frameOnce(2,this,function(){n.prototype.popup.call(i,t,e)})},t}(ui.custom.DetailsDlg.Details_equipUI);e.Details_Equip=n}),define("src/g/role/vo/SsEVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function s(){}return s.getByPos=function(t){return this.eByType[t]},s.prototype.init=function(t,e){var i=0;this.id=t[i++],this.name=t[i++],this.icon=t[i++],this.limit=t[i++],this.pos=t[i++],this.quality=t[i++],this.suitlv=t[i++],this.prop=t[i++],this.prop2=t[i++],this.split=t[i++],this.worth=t[i++],e[this.id]=this;var n=s.eByType[this.pos];n||(s.eByType[this.pos]=n=[]),n.push(this)},s.eByType={},s}();e.SsEVo=i}),define("src/g/bag/vo/BagDataVo",["require","exports","../../../manager/RoleCenter"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.type=-1,this.isZhanWen=!1,this.isInBag=!1,this.liveTime=-1}return t.prototype.getEquipComBat=function(){if(!this.equVo)return 0;if(this.equVo){var t=i.RoleCenter.instans.vo.bagdata.getEquip(this.equid);return t?t.calEquipCombat():0}},t}();e.BagDataVo=n}),define("src/g/custom/detailDlgs/CardItemDlg",["require","exports","../../../utils/ItemUtils","../../../meta/CardLevel","../../../meta/CardVo","../../../meta/ShuXingVo","../../../manager/RoleCenter","../../../meta/QualiyVo","src/g/clearRes/ClearResM","../../../utils/RoleUtil","src/init/TextConst","src/g/Effects/UIEffectsFactory","src/init/Switches","../../../core/E","../../../enum/EventName"],function(t,e,v,f,y,m,_,C,I,b,w,S,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.btn_use.on(Laya.Event.CLICK,t,t.onClick),t}return __extends(t,e),t.prototype.initData=function(t,e,i){void 0===i&&(i=!1),this.aniId=0,I.ClearResM.resetViewImg(this),this.ivo=t,this.count_txt.text=e+"",this.item_name.color=C.QualityStruct.Ins.getQColorById(t.quality),this.item_name.text=t.name,this.item.img_item.skin=v.ItemUtils.getIconById(t.id),this.item.img_quality.skin=v.ItemUtils.getQualitybjByQualityId(t.quality),this.lvl_txt.text=C.QualityStruct.Ins.getQDesById(t.quality),this.lvl_txt.color=v.ItemUtils.getColorByQuality(t.quality);var n=v.ItemUtils.getCardCompose(t.id);this.img_icon.skin="dynamic/handbook/"+n.itemId+".png",this.img_qual.skin="res/skill/bookImg/qual_"+t.quality+".png";var s=0;switch(t.quality){case 3:s=143;break;case 4:s=144;break;case 5:s=145;break;case 6:s=146}this.aniId=s,this.owner_txt.text=v.ItemUtils.cardListVo(n.type).name;var o=y.CardStruct.Ins.getCardVoByItemId(t.id),a=f.CardLevelStruct.Ins.getVo(o.id,0);this.lab_special.text=o.imgShow||"";for(var r=0;r<a.prop.length;r++){var l=m.ShuXingVo.createSXBox(a.prop[r][0],a.prop[r][1],"#e3cca9",": ","#e3cca9");r%2==0?this.attr_0.addChild(l):this.attr_1.addChild(l)}this.box_fight.setFightNum(3*b.RoleUtil.calFightByProp(a.prop)+o.power);var h=_.RoleCenter.instans.vo.cardData,c=!1;for(r=0;r<h.typeArr.length;r++){var u=h.typeArr[r];if(u.type==o.type){if(-1<u.cardIdArr.indexOf(o.id)){c=!0;break}break}}var p=this.aniSp,d=this.aniId,g=p.getChildByName("ani");c?(this.img_achivate.skin="res/unpack/tujian_yijihuo.png",this.btn_use.label=w.TextConst.get(811),g&&(g.destroy(),g=null),0!=d&&(g||(g=S.UIEffectsFactory.Ins.createSAniAndCenter(p,d,1.4,1.4)))):(this.img_achivate.skin="res/unpack/tujian_weijihuo.png",this.btn_use.label=w.TextConst.get(740),g&&g.destroy()),0==this.lab_special.text.length&&(this.con.y=this.lab_special.y),this.btn_use.visible=i},t.prototype.onClick=function(){n.E.ins.event(s.EventName.USECARD,this.ivo),i.Switches.ins.event(this.ivo.link[2][0],[!1,!0,this.ivo.link[2][1]]),this.close()},t}(ui.bag.tips.CardTipItemUI);e.CardItemDlg=o}),define("src/g/forge_new/view/ZhanWenTips",["require","exports","../../../utils/ItemUtils","../../../meta/ShuXingVo"],function(t,e,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initData=function(t,e){for(var i=a.ItemUtils.getItemVoById(e),n=t["type"+i.effect[0][1]],s=0;s<n.length;s++){var o=r.ShuXingVo.createSXBox(n[s][0],n[s][1]);this.box_attr.addChild(o),this.box_attr.height+=o.height}this.lab_name.text=i.name+" Lv."+t.lv,this.lab_name.color=a.ItemUtils.getColorByQuality(i.quality),this.item_.lab_num.text="",this.item_.img_item.skin=a.ItemUtils.getIconByIconId(i.icon),this.item_.img_quality.skin=a.ItemUtils.getQualitybjByQualityId(i.quality),this.img_bg.height=this.box_attr.x+this.box_attr.height+20,this.lab_tip.y=this.img_bg.height,this.height=this.img_bg.height},e}(ui.forge_new.ZhanWenTipsUI);e.ZhanWenTips=i}),define("src/g/bag/view/BagMini",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.bgview.img_title.skin=t.getTitleUrl(),t.list.itemRender=t.getRender(),t.list.mouseHandler=new Laya.Handler(t,t.mouseHandler),t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t.bgview.btn_close.on(Laya.Event.CLICK,t,t.closeSelf),t}return __extends(t,e),t.prototype.getTitleUrl=function(){return""},t.prototype.getRender=function(){return null},t.prototype.mouseHandler=function(t,e){},t.prototype.renderHandler=function(t,e){},t.prototype.closeSelf=function(t){this.close()},t}(ui.bag.BagMiniUI);e.BagMini=i}),define("src/g/rexue/view/page/ReXueEqChangeDlg",["require","exports","../../../../vo/sbkBagVo","../../../net/messages/sbkEquipIns","../../../../vo/ReXueUtil","../../../../utils/ItemUtils","../../../net/messages/rexue/sbkRXMsg","../../../../manager/GameSocketManager","../../../../manager/RoleCenter","../../../../meta/CommonVo","src/g/bag/tips/view/ItemTips","src/g/bag/vo/BagDataVo","src/g/Effects/UIEffectsFactory","../../../../meta/QualiyVo","src/g/rexue/view/Tips/RxTips_eq","src/g/bag/view/BagMini","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","src/init/TextConst"],function(t,e,r,i,l,h,o,a,c,u,s,p,d,g,v,n,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(e){function n(){var t=e.call(this)||this;return t._heroIdx=0,t._pos=0,t.showArr=[],t.voArr=[],t._cantPutArr=[],t._cantPutVo=[],t.hasTuiJian=!1,t.bgview.img_title.y=5,t}return __extends(n,e),n.prototype.getTitleUrl=function(){return"res/rexue/rexue_biaotiwenzi1.png"},n.prototype.getRender=function(){return ktgame.rexueequip.ReXueChangItem},n.create=function(t,e){var i=new n;i.initData(t,e),i.popup()},n.prototype.initData=function(t,e){this._heroIdx=t,this._pos=e,this.showArr=[],this.voArr=[],this._cantPutArr=[],this._cantPutVo=[];var i=e;5!=e&&6!=e||(i=5),7!=e&&8!=e||(i=6);for(var n=r.sbkBagVo.rxEqArr,s=0;s<n.length;s++){var o=l.ReXueUtil.getEquipVoById(n[s].equtemplet);if(i==o.pos)o.limit<=c.RoleCenter.instans.vo.getCurLv()?(this.showArr.push(n[s]),this.voArr.push(o)):(this._cantPutArr.push(n[s]),this._cantPutVo.push(o))}this.FindMax();var a=l.ReXueUtil.getHeroEqPosIns(c.RoleCenter.instans.vo.getOpenHeroByIdx(t),e);this.hasTuiJian=0<this.showArr.length&&a.combat<this.showArr[0].combat&&this.voArr[0].limit<=c.RoleCenter.instans.vo.getCurLv();for(s=0;s<this._cantPutArr.length;s++)this.showArr.push(this._cantPutArr[s]),this.voArr.push(this._cantPutVo[s]);this._cantPutArr=null,this._cantPutVo=null,this.list.dataSource=this.showArr},n.prototype.FindMax=function(){for(var t=0,e=0,i=0;i<this.showArr.length;i++)0==e&&(e=this.showArr[i].combat),this.showArr[i].combat>e&&(e=this.showArr[i].combat,t=i);if(0!=t){var n=this.showArr[t];this.showArr[t]=this.showArr[0],this.showArr[0]=n,n=this.voArr[t],this.voArr[t]=this.voArr[0],this.voArr[0]=n}},n.prototype.renderHandler=function(t,e){t.img_tuijian.visible=0==e&&this.hasTuiJian;var i=c.RoleCenter.instans.vo.getOpenHeroByIdx(this._heroIdx).rxData,n=i.openPosArr.indexOf(this._pos),s=0!=i.equipArr[n].equins.equid,o=this.showArr[e],a=this.voArr[e];t.setFightNum(o.combat),t.setScore(o.combat),t.setClickedHandler(new Laya.Handler(this,this.onPutOnClick,[o,e])),t.setTipsHandler(new Laya.Handler(this,this.onShowEqTip,[o])),t.item_.setIcon(h.ItemUtils.getIconByIconId(a.icon)),t.item_.setName("","",h.ItemUtils.getQualitybjByQualityId(u.CommonVo.getVoByKey("qulity_rexuejihuo").val2num)),t.item_.setStarSmall(a.id%10),t.item_.setUnLock(!0),t.item_.item.item.item.img_quality.skin=h.ItemUtils.getQualitybjByQualityId(a.quality);var r=g.QualityStruct.Ins.getQEffById(a.quality);d.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.item_.item.item.effect_con,r),t.btn_change.label=s?m.TextConst.get(705):m.TextConst.get(706),t.setTipsHandler(new Laya.Handler(this,this.cellTipHandler,[a,o]))},n.prototype.cellTipHandler=function(t,e){var i=new v.RxTips_eq;i.initData(0,this._pos,null,e,!0),i.popup()},n.prototype.onShowEqTip=function(t){var e=new p.BagDataVo;e.type=i.enumEquipType.rxEquip,e.equid=t.equid,s.ItemTips.ins.showTips(e)},n.prototype.onPutOnClick=function(t,e){var i=c.RoleCenter.instans.vo.getCurLv(),n=this.voArr[e];if(i<n.limit)return f.FE.upItems(m.TextConst.get(871,n.limit/1e3>>0),y.BubbleEnum.center),void this.close();var s=new o.PutonRXEquipC2GS;s.heroIdx=this._heroIdx,s.equipPosArr.push(this._pos),s.equipIdArr.push(t.equid),a.GSM.sendServer(s),this.close()},n}(n.BagMini);e.ReXueEqChangeDlg=_}),define("src/g/itemGets/View/ItemGet_TipItem",["require","exports","../../../core/E","../../../enum/EventName","../../../config/GameConfig","../../../utils/pro/GotoUtil"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(t,e){void 0===e&&(e=0);var i=s.GameConfig.accessCtrlCfg[t];return this.img_icon.skin="dynamic/itemgeticon/"+i.icon+".png",this.lab_tip.text=i.desc,this.on(Laya.Event.CLICK,this,this.onClicked,[t,e]),this},e.prototype.onClicked=function(t,e){"string"==typeof t&&(t=parseInt(t)),o.gotoModuleID(t),i.E.ins.event(n.EventName.OPENMODULEJUMP)},e}(ui.itemGets.ItemGet_TipViewUI);e.ItemGet_TipItem=a}),define("src/g/itemGets/View/ItemGetDlg",["require","exports","../../../meta/MainButtonVo","../../../utils/ItemUtils","src/g/itemGets/View/ItemGet_TipItem","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../net/messages/ShopOperationC2GS","../../../manager/GameSocketManager","../../../manager/ActivityManager","src/init/Switches","../../../component/LayoutUtil"],function(t,e,i,s,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function n(){var t=e.call(this)||this;return t.spent=0,t.bg_view.btn_back.on(Laya.Event.CLICK,t,t.hideView),t.bg_view.btn_close.on(Laya.Event.CLICK,t,t.hideView),a.E.ins.on(r.EventName.OPENMODULEJUMP,t,t.hideView),a.E.ins.on(r.EventName.CLOSE_GETDLG,t,t.hideView),t.btn_pay.visible=window.enabledpay,d.LayoutUtil.layoutBox(t.btn_pay.parent,2),t}return __extends(n,e),n.create=function(t,e){void 0===t&&(t=-1),void 0===e&&(e="");var i=new n;i.initByVo(s.ItemUtils.getItemVoById(t),s.ItemUtils.getCurrencyVoByDefine(e)),i.popup()},n.prototype.initByVo=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=null),this.ivo=t,this.cvo=e,t&&this.renderPage4Ivo(),e&&this.renderPage4Cvo(),null==t&&null==e&&console.error("[error]: ItemGetDlg arg Err, ivo & cvo is null!!"),this},n.prototype.addEvent=function(){this.btn_jia.on(laya.events.Event.CLICK,this,this.onBtnClick,[1,1]),this.btn_jian.on(laya.events.Event.CLICK,this,this.onBtnClick,[0,1]),this.btn_jia10.on(laya.events.Event.CLICK,this,this.onBtnClick,[1,10]),this.btn_jian10.on(laya.events.Event.CLICK,this,this.onBtnClick,[0,10]),this.lab_num.on(Laya.Event.CHANGE,this,this.onNumChange),this.btn_buy.on(Laya.Event.CLICK,this,this.onBuy),this.btn_pay.on(Laya.Event.CLICK,this,this.onPayGold)},n.prototype.onBuy=function(){if(l.RoleCenter.instans.vo.GOLD<parseInt(this.lab_spent.text))this.onPay();else{var t=s.ItemUtils.getShop2VoByItemId(this.ivo.id),e=new h.shopBuyMoreC2GS;e.cfgId=t.id,e.count=parseInt(this.lab_num.text),c.GSM.sendServer(e),this.hideView()}},n.prototype.onPayGold=function(){i.MainButtonStruct.Ins.OpenModule(109),this.hideView()},n.prototype.onPay=function(){p.Switches.ins.event(155)},n.prototype.onBtnClick=function(t,e){var i=parseInt(this.lab_num.text);0==t?i-=e:1==t&&(i+=e),i<=0&&(i=1),999<=i&&(i=999),this.lab_num.text=i+""},n.prototype.onNumChange=function(){this.lab_spent.text=parseInt(this.lab_num.text)*this.spent+""},n.prototype.renderPage4Ivo=function(){if(0!=this.ivo.link.length){if(0!=this.ivo.link[1][1]){var t=s.ItemUtils.getItemVoById(this.ivo.link[1][1]);this.item.img_item.skin=s.ItemUtils.getIconByIconId(t.icon),this.lab_itemName.text=t.name}else this.lab_itemName.text=this.ivo.name,this.item.img_item.skin=s.ItemUtils.getIconByIconId(this.ivo.icon);this.item.lab_num.text="",this.lab_itemName.color=s.ItemUtils.getColorByQuality(this.ivo.quality),this.item.img_quality.skin=s.ItemUtils.getQualitybjByQualityId(this.ivo.quality),this.checkCanBuy(this.ivo.link)}},n.prototype.renderPage4Cvo=function(){this.lab_itemName.text=this.cvo.name,this.item.lab_num.text="",this.lab_itemName.color=s.ItemUtils.getColorByQuality(this.cvo.quality),this.item.img_item.skin=s.ItemUtils.getIconByIconId(this.cvo.icon),this.item.img_quality.skin=s.ItemUtils.getQualitybjByQualityId(this.cvo.quality),this.checkCanBuy(this.cvo.link)},n.prototype.checkCanBuy=function(t){0<t[0][1]?(this.box_buy.visible=!0,this.addEvent(),this.lab_num.text="1",this.spent=t[0][1],this.onNumChange()):(this.box_buy.visible=!1,this.posBox.y=this.box_buy.y);for(var e=2;e<t.length;e++){var i=(new o.ItemGet_TipItem).init(t[e][0],t[e][1]);i.height+=4,this.vbox.addChild(i),this.vbox.height+=i.height}if(window.enabledpay){var n=new Laya.Image;n.width=518,n.height=131,n.skin="res/jiesuan/gg"+(u.ActivityManager.ins.findActivityByCfgId(301)?1:2)+".png",n.restskin(),n.on(Laya.Event.CLICK,this,function(){p.Switches.ins.event(8,[!0,!0,301]),a.E.ins.event(r.EventName.OPENMODULEJUMP)})}this.reChangeDlgSize()},n.prototype.reChangeDlgSize=function(){this.vbox.y=this.posBox.y+this.posBox.height,this.bg_view.height=this.vbox.y+this.vbox.height+5,this.height=this.bg_view.height},n.prototype.hideView=function(){a.E.ins.off(r.EventName.OPENMODULEJUMP,this,this.hideView),a.E.ins.off(r.EventName.CLOSE_GETDLG,this,this.hideView),this.close(),this.ani&&this.ani.stop()},n}(ui.itemGets.ItemGetDlgUI);e.ItemGetDlg=n}),define("src/g/rexue/view/page/ReXueCompSelectDlg",["require","exports","../../../../utils/ItemUtils","../../../../vo/sbkBagVo","../../../../vo/ReXueUtil","../../../../meta/CommonVo","src/g/Effects/UIEffectsFactory","../../../../meta/QualiyVo","src/g/rexue/view/Tips/RxTips_eq","src/g/bag/view/BagMini","src/init/TextConst"],function(t,e,o,p,d,a,l,h,n,i,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(i){function r(){var t=i.call(this)||this;t.hd=null,t.selectedArr=[],t._pos=0,t.rxeqid=0,t.showArr=[],t.voArr=[],t.lab_nullTIp=new Laya.Label(c.TextConst.get(703)),t.bgview.img_title.y=5;var e=t.lab_nullTIp;return e.color="#b79291",e.fontSize=22,e.x=158,e.y=82,t.addChild(e),t}return __extends(r,i),r.prototype.getTitleUrl=function(){return"res/rexue/rexue_biaotiwenzi1.png"},r.prototype.getRender=function(){return ktgame.rexueequip.ReXueChangItem},r.create=function(t,e,i,n,s,o){void 0===o&&(o=!1);var a=new r;a.initData(t,e,i,n,s,o),a.popup()},r.prototype.initData=function(t,e,i,n,s,o){void 0===o&&(o=!1),this._pos=t,this.rxeqid=i,this.selectedArr=n,this.hd=s,this.callbackpos=e,this.showArr=[],this.voArr=[];var a=t,r=p.sbkBagVo.rxEqArr;r.sort(this.sort);for(var l=0;l<r.length;l++){var h=d.ReXueUtil.getEquipVoById(r[l].equtemplet),c=!1;if(a==h.pos){for(var u=0;u<this.selectedArr.length;u++)if(this.selectedArr[u]){if(this.selectedArr[u].equid==r[l].equid){c=!0;break}if(i instanceof Array);else if(h.id!=i){c=!0;break}}c||(i instanceof Array?(this.showArr.push(r[l]),this.voArr.push(h)):h.id==i&&(this.showArr.push(r[l]),this.voArr.push(h)))}}this.list.dataSource=this.showArr,this.lab_nullTIp.visible=0==this.showArr.length},r.prototype.sort=function(t,e){return t.equtemplet-e.equtemplet},r.prototype.renderHandler=function(t,e){var i=this.showArr[e],n=this.voArr[e];t.btn_change.label=c.TextConst.get(704),t.setFightNum(i.combat),t.setScore(i.combat),t.setClickedHandler(new Laya.Handler(this,this.onPutOnClick,[i])),t.item_.setIcon(o.ItemUtils.getIconByIconId(n.icon)),t.item_.setName("","",o.ItemUtils.getQualitybjByQualityId(a.CommonVo.getVoByKey("qulity_rexue").val2num)),t.item_.setStarSmall(n.id%10),t.item_.setUnLock(!0);var s=h.QualityStruct.Ins.getQEffById(n.quality);t.item_.item.item.item.img_quality.skin=o.ItemUtils.getQualitybjByQualityId(n.quality),l.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.item_.item.item.effect_con,s),t.setTipsHandler(new Laya.Handler(this,this.cellTipHandler,[n,i]))},r.prototype.cellTipHandler=function(t,e){var i=new n.RxTips_eq;i.initData(0,this._pos,null,e,!0),i.popup()},r.prototype.onPutOnClick=function(t){this.hd&&this.hd.runWith([t,this.callbackpos]),this.close()},r}(i.BagMini);e.ReXueCompSelectDlg=s}),define("src/g/rexue/view/page/ReXueCompDlg",["require","exports","../../../../manager/LayerManager","../../../../manager/RoleCenter","../../../../vo/ReXueUtil","../../../../vo/ReXueStruct","../../../../utils/ItemUtils","src/g/bag/tips/view/ItemTips","src/g/itemGets/View/ItemGetDlg","src/g/rexue/view/page/ReXueCompSelectDlg","src/g/rexue/view/Tips/RxTips_eq","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../net/messages/rexue/sbkRXMsg","../../../../manager/GameSocketManager","../../../../vo/sbkBagVo","src/init/TextConst"],function(t,e,o,l,h,a,c,r,u,p,d,i,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(s){function n(t,e){void 0===t&&(t=0);var i=s.call(this)||this;i._heroIdx=0,i._pos=0,i.eqSelectArr=[null,null,null],i._heroIdx=t,i._pos=e,i.btn_comp.on(Laya.Event.CLICK,i,i.onCompClick),i.bgview.btn_close.on(Laya.Event.CLICK,i,i.removeSelf),i.rxdata=l.RoleCenter.instans.vo.getOpenHeroByIdx(t).rxData;var n=i.rxdata.openPosArr.indexOf(e);return i._EqPosition=i.rxdata.equipArr[n],i.initView(),i.renderView(),i}return __extends(n,s),n.create=function(t,e){void 0===t&&(t=0);var i=new n(t,e);o.LayerManager.addInPOPWindowLayer(i,!1)},n.prototype.initView=function(){if(0==this._EqPosition.equins.equid){var t=a.ReXueStruct.Ins.getMinLimit();for(this.targetVo=h.ReXueUtil.getEquipVo(this._pos,t);!this.targetVo;)t=a.ReXueStruct.Ins.getNexLimit(t),this.targetVo=h.ReXueUtil.getEquipVo(this._pos,t)}else{var e=h.ReXueUtil.getEquipVoById(this._EqPosition.equins.equtemplet),i=a.ReXueStruct.Ins.getNexLimit(e.limit);for(e=null;!(0==i||e||l.RoleCenter.instans.vo.getCurLv()<i);)(e=h.ReXueUtil.getEquipVo(this._pos,i))||(i=a.ReXueStruct.Ins.getNexLimit(i));this.targetVo=e}this.needArr=this.targetVo.worth,4==this.needArr.length&&(this.eqSelectArr[2]=this._EqPosition.equins),this.targetVo.chance?(this.img_null.visible=!1,this.clip_num.visible=!0,this.clip_num.value=this.targetVo.chance/100+"%"):(this.img_null.visible=!0,this.clip_num.visible=!1);for(var n=0;n<this.needArr.length;n++){var s=this.needArr[n],o=n;this["item_"+n].on(Laya.Event.CLICK,this,this.onItemClick,[s,o])}},n.prototype.onItemClick=function(t,e){var i=c.ItemUtils.getItemVoById(t[0]);if(i){var n=l.RoleCenter.instans.vo.bagdata.getItemCount(i.id);if(n>=t[1])r.ItemTips.ins.showTip(i.id,n);else(new u.ItemGetDlg).initByVo(i,null).popup()}else if(this.eqSelectArr[e-1]){var s=new d.RxTips_eq;s.initData(0,this._pos,null,this.eqSelectArr[e-1],!0),s.popup()}else p.ReXueCompSelectDlg.create(h.ReXueUtil.getEquipVoById(t[0]).pos,e,parseInt(t[0]+""),this.eqSelectArr,Laya.Handler.create(this,this.selectCallback))},n.prototype.selectCallback=function(t,e){this.eqSelectArr[e-1]=t,this.renderView()},n.prototype.renderView=function(){this.renderNeedItem(),this.renderEquip()},n.prototype.renderNeedItem=function(){for(var t=l.RoleCenter.instans.vo,e=0;e<4;e++){var i=this["item_"+e];if(i.setUnLock(!0),this.needArr[e]){var n=c.ItemUtils.getItemVoById(this.needArr[e][0]);if(n){i.setStarSmall(),i.setIcon(c.ItemUtils.getIconByIconId(n.icon));var s=t.bagdata.getItemCount(n.id),o=this.needArr[e][1],a=s+"/"+o;i.setName(a,o<=s?"#03bb00":"#ff0f15",c.ItemUtils.getQualitybjByQualityId(n.quality))}else{var r=h.ReXueUtil.getEquipVoById(this.needArr[e][0]);null==this.eqSelectArr[e-1]?(i.showAdd(!0),i.setIcon("")):(i.showAdd(!1),i.setIcon(c.ItemUtils.getIconByIconId(r.icon))),i.setStarSmall(r.id%10),i.setName(r.name,c.ItemUtils.getColorByQuality(r.quality),c.ItemUtils.getQualitybjByQualityId(r.quality))}1!=e&&2!=e||(i.item.img_red.visible=y.sbkBagVo.hasRxIdEq(this.needArr[e][0])&&!this.eqSelectArr[e-1])}else i.visible=!1}3==this.needArr.length?this.line_left.skin="res/rexue/rxzc_hecheng_nengliang2.png":null!=this.eqSelectArr[2]?this.line_left.skin="res/rexue/rxzc_hecheng_nengliang.png":this.line_left.skin="res/rexue/rxzc_hecheng_di.png",null!=this.eqSelectArr[0]&&null!=this.eqSelectArr[1]?this.line_right.skin="res/rexue/rxzc_hecheng_nengliang.png":this.line_right.skin="res/rexue/rxzc_hecheng_di.png"},n.prototype.renderEquip=function(){this.lab_targeName.text=m.TextConst.get(38,this.targetVo.id%10,this.targetVo.name),this.img_targetIcon.skin=c.ItemUtils.getIconByIconId(this.targetVo.icon),this.img_targetIcon.on(Laya.Event.CLICK,this,this.onShowEqTips,[this.targetVo.id])},n.prototype.onShowEqTips=function(t){r.ItemTips.ins.showTip(t,1)},n.prototype.onCompClick=function(){if(l.RoleCenter.instans.vo.bagdata.getItemCount(this.needArr[0][0])<this.needArr[0][1])i.FE.upItems(m.TextConst.get(838),g.BubbleEnum.center);else{if(4==this.needArr.length){if(-1!=this.eqSelectArr.indexOf(null))return void i.FE.upItems(m.TextConst.get(839),g.BubbleEnum.center)}else if(2!=this.eqSelectArr.indexOf(null))return void i.FE.upItems(m.TextConst.get(839),g.BubbleEnum.center);var t=new v.CompoundRXEquipC2GS;t.pos=this._pos,t.heroIdx=this._heroIdx;for(var e=0;e<this.eqSelectArr.length;e++)this.eqSelectArr[e]&&t.equipIdArr.push(this.eqSelectArr[e].equid);t.equipCfgId=this.targetVo.id,f.GSM.sendServer(t),this.removeSelf()}},n}(ui.rexue.dlg.ReXueEqCompDlgUI);e.ReXueCompDlg=n}),define("src/g/rexue/view/Tips/RxTips_eq",["require","exports","../../../../vo/ReXueUtil","../../../../manager/RoleCenter","../../../../utils/ItemUtils","../../../../config/GameConfig","../../../../meta/ShuXingVo","../../../net/messages/rexue/sbkRXMsg","../../../../manager/GameSocketManager","src/g/rexue/view/page/ReXueEqChangeDlg","src/g/rexue/view/page/ReXueCompDlg","../../../../meta/CommonVo","../../../../utils/RoleUtil","src/init/TextConst","../../../../enum/enumItem"],function(t,e,a,r,p,d,g,n,s,o,l,h,c,v,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(t){var e=i.call(this)||this;return e.isOther=!1,t&&(e.isOther=!0,e.uvo=t),e.isOther?(e.btn_comp.visible=!1,e.btn_change.visible=!1,e.btn_putdown.visible=!1):(e.btn_change.once(Laya.Event.CLICK,e,e.onChange),e.btn_putdown.once(Laya.Event.CLICK,e,e.onPutDown),e.btn_comp.once(Laya.Event.CLICK,e,e.onShowComp)),e}return __extends(t,i),t.prototype.onShowComp=function(){l.ReXueCompDlg.create(this._heroIdx,this._pos),this.close()},t.prototype.onChange=function(){o.ReXueEqChangeDlg.create(this._heroIdx,this._pos),this.close()},t.prototype.onPutDown=function(){var t=new n.PutoutRXEquipC2GS;t.pos=this._pos,t.heroIdx=this._heroIdx,s.GSM.sendServer(t),this.close()},t.prototype.initData=function(t,e,i,n,s,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=null),void 0===n&&(n=null),void 0===s&&(s=!1),void 0===o&&(o=!1),this._heroIdx=t,this._pos=e,this.isOther?this.rxData=this.uvo.openhero[t].rxData:this.rxData=r.RoleCenter.instans.vo.getOpenHeroByIdx(t).rxData,this._eqpos=i,this._eqins=n||i.equins,this.orVo=a.ReXueUtil.getEquipVoById(n.equtemplet),this.isOther||(this.btn_change.visible=!s,this.btn_putdown.visible=!s,this.btn_comp.visible=o),i||(this.height=this.img_tipsbg.height=550),this.renderTip(),0==n.equid?this.box_fight.setFightNum(c.RoleUtil.calFightByProp(this.orVo.prop)+this._eqins.getSpecialPropCombat()):this.box_fight.setFightNum(this._eqins.combat),this.clip_score.value=this.box_fight.num_Fight.value},t.prototype.renderTip=function(){this.renderBase(),this.renderProp(),this.renderYuanSu(),this.renderStone(),this.renderSuit()},t.prototype.renderBase=function(){this.lab_name.text=this.orVo.name,this.lab_name.color=p.ItemUtils.getColorByQuality(h.CommonVo.getVoByKey("qulity_rexuejihuo").val2num),this.lab_job.text=v.TextConst.get(118),this.lab_pos.text=u.enumItem.arr_equipPosName[this.orVo.pos],this._item.setIcon(p.ItemUtils.getIconByIconId(this.orVo.icon)),this._item.setUnLock(!0),this._item.setStarSmall(this.orVo.id%10),this.lab_limit.text=p.ItemUtils.getLv(this.orVo.limit),this._item.setName("","",p.ItemUtils.getQualitybjByQualityId(h.CommonVo.getVoByKey("qulity_rexuejihuo").val2num)),this._item.item.item.item.img_quality.skin=p.ItemUtils.getQualitybjByQualityId(this.orVo.quality)},t.prototype.renderProp=function(){for(var t=this.orVo.prop.length,e=0;e<6;e++){var i=this["attr_"+e];if(t<=e)i.removeSelf();else if(this.orVo.prop[e]){var n=this.orVo.prop[e],s=i.getChildByName("sname"),o=i.getChildByName("svalue"),a=p.ItemUtils.getShuXingByName(n[0]);s.text=a.desc+":";var r=n[1];"%"==a.unit?(r=n[1]/100,o.text=r+"%"):o.text=r+""}}},t.prototype.renderYuanSu=function(){var t=this._eqins.specialPropArr;if(0!=t.length)for(var e=0;e<10;e++){var i=t[e],n=this.box_yuansu.getChildByName("sname_"+e);if(i){var s=d.GameConfig.rexue_attr[i.id];n.text=s.desc+": "+(1==s.type?i.value/100:i.value)+(1==s.type?"%":""),n.color=p.ItemUtils.getColorByQuality(s.quality)}else n.removeSelf()}else this.box_yuansu.removeSelf()},t.prototype.renderStone=function(){if(this._eqpos){for(var t=!1,e=0;e<this._eqpos.stoneIdArr.length;e++)0<this._eqpos.stoneIdArr[e]&&(t=!0);if(t){this.lab_stoneTitle.text=v.TextConst.get(714);for(e=0;e<this._eqpos.stoneIdArr.length;e++){var i=this._eqpos.stoneIdArr[e],n=this.box_stone.getChildByName("box_"+e);if(0!=i){var s=d.GameConfig.rexue_stone[i],o=n.getChildByName("icon"),a=n.getChildByName("des");o.skin=p.ItemUtils.getIconByIconId(s.icon);var r="";r+=s.name;for(var l=0;l<s.prop.length;l++){var h=s.prop[l],c=p.ItemUtils.getShuXingByName(h[0]),u=h[1];r+="    "+c.desc+":"+g.ShuXingVo.getString4Vo(u,c)}a.text=r}else n.removeSelf()}}else this.box_stone.removeSelf()}else this.box_stone.removeSelf()},t.prototype.renderSuit=function(){this.renderSuitByShenBing(),this.renderSuitByShouHu()},t.prototype.renderSuitByShenBing=function(){var t=d.GameConfig.rexue_suit[this.rxData.curType1SuitId||1];this._eqpos?this.suit_shenbing.initItems(a.ReXueUtil.getReXueSuitPosArr_shenbing(this._heroIdx,this.rxData.curType1SuitId/2>>1,this.uvo),u.enumItem.arr_equipPosNameRx):this.suit_shenbing.removeSelf(),this.lab_shenbingTitle.text=t.name;for(var e=t.prop,i=0;i<10;i++){var n=this.box_shenbing.getChildByName("sname_"+i);if(e[i]){var s=p.ItemUtils.getShuXingByName(e[i][0]),o=e[i][1];n.text=s.desc+" : "+g.ShuXingVo.getString4Vo(o,s)}else n.removeSelf()}},t.prototype.renderSuitByShouHu=function(){var t=d.GameConfig.rexue_suit[this.rxData.curType2SuitId||2];this._eqpos?this.suit_shouhu.initItems(a.ReXueUtil.getReXueSuitPosArr_shouhu(this._heroIdx,this.rxData.curType2SuitId/2>>0,this.uvo),u.enumItem.arr_equipPosNameRx):this.suit_shouhu.removeSelf(),this.suit_shouhu.initItems(a.ReXueUtil.getReXueSuitPosArr_shouhu(this._heroIdx,this.rxData.curType2SuitId/2>>0,this.uvo),u.enumItem.arr_equipPosNameRx),this.lab_shouhutitle.text=t.name;for(var e=t.prop,i=0;i<10;i++){var n=this.box_shouhu.getChildByName("sname_"+i);if(e[i]){var s=p.ItemUtils.getShuXingByName(e[i][0]),o=e[i][1];n.text=s.desc+" : "+g.ShuXingVo.getString4Vo(o,s)}else n.removeSelf()}},t}(ui.rexue.tips.RxTips_EqUI);e.RxTips_eq=i}),define("src/g/shenbing/view/dlg/SbBag",["require","exports","../../../../utils/ItemUtils","../../../../vo/sbkBagVo","../../../../enum/BagItemType","src/g/shenbing/view/dlg/SbDetail_Equip","../../../net/messages/sbkShenBingData","../../../../manager/GameSocketManager","../../../../config/GameConfig","src/g/bag/view/BagMini","src/init/TextConst","../../../../utils/ItemCellUtils"],function(t,e,s,o,a,r,l,h,c,i,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t,e){var i=n.call(this)||this;return i.bgview.img_title.y=5,i.idx=e,i.job=t,i.updateData(),h.GSM.ins.on(l.SetSBEquipMsg.KEY,i,i.receiveMsg),i}return __extends(t,n),t.prototype.getTitleUrl=function(){return"res/shenbing/shenbing/shenbing_shengwutihuanbiaoti.png"},t.prototype.getRender=function(){return ui.shenbing.item.SbItemChangeEqUI},t.prototype.closeSelf=function(t){n.prototype.closeSelf.call(this,t),h.GSM.ins.off(l.SetSBEquipMsg.KEY,this,this.receiveMsg)},t.prototype.receiveMsg=function(t){switch(t.msgKey){case l.SetSBEquipMsg.KEY:this.isSend=!1}},t.prototype.mouseHandler=function(t,e){var i=t.target,n=t.currentTarget;if(t.type==Laya.Event.CLICK){var s=this.equips[e];if(i==n.preview){var o=new r.SbDetail_Equip;o.initData(s.ItmVo,1),o.popup()}else if(i==n.btn_change&&c.GameConfig.sb_equip[s.id].job==this.job){if(this.isSend)return;this.isSend=!0;var a=new l.SetSBEquipMsg;a.job=this.job,a.idx=this.idx,a.itemId=s.id,h.GSM.sendServer(a),this.close()}}},t.prototype.renderHandler=function(t,e){var i=this.equips[e],n=i.ItmVo;p.ItemCellUtils.fillSbItem(t.preview,n),t.lab_name.color=s.ItemUtils.getQualityColorById(n.id),t.lab_name.text=n.name,t.lab_count.text=u.TextConst.get(92,i.num)},t.prototype.updateData=function(){for(var t=o.sbkBagVo.getBagVoArrByType(a.BagItemType.shenbingshengwu),e=0;e<t.length;e++){var i=t[e];c.GameConfig.sb_equip[i.ItmVo.id].job!=this.job&&(t.splice(e,1),e--)}t.sort(function(t,e){return t.ItmVo.quality<e.ItmVo.quality?1:-1}),this.equips=t,this.list.array=t},t}(i.BagMini);e.SbBag=n}),define("src/g/shenbing/view/dlg/UpTianFuDlg",["require","exports","../../../net/messages/sbkShenBingData","../../../../manager/RoleCenter","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../manager/GameSocketManager","../../../../core/E","../../../../enum/EventName","../../../../utils/SbUtils","src/g/clearRes/ClearResM","../../../../runtime/resload/GameResLoad","src/init/TextConst"],function(t,e,s,l,o,a,r,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function n(){var t=i.call(this)||this;t.nowJob=0,t.id=0,t._nowLv=0,t.url="res/atlas/res/rexue.json",d.GameResLoad.load(t.url),t.btn_upLv.on(Laya.Event.CLICK,t,t.onUp),h.E.ins.on(c.EventName.SHENBING_TIANFU_UPLV,t,t.onShenbingUp);var e=t.lab_desc;return e.style.font="SimHei",e.style.fontSize=18,e.style.color="#ccb694",e.style.align="left",e.style.leading=5,e.style.wordWrap=!0,t}return __extends(n,i),n.create=function(t,e){var i=new n;i.initData(t,e),i.popup()},n.prototype.initData=function(t,e){var i=l.RoleCenter.instans.vo.shenbing;this.nowJob=t,this.id=e;var n=i.oneArr[i.jobArr.indexOf(t)],s=(this._one=n).giftArr,o=s.indexOf(e);if(-1==o)this._nowLv=1;else{var a=u.SbUtils.getTianFuVo(e),r=a.ATT_num1;0==r.length&&(r=a.ATT_num2),this._nowLv=s[o+1]+1}this.vo=u.SbUtils.getTianFuVo(e),this.extraLv=u.SbUtils.getExtLvBySbData(n)[this.vo.id]||0,this.renderView()},n.prototype.renderView=function(){this.renderSkill(),this.renderNeed(),this.renderBtn()},n.prototype.renderSkill=function(){this.lab_title.text=this.vo.name,this.img_skill.skin=u.SbUtils.getTianfuIcon(this.vo.icon),this.lab_desc.innerHTML=u.SbUtils.getSbTianfuDesStrByStr(this.id,this._nowLv+this.extraLv)},n.prototype.renderNeed=function(){this.lab_tianfudian.text=this._one.giftCount+"",this.lab_lv.text=this._nowLv-1+this.extraLv+"/"+(this.vo.maxlv+this.extraLv)},n.prototype.renderBtn=function(){var t=this._nowLv-1+this.extraLv>=this.vo.maxlv+this.extraLv;this.btn_upLv.label=t?(this.btn_upLv.disabled=!0,g.TextConst.get(208)):(this.btn_upLv.disabled=!1,g.TextConst.get(615))},n.prototype.onShenbingUp=function(){this.initData(this.nowJob,this.id)},n.prototype.close=function(){p.ClearResM.clearUrl(this.url),h.E.ins.off(c.EventName.SHENBING_TIANFU_UPLV,this,this.onShenbingUp),this.btn_upLv.offAll(),i.prototype.close.call(this)},n.prototype.onUp=function(){if(this._one.giftCount<1)o.FE.upItems(g.TextConst.get(744),a.BubbleEnum.center);else{var t=u.SbUtils.checkTf(this.vo.qianzhi_id,this._one.giftArr);if(t.qianzhi)if(t.lvMax){var e=new s.AddSBGiftMSG;e.job=this.nowJob,e.curGiftId=this.id,e.curLv=this._nowLv-1,r.GSM.sendServer(e)}else o.FE.upItems(g.TextConst.get(746),a.BubbleEnum.center);else o.FE.upItems(g.TextConst.get(745),a.BubbleEnum.center)}},n}(ui.shenbing.dlg.UpTianFuDlgUI);e.UpTianFuDlg=i}),define("src/g/shenbing/view/dlg/UpShenBingDlg",["require","exports","../../../../manager/RoleCenter","../../../../utils/ItemUtils","src/g/bag/tips/view/ItemTips","src/g/itemGets/View/ItemGetDlg","../../../net/messages/sbkShenBingData","../../../../manager/GameSocketManager","src/init/Switches","../../../../core/E","../../../../enum/EventName","../../../../utils/SbUtils","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","src/init/TextConst"],function(t,e,s,c,o,a,r,l,i,h,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function n(){var t=e.call(this)||this;return t.nowJob=0,t.itemCount=1,t.hasNum=0,t._ctime=0,t._isAuto=!1,t.item_bar.on(Laya.Event.COMPLETE,t,t.barTweenComp),t.on(Laya.Event.MOUSE_UP,t,t.onStopAutoAdd),t.lab_getitem.on(Laya.Event.CLICK,t,t.onGetItem),t.bgview.btn_close.once(Laya.Event.CLICK,t,t.close),h.E.ins.on(u.EventName.CHANGEITEM_COUNT,t,t.onItemChange),h.E.ins.on(u.EventName.OPENMODULEJUMP,t,t.close),l.GSM.ins.on(r.AddSBExpGS2C.KEY,t,t.addExp),t.item_bar.setType(1),t.btn_use.handler=new Laya.Handler(t,t.checkSend),t}return __extends(n,e),n.prototype.addExp=function(t){this.renderTianFuLvBar(),this.changeNum(100)},n.prototype.barTweenComp=function(t){var e=p.SbUtils.getSbExpVo(t);if(e){var i=e.egg;0<i&&d.FE.upItems(v.TextConst.get(94,i),g.BubbleEnum.center),this.changeNLT(t)}},n.create=function(t,e){var i=new n;i.initData(t,e),i.popup()},n.prototype.updateBtnEnable=function(){var t=this._one.lv;this.btn_use.disabled=!p.SbUtils.getSbExpVo(t+1)},n.prototype.renderTianFuLvBar=function(t){void 0===t&&(t=!1);var e=this._one,i=e.lv,n=this.item_bar;n.setLv(i),t&&this.changeNLT(i),n.setTfBar(e.giftCount,100);var s=p.SbUtils.getSbExpVo(i).exp;n.setExpBar(e.exp,s,this.nowJob,e.lv),this.updateBtnEnable()},n.prototype.setNextInfo=function(t,e,i){void 0===i&&(i=0),t.tfd_lab.innerHTML=-1==e?v.TextConst.get(208):v.TextConst.get(856,e,i)},n.prototype.changeNLT=function(t){var e=this.item_bar,i=p.SbUtils.getSbExpVo(t+1);if(i){for(var n=0,s=0;i;)if(t++,n++,!(i=p.SbUtils.getSbExpVo(t))||i&&0<i.egg){s=i.egg;break}this.setNextInfo(e,n,s)}else this.setNextInfo(e,-1)},n.prototype.onItemChange=function(t){220==t&&this.refresh()},n.prototype.onStopAutoAdd=function(){this._ctime=0,this._isAuto=!1,Laya.timer.clearAll(this)},n.prototype.onGetItem=function(){i.Switches.ins.event(189,[!1,!0]),this.close()},n.prototype.refresh=function(){this.hasNum=this.bag.getItemCount(220),this.lab_has.text=v.TextConst.get(103,this.hasNum)},n.prototype.initData=function(t,e){this.bag=s.RoleCenter.instans.vo.bagdata,this.nowJob=t,this._one=e,this.updateBtnEnable(),this.refresh(),this.renderTianFuLvBar(!0);var i=c.ItemUtils.getItemVoById(220);this.item_.img_item.skin=c.ItemUtils.getIconByIconId(i.icon),this.item_.img_quality.skin=c.ItemUtils.getQualitybjByQualityId(i.quality),this.item_.lab_num.text="",this.item_.on(Laya.Event.CLICK,this,function(){o.ItemTips.ins.showTip(220,1)}),this.changeNum(0)},n.prototype.changeNum=function(t){var e=t;this._isAuto&&(this._ctime+=100,2e3<this._ctime?e*=2:3e3<this._ctime?e*=3:4e3<this._ctime?e*=4:5e3<this._ctime&&(e*=5));var i=this.hasNum,n=this.itemCount;switch(t){case 0:n=0<i?this.updateUseCount():0;break;case 1:case-1:var s=n+e;s<=i&&99<=(n+=e)&&(n=99),s<=0&&0<i&&(n=1);break;case 100:n=this.updateUseCount()}this.itemCount=n},n.prototype.updateUseCount=function(){var t=this._one,e=t.lv,i=c.ItemUtils.getItemVoById(220),n=1,s=p.SbUtils.getSbExpVo(e+1),o=i.effect[0][1],a="",r=this.hasNum,l=!1;if(s){var h=s.exp-t.exp;o<=h&&r<(n=Math.ceil(h/o))&&(n=r),a=v.TextConst.get(959,n)}else n=0,a=v.TextConst.get(208),l=!0;return this.btn_use.disabled=l,this.useDesc.text=a,n},n.prototype.checkSend=function(){var t=this.itemCount,e=c.ItemUtils.getItemVoById(220);if(this.hasNum>=t&&0<t){var i=new r.AddSBExpC2GS;return i.job=this.nowJob,i.itemId=220,i.count=t,l.GSM.sendServer(i),d.FE.upItems(v.TextConst.get(97,t*e.effect[0][1]),g.BubbleEnum.center),!0}return(new a.ItemGetDlg).initByVo(e,null).popup(),!1},n.prototype.close=function(){this.onStopAutoAdd(),l.GSM.ins.off(r.AddSBExpGS2C.KEY,this,this.addExp),h.E.ins.off(u.EventName.CHANGEITEM_COUNT,this,this.onItemChange),h.E.ins.off(u.EventName.OPENMODULEJUMP,this,this.close),e.prototype.close.call(this)},n}(ui.shenbing.dlg.UpShenBingDlgUI);e.UpShenBingDlg=n}),define("src/g/shenbing/view/dlg/SbswHecheng",["require","exports","../../../../vo/sbkBagVo","../../../../enum/BagItemType","../../../../config/GameConfig","../../../../utils/ItemUtils","../../../../utils/system/FloatEffect","../../../net/messages/sbkShenBingData","../../../../manager/GameSocketManager","src/g/shenbing/view/dlg/SbDetail_Equip","../../../net/messages/InventoryAddGS2C","src/g/Effects/UIEffectsFactory","../../../net/messages/sbkEquipIns","src/init/TextConst","../../../../utils/ItemCellUtils"],function(t,e,i,o,a,r,s,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t.items=[0,0,0],t.list_.scrollBar.elasticDistance=200,t.list_.mouseHandler=new Laya.Handler(t,t.mouseHandler),t.list_.renderHandler=new Laya.Handler(t,t.renderHandler),t.on(Laya.Event.UNDISPLAY,t,t.removeHandler),t.btn_comp.on(Laya.Event.CLICK,t,t.hechengHandler),t.box_auto.on(Laya.Event.CHANGE,t,t.changeAuto),t.btn_close.on(Laya.Event.CLICK,t,function(){this.close()});var e=h.GSM.ins;e.on(u.InventoryAddGS2C.KEY,t,t.receiveMsg),e.on(l.CompoundSBEquipMsg.KEY,t,t.receiveMsg),t.resultItem.on(Laya.Event.CLICK,t,t.clickResult);for(var i=0;i<3;i++)t["item_"+i].on(Laya.Event.CLICK,t,t.selectItemFunc,[i]),v.ItemCellUtils.fillSbItem(t["item_"+i],null);return t.resetResult(),t.updateData(),t}return __extends(t,n),t.prototype.changeAuto=function(){this.autoSelect(this.box_auto.selected)},t.prototype.clickResult=function(t){if(t.currentTarget.item.item.img_occupation.visible&&0<this.rewardItemId){var e=new c.SbDetail_Equip;e.initData(r.ItemUtils.getItemVoById(this.rewardItemId),1),e.popup()}},t.prototype.removeHandler=function(){var t=h.GSM.ins;t.off(u.InventoryAddGS2C.KEY,this,this.receiveMsg),t.off(l.CompoundSBEquipMsg.KEY,this,this.receiveMsg)},t.prototype.receiveMsg=function(t){switch(t.msgKey){case u.InventoryAddGS2C.KEY:for(var e=t.itemList,i=0;i<e.length;i+=2)if(r.ItemUtils.getItemVoById(e[i]).type==o.BagItemType.shenbingshengwu){this.updateData();break}break;case l.CompoundSBEquipMsg.KEY:p.UIEffectsFactory.Ins.playAniOnce(68,this);var n=t.itemIdArr.length,s=t.rewardItemId;for(i=0;i<n;i++)this.updateNeedItem(!1,i);v.ItemCellUtils.fillSbItem(this.resultItem,r.ItemUtils.getItemVoById(s)),this.rewardItemId=s,this.updateData(),this.autoSelect(this.box_auto.selected)}},t.prototype.autoSelect=function(t){if(void 0===t&&(t=!1),t){var e,i,n=this.shengwuEquips,s=n.length,o=!1,a=d.enumQuality.lan;if(0!=s){for(;!o;){e=[];for(var r=i=0;r<s;r++){var l=n[r];if(l.ItmVo.quality==a){for(var h=0;h<l.num;h++)if(e[i]=r,3<=++i){o=!0;break}if(o)break}}if(a>=d.enumQuality.jin){o=!1;break}if(o)break;a++}if(o){if(this.getQual()>d.enumQuality.bai)return;this.resetResult();for(r=0;r<3;r++)this.updateNeedItem(!1,r);for(r=0;r<e.length;r++)this.updateNeedItem(!0,e[r]);this.list_.refresh()}}}},t.prototype.selectItemFunc=function(t,e){0!=this.items[t]&&(this.updateNeedItem(!1,t),this.list_.refresh())},t.prototype.updateData=function(){var t=i.sbkBagVo.getBagVoArrByType(o.BagItemType.shenbingshengwu);t.sort(function(t,e){return t.ItmVo.quality-e.ItmVo.quality}),this.shengwuEquips=t,this.list_.array=t},t.prototype.resetResult=function(){var t=this.resultItem;v.ItemCellUtils.fillSbItem(t,null),t.img_lock.visible=!1,t.item.item.img_occupation.visible=!1,this.rewardItemId=0},t.prototype.mouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.shengwuEquips[e].num,n=this.getFzCount();if(i<=0||3==n)return;0==n&&this.resetResult(),this.updateNeedItem(!0,e),this.list_.refresh()}},t.prototype.updateNeedItem=function(t,e){for(var i=this.items,n=i.length,s=this.shengwuEquips,o=0;o<n;o++){var a=i[o];if(t){if(0==a){var r=s[e].ItmVo;v.ItemCellUtils.fillSbItem(this["item_"+o],r),i[o]=r.id,s[e].num--;break}}else if(o==e){for(var l=s.length,h=0;h<l;h++)if(a==s[h].id){s[h].num++;break}i[o]=0,v.ItemCellUtils.fillSbItem(this["item_"+o],null);break}}},t.prototype.getFzCount=function(){for(var t=this.items,e=t.length,i=0,n=0;n<e;n++)0!=t[n]&&i++;return i},t.prototype.getQual=function(){for(var t,e=this.items,i=e.length,n=0;n<i;n++)if(0!=e[n]){var s=a.GameConfig.sb_equip[e[n]];isNaN(t)?t=s.quality:s.quality!=t&&(t=-1)}return isNaN(t)&&(t=0),t},t.prototype.hechengHandler=function(t){var e=this.getFzCount(),i=this.getQual();if(3==e)if(-1!=i)if(i>=d.enumQuality.jin)s.FE.upItems(g.TextConst.get(743),2);else{var n=new l.CompoundSBEquipMsg;n.itemIdArr=this.items,h.GSM.sendServer(n)}else s.FE.upItems(g.TextConst.get(742),2);else s.FE.upItems(g.TextConst.get(741),2)},t.prototype.renderHandler=function(t,e){var i=t.dataSource,n=i.id;t.lab_lv.text=i.ItmVo.name,t.item0.img_occupation.skin="res/indexicon/red_point.png",t.item0.img_occupation.visible=r.ItemUtils.getCanUseByItemId(n),t.lab_lv.color=r.ItemUtils.getQualityColorById(n),t.item0.item.img_quality.skin=r.ItemUtils.getQualityBjById(n),t.item0.item.img_item.skin=r.ItemUtils.getIconById(n);var s=t.item0.lab_num,o=i.num;s.visible=1<o&&(s.text=o+"",!0),t.disabled=o<=0},t}(ui.shenbing.dlg.SbswHechengUI);e.SbswHecheng=n}),define("src/g/shenbing/view/subpage/Sb_SkillPage",["require","exports","../../../net/messages/sbkShenBingData","../../../../manager/RoleCenter","src/g/shenbing/view/dlg/UpTianFuDlg","../../../../manager/AM","../../../../manager/GameSocketManager","src/g/shenbing/view/dlg/UpShenBingDlg","src/g/shenbing/view/dlg/SbDetail_Equip","../../../../utils/SbUtils","../../../../config/GameConfig","../../../../utils/system/FloatEffect","src/g/shenbing/view/dlg/SbswHecheng","../../../../utils/ItemUtils","src/g/shenbing/view/dlg/SbBag","../../../../plugin/sbkPropTool","src/g/Effects/UIEffectsFactory","../../../../enum/EventName","src/g/clearRes/ClearResM","../../../../vo/RedDot/Reddot_shenbing","../../../../utils/RoleUtil","src/init/TextConst","../../../../utils/ItemCellUtils","../../../../core/E"],function(t,e,u,p,i,n,s,o,a,C,d,l,h,c,g,v,I,f,y,m,_,b,w,S){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function r(){var t=e.call(this)||this;return t.nowJob=0,t._skillPoss={1:{x:[60,135,120,239,212,287,244,340,325,374,393,447,531,498],y:[530,460,367,494,325,412,232,274,158,364,87,275,211,104]},2:{x:[60,135,120,239,212,287,244,340,325,374,393,447,531,498],y:[530,460,367,494,325,412,232,274,158,364,87,275,211,104]},3:{x:[60,135,120,239,212,287,244,340,325,374,393,447,531,498],y:[530,460,367,494,325,412,232,274,158,364,87,275,211,104]}},t.addEvent(),t}return __extends(r,e),r.prototype.addEvent=function(){this.btn_upLv.on(Laya.Event.CLICK,this,this.onUpLvClick),this.lab_reset.on(Laya.Event.CLICK,this,this.onReSetTianFu),this.changePage.on(Laya.Event.CLICK,this,this.onChangePage),this.hecheng.on(Laya.Event.CLICK,this,this.hechengClick);for(var t=0;t<14;t++)this["tf_"+t].on(Laya.Event.CLICK,this,this.onTianFuClick,[t]);for(t=0;t<6;t++)this["item"+t].on(Laya.Event.CLICK,this,this.onShengwuClick,[t]);var e=s.GSM.ins;e.on(u.CompoundSBEquipMsg.KEY,this,this.receiveMsg),e.on(u.SetSBEquipMsg.KEY,this,this.receiveMsg),this.on(Laya.Event.UNDISPLAY,this,this.onRemoved),S.E.ins.on(f.EventName.SHENBING_COMBAT_ADD,this,this.renderSBTotalCombat)},r.prototype.onRemoved=function(){this.type=NaN;for(var t=C.SbUtils.getArr_TianFuByJob(this.nowJob),e=0;e<t.length;e++)Laya.Tween.clearTween(this["tf_"+e+"j"]);this.isTween=!1,S.E.ins.off(f.EventName.SHENBING_COMBAT_ADD,this,this.renderSBTotalCombat)},r.prototype.receiveMsg=function(t){var e=d.GameConfig.sb_equip;switch(t.msgKey){case u.CompoundSBEquipMsg.KEY:for(var i=t.itemIdArr,n=i.length,s=t.rewardItemId,o=0;o<n;o++)p.RoleCenter.instans.vo.chgItemCount(i[o],-1);p.RoleCenter.instans.vo.chgItemCount(s,1),m.Reddot_shenbing.Ins.reCheckTask(),this.updateShengwu();break;case u.SetSBEquipMsg.KEY:var a=t.itemId;p.RoleCenter.instans.vo.chgItemCount(a,-1);var r=this._one.equipArr,l=r[t.idx]||0,h=0;0!=l&&(h=e[l].power+_.RoleUtil.calFightByProp(e[l].prop),p.RoleCenter.instans.vo.chgItemCount(l,1)),m.Reddot_shenbing.Ins.reCheckTask(),r[t.idx]=a,v.sbkPropTool.reSetAllShenBing(),p.RoleCenter.instans.vo.reCheckComBat(),this.updateShengwu();var c=e[a].power+_.RoleUtil.calFightByProp(e[a].prop);0!=h&&(c-=h),p.RoleCenter.instans.event(f.EventName.FIGHT_UP,c),this.renderSBTotalCombat(v.sbkPropTool.reSetShenBingByJob(t.job))}},r.prototype.hechengClick=function(){(new h.SbswHecheng).popup()},r.prototype.onChangePage=function(){var t=this.type;isNaN(t)?this.type=t=r.openType:this.type=t=0==t?1:0;var e=this.nowJob,i="res/bg/shenbing_tianfu_beijing",n="res/shenbing/shenbing/",s=!1;switch(t){case 0:this.bg_1.skin=i+(e+"_1.jpg"),this.changePage.skin=n+"shenbing_anniu_shengwu.png",this.tianfu.visible=!0,this.zhuangbei.visible=!1,this.renderSkill();var o=this.tfUp;o||(this.tfUp=o=I.UIEffectsFactory.Ins.createSAniAndCenter(this.btn_upLv,42,1.6));var a=!1;m.Reddot_shenbing.Ins._isUp[e-1]&&(a=!0),m.Reddot_shenbing.Ins._isZb[e-1]&&(s=!0),o.visible=a;break;case 1:this.changePage.skin=n+"shenbing_anniu_tianfu.png",this.bg_1.skin=i+(e+"_2.jpg"),this.tianfu.visible=!1,this.zhuangbei.visible=!0,m.Reddot_shenbing.Ins._isUp[e-1]&&(s=!0),this.updateShengwu()}this.img_red.visible=s,this.renderTianFuLvBar(),this.renderSBTotalCombat(v.sbkPropTool.reSetShenBingByJob(e))},r.prototype.updateShengwu=function(){for(var t=this._one,e=this.nowJob,i=t.lv,n=d.GameConfig.commonJson.shengwupos.value.split(","),s=n.length,o=0;o<s;o++){var a=this["item"+o],r=+n[o];if(w.ItemCellUtils.fillSbItem(a,null),r<=i){var l=t.equipArr[o]||0;0!=l?w.ItemCellUtils.fillSbItem(a,c.ItemUtils.getItemVoById(l)):m.Reddot_shenbing.Ins._isZb[e-1]&&(a.item.img_red.visible=!0)}else a.img_lock.visible=!0,a.item.lab_name.text=b.TextConst.get(25,r)}},r.prototype.onShengwuClick=function(t,e){var i=this._one,n=d.GameConfig.commonJson.shengwupos.value.split(",");if(i.lv>=+n[t]){var s=i.equipArr[t]||0;if(0!=s){var o=new a.SbDetail_Equip(this.nowJob,t);o.initData(c.ItemUtils.getItemVoById(s),1,1),o.popup()}else new g.SbBag(this.nowJob,t).popup()}else l.FE.upItems(b.TextConst.get(747),2)},r.prototype.onUpLvClick=function(){o.UpShenBingDlg.create(this.nowJob,this._one)},r.prototype.onReSetTianFu=function(){n.AM.show(b.TextConst.get(867,this.jobSet.cost[0][1]),Laya.Handler.create(this,this.reSetTianFuHandler))},r.prototype.reSetTianFuHandler=function(){if(p.RoleCenter.instans.GOLD<this.jobSet.cost[0][1])n.AM.showGoldNotEnough();else{var t=new u.ResetSBGiftC2GS;t.job=this.nowJob,s.GSM.sendServer(t)}},r.prototype.onTianFuClick=function(t){var e=this["tf_"+t].dataSource;i.UpTianFuDlg.create(this.nowJob,e.id)},r.prototype.refreshPage=function(t,e){this.nowJob=t,this._one=C.SbUtils.getOneSbDataByJob(t),this.jobSet=C.SbUtils.getSbSettingByJob(t);var i=this.type;isNaN(i)||(this.type=i=0==i?1:0),this.onChangePage(),y.ClearResM.resetViewImg(this)},r.prototype.renderSkill=function(){this.isTween=!0;for(var t=this._one,e=C.SbUtils.getArr_TianFuByJob(this.nowJob),i=C.SbUtils.getExtLvBySbData(t),n=C.SbUtils.getExtQualityBySbData(t),s=0;s<e.length;s++){var o=e[s],a=o.id,r=o.showpos,l=this["tf_"+r],h=this["tf_"+r+"j"],c=t.giftArr||[],u=c.indexOf(a),p=0;p=-1!=u?c[u+1]:0;var d=C.SbUtils.checkTf(o.qianzhi_id,c);l.skin=C.SbUtils.getTianfuIcon(o.icon),l.dataSource=o,l.gray=0==p,this.setTianFuPos(l,this["tf_"+r+"l"],r),h.x=l.x,h.y=l.y,Laya.Tween.clearTween(h),h.scaleX=h.scaleY=this.getScale(r);var g=!1;if(d.qianzhi&&d.lvMax&&p!=o.maxlv){g=!0;var v=1;t.giftCount<1&&(v=2),h.skin="res/shenbing/shenbing/shenbing_jiahao"+v+".png",this.sXiao(h,s)}h.visible=g;var f=this.tianfu.getChildByName("lab_"+r),y=this.tianfu.getChildByName("ani_"+r),m=n[a];if(null!=m){y&&y.removeSelf();y=I.UIEffectsFactory.Ins.createSAniById(m,1,1,"ani_"+s),this.tianfu.addChild(y),y.x=l.x+6+l.width/2,y.y=l.y+6+l.height/2}else y&&y.removeSelf();var _=i[a]||0;0<_&&(l.gray=!1),f.text="("+(p+_)+"/"+(o.maxlv+_)+")",p+_==0?f.color="#999999":p+_<o.maxlv+_?f.color="#09d51f":f.color="#ffd906"}},r.prototype.renderSBTotalCombat=function(t){this.combatNum.setFightNum(t)},r.prototype.getScale=function(t){var e=.7;return 0!=t&&11!=t&&12!=t&&13!=t||(e=1),e},r.prototype.fDa=function(t,e){if(this.isTween){var i=this.getScale(e);Laya.Tween.to(t,{scaleX:i,scaleY:i},500,null,Laya.Handler.create(this,this.sXiao,[t,e]))}},r.prototype.sXiao=function(t,e){if(this.isTween){var i=this.getScale(e);Laya.Tween.to(t,{scaleX:i-.2,scaleY:i-.2},500,null,Laya.Handler.create(this,this.fDa,[t,e]))}},r.prototype.renderTianFuLvBar=function(){var t=this._one;if(t){var e=this.item_bar;e.setLv(t.lv),e.setTfBar(t.giftCount,100);var i=C.SbUtils.getSbExpVo(t.lv).exp;e.setExpBar(t.exp,i,this.nowJob,t.lv)}},r.prototype.setTianFuPos=function(t,e,i){var n=this._skillPoss[this.nowJob].x[i],s=this._skillPoss[this.nowJob].y[i];t.x=n,t.y=s,e.x=n,e.y=s;var o=this.tianfu.getChildByName("lab_"+i);o||((o=new Laya.Label).anchorX=.5,o.font="SimHei",o.fontSize=20,o.strokeColor="#000000",o.stroke=1,o.name="lab_"+i,this.tianfu.addChild(o)),o.x=n,.75==t.scaleX?o.y=t.y+t.height/2*.75+3:o.y=t.y+t.height/2+3},r.openType=0,r}(ui.shenbing.subpage.SkillPageUI);e.Sb_SkillPage=r}),define("src/g/shenbing/view/dlg/SbDetail_Equip",["require","exports","../../../../utils/ItemUtils","../../../../meta/ShuXingVo","../../../../config/GameConfig","src/g/shenbing/view/dlg/SbBag","../../../../meta/QualiyVo","../../../../enum/enumItem","src/init/Switches","src/g/shenbing/view/subpage/Sb_SkillPage","../../../../utils/RoleUtil","src/init/TextConst","../../../../utils/ItemCellUtils"],function(t,e,u,p,d,i,g,v,n,o,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(s){function t(t,e){var i=s.call(this)||this;i.idx=e,i.nowJob=t,i.handlerBtn.on(Laya.Event.CLICK,i,i.click);var n=i.descL;return n.style.font="SimHei",n.style.fontSize=18,n.style.color="#e3cca9",n.style.align="left",n.style.leading=5,n.style.wordWrap=!0,i}return __extends(t,s),t.prototype.click=function(t){var e=this.ivo.link;switch(this.viewType){case 1:new i.SbBag(this.nowJob,this.idx).popup();break;case 2:o.Sb_SkillPage.openType=1,n.Switches.ins.event(e[2][0],[!1,!0,e[2][1]])}this.close()},t.prototype.initData=function(t,e,i){void 0===i&&(i=0),this.ivo=t,this.viewType=i;var n="",s=this.handlerBtn;switch(i){case 0:n="";break;case 1:n=y.TextConst.get(705);break;case 2:n=y.TextConst.get(740)}n?(s.visible=!0,s.label=n):s.visible=!1;var o=d.GameConfig.sb_equip[t.id];this.nameL.text=o.name,this.nameL.color=u.ItemUtils.getColorByQuality(t.quality),this.box_fight.setFightNum(o.power+f.RoleUtil.calFightByProp(o.prop)),this.descL.innerHTML=o.desc;for(var a=o.prop,r=a.length,l=0;l<r;l++){var h=u.ItemUtils.getShuXingByName(a[l][0]);this.props.getChildByName("lab_"+l).text=h.desc+":"+p.ShuXingVo.getString4Vo(a[l][1],h)}var c=!1;0<e&&(c=!0,this.lab_num.text=e+""),this.lab_num.visible=this.lab_numDesc.visible=c,this.lab_zy.text=v.enumItem.arr_Job[o.job],this.lab_lv.color=u.ItemUtils.getColorByQuality(o.quality),this.lab_lv.changeText(g.QualityStruct.Ins.getQDesById(o.quality)),m.ItemCellUtils.fillSbItem(this.preview,t)},t}(ui.shenbing.dlg.SbDetail_EquipUI);e.SbDetail_Equip=s}),define("src/g/custom/detailDlgs/PassiveTipItem",["require","exports","../../../utils/ItemUtils","../../../meta/ShuXingVo","../../../meta/MainButtonVo","../../../meta/QualiyVo","src/g/skill/vo/PassiveStruct"],function(t,e,a,r,i,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.btn_use.on(Laya.Event.CLICK,t,t.onClick),t}return __extends(t,e),t.prototype.initData=function(t,e,i){void 0===i&&(i=!1),this.ivo=t,this.count_txt.text=e+"",this.lab_name.color=l.QualityStruct.Ins.getQColorById(t.quality),this.lab_name.text=t.name,this.item.img_item.skin=a.ItemUtils.getIconById(t.id),this.item.img_quality.skin=a.ItemUtils.getQualitybjByQualityId(t.quality),this.lvl_txt.text=l.QualityStruct.Ins.getQDesById(t.quality),this.lvl_txt.color=a.ItemUtils.getColorByQuality(t.quality),this.img_icon.skin=a.ItemUtils.getIconById(this.ivo.id),this.lab_desc.text=this.ivo.desc;var n=h.PassiveStruct.Ins.getPvo4ItemId(t.id);this.pvo=n;for(var s=0;s<n.prop.length;s++){var o=r.ShuXingVo.createSXBox(n.prop[s][0],n.prop[s][1],"#e3cca9",": ","#e3cca9");s%2==0?this.attr_0.addChild(o):this.attr_1.addChild(o)}this.btn_use.visible=i},t.prototype.onClick=function(){i.MainButtonStruct.Ins.OpenModule(this.pvo.link[0][0],this.pvo.link[0][1]),this.close()},t}(ui.bag.tips.PassviewTIpItemUI);e.PassiveTipItem=n}),define("src/g/custom/detailDlgs/Tips_Fashion",["require","exports","../../../utils/ItemUtils","../../../config/GameConfig","../../../manager/RoleCenter","../../net/messages/PropFightMain","../../net/messages/sbkFormula","../../../meta/ShuXingVo","../../../plugin/sbkPropTool","src/g/custom/detailDlgs/Details_Item","src/init/TextConst","../../../utils/RoleUtil","../../../component/GAnimation"],function(t,e,c,i,n,u,p,d,g,s,v,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.tvo=null,t.fvo=null,t.uvo=null,t.hvo=null,t.isInBag=!1,t._itemid=0,t.btn_use.on(Laya.Event.CLICK,t,t.onUse),t}return __extends(t,e),t.prototype.initDataByFashion=function(t,e){void 0===e&&(e=!1),this._itemid=t,this.isInBag=e,this.fvo=c.ItemUtils.getFashionVo(t),this.showAni()},t.prototype.initDataByTitle=function(t,e){void 0===e&&(e=!1),this.isInBag=e,this.tvo=i.GameConfig.titleJSON[t],this.showAni()},t.prototype.onUse=function(){s.Details_Item.UseItem(c.ItemUtils.getItemVoById(this._itemid)),this.close()},t.prototype.showAni=function(){this.uvo=n.RoleCenter.instans.vo,this.hvo=this.uvo.getOpenHeroByIdx(0),this.showTitle(),o.RoleUtil.refreshZww(this.hvo,120,this.ani_wing,this.ani_weapon,this.ani_role,null,this.fvo),this.showAttr()},t.prototype.showTitle=function(){if(this.tvo){for(var t,e=c.ItemUtils.getTitleAnimation(this.tvo.id),i=this.effect_con.numChildren;0<i;)if(t=this.effect_con.getChildAt(0)){t.stop(),t.clear();break}(t=new a.GAnimation).interval=120,this.effect_con.addChild(t),t.load(e)}},t.prototype.showAttr=function(){this.btn_use.visible=!1;var t=[];this.tvo?(this.lab_title.text=this.tvo.name,t=this.tvo.prop,this.lab_titleDes.text=this.tvo.desc):this.lab_titleDes.text="",this.fvo&&(this.lab_title.text=this.fvo.name,t=this.fvo.prop,this.btn_use.visible=this.isInBag);var e=new u.PropZhuZai;g.sbkPropTool.reSetProp(e,t);var i=p.sbkFormula.calMonsterCombat([["HP",e.HP],["ATT",e.ATT],["PDEF",e.SDEF],["SDEF",e.PDEF],["STRONG",e.STRONG],["ANTISTRONG",e.ANTISTRONG],["MISS",e.MISS]]);this.lab_fight.text=v.TextConst.get(79,i);for(var n=t.length,s=0;s<5;s++){var o=this["attr_key_"+s],a=this["attr_val_"+s];if(s<n&&t[s]){var r=c.ItemUtils.getShuXingByName(t[s][0]);o.text=r.desc+": ",a.text=d.ShuXingVo.getString4Vo(t[s][1],r),o.visible=!0,a.visible=!0}else o.visible=!1,a.visible=!1}var l=0,h=c.ItemUtils.getItemVoById(this._itemid);h&&0<h.effect.length&&(l=Number(h.effect[0][1])),this.box_time.visible=!1,0<l&&(this.box_time.visible=!0,this.lab_time.text=v.TextConst.get(8,Math.ceil(l/3600/24).toString()))},t.prototype.getFashionId=function(t){var e=this.hvo;if(e&&e.fashionData)for(var i,n=e.fashionData.curFashion.length,s=0;s<n;){var o=e.fashionData.curFashion[s];if((i=c.ItemUtils.getFashionVo(o))&&i.position==t)return i.res;s++}return 0},t.prototype.close=function(){e.prototype.close.call(this)},t}(ui.bag.tips.Tips_FashionUI);e.Tips_Fashion=r}),define("src/g/lottery/view/FragHcDlg",["require","exports","../../net/messages/UseItemC2GS","../../../manager/GameSocketManager","../../../utils/ItemUtils","../../../meta/QualiyVo","src/g/Effects/UIEffectsFactory","../../../manager/TipManager","../../../utils/UIUtils","../../../core/NumE","../../../manager/RoleCenter","../../../meta/FengshenVo","../../../config/GameConfig","../../../utils/system/FloatEffect","src/init/TextConst","../../../enum/BagItemType"],function(t,e,n,s,r,l,o,a,h,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this,e=t.lab_desc;return e.style.color="#c0b4a3",e.style.font="SimHei",e.style.fontSize=20,t.btn_use.on(Laya.Event.CLICK,t,t.use_frag),t.btn_sub.on(Laya.Event.CLICK,t,t.onChangeNum,[0]),t.btn_add.on(Laya.Event.CLICK,t,t.onChangeNum,[1]),t.btn_min.on(Laya.Event.CLICK,t,t.onChangeNum,[2]),t.btn_max.on(Laya.Event.CLICK,t,t.onChangeNum,[3]),t}return __extends(t,i),t.prototype.onChangeItem=function(){var t=this.iVo.effect;if(t&&2<=t.length){var e=+t[1][0],i=r.ItemUtils.getItemVoById(e);if(i)a.TipManager.showCardTip2(i.name,r.ItemUtils.getIconById(i.id),i.quality);else{var n=r.ItemUtils.getItemOrEq(e);a.TipManager.showCardTip2(n.name,r.ItemUtils.getIconById(n.id),n.quality)}this.close()}},t.prototype.close=function(t,e){i.prototype.close.call(this,t,e),c.NumE.ins.off(+this.iVo.effect[1][0]+c.NumE.CHANGED,this,this.onChangeItem)},t.prototype.isCan=function(){var t=this.iVo.id,e=u.RoleCenter.instans.vo.fengshenId,i=d.GameConfig.fengshenJson[e];if(i){var n=i.cost;if(0<n.length){var s=p.FengshenVo.costIdArr,o=s.indexOf(+n[0][0]),a=s.indexOf(t);if(-1!=a&&o<=a)return g.FE.upItems(v.TextConst.get(1126)),!1}}return!0},t.prototype.use_frag=function(){if(this.isCan()){var t=new n.UseItemC2GS;t.cfgId=this.iVo.id,t.count=this.needCount*+this.lab_size.text,s.GSM.sendServer(t),o.UIEffectsFactory.Ins.playAniOnce(68,this.stage)}},t.prototype.initData=function(t,e,i){var n=t.effect[0][1];this.needCount=n,this.iVo=t,this.lab_desc.innerHTML=h.UIUtils.replaceBr(t.desc),this.lab_num.text=e+"",this.lab_lv.text=l.QualityStruct.Ins.getQDesById(t.quality),this.lab_lv.color=r.ItemUtils.getColorByQuality(t.quality),this.item_.img_item.skin=r.ItemUtils.getIconById(t.id),this.item_.img_quality.skin=r.ItemUtils.getQualitybjByQualityId(t.quality),this.item_.lab_num.changeText(""),this.lab_name.changeText(t.name),this.lab_name.color=r.ItemUtils.getQualityColorById(t.id);var s=!0,o=!0;if(i){var a=Math.floor(e/n);this.num=a,this.usecount=a,n<=e&&(s=!1),this.lab_hcNum.text=a+"",this.btn_use.visible=o,this.btn_use.disabled=s,c.NumE.ins.on(+t.effect[1][0]+c.NumE.CHANGED,this,this.onChangeItem)}else o=!1,this.box_cost.visible=o,this.box_hcCount.visible=o,this.height=300},t.prototype.onChangeNum=function(t){var e=this.num,i=+this.lab_size.text;switch(t){case 0:i<=1?i=1:i-=1;break;case 1:i<e&&i++;break;case 2:i=1;break;case 3:i=e>this.usecount?this.usecount:e}this.iVo.type==f.BagItemType.gonghuiling&&(i=1),this.lab_size.changeText(i+"")},t}(ui.lottery.FragHcDlgUI);e.FragHcDlg=i}),define("src/g/xingwang/view/XwBag",["require","exports","src/g/bag/view/BagMini","../../../utils/XwUtils","../../net/messages/rexue/sbkXWData","../../../manager/GameSocketManager","../../../vo/sbkBagVo","../../../config/GameConfig","../../../manager/RoleCenter","src/init/TextConst","../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips"],function(t,e,i,u,p,o,d,g,v,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(c){function t(t,e,i,n){void 0===n&&(n=!0);var s,o=c.call(this)||this;o.isNull=n,o.req=s=new p.sbkXWPutonC2GS,s.heroIdx=t,s.rxPos=e,s.equpos=i,o.bgview.img_title.y=5,o.bgview.img_title.skin=o.getTitleUrl();for(var a=g.GameConfig.xwequipsuit[e].set,r=1,l=0;l<a.length;l++)if(+a[l][0]==i){r=a[l][1];break}var h=u.XwUtils.getLimitEq(u.XwUtils.getLimitEq(d.sbkBagVo.getXwEq(),r,i,!0),v.RoleCenter.instans.self.getCurLv(),-1,!1,!0);return o.eqArr=h,o.list.array=h,o}return __extends(t,c),t.prototype.getTitleUrl=function(){var t=this.req;return t?"res/xingwang/title"+t.equpos+".png":""},t.prototype.getRender=function(){return ui.xingwang.XwItemChangeEqUI},t.prototype.renderHandler=function(t,e){var i=this.eqArr[e];r.ItemCellUtils.fillXwItem(t.preview,i.equtemplet);var n=a.TextConst.get(705);this.isNull&&(n=a.TextConst.get(706)),t.btn_change.label=n;var s=i.combat+"";t.lab_fight.text=s,t.lab_score.text=s},t.prototype.mouseHandler=function(t,e){var i=t.target,n=t.currentTarget;if(t.type==Laya.Event.CLICK){var s=this.eqArr[e];i==n.preview?l.ItemTips.ins.showTip(s.equtemplet,0,s):i==n.btn_change&&(this.req.equipId=s.equid,o.GSM.sendServer(this.req),this.close())}},t}(i.BagMini);e.XwBag=n}),define("src/g/xingwang/view/XwTips_Eq",["require","exports","../../../utils/ItemUtils","../../../config/GameConfig","src/g/xingwang/view/XwBag","../../../utils/XwUtils","../../../utils/UIUtils","../../../utils/RoleUtil","src/init/TextConst","../../../utils/ItemCellUtils"],function(t,e,T,A,n,R,L,x,P,k){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this,e=t.desc_tz;return e.style.font="SimHei",e.style.fontSize=16,e.style.leading=4,t.btn_replace.on(Laya.Event.CLICK,t,t.onClick),t}return __extends(t,i),t.prototype.onClick=function(t){var e=this.equipPos;e&&(new n.XwBag(e.heroIdx,e.rxPos,e.equpos,!1).popup(),this.close())},t.prototype.initData=function(t,e,i,n,s){void 0===t&&(t=!1),void 0===e&&(e=null),void 0===i&&(i=null),void 0===n&&(n=""),void 0===s&&(s=null),i=i||(e?e.equins[0]:null),this._eqins=i;var o=T.ItemUtils.getXwEquipVoById(i.equtemplet);k.ItemCellUtils.fillXwItem(this._item,o.id),n&&(this.btn_replace.label=n),this._btnClkHandler=s;for(var a=o.prop,r=0;r<6;r++){var l=a[r],h=this["attr_"+r];if(l){var c=h.getChildByName("sname"),u=h.getChildByName("svalue");c.text=T.ItemUtils.getShuXingByName(l[0]).desc,u.text=l[1]}else h.removeSelf()}var p=A.GameConfig.xwZ7z8,d=p.xwSuit.value.split(",");if(t)this.box_tz.removeSelf(),this.btn_replace.visible=!1;else if(e){this.equipPos=e;var g=R.XwUtils.getData(e.heroIdx,e.rxPos),v=R.XwUtils.getMinTzLvByXwData(g),f=A.GameConfig.xwequipsuit[e.rxPos];R.XwUtils.setSuitInfo(this.suit_shouhu,g,f.set),R.XwUtils.setSuitProp(this.box_tz,f.prop[0!=v?v-1:0],v),this.lab_tztitle.text=d[0!=v?v-1:0]}0==i.equid&&(this.box_tz.removeSelf(),this.btn_replace.visible=!1),0==i.equid?this.box_fight.setFightNum(x.RoleUtil.calFightByProp(o.prop)+i.getSpecialPropCombat()):this.box_fight.setFightNum(i.combat),this.clip_score.value=this.box_fight.num_Fight.value;var y=o.split2;this.getGx.text=0==y.length?"":P.TextConst.get(99,y[0][1]);var m=!1;if(i){var _=i.specialPropArr;if(0==_.length)this.box_xj.removeSelf();else for(r=0;r<10;r++){var C=_[r],I=this.box_xj.getChildByName("sname_"+r);if(C){var b=A.GameConfig.xwProp[C.id];b?(I.text=b.desc+": "+(1==b.type?C.value/100:C.value)+(1==b.type?"%":""),I.color=T.ItemUtils.getColorByQuality(b.quality)):I.removeSelf()}else I.removeSelf()}}if(e)this.box_desc.removeSelf();else{var w=L.UIUtils.replaceBr(p.tipsdesc.value);if(m=!0,e){var S=A.GameConfig.xwequipsuit[e.rxPos].prop;for(r=0;r<S.length;r++){l=S[r];var E=T.ItemUtils.getShuXingByName(l[0]);w=w.replace("{"+r+"}",E.desc+":"+l[1]/100+E.unit)}}this.desc_tz.innerHTML=w}this.desc_tz.visible=m,this.lab_pos.text=p.xwPosName.value.split(",")[o.pos-1],this.lab_name.text=o.name,this.lab_name.color=T.ItemUtils.getColorByQuality(o.quality),this.lab_job.text=P.TextConst.get(118),this.lab_limit.text=T.ItemUtils.getLv(o.limit)},t}(ui.xingwang.XwTips_EqUI);e.XwTips_Eq=i}),define("src/g/shenbing/view/dlg/SbItem",["require","exports","src/g/custom/detailDlgs/Details_Item","src/g/shenbing/view/subpage/Sb_SkillPage","src/init/Switches"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(a){function t(){return a.call(this)||this}return __extends(t,a),t.prototype.initData=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=-1),a.prototype.initData.call(this,t,e,i,n);var s=this.btn_use,o=this.box_selectNum;o.removeChildren(),o.addChild(s),s.y=0,s.visible=i,o.height=s.height,this.rechangeLSize(!0),this.rechangeSize()},t.prototype.onSend=function(){n.Sb_SkillPage.openType=0,s.Switches.ins.event(188,[!1,!0,0]),this.close()},t}(i.Details_Item);e.SbItem=o}),define("src/g/shenshou/view/ShenShouTip",["require","exports","../../../utils/ItemUtils","../../../meta/QualiyVo","../../../config/GameConfig","src/g/clearRes/ClearResM","src/init/Switches","src/init/TextConst","../../../component/GAnimation"],function(t,e,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(o){function t(t,e){var i=o.call(this)||this;h.ClearResM.addBgUrl(i.bg.skin),i.setHtm(i.skill_desc),i.setHtm(i.item_desc),i.txt_name.text=t.name,i.skillicon.skin=a.ItemUtils.getIconByIconId(t.icon),i.quality_txt.text=r.QualityStruct.Ins.getQDesById(t.quality),i.quality_txt.color=r.QualityStruct.Ins.getQColorById(t.quality),i.need_txt.text="("+e+"/"+t.effect[2][1]+")",i.tip_txt.text=u.TextConst.get(974,t.effect[2][1]),i.ani.source="dynamic2/zhiwawa/pet/"+t.effect[0][1]+".json";var n=t.effect[1][1],s=l.GameConfig.godpetskill[n];return i.skillicon.skin=a.ItemUtils.getSkillIconByIconId(s.icon),i.skill_desc.innerHTML=s.desc,i.item_desc.innerHTML=t.desc,i.btn_go.once(Laya.Event.CLICK,i,function(){c.Switches.ins.event(223),this.close()}),i}return __extends(t,o),t.prototype.setHtm=function(t){t.style.font="SimHei",t.style.fontSize=18,t.style.color="#a89e8f",t.style.leading=5,t.style.wordWrap=!0},t.prototype.close=function(){o.prototype.close.call(this),this.btn_go.offAll(Laya.Event.CLICK)},t}(ui.shenshou.ShenShouTipUI);e.ShenShouTip=i;var n=function(o){function t(t,e){var i=o.call(this)||this;i.anianis=new p.GAnimation,i.setHtm(i.skill_desc),i.setHtm(i.item_desc),i.txt_name.text=t.name,i.skillicon.skin=a.ItemUtils.getIconByIconId(t.icon),i.quality_txt.text=r.QualityStruct.Ins.getQDesById(t.quality),i.quality_txt.color=r.QualityStruct.Ins.getQColorById(t.quality),i.need_txt.text="("+e+"/"+t.effect[2][1]+")",i.tip_txt.text=u.TextConst.get(1156,t.effect[2][1]),i.anianis.load("dynamic2/zhiwawa/jieling/"+t.effect[0][1]+".json"),i.addChild(i.anianis),i.anianis.x=247,i.anianis.y=332;var n=t.effect[1][1],s=l.GameConfig.ringLingSkillvo[n];return i.skillicon.skin=a.ItemUtils.getSkillIconByIconId(s.icon),i.skill_desc.innerHTML=s.desc,i.item_desc.innerHTML=t.desc,i.btn_go.once(Laya.Event.CLICK,i,function(){c.Switches.ins.event(287),this.close()}),i}return __extends(t,o),t.prototype.setHtm=function(t){t.style.font="SimHei",t.style.fontSize=18,t.style.color="#a89e8f",t.style.leading=5,t.style.wordWrap=!0},t.prototype.close=function(){o.prototype.close.call(this),this.btn_go.offAll(Laya.Event.CLICK)},t}(ui.shenshou.ShenShouTipUI);e.RingTip=n}),define("src/g/custom/detailDlgs/Details_Chuanshi",["require","exports","src/g/Effects/UIEffectsFactory","../../../meta/QualiyVo","../../../utils/ItemUtils","../../../utils/UIUtils","../../../config/GameConfig","../../../meta/ShuXingVo"],function(t,e,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(s){function t(t,e,i){var n=s.call(this)||this;return n.htxt_desc.style.font="SimHei",n.htxt_desc.style.fontSize=20,n.htxt_desc.style.color="#c0b4a3",n.htxt_desc.style.leading=10,n.init(t,e,i),n}return __extends(t,s),t.prototype.init=function(t,e,i){for(var n;this.ani_con.numChildren;)(n=this.ani_con.removeChildAt(this.ani_con.numChildren-1))&&n.destroy();var s=t.effect[0][1];n=p.UIEffectsFactory.Ins.createSAniById(s);var o=this.ani_con.y;if(n){var a=g.ItemUtils.getUIEffectsVoById(s);n.pivotX=n.width/2,n.pivotY=n.height/2,n.x=this.ani_con.width/2,n.y=a.height/2,o+=a.height,this.ani_con.addChild(n),n.play()}if(o+=10,this.lab_num_lab.y=this.lab_num.y=o,this.lab_q_lab.y=this.lab_q.y=o,o+=28,this.htxt_desc.y=o,this.lab_name.changeText(t.name),this.lab_num.changeText(0<e?e.toString():""),this.lab_q.changeText(d.QualityStruct.Ins.getQDesById(t.quality)),this.lab_q.color=g.ItemUtils.getColorByQuality(t.quality),this.htxt_desc.innerHTML=v.UIUtils.replaceBr(t.desc),o+=this.htxt_desc.contextHeight+20,this.vbox_base.visible=!1,i){this.vbox_base.visible=!0,this.vbox_base.y=o,o+=155;for(var r=t.effect[1][1],l=f.GameConfig.bladelvjson[r].prop,h=0;h<l.length;h++){var c=this.vbox_base.getChildByName("box_"+h).getChildByName("base");if(c){var u=g.ItemUtils.getShuXingByName(l[h][0]);c.text=u.desc+":"+y.ShuXingVo.getString4Vo(l[h][1],u),h==l.length-1&&(c.color=u.color)}}}this.img_bg1.height=this.img_bg.height=this.height=o},t}(ui.custom.DetailsDlg.Details_chuanshiUI);e.Details_Chuanshi=i}),define("src/g/role/view/SsBag",["require","exports","src/g/bag/view/BagMini","../../../utils/ItemCellUtils","src/init/TextConst","../../../vo/sbkBagVo","../../../config/GameConfig","src/g/role/view/SsTips_Eq","../../net/messages/shenshi/sbkShenShiMsg","../../../manager/GameSocketManager","../../../meta/QualiyVo","../../../manager/RoleCenter"],function(t,e,i,s,o,a,l,h,c,u,r,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t,e){var i=n.call(this)||this;return i.idx=e,i.equipId=t,i.updateData(),i.bgview.img_title.y=5,i}return __extends(t,n),t.prototype.getTitleUrl=function(){return"res/title/ss_biaoti.png"},t.prototype.getRender=function(){return ui.role.Shenshi.SsChangeEqUI},t.prototype.mouseHandler=function(t,e){var i=t.target,n=t.currentTarget;if(t.type==Laya.Event.CLICK){var s=this.equips[e];if(i==n.preview){var o=new h.SsTips_Eq;o.initData(!1,s,!1),o.popup()}else if(i==n.btn_change){if(this.isSend)return;var a=l.GameConfig.SSEquip[s.equtemplet];this.isSend=!0;var r=new c.PutonSSEquipC2GS;r.equipId=s.equid,r.heroIdx=this.idx,r.equipPos=a.pos,u.GSM.sendServer(r),this.close()}}},t.prototype.renderHandler=function(t,e){var i=l.GameConfig.SSEquip[this.equips[e].equtemplet];s.ItemCellUtils.fillSsItem(t.preview,i),t.preview.lab_name.visible=!1,t.lab_name.color=r.QualityStruct.Ins.getQColorById(i.quality),t.lab_name.text=i.name,t.lab_count.text=o.TextConst.get(92,1)},t.prototype.updateData=function(){for(var t=a.sbkBagVo.getSsEq(),e=l.GameConfig.SSEquip[this.equipId],i=p.RoleCenter.instans.vo.ssLv,n=0;n<t.length;n++){var s=t[n],o=l.GameConfig.SSEquip[s.equtemplet];(o.pos!=e.pos||o.suitlv<=e.suitlv||o.limit>i)&&(t.splice(n,1),n--)}t.sort(function(t,e){return t.quality<e.quality?1:-1}),this.equips=t,this.list.array=t},t}(i.BagMini);e.SsBag=n}),define("src/g/role/vo/SsLvVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.id=t[i++]||0,this.name=t[i++],this.prop=t[i++],this.cost=t[i++],this.reward=t[i++]||[],this.image=t[i++]||"",e[this.id]=this},t}();e.SsLvVo=i}),define("src/g/role/view/SsResolveDlg",["require","exports","../../../manager/RoleCenter","../../../utils/ItemUtils","../../net/messages/EquipSplitC2GS","../../../manager/GameSocketManager","../../../config/GameConfig","../../../vo/sbkBagVo","../../../enum/EventName","../../../core/E","src/init/TextConst"],function(t,e,u,a,n,s,p,d,o,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;return t._datasrc=[],t.Hd=new Laya.Handler(t,t.SplitHandler),t.list_.renderHandler=new Laya.Handler(t,t.onRender),t.bg.btn_back.on(Laya.Event.CLICK,t,t.close),t.bg.btn_close.on(Laya.Event.CLICK,t,t.close),r.E.ins.on(o.EventName.EQUIPSPLITOVER,t,t.onEquipSplit),t}return __extends(t,i),t.prototype.close=function(t,e){i.prototype.close.call(this,t,e),r.E.ins.off(o.EventName.EQUIPSPLITOVER,this,this.onEquipSplit)},t.prototype.onEquipSplit=function(){this.refreshData()},t.prototype.refreshData=function(){var t=this._datasrc;t.splice(0,t.length);for(var e=u.RoleCenter.instans.vo,i=d.sbkBagVo.getSsEq(),s=p.GameConfig.SSEquip,n=0;n<i.length;n++){var o=i[n];if(-1==t.indexOf(o)){for(var a=s[o.equtemplet],r=void 0,l=0;l<e.heronum;l++){var h=e.getOpenHeroByIdx(l).sshData.equpos[a.pos-1].ins;if(0==h.equid){r=0;break}var c=s[h.equtemplet];r=isNaN(r)?c.suitlv:Math.min(r,c.suitlv)}r>=a.suitlv&&t.push(o)}}t.sort(function(t,e){var i=s[t.equtemplet],n=s[e.equtemplet];return i.suitlv-n.suitlv}),this.list_.dataSource=t},t.prototype.onRender=function(t,e){var i=t.dataSource,n=p.GameConfig.SSEquip[i.equtemplet],s=n?n.split:null;if(!(n&&s.length<=0)){var o=a.ItemUtils.getItemVoById(parseInt(s[0][0]));t.setQualityBg(a.ItemUtils.getQualityBjById(n.id)),t.html_text.style.fontSize=18,t.html_text.innerHTML=l.TextConst.get(857,a.ItemUtils.getColorByQuality(n.quality),n.name),t.setLv(""),t.setIcon(a.ItemUtils.getIconById(n.id)),t.setJob(-1),t.setGet(o.name+"x"+s[0][1]),t.lab_canGet.color=a.ItemUtils.getColorByQuality(n.quality),t.setResolveHandler(this.Hd)}},t.prototype.SplitHandler=function(t){var e=new n.EquipSplitC2GS;e.splittype=n.ESplitType.ssEquip,e.equipidarr.push(t.equid),s.GSM.sendServer(e)},t}(ui.role.Shenshi.resolveSSDlgUI);e.SsResolveDlg=i}),define("src/g/role/vo/SsStrongVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.pos=t[i++],this.level=t[i++]||0,this.prop=t[i++],this.cost=t[i++],e[this.pos+"_"+this.level]=this},t}();e.SsStrongVo=i}),define("src/g/role/view/SsStrong",["require","exports","../../../manager/GameSocketManager","../../../utils/system/FloatEffect","../../../config/GameConfig","../../../utils/ItemUtils","../../../utils/RoleUtil","../../../utils/ItemCellUtils","../../net/messages/shenshi/sbkShenShiMsg","../../net/messages/OpResultType","../../../manager/RoleCenter","src/g/role/view/SsResolveDlg","src/init/TextConst"],function(t,e,a,r,b,w,S,E,l,h,T,i,A){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(o){function t(t,e){var i=o.call(this)||this,n=T.RoleCenter.instans.vo.getOpenHeroByIdx(t).sshData.equpos[e-1];i.ssEqPos=n;var s=new l.SSEquipProChgMsg;return s.equpos=e,s.heroidx=t,i.req=s,i.btn_qh.on(Laya.Event.CLICK,i,i.onClick),i.bgview.btn_close.on(Laya.Event.CLICK,i,i.close),a.GSM.ins.on(l.SSEquipProChgMsg.KEY,i,i.msgHandler),i.$render(),i.item_cost.setJump(A.TextConst.get(238),new Laya.Handler(i,i.onShowGetItem)),i}return __extends(t,o),t.prototype.$render=function(){var t=this.ssEqPos,e=this.preview,i=t.strongLv,n=this.req.equpos,s=b.GameConfig.SSEquip[t.ins.equtemplet];E.ItemCellUtils.fillSsItem(e,s),e.img_lock.visible=!1,e.lab_name.text=A.TextConst.get(100,i);var o=b.GameConfig.SSequipenhance[n+"_"+i],a=b.GameConfig.SSequipenhance[n+"_"+(i+1)],r=o.prop;this.box_fight.setFightNum(S.RoleUtil.calFightByPropSs(r));for(var l=this.curr_attr,h=this.next_attr,c=0;c<2;c++){var u=l.getChildByName("lab_"+c),p=h.getChildByName("lab_"+c),d=r[c],g=!1;if(d&&(g=!0,u.text=w.ItemUtils.getShuXingByName(d[0]).desc+":"+d[1]),u.visible=g,g=!1,a){var v=a.prop[c];v&&(g=!0,p.text=w.ItemUtils.getShuXingByName(v[0]).desc+":"+v[1])}else d&&(g=!0,p.text=A.TextConst.get(208));p.visible=g}var f=this.item_cost;if(a){var y=o.cost,m=y[0][0],_=w.ItemUtils.getItemVoById(m),C=y[0][1],I=T.RoleCenter.instans.vo.bagdata.getItemCount(_.id);f.setNeed(I,C,0==C,!0),f.setNeedName(_.name,w.ItemUtils.getSmallIcon(_.icon)),f.setQualColor(w.ItemUtils.getColorByQuality(_.quality))}else f.visible=!1},t.prototype.onShowGetItem=function(){var t=new i.SsResolveDlg;t.refreshData(),t.popup()},t.prototype.msgHandler=function(t){this.$render()},t.prototype.onClick=function(t){switch(t.currentTarget){case this.btn_qh:var e=this.req,i=this.ssEqPos.strongLv,n=e.equpos,s=b.GameConfig.SSequipenhance[n+"_"+i];if(!b.GameConfig.SSequipenhance[n+"_"+(i+1)]){r.FE.upItems(A.TextConst.get(208));break}var o=s.cost;if(T.RoleCenter.instans.vo.bagdata.getItemCount(o[0][0])<o[0][1]){r.FE.upItems(A.TextConst.get(370));break}e.curLv=i,e.msgidx=h.enumOpResultType.ssEquipStrong,a.GSM.sendServer(e)}},t.prototype.close=function(t,e){o.prototype.close.call(this,t,e),a.GSM.ins.off(l.SSEquipProChgMsg.KEY,this,this.msgHandler)},t}(ui.role.Shenshi.SsStrongUI);e.SsStrong=n}),define("src/g/role/view/SsHc",["require","exports","../../net/messages/shenshi/sbkShenShiMsg","../../../manager/GameSocketManager","../../../config/GameConfig","../../../utils/ItemUtils","../../../utils/ItemCellUtils","../../../meta/QualiyVo","src/g/bag/tips/view/ItemTips","src/g/bag/vo/BagDataVo","../../../manager/RoleCenter","../../../vo/sbkBagVo","../../net/messages/sbkEquipIns"],function(t,e,w,i,S,E,T,A,a,r,R,L,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(b){function t(t,e){void 0===e&&(e=0);var i=b.call(this)||this,n=S.GameConfig.SSEquip[t],s=(i.vo=n).pos,o=new w.CompoundSSEquipC2GS;o.heroIdx=e,o.equipCfgId=t,o.pos=s;var a=[[R.RoleCenter.instans.vo.getOpenHeroByIdx(e).sshData.equpos[s-1].ins.equtemplet,1]].concat(n.worth);i.worth=a;for(var r=!1,l=0;l<a.length;l++){var h=i["need"+l];if(h){h.on(Laya.Event.CLICK,i,i.needClick,[l]);var c=a[l],u=E.ItemUtils.getItemVoById(c[0]),p=0,d=c[1];if(u)p=R.RoleCenter.instans.vo.bagdata.getItemCount(u.id),T.ItemCellUtils.fillSsItem(h),h.lab_name.text=u.name,h.lab_name.color=A.QualityStruct.Ins.getQColorById(u.quality),h.item.item.item.img_item.skin=E.ItemUtils.getIconByIconId(u.icon),h.item.item.item.img_quality.skin=E.ItemUtils.getQualitybjByQualityId(u.quality);else{var g=S.GameConfig.SSEquip[c[0]];if(T.ItemCellUtils.fillSsItem(h,g),0==l)p=1;else for(var v=L.sbkBagVo.getSsEq(),f=o.equipIdArr,y=0,m=0;m<v.length;m++){var _=v[m];_.equtemplet==g.id&&y<d&&-1==f.indexOf(_.equid)&&(f.push(_.equid),p++,y++)}}p<d&&(r=!0);var C=h.item.item.lab_num;C.text=p+"/"+d,C.color=d<=p?"#03bb00":"#ff0f15"}}var I=!1;return S.GameConfig.SSEquip[t].limit>R.RoleCenter.instans.vo.ssLv&&(I=r=!0),i.lab_no.visible=I,i.btn_hc.disabled=r,T.ItemCellUtils.fillSsItem(i.next_eq,n),i.req=o,i.bg.btn_close.on(Laya.Event.CLICK,i,i.close),i.btn_hc.on(Laya.Event.CLICK,i,i.hcHandler),i.next_eq.on(Laya.Event.CLICK,i,i.currShow),i}return __extends(t,b),t.prototype.needClick=function(t){var e=this.worth,i=+e[t][0],n=E.ItemUtils.getItemVoById(i),s=new r.BagDataVo;if(s.id=i,s.num=e[t][1],n)s.ItmVo=n;else{var o=S.GameConfig.SSEquip[i];s.ssVo=o,s.type=l.enumEquipType.ssEquip}a.ItemTips.ins.showTips(s)},t.prototype.currShow=function(){var t=this.vo,e=new r.BagDataVo;e.id=this.vo.id,e.ssVo=t,e.num=0,e.type=l.enumEquipType.ssEquip,a.ItemTips.ins.showTips(e)},t.prototype.hcHandler=function(){i.GSM.sendServer(this.req),this.close()},t}(ui.role.Shenshi.SsHcUI);e.SsHc=n}),define("src/g/role/view/SsTips_Eq",["require","exports","../../../utils/ItemCellUtils","../../../config/GameConfig","../../../enum/enumItem","../../../utils/ItemUtils","../../../manager/RoleCenter","src/g/role/view/SsBag","../../../plugin/sbkPropTool","../../net/messages/sbkFormula","src/g/Effects/UIEffectsFactory","../../../manager/RedDotM","src/g/role/view/SsStrong","src/g/role/view/SsHc"],function(t,e,N,U,V,O,F,n,q,K,Y,j,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(t){void 0===t&&(t=0);var e=i.call(this)||this;return e.hidx=t,e.btn_strong.on(Laya.Event.CLICK,e,e.qh),e.btn_hand.on(Laya.Event.CLICK,e,e.th_th),e.btn_hc.on(Laya.Event.CLICK,e,e.hc_th),e}return __extends(t,i),t.prototype.qh=function(){new s.SsStrong(this.hidx,this.vo.pos).popup(),this.close()},t.prototype.th_th=function(t){new n.SsBag(this.vo.id,this.hidx).popup(),this.close()},t.prototype.hc_th=function(t){new o.SsHc(this.vo.id+1,this.hidx).popup(),this.close()},t.prototype.initData=function(t,e,i){void 0===t&&(t=!1),void 0===e&&(e=null),void 0===i&&(i=!0);var n=U.GameConfig.SSEquip,s=U.GameConfig.commonJson,o=e.equtemplet,a=n[o],r=n[o+1];t?r||(this.btn_hand.visible=!1,this.btn_strong.centerX=0):this.btn_hc.visible=this.btn_strong.visible=this.btn_hand.visible=!1,this.vo=a,this._item.lab_name.visible=!1,N.ItemCellUtils.fillSsItem(this._item,a),this.lab_name.text=a.name,this.lab_yuansuname.text="神力属性",this.lab_pos.text=V.enumItem.arr_equipPosNameSs[a.pos-1],this.lab_limit.text=U.GameConfig.SSLv[a.limit].name;var l,h=this.hidx,c=a.prop,u=a.prop2,p=e.combat;if(i&&(l=F.RoleCenter.instans.vo.getOpenHeroByIdx(h).sshData.equpos),0==p&&(q.sbkPropTool.reSetProp(e,c),q.sbkPropTool.reSetProp(e,u),p=e.calEquipCombat()),t&&l){var d=l[a.pos-1].strongProp;p+=K.sbkFormula.calEquipCombat(d.HP,d.ATT,d.PDEF,d.SDEF,0,d.SSATT,d.SSDEF)}this.box_fight.setFightNum(p);for(var g=0;g<6;g++){var v=this["attr_"+g],f=v.getChildByName("sname"),y=v.getChildByName("svalue");if(_=c[g]){var m=O.ItemUtils.getShuXingByName(_[0]);f.text=m.desc+":",y.text=_[1]+m.unit}else v.removeSelf()}for(g=0;g<10;g++){var _=u[g];f=this.box_yuansu.getChildByName("sname_"+g);if(_){m=O.ItemUtils.getShuXingByName(_[0]);f.text=m.desc+":"+(_[1]+m.unit),f.color=m.color}else f.removeSelf()}var C,I=s.sssuit1.value.split(","),b=s.sssuit2.value.split(","),w=-1!=I.indexOf(a.pos+""),S=w?I:b,E=w?12:13,T=[];for(g=0;g<S.length;g++){var A=!1,R=+S[g];l&&(A=0!=l[R-1].ins.equid),T.push([R,A])}this.suit_shenbing.initItems(T,V.enumItem.arr_equipPosNameSs);var L=0;if(l)for(g=0;g<l.length;g++){var x=l[g].ins;if(0==x.equid){C=1;break}var P=n[x.equtemplet];if(-1!=S.indexOf(P.pos+"")){if(P){var k=P.suitlv;C=isNaN(C)?k:Math.min(C,k)}L++}}else C=a.suitlv;var D=U.GameConfig.skillOpen[E+"_"+C],H=O.ItemUtils.getSkillDefItem(D.skillId);this.lab_shenbingTitle.text="套装技能";for(g=0;g<10;g++){f=this.box_shenbing.getChildByName("sname_"+g);0==g?(f.text=H.desc,L>=S.length&&(f.color="#d319d3")):f.removeSelf()}r?this.btn_hc.disabled=s.sshcmin.value>=a.suitlv:this.btn_hc.removeSelf();var M=j.RedDotM._ssERed[h],G=this.ani_hand;M&&M[a.pos].eqReplace?(G||(this.ani_hand=G=Y.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_hand,42,1.1,1.1)),G.visible=!0):G&&(G.visible=!1);var B=this.ani_strong;M&&M[a.pos].eqStrong?(B||(this.ani_strong=B=Y.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_strong,42,1.1,1.1)),B.visible=!0):B&&(B.visible=!1)},t}(ui.role.Shenshi.SsTips_EqUI);e.SsTips_Eq=i}),define("src/g/zzsq/ZzsqEnum",["require","exports"],function(t,e){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.ZzsqEnum||(e.ZzsqEnum={})).url="dynamic/zhizunshenqi/",i.urlEff="dynamic2/zhizunshenqi/"}),define("src/g/zzsq/ZzsqUtils",["require","exports","../../component/SAnimation","src/g/Effects/UIEffectsFactory"],function(t,e,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.createAni=function(t,e){var i=new n.SAnimation;return i.width=i.height=600,i.interval=180,i.play(),t.addChild(i),s.UIEffectsFactory.Ins.loadSource(i,e),s.UIEffectsFactory.Ins.alignCenter(i,t),i},t}();e.ZzsqUtils=i}),define("src/g/zzsq/view/ShenQiTip",["require","exports","../../../utils/ItemUtils","src/g/jineng/vo/SkillOpenVo","../../../meta/ShenQiStarLevelVo","src/g/zzsq/ZzsqUtils","../../net/messages/PropFightMain","../../../plugin/sbkPropTool","../../net/messages/sbkFormula","../../../manager/RoleCenter"],function(t,e,v,f,y,m,_,C,I,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(g){function t(t,e){var i=g.call(this)||this;i.txt_name.text=t.name;var n=_.PropFightMain.getins(),s=y.ShenQiStarLevelVo.idArr[y.ShenQiStarLevelVo.costIdArr.indexOf(t.id)];C.sbkPropTool.resetZzsqOne(s,0,1,null,n);var o=I.sbkFormula.calPropFightMainCombat(n)*b.RoleCenter.instans.vo.heronum;i.box_fight.setFightNum(o),n.release();var a=t.effect;m.ZzsqUtils.createAni(i.ani,"dynamic2/zhizunshenqi/"+s+".json");for(var r=0;r<4;r++){var l=i["div_skill"+r+"_0"],h=i["div_skill"+r+"_1"];i.setHtm(l),i.setHtm(h);var c=!1,u=a[r];if("skill"==u[0]){var p=u[1],d=v.ItemUtils.getSkillDefItem(p);i["img_skill"+r].skin=v.ItemUtils.getSkillIconByIconId(d.icon),l.innerHTML='<font color="#09d51f">'+f.SkillOpenVo.getLevelByID(p)+'级</font>强力技能<font color="#ff15fc">【'+d.name+"】</font>",h.innerHTML=d.desc,c=!0}i["box_skill"+r].visible=c}return i}return __extends(t,g),t.prototype.setHtm=function(t){var e=t.style;e.font="SimHei",e.fontSize=18,e.color="#a89e8f",e.leading=5,e.wordWrap=!0},t}(ui.bag.tips.shenqiTIpUI);e.ShenQiTip=i}),define("src/g/twoBlade/view/TwoBladeTipsView",["require","exports","../../../manager/GameSocketManager","../../../manager/RoleCenter","../../../utils/ItemUtils","../../../enum/enumItem","../../../meta/ShuXingVo","../../net/messages/blade/TwoBladeMsg","../../../plugin/sbkPropTool","../../net/messages/sbkFormula","../../net/messages/PropFightMain","../../../utils/system/FloatEffect","src/init/TextConst"],function(t,e,i,h,c,n,a,s,r,l,u,o,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.arr_equip=[],t.btn_up.on(Laya.Event.CLICK,t,t.onUp),t.btn_get.on(Laya.Event.CLICK,t,t.onGet),t.htxt_content.style.color="#a89e8f",t.htxt_content.style.font="SimHei",t.htxt_content.style.fontSize=20,t.htxt_content.style.align="left",t.htxt_content.style.leading=5,t}return __extends(t,e),t.prototype.setEquipData=function(t,e,i,n){if(this.arr_equip=[],this.heroIdx=t,this.eqData=i,this.type=n,this.EquipPos=e,0!=i.equid){this.btn_get.visible=!1,this.box_up.visible=!0,this._evo=c.ItemUtils.getSrEquipVoById(i.equtemplet),this.initEquip(e,i.equtemplet%10);var s=c.ItemUtils.getSrEquipVoById(i.equtemplet+1);s&&(this.costNum=s.uplv[0][1],this.costId=s.uplv[0][0],this.img_need.skin=c.ItemUtils.getIconByIconId(s.icon),this.lab_val.text="x"+this.costNum),this.itemName.text=this._evo.name;for(var o=h.RoleCenter.instans.self.bagdata.equBagData,a=0;a<o.length;a++){var r=o[a];if(!(this.arr_equip.length<this.costNum))break;r.equtemplet==this.costId&&this.arr_equip.push(r.equid)}this.lab_val.color=this.arr_equip.length!=this.costNum?"#ff0f15":"#03bb00",i.equtemplet%10==0?(this.box_up.visible=!1,this.maxLvTxt.visible=!0):this.maxLvTxt.visible=!1,10==n&&(this.box_up.visible=!1,this.btn_get.visible=!1)}else{this.maxLvTxt.visible=!1,this.btn_get.visible=!0,this.box_up.visible=!1;var l=100*n+e;this._evo=c.ItemUtils.getSrEquipVoByPos(l),this.itemName.text=this._evo.name,this.initEquip(e)}},t.prototype.initEquip=function(t,e){void 0===e&&(e=1),this.lab_pos.changeText(n.enumItem.arr_srEquipPosNameNs[t-1]),this.item_.img_item.skin=c.ItemUtils.getIconByIconId(this._evo.icon),this.item_.img_quality.skin=c.ItemUtils.getQualityBjById(this._evo.id),this.item_.lab_num.changeText(""),this.item_.jieBox.visible=!0,this.item_.jieNum.align=0==e?(this.item_.jieNum.value="10",this.item_.jieNum.spaceX=-3,"left"):(this.item_.jieNum.value=e.toString(),this.item_.jieNum.spaceX=0,"center"),this.initBaseInfo(),this.initStrongInfo()},t.prototype.initBaseInfo=function(){for(var t=this._evo.prop,e=0;e<t.length-1;e++){var i=this.vbox_base.getChildByName("box_"+e).getChildByName("base");if(i){var n=c.ItemUtils.getShuXingByName(t[e][0]);i.text=n.desc+":"+a.ShuXingVo.getString4Vo(t[e][1],n),i.color=n.color}}var s=new u.PropFightMain;r.sbkPropTool.reSetProp(s,t,!1);var o=l.sbkFormula.calPropFightMainCombat(s);o+=this._evo.power,this.fightNum.value=o.toString()},t.prototype.initStrongInfo=function(){var t=this._evo.prop,e=this.vbox_intensify.getChildByName("lab_0"),i=c.ItemUtils.getShuXingByName(t[4][0]);e.text=i.desc+":"+a.ShuXingVo.getString4Vo(t[4][1],i),e.color=i.color,this.htxt_content.innerHTML=p.TextConst.get(1174,t[4][1]/100+"%")},t.prototype.onUp=function(){if(this.arr_equip.length==this.costNum){var t=new s.UpBladeEquipC2GS;t.heroidx=this.heroIdx,t.type=this.type,t.pos=this.EquipPos,t.equidArr=this.arr_equip,i.GSM.sendServer(t)}else o.FE.upItems(p.TextConst.get(520))},t.prototype.onGet=function(){this.close()},t.prototype.onClosed=function(){this.arr_equip=[]},t}(ui.twoBlade.TwoBladeTipsViewUI);e.TwoBladeTipsView=d}),define("src/g/bag/tips/view/ItemTips",["require","exports","src/g/custom/detailDlgs/Details_Item","../../../../manager/RoleCenter","src/g/custom/detailDlgs/Details_Equip","src/g/bag/vo/BagDataVo","../../../../utils/ItemUtils","src/g/custom/detailDlgs/CardItemDlg","src/g/forge_new/view/ZhanWenTips","../../../net/messages/sbkEquipIns","../../../../vo/ReXueUtil","src/g/rexue/view/Tips/RxTips_eq","../../../../enum/BagItemType","src/g/shenbing/view/dlg/SbDetail_Equip","src/g/custom/detailDlgs/PassiveTipItem","src/g/custom/detailDlgs/Tips_Fashion","src/g/lottery/view/FragHcDlg","src/g/xingwang/view/XwTips_Eq","../../../../meta/ZhanWenVo","src/g/shenbing/view/dlg/SbItem","src/g/shenshou/view/ShenShouTip","src/g/custom/detailDlgs/Details_Chuanshi","../../../../config/GameConfig","src/g/role/view/SsTips_Eq","src/g/zzsq/view/ShenQiTip","src/g/twoBlade/view/TwoBladeTipsView"],function(t,e,_,p,C,I,b,d,w,S,E,T,A,g,v,f,y,R,L,x,P,k,D,H,M,G){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function m(){return null!==t&&t.apply(this,arguments)||this}return __extends(m,t),Object.defineProperty(m,"ins",{get:function(){return m._ins||(m._ins=new m),m._ins},enumerable:!0,configurable:!0}),m.prototype.showTips=function(t){if(t){var e=-1!=t.type?p.RoleCenter.instans.self.bagdata.getEquip(t.equid):null,i=t.isInBag;if(t.equVo)(n=new C.Details_Equip).initData(null,e),n.popup();else if(t.zwVo){var n=new w.ZhanWenTips,s=p.RoleCenter.instans.vo.bagdata.getZhanwen(t.zwId);n.initData(t.zwVo,s.cfgId),n.popup()}else if(t.fsEquipVo){(n=new C.Details_Equip).initHolyDress(t.fsEquipVo),n.popup()}else if(t.srEquipVo){(n=new G.TwoBladeTipsView).setEquipData(0,t.srEquipVo.pos%100,e,10),n.popup()}else if(t.type==S.enumEquipType.wingEquip){(n=new C.Details_Equip).initWing(t.ewVo),n.popup()}else if(t.type==S.enumEquipType.rxEquip){(o=new T.RxTips_eq).initData(0,0,null,e,!0,!1),o.popup()}else if(t.type==S.enumEquipType.xwEquip){(o=new R.XwTips_Eq).initData(i,null,e),o.popup()}else if(t.type==S.enumEquipType.ssEquip){var o;(o=new H.SsTips_Eq).initData(i,e,!1),o.popup()}else{var a=t.ItmVo,r=a.id,l=a.type,h=t.num;if(l==A.BagItemType.tujian){var c=new d.CardItemDlg;c.initData(a,h,i),c.popup()}else if(240<=r&&r<=257){var u=new v.PassiveTipItem;u.initData(a,h,i),u.popup()}else if(l==A.BagItemType.shenbingshengwu){(n=new g.SbDetail_Equip).initData(a,h,0==h?0:2),n.popup()}else if(l==A.BagItemType.shizhuang){(n=new f.Tips_Fashion).initDataByFashion(r,i),n.popup()}else if(6e3<r&&r<7e3){(n=new f.Tips_Fashion).initDataByTitle(r,i),n.popup()}else if(220==r){(n=new x.SbItem).initData(a,h,i,t.liveTime),n.popup()}else if(l==A.BagItemType.suipianhecheng){(n=new y.FragHcDlg).initData(a,h,i),n.popup()}else if(l==A.BagItemType.shenshoutip){(n=new P.ShenShouTip(a,h)).popup()}else if(l==A.BagItemType.jieling){(n=new P.RingTip(a,h)).popup()}else if(l==A.BagItemType.shenqi){(n=new M.ShenQiTip(a,h)).popup()}else if(l==A.BagItemType.chuanshi){(n=new k.Details_Chuanshi(a,h)).popup()}else if(l==A.BagItemType.shuangren){(n=new k.Details_Chuanshi(a,h,!0)).popup()}else{(n=new _.Details_Item).initData(a,h,i,t.liveTime),n.popup()}}}},m.prototype.showTip=function(t,e,i){void 0===i&&(i=null);var n=b.ItemUtils.getCurrencyVoByDefine(t);if(n&&n.define){var s=new _.Details_Item;return s.initData_CurrencyVo(n,e),void s.popup()}var o=b.ItemUtils.getItemVoById(t);if(o)if(o.type==A.BagItemType.part&&0<o.effect.length){var a=new w.ZhanWenTips,r=L.ZhanWenStruct.Ins.getZhanWenVo(o.quality,1);a.initData(r,o.id),a.popup()}else{var l=new I.BagDataVo;l.id=t,l.ItmVo=o,l.num=e,m.ins.showTips(l)}else{var h=b.ItemUtils.getEquipVoById(t);if(h){var c=new C.Details_Equip;return c.initData(null,i,h),void c.popup()}var u=b.ItemUtils.getWingEquipVoById(t);if(u){var p=new C.Details_Equip;return p.initWing(u),void p.popup()}if(E.ReXueUtil.getEquipVoById(t)){var d=new T.RxTips_eq;return(i=new S.sbkEquipIns).equtemplet=t,d.initData(0,0,null,i,!0,!1),void d.popup()}if(b.ItemUtils.getXwEquipVoById(t)){d=new R.XwTips_Eq;return i||((i=new S.sbkEquipIns).equtemplet=t),d.initData(!1,null,i),void d.popup()}if(D.GameConfig.SSEquip[t]){d=new H.SsTips_Eq;return(i=new S.sbkEquipIns).equtemplet=t,d.initData(!1,i,!1),void d.popup()}var g=D.GameConfig.fsequipjson[t];if(g){var v=new C.Details_Equip;return v.initData(null,i,g),void v.popup()}var f=D.GameConfig.bladeequipjson[t];if(f){var y=new G.TwoBladeTipsView;(i=new S.sbkEquipIns).equid=f.id,i.equtemplet=t,y.setEquipData(0,f.pos%100,i,10),y.popup()}}},m.cellShowTip=function(t,e,i,n){void 0===n&&(n=null),t.offAll(),t.on(Laya.Event.CLICK,this,function(){m.ins.showTip(e,i,n)})},m}(ui.bag.tips.itemTipsUI);e.ItemTips=i}),define("src/g/guide/vo/RewardVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){this.res="",this.count=0,this.quality="",this.qualityNum=0,this.name="",this.job=0,this.lv=0,this.type=0,this.define="",this.streamer=0};e.RewardVo=i}),define("src/g/account/view/AccItem",["require","exports","../../../enum/enumItem","../../../utils/ItemUtils","src/g/bag/tips/view/ItemTips","../../../meta/CurrencyVo","src/g/Effects/UIEffectsFactory","../../../meta/QualiyVo","../../../config/GameConfig","src/init/TextConst"],function(t,e,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.starNum=0,t}return __extends(t,e),Object.defineProperty(t.prototype,"eqData",{set:function(t){var e=t.id,i=t.type,n=this.lv_txt;if(this.ani_sp.visible=!1,this.iconSkin.skin=t.res,this.ani_sp.destroyChildren(),this.setStarSmall(),t.streamer)this.ani_sp.visible=!0,c.UIEffectsFactory.Ins.createSAniAndCenter(this.ani_sp,t.streamer);else{var s=u.QualityStruct.Ins.getQualityVo(t.qualityNum);s&&s.effect&&0<s.effect&&(this.ani_sp.visible=!0,c.UIEffectsFactory.Ins.createSAniAndCenter(this.ani_sp,u.QualityStruct.Ins.getQEffById(t.qualityNum)))}i==a.ItemType.CURRENCY?(1e4<=t.count?this.countNum.text=d.TextConst.get(1,Math.floor(t.count/1e3)/10):(this.countNum.text=t.count+"",t.count<=1&&(this.countNum.text="")),this.pinzhi.skin=r.ItemUtils.getQualitybjByQualityId(t.qualityNum)):i==a.ItemType.EQ||i==a.ItemType.REXUE?this.countNum.text="":i==a.ItemType.ITEM?(this.countNum.text=t.count+"",t.count<=1&&(this.countNum.text="")):i==a.ItemType.ZHANWEN?this.countNum.text="":i==a.ItemType.WING&&(this.countNum.text=""),e&&(this.pinzhi.skin=r.ItemUtils.getQualityBjById(e));var o=u.QualityStruct.Ins.getQualityVo(t.qualityNum);n.color=o?o.color:t.quality,1e4<e&&-1!=t.job&&i!=a.ItemType.WING?n.text=r.ItemUtils.getEquipLv(t.lv):n.text=t.name,i==a.ItemType.REXUE?(this.job_icon.skin="",n.text=d.TextConst.get(3,e%100),this.setStarSmall(e%10)):this.job_icon.skin=r.ItemUtils.getJobIcon(t.job),p.GameConfig.SSEquip[e]&&(n.text=t.name),p.GameConfig.fsequipjson[e]&&(n.text=t.name),p.GameConfig.bladeequipjson[e]&&(n.text=t.name),this.offAll(),this.on(Laya.Event.CLICK,this,function(){i!=a.ItemType.ZHANWEN?l.ItemTips.ins.showTip(t instanceof h.CurrencyVo?t.define:e,t.count):l.ItemTips.ins.showTip(t.id,t.count)})},enumerable:!0,configurable:!0}),t.prototype.setStarSmall=function(t){if(void 0===t&&(t=0),this.starNum!=t){this.hbox_star.removeChildren();for(var e=0;e<t;e++){var i=new Laya.Image("res/custom/rexue_xingxing.png");this.hbox_star.addChild(i)}this.hbox_star.width=18*t,this.hbox_star.x=(this.width-this.hbox_star.width)/2,this.starNum=t}},t}(ui.account.AccItemUI);e.AccItem=i}),define("src/g/account/view/AccountView",["require","exports","src/g/account/view/AccItem"],function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function n(){var t=i.call(this)||this;return t.popupEffect=null,t.list.itemRender=s.AccItem,t.list.repeatX=4,t.list.repeatY=4,t.list.selectEnable=!0,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=100,t.list.renderHandler=new Laya.Handler(t,t.rendHandler),t}return __extends(n,i),n.prototype.rendHandler=function(t,e){t.eqData=this.list.array[e],t.scale(1,1)},n.prototype.popup=function(t,e){Laya.timer.clearAll(this),this.img_bg.rotation=0,Laya.timer.loop(120,this,function(){this.img_bg.rotation+=10}),i.prototype.popup.call(this,t,e),n.isShow=!0},n.prototype.close=function(t,e){Laya.timer.clearAll(this),Laya.timer.clearAll(this.img_bg),i.prototype.close.call(this,t,e),n.isShow=!1},n.isShow=!1,n}(ui.account.GameEndUI);e.AccountView=i}),define("src/g/fight/info/PlayTypeVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function a(){}return a.create=function(t,e,i,n,s){void 0===e&&(e=null),void 0===i&&(i=!0),void 0===n&&(n=!0),void 0===s&&(s=!0);var o=new a;return o.playType=t,o.data=e,o.clear=i,o.changeMap=n,o.canReturn=s,o},a}();e.PlayTypeVo=i}),define("src/g/guide/ctrl/GuaJIGudeViewCtrl",["require","exports","../../../enum/Task","../../../manager/TaskManager","../../../enum/EventName","../../../core/E"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){}return t.prototype.init=function(){o.E.ins.once(s.EventName.TASK_CHANGE,this,this.taskGuaJiHandler)},t.prototype.taskGuaJiHandler=function(){n.TaskManager.ins.currentTask&&n.TaskManager.ins.currentTask.type==i.TaskType.IntoAutoCopy&&o.E.ins.event(s.EventName.GUIDE_END)},t}();e.GuaJIGudeViewCtrl=a}),define("src/g/fight/osprite/NetCtroller",["require","exports","../../net/messages/PutonEquipC2GS","../../net/messages/FightStartC2GS","../../net/messages/FinishMissionC2GS","../../../manager/GameSocketManager","../../net/messages/FightEndC2GS","../../net/messages/MeetPKC2GS","../../net/messages/ActivityMessage","../../net/messages/SweepFightMsg"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(){}return t.on=function(t,e,i){this._ins.on(t,e,i)},t.off=function(t,e,i){this._ins.off(t,e,i)},t.init=function(){},t.finishTask=function(t,e){this._taskDot.finishid=t,this._taskDot.nextid=e,o.GSM.sendServer(this._taskDot)},t.goToTask=function(t,e){var i=new s.FinishMissionC2GS;i.finishid=t,i.nextid=e,i.fmtype=s.MissionType.MissionGM,o.GSM.sendServer(i)},t.fightStartC2GS=function(t,e,i){this._fightS.isboss=t,this._fightS.monsterids=e,this._fightS.portid=i,o.GSM.sendServer(this._fightS)},t.fightEndC2GS=function(t,e,i){this._fightE.portid=t,this._fightE.fightid=e,this._fightE.win=i,o.GSM.sendServer(this._fightE)},t.meetPkStart=function(t,e,i,n){void 0===n&&(n=r.EMPKTYPE.meetuser),this._meetPKStart.npcUsername=t,this._meetPKStart.npcNickname=e||"",this._meetPKStart.reserve1=i||0,this._meetPKStart.pktype=n,o.GSM.sendServer(this._meetPKStart)},t.JoinInQMBossCopy=function(t,e){void 0===t&&(t=202);var i=new l.JoinInActivityC2GS;i.acttype=e,i.actid=t,o.GSM.sendServer(i)},t.ExitQMBossCopy=function(t,e){void 0===t&&(t=202);var i=new l.ExitActivityC2GS;i.acttype=e,i.actid=t,o.GSM.sendServer(i)},t.sendSweepMatCopy=function(t){var e=new h.SweepFightC2GS;e.sftype=h.ESweepFightType.MatCopy,e.portid=t,o.GSM.sendServer(e)},t.sendSweepSelfBoss=function(t){var e=new h.SweepFightC2GS;e.sftype=h.ESweepFightType.PrivateBoss,e.portid=t,o.GSM.sendServer(e)},t.getLastFightWin=function(){return this._fightE.win},t.putonEquipC2GS=function(t,e,i){this._eqS.equid=t,this._eqS.heroidx=e,this._eqS.equpos=i,o.GSM.sendServer(this._eqS)},t.pickUpReward=function(){},t._ins=new Laya.EventDispatcher,t._taskDot=new s.FinishMissionC2GS,t._fightS=new n.FightStartC2GS,t._fightE=new a.FightEndC2GS,t._meetPKStart=new r.MeetPKStartC2GS,t._eqS=new i.PutonEquipC2GS,t}();e.NetCtroller=c}),define("src/g/guide/view/GuideEndView",["require","exports","../../../enum/EventName","../../../core/E","../../../manager/GameSocketManager","../../net/messages/OpNoParaC2GS","../../../manager/TaskManager","src/g/fight/osprite/NetCtroller","../../../manager/RoleCenter","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t.start_btn.once(Laya.Event.CLICK,t,t.endHandler),t}return __extends(t,e),t.prototype.endHandler=function(){this.removeSelf(),this.destroy(!0),Laya.loader.clearRes("res/guide/xinshou_guaji.png",!0);var t=new o.OpNoParaC2GS;s.GSM.sendServer(t),a.TaskManager.ins.currentTask&&r.NetCtroller.finishTask(a.TaskManager.ins.currentTask.id,a.TaskManager.ins.currentTask.follow),l.RoleCenter.instans.self.newbee=!1,n.E.ins.event(i.EventName.GUAJI_CLICK_FIRST),n.E.ins.event(i.EventName.BACK_INDEX),h.ClearResM.clearUrl(this.bgimg.skin)},t}(ui.guide.GuideEndViewUI);e.GuideEndView=c}),define("src/g/guide/ctrl/GuideEndCtrl",["require","exports","src/g/Effects/UIEffectsFactory","../../../manager/LayerManager","../../../enum/EventName","../../../core/E","src/g/guide/view/GuideEndView"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.prototype.init=function(){o.E.ins.on(s.EventName.GUIDE_END,this,this.initView),o.E.ins.once(s.EventName.BACK_INDEX,this,this.destroyHandler)},t.prototype.destroyHandler=function(){this._view=null,this._uEf&&this._uEf.destroy(),Laya.loader.clearRes(i.UIEffectsFactory.Ins.getSourceUrlById(24),!0)},t.prototype.initView=function(){this._view||(this._view=new a.GuideEndView),Laya.timer.once(10,this,function(){n.LayerManager.addGuideLayer(this._view,!0),this._uEf=i.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this._view.start_btn,24)})},t}();e.GuideEndCtrl=r}),define("src/g/guide/view/WelcomeView",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initUIEffects=function(){},e}(ui.guide.GuideViewUI);e.WelcomeView=i}),define("src/g/guide/view/EqRightView",["require","exports","../../../manager/RoleCenter","../../net/messages/PutonEquipC2GS","../../../config/GameConfig","src/g/fight/osprite/NetCtroller","../../../core/E","../../../enum/EventName","../../../utils/ItemCellUtils","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t.count=0,t.btn_eq.on(Laya.Event.CLICK,t,t.clikHandler),t.x=300,t}return __extends(t,e),t.prototype.clikHandler=function(){for(var t in Laya.timer.clearAll(this),this.removeSelf(),s.GameConfig.blessJSON){var e=s.GameConfig.blessJSON[t];if(e.pos==this._evo.pos){o.NetCtroller.putonEquipC2GS(this._vo.equid,0,e.pos),this._evo.pos==n.EPosEquip.wuqi?(i.RoleCenter.instans.weaponID=this._evo.weaponRes,a.E.ins.event(r.EventName.EQUIPS_PUTON+this._evo.job+n.EPosEquip.wuqi,this._evo.weaponRes)):this._evo.pos==n.EPosEquip.yifu&&(i.RoleCenter.instans.roleID=this._evo.roleRes,a.E.ins.event(r.EventName.EQUIPS_PUTON+this._evo.job+n.EPosEquip.yifu,this._evo.roleRes));break}}},Object.defineProperty(t.prototype,"eqData",{set:function(t){this._vo=t,this._evo=s.GameConfig.equipJSON[t.equtemplet],this.x=Laya.stage.width,this.y=Laya.stage.height-this.height-200;this.y;var e=this.x;Laya.Tween.to(this,{x:e-this.width},200),l.ItemCellUtils.fillCellForItemNameView(this.item,t.equtemplet,1),this.eq_name.text=this._evo.name,this.zhandouli.text=h.TextConst.get(80,t.combat),this.img_zdl.x=this.zhandouli.x+this.zhandouli.width,Laya.timer.clearAll(this),this.count=5,this.timetxt.text=this.count+"s",Laya.timer.loop(1e3,this,this.updateHandler)},enumerable:!0,configurable:!0}),t.prototype.updateHandler=function(t){this.count--,this.timetxt.text=this.count+"s",this.count<=0&&this.clikHandler()},t}(ui.guide.EqViewUI);e.EqRightView=c}),define("src/g/peronboss/view/ItemIconView",["require","exports","../../../utils/ItemUtils","../../../utils/StringUtils","src/g/bag/tips/view/ItemTips","../../../meta/CurrencyVo","src/g/Effects/UIEffectsFactory","../../../meta/TitleVo","../../../meta/ItemVo","../../../meta/QualiyVo","src/init/TextConst","../../../meta/EquipVo","../../../config/GameConfig"],function(t,e,r,l,h,c,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(n){function i(t,e){void 0===t&&(t=.7),void 0===e&&(e=22);var i=n.call(this)||this;return i.scale(t,t),i.jobicon.scale(1.6,1.6),i.lvl.fontSize=e,i}return __extends(i,n),i.prototype.setData=function(t,e){void 0===e&&(e=0),i.setItemData(t,this,e)},i.setItemData=function(t,e,i){if(void 0===i&&(i=0),t){if(t.limit?e.lvl.text=r.ItemUtils.getEquipLv(t.limit):e.lvl.text=t.name,t instanceof p.TitleVo&&(e.lvl.text=t.name),1e4<t.id&&(5e4<t.id?e.lvl.text=v.TextConst.get(3,t.id%100):t.job||(e.lvl.text=t.name)),e.fsjob.skin="",y.GameConfig.fsequipjson[t.id]&&(e.lvl.text=t.name,e.jobicon.visible=!1,e.fsjob.visible=!0,e.fsjob.skin=r.ItemUtils.getfsJobIcon(t.job)),i<=1&&(e.count_txt.visible=!1),e.ani_sp.removeChildren(),t instanceof d.ItemVo){if(0<t.streamer){var n=u.UIEffectsFactory.Ins.createUIAniById(t.streamer,!0);u.UIEffectsFactory.Ins.centered4Parent(n,e.ani_sp,!0)}}else if(t instanceof c.CurrencyVo){if(0<t.streamer){n=u.UIEffectsFactory.Ins.createUIAniById(t.streamer,!0);u.UIEffectsFactory.Ins.centered4Parent(n,e.ani_sp,!0)}}else if(t instanceof f.EquipVo){var s=g.QualityStruct.Ins.getQEffByEquipVo(t);0<s&&u.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(e.ani_sp,s)}else{var o=g.QualityStruct.Ins.getQualityVo(t.quality);if(o&&o.effect&&0<o.effect){n=u.UIEffectsFactory.Ins.createUIAniById(g.QualityStruct.Ins.getQEffById(t.quality),!0);u.UIEffectsFactory.Ins.centered4Parent(n,e.ani_sp,!0)}}var a=t.quality;t instanceof f.EquipVo&&(a=g.QualityStruct.Ins.transEquipQuality(t)),0==a&&(a=1),e.qicon.skin=r.ItemUtils.getQualitybjByQualityId(a),e.icon.skin=r.ItemUtils.getIconByIconId(t.icon),e.jobicon.skin=r.ItemUtils.getJobIcon(t.job),e.lvl.color=g.QualityStruct.Ins.getQColorById(a),e.count_txt.text="",1<i&&(e.count_txt.text=l.StringUtils.NumString(i),e.count_txt.visible=!0),e.offAll(),e.on(Laya.Event.CLICK,this,function(){h.ItemTips.ins.showTip(t instanceof c.CurrencyVo?t.define:t.id,i)})}},i.setItem=function(t,e){if(t){var i=r.ItemUtils.getItemOrEq(e[0]);t.icon.skin=r.ItemUtils.getSmallIcon(i.icon),t.valeu_txt.text="X"+e[1]}},i}(ui.boss.IconItemUI);e.ItemIconView=i}),define("src/g/guide/view/EqViewLeft",["require","exports","src/g/Effects/UIEffectsFactory","../../../component/UDEffect","../../../manager/TaskManager","src/g/fight/osprite/NetCtroller","../../../utils/SoundUtils","../../../utils/ItemUtils","../../../manager/LayerManager","../../../utils/ItemCellUtils","../../../manager/RoleCenter","../../../meta/EquipVo","src/init/TextConst"],function(t,e,i,n,a,s,r,l,h,o,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.ef=new n.UDEffect,t.count=0,t.y=200,t.get_btn.on(Laya.Event.CLICK,t,t.getRewardHandler),t.btn_close.on(Laya.Event.CLICK,t,t.doCloseHandler),t.list_con.itemRender=ui.custom.ItemNameViewUI,t.list_con.renderHandler=new Laya.Handler(t,t.onListRender),t.list_con.spaceX=-13,t}return __extends(t,e),t.prototype.onListRender=function(t,e){o.ItemCellUtils.fillCellForItemNameView(t,this.list_con.array[e][0],Number(this.list_con.array[e][1]))},t.prototype.showGuideEffects=function(){this._uiEff&&this._uiEff.removeSelf(),this._uiEff=i.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.get_btn,24),this.get_btn.label=p.TextConst.get(203)},t.prototype.getRewardHandler=function(){a.TaskManager.checkBagRoomEnough()&&(a.TaskManager.ins.currentTask&&s.NetCtroller.finishTask(a.TaskManager.ins.currentTask.id,a.TaskManager.ins.currentTask.follow),a.TaskManager.ins.active||(a.TaskManager.ins.active=!0),this.doCloseHandler())},t.prototype.doCloseHandler=function(){this.removeSelf(),Laya.timer.clear(this,this.timeHandler),this.ef.clear(),Laya.Loader.clearRes(this.img_npc.skin,!0),this.img_npc.skin=null},Object.defineProperty(t.prototype,"eqData",{set:function(t){this.vo=t,this.jiantou.visible=!1,this.time_txt2.visible=this.time_txt.visible=!1;var e=a.TaskManager.ins.currentTask;if(e&&e.npcId==t.NpcID){a.TaskManager.ins.isFinish=!0,r.SoundUtils.getInstance().playNpcSound(t.soundId),this.talkdialoge.text=e.taskDialoga,this.updateNpcInfo(t);for(var i,n=e.bonus.concat(),s=n.length-1,o=c.RoleCenter.instans.vo.jobId;0<=s;)(i=l.ItemUtils.getItemOrEq(n[s][0]))instanceof u.EquipVo&&i.job!=o&&n.splice(s,1),s--;this.list_con.array=n,this.count=5,this.timeHandler(),this.jiantou.visible=!0,this.time_txt2.visible=this.time_txt.visible=!0,this.ef.effect(this.jiantou,20,300),h.LayerManager.addGuideLayer(this,!0),this.showGuideEffects(),this.get_btn.visible=!0,this.btn_close.visible=!1}else!t.moduleID&&t.Taskdialoge&&(this.talkdialoge.text=t.Taskdialoge,this.updateNpcInfo(t),this.list_con.array=null,h.LayerManager.addGuideLayer(this,!0),this.get_btn.visible=!1,this.btn_close.visible=!0)},enumerable:!0,configurable:!0}),t.prototype.updateNpcInfo=function(t){var e=this;this.npc_name.text=t.name,this.img_npc.visible=!1,this.img_npc.on(Laya.Event.LOADED,this,function(){e.img_npc.visible=!0}),t.npcimg?this.img_npc.skin="dynamic/tasknpc/"+t.npcimg+".png":this.img_npc.skin="dynamic/tasknpc/1.png"},t.prototype.timeHandler=function(){this.time_txt.text=this.count+"s",this.count--,0<this.count?Laya.timer.once(1e3,this,this.timeHandler):(Laya.timer.clearAll(this),this.getRewardHandler())},t}(ui.guide.LeftViewUI);e.EqViewLeft=d}),define("src/g/guide/ctrl/NewComerCtrl",["require","exports","src/g/guide/ctrl/GuaJIGudeViewCtrl","src/g/guide/ctrl/GuideEndCtrl","../../net/messages/FinishMissionGS2C","../../../manager/GameSocketManager","../../../manager/TaskManager","src/g/guide/view/WelcomeView","../../../manager/LayerManager","../../../manager/RoleCenter","../../../config/GameConfig","src/g/guide/view/EqRightView","src/g/guide/view/EqViewLeft","../../../enum/EventName","../../../core/E","src/g/clearRes/ClearResM","../../../enum/TaskCofigEnum"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(){function t(){(new n.GuideEndCtrl).init(),(new i.GuaJIGudeViewCtrl).init()}return t.prototype.init=function(){o.GSM.ins.on(s.FinishMissionGS2C.KEY,this,this.popTaskHandler),this.startNewcomer(),g.E.ins.on(d.EventName.POPTASK,this,this.checkNext)},t.prototype.onViewDeatroy=function(){this.eqLeft&&this.eqLeft.destroy(!0),this.rightView&&this.rightView.destroy(!0)},t.prototype.popTaskHandler=function(t){if(h.RoleCenter.instans.self.newbee){if(t.opresult)for(var e=t.reward.equipList,i=0;i<e.length;i++){var n=e[i].equtemplet;h.RoleCenter.instans.self.bagdata,c.GameConfig.equipJSON[n].job==h.RoleCenter.instans.jobID&&(this.rightView||(this.rightView=new u.EqRightView),this.rightView.eqData=e[i],l.LayerManager.addGuideLayer(this.rightView,!1))}}else o.GSM.ins.off(s.FinishMissionGS2C.KEY,this,this.popTaskHandler)},t.prototype.startNewcomer=function(){(a.TaskManager.ins.currentTask?a.TaskManager.ins.currentTask.id:0)==f.TaskCofigEnum.startTask?(this.welcome=new r.WelcomeView,this.welcome.once(Laya.Event.CLICK,this,this.startGuideHandler),l.LayerManager.addGuideLayer(this.welcome,!0)):a.TaskManager.ins.active=!0},t.prototype.startGuideHandler=function(){this.welcome.destroy(),a.TaskManager.ins.active=!0,g.E.ins.event(d.EventName.TASK_CHANGE),v.ClearResM.clearUrl(this.welcome.bg.skin)},t.prototype.checkNext=function(t){if(!t){var e=c.GameConfig.NPCJSON,i=a.TaskManager.ins.currentTask.id;for(var n in e)e[n].TaskID==i&&(t=Number(n))}var s=c.GameConfig.NPCJSON[t];this.eqLeft||(this.eqLeft=new p.EqViewLeft),this.eqLeft.eqData=s},t}();e.NewComerCtrl=y}),define("src/g/guide/view/GuideTipDownView",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setTip=function(t){this.txt.text=t},e}(ui.guide.GuideTipDownUI);e.GuideTipDownView=i}),define("src/init/GameState",["require","exports","../core/E","../enum/EventName","../utils/MathUtils"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){}return Object.defineProperty(t,"battle_state",{get:function(){return this._battle_state},set:function(t){this._battle_state!=t&&(this._battle_state=t,i.E.ins.event(n.EventName.BATTLE_STATE_CHANGED))},enumerable:!0,configurable:!0}),t.addBattleState=function(t){this.battle_state=s.MathUtils.addBit(this.battle_state,t)},t.subBattleState=function(t){this.battle_state=s.MathUtils.subBit(this.battle_state,t)},t.checkNeedClear=function(){return console.log("内存大小",Laya.ResourceManager.systemResourceManager.memorySize),!1},t.joint_attack_guide_state=!1,t.transmitting=!1,t.task_guide_mask_show=!1,t.clientChangeHp=!1,t._battle_state=0,t.battle_state_heji=1,t.chat_supervision_open=!0,t.ban_chat_send_to_sever=0,t.index_first_recharge_state=0,t.index_top_offsetY=0,t.enterkffail=!1,t.passCreateRole=!1,t.my_team_uid=0,t}();e.GameState=o}),define("src/g/index/view/TaskLeftView",["require","exports","../../../enum/Task","src/g/Effects/UIEffectsFactory","../../../enum/EventName","../../../core/E","../../../manager/TaskManager","../../../manager/RoleCenter","src/g/fight/osprite/NetCtroller","../../../utils/ItemUtils","../../net/messages/OpResultType","../../../enum/GuideTargetName","src/g/guide/view/GuideTipDownView","../../../component/UDEffect","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/init/Switches","../../../manager/GameSocketManager","../../../utils/UIUtils","../../../manager/FlyManager","src/init/GameState","../../../utils/MathUtils","../../../manager/AM","src/init/TextConst"],function(t,e,p,i,d,g,v,f,o,y,m,n,s,a,r,l,h,c,u,_,C,I,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var S=function(e){function t(){var t=e.call(this)||this;return t.htmPool=[],t.ef=new a.UDEffect,t._lastSubmitTime=0,t._currTaskId=0,t.hasShowClick=!1,t.y=Laya.stage.height-270,t.centerX=0,t.con_des.scrollRect=new Laya.Rectangle(0,0,t.con_des.width,t.con_des.height),v.TaskManager.ins.active?t.initEvent():g.E.ins.once(d.EventName.AUTO_TASK_ACTIVE_CHANGE,t,t.initEvent),t.updateVisible(),t}return __extends(t,e),t.prototype.initEvent=function(){v.TaskManager.ins.currentTask&&(this.isStart=!0,g.E.ins.on(d.EventName.TASK_CHANGE,this,this.updateHandler),g.E.ins.on(d.EventName.TASK_KILL_PROGRESS,this,this.updateHandler),g.E.ins.on(d.EventName.CHANGE_PORT_MODE,this,this.updateHandler),g.E.ins.on(d.EventName.TASK_DATA_CHANGED,this,this.updateHandler),g.E.ins.on(d.EventName.REFRESH_TASK,this,this.updateHandler),g.E.ins.on(d.EventName.AUTO_TASK_ACTIVE_CHANGE,this,this.onAutoTaskActiveChanged),this.on(Laya.Event.CLICK,this,this.emptyHandler),Laya.timer.once(2e3,this,this.delayHandler),Laya.timer.once(1e3,this,this.updateHandler),g.E.ins.on(d.EventName.ENTER_SUB_GAMEPLAY,this,this.onEnterBoss),g.E.ins.on(d.EventName.EXIT_SUB_GAMEPLAY,this,this.onOutBoss),g.E.ins.on(d.EventName.BATTLE_STATE_CHANGED,this,this.updateVisible))},t.prototype.removeEvents=function(){g.E.ins.off(d.EventName.TASK_CHANGE,this,this.updateHandler),g.E.ins.off(d.EventName.TASK_KILL_PROGRESS,this,this.updateHandler),g.E.ins.off(d.EventName.CHANGE_PORT_MODE,this,this.updateHandler),g.E.ins.off(d.EventName.TASK_DATA_CHANGED,this,this.updateHandler),g.E.ins.off(d.EventName.REFRESH_TASK,this,this.updateHandler),g.E.ins.off(d.EventName.AUTO_TASK_ACTIVE_CHANGE,this,this.onAutoTaskActiveChanged),g.E.ins.off(d.EventName.ENTER_SUB_GAMEPLAY,this,this.onEnterBoss),g.E.ins.off(d.EventName.EXIT_SUB_GAMEPLAY,this,this.onOutBoss),g.E.ins.off(d.EventName.BATTLE_STATE_CHANGED,this,this.updateVisible)},t.prototype.onAutoTaskActiveChanged=function(t){this.event_layer.off(Laya.Event.CLICK,this,this.reStartTask),Laya.timer.clear(this,this.addGuideArrow),t||1850!=v.TaskManager.ins.currentTask.id&&(f.RoleCenter.instans.vo.newbee&&Laya.timer.once(3e3,this,this.addGuideArrow),this.event_layer.on(Laya.Event.CLICK,this,this.reStartTask))},t.prototype.reStartTask=function(){c.GSM.connected&&(v.TaskManager.ins.active=!0,Laya.timer.clear(this,this.addGuideArrow),this.removeGuideArrow())},t.prototype.createHtml=function(){var t=new Laya.HTMLDivElement;return t.style.font="SimHei",t.style.fontSize=16,t.width=this.width,t.style.color="#c0b4a3",t.style.align="center",t},t.prototype.delayHandler=function(){this.initUIEffects()},t.prototype.emptyHandler=function(){},t.prototype.onEnterBoss=function(){this._enterBoss=!0,this.updateVisible()},t.prototype.onOutBoss=function(){this._enterBoss=!1,this.updateVisible()},t.prototype.initUIEffects=function(){this.ani_get_task=i.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.bgsp,18,1,1,"gift"),this.ani_get_task.mouseEnabled=!1,this.bgsp.addChild(this.ani_get_task),this.ani_get_task.visible=!v.TaskManager.ins.isFinish,this.ani_task_complet=i.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.bgsp,52,1,1,"effect"),this.ani_task_complet.visible=v.TaskManager.ins.isFinish,this.ani_task_complet.mouseEnabled=!1,this.bgsp.addChild(this.ani_task_complet)},t.prototype.showAni=function(t){this.ani_task_complet&&(this.ani_task_complet.visible=1==t),this.ani_get_task&&(this.ani_get_task.visible=2==t)},t.prototype.addGuideArrow=function(t){void 0===t&&(t=!0),this._uEf&&(this._uEf.clear(),this._uEf=null),this._uEf=i.UIEffectsFactory.Ins.createSAniById(24),i.UIEffectsFactory.Ins.centerSAni4Parent(this._uEf,this),t&&(this._downview||(this._downview=new s.GuideTipDownView,this._downview.setTip(w.TextConst.get(603)),this._downview.x=this.width/2,this._downview.y=this.height/2-50),this.addChild(this._downview),this.ef.effect(this._downview,20,300))},t.prototype.removeGuideArrow=function(){this._downview&&this._downview.removeSelf(),this._uEf&&this._uEf.removeSelf(),this.ef.clear()},t.prototype.onClickHandler=function(){if(c.GSM.connected){Laya.timer.clear(this,this.autoSubmitTask),Laya.timer.clear(this,this.showClickPrompt),this.removeGuideArrow(),g.E.ins.event(d.EventName.COMPTYPE_CLICK,n.GuideTargetName.TASK_LEFT_VIEW);var t=v.TaskManager.ins.currentTask,e=!1;if(t.type==p.TaskType.CompleteOnePort)3==y.ItemUtils.getPortVoById(t.target).type?t.target<f.RoleCenter.instans.self.portstatus.portindex&&(e=!0):1<=f.RoleCenter.instans.self.taskdata.need&&(e=!0);else t.type==p.TaskType.PutonEquipment?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.StrongthEquip?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.CultivateGem?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.InjSoulIntoEquipment?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.MintSoul?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.PromoteSkill?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.MeltEquipment?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.killPrivateBoss?1<=f.RoleCenter.instans.self.taskdata.need&&(e=!0):t.type==p.TaskType.killMonthBoss?1<=f.RoleCenter.instans.self.taskdata.need&&(e=!0):t.type==p.TaskType.ReachLevel?f.RoleCenter.instans.self.lvl>=t.target&&(e=!0):t.type==p.TaskType.CultivateWing?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.KillPortBoss?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.killMeetBoss?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.killChallengeBoss?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.CultivateMedal?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.ReachRebirthLevel?f.RoleCenter.instans.self.zhuanshengLv>=t.target&&(e=!0):t.type==p.TaskType.CompleteMainPort?1<=f.RoleCenter.instans.self.taskdata.need&&(e=!0):t.type==p.TaskType.CompleteChangeCopy?f.RoleCenter.instans.self.portPagoda.secPortId>t.target&&(e=!0):t.type==p.TaskType.CultivateJingmai?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.CultivateShield?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.CultivateDragonSoul?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.relic_fragment_activate?1<=f.RoleCenter.instans.self.taskdata.need&&(e=!0):t.type==p.TaskType.KillMonstersGroup?f.RoleCenter.instans.self.taskdata.need>=t.need?e=!0:r.FE.upItems(w.TextConst.get(604),l.BubbleEnum.center):t.type==p.TaskType.reilc_activation?f.RoleCenter.instans.vo.Relic.relicId>=t.target&&(e=!0):t.type==p.TaskType.pickUp?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.KillMonsters?f.RoleCenter.instans.self.taskdata.need<t.need&&r.FE.upItems(w.TextConst.get(604),l.BubbleEnum.center):t.type==p.TaskType.exp_copy?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.field_fight?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.put_on_quality_equip?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.open_hero?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.soul_upgrade?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.fuwen_puton?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.fuwen_strongth?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.ring_active?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.daily_task?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.time_limit_task?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.intoGuideCopy?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.faqi_fragment_activation?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.hit_boss_getshenzhuang?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.fightNum_change?f.RoleCenter.instans.vo.combat>=t.target&&(e=!0):t.type==p.TaskType.ring_task?f.RoleCenter.instans.self.taskdata.need>=t.need&&(e=!0):t.type==p.TaskType.faqi_activation?-1<f.RoleCenter.instans.vo.comboData.curHunYinJieArr.indexOf(t.target)&&(e=!0):t.type==p.TaskType.popStageRelic&&f.RoleCenter.instans.vo.Relic.relicId>=t.target&&(e=!0);e?this.submitTask():t.type==p.TaskType.CompleteOnePort?g.E.ins.event(d.EventName.ENTER_PORT_COPY):t.type==p.TaskType.popStageRelic?g.E.ins.event(d.EventName.RELIC_DIALOG_POP):t.moduleID&&0<t.moduleID.length&&h.Switches.ins.event(t.moduleID[0][1],t.moduleID[1][1])}},t.prototype.autoSubmitTask=function(){this.submitTask()},t.prototype.submitTask=function(){var t=Date.now();if(t-this._lastSubmitTime<1e3)console.log("任务频繁提交");else if(f.RoleCenter.instans.bagRoomEnough()){var e=v.TaskManager.ins.currentTask.bonus;o.NetCtroller.finishTask(v.TaskManager.ins.currentTask.id,v.TaskManager.ins.currentTask.follow),this._lastSubmitTime=t;for(var i=u.UIUtils.localToGlobal(this.con_des,new Laya.Point(this.con_des.width/2,this.con_des.height/2)),n=0;n<e.length;n++){var s;(s=e[n][0])&&Laya.timer.once(10+300*n,this,function(t){_.FlyManager.ins.flyItemToBagBessel(t,i)},[s])}}else b.AM.showBagNotEnough()},t.prototype.onPutNewEquip=function(t){this.updateHandler()},t.prototype.checkTaskNeedEquipCount=function(){for(var t=v.TaskManager.ins.currentTask,e=f.RoleCenter.instans.self.openhero.length,i=0,n=0;i<e;){for(var s=f.RoleCenter.instans.self.openhero[i].equpos,o=0;o<s.length;o++){var a=s[o];if(a.equins){var r=y.ItemUtils.getEquipVoById(a.equins.equtemplet);t.type==p.TaskType.PutonEquipment?r&&(r.limit>=t.target||0==r.limit)&&n++:t.type==p.TaskType.put_on_quality_equip&&r&&5<=r.quality&&r.limit>=t.target&&n++}}i++}return n},t.prototype.checkFuwenCount=function(t){void 0===t&&(t=0);for(var e,i,n=f.RoleCenter.instans.self.openhero.length,s=0,o=0,a=0,r=0;s<n;){for(a=0,r=(e=f.RoleCenter.instans.self.openhero[s].zhanwenData).zhanwenArr.length;a<r;)i=e.zhanwenArr[a],0<t?i.lv>=t&&o++:o++,a++;s++}return o},t.prototype.taskNeedAdd=function(){f.RoleCenter.instans.self.taskdata.need++,this.updateHandler()},t.prototype.taskNeedAddNum=function(t){0<t&&(f.RoleCenter.instans.self.taskdata.need+=t,this.updateHandler())},t.prototype.updateVisible=function(){this.visible=this.isStart&&v.TaskManager.ins.currentTask&&!this._enterBoss&&!I.MathUtils.containBit(C.GameState.battle_state,C.GameState.battle_state_heji)},t.prototype.updateHandler=function(){var e=this,t=v.TaskManager.ins.currentTask;if(this.event_layer.off(Laya.Event.CLICK,this,this.onClickHandler),Laya.timer.clear(this,this.autoSubmitTask),Laya.timer.clear(this,this.showClickPrompt),!t)return this.visible=!1,void this.removeEvents();this.updateVisible();var i=!1;this._currTaskId!=t.id&&(i=!0,this._currTaskId=t.id,this.onTaskChanged());var n="";t.desc&&(n=t.desc);var s=!0,o="",a="";if(t.type==p.TaskType.KillMonsters)f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler)):s=!0;else if(t.type==p.TaskType.Dialogue)(s=v.TaskManager.ins.isFinish)||(a=w.TextConst.get(605));else if(t.type==p.TaskType.IntoAutoCopy)s=!1;else if(t.type==p.TaskType.CompleteOnePort){this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),3==y.ItemUtils.getPortVoById(t.target).type?t.target<f.RoleCenter.instans.self.portstatus.portindex?s=!0:(s=!1,a="(0/1)"):f.RoleCenter.instans.self.taskdata.need<1&&(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/1)")}else t.type==p.TaskType.PutonEquipment?(f.RoleCenter.instans.self.taskdata.need=this.checkTaskNeedEquipCount(),this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",g.E.ins.on(d.EventName.PUTNEWEQUIPED,this,this.onPutNewEquip)):(g.E.ins.off(d.EventName.PUTNEWEQUIPED,this,this.onPutNewEquip),s=!0)):t.type==p.TaskType.StrongthEquip?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")"):s=!0):t.type==p.TaskType.CultivateGem?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",f.RoleCenter.instans.on(m.enumOpResultType.EquipProChg_gem+"",this,this.taskNeedAdd),f.RoleCenter.instans.on(m.enumOpResultType.EquipProChg_AllGem+"",this,this.taskNeedAdd)):(f.RoleCenter.instans.off(m.enumOpResultType.EquipProChg_gem+"",this,this.taskNeedAdd),f.RoleCenter.instans.off(m.enumOpResultType.EquipProChg_AllGem+"",this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.InjSoulIntoEquipment?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",f.RoleCenter.instans.on(m.enumOpResultType.EquipProChg_soul+"",this,this.taskNeedAdd),f.RoleCenter.instans.on(m.enumOpResultType.EquipProChg_AllSoul+"",this,this.taskNeedAdd)):(f.RoleCenter.instans.off(m.enumOpResultType.EquipProChg_soul+"",this,this.taskNeedAdd),f.RoleCenter.instans.off(m.enumOpResultType.EquipProChg_AllSoul+"",this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.MintSoul?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",f.RoleCenter.instans.on(m.enumOpResultType.EquipProChg_shenzhu+"",this,this.taskNeedAdd)):(f.RoleCenter.instans.off(m.enumOpResultType.EquipProChg_shenzhu+"",this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.PromoteSkill?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",f.RoleCenter.instans.on(m.enumOpResultType.skillUpgrade_one+"",this,this.taskNeedAdd),f.RoleCenter.instans.on(m.enumOpResultType.skillUpgrade_all+"",this,this.taskNeedAdd)):(f.RoleCenter.instans.off(m.enumOpResultType.skillUpgrade_one+"",this,this.taskNeedAdd),f.RoleCenter.instans.off(m.enumOpResultType.skillUpgrade_all+"",this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.MeltEquipment?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",f.RoleCenter.instans.on(d.EventName.EQUIPSPLIT,this,this.taskNeedAdd)):(f.RoleCenter.instans.off(d.EventName.EQUIPSPLIT,this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.killPrivateBoss?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<1?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/1)"):s=!0):t.type==p.TaskType.killMonthBoss?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<1?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/1)"):s=!0):t.type==p.TaskType.ReachLevel?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.vo.lvl<t.target?(s=!1,a=w.TextConst.get(46,f.RoleCenter.instans.vo.lvl,t.target),g.E.ins.on(d.EventName.ADDED_LEVEL,this,this.taskNeedAdd)):(g.E.ins.off(d.EventName.ADDED_LEVEL,this,this.taskNeedAdd),this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),s=!0)):t.type==p.TaskType.CultivateWing?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",f.RoleCenter.instans.on(m.enumOpResultType.PromoteWing_starPromote+"",this,this.taskNeedAdd),f.RoleCenter.instans.on(m.enumOpResultType.PromoteWing_starUseMoney+"",this,this.taskNeedAdd),f.RoleCenter.instans.on(m.enumOpResultType.PromoteWing_starUseItem+"",this,this.taskNeedAdd)):(f.RoleCenter.instans.off(m.enumOpResultType.PromoteWing_starPromote+"",this,this.taskNeedAdd),f.RoleCenter.instans.off(m.enumOpResultType.PromoteWing_starUseMoney+"",this,this.taskNeedAdd),f.RoleCenter.instans.off(m.enumOpResultType.PromoteWing_starUseItem+"",this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.KillPortBoss?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")"):s=!0):t.type==p.TaskType.killMeetBoss?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")"):s=!0):t.type==p.TaskType.killChallengeBoss?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")"):s=!0):t.type==p.TaskType.CultivateMedal?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",g.E.ins.on(d.EventName.UPDATEMEDAL,this,this.taskNeedAdd)):(g.E.ins.off(d.EventName.UPDATEMEDAL,this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.ReachRebirthLevel?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.vo.zhuanshengLv<t.target?(s=!1,a=w.TextConst.get(47,f.RoleCenter.instans.vo.zhuanshengLv,t.target),g.E.ins.on(d.EventName.ADDED_ZHUANSHENG,this,this.updateHandler)):(g.E.ins.off(d.EventName.ADDED_ZHUANSHENG,this,this.updateHandler),s=!0)):t.type==p.TaskType.CompleteMainPort?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<1&&(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/1)")):t.type==p.TaskType.CompleteChangeCopy?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.portPagoda.secPortId>t.target?(s=!0,g.E.ins.off(d.EventName.PAGODA_FIGHT_WIN,this,this.updateHandler)):(s=!1,a="(0/1)",g.E.ins.on(d.EventName.PAGODA_FIGHT_WIN,this,this.updateHandler))):t.type==p.TaskType.CultivateJingmai?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",f.RoleCenter.instans.on(m.enumOpResultType.JingmaiLv+"",this,this.taskNeedAdd)):(f.RoleCenter.instans.off(m.enumOpResultType.JingmaiLv+"",this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.CultivateShield?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",f.RoleCenter.instans.on(m.enumOpResultType.longLin+"",this,this.taskNeedAdd)):(f.RoleCenter.instans.off(m.enumOpResultType.longLin+"",this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.CultivateDragonSoul?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",f.RoleCenter.instans.on(m.enumOpResultType.longWen+"",this,this.taskNeedAdd)):(f.RoleCenter.instans.off(m.enumOpResultType.longWen+"",this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.relic_fragment_activate?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<1?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/1)"):s=!0):t.type==p.TaskType.KillMonstersGroup?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",g.E.ins.on(d.EventName.KILL_MONSTERWAVE,this,this.taskNeedAdd)):(g.E.ins.off(d.EventName.KILL_MONSTERWAVE,this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.reilc_activation?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.vo.Relic.relicId<t.target?(s=!1,a="(0/1)"):s=!0):t.type==p.TaskType.pickUp?f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")"):(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),Laya.timer.once(800,this,this.autoSubmitTask),s=!0):t.type==p.TaskType.exp_copy?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")"):s=!0):t.type==p.TaskType.field_fight?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",g.E.ins.on(d.EventName.STARTFIELDPVPFIGHT,this,this.taskNeedAdd)):(s=!0,g.E.ins.off(d.EventName.STARTFIELDPVPFIGHT,this,this.taskNeedAdd))):t.type==p.TaskType.put_on_quality_equip?(f.RoleCenter.instans.self.taskdata.need=this.checkTaskNeedEquipCount(),this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",g.E.ins.on(d.EventName.PUTNEWCHENGZHUANG,this,this.onPutNewEquip)):(g.E.ins.off(d.EventName.PUTNEWCHENGZHUANG,this,this.onPutNewEquip),s=!0)):t.type==p.TaskType.open_hero?(f.RoleCenter.instans.self.taskdata.need=f.RoleCenter.instans.vo.heronum,this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",g.E.ins.on(d.EventName.OPENNEW_HERO,this,this.updateHandler)):(g.E.ins.off(d.EventName.OPENNEW_HERO,this,this.updateHandler),s=!0)):t.type==p.TaskType.soul_upgrade?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",g.E.ins.once(d.EventName.SOUL_UPGRADE_SUCCESS,this,this.taskNeedAdd)):(g.E.ins.off(d.EventName.SOUL_UPGRADE_SUCCESS,this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.fuwen_puton?(f.RoleCenter.instans.self.taskdata.need=this.checkFuwenCount(),this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",g.E.ins.once(d.EventName.ZHANWEN_PUTON,this,this.updateHandler)):(g.E.ins.off(d.EventName.ZHANWEN_PUTON,this,this.updateHandler),s=!0)):t.type==p.TaskType.fuwen_strongth?(f.RoleCenter.instans.self.taskdata.need=this.checkFuwenCount(t.target),this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",g.E.ins.once(d.EventName.ZHANWEN_UPLV,this,this.updateHandler)):(g.E.ins.off(d.EventName.ZHANWEN_UPLV,this,this.updateHandler),s=!0)):t.type==p.TaskType.ring_active?(f.RoleCenter.instans.self.taskdata.need=2==f.RoleCenter.instans.vo.tejie.jihuoArr[t.target-1]?1:0,this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<1?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/1)",g.E.ins.once(d.EventName.TEJIE_ACHIVATE,this,this.updateHandler)):(g.E.ins.off(d.EventName.TEJIE_ACHIVATE,this,this.updateHandler),s=!0)):t.type==p.TaskType.daily_task?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",g.E.ins.once(d.EventName.DAILY_TASK_HYD_CHANGED,this,this.taskNeedAdd)):(g.E.ins.off(d.EventName.DAILY_TASK_HYD_CHANGED,this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.time_limit_task?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",g.E.ins.once(d.EventName.TIME_LIMIT_TASK_COMPLET,this,this.taskNeedAdd),g.E.ins.once(d.EventName.TIME_LIMIT_TASK_DELETE,this,this.taskNeedAdd)):(g.E.ins.off(d.EventName.TIME_LIMIT_TASK_COMPLET,this,this.taskNeedAdd),g.E.ins.off(d.EventName.TIME_LIMIT_TASK_DELETE,this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.intoGuideCopy?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",g.E.ins.once(d.EventName.INTO_GUIDE_COPY,this,this.taskNeedAdd)):(g.E.ins.off(d.EventName.INTO_GUIDE_COPY,this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.faqi_fragment_activation?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",g.E.ins.once(d.EventName.ACHIVATE_HUNYINDEBRIS,this,this.taskNeedAdd)):(g.E.ins.off(d.EventName.ACHIVATE_HUNYINDEBRIS,this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.fightNum_change?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.vo.combat<t.target?(s=!1,a="("+f.RoleCenter.instans.vo.combat+"/"+t.target+")",g.E.ins.on(d.EventName.UPDATE_COMBAT,this,this.updateHandler)):(g.E.ins.off(d.EventName.UPDATE_COMBAT,this,this.updateHandler),s=!0)):t.type==p.TaskType.ring_task?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",g.E.ins.on(d.EventName.TEJIE_TASKACHIVATE,this,this.taskNeedAdd)):(g.E.ins.off(d.EventName.TEJIE_TASKACHIVATE,this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.hit_boss_getshenzhuang?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.self.taskdata.need<t.need?(s=!1,a="("+f.RoleCenter.instans.self.taskdata.need+"/"+t.need+")",g.E.ins.on(d.EventName.SHENZHUANG_CHANGETASK,this,this.taskNeedAdd)):(g.E.ins.off(d.EventName.SHENZHUANG_CHANGETASK,this,this.taskNeedAdd),s=!0)):t.type==p.TaskType.faqi_activation?(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),-1==f.RoleCenter.instans.vo.comboData.curHunYinJieArr.indexOf(t.target)?(s=!1,a="(0/1)",g.E.ins.on(d.EventName.HUNYIN_OPEN_JIE,this,this.updateHandler)):(g.E.ins.off(d.EventName.HUNYIN_OPEN_JIE,this,this.updateHandler),s=!0)):t.type==p.TaskType.popStageRelic&&(this.event_layer.on(Laya.Event.CLICK,this,this.onClickHandler),f.RoleCenter.instans.vo.Relic.relicId<t.target?(s=!1,a="(0/1)"):s=!0);v.TaskManager.ins.isFinish=s;var r=n.indexOf("*");if(0==s){o="",-1!=r&&(n=n.substring(0,n.indexOf("*")));this.showAni(2),!this.hasShowClick&&t.type!=p.TaskType.Dialogue&&1850!=this._currTaskId&&this._currTaskId<2780&&Laya.timer.once(3e3,this,this.showClickPrompt)}else o=w.TextConst.get(606),-1!=r&&(n=n.substring(n.indexOf("*")+1)),this.hasShowClick&&this.removeGuideArrow(),this._currTaskId<2780&&Laya.timer.once(3e3,this,this.showClickPrompt),this.showAni(1);var l,h,c="<font style='fontSize:20' color=\"#ec5810\">"+t.name+"</font><font style='fontSize:20' color=\"#ff0000\">"+a+"</font><font style='fontSize:20' color=\"#00ff00\">"+o+"</font>",u="<font style='fontSize:16' color=\"#c0b4a3\">"+(n||"")+"</font>";i?((l=0<this.htmPool.length?this.htmPool.pop():this.createHtml()).innerHTML=c,l.x=-this.width,l.y=6,this.con_des.addChild(l),this.htxt_title&&Laya.Tween.to(this.htxt_title,{x:this.width},300,Laya.Ease.circIn,Laya.Handler.create(this,function(t){t.removeSelf(),e.htmPool.push(t)},[this.htxt_title])),Laya.Tween.to(l,{x:0},300,Laya.Ease.circIn),this.htxt_title=l,(h=0<this.htmPool.length?this.htmPool.pop():this.createHtml()).innerHTML=u,h.x=-this.width,h.y=29,this.con_des.addChild(h),this.des&&Laya.Tween.to(this.des,{x:this.width},300,Laya.Ease.circIn,Laya.Handler.create(this,function(t){t.removeSelf(),e.htmPool.push(t)},[this.des])),Laya.Tween.to(h,{x:0},300,Laya.Ease.circIn),this.des=h):(this.htxt_title&&(this.htxt_title.innerHTML=c),this.des&&(this.des.innerHTML=u))},t.prototype.onTaskChanged=function(){this.hasShowClick=!1,this.removeGuideArrow()},t.prototype.showClickPrompt=function(){this.hasShowClick=!0,this.addGuideArrow(v.TaskManager.ins.currentTask.id<3280)},t}(ui.index.TaskLeftViewUI);e.TaskLeftView=S}),define("src/g/index/ctrl/TaskLeftCtrl",["require","exports","src/g/index/view/TaskLeftView","../../../utils/UIUtils","../../../enum/GuideTargetName","../../../manager/GuideCenter","../../../manager/LayerManager"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.prototype.init=function(){return this._view=new i.TaskLeftView,this.registUIToGuide(),this._view},t.prototype.registUIToGuide=function(){o.GuideCenter.ins.registerGuideObject(s.GuideTargetName.TASK_LEFT_VIEW,a.LayerManager.getMainGuideLayer());var t=n.UIUtils.getGlobalBound(this._view.img_bg);t&&o.GuideCenter.ins.registerInteractionArea(s.GuideTargetName.TASK_LEFT_VIEW,t)},t}();e.TaskLeftCtrl=r}),define("src/g/index/view/BattleModeShow",["require","exports","../../../manager/RoleCenter","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/init/TextConst"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a,r=function(){function t(t){this._state=1,this._img=t,this._img.on(Laya.Event.CLICK,this,this.onSwitchModeHandler)}return t.prototype.onSwitchModeHandler=function(){i.RoleCenter.instans.vo.lvl<60?n.FE.upItems(o.TextConst.get(601),s.BubbleEnum.center):(this._state=1==this._state?2:1,1==this._state?(this._img.skin="res/index1/zhu_heping.png",t.isPeace=!0):2==this._state&&(this._img.skin="res/index1/zhu_quanti.png",t.isPeace=!1))},t.isPeace=!0,t}();e.BattleModeShow=r,(a=e.BattleMode||(e.BattleMode={}))[a.PEACE=1]="PEACE",a[a.ALL=2]="ALL"}),define("src/g/index/ctrl/HeadTopCtrl",["require","exports","src/g/itemGets/View/ItemGetDlg","../../../core/E","../../../manager/RoleCenter","../../../utils/ItemUtils","../../../utils/StringUtils","../../../utils/SoundUtils","../../../enum/EventName","src/g/Effects/UIEffectsFactory","../../../manager/LayerManager","src/init/Switches","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(){function t(t){this.ranposx=0,this.baseFireWidth=0,this._view=t,this.ranposx=this._view.btn_rank.x,this.initAni();var e=Laya.Event.CLICK;t.btn_gold.on(e,this,this.rechargeHandler),t.btn_vip.on(e,this,this.vipHandler),t.btn_setting.on(e,this,this.settingHander),t.btn_money.on(e,this,this.gotoMoneyHandler),t.headurl.on(e,this,this.onDress),t.btn_rank.on(e,this,this.rankHandler),c.LayerManager.addTopBar(this._view),this.refreshVipLv(),n.E.ins.on(l.EventName.VIP_EXP_CHANGED,this,this.refreshVipLv),n.E.ins.on(l.EventName.VIP_GET_BONS_STATE_CHANGED,this,this.refreshVipLv),n.E.ins.on(l.EventName.UPDATERANKREDDOT,this,this.refreshRankRed),n.E.ins.on(l.EventName.CHG_NICKNAME,this,this.changeName),n.E.ins.on(l.EventName.ADDED_MONEY,this,this.init),n.E.ins.on(l.EventName.ADDED_GOLD,this,this.init),n.E.ins.on(l.EventName.ADDED_EXP,this,this.init),n.E.ins.on(l.EventName.ADDED_LEVEL,this,this.init),n.E.ins.on(l.EventName.ADDED_ZHUANSHENG,this,this.init),n.E.ins.on(l.EventName.UPDATE_COMBAT,this,this.init),n.E.ins.on(l.EventName.SHOWBG,this,this.showBgHandler),n.E.ins.on(l.EventName.SEX_CHANGED,this,this.onSexChanged),this.init(),this.changePlaytype(),n.E.ins.on(l.EventName.PLAY_TYPE_CHANGED,this,this.changePlaytype),this.processboxText()}return t.prototype.onSexChanged=function(){var t=s.RoleCenter.instans.vo;this._view.headurl.skin=o.ItemUtils.getHeadurlYuan(t.getSex(),t.jobId)},t.prototype.processboxText=function(){var t=s.RoleCenter.instans.vo.portstatus.portindex;this._view.portnum.text="第"+(t-100)+"关";var e=(o.ItemUtils.getPortVoById(t).port_drop[1][1]/1e4).toFixed(1);this._view.exp.text=e+"万/小时"},t.prototype.changePlaytype=function(){switch(this.processboxText(),s.RoleCenter.instans.vo.newbee?this._view.btn_rank.visible=this._view.btns_con.visible=!1:(this._view.btn_rank.visible=!0,window.enabledpay?(this._view.btns_con.visible=!0,this._view.btn_rank.x=this.ranposx):(this._view.btns_con.visible=!1,this._view.btn_rank.x=this._view.btns_con.x)),p.PlayManager.type){case d.EPlayType.PLAYTYPE_PORT:case d.EPlayType.PLAYTYPE_MAINCITY:this._view&&(this._view.visible=!0)}},t.prototype.initAni=function(){this.fire_ani||(this.fire_ani=h.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this._view.sp_fire,13,1.3,1.3,"fire",!0,70),this.fire_ani.pivotX=0,this.fire_ani.x=0,this.baseFireWidth=this.fire_ani.width,this.scaleFireAni()),this.bandRedHint()},t.prototype.scaleFireAni=function(){var t=(this._view.img_zdl.width+15*this._view.zdl_txt.value.length-30)/this.baseFireWidth;this.fire_ani&&this.fire_ani.scaleX.toFixed(3)!=t.toFixed(3)&&(Laya.Tween.to(this.fire_ani,{scaleX:t},200,null,null,null,!0),this.fire_ani.scaleY=1.3)},t.prototype.onDress=function(){u.Switches.ins.event(59)},t.prototype.openChop=function(){r.SoundUtils.getInstance().playBtnsounds(),u.Switches.ins.event(3)},t.prototype.rankHandler=function(){r.SoundUtils.getInstance().playBtnsounds(),u.Switches.ins.event(2)},t.prototype.showBgHandler=function(t){this._view.headcon.visible=t,this._view.second_con.visible=!t},t.prototype.init=function(){var t=s.RoleCenter.instans.vo;this._view.headurl.skin=o.ItemUtils.getHeadurlYuan(t.getSex(),t.jobId),this._view.zdl_txt.value=t.combat+"",this.scaleFireAni(),this._view.lvl_txt.changeText(o.ItemUtils.getLVString(t.getCurLv())),this._view.gold_txt.changeText(a.StringUtils.moneyNumToString(t.GOLD)),this._view.money_txt.changeText(a.StringUtils.moneyNumToString(t.MONEY)),this._view.user_name_txt.text=this._view.role_name.text=t.nickname,this._view.lvl_txt_second.text=this._view.lvl_txt.text},t.prototype.bandRedHint=function(){},t.prototype.vipHandler=function(){r.SoundUtils.getInstance().playBtnsounds(),u.Switches.ins.event(101)},t.prototype.rechargeHandler=function(){if(!s.RoleCenter.instans.vo.newbee){if(window.isShenhe)return void u.Switches.ins.event(109);0<s.RoleCenter.instans.vo.vipData.allPriceGold?u.Switches.ins.event(109):u.Switches.ins.event(13)}},t.prototype.refreshVipLv=function(){var t=this._view.vip_value;this._view.btn_vip;t.value=s.RoleCenter.instans.vo.VIP+"";for(var e=s.RoleCenter.instans.vo.VIP;0<e;){if(1==(s.RoleCenter.instans.self.vipData.getBons>>e-1&1)){!0;break}e--}},t.prototype.refreshRankRed=function(){},t.prototype.gotoMoneyHandler=function(){var t=o.ItemUtils.getCurrencyByDefine("MONEY");(new i.ItemGetDlg).initByVo(null,t).popup()},t.prototype.changeName=function(){this._view.role_name.text=s.RoleCenter.instans.vo.nickname,this._view.user_name_txt.text=s.RoleCenter.instans.vo.nickname},t.prototype.settingHander=function(){r.SoundUtils.getInstance().playBtnsounds(),n.E.ins.event(l.EventName.OPEN_SETTING)},t}();e.HeadTopCtrl=g}),define("src/init/CommonTimer",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return Object.defineProperty(t,"ins",{get:function(){return t._ins||(t._ins=new t),t._ins},enumerable:!0,configurable:!0}),t}();e.CommonTimer=i}),define("src/g/setting/vo/SettingInfo",["require","exports","../../../config/GameConfig","../../../manager/RoleCenter"],function(t,e,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function n(){}return n.getSettingValue=function(t){var e,i=utils.LocalUtil.getAnyLocal(o.RoleCenter.instans.self.username+"_"+t);if(null!=i&&""!=i)e=1==i;else{if(null==s.GameConfig.commonJson)return!0;e=n.parseConfigValue(s.GameConfig.commonJson[t])}return e},n.parseConfigValue=function(t){return null!=t.value&&Boolean(Number(t.value))},n.setSettingValue=function(t,e){var i=e?1:-1;utils.LocalUtil.setAnyLocal(o.RoleCenter.instans.self.username+"_"+t,i)},n}();e.SettingInfo=i}),define("src/g/index/ctrl/BtnSkiilCtrl",["require","exports","../../../enum/EventName","../../../core/E","../../../manager/LayerManager","src/g/fight/osprite/SceneObjCtroller","../../../utils/system/FloatEffect","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg","../../../manager/TaskManager","../../../utils/UIUtils","src/g/guide/view/GuideTipDownView","../../../component/UDEffect","src/g/Effects/UIEffectsFactory","../../../plugin/view/ToolTip","src/init/GameState","src/init/CommonTimer","../../../component/JointAttackOpenDlg","../../net/messages/sbkComboData","../../../manager/RoleCenter","src/g/accessctrl/AccessCenter","../../../utils/ItemUtils","src/g/setting/vo/SettingInfo","../../../enum/SettingEnum","src/g/index/ctrl/GameIndexCtrl","src/init/TextConst","../../../meta/CommonVo","../../../enum/TaskCofigEnum"],function(t,e,a,r,s,l,h,i,n,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E,T,A,R){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function o(t){this._skillEff=new Laya.Image,this.limitTaskId=R.TaskCofigEnum.startTask,this.skillBtnVis=!0,this.ef=new d.UDEffect,this._guide=0,this._killBlood=[],this.posList=[350,300,400,320,340,330,315,220,280],this.startTime=0,this._count=0,this._value=0,this._lastTime=-1,this._speed=1,this._initValue=0,this._updateKey=!1,(this.view=t).btn_skill1.once(Laya.Event.CLICK,this,this.skill1Handler),t.btn_skill1.on(Laya.Event.MOUSE_DOWN,this,this.mouseDownHandler,[t.btn_skill1]),t.btn_skill1.on(Laya.Event.MOUSE_UP,this,this.mouseUpHandler,[t.btn_skill1]),t.btn_skill2.once(Laya.Event.CLICK,this,this.skill2Handler,[t.btn_skill2]),t.btn_skill2.on(Laya.Event.MOUSE_DOWN,this,this.mouseDownHandler,[t.btn_skill2]),t.btn_skill2.on(Laya.Event.MOUSE_UP,this,this.mouseUpHandler,[t.btn_skill2]),t.btn_skill3.once(Laya.Event.CLICK,this,this.skill3Handler),t.btn_skill3.on(Laya.Event.MOUSE_DOWN,this,this.mouseDownHandler,[t.btn_skill3]),t.btn_skill3.on(Laya.Event.MOUSE_UP,this,this.mouseUpHandler,[t.btn_skill3]),r.E.ins.on(a.EventName.PLAY_TYPE_CHANGED,this,this.resetSkillDisableHandler),r.E.ins.on(a.EventName.JOINSKILLSHOW,this,this.showSkillHandler),c.TaskManager.ins.currentTask&&c.TaskManager.ins.currentTask.id<1900&&(this.view.nu_con.visible=!1);var e=103,i=A.CommonVo.getVoByKey("hejiyindao");i&&(e=i.val2numArr[0]),C.RoleCenter.instans.vo.portstatus.portindex<=e&&(r.E.ins.once(a.EventName.OPEN_JOINT_ATTACK_GUIDE,this,this.doOpenGuide),r.E.ins.once(a.EventName.READY_JOINT_ATTACK_GUIDE,this,this.doReadyGuide)),r.E.ins.on(a.EventName.JOINT_ATTACK_GUIDE,this,this.onJointAttackGuideHandler),r.E.ins.on(a.EventName.SHOCKSCREEN,this,this.shockScreen),r.E.ins.on(a.EventName.CURRENT_TASK_CHANGE,this,this.onTaskChanged),(o.ins=this).view.btn_skill1.scale(0,0),this.view.btn_skill2.scale(0,0),this.view.btn_skill3.scale(0,0),this.changePos(!1,!1),I.AccessCenter.ins.checkOpen(121)?(this.view.lock_1con.removeSelf(),this.view.btn_ani1.visible=!0):(this.view.btn_ani1.visible=!1,I.AccessCenter.ins.on(121,this,function(){this.view.lock_1con.removeSelf(),this.view.btn_ani1.visible=!0})),I.AccessCenter.ins.checkOpen(120)?(this.view.lock_3con.removeSelf(),this.view.btn_skill3.mouseEnabled=!0,this.view.btn_ani3.visible=!0):(this.view.btn_ani3.visible=!1,I.AccessCenter.ins.on(120,this,function(){this.view.lock_3con.removeSelf(),this.view.btn_ani3.visible=!0})),this.updateSkillIcon(),r.E.ins.on(a.EventName.HETI_SKILL_ACTIVE,this,this.updateSkillIcon);var n=A.CommonVo.getVoByKey("kaiqiheji");n&&(this.limitTaskId=n.val2num),this.view.box_guide.visible=!1;var s=A.CommonVo.getVoByKey("hejiyindao");s&&(this.guidePortIdArr=s.val2numArr),this.guideAutoPortIdArr=A.CommonVo.getVoByKey("xinshouheji").val2numArr,this.updateVisible()}return o.prototype.updateSkillIcon=function(){var t=C.RoleCenter.instans.vo.hetiData.skillArr;-1!=t.indexOf(22)?this.view.btn_skin2.skin="res/index1/heiti_jineng_001.png":this.view.btn_skin2.skin="res/index1/zhujiemian_heji_jienng3.png",-1!=t.indexOf(23)?this.view.btn_skin3.skin="res/index1/heiti_jineng_002.png":this.view.btn_skin3.skin="res/index1/zhujiemian_heji_jienng2.png",-1!=t.indexOf(24)?this.view.btn_skin1.skin="res/index1/heiti_jineng_003.png":this.view.btn_skin1.skin="res/index1/zhujiemian_heji_jienng1.png"},o.prototype.doReadyGuide=function(){this.view.visible=!1,this.view.btn_skill1.visible=!1,this.view.btn_skill2.visible=!1,this.view.btn_skill3.visible=!1},o.prototype.doOpenGuide=function(){var t=this;this.view.visible=!0,this.view.btn_skill2.visible=!0,this.view.btn_skill2.scale(3,3),Laya.Tween.to(this.view.btn_skill2,{scaleX:1,scaleY:1},200,Laya.Ease.cubicIn,new Laya.Handler(this,function(){t.view.btn_skill1.visible=!0,t.view.btn_skill3.visible=!0,t.view.btn_skill1.alpha=0,t.view.btn_skill3.alpha=0,Laya.Tween.to(t.view.btn_skill1,{alpha:1},1e3),Laya.Tween.to(t.view.btn_skill3,{alpha:1},1e3)}))},o.prototype.onOpenJointAttackGuideHandler=function(e,i){var n=this;e?Laya.timer.once(200,this,function(){var t=u.UIUtils.localToGlobal(n.view.nu_con.parent,new Laya.Point(n.view.nu_con.x,n.view.nu_con.y),!1);Laya.Tween.to(e,{x:t.x,y:t.y},1e3,Laya.Ease.bounceOut,Laya.Handler.create(n,function(t){t.removeSelf(),t.destroy(),n.doOpenJointAttack(i)},[e]))}):this.doOpenJointAttack(i)},o.prototype.onJointAttackGuideHandler=function(t,e){void 0===e&&(e=null),this._count=100,this.setSkillBtnVisible(!0),this.progressValue(this._count);var i=0;t==m.JointAttackUIType.qunti?i=3:t==m.JointAttackUIType.wudi?i=1:t==m.JointAttackUIType.danti&&(i=2,r.E.ins.off(a.EventName.JOINT_ATTACK_GUIDE,this,this.onJointAttackGuideHandler)),this.addGuideArrow(i,e)},o.prototype.checkTask=function(){return!c.TaskManager.ins.currentTask||c.TaskManager.ins.currentTask.id>this.limitTaskId},o.prototype.onTaskChanged=function(){this.updateVisible()},o.prototype.setSkillBtnVisible=function(t){this.skillBtnVis!=t&&(this.skillBtnVis=t,this.updateVisible())},o.prototype.checkGuide=function(){return C.RoleCenter.instans.vo.portstatus.portindex,!1},o.prototype.showGuide=function(){this.checkGuide()&&i.PlayManager.type==n.EPlayType.PLAYTYPE_PORT_LEVEL?this.view.box_guide.visible=!0:this.view.box_guide.visible=!1},o.prototype.updateVisible=function(){this.view.skillBox.visible=this.skillBtnVis&&this.checkTask(),this.updateAni()},o.prototype.getSkillBoxScreenPos=function(){var t=new laya.maths.Point;return u.UIUtils.localToGlobal(this.view.nu_con,t),t},o.prototype.doOpenJointAttack=function(t){this.onJointAttackGuideHandler(t,s.LayerManager.getMainGuideLayer()),t==m.JointAttackUIType.danti&&(this.needMask=!0,Laya.timer.once(200,this,this.doMaskGuide))},o.prototype.doMaskGuide=function(){if(this.needMask){this.isMask=!0,s.LayerManager.setTaskGuideLayerMask(!0,s.LayerManager.getMainGuideLayer());var t=this.view.btn_skill2,e=u.UIUtils.getGlobalBound(t);s.LayerManager.setPolyInteractionArea(e.x,e.y,[-8,7,29,-12,64,8,64,48,29,70,-7,48])}},o.prototype.addGuideArrow=function(t,e){void 0===e&&(e=null);var i,n=this.view["btn_skill"+t];i=null==e?(e=this.view,u.UIUtils.localToContianer(n,this.view)):u.UIUtils.localToGlobal(n.parent,new Laya.Point(n.x,n.y)),this._uEf&&(this._uEf.clear(),this._uEf=null),this._uEf=g.UIEffectsFactory.Ins.createUIAniById(24,!0),this._uEf.x=i.x-this._uEf.width/2-5,this._uEf.y=i.y-this._uEf.height/2-5,this._downview||(this._downview=new p.GuideTipDownView,this._downview.setTip(T.TextConst.get(596))),this._downview.x=i.x,this._downview.y=i.y-60,e.addChild(this._uEf),e.addChild(this._downview),this.ef.effect(this._downview,20,300),this._guide=t},o.prototype.removeGuideArrow=function(){this._downview&&this._downview.removeSelf(),this._uEf&&this._uEf.removeSelf(),this.ef.clear(),this._guide=0,this._prompt?this._prompt=!1:(Laya.timer.once(3e3,y.CommonTimer.ins,function(){f.GameState.joint_attack_guide_state=!1}),c.TaskManager.ins.active=!0),this.view.box_guide.visible=!1},o.prototype.removeMask=function(){this.isMask&&(s.LayerManager.setTaskGuideLayerMask(!1),this.isMask=!1,E.GameIndexCtrl.idxView.taskView&&(E.GameIndexCtrl.idxView.taskView.visible=!0),this.setSkillBtnVisible(!1)),this.needMask=!1},o.prototype.mouseDownHandler=function(t){w.SettingInfo.getSettingValue(S.SettingEnum.noZhenPing)||wx.vibrateShort&&wx.vibrateShort({}),Laya.Tween.to(t,{scaleX:.9,scaleY:.9},100,Laya.Ease.backInOut),Laya.stage.once(Laya.Event.CLICK,this,this.upHandler)},o.prototype.upHandler=function(){Laya.Tween.to(this.view.btn_skill1,{scaleX:1,scaleY:1},100,Laya.Ease.backInOut),Laya.Tween.to(this.view.btn_skill2,{scaleX:1,scaleY:1},100,Laya.Ease.backInOut),Laya.Tween.to(this.view.btn_skill3,{scaleX:1,scaleY:1},100,Laya.Ease.backInOut)},o.prototype.mouseUpHandler=function(t){Laya.Tween.to(t,{scaleX:1,scaleY:1},100,Laya.Ease.backInOut)},o.prototype.nubaoHandler=function(){this.setUpHandler()},o.prototype.doPrompt=function(){this.view.skillBox.visible&&(i.PlayManager.type==n.EPlayType.PLAYTYPE_PORT_LEVEL||i.PlayManager.type==n.EPlayType.PLAYTYPE_PRIBOSS?C.RoleCenter.instans.vo.getCurLv()<=60&&(0<=this.guidePortIdArr.indexOf(C.RoleCenter.instans.vo.portstatus.portindex)&&i.PlayManager.type==n.EPlayType.PLAYTYPE_PORT_LEVEL?this.view.box_guide.visible=!0:this.addGuideArrow(2),0<=this.guideAutoPortIdArr.indexOf(C.RoleCenter.instans.vo.portstatus.portindex)&&Laya.timer.once(3e3,this,this.skill2Handler),this._prompt=!0):i.PlayManager.type==n.EPlayType.PLAYTYPE_EXPCOPYPLAY&&C.RoleCenter.instans.vo.getCurLv()<=80&&(this.addGuideArrow(3),this._prompt=!0))},o.prototype.setUpHandler=function(){this.view.nu_con.visible=!1,this.view.btn_skill1.scale(0,0),this.view.btn_skill2.scale(0,0),this.view.btn_skill3.scale(0,0);Tween.get(this.view.btn_skill2,!1).to({scaleX:1,scaleY:1,ease:Tween.backInOut,duration:10}),Tween.get(this.view.btn_skill1,!1).to({scaleX:1,scaleY:1,ease:Tween.backInOut,duration:200}),Tween.get(this.view.btn_skill3,!1).to({scaleX:1,scaleY:1,ease:Tween.backInOut,duration:300})},o.prototype.checkPlay=function(t,e,i){if((void 0===i&&(i=!0),i)&&l.SceneObjCtroller.ins.getSelfGroup()){var n=l.SceneObjCtroller.ins.getSelfGroup().getFGTarget();if(!n||n.isDeath())return void h.FE.upItems(T.TextConst.get(597),v.BubbleEnum.center)}this.progressValue(0),e?r.E.ins.event(a.EventName.RELEASESKILL,e):console.error("合击技能错误")},o.prototype.skill1Handler=function(){var t=this,e=C.RoleCenter.instans.vo.comboData.comboSkill;if(Laya.timer.once(2e3,this,function(){this.view.btn_skill1.once(Laya.Event.CLICK,this,this.skill1Handler)}),I.AccessCenter.ins.checkOpen(121,!0))if(this.removeMask(),this._guide){if(1!=this._guide)return;this.removeGuideArrow(),Laya.timer.once(300,this,function(){t.checkPlay("skill3",e[_.enumComboIdx.wudi],!1)})}else this.checkPlay("skill3",e[_.enumComboIdx.wudi],!1)},o.prototype.skill2Handler=function(){var t=this,e=C.RoleCenter.instans.vo.comboData.comboSkill;if(this.view.box_guide.visible=!1,Laya.timer.once(2e3,this,function(){this.view.btn_skill2.once(Laya.Event.CLICK,this,this.skill2Handler)}),this.removeMask(),this._guide){if(2!=this._guide)return;this.removeGuideArrow(),Laya.timer.once(300,this,function(){t.checkPlay("skill1",e[_.enumComboIdx.danti])})}else this.checkPlay("skill1",e[_.enumComboIdx.danti])},o.prototype.skill3Handler=function(){var t=this,e=C.RoleCenter.instans.vo.comboData.comboSkill;if(Laya.timer.once(2e3,this,function(){this.view.btn_skill3.once(Laya.Event.CLICK,this,this.skill3Handler)}),I.AccessCenter.ins.checkOpen(120,!0))if(this.removeMask(),this._guide){if(3!=this._guide)return;this.removeGuideArrow(),Laya.timer.once(300,this,function(){t.checkPlay("skill2",e[_.enumComboIdx.qunti],!0)})}else this.checkPlay("skill2",e[_.enumComboIdx.qunti],!0)},o.prototype.showSkillHandler=function(t){var e=b.ItemUtils.getSkillVoById(t).target;5==e?this.resetSkill("skill1"):6==e?this.resetSkill("skill2"):this.resetSkill("skill3")},o.prototype.resetSkill=function(t){this._skillEff.x=Laya.stage.width,this._skillEff.y=500,this._skillEff.scale(.5,.5),s.LayerManager.fightLayer.popLayer.addChild(this._skillEff),this._skillEff.skin="res/fighteffect/"+t+".png",Laya.Tween.clearAll(this._skillEff),this._skillEff.alpha=1,Laya.Tween.to(this._skillEff,{x:100,y:300,scaleX:1,scaleY:1},300,Laya.Ease.backInOut,new Laya.Handler(this,this.alphaHandler))},o.prototype.alphaHandler=function(){Laya.Tween.to(this._skillEff,{alpha:.1},1500,Laya.Ease.backInOut,new Laya.Handler(this,this.removeHandler))},o.prototype.removeHandler=function(){this._skillEff.removeSelf()},o.prototype.setKillBloddVo=function(t){this._killBlood=t},o.prototype.shockScreen=function(){s.LayerManager.fightLayer.x=0,s.LayerManager.fightLayer.y=0,w.SettingInfo.getSettingValue(S.SettingEnum.noZhenPing)||(wx.vibrateShort&&wx.vibrateShort({}),Laya.Tween.to(s.LayerManager.fightLayer,{y:40},120,Laya.Ease.bounceOut,new Laya.Handler(this,this.againShockScreen)));for(var t=0;t<this._killBlood.length;t++){var e=new ui.account.SkillKillUI;s.LayerManager.fightLayer.popLayer.addChild(e),e.fontvalue.value=(this._killBlood[t]+"").replace("-",""),e.pos(150+20*Math.random(),this.posList[t]||350),e.scale(.8,.8),e.pivot(50,20);var i=e.y-100,n=e.x+50;this.tweenHandler(e,i,n)}this._killBlood.length=0},o.prototype.tweenHandler=function(t,e,i){Tween.get(t,!1).to({scaleY:1,scaleX:1,y:e,x:i,ease:Tween.strongOut,duration:200}).to({y:e-100,alpha:0,ease:Tween.linear,duration:1500+1e3*Math.random()>>0}).call(function(){t.destroy()},t)},o.prototype.againShockScreen=function(){s.LayerManager.fightLayer.y=40,Laya.Tween.to(s.LayerManager.fightLayer,{y:0},120,Laya.Ease.bounceOut,new Laya.Handler(this,this.secondShockScreen))},o.prototype.secondShockScreen=function(){s.LayerManager.fightLayer.x=0,s.LayerManager.fightLayer.y=0,Laya.Tween.to(s.LayerManager.fightLayer,{y:20},80,Laya.Ease.bounceOut,new Laya.Handler(this,this.secondShockScreen1))},o.prototype.secondShockScreen1=function(){s.LayerManager.fightLayer.x=0,s.LayerManager.fightLayer.y=20,Laya.Tween.to(s.LayerManager.fightLayer,{y:0},80,Laya.Ease.bounceOut)},o.prototype.resetSkillDisableHandler=function(){this.setSkillBtnVisible(!0),r.E.ins.off(a.EventName.SHOCKSCREEN,this,this.shockScreen),s.LayerManager.fightLayer.skilleffectLayer.removeChildren(),Laya.timer.clearAll(this),Laya.Tween.clearAll(this),Laya.Tween.clearAll(s.LayerManager.fightLayer),s.LayerManager.fightLayer.x=0,s.LayerManager.fightLayer.y=0;var t=l.SceneObjCtroller.ins.getSelfGroup();switch(t&&(Laya.timer.clearAll(t),Laya.Tween.clearAll(t)),s.LayerManager.fightLayer.popLayer.removeChildren(),c.TaskManager.ins.currentTask&&1900<=c.TaskManager.ins.currentTask.id&&(this.view.nu_con.visible=!0,this.progressValue(0)),c.TaskManager.ins.currentTask||(this.view.nu_con.visible=!0,this.progressValue(0)),this.removeMask(),this._guide&&this.removeGuideArrow(),this.view.mask_mmp.y=75,Laya.Tween.clearAll(this.view.btn_skill1),Laya.Tween.clearAll(this.view.btn_skill2),Laya.Tween.clearAll(this.view.btn_skill3),this.view.btn_skill1.once(Laya.Event.CLICK,this,this.skill1Handler),this.view.btn_skill2.once(Laya.Event.CLICK,this,this.skill2Handler),this.view.btn_skill3.once(Laya.Event.CLICK,this,this.skill3Handler),i.PlayManager.type){case n.EPlayType.PLAYTYPE_PORT:case n.EPlayType.PLAYTYPE_NEWVILLAGE:case n.EPlayType.PLAYTYPE_MAINCITY:this.changePos(!1,!0),this.setSkillBtnVisible(!1);break;case n.EPlayType.PLAYTYPE_PORT_LEVEL:case n.EPlayType.PLAYTYPE_PVP:case n.EPlayType.PLAYTYPE_MEETBOSS:this.changePos(!1,!1),Laya.timer.clear(this,this.setProgressHandler),this._count=0;break;case n.EPlayType.PLAYTYPE_COPYGEM:case n.EPlayType.PLAYTYPE_COPYJM:case n.EPlayType.PLAYTYPE_COPYCJ:case n.EPlayType.PLAYTYPE_COPYLL:case n.EPlayType.PLAYTYPE_COPYLW:case n.EPlayType.PLAYTYPE_COPYZL:case n.EPlayType.PLAYTYPE_ROUGHCOPY:case n.EPlayType.PLAYTYPE_GUILD_INVADE:case n.EPlayType.PLAYTYPE_TASKFAMILY:this._count=0,this.changePos(!1,!1),Laya.timer.loop(10,this,this.setProgressHandler);break;case n.EPlayType.PLAYTYPE_TASKBOSS:this._count=0,this.changePos(!0,!1),this.resetPortSkillProgress(250);break;case n.EPlayType.PLAYTYPE_QUANMINBOSS:case n.EPlayType.PLAYTYPE_FIGHTSC:case n.EPlayType.PLAYTYPE_MOSTVIPBOSS1:case n.EPlayType.PLAYTYPE_MOSTVIPBOSS2:case n.EPlayType.PLAYTYPE_MOSTVIPBOSS3:case n.EPlayType.PLAYTYPE_SHENYUBOSS:case n.EPlayType.PLAYTYPE_TASKBOSS:case n.EPlayType.PLAYTYPE_MIJINGBOSS:case n.EPlayType.PLAYTYPE_BLOODYBATTLE:case n.EPlayType.PLAYTYPE_ALLWORLDBOSS:case n.EPlayType.PLAYTYPE_KFRX:case n.EPlayType.PLAYTYPE_KFTB:case n.EPlayType.PLAYTYPE_KFSD:case n.EPlayType.PLAYTYPE_KFSQJD:case n.EPlayType.PLAYTYPE_KFZY:case n.EPlayType.PLAYTYPE_SWY:case n.EPlayType.PLAYTYPE_SWYKF:this.changePos(!0,!1);break;case n.EPlayType.PLAYTYPE_BLOODYTEMPLE:this.changePos(!1,!1,100);break;case n.EPlayType.PLAYTYPE_WORLDBOSS:this.changePos(!1,!1,20);break;default:this.changePos(!1,!1),Laya.timer.clear(this,this.setProgressHandler),this._count=0}Laya.Tween.clearAll(this.view.mask_mmp),this.view.mask_mmp.y=75,this.updateAni()},o.prototype.changePos=function(t,e,i){void 0===i&&(i=0),this.view.bottom=t?250:185,E.GameIndexCtrl.idxView.bag_con.y=this.view.y-100,E.GameIndexCtrl.idxView.bag_con.y-=i,0==e?f.GameState.addBattleState(f.GameState.battle_state_heji):f.GameState.subBattleState(f.GameState.battle_state_heji)},o.prototype.setProgressHandler=function(){this._count++,100<this._count&&this.clearProcessTimer(),this.progressValue(this._count)},o.prototype.resetPortSkillProgress=function(t){void 0===t&&(t=250),this._count=0,Laya.timer.loop(t,this,this.setProgressHandler)},o.prototype.progressValue=function(t){100<t||(this._progressvalue!=t?(this._progressvalue=t,this.view.box_guide.visible=!1,100==t?(r.E.ins.on(a.EventName.SHOCKSCREEN,this,this.shockScreen),this.view.mask_mmp.y=20,this.view.skill_list.visible=!0,this.nubaoHandler(),this.view.nu_con.visible=!1,console.log("怒气值已经满了"),this.view.btn_skill2.visible?this.doPrompt():Laya.timer.once(1e3,this,this.doPrompt)):(this._prompt&&this.removeGuideArrow(),t<=0?this.view.mask_mmp.y=75-t/2:Laya.Tween.to(this.view.mask_mmp,{y:75-t/2},300),this.view.nu_con.visible=!0,this.view.skill_list.visible=!1),this.updateAni()):this._progressvalue=t)},o.prototype.updateAni=function(){this.view.skill_list.visible?this.view.btn_ani1.isPlaying||(this.view.btn_ani1.source="res/nu/eff.json",this.view.btn_ani1.play(),this.view.btn_ani2.source="res/nu/eff.json",this.view.btn_ani2.play(),this.view.btn_ani3.source="res/nu/eff.json",this.view.btn_ani3.play()):this.view.btn_ani1.isPlaying&&(this.view.btn_ani1.stop(),this.view.btn_ani2.stop(),this.view.btn_ani3.stop()),this.view.nu_con.visible?this.view.nu_ani.isPlaying||(this.view.nu_ani.source="dynamic2/uieffect/EUI1_51.json",this.view.nu_ani.play()):this.view.nu_ani.isPlaying&&this.view.nu_ani.stop()},o.prototype.autoProcess=function(t,e){this._lastTime=Date.now(),this._initValue=t,this._speed=e,100==this._initValue?this._updateKey=!1:this._updateKey=!0,this.progressValue(this._initValue)},o.prototype.frameMove=function(){if(this._updateKey){var t=Math.floor(this._initValue+(Date.now()-this._lastTime)/1e3*this._speed);99<=t&&(t=99),this.progressValue(t)}},o.prototype.completeProcess=function(t){this.progressValue(t),this._updateKey=!1},o.prototype.clearProcessTimer=function(){Laya.timer.clear(this,this.setProgressHandler)},o.prototype.resetProcess=function(){this.view&&(this.clearProcessTimer(),this.progressValue(0))},o}();e.BtnSkiilCtrl=o}),define("src/g/fight/osprite/obj/Pet",["require","exports","src/g/fight/osprite/obj/Unit_New","src/g/fight/osprite/obj/UnitCovert","../../../../utils/ItemUtils","src/g/fight/base/RES","../../../../enum/JobEnum","../../../../component/GAnimation","../../../../core/E","../../../../enum/EventName","../../../../enum/LoadPriority","../../../../component/GAnimationManager","../../../../enum/enumPet"],function(t,e,i,n,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(s){function t(t){void 0===t&&(t=1e3);var e=s.call(this,!0)||this;return e.petType=d.enumPet.normal,e.data=o.ItemUtils.getMonsterVOById(1001),e.coat.interval=50,e.status=0,e.actorType=2,e.face=1,e.avatarId=t,e.setWorldXY(0,0),e.topHpBar&&(e.topHpBar.typeElement=1),e.constantHp=!0,h.E.ins.on(c.EventName.PET_UPDATA,e,e.onPetUpData),e.loadPriority=u.LoadPriority.ROLE_ANI,e.attackDis=e.data.moResVo.value,e.station=e.data.moResVo.station,e}return __extends(t,s),t.prototype.onPetUpData=function(t){var e=o.ItemUtils.getPetVoById(t);this.set_DATA(e,!1)},t.prototype.setHp=function(t){s.prototype.setHp.call(this,t),this.getHp()<=0&&this.death()},Object.defineProperty(t.prototype,"beFocusEffect",{set:function(t){t&&(this.beFocus||(this.beFocus=new l.GAnimation,this.beFocus.load(t,!0)),this.beFocus.zOrder=0,this.view.shadowLayer.addChild(this.beFocus))},enumerable:!0,configurable:!0}),t.prototype.set_DATA=function(t,e){void 0===e&&(e=!0),s.prototype.set_DATA.call(this,t,e),this.status=0,this.setHp(t.HP),this.job=r.JobEnum.DAOSHI,this.actorType=1,this.coat.randStart=!0,this.stand(),this.topHpBar&&(this.topHpBar.headName=this.actorName,this.topHpBar.totalHp=t.HP,this.resetHpBar()),this.sk_Manager.register_skill([this.vo.skill],[this.vo.id])},t.prototype.resetHpBar=function(){if(this.getHp()<=0)return this.topHpBar&&(this.topHpBar.visible=!1),void(this.beFocus&&(this.beFocus.clear(),this.beFocus.destroy(!0),this.beFocus=null));this.topHpBar&&(this.topHpBar.hp=this.getHp())},t.prototype.get_ATT=function(){return this.vo.ATT},t.prototype.get_PDEF=function(){return this.vo.PDEF},t.prototype.get_SDEF=function(){return this.vo.SDEF},t.prototype.chg_HP=function(t,e,i,n){this._constantHp||(this.setHp(this.getHp()+t),this.getHp()<0&&this.setHp(0),s.prototype.chg_HP.call(this,t,e,i,n),this.floatBlood(t,e?e.job:0,i,n),this.resetHpBar())},t.prototype.resetCoat=function(){var t=this.coat,e=this.action;t&&t.load(this.getRoleRes(e),!0,e,"",this.loadPriority)},t.prototype.playAnimation=function(t,e){void 0===e&&(e=-1),this.action=t,this.coat&&(1==this.action?this.coat.interval=2*i.Unit_New.ANIMATION_INTERNAL_UNIT:this.coat.interval=i.Unit_New.ANIMATION_INTERNAL_UNIT,3==this.action?(e=0)<=e&&(this.face=n.UnitCovert.calcFace(this.getMapPos(),this.fightTarget.getMapPos()),this.coat.load(this.getRoleRes(t),!0,t,"",this.loadPriority),this.calSkillHurt(e),this.playWeaponEffect("fire")):this.coat.load(this.getRoleRes(t),!0,t,"",this.loadPriority))},t.prototype.playWeaponEffect=function(t){var e=a.RES.getPetSdul0(t,this.face);this.weaponEff=p.GAnimationManager.getInstance().create(),this.body.addChild(this.weaponEff),this.weaponEff.load(e)},t.prototype.resetActionState=function(){this.setFightTarget(null),this.status=0,this.stand(),this.weaponEff&&this.weaponEff.setPlayComplete()},t.prototype.resetUnit=function(t,e){s.prototype.resetUnit.call(this,t,e),this.stand(),this.setHp(this.vo.HP),this.sk_Manager.clear_buff(),this.setWorldXY(t,e),this.resetHpBar(),this.body&&(this.body.visible=!this._limitDrawKey),this.shadow&&(this.shadow.visible=!this._limitDrawKey),this.topHpBar&&(this.topHpBar.visible=!this._limitDrawKey)},t.prototype.resetHP=function(){this.setHp(this.vo.HP),this.resetHpBar()},t.prototype.frameMove=function(t,e){this.destoryed||s.prototype.frameMove.call(this,t,e)},t.prototype.getRoleRes=function(t){var e=this.face;return 4<this.face&&(e=8-this.face),a.RES.petPath(this.avatarId,t,e)},Object.defineProperty(t.prototype,"vo",{get:function(){return this.data},enumerable:!0,configurable:!0}),t.prototype.destroyUnit=function(){s.prototype.destroyUnit.call(this),h.E.ins.off(c.EventName.PET_UPDATA,this,this.onPetUpData)},t.prototype.deathHide=function(){s.prototype.deathHide.call(this)},t.prototype.playSkillEffect=function(t){},t.prototype.limitDraw=function(t,e){s.prototype.limitDraw.call(this,t,e),e&&this.topHpBar&&(this.body&&(this.body.visible=!t),this.shadow&&(this.shadow.visible=!t),this.topHpBar&&(this.topHpBar.visible=!t))},t.PET_UIDVAL=8e4,t}(i.Unit_New);e.Pet=s}),define("src/g/fight/osprite/obj/Shenjiang",["require","exports","src/g/fight/osprite/obj/Pet","../../../../enum/enumPet","src/g/fight/osprite/obj/Unit_New","src/g/fight/base/RES","../../../../enum/HpType"],function(t,e,i,s,o,n,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(n){function t(t){var e=n.call(this,t)||this;return e.petType=s.enumPet.shenjiang,e}return __extends(t,n),t.prototype.playWeaponEffect=function(t){},t.prototype.playAnimation=function(t,e){void 0===e&&(e=-1),n.prototype.playAnimation.call(this,t,e);var i=this.coat;3==t&&i&&(i.interval=2*o.Unit_New.ANIMATION_INTERNAL_UNIT,i.play())},t}(i.Pet),l=function(i){function t(t){var e=i.call(this,t)||this;return e.petType=s.enumPet.ringling,e}return __extends(t,i),t.prototype.getRoleRes=function(t){var e=this.face;return 4<this.face&&(e=8-this.face),n.RES.ringPath(this.avatarId,t,e)},t.prototype.isSummonPet=function(){return 0<this.petType},t.prototype.setTopHpBarType=function(t){void 0===t&&(t=a.HpType.role),this.topHpBar&&(this.topHpBar.typeElement=t)},t}(e.Shenjiang=r);e.RingLingPet=l}),define("src/g/fight/osprite/play/baseplay/SvrHeroUnit",["require","exports","src/g/fight/osprite/obj/Pet","src/g/fight/osprite/obj/HeroUnit","src/g/fight/osprite/obj/FightGroup","../../../../../utils/ItemUtils","../../../../../enum/JobEnum","src/g/fight/osprite/SceneObjCtroller","../../../../../enum/HpType"],function(t,e,C,i,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(o){function _(t){void 0===t&&(t=null);var e=o.call(this,t)||this;return e._familyName=null,e}return __extends(_,o),_.prototype.chg_HP=function(t,e,i,n,s){void 0===s&&(s=!1),this.hpchanges.length&&(t=this.hpchanges.pop()),o.prototype.chg_HP.call(this,t,e,i,n,s)},_.prototype.setPetUnit=function(t){this._pet=t},_.prototype.setRingLingUnit=function(t){this._ringling=t},_.prototype.deathHide=function(){this._pet&&(this._pet.setHp(0),this._pet.deathHide()),o.prototype.deathHide.call(this)},_.prototype.destroyUnit=function(){o.prototype.destroyUnit.call(this),this._pet=null},_.prototype.svrSetHP=function(t,e){void 0===e&&(e=!0);var i=t-this.getHp();i&&(e&&this.hpchanges.push(i),this.setHp(t))},_.prototype.initHeroData=function(t,e,i,n,s){void 0===n&&(n=""),void 0===s&&(s=1),this.topHpBar.familyName=this._familyName,o.prototype.initHeroData.call(this,t,e,i,n,s)},_.createFightGroup=function(t,e,i,n,s){if(void 0===i&&(i=!0),void 0===n&&(n=!1),void 0===s&&(s=!1),t){var o=t.petData,a=t.openhero,r=a.length,l=new I.FightGroup(t.username);l.otherData=t;for(var h=null,c=0;c<r;c++){var u=a[c];0==c&&(u.curTitle=t.titleData?t.titleData.curTitle:null,u.familyName=t.familyName);var p=new _;if(p._familyName=t.familyName,p.heroIndex=c,l.addFightUnit(p),p.initHeroData(u,t.chopLv,0,t.nickname),p.username=t.username,s&&(p.pkGold=!0),p.topHpBar.typeElement=n?E.HpType.role:E.HpType.monster,u.jobid==w.JobEnum.DAOSHI&&-1<u.openSkill.indexOf(14)){var d=b.ItemUtils.getPetVoById(1),g=1e3;o&&o.open&&(g=b.ItemUtils.getPetAvid(o)),(v=new C.Pet(g)).topHpBar.typeElement=n?E.HpType.role:E.HpType.monster,v.set_DATA(d),p.setPetUnit(v),h=v}}if(h)l.addFightUnit(h);else if(o&&o.open){d=b.ItemUtils.getPetVoById(1);var v,f=b.ItemUtils.getPetAvid(o);(v=new C.Pet(f)).set_DATA(d),p.setPetUnit(v),v.topHpBar.typeElement=n?E.HpType.role:E.HpType.monster,l.addFightUnit(v)}var y=t.rwData.chuzhanId;if(0<y){var m=l.showFollowRing(b.ItemUtils.getRingUrl(y),!0);p.setRingLingUnit(m)}return l.resetFightGroup(e,i),l.addToFightLayer(),S.SceneObjCtroller.ins.updateSbSkill(t.sbData,l),l}},_}(i.HeroUnit);e.SvrHeroUnit=n}),define("src/g/fight/osprite/obj/Item",["require","exports","src/g/fight/osprite/obj/BaseSprite","../../../../manager/LayerManager"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.offsetX=0,t.offsetY=0,t}return __extends(t,e),t.prototype.init=function(t){var e=this.disp=new Laya.Animation;e.autoPlay=!0,e.loadAtlas(t),e.interval=120,this.offsetX=-13,this.offsetY=-78},t.prototype.frameMove=function(t){this.updatePoint(),this.disp.x=this.gridX+this.offsetX,this.disp.y=this.gridY+this.offsetY},t.prototype.destory=function(){e.prototype.destory.call(this),n.LayerManager.fightLayer.removeItem(this),this.disp&&this.disp.destroy(!0),this.disp=null},t.prototype.addToFightLayer=function(){n.LayerManager.fightLayer.addItem(this)},t}(i.BaseSprite);e.Item=s}),define("src/g/fight/osprite/play/RealTimeScene",["require","exports","src/g/fight/osprite/play/GamePlay","../../../net/messages/UserAppearGS2C","../../../net/messages/UserDisappearGS2C","../../../../manager/GameSocketManager","../../../net/messages/UserMoveMsg","../../../net/messages/PKStartMsg","src/g/fight/osprite/obj/FightGroup","../../../net/messages/EnterMuSceneC2GS","src/g/fight/base/InteractionLayer","src/g/fight/osprite/SceneObjCtroller","src/g/fight/osprite/map/MapConst","../../../net/messages/UserAttackMsg","../../../net/messages/MuPkMsg","src/g/fight/osprite/obj/FightUnit","../../../../manager/RoleCenter","src/g/index/ctrl/BtnSkiilCtrl","../../../../core/E","../../../../enum/EventName","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","src/g/fight/osprite/play/baseplay/SvrHeroUnit","src/g/fight/osprite/obj/Item","../../../../utils/DiyMatrix","../../../../utils/ItemUtils","../../../../config/GameConfig","src/init/TextConst"],function(t,e,i,c,s,l,o,a,n,h,r,u,p,v,d,f,y,m,_,C,I,b,w,S,E,T,A,R){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(g){function t(t){var e=g.call(this,t)||this;e._tempPoint=new Laya.Point,e._possibleMaxNum=50,e._tempBeAttackList=[[]],e._allowClickPkKey=!1,e._sendPkInfoKey=!1,e._rageAdd=5,e._initRage=0,e._targetName=null,e._linkDic={},e._possibleTargetArr=[],e._ppListchangeKey=!1,e.selfRevengeList=[],e.selfAllRevengeList=[],e._revengeListChangeKey=!1,e._fMListChangeKey=!1,e._familyMemberList=[],e._hurtTotalNum=0,e._playerPosDic={},e._playerIsSafeDic={},e._invincibleKey=!0,e._autoFllowKey=!0,e._mapInitKey=!1,e._enterInitKey=!1,e._allInitKey=!1,e._pkLimitLevel=60,e.matrixList=[],e.startPt=null,e._itemList=[],e.playSettingVo&&(e._rageAdd=e.playSettingVo.rageAdd);var i=l.GSM.ins;i.on(a.PkStartMUSGS2C.KEY,e,e.onPKStartMUSGS2C),i.on(d.MuPkSuspendGS2C.KEY,e,e.onMuPkSuspendGS2C),i.on(a.PKEndMUSGS2C.KEY,e,e.onPKEndMUSG2C),i.on(h.MuSceneUserReviveGS2C.KEY,e,e.onMuSceneUserReviveGS2C),i.on(o.PositionDebugMsg.KEY,e,e.onPositionDebugMsg),i.on(v.UserRageChangeGS2C.KEY,e,e.onUserRageChangeGS2C),i.on(c.UserAppearGS2C.KEY,e,e.onMsgEnter),i.on(o.UserMoveGS2C.KEY,e,e.onMsgMove),i.on(s.UserDisappearGS2C.KEY,e,e.onMsgExit),i.on(c.InvincibleStateEndGS2C.KEY,e,e.onInvincibleStateEndGS2C),_.E.ins.on(C.EventName.SELECT_TARGET_INDEX,e,e.selectTarget),_.E.ins.on(C.EventName.SELECT_REVENGE_TARGET_INDEX,e,e.selectRevengeTarget),_.E.ins.on(C.EventName.UNIT_MOVE_END,e,e.onMoveEnd);var n=u.SceneObjCtroller.ins.getSelfGroup();return e.setFightGroup(n),n.addToFightLayer(),n.stand(),n.portId=e.scene.port.id,n.refreshHalo(),e.clearPossibleTarget(),e.clearRevenge(),e._ppListchangeKey=!1,e._useInfoAddValueKey=!1,e}return __extends(t,g),Object.defineProperty(t.prototype,"mapInitKey",{get:function(){return this._mapInitKey},set:function(t){this._mapInitKey=t,this.updateInit()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enterInitKey",{get:function(){return this._enterInitKey},set:function(t){this._enterInitKey=t,this.updateInit()},enumerable:!0,configurable:!0}),t.prototype.init=function(t){void 0===t&&(t=null),g.prototype.init.call(this,t),this.mapInitKey=!0},t.prototype.updateInit=function(){this._mapInitKey&&this._enterInitKey&&(this._allInitKey||(this._allInitKey=!0,this.allInit()))},t.prototype.allInit=function(){},t.prototype.frameMove=function(){if(g.prototype.frameMove.call(this),this._sendPkInfoKey&&this._targetName){var t=this._playerDic[this._targetName];if(t&&this._mainRole&&t.getMainRole()){var e=t.getMainRole();(2!=e.action||this.checkAttackDistance(this._mainRole.mapX,this._mainRole.mapY,e.mapX,e.mapY,this._mainRole.get_ATTACKDISTANCE(),0))&&(this.pkStart(0,this._targetName),this._sendPkInfoKey=!1)}else this.clearTarget(),this._sendPkInfoKey=!1}if(this._ppListchangeKey){this._ppListchangeKey=!1;for(var i=null,n=0;n<this._possibleTargetArr.length;n++)(i=this._possibleTargetArr[n])&&(i.isInSafeArea=this._playerIsSafeDic[i.groupID]);_.E.ins.event(C.EventName.UPDATE_VIEW_TARGET,[this._possibleTargetArr])}this._revengeListChangeKey&&(this._revengeListChangeKey=!1,_.E.ins.event(C.EventName.UPDATE_REVENGE_VIEW_TARGET,[this.selfRevengeList])),this._fMListChangeKey&&(this._fMListChangeKey=!1,_.E.ins.event(C.EventName.UPDATE_VIEW_FAMILYMEMBER,[this._familyMemberList])),m.BtnSkiilCtrl.ins.frameMove()},t.prototype.createFightGroup=function(t,e){return w.SvrHeroUnit.createFightGroup(t,e,!1)},t.prototype.enablePK=function(t){this._allowClickPkKey=t},t.prototype.addPPlayer=function(t){t.groupID!=y.RoleCenter.instans.self.username?this.addToList(t,this._possibleTargetArr)&&(this._ppListchangeKey||(this._ppListchangeKey=!0)):console.error("潜在攻击对象，不能是自己")},t.prototype.removePPlayer=function(t){this.removeFromList(t,this._possibleTargetArr)&&(this._ppListchangeKey||(this._ppListchangeKey=!0))},t.prototype.selectTarget=function(t){if(-1<t&&t<this._possibleTargetArr.length){var e=this._possibleTargetArr[t];e&&this.pkStartAndTestDistance(e.groupID)}},t.prototype.addFamilyMemeber=function(t){t.groupID!=y.RoleCenter.instans.self.username?-1==this._familyMemberList.indexOf(t)&&(this._familyMemberList.push(t),this._fMListChangeKey=!0):console.error("潜在攻击对象，不能是自己")},t.prototype.removeFamilyMember=function(t){var e=this._familyMemberList.indexOf(t);-1<e&&(this._familyMemberList.splice(e,1),this._fMListChangeKey=!0)},t.prototype.selectFamilyMember=function(t){if(-1<t&&t<this._familyMemberList.length){var e=this._familyMemberList[t];e&&this.pkStartAndTestDistance(e.groupID)}},t.prototype.addToList=function(t,e){for(var i=null,n=!1,s=0;s<e.length;s++)if((i=e[s])&&t.groupID==i.groupID){n=!0;break}if(!n)for(s=0;s<e.length;s++)if(null==(i=e[s]))return e[s]=t,!0;return!1},t.prototype.removeFromList=function(t,e){for(var i=null,n=0;n<e.length;n++)if((i=e[n])&&i.groupID==t)return!(e[n]=null);return!1},t.prototype.onMoveEnd=function(t){var e=Math.floor(t/n.FightGroup.HERO_MAXNUM),i=t%n.FightGroup.HERO_MAXNUM;this._mainRole&&e==this.fightGroup.uId&&i==this._mainRole.index&&this._autoFllowKey&&this._targetName&&this.pkStartAndTestDistance(this._targetName)},t.prototype.sendEnterMuSceneC2GS=function(t,e,i,n,s,o,a){void 0===s&&(s=h.EEnterMuSceneType.CLIENT_REQUEST),void 0===o&&(o=0),void 0===a&&(a=0);var r=new h.EnterMuSceneC2GS;r.portid=e,r.enter=t,r.posx=i,r.posy=n,r.targetX=o,r.targetY=a,r.enterType=s,l.GSM.sendServer(r)},t.prototype.setMainRoleByMsg=function(t){if(t.opresult){if(t.enter){this.currentPortId=t.portid;var e=this.getWorldByMap(t.posx,t.posy);switch(t.enterType){case h.EEnterMuSceneType.REVIVE:this._fightGroup.resetFightGroup(e,!1);break;case h.EEnterMuSceneType.CLIENT_REQUEST_SCENE:break;default:this._fightGroup.setMapXY(t.posx,t.posy)}for(var i=null,n=this._fightGroup.getCount(),s=0;s<t.userHPArr.length&&s<n;s++)i=this._fightGroup.getUnitByIndex(s),0<t.userHPArr[s]&&0==i.getHp()&&i.resetUnit(e[0],e[1]),i.setHp(t.userHPArr[s]);this.switchRole(!0),this._fightGroup.portId=t.portid,r.InteractionLayer.netMove=!0,m.BtnSkiilCtrl.ins.autoProcess(t.initRageVal,this._rageAdd),this._initRage=t.initRageVal,this._invincibleKey=t.invincibleState,this._invincibleKey&&this._mainRole&&this._mainRole.showOff(),this.enterInitKey=!0}}else console.log("RealTimeScene::onEnterMuSceneGS2C:"+t.error)},t.prototype.onActivityRebirthGS2C=function(t){t.userAcc==y.RoleCenter.instans.vo.username&&m.BtnSkiilCtrl.ins.autoProcess(this._initRage,this._rageAdd)},t.prototype.onMsgEnter=function(t){this.setHeroPos(t.userinfo.username,t.posx,t.posy);for(var e=this.getWorldByMap(t.posx,t.posy),i=this.createFightGroup(t.userinfo,e),n=null,s=i.getValidArr(),o=0;o<s.length;o++)n=s[o],o<t.hpArr.length&&n.setHp(t.hpArr[o]),this._allowClickPkKey&&n.startPkMode();switch(i.addToFightLayer(),t.moving?(i.moveToMapPoint(t.tarx,t.tary),this.setHeroPos(t.userinfo.username,t.tarx,t.tary)):i.stand(),this.addPlayerFG(i),t.invincibleState?i.getMainRole()&&i.getMainRole().showOff():this.addPPlayer(i),t.userState){case c.EMultiUserState.PK_MONSTER:break;case c.EMultiUserState.PK_BOSS:this._linkDic[i.groupID]=t.pkMonsterUid;break;case c.EMultiUserState.PK_USER:var a=this._playerDic[t.pkUserTarget];a?i.setOnceTarget(a):this._tempBeAttackList.push([t.pkUserTarget,i.groupID]),this._linkDic[i.groupID]=t.pkUserTarget;break;case c.EMultiUserState.DEATH:}this._linkDic[i.groupID]||delete this._linkDic[i.groupID];var r=null,l=null,h=null;for(o=0;o<this._tempBeAttackList.length;o++)(r=this._tempBeAttackList[o])[0]==t.userinfo.username&&(l=this._playerDic[r[1]],h=this._playerDic[r[0]],l&&h&&l.setOnceTarget(h),this._tempBeAttackList.splice(o,1),o--);return i},t.prototype.onInvincibleStateEndGS2C=function(t){var e=this._playerDic[t.username];t.username==y.RoleCenter.instans.self.username&&(r.InteractionLayer.canClick=!0,this._invincibleKey=!1),e&&this.addPPlayer(e)},t.prototype.getWorldByMap=function(t,e){return[Math.floor(t/p.MapConst.MAP_TILED_W),Math.floor(e/p.MapConst.MAP_TILED_W)]},t.prototype.onMsgExit=function(t){delete this._linkDic[t.username];var e=this._playerDic[t.username];this.removeRevengeList(e),this.removeFamilyMember(e),this.breakAttackLink(t.username),e&&this.removePlayerFG(e,!0),this.removePPlayer(t.username)},t.prototype.onMsgMove=function(t){if(this._linkDic[t.username]=null,t.username!=this._fightGroup.groupID){var e=this._playerDic[t.username];e&&(this.removeRevengeList(e),this.setHeroPos(t.username,t.targetx,t.targety),e.moveToMapPoint(t.targetx,t.targety)),this._autoFllowKey&&this._targetName==t.username&&this.pkStartAndTestDistance(this._targetName)}else this.setHeroPos(t.username,t.targetx,t.targety)},t.prototype.onPositionDebugMsg=function(t){var e=this._playerDic[t.username];e&&this.debugPos(e,t.posx,t.posy,!0)},t.prototype.onUserRageChangeGS2C=function(t){m.BtnSkiilCtrl.ins.completeProcess(t.rageVal)},t.prototype.onStatueHPGS2C=function(t){},t.prototype.clear=function(){g.prototype.clear.call(this),r.InteractionLayer.netMove=!1,r.InteractionLayer.canClick=!0,l.GSM.ins.off(a.PkStartMUSGS2C.KEY,this,this.onPKStartMUSGS2C),l.GSM.ins.off(d.MuPkSuspendGS2C.KEY,this,this.onMuPkSuspendGS2C),l.GSM.ins.off(a.PKEndMUSGS2C.KEY,this,this.onPKEndMUSG2C),l.GSM.ins.off(h.MuSceneUserReviveGS2C.KEY,this,this.onMuSceneUserReviveGS2C),l.GSM.ins.off(o.PositionDebugMsg.KEY,this,this.onPositionDebugMsg),l.GSM.ins.off(v.UserRageChangeGS2C.KEY,this,this.onUserRageChangeGS2C),l.GSM.ins.off(c.UserAppearGS2C.KEY,this,this.onMsgEnter),l.GSM.ins.off(o.UserMoveGS2C.KEY,this,this.onMsgMove),l.GSM.ins.off(s.UserDisappearGS2C.KEY,this,this.onMsgExit),l.GSM.ins.off(c.InvincibleStateEndGS2C.KEY,this,this.onInvincibleStateEndGS2C),_.E.ins.off(C.EventName.SELECT_TARGET_INDEX,this,this.selectTarget),_.E.ins.off(C.EventName.SELECT_REVENGE_TARGET_INDEX,this,this.selectRevengeTarget),_.E.ins.off(C.EventName.UNIT_MOVE_END,this,this.onMoveEnd);for(var t=0;t<this._itemList.length;t++)this._itemList[t].destory();this._itemList.length=0;var e=this._playerDic;for(var i in e){e[i].destroyGroup(!0)}this.clearPossibleTarget(),this.clearRevenge(),this.clearFMList()},t.prototype.clearPossibleTarget=function(){for(var t=0;t<this._possibleMaxNum;t++)this._possibleTargetArr[t]=null;_.E.ins.event(C.EventName.UPDATE_VIEW_TARGET,null)},t.prototype.clearRevenge=function(){for(;0<this.selfRevengeList.length;)this.removeRevengeList(this.selfRevengeList[0]);_.E.ins.event(C.EventName.UPDATE_REVENGE_VIEW_TARGET,null)},t.prototype.clearFMList=function(){for(;0<this._familyMemberList.length;)this.removeFamilyMember(this._familyMemberList[0]);_.E.ins.event(C.EventName.UPDATE_VIEW_FAMILYMEMBER,null)},t.prototype.isInSafeArea=function(t,e){return!1},t.prototype.pkStartAndTestDistance=function(t,e){if(void 0===e&&(e=!1),t!=y.RoleCenter.instans.self.username){if(this._invincibleKey)I.FE.upItems(R.TextConst.get(463),b.BubbleEnum.center);else if(this.checkSafeAreaLimit(t)&&this.checkModeLimit()&&this.checkLevelLimit()){this.setTargetName(t),this._fightGroup.setOnceTarget(null);var i=!0;if(!e)if(this._playerDic[t]){var n=this._playerPosDic[t];i=!this.followTargetPos(n.x,n.y)}i&&(this._sendPkInfoKey=!0)}}else I.FE.upItems(R.TextConst.get(464),b.BubbleEnum.center)},t.prototype.checkSafeAreaLimit=function(t){return!0},t.prototype.checkModeLimit=function(){return!0},t.prototype.checkLevelLimit=function(){return y.RoleCenter.instans.self.lvl>=this._pkLimitLevel||(I.FE.upItems(R.TextConst.get(465,this._pkLimitLevel),b.BubbleEnum.center),!1)},t.prototype.pkStart=function(t,e){if(this._linkDic[this._fightGroup.groupID]!=e){if(!this._fightGroup.isDeath()&&(this._fightGroup.stand(),this._mainRole)){var i=new a.PKStartMUSC2GS;switch(i.portid=this.currentPortId,t){case 0:i.pktarget=e;break;case 1:i.pkMonsterUid=0}i.posx=this._mainRole.mapX,i.posy=this._mainRole.mapY,l.GSM.sendServer(i)}}else{var n=this._playerDic[e];n&&(this._fightGroup.setOnceTarget(n),this._fightGroup.stand())}},t.prototype.onPKStartMUSGS2C=function(t){if(t.opresult){""==t.pktarget?this._linkDic[t.pksrc]=t.pkMonsterUid:this._linkDic[t.pksrc]=t.pktarget;var e=this._playerDic[t.pksrc],i=this._playerDic[t.pktarget];switch(e&&i&&(e.setOnceTarget(i),e.stand(),this.debugPos(e,t.posx,t.posy),this.setHeroPos(t.pksrc,t.posx,t.posy),e.addToFightLayer()),y.RoleCenter.instans.self.username){case t.pksrc:break;case t.pktarget:-1==this.selfAllRevengeList.indexOf(t.pksrc)&&this.selfAllRevengeList.push(t.pksrc)}}else{this.clearTarget();t.error}},t.prototype.onAttackMsg=function(t){var e=!1;t.attackAcc==y.RoleCenter.instans.self.username&&(e=!0);for(var i=this._playerDic[t.attackAcc],n=this._playerDic[t.beAttackAcc],s=t.heroAttack,o=null,a=null,r=0;r<s.length;r++)if(o=s[r],i&&(a=i.getUnitByIndex(r))){var l=new f.AttackInfo;if(l.targets=[],l.hps=[],l.skillResLower=[],l.skillResHigh=[],n)for(var h=o.skillRes,c=(o.isJiFengTrigger(r),o.hpChg),u=null,p=n.getFUList(),d=0;d<p.length&&d<c.length&&d<h.length;d++)u=p[d],0!=c[d]&&(e&&(this._hurtTotalNum+=c[d]),l.targets.push(u),l.hps.push(-c[d]),l.skillResLower.push(h[d]&v.ESkillRes.LOW_MASK),l.skillResHigh.push(h[d]&v.ESkillRes.HIGH_MASK));l.skillId=o.skillid,!a.isLimitDraw()&&2!=a.action&&a.fightTarget&&(a.addAttackInfo(l),a.playFight(Date.now(),-1))}t.beAttackAcc==y.RoleCenter.instans.self.username&&i&&this.addRevengeList(i),g.prototype.onAttackMsg.call(this,t)},t.prototype.releaseSkillHandler=function(t){this._fightGroup&&this._fightGroup._targetFG?this.releaseSkill(t,this._fightGroup._targetFG.groupID):this.releaseSkill(t,"")},t.prototype.onComboHit=function(t){g.prototype.onComboHit.call(this,t),0!=t.comboid&&this._fightGroup&&t.attackAcc==this._fightGroup.groupID&&m.BtnSkiilCtrl.ins.autoProcess(0,this._rageAdd)},t.prototype.onMuPkSuspendGS2C=function(t){this._linkDic[t.pkSrc]=null;var e=this._playerDic[t.pkSrc];e&&this.endFight(e),this.endPk(t.pkSrc),this._autoFllowKey&&this._targetName&&this.pkStartAndTestDistance(this._targetName)},t.prototype.followTargetPos=function(t,e,i){if(void 0===i&&(i=-1),this._mainRole&&(-1==i&&(i=this._mainRole.get_ATTACKDISTANCE()),!this.checkAttackDistance(this._mainRole.mapX,this._mainRole.mapY,t,e,i,0))){this._tempPoint.setTo(this._mainRole.mapX-t,this._mainRole.mapY-e),this._tempPoint.normalize();for(var n=t+this._tempPoint.x*(i-1),s=e+this._tempPoint.y*(i-1),o=null,a=Laya.Matrix.TEMP,r=1;!this.scene.map.isCrossMapXY(n,s)&&r<8;)a.identity(),a.rotate(Math.PI/4*r),o=a.transformPoint(this._tempPoint),this._tempPoint.setTo(o.x,o.y),n=t+this._tempPoint.x*(i-1),s=e+this._tempPoint.y*(i-1),r++;if(this._mainRole.mapX!=n||this._mainRole.mapY!=s)return 1!=this._mainRole.status&&this._fightGroup.moveToMapPoint(n,s,!0,this._mainRole),!0}return!1},t.prototype.checkAttackDistance=function(t,e,i,n,s,o){return this._tempPoint.setTo(i-t,n-e),Math.sqrt(this._tempPoint.x*this._tempPoint.x+this._tempPoint.y*this._tempPoint.y)<=s+o},t.prototype.endFight=function(t){this.removeRevengeList(t),t.setFGTarget(null),t.stand()},t.prototype.endPk=function(t){y.RoleCenter.instans.self.username},t.prototype.onPKEndMUSG2C=function(t){var e=this._playerDic[t.pksrc],i=this._playerDic[t.pktarget],n=null,s=null;s=t.win?(n=i,e):(n=e,i),this.updateDeadState(s,n)},t.prototype.updateDeadState=function(t,e){e&&(t&&_.E.ins.event(C.EventName.POP_KILL_TIP,[""==e.groupID?"BOSS":e.getNickName(),""==t.groupID?"BOSS":t.getNickName()]),this.removeRevengeList(e),e.groupID==this._fightGroup.groupID&&(this.showDeadAlert(e,t),this.clearTarget(),this.clearRevenge()),e.groupID==this._targetName&&this.clearTarget(),e.setFGTarget(null),this._linkDic[e.groupID]=null,this.breakAttackLink(e.groupID),this._ppListchangeKey=!0)},t.prototype.showDeadAlert=function(t,e){},t.prototype.breakAttackLink=function(t){t==this._targetName&&this.clearTarget();var e=null;for(var i in this._playerDic)(e=this._playerDic[i]).getFGTarget()&&e.getFGTarget().groupID==t&&(e.setFGTarget(null),this._linkDic[e.groupID]=null,e.getMainRole()&&3==e.getMainRole().action&&e.stand())},t.prototype.getReLifeLocation=function(t){return[Math.random()*this.scene.map.width,Math.random()*this.scene.map.height]},t.prototype.muSceneUserReviveC2GS=function(t){var e=this.getReLifeLocation(t),i=e[0],n=e[1];this.isInSafeArea(i,n)||console.error(i,n);var s=new h.MuSceneUserReviveC2GS;s.portid=this.currentPortId,s.username=t.groupID,s.posx=i,s.posy=n,l.GSM.sendServer(s)},t.prototype.onMuSceneUserReviveGS2C=function(t){t.opresult?this.resetHero(t.username,t.posx,t.posy):console.log("重生失败："+t.errorCode.toString())},t.prototype.resetHero=function(t,e,i){this.setHeroPos(t,e,i);var n=this._playerDic[t];n?(n.resetFightGroup(this.getWorldByMap(e,i),!1),n.setMapXY(e,i),t==y.RoleCenter.instans.self.username&&this.switchRole(!0),this._ppListchangeKey=!0):console.log("找不到角色："+t.toString())},t.prototype.addRevengeList=function(t){return-1==this.selfRevengeList.indexOf(t)&&(this.selfRevengeList.push(t),this._revengeListChangeKey=!0)},t.prototype.removeRevengeList=function(t){var e=this.selfRevengeList.indexOf(t);return-1<e&&(this.selfRevengeList.splice(e,1),this._revengeListChangeKey=!0)},t.prototype.selectRevengeTarget=function(t){if(-1<t&&t<this.selfRevengeList.length){var e=this.selfRevengeList[t];e&&this.pkStartAndTestDistance(e.groupID)}},t.prototype.getFreeRevengeTarget=function(){for(var t=null,e=0;e<this.selfRevengeList.length;e++)if((t=this.selfRevengeList[e])&&!t.isDeath())return t;return null},t.prototype.traceDebug=function(){console.log("..................................对我攻击的名单.......................................");for(var t="",e=0;e<this.selfRevengeList.length;e++)t=t+this.selfRevengeList[e]+",";console.log(t),console.log("..................................所有对我攻击的名单.......................................");var i="";for(e=0;e<this.selfAllRevengeList.length;e++)i=i+this.selfAllRevengeList[e]+",";console.log(i)},t.prototype.debugPos=function(t,e,i,n){if(void 0===n&&(n=!1),t.getMainRole()){Laya.Point.TEMP.x=t.getMainRole().mapX,Laya.Point.TEMP.y=t.getMainRole().mapY;Laya.Point.TEMP.distance(e,i)}},t.prototype.onClearTargetHandler=function(t){g.prototype.onClearTargetHandler.call(this,t),this.clearTarget()},t.prototype.clearTarget=function(){this.setTargetName(null)},t.prototype.setHeroPos=function(t,e,i){var n=this._playerPosDic[t];n||(n=this._playerPosDic[t]=new Laya.Point);var s=this.isInSafeArea(e,i);this._playerIsSafeDic[t]!=s&&(this._playerIsSafeDic[t]=s,this._ppListchangeKey=!0),n.x=e,n.y=i},t.prototype.testDrugBuff=function(){this._mainRole.set_buf(this._mainRole,2,1)},t.prototype.setTargetName=function(t){this._sendPkInfoKey=!1,this._targetName!=t&&(this._targetName=t,_.E.ins.event(C.EventName.CHANGE_PK_TARGET,this._targetName))},t.prototype.getHurtTotalValue=function(){return this._hurtTotalNum},t.prototype.clearHurtValue=function(){this._hurtTotalNum=0},t.prototype.createAreaMatrixList=function(t,e,i){void 0===e&&(e=-1),void 0===i&&(i=!1);for(var n=T.ItemUtils.getPortVoById(t),s=A.GameConfig.getMapJSON(n.boss_scene),o=Math.floor(s.doorXY.length/3),a=s.doorXY,r=0;r<o;r++){var l=new E.DiyMatrix;l.id=-1!=e?e:r+1,l.initInvertMatrix(a[3*r],a[3*r+1],a[3*r+2]),i&&this.drawSafeArea(a[3*r],a[3*r+1],a[3*r+2]),this.matrixList.push(l)}this.startPt=s.startPoint},t.prototype.getExpAreaLevelByPos=function(t,e){for(var i=null,n=this.matrixList.length,s=0;s<n;s++)if((i=this.matrixList[s]).intCoordinate(t,e))return i.id;return-1},t.prototype.isInMatrixList=function(t,e,i){for(var n=0;n<t.length;n++)if(t[n].intCoordinate(e,i))return!0;return!1},t.prototype.getCoordinatePos=function(t){var e=.1+.8*Math.random(),i=.1+.8*Math.random();return[e*t.a+i*t.c+t.tX,e*t.b+i*t.d+t.tY]},t.prototype.drawSafeArea=function(t,e,i,n){void 0===n&&(n=15);var s=t[0],o=t[1],a=e[0]-s,r=e[1]-o,l=i[0]-s,h=i[1]-o,c=[s,o],u=[s+l,o+h],p=[s+a,o+r],d=[s+a+l,o+r+h];1&n&&this.addSafeItems(c,u),2&n&&this.addSafeItems(u,d),4&n&&this.addSafeItems(d,p),8&n&&this.addSafeItems(p,c)},t.prototype.addSafeItems=function(t,e){for(var i=e[0]-t[0],n=e[1]-t[1],s=Math.sqrt(i*i+n*n),o=Math.floor(s/90),a=null,r=0;r<o;r++)(a=new S.Item).init("dynamic2/uieffect/EUI1_43.json"),a.setMapXY(i*r/o+t[0],n*r/o+t[1]),a.addToFightLayer(),this._itemList.push(a)},t}(i.GamePlay);e.RealTimeScene=g}),define("src/g/fight/osprite/play/baseplay/SvrPeopleBossMonster",["require","exports","src/g/fight/osprite/obj/MonsterUnit_New","src/g/clearRes/ClearResM","src/g/fight/osprite/obj/Unit_New","src/g/fight/osprite/GameScene","../../../../../utils/DropUtil"],function(t,e,i,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1);var i=n.call(this,t,e)||this;return i.dropProcess=!1,i.moveModulus=8,i.alphaStep=1,i}return __extends(t,n),t.prototype.set_DATA=function(t){n.prototype.set_DATA.call(this,t)},t.prototype.chg_HP=function(t,e,i,n,s){void 0===s&&(s=!1),this.floatBlood(t,e?e.job:0,i,n,s),this.resetHpBar()},t.prototype.svrSetHP=function(t){if(this.setHp(t),this.resetHpBar(),0==t&&this.dropProcess){var e=a.GameScene.ins.map.id;this._dropArr&&0<this._dropArr.length&&(a.GameScene.ins.map.isSameMap(e)&&r.DropUtil.createDrop(this._dropArr,new Laya.Point(this.worldX,this.worldY)),this._dropArr.length=0,this.dropProcess=!1)}},t.prototype.setUnitVis=function(t){this.body&&(n.prototype.setUnitVis.call(this,t),!t&&this.cancelLoad(),!t&&s.ClearResM.clearMonster(this.monsterUrl))},t.prototype.resetUnit=function(t,e){n.prototype.resetUnit.call(this,t,e),this.stand(),this.setHp(this.data.HP),this.sk_Manager.clear_buff(),this.setWorldXY(t,e),this.resetHpBar(),this.body&&(this.body.alpha=1)},Object.defineProperty(t.prototype,"move_speed",{get:function(){return o.Unit_New.move_SPEED/this.moveModulus},enumerable:!0,configurable:!0}),t}(i.MonsterUnit_New);e.SvrPeopleBossMonster=n}),define("src/g/fight/osprite/play/RealTimeBossScene",["require","exports","src/g/fight/osprite/play/RealTimeScene","../../../../core/E","../../../../enum/EventName","src/g/fight/osprite/obj/FightGroup","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../net/messages/PKStartMsg","../../../../manager/GameSocketManager","../../../net/messages/UserAppearGS2C","../../../net/messages/UserMoveMsg","../../../../manager/RoleCenter","../../../../utils/ItemUtils","src/g/fight/osprite/play/baseplay/SvrPeopleBossMonster","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f,y=function(i){function t(t){var e=i.call(this,t)||this;return e._battleState=0,e._currTargetFG=null,e._bossGroup=null,e._attackingStatusList=[],n.E.ins.on(s.EventName.UNIT_MOVE_END,e,e.onMoveEndSC),n.E.ins.on(s.EventName.SELECT_PK_TARGET,e,e.onSelectPkTarget),e}return __extends(t,i),t.prototype.changeBattleState=function(t){return this._battleState!=t&&(this._currTargetFG=null,this._battleState=t,!0)},t.prototype.onMsgEnter=function(t){var e=i.prototype.onMsgEnter.call(this,t);switch(t.userState){case c.EMultiUserState.PK_MONSTER:break;case c.EMultiUserState.PK_BOSS:this.addAttackStatusFG(e);break;case c.EMultiUserState.PK_USER:case c.EMultiUserState.DEATH:}return e},t.prototype.createTombStoneMonster=function(t){var e=null,i=d.ItemUtils.getMonsterVOById(t);if(i){e=new o.FightGroup(null);var n=new g.SvrPeopleBossMonster(!0,!0);if(n.moveModulus=0,n.set_DATA(i),e.addFightUnit(n),e.visibleTopHpBar(!0),n){var s=n.topHpBar;s.limitDrawHpBar(),s.drawDiyBg("res/custom/timedi.png"),s.setTextColor("#09d51f"),s.setTextSize(20)}}return e},t.prototype.onPKStartMUSGS2C=function(t){if(i.prototype.onPKStartMUSGS2C.call(this,t),t.opresult){var e=this._playerDic[t.pksrc];e?0<t.pkMonsterUid?this.addAttackStatusFG(e):this.removeAttackStatusFG(e):console.error("找不到名字为《{0}》的发起者".replace("{0}",t.pksrc))}},t.prototype.getSelfPos=function(){var t=this._fightGroup.getFUList();if(t&&0<t.length){var e=t[0];return[e.mapX,e.mapY]}return[0,0]},t.prototype.onMoveEndSC=function(t){var e=Math.floor(t/o.FightGroup.HERO_MAXNUM),i=t%o.FightGroup.HERO_MAXNUM;this._mainRole&&e==this.fightGroup.uId&&i==this._mainRole.index&&3==this._battleState&&this.startKillMonster()},t.prototype.startKillMonster=function(){if(this._invincibleKey)return a.FE.upItems(v.TextConst.get(463),r.BubbleEnum.center),!1;if(this.clearTarget(),this.changeBattleState(3),this._fightGroup&&this._bossGroup){n.E.ins.event(s.EventName.CHANGE_PK_TARGET,this._bossGroup.groupID);var t=this._bossGroup.getMainRole();if(t&&!this.followTargetPos(t.mapX,t.mapY)&&this._mainRole){if(this._linkDic[this._fightGroup.groupID]&&this._linkDic[this._fightGroup.groupID]==t.unit_uid)return!0;this.sendAttackBossMsg(t.unit_uid)}}return!0},t.prototype.visibleBeFocus=function(t){for(var e=null,i=this._bossGroup.getCount(),n=0;n<i;n++)e=this._bossGroup.getUnitByIndex(n),t?e.setFocusEff():e.clearBeFocus()},t.prototype.visibleBossFG=function(t){this._bossGroup&&(t?this._bossGroup.addToFightLayer():this._bossGroup.removeFromFightLayer(),this.visibleBeFocus(t))},t.prototype.onHpChg=function(t){i.prototype.onHpChg.call(this,t),t.beAttack==p.RoleCenter.instans.self.username&&null==this._mainRole&&this.updateDeadState(this._bossGroup,this._fightGroup)},t.prototype.sendAttackBossMsg=function(t){var e=new l.PKStartMUSC2GS;e.portid=this.currentPortId,e.pkMonsterUid=t,e.posx=this._mainRole.mapX,e.posy=this._mainRole.mapY,h.GSM.sendServer(e)},t.prototype.breakAttackLink=function(t){i.prototype.breakAttackLink.call(this,t);var e=this._playerDic[t];this.removeAttackStatusFG(e)},t.prototype.addAttackStatusFG=function(t){-1==this._attackingStatusList.indexOf(t)&&this._attackingStatusList.push(t),this._bossGroup&&!this._bossGroup.isDeath()&&t.setOnceTarget(this._bossGroup)},t.prototype.removeAttackStatusFG=function(t){var e=this._attackingStatusList.indexOf(t);-1<e&&this._attackingStatusList.splice(e,1)},t.prototype.clearAttackStatusList=function(){for(var t=0;t<this._attackingStatusList.length;t++)this._attackingStatusList[t].setFGTarget(null);this._attackingStatusList.splice(0,this._attackingStatusList.length)},t.prototype.onMsgMove=function(t){if(t.username!=this._fightGroup.groupID)switch(t.umState){case u.EUserState.PKSTATUE_STOP:case u.EUserState.NULL:var e=this._playerDic[t.username];e&&e.setOnceTarget(null),this.removeAttackStatusFG(e)}i.prototype.onMsgMove.call(this,t)},t.prototype.getAttackGuardStatus=function(){for(var t=null,e=0;e<this._attackingStatusList.length;e++)if((t=this._attackingStatusList[e])&&!t.isDeath())return t;return null},t.prototype.onSelectPkTarget=function(t){var e=this._playerDic[t];e&&(this.changeBattleState(0),this.pkStartAndTestDistance(t)),this._currTargetFG=e},t.prototype.selectTarget=function(t){if(this.changeBattleState(0),-1<t&&t<this._possibleTargetArr.length){var e=this._possibleTargetArr[t];e&&(""==e.groupID?this.startKillMonster():(this.pkStartAndTestDistance(e.groupID),this._currTargetFG=e))}},t.prototype.selectRevengeTarget=function(t){this.changeBattleState(0),i.prototype.selectRevengeTarget.call(this,t)},t.prototype.onClearTargetHandler=function(t){i.prototype.onClearTargetHandler.call(this,t),t.move&&(3==this._battleState&&(this._fightGroup&&this._fightGroup.setOnceTarget(null),n.E.ins.event(s.EventName.CHANGE_PK_TARGET,null)),this.changeBattleState(0))},t.prototype.bossDead=function(){this.clearAttackStatusList(),3==this._battleState&&this.changeBattleState(0),this._fightGroup._targetFG==this._bossGroup&&this._fightGroup.setOnceTarget(null)},t.prototype.showDeadAlert=function(t,e){i.prototype.showDeadAlert.call(this,t,e),this.changeBattleState(0)},t.prototype.clear=function(){i.prototype.clear.call(this),this._bossGroup&&(this._bossGroup.destroyGroup(!0),this._bossGroup=null),n.E.ins.off(s.EventName.UNIT_MOVE_END,this,this.onMoveEndSC),n.E.ins.off(s.EventName.SELECT_PK_TARGET,this,this.onSelectPkTarget)},t.prototype.clearAllState=function(){this.changeBattleState(0),this._fightGroup.setFGTarget(null),this.clearPossibleTarget(),this.clearRevenge(),this.clearFMList(),this.clearTarget(),this.clearAttackStatusList()},t}(i.RealTimeScene);e.RealTimeBossScene=y,(f=e.ESCFBattleState||(e.ESCFBattleState={}))[f.BATTLE_NULL=0]="BATTLE_NULL",f[f.BATTLE_GUARD_STATUS=1]="BATTLE_GUARD_STATUS",f[f.BATTLE_CLEAR_TARGET=2]="BATTLE_CLEAR_TARGET",f[f.BATTLE_ATTACK_STATUS=3]="BATTLE_ATTACK_STATUS",f[f.BATTLE_MOVE_TRANS=4]="BATTLE_MOVE_TRANS",f[f.BATTLE_PLUCK_SEAL=5]="BATTLE_PLUCK_SEAL",f[f.BATTLE_QIANG_DECREE=6]="BATTLE_QIANG_DECREE"}),define("src/g/fight/osprite/obj/ISceneObj",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),define("src/g/fight/osprite/obj/TransPoint",["require","exports","src/g/fight/osprite/obj/Item","../../../../component/GAnimation","../../../../core/E","../../../../enum/EventName"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(t){void 0===t&&(t=null),this.effect=this.disp=new n.GAnimation(!0),this.effect.load("dynamic2/uieffect/EUI1_45.json"),this.effect.hitArea=new Laya.Rectangle(300,300,100,100),this.effect.on(Laya.Event.CLICK,this,this.onClick)},e.prototype.onClick=function(){s.E.ins.event(o.EventName.TRANS_POINT_CLICK,this.index)},e.prototype.destory=function(){this.effect.off(Laya.Event.CLICK,this,this.onClick),t.prototype.destory.call(this)},e}(i.Item);e.TransPoint=a}),define("src/g/fight/osprite/obj/DrawSprite",["require","exports","src/g/fight/osprite/obj/BaseSprite","../../../../manager/LayerManager"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.offsetX=0,t.offsetY=0,t}return __extends(t,e),t.prototype.init=function(){this.disp=new Laya.Sprite},t.prototype.frameMove=function(t){this.updatePoint(),this.disp.x=this.gridX+this.offsetX,this.disp.y=this.gridY+this.offsetY},t.prototype.destory=function(){e.prototype.destory.call(this),n.LayerManager.fightLayer.removeItem(this),this.disp.destroy(!0),this.disp=null},t.prototype.addToFightLayer=function(){n.LayerManager.fightLayer.addItem(this)},t}(i.BaseSprite);e.DrawSprite=s}),define("src/g/fight/osprite/play/family/GamePlaySandyCityFight",["require","exports","src/g/fight/osprite/obj/FightGroup","src/g/fight/osprite/play/family/SandCityFManager","src/g/fight/osprite/map/MapConst","src/g/fight/osprite/obj/TransPoint","../../../../../core/E","../../../../../enum/EventName","../../../../../utils/system/ServerTime","../../../../../config/GameConfig","src/g/fight/osprite/play/baseplay/SvrPeopleBossMonster","../../../../../utils/ItemUtils","../../../../net/messages/SandyCityMsg","src/g/fight/osprite/play/PlayManager","src/g/fight/osprite/obj/DrawSprite","../../../../../utils/system/FloatEffect","../../../../../plugin/view/ToolTip","src/init/TextConst","src/g/fight/osprite/map/MainCamera","src/g/fight/osprite/play/baseplay/SvrHeroUnit","src/g/fight/osprite/play/RealTimeBossScene","src/g/fight/base/RES","../../../../../utils/system/DateUitl","src/init/Switches"],function(t,e,l,o,a,n,s,h,i,c,u,p,d,g,v,f,y,m,_,C,r,I,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var S=function(r){function t(t){var e=r.call(this,t)||this;return e._transPointArr=[],e._stationPointArr=[],e._endTime=-1,e._pluckCompleteTime=-1,e._isPluckKey=!1,e._portId=-1,e._mapData=null,e._drawSprite=null,e._temple=null,e._skeleton=null,e._gameingKey=!1,e._nextSendPlucksealTime=0,e._waitDestoryStatusKey=!1,s.E.ins.event(h.EventName.OPEN_SHA_CHENG),g.PlayManager.loading=!1,o.SandCityFManager.getInstance().gamePlay=e,s.E.ins.on(h.EventName.TRANS_POINT_CLICK,e,e.onTransPointClick),s.E.ins.on(h.EventName.EXIT_BOSS_PLAYTYPE,e,e.onExitHandler),o.SandCityFManager.getInstance().enterGamePlay(e,o.SandCityFManager.getInstance().getPortIdByLevel(0),800,1312),e._gameingKey=!0,e.preLoadSkAnimation(),e}return __extends(t,r),t.prototype.changeBattleState=function(t){return!!r.prototype.changeBattleState.call(this,t)&&(o.SandCityFManager.getInstance().resetUIState(),!0)},t.prototype.changeMap=function(t,e){this.clearEff(),this.currentPortId=this._portId=t;var i=c.GameConfig.getPortByID(t);switch(this._mapData=c.GameConfig.getMapJSON(i.boss_scene),this.clearMap(),this.initTransPoint(),this._portId==o.SandCityFManager.getInstance().getPortIdByLevel(0)?this.enablePK(!1):this.enablePK(!0),o.SandCityFManager.getInstance().getBattleWarState()){case d.ESandyWarPhase.ATTACK_STATUE:this._portId==o.SandCityFManager.getInstance().getPortIdByLevel(1)&&(this._bossGroup=this.initBoss(),o.SandCityFManager.getInstance().getIsLastWinnerKey()||this.addPPlayer(this._bossGroup),this._drawSprite=this.createDrawSprite(this._bossGroup.getMainRole().mapX,this._bossGroup.getMainRole().mapY),this._stationPointArr.push(this._drawSprite),this._bossGroup.setVisible(!1),this._skeleton=this.createAnimation(),this._skeleton&&(this._skeleton.y=50,this._drawSprite.disp.addChild(this._skeleton)));break;case d.ESandyWarPhase.SNATCH_SEAL:this._portId==o.SandCityFManager.getInstance().getPortIdByLevel(2)&&(this._bossGroup=this.initBoss(),this._bossGroup.addToFightLayer())}this.scene&&this.scene.changeMap(e)},t.prototype.preLoadSkAnimation=function(){var t=new Laya.Templet;t.loadAni(I.RES.MONSTER_PATH+"skeleton/DiaoXiangBao_butu.sk"),t.on(Laya.Event.COMPLETE,this,this.parseCompletHander)},t.prototype.parseCompletHander=function(t){this._gameingKey?this._temple=t:t.destroy()},t.prototype.createAnimation=function(){var t=null;return this._temple&&((t=this._temple.buildArmature(1)).scale(1.5,1.5),t.play(0,!0),t.index=0,t.stop()),t},t.prototype.startBoom=function(){this._skeleton&&this._skeleton.play(0,!1)},t.prototype.clearMap=function(){for(var t=null,e=0;e<this._transPointArr.length;e++)(t=this._transPointArr[e])&&t.destory();this._transPointArr.splice(0,this._transPointArr.length);var i=null;for(e=0;e<this._stationPointArr.length;e++)(i=this._stationPointArr[e])&&i.destory();this._stationPointArr.splice(0,this._stationPointArr.length),this.clearOtherPlayer(),this._bossGroup&&(this._bossGroup.destroyGroup(!0),this._bossGroup=null),this._monsterDic={},this.clearAllState(),_.MainCamera.ins.endForce(),s.E.ins.off(h.EventName.CAMERA_MOVE_END,this,this.moveEnd),this._waitDestoryStatusKey=!1,this._skeleton&&(this._skeleton.destroy(!0),this._skeleton=null),this.changeBattleState(0)},t.prototype.moveToNextTransPoint=function(){this.onTransPointClick(1)},t.prototype.pluckSeal=function(){this._nextSendPlucksealTime=i.ServerTime.serverTime,this.changeBattleState(5)},t.prototype.startPluckSealTime=function(t){this._isPluckKey=!0,this._pluckCompleteTime=t},t.prototype.stopPluckSealTime=function(t){this._isPluckKey=!1,(6==this._battleState||t)&&this.changeBattleState(0)},t.prototype.createDrawSprite=function(t,e){var i=new v.DrawSprite;return i.init(),i.setMapXY(t,e),i.addToFightLayer(),i},t.prototype.initTransPoint=function(){for(var t=this._mapData.bossDoorXY,e=0;e<t.length;e++)this.addTransPoint(t[e],e)},t.prototype.addTransPoint=function(t,e){var i=new n.TransPoint;i.init(),i.index=e,i.setWorldXY(parseInt(t[0]),parseInt(t[1])),i.addToFightLayer(),this._transPointArr.push(i)},t.prototype.onTransPointClick=function(t){var e=null;-1<t&&t<this._transPointArr.length&&(this.clearTarget(),e=this._transPointArr[t],this._fightGroup.moveToMapPoint(e.mapX,e.mapY,!0),this.changeBattleState(4))},t.prototype.onMoveEndSC=function(t){r.prototype.onMoveEndSC.call(this,t);var e=Math.floor(t/l.FightGroup.HERO_MAXNUM),i=t%l.FightGroup.HERO_MAXNUM;if(this._mainRole&&e==this.fightGroup.uId&&i==this._mainRole.index)for(var n=null,s=0,o=0,a=0;a<this._transPointArr.length;a++)if((s=(n=this._transPointArr[a]).mapX-this._mainRole.mapX)*s+(o=n.mapY-this._mainRole.mapY)*o<800){switch(a){case 0:break;case 1:this.changeNewScene()}break}},t.prototype.changeNewScene=function(){switch(o.SandCityFManager.getInstance().getBattleWarState()){case d.ESandyWarPhase.ATTACK_STATUE:this._portId==o.SandCityFManager.getInstance().getPortIdByLevel(0)&&(o.SandCityFManager.getInstance().checkIsHaveEnterInnearCity()?this.enterNewScene(1):f.FE.upItems(m.TextConst.SCF_ENTER_INNERCITY,y.BubbleEnum.center));break;case d.ESandyWarPhase.CAPTURE_ARENA:break;case d.ESandyWarPhase.SNATCH_SEAL:this._portId==o.SandCityFManager.getInstance().getPortIdByLevel(0)?o.SandCityFManager.getInstance().checkIsHaveEnterInnearCity()&&this.enterNewScene(1):this._portId==o.SandCityFManager.getInstance().getPortIdByLevel(1)&&(o.SandCityFManager.getInstance().checkIsHaveEnterPalace()?this.enterNewScene(2):f.FE.upItems(m.TextConst.SCF_ENTER_PALACE,y.BubbleEnum.center))}},t.prototype.enterNewScene=function(t){var e=o.SandCityFManager.getInstance().getMapByLevel(t),i=o.SandCityFManager.getInstance().getPortIdByLevel(t),n=(e.startPoint[0][0]+.5)*a.MapConst.MAP_TILED_W,s=(e.startPoint[0][1]+.5)*a.MapConst.MAP_TILED_W;this.sendEnterMuSceneC2GS(!0,i,n,s)},t.prototype.onExitHandler=function(){this.sendEnterMuSceneC2GS(!1,this._portId,0,0)},t.prototype.moveToStatusPoint=function(){if(this._bossGroup){var t=this._bossGroup.getUnitByIndex(0);t&&(s.E.ins.on(h.EventName.CAMERA_MOVE_END,this,this.moveEnd),_.MainCamera.ins.moveToPoint(t.mapX,t.mapY))}},t.prototype.moveEnd=function(){_.MainCamera.ins.startShakeScreen(),this._waitDestoryStatusKey=!0},t.prototype.getFreeAttackTarget=function(){for(var t=null,e=null,i=Number.MAX_VALUE,n=0;n<this._possibleTargetArr.length;n++)if((t=this._possibleTargetArr[n])&&""!=t.groupID&&!t.isDeath()){var s=this.getDistance(this._fightGroup,t);s<i&&(i=s,e=t)}return e},t.prototype.getDistance=function(t,e){var i=t.getMainRole().mapX-e.getMainRole().mapX,n=t.getMainRole().mapY-e.getMainRole().mapY;return i*i+n*n},t.prototype.onStatueHPGS2C=function(t){0<t.hp&&!this._monsterDic[t.monsterUid]&&this._bossGroup&&(this._monsterDic[t.monsterUid]=this._bossGroup.getUnitByIndex(0),this._bossGroup.addToFightLayer()),0==t.hp&&(this.moveToStatusPoint(),this.bossDead(),0<t.cdtime&&(this._endTime=t.cdtime+i.ServerTime.serverTime,Laya.timer.loop(1,this,this.updateCountTime)))},t.prototype.updateCountTime=function(){var t=this._endTime-i.ServerTime.serverTime;t<0&&(t=0,Laya.timer.clear(this,this.updateCountTime))},t.prototype.initBoss=function(){var t=null,e=c.GameConfig.getPortByID(this._portId),i=p.ItemUtils.getMonsterVOById(e.boss);if(i){t=new l.FightGroup(null);var n=new u.SvrPeopleBossMonster(!1,!0);n.moveModulus=0,n.set_DATA(i),t.addFightUnit(n);var s=this._mapData.bossXY[0];t.setMapXY(s[0],s[1]),t.visibleTopHpBar(!1)}return t},t.prototype.createFightGroup=function(t,e){var i=this._fightGroup.getFamilyUid()==t.familyUid;return C.SvrHeroUnit.createFightGroup(t,e,!1,i)},t.prototype.addPPlayer=function(t){o.SandCityFManager.getInstance().isLastWinnerKey()?t.getFamilyUid()!=this._fightGroup.getFamilyUid()&&r.prototype.addPPlayer.call(this,t):o.SandCityFManager.getInstance().getBattleWarState()==d.ESandyWarPhase.ATTACK_STATUE&&o.SandCityFManager.getInstance().isHaveLastWinnerKey()?t.getFamilyUid()==o.SandCityFManager.getInstance().getLastFamilyUID()&&r.prototype.addPPlayer.call(this,t):t.getFamilyUid()!=this._fightGroup.getFamilyUid()&&r.prototype.addPPlayer.call(this,t)},t.prototype.frameMove=function(){if(r.prototype.frameMove.call(this),this._isPluckKey){var t=this._pluckCompleteTime-i.ServerTime.serverTime;t<0&&(t=0,this._isPluckKey=!1),o.SandCityFManager.getInstance().updateProcess(t)}if(this._currTargetFG&&this._currTargetFG.isDeath()&&(1!=this._battleState&&2!=this._battleState||this.changeBattleState(0)),0==this._invincibleKey&&null==this._targetName&&this._mainRole){switch(this._battleState){case 1:this._currTargetFG=this.getAttackGuardStatus();break;case 2:this._currTargetFG=this.getFreeAttackTarget();break;case 3:break;case 5:if(!this._isPluckKey){var e=null;this._bossGroup&&(e=this._bossGroup.getMainRole()),this._mainRole&&e&&(1!=this._mainRole.action||this.followTargetPos(e.mapX,e.mapY)||i.ServerTime.serverTime>this._nextSendPlucksealTime&&(o.SandCityFManager.getInstance().sendPluckSealC2GS()?this._nextSendPlucksealTime=i.ServerTime.serverTime+5:this.changeBattleState(0)))}break;case 0:2!=this._mainRole.action?this._currTargetFG=this.getFreeRevengeTarget():this._currTargetFG=null}this._currTargetFG&&this.pkStartAndTestDistance(this._currTargetFG.groupID)}this._waitDestoryStatusKey&&(this._waitDestoryStatusKey=!1,this.startBoom())},t.prototype.pkStartAndTestDistance=function(t,e){void 0===e&&(e=!1);var i=this._playerDic[t];i&&this._fightGroup.getFamilyUid()!=i.getFamilyUid()&&r.prototype.pkStartAndTestDistance.call(this,t,e)},t.prototype.clear=function(){r.prototype.clear.call(this),this._gameingKey=!1,this._temple&&(this._temple.destroy(),this._temple=null),this.clearMap(),s.E.ins.off(h.EventName.TRANS_POINT_CLICK,this,this.onTransPointClick),s.E.ins.off(h.EventName.EXIT_BOSS_PLAYTYPE,this,this.onExitHandler),o.SandCityFManager.getInstance().exitGamePlay(),b.DateUtil.getKFDay()<=7&&Laya.timer.once(500,this,function(){w.Switches.ins.event(168)})},t.prototype.setTop=function(t){for(var e=null,i=-1,n=0;n<this._possibleTargetArr.length;n++)if((e=this._possibleTargetArr[n])&&t==e.groupID){i=n;break}if(-1!=i&&0!=i&&0<this._possibleTargetArr.length){var s=this._possibleTargetArr[i];this._possibleTargetArr[i]=this._possibleTargetArr[0],this._possibleTargetArr[0]=s,this._ppListchangeKey=!0}},t}(r.RealTimeBossScene);e.GamePlaySandyCityFight=S}),define("src/g/fightactivity/view/FightItem",["require","exports","../../../utils/system/DateUitl","src/g/fightactivity/ctrl/FightActivityCtrl","../../../enum/EventName","../../../core/E","src/g/clearRes/ClearResM","../../../config/GameConfig","../../../utils/system/ServerTime","../../../enum/TimingActivityType","src/g/fight/osprite/play/family/SandCityFManager","src/init/TextConst"],function(t,e,u,p,i,n,s,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.btn_fight.on(Laya.Event.CLICK,t,t.fightHandler),n.E.ins.on(i.EventName.CLOSEALLWINDOWS,t,t.closeClearRes),t}return __extends(t,e),t.prototype.closeClearRes=function(){s.ClearResM.clearUrl(this.bg.skin),n.E.ins.off(i.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.fightHandler=function(){n.E.ins.event(i.EventName.GOTO_ACTIVTY,this._vo)},t.prototype.setData=function(t){(this._vo=t).image&&(this.bg.skin="dynamic2/activity/"+t.image+".png");var e=1e3*g.ServerTime.serverTime,i=new Date(e).getTime(),n=new Date(e).getDay(),s=u.DateUtil.getKFDay(),o=d.GameConfig.commonJson.kaifuhuodonglunhuan.value||0,a=t.day,r="",l=!1,h=t.activity;if(h==v.TimingActivityType.ZsBoss)-1==a.indexOf(n)?(r=t.penTips,l=!0):r=t.todayTips;else if(h==v.TimingActivityType.WorldBoss)s<t.firstCron?(r=t.firstTips,l=!0):r=t.todayTips;else if(h==v.TimingActivityType.ShenWeiYu)s<t.firstCron?(r=t.firstTips,l=!0):r=t.penTips;else if(h==v.TimingActivityType.Sandcity)if(s<o)s==t.firstCron?r=t.todayTips:(r=t.firstTips,l=!0);else if(f.SandCityFManager.getInstance().isTodayOpen){var c=new Date(g.ServerTime.adjustAreaMS(e));c.setHours(23),c.setMinutes(59),c.setSeconds(59),r=t.todayTips,i>c.getTime()&&(f.SandCityFManager.getInstance().isTodayOpen=!1,r=t.penTips)}else r=t.penTips,l=!0;else s<o?s==t.firstCron?r=t.todayTips:(r=t.firstTips,l=!0):-1==a.indexOf(n)?(r=t.penTips,l=!0):r=t.todayTips;p.FightActivityCtrl.redActivity==t.gongneng?(this.btn_red.visible=!0,r=y.TextConst.get(477),l=!1):this.btn_red.visible=!1,this.gray=l,this.desc.text=r},t}(ui.fightactivity.FightItemUI);e.FightItem=o}),define("src/g/fightactivity/view/FightActivityView",["require","exports","src/g/fightactivity/view/FightItem","../../../config/GameConfig","src/g/clearRes/ClearResM","src/g/fightactivity/ctrl/FightActivityCtrl","../../../manager/LayerManager","../../../core/E","../../../enum/EventName","../../../utils/system/DateUitl","../../../utils/system/ServerTime","../../../enum/TimingActivityType","src/g/fight/osprite/play/family/SandCityFManager"],function(t,e,i,u,p,d,n,s,o,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.list.vScrollBarSkin="",t.list.itemRender=i.FightItem,t.list.scrollBar.elasticDistance=100,t.list.renderHandler=new Laya.Handler(t,t.itemHandler),t.bgview.btn_back.on(Laya.Event.CLICK,t,t.closeHandler),t.bgview.btn_close.on(Laya.Event.CLICK,t,t.closeHandler),t}return __extends(t,e),t.prototype.showPage=function(){n.LayerManager.addInPOPWindowLayer(this),this.refreshData(),this.bgview.img_title.skin="res/title/huodong_biaoti.png",p.ClearResM.resetViewImg(this),s.E.ins.on(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){s.E.ins.off(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.refreshData=function(){this.showView()},t.prototype.closeHandler=function(){this.removeSelf()},t.prototype.itemHandler=function(t,e){t.setData(this.list.array[e])},t.prototype.showView=function(){var t,e=u.GameConfig.timingActivity,i=[],n=d.FightActivityCtrl.redActivity;for(var s in e){var o=e[s];o.gongneng!=n?i.push(e[s]):t=o}t&&i.unshift(t);var a=1e3*v.ServerTime.serverTime,r=new Date(a).getTime(),l=g.DateUtil.getKFDay(),h=u.GameConfig.commonJson.kaifuhuodonglunhuan.value||0,c=new Date(a).getDay();i.sort(function(t,e){var i=t.day,n=t.activity,s=1;if(n==f.TimingActivityType.ZsBoss)-1==i.indexOf(c)||(s=-1);else if(n==f.TimingActivityType.WorldBoss)l<t.firstCron||(s=-1);else if(n==f.TimingActivityType.ShenWeiYu)l>=t.firstCron&&(s=-1);else if(n==f.TimingActivityType.Sandcity){if(l<h)l==t.firstCron&&(s=-1);else if(y.SandCityFManager.getInstance().isTodayOpen){s=-1;var o=new Date(v.ServerTime.adjustAreaMS(a));o.setHours(24),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0),r>o.getTime()&&(y.SandCityFManager.getInstance().isTodayOpen=!1,s=1)}}else l<h?l==t.firstCron&&(s=-1):-1==i.indexOf(c)||(s=-1);return s}),this.list.array=i,p.ClearResM.resetViewImg(this)},t.prototype.hideView=function(){this.closeHandler()},t.prototype.destroyView=function(){},t}(ui.fightactivity.FightActivityViewUI);e.FightActivityView=a}),define("src/g/fightactivity/ctrl/FightActivityCtrl",["require","exports","../../../config/GameConfig","../../net/messages/ChangeSceneMsg","src/g/accessctrl/AccessCenter","../../../manager/NewRedHintsCenter","src/g/index/ctrl/BossTipCtrl","src/g/fightactivity/view/FightActivityView","src/init/Switches","../../../core/E","../../../enum/EventName","../../../utils/system/ServerTime","../../../enum/TimingActivityType","src/g/fight/osprite/play/family/SandCityFManager"],function(t,e,C,n,i,s,o,a,r,l,h,I,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(){this._curListArr=[],r.Switches.ins.on(191,this,this.openView)}return t.prototype.openView=function(){this._activtiyView||(this._activtiyView=new a.FightActivityView),this._activtiyView.showPage()},t.delayHandler=function(){i.AccessCenter.ins.checkOpen(18)?(o.BossTipCtrl.activtyPop(this.redActivity),s.NewRedHintsCenter.ins.setRedHintOpenOrClose(s.enumRedHints.playactivity,!0),this._iconurl&&""!=this._iconurl&&l.E.ins.event(h.EventName.openAct,this._iconurl),0<=this._lefttime&&Laya.timer.once(1e3*(this._lefttime-I.ServerTime.serverTime),this,this.removeHandler),Laya.timer.once(3e5,this,this.removeHandler)):this.removeHandler()},t.removeHandler=function(){this._lefttime=-1,this.redActivity=0,s.NewRedHintsCenter.ins.setRedHintOpenOrClose(s.enumRedHints.playactivity,!1),l.E.ins.event(h.EventName.openAct)},t.startActivity=function(t,e){void 0===e&&(e=-1),this._lefttime=e;var i="res/huodong/";switch(t){case n.EPlayType.PLAYTYPE_ALLWORLDBOSS:break;case n.EPlayType.PLAYTYPE_SANDYNIGHT:this._iconurl=i+"yezhan.png",this.redActivity=183;break;case n.EPlayType.PLAYTYPE_PASSIONPOINT:this._iconurl=i+"paodian.png",this.redActivity=167;break;case n.EPlayType.PLAYTYPE_WORLDBOSS:this._iconurl=i+"shijie.png",this.redActivity=184;break;case n.EPlayType.PLAYTYPE_REBORNBOSS:this._iconurl=i+"zhuansheng.png",this.redActivity=76;break;case n.EPlayType.PLAYTYPE_FIGHTSC:this._iconurl=i+"shacheng.png",this.redActivity=112;break;case 163:this._iconurl=i+"dati.png",this.redActivity=163;break;case 291:case 292:this._iconurl=i+"shenweiyu.png",this.redActivity=291;break;default:return}Laya.timer.once(2e3,this,this.delayHandler)},t.endActivtiy=function(t){this.removeHandler()},t.getLastActByDay=function(t,e,i){var n;void 0===i&&(i=1e3*I.ServerTime.serverTime);var s=new Date(I.ServerTime.adjustAreaMS(i)).getTime(),o=C.GameConfig.timingActivity,a=new Date(I.ServerTime.adjustAreaMS(i)),r=C.GameConfig.commonJson.kaifuhuodonglunhuan.value||0,l=[];for(var h in o){var c=(g=o[h]).day,u=g.activity;if(u==b.TimingActivityType.ZsBoss)-1!=c.indexOf(t)&&l.push(g);else if(u==b.TimingActivityType.WorldBoss)e>=g.firstCron&&l.push(g);else if(u==b.TimingActivityType.ShenWeiYu)e>=g.firstCron&&l.push(g);else if(u==b.TimingActivityType.Sandcity){if(e<r)e==g.firstCron&&l.push(g);else if(w.SandCityFManager.getInstance().isTodayOpen){var p=new Date(I.ServerTime.adjustAreaMS(i));if(p.setHours(24),p.setMinutes(0),p.setSeconds(0),p.setMilliseconds(0),s>p.getTime()){w.SandCityFManager.getInstance().isTodayOpen=!1;continue}l.push(g)}}else e<r?e==g.firstCron&&l.push(g):-1!=c.indexOf(t)&&l.push(g)}for(var d=0;d<l.length;d++)for(var g,v=(g=l[d]).openTime,f=v.length,y=new Date(i),m=f-1;0<=m;m-=2){y.setHours(v[m-1]),y.setMinutes(v[m]),y.setSeconds(0),y.setMilliseconds(0);var _={id:g.id,startTime:[v[m-1],v[m]]};if(!(y.getTime()>s))break;n||(n=_),a.setHours(n.startTime[0]),a.setMinutes(n.startTime[1]),a.setSeconds(0),a.setMilliseconds(0),a.getTime()>y.getTime()&&(n=_)}return n},t.redActivity=0,t._iconurl="",t}();e.FightActivityCtrl=c}),define("src/g/fight/osprite/play/family/SandCityFManager",["require","exports","../../../../net/messages/SandyCityMsg","../../../../../manager/GameSocketManager","../../../../net/messages/EnterMuSceneC2GS","../../../../../core/E","../../../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../../net/messages/ChangeSceneMsg","../../../../net/messages/SandyCityExpMsg","../../../../../config/GameConfig","../../../../../utils/system/ServerTime","../../../../net/messages/OpNoParaC2GS","src/init/Switches","../../../../../utils/system/FloatEffect","../../../../../plugin/view/ToolTip","../../../../../manager/BulletManager","../../../../../manager/RoleCenter","../../../../net/messages/ImperialSealMsg","../../../../net/messages/ActivityMessage","src/init/TextConst","../../../../../utils/ItemUtils","../../../../net/messages/DeathAdditionBuffGS2C","src/g/fightactivity/ctrl/FightActivityCtrl","../../../../net/messages/SandyNightMsg","../../../../../manager/AM"],function(t,e,o,a,r,i,n,s,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var T,A=function(){function t(){this.shaChengCtrl=null,this.worshipRewardDlg=null,this.startPoint=[0,0],this.sandyCityWarInfo=null,this.sandyExpChangeGS2C=null,this.pluckSealStartGS2C=null,this.endSandyCityWar=null,this.realTimeSandyWarExp=null,this.realTimeFamilyExp=null,this.gamePlay=null,this.settingOpenTime=120,this._enterInnerCityTime=0,this._limitCountDownTime=0,this._endWarStateTime=0,this._cityPortIdArr=[21250,21251,21252],this._isLastWinnerKey=!1,this._enterSCFTime=0,this._key=!1,this._battleWarState=o.ESandyWarPhase.NULL,this._settingPersist1Time=0,this._settingPersist2Time=0,this._settingPersist3Time=0,this.isTodayOpen=!1,this.settingOpenTime=this.getSettingData("opentime"),this._settingPersist1Time=this.getSettingData("persist1Time"),this._settingPersist2Time=this.getSettingData("persist2Time"),this._settingPersist3Time=this.getSettingData("persist3Time")}return t.getInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.enterGamePlay=function(t,e,i,n){this.gamePlay=t;var s=a.GSM.ins;s.on(h.SandyExpChangeGS2C.KEY,this,this.onSandyExpChangeGS2C),s.on(h.RealTimeSandyWarExp.KEY,this,this.onRealTimeSandyWarExp),s.on(h.RealTimeFamilyExp.KEY,this,this.onRealTimeFamilyExp),s.on(o.SandyKillGS2C.KEY,this,this.onSandyKillGS2C),s.on(_.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),s.on(o.StatueHPGS2C.KEY,this,this.onStatueHPGS2C),s.on(m.PluckSealFailGS2C.KEY,this,this.onPluckSealFailGS2C),s.on(m.PluckSealStartGS2C.KEY,this,this.onPluckSealStartGS2C),s.on(m.PluckSealStopGS2C.KEY,this,this.onPluckSealStopGS2C),s.on(b.DeathAdditionBuffGS2C.KEY,this,this.onDeathAdditionBuffGS2C),s.on(r.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C),s.on(o.SealShieldChgGS2C.KEY,this,this.onHDValueChanged),s.on(S.GetScoreBonusGS2C.KEY,this,this.onGetScoreBonusGS2C),this.gamePlay.sendEnterMuSceneC2GS(!0,e,i,n)},t.prototype.exitGamePlay=function(){this.shaChengCtrl&&(this.shaChengCtrl.closeView(),this.shaChengCtrl=null),this.pluckSealStartGS2C=null,this.gamePlay=null,this._limitCountDownTime=this._enterInnerCityTime=u.ServerTime.serverTime,i.E.ins.event(n.EventName.closeWarDeath);var t=a.GSM.ins;t.off(h.SandyExpChangeGS2C.KEY,this,this.onSandyExpChangeGS2C),t.off(h.RealTimeSandyWarExp.KEY,this,this.onRealTimeSandyWarExp),t.off(h.RealTimeFamilyExp.KEY,this,this.onRealTimeFamilyExp),t.off(o.SandyKillGS2C.KEY,this,this.onSandyKillGS2C),t.off(_.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),t.off(o.StatueHPGS2C.KEY,this,this.onStatueHPGS2C),t.off(m.PluckSealFailGS2C.KEY,this,this.onPluckSealFailGS2C),t.off(m.PluckSealStartGS2C.KEY,this,this.onPluckSealStartGS2C),t.off(b.DeathAdditionBuffGS2C.KEY,this,this.onDeathAdditionBuffGS2C),t.off(o.SealShieldChgGS2C.KEY,this,this.onHDValueChanged),t.off(S.GetScoreBonusGS2C.KEY,this,this.onGetScoreBonusGS2C),t.off(r.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C)},t.prototype.sendOpNoParaC2GS=function(t){var e=new p.OpNoParaC2GS;e.optype=t,a.GSM.sendServer(e)},t.prototype.reqWorshipReward=function(){console.log("SandCityFManager::reqWorshipReward"),0==y.RoleCenter.instans.self.ufData.worshipSanto?this.sendOpNoParaC2GS(p.EOpNopara.worshipSandySanto):g.FE.upItems(C.TextConst.get(428),v.BubbleEnum.center)},t.prototype.reqSandCityData=function(t){void 0===t&&(t=!1),this.sendOpNoParaC2GS(p.EOpNopara.getSandyWarInfo),t||this._key||(this._key=!0)},t.prototype.reqFamilyExpData=function(){this.sendOpNoParaC2GS(p.EOpNopara.getFamilyRTExp)},t.prototype.reqWarExpData=function(){this.sendOpNoParaC2GS(p.EOpNopara.getSandyWarRTExp)},t.prototype.sendPluckSealC2GS=function(){if(this.checkIsHavePluckSeal())return this.outInfo(this.pluckSealStartGS2C.nickname),!1;var t=new m.PluckSealC2GS;return a.GSM.sendServer(t),!0},t.prototype.outInfo=function(t){g.FE.upItems(C.TextConst.get(429,t),v.BubbleEnum.center)},t.prototype.onSandyCityWarInfo=function(t){this.sandyCityWarInfo=t,this._battleWarState=this.sandyCityWarInfo.battlePhase,this._key?d.Switches.ins.event(112):this.sandyCityWarInfo.sandyCityState==o.ESandyCityState.OPEN&&(i.E.ins.event(n.EventName.SC_WAR_START),w.FightActivityCtrl.startActivity(l.EPlayType.PLAYTYPE_FIGHTSC)),this._limitCountDownTime=this._enterInnerCityTime=u.ServerTime.serverTime+t.enterCD/1e3,this.calculateEndTime(t.phaseStartTime),i.E.ins.event(n.EventName.SANDY_CITY_WARINFO)},t.prototype.onSandyWarStartGS2C=function(t){f.BulletManager.addBroadcastById(t.hornid),this.sandyCityWarInfo||(this.sandyCityWarInfo=new o.SandyCityWarInfo),this.sandyCityWarInfo.sandyCityState=o.ESandyCityState.OPEN,this._battleWarState=this.sandyCityWarInfo.battlePhase=o.ESandyWarPhase.ATTACK_STATUE,this.calculateEndTime(u.ServerTime.serverTime),this.sandyCityWarInfo.openTime=t.openTime,this.sandyCityWarInfo.nextOpenTime=t.nextOpenTime,i.E.ins.event(n.EventName.SC_WAR_START),w.FightActivityCtrl.startActivity(l.EPlayType.PLAYTYPE_FIGHTSC)},t.prototype.onEndSandyCityWar=function(t){this.endSandyCityWar=t,this.sandyCityWarInfo&&(this.sandyCityWarInfo.sandyCityState=o.ESandyCityState.CLOSE),i.E.ins.event(n.EventName.SC_WAR_END),w.FightActivityCtrl.endActivtiy(l.EPlayType.PLAYTYPE_FIGHTSC),this.gamePlay&&Laya.timer.once(1,this,this.openResultPanel)},t.prototype.onWorshipSantoGS2C=function(t){t.opresult?(y.RoleCenter.instans.self.ufData.worshipSanto+=1,y.RoleCenter.instans.addInventoryToC(t.invent),y.RoleCenter.effectExpAndMoney(t.invent),this.worshipRewardDlg&&(this.worshipRewardDlg.close(),this.worshipRewardDlg=null)):console.error("svrInfo:"+t.error)},t.prototype.openResultPanel=function(){i.E.ins.event(n.EventName.OPEN_SCWAR_SETTLEMENT)},t.prototype.sendExitMuScene=function(){this.gamePlay&&this.gamePlay.onExitHandler()},t.prototype.onEnterMuSceneGS2C=function(t){if(t.opresult)if(t.enter){var e=c.GameConfig.getPortByID(t.portid);if(this.gamePlay&&(this.gamePlay.setMainRoleByMsg(t),this.gamePlay.changeMap(e.id,e.boss_scene)),this._battleWarState==o.ESandyWarPhase.ATTACK_STATUE&&t.portid==this.getPortIdByLevel(0)){if(this._isLastWinnerKey)this._enterInnerCityTime=this.sandyCityWarInfo.openTime;else{var i=c.GameConfig.sandyCitySettingJson.oneTime;this._enterInnerCityTime=i?this.sandyCityWarInfo.openTime+i.value:this.sandyCityWarInfo.openTime}var n=c.GameConfig.sandyCitySettingJson.oneTime;this._limitCountDownTime=n?this.sandyCityWarInfo.openTime+n.value:this.sandyCityWarInfo.openTime}var s=!1;switch(t.enterType){case r.EEnterMuSceneType.CLIENT_REQUEST:this.reqFamilyExpData(),this.reqWarExpData();break;case r.EEnterMuSceneType.REVIVE:s=!0,this._limitCountDownTime=this._enterInnerCityTime=u.ServerTime.serverTime+this.getSettingData("rebornTime")}t.portid==this.getPortIdByLevel(0)?this.changeView(1,s):t.portid==this.getPortIdByLevel(1)?this.changeView(2,s):t.portid==this.getPortIdByLevel(2)&&this.changeView(3,s)}else this.gamePlay&&this.gamePlay.returnAutoplayPort();else this.gamePlay&&this.gamePlay.returnAutoplayPort(),console.log("SandCityFManager::onEnterMuSceneGS2C:"+t.error),g.FE.upItems(C.TextConst.showErrorInfo(t.error),v.BubbleEnum.center)},t.prototype.onSandyWarPhaseChangeGS2C=function(t){if(this.sandyCityWarInfo){f.BulletManager.addBroadcastById(t.horn),this.sandyCityWarInfo.battlePhase=this._battleWarState=t.newphase;var e=0;switch(t.newphase){case o.ESandyWarPhase.ATTACK_STATUE:console.log("SandCityFManager::onSandyWarPhaseChangeGS2C:攻击雕像的阶段"),e=this.getSettingData("attackStatueCDTime");break;case o.ESandyWarPhase.CAPTURE_ARENA:console.log("SandCityFManager::onSandyWarPhaseChangeGS2C:占点战的阶段");break;case o.ESandyWarPhase.SNATCH_SEAL:console.log("SandCityFManager::onSandyWarPhaseChangeGS2C:抢夺玉玺的阶段"),e=this.getSettingData("threetime")}this._limitCountDownTime=this._enterInnerCityTime=u.ServerTime.serverTime+e,this.calculateEndTime(u.ServerTime.serverTime),t.newphase==o.ESandyWarPhase.SNATCH_SEAL&&this.changeView(1,!1)}},t.prototype.onSandyKillGS2C=function(t){var e=0;this.gamePlay&&(e=this.gamePlay.getHurtTotalValue(),this.gamePlay.clearHurtValue()),i.E.ins.event(n.EventName.showWarDeath,[t.killMeUsernick,e])},t.prototype.onActivityRebirthGS2C=function(t){t.opresult?(this._limitCountDownTime=this._enterInnerCityTime=u.ServerTime.serverTime,i.E.ins.event(n.EventName.closeWarDeath),y.RoleCenter.instans.vo.GOLD-=t.decGold):(g.FE.upItems(t.error,v.BubbleEnum.center),console.error(t.error))},t.prototype.onSandyExpChangeGS2C=function(t){if(this.realTimeSandyWarExp&&this.realTimeSandyWarExp.familyRankList){for(var e=null,i=!1,n=0;n<this.realTimeSandyWarExp.familyRankList.length;n++)e=this.realTimeSandyWarExp.familyRankList[n],y.RoleCenter.instans.self.ufData.familyUId==e.familyUid&&t.familyexp>e.sandyExp&&(e.sandyExp=t.familyexp,i=!0);i&&this.onRealTimeSandyWarExp(this.realTimeSandyWarExp)}this.sandyExpChangeGS2C=t,this.shaChengCtrl&&this.shaChengCtrl.onSandyExpChangeGS2C(t)},t.prototype.onRealTimeSandyWarExp=function(t){this.realTimeSandyWarExp=t,this.realTimeSandyWarExp.familyRankList=t.familyRankList.sort(this.sortExpFun),this.shaChengCtrl&&this.shaChengCtrl.onRealTimeSandyWarExp(t)},t.prototype.sortExpFun=function(t,e){return e.sandyExp-t.sandyExp},t.prototype.onRealTimeFamilyExp=function(t){this.realTimeFamilyExp=t,this.shaChengCtrl&&this.shaChengCtrl.onRealTimeFamilyExp(t)},t.prototype.onStatueHPGS2C=function(t){this.gamePlay&&this.gamePlay.onStatueHPGS2C(t),this.shaChengCtrl&&this.shaChengCtrl.updBossBlood(t.hp)},t.prototype.onPluckSealFailGS2C=function(t){g.FE.upItems(t.error,v.BubbleEnum.center)},t.prototype.onPluckSealStartGS2C=function(t){this.noticePar2(t.hornid,t.familyname,t.nickname);var e=(this.pluckSealStartGS2C=t).startTime+this.settingOpenTime;this.gamePlay&&(this.gamePlay.startPluckSealTime(e),y.RoleCenter.instans.self.ufData&&t.familyuid!=y.RoleCenter.instans.self.ufData.familyUId&&this.gamePlay.setTop(t.username)),this.shaChengCtrl&&this.shaChengCtrl.startOpenDecree()},t.prototype.onPluckSealStopGS2C=function(t){switch(this.pluckSealStartGS2C&&this.pluckSealStartGS2C.username!=t.username&&console.error("中断开启的不是上一个人？？？？？"+this.pluckSealStartGS2C.username+" "+t.username),t.stoptype){case m.ESealStopType.MOVE:case m.ESealStopType.BEATTACK:case m.ESealStopType.OFFLINE:}t.stopUName!=t.username&&t.familyname!=t.stopFName&&this.noticePar2(t.hornid,t.stopUNick,t.nickname),this.pluckSealStartGS2C=null,this.gamePlay&&this.gamePlay.stopPluckSealTime(t.username==y.RoleCenter.instans.self.username),this.shaChengCtrl&&this.shaChengCtrl.stopOpen()},t.prototype.onDeathAdditionBuffGS2C=function(t){this.shaChengCtrl.updateBuff(t.ATT/100,t.DEF/100)},t.prototype.updateProcess=function(t){this.shaChengCtrl.updateProgress(1-t/this.settingOpenTime)},t.prototype.moveToStatus=function(){this.gamePlay&&this.gamePlay.moveToStatusPoint()},t.prototype.startFamilyBattle=function(){if(this._isLastWinnerKey=this.checkIsSameFamily(y.RoleCenter.instans.ufVo._ufdata.familyUId),console.log("SanCityFManager::startFamilyBattle:_isLastWinnerKey:"+this._isLastWinnerKey.toString()),this._key=!1,!y.RoleCenter.instans.bagRoomEnough())return E.AM.showBagNotEnough(),!1;switch(this.sandyCityWarInfo.sandyCityState){case o.ESandyCityState.CLOSE:g.FE.upItems(C.TextConst.get(430),v.BubbleEnum.center);break;case o.ESandyCityState.OPEN:if(y.RoleCenter.instans.self.ufData&&""!=y.RoleCenter.instans.self.ufData.familyUId){if(this._enterSCFTime=this.sandyCityWarInfo.lastExitDn+this.getSettingData("reentercd"),u.ServerTime.serverTime>this._enterSCFTime)return i.E.ins.event(n.EventName.PLAY_TYPE_CHANGE,s.PlayTypeVo.create(l.EPlayType.PLAYTYPE_FIGHTSC,null,!0,!0,!1)),!0;var t=this._enterSCFTime-u.ServerTime.serverTime;g.FE.upItems(C.TextConst.get(431,t),v.BubbleEnum.Left)}else g.FE.upItems(C.TextConst.get(432),v.BubbleEnum.center);break;case o.ESandyCityState.END:}return!1},t.prototype.getPortIdByLevel=function(t){return this._cityPortIdArr[t]},t.prototype.getMapByLevel=function(t){var e=this.getPortIdByLevel(t),i=c.GameConfig.getPortByID(e);return c.GameConfig.getMapJSON(i.boss_scene)},t.prototype.getMapByPort=function(t){var e=c.GameConfig.getPortByID(t);return c.GameConfig.getMapJSON(e.boss_scene)},t.prototype.checkIsHavePluckSeal=function(){return!!this.pluckSealStartGS2C},t.prototype.checkIsHaveEnterInnearCity=function(){return this._enterInnerCityTime-u.ServerTime.serverTime<0},t.prototype.checkIsHaveEnterPalace=function(){var t=this.getSettingData("enterneedscore");if(this.sandyCityWarInfo)if(this.sandyExpChangeGS2C){if(this.sandyExpChangeGS2C.innerCityExp>=t)return!0}else console.error("sandyExpChangeGS2C没数据");return!1},t.prototype.checkIsOpenSCF=function(){return!(!this.sandyCityWarInfo||this.sandyCityWarInfo.sandyCityState!=o.ESandyCityState.OPEN)},t.prototype.getBattleWarState=function(){return this._battleWarState},t.prototype.getEnterInnerCityTime=function(){return this._enterInnerCityTime},t.prototype.getLimitCountDownTime=function(){return this._limitCountDownTime},t.prototype.getCurrStateEndTime=function(){return this._endWarStateTime},t.prototype.getLastFamilyUID=function(){var t=this.sandyCityWarInfo,e=t?t.lastSandyRank:null;return e?e.santoFamilyUid:""},t.prototype.checkIsSameFamily=function(t){return t==this.getLastFamilyUID()},t.prototype.getIsLastWinnerKey=function(){return this._isLastWinnerKey},t.prototype.calculateEndTime=function(t){var e=0;switch(this._battleWarState){case o.ESandyWarPhase.ATTACK_STATUE:e=this._settingPersist1Time;break;case o.ESandyWarPhase.CAPTURE_ARENA:e=this._settingPersist2Time;break;case o.ESandyWarPhase.SNATCH_SEAL:e=this._settingPersist3Time}this._endWarStateTime=t+e},t.prototype.isLastWinnerKey=function(){return this._isLastWinnerKey},t.prototype.isHaveLastWinnerKey=function(){return""!=this.getLastFamilyUID()},t.prototype.pluckSealHandler=function(){if(this.gamePlay){if(!this.checkIsHavePluckSeal())return this.gamePlay.pluckSeal(),!0;this.outInfo(this.pluckSealStartGS2C.nickname)}return!1},t.prototype.qiangduoDecree=function(){return!(!this.pluckSealStartGS2C||!this.pluckSealStartGS2C.username)&&(i.E.ins.event(n.EventName.SELECT_PK_TARGET,this.pluckSealStartGS2C.username),this.gamePlay.changeBattleState(6),!0)},t.prototype.attackStatueHander=function(){return!!this.gamePlay&&this.gamePlay.startKillMonster()},t.prototype.guardStatueHander=function(){this.gamePlay&&this.gamePlay.changeBattleState(1)},t.prototype.attackAllTarget=function(){this.gamePlay&&this.gamePlay.changeBattleState(2)},t.prototype.resetUIState=function(){this.shaChengCtrl&&this.shaChengCtrl.clearSelectedButton()},t.prototype.moveToInnerCity=function(){var t=!1;return this.gamePlay&&(this.checkIsHaveEnterInnearCity()?(this.gamePlay.moveToNextTransPoint(),t=!0):g.FE.upItems(C.TextConst.SCF_ENTER_INNERCITY,v.BubbleEnum.center)),t},t.prototype.moveToPalace=function(){var t=!1;switch(this._battleWarState){case o.ESandyWarPhase.SNATCH_SEAL:this.checkIsHaveEnterPalace()?this.gamePlay&&(this.gamePlay.moveToNextTransPoint(),t=!0):g.FE.upItems(C.TextConst.SCF_ENTER_PALACE,v.BubbleEnum.center)}return t},t.prototype.changeView=function(t,e){void 0===e&&(e=!1),this.shaChengCtrl&&this.shaChengCtrl.showView(this._battleWarState,t,this._isLastWinnerKey,this._endWarStateTime,e)},t.prototype.relifeByMoney=function(){var t=this.getSettingData("clearCdCost");if(y.RoleCenter.instans.vo.GOLD>=t){var e=new _.ActivityRebirthC2GS;e.acttype=_.EACT_TYPE.sandywar,a.GSM.sendServer(e)}else d.Switches.ins.event(155)},t.prototype.noticePar1=function(t,e){if(0!=t){var i=I.ItemUtils.getNoticeById(t);i&&f.BulletManager.addBroadcast(1,C.TextConst.replace(i.text,e),!0,!1,i.addtext)}},t.prototype.noticePar2=function(t,e,i){if(0!=t){var n=I.ItemUtils.getNoticeById(t);n&&f.BulletManager.addBroadcast(1,C.TextConst.replace(n.text,e,i),!0,!1,n.addtext)}},t.prototype.getSettingData=function(t){return c.GameConfig.sandyCitySettingJson[t].value},t.prototype.getRewardItem=function(t,e){void 0===e&&(e=-1);var i=[];for(var n in c.GameConfig.sandyCityRankJson)c.GameConfig.sandyCityRankJson[n].type==t&&i.push(c.GameConfig.sandyCityRankJson[n]);return 0<e&&e<i.length?i[e]:null},t.prototype.getReardItemListByType=function(t){var e=[];for(var i in c.GameConfig.sandyCityRankJson)c.GameConfig.sandyCityRankJson[i].type==t&&e.push(c.GameConfig.sandyCityRankJson[i]);return e},t.prototype.playAnimation=function(){this.gamePlay&&this.gamePlay.startBoom()},t.prototype.sandyWarOpenDay=function(){console.log("今天有公会战"),this.isTodayOpen=!0,i.E.ins.event(n.EventName.SC_WAR_TODAY_OPEN)},t.prototype.onHDValueChanged=function(t){this.shaChengCtrl&&this.shaChengCtrl.onHDValueChanged(t.shieldHp),console.log("沙城战护盾值变化了"+t.shieldHp)},t.prototype.onGetScoreBonusGS2C=function(t){t.opres?(y.RoleCenter.instans.addInventoryToC(t.invent),g.FE.addInventoryToCFloats(t.invent),this.shaChengCtrl&&this.shaChengCtrl.onGetRewardSuc()):console.error(t.error)},t._instance=null,t}();e.SandCityFManager=A,(T=e.sandyCityState||(e.sandyCityState={}))[T.SC_NULL=0]="SC_NULL",T[T.SC_OUT_CITY=1]="SC_OUT_CITY",T[T.SC_INNEAR_CITY=2]="SC_INNEAR_CITY",T[T.SC_PALACE=3]="SC_PALACE"}),define("src/g/fight/osprite/obj/MobaiBtn",["require","exports","src/g/fight/osprite/obj/BaseSprite","../../../../manager/LayerManager","../../../../manager/RoleCenter","../../../../enum/EventName","../../../../core/E","src/g/fight/osprite/SceneObjManager","src/g/fight/osprite/play/family/SandCityFManager"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this._btn=new Laya.Image("res/society/attackCity/shacheng_mobai.png"),this._btn.pivotX=this._btn.width/2,this._btn.pivotY=this._btn.height/2,this.setWorldXY(54,35),n.LayerManager.fightLayer.shadowLayer.addChild(this._btn),this.updateBtnVisible(),a.E.ins.on(o.EventName.SOCIETY_LEAVE,this,this.updateBtnVisible),a.E.ins.on(o.EventName.SOCIETY_JOIN,this,this.updateBtnVisible),this._btn.on(Laya.Event.CLICK,this,this.onBtnClickHandler),r.SceneObjManager.instans.regObject(this)},e.prototype.updateBtnVisible=function(){s.RoleCenter.instans.ufVo&&s.RoleCenter.instans.ufVo._ufdata&&s.RoleCenter.instans.ufVo.inFamily?this._btn.visible=!0:this._btn.visible=!1},e.prototype.clear=function(){n.LayerManager.fightLayer.shadowLayer.removeChild(this._btn),a.E.ins.off(o.EventName.SOCIETY_LEAVE,this,this.updateBtnVisible),a.E.ins.off(o.EventName.SOCIETY_JOIN,this,this.updateBtnVisible),this._btn.off(Laya.Event.CLICK,this,this.onBtnClickHandler),this._btn.destroy(),r.SceneObjManager.instans.unregObject(this),this._btn=null},e.prototype.onBtnClickHandler=function(){l.SandCityFManager.getInstance().reqSandCityData()},e.prototype.frameMove=function(t){this.updatePoint(),this._btn.x=this.gridX,this._btn.y=this.gridY},e}(i.BaseSprite);e.MobaiBtn=h}),define("src/g/fight/osprite/obj/IMainCityElement",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),define("src/g/fight/osprite/obj/TitleShowObj",["require","exports","src/g/fight/osprite/obj/BaseSprite","../../../../manager/LayerManager","../../../../component/GAnimation"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=laya.ui.Label,a=function(e){function t(){var t=e.call(this)||this;return t.space=5,t._titleScale=1,t.titleImg=new s.GAnimation,t.titleImg.interval=150,t.roleNameLab=new o,t.roleNameLab.color="#09d51f",t.roleNameLab.font="SimHei",t.roleNameLab.fontSize=20,t.roleNameLab.strokeColor="#000000",t.roleNameLab.stroke=2,t.famliyNameLab=new o,t.famliyNameLab.color="#016ff9",t.famliyNameLab.font="SimHei",t.famliyNameLab.fontSize=20,t.famliyNameLab.strokeColor="#000000",t.famliyNameLab.stroke=2,t}return __extends(t,e),Object.defineProperty(t.prototype,"titleSkin",{set:function(t){this.titleImg.load(t,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"roleName",{set:function(t){this.roleNameLab.text=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"famliyName",{set:function(t){this.famliyNameLab.text=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"titleScale",{set:function(t){this._titleScale=t},enumerable:!0,configurable:!0}),t.prototype.addToMap=function(){n.LayerManager.fightLayer.nameLayer.addChild(this.titleImg),n.LayerManager.fightLayer.nameLayer.addChild(this.roleNameLab),n.LayerManager.fightLayer.nameLayer.addChild(this.famliyNameLab)},t.prototype.removeFromMap=function(){n.LayerManager.fightLayer.nameLayer.removeChild(this.titleImg),n.LayerManager.fightLayer.nameLayer.removeChild(this.roleNameLab),n.LayerManager.fightLayer.nameLayer.removeChild(this.famliyNameLab)},t.prototype.frameMove=function(t){this.updatePoint();var e=this.gridY;this.roleNameLab.text&&(this.roleNameLab.x=this.gridX-this.roleNameLab.width/2,this.roleNameLab.y=e-this.roleNameLab.height,e=this.roleNameLab.y-this.space),this.famliyNameLab.text&&(this.famliyNameLab.x=this.gridX-this.famliyNameLab.width/2,this.famliyNameLab.y=e-this.famliyNameLab.height,e=this.famliyNameLab.y-this.space),this.titleImg&&(this.titleImg.scale(this._titleScale,this._titleScale),this.titleImg.x=this.gridX,this.titleImg.y=e-40,e=this.titleImg.y-this.space)},t}(i.BaseSprite);e.TitleShowObj=a}),define("src/g/fight/osprite/obj/NumOneTitleShow",["require","exports","src/g/fight/osprite/obj/TitleShowObj","../../../../core/GNet","../../../../manager/GameSocketManager","../../../net/messages/rank/RankDataGS2C","src/g/fight/osprite/SceneObjManager","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../config/GameConfig"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.rankDataArr=[],t}return __extends(t,e),t.prototype.activate=function(t){var e=(this._vo=t).param[1];this.requestRankData(),n.GNet.getRankList(e,1,1)},t.prototype.deactivate=function(){this.removedHandler(),this.roleName=null,this.famliyName=null,this.titleScale=1,this.titleSkin=null,this.removeFromMap(),a.SceneObjManager.instans.unregObject(this)},t.prototype.removedHandler=function(){s.GSM.ins.off(o.RankDataGS2C.KEY,this,this.resultHandler),r.E.ins.off(l.EventName.OTHERDATA_UPDATE,this,this.otherDataHandler)},t.prototype.requestRankData=function(){s.GSM.ins.on(o.RankDataGS2C.KEY,this,this.resultHandler),r.E.ins.on(l.EventName.OTHERDATA_UPDATE,this,this.otherDataHandler)},t.prototype.resultHandler=function(t){if(t.opresult){var e=this._vo.param[1];if(t.rankIdArr[0]==e)this.rankDataArr=t.rankDataArr,0<Math.min(this.rankDataArr.length,1)?(this._waitUserName=this.rankDataArr[0].username,n.GNet.getOtherData([this._waitUserName])):this.removedHandler()}},t.prototype.otherDataHandler=function(){this._heroData=h.RoleCenter.instans.getOtherData(this._waitUserName),this.updateRankShow()},t.prototype.updateRankShow=function(){if(this.removedHandler(),this._heroData){this.roleName=this._heroData.nickname,this.famliyName="undefined"==this._heroData.familyName?null:this._heroData.familyName,this.titleScale=this._vo.scale;var t=this._vo.param[0],e=c.GameConfig.titleJSON[t];this.titleSkin="dynamic2/chenghao/"+e.icon+".json",this.setMapXY(this._vo.pos[0],this._vo.pos[1]),this.addToMap(),a.SceneObjManager.instans.regObject(this)}},t}(i.TitleShowObj);e.NumOneTitleShow=u}),define("src/g/fight/osprite/obj/CityMasterTitleShow",["require","exports","src/g/fight/osprite/obj/TitleShowObj"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.activate=function(t){},e.prototype.deactivate=function(){},e}(i.TitleShowObj);e.CityMasterTitleShow=n}),define("src/g/fight/osprite/obj/MainCityElementFactory",["require","exports","../../../../config/GameConfig","src/g/fight/osprite/obj/NumOneTitleShow","src/g/fight/osprite/obj/CityMasterTitleShow"],function(t,e,n,i,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){}return t.createEles=function(){for(var t in this._eleList=[],n.GameConfig.mainCityElesJson){var e=n.GameConfig.mainCityElesJson[t],i=this.getEleByType(e.type);i&&(i.activate(e),this._eleList.push(i))}},t.clearAllEles=function(){if(this._eleList){for(var t in this._eleList){var e=this._eleList[t];e&&e.deactivate()}this._eleList.length=0}},t.getEleByType=function(t){switch(t){case 1:return new s.CityMasterTitleShow;case 2:return new i.NumOneTitleShow}return null},t}();e.MainCityElementFactory=o}),define("src/g/friend/ctrl/FriendsDataManager",["require","exports","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../net/messages/friend/FriendMsg","../../../manager/NewRedHintsCenter","../../../utils/sbkFuckWord"],function(t,e,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function n(){this._allFriendData={},this._chatContents={},this._chatReds={}}return Object.defineProperty(n,"ins",{get:function(){return n._ins||(n._ins=new n),this._ins},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isInited",{get:function(){return this._isInit},enumerable:!0,configurable:!0}),n.prototype.initDataHandler=function(){this._friendsGroup=new c(r.enumFrdType.friend|r.enumFrdType.friendDouble),this._privateChatGroup=new c(r.enumFrdType.chat),this._requestGroup=new c(r.enumFrdType.apply),this._blackListGroup=new c(r.enumFrdType.black);var t=a.RoleCenter.instans.vo.friendsData.list;if(t)for(var e=t.length,i=0;i<e;)this.updateFriendsData(t[i]),i++;this._isInit=!0,s.E.ins.event(o.EventName.FRIENDS_DATA_INITED)},n.prototype.updateFriendsData=function(t){var e=this._allFriendData[t.username];e?(e.copydata(t),this.isInited&&s.E.ins.event(o.EventName.FRIENDS_DATA_UPDATED,e.username)):this._allFriendData[t.username]=t,this.checkData(t)},n.prototype.userInMyList=function(t,e){void 0===e&&(e=r.enumFrdType.black);var i=this._allFriendData[t];return!(!i||!n.belongTo(i,e))},n.prototype.checkData=function(t){this._friendsGroup.check(t),this._privateChatGroup.check(t),this._requestGroup.check(t),this._blackListGroup.check(t)},n.prototype.getFriendDataByUsername=function(t){return this._allFriendData[t]},n.prototype.getListByRelation=function(t){return this._friendsGroup.belongTo(t)?this._friendsGroup.getList():this._privateChatGroup.belongTo(t)?this._privateChatGroup.getList():this._requestGroup.belongTo(t)?this._requestGroup.getList():this._blackListGroup.belongTo(t)?this._blackListGroup.getList():null},n.belongTo=function(t,e){return 0<(t.relation&e)},n.prototype.addChatContent=function(t,e){var i=this._chatContents[e];i||(i=[],this._chatContents[e]=i),h.sbkFuckWord.checkFuckWord(t.msg)&&(t.msg=h.sbkFuckWord.replaceFuckWord(t.msg)),i.push(t),this._chatReds[e]=1,s.E.ins.event(o.EventName.PRIVATE_CHAT_STATE_CHANGED,e),l.NewRedHintsCenter.ins.setRedHintOpenOrClose(l.enumRedHints.friends_chat,!0),s.E.ins.event(o.EventName.ADD_PRIVATE_CHAT_CONTENT,t)},n.prototype.cutChatContent=function(e){for(var t in this._chatContents)this._chatContents[t].forEach(function(t){-1!=t.msg.indexOf(e)&&(t.msg=t.msg.replace(e,""))})},n.prototype.getChatState=function(t){return this._chatReds[t]?1:0},n.prototype.setChatReaded=function(t){delete this._chatReds[t],s.E.ins.event(o.EventName.PRIVATE_CHAT_STATE_CHANGED,t);var e=0;for(var i in this._chatReds)0<this._chatReds[i]&&e++;0==e&&l.NewRedHintsCenter.ins.setRedHintOpenOrClose(l.enumRedHints.friends_chat,!1)},n.prototype.getChatList=function(t){return this._chatContents[t]},n}();e.FriendsDataManager=n;var c=function(){function t(t){this._recoardList=[],this._relation=t}return t.prototype.check=function(t){var e=n.ins.isInited,i=this._recoardList.indexOf(t.username);this.belongTo(t.relation)?-1==i&&(this._recoardList.push(t.username),e&&this.belongTo(r.enumFrdType.friend|r.enumFrdType.friendDouble)&&l.NewRedHintsCenter.ins.setRedHintOpenOrClose(l.enumRedHints.friends_friend,!0),this.belongTo(r.enumFrdType.apply)&&l.NewRedHintsCenter.ins.setRedHintOpenOrClose(l.enumRedHints.friends_request,!0),e&&s.E.ins.event(o.EventName.FRIENDS_RELATION_GROUP_UPDATED,this._relation)):-1!=i&&(this._recoardList.splice(i,1),e&&s.E.ins.event(o.EventName.FRIENDS_RELATION_GROUP_UPDATED,this._relation))},t.prototype.getList=function(){return this._recoardList},t.prototype.belongTo=function(t){return 0<(t&this._relation)},t}();e.FriendsRelationGroup=c}),define("src/g/fight/osprite/play/GamePlayMainCity",["require","exports","../../../../enum/EventName","../../../../core/E","src/g/fight/osprite/SceneObjCtroller","src/g/fight/osprite/map/MapCovert","../../../../enum/Task","src/g/fight/osprite/NetCtroller","../../../../manager/TaskManager","src/g/fight/osprite/obj/FightGroup","../../../../manager/RoleCenter","../../../../manager/LayerManager","src/g/fight/osprite/play/RealTimeScene","src/g/fight/osprite/obj/MainCityElementFactory","../../../net/messages/ChangeSceneMsg","src/g/fight/osprite/play/MainCityManager","src/g/index/ctrl/BtnSkiilCtrl","../../../../manager/AM","src/g/index/view/BattleModeShow","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../utils/DiyMatrix","src/g/clearRes/ClearResM","../../../net/messages/friend/FriendData","src/g/friend/ctrl/FriendsDataManager","src/init/TextConst"],function(t,e,o,a,n,r,i,l,h,c,u,p,s,d,g,v,f,y,m,_,C,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var T=function(s){function t(t,e){var i=s.call(this,t)||this;return i._npcArray=[],i._nvPortId=0,i._diyMatrix=new I.DiyMatrix,i._targetNpc=null,i._datacaller=e,a.E.ins.on(o.EventName.TASK_CHANGE,i,i.onTaskUpdate),a.E.ins.on(o.EventName.SELECT_PK_TARGET,i,i.onSelectPkTarget),i.enablePK(!0),i}return __extends(t,s),t.prototype.clear=function(){s.prototype.clear.call(this),f.BtnSkiilCtrl.ins.setSkillBtnVisible(!0),a.E.ins.event(o.EventName.ENTER_PLAYTYPE_MAINCITY,!0),a.E.ins.off(o.EventName.TASK_CHANGE,this,this.onTaskUpdate),a.E.ins.off(o.EventName.SELECT_PK_TARGET,this,this.onSelectPkTarget),p.LayerManager.fightLayer.removeAllUnit(),p.LayerManager.fightLayer.removeAllItem(),this._mainRole&&this._mainRole.setTargetSelEff(null),this.npcs=null;for(var t=0;t<this._npcArray.length;t++)this._npcArray[t]&&this._npcArray[t].destroyUnit();this._npcArray=[],d.MainCityElementFactory.clearAllEles(),v.MainCityManager.getInstance().exitGamePlay(),b.ClearResM.clearFolderByUrl("dynamic/tasknpc"),b.ClearResM.clearFolderByUrl("dynamic2/chenghao/")},t.prototype.onSelectPkTarget=function(t){if(t!=u.RoleCenter.instans.self.username){var e=this.getPlayerFG(t);if(e){var i=e.getMainRole();if(i&&""!=e.groupID&&null!=e.groupID&&this.isInSafeArea(i.mapX,i.mapY)){var n=S.FriendsDataManager.ins.getFriendDataByUsername(e.groupID);n||((n=new w.FriendData).username=e.groupID,n.nickname=e.getNickName(),n.sex=e.getSex(),n.jobid=e.getJob(),n.onLine=!0,n.level=0),a.E.ins.event(o.EventName.OPEN_FRIENDS_MENU_DIALOG,n)}}}this.pkStartAndTestDistance(t)},t.prototype.getNPCFromId=function(t){for(var e=0;e<this._npcArray.length;e++)if(this._npcArray[e].id==t)return this._npcArray[e];return null},t.prototype.init=function(t){void 0===t&&(t=null),s.prototype.init.call(this,t),a.E.ins.event(o.EventName.ENTER_PLAYTYPE_MAINCITY,!1),a.E.ins.event(o.EventName.OFF_AUTO_FIGHT),this.npcs=r.MapCovert.parseToNumber(t.npc_id),this.mapVo.monXY=r.MapCovert.parseBySemicolon(t.monstor_bornplace),this.mapVo.npcXY=r.MapCovert.parseBySemicolon(t.npc_bornplace),this.mapVo.taskXY=r.MapCovert.parseBySemicolon(t.task_place),this._nvPortId=u.RoleCenter.instans.self.portstatus.portindex;var e=0;for(e=0;e<this.npcs.length;e++)if(this.npcs[e]){var i=this._npcArray[e]=n.SceneObjCtroller.ins.createNPC(this.npcs[e],this.mapVo.npcXY[e],this.mapVo.taskXY[e],e+1);p.LayerManager.fightLayer.addUnit(i)}n.SceneObjCtroller.ins.self.ability.clearDelayAttack(),d.MainCityElementFactory.createEles(),this.initSafeArea(),v.MainCityManager.getInstance().enterGamePlay(this,this.scene.port.id),f.BtnSkiilCtrl.ins.setSkillBtnVisible(!1)},t.prototype.allInit=function(){s.prototype.allInit.call(this);var t=this._datacaller;t&&t.npcid&&this.gotoNpcById(t.npcid)},t.prototype.initSafeArea=function(){this.initSafeMatrix(),this.drawSafeArea(this.mapVo.doorXY[0],this.mapVo.doorXY[1],this.mapVo.doorXY[2])},t.prototype.initSafeMatrix=function(){this._diyMatrix.initInvertMatrix(this.mapVo.doorXY[0],this.mapVo.doorXY[1],this.mapVo.doorXY[2])},t.prototype.isInSafeArea=function(t,e){return s.prototype.isInSafeArea.call(this,t,e),this._diyMatrix.intCoordinate(t,e)},t.prototype.getReLifeLocation=function(t){var e=this.mapVo.doorXY[0][0],i=this.mapVo.doorXY[0][1],n=this.mapVo.doorXY[1][0]-e,s=this.mapVo.doorXY[1][1]-i,o=this.mapVo.doorXY[2][0]-e,a=this.mapVo.doorXY[2][1]-i,r=Math.random(),l=Math.random();return[r*n+l*o+e,r*s+l*a+i]},t.prototype.checkSafeAreaLimit=function(t){var e=this.getPlayerFG(t);return!(!e||!e.getMainRole())&&!this.isInSafeArea(e.getMainRole().mapX,e.getMainRole().mapY)},t.prototype.checkModeLimit=function(){return!m.BattleModeShow.isPeace||(_.FE.upItems(E.TextConst.get(435),C.BubbleEnum.center),!1)},t.prototype.specialTaskInit=function(){h.TaskManager.ins.currentTask&&h.TaskManager.ins.currentTask.type==i.TaskType.IntoAutoCopy&&a.E.ins.event(o.EventName.TASK_CHANGE)},t.prototype.getLastPosFromTask=function(t){var e=this.scene.mapVo.startPoint,i=h.TaskManager.ins.getPrevTaskNpc(t);return 0==i?e[0]:this.getNPCFromId(i).findNode},t.prototype.fightEnd=function(t){void 0===t&&(t=!0),l.NetCtroller.fightEndC2GS(this._nvPortId,this.scene.fightid,t),this.fightGroup&&this.fightGroup.setFGTarget(null)},t.prototype.onReceiveFightEnd=function(t){t.moneyconvert=1,s.prototype.onReceiveFightEnd.call(this,t),this.effectExpAndMoney(this._fightReward),this._fightReward=null},t.prototype.onTaskUpdate=function(){if(s.prototype.onTaskUpdate.call(this),this.task&&(u.RoleCenter.instans.self.taskdata.taskid=this.task.id,0!=h.TaskManager.ins.active&&!(1900<=this.task.id&&this.type!=g.EPlayType.PLAYTYPE_MAINCITY)))switch(this.task.type){case i.TaskType.KillMonsters:break;case i.TaskType.Dialogue:this.talkingToNpc(this.task.npcId)}},t.prototype.talkingToNpc=function(t){this.fightGroup.setNPCTarget(this.getNPCFromId(t))},t.prototype.frameMove=function(){s.prototype.frameMove.call(this)},t.prototype.showDeadAlert=function(t,e){s.prototype.showDeadAlert.call(this,t,e),y.AM.alertTip(E.TextConst.get(436),Laya.Handler.create(this,this.muSceneUserReviveC2GS,[t]))},t.prototype.npcVisible=function(t){s.prototype.npcVisible.call(this,t);for(var e=0;e<this._npcArray.length;e++)this._npcArray[e].limitDraw(!t,this._unitAllHideKey)},t.prototype.onMoveEnd=function(t){s.prototype.onMoveEnd.call(this,t);var e=Math.floor(t/c.FightGroup.HERO_MAXNUM),i=t%c.FightGroup.HERO_MAXNUM;if(this._mainRole&&e==this.fightGroup.uId&&i==this._mainRole.index){var n=u.RoleCenter.instans.vo.portstatus;n.posX=~~this._mainRole.mapX,n.posY=~~this._mainRole.mapY,this.checkNpcPanel()}},t.prototype.checkNpcPanel=function(){this._targetNpc&&this._targetNpc.data&&(this.checkIsClose(this._targetNpc.mapX,this._targetNpc.mapY)?a.E.ins.event(o.EventName.OPEN_NPC_PANEL,[this._targetNpc.data.moduleID,this._targetNpc.id]):console.log("没到NPC点，就因为外部原因中断"),this._targetNpc=null)},t.prototype.checkIsClose=function(t,e){if(this._mainRole){var i=Laya.Point.TEMP;if(i.setTo(this._mainRole.mapX,this._mainRole.mapY),i.distance(t,e)<100)return!0}return!1},t.prototype.gotoToPoint=function(t,e,i){this.followTargetPos(t,e,i)},t.prototype.gotoNpcById=function(t){var e=this.getNPCFromId(t);e&&this.gotoToNpc(e)},t.prototype.gotoToNpc=function(t){this._targetNpc=t,this.followTargetPos(t.mapX,t.mapY,60)||this.checkNpcPanel()},t.TARGETSEL_EFFECT="dynamic2/uieffect/EUI1_28.json",t}(s.RealTimeScene);e.GamePlayMainCity=T}),define("src/g/fight/osprite/play/MainCityManager",["require","exports","../../../../manager/GameSocketManager","../../../net/messages/EnterMuSceneC2GS","../../../../core/E","../../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../net/messages/ChangeSceneMsg","../../../../config/GameConfig","../../../../utils/system/ServerTime","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../manager/AM","src/g/fight/osprite/map/MapConst","../../../../utils/ItemUtils","../../../../manager/RoleCenter","src/init/TextConst"],function(t,e,r,l,i,n,s,o,h,a,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(){function t(){this._currPortId=-1,this._enterTime=-1,this.enterMuSceneGS2C=null,this.gamePlay=null,this._lastSafeKey=!1}return t.getInstance=function(){return t._instance?t._instance:t._instance=new t},t.prototype.ChangeToMainCity=function(t){if(void 0===t&&(t=null),this._enterTime>a.ServerTime.serverTime){var e=this._enterTime-a.ServerTime.serverTime;return c.FE.upItems(f.TextConst.get(461,e),u.BubbleEnum.Left),void Laya.timer.once(1e3,this,function(){t={portid:100},i.E.ins.event(n.EventName.PLAY_TYPE_CHANGE,s.PlayTypeVo.create(o.EPlayType.PLAYTYPE_MAINCITY,t))})}t||(t={portid:100}),i.E.ins.event(n.EventName.PLAY_TYPE_CHANGE,s.PlayTypeVo.create(o.EPlayType.PLAYTYPE_MAINCITY,t))},t.prototype.ExitMainCity=function(){var t=0,e=h.GameConfig.commonJson.cityCD;e&&(t=parseFloat(e.value)),t<=1?this.onOkExitMainCity():p.AM.show(f.TextConst.get(462,t),Laya.Handler.create(this,this.onOkExitMainCity))},t.prototype.onOkExitMainCity=function(){this.gamePlay&&this.gamePlay.sendEnterMuSceneC2GS(!1,this._currPortId,0,0)},t.prototype.enterGamePlay=function(t,e){this.gamePlay=t,r.GSM.ins.on(l.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C),this._currPortId=e;var i=g.ItemUtils.getPortVoById(e),n=0,s=0,o=v.RoleCenter.instans.vo.portstatus;if(o.inMainCity&&o.posX&o.posY)n=o.posX,s=o.posY;else if(i){var a=h.GameConfig.getMapJSON(i.boss_scene);a&&(n=Math.floor((a.startPoint[1][0]+.5)*d.MapConst.MAP_TILED_W),s=Math.floor((a.startPoint[1][1]+.5)*d.MapConst.MAP_TILED_W))}this.gamePlay.sendEnterMuSceneC2GS(!0,e,n,s)},t.prototype.onEnterMuSceneGS2C=function(t){if(t.opresult)if(t.enter){this.enterMuSceneGS2C=t,this.gamePlay&&(this.checkIsSafe(t.posx,t.posy),this.gamePlay.setMainRoleByMsg(t));var e=v.RoleCenter.instans.vo.portstatus;e.inMainCity=!0,e.posX=t.posx,e.posY=t.posy}else t.enterType==l.EEnterMuSceneType.CLIENT_REQUEST&&this.gamePlay&&i.E.ins.event(n.EventName.PLAY_TYPE_CHANGE,s.PlayTypeVo.create(o.EPlayType.PLAYTYPE_PORT));else this.gamePlay&&i.E.ins.event(n.EventName.PLAY_TYPE_CHANGE,s.PlayTypeVo.create(o.EPlayType.PLAYTYPE_PORT)),console.log("MainCityManager::onEnterMuSceneGS2C:"+f.TextConst.showErrorInfo(t.error))},t.prototype.exitGamePlay=function(){this.gamePlay=null,r.GSM.ins.off(l.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C);var t=h.GameConfig.commonJson.cityCD;this._enterTime=a.ServerTime.serverTime+parseFloat(t.value)},t.prototype.checkIsSafe=function(t,e){if(this.gamePlay){var i=this.gamePlay.isInSafeArea(t,e);if(this._lastSafeKey!=i){var n=(this._lastSafeKey=i)?[f.TextConst.get(448),"#00ff00"]:[f.TextConst.get(449),"#ff0000"];c.FE.getFloatTxt(n[0],n[1])}}},t.prototype.gotoToPoint=function(t,e,i){this.gamePlay&&this.gamePlay.gotoToPoint(t,e,i)},t.prototype.gotoNpcById=function(t){this.gamePlay&&this.gamePlay.gotoNpcById(t)},t.prototype.gotoToNpc=function(t){this.gamePlay&&this.gamePlay.gotoToNpc(t)},t._instance=null,t}();e.MainCityManager=y}),define("src/g/fight/osprite/play/hangupexp/GamePlayHangUpExp",["require","exports","src/g/fight/osprite/play/RealTimeScene","../../../../../config/GameConfig","../../../../../utils/ItemUtils","src/g/fight/osprite/play/HangUpExpManager","src/g/fight/osprite/obj/FightGroup","../../../../../manager/AM","../../../../../core/E","../../../../../enum/EventName","../../../../../utils/system/FloatEffect","../../../../../plugin/view/ToolTip","../../../../net/messages/PassionPointMsg","../../../../../manager/GameSocketManager","../../../../../manager/LayerManager","../../../../net/messages/ActivityMessage","../../../../../manager/RoleCenter","../../../../../utils/system/ServerTime","src/init/TextConst"],function(t,e,i,a,r,l,n,s,h,c,u,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(o){function t(t){var e=o.call(this,t)||this;e._pointSettingVo=null,e._currTargetFG=null,e._currAreaIndex=-1,e._showDebugKey=!1,e._attackTargetName=null,e._autoAttackTargetKey=!1,e._autoCapturePointKey=!1,e.delayHideNameList=[],e.delayHideTimeList=[],h.E.ins.on(c.EventName.SELECT_PK_TARGET,e,e.onSelectPkTarget),h.E.ins.on(c.EventName.EXIT_BOSS_PLAYTYPE,e,e.onExitHandler),h.E.ins.on(c.EventName.UNIT_MOVE_END,e,e.onMoveEndSC);var i=g.GSM.ins;i.on(d.CapturePointAreaGS2C.KEY,e,e.onCapturePointAreaGS2C),i.on(d.PassionPointSceneInfoGS2C.KEY,e,e.onPassionPointSceneInfoGS2C),i.on(d.PassionPointAwardGS2C.KEY,e,e.onPassionPointAwardGS2C),i.on(f.ActivityRebirthGS2C.KEY,e,e.onActivityRebirthGS2C),e._pointSettingVo=a.GameConfig.pointSettingVo[1];var n=r.ItemUtils.getPortVoById(e._pointSettingVo.port),s=a.GameConfig.getMapJSON(n.boss_scene).doorXY;return 2<s.length&&e.drawSafeArea(s[0],s[1],s[2],2),e.createAreaMatrixList(e._pointSettingVo.port,-1,e._showDebugKey),e.enablePK(!1),e._unitAllHideKey=!0,e._autoFllowKey=!1,e.otherPlayerVisible(!1),e}return __extends(t,o),t.prototype.clear=function(){o.prototype.clear.call(this),h.E.ins.off(c.EventName.SELECT_PK_TARGET,this,this.onSelectPkTarget),h.E.ins.off(c.EventName.EXIT_BOSS_PLAYTYPE,this,this.onExitHandler),h.E.ins.off(c.EventName.UNIT_MOVE_END,this,this.onMoveEndSC);var t=g.GSM.ins;t.off(d.CapturePointAreaGS2C.KEY,this,this.onCapturePointAreaGS2C),t.off(d.PassionPointSceneInfoGS2C.KEY,this,this.onPassionPointSceneInfoGS2C),t.off(d.PassionPointAwardGS2C.KEY,this,this.onPassionPointAwardGS2C),t.off(f.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),l.HangUpExpManager.getInstance().exitGamePlay(),v.LayerManager.fightLayer.removeAllItem()},t.prototype.init=function(t){o.prototype.init.call(this,t),l.HangUpExpManager.getInstance().enterGamePlay(this,this._pointSettingVo.port)},t.prototype.isInSafeArea=function(t,e){return 0<this.matrixList.length&&this.matrixList[0].intCoordinate(t,e)},t.prototype.onSelectPkTarget=function(t){this.pkStartAndTestDistance(t)},t.prototype.pkStartAndTestDistance=function(t,e){void 0===e&&(e=!1),this._autoAttackTargetKey&&(this._autoAttackTargetKey=!1),o.prototype.pkStartAndTestDistance.call(this,t,e)},t.prototype.capturePointArea=function(t){this.clearTarget();var e=this.matrixList[t.id-1];if(e){var i=this.getCoordinatePos(e);this.followTargetPos(i[0],i[1],0),this._autoAttackTargetKey=!0}},t.prototype.sendCapturePoint=function(t){var e=new d.CapturePointAreaC2GS;e.areaId=t,g.GSM.sendServer(e)},t.prototype.onMoveEndSC=function(t){console.log("GamePlayHangUpExp::onMoveEndSC:"+t);var e=Math.floor(t/n.FightGroup.HERO_MAXNUM),i=t%n.FightGroup.HERO_MAXNUM;this._mainRole&&e==this.fightGroup.uId&&i==this._mainRole.index&&(l.HangUpExpManager.getInstance().clearSelectedArea(),this._autoAttackTargetKey?(this._autoAttackTargetKey=!1,this.updateTarget(!0,0)):this._targetName&&this.pkStartAndTestDistance(this._targetName,!0))},t.prototype.onPKStartMUSGS2C=function(t){o.prototype.onPKStartMUSGS2C.call(this,t);var e=y.RoleCenter.instans.self.username;t.pksrc==e&&this._playerDic[t.pktarget],t.pktarget==e&&this._playerDic[t.pksrc]},t.prototype.addRevengeList=function(t){if(o.prototype.addRevengeList.call(this,t)){t.limitDraw(!1,this._unitAllHideKey);var e=this.delayHideNameList.indexOf(t.groupID);return-1<e&&(this.delayHideNameList.splice(e,1),this.delayHideTimeList.splice(e,1)),!0}return!1},t.prototype.removeRevengeList=function(t){if(o.prototype.removeRevengeList.call(this,t)){var e=this.delayHideNameList.indexOf(t.groupID);return-1==e?(this.delayHideNameList.push(t.groupID),this.delayHideTimeList.push(m.ServerTime.serverTime+5)):this.delayHideTimeList[e]=m.ServerTime.serverTime+5,!0}return!1},t.prototype.frameMove=function(){o.prototype.frameMove.call(this),this._currTargetFG&&this._currTargetFG.isDeath()&&(this._currTargetFG=null),this._mainRole&&null==this._currTargetFG&&(2!=this._mainRole.action?this._currTargetFG=this.getFreeRevengeTarget():this._currTargetFG=null,this._currTargetFG&&this.pkStartAndTestDistance(this._currTargetFG.groupID,!0)),this._mainRole&&2==this._mainRole.action&&this.updateTarget(!1,0),this._autoCapturePointKey&&(this._autoCapturePointKey=!1,this.updateTarget(!1,1));for(var t=0;t<this.delayHideTimeList.length;t++)if(m.ServerTime.serverTime>this.delayHideTimeList[t]){var e=this.playerDic[this.delayHideNameList[t]];e&&e.limitDraw(!0,this._unitAllHideKey),this.delayHideTimeList.splice(t,1),this.delayHideNameList.splice(t,1),t--}},t.prototype.updateTarget=function(t,e){if(this._mainRole){var i=this.getExpAreaLevelByPos(this._mainRole.mapX,this._mainRole.mapY),n=!1;switch(e){case 0:n=l.HangUpExpManager.getInstance().selfAreaLevel!=i;break;case 1:n=i>l.HangUpExpManager.getInstance().selfAreaLevel}if(n){var s=l.HangUpExpManager.getInstance().getAwardSetting(i);if(s)if(0==s.zonemax)this.sendCapturePoint(i);else{var o=l.HangUpExpManager.getInstance().getOwnerNameByAreadId(i);o?t&&y.RoleCenter.instans.self.username!=o&&this.pkStartAndTestDistance(o,!0):this.sendCapturePoint(i)}}}},t.prototype.showDeadAlert=function(t,e){o.prototype.showDeadAlert.call(this,t,e),l.HangUpExpManager.getInstance().showDeadAlert(e)},t.prototype.onClearTargetHandler=function(t){o.prototype.onClearTargetHandler.call(this,t),this._currTargetFG=null;var e=this.getExpAreaLevelByPos(t.x,t.y);console.log("安全等级："+e.toString()),this._autoAttackTargetKey=!1,l.HangUpExpManager.getInstance().clearSelectedArea()},t.prototype.onMsgExit=function(t){o.prototype.onMsgExit.call(this,t),l.HangUpExpManager.getInstance().onMsgExit(t)},t.prototype.endFight=function(t){o.prototype.endFight.call(this,t),this.clearTarget()},t.prototype.clearTarget=function(){o.prototype.clearTarget.call(this),this._currTargetFG=null},t.prototype.otherPlayerVisible=function(t){if(!1,0!=this._otherPVKey)for(var e in this._otherPVKey=!1,this._otherPlayerDic)this._otherPlayerDic[e]&&this._otherPlayerDic[e].limitDraw(!0,this._unitAllHideKey)},t.prototype.getExpAreaLevelByPos=function(t,e){for(var i=this.matrixList.length,n=0;n<i;n++)if(1!=n){var s=this.matrixList[n];if(s.intCoordinate(t,e))return s.id}return 2},t.prototype.onCapturePointAreaGS2C=function(t){l.HangUpExpManager.getInstance().onCapturePointAreaGS2C(t)},t.prototype.onPassionPointSceneInfoGS2C=function(t){l.HangUpExpManager.getInstance().onPassionPointSceneInfoGS2C(t)},t.prototype.onPassionPointAwardGS2C=function(t){var e="#"+l.HangUpExpManager.getInstance().getAwardSetting(t.areaid).color,i=_.TextConst.get(813,e,t.expAdd,e,t.jungongAdd);u.FE.upItems(i,p.BubbleEnum.center),l.HangUpExpManager.getInstance().onPassionPointAwardGS2C(t)},t.prototype.onActivityRebirthGS2C=function(t){t.opresult?(t.userAcc==y.RoleCenter.instans.self.username&&(y.RoleCenter.instans.vo.GOLD-=t.decGold,l.HangUpExpManager.getInstance().successReborn()),this.resetHero(t.userAcc,t.posx,t.posy)):(u.FE.upItems(t.error,p.BubbleEnum.center),console.error(t.error)),o.prototype.onActivityRebirthGS2C.call(this,t)},t.prototype.onExitHandler=function(){s.AM.exitPlay(this.type,new Laya.Handler(this,function(){this.executeExit()}))},t.prototype.executeExit=function(){l.HangUpExpManager.getInstance().exitGamePlayScene()},t.prototype.relifeByMoney=function(){var t=l.HangUpExpManager.getInstance().getSetting().buyRebornCdCost;if(y.RoleCenter.instans.vo.GOLD>=t){var e=this._playerPosDic[y.RoleCenter.instans.self.username];if(!e){console.log("自己的数据坐标找不到，安全区内复活");var i=this.getStartPoint();(e=new Laya.Point).x=i[0],e.y=i[1]}var n=new f.ActivityRebirthC2GS;n.acttype=f.EACT_TYPE.passionPoint,n.posx=e.x,n.posy=e.y,g.GSM.sendServer(n)}},t.prototype.autoCapturePoint=function(){this._autoCapturePointKey=!0},t.prototype.getStartPoint=function(){return this.getCoordinatePos(this.matrixList[0])},t}(i.RealTimeScene);e.GamePlayHangUpExp=o}),define("src/g/fight/osprite/play/HangUpExpManager",["require","exports","../../../../manager/GameSocketManager","../../../net/messages/EnterMuSceneC2GS","../../../../core/E","../../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../../utils/system/FloatEffect","../../../net/messages/ChangeSceneMsg","src/init/TextConst","../../../../config/GameConfig","../../../../utils/system/ServerTime","../../../../manager/RoleCenter","../../../../manager/BulletManager","../../../../plugin/view/ToolTip","src/g/fightactivity/ctrl/FightActivityCtrl"],function(t,e,n,s,o,a,i,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(){function t(){this._currPortId=-1,this.gamePlay=null,this.enterMuSceneGS2C=null,this._lastSafeKey=!1,this._errDic=null,this._areaPointInfoDic=[],this._pointSettingVo=null,this._endTime=0,this._enterTime=0,this._isOpen=!1,this.viewCtrl=null,this.selfAreaLevel=1,this.totalExp=0,this.totalJungong=0}return t.getInstance=function(){return t._instance?t._instance:t._instance=new t},t.prototype.enterGamePlay=function(t,e){this.gamePlay=t,n.GSM.ins.on(s.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C),this._currPortId=e,o.E.ins.event(a.EventName.OPEN_POINT_WAR_UI);var i=this.gamePlay.getStartPoint();this.gamePlay.sendEnterMuSceneC2GS(!0,this._currPortId,i[0],i[1]),Laya.stage.frameLoop(1,this,this.updateTime),this.selfAreaLevel=1,this.totalExp=this.totalJungong=0},t.prototype.updateTime=function(){if(this.viewCtrl){var t=this._endTime-u.ServerTime.serverTime;t<0&&(t=0),this.viewCtrl.updateTime(t)}},t.prototype.onEnterMuSceneGS2C=function(t){t.opresult?t.enter?(this.enterMuSceneGS2C=t,this.gamePlay&&(this.checkIsSafe(t.posx,t.posy),this.gamePlay.setMainRoleByMsg(t))):t.enterType==s.EEnterMuSceneType.CLIENT_REQUEST&&this.gamePlay&&this.gamePlay.returnAutoplayPort():(this.gamePlay&&this.gamePlay.returnAutoplayPort(),console.log("HangUpExpManager::onEnterMuSceneGS2C:"+t.error),console.log(h.TextConst.showErrorInfo(t.error)))},t.prototype.checkIsSafe=function(t,e){if(this.gamePlay){var i=this.gamePlay.isInSafeArea(t,e);if(this._lastSafeKey!=i){var n=(this._lastSafeKey=i)?[h.TextConst.get(448),"#00ff00"]:[h.TextConst.get(449),"#ff0000"];r.FE.getFloatTxt(n[0],n[1])}}},t.prototype.exitGamePlay=function(){this.gamePlay=null,this._areaPointInfoDic.length=0;var t=this.getSetting().reentercd;this._enterTime=u.ServerTime.serverTime+t,this.viewCtrl&&this.viewCtrl.close(),Laya.stage.clearTimer(this,this.updateTime),n.GSM.ins.off(s.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C)},t.prototype.capturePointArea=function(t,e){if(this.gamePlay){for(var i=null,n=!1,s=0;s<this._areaPointInfoDic.length;s++)if(i=this._areaPointInfoDic[s]){var o=this.getAwardSetting(i.areaId);if(o&&o.areaLevel==t&&e==o.levelIndex){this.gamePlay.capturePointArea(o),n=!0;break}}0==n&&console.error("找不到数据:areaIndex:"+t+" index:"+e)}},t.prototype.getOwnerNameByAreadId=function(t){var e=this._areaPointInfoDic[t];return e&&0<e.unamelist.length?e.unamelist[0]:null},t.prototype.exitHandler=function(){this.gamePlay&&this.gamePlay.returnAutoplayPort()},t.prototype.consoleInfo=function(t){console.log(t.username+":"+t.familyname+":"+t.totalExp+":"+t.totalJungong)},t.prototype.onPassionPointStartGS2C=function(t){this._isOpen=!0,this._enterTime=t.lastExitTime+this.getSetting().reentercd,this._endTime=t.startTime+this.getSetting().lasttime,Math.abs(u.ServerTime.serverTime-t.startTime)<10&&d.BulletManager.addBroadcastById(t.startHorn),v.FightActivityCtrl.startActivity(l.EPlayType.PLAYTYPE_PASSIONPOINT,this._endTime)},t.prototype.onPassionPointEndGS2C=function(t){o.E.ins.event(a.EventName.OPEN_POINT_RESULT,[new Laya.Handler(this,this.exitHandler),t]),this._isOpen=!1,v.FightActivityCtrl.endActivtiy(l.EPlayType.PLAYTYPE_PASSIONPOINT)},t.prototype.onPassionPointSceneInfoGS2C=function(t){this._endTime=t.startDn+this.getSetting().lasttime;var e=this._endTime-u.ServerTime.serverTime;console.log("剩余时间:"+e.toString());var i=null,n=t.ppInfoList,s=0;for(s=0;s<n.length;s++)i=n[s],this._areaPointInfoDic[i.areaId]=i;if(this.viewCtrl){var o=null;for(s=0;s<n.length;s++)i=n[s],(o=this.getAwardSetting(i.areaId))&&0<i.unamelist.length&&this.updateViewAreaInfo(o,i.unamelist[0])}this.totalExp=t.expGet,this.totalJungong=t.jungongGet},t.prototype.onCapturePointAreaGS2C=function(t){this.deleteUser(t.deleteAreaId,t.username);var e=this._areaPointInfoDic[t.areaId];if(e){var i=this.getAwardSetting(t.areaId);t.username==p.RoleCenter.instans.self.username&&(this.selfAreaLevel=t.areaId,this.viewCtrl&&i&&this.viewCtrl.updateAreaLevel(i.areaLevel)),i&&(0==i.zonemax?-1==e.unamelist.indexOf(t.username)&&e.unamelist.push(t.username):e.unamelist[0]=t.username,this.updateViewAreaInfo(i,e.unamelist[0]))}},t.prototype.onMsgExit=function(t){for(var e=null,i=0;i<this._areaPointInfoDic.length;i++)(e=this._areaPointInfoDic[i])&&this.deleteUser(e.areaId,t.username)},t.prototype.onPassionPointAwardGS2C=function(t){this.totalExp+=t.expAdd,this.totalJungong+=t.jungongAdd,this.viewCtrl&&this.viewCtrl.updateAreaInfo()},t.prototype.deleteUser=function(t,e){var i=this._areaPointInfoDic[t];if(i){var n=i.unamelist.indexOf(e);if(-1!=n){i.unamelist.splice(n,1),i.fnamelist.splice(n,1);var s=this.getAwardSetting(t);s&&this.updateViewAreaInfo(s,null)}}this.gamePlay&&this.gamePlay.autoCapturePoint()},t.prototype.getSetting=function(){return null==this._pointSettingVo&&(this._pointSettingVo=c.GameConfig.pointSettingVo[1]),this._pointSettingVo},t.prototype.getAwardSetting=function(t){return c.GameConfig.pointAwardVo[t]?c.GameConfig.pointAwardVo[t]:(console.error("找不到PointAwardVo,id = "+t.toString()),null)},t.prototype.exitGamePlayScene=function(){this.gamePlay&&this.gamePlay.sendEnterMuSceneC2GS(!1,this._currPortId,0,0)},t.prototype.checkIsEnter=function(){if(this._isOpen){if(u.ServerTime.serverTime<this._endTime)return u.ServerTime.serverTime>=this._enterTime?2:1;this._isOpen=!1}return 0},t.prototype.enterHangUpExp=function(){switch(this.checkIsEnter()){case 0:r.FE.upItems(h.TextConst.get(414),g.BubbleEnum.center);break;case 1:var t=this._enterTime-u.ServerTime.serverTime;r.FE.upItems(h.TextConst.get(450,t),g.BubbleEnum.center);break;case 2:o.E.ins.event(a.EventName.PLAY_TYPE_CHANGE,i.PlayTypeVo.create(l.EPlayType.PLAYTYPE_PASSIONPOINT))}},t.prototype.showDeadAlert=function(t){this.viewCtrl&&this.gamePlay?this.viewCtrl.onDeath(t,new Laya.Handler(this.gamePlay,this.gamePlay.relifeByMoney)):console.error("error??")},t.prototype.updateViewAreaInfo=function(t,e){if(this.gamePlay){var i=this.gamePlay.playerDic[e];i?this.viewCtrl.updateAreaData(t.areaLevel,t.levelIndex,i.getNickName(),i.getFamilyName()):this.viewCtrl.updateAreaData(t.areaLevel,t.levelIndex,"","")}else console.error("gameplay == null")},t.prototype.clearSelectedArea=function(){this.viewCtrl&&this.viewCtrl.clearSelectedArea()},t.prototype.successReborn=function(){this.viewCtrl&&this.viewCtrl.onFuhuoSuc()},t._instance=null,t}();e.HangUpExpManager=f}),define("src/g/fight/osprite/play/kfhotblood/GamePlayKfHotBlood",["require","exports","src/g/fight/osprite/play/hotbloodwar/GamePlayHotBloodWar","src/g/fight/osprite/play/kfhotblood/KfHotBloodManager","../../../../../manager/GameSocketManager","../../../../net/messages/kuafu/KfrxBattleMsg"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(i){function t(t){var e=i.call(this,t)||this;return s.GSM.ins.on(o.KFRXBattleBossHPGS2C.KEY,e,e.onBattleBossHPGS2C),e}return __extends(t,i),t.prototype.manager=function(){return n.KFHotBloodManager.ins()},t.prototype.clear=function(){i.prototype.clear.call(this),s.GSM.ins.off(o.KFRXBattleBossHPGS2C.KEY,this,this.onBattleBossHPGS2C)},t.prototype.onMsgEnter=function(t){return i.prototype.onMsgEnter.call(this,t)},t}(i.GamePlayHotBloodWar);e.GamePlayKfHotBlood=a}),define("src/g/fight/osprite/play/kfhotblood/KfHotBloodManager",["require","exports","../../../../../core/E","../../../../net/messages/ChangeSceneMsg","../../../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../../../manager/RoleCenter","../../../../../meta/ReXieZhanChangSettingVo","../../../../../config/GameConfig","../../../../../manager/GameSocketManager","../../../../net/messages/ActivityMessage","../../../../net/messages/EnterMuSceneC2GS","../../../../../utils/system/FloatEffect","src/init/TextConst","../../../../../plugin/view/ToolTip","../../../../../manager/AM","src/g/fight/osprite/play/PlayManager","../../../../../utils/ItemUtils","../../../../../utils/system/ServerTime","../../../../net/messages/BloodyBattleMsg","src/g/accessctrl/AccessCenter","../../../../../manager/NewRedHintsCenter","../../../../net/messages/kuafu/KfrxBattleMsg"],function(t,e,o,a,r,i,l,n,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function s(){this.gamePlay=null,this._battleOpenStateMsg=null,this._bossVoInitKey=!1,this._bossVoDic={},this._bossInfoDic={},this._enterTime=-1,this._ownerFG=null,this._relifeTime=-1,this._enterPortId=-1,this._openPanelKey=!1,this.viewCtrl=null,this._panelReqKey=!1}return s.ins=function(){return this._ins||(this._ins=new s),this._ins},s.prototype.getSetting=function(t){var e=h.GameConfig.KFRXSettingVo[t];return e||(e=new n.KFRXSettingVo)},s.prototype.getBossInfoDic=function(){return this._bossInfoDic},s.prototype.checkIsMainScene=function(){var t=s.ins().getSetting("portId").value;return this.getPortId()==t},s.prototype.getPortId=function(){return this.gamePlay?this.gamePlay.getCurrPortId():-1},s.prototype.exitHotBloodWar=function(){this.gamePlay&&this.gamePlay.sendEnterMuSceneC2GS(!1,this.gamePlay.getCurrPortId(),0,0)},s.prototype.onBossKillStateGS2C=function(t){if(this._panelReqKey)this._panelReqKey=!1;else{if(this.setDecHurt(t.bossOwnerDecHurt),this.gamePlay){var e=this.gamePlay.getPlayerFG(t.owneruname);this.setBossOwner(e)}this._bossInfoDic[t.portid]&&this.bossStateChange(this._bossInfoDic[t.portid])}},s.prototype.setDecHurt=function(t){this.viewCtrl&&this.viewCtrl.updJianMianHurt(t)},s.prototype.getPortStatus=function(t){return this._bossInfoDic[t]},s.prototype.updateBossOwnerHp=function(t,e){this.viewCtrl&&this.viewCtrl.updateBossOwnerHp(t,e)},s.prototype.findBoss=function(){this.gamePlay&&this.gamePlay.startKillMonster()},s.prototype.gotoBossArea=function(t){if(this.gamePlay&&this._bossInfoDic[t]){var e=this.checkChangeCondition(t);0==e?this.gamePlay.gotoBoss(t):this.outConditionErrInfo(e,t)}},s.prototype.enterGamePlay=function(t){o.E.ins.event(r.EventName.KFHOTBLOODWAR_SCENE_PANEL);var e=c.GSM.ins;e.on(w.KFRXBossKillRecordGS2C.KEY,this,this.onBossKillRecordGS2C),e.on(u.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),e.on(w.KFRXBattleBossEndGS2C.KEY,this,this.onKFRXBattleBossEndGS2C),e.on(u.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChangeGS2C),this.setBossOwner(null),this.gamePlay=t,-1!=this._enterPortId&&(this.gamePlay.setEnterPortId(this._enterPortId),this._enterPortId=-1);var i=this.getSetting("portId").value,n=this.gamePlay.getStartPoint();e.on(p.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C),this.gamePlay.sendEnterMuSceneC2GS(!0,i,n[0],n[1])},s.prototype.exitGamePlay=function(){this.viewCtrl&&(this.viewCtrl.exit(),this.viewCtrl=null),this._enterPortId=-1,this.setBossOwner(null),this._enterTime=_.ServerTime.serverTime+this.getSetting("outTimeCD").value;var t=c.GSM.ins;t.off(w.KFRXBossKillRecordGS2C.KEY,this,this.onBossKillRecordGS2C),t.off(u.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),t.off(w.KFRXBattleBossEndGS2C.KEY,this,this.onKFRXBattleBossEndGS2C),t.off(u.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChangeGS2C),this.gamePlay=null,t.off(p.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C)},s.prototype.setMonsterHp=function(t){this.viewCtrl&&this.viewCtrl.updateBossHp(t)},s.prototype.showDeadAlert=function(t){this.viewCtrl.onDeath(t,new Laya.Handler(this,this.onMoneyLife),new Laya.Handler(this,this.onReLife))},s.prototype.onReLife=function(){this.sendRebord(!0)},s.prototype.onMoneyLife=function(){var t=this.getSetting("payForLife").value;l.RoleCenter.instans.self.GOLD<t?d.FE.upItems(g.TextConst.get(460),v.BubbleEnum.center):this.sendRebord(!1)},s.prototype.sendRebord=function(t){if(this.gamePlay){var e=null,i=new u.ActivityRebirthC2GS;i.acttype=u.EACT_TYPE.kfrx,e=(i.freeRebirth=t)?this.gamePlay.getStartPoint():this.gamePlay.getSelfPos(),i.posx=e[0],i.posy=e[1],c.GSM.sendServer(i)}else console.error("不在玩法中")},s.prototype.reqBossKillState=function(t,e){void 0===e&&(e=0);var i=new w.KFRXBossKillStateC2GS;i.portid=t,c.GSM.sendServer(i),1==e&&(this._panelReqKey=!0)},s.prototype.onBloodyBattleActOpenState=function(t){this._battleOpenStateMsg=t},s.prototype.bossStateChange=function(t){var e=t.portid;this.viewCtrl&&this.viewCtrl.updateBossState(e),this.gamePlay&&this.gamePlay.updateBossState(e),this.checkIsShowBossView(e),o.E.ins.event(r.EventName.HOTBLOOD_DATA_UPDATE)},s.prototype.onBattleBossStateGS2C=function(t){var e=this._bossInfoDic[t.portid];e&&e.bossState==w.KFRXEBattleBossState.CAN_CHALLENGE&&t.bossState==w.KFRXEBattleBossState.WAIT_REVIVE&&o.E.ins.event(r.EventName.HB_BOSSDEATH,t),this._bossInfoDic[t.portid]=t,this.bossStateChange(t)},s.prototype.onBattleBossStateAll=function(t){for(var e=null,i=0;i<t.bossStateArr.length;i++)e=t.bossStateArr[i],this._bossInfoDic[e.portid]=e;this._openPanelKey&&(this._openPanelKey=!1,this.openBossInfoPanel()),o.E.ins.event(r.EventName.HOTBLOOD_DATA_UPDATE)},s.prototype.openBossInfoPanel=function(){o.E.ins.event(r.EventName.KFHOTBLOOD_DATA_INITED)},s.prototype.checkIsShowBossView=function(t){if(this.viewCtrl&&(this.gamePlay&&this.gamePlay.getCurrPortId()==t))if(this._bossInfoDic[t])switch(this._bossInfoDic[t].bossState){case C.EBattleBossState.CAN_CHALLENGE:this.viewCtrl.visibleBossView(!0);break;case C.EBattleBossState.WAIT_REVIVE:this.viewCtrl.visibleBossView(!1)}else this.viewCtrl.visibleBossView(!1)},s.prototype.onBattleBossReviveGS2C=function(t){var e=this._bossInfoDic[t.portid];e&&(e.bossState=w.KFRXEBattleBossState.CAN_CHALLENGE,this.bossStateChange(e),this.reqOpenBossInfoPanel(t.portid)),this.gamePlay&&this.gamePlay.onBattleBossReviveGS2C(t)},s.prototype.reqOpenBossInfoPanel=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!0);var i=new w.KFRXBattleBossStateC2GS;i.portid=t,i.requestAll=0==t,c.GSM.sendServer(i),this._openPanelKey=e},s.prototype.onEnterMuSceneGS2C=function(t){if(t.opresult){var e=s.ins().getSetting("portId").value;t.portid==e?this.viewCtrl&&this.viewCtrl.hideBattlePanel():(this.viewCtrl&&this.viewCtrl.showBattlePanel(t.portid),this.setBossOwner(null),this.reqBossKillState(t.portid),this.reqOpenBossInfoPanel(t.portid)),t.enter?(t.enterType==p.EEnterMuSceneType.REVIVE&&this.viewCtrl.getDeathCtrl().relase(),this.gamePlay.setMainRoleByMsg(t)):o.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,i.PlayTypeVo.create(a.EPlayType.PLAYTYPE_PORT))}else o.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,i.PlayTypeVo.create(a.EPlayType.PLAYTYPE_PORT)),d.FE.upItems(g.TextConst.showErrorInfo(t.error),v.BubbleEnum.center)},s.prototype.outConditionErrInfo=function(t,e){var i=this.getBossVoByPortId(e),n=null;switch(t){case 0:break;case 1:n=g.TextConst.get(458,m.ItemUtils.getEquipLv(i.limit1));break;case 2:n=g.TextConst.get(459,i.limit2);break;case 3:n=g.TextConst.get(469)}n&&d.FE.upItems(n,v.BubbleEnum.center)},s.prototype.enterHotBloodWar=function(t,e){if(void 0===e&&(e=a.EPlayType.PLAYTYPE_KFRX),!l.RoleCenter.instans.bagRoomEnough())return f.AM.showBagNotEnough(),!1;if(y.PlayManager.isSpecialPlay()&&y.PlayManager.type!=e)return d.FE.upItems(g.TextConst.get(406),v.BubbleEnum.center),!1;var i=this.checkChangeCondition(t);if(0!=i)return this.outConditionErrInfo(i,t),!1;if(null!=this.gamePlay)return this._enterPortId=t,s.ins().gotoBossArea(t),!1;if(!this._battleOpenStateMsg)return!1;if(!this._battleOpenStateMsg.actOpen)return d.FE.upItems(g.TextConst.get(455),v.BubbleEnum.center),!1;var n=this._enterTime-_.ServerTime.serverTime;return 0<n?(d.FE.upItems(g.TextConst.get(984,n),v.BubbleEnum.center),!1):(this._enterPortId=t,this.sendEvt(e),!0)},s.prototype.onBossOwnerChangeGS2C=function(t){if(""==t.newowner)this.setBossOwner(null);else{var e=this.gamePlay.getPlayerFG(t.newowner);this.setBossOwner(e)}},s.prototype.setBossOwner=function(t){this._ownerFG!=t&&(this._ownerFG=t,this.updateBossOwner(t)),this.gamePlay&&this.gamePlay.setBossOwner(t)},s.prototype.updateBossOwner=function(t){this.viewCtrl&&this.viewCtrl.updateBossOwner(t)},s.prototype.getPlayerFG=function(t){return this.gamePlay?this.gamePlay.getPlayerFG(t):null},s.prototype.checkKFRXWarRedPoint=function(){this.checkIsEnter()?b.NewRedHintsCenter.ins.setRedHintOpenOrClose(b.enumRedHints.kfrxred,!0):b.NewRedHintsCenter.ins.setRedHintOpenOrClose(b.enumRedHints.kfrxred,!1)},s.prototype.onKFRXBattleBossEndGS2C=function(t){null!=t.bossowner&&""!=t.bossowner?(t.bossowner==l.RoleCenter.instans.self.username&&(t.invent&&(l.RoleCenter.instans.addInventoryToC(t.invent),d.FE.addInventoryToCFloats(t.invent)),this.checkKFRXWarRedPoint()),t.helpData&&t.helpData.isHelp&&t.helpData.invent&&(l.RoleCenter.instans.addInventoryToC(t.helpData.invent),d.FE.addInventoryToCFloats(t.helpData.invent))):console.warn("热血战场结算没有归属者"),o.E.ins.event(r.EventName.OPEN_HOTBLOOD_RESULT,t),this.gamePlay&&this.gamePlay.getCurrPortId()==t.portid&&this.setBossOwner(null)},s.prototype.onActivityRebirthGS2C=function(t){this.gamePlay&&this.gamePlay.onActivityRebirthGS2C(t),t.opresult?t.userAcc==l.RoleCenter.instans.self.username&&(l.RoleCenter.instans.vo.GOLD-=t.decGold,this.viewCtrl.showLastBossScene()):console.error(t.error)},s.prototype.onBossKillRecordGS2C=function(t){},s.prototype.checkChangeCondition=function(t){if(t==s.ins().getSetting("portId").value)return 0;var e=this.getBossVoByPortId(t);if(e){var i=l.RoleCenter.instans.self.getRXPingFen();return l.RoleCenter.instans.self.getCurLv()>=e.limit1?i>=1e4*e.limit2?0:2:1}return 3},s.prototype.sendEvt=function(t){o.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,i.PlayTypeVo.create(t))},s.prototype.getBossVoByPortId=function(t){if(0==this._bossVoInitKey){this._bossVoInitKey=!0;var e=null,i=h.GameConfig.kfrxvo;for(var n in i)e=i[n],this._bossVoDic[e.port]=e}return this._bossVoDic[t]},s.prototype.checkIsHaveBossTask=function(){if(0<l.RoleCenter.instans.vo.KFRX_CNT||0<l.RoleCenter.instans.vo.KFRX_HELPCNT){var t=null,e=h.GameConfig.kfrxvo;for(var i in e)if(t=e[i],0==this.checkChangeCondition(t.port))return!0}return!1},s.prototype.checkIsEnter=function(){var t=I.AccessCenter.ins.checkOpen(215),e=s.ins().checkIsHaveBossTask();return!(!t||!e)},s.prototype.getFirstChallgeBoss=function(){if(!this.checkIsEnter())return null;var t=this._bossInfoDic,e=null;for(var i in t)if(e=t[i])switch(e.bossState){case C.EBattleBossState.WAIT_REVIVE:break;case C.EBattleBossState.CAN_CHALLENGE:if(0==this.checkChangeCondition(e.portid))return m.ItemUtils.getBossVoByPortId(e.portid);break;case C.EBattleBossState.NULL:}return null},s._ins=null,s}();e.KFHotBloodManager=s}),define("src/g/fight/osprite/obj/PassGateUnit",["require","exports","src/g/fight/osprite/obj/BaseSprite","../../../../manager/LayerManager","src/g/fight/osprite/SceneObjManager","src/g/Effects/UIEffectsFactory","../../../../utils/ItemUtils"],function(t,e,i,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.item=new Laya.Animation,t.portID=0,t}return __extends(t,e),t.prototype.setup=function(t,e,i){this.setMapXY(t,e),this.item=a.UIEffectsFactory.Ins.createSAniById(45);var n=r.ItemUtils.getUIEffectsVoById(45);this.item.pivot(n.width/2,n.height/2),this.item.play(),o.SceneObjManager.instans.regObject(this),s.LayerManager.fightLayer.shadowLayer.addChild(this.item),null==this._headName&&(this._headName=new Laya.Text,this._headName.y=this.item.pivotY-100,this._headName.width=196,this._headName.x=this.item.pivotX-this._headName.width/2,this._headName.align="center",this._headName.color="#00ff00",this._headName.fontSize=18,this._headName.strokeColor="#000000",this._headName.stroke=2),this._headName.text=i,this.item.addChild(this._headName),this.setWorldXY(t,e)},t.prototype.frameMove=function(t){this.updatePoint(),this.item&&(this.item.x=this.gridX,this.item.y=this.gridY)},t.prototype.destory=function(t){void 0===t&&(t=!0),this.item.destroy(),e.prototype.destory.call(this),t&&Laya.Loader.clearRes("dynamic2/uieffect/EUI1_45.json",!0)},t.prototype.hide=function(){this.item.visible=!1,this.visible=!1},t.prototype.show=function(){this.item.visible=!0,this.visible=!0},t.prototype.setHeadName=function(t){this._headName&&(this._headName.text=t)},t}(i.BaseSprite);e.PassGateUnit=n}),define("src/g/fight/osprite/play/baseplay/ClientMonster",["require","exports","src/g/fight/osprite/obj/MonsterUnit_New"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(o){function t(t,e){return void 0===t&&(t=!0),void 0===e&&(e=!1),o.call(this,t,e)||this}return __extends(t,o),t.prototype.chg_HP=function(t,e,i,n,s){void 0===s&&(s=!1),o.prototype.chg_HP.call(this,t,e,i,n,s),this.getHp()<=0&&this._deadthHandler&&this._deadthHandler.run()},t}(i.MonsterUnit_New);e.ClientMonster=n}),define("src/g/fight/manager/ItemManager",["require","exports","../../../utils/DropUtil","../../net/messages/CurrencyType"],function(t,e,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.getDropArray=function(t,e){void 0===e&&(e=!0);var i=[];if(!t)return[];for(var n=t.currencyList,s=0;s<n.length;s++){var o=n[s];o.val<=0||(o.key==y.CurrencyType.MONEY?this.addDropItem(i,f.DropUtil.MONEYID,o.val):o.key==y.CurrencyType.GOLD?this.addDropItem(i,f.DropUtil.GOLDID,o.val):(o.key,y.CurrencyType.EXP))}var a=t.itemList;for(s=0;s<a.length;s+=2){var r=a[s],l=a[s+1];if(e)for(h=0;h<l;h++)this.addDropItem(i,r,1);else for(var h=0;h<l;h++)this.addDropItem(i,r,1,s)}for(var c=t.equipList,u=0;u<c.length;u++){var p=c[u];this.addDropItem(i,p.equtemplet,1)}for(var d=t.zhanwenList,g=0;g<d.length;g++){var v=d[g];this.addDropItem(i,v.cfgId,1)}return i},t.addDropItem=function(t,e,i,n){void 0===n&&(n=0);var s=t.length,o=t.indexOf(e,n);-1!=o?t[o+1]+=i:(t[s]=e,t[s+1]=i)},t.getDropArrayFromArray=function(t){for(var e=[],i=0,n=t.length;i<n;i++){var s=t[i],o=s[0],a=s[1];switch(o){case"MONEY":this.addDropItem(e,f.DropUtil.MONEYID,a);break;case"EXP":case"GHGX":break;default:this.addDropItem(e,o,a)}}return e},t}();e.ItemManager=i}),define("src/g/fight/osprite/play/kftplay/GamePlayKFT",["require","exports","../../../../../utils/ItemUtils","../../../../../config/GameConfig","../../../../../core/E","../../../../../utils/system/ServerTime","../../../../../enum/EventName","src/g/fight/osprite/obj/FightGroup","../../../../net/messages/BloodyBattleMsg","../../../../../manager/GameSocketManager","src/g/fight/osprite/play/RealTimeBossScene","../../../../net/messages/EnterMuSceneC2GS","../../../../../manager/RoleCenter","../../../../../manager/AM","src/init/TextConst","src/g/fight/osprite/play/kftplay/KFTManager","../../../../net/messages/kuafu/KftbBattleMsg","src/g/fight/osprite/obj/PassGateUnit","src/g/fight/osprite/play/baseplay/ClientMonster","../../../../../utils/DropUtil","src/g/fight/manager/ItemManager","../../../../../enum/HpType"],function(t,e,o,l,n,s,a,h,i,c,r,u,p,d,g,v,f,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var b=function(r){function t(t){var e=r.call(this,t)||this;e._showDebugKey=!1,e._currPortId=0,e._waitTime=0,e._ownerFG=null,e._sendCdTime=3,e._outInfoKey=!1,e._sceneOpenStateDic={},e._bossStateChangeKey=!1,e._lastLeftTime=-1,e._autoBattleKey=!1,e._enterPortId=-1,e._waitAutoAttackBossTime=-1,e._autoAttackBossTime=2,e._boxMonsterFg=null,e._passArr=[],e._auofight=!1,e._portOb={},e._enterObj=[],e._lastpos=[];var i=c.GSM.ins;return i.on(f.KFTBBattleBossHPGS2C.KEY,e,e.onBattleBossHPGS2C),n.E.ins.on(a.EventName.EXIT_BOSS_PLAYTYPE,e,e.onExitHandler),i.on(f.KFTBWeakUpBossGS2C.KEY,e,e.upKFTBWeakUpBossGS2C),e.passItem=new y.PassGateUnit,e.passItem.setup(0,0,""),e.drawRect(),e.enablePK(!0),e._bossGroup=new h.FightGroup(null),e._boxMonsterFg=new h.FightGroup(null),e.manager().enterGamePlay(e),e}return __extends(t,r),t.prototype.changeMap=function(t){var e=l.GameConfig.getPortByID(t);e&&this.scene&&this.scene.changeMap(e.boss_scene),this.updatePlay()},t.prototype.removeBoxMonster=function(){this._boxMonsterFg&&(this._boxMonsterFg.setAllDaeth(),this._boxMonsterFg.destroyGroup(!0),this._boxMonsterFg=null)},t.prototype.upKFTBWeakUpBossGS2C=function(t){var e=this.manager().getBossInfoDic();if(e&&(e[t.portid].bossState=t.bossState),t.invent){p.RoleCenter.instans.addInventoryToC(t.invent);var i=C.ItemManager.getDropArray(t.invent),n=this._fightGroup.getFUList()[0];_.DropUtil.isfly=!0,n&&(_.DropUtil.createDrop(i,new Laya.Point(n.worldX,n.worldY)),Laya.timer.once(10,this,function(){_.DropUtil.flyToRole(n),p.RoleCenter.effectExpAndMoney(t.invent)}))}console.log(t.invent),this.removeBoxMonster(),this.updatePlay()},t.prototype.wakeupBoss=function(){this._boxMonsterFg&&(this._fightGroup.isDeath()||this._fightGroup.setOnceTarget(this._boxMonsterFg))},t.prototype.deadHandler=function(){var t=new f.KFTBWeakUpBossC2GS;t.portid=this.currentPortId,c.GSM.sendServer(t)},t.prototype.drawRect=function(){var t;this._kftbvo=this.manager().kfTBWorldMapVo(),t=this._kftbvo.portid,this._showDebugKey=!0,this.createAreaMatrixList(t,t,this._showDebugKey);var e=o.ItemUtils.getPortVoById(t),i=l.GameConfig.getMapJSON(e.boss_scene),n=i.doorXY;this.drawSafeArea(n[0],n[1],n[2]),this._mapvo=i},t.prototype.removePassUnit=function(){for(var t=0;t<this._passArr.length;t++)this._passArr[t].destory(!1);this.passItem.hide(),this._passArr=[]},t.prototype.showPass=function(){this.removePassUnit();var t=this._mapvo.bossDoorXY,e=this.manager().getPortStatus(this._kftbvo.portid);if(e)for(var i=e.randomPortArr,n=0;n<i.length;n++){var s=i[n].split(":"),o=Number(s[0]),a=Number(s[1]),r=t[o];if(r){var l=new y.PassGateUnit;l.portID=a,l.setup(r[0],r[1],n+1+""),l.setMapXY(r[0],r[1]),this._passArr.push(l),this.manager().showPassList(n,a,r[0],r[1])}}this.passItem.hide()},t.prototype.getStartPoint=function(){return this.getCoordinatePos(this.matrixList[0])},t.prototype.clear=function(){r.prototype.clear.call(this),this._enterPortId=-1;var t=c.GSM.ins;t.off(i.BattleBossHPGS2C.KEY,this,this.onBattleBossHPGS2C),t.off(f.KFTBWeakUpBossGS2C.KEY,this,this.upKFTBWeakUpBossGS2C),n.E.ins.off(a.EventName.EXIT_BOSS_PLAYTYPE,this,this.onExitHandler),this.manager().exitGamePlay(),this.passItem.destory();for(var e=0;e<this._passArr.length;e++)this._passArr[e].destory();this._passArr=null,this._boxMonsterFg&&this._boxMonsterFg.destroyGroup(!0)},t.prototype.allInit=function(){r.prototype.allInit.call(this),this._fightGroup&&this._mainRole&&this._fightGroup.setFGMapXY(this._mainRole.mapX,this._mainRole.mapY)},t.prototype.frameMove=function(){if(r.prototype.frameMove.call(this),this._ownerFG&&this.manager().updateBossOwnerHp(this._ownerFG.getHp(),this._ownerFG.getTotalHp()),this._currTargetFG&&this._currTargetFG.isDeath()&&this.changeBattleState(0),this.showLeftTime(),0==this._invincibleKey&&null==this._targetName&&this._mainRole){switch(this._battleState){case 0:if(this._currTargetFG||2==this._mainRole.action)this._waitAutoAttackBossTime=s.ServerTime.serverTime,this._currTargetFG=null;else if(this._currTargetFG=this.getFreeRevengeTarget(),null==this._currTargetFG){var t=this.manager().getPortStatus(this._currPortId),e=s.ServerTime.serverTime-this._waitAutoAttackBossTime>this._autoAttackBossTime;t&&t.bossState==f.KFTBEBattleBossState.CAN_CHALLENGE&&e&&(this._waitAutoAttackBossTime=s.ServerTime.serverTime,this._bossGroup&&this.startKillMonster())}}this._currTargetFG&&this.pkStartAndTestDistance(this._currTargetFG.groupID)}},t.prototype.showLeftTime=function(){if(this._currPortId!=this._kftbvo.portid){var t=this.manager().getPortStatus(this._currPortId);if(t)switch(t.bossState){case f.KFTBEBattleBossState.CAN_CHALLENGE:var e=t.bossExpiredTime-s.ServerTime.serverTime;this.manager().updateLeftTime(e)}}},t.prototype.updatePlay=function(){if(this._currPortId!=this._kftbvo.portid){var t=this.manager().getPortStatus(this._currPortId);if(t)switch(t.bossState){case f.KFTBEBattleBossState.WAIT_REVIVE:this.visibleBossFG(!1),this.visibleShowMonster(!0);break;case f.KFTBEBattleBossState.CAN_CHALLENGE:this.visibleBossFG(!0),this.visibleShowMonster(!1);break;case f.KFTBEBattleBossState.SLEEP:case f.KFTBEBattleBossState.MONSTER_ESCAPE:this.visibleBossFG(!1),this.visibleShowMonster(!0);break;default:this.visibleBossFG(!1),this.visibleShowMonster(!0)}else this.removeBoxMonster()}else this.removeBoxMonster()},t.prototype.checkToAttackMonster=function(){if(!this._currTargetFG){var t=this.manager().getPortStatus(this._currPortId);t&&t.bossState==f.KFTBEBattleBossState.CAN_CHALLENGE&&this._bossGroup&&this.startKillMonster()}},t.prototype.changeBattleState=function(t){var e=r.prototype.changeBattleState.call(this,t);return e&&0==t&&(this._waitAutoAttackBossTime=s.ServerTime.serverTime),e},t.prototype.visibleTombStone=function(t){},t.prototype.reqChangeScene=function(t){var e,i;if(this._mainRole){var n=l.GameConfig.getPortByID(t),s=l.GameConfig.getMapJSON(n.boss_scene);e=s.startPoint[0][0],i=s.startPoint[0][1],this._kftbvo.portid==t&&this._bossGroup&&(this._bossGroup.destroyGroup(!0),2<=this._lastpos.length&&(e=this._lastpos[0],i=this._lastpos[1])),this.manager().reqOpenBossInfoPanel(t),this._fightGroup.setMapXY(e,i),this.sendEnterMuSceneC2GS(!0,t,e,i,u.EEnterMuSceneType.CLIENT_REQUEST_SCENE)}},t.prototype.sendEnterMuSceneC2GS=function(t,e,i,n,s,o,a){void 0===s&&(s=u.EEnterMuSceneType.CLIENT_REQUEST),void 0===o&&(o=0),void 0===a&&(a=0),r.prototype.sendEnterMuSceneC2GS.call(this,t,e,i,n,s,o,a),this._fightGroup.setMapXY(i,n)},t.prototype.addFightGroupSvrID=function(t,e){},t.prototype.setMainRoleByMsg=function(t){r.prototype.setMainRoleByMsg.call(this,t),this.addFightGroupSvrID(this._fightGroup,p.RoleCenter.instans.vo.username),t.opresult&&this.changeScene(t.portid,t.monsterUid)},t.prototype.changeScene=function(t,e){if(this._waitTime=s.ServerTime.serverTime,this._currPortId!=t&&(this._currPortId=t),this._fightGroup&&this._fightGroup.setFGTarget(null),this.clearOtherPlayer(),this.clearAllState(),this.changeMap(t),this._kftbvo.portid!=t)this.removePassUnit(),this.visibleBossFG(!1),this.showMosnter(t,e);else{this.showPass();var i=new f.KFTBSceneStateC2GS;i.portid=t,c.GSM.sendServer(i)}},t.prototype.visibleShowMonster=function(t){if(this._boxMonsterFg)t?this._boxMonsterFg.addToFightLayer():this._boxMonsterFg.removeFromFightLayer();else{var e=this.manager().getSetting("hidemon").value.split(",");switch(this.manager().getPortStatus(this._currPortId).bossState){case f.KFTBEBattleBossState.SLEEP:e=e[0];break;default:e=e[1]}var i=l.GameConfig.getPortByID(this.currentPortId);if(i){var n=l.GameConfig.getMapJSON(i.boss_scene);this.createShow(e,n)}}},t.prototype.visibleBossFG=function(t,e){void 0===e&&(e=!1);var i=this._bossGroup;if(t){i?i.destroyGroup(!0):this._bossGroup=i=new h.FightGroup("");var n=l.GameConfig.getPortByID(this._currPortId),s=l.GameConfig.getMapJSON(n.boss_scene),o=this.manager().getPortStatus(this._currPortId);if(o){var a=this._portOb[this._currPortId];this._monsterDic[-1]=this.createMonster(i,o.monid,a,I.HpType.npc),i.setMapXY(s.bossXY[0][0],s.bossXY[0][1]),i.addToFightLayer(),this.visibleBeFocus(t)}i.setOnceTarget(this._ownerFG)}else i&&(i.removeFromFightLayer(),e&&i.setAllDaeth(),i.destroyGroup(!0))},t.prototype.createShow=function(t,e){var i=null,n=o.ItemUtils.getMonsterVOById(t);if(n){i=new h.FightGroup(null);var s=new m.ClientMonster;s.setHurtNum(1),s.set_DATA(n),i.addFightUnit(s),s._deadthHandler=new Laya.Handler(this,this.deadHandler),this._boxMonsterFg=i,this._boxMonsterFg.setMapXY(e.bossXY[0][0],e.bossXY[0][1])}},t.prototype.showMosnter=function(t,e){this._bossGroup&&this._bossGroup.destroyGroup(!1),this._portOb[t]=e,this.removeBoxMonster();var i=l.GameConfig.getPortByID(t),n=l.GameConfig.getMapJSON(i.boss_scene);if(t==this._kftbvo.portid)this.visibleBossFG(!1);else if(n&&0<n.bossXY.length){var s=this.manager().getSetting("hidemon").value.split(","),o=this.manager().getPortStatus(this._currPortId);if(o)switch(o.bossState){case f.KFTBEBattleBossState.SLEEP:s=s[0],this.createShow(s,n);break;case f.KFTBEBattleBossState.MONSTER_ESCAPE:s=s[1],this.createShow(s,n);break;case f.KFTBEBattleBossState.CAN_CHALLENGE:this.visibleBossFG(!0)}this.passItem&&(this.passItem.show(),this.passItem.setMapXY(n.bossDoorXY[0][0],n.bossDoorXY[0][1]))}this.updateBossState(t)},t.prototype.updateBossState=function(t){t==this._currPortId&&this.updatePlay(),t==this._kftbvo.portid&&this.currentPortId==this._kftbvo.portid&&this.showPass()},t.prototype.onExitHandler=function(){d.AM.exitPlay(this.type,new Laya.Handler(this,function(){this.executeExit()}))},t.prototype.executeExit=function(){this.manager().exitHotBloodWar()},t.prototype.onBattleBossHPGS2C=function(t){this._monsterDic[t.monsterUid]&&(this.manager().setMonsterHp(t.bossHP),this.setMonsterHp(t.monsterUid,t.bossHP,!0),0==t.bossHP&&this.bossDead())},t.prototype.onBattleBossReviveGS2C=function(t){this.getCurrPortId(),t.portid},t.prototype.onActivityRebirthGS2C=function(t){this.resetHero(t.userAcc,t.posx,t.posy),r.prototype.onActivityRebirthGS2C.call(this,t)},t.prototype.showDeadAlert=function(t,e){r.prototype.showDeadAlert.call(this,t,e),this.manager().showDeadAlert(e)},t.prototype.gotoPass=function(t){void 0===t&&(t=0);var e=this._passArr[t];e&&this.followTargetPos(e.mapX,e.mapY,0)},t.prototype.enterObj=function(){return this._enterObj},t.prototype.onMoveEndSC=function(t){r.prototype.onMoveEndSC.call(this,t);var e=Math.floor(t/h.FightGroup.HERO_MAXNUM),i=t%h.FightGroup.HERO_MAXNUM;if(this._mainRole&&e==this.fightGroup.uId&&i==this._mainRole.index){var n=null,s=0,o=0;if(this._currPortId==this._kftbvo.portid)for(var a=0;a<this._passArr.length;a++){if((s=(n=this._passArr[a]).mapX-this._mainRole.mapX)*s+(o=n.mapY-this._mainRole.mapY)*o<1e4){this._lastpos[0]=n.mapX-110,this._lastpos[1]=n.mapY+110,this.reqChangeScene(n.portID),this._enterObj[a]=n.portID;break}}else s=(n=this.passItem).mapX-this._mainRole.mapX,o=n.mapY-this._mainRole.mapY,Math.abs(s*s+o*o)<1e4&&this.reqChangeScene(this._kftbvo.portid)}},t.prototype.addPPlayer=function(t){var e=t.getFamilyUid();""==e||null==e?r.prototype.addPPlayer.call(this,t):t.getFamilyUid()!=this._fightGroup.getFamilyUid()?r.prototype.addPPlayer.call(this,t):this.addFamilyMemeber(t)},t.prototype.onSelectPkTarget=function(t){var e=this._playerDic[t];if(e){var i=e.getFamilyUid();""==i||null==i?r.prototype.onSelectPkTarget.call(this,t):e.getFamilyUid()!=this._fightGroup.getFamilyUid()?r.prototype.onSelectPkTarget.call(this,t):d.AM.show(g.TextConst.get(453,e.getNickName()),Laya.Handler.create(this,this.surePkTarget,[t]))}},t.prototype.manager=function(){return v.KFTManager.ins()},t.prototype.setBossOwner=function(t){this._ownerFG=t,this._bossGroup&&!this._bossGroup.isDeath()&&this._bossGroup.setOnceTarget(this._ownerFG)},t.prototype.surePkTarget=function(t){r.prototype.onSelectPkTarget.call(this,t)},t.prototype.onClearTargetHandler=function(t){r.prototype.onClearTargetHandler.call(this,t),this._outInfoKey=!0,this._autoBattleKey=!1},t.prototype.setEnterPortId=function(t){this._enterPortId=t},t.prototype.getCurrPortId=function(){return this._currPortId},t}(r.RealTimeBossScene);e.GamePlayKFT=b}),define("src/g/base/BaseCtrl",["require","exports","../../utils/UIUtils","../../enum/LoadPriority","src/g/clearRes/ClearResM"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){}return t.prototype.onAtlasLoaded=function(){},t.prototype.open=function(){var t=this.url;!t||Laya.loader.getRes(t)?this.onAtlasLoaded():i.UIUtils.loadAtlas(t,this,this.onAtlasLoaded,n.LoadPriority.UI)},t.prototype.opens=function(){var t=this.urls;!t||t.length<=0?this.onAtlasLoaded():i.UIUtils.loadAtlasArr(t,this,this.onAtlasLoaded,n.LoadPriority.UI)},t.prototype.clearCtrlRes=function(){var t=this.url;t&&s.ClearResM.clearUrl(t);var e=this.urls;if(e&&0<e.length)for(var i=0;i<e.length;i++)s.ClearResM.clearUrl(e[i])},t}();e.BaseCtrl=o}),define("src/g/setting/view/Setting",["require","exports","../../../enum/EventName","../../../core/E","../../../enum/SettingEnum","../../../utils/SoundUtils","src/g/setting/vo/SettingInfo","src/init/TextConst","../../../utils/system/DateUitl"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.init(),t.addListen(),t.bg.btn_close.visible=t.bg.btn_back.visible=!1,t.uid_txt.text=window.kth5sdk.openid||"",t}return __extends(t,e),t.prototype.init=function(){this.musicSwitch=new c(this.imgMusicKai,this.imgMusicGuan),this.soundSwitch=new c(this.imgSoundKai,this.imgSoundGuan);var t=a.SettingInfo.getSettingValue(s.SettingEnum.playMusic);this.musicSwitch.setStatus(t,!1),this.soundSwitch.setStatus(a.SettingInfo.getSettingValue(s.SettingEnum.playSound),!1),this.roleCheck.visible=!1,this.zhenpingCheck.selected=a.SettingInfo.getSettingValue(s.SettingEnum.noZhenPing),this.hejiCheck.selected=a.SettingInfo.getSettingValue(s.SettingEnum.autoKeJi),this.lbTime.text=r.TextConst.get(868,l.DateUtil.getKFDay(),window.ktgamepreloadjdk.gameversion),this.hejiCheck.visible=!1},t.prototype.addListen=function(){n.E.ins.on(i.EventName.SWITCH_STATUS_CHANGED,this,this.soundStatusHander),this.zhenpingCheck.on(Laya.Event.CHANGE,this,this.noZhenPing),this.hejiCheck.on(Laya.Event.CHANGE,this,this.autoHeJi)},t.prototype.soundStatusHander=function(t){t==this.musicSwitch?(console.log("声音发生变化music"+t.isOpened()),o.SoundUtils.getInstance().isPlayMusic=t.isOpened(),a.SettingInfo.setSettingValue(s.SettingEnum.playMusic,t.isOpened())):(console.log("声音发生变化sound:"+t.isOpened()),o.SoundUtils.getInstance().isPlaySound=t.isOpened(),a.SettingInfo.setSettingValue(s.SettingEnum.playSound,t.isOpened()))},t.prototype.noZhenPing=function(){console.log("zhenpingCheck:"+this.zhenpingCheck.selected),a.SettingInfo.setSettingValue(s.SettingEnum.noZhenPing,this.zhenpingCheck.selected)},t.prototype.autoHeJi=function(){console.log("hejiCheck:"+this.hejiCheck.selected),a.SettingInfo.setSettingValue(s.SettingEnum.autoKeJi,this.hejiCheck.selected)},t.prototype.showView=function(){this.popup()},t.prototype.hideView=function(){},t.prototype.destroyView=function(){n.E.ins.off(i.EventName.SWITCH_STATUS_CHANGED,this,this.soundStatusHander),this.destroy(!0)},t.prototype.onClosed=function(t){void 0===t&&(t=null)},t}(ui.setting.SettingDlgUI);e.Setting=h;var c=function(){function t(t,e){this._isOpened=!1,this.imgOpened=t,this.imgClosed=e,this.imgClosed.on(Laya.Event.CLICK,this,this.changeStatusHander),this.imgOpened.on(Laya.Event.CLICK,this,this.changeStatusHander)}return t.prototype.changeStatusHander=function(t){t.currentTarget==this.imgOpened?this.setStatus(!1):this.setStatus(!0)},t.prototype.isOpened=function(){return this._isOpened},t.prototype.setStatus=function(t,e){void 0===e&&(e=!0),this._isOpened==t&&0!=e||(this._isOpened=t,this.imgOpened.visible=this._isOpened,this.imgClosed.visible=!this.imgOpened.visible,e&&n.E.ins.event(i.EventName.SWITCH_STATUS_CHANGED,this))},t}()}),define("src/g/setting/ctrl/SettingCtrl",["require","exports","src/g/base/BaseCtrl","../../../core/E","../../../enum/EventName","src/g/setting/view/Setting","src/g/setting/vo/SettingInfo","../../../enum/SettingEnum","src/g/fight/osprite/play/PlayManager"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.otherPlayerKeyValue=1,t.monsterKeyValue=2,t.npcKeyValue=4,t._hideSet1=0,t._hideSet2=0,t.init(),t.initSetting(),t}return __extends(t,e),t.getInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.init=function(){this.url="res/atlas/res/setting.json",n.E.ins.on(s.EventName.OPEN_SETTING,this,this.openView)},t.prototype.initSetting=function(){this.onlyOneRole(a.SettingInfo.getSettingValue(r.SettingEnum.onlyOnRole)),this.hideOtherPlayer(a.SettingInfo.getSettingValue(r.SettingEnum.hideOtherPlayer))},t.prototype.openView=function(){this.open()},t.prototype.updateHideSetting=function(){this._hideSet1&this.otherPlayerKeyValue||this._hideSet2&this.otherPlayerKeyValue?l.PlayManager.ins.otherPlayerVisible(!1):l.PlayManager.ins.otherPlayerVisible(!0),this._hideSet1&this.monsterKeyValue||this._hideSet2&this.monsterKeyValue?l.PlayManager.ins.monsterVisible(!1):l.PlayManager.ins.monsterVisible(!0),this._hideSet1&this.npcKeyValue||this._hideSet2&this.npcKeyValue?l.PlayManager.ins.npcVisible(!1):l.PlayManager.ins.npcVisible(!0)},t.prototype.onlyOneRoleHander=function(){a.SettingInfo.setSettingValue(r.SettingEnum.onlyOnRole,this._view.roleCheck.selected),this.onlyOneRole(this._view.roleCheck.selected)},t.prototype.onlyOneRole=function(t){this._hideSet1=t?this.otherPlayerKeyValue|this.monsterKeyValue|this.npcKeyValue:0,this.updateHideSetting()},t.prototype.hideOtherPlayer=function(t){this._hideSet2=t?this.otherPlayerKeyValue|this.monsterKeyValue:0,this.updateHideSetting()},t.prototype.onAtlasLoaded=function(){null==this._view&&(this._view=new o.Setting,this.updPlayerCheckStatus(),this._view.roleCheck.on(Laya.Event.CHANGE,this,this.onlyOneRoleHander),this._view.playerCheck.on(Laya.Event.CHANGE,this,this.hideOtherOnClick)),null==this._view.closeHandler&&(this._view.closeHandler=Laya.Handler.create(this,this.distoryView)),this._view.showView()},t.prototype.updPlayerCheckStatus=function(){this._view&&(this._view.playerCheck.selected=a.SettingInfo.getSettingValue(r.SettingEnum.hideOtherPlayer))},t.prototype.hideOtherOnClick=function(){this.hideOtherPlayerHander(this._view.playerCheck.selected)},t.prototype.hideOtherPlayerHander=function(t){a.SettingInfo.setSettingValue(r.SettingEnum.hideOtherPlayer,t),this.hideOtherPlayer(t),n.E.ins.event(s.EventName.OTHER_PLAYER_STATUS_CHANGED)},t.prototype.hideOtehrPlayer=function(t){a.SettingInfo.getSettingValue(r.SettingEnum.hideOtherPlayer)!=t&&(this.hideOtherPlayerHander(t),this.updPlayerCheckStatus())},t.prototype.distoryView=function(){null!=this._view&&(this._view.roleCheck.off(Laya.Event.CHANGE,this,this.onlyOneRoleHander),this._view.playerCheck.off(Laya.Event.CHANGE,this,this.hideOtherOnClick),this._view.closeHandler.clear(),this._view.closeHandler=null,this._view.destroyView(),this._view=null,this.clearCtrlRes())},t._instance=null,t}(i.BaseCtrl);e.SettingCtrl=h}),define("src/g/forge_new/view/ZhanWenPage",["require","exports","src/g/Effects/UIEffectsFactory","src/g/clearRes/ClearResM"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.ani_put=null,t.ani_upLv=null,t.ani_reslove=null,t.loadAni(),n.ClearResM.addBgUrl(t.bgimg.skin),t}return __extends(t,e),t.prototype.loadAni=function(){this.ani_put=i.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_putOn,40),this.ani_put.visible=!1,this.ani_upLv=i.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_upLv,40),this.ani_upLv.visible=!1,this.ani_reslove=i.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.aniSp,42,1.2,.8),this.ani_reslove.visible=!1},t.prototype.showView=function(){n.ClearResM.resetViewImg(this)},t.prototype.refreshData=function(){},t.prototype.playUpStateAni=function(t){var e=this["item_"+t];i.UIEffectsFactory.Ins.playAniOnce(67,e.sp)},t.prototype.stopAni=function(t){this["item_"+t].sp.removeChildren()},t}(ui.forge_new.page.ZhanWenUI);e.ZhanWenPage=s}),define("src/g/forge_new/view/ZhanWenShowDlg",["require","exports","../../../meta/ZhanWenVo","../../../config/GameConfig","../../../utils/ItemUtils","src/g/forge_new/view/ZhanWenTips"],function(t,e,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.init=function(){this.addEvent();for(var t=[],e=parseInt(o.GameConfig.commonJson.zhanwenbag.value.split(",")[0]),i=parseInt(o.GameConfig.commonJson.zhanwenbag.value.split(",")[1]),n=e;n<=i;n++)t.push(n);this.list_.dataSource=t},t.prototype.addEvent=function(){this.view_bg.btn_close.on(Laya.Event.CLICK,this,this.onClose),this.view_bg.btn_back.on(Laya.Event.CLICK,this,this.onClose),this.list_.renderHandler=new Laya.Handler(this,this.renderHandler)},t.prototype.renderHandler=function(t,e){var i=t.dataSource,n=a.ItemUtils.getItemVoById(i);n&&(t.setName(n.name+" Lv.1"),t.setQulity(a.ItemUtils.getQualitybjByQualityId(n.quality),a.ItemUtils.getColorByQuality(n.quality)),t.setIcon(a.ItemUtils.getIconByIconId(n.icon)),t.offAll(),t.on(Laya.Event.CLICK,this,function(){var t=s.ZhanWenStruct.Ins.getZhanWenVo(n.quality,1),e=new r.ZhanWenTips;e.initData(t,n.id),e.popup()}))},t.prototype.onClose=function(){this.list_.renderHandler=null,this.close()},t}(ui.forge_new.page.ZhanWenShowDlgUI);e.ZhanWenShowDlg=i}),define("src/init/GameEventDispatcher",["require","exports","../component/NumberEventDispatcher","../config/GameConfig","../utils/SoundUtils"],function(t,e,i,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,s=function(s){function t(){return null!==s&&s.apply(this,arguments)||this}return __extends(t,s),Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t),this._ins},enumerable:!0,configurable:!0}),t.prototype.event=function(t,e){void 0===e&&(e=null);var i=parseInt(t),n=o.GameConfig.gameEventVoCfg[i];return n&&0<n.sound&&a.SoundUtils.getInstance().playSoundById(n.sound),s.prototype.event.call(this,t,e)},t}(i.NumberEventDispatcher);e.GE=s,(n=e.enumGameEvent||(e.enumGameEvent={}))[n.ACTIVITY_GET=1]="ACTIVITY_GET",n[n.XUNBAO_ONE_SUCCESS=2]="XUNBAO_ONE_SUCCESS",n[n.XUNBAO_TEN_SUCCESS=3]="XUNBAO_TEN_SUCCESS",n[n.ITEM_BOX_USE=4]="ITEM_BOX_USE",n[n.HUNSHI_CHANGED=5]="HUNSHI_CHANGED",n[n.FUWEN_CHANGED=6]="FUWEN_CHANGED",n[n.EQUIP_CHANGED=7]="EQUIP_CHANGED",n[n.ZHUANGSHENG_SUCCESS=8]="ZHUANGSHENG_SUCCESS",n[n.pop_access_open_view=9]="pop_access_open_view",n[n.helper_get_reward=10]="helper_get_reward",n[n.sign_success=11]="sign_success",n[n.daily_task_get_box_reward=12]="daily_task_get_box_reward",n[n.get_zhuansheng_reward=13]="get_zhuansheng_reward",n[n.shengwu_activate=14]="shengwu_activate",n[n.mineing_start=15]="mineing_start"}),define("src/g/forge_new/view/ZhanWenSuitAttrDlg",["require","exports","../../../config/GameConfig","../../../utils/ItemUtils"],function(t,e,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(n){function t(){for(var t,e=n.call(this)||this,i=0;i<9;)(t=e["lab_buff"+i])&&(t.style.color="#c0b4a3",t.style.font="SimHei",t.style.fontSize=16,t.style.stroke=1,t.style.strokeColor="#000000"),i++;return e}return __extends(t,n),t.prototype.initData=function(t){for(var e,i,n=t.zhanwenWeiArr.length,s=0,o=0,a=[0,0,0,0,0,0,0,0],r=0,l=1;l<=7;l++){for(r=s=0;s<n;)1<(o=t.zhanwenWeiArr[s])&&t.getZhanwenData(o).quality>=l&&r++,s++;a[l]=r}var h,c=0,u=0,p=0;for(var d in g.GameConfig.skillOpen)(e=g.GameConfig.skillOpen[d])&&9==e.type&&((h=this["lab_buff"+c])&&(u=Math.floor(e.level/10),p=e.level%10,h.color=a[u]<p?"#c0b4a3":"#2ba212",i=v.ItemUtils.getSkillDefItem(e.skillId),h.innerHTML=i.name+":"+i.desc),c++)},t}(ui.forge_new.page.ZhanWenSuitAttrDlgUI);e.ZhanWenSuitAttrDlg=i}),define("src/g/forge_new/ctrl/ZhanWenPageCtrl",["require","exports","src/g/forge_new/view/ZhanWenPage","src/g/forge_new/view/ZhanWenShowDlg","src/g/forge_new/view/ZhanWenChangeDlg","src/g/forge_new/view/ZhanWenSplitDlg","../../../manager/GameSocketManager","../../net/messages/ZhanwenMsg","../../../manager/RoleCenter","../../net/messages/sbkHeroZhanwenData","../../../meta/ZhanWenVo","../../../utils/ItemUtils","../../../enum/EventName","../../../core/E","../../../utils/system/FloatEffect","../../../utils/system/ErrCodeView","../../net/messages/ErrConst","../../../config/GameConfig","../../net/messages/PropFightMain","../../../plugin/sbkPropTool","../../net/messages/sbkFormula","../../../meta/ShuXingVo","../../../plugin/view/ToolTip","../../../utils/UIUtils","../../../manager/GuideCenter","../../../enum/GuideTargetName","src/g/Effects/UIEffectsFactory","src/init/ResManager","src/init/GameEventDispatcher","src/init/TextConst","src/g/forge_new/view/ZhanWenSuitAttrDlg"],function(t,e,i,n,s,o,r,l,f,h,y,m,c,u,p,d,g,_,v,C,I,b,w,S,E,T,A,R,L,x,P){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function a(){this._nowSelectHero=0,this._nowIdx=0;var t=r.GSM.ins;t.on(l.ZhanwenOpenGS2C.KEY,this,this.onZhanwenOpenGS2C),t.on(l.ZhanwenPutOnMsg.KEY,this,this.onZhanwenPutOnMsg),t.on(l.ZhanWenUpgradeMsg.KEY,this,this.onZhanWenUpgradeMsg),t.on(l.ZhanwenSplitMsg.KEY,this,this.onZhanwenSplitMsg),u.E.ins.on(c.EventName.ZHANWEN_SPLITDLGOPEN,this,this.onOpenSplitDlg),u.E.ins.on(c.EventName.CHANGEITEM_COUNT,this,this.onChangeItem),u.E.ins.on(c.EventName.ZHANWEN_ADD,this,this.onZhanWenChange),u.E.ins.on(c.EventName.ZHANWEN_DEL,this,this.onZhanWenChange)}return a.prototype.onZhanWenChange=function(){u.E.ins.event(c.EventName.CHANGECURRENCY,"ZHANWEN"),this.refreshData()},a.prototype.onChangeItem=function(t){if(800==t)return u.E.ins.event(c.EventName.CHANGECURRENCY,"ZHANWEN"),void this.refreshData()},a.prototype.onZhanwenPutOnMsg=function(t){var e=f.RoleCenter.instans.vo,i=f.RoleCenter.instans.vo.getOpenHeroByIdx(t.heroIdx),n=i.zhanwen.replaceZhanwenData(t.idx,e.getZhanWen(t.newId));e.delZhanWen(t.newId),n&&(e.addZhanWen(n),u.E.ins.event(c.EventName.ZHANWEN_BAGCHANGE)),u.E.ins.event(c.EventName.ZHANWEN_PUTON),L.GE.ins.event(6);var s=e.combat;C.sbkPropTool.resetZhanWen(i),C.sbkPropTool.reSetAllEquip(i),e.reCheckComBat(),f.RoleCenter.instans.event(c.EventName.FIGHT_UP,e.combat-s),u.E.ins.event(c.EventName.CHANGECURRENCY,"ZHANWEN"),this._view.displayedInStage&&(this.refreshData(),this.playItemAniByPos(t.idx))},a.prototype.onZhanwenOpenGS2C=function(t){for(var e=0;e<t.count;e++)h.sbkHeroZhanwenData.zhanwenWeiOpen(f.RoleCenter.instans.vo._vo);u.E.ins.event(c.EventName.CHANGECURRENCY,"ZHANWEN"),this.refreshData()},a.prototype.onZhanWenUpgradeMsg=function(t){var e=f.RoleCenter.instans.vo,i=f.RoleCenter.instans.vo.getOpenHeroByIdx(t.heroIdx),n=i.zhanwen.getZhanwenData(t.curId),s=y.ZhanWenStruct.Ins.getZhanWenVo(n.quality,t.curLv);this._view.playUpStateAni(i.zhanwen.zhanwenWeiArr.indexOf(t.curId)),n.lv=t.curLv,e.chgItemCount(800,-s.cost),u.E.ins.event(c.EventName.ZHANWEN_UPLV),C.sbkPropTool.resetZhanWen(i),C.sbkPropTool.reSetAllEquip(i);var o=e.combat;e.reCheckComBat(),f.RoleCenter.instans.event(c.EventName.FIGHT_UP,e.combat-o),A.UIEffectsFactory.Ins.playAniOnce(11,this._view.ani,1.3,1.3),u.E.ins.event(c.EventName.CHANGECURRENCY,"ZHANWEN"),this._view.displayedInStage&&this.refreshData()},a.prototype.onZhanwenSplitMsg=function(t){for(var e=f.RoleCenter.instans.vo,i=0;i<t.idArr.length;i++){var n=e.getZhanWen(t.idArr[i]);if(n){var s=y.ZhanWenStruct.Ins.getZhanWenVo(n.quality,n.lv);e.chgItemCount(800,s.fj);var o=m.ItemUtils.getItemVoById(800);p.FE.getFloat(o.name+"x"+s.fj,m.ItemUtils.getColorByQuality(o.quality)),e.delZhanWen(t.idArr[i])}}u.E.ins.event(c.EventName.CHANGECURRENCY,"ZHANWEN"),u.E.ins.event(c.EventName.ZHANWEN_SPLIT),u.E.ins.event(c.EventName.ZHANWEN_BAGCHANGE),this._view.displayedInStage&&this.refreshData(),0<a.ZWSplitArr.length&&a.sendSplitMsg()},a.sendSplitMsg=function(){for(var t=[],e=0;e<a.ZWSplitArr.length&&16!=e;e++)t.push(a.ZWSplitArr.pop());var i=new l.ZhanwenSplitMsg;i.idArr=t,r.GSM.sendServer(i)},a.prototype.init=function(){var e=this;this._view=new i.ZhanWenPage,this._view.item_7.img_di.skin="res/forge_new/zhanwen_dikuang002.png",this.addEvent(),Laya.timer.frameOnce(2,this,function(){var t=S.UIUtils.getGlobalBound(e._view.btn_putOn);t&&E.GuideCenter.ins.registerInteractionArea(T.GuideTargetName.FUWEN_BTN_PUTON,t)})},a.prototype.addEvent=function(){this._view.btn_change.on(Laya.Event.CLICK,this,this.onShowChange,[!1]),this._view.btn_putOn.on(Laya.Event.CLICK,this,this.onShowChange,[!0]),this._view.btn_upLv.on(Laya.Event.CLICK,this,this.onUpLvClick),this._view.item_cost.setJump(x.TextConst.get(814),new Laya.Handler(this,this.onShowSplit)),this._view.item_0.on(Laya.Event.CLICK,this,this.changeItem,[this._view.item_0.name]),this._view.item_1.on(Laya.Event.CLICK,this,this.changeItem,[this._view.item_1.name]),this._view.item_2.on(Laya.Event.CLICK,this,this.changeItem,[this._view.item_2.name]),this._view.item_3.on(Laya.Event.CLICK,this,this.changeItem,[this._view.item_3.name]),this._view.item_4.on(Laya.Event.CLICK,this,this.changeItem,[this._view.item_4.name]),this._view.item_5.on(Laya.Event.CLICK,this,this.changeItem,[this._view.item_5.name]),this._view.item_6.on(Laya.Event.CLICK,this,this.changeItem,[this._view.item_6.name]),this._view.item_7.on(Laya.Event.CLICK,this,this.changeItem,[this._view.item_7.name]),this._view.btn_suit_attr.on(Laya.Event.CLICK,this,this.onShowSuitAttr)},a.prototype.onShowSuitAttr=function(){this._suitDlg||(this._suitDlg=new P.ZhanWenSuitAttrDlg),this._suitDlg.initData(this._hero.zhanwen),this._suitDlg.isPopup||this._suitDlg.popup()},a.prototype.onUpLvClick=function(){if(this._vo){var t=y.ZhanWenStruct.Ins.getZhanWenVo(this._vo.quality,this._vo.lv),e=f.RoleCenter.instans.vo.bagdata.getItemCount(800);if(_.GameConfig.commonJson["zhanwenmax"+(t.quality-1)]<=t.lv)p.FE.upItems(x.TextConst.get(710),w.BubbleEnum.center);else if(e<t.cost)d.ErrCodeView.show(g.enumErrConst.code_2208);else{var i=new l.ZhanWenUpgradeMsg;i.heroIdx=this._nowSelectHero,i.idx=this._nowIdx,i.curId=this._data.zhanwenWeiArr[this._nowIdx],i.curLv=this._data.getZhanwenData(i.curId).lv,r.GSM.sendServer(i)}}},a.prototype.checkneed=function(){if(this._vo){var t=y.ZhanWenStruct.Ins.getZhanWenVo(this._vo.quality,this._vo.lv+1),e=m.ItemUtils.getItemVoById(800),i=f.RoleCenter.instans.vo.bagdata.getItemCount(e.id);t?(this._view.ani_upLv.visible=i>=t.cost,this._view.item_cost.setNeed(i,t.cost)):(this._view.item_cost.visible=!1,this._view.ani_upLv.visible=!1,this._view.item_cost.setNeed(0,0,!0,!0)),this._view.item_cost.setQualColor(m.ItemUtils.getColorByQuality(e.quality)),this._view.item_cost.setNeedName(e.name,m.ItemUtils.getSmallIcon(e.icon))}},a.prototype.playItemAniByPos=function(t){A.UIEffectsFactory.Ins.playAniOnce(3,this._view["item_"+t].sp)},a.prototype.changeItem=function(t,e){void 0===e&&(e=!0);for(var i=0;i<8;i++)this._view["item_"+i].setSelect(t==i);this._view.ani_upLv.visible=this._view["item_"+t].img_red.visible,this._nowIdx=parseInt(t+""),this._vo=this._data.getZhanwenData(this._data.zhanwenWeiArr[this._nowIdx]),this.renderViewAttr(),this.checkneed();var n=this._hero.zhanwen,s=f.RoleCenter.instans.vo.bagdata,o=[],a=[];if(1==this._data.zhanwenWeiArr[this._nowIdx]){e&&this.onShowChange(!0);for(var r=0;r<n.zhanwenWeiArr.length;r++)if(1<n.zhanwenWeiArr[r]){var l=n.getZhanwenData(n.zhanwenWeiArr[r]);o.push(l.zhuanwentype),a.push(l.quality)}this._view.ani_put.visible=!1;for(var h=0;h<s.zhanwenData.length;h++)if(o.indexOf(s.zhanwenData[h].zhuanwentype)<0){this._view.ani_put.visible=!0;break}}else if(1<this._data.zhanwenWeiArr[this._nowIdx]){for(r=0;r<n.zhanwenWeiArr.length;r++)if(1<n.zhanwenWeiArr[r]){var c=n.getZhanwenData(n.zhanwenWeiArr[r]);o.push(c.zhuanwentype),a.push(c.quality)}this._view.red_change.visible=!1;for(l=n.getZhanwenData(n.zhanwenWeiArr[this._nowIdx]),h=0;h<s.zhanwenData.length;h++)if(s.zhanwenData[h].quality>l.quality){if(o.indexOf(s.zhanwenData[h].zhuanwentype)<0){this._view.red_change.visible=!0;break}if(l.zhuanwentype==s.zhanwenData[h].zhuanwentype){this._view.red_change.visible=!0;break}}}this._view.ani_reslove.visible=this.checkZhanwenResloveByHero(this._nowSelectHero)&&this._view.item_cost.visible},a.prototype.checkZhanwenResloveByHero=function(t){for(var e=f.RoleCenter.instans.vo,i=e.getOpenHeroByIdx(t).zhanwen,n=(e.bagdata,[]),s=[],o=0;o<i.zhanwenWeiArr.length;o++)if(1<i.zhanwenWeiArr[o]){var a=i.getZhanwenData(i.zhanwenWeiArr[o]);n.push(a.zhuanwentype),s.push(a.quality)}if(n.length<i.zhanwenWeiArr.length)return!1;for(var r=0;r<e.bagdata.zhanwenData.length;r++){o=e.bagdata.zhanwenData[r],n.indexOf(o.zhuanwentype);if(o&&2==o.quality)return!0}},a.prototype.renderViewAttr=function(t){void 0===t&&(t=!0),this._vo||(t=!1);var e=null!=this._data.zhanwenWeiArr[this._nowIdx]&&0<this._data.zhanwenWeiArr[this._nowIdx];if(this._view.btn_putOn.visible=!t&&e,this._view.btn_change.visible=t,this._view.img_zhanwen.visible=t,this._view.zhanwen_name.visible=t,this._view.box_nextAttr.visible=t,this._view.box_nowAttr.visible=t,this._view.box_img.visible=t,this._view.item_cost.visible=t,this._view.showView(),(this._view.btn_upLv.visible=t)&&this._vo){var i=m.ItemUtils.getItemVoById(this._vo.cfgId),n=y.ZhanWenStruct.Ins.getZhanWenVoByIvo(this._vo.zhuanwentype,this._vo.quality,this._vo.lv);this._view.img_zhanwen.skin=m.ItemUtils.getIconByIconId(i.icon),this._view.zhanwen_name.text=i.name+" Lv."+this._vo.lv,this._view.zhanwen_name.color=m.ItemUtils.getColorByQuality(this._vo.quality);for(var s=0;s<n.attr.length;s++){var o=m.ItemUtils.getShuXingByName(n.attr[s][0]);this.addAttrDes(o.desc,b.ShuXingVo.getString4Vo(n.attr[s][1],o),!0,0==s)}var a=y.ZhanWenStruct.Ins.getZhanWenVoByIvo(this._vo.zhuanwentype,this._vo.quality,this._vo.lv+1);for(s=0;s<n.attr.length;s++)if(a){o=m.ItemUtils.getShuXingByName(a.attr[s][0]);this.addAttrDes(o.desc,b.ShuXingVo.getString4Vo(a.attr[s][1],o),!1,0==s)}else this.addAttrDes(x.TextConst.get(208),"",!1,0==s)}},a.prototype.addAttrDes=function(t,e,i,n){void 0===n&&(n=!1);var s=i?this._view.box_nowAttr:this._view.box_nextAttr;n&&(s.removeChildren(),s.height=0);var o=new Laya.Box,a=new Laya.HTMLDivElement;a.style.font="SimHei",a.style.fontSize=16,a.style.height=20,o.height=20,s.height+=20,a.innerHTML="<span color='#c0b4a3'>"+t+"</span><span color='#349320'>&nbsp;&nbsp;"+(0<e.length?"+":"")+e+"</span>",o.addChild(a),s.addChild(o),n&&(this._view.box_img.removeChildren(),this._view.box_img.height=0);var r=new Laya.Image("res/custom/duanzao_shuxingjiantou.png");r.width=31,r.height=20,this._view.box_img.height+=20,this._view.box_img.addChild(r)},a.prototype.renderZhanWenItem=function(){for(var t=this._hero.zhanwen,e=f.RoleCenter.instans.vo.bagdata,i=[],n=[],s=[],o=0;o<t.zhanwenWeiArr.length;o++)if(1<t.zhanwenWeiArr[o]){var a=t.getZhanwenData(t.zhanwenWeiArr[o]);i.push(a.zhuanwentype),n.push(a.quality)}else 1==t.zhanwenWeiArr[o]&&s.push(o);for(var r=0<s.length,l=0;l<8;l++){var h=this._view["item_"+l];if(h.setQulity(m.ItemUtils.getQualitybjByQualityId(1),""),h.img_red.visible=!1,this._data.zhanwenWeiArr[l]){if(h.img_lock.visible=!1,h.img_jiahao.visible=!0,this._view["line_"+(l-1)]&&(this._view["line_"+(l-1)].visible=!0),1!=this._data.zhanwenWeiArr[l]){if(1<this._data.zhanwenWeiArr[l])for(a=t.getZhanwenData(t.zhanwenWeiArr[l]),g=0;g<e.zhanwenData.length;g++)if(e.zhanwenData[g].quality>a.quality){if(i.indexOf(e.zhanwenData[g].zhuanwentype)<0){h.img_red.visible=!0;break}if(a.zhuanwentype==e.zhanwenData[g].zhuanwentype){h.img_red.visible=!0;break}}var c=this._hero.zhanwen.getZhanwenData(this._data.zhanwenWeiArr[l]);if(c){var u=e.getItemCount(800),p=y.ZhanWenStruct.Ins.getZhanWenVoByIvo(c.zhuanwentype,c.quality,c.lv+1);h.img_red.visible=p&&u>=p.cost||h.img_red.visible;var d=m.ItemUtils.getItemVoById(c.cfgId);h.setName(d.name+" Lv."+c.lv),h.setIcon(m.ItemUtils.getIconByIconId(d.icon)),h.setQulity(m.ItemUtils.getColorByQuality(d.quality)),4<=d.quality?A.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(h.ani_qual,4==d.quality?138:5==d.quality?139:140):h.ani_qual.removeChildren()}}else if(h.ani_qual.removeChildren(),h.setName(""),h.setIcon(""),h.img_red.visible=!1,r)for(var g=0;g<e.zhanwenData.length;g++)if(i.indexOf(e.zhanwenData[g].zhuanwentype)<0){h.img_red.visible=!0;break}}else{h.ani_qual.removeChildren(),h.img_lock.visible=!0,h.img_jiahao.visible=!1;var v=_.GameConfig.fuwenTrough[l];v&&(this._data.zhanwenWeiArr[l-1]||0==l?(h.setName(v.channel),h.setQulity("#09d51f")):(h.setName(x.TextConst.get(347)),h.setQulity(m.ItemUtils.getColorByQuality(1)))),this._view["line_"+(l-1)]&&(this._view["line_"+(l-1)].visible=!1),h.img_red.visible=!1}}},a.prototype.onShowChange=function(t){void 0===t&&(t=!1),u.E.ins.event(c.EventName.COMPTYPE_CLICK,T.GuideTargetName.FUWEN_BTN_PUTON);var e=new s.ZhanWenChangeDlg;e.initData([this._nowSelectHero,this._nowIdx,t]),e.popup()},a.prototype.onShowSplit=function(){0<a.ZWSplitArr.length&&p.FE.upItems(x.TextConst.get(815),w.BubbleEnum.center),u.E.ins.event(c.EventName.ZHANWEN_SPLITDLGOPEN)},a.prototype.onOpenSplitDlg=function(){var t=new o.ZhanWenSplicDlg;t.initData(),t.showView()},a.prototype.onOverView=function(){(new n.ZhanWenShowDlg).popup()},a.prototype.showPage=function(t,e){this._view||this.init(),t.removeChildren(),t.addChild(this._view),this.changePerson(e),this._view.showView(),null!=this._view.parent&&this.refreshData()},a.prototype.changePerson=function(t,e){void 0===t&&(t=0),this._nowSelectHero=t,this._hero=f.RoleCenter.instans.vo.getOpenHeroByIdx(t),this._data=this._hero.zhanwen,this.refreshData()},a.prototype.refreshFightNum=function(){for(var t=new v.PropZhanwen,e=0,i=0;i<this._hero.zhanwen.zhanwenArr.length;i++)for(var n=this._hero.zhanwen.zhanwenArr[i],s=y.ZhanWenStruct.Ins.getZhanWenVoByIvo(n.zhuanwentype,n.quality,n.lv),o=0;o<s.attr.length;o++)t[s.attr[o][0]]+=s.attr[o][1];for(i=0;i<8;i++){var a=this._hero.getPos(i),r=this._hero.getEquipPos_MILTI(a.equpos,1)/I.sbkFormula.BASEDIV_VAL;t.HP+=(a.equins.HP||0)*r,t.ATT+=(a.equins.ATT||0)*r,t.PDEF+=(a.equins.PDEF||0)*r,t.SDEF+=(a.equins.SDEF||0)*r}var l=new v.PropZhanwenSkill,h=C.sbkPropTool.calZhanWenSuitCombat(this._hero.zhanwen,l);e=I.sbkFormula.calCombat(0,t.HP,t.ATT,t.PDEF,t.SDEF,0,0,0,0,0,0,0,l.INCHURT,l.DECHURT,0,t.FIXEDATT,0,t.FIXEDEF,0,0,0,0,0,0,0,0,0,0,0),e+=h,this._view.fightbox.num_Fight.value=e+""},a.prototype.refreshData=function(){if(this._view){if(!this._view.displayedInStage)return;this.renderZhanWenItem(),this.changeItem(this._nowIdx,!1),this.refreshFightNum()}},a.prototype.getTitle=function(){return"res/title/title_zhanwen.png"},a.prototype.hidePage=function(){R.ResManager.getInstance().hidePageCtrl(this)},a.prototype.destroyPage=function(){R.ResManager.getInstance().destroyPageCtrl(this)},a.ZWSplitArr=[],a}();e.ZhanWenPageCtrl=a}),define("src/g/forge_new/view/ZhanWenSplitDlg",["require","exports","../../../manager/RoleCenter","../../../meta/ZhanWenVo","../../../utils/ItemUtils","../../../meta/ShuXingVo","../../../core/E","../../../enum/EventName","src/g/forge_new/ctrl/ZhanWenPageCtrl","src/g/forge_new/view/ZhanWenChangeDlg","src/init/TextConst"],function(t,e,r,l,h,o,i,n,s,c,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t.arr=[],t.initView(),t}return __extends(t,e),t.prototype.initView=function(){this.addEvent()},t.prototype.addEvent=function(){this.view_bg.btn_close.on(Laya.Event.CLICK,this,this.onClose),this.view_bg.btn_back.on(Laya.Event.CLICK,this,this.onClose),this.list_.renderHandler=new Laya.Handler(this,this.listRenderHander),this.check_2.on(Laya.Event.CLICK,this,this.onSelectQual,[this.check_2.name]),this.check_3.on(Laya.Event.CLICK,this,this.onSelectQual,[this.check_3.name]),this.check_4.on(Laya.Event.CLICK,this,this.onSelectQual,[this.check_4.name]),this.check_5.on(Laya.Event.CLICK,this,this.onSelectQual,[this.check_5.name]),this.check_6.on(Laya.Event.CLICK,this,this.onSelectQual,[this.check_6.name]),this.btn_split.on(Laya.Event.CLICK,this,this.onSplit),i.E.ins.on(n.EventName.ZHANWEN_SPLIT,this,this.initData)},t.prototype.onSplit=function(){for(var t=this.list_.dataSource,e=0;e<t.length;e++)t[e].selected&&s.ZhanWenPageCtrl.ZWSplitArr.push(t[e].bagId);s.ZhanWenPageCtrl.sendSplitMsg()},t.prototype.showView=function(){if(0==utils.LocalUtil.getFuWenSplicSelect().length)this.check_2.selected=!0,this.onSelectQual(2);else{this.arr=utils.LocalUtil.getFuWenSplicSelect();for(var t=0;t<5;t++)this["check_"+(t+2)].selected=this.arr[t],1==this["check_"+(t+2)].selected&&this.onSelectQual(t+2)}this.popup()},t.prototype.initData=function(){for(var t=[],e=r.RoleCenter.instans.vo.bagdata,i=e.zhanwenData.length,n=0;n<i;n++){var s=h.ItemUtils.getItemVoById(e.zhanwenData[n].cfgId),o=l.ZhanWenStruct.Ins.getZhanWenVoByIvo(s.effect[0][1],s.quality,e.zhanwenData[n].lv),a=new c.changeItemVo;a.ivo=s,a.zvo=o,a.selected=!1,a.bagId=e.zhanwenData[n].id,t.push(a)}t.sort(this.sortbyLv),t.sort(this.sortbyQual),this.list_.dataSource=t,this.checkGet()},t.prototype.sortbyQual=function(t,e){return e.ivo.quality-t.ivo.quality},t.prototype.sortbyLv=function(t,e){return e.zvo.lv-t.zvo.lv},t.prototype.listRenderHander=function(t,e){var i=t.dataSource;t.setName(i.ivo.name+" Lv."+i.zvo.lv),t.setQuality(h.ItemUtils.getColorByQuality(i.ivo.quality)),t.setIcon(h.ItemUtils.getIconByIconId(i.ivo.icon)),t.selected=i.selected;for(var n=0;n<i.zvo.attr.length;n++){var s=h.ItemUtils.getShuXingByName(i.zvo.attr[n][0]);t.addAttrDes(s.desc+"+"+o.ShuXingVo.getString4Vo(i.zvo.attr[n][1],s),0==n)}t.btn_check.clickHandler=new Laya.Handler(this,this.changeDataSource,[e])},t.prototype.changeDataSource=function(t){var e=this.list_.getCell(t);e.dataSource.selected=e.btn_check.selected,this.list_.refresh(),this.checkGet()},t.prototype.onSelectQual=function(t){for(var e=0;e<this.list_.dataSource.length;e++)this.list_.dataSource[e].ivo.quality==t&&(this.list_.dataSource[e].selected=this["check_"+t].selected);for(var i=2;i<7;i++)this.arr.push(this["check_"+i].selected);for(var n=[],s=this.arr.length-5;s<this.arr.length;s++)n.push(this.arr[s]);utils.LocalUtil.setFuWenSplicSelect(n),this.list_.refresh(),this.checkGet()},t.prototype.checkGet=function(){for(var t=0,e=0;e<this.list_.dataSource.length;e++)this.list_.dataSource[e].selected&&(t+=this.list_.dataSource[e].zvo.fj);this.lab_debris.text=a.TextConst.get(77,t)},t.prototype.onClose=function(){this.view_bg.btn_close.off(Laya.Event.CLICK,this,this.onClose),this.check_2.off(Laya.Event.CLICK,this,this.onSelectQual),this.check_3.off(Laya.Event.CLICK,this,this.onSelectQual),this.check_4.off(Laya.Event.CLICK,this,this.onSelectQual),this.check_5.off(Laya.Event.CLICK,this,this.onSelectQual),this.check_6.off(Laya.Event.CLICK,this,this.onSelectQual),i.E.ins.off(n.EventName.ZHANWEN_SPLIT,this,this.onClose),this.close()},t}(ui.forge_new.page.ZhanWenSplitDlgUI);e.ZhanWenSplicDlg=u;var p=function(){this.zvo=null,this.ivo=null,this.selected=!1};e.splitItemVo=p}),define("src/g/forge_new/view/ZhanWenChangeDlg",["require","exports","src/g/forge_new/view/ZhanWenSplitDlg","../../../manager/RoleCenter","../../../utils/ItemUtils","../../../meta/ZhanWenVo","../../net/messages/ZhanwenMsg","../../../manager/GameSocketManager","../../../core/E","../../../enum/EventName","../../../meta/ShuXingVo","src/g/itemGets/View/ItemGetDlg","src/init/TextConst"],function(t,e,i,h,c,u,n,s,o,a,p,r,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t._nowIdx=0,t._data=[],t.heroHasArr=[],t.hero=null,t.nPosType=0,t.nPosQual=0,t.isPut=!1,o.E.ins.on(a.EventName.ZHANWEN_PUTON,t,t.onClose),t}return __extends(t,e),t.prototype.initData=function(t){this._data=t,this._nowIdx=t[1],this.isPut=t[2],this.hero=h.RoleCenter.instans.vo.getOpenHeroByIdx(this._data[0]),this.zdata=this.hero.zhanwen,this.getHeroZhanWen(),this.initView()},t.prototype.onGetItem=function(){var t=c.ItemUtils.getItemVoById(204);(new r.ItemGetDlg).initByVo(t,null).popup(),this.onClose()},t.prototype.getHeroZhanWen=function(){for(var t=0;t<this.zdata.zhanwenArr.length;t++)this.zdata.zhanwenArr[t]&&this.heroHasArr.push(this.zdata.zhanwenArr[t].zhuanwentype);var e=this.hero.zhanwen.getZhanwenData(this.zdata.zhanwenWeiArr[this._nowIdx]);this.nPosQual=e?(this.nPosType=e.zhuanwentype,e.quality):this.nPosType=0},t.prototype.initView=function(){this.img_title.skin="res/title/title_zhanwen.png",this.addUIEvent();for(var t=[],e=[],i=h.RoleCenter.instans.vo.bagdata,n=i.zhanwenData.length,s=0;s<n;s++){var o=c.ItemUtils.getItemVoById(i.zhanwenData[s].cfgId),a=u.ZhanWenStruct.Ins.getZhanWenVoByIvo(o.effect[0][1],o.quality,i.zhanwenData[s].lv),r=new g;r.ivo=o,r.zvo=a,r.selected=!1,r.bagId=i.zhanwenData[s].id;var l=this.hero.zhanwen.getZhanwenData(this.zdata.zhanwenWeiArr[this._nowIdx]);r.ivo.effect[0][1]==this.nPosType?r.ivo.quality>this.nPosQual?e.push(r):r.ivo.quality==this.nPosQual&&r.zvo.lv>l.lv?e.push(r):t.push(r):-1<this.heroHasArr.indexOf(r.ivo.effect[0][1])?t.push(r):e.push(r)}t.sort(this.sortbyLv),t.sort(this.sortbyQual);for(s=0;s<t.length;s++)e.push(t[s]);e.sort(this.sortbyLv),e.sort(this.sortbyQual),this.list_.dataSource=e,this.lab_getTip.visible=0<e.length,this.btn_get.visible=!(0<e.length)},t.prototype.sortbyQual=function(t,e){return e.ivo.quality==t.ivo.quality?e.zvo.lv-t.zvo.lv:e.ivo.quality-t.ivo.quality},t.prototype.sortbyLv=function(t,e){return e.zvo.lv-t.zvo.lv},t.prototype.listRenderHandler=function(t,e){var i=t.dataSource;this.isPut&&(t.btn_change.label=d.TextConst.get(491)),t.setName(i.ivo.name+" Lv."+i.zvo.lv),t.setqual(c.ItemUtils.getQualitybjByQualityId(i.ivo.quality),c.ItemUtils.getColorByQuality(i.ivo.quality)),t.setIcon(c.ItemUtils.getIconByIconId(i.ivo.icon));var n=-1<this.heroHasArr.indexOf(i.ivo.effect[0][1]),s=this.hero.zhanwen.getZhanwenData(this.zdata.zhanwenWeiArr[this._nowIdx]);i.ivo.effect[0][1]==this.nPosType?i.ivo.quality>this.nPosQual?(t.btn_change.visible=!0,t.lan_type.text="",t.img_type.visible=!1):i.ivo.quality==this.nPosQual&&i.zvo.lv>s.lv?(t.btn_change.visible=!0,t.lan_type.text=""):(t.lan_type.text=d.TextConst.get(492),t.img_type.visible=!0,t.btn_change.visible=!1):t.btn_change.visible=n?(t.lan_type.text=d.TextConst.get(492),!(t.img_type.visible=!0)):(t.img_type.visible=!1,!(t.lan_type.text="")),t.setItemData(i);for(var o=i.zvo.attr,a=0;a<o.length;a++){var r,l=c.ItemUtils.getShuXingByName(o[a][0]);r=l.desc+" +"+p.ShuXingVo.getString4Vo(o[a][1],l),t.addAttr(r,0==a)}t.setClickCallBack(new Laya.Handler(this,this.onChange))},t.prototype.onChange=function(t){var e=new n.ZhanwenPutOnMsg;e.heroIdx=this._data[0],e.idx=this._nowIdx,e.curId=this.zdata.zhanwenWeiArr[this._nowIdx],e.newId=t.bagId,s.GSM.sendServer(e)},t.prototype.addUIEvent=function(){this.view_bg.btn_back.on(Laya.Event.CLICK,this,this.onClose),this.view_bg.btn_close.on(Laya.Event.CLICK,this,this.onClose),this.btn_get.on(Laya.Event.CLICK,this,this.onGetItem),this.list_.renderHandler=new Laya.Handler(this,this.listRenderHandler),this.on(Laya.Event.REMOVED,this,this.removeEvent)},t.prototype.removeEvent=function(){this.off(Laya.Event.REMOVED,this,this.removeEvent),this.view_bg.btn_back.off(Laya.Event.CLICK,this,this.onClose),this.view_bg.btn_close.off(Laya.Event.CLICK,this,this.onClose),o.E.ins.off(a.EventName.ZHANWEN_PUTON,this,this.onClose)},t.prototype.onClose=function(){this.removeEvent(),this.close()},t}(ui.forge_new.page.ZhanWenChangeUI);e.ZhanWenChangeDlg=l;var g=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(i.splitItemVo);e.changeItemVo=g}),define("src/g/hotblood/view/HotBloodPortItem2",["require","exports","src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager","../../../utils/system/ServerTime","../../../utils/system/DateUitl","src/init/TextConst"],function(t,e,n,s,o,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(){var t=this.dataSource;this.text_bossName.text=t.bossName,t.stateKey?(this.stopCD(),this.text_state.color="#09d51f",this.text_state.text=i.TextConst.get(344)):(this.text_state.color="#ffd409",this.startCD())},t.prototype.startCD=function(){Laya.timer.loop(1e3,this,this.updCd),this.updCd()},t.prototype.updCd=function(){if(this.dataSource){var t=n.HotBloodWarManager.getInstance().getBossVoByPortId(this.dataSource.portId),e=n.HotBloodWarManager.getInstance().getPortStatus(t.port),i=e.lastDieTime+e.bossCD-s.ServerTime.serverTime;i<=0?this.stopCD():this.text_state.text=o.DateUtil.getHMS_countdown(i)}},t.prototype.stopCD=function(){Laya.timer.clear(this,this.updCd)},t.prototype.destroy=function(t){this.stopCD(),e.prototype.destroy.call(this,t)},t}(ui.hotblood.HotBloodBossInfoItemUI);e.HotBloodPortItem2=a}),define("src/g/hotblood/view/HotBloodTotalInfoView",["require","exports","src/g/fight/osprite/GameScene","../../../config/GameConfig","src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager","../../../manager/LayerManager","../../net/messages/BloodyBattleMsg","../../../utils/ItemUtils","src/g/hotblood/view/HotBloodPortItem2"],function(t,e,l,h,c,n,u,p,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t._smallMap=null,t._smallMapSprite=new Laya.Sprite,t._bossSprite=new Laya.Sprite,t._image=null,t._monsterList=[],t.width=Laya.stage.width,t.mouseThrough=!0,t.initList(t.bossInfoList,t.onRenderHandler,s.HotBloodPortItem2),t.bossInfoList.selectEnable=!0,t.bossInfoList.selectHandler=new Laya.Handler(t,t.onSelectHandler),t.updateListInfo(),t._image=new Laya.Image("res/hotblood/rxzc_wanjiaweizhi.png"),t._image.on(Laya.Event.LOADED,t,t.onRoleImage),t._smallMapSprite.addChild(t._image);for(var e=0;e<5;e++)t._monsterList[e]=new Laya.Image("res/hotblood/rxzc_hongdian01.png"),t._bossSprite.addChild(t._monsterList[e]);return t}return __extends(t,i),t.prototype.onRoleImage=function(){this._image.x=-this._image.width/2,this._image.y=-this._image.height/2},t.prototype.initList=function(t,e,i){t.selectEnable=!0,t.vScrollBarSkin="",t.itemRender=i,t.scrollBar.elasticDistance=100,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.onRenderHandler=function(t,e){t.update()},t.prototype.onSelectHandler=function(t){if(-1<t&&t<this.bossInfoList.length){var e=this.bossInfoList.array[t];c.HotBloodWarManager.getInstance().gotoBossArea(e.portId),this.bossInfoList.selectedIndex=-1}},t.prototype.updateListInfo=function(){var t=c.HotBloodWarManager.getInstance().getBossInfoDic(),e=null,i=null,n=[],s=null,o=null;for(var a in t)if(e=t[a]){var r=c.HotBloodWarManager.getInstance().getBossVoByPortId(e.portid);e.lastDieTime,e.bossCD;switch(i=new d,n.push(i),s=h.GameConfig.getPortByID(r.port),o=p.ItemUtils.getMonsterVOById(s.boss),i.bossName=o.name,i.portId=r.port,e.bossState){case u.EBattleBossState.WAIT_REVIVE:console.log("等待复活"),i.stateKey=!1;break;case u.EBattleBossState.CAN_CHALLENGE:console.log("可挑战"),i.stateKey=!0;break;case u.EBattleBossState.NULL:console.error("null")}}this.bossInfoList.array=n},t.prototype.show=function(){if(null==this._smallMap){var t="dynamic/map/{0}/small_2.jpg".replace("{0}","404");this._smallMap=new Laya.Image(t),this.mapBox.addChild(this._smallMap),this.mapBox.addChild(this._smallMapSprite),this.mapBox.addChild(this._bossSprite);n.LayerManager.addInUILayer(this)}this.visible=!0,Laya.timer.frameLoop(1,this,this.update)},t.prototype.hide=function(){Laya.timer.clear(this,this.update),this.visible=!1},t.prototype.exit=function(){Laya.timer.clear(this,this.update),this._smallMapSprite&&(this._smallMapSprite.removeSelf(),this._smallMapSprite=null),this._smallMap&&(this._smallMap.removeSelf(),this._smallMap=null)},t.prototype.update=function(){if(c.HotBloodWarManager.getInstance().gamePlay&&this._smallMap){var t=c.HotBloodWarManager.getInstance().gamePlay.getSelfPos(),e=this._smallMap.width*this._smallMap.scaleX,i=this._smallMap.height*this._smallMap.scaleY,n=t[0]/l.GameScene.ins.map.width*e,s=t[1]/l.GameScene.ins.map.height*i;this._smallMapSprite.x=n,this._smallMapSprite.y=s;for(var o=0;o<this._monsterList.length;o++){var a=h.GameConfig.getPortByID(27e3+o+1),r=h.GameConfig.getMapJSON(a.boss_scene);r&&0<r.bossXY.length&&(n=r.bossXY[0][0]/l.GameScene.ins.map.width*e,s=r.bossXY[0][1]/l.GameScene.ins.map.height*i,this._monsterList[o].x=n-9,this._monsterList[o].y=s-9)}}},t}(ui.hotblood.HotBloolSceneViewUI);e.HotBloodTotalInfoView=i;var d=function(){this.stateKey=!1,this.portId=-1};e.HotBloodBossInfoItemData=d}),define("src/g/boss/view/SCFoeHead",["require","exports","../../net/messages/rank/sbkOtherData","../../../utils/ItemUtils","../../../meta/BossVo","../../net/messages/sbkUserData","src/g/Effects/UIEffectsFactory","../../../manager/RoleCenter","src/init/TextConst"],function(t,e,i,a,s,o,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function n(){var t=e.call(this)||this;return t.type=2,t.setType(2),t}return __extends(n,e),n.prototype.reset=function(){this.updStatus(n.NORMAL)},n.prototype.setType=function(t){switch(t){case 0:this.onTypeBoss();break;case 1:this.onTypeGuiShu();break;case 2:this.onTypePlayer()}this.type=t},n.prototype.onTypeBoss=function(){this.winnerContainer.visible=this.normalContainer.visible=!1,this.bossContaner.visible=!0,this.width=140,this.height=93},n.prototype.onTypeGuiShu=function(){this.bossContaner.visible=this.normalContainer.visible=!1,this.winnerContainer.visible=!0,this.width=230,this.height=67},n.prototype.onTypePlayer=function(){this.bossContaner.visible=this.winnerContainer.visible=!1,this.normalContainer.visible=!0,this.width=140,this.height=108},n.prototype.getName=function(){var t=null;return null!=this._data&&(this._data instanceof s.BossVo?t="":this._data instanceof i.sbkOtherData?t=this._data.username:this._data instanceof o.sbkUserData?t=this._data.username:this.dataSource&&(t=this.dataSource.groupID),console.log("返回的名字:"+t)),t},n.prototype.updateBoss=function(t,e){void 0===e&&(e=null),(this._data=t)&&t.port?(this.bosslbName.text=t.name,this.bossimgHead.skin=a.ItemUtils.getBossIconByPort(t.port)):e&&(this.bosslbName.text=e.name,this.bossimgHead.skin=a.ItemUtils.getBossIccon(e.id))},n.prototype.updateWinner=function(t,e,i,n){if(e){var s=(this._data=e).openhero[0];s&&(this.winnerimgHead.skin=a.ItemUtils.getHeadurlYuan(s.sex,s.jobid))}else{var o=(this._data=i).openhero[0];this.winnerimgHead.skin=a.ItemUtils.getHeadurlYuan(o.sex,o.jobid)}this.winnerlbName.text=n},n.prototype.updStatus=function(t){var e,i;switch(this.type){case 0:e=this.bossimgSword,i=this.bossStatusGround;break;case 1:e=this.winnerimgSword,i=this.winnerStatusGround;break;case 2:e=this.imgSword,i=this.statusGround}i.skin=t==n.BE_ATTACK?(e.skin="res/unpack/sc_sword.png","res/unpack/sc_readcircle.png"):e.skin=""},n.prototype.layout=function(t){void 0===t&&(t="left"),this.imgSword.x="left"==t?116:0},n.prototype.update2=function(t){void 0===t&&(t="right"),this._data=this.dataSource;var e=this.dataSource;if(this.layout(t),e){var i=void 0;0<e.getFightCount()&&(i=e.getUnitByIndex(0)),i?(this.imgHead.skin=a.ItemUtils.getHeadurlYuan(i.sex,i.job),this.lbName.text=i.actorName,null!=e.getFamilyName()&&""!=e.getFamilyName()?(this.lbFamily.color=this.familyNameColor(e.getFamilyUid()),this.lbFamily.text=h.TextConst.get(540,e.getFamilyName()),this.lbName.y=67):(this.lbFamily.text="",this.lbName.y=77)):this.reset()}else this.reset()},n.prototype.familyNameColor=function(t){return""==l.RoleCenter.instans.self.ufData.familyUId||t!=l.RoleCenter.instans.self.ufData.familyUId?"#ff0f15":"#016ff9"},n.prototype.updBlood=function(t,e){var i=t/e*108;this.bloodBar.width=108<i?108:i},n.prototype.update=function(t){void 0===t&&(t="left"),this.layout(t),this._data=this.dataSource;var e=this.dataSource;if(e){var i=void 0;if(null!=e.openhero&&0<e.openhero.length&&(i=e.openhero[0]),i){this.imgHead.skin=a.ItemUtils.getHeadurlYuan(i.sex,i.jobid);var n=e.familyName;this.lbName.y=null!=n&&""!=n?(this.lbFamily.color=this.familyNameColor(e.familyUid),this.lbFamily.text=h.TextConst.get(540,n),67):(this.lbFamily.text="",77),this.lbName.text=e.nickname}else this.reset()}else this.reset()},n.prototype.showAttackerEf=function(){null==this.attackerEf&&(this.attackerEf=r.UIEffectsFactory.Ins.createSAniById(118),this.attackerEf.autoPlay=!0,this.attackerEf.x=79,this.attackerEf.y=39,this.attackerEf.mouseEnabled=!1,this.normalContainer.addChildAt(this.attackerEf,this.normalContainer.getChildIndex(this.imgHead)))},n.NORMAL=0,n.ATTACK=1,n.BE_ATTACK=2,n}(ui.boss.BossPlayerHeadUI);e.SCFoeHead=n}),define("src/g/shop/view/ShopItem",["require","exports","../../../manager/AM","../../../config/GameConfig","../../../utils/ItemUtils","../../net/messages/ShopOperationC2GS","../../../manager/GameSocketManager","../../../manager/RoleCenter","../../net/messages/OpResultType","src/init/Switches","src/g/peronboss/view/ItemIconView","../../net/messages/ErrConst","../../../utils/system/ErrCodeView"],function(t,e,i,s,o,n,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.buyID=0,t.btn_buy.on(Laya.Event.CLICK,t,t.buyHandler),t}return __extends(t,e),t.prototype.buyHandler=function(){var t=parseInt(this.cost_txt.text);if(r.RoleCenter.instans.self.GOLD<t)h.Switches.ins.event(155);else if(this._itemvo)if(1e4<this._itemvo.id&&!r.RoleCenter.instans.vo.bagdata.roomEnough(1))i.AM.show(p.ErrCodeView.getErrStr(u.enumErrConst.code_2206),Laya.Handler.create(this,function(){h.Switches.ins.event(71)}));else{var e=new n.ShopOperationC2GS;e.msgidx=l.enumOpResultType.shop1_buy,e.cfgId=this.buyID,a.GSM.sendServer(e)}},t.prototype.setData=function(t){var e=t.id;this.buyID=t.id;var i=s.GameConfig.Shop1JSON[e];if(i){10==i.discost?this.imgZhe.visible=this.lab_num.visible=this.lab.visible=!1:(8==i.discost||i.discost,this.imgZhe.visible=this.lab_num.visible=this.lab.visible=!0,this.lab_num.value=i.discost+"");var n=o.ItemUtils.getItemOrEq(i.itemId[0][0]);this._itemvo=n,this.item_name.text=n.name,c.ItemIconView.setItemData(n,this.item,i.itemId[0][1]),this.cost_txt.text=i.cost[0][1]+"",this.item.lvl.visible=!1}},t}(ui.shop.ShopItemUI);e.ShopItem=d}),define("src/g/shop/view/MysteryStoreView",["require","exports","../../net/messages/ShopOperationC2GS","src/g/shop/view/ShopItem","../../net/messages/OpResultType","../../../manager/GameSocketManager","../../../manager/RoleCenter","../../net/messages/ShopMysteriousGS2C","../../../config/GameConfig","../../../utils/system/FloatEffect","../../../utils/ItemUtils","../../../utils/system/DateUitl","src/init/Switches","src/g/clearRes/ClearResM","src/init/TextConst","../../../core/E","../../../enum/EventName"],function(t,e,i,n,s,o,h,a,c,u,p,r,l,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(e){function t(){var t=e.call(this)||this;return t.countdownTime=0,t._init=!1,t._currCost=200,t.list.itemRender=n.ShopItem,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=50,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t.btn_refresh.on(Laya.Event.CLICK,t,t.btn_refreshHandler),h.RoleCenter.instans.on(s.enumOpResultType.shop1_buy+"",t,t.resultHandler),v.E.ins.on(f.EventName.SHOP_REFRESH_COUNT_CHANGED,t,t.updateCost),t}return __extends(t,e),t.prototype.resultHandler=function(t){var e=t.reservedata,i=c.GameConfig.Shop1JSON[e[0]],n=i.itemId[0][0],s=i.itemId[0][1],o=p.ItemUtils.getItemOrEq(n);u.FE.getUpFloat(o.name+"x"+s,n);for(var a=this.list.array,r=a.length-1;0<=r;r--){var l=a[r];if(l.id==e[0]){a.splice(r,1);break}}n<1e4?h.RoleCenter.instans.vo.chgItemCount(n,s):h.RoleCenter.instans.vo.addEquipIns(l.equipArr[0]),h.RoleCenter.instans.vo.SHOPEXP=e[1],this.list.refresh(),h.RoleCenter.instans.vo.GOLD-=i.cost[0][1]},t.prototype.btn_refreshHandler=function(){if(h.RoleCenter.instans.vo.GOLD>=this._currCost){var t=new i.ShopOperationC2GS;t.msgidx=s.enumOpResultType.shop1_refresh,o.GSM.sendServer(t)}else l.Switches.ins.event(155)},t.prototype.openAndUpdateHandler=function(t){var e=t.mysteriousList;this.list.array=e,this.list.visible=!0,0<t.countdownTime?(this.time_txt.visible=!0,this.countdownTime=t.countdownTime,Laya.timer.loop(1e3,this,this.updateTimeHandler)):(h.RoleCenter.instans.vo.GOLD-=this._currCost,h.RoleCenter.instans.vo.SHOPEXP+=this._currCost),h.RoleCenter.instans.vo.shopData.refreshCount=t.refreshCount,v.E.ins.event(f.EventName.SHOP_REFRESH_COUNT_CHANGED)},t.prototype.renderHandler=function(t,e){t.setData(this.list.array[e])},t.prototype.updateTimeHandler=function(){if(this.time_txt.text=g.TextConst.get(569,r.DateUtil.getHourStr(this.countdownTime)),this.countdownTime-=1,this.countdownTime<=0){this.time_txt.visible=!1,Laya.timer.clearAll(this);var t=new i.ShopOperationC2GS;t.msgidx=s.enumOpResultType.shop_open,o.GSM.sendServer(t)}},t.prototype.showView=function(t){if(t.addChild(this),this.visible=!0,!this._init){this.list.visible=!1;var e=new i.ShopOperationC2GS;e.msgidx=s.enumOpResultType.shop_open,o.GSM.sendServer(e),o.GSM.ins.on(a.ShopMysteriousGS2C.KEY,this,this.openAndUpdateHandler)}this._init=!0,this.countdownTime||(this.time_txt.text=g.TextConst.get(569,629909)),d.ClearResM.resetViewImg(this),this.updateCost()},t.prototype.updateCost=function(){var t=h.RoleCenter.instans.vo.shopData.refreshCount,e=c.GameConfig.shopSettingVoCfg[1];t>=e.flushcost.length&&(t=e.flushcost.length-1),this._currCost=e.flushcost[t],this.lab_cost.changeText(this._currCost.toString())},t}(ui.shop.MysteryStoreUI);e.MysteryStoreView=y}),define("src/g/shop/view/MarkItem",["require","exports","../../../manager/GameSocketManager","../../net/messages/ShopOperationC2GS","../../../manager/RoleCenter","../../../utils/ItemUtils","../../net/messages/OpResultType","src/g/peronboss/view/ItemIconView","src/init/Switches"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.buyID=0,t.btn_buy.on(Laya.Event.CLICK,t,t.buyHandler),t.btn_buy.on(Laya.Event.CLICK,t,t.buyHandler),t}return __extends(t,e),t.prototype.buyHandler=function(){var t=parseInt(this.gold_txt.text);if(s.RoleCenter.instans.self.GOLD<t)l.Switches.ins.event(155);else{var e=new n.ShopOperationC2GS;e.msgidx=a.enumOpResultType.shop2_buy,e.cfgId=this.buyID,i.GSM.sendServer(e)}},t.prototype.setData=function(t){this.buyID=t.id;var e=o.ItemUtils.getItemVoById(t.itemid[0][0]);this.item_name.text=e.name,this.gold_txt.text=t.cost[0][1],this.mark_txt.text=t.cost[1][1],r.ItemIconView.setItemData(e,this.item,t.itemid[0][1]),this.item.lvl.visible=!1},t}(ui.shop.MarkItemUI);e.MarkItem=h}),define("src/g/shop/view/MarkView",["require","exports","../../../config/GameConfig","src/g/shop/view/MarkItem","../../../manager/RoleCenter","../../net/messages/OpResultType","src/g/clearRes/ClearResM","src/init/TextConst"],function(t,e,s,i,o,n,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t.list.itemRender=i.MarkItem,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=50,o.RoleCenter.instans.on(n.enumOpResultType.shop2_buy+"",t,t.resultHandler),t}return __extends(t,e),t.prototype.resultHandler=function(t){this.mark_txt.text=r.TextConst.get(753,o.RoleCenter.instans.vo.SHOPEXP)},t.prototype.renderHandler=function(t,e){t.setData(this.list.array[e])},t.prototype.showView=function(t){if(t.addChild(this),this.visible=!0,this.list.scrollTo(0),!this._data){this._data=[];var e=s.GameConfig.Shop2JSON;for(var i in e){var n=e[i];2==n.type&&this._data.push(n)}this.list.array=this._data}this.mark_txt.text=r.TextConst.get(753,o.RoleCenter.instans.vo.SHOPEXP),a.ClearResM.resetViewImg(this)},t}(ui.shop.MarkViewUI);e.MarkView=l}),define("src/g/shop/view/CombatItem",["require","exports","../../net/messages/ShopOperationC2GS","../../../utils/ItemUtils","../../../manager/GameSocketManager","../../net/messages/OpResultType","src/g/peronboss/view/ItemIconView","src/init/TextConst","../../../manager/RoleCenter"],function(t,e,i,s,n,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.buyID=0,t.idArr=[],t.numArr=[],t.btn_buy.on(Laya.Event.CLICK,t,t.buyHandler),t.btn_buy.on(Laya.Event.CLICK,t,t.buyHandler),t}return __extends(t,e),t.prototype.buyHandler=function(){if(parseInt(this.combat_txt.text))var t=new i.ShopOperationC2GS;t.msgidx=o.enumOpResultType.shop2_buy,t.cfgId=this.buyID,n.GSM.sendServer(t)},t.prototype.setData=function(t){this.buyID=t.id;var e=s.ItemUtils.getItemVoById(t.itemid[0][0]);this.item_name.text=e.name,this.combat_txt.text=t.cost[0][1],a.ItemIconView.setItemData(e,this.item,t.itemid[0][1]),this.item.lvl.visible=!1;var i=this.idArr.indexOf(t.id),n=t.daypermit-(this.numArr[i]||0);t.daypermit?this.lcount.text=r.TextConst.get(752,n,t.daypermit):this.lcount.text=""},t.prototype.setLimitItemArr=function(){for(var t=l.RoleCenter.instans.self.shopData.daypermitArr,e=[],i=[],n=0;n<t.length;n++){var s=t[n];n%2?i.push(s):e.push(s)}this.idArr=e,this.numArr=i},t}(ui.shop.CombatItemUI);e.CombatItem=h}),define("src/g/shop/view/CombatView",["require","exports","src/g/shop/view/CombatItem","../../../config/GameConfig","../../../utils/ItemUtils","src/g/itemGets/View/ItemGetDlg","../../../manager/RoleCenter","../../net/messages/OpResultType","src/g/clearRes/ClearResM","../../../core/E","../../../enum/EventName"],function(t,e,i,s,n,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t.list.itemRender=i.CombatItem,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=50,a.RoleCenter.instans.on(r.enumOpResultType.shop2_buy+"",t,t.resultHandler),h.E.ins.on(c.EventName.UPDATECOMBATITEM,t,function(){t.list.refresh()}),t}return __extends(t,e),t.prototype.resultHandler=function(t){this.mark_txt.text=""+a.RoleCenter.instans.vo.COMBATGAINS},t.prototype.renderHandler=function(t,e){t.setLimitItemArr(),t.setData(this.list.array[e])},t.prototype.showView=function(t){if(t.addChild(this),this.visible=!0,!this._data){this._data=[];var e=s.GameConfig.Shop2JSON;for(var i in e){var n=e[i];3==n.type&&this._data.push(n)}this.list.array=this._data}this.mark_txt.text=""+a.RoleCenter.instans.vo.COMBATGAINS,this.btn_get.on(Laya.Event.CLICK,this,this.getHandlerShop),l.ClearResM.resetViewImg(this)},t.prototype.getHandlerShop=function(){var t=n.ItemUtils.getCurrencyByDefine("COMBATGAINS");(new o.ItemGetDlg).initByVo(null,t).popup()},t}(ui.shop.CombatViewUI);e.CombatView=u}),define("src/g/shop/view/PropItem",["require","exports","../../../config/GameConfig","../../../manager/RoleCenter","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","src/init/Switches","../../../component/BuyDialog"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t.buyID=0,t.btn_buy.on(Laya.Event.CLICK,t,t.buyHandler),t.btn_buy.on(Laya.Event.CLICK,t,t.buyHandler),t}return __extends(t,e),t.prototype.buyHandler=function(){var t=parseInt(this.gold_txt.text);if(n.RoleCenter.instans.self.GOLD<t)a.Switches.ins.event(155);else{var e=new r.BuyDialog;e.setData(this._data),e.popup()}},t.prototype.setData=function(t){this.buyID=t.id,this._data=t;var e=s.ItemUtils.getItemVoById(t.itemid[0][0]);this.item_name.text=e.name,this.gold_txt.text=t.cost[0][1],o.ItemIconView.setItemData(e,this.item,t.itemid[0][1]),i.GameConfig.titleJSON[t.id]&&(this.item_name.text=e.name),this.item.lvl.visible=!1},t}(ui.shop.PropItemUI);e.PropItem=l}),define("src/g/shop/view/PropView",["require","exports","src/g/shop/view/PropItem","../../../config/GameConfig","src/g/clearRes/ClearResM"],function(t,e,i,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.list.itemRender=i.PropItem,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=50,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t}return __extends(t,e),t.prototype.renderHandler=function(t,e){t.setData(this.list.array[e])},t.prototype.showView=function(t){if(t.addChild(this),this.visible=!0,this.list.scrollTo(0),!this._data){this._data=[];var e=s.GameConfig.Shop2JSON;for(var i in e){var n=e[i];1==n.type&&this._data.push(n)}this.list.array=this._data}o.ClearResM.resetViewImg(this)},t}(ui.shop.PropViewUI);e.PropView=n}),define("src/g/proxy/MultiLevelUIProxy",["require","exports","src/g/accessctrl/AccessCenter","../../config/GameConfig","../../core/E","../../enum/EventName"],function(t,e,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function c(){this.isRefresh=!0,this._index2Tab={},this._mId2Index={},this._lastIndex=-1}return c.prototype.destroy=function(){for(var t in this._index2Tab)this._index2Tab[t].selectHandler=null;this._index2Tab={},this._mId2Index={},this.selectHandler=null,this.isRefresh=!0},c.prototype.registerTab=function(t,e){t&&((this._index2Tab[e]=t).selectHandler=new Laya.Handler(this,this.onTagClickHandler,[e]))},c.prototype.onOpenOne=function(t,e){var i=this._mId2Index[t];e&&e.runWith(i)},c.prototype.onOneItemClickHandler=function(t,e){for(var i in this._mId2Index)if(this._mId2Index[i]==t){var n=parseInt(i),s=p.GameConfig.accessCtrlCfg[n],o=!0;s&&(o=!s.forceopen);var a=u.AccessCenter.ins.checkOpen(n,o);s&&s.forceopen&&(a=!0),a&&e&&e.runWith(t);break}},c.prototype.onTagClickHandler=function(t,e){for(var i=t+e,n=(i+1)*c.mx,s=this._index2Tab[n];s;)n=((i=n+=s.selectedIndex)+1)*c.mx,s=this._index2Tab[n];for(var o in this._mId2Index)if(this._mId2Index[o]==i){var a=parseInt(o),r=p.GameConfig.accessCtrlCfg[a],l=!0;r&&(l=!r.forceopen);var h=u.AccessCenter.ins.checkOpen(a,l);r&&r.forceopen&&(h=!0),502==a&&(h=!0),h?(this.setTabSelect(i),this._lastIndex=i,this.selectHandler&&(this.selectHandler.runWith(i),d.E.ins.event(g.EventName.ACCESS_INTO,a))):this.revertTab();break}},c.prototype.registerTagIndex=function(t,e){this._mId2Index[t]=e},c.prototype.revertTab=function(){-1!=this._lastIndex&&this.setTabSelect(this._lastIndex)},c.prototype.closeSubTab=function(){if(-1!=this._lastIndex)for(var t,e=c.splitIndex(this._lastIndex),i=e.length,n=0,s=0;n<i;)(t=this._index2Tab[s])&&(0<s&&(t.visible=!1),s=((s+=e[n])+1)*c.mx),n++},c.prototype.open=function(t){var e=this._mId2Index[t],i=this.isRefresh;e!=this._lastIndex&&(this.setTabSelect(e),this._lastIndex=e,i=!0),i&&this.selectHandler&&(this.selectHandler.runWith(e),d.E.ins.event(g.EventName.ACCESS_INTO,t))},c.prototype.setTabSelect=function(t){this.closeSubTab();for(var e,i=c.splitIndex(t),n=i.length,s=0,o=0;s<n&&(e=this._index2Tab[o]);)0<o&&(e.visible=!0),e.setSelectIndex(i[s]),o=((o+=i[s])+1)*c.mx,s++;var a=this._index2Tab[o];a&&(a.visible=!0)},c.mergeIndex=function(t){for(var e=t.length,i=0,n=-1;i<e;)n=-1==n?t[i]:(n+1)*this.mx+t[i],i++;return n},c.splitIndex=function(t){var e=this.getParentIndex(t);return-1==e?[t]:this.splitIndex(e).concat(t%this.mx)},c.getParentIndex=function(t){return t<this.mx?-1:t/this.mx>>-1},c.mx=10,c}();e.MultiLevelUIProxy=i}),define("src/g/shop/view/ShopView",["require","exports","../../../enum/EventName","../../../core/E","../../../manager/LayerManager","src/g/shop/view/MysteryStoreView","src/g/shop/view/MarkView","src/g/shop/view/CombatView","src/g/shop/view/PropView","src/g/proxy/MultiLevelUIProxy","src/g/clearRes/ClearResM"],function(t,e,n,s,o,i,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t._conArr=[],t.bg.btn_close.on(Laya.Event.CLICK,t,t.closeHandler),t.btn_back.on(Laya.Event.CLICK,t,t.closeHandler),t._tabProxy=new h.MultiLevelUIProxy,t._tabProxy.registerTab(t.tab,0),t._tabProxy.registerTagIndex(95,0),t._tabProxy.registerTagIndex(97,1),t._tabProxy.registerTagIndex(98,2),t._tabProxy.selectHandler=new Laya.Handler(t,t.renderHandler),t}return __extends(t,e),t.prototype.closeHandler=function(){this.removeSelf()},t.prototype.showView=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),o.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),this._tabProxy.open(t),s.E.ins.on(n.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),c.ClearResM.resetViewImg(this)},t.prototype.closeClearRes=function(){s.E.ins.off(n.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),c.ClearResM.clearResFolder("shop/")},t.prototype.renderHandler=function(t){for(var e=0;e<this._conArr.length;e++)this._conArr[e].visible=!1;0==t?(this._view1||(this._view1=new i.MysteryStoreView,this._conArr.push(this._view1)),this._view1.showView(this.box)):10==t?(this._view2||(this._view2=new a.MarkView,this._conArr.push(this._view2)),this._view2.showView(this.box)):1==t?(this._view3||(this._view3=new r.CombatView,this._conArr.push(this._view3)),this._view3.showView(this.box)):(this._view4||(this._view4=new l.PropView,this._conArr.push(this._view4)),this._view4.showView(this.box))},t}(ui.shop.ShopUI);e.ShopView=u}),define("src/g/account/ctrl/GetRewwardCtrl",["require","exports","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","src/g/guide/vo/RewardVo","../../../enum/enumItem","src/g/account/view/AccItem","../../../meta/QualiyVo","src/g/bag/tips/view/ItemTips","../../../utils/ItemCellUtils"],function(t,e,f,o,y,m,_,C,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.showReward=function(t){this._view&&this._view.destroy(),this._view=new ui.account.GetItemViewUI,this._view.panelList.hScrollBarSkin="";for(var e=new Laya.Sprite,i=0;i<t.length;i+=2){var n=f.ItemUtils.getItemOrEq(t[i]),s=new ui.boss.IconItemUI;o.ItemIconView.setItemData(n,s,t[i+1]),e.addChild(s),s.x=e.width,e.width+=s.width}e.height=s.height,e.width>this._view.panelList.width?e.x=0:e.x=this._view.panelList.width/2-e.width/2,this._view.panelList.addChild(e),this.showView()},t.showReward2=function(t,e){this._view&&this._view.destroy(),this._view=new ui.account.GetItemViewUI,this._view.panelList.hScrollBarSkin="";for(var i=new Laya.Sprite,n=0;n<t.length;n++){var s=new ui.custom.ItemNameViewUI;r.ItemCellUtils.fillCellForItemNameView(s,t[n][0],t[n][1]),a.ItemTips.cellShowTip(s,t[n][0],t[n][1]),i.addChild(s),s.x=i.width,i.width+=s.width}i.height=s.height,i.width>this._view.panelList.width?i.x=0:i.x=this._view.panelList.width/2-i.width/2,this._view.panelList.addChild(i),this.callBack=e,this.showView()},t.showView=function(){this._view.popup(),this._view.btn_ok.once(Laya.Event.CLICK,this,this.closeHander)},t.closeHander=function(){this._view.close(),null!=this.callBack&&this.callBack.run(),this.callBack=null},t.inventoryAddGS2C=function(t,e,i,n){void 0===i&&(i=null),void 0===n&&(n=""),this._view&&this._view.destroy(!0),this._view=new ui.account.GetItemViewUI,this._view.panelList.hScrollBarSkin="",null!=i&&(this._view.btn_ok.label=i),this._view.lab_desc.changeText(n);var s=new Laya.Sprite;this.callBack=e;var o=new _.AccItem;if(t.equipList)for(var a=t.equipList,r=0;r<a.length;r++){var l=new y.RewardVo,h=f.ItemUtils.getItemOrEq(a[r].equtemplet);l.res=f.ItemUtils.getIconByIconId(h.icon),l.lv=h.lv||h.limit,l.qualityNum=h.quality,l.quality=C.QualityStruct.Ins.getQColorById(h.quality),l.name=h.name,l.type=m.ItemType.EQ,l.id=h.id,l.job=h.job,(o=new _.AccItem).eqData=l,s.addChild(o),o.x=s.width,s.width+=o.width}if(t.currencyList){var c=t.currencyList;for(r=0;r<c.length;r++)if(!(c[r].val<=0)){var u=new y.RewardVo;u.count=c[r].val;var p=f.ItemUtils.getCurrencyByDefine(c[r].key);u.name=p.name,u.type=m.ItemType.CURRENCY,u.quality=C.QualityStruct.Ins.getQColorById(p.quality),u.res=f.ItemUtils.getIconByIconId(p.icon),u.qualityNum=p.quality,u.define=c[r].key,u.streamer=p.streamer,(o=new _.AccItem).eqData=u,s.addChild(o),o.x=s.width,s.width+=o.width}}if(t.itemList){var d=t.itemList;for(r=0;r<d.length;r+=2){l=new y.RewardVo;if(v=f.ItemUtils.getItemVoById(d[r]))l.res=f.ItemUtils.getIconByIconId(v.icon),l.lv=v.uselimit,l.qualityNum=v.quality,l.quality=C.QualityStruct.Ins.getQColorById(v.quality),l.name=v.name,l.id=v.id,l.type=m.ItemType.ITEM,l.count=d[r+1],l.streamer=v.streamer,(o=new _.AccItem).eqData=l,s.addChild(o),o.x=s.width,s.width+=o.width}}if(t.zhanwenList){var g=t.zhanwenList;for(r=0;r<g.length;r++){var v=f.ItemUtils.getItemVoById(g[r].cfgId);(l=new y.RewardVo).res=f.ItemUtils.getIconByIconId(v.icon),l.lv=v.uselimit,l.qualityNum=v.quality,l.quality=C.QualityStruct.Ins.getQColorById(v.quality),l.name=v.name,l.id=v.id,l.type=m.ItemType.ITEM,l.streamer=v.streamer,(o=new _.AccItem).eqData=l,s.addChild(o),o.x=s.width,s.width+=o.width}}s.height=o.height,this._view.panelList.addChild(s),s.width>this._view.panelList.width?s.x=0:s.x=this._view.panelList.width/2-s.width/2,this.showView()},t}();e.GetRewwardCtrl=i}),define("src/g/shop/ctrl/ShopCtrl",["require","exports","../../../enum/EventName","../../../core/E","src/g/shop/view/ShopView","../../net/messages/OpResultType","../../../manager/RoleCenter","../../../config/GameConfig","../../../utils/ItemUtils","../../../utils/system/FloatEffect","../../../manager/NewRedHintsCenter","src/init/Switches","src/g/account/ctrl/GetRewwardCtrl"],function(t,e,i,n,s,o,h,c,u,p,a,r,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){}return t.prototype.init=function(){if(!window.isShenhe){var t=r.Switches.ins;t.on(7,this,this.onOpenIdHandler,[95]),t.on(95,this,this.onOpenIdHandler,[95]),t.on(96,this,this.onOpenIdHandler,[96]),t.on(97,this,this.onOpenIdHandler,[97]),t.on(98,this,this.onOpenIdHandler,[98]),h.RoleCenter.instans.on(o.enumOpResultType.shop2_buy+"",this,this.resultHandler),n.E.ins.once(i.EventName.INIT_SELFSETOVER,this,this.initRed),h.RoleCenter.instans.on(o.enumOpResultType.shop2_resetDayPermit+"",this,this.onResetDayHandler)}},t.prototype.onResetDayHandler=function(){h.RoleCenter.instans.vo.shopData.refreshCount=0,n.E.ins.event(i.EventName.SHOP_REFRESH_COUNT_CHANGED),n.E.ins.event(i.EventName.UPDATECOMBATITEM)},t.prototype.onOpenIdHandler=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1),e&&this.onOpenHandler(t,i,n)},t.prototype.initRed=function(){h.RoleCenter.instans.vo.lvl<20?n.E.ins.on(i.EventName.ADDED_LEVEL,this,this.onLevelChanged):a.NewRedHintsCenter.ins.setRedHintOpenOrClose(a.enumRedHints.shop,!0)},t.prototype.onLevelChanged=function(){20<=h.RoleCenter.instans.vo.lvl&&(n.E.ins.off(i.EventName.ADDED_LEVEL,this,this.onLevelChanged),a.NewRedHintsCenter.ins.setRedHintOpenOrClose(a.enumRedHints.shop,!0))},t.prototype.resultHandler=function(t){var e=t.reservedata,i=c.GameConfig.Shop2JSON[e[0]],n=i.itemid[0][0],s=i.itemid[0][1],o=u.ItemUtils.getItemOrEq(n);p.FE.getUpFloat(o.name+"x"+s,n),c.GameConfig.titleJSON[n]||(h.RoleCenter.instans.vo.chgItemCount(n,s),d.GetRewwardCtrl.showReward([n,s]));for(var a=i.cost,r=0;r<a.length;r++){var l=a[r];h.RoleCenter.instans.vo[l[0]]-=l[1]}},t.prototype.onOpenHandler=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._view||(this._view=new s.ShopView),this._view.showView(t,e,i)},t}();e.ShopCtrl=l}),define("src/g/proxy/AccessListenProxy",["require","exports","src/g/accessctrl/AccessCenter","../../config/GameConfig","../../core/E","../../enum/EventName"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){}return t.prototype.checkAndListen=function(t,e){this._id=t,this._refreshFun=e,i.AccessCenter.ins.inited?this.initCheck():s.E.ins.once(o.EventName.ACCESS_CENTER_INITED,this,this.initCheck)},t.prototype.initCheck=function(){if(i.AccessCenter.ins.checkOpen(this._id))this._refreshFun.run(),this._refreshFun=null;else{var t=n.GameConfig.accessCtrlCfg[this._id];t&&t.forceopen&&this._refreshFun&&this._refreshFun.run(),i.AccessCenter.ins.on(this._id,this,this.onAccessChanged)}},t.prototype.onAccessChanged=function(t){t&&(i.AccessCenter.ins.off(this._id,this,this.onAccessChanged),this._refreshFun.run(),this._refreshFun=null)},t.prototype.clear=function(){i.AccessCenter.ins.off(this._id,this,this.onAccessChanged),this._refreshFun=null},t}();e.AccessListenProxy=a}),define("src/g/field/ctrl/FieldViewCtrl",["require","exports","../../../manager/RoleCenter","../../../enum/EventName","../../../core/E","src/g/accessctrl/AccessCenter","src/g/proxy/AccessListenProxy","../../../manager/NewRedHintsCenter"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){}return t.prototype.init=function(){(new a.AccessListenProxy).checkAndListen(86,new Laya.Handler(this,this.checkFieldRed)),s.E.ins.on(n.EventName.MEETPKDATA_CHANGE,this,this.checkFieldRed)},t.prototype.checkFieldRed=function(){o.AccessCenter.ins.checkOpen(86)&&0<i.RoleCenter.instans.self.meetPkData.pkuserlist.length?r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.field,!0):r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.field,!1)},t}();e.FieldViewCtrl=l}),define("src/g/gameSdk/baseSdk",["require","exports","src/g/gameSdk/gameSdk"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.sdkChannelName="",this.sdkChannelUserName="",this.svrName="",this.channelId=window.KtChannelId,this.isWxLogin=!1,this.isShowShare=!1,this.isUserAuthentication=!1,this.isApp=!1,this.isShowSendDesktop=!1,this.isShowFollow=!1,this.isShowPhone=!1,this.isShowEntBBS=!1,this.H5LoginParms="",this.devInfo=new i.DeviceInfo,this.inviter="",this.cb_loginOk=null,this.cb_loginFail=null,this.cb_payCallOk=null,this.cb_payCallFail=null,this.cb_initOk=null,this.cb_initFail=null,this.isInitOver=!1,this.isCallDevice=!1,this.isCallLogin=!1,this.diyObj=null}return t.prototype.pushLocalNotifications=function(t){console.log("pushLocalNotifications")},t.prototype.init=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),console.log("init")},t.prototype.subscribe=function(t){},t.prototype.login=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),console.log("baseChannel")},t.prototype.logout=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null)},t.prototype.authorize=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null)},t.prototype.enterBBS=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null)},t.prototype.refreshToken=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null)},t.prototype.recharge=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null)},t.prototype.enterShareAndFeed=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null)},t.prototype.enterInvite=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null)},t.prototype.getGameFriends=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null)},t.prototype.sendToDesktop=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null)},t.prototype.sendMessageToPlatform=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null)},t.prototype.getUserInfo=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null)},t.prototype.showFollow=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null)},t.prototype.showUserAuthentication=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null)},t.prototype.bindPhone=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null)},t.prototype.customEventApp=function(t){},t.prototype.getMarketName=function(){return"default"},t.prototype.getPayType=function(){return 0},t.prototype.getLoginType=function(){return 0},t.prototype.getChargeType=function(){return 0},t.prototype.killGame=function(){},t}();e.baseSdk=n}),define("src/g/gameSdk/gameSdk",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.channelId=0,t._ins=this}return Object.defineProperty(t,"Ins",{get:function(){return t._ins||new t},enumerable:!0,configurable:!0}),t.prototype.init=function(){this._sdk=window.kth5sdk},Object.defineProperty(t.prototype,"sdk",{get:function(){return this._sdk},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"svrname",{get:function(){return this.sdk.svrName},set:function(t){this.sdk.svrName=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"diyObj",{get:function(){return this.sdk.diyObj},set:function(t){this.sdk.diyObj=t},enumerable:!0,configurable:!0}),t}();e.gameSdk=i;var n=function(){function t(){this.itemID=0,this.productid="",this.itemName="",this.amount=0,this.areaID=0,this.svrID=0,this.svrName="",this.channelId=0,this.userId="",this.userName="",this.userLvl=0,this.accountId="",this.otherExt="",this.payExt="",this.payForm=""}return Object.defineProperty(t.prototype,"JsonStr",{get:function(){return JSON.stringify(this)},enumerable:!0,configurable:!0}),t}();e.PayVo=n;var s=function(){this.dataType=1,this.roleID="",this.roleName="",this.roleLevel="",this.zoneId=1,this.zoneName="",this.roleCTime="",this.roleLevelMTime="",this.goldNum=0,this.vipLevel=0,this.power=0,this.selfMsg=""};e.RoleInfo=s;var o=function(){function t(){}return t.sendSelfMsg=0,t.selectServer=1,t.createRole=2,t.JoinGame=3,t.lvUp=4,t.logOut=5,t.clickLoginBtn=6,t.selectSvrView=7,t}();e.RoleInfoCtrlType=o;var a=function(){this.net_type="",this.device_type="web",this.ip="",this.os_version="",this.os_type="H5",this.ram="",this.channel=""};e.DeviceInfo=a}),define("src/g/account/view/OffLineView",["require","exports","src/g/clearRes/ClearResM","../../../core/E","../../../enum/EventName","src/g/gameSdk/gameSdk","../../../manager/GameSocketManager","../../net/messages/share/sbkShareData","../../../manager/RoleCenter","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t.popupEffect=null,t}return __extends(t,e),t.prototype.update=function(){if(window.iswx){var t=2-l.RoleCenter.instans.vo.shareData.offLineTime;this.txt_remain.text="双倍次数:"+t+"/2",this.btn_share.offAll(),0<t?(this.btn_share.label="双倍领取",this.btn_share.on(Laya.Event.CLICK,this,this.share)):(this.btn_share.label=h.TextConst.get(203),this.btn_share.on(Laya.Event.CLICK,this,this.closeView))}else this.btn_share.label="确定",this.txt_remain.text="",this.btn_share.on(Laya.Event.CLICK,this,this.closeView)},t.prototype.share=function(){window.iswx&&o.gameSdk.Ins.sdk.enterShareAndFeed(JSON.stringify({}),function(t){a.GSM.sendServer(new r.shareOffLineC2GS)}),this.closeView()},t.prototype.close=function(){},t.prototype.clearRes=function(){i.ClearResM.clearResFolder("offline/")},t.prototype.closeView=function(){this.clearRes(),e.prototype.close.call(this),n.E.ins.event(s.EventName.OFF_LINE_VIEW_CLOSED)},t}(ui.account.OffLineUI);e.OffLineView=c}),define("src/g/account/ctrl/OffLineViewCtrl",["require","exports","src/g/account/view/OffLineView","../../net/messages/OfflineGainGS2C","../../../manager/GameSocketManager","../../../utils/SoundUtils","../../../manager/RoleCenter","../../../utils/system/ServerTime","src/g/accessctrl/AccessCenter","src/init/Switches","../../../utils/DialogQueue","../../../enum/DialogIDEnum","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(){this.emid=0}return t.prototype.init=function(){s.GSM.ins.on(n.OfflineGainGS2C.KEY,this,this.receiveHandler)},t.prototype.openView=function(){},t.prototype.completeHandler=function(){this._data&&this.offlineGainGS2C(this._data)},t.prototype.receiveHandler=function(t){this._data=t,this.offlineGainGS2C(t)},t.prototype.offlineGainGS2C=function(t){var e=this._view;e&&(e.close(),e=null),t.offlinetime<300||(e||(this._view=e=new i.OffLineView,e.offlinetime.style.color="#b98e42",e.offlinetime.style.fontSize=24,e.offlinetime.style.fontFamily="SimHei",e.offlinetime.style.align="center"),c.DialogQueue.getInstance().add(u.DialogIDEnum.OFFLINE,e),e.money_monthcard.text=t.money_monthcard+"",e.money_shenqi.text=t.money_shenqi+"",e.exp_monthcard.text=t.exp_monthcard+"",e.exp_shenqi.text=t.exp_shenqi+"",e.totalmoney.text=t.totalmoney+"",e.totalexp.text=t.totalexp+"",e.btn_ok.once(Laya.Event.CLICK,this,this.closeHandler),e.offlinetime.innerHTML="离线时间"+this.formatSeconds(t.offlinetime),e.equipget.text=t.equipget+"",e.update(),e.equipsell.style.align="center",e.equipsell.style.color="#a89e8f",e.equipsell.style.fontSize=18,e.equipsell.innerHTML="自动出售<span color='#139f0d'>"+t.equipsell+"</span>件装备")},t.prototype.checkHandler=function(){var t=a.RoleCenter.instans.vo,e=this._view;e.btn_ok.visible=!0;var i="res/offline/gg01_";t&&window.enabledpay?(t.vipData&&!t.vipData.isFirstCharge?(this.emid=13,e.gg01_01.skin=i+"01.png"):t.monthCardEndTime<r.ServerTime.serverTime?(e.gg01_02.skin=i+"02.png",this.emid=12):t.isSuperMonthCard?t.VIP<3?(e.gg01_04.skin=i+"04.png",this.emid=101):t.VIP<4?(e.gg01_05.skin=i+"05.png",this.emid=101):t.VIP<5?(e.gg01_06.skin=i+"06.png",this.emid=101):5<=t.VIP&&(e.gg01_07.skin=i+"07.png",this.emid=9):(e.gg01_03.skin=i+"03.png",this.emid=122),l.AccessCenter.ins.checkOpen(this.emid)?e.btn_ok.label=p.TextConst.get(200):e.btn_ok.label=p.TextConst.get(201)):e.btn_ok.visible=!0},t.prototype.goHanndler=function(){l.AccessCenter.ins.checkOpen(this.emid)&&h.Switches.ins.event(this.emid),this._view.closeView()},t.prototype.closeHandler=function(){this._view.closeView(),o.SoundUtils.getInstance().playBtnsounds(),this._view=null,this._data=null},t.prototype.formatSeconds=function(t){var e=parseInt(t),i=0,n=0;60<e&&(i=e/60>>0,e=e%60>>0,60<i&&(n=i/60>>0,i=i%60>>0));var s=p.TextConst.get(246,e>>0);return 0<i&&(s=p.TextConst.get(247,i>>0)),0<n&&(s=p.TextConst.get(248,n>>0)),s},t}();e.OffLineViewCtrl=d}),define("src/g/account/view/PortEffectUpView",["require","exports","../../../manager/LayerManager"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.y=364,t}return __extends(t,e),t.prototype.showView=function(){i.LayerManager.addAlertLayer(this)},t}(ui.account.PortEffectUpUI);e.PortEffectUpView=n}),define("src/g/account/ctrl/PortEffectUpViewCtrl",["require","exports","src/g/account/view/PortEffectUpView","../../../enum/EventName","../../../core/E","../../../manager/RoleCenter","../../../utils/ItemUtils","src/g/clearRes/ClearResM"],function(t,e,o,i,n,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.prototype.init=function(){n.E.ins.on(i.EventName.PORTEFFECTUP,this,this.popPortUp)},t.prototype.popPortUp=function(){var t=a.RoleCenter.instans.vo.portstatus.portindex;if(!(t<101&&2e4<t)){var e=r.ItemUtils.getPortVoById(t),i=r.ItemUtils.getPortVoById(t-1);this._view||(this._view=new o.PortEffectUpView),this._view.alpha=1;var n=e.port_drop,s=i.port_drop;this._view.pre_jinbi_txt.text=Math.round((0<s.length?s[0][1]:0)*(1+a.RoleCenter.instans.vo.MONEYGET/1e4)).toString(),this._view.jinbi_txt.text=Math.round((0<n.length?n[0][1]:0)*(1+a.RoleCenter.instans.vo.MONEYGET/1e4)).toString(),this._view.pre_exp_txt.text=Math.round((0<s.length?s[1][1]:0)*(1+a.RoleCenter.instans.vo.EXPGET/1e4)).toString(),this._view.exp_txt.text=Math.round((0<n.length?n[1][1]:0)*(1+a.RoleCenter.instans.vo.EXPGET/1e4)).toString(),this._view.showView(),Laya.Tween.to(this._view,{alpha:0},3e3,null,Laya.Handler.create(this,function(){this._view.destroy(!0),l.ClearResM.clearUrl(this._view.bg.skin),this._view=null}),1e3,!0)}},t}();e.PortEffectUpViewCtrl=s}),define("src/g/index/view/EnterPortView",["require","exports","../../../core/E","../../../enum/EventName","../../../utils/system/FloatEffect","src/g/fight/osprite/GameScene","../../../component/GAnimation","../../../utils/ItemUtils","../../../manager/RoleCenter","../../../manager/AM","../../../enum/GuideTargetName","../../../manager/StateManger","src/g/fight/info/PlayTypeVo","src/g/clearRes/ClearResM","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg","../../../plugin/view/ToolTip","src/init/Switches","../../net/messages/ErrConst","../../../utils/system/ErrCodeView","src/g/fight/base/RES","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var b=function(e){function t(){var t=e.call(this)||this;return t.murl="",t.btn_close.on(Laya.Event.CLICK,t,t.closeHandlers),t.btn_fight.on(Laya.Event.CLICK,t,t.clickHandler),i.E.ins.on(n.EventName.EXP_GET_CHANGED,t,t.updateExpAndMoney),i.E.ins.on(n.EventName.MONEY_GET_CHANGED,t,t.updateExpAndMoney),t}return __extends(t,e),t.prototype.closeHandlers=function(){Laya.timer.clearAll(this),i.E.ins.event(n.EventName.COMPTYPE_CLOSEVIEW,c.GuideTargetName.PORT_VIEW),this.close(),this._ani.clear(),this._ani.destroy(!0),this._ani=null,d.ClearResM.clearCachUrl(this.murl),this.destroy(),d.ClearResM.clearResFolder("port/")},t.prototype.showView=function(t){void 0===t&&(t=0),this.popup(!0),this._ani||(this._ani=new a.GAnimation),this._ani.x=200,this._ani.y=220,this.addChild(this._ani);var e=l.RoleCenter.instans.self.portstatus.portindex;this._datavo=r.ItemUtils.getPortVoById(e);var i=r.ItemUtils.getMonsterVOById(this._datavo.boss[0]),n=i.zoom;-1==i.moResVo.dir.indexOf(5)?(this.murl=C.RES.MONSTER_PATH+i.moResVo.res+"/3_r.json",this._ani.scale(-n,n)):(this.murl=C.RES.MONSTER_PATH+i.moResVo.res+"/5_r.json",this._ani.scale(n,n)),this._ani.load(this.murl),d.ClearResM.setCachUrl(this.murl),this.updateExpAndMoney()},t.prototype.openBackHandler=function(){y.Switches.ins.event(71)},t.prototype.updateExpAndMoney=function(){var t=l.RoleCenter.instans.self.portstatus.portindex;this._datavo=r.ItemUtils.getPortVoById(t),this._datavo.port_drop[0]?(this.jinbi_txt.text=I.TextConst.get(21,Math.round((this._datavo.port_drop[0][1]||0)*(1+l.RoleCenter.instans.vo.MONEYGET/1e4))),this.exp_txt.text=I.TextConst.get(21,Math.round((this._datavo.port_drop[1][1]||0)*(1+l.RoleCenter.instans.vo.EXPGET/1e4)))):(this.jinbi_txt.text=I.TextConst.get(21,0),this.exp_txt.text=I.TextConst.get(21,0))},t.prototype.clickHandler=function(){if(!g.PlayManager.loading)if(u.StateManger.isSpecialPlay())i.E.ins.event(n.EventName.RESTART_GUIDE_GROUP);else{if(!l.RoleCenter.instans.bagRoomEnough())return h.AM.show(_.ErrCodeView.getErrStr(m.enumErrConst.code_2206),Laya.Handler.create(this,this.openBackHandler)),void i.E.ins.event(n.EventName.RESTART_GUIDE_GROUP);i.E.ins.event(n.EventName.COMPTYPE_CLICK,c.GuideTargetName.PORT_VIEW_BTN_FIGHT),this.closeHandlers();var t=o.GameScene.ins.port.count;l.RoleCenter.instans.self.portstatus.killMonsterGroups>=t?i.E.ins.event(n.EventName.PLAY_TYPE_CHANGE,p.PlayTypeVo.create(v.EPlayType.PLAYTYPE_PORT_LEVEL,null,!1)):(s.FE.upItems(I.TextConst.get(602),f.BubbleEnum.center),i.E.ins.event(n.EventName.RESTART_GUIDE_GROUP))}},t}(ui.index.PortPanelUI);e.EnterPortView=b}),define("src/g/index/ctrl/EnterPortViewCtrl",["require","exports","../../../enum/EventName","../../../core/E","src/g/index/view/EnterPortView","../../../enum/GuideTargetName","src/init/Switches"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this.init()}return t.prototype.init=function(){a.Switches.ins.on(110,this,this.onOpenHandler,[110])},t.prototype.onOpenHandler=function(t,e){e&&this.openviewHandler(t)},t.prototype.openviewHandler=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!0),this._view&&this._view.destroy(),this._view=new s.EnterPortView,n.E.ins.event(i.EventName.COMPTYPE_OPENVIEW,o.GuideTargetName.PORT_VIEW),this._view.showView()},t}();e.EnterPortViewCtrl=r}),define("src/g/roleSubJoin/view/RingView",["require","exports","src/g/Effects/UIEffectsFactory","../../net/messages/sbkFormula","../../net/messages/ErrConst","../../../utils/system/ErrCodeView","../../../manager/GameSocketManager","../../net/messages/OpResultType","../../net/messages/Ring12C2GS","../../../utils/ItemUtils","../../../manager/RoleCenter","src/g/itemGets/View/ItemGetDlg","src/init/TextConst"],function(t,e,s,c,n,o,a,r,l,u,p,h,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t._nowSelectHero=0,t._selectType=0,t.p_canUp=!1,t.p_maxLv=!1,t.aniArr=[];for(var e=t.itemId=0;e<=1;e++)t.aniArr.push(49+e);return t.aniArr.push(160),t.aniArr.push(159),t.aniArr.push(158),t.addEvent(),t}return __extends(t,i),t.prototype.playAni=function(){s.UIEffectsFactory.Ins.playAniOnce(11,this.sp,1.3,1.3)},t.prototype.addEvent=function(){this.btn_Up.on(Laya.Event.CLICK,this,this.onClieck),this.item_cost.setJump(d.TextConst.get(238),new Laya.Handler(this,this.ongetClick))},t.prototype.onClieck=function(){if(this.p_canUp){var t=new l.Ring12C2GS;0==this._selectType?t.msgidx=r.enumOpResultType.ring1:1==this._selectType?t.msgidx=r.enumOpResultType.ring2:2==this._selectType?t.msgidx=r.enumOpResultType.ring3:3==this._selectType&&(t.msgidx=r.enumOpResultType.ring4),t.heroidx=this._nowSelectHero,a.GSM.sendServer(t)}else{if(this.p_maxLv)return void o.ErrCodeView.show((this._selectType,n.enumErrConst.code_2302));if(this.btn_Up.label==d.TextConst.get(481))return void this.ongetClick()}},t.prototype.ongetClick=function(){this.getItem(this.itemId)},t.prototype.refreshData=function(t,e,i){this._nowSelectHero=t,this._selectType=e,this.p_hero=p.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero),this.refreshIcon(),this.refreshAttr()},t.prototype.refreshAttr=function(){var t=0,e="",i=0,n=0,s=0;if(0==this._selectType){t=this.p_hero.ring1ID,e=d.TextConst.get(961);var o=u.ItemUtils.getRing1VoById(t);this.box_fight.setFightNum(o.getTotalPower()||0),this.lab_lv.text=0==t?d.TextConst.get(485).split("").join("\n"):d.TextConst.get(17,t);for(var a=0;a<o.prop.length;a++){var r="%"==(l=u.ItemUtils.getShuXingByName(o.prop[a][0])).unit?o.prop[a][1]/c.sbkFormula.BASEPERCENTAGE:o.prop[a][1];this["lab_now_"+a].text=l.desc+":",this["lab_nownum_"+a].text=r+(l.unit||"")}for(a=0;a<5;a++)o.prop[a]?(this["lab_now_"+a].visible=!0,this["lab_nownum_"+a].visible=!0):(this["lab_now_"+a].visible=!1,this["lab_nownum_"+a].visible=!1);i=o.cost.length<=0?u.ItemUtils.getRing1VoById(t-1).cost[0][0]:o.cost[0][0],n=p.RoleCenter.instans.vo.bagdata.getItemCount(parseInt(i+"")),u.ItemUtils.getRing1VoById(t).cost.length<=0?(this.box_next.visible=!1,s=0):this.box_next.visible=!0,this.box_next.visible?(s=o.cost[0][1],o=u.ItemUtils.getRing1VoById(t+1)):this.box_next.visible=!0}else if(1==this._selectType){t=this.p_hero.ring2ID,e=d.TextConst.get(960);o=u.ItemUtils.getRing2VoById(t);this.box_fight.setFightNum(o.getTotalPower()||0),this.lab_lv.text=0==t?d.TextConst.get(485).split("").join("\n"):d.TextConst.get(17,t);for(a=0;a<o.prop.length;a++){r="%"==(l=u.ItemUtils.getShuXingByName(o.prop[a][0])).unit?o.prop[a][1]/c.sbkFormula.BASEPERCENTAGE:o.prop[a][1];this["lab_now_"+a].text=l.desc+":",this["lab_nownum_"+a].text=r+(l.unit||"")}for(a=0;a<5;a++)o.prop[a]?(this["lab_now_"+a].visible=!0,this["lab_nownum_"+a].visible=!0):(this["lab_now_"+a].visible=!1,this["lab_nownum_"+a].visible=!1);i=o.cost.length<=0?u.ItemUtils.getRing2VoById(t-1).cost[0][0]:o.cost[0][0],n=p.RoleCenter.instans.vo.bagdata.getItemCount(parseInt(i+"")),u.ItemUtils.getRing2VoById(t).cost.length<=0?(this.box_next.visible=!1,s=0):this.box_next.visible=!0,this.box_next.visible?(s=o.cost[0][1],o=u.ItemUtils.getRing2VoById(t+1)):this.box_next.visible=!0}else if(2==this._selectType){t=this.p_hero.ring3ID,e=d.TextConst.get(1066);o=u.ItemUtils.getRing3VoById(t);this.box_fight.setFightNum(o.getTotalPower()||0),this.lab_lv.text=0==t?d.TextConst.get(485).split("").join("\n"):d.TextConst.get(17,t);for(a=0;a<o.prop.length;a++){r="%"==(l=u.ItemUtils.getShuXingByName(o.prop[a][0])).unit?o.prop[a][1]/c.sbkFormula.BASEPERCENTAGE:o.prop[a][1];this["lab_now_"+a].text=l.desc+":",this["lab_nownum_"+a].text=r+(l.unit||"")}for(a=0;a<5;a++)o.prop[a]?(this["lab_now_"+a].visible=!0,this["lab_nownum_"+a].visible=!0):(this["lab_now_"+a].visible=!1,this["lab_nownum_"+a].visible=!1);i=o.cost.length<=0?u.ItemUtils.getRing3VoById(t-1).cost[0][0]:o.cost[0][0],n=p.RoleCenter.instans.vo.bagdata.getItemCount(parseInt(i+"")),u.ItemUtils.getRing3VoById(t).cost.length<=0?(this.box_next.visible=!1,s=0):this.box_next.visible=!0,this.box_next.visible?(s=o.cost[0][1],o=u.ItemUtils.getRing3VoById(t+1)):this.box_next.visible=!0}else if(3==this._selectType){t=this.p_hero.ring4ID,e=d.TextConst.get(1065);o=u.ItemUtils.getRing4VoById(t);this.box_fight.setFightNum(o.getTotalPower()||0),this.lab_lv.text=0==t?d.TextConst.get(485).split("").join("\n"):d.TextConst.get(17,t);for(a=0;a<o.prop.length;a++){var l;r="%"==(l=u.ItemUtils.getShuXingByName(o.prop[a][0])).unit?o.prop[a][1]/c.sbkFormula.BASEPERCENTAGE:o.prop[a][1];this["lab_now_"+a].text=l.desc+":",this["lab_nownum_"+a].text=r+(l.unit||"")}for(a=0;a<5;a++)o.prop[a]?(this["lab_now_"+a].visible=!0,this["lab_nownum_"+a].visible=!0):(this["lab_now_"+a].visible=!1,this["lab_nownum_"+a].visible=!1);i=o.cost.length<=0?u.ItemUtils.getRing4VoById(t-1).cost[0][0]:o.cost[0][0],n=p.RoleCenter.instans.vo.bagdata.getItemCount(parseInt(i+"")),u.ItemUtils.getRing4VoById(t).cost.length<=0?(this.box_next.visible=!1,s=0):this.box_next.visible=!0,this.box_next.visible?(s=o.cost[0][1],o=u.ItemUtils.getRing4VoById(t+1)):this.box_next.visible=!0}i=+i,this.lab_desc.text=e,this.itemId=i,this.btn_Up.label=0==t?d.TextConst.get(237):d.TextConst.get(615);var h=u.ItemUtils.getItemVoById(i);this.item_cost.setNeedName(h.name,u.ItemUtils.getSmallIcon(h.icon)),this.item_cost.setQualColor(u.ItemUtils.getColorByQuality(h.quality)),this.setNeed(n,s)},t.prototype.refreshIcon=function(){s.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.sp_icon,this.aniArr[this._selectType])},t.prototype.getItem=function(t){var e=u.ItemUtils.getItemVoById(t);(new h.ItemGetDlg).initByVo(e).popup()},t.prototype.setNeed=function(t,e){this.p_canUp=e<=t&&0!=e,this.p_maxLv=0==e,this.item_cost.setNeed(t,e),this.p_canUp||(this.btn_Up.label=d.TextConst.get(481));var i=this.ani_put,n=this.btn_Up.visible&&this.p_canUp;n&&!i&&(this.ani_put=i=s.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_Up,40)),i&&(i.visible=n),this.btn_Up.visible=!this.p_maxLv},t}(ui.role.subJoin.RingViewUI);e.RingView=i}),define("src/g/roleSubJoin/view/SubJoinDlg",["require","exports","../../../manager/LayerManager"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.bgView.btn_help.visible=!1,t}return __extends(t,e),t.prototype.initTabName=function(t,e,i){if(void 0===i&&(i=!1),i){this.tab_pageBtn.visible=!1;for(var n=0;n<5;n++)n<t.length?(this.tab_pageBtn_dragon.getChildByName("item"+n).visible=!0,this.tab_pageBtn_dragon.getChildByName("item"+n).label=t[n]):this.tab_pageBtn_dragon.getChildByName("item"+n).visible=!1;for(n=0;n<e.length;n++)this["red_d_"+n].enumRedHints=e[n]}else{this.tab_pageBtn_dragon.visible=!1;for(n=0;n<5;n++)n<t.length?this.tab_pageBtn.getChildByName("item"+n).visible=!0:this.tab_pageBtn.getChildByName("item"+n).visible=!1;for(n=0;n<e.length;n++)this["red_"+n].enumRedHints=e[n]}},t.prototype.addPage=function(t){this.bgView.box_page.addChild(t)},t.prototype.showView=function(){i.LayerManager.addInPOPWindowLayer(this,!1)},t.prototype.hideView=function(){this.removeSelf()},t}(ui.role.subJoin.SubJoinDlgUI);e.SubJoinDlg=n}),define("src/g/roleSubJoin/ctrl/RingViewCtrl",["require","exports","../../../manager/TipManager","src/g/base/BaseCtrl","../../../utils/ItemUtils","../../net/messages/OpResultType","../../../manager/RoleCenter","../../../enum/EventName","../../../manager/LayerManager","src/g/roleSubJoin/view/RingView","../../../core/E","../../../plugin/sbkPropTool","../../../vo/RedDot/role/RedDot_Ring","src/init/Switches","src/g/accessctrl/AccessCenter","src/g/proxy/MultiLevelUIProxy","src/g/roleSubJoin/view/SubJoinDlg","../../../manager/NewRedHintsCenter","src/g/clearRes/ClearResM","../../../vo/RedDot/EventRedDot","src/init/TextConst"],function(t,e,o,i,a,n,r,l,s,h,c,u,p,d,g,v,f,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var I=function(e){function t(){var t=e.call(this)||this;return t._nowSelectHero=0,t._selectType=0,t.urls=["res/atlas/res/roleSubjoin.json"],c.E.ins.on("ring_paralysis",t,t.fromPanel,[0]),c.E.ins.on("ring_flak",t,t.fromPanel,[1]),d.Switches.ins.on(49,t,t.onOpenHandler,[49]),d.Switches.ins.on(50,t,t.onOpenHandler,[50]),d.Switches.ins.on(246,t,t.onOpenHandler,[246]),d.Switches.ins.on(247,t,t.onOpenHandler,[247]),d.Switches.ins.on(269,t,t.onOpenHandler,[269]),t}return __extends(t,e),t.prototype.fromPanel=function(t,e){0==t?g.AccessCenter.ins.checkOpen(49,!0)&&this.showView(49,e):1==t?g.AccessCenter.ins.checkOpen(50,!0)&&this.showView(50,e):3==t?g.AccessCenter.ins.checkOpen(246,!0)&&this.showView(246,e):2==t?g.AccessCenter.ins.checkOpen(247,!0)&&this.showView(247,e):4==t&&g.AccessCenter.ins.checkOpen(269,!0)&&this.showView(269,e)},t.prototype.onOpenHandler=function(t,e,i,n,s){void 0===i&&(i=!0),void 0===n&&(n=!1),e&&this.showView(t,s)},t.prototype.init=function(){return this._view||(this._view=new h.RingView,this._viewdlg=new f.SubJoinDlg,this._viewdlg.initTabName([C.TextConst.get(145),C.TextConst.get(146),C.TextConst.get(149),C.TextConst.get(1062)],[y.enumRedHints.mabi,y.enumRedHints.hushen,y.enumRedHints.attack_ring,y.enumRedHints.defense_ring]),this._viewdlg.addPage(this._view),this._tadProxy=new v.MultiLevelUIProxy,this._tadProxy.registerTab(this._viewdlg.tab_pageBtn,0),this._tadProxy.registerTagIndex(49,0),this._tadProxy.registerTagIndex(50,1),this._tadProxy.registerTagIndex(246,3),this._tadProxy.registerTagIndex(247,2),this._tadProxy.registerTagIndex(269,4),this._tadProxy.selectHandler=new Laya.Handler(this,this.pageSelectHander)),g.AccessCenter.ins.checkOpen(247)||(this._viewdlg.tab_pageBtn.getChildByName("item2").visible=!1,g.AccessCenter.ins.on(247,this,this.onActivityAccessUpdate)),g.AccessCenter.ins.checkOpen(246)||(this._viewdlg.tab_pageBtn.getChildByName("item3").visible=!1,g.AccessCenter.ins.on(246,this,this.onDefenseRingRingAccessUpdate)),g.AccessCenter.ins.checkOpen(269)||(this._viewdlg.tab_pageBtn.getChildByName("item4").visible=!1,g.AccessCenter.ins.on(269,this,this.onShieldRingAccessUpdate)),this.addEvent(),this.refreshHeadShow(),this},t.prototype.onDefenseRingRingAccessUpdate=function(){g.AccessCenter.ins.checkOpen(246)&&(this._viewdlg.tab_pageBtn.getChildByName("item3").visible=!0,g.AccessCenter.ins.off(246,this,this.onDefenseRingRingAccessUpdate))},t.prototype.onShieldRingAccessUpdate=function(){g.AccessCenter.ins.checkOpen(269)&&(this._viewdlg.tab_pageBtn.getChildByName("item4").visible=!0,g.AccessCenter.ins.off(269,this,this.onShieldRingAccessUpdate))},t.prototype.onActivityAccessUpdate=function(){g.AccessCenter.ins.checkOpen(247)&&(this._viewdlg.tab_pageBtn.getChildByName("item2").visible=!0,g.AccessCenter.ins.off(247,this,this.onActivityAccessUpdate))},t.prototype.addEvent=function(){r.RoleCenter.instans.vo.heronum<3&&c.E.ins.on(l.EventName.OPENNEW_HERO,this,this.refreshHeadShow),c.E.ins.on(_.EventRedDot.REFRESH_MABIHUSHEN,this,this.refreshHeadShow),this._viewdlg.bgView.btn_back.on(Laya.Event.CLICK,this,this.closeView),this._viewdlg.bgView.btn_close.on(Laya.Event.CLICK,this,this.closeView),this._viewdlg.tab_head.setCallbackHandler(new Laya.Handler(this,this.p_changePerson)),r.RoleCenter.instans.on(n.enumOpResultType.ring1+"",this,this.onRing1),r.RoleCenter.instans.on(n.enumOpResultType.ring2+"",this,this.onRing2),r.RoleCenter.instans.on(n.enumOpResultType.ring3+"",this,this.onRing3),r.RoleCenter.instans.on(n.enumOpResultType.ring4+"",this,this.onRing4)},t.prototype.refreshHeadShow=function(){this._viewdlg.tab_head.initData(r.RoleCenter.instans.self.openhero,this._nowSelectHero,r.RoleCenter.instans.vo),this.refreshRedDot()},t.prototype.refreshRedDot=function(){if(null!=this._view&&this._view.displayedInStage)switch(this._selectType){case 0:this._viewdlg.tab_head.refreshHeadRedHint(p.RedDot_Ring.Ins.getMabiRed(!0));break;case 1:this._viewdlg.tab_head.refreshHeadRedHint(p.RedDot_Ring.Ins.getHuShen(!0));break;case 2:this._viewdlg.tab_head.refreshHeadRedHint(p.RedDot_Ring.Ins.getFangYu(!0));break;case 3:this._viewdlg.tab_head.refreshHeadRedHint(p.RedDot_Ring.Ins.getGongJi(!0))}},t.prototype.onRing1=function(t){var e=t.reservedata[1],i=a.ItemUtils.getRing1VoById(e-1<0?0:e-1),n=r.RoleCenter.instans.vo,s=n.getOpenHeroByIdx(t.reservedata[0]);1==e&&o.TipManager.showType2Tip(129),s.ring1ID=e,u.sbkPropTool.resetRing1(s),s.combat=s.reCheckComBat(),n.combat=n.reCheckComBat(),r.RoleCenter.instans.event(l.EventName.FIGHT_UP,t.reservedata[2]),n.chgItemCount(parseInt(i.cost[0][0]),0-i.cost[0][1]),c.E.ins.event(l.EventName.CHANGEROLE_SHOW),this._view.playAni()},t.prototype.onRing2=function(t){var e=t.reservedata[1],i=a.ItemUtils.getRing2VoById(e-1<0?0:e-1),n=r.RoleCenter.instans.vo,s=n.getOpenHeroByIdx(t.reservedata[0]);s.ring2ID=e,u.sbkPropTool.resetRing2(s),s.combat=s.reCheckComBat(),n.combat=n.reCheckComBat(),1==e&&o.TipManager.showType2Tip(130),n.chgItemCount(parseInt(i.cost[0][0]),0-i.cost[0][1]),r.RoleCenter.instans.event(l.EventName.FIGHT_UP,t.reservedata[2]),c.E.ins.event(l.EventName.CHANGEROLE_SHOW),this._view.playAni()},t.prototype.onRing3=function(t){var e=t.reservedata[1],i=a.ItemUtils.getRing3VoById(e-1<0?0:e-1),n=r.RoleCenter.instans.vo,s=n.getOpenHeroByIdx(t.reservedata[0]);s.ring3ID=e,u.sbkPropTool.resetRing3(s),s.combat=s.reCheckComBat(),n.combat=n.reCheckComBat(),1==e&&o.TipManager.showType2Tip(484),n.chgItemCount(parseInt(i.cost[0][0]),0-i.cost[0][1]),r.RoleCenter.instans.event(l.EventName.FIGHT_UP,t.reservedata[2]),c.E.ins.event(l.EventName.CHANGEROLE_SHOW),this._view.playAni()},t.prototype.onRing4=function(t){var e=t.reservedata[1],i=a.ItemUtils.getRing4VoById(e-1<0?0:e-1),n=r.RoleCenter.instans.vo,s=n.getOpenHeroByIdx(t.reservedata[0]);s.ring4ID=e,u.sbkPropTool.resetRing4(s),s.combat=s.reCheckComBat(),n.combat=n.reCheckComBat(),1==e&&o.TipManager.showType2Tip(482),n.chgItemCount(parseInt(i.cost[0][0]),0-i.cost[0][1]),r.RoleCenter.instans.event(l.EventName.FIGHT_UP,t.reservedata[2]),c.E.ins.event(l.EventName.CHANGEROLE_SHOW),this._view.playAni()},t.prototype.p_changePerson=function(t){r.RoleCenter.instans.vo.getOpenHeroByIdx(t)?(this._nowSelectHero=t,this._viewdlg.tab_head.setSelectIndex(t),this.showTitle(),this._view.refreshData(t,this._selectType),this.refreshRedDot()):d.Switches.ins.event(15)},t.prototype.refreshData=function(){this._view&&this._view.refreshData(this._nowSelectHero,this._selectType)},t.prototype.changePerson=function(t){this._nowSelectHero=t,this._view&&this.p_changePerson(t)},t.prototype.pageSelectHander=function(t){this._viewdlg.tab_pageBtn.items[t]&&(this._viewdlg.select_img.x=this._viewdlg.tab_pageBtn.items[t].x,this._viewdlg.select_img.y=this._viewdlg.tab_pageBtn.items[t].y),0==t?(this._viewdlg.tab_head.refreshHeadRedHint(p.RedDot_Ring.Ins.getMabiRed(!0)),this._selectType=0):1==t?(this._viewdlg.tab_head.refreshHeadRedHint(p.RedDot_Ring.Ins.getHuShen(!0)),this._selectType=1):3==t?(this._viewdlg.tab_head.refreshHeadRedHint(p.RedDot_Ring.Ins.getFangYu(!0)),this._selectType=2):2==t&&(this._viewdlg.tab_head.refreshHeadRedHint(p.RedDot_Ring.Ins.getGongJi(!0)),this._selectType=3),this.p_changePerson(this._nowSelectHero),this.showTitle(),this.refreshRedDot(),this._view.refreshData(this._nowSelectHero,this._selectType),m.ClearResM.resetViewImg(this._view)},t.prototype.showView=function(t,e){this._typ=t,this._hidx=e,this.opens()},t.prototype.onAtlasLoaded=function(){this.realOpenRoleView()},t.prototype.realOpenRoleView=function(){this._nowSelectHero=this._hidx,49==this._typ?this._selectType=0:50==this._typ?this._selectType=1:246==this._typ?this._selectType=2:247==this._typ&&(this._selectType=3),this._view||this.init(),this._tadProxy.open(this._typ),this._view.refreshData(this._nowSelectHero,this._selectType),s.LayerManager.addInPOPWindowLayer(this._viewdlg,!1)},t.prototype.showTitle=function(){this._viewdlg.bgView.img_title.skin="res/roleSubjoin/ring_"+this._selectType+".png"},t.prototype.closeView=function(){this._viewdlg.hideView(),c.E.ins.event(l.EventName.CLOSEVIEW_RING)},t}(i.BaseCtrl);e.RingViewCtrl=I}),define("src/g/custom/detailDlgs/SuperMonthCardTip",["require","exports","src/init/Switches","src/g/clearRes/ClearResM"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.addEvent(),t.bgimg.restskin(),t}return __extends(t,e),t.prototype.addEvent=function(){this.btn_cancel.on(Laya.Event.CLICK,this,this.close),this.btn_close.on(Laya.Event.CLICK,this,this.close),this.btn_ok.on(Laya.Event.CLICK,this,this.onBuy)},t.prototype.onBuy=function(){i.Switches.ins.event(122),this.close()},t.prototype.close=function(t){void 0===t&&(t="side"),e.prototype.close.call(this,t),n.ClearResM.clearUrl(this.bgimg.skin)},t.create=function(){window.enabledpay&&(new t).popup()},t}(ui.alert.SuperMonthCardTipUI);e.SuperMonthCardTip=s}),define("src/g/forge_new/OnceMsgType",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init4Login=function(){t.Msg_Strong=!1,t.Msg_Gem=!1,t.Msg_Soul=!1,t.Msg_BagEqReslove=!1,t.Msg_Longlin=!1,t.Msg_LongWen=!1},t.Msg_Strong=!1,t.Msg_Gem=!1,t.Msg_Soul=!1,t.Msg_BagEqReslove=!1,t.Msg_Longlin=!1,t.Msg_LongWen=!1,t}();e.OnceMsgType=i}),define("src/g/roleSubJoin/view/DragonView",["require","exports","src/g/Effects/UIEffectsFactory","../../../manager/GameSocketManager","../../net/messages/OpResultType","../../net/messages/LongWen_LinC2GS","../../net/messages/ErrConst","../../../utils/system/ErrCodeView","../../../utils/ItemUtils","../../../manager/RoleCenter","src/g/custom/detailDlgs/SuperMonthCardTip","src/g/itemGets/View/ItemGetDlg","../../../meta/CommonVo","src/g/forge_new/OnceMsgType","src/init/TextConst","../../../config/GameConfig","src/g/clearRes/ClearResM","../../../component/LayoutUtil","../../../core/E"],function(t,e,i,s,o,a,r,l,m,_,h,c,u,p,C,I,b,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t._nowSelectHero=0,t._selectType=0,t.p_canUp=!1,t.p_maxLv=!1,t.LonglinNeedId=112,t.LongWenNeedId=113,t.msgSendTime=0,t.initAni(),t.btn_Up.delay=u.CommonVo.getVoByKey("anzhuTimeInterval").val2num,t.btn_Up.handler=new Laya.Handler(t,t.onClick),t.btn_autoUp.on(Laya.Event.CLICK,t,t.onUpAll),t.item_cost.setJump(C.TextConst.get(238),new Laya.Handler(t,t.ongetClieck));for(var e=1;e<=4;e++){t["jn"+e].on(Laya.Event.CLICK,t,t.skillIconClick)}t.btn_autoUp.visible=window.enabledpay;var i=t.btn_autoUp.parent.getChildIndex(t.btn_autoUp);return t.btn_autoUp.parent.getChildAt(i+1).visible=t.btn_autoUp.visible,d.LayoutUtil.layoutBox([t.btn_autoUp,t.btn_Up],2),t}return __extends(t,n),t.prototype.skillIconClick=function(t){var e,i,n=t.currentTarget,s=I.GameConfig.skillOpen,o=1;for(var a in i=0==this._selectType?(e=1,this.p_hero.longlinID):(e=2,this.p_hero.longwenID),s){var r=a.split("_");if(+r[0]==e){if(this["jn"+o]==n){g.E.ins.event("popWindSkill",[s[a].skillId,e,i,r[1]]);break}o++}}},t.prototype.initAni=function(){this.ani_put=i.UIEffectsFactory.Ins.createUIAniById(42,!0),this.ani_put.width*=1.3,this.ani_put.height*=1.1,this.ani_put.scale(1.3,1.1),i.UIEffectsFactory.Ins.centered4Parent(this.ani_put,this.btn_Up,!0),this.aniArr=[];for(var t=0;t<=1;t++){var e=i.UIEffectsFactory.Ins.createUIAniById(53+t);e.pivotX=e.width/2,e.pivotY=e.height,e.x+=15,e.y+=150,this.aniArr.push(e)}},t.prototype.playAni=function(t){void 0===t&&(t=!0),i.UIEffectsFactory.Ins.playAniOnce(t?11:38,this.sp)},t.prototype.onUpAll=function(){this.onAutoClicked()},t.prototype.onClick=function(){if(this.p_canUp){var t=new a.LongWen_LinC2GS;t.msgidx=0==this._selectType?o.enumOpResultType.longLin:o.enumOpResultType.longWen,t.heroidx=this._nowSelectHero,s.GSM.sendServer(t),0==this._selectType?p.OnceMsgType.Msg_Longlin=!0:p.OnceMsgType.Msg_LongWen=!0}else{if(this.btn_Up.label==C.TextConst.get(481))return l.ErrCodeView.show(0==this._selectType?r.enumErrConst.code_3111:r.enumErrConst.code_3114),this.getItem(0==this._selectType?this.LonglinNeedId:this.LongWenNeedId),!1;if(this.p_maxLv)return l.ErrCodeView.show(0==this._selectType?r.enumErrConst.code_3110:r.enumErrConst.code_3113),!1}return!0},t.prototype.ongetClieck=function(){this.getItem(0==this._selectType?this.LonglinNeedId:this.LongWenNeedId)},t.prototype.onAutoClicked=function(){if(_.RoleCenter.instans.vo.isSuperMonthCard){var t=new a.LongWen_LinC2GS;0==this._selectType?(p.OnceMsgType.Msg_Longlin=!0,t.msgidx=o.enumOpResultType.longLin_all):(p.OnceMsgType.Msg_LongWen=!0,t.msgidx=o.enumOpResultType.longWen_all),t.heroidx=this._nowSelectHero,s.GSM.sendServer(t)}else h.SuperMonthCardTip.create()},t.prototype.getItem=function(t){var e=m.ItemUtils.getItemVoById(t);(new c.ItemGetDlg).initByVo(e).popup()},t.prototype.refreshData=function(t,e){this._nowSelectHero==t&&this._selectType==e||(this.btn_autoUp.label=C.TextConst.get(738)),this._nowSelectHero=t,this._selectType=e,this.p_hero=_.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero),this.refreshIcon(),this.refreshAttr()},t.prototype.refreshAttr=function(){var t,e=0,i=0,n=0,s=0,o=this["box_"+this._selectType];if(0==this._selectType){t=1,this.box_0.visible=!0,this.box_1.visible=!1,e=this.p_hero.longlinID;for(var a=m.ItemUtils.getLongSoulVoById(e),r=m.ItemUtils.getLongSoulVoById(e+1),l=0;l<a.prop.length;l++){var h=o.getChildByName("lab_now_"+l);o.getChildByName("lab_next_"+l).text=r?(h.text=m.ItemUtils.getShuXingByName(a.prop[l][0]).desc+":"+a.prop[l][1],m.ItemUtils.getShuXingByName(r.prop[l][0]).desc+":"+r.prop[l][1]):(h.text=m.ItemUtils.getShuXingByName(a.prop[l][0]).desc+":"+a.prop[l][1],C.TextConst.get(208))}s=r?(i=_.RoleCenter.instans.vo.bagdata.getItemCount(parseInt(a.cost[0][0])),a.cost[0][1]):(i=_.RoleCenter.instans.vo.bagdata.getItemCount(parseInt(m.ItemUtils.getLongSoulVoById(e-1).cost[0][0])),0),n=this.LonglinNeedId,this.lab_lv.text=0==e?C.TextConst.get(485).split("").join("\n"):C.TextConst.get(17,e)}else{t=2,this.box_1.visible=!0,this.box_0.visible=!1,e=this.p_hero.longwenID;a=m.ItemUtils.getShieldVoById(e),r=m.ItemUtils.getShieldVoById(e+1);for(var c=0;c<a.prop.length;c++){h=o.getChildByName("lab_now_"+c);o.getChildByName("lab_next_"+c).text=r?(h.text=m.ItemUtils.getShuXingByName(a.prop[c][0]).desc+":"+a.prop[c][1],m.ItemUtils.getShuXingByName(r.prop[c][0]).desc+":"+r.prop[c][1]):(h.text=m.ItemUtils.getShuXingByName(a.prop[c][0]).desc+":"+a.prop[c][1],C.TextConst.get(208))}s=r?(i=_.RoleCenter.instans.vo.bagdata.getItemCount(parseInt(a.cost[0][0])),a.cost[0][1]):(i=_.RoleCenter.instans.vo.bagdata.getItemCount(parseInt(m.ItemUtils.getShieldVoById(e-1).cost[0][0])),0),n=this.LongWenNeedId,this.lab_lv.text=0==e?C.TextConst.get(485).split("").join("\n"):C.TextConst.get(17,e)}var u=I.GameConfig.skillOpen,p=1;for(var d in u){var g=d.split("_");if(+g[0]==t){var v=this["jn"+p],f=C.TextConst.get(524);e>=+g[1]?v.disabled=!1:(v.disabled=!0,v.mouseEnabled=!0,f=C.TextConst.get(15,C.TextConst.get(16,g[1]))),v.skin=m.ItemUtils.getSkillIconByIconId(u[d].skillId),b.ClearResM.resetViewImg(v),this["jnl"+p].text=f,p++}}this.btn_Up.label=0==e?C.TextConst.get(237):C.TextConst.get(615);var y=m.ItemUtils.getItemVoById(n);this.item_cost.setNeedName(y.name,m.ItemUtils.getSmallIcon(y.icon)),this.item_cost.setQualColor(m.ItemUtils.getColorByQuality(y.quality)),this.setNeed(i,s)},t.prototype.refreshIcon=function(){this.switchAni(0==this._selectType?1:2)},t.prototype.switchAni=function(t){this.icon_ani&&(this.sp_icon.removeChild(this.icon_ani),this.icon_ani.stop()),this.icon_ani=this.aniArr[t-1],this.icon_ani&&(this.sp_icon.addChild(this.icon_ani),this.icon_ani.play())},t.prototype.setNeed=function(t,e){this.p_canUp=e<=t&&0!=e,this.p_maxLv=0==e,this.item_cost.setNeed(t,e),this.btn_Up.label=this.p_canUp?C.TextConst.get(615):C.TextConst.get(481),this.btn_Up.visible=!this.p_maxLv,this.ani_put.visible=this.btn_Up.visible&&this.p_canUp},t}(ui.role.subJoin.DragonVIewUI);e.DragonView=n}),define("src/g/roleSubJoin/ctrl/DragonViewCtrl",["require","exports","src/g/base/BaseCtrl","../../net/messages/OpResultType","../../../manager/RoleCenter","../../../enum/EventName","../../../manager/LayerManager","src/g/roleSubJoin/view/DragonView","../../../core/E","../../../plugin/sbkPropTool","../../../vo/RedDot/role/RedDot_Dragon","../../../enum/GuideTargetName","../../../utils/UIUtils","../../../manager/GuideCenter","src/init/Switches","src/g/accessctrl/AccessCenter","src/g/proxy/MultiLevelUIProxy","src/g/roleSubJoin/view/SubJoinDlg","../../../manager/NewRedHintsCenter","src/g/clearRes/ClearResM","../../../vo/RedDot/EventRedDot","src/init/TextConst"],function(t,e,i,n,a,r,s,o,l,h,c,u,p,d,g,v,f,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var b=function(e){function t(){var t=e.call(this)||this;return t._nowSelectHero=0,t._selectType=0,t.closeOther=!1,t.forceOpen=!1,t._isregist=!1,t.urls=["res/atlas/res/roleSubjoin.json"],l.E.ins.on("dragon_design",t,t.fromPanel,[0]),l.E.ins.on("dragon_scales",t,t.fromPanel,[1]),g.Switches.ins.on(47,t,t.onOpenHandler,[47]),g.Switches.ins.on(48,t,t.onOpenHandler,[48]),t}return __extends(t,e),t.prototype.fromPanel=function(t,e){0==t?v.AccessCenter.ins.checkOpen(47,!0)&&this.showView(47,e,!1):1==t&&v.AccessCenter.ins.checkOpen(48,!0)&&this.showView(48,e,!1)},t.prototype.onOpenHandler=function(t,e,i,n,s){void 0===i&&(i=!0),void 0===n&&(n=!1),void 0===s&&(s=0),e&&this.showView(t,s)},t.prototype.init=function(){return this._view||(this._view=new o.DragonView,this._viewdlg=new y.SubJoinDlg,this._viewdlg.initTabName([I.TextConst.get(137),I.TextConst.get(138)],[m.enumRedHints.longlin,m.enumRedHints.longdun],!0),this._viewdlg.addPage(this._view),this._tadProxy=new f.MultiLevelUIProxy,this._tadProxy.registerTab(this._viewdlg.tab_pageBtn_dragon,0),this._tadProxy.registerTagIndex(47,0),this._tadProxy.registerTagIndex(48,1),this._tadProxy.selectHandler=new Laya.Handler(this,this.pageSelectHander),this._view.btn_Up.on(Laya.Event.MOUSE_DOWN,this,this.onBtnUpClickHandler)),this.addEvent(),this.refreshHeadShow(),this},t.prototype.addEvent=function(){a.RoleCenter.instans.vo.heronum<3&&l.E.ins.on(r.EventName.OPENNEW_HERO,this,this.refreshHeadShow),this._viewdlg.bgView.btn_back.on(Laya.Event.CLICK,this,this.closeView),this._viewdlg.bgView.btn_close.on(Laya.Event.CLICK,this,this.closeView),this._viewdlg.tab_head.setCallbackHandler(new Laya.Handler(this,this.p_changePerson)),l.E.ins.on(C.EventRedDot.REFRESH_LONGLINLONGWEN,this,this.refreshHeadShow),a.RoleCenter.instans.on(n.enumOpResultType.longWen+"",this,this.onLongWen),a.RoleCenter.instans.on(n.enumOpResultType.longLin+"",this,this.onLongLin),a.RoleCenter.instans.on(n.enumOpResultType.longWen_all+"",this,this.onLongWenAll),a.RoleCenter.instans.on(n.enumOpResultType.longLin_all+"",this,this.onLonglinAll)},t.prototype.refreshHeadShow=function(){this._viewdlg.tab_head.initData(a.RoleCenter.instans.self.openhero,this._nowSelectHero,a.RoleCenter.instans.vo),this.refreshRedDot()},t.prototype.refreshRedDot=function(){if(null!=this._view&&this._view.displayedInStage)switch(this._selectType){case 0:this._viewdlg.tab_head.refreshHeadRedHint(c.RedDot_Dragon.Ins.getLongLin(!0));break;case 1:this._viewdlg.tab_head.refreshHeadRedHint(c.RedDot_Dragon.Ins.getLongWen(!0))}},t.prototype.onLonglinAll=function(t){this.onLongLin(t)},t.prototype.onLongWenAll=function(t){this.onLongWen(t)},t.prototype.onLongWen=function(t){var e=t.reservedata[1],i=a.RoleCenter.instans.vo,n=i.getOpenHeroByIdx(t.reservedata[0]);n.longwenID=e;var s=i.combat;h.sbkPropTool.resetlongWen(n),h.sbkPropTool.reSetSkill();var o=i.reCheckComBat();a.RoleCenter.instans.event(r.EventName.FIGHT_UP,o-s),i.chgItemCount(t.reservedata[3],0-t.reservedata[4]),l.E.ins.event(r.EventName.CHANGEROLE_SHOW),this._view.playAni(1!=e),this.refreshRedDot()},t.prototype.onLongLin=function(t){var e=t.reservedata[1],i=a.RoleCenter.instans.vo,n=i.getOpenHeroByIdx(t.reservedata[0]);n.longlinID=e;var s=i.combat;h.sbkPropTool.resetlongLin(n),h.sbkPropTool.reSetSkill();var o=i.reCheckComBat();a.RoleCenter.instans.event(r.EventName.FIGHT_UP,o-s),i.chgItemCount(t.reservedata[3],0-t.reservedata[4]),l.E.ins.event(r.EventName.CHANGEROLE_SHOW),this._view.playAni(1!=e),this.refreshRedDot()},t.prototype.p_changePerson=function(t){a.RoleCenter.instans.vo.getOpenHeroByIdx(t)?(this._nowSelectHero=t,this._viewdlg.tab_head.setSelectIndex(t),this.showTitle(),this.refreshRedDot(),this.refreshData()):g.Switches.ins.event(15)},t.prototype.changePerson=function(t){this._nowSelectHero=t,this._view&&this.p_changePerson(t)},t.prototype.pageSelectHander=function(t){this._selectType=t,this.showTitle(),this.refreshRedDot(),this.p_changePerson(this._nowSelectHero),this.refreshData(),_.ClearResM.resetViewImg(this._view)},t.prototype.showView=function(t,e,i,n){void 0===e&&(e=0),void 0===i&&(i=!0),void 0===n&&(n=!1),this._typ=t,this._hidx=e,this.closeOther=i,this.forceOpen=n,this.opens()},t.prototype.onAtlasLoaded=function(){this.realOpenRoleView()},t.prototype.realOpenRoleView=function(){this._nowSelectHero=this._hidx,this._selectType=this._typ,this._view||this.init(),this._tadProxy.open(this._typ),this.refreshData(),this.refreshRedDot(),s.LayerManager.addInPOPWindowLayer(this._viewdlg,this.closeOther,!0,!0,!1,this.forceOpen),l.E.ins.event(r.EventName.COMPTYPE_OPENVIEW,u.GuideTargetName.DRAGON_VIEW),this._isregist||Laya.timer.frameOnce(2,this,this.registUIToGuide)},t.prototype.registUIToGuide=function(){var t=p.UIUtils.getGlobalBound(this._view.btn_Up);t&&(d.GuideCenter.ins.registerInteractionArea(u.GuideTargetName.DRAGON_VIEW_BTN_LEVEL_UP,t),d.GuideCenter.ins.registerGuideObject(u.GuideTargetName.DRAGON_VIEW_BTN_LEVEL_UP,this._view)),(t=p.UIUtils.getGlobalBound(this._viewdlg.bgView.btn_back))&&(d.GuideCenter.ins.registerInteractionArea(u.GuideTargetName.DRAGON_VIEW_BTN_BACK,t),d.GuideCenter.ins.registerGuideObject(u.GuideTargetName.DRAGON_VIEW_BTN_BACK,this._view)),this._isregist=!0},t.prototype.onBtnUpClickHandler=function(){l.E.ins.event(r.EventName.COMPTYPE_CLICK,u.GuideTargetName.DRAGON_VIEW_BTN_LEVEL_UP)},t.prototype.refreshData=function(){null!=this._view&&(this._view.refreshData(this._nowSelectHero,this._selectType),0==this._selectType?this._viewdlg.tab_head.refreshHeadRedHint(c.RedDot_Dragon.Ins.getLongLin(!0)):this._viewdlg.tab_head.refreshHeadRedHint(c.RedDot_Dragon.Ins.getLongWen(!0)))},t.prototype.showTitle=function(){this._viewdlg.bgView.img_title.skin="res/roleSubjoin/long_"+this._selectType+".png"},t.prototype.closeView=function(){this._viewdlg.hideView(),l.E.ins.event(r.EventName.COMPTYPE_CLOSEVIEW,u.GuideTargetName.DRAGON_VIEW)},t}(i.BaseCtrl);e.DragonViewCtrl=b}),define("src/g/role/view/GetZsEXPDlg",["require","exports","../../../manager/GameSocketManager","../../../config/GameConfig","../../../manager/RoleCenter","../../../utils/ItemUtils","src/g/custom/detailDlgs/Details_Item","../../net/messages/ZhuanshengC2GS","../../net/messages/OpResultType","../../net/messages/UseItemC2GS","src/g/Effects/UIEffectsFactory","src/init/Switches","../../../enum/EventName","../../../core/E","src/init/GameState","../../../utils/SoundUtils","src/init/TextConst","src/g/clearRes/ClearResM","../../../utils/UIUtils","../../../enum/LoadPriority"],function(t,e,o,n,a,r,s,l,h,c,u,p,d,g,v,f,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t.zSet=n.GameConfig.ZSSetting,t.extraUseArr=[],t.extraItemIdArr=[void 0,213,214],t.zsBtnAni=null,t._showLevel=-1,t._showExp=-1,t._showTotalExp=-1,t._targetExp=-1,t._addExpSpeed=10;for(var e=0;e<3;e++)t["text_"+e].style.fontSize=20,t["text_"+e].style.font="SimHei",t["text_canget_"+e].style.fontSize=20,t["text_canget_"+e].style.font="SimHei",t["icon_"+e].on(Laya.Event.CLICK,t,t.onClickIcon,[e]),t["btn_"+e].on(Laya.Event.CLICK,t,t.onClickUseBtn,[e]);return t.canUseArr=t.zSet.exchangecount,t.uvo=a.RoleCenter.instans.vo,t.bg.imgInnerBg.bottom=90,t.btn_zhuansheng.on(Laya.Event.CLICK,t,t.onBtnZhuanSheng),t.img_to_recharge.on(Laya.Event.CLICK,t,t.onToRechargeHandler),t.bg.btn_back.on(Laya.Event.CLICK,t,t.close),t.bg.btn_close.on(Laya.Event.CLICK,t,t.close),t.on(Laya.Event.UNDISPLAY,t,t.unDisplay),a.RoleCenter.instans.on(h.enumOpResultType.zhuansheng_downLv+"",t,t.onDownLv),a.RoleCenter.instans.on(h.enumOpResultType.zhuansheng_reset+"",t,t.reSetZS),g.E.ins.on(d.EventName.CHANGECURRENCY,t,t.onChangeCurrency),g.E.ins.on(d.EventName.USEITEMOVER,t,t.onUse),g.E.ins.on(d.EventName.CHANGEITEM_COUNT,t,t.refreshData),t.text_canget_2.style.align="right",t.text_canget_1.style.align="right",t.initExtraUseArr(),t}return __extends(t,i),t.prototype.initExtraUseArr=function(){this.extraUseArr=[0,a.RoleCenter.instans.vo.bagdata.getItemCount(this.extraItemIdArr[1]),a.RoleCenter.instans.vo.bagdata.getItemCount(this.extraItemIdArr[2])]},t.prototype.unDisplay=function(){a.RoleCenter.instans.off(h.enumOpResultType.zhuansheng_downLv+"",this,this.onDownLv),a.RoleCenter.instans.off(h.enumOpResultType.zhuansheng_reset+"",this,this.reSetZS),g.E.ins.off(d.EventName.CHANGECURRENCY,this,this.onChangeCurrency),g.E.ins.off(d.EventName.USEITEMOVER,this,this.onUse),g.E.ins.off(d.EventName.CHANGEITEM_COUNT,this,this.refreshData)},t.popup=function(){var t="res/atlas/res/role/zhuansheng.json";Laya.loader.getRes(t)?this.popuploadend():_.UIUtils.loadAtlas(t,this,this.popuploadend,C.LoadPriority.UI)},t.popuploadend=function(){(new t).popup()},t.prototype.popup=function(t,e){i.prototype.popup.call(this,t,e),this.onAtlasLoaded()},t.prototype.onAtlasLoaded=function(){m.ClearResM.resetViewImg(this),this.refreshData()},t.prototype.reSetZS=function(t){t.opresult&&this.refreshData()},t.prototype.onDownLv=function(t){this.refreshData()},t.prototype.onUse=function(t){var e=this.uvo.ZSCountArr;t.cfgId==this.extraItemIdArr[1]||t.cfgId==this.extraItemIdArr[2]?this.refreshData():t.cfgId!=this.zSet.item1&&t.cfgId!=this.zSet.item2||(t.cfgId==this.zSet.item1?e[1]++:t.cfgId==this.zSet.item2&&e[2]++,this.refreshData())},t.prototype.onToRechargeHandler=function(){1==v.GameState.index_first_recharge_state?(this.close(),f.SoundUtils.getInstance().playBtnsounds(),p.Switches.ins.event(13)):2==v.GameState.index_first_recharge_state&&(this.close(),f.SoundUtils.getInstance().playBtnsounds(),p.Switches.ins.event(111))},t.prototype.onBtnZhuanSheng=function(){var t=r.ItemUtils.getZhuanShengVoById(this.uvo.zhuanshengLv+1);if(t&&this.uvo.ZSEXP>=t.cost[0][1]){var e=new l.ZhuanshengC2GS;e.msgidx=h.enumOpResultType.zhuansheng,o.GSM.sendServer(e)}},t.prototype.onChangeCurrency=function(t){"ZSEXP"==t&&this.initExp()},t.prototype.onClickUseBtn=function(t){var e;if(0==t)return(n=new l.ZhuanshengC2GS).msgidx=h.enumOpResultType.zhuansheng_downLv,void o.GSM.sendServer(n);if(e=1==t&&0!=this.extraUseArr[1]?this.extraItemIdArr[1]:2==t&&0!=this.extraUseArr[2]?this.extraItemIdArr[2]:this.zSet["item"+t],0<this.uvo.bagdata.getItemCount(e)){var i=new c.UseItemC2GS;i.cfgId=e,i.count=1,o.GSM.sendServer(i)}else{var n,s=r.ItemUtils.getShop2VoByItemId(e);if(a.RoleCenter.instans.vo.GOLD<s.cost[0][1])return p.Switches.ins.event(155),void this.close();(n=new c.BuyAndUseItemC2GS).cfgId=s.id,o.GSM.sendServer(n)}this["btn_"+t].disabled=!0},t.prototype.onClickIcon=function(t){var e=new s.Details_Item;0==t?e.initData_CurrencyVo(r.ItemUtils.getCurrencyVoByDefine(this.zSet.item0),this.expnum):e.initData(r.ItemUtils.getItemVoById(this.zSet["item"+t]),1,!1),e.popup()},t.prototype.refreshData=function(){this.initExtraUseArr(),this.setIcon(),this.setCanGetCount(),this.setAddText(),this.checkHave(),this.initExp()},t.prototype.setCanGetCount=function(){var t=this.uvo.ZSCountArr;this.text_canget_0.innerHTML=this.getCanUse(this.canUseArr[0]-t[0]),0!=this.extraUseArr[1]?this.text_canget_1.innerHTML=y.TextConst.get(1168,this.canUseArr[1]-t[1]!=0?"#03bb00":"#ff0f15",this.canUseArr[1]-t[1],this.extraUseArr[1]):this.text_canget_1.innerHTML=this.getCanUse(this.canUseArr[1]-t[1]),0!=this.extraUseArr[2]?this.text_canget_2.innerHTML=y.TextConst.get(1168,this.canUseArr[2]-t[2]!=0?"#03bb00":"#ff0f15",this.canUseArr[2]-t[2],this.extraUseArr[2]):this.text_canget_2.innerHTML=this.getCanUse(this.canUseArr[2]-t[2])},t.prototype.setIcon=function(){this.icon_0.img_item.skin=r.ItemUtils.getIconByDefine(this.zSet.item0),this.icon_0.img_quality.skin=r.ItemUtils.getQualitybjByQualityId(r.ItemUtils.getCurrencyByDefine(this.zSet.item0).quality),this.icon_0.lab_num.visible=!1;for(var t=1;t<3;t++){var e=0!=this.extraUseArr[t]?this.extraItemIdArr[t]:this.zSet["item"+t],i=r.ItemUtils.getItemVoById(e),n=this["txt_item"+t];n&&(n.text=i.name),this["icon_"+t].img_item.skin=r.ItemUtils.getIconByIconId(i.icon),this["icon_"+t].img_quality.skin=r.ItemUtils.getQualitybjByQualityId(i.quality),this["icon_"+t].lab_num.text=""}var s=this.btn_zhuansheng,o=s.skin;s.skin="",s.skin=o},t.prototype.checkHave=function(){var t=0,e=0,i=this.extraUseArr;t=0!=i[1]?i[1]:this.uvo.bagdata.getItemCount(0!=i[1]?this.extraItemIdArr[1]:this.zSet.item1),e=0!=i[2]?i[2]:this.uvo.bagdata.getItemCount(0!=i[2]?this.extraItemIdArr[2]:this.zSet.item2);for(var n=this.uvo.ZSCountArr,s=0;s<3;s++){var o=!1,a=n[s],r=this.canUseArr[s],l=i[s];0==s?(this.uvo.lvl<81||r<=a)&&(o=!0):0==l&&r<=a&&(o=!0),this["btn_"+s].disabled=o}if(0==this.btn_0.disabled){var h=this.ani_downLv.getChildByName("ani");h||((h=u.UIEffectsFactory.Ins.createUIAniById(42,!0)).height*=1.1,h.scaleY=1.1,h.width*=1.3,h.scaleX=1.3,h.name="ani",u.UIEffectsFactory.Ins.centered4Parent(h,this.ani_downLv,!0))}else this.ani_downLv.removeChildren();0<t&&(this.box_1.getChildByName("text_useCount").text=y.TextConst.get(727,t)),this.btn_1.label=0<t?y.TextConst.get(728):y.TextConst.get(729),this.box_1.getChildByName("box_show").visible=!(0<t),this.box_1.getChildByName("text_useCount").visible=0<t,this.red_item.visible=!this.btn_1.disabled&&0<t,0<e&&(this.box_2.getChildByName("text_useCount").text=y.TextConst.get(727,e)),this.btn_2.label=0<e?y.TextConst.get(728):y.TextConst.get(729),this.box_2.getChildByName("box_show").visible=!(0<e),this.box_2.getChildByName("text_useCount").visible=0<e,this.red_superItem.visible=!this.btn_2.disabled&&0<e},t.prototype.setAddText=function(){var t=this.uvo.lvl-81;t=this.zSet.levelzsexp[t],this.btn_0.disabled=!1,(this.expnum=t)||(t=0,this.expnum=0,this.btn_0.disabled=!0),this.text_0.innerHTML=this.getAddText(t);var e=r.ItemUtils.getItemVoById(this.zSet.item1),i=0!=this.extraUseArr[1]?this.extraItemIdArr[1]:this.zSet.item1;e=r.ItemUtils.getItemVoById(i),this.text_1.innerHTML=this.getAddText(e.effect[0][1]),e=r.ItemUtils.getItemVoById(this.zSet.item2),this.text_2.innerHTML=this.getAddText(e.effect[0][1])},t.prototype.getHasCount=function(t){return y.TextConst.get(730,t)},t.prototype.getAddText=function(t){return y.TextConst.get(730,t)},t.prototype.getCanUse=function(t){return y.TextConst.get(731,0!=t?"#03bb00":"#ff0f15",t)},t.prototype.initExp=function(){var t=r.ItemUtils.getZhuanShengVoById(this.uvo.zhuanshengLv),e=r.ItemUtils.getZhuanShengVoById(this.uvo.zhuanshengLv+1);if(e&&this.uvo.ZSEXP>=e.cost[0][1]?(this.zsBtnAni||(this.zsBtnAni=u.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_zhuansheng,42,2.5,1.7)),this.zsBtnAni.visible=!0):this.zsBtnAni&&(this.zsBtnAni.visible=!1),!e)return this.text_count.changeText(y.TextConst.get(208)),this.bar_panel.width=this.bar_img.width,this.box_lv.visible=!1,this.lab_maxlv.value=t.id+"",this.box_maxLv.visible=!0,void(this.btn_zhuansheng.disabled=!0);var i=t.image2;this.guanggao.skin=i?i="res/role/zhuansheng/tipImage/"+i+".jpg":"",this.clip_left.value=this.uvo.zhuanshengLv+"",this.clip_right.value=this.uvo.zhuanshengLv+1+"",this.box_maxLv.visible=!1,this.box_lv.visible=!0,Laya.timer.callLater(this,this.setExpPro)},t.prototype.setExpPro=function(){var t=this.uvo.ZSEXP;-1==this._showLevel&&-1==this._showExp?(this._showLevel=this.uvo.zhuanshengLv,this._showExp=t,this._showTotalExp=this.getLevelExp(this.uvo.zhuanshengLv),this.calculateAddSpeed(),this.updateExpProcess(t,this._showTotalExp)):(this.uvo.zhuanshengLv>this._showLevel?this._targetExp=this.getLevelExp(this._showLevel):this._targetExp=t,Laya.timer.frameLoop(1,this,this.updateExp,null,!0))},t.prototype.updateExp=function(){this._showExp=this._showExp+this._addExpSpeed,this._showExp>this._targetExp&&(this._showExp=this._targetExp,this.uvo.zhuanshengLv>this._showLevel?(this._showLevel+=1,this._showTotalExp=this.getLevelExp(this._showLevel),this.calculateAddSpeed(),this._showExp=0,this._showLevel==this.uvo.zhuanshengLv?this._targetExp=this.uvo.ZSEXP:this._targetExp=this._showTotalExp):Laya.timer.clear(this,this.updateExp)),this.updateExpProcess(this._showExp,this._showTotalExp)},t.prototype.calculateAddSpeed=function(){this._addExpSpeed=Math.floor(this.getLevelExp(this._showLevel)/50),this._addExpSpeed<1&&(this._addExpSpeed=1)},t.prototype.getLevelExp=function(t){var e=r.ItemUtils.getZhuanShengVoById(t+1);return e||(e=r.ItemUtils.getZhuanShengVoById(t)),e.cost[0][1]},t.prototype.updateExpProcess=function(t,e){this.text_count.changeText(t+"/"+e);var i=!1;t<e&&(i=!0),this.btn_zhuansheng.disabled=i;var n=this.bar_img.width,s=this.bar_panel,o=t/e*n;s.width=n<=o?n:o,s.width>=n?u.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.ani_bar,1160,2.4):this.ani_bar.removeChildren()},t.prototype.close=function(){Laya.timer.clearAll(this),Laya.timer.clearAll(this.bar_panel),Laya.Tween.clearAll(this.bar_panel),m.ClearResM.clearResFolder("role/zhuansheng/tipImage/"),m.ClearResM.clearResFolder("role/zhuansheng/"),m.ClearResM.clearUrl("res/atlas/res/role/zhuansheng.json"),i.prototype.close.call(this)},t}(ui.role.Reincarnation.GetZsEXPDlgUI);e.GetZsExpDlg=i}),define("src/g/role/view/ReincamationPage",["require","exports","../../../utils/ItemUtils","../../../manager/RoleCenter","src/g/Effects/UIEffectsFactory","src/g/clearRes/ClearResM","../../../utils/RoleUtil","src/init/GameState","../../../utils/SoundUtils","src/init/Switches","src/init/TextConst","src/g/role/view/GetZsEXPDlg","../../../vo/RedDot/role/RedDot_ZhuanSheng"],function(t,e,n,i,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.loopTime=60,t.rotateAdd=2,t.onLoadUIEF(),t.on(Laya.Event.REMOVED,t,t.onRemoved),o.ClearResM.addBgUrl(t.imgbg.skin),o.ClearResM.addBgUrl(t.img_quan.skin),t.img_to_recharge.on(Laya.Event.CLICK,t,t.onToRechargeHandler),t.btn_getZSEXP.on(Laya.Event.CLICK,t,t.OngetZSEXP),t}return __extends(t,e),t.prototype.OngetZSEXP=function(){u.GetZsExpDlg.popup()},t.prototype.onToRechargeHandler=function(){1==r.GameState.index_first_recharge_state?(l.SoundUtils.getInstance().playBtnsounds(),h.Switches.ins.event(13)):2==r.GameState.index_first_recharge_state&&(l.SoundUtils.getInstance().playBtnsounds(),h.Switches.ins.event(111))},t.prototype.onRemoved=function(){Laya.timer.clear(this,this.bgRotate),this.rotateAdd=1,this.loopTime=60,o.ClearResM.clearUrl(this.imgbg.skin),o.ClearResM.clearUrl(this.img_quan.skin)},t.prototype.onAdded=function(){this.rotateAdd=1,Laya.timer.loop(this.loopTime,this,this.bgRotate)},t.prototype.bgRotate=function(){this.img_quan.rotation+=this.rotateAdd},t.prototype.refreshShow=function(){this._uvo=i.RoleCenter.instans.vo,this.showAttr(),this.setNeedAndHas(),this.setTitle(),this.imgbg.restskin(),this.img_quan.restskin(),p.RedDot_ZhuanSheng.Ins.getExp?this.ani_put.visible=!0:this.ani_put.visible=!1},t.prototype.onLoadUIEF=function(){this.ani_up=s.UIEffectsFactory.Ins.createUIAniById(40,!0),s.UIEffectsFactory.Ins.centered4Parent(this.ani_up,this.btn_up,!0),this.ani_put=s.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_getZSEXP,42,1,.9),this.ani_put.visible=!1},t.prototype.showUpAni=function(){},t.prototype.showAttr=function(){for(var t=n.ItemUtils.getZhuanShengVoById(this._uvo.zhuanshengLv),e=n.ItemUtils.getZhuanShengVoById(this._uvo.zhuanshengLv+1),i=0;i<t.prop.length;i++)this["lab_now_"+i].text=n.ItemUtils.getShuXingByName(t.prop[i][0]).desc+":"+t.prop[i][1];for(i=0;i<t.prop.length;i++)this["lab_next_"+i].text=e?n.ItemUtils.getShuXingByName(e.prop[i][0]).desc+":"+e.prop[i][1]:c.TextConst.get(208);this.view_fightBox.setFightNum(a.RoleUtil.calFightByProp(t.prop))},t.prototype.setNeedAndHas=function(){this.lab_has.text=this._uvo.ZSEXP+"";var t=n.ItemUtils.getZhuanShengVoById(this._uvo.zhuanshengLv+1);t?(this.lab_need.text=t.cost[0][1]+"",this.btn_getZSEXP.visible=!0,this.btn_up.visible=!0,t.cost[0][1]>this._uvo.ZSEXP?(this.ani_up.visible=!1,this.lab_has.color="#ff0f15"):(this.ani_up.visible=!0,this.lab_has.color="#03bb00")):(this.lab_need.text="0",this.btn_up.visible=!1,this.btn_getZSEXP.visible=!1,this.lab_has.color="#03bb00")},t.prototype.setTitle=function(){this.lab_nowLv.text=c.TextConst.get(719,this._uvo.zhuanshengLv)},t}(ui.role.Reincarnation.ReincarnationViewUI);e.ReincamationPage=d}),define("src/g/role/ctrl/ReincamationPageCtrl",["require","exports","../../net/messages/OpResultGS2C","../../net/messages/OpResultType","../../net/messages/ZhuanshengC2GS","src/g/role/view/ReincamationPage","../../../manager/RoleCenter","../../../utils/ItemUtils","../../../core/E","../../../enum/EventName","../../../manager/GameSocketManager","src/g/fight/osprite/SceneObjCtroller","../../../plugin/sbkPropTool","../../../vo/RedDot/EventRedDot","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/init/ResManager","src/init/TextConst","src/g/role/view/GetZsEXPDlg"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(){function t(){l.E.ins.on(d.EventRedDot.REFRESH_ZHUANSHENG,this,this.refreshData),c.GSM.ins.on(i.OpResultGS2C.KEY,this,this.onOpResult)}return t.prototype.onOpResult=function(t){t.msgidx==n.enumOpResultType.activity_nextDay&&(a.RoleCenter.instans.vo.ZSCountArr=[0,0,0],l.E.ins.event(h.EventName.CHANGECURRENCY,["ZSEXP"]))},t.prototype.init=function(){return this._view||(this._view=new o.ReincamationPage),this._view.on(Laya.Event.REMOVED,this,this.onRemoved),this},t.prototype.onRemoved=function(){this._view&&(this._view.removeSelf(),this._view.destroy(),this._view=null)},t.prototype.onLoadUIEF=function(){},t.prototype.addEvent=function(){a.RoleCenter.instans.on(n.enumOpResultType.zhuansheng+"",this,this.OnZhuanShengOVER),this._view.btn_up.on(Laya.Event.CLICK,this,this.onUpZSLEVEL)},t.prototype.closeRoleView=function(){this._view.removeSelf(),this._view.destroy(),this._view=null},t.prototype.OnZhuanShengOVER=function(t){g.FE.zsEff();var e,i=a.RoleCenter.instans.vo,n=t.reservedata[0],s=r.ItemUtils.getZhuanShengVoById(n);if(i.zhuanshengLv=n,p.sbkPropTool.resetZs(),n<=8)for(var o=0;o<i.heronum;o++)null==(e=i.getOpenHeroByIdx(o)).passive.idArr[i.zhuanshengLv-1]&&e.passive.idArr.push(0),e.combat=e.reCheckComBat();i.combat=i.reCheckComBat(),a.RoleCenter.instans.vo.ZSEXP-=s.cost[0][1],a.RoleCenter.instans.event(h.EventName.FIGHT_UP,t.reservedata[1]),this._view&&this._view.showUpAni(),l.E.ins.event(d.EventRedDot.REFRESH_ZHUANSHENG),l.E.ins.event(d.EventRedDot.REFRESH_ROLE),u.SceneObjCtroller.ins.getSelfGroup().resetHP()},t.prototype.onUpZSLEVEL=function(){var t=a.RoleCenter.instans.vo,e=t.ZSEXP;if(r.ItemUtils.getZhuanShengVoById(t.zhuanshengLv+1).cost[0][1]<=e){var i=new s.ZhuanshengC2GS;i.msgidx=n.enumOpResultType.zhuansheng,c.GSM.sendServer(i)}else g.FE.upItems(y.TextConst.get(721),v.BubbleEnum.center),m.GetZsExpDlg.popup()},t.prototype.showPage=function(t){if(this._parent=t,!this._view&&(this.init(),this.addEvent(),this.onLoadUIEF(),this._parent.removeChildren(),this._parent.addChild(this._view),this.refreshData(),this._view&&this._view.onAdded))try{this._view.onAdded()}catch(t){}},t.prototype.changePerson=function(t){this._view.parent==this._parent&&this.refreshData()},t.prototype.refreshData=function(){this._view&&this._view.refreshShow()},t.prototype.getTitle=function(){return"res/role/zhuanshengtitle.png"},t.prototype.hidePage=function(){f.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){f.ResManager.getInstance().destroyPageCtrl(this)},t}();e.ReincamationPageCtrl=_}),define("src/g/role/view/Dlg_WingUseItem",["require","exports","../../net/messages/ErrConst","../../../utils/system/ErrCodeView","../../../manager/RoleCenter","../../../utils/ItemUtils","../../net/messages/OpResultType","../../../manager/GameSocketManager","../../net/messages/PromoteWingC2Gs"],function(t,e,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(t){var e=i.call(this)||this;return e._nowSelectHero=0,e._nowSelectHero=t,e.bg.btn_close.visible=!1,e.addEvent(),e}return __extends(t,i),t.prototype.addEvent=function(){this.btn_close.on(Laya.Event.CLICK,this,this.onClose),this.btn_yes.on(Laya.Event.CLICK,this,this.onOKClick),this.btn_no.on(Laya.Event.CLICK,this,this.onChanle)},t.prototype.onOKClick=function(){var t=a.ItemUtils.getWingConfigVoById(1).levelitem;if(0<o.RoleCenter.instans.vo.bagdata.getItemCount(t)){var e=new h.PromoteWingC2GS;e.heroidx=this._nowSelectHero,e.starPromote=!1,e.uselevelItem=!0,e.msgidx=r.enumOpResultType.PromoteWing_uselevelItem,l.GSM.sendServer(e),this.onClose()}else s.ErrCodeView.show(n.enumErrConst.code_2207),this.onClose()},t.prototype.onClose=function(){this.close()},t.prototype.onChanle=function(){this.onClose()},t}(ui.role.Wing.UseItemUI);e.Dlg_WingUseItem=i}),define("src/g/lottery/view/ShenyuSkillDlg",["require","exports","../../../utils/ItemUtils"],function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this,e=t.lab_desc.style;return e.font="SimHei",e.align="left",e.color="#a89e8f",e.stroke=1,e.fontSize=20,e.wordWrap=!0,e.strokeColor="#060606",t}return __extends(t,i),t.prototype.setIcon=function(t){this.lab_skillName.text=t.name,this.img_skillIcon.skin=n.ItemUtils.getSkillIconByIconId(t.icon)},t}(ui.lottery.ShenyuSkillDlgUI);e.ShenyuSkillDlg=i}),define("src/g/role/view/WingPage",["require","exports","../../../utils/ItemUtils","../../../meta/WingLevelVo","../../../config/GameConfig","../../../manager/RoleCenter","../../../manager/TipManager","../../../core/E","../../../enum/EventName","src/g/Effects/UIEffectsFactory","src/g/itemGets/View/ItemGetDlg","../../../meta/CommonVo","src/g/clearRes/ClearResM","src/g/lottery/view/ShenyuSkillDlg","src/g/jineng/vo/SkillOpenVo","../../net/messages/sbkYCSkillData","src/init/TextConst"],function(t,e,h,r,i,l,s,o,a,c,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t._isAutoUpStar=!1,t.isShowCurr=!0,t._url_bg="res/bg/yuyi_beijingtu.jpg",t.tmp=1,t.aniSourceArr=[],t.init(),t.scrollRect=new Laya.Rectangle(0,0,600,1024),t.on(Laya.Event.REMOVED,t,t.onRemoved),o.E.ins.on(a.EventName.WING_UPSTAR,t,t.playUpStateAni),t.jdqiehuan.on(Laya.Event.CLICK,t,t.wingCheck),t.item_cost.setJump(y.TextConst.get(238),new Laya.Handler(t,t.onShowGetDlg));var e=h.ItemUtils.getItemVoById(106);t.item_cost.setNeedName(e.name,h.ItemUtils.getSmallIcon(e.icon)),t.item_cost.setQualColor(h.ItemUtils.getColorByQuality(e.quality));for(var i=0;i<4;i++){t["jn"+i].on(Laya.Event.CLICK,t,t.skillIconClick,[i])}return t}return __extends(t,n),t.prototype.wingCheck=function(t){this.jdqiehuan.mouseEnabled=!1;var e=this.ani_wing_next,i=this.ani_wing,n=this.p_data.level<=1?1:this.p_data.level;p.CommonVo.getVoByKey("wingsMaxLevel").value<=n||(n+=1);var s=this.p_Arr_wingLevel[n];if(s){var o=h.ItemUtils.getAvtoarSource(s.res,0);e.source!=o&&this.setAniSource(e,s.res,0),e.visible=!0}else e.visible=!1;this.isShowCurr?(Laya.Tween.to(e,{x:e.x-this.width},500,null,new Laya.Handler(this,this.qiehuanComplete)),Laya.Tween.to(i,{x:i.x-this.width},500,null)):(Laya.Tween.to(e,{x:e.x+this.width},500,null,new Laya.Handler(this,this.qiehuanComplete)),Laya.Tween.to(i,{x:i.x+this.width},500,null))},t.prototype.qiehuanComplete=function(){this.isShowCurr=!this.isShowCurr,this.isShowCurr?this.jdqiehuan.text=y.TextConst.get(736):this.jdqiehuan.text=y.TextConst.get(737),this.jdqiehuan.mouseEnabled=!0},t.prototype.onShowGetDlg=function(){u.ItemGetDlg.create(106)},t.prototype.onRemoved=function(){this.clearAni(),this.imgbg.skin=null,Laya.loader.clearRes(this._url_bg)},t.prototype.init=function(){this.bar_panel.width=1,this.list_star.renderHandler=new Laya.Handler(this,this.starRender),this.p_roleBagData=l.RoleCenter.instans.vo.bagdata,this.p_Arr_wingLevel=i.GameConfig.winglevelJSON,this.p_Arr_wingStar=i.GameConfig.wingstarJSON,this.p_wingconfig=i.GameConfig.WingConfigJson[1],o.E.ins.on(a.EventName.WINGLEVEL,this,this.showLevelTip)},t.prototype.refreshAni=function(){var t,e=this.p_data;if(this.p_data){var i=this.p_Arr_wingLevel;(t=e.level<=1?1:e.level)+1>=i.length&&(this.jdqiehuan.visible=!1);var n=h.ItemUtils.getAvtoarSource(i[t].res,0);this.ani_wing.source!=n&&this.setAniSource(this.ani_wing,i[t].res,0),this.isShowCurr||this.wingCheck()}},t.prototype.showLevelTip=function(t){s.TipManager.showWingTip(t)},t.prototype.clearAni=function(){for(var t=0;t<this.aniSourceArr.length;t++)Laya.loader.clearRes(this.aniSourceArr[t],!1);this.aniSourceArr=[]},t.prototype.setAniSource=function(t,e,i){var n=h.ItemUtils.getAvtoarSource(e,i);this.aniSourceArr.push(n),Laya.loader.load(n,Laya.Handler.create(this,function(t,e){t.source=e,t.interval=120},[t,n]),null,Laya.Loader.ATLAS)},t.prototype.skillIconClick=function(t){for(var e=this.p_data.level,i=v.SkillOpenVo.getSkillList(f.enumYCSkillType.wing)[t],n=new g.ShenyuSkillDlg,s=h.ItemUtils.getSkillDefItem(i.skillId),o=s.desc,a=s.effect,r=0;r<a.length;r++){var l=a[r];o=o.replace("{"+l[0]+"}",l[1]/1e4+"")}o=o.replace("{rate}",s.rate/100+""),n.lab_open.text=e>=i.level?y.TextConst.get(524):y.TextConst.get(485),n.lab_desc.innerHTML=o,n.setIcon(s),n.popup()},t.prototype.showData=function(t){this.p_data=t.heroWing,this.box_open.visible=t.openWing,this.box_activate.visible=!t.openWing;var e=t.heroWing.level;this.view_stage.num.value=e+"",t.openWing&&this.setDataShow(),this.imgbg.skin=this._url_bg},t.prototype.playUpStateAni=function(){c.UIEffectsFactory.Ins.playAniOnce(11,this.upAni,1.3,1.3)},t.prototype.setDataShow=function(){var t=this.p_data;this.box_fightNum.setFightNum(t.combat);var e=10*t.level==t.star,i=h.ItemUtils.getWingStarVoById(t.star);this.btn_upLv.visible=e,this.box_upStar.visible=!e,this.showAttr(t.star),this.setStarNum(),this.showFeather(),e?(i=h.ItemUtils.getWingStarVoById(t.star-1),this.lab_exp.changeText((i.exp||0)+"/"+(i.exp||0)),Laya.Tween.clearAll(this.bar_panel),this.bar_panel.width=448):t.level==this.p_wingconfig.maxLevel?(this.bar_panel.width=448,this.lab_exp.changeText(y.TextConst.get(208))):this.setBar(),this.btn_autoUp.visible=40<=l.RoleCenter.instans.vo.getCurLv(),this.btn_upStar.visible=!this.btn_autoUp.visible;for(var n=v.SkillOpenVo.getSkillList(f.enumYCSkillType.wing),s=0;s<n.length;s++){var o=n[s],a=y.TextConst.get(524),r=this["jn"+s];t.level>=o.level?r.disabled=!1:(a=y.TextConst.get(15,y.TextConst.get(7,o.level)),r.disabled=!0,r.mouseEnabled=!0),r.skin=h.ItemUtils.getSkillIconByIconId(o.skillId),d.ClearResM.resetViewImg(r),this["jnl"+s].text=a}},t.prototype.showAttr=function(t){for(var e=this.p_Arr_wingStar[t].prop,i=this.p_Arr_wingLevel[this.p_data.level].prop,n=0;n<e.length;n++){this.box_nowAttr.getChildByName("lab_"+n).changeText(h.ItemUtils.getShuXingByName(e[n][0]).desc+":"+(e[n][1]+i[n][1]))}if(this.p_data.level==this.p_wingconfig.maxLevel&&t>=this.p_wingconfig.maxStar){for(n=0;n<e.length;n++){this.box_lastAttr.getChildByName("lab_"+n).changeText(y.TextConst.get(208))}this.list_star.visible=!1,this.box_upStar.visible=!1,this.p_data.level==this.p_wingconfig.maxLevel&&(this.btn_upLv.visible=!1)}else{this.box_lastAttr.visible=!0,this.list_star.visible=!0;var s=this.p_Arr_wingStar[t+1].prop,o=[];if(t/10-this.p_data.level==0){s=this.p_Arr_wingStar[t].prop;var a=this.p_Arr_wingLevel[this.p_data.level+1];null!=r.WingLevelVo?o=a.prop:a=this.p_Arr_wingLevel[this.p_data.level]}else{o=(a=this.p_Arr_wingLevel[this.p_data.level]).prop}for(n=0;n<s.length;n++){this.box_lastAttr.getChildByName("lab_"+n).changeText(s[n][1]+(0<o.length?o[n][1]:0))}}},t.prototype.setStarNum=function(){for(var t=this.p_data.star-(10*this.p_data.level-10),e=[],i=0;i<10;i++)e.push(i<t?1:null);this.list_star.dataSource=e},t.prototype.showFeather=function(){var t=this.p_roleBagData.getItemCount(this.p_wingconfig.itemcost),e=h.ItemUtils.getWingLevelVoById(this.p_data.level).wingscost;this.item_cost.setNeed(t,e)},t.prototype.setBar=function(){var t=this.p_data.exp||0,e=this.p_Arr_wingStar[this.p_data.star].exp||0;this.lab_exp.changeText(t+"/"+e),0==e&&(e=1);var i=448/e*t;i=0==i?1:i,Laya.Tween.to(this.bar_panel,{width:i},80)},t.prototype.showTip=function(t){var e=new Laya.Label;e.color="#149b14",e.fontSize=18,e.bold=!0,e.text=y.TextConst.get(91,t),this.box_open.addChild(e),e.x=this.box_open.width/2-e.width/2,e.y=this.box_attbg.y,e.strokeColor="#000000",e.stroke=1,Laya.Tween.to(e,{y:e.y-80},700,null,new Laya.Handler(this,function(t){t.removeSelf()},[e]))},t.prototype.starRender=function(t,e){t.skin="res/custom/juese_jingmai_"+(t.dataSource?"xing":"kongxing")+".png"},t}(ui.role.Wing.WingViewUI);e.WingPage=n}),define("src/g/role/ctrl/WingPageCtrl",["require","exports","src/g/role/view/Dlg_WingUseItem","../../../config/GameConfig","../../../utils/system/FloatEffect","../../../utils/ItemUtils","../../../enum/EventName","../../net/messages/OpResultType","../../net/messages/PromoteWingC2Gs","../../../manager/GameSocketManager","../../net/messages/ActivateWingC2GS","../../../manager/RoleCenter","src/g/role/view/WingPage","../../../core/E","src/g/base/BaseCtrl","../../../plugin/sbkPropTool","../../net/messages/sbkFormula","../../../manager/TipManager","../../../vo/RedDot/EventRedDot","../../../plugin/view/ToolTip","src/g/accessctrl/AccessCenter","src/g/clearRes/ClearResM","../../../enum/GuideTargetName","src/init/Switches","src/init/TextConst","src/init/ResManager"],function(t,e,i,n,a,l,h,r,c,u,s,p,o,d,g,v,f,y,m,_,C,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var T=function(e){function t(){var t=e.call(this)||this;return t._nowSelectHero=0,t._isAutoUpStar=!1,t.url="res/atlas/res/role/wing.json",C.AccessCenter.ins.on(42,t,t.onAccessOpen),d.E.ins.on(h.EventName.CHANGEITEM_COUNT,t,t.onChangeItem),d.E.ins.on(h.EventName.ADDED_LEVEL,t,t.onChangeCurrenty),t}return __extends(t,e),t.prototype.init=function(){return this.p_wingconfig=n.GameConfig.WingConfigJson[1],this._view||(this._view=new o.WingPage),this.addEvent(),this},t.prototype.onRemoved=function(t){t==b.GuideTargetName.ROLE_VIEW&&(I.ClearResM.clearUrl("res/role/wing/shenyu_beijingtu.jpg"),this.clearCtrlRes(),this._view&&(I.ClearResM.clearUrl(this._view.ani_wing.source),this._view.destroy(),this._view=null))},t.prototype.addEvent=function(){this._view.btn_activate.on(Laya.Event.CLICK,this,this.onActivateWing),this._view.btn_autoUp.on(Laya.Event.CLICK,this,this.checkAuto),this._view.btn_upLv.on(Laya.Event.CLICK,this,this.onUpLv),this._view.btn_upStar.on(Laya.Event.CLICK,this,this.onUpStar4Feather),this._view.btn_zhisheng.on(Laya.Event.CLICK,this,this.onUseLevelItem),this._view.btn_godWing.on(Laya.Event.CLICK,this,this.openGodWing),this._view.on(Laya.Event.REMOVED,this,this.onAutoUp,[!0]),d.E.ins.on(h.EventName.COMPTYPE_CLOSEVIEW,this,this.onRemoved),d.E.ins.on(h.EventName.AVTOAR,this,this.onAvtoarChange),p.RoleCenter.instans.on(r.enumOpResultType.ActivateWing+"",this,this.onActivate),p.RoleCenter.instans.on(r.enumOpResultType.PromoteWing_starPromote+"",this,this.onPromoteWing_starPromote),p.RoleCenter.instans.on(r.enumOpResultType.PromoteWing_starUseItem+"",this,this.onPromoteWing_starUseItem),p.RoleCenter.instans.on(r.enumOpResultType.PromoteWing_uselevelItem+"",this,this.onPromoteWing_uselevelItem)},t.prototype.onAccessOpen=function(){C.AccessCenter.ins.off(42,this,this.onAccessOpen)},t.prototype.onChangeItem=function(t){106==t&&this.refreshData()},t.prototype.onChangeCurrenty=function(t){void 0===t&&(t=""),"MONEY"==t&&this.refreshData()},t.prototype.openGodWing=function(){w.Switches.ins.event(44,[!1,this._nowSelectHero])},t.prototype.onAvtoarChange=function(){this._view&&this._view.refreshAni()},t.prototype.onActivate=function(t){if(t.opresult){var e=p.RoleCenter.instans.self.openhero[t.reservedata[0]];e.openWing=!0,e.heroWing.level=1,d.E.ins.event("WING_ACTIVATE"),y.TipManager.showWingTip(1),this.refreshData(),d.E.ins.event(h.EventName.AVTOAR),d.E.ins.event(h.EventName.CHANGEITEM_COUNT,[106])}},t.prototype.onPromoteWing_uselevelItem=function(t){if(t.opresult){var e=p.RoleCenter.instans.vo,i=e.getOpenHeroByIdx(t.reservedata[0]),n=i.heroWing,s=e.combat,o=n.level;n.exp=t.reservedata[1],n.star=t.reservedata[2],n.level=t.reservedata[3],n.level!=o&&(d.E.ins.event(h.EventName.AVTOAR),d.E.ins.event(h.EventName.WING_UPLV)),v.sbkPropTool.resetAllWing(i);var a=e.reCheckComBat();n.combat=f.sbkFormula.calPropFightMainCombat(n.levelProp)+f.sbkFormula.calPropFightMainCombat(n.starProp),p.RoleCenter.instans.event(h.EventName.FIGHT_UP,a-s),d.E.ins.event(h.EventName.WINGSTAGEUP);var r=l.ItemUtils.getWingConfigVoById(1);p.RoleCenter.instans.vo.chgItemCount(r.levelitem,-1),this.refreshData(),this.refreshRedHintWing()}},t.prototype.onPromoteWing_starUseItem=function(t){if(t.opresult){var e=l.ItemUtils.getWingConfigVoById(1),i=p.RoleCenter.instans.vo,n=i.getOpenHeroByIdx(t.reservedata[0]),s=n.heroWing;s.exp=t.reservedata[1],s.star/10>>0==s.level+1&&this.onAutoUp(!0);var o=l.ItemUtils.getWingLevelVoById(s.level);p.RoleCenter.instans.vo.chgItemCount(e.itemcost,-o.wingscost);var a=i.combat;s.star=t.reservedata[2];var r=s.level;s.level=t.reservedata[3],s.level!=r&&(d.E.ins.event(h.EventName.AVTOAR),d.E.ins.event(h.EventName.WING_UPLV)),v.sbkPropTool.resetAllWing(n),n.combat=n.reCheckComBat(),i.combat=i.reCheckComBat(),i.combat>a&&(s.combat=f.sbkFormula.calPropFightMainCombat(s.levelProp)+f.sbkFormula.calPropFightMainCombat(s.starProp),p.RoleCenter.instans.event(h.EventName.FIGHT_UP,i.combat-a));l.ItemUtils.getWingLevelVoById(s.level);this._view&&this._view.showTip(o.wingsreward),this.refreshData(),this.refreshRedHintWing()}},t.prototype.onPromoteWing_starPromote=function(t){if(t.opresult){var e=p.RoleCenter.instans.vo,i=e.getOpenHeroByIdx(t.reservedata[0]),n=i.heroWing,s=e.combat;n.exp=t.reservedata[1],n.star=t.reservedata[2];var o=n.level;n.level=t.reservedata[3],n.level!=o&&(d.E.ins.event(h.EventName.AVTOAR),d.E.ins.event(h.EventName.WING_UPLV)),v.sbkPropTool.resetAllWing(i),i.combat=i.reCheckComBat(),e.combat=e.reCheckComBat(),e.combat>s&&(n.combat=f.sbkFormula.calPropFightMainCombat(n.levelProp)+f.sbkFormula.calPropFightMainCombat(n.starProp),p.RoleCenter.instans.event(h.EventName.FIGHT_UP,e.combat-s)),d.E.ins.event(h.EventName.WINGSTAGEUP),d.E.ins.event(h.EventName.CHANGEITEM_COUNT,[106]),this.refreshData(),this.refreshRedHintWing()}},t.prototype.onActivateWing=function(){var t=new s.ActivateWingC2GS;t.heroindex=this._nowSelectHero,u.GSM.sendServer(t)},t.prototype.onUpLv=function(){var t=new c.PromoteWingC2GS;t.heroidx=this._nowSelectHero,t.starPromote=!1,t.msgidx=r.enumOpResultType.PromoteWing_starPromote,u.GSM.sendServer(t)},t.prototype.onUpStar4Feather=function(){var t=this;if(!this._isAutoUpStar){if(this._view.btn_upStar.mouseEnabled=!1,Laya.timer.once(100,this,function(){t._view&&t._view.btn_upStar&&(t._view.btn_upStar.mouseEnabled=!0)}),p.RoleCenter.instans.vo.bagdata.getItemCount(this.p_wingconfig.itemcost)<l.ItemUtils.getWingLevelVoById(p.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero).heroWing.level).wingscost)return a.FE.upItems(S.TextConst.get(724),_.BubbleEnum.center),!1;var e=new c.PromoteWingC2GS;return e.heroidx=this._nowSelectHero,e.starPromote=!0,e.usemoney=!1,e.msgidx=r.enumOpResultType.PromoteWing_starUseItem,u.GSM.sendServer(e),!0}},t.prototype.onUseLevelItem=function(){var t=p.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero),e=t.heroWing;t.openWing&&(l.ItemUtils.getWingLevelVoById(e.level+1)?10*e.level==e.star?a.FE.upItems(S.TextConst.get(723),_.BubbleEnum.center):new i.Dlg_WingUseItem(this._nowSelectHero).popup():a.FE.upItems(S.TextConst.get(722),_.BubbleEnum.center))},t.prototype.onAutoUp=function(t){if(t)return this._isAutoUpStar=!0,void this.checkAuto();if(!this._view.displayedInStage)return this._isAutoUpStar=!0,void this.checkAuto();var e=p.RoleCenter.instans.vo,i=e.getWingByHeroId(this._nowSelectHero);if(10*i.level!=i.star){var n=l.ItemUtils.getWingLevelVoById(e.getOpenHeroByIdx(this._nowSelectHero).heroWing.level),s=e.bagdata.getItemCount(this.p_wingconfig.itemcost)>=n.wingscost;if(!s)return this._isAutoUpStar=!0,a.FE.upItems(S.TextConst.get(724),_.BubbleEnum.center),void this.checkAuto();this._isAutoUpStar=!0;var o=new c.PromoteWingC2GS;return o.heroidx=this._nowSelectHero,o.starPromote=!0,s?(o.usemoney=!1,o.msgidx=r.enumOpResultType.PromoteWing_starUseItem,void u.GSM.sendServer(o)):void 0}this.checkAuto()},t.prototype.checkAuto=function(){this._isAutoUpStar?(Laya.timer.clear(this,this.onAutoUp),this._isAutoUpStar=!1):(this._isAutoUpStar=!0,Laya.timer.loop(200,this,this.onAutoUp,[!1])),this._view.btn_autoUp.label=this._isAutoUpStar?S.TextConst.get(726):S.TextConst.get(725)},t.prototype.showPage=function(t){this._parent=t,this.open(),I.ClearResM.resetViewImg(this._parent),E.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.onAtlasLoaded=function(){this.realShowPage()},t.prototype.realShowPage=function(){this._parent.removeChildren(),this._view||this.init(),this._view.btn_zhisheng.restskin(),this._view.btn_godWing.restskin(),this.refreshData(),this._parent.addChild(this._view),this._view.upAni.removeChildren(),d.E.ins.event(h.EventName.AVTOAR)},t.prototype.changePerson=function(t){this._nowSelectHero=t,this._view&&(this._isAutoUpStar=!0,this.checkAuto(),this.refreshData(),this._view.refreshAni())},t.prototype.refreshData=function(){var t=p.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero);this._view&&(this._view.showData(t),this.refreshRedHintWing())},t.prototype.refreshRedHintWing=function(){d.E.ins.event(m.EventRedDot.REFRESH_ROLE)},t.prototype.getTitle=function(){return"res/title/title.png"},t.prototype.hidePage=function(){E.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){E.ResManager.getInstance().destroyPageCtrl(this)},t}(g.BaseCtrl);e.WingPageCtrl=T}),define("src/g/role/view/DlgRoleAttribute",["require","exports","../../net/messages/sbkFormula","../../../utils/ItemUtils","../../../meta/ShuXingVo","../../../manager/RoleCenter"],function(t,e,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t._nowSelect=0,t.btn_left.on(Laya.Event.CLICK,t,t.lclick),t.btn_right.on(Laya.Event.CLICK,t,t.rclick),t}return __extends(t,e),t.prototype.lclick=function(){this.refreshData(this._nowSelect-=1)},t.prototype.rclick=function(){this.refreshData(this._nowSelect+=1)},t.prototype.refreshData=function(t){var e=C.RoleCenter.instans.vo,i=e.getOpenHeroByIdx(t);i||this.close(),this.img_job.skin="res/role/job_"+i.jobid+".png",this.btn_left.visible=!(0==t),this.btn_right.visible=!!e.getOpenHeroByIdx(t+1);var n=m.ItemUtils.getShuXingByName("HP"),s=e.getProp("HP")+i.getProp("HP");s*=1+(e.getMULTI("HP")+i.getProp("HP_MULTI"))/y.sbkFormula.BASEDIV_VAL,this.lab_HP.text=_.ShuXingVo.getString4Vo(s>>0,n),n=m.ItemUtils.getShuXingByName("MP");var o=e.getProp("MP")+i.getProp("MP");o*=1+(e.getMULTI("MP")+i.getProp("MP_MULTI"))/y.sbkFormula.BASEDIV_VAL,this.lab_MP.text=_.ShuXingVo.getString4Vo(o>>0,n),n=m.ItemUtils.getShuXingByName("ATT");var a=e.getProp("ATT")+i.getProp("ATT");a*=1+(e.getMULTI("ATT")+i.getProp("ATT_MULTI"))/y.sbkFormula.BASEDIV_VAL,this.lab_ATT.text=_.ShuXingVo.getString4Vo(a>>0,n),n=m.ItemUtils.getShuXingByName("PDEF");var r=e.getProp("PDEF")+i.getProp("PDEF");r*=1+(e.getMULTI("PDEF")+i.getProp("PDEF_MULTI"))/y.sbkFormula.BASEDIV_VAL,this.lab_PDEF.text=_.ShuXingVo.getString4Vo(r>>0,n),n=m.ItemUtils.getShuXingByName("SDEF");var l=e.getProp("SDEF")+i.getProp("SDEF");l*=1+(e.getMULTI("SDEF")+i.getProp("SDEF_MULTI"))/y.sbkFormula.BASEDIV_VAL,this.lab_SDEF.text=_.ShuXingVo.getString4Vo(l>>0,n),n=m.ItemUtils.getShuXingByName("STRONG");var h=e.getProp("STRONG")+i.getProp("STRONG");this.lab_STRONG.text=_.ShuXingVo.getString4Vo(h,n),n=m.ItemUtils.getShuXingByName("MISS");var c=e.getProp("MISS")+i.getProp("MISS");this.lab_MISS.text=_.ShuXingVo.getString4Vo(c,n),n=m.ItemUtils.getShuXingByName("STRONGHURT");var u=e.getProp("STRONGHURT")+i.getProp("STRONGHURT");this.lab_STRONGHURT.text=_.ShuXingVo.getString4Vo(u,n),n=m.ItemUtils.getShuXingByName("ANTISTRONG");var p=e.getProp("ANTISTRONG")+i.getProp("ANTISTRONG");this.lab_ANTISTRONG.text=_.ShuXingVo.getString4Vo(p,n),n=m.ItemUtils.getShuXingByName("CHOAS");var d=e.getProp("CHOAS")+i.getProp("CHOAS");this.lab_CHOAS.text=_.ShuXingVo.getString4Vo(d,n),n=m.ItemUtils.getShuXingByName("ANTICHOAS");var g=e.getProp("ANTICHOAS")+i.getProp("ANTICHOAS");this.lab_ANTICHOAS.text=_.ShuXingVo.getString4Vo(g,n),n=m.ItemUtils.getShuXingByName("INCHURT");var v=e.getProp("INCHURT")+i.getProp("INCHURT");this.lab_INCHURT.text=_.ShuXingVo.getString4Vo(v,n),n=m.ItemUtils.getShuXingByName("DECHURT");var f=e.getProp("DECHURT")+i.getProp("DECHURT");this.lab_DECHURT.text=_.ShuXingVo.getString4Vo(f,n)},t.prototype.showView=function(t){this._nowSelect=t,this.refreshData(t),this.popup()},t.prototype.hideView=function(){this.removeSelf()},t.prototype.destroyView=function(){},t}(ui.role.DlgRoleAttributeUI);e.DlgRoleAttribute=i}),define("src/g/role/view/EquipPage",["require","exports","../../../enum/EventName","../../../core/E","src/g/Effects/UIEffectsFactory","src/g/role/ctrl/EquipPageCtrl","../../../enum/enumItem","../../../utils/ItemUtils","../../../manager/RoleCenter","src/g/custom/detailDlgs/Details_Equip","../../../vo/RedDot/role/RedDot_Ring","../../../vo/RedDot/role/RedDot_Govern","../../../vo/RedDot/role/RedDot_Dragon","src/g/clearRes/ClearResM","../../net/messages/PutonEquipC2GS","../../../manager/GameSocketManager","../../../enum/GuideTargetName","../../../meta/QualiyVo","../../../meta/CommonVo","src/init/TextConst","../../../utils/RoleUtil","src/init/Switches"],function(t,e,o,r,g,v,l,f,i,a,h,n,c,s,u,p,d,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var b=function(e){function t(){var t=e.call(this)||this;return t._nowSelectHero=0,t.curX=0,t.oldX=0,t.abs=0,t.curIndex=0,t.onLoadUIEF(),t.on(Laya.Event.REMOVED,t,t.onRemove),Laya.stage.on(Laya.Event.MOUSE_UP,t,t.Touch_UP),Laya.stage.on(Laya.Event.MOUSE_DOWN,t,t.Touch_DOWN),s.ClearResM.addBgUrl(t.bgimg.skin),r.E.ins.on(o.EventName.FASHION_STATE_CHANGED,t,t.onFashionChanged),r.E.ins.on(o.EventName.FU_MO_LEVEL_UP,t,t.onFuMoLvUpHandler),t.btn_fly.on(Laya.Event.CLICK,t,t.flyHandler),t}return __extends(t,e),t.prototype.flyHandler=function(){I.Switches.ins.event(300)},t.prototype.onFuMoLvUpHandler=function(t,e){this._nowSelectHero==t&&this.showData(this._nowSelectHero)},t.prototype.onRemove=function(){Laya.stage.off(Laya.Event.MOUSE_UP,this,this.Touch_UP),Laya.stage.off(Laya.Event.MOUSE_DOWN,this,this.Touch_DOWN),r.E.ins.off(o.EventName.FASHION_STATE_CHANGED,this,this.onFashionChanged),Laya.loader.clearRes(this.bgimg.skin)},t.prototype.onLoadUIEF=function(){g.UIEffectsFactory.Ins.createAndCenter(this.btn_putOn,40,!0),this.btn_putOn.visible=!1,g.UIEffectsFactory.Ins.createAndCenter(this.ani_shenbing,41,!0),this.ani_shenbing.visible=!1,g.UIEffectsFactory.Ins.createAndCenter(this.ani_dress,41,!0),this.ani_dress.visible=!1,g.UIEffectsFactory.Ins.createAndCenter(this.ani_govern,41,!0),this.ani_govern.visible=!1,g.UIEffectsFactory.Ins.createAndCenter(this.ani_rexue,41,!0),this.ani_rexue.visible=!1,g.UIEffectsFactory.Ins.createAndCenter(this.ani_shenzhuang,41,!0),this.ani_shenzhuang.visible=!1,g.UIEffectsFactory.Ins.createAndCenter(this.ani_godcast,41,!0),this.ani_godcast.visible=!1},t.prototype.onFashionChanged=function(t){this.p_heroIdx==t&&this.displayedInStage&&this.refreshAni()},t.prototype.initShow=function(){this.view_fightNum.setFightNum(this.p_heroData.combat),this.initDragon(),this.initEquip(this.p_heroData.equpos),this.initRing(),n.RedDot_Govern.Ins.checkAll(),this.refreshAni(),this.btn_putOn.visible=this.hasCanPut,r.E.ins.event(o.EventName.CHECK_EQ_PUT_ON_BTN,this.hasCanPut)},t.prototype.showAni=function(t,e){if(e==this.p_heroIdx){var i=this.getChildByName("equip_"+ktgame.RoleDefineMod.arr_equipPosConst[t]);i.sp.removeChildren();var n=g.UIEffectsFactory.Ins.createUIAniById(3,!1);g.UIEffectsFactory.Ins.centered4Parent(n,i.sp,!0),n.on(Laya.Event.COMPLETE,this,this.aniStopCall,[n]),n.play(0,!1)}},t.prototype.aniStopCall=function(t){t.stop(),t.removeSelf()},t.prototype.showData=function(t){this._nowSelectHero=t,this.p_heroIdx=t,this.p_heroData=i.RoleCenter.instans.vo.getOpenHeroByIdx(this.p_heroIdx),this.initShow(),this.bgimg.restskin()},t.prototype.refreshAni=function(){r.E.ins.offAll(o.EventName.HERO_TWEENL),r.E.ins.offAll(o.EventName.HERO_TWEENR),C.RoleUtil.refreshZww(this.p_heroData,120,this.ani_wing,this.ani_weapon,this.ani_role,this.ani_fumo)},t.prototype.Touch_DOWN=function(t){this.curX=t.stageX},t.prototype.Touch_UP=function(t){this.oldX=t.stageX,this.abs=Math.abs(this.curX-this.oldX),120<this.abs&&(this.curX>this.oldX?(this.curIndex+=1,2<this.curIndex&&(this.curIndex=0)):(this.curIndex-=1,this.curIndex<0&&(this.curIndex=2)),r.E.ins.event(o.EventName.HERO_CHOOSE,this.curIndex))},t.prototype.equipClick=function(t){var e=[];if(v.EquipPageCtrl.canPutArr[this._nowSelectHero]){var i,n=v.EquipPageCtrl.canPutArr[this._nowSelectHero];if(n[t.equpos]&&n[t.equpos].equtemplet)(i=new u.PutonEquipC2GS).equid=n[t.equpos].equid,i.equpos=t.equpos,i.heroidx=this._nowSelectHero,e.push(i)}if(0<e.length)(i=new u.PutonEquipListC2GS).list=e,p.GSM.sendServer(i),r.E.ins.event(o.EventName.COMPTYPE_CLICK,d.GuideTargetName.ROLE_VIEW_BTN_PUTON);else if(t.equins.equtemplet){var s=new a.Details_Equip;s.initData(t,null,null,this.p_heroData),s.popup()}},t.prototype.initEquip=function(t){this.hasCanPut=!1;for(var e=0;e<t.length;e++){var i=t[e],n=i.equpos-1,s=this.getChildByName("equip_"+ktgame.RoleDefineMod.arr_equipPosConst[n]);if(s){s.setClieckHD(null);var o=i.equins.equtemplet,a=new Laya.Handler(this,this.equipClick,[i]);s.setClieckHD(a);var r=0<o,l=f.ItemUtils.getEquipVoById(o);l||(r=!1);var h=r?f.ItemUtils.getIconById(l.id):"res/custom/equipIcon/equip_"+ktgame.RoleDefineMod.arr_equipPosConst[n]+".png";s.setName(r?f.ItemUtils.getEquipLv(l.limit):"");var c,u=y.QualityStruct.Ins.transEquipQuality(l);for(0==u&&(u=1),s.setTrait(u,y.QualityStruct.Ins.getQPicById(u)),s.setEnhance(r?i.stronglv:0),s.setSoul(r?i.soullv:0),s.showGod(!!r&&0<i.shenzhulv);0<s.qualAni.numChildren;)(c=s.qualAni.removeChildAt(s.qualAni.numChildren-1))&&c.destroy();var p=y.QualityStruct.Ins.getQEffByEquip(i);0<p&&(c=g.UIEffectsFactory.Ins.createUIAniById(p,!0),g.UIEffectsFactory.Ins.centered4Parent(c,s.qualAni,!0),c.play()),s.showIcon(h);var d=v.EquipPageCtrl.canPutArr[this.p_heroIdx]&&v.EquipPageCtrl.canPutArr[this.p_heroIdx][i.equpos];d&&(this.hasCanPut=!0),s.showTip(d)}}},t.prototype.initRing=function(){for(var e=this,t=[_.TextConst.get(139),_.TextConst.get(140)],i=0;i<2;i++){var n=this.getChildByName("ring_"+ktgame.RoleDefineMod.arr_ringPosConst[i]);if(n){n.setName(t[i]),n.lab_enhance.x=50,n.lab_enhance.y=72;var s=new Laya.Handler(this,function(t){r.E.ins.event(t,[e.p_heroIdx])},[n.name]);n.setClieckHD(s);var o=0==i?this.p_heroData.ring1ID:this.p_heroData.ring2ID;n.setEnhance(o),n.setTrait(l.enumItem.orange,y.QualityStruct.Ins.getQPicById(l.enumItem.orange)),n.setSoul(),n.showGod(!1),n.showTip(!1);var a=o<=0?"_gray":"";n.img_tip.visible=0==i?h.RedDot_Ring.Ins.getMabiRed(!0)[this.p_heroIdx]||h.RedDot_Ring.Ins.getFangYu(!0)[this.p_heroIdx]||h.RedDot_Ring.Ins.getGongJi(!0)[this.p_heroIdx]:h.RedDot_Ring.Ins.getHuShen(!0)[this.p_heroIdx],n.showIcon("res/custom/equipIcon/ring_"+ktgame.RoleDefineMod.arr_ringPosConst[i]+a+".png"),o<=0?(n.setTrait(l.enumItem.gray,y.QualityStruct.Ins.getQPicById(l.enumItem.gray)),n.sp.removeChildren(),n.img_item.visible=!0):(n.img_item.visible=!1,0==n.sp.numChildren&&g.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(n.sp,49+i,.4,.4),n.setTrait(l.enumItem.orange,y.QualityStruct.Ins.getQPicById(l.enumItem.orange))),n.lab_ItemName.color="#dcc026",n.img_bg.skin=f.ItemUtils.getQualitybjByQualityId(m.CommonVo.getVoByKey("qulity_mabi").val2num)}}},t.prototype.initDragon=function(){for(var e=this,t=[_.TextConst.get(137),_.TextConst.get(138)],i=0;i<2;i++){var n=this.getChildByName("dragon_"+ktgame.RoleDefineMod.arr_dragonPosConst[i]);if(n){n.setName(t[i]),n.lab_enhance.x=50,n.lab_enhance.y=72;var s=new Laya.Handler(this,function(t){r.E.ins.event(t,[e.p_heroIdx])},[n.name]);n.setClieckHD(s);var o=0==i?this.p_heroData.longlinID:this.p_heroData.longwenID;n.setEnhance(o),n.setSoul(),n.showGod(!1),n.showTip(!1),n.img_tip.visible=0==i?c.RedDot_Dragon.Ins.getLongLin(!0)[this.p_heroIdx]:c.RedDot_Dragon.Ins.getLongWen(!0)[this.p_heroIdx];var a=o<=0?"_gray":"";n.showIcon("res/custom/equipIcon/dragon_"+ktgame.RoleDefineMod.arr_dragonPosConst[i]+a+".png"),o<=0?(n.setTrait(l.enumItem.gray,y.QualityStruct.Ins.getQPicById(l.enumItem.gray)),n.sp.removeChildren(),n.img_item.visible=!0):(n.img_item.visible=!1,0==n.sp.numChildren&&g.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(n.sp,49+i+4,.35,.35),n.setTrait(l.enumItem.orange,y.QualityStruct.Ins.getQPicById(l.enumItem.orange))),n.img_bg.skin=f.ItemUtils.getQualitybjByQualityId(m.CommonVo.getVoByKey("qulity_long").val2num)}}},t}(ui.role.Equip.EquipViewUI);e.EquipPage=b}),define("src/g/role/ctrl/EquipPageCtrl",["require","exports","../../../utils/ItemUtils","../../../manager/GameSocketManager","../../net/messages/PutonEquipC2GS","../../../enum/EventName","src/g/role/view/DlgRoleAttribute","../../../manager/RoleCenter","src/g/role/view/EquipPage","../../../core/E","../../../enum/GuideTargetName","../../../utils/UIUtils","../../../manager/GuideCenter","../../../vo/RedDot/role/RedDot_Equip","../../../vo/RedDot/EventRedDot","../../../vo/RedDot/lottery/RedDot_ChengZhuang","src/init/Switches","src/init/ResManager","src/g/shenbing/view/subpage/Sb_SkillPage"],function(t,e,a,r,l,h,i,c,n,u,p,s,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function o(){this._nowSelectHero=0,u.E.ins.on(h.EventName.AVTOAR,this,this.onAvtoarChange),u.E.ins.on(h.EventName.HASNEWCANPUTEQUIP,this,this.onHasCanPutEquip),u.E.ins.on(h.EventName.PUTNEWEQUIPED,this,this.onPutNewEquip),u.E.ins.on(h.EventName.CHANGEROLE_SHOW,this,this.onHasCanPutEquip),u.E.ins.on(h.EventName.CLOSEVIEW_CHENGZHANG,this,this.refreshData),u.E.ins.on(h.EventName.CLOSEVIEW_GODCAST,this,this.refreshData),u.E.ins.on(h.EventName.CLOSEVIEW_RING,this,this.refreshData),u.E.ins.on(h.EventName.CLOSEVIEW_ZHUZAI,this,this.refreshData),u.E.ins.on(v.EventRedDot.REFRESH_EQUIP,this,this.refreshData)}return o.prototype.init=function(){return this._view||(this._view=new n.EquipPage),this.addEvent(),this},o.prototype.addEvent=function(){this._view.btn_showAttr.on(Laya.Event.CLICK,this,this.onShowAttr),this._view.btn_dress.on(Laya.Event.CLICK,this,this.onDress),this._view.btn_putOn.on(Laya.Event.CLICK,this,this.onPutEquip),this._view.btn_govern.on(Laya.Event.CLICK,this,this.openSuit),this._view.btn_rexue.on(Laya.Event.CLICK,this,this.onOpenReXue),this._view.btn_shenbing.on(Laya.Event.CLICK,this,this.onOpenShenBing),this._view.btn_shenzhu.on(Laya.Event.CLICK,this,this.openGodCast),this._view.btn_chengzhuang.on(Laya.Event.CLICK,this,this.openChengZhuangHandler),this._view.btn_ss.on(Laya.Event.CLICK,this,this.onssClick),this._view.on(Laya.Event.REMOVED,this,this.onRemoved)},o.prototype.onssClick=function(t){y.Switches.ins.event(239)},o.prototype.onRemoved=function(){this._view&&!m.ResManager.getInstance().checkIsInLimitMemery()&&(this._view.removeSelf(),this._view.destroy(),this._view=null,Laya.loader.clearRes("res/bg/juese_ditubeijing.png"))},o.prototype.openGodCast=function(){y.Switches.ins.event(57,[!1,!0,this._nowSelectHero])},o.prototype.onOpenReXue=function(){y.Switches.ins.event(174,[!1,!0,this._nowSelectHero])},o.prototype.onOpenShenBing=function(){_.Sb_SkillPage.openType=0,y.Switches.ins.event(188,[!1,!0,this._nowSelectHero])},o.prototype.openSuit=function(){y.Switches.ins.event(51,[0,this._nowSelectHero])},o.prototype.bandRedHint=function(){},o.prototype.openChengZhuangHandler=function(){y.Switches.ins.event(55,[!1,this._nowSelectHero])},o.prototype.onPutEquip=function(){var t=[];if(o.canPutArr[this._nowSelectHero])for(var e=c.RoleCenter.instans.self.openhero[this._nowSelectHero].equpos,i=o.canPutArr[this._nowSelectHero],n=0;n<=e.length;n++)if(i[n]&&i[n].equtemplet){var s=new l.PutonEquipC2GS;a.ItemUtils.getEquipVoById(i[n].equtemplet);s.equid=i[n].equid,s.equpos=n,s.heroidx=this._nowSelectHero,t.push(s)}0<t.length&&((s=new l.PutonEquipListC2GS).list=t,r.GSM.sendServer(s));u.E.ins.event(h.EventName.COMPTYPE_CLICK,p.GuideTargetName.ROLE_VIEW_BTN_PUTON)},o.prototype.onDress=function(){y.Switches.ins.event(59)},o.prototype.onAvtoarChange=function(){this._view&&this._view.refreshAni()},o.prototype.onPutNewEquip=function(t){this._view&&this._view.showAni(t.equpos-1,t.heroidx),this.onPutClear(t),f.RedDot_ChengZhuang.Ins.recheckChengZhuang(),u.E.ins.event(v.EventRedDot.REFRESH_EQUIP),u.E.ins.event(v.EventRedDot.REFRESH_ROLE),u.E.ins.event(v.EventRedDot.REFRESH_CHENGZHUANG),this._view&&this.refreshData()},o.prototype.onPutClear=function(t){var e=c.RoleCenter.instans.vo,i=e.getOpenHeroByIdx(t.heroidx).equpos[t.equpos-1];if(0==a.ItemUtils.getEquipVoById(i.equins.equtemplet).job)for(var n=0;n<e.heronum;n++){o.canPutArr[n]&&delete o.canPutArr[n][i.equpos]}o.canPutArr[t.heroidx]&&o.canPutArr[t.heroidx][i.equpos]&&o.canPutArr[t.heroidx]&&delete o.canPutArr[t.heroidx][i.equpos],g.RedDot_Equip.Ins.checkEquip(),u.E.ins.event(v.EventRedDot.REFRESH_ROLE),u.E.ins.event(v.EventRedDot.REFRESH_EQUIP)},o.prototype.onHasCanPutEquip=function(){this._view&&this._view.parent==this._parent&&this.refreshData()},o.prototype.onShowAttr=function(){(new i.DlgRoleAttribute).showView(this._nowSelectHero)},o.prototype.getView=function(){return this._view},o.prototype.showPage=function(t){this._parent=t,this._parent.removeChildren(),this._view||this.init(),this.refreshData(),this._parent.addChild(this._view),this._isregist||Laya.timer.frameOnce(2,this,this.registUIToGuide)},o.prototype.registUIToGuide=function(){if(this._view&&this._view.btn_putOn){var t=s.UIUtils.getGlobalBound(this._view.btn_putOn);t&&d.GuideCenter.ins.registerInteractionArea(p.GuideTargetName.ROLE_VIEW_BTN_PUTON,t);var e=this._view.getChildByName("dragon_design");(t=s.UIUtils.getGlobalBound(e))&&d.GuideCenter.ins.registerInteractionArea(p.GuideTargetName.ROLE_VIEW_BTN_LONGLIN,t),e=this._view.getChildByName("dragon_scales"),(t=s.UIUtils.getGlobalBound(e))&&d.GuideCenter.ins.registerInteractionArea(p.GuideTargetName.ROLE_VIEW_BTN_LONGWEN,t),this._isregist=!0}},o.prototype.changePerson=function(t){this._nowSelectHero=t,this._view&&this._view.displayedInStage&&this.refreshData()},o.prototype.refreshData=function(){this._view&&this._view.showData(this._nowSelectHero)},o.prototype.getTitle=function(){return"res/role/roletitle.png"},o.prototype.hidePage=function(){},o.prototype.destroyPage=function(){},o.canPutArr={},o}();e.EquipPageCtrl=o}),define("src/g/role/view/GRoleBgDlg",["require","exports","../../../manager/LayerManager"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.bg_view.btn_help.visible=!1,t}return __extends(t,e),t.prototype.init=function(){},t.prototype.showView=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),i.LayerManager.addInPOPWindowLayer(this,t,!0,!0,!1,e)},t.prototype.hideView=function(){this.bg_view.box_page.removeChildren(),this.removeSelf()},t.prototype.destroyView=function(){this.hideView()},t}(ui.role.Page_RoleBgUI);e.GRoleBgDlg=n}),define("src/g/artifacts/ctrl/ArtifactsData",["require","exports","../../../config/GameConfig","../../../core/E","../../../enum/EventName","../../../manager/NewRedHintsCenter"],function(t,e,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t._isInit=!1,t._redPromptState=0,t}return __extends(i,e),i.prototype.init=function(){0==this._isInit&&(this.initArtifactsLvMap(),this._isInit=!0)},Object.defineProperty(i.prototype,"redPromptState",{get:function(){return this._redPromptState},set:function(t){this._redPromptState!=t&&(0!=this._redPromptState&&0!=t||s.E.ins.event(o.EventName.ARTIFACTS_RED_PROMPT_STATE,t),this._redPromptState=t,this.event(i.RED_PROMPT_STATE_CHANGED,t),a.NewRedHintsCenter.ins.setRedHintOpenOrClose(a.enumRedHints.roleChuanShi,0<t))},enumerable:!0,configurable:!0}),i.prototype.initArtifactsLvMap=function(){for(var t in this._artifactsLvMap=new Object,this._maxLv=[0,0,0,0,0,0,0,0],n.GameConfig.artifactsLevelJSON){var e=n.GameConfig.artifactsLevelJSON[t];this._artifactsLvMap[1e4*e.type+e.level]=e,this._maxLv[e.type-1]<e.level&&(this._maxLv[e.type-1]=e.level)}},i.prototype.getArtifactsLevelVo=function(t,e){return this._artifactsLvMap[1e4*t+e]},i.prototype.getMaxLevelByType=function(t){return this._maxLv[t-1]},i.RED_PROMPT_STATE_CHANGED="RED_PROMPT_STATE_CHANGED",i}(Laya.EventDispatcher);e.ArtifactsData=i}),define("src/g/artifacts/view/ArtifactsSkillTip",["require","exports","src/init/TextConst","../../../utils/ItemUtils","../../../config/GameConfig"],function(t,e,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this,e=t.lab_desc.style;return e.font="SimHei",e.color="#a89e8f",e.stroke=1,e.fontSize=20,e.wordWrap=!0,e.strokeColor="#060606",t}return __extends(t,i),t.prototype.initData=function(t,e){this.lab_open.text=e>=t.level?u.TextConst.get(524):u.TextConst.get(485),this.lab_lv.text=t.skillId%100+"";var i=p.ItemUtils.getSkillDefItem(t.skillId);this.lab_skillName.color="#fff55c",this.lab_skillName.changeText(i.name),this.img_skillIcon.skin=p.ItemUtils.getSkillIconByIconId(i.icon);for(var n=i.desc,s=0;s<i.effect.length;s++)n=n.replace("{"+i.effect[s][0]+"}",i.effect[s][1]/1e4+"");n=n.replace("{rate}",i.rate/100+""),this.lab_desc.innerHTML=n;var o,a=t.skillId+1,r=-1;for(var l in d.GameConfig.skillOpen)if((o=d.GameConfig.skillOpen[l])&&o.type==t.type&&o.skillId==a){r=o.level;break}var h=u.TextConst.get(979);7==t.type?h=u.TextConst.get(980):8==t.type&&(h=u.TextConst.get(981));var c=u.TextConst.get(982,h,t.level);-1<r&&(c+="("+u.TextConst.get(983,h,r)+")"),this.lab_need.text=c},t}(ui.role.GodWing.WingSkillDlgUI);e.ArtifactsSkillTip=i}),define("src/g/artifacts/view/ArtifactsView",["require","exports","../../../enum/EventName","../../../manager/RoleCenter","../../../utils/ItemUtils","../../../config/GameConfig","src/g/Effects/UIEffectsFactory","../../../core/E","../../net/messages/sbkFormula","src/g/artifacts/ctrl/ArtifactsData","../../../meta/MainButtonVo","src/g/clearRes/ClearResM","src/g/artifacts/view/ArtifactsSkillTip","../../../plugin/sbkPropTool","../../net/messages/PropFightMain","src/init/TextConst","src/init/Switches"],function(t,e,a,f,y,m,r,l,g,s,i,o,h,v,_,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t){var e=n.call(this)||this;return e.nameUrlArr=["wenzi_wuqi","wenzi_xiongjia","wenzi_shouzhuo","wenzi_jiezhi","wenzi_toukui","wenzi_xianglian","wenzi_yaodai","wenzi_huxue"],e.getHandler=new Laya.Handler(e,e.onItemGetShow),e._data=t,e.onLoadUIEF(),e.init(),o.ClearResM.addBgUrl(e.bgimg.skin),e}return __extends(t,n),t.prototype.init=function(){for(var t=["wenzi_xing","wenzi_yue","wenzi_sheng"],e=1;e<=8;e++){var i=m.GameConfig.artifactsJSON[e],n=this.item_con.getChildByName("item"+e);if(n){var s=f.RoleCenter.instans.self.artifactsData.artifacesLvArr[e-1],o="17"+e;0<s?(n.txt_lv.text=c.TextConst.get(7,s),n.txt_lv.visible=!0,r.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(n.ani_con,83),n.img_bg.skin=y.ItemUtils.getQualitybjByQualityId(6)):(n.txt_lv.visible=!1,o+="_hui"),n.img_item.skin="res/artifacts/"+o+".png",n.img_select.visible=!1,n.img_type.skin="res/artifacts/"+t[i.xType-1]+".png",n.on(Laya.Event.CLICK,this,this.selectItem,[e])}}this.selectItem(1),l.E.ins.on(a.EventName.ARTIFACTS_UPGRADE_SUCCESS,this,this.onUpgradeHandler)},t.prototype.onLoadUIEF=function(){this.ani_put=r.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_ok,40)},t.prototype.onItemGetShow=function(){if(0<f.RoleCenter.instans.self.artifactsData.artifacesLvArr[this._currSelectId-1])u.Switches.ins.event(8,[!0,!0,204]);else{var t=m.GameConfig.artifactsJSON[this._currSelectId];13==t.moduleID[0][1]&&f.RoleCenter.instans.vo.vipData.isFirstCharge?u.Switches.ins.event(109):i.MainButtonStruct.Ins.OpenModule(t.moduleID[0][1],t.moduleID[1][1])}},t.prototype.onUpgradeHandler=function(t){var e=this.item_con.getChildByName("item"+t);if(e){var i=f.RoleCenter.instans.self.artifactsData.artifacesLvArr[t-1],n="17"+t;0<i?(e.txt_lv.text=c.TextConst.get(7,i),e.txt_lv.visible=!0,0==e.ani_con.numChildren&&r.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(e.ani_con,83),e.img_bg.skin=y.ItemUtils.getQualitybjByQualityId(6)):(e.txt_lv.visible=!1,n+="_hui"),e.img_item.skin="res/artifacts/"+n+".png"}this._currSelectId==t&&this.switchProp(t),this.updateSkill()},t.prototype.updateSkill=function(){var t,e,i,n=0,s=9999,o=9999,a=9999,r=0;for(var l in m.GameConfig.artifactsJSON)t=m.GameConfig.artifactsJSON[l],0<(r=f.RoleCenter.instans.self.artifactsData.artifacesLvArr[t.id-1])&&n++,1==t.xType?s=Math.min(r,s):2==t.xType&&(o=Math.min(r,o)),3==t.xType&&(a=Math.min(r,a));var h,c,u,p=0,d=0,g=0,v=0;for(var l in m.GameConfig.skillOpen)(e=m.GameConfig.skillOpen[l])&&(5==e.type?(this["lab_buff"+p]&&(this["lab_buff"+p].color=n<e.level?"#c0b4a3":"#2ba212",i=y.ItemUtils.getSkillDefItem(e.skillId),this["lab_buff"+p].changeText(e.level+"件套装： "+i.desc)),p++):6==e.type?(0==d||s>=e.level)&&(d=e.level,h=e):7==e.type?(0==g||o>=e.level)&&(g=e.level,c=e):8==e.type&&(0==v||a>=e.level)&&(v=e.level,u=e));i=y.ItemUtils.getSkillDefItem(h.skillId),this.skill_icon0.skin=y.ItemUtils.getSkillIconByIconId(i.icon),this.skill_icon0.gray=s<d,this.lab_skill_lv0.color=this.lab_skill_name0.color=s<d?"#c0b4a3":"#2ba212",this.lab_skill_lv0.changeText("星套等级"+d),this.lab_skill_name0.changeText(i.name),this.skill_icon0.offAll(),this.skill_icon0.on(Laya.Event.CLICK,this,this.showSkillTip,[h,s]),i=y.ItemUtils.getSkillDefItem(c.skillId),this.skill_icon1.skin=y.ItemUtils.getSkillIconByIconId(i.icon),this.skill_icon1.gray=o<g,this.lab_skill_lv1.color=this.lab_skill_name1.color=o<g?"#c0b4a3":"#2ba212",this.lab_skill_lv1.changeText("月套等级"+g),this.lab_skill_name1.changeText(i.name),this.skill_icon1.offAll(),this.skill_icon1.on(Laya.Event.CLICK,this,this.showSkillTip,[c,o]),i=y.ItemUtils.getSkillDefItem(u.skillId),this.skill_icon2.skin=y.ItemUtils.getSkillIconByIconId(i.icon),this.skill_icon2.gray=a<v,this.lab_skill_lv2.color=this.lab_skill_name2.color=a<v?"#c0b4a3":"#2ba212",this.lab_skill_lv2.changeText("圣套等级"+v),this.lab_skill_name2.changeText(i.name),this.skill_icon2.offAll(),this.skill_icon2.on(Laya.Event.CLICK,this,this.showSkillTip,[u,a])},t.prototype.showSkillTip=function(t,e){var i=new h.ArtifactsSkillTip;i.initData(t,e),i.popup()},t.prototype.updateFightNum=function(t){var e=0,i=0,n=0,s=0,o=f.RoleCenter.instans.self.artifactsData.artifacesLvArr[t-1],a=0;if(0<o){var r=this._data.getArtifactsLevelVo(t,o);if(r){a=r.power;for(var l=r.prop2.length,h=0;h<l;){var c=r.prop2[h];"HP"==c[0]?e+=c[1]:"ATT"==c[0]?i+=c[1]:"PDEF"==c[0]?n+=c[1]:"SDEF"==c[0]&&(s+=c[1]),h++}}}var u=new _.PropYcSkill,p=v.sbkPropTool.calChuanShiProp(f.RoleCenter.instans.vo.artifactsData,u),d=g.sbkFormula.calCombat(0,0,0,0,0,u.STRONG,u.STRONGHURT,0,0,0,0,0,0,0,0,u.FIXEDATT,0,0,0,0,0,0,0,0,0,0,0,0,0);d+=g.sbkFormula.calEquipCombat(e,i,n,s)*f.RoleCenter.instans.vo.heronum+a,d+=p,this.fight_num_bar.num_Fight.value=d+""},Object.defineProperty(t.prototype,"currSelectId",{get:function(){return this._currSelectId},enumerable:!0,configurable:!0}),t.prototype.selectItem=function(t){this._currSelectId=t,this._currSelectItem&&(this._currSelectItem.img_select.visible=!1,this._currSelectItem=null),this._currSelectItem=this.item_con.getChildByName("item"+t),this._currSelectItem&&(this._currSelectItem.img_select.visible=!0),this.showItem(t)},t.prototype.showItem=function(t){this.switchAni(t),this.switchProp(t)},t.prototype.switchAni=function(t){r.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.ani_con,90+t)},t.prototype.switchProp=function(t){var e=m.GameConfig.artifactsJSON[t];this.txt_des.text=e.des?e.des:"",this.item_cost.setJump(e.getdes,this.getHandler),this.img_curr_name.skin="res/artifacts/"+this.nameUrlArr[t-1]+".png";var i=f.RoleCenter.instans.self.artifactsData.artifacesLvArr[t-1],n=this._data.getMaxLevelByType(t);0<i?(this.btn_ok.label=c.TextConst.get(236),this.item_cost.setJump(c.TextConst.get(238),this.getHandler)):this.btn_ok.label=c.TextConst.get(237);var s=this._data.getArtifactsLevelVo(t,i),o=0<i?s.upcost[0]:e.activation[0];if(o){var a=y.ItemUtils.getItemVoById(o[0]);this.item_cost.setNeedName(a.name,y.ItemUtils.getSmallIcon(a.icon)),this.item_cost.setQualColor(y.ItemUtils.getColorByQuality(a.quality));var r=f.RoleCenter.instans.vo.bagdata.getItemCount(parseInt(o[0])),l=Number(o[1]);this.item_cost.setNeed(r,l)}else this.item_cost.visible=!1;this.btn_ok.disabled=n<=i?(this.lab_full.visible=!0,!(this.item_cost.visible=!1)):(this.lab_full.visible=!1,!(this.item_cost.visible=!0)),l<=r&&i<n?(this.ani_put.visible=!0,this.btn_ok.disabled=!1):(this.btn_ok.disabled=!0,this.ani_put.visible=!1),this.showCurrLvProp(t,i),this.showNextLvProp(t,i),this.updateFightNum(t)},t.prototype.showCurrLvProp=function(t,e){if(0<e){var i=this._data.getArtifactsLevelVo(t,e);if(i){for(var n=i.prop2.length,s=0;s<n;){var o=i.prop2[s];"HP"==o[0]?this.txt_HP.text=o[1]:"ATT"==o[0]?this.txt_ATT.text=o[1]:"PDEF"==o[0]?this.txt_PDEF.text=o[1]:"SDEF"==o[0]&&(this.txt_SDEF.text=o[1]),s++}return}}this.txt_HP.text="0",this.txt_ATT.text="0",this.txt_PDEF.text="0",this.txt_SDEF.text="0"},t.prototype.showNextLvProp=function(t,e){if(e<this._data.getMaxLevelByType(t)){var i=this._data.getArtifactsLevelVo(t,e+1);if(i){for(var n=i.prop2.length,s=0;s<n;){var o=i.prop2[s];"HP"==o[0]?this.txt_next_HP.text=o[1]:"ATT"==o[0]?this.txt_next_ATT.text=o[1]:"PDEF"==o[0]?this.txt_next_PDEF.text=o[1]:"SDEF"==o[0]&&(this.txt_next_SDEF.text=o[1]),s++}return}}this.txt_next_HP.text="0",this.txt_next_ATT.text="0",this.txt_next_PDEF.text="0",this.txt_next_SDEF.text="0"},t.prototype.showView=function(){this.bgimg.restskin();for(var t=1;t<=8;t++){var e=this.item_con.getChildByName("item"+t);if(e){var i=e.ani_con.getChildAt(0);i&&i.play()}}this.updateRedPrompt(this._data.redPromptState);var n=this.getPrioritySelectindex();-1!=n?this.selectItem(n):this.switchProp(this.currSelectId),this._data.on(s.ArtifactsData.RED_PROMPT_STATE_CHANGED,this,this.onRedChangedHandler),this.updateSkill()},t.prototype.onRedChangedHandler=function(t){this.updateRedPrompt(t),this.switchProp(this.currSelectId)},t.prototype.getPrioritySelectindex=function(){for(var t=this._data.redPromptState,e=1;e<=8;e++)if(1==(t>>e-1&1))return e;return-1},t.prototype.updateRedPrompt=function(t){for(var e=1;e<=8;e++){var i=this.item_con.getChildByName("item"+e);i&&(i.img_red.visible=1==(t>>e-1&1))}},t.prototype.destroy=function(){this._data.off(s.ArtifactsData.RED_PROMPT_STATE_CHANGED,this,this.onRedChangedHandler),this._data=null,l.E.ins.off(a.EventName.ARTIFACTS_UPGRADE_SUCCESS,this,this.onUpgradeHandler),this.item_cost.setJump("",null),this.btn_ok.offAll(),n.prototype.destroy.call(this);for(var t=1;t<=8;t++){r.UIEffectsFactory.Ins.clearAniRes(90+t);var e="17"+t;Laya.loader.clearRes("res/artifacts/"+e+".png"),Laya.loader.clearRes("res/artifacts/"+e+"_hui.png")}for(var i in Laya.loader.clearRes("res/artifacts/wenzi_xing.png"),Laya.loader.clearRes("res/artifacts/wenzi_yue.png"),Laya.loader.clearRes("res/artifacts/wenzi_sheng.png"),r.UIEffectsFactory.Ins.clearAniRes(34),this.nameUrlArr)Laya.loader.clearRes("res/artifacts/"+this.nameUrlArr[i]+".png");this.nameUrlArr.length=0},t}(ui.artifacts.ArtifactsViewUI);e.ArtifactsView=n}),define("src/g/account/view/Tips_openSkill",["require","exports","../../../utils/ItemUtils","../../../config/GameConfig","src/g/clearRes/ClearResM"],function(t,e,a,r,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.img_title.restskin(),t.openList.renderHandler=new Laya.Handler(t,t.renderHandler),t.on(Laya.Event.UNDISPLAY,t,t.unDisplay),t}return __extends(t,e),t.prototype.unDisplay=function(){i.ClearResM.clearUrl(this.img_title.skin)},t.prototype.renderHandler=function(t,e){var i=t.dataSource,n=t.getChildByName("img_icon"),s=t.getChildByName("lab_name"),o=a.ItemUtils.getSkillDefItem(i)||r.GameConfig.godpetskill[i];s.text=o.name,n.skin=a.ItemUtils.getSkillIconByIconId(o.icon),this.openList.centerX=this.openList.centerX},t}(ui.account.Tips_openSkillUI);e.Tips_openSkill=n}),define("src/g/artifacts/ctrl/ArtifactsViewCtrl",["require","exports","../../../manager/GameSocketManager","../../net/messages/ArtifactsC2GS","../../../manager/RoleCenter","../../../enum/EventName","src/g/artifacts/view/ArtifactsView","../../../core/E","../../net/messages/OpResultType","../../../utils/system/FloatEffect","../../../config/GameConfig","src/g/artifacts/ctrl/ArtifactsData","../../../plugin/sbkPropTool","src/g/Effects/UIEffectsFactory","../../../manager/TipManager","../../../plugin/view/ToolTip","src/init/ResManager","src/init/TextConst","src/g/account/view/Tips_openSkill","src/g/base/BaseCtrl","src/g/clearRes/ClearResM"],function(t,e,a,r,p,c,i,u,l,h,d,n,g,v,f,y,s,m,_,o,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var I=function(e){function t(){var t=e.call(this)||this;return t.skillOpenState=[0,0,0],t.url="res/atlas/res/artifacts.json",t}return __extends(t,e),t.prototype.init=function(){return p.RoleCenter.instans.on(l.enumOpResultType.artifacts_jihuo.toString(),this,this.onUpgradeBack),p.RoleCenter.instans.on(l.enumOpResultType.artifacts_Lv.toString(),this,this.onUpgradeBack),d.GameConfig.loadOver?this.initData():u.E.ins.once(c.EventName.INIT_INDEX,this,this.onInitIndex),this},t.prototype.onInitIndex=function(){Laya.timer.frameOnce(1,this,this.initData)},t.prototype.initData=function(){this._viewData=new n.ArtifactsData,this._viewData.init(),this.updateRedPrompt(),u.E.ins.on(c.EventName.CHANGEITEM_COUNT,this,this.updateRedPrompt),this.checkSuitSkill(!0)},t.prototype.openPanel=function(){this._view||(this._view=new i.ArtifactsView(this._viewData),this._view.btn_ok.on(Laya.Event.CLICK,this,this.upgradeHandler),this._view.on(Laya.Event.REMOVED,this,this.closePanel)),this._view.showView(),this.open()},t.prototype.onAtlasLoaded=function(){C.ClearResM.resetViewImg(this._view)},t.prototype.showPage=function(t){this._parent=t,this._parent.removeChildren(),this.openPanel(),this.updateRedPrompt(),this._parent.addChild(this._view),s.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.closePanel=function(){this._view&&!s.ResManager.getInstance().checkIsInLimitMemery()&&(this._view.removeSelf(),this._view.destroy(),this._view=null),Laya.loader.clearRes(this.url)},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){},t.prototype.upgradeHandler=function(){var t=this._view.currSelectId,e=p.RoleCenter.instans.self.artifactsData.artifacesLvArr[t-1];if(e>=this._viewData.getMaxLevelByType(t))h.FE.upItems(m.TextConst.get(235),y.BubbleEnum.center);else{var i;if(0<e)i=this._viewData.getArtifactsLevelVo(t,e).upcost[0];else i=d.GameConfig.artifactsJSON[t].activation[0];var n=parseInt(i[0]),s=i[1];if(!(p.RoleCenter.instans.vo.bagdata.getItemCount(n)<s)){var o=new r.ArtifactsC2GS;o.msgidx=0<e?l.enumOpResultType.artifacts_Lv:l.enumOpResultType.artifacts_jihuo,o.type=t,a.GSM.sendServer(o)}}},t.prototype.onUpgradeBack=function(t){if(t.opresult){var e,i=p.RoleCenter.instans.vo,n=t.reservedata[0],s=i.artifactsData.artifacesLvArr[n-1];if(0<s){e=this._viewData.getArtifactsLevelVo(n,s).upcost[0],this._view&&v.UIEffectsFactory.Ins.playAniOnce(11,this._view.aniSp,1.3,1.3)}else{e=d.GameConfig.artifactsJSON[n].activation[0];var o=v.UIEffectsFactory.Ins.createSAniById(90+n);f.TipManager.showType1Tip(null,o,null,null,null,n)}var a=parseInt(e[0]),r=e[1];i.chgItemCount(a,-r),i.artifactsData.artifacesLvArr[n-1]=s+1;var l=i.combat;g.sbkPropTool.init4chuanShi();var h=i.reCheckComBat();p.RoleCenter.instans.event(c.EventName.FIGHT_UP,h-l),this.updateRedPrompt(),i.ATT_MULTI=i.getProp("ATT_MULTI"),i.HP_MULTI=i.getProp("HP_MULTI"),i.MONEYGET=i.getProp("MONEYGET"),i.EXPGET=i.getProp("EXPGET"),u.E.ins.event(c.EventName.ARTIFACTS_UPGRADE_SUCCESS,n),-1!=this.skillOpenState.indexOf(0)&&this.checkSuitSkill()}},t.prototype.checkSuitSkill=function(t){var e;void 0===t&&(t=!1);var i,n,s,o,a=9999,r=9999,l=9999,h=0;for(var c in d.GameConfig.artifactsJSON)e=d.GameConfig.artifactsJSON[c],h=p.RoleCenter.instans.self.artifactsData.artifacesLvArr[e.id-1],1==e.xType?a=Math.min(h,a):2==e.xType&&(r=Math.min(h,r)),3==e.xType&&(l=Math.min(h,l));for(var c in d.GameConfig.skillOpen)(i=d.GameConfig.skillOpen[c])&&(6==i.type?a>=i.level&&(n=i):7==i.type?r>=i.level&&(s=i):8==i.type&&l>=i.level&&(o=i));if(n){if(!t)if(0==this.skillOpenState[0])(u=new _.Tips_openSkill).openList.array=[n.skillId],u.popup();this.skillOpenState[0]=1}if(s){if(!t)if(0==this.skillOpenState[1])(u=new _.Tips_openSkill).openList.array=[s.skillId],u.popup();this.skillOpenState[1]=1}if(o){var u;if(!t)if(0==this.skillOpenState[2])(u=new _.Tips_openSkill).openList.array=[o.skillId],u.popup();this.skillOpenState[2]=1}},t.prototype.updateRedPrompt=function(){if(d.GameConfig.artifactsJSON){for(var t=0,e=1;e<=8;e++){var i,n=p.RoleCenter.instans.self.artifactsData.artifacesLvArr[e-1];if(0<n){var s=this._viewData.getArtifactsLevelVo(e,n);s&&(i=s.upcost[0])}else{i=d.GameConfig.artifactsJSON[e].activation[0]}if(i){var o=parseInt(i[0]);i[1]<=p.RoleCenter.instans.vo.bagdata.getItemCount(o)&&(t|=1<<e-1)}}this._viewData.redPromptState=t}},t.prototype.getTitle=function(){return"res/role/biaoti_chuanshi.png"},t.prototype.hidePage=function(){s.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){s.ResManager.getInstance().destroyPageCtrl(this)},t}(o.BaseCtrl);e.ArtifactsViewCtrl=I}),define("src/g/role/ctrl/GRoleViewCtrl",["require","exports","src/g/roleSubJoin/ctrl/RingViewCtrl","src/g/roleSubJoin/ctrl/DragonViewCtrl","src/g/role/ctrl/ReincamationPageCtrl","src/g/role/ctrl/WingPageCtrl","src/g/role/ctrl/EquipPageCtrl","../../../manager/RoleCenter","src/g/role/view/GRoleBgDlg","../../../core/E","../../../enum/EventName","../../../enum/GuideTargetName","../../../manager/GuideCenter","../../../utils/UIUtils","src/g/base/BaseCtrl","../../../vo/RedDot/RedDot_Role","../../../vo/RedDot/EventRedDot","src/g/artifacts/ctrl/ArtifactsViewCtrl","src/init/Switches","src/g/proxy/MultiLevelUIProxy","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var I=function(e){function t(){var t=e.call(this)||this;return t._nowSelectHero=0,t.closeOther=!1,t.forceOpen=!1,t.hsid=0,t.curIndex=0,t.urls=["res/atlas/res/role.json","res/atlas/res/custom/equipIcon.json"],m.Switches.ins.on(40,t,t.onOpenHandler,[40]),m.Switches.ins.on(41,t,t.onOpenHandler,[41]),m.Switches.ins.on(42,t,t.onOpenHandler,[42]),m.Switches.ins.on(4,t,t.onOpenHandler,[4]),h.E.ins.on(c.EventName.OPENNEW_HERO,t,t.onOpenHero),h.E.ins.on(c.EventName.CHANGEITEM_COUNT,t,t.onChangeItem),h.E.ins.on(c.EventName.HERO_CHOOSE,t,t.HeroHuaDong),h.E.ins.on(f.EventRedDot.REFRESH_ROLE,t,t.refreshHead),t._artifacts=new y.ArtifactsViewCtrl,t._artifacts.init(),t.initCtrl(),t}return __extends(t,e),t.prototype.onOpenHero=function(t){for(var e=0,i=r.RoleCenter.instans.vo,n=0;n<i.heronum;n++)if(t.jobid==i.getOpenHeroByIdx(n).jobid){e=n;break}m.Switches.ins.event(40,[!0,!0,e])},t.prototype.onChangeItem=function(t){112==t?this._dragon&&this._dragon.refreshData():113==t?(this.refreshRedDot(),this._dragon&&this._dragon.refreshData()):114==t||129==t?(this.refreshRedDot(),this._ring&&this._ring.refreshData()):115==t||130==t?(this.refreshRedDot(),this._ring&&this._ring.refreshData()):482!=t&&483!=t&&484!=t&&485!=t&&493!=t&&494!=t||(this.refreshRedDot(),this._ring&&this._ring.refreshData())},t.prototype.onOpenHandler=function(t,e,i,n,s){void 0===i&&(i=!0),void 0===n&&(n=!1),void 0===s&&(s=0),e&&this.openRoleView(t,i,n,s)},t.prototype.initCtrl=function(){this._equip=new a.EquipPageCtrl,this._reincamation=new s.ReincamationPageCtrl,this._wing=new o.WingPageCtrl,this._ring=new i.RingViewCtrl,this._dragon=new n.DragonViewCtrl},t.prototype.addEvent=function(){this._tabProxy=new _.MultiLevelUIProxy,this._tabProxy.registerTab(this._view.tab_pageBtn,0),this._tabProxy.registerTagIndex(40,0),this._tabProxy.registerTagIndex(41,1),this._tabProxy.registerTagIndex(42,2),this._tabProxy.registerTagIndex(4,3),this._view.bg_view.btn_close.on(Laya.Event.CLICK,this,this.closeRoleView),this._view.bg_view.btn_back.on(Laya.Event.CLICK,this,this.closeRoleView),this._view.bg_view.btn_help.visible=!1,this._tabProxy.selectHandler=new Laya.Handler(this,this.tab_selectHandler),this._view.tab_head.setCallbackHandler(new Laya.Handler(this,this.HeroSelect)),h.E.ins.on(c.EventName.OPENNEW_HERO,this,this.refreshHeroHeadShow),r.RoleCenter.instans.vo.heronum<3&&(h.E.ins.on(c.EventName.ADDED_LEVEL,this,this.refreshHeroHeadShow),h.E.ins.on(c.EventName.ADDED_ZHUANSHENG,this,this.refreshHeroHeadShow),h.E.ins.on(c.EventName.VIP_EXP_CHANGED,this,this.refreshHeroHeadShow)),h.E.ins.on(c.EventName.SEX_CHANGED,this,this.onSexChanged)},t.prototype.onSexChanged=function(){this._view&&this._view.tab_head.initData(r.RoleCenter.instans.self.openhero,0,r.RoleCenter.instans.vo)},t.prototype.initview=function(){this._view=new l.GRoleBgDlg,this._view.tab_head.initData(r.RoleCenter.instans.self.openhero,0,r.RoleCenter.instans.vo),this.addEvent(),this.bandRedHint(),h.E.ins.once(c.EventName.GET_GUIDE_OBJECT_POS+"_"+u.GuideTargetName.ROLE_VIEW_BTN_BACK,this,this.registUIToGuide)},t.prototype.bandRedHint=function(){h.E.ins.on(f.EventRedDot.REFRESH_ROLE,this,this.refreshRedDot)},t.prototype.refreshRedDot=function(){null!=this._view&&this._view.displayedInStage&&this.refreshHead()},t.prototype.openRoleView=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),void 0===n&&(n=0),this.selectIndex=t,this.closeOther=e,this.forceOpen=i,this.hsid=n,this.opens()},t.prototype.onAtlasLoaded=function(){this.realOpenRoleView(this.selectIndex)},t.prototype.realOpenRoleView=function(t){void 0===t&&(t=0),this._view||this.initview(),this._tabProxy.open(t),this._equip.refreshData(),h.E.ins.event(c.EventName.COMPTYPE_OPENVIEW,u.GuideTargetName.ROLE_VIEW),this._view.showView(this.closeOther,this.forceOpen),this._isRegist||Laya.timer.frameOnce(2,this,this.registUIToGuide),p.GuideCenter.ins.registerGuideObject(u.GuideTargetName.ROLE_VIEW_BTN_PUTON,this._view),p.GuideCenter.ins.registerGuideObject(u.GuideTargetName.ROLE_VIEW_BTN_BACK,this._view),p.GuideCenter.ins.registerGuideObject(u.GuideTargetName.ROLE_VIEW_BTN_LONGLIN,this._view),p.GuideCenter.ins.registerGuideObject(u.GuideTargetName.ROLE_VIEW_BTN_LONGWEN,this._view),C.ClearResM.resetViewImg(this._view),this.refreshRedDot(),h.E.ins.on(c.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),this.selectIndex!=this.hsid&&0!=this.hsid&&(this.HeroSelect(this.hsid,null),this.hsid=0)},t.prototype.closeClearRes=function(){h.E.ins.off(c.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),C.ClearResM.clearResFolder("lottery/")},t.prototype.registUIToGuide=function(){var t=d.UIUtils.getGlobalBound(this._view.bg_view.btn_back);t&&p.GuideCenter.ins.registerInteractionArea(u.GuideTargetName.ROLE_VIEW_BTN_BACK,t),this._isRegist=!0},t.prototype.refreshHeroHeadShow=function(t){void 0===t&&(t=0),this._view.tab_head.initData(r.RoleCenter.instans.self.openhero,this._nowSelectHero,r.RoleCenter.instans.vo),this.refreshRedDot()},t.prototype.HeroSelect=function(t,e){r.RoleCenter.instans.vo.heronum>t?(this._nowSelectHero=t,this._view.tab_head.setSelectIndex(t),this._equip.changePerson(t),this._wing.changePerson(t),this._dragon.changePerson(t),this._ring.changePerson(t),this._nowSelectHero==this.curIndex?this.curIndex=this._nowSelectHero:this._nowSelectHero>this.curIndex?(this.curIndex=this._nowSelectHero,h.E.ins.event(c.EventName.HERO_TWEENL)):this._nowSelectHero<this.curIndex&&(this.curIndex=this._nowSelectHero,h.E.ins.event(c.EventName.HERO_TWEENR))):m.Switches.ins.event(15)},t.prototype.HeroHuaDong=function(t){r.RoleCenter.instans.vo.heronum<=t||(this._nowSelectHero=t,this._view.tab_head.setSelectIndex(t),this._equip.changePerson(t),this._wing.changePerson(t),this._dragon.changePerson(t),this._ring.changePerson(t),this._nowSelectHero==this.curIndex?this.curIndex=this._nowSelectHero:this._nowSelectHero>this.curIndex?(this.curIndex=this._nowSelectHero,h.E.ins.event(c.EventName.HERO_TWEENL)):this._nowSelectHero<this.curIndex&&(this.curIndex=this._nowSelectHero,h.E.ins.event(c.EventName.HERO_TWEENR)))},t.prototype.tab_selectHandler=function(t){var e=!0;switch(t){case 0:this._page=this._equip;break;case 1:e=!1,this._page=this._artifacts;break;case 2:this._page=this._wing;break;case 3:e=!1,this._page=this._reincamation}this._view.tab_head.visible=e,this._page.showPage(this._view.bg_view.box_page),this.refreshHead(),this._view.bg_view.img_title.skin=this._page.getTitle()},t.prototype.refreshHead=function(){if(null!=this._view&&this._view.displayedInStage)switch(this._view.tab_pageBtn.selectedIndex){case 0:var t=v.RedDot_Role.Ins.getRed_equip();this._view.tab_head.refreshHeadRedHint(t);break;case 1:break;case 2:this._view.tab_head.refreshHeadRedHint(v.RedDot_Role.Ins.getRed_wing())}},t.prototype.closeRoleView=function(){this._view.hideView(),h.E.ins.event(c.EventName.COMPTYPE_CLOSEVIEW,u.GuideTargetName.ROLE_VIEW)},t}(g.BaseCtrl);e.GRoleViewCtrl=I}),define("src/g/index/view/GetSkillItem",["require","exports","../../../manager/LayerManager","../../../utils/ItemUtils"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"skillData",{set:function(t){this._skillData=t,i.LayerManager.addGuideLayer(this,!1),this.icon.skin=n.ItemUtils.getSkillIconByIconId(+t.icon),this.skill_name.text=t.name,this.x=-200,this.y=400,Laya.Tween.to(this,{x:(Laya.stage.width-this.width)/2},500,null,Laya.Handler.create(this,this.completeHandler))},enumerable:!0,configurable:!0}),e.prototype.completeHandler=function(){Laya.Tween.to(this,{x:120},500,null,Laya.Handler.create(this,this.removeHandler),500);var t=new Laya.Sprite;t.x=180,t.y=430,t.zOrder=99,t.loadImage(n.ItemUtils.getSkillIconByIconId(+this._skillData.icon),0,0,40,40),i.LayerManager.addGuideLayer(t,!1),Laya.Tween.to(t,{x:233,y:923},500,null,Laya.Handler.create(this,this.removeSpHandler,[t]),500)},e.prototype.removeHandler=function(){this.removeSelf()},e.prototype.removeSpHandler=function(t){t.graphics.clear(!0),t.removeSelf(),t.destroy(!0)},e}(ui.index.GetSkillItemUI);e.GetSkillItem=s}),define("src/g/index/ctrl/FightCtrl",["require","exports","../../../manager/LayerManager","src/g/index/view/GetSkillItem","../../../utils/ItemUtils","../../../component/FightPower","../../../enum/EventName","../../../manager/RoleCenter"],function(t,e,s,n,o,a,i,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){r.RoleCenter.instans.on(i.EventName.FIGHT_UP,this,this.fightUpHandler),r.RoleCenter.instans.on(i.EventName.GET_NEW_SKILL,this,this.getSkill)}return t.prototype.getSkill=function(t){var e=this._skillview;e||(this._skillview=e=new n.GetSkillItem),e.zOrder=100;var i=o.ItemUtils.getSkillVoById(t);e.skillData=i},t.prototype.fightUpHandler=function(t){var e=r.RoleCenter.instans.self.combat,i=e-t;if(!isNaN(t)&&0!=t&&0!=i){var n=this._view;n||(this._view=n=new a.FightPower),n.y=370,n.x=150,s.LayerManager.addAlertLayer(n),n.powerFromTo(i,e)}},t}();e.FightCtrl=l}),define("src/g/skill/view/PassiveCompondView",["require","exports","src/g/Effects/UIEffectsFactory","../../../manager/GameSocketManager","../../net/messages/PassiveC2GS","../../net/messages/OpResultType","../../net/messages/ErrConst","../../../utils/system/ErrCodeView","../../../manager/RoleCenter","src/g/skill/vo/PassiveStruct","../../../utils/ItemUtils","../../../manager/RuledescManager","src/g/clearRes/ClearResM"],function(t,e,n,i,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.bagPassiveIdArr=[],t.bagPassiveNumArr=[],t.waitArr=[0,0,0],t.init(),p.ClearResM.addBgUrl(t.bgimg.skin),t}return __extends(t,e),t.prototype.init=function(){this.addEvent(),this.initBagData2Self()},t.prototype.addEvent=function(){this.btn_close.on(Laya.Event.CLICK,this,this.onCloseView),this.btn_tip.on(Laya.Event.CLICK,this,this.showTipDlg,[16]),this.list_.renderHandler=new Laya.Handler(this,this.renderHandler),this.list_.selectHandler=new Laya.Handler(this,this.ListClickHander),this.list_.scrollBar.elasticDistance=200,this.btn_comp.on(Laya.Event.CLICK,this,this.onClickCompound);for(var t=0;t<3;t++)this["item_"+t].on(Laya.Event.CLICK,this,this.WaitClickHander,[parseInt(this["item_"+t].name)])},t.prototype.showTipDlg=function(t){u.RuledescManager.showRuledesc(t)},t.prototype.initBagData2Self=function(){this.clearData();for(var t=h.PassiveStruct.Ins.getLowPassArr(),e=l.RoleCenter.instans.vo.bagdata,i=0;i<t.length;i++){var n=e.getItemCount(t[i].costId);0<n&&(this.bagPassiveIdArr.push(t[i].costId),this.bagPassiveNumArr.push(n))}this.list_.dataSource=this.bagPassiveIdArr,this.refreshWaitList()},t.prototype.onClickCompound=function(){for(var t=0;t<this.waitArr.length;t++)if(0==this.waitArr[t])return void r.ErrCodeView.show(a.enumErrConst.code_3101);var e=new s.PassiveC2GS;for(t=0;t<this.waitArr.length;t++)e.itemIdArr.push(this.waitArr[t]);e.msgidx=o.enumOpResultType.passive_compound,i.GSM.sendServer(e)},t.prototype.refreshData=function(){this.waitArr=[0,0,0],this.initBagData2Self(),this.refreshWaitList(),this.bgimg.restskin()},t.prototype.refreshWaitList=function(){for(var t=0;t<this.waitArr.length;t++){var e=this["item_"+t];0==this.waitArr[t]?(e.img_quality.skin=c.ItemUtils.getQualitybjByQualityId(1),e.img_item.skin=""):(e.img_item.skin=c.ItemUtils.getIconById(this.waitArr[t]),e.img_quality.skin=c.ItemUtils.getQualityBjById(this.waitArr[t]))}this.list_.dataSource=this.bagPassiveIdArr},t.prototype.WaitClickHander=function(t){var e=this.waitArr[t];if(0!=e){var i=this.bagPassiveIdArr.indexOf(e);this.bagPassiveNumArr[i]++,this.waitArr[t]=0,this.refreshWaitList()}},t.prototype.renderHandler=function(t,e){var i=c.ItemUtils.getItemVoById(t.dataSource),n=this.bagPassiveNumArr[e];t.setIcon(c.ItemUtils.getIconById(i.id)),t.setSelcet(!1),t.setName(i.name,c.ItemUtils.getColorByQuality(i.quality)),t.setNum(n),this.list_.selectedIndex=-1},t.prototype.ListClickHander=function(t){if(-1!=t){for(var e=-1,i=0;i<3;i++)if(0==this.waitArr[i]){e=i;break}-1!=e&&(this.bagPassiveNumArr[t]<=0?r.ErrCodeView.show(a.enumErrConst.code_3101):(this.waitArr[e]=this.bagPassiveIdArr[t],this.bagPassiveNumArr[t]--,this.refreshWaitList()))}},t.prototype.showGetAni=function(t){var e=this,i=n.UIEffectsFactory.Ins.createUIAniById(33,!1);n.UIEffectsFactory.Ins.centered4Parent(i,this.sp,!0),this.waitArr=[0,0,0],this.refreshWaitList(),i.on(Laya.Event.COMPLETE,this,function(t){i.stop(),i.removeSelf(),e.showIcon(t)},[t]),i.play()},t.prototype.showIcon=function(t){var i=this,e=this.img_icon.x,n=this.img_icon.y;this.img_icon.skin=t,this.img_icon.visible=!0,Laya.Tween.to(this.img_icon,{x:448,y:944,scaleX:0,scaleY:0},700,null,new Laya.Handler(this,function(t,e){i.img_icon.visible=!1,i.img_icon.x=t,i.img_icon.y=e,i.img_icon.scale(.58,.58),i.refreshData()},[e,n]),500)},t.prototype.clearData=function(){this.bagPassiveIdArr=[],this.bagPassiveNumArr=[]},t.prototype.onCloseView=function(){this.close()},t.prototype.close=function(){p.ClearResM.clearUrl(this.bgimg.skin),e.prototype.close.call(this)},t}(ui.skill.CompoundPassiveUI);e.PassiveCompondView=d}),define("src/g/account/view/UseItemRewardView",["require","exports","src/g/guide/vo/RewardVo","../../../utils/ItemUtils","../../../enum/enumItem","src/g/account/view/AccItem","../../net/messages/sbkEquipIns","../../../meta/QualiyVo","src/init/TextConst"],function(t,e,v,f,y,m,_,C,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.btnName="",t._count=0,t.list_reward.itemRender=m.AccItem,t.list_reward.renderHandler=new Laya.Handler(t,t.listRender),t.list_reward.mouseHandler=new Laya.Handler(t,t.listMHandler),t.img_bg.btn_back.on(Laya.Event.CLICK,t,t.close),t.img_bg.btn_close.on(Laya.Event.CLICK,t,t.close),t.btn_ok.on(Laya.Event.CLICK,t,t.close),t}return __extends(t,e),t.prototype.initData=function(t,e){1==t?(this.initByType1(),this.initByPanle(e)):2==t?(this.initByType2(),this.initByPanle(e)):(this.initByType3(),this.initByList(e))},t.prototype.initByPanle=function(t){var e=t.currencyList;if(e){this.panelList.hScrollBarSkin="";for(var i=new Laya.Sprite,n=0;n<e.length;n++){var s=new v.RewardVo;s.count=e[n].val;var o=f.ItemUtils.getCurrencyByDefine(e[n].key);s.name=o.name,s.type=y.ItemType.CURRENCY,s.quality=C.QualityStruct.Ins.getQColorById(o.quality),s.res=f.ItemUtils.getIconByIconId(o.icon),s.qualityNum=o.quality,s.define=e[n].key,s.streamer=o.streamer,(c=new m.AccItem).eqData=s,i.addChild(c),c.x=i.width,i.width+=c.width}}var a=t.itemList;if(a)for(n=0;n<a.length;n+=2){var r=new v.RewardVo,l=f.ItemUtils.getItemVoById(a[n]);r.res=f.ItemUtils.getIconByIconId(l.icon),r.lv=l.uselimit,r.qualityNum=l.quality,r.quality=C.QualityStruct.Ins.getQColorById(l.quality),r.name=l.name,r.id=l.id,r.type=y.ItemType.ITEM,r.count=a[n+1],r.streamer=l.streamer,(c=new m.AccItem).eqData=r,i.addChild(c),c.x=i.width,i.width+=c.width}var h=t.equipList;if(h)for(n=0;n<h.length;n++){r=new v.RewardVo;var c,u=f.ItemUtils.getItemOrEq(h[n].equtemplet);if(r.res=f.ItemUtils.getIconByIconId(u.icon),r.lv=u.limit,r.qualityNum=u.quality,r.quality=C.QualityStruct.Ins.getQColorById(u.quality),h[n].type==_.enumEquipType.wingEquip){var p=f.ItemUtils.getWingEquipVoById(h[n].equtemplet);r.name=p.name,r.type=y.ItemType.WING}else r.name=u.name,r.type=y.ItemType.EQ;r.id=u.id,r.job=u.job,(c=new m.AccItem).eqData=r,i.addChild(c),c.x=i.width,i.width+=c.width}var d=t.zhanwenList;if(d)for(n=0;n<d.length;n++){r=new v.RewardVo,u=f.ItemUtils.getItemOrEq(d[n].cfgId);r.res=f.ItemUtils.getIconByIconId(u.icon),r.lv=u.limit,r.qualityNum=u.quality,r.quality=C.QualityStruct.Ins.getQColorById(u.quality),r.name=u.name,r.type=y.ItemType.ZHANWEN,r.id=u.id,r.job=u.job||-1;var g=new m.AccItem;g.eqData=r,i.addChild(g),g.x=i.width,i.width+=g.width}i.height=103,this.panelList.addChild(i),i.width>this.panelList.width?i.x=0:i.x=this.panelList.width/2-i.width/2},t.prototype.initByList=function(t){this.list_reward.dataSource=f.ItemUtils.getRewardArrByInv(t)},t.prototype.listRender=function(t,e){var i=t.dataSource;t.eqData=i},t.prototype.listMHandler=function(t,e){t.type==Laya.Event.CLICK&&this.onListClicked(this.list_reward.getCell(e).dataSource)},t.prototype.onListClicked=function(t){},t.prototype.initByType1=function(){this.box_list.visible=!1,this.btnName=i.TextConst.get(201),this._count=5,Laya.timer.loop(1e3,this,this.loopHandlerFail),this.loopHandlerFail()},t.prototype.initByType2=function(){this.box_list.visible=!1,this.btnName=i.TextConst.get(205),this._count=4,Laya.timer.loop(1e3,this,this.loopHandlerFail),this.loopHandlerFail()},t.prototype.initByType3=function(){},t.prototype.close=function(){e.prototype.close.call(this),Laya.timer.clear(this,this.loopHandlerFail)},t.prototype.loopHandlerFail=function(){this._count--,this._count<=0&&(Laya.timer.clear(this,this.loopHandlerFail),this.close()),this.btn_ok&&(this.btn_ok.label=this.btnName+"("+this._count+"s)")},t}(ui.account.UseItemRewardUI);e.UseItemRewardView=n}),define("src/g/skill/ctrl/PassiveCompoundCtrl",["require","exports","../../../utils/ItemUtils","../../net/messages/OpResultType","../../../manager/RoleCenter","../../../enum/EventName","../../../core/E","src/g/skill/view/PassiveCompondView","../../../utils/system/FloatEffect","src/g/account/view/UseItemRewardView","../../net/messages/InventoryAddGS2C"],function(t,e,o,i,a,n,s,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){s.E.ins.on(n.EventName.PASSIVE_OPENCOMPOUND,this,this.showView),a.RoleCenter.instans.on(i.enumOpResultType.passive_compound+"",this,this.onCompound)}return t.prototype.onCompound=function(t){var n=t.reservedata,s=a.RoleCenter.instans.vo;Laya.Tween.to(this._view.mask_comp,{y:1},700,null,Laya.Handler.create(this,function(){this._view.mask_comp.y=-122,Laya.Tween.clearAll(this._view.mask_comp),s.chgItemCount(n[0],1);var t=o.ItemUtils.getItemVoById(n[0]),e=new c.InventoryAddGS2C;e.itemList.push(t.id),e.itemList.push(1);var i=new h.UseItemRewardView;5<=t.quality?i.initData(2,e):t.quality<5&&i.initData(1,e),i.popup(),l.FE.getFloat(t.name+"x1",o.ItemUtils.getColorByQuality(t.quality)),s.chgItemCount(n[1],-1),s.chgItemCount(n[2],-1),s.chgItemCount(n[3],-1),this._view.showGetAni(o.ItemUtils.getIconById(n[0]))}))},t.prototype.init=function(){this._view=new r.PassiveCompondView},t.prototype.showView=function(){this._view||this.init(),this._view.refreshData(),this._view.popup()},t}();e.PassiveCompondCtrl=u}),define("src/g/skill/view/LeanPassiveView",["require","exports","../../net/messages/ErrConst","../../../utils/system/ErrCodeView","../../../manager/GameSocketManager","../../net/messages/OpResultType","../../net/messages/PassiveC2GS","../../../utils/ItemUtils","src/g/skill/vo/PassiveStruct","../../../manager/RoleCenter","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/init/TextConst"],function(t,e,i,n,s,o,a,l,h,r,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.passArr=[],t._nowSelectListIdx=0,t.init(),t}return __extends(t,e),t.prototype.init=function(){this.list_.renderHandler=new Laya.Handler(this,this.renderHandler),this.list_.selectHandler=new Laya.Handler(this,this.SelectkHander),this.btn_lean.on(Laya.Event.CLICK,this,this.onLeanClick)},t.prototype.onLeanClick=function(){if(null!=this.passArr[this.passIdx])if(0!=this.dataArr.length){var t=new a.PassiveC2GS;t.heroidx=this.heroIdx,t.passiveIdx=this.passIdx,t.msgidx=o.enumOpResultType.passive_learn,t.itemIdArr.push(this.dataArr[this._nowSelectListIdx].pvo.costId),s.GSM.sendServer(t)}else c.FE.upItems(p.TextConst.get(760),u.BubbleEnum.center);else n.ErrCodeView.show(i.enumErrConst.code_3102)},t.prototype.showView=function(t,e){this.item_desc.visible=!1,this.item_name.visible=!1,this.item_show.visible=!1,this.heroIdx=t,this.passIdx=e,this.uvo=r.RoleCenter.instans.vo,this.hvo=this.uvo.getOpenHeroByIdx(this.heroIdx),this.passArr=this.hvo.passive.idArr,this.renderView()},t.prototype.renderView=function(){this.dataArr=[];for(var t=[],e=0;e<this.passArr.length;e++)if(0!=this.passArr[e]){var i=l.ItemUtils.getPassiveVoById(this.passArr[e]);t.push(i.type)}for(var n=0;n<2;n++){var s=[];s=0==n?h.PassiveStruct.Ins.getHigPassArr():h.PassiveStruct.Ins.getLowPassArr();for(e=0;e<s.length;e++){var o=this.uvo.bagdata.getItemCount(s[e].costId);if(0<o){var a=new g;a.num=o,a.pvo=s[e],a.typeSame=0<=t.indexOf(a.pvo.type);for(var r=0;r<this.passArr.length;r++)if(0!=this.passArr[r]){i=l.ItemUtils.getPassiveVoById(this.passArr[r]);if(a.pvo.backout[0][0]==i.backout[0][0]){a.lean=!0;break}a.lean=!1}this.dataArr.push(a)}}}this.list_.dataSource=this.dataArr,this.list_.selectedIndex=0,this.SelectkHander(0)},t.prototype.SelectkHander=function(t){this._nowSelectListIdx=t;var e=this.dataArr[t];null!=e&&(this.item_desc.visible=!0,this.item_desc.style.font="SimHei",this.item_desc.style.fontSize=20,this.item_desc.style.color="#c0b4a3",this.item_desc.style.align="left",this.item_desc.style.wordWrap=!0,this.item_desc.style.leading=5,this.item_desc.innerHTML=e.pvo.getDesc(),this.item_name.visible=!0,this.item_show.visible=!0,this.item_name.text=e.pvo.name,this.item_name.color=5==e.pvo.quality?"#ff0f0f":"#fff55c",this.item_show.setName(""),this.item_show.setSelcet(!1),this.item_show.setIcon(l.ItemUtils.getIconById(e.pvo.costId)),this.item_show.setLean(e.lean),this.setLean(e.lean))},t.prototype.renderHandler=function(t,e){var i=t.dataSource;t.setName(i.pvo.name,5==i.pvo.quality?"#ff0f0f":"#fff55c"),t.setIcon(l.ItemUtils.getIconById(i.pvo.costId)),t.setSelcet(e==this.list_.selectedIndex),t.setLean(i.lean,i.typeSame),t.setSelcet(e==this.list_.selectedIndex),t.img_bg.skin=l.ItemUtils.getQualitybjByQualityId(i.pvo.quality)},t.prototype.setLean=function(t){this.btn_lean.label=t?p.TextConst.get(761):p.TextConst.get(762),this.btn_lean.disabled=t},t}(ui.skill.LeanPassiveUI);e.LeanPassive=d;var g=function(){this.lean=!1};e.LeanPassiveSource=g}),define("src/g/skill/ctrl/LeanPassiveCtrl",["require","exports","../../net/messages/OpResultType","../../../manager/RoleCenter","src/g/skill/view/LeanPassiveView","../../../enum/EventName","../../../core/E","../../../plugin/sbkPropTool"],function(t,e,i,s,n,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){a.E.ins.on(o.EventName.PASSIVE_OPENLEAN,this,this.showView),this.init()}return t.prototype.init=function(){this._view||(this._view=new n.LeanPassive,this.addEvent())},t.prototype.addEvent=function(){this._view.btn_close.on(Laya.Event.CLICK,this,this.hideView),this._view.btn_back.on(Laya.Event.CLICK,this,this.hideView),s.RoleCenter.instans.on(i.enumOpResultType.passive_learn+"",this,this.onLeanEd)},t.prototype.onLeanEd=function(t){var e=t.reservedata,i=s.RoleCenter.instans.vo,n=i.getOpenHeroByIdx(e[0]);n.passive.idArr[e[1]]=e[2],r.sbkPropTool.reSetSkillAndPassive(n),n.combat=n.reCheckComBat(),i.combat=i.reCheckComBat(),i.chgItemCount(e[3],-1),s.RoleCenter.instans.event(o.EventName.FIGHT_UP,e[4]),a.E.ins.event(o.EventName.PASSIVE_OVER4RENDER),a.E.ins.event(o.EventName.PASSIVEDATA_CHANGE),a.E.ins.event(o.EventName.CHANGECURRENCY,"PASSIVE"),this._view.close()},t.prototype.showView=function(t,e){this.init(),this._view.showView(t,e),this._view.popup()},t.prototype.hideView=function(){this._view.close()},t}();e.LeanPassiveCtrl=l}),define("src/g/skill/view/DismantlePassiveDlg",["require","exports","../../../manager/GameSocketManager","../../net/messages/OpResultType","../../net/messages/PassiveC2GS","../../../utils/ItemUtils","src/init/TextConst"],function(t,e,i,n,s,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){this.btn_close.on(Laya.Event.CLICK,this,this.closeDlg),this.btn_cancel.on(Laya.Event.CLICK,this,this.closeDlg),this.btn_ok.on(Laya.Event.CLICK,this,this.onOK)},t.prototype.closeDlg=function(){this.close()},t.prototype.show4Vo=function(t,e,i){this.hidx=t,this._idx=e;for(var n=r.TextConst.get(759),s=0;s<i.backout.length;s++){var o=a.ItemUtils.getItemVoById(i.backout[s][0]);n+="<span color='"+a.ItemUtils.getColorByQuality(o.quality)+"'>"+o.name+"*"+i.backout[s][1]+"    </span>"}this.lab_tipNeed.style.fontSize=20,this.lab_tipNeed.style.font="SimHei",this.lab_tipNeed.innerHTML=n},t.prototype.onOK=function(){var t=new s.PassiveC2GS;t.msgidx=n.enumOpResultType.passive_disassembly,t.heroidx=this.hidx,t.passiveIdx=this._idx,i.GSM.sendServer(t),this.close()},t}(ui.skill.DismantlePassiveUI);e.DismantlePassiveDlg=o}),define("src/g/skill/ctrl/DismantlePassiveDlgCtrl",["require","exports","../../../utils/ItemUtils","../../../manager/RoleCenter","src/g/skill/view/DismantlePassiveDlg","../../../core/E","../../../enum/EventName"],function(t,e,s,o,a,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){i.E.ins.on(n.EventName.PASSIVE_OPENDISMANTLE,this,this.OnOpenDisMantle)}return t.prototype.OnOpenDisMantle=function(t,e){this.uvo=o.RoleCenter.instans.vo,this.hvo=this.uvo.getOpenHeroByIdx(t);var i=s.ItemUtils.getPassiveVoById(this.hvo.passive.idArr[e]);if(i){var n=new a.DismantlePassiveDlg;n.show4Vo(t,e,i),n.popup()}},t}();e.DismantlePassiveCtrl=r}),define("src/g/skill/view/PassivePage",["require","exports","../../../utils/ItemUtils","../../../config/GameConfig","../../../manager/RoleCenter","../../../core/E","../../../enum/EventName","src/g/Effects/UIEffectsFactory","src/g/skill/vo/PassiveStruct"],function(t,e,C,i,I,n,s,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.p_heroIdx=0,t.up=!0,t.list_skill=[],t.aniResArr=[],t._pCfg=i.GameConfig.PassiveConfig,t.on(Laya.Event.REMOVED,t,t.onRemoved),t}return __extends(t,e),t.prototype.onRemoved=function(){for(var t=0;t<=7;t++)this["item"+t].ani_passive.removeChildren();for(t=0;t<this.aniResArr.length;t++)Laya.loader.clearRes(this.aniResArr[t])},t.prototype.showData=function(t,e){this.uvo=I.RoleCenter.instans.vo,this.hero=t,this.p_heroIdx=e,this.refreshData()},t.prototype.refreshData=function(){this.uvo=I.RoleCenter.instans.vo,this.hero||(this.hero=this.uvo.getOpenHeroByIdx(this.p_heroIdx)),this._passive=this.hero.passive.idArr,this.rendPage(),this.renderPage(),n.E.ins.on(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){n.E.ins.off(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.rendPage=function(){for(var t=[],e=0;e<this._pCfg.max;e++){var i=new a,n=C.ItemUtils.getPassiveVoById(this._passive[e]);i.open=0!=this._passive[e]&&0<=this._passive[e]||!1,i.idx=e,i.vo=n,i.select=!1,t.push(i)}this.list_skill=t},t.prototype.renderPage=function(){for(var t=[],e=[],i=[],n=I.RoleCenter.instans.vo,s=this.hero,o=[],a=0;a<2;a++)for(var r=0==a?w.PassiveStruct.Ins.getHigPassArr():w.PassiveStruct.Ins.getLowPassArr(),l=0;l<r.length;l++)o.push(r[l]);for(l=0;l<o.length;l++){a=o[l];var h=n.bagdata.getItemCount(a.costId);0<h&&(t.push(a.costId),e.push(h),i.indexOf(a.type)<0&&i.push(a.type))}for(l=0;l<=7;l++){var c=this["item"+l];if((a=this.list_skill[l]).open){var u=a.vo.costId;if(c.img_red.visible=!1,c.lvBox.visible=!0,c.ani.visible=!0,c.img_tip.visible=!1,c.setName(a.vo.name,5==a.vo.quality?"#ff0f0f":"#fff55c"),c.setLV(a.vo.id2),!c.ani_passive.getChildByName(u+"")){c.ani_passive.removeChildren();var p=b.UIEffectsFactory.Ins.createUIAniById(u,!0);p.name=u+"",b.UIEffectsFactory.Ins.centered4Parent(p,c.ani_passive,!0),this.aniResArr.push(b.UIEffectsFactory.Ins.getSourceUrlById(u))}if(c.mouseEnabled=!0,null==(_=C.ItemUtils.getPassiveVoById(s.passive.idArr[l])))continue;if(0==_.cost.length)continue;if(5==_.quality){var d=w.PassiveStruct.Ins.getHigPassVoByType(_.type);if(0<this.uvo.bagdata.getItemCount(d.costId)){c.img_red.visible=!0;continue}}for(var g=!0,v=0;v<_.cost.length;v++){this.uvo.bagdata.getItemCount(parseInt(_.cost[v][0]))<_.cost[v][1]&&(g=!1)}c.img_red.visible=g}else if(c.ani.visible=!1,c.lvBox.visible=!1,c.setUnlean(),c.img_tip.visible=!0,this._pCfg.openVip[a.idx]<=I.RoleCenter.instans.self.vipLv||I.RoleCenter.instans.vo.getCurLv()>=this._pCfg.openLimit[a.idx]){c.setUnOpen(!0),c.mouseEnabled=!0,c.img_tip.disabled=!1;var f=s.passive.idArr;if(0==f.length)break;if(-1<f.indexOf(0)){for(var y=0,m=0;m<f.length;m++){var _;(_=C.ItemUtils.getPassiveVoById(f[m]))&&-1<i.indexOf(_.type)&&y++}c.img_red.visible=y<i.length&&f.indexOf(0)==l}}else c.img_tip.disabled=!0,c.mouseEnabled=!1,c.setTip(this._pCfg.openVip[a.idx],C.ItemUtils.getLv(parseInt(this._pCfg.openLimit[a.idx]))),c.img_red.visible=!1}},t}(ui.skill.Page.PassivePageUI);e.PassivePage=o;var a=function(){}}),define("src/g/skill/view/LvUpassiveView",["require","exports","../../../utils/ItemUtils","../../../manager/RoleCenter","../../net/messages/OpResultType","../../../manager/GameSocketManager","../../net/messages/PassiveC2GS","src/g/skill/view/PassivePage","../../../plugin/sbkPropTool","../../../enum/EventName","../../../core/E","src/g/Effects/UIEffectsFactory","src/g/skill/vo/PassiveStruct","src/g/clearRes/ClearResM","src/g/itemGets/View/ItemGetDlg","../../../meta/ShuXingVo","src/init/TextConst"],function(t,e,p,d,o,a,r,i,l,h,c,n,g,s,u,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(e){function t(){var t=e.call(this)||this;return t._view=new i.PassivePage,t.ani_upLv=null,t.allHas=!1,t.addEvent(),s.ClearResM.addBgUrl(t.bgimg.skin),t}return __extends(t,e),t.prototype.addEvent=function(){var t=this;this.btn_back.on(Laya.Event.CLICK,this,this.onClose),this.btn_close.on(Laya.Event.CLICK,this,this.onClose),this.btn_lvUP.on(Laya.Event.CLICK,this,this.onClick),d.RoleCenter.instans.on(o.enumOpResultType.passive_upgrade+"",this,this.onPassiveUpEnd),d.RoleCenter.instans.on(o.enumOpResultType.passive_disassembly+"",this,this.onPassiveDis),c.E.ins.on(h.EventName.PASSIVELVUP,this,this.onPasslvUp),this.btn_dismantle.on(Laya.Event.CLICK,this,function(){c.E.ins.event(h.EventName.PASSIVE_OPENDISMANTLE,[t._nowSelectHero,t._skillPos])})},t.prototype.onPasslvUp=function(t){n.UIEffectsFactory.Ins.playAniOnce(11,this.aniSp,1.3,1.3),this.refreshData(t)},t.prototype.showUpLvAni=function(t){this.ani_upLv=this.btn_lvUP.getChildByName("upAni"),t?(this.ani_upLv||(this.ani_upLv=n.UIEffectsFactory.Ins.createUIAniById(42,!0),this.ani_upLv.width*=1.3,this.ani_upLv.scaleX=1.3,this.ani_upLv.name="upAni",n.UIEffectsFactory.Ins.centered4Parent(this.ani_upLv,this.btn_lvUP,!0)),this.ani_upLv.visible=!0):this.ani_upLv&&(this.ani_upLv.visible=!1)},t.prototype.onClose=function(){this.ani_upLv&&(this.ani_upLv.destroy(),this.ani_upLv=null),this.close()},t.prototype.showView=function(t,e,i){this.itemData=t,this._nowSelectHero=e,this._skillPos=i,this.bgimg.restskin(),this.popup(),this.refresh()},t.prototype.refresh=function(){this.setDes(),this.setIcon(this.img_icon),this.setAni(this.ani_passive),this.setNeed(),this.setAttr()},t.prototype.setAttr=function(){this.attr_0.removeChildren(),this.attr_1.removeChildren();var t=this.itemData.vo;if(t)for(var e=0;e<t.prop.length;e++){var i=v.ShuXingVo.createSXBox(t.prop[e][0],t.prop[e][1],"#e3cca9",": ","#e3cca9");e%2==0?this.attr_0.addChild(i):this.attr_1.addChild(i)}},t.prototype.setDes=function(){this.itemData.vo&&(this.img_name.skin="res/skill/"+this.itemData.vo.costId+".png",this.txt_lv.value=this.itemData.vo.id2,this.item_desc.style.font="SimHei",this.item_desc.style.fontSize=20,this.item_desc.style.color="#c0b4a3",this.item_desc.style.align="left",this.item_desc.style.wordWrap=!0,this.item_desc.innerHTML=this.itemData.vo.getDesc())},t.prototype.setAni=function(t){this.itemData.vo&&(t.removeChildren(),n.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t,this.itemData.vo.costId,1.5,1.5))},t.prototype.setIcon=function(t){this.itemData.vo&&(t.skin=p.ItemUtils.getIconById(this.itemData.vo.costId)),this.img_icon},t.prototype.onPassiveUpEnd=function(t){for(var e=t.reservedata,i=d.RoleCenter.instans.vo,n=i.getOpenHeroByIdx(e[0]),s=e[1],o=p.ItemUtils.getPassiveVoById(n.passive.idArr[s]),a=0;a<o.cost.length;a++)i.chgItemCount(parseInt(o.cost[a][0]),0-o.cost[a][1]);n.passive.idArr[s]=e[2],l.sbkPropTool.reSetSkillAndPassive(n),n.combat=n.reCheckComBat(),i.combat=i.reCheckComBat(),d.RoleCenter.instans.event(h.EventName.FIGHT_UP,e[3]),c.E.ins.event(h.EventName.PASSIVEDATA_CHANGE),c.E.ins.event(h.EventName.PASSIVE_OVER4RENDER),this._view.refreshData()},t.prototype.onPassiveDis=function(t){for(var e=t.reservedata,i=d.RoleCenter.instans.vo,n=i.getOpenHeroByIdx(e[0]),s=e[1],o=p.ItemUtils.getPassiveVoById(e[2]),a=0;a<o.backout.length;a++)i.chgItemCount(parseInt(o.backout[a][0]),o.backout[a][1]);n.passive.idArr[s]=0,l.sbkPropTool.reSetSkillAndPassive(n),i.combat=i.reCheckComBat(),d.RoleCenter.instans.event(h.EventName.FIGHT_UP,-e[3]),this.onClose(),c.E.ins.event(h.EventName.PASSIVEDATA_CHANGE),c.E.ins.event(h.EventName.PASSIVE_OVER4RENDER)},t.prototype.refreshData=function(t){this.itemData=t,this.refresh()},t.prototype.onShowItemGet=function(t){u.ItemGetDlg.create(t)},t.prototype.setNeed=function(){for(var t=[],e=d.RoleCenter.instans.vo,i=e.getOpenHeroByIdx(this._nowSelectHero),n=i.passive.idArr,s=0;s<n.length;s++)if(0!=n[s]){var o=p.ItemUtils.getPassiveVoById(n[s]);t.push(o.type)}if(this.img_red.visible=!1,this.allHas=!0,this.itemData.vo){if(this.itemData.vo.cost&&0<this.itemData.vo.cost.length){for(s=0;s<2;s++){var a=this["item_cost_"+s];if(this.itemData.vo.cost[s]){a.visible=!0;var r=p.ItemUtils.getItemVoById(this.itemData.vo.cost[s][0]),l=e.bagdata.getItemCount(r.id),h=this.itemData.vo.cost[s][1];a.setNeedName(r.name,p.ItemUtils.getSmallIcon(r.icon)),a.setQualColor(p.ItemUtils.getColorByQuality(r.quality)),a.setJump(f.TextConst.get(238),new Laya.Handler(this,this.onShowItemGet,[r.id])),a.setNeed(l,h),l<h&&(this.allHas=!1)}else a.visible=!1}this.box_cost.visible=!0}else this.box_cost.visible=!1;if(5==this.itemData.vo.quality){var c=g.PassiveStruct.Ins.getHigPassVoByType(this.itemData.vo.type);e.bagdata.getItemCount(c.id)&&(this.img_red.visible=!0)}}var u=p.ItemUtils.getPassiveVoById(i.passive.idArr[this._skillPos]);u&&0==u.cost.length?(this.btn_lvUP.disabled=!0,this.btn_lvUP.label=f.TextConst.get(208)):(this.btn_lvUP.disabled=!1,this.btn_lvUP.label=f.TextConst.get(615)),this.showUpLvAni(this.allHas&&this.btn_lvUP.label==f.TextConst.get(615))},t.prototype.onClick=function(){var t=d.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero),e=p.ItemUtils.getPassiveVoById(t.passive.idArr[this._skillPos]);if(this.allHas){var i=new r.PassiveC2GS;i.heroidx=this._nowSelectHero,i.passiveIdx=this._skillPos,i.msgidx=o.enumOpResultType.passive_upgrade,a.GSM.sendServer(i)}else if(0!=e.cost.length){var n=p.ItemUtils.getItemVoById(e.cost[0][0]),s=new u.ItemGetDlg;s.initByVo(n),s.popup(),this.close()}},t}(ui.skill.LvUpassiveUI);e.LvUpassiveView=y}),define("src/g/skill/ctrl/PassivePageCtrl",["require","exports","../../../utils/ItemUtils","../../../manager/RoleCenter","src/g/skill/view/PassivePage","../../../core/E","../../../enum/EventName","src/g/itemGets/View/ItemGetDlg","src/g/skill/view/LvUpassiveView","src/init/ResManager"],function(t,e,o,a,i,r,l,n,h,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(){this._nowSelectHero=0}return t.prototype.init=function(){return this._view||(this._view=new i.PassivePage,this.addEvent(),this._nowSelectHero=0),this},t.prototype.vipchange=function(){this._view&&this._view.displayedInStage&&this._view.refreshData()},t.prototype.addEvent=function(){var t=this;this._view.btn_handbook.on(Laya.Event.CLICK,this,function(){r.E.ins.event(l.EventName.PASSIVE_OPENHANDBOOK)}),this._view.btn_getItem.on(Laya.Event.CLICK,this,function(){t.onOpenGetItemDlg()}),this._view.btn_compound.on(Laya.Event.CLICK,this,function(){r.E.ins.event(l.EventName.PASSIVE_OPENCOMPOUND)}),r.E.ins.on(l.EventName.PASSIVE_OVER4RENDER,this,this.refreshView);for(var e=0;e<8;e++)this._view["item"+e].on(Laya.Event.CLICK,this,this.onLean,[e])},t.prototype.onOpenGetItemDlg=function(){var t=o.ItemUtils.getItemVoById(79);(new n.ItemGetDlg).initByVo(t).popup()},t.prototype.onLean=function(t){var e=a.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero),i=t;if(this.nowSelect=t,0<e.passive.idArr[i]){o.ItemUtils.getPassiveVoById(e.passive.idArr[i]);this._lvUpPassive||(this._lvUpPassive=new h.LvUpassiveView),this._lvUpPassive.showView(this._view.list_skill[i],this._nowSelectHero,i)}else{var n=e.passive.idArr;if(n[i]&&0==n[i])r.E.ins.event(l.EventName.PASSIVE_OPENLEAN,[this._nowSelectHero,i]);else{for(var s=0;s<n.length;s++)if(0==n[s])return void r.E.ins.event(l.EventName.PASSIVE_OPENLEAN,[this._nowSelectHero,s]);r.E.ins.event(l.EventName.PASSIVE_OPENLEAN,[this._nowSelectHero,i])}}},t.prototype.showPage=function(t){this._parent=t,this._parent.removeChildren(),this.loadShow()},t.prototype.loadShow=function(){this.init(),this.refreshData(),this._parent.addChild(this._view),this._view.bgimg.restskin()},t.prototype.refreshView=function(t){this.refreshData(),r.E.ins.event(l.EventName.PASSIVELVUP,this._view.list_skill[this.nowSelect])},t.prototype.changePerson=function(t){this._nowSelectHero=t,this._view&&this.refreshData()},t.prototype.getTitle=function(){return"res/skill/baodian_biaoti_wenzi4.png"},t.prototype.refreshData=function(){var t=a.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero);this._view&&this._view.showData(t,this._nowSelectHero)},t.prototype.hidePage=function(){s.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){s.ResManager.getInstance().destroyPageCtrl(this)},t}();e.PassivePageCtrl=c}),define("src/g/skill/view/SkillTip",["require","exports","../../../utils/ItemUtils","src/init/TextConst"],function(t,e,h,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.lab_desc.style.font="SimHei",t.lab_desc.style.fontSize=18,t.lab_desc.style.color="#a89e8f",t.lab_desc.style.leading=5,t.lab_desc.style.wordWrap=!0,t.lbLevel.style.font="SimHei",t.lbLevel.style.fontSize=20,t.lbLevel.style.color="#a89e8f",t}return __extends(t,e),t.prototype.update=function(t){if(null!=t){this.imgSkill.skin=h.ItemUtils.getSkillIconById(t.vo.id);var e=Number(t.vo.icon)<10?"0"+t.vo.icon:t.vo.icon;this.imgName.skin="res/skill/jineng_mingcheng_0"+e+".png",t.open?(this.lbLevel.innerHTML=i.TextConst.get(93,t.lv),this.lab_desc.innerHTML=this.skillDes(t)):(this.lab_desc.innerHTML="",this.lbLevel.innerHTML=i.TextConst.get(865,t.openLevel))}else console.error("skill dataSource is null")},t.prototype.skillDes=function(t){var e=t.vo,i=t.open;if(!(null!=e.buff&&0<e.buff)||null!=e.ext&&0!=e.ext.length||!i){a=e.ext[t.lv-1],e.ext[t.lv],r=null==a?e.des:e.des.replace("{0}",a+"");return e.buff&&(r=r.replace("{1}",e.buff+"")),e.rate&&(r=r.replace("{1}",(e.rate[t.lv-1]||0)+"")),r}if(i){var n=h.ItemUtils.getBuffVoById(e.buff),s=(e.des,n.rate),o=n.ext,a=o[t.lv-1],r=(o[t.lv],e.des);if(6==n.id){var l=n.prop[t.lv-1].PDEF;n.prop[t.lv]&&n.prop[t.lv].PDEF;r=(r=r.replace("{0}",l+"")).replace("{1}",a/100+"")}else r=null==a?e.des:e.des.replace("{0}",a+"");return s&&0<s.length&&(r=r.replace("{1}",(s[t.lv-1]||0)+"")),r}},t}(ui.skill.SkillTipUI);e.SkillTip=n}),define("src/g/skill/view/SkillItemViewNew",["require","exports","../../../utils/ItemUtils","src/g/skill/view/SkillTip","src/init/TextConst"],function(t,e,r,i,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,i,n,s){this.imgSkill=t,this.lbLevel=e,this.lbLevelState=i,this.imgName=s,this.imgStateG=n,t.on(Laya.Event.CLICK,this,this.clickHander)}return t.prototype.clickHander=function(){var t=new i.SkillTip;t.update(this.data),t.popup()},t.prototype.update=function(t){if(this.data=t){var e=t.vo,i=this.imgSkill,n=this.lbLevelState;i.skin=r.ItemUtils.getSkillIconById(e.id);var s=e.icon,o=+s<10?"0"+s:s;this.imgName.skin="res/skill/jineng_mingcheng_0"+o+".png";var a=t.open;this.lbLevel.text=a?(i.gray=!1,t.lv+""):(i.gray=!0,"0"),a&&200!=t.lv?n.visible=this.imgStateG.visible=!1:(n.visible=this.imgStateG.visible=!0,n.text=a?l.TextConst.get(208):l.TextConst.get(25,t.openLevel))}else console.error("skill dataSource is null")},t.prototype.showTip=function(t){var e=this.imgSkill;if(null!=e.parent){var i=new Laya.Label;i.color="#149b14",i.fontSize=30,i.text="+"+t,e.parent.addChild(i),i.x=e.x+(e.width-i.width>>1),i.y=e.y+(e.height-i.height>>1),i.strokeColor="#000000",i.stroke=1,Laya.Tween.to(i,{y:i.y-40},700,null,Laya.Handler.create(this,function(t){t.removeSelf()},[i]))}},t}();e.SkillItemViewNew=n}),define("src/g/skill/view/SkillPage",["require","exports","../../../enum/EventName","../../../utils/system/FloatEffect","../../net/messages/OpResultType","../../../core/GNet","../../../utils/ItemUtils","../../../manager/RoleCenter","../../../core/E","../../../plugin/sbkPropTool","../../../vo/RedDot/role/RedDot_Skill","../../../plugin/view/ToolTip","src/g/Effects/UIEffectsFactory","../../../utils/SbUtils","src/g/skill/view/SkillItemViewNew","src/init/TextConst"],function(t,e,l,i,n,s,a,h,o,c,u,r,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(e){function t(){var t=e.call(this)||this;return t.selectIndex=0,t.cantUp=!1,t.initSkRender(),t.skRDataList=[],t.p_openLv=a.ItemUtils.getSkillSettingVo().openLimit,h.RoleCenter.instans.on(n.enumOpResultType.skillUpgrade_all+"",t,t.skillUPAll),o.E.ins.on(l.EventName.ADDED_LEVEL,t,t.addRefresh),o.E.ins.on(l.EventName.ADDED_MONEY,t,t.addRefresh),t.addEvent(),t}return __extends(t,e),t.prototype.initSkRender=function(){var t;this.skRenderList=[];for(var e=0;e<5;e++)t=new g.SkillItemViewNew(this["imgSkill"+e],this["lbLevel"+e],this["lbSkillState"+e],this["skillStateG"+e],this["imgName"+e]),this.skRenderList.push(t)},t.prototype.skillUPAll=function(t){var e=t.reservedata,i=e[0],n=e[1];if(n){for(var s,o=h.RoleCenter.instans.vo.getOpenHeroByIdx(i),a=3;a<e.length;a++){if(i==this.p_heroIdx){s=a-3;var r=e[a]-o.skillLvl[s];0<r&&null!=this.skRenderList[s]&&this.skRenderList[s].showTip(r)}o.skillLvl[s]=e[a]}c.sbkPropTool.reSetSkillAndPassive(o),o.combat=o.reCheckComBat(),h.RoleCenter.instans.vo.combat=h.RoleCenter.instans.vo.reCheckComBat(),h.RoleCenter.instans.event(l.EventName.FIGHT_UP,n),h.RoleCenter.instans.event(l.EventName.ROLE_PROP_CHANGE),this.refreshData(),this.showAni(),u.RedDot_Skill.Ins.checkSkill()}},t.prototype.showAni=function(){p.UIEffectsFactory.Ins.playAniOnce(11,this.ani,1.3,1.3)},t.prototype.stopAni=function(){this.ani.removeChildren()},t.prototype.addEvent=function(){this.btn_upAll.on(Laya.Event.CLICK,this,this.onUpAll),this.on(Laya.Event.REMOVED,this,this.onRemoved)},t.prototype.onRemoved=function(){this.stopAni()},t.prototype.onUpAll=function(){var t=parseInt(this.lab_allNeed.text);h.RoleCenter.instans.vo.MONEY<t||0==t?this.maxLv&&this.cantUp?i.FE.upItems(v.TextConst.get(767),r.BubbleEnum.center):i.FE.upItems(v.TextConst.get(220),r.BubbleEnum.center):s.GNet.skillUp(this.p_heroIdx,n.enumOpResultType.skillUpgrade_all,h.RoleCenter.instans.vo.MONEY)},t.prototype.showData=function(t,e){this.selectIndex=0,this.hero=t,this.p_heroIdx=e,this.refreshData()},t.prototype.addRefresh=function(){this.displayedInStage&&this.refreshData()},t.prototype.refreshData=function(){this.p_arr_skills=this.hero.openSkill,this.p_arr_skill_lv=this.hero.skillLvl;var t=a.ItemUtils.getHeroVoById(this.hero.jobid);this.hero.openSkill.length!=t.skills.length?this.p_arr_hasSkill=t.skills:this.p_arr_hasSkill=this.hero.openSkill.concat();var e=d.SbUtils.getOneSbDataByJob(this.hero.jobid);if(e){for(var i=0;i<e.giftPropC.length;i+=2){var n=this.p_arr_hasSkill.indexOf(e.giftPropC[i]);-1!=n&&(this.p_arr_hasSkill[n]=e.giftPropC[i+1])}this.rendPage()}else this.rendPage()},t.prototype.rendPage=function(){for(var t,e,i,n=0;n<this.p_arr_hasSkill.length;n++)null==(t=this.skRDataList[n])&&(t=new y,this.skRDataList[n]=t),e=a.ItemUtils.getSkillVoById(this.p_arr_hasSkill[n]),t.vo=e,t.open=0<this.p_arr_skill_lv[n],t.lv=this.p_arr_skill_lv[n],t.openLevel=this.p_openLv[n],null!=(i=this.skRenderList[n])&&i.update(t);this.refreshUpLvNeed()},t.prototype.refreshUpLvNeed=function(){this.userVo=h.RoleCenter.instans.vo,this.skillcfg=a.ItemUtils.getSkillSettingVo();var t=this.skRDataList,e=a.ItemUtils.getZhuanShengVoById(this.userVo.zhuanshengLv);this.maxLv=0<this.userVo.zhuanshengLv?e.sklevel:80<=this.userVo.lvl?80:this.userVo.lvl;for(var i=0,n=this.maxLv,s=0;s<t.length;s++)t[s].lv<n&&(n=t[s].lv);if(this.cantUp=n==this.maxLv,this.cantUp)i=0;else for(var o=n;o<this.maxLv;o++)for(s=0;s<t.length;s++)if(t[s].open&&t[s].lv<=o){if(!(h.RoleCenter.instans.vo.MONEY>i+this.skillcfg.cost[o]))break;i+=this.skillcfg.cost[o]}this.lab_allNeed.text=i+"",this.lab_allNeed.color=this.userVo.MONEY>=i?"#c0b4a3":"#ff0f15"},t}(ui.skill.Page.SkillPageUI);e.SkillPage=f;var y=function(){};e.SkillRenderData=y}),define("src/g/skill/ctrl/SkillPageCtrl",["require","exports","../../../manager/RoleCenter","src/g/skill/view/SkillPage","src/init/ResManager","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){this._nowSelectHero=0}return t.prototype.init=function(){return this._view||(this._view=new n.SkillPage),this},Object.defineProperty(t.prototype,"isShow",{get:function(){return this._view.displayedInStage},enumerable:!0,configurable:!0}),t.prototype.showPage=function(t){t.removeChildren(),this._view||this.init(),this.refreshData(),t.addChild(this._view),o.ClearResM.resetViewImg(this._view),s.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t){this._nowSelectHero=t,this._view&&this.refreshData()},t.prototype.getTitle=function(){return"res/skill/jineng_title.png"},t.prototype.refreshData=function(){var t=i.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero);this._view.showData(t,this._nowSelectHero)},t.prototype.hidePage=function(){s.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){s.ResManager.getInstance().destroyPageCtrl(this)},t}();e.SkillPageCtrl=a}),define("src/g/skill/view/SkillView",["require","exports","../../../manager/LayerManager","src/g/clearRes/ClearResM","../../../core/E","../../../enum/EventName","../../../enum/GuideTargetName","../../../enum/GameConst"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){},e.prototype.showView=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),n.ClearResM.resetViewImg(this),s.E.ins.event(o.EventName.COMPTYPE_OPENVIEW,a.GuideTargetName.SKILL_VIEW),i.LayerManager.addInPOPWindowLayer(this,t,!0,!0,!1,e),s.E.ins.on(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},e.prototype.closeClearRes=function(){s.E.ins.off(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),n.ClearResM.clearFolderByUrl(r.GameConst.SkiLLICON_RES_URL),n.ClearResM.clearResFolder("skill/bookImg/"),n.ClearResM.clearUrl("res/atlas/res/skill/handbook.json")},e.prototype.hideView=function(){this.bjView.box_page.removeChildren(),this.removeSelf(),s.E.ins.event(o.EventName.COMPTYPE_CLOSEVIEW,a.GuideTargetName.SKILL_VIEW)},e.prototype.destroyView=function(){this.hideView()},e}(ui.skill.SkillViewUI);e.SkillView=l}),define("src/g/skill/view/PassiveHandBookView",["require","exports","src/g/skill/vo/PassiveStruct","../../../utils/ItemUtils","src/g/Effects/UIEffectsFactory","src/g/clearRes/ClearResM","../../../meta/QualiyVo"],function(t,e,i,s,n,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.t_arr=[],t.init(),o.ClearResM.addBgUrl(t.bgimg.skin),t}return __extends(t,e),t.prototype.init=function(){this.ani=n.UIEffectsFactory.Ins.createUIAniById(a.QualityStruct.Ins.getQEffById(5),!0),this.addEvent(),this.changePage(0),this.onClick(0)},t.prototype.addEvent=function(){this.tab_pageSelect.selectHandler=new Laya.Handler(this,this.changePage);for(var t=0;t<8;t++)this["item_"+t].on(Laya.Event.CLICK,this,this.onClick,[t])},t.prototype.showView=function(){this.changePage(0),this.tab_pageSelect.selectedIndex=0,this.popup()},t.prototype.changePage=function(t){this.bgimg.skin="",this.bgimg.skin=0==t?"res/bg/baodian_beijing5.jpg":"res/bg/baodian_beijing4.jpg",this.img_title.skin=0==t?"res/skill/baodian_biaoti_wenzi4.png":"res/skill/baodian_biaoti_wenzi5.png",this.t_arr=[],this.t_arr=0==t?i.PassiveStruct.Ins.getLowPassArr():i.PassiveStruct.Ins.getHigPassArr();for(var e=0;e<this.t_arr.length;e++)this.renderFunc(e,this.t_arr[e],t);this.onClick(0)},t.prototype.onClick=function(t){for(var e=0;e<8;e++){this["item_"+e].setSelcet(e==t)}this.showDesc(this.t_arr[t])},t.prototype.showDesc=function(t){this.lab_desc.style.font="SimHei",this.lab_desc.style.fontSize=20,this.lab_desc.style.color="#a89e8f",this.lab_desc.style.align="left",this.lab_desc.style.wordWrap=!0,this.lab_desc.innerHTML=t.getDesc()},t.prototype.renderFunc=function(t,e,i){var n=this["item_"+t];n.setIconBg(1==i),n.setName(e.name,5==e.quality?"#ff0f0f":"#fff55c"),n.setIcon(s.ItemUtils.getIconById(parseInt(e.backout[0][0])))},t}(ui.skill.PassiveHandBookUI);e.PassiveHandBookView=r}),define("src/g/skill/ctrl/PassiveHandBookCtrl",["require","exports","../../../enum/EventName","src/g/skill/view/PassiveHandBookView","../../../core/E"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){s.E.ins.on(i.EventName.PASSIVE_OPENHANDBOOK,this,this.showView)}return t.prototype.showView=function(){this._view||(this._view=new n.PassiveHandBookView,this.addEvent()),this._view.showView()},t.prototype.addEvent=function(){this._view.btn_back.on(Laya.Event.CLICK,this,this.hideView),this._view.btn_close.on(Laya.Event.CLICK,this,this.hideView)},t.prototype.hideView=function(){this._view.close()},t}();e.PassiveHandBookCtrl=o}),define("src/g/skill/view/CardResloveDlg",["require","exports","../../../manager/RoleCenter","../../../core/E","../../../enum/EventName","../../../meta/CardVo","../../../utils/ItemUtils","../../../meta/CardLevel","../../net/messages/PropFightMain","../../../plugin/sbkPropTool","../../net/messages/sbkCardMsg","../../../manager/GameSocketManager","../../../config/GameConfig","src/g/clearRes/ClearResM"],function(t,e,n,s,o,a,r,l,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function i(){var t=e.call(this)||this;return t._allidobj={},t.addEvent(),t}return __extends(i,e),i.create=function(){var t=new i;t.refreshData(),t.popup()},i.prototype.addEvent=function(){s.E.ins.on(o.EventName.CardReslove,this,this.refreshData),this.view_bg.btn_back.on(Laya.Event.CLICK,this,this.onClose),this.view_bg.btn_close.on(Laya.Event.CLICK,this,this.onClose),this.list_.renderHandler=new Laya.Handler(this,this.listRender),this.btn_all.on(Laya.Event.CLICK,this,this.allBtn)},i.prototype.allBtn=function(){var t=this.list_.array;if(t){for(var e=0;e<t.length;e++)this._allidobj[t[e]]=(this._allidobj[t[e]]||0)+1;Laya.timer.loop(10,this,this.delayHandler)}},i.prototype.delayHandler=function(){var t=!1;for(var e in this._allidobj){var i=this._allidobj[e];if(i){t=!0;var n=new u.CardResolveMsg;n.cardItemId=Number(e),n.count=i,p.GSM.sendServer(n),this._allidobj[e]=0;break}}t||Laya.timer.clear(this,this.delayHandler)},i.prototype.refreshData=function(){this.user=n.RoleCenter.instans.vo,this.bag=this.user.bagdata,this.card=this.user.cardData,this.initData()},i.prototype.initData=function(){for(var t=[],e=d.GameConfig.commonJson.card_begin.value;e<d.GameConfig.commonJson.card_end.value;e++){var i=this.bag.getItemCount(e);if(0<i){var n=a.CardStruct.Ins.getCardVoByItemId(e);for(var s in this.card.typeArr)if(this.card.typeArr[s].type==n.type&&-1<this.card.typeArr[s].cardIdArr.indexOf(n.id)){for(var o=0;o<i;o++)t.push(e);break}}}this.list_.dataSource=t,null==this.list_.array||0==this.list_.array.length?(this.imgEmpty.visible=!0,this.imgEmpty.skin="",this.imgEmpty.skin="res/skill/tujian_feijiebeijingtu.png"):this.imgEmpty.visible=!1},i.prototype.listRender=function(t,e){var i=t.dataSource,n=a.CardStruct.Ins.getCardVoByItemId(i);t.img_head.skin=r.ItemUtils.getIconById(i),t.lab_name.text=n.name,t.lab_name.color=r.ItemUtils.getColorByQuality(n.quality),t.img_bg.skin=r.ItemUtils.getQualitybjByQualityId(n.quality);var s=l.CardLevelStruct.Ins.getVo(n.id,0),o=new h.PropFightMain;c.sbkPropTool.reSetProp(o,s.prop),t.lab_exp.text=n.value+"",t.btn_reslove.once(Laya.Event.CLICK,this,this.onReslove,[i])},i.prototype.onReslove=function(t){var e=new u.CardResolveMsg;e.cardItemId=t,e.count=1,p.GSM.sendServer(e)},i.prototype.onClose=function(){s.E.ins.off(o.EventName.CardReslove,this,this.refreshData),this.view_bg.btn_back.off(Laya.Event.CLICK,this,this.onClosed),this.view_bg.btn_close.off(Laya.Event.CLICK,this,this.onClosed),this.list_.renderHandler=null,e.prototype.close.call(this),g.ClearResM.clearUrl(this.imgEmpty.skin)},i}(ui.skill.Page.CardResloveDlgUI);e.CardResloveDlg=i}),define("src/g/skill/view/HandBookItem",["require","exports","src/g/Effects/UIEffectsFactory"],function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.starList.renderHandler=new Laya.Handler(t,t.starRender),t}return __extends(t,e),t.prototype.starRender=function(t,e){var i=t.dataSource;null!=i&&(t.skin="res/skill/handbook/star_"+i+".png")},t.prototype.setBgImg=function(t){this.img_icon.skin="dynamic/handbook/"+t+".png"},t.prototype.setQual=function(t){this.img_line.skin="res/skill/handbook/di_"+t+".png",this.img_kuang.skin="res/skill/bookImg/qual_"+t+".png";var e=0;switch(t){case 3:e=143;break;case 4:e=144;break;case 5:e=145;break;case 6:e=146}this.aniId=e},t.prototype.setName=function(t,e){this.lab_name.text=t,this.lab_name.color=e},t.prototype.setAchivate=function(t){var e=this.aniSp,i=this.aniId,n=e.getChildByName("ani");switch(t){case 0:this.img_line.gray=!0,this.img_icon.gray=!0,this.img_kuang.gray=!1,this.img_di.gray=!0,n&&n.destroy();break;case 1:this.img_line.gray=!0,this.img_icon.gray=!0,this.img_kuang.gray=!1,this.img_di.gray=!0,n&&(n.destroy(),n=null),n||(n=s.UIEffectsFactory.Ins.createSAniAndCenter(e,73));break;case 2:this.img_line.gray=!1,this.img_icon.gray=!1,this.img_kuang.gray=!1,this.img_di.gray=!1,n&&(n.destroy(),n=null),0!=i&&(n||(n=s.UIEffectsFactory.Ins.createSAniAndCenter(e,i,1.5,1.5)))}},t.prototype.setFightNum=function(t){var e=t+"",i=this.img_zhan,n=this.fightBox,s=this.num_fight;s.value=e;var o=i.x+i.width+s.x+s.clipX*e.length;n.x=(this.width-o)/2},t.prototype.setStar=function(t,e){for(var i=[],n=0;n<t;n++)n<e?i.push(1):i.push(0);this.starList.dataSource=i},t}(ui.skill.Item.GHandBookItemUI);e.HandBookItem=i}),define("src/g/skill/view/CardInfoDlg",["require","exports","../../../meta/CardLevel","../../../utils/ItemUtils","../../../manager/RoleCenter","../../net/messages/sbkCardMsg","../../../manager/GameSocketManager","../../../meta/ShuXingVo","../../../core/E","../../../enum/EventName","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/g/skill/view/CardResloveDlg","src/g/Effects/UIEffectsFactory","../../../manager/TipManager","src/g/clearRes/ClearResM","src/g/skill/view/HandBookItem","../../../utils/RoleUtil","src/init/TextConst"],function(t,e,r,a,l,i,n,h,s,o,c,u,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(e){function t(){var t=e.call(this)||this;return t._canUpLv=!1,t._canOpen=!1,t._isMax=!1,t.isUpLv=!1,t._data=null,t._lv=0,t.ani=null,t.addEvent(),t._item=new f.HandBookItem,t.addChildAt(t._item,t.getChildIndex(t.aniSp)),t._item.x=155,t._item.y=97,t._item.scale(1.2,1.2),v.ClearResM.addBgUrl(t.bgimg.skin),t}return __extends(t,e),t.prototype.addEvent=function(){this.view_bg.btn_back.visible=!1,this.view_bg.btn_close.on(Laya.Event.CLICK,this,this.closeView),this.btn_go.on(Laya.Event.CLICK,this,this.onClicked),this.lab_get.on(Laya.Event.CLICK,this,this.onOpenReslove),s.E.ins.on(o.EventName.CardAchivate,this,this.onUpLv),s.E.ins.on(o.EventName.CardUpLv,this,this.onUpLv)},t.prototype.onOpenReslove=function(){this.isUpLv?(p.CardResloveDlg.create(),this.closeView()):c.FE.upItems(m.TextConst.get(754),u.BubbleEnum.center)},t.prototype.setData=function(t,e,i){this._data=t,this._lv=e,this.isUpLv=i,this.bgimg.restskin()},t.prototype.onUpLv=function(t,e,i){this.setData(t,e,i),0==e?g.TipManager.showCardTip(t.name,"dynamic/handbook/"+t.imgLight+".png",t.quality,Laya.Handler.create(this,this.closeView)):(d.UIEffectsFactory.Ins.playAniOnce(11,this.aniSp,1.3,1.3),this.refreshData())},t.prototype.refreshData=function(){this.renderItem(),this.isUpLv?this.renderByUpLv():this.renderByAchivate(),this.renderAttr()},t.prototype.renderItem=function(){var t=this._data,e=this._item;e.setBgImg(t.imgLight),e.setQual(t.quality),this.lab_typedesc.text=t.imgShow||"";var i=this.isUpLv;this._canOpen=0<l.RoleCenter.instans.vo.bagdata.getItemCount(t.itemId)&&!i,e.setAchivate(i?2:this._canOpen?1:0);var n=this._lv,s=r.CardLevelStruct.Ins.getVo(t.id,n),o=3*y.RoleUtil.calFightByProp(s.prop);e.setFightNum(o+t.power),this.item_fight.num_Fight.value=o+t.power+"",e.setStar(i?t.topStar:0,n),e.setName(t.name,a.ItemUtils.getColorByQuality(t.quality)),i||(e.lab_name.color="#e7dede"),this.lab_need.width=20*(t.name.length+1),this.box_need.width=this.lab_want.width+this.lab_need.width,this.box_need.x=(this.box_achivate.width-this.box_need.width)/2},t.prototype.renderUIEff=function(){this._canOpen||!this._isMax&&this._canUpLv?this.ani||(this.ani=d.UIEffectsFactory.Ins.createUIAniById(42,!0),this.ani.width*=1.6,this.ani.scaleX=1.6,this.ani.height*=1.1,this.ani.scaleY=1.1,d.UIEffectsFactory.Ins.centered4Parent(this.ani,this.btn_go,!0)):this.ani&&(this.ani.destroy(),this.ani=null)},t.prototype.renderAttr=function(){var t=null,e=null;this.isUpLv?(t=r.CardLevelStruct.Ins.getVo(this._data.id,this._lv),e=r.CardLevelStruct.Ins.getVo(this._data.id,this._lv+1)):(t=new r.CardLevelVo,e=r.CardLevelStruct.Ins.getVo(this._data.id,this._lv),t.prop=e.prop),this.box_nowAttr.removeChildren(),this.box_nextAttr.removeChildren();for(var i=0,n=0,s=0;s<t.prop.length;s++){var o=null;i+=(o=this.isUpLv?h.ShuXingVo.createSXBox(t.prop[s][0],t.prop[s][1]):h.ShuXingVo.createSXBox(t.prop[s][0],0,"#a89e8f",":","#a89e8f")).height,this.box_nowAttr.addChild(o);var a=null;if(e)a=h.ShuXingVo.createSXBox(e.prop[s][0],e.prop[s][1],"#03bb00",":","#03bb00"),this.img_next.visible=!0;else{if(0<s)continue;a=h.ShuXingVo.createSXBox(m.TextConst.get(843),-1,"#09d51f"),this.img_next.visible=!1}n+=a.height,this.box_nextAttr.addChild(a)}this.box_nowAttr.height=i,this.box_nextAttr.height=n,this.renderUIEff()},t.prototype.renderByUpLv=function(){var t,e=!1;this.box_achivate.visible=!0,this.box_need.visible=!1,this.lab_upExp.visible=!0,this.box_upBar.visible=!0;var i=r.CardLevelStruct.Ins.getVo(this._data.id,this._lv);if(t=this._lv==this._data.topStar)this.box_bar.visible=!1,this.lab_upExp.text="";else{this.box_bar.visible=!0;var n=l.RoleCenter.instans.vo.CARDCHIP;this.lab_upExp.text=n+"/"+i.cost,this.lab_upExp.color=n<i.cost?"#ff0f15":"#03bb00",e=n>=i.cost,this.bar_pan.width=this.bar_img.width*(n/i.cost)}this._canUpLv=e,this._isMax=t,this.btn_go.label=m.TextConst.get(615),this.lab_get.text=m.TextConst.get(755)},t.prototype.renderByAchivate=function(){this._isMax=!1,this._canUpLv=!1,this.box_achivate.visible=!0,this.box_need.visible=!0,this.box_upBar.visible=!1;var t=a.ItemUtils.getItemVoById(this._data.itemId);this.lab_need.text=t.name,this.lab_need.color=a.ItemUtils.getColorByQuality(t.quality),this.btn_go.label=m.TextConst.get(237),this.lab_get.text=m.TextConst.get(756)},t.prototype.onClicked=function(){if(this.isUpLv){if(!this._canUpLv||this._isMax)return this._isMax?void c.FE.upItems(m.TextConst.get(757),u.BubbleEnum.center):void c.FE.upItems(m.TextConst.get(758),u.BubbleEnum.center);(t=new i.CardLvGroupUpMsg).cardId=this._data.id,t.cardLv=this._lv,n.GSM.sendServer(t)}else{var t;(t=new i.CardActivateMsg).cardId=this._data.id,n.GSM.sendServer(t)}},t.prototype.closeView=function(){this.close()},t}(ui.skill.Page.CardInfoDlgUI);e.CardInfoDlg=_}),define("src/g/skill/ctrl/CardInfoDlgCtrl",["require","exports","src/g/skill/view/CardInfoDlg","src/g/clearRes/ClearResM"],function(t,e,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){t._ins=this}return Object.defineProperty(t,"Ins",{get:function(){return t._ins||new t},enumerable:!0,configurable:!0}),t.prototype.showView=function(t,e,i){this._view||(this._view=new n.CardInfoDlg),s.ClearResM.resetViewImg(this._view),this._view.setData(t,e,i),this._view.refreshData(),this._view.popup()},t}();e.CardInfoDlgCtrl=i}),define("src/g/skill/view/CardSuitDlg",["require","exports","../../net/messages/sbkCardData","../../../meta/CardSuitVo","../../../manager/RoleCenter","../../../meta/ShuXingVo","src/g/skill/view/GHandBookView","src/init/TextConst"],function(t,e,g,o,a,v,r,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function n(){var t=e.call(this)||this;return t.btn_close.on(Laya.Event.CLICK,t,t.closeDlg),t.list_.renderHandler=new Laya.Handler(t,t.listRender),t}return __extends(n,e),n.create=function(t,e){var i=new n;i.initView(t,e),i.popup()},n.prototype.initView=function(t,e){this.teamId=e,this.data=a.RoleCenter.instans.vo.cardData,this.typeData=r.GHandBookView.getTypeData(this.data.typeArr,t);var i=o.CardSuitStruct.Ins.getVo(e),n=[];for(var s in i)0<i[s].level&&n.push(i[s]);this.list_.dataSource=n},n.prototype.listRender=function(t,e){for(var i=this.teamId,n=this.typeData,s=t.dataSource,o=null,a=n.teamArr,r=0;r<a.length;r++)if(a[r].teamId==i){o=a[r];break}o||((o=new g.sbkCardTeamData).teamId=i,a.push(o)),t.num_clip.value=s.level+"";var l=s.count,h=o.count;t.lab_count.text=f.TextConst.get(866,l<h?l:h,l);var c=o.lv>=s.level;t.lab_count.color=c?"#e5c58e":"#d75521",t._attr0.removeChildren(),t._attr1.removeChildren();var u=0,p=0;for(r=0;r<s.suitProp.length;r++){var d=v.ShuXingVo.createSXBox(s.suitProp[r][0],s.suitProp[r][1],c?"#09d51f":"#666666","+",c?"#09d51f":"#666666");r%2==0?(t._attr0.addChild(d),u+=d.height):(t._attr1.addChild(d),p+=d.height)}t._attr0.height=u,t._attr1.height=p},n.prototype.closeDlg=function(){this.btn_close.off(Laya.Event.CLICK,this,this.onClosed),this.list_.renderHandler=null,this.removeSelf(),this.close()},n}(ui.skill.Page.HandBookSuitUI);e.CardSuitDlg=i}),define("src/g/skill/view/NewCardGroup",["require","exports","src/g/skill/view/HandBookItem","../../../meta/CardLevel","../../../utils/ItemUtils","src/g/skill/ctrl/CardInfoDlgCtrl","../../../manager/RoleCenter","src/g/skill/view/GHandBookView","src/g/skill/view/CardSuitDlg","../../../meta/CardSuitVo","../../../utils/RoleUtil","src/init/TextConst"],function(t,e,i,p,d,a,g,v,n,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.cardResArr=[],t.cardList.itemRender=i.HandBookItem,t.cardList.renderHandler=new Laya.Handler(t,t.listItemRender),t.cardList.mouseHandler=new Laya.Handler(t,t.onItemSelect),t.info.on(Laya.Event.CLICK,t,t.onClick),t}return __extends(t,e),t.prototype.dispose=function(){for(var t=this.cardResArr,e=0;e<t.length;e++)Laya.loader.clearRes(t[e])},t.prototype.onClick=function(t){switch(t.currentTarget){case this.info:n.CardSuitDlg.create(this.typeData.type,this.cardList.array[0].team)}},t.prototype.refresh=function(t,e){this.typeData=t;var i=this.cardList;i.array=e,i.repeatY=Math.ceil(e.length/i.repeatX),i.height=i.repeatY*(240+i.spaceY);var n="",s=e[0];s&&(n="dynamic/handbooktitle/"+s.team+".png"),this.groupName.skin=n;var o=0,a=0,r=t.teamArr;if(s){for(var l=0;l<r.length;l++){var h=r[l];if(h.teamId==s.team){o=h.lv,a=h.count;break}}var c=f.CardSuitStruct.Ins.getVo(s.team,o),u=f.CardSuitStruct.Ins.getVo(s.team,o+1);this.desc.text=m.TextConst.get(766,a,u?u.count:c.count,u?m.TextConst.get(765,o+1):m.TextConst.get(764))}},t.prototype.onItemSelect=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.cardList.getCell(e),n=this.typeData.cardIdArr.indexOf(i.dataSource.id),s=-1<n,o=s?this.typeData.cardLvArr[n]:0;a.CardInfoDlgCtrl.Ins.showView(i.dataSource,o,s)}},t.prototype.listItemRender=function(t,e){var i=this.typeData,n=t.dataSource,s=i.cardIdArr.indexOf(n.id);t.setBgImg(n.imgLight);var o="dynamic/handbook/"+n.imgLight+".png";-1==this.cardResArr.indexOf(o)&&this.cardResArr.push(o),t.setQual(n.quality);var a=-1<s;t.setAchivate(a?2:v.GHandBookView.checkRed(i,n));var r=a?i.cardLvArr[s]:0,l=p.CardLevelStruct.Ins.getVo(n.id,r);t.setFightNum(3*y.RoleUtil.calFightByProp(l.prop)+n.power),t.setStar(n.topStar,r),t.setName(n.name,d.ItemUtils.getColorByQuality(n.quality)),a||(t.lab_name.color="#e7dede");var h=g.RoleCenter.instans.vo.CARDCHIP,c=p.CardLevelStruct.Ins.getVo(n.id,r+1);if(a)c&&l.cost&&l.cost<=h?t.img_red.visible=!0:t.img_red.visible=!1;else{var u=g.RoleCenter.instans.vo.bagdata.getItemCount(n.itemId);t.img_red.visible=0<u}},t}(ui.skill.Item.NewCardGroupUI);e.NewCardGroup=s}),define("src/g/skill/view/GHandBookView",["require","exports","../../net/messages/sbkCardData","../../../manager/RoleCenter","../../../meta/CardVo","../../../config/GameConfig","../../net/messages/PropFightMain","../../../plugin/sbkPropTool","../../../meta/CardLevel","../../net/messages/sbkFormula","../../../meta/CardSuitVo","src/g/skill/view/CardResloveDlg","../../../vo/RedDot/role/RedDot_HandBook","../../../vo/RedDot/EventRedDot","../../../core/E","src/g/Effects/UIEffectsFactory","../../../enum/EventName","src/g/skill/view/NewCardGroup","src/g/clearRes/ClearResM"],function(t,e,s,u,E,i,p,d,v,g,f,n,c,o,a,r,l,T,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(e){function S(){var t=e.call(this)||this;return t.cardGroupIdx=0,t.selectedId=0,t.cardGroup={},t._nowSelectTab=-1,t.list_tab.scrollBar.changeHandler=new Laya.Handler(t,t.refreshRed4Btn),t.list_tab.renderHandler=new Laya.Handler(t,t.listTabRender),t.list_tab.selectHandler=new Laya.Handler(t,t.onTabSelect),t.lab_reslove.on(Laya.Event.CLICK,t,t.openResloveDlg),t.btn_left.on(Laya.Event.CLICK,t,t.Turn,[-30]),t.btn_right.on(Laya.Event.CLICK,t,t.Turn,[30]),a.E.ins.on(o.EventRedDot.REFRESH_HANDBOOKBAR,t,t.refreshRed4Btn),t.list_tab.scrollBar.elasticDistance=50,a.E.ins.once(l.EventName.CLOSEALLWINDOWS,t,t.closeClearRes),t}return __extends(S,e),S.prototype.closeClearRes=function(){a.E.ins.off(o.EventRedDot.REFRESH_HANDBOOKBAR,this,this.refreshRed4Btn),h.ClearResM.clearFolderByUrl("dynamic/handbooktitle");for(var t=this.item_box,e=0;e<t.numChildren;e++){t.getChildAt(e).dispose()}},S.prototype.Turn=function(t){this.list_tab.scrollBar.value+=t},S.prototype.openResloveDlg=function(){n.CardResloveDlg.create()},S.prototype.setSelectedById=function(t,e){var i=E.CardStruct.Ins.getCardTypeByItemId(t);this.list_tab.selectedIndex=i-1;var n=E.CardStruct.Ins.getCardSortById(t,e);n=n.sort(),this.cardGroupIdx=n.indexOf(e.quality)},S.prototype.JC_ResloveDlg=function(){c.RedDot_HandBook.Ins.getCanReslove()?this.texiao||(this.texiao=r.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.box_reslove,42,1.3,.7)):(this.texiao&&this.texiao.destroy(),this.texiao=null)},S.prototype.initTab=function(){if(!this.list_tab.dataSource){var t=[];for(var e in i.GameConfig.cardlist)"null"!=e&&t.push(i.GameConfig.cardlist[e]);t.sort(function(t,e){return t.sort-e.sort}),this.list_tab.dataSource=t}},S.prototype.refreshData=function(){this.user=u.RoleCenter.instans.vo,this.data=this.user.cardData,this.initTab(),-1==this.list_tab.selectedIndex&&(this.list_tab.selectedIndex=0),this.onTabSelect(this.list_tab.selectedIndex),this.list_tab.refresh(),this.lab_exp.text=this.user.CARDCHIP+"",this.refreshFightNum(),this.refreshRed4Btn()},S.prototype.refreshPageByAchivate=function(){this.initTab(),-1==this.list_tab.selectedIndex&&(this.list_tab.selectedIndex=0),this.onTabSelect(this.list_tab.selectedIndex),this.lab_exp.text=this.user.CARDCHIP+"",this.refreshFightNum(),this.refreshRed4Btn()},S.prototype.refreshPage=function(){this.lab_exp.text=this.user.CARDCHIP+"",this.list_tab.refresh(),this.refreshFightNum()},S.prototype.refreshFightNum=function(){for(var t=new p.PropFightMain,e=0,i=this.data.typeArr,n=0;n<i.length;n++){for(var s=i[n],o=s.teamArr,a=0;a<o.length;a++){var r=o[a],l=f.CardSuitStruct.Ins.getVo(r.teamId,r.lv);d.sbkPropTool.reSetProp(t,l.suitProp,!1)}for(var h=0;h<s.cardIdArr.length;h++){var c=v.CardLevelStruct.Ins.getVo(s.cardIdArr[h],s.cardLvArr[h]);d.sbkPropTool.reSetProp(t,c.prop,!1),e+=E.CardStruct.Ins.getCardVoById(s.cardIdArr[h]).power}}this.fightNum.num_Fight.value=g.sbkFormula.calPropFightMainCombat(t)*u.RoleCenter.instans.vo.heronum+e+""},S.prototype.refreshRed4Btn=function(t){if(void 0===t&&(t=-1),this.JC_ResloveDlg(),this.list_tab.scrollBar){(t=-1)&&(t=this.list_tab.scrollBar.value);var e=this.list_tab.length,i=85*e+(e-1)*this.list_tab.spaceX,n=i-this.list_tab.width,s=n/this.list_tab.scrollBar.max*t,o=i-n+s,a=c.RedDot_HandBook.Ins.getRed(!0);this.red_left.visible=!1;for(var r=0;r<e;r++){if(h=this.list_tab.getCell(r)){var l=h.getChildByName("red");if(h.x>=s)break;if(h.x+h.width<s&&a[r]){this.red_right.visible=!0;break}}}this.red_right.visible=!1;for(r=e-1;0<=r;r--){var h;if(h=this.list_tab.getCell(r)){l=h.getChildByName("red");if(h.x+h.width<o)break;if(h.x+l.x+l.width>o&&a[r]){this.red_right.visible=!0;break}}}this.btn_left.visible=!(t<=0),this.btn_right.visible=!(t>=this.list_tab.scrollBar.max)}},S.prototype.listTabRender=function(t,e){var i=t.getChildByName("img"),n=t.getChildByName("red"),s=t.getChildByName("select"),o=t.dataSource;s.visible=e==this._nowSelectTab,i.restskin(),i.skin="res/skill/handbook/"+o.icon+".png";var a=E.CardStruct.Ins.getCardVo(e+1),r=this.user.CARDCHIP,l=S.getTypeData(this.data.typeArr,e+1),h=[];for(var c in a)a[c]&&h.push(a[c]);for(c=0;c<h.length;c++){var u=h[c],p=l.cardIdArr.indexOf(u.id);if(p<0){if(0<this.user.bagdata.getItemCount(u.itemId))return void(n.visible=!0)}else{var d=l.cardLvArr[p],g=v.CardLevelStruct.Ins.getVo(u.id,d);if(v.CardLevelStruct.Ins.getVo(u.id,d+1)&&g.cost&&g.cost<=r)return void(n.visible=!0)}}n.visible=!1},S.prototype.onTabSelect=function(t){var n=this;if(-1!=t){this._nowSelectTab=t;var e=E.CardStruct.Ins.getCardVo(t+1),i=S.getTypeData(this.data.typeArr,t+1),s={};for(var o in e){var a=e[o];(p=s[a.team])||(s[a.team]=p=[]),p.push(a)}var r=this.item_box;r.removeChildren();for(var l=Object.keys(s),h=[],c=[],u=0;u<l.length;u++){for(var p=s[l[u]],d=!0,g=0;g<p.length;g++){var v=p[g],f=i.cardIdArr.indexOf(v.id),y=-1!=f?i.cardLvArr[f]:0;if(v.topStar!=y){d=!1;break}}d?c.push(p):h.push(p)}var m=h.concat(c);for(u=0;u<m.length;u++){(p=m[u]).sort(function(t,e){return t.id-e.id});for(var _=[],C=0;C<p.length;C++){var I=p[C];1==S.checkRed(i,I)&&(p.splice(C,1),_.push(I),C--)}var b="group"+(p=_.concat(p))[0].team,w=r.getChildByName(b);w||(w=this.cardGroup[b])||(this.cardGroup[b]=w=new T.NewCardGroup,w.name=b),r.addChild(w),w.refresh(i,p)}this.selectedId!==this.list_tab.selectedIndex&&(this.item_panel.vScrollBar.value=0,this.selectedId=this.list_tab.selectedIndex),Laya.timer.frameOnce(1,this,function(){var t=n.cardGroupIdx;if(0<t){var e=n.item_box.getChildAt(t);if(e){var i=e.y;n.item_panel.vScrollBar.value=i,n.item_panel.vScrollBar.slider.value=i}n.cardGroupIdx=0}})}},S.getTypeData=function(t,e){for(var i=null,n=0;n<t.length;n++)if(t[n].type==e){i=t[n];break}return i||((i=new s.sbkCardTypeData).type=e),i},S.checkRed=function(t,e){return-1<t.cardIdArr.indexOf(e.id)?0:0<u.RoleCenter.instans.vo.bagdata.getItemCount(e.itemId)?1:0},S}(ui.skill.Page.GameHandBookPageUI);e.GHandBookView=y}),define("src/g/skill/ctrl/GHandBookCtrl",["require","exports","src/g/skill/view/GHandBookView","../../../manager/GameSocketManager","../../net/messages/sbkCardMsg","../../../meta/CardVo","../../../manager/RoleCenter","../../net/messages/sbkCardData","../../../utils/ItemUtils","../../../utils/system/FloatEffect","../../../core/E","../../../enum/EventName","../../../plugin/sbkPropTool","src/g/clearRes/ClearResM","../../../meta/CardSuitVo","src/g/base/BaseCtrl","../../../enum/BagItemType"],function(t,e,g,n,s,v,f,y,c,o,m,_,C,u,I,i,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(i){function t(){var t=i.call(this)||this;t.url="res/atlas/res/skill/handbook.json";var e=n.GSM.ins;return e.on(s.CardActivateMsg.KEY,t,t.onCardActivateMsg),e.on(s.CardLvGroupUpMsg.KEY,t,t.onCardLvGroupUpMsg),e.on(s.CardResolveMsg.KEY,t,t.onCardResolveMsg),m.E.ins.on(_.EventName.CHANGECURRENCY,t,t.onChangeCurry),t.card=f.RoleCenter.instans.vo.cardData,m.E.ins.on(_.EventName.USECARD,t,t.useItem),t}return __extends(t,i),t.prototype.useItem=function(t){var e,i=t.id,n=0;t.type==a.BagItemType.tujian&&(v.CardStruct.Ins.getCardVoByItemId(i)&&(n=i,e=t));this.cardId=n,this.cardData=e},t.prototype.onChangeCurry=function(t){"CARDCHIP"==t&&this._view&&this.refreshData()},t.prototype.onCardActivateMsg=function(t){var e=v.CardStruct.Ins.getCardVoById(t.cardId),i=f.RoleCenter.instans.vo;if(e){var n=this.card.typeArr,s=g.GHandBookView.getTypeData(n,e.type);if(-1==n.indexOf(s)&&n.push(s),-1==s.cardIdArr.indexOf(e.id)){s.cardIdArr.push(e.id),s.cardLvArr.push(0);for(var o=e.team,a=null,r=s.teamArr,l=0;l<r.length;l++)if(r[l].teamId==o){a=r[l];break}a||((a=new y.sbkCardTeamData).teamId=o,r.push(a));var h=a.count;h++;var c=I.CardSuitStruct.Ins.getVoXtType(o);for(l=c.length-1;0<=l;l--){var u=c[l];if(h>=u.count){a.lv=u.level;break}}a.count=h}m.E.ins.event(_.EventName.CHANGECURRENCY,"CARDCHIP"),i.chgItemCount(e.itemId,-1),this._view&&this._view.refreshPageByAchivate();var p=i.combat;C.sbkPropTool.init4HandCard();var d=i.reCheckComBat();p<d&&f.RoleCenter.instans.event(_.EventName.FIGHT_UP,d-p),m.E.ins.event(_.EventName.CardAchivate,[e,0,!0])}else console.error("[error]: not find id byCardVo, id is "+t.cardId)},t.prototype.onCardLvGroupUpMsg=function(t){for(var e=f.RoleCenter.instans.vo,i=v.CardStruct.Ins.getCardVoById(t.cardId),n=null,s=0;s<this.card.typeArr.length;s++)if(this.card.typeArr[s].type==i.type){n=this.card.typeArr[s];break}if(null!=n){var o=n.cardIdArr.indexOf(i.id);-1==o&&console.error("[error]: onCardLvGroupUpMsg not find card by "+i.id);var a=v.CardStruct.Ins.getCardLevelVo(t.cardId,n.cardLvArr[o]);n.cardLvArr[o]=t.cardLv,e.CARDCHIP-=a.cost,this._view&&this._view.refreshPage();var r=e.combat;C.sbkPropTool.init4HandCard();var l=e.reCheckComBat();r<l&&f.RoleCenter.instans.event(_.EventName.FIGHT_UP,l-r),m.E.ins.event(_.EventName.CardUpLv,[i,t.cardLv,!0])}else console.error("[error]: onCardLvGroupUpMsg not find type by "+i.type)},t.prototype.onCardResolveMsg=function(t){var e=f.RoleCenter.instans.vo;e.chgItemCount(t.cardItemId,-t.count);var i=v.CardStruct.Ins.getCardVoByItemId(t.cardItemId),n=c.ItemUtils.getCurrencyVoByDefine("CARDCHIP");e.CARDCHIP+=i.value*t.count,o.FE.getFloat(n.name+"x"+i.value*t.count,c.ItemUtils.getColorByQuality(n.quality)),this._view&&this._view.refreshPage(),m.E.ins.event(_.EventName.CardReslove)},t.prototype.init=function(){return this._view||(this._view=new g.GHandBookView,this._view.on(Laya.Event.REMOVED,this,this.onRemoved)),this},t.prototype.onRemoved=function(){this._view&&(this._view.removeSelf(),this._view=null)},t.prototype.showPage=function(t,e){(this.parent=t).removeChildren(),this.open()},t.prototype.onAtlasLoaded=function(){if(!(0<this.parent.numChildren)){for(var t=[],e=f.RoleCenter.instans.vo.cardData.typeArr,i=0;i<e.length;i++)for(var n=e[i],s=0;s<n.cardIdArr.length;s++){var o=n.cardIdArr[s];t.push(v.CardStruct.Ins.getCardVoById(o).imgLight)}var a=f.RoleCenter.instans.vo.bagdata.itemId.slice();a.sort(function(t,e){if(t<=3089&&3001<=t&&e<=3089&&3001<=e){var i=v.CardStruct.Ins.getCardVoByItemId(t)?v.CardStruct.Ins.getCardVoByItemId(t).quality:0;return(v.CardStruct.Ins.getCardVoByItemId(e)?v.CardStruct.Ins.getCardVoByItemId(e).quality:0)-i}return-1});for(i=0;i<a.length;i++){var r=a[i];if(r<=3089&&3001<=r&&!this.cardId&&-1==t.indexOf(r)){this.cardId=r,this.cardData=c.ItemUtils.getItemVoById(r);break}}this.init(),this.refreshData(),this.parent.addChild(this._view);var l=this._view;if(l){u.ClearResM.resetViewImg(l);var h=l.item_box;for(i=0;i<h.numChildren;i++){h.getChildAt(i).cardList.refresh()}this.cardId&&-1==t.indexOf(this.cardId)&&(l.setSelectedById(this.cardId,this.cardData),this.refreshData(),this.cardId=0)}}},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){this._view&&this._view.refreshData()},t.prototype.getTitle=function(){return"res/skill/wenzi_tujian.png"},t.prototype.hidePage=function(){},t.prototype.destroyPage=function(){},t}(i.BaseCtrl);e.GHandBookCtrl=r}),define("src/g/role/view/MeridianPage",["require","exports","../../net/messages/JingmaiStageC2GS","../../../manager/GameSocketManager","../../net/messages/JingmaiLvC2GS","../../net/messages/PropFightMain","../../../config/GameConfig","../../../manager/RoleCenter","../../../utils/ItemUtils","src/g/Effects/UIEffectsFactory","../../net/messages/sbkFormula","src/g/itemGets/View/ItemGetDlg","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/init/TextConst","src/g/clearRes/ClearResM"],function(t,e,p,d,g,I,b,n,w,s,S,o,a,r,E,T){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t._nowSelectHero=0,t.jSet=b.GameConfig.JingMaiConfig,t.MsgLvUp=!1,t.needOk=!1,t.msgSendTime=0,t.isAutoRunning=!1,t._url_bg="res/bg/juese-jingmai-renwu.jpg",t._url_bg2="res/bg/jingmaibeijingtu_002.jpg",t.needItem=0,t.btn_up.on(Laya.Event.CLICK,t,t.onBtnClicked),t.btn_autoUp.on(Laya.Event.CLICK,t,t.onAutoClicked),t.on(Laya.Event.REMOVED,t,t.onRemoved);for(var e=1;e<=4;e++){t["jn"+e].on(Laya.Event.CLICK,t,t.skillIconClick)}return t.onLoadUIEF(),t}return __extends(t,i),t.prototype.skillIconClick=function(t){var e=t.currentTarget,i=b.GameConfig.skillOpen,n=this._hvo.jingmaiStage,s=[],o=0;for(var a in i){var r=a.split("_");if(3==+r[0]&&(n<+r[1]&&o++,s.push([r[1],a]),2<=o))break}for(var l=s.length-1,h=3;0<=h;h--){var c=s[l];if(this["jn"+(h+1)]==e){var u=new ui.lottery.ShenyuSkillDlgUI,p=w.ItemUtils.getSkillDefItem(i[c[1]].skillId);u.lab_desc.style.font="SimHei",u.lab_desc.style.align="left",u.lab_desc.style.color="#a89e8f",u.lab_desc.style.stroke=1,u.lab_desc.style.fontSize=20,u.lab_desc.style.wordWrap=!0,u.lab_desc.style.strokeColor="#060606",u.lab_open.text=n>=+c[0]?E.TextConst.get(524):E.TextConst.get(485),u.lab_desc.innerHTML=p.desc,u.lab_skillName.text=p.name,u.img_skillIcon.skin=w.ItemUtils.getSkillIconByIconId(p.icon),u.popup();break}l--}},t.prototype.onRemoved=function(){this.imgbg.skin=null,this.isAutoRunning=!1,this.btn_autoUp.label=E.TextConst.get(484),Laya.loader.clearRes(this._url_bg),Laya.loader.clearRes(this._url_bg2)},t.prototype.onLoadUIEF=function(){this.ani_put=s.UIEffectsFactory.Ins.createUIAniById(40,!0),s.UIEffectsFactory.Ins.centered4Parent(this.ani_put,this.btn_up,!0)},t.prototype.sendMsg=function(t,e,i){void 0===i&&(i=!1),t.curLv=e,d.GSM.sendServer(t),i&&(this.isQ=!1)},t.prototype.onBtnClicked=function(){if(this.MsgLvUp){if(!this.needOk)return void this.onShowGetDlg();if(this.isQ)return;var t=new g.JingmaiLvC2GS,e=this._hvo.jingmaiLv,i=this._hvo.jingmaiStage;t.heroidx=this._nowSelectHero;for(var n=void 0,s=0,o=e;o<e+8;o++){var a=this.isCanUp(e,i+1),r=w.ItemUtils.getMeridianLevelVoById(o),l=w.ItemUtils.getMeridianLevelVoById(o+1),h=r.cost;if(0==h.length)break;var c=h[0][1];if(isNaN(n)&&(n=this._uvo.bagdata.getItemCount(h[0][0])),n<c||a||!l)break;this.isQ=!0,c,n-=c;var u=l.cost;if(Laya.timer.once(130*s,this,this.sendMsg,[t,o,0==u.length||n<u[0][1]||this.isCanUp(o+1,i+1)],!1),0==u.length)break;s++}this.msgSendTime=Date.now()}else{(t=new p.JingmaiStageC2GS).curLv=this._hvo.jingmaiStage,t.heroidx=this._nowSelectHero,d.GSM.sendServer(t)}},t.prototype.isCanUp=function(t,e){return Math.floor(t/8)==e},t.prototype.checkAuto=function(){if(this.isAutoRunning)if(this.MsgLvUp&&this.needOk){this.btn_up.mouseEnabled=!1;var t=Date.now()-this.msgSendTime;300<=t?this.onBtnClicked():Laya.timer.once(300-t,this,this.onBtnClicked)}else this.isAutoRunning=!1,this.btn_autoUp.label=E.TextConst.get(484),this.btn_up.mouseEnabled=!0,this.needOk||this.onShowGetDlg()},t.prototype.onAutoClicked=function(){if(this.isAutoRunning)this.isAutoRunning=!1,this.btn_up.mouseEnabled=!0,this.btn_autoUp.label=E.TextConst.get(484);else{if(!n.RoleCenter.instans.vo.isSuperMonthCard)return void a.FE.upItems(E.TextConst.get(842),r.BubbleEnum.center);this.isAutoRunning=!0,this.btn_up.mouseEnabled=!1,this.btn_autoUp.label=E.TextConst.get(734)}this.checkAuto()},t.prototype.onShowGetDlg=function(){var t=new o.ItemGetDlg;t.initByVo(w.ItemUtils.getItemVoById(this.needItem)),t.popup()},t.prototype.refreshData=function(t){this._nowSelectHero!=t&&(this.isAutoRunning=!1,this.btn_autoUp.label=E.TextConst.get(484),this.btn_up.mouseEnabled=!0,this.isQ=!1,Laya.timer.clear(this,this.sendMsg)),this._nowSelectHero=t,this._uvo=n.RoleCenter.instans.vo,this._hvo=this._uvo.getOpenHeroByIdx(t),this.showData()},t.prototype.showData=function(){this.setNeed(),this.setBtnShow(),this.setAni(),this.setAttr(),this.imgbg.skin=this._url_bg,this.imgbg2.skin=this._url_bg2},t.prototype.playUpAni=function(){s.UIEffectsFactory.Ins.playAniOnce(11,this.aniSp)},t.prototype.setAttr=function(){for(var t,e=this._hvo.jingmaiStage,i=w.ItemUtils.getMeridianLevelVoById(this._hvo.jingmaiLv),n=w.ItemUtils.getMeridianStageVoById(e),s=w.ItemUtils.getMeridianLevelVoById(this._hvo.jingmaiLv+1),o=w.ItemUtils.getMeridianStageVoById(e+1),a=new I.PropFightMain,r=0;r<4;r++)if(i.prop[r]||n.prop[r]){var l=w.ItemUtils.getShuXingByName(n.prop[r][0]).desc;this["lab_now_"+r].text=l+":"+(i.prop[r]?i.prop[r][1]+(n.prop[r][1]||0):0+n.prop[r][1]),a[n.prop[r][0]]=i.prop[r]?i.prop[r][1]:0+n.prop[r][1],this["lab_now_"+r].visible=!0}else this["lab_now_"+r].visible=!1;t=this._hvo.jingmaiLv/8>>0==e?n:(e==this.jSet.maxStage||(s=i),o||n);for(r=0;r<4;r++)if(null!=s&&0!=s.cost.length||null!=o)if(s.prop[r]||t.prop[r]){l=w.ItemUtils.getShuXingByName(t.prop[r][0]).desc;this["lab_next_"+r].text=l+":"+(s.prop[r]?s.prop[r][1]+t.prop[r][1]:0+t.prop[r][1]),this["lab_next_"+r].visible=!0}else this["lab_next_"+r].visible=!1;else i.prop[r]||t.prop[r]?(this["lab_next_"+r].text=E.TextConst.get(208),this["lab_next_"+r].visible=!0):this["lab_next_"+r].visible=!1;this.fightNum.setFightNum(S.sbkFormula.calPropFightMainCombat(a)),this.view_stage.num.value=e+"";var h=b.GameConfig.skillOpen,c=[],u=0;for(var p in h){var d=p.split("_");if(3==+d[0]&&(e<+d[1]&&u++,c.push([d[1],p]),2<=u))break}var g=c.length-1;for(r=3;0<=r;r--){var v=c[g],f=r+1,y=this["jn"+f],m=this["jni"+f],_=!1;if(v){var C=E.TextConst.get(524);e>=+v[0]?y.disabled=!1:(y.disabled=!0,y.mouseEnabled=!0,C=E.TextConst.get(15,E.TextConst.get(7,v[0]))),y.skin=w.ItemUtils.getSkillIconByIconId(h[v[1]].skillId),T.ClearResM.resetViewImg(y),this["jnl"+f].text=C,_=!0}m.visible=_,g--}},t.prototype.setAni=function(){Math.floor(this._hvo.jingmaiLv/this.jSet.starperlevel);for(var t,e=this._hvo.jingmaiLv-this._hvo.jingmaiStage*this.jSet.starperlevel,i=0;i<this.jSet.starperlevel;i++){if(t=this.getChildByName("item_"+i),i<e){if(t.skin="",t.visible=!0,null==t.getChildByName("ani1"))t.removeChildren(),s.UIEffectsFactory.Ins.createAndCenter(t,4,!0).name="ani1"}else if(i==e){if(t.visible=!0,null==t.getChildByName("ani2"))t.removeChildren(),s.UIEffectsFactory.Ins.createAndCenter(t,5,!0).name="ani2",t.skin=""}else t.removeChildren(),t.visible=!1}},t.prototype.setBtnShow=function(){var t=this.jSet.maxLevel<=this._hvo.jingmaiLv&&this.jSet.maxStage<=this._hvo.jingmaiStage;if(this.btn_up.visible=!t,this.item_cost.visible=!t,!t){var e=Math.floor(this._hvo.jingmaiLv/8)==this._hvo.jingmaiStage+1;this.item_cost.visible=e?(this.MsgLvUp=!1,this.btn_up.label=E.TextConst.get(514),!(this.ani_put.visible=!0)):(this.MsgLvUp=!0,this.needOk?this.btn_up.label=E.TextConst.get(735):this.btn_up.label=E.TextConst.get(481),!0)}},t.prototype.setNeed=function(){var t=w.ItemUtils.getMeridianLevelVoById(this._hvo.jingmaiLv);t.cost.length<=0&&(t=w.ItemUtils.getMeridianLevelVoById(this._hvo.jingmaiLv-1));var e=parseInt(t.cost[0][0]),i=this._uvo.bagdata.getItemCount(e),n=t.cost[0][1],s=w.ItemUtils.getItemVoById(e);this.needItem=e,this.needOk=n<=i,this.item_cost.setNeed(i,n),this.item_cost.setNeedName(s.name,w.ItemUtils.getSmallIcon(s.icon)),this.item_cost.setJump(E.TextConst.get(481),new Laya.Handler(this,this.onShowGet)),this.item_cost.setQualColor(w.ItemUtils.getColorByQuality(s.quality)),this.ani_put.visible=n<=i},t.prototype.onShowGet=function(){var t=w.ItemUtils.getItemVoById(this.needItem);(new o.ItemGetDlg).initByVo(t,null).popup()},t.prototype.getTitle=function(){return"res/role/jingmaititle.png"},t}(ui.role.Meridian.MeridianViewUI);e.MeridianPage=i}),define("src/g/role/ctrl/MeridianPageCtrl",["require","exports","../../net/messages/OpResultType","src/g/role/view/MeridianPage","../../../manager/RoleCenter","../../../enum/EventName","../../../utils/ItemUtils","../../../plugin/sbkPropTool","../../../core/E","../../../vo/RedDot/EventRedDot","src/init/ResManager"],function(t,e,i,n,a,r,l,h,o,s,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){this._nowSelectHero=0,o.E.ins.on(r.EventName.CHANGEITEM_COUNT,this,this.onItemChange)}return t.prototype.init=function(){return this._view||(this._view=new n.MeridianPage),this.addEvent(),this},t.prototype.addEvent=function(){a.RoleCenter.instans.on(i.enumOpResultType.JingmaiLv+"",this,this.onJingMaiLv),a.RoleCenter.instans.on(i.enumOpResultType.JingmaiStage+"",this,this.onJingMaiStage),o.E.ins.on(s.EventRedDot.REFRESH_JINGMAI,this,this.refreshData)},t.prototype.onItemChange=function(t){105==t&&this._view&&this.refreshData()},t.prototype.onJingMaiLv=function(t){var e=a.RoleCenter.instans.vo,i=e.getOpenHeroByIdx(t.reservedata[0]),n=t.reservedata[2],s=i.jingmaiLv;i.jingmaiLv=t.reservedata[1];var o=l.ItemUtils.getMeridianLevelVoById(s);h.sbkPropTool.resetjingMaiLv(i),i.combat=i.reCheckComBat(),e.combat=e.reCheckComBat(),a.RoleCenter.instans.vo.chgItemCount(o.cost[0][0],-o.cost[0][1]),a.RoleCenter.instans.event(r.EventName.FIGHT_UP,n),this._view&&this._view.playUpAni(),this._view.displayedInStage&&(this.refreshData(),Laya.timer.frameOnce(2,this._view,this._view.checkAuto))},t.prototype.onJingMaiStage=function(t){var e=a.RoleCenter.instans.vo,i=e.getOpenHeroByIdx(t.reservedata[0]),n=e.combat;i.jingmaiStage=t.reservedata[1],h.sbkPropTool.resetjingMaiStage(i),h.sbkPropTool.reSetSkill();var s=e.reCheckComBat();a.RoleCenter.instans.event(r.EventName.FIGHT_UP,s-n),this._view&&this._view.playUpAni(),this._view.displayedInStage&&this.refreshData(),o.E.ins.event(r.EventName.CHANGEITEM_COUNT,[105])},t.prototype.showPage=function(t){this._parent=t,this._view||this.init(),this._parent.removeChildren(),this.refreshData(),this._parent.addChild(this._view),this._view.imgbg.restskin(),this._view.imgbg2.restskin(),c.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t){this._nowSelectHero=t,this.refreshData()},t.prototype.refreshData=function(){null!=this._view&&this._view.refreshData(this._nowSelectHero)},t.prototype.getTitle=function(){return"res/role/jingmaititle.png"},t.prototype.hidePage=function(){c.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){c.ResManager.getInstance().destroyPageCtrl(this)},t}();e.MeridianPageCtrl=u}),define("src/g/skill/ctrl/SkillViewCtrl",["require","exports","src/g/skill/ctrl/PassiveCompoundCtrl","src/g/skill/ctrl/LeanPassiveCtrl","src/g/skill/ctrl/DismantlePassiveDlgCtrl","src/g/skill/ctrl/PassivePageCtrl","src/g/skill/ctrl/SkillPageCtrl","../../../manager/RoleCenter","src/g/skill/view/SkillView","../../../enum/EventName","../../../core/E","src/g/skill/ctrl/PassiveHandBookCtrl","../../../manager/RuledescManager","../../../vo/RedDot/role/RedDot_Skill","../../../vo/RedDot/EventRedDot","src/g/skill/ctrl/GHandBookCtrl","src/g/role/ctrl/MeridianPageCtrl","../../../config/GameConfig","../../../vo/RedDot/RedDot_Role","src/init/Switches","src/g/accessctrl/AccessCenter","src/g/proxy/MultiLevelUIProxy","../../../utils/UIUtils","../../../manager/GuideCenter","../../../enum/GuideTargetName"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var E=function(){function t(){this._nowSelectHero=0,this._page=null;var t=_.Switches.ins;t.on(27,this,this.onOpenHandler,[27]),t.on(32,this,this.onOpenHandler,[32]),t.on(33,this,this.onOpenHandler,[33]),t.on(34,this,this.onOpenHandler,[34]),t.on(35,this,this.onOpenHandler,[35]);var e=c.E.ins;e.on(h.EventName.OPENNEW_HERO,this,this.openNewHero),e.on(h.EventName.VIP_EXP_CHANGED,this,this.vipChange),e.on(h.EventName.ADDED_MONEY,this,this.onChangeCurrency),e.on(h.EventName.ADDED_ZHUANSHENG,this,this.onChangeCurrency),e.on(g.EventRedDot.REFRESH_SKILL,this,this.refreshRedHead),e.on(h.EventName.CHANGECURRENCY,this,this.onChangeCurrencyByName),e.on(h.EventName.CHANGEITEM_COUNT,this,this.onChangeItemCount)}return t.prototype.onOpenHandler=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1),e&&(27==t?C.AccessCenter.ins.checkOpen(32)?this.openSkillView(32,i,n):C.AccessCenter.ins.checkOpen(33)?this.openSkillView(33,i,n):C.AccessCenter.ins.checkOpen(34)?this.openSkillView(34,i,n):C.AccessCenter.ins.checkOpen(35)&&this.openSkillView(35,i,n):this.openSkillView(t,i,n))},t.prototype.onChangeCurrency=function(){this.refreshData("MONEY")},t.prototype.onChangeCurrencyByName=function(t){"CARDCHIP"==t&&this.refreshData("CARDCHIP")},t.prototype.onChangeItemCount=function(t){var e=t-240;e<=16&&0<=e?c.E.ins.event(h.EventName.CHANGECURRENCY,"PASSIVE"):(t>=y.GameConfig.commonJson.card_begin.value&&t<=y.GameConfig.commonJson.card_end.value||238==t||239==t)&&c.E.ins.event(h.EventName.CHANGECURRENCY,"CARDCHIP")},t.prototype.vipChange=function(){var t=r.RoleCenter.instans.vo,e=t.VIP;if(0<e)for(var i=0;i<t.heronum;i++)for(var n=t.getOpenHeroByIdx(i),s=0;s<e;s++)null==n.passive.idArr[s]&&n.passive.idArr.push(0);this._passive&&(this._passive.vipchange(),c.E.ins.event(h.EventName.CHANGECURRENCY,"PASSIVE"))},t.prototype.refreshRedHead=function(){if(this._view)switch(this._view.tab_head.visible=!0,this._view.tab_skill_xubfa.selectedIndex){case 0:this._view.tab_head.refreshHeadRedHint(d.RedDot_Skill.Ins.getSkill(!0));break;case 3:this._view.tab_head.refreshHeadRedHint(d.RedDot_Skill.Ins.getPassive(!0));break;case 2:this._view.tab_head.visible=!1;break;case 1:this._view.tab_head.refreshHeadRedHint(m.RedDot_Role.Ins.getRed_jingmai())}},t.prototype.refreshData=function(t){if(void 0===t&&(t=""),this._view)switch(this._view.tab_head.visible=!0,this._view.tab_skill_xubfa.selectedIndex){case 0:this._skill&&"MONEY"==t&&this._skill.refreshData();break;case 3:this._passive&&this._passive.refreshData();break;case 2:this._handBook&&"CARDCHIP"==t&&this._handBook.refreshData();break;case 1:this._meridian&&this._meridian.refreshData()}this.refreshRedHead()},t.prototype.openNewHero=function(){this.refreshData()},t.prototype.onClick=function(t){p.RuledescManager.showRuledesc(t)},t.prototype.tab_selectHandler=function(t){0==t?(this._view.bjView.btn_help.visible=!1,this._page=this._skill):3==t?(this._view.bjView.btn_help.visible=!0,this._view.bjView.btn_help.on(Laya.Event.CLICK,this,this.onClick,[9]),this._page=this._passive):2==t?(this._view.bjView.btn_help.visible=!1,this._page=this._handBook):1==t&&(this._page=this._meridian),this._page&&this._page.showPage(this._view.bjView.box_page),this.refreshData(),this._view.bjView.img_title.skin=this._page.getTitle()},t.prototype.initview=function(){this._view=new l.SkillView,this._passive=new o.PassivePageCtrl,this._skill=new a.SkillPageCtrl,this._handBook=new v.GHandBookCtrl,this._meridian=new f.MeridianPageCtrl,new u.PassiveHandBookCtrl,new s.DismantlePassiveCtrl,new n.LeanPassiveCtrl,new i.PassiveCompondCtrl,this._view.tab_head.initData(r.RoleCenter.instans.self.openhero,0,r.RoleCenter.instans.vo),this.addEvent()},t.prototype.HeroSelect=function(t,e){r.RoleCenter.instans.self.openhero[t]?(this._nowSelectHero=t,this._view.tab_head.setSelectIndex(t),this._page&&(this._skill.changePerson(t),this._meridian.changePerson(t),this._passive.changePerson(t),this._handBook.changePerson(t))):_.Switches.ins.event(15)},t.prototype.refreshHeroHeadShow=function(t){void 0===t&&(t=0),this._view.tab_head.initData(r.RoleCenter.instans.self.openhero,this._nowSelectHero,r.RoleCenter.instans.vo),this.refreshData()},t.prototype.addEvent=function(){this._view.bjView.btn_close.on(Laya.Event.CLICK,this,this.closeSkillView),this._view.bjView.btn_back.on(Laya.Event.CLICK,this,this.closeSkillView),this._tabProxy=new I.MultiLevelUIProxy,this._tabProxy.registerTab(this._view.tab_skill_xubfa,0),this._tabProxy.registerTagIndex(32,0),this._tabProxy.registerTagIndex(35,1),this._tabProxy.registerTagIndex(33,3),this._tabProxy.registerTagIndex(34,2),this._tabProxy.selectHandler=new Laya.Handler(this,this.tab_selectHandler),this._view.tab_head.setCallbackHandler(new Laya.Handler(this,this.HeroSelect)),c.E.ins.on(h.EventName.OPENNEW_HERO,this,this.refreshHeroHeadShow),r.RoleCenter.instans.vo.heronum<3&&(c.E.ins.on(h.EventName.ADDED_LEVEL,this,this.refreshHeroHeadShow),c.E.ins.on(h.EventName.ADDED_ZHUANSHENG,this,this.refreshHeroHeadShow),c.E.ins.on(h.EventName.VIP_EXP_CHANGED,this,this.refreshHeroHeadShow))},t.prototype.openSkillView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._view||this.initview(),this._tabProxy.open(t),Laya.loader.load(["res/atlas/res/skill.json","res/atlas/res/role.json"],new Laya.Handler(this,function(){this._view.showView(e,i),this._isRegist||this.registUIToGuide()}),null,Laya.Loader.ATLAS)},t.prototype.registUIToGuide=function(){var t=b.UIUtils.getGlobalBound(this._view.bjView.btn_back);t&&(this._isRegist=!0,w.GuideCenter.ins.registerInteractionArea(S.GuideTargetName.SKILL_BTN_BACK,t),w.GuideCenter.ins.registerGuideObject(S.GuideTargetName.SKILL_BTN_BACK,this._view))},t.prototype.closeSkillView=function(){this._view.hideView()},t}();e.SkillViewCtrl=E}),define("src/g/bag/view/BagItemRecoverView",["require","exports","../../../enum/enumItem","src/g/role/ctrl/EquipPageCtrl","src/g/Effects/UIEffectsFactory","../../../manager/GameSocketManager","../../net/messages/EquipSplitC2GS","../../../manager/RoleCenter","src/g/bag/vo/BagDataVo","../../../utils/ItemUtils","../../../enum/EventName"],function(t,e,r,l,h,s,o,a,c,u,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.titleUrl="res/title/wenzi_huishouzhuangbei.png",t.willDelArr=[],t}return __extends(t,e),t.prototype.init=function(){this.bjView.btn_close.on(Laya.Event.CLICK,this,this.destroyView),this.bjView.btn_back.on(Laya.Event.CLICK,this,this.destroyView),this.bjView.img_title.skin=this.titleUrl,this.list_.renderHandler=new Laya.Handler(this,this.onListRender),this.showMax=this.list_.repeatX*this.list_.repeatY},t.prototype.showView=function(t){void 0===t&&(t=!0),this.initBagData(),this.initList(),this.zOrder=9999999,this.popup()},t.prototype.showViewByChooseItem=function(t){this.willDelArr=t,this.list_.dataSource=this.willDelArr,this.zOrder=9999999,this.popup()},t.prototype.hideView=function(){for(var t=0;t<this.list_.cells.length;t++){this.list_.cells[t].getChildByName("ani_par").removeChildren()}this.close(),this.event(i.EventName.VIEWREMOVED)},t.prototype.destroyView=function(){this.willDelArr.length=0,this.hideView()},t.prototype.onListRender=function(t,e){var i=t.getChildByName("img_jia"),n=t.getChildByName("lab_Lv"),s=t.getChildByName("item0"),o=t.getChildByName("ani_par"),a=t.dataSource;if(a){var r=a.id;if(i.visible=!1,!o.getChildByName("ani"))h.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(o,33,1,1,"ani",!1,100).visible=!1;n.text=u.ItemUtils.getLv(a.equVo.limit),n.color=u.ItemUtils.getQualityColorById(a.equVo.id),s.img_occupation.skin=u.ItemUtils.getOccupationIconById(r),s.item.img_item.skin=u.ItemUtils.getIconById(r),s.item.img_quality.skin=u.ItemUtils.getQualityBjById(r)}else i.visible=!0,s.img_occupation.skin="",s.item.img_item.skin="",n.text="",s.item.img_quality.skin=u.ItemUtils.getQualityForGayUrl();s.item.lab_num.visible=!1},t.prototype.initList=function(t){void 0===t&&(t=!1);var e=this.list_;if(t){for(var i,n=e.cells,s=function(t){var e=n[t].getChildByName("ani_par").getChildByName("ani");i=n[t].getChildByName("img_jia"),e&&!i.visible&&(e.visible=!0,e.play(0,!1,"ani",!1,t<1),e.on(Laya.Event.COMPLETE,o,function(){e.stop(),e.visible=!1}))},o=this,a=0;a<n.length;a++)s(a);e.dataSource=this.getArrInData()}else e.dataSource=this.getArrInData()},t.prototype.getArrInData=function(){var t=l.EquipPageCtrl.canPutArr;this.willDelArr=[];var e=0,i=0;for(e=0;e<this.arr_equip.length;e++){var n=this.arr_equip[e];if(n){var s=i;if(n.equVo.quality>=r.enumItem.orange){i++;continue}for(var o=0;o<=8;o++)for(var a=0;a<3;a++)if(t[a]&&t[a][o]&&t[a][o].equid==n.equid){i++;break}s==i&&this.willDelArr.push(n)}else i++;if(this.willDelArr.length>=this.showMax)break}for(e=0;e<this.showMax&&this.willDelArr.length<this.showMax;e++)this.willDelArr.push(null);return this.willDelArr},t.prototype.removeWillDelItem=function(t){var e=this.willDelArr.indexOf(t);-1!=e?(this.willDelArr[e]=void 0,this.list_.dataSource=this.willDelArr):console.error("BagItemRecoverView.removeWillDelItem is error.  this.willDelArr ("+this.willDelArr+")中 没有找到 item ("+t+")")},t.prototype.initBagData=function(){var t=a.RoleCenter.instans.self.bagdata;this.arr_equip=[],this.arr_item=[];for(var e=0;e<t.equBagData.length;e++){var i=u.ItemUtils.getEquipVoById(t.equBagData[e].equtemplet),n=new c.BagDataVo;i&&i.id&&(n.equid=t.equBagData[e].equid,n.id=i.id,n.num=1,n.equVo=i,this.arr_equip.push(n))}for(e=0;e<t.itemId.length;e++){var s=u.ItemUtils.getItemVoById(t.itemId[e]);n=new c.BagDataVo;s&&s.id&&(n.id=s.id,n.num=t.itemNum[e],n.ItmVo=s,this.arr_item.push(n))}},t.prototype.removeData=function(){var t=this.willDelArr,e=t.length,i=new o.EquipSplitC2GS;i.splittype=o.ESplitType.commonEquip;for(var n=0;n<e;n++)t[n]&&i.equipidarr.push(t[n].equid);i.equipidarr.length<=0||s.GSM.sendServer(i)},t}(ui.bag.BagItemRecoverUI);e.BagItemRecoverView=n}),define("src/g/bag/view/BagChooseItemView",["require","exports","../../../manager/RoleCenter","src/g/bag/vo/BagDataVo","../../../utils/ItemUtils","../../../enum/enumItem","src/init/TextConst"],function(t,e,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._selectNum=0,t._selectMax=0,t.titleUrl="res/title/wenzi_xuanzezhuangbei.png",t.chooseItems=[],t}return __extends(t,e),t.prototype.init=function(){this.bjView.img_title.skin=this.titleUrl,this.list_.vScrollBarSkin="",this.list_.scrollBar.elasticDistance=50,this.list_.renderHandler=new Laya.Handler(this,this.onListRender)},t.prototype.showView=function(){this.popup()},t.prototype.showView1=function(t){this.initBagData(),this.chooseItems=t,this.chkChoose(t),this.list_.scrollBar.value=0,this.list_.dataSource=this.arr_equip,this.showView()},t.prototype.hideView=function(){this.chooseItems=null,this.close()},t.prototype.destroyView=function(){this.hideView()},t.prototype.onListRender=function(t,e){var i=t.dataSource;t.lab_pingfen.text=h.TextConst.get(84,i.getEquipComBat()),t.img_gou.visible=i.isChoose;var n=i.id,s=i.num;t.item1.lab_lv.text=r.ItemUtils.getEquipLv(i.equVo.limit),t.item1.lab_lv.color=r.ItemUtils.getQualityColorById(n),t.item1.item0.img_occupation.skin=r.ItemUtils.getOccupationIconById(n),t.item1.item0.item.img_quality.skin=r.ItemUtils.getQualityBjById(n),t.item1.item0.item.img_item.skin=r.ItemUtils.getIconById(n);var o=t.item1.item0.lab_num;o.visible=1<s&&(o.text=s+"",!0)},t.prototype.chkChoose=function(t){for(var e=t.length,i=this.arr_equip,n=i.length,s=0,o=0;o<e;o++){var a=t[o];if(a){s++;for(var r=0;r<n;r++){var l=i[r];if(a.id==l.id){l.isChoose=!0;break}}}}this._selectMax=e,this._selectNum=s,this.refreshSelectNum()},t.prototype.refreshSelectNum=function(){this.lab_selectNum.text=this._selectNum+"/"+this._selectMax},t.prototype.onItemGouClick=function(t){var e=t.dataSource;e.isChoose=!e.isChoose;var i=e.isChoose;t.img_gou.visible=i;for(var n=this.chooseItems.length,s=-1,o=0;o<this.chooseItems.length;o++)if(null!=this.chooseItems[o]&&this.chooseItems[o].equid==e.equid){s=o;break}if(i){this._selectNum++;for(o=0;o<n;o++)if(null==this.chooseItems[o]){this.chooseItems[o]=e;break}}else this._selectNum--,this.chooseItems[s]=null;this.refreshSelectNum();var a=!0;for(o=0;o<n;o++)if(null==this.chooseItems[o]){a=!1;break}return a},t.prototype.initBagData=function(){var t=o.RoleCenter.instans.vo.bagdata;this.arr_equip=[],this.arr_item=[];for(var e=0;e<t.equBagData.length;e++){var i=r.ItemUtils.getEquipVoById(t.equBagData[e].equtemplet),n=new a.BagDataVo;i&&(i.quality>=l.enumItem.orange||(n.equid=t.equBagData[e].equid,n.id=i.id,n.num=1,n.equVo=i,this.arr_equip.push(n)))}for(e=0;e<t.itemId.length;e++){var s=r.ItemUtils.getItemVoById(t.itemId[e]);if(null!=s)(n=new a.BagDataVo).id=s.id,n.num=t.itemNum[e],n.ItmVo=s,this.arr_item.push(n)}},t}(ui.bag.BagChooseItemUI);e.BagChooseItemView=i;!function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.isChoose=!1,t}__extends(t,e)}(a.BagDataVo)}),define("src/g/bag/ctrl/BagChooseItemViewCtrl",["require","exports","../../../enum/EventName","../../../core/E","src/g/bag/view/BagChooseItemView"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){this.isAuto=!1}return t.prototype.init=function(){n.E.ins.on(i.EventName.OPENVIEW_BAGCHOOSEITEM,this,this.showView)},t.prototype.showView=function(t,e){void 0===e&&(e=!1),this._view||(this._view=new s.BagChooseItemView,this._view.init(),this.initViewEvent()),this.isAuto=e,this._view.showView1(t)},t.prototype.initViewEvent=function(){this._view.btn_ok.on(laya.events.Event.CLICK,this,this.onBtnOK),this._view.bjView.btn_back.on(laya.events.Event.CLICK,this,this.onBtnOK),this._view.bjView.btn_close.on(laya.events.Event.CLICK,this,this.onBtnOK),this._view.list_.mouseHandler=new Laya.Handler(this,this.onListMouseHandler)},t.prototype.onBtnOK=function(){this.isAuto?n.E.ins.event(i.EventName.OPENVIEW_BAGRECOVERALL,[this._view.chooseItems]):n.E.ins.event(i.EventName.OPENVIEW_BAGRECOVERBYCHOOSEITEM,[this._view.chooseItems]),this._view.hideView()},t.prototype.onListMouseHandler=function(t,e){t.type==laya.events.Event.CLICK&&this._view.onItemGouClick(t.target)&&this.onBtnOK()},t}();e.BagChooseItemViewCtrl=o}),define("src/g/bag/ctrl/BagItemRecoverViewCtrl",["require","exports","../../net/messages/sbkEquipIns","../../../utils/system/FloatEffect","../../../utils/ItemUtils","../../../manager/RoleCenter","../../../enum/EventName","../../../core/E","src/g/bag/view/BagItemRecoverView","src/g/bag/ctrl/BagChooseItemViewCtrl","src/init/Switches","../../../vo/ReXueUtil","../../../vo/sbkBagVo","../../../meta/CommonVo","src/init/TextConst","../../../config/GameConfig"],function(t,e,w,s,S,E,T,A,i,n,o,R,L,a,r,x){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){this.iconArr=[]}return t.prototype.init=function(){(new n.BagChooseItemViewCtrl).init(),this.uvo=E.RoleCenter.instans.vo,o.Switches.ins.on(71,this,function(){this.showView()}),A.E.ins.on(T.EventName.OPENVIEW_BAGRECOVERBYCHOOSEITEM,this,this.showViewByChooseItem),E.RoleCenter.instans.on(T.EventName.EQUIPSPLIT,this,this.onEquipSplit)},t.prototype.onEquipSplit=function(t,e){void 0===e&&(e=0),this.uvo=E.RoleCenter.instans.vo;var i=this.uvo.bagdata,n=this._view;if(0<e){null!=n&&n.displayedInStage&&((v=i.getEquip(e))&&this.uvo.delEquipIns(e),n.initBagData(),n.initList(),n.removeData())}else{var s=t.delEquipID;if(s&&0!=s.length){for(var o=0;o<s.length;o++){if((v=i.getEquip(s[o])).type==w.enumEquipType.rxEquip){var a=R.ReXueUtil.getEquipVoById(v.equtemplet);if(L.sbkBagVo.delEquipIns(v.equid),c=a.split)for(var r=0;r<c.length;r++){var l=c[r];this.uvo.chgItemCount(parseInt(l[0]),l[1]),this.splitCallBack(null,S.ItemUtils.getItemVoById(l[0]),0,l[1])}A.E.ins.event(T.EventName.RESLOVE_EQUIP_REXUE)}else if(v.type==w.enumEquipType.ssEquip){var h=x.GameConfig.SSEquip[v.equtemplet];E.RoleCenter.instans.vo.delEquipIns(v.equid);for(var c=h.split,u=0;u<c.length;u++){l=c[u];this.uvo.chgItemCount(parseInt(l[0]),l[1]),this.splitCallBack(null,S.ItemUtils.getItemVoById(l[0]),0,l[1])}}else if(v.type==w.enumEquipType.fsEquip){console.log("分解飞升装备");var p=x.GameConfig.fsequipjson[v.equtemplet];if(E.RoleCenter.instans.vo.delEquipIns(v.equid),c=p.split)for(var d=0;d<c.length;d++){l=c[d];this.uvo.chgItemCount(parseInt(l[0]),l[1]),this.splitCallBack(null,S.ItemUtils.getItemVoById(l[0]),0,l[1])}}}var g={};for(o=0;o<s.length;o++){var v;if(v=i.getEquip(s[o])){var f=S.ItemUtils.getEquipVoById(v.equtemplet);if(f){if(this.uvo.delEquipIns(s[o]),f.worth&&0!=f.worth.length){for(m=S.ItemUtils.getItemVoById(parseInt(f.worth[0][0])),_=0;_<f.worth.length;_++)this.popItem(f.worth[_][0],f.worth[_][1]);if(m){var y=0;for(I=f.worth.length;y<I;)0<parseInt(f.worth[y][0])&&this.uvo.chgItemCount(parseInt(f.worth[y][0]),f.worth[y][1]),y++}}else{for(var m=S.ItemUtils.getItemVoById(f.split[1][0]),_=0;_<f.split.length;_++)this.popItem(f.split[_][0],f.split[_][1]);if(m)for(var C=0,I=f.split.length;C<I;)0<parseInt(f.split[C][0])&&this.uvo.chgItemCount(parseInt(f.split[C][0]),f.split[C][1]),C++}this.iconArr.push(f.icon)}}}for(var _ in g){var b=S.ItemUtils.getCurrencyVoByDefine(_);m=S.ItemUtils.getItemVoById(_);this.splitCallBack(b,m,g[_],g[_])}this._view&&this._view.displayedInStage&&(this._view.initBagData(),this._view.initList(!0)),A.E.ins.event(T.EventName.EQUIPSPLITOVER)}else null!=n&&n.displayedInStage&&(n.initBagData(),n.initList())}},t.prototype.popItem=function(t,e){var i=S.ItemUtils.getCurrencyVoByDefine(t),n=S.ItemUtils.getItemVoById(t);this.splitCallBack(i,n,e,e)},t.prototype.splitCallBack=function(t,e,i,n){t&&s.FE.getUpFloat(t.name+"x"+i,t.define),e&&s.FE.getUpFloat(e.name+"x"+n,e.id)},t.prototype.showView=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!1),this._view||(this._view=new i.BagItemRecoverView,this._view.init(),this.initViewEvent()),this._view.btn_recover.label=r.TextConst.get(283),this._view.showView(e)},t.prototype.showViewByChooseItem=function(t){this._view||(this._view=new i.BagItemRecoverView,this._view.init(),this.initViewEvent()),this._view.btn_recover.label=r.TextConst.get(283),this._view.showViewByChooseItem(t)},t.prototype.onClearRes=function(){this.iconArr=[]},t.prototype.initViewEvent=function(){var t=this._view;t.btn_recover.delay=a.CommonVo.getVoByKey("anzhuTimeInterval").val2num,t.btn_recover.handler=new Laya.Handler(this,this.onReslove),t.on(T.EventName.VIEWREMOVED,this,this.onClearRes),t.list_.mouseHandler=new Laya.Handler(this,this.onListMouseHandler)},t.prototype.onReslove=function(){return this._view.removeData(),this._view.initList(),!0},t.prototype.onListMouseHandler=function(t,e){var i=this._view;if(t.type==laya.events.Event.CLICK)if(i.list_.selectedItem)i.removeWillDelItem(i.list_.selectedItem);else{var n=[];n.push(i.willDelArr),A.E.ins.event(T.EventName.OPENVIEW_BAGCHOOSEITEM,n),i.hideView()}},t}();e.BagItemRecoverViewCtrl=l}),define("src/g/bag/view/BagView",["require","exports","../../net/messages/OpResultType","src/g/bag/vo/BagDataVo","../../../manager/RoleCenter","../../../utils/ItemUtils","src/g/bag/tips/view/ItemTips","../../../core/E","../../../enum/EventName","../../../meta/ZhanWenVo","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/g/Effects/UIEffectsFactory","../../../utils/system/ServerTime","../../../enum/BagItemType","../../net/messages/sbkEquipIns","../../../config/GameConfig","src/init/TextConst","../../../vo/ReXueUtil"],function(t,e,i,L,x,P,s,o,a,k,n,r,_,D,H,M,G,l,B){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.p_nowSelect=0,t.arr_equip=[],t.arr_item=[],t.arr_zhanwen=[],t}return __extends(t,e),t.prototype.init=function(){x.RoleCenter.instans.on(i.enumOpResultType.AddequBagCount+"",this,this.onAddequBagCount),this.list_.renderHandler=new Laya.Handler(this,this.onListRender),this.list_.mouseHandler=new Laya.Handler(this,this.onListeMouseHandler),this.list_.scrollBar.elasticDistance=200},t.prototype.refreshData=function(t){this.initBagData(),this.onTabSelectHandler(t)},t.prototype.onAddequBagCount=function(t){if(t.opresult){var e=x.RoleCenter.instans.vo,i=e.bagdata;i.equBagBoughtCount+=t.reservedata[0]-e.bagdata.equBagCount,n.FE.upItems(l.TextConst.get(96,t.reservedata[0]-e.bagdata.equBagCount),r.BubbleEnum.Left),i.equBagCount=t.reservedata[0],e.GOLD-=t.reservedata[1],o.E.ins.event(a.EventName.UPDATE_REDDOT,30),o.E.ins.event(a.EventName.UPDATE_BAG),this.capacityUpdata()}},t.prototype.initBagData=function(){var t=x.RoleCenter.instans.self.bagdata,e=this.arr_equip,i=this.arr_item,n=this.arr_zhanwen;e.splice(0,e.length),i.splice(0,i.length),n.splice(0,n.length);for(var s=t.equBagData,o=0;o<s.length;o++){var a=s[o],r=a.equtemplet,l=P.ItemUtils.getEquipVoById(r),h=P.ItemUtils.getSrEquipVoById(r),c=new L.BagDataVo;if(c.isInBag=!0,c.equid=a.equid,l&&l.id)c.type=M.enumEquipType.equip,c.id=l.id,c.num=1,c.equVo=l;else{var u=P.ItemUtils.getXwEquipVoById(r),p=G.GameConfig.SSEquip[r],d=B.ReXueUtil.getEquipVoById(r),g=P.ItemUtils.getWingEquipVoById(r),v=P.ItemUtils.getFsEquipVoById(r);if(g)c.isInBag=!1,c.type=M.enumEquipType.wingEquip,c.id=g.id,c.num=1,c.ewVo=g;else if(p)c.type=M.enumEquipType.ssEquip,c.id=p.id,c.ssVo=p;else if(d)c.type=M.enumEquipType.rxEquip,c.id=d.id,c.rexueVo=d;else if(u)c.type=M.enumEquipType.xwEquip,c.id=u.id,c.xwVo=u;else if(v)c.type=M.enumEquipType.fsEquip,c.id=v.id,c.fsEquipVo=v;else{if(!h)continue;c.type=M.enumEquipType.twoBlade,c.id=h.id,c.srEquipVo=h}}e.push(c)}for(var f,y,m=t.itemTimeArr.concat(),_=m.length,C=0;C<_;){if(f=m[C],y=m[C+1],(b=P.ItemUtils.getItemVoById(f)).type!=H.BagItemType.bxhybxzlb&&y>D.ServerTime.serverTime)(w=new L.BagDataVo).isInBag=!0,w.id=b.id,w.num=1,w.ItmVo=b,w.liveTime=y,i.push(w);C+=2}for(var I=0;I<t.itemId.length;I++){var b;if((b=P.ItemUtils.getItemVoById(t.itemId[I]))&&b.id){var w;if(b.type!=H.BagItemType.xhybqnlb&&b.type!=H.BagItemType.xhybxzlb&&b.type!=H.BagItemType.coupon)(w=new L.BagDataVo).isInBag=!0,w.id=b.id,w.num=t.itemNum[I],w.ItmVo=b,w.liveTime=-1,i.push(w)}}for(var S=t.zhanwenData,E=0;E<S.length;E++){var T=S[E],A=k.ZhanWenStruct.Ins.getZhanWenVo(T.quality,T.lv);if(A&&A.lv){var R=new L.BagDataVo;R.isInBag=!0,R.isZhanWen=!0,R.zwVo=A,R.zwId=t.zhanwenDic[E],R.ItmVo=P.ItemUtils.getItemVoById(T.cfgId),n.push(R)}}e.length,0<i.length&&(i.sort(function(t,e){return t.ItmVo.quality-e.ItmVo.quality}),i.sort(function(t,e){return e.ItmVo.red-t.ItmVo.red})),0<n.length&&n.sort(function(t,e){return t.zwVo.quality-e.zwVo.quality})},t.prototype.hideView=function(){},t.prototype.destroyView=function(){this.hideView()},t.prototype.capacityUpdata=function(){var t,e=x.RoleCenter.instans.self.bagdata.equBagCount;t=this.arr_equip.length,this.lab_capacity.text=t+"/"+e,this.lab_capacity.color=t==e?"#ff0f15":"#03bb00",o.E.ins.event(a.EventName.UPDATE_REDDOT,30)},t.prototype.onTabSelectHandler=function(t){this.p_nowSelect!=t&&(this.list_.scrollBar.value=0),0==(this.p_nowSelect=t)?(this.list_.dataSource=this.arr_equip,this.list_.height=653,this.capacityUpdata(),this.box_capacity.visible=!0):1==t?(this.list_.dataSource=this.arr_item,this.list_.height=653,this.box_capacity.visible=!1):2==t&&(this.list_.dataSource=this.arr_zhanwen,this.list_.height=653,this.box_capacity.visible=!1)},t.prototype.onListRender=function(t,e){var i,n=t.dataSource,s=n.ItmVo,o=0;s&&(o=s.streamer),i=n.isZhanWen?s.id:n.id;var a=n.num,r=t.item0.lab_num,l=t.lab_lv,h=t.item0.item.img_quality,c=t.item0.item.img_item,u=t.item0.effect_con,p=t.item0.item.img_fs_job;if(p.visible=!1,this.setStarSmall(t),0==this.p_nowSelect){if(u.removeChildren(),n.type==M.enumEquipType.wingEquip){var d=n.ewVo;return l.text=d.name,t.item0.img_occupation.visible=!1,l.color=P.ItemUtils.getColorByQuality(d.quality),h.skin=P.ItemUtils.getQualitybjByQualityId(d.quality),c.skin=P.ItemUtils.getIconByIconId(d.icon),void(r.visible=!1)}if(n.type==M.enumEquipType.rxEquip){var g=n.rexueVo;return l.text=g.name,t.item0.img_occupation.visible=!1,l.color=P.ItemUtils.getColorByQuality(g.quality),h.skin=P.ItemUtils.getQualitybjByQualityId(g.quality),c.skin=P.ItemUtils.getIconByIconId(g.icon),this.setStarSmall(t,g.id%10),void(r.visible=!1)}if(n.type==M.enumEquipType.xwEquip){var v=n.xwVo;return l.text=v.name,t.item0.img_occupation.visible=!1,l.color=P.ItemUtils.getColorByQuality(v.quality),h.skin=P.ItemUtils.getQualitybjByQualityId(v.quality),c.skin=P.ItemUtils.getIconByIconId(v.icon),void(r.visible=!1)}if(n.type==M.enumEquipType.ssEquip){var f=n.ssVo;return l.text=f.name,t.item0.img_occupation.visible=!1,l.color=P.ItemUtils.getColorByQuality(f.quality),h.skin=P.ItemUtils.getQualitybjByQualityId(f.quality),c.skin=P.ItemUtils.getIconByIconId(f.icon),void(r.visible=!1)}if(n.type==M.enumEquipType.fsEquip){var y=n.fsEquipVo;return l.text=y.name,t.item0.img_occupation.visible=!1,p.visible=!0,p.skin=P.ItemUtils.getfsJobIcon(n.fsEquipVo.job),l.color=P.ItemUtils.getColorByQuality(y.quality),h.skin=P.ItemUtils.getQualitybjByQualityId(y.quality),c.skin=P.ItemUtils.getIconByIconId(y.icon),void(r.visible=!1)}if(n.type==M.enumEquipType.twoBlade){var m=n.srEquipVo;return l.text=m.name,t.item0.img_occupation.visible=!1,l.color=P.ItemUtils.getColorByQuality(m.quality),h.skin=P.ItemUtils.getQualitybjByQualityId(m.quality),c.skin=P.ItemUtils.getIconByIconId(m.icon),void(r.visible=!1)}l.text=P.ItemUtils.getEquipLv(n.equVo.limit),t.item0.img_occupation.skin=P.ItemUtils.getOccupationIconById(i),t.item0.img_occupation.visible=!0}else if(1==this.p_nowSelect){if(l.text=s.name,t.item0.img_occupation.skin="res/custom/red_point.png",t.item0.img_occupation.visible=P.ItemUtils.getCanUseByItemId(i),0<o)u.getChildByName("ani_"+o)||(u.removeChildren(),_.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(u,o,1,1,"ani_"+o));else u.removeChildren()}else if(2==this.p_nowSelect){if(0<o)u.getChildByName("ani_"+o)||(u.removeChildren(),_.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.item0.effect_con,o,1,1,"ani_"+o));else u.removeChildren();l.text=s.name+" Lv."+n.zwVo.lv,t.item0.img_occupation.visible=!1}l.color=P.ItemUtils.getQualityColorById(i),h.skin=P.ItemUtils.getQualityBjById(i),c.skin=P.ItemUtils.getIconById(i),r.visible=1<a&&(r.text=a+"",!0)},t.prototype.setStarSmall=function(t,e){void 0===e&&(e=0);var i=t.hbox_star;i.removeChildren();for(var n=0;n<e;n++){var s=new Laya.Image("res/custom/rexue_xingxing.png");i.addChild(s)}i.width=18*e},t.prototype.onListeMouseHandler=function(t,e){if(t.type==laya.events.Event.CLICK){var i=this.list_.array[e];if(!i)return;var n=i.ItmVo;null!=n&&n.type==H.BagItemType.gonghuiHongbao?o.E.ins.event(a.EventName.USE_FAMILY__RED_PACKET,n):s.ItemTips.ins.showTips(this.list_.selectedItem)}},t}(ui.bag.BagUI);e.BagView=h}),define("src/g/bag/view/BagAddCapacityView",["require","exports","../../../config/GameConfig","../../../manager/RoleCenter","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/init/TextConst"],function(t,e,r,l,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.btn_jia.on(laya.events.Event.CLICK,this,this.onBtnClick,[1,5]),this.btn_jian.on(laya.events.Event.CLICK,this,this.onBtnClick,[0,5]),this.btn_jia10.on(laya.events.Event.CLICK,this,this.onBtnClick,[1,10]),this.btn_jian10.on(laya.events.Event.CLICK,this,this.onBtnClick,[0,10]),this.input_.on(laya.events.Event.CHANGE,this,this.onInputChg),this.input_.on(laya.events.Event.INPUT,this,this.onInputChg)},e.prototype.showView=function(){this.input_.text="5",0!=this.getHuaFei(5)?(this.onInputChg(),this.popup()):i.FE.upItems(s.TextConst.get(284),n.BubbleEnum.center)},e.prototype.hideView=function(){this.close("hideView")},e.prototype.destroyView=function(){this.close("destroyView")},e.prototype.onInputChg=function(){var t=parseInt(this.input_.text);t<=0&&(t=5);var e=this.getHuaFei(t);this.lab_xiaohao.text=e+""},e.prototype.onBtnClick=function(t,e){var i=parseInt(this.input_.text);0==t?i-=e:1==t&&(i+=e),i<=0&&(i=5);var n=l.RoleCenter.instans.self.bagdata,s=(n.equBagBoughtCount+i)/5,o=n.equBagBoughtCount/5;if(!r.GameConfig.BagCostJson[s]){for(var a=s;null==r.GameConfig.BagCostJson[a];)a--;i=5*(a-o)}this.input_.text=i+""},e.prototype.getHuaFei=function(t){if(0==t||t<5)return 0;for(var e=l.RoleCenter.instans.self.bagdata,i=e.equBagBoughtCount/5,n=(e.equBagBoughtCount+t)/5,s=0,o=i+1;o<=n;o++){var a=r.GameConfig.BagCostJson[o];if(null==a)return s=0;s+=a.cost[0][1]}return s},e}(ui.bag.BagAddCapacityUI);e.BagAddCapacityView=o}),define("src/g/bag/ctrl/BagAddCapacityViewCtrl",["require","exports","../../../manager/RoleCenter","../../net/messages/OpResultType","../../net/messages/AddequBagCountC2GS","../../../manager/GameSocketManager","src/g/bag/view/BagAddCapacityView","../../../core/E","../../../enum/EventName","src/init/Switches"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(){}return t.prototype.init=function(){r.E.ins.on(l.EventName.OPENVIEW_BAGADDCAPACITY,this,this.showView),i.RoleCenter.instans.on(n.enumOpResultType.AddequBagCount+"",this,this.onAddequBagCount)},t.prototype.showView=function(){this._view||(this._view=new a.BagAddCapacityView,this._view.init(),this.initViewEvent()),this._view.showView()},t.prototype.initViewEvent=function(){this._view.btn_ok.on(laya.events.Event.CLICK,this,this.onOkClick)},t.prototype.onOkClick=function(){if(i.RoleCenter.instans.vo.GOLD>=parseInt(this._view.lab_xiaohao.text)){var t=new s.AddequBagCountC2GS;t.num=parseInt(this._view.input_.text),o.GSM.sendServer(t)}else h.Switches.ins.event(155),this._view.close()},t.prototype.onAddequBagCount=function(t){t.opresult&&this._view.close()},t}();e.BagAddCapacityViewCtrl=c}),define("src/g/bag/view/BagDlgView",["require","exports","../../../manager/LayerManager","../../../core/E","../../../enum/EventName"],function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(s){function t(t,e,i){var n=s.call(this)||this;return n.refreshHandler=null,n.titleUrl="res/title/wenzi_beibao.png",n._page=null,n.initView(t,e,i),n._page=t,n.bgview.btn_help.visible=!1,n.bgview.btn_close.on(Laya.Event.CLICK,n,n.hideView),n.bgview.btn_back.on(Laya.Event.CLICK,n,n.hideView),n.bgview.img_title.skin=n.titleUrl,n}return __extends(t,s),t.prototype.initView=function(t,e,i){this.tab_.selectHandler=e,this.refreshHandler=i,this.bgview.box_page.addChild(t)},t.prototype.showView=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),this.refreshHandler&&this.refreshHandler.runWith(0),this.tab_.selectedIndex=0,i.LayerManager.addInPOPWindowLayer(this,t,!0,!0,!1,e)},t.prototype.hideView=function(){n.E.ins.off(o.EventName.UPDATE_BAG,this._page,this._page.refreshData),this.removeSelf()},t.prototype.destroyView=function(){this.hideView()},t}(ui.bag.BagDlgViewUI);e.BagDlgView=s}),define("src/g/bag/view/ItemGetPrompt",["require","exports","../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","src/g/custom/detailDlgs/Details_Item","../../../utils/ItemUtils"],function(t,e,s,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.btn_use.on(Laya.Event.CLICK,t,t.onUseItemHandler),t.item.on(Laya.Event.CLICK,t,t.onShowTip),t}return __extends(t,e),t.prototype.showItem=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i=0),this._itemid=t,this._num=e,this._time=i,this.btn_use.visible=!1;var n=o.ItemUtils.getItemVoById(this._itemid);n&&0<n.usecount&&(this.btn_use.visible=!0),s.ItemCellUtils.fillCellForItemNameView(this.item,t,e),this.isPopup||this.popup()},t.prototype.onShowTip=function(){this._itemid&&i.ItemTips.ins.showTip(this._itemid,this._num)},t.prototype.onCloseHandler=function(){this.close()},t.prototype.onUseItemHandler=function(){var t=o.ItemUtils.getItemVoById(this._itemid);t&&(n.Details_Item.UseItem(t,Math.min(this._num,t.usecount),this._time),this.close())},t}(ui.bag.ItemGetPropmtUI);e.ItemGetPrompt=a}),define("src/g/bag/ctrl/BagViewCtrl",["require","exports","../../../utils/system/FloatEffect","../../../utils/ItemUtils","../../../manager/RoleCenter","../../../core/E","../../../enum/EventName","src/g/bag/ctrl/BagItemRecoverViewCtrl","src/g/bag/view/BagView","src/g/bag/ctrl/BagAddCapacityViewCtrl","../../../manager/GameSocketManager","../../net/messages/EquipSplitC2GS","src/init/Switches","src/g/accessctrl/AccessCenter","src/g/account/view/UseItemRewardView","src/g/custom/detailDlgs/SuperMonthCardTip","src/g/bag/view/BagDlgView","../../../vo/sbkBagVo","src/g/forge_new/OnceMsgType","src/g/bag/view/ItemGetPrompt","../../../vo/ReXueUtil","../../../enum/BagItemType","src/init/GameEventDispatcher","../../../config/GameConfig"],function(t,e,E,T,A,R,L,i,s,n,o,a,r,l,x,h,c,P,u,p,k,D,H,M){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(){}return t.prototype.init=function(){(new i.BagItemRecoverViewCtrl).init(),(new n.BagAddCapacityViewCtrl).init(),r.Switches.ins.on(30,this,this.onOpenPage,[30]),r.Switches.ins.on(68,this,this.onOpenPage,[68]),r.Switches.ins.on(69,this,this.onOpenPage,[69]),r.Switches.ins.on(70,this,this.onOpenPage,[70]),R.E.ins.on(L.EventName.USEITEM,this,this.onUseItem),R.E.ins.on(L.EventName.UPDATE_BAG,this,this.refreshData),R.E.ins.on(L.EventName.ZHANWEN_BAGCHANGE,this,this.refreshData),R.E.ins.on(L.EventName.POP_ITEM_GET_PROPMT,this,this.popItemGetPrompt)},t.prototype.popItemGetPrompt=function(t,e,i){void 0===e&&(e=1),void 0===i&&(i=0),this._itemGet||(this._itemGet=new p.ItemGetPrompt),this._itemGet.showItem(t,e,i)},t.prototype.onOpenPage=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1),e&&(30==t?l.AccessCenter.ins.checkOpen(68)?this.onShowView(68,i,n):l.AccessCenter.ins.checkOpen(69)?this.onShowView(69,i,n):l.AccessCenter.ins.checkOpen(70)&&this.onShowView(70,i,n):this.onShowView(t,i,n))},t.prototype.onShowView=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),68==t?this.showView(0,e,i):69==t?this.showView(1,e,i):70==t&&this.showView(2,e,i)},t.prototype.refreshData=function(){this._view&&this._view.refreshData(this._view.p_nowSelect)},t.prototype.onUseItem=function(t){var e=A.RoleCenter.instans.vo;e.bagdata;e.chgItemCount(t.cfgId,0-t.count);var i=T.ItemUtils.getItemVoById(t.cfgId);if((i.type==D.BagItemType.baoxiang||i.type==D.BagItemType.baoxiangSpecial1||i.type==D.BagItemType.baoxiangSpecial2||i.type==D.BagItemType.locked_box)&&2!=i.usetype){var n=new x.UseItemRewardView;1<t.count?i.usetype?n.initData(3,t.inventory):n.initData(2,t.inventory):5<=i.quality?n.initData(2,t.inventory):i.quality<5&&n.initData(1,t.inventory),n.popup(),H.GE.ins.event(4)}var s=t.inventory;if(null!=s){for(var o=s.itemList,a=0;a<o.length;a+=2){e.chgItemCount(o[a],o[a+1]);var r=T.ItemUtils.getItemVoById(o[a]);r&&E.FE.getFloat(r.name+"x"+o[a+1],T.ItemUtils.getColorByQuality(r.quality))}var l=s.currencyList;for(a=0;a<l.length;a++){var h=A.RoleCenter.instans.vo,c=l[a],u=T.ItemUtils.getCurrencyVoByDefine(c.key);u&&(h[u.define]+=c.val,E.FE.getFloat(u.name+"x"+c.val,T.ItemUtils.getColorByQuality(u.quality)))}var p=s.equipList;for(a=0;a<p.length;a++){var d=p[a],g=d.equtemplet,v=T.ItemUtils.getXwEquipVoById(g),f=M.GameConfig.SSEquip[g],y=T.ItemUtils.getWingEquipVoById(g),m=k.ReXueUtil.getEquipVoById(g),_=T.ItemUtils.getEquipVoById(g),C=T.ItemUtils.getFsEquipVoById(g),I=T.ItemUtils.getSrEquipVoById(g);y?(e.addWingEquipIns(d),E.FE.getFloat(y.name,T.ItemUtils.getColorByQuality(y.quality))):m?(E.FE.getFloat(m.name,T.ItemUtils.getColorByQuality(m.quality)),P.sbkBagVo.addRxEquipIns(d)):(v?E.FE.getFloat(v.name,T.ItemUtils.getColorByQuality(v.quality)):f?E.FE.getFloat(f.name,T.ItemUtils.getColorByQuality(f.quality)):C?E.FE.getFloat(C.name,T.ItemUtils.getColorByQuality(C.quality)):I?E.FE.getFloat(I.name,T.ItemUtils.getColorByQuality(I.quality)):E.FE.getFloat(_.name,T.ItemUtils.getColorByQuality(_.quality)),e.addEquipIns(d))}var b=s.zhanwenList;for(a=0;a<b.length;a++){A.RoleCenter.instans.vo.addZhanWen(b[a]);var w=T.ItemUtils.getItemVoById(b[a].cfgId);E.FE.getFloat(w.name+"x1",T.ItemUtils.getColorByQuality(w.quality))}}if(this._view&&this._view.displayedInStage&&this._view.refreshData(this._view.p_nowSelect),t.isBuyAndUse){var S=T.ItemUtils.getShop2VoByItemId(t.cfgId);S&&(A.RoleCenter.instans.vo.GOLD-=S.cost[0][1])}R.E.ins.event(L.EventName.USEITEMOVER,t)},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1);var n=!1;this._view||(n=!0,this._view=new s.BagView,this._view.init(),this.initViewEvent(),this._bgView=new c.BagDlgView(this._view,new Laya.Handler(this._view,this._view.onTabSelectHandler),new Laya.Handler(this._view,this._view.refreshData))),n?Laya.timer.frameOnce(3,this._bgView,this._bgView.showView,[e,i]):this._bgView.showView(e,i)},t.prototype.initViewEvent=function(){this._view.btn_recover.on(laya.events.Event.CLICK,this,this.onBtnRecover),this._view.btn_recoverAll.on(laya.events.Event.CLICK,this,this.onBtnRecoverAll),this._view.btn_addCapacity.on(laya.events.Event.CLICK,this,this.onBtnAddCapacity)},t.prototype.onBtnRecover=function(){r.Switches.ins.event(71)},t.prototype.onBtnRecoverAll=function(){if(A.RoleCenter.instans.vo.isSuperMonthCard){if(u.OnceMsgType.Msg_BagEqReslove)return;var t=P.sbkBagVo.getAllCanResloveEquip();if(0==t.length)return;var e=new a.OnceEquipSplitC2GS;e.splittype=a.ESplitType.commonEquip,e.equipidarr=t,o.GSM.sendServer(e),u.OnceMsgType.Msg_BagEqReslove=!0}else h.SuperMonthCardTip.create()},t.prototype.onBtnAddCapacity=function(){R.E.ins.event(L.EventName.OPENVIEW_BAGADDCAPACITY)},t.equipSplitArr=[],t}();e.BagViewCtrl=d}),define("src/g/openHero/View/OpenHeroView",["require","exports","../../../manager/LayerManager","../../../manager/RoleCenter","src/g/Effects/UIEffectsFactory","../../../config/GameConfig","src/g/clearRes/ClearResM","../../../enum/EventName","../../../core/E","src/init/TextConst"],function(t,e,i,d,n,g,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t.jobArr=[1,2,3],t.p_list=[],t.ItemArr_0=[1,2,0],t.ItemArr_1=[2,0,1],t.ItemArr_2=[0,1,2],t.posXArr=[86.775,372.775,230.775],t.posYArr=[109.19,109.19,173.2],t._nowSex=0,t._nowSelectJob=1,s.ClearResM.addBgUrl(t.bgimg.skin),t.bjView.btn_help.visible=!1,t.onLoadUIEF(),t}return __extends(t,e),t.prototype.addEvent=function(){this.btn_left.on(Laya.Event.CLICK,this,this.rotatePos,[!0]),this.btn_right.on(Laya.Event.CLICK,this,this.rotatePos,[!1]),this.btn_turnRight.on(Laya.Event.CLICK,this,this.rotatePos,[!0]),this.btn_turnLeft.on(Laya.Event.CLICK,this,this.rotatePos,[!1]),this.tab_sex.selectHandler=new Laya.Handler(this,this.SexHandler)},t.prototype.onLoadUIEF=function(){this.ani_put=n.UIEffectsFactory.Ins.createUIAniById(40,!0),n.UIEffectsFactory.Ins.centered4Parent(this.ani_put,this.btn_Open,!0)},t.prototype.SexHandler=function(t){for(var e,i=0;i<3;i++)(e=this.heroBox.getChildByName("item_"+i)).isOpen()||e.setSex(t);this._nowSex=t},t.prototype.rotatePos=function(t){var e=this;this.btn_left.mouseEnabled=!1,this.btn_right.mouseEnabled=!1,this.btn_turnRight.mouseEnabled=!1,this.btn_turnLeft.mouseEnabled=!1,Laya.timer.once(300,this,function(){e.btn_left.mouseEnabled=!0,e.btn_right.mouseEnabled=!0,e.btn_turnRight.mouseEnabled=!0,e.btn_turnLeft.mouseEnabled=!0});var i=0;i=t?this.p_list[this._nowSelectJob].next:this.p_list[this.p_list[this._nowSelectJob].next].next,this.rotatePeople(i)},t.prototype.rotatePeople=function(t){var e,i=this.checkRurnLeft(this._nowSelectJob,t);this._nowSelectJob=t;for(var n=this["ItemArr_"+t],s=0;s<3;s++){e=this.heroBox.getChildByName("item_"+s);var o=this.posXArr[n.indexOf(s)],a=this.posYArr[n.indexOf(s)];if(i)e.zOrder=n.indexOf(s);else{var r=n.indexOf(s);e.zOrder=2==r?2:1==r?0:1}var l=t==s;this.moveAndScale(e,o,a,l),console.log(l),e.setSelect(l)}e=this.heroBox.getChildByName("item_"+t),this.btn_Open.visible=!e.isOpen();var h=d.RoleCenter.instans.vo.VIP,c=d.RoleCenter.instans.vo.heronum,u=1e3*d.RoleCenter.instans.vo.zhuanshengLv+d.RoleCenter.instans.vo.lvl;if(3!=c){var p=g.GameConfig.NewRoleConfig[c];u>=p.limit[0][1]||h>=p.limit2[0][1]?this.ani_put.visible=!0:this.ani_put.visible=!1}},t.prototype.checkRurnLeft=function(t,e){var i=[0,1,2,0];return t==(0==e?i[2]:i[e-1])},t.prototype.moveAndScale=function(t,e,i,n){var s=n?1:.65;Laya.Tween.clearAll(t),Laya.Tween.to(t,{scaleX:s,scaleY:s,x:e,y:i},300,null,null,0,!0)},t.prototype.init=function(){var t,e;this._uVo=d.RoleCenter.instans.vo;for(var i=1-d.RoleCenter.instans.vo.getSex(),n=0;n<3;n++){this.findJob(n+1);e=this.heroBox.getChildByName("item_"+n);var s=this.findJob(n+1);(t=this._uVo.getOpenHeroByIdx(s))?(e.setSex(t.sex),e.setOpen(!0)):(e.setSex(i),e.setOpen(!1)),e.setJob(n+1);var o=new h;o.x=e.x,o.y=e.y,o.next=(n+1)%3,this.p_list.push(o)}1<this._uVo.heronum?window.oldversion?this.lab_tip.changeText(r.TextConst.get(650,4,4)):this.lab_tip.changeText(r.TextConst.get(650,4,6)):this._uVo.heronum&&this._uVo.heronum<2&&(window.oldversion?this.lab_tip.changeText(r.TextConst.get(650,2,1)):this.lab_tip.changeText(r.TextConst.get(650,2,3))),window.enabledpay||(1<this._uVo.heronum?(window.oldversion,this.lab_tip.changeText("开启需要4转")):window.oldversion?this.lab_tip.changeText("开启需要1转"):this.lab_tip.changeText("开启需要2转")),this.addEvent(),this.tab_sex.selectedIndex=i,this.rotatePeople(0)},t.prototype.findJob=function(t){for(var e=d.RoleCenter.instans.vo,i=0;i<e.heronum;i++)if(e.getOpenHeroByIdx(i).jobid==t)return i;return-1},t.prototype.showView=function(t){void 0===t&&(t=!0),this.init();for(var e=1;e<=3;e++)if(-1==this.findJob(e)){this.rotatePeople(e-1);break}i.LayerManager.addInPOPWindowLayer(this,t),this.bgimg.restskin(),a.E.ins.on(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){a.E.ins.off(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),s.ClearResM.clearResFolder("createrole/img/"),s.ClearResM.clearResFolder("openhero/")},t.prototype.hideView=function(){this.removeSelf()},t.prototype.destroyView=function(){this.hideView()},t}(ui.openhero.OpenHeroUI);e.OpenHeroView=l;var h=function(){};e.ItemList=h}),define("src/g/openHero/Ctrl/OpenHeroCtrl",["require","exports","../../../config/GameConfig","../../net/messages/CreateHeroC2GS","src/g/openHero/View/OpenHeroView","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../../manager/GameSocketManager","../../../manager/TipManager","../../../vo/RedDot/RedDot_Friend","../../../manager/NewRedHintsCenter","../../net/messages/sbkHeroData","../../../manager/AM","src/init/Switches","src/g/clearRes/ClearResM","src/init/TextConst"],function(t,e,r,n,i,s,o,l,a,h,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(){function t(){this.closeOther=!1,s.E.ins.on(o.EventName.OPENNEW_HERO,this,this.onNewFriendOver),s.E.ins.on(o.EventName.CHANGECURRENCY,this,this.onVipChange),s.E.ins.on(o.EventName.ADDED_LEVEL,this,this.onVipChange),s.E.ins.on(o.EventName.ADDED_ZHUANSHENG,this,this.onVipChange),s.E.ins.on(o.EventName.OPENNEW_HERO,this,this.onVipChange),g.Switches.ins.on(15,this,this.onOpenFriend)}return t.prototype.onVipChange=function(t){void 0===t&&(t=""),"VIP"==t||""==t?this.checkOpenFriend():t instanceof p.sbkHeroData&&this.checkOpenFriend()},t.prototype.checkOpenFriend=function(){l.RoleCenter.instans.vo.heronum<3&&(c.RedDot_Friend.Ins.checkFriend(),u.NewRedHintsCenter.ins.setRedHintOpenOrClose(u.enumRedHints.friend,c.RedDot_Friend.Ins.red_all))},t.prototype.addEvent=function(){this._view.bjView.btn_close.on(Laya.Event.CLICK,this,this.closeView),this._view.bjView.btn_back.on(Laya.Event.CLICK,this,this.closeView),this._view.btn_Open.on(Laya.Event.CLICK,this,this.clickHandler)},t.prototype.init=function(){this._view=new i.OpenHeroView,this.addEvent()},t.prototype.onNewFriendOver=function(t){this._view&&this._view.displayedInStage&&this._view.hideView(),t&&h.TipManager.showType1Tip(null,null,null,t.jobid,t.sex)},t.prototype.clickHandler=function(){var t=this._view._nowSex,e=this._view._nowSelectJob+1,i=l.RoleCenter.instans.vo.VIP,n=l.RoleCenter.instans.vo.heronum,s=1e3*l.RoleCenter.instans.vo.zhuanshengLv+l.RoleCenter.instans.vo.lvl,o=r.GameConfig.NewRoleConfig[n];if(o)if(s>=o.limit[0][1]||i>=o.limit2[0][1])this._view.ani_put.visible=!0,this.openHero(t,e);else{if(!window.enabledpay)return void d.AM.showAdvanced("条件不足!",new Laya.Handler(this,function(){}));this._view.ani_put.visible=!1;var a=f.TextConst.get(649,o.limit2[0][1],n+1);d.AM.showAdvanced(a,new Laya.Handler(this,function(){g.Switches.ins.event(101)}),new Laya.Handler(this,function(){}),null,f.TextConst.get(200),f.TextConst.get(327))}},t.prototype.openHero=function(t,e){var i=new n.CreateHeroC2GS;i.job=e,i.sex=t,a.GSM.sendServer(i)},t.prototype.onOpenFriend=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!0),this.realOpenFriend()},t.prototype.realOpenFriend=function(){this._view||(this.init(),this.checkOpenFriend()),this._view.showView(this.closeOther),v.ClearResM.resetViewImg(this._view),s.E.ins.on(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){s.E.ins.off(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),v.ClearResM.clearResFolder("openhero/"),v.ClearResM.clearResFolder("createrole/")},t.prototype.closeView=function(){this._view.bjView.btn_close.off(Laya.Event.CLICK,this,this.closeView),this._view.bjView.btn_back.off(Laya.Event.CLICK,this,this.closeView),this._view.btn_Open.off(Laya.Event.CLICK,this,this.clickHandler),this._view.hideView(),this._view.destroy(!0),this._view=null,this.closeClearRes()},t}();e.OpenHeroCtrl=y}),define("src/g/mail/view/OpenMailView",["require","exports","../../../enum/EventName","../../../core/E","../../../utils/ItemUtils","../../../core/GNet","../../net/messages/sbkMailListData","../../../utils/StringUtils","../../net/messages/OpResultType","../../../manager/RoleCenter","../../../manager/AM","src/g/peronboss/view/ItemIconView","../../../config/GameConfig"],function(t,e,u,p,d,g,v,f,y,m,i,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.view.btn_back.visible=!1,t.des.style.fontSize=20,t.des.style.font="SimHei",t.des.style.leading=15,t.des.style.color="#caaa88",t.panel.vScrollBarSkin="",t.panel.vScrollBar.elasticDistance=20,t.panel_list.hScrollBarSkin="",t.panel_list.hScrollBar.elasticDistance=10,t}return __extends(t,e),t.prototype.clickHandler=function(){m.RoleCenter.instans.bagRoomEnough()?(this._data.isGetBonus=!0,g.GNet.sendMail(y.enumOpResultType.mail_getBonus,this._data.mailId),this._closeHandlers()):i.AM.showBagNotEnough()},t.prototype._closeHandlers=function(){this.close("side"),Laya.loader.clearRes("res/mail/youjian_beijin.jpg"),this.destroy(!0),this._data=null},t.prototype.showView=function(t){if(t.mailCfgId==v.enumMailCfgId.GM)this.des.innerHTML=t.mailStrArr[1];else{var e=C.GameConfig.mailJSON[t.mailCfgId];this.des.innerHTML=f.StringUtils.replaceModel(e.text,t.mailStrArr)}this._data=t,0==this._data.isRead&&g.GNet.sendMail(y.enumOpResultType.mail_read,this._data.mailId),this._data.isRead=!0,m.RoleCenter.instans.vo.checkMailRed(),p.E.ins.event(u.EventName.RED_MAIL_UPDATE),this.btn_get.disabled=t.isGetBonus,this.popup(),this.view.btn_close.once(Laya.Event.CLICK,this,this._closeHandlers),this.btn_get.on(Laya.Event.CLICK,this,this.clickHandler),this.list_con.removeChildren(0,10);var i=t.bonusArr[0];if(!i)return this.btn_get.visible=!1,void(this.tip_no_txt.visible=!0);if(this.btn_get.visible=!0,this.tip_no_txt.visible=!1,i.currencyList)for(var n=i.currencyList,s=0;s<n.length;s++){var o=d.ItemUtils.getCurrencyByDefine(n[s].key);if(o)(c=new _.ItemIconView).scale(.8,.8),c.setData(o,n[s].val),this.list_con.addChild(c)}if(i.itemList){var a=i.itemList;for(s=0;s<a.length;s+=2){var r=d.ItemUtils.getItemVoById(a[s]);(c=new _.ItemIconView).scale(.8,.8),c.setData(r,a[s+1]),this.list_con.addChild(c)}}if(i.equipList){var l=i.equipList;for(s=0;s<l.length;s++){var h=d.ItemUtils.getItemOrEq(l[s].equtemplet);(c=new _.ItemIconView).scale(.8,.8),c.setData(h,0),this.list_con.addChild(c)}}if(i.zhanwenList)for(l=i.zhanwenList,s=0;s<l.length;s++){var c;h=d.ItemUtils.getItemOrEq(l[s].cfgId);(c=new _.ItemIconView).scale(.8,.8),c.setData(h,0),this.list_con.addChild(c)}},t}(ui.mail.OpenMailViewUI);e.OpenMailView=n}),define("src/g/mail/view/MailItem",["require","exports","../../../utils/ItemUtils","../../../enum/EventName","../../../core/E","../../net/messages/sbkMailListData","../../../utils/system/DateUitl","src/init/TextConst"],function(t,e,s,i,n,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t.on(Laya.Event.CLICK,t,t.clickHandler),t}return __extends(t,e),t.prototype.clickHandler=function(){this._data&&n.E.ins.event(i.EventName.OPENMAILCTRL,this._index)},t.prototype.setData=function(t,e){if(t.mailCfgId==o.enumMailCfgId.GM)this.title_txt.text=t.mailStrArr[0];else{var i=s.ItemUtils.getMailVo(t.mailCfgId);if(!i)return void console.error("邮件id错误 ");this.title_txt.text=i.title}this._index=e,this.reward_tip.visible=!1,0<t.bonusArr.length&&0==t.isGetBonus&&(this.reward_tip.visible=!0),this.date_txt.text=a.DateUtil.getDate(1e3*t.startTime);var n=this.title_txt.getBounds().width;t.isRead?(this.isread_txt.text=r.TextConst.get(621),this.isread_txt.color="#ccb694"):(this.isread_txt.text=r.TextConst.get(622),this.isread_txt.color="#12b012"),this.isread_txt.x=n+this.title_txt.x,this._data=t},t}(ui.mail.MailItemUI);e.MailItem=l}),define("src/g/mail/view/MailView",["require","exports","../../../manager/AM","../../net/messages/OpResultGS2C","../../../manager/GameSocketManager","../../net/messages/sbkMailListData","../../../core/E","../../../enum/EventName","src/g/mail/view/OpenMailView","src/g/mail/view/MailItem","../../../manager/LayerManager","../../../manager/RoleCenter","../../../core/GNet","../../net/messages/OpResultType","../../net/messages/ErrConst","../../../utils/system/FloatEffect","../../../utils/ItemUtils","src/init/Switches","../../../utils/system/ErrCodeView"],function(t,e,s,n,o,a,d,g,r,l,h,v,c,f,y,u,p,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t._isget=!1,t.view.btn_help.visible=!1,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=50,t.list.itemRender=l.MailItem,t.list.renderHandler=new Laya.Handler(t,t.itemHandler),t.view.btn_back.on(Laya.Event.CLICK,t,t.closeHandler),t.view.btn_close.on(Laya.Event.CLICK,t,t.closeHandler),t.btn_getAll.on(Laya.Event.CLICK,t,t.getAllHandler),t.btn_de.on(Laya.Event.CLICK,t,t.deleHandler),d.E.ins.on(g.EventName.OPENMAILCTRL,t,t.openViewHandler);var e=o.GSM.ins;return e.on(a.sbkMailListData.KEY,t,t.receiveMailList),e.on(n.OpResultGS2C.KEY,t,t.getRewardHandler),e.on(a.sbkMailData.KEY,t,t.receiveMailItem),d.E.ins.on(g.EventName.GAME_RESTART,t,t.onGameReStart),t}return __extends(t,i),t.prototype.deleHandler=function(){c.GNet.sendMail(f.enumOpResultType.mail_del,0)},t.prototype.onGameReStart=function(){this._isget=!1},t.prototype.getRewardHandler=function(t){if(t.opresult)if(t.msgidx==f.enumOpResultType.mail_getBonus){for(var e=t.reservedata[0],i=this.list.array,n=0;n<i.length;n++){var s=this.list.array[n];if(s.mailId==e){s.isGetBonus=!0,v.RoleCenter.instans.addInventoryToC(s.bonusArr[0]),this.floatUp(s);break}}v.RoleCenter.instans.vo.checkMailRed(),d.E.ins.event(g.EventName.RED_MAIL_UPDATE),this.list.refresh()}else if(t.msgidx==f.enumOpResultType.mail_all){var o=t.reservedata;o[0]==y.enumErrConst.code_2206||o[0],o.shift();var a=o,r=this.list.array.length,l=this.list.array;for(n=0;n<r;n++){var h=l[n];h.isRead=!0,-1!=a.indexOf(h.mailId)&&(h.isGetBonus=!0,v.RoleCenter.instans.addInventoryToC(h.bonusArr[0]),this.floatUp(h))}this.list.refresh(),v.RoleCenter.instans.vo.checkMailRed(),d.E.ins.event(g.EventName.RED_MAIL_UPDATE)}else if(t.msgidx==f.enumOpResultType.mail_del&&t.reservedata&&0<t.reservedata.length){var c=t.reservedata;for(l=this.list.array,n=0;n<c.length;n++)for(var u=0;u<l.length;u++){var p=l[u];if((p.isRead||p.isGetBonus)&&p.mailId==c[n]){l.splice(u,1);break}}this.list.array=l}},t.prototype.floatUp=function(t){for(var e=t.bonusArr[0].currencyList,i=0;i<e.length;i++){var n=p.ItemUtils.getItemOrEq(e[i].key);u.FE.getUpfloatQ(n.name+"x"+e[i].val,n.quality)}var s=t.bonusArr[0].itemList;for(i=0;i<s.length;i+=2){n=p.ItemUtils.getItemOrEq(s[i]);u.FE.getUpfloatQ(n.name+"x"+s[i+1],n.quality)}var o=t.bonusArr[0].equipList;for(i=0;i<o.length;i++){var a=o[i].equtemplet;n=p.ItemUtils.getItemOrEq(a);u.FE.getUpfloatQ(n.name,n.quality)}},t.prototype.receiveMailList=function(t){t.listData&&(v.RoleCenter.instans.vo&&(v.RoleCenter.instans.vo.mailData.listData.listData=t.listData),this._isget=!0,t.listData.reverse(),this.list.array=t.listData,v.RoleCenter.instans.vo.checkMailRed(),d.E.ins.event(g.EventName.RED_MAIL_UPDATE))},t.prototype.receiveMailItem=function(t){this.list.array.unshift(t),this.list.refresh(),v.RoleCenter.instans.vo.checkMailRed(),d.E.ins.event(g.EventName.RED_MAIL_UPDATE)},t.prototype.openViewHandler=function(t){var e=this.list.array[t];if(e){var i=new r.OpenMailView;e.isRead=!0,c.GNet.readMail(e.mailId),this.list.refresh(),i.showView(e),i.btn_get.once(Laya.Event.CLICK,this,this.getRewarHandler)}},t.prototype.getRewarHandler=function(){this.list.refresh()},t.prototype.closeHandler=function(){this.removeSelf()},t.prototype.getAllHandler=function(){if(this.list.array&&!(this.list.array.length<=0)){v.RoleCenter.instans.vo.bagdata.getBagRoom();for(var t=this.list.array,e=t.length,i=0;i<e;i++){var n=t[i];!n.isGetBonus&&n.bonusArr.length&&n.bonusArr[0].equipList.length}v.RoleCenter.instans.bagRoomEnough(20)?c.GNet.sendMail(f.enumOpResultType.mail_all,0):s.AM.show(_.ErrCodeView.getErrStr(y.enumErrConst.code_2206),Laya.Handler.create(this,function(){m.Switches.ins.event(71)}))}},t.prototype.itemHandler=function(t,e){t.setData(this.list.array[e],e)},t.prototype.showView=function(){if(this._isget){var t=this.list.array;this.list.array=t}else this.list.array=[],c.GNet.getMailList();h.LayerManager.addInPOPWindowLayer(this)},t}(ui.mail.MailViewUI);e.MailView=i}),define("src/g/mail/ctrl/MailViewCtrl",["require","exports","../../../manager/RoleCenter","../../../enum/EventName","../../../core/E","src/g/mail/view/MailView","../../../manager/GameSocketManager","../../net/messages/sbkUserMailData","../../net/messages/sbkMailListData","src/init/Switches","../../../runtime/resload/GameResLoad"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){}return t.prototype.init=function(){h.Switches.ins.on(1,this,this.openViewHandler);var t=a.GSM.ins;t.on(r.sbkUserMailData.KEY,this,this.receiveMailList),t.on(l.sbkMailData.KEY,this,this.receiveMailItem)},t.prototype.receiveMailList=function(t){i.RoleCenter.instans.vo.mailData.isHave=t.isHave,s.E.ins.event(n.EventName.RED_MAIL_UPDATE)},t.prototype.receiveMailItem=function(t){i.RoleCenter.instans.vo.mailData.isHave=!0,i.RoleCenter.instans.vo.mailData.listData.listData.unshift(t),s.E.ins.event(n.EventName.RED_MAIL_UPDATE)},t.prototype.openViewHandler=function(){this._view||(c.GameResLoad.load("res/atlas/res/mail.json"),this._view=new o.MailView,a.GSM.ins.off(l.sbkMailData.KEY,this,this.receiveMailItem));this._view.showView()},t}();e.MailViewCtrl=u}),define("src/g/vip/view/VipDescDlg",["require","exports","../../../config/GameConfig"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.desc.style.fontSize=20,t.desc.style.font="SimHei",t.desc.style.color="#e6c278",t.desc.style.leading=10,t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t}return __extends(t,e),t.prototype.showVipDesc=function(t){var e=i.GameConfig.vipJSON[t];this.desc.innerHTML=e.desc,this.popup()},t.prototype.onCloseHandler=function(){this.close()},t}(ui.vip.VipDescDlgUI);e.VipDescDlg=n}),define("src/g/vip/view/VipView",["require","exports","../../../enum/EventName","../../../manager/RoleCenter","../../../config/GameConfig","../../../manager/LayerManager","src/g/bag/tips/view/ItemTips","../../net/messages/OpResultType","../../../core/E","../../net/messages/VipC2GS","../../../manager/GameSocketManager","src/g/Effects/UIEffectsFactory","../../../component/UDEffect","../../../manager/AM","src/init/Switches","../../../utils/ItemCellUtils","src/g/clearRes/ClearResM","src/g/vip/view/VipDescDlg","../../../component/GAnimation","../../../utils/ItemUtils","../../../core/GNet","src/init/TextConst"],function(t,e,n,a,r,s,i,o,l,h,c,u,p,d,g,v,f,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var b=function(e){function t(){var t=e.call(this)||this;return t.assetUrls=[],t._minLv=1,t._maxLv=0,t._showLv=0,t.crossLv=4,t._currShowLv=1,t.onLoadUIEF(),t.init(),t}return __extends(t,e),t.prototype.init=function(){this.view.btn_close.on(Laya.Event.CLICK,this,this.closeHandler),this.view.on(Laya.Event.CLICK,this,this.closeHandler),this.btn_recharge.on(Laya.Event.CLICK,this,this.goToRecharge),this.btn_left.on(Laya.Event.CLICK,this,this.turnLeft),this.btn_right.on(Laya.Event.CLICK,this,this.turnRight),this.htxt_num.style.fontSize=20,this.htxt_num.style.font="SimHei",this.htxt_num.style.color="#a89e8f",this.htxt_num.style.align="center",this.txt1.style.fontSize=20,this.txt1.style.font="SimHei",this.txt1.style.color="#c0b4a3",this.txt1.style.align="center",this.txt1.style.leading=10,this.list_gifts.itemRender=ui.custom.ItemNameViewUI,this.list_gifts.renderHandler=new Laya.Handler(this,this.onListRender),this.list_gifts.mouseHandler=new Laya.Handler(this,this.onListeMouseHandler);var t=r.GameConfig.vipJSON;for(var e in t){var i=t[e];i&&i.id>this._maxLv&&(this._maxLv=i.id)}this.refreshVipData(),l.E.ins.on(n.EventName.VIP_EXP_CHANGED,this,this.refreshVipData),l.E.ins.on(n.EventName.VIP_GET_BONS_STATE_CHANGED,this,this.onGetBonsStateChanged),l.E.ins.on(n.EventName.VIP_EXP_CHANGED,this,this.refreshArrow),this.btn_get.on(Laya.Event.CLICK,this,this.receiveTheAward),this.lab_showdesc.on(Laya.Event.CLICK,this,this.showDescDlg)},t.prototype.showDescDlg=function(){this._descDlg||(this._descDlg=new y.VipDescDlg),this._descDlg.showVipDesc(this._currShowLv)},t.prototype.onGetBonsStateChanged=function(){this.displayedInStage&&(this._currShowLv=this.getMinShowLv(),this.initPage())},t.prototype.onHideVipLv=function(){var t=new h.VipC2GS;t.msgidx=o.enumOpResultType.vip_hide,c.GSM.sendServer(t)},t.prototype.onLoadUIEF=function(){this.ani_put=u.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_get,40)},t.prototype.refreshVipData=function(){var t=a.RoleCenter.instans.vo.VIP,e=a.RoleCenter.instans.vo.VIPEXP,i=r.GameConfig.vipJSON[Math.min(t+1,this._maxLv)+""];this._showLv=t+this.crossLv>=this._maxLv?this._maxLv:t+this.crossLv;var n=t>=this._maxLv;this.curr_lv.value=t+"",this.next_lv.value=n?"":t+1+"",this.to_line.visible=!n,this.to_vip.visible=!n,this.next_lv.visible=!n,this.txt_pro.text=e+"/"+i.exp,this.progress.scaleX=Math.min(1,e/i.exp),t<this._maxLv?(this.txt1.innerHTML=I.TextConst.get(772,Math.max(0,i.exp-e),t+1),this.txt1.visible=!0):(this.txt1.innerHTML="",this.txt1.visible=!1),this.updateBtnGet()},t.prototype.turnLeft=function(){this._currShowLv>this._minLv&&this._currShowLv--,this.initPage()},t.prototype.turnRight=function(){this._currShowLv<this._showLv&&this._currShowLv++,this.initPage()},t.prototype.goToRecharge=function(){g.Switches.ins.event(109)},t.prototype.closeHandler=function(){l.E.ins.off(n.EventName.REGIST_PLAYER_NUM_CHANGED,this,this.updatePlayerNum),this.removeSelf(),this.closeClearRes(),this.clearAni(),Laya.timer.clear(this,this.showVipActivityGoToBtn),this.hideVipActivityGoToBtn()},t.prototype.showView=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this.displayedInStage||(this._currShowLv=i<1?this.getMinShowLv():i,this.initPage()),Laya.timer.frameOnce(3,this,this.showVipActivityGoToBtn),this.img_bg.restskin(),f.ClearResM.resetViewImg(this),this.showAni(),s.LayerManager.addInPOPWindowLayer(this,t,!0,!0,!1,e),l.E.ins.once(n.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),this.updatePlayerNum(),C.GNet.requestRegistPlayerNum(),l.E.ins.on(n.EventName.REGIST_PLAYER_NUM_CHANGED,this,this.updatePlayerNum)},t.prototype.showAni=function(){var t=u.UIEffectsFactory.Ins.createSAniById(39,3,3);this.effect_con.addChild(t)},t.prototype.clearAni=function(){this.effect_con.removeChildren(),u.UIEffectsFactory.Ins.clearAniRes(39)},t.prototype.updatePlayerNum=function(){this.htxt_num.innerHTML=I.TextConst.get(773,Math.floor(a.RoleCenter.instans.vo.registPlayerNum/8+30+a.RoleCenter.instans.vo.vip_num))},t.prototype.closeClearRes=function(){l.E.ins.off(n.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),Laya.loader.clearRes(this.img_bg.skin,!0),f.ClearResM.clearResFolder("vip/"),f.ClearResM.clearFolderByUrl("dynamic/vip/");for(var t=0;t<this.assetUrls.length;t++){var e=this.assetUrls[t];Laya.loader.clearRes(e)}this.assetUrls=[]},t.prototype.checkMaxLvForGet=function(t){for(var e=t;0<e&&0==(a.RoleCenter.instans.self.vipData.getBons>>e-1&1);)e--;return e},t.prototype.getMinShowLv=function(){for(var t=1,e=Math.min(this._maxLv,a.RoleCenter.instans.vo.VIP+1);t<=e;){if(0!=(a.RoleCenter.instans.self.vipData.getBons>>t-1&1))return t;t++}return e},t.prototype.initPage=function(){var t=r.GameConfig.vipJSON[this._currShowLv+""];this._currShowLv==this._minLv?this.btn_left.visible=!1:this.btn_left.visible=!0,this._currShowLv==this._showLv?this.btn_right.visible=!1:this.btn_right.visible=!0,this.show_lv.value=this._currShowLv+"",this.show_lv2.value=this._currShowLv+"",this.txt_title.text=I.TextConst.get(774,t.exp,this._currShowLv);for(var e=a.RoleCenter.instans.vo.VIP,i=!1,n=this._currShowLv+1;n<=this._showLv&&!(e<n);n++)if(0<(a.RoleCenter.instans.self.vipData.getBons>>n-1&1)){i=!0;break}this._ef_right&&(this._ef_right.clear(),this._ef_right=null),this.btn_effect_right.visible=!1,i&&(this.btn_effect_right.visible=!0,this._ef_right||(this._ef_right=new p.UDEffect),this._ef_right.effectAlpha(this.btn_effect_right,1,1e3)),this._ef_left&&(this._ef_left.clear(),this._ef_left=null),i=this.btn_effect_left.visible=!1;for(n=1;n<this._currShowLv;n++)if(n<=e&&0<(a.RoleCenter.instans.self.vipData.getBons>>n-1&1)){i=!0;break}i&&(this.btn_effect_left.visible=!0,this._ef_left||(this._ef_left=new p.UDEffect),this._ef_left.effectAlpha(this.btn_effect_left,1,1e3)),this.updateBtnGet(),this.updateGifts(t);var s=_.ItemUtils.getUIEffectsVoById(t.showani);if(s){this._ani||(this._ani=new m.GAnimation,this._ani.interval=150,this.ani_con.addChild(this._ani));var o=(s.urlPath?s.urlPath:"dynamic2/uieffect")+"/"+s.name+".json";this.assetUrls.push(o),this._ani.clear(!0),this._ani.load(o,!0)}else this._ani&&this._ani.clear(!0);window.oldversion?this.img_power.visible=!1:this.img_power.skin="dynamic/vip/power"+this._currShowLv+".png"},t.prototype.updateBtnGet=function(){var t=a.RoleCenter.instans.vo.VIP;this._currShowLv>t?(this.btn_get.visible=!0,this.btn_get.label=I.TextConst.get(232),this.ani_put.visible=!0,this.btn_get.disabled=!1):(this.btn_get.label=I.TextConst.get(203),this.btn_get.visible=!0,this.ani_put.visible=!(0==(a.RoleCenter.instans.self.vipData.getBons>>this._currShowLv-1&1)),this.btn_get.disabled=0==(a.RoleCenter.instans.self.vipData.getBons>>this._currShowLv-1&1),this.btn_get.disabled&&(this.btn_get.label=I.TextConst.get(211)))},t.prototype.updateGifts=function(t){this.list_gifts.array=t.bons},t.prototype.onListRender=function(t,e){v.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onListeMouseHandler=function(t,e){t.type==laya.events.Event.CLICK&&i.ItemTips.ins.showTip(this.list_gifts.array[e][0],Number(this.list_gifts.array[e][1]))},t.prototype.receiveTheAward=function(){var t=a.RoleCenter.instans.vo.VIP;if(this._currShowLv>t)g.Switches.ins.event(109);else{if(!a.RoleCenter.instans.bagRoomEnough())return void d.AM.showBagNotEnough();var e=new h.VipC2GS;e.msgidx=o.enumOpResultType.vip_get,e.curVip=this._currShowLv,c.GSM.sendServer(e)}},t.prototype.showVipActivityGoToBtn=function(){this.hideVipActivityGoToBtn(),this.effect_vip_act.displayedInStage?this.vipActbtn=u.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.effect_vip_act,90):this.effect_vip_act.on(n.EventName.UI_ADD_TO_STAGE,this,this.showVipActivityGoToBtn)},t.prototype.hideVipActivityGoToBtn=function(){this.effect_vip_act.off(n.EventName.UI_ADD_TO_STAGE,this,this.showVipActivityGoToBtn),this.vipActbtn&&(this.vipActbtn.removeSelf(),this.vipActbtn=null,u.UIEffectsFactory.Ins.clearAniRes(90))},t.prototype.refreshArrow=function(){this._currShowLv==this._minLv?this.btn_left.visible=!1:this.btn_left.visible=!0,this._currShowLv==this._showLv?this.btn_right.visible=!1:this.btn_right.visible=!0},t}(ui.vip.VipViewUI);e.VipView=b}),define("src/g/account/view/VipFly",["require","exports","../../../manager/LayerManager","src/g/Effects/UIEffectsFactory"],function(t,e,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this,e=s.UIEffectsFactory.Ins.playAniOnce(1119,t);return e.x=(Laya.stage.width-e.width)/2,t.vipup.addChild(e),t}return __extends(t,i),t.prototype.showView=function(){n.LayerManager.addAlertLayer(this)},t}(ui.account.VipFlyUI);e.VipFlyView=i}),define("src/g/vip/ctrl/VipViewCtrl",["require","exports","../../net/messages/VipC2GS","src/g/vip/view/VipView","../../../enum/EventName","../../../core/E","../../../manager/RoleCenter","../../net/messages/OpResultType","../../../manager/GameSocketManager","../../../config/GameConfig","../../../utils/system/FloatEffect","src/init/Switches","src/g/accessctrl/AccessCenter","src/g/account/ctrl/GetRewwardCtrl","src/g/proxy/AccessListenProxy","../../../manager/NewRedHintsCenter","src/g/account/view/VipFly"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(){function t(){}return t.prototype.init=function(){window.oldversion?(this._campatibleVipLvStage1=3,this._campatibleVipLvStage2=4):(this._campatibleVipLvStage1=5,this._campatibleVipLvStage2=6),u.Switches.ins.on(101,this,this.openVipHandler),a.RoleCenter.instans.on(r.enumOpResultType.vip_lv.toString(),this,this.onVipUp),a.RoleCenter.instans.on(r.enumOpResultType.vip_hide.toString(),this,this.onVipHide),l.GSM.ins.on(i.VipGS2C.KEY,this,this.receiveTheAwardBack),(new g.AccessListenProxy).checkAndListen(101,new Laya.Handler(this,this.checkRed))},t.prototype.openVipHandler=function(t,e,i,n){void 0===e&&(e=!0),void 0===i&&(i=!1),void 0===n&&(n=0),t&&this.openView(e,i,n)},t.prototype.openView=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._view||(this._view=new n.VipView),this._view.showView(t,e,i)},t.prototype.onVipUp=function(t){if(t.opresult){if(a.RoleCenter.instans.vo.VIP!=t.reservedata[0]){var e=this.getVipBagCount(t.reservedata[0]%100)-this.getVipBagCount(a.RoleCenter.instans.vo.VIP);if(a.RoleCenter.instans.vo.bagdata.equBagCount+=e,a.RoleCenter.instans.vo.VIP=t.reservedata[0],window.enabledpay)(new f.VipFlyView).showView()}a.RoleCenter.instans.vo.VIPEXP=t.reservedata[1],o.E.ins.event(s.EventName.VIP_EXP_CHANGED),this.checkRed(),a.RoleCenter.instans.addBoxCount()}},t.prototype.onVipHide=function(t){t.opresult&&(a.RoleCenter.instans.vo.VIP=t.reservedata[0],o.E.ins.event(s.EventName.VIP_HIDE_STATE_CHANGED),this.checkRed())},t.prototype.getVipBagCount=function(t){var e=h.GameConfig.vipJSON[t.toString()];for(var i in e.reward){var n=e.reward[i];if(n&&"BAGEXTENDCOUNT"==n[0])return n[1]}return 0},t.prototype.receiveTheAwardBack=function(t){if(t.msgidx==r.enumOpResultType.vip_get){var e=t.curVip;a.RoleCenter.instans.vo.vipData.getBons&=~(1<<e-1),a.RoleCenter.instans.addInventoryToC(t.inv),c.FE.addInventoryToCFloats(t.inv),o.E.ins.event(s.EventName.VIP_GET_BONS_STATE_CHANGED);var i=Laya.Handler.create(this,this.quickUsePacket,[t.inv.itemList]);d.GetRewwardCtrl.inventoryAddGS2C(t.inv,i),this.checkRed()}},t.prototype.quickUsePacket=function(t){o.E.ins.event(s.EventName.USE_FAMILY__RED_PACKET,[t])},t.prototype.checkRed=function(){this.checkVipRed(),this.checkVip3Red(),this.checkVip4Red()},t.prototype.checkVipRed=function(){for(var t=a.RoleCenter.instans.vo.VIP;0<t;){if(1==(a.RoleCenter.instans.self.vipData.getBons>>t-1&1))return void v.NewRedHintsCenter.ins.setRedHintOpenOrClose(v.enumRedHints.vip,!0);t--}v.NewRedHintsCenter.ins.setRedHintOpenOrClose(v.enumRedHints.vip,!1)},t.prototype.checkVip3Red=function(){if(p.AccessCenter.ins.checkOpen(101)&&(3<=a.RoleCenter.instans.vo.VIP&&!(0==(a.RoleCenter.instans.self.vipData.getBons>>this._campatibleVipLvStage1-1&1))))return void v.NewRedHintsCenter.ins.setRedHintOpenOrClose(v.enumRedHints.vip3,!0);v.NewRedHintsCenter.ins.setRedHintOpenOrClose(v.enumRedHints.vip3,!1)},t.prototype.checkVip4Red=function(){if(p.AccessCenter.ins.checkOpen(101)&&(4<=a.RoleCenter.instans.vo.VIP&&!(0==(a.RoleCenter.instans.self.vipData.getBons>>this._campatibleVipLvStage2-1&1))))return void v.NewRedHintsCenter.ins.setRedHintOpenOrClose(v.enumRedHints.vip4,!0);v.NewRedHintsCenter.ins.setRedHintOpenOrClose(v.enumRedHints.vip4,!1)},t}();e.VipViewCtrl=y}),define("src/g/role/view/Govern/GovernResolvePage",["require","exports","../../../net/messages/UseItemC2GS","../../../../manager/RoleCenter","../../../../utils/ItemUtils","src/g/role/vo/GovernStruct","../../../../manager/GameSocketManager","src/g/itemGets/View/ItemGet_TipItem","src/init/TextConst"],function(t,e,i,n,o,a,s,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.arrSourcr=[],t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){this.list_.renderHandler=new Laya.Handler(this,this.renderHandler)},t.prototype.onResolve=function(t){var e=new i.UseItemC2GS;e.cfgId=t.ivo.id,e.count=t.num,s.GSM.sendServer(e)},t.prototype.refreshData=function(){this.addGetGo(),this.arrSourcr=[],this.uvo=n.RoleCenter.instans.vo,this.bag=this.uvo.bagdata,this.checkBag()},t.prototype.addGetGo=function(){this.vbox.removeChildren();for(var t=o.ItemUtils.getItemVoById(125),e=2;e<t.link.length;e++){var i=(new r.ItemGet_TipItem).init(t.link[e][0],t.link[e][1]);this.vbox.addChild(i),this.vbox.height+=i.height}},t.prototype.checkBag=function(){for(var t=0;t<4;t++){var e=a.GovernStruct.Ins.getGovernVo(t+1,0),i=new c;if(i.ivo=o.ItemUtils.getItemVoById(parseInt(e.activationcost[0][0])),i.num=this.bag.getItemCount(i.ivo.id),0<i.num){for(var n=0;n<3;n++){var s=this.uvo.getOpenHeroByIdx(n);s?0==s.zhuzai.activationArr[t]&&i.num--:i.num--}0<i.num&&this.arrSourcr.push(i)}}this.list_.dataSource=this.arrSourcr},t.prototype.renderHandler=function(t,e){var i=t.dataSource;t.html_text.style.fontSize=18,t.html_text.innerHTML=l.TextConst.get(857,"#C38C30",i.ivo.name),t.setNum(i.num),t.setIcon(o.ItemUtils.getIconById(i.ivo.id)),t.setJob(-1);var n=o.ItemUtils.getItemVoById(i.ivo.effect[0][0]);t.setGet(n.name+"x"+i.ivo.effect[0][1]*i.num),t.setLv(""),t.setQualityBg(o.ItemUtils.getQualitybjByQualityId(i.ivo.quality)),t.setResolveHandler(new Laya.Handler(this,this.onResolve,[i]))},t}(ui.role.Govern.Page.GovernResolveUI);e.GovernReslivePage=h;var c=function(){};e.bagGvoStruct=c}),define("src/g/role/ctrl/Govern/GovernResloveCtrl",["require","exports","src/g/role/view/Govern/GovernResolvePage","../../../../core/E","../../../../enum/EventName","../../../../vo/RedDot/role/RedDot_Govern","../../../../vo/RedDot/EventRedDot","src/init/ResManager"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){}return t.prototype.init=function(){this._view=new i.GovernReslivePage,n.E.ins.on(s.EventName.USEITEMOVER,this,this.onResolve)},t.prototype.onResolve=function(){o.RedDot_Govern.Ins.checkAll(),n.E.ins.event(a.EventRedDot.REFRESH_EQUIP),n.E.ins.event(a.EventRedDot.REFRESH_ROLE),this.refreshData()},t.prototype.showPage=function(t){this._view||this.init(),this.refreshData(),t.removeChildren(),t.addChild(this._view),r.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t){},t.prototype.refreshData=function(){this._view.refreshData()},t.prototype.getTitle=function(){return"res/role/govern/wenzi_taozhuangfenjie.png"},t.prototype.hidePage=function(){r.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){r.ResManager.getInstance().destroyPageCtrl(this)},t}();e.GovernResliveCtrl=l}),define("src/g/role/view/Govern/GGovernView",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(ui.role.Govern.GGovernVIewUI);e.GGovernView=i}),define("src/g/role/view/Govern/GovernPageN",["require","exports","../../../../manager/RoleCenter","src/g/role/vo/GovernStruct","src/g/Effects/UIEffectsFactory","../../../../utils/ItemUtils","src/g/itemGets/View/ItemGetDlg","../../../../meta/ShuXingVo","../../../net/messages/PropFightMain","../../../net/messages/sbkFormula","../../../../utils/system/ErrCodeView","../../../net/messages/ErrConst","../../../net/messages/zhuzaiC2GS","../../../net/messages/OpResultType","../../../../manager/GameSocketManager","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../core/E","../../../../enum/EventName","../../../../plugin/sbkPropTool","src/init/TextConst"],function(t,e,l,c,u,p,i,d,g,v,n,s,o,a,r,h,f,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var I=function(e){function t(){var t=e.call(this)||this;return t.isUpLv=!0,t.nSPos=0,t.nHeroIdx=0,t.hvo=null,t.uvo=null,t.isLvMax=!1,t.canUp=!1,t.isOpen=!1,t.limitOk=!1,t.arr_lv=[],t.arr_open=[],t.needItemId=0,t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){this.item_0.on(Laya.Event.CLICK,this,this.changeSelect,[0]),this.item_1.on(Laya.Event.CLICK,this,this.changeSelect,[1]),this.item_2.on(Laya.Event.CLICK,this,this.changeSelect,[2]),this.item_3.on(Laya.Event.CLICK,this,this.changeSelect,[3]),this.btn_up.on(Laya.Event.CLICK,this,this.onUpBtnClick),this.list_star.renderHandler=new Laya.Handler(this,this.starRender)},t.prototype.starRender=function(t,e){t.skin="res/role/govern/xing"+(t.dataSource?"":"0")+".png"},t.prototype.changeHero=function(t,e){void 0===t&&(t=0),void 0===e&&(e=-1),this.uvo=l.RoleCenter.instans.vo,this.hvo=this.uvo.getOpenHeroByIdx(t),this.nHeroIdx=t,this.arr_lv=this.hvo.zhuzai.lvArr,this.arr_open=this.hvo.zhuzai.activationArr,this.refreshData(e)},t.prototype.changePageType=function(t){this.isUpLv=t,this.refreshData()},t.prototype.refreshData=function(t){void 0===t&&(t=-1),-1<t&&(this.nSPos=t),this.renderBase(),this.refreshAttr(),this.refreshNeed()},t.prototype.showUpAni=function(t){void 0===t&&(t=!1)},t.prototype.refreshAttr=function(){this.box_upLv.visible=this.isUpLv,this.list_star.visible=!this.isUpLv;var t,e=c.GovernStruct.Ins.getGovernVo(this.nSPos+1,this.arr_lv[this.nSPos]);t=p.ItemUtils.getItemVoById(parseInt(e.activationcost[0][0]));var i=this.aniSp_equip.getChildByName(t.id+"");i||(this.aniSp_equip.removeChildren(),(i=u.UIEffectsFactory.Ins.createUIAniById(t.id,!0)).name=t.id+"",u.UIEffectsFactory.Ins.centered4Parent(i,this.aniSp_equip,!0));var n=c.GovernStruct.Ins.getGovernVo(this.nSPos+1,this.arr_lv[this.nSPos]),s=new g.PropZhuZai;this.attrBox.removeChildren();for(var o=0;o<n.prop.length;o++){var a=new Laya.Image("res/role/govern/zhuzaitaozhuang_shuxingdi.png");a.width=200;var r=d.ShuXingVo.createSXBox(n.prop[o][0],n.prop[o][1]);r.x=(a.width-r.width)/2,r.y=(a.height-r.height)/2,a.addChild(r),this.attrBox.addChild(a)}if(_.sbkPropTool.reSetProp(s,n.prop),this.box_fight.setFightNum(v.sbkFormula.calZhuZaiCombat(s)),this.isUpLv)e.limit[0]?this.lab_lv.text=p.ItemUtils.getLv(e.limit[0][1]):this.lab_lv.text=C.TextConst.get(208),this.limitOk=this.uvo.getCurLv()>=e.limit[0][1],this.lab_oknum.text=Math.floor(e.probability/100)+"%";else{this.limitOk=!0;var l=Math.floor(e.level/1e4),h=[];for(o=1;o<=5;o++)h.push(o<=l);this.list_star.dataSource=h}},t.prototype.refreshNeed=function(){var t,e=c.GovernStruct.Ins.getGovernVo(this.nSPos+1,this.arr_lv[this.nSPos]),i=0;if(this.isLvMax=!1,this.isOpen=0<this.arr_open[this.nSPos],this.isUpLv)if(this.isOpen){var n=e.cost[0];this.needItemId=n?n[0]:0,i=n?n[1]:0,this.btn_up.label=C.TextConst.get(615)}else this.needItemId=e.activationcost[0][0],i=e.activationcost[0][1],this.btn_up.label=C.TextConst.get(237);else this.needItemId=0<e.advanced.length?e.advanced[0][0]:0,i=e.advanced[0]?e.advanced[0][1]:0,this.btn_up.label=C.TextConst.get(732);this.isLvMax=0==i;var s=0;this.isLvMax?this.item_cost.visible=!1:(this.item_cost.visible=!0,t=p.ItemUtils.getItemVoById(this.needItemId),s=this.uvo.bagdata.getItemCount(t.id),this.item_cost.setNeed(s,i,0==i,!0),this.item_cost.setNeedName(t.name,p.ItemUtils.getSmallIcon(t.icon)),this.item_cost.setQualColor(p.ItemUtils.getColorByQuality(t.quality))),this.canUp=i<=s,this.btn_up.disabled=this.isLvMax;var o=this.btn_up.getChildByName("ani");if(!this.isLvMax&&this.canUp&&l.RoleCenter.instans.vo.lvl>=e.limit[this.nSPos]){if(!this.isUpLv&&!this.isOpen)return void(o&&o.destroy());o||((o=u.UIEffectsFactory.Ins.createUIAniById(40,!0)).name="ani",u.UIEffectsFactory.Ins.centered4Parent(o,this.btn_up,!0))}else o&&o.destroy()},t.prototype.changeSelect=function(t){this.nSPos=t;for(var e=0;e<4;e++)this["item_"+e].img_select.visible=e==this.nSPos;y.E.ins.event(m.EventName.GOVERN_CHANGEITEMIDX,[this.nSPos]),this.refreshData()},t.prototype.onUpBtnClick=function(){if(!this.isLvMax)if(this.limitOk)if(this.canUp)if(this.isUpLv){(t=new o.zhuzaiC2GS).heroidx=this.nHeroIdx,t.msgidx=this.arr_open[this.nSPos]<=0?a.enumOpResultType.zhuzai_activation:a.enumOpResultType.zhuzai_upLv,t.type=this.nSPos+1,r.GSM.sendServer(t)}else{if(!this.isOpen)return void h.FE.upItems(C.TextConst.get(651),f.BubbleEnum.center);var t;(t=new o.zhuzaiC2GS).heroidx=this.nHeroIdx,t.msgidx=a.enumOpResultType.zhuzai_upStar,t.type=this.nSPos+1,r.GSM.sendServer(t)}else this.onShowGetItem();else n.ErrCodeView.show(s.enumErrConst.code_2413)},t.prototype.renderBase=function(){for(var t,e=[C.TextConst.get(141),C.TextConst.get(142),C.TextConst.get(143),C.TextConst.get(144)],i=0;i<4;i++){if(t=this["item_"+i],this.arr_open[i]<=0)t.lab_lv.text=C.TextConst.get(485),t.ani_qual.removeChildren();else{t.lab_lv.text="LV."+this.arr_lv[i]%1e3;var n=t.ani_qual.getChildByName("ani");n||((n=u.UIEffectsFactory.Ins.createUIAniById(83,!0)).name="ani",u.UIEffectsFactory.Ins.centered4Parent(n,t.ani_qual,!0))}t.lab_name.text=e[i];var s=0<this.arr_open[i];t.img_icon.skin="res/custom/equipIcon/suit_"+ktgame.RoleDefineMod.arr_suitPosConst[i]+".png",t.img_icon.gray=!s;var o=0<this.arr_open[i],a=c.GovernStruct.Ins.getGovernVo(i+1,this.arr_lv[i]);if(o)this.isUpLv?a.cost[0]?t.img_red.visible=this.uvo.bagdata.getItemCount(a.cost[0][0])>=a.cost[0][1]:t.img_red.visible=!1:a.advanced[0]?t.img_red.visible=this.uvo.bagdata.getItemCount(a.advanced[0][0])>=a.advanced[0][1]:t.img_red.visible=!1;else{var r=c.GovernStruct.Ins.getGovernVo(i+1,this.arr_lv[i]);t.img_red.visible=this.uvo.bagdata.getItemCount(r.activationcost[0][0])>=r.activationcost[0][1]&&this.isUpLv&&l.RoleCenter.instans.vo.getCurLv()>=r.limit[0][1]}}this.item_cost.setJump(C.TextConst.get(238),new Laya.Handler(this,this.onShowGetItem))},t.prototype.playUpLvAni=function(t){var e=this["item_"+t],i=e.ani_up.getChildByName("up");if(i)i.visible=!0;else{var n=u.UIEffectsFactory.Ins.createUIAniById(71,!1);n.name="up",n.width*=1.5,n.height*=1.5,n.scale(1.5,1.5),u.UIEffectsFactory.Ins.centered4Parent(n,e.ani_up,!0),n.on(Laya.Event.COMPLETE,this,function(){n.stop(),n.visible=!1}),i=n}i.on(Laya.Event.COMPLETE,this,this.stopUpLvAni,[t]),i.play(0)},t.prototype.stopUpLvAni=function(t){var e=this["item_"+t].ani_up.getChildByName("up");e&&(e.stop(),Laya.loader.clearRes(e.source),e.removeSelf())},t.prototype.playAni=function(t,e,i,n){void 0===i&&(i=1),void 0===n&&(n=1),u.UIEffectsFactory.Ins.playAniOnce(e,this.ani_up,i,n)},t.prototype.stopAni=function(t){var e=this.ani_up.getChildByName(t);e&&(e.stop(),e.visible=!1,e.index=0)},t.prototype.onShowGetItem=function(){var t=new i.ItemGetDlg;t.initByVo(p.ItemUtils.getItemVoById(this.needItemId)),t.popup()},t}(ui.role.Govern.Page.GovernPageUI);e.GovernPageN=I}),define("src/g/role/ctrl/Govern/GovernPageNCtrl",["require","exports","src/g/role/view/Govern/GovernPageN","../../../../core/E","../../../../enum/EventName","../../../net/messages/OpResultType","../../../../manager/RoleCenter","src/g/role/vo/GovernStruct","../../../../manager/TipManager","../../../net/messages/PropFightMain","../../../../plugin/sbkPropTool","../../../../vo/RedDot/role/RedDot_Govern","../../../../vo/RedDot/EventRedDot","src/init/ResManager"],function(t,e,i,a,r,n,l,h,o,c,u,p,d,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(){function t(){this.nSPos=0}return t.prototype.init=function(){this._view||(this._view=new i.GovernPageN,l.RoleCenter.instans.on(n.enumOpResultType.zhuzai_activation+"",this,this.onJiHuo),l.RoleCenter.instans.on(n.enumOpResultType.zhuzai_upLv+"",this,this.onUpLv),l.RoleCenter.instans.on(n.enumOpResultType.zhuzai_upStar+"",this,this.onUpStage),a.E.ins.on(r.EventName.GOVERN_CHANGEITEMIDX,this,this.onChangeIdx))},t.prototype.onChangeIdx=function(t){this.nSPos=t},t.prototype.changeType=function(t){void 0===t&&(t=!1),this._view&&this._view.changePageType(t)},t.prototype.onJiHuo=function(t){var e=t.reservedata,i=l.RoleCenter.instans.vo,n=i.getOpenHeroByIdx(e[0]);n.zhuzai.activationArr[e[1]-1]=1,n.zhuzai.lvArr[e[1]-1]=e[2];var s=h.GovernStruct.Ins.getGovernVo(e[1],e[2]);i.chgItemCount(parseInt(s.activationcost[0][0]),0-s.activationcost[0][1]),o.TipManager.showType2Tip(e[1]-1+121),n.prop_zhuzai[e[1]-1]=new c.PropZhuZai,u.sbkPropTool.reSetProp(n.prop_zhuzai[e[1]-1],s.prop),n.combat=n.reCheckComBat(),i.combat=i.reCheckComBat(),l.RoleCenter.instans.event(r.EventName.FIGHT_UP,e[3]),this.refreshData()},t.prototype.onUpLv=function(t){this._view.stopAni("upLv");var e=t.reservedata,i=l.RoleCenter.instans.vo,n=i.getOpenHeroByIdx(e[0]);if(n.zhuzai.activationArr[e[1]-1],this._view&&this._view.playUpLvAni(e[1]-1),0==e[3]?(this._view.stopAni("upLvOk"),this._view.playAni("upLvFail",35)):(this._view.stopAni("upLvFail"),this._view.playAni("upLvOk",8,1.3,1.3),n.zhuzai.lvArr[e[1]-1]=e[2]),0!=e[3]){var s=h.GovernStruct.Ins.getGovernVo(e[1],e[2]);n.prop_zhuzai[e[1]-1]=new c.PropZhuZai,u.sbkPropTool.reSetProp(n.prop_zhuzai[e[1]-1],s.prop),n.combat=n.reCheckComBat(),i.combat=i.reCheckComBat(),l.RoleCenter.instans.event(r.EventName.FIGHT_UP,e[3])}var o=h.GovernStruct.Ins.getGovernVo(e[1],n.zhuzai.lvArr[e[1]-1]);0==o.cost.length&&(o=h.GovernStruct.Ins.getGovernVo(e[1],99)),i.chgItemCount(parseInt(o.cost[0][0]),0-o.cost[0][1]),this.refreshData()},t.prototype.onUpStage=function(t){var e=t.reservedata,i=l.RoleCenter.instans.vo,n=i.getOpenHeroByIdx(e[0]),s=h.GovernStruct.Ins.getGovernVo(e[1],n.zhuzai.lvArr[e[1]-1]);n.zhuzai.lvArr[e[1]-1]=e[2];var o=h.GovernStruct.Ins.getGovernVo(e[1],e[2]);this._view,n.prop_zhuzai[e[1]-1]=new c.PropZhuZai,u.sbkPropTool.reSetProp(n.prop_zhuzai[e[1]-1],o.prop),n.combat=n.reCheckComBat(),i.combat=i.reCheckComBat(),l.RoleCenter.instans.event(r.EventName.FIGHT_UP,e[3]),i.chgItemCount(parseInt(s.advanced[0][0]),0-s.advanced[0][1]),p.RedDot_Govern.Ins.checkAll(),a.E.ins.event(d.EventRedDot.REFRESH_ROLE),a.E.ins.event(d.EventRedDot.REFRESH_EQUIP),this.refreshData()},t.prototype.showPage=function(t,e){t.removeChildren(),this.init(),this.nSPos=e,this.refreshData(),t.addChild(this._view),s.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t){this.init(),this._view.changeHero(t),this.refreshData()},t.prototype.refreshData=function(){this._view.changeSelect(this.nSPos)},t.prototype.getTitle=function(){return"res/role/govern/wenzi_zhuzaitaozhuang.png"},t.prototype.hidePage=function(){s.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){s.ResManager.getInstance().destroyPageCtrl(this)},t}();e.GovernPageNCtrl=g}),define("src/g/role/ctrl/Govern/GGovernCtrl",["require","exports","src/g/base/BaseCtrl","../../../../manager/LayerManager","src/g/role/ctrl/Govern/GovernResloveCtrl","../../../../manager/RoleCenter","../../../../core/E","../../../../enum/EventName","src/g/role/view/Govern/GGovernView","../../../../vo/RedDot/role/RedDot_Govern","../../../../vo/RedDot/EventRedDot","src/g/role/ctrl/Govern/GovernPageNCtrl","src/init/Switches","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(e){function t(){var t=e.call(this)||this;return t._nowSelectHero=0,t._selectPos=0,t._pos=0,t._heroIdx=0,t.urls=["res/atlas/res/role/govern.json"],a.E.ins.on(r.EventName.OPENNEW_HERO,t,t.openNewHero),a.E.ins.on(r.EventName.CHANGEITEM_COUNT,t,t.onChangeItem),a.E.ins.on(r.EventName.ADDED_ZHUANSHENG,t,t.refreshData),p.Switches.ins.on(51,t,t.showView),t}return __extends(t,e),t.prototype.onChangeItem=function(t){121<=t&&t<=126&&this.refreshData()},t.prototype.refreshData=function(){null!=this._view&&null!=this._page&&(h.RedDot_Govern.Ins.checkAll(),this._page.changePerson(this._nowSelectHero),this.refreshRedDot(),a.E.ins.event(c.EventRedDot.REFRESH_EQUIP))},t.prototype.refreshRedDot=function(){if(null!=this._view)switch(this._view.tab_page.selectedIndex){case 0:this._view.tab_head.refreshHeadRedHint(h.RedDot_Govern.Ins.getUpLvAndActive());break;case 1:this._view.tab_head.refreshHeadRedHint(h.RedDot_Govern.Ins.getUpStage())}},t.prototype.openNewHero=function(){this._view&&this._view.tab_head.initData(o.RoleCenter.instans.self.openhero,this._nowSelectHero,o.RoleCenter.instans.vo)},t.prototype.init=function(){this._view=new l.GGovernView,this._ngovernUp=new u.GovernPageNCtrl,this._resolve=new s.GovernResliveCtrl,this._view.tab_head.initData(o.RoleCenter.instans.self.openhero,0,o.RoleCenter.instans.vo),this._view.bgView.btn_help.visible=!1,o.RoleCenter.instans.vo.heronum<3&&(a.E.ins.on(r.EventName.ADDED_LEVEL,this,this.openNewHero),a.E.ins.on(r.EventName.ADDED_ZHUANSHENG,this,this.openNewHero),a.E.ins.on(r.EventName.VIP_EXP_CHANGED,this,this.openNewHero)),this.addEvent()},t.prototype.addEvent=function(){this._view.tab_head.setCallbackHandler(new Laya.Handler(this,this.HeroSelect)),this._view.tab_page.selectHandler=new Laya.Handler(this,this.changePage),this._view.bgView.btn_back.on(Laya.Event.CLICK,this,this.hideView),this._view.bgView.btn_close.on(Laya.Event.CLICK,this,this.hideView),a.E.ins.on(r.EventName.GOVERN_CHANGEITEMIDX,this,this.onChangeIdx)},t.prototype.onChangeIdx=function(t){this._selectPos=t},t.prototype.showView=function(t,e){void 0===e&&(e=0),this._pos=t,this._heroIdx=e,this.opens()},t.prototype.onAtlasLoaded=function(){this.realOpenRoleView()},t.prototype.realOpenRoleView=function(){var t=this._pos;this._selectPos=t,this._view||this.init(),this.changePage(0),this._view.tab_page.selectedIndex=0,this.HeroSelect(this._heroIdx,null),this.refreshData(),n.LayerManager.addInPOPWindowLayer(this._view,!1),d.ClearResM.resetViewImg(this._view)},t.prototype.HeroSelect=function(t,e){t+1<=o.RoleCenter.instans.vo.heronum?(this._view.tab_head.setSelectIndex(t),this._nowSelectHero=t,this._ngovernUp.changePerson(t)):p.Switches.ins.event(15)},t.prototype.changePage=function(t){var e=!0;switch(t){case 0:this._ngovernUp.changeType(!0),this._page=this._ngovernUp;break;case 1:this._ngovernUp.changeType(!1),this._page=this._ngovernUp;break;case 2:this._page=this._resolve,e=!1;break;default:return}this._view.tab_head.visible=e,this.refreshData(),this._view.bgView.img_title.skin=this._page.getTitle(),this._page.showPage(this._view.bgView.box_page,this._selectPos),this._page.changePerson(this._nowSelectHero)},t.prototype.hideView=function(){this._view.bgView.box_page.removeChildren(),this._view.removeSelf(),a.E.ins.event(r.EventName.CLOSEVIEW_ZHUZAI)},t}(i.BaseCtrl);e.GGovernCtrl=g}),define("src/g/custom/GMSendMailPage",["require","exports","../../manager/RoleCenter","../net/messages/GM/GM_AddItemC2GS","../../manager/GameSocketManager"],function(t,e,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;return t.btn_sendMail.on(Laya.Event.CLICK,t,t.sendMail),t.btn_close.on(Laya.Event.CLICK,t,t.onBtnClose),t.init(),t}return __extends(t,i),t.prototype.popup=function(t,e){i.prototype.popup.call(this,t,e),this.init()},t.prototype.onBtnClose=function(){this.close()},t.prototype.init=function(){this.inp_selfAcc.text=n.RoleCenter.instans.self.username},t.prototype.sendMail=function(){if(this.inp_Type.text.length){var t=new s.GM_MailC2GS;t.sendType=parseInt(this.inp_Type.text),2<t.sendType||t.sendType<1||(t.username=this.inp_toUserAcc.text,(t.sendType!=s.enumSendMailType.toOneUser||t.username.length)&&(t.title=this.inp_title.text,t.content=this.inp_content.text,t.currencyStr=this.inp_currency.text,t.itemStr=this.inp_item.text,t.equipStr=this.inp_equip.text,o.GSM.sendServer(t)))}},t}(ui.custom.GMSendMailPageUI);e.GMSendMailPage=i}),define("src/g/custom/GMRewardPage",["require","exports","../../manager/GameSocketManager","../net/messages/GM/GM_AddItemGS2C","../net/messages/GM/GM_AddItemC2GS","../../config/GameConfig"],function(t,e,n,s,o,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;return t.btn_open.on(Laya.Event.CLICK,t,t.onBtnOpen),t.btn_close.on(Laya.Event.CLICK,t,t.onBtnClose),t.list_.renderHandler=new Laya.Handler(t,t.listRenderHandler),t.init(),t}return __extends(t,i),t.prototype.popup=function(t,e){i.prototype.popup.call(this,t,e),this.init()},t.prototype.onBtnClose=function(){this.close(),n.GSM.ins.off(s.GM_RewardGS2C.KEY,this,this.balabala)},t.prototype.init=function(){this.list_.array=[],this.txt_content.text="",n.GSM.ins.on(s.GM_RewardGS2C.KEY,this,this.balabala)},t.prototype.onBtnOpen=function(){if(this.inp_id.text.length){var t=new o.GM_RewardC2GS;t.rewardId=parseInt(this.inp_id.text),t.count=this.inp_count.text.length?parseInt(this.inp_count.text):1,n.GSM.sendServer(t)}else this.lab_err.text="id不填，你查个P"},t.prototype.balabala=function(t){if(0==t.opresult)this.lab_err.text=t.error,this.list_.array=[],this.txt_content.text="";else{this.lab_err.text="你猜会出啥错误";var e,i,n,s,o=t.inventory,a=0,r=[];for(a=0;a<o.currencyList.length;a++){var l=o.currencyList[a];r.push("属性 : "+l.key+",值："+l.val)}for(a=0;a<o.itemList.length;a+=2)if(o.itemList[a]<1e4){if(!(e=u.GameConfig.itemJSON[o.itemList[a]])){r.push("道具表未找到id : "+o.itemList[a]);continue}r.push("ID:"+e.id+",NAME:"+e.name+",Num:"+o.itemList[a+1]+"\n")}else r.push("ID:"+o.itemList[a]+",NAME:看id想道具,Num:"+o.itemList[a+1]+"\n");for(a=0;a<o.equipList.length;a++){var h=o.equipList[a].equtemplet;if(o.equipList[a].equtemplet<4e4){if(!(i=u.GameConfig.equipJSON[h])){r.push("装备表未找到id : "+h);continue}r.push("ID:"+i.id+",NAME:"+i.name+",Num:1,品质:"+i.quality+"\n")}else if(o.equipList[a].equtemplet<5e4){if(!(n=u.GameConfig.wingEquipJSON[h])){r.push("神羽装备表未找到id : "+h);continue}r.push("ID:"+n.id+",NAME:"+n.name+",Num:1,品质:"+n.quality+"\n")}else if(o.equipList[a].equtemplet<6e4){if(!(s=u.GameConfig.rexue_equip[h])){r.push("热血装备表未找到id : "+h);continue}r.push("ID:"+s.id+",NAME:"+s.name+",Num:1,品质:"+s.quality+"\n")}else if(o.equipList[a].equtemplet<7e4){if(!(s=u.GameConfig.xwequip[h])){r.push("王者装备表未找到id : "+h);continue}r.push("ID:"+s.id+",NAME:"+s.name+",Num:1,品质:"+s.quality+"\n")}}this.txt_content.text="";var c=r.length;for(a=0;a<c;)this.txt_content.text+=r[a],a++}},t.prototype.listRenderHandler=function(t,e){t.dataSource&&(t.getChildByName("label").text=t.dataSource)},t}(ui.custom.GMRewardPageUI);e.GMRewardPage=i}),define("src/g/custom/GMHornMsgPage",["require","exports","../../manager/GameSocketManager","../net/messages/GM/GM_AddItemC2GS"],function(t,e,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;return t.btn_send.on(Laya.Event.CLICK,t,t.onBtnSend),t.btn_close.on(Laya.Event.CLICK,t,t.onBtnClose),t.init(),t}return __extends(t,i),t.prototype.popup=function(t,e){i.prototype.popup.call(this,t,e),this.init()},t.prototype.onBtnClose=function(){this.close()},t.prototype.init=function(){this.lab_err.text="你猜会出啥错误"},t.prototype.onBtnSend=function(){var t=new o.GM_NHMC2GS;t.interval=parseInt(this.ipt_interval.text),t.str=this.ipt_msg.text;var e=this.ipt_st.text;if("0"==e||19==e.length){if(19==e.length){var i=new Date(e);t.startTime=i.getTime()/1e3>>0}if(t.startTime==t.interval&&0==t.interval)t.endTime=86400+(Date.now()/1e3>>0);else{if((e=this.ipt_et.text).length&&19!=e.length)return void(this.lab_err.text="结束时间错误");if(19==e.length){var n=new Date(e);t.endTime=n.getTime()/1e3>>0}}s.GSM.sendServer(t),this.lab_err.text="你猜会出啥错误"}else this.lab_err.text="开始时间错误"},t}(ui.custom.GMHornMsgPageUI);e.GMHornMsgPage=i}),define("src/g/custom/GMRedBagPage",["require","exports","../../manager/GameSocketManager","../../utils/system/FloatEffect","../net/messages/redbag/RedBagGS2C","../net/messages/GM/GM_AddItemC2GS","../../plugin/view/ToolTip"],function(t,e,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;return t.redIdArr=[],n.GSM.ins.on(o.RedBagGS2C.KEY,t,t.onRedBag),t.btn_send.on(Laya.Event.CLICK,t,t.onBtnSend),t.btn_close.on(Laya.Event.CLICK,t,t.onBtnClose),t.btn_get.on(Laya.Event.CLICK,t,t.onGetRed),t.init(),t}return __extends(t,i),t.prototype.popup=function(t,e){i.prototype.popup.call(this,t,e),this.init()},t.prototype.onBtnClose=function(){this.close()},t.prototype.init=function(){this.lab_err.text="你猜会出啥错误"},t.prototype.onBtnSend=function(){var t=new a.GM_RedBagC2GS;if(t.type=parseInt(this.ipt_type.text),1==t.type||2==t.type)if(t.total=parseInt(this.ipt_total.text),t.num=parseInt(this.ipt_num.text),65535<t.num)this.lab_err.text="红包数量太多啦！";else{var e=this.ipt_st.text;if(e.length&&"0"!=e&&19!=e.length)this.lab_err.text="开始时间错误啦！";else{if(19==e.length){var i=new Date(e);t.startTime=i.getTime()/1e3>>0}else 0==e.length&&(t.startTime=0);n.GSM.sendServer(t),this.lab_err.text="你猜会出啥错误"}}else this.lab_err.text="红包类型错啦！"},t.prototype.onRedBag=function(t){console.info("收到一个可领取的红包 id : "+t.redId),this.ipt_redid.text=t.redId+""},t.prototype.onGetRed=function(){s.FE.upItems("抢红包不在这了哈",r.BubbleEnum.center)},t}(ui.custom.GMRedBagPageUI);e.GMRedBagPage=i}),define("src/g/custom/GMActivityPage",["require","exports","../../manager/GameSocketManager","../net/messages/GM/GM_AddItemC2GS","src/g/custom/GMPage","../net/messages/GM/GM_AddItemGS2C","../../manager/RoleCenter","../../config/GameConfig"],function(t,e,s,o,i,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;return t.btn_send.on(Laya.Event.CLICK,t,t.onBtnSend),t.btn_Del.on(Laya.Event.CLICK,t,t.onBtnDel),t.btn_close.on(Laya.Event.CLICK,t,t.onBtnClose),t.btn_setAcT.on(Laya.Event.CLICK,t,t.onSetAct),s.GSM.ins.on(a.GM_GetAcTimeGS2C.KEY,t,t.GM_GetAcTimeGS2C),t.init(),t}return __extends(t,n),t.prototype.popup=function(t,e){n.prototype.popup.call(this,t,e),this.init(),s.GSM.sendServer(new o.GM_GetAcTimeC2GS);var i=[];r.RoleCenter.instans.vo.getActivityData().listArr.forEach(function(t){var e=l.GameConfig.activityJson[t.cfgId];e&&!e.openType&&i.push(t)}),console.info("----当前活动数据----"),console.info(i)},t.prototype.onBtnClose=function(){this.close()},t.prototype.init=function(){this.lab_err.text="你猜会出啥错误"},t.prototype.onBtnSend=function(){var t=new o.GM_AddActitityC2GS,e=this.ipt_st.text;if("0"==e||19==e.length){if(19==e.length){var i=new Date(e);t.startTime=i.getTime()/1e3>>0}if((e=this.ipt_et.text).length&&19!=e.length)this.lab_err.text="结束时间错误";else{if(19==e.length){var n=new Date(e);t.endTime=n.getTime()/1e3>>0}e=this.ipt_type.text,t.cfgId=parseInt(e),s.GSM.sendServer(t),this.lab_err.text="你猜会出啥错误"}}else this.lab_err.text="开始时间错误"},t.prototype.onBtnDel=function(){var t=new o.GM_DelActitityC2GS,e=this.ipt_redid.text;t.id=parseInt(e),s.GSM.sendServer(t)},t.prototype.GM_GetAcTimeGS2C=function(t){this.ipt_svrT.text=this.getDataTime(1e3*t.svrTime),this.ipt_acT.text=this.getDataTime(1e3*t.acTime)},t.prototype.onSetAct=function(){var t=new o.GM_SetAcTimeC2GS,e=new Date(this.ipt_setAcTime.text);i.GMPage.isValidDate(e)?(t.time=e.getTime()/1e3>>0,s.GSM.sendServer(t),this.lab_err.text="你猜会出啥错误"):this.lab_err.text="设置活动时间不合法"},t.prototype.getDataTime=function(t){var e=new Date(t);return this.chkZero(e.getFullYear())+"-"+this.chkZero(e.getMonth()+1)+"-"+this.chkZero(e.getDate())+" "+this.chkZero(e.getHours())+":"+this.chkZero(e.getMinutes())+":"+this.chkZero(e.getSeconds())},t.prototype.chkZero=function(t){return 10<=t?t+"":"0"+t},t}(ui.custom.GMActivityPageUI);e.GMActivityPage=n}),define("src/g/custom/GMPage",["require","exports","../../manager/RoleCenter","../../manager/GameSocketManager","../net/messages/GM/GM_AddItemC2GS","src/g/custom/GMSendMailPage","../net/messages/chat/ChatC2GS","src/g/custom/GMRewardPage","src/g/custom/GMHornMsgPage","src/g/custom/GMRedBagPage","src/g/custom/GMActivityPage","../../core/GNet","src/init/Switches"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.chechGM(),t.btn_send.on(Laya.Event.CLICK,t,t.onSend),t.btn_sendMail.on(Laya.Event.CLICK,t,t.showSendMailPage),t.btn_TestReward.on(Laya.Event.CLICK,t,t.onReward),t.btn_hornMsg.on(Laya.Event.CLICK,t,t.onHorn),t.btn_RedBag.on(Laya.Event.CLICK,t,t.onRedBag),t.btn_Activity.on(Laya.Event.CLICK,t,t.onActivity),t.btn_kickAll.on(Laya.Event.CLICK,t,t.onKickAll),t.btn_KuaTian.on(Laya.Event.CLICK,t,t.onKuaTian),t.btn_find.on(Laya.Event.CLICK,t,t.findRes),window.ktgamepreloadjdk&&(t.gameversion.text=window.ktgamepreloadjdk.gameversion),t}return __extends(t,e),t.prototype.findRes=function(){Laya.Loader.getRes("res/index.png");var t=this.input_txt.text,e=Laya.Loader.loadedMap;for(var i in e)-1<i.indexOf(t)&&console.log(i)},t.prototype.chechGM=function(){if(!i.RoleCenter.instans.self.isGM){var t=new s.GM_ActivateC2GS;t.isActivate=!0,n.GSM.sendServer(t)}},t.prototype.onSend=function(){if("goto"==this.inp_curr.text&&0<this.inp_num.text.length)p.Switches.ins.event(parseInt(this.inp_num.text));else{var t=new s.GM_AddItemC2GS;if(t.count=parseInt(this.inp_num.text),0<this.inp_curr.text.length&&(t.currencyType=this.inp_curr.text),0<this.inp_id.text.length&&(t.cfgId=parseInt(this.inp_id.text)),"closesocket"!=t.currencyType){if(t.count<0)return this.lab_err.text="不支持数量值为负数";if(4294967295<=t.count||t.cfgId&&65535<=t.count)return this.lab_err.text="数量太多啦!";n.GSM.sendServer(t),this.lab_err.text="你猜会出啥错误"}else n.GSM.doClose()}},t.prototype.showSendMailPage=function(){var t=new o.GMSendMailPage;t.popupCenter=!0,t.popup(),this.close("btn_sendMail")},t.prototype.onReward=function(){var t=new r.GMRewardPage;t.popupCenter=!0,t.popup(),this.close("btn_TestReward")},t.prototype.onHorn=function(){var t=new l.GMHornMsgPage;t.popupCenter=!0,t.popup(),this.close("btn_hornMsg")},t.prototype.onRedBag=function(){var t=new h.GMRedBagPage;t.popupCenter=!0,t.popup(),this.close("btn_RedBag")},t.prototype.onActivity=function(){var t=new c.GMActivityPage;t.popupCenter=!0,t.popup(),this.close("btn_Activity")},t.prototype.onKickAll=function(){n.GSM.sendServer(new s.GM_KickAllC2GS)},t.prototype.onKuaTian=function(){u.GNet.chatSend(a.enumChatType.world,"gmstr:nextday")},t.isValidDate=function(t){return t.getTime()==t.getTime()},t}(ui.custom.GMPageUI);e.GMPage=d}),define("src/g/fight/osprite/play/worldboss/GamePlayWorldBoss",["require","exports","src/g/fight/osprite/play/GamePlay","../../../../../manager/RoleCenter","../../../../net/messages/ActivityMessage","../../../../net/messages/UserAttackMsg","../../../../../manager/GameSocketManager","src/g/fight/osprite/NetCtroller","../../../../../core/E","../../../../../enum/EventName","src/g/fight/osprite/obj/FightGroup","src/g/fight/osprite/play/baseplay/SvrHeroUnit","src/g/fight/osprite/play/worldboss/WorldBossManager","../../../../../config/GameConfig","src/g/fight/osprite/play/baseplay/SvrPeopleBossMonster","../../../../../utils/ItemUtils","src/g/fight/osprite/SceneObjCtroller","src/init/Switches","src/g/index/ctrl/BtnSkiilCtrl"],function(t,e,i,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t){var e=n.call(this,t)||this;e._bossFG=null,e._bossTargetFG=null,e._worldBossVo=null,e._portVo=null,e._mapVo=null,e._rageAdd=5,e._rageInitValue=0,e.playSettingVo&&(e._rageAdd=e.playSettingVo.rageAdd,e._rageInitValue=e.playSettingVo.rage),_.BtnSkiilCtrl.ins.autoProcess(e._rageInitValue,e._rageAdd),e._worldBossVo=d.WorldBossManager.getInstance().getSetting(d.WorldBossManager.getInstance().openId),e._portVo=g.GameConfig.getPortByID(e._worldBossVo.port),e._mapVo=g.GameConfig.getMapJSON(e._portVo.boss_scene),h.E.ins.on(c.EventName.EXIT_BOSS_PLAYTYPE,e,e.exitHandler);var i=r.GSM.ins;return i.on(o.UserJoinInActivityGS2C.KEY,e,e.onOtherUserJoinMsg),i.on(o.UserExitActivityGS2C.KEY,e,e.onUserExitMsg),i.on(o.ActivityRebirthGS2C.KEY,e,e.onActivityRebirthGS2C),i.on(a.UserRageChangeGS2C.KEY,e,e.onUserRageChangeGS2C),d.WorldBossManager.getInstance().enterGamePlay(e),e.changeMap(e._worldBossVo.port),e.setJoinSkill(),e}return __extends(t,n),t.prototype.changeMap=function(t){console.log("GamePlayWorldBoss::changeMap"),this.clearEff();var e=g.GameConfig.getPortByID(t);e&&this.scene&&this.scene.changeMap(e.boss_scene)},t.prototype.init=function(t){n.prototype.init.call(this,t),this._bossFG=this.createBossFG(this._portVo.boss),this._bossFG.addToFightLayer(),this._bossFG.resetFightGroup(this._mapVo.bossXY[0]);var e=y.SceneObjCtroller.ins.getSelfGroup();e.resetFightGroup(this.getRandomPos(0)),e.addToFightLayer(),this.setFightGroup(e),e.setOnceTarget(this._bossFG),l.NetCtroller.JoinInQMBossCopy(d.WorldBossManager.getInstance().openId,o.EACT_TYPE.worldBoss)},t.prototype.frameMove=function(){n.prototype.frameMove.call(this),_.BtnSkiilCtrl.ins.frameMove()},t.prototype.clear=function(){n.prototype.clear.call(this),this._bossFG&&(this._bossFG.destroyGroup(!0),this._bossFG=null);var t=r.GSM.ins;t.off(o.UserJoinInActivityGS2C.KEY,this,this.onOtherUserJoinMsg),t.off(o.UserExitActivityGS2C.KEY,this,this.onUserExitMsg),t.off(o.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),t.off(a.UserRageChangeGS2C.KEY,this,this.onUserRageChangeGS2C),h.E.ins.off(c.EventName.EXIT_BOSS_PLAYTYPE,this,this.exitHandler),d.WorldBossManager.getInstance().exitGamePlay()},t.prototype.createBossFG=function(t){var e=new u.FightGroup(null),i=new v.SvrPeopleBossMonster;i.moveModulus=2;var n=f.ItemUtils.getMonsterVOById(t);return n&&i.set_DATA(n),e.addFightUnit(i),e},t.prototype.onJoinInActMsg=function(t){if(console.log("GamePlayWorldBoss::onJoinInActMsg"),t.opresult){var e=null,i=null,n=t.otherUserList;d.WorldBossManager.actid=t.actid;for(var s=0;s<n.length;s++)i=n[s],e=this.createFightGroup(i,this.getRandomPos()),t.userDeathStateList[s]&&e.setDeath(),e.setOnceTarget(this._bossFG);this._bossTargetFG=this._playerDic[t.bossOwner],this._bossTargetFG&&this._bossFG.setOnceTarget(this._bossTargetFG)}else this.returnAutoplayPort()},t.prototype.onOtherUserJoinMsg=function(t){if(t.opresult)for(var e=null,i=t.newuser,n=0;n<i.length;n++)e=i[n],this.createFightGroup(e,this.getRandomPos()).setOnceTarget(this._bossFG);else console.error(JSON.stringify(t))},t.prototype.onUserExitMsg=function(t){if(console.log("GamePlayWorldBoss::onUserExitMsg"),t.opresult){var e=this._playerDic[t.username];e&&this.removePlayerFG(e,!0)}else console.error(t)},t.prototype.createFightGroup=function(t,e){var i=p.SvrHeroUnit.createFightGroup(t,e,!0);return this.addPlayerFG(i),i.addToFightLayer(),i},t.prototype.exitHandler=function(){-1!=d.WorldBossManager.getInstance().openId&&l.NetCtroller.ExitQMBossCopy(d.WorldBossManager.getInstance().openId,o.EACT_TYPE.worldBoss),this.returnAutoplayPort()},t.prototype.getRandomPos=function(t){return void 0===t&&(t=-1),-1==t&&(t=Math.floor(Math.random()*this._mapVo.startPoint.length)),this._mapVo.startPoint[t]},t.prototype.onHpChg=function(t){n.prototype.onHpChg.call(this,t),t.beAttack==s.RoleCenter.instans.self.username&&null==this._mainRole&&d.WorldBossManager.getInstance().showDeadAlert(),""==t.beAttack&&d.WorldBossManager.getInstance().updateBossHp(t.hpAfterAttack)},t.prototype.sendReBorn=function(){var t=f.ItemUtils.getBossSettingVoById(1);if(s.RoleCenter.instans.GOLD<t.revivecdCost)m.Switches.ins.event(155);else{var e=new o.ActivityRebirthC2GS;e.actid=this._worldBossVo.id,e.acttype=o.EACT_TYPE.worldBoss,r.GSM.sendServer(e)}},t.prototype.onActivityRebirthGS2C=function(t){if(t.opresult){var e=this._playerDic[t.userAcc];if(e){var i=null;i=t.userAcc==s.RoleCenter.instans.self.username?this.getRandomPos(0):this.getRandomPos(),e.resetFightGroup(i,!0),e.setOnceTarget(this._bossFG),t.userAcc==s.RoleCenter.instans.self.username&&this.switchRole(!0)}d.WorldBossManager.getInstance().relifeComplete()}else console.error(t.error)},t.prototype.onUserRageChangeGS2C=function(t){_.BtnSkiilCtrl.ins.completeProcess(t.rageVal),this.checkJoinSkill(t)},t.prototype.releaseSkillHandler=function(t){this.releaseSkill(t,"")},t.prototype.onComboHit=function(t){n.prototype.onComboHit.call(this,t),0!=t.comboid&&this._fightGroup&&t.attackAcc==this._fightGroup.groupID&&_.BtnSkiilCtrl.ins.autoProcess(0,this._rageAdd)},t}(i.GamePlay);e.GamePlayWorldBoss=n}),define("src/g/worldboss/view/WorldBossWar",["require","exports","../../../manager/LayerManager","../../../utils/StringUtils"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.mouseThrough=!0,t.width=Laya.stage.width,t.height=Laya.stage.height,t.kuangBaoBox.visible=!1,t.initList(t.crtRankList,t.rankRender,ui.worldboss.WorldBossCtrRankItemUI),t}return __extends(t,e),t.prototype.initList=function(t,e,i){t.selectEnable=!0,t.vScrollBarSkin="",t.itemRender=i,t.scrollBar.elasticDistance=100,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.initHtmlStyle=function(t,e,i){t.style.color=e,t.style.font="SimHei",t.style.fontSize=i},t.prototype.rankRender=function(t,e){var i=t.dataSource;switch(e){case 0:t.imgRank.skin="res/hotbloodtemple/rxsd_paihangtubiao1.png";break;case 1:t.imgRank.skin="res/hotbloodtemple/rxsd_paihangtubiao2.png";break;case 2:t.imgRank.skin="res/hotbloodtemple/rxsd_paihangtubiao3.png";break;default:t.imgRank.skin="",t.lbRank.text=(e+1).toString()}t.lbName.text=i.fname,t.lbHurt.text=n.StringUtils.moneyNumToString(i.totalHurt)},t.prototype.showView=function(){i.LayerManager.addInUILayer(this)},t.prototype.updJoinPlayerNum=function(t){},t.prototype.hideView=function(){},t.prototype.destroyView=function(){this.destroy()},t}(ui.worldboss.WorldBossWarUI);e.WorldBossWar=s}),define("src/g/worldboss/ctrl/WorldBossInspireCtrl",["require","exports","src/g/fight/osprite/play/worldboss/WorldBossManager","src/g/account/view/AccItem","../../../utils/ItemDropUtil","../../../core/E","../../../enum/EventName","../../../utils/SoundUtils","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function t(){o.E.ins.on(a.EventName.OPEN_WORLDBOSS_INSPIRE,this,this.showView)}return t.prototype.showView=function(){null==this.view&&(this.view=new ui.worldboss.WorldBossInspireUI,this.view.closeHandler=Laya.Handler.create(this,this.distoryView),this.view.bg.btn_close.visible=!1,this.view.bg.innerGround.bottom=94,this.initHtmlStyle(this.view.inspireDes,"#a89e8f",18),this.initHtmlStyle(this.view.crtAddHurt,"#a89e8f",18),this.initHtmlStyle(this.view.leftInspireTime,"#a89e8f",18),this.view.inspireButton.on(Laya.Event.CLICK,this,this.inspireHander),this.reward=new n.AccItem,this.reward.x=201,this.reward.y=205,this.reward.scale(1.1,1.1),this.view.addChild(this.reward),this.initDisplay()),this.view.popup()},t.prototype.initHtmlStyle=function(t,e,i){t.style.color=e,t.style.font="SimHei",t.style.fontSize=i,t.style.align="center"},t.prototype.initDisplay=function(){var t=i.WorldBossManager.getInstance().getSetting(i.WorldBossManager.getInstance().openId);this.view.inspireDes.innerHTML=l.TextConst.get(781,t.addATT,t.addATT*t.familytimes);var e=s.ItemDropUtil.createPortRewardData(t.cheerReward,!0);e&&0<e.length&&(this.reward.eqData=e[0],this.reward.lv_txt.text=""),this.updInspireNum()},t.prototype.updFamilyTotalHurt=function(t){this.ftotalHurt=t,console.log("总伤害输出"+t),this.view&&(this.view.crtAddHurt.innerHTML=l.TextConst.get(782,this.ftotalHurt))},t.prototype.updInspireNum=function(){if(this.view){var t=i.WorldBossManager.getInstance().getSetting(i.WorldBossManager.getInstance().openId),e=i.WorldBossManager.getInstance().getSelfInspireNum();e==t.persontimes?(this.view.inspireButton.disabled=!0,this.view.leftInspireTime.innerHTML=l.TextConst.get(862,"#ff0000",e,t.persontimes)):(this.view.inspireButton.disabled=!1,this.view.leftInspireTime.innerHTML=l.TextConst.get(862,"#09d51f",e,t.persontimes)),i.WorldBossManager.getInstance().getSelfInspireNum()<5?(this.view.lbMoneyCost.visible=this.view.imgYuanBao.visible=!0,this.view.lbMoneyCost.text=t.price[i.WorldBossManager.getInstance().getSelfInspireNum()].toString()):this.view.lbMoneyCost.visible=this.view.imgYuanBao.visible=!1}},t.prototype.inspireHander=function(){r.SoundUtils.getInstance().playBtnsounds(),i.WorldBossManager.getInstance().sendWBInspireC2GS()},t.prototype.onInspireSuc=function(){this.updInspireNum()},t.prototype.distoryView=function(){r.SoundUtils.getInstance().playBtnsounds(),this.view&&(this.reward.destroy(!0),this.view.inspireButton.off(Laya.Event.CLICK,this,this.inspireHander),this.view.closeHandler=null,this.view.destroy(),this.view=null),Laya.loader.clearRes("res/worldboss/rexue_boss_zhuweibiaoti.png")},t}();e.WorldBossInspireCtrl=h}),define("src/g/worldboss/view/WorldBossResult",["require","exports","src/g/account/view/AccItem"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.initList(t.rewardList,t.rewardRender,i.AccItem),t.initHtmlStyle(t.hurtRank,"#e1a32a",18),t.initHtmlStyle(t.hurPeople,"#e1a32a",18),t.initHtmlStyle(t.familyRewardLimit,"#09d51f",18),t}return __extends(t,e),t.prototype.initHtmlStyle=function(t,e,i){t.style.color=e,t.style.font="SimHei",t.style.fontSize=i,t.style.align="center"},t.prototype.initList=function(t,e,i){t.itemRender=i,t.selectEnable=!0,t.vScrollBarSkin="",t.scrollBar.elasticDistance=100,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.rewardRender=function(t,e){t.eqData=this.rewardList.array[e]},t.prototype.showView=function(){this.popup(),this.imgEffect.rotation=0,Laya.timer.loop(120,this,this.updEffectDisplay)},t.prototype.updEffectDisplay=function(){this.imgEffect.rotation+=10,console.log("计算还在转圈")},t.prototype.destroyView=function(){this.destroy(!0)},t}(ui.worldboss.WorldBossResultUI);e.WorldBossResult=n}),define("src/g/worldboss/ctrl/WorldBossResultCtrl",["require","exports","src/g/worldboss/view/WorldBossResult","src/g/fight/osprite/play/worldboss/WorldBossManager","../../../utils/ItemUtils","../../../meta/CommonVo","../../../utils/ItemDropUtil","../../../utils/CountDown","../../../utils/system/ServerTime","../../../utils/SoundUtils","src/init/TextConst"],function(t,e,s,i,n,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){this.countDown=new r.CountDown}return t.prototype.onWarEnd=function(t){if(null==this.view){if(this.view=new s.WorldBossResult,this.setBoss(),this.view.hurtRank.innerHTML=c.TextConst.get(845,t.rankIdx),this.view.hurPeople.innerHTML=c.TextConst.get(846,t.inActUserNum),t.getReward)this.view.familyRewardLimit.visible=!1,this.view.lbRewardDes.text=c.TextConst.get(849),this.view.rewardList.array=a.ItemDropUtil.createRewardList(t.invent);else{this.view.familyRewardLimit.visible=!0,this.view.lbRewardDes.text=c.TextConst.get(847);var e=o.CommonVo.getVoByKey("worldbossNeedPerson");e&&(this.view.familyRewardLimit.innerHTML=c.TextConst.get(848,e.value))}var i=o.CommonVo.getVoByKey("jiesuandaojishi"),n=null!=i?Number(i.value):5;0<n&&this.countDown.start(l.ServerTime.serverTime+n,this.updCountDownHander,this),this.view.closeHandler=Laya.Handler.create(this,this.destoryView),this.view.getChildByName("close").on(Laya.Event.CLICK,this,this.onClickCloseBtn),this.view.showView()}},t.prototype.setBoss=function(){var t=i.WorldBossManager.getInstance().getSetting(i.WorldBossManager.getInstance().openId),e=n.ItemUtils.getBossVoByPortId(t.port);e&&(this.view.imgBossHead.skin=n.ItemUtils.getBossIconByPort(e.port),this.view.lbBossName.text=e.name)},t.prototype.updCountDownHander=function(t){this.view.getChildByName("close").label=c.TextConst.get(244,t),0==t&&this.view.close()},t.prototype.onClickCloseBtn=function(){h.SoundUtils.getInstance().playBtnsounds()},t.prototype.destoryView=function(){this.countDown.stop(),this.view.closeHandler=null,this.view.destroyView(),this.view=null,i.WorldBossManager.getInstance().exitWorldBoss()},t}();e.WorldBossResultCtrl=u}),define("src/g/worldboss/ctrl/Death",["require","exports","../../../utils/CountDown","../../../utils/system/ServerTime","src/init/TextConst"],function(t,e,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(t){void 0===t&&(t=o.TextConst.get(933));var e=i.call(this)||this;return e.cd=new n.CountDown,e.btnLabel.text=t,e.fuhuoButton.on(Laya.Event.CLICK,e,e.fuhuoHander),e.deathDes2.style.font="SimHei",e.deathDes2.style.align="center",e.deathDes2.style.color="#e3cca9",e.deathDes2.style.stroke=1,e.deathDes2.style.strokeColor="#0d0500",e.deathDes2.style.fontSize=24,e}return __extends(t,i),t.prototype.start=function(t,e,i,n){this.fuhuoCost.text=n.toString(),this.fuhuoCallBack=e,this.deathDes2.innerHTML=o.TextConst.get(290,t),this.cd.start(s.ServerTime.serverTime+i,this.updCdHander,this)},t.prototype.updCdHander=function(t){this.fuhuoCD.changeText(o.TextConst.get(36,t))},t.prototype.fuhuoHander=function(){this.fuhuoCallBack&&this.fuhuoCallBack.run()},t.prototype.close=function(){this.cd.stop(),this.fuhuoCallBack=null,this.removeSelf()},t}(ui.worldboss.DeathUI);e.Death=i}),define("src/g/worldboss/ctrl/WorldBossWarCtrl",["require","exports","src/g/worldboss/view/WorldBossWar","../../../core/E","../../../enum/EventName","src/g/fight/osprite/play/worldboss/WorldBossManager","../../../utils/StringUtils","../../net/messages/chat/ChatGS2C","../../net/messages/chat/ChatC2GS","../../../utils/ItemUtils","src/g/worldboss/ctrl/WorldBossInspireCtrl","../../../utils/SoundUtils","src/g/worldboss/ctrl/WorldBossResultCtrl","../../../config/GameConfig","src/g/worldboss/ctrl/Death","../../../utils/CountDown","../../../utils/system/ServerTime","../../../manager/GameSocketManager","../../net/messages/LuckyUserMsg","../../../manager/RoleCenter","src/init/TextConst","../../net/messages/ActivityMessage","../../../meta/CommonVo"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var w=function(){function t(){this._bossMaxHp=100,n.E.ins.on(s.EventName.ENTER_WORLDBOSS_WAR,this,this.show),this.inspireCtrl=new c.WorldBossInspireCtrl,this.resultCtrl=new p.WorldBossResultCtrl,this.kuangBaoCd=new v.CountDown}return t.prototype.show=function(){if(null==this.view){this.view=new i.WorldBossWar,this.view.showView(),this.setBoss(),this.view.helpLink.on(Laya.Event.CLICK,this,this.helpLinkHander),this.view.inspireButton.on(Laya.Event.CLICK,this,this.inspireHander);var t=y.GSM.ins;t.on(m.LuckyUserStartGS2C.KEY,this,this.onLuckyUserStartGS2C),t.on(m.LuckyPTGenGS2C.KEY,this,this.onLuckyPTGenGS2C)}o.WorldBossManager.getInstance().viewCtrl=this},t.prototype.onLuckyUserStartGS2C=function(t){if(this.view){var e=!1,i=b.CommonVo.getVoByKey("automaticroll").value,n=Number(i);_.RoleCenter.instans.vo.VIP>=n&&(e=!0),this.view.view_lucky.show4Time(t.luckytime,e),this.view.view_lucky.setClickHander(Laya.Handler.create(this,this.onSendLuckyGen))}},t.prototype.onSendLuckyGen=function(){var t=new m.LuckyPTGenC2GS;t.acttype=I.EACT_TYPE.worldBoss,t.actid=o.WorldBossManager.actid,y.GSM.sendServer(t)},t.prototype.onLuckyPTGenGS2C=function(t){if(t.opresult){t.nickname==_.RoleCenter.instans.vo.nickname&&this.view.view_lucky.showLuckyNum(t.luckypt);var e=new r.ChatGS2C;e.type=l.enumChatType.system,e.msg=C.TextConst.get(806,t.nickname,t.luckypt),n.E.ins.event(s.EventName.SEND_UNREAL_CHAT,[e])}},t.prototype.updMyFamilyHurt=function(t,e){this.view&&(this.view.familyHurt.text=a.StringUtils.moneyNumToString(t)),this.inspireCtrl.updFamilyTotalHurt(e)},t.prototype.setBoss=function(){var t=o.WorldBossManager.getInstance().getSetting(o.WorldBossManager.getInstance().openId),e=h.ItemUtils.getBossVoByPortId(t.port);this._bossMaxHp=100;var i=d.GameConfig.getPortByID(t.port);if(i){var n=h.ItemUtils.getMonsterVOById(i.boss);n&&(this._bossMaxHp=n.HP)}this.updateHpProgress(1),this.view&&e&&(this.view.imgBossHead.skin=h.ItemUtils.getBossIconByPort(e.port),this.view.lbBossName.text=e.name)},t.prototype.getBossVo=function(){var t=o.WorldBossManager.getInstance().getSetting(o.WorldBossManager.getInstance().openId);return h.ItemUtils.getBossVoByPortId(t.port)},t.prototype.updateHpProgress=function(t){this.view&&(this.view.progress_txt.changeText((100*t>>0)+"%"),this.view.progressBar.scaleX=Math.max(0,Math.min(1,t)))},t.prototype.updJoinPlayerNum=function(t){this.view&&(this.view.joinPlayerNum.text=t.toString())},t.prototype.updRankList=function(t){this.view&&(this.view.crtRankList.array=t.sort(this.sortByHurt))},t.prototype.sortByHurt=function(t,e){return-(t.totalHurt-e.totalHurt)},t.prototype.helpLinkHander=function(){var t=new r.ChatGS2C;t.type=l.enumChatType.family;t.msg="@8@#",n.E.ins.event(s.EventName.SEND_CHAT,["@8@#",l.enumChatType.family])},t.prototype.inspireHander=function(){u.SoundUtils.getInstance().playBtnsounds(),n.E.ins.event(s.EventName.OPEN_WORLDBOSS_INSPIRE)},t.prototype.onInspireSuc=function(){this.inspireCtrl.onInspireSuc()},t.prototype.onWarEnd=function(t){this.resultCtrl.onWarEnd(t)},t.prototype.onDeath=function(t){null==this.death&&(this.death=new g.Death),this.view.addChild(this.death),this.death.centerX=0,this.death.bottom=330;var e=this.getBossVo().name,i=h.ItemUtils.getBossSettingVoById(1);this.death.start(e,t,i.revivecd,i.revivecdCost)},t.prototype.startSkillCountDown=function(t){this.view&&(this.view.kuangBaoBox.visible=!0,this.kuangBaoCd.start(t+f.ServerTime.serverTime,this.updKBCountDown,this))},t.prototype.updKBCountDown=function(t){this.view&&(0!=t?this.view.kuangBaoBox.imgSecond.value=t.toString():this.view.kuangBaoBox.visible=!1)},t.prototype.onRelife=function(){this.closeDeath()},t.prototype.closeDeath=function(){this.death&&this.death.close()},t.prototype.exit=function(){this.kuangBaoCd.stop(),this.closeDeath(),this.death=null,this.view.helpLink.off(Laya.Event.CLICK,this,this.helpLinkHander),this.view.inspireButton.off(Laya.Event.CLICK,this,this.inspireHander),this.view.removeSelf(),this.view.destroyView(),this.view=null,Laya.loader.clearRes("res/worldboss/rexue_zhandouwenzi.png"),Laya.loader.clearRes("res/worldboss/rexue_zhuwei.png");var t=y.GSM.ins;t.off(m.LuckyUserStartGS2C.KEY,this,this.onLuckyUserStartGS2C),t.off(m.LuckyPTGenGS2C.KEY,this,this.onLuckyPTGenGS2C)},t}();e.WorldBossWarCtrl=w}),define("src/g/base/GameBaseCtrl",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.url=""}return t.prototype.openView=function(){Laya.loader.getRes(this.url)?this.completeHandler():Laya.loader.load([{url:this.url,type:Laya.Loader.ATLAS,priority:0}],Laya.Handler.create(this,this.completeHandler))},t.prototype.completeHandler=function(){},t}();e.GameBaseCtrl=i}),define("src/g/activity/view/NewActivityBtn",["require","exports","../../../manager/RoleCenter","../../../config/GameConfig","src/g/Effects/UIEffectsFactory","../../../enum/EventName","../../../core/E"],function(t,e,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(t){var e=i.call(this)||this;return e._activityId=t,e.init(),e}return __extends(t,i),Object.defineProperty(t.prototype,"activityId",{get:function(){return this._activityId},enumerable:!0,configurable:!0}),t.prototype.init=function(){var t=n.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=s.GameConfig.activityJson[t.cfgId];e&&(e.showEffect&&o.UIEffectsFactory.Ins.createSAniAndCenter(this.effect_con,41),this.img.skin="dynamic/activity/"+e.button+".png"),this.img_red.visible=t.hasRed,this.effect_con.visible=t.hasRed,r.E.ins.on(a.EventName.ACTIVITY_RED_UPDATE,this,this.onActivityRedUpdata)}},t.prototype.onActivityRedUpdata=function(t){if(t==this._activityId){var e=n.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&(this.img_red.visible=e.hasRed,this.effect_con.visible=e.hasRed)}},t.prototype.destroy=function(){this.effect_con.removeChildren(),this.offAll(),r.E.ins.off(a.EventName.ACTIVITY_HALL_RED_UPDATE,this,this.onActivityRedUpdata),i.prototype.destroy.call(this)},Object.defineProperty(t.prototype,"selected",{get:function(){return this.selectImg.visible},set:function(t){this.selectImg.visible=t},enumerable:!0,configurable:!0}),t}(ui.activity.ActivityBtnUI);e.NewActivityBtn=i}),define("src/g/activity/interface/IActivityPage",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),define("src/g/activity/view/item/LevelItem",["require","exports","../../../../manager/GameSocketManager","../../../net/messages/activity/ActivityGet","../../../../config/GameConfig","../../../../utils/ItemUtils","../../../net/messages/enumStatus","src/g/Effects/UIEffectsFactory","src/g/peronboss/view/ItemIconView","../../../../manager/AM","../../../../manager/RoleCenter","src/init/TextConst"],function(t,e,i,n,c,u,p,d,g,s,o,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.getHandlerLevel),t}return __extends(t,e),t.prototype.getHandlerLevel=function(){if(o.RoleCenter.instans.bagRoomEnough()){if(this._data.status==p.enumStatus.kelingqu){var t=new n.ActivityGetC2GS;t.id=this._sbkActivity1Data.id,t.activity2CfgId=this._data.cfgId,i.GSM.sendServer(t)}}else s.AM.showBagNotEnough()},t.prototype.setData=function(t,e){this._sbkActivity1Data=e,this._data=t;var i=c.GameConfig.subActivityJson[t.cfgId];this.desc_txt.text=i.title;var n=this.icon_state.visible=!1;t.status==p.enumStatus.weiwancheng?(this.btn_get.visible=!0,this.btn_get.disabled=!0,this.btn_get.label=v.TextConst.get(210)):t.status==p.enumStatus.kelingqu?(this.btn_get.disabled=!1,this.btn_get.label=v.TextConst.get(216),n=this.btn_get.visible=!0):(this.btn_get.visible=!1,this.icon_state.visible=!0),n?(this.ani||(this.ani=d.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_get.getChildIndex(this.ani)&&d.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_get),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_get.getChildIndex(this.ani)&&this.btn_get.removeChild(this.ani));var s=i.bonus,o=s.length;this.item0.visible=!1,this.item1.visible=!1,this.item2.visible=!1,this.item3.visible=!1;for(var a=0;a<o;a++){this["item"+a].visible=!0;var r=s[a][0],l=s[a][1],h=u.ItemUtils.getItemOrEq(r);g.ItemIconView.setItemData(h,this["item"+a],l)}},t}(ui.activity.item.LevelItemUI);e.LevelItem=a}),define("src/g/activity/view/pages/Level_Compete",["require","exports","../../../../manager/GameSocketManager","../../../../core/E","../../../../enum/EventName","src/g/activity/view/item/LevelItem","../../../net/messages/activity/ActivityGet","../../../net/messages/enumStatus","../../../../utils/system/DateUitl","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/system/ServerTime","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=100,t.list.itemRender=o.LevelItem,t.list.renderHandler=new Laya.Handler(t,t.rendHandler),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,t,t.processHandler),i.GSM.ins.on(a.ActivityGetGS2C.KEY,t,t.onActivityGetHandler),t}return __extends(t,e),t.prototype.processHandler=function(){this.updateHandler()},t.prototype.onActivityGetHandler=function(t){if(t.opresult&&this._data.id==t.id){for(var e=this._data.children,i=0;i<e.length;i++){var n=e[i];if(n.cfgId==t.activity2CfgId){n.status=r.enumStatus.yilingqu;break}}this.updateHandler()}},t.prototype.updateHandler=function(){for(var t=[],e=[],i=0;i<this._data.children.length;i++){var n=this._data.children[i];n.status==r.enumStatus.yilingqu?t.push(n):e.push(n)}e=e.concat(t),this.list.array=e},t.prototype.rendHandler=function(t,e){t.setData(this.list.array[e],this._data)},t.prototype.showView=function(t,e){this.title_image.skin="dynamic/activity/level_compete/"+e.bg_img+".png",this._data=t,this.time_txt.changeText(l.DateUtil.remainingTimeStr(t.rewardTime-u.ServerTime.serverTime)),this.desc_txt.text=e.desc,this.updateHandler()},t.prototype.showPage=function(t,e){if(this._activityId!=t){this._activityId=t;var i=h.RoleCenter.instans.vo.getActivity1Data(t),n=c.GameConfig.activityJson[i.cfgId];this.showView(i,n)}else p.ClearResM.resetViewImg(this);e.addChild(this)},t.prototype.getActivityId=function(){return this._activityId},t.prototype.refresh=function(){},t.prototype.hidePage=function(){this.removeSelf(),p.ClearResM.clearFolderByUrl("dynamic/activity/kill_boss/")},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.processHandler),i.GSM.ins.off(a.ActivityGetGS2C.KEY,this,this.onActivityGetHandler),this.hidePage(),e.prototype.destroy.call(this),Laya.loader.clearRes(this.title_image.skin)},t}(ui.activity.pages.Level_CompeteUI);e.Level_Compete=d}),define("src/g/activity/view/item/RankActivityItem",["require","exports","../../../../utils/ItemUtils","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips"],function(t,e,o,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function s(){var t=e.call(this)||this;return t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(s,e),s.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},s.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},s.prototype.setData=function(t,e,i){if(void 0===i&&(i=1),s.rankArr[0]){var n=e+i;this.rank_txt.text=n+"",this.name_txt.text=t.nickname,this.level_txt.text=s.rankArr[0].title+":"+(s.isShowLevel?o.ItemUtils.getLVString(t.value1):t.value1),this.list_item.array=s.rankArr[4<n?3:n-1].bonus}},s.rankArr=[],s.isShowLevel=!1,s}(ui.activity.item.RankItemUI);e.RankActivityItem=s}),define("src/g/activity/view/RankViewActivity",["require","exports","src/g/activity/view/item/RankActivityItem"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t._firstRank=1,t.list.itemRender=i.RankActivityItem,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=10,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t}return __extends(t,e),t.prototype.renderHandler=function(t,e){t.setData(this.list.array[e],e,this._firstRank)},t.prototype.setData=function(t,e){void 0===e&&(e=1),this._firstRank=e,this.list.array=t},t.prototype.destroy=function(){this.list.array=null,this.list.renderHandler=null,e.prototype.destroy.call(this)},t}(ui.activity.pages.RankViewUI);e.RankViewActivity=n}),define("src/g/activity/view/pages/ConsumeCompetePage",["require","exports","../../../../manager/GameSocketManager","../../../net/messages/activity/ActivityGet","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/ItemUtils","src/g/activity/view/RankViewActivity","../../../../utils/system/DateUitl","src/g/activity/view/item/RankActivityItem","src/g/peronboss/view/ItemIconView","../../../../utils/system/ServerTime","src/g/clearRes/ClearResM","src/init/TextConst"],function(t,e,o,a,r,l,h,i,c,n,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t}return __extends(t,e),t.prototype.showPage=function(t,e){if(this._activityId!=t){this._activityId=t;var i,n=r.RoleCenter.instans.vo.getActivity1Data(t);n&&n.children&&0<n.children.length&&(i=n.children[0]);var s=l.GameConfig.activityJson[n.cfgId],o=i?l.GameConfig.subActivityJson[i.cfgId]:null;this.title_img.skin="dynamic/activity/consume_compete/"+s.bg_img+".png",this.bg_image.skin="dynamic/activity/consume_compete/"+o.image+".png",this.time_txt.changeText(c.DateUtil.remainingTimeStr(n.rewardTime-p.ServerTime.serverTime)),this.desc_txt.changeText(s.desc),this.txt_rule.changeText(g.TextConst.get(263,s.value)),this.fillRankReward(n.cfgId),this.btn_rank.on(Laya.Event.CLICK,this,this.showRankView)}else d.ClearResM.resetViewImg(this);this.refresh(),e.addChild(this)},t.prototype.refresh=function(){this.requestRankData(this._activityId),n.RankActivityItem.rankArr=this._RankVos},t.prototype.getActivityId=function(){return this._activityId},t.prototype.hidePage=function(){o.GSM.ins.off(a.ActivityGetRankGS2C.KEY,this,this.onRequestRankDataBack),this.backHandler(),this._rankArr=null,this.removeSelf(),d.ClearResM.clearFolderByUrl("dynamic/activity/consume_compete/")},t.prototype.backHandler=function(){return!this._rankView||!this._rankView.displayedInStage||(this._rankView.close(),this._rankView.destroy(),this._rankView=null,!1)},t.prototype.doDestroy=function(){this.hidePage(),this.btn_rank.offAll(),e.prototype.destroy.call(this),Laya.loader.clearRes(this.title_img.skin),Laya.loader.clearRes(this.bg_image.skin)},t.prototype.requestRankData=function(t){o.GSM.ins.on(a.ActivityGetRankGS2C.KEY,this,this.onRequestRankDataBack);var e=new a.ActivityGetRankC2GS;e.id=t,o.GSM.sendServer(e)},t.prototype.onRequestRankDataBack=function(t){if(t.opresult&&t.id==this._activityId){this._rankArr=t.rankArr,o.GSM.ins.off(a.ActivityGetRankGS2C.KEY,this,this.onRequestRankDataBack);for(var e,i=this._rankArr?this._rankArr.length:0,n=0,s=0;n<i;)e=this._rankArr[n],0==n?(this.txt_name_1.changeText(e.nickname),this.txt_value_1.changeText(e.value1.toString())):1==n?(this.txt_name_2.changeText(e.nickname),this.txt_value_2.changeText(e.value1.toString())):2==n?(this.txt_name_3.changeText(e.nickname),this.txt_value_3.changeText(e.value1.toString())):3==n&&(this.txt_name_4.changeText(e.nickname),this.txt_value_4.changeText(e.value1.toString())),e.username==r.RoleCenter.instans.vo.username&&(s=n+1),n++;this.txt_rank.changeText(0<s?s.toString():g.TextConst.get(223))}},t.prototype.fillRankReward=function(t){var e;for(var i in this._RankVos=[],l.GameConfig.activityRankJson){var n;if((e=l.GameConfig.activityRankJson[i]).activityId==t)if(1==e.rank[0]){var s=e.bonus.length,o=0;for(s=3<s?3:s;o<s;)0==o?n=this.rank_1_0:1==o?n=this.rank_1_1:2==o&&(n=this.rank_1_2),u.ItemIconView.setItemData(h.ItemUtils.getItemOrEq(e.bonus[o][0]),n,Number(e.bonus[o][1])),o++;this._RankVos[0]=e}else 2==e.rank[0]?(n=this.rank_2_0,u.ItemIconView.setItemData(h.ItemUtils.getItemOrEq(e.bonus[0][0]),n,Number(e.bonus[0][1])),this._RankVos[1]=e):3==e.rank[0]?(n=this.rank_3_0,u.ItemIconView.setItemData(h.ItemUtils.getItemOrEq(e.bonus[0][0]),n,Number(e.bonus[0][1])),this._RankVos[2]=e):4==e.rank[0]&&(n=this.rank_4_0,u.ItemIconView.setItemData(h.ItemUtils.getItemOrEq(e.bonus[0][0]),n,Number(e.bonus[0][1])),this._RankVos[3]=e)}},t.prototype.showRankView=function(){this._rankView||(this._rankView=new i.RankViewActivity,this._rankView.btn_back.on(Laya.Event.CLICK,this,this.backHandler),this._rankView.btn_close.on(Laya.Event.CLICK,this,this.backHandler),this._rankView.setData(this._rankArr),this._rankView.popup())},t}(ui.activity.pages.Consume_CompeteUI);e.ConsumeCompetePage=s}),define("src/g/activity/view/item/BossScoreItem",["require","exports","../../../net/messages/enumStatus"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._select=!1,t}return __extends(t,e),t.prototype.setData=function(t){(this._data=t)&&(t.status==i.enumStatus.yilingqu?this.get_img.visible=!0:this.get_img.visible=!1,this._select?this.arrow_img.visible=!0:this.arrow_img.visible=!1,t.status==i.enumStatus.weiwancheng?this._select?this.box_img.skin="res/loginreward/denglu_baoxiang004.png":this.box_img.skin="res/loginreward/denglu_baoxiang001.png":t.status!=i.enumStatus.yilingqu&&t.status!=i.enumStatus.kelingqu||(this._select?this.box_img.skin="res/loginreward/denglu_baoxiang002.png":this.box_img.skin="res/loginreward/denglu_baoxiang003.png"))},Object.defineProperty(t.prototype,"selected",{get:function(){return this._select},set:function(t){this._select=t,this._data&&this.setData(this._data)},enumerable:!0,configurable:!0}),t}(ui.activity.item.BossScoreItemUI);e.BossScoreItem=n}),define("src/g/activity/view/pages/BossScorePage",["require","exports","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/system/DateUitl","../../../../enum/EventName","../../../../core/E","../../../../utils/ItemCellUtils","src/g/activity/view/item/BossScoreItem","src/g/bag/tips/view/ItemTips","../../../../manager/AM","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../utils/system/ServerTime","src/g/clearRes/ClearResM","src/init/Switches"],function(t,e,h,c,u,p,d,i,n,s,o,a,r,g,v,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t}return __extends(t,e),t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_box.itemRender=n.BossScoreItem,this.list_box.renderHandler=new Laya.Handler(this,this.boxRenderHandler),this.list_item.renderHandler=new Laya.Handler(this,this.itemRenderHandler),this.list_box.mouseHandler=new Laya.Handler(this,this.boxMouseHandler),this.list_item.mouseHandler=new Laya.Handler(this,this.itemMouseHandler),this.btn_kill.on(Laya.Event.CLICK,this,this.gotoKillBoss),this.btn_get.on(Laya.Event.CLICK,this,this.toGetHandler),this.btn_get2.on(Laya.Event.CLICK,this,this.toGet2Handler)},t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){if(this._activityId!=t){this._activityId=t;var i,n=h.RoleCenter.instans.vo.getActivity1Data(t);n&&n.children&&0<n.children.length&&(i=n.children[0]);var s=c.GameConfig.activityJson[n.cfgId],o=i?c.GameConfig.subActivityJson[i.cfgId]:null;this.title_img.skin="dynamic/activity/boss_score/"+s.bg_img+".png",this.bg_img.skin="dynamic/activity/boss_score/"+o.image+".png",this.time_txt.changeText(u.DateUtil.remainingTimeStr(n.rewardTime-g.ServerTime.serverTime)),this.desc_txt.changeText(s.desc),this.lab_score.changeText(n.allData.allCount.toString());var a=[];this.cfgIdArr1=[],this.cfgIdArr2=[];for(var r=n.children?n.children.length:0,l=0;l<r;)i=n.children[l],(o=c.GameConfig.subActivityJson[i.cfgId])&&(o.cost&&0!=o.cost.length?this.cfgIdArr2[o.value2-1]=i:(this.cfgIdArr1[o.value2-1]=i,a.push(o.value2-1))),l++;this.list_box.array=a,this.selectBox(0)}else v.ClearResM.resetViewImg(this);d.E.ins.on(p.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this)},t.prototype.refresh=function(){},t.prototype.hidePage=function(){d.E.ins.off(p.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),v.ClearResM.clearFolderByUrl("dynamic/activity/boss_score/")},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this),Laya.loader.clearRes(this.title_img.skin),Laya.loader.clearRes(this.bg_img.skin)},t.prototype.boxRenderHandler=function(t,e){t.setData(this.cfgIdArr1[t.dataSource])},t.prototype.itemRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.boxMouseHandler=function(t,e){t.type==Laya.Event.CLICK&&this.selectBox(e)},t.prototype.selectBox=function(t){var e=this.list_box.array[t],i=this.list_box.getCell(t);i&&i!=this._currBox&&(this._currBox&&(this._currBox.selected=!1),i.selected=!0,this._currBox=i);var n,s=this.cfgIdArr1[e];this._selectCfgid1=s.cfgId,(n=s?c.GameConfig.subActivityJson[s.cfgId]:null)&&(this.list_item.array=n.bonus,this.lab_title.changeText(n.title)),s=this.cfgIdArr2[e],this._selectCfgid2=s.cfgId,(n=c.GameConfig.subActivityJson[this._selectCfgid2]).cost&&0<n.cost.length&&this.lab_cost.changeText(n.cost[0][1]+"")},t.prototype.itemMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];s.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.onActivityDataChanged=function(t,e){if(e==this._activityId){this.list_box.refresh();var i=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);this.lab_score.changeText(i.allData.allCount.toString())}},t.prototype.gotoKillBoss=function(){d.E.ins.event(p.EventName.PERSONBOSS,1)},t.prototype.toGetHandler=function(){if(h.RoleCenter.instans.bagRoomEnough()){if(this._selectCfgid1){var t=new a.ActivityGetC2GS;t.id=this._activityId,t.activity2CfgId=this._selectCfgid1,r.GSM.sendServer(t)}}else o.AM.showBagNotEnough()},t.prototype.toGet2Handler=function(){if(h.RoleCenter.instans.bagRoomEnough()){if(this._selectCfgid2){var t=c.GameConfig.subActivityJson[this._selectCfgid2];if(t.cost&&"GOLD"==t.cost[0]&&h.RoleCenter.instans.vo.GOLD<t.cost[1])return void l.Switches.ins.event(155);var e=new a.ActivityGetC2GS;e.id=this._activityId,e.activity2CfgId=this._selectCfgid2,r.GSM.sendServer(e)}}else o.AM.showBagNotEnough()},t}(ui.activity.pages.Boss_ScoreUI);e.BossScorePage=f}),define("src/g/activity/view/pages/KillBossPage",["require","exports","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","src/g/clearRes/ClearResM","../../../../meta/MainButtonVo","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips"],function(t,e,s,o,a,r,l,n,i,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initialize=function(){t.prototype.initialize.call(this),this.show_list.itemRender=ui.custom.ItemNameViewUI,this.show_list.renderHandler=new Laya.Handler(this,this.showListRenderHandler),this.show_list.clickHandler=new Laya.Handler(this,this.onMouseHandler),this.btn_kill.on(Laya.Event.CLICK,this,this.gotoKillHandler)},e.prototype.showListRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},e.prototype.onMouseHandler=function(t){h.ItemTips.ins.showTip(this.show_list.array[t][0],Number(this.show_list.array[t][1]))},e.prototype.gotoKillHandler=function(){var t,e=s.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e&&e.children&&0<e.children.length){t=e.children[0];var i=o.GameConfig.subActivityJson[t.cfgId];i.moduleID&&0<i.moduleID.length&&n.MainButtonStruct.Ins.OpenModule(i.moduleID[0][1],i.moduleID[1][1])}},e.prototype.getActivityId=function(){return this._activityId},e.prototype.showPage=function(t,e){if(this._activityId!=t){this._activityId=t;var i=s.RoleCenter.instans.vo.getActivity1Data(t),n=o.GameConfig.activityJson[i.cfgId];this.show_list.array=n.showList,this.title_img.skin="dynamic/activity/kill_boss/"+n.bg_img+".png",this.time_txt.changeText(a.DateUtil.remainingTimeStr(i.rewardTime-r.ServerTime.serverTime))}else l.ClearResM.resetViewImg(this);e.addChild(this)},e.prototype.refresh=function(){},e.prototype.hidePage=function(){this.removeSelf(),l.ClearResM.clearFolderByUrl("dynamic/activity/kill_boss/")},e.prototype.backHandler=function(){return!0},e.prototype.doDestroy=function(){this.hidePage(),t.prototype.destroy.call(this),Laya.loader.clearRes(this.title_img.skin)},e}(ui.activity.pages.Kill_BossUI);e.KillBossPage=c}),define("src/g/activity/view/pages/GodDomainBossPage",["require","exports","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/system/DateUitl","src/g/activity/view/item/LevelItem","../../../../enum/EventName","../../../../core/E","../../../../utils/system/ServerTime","src/g/clearRes/ClearResM"],function(t,e,s,o,a,i,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initialize=function(){t.prototype.initialize.call(this),this.list_gifs.itemRender=i.LevelItem,this.list_gifs.vScrollBarSkin="",this.list_gifs.scrollBar.elasticDistance=100,this.list_gifs.renderHandler=new Laya.Handler(this,this.onRenderHandler)},e.prototype.getActivityId=function(){return this._activityId},e.prototype.showPage=function(t,e){if(this._activityId!=t){this._activityId=t;var i=s.RoleCenter.instans.vo.getActivity1Data(t);i&&i.children&&i.children.length;var n=o.GameConfig.activityJson[i.cfgId];this.title_img.skin="dynamic/activity/god_domain_boss/"+n.bg_img+".png",this.time_txt.changeText(a.DateUtil.remainingTimeStr(i.rewardTime-h.ServerTime.serverTime)),this.desc_txt.changeText(n.desc),this.list_gifs.array=i.children}else this.list_gifs.refresh(),c.ClearResM.resetViewImg(this);l.E.ins.on(r.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this)},e.prototype.refresh=function(){this.list_gifs.refresh()},e.prototype.hidePage=function(){l.E.ins.off(r.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),c.ClearResM.clearFolderByUrl("dynamic/activity/god_domain_boss/")},e.prototype.backHandler=function(){return!0},e.prototype.doDestroy=function(){this.hidePage(),t.prototype.destroy.call(this),Laya.loader.clearRes(this.title_img.skin)},e.prototype.onRenderHandler=function(t,e){var i=s.RoleCenter.instans.vo.getActivity1Data(this._activityId);i&&t.setData(t.dataSource,i)},e.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.list_gifs.refresh()},e}(ui.activity.pages.God_Domain_BossUI);e.GodDomainBossPage=n}),define("src/g/activity/view/Accumulative_Recharge",["require","exports","../../../config/GameConfig","../../../utils/ItemUtils","../../../utils/system/DateUitl","../../../core/E","../../../enum/EventName","../../net/messages/activity/ActivityGet","../../../manager/GameSocketManager","../../../manager/RoleCenter","../../net/messages/enumStatus","src/g/Effects/UIEffectsFactory","src/init/Switches","src/g/peronboss/view/ItemIconView","../../../utils/system/ServerTime","src/g/clearRes/ClearResM","src/init/TextConst","../../../enum/FashionPos","../../../component/GAnimation"],function(t,e,u,p,d,g,v,i,n,a,s,f,o,y,m,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(e){function t(){var t=e.call(this)||this;return t._isInited=!1,t.btn_recharge.on(Laya.Event.CLICK,t,t.rechargeHandler),t.btn_get.on(Laya.Event.CLICK,t,t.getHandlerAct),t.txt_count.style.font="SimHei",t.txt_count.style.fontSize=20,t.txt_count.style.color="#03bb00",t.txt_count.style.align="center",t}return __extends(t,e),t.prototype.rechargeHandler=function(){o.Switches.ins.event(109)},t.prototype.getHandlerAct=function(){if(a.RoleCenter.instans.vo.getActivity1Data(this._activityId).children[0].status==s.enumStatus.kelingqu){var t=new i.ActivityGetC2GS;t.id=this._activityId,t.activity2CfgId=this._subActivityId,n.GSM.sendServer(t)}},t.prototype.showView=function(t,e){this._activityId=t.id,this._subActivityId=t.children[0].cfgId,this.initShow(t)},t.prototype.initShow=function(t){if(!this._isInited){var e=u.GameConfig.activityJson[t.cfgId];this.title_img.skin="dynamic/activity/accumulative_recharge/"+e.bg_img+".png",this.time_txt.changeText(d.DateUtil.remainingTimeStr(t.rewardTime-m.ServerTime.serverTime)),this.desc_txt.text=e.desc;var i=t.children[0],n=u.GameConfig.subActivityJson[i.cfgId];this.txt_title.text=n.title;var s=n.image||"huodong-jianglitu2";this.img_title.skin="dynamic/activity/accumulative_recharge/"+s+".png",this.checkBunusShowAni(n.bonus);for(var o=n.bonus,a=o.length,r=0;r<6;r++)this["item"+r].visible=!1;for(r=0;r<a;r++){this["item"+r].visible=!0;var l=o[r][0],h=o[r][1],c=p.ItemUtils.getItemOrEq(l);y.ItemIconView.setItemData(c,this["item"+r],h)}g.E.ins.on(v.EventName.ACTIVITY_DATA_CHANGED,this,this.onDataUpdateHandler),this.ani=f.UIEffectsFactory.Ins.createSAniAndCenter(this.btn_get,40),this.ani.visible=!1,this._isInited=!0}this.updateShow(t)},t.prototype.onDataUpdateHandler=function(t,e){this._activityId==e&&this.updateShow(a.RoleCenter.instans.vo.getActivity1Data(e))},t.prototype.updateShow=function(t){this.txt_value.text=t.allData.allCount.toString();var e=t.children[0],i=u.GameConfig.subActivityJson[e.cfgId];this.ani.visible=!1,e.status==s.enumStatus.weiwancheng?(this.btn_get.disabled=!0,this.btn_get.label=l.TextConst.get(210)):e.status==s.enumStatus.kelingqu?(this.btn_get.label=l.TextConst.get(203),this.btn_get.disabled=!1,this.ani.visible=!0):e.status==s.enumStatus.yilingqu&&(this.btn_get.label=l.TextConst.get(211),this.btn_get.disabled=!0),this.txt_count.innerHTML=l.TextConst.get(252,Math.min(e.count,i.value),i.value)},t.prototype.checkBunusShowAni=function(t){var e,i,n=t.length,s=0;for(this.img_title.visible=!0,this.img_stage.visible=!1;s<n;){if(e=t[s][0],i=u.GameConfig.fashionJson[e]){this.loadFasionAni(i),this.img_title.visible=!1;break}if(i=u.GameConfig.titleJSON[e]){this.loadTitleAni(i),this.img_title.visible=!1;break}s++}this.box_title.visible=!this.img_title.visible},t.prototype.loadTitleAni=function(t){var e,i="dynamic2/chenghao/"+t.icon+".json";this.img_stage.visible=!0;for(var n=this.box_title.numChildren;0<n;)if(e=this.box_title.getChildAt(0)){e.stop(),e.clear();break}if(e){if(e._url&&e._url==i)return void e.play()}else(e=new c.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,e.scale(1,1),e.load(i)},t.prototype.loadFasionAni=function(t){var e,i=a.RoleCenter.instans.vo.getSex(),n=this.box_title.numChildren;t.position==h.FashionPos.WING?o=0:t.position==h.FashionPos.WEAPON?o=1:t.position==h.FashionPos.FASHION&&(o=2);for(var s=p.ItemUtils.getAvtoarSource(t.res,o,i);0<n;)if(e=this.box_title.getChildAt(0)){e.stop(),e.clear();break}if(e){if(e._url&&e._url==s)return void e.play()}else(e=new c.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2;var o=e.rotation=0;t.position==h.FashionPos.WING?(o=0,e.scale(.7,.7)):t.position==h.FashionPos.WEAPON?(o=1,e.scale(.8,.8),e.x+=100,e.y+=50):t.position==h.FashionPos.FASHION&&(o=2,e.y-=100,e.scale(.9,.9)),e.load(s)},t.prototype.showPage=function(t,e){if(this._activityId!=t){this._activityId=t;var i=a.RoleCenter.instans.vo.getActivity1Data(t),n=u.GameConfig.activityJson[i.cfgId];this.showView(i,n)}else r.ClearResM.resetViewImg(this);e.addChild(this)},t.prototype.getActivityId=function(){return this._activityId},t.prototype.refresh=function(){},t.prototype.hidePage=function(){this.removeSelf(),r.ClearResM.clearFolderByUrl("dynamic/activity/accumulative_recharge/")},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){g.E.ins.off(v.EventName.ACTIVITY_DATA_CHANGED,this,this.onDataUpdateHandler),this.hidePage(),e.prototype.destroy.call(this),Laya.loader.clearRes(this.title_img.skin),Laya.loader.clearRes(this.img_title.skin)},t}(ui.activity.pages.Accumulative_RechargeUI);e.Accumulative_Recharge=_}),define("src/g/activity/view/Continuous_Recharge_Rebate",["require","exports","../../../config/GameConfig","../../../utils/ItemUtils","../../../utils/system/DateUitl","../../../core/E","../../../enum/EventName","../../net/messages/activity/ActivityGet","../../../manager/GameSocketManager","../../../manager/RoleCenter","../../net/messages/enumStatus","src/g/Effects/UIEffectsFactory","src/init/Switches","src/g/peronboss/view/ItemIconView","../../../utils/system/ServerTime","src/g/clearRes/ClearResM","src/init/TextConst","../../../enum/FashionPos","../../../component/GAnimation"],function(t,e,h,c,i,n,s,o,a,u,p,r,l,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(e){function t(){var t=e.call(this)||this;return t._isInited=!1,t._selectedIndex=0,t._progressArr=[],t.btn_recharge.on(Laya.Event.CLICK,t,t.rechargeHandler),t.btn_get.on(Laya.Event.CLICK,t,t.getHandlerRebate),t}return __extends(t,e),t.prototype.rechargeHandler=function(){l.Switches.ins.event(109)},t.prototype.getHandlerRebate=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t.children[this._selectedIndex].status==p.enumStatus.kelingqu){var e=new o.ActivityGetC2GS;e.id=this._activityId,e.activity2CfgId=t.children[this._selectedIndex].cfgId,a.GSM.sendServer(e)}},t.prototype.showView=function(t,e){this._activityId=t.id,this.initShow(t)},t.prototype.initShow=function(t){if(!this._isInited){var e=h.GameConfig.activityJson[t.cfgId];this.title_image.skin="dynamic/activity/continuous_recharge_rebate/"+e.bg_img+".png",this.time_txt.changeText(i.DateUtil.remainingTimeStr(t.rewardTime-g.ServerTime.serverTime)),this.desc_txt.text=e.desc,this.ani=r.UIEffectsFactory.Ins.createSAniAndCenter(this.btn_get,40),this.ani.visible=!1,n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onDataUpdateHandler),this._isInited=!0}this.updateShow(t)},t.prototype.updateBoxState=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children.length;e=4<e?4:e;var i,n,s,o=0;for(this._progressArr[0]=0;o<e;)s=o+1,i=t.children[o],n=h.GameConfig.subActivityJson[i.cfgId],this["lab_progrs"+s].changeText(f.TextConst.get(254,i.count,n.value)),n&&(this._progressArr[s]=n.value,this["effect"+s].visible=!1,i.status==p.enumStatus.yilingqu?this["img_box"+s].skin="res/unpack/baoxiang_lv0"+(s+1)+"kai.png":(this["img_box"+s].skin="res/unpack/baoxiang_lv0"+(s+1)+".png",i.count>=n.value&&(this["effect"+s].visible=!0)),this["img_box"+s].offAll(),this["img_box"+s].on(Laya.Event.CLICK,this,this.onBoxClickHandler,[o])),o++;this.updateBoxProgress()}},t.prototype.onBoxClickHandler=function(t){this._selectedIndex=t,this.jiantou.y=this["effect"+(t+1)].y-40,this.jiantou.x=this["effect"+(t+1)].x-15;for(var e=u.RoleCenter.instans.vo.getActivity1Data(this._activityId).children[t],i=h.GameConfig.subActivityJson[e.cfgId],n=i.bonus.length,s=0;s<6;){if(s<n){this["item"+s].visible=!0;var o=i.bonus[s][0],a=i.bonus[s][1],r=c.ItemUtils.getItemOrEq(o);d.ItemIconView.setItemData(r,this["item"+s],a)}else this["item"+s].visible=!1;s++}var l=i.image||"huodong-jianglitu1";this.img_title.skin="dynamic/activity/continuous_recharge_rebate/"+l+".png",this.txt_title.text=i.title,this.checkBunusShowAni(i.bonus),this.ani.visible=!1,e.status==p.enumStatus.weiwancheng?(this.btn_get.disabled=!0,this.btn_get.label=f.TextConst.get(210)):e.status==p.enumStatus.kelingqu?(this.btn_get.label=f.TextConst.get(203),this.btn_get.disabled=!1,this.ani.visible=!0):e.status==p.enumStatus.yilingqu&&(this.btn_get.label=f.TextConst.get(211),this.btn_get.disabled=!0)},t.prototype.updateBoxProgress=function(){for(var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId),e=t.children.length,i=0,n=0;i<e;)t.children[i].count>n&&(n=t.children[i].count),i++;for(var s=1/((e=this._progressArr.length)-1),o=i=0,a=0,r=0;i<e-1;){if(o=this._progressArr[i],!((a=this._progressArr[i+1])<=n)){r+=Math.max(0,(n-o)/(a-o)*s);break}r+=s,i++}this.img_progress.scaleX=Math.min(1,r)},t.prototype.onDataUpdateHandler=function(t,e){this._activityId==e&&this.updateShow(u.RoleCenter.instans.vo.getActivity1Data(e))},t.prototype.updateShow=function(t){this.updateBoxState(),this.onBoxClickHandler(this._selectedIndex)},t.prototype.checkBunusShowAni=function(t){var e,i,n=t.length,s=0;for(this.img_title.visible=!0,this.img_stage.visible=!1;s<n;){if(e=t[s][0],i=h.GameConfig.fashionJson[e]){this.loadFasionAni(i),this.img_title.visible=!1;break}if(i=h.GameConfig.titleJSON[e]){this.loadTitleAni(i),this.img_title.visible=!1;break}s++}this.box_title.visible=!this.img_title.visible},t.prototype.loadTitleAni=function(t){var e,i="dynamic2/chenghao/"+t.icon+".json";this.img_stage.visible=!0;for(var n=this.box_title.numChildren;0<n;)if(e=this.box_title.getChildAt(0)){e.stop(),e.clear();break}if(e){if(e._url&&e._url==i)return void e.play()}else(e=new m.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,e.scale(1,1),e.load(i)},t.prototype.loadFasionAni=function(t){var e,i=u.RoleCenter.instans.vo.getSex(),n=this.box_title.numChildren;t.position==y.FashionPos.WING?o=0:t.position==y.FashionPos.WEAPON?o=1:t.position==y.FashionPos.FASHION&&(o=2);for(var s=c.ItemUtils.getAvtoarSource(t.res,o,i);0<n;)if(e=this.box_title.getChildAt(0)){e.stop(),e.clear();break}if(e){if(e._url&&e._url==s)return void e.play()}else(e=new m.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2;var o=e.rotation=0;t.position==y.FashionPos.WING?(o=0,e.scale(.7,.7)):t.position==y.FashionPos.WEAPON?(o=1,e.scale(.8,.8),e.x+=100,e.y+=50):t.position==y.FashionPos.FASHION&&(o=2,e.y-=100,e.scale(.9,.9)),e.load(s)},t.prototype.showPage=function(t,e){if(this._activityId!=t){this._activityId=t;var i=u.RoleCenter.instans.vo.getActivity1Data(t),n=h.GameConfig.activityJson[i.cfgId];this.showView(i,n)}else v.ClearResM.resetViewImg(this);e.addChild(this)},t.prototype.getActivityId=function(){return this._activityId},t.prototype.refresh=function(){},t.prototype.hidePage=function(){this.removeSelf(),v.ClearResM.clearFolderByUrl("dynamic/activity/continuous_recharge_rebate/")},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onDataUpdateHandler),this.hidePage(),e.prototype.destroy.call(this),Laya.loader.clearRes(this.title_image.skin)},t}(ui.activity.pages.Continuous_Recharge_RebateUI);e.Continuous_Recharge_Rebate=_}),define("src/g/activity/view/Daily_Accumulative_Recharge",["require","exports","../../../config/GameConfig","src/g/activity/view/item/LevelItem","../../../utils/system/DateUitl","../../../core/E","../../../enum/EventName","../../../manager/AM","../../../manager/RoleCenter","../../../utils/system/ServerTime","src/g/clearRes/ClearResM","../../net/messages/enumStatus","../../../enum/ActivityTemplate"],function(t,e,a,i,s,o,r,n,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=100,t.list.itemRender=i.LevelItem,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t.btn_recharge.on(Laya.Event.CLICK,t,t.rechargeHandler),t}return __extends(t,e),t.prototype.rechargeHandler=function(){n.AM.rechargeHandler()},t.prototype.onDataUpdateHandler=function(t,e){this._activityId==e&&this.refresh()},t.prototype.renderHandler=function(t,e){t.setData(this.list.array[e],this._activity1)},t.prototype.showView=function(t,e){if(this._activity1=t,this.title_image.skin="dynamic/activity/daily_accumulative_recharge/"+e.bg_img+".png",e.clientkey==p.ActivityTemplateKey.week_accumulative_recharge)this.time_txt.changeText(s.DateUtil.remainingTimeStr(this._activity1.rewardTime-h.ServerTime.serverTime));else{var i=new Date;i.setTime(1e3*h.ServerTime.serverTime),i.setHours(23,59,59),this.time_txt.changeText(s.DateUtil.remainingTimeStr(i.getTime()/1e3-h.ServerTime.serverTime))}this.desc_txt.text=e.desc},t.prototype.mainListSortFun=function(t,e){var i=a.GameConfig.subActivityJson[t.cfgId],n=a.GameConfig.subActivityJson[e.cfgId],s=i?i.childId+100:100,o=n?n.childId+100:100;return t.status==u.enumStatus.kelingqu?s-=100:t.status==u.enumStatus.yilingqu&&(s+=100),e.status==u.enumStatus.kelingqu?o-=100:e.status==u.enumStatus.yilingqu&&(o+=100),s-o},t.prototype.showPage=function(t,e){if(this._activityId!=t){this._activityId=t;var i=l.RoleCenter.instans.vo.getActivity1Data(t);this._activity1=i;var n=a.GameConfig.activityJson[i.cfgId];this.title_image.skin="dynamic/activity/daily_accumulative_recharge/"+n.bg_img+".png",this.desc_txt.text=n.desc}else c.ClearResM.resetViewImg(this);this.refresh(),this.cooldownHandler(),o.E.ins.on(r.EventName.ACTIVITY_DATA_CHANGED,this,this.onDataUpdateHandler),e.addChild(this)},t.prototype.getActivityId=function(){return this._activityId},t.prototype.refresh=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children.concat();e.sort(this.mainListSortFun),this.list.array=e,this.value_txt.text=t.allData.allCount.toString()}},t.prototype.hidePage=function(){o.E.ins.off(r.EventName.ACTIVITY_DATA_CHANGED,this,this.onDataUpdateHandler),this.removeSelf(),c.ClearResM.clearFolderByUrl("dynamic/activity/daily_accumulative_recharge/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this),Laya.loader.clearRes(this.title_image.skin)},t.prototype.cooldownHandler=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=a.GameConfig.activityJson[t.cfgId],i=t.rewardTime;e.clientkey!=p.ActivityTemplateKey.week_accumulative_recharge&&(i=s.DateUtil.getZeroTime());var n=i-h.ServerTime.serverTime;86400<n?(this.time_txt.changeText(s.DateUtil.remainingDHStr(n)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=n?(this.time_txt.changeText(s.DateUtil.getHMS_countdown(n)),Laya.timer.once(1e3,this,this.cooldownHandler)):(Laya.timer.once(1e3,this,this.cooldownHandler),this.time_txt.changeText("00:00:00"))}},t}(ui.activity.pages.Daily_Accumulative_RechargeUI);e.Daily_Accumulative_Recharge=d}),define("src/g/activity/view/Daily_Rebate",["require","exports","src/g/activity/view/item/LevelItem","../../../config/GameConfig","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","src/g/clearRes/ClearResM","../../net/messages/enumStatus"],function(t,e,i,a,s,o,r,n,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=100,t.list.itemRender=i.LevelItem,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t.show_list.itemRender=ui.custom.ItemNameViewUI,t.show_list.renderHandler=new Laya.Handler(t,t.showListRenderHandler),t.show_list.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onDataUpdateHandler=function(t,e){this._activityId==e&&this.refresh()},t.prototype.onMouseHandler=function(t,e){t.type==Laya.Event.CLICK&&l.ItemTips.ins.showTip(this.show_list.array[e][0],Number(this.show_list.array[e][1]))},t.prototype.showListRenderHandler=function(t,e){n.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.renderHandler=function(t,e){t.setData(this.list.array[e],this._activity1)},t.prototype.showView=function(t,e){window.enabledpay&&(this._activity1=t,this.title_image.skin="dynamic/activity/daily_rebate/"+e.bg_img+".png",this.desc_txt.text=e.desc,this.show_list.array=e.showList)},t.prototype.childSortFun=function(t,e){var i=a.GameConfig.subActivityJson[t.cfgId],n=a.GameConfig.subActivityJson[e.cfgId],s=i?i.childId+100:100,o=n?n.childId+100:100;return t.status==c.enumStatus.kelingqu?s-=100:t.status==c.enumStatus.yilingqu&&(s+=100),e.status==c.enumStatus.kelingqu?o-=100:e.status==c.enumStatus.yilingqu&&(o+=100),s-o},t.prototype.showPage=function(t,e){if(window.enabledpay){if(this._activityId!=t){this._activityId=t;var i=r.RoleCenter.instans.vo.getActivity1Data(t),n=a.GameConfig.activityJson[i.cfgId];this.showView(i,n)}else h.ClearResM.resetViewImg(this);this.refresh(),s.E.ins.on(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onDataUpdateHandler),s.E.ins.on(o.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),e.addChild(this)}},t.prototype.onTimeSpanHandler=function(t){var e=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.getActivityId=function(){return this._activityId},t.prototype.refresh=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children.concat();e.sort(this.childSortFun),this.list.array=e;var i=a.GameConfig.activityJson[t.cfgId];this.showView(t,i)}},t.prototype.hidePage=function(){s.E.ins.off(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onDataUpdateHandler),s.E.ins.off(o.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),h.ClearResM.clearFolderByUrl("dynamic/activity/daily_rebate/")},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this),Laya.loader.clearRes(this.title_image.skin)},t}(ui.activity.pages.Daily_RebateUI);e.Daily_Rebate=u}),define("src/g/activity/view/item/ShopLimitItem",["require","exports","../../../net/messages/activity/ActivityGet","../../../../config/GameConfig","../../../../manager/GameSocketManager","../../../../manager/RoleCenter","../../../../utils/system/FloatEffect","src/g/Effects/UIEffectsFactory","../../../../plugin/view/ToolTip","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","src/init/Switches","../../../../manager/AM","src/init/TextConst"],function(t,e,s,r,o,l,a,h,c,i,n,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(e){function t(){var t=e.call(this)||this;return t.btn_buy.on(Laya.Event.CLICK,t,t.buyHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.buyHandler=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex];if(e){if(!l.RoleCenter.instans.bagRoomEnough())return void p.AM.showBagNotEnough();var i=r.GameConfig.subActivityJson[e.cfgId];if(0<i.value2&&i.value2-e.count<=0)return void a.FE.upItems(d.TextConst.get(218),c.BubbleEnum.center);if(0<i.viplevel&&l.RoleCenter.instans.vo.VIP<i.viplevel)return void a.FE.upItems(d.TextConst.get(219),c.BubbleEnum.center);if("MONEY"==i.cost[0][0]&&l.RoleCenter.instans.vo.MONEY<i.cost[0][1])return void a.FE.upItems(d.TextConst.get(220),c.BubbleEnum.center);if("GOLD"==i.cost[0][0]&&l.RoleCenter.instans.vo.GOLD<i.cost[0][1])return void u.Switches.ins.event(155);var n=new s.ActivityGetC2GS;n.id=this._activityId,n.activity2CfgId=e.cfgId,o.GSM.sendServer(n)}}},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e;var i=l.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=r.GameConfig.subActivityJson[n.cfgId];this.list_item.array=s.bonus,this.type_icon.define=s.originalcost[0][0],this.type_icon1.define=s.cost[0][0],this.cost_old_txt.text=s.originalcost[0][1],this.cost_new_txt_.text=s.cost[0][1],this.txt_cost.text=s.discost+"";var o=s.value2-n.count;s.value2;this.count_txt.color=o<1?"#ff0000":"#03bb00",this.count_txt.text=s.value2-n.count+"/"+s.value2,s.viplevel?(this.vip_con.visible=!0,this.person.visible=!1,this.vip_value.value=s.viplevel+""):(this.vip_con.visible=!1,this.person.visible=!0);var a=!0;0<s.value2&&s.value2-n.count<=0&&(a=!1),0<s.viplevel&&l.RoleCenter.instans.vo.VIP<s.viplevel&&(a=!1),"MONEY"==s.cost[0][0]&&l.RoleCenter.instans.vo.MONEY<s.cost[0][1]&&(a=!1),"GOLD"==s.cost[0][0]&&l.RoleCenter.instans.vo.GOLD<s.cost[0][1]&&(a=!1),a?(this.ani||(this.ani=h.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_buy,40,.62,.8)),-1==this.btn_buy.getChildIndex(this.ani)&&h.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_buy),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_buy.getChildIndex(this.ani)&&this.btn_buy.removeChild(this.ani))}}},t}(ui.activity.item.ShopLimitItemUI);e.ShopLimitItem=g}),define("src/g/activity/view/ShopLimitPage",["require","exports","src/g/activity/view/item/ShopLimitItem","../../../core/E","../../../enum/EventName","../../../utils/system/DateUitl","../../../utils/system/ServerTime","../../../config/GameConfig","../../../manager/RoleCenter","../../../manager/GameSocketManager","../../net/messages/OpResultGS2C","../../net/messages/OpResultType","src/g/clearRes/ClearResM","../../../manager/ActivityManager"],function(t,e,i,n,s,o,a,h,c,r,l,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(e){function t(){var t=e.call(this)||this;return t._lastDayIdx=-1,t._activityId=0,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=100,t.list.itemRender=i.ShopLimitItem,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,t,t.updateHandler),r.GSM.ins.on(l.OpResultGS2C.KEY,t,t.onOpResult),t}return __extends(t,e),t.prototype.onOpResult=function(t){t.msgidx==u.enumOpResultType.activity_nextDay&&(this.updateUnchanged(),this.updateListData())},t.prototype.updateHandler=function(t,e){this._activityId==e&&this.refresh()},t.prototype.renderHandler=function(t,e){t.setData(this._activityId,this.list.array[e])},t.prototype.showPage=function(t,e){this._activityId!=t?this._activityId=t:p.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.updateUnchanged(),this.updateListData(),this.cooldownHandler(),e.addChild(this),d.ActivityManager.ins.activityRead(this._activityId)},t.prototype.onTimeSpanHandler=function(t){var e=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&(this.updateUnchanged(),this.updateListData())},t.prototype.updateUnchanged=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){this._lastDayIdx=o.DateUtil.getDayFromStartTime(t.startTime+5,a.ServerTime.ACTIVITY_TIME_OFFSET);var e=h.GameConfig.activityJson[t.cfgId];this.bg_img.skin="dynamic/activity/limit_gift/"+e.bg_img+".png",this.desc_txt.text=e.desc,this._childIndexArr=[];for(var i=t.children.length,n=0;n<i;){var s=t.children[n];h.GameConfig.subActivityJson[s.cfgId].value==this._lastDayIdx&&this._childIndexArr.push(n),n++}}else console.log("没有找到数据，类型：limit_gift")},t.prototype.updateListData=function(){this._childIndexArr.sort(this.childSortFun.bind(this)),this.list.array=this._childIndexArr},t.prototype.childSortFun=function(t,e){var i=c.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=i.children[t],s=i.children[e],o=h.GameConfig.subActivityJson[n.cfgId],a=h.GameConfig.subActivityJson[s.cfgId],r=o?o.childId+100:100,l=a?a.childId+100:100;return 0<o.value2-n.count?r-=100:r+=100,0<a.value2-s.count?l-=100:l+=100,r-l},t.prototype.getActivityId=function(){return this._activityId},t.prototype.refresh=function(){this.list.refresh()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),p.ClearResM.clearFolderByUrl("dynamic/activity/limit_gift/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.updateHandler),this.hidePage(),e.prototype.destroy.call(this),Laya.loader.clearRes(this.bg_img.skin)},t.prototype.cooldownHandler=function(){var t=o.DateUtil.getZeroTime()-a.ServerTime.serverTime;0<t?this.time_txt.changeText(o.DateUtil.getHMS_countdown(t)):this.time_txt.changeText("00:00:00"),Laya.timer.once(1e3,this,this.cooldownHandler)},t}(ui.activity.pages.Limit_GiftUI);e.ShopLimitPage=g}),define("src/g/activity/view/SpecialGiftPage",["require","exports","../../../config/GameConfig","../../../utils/ItemUtils","../../../utils/system/DateUitl","../../../utils/system/ServerTime","../../../manager/GameSocketManager","../../net/messages/activity/ActivityGet","../../../manager/RoleCenter","../../../utils/system/FloatEffect","src/g/Effects/UIEffectsFactory","../../../core/E","../../../enum/EventName","../../../plugin/view/ToolTip","src/g/peronboss/view/ItemIconView","src/g/clearRes/ClearResM","src/init/Switches","../../../meta/QualiyVo","src/init/TextConst","../../../manager/ActivityManager"],function(t,e,c,l,i,n,s,o,u,a,h,r,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(e){function t(){var t=e.call(this)||this;return t._isRequestBuy=!1,t._selectIndex=0,t._activityId=0,t.list_child.scrollBar.elasticDistance=100,t.list_child.scrollBar.on(Laya.Event.END,t,t.onScrollEndHandler),t.list_child.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t.list_child.selectHandler=new Laya.Handler(t,t.onSelectHandler),t.btn_buy.on(Laya.Event.CLICK,t,t.onBuyHandler),t.ani=h.UIEffectsFactory.Ins.createSAniAndCenter(t.btn_buy,40),t.ani.visible=!1,r.E.ins.on(p.EventName.ACTIVITY_DATA_CHANGED,t,t.onDataUpdateHandler),t.btn_turn_right.on(Laya.Event.CLICK,t,t.onTurnRight),t.btn_turn_left.on(Laya.Event.CLICK,t,t.onTurnLeft),t}return __extends(t,e),t.prototype.onTurnLeft=function(){this.list_child.scrollBar.value=0,this.onScrollEndHandler()},t.prototype.onTurnRight=function(){this.list_child.scrollBar.value=this.list_child.scrollBar.max,this.onScrollEndHandler()},t.prototype.onScrollEndHandler=function(){this.btn_turn_right.visible=this.btn_turn_left.visible=!1,0<this.list_child.scrollBar.max&&(10<this.list_child.scrollBar.value&&(this.btn_turn_left.visible=!0),this.list_child.scrollBar.value<this.list_child.scrollBar.max-10&&(this.btn_turn_right.visible=!0))},t.prototype.onListRenderHandler=function(t,e){var i=c.GameConfig.subActivityJson[t.dataSource.cfgId];t.img_icon.skin="dynamic/activity/special_gift/"+i.childId+".png",t.img_got.visible=!1,0<i.value2&&i.value2-t.dataSource.count<=0&&(t.img_got.visible=!0)},t.prototype.onSelectHandler=function(t){this.show(t)},t.prototype.onBuyHandler=function(){var t=this._data.children[this._selectIndex],e=c.GameConfig.subActivityJson[t.cfgId];if(0<e.value2&&e.value2-t.count<=0)a.FE.upItems(m.TextConst.get(218),d.BubbleEnum.center);else if(0<e.viplevel&&u.RoleCenter.instans.vo.VIP<e.viplevel)a.FE.upItems(m.TextConst.get(219),d.BubbleEnum.center);else if("MONEY"==e.cost[0][0]&&u.RoleCenter.instans.vo.MONEY<e.cost[0][1])a.FE.upItems(m.TextConst.get(220),d.BubbleEnum.center);else if("GOLD"==e.cost[0][0]&&u.RoleCenter.instans.vo.GOLD<e.cost[0][1])f.Switches.ins.event(155);else{this._isRequestBuy=!0;var i=new o.ActivityGetC2GS;i.id=this._data.id,i.activity2CfgId=t.cfgId,s.GSM.sendServer(i)}},t.prototype.show=function(t){this._selectIndex=t;for(var e=0;e<6;e++)this["item_iitem_"+e].visible=!1;var i=this._data.children[t].cfgId,n=c.GameConfig.subActivityJson[i];this.bg_img.skin="dynamic/activity/special_gift/"+n.image+".png";var s=n.bonus;for(e=0;e<s.length;e++){this["item_iitem_"+e].visible=!0;var o=s[e][0],a=s[e][1],r=l.ItemUtils.getItemOrEq(o);this["item_iitem_"+e].ani_sp.removeChildren(),5!=r.quality&&6!=r.quality||h.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this["item_iitem_"+e].ani_sp,y.QualityStruct.Ins.getQEffById(r.quality)),g.ItemIconView.setItemData(r,this["item_iitem_"+e],a)}this.cost_txt.text=n.cost[0][1]+"",this.gif_name.text=n.title,this.updateTime(),this.btn_buy.visible=!0,this.ani.visible=!0,0<n.value2&&n.value2-this._data.children[t].count<=0&&(this.ani.visible=!1,this.btn_buy.visible=!1),0<n.viplevel&&u.RoleCenter.instans.vo.VIP<n.viplevel&&(this.ani.visible=!1),"MONEY"==n.cost[0][0]&&u.RoleCenter.instans.vo.MONEY<n.cost[0][1]&&(this.ani.visible=!1),"GOLD"==n.cost[0][0]&&u.RoleCenter.instans.vo.GOLD<n.cost[0][1]&&(this.ani.visible=!1)},t.prototype.updateTime=function(){this.time_count.text=m.TextConst.get(82,i.DateUtil.remainingTimeStr(this._data.rewardTime-n.ServerTime.serverTime))},t.prototype.onDataUpdateHandler=function(t,e){if(this._data.id==e){this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_child.refresh();var i=this.findCanBuyIndex();this._isRequestBuy&&-1!=i&&i!=this.list_child.selectedIndex?this.list_child.selectedIndex=i:this.show(this._selectIndex),this.list_child.refresh()}},t.prototype.findCanBuyIndex=function(){if(u.RoleCenter.instans.vo.getActivity1Data(this._activityId))for(var t=this.list_child.array[this._selectIndex],e=c.GameConfig.subActivityJson[t.cfgId],i=this.list_child.array.length,n=0;n<i;){t=this.list_child.array[n];if((e=c.GameConfig.subActivityJson[t.cfgId])&&0<e.value2-t.count)return n;n++}return-1},t.prototype.showView=function(t,e){this._data=t,this._childIndexArr=this._data.children,this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_child.array=this._childIndexArr,this.list_child.selectedIndex=0,this.onScrollEndHandler(),Laya.timer.clear(this,this.updateTime),Laya.timer.loop(6e4,this,this.updateTime)},t.prototype.childSortFun=function(t,e){var i=u.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=c.GameConfig.subActivityJson[t.cfgId],s=c.GameConfig.subActivityJson[e.cfgId],o=t,a=e,r=i.children.length,l=n?n.childId:0;0<n.value2&&n.value2-o.count<=0&&(l+=r),0<l&&(l%=100);var h=s?s.childId:0;return 0<s.value2&&s.value2-a.count<=0&&(h+=r),0<h&&(h%=100),l-h},t.prototype.showPage=function(t,e){if(this._activityId!=t){this._activityId=t;var i=u.RoleCenter.instans.vo.getActivity1Data(t),n=c.GameConfig.activityJson[i.cfgId];this.showView(i,n)}else v.ClearResM.resetViewImg(this);this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_child.refresh();var s=this.findCanBuyIndex();-1!=s?s!=this.list_child.selectedIndex&&(this.list_child.selectedIndex=s):-1==this.list_child.selectedIndex&&(this.list_child.selectedIndex=0),this.list_child.refresh(),e.addChild(this),r.E.ins.on(p.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),_.ActivityManager.ins.activityRead(this._activityId)},t.prototype.getActivityId=function(){return this._activityId},t.prototype.onTimeSpanHandler=function(t){var e=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.refresh=function(){this.show(this._selectIndex)},t.prototype.hidePage=function(){r.E.ins.off(p.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),v.ClearResM.clearFolderByUrl("dynamic/activity/special_gift/"),this._isRequestBuy=!1},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){r.E.ins.off(p.EventName.ACTIVITY_DATA_CHANGED,this,this.onDataUpdateHandler),this.hidePage(),e.prototype.destroy.call(this),Laya.loader.clearRes(this.bg_img.skin)},t}(ui.activity.pages.SpecialGiftUI);e.SpecialGiftPage=C}),define("src/g/activity/view/pages/CompeteUtil",["require","exports","../../../../manager/RoleCenter","../../../../utils/ItemUtils","../../../net/messages/sbkFormula"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){}return t.getValueByActivityTrigger=function(t){switch(t){case a.SubValue_Stone:return i.RoleCenter.instans.vo.getAllGemLv()+"";case a.SubValue_Suit:return i.RoleCenter.instans.vo.getAllSuitCombat()+"";case a.SubValue_LongSoul:return i.RoleCenter.instans.vo.getAllLongSoulLv()+"";case a.SubValue_Power:return i.RoleCenter.instans.vo.combat+"";case a.SubValue_Wing:return i.RoleCenter.instans.vo.getAllWingCombat()+"";case a.SubValue_Level:return n.ItemUtils.getSelfLvString();case a.SubValue_JingMai:return i.RoleCenter.instans.vo.getAllJingMaiStage()+"";case a.SubValue_LongWen:return i.RoleCenter.instans.vo.getAllLongWenLv()+"";case a.SubValue_WingLevel:return i.RoleCenter.instans.vo.getAllWingLevel()+"";case a.SubValue_Card:return s.sbkFormula.calPropFightMainCombat(i.RoleCenter.instans.vo.prop_handbook)*i.RoleCenter.instans.vo.getHeros().length+"";case a.SubValue_EquipPower:return i.RoleCenter.instans.vo.getAllEquipCombat()+"";case a.SubValue_shenzhuPower:return i.RoleCenter.instans.vo.getShenZhuPower()+"";case a.SubValue_Equip56Power:return i.RoleCenter.instans.vo.getAllEquipCombatByQuality56()+"";case a.SubValue_WingEquipPower:return i.RoleCenter.instans.vo.getAllWingEquipPower()+"";case a.SubValue_shenzhuNum:return i.RoleCenter.instans.vo.getShenZhuCount()+"";case a.SubValue_WingEquipALLv:return i.RoleCenter.instans.vo.getAllWingEquipLv()+"";case a.SubValue_zhanwenPower:return i.RoleCenter.instans.vo.getZhanwenAllPower()+""}},t}();e.CompeteUtil=o;var a=function(){function t(){}return t.SubValue_Level="SubValue_Level",t.SubValue_Equip56Power="SubValue_Equip56Power",t.SubValue_WingLevel="SubValue_WingLevel",t.SubValue_Power="SubValue_Power",t.SubValue_shenzhuNum="SubValue_shenzhuNum",t.SubValue_WingEquipALLv="SubValue_WingEquipALLv",t.SubValue_zhanwenPower="SubValue_zhanwenPower",t.SubValue_shenzhuPower="SubValue_shenzhuPower",t.SubValue_WingEquipPower="SubValue_WingEquipPower",t.SubValue_Stone="SubValue_Stone",t.SubValue_LongSoul="SubValue_LongSoul",t.SubValue_Suit="SubValue_Suit",t.SubValue_Wing="SubValue_Wing",t.SubValue_Card="SubValue_Card",t.SubValue_EquipPower="SubValue_EquipPower",t.SubValue_LongWen="SubValue_LongWen",t.SubValue_JingMai="SubValue_JingMai",t.Consume_Item220="Consume_Item220",t.Consume_Item105="Consume_Item105",t.SubValue_shenzhuNum1="SubValue_shenzhuNum1",t.Add_ZSEXP="Add_ZSEXP",t.Lottery_Equip="Lottery_Equip",t.Consume_Gold="Consume_Gold",t.Lottery_ZhanWen="Lottery_ZhanWen",t.Recharge_TianTian="Recharge_TianTian",t.Recharge_First="Recharge_First",t.RedPacket="RedPacket",t}();e.svrActivityTrigger=a}),define("src/g/activity/view/item/CompeteRewardGetItem",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../config/GameConfig","src/g/Effects/UIEffectsFactory","../../../net/messages/enumStatus","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.onClickHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.setData=function(t,e,i){this.subActivity=t,this._activityId=e;var n=s.GameConfig.subActivityJson[t.cfgId];n&&(this.lab_title.changeText(n.title),this.ani||(this.ani=o.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_get,42)),t.status==a.enumStatus.weiwancheng?(this.btn_get.disabled=!0,this.btn_get.label=h.TextConst.get(204),this.ani.visible=!1):t.status==a.enumStatus.kelingqu?(this.btn_get.disabled=!1,this.btn_get.label=h.TextConst.get(204),this.ani.visible=!0):t.status==a.enumStatus.yilingqu&&(this.btn_get.disabled=!0,this.btn_get.label=h.TextConst.get(211),this.ani.visible=!1),this.list_item.array=n.bonus)},t.prototype.onClickHandler=function(){if(this.subActivity&&this.subActivity.status==a.enumStatus.kelingqu){var t=new r.ActivityGetC2GS;t.id=this._activityId,t.activity2CfgId=this.subActivity.cfgId,l.GSM.sendServer(t)}},t}(ui.activity.item.CompeteRewardGetItemUI);e.CompeteRewardGetItem=c}),define("src/g/activity/view/pages/CompeteRewardGetDlg",["require","exports","../../../../core/E","../../../../enum/EventName","../../../../config/GameConfig","../../../../manager/RoleCenter","src/g/activity/view/item/CompeteRewardGetItem"],function(t,e,o,a,r,l,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.list_main.scrollBar.elasticDistance=100,t.list_main.itemRender=i.CompeteRewardGetItem,t.list_main.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t}return __extends(t,e),t.prototype.onListRenderHandler=function(t,e){t.setData(t.dataSource,this._activityId,this._currTitle)},t.prototype.showBox=function(t){this._activityId=t;var e=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=r.GameConfig.activityRankJson;for(var n in i){var s=i[n];if(s.activityId==e.cfgId){this._currTitle=s.title;break}}}this.refreshData(),o.E.ins.on(a.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.popup()},t.prototype.refreshData=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children.concat();e.sort(this.childSortFun),this.list_main.array=e}},t.prototype.childSortFun=function(t,e){var i=r.GameConfig.subActivityJson[t.cfgId],n=r.GameConfig.subActivityJson[e.cfgId];return i.childId-n.childId},t.prototype.onCloseHandler=function(){this.close()},t.prototype.onClosed=function(){e.prototype.onClosed.call(this),o.E.ins.off(a.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refreshData()},t}(ui.activity.pages.CompeteRewardGetDlgUI);e.CompeteRewardGetDlg=n}),define("src/g/activity/view/Stone_Compete",["require","exports","src/g/activity/view/RankViewActivity","../../../core/E","../../../enum/EventName","src/g/Effects/UIEffectsFactory","../../../utils/UIUtils","../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../config/GameConfig","src/g/activity/view/item/RankActivityItem","src/g/activity/view/pages/CompeteUtil","../../../utils/ItemUtils","../../../component/GAnimation","../../../manager/RoleCenter","../../net/messages/activity/ActivityGet","src/init/TextConst","src/init/Switches","../../../utils/system/DateUitl","../../../utils/system/ServerTime","../../net/messages/enumStatus","src/g/clearRes/ClearResM","src/g/activity/view/pages/CompeteRewardGetDlg","../../../utils/RollBoxUtil","../../../manager/GameSocketManager"],function(t,e,i,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t._rankList=[],t.arr_rollBox=[],t._currTitle="",t._activityId=0,t.btn_rank.on(Laya.Event.CLICK,t,t.clickHandler),s.E.ins.on(o.EventName.ACTIVITY_DATA_CHANGED,t,t.onDataUpdateHandler),t.ani_put=a.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.btn_get,40),t.ani_put.visible=!1,t.box_1.itemRender=ui.custom.ItemNameViewUI,t.box_1.renderHandler=new Laya.Handler(t,t.onListRender2),t.box_1.clickHandler=new Laya.Handler(t,t.onMouseHandler),t.box_2.itemRender=ui.custom.Item0ViewUI,t.box_2.renderHandler=new Laya.Handler(t,t.onListRender),t.box_2.clickHandler=new Laya.Handler(t,t.onMouseHandler),t.box_3.itemRender=ui.custom.Item0ViewUI,t.box_3.renderHandler=new Laya.Handler(t,t.onListRender),t.box_3.clickHandler=new Laya.Handler(t,t.onMouseHandler),t.box_4.itemRender=ui.custom.Item0ViewUI,t.box_4.renderHandler=new Laya.Handler(t,t.onListRender),t.box_4.clickHandler=new Laya.Handler(t,t.onMouseHandler),r.UIUtils.initHtmlDiv(t.htxt_desc,"#e1a32a");for(var e=0;e<3;e++){var i=new S.RollBoxUtil;i.setData(t["box_roll"+(e+1)],500,25),t.arr_rollBox.push(i)}return t}return __extends(t,n),t.prototype.onListRender=function(t,e){l.ItemCellUtils.fillCellForItem0View(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onListRender2=function(t,e){l.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){h.ItemTips.ins.showTip(e.dataSource[0],Number(e.dataSource[1]))},t.prototype.selectActivityHandler=function(t){console.log("切换到我这边了....")},t.prototype.onDataUpdateHandler=function(t,e){this._data.id==e&&this.updateReward()},t.prototype.clickHandler=function(){this._rankView=new i.RankViewActivity,this._rankView.btn_back.on(Laya.Event.CLICK,this,this.backHandler),this._rankView.btn_close.on(Laya.Event.CLICK,this,this.backHandler);var t=this._rankList.concat();this._rankView.setData(t),this._rankView.popup()},t.prototype.updateItemShow=function(){if(this._data){var t=c.GameConfig.activityRankJson;u.RankActivityItem.rankArr=[];var e=c.GameConfig.activityJson[this._data.cfgId];u.RankActivityItem.isShowLevel=e.trigger==p.svrActivityTrigger.SubValue_Level,this.img_stage.visible=!1;var i=this.img_title;for(var n in t){var s=t[n];if(s.activityId==this._data.cfgId){this._currTitle=s.title;var o=s.rank[0];if(1==o){var a,r,l=s.bonus.length,h=0;for(i.visible=!0;h<l;){if(a=s.bonus[h][0],r=c.GameConfig.fashionJson[a]){this.loadFasionAni(r),i.visible=!1;break}if(r=c.GameConfig.titleJSON[a]){this.loadTitleAni(r),i.visible=!1;break}h++}this.box_1.array=s.bonus,this.lab_name1.visible=!1,this.lab_value.visible=!1,this.lab_wait1.visible=!0,this.lab_desc0.text=s.desc,this.box_roll1.y=240,u.RankActivityItem.rankArr[0]=s}else 2==o?(this.box_2.array=s.bonus,this.lab_name2.visible=!1,this.lab_wait2.visible=!0,this.lab_desc1.text=s.desc,u.RankActivityItem.rankArr[1]=s):3==o?(this.box_3.array=s.bonus,this.lab_name3.visible=!1,this.lab_wait3.visible=!0,this.lab_desc2.text=s.desc,u.RankActivityItem.rankArr[2]=s):4==o&&(this.box_4.array=s.bonus,this.lab_desc3.text=s.desc,u.RankActivityItem.rankArr[3]=s)}}}},t.prototype.loadTitleAni=function(t){var e;this.img_stage.visible=!0;for(var i=this.box_title.numChildren;0<i;)if(e=this.box_title.getChildAt(0)){e.stop(),e.clear();break}e||((e=new g.GAnimation).isLoadedShow=!0,e.x=this.box_title.width/2,e.y=this.box_title.height/2,this.box_title.addChild(e));var n="dynamic2/chenghao/"+t.icon+".json";e.load(n)},t.prototype.loadFasionAni=function(t){for(var e,i=v.RoleCenter.instans.vo.getSex(),n=this.box_title.numChildren;0<n;)if(e=this.box_title.getChildAt(0)){e.stop(),e.clear();break}e||((e=new g.GAnimation).isLoadedShow=!0,this.box_title.addChild(e)),e.x=this.box_title.width/2,e.y=this.box_title.height/2;var s=t.getResType();0==s?(e.y+=40,e.scale(.7,.7)):1==s?(e.scale(.6,.6),e.x+=100,e.y+=50):2==s&&(e.y-=70,e.scale(.7,.7));var o=d.ItemUtils.getAvtoarSource(t.res,s,i);e.load(o)},t.prototype.onShowItemTip=function(t,e){h.ItemTips.ins.showTip(t,e)},t.prototype.getrankHandler=function(t){if(t.opresult&&t.id==this._activityId){this._rankList=t.rankArr;for(var e,i=this._rankList?this._rankList.length:0,n=0,s=0;n<i;)e=this._rankList[n],0==n&&""!=e.nickname?(this.box_roll1.y=230,this.lab_name1.visible=!0,this.lab_value.visible=!0,this.lab_wait1.visible=!1,this.lab_name1.text=e.nickname,this.lab_value.changeText(this.getLevelStr(e.value1))):1==n&&""!=e.nickname?(this.lab_name2.visible=!0,this.lab_wait2.visible=!1,this.lab_name2.text=e.nickname):2==n&&""!=e.nickname&&(this.lab_name3.visible=!0,this.lab_wait3.visible=!1,this.lab_name3.text=e.nickname),e.username==v.RoleCenter.instans.vo.username&&(s=n+1),n++;this.lab_rank.changeText(0<s?s.toString():y.TextConst.get(223))}},t.prototype.getLevelStr=function(t){var e=v.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=c.GameConfig.activityJson[e.cfgId];return this._currTitle+":"+(i.trigger==p.svrActivityTrigger.SubValue_Level?d.ItemUtils.getLVString(t):t)}},t.prototype.showView=function(t,e,i){if(void 0===i&&(i=!0),this._data=t,this.updateItemShow(),this._rankView&&this._rankView.removeSelf(),i){E.GSM.ins.on(f.ActivityGetRankGS2C.KEY,this,this.getrankHandler);var n=new f.ActivityGetRankC2GS;n.id=t.id,E.GSM.sendServer(n)}this.updateReward(),this.img_gg.visible=!1;var s,o=t.children[0];o&&(s=c.GameConfig.subActivityJson[o.cfgId])&&s.image&&(this.img_gg.visible=!0,this.img_gg.skin="dynamic/activity/stone_compete/"+s.image+".png",this.img_gg.on(Laya.Event.CLICK,this,this.gotoHandler,[s])),this.img_title.skin="dynamic/activity/stone_compete/"+e.trigger+"_0.png",this.img_fight.skin="dynamic/activity/stone_compete/"+e.trigger+"_1.png",this.title_img.skin="dynamic/activity/stone_compete/"+e.bg_img+".png",this.btn_get.label=s.desc,this.btn_get.offAll(),this.btn_get.on(Laya.Event.CLICK,this,this.gotoModuleHandler,[e]);for(var a=0;a<this.arr_rollBox.length;a++){var r=this.arr_rollBox[a];r.stop(),"1"!=e.checkrank?r.play():r.showItem(1)}Math.floor(t.recharge/100)},t.prototype.gotoModuleHandler=function(t){t.module&&0<t.module.length&&m.Switches.ins.event(t.module[0][1],[!1,!0,t.module[1][1]])},t.prototype.gotoHandler=function(t){t.moduleID&&0<t.moduleID.length&&m.Switches.ins.event(t.moduleID[0][1],[!1,!0,t.moduleID[1][1]])},t.prototype.updateReward=function(){var t=c.GameConfig.activityJson[this._data.cfgId];this.time_txt.changeText(_.DateUtil.remainingTimeStr(this._data.rewardTime-C.ServerTime.serverTime)),this.desc_txt.text=t.desc,this.refreshTextToNew()},t.prototype.getReward=function(){for(var t=this._data.children?this._data.children.length:0,e=0;e<t;){var i=this._data.children[e];if(i&&i.cfgId==this.showActivity2CfgId){if(i.status==I.enumStatus.kelingqu){var n=new f.ActivityGetC2GS;n.id=this._data.id,n.activity2CfgId=this.showActivity2CfgId,E.GSM.sendServer(n)}break}e++}},t.prototype.showPage=function(t,e){if(this._activityId!=t){this._activityId=t;var i=v.RoleCenter.instans.vo.getActivity1Data(t),n=c.GameConfig.activityJson[i.cfgId];this.showView(i,n)}else this.refresh(),b.ClearResM.resetViewImg(this);e.addChild(this)},t.prototype.getActivityId=function(){return this._activityId},t.prototype.refreshTextToNew=function(){var t=v.RoleCenter.instans.vo.getActivity1Data(this._activityId);Math.floor(t.recharge/100);if(this._data){this.lab_lv_lab.changeText(this._currTitle+":");var e=v.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=c.GameConfig.activityJson[e.cfgId].trigger==p.svrActivityTrigger.SubValue_Level?d.ItemUtils.getLVString(this._data.allData.allCount):this._data.allData.allCount.toString();this.lab_lv.changeText(i.toString())}}},t.prototype.refresh=function(){var t=new f.ActivityGetRankC2GS;t.id=this._data.id,E.GSM.sendServer(t),this.refreshTextToNew(),this.updateItemShow()},t.prototype.hidePage=function(){for(var t=0;t<this.arr_rollBox.length;t++)this.arr_rollBox[t].stop();this.removeSelf(),b.ClearResM.clearFolderByUrl("dynamic/activity/stone_compete/")},t.prototype.backHandler=function(){return!this._rankView||!this._rankView.displayedInStage||(this._rankView.close(),!1)},t.prototype.doDestroy=function(){E.GSM.ins.off(f.ActivityGetRankGS2C.KEY,this,this.getrankHandler),s.E.ins.off(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onDataUpdateHandler),this.hidePage(),n.prototype.destroy.call(this),b.ClearResM.clearUrl(this.title_img.skin)},t.prototype.onOpenGetRewardDlg=function(){0<this._activityId&&(this._getRewardDlg||(this._getRewardDlg=new w.CompeteRewardGetDlg),this._getRewardDlg.showBox(this._activityId))},t}(ui.activity.pages.Stone_CompeteUI);e.Stone_Compete=n}),define("src/g/activity/view/item/KillBossGroupItem",["require","exports","../../../../utils/ItemUtils"],function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.show=function(t,e){var i=n.ItemUtils.getBossId(t);i&&(this.m_icon.skin=n.ItemUtils.getBossIconByPort(i.port),this.lab_name.color=e?"#999999":"#e3cca9",this.lab_name.changeText(i.name),this.img_kill.visible=e,this.m_icon.gray=e)},e}(ui.activity.item.BossHeadItemUI);e.KillBossGroupItem=i}),define("src/g/activity/view/pages/KillBossGroupPage",["require","exports","../../../../enum/EventName","../../../../core/E","../../../../manager/RoleCenter","../../../../utils/system/DateUitl","../../../../config/GameConfig","../../../net/messages/enumStatus","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","src/g/Effects/UIEffectsFactory","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","src/g/activity/view/item/KillBossGroupItem","../../../../meta/MainButtonVo","../../../../utils/system/ServerTime","src/g/clearRes/ClearResM","src/init/TextConst"],function(t,e,i,n,o,s,l,h,a,r,c,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t._requestFlg=!1,t._selectIndex=-1,t._lastSelectIndex=-1,t._bossHeadPool=[],t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):f.ClearResM.resetViewImg(this),this.findFirstShowItem(),this.updateSelectItem(),n.E.ins.on(i.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this)},t.prototype.refresh=function(){this.updateSelectItem()},t.prototype.hidePage=function(){n.E.ins.off(i.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),f.ClearResM.clearFolderByUrl("dynamic/activity/kill_boss_group/")},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this),Laya.loader.clearRes(this.bg_img.skin)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.updateSelectItem()},t.prototype.showView=function(t,e){this._activityId!=t.id&&(this._activityId=t.id,this.updateUnchanged(),this.findFirstShowItem(),this.updateSelectItem()),n.E.ins.on(i.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged)},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_item.itemRender=ui.custom.ItemNameViewUI,this.list_item.spaceX=-11,this.list_item.renderHandler=new Laya.Handler(this,this.onRenderHandler),this.list_item.clickHandler=new Laya.Handler(this,this.onMouseHandler),this.boss_head_con.scrollRect=new Laya.Rectangle(0,0,this.boss_head_con.width,this.boss_head_con.height),this.btn_get.on(Laya.Event.CLICK,this,this.doGetRewardHandler),this.ani=c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_get,40),this.ani.visible=!1,this.btn_turn_left.on(Laya.Event.CLICK,this,this.onTurnLeftHandler),this.btn_turn_right.on(Laya.Event.CLICK,this,this.onTurnRightHandler)},t.prototype.onRenderHandler=function(t,e){a.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t){var e=this.list_item.array[t];r.ItemTips.ins.showTip(e[0],Number(e[1]))},t.prototype.onTurnLeftHandler=function(){!this._switching&&0<this._selectIndex&&(this._selectIndex--,this.updateSelectItem())},t.prototype.onTurnRightHandler=function(){!this._switching&&this._selectIndex<this._childIndexArr.length-1&&(this._selectIndex++,this.updateSelectItem())},t.prototype.doGetRewardHandler=function(){var t=this.getSelectSubActivity();if(t)if(t.status==h.enumStatus.kelingqu){this._requestFlg=!0;var e=new u.ActivityGetC2GS;e.id=this._activityId,e.activity2CfgId=t.cfgId,p.GSM.sendServer(e)}else if(t.status==h.enumStatus.weiwancheng){var i=l.GameConfig.subActivityJson[t.cfgId];g.MainButtonStruct.Ins.OpenModule(i.moduleID[0][1],i.moduleID[1][1])}},t.prototype.updateUnchanged=function(){var t=o.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=l.GameConfig.activityJson[t.cfgId];this.time_txt.changeText(s.DateUtil.remainingTimeStr(t.rewardTime-v.ServerTime.serverTime)),this.desc_txt.changeText(e.desc),this._childIndexArr=[];for(var i=t.children.length,n=0;n<i;)this._childIndexArr.push(n),n++;this._childIndexArr.sort(this.childSortFun.bind(this))}else console.log("没有找到数据，类型：KillBossGroup")},t.prototype.childSortFun=function(t,e){var i=o.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=l.GameConfig.subActivityJson[i.children[t].cfgId],s=l.GameConfig.subActivityJson[i.children[e].cfgId];return n.childId-s.childId},t.prototype.findFirstShowItem=function(){var t,e=o.RoleCenter.instans.vo.getActivity1Data(this._activityId),i=this._childIndexArr?this._childIndexArr.length:0,n=0;for(this._selectIndex=0<i?0:-1;n<i;){if(t=this._childIndexArr[n],e.children[t].status!=h.enumStatus.yilingqu){this._selectIndex=n;break}n++}this._requestFlg=!1},t.prototype.updateSelectItem=function(){var t=this.getSelectSubActivity();if(t){var e=l.GameConfig.subActivityJson[t.cfgId];if(t.status==h.enumStatus.weiwancheng)this.btn_get.disabled=!0,this.btn_get.label=y.TextConst.get(204),this.ani.visible=!1,e.moduleID&&0<e.moduleID.length&&(this.btn_get.disabled=!1,this.btn_get.label=y.TextConst.get(200));else if(t.status==h.enumStatus.kelingqu)this.btn_get.disabled=!1,this.btn_get.label=y.TextConst.get(204),this.ani.visible=!0;else if(t.status==h.enumStatus.yilingqu&&(this.btn_get.disabled=!0,this.btn_get.label=y.TextConst.get(211),this.ani.visible=!1,this._requestFlg))return this.findFirstShowItem(),void this.updateSelectItem();this.bg_img.skin="dynamic/activity/kill_boss_group/"+e.image+".png",this.list_item.array=e.bonus,this.switchBossHeadList(t)}},t.prototype.switchBossHeadList=function(t){var e=this;if(this._switching)Laya.timer.once(300,this,this.switchBossHeadList,[t],!0);else{var i=0,n=0;this._selectIndex>this._lastSelectIndex?(i-=this.boss_head_con.width,n+=this.boss_head_con.width):this._selectIndex<this._lastSelectIndex&&(i+=this.boss_head_con.width,n-=this.boss_head_con.width);for(var s,o=l.GameConfig.subActivityJson[t.cfgId],a=this.boss_head_con.numChildren,r=0;r<a;)s=this.boss_head_con.getChildAt(r),0==i?s.show(o.activityChildId[r],t.childCountArr[r]>=o.value):Laya.Tween.to(s,{x:s.x+i},300,Laya.Ease.circIn,new Laya.Handler(this,function(t){t.removeSelf(),e._bossHeadPool.push(t)},[s])),r++;if(0!=i){for(a=o.activityChildId.length,r=0;r<a;)(s=this.createBossHead()).x=n,s.show(o.activityChildId[r],t.childCountArr[r]>=o.value),this.boss_head_con.addChild(s),Laya.Tween.to(s,{x:s.x+i},300,Laya.Ease.circIn),n+=s.width+18,r++;this._switching=!0,Laya.timer.once(300,this,function(){e._switching=!1,e._lastSelectIndex=e._selectIndex,e.btn_turn_left.visible=0<e._selectIndex,e.btn_turn_right.visible=e._selectIndex+1<e._childIndexArr.length&&t.status==h.enumStatus.yilingqu})}}},t.prototype.createBossHead=function(){return 0<this._bossHeadPool.length?this._bossHeadPool.pop():new d.KillBossGroupItem},t.prototype.getSelectSubActivity=function(){if(-1<this._selectIndex&&this._childIndexArr&&this._selectIndex<this._childIndexArr.length){var t=o.RoleCenter.instans.vo.getActivity1Data(this._activityId),e=this._childIndexArr[this._selectIndex];return t?t.children[e]:null}return null},t}(ui.activity.pages.Kill_Boss_GroupUI);e.KillBossGroupPage=m}),define("src/g/activity/view/item/SevenDayMenuItem",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"selected",{get:function(){return this.btn.selected},set:function(t){this.btn.selected=t},enumerable:!0,configurable:!0}),e}(ui.activity.item.ActivityMenuBtn3UI);e.SevenDayMenuItem=i}),define("src/g/activity/view/item/SevenDayMenuSubItem",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"selected",{get:function(){return this.btn.selected},set:function(t){this.btn.selected=t},enumerable:!0,configurable:!0}),e}(ui.activity.item.ActivityMenuBtn4UI);e.SevenDayMenuSubItem=i}),define("src/g/activity/view/item/SevenDayCarnivalItem",["require","exports","../../../../config/GameConfig","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../net/messages/enumStatus","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../meta/MainButtonVo","src/g/Effects/UIEffectsFactory","../../../../utils/system/ServerTime","src/init/TextConst"],function(t,e,r,i,n,l,s,o,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function a(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.onClickHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(a,e),a.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},a.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},a.prototype.setData=function(t,e){this.subActivity=t,this._activityId=e;var i=r.GameConfig.subActivityJson[t.cfgId],n=r.GameConfig.activityJson[i.activityId];if(i){this.lab_title.changeText(i.title);var s=t.count,o=i.value;if(0<i.value2&&(o=1),this.lab_count.color=o<=s?"#03bb00":"#ff0f15",this.lab_count.changeText(s+"/"+o),this.ani||(this.ani=c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_get,40,.62,.8)),t.status==l.enumStatus.weiwancheng){if(this.btn_get.disabled=!0,this.btn_get.label=p.TextConst.get(204),this.ani.visible=!1,i.moduleID&&0<i.moduleID.length)if(this.btn_get.disabled=!1,this.btn_get.label=p.TextConst.get(200),"meirichongzhi"==n.clientkey)Math.floor((u.ServerTime.serverTime-a.CARNIVAL_STARTTIME)/3600/24)!=n.startday&&(this.btn_get.label=p.TextConst.get(805),this.btn_get.disabled=!0)}else t.status==l.enumStatus.kelingqu?(this.btn_get.disabled=!1,this.btn_get.label=p.TextConst.get(204),this.ani.visible=!0):t.status==l.enumStatus.yilingqu&&(this.btn_get.disabled=!0,this.btn_get.label=p.TextConst.get(211),this.ani.visible=!1);this.list_item.array=i.bonus}},a.prototype.onClickHandler=function(){if(this.subActivity)if(this.subActivity.status==l.enumStatus.kelingqu){var t=new s.ActivityGetC2GS;t.id=this._activityId,t.activity2CfgId=this.subActivity.cfgId,o.GSM.sendServer(t)}else if(this.subActivity.status==l.enumStatus.weiwancheng){var e=r.GameConfig.subActivityJson[this.subActivity.cfgId];h.MainButtonStruct.Ins.OpenModule(e.moduleID[0][1],e.moduleID[1][1])}},a.CARNIVAL_STARTTIME=0,a}(ui.activity.item.SevenDayCarnivalItemUI);e.SevenDayCarnivalItem=a}),define("src/g/activity/view/item/SevenDayCarnivalBoxGetItem",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../config/GameConfig","src/g/Effects/UIEffectsFactory","../../../net/messages/enumStatus","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.onClickHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.setData=function(t,e){this.subActivity=t,this._activityId=e;var i=s.GameConfig.subActivityJson[t.cfgId];i&&(this.lab_title.changeText(i.title),this.ani||(this.ani=o.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_get,42)),t.status==a.enumStatus.weiwancheng?(this.btn_get.disabled=!0,this.btn_get.label=h.TextConst.get(204),this.ani.visible=!1):t.status==a.enumStatus.kelingqu?(this.btn_get.disabled=!1,this.btn_get.label=h.TextConst.get(204),this.ani.visible=!0):t.status==a.enumStatus.yilingqu&&(this.btn_get.disabled=!0,this.btn_get.label=h.TextConst.get(211),this.ani.visible=!1),this.list_item.array=i.bonus)},t.prototype.onClickHandler=function(){if(this.subActivity&&this.subActivity.status==a.enumStatus.kelingqu){var t=new r.ActivityGetC2GS;t.id=this._activityId,t.activity2CfgId=this.subActivity.cfgId,l.GSM.sendServer(t)}},t}(ui.activity.item.SevenDayCarnivalBoxGetItemUI);e.SevenDayCarnivalBoxGetItem=c}),define("src/g/activity/view/pages/SevenDayCarnivalBoxGetDlg",["require","exports","../../../../core/E","../../../../enum/EventName","src/g/activity/view/item/SevenDayCarnivalBoxGetItem","../../../../config/GameConfig","../../../../manager/RoleCenter"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.btn_back.on(Laya.Event.CLICK,t,t.onCloseHandler),t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.list_main.scrollBar.elasticDistance=100,t.list_main.itemRender=s.SevenDayCarnivalBoxGetItem,t.list_main.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t}return __extends(t,e),t.prototype.onListRenderHandler=function(t,e){t.setData(t.dataSource,this._activityId)},t.prototype.showBox=function(t){this._activityId=t,this.refreshData(),i.E.ins.on(n.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.popup()},t.prototype.refreshData=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children.concat();e.sort(this.childSortFun),this.list_main.array=e}},t.prototype.childSortFun=function(t,e){var i=o.GameConfig.subActivityJson[t.cfgId],n=o.GameConfig.subActivityJson[e.cfgId];return i.childId-n.childId},t.prototype.onCloseHandler=function(){this.close()},t.prototype.onClosed=function(){e.prototype.onClosed.call(this),i.E.ins.off(n.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refreshData()},t}(ui.activity.pages.SevenDayCarnivalBoxGetDlgUI);e.SevenDayCarnivalBoxGetDlg=r}),define("src/g/activity/view/ActivityBoxGetDlg",["require","exports","src/g/bag/tips/view/ItemTips","../../../utils/ItemCellUtils","../../../utils/UIUtils","../../../manager/FlyManager","../../../manager/GameSocketManager","../../../config/GameConfig","../../net/messages/enumStatus","src/g/Effects/UIEffectsFactory","../../net/messages/activity/ActivityGet","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.list_reward.itemRender=ui.custom.ItemNameViewUI,t.list_reward.renderHandler=new Laya.Handler(t,t.onListRender),t.list_reward.clickHandler=new Laya.Handler(t,t.onMouseListRender),t.btn_get1.on(Laya.Event.CLICK,t,t.onClickHandler),t}return __extends(t,e),t.prototype.showBox=function(t,e){this._activityId=e,this.subActivity=t;var i=r.GameConfig.subActivityJson[t.cfgId];i&&(this.ani||(this.ani=h.UIEffectsFactory.Ins.createSAniAndCenter(this.btn_get1,42,1.3,1.1)),t.status==l.enumStatus.weiwancheng?(this.btn_get1.disabled=!0,this.btn_get1.label=u.TextConst.get(204),this.ani.visible=!1):t.status==l.enumStatus.kelingqu?(this.btn_get1.disabled=!1,this.btn_get1.label=u.TextConst.get(204),this.ani.visible=!0):t.status==l.enumStatus.yilingqu&&(this.btn_get1.disabled=!0,this.btn_get1.label=u.TextConst.get(211),this.ani.visible=!1),this.list_reward.array=i.bonus,this.popup())},t.prototype.onMouseListRender=function(t){i.ItemTips.ins.showTip(this.list_reward.array[t][0],Number(this.list_reward.array[t][1]))},t.prototype.onListRender=function(t,e){n.ItemCellUtils.fillCellForItemNameView(t,this.list_reward.array[e][0],Number(this.list_reward.array[e][1]))},t.prototype.onGetSendBefor=function(){for(var t=0;t<this.list_reward.array.length;t++)o.FlyManager.ins.flyItemToBagBessel(this.list_reward.array[t][0],s.UIUtils.localToGlobal(this.list_reward.getChildAt(0),new Laya.Point));this.close()},t.prototype.onClickHandler=function(){if(this.subActivity&&this.subActivity.status==l.enumStatus.kelingqu){var t=new c.ActivityGetC2GS;t.id=this._activityId,t.activity2CfgId=this.subActivity.cfgId,a.GSM.sendServer(t)}this.onGetSendBefor()},t.prototype.onCloseHandler=function(){this.close()},t}(ui.activity.ActivityBoxGetDlgUI);e.ActivityBoxGetDlg=p}),define("src/g/activity/view/pages/SevenDayCarnivalPage",["require","exports","src/g/activity/view/item/SevenDayMenuItem","src/g/activity/view/item/SevenDayMenuSubItem","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","../../../net/messages/enumStatus","src/g/activity/view/item/SevenDayCarnivalItem","../../../../manager/GameSocketManager","../../../net/messages/OpResultGS2C","../../../net/messages/OpResultType","src/g/clearRes/ClearResM","src/g/activity/view/ActivityBoxGetDlg","src/g/Effects/UIEffectsFactory","../../../../utils/ItemUtils","../../../../utils/MathUtils","src/init/TextConst"],function(t,e,i,n,s,o,y,m,_,C,l,a,r,h,c,u,p,d,g,v,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged(),this.updateMenu()):u.ClearResM.resetViewImg(this),s.E.ins.on(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),s.E.ins.on(o.EventName.ACTIVITY_RED_UPDATE,this,this.onActRedChanged),r.GSM.ins.on(h.OpResultGS2C.KEY,this,this.onOpResult),e.addChild(this)},t.prototype.onOpResult=function(t){t.msgidx==c.enumOpResultType.activity_nextDay&&this.updateMenu()},t.prototype.refresh=function(){this.box_menu.refresh()},t.prototype.hidePage=function(){s.E.ins.off(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),s.E.ins.off(o.EventName.ACTIVITY_RED_UPDATE,this,this.onActRedChanged),this.removeSelf(),u.ClearResM.clearFolderByUrl("dynamic/activity/seven_day_carnival/")},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this),Laya.loader.clearRes(this.title_img.skin)},t.prototype.onActivityDataChanged=function(t,e){e==this._boxActUid?this.updateBoxChanged():e==this._selectActUid?this.updateListMain():e==this._activityId&&this.updateMenu()},t.prototype.showView=function(t,e){this._activityId!=t.id&&(this._activityId=t.id,this.updateUnchanged(),this.updateMenu()),s.E.ins.on(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged)},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.panel_menu.vScrollBar.elasticDistance=100,this.box_menu.spaceY=5,this.box_menu.itemRender=i.SevenDayMenuItem,this.box_menu.subItemRender=n.SevenDayMenuSubItem,this.box_menu.renderHandler=new Laya.Handler(this,this.onMainRenderHandler),this.box_menu.subRenderHandler=new Laya.Handler(this,this.onSubRenderHandler),this.box_menu.subSelectHandler=new Laya.Handler(this,this.onMenuSelectHandler),this.list_main.scrollBar.elasticDistance=100,this.list_main.itemRender=a.SevenDayCarnivalItem,this.list_main.renderHandler=new Laya.Handler(this,this.onListRenderHandler),this.box5Ani=d.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.ani_con,50,.4,.4),this.ani_con.addChild(this.box5Ani)},t.prototype.onMainRenderHandler=function(t,e){var i=t.dataSource;e=i.dataIndex;t.btn.label=i.label;var n=y.RoleCenter.instans.vo.getActivity1Data(this._activityId);a.SevenDayCarnivalItem.CARNIVAL_STARTTIME=n.startTime,t.img_red.removeSelf(),n&&n.children[e].hasRed&&t.addChild(t.img_red)},t.prototype.onSubRenderHandler=function(t,e){var i=t.dataSource,n=i.uid;t.btn.label=i.label;var s=y.RoleCenter.instans.vo.getActivity1Data(n);t.img_red.removeSelf(),s&&s.hasRed&&t.addChild(t.img_red)},t.prototype.onMenuSelectHandler=function(t){this._selectActUid=t.uid,this.updateListMain()},t.prototype.updateUnchanged=function(){var t=y.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=m.GameConfig.activityJson[t.cfgId];this.title_img.skin="dynamic/activity/seven_day_carnival/"+e.bg_img+".jpg",this.time_txt.changeText(_.DateUtil.remainingDayStr(t.rewardTime-C.ServerTime.serverTime))}else console.log("没有找到数据，类型：SevenDayCarnivalPage")},t.prototype.onActRedChanged=function(t){t==this._activityId&&this.box_menu.refresh()},t.prototype.updateMenu=function(){var t=y.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children.concat();e.sort(this.childSortFun);for(var i,n,s=e.length,o=0,a=[],r=_.DateUtil.getDayFromStartTime(t.startTime,C.ServerTime.ACTIVITY_TIME_OFFSET);o<s;){i=e[o],n=t.children.indexOf(i);var l=m.GameConfig.subActivityJson[i.cfgId].childId;if(0==l)this._boxActUid=i.childCountArr[0],this.initBox(),this.updateBoxChanged();else{var h=1==l?I.TextConst.get(1029):2==l?I.TextConst.get(1030):3==l?I.TextConst.get(1031):4==l?I.TextConst.get(1032):5==l?I.TextConst.get(1033):"",c={label:I.TextConst.get(59,h),dataIndex:n};if(l<=r){for(var u=i.childCountArr.length,p=0,d=0,g=[];p<u;){d=i.childCountArr[p];var v=y.RoleCenter.instans.vo.getActivity1Data(d);if(v){var f=m.GameConfig.activityJson[v.cfgId];g.push({label:f.name,uid:d})}p++}g&&0<g.length&&(c.children=g)}a.push(c)}o++}this.box_menu.array=a,this.box_menu.setSelectIndex(0,0)}},t.prototype.childSortFun=function(t,e){var i=m.GameConfig.subActivityJson[t.cfgId],n=m.GameConfig.subActivityJson[e.cfgId];return i.childId-n.childId},t.prototype.initBox=function(){var t=y.RoleCenter.instans.vo.getActivity1Data(this._boxActUid);if(t){var e,i,n,s=t.children.length,o=0;for(this._progressArr=[0];o<5;){if(o<s&&(e=t.children[o],i=m.GameConfig.subActivityJson[e.cfgId],this._progressArr.push(i.value),i&&5!=i.childId)){1<i.bonus.length?n=i.bonus[1][0]:0<i.bonus.length&&(n=i.bonus[0][0]);var a=g.ItemUtils.getItemOrEq(n);a&&(this["img_item"+i.childId].skin=g.ItemUtils.getIconByIconId(a.icon))}o++}}},t.prototype.updateBoxChanged=function(){var t=y.RoleCenter.instans.vo.getActivity1Data(this._boxActUid);if(t){var e=t.children.concat();e.sort(this.childSortFun);for(var i,n,s,o,a=e.length,r=0;r<5;)r<a&&(i=e[r],this["lab_title"+(n=m.GameConfig.subActivityJson[i.cfgId]).childId].changeText(n.value.toString()),(s=this["box"+n.childId]).offAll(),s.on(Laya.Event.CLICK,this,this.onClickBoxHandler,[i]),(o=this["effect"+n.childId]).visible=!1,this["img_complt"+n.childId].visible=!1,i.status==l.enumStatus.yilingqu?this["img_complt"+n.childId].visible=!0:i.status==l.enumStatus.kelingqu&&(o.visible=!0)),r++;this._progressArr&&(this.img_progress.scaleX=v.MathUtils.sectionProgress(this._progressArr,t.allData.allCount)),this.lab_kh.changeText(t.allData.allCount.toString())}},t.prototype.onClickBoxHandler=function(t){0<this._boxActUid&&(this._boxRewardDlg||(this._boxRewardDlg=new p.ActivityBoxGetDlg),this._boxRewardDlg.showBox(t,this._boxActUid))},t.prototype.updateListMain=function(){var t=y.RoleCenter.instans.vo.getActivity1Data(this._selectActUid);if(t){var e=t.children.concat();e.sort(this.mainListSortFun),this.list_main.array=e}},t.prototype.mainListSortFun=function(t,e){var i=m.GameConfig.subActivityJson[t.cfgId],n=m.GameConfig.subActivityJson[e.cfgId],s=i?i.childId+100:100,o=n?n.childId+100:100;return t.status==l.enumStatus.kelingqu?s-=100:t.status==l.enumStatus.yilingqu&&(s+=100),e.status==l.enumStatus.kelingqu?o-=100:e.status==l.enumStatus.yilingqu&&(o+=100),s-o},t.prototype.onListRenderHandler=function(t,e){t.setData(t.dataSource,this._selectActUid)},t}(ui.activity.pages.SevenDayCarnivalUI);e.SevenDayCarnivalPage=f}),define("src/g/activity/view/pages/AttackCityPreview",["require","exports","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../config/GameConfig","src/g/bag/tips/view/ItemTips","../../../../utils/ItemCellUtils","src/g/fight/osprite/play/family/SandCityFManager","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","../../../../meta/MainButtonVo","src/g/clearRes/ClearResM","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t._startTime=0,t.show_list.itemRender=ui.custom.ItemNameViewUI,t.show_list.renderHandler=new Laya.Handler(t,t.showListRenderHandler),t.show_list.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t.show_list2.itemRender=ui.custom.ItemNameViewUI,t.show_list2.renderHandler=new Laya.Handler(t,t.showListRenderHandler),t.show_list2.mouseHandler=new Laya.Handler(t,t.onMouseHandler2),t.btn_goto.on(Laya.Event.CLICK,t,t.onBtnClickHandler),t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):p.ClearResM.resetViewImg(this),this.updateTime(),e.addChild(this)},t.prototype.refresh=function(){},t.prototype.hidePage=function(){i.E.ins.off(n.EventName.SANDY_CITY_WARINFO,this,this.updateTime),Laya.timer.clearAll(this),this.removeSelf(),p.ClearResM.clearFolderByUrl("dynamic/activity/attack_city_preview/")},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this),Laya.loader.clearRes(this.title_img.skin)},t.prototype.onBtnClickHandler=function(){var t=s.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t&&0<t.children.length){var e=t.children[0];if(e){var i=o.GameConfig.subActivityJson[e.cfgId];i.moduleID&&0<i.moduleID.length&&u.MainButtonStruct.Ins.OpenModule(i.moduleID[0][1],i.moduleID[1][1])}}},t.prototype.onMouseHandler=function(t,e){t.type==Laya.Event.CLICK&&a.ItemTips.ins.showTip(this.show_list.array[e][0],Number(this.show_list.array[e][1]))},t.prototype.onMouseHandler2=function(t,e){t.type==Laya.Event.CLICK&&a.ItemTips.ins.showTip(this.show_list2.array[e][0],Number(this.show_list2.array[e][1]))},t.prototype.showListRenderHandler=function(t,e){r.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.updateUnchanged=function(){var t=s.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=o.GameConfig.activityJson[t.cfgId];this.title_img.skin="dynamic/activity/attack_city_preview/"+e.bg_img+".png",this.show_list.array=e.showList.slice(0,3),this.show_list2.array=e.showList.slice(3)}else console.log("没有找到数据，类型：KillBossGroup")},t.prototype.updateTime=function(){var t=l.SandCityFManager.getInstance().sandyCityWarInfo;t?t.firstWar?(this.time_lab_txt.changeText(d.TextConst.get(260)),this._startTime=t.openTime,this.countdown(),Laya.timer.loop(1e3,this,this.countdown)):(this.time_lab_txt.changeText(d.TextConst.get(261)),this.time_txt.changeText(d.TextConst.get(262))):(i.E.ins.once(n.EventName.SANDY_CITY_WARINFO,this,this.updateTime),l.SandCityFManager.getInstance().reqSandCityData(!0))},t.prototype.countdown=function(){this._startTime>c.ServerTime.serverTime?this.time_txt.changeText(h.DateUtil.remainingTimeStr(this._startTime-c.ServerTime.serverTime)):(this.time_lab_txt.changeText(d.TextConst.get(261)),this.time_txt.changeText(d.TextConst.get(262)),Laya.timer.clearAll(this))},t}(ui.activity.pages.AttackCityPreviewUI);e.AttackCityPreview=g}),define("src/g/activity/view/pages/GoldTurntablePage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../utils/system/FloatEffect","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../net/messages/enumStatus","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","src/g/account/ctrl/GetRewwardCtrl","../../../../manager/AM","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","src/init/TextConst","src/init/Switches"],function(t,e,s,o,a,r,l,h,c,u,p,d,n,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t._selectIndex=-1,t._turnTime=0,t._remainTimes=0,t._des=new laya.html.dom.HTMLDivElement,t._des.width=t.con_log.width=t.con_panel.width,t._des.style.font="SimHei",t._des.style.color="#e3cca9",t._des.style.fontSize=20,t._des.style.leading=8,t.con_log.addChild(t._des),t.con_panel.vScrollBar.elasticDistance=100,t.htxt_desc.style.font="SimHei",t.htxt_desc.style.color="#09d51f",t.htxt_desc.style.fontSize=18,t.htxt_desc.style.align="center",t.btn_run.on(Laya.Event.CLICK,t,t.onTurnClickHandler),t.img_arrow.rotation=0,t.on(Laya.Event.CLICK,t,t.doStopAniHandler),t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):s.ClearResM.resetViewImg(this),p.GSM.ins.on(u.ActivityGetGS2C.KEY,this,this.onActivityGetHandler),this.updateInfo(),this.updateSelectItem();var i=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(i)if(i.rewardInfo)this.onUpdateLogHandler(i.rewardInfo);else{var n=new u.GetRewardInfoC2GS;n.id=this._activityId,p.GSM.sendServer(n)}o.E.ins.on(a.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),o.E.ins.on(a.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,this,this.onUpdateLogHandler),e.addChild(this),o.E.ins.on(a.EventName.RECHARGE_SUCCESS,this,this.onRechargeSuccessHandler)},t.prototype.onRechargeSuccessHandler=function(){0==this._running&&this.updateSelectItem()},t.prototype.refresh=function(){this.updateInfo(),Laya.timer.frameOnce(2,this,this.doRefresh)},t.prototype.doRefresh=function(){0==this._running&&this.updateSelectItem()},t.prototype.hidePage=function(){o.E.ins.off(a.EventName.RECHARGE_SUCCESS,this,this.onRechargeSuccessHandler),o.E.ins.off(a.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,this,this.onUpdateLogHandler),p.GSM.ins.off(u.ActivityGetGS2C.KEY,this,this.onActivityGetHandler),o.E.ins.off(a.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),s.ClearResM.clearFolderByUrl("dynamic/activity/gold_turntable/")},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&(this.updateInfo(),this.updateSelectItem())},t.prototype.doStopAniHandler=function(){if(this._running&&this._lastGetMsg){var t=Number(this._lastGetMsg.error);Laya.Tween.clearAll(this.img_arrow),this._running=!1,-1<t&&(this.img_arrow.rotation=36*t,this._waitLog&&(this.appendLog(this._waitLog[0],this._waitLog[1],this._waitLog[2]),this._waitLog=null),r.FE.addInventoryToCFloats(this._lastGetMsg.inv),d.GetRewwardCtrl.inventoryAddGS2C(this._lastGetMsg.inv),this.updateInfo(),this.updateSelectItem())}},t.prototype.updateUnchanged=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=h.GameConfig.activityJson[t.cfgId];if(e){var i=h.GameConfig.activityWheelJson[e.value];if(i)for(var n,s=i.reward.length,o=0;o<10;)o<s&&(n=i.reward[o],this["img_"+o].skin="res/activity/gold_turntable/huodong_zhuanpan_"+n+".png"),o++}this.time_txt.changeText(g.DateUtil.remainingDayStr(t.rewardTime-v.ServerTime.serverTime)),this._childIndexArr=[];for(s=t.children.length,o=0;o<s;)this._childIndexArr.push(o),o++;this._childIndexArr.sort(this.childSortFun.bind(this))}},t.prototype.childSortFun=function(t,e){var i=l.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=h.GameConfig.subActivityJson[i.children[t].cfgId],s=h.GameConfig.subActivityJson[i.children[e].cfgId];return n.childId-s.childId},t.prototype.updateInfo=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e,i=this._childIndexArr?this._childIndexArr.length:0,n=0;for(this._selectIndex=-1,this._turnTime=0,this._remainTimes=i;n<i;)e=this._childIndexArr[n],t.children[e].status!=c.enumStatus.yilingqu?(-1==this._selectIndex&&(this._selectIndex=n),t.children[e].status==c.enumStatus.kelingqu&&this._turnTime++):this._remainTimes--,n++}},t.prototype.updateSelectItem=function(){-1==this._selectIndex?(this.htxt_desc.innerHTML=f.TextConst.get(268),this.box_invest.visible=!1):(this.htxt_desc.innerHTML=f.TextConst.get(269,this._turnTime),this.box_invest.visible=!0);var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId),e=this.getSelectSubActivity();if(e){var i=h.GameConfig.subActivityJson[e.cfgId];i&&(this._turnTime<1&&(this.htxt_desc.innerHTML=f.TextConst.get(270,i.value-t.allData.allCount)),i.cost&&this.lab_gold.changeText(i.cost[0][1].toString()))}else this.lab_gold.changeText("");this.lab_remain.changeText(this._remainTimes.toString())},t.prototype.onTurnClickHandler=function(){if(!this._running)if(0<this._turnTime){var t=this.getSelectSubActivity();if(t&&t.status==c.enumStatus.kelingqu){var e=h.GameConfig.subActivityJson[t.cfgId];if(e){if(l.RoleCenter.instans.vo.GOLD<Number(e.cost[0][1]))return void y.Switches.ins.event(155);var i=new u.ActivityGetC2GS;i.id=this._activityId,i.activity2CfgId=t.cfgId,p.GSM.sendServer(i)}}}else-1!=this._selectIndex&&n.AM.show(f.TextConst.get(271),new Laya.Handler(this,function(){y.Switches.ins.event(109)}))},t.prototype.play=function(t){var e=this;this._lastGetMsg=t;var i=Number(t.error);if(-1<i){this._running=!0;var n=3600+36*i+15*Math.random();this.img_arrow.rotation%=360,Laya.Tween.to(this.img_arrow,{rotation:n},7e3,Laya.Ease.circInOut,Laya.Handler.create(this,function(){e._waitLog&&(e.appendLog(e._waitLog[0],e._waitLog[1],e._waitLog[2]),e._waitLog=null),e.displayedInStage&&(r.FE.addInventoryToCFloats(t.inv),d.GetRewwardCtrl.inventoryAddGS2C(t.inv),e.updateInfo(),e.updateSelectItem()),e._running=!1}))}},t.prototype.appendLog=function(t,e,i){this._des.appendHTML(f.TextConst.get(272,t,e,i)),this.con_log.height=this._des.contextHeight+20,this.con_panel.vScrollBar.value=this.con_panel.vScrollBar.max},t.prototype.getSelectSubActivity=function(){if(-1<this._selectIndex&&this._childIndexArr&&this._selectIndex<this._childIndexArr.length){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId),e=this._childIndexArr[this._selectIndex];return t?t.children[e]:null}return null},t.prototype.onActivityGetHandler=function(t){this._activityId==t.id&&t.opresult&&this.play(t)},t.prototype.onUpdateLogHandler=function(t){if(t.id==this._activityId){var e;if(t&&1==t.type){if((e=t.infoArr)[0]==l.RoleCenter.instans.vo.nickname)return void(this._waitLog=e)}else{var i=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);i&&i.rewardInfo&&(e=i.rewardInfo.infoArr),this._des.innerHTML=""}for(var n=(e?e.length:0)-1;0<=n;)this.appendLog(e[n-2],e[n-1],e[n]),n-=3;this._waitLog=null}},t}(ui.activity.pages.GoldTurntableUI);e.GoldTurntablePage=i}),define("src/g/activity/view/item/ActivityMenuBtn",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"selected",{get:function(){return this.btn.selected},set:function(t){this.btn.selected=t},enumerable:!0,configurable:!0}),e}(ui.activity.item.ActivityMenuBtnUI);e.ActivityMenuBtn=i}),define("src/g/activity/view/item/ActivityMenuBtn2",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"selected",{get:function(){return this.btn.selected},set:function(t){this.btn.selected=t},enumerable:!0,configurable:!0}),e}(ui.activity.item.ActivityMenuBtn2UI);e.ActivityMenuBtn2=i}),define("src/g/activity/view/item/SevenDayCarnival8_14Item",["require","exports","../../../../config/GameConfig","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../net/messages/enumStatus","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../meta/MainButtonVo","src/g/Effects/UIEffectsFactory","../../../../utils/system/ServerTime","src/init/TextConst"],function(t,e,r,i,n,l,s,o,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function a(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.onClickHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(a,e),a.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},a.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},a.prototype.setData=function(t,e){this.subActivity=t,this._activityId=e;var i=r.GameConfig.subActivityJson[t.cfgId],n=r.GameConfig.activityJson[i.activityId];if(i){this.lab_title.changeText(i.title),this.lab_score.changeText(i.score.toString());var s=t.count,o=i.value;if(0<i.value2&&(o=1),this.lab_count.color=o<=s?"#03bb00":"#ff0f15",this.lab_count.changeText(s+"/"+o),this.ani||(this.ani=c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_get,40,.62,.8)),t.status==l.enumStatus.weiwancheng){if(this.btn_get.disabled=!0,this.btn_get.label=p.TextConst.get(204),this.ani.visible=!1,i.moduleID&&0<i.moduleID.length)if(this.btn_get.disabled=!1,this.btn_get.label=p.TextConst.get(200),"meirichongzhi"==n.clientkey)Math.floor((u.ServerTime.serverTime-a.CARNIVAL_STARTTIME)/3600/24)!=n.startday&&(this.btn_get.label=p.TextConst.get(805),this.btn_get.disabled=!0)}else t.status==l.enumStatus.kelingqu?(this.btn_get.disabled=!1,this.btn_get.label=p.TextConst.get(204),this.ani.visible=!0):t.status==l.enumStatus.yilingqu&&(this.btn_get.disabled=!0,this.btn_get.label=p.TextConst.get(211),this.ani.visible=!1);this.list_item.array=i.bonus}},a.prototype.onClickHandler=function(){if(this.subActivity)if(this.subActivity.status==l.enumStatus.kelingqu){var t=new s.ActivityGetC2GS;t.id=this._activityId,t.activity2CfgId=this.subActivity.cfgId,o.GSM.sendServer(t)}else if(this.subActivity.status==l.enumStatus.weiwancheng){var e=r.GameConfig.subActivityJson[this.subActivity.cfgId];h.MainButtonStruct.Ins.OpenModule(e.moduleID[0][1],e.moduleID[1][1])}},a.CARNIVAL_STARTTIME=0,a}(ui.activity.item.SevenDayCarnival8_14ItemUI);e.SevenDayCarnival8_14Item=a}),define("src/g/activity/view/item/ActivityScoreShopBuyItem",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ui.activity.item.ActivityScoreShopBuyItemUI);e.ActivityScoreShopBuyItem=i}),define("src/g/activity/view/item/ActivityScoreShopLimitItem",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ui.activity.item.ActivityScoreShopLimitItemUI);e.ActivityScoreShopLimitItem=i}),define("src/g/activity/view/ActivityScoreShop",["require","exports","src/g/activity/view/item/ActivityScoreShopBuyItem","src/g/activity/view/item/ActivityScoreShopLimitItem","../../../manager/RoleCenter","../../../config/GameConfig","../../../utils/ItemCellUtils","../../../utils/system/ServerTime","../../../utils/system/DateUitl","../../../core/E","../../../enum/EventName","../../net/messages/activity/ActivityGet","../../../manager/GameSocketManager","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/init/Switches","src/g/bag/tips/view/ItemTips","src/g/clearRes/ClearResM","src/init/TextConst"],function(t,e,i,n,h,c,u,s,o,a,r,l,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(e){function t(){var t=e.call(this)||this;return t._lastRefreshT=0,t.init(),t}return __extends(t,e),t.prototype.init=function(){this.list_buy.itemRender=i.ActivityScoreShopBuyItem,this.list_buy.renderHandler=new Laya.Handler(this,this.onRenderBuyItem),this.list_limit.itemRender=n.ActivityScoreShopLimitItem,this.list_limit.renderHandler=new Laya.Handler(this,this.onRenderLimitItem),this.bg.btn_back.on(Laya.Event.CLICK,this,this.onCloseHandler),this.bg.btn_close.on(Laya.Event.CLICK,this,this.onCloseHandler),this.btn_turn_left.on(Laya.Event.CLICK,this,this.moveLeft),this.btn_turn_right.on(Laya.Event.CLICK,this,this.moveRight),this.list_limit.scrollBar.elasticDistance=100,this.list_limit.scrollBar.on(Laya.Event.END,this,this.onScrollEndHandler),this.btn_refresh.on(Laya.Event.CLICK,this,this.requestRefreshHandler),a.E.ins.on(r.EventName.NET_OFFLINE,this,this.onOfflineHandler)},t.prototype.onOfflineHandler=function(){this._activityId=0,this.isPopup&&this.close()},t.prototype.onScrollEndHandler=function(){this.btn_turn_right.visible=this.btn_turn_left.visible=!1,0<this.list_limit.scrollBar.max&&(10<this.list_limit.scrollBar.value&&(this.btn_turn_left.visible=!0),this.list_limit.scrollBar.value<this.list_limit.scrollBar.max-10&&(this.btn_turn_right.visible=!0))},t.prototype.moveRight=function(){this.list_limit.scrollBar.value=Math.min(this.list_limit.scrollBar.value+this.list_limit.width,this.list_limit.scrollBar.max),this.onScrollEndHandler()},t.prototype.moveLeft=function(){this.list_limit.scrollBar.value=Math.max(this.list_limit.scrollBar.value-this.list_limit.width,this.list_limit.scrollBar.min),this.onScrollEndHandler()},t.prototype.onRenderBuyItem=function(t,e){var i=this.list_buy.array[e].id,n=c.GameConfig.activityShop[i];if(n){var s=n.itemid[0];u.ItemCellUtils.fillCellForItem0View(t.item,s[0],Number(s[1]),t.lab_name),t.item.offAll(),t.item.on(Laya.Event.CLICK,this,function(t,e){f.ItemTips.ins.showTip(t,e)},s);var o=n.cost[0][1];t.lab_cost.changeText(o.toString());var a=!0;if(0<n.countperday){a=!1;var r=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(r&&r.randomItemData&&-1==r.randomItemData.bugCfgIdArr.indexOf(i))if(-1!=(e=r.randomItemData.permitArr.indexOf(i)))r.randomItemData.permitArr[e+1]<n.countperday&&(a=!0);else a=!0}t.btn_buy.offAll(),t.btn_buy.disabled=!a||(t.btn_buy.on(Laya.Event.CLICK,this,this.onBuyHandler,[i]),!1)}},t.prototype.onBuyHandler=function(t){if(Date.now()-this._lastBuyTime<800)d.FE.upItems(m.TextConst.get(212),g.BubbleEnum.center);else{var e=c.GameConfig.activityShop[t];if(e){var i=e.cost[0][0];if(e.cost[0][1]<=h.RoleCenter.instans.vo.bagdata.getItemCount(i)){this._lastBuyTime=Date.now();var n=new l.ActivityGetC2GS;n.id=this._activityId,n.activity2CfgId=t,p.GSM.sendServer(n)}else d.FE.upItems(m.TextConst.get(213),g.BubbleEnum.center)}}},t.prototype.requestRefreshHandler=function(){if(this._activityId){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=c.GameConfig.activityJson[t.cfgId];if(e){if(s.ServerTime.serverTime-this._lastRefreshT<1)return void d.FE.upItems(m.TextConst.get(212),g.BubbleEnum.center);if(h.RoleCenter.instans.vo.GOLD<Number(e.value))return void v.Switches.ins.event(155);var i=new l.RefushShopRandomItemDataC2GS;i.id=this._activityId,p.GSM.sendServer(i),this._lastRefreshT=s.ServerTime.serverTime}}}},t.prototype.requestBuyList=function(){var t=new l.GetShopRandomItemDataC2GS;t.id=this._activityId,p.GSM.sendServer(t)},t.prototype.onRenderLimitItem=function(t,e){var i=Number(this.list_limit.array[e][0]),n=c.GameConfig.activityShop[i];if(n){var s=n.itemid[0];u.ItemCellUtils.fillCellForItem0View(t.item,s[0],Number(s[1])),t.item.offAll(),t.item.on(Laya.Event.CLICK,this,function(t,e){f.ItemTips.ins.showTip(t,e)},s);var o=0,a=n.countperday,r=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(r&&r.randomItemData)-1!=(e=r.randomItemData.permitArr.indexOf(i))&&(o=r.randomItemData.permitArr[e+1]);var l=a-o;0<l?t.lab_count.changeText(m.TextConst.get(253,l,n.countperday)):t.lab_count.changeText(m.TextConst.get(214))}},t.prototype.showShop=function(t){if(a.E.ins.on(r.EventName.CHANGEITEM_COUNT,this,this.onBagItemChanged),a.E.ins.on(r.EventName.ACTIVITY_SHOP_DATA_CHANGED,this,this.onShopDataChanged),a.E.ins.on(r.EventName.ACTIVITY_SHOP_PRODUCT_LIST_CHANGED,this,this.onShopProductChanged),this._activityId!=t){this._activityId=t;var e=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=c.GameConfig.activityJson[e.cfgId];if(i){var n=i.value.split(":");this.lab_pay.changeText(n[1]),this.list_limit.array=i.showList,Laya.timer.frameOnce(2,this,this.onScrollEndHandler);var s=this.list_limit.array[0],o=c.GameConfig.activityShop[s];o&&(this._costItemId=o.cost[0][0])}e.randomItemData?this.updateBuyList():(this.list_buy.array=null,this.requestBuyList())}}else this.list_buy.refresh(),this.list_limit.refresh();y.ClearResM.resetViewImg(this),this.updateHave(),this.popup(),this.updateShopTime()},t.prototype.onShopProductChanged=function(t){t==this._activityId&&this.updateBuyList()},t.prototype.updateBuyList=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);t&&t.randomItemData&&(this.list_buy.array=t.randomItemData.randomItemArr)},t.prototype.onShopDataChanged=function(t){t==this._activityId&&(this.list_buy.refresh(),this.list_limit.refresh())},t.prototype.onClosed=function(t){e.prototype.onClosed.call(this,t),Laya.timer.clear(this,this.updateShopTime),a.E.ins.off(r.EventName.CHANGEITEM_COUNT,this,this.onBagItemChanged),a.E.ins.off(r.EventName.ACTIVITY_SHOP_DATA_CHANGED,this,this.onShopDataChanged),a.E.ins.off(r.EventName.ACTIVITY_SHOP_PRODUCT_LIST_CHANGED,this,this.onShopProductChanged)},t.prototype.onBagItemChanged=function(t,e){t==this._costItemId&&this.updateHave()},t.prototype.updateShopTime=function(){Laya.timer.clear(this,this.updateShopTime);var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.allData.allCount;0<e-s.ServerTime.serverTime?(this.lab_time.changeText(o.DateUtil.getHMS_countdown(e-s.ServerTime.serverTime)),Laya.timer.once(1e3,this,this.updateShopTime)):this.lab_time.changeText(o.DateUtil.getHMS_countdown(0))}},t.prototype.updateHave=function(){this._costItemId&&this.lab_currCount.changeText(h.RoleCenter.instans.vo.bagdata.getItemCount(this._costItemId).toString())},t.prototype.onCloseHandler=function(){this.close()},t}(ui.activity.ActivityScoreShopUI);e.ActivityScoreShop=_}),define("src/g/activity/view/pages/SevenDayCarnival8_14Page",["require","exports","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","../../../net/messages/enumStatus","../../../../manager/GameSocketManager","../../../net/messages/OpResultGS2C","../../../net/messages/OpResultType","src/g/clearRes/ClearResM","src/g/activity/view/item/ActivityMenuBtn","src/g/activity/view/item/ActivityMenuBtn2","src/g/activity/view/item/SevenDayCarnival8_14Item","src/g/activity/view/ActivityBoxGetDlg","src/g/activity/view/ActivityScoreShop","../../../../utils/ItemUtils","../../../../utils/MathUtils","src/init/TextConst"],function(t,e,i,n,f,y,s,o,c,a,r,l,h,u,p,d,g,v,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var I=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged(),this.updateMenu()):h.ClearResM.resetViewImg(this),this.updateShopChanged(),i.E.ins.on(n.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),i.E.ins.on(n.EventName.ACTIVITY_RED_UPDATE,this,this.onActRedChanged),a.GSM.ins.on(r.OpResultGS2C.KEY,this,this.onOpResult),e.addChild(this)},t.prototype.onOpResult=function(t){t.msgidx==l.enumOpResultType.activity_nextDay&&this.updateMenu()},t.prototype.refresh=function(){this.box_menu.refresh()},t.prototype.hidePage=function(){Laya.timer.clear(this,this.updateShopChanged),i.E.ins.off(n.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),i.E.ins.off(n.EventName.ACTIVITY_RED_UPDATE,this,this.onActRedChanged),this.removeSelf(),h.ClearResM.clearFolderByUrl("dynamic/activity/seven_day_carnival_8_14/")},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),this._shop&&(this._shop.close(),this._shop.destroy(),this._shop=null),e.prototype.destroy.call(this),Laya.loader.clearRes(this.title_img.skin)},t.prototype.onActivityDataChanged=function(t,e){e==this._boxActUid?this.updateBoxChanged():e==this._shopActUid?this.updateShopChanged():e==this._selectActUid?this.updateListMain():e==this._activityId&&this.updateMenu()},t.prototype.showView=function(t,e){this._activityId!=t.id&&(this._activityId=t.id,this.updateUnchanged(),this.updateMenu()),i.E.ins.on(n.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged)},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.panel_menu.vScrollBar.elasticDistance=100,this.box_menu.itemRender=u.ActivityMenuBtn,this.box_menu.subItemRender=p.ActivityMenuBtn2,this.box_menu.renderHandler=new Laya.Handler(this,this.onMainRenderHandler),this.box_menu.subRenderHandler=new Laya.Handler(this,this.onSubRenderHandler),this.box_menu.subSelectHandler=new Laya.Handler(this,this.onMenuSelectHandler),this.list_main.scrollBar.elasticDistance=100,this.list_main.itemRender=d.SevenDayCarnival8_14Item,this.list_main.renderHandler=new Laya.Handler(this,this.onListRenderHandler)},t.prototype.onMainRenderHandler=function(t,e){var i=t.dataSource;e=i.dataIndex;t.btn.label=i.label;var n=f.RoleCenter.instans.vo.getActivity1Data(this._activityId);d.SevenDayCarnival8_14Item.CARNIVAL_STARTTIME=n.startTime,t.img_red.removeSelf(),n&&n.children[e].hasRed&&t.addChild(t.img_red)},t.prototype.onSubRenderHandler=function(t,e){var i=t.dataSource,n=i.uid;t.btn.label=i.label;var s=f.RoleCenter.instans.vo.getActivity1Data(n);t.img_red.removeSelf(),s&&s.hasRed&&t.addChild(t.img_red)},t.prototype.onMenuSelectHandler=function(t){this._selectActUid=t.uid,this.updateListMain()},t.prototype.updateUnchanged=function(){var t=f.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=y.GameConfig.activityJson[t.cfgId];this.title_img.skin="dynamic/activity/seven_day_carnival_8_14/"+e.bg_img+".jpg",this.time_txt.changeText(s.DateUtil.remainingDayStr(t.rewardTime-o.ServerTime.serverTime)),this.btn_shop.on(Laya.Event.CLICK,this,this.openShopHandler)}else console.log("没有找到数据，类型：SevenDayCarnivalPage")},t.prototype.openShopHandler=function(){this._shopActUid&&(this._shop||(this._shop=new v.ActivityScoreShop),this._shop.showShop(this._shopActUid))},t.prototype.onActRedChanged=function(t){t==this._activityId&&this.box_menu.refresh()},t.prototype.updateMenu=function(){var t=f.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children.concat();e.sort(this.childSortFun);for(var i,n,s=e.length,o=0,a=[];o<s;){i=e[o],n=t.children.indexOf(i);var r,l=(r=y.GameConfig.subActivityJson[i.cfgId]).childId;if(0==l)this._boxActUid=i.childCountArr[0],this.initBox(),this.updateBoxChanged();else if(99==l)this._shopActUid=i.childCountArr[0],this.updateShopChanged();else{for(var h={label:r.title,dataIndex:n},c=i.childCountArr.length,u=0,p=0,d=[];u<c;){p=i.childCountArr[u];var g=f.RoleCenter.instans.vo.getActivity1Data(p);if(g){var v=y.GameConfig.activityJson[g.cfgId];d.push({label:v.name,uid:p})}u++}d&&0<d.length&&(h.children=d),a.push(h)}o++}this.box_menu.array=a,this.box_menu.setSelectIndex(0,0)}},t.prototype.childSortFun=function(t,e){var i=y.GameConfig.subActivityJson[t.cfgId],n=y.GameConfig.subActivityJson[e.cfgId];return i.childId-n.childId},t.prototype.updateShopChanged=function(){Laya.timer.clear(this,this.updateShopChanged);var t=f.RoleCenter.instans.vo.getActivity1Data(this._shopActUid);if(t){var e=y.GameConfig.activityJson[t.cfgId];this.btn_shop.skin="dynamic/activity/seven_day_carnival_8_14/"+e.bg_img+".jpg";var i=t.allData.allCount;0<i-o.ServerTime.serverTime?(this.lab_shop_cd.changeText(C.TextConst.get(33,s.DateUtil.getHMS_countdown(i-o.ServerTime.serverTime))),Laya.timer.once(1e3,this,this.updateShopChanged)):this.lab_shop_cd.changeText("00:00:00")}},t.prototype.initBox=function(){var t=f.RoleCenter.instans.vo.getActivity1Data(this._boxActUid);if(t){var e,i,n,s=t.children.length,o=0;for(this._progressArr=[0];o<5;){if(o<s&&(e=t.children[o],i=y.GameConfig.subActivityJson[e.cfgId],this._progressArr.push(i.value),i)){1<i.bonus.length?n=i.bonus[1][0]:0<i.bonus.length&&(n=i.bonus[0][0]);var a=m.ItemUtils.getItemOrEq(n);a&&(this["img_item"+i.childId].skin=m.ItemUtils.getIconByIconId(a.icon))}o++}}},t.prototype.updateBoxChanged=function(){var t=f.RoleCenter.instans.vo.getActivity1Data(this._boxActUid);if(t){var e=t.children.concat();e.sort(this.childSortFun);for(var i,n,s,o,a=e.length,r=0,l=0;r<5;)r<a&&(i=e[r],l=(n=y.GameConfig.subActivityJson[i.cfgId]).value>l?n.value:l,this["lab_title"+n.childId].changeText(n.value.toString()),(s=this["box"+n.childId]).offAll(),s.on(Laya.Event.CLICK,this,this.onClickBoxHandler,[i]),(o=this["effect"+n.childId]).visible=!1,this["img_complt"+n.childId].visible=!1,i.status==c.enumStatus.yilingqu?this["img_complt"+n.childId].visible=!0:i.status==c.enumStatus.kelingqu&&(o.visible=!0)),r++;var h=Math.min(l,t.allData.allCount);this._progressArr&&(this.img_progress.scaleX=_.MathUtils.sectionProgress(this._progressArr,h)),this.lab_kh.changeText(h.toString())}},t.prototype.onClickBoxHandler=function(t){0<this._boxActUid&&(this._boxRewardDlg||(this._boxRewardDlg=new g.ActivityBoxGetDlg),this._boxRewardDlg.showBox(t,this._boxActUid))},t.prototype.updateListMain=function(){var t=f.RoleCenter.instans.vo.getActivity1Data(this._selectActUid);if(t){var e=t.children.concat();e.sort(this.mainListSortFun),this.list_main.array=e}},t.prototype.mainListSortFun=function(t,e){var i=y.GameConfig.subActivityJson[t.cfgId],n=y.GameConfig.subActivityJson[e.cfgId],s=i?i.childId+100:100,o=n?n.childId+100:100;return t.status==c.enumStatus.kelingqu?s-=100:t.status==c.enumStatus.yilingqu&&(s+=100),e.status==c.enumStatus.kelingqu?o-=100:e.status==c.enumStatus.yilingqu&&(o+=100),s-o},t.prototype.onListRenderHandler=function(t,e){t.setData(t.dataSource,this._selectActUid)},t}(ui.activity.pages.SevenDayCarnival8_14UI);e.SevenDayCarnival8_14Page=I}),define("src/g/activity/view/pages/FlashSalePage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../config/GameConfig","../../../../manager/RoleCenter","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","../../../../utils/ItemCellUtils","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../manager/GameSocketManager","../../../../core/GNet","../../../net/messages/OpResultType","../../../net/messages/OpResultGS2C","../../../../manager/AM","src/g/bag/tips/view/ItemTips","src/init/TextConst"],function(t,e,n,s,o,c,u,a,r,p,l,h,d,g,i,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t._selectIndex=0,t._lastBuyTime=0,t._isRequestBuy=!1,t.list_child.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t.list_child.selectHandler=new Laya.Handler(t,t.onSelectHandler),t.btn_buy.on(Laya.Event.CLICK,t,t.onBuyHandler),t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):(this.updateTime(),n.ClearResM.resetViewImg(this),this.list_child.refresh());var i=this.findCanBuyIndex();-1!=i?i!=this.list_child.selectedIndex&&(this.list_child.selectedIndex=i):-1==this.list_child.selectedIndex&&(this.list_child.selectedIndex=0),s.E.ins.on(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this)},t.prototype.refresh=function(){n.ClearResM.resetViewImg(this),this.list_child.refresh()},t.prototype.hidePage=function(){s.E.ins.off(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),n.ClearResM.clearFolderByUrl("dynamic/activity/flash_sale/"),Laya.timer.clear(this,this.updateTime),this._isRequestBuy=!1},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this),d.GSM.ins.off(v.OpResultGS2C.KEY,this,this.onOpResult)},t.prototype.onActivityDataChanged=function(t,e){if(e==this._activityId){this.list_child.refresh();var i=this.findCanBuyIndex();this._isRequestBuy&&-1!=i&&i!=this.list_child.selectedIndex?this.list_child.selectedIndex=i:this.show(this._selectIndex)}},t.prototype.findCanBuyIndex=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=this.list_child.array[this._selectIndex],i=t.children[e];if((o=c.GameConfig.subActivityJson[i.cfgId])&&0<o.value2-i.count)return this._selectIndex;for(var n=this.list_child.array.length,s=0;s<n;){e=this.list_child.array[s];var o;i=t.children[e];if((o=c.GameConfig.subActivityJson[i.cfgId])&&0<o.value2-i.count)return s;s++}}return-1},t.prototype.updateUnchanged=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){c.GameConfig.activityJson[t.cfgId];this.day=a.DateUtil.getDayFromStartTime(t.startTime,r.ServerTime.ACTIVITY_TIME_OFFSET),this.updateTime(),this._childIndexArr=[];for(var e=t.children.length,i=0;i<e;)this._childIndexArr.push(i),i++;this._childIndexArr.sort(this.childSortFun.bind(this)),d.GSM.ins.on(v.OpResultGS2C.KEY,this,this.onOpResult),this.updateList()}else console.log("没有找到数据，类型：FlashSalePage")},t.prototype.onOpResult=function(t){if(t.msgidx==i.enumOpResultType.activity_nextDay){this.day++,7<this.day&&d.GSM.ins.off(v.OpResultGS2C.KEY,this,this.onOpResult),this.updateList();var e=this.findCanBuyIndex();-1!=e&&e!=this.list_child.selectedIndex?this.list_child.selectedIndex=e:this.show(e)}},t.prototype.updateList=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){for(var e=[],i=this._childIndexArr.length,n=0,s=0;n<i;){s=this._childIndexArr[n];var o=c.GameConfig.subActivityJson[t.children[s].cfgId];o&&o.value==this.day&&e.push(s),n++}this.list_child.array=e}},t.prototype.childSortFun=function(t,e){var i=u.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=c.GameConfig.subActivityJson[i.children[t].cfgId],s=c.GameConfig.subActivityJson[i.children[e].cfgId];return n.childId-s.childId},t.prototype.updateTime=function(){var t=new Date;t.setTime(1e3*r.ServerTime.serverTime),t.setHours(23,59,59);var e=t.getTime()/1e3-r.ServerTime.serverTime;0<e?(this.clip_cd.value=a.DateUtil.getHMS_countdown(e),Laya.timer.once(1e3,this,this.updateTime)):this.clip_cd.value="00:00:00"},t.prototype.onListRenderHandler=function(t,e){var i=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(i){var n=i.children[t.dataSource];if(n){var s=c.GameConfig.subActivityJson[n.cfgId];s&&(t.img_icon.skin="dynamic/activity/flash_sale/icon"+s.childId+".png")}}},t.prototype.onSelectHandler=function(t){this.show(t)},t.prototype.show=function(t){this._selectIndex=t,t=this.list_child.array[this._selectIndex];var e=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=e.children[t];if(i){var n=c.GameConfig.subActivityJson[i.cfgId];if(n){this.img_bg.skin="dynamic/activity/flash_sale/"+n.image+".jpg";for(var s,o=n.bonus,a=o.length,r=0;r<4;r++)(s=this["item"+r])&&(r<a?(s.visible=!0,s.off(Laya.Event.CLICK,this,this.onShowTip),s.on(Laya.Event.CLICK,this,this.onShowTip,[o[r][0],Number(o[r][1])]),p.ItemCellUtils.fillCellForItemNameView(s,o[r][0],Number(o[r][1]))):s.visible=!1);var l=n.value2,h=n.value2-i.count;this.count_txt.color=0<h?"#03bb00":"#ff0f15",this.count_txt.changeText(h+"/"+l),this.clip_cost.value="￥"+n.cost[0][1],this.clip_ori_cost.value="￥"+n.originalcost[0][1],this.btn_buy.disabled=!1,0<l&&h<=0&&(this.btn_buy.disabled=!0),0<n.viplevel&&u.RoleCenter.instans.vo.VIP<n.viplevel&&(this.btn_buy.disabled=!0)}}}},t.prototype.onShowTip=function(t,e){y.ItemTips.ins.showTip(t,e)},t.prototype.onBuyHandler=function(){if(Date.now()-this._lastBuyTime<1e3)l.FE.upItems(m.TextConst.get(258),h.BubbleEnum.center);else if(u.RoleCenter.instans.bagRoomEnough()){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=this.list_child.array[this._selectIndex],i=t.children[e],n=c.GameConfig.subActivityJson[i.cfgId];if(n){if(0<n.value2&&n.value2-i.count<=0)return void l.FE.upItems(m.TextConst.get(218),h.BubbleEnum.center);if(0<n.viplevel&&u.RoleCenter.instans.vo.VIP<n.viplevel)return void l.FE.upItems(m.TextConst.get(219),h.BubbleEnum.center);this._lastBuyTime=Date.now(),this._isRequestBuy=!0,g.GNet.toRecharge(Number(n.desc))}}}else f.AM.showBagNotEnough()},t}(ui.activity.pages.FlashSalePageUI);e.FlashSalePage=_}),define("src/g/activity/view/pages/VipLimitPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../config/GameConfig","../../../../manager/RoleCenter","../../../../utils/ItemCellUtils","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","src/init/Switches","src/g/Effects/UIEffectsFactory","../../../../manager/AM","src/g/bag/tips/view/ItemTips","src/init/TextConst","../../../../manager/ActivityManager"],function(t,e,n,s,o,c,u,l,a,r,h,p,d,i,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t._lastBuyTime=0,t._isRequestBuy=!1,t._selectIndex=0,t.list_child.scrollBar.elasticDistance=100,t.list_child.scrollBar.on(Laya.Event.END,t,t.onScrollEndHandler),t.list_child.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t.list_child.selectHandler=new Laya.Handler(t,t.onSelectHandler),t.btn_buy.on(Laya.Event.CLICK,t,t.onBuyHandler),t.ani=i.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.btn_buy,40),t.ani.visible=!1,t.btn_turn_right.on(Laya.Event.CLICK,t,t.onTurnRight),t.btn_turn_left.on(Laya.Event.CLICK,t,t.onTurnLeft),t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):n.ClearResM.resetViewImg(this);var i=this.findCanBuyIndex();-1!=i?i!=this.list_child.selectedIndex&&(this.list_child.selectedIndex=i):-1==this.list_child.selectedIndex&&(this.list_child.selectedIndex=0),this.list_child.refresh(),s.E.ins.on(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this),this.showAni(),y.ActivityManager.ins.activityRead(this._activityId)},t.prototype.refresh=function(){n.ClearResM.resetViewImg(this),this.list_child.refresh()},t.prototype.hidePage=function(){s.E.ins.off(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),n.ClearResM.clearFolderByUrl("dynamic/activity/vip_limit_sale/"),this._isRequestBuy=!1,this.clearAni()},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this),Laya.loader.clearRes(this.bg_img.skin)},t.prototype.onActivityDataChanged=function(t,e){if(this._activityId==e){this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_child.refresh();var i=this.findCanBuyIndex();this._isRequestBuy&&-1!=i&&i!=this.list_child.selectedIndex?this.list_child.selectedIndex=i:this.show(this._selectIndex),this.list_child.refresh()}},t.prototype.findCanBuyIndex=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)for(var e=this.list_child.array[this._selectIndex],i=t.children[e],n=c.GameConfig.subActivityJson[i.cfgId],s=this.list_child.array.length,o=0;o<s;){e=this.list_child.array[o];i=t.children[e];if((n=c.GameConfig.subActivityJson[i.cfgId])&&0<n.value2-i.count)return o;o++}return-1},t.prototype.showAni=function(){var t=i.UIEffectsFactory.Ins.createSAniById(79);this.effect_con.addChild(t)},t.prototype.clearAni=function(){this.effect_con.removeChildren(),i.UIEffectsFactory.Ins.clearAniRes(79)},t.prototype.onVipExpChanged=function(){10<=u.RoleCenter.instans.vo.VIP&&(s.E.ins.off(o.EventName.VIP_EXP_CHANGED,this,this.onVipExpChanged),this.updateUnchanged())},t.prototype.updateUnchanged=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=u.RoleCenter.instans.vo.VIP;e<10&&s.E.ins.on(o.EventName.VIP_EXP_CHANGED,this,this.onVipExpChanged),this._childIndexArr=[];for(var i=t.children.length,n=0;n<i;)e<10?c.GameConfig.subActivityJson[t.children[n].cfgId].childId%100<=10&&this._childIndexArr.push(n):this._childIndexArr.push(n),n++;this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_child.array=this._childIndexArr,this.list_child.selectedIndex=0}else console.log("没有找到数据，类型：FlashSalePage")},t.prototype.childSortFun=function(t,e){var i=u.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=c.GameConfig.subActivityJson[i.children[t].cfgId],s=c.GameConfig.subActivityJson[i.children[e].cfgId],o=i.children[t],a=i.children[e],r=i.children.length,l=n?n.childId:0;0<n.value2&&n.value2-o.count<=0&&(l+=r),0<l&&(l%=100);var h=s?s.childId:0;return 0<s.value2&&s.value2-a.count<=0&&(h+=r),0<h&&(h%=100),l-h},t.prototype.onTurnLeft=function(){this.list_child.scrollBar.value=0,this.onScrollEndHandler()},t.prototype.onTurnRight=function(){this.list_child.scrollBar.value=this.list_child.scrollBar.max,this.onScrollEndHandler()},t.prototype.onScrollEndHandler=function(){this.btn_turn_right.visible=this.btn_turn_left.visible=!1,0<this.list_child.scrollBar.max&&(10<this.list_child.scrollBar.value&&(this.btn_turn_left.visible=!0),this.list_child.scrollBar.value<this.list_child.scrollBar.max-10&&(this.btn_turn_right.visible=!0))},t.prototype.onListRenderHandler=function(t,e){var i=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(i){var n=i.children[t.dataSource];if(n){var s=c.GameConfig.subActivityJson[n.cfgId];s&&(t.img_icon.skin="dynamic/activity/vip_limit_sale/vipxiangou_libaodiban"+s.childId+".png",t.img_got.visible=!1,0<s.value2&&s.value2-n.count<=0&&(t.img_got.visible=!0))}}},t.prototype.onSelectHandler=function(t){this.show(t)},t.prototype.onBuyHandler=function(){if(Date.now()-this._lastBuyTime<1e3)h.FE.upItems(f.TextConst.get(258),p.BubbleEnum.center);else if(u.RoleCenter.instans.bagRoomEnough()){var t,e,i=0,n=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(n&&(i=this.list_child.array[this._selectIndex],t=n.children[i])){if(0<(e=c.GameConfig.subActivityJson[t.cfgId]).value2&&e.value2-t.count<=0)return void h.FE.upItems(f.TextConst.get(218),p.BubbleEnum.center);if(0<e.viplevel&&u.RoleCenter.instans.vo.VIP<e.viplevel)return void h.FE.upItems(f.TextConst.get(219),p.BubbleEnum.center);if("MONEY"==e.cost[0][0]&&u.RoleCenter.instans.vo.MONEY<e.cost[0][1])return void h.FE.upItems(f.TextConst.get(220),p.BubbleEnum.center);if("GOLD"==e.cost[0][0]&&u.RoleCenter.instans.vo.GOLD<e.cost[0][1])return void d.Switches.ins.event(155);this._lastBuyTime=Date.now(),this._isRequestBuy=!0;var s=new a.ActivityGetC2GS;s.id=this._activityId,s.activity2CfgId=t.cfgId,r.GSM.sendServer(s)}}else g.AM.showBagNotEnough()},t.prototype.show=function(t){this._selectIndex=t,t=this.list_child.array[this._selectIndex];var e=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=e.children[t];if(i){var n=c.GameConfig.subActivityJson[i.cfgId];if(n){this.bg_img.skin="dynamic/activity/vip_limit_sale/"+n.image+".png",this.img_show_icon.skin="dynamic/activity/vip_limit_sale/show_icon"+n.childId+".png";for(var s,o=n.bonus,a=o.length,r=0;r<4;r++)(s=this["item"+r])&&(r<a?(s.visible=!0,s.off(Laya.Event.CLICK,this,this.onShowTip),s.on(Laya.Event.CLICK,this,this.onShowTip,[o[r][0],Number(o[r][1])]),l.ItemCellUtils.fillCellForItemNameView(s,o[r][0],Number(o[r][1]))):s.visible=!1);0<n.originalcost.length?(this.lab_cost_orgi.changeText(f.TextConst.get(6,n.originalcost[0][1])),this.line_cost_orgi.visible=this.lab_cost_orgi.visible=!0):this.line_cost_orgi.visible=this.lab_cost_orgi.visible=!1,this.btn_buy.label=f.TextConst.get(6,n.cost[0][1]),this.btn_buy.visible=!0,this.ani.visible=!0,0<n.value2&&n.value2-i.count<=0&&(this.ani.visible=!1,this.btn_buy.visible=!1),0<n.viplevel&&u.RoleCenter.instans.vo.VIP<n.viplevel&&(this.ani.visible=!1),"MONEY"==n.cost[0][0]&&u.RoleCenter.instans.vo.MONEY<n.cost[0][1]&&(this.ani.visible=!1),"GOLD"==n.cost[0][0]&&u.RoleCenter.instans.vo.GOLD<n.cost[0][1]&&(this.ani.visible=!1)}}}},t.prototype.onShowTip=function(t,e){v.ItemTips.ins.showTip(t,e)},t}(ui.activity.pages.Vip_LimitUI);e.VipLimitPage=m}),define("src/g/activity/view/pages/AdvanceNoticePage",["require","exports","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/system/ServerTime","src/g/bag/tips/view/ItemTips","../../../../utils/ItemCellUtils","../../../../utils/ItemUtils","../../../../manager/GameSocketManager","../../../../utils/system/ServerLocal","src/g/account/ctrl/GetRewwardCtrl","../../../../utils/UIUtils","../../../../enum/LoadPriority","../../../../core/E","../../../../enum/EventName","src/g/clearRes/ClearResM","../../../net/messages/ChannelGiftMsg"],function(t,e,h,c,u,i,n,p,s,d,o,a,r,l,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(e){function t(){var t=e.call(this)||this;return t.canGetReward=!1,t._activityId=0,t._runnum=0,t.list_item.spaceX=10,t.list_item.itemRender=ui.custom.ItemNameViewUI,t.list_item.renderHandler=new Laya.Handler(t,t.onListRender),t.list_item.clickHandler=new Laya.Handler(t,t.onMouseListRender),t.isYuYue=d.ServerLocal.ins().isYuyue,t.box_yuyue.on(Laya.Event.CLICK,t,t.debounce(t.onYuYue,100)),t.refresh(),t.btn_close.on(Laya.Event.CLICK,t,function(){l.E.ins.event(g.EventName.CLOSE_YUYUE_PAGE)}),t}return __extends(t,e),t.prototype.onResComp=function(){this.updateUnchanged();for(var t=0;t<6;t++)this["roll_num_"+t].onLoaded();v.ClearResM.resetViewImg(this)},t.prototype.debounce=function(t,e){var i=this,n=null;return function(){clearTimeout(n),n=setTimeout(function(){t.apply(i)},e)}},t.prototype.onYuYue=function(){var t=this,e=c.GameConfig.cGift[this.activityId];if(this.setSettingValue(!0),this.canGetReward){var i=new f.TakeChannelGiftC2GS;i.id=this.activityId,s.GSM.sendServer(i),this.setSettingValue2(u.ServerTime.serverTime),o.GetRewwardCtrl.showReward2(e.reward,Laya.Handler.create(this,function(){Laya.timer.once(1e3,t,function(){l.E.ins.event(g.EventName.CLOSE_YUYUE_PAGE)})}))}},t.prototype.onMouseListRender=function(t){i.ItemTips.ins.showTip(this.list_item.array[t][0],Number(this.list_item.array[t][1]))},t.prototype.onListRender=function(t,e){n.ItemCellUtils.fillCellForItemNameView(t,this.list_item.array[e][0],Number(this.list_item.array[e][1]))},t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){e.addChild(this),this._activityId!=t?(this._activityId=t,Laya.timer.loop(1e3,this,this.updateUnchanged),this.updateUnchanged()):v.ClearResM.resetViewImg(this),this.cooldownHandler()},t.prototype.refresh=function(){a.UIUtils.loadAtlasArr(["res/atlas/res/gongnengyugao.json"],this,this.onResComp,r.LoadPriority.UI)},t.prototype.hidePage=function(){this.removeSelf()},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.updateUnchanged=function(){if(this.parent){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[0],i=c.GameConfig.subActivityJson[e.cfgId],n=(this.subVo=i).bonus[0];if(!n)return;this.activityId=n,this.img1.skin="dynamic/activity/advance_notice/"+i.image+".png";var s=c.GameConfig.activityJson[t.cfgId];if(s){var o=s.showList;o&&(this.list_item.array=o)}var a=c.GameConfig.cGift[this.activityId],r=p.ItemUtils.getCurrencyByDefine(a.reward[0][0]),l=Math.floor(i.value/3600);this.lab_yuanbao.text=""+a.reward[0][1]+r.name,this.lab_timer.text=l+"小时",this.hBox1.refresh(),this.hBox2.refresh(),this.isYuYue=d.ServerLocal.ins().isYuyue,this.canGetReward=u.ServerTime.serverTime-d.ServerLocal.ins().getRewardTime>this.subVo.value||!d.ServerLocal.ins().getRewardTime,1==this.isYuYue&&(this.canGetReward?this.box_yuyue.disabled=!1:this.box_yuyue.disabled=!0)}}},t.prototype.setSettingValue=function(t){var e=t?1:-1;d.ServerLocal.ins().isYuyue=e,h.RoleCenter.instans.sendSetData()},t.prototype.setSettingValue2=function(t){d.ServerLocal.ins().getRewardTime=t,h.RoleCenter.instans.sendSetData()},t.prototype.cooldownHandler=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-u.ServerTime.serverTime;if(86400<e){var i=Number(this.getHMS_countdown(e));this.playRollNum(i),Laya.timer.once(1e3,this,this.cooldownHandler)}else if(0<=e){i=Number(this.getHMS_countdown(e));this.playRollNum(i),Laya.timer.once(1e3,this,this.cooldownHandler)}else Laya.timer.once(1e3,this,this.cooldownHandler)}},t.prototype.playRollNum=function(t){for(var e=0;e<6;e++)this["roll_num_"+e].on("roll_complete",this,this.onRollCompleteHandler);this._runnum=6,this.roll_num_0.play(Math.floor(t/1e5),!0),this.roll_num_1.play(Math.floor(t/1e4)%10,!0),this.roll_num_2.play(Math.floor(t/1e3)%10,!0),this.roll_num_3.play(Math.floor(t/100)%10,!0),this.roll_num_4.play(Math.floor(t/10)%10,!0),this.roll_num_5.play(t%10,!0)},t.prototype.onRollCompleteHandler=function(){if(this._runnum--,0==this._runnum)for(var t=0;t<6;)this["roll_num_"+t].off("roll_complete",this,this.onRollCompleteHandler),t++},t.prototype.getHMS_countdown=function(t){var e=t/3600>>0,i=(t/60>>0)%60,n=t%60;return e<10&&(e="0"+e),i<10&&(i="0"+i),n<10&&(n="0"+n),""+e+i+n},t}(ui.activity.pages.AdvanceNoticePageUI);e.AdvanceNoticePage=y}),define("src/g/activity/view/pages/RechargeAndRebatePage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../net/messages/enumStatus","src/g/Effects/UIEffectsFactory","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../core/GNet","../../../../manager/AM","../../../../component/GAnimation","../../../../enum/FashionPos","../../../../utils/ItemUtils","../../../net/messages/OpResultGS2C","../../../net/messages/OpResultType","src/init/TextConst","src/init/Switches"],function(t,e,i,p,d,g,v,f,y,n,s,m,o,a,r,l,h,c,u,_,C,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t._selectIndex=0,t._lastBuyTime=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):(i.ClearResM.resetViewImg(this),this.show(this._selectIndex)),this.cooldownHandler(),p.E.ins.on(d.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),h.GSM.ins.on(b.OpResultGS2C.KEY,this,this.nextDayHandler),e.addChild(this)},t.prototype.refresh=function(){this.show(this._selectIndex)},t.prototype.hidePage=function(){p.E.ins.off(d.EventName.ADDED_LEVEL,this,this.onLevelChanged),p.E.ins.off(d.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),h.GSM.ins.off(b.OpResultGS2C.KEY,this,this.nextDayHandler),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/recharge_rebate/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this),Laya.loader.clearRes(this.bg_img.skin)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.show(this._selectIndex)},t.prototype.nextDayHandler=function(t){t.msgidx==w.enumOpResultType.activity_nextDay&&Laya.timer.once(1e3,this,this.show,[this._selectIndex])},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_child.scrollBar.elasticDistance=100,this.list_child.renderHandler=new Laya.Handler(this,this.onListRenderHandler),this.list_child.selectHandler=new Laya.Handler(this,this.onSelectHandler),this.list_item.renderHandler=new Laya.Handler(this,this.onRenderHandler),this.list_item.mouseHandler=new Laya.Handler(this,this.onMouseHandler),this.btn_buy.on(Laya.Event.CLICK,this,this.doBuyHandler),this.ani=o.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_buy,40),this.htxt_desc.style.font="SimHei",this.htxt_desc.style.align="center",this.htxt_desc.style.fontSize=20,this.htxt_desc.style.color="#e1a32a"},t.prototype.onListRenderHandler=function(t,e){var i=g.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(i){var n=v.GameConfig.subActivityJson[i.children[t.dataSource].cfgId];t.img_icon.skin="dynamic/activity/recharge_rebate/"+n.childId+".png"}},t.prototype.onSelectHandler=function(t){this.show(t)},t.prototype.onRenderHandler=function(t,e){n.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];s.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.updateUnchanged=function(){var t=g.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){v.GameConfig.activityJson[t.cfgId];this._childIndexArr=[];for(var e=t.children.length,i=0;i<e;)this._childIndexArr.push(i),i++;this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_child.array=this._childIndexArr,this.list_child.selectedIndex=0}else console.log("没有找到数据，类型：KillBossGroup")},t.prototype.childSortFun=function(t,e){var i=g.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=v.GameConfig.subActivityJson[i.children[t].cfgId],s=v.GameConfig.subActivityJson[i.children[e].cfgId];return n.childId-s.childId},t.prototype.show=function(t){this._selectIndex=t,t=this._childIndexArr[this._selectIndex],p.E.ins.off(d.EventName.ADDED_LEVEL,this,this.onLevelChanged),Laya.timer.clear(this,this.show);var e=g.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(this.btn_buy.disabled=!1,e){var i=e.children[t],n=v.GameConfig.subActivityJson[i.cfgId];if(this.bg_img.skin="dynamic/activity/recharge_rebate/"+n.image+".jpg",this.img_title.skin="dynamic/activity/recharge_rebate/0yuangou_zhanshi"+n.childId+".png",this.list_item.array=n.bonus,this.checkBunusShowAni(n.bonus),this.lab_desc.changeText(n.desc),this.lab_price.changeText(n.originalcost[0][1]),i.status==m.enumStatus.weiwancheng){var s=!0,o=!1;if(y.ServerTime.serverTime>=e.endTime)s=!1,o=!(this.htxt_desc.innerHTML="");else{var a=f.DateUtil.getDayFromStartTime(e.startTime);n.childId>a?(s=!1,this.htxt_desc.innerHTML=S.TextConst.get(1146,n.childId,a,n.childId)):1e6<n.viplevel?i.count<n.viplevel-1e6&&(s=!1,this.htxt_desc.innerHTML=S.TextConst.get(1148,i.count,n.viplevel-1e6)):0<n.viplevel&&g.RoleCenter.instans.vo.getCurLv()<n.viplevel&&(s=!1,p.E.ins.on(d.EventName.ADDED_LEVEL,this,this.onLevelChanged),this.htxt_desc.innerHTML=S.TextConst.get(1147,I.ItemUtils.getLVString(n.viplevel)))}s?(this.btn_buy.visible=!0,this.ani.visible=!0,this.htxt_desc.visible=!1,0==n.cost[0][1]?this.btn_buy.label=S.TextConst.get(227):"RMB"==n.cost[0][0]?this.btn_buy.label=S.TextConst.get(5,n.cost[0][1]):"GOLD"==n.cost[0][0]&&(this.btn_buy.label=S.TextConst.get(6,n.cost[0][1]))):o?(this.ani.visible=!1,this.btn_buy.visible=!0,this.btn_buy.disabled=!0,this.btn_buy.label=S.TextConst.get(805)):(this.htxt_desc.visible=!0,this.btn_buy.visible=!1,this.ani.visible=!1)}else if(i.status==m.enumStatus.kelingqu){var r=!1,l=i.childCountArr[0],h=y.ServerTime.serverTime,c=i.childCountArr[1];if(l<=h)r=!0;else{var u=l-h+1;Laya.timer.once(1e3*u,this,this.show,[this._selectIndex]),0<n.value2&&c>=n.value2&&(r=!0)}r?(this.btn_buy.visible=!0,this.ani.visible=!0,this.htxt_desc.visible=!1,this.btn_buy.label=S.TextConst.get(203)):(this.btn_buy.visible=!0,this.ani.visible=!1,this.htxt_desc.visible=!1,this.btn_buy.label="已购买",this.btn_buy.disabled=!0)}else this.btn_buy.visible=!0,this.ani.visible=!1,this.htxt_desc.visible=!1,this.btn_buy.disabled=!0,this.btn_buy.label=S.TextConst.get(211)}},t.prototype.onLevelChanged=function(){this.show(this._selectIndex)},t.prototype.doBuyHandler=function(){if(Date.now()-this._lastBuyTime<1e3)a.FE.upItems(S.TextConst.get(258),r.BubbleEnum.center);else if(g.RoleCenter.instans.bagRoomEnough()){var t=g.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=this._childIndexArr[this._selectIndex],i=t.children[e],n=v.GameConfig.subActivityJson[i.cfgId];if(!g.RoleCenter.instans.bagRoomEnough())return void u.AM.showBagNotEnough();if(i.status==m.enumStatus.weiwancheng)if(n.cost[0]&&"RMB"==n.cost[0][0])this._lastBuyTime=Date.now(),c.GNet.toRecharge(Number(n.desc));else{if("GOLD"==n.cost[0][0]&&g.RoleCenter.instans.vo.GOLD<n.cost[0][1])return void E.Switches.ins.event(155);this._lastBuyTime=Date.now(),(s=new l.ActivityGetC2GS).id=this._activityId,s.activity2CfgId=i.cfgId,h.GSM.sendServer(s)}else if(i.status==m.enumStatus.kelingqu){var s;(s=new l.ActivityGetC2GS).id=this._activityId,s.activity2CfgId=i.cfgId,h.GSM.sendServer(s)}}}else u.AM.showBagNotEnough()},t.prototype.checkBunusShowAni=function(t){var e,i,n=t.length,s=0;for(this.img_title.visible=!0,this.img_stage.visible=!1;s<n;){if(e=t[s][0],i=v.GameConfig.fashionJson[e]){this.loadFasionAni(i),this.img_title.visible=!1;break}if(i=v.GameConfig.titleJSON[e]){this.loadTitleAni(i),this.img_title.visible=!1;break}s++}this.box_title.visible=!this.img_title.visible},t.prototype.loadTitleAni=function(t){var e,i="dynamic2/chenghao/"+t.icon+".json";this.img_stage.visible=!0;for(var n=this.box_title.numChildren;0<n;)if(e=this.box_title.getChildAt(0)){e.stop(),e.clear();break}if(e){if(e._url&&e._url==i)return void e.play()}else(e=new _.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,e.scale(1,1),e.load(i)},t.prototype.loadFasionAni=function(t){var e,i=g.RoleCenter.instans.vo.getSex(),n=this.box_title.numChildren;t.position==C.FashionPos.WING?o=0:t.position==C.FashionPos.WEAPON?o=1:t.position==C.FashionPos.FASHION&&(o=2);for(var s=I.ItemUtils.getAvtoarSource(t.res,o,i);0<n;)if(e=this.box_title.getChildAt(0)){e.stop(),e.clear();break}if(e){if(e._url&&e._url==s)return void e.play()}else(e=new _.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2;var o=e.rotation=0;t.position==C.FashionPos.WING?(o=0,e.scale(.7,.7)):t.position==C.FashionPos.WEAPON?(o=1,e.scale(.6,.6),e.x+=50,e.y+=50):t.position==C.FashionPos.FASHION&&(o=2,e.y-=50,e.scale(.7,.7)),e.load(s)},t.prototype.cooldownHandler=function(){var t=g.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.endTime-y.ServerTime.serverTime;86400<e?(this.lab_time.changeText(f.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(f.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):(this.lab_time_lab.visible=!1,this.lab_time.visible=!1,this.show(this._selectIndex))}},t}(ui.activity.pages.RechargeAndRebateUI);e.RechargeAndRebatePage=T}),define("src/g/activity/view/pages/TimeLimitAccumulativeRechargePage",["require","exports","src/g/clearRes/ClearResM","../../../../enum/EventName","../../../../core/E","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../net/messages/enumStatus","src/g/Effects/UIEffectsFactory","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","src/init/Switches","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","src/init/TextConst"],function(t,e,i,n,s,r,l,h,o,a,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.updateBtnStat(),this.updateCD(),s.E.ins.on(n.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),s.E.ins.on(n.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),e.addChild(this)},t.prototype.onTimeSpanHandler=function(t){var e=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.refresh=function(){this.updateBtnStat()},t.prototype.hidePage=function(){Laya.timer.clear(this,this.updateCD),s.E.ins.off(n.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),s.E.ins.off(n.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/time_limit_accumulative_recharge/")},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.updateBtnStat()},t.prototype.updateUnchanged=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=l.GameConfig.activityJson[t.cfgId];this.img1.skin="dynamic/activity/time_limit_accumulative_recharge/"+e.bg_img+"1.jpg",this.img2.skin="dynamic/activity/time_limit_accumulative_recharge/"+e.bg_img+"2.jpg";var i=t.children[0];if(i){var n=l.GameConfig.subActivityJson[i.cfgId];if(n)for(var s,o=n.bonus?n.bonus.length:0,a=0;a<5;)(s=this["item"+a])&&(s.offAll(),s.visible=a<o&&(h.ItemCellUtils.fillCellForItemNameView(s,n.bonus[a][0],Number(n.bonus[a][1])),s.on(Laya.Event.CLICK,this,this.showTip,[a]),!0)),a++}}this.ani=c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_get,40),this.ani.visible=!1},t.prototype.showTip=function(t){var e=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=e.children[0];if(i){var n=l.GameConfig.subActivityJson[i.cfgId];n&&o.ItemTips.ins.showTip(n.bonus[t][0],Number(n.bonus[t][1]))}}},t.prototype.updateBtnStat=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[0];e&&(this.ani.visible=!1,this.btn_get.disabled=!1,this.btn_get.offAll(),e.status==a.enumStatus.weiwancheng?(this.btn_get.label=f.TextConst.get(232),this.btn_get.on(Laya.Event.CLICK,this,this.toRecharge)):e.status==a.enumStatus.kelingqu?(this.btn_get.label=f.TextConst.get(203),this.btn_get.on(Laya.Event.CLICK,this,this.getRewardHandler),this.ani.visible=!0):e.status==a.enumStatus.yilingqu&&(this.btn_get.label=f.TextConst.get(211),this.btn_get.disabled=!0))}},t.prototype.getRewardHandler=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[0];if(e&&e.status==a.enumStatus.kelingqu){var i=new u.ActivityGetC2GS;i.id=this._activityId,i.activity2CfgId=e.cfgId,p.GSM.sendServer(i)}}},t.prototype.toRecharge=function(){d.Switches.ins.event(109)},t.prototype.updateCD=function(){if(Laya.timer.clear(this,this.updateCD),r.RoleCenter.instans.vo.getActivity1Data(this._activityId)){var t=v.DateUtil.getZeroTime()-g.ServerTime.serverTime;0<=t?(this.lab_cd.changeText(v.DateUtil.getHMS_countdown(t)),Laya.timer.once(1e3,this,this.updateCD)):this.lab_cd.changeText("00:00:00")}},t}(ui.activity.pages.Time_limit_Accumulative_RechargeUI);e.TimeLimitAccumulativeRechargePage=y}),define("src/g/activity/view/item/FirstRechargeGroupBuyItem",["require","exports","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../net/messages/enumStatus","src/g/Effects/UIEffectsFactory","../../../../manager/GameSocketManager","../../../net/messages/activity/ActivityGet","src/init/TextConst"],function(t,e,r,l,i,n,h,c,s,o,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.htxt_desc.style.color="#e3cca9",t.htxt_desc.style.font="SimHei",t.htxt_desc.style.fontSize=19,t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.setData=function(t,e,i){var n=r.RoleCenter.instans.vo.getActivity1Data(t);if(n){var s=n.children[e];if(s){var o=l.GameConfig.subActivityJson[s.cfgId];if(o){this.htxt_desc.innerHTML=o.title,i>o.value2&&(i=o.value2),this.lab_progress.changeText(u.TextConst.get(257,i,o.value2)),this.list_item.array=o.bonus;var a=this.icon_state.visible=!1;this.btn_get.offAll(),s.status==h.enumStatus.weiwancheng?(this.btn_get.visible=!0,this.btn_get.disabled=!0,this.btn_get.label=u.TextConst.get(210)):s.status==h.enumStatus.kelingqu?(this.btn_get.disabled=!1,this.btn_get.label=u.TextConst.get(216),this.btn_get.visible=!0,this.btn_get.on(Laya.Event.CLICK,this,this.getRewardHandler,[t,s.cfgId]),a=!0):(this.btn_get.visible=!1,this.icon_state.visible=!0),a?(this.ani||(this.ani=c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_get,40,.62,.8)),-1==this.btn_get.getChildIndex(this.ani)&&c.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_get),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_get.getChildIndex(this.ani)&&this.btn_get.removeChild(this.ani))}}}},t.prototype.getRewardHandler=function(t,e){var i=new o.ActivityGetC2GS;i.id=t,i.activity2CfgId=e,s.GSM.sendServer(i)},t}(ui.activity.item.FirstRechargeGroupBuyItemUI);e.FirstRechargeGroupBuyItem=a}),define("src/g/activity/view/pages/FirstRechargeGroupBuyPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../config/GameConfig","src/g/activity/view/item/FirstRechargeGroupBuyItem","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","src/init/Switches","../../../net/messages/enumStatus","src/init/TextConst"],function(t,e,i,n,s,a,r,o,l,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t._firstNum=0,t.list_main.itemRender=o.FirstRechargeGroupBuyItem,t.list_main.renderHandler=new Laya.Handler(t,t.onFRGBListRenderHandler),t.list_main.scrollBar.elasticDistance=100,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.updateShow(),this.updateRed(),this.updateCD(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),u.GSM.ins.on(c.GetSvrAd1DataMsg.KEY,this,this.onGetSvrAd1DataBackHandler),this.getSvrFirstRechargeNum(),e.addChild(this)},t.prototype.onGetSvrAd1DataBackHandler=function(t){t.id==this._activityId&&(this._firstNum=t.value,this.list_main.refresh())},t.prototype.refresh=function(){this.list_main.refresh()},t.prototype.hidePage=function(){Laya.timer.clear(this,this.updateCD),n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/first_recharge_group_buy/")},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&(this.list_main.refresh(),this.updateRed(),this.updateShow())},t.prototype.getSvrFirstRechargeNum=function(){var t=new c.GetSvrAd1DataMsg;t.id=this._activityId,u.GSM.sendServer(t)},t.prototype.updateUnchanged=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=r.GameConfig.activityJson[t.cfgId];this.title_img.skin="dynamic/activity/first_recharge_group_buy/"+e.bg_img+".jpg",this._groupArr=[];for(var i,n=t.children.length,s=0;s<n;)(i=r.GameConfig.subActivityJson[t.children[s].cfgId])&&-1==this._groupArr.indexOf(i.value2)&&this._groupArr.push(i.value2),s++;n=this._groupArr.length,s=0;for(var o=[];s<n;)o.push(g.TextConst.get(265,this._groupArr[s])),s++;this.tab_group.labels=o.join(","),this.tab_group.selectHandler=new Laya.Handler(this,this.onGroupSelectHandler),this.tab_group.selectedIndex=0}this.btn_recharge.on(Laya.Event.CLICK,this,this.toRecharge)},t.prototype.toRecharge=function(){p.Switches.ins.event(109)},t.prototype.updateShow=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);t&&(this.txt_value.text=t.allData.allCount.toString())},t.prototype.updateRed=function(){if(this.img_red0.visible=this.img_red1.visible=this.img_red2.visible=this.img_red3.visible=this.img_red4.visible=!1,this._groupArr){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)for(var e,i=t.children.length,n=0,s=-1;n<i;)t.children[n].status==d.enumStatus.kelingqu&&(e=r.GameConfig.subActivityJson[t.children[n].cfgId],-1<(s=this._groupArr.indexOf(e.value2))&&(this["img_red"+s].visible=!0)),n++}},t.prototype.onGroupSelectHandler=function(t){var e=this._groupArr[t],i=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(i){this._childIndexArr=[];for(var n,s=i.children.length,o=0;o<s;)(n=r.GameConfig.subActivityJson[i.children[o].cfgId])&&n.value2==e&&this._childIndexArr.push(o),o++;this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_main.array=this._childIndexArr}},t.prototype.childSortFun=function(t,e){var i=a.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=r.GameConfig.subActivityJson[i.children[t].cfgId],s=r.GameConfig.subActivityJson[i.children[e].cfgId];return n.childId-s.childId},t.prototype.onFRGBListRenderHandler=function(t,e){t.setData(this._activityId,this._childIndexArr[e],this._firstNum)},t.prototype.updateCD=function(){Laya.timer.clear(this,this.updateCD);var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-h.ServerTime.serverTime;0<e?(this.lab_time.changeText(l.DateUtil.remainingTimeStr(e)),Laya.timer.once(6e4,this,this.updateCD)):this.lab_time.changeText(g.TextConst.get(11,0))}},t}(ui.activity.pages.FirstRechargeGroupBuyPageUI);e.FirstRechargeGroupBuyPage=v}),define("src/g/activity/view/item/DailyCompeteListItem",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../config/GameConfig","src/g/Effects/UIEffectsFactory","../../../net/messages/enumStatus","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.onClickHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.setData=function(t,e,i){this.subActivity=t,this._activityId=e;var n=s.GameConfig.subActivityJson[t.cfgId];n&&(this.lab_title.changeText(n.title),this.ani||(this.ani=o.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_get,42)),t.status==a.enumStatus.weiwancheng?(this.btn_get.disabled=!0,this.btn_get.label=h.TextConst.get(837),this.ani.visible=!1,this.btn_get.visible=!0,this.icon_state.visible=!1):t.status==a.enumStatus.kelingqu?(this.btn_get.disabled=!1,this.btn_get.label=h.TextConst.get(216),this.ani.visible=!0,this.btn_get.visible=!0,this.icon_state.visible=!1):t.status==a.enumStatus.yilingqu&&(this.btn_get.visible=!1,this.icon_state.visible=!0,this.ani.visible=!1),this.list_item.array=n.bonus)},t.prototype.onClickHandler=function(){if(this.subActivity&&this.subActivity.status==a.enumStatus.kelingqu){var t=new r.ActivityGetC2GS;t.id=this._activityId,t.activity2CfgId=this.subActivity.cfgId,l.GSM.sendServer(t)}},t}(ui.activity.item.Daily_Compete_List_ItemUI);e.DailyCompeteListItem=c}),define("src/g/activity/view/pages/DailyCompeteListPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","../../../../meta/MainButtonVo","src/g/activity/view/item/DailyCompeteListItem","../../../net/messages/enumStatus"],function(t,e,i,n,s,r,l,h,c,o,a,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.list_main.scrollBar.elasticDistance=100,t.list_main.itemRender=a.DailyCompeteListItem,t.list_main.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):(i.ClearResM.resetViewImg(this),this.updateListContent()),this.refreshTextToNew(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),e.addChild(this)},t.prototype.refreshTextToNew=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);t&&(this.lab_lv_lab.changeText(this._currTitle+":"),this.lab_lv.changeText(t.allData.allCount.toString()))},t.prototype.onTimeSpanHandler=function(t){var e=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.refresh=function(){this.updateListContent(),this.refreshTextToNew()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.off(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/daily_compete_list/")},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.onListRenderHandler=function(t,e){t.setData(t.dataSource,this._activityId,this._currTitle)},t.prototype.updateUnchanged=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=l.GameConfig.activityJson[t.cfgId];this.time_txt.changeText(h.DateUtil.remainingTimeStr(t.rewardTime-c.ServerTime.serverTime)),this.desc_txt.text=e.desc,this.title_img.skin="dynamic/activity/daily_compete_list/"+e.bg_img+".png",this.img_gg.visible=!1;var i=t.children[0];if(i){var n=l.GameConfig.subActivityJson[i.cfgId];n&&n.image&&(this.btn_goto.label=n.desc,this.img_gg.visible=!0,this.img_gg.skin="dynamic/activity/daily_compete_list/"+n.image+".png",this.img_gg.on(Laya.Event.CLICK,this,this.gotoHandler,[n]))}var s=l.GameConfig.activityRankJson;for(var o in s){var a=s[o];if(a.activityId==t.cfgId){this._currTitle=a.title;break}}this.updateListContent(),this.btn_goto.offAll(),this.btn_goto.on(Laya.Event.CLICK,this,this.gotoModuleHandler,[e])}else console.log("没有找到数据，类型：daily_compete_list")},t.prototype.gotoModuleHandler=function(t){t.module&&0<t.module.length&&o.MainButtonStruct.Ins.OpenModule(t.module[0][1],t.module[1][1])},t.prototype.gotoHandler=function(t){t.moduleID&&0<t.moduleID.length&&o.MainButtonStruct.Ins.OpenModule(t.moduleID[0][1],t.moduleID[1][1])},t.prototype.updateListContent=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children.concat();e.sort(this.childSortFun),this.list_main.array=e}},t.prototype.childSortFun=function(t,e){var i=l.GameConfig.subActivityJson[t.cfgId],n=l.GameConfig.subActivityJson[e.cfgId],s=i?i.childId+100:100,o=n?n.childId+100:100;return t.status==u.enumStatus.kelingqu?s-=100:t.status==u.enumStatus.yilingqu&&(s+=100),e.status==u.enumStatus.kelingqu?o-=100:e.status==u.enumStatus.yilingqu&&(o+=100),s-o},t}(ui.activity.pages.Daily_Compete_ListUI);e.DailyCompeteListPage=p}),define("src/g/activity/view/item/AccumulativeSpendingItem",["require","exports","../../../../manager/RoleCenter","../../../net/messages/enumStatus","../../../../config/GameConfig","src/g/Effects/UIEffectsFactory","../../../../manager/AM","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../meta/MainButtonVo","src/init/TextConst"],function(t,e,a,r,l,h,s,o,c,i,n,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.getHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.getHandler=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex];if(e&&e.status==r.enumStatus.kelingqu){if(!a.RoleCenter.instans.bagRoomEnough())return void s.AM.showBagNotEnough();var i=new o.ActivityGetC2GS;i.id=this._activityId,i.activity2CfgId=e.cfgId,c.GSM.sendServer(i)}else if(e.status==r.enumStatus.weiwancheng){var n=l.GameConfig.subActivityJson[e.cfgId];u.MainButtonStruct.Ins.OpenModule(n.moduleID[0][1],n.moduleID[1][1])}}},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e;var i=a.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=l.GameConfig.subActivityJson[n.cfgId],o=this.icon_state.visible=!1;this.lab_progress.color="#09d51f",n.status==r.enumStatus.weiwancheng?(this.btn_get.visible=!0,this.btn_get.disabled=!0,this.btn_get.label=p.TextConst.get(210),s.moduleID&&0<s.moduleID.length&&(this.btn_get.disabled=!1,this.btn_get.label=p.TextConst.get(215)),this.lab_progress.color="#ff0f15"):n.status==r.enumStatus.kelingqu?(this.btn_get.disabled=!1,this.btn_get.label=p.TextConst.get(216),o=this.btn_get.visible=!0):(this.btn_get.visible=!1,this.icon_state.visible=!0),this.lab_progress.changeText(Math.min(n.count,s.value)+"/"+s.value),o?(this.ani||(this.ani=h.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_get.getChildIndex(this.ani)&&h.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_get),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_get.getChildIndex(this.ani)&&this.btn_get.removeChild(this.ani)),this.list_item.array=s.bonus}}},t}(ui.activity.item.Accumulative_spending_itemUI);e.AccumulativeSpendingItem=d}),define("src/g/activity/view/pages/AccumulativeSpendingPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../config/GameConfig","../../../net/messages/enumStatus","src/g/activity/view/item/AccumulativeSpendingItem","../../../../manager/RoleCenter","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl"],function(t,e,i,n,s,h,c,o,u,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.refresh(),this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this)},t.prototype.refresh=function(){this.updateListData()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/accumulative_spending/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_main.scrollBar.elasticDistance=100,this.list_main.itemRender=o.AccumulativeSpendingItem,this.list_main.renderHandler=new Laya.Handler(this,this.renderHandler)},t.prototype.updateUnchanged=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=h.GameConfig.activityJson[t.cfgId];this.title_img.skin="dynamic/activity/accumulative_spending/"+e.bg_img+".jpg",this._childIndexArr=[];for(var i=t.children.length,n=0;n<i;)this._childIndexArr.push(n),n++}else console.log("没有找到数据，类型：accumulative_spending")},t.prototype.updateListData=function(){this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_main.array=this._childIndexArr},t.prototype.childSortFun=function(t,e){var i=u.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=i.children[t],s=i.children[e],o=h.GameConfig.subActivityJson[n.cfgId],a=h.GameConfig.subActivityJson[s.cfgId],r=o?o.childId+100:100,l=a?a.childId+100:100;return n.status==c.enumStatus.kelingqu?r-=100:n.status==c.enumStatus.yilingqu&&(r+=100),s.status==c.enumStatus.kelingqu?l-=100:s.status==c.enumStatus.yilingqu&&(l+=100),r-l},t.prototype.renderHandler=function(t,e){t.setData(this._activityId,this.list_main.array[e])},t.prototype.cooldownHandler=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-a.ServerTime.serverTime;86400<e?(this.lab_time.changeText(r.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(r.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t}(ui.activity.pages.Accumulative_spendingUI);e.AccumulativeSpendingPage=l}),define("src/g/activity/view/item/CurrencyExchangeItem",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../manager/RoleCenter","../../../../manager/AM","../../../net/messages/enumStatus","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../config/GameConfig","src/g/Effects/UIEffectsFactory","src/init/TextConst"],function(t,e,i,n,a,s,r,o,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.getHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.getHandler=function(){if(a.RoleCenter.instans.bagRoomEnough()){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex];if(e&&e.status==r.enumStatus.kelingqu){var i=new o.ActivityGetC2GS;i.id=this._activityId,i.activity2CfgId=e.cfgId,l.GSM.sendServer(i)}}}else s.AM.showBagNotEnough()},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e;var i=a.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=h.GameConfig.subActivityJson[n.cfgId];this.lab_desc.changeText(s.title);var o=this.icon_state.visible=!1;this.lab_progress.color="#09d51f",n.status==r.enumStatus.weiwancheng?(this.btn_get.visible=!0,this.btn_get.disabled=!0,this.btn_get.label=u.TextConst.get(210),this.lab_progress.color="#ff0f15"):n.status==r.enumStatus.kelingqu?(this.btn_get.disabled=!1,this.btn_get.label=u.TextConst.get(216),o=this.btn_get.visible=!0):(this.btn_get.visible=!1,this.icon_state.visible=!0),this.lab_progress.changeText(Math.min(n.count,s.value)+"/"+s.value),o?(this.ani||(this.ani=c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_get.getChildIndex(this.ani)&&c.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_get),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_get.getChildIndex(this.ani)&&this.btn_get.removeChild(this.ani)),this.list_item.array=s.bonus}}},t}(ui.activity.item.Currency_Exchange_itemUI);e.CurrencyExchangeItem=p}),define("src/g/activity/view/pages/CurrencyExchangePage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","src/g/activity/view/item/CurrencyExchangeItem","../../../../manager/RoleCenter","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","../../../net/messages/enumStatus","../../../../config/GameConfig","../../../../utils/ItemUtils","src/g/bag/tips/view/ItemTips"],function(t,e,i,n,s,o,h,a,r,c,u,l,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.refresh(),this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this)},t.prototype.refresh=function(){this.updateListData();var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);t&&this.lab_count.changeText(t.allData.allCount.toString())},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/currency_exchange/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_main.scrollBar.elasticDistance=100,this.list_main.itemRender=o.CurrencyExchangeItem,this.list_main.renderHandler=new Laya.Handler(this,this.renderHandler)},t.prototype.updateUnchanged=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=u.GameConfig.activityJson[t.cfgId],i=parseInt(e.value);l.ItemUtils.getItemVoById(i)&&(this.img_currency.skin=l.ItemUtils.getIconById(i),this.lab_count.changeText(t.allData.allCount.toString()),this.lab_desc.changeText(e.desc),this.img_currency.on(Laya.Event.CLICK,this,function(){p.ItemTips.ins.showTip(i,1)})),this.title_img.skin="dynamic/activity/currency_exchange/"+e.bg_img+".png",this._childIndexArr=[];for(var n=t.children.length,s=0;s<n;)this._childIndexArr.push(s),s++}else console.log("没有找到数据，类型：currency_exchange")},t.prototype.updateListData=function(){this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_main.array=this._childIndexArr},t.prototype.childSortFun=function(t,e){var i=h.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=i.children[t],s=i.children[e],o=u.GameConfig.subActivityJson[n.cfgId],a=u.GameConfig.subActivityJson[s.cfgId],r=o?o.childId+100:100,l=a?a.childId+100:100;return n.status==c.enumStatus.kelingqu?r-=100:n.status==c.enumStatus.yilingqu&&(r+=100),s.status==c.enumStatus.kelingqu?l-=100:s.status==c.enumStatus.yilingqu&&(l+=100),r-l},t.prototype.renderHandler=function(t,e){t.setData(this._activityId,this.list_main.array[e])},t.prototype.cooldownHandler=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.endTime-a.ServerTime.serverTime;86400<e?(this.lab_time.changeText(r.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(r.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t}(ui.activity.pages.Currency_ExchangeUI);e.CurrencyExchangePage=d}),define("src/g/activity/view/item/GiftTurntableItem",["require","exports","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../net/messages/enumStatus","src/g/Effects/UIEffectsFactory","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../meta/MainButtonVo","../../../../utils/StringUtils","src/init/TextConst"],function(t,e,h,c,u,p,s,o,a,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.getHandler),t}return __extends(t,e),t.prototype.getHandler=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex];if(e&&e.status==u.enumStatus.kelingqu){var i=new s.ActivityGetC2GS;i.id=this._activityId,i.activity2CfgId=e.cfgId,o.GSM.sendServer(i)}else if(e.status==u.enumStatus.weiwancheng){var n=c.GameConfig.subActivityJson[e.cfgId];a.MainButtonStruct.Ins.OpenModule(n.moduleID[0][1],n.moduleID[1][1])}}},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e;var i=h.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=c.GameConfig.subActivityJson[n.cfgId],o=(s.bonus[0][0],Number(s.bonus[0][1]));this.lab_num.changeText(o.toString()),this.lab_desc.changeText(s.title);var a=i.task.countArr[s.value-1]||0,r=s.value2;r<a&&(a=r);var l=this.icon_state.visible=!1;this.lab_progress.color="#09d51f",n.status==u.enumStatus.weiwancheng?(this.btn_get.visible=!0,this.btn_get.disabled=!0,this.btn_get.label=g.TextConst.get(210),s.moduleID&&0<s.moduleID.length&&(this.btn_get.disabled=!1,this.btn_get.label=g.TextConst.get(200)),this.lab_progress.color="#ff0f15"):n.status==u.enumStatus.kelingqu?(this.btn_get.disabled=!1,this.btn_get.label=g.TextConst.get(216),l=this.btn_get.visible=!0):(this.btn_get.visible=!1,this.icon_state.visible=!0),22==s.value?this.lab_progress.changeText(d.StringUtils.NumString(a)+"/"+d.StringUtils.NumString(r)):this.lab_progress.changeText(a+"/"+r),l?(this.ani||(this.ani=p.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_get.getChildIndex(this.ani)&&p.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_get),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_get.getChildIndex(this.ani)&&this.btn_get.removeChild(this.ani))}}},t}(ui.activity.item.GiftTurntableItemUI);e.GiftTurntableItem=i}),define("src/g/activity/view/pages/GiftTurntablePage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","src/g/activity/view/item/GiftTurntableItem","../../../net/messages/activity/ActivityGet","../../../../utils/system/FloatEffect","src/g/account/ctrl/GetRewwardCtrl","../../../../utils/ItemUtils","../../../../manager/GameSocketManager","../../../../plugin/view/ToolTip","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","../../../net/messages/enumStatus","src/init/TextConst"],function(t,e,i,n,s,r,l,o,a,h,c,u,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t._running=!1,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),g.GSM.ins.on(c.ActivityGetGS2C.KEY,this,this.onActivityGetHandler),this.refresh(),this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this),this.x=(e.width-this.width)/2},t.prototype.refresh=function(){0==this._running&&(this.initTurntableAndTask(),this.updateItemNumShow())},t.prototype.hidePage=function(){g.GSM.ins.off(c.ActivityGetGS2C.KEY,this,this.onActivityGetHandler),n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/gift_turntable/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&Laya.timer.frameOnce(2,this,this.refresh)},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_main.scrollBar.elasticDistance=100,this.list_main.itemRender=h.GiftTurntableItem,this.list_main.renderHandler=new Laya.Handler(this,this.onListRenderHandler),this.btn_run.on(Laya.Event.CLICK,this,this.onTurnClickHandler),this.img_arrow.rotation=0,this.on(Laya.Event.CLICK,this,this.doStopAniHandler)},t.prototype.doStopAniHandler=function(){if(this._running&&this._lastGetMsg){var t=Number(this._lastGetMsg.error);Laya.Tween.clearAll(this.img_arrow),this._running=!1,-1<t&&(this.img_arrow.rotation=45*t,u.FE.addInventoryToCFloats(this._lastGetMsg.inv),p.GetRewwardCtrl.inventoryAddGS2C(this._lastGetMsg.inv),this.refresh())}},t.prototype.onListRenderHandler=function(t,e){t.setData(this._activityId,this.list_main.array[e])},t.prototype.updateUnchanged=function(){},t.prototype.updateItemNumShow=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=this._childIndexArr[0],i=t.children[e],n=_.TextConst.get(222);if(i){var s=l.GameConfig.subActivityJson[i.cfgId],o=d.ItemUtils.getItemVoById(s.bonus[0][0]);o&&(n=o.name)}this.lab_count.changeText(Math.floor(t.allData.allCount/100).toString());var a=t.allData.allCount%100;this.lab_progress.changeText(a+"/100"),this.img_progress.scaleX=a/100,this.lab_bottom_desc.changeText(_.TextConst.get(266,n))}},t.prototype.initTurntableAndTask=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){this._currTurnTableId=t.allData.time,this._childIndexArr=[];for(var e,i=t.children.length,n=0;n<i;){if(e=t.children[n]){var s=l.GameConfig.subActivityJson[e.cfgId];s.childId==this._currTurnTableId?this.updateTurntable(e):s.childId>100*this._currTurnTableId&&s.childId-100*this._currTurnTableId<100&&this._childIndexArr.push(n)}n++}this.list_main.array=this._childIndexArr.sort(this.childSortFun.bind(this))}},t.prototype.childSortFun=function(t,e){var i=r.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=l.GameConfig.subActivityJson[i.children[t].cfgId],s=l.GameConfig.subActivityJson[i.children[e].cfgId],o=n?n.childId+1e3:1e3,a=s?s.childId+1e3:1e3;return i.children[t].status==m.enumStatus.kelingqu?o-=1e3:i.children[t].status==m.enumStatus.yilingqu&&(o+=1e3),i.children[e].status==m.enumStatus.kelingqu?a-=1e3:i.children[e].status==m.enumStatus.yilingqu&&(a+=1e3),o-a},t.prototype.updateTurntable=function(t){var e=l.GameConfig.subActivityJson[t.cfgId];this._currActivitySubCfgId=t.cfgId;for(var i,n=e.bonus.length,s=0;s<8;)(i=this["item"+s])&&(s<n&&o.ItemCellUtils.fillCellForItemNameView(i,e.bonus[s][0],Number(e.bonus[s][1])),i.offAll(),i.on(Laya.Event.CLICK,this,function(t){a.ItemTips.ins.showTip(e.bonus[t][0],Number(e.bonus[t][1]))},[s]),i.gray=-1<t.childCountArr.indexOf(s)),s++},t.prototype.updateTurnTableStateOnly=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)for(var e,i=t.children.length,n=0;n<i;){if(e=t.children[n])if(l.GameConfig.subActivityJson[e.cfgId].childId==this._currTurnTableId){for(var s=0;s<8;s++)this["item"+s].gray=-1<e.childCountArr.indexOf(s);return}n++}},t.prototype.onActivityGetHandler=function(t){this._activityId==t.id&&t.opresult&&this.play(t)},t.prototype.play=function(t){var e=this;this._lastGetMsg=t;var i=Number(t.error);if(-1<i){this._running=!0;var n=3600+45*i+20*Math.random();this.img_arrow.rotation%=360,Laya.Tween.to(this.img_arrow,{rotation:n},7e3,Laya.Ease.circInOut,Laya.Handler.create(this,function(){e._running=!1,e.displayedInStage&&(u.FE.addInventoryToCFloats(t.inv),p.GetRewwardCtrl.inventoryAddGS2C(t.inv),e.refresh())}))}},t.prototype.onTurnClickHandler=function(){if(!this._running){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)if(100<=t.allData.allCount){for(var e,i=t.children.length,n=0;n<i;){if((e=t.children[n])&&e.cfgId==this._currActivitySubCfgId){var s=l.GameConfig.subActivityJson[e.cfgId];if(e.childCountArr.length>=s.desc.split(",").length)return void u.FE.upItems(_.TextConst.get(1011),v.BubbleEnum.center);break}n++}var o=new c.ActivityGetC2GS;o.id=this._activityId,o.activity2CfgId=this._currActivitySubCfgId,g.GSM.sendServer(o)}else u.FE.upItems(_.TextConst.get(267),v.BubbleEnum.center)}},t.prototype.cooldownHandler=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-f.ServerTime.serverTime;86400<e?(this.lab_time.changeText(y.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(y.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t}(ui.activity.pages.GiftTurntableUI);e.GiftTurntablePage=C}),define("src/g/activity/view/item/FlashSaleInnerItem",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../manager/RoleCenter","../../../../manager/AM","../../../../config/GameConfig","src/g/Effects/UIEffectsFactory","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../core/GNet","src/init/TextConst"],function(t,e,i,n,h,s,c,u,o,a,r,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t._lastBuyTime=0,t.btn_get.on(Laya.Event.CLICK,t,t.onBuyHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.onBuyHandler=function(){if(Date.now()-this._lastBuyTime<1e3)o.FE.upItems(p.TextConst.get(258),a.BubbleEnum.center);else if(h.RoleCenter.instans.bagRoomEnough()){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex],i=c.GameConfig.subActivityJson[e.cfgId];if(i){if(0<i.value2&&i.value2-e.count<=0)return void o.FE.upItems(p.TextConst.get(218),a.BubbleEnum.center);if(0<i.viplevel&&h.RoleCenter.instans.vo.VIP<i.viplevel)return void o.FE.upItems(p.TextConst.get(219),a.BubbleEnum.center);this._lastBuyTime=Date.now(),r.GNet.toRecharge(Number(i.desc))}}}else s.AM.showBagNotEnough()},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e;var i=h.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=c.GameConfig.subActivityJson[n.cfgId],o=s.value2,a=s.value2-n.count;this.lab_progress.color=0<a?"#03bb00":"#ff0f15",this.lab_progress.changeText(a+"/"+o),this.btn_get.label=p.TextConst.get(5,s.cost[0][1]),this.lab_double.visible=0<s.originalcost.length;var r=this.lab_double.visible?2:1;this.lab_reward.changeText(p.TextConst.get(95,100*s.cost[0][1]*r)),this.lab_desc.changeText(s.title);var l=!0;0<o&&a<=0&&(l=!1),0<s.viplevel&&h.RoleCenter.instans.vo.VIP<s.viplevel&&(l=!1),this.icon_state.visible=!l,this.lab_progress.visible=this.txt_progress_lab.visible=this.btn_get.visible=l,l?(this.ani||(this.ani=u.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_get.getChildIndex(this.ani)&&u.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_get),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_get.getChildIndex(this.ani)&&this.btn_get.removeChild(this.ani)),this.list_item.array=s.bonus}}},t}(ui.activity.item.FlashSaleInnerItemUI);e.FlashSaleInnerItem=l}),define("src/g/activity/view/pages/FlashSaleInnerPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","src/g/activity/view/item/FlashSaleInnerItem","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/system/DateUitl","../../../../manager/GameSocketManager","../../../net/messages/OpResultGS2C","../../../net/messages/OpResultType","../../../../utils/system/ServerTime"],function(t,e,i,n,s,o,h,c,a,r,l,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t.day=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.refresh(),this.cooldownHandler(),r.GSM.ins.on(l.OpResultGS2C.KEY,this,this.onOpResult),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this)},t.prototype.refresh=function(){this.updateListData()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/flash_sale_inner/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this),r.GSM.ins.off(l.OpResultGS2C.KEY,this,this.onOpResult)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_main.scrollBar.elasticDistance=100,this.list_main.itemRender=o.FlashSaleInnerItem,this.list_main.renderHandler=new Laya.Handler(this,this.onListRenderHandler)},t.prototype.onOpResult=function(t){t.msgidx==u.enumOpResultType.activity_nextDay&&(this.day++,7<this.day&&r.GSM.ins.off(l.OpResultGS2C.KEY,this,this.onOpResult),this.updateUnchanged(),this.cooldownHandler(),this.refresh())},t.prototype.onListRenderHandler=function(t,e){t.setData(this._activityId,this.list_main.array[e])},t.prototype.updateUnchanged=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=c.GameConfig.activityJson[t.cfgId];this.title_img.skin="dynamic/activity/flash_sale_inner/"+e.bg_img+".png",this.lab_desc.changeText(e.desc),this.day<=0&&(this.day=a.DateUtil.getDayFromStartTime(t.startTime,p.ServerTime.ACTIVITY_TIME_OFFSET)),this._childIndexArr=[];for(var i=t.children.length,n=0;n<i;)this._childIndexArr.push(n),n++}else console.log("没有找到数据，类型：accumulative_spending")},t.prototype.updateListData=function(){this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_main.array=this._childIndexArr},t.prototype.childSortFun=function(t,e){var i=h.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=i.children[t],s=i.children[e],o=c.GameConfig.subActivityJson[n.cfgId],a=c.GameConfig.subActivityJson[s.cfgId],r=o?o.childId+100:100,l=a?a.childId+100:100;return 0<o.value2-n.count?r-=100:r+=100,0<a.value2-s.count?l-=100:l+=100,r-l},t.prototype.cooldownHandler=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-p.ServerTime.serverTime;172800<e?(this.time_txt.changeText(a.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.time_txt.changeText(a.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.time_txt.changeText("00:00:00")}},t}(ui.activity.pages.FlashSaleInnerPageUI);e.FlashSaleInnerPage=d}),define("src/g/activity/view/pages/FlashSalePage2",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../config/GameConfig","../../../../manager/RoleCenter","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","../../../../utils/ItemCellUtils","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../manager/GameSocketManager","../../../../core/GNet","../../../net/messages/OpResultType","../../../net/messages/OpResultGS2C","../../../../manager/AM","src/g/bag/tips/view/ItemTips","src/init/TextConst"],function(t,e,i,n,s,h,c,o,a,r,l,u,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t.day=0,t._lastBuyTime=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.refresh(),this.cooldownHandler(),p.GSM.ins.on(v.OpResultGS2C.KEY,this,this.onOpResult),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this)},t.prototype.refresh=function(){this.updateListData()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/flash_sale_2/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this),p.GSM.ins.off(v.OpResultGS2C.KEY,this,this.onOpResult)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_main.renderHandler=new Laya.Handler(this,this.onRenderHandler),this.list_main.mouseHandler=new Laya.Handler(this,this.onMouseHandler),this.btn_buy.on(Laya.Event.CLICK,this,this.onBuyHandler)},t.prototype.onRenderHandler=function(t,e){r.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_main.array[e];if(!i)return;y.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.onOpResult=function(t){t.msgidx==g.enumOpResultType.activity_nextDay&&(this.day++,7<this.day&&p.GSM.ins.off(v.OpResultGS2C.KEY,this,this.onOpResult),this.updateUnchanged(),this.cooldownHandler(),this.refresh())},t.prototype.updateUnchanged=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){h.GameConfig.activityJson[t.cfgId];this.day<=0&&(this.day=o.DateUtil.getDayFromStartTime(t.startTime,a.ServerTime.ACTIVITY_TIME_OFFSET)),this._childIndexArr=[];for(var e=t.children.length,i=0;i<e;){var n=h.GameConfig.subActivityJson[t.children[i].cfgId];n&&this.day==n.value&&this._childIndexArr.push(i),i++}}else console.log("没有找到数据，类型：flash_sale_2")},t.prototype.updateListData=function(){this._childIndexArr.sort(this.childSortFun.bind(this)),this._childIndex=this._childIndexArr[0];var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex];if(e){var i=h.GameConfig.subActivityJson[e.cfgId],n=i.value2,s=i.value2-e.count;this.lab_cost.text=m.TextConst.get(5,i.cost[0][1]),this.lab_cost_orig.text=m.TextConst.get(5,i.originalcost[0][1]),this.lab_vip_exp.changeText(m.TextConst.get(95,100*i.cost[0][1]));var o=!0;0<n&&s<=0&&(o=!1),0<i.viplevel&&c.RoleCenter.instans.vo.VIP<i.viplevel&&(o=!1),this.btn_buy.disabled=!o,this.list_main.array=i.bonus}}},t.prototype.childSortFun=function(t,e){var i=c.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=i.children[t],s=i.children[e],o=h.GameConfig.subActivityJson[n.cfgId],a=h.GameConfig.subActivityJson[s.cfgId],r=o?o.childId+100:100,l=a?a.childId+100:100;return 0<o.value2-n.count?r-=100:r+=100,0<a.value2-s.count?l-=100:l+=100,r-l},t.prototype.cooldownHandler=function(){var t=o.DateUtil.getZeroTime()-a.ServerTime.serverTime;0<=t?(this.lab_time.changeText(o.DateUtil.getHMS_countdown(t)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")},t.prototype.onBuyHandler=function(){if(Date.now()-this._lastBuyTime<1e3)l.FE.upItems(m.TextConst.get(258),u.BubbleEnum.center);else if(c.RoleCenter.instans.bagRoomEnough()){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex],i=h.GameConfig.subActivityJson[e.cfgId];if(i){if(0<i.value2&&i.value2-e.count<=0)return void l.FE.upItems(m.TextConst.get(218),u.BubbleEnum.center);if(0<i.viplevel&&c.RoleCenter.instans.vo.VIP<i.viplevel)return void l.FE.upItems(m.TextConst.get(219),u.BubbleEnum.center);this._lastBuyTime=Date.now(),d.GNet.toRecharge(Number(i.desc))}}}else f.AM.showBagNotEnough()},t}(ui.activity.pages.FlashSalePage2UI);e.FlashSalePage2=_}),define("src/g/activity/view/pages/GroupBuyingPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../net/messages/enumStatus","../../../../utils/system/ServerTime","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../utils/system/DateUitl","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../utils/MathUtils","src/init/TextConst"],function(t,e,i,n,s,c,u,p,d,o,a,r,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t._requestFlg=!1,t._selectIndex=-1,t._stateChangeTime=0,t._state=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),a.GSM.ins.on(o.GetSvrAd1DataMsg.KEY,this,this.onGetSvrAd1DataBackHandler),this.findFirstShowItem(),this.updateSelectItem(),this.cooldownHandler(),Laya.timer.loop(1e3,this,this.cooldownHandler),Laya.timer.loop(200,this,this.effectUpdate),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this)},t.prototype.onGetSvrAd1DataBackHandler=function(t){if(t.id==this._activityId){var e=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e)for(var i=e.children.length,n=0;n<i;){if(e.children[n].cfgId==t.cfg2Id){e.children[n].childCountArr[0]=t.value,n==this._childIndexArr[this._selectIndex]&&this.updateSelectItem();break}n++}}},t.prototype.refresh=function(){this.updateSelectItem()},t.prototype.hidePage=function(){a.GSM.ins.off(o.GetSvrAd1DataMsg.KEY,this,this.onGetSvrAd1DataBackHandler),n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/group_buying/"),Laya.timer.clear(this,this.cooldownHandler),Laya.timer.clear(this,this.effectUpdate)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&(this.getSvrBuyingNum(),this.refresh())},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.btn_enter.on(Laya.Event.CLICK,this,this.doGetRewardHandler),this.btn_turn_left.on(Laya.Event.CLICK,this,this.onTurnLeftHandler),this.btn_turn_right.on(Laya.Event.CLICK,this,this.onTurnRightHandler)},t.prototype.onTurnLeftHandler=function(){0<this._selectIndex&&(this._selectIndex--,this.getSvrBuyingNum(),this.updateSelectItem())},t.prototype.onTurnRightHandler=function(){this._selectIndex<this._childIndexArr.length-1&&(this._selectIndex++,this.getSvrBuyingNum(),this.updateSelectItem())},t.prototype.updateUnchanged=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=u.GameConfig.activityJson[t.cfgId];this.title_img.skin="dynamic/activity/group_buying/"+e.bg_img+".jpg",this._childIndexArr=[];for(var i=t.children.length,n=0;n<i;)this._childIndexArr.push(n),n++;this._childIndexArr.sort(this.childSortFun.bind(this))}else console.log("没有找到数据，类型：group_buying")},t.prototype.childSortFun=function(t,e){var i=c.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=u.GameConfig.subActivityJson[i.children[t].cfgId],s=u.GameConfig.subActivityJson[i.children[e].cfgId];return n.childId-s.childId},t.prototype.findFirstShowItem=function(){var t,e=c.RoleCenter.instans.vo.getActivity1Data(this._activityId),i=this._childIndexArr?this._childIndexArr.length:0,n=0;for(this._selectIndex=0<i?0:-1;n<i;){if(t=this._childIndexArr[n],e.children[t].status!=p.enumStatus.yilingqu){this._selectIndex=n;break}n++}this._requestFlg=!1,this.getSvrBuyingNum()},t.prototype.updateSelectItem=function(){this.btn_turn_left.visible=0<this._selectIndex,this.btn_turn_right.visible=this._selectIndex<this._childIndexArr.length-1;var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=u.GameConfig.activityJson[t.cfgId],i=Number(e.value)+t.startTime;i>d.ServerTime.serverTime?(this._state=0,this._stateChangeTime=i,this.img_cd_lab.skin="res/activity/group_buying/quanmintuangou_daojishi1.png"):(this._state=1,this._stateChangeTime=t.rewardTime,this.img_cd_lab.skin="res/activity/group_buying/quanmintuangou_daojishi2.png");var n=this._childIndexArr[this._selectIndex],s=t.children[n];if(s){var o=u.GameConfig.subActivityJson[s.cfgId],a=0;0<s.childCountArr.length&&(a=s.childCountArr[0]),this.lab_player_num.changeText(a.toString()),this.lab_buy_num.changeText((o.value2-s.count).toString());var r=o.bonus[0][0];this.item_num.value="x"+o.bonus[0][1],this.img_icon.skin="dynamic/activity/group_buying/"+r+".png",this.img_icon.offAll(),this.img_icon.on(Laya.Event.CLICK,this,function(){v.ItemTips.ins.showTip(o.bonus[0][0],Number(o.bonus[0][1]))}),this.lab_orgi_price.changeText(o.originalcost[0][1]),0==this._state?(g.ItemCellUtils.fillCellForItem0View(this.item_can,o.bonus[1][0],Number(o.bonus[1][1])),this.item_can.offAll(),this.item_can.on(Laya.Event.CLICK,this,function(){v.ItemTips.ins.showTip(o.bonus[1][0],Number(o.bonus[1][1]))}),this.lab_down_pay.changeText(o.cost[0][1]),this.img_reward_lab.visible=this.item_can.visible=!0,this.lab_down_pay_lab.visible=this.img_down_pay.visible=this.lab_down_pay.visible=!0):(this.img_reward_lab.visible=this.item_can.visible=!1,this.lab_down_pay_lab.visible=this.img_down_pay.visible=this.lab_down_pay.visible=!1);var l=this.setProgress(o,a);this.lab_price.changeText(Math.floor(o.originalcost[0][1]*l).toString());var h=0==this._state&&s.status==p.enumStatus.weiwancheng||1==this._state&&s.count<o.value2;this.btn_enter.label=0==this._state?h?y.TextConst.get(233):y.TextConst.get(225):y.TextConst.get(224),this.btn_enter.disabled=!h}}},t.prototype.setProgress=function(t,e){for(var i=t.desc.split(","),n=i.length,s=0,o=0,a=0,r=0,l=1,h=[0];s<n;)a=Number(i[s]),r=Number(i[s+1]),h.push(a),a<=e&&(l=r/10),o<5&&(this["zhe"+o].value=r.toString(),this["lab_progress"+o].changeText(y.TextConst.get(31,a))),o++,s+=2;return this.img_progress.scaleX=f.MathUtils.sectionProgress(h,e),l},t.prototype.getSvrBuyingNum=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=this._childIndexArr[this._selectIndex],i=t.children[e];if(i){var n=new o.GetSvrAd1DataMsg;n.id=this._activityId,n.cfg2Id=i.cfgId,a.GSM.sendServer(n)}}},t.prototype.doGetRewardHandler=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=this._childIndexArr[this._selectIndex],i=t.children[e];if(i){var n=u.GameConfig.subActivityJson[i.cfgId];if(0==this._state&&i.status==p.enumStatus.weiwancheng||1==this._state&&i.count<n.value2){this._requestFlg=!0;var s=new o.ActivityGetC2GS;s.id=this._activityId,s.activity2CfgId=i.cfgId,a.GSM.sendServer(s)}}}},t.prototype.cooldownHandler=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-d.ServerTime.serverTime;86400<e?this.lab_time.changeText(r.DateUtil.remainingDHStr(e)):0<e?this.lab_time.changeText(r.DateUtil.getHMS_countdown(e)):this.lab_time.changeText("00:00:00"),this._stateChangeTime<d.ServerTime.serverTime&&this.updateSelectItem(),this.setCooldown(this._stateChangeTime-d.ServerTime.serverTime)}},t.prototype.setCooldown=function(t){var e=t/3600>>0,i=(t/60>>0)%60,n=t%60;e<10&&(e="0"+e),i<10&&(i="0"+i),n<10&&(n="0"+n),this.time_h.value=e.toString(),this.time_m.value=i.toString(),this.time_s.value=n.toString()},t.prototype.effectUpdate=function(){this.img_effect_bg.rotation+=10},t}(ui.activity.pages.Group_BuyingUI);e.GroupBuyingPage=l}),define("src/g/activity/view/pages/TimeLimitLoginPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","src/g/bag/tips/view/ItemTips","../../../../utils/ItemCellUtils","../../../../config/GameConfig","../../../net/messages/enumStatus","src/g/Effects/UIEffectsFactory","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../manager/AM","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","src/init/TextConst"],function(t,e,n,s,o,a,i,r,l,h,c,u,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t._lastBuyTime=0,t._isRequestBuy=!1,t._selectIndex=-1,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):n.ClearResM.resetViewImg(this);var i=this.findCanBuyIndex();this._selectIndex=-1==i?0:i,this.refresh(),this.cooldownHandler(),Laya.timer.loop(200,this,this.effectUpdate),s.E.ins.on(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this)},t.prototype.refresh=function(){this.updateDayItem(),this.show(this._selectIndex)},t.prototype.hidePage=function(){s.E.ins.off(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),this._isRequestBuy=!1,n.ClearResM.clearFolderByUrl("dynamic/activity/time_limit_login/"),Laya.timer.clear(this,this.cooldownHandler),Laya.timer.clear(this,this.effectUpdate)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){if(e==this._activityId){if(this._isRequestBuy){var i=this.findCanBuyIndex();this._selectIndex=-1==i?this._selectIndex:i,this._isRequestBuy=!1}this.refresh()}},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_reward.itemRender=ui.custom.ItemNameViewUI,this.list_reward.renderHandler=new Laya.Handler(this,this.onListRender),this.list_reward.clickHandler=new Laya.Handler(this,this.onMouseListRender),this.htxt_day.style.font="SimHei",this.htxt_day.style.color="#e1a32a",this.htxt_day.style.fontSize=17,this.ani=p.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_get,40),this.ani.visible=!1,this.btn_get.on(Laya.Event.CLICK,this,this.onGetHandler)},t.prototype.onGetHandler=function(){if(Date.now()-this._lastBuyTime<1e3)d.FE.upItems(m.TextConst.get(258),g.BubbleEnum.center);else if(a.RoleCenter.instans.bagRoomEnough()){var t=this._childIndexArr[this._selectIndex],e=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=e.children[t];if(i&&i.status==u.enumStatus.kelingqu){this._lastBuyTime=Date.now(),this._isRequestBuy=!0;var n=new f.ActivityGetC2GS;n.id=this._activityId,n.activity2CfgId=i.cfgId,y.GSM.sendServer(n)}}}else v.AM.showBagNotEnough()},t.prototype.onMouseListRender=function(t){l.ItemTips.ins.showTip(this.list_reward.array[t][0],Number(this.list_reward.array[t][1]))},t.prototype.onListRender=function(t,e){h.ItemCellUtils.fillCellForItemNameView(t,this.list_reward.array[e][0],Number(this.list_reward.array[e][1]))},t.prototype.updateUnchanged=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=c.GameConfig.activityJson[t.cfgId];this.title_img.skin="dynamic/activity/time_limit_login/"+e.bg_img+".png",this._childIndexArr=[];for(var i,n,s=t.children.length,o=0;o<s;)i=c.GameConfig.subActivityJson[t.children[o].cfgId],this._childIndexArr[i.childId-1]=o,o++;for(o=1;o<8;)(n=this["item"+o])&&(n.offAll(),n.img_day.skin="res/activity/time_limit_login/denglu_"+o+"tian.png",n.clip_day.value=o.toString(),i=c.GameConfig.subActivityJson[t.children[this._childIndexArr[o-1]].cfgId],n.btn_icon.skin="dynamic/activity/time_limit_login/"+i.image+".png",n.img_effect.visible=!1,n.on(Laya.Event.CLICK,this,this.onDayItemClickHandler,[o-1])),o++}},t.prototype.findCanBuyIndex=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)for(var e=0,i=this._childIndexArr.length,n=0;n<i;){if(e=this._childIndexArr[n],t.children[e].status!=u.enumStatus.yilingqu)return n;n++}return-1},t.prototype.onDayItemClickHandler=function(t){this._selectIndex!=t&&(this.show(t),this.updateDayItem())},t.prototype.updateDayItem=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)for(var e,i=1,n=0;i<8;){if(e=this["item"+i],n=this._childIndexArr[i-1],e){e.btn_icon.selected=i-this._selectIndex==1;var s=t.children[n];s&&(e.clip_day.gray=e.btn_icon.gray=s.status==u.enumStatus.yilingqu,e.img_effect.visible=s.status==u.enumStatus.kelingqu)}i++}},t.prototype.show=function(t){this._selectIndex=t,t=this._childIndexArr[this._selectIndex],this.lab_day.changeText(m.TextConst.get(60,this._selectIndex+1));var e=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=e.children[t];if(i){this.btn_get.disabled=i.status!=u.enumStatus.kelingqu,this.ani.visible=i.status==u.enumStatus.kelingqu,this.htxt_day.innerHTML=m.TextConst.get(276,e.allData.allCount);var n=c.GameConfig.subActivityJson[i.cfgId];n&&(this.list_reward.array=n.bonus)}}},t.prototype.cooldownHandler=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-i.ServerTime.serverTime;86400<e?(this.lab_time.changeText(r.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(r.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t.prototype.effectUpdate=function(){for(var t,e=1;e<8;)(t=this["item"+e])&&t.img_effect.visible&&(t.img_effect.rotation+=10),e++},t}(ui.activity.pages.TimeLimitLoginUI);e.TimeLimitLoginPage=_}),define("src/g/activity/view/item/ConsumeRankItem2",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","src/init/TextConst"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.setData=function(t,e){1<t.rank.length?this.lab_title.changeText(s.TextConst.get(256,e,t.rank[0],t.rank[1])):0<t.rank.length&&this.lab_title.changeText(s.TextConst.get(255,e,t.rank[0])),this.lab_desc.changeText(s.TextConst.get(30,e+t.limit)),this.list_item.array=t.bonus},t}(ui.activity.item.ConsumeRankItem2UI);e.ConsumeRankItem2=o}),define("src/g/activity/view/item/ActivityRankItem",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","src/g/activity/view/pages/CompeteUtil","../../../../utils/ItemUtils","src/init/GameMain","src/init/TextConst"],function(t,e,i,n,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.setData=function(t,e,i,n,s,o){void 0===o&&(o=1);var a=e+o;this.rank_txt.text=a.toString(),t.username?(this.name_txt.text=p.GameMain.getDisSvrId(t.username)+t.nickname,this.level_txt.text=n+":"+(i==c.svrActivityTrigger.SubValue_Level?u.ItemUtils.getLVString(t.value1):t.value1)):(this.name_txt.text=d.TextConst.get(217),this.level_txt.text="");var r,l=s.length,h=0;for(this.list_item.array=null;h<l;){if(1<(r=s[h]).rank.length){if(a>=r.rank[0]&&a<=r.rank[1]){this.list_item.array=r.bonus;break}}else if(0<r.rank.length&&r.rank[0]==a){this.list_item.array=r.bonus;break}h++}},t}(ui.activity.item.RankItem2UI);e.ActivityRankItem=s}),define("src/g/activity/view/pages/ActivityRankView",["require","exports","src/g/activity/view/item/ActivityRankItem"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t._firstRank=1,t.btn_back.on(Laya.Event.CLICK,t,t.onCloseHandler),t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.list.itemRender=i.ActivityRankItem,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=10,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t}return __extends(t,e),t.prototype.renderHandler=function(t,e){t.setData(this.list.array[e],e,this._trigger,this._title,this._rankRewardList,this._firstRank)},t.prototype.setData=function(t,e,i,n,s){void 0===s&&(s=1),this._trigger=e,this._title=i,this._rankRewardList=n,this._firstRank=s,this.list.array=t},t.prototype.onCloseHandler=function(){this.close()},t}(ui.activity.pages.RankViewUI);e.ActivityRankView=n}),define("src/g/activity/view/pages/ConsumeRankPage",["require","exports","src/g/clearRes/ClearResM","../../../../manager/GameSocketManager","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","../../../../config/GameConfig","../../../net/messages/activity/ActivityGet","src/g/activity/view/item/ConsumeRankItem2","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../meta/MainButtonVo","../../../../core/GNet","src/g/activity/view/pages/ActivityRankView","src/init/GameMain","src/init/TextConst"],function(t,e,i,o,n,s,a,r,l,h,c,u,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t._currTitle="",t._svrid=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.refresh(),this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),e.addChild(this)},t.prototype.onTimeSpanHandler=function(t){var e=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.refresh=function(){this.requestRankHandler();var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);t&&this.lab_value.changeText(t.allData.allCount.toString())},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.OTHERDATA_UPDATE,this,this.updateFirstShow),o.GSM.ins.off(c.ActivityGetRankGS2C.KEY,this,this.requestRankBackHandler),n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.off(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/consume_rank/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),this._rankPanel&&(this._rankPanel.destroy(),this._rankPanel=null),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&Laya.timer.frameOnce(2,this,this.refresh)},t.prototype.cooldownHandler=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-r.ServerTime.serverTime;86400<e?(this.time_txt.changeText(l.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.time_txt.changeText(l.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.time_txt.changeText("00:00:00")}},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_rank.scrollBar.elasticDistance=100,this.list_rank.itemRender=u.ConsumeRankItem2,this.list_rank.renderHandler=new Laya.Handler(this,this.listRankRenderHandler),this.rank1.list_item.renderHandler=new Laya.Handler(this,this.onRank1ListRenderHandler),this.rank1.list_item.mouseHandler=new Laya.Handler(this,this.onRank1ListMouseHandler),this.btn_to_rank.on(Laya.Event.CLICK,this,this.showRankListPanel)},t.prototype.onRank1ListRenderHandler=function(t,e){p.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onRank1ListMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.rank1.list_item.array[e];d.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.listRankRenderHandler=function(t,e){t.setData(this.list_rank.array[e],this._currTitle)},t.prototype.showRankListPanel=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=h.GameConfig.activityJson[t.cfgId];this._rankPanel||(this._rankPanel=new f.ActivityRankView),this._rankPanel.setData(this._rankDataList,e.trigger,this._currTitle,this._rankVoArr),this._rankPanel.isPopup||this._rankPanel.popup()}},t.prototype.updateUnchanged=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e,i=h.GameConfig.activityJson[t.cfgId];for(var n in this.title_img.skin="dynamic/activity/consume_rank/"+i.bg_img+".png",this.desc_txt.changeText(i.desc),this._rankVoArr=[],h.GameConfig.activityRankJson)(e=h.GameConfig.activityRankJson[n]).activityId==t.cfgId&&(this._currTitle=e.title,this._rankVoArr.push(e));this._rankVoArr.sort(function(t,e){return t.rank[0]-e.rank[0]}),this.initNumOne(this._rankVoArr[0]),this.list_rank.array=this._rankVoArr.slice(1),this.lab_value_lab.changeText(m.TextConst.get(264,this._currTitle));var s,o=t.children[0];o&&(s=h.GameConfig.subActivityJson[o.cfgId])&&(this.btn_goto.label=s.desc,this.btn_goto.on(Laya.Event.CLICK,this,this.gotoHandler,[s]))}},t.prototype.gotoHandler=function(t){t.moduleID&&0<t.moduleID.length&&g.MainButtonStruct.Ins.OpenModule(t.moduleID[0][1],t.moduleID[1][1])},t.prototype.initNumOne=function(t){this.rank1.lab_title.changeText(m.TextConst.get(29,this._currTitle)),this.rank1.lab_desc.changeText(m.TextConst.get(30,this._currTitle+t.limit)),this.rank1.list_item.array=t.bonus},t.prototype.requestRankHandler=function(){o.GSM.ins.on(c.ActivityGetRankGS2C.KEY,this,this.requestRankBackHandler);var t=new c.ActivityGetRankC2GS;t.id=this._activityId,o.GSM.sendServer(t)},t.prototype.requestRankBackHandler=function(t){if(t.opresult&&t.id==this._activityId){o.GSM.ins.off(c.ActivityGetRankGS2C.KEY,this,this.requestRankBackHandler),this._rankDataList=t.rankArr;var e,i=this._rankDataList?this._rankDataList.length:0,n=0,s=0;for(this._currFirstUsername=null;n<i;)e=this._rankDataList[n],0==n&&(this.rank1.lab_player_name.changeText(m.TextConst.get(217)),this.rank1.img_head.skin="res/custom/heads/xiaofeipaihang_touxiang.png",e&&e.username&&(this._currFirstUsername=e.username,this._svrid=e.svrid,this.rank1.lab_player_name.changeText(y.GameMain.getDisSvrId(e.username)+e.nickname),this.updateFirstShow())),e.username==a.RoleCenter.instans.vo.username&&(s=n+1),n++;this.lab_my_rank.changeText(0<s?m.TextConst.get(58,s):m.TextConst.get(223))}},t.prototype.updateFirstShow=function(){if(this._currFirstUsername){var t=a.RoleCenter.instans.getOtherData(this._currFirstUsername);if(t){n.E.ins.off(s.EventName.OTHERDATA_UPDATE,this,this.updateFirstShow);var e=t.openhero[t.showHeroIdx];e&&(this.rank1.img_head.skin="res/custom/heads/y_"+e.jobid+"_"+e.sex+".png")}else n.E.ins.on(s.EventName.OTHERDATA_UPDATE,this,this.updateFirstShow),v.GNet.getOtherData([this._currFirstUsername],!0,this._svrid)}},t}(ui.activity.pages.ConsumeRankUI);e.ConsumeRankPage=_}),define("src/g/activity/view/item/KFTurntableItem",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../manager/RoleCenter","../../../net/messages/enumStatus","../../../net/messages/activity/ActivityGet","../../../../config/GameConfig","src/init/TextConst","src/g/Effects/UIEffectsFactory","../../../../manager/AM","../../../../manager/GameSocketManager"],function(t,e,i,n,l,h,s,c,u,p,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.getHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t.htxt_count.style.color="#e3cca9",t.htxt_count.style.font="SimHei",t.htxt_count.style.fontSize=18,t.htxt_count.style.align="center",t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.getHandler=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex];if(e&&e.status==h.enumStatus.kelingqu){if(!l.RoleCenter.instans.bagRoomEnough())return void o.AM.showBagNotEnough();var i=new s.ActivityGetC2GS;i.id=this._activityId,i.activity2CfgId=e.cfgId,a.GSM.sendServer(i)}}},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e,this._activityId=t,this._childIndex=e;var i=l.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=c.GameConfig.subActivityJson[n.cfgId],o=!1;this.btn_get.disabled=!0,this.icon_state.visible=!1,n.status==h.enumStatus.kelingqu?(this.btn_get.disabled=!1,o=this.btn_get.visible=!0):n.status==h.enumStatus.yilingqu&&(this.icon_state.visible=!0,this.btn_get.visible=!1);var a=Math.min(n.count,s.value2),r=n.count<s.value2?"#f41d2d":"#e3cca9";this.htxt_count.innerHTML=u.TextConst.get(958,r,a,s.value2),o?(this.ani||(this.ani=p.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_get.getChildIndex(this.ani)&&p.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_get),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_get.getChildIndex(this.ani)&&this.btn_get.removeChild(this.ani)),this.list_item.array=s.bonus}}},t}(ui.activity.item.KFTurntableItemUI);e.KFTurntableItem=r}),define("src/g/activity/view/alerts/KFTurntableAlert",["require","exports","../../../../manager/StateManger"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.txt_txt.style.color="#c0b4a3",this.txt_txt.style.fontFamily="SimHei",this.txt_txt.style.fontSize=24,this.txt_txt.style.valign="middle",this.txt_txt.style.align="center",this.btn_close.on(Laya.Event.CLICK,this,this.onCloseHandler),this.btn_cancel.on(Laya.Event.CLICK,this,this.onCancelHandler),this.btn_ok.on(Laya.Event.CLICK,this,this.onEnterHandler),this.check_no_alert.on(Laya.Event.CLICK,this,this.onCheckSelectHandler)},e.prototype.showAlert=function(t,e,i){void 0===i&&(i=!0),this._okHandler=e,this.check_select.visible=i,this.txt_txt.innerHTML=t,this.popup()},e.prototype.onCheckSelectHandler=function(){this.check_select.visible=!this.check_select.visible},e.prototype.onEnterHandler=function(){this._okHandler&&this._okHandler.run(),i.StateManger.showKFTurntableBuyAlert=!this.check_select.visible,this.onCloseHandler()},e.prototype.onCancelHandler=function(){i.StateManger.showKFTurntableBuyAlert=!this.check_select.visible,this.onCloseHandler()},e.prototype.onCloseHandler=function(){this.close()},e}(ui.alert.AlertViewDlgUI);e.KFTurntableAlert=n}),define("src/g/activity/view/pages/KFTurntablePage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../net/messages/activity/ActivityGet","../../../../manager/RoleCenter","src/g/activity/view/item/KFTurntableItem","src/g/account/ctrl/GetRewwardCtrl","src/init/TextConst","src/g/activity/view/alerts/KFTurntableAlert","../../../../config/GameConfig","../../../../manager/StateManger","src/init/Switches","../../../net/messages/enumStatus","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../utils/ItemUtils","../../../../meta/QualiyVo","src/init/GameMain","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","../../../../manager/GameSocketManager"],function(t,e,i,n,s,o,r,a,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var w=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.allRecordStr="",t.myRecordStr="",t._currRecordIndex=0,t._lastIndex=0,t._currChildIndex=0,t._runnum=0,t._des=new laya.html.dom.HTMLDivElement,t._des.width=t.con_log.width=t.con_panel.width,t._des.style.font="SimHei",t._des.style.color="#e3cca9",t._des.style.fontSize=20,t._des.style.leading=8,t.con_log.addChild(t._des),t.con_panel.vScrollBar.elasticDistance=100,t.tab_record.selectHandler=new Laya.Handler(t,t.onSwitchRecord),t.btn_run.on(Laya.Event.CLICK,t,t.onTurnClickHandler),t.check_mutl_10.on(Laya.Event.CLICK,t,t.onCheckSelect10Handler),t.check_mutl_5.on(Laya.Event.CLICK,t,t.onCheckSelect5Handler),t.img_arrow.rotation=0,t.on(Laya.Event.CLICK,t,t.doStopAniHandler),t.btn_return.on(Laya.Event.CLICK,t,t.toTurntable),t.btn_getReward.on(Laya.Event.CLICK,t,t.toGetReward),t.list_main.itemRender=a.KFTurntableItem,t.list_main.scrollBar.elasticDistance=100,t.list_main.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,this,this.onUpdateLogHandler),b.GSM.ins.on(o.ActivityGetCenterWheelGS2C.KEY,this,this.onActivityGetHandler),n.E.ins.on(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.toTurntable(),this.updateTurntableReward(),this.initLogInfo(),this.refresh(),this.cooldownHandler(),e.addChild(this)},t.prototype.onTimeSpanHandler=function(t){var e=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&(this.refresh(),this.updateTurntableReward())},t.prototype.refresh=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)if(t.allAreaData)this.playRollNum(t.allAreaData.allCount);else{var e=new o.getActivityAllDataC2GS;e.id=this._activityId,b.GSM.sendServer(e)}this.list_main.refresh(),this.updateProgress()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.off(s.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,this,this.onUpdateLogHandler),b.GSM.ins.off(o.ActivityGetCenterWheelGS2C.KEY,this,this.onActivityGetHandler),n.E.ins.off(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/kf_turntable/"),Laya.timer.clear(this,this.cooldownHandler),Laya.timer.clear(this,this.updateTurntableReward),this.stop()},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.onListRenderHandler=function(t,e){t.setData(this._activityId,this.list_main.array[e])},t.prototype.toTurntable=function(){this.box_turntable.visible=!0,this.box_list.visible=!1,this.box_progress.visible=!0,this.btn_return.visible=!1,this.img_bg.skin="res/activity/kf_turntable/xingyunduobao_beijing.jpg"},t.prototype.toGetReward=function(){this.box_turntable.visible=!1,this.box_list.visible=!0,this.box_progress.visible=!1,this.btn_return.visible=!0,this.img_bg.skin="res/activity/kf_turntable/xingyunduobao_beijing2.jpg"},t.prototype.doStopAniHandler=function(){if(this._running&&this._lastGetMsg){var t=Number(this._lastGetMsg.index);if(Laya.Tween.clearAll(this.img_arrow),this._running=!1,-1<t){this.img_arrow.rotation=36*t;var e=new o.GetCenterWheelRewardInfoC2GS;e.id=this._activityId,b.GSM.sendServer(e),l.GetRewwardCtrl.inventoryAddGS2C(this._lastGetMsg.inv,null,null,h.TextConst.get(956)),this.refresh()}}},t.prototype.onCheckSelect10Handler=function(){this.check_select_10.visible=!this.check_select_10.visible,this.check_select_10.visible&&(this.check_select_5.visible=!1)},t.prototype.onCheckSelect5Handler=function(){this.check_select_5.visible=!this.check_select_5.visible,this.check_select_5.visible&&(this.check_select_10.visible=!1)},t.prototype.getTurnNum=function(){return this.check_select_5.visible?5:this.check_select_10.visible?10:1},t.prototype.onSwitchRecord=function(t){this._currRecordIndex=t,this._des.innerHTML=0==this._currRecordIndex?this.allRecordStr:this.myRecordStr,this.con_log.height=this._des.contextHeight+20,this.con_panel.vScrollBar.value=this.con_panel.vScrollBar.max},t.prototype.onTurnClickHandler=function(){if(!this._running){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._currChildIndex];if(e){var i=u.GameConfig.subActivityJson[e.cfgId];if(i){var n=this.getTurnNum(),s=Number(i.cost[0][1]);s*=n,p.StateManger.showKFTurntableBuyAlert?(this._buyAlert||(this._buyAlert=new c.KFTurntableAlert),this._buyAlert.showAlert(h.TextConst.get(273,s,n),Laya.Handler.create(this,this.onBuyOneHandler,[e.cfgId,s,n]))):this.onBuyOneHandler(e.cfgId,s,n)}}}}},t.prototype.onBuyOneHandler=function(t,e,i){if(void 0===i&&(i=1),r.RoleCenter.instans.vo.GOLD<e)d.Switches.ins.event(155);else{var n=new o.ActivityGetCenterWheelC2GS;n.id=this._activityId,n.activity2CfgId=t,n.time=i,b.GSM.sendServer(n)}},t.prototype.onActivityGetHandler=function(t){this._activityId==t.id&&this.play(t)},t.prototype.play=function(e){var i=this;this._lastGetMsg=e;var t=Number(e.index);if(-1<t){this._running=!0;var n=3600+36*(this._lastIndex=t)+15*Math.random();this.img_arrow.rotation%=360,Laya.Tween.to(this.img_arrow,{rotation:n},7e3,Laya.Ease.circInOut,Laya.Handler.create(this,function(){if(i.displayedInStage){var t=new o.GetCenterWheelRewardInfoC2GS;t.id=i._activityId,b.GSM.sendServer(t),l.GetRewwardCtrl.inventoryAddGS2C(e.inv,null,null,h.TextConst.get(956))}i._running=!1}))}},t.prototype.stop=function(){Laya.Tween.clearAll(this.img_arrow),this.img_arrow.rotation=36*this._lastIndex,this._running=!1},t.prototype.updateUnchanged=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t&&(this._childIndexArr=[],u.GameConfig.activityJson[t.cfgId]))for(var e,i,n=t.children.length,s=0;s<n;)e=t.children[s],(i=u.GameConfig.subActivityJson[e.cfgId])&&100<i.childId&&this._childIndexArr.push(s),s++;this.list_main.array=this._childIndexArr},t.prototype.updateProgress=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t&&u.GameConfig.activityJson[t.cfgId]){for(var e,i,n=t.children.length,s=0,o=999999,a=0;s<n;)e=t.children[s],(i=u.GameConfig.subActivityJson[e.cfgId])&&100<i.childId&&e.status!=g.enumStatus.yilingqu&&i.value2<o&&(o=i.value2,a=e.count/o),s++;a=Math.min(1,a),this.img_progress.scaleX=a,this.sp_effect.visible=1==a}},t.prototype.updateTurntableReward=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=u.GameConfig.activityJson[t.cfgId];if(e)for(var i,n,s=t.children.length,o=0;o<s;)i=t.children[o],(n=u.GameConfig.subActivityJson[i.cfgId])&&1==n.childId&&(this.fillTurntableReward(n.bonus),this._currChildIndex=o),o++}},t.prototype.fillTurntableReward=function(t){for(var e,i,n,s=t.length,o=0;o<10;)(e=this["item"+o]).offAll(),o<s?(e.visible=!0,i=t[o][0],n=Number(t[o][1]),"GOLD100"==i?(v.ItemCellUtils.fillCellForItemNameView(e,"GOLD",1),e.item_name.changeText(h.TextConst.get(32,n))):"GOLD10000"==i?(v.ItemCellUtils.fillCellForItemNameView(e,"GOLD",1),e.item_name.changeText(h.TextConst.get(32,Math.floor(n/100)))):(v.ItemCellUtils.fillCellForItemNameView(e,i,n),e.on(Laya.Event.CLICK,this,function(t,e){f.ItemTips.ins.showTip(t,e)},[i,n]))):e.visible=!1,o++},t.prototype.initLogInfo=function(){var t=new o.GetCenterWheelRewardInfoC2GS;t.id=this._activityId,b.GSM.sendServer(t)},t.prototype.onUpdateLogHandler=function(t){t.id==this._activityId&&this.appendLog(t)},t.prototype.appendLog=function(t){0==t.type&&(this._des.innerHTML="",this.allRecordStr="",this.myRecordStr="");for(var e=t.infoArr,i=e?e.length:0,n=i-1;0<=n;)this.appendAllLog(e[n-3],e[n-2],e[n-1],Number(e[n])),n-=4;for(n=(i=(e=t.personInfoArr)?e.length:0)-1;0<=n;)this.appendMyLog(e[n-3],e[n-2],e[n-1],Number(e[n])),n-=4},t.prototype.appendMyLog=function(t,e,i,n){var s=h.TextConst.get(226),o="#b8b8b8",a=y.ItemUtils.getItemOrEq(i);a&&(s=a.name,o=m.QualityStruct.Ins.getQColorById(a.quality));var r=h.TextConst.get(274,o,s,n)+"<br>";this.myRecordStr+=r,1==this._currRecordIndex&&(this._des.appendHTML(r),this.con_log.height=this._des.contextHeight+20,this.con_panel.vScrollBar.value=this.con_panel.vScrollBar.max)},t.prototype.appendAllLog=function(t,e,i,n){var s=h.TextConst.get(226),o="#b8b8b8",a=y.ItemUtils.getItemOrEq(i);a&&(s=a.name,o=m.QualityStruct.Ins.getQColorById(a.quality));var r=h.TextConst.get(275,_.GameMain.getDisSvrId("S_"+t)+e,o,s,n)+"<br>";this.allRecordStr+=r,0==this._currRecordIndex&&(this._des.appendHTML(r),this.con_log.height=this._des.contextHeight+20,this.con_panel.vScrollBar.value=this.con_panel.vScrollBar.max)},t.prototype.cooldownHandler=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-C.ServerTime.serverTime;86400<e?(this.time_txt.changeText(I.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.time_txt.changeText(I.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.time_txt.changeText("00:00:00")}},t.prototype.resetRollNum=function(){for(var t=0;t<6;)this["roll_num_"+t].reset(),t++},t.prototype.setRollNum=function(t){this.roll_num_0.setIndex(Math.floor(t/1e5)),this.roll_num_1.setIndex(Math.floor(t/1e4)%10),this.roll_num_2.setIndex(Math.floor(t/1e3)%10),this.roll_num_3.setIndex(Math.floor(t/100)%10),this.roll_num_4.setIndex(Math.floor(t/10)%10),this.roll_num_5.setIndex(t%10)},t.prototype.playRollNum=function(t){this.stopRollNum(),this.roll_num_0.on("roll_complete",this,this.onRollCompleteHandler),this.roll_num_1.on("roll_complete",this,this.onRollCompleteHandler),this.roll_num_2.on("roll_complete",this,this.onRollCompleteHandler),this.roll_num_3.on("roll_complete",this,this.onRollCompleteHandler),this.roll_num_4.on("roll_complete",this,this.onRollCompleteHandler),this.roll_num_5.on("roll_complete",this,this.onRollCompleteHandler),this._runnum=6,this.roll_num_0.play(Math.floor(t/1e5)),this.roll_num_1.play(Math.floor(t/1e4)%10),this.roll_num_2.play(Math.floor(t/1e3)%10),this.roll_num_3.play(Math.floor(t/100)%10),this.roll_num_4.play(Math.floor(t/10)%10),this.roll_num_5.play(t%10)},t.prototype.onRollCompleteHandler=function(){if(this._runnum--,0==this._runnum)for(var t=0;t<6;)this["roll_num_"+t].off("roll_complete",this,this.onRollCompleteHandler),t++},t.prototype.stopRollNum=function(){if(0<this._runnum){for(var t=0;t<6;)this["roll_num_"+t].stop(),this["roll_num_"+t].off("roll_complete",this,this.onRollCompleteHandler),t++;this._runnum=0}},t}(ui.activity.pages.KFTurntableUI);e.KFTurntablePage=w}),define("src/g/activity/view/item/AccumulativeRecharge3DayItem",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../manager/RoleCenter","../../../net/messages/enumStatus","../../../../manager/AM","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../config/GameConfig","src/init/TextConst","src/g/Effects/UIEffectsFactory"],function(t,e,i,n,h,c,s,o,a,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.getHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t.htxt_progress.style.color="#e3cca9",t.htxt_progress.style.font="SimHei",t.htxt_progress.style.fontSize=18,t.htxt_title.style.color="#e3cca9",t.htxt_title.style.font="SimHei",t.htxt_title.style.fontSize=18,t.box_star.itemRender=ui.activity.item.StarItemUI,t.box_star.renderHandler=new Laya.Handler(t,t.onStarListRender),t}return __extends(t,e),t.prototype.onStarListRender=function(t,e){1==this.box_star.array[e]?t.img_star.skin="res/custom/juese_jingmai_xing.png":t.img_star.skin="res/custom/juese_jingmai_kongxing.png"},t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItem0View(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.getHandler=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex];if(e&&e.status==c.enumStatus.kelingqu){if(!h.RoleCenter.instans.bagRoomEnough())return void s.AM.showBagNotEnough();var i=new o.ActivityGetC2GS;i.id=this._activityId,i.activity2CfgId=e.cfgId,a.GSM.sendServer(i)}}},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e;var i=h.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=u.GameConfig.subActivityJson[n.cfgId];this.htxt_title.innerHTML=p.TextConst.get(955,s.value);var o=this.icon_state.visible=!1;n.status==c.enumStatus.kelingqu?(this.btn_get.label=p.TextConst.get(216),o=this.btn_get.visible=!0):n.status==c.enumStatus.yilingqu&&(this.btn_get.visible=!1,this.icon_state.visible=!0);var a=Math.min(n.count,s.value2);if(this.htxt_progress.innerHTML=p.TextConst.get(954,a+"/"+s.value2),this.htxt_progress.visible=n.status==c.enumStatus.weiwancheng,this.box_star.visible=n.status==c.enumStatus.weiwancheng,this.box_star.visible){for(var r=[],l=0;l<s.value2;)r[l]=l<a?1:0,l++;this.box_star.array=r}o?(this.ani||(this.ani=d.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_get.getChildIndex(this.ani)&&d.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_get),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_get.getChildIndex(this.ani)&&this.btn_get.removeChild(this.ani)),this.list_item.array=s.bonus}}},t}(ui.activity.item.Accumulative_recharge_3_day_itemUI);e.AccumulativeRecharge3DayItem=r}),define("src/g/activity/view/pages/AccumulativeRecharge3DayPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","src/g/activity/view/item/AccumulativeRecharge3DayItem","../../../../utils/ItemUtils","../../../net/messages/enumStatus","src/g/activity/view/ActivityBoxGetDlg","src/init/Switches","src/init/TextConst"],function(t,e,i,n,s,l,p,h,c,o,d,g,a,r,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t._maxTarget=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.refresh(),this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),e.addChild(this),Laya.timer.once(1e3*c.DateUtil.getZeroTime()+1e3,this,this.updateTodayChild)},t.prototype.onTimeSpanHandler=function(t){var e=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.refresh=function(){this.updateTodayChild(),this.update3DayChild()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.off(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/accumulative_recharge_3_day/"),Laya.timer.clear(this,this.cooldownHandler),Laya.timer.clear(this,this.updateTodayChild)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_main.itemRender=o.AccumulativeRecharge3DayItem,this.list_main.renderHandler=new Laya.Handler(this,this.listMainRenderHandler),this.btn_go.on(Laya.Event.CLICK,this,this.toRecharge)},t.prototype.listMainRenderHandler=function(t,e){t.setData(this._activityId,this.list_main.array[e])},t.prototype.toRecharge=function(){r.Switches.ins.event(109)},t.prototype.updateUnchanged=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=p.GameConfig.activityJson[t.cfgId];this.img_title.skin="dynamic/activity/accumulative_recharge_3_day/"+e.bg_img+".jpg";for(var i=t.children.length,n=0,s=0;n<i;){var o=p.GameConfig.subActivityJson[t.children[n].cfgId];o&&o.value2>s&&(s=o.value2),n++}this._maxTarget=s}else console.log("没有找到数据，类型：accumulative_recharge_3_day")},t.prototype.updateTodayChild=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=c.DateUtil.getDayFromStartTime(t.startTime,h.ServerTime.ACTIVITY_TIME_OFFSET);this.lab_day.changeText(u.TextConst.get(59,e));for(var i,n=t.children.length,s=0,o=0,a=0;s<n;){if(i=t.children[s]){var r=p.GameConfig.subActivityJson[i.cfgId];r&&r.value==e&&(this.lab_count.changeText(Math.min(this._maxTarget,i.count).toString()),this.todayRenderHandler(i,o++),i.status!=g.enumStatus.weiwancheng&&a++)}s++}this.img_progress.scaleX=2<a?1:1<a?.5:0}},t.prototype.todayRenderHandler=function(t,e){var i=p.GameConfig.subActivityJson[t.cfgId];if(i){this["lab_title"+e].changeText(i.title);for(var n,s,o,a,r,l=2*e,h=i.bonus.length,c=0;c<2;){var u=l+c;n=this["img_icon"+u],s=this["effect"+u],o=this["img_complt"+u],n.offAll(),s.visible=t.status==g.enumStatus.kelingqu,o.visible=t.status==g.enumStatus.yilingqu,c<h?(n.visible=!0,a=i.bonus[c][0],(r=d.ItemUtils.getItemOrEq(a))&&(n.skin=d.ItemUtils.getIconByIconId(r.icon)),n.on(Laya.Event.CLICK,this,this.onClickBoxHandler,[t])):n.visible=!1,c++}}},t.prototype.onClickBoxHandler=function(t){this._boxRewardDlg||(this._boxRewardDlg=new a.ActivityBoxGetDlg),this._boxRewardDlg.showBox(t,this._activityId)},t.prototype.update3DayChild=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){this._childIndexArr=[];for(var e,i=t.children.length,n=0;n<i;){if(e=t.children[n])100<p.GameConfig.subActivityJson[e.cfgId].value&&this._childIndexArr.push(n);n++}this.list_main.array=this._childIndexArr}},t.prototype.cooldownHandler=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-h.ServerTime.serverTime;86400<e?(this.lab_time.changeText(c.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(c.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t}(ui.activity.pages.Accumulative_Recharge_3_DayUI);e.AccumulativeRecharge3DayPage=v}),define("src/g/activity/view/alerts/SlotMachinesTurntableAlert",["require","exports","../../../../manager/StateManger"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.txt_txt.style.color="#c0b4a3",this.txt_txt.style.fontFamily="SimHei",this.txt_txt.style.fontSize=24,this.txt_txt.style.valign="middle",this.txt_txt.style.align="center",this.btn_close.on(Laya.Event.CLICK,this,this.onCloseHandler),this.btn_cancel.on(Laya.Event.CLICK,this,this.onCancelHandler),this.btn_ok.on(Laya.Event.CLICK,this,this.onEnterHandler),this.check_no_alert.on(Laya.Event.CLICK,this,this.onCheckSelectHandler)},e.prototype.showAlert=function(t,e,i){void 0===i&&(i=!0),this._okHandler=e,this.check_select.visible=i,this.txt_txt.innerHTML=t,this.popup()},e.prototype.onCheckSelectHandler=function(){this.check_select.visible=!this.check_select.visible},e.prototype.onEnterHandler=function(){this._okHandler&&this._okHandler.run(),i.StateManger.showSlotMachinesTurntableBuyAlert=!this.check_select.visible,this.onCloseHandler()},e.prototype.onCancelHandler=function(){i.StateManger.showSlotMachinesTurntableBuyAlert=!this.check_select.visible,this.onCloseHandler()},e.prototype.onCloseHandler=function(){this.close()},e}(ui.alert.AlertViewDlgUI);e.SlotMachinesTurntableAlert=n}),define("src/g/activity/view/item/SlotMachinesTurntableListItem",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../manager/RoleCenter","../../../net/messages/enumStatus","../../../../manager/AM","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../config/GameConfig","src/g/Effects/UIEffectsFactory","src/init/TextConst"],function(t,e,i,n,l,h,s,o,a,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.getHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t.htxt_count.style.color="#e3cca9",t.htxt_count.style.font="SimHei",t.htxt_count.style.fontSize=18,t.htxt_count.style.align="center",t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.getHandler=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex];if(e&&e.status==h.enumStatus.kelingqu){if(!l.RoleCenter.instans.bagRoomEnough())return void s.AM.showBagNotEnough();var i=new o.ActivityGetC2GS;i.id=this._activityId,i.activity2CfgId=e.cfgId,a.GSM.sendServer(i)}}},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e,this._activityId=t,this._childIndex=e;var i=l.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=c.GameConfig.subActivityJson[n.cfgId],o=!1;this.btn_get.disabled=!0,this.icon_state.visible=!1,n.status==h.enumStatus.kelingqu?(this.btn_get.disabled=!1,o=this.btn_get.visible=!0):n.status==h.enumStatus.yilingqu&&(this.icon_state.visible=!0,this.btn_get.visible=!1);var a=Math.min(n.count,s.value),r=n.count<s.value?"#f41d2d":"#e3cca9";this.htxt_count.innerHTML=p.TextConst.get(958,r,a,s.value),o?(this.ani||(this.ani=u.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_get.getChildIndex(this.ani)&&u.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_get),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_get.getChildIndex(this.ani)&&this.btn_get.removeChild(this.ani)),this.list_item.array=s.bonus}}},t}(ui.activity.item.Slot_Machines_Turntable_itemUI);e.SlotMachinesTurntableListItem=r}),define("src/g/activity/view/pages/SlotMachinesTurntablePage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/GameSocketManager","../../../../manager/RoleCenter","../../../../config/GameConfig","src/init/Switches","../../../../utils/system/ServerTime","src/init/TextConst","src/g/bag/tips/view/ItemTips","../../../../utils/ItemUtils","../../../../meta/QualiyVo","../../../../utils/system/DateUitl","../../../../manager/StateManger","src/g/activity/view/alerts/SlotMachinesTurntableAlert","../../../net/messages/activity/ActivityTrigger","src/g/account/ctrl/GetRewwardCtrl","src/g/activity/view/item/SlotMachinesTurntableListItem","../../../net/messages/enumStatus","../../../../utils/system/FloatEffect"],function(t,e,i,n,s,o,r,l,a,h,c,u,p,d,g,v,f,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var b=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.showCostType=1,t._lastIndex=0,t._rotate=0,t.costItemId=0,t.costGold=0,t._des=new laya.html.dom.HTMLDivElement,t._des.width=t.con_log.width=t.con_panel.width,t._des.style.font="SimHei",t._des.style.color="#e3cca9",t._des.style.fontSize=20,t._des.style.leading=8,t.con_log.addChild(t._des),t.con_panel.vScrollBar.elasticDistance=100,t.htxt_count1.style.font="SimHei",t.htxt_count1.style.color="#cc9933",t.htxt_count1.style.align="center",t.htxt_count1.style.fontSize=18,t.htxt_count10.style.font="SimHei",t.htxt_count10.style.color="#cc9933",t.htxt_count10.style.align="center",t.htxt_count10.style.fontSize=18,t.htxt_count50.style.font="SimHei",t.htxt_count50.style.color="#cc9933",t.htxt_count50.style.align="center",t.htxt_count50.style.fontSize=18,t.btn_turn_1.on(Laya.Event.CLICK,t,t.onTurnClickHandler,[1]),t.btn_turn_10.on(Laya.Event.CLICK,t,t.onTurnClickHandler,[10]),t.btn_turn_50.on(Laya.Event.CLICK,t,t.onTurnClickHandler,[50]),t.btn_return.on(Laya.Event.CLICK,t,t.toTurntable),t.btn_getReward.on(Laya.Event.CLICK,t,t.toGetReward),t.list_main.itemRender=_.SlotMachinesTurntableListItem,t.list_main.scrollBar.elasticDistance=100,t.list_main.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,this,this.onUpdateLogHandler),o.GSM.ins.on(y.ActivityTriggerCircleWheelGS2C.KEY,this,this.onActivityGetHandler),n.E.ins.on(s.EventName.CHANGEITEM_COUNT,this,this.onBagItemChanged),n.E.ins.on(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.toTurntable(),this.updateItemCount(),this.initLogInfo(),this.refresh(),this.cooldownHandler(),this.x=(e.width-this.width)/2,e.addChild(this)},t.prototype.onTimeSpanHandler=function(t){var e=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.refresh=function(){this.list_main.refresh(),this.updateProgress()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.off(s.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,this,this.onUpdateLogHandler),o.GSM.ins.off(y.ActivityTriggerCircleWheelGS2C.KEY,this,this.onActivityGetHandler),n.E.ins.off(s.EventName.CHANGEITEM_COUNT,this,this.onBagItemChanged),n.E.ins.off(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/slot_machines_turntable/"),Laya.timer.clear(this,this.cooldownHandler),this.stop()},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.onBagItemChanged=function(t){1==this.showCostType&&0<this.costItemId&&t==this.costItemId&&this.updateItemCount()},t.prototype.updateItemCount=function(){var t=1;if(1==this.showCostType&&0<this.costItemId){var e=r.RoleCenter.instans.vo.bagdata.getItemCount(this.costItemId),i=e<t?"#f41d2d":"#cc9933";this.htxt_count1.innerHTML="<font color='"+i+"'>"+e+"</font>/"+t,i=e<10*t?"#f41d2d":"#cc9933",this.htxt_count10.innerHTML="<font color='"+i+"'>"+e+"</font>/"+10*t,i=e<50*t?"#f41d2d":"#cc9933",this.htxt_count50.innerHTML="<font color='"+i+"'>"+e+"</font>/"+50*t}else t=this.costGold,this.htxt_count1.innerHTML=""+t,this.htxt_count10.innerHTML=""+10*t,this.htxt_count50.innerHTML=""+50*t},t.prototype.updateProgress=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t&&(this.lab_turn_count.changeText(t.allData.allCount.toString()),l.GameConfig.activityJson[t.cfgId])){for(var e,i,n=t.children.length,s=0,o=999999,a=0;s<n;)e=t.children[s],(i=l.GameConfig.subActivityJson[e.cfgId])&&1<i.childId&&e.status!=C.enumStatus.yilingqu&&i.value<o&&(o=i.value,a=e.count/o),s++;a=Math.min(1,a),this.img_progress.scaleX=a,this.sp_effect.visible=1==a}},t.prototype.onListRenderHandler=function(t,e){t.setData(this._activityId,this.list_main.array[e])},t.prototype.toTurntable=function(){this.box_turntable.visible=!0,this.box_list.visible=!1,this.box_progress.visible=!0,this.btn_return.visible=!1;var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=l.GameConfig.activityJson[t.cfgId];e&&(this.img_title.skin="dynamic/activity/slot_machines_turntable/"+e.bg_img+".png")}},t.prototype.toGetReward=function(){this.box_turntable.visible=!1,this.box_list.visible=!0,this.box_progress.visible=!1,this.btn_return.visible=!0;var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)for(var e,i=t.children.length,n=0;n<i;){if(e=t.children[n]){var s=l.GameConfig.subActivityJson[e.cfgId];if(s&&1==s.childId){this.img_title.skin="dynamic/activity/slot_machines_turntable/"+s.image+".png";break}}n++}},t.prototype.onTurnClickHandler=function(t){if(!this._running){var e=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=e.children[this._currChildIndex];if(i){var n=l.GameConfig.subActivityJson[i.cfgId];if(n){var s=Number(n.cost[0][1]),o=0<this.costItemId?r.RoleCenter.instans.vo.bagdata.getItemCount(this.costItemId):0;s*=t,0<o&&(o<t&&(t=o),s=0),0<s&&v.StateManger.showSlotMachinesTurntableBuyAlert?(this._buyAlert||(this._buyAlert=new f.SlotMachinesTurntableAlert),this._buyAlert.showAlert(c.TextConst.get(957,s,t),Laya.Handler.create(this,this.onBuyOneHandler,[i.cfgId,s,t]))):this.onBuyOneHandler(i.cfgId,s,t)}}}}},t.prototype.onBuyOneHandler=function(t,e,i){if(r.RoleCenter.instans.vo.GOLD<e)a.Switches.ins.event(155);else{var n=new y.ActivityTriggerCircleWheelC2GS;n.id=this._activityId,n.activity2CfgId=t,n.time=i,o.GSM.sendServer(n)}},t.prototype.onActivityGetHandler=function(t){this._activityId==t.id&&this.play(t)},Object.defineProperty(t.prototype,"rotate",{get:function(){return this._rotate},set:function(t){var e=(this._rotate=t)%360,i=Math.floor(e/23);this.img_select.visible=!0,this.img_select.x=this["item"+i].x,this.img_select.y=this["item"+i].y},enumerable:!0,configurable:!0}),t.prototype.play=function(t){var e=this,i=Number(t.index);if(-1<i){this._running=!0;var n=1800+23*(this._lastIndex=i);this.rotate%=360,Laya.Tween.to(this,{rotate:n},7e3,Laya.Ease.circInOut,Laya.Handler.create(this,function(){Laya.timer.once(500,e,e.showReward,[t]),e._running=!1}))}},t.prototype.showReward=function(t){this.displayedInStage&&(this.initLogInfo(),m.GetRewwardCtrl.inventoryAddGS2C(t.inv),I.FE.addInventoryToCFloats(t.inv))},t.prototype.stop=function(){Laya.Tween.clearAll(this),this.rotate=23*this._lastIndex,this._running=!1},t.prototype.updateUnchanged=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t&&(this._childIndexArr=[],l.GameConfig.activityJson[t.cfgId]))for(var e,i,n=t.children.length,s=0;s<n;)e=t.children[s],(i=l.GameConfig.subActivityJson[e.cfgId])&&1<i.childId&&this._childIndexArr.push(s),s++;this.list_main.array=this._childIndexArr,this.updateTurntableReward()},t.prototype.updateTurntableReward=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t&&l.GameConfig.activityJson[t.cfgId])for(var e,i,n=t.children.length,s=0;s<n;){if(e=t.children[s],(i=l.GameConfig.subActivityJson[e.cfgId])&&1==i.childId){if(this.costGold=Number(i.cost[0][1]),1<i.cost.length?this.costItemId=Number(i.cost[1][0]):this.costItemId=0,1==this.showCostType&&0<this.costItemId){var o=p.ItemUtils.getItemVoById(this.costItemId);o&&(this.img_icon1.skin=this.img_icon2.skin=this.img_icon3.skin=p.ItemUtils.getIconByIconId(o.icon))}else{var a=l.GameConfig.currencyJSON.GOLD;a&&(this.img_icon1.skin=this.img_icon2.skin=this.img_icon3.skin="res/iconsmall/"+a.id+".png")}this.fillTurntableReward(i.bonus),this._currChildIndex=s;break}s++}},t.prototype.fillTurntableReward=function(t){for(var e,i,n,s=t.length,o=0;o<16;){if((e=this["item"+o]).offAll(),o<s){e.visible=!0,i=t[o][0],n=Number(t[o][1]);var a=p.ItemUtils.getItemOrEq(i);a&&(e.img_icon.skin=p.ItemUtils.getIconByIconId(a.icon)),e.lab_count.changeText("X"+n),e.on(Laya.Event.CLICK,this,function(t,e){u.ItemTips.ins.showTip(t,e)},[i,n])}else e.visible=!1;o++}},t.prototype.initLogInfo=function(){var t=new y.GetCircleWheelRewardInfoC2GS;t.id=this._activityId,o.GSM.sendServer(t)},t.prototype.onUpdateLogHandler=function(t){t.id==this._activityId&&this.appendLog(t)},t.prototype.appendLog=function(t){0==t.type&&(this._des.innerHTML="");for(var e=t.infoArr,i=(e?e.length:0)-1;0<=i;)this.appendAllLog(e[i-2],e[i-1],Number(e[i])),i-=3},t.prototype.appendAllLog=function(t,e,i){var n=c.TextConst.get(226),s="#b8b8b8",o=p.ItemUtils.getItemOrEq(e);o&&(n=o.name,s=d.QualityStruct.Ins.getQColorById(o.quality));var a=c.TextConst.get(275,t,s,n,i)+"<br>";this._des.appendHTML(a),this.con_log.height=this._des.contextHeight+20,this.con_panel.vScrollBar.value=this.con_panel.vScrollBar.max},t.prototype.cooldownHandler=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-h.ServerTime.serverTime;86400<e?(this.lab_time.changeText(g.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(g.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t}(ui.activity.pages.Slot_Machines_TurntableUI);e.SlotMachinesTurntablePage=b}),define("src/g/activity/view/dlg/LotteryDrawRewardPreviewDlg",["require","exports","src/g/bag/tips/view/ItemTips","../../../../utils/ItemCellUtils","../../../../manager/RoleCenter"],function(t,e,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.list_item.renderHandler=new Laya.Handler(t,t.onListRender),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseListRender),t.bg.on(Laya.Event.CLICK,t,t.onEnterHandler),t}return __extends(t,e),t.prototype.onMouseListRender=function(t,e){t.type==Laya.Event.CLICK&&i.ItemTips.ins.showTip(this.list_item.array[e][0],Number(this.list_item.array[e][1]))},t.prototype.onListRender=function(t,e){n.ItemCellUtils.fillCellForItemNameView(t.item,this.list_item.array[e][0],Number(this.list_item.array[e][1])),t.img_got.visible=0<this.list_item.array[e][2]},t.prototype.showReward=function(t){var e=o.RoleCenter.instans.vo.getActivity1Data(t);if(e){for(var i=e.rewardPool.length,n=0,s=[];n<i;)s.push([e.rewardPool[n].id,e.rewardPool[n].num,e.rewardPool[n].index]),n++;this.list_item.array=s}this.isPopup||this.popup()},t.prototype.onEnterHandler=function(){this.close()},t}(ui.activity.dlg.LotteryDrawRewardPreviewDlgUI);e.LotteryDrawRewardPreviewDlg=s}),define("src/g/activity/view/dlg/LotteryDrawGetRewardDlg",["require","exports","src/g/bag/tips/view/ItemTips","../../../../utils/ItemCellUtils","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../manager/AM","../../../net/messages/activity/ActivityTrigger","../../../../manager/GameSocketManager","src/init/TextConst"],function(t,e,i,n,r,l,s,o,a,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t.list_reward.autoWidth=!0,t.list_reward.itemRender=ui.custom.ItemNameViewUI,t.list_reward.renderHandler=new Laya.Handler(t,t.onListRender),t.list_reward.clickHandler=new Laya.Handler(t,t.onMouseListRender),t.btn_enter.on(Laya.Event.CLICK,t,t.onEnterHandler),t.btn_open_all.on(Laya.Event.CLICK,t,t.onOpenAllHandler),t}return __extends(t,e),t.prototype.onMouseListRender=function(t){i.ItemTips.ins.showTip(this.list_reward.array[t][0],Number(this.list_reward.array[t][1]))},t.prototype.onListRender=function(t,e){n.ItemCellUtils.fillCellForItemNameView(t,this.list_reward.array[e][0],Number(this.list_reward.array[e][1]))},t.prototype.showReward=function(t,e,i){this._activityId=t,this.list_reward.array=e,this._openAllHandler=i,null==this._openAllHandler?(this.btn_open_all.visible=!1,this.lab_cost_lab.visible=this.lab_cost.visible=!1,this.btn_enter.x=200):(this.btn_open_all.visible=!0,this.lab_cost_lab.visible=this.lab_cost.visible=!0,this.btn_enter.x=98),this.lab_cost.changeText(this.getCost().toString()),this.isPopup||this.popup()},t.prototype.onEnterHandler=function(){var e=this;if(this.close(),this.hasNextRound())for(var t=this.list_reward.array.length,i=0;i<t;){if(this.hasHighLvItem(this.list_reward.array[i][0])){s.AM.show(h.TextConst.get(970),new Laya.Handler(this,function(){var t=new o.resetRewardPoolC2GS;t.id=e._activityId,a.GSM.sendServer(t)}));break}i++}},t.prototype.hasNextRound=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.allData.time+2;for(var i in l.GameConfig.lotteryDrawVoCfg)if(l.GameConfig.lotteryDrawVoCfg[i].type==e)return!0}return!1},t.prototype.hasHighLvItem=function(t){var e=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i,n=e.allData.time+1;for(var s in l.GameConfig.lotteryDrawVoCfg)if((i=l.GameConfig.lotteryDrawVoCfg[s]).type==n&&1==i.stage){for(var o=i.bonus.length,a=0;a<o;){if(i.bonus[a][0]==t)return!0;a++}break}}return!1},t.prototype.getCost=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){for(var e,i,n=t.children.length,s=0,o=0;s<n;){if(e=t.children[s]){var a=l.GameConfig.subActivityJson[e.cfgId];if(a&&1==a.childId){i=a;break}}s++}if(i)for(n=i.cost.length,s=t.allData.allCount;s<n;)o+=Number(a.cost[s][1]),s++}return o},t.prototype.onOpenAllHandler=function(){this.close(),this._openAllHandler&&this._openAllHandler.run()},t}(ui.activity.dlg.LotteryDrawGetRewardDlgUI);e.LotteryDrawGetRewardDlg=c}),define("src/g/activity/view/alerts/ActivityBuyAlert",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.txt_txt.style.color="#c0b4a3",this.txt_txt.style.fontFamily="SimHei",this.txt_txt.style.fontSize=24,this.txt_txt.style.valign="middle",this.txt_txt.style.align="center",this.btn_close.on(Laya.Event.CLICK,this,this.onCloseHandler),this.btn_cancel.on(Laya.Event.CLICK,this,this.onCancelHandler),this.btn_ok.on(Laya.Event.CLICK,this,this.onEnterHandler),this.check_no_alert.on(Laya.Event.CLICK,this,this.onCheckSelectHandler)},e.prototype.showAlert=function(t,e,i){void 0===i&&(i=!0),this._okHandler=e,this.check_select.visible=i,this.txt_txt.innerHTML=t,this.popup()},e.prototype.onCheckSelectHandler=function(){this.check_select.visible=!this.check_select.visible},e.prototype.onEnterHandler=function(){this._okHandler&&this._okHandler.run(),this.onCloseHandler()},e.prototype.onCancelHandler=function(){this.onCloseHandler()},e.prototype.onCloseHandler=function(){this.close()},e}(ui.alert.AlertViewDlgUI);e.ActivityBuyAlert=i}),define("src/g/activity/view/pages/LotteryDrawPage",["require","exports","../../../../core/E","../../../../enum/EventName","../../../../manager/GameSocketManager","src/g/clearRes/ClearResM","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","../../../../manager/RoleCenter","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../config/GameConfig","../../../net/messages/activity/ActivityTrigger","../../../../utils/system/FloatEffect","../../../net/messages/enumStatus","../../../../utils/MathUtils","src/g/activity/view/ActivityBoxGetDlg","../../../../manager/AM","src/g/activity/view/dlg/LotteryDrawRewardPreviewDlg","src/g/activity/view/dlg/LotteryDrawGetRewardDlg","src/init/Switches","../../../../manager/StateManger","src/g/activity/view/alerts/ActivityBuyAlert","src/init/TextConst"],function(t,e,i,n,c,s,o,a,u,r,l,p,d,h,g,v,f,y,m,_,C,I,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t._state=0,t._round=0,t._limitNumArr=[],t._groupCkMaxNum=5,t._maxRound=0,t._progressArr=[],t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):s.ClearResM.resetViewImg(this),c.GSM.ins.on(d.ActivityOpenRewardGS2C.KEY,this,this.updateLotteryDrawRewardPool),i.E.ins.on(n.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),i.E.ins.on(n.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.refresh(),this.cooldownHandler(),e.addChild(this)},t.prototype.onTimeSpanHandler=function(t){var e=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.refresh=function(){var t=this._state;this.updateState(),t==this._state&&this.onStateChanged()},t.prototype.hidePage=function(){c.GSM.ins.off(d.ActivityOpenRewardGS2C.KEY,this,this.updateLotteryDrawRewardPool),i.E.ins.off(n.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),i.E.ins.off(n.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),s.ClearResM.clearFolderByUrl("dynamic/activity/lottery_draw/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_item0.renderHandler=new Laya.Handler(this,this.onRenderHandler),this.list_item0.mouseHandler=new Laya.Handler(this,this.onlist0MouseHandler),this.list_item1.renderHandler=new Laya.Handler(this,this.onRenderHandler),this.list_item1.mouseHandler=new Laya.Handler(this,this.onlist1MouseHandler),this.list_item2.renderHandler=new Laya.Handler(this,this.onRenderHandler),this.list_item2.mouseHandler=new Laya.Handler(this,this.onlist2MouseHandler),this.htxt_select_count0.style.font="SimHei",this.htxt_select_count0.style.fontSize=18,this.htxt_select_count0.style.color="#dac494",this.htxt_select_count0.style.align="center",this.htxt_select_count1.style.font="SimHei",this.htxt_select_count1.style.fontSize=18,this.htxt_select_count1.style.color="#dac494",this.htxt_select_count1.style.align="center",this.htxt_select_count2.style.font="SimHei",this.htxt_select_count2.style.fontSize=18,this.htxt_select_count2.style.color="#dac494",this.htxt_select_count2.style.align="center",this.lab_box_count0.style.font="SimHei",this.lab_box_count0.style.fontSize=20,this.lab_box_count0.style.color="#e3cca9",this.lab_box_count1.style.font="SimHei",this.lab_box_count1.style.fontSize=20,this.lab_box_count1.style.color="#e3cca9",this.lab_box_count2.style.font="SimHei",this.lab_box_count2.style.fontSize=20,this.lab_box_count2.style.color="#e3cca9",this.lab_box_count3.style.font="SimHei",this.lab_box_count3.style.fontSize=20,this.lab_box_count3.style.color="#e3cca9",this.initCheckBoxs(),this.btn_enter.on(Laya.Event.CLICK,this,this.onEnterSelectHandler),this.lab_preview.on(Laya.Event.CLICK,this,this.onOpenPreview)},t.prototype.onOpenPreview=function(){this._preview||(this._preview=new m.LotteryDrawRewardPreviewDlg),this._preview.showReward(this._activityId)},t.prototype.onRenderHandler=function(t,e){r.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onlist0MouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item0.array[e];l.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.onlist1MouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item1.array[e];l.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.onlist2MouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item2.array[e];l.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.updateUnchanged=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=p.GameConfig.activityJson[t.cfgId];this.img_title.skin="dynamic/activity/lottery_draw/"+e.bg_img+".jpg"}else console.log("没有找到数据，类型：lottery_draw")},t.prototype.updateLotteryDrawRewardPool=function(t){if(this._activityId==t.id){this._getRewardDlg||(this._getRewardDlg=new _.LotteryDrawGetRewardDlg);for(var e,i=[],n=t.changeRewardPool.length,s=0;s<n;)e=t.changeRewardPool[s],i.push([e.id,e.num]),s++;var o=null;if(0<=t.rewardIndex){var a=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(a)for(n=a.rewardPool.length,s=0;s<n;){if(a.rewardPool[s].index<=0){o=new Laya.Handler(this,this.onOpenAllHandler);break}s++}}this._getRewardDlg.showReward(this._activityId,i,o)}},t.prototype.onOpenAllHandler=function(){var e=this;if(u.RoleCenter.instans.bagRoomEnough()){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){for(var i,n,s=t.children.length,o=0,a=0;o<s;){if(i=t.children[o]){var r=p.GameConfig.subActivityJson[i.cfgId];if(r&&1==r.childId){n=r,a=Number(r.cost[t.allData.allCount][1]);break}}o++}if(n)for(s=n.cost.length,o=t.allData.allCount;o<s;)a+=Number(r.cost[o][1]),o++;if(0<a){if(u.RoleCenter.instans.vo.GOLD<a)return void C.Switches.ins.event(155);if(I.StateManger.showLotteryDrawBuyAllAlert)this._buyAlert||(this._buyAlert=new b.ActivityBuyAlert),this._buyAlert.showAlert(w.TextConst.get(963,a),Laya.Handler.create(this,function(){I.StateManger.showLotteryDrawBuyAllAlert=!e._buyAlert.check_select.visible;var t=new d.ActivityOpenRewardC2GS;t.id=e._activityId,t.isAll=!0,c.GSM.sendServer(t)}));else{var l=new d.ActivityOpenRewardC2GS;l.id=this._activityId,l.isAll=!0,c.GSM.sendServer(l)}}}}else y.AM.showBagNotEnough()},Object.defineProperty(t.prototype,"showState",{set:function(t){this._state!=t&&(this._state=t,this.onStateChanged())},enumerable:!0,configurable:!0}),t.prototype.updateState=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);t&&t.rewardPool&&0<t.rewardPool.length?this.showState=2:this.showState=1},t.prototype.onStateChanged=function(){this.box_select_state.visible=1==this._state,this.box_lottery_state.visible=2==this._state,1==this._state?this.lab_desc2.changeText(w.TextConst.get(964)):2==this._state&&this.lab_desc2.changeText(w.TextConst.get(965)),this.updateStateShow()},t.prototype.updateStateShow=function(){1==this._state?this.updateSelectStateShow():2==this._state&&this.updateLotteryStateShow(),this.updateRoundNum()},t.prototype.updateSelectStateShow=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e,i=t.allData.time+1;this._round!=i&&(this._round=i,this.clearCheckGroupSelect());var n=0;for(var s in p.GameConfig.lotteryDrawVoCfg)(e=p.GameConfig.lotteryDrawVoCfg[s]).type==i&&(0==(n=e.stage-1)?(this.list_item0.array=e.bonus,this._limitNumArr[0]=e.selectNum):1==n?(this.list_item1.array=e.bonus,this._limitNumArr[1]=e.selectNum):2==n&&(this.list_item2.array=e.bonus,this._limitNumArr[2]=e.selectNum))}this.updateCheckGroupSelectCount(0),this.updateCheckGroupSelectCount(1),this.updateCheckGroupSelectCount(2)},t.prototype.initCheckBoxs=function(){for(var t,e=0;e<15;)(t=this["ck_"+e])&&t.on(Laya.Event.CLICK,this,this.onCheckBoxClickHandler,[e]),e++},t.prototype.onCheckBoxClickHandler=function(t){this.setCheckSelected(t,!this.checkSelected(t)),this.updateCheckGroupSelectCount(Math.floor(t/this._groupCkMaxNum))},t.prototype.setCheckSelected=function(t,e){var i=this["ck_"+t];if(i){var n=i.getChildByName("check_select");n&&(n.visible=e)}},t.prototype.checkSelected=function(t){var e=this["ck_"+t];if(e){var i=e.getChildByName("check_select");if(i)return i.visible}return!1},t.prototype.updateCheckGroupSelectCount=function(t){var e=this._limitNumArr[t],i=this.getCheckGroupSelectNum(t),n=i!=e?"#ff0000":"#dac494";this["htxt_select_count"+t].innerHTML=w.TextConst.get(966,n,i,e)},t.prototype.getCheckGroupSelectNum=function(t){for(var e=t*this._groupCkMaxNum,i=e+this._groupCkMaxNum,n=0;e<i;)this.checkSelected(e)&&n++,e++;return n},t.prototype.clearCheckGroupSelect=function(){for(var t=0;t<15;)this.setCheckSelected(t,!1),t++},t.prototype.onEnterSelectHandler=function(){for(var t=0,e=1,i=new d.ActivitySelectRewardPoolC2GS,n=0,s=0,o=this._limitNumArr[e-1],a=0;t<15;){if(n=t%this._groupCkMaxNum,this.checkSelected(t)&&(i["stage"+e+"Arr"].push(n),o<++s))return void h.FE.upItems(w.TextConst.get(967));if(t++,++a>=this._groupCkMaxNum){if(s<o)return void h.FE.upItems(w.TextConst.get(967));a=s=0,e++,o=this._limitNumArr[e-1]}}i.id=this._activityId,c.GSM.sendServer(i)},t.prototype.updateLotteryStateShow=function(){this.updateLotteryPool(),this.updateBoxShow()},t.prototype.updateLotteryPool=function(){for(var t=9,e=0;e<t;)this["gift"+e].visible=!0,this["gift"+e].offAll(),this["gift"+e].on(Laya.Event.CLICK,this,this.doLottery,[e+1]),this["item"+e].visible=!1,this["item"+e].offAll(),e++;var i=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(i){var n;t=i.rewardPool?i.rewardPool.length:0;for(var s=e=0;e<t;)0<(n=i.rewardPool[e]).index&&(this["gift"+(s=n.index-1)].visible=!1,this["gift"+s].offAll(),this["item"+s].visible=!0,r.ItemCellUtils.fillCellForItemNameView(this["item"+s],n.id,n.num),this["item"+s].on(Laya.Event.CLICK,this,this.onLotteryItemClickHandler,[n.id,n.num])),e++}},t.prototype.onLotteryItemClickHandler=function(t,e){l.ItemTips.ins.showTip(t,e)},t.prototype.doLottery=function(e){var i=this;if(u.RoleCenter.instans.bagRoomEnough()){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){for(var n,s=t.children.length,o=0,a=0;o<s;){if(n=t.children[o]){var r=p.GameConfig.subActivityJson[n.cfgId];if(r&&1==r.childId){a=Number(r.cost[t.allData.allCount][1]);break}}o++}if(0<a){if(u.RoleCenter.instans.vo.GOLD<a)return void C.Switches.ins.event(155);if(I.StateManger.showLotteryDrawBuyAlert)this._buyAlert||(this._buyAlert=new b.ActivityBuyAlert),this._buyAlert.showAlert(w.TextConst.get(968,a),Laya.Handler.create(this,function(){I.StateManger.showLotteryDrawBuyAlert=!i._buyAlert.check_select.visible;var t=new d.ActivityOpenRewardC2GS;t.id=i._activityId,t.isAll=!1,t.index=e,c.GSM.sendServer(t)}));else{var l=new d.ActivityOpenRewardC2GS;l.id=this._activityId,l.isAll=!1,l.index=e,c.GSM.sendServer(l)}}}}else y.AM.showBagNotEnough()},t.prototype.updateRoundNum=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e,i=t.children.length,n=0;this._progressArr.length=0;for(var s=this._progressArr[0]=0,o=t.allData.time+1;n<i;){if(e=t.children[n]){var a=p.GameConfig.subActivityJson[e.cfgId];a&&(s=Math.floor(a.childId/100))>this._maxRound&&(this._maxRound=s)}n++}this.lab_desc1.changeText(w.TextConst.get(971,this._maxRound-o))}},t.prototype.updateBoxShow=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e,i=t.children.length,n=0;this._progressArr.length=0,this._progressArr[0]=0;for(var s=t.allData.time+1,o=!0;n<i;){if(e=t.children[n]){var a=p.GameConfig.subActivityJson[e.cfgId];a&&(1==a.childId?t.allData.allCount<a.cost.length?(this.lab_cost_lab.visible=this.img_cost_icon.visible=this.lab_cost.visible=!0,this.lab_cost.changeText(a.cost[t.allData.allCount][1])):this.lab_cost_lab.visible=this.img_cost_icon.visible=this.lab_cost.visible=!1:a.childId>100*s&&a.childId<100*(s+1)&&(this.updateBoxState(n),e.status!=g.enumStatus.yilingqu&&(o=!1)))}n++}if(o){var r=s+1;for(var l in p.GameConfig.lotteryDrawVoCfg)if(p.GameConfig.lotteryDrawVoCfg[l].type==r){var h=new d.resetRewardPoolC2GS;h.id=this._activityId,c.GSM.sendServer(h);break}}}this.updateBoxProgress()},t.prototype.updateBoxState=function(t){var e=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=e.children[t],n=p.GameConfig.subActivityJson[i.cfgId];if(n){var s=n.childId%100,o=s-1;this._progressArr[s]=n.value;var a=e.allData.allCount<n.value?"#ff0000":"#e3cca9";this["lab_box_count"+o].innerHTML="<font color='"+a+"'>"+Math.min(e.allData.allCount,n.value)+"</font>/"+n.value,this["effect"+o].visible=!1,i.status==g.enumStatus.yilingqu?this["box"+o].skin="res/unpack/baoxiang_lv0"+(s+1)+"kai.png":(this["box"+o].skin="res/unpack/baoxiang_lv0"+(s+1)+".png",i.status==g.enumStatus.kelingqu&&(this["effect"+o].visible=!0)),this["box"+o].offAll(),this["box"+o].on(Laya.Event.CLICK,this,this.onClickBoxHandler,[i])}}},t.prototype.onClickBoxHandler=function(t){this._boxRewardDlg||(this._boxRewardDlg=new f.ActivityBoxGetDlg),this._boxRewardDlg.showBox(t,this._activityId)},t.prototype.updateBoxProgress=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);t&&(this.img_progress.scaleX=v.MathUtils.sectionProgress(this._progressArr,t.allData.allCount))},t.prototype.cooldownHandler=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-o.ServerTime.serverTime;86400<e?(this.lab_time.changeText(a.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(a.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t}(ui.activity.pages.Lottery_DrawUI);e.LotteryDrawPage=S}),define("src/g/activity/view/item/BossScoreExchangeItem",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../utils/system/FloatEffect","src/init/TextConst","../../../../plugin/view/ToolTip","../../../../manager/RoleCenter","../../../../manager/AM","../../../../config/GameConfig","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","src/g/Effects/UIEffectsFactory","../../../../utils/ItemUtils"],function(t,e,i,n,s,o,a,h,r,c,l,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(e){function t(){var t=e.call(this)||this;return t._lastBuyTime=0,t.btn_buy.on(Laya.Event.CLICK,t,t.onBuyHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItem0View(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.onBuyHandler=function(){if(Date.now()-this._lastBuyTime<1e3)s.FE.upItems(o.TextConst.get(258),a.BubbleEnum.center);else if(h.RoleCenter.instans.bagRoomEnough()){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex],i=c.GameConfig.subActivityJson[e.cfgId];if(i){if(0<i.value2&&i.value2-e.count<=0)return void s.FE.upItems(o.TextConst.get(218),a.BubbleEnum.center);if(0<i.viplevel&&h.RoleCenter.instans.vo.VIP<i.viplevel)return void s.FE.upItems(o.TextConst.get(219),a.BubbleEnum.center);if(t.allData.allCount<i.cost[0][1])return void s.FE.upItems(o.TextConst.get(370),a.BubbleEnum.center);this._lastBuyTime=Date.now();var n=new l.ActivityGetC2GS;n.id=this._activityId,n.activity2CfgId=e.cfgId,u.GSM.sendServer(n)}}}else r.AM.showBagNotEnough()},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e;var i=h.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=c.GameConfig.subActivityJson[n.cfgId],o=s.value2,a=s.value2-n.count;this.lab_count.color=0<a?"#03bb00":"#ff0f15",this.lab_count.changeText(a+"/"+o),this.btn_buy.label=s.cost[0][1];var r=d.ItemUtils.getItemVoById(s.cost[0][0]);this.img_cost.skin=d.ItemUtils.getIconByIconId(r.icon),this.txt_title.changeText(s.title);var l=!0;0<o&&a<=0&&(l=!1),0<s.viplevel&&h.RoleCenter.instans.vo.VIP<s.viplevel&&(l=!1),l?(this.ani||(this.ani=p.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_buy.getChildIndex(this.ani)&&p.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_buy),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_buy.getChildIndex(this.ani)&&this.btn_buy.removeChild(this.ani)),this.list_item.array=s.bonus}}},t}(ui.activity.item.BossScoreExchangeItemUI);e.BossScoreExchangeItem=g}),define("src/g/activity/view/pages/BossScoreExchangePage",["require","exports","../../../../manager/RoleCenter","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","../../../../enum/EventName","../../../../core/E","src/g/clearRes/ClearResM","../../../../config/GameConfig","src/g/activity/view/item/BossScoreExchangeItem","../../../../utils/ItemUtils","../../../../meta/MainButtonVo","../../../../manager/ActivityManager"],function(t,e,c,i,n,s,o,a,u,r,p,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t._state=0,t.btn_return.on(Laya.Event.CLICK,t,t.setShowState,[1]),t.btn_go.on(Laya.Event.CLICK,t,t.gotoKillBoss),t.btn_shop.on(Laya.Event.CLICK,t,t.setShowState,[2]),t.list_main.scrollBar.elasticDistance=100,t.list_main.itemRender=r.BossScoreExchangeItem,t.list_main.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t.htxt_desc.style.color="#ffeb9b",t.htxt_desc.style.font="SimHei",t.htxt_desc.style.fontSize=18,t.htxt_desc.style.leading=5,t.htxt_desc.style.stroke=1,t.htxt_desc.style.strokeColor="#000000",t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):a.ClearResM.resetViewImg(this),this.setShowState(1),o.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),o.E.ins.on(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.refresh(),this.cooldownHandler(),e.addChild(this),h.ActivityManager.ins.activityRead(this._activityId)},t.prototype.onTimeSpanHandler=function(t){var e=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.refresh=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);t&&this.lab_allcount.changeText(t.allData.allCount.toString()),this.updateListData()},t.prototype.hidePage=function(){o.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),o.E.ins.off(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),a.ClearResM.clearFolderByUrl("dynamic/activity/boss_score_exchange/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.gotoKillBoss=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=u.GameConfig.activityJson[t.cfgId];e.module&&0<e.module.length&&l.MainButtonStruct.Ins.OpenModule(e.module[0][1],e.module[1][1])}},t.prototype.onListRenderHandler=function(t,e){t.setData(this._activityId,this.list_main.array[e])},t.prototype.updateUnchanged=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=u.GameConfig.activityJson[t.cfgId];this.img_title.skin="dynamic/activity/boss_score_exchange/"+e.bg_img+".png",this.htxt_desc.innerHTML=e.desc||"";var i,n=t.children[0];n&&((i=u.GameConfig.subActivityJson[n.cfgId])&&i.image&&(this.img_bg.skin="dynamic/activity/boss_score_exchange/"+i.image+".png"),this.btn_go.label=i.desc),this._childIndexArr=[];for(var s,o,a=t.children.length,r=0,l=0;r<a;)s=t.children[r],(o=u.GameConfig.subActivityJson[s.cfgId])&&1!=o.childId&&(l=o.cost[0][0],this._childIndexArr.push(r)),r++;var h=p.ItemUtils.getItemVoById(l);this.img_cost.skin=p.ItemUtils.getIconByIconId(h.icon)}},t.prototype.updateListData=function(){this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_main.array=this._childIndexArr},t.prototype.childSortFun=function(t,e){var i=c.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=i.children[t],s=i.children[e],o=u.GameConfig.subActivityJson[n.cfgId],a=u.GameConfig.subActivityJson[s.cfgId],r=o?o.childId+100:100,l=a?a.childId+100:100;return 0<o.value2-n.count?r-=100:r+=100,0<a.value2-s.count?l-=100:l+=100,r-l},t.prototype.setShowState=function(t){this._state!=t&&(this._state=t,1==this._state?(this.box_index.visible=!0,this.btn_return.visible=this.list_main.visible=!1,this.htxt_desc.visible=this.lab_time.visible=this.lab_time_lab.visible=!0,this.img_title.visible=!1,this.img_bg.visible=!0,this.img_cost.visible=this.lab_allCount_lab.visible=this.lab_allcount.visible=!1):2==this._state&&(this.box_index.visible=!1,this.btn_return.visible=this.list_main.visible=!0,this.htxt_desc.visible=this.lab_time.visible=this.lab_time_lab.visible=!1,this.img_title.visible=!0,this.img_bg.visible=!1,this.img_cost.visible=this.lab_allCount_lab.visible=this.lab_allcount.visible=!0))},t.prototype.cooldownHandler=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-i.ServerTime.serverTime;86400<e?(this.lab_time.changeText(n.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(n.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t}(ui.activity.pages.Boss_Score_ExchangeUI);e.BossScoreExchangePage=d}),define("src/g/loginreward/view/NewLoginRewardView",["require","exports","../../../manager/RoleCenter","../../../config/GameConfig","src/g/clearRes/ClearResM","../../../core/E","../../../enum/EventName","src/g/bag/tips/view/ItemTips","src/g/Effects/UIEffectsFactory","../../net/messages/enumStatus","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","../../../manager/AM","../../net/messages/activity/ActivityGet","../../../manager/GameSocketManager","../../../utils/ItemCellUtils","../../../component/GAnimation","../../../utils/ItemUtils","src/init/TextConst"],function(t,e,h,c,n,s,o,i,a,u,r,l,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t._lastBuyTime=0,t._isRequestBuy=!1,t._selectIndex=0,t.list_child.scrollBar.elasticDistance=100,t.list_child.scrollBar.on(Laya.Event.END,t,t.onScrollEndHandler),t.list_child.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t.list_child.selectHandler=new Laya.Handler(t,t.onSelectHandler),t.btn_get.on(Laya.Event.CLICK,t,t.onGetHandler),t.ani=a.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.btn_get,40),t.ani.visible=!1,t.btn_turn_right.on(Laya.Event.CLICK,t,t.onTurnRight),t.btn_turn_left.on(Laya.Event.CLICK,t,t.onTurnLeft),t.btn_right_page.on(Laya.Event.CLICK,t,t.onTurnRightPage),t.btn_left_page.on(Laya.Event.CLICK,t,t.onTurnLeftPage),t.list_item.itemRender=ui.custom.ItemNameViewUI,t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.clickHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):n.ClearResM.resetViewImg(this);var i=this.findCanBuyIndex();-1!=i?i!=this.list_child.selectedIndex&&(this.list_child.selectedIndex=i):-1==this.list_child.selectedIndex&&(this.list_child.selectedIndex=0),this.moveToIndex(this.list_child.selectedIndex),s.E.ins.on(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this),this.showAni()},t.prototype.refresh=function(){n.ClearResM.resetViewImg(this),this.list_child.refresh()},t.prototype.hidePage=function(){s.E.ins.off(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),n.ClearResM.clearFolderByUrl("dynamic/activity/login_reward/"),this._isRequestBuy=!1,this.clearAni(),n.ClearResM.clearResFolder("loginreward/")},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){if(this._activityId==e){this.list_child.refresh();var i=this.findCanBuyIndex();this._isRequestBuy&&-1!=i&&i!=this.list_child.selectedIndex?this.list_child.selectedIndex=i:this.show(this._selectIndex)}},t.prototype.findCanBuyIndex=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)for(var e=0,i=this.list_child.array.length,n=0;n<i;){if(e=this.list_child.array[n],t.children[e].status!=u.enumStatus.yilingqu)return n;n++}return-1},t.prototype.showAni=function(){var t=a.UIEffectsFactory.Ins.createSAniById(80);this.effect_con.addChild(t)},t.prototype.clearAni=function(){this.effect_con.removeChildren(),a.UIEffectsFactory.Ins.clearAniRes(80)},t.prototype.updateUnchanged=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){this._childIndexArr=[];for(var e=t.children.length,i=0;i<e;)this._childIndexArr.push(i),i++;this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_child.array=this._childIndexArr,this.list_child.selectedIndex=0,this.onScrollEndHandler()}else console.log("没有找到数据，类型：LoginReward")},t.prototype.childSortFun=function(t,e){var i=h.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=c.GameConfig.subActivityJson[i.children[t].cfgId],s=c.GameConfig.subActivityJson[i.children[e].cfgId];return(n?n.childId:0)-(s?s.childId:0)},t.prototype.onRenderHandler=function(t,e){v.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t){var e=this.list_item.array[t];i.ItemTips.ins.showTip(e[0],Number(e[1]))},t.prototype.onTurnLeft=function(){this.list_child.scrollBar.value=0,this.onScrollEndHandler()},t.prototype.onTurnRight=function(){this.list_child.scrollBar.value=this.list_child.scrollBar.max,this.onScrollEndHandler()},t.prototype.onScrollEndHandler=function(){this.btn_turn_right.visible=this.btn_turn_left.visible=!1,0<this.list_child.scrollBar.max&&(10<this.list_child.scrollBar.value&&(this.btn_turn_left.visible=!0),this.list_child.scrollBar.value<this.list_child.scrollBar.max-10&&(this.btn_turn_right.visible=!0))},t.prototype.onListRenderHandler=function(t,e){var i=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(i){var n=i.children[t.dataSource];if(n){t.img_got.visible=n.status==u.enumStatus.yilingqu;for(var s,o=t.effect_con.numChildren-1;0<=o;)(s=t.effect_con.removeChildAt(o))&&(s.removeSelf(),s.clear()),o--;if(n.status==u.enumStatus.kelingqu){var a=y.ItemUtils.getUIEffectsVoById(108);if(a){(s=new f.GAnimation).interval=150,s.x=t.effect_con.width/2,s.y=t.effect_con.height/2,t.effect_con.addChild(s);var r=(a.urlPath?a.urlPath:"dynamic2/uieffect")+"/"+a.name+".json";s.load(r,!0)}}var l=c.GameConfig.subActivityJson[n.cfgId];l&&(t.clip_day.value=l.value.toString(),t.img_icon.skin="dynamic/activity/login_reward/denglu_jianglixiao_"+(l.childId<10?"0"+l.childId:l.childId)+".png",t.img_flag.skin=l.value2?"res/custom/"+l.value2+".png":null)}}},t.prototype.onSelectHandler=function(t){this.show(t)},t.prototype.onGetHandler=function(){if(Date.now()-this._lastBuyTime<1e3)r.FE.upItems(m.TextConst.get(258),l.BubbleEnum.center);else if(h.RoleCenter.instans.bagRoomEnough()){var t=this.list_child.array[this._selectIndex],e=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=e.children[t];if(i&&i.status==u.enumStatus.kelingqu){this._lastBuyTime=Date.now(),this._isRequestBuy=!0;var n=new d.ActivityGetC2GS;n.id=this._activityId,n.activity2CfgId=i.cfgId,g.GSM.sendServer(n)}}}else p.AM.showBagNotEnough()},t.prototype.show=function(t){this._selectIndex=t,t=this.list_child.array[this._selectIndex];var e=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i,n=e.children[t];if(n)(i=c.GameConfig.subActivityJson[n.cfgId])&&(this.img_icon.skin="dynamic/activity/login_reward/denglu_jianglida_"+(i.childId<10?"0"+i.childId:i.childId)+".png",this.img_ad.skin=null,this.img_ad.skin="dynamic/activity/login_reward/ad_"+i.childId+".png"),this.btn_get.disabled=!0,this.ani.visible=!1,n.status==u.enumStatus.kelingqu&&(this.btn_get.disabled=!1,this.ani.visible=!0),this.day_count.text=m.TextConst.get(277,e.allData.allCount),(i=c.GameConfig.subActivityJson[n.cfgId])&&(this.list_item.array=i.bonus)}},t.prototype.onTurnRightPage=function(){this._selectIndex<this._childIndexArr.length-1&&(this.list_child.selectedIndex=this._selectIndex+1,this.moveToIndex(this.list_child.selectedIndex))},t.prototype.onTurnLeftPage=function(){0<this._selectIndex&&(this.list_child.selectedIndex=this._selectIndex-1,this.moveToIndex(this.list_child.selectedIndex))},t.prototype.moveToIndex=function(t){this.list_child.tweenTo(t,200)},t}(ui.loginreward.NewLoginRewardUI);e.NewLoginRewardView=_}),define("src/g/activity/view/item/FlashSaleInner2Item",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../manager/RoleCenter","../../../../manager/AM","../../../../config/GameConfig","src/g/Effects/UIEffectsFactory","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../core/GNet","src/init/TextConst"],function(t,e,n,s,p,o,d,g,a,r,l,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t._lastBuyTime=0,t.btn_get.on(Laya.Event.CLICK,t,t.onBuyHandler),t}return __extends(t,e),t.prototype.onBuyHandler=function(){if(Date.now()-this._lastBuyTime<1e3)a.FE.upItems(v.TextConst.get(258),r.BubbleEnum.center);else if(p.RoleCenter.instans.bagRoomEnough()){var t=p.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex],i=d.GameConfig.subActivityJson[e.cfgId];if(i){if(0<i.value2&&i.value2-e.count<=0)return void a.FE.upItems(v.TextConst.get(218),r.BubbleEnum.center);if(0<i.viplevel&&p.RoleCenter.instans.vo.VIP<i.viplevel)return void a.FE.upItems(v.TextConst.get(219),r.BubbleEnum.center);this._lastBuyTime=Date.now(),l.GNet.toRecharge(Number(i.desc))}}}else o.AM.showBagNotEnough()},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e;var i=p.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=d.GameConfig.subActivityJson[n.cfgId],o=s.value2,a=s.value2-n.count;this.lab_progress.color=0<a?"#03bb00":"#ff0f15",this.lab_progress.changeText(a+"/"+o),this.btn_get.label=v.TextConst.get(5,s.cost[0][1]),this.lab_desc.changeText(s.title);var r=!0;0<o&&a<=0&&(r=!1),0<s.viplevel&&p.RoleCenter.instans.vo.VIP<s.viplevel&&(r=!1),this.icon_state.visible=!r,this.lab_progress.visible=this.txt_progress_lab.visible=this.btn_get.visible=r,r?(this.ani||(this.ani=g.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_get.getChildIndex(this.ani)&&g.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_get),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_get.getChildIndex(this.ani)&&this.btn_get.removeChild(this.ani)),this.img_flag0.visible=!1,this.img_flag1.visible=!1,this.img_flag2.visible=!1,this.img_add0.visible=!1,this.img_add1.visible=!1,this.item0.visible=!1,this.item1.visible=!1,this.item2.visible=!1;var l=Number(s.desc),h=d.GameConfig.rechargeJson[l];if(h){this.img_flag0.visible=!0;var c=h.gold;-1==p.RoleCenter.instans.vo.vipData.buyyedIdArr.indexOf(l)?(c+=h.reward,this.img_flag0.skin="res/activity/dang1.png"):this.img_flag0.skin="res/activity/dang2.png",this.fillCell(this.item0,"GOLD",c)}var u=s.bonus.length;0<u&&(this.img_add0.visible=!0,this.img_flag1.visible=!0,this.fillCell(this.item1,s.bonus[0][0],s.bonus[0][1])),1<u&&(this.img_add1.visible=!0,this.img_flag2.visible=!0,this.fillCell(this.item2,s.bonus[1][0],s.bonus[1][1]))}}},t.prototype.fillCell=function(t,e,i){t.visible=!0,n.ItemCellUtils.fillCellForItemNameView(t,e,i),t.offAll(),t.on(Laya.Event.CLICK,this,function(t,e){s.ItemTips.ins.showTip(t,e)},[e,i])},t}(ui.activity.item.FlashSaleInner2ItemUI);e.FlashSaleInner2Item=i}),define("src/g/activity/view/pages/FlashSaleInner2Page",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/system/DateUitl","../../../../manager/GameSocketManager","../../../net/messages/OpResultGS2C","../../../net/messages/OpResultType","../../../../utils/system/ServerTime","src/g/activity/view/item/FlashSaleInner2Item"],function(t,e,i,n,s,h,c,o,a,r,l,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t.day=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.refresh(),this.cooldownHandler(),a.GSM.ins.on(r.OpResultGS2C.KEY,this,this.onOpResult),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),e.addChild(this)},t.prototype.onTimeSpanHandler=function(t){var e=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.refresh=function(){this.updateListData()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.off(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/flash_sale_inner2/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this),a.GSM.ins.off(r.OpResultGS2C.KEY,this,this.onOpResult)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_main.scrollBar.elasticDistance=100,this.list_main.itemRender=p.FlashSaleInner2Item,this.list_main.renderHandler=new Laya.Handler(this,this.onListRenderHandler)},t.prototype.onOpResult=function(t){t.msgidx==l.enumOpResultType.activity_nextDay&&(this.day++,7<this.day&&a.GSM.ins.off(r.OpResultGS2C.KEY,this,this.onOpResult),this.updateUnchanged(),this.cooldownHandler(),this.refresh())},t.prototype.onListRenderHandler=function(t,e){t.setData(this._activityId,this.list_main.array[e])},t.prototype.updateUnchanged=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=c.GameConfig.activityJson[t.cfgId];this.title_img.skin="dynamic/activity/flash_sale_inner2/"+e.bg_img+".png",this.lab_desc.changeText(e.desc),this.day<=0&&(this.day=o.DateUtil.getDayFromStartTime(t.startTime,u.ServerTime.ACTIVITY_TIME_OFFSET)),this._childIndexArr=[];for(var i=t.children.length,n=0;n<i;)this._childIndexArr.push(n),n++}else console.log("没有找到数据，类型：accumulative_spending")},t.prototype.updateListData=function(){h.RoleCenter.instans.vo.getActivity1Data(this._activityId)&&(this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_main.array=this._childIndexArr)},t.prototype.childSortFun=function(t,e){var i=h.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=i.children[t],s=i.children[e],o=c.GameConfig.subActivityJson[n.cfgId],a=c.GameConfig.subActivityJson[s.cfgId],r=o?o.childId+100:100,l=a?a.childId+100:100;return 0<o.value2-n.count?r-=100:r+=100,0<a.value2-s.count?l-=100:l+=100,r-l},t.prototype.cooldownHandler=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-u.ServerTime.serverTime;172800<e?(this.time_txt.changeText(o.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.time_txt.changeText(o.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.time_txt.changeText("00:00:00")}},t}(ui.activity.pages.FlashSaleInner2PageUI);e.FlashSaleInner2Page=d}),define("src/g/activity/view/pages/VipLimitDiscountPage",["require","exports","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","../../../../manager/RoleCenter","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../config/GameConfig","src/g/bag/tips/view/ItemTips","../../../../utils/system/FloatEffect","src/init/TextConst","../../../../plugin/view/ToolTip","../../../../manager/AM","src/init/Switches","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../utils/ItemUtils","../../../../utils/ItemCellUtils","../../../net/messages/enumStatus","../../../net/messages/activity/ActivityTrigger","../../../../manager/ActivityManager"],function(t,e,i,n,r,s,o,a,l,h,c,u,p,d,g,v,f,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var b=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t._lastBuyTime=0,t._isRequestBuy=!1,t._selectIndex=0,t._selectCfgId=0,t._runnum=0,t.list_child.scrollBar.elasticDistance=100,t.list_child.scrollBar.on(Laya.Event.END,t,t.onScrollEndHandler),t.list_child.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t.list_child.selectHandler=new Laya.Handler(t,t.onSelectHandler),t.btn_buy.on(Laya.Event.CLICK,t,t.onBuyHandler),t.btn_turn_right.on(Laya.Event.CLICK,t,t.onTurnRight),t.btn_turn_left.on(Laya.Event.CLICK,t,t.onTurnLeft),t.list_show.renderHandler=new Laya.Handler(t,t.onShowRenderHandler),t.list_show.mouseHandler=new Laya.Handler(t,t.onShowMouseHandler),t.htxt_tip.style.color="#e3cca9",t.htxt_tip.style.font="SimHei",t.htxt_tip.style.fontSize=17,t.htxt_tip.style.align="center",t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):s.ClearResM.resetViewImg(this),o.E.ins.on(a.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),f.GSM.ins.on(C.discountGiftGS2C.KEY,this,this.onGetDiscountBack),this.refresh(),this.cooldownHandler(),e.addChild(this),I.ActivityManager.ins.activityRead(this._activityId)},t.prototype.refresh=function(){0==this._runnum&&this.show(this._selectIndex)},t.prototype.hidePage=function(){o.E.ins.off(a.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),f.GSM.ins.off(C.discountGiftGS2C.KEY,this,this.onGetDiscountBack),this.removeSelf(),s.ClearResM.clearFolderByUrl("dynamic/activity/vip_limit_discount/"),Laya.timer.clear(this,this.cooldownHandler),this.stopRollNum()},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.onShowRenderHandler=function(t,e){m.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onShowMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_show.array[e];h.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.onTurnLeft=function(){this.list_child.scrollBar.value=0,this.onScrollEndHandler()},t.prototype.onTurnRight=function(){this.list_child.scrollBar.value=this.list_child.scrollBar.max,this.onScrollEndHandler()},t.prototype.onScrollEndHandler=function(){this.btn_turn_right.visible=this.btn_turn_left.visible=!1,0<this.list_child.scrollBar.max&&(10<this.list_child.scrollBar.value&&(this.btn_turn_left.visible=!0),this.list_child.scrollBar.value<this.list_child.scrollBar.max-10&&(this.btn_turn_right.visible=!0))},t.prototype.updateUnchanged=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=l.GameConfig.activityJson[t.cfgId];this.img_title.skin="dynamic/activity/vip_limit_discount/"+e.bg_img+".png",this._childIndexArr=[];for(var i=t.children.length,n=0;n<i;)this._childIndexArr.push(n),n++;this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_child.array=this._childIndexArr,this.list_child.selectedIndex=0}},t.prototype.childSortFun=function(t,e){var i=r.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=l.GameConfig.subActivityJson[i.children[t].cfgId],s=l.GameConfig.subActivityJson[i.children[e].cfgId],o=n?n.childId:0;0<o&&(o%=100);var a=s?s.childId:0;return 10<a&&(a%=100),o-a},t.prototype.onListRenderHandler=function(t,e){var i=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(i){var n=i.children[t.dataSource];if(n){var s=l.GameConfig.subActivityJson[n.cfgId];if(s){var o=y.ItemUtils.getItemOrEq(s.bonus[0][0]);t.img_icon.skin=y.ItemUtils.getIconByIconId(o.icon),t.clip_vip.value=s.viplevel.toString(),t.img_got.visible=n.status==_.enumStatus.yilingqu}}}},t.prototype.onSelectHandler=function(t){this.stopRollNum(),this.show(t)},t.prototype.onBuyHandler=function(){if(!(0<this._runnum))if(Date.now()-this._lastBuyTime<1e3)c.FE.upItems(u.TextConst.get(258),p.BubbleEnum.center);else if(r.RoleCenter.instans.bagRoomEnough()){var t,e,i=0,n=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(n&&(i=this.list_child.array[this._selectIndex],t=n.children[i])){if(0<(e=l.GameConfig.subActivityJson[t.cfgId]).viplevel&&r.RoleCenter.instans.vo.VIP<e.viplevel)return void c.FE.upItems(u.TextConst.get(219),p.BubbleEnum.center);if(0<t.count){if(t.status!=_.enumStatus.yilingqu){if("MONEY"==e.cost[0][0]&&r.RoleCenter.instans.vo.MONEY<e.cost[0][1]-t.count)return void c.FE.upItems(u.TextConst.get(220),p.BubbleEnum.center);if("GOLD"==e.cost[0][0]&&r.RoleCenter.instans.vo.GOLD<e.cost[0][1]-t.count)return void g.Switches.ins.event(155);var s;this._lastBuyTime=Date.now(),this._isRequestBuy=!0,(s=new v.ActivityGetC2GS).id=this._activityId,s.activity2CfgId=t.cfgId,f.GSM.sendServer(s)}}else this._lastBuyTime=Date.now(),this._isRequestBuy=!0,(s=new C.discountGiftC2GS).id=this._activityId,s.activity2CfgId=t.cfgId,f.GSM.sendServer(s)}}else d.AM.showBagNotEnough()},t.prototype.onGetDiscountBack=function(t){this._activityId==t.id&&t.activity2CfgId==this._selectCfgId&&this.playRollNum(t.discountNum)},t.prototype.show=function(t){this._selectIndex=t,t=this.list_child.array[this._selectIndex];var e=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=e.children[t];if(i){this._selectCfgId=i.cfgId;var n=l.GameConfig.subActivityJson[i.cfgId];if(n)if(this.list_show.array=n.bonus,this.clip_cost.value=(n.cost[0][1]-i.count).toString(),this.btn_buy.visible=!1,0<i.count){this.htxt_tip.visible=!0;var s=0;s=7<n.viplevel?99:3<n.viplevel?98:97,this.htxt_tip.innerHTML="恭喜：您的立减金额已超过<font color='#09d51f' style='fontSize:22'>"+s+"%</font>的玩家",this.lab_original_cost.changeText(n.cost[0][1]),this.lab_original_cost.visible=this.lab_original_cost_lab.visible=this.line_original_cost.visible=!0,this.setRollNum(i.count),this.btn_buy.label="立即购买",i.status!=_.enumStatus.yilingqu&&(this.btn_buy.visible=!0)}else this.btn_buy.visible=!0,0<n.viplevel&&r.RoleCenter.instans.vo.VIP<n.viplevel&&(this.btn_buy.visible=!1),this.btn_buy.label="试试手气",this.htxt_tip.visible=!1,this.lab_original_cost.visible=this.lab_original_cost_lab.visible=this.line_original_cost.visible=!1,this.resetRollNum()}}},t.prototype.resetRollNum=function(){for(var t=0;t<6;)this["roll_num_"+t].reset(),t++},t.prototype.setRollNum=function(t){this.roll_num_0.setIndex(Math.floor(t/1e5)),this.roll_num_1.setIndex(Math.floor(t/1e4)%10),this.roll_num_2.setIndex(Math.floor(t/1e3)%10),this.roll_num_3.setIndex(Math.floor(t/100)%10),this.roll_num_4.setIndex(Math.floor(t/10)%10),this.roll_num_5.setIndex(t%10)},t.prototype.playRollNum=function(t){this.roll_num_0.on("roll_complete",this,this.onRollCompleteHandler),this.roll_num_1.on("roll_complete",this,this.onRollCompleteHandler),this.roll_num_2.on("roll_complete",this,this.onRollCompleteHandler),this.roll_num_3.on("roll_complete",this,this.onRollCompleteHandler),this.roll_num_4.on("roll_complete",this,this.onRollCompleteHandler),this.roll_num_5.on("roll_complete",this,this.onRollCompleteHandler),this._runnum=6,this.roll_num_0.play(Math.floor(t/1e5)),this.roll_num_1.play(Math.floor(t/1e4)%10),this.roll_num_2.play(Math.floor(t/1e3)%10),this.roll_num_3.play(Math.floor(t/100)%10),this.roll_num_4.play(Math.floor(t/10)%10),this.roll_num_5.play(t%10)},t.prototype.onRollCompleteHandler=function(){if(this._runnum--,0==this._runnum){for(var t=0;t<6;)this["roll_num_"+t].off("roll_complete",this,this.onRollCompleteHandler),t++;this.show(this._selectIndex)}},t.prototype.stopRollNum=function(){if(0<this._runnum){for(var t=0;t<6;)this["roll_num_"+t].stop(),this["roll_num_"+t].off("roll_complete",this,this.onRollCompleteHandler),t++;this._runnum=0}},t.prototype.cooldownHandler=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-n.ServerTime.serverTime;86400<e?(this.lab_time.changeText(i.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(i.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t}(ui.activity.pages.Vip_Limit_DiscountUI);e.VipLimitDiscountPage=b}),define("src/g/activity/view/FlashSale2Prompt",["require","exports","../../../utils/system/DateUitl","../../../utils/system/ServerTime","../../../utils/SoundUtils","src/init/Switches"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.btn_goto.on(Laya.Event.CLICK,t,t.onGotoHandler),t}return __extends(t,e),t.prototype.onGotoHandler=function(){this.close(),s.SoundUtils.getInstance().playBtnsounds(),o.Switches.ins.event(197)},t.prototype.showPrompt=function(){this.isPopup||(this.popup(),this.cooldownHandler())},t.prototype.onClosed=function(){Laya.timer.clear(this,this.cooldownHandler)},t.prototype.cooldownHandler=function(){var t=i.DateUtil.getZeroTime()-n.ServerTime.serverTime;0<=t?(this.lab_time.changeText(i.DateUtil.getHMS_countdown(t)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")},t}(ui.activity.FlashSale2PromptUI);e.FlashSale2Prompt=a}),define("src/g/index/ctrl/FlashSale2BtnCtrl",["require","exports","../../../enum/EventName","src/g/accessctrl/AccessCenter","../../../core/E","../../../enum/ActivityPos","../../../manager/ActivityManager","../../../manager/RoleCenter","../../../config/GameConfig","src/init/Switches","../../../utils/SoundUtils","../../../utils/system/DateUitl","../../../utils/system/ServerTime","src/g/fight/osprite/play/PlayManager","src/g/activity/view/FlashSale2Prompt"],function(t,e,l,i,h,n,c,u,p,s,o,d,g,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(){function t(t,e){this._pos=n.ActivityPos.FLASH_SALE_HALL_2,this._opened=!1,this._currActivityId=0,this._limitLv=0,this.day=0,this._btn=t,this._cdLab=e,this._btn&&(this._btn.on(Laya.Event.CLICK,this,this.onOpHandler),this._parent=this._btn.parent),this._btn.visible=!0,this.init()}return t.prototype.onOpHandler=function(){this._currActivityId&&(o.SoundUtils.getInstance().playBtnsounds(),s.Switches.ins.event(197))},t.prototype.init=function(){this._btn&&(this._btn.once(l.EventName.ON_UI_DESTROYED,this,this.doDestroy),i.AccessCenter.ins.checkOpen(197)?this.doInit():(this._btn.parent&&(this._btn.removeSelf(),this._btn.event(l.EventName.UI_REMOVE_STAGE)),i.AccessCenter.ins.on(197,this,this.onActivityAccessUpdate)))},t.prototype.onActivityAccessUpdate=function(){i.AccessCenter.ins.checkOpen(197)&&(i.AccessCenter.ins.off(197,this,this.onActivityAccessUpdate),this.doInit())},t.prototype.doInit=function(){h.E.ins.on(l.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.onActivityHallChanged),this.updateBtnShow()},t.prototype.onActivityHallChanged=function(t){this._pos==t&&this.updateBtnShow()},t.prototype.updateBtnShow=function(){h.E.ins.off(l.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),h.E.ins.off(l.EventName.PLAY_TYPE_CHANGED,this,this.changePlaytype);var t=!1,e=c.ActivityManager.ins.getActivityHallByPos(this._pos);if(e&&0<e.count){t=!0;var i=e.getActivatedIds();if(i&&0<i.length){this._currActivityId=i[0];var n=u.RoleCenter.instans.vo.getActivity1Data(this._currActivityId);if(n){this.day=d.DateUtil.getDayFromStartTime(n.startTime,g.ServerTime.ACTIVITY_TIME_OFFSET);for(var s=n.children.length,o=0;o<s;){var a=p.GameConfig.subActivityJson[n.children[o].cfgId];if(a&&this.day==a.value){0<a.value2&&a.value2-n.children[o].count<=0?t=!1:h.E.ins.on(l.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged);break}o++}var r=p.GameConfig.activityJson[n.cfgId];this._limitLv=Number(r.value),0<this._limitLv&&u.RoleCenter.instans.vo.getCurLv()<this._limitLv&&(h.E.ins.on(l.EventName.ADDED_LEVEL,this,this.onAddLvHandler),t=!1,this._opened=!1)}}}t?(this._parent&&(this._parent.addChild(this._btn),this._btn.event(l.EventName.UI_ADD_TO_STAGE)),this._opened||(1<this.day?Laya.timer.once(6e5,this,this.popPrompt):this.popPrompt(),this._opened=!0),this.updateCD()):(Laya.timer.clear(this,this.updateCD),this._btn.parent&&(this._btn.removeSelf(),this._btn.event(l.EventName.UI_REMOVE_STAGE)))},t.prototype.onActivityDataChanged=function(t,e){e==this._currActivityId&&this.updateBtnShow()},t.prototype.popPrompt=function(){if(this._currActivityId)if(a.PlayManager.canGoToFuben()){var t=u.RoleCenter.instans.vo.getActivity1Data(this._currActivityId);if(t){this.day=d.DateUtil.getDayFromStartTime(t.startTime,g.ServerTime.ACTIVITY_TIME_OFFSET);for(var e=t.children.length,i=0;i<e;){var n=p.GameConfig.subActivityJson[t.children[i].cfgId];if(n&&this.day==n.value){0<n.value2&&n.value2-t.children[i].count<=0||(new r.FlashSale2Prompt).showPrompt();break}i++}}}else h.E.ins.on(l.EventName.PLAY_TYPE_CHANGED,this,this.changePlaytype)},t.prototype.changePlaytype=function(){h.E.ins.off(l.EventName.PLAY_TYPE_CHANGED,this,this.changePlaytype),this.popPrompt()},t.prototype.onAddLvHandler=function(){u.RoleCenter.instans.vo.getCurLv()>=this._limitLv&&(h.E.ins.off(l.EventName.ADDED_LEVEL,this,this.onAddLvHandler),this.updateBtnShow())},t.prototype.updateCD=function(){if(this._cdLab){var t=d.DateUtil.getZeroTime()-g.ServerTime.serverTime;this._cdLab.changeText(d.DateUtil.getHMS_countdown(t)),Laya.timer.once(1e3,this,this.updateCD)}},t.prototype.doDestroy=function(){this._btn=null,this._cdLab=null,this._parent=null,h.E.ins.off(l.EventName.ADDED_LEVEL,this,this.onAddLvHandler),i.AccessCenter.ins.off(197,this,this.onActivityAccessUpdate),h.E.ins.off(l.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.onActivityHallChanged),h.E.ins.off(l.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged)},t}();e.FlashSale2BtnCtrl=v}),define("src/g/activity/view/pages/TreasureAppraisalPage",["require","exports","../../../../manager/RoleCenter","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","../../../../core/E","../../../../enum/EventName","src/g/clearRes/ClearResM","../../../../config/GameConfig","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../utils/ItemUtils","../../../../manager/AM","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","src/g/activity/view/alerts/ActivityBuyAlert","../../../../manager/StateManger","src/init/TextConst","src/init/Switches","../../../net/messages/activity/ActivityTrigger","../../../../manager/ActivityManager"],function(t,e,u,i,n,s,o,a,p,r,l,h,c,d,g,v,f,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var I=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.maxRound=0,t._selectIndex=0,t._selectChild=0,t._selectAct2CfgId=0,t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t.htxt_desc.style.font="SimHei",t.htxt_desc.style.color="#a89e8f",t.htxt_desc.style.fontSize=18,t.btn_buy.on(Laya.Event.CLICK,t,t.onBuyOneHandler),t.btn_buy10.on(Laya.Event.CLICK,t,t.onBuyTenHandler),t.btn_get.on(Laya.Event.CLICK,t,t.onGetRewardHandler),t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):a.ClearResM.resetViewImg(this),s.E.ins.on(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),s.E.ins.on(o.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.refresh(),this.cooldownHandler(),e.addChild(this),C.ActivityManager.ins.activityRead(this._activityId)},t.prototype.onTimeSpanHandler=function(t){var e=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.refresh=function(){this.updateActivityData()},t.prototype.hidePage=function(){s.E.ins.off(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),s.E.ins.off(o.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),a.ClearResM.clearFolderByUrl("dynamic/activity/treasure_appraisal/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.onRenderHandler=function(t,e){r.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];l.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.onBuyOneHandler=function(){var t=this,e=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=e.children[this._selectIndex],n=p.GameConfig.subActivityJson[i.cfgId];if(0==i.count)return void this.doBuyOne(0);var s=n.cost[1][0];if(n.cost[1][1]<=u.RoleCenter.instans.vo.bagdata.getItemCount(s))this.doBuyOne(0);else{var o=n.originalcost[0][1]*Math.floor(e.allData.time/this.maxRound),a=n.cost[0][1]+o;f.StateManger.showTreasureAppraisalOneBuyAlert?(this._buyAlert||(this._buyAlert=new v.ActivityBuyAlert),this._buyAlert.showAlert(y.TextConst.get(986,a,1),Laya.Handler.create(this,function(){f.StateManger.showTreasureAppraisalOneBuyAlert=!t._buyAlert.check_select.visible,t.doBuyOne(a)}))):this.doBuyOne(a)}}},t.prototype.doBuyOne=function(t){if(u.RoleCenter.instans.vo.GOLD<t)m.Switches.ins.event(155);else{var e=new _.identifyGemC2GS;e.id=this._activityId,e.activity2CfgId=this._selectAct2CfgId,e.time=1,g.GSM.sendServer(e)}},t.prototype.onBuyTenHandler=function(){var t=this,e=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=e.children[this._selectIndex],n=p.GameConfig.subActivityJson[i.cfgId],s=(n.value-i.count)/n.value2,o=n.cost[1][0],a=n.cost[1][1],r=u.RoleCenter.instans.vo.bagdata.getItemCount(o);if(a<=r){var l=Math.floor(r/a);this.doBuyTen(s<l?s:l,0)}else{var h=n.originalcost[0][1]*Math.floor(e.allData.time/this.maxRound),c=n.cost[0][1]+h;c*=0==i.count?s-1:s,f.StateManger.showTreasureAppraisalTenBuyAlert?(this._buyAlert||(this._buyAlert=new v.ActivityBuyAlert),this._buyAlert.showAlert(y.TextConst.get(986,c,s),Laya.Handler.create(this,function(){f.StateManger.showTreasureAppraisalTenBuyAlert=!t._buyAlert.check_select.visible,t.doBuyTen(s,c)}))):this.doBuyTen(s,c)}}},t.prototype.doBuyTen=function(t,e){if(u.RoleCenter.instans.vo.GOLD<e)m.Switches.ins.event(155);else{var i=new _.identifyGemC2GS;i.id=this._activityId,i.activity2CfgId=this._selectAct2CfgId,i.time=t,g.GSM.sendServer(i)}},t.prototype.onGetRewardHandler=function(){if(u.RoleCenter.instans.bagRoomEnough()){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._selectIndex],i=p.GameConfig.subActivityJson[e.cfgId];if(e.count>=i.value){var n=new d.ActivityGetC2GS;n.id=this._activityId,n.activity2CfgId=e.cfgId,g.GSM.sendServer(n)}}}else c.AM.showBagNotEnough()},t.prototype.updateUnchanged=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=p.GameConfig.activityJson[t.cfgId];e&&(this.img_title.skin="dynamic/activity/treasure_appraisal/"+e.bg_img+".png",this.htxt_desc.innerHTML=e.desc?e.desc:"");for(var i,n,s=t.children.length,o=0;o<s;)i=t.children[o],(n=p.GameConfig.subActivityJson[i.cfgId])&&n.childId>this.maxRound&&(this.maxRound=n.childId),o++}},t.prototype.findSelectChild=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.allData.time+1;this._selectChild=e%this.maxRound,0==this._selectChild&&(this._selectChild=this.maxRound),this._selectIndex=-1;for(var i,n,s=t.children.length,o=0;o<s;){if(i=t.children[o],(n=p.GameConfig.subActivityJson[i.cfgId])&&n.childId==this._selectChild){this._selectIndex=o,this._selectAct2CfgId=i.cfgId;break}o++}}},t.prototype.updateRewardPool=function(t,e){this.fillBigReward(t.bonus[e][0],t.bonus[e][1]),this.list_item.array=t.bonus.slice(1,9)},t.prototype.fillBigReward=function(t,e){this.item0.offAll(),r.ItemCellUtils.fillCellForItem0View(this.item0,t,e),this.item0.on(Laya.Event.CLICK,this,function(){l.ItemTips.ins.showTip(t,e)})},t.prototype.updateActivityData=function(){this.findSelectChild();var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._selectIndex],i=p.GameConfig.subActivityJson[e.cfgId];this.updateRewardPool(i,t.allData.allCount);var n=i.value,s=e.count;this.lab_progress.changeText(s+"/"+n),this.img_progress.scaleX=s/n;var o=n<=s;if(this.btn_get.visible=o,this.btn_buy.visible=this.btn_buy10.visible=!o,this.lab_free.visible=!o&&s<=0,this.lab_cost_gold.visible=this.img_cost_gold.visible=this.lab_cost_or.visible=this.img_cost_item.visible=this.lab_cost_count.visible=!o&&0<s,!o&&0<s){var a=i.originalcost[0][1]*Math.floor(t.allData.time/this.maxRound);this.lab_cost_gold.changeText(i.cost[0][1]+a+""),this.img_cost_item.skin=h.ItemUtils.getIconByIconId(h.ItemUtils.getItemVoById(i.cost[1][0]).icon),this.lab_cost_count.changeText(i.cost[1][1])}}},t.prototype.cooldownHandler=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-i.ServerTime.serverTime;86400<e?(this.lab_time.changeText(n.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(n.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t}(ui.activity.pages.TreasureAppraisalUI);e.TreasureAppraisalPage=I}),define("src/g/activity/view/item/PetCamivalItem",["require","exports","../../../../manager/RoleCenter","../../../net/messages/enumStatus","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../config/GameConfig","../../../../meta/MainButtonVo","src/init/TextConst","src/g/Effects/UIEffectsFactory"],function(t,e,l,h,s,o,c,a,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.getHandler),t}return __extends(t,e),t.prototype.getHandler=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex];if(e&&e.status==h.enumStatus.kelingqu){var i=new s.ActivityGetC2GS;i.id=this._activityId,i.activity2CfgId=e.cfgId,o.GSM.sendServer(i)}else if(e.status==h.enumStatus.weiwancheng){var n=c.GameConfig.subActivityJson[e.cfgId];a.MainButtonStruct.Ins.OpenModule(n.moduleID[0][1],n.moduleID[1][1])}}},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e;var i=l.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=c.GameConfig.subActivityJson[n.cfgId];this.lab_desc.changeText(s.title);var o=n.count,a=s.value;0<s.value2&&(a=1),this.lab_progress.color=a<=o?"#03bb00":"#ff0f15",this.lab_progress.changeText(o+"/"+a);var r=this.icon_state.visible=!1;this.lab_progress.color="#09d51f",this.img_state.skin=n.status==h.enumStatus.weiwancheng?"res/activity/xuanzedaqu_iconhuobao.png":"res/activity/xuanzedaqu_iconliuchang.png",n.status==h.enumStatus.weiwancheng?(this.btn_get.visible=!0,this.btn_get.disabled=!0,this.btn_get.label=u.TextConst.get(210),s.moduleID&&0<s.moduleID.length&&(this.btn_get.disabled=!1,this.btn_get.label=u.TextConst.get(200))):n.status==h.enumStatus.kelingqu?(this.btn_get.disabled=!1,this.btn_get.label=u.TextConst.get(231),r=this.btn_get.visible=!0):(this.btn_get.visible=!1,this.icon_state.visible=!0),r?(this.ani||(this.ani=p.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_get.getChildIndex(this.ani)&&p.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_get),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_get.getChildIndex(this.ani)&&this.btn_get.removeChild(this.ani))}}},t}(ui.activity.item.PetCamivalItemUI);e.PetCamivalItem=i}),define("src/g/activity/view/pages/PetCamivalPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/GameSocketManager","../../../net/messages/OpResultGS2C","../../../net/messages/OpResultType","../../../../config/GameConfig","../../../../manager/RoleCenter","src/g/activity/view/item/PetCamivalItem","../../../net/messages/enumStatus","src/g/activity/view/ActivityBoxGetDlg","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","../../../../component/GAnimation","../../../../utils/MathUtils","../../../../utils/ItemUtils"],function(t,e,i,n,s,o,a,r,c,u,l,p,h,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t._actUidArr=[],t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged(),this.updateMenu()):i.ClearResM.resetViewImg(this),this.refresh(),this.tab_btns.selectedIndex=0,this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_RED_UPDATE,this,this.onActRedChanged),o.GSM.ins.on(a.OpResultGS2C.KEY,this,this.onOpResult),this.x=(e.width-this.width)/2,e.addChild(this)},t.prototype.onOpResult=function(t){t.msgidx==r.enumOpResultType.activity_nextDay&&this.updateMenu()},t.prototype.refresh=function(){this._ani&&(this._ani.clear(),this._ani.load("dynamic2/zhiwawa/pet/1201.json"))},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.off(s.EventName.ACTIVITY_RED_UPDATE,this,this.onActRedChanged),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/pet_camival/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._boxActUid?this.updateBoxChanged():e==this._selectActUid?this.updateListMain():e==this._activityId&&this.updateMenu()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_main.scrollBar.elasticDistance=100,this.list_main.itemRender=l.PetCamivalItem,this.tab_btns.selectHandler=new Laya.Handler(this,this.onSelectTabHandler),this.list_main.renderHandler=new Laya.Handler(this,this.onListRenderHandler)},t.prototype.onSelectTabHandler=function(t){this._selectActUid=this._actUidArr[t],this.updateListMain()},t.prototype.updateUnchanged=function(){this._ani||(this._ani=new v.GAnimation,this._ani.scaleX=-1),this._ani.load("dynamic2/zhiwawa/pet/1201.json"),this.m_con.addChild(this._ani)},t.prototype.onActRedChanged=function(t){if(t==this._activityId)this.updateBoxChanged();else{var e=this._actUidArr.indexOf(t);if(-1!=e){var i=u.RoleCenter.instans.vo.getActivity1Data(t),n=this.tab_btns.getChildByName("item"+e);if(n){var s=n.getChildByName("img_red");s&&(s.visible=!1,i&&i.hasRed&&(s.visible=!0))}}}},t.prototype.updateMenu=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)for(var e,i,n=t.children.length,s=0,o=g.DateUtil.getDayFromStartTime(t.startTime,d.ServerTime.ACTIVITY_TIME_OFFSET);s<n;){e=t.children[s];var a=c.GameConfig.subActivityJson[e.cfgId].childId;0==a?(this._boxActUid=e.childCountArr[0],this.initBox(),this.updateBoxChanged()):(this._actUidArr[a-1]=e.childCountArr[0],(i=this.tab_btns.getChildByName("item"+(a-1)))&&(i.disabled=o<a)),s++}},t.prototype.childSortFun=function(t,e){var i=c.GameConfig.subActivityJson[t.cfgId],n=c.GameConfig.subActivityJson[e.cfgId];return i.childId-n.childId},t.prototype.initBox=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._boxActUid);if(t){var e,i,n,s=t.children.length,o=0;for(this._progressArr=[0];o<5;){if(o<s&&(e=t.children[o],i=c.GameConfig.subActivityJson[e.cfgId],this._progressArr.push(i.value),i)){var a=0;1<i.bonus.length?(n=i.bonus[1][0],a=i.bonus[1][1]):0<i.bonus.length&&(n=i.bonus[0][0],a=i.bonus[0][1]);var r=y.ItemUtils.getItemOrEq(n);r&&(5!=i.childId&&(this["img_item"+i.childId].skin=y.ItemUtils.getIconByIconId(r.icon)),1<a?this["txt_boxnum"+i.childId].changeText(a.toString()):this["txt_boxnum"+i.childId].changeText(""))}o++}}},t.prototype.updateBoxChanged=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._boxActUid);if(t){var e=t.children.concat();e.sort(this.childSortFun);for(var i,n,s,o,a=e.length,r=0,l=0;r<5;)r<a&&(i=e[r],l=(n=c.GameConfig.subActivityJson[i.cfgId]).value>l?n.value:l,this["lab_title"+n.childId].changeText(n.value.toString()),(s=this["img_item"+n.childId]).offAll(),s.on(Laya.Event.CLICK,this,this.onClickBoxHandler,[i]),(o=this["effect"+n.childId]).visible=!1,this["img_complt"+n.childId].visible=!1,i.status==p.enumStatus.yilingqu?this["img_complt"+n.childId].visible=!0:i.status==p.enumStatus.kelingqu&&(o.visible=!0)),r++;var h=Math.min(l,t.allData.allCount);this._progressArr&&(this.progress_bar.scaleX=f.MathUtils.sectionProgress(this._progressArr,h)),this.txt_hyd_total.changeText(h.toString())}},t.prototype.onClickBoxHandler=function(t){0<this._boxActUid&&(this._boxRewardDlg||(this._boxRewardDlg=new h.ActivityBoxGetDlg),this._boxRewardDlg.showBox(t,this._boxActUid))},t.prototype.updateListMain=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._selectActUid);if(t){for(var e=[],i=t.children.length,n=0;n<i;)e.push(n),n++;e.sort(this.mainListSortFun.bind(this)),this.list_main.array=e}},t.prototype.mainListSortFun=function(t,e){var i=u.RoleCenter.instans.vo.getActivity1Data(this._selectActUid),n=i.children[t],s=i.children[e],o=c.GameConfig.subActivityJson[n.cfgId],a=c.GameConfig.subActivityJson[s.cfgId],r=o?o.childId+100:100,l=a?a.childId+100:100;return n.status==p.enumStatus.kelingqu?r-=100:n.status==p.enumStatus.yilingqu&&(r+=100),s.status==p.enumStatus.kelingqu?l-=100:s.status==p.enumStatus.yilingqu&&(l+=100),r-l},t.prototype.onListRenderHandler=function(t,e){t.setData(this._selectActUid,t.dataSource)},t.prototype.cooldownHandler=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-d.ServerTime.serverTime;0<=e?(this.clip_time.value=g.DateUtil.getHMS_countdown(e),Laya.timer.once(1e3,this,this.cooldownHandler)):this.clip_time.value="00:00:00"}},t}(ui.activity.pages.PetCamivalUI);e.PetCamivalPage=m}),define("src/g/activity/view/item/EggFrenzyItem",["require","exports","../../../../manager/RoleCenter","../../../net/messages/enumStatus","../../../../manager/AM","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../config/GameConfig","src/g/Effects/UIEffectsFactory","src/init/TextConst","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips"],function(t,e,l,h,n,s,o,c,u,p,i,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.getHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t.htxt_count.style.color="#e3cca9",t.htxt_count.style.font="SimHei",t.htxt_count.style.fontSize=18,t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];a.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.getHandler=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex];if(e&&e.status==h.enumStatus.kelingqu){if(!l.RoleCenter.instans.bagRoomEnough())return void n.AM.showBagNotEnough();var i=new s.ActivityGetC2GS;i.id=this._activityId,i.activity2CfgId=e.cfgId,o.GSM.sendServer(i)}}},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e;var i=l.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=c.GameConfig.subActivityJson[n.cfgId],o=!1;this.btn_get.disabled=!0,this.icon_state.visible=!1,n.status==h.enumStatus.kelingqu?(this.btn_get.disabled=!1,o=this.btn_get.visible=!0):n.status==h.enumStatus.yilingqu&&(this.icon_state.visible=!0,this.btn_get.visible=!1);var a=Math.min(n.count,s.value2),r=n.count<s.value2?"#f41d2d":"#e3cca9";this.htxt_count.innerHTML=p.TextConst.get(989,r,a,s.value2),o?(this.ani||(this.ani=u.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_get.getChildIndex(this.ani)&&u.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_get),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_get.getChildIndex(this.ani)&&this.btn_get.removeChild(this.ani)),this.list_item.array=s.bonus}}},t}(ui.activity.item.EggFrenzyItemUI);e.EggFrenzyItem=r}),define("src/g/activity/view/pages/EggFrenzyPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","src/init/TextConst","../../../../utils/ItemUtils","../../../../meta/QualiyVo","src/g/activity/view/item/EggFrenzyItem","../../../../config/GameConfig","../../../net/messages/enumStatus","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../manager/GameSocketManager","src/init/Switches","../../../net/messages/activity/ActivityTrigger","../../../../manager/AM","src/g/account/ctrl/GetRewwardCtrl","../../../../manager/StateManger","src/g/activity/view/alerts/ActivityBuyAlert"],function(t,e,i,n,s,r,o,a,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var w=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.refreshCost=0,t.cost=0,t.isNew=!0,t.remain=8,t.needRefresh=!1,t._des=new laya.html.dom.HTMLDivElement,t._des.width=t.con_log.width=t.con_panel.width,t._des.style.font="SimHei",t._des.style.color="#e3cca9",t._des.style.fontSize=20,t._des.style.leading=8,t.con_log.addChild(t._des),t.con_panel.vScrollBar.elasticDistance=100,t.btn_return.on(Laya.Event.CLICK,t,t.toEgg),t.btn_getReward.on(Laya.Event.CLICK,t,t.toGetReward),t.list_main.itemRender=u.EggFrenzyItem,t.list_main.scrollBar.elasticDistance=100,t.list_main.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t.list_show.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_show.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t.btn_refresh.on(Laya.Event.CLICK,t,t.onRefreshHandler),t.btn_start.on(Laya.Event.CLICK,t,t.onBtnStartClickHandler),t.list_reward.renderHandler=new Laya.Handler(t,t.onRewardRenderHandler),t.list_reward.mouseHandler=new Laya.Handler(t,t.onRewardMouseHandler),t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,this,this.onUpdateLogHandler),f.GSM.ins.on(m.OpenEggGS2C.KEY,this,this.onOpenEggBack),f.GSM.ins.on(m.ActivityRewardGS2C.KEY,this,this.onIdentifyGemBack),n.E.ins.on(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.toEgg(),this.initLogInfo(),this.refresh(),this.cooldownHandler(),this.x=(e.width-this.width)/2,e.addChild(this)},t.prototype.onTimeSpanHandler=function(t){var e=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.refresh=function(){this.list_main.refresh(),this.updateProgress(),this.updateEggShow(),this.updateRefresh(),this.updateRefreshTime()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.off(s.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,this,this.onUpdateLogHandler),f.GSM.ins.off(m.OpenEggGS2C.KEY,this,this.onOpenEggBack),f.GSM.ins.off(m.ActivityRewardGS2C.KEY,this,this.onIdentifyGemBack),n.E.ins.off(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/egg_frenzy/"),Laya.timer.clear(this,this.cooldownHandler),this.needRefresh=!1},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.onRenderHandler=function(t,e){g.ItemCellUtils.fillCellForItem0View(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_show.array[e];v.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.onRewardRenderHandler=function(t,e){g.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onRewardMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_reward.array[e];v.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.updateUnchanged=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){this._childIndexArr=[];var e=p.GameConfig.activityJson[t.cfgId];if(e){this.list_show.array=e.showList;for(var i,n,s=t.children.length,o=0;o<s;)i=t.children[o],(n=p.GameConfig.subActivityJson[i.cfgId])&&(1==n.childId?(this.refreshCost=n.originalcost[0][1],this.cost=n.cost[0][1],this.lab_cost.changeText(this.cost.toString()),this.lab_refresh_cost.changeText(this.refreshCost.toString())):100<n.childId&&this._childIndexArr.push(o)),o++}(!t.rewardPool||t.rewardPool.length<=0)&&this.onRefreshHandler()}this.list_main.array=this._childIndexArr},t.prototype.onRefreshHandler=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=0;if(!t.rewardPool||t.rewardPool.length<=0||0==t.allData.time||t.allData.time<o.ServerTime.serverTime||(e=this.refreshCost),r.RoleCenter.instans.vo.GOLD<e)return void y.Switches.ins.event(155);var i=new m.RefreshRewardPoolC2GS;i.id=this._activityId,f.GSM.sendServer(i)}},t.prototype.updateEggShow=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){for(var e,i=t.rewardPool.length,n=0;n<8;)this["img_egg"+n].offAll(),this["img_egg"+n].skin="res/activity/egg_frenzy/zajindan_jindan.png",this["img_egg"+n].on(Laya.Event.CLICK,this,this.onEggClickHandler,[n+1]),n++;n=0,this.isNew=!0;var s=[];for(this.remain=8;n<i;)e=t.rewardPool[n],s.push([e.id,e.num]),0<e.index&&(this.isNew=!1,this["img_egg"+(e.index-1)].offAll(),this["img_egg"+(e.index-1)].skin="res/activity/egg_frenzy/zajindan_jindanzakai.png",this.remain--),n++;this.list_reward.array=s,this.list_reward.visible=this.isNew,this.egg_layer.visible=!this.isNew,this.btn_start.label=this.isNew?"开始砸蛋":"全部砸开",this.lab_need2.visible=this.img_gold2.visible=this.lab_cost.visible=!this.isNew&&0<this.remain,this.lab_cost.changeText((this.remain*this.cost).toString()),this.btn_start.disabled=!this.isNew&&this.remain<=0}},t.prototype.onEggClickHandler=function(t){var e=this;I.StateManger.showEggFrenzyBuyAlert?(this._buyAlert||(this._buyAlert=new b.ActivityBuyAlert),this._buyAlert.showAlert(l.TextConst.get(991,this.cost),Laya.Handler.create(this,function(){I.StateManger.showEggFrenzyBuyAlert=!e._buyAlert.check_select.visible,e.doBuyOne(t)}))):this.doBuyOne(t)},t.prototype.doBuyOne=function(t){if(r.RoleCenter.instans.vo.GOLD<this.cost)y.Switches.ins.event(155);else{var e=new m.OpenEggC2GS;e.id=this._activityId,e.isAll=!1,e.index=t,f.GSM.sendServer(e)}},t.prototype.onBtnStartClickHandler=function(){this.isNew?(this.isNew=!1,this.list_reward.visible=this.isNew,this.egg_layer.visible=!this.isNew,this.btn_start.label=this.isNew?"开始砸蛋":"全部砸开",this.lab_need2.visible=this.img_gold2.visible=this.lab_cost.visible=!this.isNew):this.onOpenAllHandler()},t.prototype.onOpenAllHandler=function(){var t=this;I.StateManger.showEggFrenzyBuyAlert?(this._buyAlert||(this._buyAlert=new b.ActivityBuyAlert),this._buyAlert.showAlert(l.TextConst.get(992,this.cost*this.remain),Laya.Handler.create(this,function(){I.StateManger.showEggFrenzyBuyAlert=!t._buyAlert.check_select.visible,t.doBuyAll()}))):this.doBuyAll()},t.prototype.doBuyAll=function(){if(r.RoleCenter.instans.vo.GOLD<this.cost*this.remain)y.Switches.ins.event(155);else{var t=new m.OpenEggC2GS;t.id=this._activityId,t.isAll=!0,f.GSM.sendServer(t)}},t.prototype.updateRefreshTime=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.allData.time-o.ServerTime.serverTime;0<=e?(this.lab_refresh_desc.visible=this.lab_refresh_time.visible=!0,this.lab_refresh_time.changeText(a.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.updateRefreshTime)):(this.lab_refresh_desc.visible=this.lab_refresh_time.visible=!1,this.updateRefresh())}},t.prototype.updateRefresh=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);t&&(this.lab_need1.visible=this.img_gold1.visible=this.lab_refresh_cost.visible=t.allData.time>o.ServerTime.serverTime,this.lab_free.visible=!this.lab_refresh_cost.visible)},t.prototype.updateProgress=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t&&p.GameConfig.activityJson[t.cfgId]){for(var e,i,n=t.children.length,s=0,o=999999,a=0;s<n;)e=t.children[s],(i=p.GameConfig.subActivityJson[e.cfgId])&&100<i.childId&&e.status!=d.enumStatus.yilingqu&&i.value2<o&&(o=i.value2,a=e.count/o),s++;a=Math.min(1,a),this.img_progress.scaleX=a,this.sp_effect.visible=1==a}},t.prototype.onListRenderHandler=function(t,e){t.setData(this._activityId,this.list_main.array[e])},t.prototype.toEgg=function(){this.box_egg.visible=!0,this.list_main.visible=!1,this.box_progress.visible=!0,this.btn_return.visible=!1},t.prototype.toGetReward=function(){this.box_egg.visible=!1,this.list_main.visible=!0,this.box_progress.visible=!1,this.btn_return.visible=!0},t.prototype.initLogInfo=function(){var t=new m.getRewardInfoRecordC2GS;t.id=this._activityId,f.GSM.sendServer(t)},t.prototype.onUpdateLogHandler=function(t){t.id==this._activityId&&this.appendLog(t)},t.prototype.appendLog=function(t){0==t.type&&(this._des.innerHTML="");for(var e=t.personInfoArr,i=(e?e.length:0)-1;0<=i;)this.appendAllLog(e[i-2],e[i-1],Number(e[i])),i-=3},t.prototype.appendAllLog=function(t,e,i){var n=l.TextConst.get(226),s="#b8b8b8",o=h.ItemUtils.getItemOrEq(e);o&&(n=o.name,s=c.QualityStruct.Ins.getQColorById(o.quality));var a=l.TextConst.get(275,t,s,n,i)+"<br>";this._des.appendHTML(a),this.con_log.height=this._des.contextHeight+20,this.con_panel.vScrollBar.value=this.con_panel.vScrollBar.max},t.prototype.cooldownHandler=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-o.ServerTime.serverTime;86400<e?(this.lab_time.changeText(a.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(a.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t.prototype.onOpenEggBack=function(t){(t.rewardIndex<0||7==t.rewardIndex)&&(this.needRefresh=!0),(t.rewardIndex<0||7==t.rewardIndex||6==t.rewardIndex)&&this.initLogInfo()},t.prototype.onIdentifyGemBack=function(t){var e=this;Laya.timer.frameOnce(2,this,function(){C.GetRewwardCtrl.inventoryAddGS2C(t.inv,new Laya.Handler(e,e.askRefresh))})},t.prototype.askRefresh=function(){var t=this;if(this.needRefresh){this.needRefresh=!1;var e=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=0;!e.rewardPool||e.rewardPool.length<=0||0==e.allData.time||e.allData.time<o.ServerTime.serverTime||(i=this.refreshCost)}_.AM.show(l.TextConst.get(990,i),new Laya.Handler(this,function(){t.onRefreshHandler()}))}},t}(ui.activity.pages.EggFrenzyUI);e.EggFrenzyPage=w}),define("src/g/activity/view/item/LuckyBagItem",["require","exports","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../net/messages/enumStatus"],function(t,e,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.htxt_progress.style.color="#fff1db",t.htxt_progress.style.font="SimHei",t.htxt_progress.style.fontSize=18,t.htxt_progress.style.align="center",t}return __extends(t,e),t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e,this.refresh()},t.prototype.refresh=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex];if(e){var i=r.GameConfig.subActivityJson[e.cfgId];if(i){this.img_icon.skin="res/activity/lucky_bag/xyfd_fudai_00"+i.image+".png";var n=i.value2,s=e.count;n<s&&(s=n);var o=s<n?"#f41d2d":"#fff1db";this.htxt_progress.innerHTML="<font color='"+o+"'>"+s+"</font>/"+n,this.effect.visible=!1,this.img_complt.visible=!1,e.status==l.enumStatus.yilingqu?this.img_complt.visible=!0:e.status==l.enumStatus.kelingqu&&(this.effect.visible=!0)}}}},t}(ui.activity.item.LuckyBagItemUI);e.LuckyBagItem=i}),define("src/g/activity/view/pages/LuckyBagPage",["require","exports","../../../../manager/RoleCenter","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../config/GameConfig","src/g/activity/view/ActivityBoxGetDlg","src/g/activity/view/item/LuckyBagItem","../../../../utils/MathUtils","../../../net/messages/activity/ActivityTrigger","../../../../manager/GameSocketManager","src/init/Switches","src/g/activity/view/alerts/ActivityBuyAlert","../../../../manager/StateManger","src/init/TextConst"],function(t,e,l,i,n,s,o,a,r,h,c,u,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t.cost=0,t.maxNeed=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):s.ClearResM.resetViewImg(this),this.refresh(),this.cooldownHandler(),o.E.ins.on(a.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this)},t.prototype.refresh=function(){this.updateBox(),this.updateProgress()},t.prototype.hidePage=function(){o.E.ins.off(a.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),s.ClearResM.clearFolderByUrl("dynamic/activity/lucky_bag/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.htxt_desc.style.color="#3cca9",this.htxt_desc.style.font="SimHei",this.htxt_desc.style.fontSize=18,this.list_show.renderHandler=new Laya.Handler(this,this.onRenderHandler),this.list_show.mouseHandler=new Laya.Handler(this,this.onMouseHandler),this.btn_buy.on(Laya.Event.CLICK,this,this.onBtnClickHandler,[1]),this.btn_buy10.on(Laya.Event.CLICK,this,this.onBtnClickHandler,[10])},t.prototype.onBtnClickHandler=function(t){var e=this;m.StateManger.showLuckyBagBuyAlert?(this._buyAlert||(this._buyAlert=new y.ActivityBuyAlert),this._buyAlert.showAlert(_.TextConst.get(993,this.cost,t),Laya.Handler.create(this,function(){m.StateManger.showLuckyBagBuyAlert=!e._buyAlert.check_select.visible,e.onBuyHandler(t)}))):this.onBuyHandler(t)},t.prototype.onBuyHandler=function(t){if(l.RoleCenter.instans.vo.GOLD<this.cost*t)f.Switches.ins.event(155);else{var e=new g.buyWelfarePocketC2GS;e.id=this._activityId,e.time=t,v.GSM.sendServer(e)}},t.prototype.onRenderHandler=function(t,e){r.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_show.array[e];h.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.updateUnchanged=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=c.GameConfig.activityJson[t.cfgId];if(e){this.img_title.skin="dynamic/activity/lucky_bag/"+e.bg_img+".png",this.htxt_desc.innerHTML=e.desc?e.desc:"",this._childIndexArr=[],this.list_show.array=e.showList;for(var i,n,s=t.children.length,o=0;o<s;)i=t.children[o],(n=c.GameConfig.subActivityJson[i.cfgId])&&(1==n.childId?(this.cost=n.cost[0][1],this.lab_cost.changeText(this.cost.toString()),this.lab_cost10.changeText((10*this.cost).toString())):100<n.childId&&this._childIndexArr.push(o)),o++;this._childIndexArr.sort(this.childSortFun.bind(this)),this.creartBox()}}},t.prototype.creartBox=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){this.boxList=[],this._progressArr=[0];var e=this._childIndexArr.length;this.img_progress_bg.width=this.img_progress.width=100*(e-1);for(var i,n,s,o=68,a=0,r=0;a<e;)r=this._childIndexArr[a],n=t.children[r],s=c.GameConfig.subActivityJson[n.cfgId],this._progressArr.push(s.value2),this.maxNeed=Math.max(this.maxNeed,s.value2),o=(i=new p.LuckyBagItem).width,i.x=100*a,i.setData(this._activityId,r),i.on(Laya.Event.CLICK,this,this.onClickBoxHandler,[n]),this.con_btn.addChild(i),this.boxList.push(i),a++;this.con_btn.width=this.img_progress.width+o,this.con_btn.width<this.con_panel.width?this.con_btn.x=(this.con_panel.width-this.con_btn.width)/2:this.con_btn.x=0,this.img_progress_bg.x=this.img_progress.x=o/2}},t.prototype.updateProgress=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=Math.min(this.maxNeed,t.allData.allCount);this._progressArr&&(this.img_progress.scaleX=d.MathUtils.sectionProgress(this._progressArr,e))}},t.prototype.updateBox=function(){if(this.boxList)for(var t=this.boxList.length,e=0;e<t;)this.boxList[e].refresh(),e++},t.prototype.onClickBoxHandler=function(t){this._boxRewardDlg||(this._boxRewardDlg=new u.ActivityBoxGetDlg),this._boxRewardDlg.showBox(t,this._activityId)},t.prototype.childSortFun=function(t,e){var i=l.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=c.GameConfig.subActivityJson[i.children[t].cfgId],s=c.GameConfig.subActivityJson[i.children[e].cfgId];return n.value2-s.value2},t.prototype.cooldownHandler=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-i.ServerTime.serverTime;86400<e?(this.lab_time.changeText(n.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(n.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t}(ui.activity.pages.LuckyBagUI);e.LuckyBagPage=C}),define("src/g/activity/view/item/CommonTaskItem",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../manager/RoleCenter","../../../../manager/AM","../../../net/messages/activity/ActivityGet","../../../net/messages/enumStatus","../../../../manager/GameSocketManager","../../../../config/GameConfig","src/init/TextConst","src/g/Effects/UIEffectsFactory","../../../../utils/UIUtils","../../../../meta/MainButtonVo"],function(t,e,i,n,a,s,o,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(e){function t(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.getHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),p.UIUtils.initHtmlDiv(t.htxt_desc),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.getHandler=function(){if(a.RoleCenter.instans.bagRoomEnough()){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex];if(e&&e.status==r.enumStatus.kelingqu){var i=new o.ActivityGetC2GS;i.id=this._activityId,i.activity2CfgId=e.cfgId,l.GSM.sendServer(i)}else if(e.status==r.enumStatus.weiwancheng){var n=h.GameConfig.subActivityJson[e.cfgId];d.MainButtonStruct.Ins.OpenModule(n.moduleID[0][1],n.moduleID[1][1])}}}else s.AM.showBagNotEnough()},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e;var i=a.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=h.GameConfig.subActivityJson[n.cfgId],o=this.img_got.visible=!1;n.status==r.enumStatus.weiwancheng?(this.btn_get.visible=!0,s.moduleID&&0<s.moduleID.length?(this.btn_get.disabled=!1,this.btn_get.label=c.TextConst.get(200)):(this.btn_get.disabled=!0,this.btn_get.label=c.TextConst.get(210))):n.status==r.enumStatus.kelingqu?(this.btn_get.disabled=!1,this.btn_get.label=c.TextConst.get(216),o=this.btn_get.visible=!0):(this.btn_get.visible=!1,this.img_got.visible=!0),this.htxt_desc.innerHTML=""+s.title+p.UIUtils.getHtmlText("("+Math.min(n.count,s.value2)+"/"+s.value2+")",n.status==r.enumStatus.weiwancheng?"#ff0f15":"#09d51f"),o?(this.ani||(this.ani=u.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_get.getChildIndex(this.ani)&&u.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_get),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_get.getChildIndex(this.ani)&&this.btn_get.removeChild(this.ani)),this.list_item.array=s.bonus}}},t}(ui.activity.item.Common_Task_ItemUI);e.CommonTaskItem=g}),define("src/g/activity/view/pages/CommonTaskPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/ItemUtils","src/g/bag/tips/view/ItemTips","../../../net/messages/enumStatus","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","src/g/activity/view/item/CommonTaskItem"],function(t,e,i,n,s,h,c,o,a,u,r,l,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.refresh(),this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),e.addChild(this)},t.prototype.onTimeSpanHandler=function(t){var e=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.refresh=function(){this.updateListData();var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);t&&this.lab_count.changeText(t.allData.allCount.toString())},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.off(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/common_task/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_main.scrollBar.elasticDistance=100,this.list_main.itemRender=p.CommonTaskItem,this.list_main.renderHandler=new Laya.Handler(this,this.renderHandler)},t.prototype.updateUnchanged=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=c.GameConfig.activityJson[t.cfgId],i=parseInt(e.value);o.ItemUtils.getItemVoById(i)&&(this.img_currency.skin=o.ItemUtils.getIconById(i),this.lab_count.changeText(t.allData.allCount.toString()),this.lab_desc.changeText(e.desc),this.img_currency.on(Laya.Event.CLICK,this,function(){a.ItemTips.ins.showTip(i,1)})),this.title_img.skin="dynamic/activity/common_task/"+e.bg_img+".png"}else console.log("没有找到数据，类型：common_task")},t.prototype.updateListData=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){this._childIndexArr=[];for(var e,i=0,n=t.children.length,s=0,o=0,a=!1,r=0;s<n;)(e=c.GameConfig.subActivityJson[t.children[s].cfgId])&&((r=e.value)!=i&&(!a&&0<o&&this._childIndexArr.push(o),a=!1,i=r),a||t.children[s].status!=u.enumStatus.yilingqu&&(this._childIndexArr.push(s),a=!0)),o=s,s++;this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_main.array=this._childIndexArr}},t.prototype.childSortFun=function(t,e){var i=h.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=i.children[t],s=i.children[e],o=c.GameConfig.subActivityJson[n.cfgId],a=c.GameConfig.subActivityJson[s.cfgId],r=o?o.childId+1e3:1e3,l=a?a.childId+1e3:1e3;return n.status==u.enumStatus.kelingqu?r-=1e3:n.status==u.enumStatus.yilingqu&&(r+=1e3),s.status==u.enumStatus.kelingqu?l-=1e3:s.status==u.enumStatus.yilingqu&&(l+=1e3),r-l},t.prototype.renderHandler=function(t,e){t.setData(this._activityId,this.list_main.array[e])},t.prototype.cooldownHandler=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.endTime-r.ServerTime.serverTime;86400<e?(this.lab_time.changeText(l.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(l.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t}(ui.activity.pages.Common_TaskUI);e.CommonTaskPage=d}),define("src/g/activity/view/item/CommonExchangeItem",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../manager/RoleCenter","../../../../manager/AM","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../config/GameConfig","src/init/TextConst","src/g/Effects/UIEffectsFactory","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../utils/ItemUtils"],function(t,e,i,n,h,c,u,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t._lastBuyTime=0,t.btn_buy.on(Laya.Event.CLICK,t,t.onBuyHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.onBuyHandler=function(){if(Date.now()-this._lastBuyTime<1e3)f.FE.upItems(g.TextConst.get(258),y.BubbleEnum.center);else if(h.RoleCenter.instans.bagRoomEnough()){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex],i=d.GameConfig.subActivityJson[e.cfgId];if(i){if(0<i.value2&&i.value2-e.count<=0)return void f.FE.upItems(g.TextConst.get(218),y.BubbleEnum.center);if(0<i.viplevel&&h.RoleCenter.instans.vo.VIP<i.viplevel)return void f.FE.upItems(g.TextConst.get(219),y.BubbleEnum.center);if(i.value){var n=h.RoleCenter.instans.vo.getActivity1DataByCfgId(i.value);if(n&&n.allData.allCount<i.cost[0][1])return void f.FE.upItems(g.TextConst.get(370),y.BubbleEnum.center)}else for(var s=i.cost.length,o=0,a=0,r=0;o<s;){if(a=i.cost[o][0],r=i.cost[o][1],h.RoleCenter.instans.vo.bagdata.getItemCount(a)<r)return void f.FE.upItems(g.TextConst.get(370),y.BubbleEnum.center);o++}this._lastBuyTime=Date.now();var l=new u.ActivityGetC2GS;l.id=this._activityId,l.activity2CfgId=e.cfgId,p.GSM.sendServer(l)}}}else c.AM.showBagNotEnough()},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e;var i=h.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=d.GameConfig.subActivityJson[n.cfgId],o=s.value2,a=s.value2-n.count;this.lab_count.color=0<a?"#03bb00":"#ff0f15",this.lab_count.changeText(a+"/"+o),this.btn_buy.label=s.cost[0][1];var r=m.ItemUtils.getItemVoById(s.cost[0][0]);this.img_cost.skin=m.ItemUtils.getIconByIconId(r.icon);var l=!(this.lab_title.visible=!1);0<o&&a<=0&&(l=!1),0<s.viplevel&&h.RoleCenter.instans.vo.VIP<s.viplevel&&(l=!1),l?(this.ani||(this.ani=v.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_buy.getChildIndex(this.ani)&&v.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_buy),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_buy.getChildIndex(this.ani)&&this.btn_buy.removeChild(this.ani)),this.list_item.array=s.bonus}}},t}(ui.activity.item.Common_Exchange_ItemUI);e.CommonExchangeItem=s}),define("src/g/activity/view/pages/CommonExchangePage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/ItemUtils","src/g/bag/tips/view/ItemTips","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","src/g/activity/view/item/CommonExchangeItem","../../../../manager/ActivityManager"],function(t,e,i,n,s,h,c,a,r,o,l,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t.relatActCfgId=0,t.exchangeItemId=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.refresh(),0==this.relatActCfgId&&this.exchangeItemId&&n.E.ins.on(s.EventName.CHANGEITEM_COUNT,this,this.onBagItemChanged),this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),e.addChild(this),p.ActivityManager.ins.activityRead(this._activityId)},t.prototype.onTimeSpanHandler=function(t){var e=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.refresh=function(){var t;this.updateListData(),0<this.relatActCfgId?(t=h.RoleCenter.instans.vo.getActivity1DataByCfgId(this.relatActCfgId),this.lab_count.changeText(t.allData.allCount.toString())):0<this.exchangeItemId&&this.lab_count.changeText(h.RoleCenter.instans.vo.bagdata.getItemCount(this.exchangeItemId).toString())},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.off(s.EventName.CHANGEITEM_COUNT,this,this.onBagItemChanged),n.E.ins.off(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/common_exchange/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e!=this._activityId&&t!=this.relatActCfgId||this.refresh()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_main.scrollBar.elasticDistance=100,this.list_main.itemRender=u.CommonExchangeItem,this.list_main.renderHandler=new Laya.Handler(this,this.renderHandler)},t.prototype.updateUnchanged=function(){var t=this,e=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=c.GameConfig.activityJson[e.cfgId];this.lab_desc.changeText(i.desc),this.exchangeItemId=parseInt(i.value),a.ItemUtils.getItemVoById(this.exchangeItemId)&&(this.img_currency.skin=a.ItemUtils.getIconById(this.exchangeItemId),this.lab_count.changeText(e.allData.allCount.toString()),this.img_currency.on(Laya.Event.CLICK,this,function(){r.ItemTips.ins.showTip(t.exchangeItemId,1)}));var n=c.GameConfig.subActivityJson[e.children[0].cfgId];n&&n.value&&(this.relatActCfgId=n.value),this.title_img.skin="dynamic/activity/common_exchange/"+i.bg_img+".png",this._childIndexArr=[];for(var s=e.children.length,o=0;o<s;)this._childIndexArr.push(o),o++}else console.log("没有找到数据，类型：common_exchange")},t.prototype.onBagItemChanged=function(t){0<this.exchangeItemId&&t==this.exchangeItemId&&this.refresh()},t.prototype.updateListData=function(){this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_main.array=this._childIndexArr},t.prototype.childSortFun=function(t,e){var i=h.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=i.children[t],s=i.children[e],o=c.GameConfig.subActivityJson[n.cfgId],a=c.GameConfig.subActivityJson[s.cfgId],r=o?o.childId+1e3:1e3,l=a?a.childId+1e3:1e3;return 0<o.value2-n.count?r-=1e3:r+=1e3,0<a.value2-s.count?l-=1e3:l+=1e3,r-l},t.prototype.renderHandler=function(t,e){t.setData(this._activityId,this.list_main.array[e])},t.prototype.cooldownHandler=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.endTime-o.ServerTime.serverTime;86400<e?(this.lab_time.changeText(l.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(l.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t}(ui.activity.pages.Common_ExchangeUI);e.CommonExchangePage=d}),define("src/g/activity/view/item/CommonExchange2Item",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../manager/RoleCenter","../../../../manager/AM","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../config/GameConfig","src/init/TextConst","src/g/Effects/UIEffectsFactory","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip"],function(t,e,_,C,I,h,c,u,b,p,w,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t._lastBuyTime=0,t.btn_buy.on(Laya.Event.CLICK,t,t.onBuyHandler),t}return __extends(t,e),t.prototype.onBuyHandler=function(){if(Date.now()-this._lastBuyTime<1e3)d.FE.upItems(p.TextConst.get(258),g.BubbleEnum.center);else if(I.RoleCenter.instans.bagRoomEnough()){var t=I.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex],i=b.GameConfig.subActivityJson[e.cfgId];if(i){if(0<i.value2&&i.value2-e.count<=0)return void d.FE.upItems(p.TextConst.get(218),g.BubbleEnum.center);if(0<i.viplevel&&I.RoleCenter.instans.vo.VIP<i.viplevel)return void d.FE.upItems(p.TextConst.get(219),g.BubbleEnum.center);if(i.value){var n=I.RoleCenter.instans.vo.getActivity1DataByCfgId(i.value);if(n&&n.allData.allCount<i.cost[0][1])return void d.FE.upItems(p.TextConst.get(370),g.BubbleEnum.center)}else for(var s=i.cost.length,o=0,a=0,r=0;o<s;){if(a=i.cost[o][0],r=i.cost[o][1],I.RoleCenter.instans.vo.bagdata.getItemCount(a)<r)return void d.FE.upItems(p.TextConst.get(370),g.BubbleEnum.center);o++}this._lastBuyTime=Date.now();var l=new c.ActivityGetC2GS;l.id=this._activityId,l.activity2CfgId=e.cfgId,u.GSM.sendServer(l)}}}else h.AM.showBagNotEnough()},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e;var i=I.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=b.GameConfig.subActivityJson[n.cfgId],o=s.value2,a=s.value2-n.count;this.lab_count.color=0<a?"#03bb00":"#ff0f15",this.lab_count.changeText(a+"/"+o);var r=s.bonus[0][0],l=Number(s.bonus[0][1]);if(_.ItemCellUtils.fillCellForItemNameView(this.item,r,l),this.item.offAll(),this.item.on(Laya.Event.CLICK,this,function(t,e){C.ItemTips.ins.showTip(t,e)},[r,l]),s.value){var h=I.RoleCenter.instans.vo.getActivity1DataByCfgId(s.value);if(h){var c=s.cost[0][0],u=Number(s.cost[0][1]);_.ItemCellUtils.fillCellForItem0View(this.item0,c,u),this.item0.offAll(),this.item0.on(Laya.Event.CLICK,this,function(t,e){C.ItemTips.ins.showTip(t,e)},[c,u]),this.item0.visible=this.lab_count0.visible=!0,this.lab_count0.color=h.allData.allCount>=u?"#03bb00":"#ff0f15",this.lab_count0.changeText("("+h.allData.allCount+"/"+u+")");for(var p=1;p<4;p++)this["item"+p].visible=this["lab_count"+p].visible=this["img_add"+p].visible=!1}}else for(var d,g=s.cost.length,v=(p=0,0),f=0,y=!1;p<4;)y=!1,d=this["item"+p],p<g&&(v=s.cost[p][0],f=s.cost[p][1],y=!0,_.ItemCellUtils.fillCellForItem0View(d,v,f),d.offAll(),d.on(Laya.Event.CLICK,this,function(t,e){C.ItemTips.ins.showTip(t,e)},[v,f]),this["lab_count"+p].color=I.RoleCenter.instans.vo.bagdata.getItemCount(v)>=f?"#03bb00":"#ff0f15",this["lab_count"+p].changeText("("+I.RoleCenter.instans.vo.bagdata.getItemCount(v)+"/"+f+")")),this["item"+p].visible=this["lab_count"+p].visible=y,0!=p&&(this["img_add"+p].visible=y),p++;var m=!0;0<o&&a<=0&&(m=!1),0<s.viplevel&&I.RoleCenter.instans.vo.VIP<s.viplevel&&(m=!1),m?(this.ani||(this.ani=w.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_buy.getChildIndex(this.ani)&&w.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_buy),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_buy.getChildIndex(this.ani)&&this.btn_buy.removeChild(this.ani))}}},t}(ui.activity.item.Common_Exchage2_ItemUI);e.CommonExchange2Item=i}),define("src/g/activity/view/pages/CommonExchangePage2",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","src/g/activity/view/item/CommonExchange2Item"],function(t,e,i,n,s,h,c,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t.relatActCfgId=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.refresh(),this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),e.addChild(this)},t.prototype.onTimeSpanHandler=function(t){var e=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.refresh=function(){this.updateListData()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.off(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/common_exchange2/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e!=this._activityId&&t!=this.relatActCfgId||this.refresh()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_main.scrollBar.elasticDistance=100,this.list_main.itemRender=r.CommonExchange2Item,this.list_main.renderHandler=new Laya.Handler(this,this.renderHandler)},t.prototype.updateUnchanged=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=c.GameConfig.activityJson[t.cfgId];this.lab_desc.changeText(e.desc);var i=c.GameConfig.subActivityJson[t.children[0].cfgId];i&&i.value&&(this.relatActCfgId=i.value),this.title_img.skin="dynamic/activity/common_exchange2/"+e.bg_img+".png",this._childIndexArr=[];for(var n=t.children.length,s=0;s<n;)this._childIndexArr.push(s),s++}else console.log("没有找到数据，类型：common_exchange2")},t.prototype.updateListData=function(){this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_main.array=this._childIndexArr},t.prototype.childSortFun=function(t,e){var i=h.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=i.children[t],s=i.children[e],o=c.GameConfig.subActivityJson[n.cfgId],a=c.GameConfig.subActivityJson[s.cfgId],r=o?o.childId+1e3:1e3,l=a?a.childId+1e3:1e3;return 0<o.value2-n.count?r-=1e3:r+=1e3,0<a.value2-s.count?l-=1e3:l+=1e3,r-l},t.prototype.renderHandler=function(t,e){t.setData(this._activityId,this.list_main.array[e])},t.prototype.cooldownHandler=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.endTime-o.ServerTime.serverTime;86400<e?(this.lab_time.changeText(a.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(a.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t}(ui.activity.pages.Common_Exchange2UI);e.CommonExchangePage2=l}),define("src/g/activity/view/pages/LoginGiftPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","../../../../config/GameConfig","../../../../utils/ItemUtils","../../../net/messages/enumStatus","src/init/TextConst","../../../../manager/AM","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../meta/MainButtonVo","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","src/g/Effects/UIEffectsFactory"],function(t,e,i,n,s,p,o,a,d,g,h,v,r,l,c,u,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t.maxDay=0,t.selectIndex=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged(),this.initMenu()):i.ClearResM.resetViewImg(this),this.refresh(),this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this)},t.prototype.refresh=function(){this.updateMenu(),this.updateGift(this.selectIndex)},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/login_gift/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_item1.renderHandler=new Laya.Handler(this,this.onRenderHandler),this.list_item1.mouseHandler=new Laya.Handler(this,this.onMouseHandler),this.list_item2.renderHandler=new Laya.Handler(this,this.onRenderHandler),this.list_item2.mouseHandler=new Laya.Handler(this,this.onMouse2Handler)},t.prototype.onRenderHandler=function(t,e){f.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item1.array[e];y.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.onMouse2Handler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item2.array[e];y.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.updateUnchanged=function(){var t=p.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){d.GameConfig.activityJson[t.cfgId];var e,i=t.children.length,n=0;for(this.dayIndexArr=[];n<i;){if((e=d.GameConfig.subActivityJson[t.children[n].cfgId])&&e.childId<100){var s=e.childId%100;-1==this.dayIndexArr.indexOf(n)&&this.dayIndexArr.push(n),s>this.maxDay&&(this.maxDay=s)}n++}}else console.log("没有找到数据，类型：login_gift")},t.prototype.initMenu=function(){var t=p.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e,i=0,n=this.dayIndexArr.length,s=0,o=0;for(this.item_list=[];s<n;){o=this.dayIndexArr[s];var a=(e=d.GameConfig.subActivityJson[t.children[o].cfgId]).childId%100,r=new ui.activity.item.LoginGiftMenuItemUI,l=g.ItemUtils.getItemOrEq(e.bonus[0][0]);r.img_icon.skin=l?g.ItemUtils.getIconByIconId(l.icon):"",r.offAll(),r.lab_name.changeText(v.TextConst.get(59,a)),r.on(Laya.Event.CLICK,this,this.updateGift,[s]),r.width>i&&(i=r.width),this.item_list.push(r),this.box_menu.addChild(r),s++}var h=this.panel_menu.width-i/2-this.img_progerss.x,c=h/4,u=this.item_list.length;for(u<4&&(c=h/u),s=0;s<u;)(r=this.item_list[s]).x=(s+1)*c-i/2,s++;this.img_progerss.width=this.img_progerss_di.width=u*c,this.box_menu.width=this.img_progerss.width+this.img_progerss.x+i/2,this.img_progerss.scaleX=0}},t.prototype.updateMenu=function(){var t=p.RoleCenter.instans.vo.getActivity1Data(this._activityId);t&&(this.img_progerss.scaleX=Math.min(1,t.allData.allCount/this.maxDay))},t.prototype.updateGift=function(t){var e=this.item_list[this.selectIndex];e&&(e.img_select.visible=!1),this.selectIndex=t,(e=this.item_list[this.selectIndex])&&(e.img_select.visible=!0);var i=p.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(i){var n,s,o=this.dayIndexArr[t];s=i.children[o];for(var a=(n=d.GameConfig.subActivityJson[s.cfgId]).childId%100,r=i.children.length,l=0;l<r;){if(s=i.children[l],(n=d.GameConfig.subActivityJson[s.cfgId])&&n.childId%100==a)if(this.clip_gold1.value=this.clip_gold2.value=n.value2.toString(),n.childId<100)this.list_item1.array=n.bonus,this.icon_state1.visible=!1,this.btn_get1.offAll(),this.btn_get1.on(Laya.Event.CLICK,this,this.getHandler,[l]),s.status==h.enumStatus.weiwancheng?(this.btn_get1.visible=!0,this.btn_get1.disabled=!0,this.btn_get1.label=v.TextConst.get(210),n.moduleID&&0<n.moduleID.length&&(this.btn_get1.disabled=!1,this.btn_get1.label=v.TextConst.get(200))):s.status==h.enumStatus.kelingqu?(this.btn_get1.disabled=!1,this.btn_get1.label=v.TextConst.get(216),this.btn_get1.visible=!0):(this.btn_get1.visible=!1,this.icon_state1.visible=!0),s.status==h.enumStatus.kelingqu?(this.ani1||(this.ani1=m.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_get1.getChildIndex(this.ani1)&&m.UIEffectsFactory.Ins.centerSAni4Parent(this.ani1,this.btn_get1),this.ani1.play()):this.ani1&&(this.ani1.stop(),-1!=this.btn_get1.getChildIndex(this.ani1)&&this.btn_get1.removeChild(this.ani1));else{if(this.list_item2.array=n.bonus,this.icon_state2.visible=!1,this.img_guoqi.visible=!1,this.btn_get2.visible=!1,this.btn_get2.offAll(),s.status!=h.enumStatus.kelingqu&&s.status!=h.enumStatus.yilingqu&&i.allData.allCount>a)return void(this.img_guoqi.visible=!0);this.btn_get2.on(Laya.Event.CLICK,this,this.getHandler,[l]),s.status==h.enumStatus.weiwancheng?(this.btn_get2.visible=!0,this.btn_get2.disabled=!0,this.btn_get2.label=v.TextConst.get(210),i.allData.allCount==a&&n.moduleID&&0<n.moduleID.length&&(this.btn_get2.disabled=!1,this.btn_get2.label=v.TextConst.get(200))):s.status==h.enumStatus.kelingqu?(this.btn_get2.disabled=!1,this.btn_get2.label=v.TextConst.get(216),this.btn_get2.visible=!0):(this.btn_get2.visible=!1,this.icon_state2.visible=!0),s.status==h.enumStatus.kelingqu?(this.ani2||(this.ani2=m.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_get2.getChildIndex(this.ani2)&&m.UIEffectsFactory.Ins.centerSAni4Parent(this.ani2,this.btn_get2),this.ani2.play()):this.ani2&&(this.ani2.stop(),-1!=this.btn_get2.getChildIndex(this.ani2)&&this.btn_get2.removeChild(this.ani2))}l++}}},t.prototype.getHandler=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=e.children[t];if(i&&i.status==h.enumStatus.kelingqu){if(!p.RoleCenter.instans.bagRoomEnough())return void r.AM.showBagNotEnough();var n=new l.ActivityGetC2GS;n.id=this._activityId,n.activity2CfgId=i.cfgId,c.GSM.sendServer(n)}else if(i.status==h.enumStatus.weiwancheng){var s=d.GameConfig.subActivityJson[i.cfgId];u.MainButtonStruct.Ins.OpenModule(s.moduleID[0][1],s.moduleID[1][1])}}},t.prototype.cooldownHandler=function(){var t=p.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.endTime-o.ServerTime.serverTime;86400<e?(this.lab_time.changeText(a.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(a.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t}(ui.activity.pages.Login_GiftUI);e.LoginGiftPage=_}),define("src/g/fight/osprite/buff/basic/BaseBuff",["require","exports","../../../../../utils/ItemUtils"],function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,i,n){this.target=t,this.id=i,this.level=n,this.data=s.ItemUtils.getBuffVoById(i),this.user=e,this.reset()}return Object.defineProperty(t.prototype,"endTime",{get:function(){return this._endTime},enumerable:!0,configurable:!0}),t.prototype.clear=function(){this.target=null,this.user=null,this.data=null},t.prototype.reset=function(){this._endTime=Date.now()+1e3*this.data.cd},t.prototype.onUpdate=function(t){return!1},t.prototype.getEffectValue=function(){return 0},t.prototype.update=function(){},t.prototype.removeEffect=function(){},t}();e.BaseBuff=i}),define("src/g/fight/osprite/buff/basic/DurationBuff",["require","exports","src/g/fight/osprite/buff/basic/BaseBuff"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.reset=function(){t.prototype.reset.call(this)},e.prototype.onUpdate=function(t){return!(t>=this._endTime)||(this.removeEffect(),!1)},e.prototype.getEffectValue=function(){return 0},e.prototype.addEffect=function(){},e.prototype.removeEffect=function(){},e}(i.BaseBuff);e.DurationBuff=n}),define("src/g/fight/osprite/buff/HugeBuff",["require","exports","src/g/fight/osprite/buff/basic/DurationBuff"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.coef=-1,t._isVaild=!1,t}return __extends(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),Laya.timer.frameOnce(2,this,this.addEffect)},t.prototype.getEffectValue=function(){if(-1==this.coef||null==this.coef){var t=this.data.rate;this.coef=t[Math.min(this.level-1,t.length-1)]}return this.coef},t.prototype.addEffect=function(){!this._isVaild&&this.target&&(this.target.scaleRate+=this.getEffectValue(),this._isVaild=!0)},t.prototype.removeEffect=function(){this._isVaild&&this.target&&(this.target.scaleRate-=this.getEffectValue(),this._isVaild=!1)},t}(i.DurationBuff);e.HugeBuff=n}),define("src/g/activity/view/pages/HugeGiftPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","../../../../config/GameConfig","../../../../utils/ItemUtils","../../../net/messages/enumStatus","src/init/TextConst","../../../../manager/AM","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../meta/MainButtonVo","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","src/g/Effects/UIEffectsFactory","../../../../utils/MathUtils"],function(t,e,i,n,s,u,o,a,p,d,r,l,h,c,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t.selectIndex=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged(),this.initMenu()):i.ClearResM.resetViewImg(this),this.refresh(),this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this)},t.prototype.refresh=function(){this.updateMenu(),this.updateGift(this.selectIndex)},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/huge_gift/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_item.renderHandler=new Laya.Handler(this,this.onRenderHandler),this.list_item.mouseHandler=new Laya.Handler(this,this.onMouseHandler)},t.prototype.onRenderHandler=function(t,e){f.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];y.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.updateUnchanged=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=p.GameConfig.activityJson[t.cfgId];this.title_img.skin="dynamic/activity/huge_gift/"+e.bg_img+".png",this.lab_desc.changeText(e.desc);var i=t.children.length,n=0;for(this._childIndexArr=[];n<i;)this._childIndexArr.push(n),n++}else console.log("没有找到数据，类型：huge_gift")},t.prototype.initMenu=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e,i=0,n=this._childIndexArr.length,s=0,o=0;for(this.item_list=[],this._progressArr=[0];s<n;){o=this._childIndexArr[s],e=p.GameConfig.subActivityJson[t.children[o].cfgId];var a=new ui.activity.item.HugeGiftMenuItemUI,r=d.ItemUtils.getItemOrEq(e.bonus[0][0]);a.img_icon.skin=r?d.ItemUtils.getIconByIconId(r.icon):"",a.offAll(),a.lab_count.changeText(e.value.toString()),this._progressArr.push(e.value),a.on(Laya.Event.CLICK,this,this.updateGift,[s]),a.width>i&&(i=a.width),this.item_list.push(a),this.box_menu.addChild(a),s++}var l=this.panel_menu.width-i/2-this.img_progerss.x,h=l/4,c=this.item_list.length;for(c<4&&(h=l/c),s=0;s<c;)(a=this.item_list[s]).x=(s+1)*h-i/2,s++;this.img_progerss.width=this.img_progerss_di.width=c*h,this.box_menu.width=this.img_progerss.width+this.img_progerss.x+i/2,this.img_progerss.scaleX=0}},t.prototype.updateMenu=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);t&&(this.lab_count.changeText(t.allData.allCount.toString()),this._progressArr&&(this.img_progerss.scaleX=Math.min(1,_.MathUtils.sectionProgress(this._progressArr,t.allData.allCount))))},t.prototype.updateGift=function(t){var e=this.item_list[this.selectIndex];e&&(e.img_select.visible=!1),this.selectIndex=t,(e=this.item_list[this.selectIndex])&&(e.img_select.visible=!0);var i=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(i){var n,s,o=this._childIndexArr[t];s=i.children[o],n=p.GameConfig.subActivityJson[s.cfgId],this.list_item.array=n.bonus,this.icon_state.visible=!1,this.btn_get.offAll(),this.btn_get.on(Laya.Event.CLICK,this,this.getHandler,[o]),s.status==r.enumStatus.weiwancheng?(this.btn_get.visible=!0,this.btn_get.disabled=!0,this.btn_get.label=l.TextConst.get(210),n.moduleID&&0<n.moduleID.length&&(this.btn_get.disabled=!1,this.btn_get.label=l.TextConst.get(200))):s.status==r.enumStatus.kelingqu?(this.btn_get.disabled=!1,this.btn_get.label=l.TextConst.get(216),this.btn_get.visible=!0):(this.btn_get.visible=!1,this.icon_state.visible=!0),s.status==r.enumStatus.kelingqu?(this.ani1||(this.ani1=m.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40)),-1==this.btn_get.getChildIndex(this.ani1)&&m.UIEffectsFactory.Ins.centerSAni4Parent(this.ani1,this.btn_get),this.ani1.play()):this.ani1&&(this.ani1.stop(),-1!=this.btn_get.getChildIndex(this.ani1)&&this.btn_get.removeChild(this.ani1))}},t.prototype.getHandler=function(t){var e=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e){var i=e.children[t];if(i&&i.status==r.enumStatus.kelingqu){if(!u.RoleCenter.instans.bagRoomEnough())return void h.AM.showBagNotEnough();var n=new c.ActivityGetC2GS;n.id=this._activityId,n.activity2CfgId=i.cfgId,g.GSM.sendServer(n)}else if(i.status==r.enumStatus.weiwancheng){var s=p.GameConfig.subActivityJson[i.cfgId];v.MainButtonStruct.Ins.OpenModule(s.moduleID[0][1],s.moduleID[1][1])}}},t.prototype.cooldownHandler=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.endTime-o.ServerTime.serverTime;86400<e?(this.lab_time.changeText(a.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(a.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t}(ui.activity.pages.HugeGiftUI);e.HugeGiftPage=C}),define("src/g/activity/view/pages/GoldFallPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../utils/system/FloatEffect","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../net/messages/enumStatus","src/init/Switches","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","../../../../manager/ActivityManager"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t._selectIndex=-1,t._turnTime=0,t._remainTimes=0,t._runnum=0,t._running=!1,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),u.GSM.ins.on(c.ActivityGetGS2C.KEY,this,this.onActivityGetHandler),this.resetRollNum(),this.refresh(),this.cooldownHandler(),e.addChild(this),g.ActivityManager.ins.activityRead(this._activityId),this.resetSelectImg()},t.prototype.refresh=function(){this.updateInfo(),this.updateSelectItem()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),u.GSM.ins.off(c.ActivityGetGS2C.KEY,this,this.onActivityGetHandler),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/gold_fall/"),Laya.timer.clear(this,this.cooldownHandler),this.stopRollNum()},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.updateUnchanged=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=r.GameConfig.activityJson[t.cfgId];this.title_img.skin="dynamic/activity/gold_fall/"+e.bg_img+".jpg",this._childIndexArr=[];for(var i=t.children.length,n=0;n<i;)this._childIndexArr.push(n),n++;this._childIndexArr.sort(this.childSortFun.bind(this))}this.btn_start.on(Laya.Event.CLICK,this,this.onTurnClickHandler),this.effect_con.scrollRect=new Laya.Rectangle(0,0,this.effect_con.width,this.effect_con.height)},t.prototype.childSortFun=function(t,e){var i=a.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=r.GameConfig.subActivityJson[i.children[t].cfgId],s=r.GameConfig.subActivityJson[i.children[e].cfgId];return n.childId-s.childId},t.prototype.updateInfo=function(){var t,e=a.RoleCenter.instans.vo.getActivity1Data(this._activityId),i=this._childIndexArr?this._childIndexArr.length:0,n=0;for(this._selectIndex=-1,this._turnTime=0,this._remainTimes=i;n<i;)t=this._childIndexArr[n],e.children[t].status!=l.enumStatus.yilingqu?(-1==this._selectIndex&&(this._selectIndex=n),e.children[t].status==l.enumStatus.kelingqu&&this._turnTime++):this._remainTimes--,n++},t.prototype.updateSelectItem=function(){var t=this.getSelectSubActivity();if(t){this.btn_start.disabled=!1,this.lab1.visible=this.img_gold.visible=this.lab_cost.visible=!0,this.lab_end.visible=!1;var e=r.GameConfig.subActivityJson[t.cfgId];e&&e.cost&&this.lab_cost.changeText(e.cost[0][1].toString())}else this.btn_start.disabled=!0,this.lab_cost.changeText(""),this.lab1.visible=this.img_gold.visible=this.lab_cost.visible=!1,this.lab_end.visible=!0},t.prototype.getSelectSubActivity=function(){if(-1<this._selectIndex&&this._childIndexArr&&this._selectIndex<this._childIndexArr.length){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId),e=this._childIndexArr[this._selectIndex];return t?t.children[e]:null}return null},t.prototype.onTurnClickHandler=function(){if(!(0<this._runnum||this._running)&&(this.resetSelectImg(),0<this._turnTime)){var t=this.getSelectSubActivity();if(t&&t.status==l.enumStatus.kelingqu){var e=r.GameConfig.subActivityJson[t.cfgId];if(e){if(a.RoleCenter.instans.vo.GOLD<Number(e.cost[0][1]))return void h.Switches.ins.event(155);var i=new c.ActivityGetC2GS;i.id=this._activityId,i.activity2CfgId=t.cfgId,u.GSM.sendServer(i)}}}},t.prototype.onActivityGetHandler=function(t){this._activityId==t.id&&t.opresult&&this.play(t)},t.prototype.play=function(t){if(this._msg=t,-1<Number(t.error))for(var e=t.inv.currencyList,i=0;i<e.length;i++)if("GOLD"==e[i].key&&0<e[i].val){this.playRollNum(e[i].val);break}},t.prototype.resetRollNum=function(){for(var t=0;t<6;)this["roll_num_"+t].reset(),t++},t.prototype.resetSelectImg=function(){for(var t=0;t<6;)this["img_select"+t].visible=!1,t++},t.prototype.setRollNum=function(t){this.roll_num_0.setIndex(Math.floor(t/1e5)),this.roll_num_1.setIndex(Math.floor(t/1e4)%10),this.roll_num_2.setIndex(Math.floor(t/1e3)%10),this.roll_num_3.setIndex(Math.floor(t/100)%10),this.roll_num_4.setIndex(Math.floor(t/10)%10),this.roll_num_5.setIndex(t%10)},t.prototype.playRollNum=function(t){this.roll_num_0.on("roll_complete",this,this.onRollCompleteHandler),this.roll_num_1.on("roll_complete",this,this.onRollCompleteHandler),this.roll_num_2.on("roll_complete",this,this.onRollCompleteHandler),this.roll_num_3.on("roll_complete",this,this.onRollCompleteHandler),this.roll_num_4.on("roll_complete",this,this.onRollCompleteHandler),this.roll_num_5.on("roll_complete",this,this.onRollCompleteHandler),this._runnum=6,this.roll_num_0.play(Math.floor(t/1e5)),this.roll_num_1.play(Math.floor(t/1e4)%10),this.roll_num_2.play(Math.floor(t/1e3)%10),this.roll_num_3.play(Math.floor(t/100)%10),this.roll_num_4.play(Math.floor(t/10)%10),this.roll_num_5.play(t%10)},t.prototype.onRollCompleteHandler=function(){if(this._runnum--,this["img_select"+this._runnum].visible=!0,0==this._runnum){for(var t=0;t<6;)this["roll_num_"+t].off("roll_complete",this,this.onRollCompleteHandler),t++;o.FE.addInventoryToCFloats(this._msg.inv),this.refresh(),this.goldFallAni()}},t.prototype.stopRollNum=function(){if(0<this._runnum){for(var t=0;t<6;)this["roll_num_"+t].stop(),this["roll_num_"+t].off("roll_complete",this,this.onRollCompleteHandler),t++;this._runnum=0}},t.prototype.goldFallAni=function(){var t=this;this._running=!0;for(var e,i=50*Math.random()+10,n=0;n<i;){(e=new Laya.Image("res/activity/gold_fall/yuanbao_002.png")).anchorX=.5,e.anchorY=.5,e.y=-74,e.x=Math.random()*this.effect_con.width;var s=Math.random()+.3;e.scale(s,s),e.rotation=180*Math.random(),this.effect_con.addChild(e),Laya.Tween.to(e,{y:this.effect_con.height+74},1e3,Laya.Ease.circIn,new Laya.Handler(this,function(t){t.removeSelf()},[e]),1e3*Math.random()),n++}Laya.timer.once(2e3,this,function(){t._running=!1})},t.prototype.cooldownHandler=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.endTime-d.ServerTime.serverTime;86400<e?(this.lab_time.changeText(p.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(p.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t}(ui.activity.pages.GoldFallUI);e.GoldFallPage=v}),define("src/g/activity/view/item/MyteryStoreExchangeItem",["require","exports","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../utils/system/FloatEffect","../../../../manager/AM","../../../../plugin/view/ToolTip","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","src/init/TextConst"],function(t,e,u,p,d,g,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t._lastBuyTime=0,t.img_zhe_di.visible=t.img_zhe.visible=t.font_zhe.visible=!1,t.btn_buy.on(Laya.Event.CLICK,t,t.onBuyHandler),t}return __extends(t,e),t.prototype.onBuyHandler=function(){if(Date.now()-this._lastBuyTime<1e3)o.FE.upItems(c.TextConst.get(258),r.BubbleEnum.center);else if(u.RoleCenter.instans.bagRoomEnough()){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex],i=p.GameConfig.subActivityJson[e.cfgId];if(i){if(0<i.value2&&i.value2-e.count<=0)return void o.FE.upItems(c.TextConst.get(218),r.BubbleEnum.center);var n=Number(i.cost[0][1]);if(t.allData.allCount<n)return void o.FE.upItems(c.TextConst.get(1064),r.BubbleEnum.center);this._lastBuyTime=Date.now();var s=new l.ActivityGetC2GS;s.id=this._activityId,s.activity2CfgId=e.cfgId,h.GSM.sendServer(s)}}}else a.AM.showBagNotEnough()},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e;var i=u.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=p.GameConfig.subActivityJson[n.cfgId],o=s.value2,a=s.value2-n.count;this.lab_count.color=0<a?"#03bb00":"#ff0f15",this.lab_count.changeText(a+"/"+o);var r=Number(s.cost[0][1]);this.btn_buy.label=r+"积分";var l=s.bonus[0][0],h=Number(s.bonus[0][1]);d.ItemCellUtils.fillCellForItemNameView(this.item,l,h),this.item.offAll(),this.item.on(Laya.Event.CLICK,this,function(t,e){g.ItemTips.ins.showTip(t,e)},[l,h]);var c=!0;0<o&&a<=0&&(c=!1),this.btn_buy.disabled=!c}}},t}(ui.activity.item.MysteryStoreItemUI);e.MyteryStoreExchangeItem=i}),define("src/g/activity/view/item/MyteryStoreBuyItem",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ui.activity.item.MysteryStoreItemUI);e.MyteryStoreBuyItem=i}),define("src/g/activity/view/dlg/MysteryStorePreviewDlg",["require","exports","../../../../config/GameConfig","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../enum/EventName","../../../../core/E","../../../../manager/RoleCenter"],function(t,e,l,o,a,i,n,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.bg.btn_close.on(Laya.Event.CLICK,t,t.close),t.list_main.scrollBar.elasticDistance=100,t.list_main.renderHandler=new Laya.Handler(t,t.renderHandler),t}return __extends(t,e),t.prototype.showDlg=function(t){this._activityId=t,this.updateList(),n.E.ins.on(i.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler)},t.prototype.onTimeSpanHandler=function(t){var e=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.updateList()},t.prototype.updateList=function(){var t=-1,e=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(e)for(var i=e.children.length,n=0;n<i;){var s=l.GameConfig.subActivityJson[e.children[n].cfgId];if(s&&3==s.childId){t=Number(s.desc);break}n++}if(-1<t){var o,a=[];for(var r in l.GameConfig.activityShop)(o=l.GameConfig.activityShop[r]).itemshow==t&&a.push(o);this.list_main.array=a}else this.list_main.array=null},t.prototype.onClosed=function(){n.E.ins.off(i.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler)},t.prototype.renderHandler=function(t,e){var i=this.list_main.array[e],n=i.itemid[0];o.ItemCellUtils.fillCellForItemNameView(t.item,n[0],Number(n[1])),t.item.offAll(),t.item.on(Laya.Event.CLICK,this,function(t,e){a.ItemTips.ins.showTip(t,e)},n);var s=i.cost[0][1];t.btn_buy.label=s+"元宝",t.img_zhe_di.visible=t.img_zhe.visible=t.font_zhe.visible=!1,0<i.discost&&(t.img_zhe_di.visible=t.img_zhe.visible=t.font_zhe.visible=!0,t.font_zhe.value=i.discost.toString(),i.discost<=2?t.img_zhe_di.skin="res/unpack/sc_zebiaoqian2.png":t.img_zhe_di.skin="res/unpack/sc_zebiaoqian1.png")},t}(ui.activity.dlg.MysteryStorePreviewListUI);e.MysteryStorePreviewDlg=s}),define("src/g/activity/view/pages/MysteryStorePage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","../../../../config/GameConfig","../../../../utils/ItemUtils","src/g/activity/view/item/MyteryStoreExchangeItem","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","src/g/activity/view/item/MyteryStoreBuyItem","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","src/g/activity/view/dlg/MysteryStorePreviewDlg","../../../../manager/ActivityManager","src/init/Switches","src/init/TextConst"],function(t,e,i,n,s,h,o,a,c,l,r,u,p,d,g,v,f,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t.costItemId=0,t.needItemCount=0,t.costGold=0,t._lastRefreshT=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.refresh(),this.costItemId&&n.E.ins.on(s.EventName.CHANGEITEM_COUNT,this,this.onBagItemChanged),this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),n.E.ins.on(s.EventName.ACTIVITY_SHOP_DATA_CHANGED,this,this.onShopDataChanged),n.E.ins.on(s.EventName.ACTIVITY_SHOP_PRODUCT_LIST_CHANGED,this,this.onShopProductChanged),e.addChild(this),this.switchPage(0),_.ActivityManager.ins.activityRead(this._activityId)},t.prototype.onTimeSpanHandler=function(t){var e=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.refresh=function(){if(this.updateListData(),0<this.costItemId){var t=h.RoleCenter.instans.vo.bagdata.getItemCount(this.costItemId);t<this.needItemCount?this.htxt_cost.innerHTML="<font color='#ff0000'>"+t+"</font>/"+this.needItemCount:this.htxt_cost.innerHTML=t+"/"+this.needItemCount}var e=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&(this.lab_curr_score.changeText(e.allData.allCount.toString()),this.lab_curr_score2.changeText(e.allData.allCount.toString())),this.updateShopTime()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.off(s.EventName.CHANGEITEM_COUNT,this,this.onBagItemChanged),n.E.ins.off(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),n.E.ins.off(s.EventName.ACTIVITY_SHOP_DATA_CHANGED,this,this.onShopDataChanged),n.E.ins.off(s.EventName.ACTIVITY_SHOP_PRODUCT_LIST_CHANGED,this,this.onShopProductChanged),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/mytery_store/"),Laya.timer.clear(this,this.cooldownHandler),Laya.timer.clear(this,this.updateShopTime)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.htxt_cost.style.color="#e1a32a",this.htxt_cost.style.font="SimHei",this.htxt_cost.style.fontSize=20,this.htxt_exchange_desc.style.color="#e1a32a",this.htxt_exchange_desc.style.font="SimHei",this.htxt_exchange_desc.style.fontSize=21,this.htxt_exchange_desc.style.align="center",this.htxt_exchange_desc.style.leading=5,this.list_score.scrollBar.elasticDistance=100,this.list_score.itemRender=r.MyteryStoreExchangeItem,this.list_score.renderHandler=new Laya.Handler(this,this.renderHandler),this.list_main.itemRender=v.MyteryStoreBuyItem,this.list_main.renderHandler=new Laya.Handler(this,this.renderMainHandler),this.btn_to_main.on(Laya.Event.CLICK,this,this.switchPage,[0]),this.btn_to_score.on(Laya.Event.CLICK,this,this.switchPage,[1]),this.btn_refresh.on(Laya.Event.CLICK,this,this.requestRefreshHandler),this.lab_show_all.on(Laya.Event.CLICK,this,this.popPreviewDlg)},t.prototype.switchPage=function(t){this.box_main.visible=0==t,this.box_score.visible=1==t},t.prototype.requestRefreshHandler=function(){if(this._activityId){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)if(c.GameConfig.activityJson[t.cfgId]){if(o.ServerTime.serverTime-this._lastRefreshT<1)return void d.FE.upItems(I.TextConst.get(212),g.BubbleEnum.center);var e=1;if(this.box_cost.visible){var i=!(e=3);if(this.costItemId)h.RoleCenter.instans.vo.bagdata.getItemCount(this.costItemId)>=this.needItemCount&&(i=!0,e=2);if(!i&&h.RoleCenter.instans.vo.GOLD<this.costGold)return void C.Switches.ins.event(155)}var n=new u.RefushShopRandomItemDataC2GS;n.type=e,n.id=this._activityId,p.GSM.sendServer(n),this._lastRefreshT=o.ServerTime.serverTime}}},t.prototype.popPreviewDlg=function(){this._previewDlg||(this._previewDlg=new m.MysteryStorePreviewDlg),this._previewDlg.showDlg(this._activityId),this._previewDlg.isPopup||this._previewDlg.popup()},t.prototype.onShopProductChanged=function(t){t==this._activityId&&this.updateBuyList()},t.prototype.updateBuyList=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);t&&t.randomItemData&&(this.list_main.array=t.randomItemData.randomItemArr)},t.prototype.onShopDataChanged=function(t){t==this._activityId&&this.list_main.refresh()},t.prototype.updateUnchanged=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=c.GameConfig.activityJson[t.cfgId];this.lab_desc.changeText(e.desc);var i=e.value.split(","),n=i[1].split(":"),s=i[2].split(":");this.costItemId=parseInt(s[0]),this.costGold=parseInt(n[1]),this.needItemCount=parseInt(s[1]),this.lab_cost.changeText(this.costGold.toString()),l.ItemUtils.getItemVoById(this.costItemId)&&(this.icon_item.skin=l.ItemUtils.getIconById(this.costItemId)),this._childIndexArr=[];for(var o=t.children.length,a=0;a<o;){var r=c.GameConfig.subActivityJson[t.children[a].cfgId];r&&(3==r.childId?this.htxt_exchange_desc.innerHTML=I.TextConst.get(1118,r.bonus[0][1]):100<r.childId&&this._childIndexArr.push(a)),a++}t.randomItemData?this.updateBuyList():(this.list_main.array=null,this.requestBuyList())}else console.log("没有找到数据，类型：mytery_store")},t.prototype.onBagItemChanged=function(t){0<this.costItemId&&t==this.costItemId&&this.refresh()},t.prototype.requestBuyList=function(){var t=new u.GetShopRandomItemDataC2GS;t.id=this._activityId,p.GSM.sendServer(t)},t.prototype.updateListData=function(){this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_score.array=this._childIndexArr},t.prototype.childSortFun=function(t,e){var i=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(!i)return 0;var n=i.children[t],s=i.children[e],o=c.GameConfig.subActivityJson[n.cfgId],a=c.GameConfig.subActivityJson[s.cfgId],r=o?o.childId+1e3:1e3,l=a?a.childId+1e3:1e3;return 0<o.value2-n.count?r-=1e3:r+=1e3,0<a.value2-s.count?l-=1e3:l+=1e3,r-l},t.prototype.renderHandler=function(t,e){t.setData(this._activityId,this.list_score.array[e])},t.prototype.cooldownHandler=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.endTime-o.ServerTime.serverTime;86400<e?(this.lab_time.changeText(a.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(a.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t.prototype.updateShopTime=function(){Laya.timer.clear(this,this.updateShopTime);var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.allData.time;0<e-o.ServerTime.serverTime?(this.lab_refresh_lab.visible=this.lab_refresh_time.visible=!0,this.box_cost.visible=!0,this.btn_refresh.label="刷新",this.lab_refresh_time.changeText(a.DateUtil.getHMS_countdown(e-o.ServerTime.serverTime)),Laya.timer.once(1e3,this,this.updateShopTime)):(this.box_cost.visible=!1,this.btn_refresh.label="免费刷新",this.lab_refresh_lab.visible=this.lab_refresh_time.visible=!1)}},t.prototype.renderMainHandler=function(t,e){var i=this.list_main.array[e].id,n=c.GameConfig.activityShop[i];if(n){var s=n.itemid[0];f.ItemCellUtils.fillCellForItemNameView(t.item,s[0],Number(s[1])),t.item.offAll(),t.item.on(Laya.Event.CLICK,this,function(t,e){y.ItemTips.ins.showTip(t,e)},s);var o=n.cost[0][1];t.btn_buy.label=o+"元宝",t.img_zhe_di.visible=t.img_zhe.visible=t.font_zhe.visible=!1,0<n.discost&&(t.img_zhe_di.visible=t.img_zhe.visible=t.font_zhe.visible=!0,t.font_zhe.value=n.discost.toString(),n.discost<=2?t.img_zhe_di.skin="res/unpack/sc_zebiaoqian2.png":t.img_zhe_di.skin="res/unpack/sc_zebiaoqian1.png"),t.lab_count.visible=t.lab_count_lab.visible=!1;var a=!0;t.lab_count.visible=t.lab_count_lab.visible=!0,a=!1;var r=0,l=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);l&&l.randomItemData&&(-1!=(e=l.randomItemData.bugCfgIdArr.indexOf(i))?(r=l.randomItemData.bugCfgIdArr[e+1])<1&&(a=!0):a=!0),t.lab_count.color=a?"#149b14":"#ff0000",t.lab_count.changeText(1-r+"/1"),t.btn_buy.offAll(),t.btn_buy.disabled=!a||(t.btn_buy.on(Laya.Event.CLICK,this,this.onBuyHandler,[i]),!1)}},t.prototype.onBuyHandler=function(t){if(Date.now()-this._lastBuyTime<800)d.FE.upItems(I.TextConst.get(212),g.BubbleEnum.center);else{var e=c.GameConfig.activityShop[t];if(e){var i=e.cost[0][0],n=Number(e.cost[0][1]);if("GOLD"==i){if(h.RoleCenter.instans.vo.GOLD<n)return void C.Switches.ins.event(155)}else if(h.RoleCenter.instans.vo.bagdata.getItemCount(i)<n)return void d.FE.upItems(I.TextConst.get(520),g.BubbleEnum.center);this._lastBuyTime=Date.now();var s=new u.ActivityGetC2GS;s.id=this._activityId,s.activity2CfgId=t,p.GSM.sendServer(s)}}},t}(ui.activity.pages.MysteryStoreUI);e.MysteryStorePage=b}),define("src/g/activity/view/item/Daily_Rebate1_item",["require","exports","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../manager/AM","../../../net/messages/activity/ActivityGet","../../../net/messages/enumStatus","../../../../manager/GameSocketManager","src/g/Effects/UIEffectsFactory","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","src/init/TextConst"],function(t,e,a,r,n,s,l,o,h,i,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.getHandlerLevel),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];c.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.getHandlerLevel=function(){if(a.RoleCenter.instans.bagRoomEnough()){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex];if(e&&e.status==l.enumStatus.kelingqu){var i=new s.ActivityGetC2GS;i.id=this._activityId,i.activity2CfgId=e.cfgId,o.GSM.sendServer(i)}}}else n.AM.showBagNotEnough()},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e;var i=a.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=r.GameConfig.subActivityJson[n.cfgId];this.list_item.array=s.bonus,this.lab_desc.text=s.title;var o=this.icon_state.visible=!1;n.status==l.enumStatus.weiwancheng?(this.btn_get.visible=!0,this.btn_get.disabled=!0,this.btn_get.label=u.TextConst.get(210)):n.status==l.enumStatus.kelingqu?(this.btn_get.disabled=!1,this.btn_get.label=u.TextConst.get(216),o=this.btn_get.visible=!0):(this.btn_get.visible=!1,this.icon_state.visible=!0),o?(this.ani||(this.ani=h.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_get.getChildIndex(this.ani)&&h.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_get),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_get.getChildIndex(this.ani)&&this.btn_get.removeChild(this.ani))}}},t}(ui.activity.item.Daily_Rebate1_itemUI);e.Daily_Rebate1_item=p}),define("src/g/activity/view/pages/Daily_Rebate1Page",["require","exports","src/g/bag/tips/view/ItemTips","../../../../utils/ItemCellUtils","../../../../config/GameConfig","../../../../manager/RoleCenter","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","src/g/activity/view/item/Daily_Rebate1_item","../../../net/messages/enumStatus"],function(t,e,i,n,h,c,s,o,a,r,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.list_item.vScrollBarSkin="",t.list_item.itemRender=r.Daily_Rebate1_item,t.list_item.scrollBar.elasticDistance=100,t.list_item.renderHandler=new Laya.Handler(t,t.renderHandler),t.show_list.renderHandler=new Laya.Handler(t,t.showListRenderHandler),t.show_list.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onDataUpdateHandler=function(t,e){this._activityId==e&&this.refresh()},t.prototype.onMouseHandler=function(t,e){t.type==Laya.Event.CLICK&&i.ItemTips.ins.showTip(this.show_list.array[e][0],Number(this.show_list.array[e][1]))},t.prototype.showListRenderHandler=function(t,e){n.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.renderHandler=function(t,e){t.setData(this._activityId,this.list_item.array[e])},t.prototype.updateUnchanged=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=h.GameConfig.activityJson[t.cfgId];this.title_image.skin="dynamic/activity/daily_rebate1/"+e.bg_img+".jpg",this.show_list.array=e.showList,this._childIndexArr=[];for(var i=t.children.length,n=0;n<i;)this._childIndexArr.push(n),n++}},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):s.ClearResM.resetViewImg(this),this.refresh(),o.E.ins.on(a.EventName.ACTIVITY_DATA_CHANGED,this,this.onDataUpdateHandler),o.E.ins.on(a.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),e.addChild(this)},t.prototype.onTimeSpanHandler=function(t){var e=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.getActivityId=function(){return this._activityId},t.prototype.refresh=function(){this.updateListData()},t.prototype.updateListData=function(){this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_item.array=this._childIndexArr},t.prototype.childSortFun=function(t,e){var i=c.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=i.children[t],s=i.children[e],o=h.GameConfig.subActivityJson[n.cfgId],a=h.GameConfig.subActivityJson[s.cfgId],r=o?o.childId+1e3:1e3,l=a?a.childId+1e3:1e3;return n.status==u.enumStatus.kelingqu?r-=1e3:n.status==u.enumStatus.yilingqu&&(r+=1e3),s.status==u.enumStatus.kelingqu?l-=1e3:s.status==u.enumStatus.yilingqu&&(l+=1e3),r-l},t.prototype.hidePage=function(){o.E.ins.off(a.EventName.ACTIVITY_DATA_CHANGED,this,this.onDataUpdateHandler),o.E.ins.off(a.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),s.ClearResM.clearFolderByUrl("dynamic/activity/daily_rebate1/")},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this),Laya.loader.clearRes(this.title_image.skin)},t}(ui.activity.pages.Daily_Rebate1UI);e.Daily_Rebate1Page=l}),define("src/g/activity/view/item/TurnCradItem",["require","exports","../../../../manager/GameSocketManager","../../../../config/GameConfig","../../../../manager/AM","../../../../manager/RoleCenter","src/init/TextConst","../../../net/messages/activity/ActivityTrigger","src/init/Switches","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../utils/ItemCellUtils"],function(t,e,s,u,o,a,r,l,h,c,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.openTime=0,t}return __extends(t,e),t.prototype.setData=function(t,e,i,n,s,o){void 0===n&&(n=-1),void 0===o&&(o=!1);var a=t,r=e,l=(this.activity1=r).children[0];this.activity2=l;var h=u.GameConfig.subActivityJson[l.cfgId];this.activityvo=h;var c=this.activityvo.bonus[n];this.index=i,""===a?(this.mouseEnabled=!0,this.on(Laya.Event.CLICK,this,this.onClick)):0<parseInt(a)?(o?(this.box_before.visible=!1,this.box_after.alpha=1):this.turningMovement(),this.label_name.text="使用"+a+"元宝",this.item_gift.visible=-1!=n&&s==i?(this.label_desc.text="翻牌得到了大奖",d.ItemCellUtils.fillCellForItemNameView(this.item_gift,c[0],c[1]),!0):!(this.label_desc.text="翻开了卡牌")):(o?(this.box_before.visible=!1,this.box_after.alpha=1):this.turningMovement(),this.label_name.text=this.setFriendName(a),this.item_gift.visible=-1!=n&&s==i?(this.label_desc.text="帮您翻到了大奖",d.ItemCellUtils.fillCellForItemNameView(this.item_gift,c[0],c[1]),!0):!(this.label_desc.text="帮您翻开了卡牌")),""===a&&-1!=n&&(o?(this.box_before.visible=!1,this.box_after.alpha=1):Laya.timer.once(1e3,this,this.turningMovement),this.label_desc.text="已获得大奖,活动结束",this.label_name.text="",this.item_gift.visible=!1,this.mouseEnabled=!1)},t.prototype.onClick=function(){var e=this;if(0<this.activity1.shareNameArr.length){var t=new l.drawC2GS;t.id=this.activity1.id,t.index=this.index,s.GSM.sendServer(t)}else{var i=this.getCount(),n=this.activityvo.cost[i[1]];if("MONEY"==n[0]&&a.RoleCenter.instans.vo.MONEY<n[1])return void c.FE.upItems(r.TextConst.get(220),p.BubbleEnum.center);if("GOLD"==n[0]&&a.RoleCenter.instans.vo.GOLD<n[1])return void h.Switches.ins.event(155);o.AM.show("第"+(i[0]+1)+"次抽奖需消耗"+n[1]+"元宝",Laya.Handler.create(this,function(){var t=new l.drawC2GS;t.id=e.activity1.id,t.index=e.index,s.GSM.sendServer(t)}))}},t.prototype.getCount=function(){for(var t=0,e=0,i=[],n=0,s=this.activity2.cardArr.length;n<s;n++)""===this.activity2.cardArr[n]?t++:0<parseInt(this.activity2.cardArr[n])&&e++;return i.push(9-t,e),i},t.prototype.turningMovement=function(){var t=this;this.img_before.visible=!1,Laya.Tween.to(this.box_before,{scaleX:-1},1e3,null,Laya.Handler.create(this,function(){Laya.Tween.to(t.box_before,{alpha:0},1e3,null,Laya.Handler.create(t,function(){}),0,!1),Laya.Tween.to(t.box_after,{alpha:1},1e3,null,Laya.Handler.create(t,function(){t.mouseEnabled=!1}))}))},t.prototype.setFriendName=function(t){var e=t.split("#&$");return"S"+e[2]+" "+e[0]},t}(ui.activity.item.TurnCradItemUI);e.TurnCradItem=i}),define("src/g/activity/view/dlg/TurnCardsRewardPreviewDlg",["require","exports","src/g/bag/tips/view/ItemTips","../../../../utils/ItemCellUtils","../../../../manager/RoleCenter","../../../../config/GameConfig"],function(t,e,i,n,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.list_item.renderHandler=new Laya.Handler(t,t.onListRender),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseListRender),t.bg.on(Laya.Event.CLICK,t,t.onEnterHandler),t}return __extends(t,e),t.prototype.onMouseListRender=function(t,e){t.type==Laya.Event.CLICK&&i.ItemTips.ins.showTip(this.list_item.array[e][0],Number(this.list_item.array[e][1]))},t.prototype.onListRender=function(t,e){n.ItemCellUtils.fillCellForItemNameView(t.item,this.list_item.array[e][0],Number(this.list_item.array[e][1]))},t.prototype.showReward=function(t){var e=r.RoleCenter.instans.vo.getActivity1Data(t),i=e.children[0],n=l.GameConfig.subActivityJson[i.cfgId];if(e){for(var s=n.bonus.length,o=0,a=[];o<s;)a.push(n.bonus[o]),o++;this.list_item.array=a}this.isPopup||this.popup()},t.prototype.onEnterHandler=function(){this.close()},t}(ui.activity.dlg.TurnCardsRewardPreviewDlgUI);e.TurnCardsRewardPreviewDlg=s}),define("src/g/activity/view/pages/TurnCradsPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../config/GameConfig","../../../../manager/RoleCenter","../../../../manager/GameSocketManager","../../../../manager/ActivityManager","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","../../../net/messages/activity/ActivityTrigger","src/g/activity/view/item/TurnCradItem","src/g/gameSdk/gameSdk","src/g/activity/view/dlg/TurnCardsRewardPreviewDlg"],function(t,e,i,n,s,a,r,o,l,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.label_gift_preview.on(Laya.Event.CLICK,t,function(){console.log("大奖预览"),t._preview||(t._preview=new g.TurnCardsRewardPreviewDlg),t._preview.showReward(t._activityId)}),t.label_invite.on(Laya.Event.CLICK,t,function(){d.gameSdk.Ins.sdk.enterShareAndFeed(JSON.stringify({}),function(){console.log("邀请好友")})}),o.GSM.ins.on(u.drawGS2C.KEY,t,t.onOpenCardBack),o.GSM.ins.on(u.addShareActivityChildGS2C.KEY,t,t.onShareTurnTime),t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?this._activityId=t:i.ClearResM.resetViewImg(this),this.show(),this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.refresh),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this),l.ActivityManager.ins.activityRead(this._activityId)},t.prototype.refresh=function(){},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/turncards/")},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this),Laya.loader.clearRes("")},t.prototype.onShareTurnTime=function(t){if(this._activityId==t.id){var e=r.RoleCenter.instans.vo.getActivity1Data(this._activityId),i=(this.activity1=e).children[0];this.activity2=i;var n=a.GameConfig.subActivityJson[i.cfgId];if(!e||!i||!n)return;var s=n.value-this.getHadShareCount();e.shareNameArr=t.shareNameArr;var o=e.shareNameArr.length;this.label_count.text=o+"/"+s,this.refreshView()}},t.prototype.onActivityDataChanged=function(t,e){this._activityId==e&&this.refreshView()},t.prototype.initialize=function(){e.prototype.initialize.call(this)},t.prototype.updateUnchanged=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)a.GameConfig.activityJson[t.cfgId];else console.log("没有找到数据，类型：huge_gift")},t.prototype.show=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId),e=(this.activity1=t).children[0];this.activity2=e;var i=a.GameConfig.subActivityJson[e.cfgId];if(t&&e&&i){var n=t.shareNameArr.length,s=i.value-this.getHadShareCount();this.label_count.text=n+"/"+s,this.refreshView(),this.list_card.itemRender=p.TurnCradItem,this.list_card.renderHandler=new Laya.Handler(this,this.onRenderHandler)}},t.prototype.onRenderHandler=function(t,e){t.setData(this.activity2.cardArr[e],this.activity1,e,this.rewardIndex,this.chooseIndex,this.firstShow)},t.prototype.refreshView=function(){null==this.firstShow?this.firstShow=!0:this.firstShow=!1,this.list_card.array=this.activity2.cardArr,this.activity1.allData.allCount&&9<=this.activity1.allData.allCount&&(this.activity1.allData.time<100?this.chooseIndex=0:this.chooseIndex=this.activity1.allData.time/100<<0,this.rewardIndex=this.activity1.allData.time%100);var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId),e=(this.activity1=t).children[0];this.activity2=e;var i=a.GameConfig.subActivityJson[e.cfgId],n=r.RoleCenter.instans.vo.getActivity1Data(this._activityId).shareNameArr.length,s=i.value-this.getHadShareCount();this.label_count.text=n+"/"+s},t.prototype.cooldownHandler=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.endTime-c.ServerTime.serverTime;86400<e?(this.label_timer.changeText(h.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.label_timer.changeText(h.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.label_timer.changeText("00:00:00")}},t.prototype.onOpenCardBack=function(t){r.RoleCenter.instans.vo.getActivity1Data(t.id)&&(this.rewardIndex=t.rewardIndex,t.shareUsername,this.chooseIndex=t.index,console.log("奖品："+t.rewardIndex+" 好友："+t.shareUsername))},t.prototype.getHadShareCount=function(){for(var t=0,e=0,i=0,n=this.activity2.cardArr.length;i<n;i++)""===this.activity2.cardArr[i]?t++:0<parseInt(this.activity2.cardArr[i])&&e++;return 9-t-e},t}(ui.activity.pages.TurnCradsPageUI);e.TurnCardsPage=v}),define("src/g/activity/view/pages/FriendsHelpPage",["require","exports","src/g/clearRes/ClearResM","../../../../config/GameConfig","../../../../manager/RoleCenter","../../../../manager/GameSocketManager","src/init/Switches","../../../../manager/AM","../../../../manager/ActivityManager","src/g/gameSdk/gameSdk","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","../../../net/messages/activity/ActivityTrigger","../../../../utils/ItemUtils"],function(t,e,o,C,I,b,w,S,a,i,n,s,E,T){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t.SvridNickNameArr=[],t.HeadImgArr=[],t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?this._activityId=t:o.ClearResM.resetViewImg(this),e.addChild(this),b.GSM.ins.on(E.addShareActivityChildGS2C.KEY,this,this.onFriOnline),b.GSM.ins.on(E.shareDiscountBuyMsg.KEY,this,this.onBuyInfo),a.ActivityManager.ins.activityRead(this._activityId),this.remainTimer(),this.yaoqing.on(Laya.Event.CLICK,this,this.onShare),this.btn_buy.on(Laya.Event.CLICK,this,this.onBuyClick),this.zhuliList.on(Laya.Event.CLICK,this,this.onCheckFriendsList);var i=I.RoleCenter.instans.vo.getActivity1Data(this._activityId);this.friendsHelpArr=i.shareNameArr;var n=0!=i.allData.time;this.btn_buy.disabled=n;for(var s=0;s<8;s++)this.SvridNickNameArr.push(this["friendInfoText"+s]),this.HeadImgArr.push(this["friend"+s]);this.refreshView()},t.prototype.refresh=function(){o.ClearResM.resetViewImg(this),this.refreshView()},t.prototype.hidePage=function(){this.removeSelf()},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){this.refreshView()},t.prototype.onBuyInfo=function(t){this.btn_buy.disabled=!0,I.RoleCenter.instans.vo.getActivity1Data(this._activityId).allData.time=1},t.prototype.onFriOnline=function(t){this._activityId==t.id&&(this.friendsHelpArr=t.shareNameArr,I.RoleCenter.instans.vo.getActivity1Data(this._activityId).shareNameArr=t.shareNameArr,this.refreshView())},t.prototype.refreshView=function(){for(var t=I.RoleCenter.instans.vo.getActivity1Data(this._activityId),e=this.friendsHelpArr,i=0;i<8;i++){var n=e[i];if(n){var s=n.split("#&$");this.SvridNickNameArr[i].text="S"+s[2]+" "+s[0],this.SvridNickNameArr[i].color="#fff884",this.HeadImgArr[i].skin="res/custom/heads/y_1_0.png"}else this.SvridNickNameArr[i].text="等待注入",this.SvridNickNameArr[i].color="#09d51f",this.HeadImgArr[i].skin="res/custom/heads/xiaofeipaihang_touxiang.png"}var o=t.allData.allCount,a=t.children[o],r=C.GameConfig.subActivityJson[a.cfgId];if(r){var l=r.desc.split(","),h=e.length,c=0;for(i=0;i<h;i++)c+=parseFloat(l[i]);var u=r.cost[0][1],p=this.fixFloat(1,c/10),d=parseFloat(p)*r.cost[0][1]+"";this.yuanjia.text=u,this.xianjia.text=d,this.disCount.value=10-c+""}var g=e.length;this.friendsNum.changeText(8-g+"个")},t.prototype.fixFloat=function(t,e){var i,n,s;try{n=t.toString().split(".")[1].length}catch(t){n=0}try{s=e.toString().split(".")[1].length}catch(t){s=0}return((t*(i=Math.pow(10,Math.max(n,s)))-e*i)/i).toFixed(s<=n?n:s)},t.prototype.onCheckFriendsList=function(){var t=this.FriendsHelperListView;if(!t){var e=(t=this.FriendsHelperListView=new ui.activity.dlg.FriendListDlgUI).friendsList;e.itemRender=ui.activity.item.FriendHelperItemUI,e.selectEnable=!0,e.vScrollBarSkin="",e.scrollBar.elasticDistance=100,e.spaceY=5,e.renderHandler=new Laya.Handler(this,function(t,e){t.lbContent.style.color="#ffffff",t.lbContent.style.fontSize=17,t.lbContent.innerHTML=t.dataSource}),e.array=[]}var i=I.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=i.allData.allCount,s=i.children[n],o=C.GameConfig.subActivityJson[s.cfgId];if(o){o.desc.split(",");for(var a=this.friendsHelpArr,r=[],l=0;l<a.length;l++){var h=a[l];if(h){var c=h.split("#&$");r.push("S"+c[2]+".<font color='#27d6d6'>"+c[0]+"</font> 为您减少了<font color='#fb0a06'>"+o.desc.split(",")[l]+"</font>折")}}t.friendsList.array=r}t.bg_view.btn_back.on(Laya.Event.CLICK,this,this.closePop),t.bg_view.btn_close.on(Laya.Event.CLICK,this,this.closePop),t.popup()},t.prototype.closePop=function(){this.FriendsHelperListView.close()},t.prototype.onShare=function(){i.gameSdk.Ins.sdk.enterShareAndFeed(JSON.stringify({}),function(t){},function(){}.bind(this))},t.prototype.remainTimer=function(){var t=I.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.endTime-n.ServerTime.serverTime;86400<e?(this.time.changeText(s.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.remainTimer)):0<=e?(this.time.changeText(s.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.remainTimer)):this.time.changeText("00:00:00")}},t.prototype.onBuyClick=function(){var e=this,t=I.RoleCenter.instans.vo.getActivity1Data(this._activityId),i=t.allData.allCount,n=t.children[i],s=C.GameConfig.subActivityJson[n.cfgId];if(s){for(var o=s.desc.split(","),a=this.friendsHelpArr.length,r=0,l=0;l<a;l++)r+=parseFloat(o[l]);if(I.RoleCenter.instans.vo.GOLD<(1-r/10)*s.cost[0][1])return void w.Switches.ins.event(155);for(var h=s.bonus,c=[],u=[],p=0;p<h.length;p++){var d=T.ItemUtils.getItemVoById(h[p][0]);if(d){c.push(d);var g=T.ItemUtils.getColorByQuality(d.quality);u.push(g)}else{var v=T.ItemUtils.getCurrencyVoByDefine(h[p][0]);c.push(v);var f=T.ItemUtils.getQualityColorByDefin(h[p][0]);u.push(f)}}for(var y=this.fixFloat(1,r/10),m="是否确定消耗<font color='#eaf311'>"+parseFloat(y)*s.cost[0][1]+"</font>元宝<font color='#f82306'>"+(10-r)+"</font>折购买",_=0;_<h.length;_++){if(_==h.length-1)m+="<font color='"+u[_]+"'>"+c[_].name+"</font>x"+h[_][1]+"?";else m+="<font color='"+u[_]+"'>"+c[_].name+"</font>x"+h[_][1]+","}S.AM.show(m,Laya.Handler.create(this,function(){var t=new E.shareDiscountBuyMsg;t.id=e._activityId,b.GSM.sendServer(t)}))}},t}(ui.activity.pages.FriendsHelpPageUI);e.FriendsHelpPage=r}),define("src/g/activity/view/pages/KoiStorePage",["require","exports","../../../../manager/RoleCenter","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../manager/ActivityManager","../../../../manager/GameSocketManager","../../../net/messages/activity/ActivityGet","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../config/GameConfig","../../../../utils/ItemUtils","src/g/Effects/UIEffectsFactory","src/init/TextConst","src/init/Switches"],function(t,e,h,i,n,s,o,a,c,u,r,l,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t.costGold=0,t._lastRefreshT=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):s.ClearResM.resetViewImg(this);var i=new p.GetRewardInfoC2GS;i.id=this._activityId,l.GSM.sendServer(i),this.refresh(),this.cooldownHandler(),o.E.ins.on(a.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),o.E.ins.on(a.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),o.E.ins.on(a.EventName.ACTIVITY_SHOP_DATA_CHANGED,this,this.onShopDataChanged),o.E.ins.on(a.EventName.ACTIVITY_SHOP_PRODUCT_LIST_CHANGED,this,this.onShopProductChanged),o.E.ins.on(a.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,this,this.onUpdateLogHandler),e.addChild(this),r.ActivityManager.ins.activityRead(this._activityId)},t.prototype.onTimeSpanHandler=function(t){var e=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&(this.updateUnchanged(),this.refresh())},t.prototype.refresh=function(){this.list_main.refresh(),this.list_best.refresh();var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){if(this.costGold=t.children[0]?t.children[0].childCountArr[0]:0,!this.costGold){var e=v.GameConfig.activityJson[t.cfgId].value.split(",")[1].split(":");this.costGold=Number(e[1])}this.lab_cost.changeText(this.costGold.toString()),0<t.allData.allCount?(this.box_discount.visible=!0,this.lab_desc.visible=!1,this.font_discount.value=t.allData.allCount.toString(),this.ani_discount.source=y.UIEffectsFactory.Ins.getSourceUrlById(42)):(this.box_discount.visible=!1,this.lab_desc.visible=!0)}},t.prototype.hidePage=function(){o.E.ins.off(a.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),o.E.ins.off(a.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),o.E.ins.off(a.EventName.ACTIVITY_SHOP_DATA_CHANGED,this,this.onShopDataChanged),o.E.ins.off(a.EventName.ACTIVITY_SHOP_PRODUCT_LIST_CHANGED,this,this.onShopProductChanged),o.E.ins.off(a.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,this,this.onUpdateLogHandler),this.removeSelf(),s.ClearResM.clearFolderByUrl("dynamic/activity/koi_store/"),s.ClearResM.clearFolderByUrl("dynamic/activity/mytery_store/"),y.UIEffectsFactory.Ins.clearAniRes(42),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.cooldownHandler=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-i.ServerTime.serverTime;86400<e?(this.lab_time.changeText(n.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(n.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t.prototype.initialize=function(){e.prototype.initialize.call(this),this._des=new laya.html.dom.HTMLDivElement,this._des.width=this.con_log.width=this.con_panel.width,this._des.style.font="SimHei",this._des.style.color="#e3cca9",this._des.style.fontSize=18,this._des.style.leading=8,this.con_log.addChild(this._des),this.con_panel.vScrollBar.elasticDistance=100,this.list_main.renderHandler=new Laya.Handler(this,this.storeRenderHandler),this.list_best.renderHandler=new Laya.Handler(this,this.onRenderLimitItem),this.btn_refresh.on(Laya.Event.CLICK,this,this.requestRefreshHandler)},t.prototype.onRenderLimitItem=function(t,e){var i=Number(this.list_best.array[e][0]),n=v.GameConfig.activityShop[i];if(n){var s=n.itemid[0];c.ItemCellUtils.fillCellForItem0View(t.item,s[0],Number(s[1])),t.item.offAll(),t.item.on(Laya.Event.CLICK,this,function(t,e){u.ItemTips.ins.showTip(t,e)},s),t.img_zhe_di.visible=t.img_zhe.visible=t.font_zhe.visible=!1,0<n.discost&&(t.img_zhe_di.visible=t.img_zhe.visible=t.font_zhe.visible=!0,t.font_zhe.value=n.discost.toString(),n.discost<=2?t.img_zhe_di.skin="res/unpack/sc_zebiaoqian2.png":t.img_zhe_di.skin="res/unpack/sc_zebiaoqian1.png");var o=0,a=n.countperday,r=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(r&&r.randomItemData)-1!=(e=r.randomItemData.permitArr.indexOf(i))&&(o=r.randomItemData.permitArr[e+1]);var l=a-o;0<l?t.lab_count.changeText(m.TextConst.get(253,l,n.countperday)):t.lab_count.changeText(m.TextConst.get(214))}},t.prototype.storeRenderHandler=function(t,e){var i=this.list_main.array[e].id,n=v.GameConfig.activityShop[i];if(n){var s=n.itemid[0];c.ItemCellUtils.fillCellForItemNameView(t.item,s[0],Number(s[1])),t.item.offAll(),t.item.on(Laya.Event.CLICK,this,function(t,e){u.ItemTips.ins.showTip(t,e)},s);var o=n.cost[0][1];t.btn_buy.label=o+"元宝",t.img_zhe_di.visible=t.img_zhe.visible=t.font_zhe.visible=!1,0<n.discost&&(t.img_zhe_di.visible=t.img_zhe.visible=t.font_zhe.visible=!0,t.font_zhe.value=n.discost.toString(),n.discost<=2?t.img_zhe_di.skin="res/unpack/sc_zebiaoqian2.png":t.img_zhe_di.skin="res/unpack/sc_zebiaoqian1.png"),t.lab_count.visible=t.lab_count_lab.visible=!1;var a=!0;t.lab_count.visible=t.lab_count_lab.visible=!0,a=!1;var r=0,l=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);l&&l.randomItemData&&(-1!=(e=l.randomItemData.bugCfgIdArr.indexOf(i))?(r=l.randomItemData.bugCfgIdArr[e+1])<1&&(a=!0):a=!0),t.lab_count.color=a?"#149b14":"#ff0000",t.lab_count.changeText(1-r+"/1"),t.btn_buy.offAll(),t.btn_buy.disabled=!a||(t.btn_buy.on(Laya.Event.CLICK,this,this.onBuyHandler,[i]),!1)}},t.prototype.onBuyHandler=function(t){if(Date.now()-this._lastBuyTime<800)d.FE.upItems(m.TextConst.get(212),g.BubbleEnum.center);else{var e=0,i=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);i&&(e=i.allData.allCount);var n=v.GameConfig.activityShop[t];if(n){var s=n.cost[0][0],o=Number(n.cost[0][1]);if("GOLD"==s){if(h.RoleCenter.instans.vo.GOLD+e<o)return void _.Switches.ins.event(155)}else if(h.RoleCenter.instans.vo.bagdata.getItemCount(s)<o)return void d.FE.upItems(m.TextConst.get(520),g.BubbleEnum.center);this._lastBuyTime=Date.now();var a=new p.ActivityGetC2GS;a.id=this._activityId,a.activity2CfgId=t,l.GSM.sendServer(a)}}},t.prototype.updateUnchanged=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){for(var e=t.children.length,i=0;i<e;){var n=v.GameConfig.subActivityJson[t.children[i].cfgId];if(n&&1==n.childId){this.list_best.array=n.bonus.slice(0,5);break}i++}t.randomItemData?this.updateBuyList():(this.list_main.array=null,this.requestBuyList())}else console.log("没有找到数据，类型：koi_store")},t.prototype.requestBuyList=function(){var t=new p.GetShopRandomItemDataC2GS;t.id=this._activityId,l.GSM.sendServer(t)},t.prototype.requestRefreshHandler=function(){if(this._activityId){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)if(v.GameConfig.activityJson[t.cfgId]){if(h.RoleCenter.instans.vo.GOLD<this.costGold)return void _.Switches.ins.event(155);var e=new p.RefushShopRandomItemDataC2GS;e.type=3,e.id=this._activityId,l.GSM.sendServer(e),this._lastRefreshT=i.ServerTime.serverTime}}},t.prototype.onShopProductChanged=function(t){t==this._activityId&&this.updateBuyList()},t.prototype.updateBuyList=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);t&&t.randomItemData&&(this.list_main.array=t.randomItemData.randomItemArr)},t.prototype.onShopDataChanged=function(t){t==this._activityId&&(this.list_main.refresh(),this.list_best.refresh())},t.prototype.onUpdateLogHandler=function(t){if(t.id==this._activityId){var e;if(t&&1==t.type)return e=t.infoArr,void this.appendLog(e[0],e[1],e[2]);var i=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);i&&i.rewardInfo&&(e=i.rewardInfo.infoArr),this._des.innerHTML="";for(var n=(e?e.length:0)-1;0<=n;)this.appendLog(e[n-2],e[n-1],e[n]),n-=3}},t.prototype.appendLog=function(t,e,i){if("1"==e)this._des.appendHTML(m.TextConst.get(1152,t,i));else{var n=v.GameConfig.activityShop[i];if(n){var s=n.itemid[0][0],o=n.itemid[0][1],a=f.ItemUtils.getItemVoById(s);this._des.appendHTML(m.TextConst.get(1151,t,a.name+"x"+o))}}this.con_log.height=this._des.contextHeight+20,this.con_panel.vScrollBar.value=this.con_panel.vScrollBar.max},t}(ui.activity.pages.KoiStoreUI);e.KoiStorePage=C}),define("src/g/activity/view/item/DragonTreasureItem",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","src/g/Effects/UIEffectsFactory"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"isOpen",{get:function(){return this._isOpen},set:function(t){this._isOpen=t,this.changeState(this._isOpen)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return this._index},set:function(t){this._index=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"itemId",{get:function(){return this._itemId},set:function(t){this._itemId=t},enumerable:!0,configurable:!0}),e.prototype.changeState=function(t){this.icon.mouseEnabled=t?(this.imgfg.visible=!1,this.icon.visible=!0):(this.imgfg.visible=!0,this.icon.visible=!1)},e.prototype.setItem=function(t,e){this.itemId=t,i.ItemCellUtils.fillCellForItem0View(this.icon,t,e),n.ItemTips.cellShowTip(this.icon,t,e)},e.prototype.showAni=function(t){var e=t;this.ani=s.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,e,1,1,"ani",!1),this.ani.play(1,!1)},e}(ui.activity.item.DragonTreasureItemUI);e.DragonTreasureItem=o}),define("src/g/activity/view/dlg/DragonTreasureRewardDlg",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.list_item.itemRender=ui.custom.ItemNameViewUI,t.list_item.renderHandler=new Laya.Handler(t,t.onListRender),t.view.btn_close.on(Laya.Event.CLICK,t,t.onClose),t.list_item.scrollBar.elasticDistance=100,t.view.btn_back.visible=!1,t.list_item.height=650,t.view.imgInnerBg.bottom=30,t}return __extends(t,e),t.prototype.setData=function(t){this.list_item.array=t},t.prototype.onListRender=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,this.list_item.array[e][0],Number(this.list_item.array[e][1])),n.ItemTips.cellShowTip(t,this.list_item.array[e][0],Number(this.list_item.array[e][1])),120<t.item_name.width?t.item_name.fontSize=18:t.item_name.fontSize=20,t.item.centerX=20,t.item_name.centerX=20},t.prototype.onClose=function(){this.close()},t}(ui.activity.dlg.DragonTreasureRewardDlgUI);e.DragonTreasureRewardDlg=s}),define("src/g/activity/view/DragonTreasureView",["require","exports","src/g/clearRes/ClearResM","../../../utils/system/ServerTime","../../../core/E","../../../enum/EventName","../../net/messages/activity/sbkActivityData","../../net/messages/activity/ActivityTrigger","../../../manager/RoleCenter","../../../config/GameConfig","src/g/activity/view/item/DragonTreasureItem","../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../utils/ItemUtils","src/init/TextConst","src/g/activity/view/dlg/DragonTreasureRewardDlg","../../../utils/DialogQueue","../../../enum/DialogIDEnum","src/g/account/ctrl/GetRewwardCtrl","../../../utils/system/FloatEffect","../../../manager/GameSocketManager","../../../utils/LayoutUtil","../../../component/BuyHammerDialog","../../../manager/AM"],function(t,e,n,a,s,o,r,l,c,u,h,p,d,g,v,f,y,m,i,_,C,I,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var S=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):n.ClearResM.resetViewImg(this),this.refresh(),this.curTime=a.ServerTime.serverTime,this.countDown(),this.lab_notice.style.color="#e3cca9",this.lab_notice.style.fontFamily="SimHei",this.lab_notice.style.fontSize=18,this.lab_notice.style.align="center",this.lab_notice.innerHTML="",s.E.ins.on(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this),this.btn_buy.on(Laya.Event.CLICK,this,this.onBtnClick),this.btn_reset.on(Laya.Event.CLICK,this,this.onBtnClick),this.img_pvw.on(Laya.Event.CLICK,this,this.onBtnClick),C.GSM.ins.on(l.SmashPoolGS2C.KEY,this,this.getReward),C.GSM.ins.on(l.BuyHammerMsg.KEY,this,this.buyHammer),C.GSM.ins.on(r.RewardInfoData.KEY,this,this.showNotice);var i=new l.getRewardInfoRecordC2GS;i.id=this._activityId,C.GSM.sendServer(i)},t.prototype.hidePage=function(){s.E.ins.off(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.btn_buy.off(Laya.Event.CLICK,this,this.onBtnClick),this.btn_reset.off(Laya.Event.CLICK,this,this.onBtnClick),this.img_pvw.off(Laya.Event.CLICK,this,this.onBtnClick),C.GSM.ins.off(l.SmashPoolGS2C.KEY,this,this.getReward),C.GSM.ins.off(l.BuyHammerMsg.KEY,this,this.buyHammer),C.GSM.ins.off(r.RewardInfoData.KEY,this,this.showNotice),Laya.timer.clearAll(this),this.removeSelf()},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.refresh=function(){this.updateChanged(),this.updateView(this.selectIndex?this.selectIndex:0)},t.prototype.updateUnchanged=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){for(var e,i=u.GameConfig.activityJson[t.cfgId],n=Number(i.value),s=0,o=[],a=[],r=[];s<n;){e=u.GameConfig.subActivityJson[t.children[s].cfgId];var l={};l.tabId=e.id,l.skinName=e.childId,l.iconNum=e.value2,l.resetTime=e.value,l.hammerPrice=e.originalcost[0][1],l.hammerId=e.cost[0][0],l.hammerCostNum=e.cost[0][1],o.push(l);var h=i.showList.slice(20*s,20*(s+1));a.push(h),r.push(e.bonus),s++}this.arr_tabData=o,this.arr_rewardData=a,this.arr_poolData=r,this.setStaticView()}else console.log("没有找到数据，类型：DragonTreasure")},t.prototype.updateChanged=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=u.GameConfig.activityJson[t.cfgId];this.arr_openData=[],this.arr_resetData=[];for(var i=Number(e.value),n=0;n<i;){var s=t.children[n];this.arr_openData.push(s.childCountArr),this.arr_resetData.push(Math.floor(s.count/100)),n++}this.endTime=t.endTime}else console.log("没有找到数据，类型：DragonTreasure")},t.prototype.setStaticView=function(){this.arr_tabBtn=[],this.arr_iconBtn=[];for(var t=this.arr_tabData.length,e=0;e<t;e++){var i=new ktgame.button.KTSingleButton("res/activity/new_activity/longshenbaozang_longshen"+this.arr_tabData[e].skinName+".png","");i.stateNum=2,i.selected=!1,i.on(Laya.Event.CLICK,this,this.tabClick),this.arr_tabBtn.push(i),this.box_tab.addChild(i)}var n=new I.LayoutUtil;n.col=t,n.setConLayout(this.box_tab),this.box_icon.removeChildren();for(e=0;e<20;e++){var s=new h.DragonTreasureItem;s.on(Laya.Event.CLICK,this,this.itemClickHandler),s.isOpen=!1,s.index=e,this.arr_iconBtn.push(s),this.box_icon.addChild(s)}var o=new I.LayoutUtil;o.col=5,o.row=4,o.setConLayout(this.box_icon)},t.prototype.updateView=function(t){this.selectIndex!=t&&(this.selectIndex=t),this.changeTabIndex()},t.prototype.changeTabIndex=function(){var t=this.arr_rewardData[this.selectIndex][0];p.ItemCellUtils.fillCellForItem0View(this.icon_top,t[0],t[1]),d.ItemTips.cellShowTip(this.icon_top,t[0],t[1]);for(var e=this.arr_tabBtn.length,i=0;i<e;i++)this.selectIndex==i?this.arr_tabBtn[i].selected=!0:this.arr_tabBtn[i].selected=!1;this.setIconOpenState(),this.setTxtContent()},t.prototype.setTxtContent=function(){this.totalResetTime=this.arr_tabData[this.selectIndex].resetTime,this.resetTime=this.arr_resetData[this.selectIndex],this.hammerCostNum=this.arr_tabData[this.selectIndex].hammerCostNum,this.hammerNum=c.RoleCenter.instans.vo.bagdata.getItemCount(this.arr_tabData[this.selectIndex].hammerId),this.lab_time.text=this.totalResetTime-this.resetTime+"/"+this.totalResetTime,this.lab_awl.text=this.hammerNum+"/"+this.hammerCostNum;var t=g.ItemUtils.getItemVoById(this.arr_tabData[this.selectIndex].hammerId);this.lmg_awl.skin=g.ItemUtils.getIconById(t.id)},t.prototype.setIconOpenState=function(){for(var t=this.arr_iconBtn.length,e=this.arr_openData[this.selectIndex],i=0;i<t;i++){var n=this.arr_iconBtn[i];if(n.isOpen=!1,0<e.length&&0!=e[i]){n.isOpen=!0,n.index=i;var s=this.arr_poolData[this.selectIndex][e[i]-1];n.setItem(s[0],s[1])}}},t.prototype.countDown=function(){var t=this.endTime-a.ServerTime.serverTime;if(t<0)return this.lab_countDown.text="00:00:00",void Laya.timer.clearAll(this);var e="",i=Math.floor(t/3600/24);0<i&&(e+=v.TextConst.get(8,i));var n=Math.floor(t%86400/3600);e+=10<=n?n+":":"0"+n+":";var s=Math.floor(t%3600/60);e+=10<=s?s+":":"0"+s+":";var o=t%60;e+=10<=o?o:"0"+o,this.lab_countDown.text=e,Laya.timer.loop(1e3,this,this.countDown)},t.prototype.tabClick=function(t){var e=t.target;e.selected||(this.selectIndex=this.arr_tabBtn.indexOf(e),this.changeTabIndex())},t.prototype.itemClickHandler=function(t){var e=t.currentTarget;if(!e.isOpen)if(this.hammerNum<this.hammerCostNum)this.showHammerDlg();else{var i=new l.SmashPoolC2GS;i.activityId=this._activityId,i.index=e.index,i.childId=this.arr_tabData[this.selectIndex].tabId,C.GSM.sendServer(i)}},t.prototype.showHammerDlg=function(){var t={};t.id=this._activityId,t._childId=this.arr_tabData[this.selectIndex].tabId,t.price=this.arr_tabData[this.selectIndex].hammerPrice,t.itemId=this.arr_tabData[this.selectIndex].hammerId;var e=new b.BuyHummerDialog;e.setData(t),e.popup(),this.buyHammerDlg=e},t.prototype.onBtnClick=function(t){switch(t.target){case this.btn_buy:this.showHammerDlg();break;case this.btn_reset:this.resetTime>=this.totalResetTime?_.FE.upItems("重置次数不够"):w.AM.show(v.TextConst.get(1304),Laya.Handler.create(this,this.resetHandler));break;case this.img_pvw:var e=this.arr_rewardData[this.selectIndex],i=new f.DragonTreasureRewardDlg;i.setData(e),y.DialogQueue.getInstance().add(m.DialogIDEnum.DRAGONTREASURE_REWARD,i)}},t.prototype.getReward=function(t){t.activityId==this._activityId&&(c.RoleCenter.instans.addInventoryToC(t.inv),i.GetRewwardCtrl.inventoryAddGS2C(t.inv))},t.prototype.buyHammer=function(t){t.activityId==this._activityId&&(this.buyHammerDlg.close(),this.setTxtContent())},t.prototype.resetHandler=function(){var t=new l.XlResetPoolMsg;t.activityId=this._activityId,t.childId=this.arr_tabData[this.selectIndex].tabId,C.GSM.sendServer(t)},t.prototype.showNotice=function(t){var e=t.infoArr;if(t.id==this._activityId&&3<=e.length){var i=g.ItemUtils.getItemOrEq(+e[2]);this.lab_notice.innerHTML=0<e.length?v.TextConst.get(1158,e[0],e[1],i?i.name:""):""}},t}(ui.activity.pages.DragonTreasureViewUI);e.DragonTreasureView=S}),define("src/g/activity/view/dlg/TimeLimitListShowBoxDlg",["require","exports","src/g/bag/tips/view/ItemTips","../../../../utils/ItemCellUtils"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.list_reward.itemRender=ui.custom.ItemNameViewUI,t.list_reward.renderHandler=new Laya.Handler(t,t.onListRender),t.list_reward.clickHandler=new Laya.Handler(t,t.onMouseListRender),t.btn_close.on(Laya.Event.CLICK,t,t.onClose),t}return __extends(t,e),t.prototype.showBox=function(t){this.list_reward.array=t.itemList,this.popup()},t.prototype.onMouseListRender=function(t){i.ItemTips.ins.showTip(this.list_reward.array[t][0],Number(this.list_reward.array[t][1]))},t.prototype.onListRender=function(t,e){n.ItemCellUtils.fillCellForItemNameView(t,this.list_reward.array[e][0],Number(this.list_reward.array[e][1]))},t.prototype.onClose=function(){this.close()},t}(ui.activity.dlg.TimeLimitListShowBoxDlgUI);e.TimeLimitListShowBoxDlg=s}),define("src/g/activity/view/dlg/TimeLimitListRankDlg",["require","exports","../../../../config/GameConfig","../../../../manager/RoleCenter","src/init/GameMain","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips"],function(t,e,p,d,s,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.arr_rewardData=[],t.tab.selectHandler=new Laya.Handler(t,t.onSwitchRecord),t.list_rank.itemRender=ui.copy.item.PagodaRankItemUI,t.list_rank.renderHandler=new Laya.Handler(t,t.onListRankRender),t.list_rank.scrollBar.elasticDistance=100,t.list_reward.itemRender=ui.activity.item.TimeLimitListRewardItemUI,t.list_reward.renderHandler=new Laya.Handler(t,t.onListRewardRender),t.list_reward.scrollBar.elasticDistance=100,t.view.btn_close.on(Laya.Event.CLICK,t,t.onClose),t.view.btn_back.visible=!1,t}return __extends(t,e),t.prototype.setData=function(t){this.box_rank.visible=!0,this.box_reward.visible=!1,this.tab.selectedIndex=0;var e=p.GameConfig.activityRankJson;for(var i in e){var n=e[i];n.activityId==t.activityId&&this.arr_rewardData.push(n)}for(var s=[],o=t.rankData.length,a=0,r=0,l=0;l<o;l++){var h=t.rankData[l],c=this.arr_rewardData[a],u={};u.index=l,u.name=h.nickname?h.nickname:"虚位以待",u.svrid=h.svrid,h.value1?u.value=h.value1:u.value=c.desc,(c.rank.length<=1||c.rank[1]<=l+1)&&a++,s.push(u),h.username==d.RoleCenter.instans.vo.username&&(r=l+1)}this.list_rank.array=s,this.list_reward.array=this.arr_rewardData,this.lab_myRank.text=0<r?r+"":"未上榜",this.lab_myScore.text=t.myScore+""},t.prototype.onListRankRender=function(t,e){var i=t.dataSource,n="res/activity/new_activity/";t.bg.skin=e<3?(t.lab_rank.visible=!1,t.bg_index.visible=!0,t.bg_index.skin="res/activity/new_activity/paihang_huizhang"+(e+1)+"st.png",n+"paihang"+(e+1)+".png"):(t.lab_rank.visible=!0,t.bg_index.visible=!1,t.lab_rank.changeText((e+1).toString()),n+"paihang.png"),t.lab_name.width=0,t.lab_name.text=i.name,t.imgVip.skin="",t.lab_name.color="#b3af9d",t.lab_server.color="#b3af9d";t.lab_port.color="#b3af9d";0!=i.svrid?(t.lab_server.color=t.lab_name.color=t.lab_port.color=["#ffeb0a","#c47dfc","#70c4ff","#55e42e","#b3af9d"][3<=e?3:e],t.lab_server.text=s.GameMain.getDisSvrId("S_"+i.svrid),t.lab_server.y=t.lab_name.parent.height-t.lab_server.height>>1,t.lab_name.y=t.lab_name.parent.height-t.lab_name.height>>1,t.lab_name.x=t.lab_server.x+t.lab_server.width):(t.lab_server.text="",t.lab_server.width=0,t.lab_name.x=t.lab_name.parent.width-t.lab_name.getBounds().width>>1),t.lab_port.changeText(i.value)},t.prototype.onListRewardRender=function(t,e){var i=t.dataSource;e<3?(t.lab_rank.visible=!1,t.bg_index.visible=!0,t.bg_index.skin="res/activity/new_activity/paihang_huizhang"+(e+1)+"st.png"):(t.lab_rank.visible=!0,t.bg_index.visible=!1,1<i.rank.length?t.lab_rank.changeText(i.rank[0]+"-"+i.rank[1]):t.lab_rank.changeText(i.rank.toString())),t.list_item.itemRender=ui.custom.ItemNameViewUI,t.list_item.renderHandler=new Laya.Handler(this,this.onListCellRender),t.list_item.array=i.bonus},t.prototype.onListCellRender=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1])),n.ItemTips.cellShowTip(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onSwitchRecord=function(t){this._tabIndex=t,0==this._tabIndex?(this.box_rank.visible=!0,this.box_reward.visible=!1):(this.box_rank.visible=!1,this.box_reward.visible=!0)},t.prototype.onClose=function(){this.close()},t}(ui.activity.dlg.TimeLimitListRankDlgUI);e.TimeLimitListRankDlg=o}),define("src/g/activity/view/TimeLimitList",["require","exports","src/g/clearRes/ClearResM","../../../utils/UIUtils","../../../core/E","../../../enum/EventName","../../net/messages/activity/ActivityGet","../../../manager/RoleCenter","../../../config/GameConfig","src/g/activity/view/dlg/TimeLimitListShowBoxDlg","../../../enum/FashionPos","src/g/Effects/UIEffectsFactory","../../../utils/ItemUtils","../../../component/GAnimation","../../net/messages/activity/ActivityTrigger","../../../manager/NewRedHintsCenter","../../net/messages/enumStatus","src/init/TextConst","../../../meta/QualiyVo","src/init/GameMain","../../../utils/system/ServerTime","src/init/Switches","../../../manager/StateManger","src/g/activity/view/dlg/DragonTreasureRewardDlg","../../../utils/DialogQueue","../../../enum/DialogIDEnum","src/g/account/ctrl/GetRewwardCtrl","src/g/activity/view/dlg/TimeLimitListRankDlg","../../../manager/GameSocketManager","../../net/messages/limitedTimeCBMsg","../../../component/LotteryBuyAlert"],function(t,e,i,n,s,o,r,l,a,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E,T,A,R,L,x){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var P=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.cfgId=0,t.allRecordStr="",t.myRecordStr="",t._currRecordIndex=0,t.poolData=[],t.costData={},t.arr_boxData=[],t.arr_mainEUI=[],t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this._des=new laya.html.dom.HTMLDivElement,this._des.width=this.con_log.width=this.con_panel.width,n.UIUtils.initHtmlDiv(this._des,"#b7a675",18,"center"),this._des.style.leading=5,this._des.y=5,this.con_log.removeChildren(),this.con_log.addChild(this._des),this.con_panel.vScrollBar.elasticDistance=100,this.con_log.mouseEnabled=!1,this.tab_record.selectHandler=new Laya.Handler(this,this.onSwitchRecord),s.E.ins.on(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),s.E.ins.on(o.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,this,this.onUpdateLogHandler),e.addChild(this),this.btn_buy1.on(Laya.Event.CLICK,this,this.onBtnClick),this.btn_buy10.on(Laya.Event.CLICK,this,this.onBtnClick),this.lab_rank.on(Laya.Event.CLICK,this,this.onBtnClick),this.btn_pool.on(Laya.Event.CLICK,this,this.onBtnClick),R.GSM.ins.on(L.limitedTimeCBMsgGS2c.KEY,this,this.getReward),R.GSM.ins.on(r.ActivityGetRankGS2C.KEY,this,this.getRank),this.refresh(),this.countDown()},t.prototype.hidePage=function(){s.E.ins.off(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),s.E.ins.off(o.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,this,this.onUpdateLogHandler),this.btn_buy1.off(Laya.Event.CLICK,this,this.onBtnClick),this.btn_buy10.off(Laya.Event.CLICK,this,this.onBtnClick),this.lab_rank.off(Laya.Event.CLICK,this,this.onBtnClick),this.btn_pool.off(Laya.Event.CLICK,this,this.onBtnClick),R.GSM.ins.off(L.limitedTimeCBMsgGS2c.KEY,this,this.getReward),R.GSM.ins.off(r.ActivityGetRankGS2C.KEY,this,this.getRank),Laya.timer.clearAll(this),this.removeSelf()},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.refresh=function(){this.updateChanged(),this.updateView()},t.prototype.updateUnchanged=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=a.GameConfig.activityJson[t.cfgId];this.cfgId=t.cfgId,this.title_img.skin="dynamic/activity/Time_limit_list/"+e.bg_img+".png",this.rewardData=e.showList,this.arr_mainEUI.push(e.showList[0][0]);var i=a.GameConfig.subActivityJson[t.children[0].cfgId];this.childId=i.childId,this.poolData=i.bonus,this.costData.gold1Num=i.originalcost[0][1],this.costData.item1Id=i.originalcost[1][0],this.costData.item1Num=i.originalcost[1][1],this.costData.gold2Num=i.cost[0][1],this.costData.item2Id=i.cost[1][0],this.costData.item2Num=i.cost[1][1],this.arr_mainEUI.push(i.image);var n=t.children.length,s=1;for(this.totalScore=0;s<n;){i=a.GameConfig.subActivityJson[t.children[s].cfgId];var o={};o.tabId=i.id,o.childId=i.childId,o.num=i.value,o.itemList=i.bonus,o.imgIndex=i.value2,o.iconId=i.bonus[0][0],o.iconNum=i.bonus[0][1],this.arr_boxData.push(o),s++}this.totalScore=this.arr_boxData[0],this.setStaticView()}else console.log("没有找到数据，类型：TimeLimitList")},t.prototype.updateChanged=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e;this.curScore=t.allData.allCount;for(var i=t.children.length,n=1;n<i;){e=t.children[n];for(var s=0;s<this.arr_boxData.length;s++){var o=this.arr_boxData[s];o.tabId==e.cfgId&&(o.status,e.status)}this.arr_boxData[n-1].status=e.status,n++}this.endTime=t.endTime}else console.log("没有找到数据，类型：TimeLimitList")},t.prototype.setStaticView=function(){this.showEUI()},t.prototype.showEUI=function(){var t;if(t=a.GameConfig.fashionJson[this.arr_mainEUI[0]]){if(this.loadFasionAni(t),t.position==c.FashionPos.WEAPON){var e=u.UIEffectsFactory.Ins.createSAniById(39,2.5,2.5);u.UIEffectsFactory.Ins.centerSAni4Parent(e,this.box_title)}this.img_title.visible=!1}else if(t=a.GameConfig.titleJSON[this.arr_mainEUI[0]])this.loadTitleAni(t),this.img_title.visible=!1;else{var i=this.arr_mainEUI[1];if(i&&-1!=i.indexOf("EUI")){var n=i.split("_");if(1<n.length)p.ItemUtils.getUIEffectsVoById(Number(n[1]))&&(this.loadUIEffect(Number(n[1])),this.img_title.visible=!1)}}},t.prototype.loadFasionAni=function(t){var e,i,n=l.RoleCenter.instans.vo.getSex(),s=this.box_title.numChildren,o=0,a=t.position;t.position==c.FashionPos.WING?i=0:t.position==c.FashionPos.WEAPON?i=1:t.position==c.FashionPos.FASHION&&(i=2);for(var r=p.ItemUtils.getAvtoarSource(t.res,i,n);o<s;){if(e=this.box_title.getChildAt(o)){e.stop(),e.clear();break}o++}if(e){if(e._url&&e._url==r)return void e.play()}else(e=new d.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,a==c.FashionPos.WING?e.scale(.7,.7):a==c.FashionPos.WEAPON?(e.scale(.55,.55),e.x+=90,e.y+=80):a==c.FashionPos.FASHION&&(a=2,e.y-=50,e.scale(.65,.65)),e.load(r,!0,0,"",0)},t.prototype.loadTitleAni=function(t){for(var e,i="fight/chenghao/"+t.icon+".json",n=this.box_title.numChildren,s=0;s<n;){if(e=this.box_title.getChildAt(s)){e.stop(),e.clear();break}s++}if(e){if(e._url&&e._url==i)return void e.play()}else(e=new d.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,e.scale(1,1),e.load(i)},t.prototype.loadUIEffect=function(t){for(var e,i=u.UIEffectsFactory.Ins.getSourceUrlById(t),n=this.box_title.numChildren,s=0;s<n;){if(e=this.box_title.getChildAt(s)){e.stop(),e.clear();break}s++}if(e){if(e._url&&e._url==i)return void e.play()}else(e=new d.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,e.scale(1,1),e.load(i)},t.prototype.updateView=function(){var t=new g.getRewardInfoRecordC2GS;t.id=this._activityId,R.GSM.sendServer(t),this.setBtnCost(),this.setBox()},t.prototype.setBtnCost=function(){var t=this.costData.gold1Num,e=this.costData.gold2Num;this.gold1.changeText(999<t?t+"(":t+" ("),this.gold10.changeText(999<e?e+"(":e+" (");var i=l.RoleCenter.instans.vo.bagdata.getItemCount(this.costData.item1Id);1<=i?(this.count1.color="#03bb00",v.NewRedHintsCenter.ins.setRedHintOpenOrClose(v.enumRedHints.timeLimitList_btn1,!0)):(this.count1.color="#ff0f15",v.NewRedHintsCenter.ins.setRedHintOpenOrClose(v.enumRedHints.timeLimitList_btn1,!1));var n=l.RoleCenter.instans.vo.bagdata.getItemCount(this.costData.item2Id);10<=n?(this.count10.color="#03bb00",v.NewRedHintsCenter.ins.setRedHintOpenOrClose(v.enumRedHints.timeLimitList_btn2,!0)):(this.count10.color="#ff0f15",v.NewRedHintsCenter.ins.setRedHintOpenOrClose(v.enumRedHints.timeLimitList_btn2,!1)),this.count1.text=i+"/"+this.costData.item1Num,this.count10.text=n+"/"+this.costData.item2Num,this.iconImg1.skin=p.ItemUtils.getIconByIconId(p.ItemUtils.getItemVoById(this.costData.item1Id).icon),this.iconImg10.skin=p.ItemUtils.getIconByIconId(p.ItemUtils.getItemVoById(this.costData.item2Id).icon)},t.prototype.setBox=function(){var t=-1;this.totalScore=this.arr_boxData[0].num;for(var e,i=this.arr_boxData.length,n=0,s=0;s<i;s++){var o=this["img_box"+(s+1)];switch(o.hasListener(Laya.Event.CLICK)&&o.off(Laya.Event.CLICK,this,this.boxClick),this["lab_box"+(s+1)].text=this.arr_boxData[s].num,this["effect"+(s+1)].visible=!1,this.arr_boxData[s].status){case f.enumStatus.yilingqu:o.skin="res/unpack/baoxiang_lv0"+this.arr_boxData[s].imgIndex+"kai.png",o.on(Laya.Event.CLICK,this,this.boxClick,[s,f.enumStatus.yilingqu]);break;case f.enumStatus.kelingqu:o.skin="res/unpack/baoxiang_lv0"+this.arr_boxData[s].imgIndex+".png",o.on(Laya.Event.CLICK,this,this.boxClick,[s,f.enumStatus.kelingqu]),this["effect"+(s+1)].visible=!0;break;case f.enumStatus.weiwancheng:o.skin="res/unpack/baoxiang_lv0"+this.arr_boxData[s].imgIndex+".png",o.on(Laya.Event.CLICK,this,this.boxClick,[s,f.enumStatus.weiwancheng])}this.arr_boxData[s].num<this.curScore&&(t=s,n=this.arr_boxData[s].num,this.totalScore=i<=s+1?this.arr_boxData[s].num:this.arr_boxData[s+1].num)}this.lab_num.text=this.curScore+"",e=i-1<=t?i:(this.curScore-n)/(this.totalScore-n),this.img_progress.scaleX=Math.min(1,(t+1)/i+e/i)},t.prototype.onSwitchRecord=function(t){this._currRecordIndex=t,this._des.innerHTML=0==this._currRecordIndex?this.allRecordStr:this.myRecordStr,this.con_log.height=this._des.contextHeight+20,this.con_panel.vScrollBar.value=0},t.prototype.onUpdateLogHandler=function(t){t.id==this._activityId&&this.appendLog(t)},t.prototype.appendLog=function(t){0==t.type&&(this._des.innerHTML="",this.allRecordStr="",this.myRecordStr="");for(var e=t.infoArr,i=e?e.length:0,n=i-1;0<=n;){var s=this.parseLog(e[n],1);this.appendAllLog(s.serverId,s.nickName,s.itemId,s.itemNum),n-=1}for(n=(i=(e=t.personInfoArr)?e.length:0)-1;0<=n;){s=this.parseLog(e[n],1);this.appendMyLog(s.serverId,s.nickName,s.itemId,s.itemNum),n-=1}},t.prototype.parseLog=function(t,e){var i={},n=t.split(":");return i.itemNum=1==e?(i.serverName=n[0],i.serverId=n[1],i.userName=n[2],i.nickName=n[3],i.itemId=n[4],n[5]):(i.serverName="",i.serverId=l.RoleCenter.instans.self.svrid,i.userName=l.RoleCenter.instans.vo.username,i.nickName=l.RoleCenter.instans.vo.nickname,i.itemId=n[0],n[1]),i},t.prototype.appendMyLog=function(t,e,i,n){var s=y.TextConst.get(226),o="#55e42e",a=p.ItemUtils.getItemOrEq(i);a&&(s=a.name,o=m.QualityStruct.Ins.getQColorById(a.quality));var r=y.TextConst.get(275,_.GameMain.getDisSvrId("S_"+t)+e,o,s,n)+"<br>";this.myRecordStr+=r,1==this._currRecordIndex&&(this._des.appendHTML(r),this.con_log.height=this._des.contextHeight+20,this.con_panel.vScrollBar.value=0)},t.prototype.appendAllLog=function(t,e,i,n){var s=y.TextConst.get(226),o="#55e42e",a=p.ItemUtils.getItemOrEq(i);a&&(s=a.name,o=m.QualityStruct.Ins.getQColorById(a.quality));var r=y.TextConst.get(275,_.GameMain.getDisSvrId("S_"+t)+e,o,s,n)+"<br>";this.allRecordStr+=r,0==this._currRecordIndex&&(this._des.appendHTML(r),this.con_log.height=this._des.contextHeight+20,this.con_panel.vScrollBar.value=0)},t.prototype.countDown=function(){var t=this.endTime-C.ServerTime.serverTime;if(t<0)return this.time_txt.text="00:00:00",void Laya.timer.clearAll(this);var e="",i=Math.floor(t/3600/24);0<i&&(e+=y.TextConst.get(8,i));var n=Math.floor(t%86400/3600);e+=10<=n?n+":":"0"+n+":";var s=Math.floor(t%3600/60);e+=10<=s?s+":":"0"+s+":";var o=t%60;e+=10<=o?o:"0"+o,this.time_txt.text=e,Laya.timer.loop(1e3,this,this.countDown)},t.prototype.luckyDraw=function(t){var e=new L.limitedTimeCBMsgC2GS;e.type=t,e.childId=this.childId,R.GSM.sendServer(e)},t.prototype.boxClick=function(t,e){switch(e){case f.enumStatus.weiwancheng:case f.enumStatus.yilingqu:this.showBoxDlg||(this.showBoxDlg=new h.TimeLimitListShowBoxDlg);var i={};i.itemList=this.arr_boxData[t].itemList,this.showBoxDlg.showBox(i);break;case f.enumStatus.kelingqu:var n=new L.limitedTimeCBMsgC2GS;n.type=L.limitedEnum.box,n.childId=this.arr_boxData[t].childId,R.GSM.sendServer(n)}},t.prototype.onBtnClick=function(t){switch(t.target){case this.btn_buy1:if(l.RoleCenter.instans.vo.bagdata.getItemCount(this.costData.item1Id)<this.costData.item1Num){if(l.RoleCenter.instans.vo.GOLD<this.costData.gold1Num)return void I.Switches.ins.event(155);if(b.StateManger.showLotteryBuyAlert){this.buyAlert||(this.buyAlert=new x.LotteryBuyAlert);var e=this.costData.gold1Num,i=p.ItemUtils.getItemVoById(this.costData.item1Id).name;return void this.buyAlert.showAlert(y.TextConst.get(787,e,i,this.costData.item1Num),Laya.Handler.create(this,this.luckyDraw,[L.limitedEnum.c1]))}}(n=new L.limitedTimeCBMsgC2GS).type=L.limitedEnum.c1,n.childId=this.childId,R.GSM.sendServer(n);break;case this.btn_buy10:if(l.RoleCenter.instans.vo.bagdata.getItemCount(this.costData.item2Id)<this.costData.item2Num){if(l.RoleCenter.instans.vo.GOLD<this.costData.gold2Num)return void I.Switches.ins.event(155);if(b.StateManger.showLotteryBuyAlert){this.buyAlert||(this.buyAlert=new x.LotteryBuyAlert);e=this.costData.gold2Num,i=p.ItemUtils.getItemVoById(this.costData.item2Id).name;return void this.buyAlert.showAlert(y.TextConst.get(787,e,i,this.costData.item2Num),Laya.Handler.create(this,this.luckyDraw,[L.limitedEnum.c10]))}}var n;(n=new L.limitedTimeCBMsgC2GS).type=L.limitedEnum.c10,n.childId=this.childId,R.GSM.sendServer(n);break;case this.lab_rank:var s=new r.ActivityGetRankC2GS;s.id=this._activityId,R.GSM.sendServer(s);break;case this.btn_pool:var o=this.rewardData,a=new w.DragonTreasureRewardDlg;a.setData(o),S.DialogQueue.getInstance().add(E.DialogIDEnum.DRAGONTREASURE_REWARD,a)}},t.prototype.getReward=function(t){for(var e=t.inV.itemList,i=[],n=[],s=0;s<e.length;s+=2){var o=p.ItemUtils.getQualityById(e[s]),a={reward:e[s],count:e[s+1],quality:o};i.push(a)}i.sort(function(t,e){return e.quality-t.quality});for(s=0;s<i.length;s++){a=i[s];n.push(a.reward,a.count)}t.inV.itemList=n,T.GetRewwardCtrl.inventoryAddGS2C(t.inV)},t.prototype.getRank=function(t,e,i){if(t.id==this._activityId){var n={};n.rankData=t.rankArr,n.myScore=this.curScore,n.activityId=this.cfgId;var s=new A.TimeLimitListRankDlg;s.setData(n),S.DialogQueue.getInstance().add(E.DialogIDEnum.TIMELIMITLIST_RANK,s)}},t}(ui.activity.pages.TimeLimitListUI);e.TimeLimitList=P}),define("src/g/activity/view/dlg/PrizeRecordDlg",["require","exports","../../../../utils/UIUtils","../../../../manager/RoleCenter","src/init/TextConst","../../../../utils/ItemUtils","../../../../meta/QualiyVo","src/init/GameMain"],function(t,e,i,s,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.allRecordStr="",t.myRecordStr="",t._currRecordIndex=0,t._des=new laya.html.dom.HTMLDivElement,t._des.width=t.con_log.width=t.con_panel.width,i.UIUtils.initHtmlDiv(t._des,"#b7a675",18,"center"),t._des.style.leading=5,t._des.y=5,t.con_log.removeChildren(),t.con_log.addChild(t._des),t.con_panel.vScrollBar.elasticDistance=100,t.con_log.mouseEnabled=!1,t.btn_close.on(Laya.Event.CLICK,t,t.onClose),t.tab_record.selectHandler=new Laya.Handler(t,t.onSwitchRecord),t}return __extends(t,e),t.prototype.onClose=function(){this.close()},t.prototype.setData=function(t){this.con_log.removeChildren(),this.con_log.addChild(this._des),this.appendLog(t)},t.prototype.onSwitchRecord=function(t){this._currRecordIndex=t,this._des.innerHTML=0==this._currRecordIndex?this.allRecordStr:this.myRecordStr,this.con_log.height=this._des.contextHeight+20,this.con_panel.vScrollBar.value=0},t.prototype.appendLog=function(t){0==t.type&&(this._des.innerHTML="",this.allRecordStr="",this.myRecordStr="");for(var e=t.infoArr,i=e?e.length:0,n=i-1;0<=n;){var s=this.parseLog(e[n],1);this.appendAllLog(s.serverId,s.nickName,s.itemId,s.itemNum),n-=1}for(n=(i=(e=t.personInfoArr)?e.length:0)-1;0<=n;){s=this.parseLog(e[n],1);this.appendMyLog(s.serverId,s.nickName,s.itemId,s.itemNum),n-=1}},t.prototype.parseLog=function(t,e){var i={},n=t.split(":");return i.itemNum=1==e?(i.serverName=n[0],i.serverId=n[1],i.userName=n[2],i.nickName=n[3],i.itemId=n[4],n[5]):(i.serverName="",i.serverId=s.RoleCenter.instans.self.svrid,i.userName=s.RoleCenter.instans.vo.username,i.nickName=s.RoleCenter.instans.vo.nickname,i.itemId=n[0],n[1]),i},t.prototype.appendMyLog=function(t,e,i,n){var s=l.TextConst.get(226),o="#55e42e",a=h.ItemUtils.getItemOrEq(i);a&&(s=a.name,o=c.QualityStruct.Ins.getQColorById(a.quality));var r=l.TextConst.get(1159,u.GameMain.getDisSvrId("S_"+t)+e,o,s,n)+"<br>";this.myRecordStr+=r,1==this._currRecordIndex&&(this._des.appendHTML(r),this.con_log.height=this._des.contextHeight+20,this.con_panel.vScrollBar.value=0)},t.prototype.appendAllLog=function(t,e,i,n){var s=l.TextConst.get(226),o="#55e42e",a=h.ItemUtils.getItemOrEq(i);a&&(s=a.name,o=c.QualityStruct.Ins.getQColorById(a.quality));var r=l.TextConst.get(275,u.GameMain.getDisSvrId("S_"+t)+e,o,s,n)+"<br>";this.allRecordStr+=r,0==this._currRecordIndex&&(this._des.appendHTML(r),this.con_log.height=this._des.contextHeight+20,this.con_panel.vScrollBar.value=0)},t}(ui.activity.dlg.PrizeRecordDlgUI);e.PrizeRecordDlg=n}),define("src/g/activity/view/pages/FireWorksPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../utils/ItemUtils","../../../../component/GAnimation","../../../../enum/FashionPos","src/g/Effects/UIEffectsFactory","../../../../manager/NewRedHintsCenter","../../../../utils/system/ServerTime","src/init/TextConst","src/init/Switches","../../../../manager/StateManger","../../../net/messages/activity/ActivityTrigger","src/g/activity/view/dlg/PrizeRecordDlg","../../../../utils/DialogQueue","../../../../enum/DialogIDEnum","src/g/account/ctrl/GetRewwardCtrl","../../../../manager/GameSocketManager","../../../net/messages/limitedTimeCBMsg","../../../../component/LotteryBuyAlert"],function(t,e,i,n,s,h,o,a,r,c,u,p,d,l,g,v,f,y,m,_,C,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var T=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.cfgId=0,t.costData={},t.row=1,t.fightNum=0,t.desc="",t.imgSkin="",t.iconId=0,t.arr_mainEUI=[],t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,this,this.onUpdateLogHandler),e.addChild(this),this.btn_buy1.on(Laya.Event.CLICK,this,this.onBtnClick),this.btn_buy10.on(Laya.Event.CLICK,this,this.onBtnClick),this.lab_record.on(Laya.Event.CLICK,this,this.onBtnClick),w.GSM.ins.on(S.limitedTimeCBMsgGS2c.KEY,this,this.getReward),this.refresh(),this.countDown()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.off(s.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,this,this.onUpdateLogHandler),this.btn_buy1.off(Laya.Event.CLICK,this,this.onBtnClick),this.btn_buy10.off(Laya.Event.CLICK,this,this.onBtnClick),this.lab_record.off(Laya.Event.CLICK,this,this.onBtnClick),w.GSM.ins.off(S.limitedTimeCBMsgGS2c.KEY,this,this.getReward),Laya.timer.clearAll(this),this.removeSelf()},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.refresh=function(){this.updateChanged(),this.updateView()},t.prototype.updateUnchanged=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=o.GameConfig.activityJson[t.cfgId];this.cfgId=t.cfgId,this.rewardData=e.showList,this.imgSkin=e.bg_img,this.arr_mainEUI.push(e.showList[0][0]);var i=o.GameConfig.subActivityJson[t.children[0].cfgId];this.childId=i.childId,this.row=i.value,this.fightNum=i.value2,this.desc=i.title,this.arr_mainEUI.push(i.image),this.costData.gold1Num=i.originalcost[0][1],this.costData.item1Id=i.originalcost[1][0],this.costData.item1Num=i.originalcost[1][1],this.costData.gold2Num=i.cost[0][1],this.costData.item2Id=i.cost[1][0],this.costData.item2Num=i.cost[1][1],this.iconId=this.costData.item1Id,this.setStaticView()}else console.log("没有找到数据，类型：TimeLimitList")},t.prototype.updateChanged=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){this.buyTime=t.allData.allCount;for(var e=t.children.length,i=1;i<e;)t.children[i],i++;this.endTime=t.endTime}else console.log("没有找到数据，类型：TimeLimitList")},t.prototype.setStaticView=function(){var t=this;this.showEUI(),this.img_tag.skin="dynamic/activity/Fireworks/"+this.imgSkin+".png",this.lab_fight.value="+"+this.fightNum,console.log(this.box_fight.width,this.lab_fight.width),Laya.timer.frameOnce(1,this,function(){t.box_fight.centerX=0}),this.lab_desc.text=this.desc,a.ItemCellUtils.fillCellForItem0View(this.icon,this.iconId,1),r.ItemTips.cellShowTip(this.icon,this.iconId,1),this.list.itemRender=ui.custom.Item0ViewUI,this.list.renderHandler=new Laya.Handler(this,this.onListRender),this.list.repeatX=this.row,this.list.array=this.rewardData},t.prototype.onListRender=function(t,e){t.scaleX=t.scaleY=.8,a.ItemCellUtils.fillCellForItem0View(t,this.list.array[e][0],Number(this.list.array[e][1])),r.ItemTips.cellShowTip(t,this.list.array[e][0],Number(this.list.array[e][1]))},t.prototype.showEUI=function(){var t;if(t=o.GameConfig.fashionJson[this.arr_mainEUI[0]])this.loadFasionAni(t),this.img_title.visible=!1;else if(t=o.GameConfig.titleJSON[this.arr_mainEUI[0]])this.loadTitleAni(t),this.img_title.visible=!1;else{var e=this.arr_mainEUI[1];if(e&&-1!=e.indexOf("EUI")){var i=e.split("_");if(1<i.length)c.ItemUtils.getUIEffectsVoById(Number(i[1]))&&(this.loadUIEffect(Number(i[1])),this.img_title.visible=!1)}}},t.prototype.loadFasionAni=function(t){var e,i,n=h.RoleCenter.instans.vo.getSex(),s=this.box_title.numChildren,o=0,a=t.position;t.position==p.FashionPos.WING?i=0:t.position==p.FashionPos.WEAPON?i=1:t.position==p.FashionPos.FASHION&&(i=2);for(var r=c.ItemUtils.getAvtoarSource(t.res,i,n);o<s;){if(e=this.box_title.getChildAt(o)){e.stop(),e.clear();break}o++}if(e){if(e._url&&e._url==r)return void e.play()}else(e=new u.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);if(e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,a==p.FashionPos.WING)e.scale(.7,.7);else if(a==p.FashionPos.WEAPON){e.scale(.55,.55),e.x+=90,e.y+=80;var l=d.UIEffectsFactory.Ins.createSAniById(39,2.5,2.5);d.UIEffectsFactory.Ins.centerSAni4Parent(l,this.box_title)}else a==p.FashionPos.FASHION&&(a=2,e.y-=50,e.scale(.65,.65));e.load(r)},t.prototype.loadTitleAni=function(t){for(var e,i="fight/chenghao/"+t.icon+".json",n=this.box_title.numChildren,s=0;s<n;){if(e=this.box_title.getChildAt(s)){e.stop(),e.clear();break}s++}if(e){if(e._url&&e._url==i)return void e.play()}else(e=new u.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,e.scale(1,1),e.load(i)},t.prototype.loadUIEffect=function(t){for(var e,i=d.UIEffectsFactory.Ins.getSourceUrlById(t),n=this.box_title.numChildren,s=0;s<n;){if(e=this.box_title.getChildAt(s)){e.stop(),e.clear();break}s++}if(e){if(e._url&&e._url==i)return void e.play()}else(e=new u.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,e.scale(1,1),e.load(i)},t.prototype.updateView=function(){this.setBtnCost(),this.lab_time.text=this.buyTime+"",this.box_time.refresh()},t.prototype.setBtnCost=function(){var t=this.costData.gold1Num,e=this.costData.gold2Num;this.gold1.changeText(999<t?t+"(":t+" ("),this.gold10.changeText(999<e?e+"(":e+" (");var i=h.RoleCenter.instans.vo.bagdata.getItemCount(this.costData.item1Id);1<=i?(this.count1.color="#03bb00",l.NewRedHintsCenter.ins.setRedHintOpenOrClose(l.enumRedHints.fireworks_btn1,!0)):(this.count1.color="#ff0f15",l.NewRedHintsCenter.ins.setRedHintOpenOrClose(l.enumRedHints.fireworks_btn1,!1));var n=h.RoleCenter.instans.vo.bagdata.getItemCount(this.costData.item2Id);10<=n?(this.count10.color="#03bb00",l.NewRedHintsCenter.ins.setRedHintOpenOrClose(l.enumRedHints.fireworks_btn2,!0)):(this.count10.color="#ff0f15",l.NewRedHintsCenter.ins.setRedHintOpenOrClose(l.enumRedHints.fireworks_btn2,!1)),this.count1.text=i+"/"+this.costData.item1Num,this.count10.text=n+"/"+this.costData.item2Num,this.iconImg1.skin=c.ItemUtils.getIconByIconId(c.ItemUtils.getItemVoById(this.costData.item1Id).icon),this.iconImg10.skin=c.ItemUtils.getIconByIconId(c.ItemUtils.getItemVoById(this.costData.item2Id).icon)},t.prototype.countDown=function(){var t=this.endTime-g.ServerTime.serverTime;if(t<0)return this.time_txt.text="00:00:00",void Laya.timer.clearAll(this);var e="",i=Math.floor(t/3600/24);0<i&&(e+=v.TextConst.get(8,i));var n=Math.floor(t%86400/3600);e+=10<=n?n+":":"0"+n+":";var s=Math.floor(t%3600/60);e+=10<=s?s+":":"0"+s+":";var o=t%60;e+=10<=o?o:"0"+o,this.time_txt.text=e,Laya.timer.loop(1e3,this,this.countDown)},t.prototype.luckyDraw=function(t){var e=new S.limitedTimeCBMsgC2GS;e.type=t,e.childId=this.childId,w.GSM.sendServer(e)},t.prototype.onBtnClick=function(t){switch(t.target){case this.btn_buy1:if(h.RoleCenter.instans.vo.bagdata.getItemCount(this.costData.item1Id)<this.costData.item1Num){if(h.RoleCenter.instans.vo.GOLD<this.costData.gold1Num)return void f.Switches.ins.event(155);if(y.StateManger.showLotteryBuyAlert){this.buyAlert||(this.buyAlert=new E.LotteryBuyAlert);var e=this.costData.gold1Num,i=c.ItemUtils.getItemVoById(this.costData.item1Id).name;return void this.buyAlert.showAlert(v.TextConst.get(787,e,i,this.costData.item1Num),Laya.Handler.create(this,this.luckyDraw,[S.limitedEnum.y1]))}}(n=new S.limitedTimeCBMsgC2GS).type=S.limitedEnum.y1,n.childId=this.childId,w.GSM.sendServer(n);break;case this.btn_buy10:if(h.RoleCenter.instans.vo.bagdata.getItemCount(this.costData.item2Id)<this.costData.item2Num){if(h.RoleCenter.instans.vo.GOLD<this.costData.gold2Num)return void f.Switches.ins.event(155);if(y.StateManger.showLotteryBuyAlert){this.buyAlert||(this.buyAlert=new E.LotteryBuyAlert);e=this.costData.gold2Num,i=c.ItemUtils.getItemVoById(this.costData.item2Id).name;return void this.buyAlert.showAlert(v.TextConst.get(787,e,i,this.costData.item2Num),Laya.Handler.create(this,this.luckyDraw,[S.limitedEnum.y10]))}}var n;(n=new S.limitedTimeCBMsgC2GS).type=S.limitedEnum.y10,n.childId=this.childId,w.GSM.sendServer(n);break;case this.lab_record:var s=new m.getRewardInfoRecordC2GS;s.id=this._activityId,w.GSM.sendServer(s)}},t.prototype.onUpdateLogHandler=function(t){if(t.id==this._activityId){var e=new _.PrizeRecordDlg;e.setData(t),C.DialogQueue.getInstance().add(I.DialogIDEnum.PRIZERECORD,e)}},t.prototype.getReward=function(t){for(var e=t.inV.itemList,i=[],n=[],s=0;s<e.length;s+=2){var o=c.ItemUtils.getQualityById(e[s]),a={reward:e[s],count:e[s+1],quality:o};i.push(a)}i.sort(function(t,e){return e.quality-t.quality});for(s=0;s<i.length;s++){a=i[s];n.push(a.reward,a.count)}t.inV.itemList=n,b.GetRewwardCtrl.inventoryAddGS2C(t.inV)},t}(ui.activity.pages.FireworksPageUI);e.FireWorksPage=T}),define("src/g/activity/view/pages/GroupDiscountPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/GameSocketManager","../../../../manager/ActivityManager","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/system/ServerTime","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../utils/ItemUtils","src/init/TextConst","src/init/Switches","src/g/account/ctrl/GetRewwardCtrl","../../../../manager/AM","../../../../utils/ScrollBoxUtil","../../../net/messages/activity/ActivityTrigger"],function(t,e,i,n,s,o,a,r,l,h,b,w,S,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.cfgId=0,t.selectIndex=0,t.imgSkin="",t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this),this.btn_buy.on(Laya.Event.CLICK,this,this.onBtnClick),o.GSM.ins.on(v.GroupDiscountBuyRewardGS2C.KEY,this,this.getReward),o.GSM.ins.on(v.getSystemActivityDataGS2C.KEY,this,this.getSystemData),this.refresh(),this.countDown(),a.ActivityManager.ins.activityRead(this._activityId)},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.btn_buy.off(Laya.Event.CLICK,this,this.onBtnClick),o.GSM.ins.off(v.GroupDiscountBuyRewardGS2C.KEY,this,this.getReward),o.GSM.ins.off(v.getSystemActivityDataGS2C.KEY,this,this.getSystemData),Laya.timer.clearAll(this),this.removeSelf(),i.ClearResM.clearFolderByUrl("ui/activity/groupDiscount/"),i.ClearResM.clearViewSkin(this)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.refresh=function(){this.updateChanged()},t.prototype.updateUnchanged=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e,i=l.GameConfig.activityJson[t.cfgId];this.cfgId=t.cfgId,this.imgSkin=i.bg_img,this.rentou=Number(i.value),this.arr_staticData=[],this.arr_itemData=[];for(var n=t.children.length,s=0;s<n;){e=l.GameConfig.subActivityJson[t.children[s].cfgId];var o={};o.tabId=e.id,o.childId=e.childId,o.num=e.value2,o.iconId=e.bonus[0][0],o.iconNum=e.bonus[0][1],o.cost=e.originalcost[0][1],o.zheData=e.cost,this.arr_staticData.push(o),this.arr_itemData.push(e.bonus[0][0]),s++}this.setStaticView()}else console.log("没有找到数据，类型：GroupDiscountPage")},t.prototype.updateChanged=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e;this.allCostGold=t.allData.allCount,this.arr_countData=[],this.arr_buyData=[];for(var i=t.children.length,n=0;n<i;)e=t.children[n],this.arr_countData.push(e.value),this.arr_buyData.push(e.count),n++;var s=new v.getSystemActivityDataC2GS;s.id=this._activityId,o.GSM.sendServer(s),this.endTime=t.endTime}else console.log("没有找到数据，类型：GroupDiscountPage")},t.prototype.getSystemData=function(t){var e=t.systemAd;if(e){var i;this.arr_peopleData=[];for(var n=e.children.length,s=0;s<n;){i=e.children[s];var o=Math.floor((h.ServerTime.serverTime-e.startTime)/3600)*this.rentou;this.arr_peopleData.push(i.count+o),s++}this.updateView()}else console.log("没有找到数据，类型：GroupDiscountPage")},t.prototype.setStaticView=function(){this.img_bg.skin="dynamic/activity/groupDiscount/"+this.imgSkin+".jpg",this.scrollUtil=new g.ScrollBoxUtil,this.scrollUtil.bindContent(this.panel_con,this.box_con,this.btn_left,this.btn_right),this.scrollUtil.itemRender=ui.custom.ItemNameViewUI,this.scrollUtil.itemRenderHandler=Laya.Handler.create(this,this.onListRender,null,!1),this.scrollUtil.selectedHandler=Laya.Handler.create(this,this.changeItemSelect,null,!1),this.scrollUtil.itemScale=.8,this.scrollUtil.setData(this.arr_itemData)},t.prototype.changeItemSelect=function(t,e,i){(t.item.img_select.visible=i)&&(this.selectIndex=e,this.updateShowView(e))},t.prototype.onListRender=function(t,e){t.scaleX=t.scaleY=.8,b.ItemCellUtils.fillCellForItemNameView(t,this.arr_itemData[e],1)},t.prototype.updateView=function(){this.scrollUtil.selectedIndex=this.selectIndex},t.prototype.updateShowView=function(t){this.itemData={};var e=this.arr_staticData[t];this.tabId=e.tabId;for(var i=e.zheData.length,n=0;n<i;n++)this["lab_zhe"+n].value=e.zheData[n][0],this["lab_people"+n].text=e.zheData[n][1]+"人";b.ItemCellUtils.fillCellForItem0View(this.item,e.iconId,e.iconNum),w.ItemTips.cellShowTip(this.item,e.iconId,e.iconNum),this.lab_itemName.text=S.ItemUtils.getItemOrEq(e.iconId).name;var s=e.num-this.arr_countData[t];this.lab_count.text=(s<0?0:s)+"/"+e.num+"次",this.btn_buy.disabled=s<=0;for(var o,a,r=e.zheData,l=this.arr_peopleData[t],h=0,c=0,u=0;u<r.length;u++){if(l<r[u][1]){a=r[u][1];break}c=r[h=u][0],o=r[u][1]}var p=0<a?25*h+(l-o)/(a-o)*25:100;this.img_progress.scaleX=p/100,this.lab_allPeople.text=l+"",this.lab_curZhe.text=c+"折",this.lab_cost1.text=e.cost+"",this.lab_cost2.text=Math.floor(e.cost*c/10)+"",this.curCost=Math.floor(e.cost*c/10);for(var d=0,g=0;g<this.arr_peopleData.length;g++){var v=this.arr_peopleData[g],f=this.arr_buyData[g];if(0!=v){for(var y=0,m=this.arr_staticData[g].zheData,_=this.arr_staticData[g].cost,C=0;C<m.length&&!(v<m[C][1]);C++)y=m[C][0];d+=Math.floor(_*y/10)*f}}var I=this.allCostGold-d;this.lab_returnGold.value=(I<0?0:I)+""},t.prototype.countDown=function(){var t=this.endTime-h.ServerTime.serverTime;if(t<0)return this.lab_countDown.text="00:00:00",void Laya.timer.clearAll(this);var e="",i=Math.floor(t/3600/24),n=Math.floor(t%86400/3600),s=Math.floor(t%3600/60),o=t%60;0<i?(e+=c.TextConst.get(8,i),e+=10<=n?c.TextConst.get(9,n):"0"+c.TextConst.get(9,n),e+=10<=s?c.TextConst.get(11,s):"0"+c.TextConst.get(11,s)):(e+=10<=n?n+":":"0"+n+":",e+=10<=s?s+":":"0"+s+":",e+=10<=o?o:"0"+o),this.lab_countDown.text=e,Laya.timer.loop(1e3,this,this.countDown)},t.prototype.onBtnClick=function(t){switch(t.target){case this.btn_buy:if(!r.RoleCenter.instans.bagRoomEnough())return void d.AM.showBagNotEnough();if(r.RoleCenter.instans.vo.GOLD<this.curCost)return void u.Switches.ins.event(155);var e=new v.GroupDiscountBuyRewardC2GS;e.activityId=this._activityId,e.cfg2Id=this.tabId,o.GSM.sendServer(e)}},t.prototype.getReward=function(t){r.RoleCenter.instans.addInventoryToC(t.inv);for(var e=t.inv.itemList,i=[],n=[],s=0;s<e.length;s+=2){var o=S.ItemUtils.getQualityById(e[s]),a={reward:e[s],count:e[s+1],quality:o};i.push(a)}i.sort(function(t,e){return e.quality-t.quality});for(s=0;s<i.length;s++){a=i[s];n.push(a.reward,a.count)}t.inv.itemList=n,p.GetRewwardCtrl.inventoryAddGS2C(t.inv)},t}(ui.activity.pages.GroupDiscountUI);e.GroupDiscountPage=f}),define("src/g/activity/view/pages/Identify_Gem3",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../utils/UIUtils","../../../net/messages/activity/ActivityTrigger","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","src/init/TextConst","../../../../enum/FashionPos","src/g/Effects/UIEffectsFactory","../../../../utils/ItemUtils","../../../../component/GAnimation","../../../../manager/NewRedHintsCenter","../../../../utils/system/ServerTime","src/init/Switches","../../../../manager/StateManger","../../../../manager/RuledescManager","src/g/account/ctrl/GetRewwardCtrl","../../../../meta/QualiyVo","src/init/GameMain","../../../../manager/GameSocketManager","../../../../manager/AM","../../../../component/LotteryBuyAlert"],function(t,e,i,n,s,o,a,l,r,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E,T){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var A=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.cfgId=0,t.costData={},t.arr_mainEUI=[],t.allRecordStr="",t.myRecordStr="",t._currRecordIndex=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,this,this.onUpdateLogHandler),this._des=new laya.html.dom.HTMLDivElement,this._des.width=this.con_log.width=this.con_panel.width,o.UIUtils.initHtmlDiv(this._des,"#b7a675",18,"left"),this._des.style.leading=5,this._des.y=5,this.con_log.removeChildren(),this.con_log.addChild(this._des),this.con_panel.vScrollBar.elasticDistance=100,this.con_log.mouseEnabled=!1,this._currRecordIndex=0,this._des.innerHTML=0==this._currRecordIndex?this.allRecordStr:this.myRecordStr,this.con_log.height=this._des.contextHeight+20,this.con_panel.vScrollBar.value=0,e.addChild(this),this.btn_buy1.on(Laya.Event.CLICK,this,this.onBtnClick),this.btn_buy10.on(Laya.Event.CLICK,this,this.onBtnClick),this.lab_prob.on(Laya.Event.CLICK,this,this.onBtnClick),S.GSM.ins.on(a.ActivityRewardGS2C.KEY,this,this.getReward),this.refresh(),this.countDown()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.btn_buy1.off(Laya.Event.CLICK,this,this.onBtnClick),this.btn_buy10.off(Laya.Event.CLICK,this,this.onBtnClick),this.lab_prob.off(Laya.Event.CLICK,this,this.onBtnClick),n.E.ins.off(s.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,this,this.onUpdateLogHandler),S.GSM.ins.off(a.ActivityRewardGS2C.KEY,this,this.getReward),Laya.timer.clearAll(this),this.removeSelf(),i.ClearResM.clearFolderByUrl("ui/activity/Identify_Gem3/"),i.ClearResM.clearViewSkin(this)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.refresh=function(){this.updateChanged(),this.updateView()},t.prototype.updateUnchanged=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=r.GameConfig.activityJson[t.cfgId];this.cfgId=t.cfgId,this.probStr=e.desc,this.itemData=e.showList,this.arr_mainEUI.push(e.showList[0][0]);var i=r.GameConfig.subActivityJson[t.children[0].cfgId];this.tabId=i.id,this.costData.gold1Num=i.cost[0][1],this.costData.item1Id=i.cost[1][0],this.costData.item1Num=i.cost[1][1],this.costData.gold2Num=10*i.cost[0][1],this.costData.item2Id=i.cost[1][0],this.costData.item2Num=10*i.cost[1][1],this.arr_mainEUI.push(i.image);for(var n=t.children.length,s=0;s<n;)i=r.GameConfig.subActivityJson[t.children[s].cfgId],s++;this.setStaticView()}else console.log("没有找到数据，类型：TimeLimitList")},t.prototype.updateChanged=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){this.freeCount=t.allData.time,this.tenCount=t.recharge;for(var e=t.children.length,i=0;i<e;)t.children[i],i++;this.endTime=t.endTime}else console.log("没有找到数据，类型：Identify_Gem3")},t.prototype.setStaticView=function(){this.showEUI(),h.ItemCellUtils.fillCellForItem0View(this.item,this.itemData[1][0],this.itemData[1][1]),c.ItemTips.cellShowTip(this.item,this.itemData[1][0],this.itemData[1][1]);for(var t=this.box_item.numChildren,e=0;e<t;e++){var i=this.box_item.getChildAt(e),n=this.itemData[e+2];h.ItemCellUtils.fillCellForItemNameView(i,n[0],n[1]),c.ItemTips.cellShowTip(i,n[0],n[1])}this.lab_desc.text=u.TextConst.get(1184)},t.prototype.showEUI=function(){var t;if(t=r.GameConfig.fashionJson[this.arr_mainEUI[0]]){if(this.loadFasionAni(t),t.position==p.FashionPos.WEAPON){var e=d.UIEffectsFactory.Ins.createSAniById(39,2.5,2.5);d.UIEffectsFactory.Ins.centerSAni4Parent(e,this.box_title)}this.img_title.visible=!1}else if(t=r.GameConfig.titleJSON[this.arr_mainEUI[0]])this.loadTitleAni(t),this.img_title.visible=!1;else{var i=this.arr_mainEUI[1];if(i&&-1!=i.indexOf("EUI")){var n=i.split("_");if(1<n.length)g.ItemUtils.getUIEffectsVoById(Number(n[1]))&&(this.loadUIEffect(Number(n[1])),this.img_title.visible=!1)}}},t.prototype.loadFasionAni=function(t){var e,i,n=l.RoleCenter.instans.vo.getSex(),s=this.box_title.numChildren,o=0,a=t.position;t.position==p.FashionPos.WING?i=0:t.position==p.FashionPos.WEAPON?i=1:t.position==p.FashionPos.FASHION&&(i=2);for(var r=g.ItemUtils.getAvtoarSource(t.res,i,n);o<s;){if(e=this.box_title.getChildAt(o)){e.stop(),e.clear();break}o++}if(e){if(e._url&&e._url==r)return void e.play()}else(e=new v.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,a==p.FashionPos.WING?e.scale(.7,.7):a==p.FashionPos.WEAPON?(e.scale(.55,.55),e.x+=50,e.y+=10):a==p.FashionPos.FASHION&&(a=2,e.y-=50,e.scale(.65,.65)),e.load(r,!0,0,"",0)},t.prototype.loadTitleAni=function(t){for(var e,i="fight/chenghao/"+t.icon+".json",n=this.box_title.numChildren,s=0;s<n;){if(e=this.box_title.getChildAt(s)){e.stop(),e.clear();break}s++}if(e){if(e._url&&e._url==i)return void e.play()}else(e=new v.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,e.scale(1,1),e.load(i)},t.prototype.loadUIEffect=function(t){for(var e,i=d.UIEffectsFactory.Ins.getSourceUrlById(t),n=this.box_title.numChildren,s=0;s<n;){if(e=this.box_title.getChildAt(s)){e.stop(),e.clear();break}s++}if(e){if(e._url&&e._url==i)return void e.play()}else(e=new v.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,e.scale(1,1),e.load(i)},t.prototype.updateView=function(){var t=new a.getRewardInfoRecordC2GS;t.id=this._activityId,S.GSM.sendServer(t),this.setBtnCost(),0<this.freeCount?(this.box_cost.visible=!0,this.lab_free.visible=!1):(this.box_cost.visible=!1,this.lab_free.visible=!0),0<this.tenCount?this.box_icon.visible=!1:this.box_icon.visible=!0},t.prototype.setBtnCost=function(){var t=this.costData.gold1Num,e=this.costData.gold2Num;this.gold1.changeText(999<t?t+"(":t+" ("),this.gold10.changeText(999<e?e+"(":e+" (");var i=l.RoleCenter.instans.vo.bagdata.getItemCount(this.costData.item1Id);1<=i?(this.count1.color="#03bb00",f.NewRedHintsCenter.ins.setRedHintOpenOrClose(f.enumRedHints.Identify_Gem3_btn1,!0)):(this.count1.color="#ff0f15",f.NewRedHintsCenter.ins.setRedHintOpenOrClose(f.enumRedHints.Identify_Gem3_btn1,!1));var n=l.RoleCenter.instans.vo.bagdata.getItemCount(this.costData.item2Id);10<=n?(this.count10.color="#03bb00",f.NewRedHintsCenter.ins.setRedHintOpenOrClose(f.enumRedHints.Identify_Gem3_btn2,!0)):(this.count10.color="#ff0f15",f.NewRedHintsCenter.ins.setRedHintOpenOrClose(f.enumRedHints.Identify_Gem3_btn2,!1)),this.count1.text=i+"/"+this.costData.item1Num,this.count10.text=n+"/"+this.costData.item2Num,this.iconImg1.skin=g.ItemUtils.getIconByIconId(g.ItemUtils.getItemVoById(this.costData.item1Id).icon),this.iconImg10.skin=g.ItemUtils.getIconByIconId(g.ItemUtils.getItemVoById(this.costData.item2Id).icon)},t.prototype.countDown=function(){var t=this.endTime-y.ServerTime.serverTime;if(t<0)return this.lab_countDown.text="00:00:00",void Laya.timer.clearAll(this);var e="",i=Math.floor(t/3600/24),n=Math.floor(t%86400/3600),s=Math.floor(t%3600/60),o=t%60;0<i?(e+=u.TextConst.get(8,i),e+=10<=n?u.TextConst.get(9,n):"0"+u.TextConst.get(9,n),e+=10<=s?u.TextConst.get(11,s):"0"+u.TextConst.get(11,s)):(e+=10<=n?n+":":"0"+n+":",e+=10<=s?s+":":"0"+s+":",e+=10<=o?o:"0"+o),this.lab_countDown.text=e,Laya.timer.loop(1e3,this,this.countDown)},t.prototype.onBtnClick=function(t){switch(t.target){case this.btn_buy1:if(!l.RoleCenter.instans.bagRoomEnough())return void E.AM.showBagNotEnough();if(l.RoleCenter.instans.vo.bagdata.getItemCount(this.costData.item1Id)<this.costData.item1Num){if(l.RoleCenter.instans.vo.GOLD<this.costData.gold1Num)return void m.Switches.ins.event(155);if(_.StateManger.showLotteryBuyAlert){this.buyAlert||(this.buyAlert=new T.LotteryBuyAlert);var e=this.costData.gold1Num,i=g.ItemUtils.getItemVoById(this.costData.item1Id).name;return void this.buyAlert.showAlert(u.TextConst.get(787,e,i,this.costData.item1Num),Laya.Handler.create(this,this.luckyDraw,[1]))}}(n=new a.identifyGem3C2GS).id=this._activityId,n.activity2CfgId=this.tabId,n.time=1,S.GSM.sendServer(n);break;case this.btn_buy10:if(!l.RoleCenter.instans.bagRoomEnough())return void E.AM.showBagNotEnough();if(l.RoleCenter.instans.vo.bagdata.getItemCount(this.costData.item2Id)<this.costData.item2Num){if(l.RoleCenter.instans.vo.GOLD<this.costData.gold2Num)return void m.Switches.ins.event(155);if(_.StateManger.showLotteryBuyAlert){this.buyAlert||(this.buyAlert=new T.LotteryBuyAlert);e=this.costData.gold2Num,i=g.ItemUtils.getItemVoById(this.costData.item2Id).name;return void this.buyAlert.showAlert(u.TextConst.get(787,e,i,this.costData.item2Num),Laya.Handler.create(this,this.luckyDraw,[10]))}}var n;(n=new a.identifyGem3C2GS).id=this._activityId,n.activity2CfgId=this.tabId,n.time=10,S.GSM.sendServer(n);break;case this.lab_prob:C.RuledescManager.showRuledesc(-1,null,this.probStr)}},t.prototype.luckyDraw=function(t){var e=new a.identifyGem3C2GS;e.id=this._activityId,e.activity2CfgId=this.tabId,e.time=t,S.GSM.sendServer(e)},t.prototype.getReward=function(t){for(var e=t.inv.itemList,i=[],n=[],s=0;s<e.length;s+=2){var o=g.ItemUtils.getQualityById(e[s]),a={reward:e[s],count:e[s+1],quality:o};i.push(a)}i.sort(function(t,e){return e.quality-t.quality});for(s=0;s<i.length;s++){a=i[s];n.push(a.reward,a.count)}t.inv.itemList=n,I.GetRewwardCtrl.inventoryAddGS2C(t.inv)},t.prototype.onUpdateLogHandler=function(t){t.id==this._activityId&&this.appendLog(t)},t.prototype.appendLog=function(t){0==t.type&&(this._des.innerHTML="",this.allRecordStr="",this.myRecordStr="");for(var e=t.infoArr,i=e?e.length:0,n=i-1;0<=n;){var s=this.parseLog(e[n],1);this.appendAllLog(s.serverId,s.nickName,s.itemId,s.itemNum),n-=1}for(n=(i=(e=t.personInfoArr)?e.length:0)-1;0<=n;){s=this.parseLog(e[n],1);this.appendMyLog(s.serverId,s.nickName,s.itemId,s.itemNum),n-=1}},t.prototype.parseLog=function(t,e){var i={},n=t.split(":");return i.itemNum=1==e?(i.serverName=n[0],i.serverId=n[1],i.userName=n[2],i.nickName=n[3],i.itemId=n[4],n[5]):(i.serverName="",i.serverId=l.RoleCenter.instans.self.svrid,i.userName=l.RoleCenter.instans.vo.username,i.nickName=l.RoleCenter.instans.vo.nickname,i.itemId=n[0],n[1]),i},t.prototype.appendMyLog=function(t,e,i,n){var s=u.TextConst.get(226),o="#55e42e",a=g.ItemUtils.getItemOrEq(i);a&&(s=a.name,o=b.QualityStruct.Ins.getQColorById(a.quality));var r=u.TextConst.get(1185,w.GameMain.getDisSvrId("S_"+t)+e,o,s,n)+"<br>";this.myRecordStr+=r,1==this._currRecordIndex&&(this._des.appendHTML(r),this.con_log.height=this._des.contextHeight+20,this.con_panel.vScrollBar.value=0)},t.prototype.appendAllLog=function(t,e,i,n){var s=u.TextConst.get(226),o="#55e42e",a=g.ItemUtils.getItemOrEq(i);a&&(s=a.name,o=b.QualityStruct.Ins.getQColorById(a.quality));var r=u.TextConst.get(275,w.GameMain.getDisSvrId("S_"+t)+e,o,s,n)+"<br>";this.allRecordStr+=r,0==this._currRecordIndex&&(this._des.appendHTML(r),this.con_log.height=this._des.contextHeight+20,this.con_panel.vScrollBar.value=0)},t}(ui.activity.pages.Identify_Gem3UI);e.Identify_Gem3=A}),define("src/g/activity/view/dlg/Wheel_duobao_extraDlg",["require","exports","src/g/clearRes/ClearResM","../../../net/messages/activity/ActivityGet","../../../net/messages/enumStatus","src/g/bag/tips/view/ItemTips","../../../../manager/RoleCenter","src/init/Switches","../../../../utils/ItemUtils","src/g/account/ctrl/GetRewwardCtrl","../../../../manager/GameSocketManager","../../../../manager/AM","../../../net/messages/activity/ActivityTrigger"],function(t,e,i,n,s,o,r,a,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.btn_close.on(Laya.Event.CLICK,t,t.onClose),t.btn.on(Laya.Event.CLICK,t,t.onClick),t.check_select.on(Laya.Event.CHANGE,t,t.changeHandler),i.ClearResM.resetViewImg(t),t}return __extends(t,e),t.prototype.onClose=function(){c.GSM.ins.off(p.DBbuyRewardGS2C.KEY,this,this.buyHandler),c.GSM.ins.off(n.ActivityGetGS2C.KEY,this,this.getReward),this.close()},t.prototype.onOpen=function(){c.GSM.ins.on(p.DBbuyRewardGS2C.KEY,this,this.buyHandler),c.GSM.ins.on(n.ActivityGetGS2C.KEY,this,this.getReward),this.popup(),Laya.timer.frameOnce(5,this,this.setData,[this.data])},t.prototype.changeHandler=function(){this.check_select.selected?this.lab_useMoney.text=this.money+"":this.lab_useMoney.text="0"},t.prototype.setData=function(t){switch(this.data=t,this.check_select.selected=!1,this.lab_useMoney.text="0",this.money=t.money,this.lab_buyCount.value=t.buyCount+"次",this.lab_buyDesc.text="夺宝"+t.buyCount+"次可领取",this.lab_discost.value=t.discost+"",this.lab_checkMoney.text=t.money+"",t.status){case s.enumStatus.weiwancheng:this.btn.label="未激活",this.btn.mouseEnabled=!1,this.btn.disabled=!0;break;case s.enumStatus.kelingqu:this.btn.label="可领取",this.btn.mouseEnabled=!0,this.btn.disabled=!1;break;case s.enumStatus.yilingqu:this.btn.label="已领取",this.btn.mouseEnabled=!1,this.btn.disabled=!0}o.ItemTips.cellShowTip(this.img_box1,t.itemId,t.itemNum),o.ItemTips.cellShowTip(this.img_box2,t.extraId,t.extraNum)},t.prototype.onClick=function(){if(r.RoleCenter.instans.bagRoomEnough()){if(this.isExtra=!1,this.rewardData1=null,this.rewardData2=null,this.check_select.selected){if(r.RoleCenter.instans.vo.GOLD<this.money)return void a.Switches.ins.event(155);var t=new p.DBbuyRewardC2GS;t.activityId=this.data.activityId,t.cfg2Id=this.data.extraCfgId,c.GSM.sendServer(t),this.isExtra=!0}var e=new n.ActivityGetC2GS;e.id=this.data.activityId,e.activity2CfgId=this.data.cfgId,c.GSM.sendServer(e)}else u.AM.showBagNotEnough()},t.prototype.buyHandler=function(t){if(r.RoleCenter.instans.addInventoryToC(t.inv),1==this.isExtra)return this.rewardData1=t.inv,void this.showReward();this.onClose();for(var e=t.inv.itemList,i=[],n=[],s=0;s<e.length;s+=2){var o=l.ItemUtils.getQualityById(e[s]),a={reward:e[s],count:e[s+1],quality:o};i.push(a)}i.sort(function(t,e){return e.quality-t.quality});for(s=0;s<i.length;s++){a=i[s];n.push(a.reward,a.count)}t.inv.itemList=n,h.GetRewwardCtrl.inventoryAddGS2C(t.inv)},t.prototype.getReward=function(t){if(1==this.isExtra)return this.rewardData2=t.inv,void this.showReward();this.onClose();for(var e=t.inv.itemList,i=[],n=[],s=0;s<e.length;s+=2){var o=l.ItemUtils.getQualityById(e[s]),a={reward:e[s],count:e[s+1],quality:o};i.push(a)}i.sort(function(t,e){return e.quality-t.quality});for(s=0;s<i.length;s++){a=i[s];n.push(a.reward,a.count)}t.inv.itemList=n,h.GetRewwardCtrl.inventoryAddGS2C(t.inv)},t.prototype.showReward=function(){if(this.rewardData1&&this.rewardData2&&this.isExtra){this.onClose();for(var t=this.rewardData1.itemList.concat(this.rewardData2.itemList),e=[],i=[],n=0;n<t.length;n+=2){var s=l.ItemUtils.getQualityById(t[n]),o={reward:t[n],count:t[n+1],quality:s};e.push(o)}e.sort(function(t,e){return e.quality-t.quality});for(n=0;n<e.length;n++){o=e[n];i.push(o.reward,o.count)}this.rewardData1.itemList=i,this.rewardData1.equipList.concat(this.rewardData2.equipList),this.rewardData1.currencyList.concat(this.rewardData2.currencyList),this.rewardData1.zhanwenList.concat(this.rewardData2.zhanwenList),h.GetRewwardCtrl.inventoryAddGS2C(this.rewardData1)}},t}(ui.activity.dlg.Wheel_duobao_extraDlgUI);e.Wheel_duobao_extraDlg=d}),define("src/g/activity/view/item/Wheel_duobaoItem",["require","exports","src/g/activity/view/dlg/DragonTreasureRewardDlg","../../../../utils/DialogQueue","../../../../enum/DialogIDEnum","src/g/bag/tips/view/ItemTips"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.on(Laya.Event.CLICK,t,t.clickHandler),t}return __extends(t,e),Object.defineProperty(t.prototype,"index",{get:function(){return this._index},set:function(t){this._index=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currPos",{get:function(){return this._currPos},set:function(t){this._currPos=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nextIndex",{get:function(){return this._nextIndex},set:function(t){this._nextIndex=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"moving",{get:function(){return this._moving},set:function(t){this._moving=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speedX",{get:function(){return this._speedX},set:function(t){this._speedX=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"speedY",{get:function(){return this._speedY},set:function(t){this._speedY=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rewardData",{get:function(){return this._rewardData},set:function(t){this._rewardData=t},enumerable:!0,configurable:!0}),t.prototype.setStartIndex=function(t){this.index=t},t.prototype.setData=function(t){this.id=t.id,this.num=t.num,this.type=t.type,0==t.type?(this.img_box.skin="res/activity/new_activity/Wheel_DuoBao/baoxiang01.png",this.img_ring.skin="res/activity/new_activity/Wheel_DuoBao/baoxiangguangquan01.png"):(this.img_box.skin="res/activity/new_activity/Wheel_DuoBao/baoxiang03.png",this.img_ring.skin="res/activity/new_activity/Wheel_DuoBao/baoxiangguangquan03.png"),0==t.index?(this.img_box.visible=!0,this.mouseEnabled=!0):(this.img_box.visible=!1,this.mouseEnabled=!1)},t.prototype.clickHandler=function(){if(0==this.type){var t=this.rewardData,e=new i.DragonTreasureRewardDlg;e.setData(t),n.DialogQueue.getInstance().add(s.DialogIDEnum.DRAGONTREASURE_REWARD,e)}else o.ItemTips.ins.showTip(this.id,this.num)},t}(ui.activity.item.Wheel_duobao_itemUI);e.Wheel_duobaoItem=a}),define("src/g/activity/view/pages/Wheel_DuoBao",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../net/messages/activity/ActivityGet","../../../../manager/RoleCenter","../../../../config/GameConfig","src/g/activity/view/dlg/Wheel_duobao_extraDlg","../../../../enum/FashionPos","src/g/Effects/UIEffectsFactory","../../../../utils/ItemUtils","../../../../component/GAnimation","../../../net/messages/enumStatus","../../../../manager/NewRedHintsCenter","src/g/activity/view/item/Wheel_duobaoItem","../../../../utils/system/ServerTime","src/init/TextConst","src/init/Switches","src/g/bag/tips/view/ItemTips","../../../../manager/RuledescManager","src/g/account/ctrl/GetRewwardCtrl","../../../../manager/GameSocketManager","../../../../manager/AM","../../../net/messages/activity/ActivityTrigger"],function(t,e,i,n,s,r,c,u,l,h,a,p,d,o,g,v,f,y,m,_,C,I,b,w,S){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var E=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.cfgId=0,t.speed=25,t.moveTime=5e3,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this),this.btn_start.on(Laya.Event.CLICK,this,this.onBtnClick),this.box_0.on(Laya.Event.CLICK,this,this.onBtnClick),this.box_1.on(Laya.Event.CLICK,this,this.onBtnClick),this.box_2.on(Laya.Event.CLICK,this,this.onBtnClick),this.box_3.on(Laya.Event.CLICK,this,this.onBtnClick),this.lab_prob.on(Laya.Event.CLICK,this,this.onBtnClick),b.GSM.ins.on(S.DuoBaoRewardGS2C.KEY,this,this.buyHandler),b.GSM.ins.on(r.ActivityGetGS2C.KEY,this,this.getReward),this.refresh(),this.countDown()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.btn_start.off(Laya.Event.CLICK,this,this.onBtnClick),this.box_0.off(Laya.Event.CLICK,this,this.onBtnClick),this.box_1.off(Laya.Event.CLICK,this,this.onBtnClick),this.box_2.off(Laya.Event.CLICK,this,this.onBtnClick),this.box_3.off(Laya.Event.CLICK,this,this.onBtnClick),this.lab_prob.off(Laya.Event.CLICK,this,this.onBtnClick),b.GSM.ins.off(S.DuoBaoRewardGS2C.KEY,this,this.buyHandler),b.GSM.ins.off(r.ActivityGetGS2C.KEY,this,this.getReward),Laya.timer.clearAll(this),this.stopMoveItem(),this.removeSelf(),i.ClearResM.clearFolderByUrl("ui/activity/Wheel_DuoBao/"),i.ClearResM.clearViewSkin(this)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.refresh=function(){this.updateChanged(),this.updateView()},t.prototype.updateUnchanged=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){this.pageData={};var e=u.GameConfig.activityJson[t.cfgId];this.cfgId=t.cfgId,this.pageData.probId=e.desc,this.pageData.tabData=e.value.split(","),this.pageData.imgUrl=e.bg_img;var i=u.GameConfig.subActivityJson[t.children[0].cfgId];this.pageData.chaozhiCount=i.value,this.pageData.cost1=i.originalcost,this.pageData.cost2=i.cost[0][1],this.pageData.awardId=i.image,i=u.GameConfig.subActivityJson[t.children[1].cfgId],this.pageData.rewardPool=i.bonus,this.pageData.totalCount=i.value;for(var n=[],s=-1,o=t.children.length,a=1;a<o;){var r=t.children[a];if(100<(i=u.GameConfig.subActivityJson[t.children[a].cfgId]).childId){var l={};if(l.tabId=r.cfgId,l.childId=i.childId,l.count=i.value,l.index=a,l.type=i.value2,l.iconId=i.bonus[0][0],l.iconNum=i.bonus[0][1],l.cost=0<i.cost.length?i.cost[0][1]:0,l.discost=i.discost,Number(i.title)!=s){var h=[];h.push(l),n.push(h),s=Number(i.title)}else{n[n.length-1].push(l)}}a++}this.pageData.boxData=n,this.setStaticView()}else console.log("没有找到数据，类型：TimeLimitList")},t.prototype.updateChanged=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){this.buyCount=t.allData.allCount;var e=t.children[0];this.pageData.todayChaozhiCount=e.count;for(var i=[],n=t.children.length,s=0;s<n;)e=t.children[s],i.push(e.status),s++;this.pageData.boxStatusData=i,this.pageData.itemData=t.rewardPool,this.endTime=t.endTime}else console.log("没有找到数据，类型：TimeLimitList")},t.prototype.setStaticView=function(){this.img_center.skin="dynamic/activity/Wheel_DuoBao/"+this.pageData.imgUrl+".png",this.lab_duobaoCount2.text="(本活动共可夺宝"+this.pageData.totalCount+"次)";for(var t=this.pageData.tabData,e=0;e<t.length;e++){var i,n=t[e].split(":");i=n[0]+"～"+n[1]+"次";var s=this.tab.getChildAt(e);s.label=i;var o=new Laya.Image;o.skin="res/custom/red_point.png",s.addChild(o),o.name="img_red",o.x=100,o.y=-5}this.tab.selectHandler=new Laya.Handler(this,this.onSwitchRecord),this.initItemBox(),this.showEUI()},t.prototype.showEUI=function(){var t=this.pageData.awardId;if(t&&-1!=t.indexOf("##_")){var e,i=t.split("_"),n=Number(i[1]);if(e=u.GameConfig.fashionJson[n]){if(this.loadFasionAni(e),e.position==h.FashionPos.WEAPON){var s=a.UIEffectsFactory.Ins.createSAniById(39,2.5,2.5);a.UIEffectsFactory.Ins.centerSAni4Parent(s,this.box_title)}this.img_title.visible=!1}else(e=u.GameConfig.titleJSON[n])&&(this.loadTitleAni(e),this.img_title.visible=!1)}else if(t&&-1!=t.indexOf("EUI")){var o=t.split("_");if(1<o.length)p.ItemUtils.getUIEffectsVoById(Number(o[1]))&&(this.loadUIEffect(Number(o[1])),this.img_title.visible=!1)}else this.img_title.visible=!0,this.img_title.skin="dynamic/activity/Wheel_DuoBao/"+t+".png",this.img_title.x=this.width/2,this.img_title.y+=-50},t.prototype.loadFasionAni=function(t){var e,i,n=c.RoleCenter.instans.vo.getSex(),s=this.box_title.numChildren,o=0,a=t.position;t.position==h.FashionPos.WING?i=0:t.position==h.FashionPos.WEAPON?i=1:t.position==h.FashionPos.FASHION&&(i=2);for(var r=p.ItemUtils.getAvtoarSource(t.res,i,n);o<s;){if(e=this.box_title.getChildAt(o)){e.stop(),e.clear();break}o++}if(e){if(e._url&&e._url==r)return void e.play()}else(e=new d.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,a==h.FashionPos.WING?e.scale(.7,.7):a==h.FashionPos.WEAPON?(e.scale(.55,.55),e.x+=90,e.y+=80):a==h.FashionPos.FASHION&&(a=2,e.y-=50,e.scale(.65,.65)),e.load(r,!0,0,"",0)},t.prototype.loadTitleAni=function(t){for(var e,i="fight/chenghao/"+t.icon+".json",n=this.box_title.numChildren,s=0;s<n;){if(e=this.box_title.getChildAt(s)){e.stop(),e.clear();break}s++}if(e){if(e._url&&e._url==i)return void e.play()}else(e=new d.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,e.scale(1,1),e.load(i)},t.prototype.loadUIEffect=function(t){for(var e,i=a.UIEffectsFactory.Ins.getSourceUrlById(t),n=this.box_title.numChildren,s=0;s<n;){if(e=this.box_title.getChildAt(s)){e.stop(),e.clear();break}s++}if(e){if(e._url&&e._url==i)return void e.play()}else(e=new d.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,e.scale(1,1),e.load(i)},t.prototype.onSwitchRecord=function(t){this.statusArr=[];for(var e=this.pageData.boxData[t],i=0;i<e.length;i++){var n=e[i];1==Number(n.type)?this.extraData=n:(this["img_reward"+i].visible=!1,this["img_select"+i].visible=!1,this.pageData.boxStatusData[n.index]==o.enumStatus.kelingqu?(this["img_select"+i].visible=!0,this.statusArr.push(1)):this.pageData.boxStatusData[n.index]==o.enumStatus.yilingqu?(this["img_reward"+i].visible=!0,this.statusArr.push(2)):this.statusArr.push(0),this["lab_count"+i].value=n.count+"次")}},t.prototype.updateView=function(){this.startMoveItem(),this.lab_duobaoCount1.text=this.buyCount+"次";var t=this.pageData.chaozhiCount-this.pageData.todayChaozhiCount;if(this.lab_dailyCount.text=(0<=t?t:0)+"/"+this.pageData.chaozhiCount,this.pageData.todayChaozhiCount>=this.pageData.chaozhiCount)this.img_chaozhi.visible=!1,this.lab_useCount.text=this.pageData.cost2+"元宝",g.NewRedHintsCenter.ins.setRedHintOpenOrClose(g.enumRedHints.wheel_duobao,!1);else{this.img_chaozhi.visible=!0;t=this.pageData.cost1[this.pageData.todayChaozhiCount][1];this.lab_useCount.text=0==t?"免费":t+"元宝",g.NewRedHintsCenter.ins.setRedHintOpenOrClose(g.enumRedHints.wheel_duobao,!0)}this.setItemBox(),this.showBox(),this.checkRed()},t.prototype.setItemBox=function(){for(var t=this.pageData.itemData,e=0;e<t.length;e++){var i=this.box_item.getChildAt(e),n=t[e];0==n.type&&(i.rewardData=this.pageData.rewardPool),i.setData(n)}},t.prototype.showBox=function(){for(var t=0,e=this.pageData.tabData,i=0;i<e.length;i++){var n=e[i].split(":");if(this.buyCount<=n[1])break;t+=1}this.tab.selectedIndex=t>=e.length?e.length-1:t,this.onSwitchRecord(this.tab.selectedIndex)},t.prototype.checkRed=function(){for(var t=this.pageData.boxData,e=0;e<t.length;e++){var i=t[e];this.tab.getChildByName("item"+e).getChildByName("img_red").visible=!1;for(var n=0;n<i.length;n++){var s=i[n];this.pageData.boxStatusData[s.index]==o.enumStatus.kelingqu&&(this.tab.getChildByName("item"+e).getChildByName("img_red").visible=!0)}}},t.prototype.countDown=function(){var t=this.endTime-f.ServerTime.serverTime;if(t<0)return this.lab_countDown.text="00:00:00",void Laya.timer.clearAll(this);var e="",i=Math.floor(t/3600/24),n=Math.floor(t%86400/3600),s=Math.floor(t%3600/60),o=t%60;0<i?(e+=y.TextConst.get(8,i),e+=10<=n?y.TextConst.get(9,n):"0"+y.TextConst.get(9,n),e+=10<=s?y.TextConst.get(11,s):"0"+y.TextConst.get(11,s)):(e+=10<=n?n+":":"0"+n+":",e+=10<=s?s+":":"0"+s+":",e+=10<=o?o:"0"+o),this.lab_countDown.text=e,Laya.timer.loop(1e3,this,this.countDown)},t.prototype.initItemBox=function(){this.arr_itemPos=[];for(var t=0;t<this.box_item.numChildren;t++){var e=this.box_item.getChildAt(t),i=new Laya.Point(e.x,e.y);this.arr_itemPos.push(i)}this.box_item.removeChildren();for(t=0;t<this.arr_itemPos.length;t++){e=new v.Wheel_duobaoItem,i=this.arr_itemPos[t];this.box_item.addChild(e),e.x=i.x,e.y=i.y,e.setStartIndex(t);var n=e.index+1;n>=this.arr_itemPos.length&&(n=0),e.nextIndex=n,e.currPos=i,i=this.arr_itemPos[e.nextIndex];var s=this.moveTime/this.speed,o=i.x-e.currPos.x,a=i.y-e.currPos.y;e.speedX=o/s,e.speedY=a/s}},t.prototype.startMoveItem=function(){Laya.timer.loop(this.speed,this,this.ItemMove)},t.prototype.stopMoveItem=function(){Laya.timer.clearAll(this)},t.prototype.ItemMove=function(){for(var t=0;t<this.box_item.numChildren;t++){var e=this.box_item.getChildAt(t),i=this.arr_itemPos[e.nextIndex];if(i.distance(e.currPos.x,e.currPos.y)-e.currPos.distance(e.x,e.y)<0){e.x=i.x,e.y=i.y;var n=e.nextIndex+1;n>=this.arr_itemPos.length&&(n=0),e.nextIndex=n,e.currPos=i,i=this.arr_itemPos[e.nextIndex];var s=this.moveTime/this.speed,o=i.x-e.currPos.x,a=i.y-e.currPos.y;e.speedX=o/s,e.speedY=a/s}e.x+=e.speedX,e.y+=e.speedY}},t.prototype.onBtnClick=function(t){switch(t.target){case this.btn_start:if(this.buyCount>=this.pageData.totalCount)return void w.AM.show("夺宝次数已达上限");if(!c.RoleCenter.instans.bagRoomEnough())return void w.AM.showBagNotEnough();if(0<this.lab_useCount.text.indexOf("元宝")){var e=Number(this.lab_useCount.text.split("元宝")[0]);if(c.RoleCenter.instans.vo.GOLD<e)return void m.Switches.ins.event(155)}var i=new S.DuoBaoRewardC2GS;i.activityId=this._activityId,b.GSM.sendServer(i);break;case this.box_0:case this.box_1:case this.box_2:if(!c.RoleCenter.instans.bagRoomEnough())return void w.AM.showBagNotEnough();var n=Number(t.target.name.split("_")[1]),s=this.pageData.boxData[this.tab.selectedIndex][n];if(1!=this.statusArr[n])_.ItemTips.ins.showTip(s.iconId,s.iconNum);else{var o=new r.ActivityGetC2GS;o.id=this._activityId,o.activity2CfgId=s.tabId,b.GSM.sendServer(o)}break;case this.box_3:n=Number(t.target.name.split("_")[1]),s=this.pageData.boxData[this.tab.selectedIndex][n];if(2!=this.statusArr[n]){this.extraDlg||(this.extraDlg=new l.Wheel_duobao_extraDlg);var a={};a.activityId=this._activityId,a.cfgId=s.tabId,a.money=this.extraData.cost,a.discost=this.extraData.discost,a.buyCount=s.count,a.status=this.statusArr[n],a.itemId=s.iconId,a.itemNum=s.iconNum,a.extraId=this.extraData.iconId,a.extraNum=this.extraData.iconNum,a.extraCfgId=this.extraData.tabId,this.extraDlg.setData(a),this.extraDlg.onOpen()}else _.ItemTips.ins.showTip(s.iconId,s.iconNum);break;case this.lab_prob:C.RuledescManager.showRuledesc(this.pageData.probId,"夺宝概率")}},t.prototype.buyHandler=function(t){c.RoleCenter.instans.addInventoryToC(t.inv);for(var e=t.inv.itemList,i=[],n=[],s=0;s<e.length;s+=2){var o=p.ItemUtils.getQualityById(e[s]),a={reward:e[s],count:e[s+1],quality:o};i.push(a)}i.sort(function(t,e){return e.quality-t.quality});for(s=0;s<i.length;s++){a=i[s];n.push(a.reward,a.count)}t.inv.itemList=n,I.GetRewwardCtrl.inventoryAddGS2C(t.inv),c.RoleCenter.instans.vo.getActivity1Data(this._activityId).rewardPool=t.rewardPool,this.pageData.itemData=t.rewardPool,this.setItemBox()},t.prototype.getReward=function(t){for(var e=t.inv.itemList,i=[],n=[],s=0;s<e.length;s+=2){var o=p.ItemUtils.getQualityById(e[s]),a={reward:e[s],count:e[s+1],quality:o};i.push(a)}i.sort(function(t,e){return e.quality-t.quality});for(s=0;s<i.length;s++){a=i[s];n.push(a.reward,a.count)}t.inv.itemList=n,I.GetRewwardCtrl.inventoryAddGS2C(t.inv)},t}(ui.activity.pages.Wheel_duobaoUI);e.Wheel_DuoBao=E}),define("src/g/activity/view/pages/JoyTreasurePage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../net/messages/activity/ActivityTrigger","../../../../manager/RoleCenter","../../../../config/GameConfig","src/g/activity/view/alerts/ActivityBuyAlert","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../utils/ItemUtils","../../../../component/GAnimation","../../../../enum/FashionPos","src/g/Effects/UIEffectsFactory","../../../../manager/NewRedHintsCenter","../../../../utils/system/ServerTime","src/init/TextConst","src/init/Switches","../../../../manager/StateManger","src/g/account/ctrl/GetRewwardCtrl","../../../../manager/GameSocketManager","../../../../manager/AM","../../../../component/LotteryBuyAlert"],function(t,e,i,n,s,a,c,l,r,o,h,u,p,d,g,v,f,y,m,_,C,I,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var S=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.cfgId=0,t.desc="",t.imgSkin="",t.arr_pageData=[],t.arr_prizeData=[],t.tipsAniShowCount=20,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this),this.btn_buy1.on(Laya.Event.CLICK,this,this.onBtnClick),this.btn_buy10.on(Laya.Event.CLICK,this,this.onBtnClick),this.btn_turn1.on(Laya.Event.CLICK,this,this.onBtnClick),this.btn_turn2.on(Laya.Event.CLICK,this,this.onBtnClick),I.GSM.ins.on(a.ActivityRewardGS2C.KEY,this,this.getReward),this.refresh(),this.countDown()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.btn_buy1.off(Laya.Event.CLICK,this,this.onBtnClick),this.btn_buy10.off(Laya.Event.CLICK,this,this.onBtnClick),this.btn_turn1.off(Laya.Event.CLICK,this,this.onBtnClick),this.btn_turn2.off(Laya.Event.CLICK,this,this.onBtnClick),I.GSM.ins.off(a.ActivityRewardGS2C.KEY,this,this.getReward),Laya.timer.clearAll(this),this.removeSelf(),i.ClearResM.clearFolderByUrl("ui/activity/Identify_Gem2/"),i.ClearResM.clearViewSkin(this)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.refresh=function(){this.updateChanged(),this.updateView(this.selectIndex?this.selectIndex:0)},t.prototype.updateUnchanged=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e,i=l.GameConfig.activityJson[t.cfgId];this.cfgId=t.cfgId,this.imgSkin=i.bg_img,this.desc=i.desc;for(var n=t.children.length,s=0;s<n;){e=l.GameConfig.subActivityJson[t.children[s].cfgId];var o={};o.tabId=e.id,o.childId=e.childId,o.fight=e.title,o.listData=e.bonus.slice(0,12),o.luckyTotal=e.value;var a={};a.gold1Num=e.cost[0][1],a.item1Id=e.cost[1][0],a.item1Num=e.cost[1][1],o.costData=a;var r=[];r.push(e.bonus[0],e.image),this.arr_prizeData.push(r),this.arr_pageData.push(o),s++}this.setStaticView()}else console.log("没有找到数据，类型：TimeLimitList")},t.prototype.updateChanged=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e;this.endTime=t.endTime;for(var i=t.children.length,n=0;n<i;){e=t.children[n];var s=this.arr_pageData[n];s.luckyValue=e.count,s.free=e.childCountArr[1],n++}}else console.log("没有找到数据，类型：TimeLimitList")},t.prototype.setStaticView=function(){this.arr_titlePos=[],this.arr_titlePos.push({x:130,y:280},{x:300,y:360},{x:460,y:280}),this.arr_titleBox=[],this.arr_titleBox.push(this.box_1,this.box_2,this.box_3),this.box_1.x=this.arr_titlePos[1].x,this.box_1.y=this.arr_titlePos[1].y,this.box_2.x=this.arr_titlePos[2].x,this.box_2.y=this.arr_titlePos[2].y,this.box_3.x=this.arr_titlePos[0].x,this.box_3.y=this.arr_titlePos[0].y,this.showEUI(0),this.showEUI(1),this.showEUI(2),this.img_title.skin="dynamic/activity/Identify_Gem2/"+this.imgSkin+".png",this.lab_desc.text=this.desc,this.list.itemRender=ui.custom.Item0ViewUI,this.list.renderHandler=new Laya.Handler(this,this.onListRender),this.ani.visible=!0,this.tipsAni()},t.prototype.tipsAni=function(){this.ani.visible=!1,this.tipsAniShowCount<=0?this.ani.stop():(this.tipsAniShowCount--,Laya.timer.once(500,this,this.showTipsAni))},t.prototype.showTipsAni=function(){this.ani.visible=!0,this.ani.play(0),this.tipsAniShowCount=0,Laya.timer.once(1e4,this,this.tipsAni)},t.prototype.onListRender=function(t,e){t.scaleX=t.scaleY=.8,o.ItemCellUtils.fillCellForItem0View(t,this.list.array[e][0],Number(this.list.array[e][1])),h.ItemTips.cellShowTip(t,this.list.array[e][0],Number(this.list.array[e][1]))},t.prototype.showEUI=function(t){var e,i=this.arr_prizeData[t];if(e=l.GameConfig.fashionJson[i[0][0]])this.loadFasionAni(e,t+1),this["img_title"+(t+1)].visible=!1;else if(e=l.GameConfig.titleJSON[i[0][0]])this.loadTitleAni(e,t+1),this["img_title"+(t+1)].visible=!1;else{var n=String(i[1]);if(n&&-1!=n.indexOf("EUI")){var s=n.split("_");if(1<s.length)u.ItemUtils.getUIEffectsVoById(Number(s[1]))&&(this.loadUIEffect(Number(s[1]),t+1),this["img_title"+(t+1)].visible=!1)}else this["img_title"+(t+1)].visible=!0,this["img_title"+(t+1)].skin="dynamic/activity/Identify_Gem2/"+n+".png",this["img_title"+(t+1)].centerX=0,this["img_title"+(t+1)].y+=-50}},t.prototype.loadFasionAni=function(t,e){var i,n,s=c.RoleCenter.instans.vo.getSex(),o=this["box_title"+e].numChildren,a=0,r=t.position;t.position==d.FashionPos.WING?n=0:t.position==d.FashionPos.WEAPON?n=1:t.position==d.FashionPos.FASHION&&(n=2);for(var l=u.ItemUtils.getAvtoarSource(t.res,n,s);a<o;){if(i=this["box_title"+e].getChildAt(a)){i.stop(),i.clear();break}a++}if(i){if(i._url&&i._url==l)return void i.play()}else(i=new p.GAnimation).isLoadedShow=!0,this["box_title"+e].addChild(i);if(i.x=this["box_title"+e].width/2,i.y=this["box_title"+e].height/2,i.rotation=0,r==d.FashionPos.WING)i.scale(.6,.6);else if(r==d.FashionPos.WEAPON){i.scale(.6,.6),i.x+=50,i.y+=0;var h=g.UIEffectsFactory.Ins.createSAniById(39,2,2);g.UIEffectsFactory.Ins.centerSAni4Parent(h,this["box_title"+e])}else r==d.FashionPos.FASHION&&(r=2,i.y-=80,i.scale(.6,.6));i.load(l)},t.prototype.loadTitleAni=function(t,e){for(var i,n="fight/chenghao/"+t.icon+".json",s=this["box_title"+e].numChildren,o=0;o<s;){if(i=this["box_title"+e].getChildAt(o)){i.stop(),i.clear();break}o++}if(i){if(i._url&&i._url==n)return void i.play()}else(i=new p.GAnimation).isLoadedShow=!0,this["box_title"+e].addChild(i);i.x=this["box_title"+e].width/2,i.y=this["box_title"+e].height/2,i.rotation=0,i.scale(1,1),i.load(n)},t.prototype.loadUIEffect=function(t,e){for(var i,n=g.UIEffectsFactory.Ins.getSourceUrlById(t),s=this["box_title"+e].numChildren,o=0;o<s;){if(i=this["box_title"+e].getChildAt(o)){i.stop(),i.clear();break}o++}if(i){if(i._url&&i._url==n)return void i.play()}else(i=new p.GAnimation).isLoadedShow=!0,this["box_title"+e].addChild(i);i.x=this["box_title"+e].width/2,i.y=this["box_title"+e].height/2,i.rotation=0,2032==t||2033==t||2034==t||2035==t?i.scale(.4,.4):i.scale(.6,.6),i.load(n)},t.prototype.updateView=function(t){var e=this;Laya.Tween.clearAll(this.box_1),Laya.Tween.clearAll(this.box_2),Laya.Tween.clearAll(this.box_3),2<t&&(t=0),t<0&&(t=2),this.selectIndex=t,this.box_exon.setChildIndex(this.arr_titleBox[this.selectIndex],this.box_exon.numChildren-1);var i=this.arr_pageData[this.selectIndex];this.lab_iconName.text=u.ItemUtils.getItemOrEq(Number(this.arr_prizeData[this.selectIndex][0][0])).name,this.lab_fight.value=i.fight+"",Laya.timer.once(10,this,function(){e.box_fight.centerX=0}),this.lab_progress.text=i.luckyValue+"/"+i.luckyTotal,this.img_progress.scaleX=i.luckyValue/i.luckyTotal,this.list.array=i.listData,this.setBtnCost()},t.prototype.changeTitle=function(t,e){var i,n,s=this.arr_titleBox[t];0<e?(i=this.arr_titleBox[0<=t-1?t-1:2],n=this.arr_titleBox[t+1<=2?t+1:0],t-=1,Laya.Tween.to(s,{x:this.arr_titlePos[2].x,y:this.arr_titlePos[2].y,scaleX:.6,scaleY:.6},500,Laya.Ease.cubicOut),Laya.Tween.to(n,{x:this.arr_titlePos[0].x,y:this.arr_titlePos[0].y,scaleX:.6,scaleY:.6},500,Laya.Ease.cubicOut)):(n=this.arr_titleBox[0<=t-1?t-1:2],i=this.arr_titleBox[t+1<=2?t+1:0],t+=1,Laya.Tween.to(s,{x:this.arr_titlePos[0].x,y:this.arr_titlePos[0].y,scaleX:.6,scaleY:.6},500,Laya.Ease.cubicOut),Laya.Tween.to(n,{x:this.arr_titlePos[2].x,y:this.arr_titlePos[2].y,scaleX:.6,scaleY:.6},500,Laya.Ease.cubicOut)),Laya.Tween.to(i,{x:this.arr_titlePos[1].x,y:this.arr_titlePos[1].y,scaleX:1,scaleY:1},500,Laya.Ease.cubicOut,new Laya.Handler(this,this.updateView,[t]))},t.prototype.setBtnCost=function(){var t=this.arr_pageData[this.selectIndex].costData;if(1!=this.arr_pageData[this.selectIndex].free)this.lab_free.visible=!0,this.box_cost.visible=!1,v.NewRedHintsCenter.ins.setRedHintOpenOrClose(v.enumRedHints.joyTreasure_btn1,!0);else{this.lab_free.visible=!1,this.box_cost.visible=!0,this.box_cost.refresh();var e=t.gold1Num;this.gold1.changeText(999<e?e+"(":e+" (");var i=c.RoleCenter.instans.vo.bagdata.getItemCount(t.item1Id);1<=i?(this.count1.color="#03bb00",v.NewRedHintsCenter.ins.setRedHintOpenOrClose(v.enumRedHints.joyTreasure_btn1,!0)):(this.count1.color="#ff0f15",v.NewRedHintsCenter.ins.setRedHintOpenOrClose(v.enumRedHints.joyTreasure_btn1,!1)),this.count1.text=i+"/"+t.item1Num,this.iconImg1.skin=u.ItemUtils.getIconByIconId(u.ItemUtils.getItemVoById(t.item1Id).icon)}},t.prototype.countDown=function(){var t=this.endTime-f.ServerTime.serverTime;if(t<0)return this.lab_countDown.text="00:00:00",void Laya.timer.clearAll(this);var e="",i=Math.floor(t/3600/24),n=Math.floor(t%86400/3600),s=Math.floor(t%3600/60),o=t%60;0<i?(e+=y.TextConst.get(8,i),e+=10<=n?y.TextConst.get(9,n):"0"+y.TextConst.get(9,n),e+=10<=s?y.TextConst.get(11,s):"0"+y.TextConst.get(11,s)):(e+=10<=n?n+":":"0"+n+":",e+=10<=s?s+":":"0"+s+":",e+=10<=o?o:"0"+o),this.lab_countDown.text=e,Laya.timer.loop(1e3,this,this.countDown)},t.prototype.doBuy=function(t){var e=this.arr_pageData[this.selectIndex].costData,i=c.RoleCenter.instans.vo.bagdata.getItemCount(e.item1Id),n=1==this.arr_pageData[this.selectIndex].free?0:1;if(Math.floor(i/e.item1Num)+n+Math.floor(c.RoleCenter.instans.vo.GOLD/e.gold1Num)<10)m.Switches.ins.event(155);else{var s=new a.identifyGem2C2GS;s.id=this._activityId,s.activity2CfgId=this.arr_pageData[this.selectIndex].tabId,s.time=t,I.GSM.sendServer(s)}},t.prototype.onBtnClick=function(t){var e=this;switch(t.target){case this.btn_buy1:if(!c.RoleCenter.instans.bagRoomEnough())return void b.AM.showBagNotEnough();if(1==this.arr_pageData[this.selectIndex].free){var i=this.arr_pageData[this.selectIndex].costData;if(c.RoleCenter.instans.vo.bagdata.getItemCount(i.item1Id)<i.item1Num){if(c.RoleCenter.instans.vo.GOLD<i.gold1Num)return void m.Switches.ins.event(155);if(_.StateManger.showLotteryBuyAlert){this.buyAlert||(this.buyAlert=new w.LotteryBuyAlert);var n=i.gold1Num,s=u.ItemUtils.getItemVoById(i.item1Id).name;return void this.buyAlert.showAlert(y.TextConst.get(1165,n,1,s),Laya.Handler.create(this,this.doBuy,[1]))}}}var o=new a.identifyGem2C2GS;o.id=this._activityId,o.activity2CfgId=this.arr_pageData[this.selectIndex].tabId,o.time=1,I.GSM.sendServer(o);break;case this.btn_buy10:if(!c.RoleCenter.instans.bagRoomEnough())return void b.AM.showBagNotEnough();if(this._buyAlert||(this._buyAlert=new r.ActivityBuyAlert),!this._buyAlert.check_select.visible){n=(i=this.arr_pageData[this.selectIndex].costData).gold1Num,s=u.ItemUtils.getItemVoById(i.item1Id).name;return void this._buyAlert.showAlert(y.TextConst.get(1165,10*n,10,s),Laya.Handler.create(this,function(){e.doBuy(10)}))}this.doBuy(10);break;case this.btn_turn1:this.tipsAniShowCount=0,this.changeTitle(this.selectIndex,1);break;case this.btn_turn2:this.tipsAniShowCount=0,this.changeTitle(this.selectIndex,-1)}},t.prototype.getReward=function(t){for(var e=t.inv.itemList,i=[],n=[],s=0;s<e.length;s+=2){var o=u.ItemUtils.getQualityById(e[s]),a={reward:e[s],count:e[s+1],quality:o};i.push(a)}i.sort(function(t,e){return e.quality-t.quality});for(s=0;s<i.length;s++){a=i[s];n.push(a.reward,a.count)}t.inv.itemList=n,C.GetRewwardCtrl.inventoryAddGS2C(t.inv)},t}(ui.activity.pages.JoyTreasureUI);e.JoyTreasurePage=S}),define("src/g/activity/view/dlg/LuckyBuyMyNumDlg",["require","exports","../../../net/messages/activity/ActivityGet","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../manager/GameSocketManager"],function(t,e,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t._act2CfgId=0,t.list_rank.renderHandler=new Laya.Handler(t,t.onRenderHandler),t}return __extends(t,e),t.prototype.showList=function(t,e){this._activityId=t,this._act2CfgId=e;var i=new n.activityLuckyCloudMsg;i.type=1,i.id=this._activityId,i.ac2CfgId=this._act2CfgId,r.GSM.sendServer(i),this.isPopup||(this.popup(),s.E.ins.on(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged)),this.refresh()},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.refresh=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)for(var e=t.children.length,i=0;i<e;){if(t.children[i].cfgId==this._act2CfgId){this.list_rank.array=t.children[i].childCountArr;break}i++}},t.prototype.onClosed=function(){s.E.ins.off(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged)},t.prototype.onRenderHandler=function(t,e){t.lab_rank.changeText("第"+(e+1)+"份"),t.lab_num.changeText(this.list_rank.array[e])},t}(ui.activity.dlg.LuckyBuyMyNumDlgUI);e.LuckyBuyMyNumDlg=i}),define("src/g/activity/view/pages/LuckyBuyPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../manager/ActivityManager","../../../../manager/RoleCenter","../../../../manager/RuledescManager","../../../../config/GameConfig","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","src/init/GameMain","src/init/TextConst","../../../net/messages/activity/ActivityGet","../../../../utils/ItemUtils","src/g/Effects/UIEffectsFactory","../../../../component/GAnimation","../../../../enum/FashionPos","src/init/Switches","src/g/activity/view/dlg/LuckyBuyMyNumDlg","../../../../manager/GameSocketManager","../../../../manager/AM"],function(t,e,i,n,s,o,l,a,h,c,u,p,r,d,g,v,f,y,m,_,C,I,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t.currBuyIndex=-1,t._phase=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.checkTimePhase(),this.requestInfo(),this.refresh(),this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),e.addChild(this),o.ActivityManager.ins.activityRead(this._activityId)},t.prototype.onTimeSpanHandler=function(t){var e=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&(this.list_preview.refresh(),this.refresh())},t.prototype.refresh=function(){this.updateShow()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.off(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/lucky_buy/"),Laya.timer.clear(this,this.cooldownHandler),Laya.timer.clear(this,this.checkTimePhase)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_preview.renderHandler=new Laya.Handler(this,this.onPreviewListRenderHandler),this.lab_help.on(Laya.Event.CLICK,this,function(){a.RuledescManager.showRuledesc(277)}),this.btn_buy.on(Laya.Event.CLICK,this,this.onBuyHandler),this.btn_num_list.on(Laya.Event.CLICK,this,this.onShowMyLuckyNum)},t.prototype.onPreviewListRenderHandler=function(t,e){var i=this.list_preview.array[e],n=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(n){var s=h.GameConfig.subActivityJson[n.children[i].cfgId];c.ItemCellUtils.fillCellForItemNameView(t.item,s.bonus[0][0],Number(s.bonus[0][1])),u.ItemTips.cellShowTip(t.item,s.bonus[0][0],Number(s.bonus[0][1])),t.lab_start_time.changeText(p.DateUtil.getHMS(1e3*(n.startTime+Number(s.value)))),t.lab_end_time.changeText(p.DateUtil.getHMS(1e3*(n.startTime+Number(s.value2))))}},t.prototype.updateUnchanged=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=h.GameConfig.activityJson[t.cfgId];this.desc_txt.changeText(e.desc),this._childIndexArr=[];for(var i,n=t.children.length,s=0;s<n;)(i=h.GameConfig.subActivityJson[t.children[s].cfgId])&&i.childId<100&&this._childIndexArr.push(s),s++;this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_preview.array=this._childIndexArr}},t.prototype.childSortFun=function(t,e){var i=l.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=h.GameConfig.subActivityJson[i.children[t].cfgId],s=h.GameConfig.subActivityJson[i.children[e].cfgId];return n.childId-s.childId},t.prototype.cooldownHandler=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.rewardTime-r.ServerTime.serverTime;86400<e?(this.lab_time.changeText(p.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(p.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")}},t.prototype.checkTimePhase=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e,i=this._childIndexArr.length,n=0,s=0,o=r.ServerTime.serverTime;for(this._phase=-1,this.currBuyIndex=-1;n<i;){s=this._childIndexArr[n],e=h.GameConfig.subActivityJson[t.children[s].cfgId];var a=t.startTime+Number(e.value)-o;if(0<a){this._phase=0,Laya.timer.once(1e3*a,this,this.checkTimePhase);break}if(0<(a=t.startTime+Number(e.value2)-o)){this._phase=1,this.currBuyIndex=s,Laya.timer.once(1e3*a,this,this.checkTimePhase);break}if(0<(a=t.startTime+Number(e.value2)+3600-o)){this._phase=2,this.currBuyIndex=s,Laya.timer.once(1e3*a,this,this.checkTimePhase);break}n++}-1==this._phase&&(this._phase=2,this.currBuyIndex=this._childIndexArr[i-1])}this.updateShow()},t.prototype.updateShow=function(){if(this.box_preview.visible=this._phase<=0,this.box_open.visible=0<this._phase,0<this._phase){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t&&-1!=this.currBuyIndex){var e=h.GameConfig.subActivityJson[t.children[this.currBuyIndex].cfgId];if(c.ItemCellUtils.fillCellForItemNameView(this.item_bonus_final,e.bonus[0][0],Number(e.bonus[0][1])),u.ItemTips.cellShowTip(this.item_bonus_final,e.bonus[0][0],Number(e.bonus[0][1])),this.checkBunusShowAni(e.bonus[0][0],e.image),this.img_title.visible&&(this.img_title.skin="dynamic/activity/lucky_buy/"+e.image+".png"),this.lab_rward_time.changeText(p.DateUtil.getHMS(1e3*(t.startTime+Number(e.value2)))),2==this._phase)if(this.lab_lucky_num.changeText(t.children[this.currBuyIndex].count.toString()),1<t.children[this.currBuyIndex].strArr.length){var i=t.children[this.currBuyIndex].strArr[0],n=t.children[this.currBuyIndex].strArr[1];this.lab_lucky_name.changeText(d.GameMain.getDisSvrId(i)+n)}else this.lab_lucky_name.changeText("无人中奖");else this.lab_lucky_num.changeText("???"),this.lab_lucky_name.changeText("???");for(var s=e.childId+100,o=t.children.length,a=0;a<o;){if((e=h.GameConfig.subActivityJson[t.children[a].cfgId])&&e.childId==s){c.ItemCellUtils.fillCellForItemNameView(this.item_bonus,e.bonus[0][0],Number(e.bonus[0][1])),u.ItemTips.cellShowTip(this.item_bonus,e.bonus[0][0],Number(e.bonus[0][1])),this.lab_cost.changeText(g.TextConst.get(6,e.cost[0][1]));var r=0;2==this._phase?this.lab_num.changeText("0"):(r=e.value-t.children[a].count,this.lab_num.changeText(r.toString())),this.btn_buy.disabled=r<1;break}a++}}}},t.prototype.requestInfo=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t&&-1!=this.currBuyIndex){var e=t.children[this.currBuyIndex].cfgId;this.requestAwardInfo(e),this.requestRemaining(e+100)}},t.prototype.requestAwardInfo=function(t){var e=new v.activityLuckyCloudMsg;e.type=3,e.id=this._activityId,e.ac2CfgId=t,b.GSM.sendServer(e)},t.prototype.requestRemaining=function(t){var e=new v.activityLuckyCloudMsg;e.type=2,e.id=this._activityId,e.ac2CfgId=t,b.GSM.sendServer(e)},t.prototype.checkBunusShowAni=function(t,e){var i;if(this.img_title.visible=!0,this.img_stage.visible=!1,i=h.GameConfig.fashionJson[t])this.loadFasionAni(i),this.img_title.visible=!1;else if(i=h.GameConfig.titleJSON[t])this.loadTitleAni(i),this.img_title.visible=!1;else if(e&&-1!=e.indexOf("EUI")){var n=e.split("_");if(1<n.length)if(f.ItemUtils.getUIEffectsVoById(Number(n[1])))return this.loadUIEffect(Number(n[1])),void(this.img_title.visible=!1)}this.box_title.visible=!this.img_title.visible},t.prototype.loadUIEffect=function(t){for(var e,i=y.UIEffectsFactory.Ins.getSourceUrlById(t),n=this.box_title.numChildren,s=0;s<n;){if(e=this.box_title.getChildAt(s)){e.stop(),e.clear();break}s++}if(e){if(e._url&&e._url==i)return void e.play()}else(e=new m.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,e.scale(1,1),e.load(i)},t.prototype.loadTitleAni=function(t){var e,i="dynamic2/chenghao/"+t.icon+".json";this.img_stage.visible=!0;for(var n=this.box_title.numChildren;0<n;)if(e=this.box_title.getChildAt(0)){e.stop(),e.clear();break}if(e){if(e._url&&e._url==i)return void e.play()}else(e=new m.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,e.scale(1,1),e.load(i)},t.prototype.loadFasionAni=function(t){var e,i=l.RoleCenter.instans.vo.getSex(),n=this.box_title.numChildren;t.position==_.FashionPos.WING?o=0:t.position==_.FashionPos.WEAPON?o=1:t.position==_.FashionPos.FASHION&&(o=2);for(var s=f.ItemUtils.getAvtoarSource(t.res,o,i);0<n;)if(e=this.box_title.getChildAt(0)){e.stop(),e.clear();break}if(e){if(e._url&&e._url==s)return void e.play()}else(e=new m.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2;var o=e.rotation=0;t.position==_.FashionPos.WING?(o=0,e.scale(.7,.7)):t.position==_.FashionPos.WEAPON?(o=1,e.scale(.6,.6),e.x+=50,e.y+=50):t.position==_.FashionPos.FASHION&&(o=2,e.y-=50,e.scale(.7,.7)),e.load(s)},t.prototype.onBuyHandler=function(){if(1==this._phase){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t&&-1!=this.currBuyIndex)for(var e=h.GameConfig.subActivityJson[t.children[this.currBuyIndex].cfgId],i=e.childId+100,n=t.children.length,s=0;s<n;){if((e=h.GameConfig.subActivityJson[t.children[s].cfgId])&&e.childId==i){var o=e.cost[0][1];if(!l.RoleCenter.instans.bagRoomEnough())return void w.AM.showBagNotEnough();if(l.RoleCenter.instans.vo.GOLD<o)return void C.Switches.ins.event(155);var a=new v.ActivityGetC2GS;a.id=this._activityId,a.activity2CfgId=t.children[s].cfgId,b.GSM.sendServer(a);break}s++}}},t.prototype.onShowMyLuckyNum=function(){if(0<this._phase){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t&&-1!=this.currBuyIndex)for(var e=h.GameConfig.subActivityJson[t.children[this.currBuyIndex].cfgId],i=e.childId+100,n=t.children.length,s=0;s<n;){if((e=h.GameConfig.subActivityJson[t.children[s].cfgId])&&e.childId==i){this._dlg||(this._dlg=new I.LuckyBuyMyNumDlg),this._dlg.showList(this._activityId,t.children[s].cfgId);break}s++}}},t}(ui.activity.pages.Lucky_BuyUI);e.LuckyBuyPage=S}),define("src/g/activity/view/pages/FlashSalePage3",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../net/messages/enumStatus","src/init/TextConst","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","../../../../plugin/view/ToolTip","../../../../core/GNet","../../../../utils/system/FloatEffect","../../../../manager/AM"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t._lastBuyTime=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.refresh(),this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this)},t.prototype.refresh=function(){this.updateListData()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/flash_sale/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_main.renderHandler=new Laya.Handler(this,this.onRenderHandler),this.list_main.mouseHandler=new Laya.Handler(this,this.onMouseHandler),this.btn_buy.on(Laya.Event.CLICK,this,this.onBuyHandler)},t.prototype.onRenderHandler=function(t,e){o.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_main.array[e];if(!i)return;a.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.updateUnchanged=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){this._childIndexArr=[];for(var e=t.children.length,i=0;i<e;){var n=l.GameConfig.subActivityJson[t.children[i].cfgId];n&&t.allData.allCount==n.value&&this._childIndexArr.push(i),i++}}else console.log("没有找到数据，类型：flash_sale_3")},t.prototype.updateListData=function(){this._childIndexArr.sort(this.childSortFun.bind(this));var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){for(var e=this._childIndexArr.length,i=0;i<e;){this._childIndex=this._childIndexArr[i];var n=t.children[this._childIndex];if(n&&n.status==h.enumStatus.kelingqu)break;i++}n=t.children[this._childIndex];var s=l.GameConfig.subActivityJson[n.cfgId];this.lab_cost.text=c.TextConst.get(5,s.cost[0][1]),this.lab_cost_orig.text=c.TextConst.get(5,s.originalcost[0][1]),this.lab_vip_exp.changeText(c.TextConst.get(95,100*s.cost[0][1]));var o=n.status==h.enumStatus.kelingqu;0<s.viplevel&&r.RoleCenter.instans.vo.VIP<s.viplevel&&(o=!1),this.btn_buy.disabled=!o,this.list_main.array=s.bonus}},t.prototype.childSortFun=function(t,e){var i=r.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=i.children[t],s=i.children[e],o=l.GameConfig.subActivityJson[n.cfgId],a=l.GameConfig.subActivityJson[s.cfgId];return(o?o.value2+100:100)-(a?a.value2+100:100)},t.prototype.cooldownHandler=function(){var t=u.DateUtil.getZeroTime()-p.ServerTime.serverTime;0<=t?(this.lab_time.changeText(u.DateUtil.getHMS_countdown(t)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")},t.prototype.onBuyHandler=function(){if(Date.now()-this._lastBuyTime<1e3)v.FE.upItems(c.TextConst.get(258),d.BubbleEnum.center);else if(r.RoleCenter.instans.bagRoomEnough()){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex],i=l.GameConfig.subActivityJson[e.cfgId];if(i){if(0<i.viplevel&&r.RoleCenter.instans.vo.VIP<i.viplevel)return void v.FE.upItems(c.TextConst.get(219),d.BubbleEnum.center);this._lastBuyTime=Date.now(),g.GNet.toRecharge(Number(i.desc))}}}else f.AM.showBagNotEnough()},t}(ui.activity.pages.FlashSalePage3UI);e.FlashSalePage3=y}),define("src/g/activity/view/item/InvestmentPlanPageItem",["require","exports","../../../../utils/UIUtils","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../manager/RoleCenter","../../../net/messages/enumStatus","../../../../config/GameConfig","../../../net/messages/activity/ActivityGet","src/g/Effects/UIEffectsFactory","../../../../manager/AM","../../../../manager/GameSocketManager"],function(t,e,i,n,s,a,r,l,o,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.getHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),i.UIUtils.initHtmlDiv(t.htxt_cond,"#e3cca9",18,"center"),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){n.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];s.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.getHandler=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex];if(e&&e.status==r.enumStatus.kelingqu){if(!a.RoleCenter.instans.bagRoomEnough())return void c.AM.showBagNotEnough();var i=l.GameConfig.subActivityJson[e.cfgId];if(this._day>=i.childId){var n=new o.ActivityGetC2GS;n.id=this._activityId,n.activity2CfgId=e.cfgId,u.GSM.sendServer(n)}}}},t.prototype.setData=function(t,e,i){this._activityId=t,this._childIndex=e,this._day=i,this.btn_get.visible=!1,this.img_got.visible=!1,this.htxt_cond.visible=!1;var n=a.RoleCenter.instans.vo.getActivity1Data(t);if(n){var s=n.children[e];if(s){var o=l.GameConfig.subActivityJson[s.cfgId];this.lab_title.changeText(o.title),s.status==r.enumStatus.weiwancheng?(this.htxt_cond.visible=!0,this.htxt_cond.innerHTML=o.desc):s.status==r.enumStatus.kelingqu?i>=s.count?this.btn_get.visible=!0:(this.htxt_cond.visible=!0,this.htxt_cond.innerHTML=o.desc):this.img_got.visible=!0,this.btn_get.visible?(this.ani||(this.ani=h.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,40,.62,.8)),-1==this.btn_get.getChildIndex(this.ani)&&h.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_get),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_get.getChildIndex(this.ani)&&this.btn_get.removeChild(this.ani)),this.list_item.array=o.bonus}}},t}(ui.activity.item.InvestmentPlanItemUI);e.InvestmentPlanPageItem=p}),define("src/g/activity/view/pages/InvestmentPlanPage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../net/messages/OpResultGS2C","../../../../manager/RoleCenter","../../../net/messages/OpResultType","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","src/g/activity/view/item/InvestmentPlanPageItem","src/init/TextConst","../../../../config/GameConfig","../../../../core/GNet","../../../net/messages/enumStatus","../../../../manager/GameSocketManager","../../../../utils/system/FloatEffect"],function(t,e,i,n,s,o,h,a,c,r,l,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t._lastBuyTime=0,t.currIndex=0,t.arr_bgSkin=[],t._day=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.refresh(),this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),v.GSM.ins.on(o.OpResultGS2C.KEY,this,this.nextDayHandler),e.addChild(this)},t.prototype.onTimeSpanHandler=function(t){var e=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.nextDayHandler=function(t){t.msgidx==a.enumOpResultType.activity_nextDay&&Laya.timer.once(1e3,this,this.refresh)},t.prototype.refresh=function(){this.updateStat(),this.updateListData()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.off(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),v.GSM.ins.off(o.OpResultGS2C.KEY,this,this.nextDayHandler),this.removeSelf(),i.ClearResM.clearFolderByUrl("ui/activity/investment_plan_2/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.cooldownHandler=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.endTime-c.ServerTime.serverTime;86400<e?(this.lab_time.changeText(r.DateUtil.remainingDHStr(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=e?(this.lab_time.changeText(r.DateUtil.getHMS_countdown(e)),Laya.timer.once(1e3,this,this.cooldownHandler)):(this.lab_time.changeText("00:00:00"),this.isBuyFinish=!0,this.updateStat())}},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_main.scrollBar.elasticDistance=100,this.list_main.itemRender=l.InvestmentPlanPageItem,this.list_main.renderHandler=new Laya.Handler(this,this.renderHandler),this.btn_recharge.on(Laya.Event.CLICK,this,this.doBuyHandler),this.tab.selectHandler=new Laya.Handler(this,this.onSwitch)},t.prototype.doBuyHandler=function(){if(Date.now()-this._lastBuyTime<1e3)f.FE.upItems(u.TextConst.get(258));else{var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=p.GameConfig.subActivityJson[t.children[this.currIndex].cfgId];this._lastBuyTime=Date.now(),d.GNet.toRecharge(Number(e.value2))}}},t.prototype.updateUnchanged=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=p.GameConfig.activityJson[t.cfgId];this.currIndex=0,this.arr_bgSkin.push(p.GameConfig.subActivityJson[t.children[0].cfgId].image),this.arr_bgSkin.push(p.GameConfig.subActivityJson[t.children[1].cfgId].image),this.img_title.skin="dynamic/activity/investment_plan_2/"+this.arr_bgSkin[this.currIndex]+".jpg",this._childIndexArr=[],this._childIndex2Arr=[];for(var i=t.children.length,n=Number(e.value);n<i;)n<=Number(e.value)-1+7?this._childIndexArr.push(n):this._childIndex2Arr.push(n),n++}else console.log("没有找到数据，类型：investment_plan")},t.prototype.updateListData=function(){0==this.currIndex?(this._childIndexArr.sort(this.childSortFun.bind(this)),this.list_main.array=this._childIndexArr):(this._childIndex2Arr.sort(this.childSortFun.bind(this)),this.list_main.array=this._childIndex2Arr),this.list_main.scrollTo(0)},t.prototype.updateStat=function(){this.btn_recharge.disabled=!1;var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId),e=t.children[this.currIndex],i=p.GameConfig.subActivityJson[t.children[this.currIndex].cfgId];e&&0<e.count?(this._day=r.DateUtil.getDayFromStartTime(t.allData.time),this.btn_recharge.visible=!1,this.img_recharge.visible=!0,this.lab_time.visible=this.lab_time_lab.visible=!1):(this.btn_recharge.visible=!0,this.img_recharge.visible=!1,this.lab_time.visible=this.lab_time_lab.visible=!0),this.lab_money.text=i.value+"元",this.isBuyFinish&&(this.btn_recharge.disabled=!0)},t.prototype.childSortFun=function(t,e){var i=h.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=i.children[t],s=i.children[e],o=p.GameConfig.subActivityJson[n.cfgId],a=p.GameConfig.subActivityJson[s.cfgId],r=o?o.childId+100:100,l=a?a.childId+100:100;return n.status==g.enumStatus.kelingqu&&n.count>=c.ServerTime.serverTime?r-=100:n.status==g.enumStatus.yilingqu&&(r+=100),s.status==g.enumStatus.kelingqu&&n.count>=c.ServerTime.serverTime?l-=100:s.status==g.enumStatus.yilingqu&&(l+=100),r-l},t.prototype.renderHandler=function(t,e){t.setData(this._activityId,this.list_main.array[e],c.ServerTime.serverTime)},t.prototype.onSwitch=function(t){this.currIndex=t,this.img_title.skin="dynamic/activity/investment_plan_2/"+this.arr_bgSkin[this.currIndex]+".jpg",this.refresh()},t}(ui.activity.pages.InvestmentPlanUI);e.InvestmentPlanPage=y}),define("src/g/activity/view/pages/RechargeMoney3",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../net/messages/OpResultGS2C","../../../net/messages/OpResultType","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","src/g/Effects/UIEffectsFactory","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../core/GNet","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager"],function(t,e,i,n,s,o,a,h,c,u,p,r,l,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t.cfgId=0,t.selectIndex=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this),this.btn_buy.on(Laya.Event.CLICK,this,this.onBtnClick),f.GSM.ins.on(o.OpResultGS2C.KEY,this,this.onOpResult),this.refresh(),this.countDown()},t.prototype.onOpResult=function(t){var e=this;t.msgidx==a.enumOpResultType.activity_nextDay&&Laya.timer.once(1200,this,function(){Laya.timer.clearAll(e),e.updateUnchanged(),e.refresh()})},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.btn_buy.off(Laya.Event.CLICK,this,this.onBtnClick),f.GSM.ins.off(o.OpResultGS2C.KEY,this,this.onOpResult),Laya.timer.clearAll(this),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/Recharge_Money_3/"),i.ClearResM.clearViewSkin(this)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.refresh=function(){this.updateChanged(),this.updateView()},t.prototype.updateUnchanged=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=c.GameConfig.activityJson[t.cfgId];this.cfgId=t.cfgId,this.tabTitle=e.desc.split(":");var i,n,s=e.value.split(",");this.arr_pageData=[];for(var o=u.DateUtil.getDayFromStartTime(t.startTime,p.ServerTime.ACTIVITY_TIME_OFFSET),a=Math.floor((o-1)/Number(s[0]))*Number(s[1]),r=a+Number(s[1]);a<r;){i=c.GameConfig.subActivityJson[t.children[a].cfgId],n=t.children[a];var l={};l.tabId=n.cfgId,l.childId=i.childId,l.titleUrl=i.title,l.bgUrl=i.image,l.rechargeId=i.value2,l.cost1=i.originalcost[0][1],l.cost2=i.cost[0][1],l.desc=i.desc,l.listData=i.bonus,this.arr_pageData.push(l),a++}this.setStaticView()}else console.log("没有找到数据，类型：TimeLimitList")},t.prototype.updateChanged=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e,i=c.GameConfig.activityJson[t.cfgId].value.split(","),n=u.DateUtil.getDayFromStartTime(t.startTime,p.ServerTime.ACTIVITY_TIME_OFFSET);console.log(t.startTime,p.ServerTime.serverTime,n);for(var s=0,o=Number(i[1]);s<o;)(e=t.children[s+Math.floor((n-1)/Number(i[0]))*Number(i[1])])&&(this.arr_pageData[s].status=e.status),s++;this.endTime=t.endTime}else console.log("没有找到数据，类型：TimeLimitList")},t.prototype.setStaticView=function(){this.list.renderHandler=new Laya.Handler(this,this.onListRender),this.ani=r.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_buy,40),this.ani.visible=!1;for(var t=0;t<this.tabTitle.length;t++){var e=this.tabTitle[t];this.tab.getChildAt(t).label=e}this.tab.selectHandler=new Laya.Handler(this,this.onSwitch),this.tab.centerX=0},t.prototype.onSwitch=function(t){this.selectIndex=t,this.updateView()},t.prototype.onListRender=function(t,e){l.ItemCellUtils.fillCellForItemNameView(t,this.list.array[e][0],Number(this.list.array[e][1])),d.ItemTips.cellShowTip(t,this.list.array[e][0],Number(this.list.array[e][1]))},t.prototype.updateView=function(){var t=this.arr_pageData[this.selectIndex];switch(this.img_title.skin="dynamic/activity/Recharge_Money_3/"+t.titleUrl+".png",this.img_bg.skin="dynamic/activity/Recharge_Money_3/"+t.bgUrl+".png",this.list.array=t.listData,this.lab_desc.text=t.desc,this.lab_cost1.text=t.cost1+"元",this.lab_cost2.text=t.cost2+"元",this.rechargeId=t.rechargeId,this.rewardId=t.tabId,this.rewardStatus=t.status,t.status){case 0:this.btn_buy.label="立即购买",this.btn_buy.disabled=!1,this.ani.visible=!1;break;case 1:this.btn_buy.label="领取",this.btn_buy.disabled=!1,this.ani.visible=!0;break;case 2:this.btn_buy.label="已领取",this.btn_buy.disabled=!0,this.ani.visible=!1}},t.prototype.countDown=function(){var t=this.endTime-p.ServerTime.serverTime;if(t<0)return this.lab_countTime.text="00:00:00",void Laya.timer.clearAll(this);var e="",i=(Math.floor(t/3600/24),Math.floor(t%86400/3600)),n=Math.floor(t%3600/60),s=t%60;e+=10<=i?i+":":"0"+i+":",e+=10<=n?n+":":"0"+n+":",e+=10<=s?s:"0"+s,this.lab_countTime.text=e,Laya.timer.loop(1e3,this,this.countDown)},t.prototype.onBtnClick=function(t){switch(t.target){case this.btn_buy:switch(this.rewardStatus){case 0:g.GNet.toRecharge(this.rechargeId);break;case 1:var e=new v.ActivityGetC2GS;e.id=this._activityId,e.activity2CfgId=this.rewardId,f.GSM.sendServer(e)}}},t}(ui.activity.RechargeMoney3UI);e.RechargeMoney3=y}),define("src/g/activity/view/item/AccumulativeRecharge3Day2Item",["require","exports","../../../net/messages/enumStatus","src/g/activity/view/ActivityBoxGetDlg","src/init/TextConst"],function(t,e,s,i,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t.htxt_title.style.color="#e3cca9",t.htxt_title.style.font="SimHei",t.htxt_title.style.fontSize=18,t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){t.item.img_fs_job.visible=!1,t.img_occupation.visible=!1,t.item.img_item.skin="res/activity/new_activity/meiri_box_"+this.listData[e].image+".png",this.listData[e].status==s.enumStatus.kelingqu?this["effect"+e].visible=!0:this.listData[e].status==s.enumStatus.yilingqu&&(this["img_complt"+e].visible=!0)},t.prototype.onMouseHandler=function(t,e){t.type==Laya.Event.CLICK&&(this._boxRewardDlg||(this._boxRewardDlg=new i.ActivityBoxGetDlg),this._boxRewardDlg.showBox(this.listData[e].subData,this._activityId))},t.prototype.setData=function(t){this._activityId=t.id;for(var e=0;e<7;e++)this["effect"+e].visible=!1,this["img_complt"+e].visible=!1;this.list_item.array=this.listData=t.listData;for(var i=0,n=0;n<this.listData.length;n++)this.listData[n].status!=s.enumStatus.weiwancheng&&(i=n+1);this.htxt_title.innerHTML=o.TextConst.get(1186,t.listData[0].money,i,t.listData[0].totalDay)},t}(ui.activity.item.Accumulative_recharge_3_day_item_2UI);e.AccumulativeRecharge3Day2Item=n}),define("src/g/activity/view/pages/AccumulativeRecharge3Day2Page",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/ScrollBoxUtil","src/g/activity/view/ActivityBoxGetDlg","src/g/activity/view/item/AccumulativeRecharge3Day2Item","../../../../utils/ItemUtils","../../../net/messages/enumStatus","src/init/TextConst","src/init/Switches"],function(t,e,i,n,s,h,c,u,p,o,a,r,l,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.cfgId=0,t._maxTarget=0,t.rechargeCount=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.on(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),e.addChild(this),this.btn_go.on(Laya.Event.CLICK,this,this.onBtnClick),this.refresh(),this.countDown(),Laya.timer.once(1e3*(h.DateUtil.getZeroTime()-c.ServerTime.serverTime)+1e3,this,this.refresh)},t.prototype.onTimeSpanHandler=function(t){var e=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&e.cfgId==t&&this.refresh()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.E.ins.off(s.EventName.ACTIVITY_TIME_SPAN,this,this.onTimeSpanHandler),this.btn_go.off(Laya.Event.CLICK,this,this.onBtnClick),Laya.timer.clearAll(this),this.removeSelf(),i.ClearResM.clearFolderByUrl("ui/activity/Fireworks/"),i.ClearResM.clearViewSkin(this)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.refresh()},t.prototype.refresh=function(){this.displayedInStage&&(this.updateChanged(),this.updateView())},t.prototype.updateUnchanged=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=p.GameConfig.activityJson[t.cfgId];this.cfgId=t.cfgId,this.img_title.skin="dynamic/activity/rechargeContinuous/"+e.bg_img+".jpg";var i,n=Number(e.value.split(",")[0]);Number(e.value.split(",")[1]);this.arr_itemListData=[],this.arr_rewardData=[];for(var s=[],o=t.children.length,a=0;a<o;){var r=t.children[a];if((i=p.GameConfig.subActivityJson[t.children[a].cfgId]).childId<100){var l={};l.title=i.title,l.subData=t.children[a],l.image=i.image,l.money=i.value2,a%(l.totalDay=n)==0&&(s=[],this.arr_itemListData.push(s)),s.push(l)}else{var h={};h.tabId=r.cfgId,h.subData=t.children[a],h.imageID=i.bonus[0][0],h.name=i.title,this.arr_rewardData.push(h)}a++}this.setStaticView()}else console.log("没有找到数据，类型：TimeLimitList")},t.prototype.updateChanged=function(){var t=u.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){this.curDay=h.DateUtil.getDayFromStartTime(t.startTime,c.ServerTime.ACTIVITY_TIME_OFFSET),this.rechargeCount=t.allData.allCount;for(var e,i,n=p.GameConfig.activityJson[t.cfgId],s=Number(n.value.split(",")[0]),o=Number(n.value.split(",")[1]),a=0,r=t.children.length,l=0;l<r;)if(e=t.children[l]){if((i=p.GameConfig.subActivityJson[e.cfgId])&&i.value2>a&&(a=i.value2),i.childId<100)this.arr_itemListData[Math.floor(l/s)][l%s].status=e.status;else this.arr_rewardData[l-s*o].status=e.status;l++}this._maxTarget=a,this.endTime=t.endTime}else console.log("没有找到数据，类型：TimeLimitList")},t.prototype.setStaticView=function(){this.list_main.itemRender=r.AccumulativeRecharge3Day2Item,this.list_main.renderHandler=new Laya.Handler(this,this.listMainRenderHandler),this.scrollUtil=new o.ScrollBoxUtil,this.scrollUtil.bindContent(this.panel_con,this.box_con,this.img_jiantou_l,this.img_jiantou_r),this.scrollUtil.itemRender=ui.activity.item.Accumulative_recharge_3_day_rewardItem_2UI,this.scrollUtil.itemRenderHandler=Laya.Handler.create(this,this.onListRender,null,!1),this.scrollUtil.mouseHandler=Laya.Handler.create(this,this.changeItemClick,null,!1),this.scrollUtil.setData(this.arr_rewardData)},t.prototype.onListRender=function(t,e){var i=this.arr_rewardData[e],n=l.ItemUtils.getItemVoById(i.imageID);t.lab_name.style.color="#e3cca9",t.lab_name.style.font="SimHei",t.lab_name.style.align="center",t.lab_name.style.fontSize=16,t.lab_name.innerHTML=i.name,t.img.skin=l.ItemUtils.getIconByIconId(n.icon),t.img_selected.visible=!1,t.img_reward.visible=!1,i.status==d.enumStatus.kelingqu?t.img_selected.visible=!0:i.status==d.enumStatus.yilingqu&&(t.img_reward.visible=!0)},t.prototype.changeItemClick=function(t,e){t.type==Laya.Event.CLICK&&(this._boxRewardDlg||(this._boxRewardDlg=new a.ActivityBoxGetDlg),this._boxRewardDlg.showBox(this.arr_rewardData[e].subData,this._activityId))},t.prototype.listMainRenderHandler=function(t,e){var i=this.arr_itemListData[e],n={};n.id=this._activityId,n.listData=i,t.setData(n)},t.prototype.updateView=function(){this.lab_day.changeText(g.TextConst.get(59,this.curDay)),this.lab_count.changeText(Math.min(this._maxTarget,this.rechargeCount).toString()),this.scrollUtil.refresh(this.arr_rewardData),this.list_main.array=this.arr_itemListData,this.list_main.refresh()},t.prototype.countDown=function(){var t=this.endTime-c.ServerTime.serverTime;if(t<0)return this.lab_time.text="00:00:00",void Laya.timer.clearAll(this);var e="",i=Math.floor(t/3600/24),n=Math.floor(t%86400/3600),s=Math.floor(t%3600/60),o=t%60;0<i?(e+=g.TextConst.get(8,i),e+=10<=n?g.TextConst.get(9,n):"0"+g.TextConst.get(9,n),e+=10<=s?g.TextConst.get(11,s):"0"+g.TextConst.get(11,s)):(e+=10<=n?n+":":"0"+n+":",e+=10<=s?s+":":"0"+s+":",e+=10<=o?o:"0"+o),this.lab_time.text=e,Laya.timer.loop(1e3,this,this.countDown)},t.prototype.onBtnClick=function(t){switch(t.target){case this.btn_go:v.Switches.ins.event(109)}},t}(ui.activity.pages.Accumulative_Recharge_3_Day_2UI);e.AccumulativeRecharge3Day2Page=f}),define("src/g/activity/view/ActivityPageFactroy",["require","exports","../../../enum/ActivityTemplate","src/g/activity/view/pages/Level_Compete","src/g/activity/view/pages/ConsumeCompetePage","src/g/activity/view/pages/BossScorePage","src/g/activity/view/pages/KillBossPage","src/g/activity/view/pages/GodDomainBossPage","src/g/activity/view/Accumulative_Recharge","src/g/activity/view/Continuous_Recharge_Rebate","src/g/activity/view/Daily_Accumulative_Recharge","src/g/activity/view/Daily_Rebate","src/g/activity/view/ShopLimitPage","src/g/activity/view/SpecialGiftPage","src/g/activity/view/Stone_Compete","src/g/activity/view/pages/KillBossGroupPage","src/g/activity/view/pages/SevenDayCarnivalPage","src/g/activity/view/pages/AttackCityPreview","src/g/activity/view/pages/GoldTurntablePage","src/g/activity/view/pages/SevenDayCarnival8_14Page","src/g/activity/view/pages/FlashSalePage","src/g/activity/view/pages/VipLimitPage","src/g/activity/view/pages/AdvanceNoticePage","src/g/activity/view/pages/RechargeAndRebatePage","src/g/activity/view/pages/TimeLimitAccumulativeRechargePage","src/g/activity/view/pages/FirstRechargeGroupBuyPage","src/g/activity/view/pages/DailyCompeteListPage","src/g/activity/view/pages/AccumulativeSpendingPage","src/g/activity/view/pages/CurrencyExchangePage","src/g/activity/view/pages/GiftTurntablePage","src/g/activity/view/pages/FlashSaleInnerPage","src/g/activity/view/pages/FlashSalePage2","src/g/activity/view/pages/GroupBuyingPage","src/g/activity/view/pages/TimeLimitLoginPage","src/g/activity/view/pages/ConsumeRankPage","src/g/activity/view/pages/KFTurntablePage","src/g/activity/view/pages/AccumulativeRecharge3DayPage","src/g/activity/view/pages/SlotMachinesTurntablePage","src/g/activity/view/pages/LotteryDrawPage","src/g/activity/view/pages/BossScoreExchangePage","src/g/loginreward/view/NewLoginRewardView","src/g/activity/view/pages/FlashSaleInner2Page","src/g/activity/view/pages/VipLimitDiscountPage","src/g/activity/view/pages/TreasureAppraisalPage","src/g/activity/view/pages/PetCamivalPage","src/g/activity/view/pages/EggFrenzyPage","src/g/activity/view/pages/LuckyBagPage","src/g/activity/view/pages/CommonTaskPage","src/g/activity/view/pages/CommonExchangePage","src/g/activity/view/pages/CommonExchangePage2","src/g/activity/view/pages/LoginGiftPage","src/g/activity/view/pages/HugeGiftPage","src/g/activity/view/pages/GoldFallPage","src/g/activity/view/pages/MysteryStorePage","src/g/activity/view/pages/Daily_Rebate1Page","src/g/activity/view/pages/TurnCradsPage","src/g/activity/view/pages/FriendsHelpPage","src/g/activity/view/pages/KoiStorePage","src/g/activity/view/DragonTreasureView","src/g/activity/view/TimeLimitList","src/g/activity/view/pages/FireWorksPage","src/g/activity/view/pages/GroupDiscountPage","src/g/activity/view/pages/Identify_Gem3","src/g/activity/view/pages/Wheel_DuoBao","src/g/activity/view/pages/JoyTreasurePage","src/g/activity/view/pages/LuckyBuyPage","src/g/activity/view/pages/FlashSalePage3","src/g/activity/view/pages/InvestmentPlanPage","src/g/activity/view/pages/RechargeMoney3","src/g/activity/view/pages/AccumulativeRecharge3Day2Page"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E,T,A,R,L,x,P,k,D,H,M,G,B,N,U,V,O,F,q,K,Y,j,J,W,z,X,Q,Z,$,tt,et,it,nt,st,ot,at,rt,lt,ht,ct,ut,pt,dt,gt,vt){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var ft=function(){function t(){}return t.getActivityPage=function(t){switch(t){case i.ActivityTemplateKey.level_compete:return new n.Level_Compete;case i.ActivityTemplateKey.consume_compete:return new s.ConsumeCompetePage;case i.ActivityTemplateKey.boss_score:return new o.BossScorePage;case i.ActivityTemplateKey.kill_boss:return new a.KillBossPage;case i.ActivityTemplateKey.god_domain_boss:return new r.GodDomainBossPage;case i.ActivityTemplateKey.accumulativerecharge:return new l.Accumulative_Recharge;case i.ActivityTemplateKey.continuous_recharge_rebate:return new h.Continuous_Recharge_Rebate;case i.ActivityTemplateKey.daily_accumulative_recharge:case i.ActivityTemplateKey.week_accumulative_recharge:return new c.Daily_Accumulative_Recharge;case i.ActivityTemplateKey.daily_rebate:return new u.Daily_Rebate;case i.ActivityTemplateKey.limit_gift:return new p.ShopLimitPage;case i.ActivityTemplateKey.specialgift:return new d.SpecialGiftPage;case i.ActivityTemplateKey.stonecompete:return new g.Stone_Compete;case i.ActivityTemplateKey.kill_boss_group:return new v.KillBossGroupPage;case i.ActivityTemplateKey.seven_day_carnival:return new f.SevenDayCarnivalPage;case i.ActivityTemplateKey.attack_city_preview:return new y.AttackCityPreview;case i.ActivityTemplateKey.seven_day_carnival_8_14:return new _.SevenDayCarnival8_14Page;case i.ActivityTemplateKey.gold_turntable:return new m.GoldTurntablePage;case i.ActivityTemplateKey.flash_sale:return new C.FlashSalePage;case i.ActivityTemplateKey.vip_limit_sale:return new I.VipLimitPage;case i.ActivityTemplateKey.advance_notice:return new b.AdvanceNoticePage;case i.ActivityTemplateKey.recharge_rebate:return new w.RechargeAndRebatePage;case i.ActivityTemplateKey.time_limit_accumulative_recharge:return new S.TimeLimitAccumulativeRechargePage;case i.ActivityTemplateKey.first_recharge_group_buy:return new E.FirstRechargeGroupBuyPage;case i.ActivityTemplateKey.daily_compete_list:return new T.DailyCompeteListPage;case i.ActivityTemplateKey.accumulative_spending:return new A.AccumulativeSpendingPage;case i.ActivityTemplateKey.currency_exchange:return new R.CurrencyExchangePage;case i.ActivityTemplateKey.gift_turntable:return new L.GiftTurntablePage;case i.ActivityTemplateKey.flash_sale_inner:return new x.FlashSaleInnerPage;case i.ActivityTemplateKey.flash_sale_inner2:return new O.FlashSaleInner2Page;case i.ActivityTemplateKey.flash_sale_2:return new P.FlashSalePage2;case i.ActivityTemplateKey.group_buying:return new k.GroupBuyingPage;case i.ActivityTemplateKey.time_limit_login:return new D.TimeLimitLoginPage;case i.ActivityTemplateKey.consume_rank:return new H.ConsumeRankPage;case i.ActivityTemplateKey.accumulative_recharge_3_day:return new G.AccumulativeRecharge3DayPage;case i.ActivityTemplateKey.slot_machines_turntable:return new B.SlotMachinesTurntablePage;case i.ActivityTemplateKey.lottery_draw:return new N.LotteryDrawPage;case i.ActivityTemplateKey.boss_score_exchange:return new U.BossScoreExchangePage;case i.ActivityTemplateKey.login_reward:return new V.NewLoginRewardView;case i.ActivityTemplateKey.vip_limit_discount:return new F.VipLimitDiscountPage;case i.ActivityTemplateKey.treasure_appraisal:return new q.TreasureAppraisalPage;case i.ActivityTemplateKey.pet_camival:return new K.PetCamivalPage;case i.ActivityTemplateKey.egg_frenzy:return new Y.EggFrenzyPage;case i.ActivityTemplateKey.lucky_bag:return new j.LuckyBagPage;case i.ActivityTemplateKey.common_task:return new J.CommonTaskPage;case i.ActivityTemplateKey.common_exchange:return new W.CommonExchangePage;case i.ActivityTemplateKey.common_exchange2:return new z.CommonExchangePage2;case i.ActivityTemplateKey.login_gift:return new X.LoginGiftPage;case i.ActivityTemplateKey.huge_gift:return new Q.HugeGiftPage;case i.ActivityTemplateKey.gold_fall:return new Z.GoldFallPage;case i.ActivityTemplateKey.mystery_store:return new $.MysteryStorePage;case i.ActivityTemplateKey.daily_rebate1:return new tt.Daily_Rebate1Page;case i.ActivityTemplateKey.friends_help:return new it.FriendsHelpPage;case i.ActivityTemplateKey.friends_turn_cards:return new et.TurnCardsPage;case i.ActivityTemplateKey.koi_store:return new nt.KoiStorePage;case i.ActivityTemplateKey.Smash_Hammer:return new st.DragonTreasureView;case i.ActivityTemplateKey.time_limit_list:return new ot.TimeLimitList;case i.ActivityTemplateKey.fireWorks:return new at.FireWorksPage;case i.ActivityTemplateKey.groupDiscount:return new rt.GroupDiscountPage;case i.ActivityTemplateKey.Identify_Gem3:return new lt.Identify_Gem3;case i.ActivityTemplateKey.Wheel_duobao:return new ht.Wheel_DuoBao;case i.ActivityTemplateKey.joyTreasure:return new ct.JoyTreasurePage;case i.ActivityTemplateKey.lucky_buy:return new ut.LuckyBuyPage;case i.ActivityTemplateKey.flash_sale_3:return new pt.FlashSalePage3;case i.ActivityTemplateKey.kf_turntable:return new M.KFTurntablePage;case i.ActivityTemplateKey.investment_plan:return new dt.InvestmentPlanPage;case i.ActivityTemplateKey.Recharge_Money_3:return new gt.RechargeMoney3;case i.ActivityTemplateKey.accumulative_recharge_3_day_2:return new vt.AccumulativeRecharge3Day2Page}return null},t}();e.ActivityPageFactroy=ft}),define("src/g/activity/view/ActivityHallViewProxy",["require","exports","../../../core/E","../../../enum/EventName","../../../manager/ActivityManager","src/g/activity/view/NewActivityBtn","../../../manager/RoleCenter","../../../config/GameConfig","src/g/activity/view/ActivityPageFactroy"],function(t,e,i,n,a,r,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(o){function s(t,e,i,n){var s=o.call(this)||this;return s._isInited=!1,s.btnList=new Laya.Dictionary,s.pageList=new Laya.Dictionary,s.closeIsDestroy=!1,s.switchQueue=[],s._currPos=t,s.con_btn=e,s.con_page=i,s._titleImg=n,s}return __extends(s,o),s.prototype.showView=function(){this._isInited?this._currPage&&this._currPage.refresh():this.init()},s.prototype.onAddGold=function(){this._isInited&&this._currPage&&this._currPage.refresh()},s.prototype.init=function(){i.E.ins.on(n.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.changeHallHandler),i.E.ins.on(n.EventName.ADDED_GOLD,this,this.onAddGold),this.initBtns(),this._isInited=!0},s.prototype.changeHallHandler=function(t){t==this._currPos&&this.initBtns()},s.prototype.initBtns=function(){this.con_btn.removeChildren();var t=a.ActivityManager.ins.getActivityHallByPos(this._currPos);if(t){for(var e=t.getActivatedIds(),i=this.idList?this.idList.length:0,n=0;n<i;)(!e||e.length<1||-1==e.indexOf(this.idList[n]))&&this.deleteActivity(this.idList[n]),n++;for(this.idList=e,i=this.idList?this.idList.length:0,n=0;n<i;)this.pushActivity(this.idList[n]),n++;0<i&&Laya.timer.frameOnce(2,this,this.selectActivityHandler,[this.idList[0]])}this.event(s.BTNS_INITED_EVENT)},s.prototype.deleteActivity=function(t){var e=this.btnList.get(t);e&&(e.offAll(),e.destroy()),this.btnList.remove(t);var i=this.pageList.get(t);this.pageList.remove(t),i&&(i.doDestroy(),i==this._currPage&&(this._currPage=null))},s.prototype.pushActivity=function(t){var e=this.btnList.get(t);e||-1!=h.RoleCenter.instans.vo.getIndexByActivityId(t)&&(e=new r.NewActivityBtn(t),this.btnList.set(t,e)),e&&(e.on(Laya.Event.CLICK,this,this.selectActivityHandler,[e.activityId]),this.con_btn.addChild(e))},s.prototype.selectActivityHandler=function(t){var e=this;if(this._running)this.switchQueue.push(t);else{var i=-1;if(this._currPage){var n=this._currPage.getActivityId();if(n==t)return void this._currPage.refresh();(s=this.btnList.get(n))&&(s.selected=!1,i=this.con_btn.getChildIndex(s))}var s,o=1;(s=this.btnList.get(t))&&(s.selected=!0,o=this.con_btn.getChildIndex(s)>i?1:-1),this.con_page.scrollRect=new Laya.Rectangle(0,0,this.con_page.width,this.con_page.height),Laya.timer.once(200,this,function(){e.con_page.scrollRect=null}),this._currPage&&(Laya.Tween.to(this._currPage,{x:this.con_page.width*o*-1},200,null,new Laya.Handler(this,function(t){e.closeIsDestroy?t.doDestroy():t.hidePage()},[this._currPage])),this._currPage=null);var a=this.pageList.get(t);if(!a){var r=h.RoleCenter.instans.vo.getActivity1Data(t);if(r){var l=c.GameConfig.activityJson[r.cfgId];l&&(a=u.ActivityPageFactroy.getActivityPage(l.clientkey))&&this.pageList.set(t,a)}}a&&(this._running=!0,a.showPage(t,this.con_page),a.x=this.con_page.width*o,Laya.Tween.to(a,{x:0},200,null,new Laya.Handler(this,function(t){e._currPage=t,e.setTitle(e._currPage.getActivityId()),e._running=!1,0<e.switchQueue.length&&e.selectActivityHandler(e.switchQueue.shift())},[a])))}},s.prototype.setTitle=function(t){if(this._titleImg){this._titleImg.skin=null;var e=h.RoleCenter.instans.vo.getActivity1Data(t);if(e){var i=c.GameConfig.activityJson[e.cfgId];i&&(this._titleImg.skin="dynamic/activity/titles/"+i.clientkey+".png")}}},s.prototype.backHandler=function(){return!this._currPage||this._currPage.backHandler()},s.BTNS_INITED_EVENT="BTNS_INITED_EVENT",s}(Laya.EventDispatcher);e.ActivityHallViewProxy=s}),define("src/g/activity/view/ActivityHallViewUIProxy",["require","exports","../../../core/E","../../../enum/EventName","../../../manager/ActivityManager","../../../manager/RoleCenter"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){this._pos=e,this._hallView=t}return t.prototype.init=function(){this._hallView&&(this._hallView.con_panel&&(this._hallView.con_panel.hScrollBarSkin="",this._hallView.con_panel.hScrollBar.elasticDistance=100,this._hallView.con_panel.hScrollBar.on(Laya.Event.END,this,this.onScrollEndHandler),this._hallView.btn_turn_left&&this._hallView.btn_turn_left.on(Laya.Event.CLICK,this,this.moveLeft),this._hallView.btn_turn_right&&this._hallView.btn_turn_right.on(Laya.Event.CLICK,this,this.moveRight)),i.E.ins.on(n.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.onActivityHallChanged))},t.prototype.onActivityHallChanged=function(t){this._hallView.displayedInStage&&t==this._pos&&(s.ActivityManager.ins.getActivityHallByPos(t).count<1&&this._hallView.removeSelf())},t.prototype.onBtnsChanged=function(){Laya.timer.frameOnce(2,this,this.onScrollEndHandler)},t.prototype.findBtnByCfgId=function(t){var e,i=this._hallView.con_btn;if(i)for(var n=i.numChildren,s=0;s<n;){if(e=i.getChildAt(s),o.RoleCenter.instans.vo.getActivity1Data(e.activityId).cfgId==t)return e;s++}return null},t.prototype.scrollToBtn=function(t){if(t){var e=this._hallView.con_panel;e&&(e.hScrollBar.value=Math.min(t.x,e.hScrollBar.max),this.onScrollEndHandler())}},t.prototype.onScrollEndHandler=function(){this._hallView.btn_turn_left&&(this._hallView.btn_turn_left.visible=!1),this._hallView.btn_turn_right&&(this._hallView.btn_turn_right.visible=!1),0<this._hallView.con_panel.hScrollBar.max&&(this._hallView.btn_turn_left&&(this._hallView.btn_turn_left.visible=10<this._hallView.con_panel.hScrollBar.value),this._hallView.btn_turn_right&&(this._hallView.btn_turn_right.visible=this._hallView.con_panel.hScrollBar.value<this._hallView.con_panel.hScrollBar.max-10),this.checkTurnBtnRed())},t.prototype.moveRight=function(){this._hallView.con_panel.hScrollBar.value=Math.min(this._hallView.con_panel.hScrollBar.value+this._hallView.con_panel.width,this._hallView.con_panel.hScrollBar.max),this.onScrollEndHandler()},t.prototype.moveLeft=function(){this._hallView.con_panel.hScrollBar.value=Math.max(this._hallView.con_panel.hScrollBar.value-this._hallView.con_panel.width,this._hallView.con_panel.hScrollBar.min),this.onScrollEndHandler()},t.prototype.checkTurnBtnRed=function(){if(this._hallView.con_btn&&this._hallView.img_left_red&&this._hallView.img_right_red&&0<this._hallView.con_panel.hScrollBar.max){for(var t,e,i,n=this._hallView.con_btn,s=n.numChildren,o=0;o<s;)(t=n.getChildAt(o))&&1==t.img_red.visible&&(t.x+t.width<this._hallView.con_panel.hScrollBar.value&&(e=!0),t.x>this._hallView.con_panel.hScrollBar.value+this._hallView.con_panel.width&&(i=!0)),o++;this._hallView.img_left_red.visible=e,this._hallView.img_right_red.visible=i}},t.prototype.checkBtnRedAndTurnTo=function(){if(this._hallView.con_btn&&0<this._hallView.con_panel.hScrollBar.max)for(var t,e=this._hallView.con_btn,i=e.numChildren,n=0;n<i;){if((t=e.getChildAt(n))&&1==t.img_red.visible){this.scrollToBtn(t);break}n++}},t}();e.ActivityHallViewUIProxy=a}),define("src/g/activity/view/ActivityHallView",["require","exports","../../../manager/LayerManager","../../../manager/ActivityManager","../../../enum/ActivityPos","../../../enum/EventName","../../../core/E","src/g/activity/view/ActivityHallViewProxy","src/g/clearRes/ClearResM","src/g/activity/view/ActivityHallViewUIProxy"],function(t,e,n,s,i,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ACTIVITY_HALL,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_back.on(Laya.Event.CLICK,t,t.backHandler),t._uiProxy||(t._uiProxy=new h.ActivityHallViewUIProxy(t,t._pos),t._uiProxy.init()),t._contentProxy||(t._contentProxy=new r.ActivityHallViewProxy(t._pos,t.con_btn,t.con_page,t.bg.img_title),t._contentProxy.on(r.ActivityHallViewProxy.BTNS_INITED_EVENT,t,t.onBtnsUpdated)),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.backHandler=function(){this._contentProxy?this._contentProxy.backHandler()&&this.onCloseHandler():this.onCloseHandler()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),window.enabledpay&&(this._contentProxy.showView(),0<t?Laya.timer.frameOnce(3,this,this.openActivityById,[t]):this._uiProxy.checkBtnRedAndTurnTo(),s.ActivityManager.ins.isInited&&n.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),l.ClearResM.resetViewImg(this),a.E.ins.on(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes))},t.prototype.closeClearRes=function(){a.E.ins.off(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),l.ClearResM.clearFolderByUrl("dynamic/activity/"),l.ClearResM.clearResFolder("activity"),Laya.loader.clearRes(this.img_bg.skin)},t.prototype.onBtnsUpdated=function(){this._uiProxy&&this._uiProxy.onBtnsChanged()},t.prototype.openActivityById=function(t){if(this._uiProxy&&this._contentProxy){var e=this._uiProxy.findBtnByCfgId(t);e&&(this._contentProxy.selectActivityHandler(e.activityId),this._uiProxy.scrollToBtn(e))}},t}(ui.activity.ActivityHallViewUI);e.ActivityHallView=c}),define("src/g/activity/ctrl/ActivityCtrl",["require","exports","../../../manager/GameSocketManager","../../net/messages/activity/ActivityGet","../../../manager/RoleCenter","../../../core/E","../../../enum/EventName","src/g/base/GameBaseCtrl","../../net/messages/activity/sbkUserActivityData","../../net/messages/activity/sbkActivityData","../../../manager/ActivityManager","../../net/messages/enumStatus","../../../config/GameConfig","../../../utils/system/FloatEffect","../../../utils/system/ServerTime","src/g/account/ctrl/GetRewwardCtrl","../../../enum/ActivityTemplate","../../net/messages/activity/ActivityTrigger","src/g/activity/view/pages/CompeteUtil","src/init/GameEventDispatcher"],function(t,e,i,n,p,d,g,s,o,a,r,l,v,f,h,y,c,u,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){i.GSM.ins.on(o.sbkUserActivityData.KEY,this,this.activityInitHandler),i.GSM.ins.on(n.ActivityUpdataGS2C.KEY,this,this.onActivityUpdateHandler),i.GSM.ins.on(n.delActivityGS2C.KEY,this,this.onActivityDeleteHandler),i.GSM.ins.on(n.ActivityGetGS2C.KEY,this,this.onActivityGetHandler),i.GSM.ins.on(a.ShopRandomItemData.KEY,this,this.onActivityShopDataChanged),i.GSM.ins.on(a.RewardInfoData.KEY,this,this.onTurntableRewardInfoHandler),i.GSM.ins.on(a.UpdataAcTaskData.KEY,this,this.onActTaskDataChanged),i.GSM.ins.on(a.AcTaskData.KEY,this,this.initActTaskData),i.GSM.ins.on(n.getActivityAllDataGS2C.KEY,this,this.getActivityAllDataBack),i.GSM.ins.on(n.ActivityGetCenterWheelGS2C.KEY,this,this.onActivityGetWheelHandler),i.GSM.ins.on(u.ActivityConsumeChangeGS2C.KEY,this,this.onActivityConsumeChange),i.GSM.ins.on(u.ActivityTriggerCircleWheelGS2C.KEY,this,this.onSlotMachinesActivityGetHandler),i.GSM.ins.on(u.ActivitySelectRewardPoolGS2C.KEY,this,this.fillLotteryDrawRewardPool),i.GSM.ins.on(u.resetRewardPoolGS2C.KEY,this,this.resetLotteryDrawRewardPool),i.GSM.ins.on(u.ActivityOpenRewardGS2C.KEY,this,this.updateLotteryDrawRewardPool),i.GSM.ins.on(u.discountGiftGS2C.KEY,this,this.onGetDiscountBack),i.GSM.ins.on(u.ActivityRewardGS2C.KEY,this,this.onIdentifyGemBack),i.GSM.ins.on(u.RefreshRewardPoolGS2C.KEY,this,this.onRefreshRewardPoolBack),i.GSM.ins.on(u.OpenEggGS2C.KEY,this,this.onOpenEggBack),i.GSM.ins.on(u.ActivityCfgChangeGS2C.KEY,this,this.changeActivityTbl),i.GSM.ins.on(n.activityLuckyCloudMsg.KEY,this,this.onLuckyCloudHandler),r.ActivityManager.ins},e.prototype.activityInitHandler=function(t){if(console.log(t),t.isNew){h.ServerTime.resetServerTime(t.curSvrTime);for(var e=t.listArr.length,i=0;i<e;){var n=t.listArr[i],s=p.RoleCenter.instans.vo.getIndexByActivityId(n.id),o=p.RoleCenter.instans.vo.getActivityData().listArr,a=v.GameConfig.activityJson[n.cfgId];-1==s?(o.push(n),p.RoleCenter.instans.vo.addActivity1DataMap(n.id,o.length),d.E.ins.event(g.EventName.ACTIVITY_DATA_ADDED,[n.cfgId,n.id,a.trigger])):(o[s]=n,d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[n.cfgId,n.id])),i++}}else p.RoleCenter.instans.vo.activityData(t),d.E.ins.event(g.EventName.ACTIVITY_DATA_INITED)},e.prototype.onActivityDeleteHandler=function(t){for(var e=t.idArr.length,i=0;i<e;)p.RoleCenter.instans.vo.delActivityData(t.idArr[i]),i++},e.prototype.onActivityGetWheelHandler=function(e){if(p.RoleCenter.instans.vo.getActivity1Data(e.id)){var t=v.GameConfig.subActivityJson[e.activity2CfgId];t.cost&&(t.cost.forEach(function(t){p.RoleCenter.instans.vo[t[0]]-=parseInt(t[1])*e.time}),p.RoleCenter.instans.event(g.EventName.ROLE_PROP_CHANGE))}},e.prototype.onActivityConsumeChange=function(t){0<t.itemId&&0<t.itemNum&&p.RoleCenter.instans.vo.chgItemCount(t.itemId,-1*t.itemNum),t.currencyKey&&""!=t.currencyKey&&0<t.currencyNum&&(p.RoleCenter.instans.vo[t.currencyKey]+=-1*t.currencyNum,p.RoleCenter.instans.event(g.EventName.ROLE_PROP_CHANGE))},e.prototype.onSlotMachinesActivityGetHandler=function(t){p.RoleCenter.instans.addInventoryToC(t.inv)},e.prototype.onActivityGetHandler=function(t){if(t.opresult){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);if(e){var i=v.GameConfig.activityJson[e.cfgId];i.isActivityRandomShop()?this.activityRandomShopBuyBackHandler(t):i.isGoldTurntable()?this.activityGoldTurntableBackHandler(t):i.clientkey==c.ActivityTemplateKey.vip_limit_discount?this.vipLimitDiscountGetBackHandler(t):i.clientkey==c.ActivityTemplateKey.treasure_appraisal?(p.RoleCenter.instans.addInventoryToC(t.inv),f.FE.addInventoryToCFloats(t.inv),y.GetRewwardCtrl.inventoryAddGS2C(t.inv)):this.activityGetBackHandler(t),_.GE.ins.event(1)}}else{var n=v.GameConfig.getErrorCodeCfg(t.error);console.log(n)}},e.prototype.activityGoldTurntableBackHandler=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);if(e){v.GameConfig.activityJson[e.cfgId];for(var i=e.children.length,n=0;n<i;){if(e.children[n].cfgId==t.activity2CfgId){e.children[n].status=l.enumStatus.yilingqu,d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[e.cfgId,e.id]);break}n++}}var s=v.GameConfig.subActivityJson[t.activity2CfgId];s.cost&&(s.cost.forEach(function(t){p.RoleCenter.instans.vo[t[0]]-=parseInt(t[1])}),p.RoleCenter.instans.event(g.EventName.ROLE_PROP_CHANGE)),p.RoleCenter.instans.addInventoryToC(t.inv)},e.prototype.activityGetBackHandler=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);if(e)for(var i=v.GameConfig.activityJson[e.cfgId],n=e.children.length,s=0;s<n;){if(e.children[s].cfgId==t.activity2CfgId){if(i.clientkey==c.ActivityTemplateKey.group_buying)Number(i.value)+e.startTime>h.ServerTime.serverTime?e.children[s].status=l.enumStatus.yilingqu:e.children[s].count++;else i.isLimitBuy()?e.children[s].count++:e.children[s].status=l.enumStatus.yilingqu;d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[e.cfgId,e.id]);break}s++}if(i.clientkey==c.ActivityTemplateKey.group_buying);else{var o=v.GameConfig.subActivityJson[t.activity2CfgId];o.cost&&(o.cost.forEach(function(t){var e=Number(t[0]);0<e?p.RoleCenter.instans.vo.chgItemCount(e,-parseInt(t[1])):p.RoleCenter.instans.vo[t[0]]-=parseInt(t[1])}),p.RoleCenter.instans.event(g.EventName.ROLE_PROP_CHANGE))}p.RoleCenter.instans.addInventoryToC(t.inv),f.FE.addInventoryToCFloats(t.inv),i.isPopRewardPanel()&&0!=i.pos&&y.GetRewwardCtrl.inventoryAddGS2C(t.inv)},e.prototype.vipLimitDiscountGetBackHandler=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);if(e)for(var i=v.GameConfig.activityJson[e.cfgId],n=e.children.length,s=0;s<n;){if(e.children[s].cfgId==t.activity2CfgId){e.children[s].status=l.enumStatus.yilingqu;var o=v.GameConfig.subActivityJson[t.activity2CfgId];o.cost&&(o.cost.forEach(function(t){p.RoleCenter.instans.vo[t[0]]-=parseInt(t[1])-e.children[s].count}),p.RoleCenter.instans.event(g.EventName.ROLE_PROP_CHANGE)),d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[e.cfgId,e.id]);break}s++}p.RoleCenter.instans.addInventoryToC(t.inv),f.FE.addInventoryToCFloats(t.inv),i.isPopRewardPanel()&&0!=i.pos&&y.GetRewwardCtrl.inventoryAddGS2C(t.inv)},e.prototype.activityRandomShopBuyBackHandler=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);if(e){for(var i=v.GameConfig.activityJson[e.cfgId],n=e.children.length,s=0,o=!1;s<n;){if(e.children[s].cfgId==t.activity2CfgId){if("Shop_RandomItemJL"!=i.trigger)if(r=v.GameConfig.subActivityJson[t.activity2CfgId]){var a=Number(r.cost[0][1]);e.allData.allCount-=a}e.children[s].count++,o=!0,d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[e.cfgId,e.id]);break}s++}if(!o){var r,l=1;if((r=v.GameConfig.subActivityJson[e.children[2].cfgId])&&(l=Number(r.bonus[0][1])),e.randomItemData){var h=e.randomItemData.permitArr.indexOf(t.activity2CfgId);if(-1!=h?e.randomItemData.permitArr[h+1]+=1:(e.randomItemData.permitArr.push(t.activity2CfgId),e.randomItemData.permitArr.push(1)),-1!=(h=e.randomItemData.bugCfgIdArr.indexOf(t.activity2CfgId))?e.randomItemData.bugCfgIdArr[h+1]+=1:(e.randomItemData.bugCfgIdArr.push(t.activity2CfgId),e.randomItemData.bugCfgIdArr.push(1)),"Shop_RandomItemJL"!=i.trigger){var c=v.GameConfig.activityShop[t.activity2CfgId];if(c){var u=c.cost[0][1];e.allData.allCount+=Math.round(u/l)}}d.E.ins.event(g.EventName.ACTIVITY_SHOP_DATA_CHANGED,[t.id]),d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[e.cfgId,e.id])}}}p.RoleCenter.instans.addInventoryToC(t.inv),f.FE.addInventoryToCFloats(t.inv),y.GetRewwardCtrl.inventoryAddGS2C(t.inv)},e.prototype.onActivityUpdateHandler=function(t){if(p.RoleCenter.instans.vo){var i=p.RoleCenter.instans.vo.getActivity1Data(t.id);if(i){var n=i.children.length;t.children.forEach(function(t){for(var e=0;e<n;)i.children[e].cfgId==t.cfgId&&i.children[e].copydata(t),e++}),i.allData.allCount=t.allData.allCount,i.allData.time=t.allData.time;var e=v.GameConfig.activityJson[i.cfgId];0<t.value1&&e&&"Recharge_MoneyBack"==e.trigger&&(i.rewardTime=t.value1,d.E.ins.event(g.EventName.ACTIVITY_END_TIME_CHANGED,[i.id])),0<t.value1&&e&&"Identify_Gem3"==e.trigger&&(i.recharge=t.value1),d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[i.cfgId,i.id])}}},e.prototype.getActivityAllDataBack=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);e&&(e.allAreaData?e.allAreaData.copydata(t.allData):e.allAreaData=t.allData,d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[e.cfgId,e.id]))},e.prototype.onFirstRechargeSuccess=function(){for(var t,e=p.RoleCenter.instans.vo.getActivityData(),i=e.listArr.length,n=0;n<i;n++){var s=e.listArr[n];if(v.GameConfig.activityJson[s.cfgId].trigger==m.svrActivityTrigger.Recharge_TianTian){t=s;break}}if(t){var o,a=t.id;for(i=t.children.length,n=0;n<i;)o=t.children[n].cfgId,t.children[n].status=l.enumStatus.yilingqu,d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[o,a]),n++}},e.prototype.onActivityShopDataChanged=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);e&&(e.randomItemData?e.randomItemData.copydata(t):e.randomItemData=t,d.E.ins.event(g.EventName.ACTIVITY_SHOP_PRODUCT_LIST_CHANGED,[t.id]),d.E.ins.event(g.EventName.ACTIVITY_SHOP_DATA_CHANGED,[t.id]))},e.prototype.onTurntableRewardInfoHandler=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);if(e){if(0==t.type)e.rewardInfo?e.rewardInfo.copydata(t):e.rewardInfo=t;else if(1==t.type)if(e.rewardInfo){var i=t.infoArr.length,n=0;for(e.rewardInfo.infoArr||(e.rewardInfo.infoArr=[]);n<i;)e.rewardInfo.infoArr.push(t.infoArr[n]),n++;for(i=t.personInfoArr.length,n=0,e.rewardInfo.personInfoArr||(e.rewardInfo.personInfoArr=[]);n<i;)e.rewardInfo.personInfoArr.push(t.personInfoArr[n]),n++}else e.rewardInfo=t;d.E.ins.event(g.EventName.ACTIVITY_GOLD_TURNTABLE_LOG_CHANGED,[t])}},e.prototype.initActTaskData=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);e&&(e.task=t,this.updateActTaskState(t.id))},e.prototype.onActTaskDataChanged=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);-1<t.idx&&e&&(e.task.countArr[t.idx]=t.count,this.updateActTaskState(t.id))},e.prototype.updateActTaskState=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t);if(e)for(var i,n,s=e.children.length,o=0;o<s;)(i=e.children[o])&&i.status==l.enumStatus.weiwancheng&&100<(n=v.GameConfig.subActivityJson[i.cfgId]).childId&&e.task.countArr[n.value-1]>=n.value2&&(i.status=l.enumStatus.kelingqu,d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[i.cfgId,t])),o++},e.prototype.fillLotteryDrawRewardPool=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);e&&(e.rewardPool=t.rewardPool,d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[e.cfgId,e.id]))},e.prototype.resetLotteryDrawRewardPool=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);e&&(e.allData.allCount=0,e.allData.time++,e.rewardPool.length=0,d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[e.cfgId,e.id]))},e.prototype.updateLotteryDrawRewardPool=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);if(e){if(p.RoleCenter.instans.vo.GOLD-=t.consumeGold,p.RoleCenter.instans.event(g.EventName.ROLE_PROP_CHANGE),t.rewardIndex<0)e.rewardPool=t.changeRewardPool;else{var i=t.changeRewardPool[0];e.rewardPool[t.rewardIndex].index=i.index}d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[e.cfgId,e.id])}},e.prototype.onGetDiscountBack=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);if(e)for(var i,n=e.children.length,s=0;s<n;){if((i=e.children[s])&&i.cfgId==t.activity2CfgId){i.count=t.discountNum,Laya.timer.frameOnce(1,this,function(){d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[i.cfgId,t.id])});break}s++}},e.prototype.onIdentifyGemBack=function(t){p.RoleCenter.instans.addInventoryToC(t.inv),f.FE.addInventoryToCFloats(t.inv);var e=v.GameConfig.activityJson[t.activity2CfgId];e&&e.clientkey==c.ActivityTemplateKey.egg_frenzy||y.GetRewwardCtrl.inventoryAddGS2C(t.inv)},e.prototype.onRefreshRewardPoolBack=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);e&&(e.rewardPool=t.rewardPool,d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[e.cfgId,e.id]))},e.prototype.onOpenEggBack=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);if(e){if(t.rewardIndex<0)e.rewardPool=t.changeRewardPool;else{var i=t.changeRewardPool[0];e.rewardPool[t.rewardIndex].index=i.index}d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[e.cfgId,e.id])}},e.prototype.changeActivityTbl=function(t){for(var e=t.changeArr,i=0;i<e.length;i++)v.GameConfig.changeActivityTbl(e[i][0],e[i][1]),d.E.ins.event(g.EventName.ACTIVITY_TIME_SPAN,e[i][0])},e.prototype.onLuckyCloudHandler=function(t){var e=p.RoleCenter.instans.vo.getActivity1Data(t.id);if(e){for(var i,n=e.children.length,s=0;s<n;){if((i=e.children[s])&&i.cfgId==t.ac2CfgId){1==t.type?(i.childCountArr=[],t.strArr.forEach(function(t){i.childCountArr.push(Number(t))})):2==t.type?i.count=Number(t.strArr.shift()):3==t.type&&(i.count=Number(t.strArr.shift()),i.strArr=t.strArr);break}s++}d.E.ins.event(g.EventName.ACTIVITY_DATA_CHANGED,[e.cfgId,e.id])}},e.LOGIN_ACTIVITY_ID=101,e.FIRST_RECHARGE_ACTIVITY_ID=102,e.FIRST_RECHARGE_ACTIVITY_ID_NEW=104,e}(s.GameBaseCtrl);e.ActivityCtrl=C}),define("src/g/fight/osprite/play/worldboss/WorldBossManager",["require","exports","../../../../../core/E","../../../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../../net/messages/ChangeSceneMsg","../../../../net/messages/WorldBossMsg","../../../../../manager/RoleCenter","../../../../../manager/AM","../../../../../manager/GameSocketManager","../../../../../utils/system/FloatEffect","../../../../../plugin/view/ToolTip","../../../../../manager/BulletManager","../../../../../config/GameConfig","../../../../../meta/WorldBossVo","../../../../net/messages/ActivityMessage","../../../../net/messages/HornMessageGS2C","../../../../net/messages/sbkUserData","src/g/fightactivity/ctrl/FightActivityCtrl","../../../../net/messages/BossCriticalHit","src/g/fight/osprite/play/PlayManager","src/init/TextConst"],function(t,e,n,s,o,a,r,l,h,c,u,p,i,d,g,v,f,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var b=function(){function t(){this.viewCtrl=null,this.gamePlay=null,this.openId=-1,this._familyInspireNum=0,this._inspireNum=0}return t.getInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.enterGamePlay=function(t){this._familyInspireNum=0,this._inspireNum=0,this.gamePlay=t,n.E.ins.event(s.EventName.ENTER_WORLDBOSS_WAR);var e=c.GSM.ins;e.on(r.WorldBossFamilyRankGS2C.KEY,this,this.onWorldBossFamilyRankGS2C),e.on(r.WBEndRewardGS2C.KEY,this,this.onWBEndRewardGS2C),e.on(r.FamilyUserChangeGS2C.KEY,this,this.onFamilyUserChangeGS2C),e.on(r.WBInspireGS2C.KEY,this,this.onWBInspireGS2C),e.on(r.WorldBossFamilyData.KEY,this,this.onWorldBossFamilyData),e.on(v.JoinInActivityGS2C.KEY,this,this.onJoinInActivityGS2C),e.on(_.BossCriticalHitCDGS2C.KEY,this,this.onBossCriticalHitCDGS2C)},t.prototype.exitGamePlay=function(){var t=c.GSM.ins;t.off(_.BossCriticalHitCDGS2C.KEY,this,this.onBossCriticalHitCDGS2C),t.off(r.WorldBossFamilyRankGS2C.KEY,this,this.onWorldBossFamilyRankGS2C),t.off(r.WBEndRewardGS2C.KEY,this,this.onWBEndRewardGS2C),t.off(r.FamilyUserChangeGS2C.KEY,this,this.onFamilyUserChangeGS2C),t.off(r.WBInspireGS2C.KEY,this,this.onWBInspireGS2C),t.off(r.WorldBossFamilyData.KEY,this,this.onWorldBossFamilyData),t.off(v.JoinInActivityGS2C.KEY,this,this.onJoinInActivityGS2C),this.gamePlay=null,this.viewCtrl&&(this.viewCtrl.exit(),this.viewCtrl=null)},t.prototype.onBossCriticalHitCDGS2C=function(t){this.viewCtrl&&this.viewCtrl.startSkillCountDown(t.cd)},t.prototype.onJoinInActivityGS2C=function(t){this.gamePlay&&(this.gamePlay.onJoinInActMsg(t),this.updateBossHp(t.bossHP/1e4))},t.prototype.enterWorldBoss=function(){var t=l.RoleCenter.instans.self,e=null;if(t&&t.ufData&&(e=t.ufData.familyUId),null==e||""==e)return u.FE.upItems(I.TextConst.get(432),p.BubbleEnum.center),!1;if(!l.RoleCenter.instans.bagRoomEnough())return h.AM.showBagNotEnough(),!1;if(C.PlayManager.isSpecialPlay())return u.FE.upItems(I.TextConst.get(406),p.BubbleEnum.center),!1;if(-1==this.openId)return u.FE.upItems(I.TextConst.get(455),p.BubbleEnum.center),!1;var i=d.GameConfig.worldBossVo[this.openId];return i&&l.RoleCenter.instans.self.getCurLv()<i.limit?(u.FE.upItems(I.TextConst.get(470,i.limit),p.BubbleEnum.center),!1):(n.E.ins.event(s.EventName.PLAY_TYPE_CHANGE,o.PlayTypeVo.create(a.EPlayType.PLAYTYPE_WORLDBOSS)),!0)},t.prototype.onWorldBossOpenGS2C=function(t){this.openId=t.bossId,i.BulletManager.addBroadcastById(t.openHornID),m.FightActivityCtrl.startActivity(a.EPlayType.PLAYTYPE_WORLDBOSS),n.E.ins.event(s.EventName.WORLDBOSS_BOSS_COMMING)},t.prototype.onWorldBossEndGS2C=function(t){this.openId=-1;var e=new f.HornMessageGS2C;e.noticeid=t.hornID,e.noticePara=t.hornPara,l.RoleCenter.instans.noticeHandler(e),m.FightActivityCtrl.endActivtiy(a.EPlayType.PLAYTYPE_WORLDBOSS),n.E.ins.event(s.EventName.WORLDBOSS_BOSS_DIE)},t.prototype.reqLastRank=function(t){var e=new r.GetWBHurtRankC2GS;e.bossid=t,c.GSM.sendServer(e)},t.prototype.onWorldBossFamilyRankGS2C=function(t){if(65535==t.bossHPPercent);else{this.updateBossHp(t.bossHPPercent/1e4);var e=l.RoleCenter.instans.self,i=null;y.sbkUserData&&(i=e.ufData.familyUId);for(var n=-1,s=null,o=0;o<t.rankArr.length;o++)i==(s=t.rankArr[o]).fuid&&(n=o),console.log("fname:"+s.fname+" totalHurt:"+s.totalHurt);-1!=n&&(s=t.rankArr[n],this.updateSelfFamilyData(s)),this.viewCtrl&&this.viewCtrl.updRankList(t.rankArr)}},t.prototype.onWBEndRewardGS2C=function(t){console.error(JSON.stringify(t)),this.viewCtrl&&this.viewCtrl.onWarEnd(t)},t.prototype.onFamilyUserChangeGS2C=function(t){l.RoleCenter.instans.self.username==t.newcomerName&&this.updateSelfInspireNum(t.newcomerISNum),this.viewCtrl&&this.viewCtrl.updJoinPlayerNum(t.inActUserNum)},t.prototype.sendWBInspireC2GS=function(){var t=this.getSetting(this.openId),e=null;if(t)if(this._inspireNum<t.persontimes)if(this._familyInspireNum<t.familytimes){var i=t.price[this._inspireNum];if(!(l.RoleCenter.instans.self.GOLD<i)){var n=new r.WBInspireC2GS;return n.actid=this.openId,c.GSM.sendServer(n),!0}e=I.TextConst.get(471)}else e=I.TextConst.get(472);else e=I.TextConst.get(473,t.persontimes);return null!=e&&u.FE.upItems(e,p.BubbleEnum.center),!1},t.prototype.onWBInspireGS2C=function(t){t.opres?(this._familyInspireNum=t.fmInspireNum,t.uname==l.RoleCenter.instans.self.username&&(l.RoleCenter.instans.addInventoryToC(t.invent),u.FE.addInventoryToCFloats(t.invent,!1,!0),this.updateSelfInspireNum(t.myInspireNum),u.FE.upItems(I.TextConst.get(895),p.BubbleEnum.center))):(u.FE.upItems(t.error,p.BubbleEnum.center),console.error(t.error))},t.prototype.onWorldBossFamilyData=function(t){this.updateSelfFamilyData(t)},t.prototype.updateSelfFamilyData=function(t){this.viewCtrl&&this.viewCtrl.updMyFamilyHurt(t.totalHurt,t.hurtAddRate),this._familyInspireNum=t.inspireNum},t.prototype.updateSelfInspireNum=function(t){this._inspireNum=t,this.viewCtrl&&this.viewCtrl.onInspireSuc()},t.prototype.getSelfInspireNum=function(){return this._inspireNum},t.prototype.getFamilyInspireNum=function(){return this._familyInspireNum},t.prototype.getSetting=function(t){return d.GameConfig.worldBossVo[t]?d.GameConfig.worldBossVo[t]:(console.error("世界boss数据找不到：id="+t),new g.WorldBossVo)},t.prototype.showDeadAlert=function(){this.viewCtrl&&this.viewCtrl.onDeath(new Laya.Handler(this,this.onReLife))},t.prototype.onReLife=function(){this.gamePlay&&this.gamePlay.sendReBorn()},t.prototype.relifeComplete=function(){this.viewCtrl&&this.viewCtrl.onRelife()},t.prototype.updateBossHp=function(t){console.log("boss当前的百分比血量:"+t),this.viewCtrl&&this.viewCtrl.updateHpProgress(t)},t.prototype.exitWorldBoss=function(){this.gamePlay&&this.gamePlay.exitHandler()},t._instance=null,t.actid=0,t}();e.WorldBossManager=b}),define("src/g/fight/osprite/play/team/TeamManager",["require","exports","../../../../net/messages/TeamMsg","../../../../net/messages/HelpFightMsg","../../../../../manager/RoleCenter","src/init/GameState"],function(t,e,h,c,u,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function o(){}return o.updateTeamState=function(t,e){var i=this.help,n=i[t],s=null,o=!1;if(e instanceof c.HelpFightMsgGS2C)s=(i[t]=e).teamState;else if(e instanceof h.CreateTeamGS2C){n||(i[t]=n=new c.HelpFightMsgGS2C);var a=e.teamStateData;n.teamState=a,n.level=e.portIndex,s=a}else if(e instanceof h.ExitTeamGS2C){if(!n)return null;if(e.uname==n.teamState.captain.username)n.teamState.teamState=h.enumTeamState.dismiss,delete i[t],this.clearTeamUid(t),o=!0;else{for(var r=n.teamState.member,l=r.length-1;0<=l;l--)r[l].username==e.uname&&(r.splice(l,1),e.uname==u.RoleCenter.instans.vo.username&&(this.clearTeamUid(t),o=!0));n.teamState.teamState=h.enumTeamState.readyJoin}s=n.teamState}else e instanceof h.TeamStateGS2C?(n||(i[t]=n=new c.HelpFightMsgGS2C),s=n.teamState=e):"number"==typeof e&&n&&(n.teamState.teamState=e,s=n.teamState,e==h.enumTeamState.dismiss&&(delete i[t],this.clearTeamUid(t),o=!0));return o||this.recordTeamUid(s),s},o.recordTeamUid=function(t){if(t)if(t.captain.username==u.RoleCenter.instans.vo.username)n.GameState.my_team_uid=t.teamUid;else for(var e=t.member.length,i=0;i<e;){if(t.member[i].username==u.RoleCenter.instans.vo.username){n.GameState.my_team_uid=t.teamUid;break}i++}},o.clearTeamUid=function(t){t==n.GameState.my_team_uid&&(n.GameState.my_team_uid=0)},o.getTeamFightMsg=function(t){return this.help[t]},o.getMemberUn=function(t){var e="";if(t){var i=o.getTeamFightMsg(t.teamUid);if(i){var n=i.teamState;if((e=n.captain.username)==u.RoleCenter.instans.vo.username){var s=n.member;0<s.length&&(e=s[0].username)}}}return e},o.help={},o}();e.TeamManager=i}),define("src/g/chat/ctrl/ChatContentManager",["require","exports","../../net/messages/chat/ChatC2GS","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../../manager/NewRedHintsCenter","../../../config/GameConfig","../../../meta/ChatTemplateVo","../../../meta/MainButtonVo","../../../utils/system/FloatEffect","src/g/fight/osprite/play/PlayManager","src/g/friend/ctrl/FriendsDataManager","../../net/messages/ChangeSceneMsg","../../../plugin/view/ToolTip","../../../utils/ItemUtils","src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager","src/g/fight/osprite/play/worldboss/WorldBossManager","src/g/fight/osprite/play/kfhotblood/KfHotBloodManager","src/init/TextConst","src/init/GameMain","../../../enum/ChatLinkType","../../net/messages/TeamMsg","../../../manager/GameSocketManager","../../../manager/AM","src/g/fight/osprite/play/team/TeamManager"],function(t,e,o,l,h,c,a,r,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E,T,A,R){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._checkRepeat=!1,this._content=[],l.E.ins.on(h.EventName.SOCIETY_LEAVE,this,this.onExitGuildHandler),l.E.ins.on(h.EventName.GAME_RESTART,this,this.onGameReStart),l.E.ins.on(h.EventName.DELETE_CHAT_CONTENT,this,this.onDelContent)}return t.prototype.onGameReStart=function(){var t=this;this._checkRepeat=!0,Laya.timer.once(1e3,this,function(){t._checkRepeat=!1})},t.prototype.onExitGuildHandler=function(){this.clearChannelChats(o.enumChatType.family)},t.prototype.onDelContent=function(e,i){e&&this._content.forEach(function(t){t.type==i&&(t.msg=t.msg.replace(e,""))})},t.prototype.addContent=function(t,e){if(t.type!=o.enumChatType.baned){var i=this._content;if(this._checkRepeat)for(var n=0;n<i.length;n++){if((s=i[n]).type==t.type&&s.msg==t.msg)return}if(t.type==o.enumChatType.addIfNoMsg){if(3<=i.length)return;t.type=o.enumChatType.system}if((window.enabledpay||(t.vip=0,!(t.type==o.enumChatType.system&&0<=t.msg.search(/充|vip|VIP|月卡|利/))))&&!v.FriendsDataManager.ins.userInMyList(t.username))if(e){for(n=0;n<i.length;n++){var s;(s=i[n]).msg==t.msg&&s.type==t.type&&(s.msg=e)}l.E.ins.event(h.EventName.CHAT_CONTENT_ADDED,[t,e])}else i.push(t),150<i.length&&i.shift(),l.E.ins.event(h.EventName.CHAT_CONTENT_ADDED,t),t.type==o.enumChatType.family?a.NewRedHintsCenter.ins.setRedHintOpenOrClose(a.enumRedHints.chat_family,!0):t.type==o.enumChatType.world&&a.NewRedHintsCenter.ins.setRedHintOpenOrClose(a.enumRedHints.chat_world,!0)}else this.banContent(t)},t.prototype.banContent=function(t){for(var e=this._content.length-1;0<=e;)this._content[e].username==t.username&&this._content.splice(e,1),e--;l.E.ins.event(h.EventName.CHAT_CONTENT_BANED,t.username)},t.prototype.getContentList=function(t){var e=this._content;if(t==o.enumChatType.start)return e;for(var i=[],n=e.length,s=0;s<n;)(e[s].type==t||t==o.enumChatType.world&&e[s].type==o.enumChatType.littleHorn)&&i.push(e[s]),s++;return i},t.prototype.clearChannelChats=function(t){this._content.length=0,l.E.ins.event(h.EventName.CHAT_CONTENT_CLEAR,t)},t.chatMsgToStr=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=30);var s="";return e&&(t.type==o.enumChatType.world||t.type==o.enumChatType.littleHorn?s+=this.channelStr[0]:t.type==o.enumChatType.family?s+=this.channelStr[1]:t.type==o.enumChatType.system?s+=this.channelStr[2]:t.type==o.enumChatType.allWorld&&(s+=this.channelStr[3])),t.type!=o.enumChatType.system&&(0<t.vip&&(s+="<chatimage srcc='"+m.ItemUtils.getVipIconByLevel(t.vip)+"'></chatimage> "),null!=t.nickname&&""!=t.nickname&&(t.type==o.enumChatType.allWorld?s+='<font  color="#1ba5e3"> '+w.GameMain.getDisSvrId(t.username)+t.nickname+":</font>":s+='<font  color="#1ba5e3"> '+t.nickname+":</font>")),t.type==o.enumChatType.littleHorn&&(s+=n<24?"<chatimage srcc='res/chat/liaotian_laba.png'></chatimage>":"<chatimage srcc='res/chat/liaotian_laba.png' ></chatimage>"),s+=this.checkInfo(u.ChatTemplateVo.transform(t.msg,i),n)},t.privateChatMsgToStr=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=30);var n=b.TextConst.get(807);if(t.fromUsername==c.RoleCenter.instans.vo.username)n+=b.TextConst.get(808,"#00ff00",c.RoleCenter.instans.vo.nickname);else{var s=v.FriendsDataManager.ins.getFriendDataByUsername(t.fromUsername);s?n+=b.TextConst.get(808,"#1ba5e3",s.nickname):console.log("没有私聊人的数据信息")}return n+=this.checkInfo(u.ChatTemplateVo.transform(t.msg,e),i)},t.checkInfo=function(t,e){void 0===e&&(e=30);var i=r.GameConfig.expression;for(var n in i){var s=n,o=i[n];if(1==o.type){var a="dynamic2/expression/"+o.res+".json";t=t.replace(new RegExp(s,"g"),"<chatimg srcc='"+a+"' style='width:"+e+"px; height:"+e+"px'></chatimg>")}else if(2==o.type){a="dynamic2/expression/"+o.res+".png";if(30!=e)o.height;t=t.replace(new RegExp(s,"g"),'<chatimage povY="-8" srcc=\''+a+"'></chatimage>")}}return t},t.onLinkHandler=function(t){var e=t.split(":"),i=e[0];if(g.PlayManager.isSpecialPlay()&&i!=S.ChatLinkType.hotBlood&&i!=S.ChatLinkType.kfhotBlood)d.FE.upItems(b.TextConst.get(406),y.BubbleEnum.center);else if(i==S.ChatLinkType.openModule){var n=e[1].split(","),s=+n[0];if(130==s&&g.PlayManager.type==f.EPlayType.PLAYTYPE_SUMMONBOSS)return void d.FE.upItems(b.TextConst.get(309),y.BubbleEnum.center);1<n.length?p.MainButtonStruct.Ins.OpenModule(s,Number(n[1])):0<n.length&&p.MainButtonStruct.Ins.OpenModule(s)}else if(i==S.ChatLinkType.familyRedPacket)l.E.ins.event("qiangHongBaoByLink",e[1]);else if(i==S.ChatLinkType.hotBlood)_.HotBloodWarManager.getInstance().enterHotBloodWar(Number(e[1]));else if(i==S.ChatLinkType.worldBoss)C.WorldBossManager.getInstance().enterWorldBoss();else if(i==S.ChatLinkType.kfhotBlood)I.KFHotBloodManager.ins().enterHotBloodWar(Number(e[1]));else if(i==S.ChatLinkType.port){if(!c.RoleCenter.instans.bagRoomEnough())return void A.AM.showBagNotEnough();var o=+e[1],a=R.TeamManager.getTeamFightMsg(o);if(!a||a.teamState.teamState!=E.enumTeamState.readyJoin)return void d.FE.upItems(b.TextConst.get(1e3),y.BubbleEnum.center);if(0==c.RoleCenter.instans.vo.portstatus.hfData.HELPFIGHT_OTHER)return void d.FE.upItems(b.TextConst.get(999),y.BubbleEnum.center);var r=new E.JoinTeamC2GS;r.teamUid=o,T.GSM.sendServer(r)}else i==S.ChatLinkType.teamcopy&&l.E.ins.event(h.EventName.TEAM_COPY_WANT_TO_ADD_TEAM,Number(e[1]))},t.getColorByChatType=function(t){switch(t){case o.enumChatType.system:return"#c0b4a3";case o.enumChatType.family:return"#0bda01";case o.enumChatType.allWorld:return"#fa6ff2";default:return"#faeb6f"}},t.channelStr=["<chatimage srcc='res/chat/anniu_shijie_zi01.png' style='width:29px; height:15px'></chatimage>","<chatimage srcc='res/chat/anniu_hanghui_zi01.png' style='width:29px; height:15px'></chatimage>","<chatimage srcc='res/chat/sc_system.png' style='width:29px; height:15px'></chatimage>","<chatimage srcc='res/chat/anniu_kuafu_zi01.png' style='width:29px; height:15px'></chatimage>"],t}();e.ChatContentManager=i}),define("src/g/chat/view/ExpItem",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t._ani=new Laya.Animation,t.Key="",t.addChild(t._ani),t.width=t.height=36,t}return __extends(t,e),t.prototype.setData=function(t){this.Key=t.id;var e="dynamic2/expression/"+t.res+".json";this._ani.loadAtlas(e),this._ani.play(),this._ani.scaleX=.6,this._ani.scaleY=.6,this._ani.interval=120},t}(Laya.Sprite);e.ExpItem=i}),define("src/g/chat/view/ChatCommonlyWord",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.update=function(){var t=this.dataSource;this.lbWord.text=t.res},e}(ui.chat.ChatCommonlyWordUI);e.ChatCommonlyWord=i}),define("src/g/chat/view/ChatArtWord",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.update=function(t){this.imgWord.skin="dynamic2/expression/"+t.res+".png"},e}(ui.chat.ChatArtWordUI);e.ChatArtWord=i}),define("src/g/chat/ctrl/ChatSupervisor",["require","exports","../../../config/GameConfig","../../../utils/StringUtils","src/init/GameState","../../../utils/MathUtils"],function(t,e,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._banTime=864e5}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t),this._ins},enumerable:!0,configurable:!0}),t.prototype.checkContent=function(t,e){0==a.GameState.ban_chat_send_to_sever&&this.checkSameContent(e)},t.prototype.checkSameContent=function(t){if(t){for(var e in t=o.StringUtils.trim(t),s.GameConfig.expression)t=t.replace(new RegExp(e,"g"),"");if(""!=t){var i=window.md5(t);this._record||(this._record=new Laya.Dictionary);var n=this._record.get(i)||0;this._record.set(i,++n),2<n&&(a.GameState.ban_chat_send_to_sever=r.MathUtils.addBit(a.GameState.ban_chat_send_to_sever,1),Laya.timer.once(this._banTime,this,function(){a.GameState.ban_chat_send_to_sever=r.MathUtils.subBit(a.GameState.ban_chat_send_to_sever,1)}))}}},t}();e.ChatSupervisor=i}),define("src/g/chat/view/ChatLabel",["require","exports","../../net/messages/friend/FriendMsg","src/g/chat/ctrl/ChatContentManager","../../net/messages/chat/ChatGS2C"],function(t,e,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this,e=t.style;return e.color="#c0b4a3",e.font="SimHei",e.fontSize=16,e.wordWrap=!0,e.leading=4,t.autoSize=!0,t}return __extends(t,i),t.prototype.setTextByMsg=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=20);var n="",s="";this.usename=null,t instanceof o.PrivateChatGS2C?(n=t.msg,s=a.ChatContentManager.privateChatMsgToStr(t,!1,20)):t instanceof r.ChatGS2C&&(this.usename=t.username,n=t.msg,s=a.ChatContentManager.chatMsgToStr(t,e,!0,i),this.style.color=a.ChatContentManager.getColorByChatType(t.type)),this.content=n,this.currContent=s,this.innerHTML=s},t.prototype.cutChatContent=function(t){-1!=this.currContent.indexOf(t)&&(this.currContent=this.currContent.replace(t,""),this.innerHTML=this.currContent)},t}(Laya.HTMLDivElement);e.ChatLabel=i}),define("src/g/chat/view/CommonChatView",["require","exports","../../net/messages/chat/ChatC2GS","src/g/chat/ctrl/ChatContentManager","src/g/chat/view/ExpItem","../../net/messages/chat/ChatGS2C","../../../core/E","../../../enum/EventName","../../../config/GameConfig","../../../utils/system/FloatEffect","../../../manager/RoleCenter","../../net/messages/friend/FriendData","src/g/friend/ctrl/FriendsDataManager","../../../plugin/view/ToolTip","src/g/custom/GMPage","../../../debug/Debug","src/g/chat/view/ChatCommonlyWord","src/g/chat/view/ChatArtWord","../../../utils/system/DateUitl","src/init/GameState","src/g/chat/ctrl/ChatSupervisor","../../../utils/system/ServerTime","../../../manager/RemoteStorage","src/init/TextConst","../../../utils/ItemUtils","src/g/chat/view/ChatLabel","src/g/itemGets/View/ItemGetDlg","../../../utils/sbkFuckWord"],function(t,e,h,i,c,u,r,l,p,d,g,s,o,v,f,y,a,m,_,C,I,b,w,S,E,T,A,R){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t,e){var i=n.call(this)||this;return i._autoScroll=!0,i._timesend=0,i._init=!1,i._initContent=!1,i.fullNum=200,i.releaseNum=100,i._pointY=2,i._channel=t,i._content=e,i.input_txt.maxChars=40,i.list_panel.vScrollBarSkin="",i.list_panel.vScrollBar.elasticDistance=200,i.list_panel.vScrollBar.on(Laya.Event.END,i,i.onScrollEndHandler),i.btn_express.on(Laya.Event.CLICK,i,i.openExp),i.commonlyButton.on(Laya.Event.CLICK,i,i.changeComWordVHander),i.btn_send.on(Laya.Event.CLICK,i,i.sendHandler),i.list_ani_exp.vScrollBarSkin="",i.list_ani_exp.vScrollBar.elasticDistance=200,i.chat_select.on(Laya.Event.CLICK,i,i.onSelectChatHandler),i.on(Laya.Event.CLICK,i,i.clickHandler),i.list_ani_exp.on(Laya.Event.CLICK,i,i.stopEventHander),i.commonlyWordList.on(Laya.Event.CLICK,i,i.stopEventHander),i.input_txt.text="",i}return __extends(t,n),t.prototype.onScrollEndHandler=function(){this._autoScroll=!0,this._pointY>this.list_panel.height&&this.list_panel.vScrollBar.value<this._pointY-this.list_panel.height&&(this._autoScroll=!1)},t.prototype.stopEventHander=function(t){t.stopPropagation()},t.prototype._onInput=function(){20<this.input_txt.text.length?this.lab_preview.changeText(this.input_txt.text.substring(this.input_txt.text.length-20)):this.lab_preview.changeText(this.input_txt.text)},t.prototype._onBlur=function(){this.lab_preview.changeText(""),this.lab_preview.visible=this.img_preview_bg.visible=!1},t.prototype._onFocus=function(){this.lab_preview.changeText(this.input_txt.text),this.lab_preview.visible=this.img_preview_bg.visible=!0},t.prototype.onSelectChatHandler=function(){if(this._ishorn)this._ishorn=!1,this.input_txt.left=10,this.icon_horn.visible=!1,this.txt_horncount.visible=!1,this.chat_selected.visible=!1;else{if(this._channel==h.enumChatType.family)return void d.FE.upItems(S.TextConst.get(319),v.BubbleEnum.center);this._ishorn=!0,this.icon_horn.visible=!0,this.txt_horncount.visible=!0,this.txt_horncount.text="×"+g.RoleCenter.instans.vo.bagdata.getItemCount(702),this.input_txt.left=75,this.chat_selected.visible=!0}this.input_txt.text=""},t.prototype.setExpress_panelVisible=function(t){this.list_ani_exp.visible=this.list_ani_exp_bg.visible=t,t&&this.setComWordVisiable(!1)},t.prototype.sendHandler=function(){var t=this.input_txt.text;if(t.length<1)d.FE.upItems(S.TextConst.get(314),v.BubbleEnum.center);else{var e=this._channel;if("##GM##"==t)return(new f.GMPage).popup(),Laya.Stat.show(),void y.Debug.initBtnTest();if("##woyaokaichongzhi##"==t)return window.enabledpay=!0,void(window.IOSResult=!0);if(this._ishorn){if(g.RoleCenter.instans.vo.bagdata.getItemCount(702)<1){d.FE.upItems(S.TextConst.get(320),v.BubbleEnum.center);var i=E.ItemUtils.getItemVoById(702);return void(new A.ItemGetDlg).initByVo(i).popup()}e=h.enumChatType.littleHorn}e==h.enumChatType.start&&(e=h.enumChatType.world);var n,s=5;this._ishorn?(n=p.GameConfig.commonJson.hornChat)&&(s=Number(n.value)):e==h.enumChatType.world?(n=p.GameConfig.commonJson.chat_word_time)&&(s=Number(n.value)):e==h.enumChatType.family?(n=p.GameConfig.commonJson.guildChat)&&(s=Number(n.value)):e==h.enumChatType.allWorld&&(n=p.GameConfig.commonJson.wordChat)&&(s=Number(n.value));var o=Math.ceil((Date.now()-this._timesend)/1e3);if(o<s)d.FE.upItems(S.TextConst.get(318,s-o),v.BubbleEnum.center);else if(40<t.length)d.FE.upItems(S.TextConst.get(321,40),v.BubbleEnum.center);else{this._autoScroll=!0,this._timesend=Date.now();var a=t.replace(/</g,"《").replace(/>/g,"》").replace(/@/g,"*").replace(/(^\s*)|(\s*$)/g,"");a=R.sbkFuckWord.replaceFuckWord(a),this.input_txt.text="",this.checkLimit()||e==h.enumChatType.littleHorn||this.checkPowerLimit()?0<C.GameState.ban_chat_send_to_sever?1==(1&C.GameState.ban_chat_send_to_sever)&&r.E.ins.event(l.EventName.SEND_CHAT,[a,e,!1]):(C.GameState.chat_supervision_open&&I.ChatSupervisor.ins.checkContent(e,a),r.E.ins.event(l.EventName.SEND_CHAT,[a,e,!0,!this.checkLimit()])):r.E.ins.event(l.EventName.SEND_CHAT,[a,e,!1])}}},t.prototype.checkLimit=function(){var t=p.GameConfig.commonJson.talkLimit;if(t){var e=0,i=0,n=t.value.split(",");0<n.length&&(i=Number(n[0])),1<n.length&&(e=Number(n[1]));var s=_.DateUtil.getKFDay();if(g.RoleCenter.instans.vo.VIP<e&&s<i)return!1}return!0},t.prototype.checkPowerLimit=function(){var t,e=p.GameConfig.commonJson.talkLimitChance.value.split(","),i=e.length,n=0,s=g.RoleCenter.instans.vo.combat,o=-1;for(0<i&&(o=0);n<i;)t=e[n].split(":"),s>=1e4*Number(t[0])&&(o=Math.max(o,Number(t[1]))),n++;if(-1<o){var a=this._channel;this._ishorn&&(a=h.enumChatType.littleHorn),a==h.enumChatType.start&&(a=h.enumChatType.world);var r=Number(a==h.enumChatType.family?w.RemoteStorage.getItem("lastFamilyChatTime"):w.RemoteStorage.getItem("lastWorldChatTime"));if(0==_.DateUtil.subDay(b.ServerTime.serverTime,r)&&(o-=Number(a==h.enumChatType.family?w.RemoteStorage.getItem("familyChatNum"):w.RemoteStorage.getItem("worldChatNum"))),o<1)return!1}return!0},t.prototype.openExp=function(){this.setExpress_panelVisible(!this.list_ani_exp.visible),this.list_ani_exp.visible&&this.init()},t.prototype.init=function(){this._init||(this._init=!0,this.initAnimation())},t.prototype.initAnimation=function(){this.list_ani_exp_bg.skin="res/unpack/liaotian_biaoqing_ban1.png";var t,e=p.GameConfig.expression,i=[];for(var n in e)1!=(t=e[n]).type&&2!=t.type||i.push(t);for(var s,o=i.length,a=0,r=0,l=0;l<o;l++)1==(t=i[l]).type?(s=new c.ExpItem,t.width=.6*t.width,t.height=.6*t.height,s.setData(t)):(s=new m.ChatArtWord).update(t),a+t.width>this.list_ani_exp.width&&(a=0,r++),s.x=a,s.pivotY=t.height>>1,a+=t.width+15>>0,s.y=50*r+18,l==o-1&&(this.animationContainer.height=s.y+(t.height>>1)),s.on(Laya.Event.CLICK,this,this.selectHandler,[t]),this.animationContainer.addChild(s)},t.prototype.selectHandler=function(t){35<this.input_txt.text.length||(this.setExpress_panelVisible(!1),this.input_txt.text+=t.id)},t.prototype.initContent=function(){this._initContent=!0;var t=this._content.getContentList(this._channel);for(var e in t)this.appendContent(t[e]);r.E.ins.on(l.EventName.CHAT_CONTENT_ADDED,this,this.appendContent),r.E.ins.on(l.EventName.CHAT_CONTENT_CLEAR,this,this.clearChatHandler),r.E.ins.on(l.EventName.DELETE_CHAT_CONTENT,this,this.onDelContent),r.E.ins.on(l.EventName.CHAT_CONTENT_BANED,this,this.onBanContent)},t.prototype.clearChatHandler=function(t){this._channel==t&&(this.list_panel.removeChildren(),this._pointY=2)},t.prototype.onBanContent=function(t){if(this._channel!=h.enumChatType.system){for(var e,i=this.list_panel.numChildren-1;-1<i;)(e=this.list_panel.getChildAt(i))&&e.usename==t&&this.list_panel.removeChildAt(i),i--;this.relayout()}},t.prototype.releaseChatContent=function(){if(this._autoScroll){var t=this.list_panel.numChildren;if(t>this.fullNum){for(var e=Math.min(t,this.releaseNum)-1;-1<e;){this.list_panel.removeChildAt(e).offAll(),e--}this.relayout()}}},t.prototype.relayout=function(){this._pointY=2;for(var t,e=this.list_panel.numChildren,i=0;i<e;)(t=this.list_panel.getChildAt(i))&&(t.y=this._pointY,this._pointY+=Math.max(26,t.contextHeight)),i++;this.setScroll()},t.prototype.onDelContent=function(t,e){if(t){var i=this._channel;if(e==i||i==h.enumChatType.start||i==h.enumChatType.world&&e==h.enumChatType.littleHorn)for(var n=this.list_panel,s=0,o=n.numChildren;s<o;)n.getChildAt(s).cutChatContent(t),s++}},t.prototype.appendContent=function(t,e){var i,n=t.msg,s=this._channel,o=this.list_panel;if(e){var a=u.ChatGS2C.getIns();a.msg=e,a.job=t.job,a.sex=t.sex,a.nickname=t.nickname,a.username=t.username;for(var r=0,l=o.numChildren;r<l;)(i=o.getChildAt(r)).content==n&&(a.type=t.type,i.setTextByMsg(a)),r++;return a.resetdata(),void a.clear()}(t.type==s||s==h.enumChatType.start||s==h.enumChatType.world&&t.type==h.enumChatType.littleHorn)&&(this.releaseChatContent(),(i=new T.ChatLabel).style.fontSize=18,i.style.leading=8,i.style.valign="center",i.x=5,i.width=this.list_panel.width-10,i.setTextByMsg(t,s==h.enumChatType.start,30),i.on(Laya.Event.LINK,this,this.onLinkHandler),i.on(Laya.Event.CLICK,this,this.showRoleHandler,[t]),this.list_panel.addChild(i),i.y=this._pointY,this._pointY+=Math.max(26,i.contextHeight),Laya.timer.callLater(this,this.setScroll),this.txt_horncount.visible&&this.txt_horncount.changeText("×"+g.RoleCenter.instans.vo.bagdata.getItemCount(702)))},t.prototype.onLinkHandler=function(t){i.ChatContentManager.onLinkHandler(t),this._evtIsHandled=!0},t.prototype.showRoleHandler=function(t){if(this._evtIsHandled)this._evtIsHandled=!1;else if(t.type!=h.enumChatType.system&&t.username!=g.RoleCenter.instans.vo.username&&""!=t.username){var e=o.FriendsDataManager.ins.getFriendDataByUsername(t.username);e||((e=new s.FriendData).username=t.username,e.nickname=t.nickname,e.sex=t.sex,e.jobid=t.job,e.onLine=!0,e.level=t.lvl,e.familyname=t.fname),r.E.ins.event(l.EventName.OPEN_FRIENDS_MENU_DIALOG,e)}},t.prototype.setScroll=function(){this._autoScroll&&(this.list_panel.vScrollBar.value=Math.max(0,this._pointY-this.list_panel.height))},t.prototype.showView=function(){this._initContent||Laya.timer.frameOnce(3,this,this.initContent),this._ishorn&&this.onSelectChatHandler(),this.setExpress_panelVisible(!1),this.setComWordVisiable(!1),this.visible=!0,this._autoScroll=!0},t.prototype.setOpen=function(t){this.setScroll()},t.prototype.clickHandler=function(t){t.target!=this.btn_express&&this.setExpress_panelVisible(!1),t.target!=this.commonlyButton&&this.setComWordVisiable(!1)},t.prototype.initList=function(t,e,i,n){t.itemRender=e,t.renderHandler=new Laya.Handler(this,i),t.mouseHandler=new Laya.Handler(this,n),t.vScrollBarSkin="",t.scrollBar.elasticDistance=200,t.selectEnable=!0,t.array=[]},t.prototype.renderCommonlyWord=function(t,e){t.update()},t.prototype.selectCommonlyWord=function(t,e){if(t.type==Laya.Event.CLICK){if(e<=-1)return;var i=this.commonlyWordList.array[e];if(40<(this.input_txt.text+i.res).toString().length)return;this.input_txt.text+=i.res,this.setComWordVisiable(!1)}},t.prototype.setComWordVisiable=function(t){this.commonlyWordGround.visible=this.commonlyWordList.visible=t,t&&(null!=this.commonlyWordList.array&&0!=this.commonlyWordList.array.length||this.initCommonlyWord(),this.setExpress_panelVisible(!1))},t.prototype.initCommonlyWord=function(){this.initList(this.commonlyWordList,a.ChatCommonlyWord,this.renderCommonlyWord,this.selectCommonlyWord);var t,e=p.GameConfig.expression,i=[];for(var n in e)3==(t=e[n]).type&&i.push(t);this.commonlyWordList.array=i,this.commonlyWordGround.skin="res/unpack/liaotian_biaoqing_ban1.png"},t.prototype.changeComWordVHander=function(){this.setComWordVisiable(!this.commonlyWordList.visible)},t}(ui.chat.NewWorldChatViewUI);e.CommonChatView=n}),define("src/g/chat/view/NewChatNoticeView",["require","exports","../../net/messages/chat/ChatC2GS","src/g/chat/ctrl/ChatContentManager","../../../core/E","../../../enum/EventName","../../net/messages/chat/ChatGS2C","src/g/chat/view/ChatLabel"],function(t,e,a,i,s,o,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t,e){var i=n.call(this)||this;return i._channel=a.enumChatType.system,i._initContent=!1,i._pointY=2,i._channel=t,i._content=e,i.list_panel.vScrollBarSkin="",i.list_panel.vScrollBar.elasticDistance=200,i}return __extends(t,n),t.prototype.showView=function(){this.visible=!0,this._initContent||Laya.timer.frameOnce(2,this,this.initContent)},t.prototype.setOpen=function(t){t||this.setScroll()},t.prototype.initContent=function(){this._initContent=!0;var t=this._content.getContentList(this._channel);for(var e in t)this.appendContent(t[e]);s.E.ins.on(o.EventName.CHAT_CONTENT_ADDED,this,this.appendContent),s.E.ins.on(o.EventName.CHAT_CONTENT_CLEAR,this,this.clearChatHandler),s.E.ins.on(o.EventName.DELETE_CHAT_CONTENT,this,this.onDelContent)},t.prototype.clearChatHandler=function(t){this._channel==t&&(this.list_panel.removeChildren(),this._pointY=2)},t.prototype.appendContent=function(t,e){var i=t.msg,n=this._channel,s=this.list_panel;if(e){var o=h.ChatGS2C.getIns();o.msg=e,o.job=t.job,o.sex=t.sex,o.nickname=t.nickname,o.username=t.username;for(var a=0,r=s.numChildren;a<r;)(l=s.getChildAt(a)).content==i&&(o.type=t.type,l.setTextByMsg(o)),a++;return o.resetdata(),void o.clear()}if(t.type==n){var l=new c.ChatLabel;l.style.wordWrap=!1,l.style.fontSize=18,l.style.leading=8,l.style.valign="middle",l.x=5,l.width=s.width-10,l.setTextByMsg(t),l.on(Laya.Event.LINK,this,this.onLinkHandler),s.addChild(l),l.y=this._pointY,this._pointY+=Math.max(26,l.contextHeight),Laya.timer.callLater(this,this.setScroll)}},t.prototype.onDelContent=function(t,e){if(t){var i=this._channel;if(e==i||i==a.enumChatType.start||i==a.enumChatType.world&&e==a.enumChatType.littleHorn)for(var n=this.list_panel,s=0,o=n.numChildren;s<o;)n.getChildAt(s).cutChatContent(t),s++}},t.prototype.onLinkHandler=function(t){i.ChatContentManager.onLinkHandler(t)},t.prototype.setScroll=function(){this.list_panel.vScrollBar.value=Math.max(0,this._pointY-this.list_panel.height)},t}(ui.chat.NewChatNoticeViewUI);e.NewChatNoticeView=n}),define("src/g/chat/view/NewChatView",["require","exports","../../net/messages/chat/ChatC2GS","../../../manager/LayerManager","src/g/chat/view/CommonChatView","src/g/chat/view/NewChatNoticeView","src/init/Switches","../../../core/E","../../../enum/EventName"],function(t,e,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(t){var e=i.call(this)||this;return e._lastSelectIndex=0,e._open=!0,e._content=t,e.tab.selectHandler=new Laya.Handler(e,e.rendHandler),e.btn_close.on(Laya.Event.CLICK,e,e.closeHandler),e.btn_open.on(Laya.Event.CLICK,e,e.doHideHandler),e}return __extends(t,i),t.prototype.goToFriend=function(){this.closeHandler(),r.Switches.ins.event(104)},t.prototype.onTabSelectHandler=function(t){1==t&&(this.closeHandler(),r.Switches.ins.event(104))},t.prototype.closeHandler=function(){this.removeSelf(),l.E.ins.off(h.EventName.WINDOW_PANEL_ADDED,this,this.onWindowAdd)},t.prototype.rendHandler=function(t){this.setHide(),0==t?(this._view0||(this._view0=new o.CommonChatView(n.enumChatType.start,this._content)),this._view0.showView(),this._view0.setOpen(this._open),this._view0.width=this.box_content.width,this.box_content.addChild(this._view0)):1==t?(this._view1||(this._view1=new o.CommonChatView(n.enumChatType.world,this._content)),this._view1.showView(),this._view1.setOpen(this._open),this._view1.width=this.box_content.width,this.box_content.addChild(this._view1)):2==t?(this._view2||(this._view2=new o.CommonChatView(n.enumChatType.family,this._content)),this._view2.showView(),this._view2.setOpen(this._open),this._view2.width=this.box_content.width,this.box_content.addChild(this._view2)):3==t?(this._view3||(this._view3=new a.NewChatNoticeView(n.enumChatType.system,this._content)),this._view3.showView(),this._view3.setOpen(this._open),this._view3.width=this.box_content.width,this.box_content.addChild(this._view3)):4==t&&(this._view4||(this._view4=new o.CommonChatView(n.enumChatType.allWorld,this._content)),this._view4.showView(),this._view4.setOpen(this._open),this._view4.width=this.box_content.width,this.box_content.addChild(this._view4)),this._lastSelectIndex=t},t.prototype.showView=function(){this.y=Laya.stage.height-this.height,this.box_content.width=this.width=Laya.stage.width,this.setOpen(!1),s.LayerManager.addChat(this),l.E.ins.on(h.EventName.WINDOW_PANEL_ADDED,this,this.onWindowAdd),this.tab.selectedIndex=this._lastSelectIndex},t.prototype.onWindowAdd=function(){this.closeHandler()},t.prototype.doHideHandler=function(){this.setOpen(!this._open)},t.prototype.setOpen=function(t){this._open!=t&&(this._open=t,this._open?(this.img_up.visible=!1,this.img_down.visible=!0,this.btn_close.bottom=748,this.btn_open.bottom=795,this.content_bg.height=795,this.box_content.height=793):(this.img_up.visible=!0,this.img_down.visible=!1,this.btn_close.bottom=306,this.btn_open.bottom=353,this.content_bg.height=353,this.box_content.height=351),this._view0&&this._view0.setOpen(this._open),this._view1&&this._view1.setOpen(this._open),this._view2&&this._view2.setOpen(this._open),this._view3&&this._view3.setOpen(this._open),this._view4&&this._view4.setOpen(this._open))},t.prototype.setHide=function(){this._view0&&(this._view0.visible=!1),this._view1&&(this._view1.visible=!1),this._view2&&(this._view2.visible=!1),this._view3&&(this._view3.visible=!1),this._view4&&(this._view4.visible=!1)},t}(ui.chat.NewChatViewUI);e.NewChatView=i}),define("src/g/chat/view/HornView",["require","exports","../../../manager/LayerManager","../../../meta/ChatTemplateVo","src/g/chat/ctrl/ChatContentManager","../../../utils/ItemUtils"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t._msgArr=[],t._runSeed=2,t.repeat=2,t._currCount=1,t.numOfUser={},t.peopleNum=0,t.x=72,t.y=298,t.box_con.scrollRect=new Laya.Rectangle(0,0,t.box_con.width,t.box_con.height),t}return __extends(t,e),t.prototype.addHornContentHandler=function(t){t&&(this._running?(this._msgArr.push(t),this.addStatistics(t)):(this._currCount=this.repeat,this.addStatistics(t),this.runTo(t)))},t.prototype.addStatistics=function(t){var e=parseInt(this.numOfUser[t.username]);isNaN(e)&&(e=0),0==e&&this.peopleNum++,e++,this.numOfUser[t.username]=e},t.prototype.delStatistics=function(t){var e=parseInt(this.numOfUser[t.username]);isNaN(e)&&(e=0),0==--e&&this.peopleNum--,this.numOfUser[t.username]=e},t.prototype.runTo=function(t){this._currMsg=t,this.moveCurrentInfo||(this.moveCurrentInfo=new Laya.HTMLDivElement,this.moveCurrentInfo.style.color="#c0b4a3",this.moveCurrentInfo.style.fontSize=20,this.moveCurrentInfo.style.wordWrap=!1,this.moveCurrentInfo.mouseEnabled=!1,this.moveCurrentInfo.cacheAsBitmap=!0);var e=o.ItemUtils.getVipIconByLevel(t.vip);this.moveCurrentInfo.innerHTML=""!=e?"<img src='"+o.ItemUtils.getVipIconByLevel(t.vip)+'\' ></img> <font  color="#1ba5e3">'+t.nickname+":</font>"+s.ChatContentManager.checkInfo(n.ChatTemplateVo.transform(t.msg,!1),20):'<font  color="#1ba5e3">'+t.nickname+":</font>"+s.ChatContentManager.checkInfo(n.ChatTemplateVo.transform(t.msg,!1),20),20<this.moveCurrentInfo.contextHeight?this.moveCurrentInfo.y=(this.box_con.height-this.moveCurrentInfo.contextHeight)/2-20:this.moveCurrentInfo.y=(this.box_con.height-this.moveCurrentInfo.contextHeight)/2,this.moveCurrentInfo.x=this.box_con.width,this._targetX=-this.moveCurrentInfo.contextWidth-50,this.box_con.addChild(this.moveCurrentInfo),this._running||(i.LayerManager.addInHighUILayer(this),this.visible=!0,this._running=!0),Laya.timer.loop(1,this,this.moveInfo)},t.prototype.moveInfo=function(){if(this.moveCurrentInfo.x-=this._runSeed,this.moveCurrentInfo.x<=this._targetX)if(this.moveCurrentInfo.removeSelf(),1<this.peopleNum?this._currCount=0:this._currCount--,this._currCount<=0)if(this.delStatistics(this._currMsg),0<this._msgArr.length){var t=this._msgArr.shift();1<this.peopleNum?(this._currCount=1,this._runSeed=4):(this._currCount=this.repeat,this._runSeed=2),this.runTo(t)}else Laya.timer.clear(this,this.moveInfo),this._running=!1,this.visible=!1,this.removeSelf(),this.numOfUser={},this.peopleNum=0;else this.runTo(this._currMsg)},t}(ui.chat.HornViewUI);e.HornView=a}),define("src/g/chat/ctrl/ChatViewCtrl",["require","exports","../../../core/E","../../../enum/EventName","../../net/messages/chat/ChatGS2C","../../../manager/GameSocketManager","../../../core/GNet","src/g/custom/GMPage","../../net/messages/chat/ChatC2GS","../../../manager/RoleCenter","../../../utils/system/FloatEffect","src/g/chat/ctrl/ChatContentManager","src/g/chat/view/NewChatView","src/g/chat/view/HornView","../../../plugin/view/ToolTip","src/init/Switches","../../../utils/system/DateUitl","../../../utils/system/ServerTime","../../../manager/RemoteStorage","../../../utils/StringUtils","src/init/TextConst","../../../utils/sbkFuckWord","../../../config/GameConfig"],function(t,e,a,r,l,h,c,u,p,d,i,n,s,g,v,f,y,m,_,C,I,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function o(){this.url="dynamic/configjson/chatcheck.json",this.furl="dynamic/configjson/fword.txt",this.sensitiveWord=new C.SensitiveWord,Laya.loader.load(this.url,new Laya.Handler(this,this.chatcheckHandler),null,Laya.Loader.JSON),Laya.loader.load(this.furl,new Laya.Handler(this,this.chatFWord),null,Laya.Loader.TEXT)}return o.prototype.chatcheckHandler=function(){var t=Laya.loader.getRes(this.url);t&&C.StringUtils.setFilterWord(t.filterWord)},o.prototype.chatFWord=function(t){b.sbkFuckWord.PreprocessFuckWord(t||"")},o.prototype.init=function(){this._contentManager=new n.ChatContentManager,f.Switches.ins.on(24,this,this.onOpenHandler),h.GSM.ins.on(l.ChatGS2C.KEY,this,this.updateHandler),a.E.ins.on(r.EventName.SEND_CHAT,this,this.sendChatHandler),a.E.ins.on(r.EventName.SEND_UNREAL_CHAT,this,this.sendUnrealChat),h.GSM.ins.on(l.ChatGS2CArray.KEY,this,this.addChatArrHandler)},o.prototype.addChatArrHandler=function(t){var e=w.GameConfig.commonJson.hornprescription;this.hornPrescription=e?e.value:24;for(var i=t.chatArr.length,n=0;n<i;)this.updateHandler(t.chatArr[n],t.timeArr[n]),n++},o.prototype.onOpenHandler=function(t){t&&this.openView()},o.prototype.updateHandler=function(t,e){if(t.msg=t.msg.replace(/</g,"《").replace(/>/g,"》").replace(/(^\s*)|(\s*$)/g,""),t.nickname=t.nickname.replace(/</g,"《").replace(/>/g,"》").replace(/(^\s*)|(\s*$)/g,""),!this.GM_chkStr(t.msg)){if(t.type==p.enumChatType.gmChat&&console.log("GM系统返回信息:"+t.msg),d.RoleCenter.instans.vo&&t.username==d.RoleCenter.instans.vo.username);else if(C.StringUtils.detectSensitiveWords(t.msg))return;if(t.type==p.enumChatType.littleHorn){d.RoleCenter.instans.vo&&t.username==d.RoleCenter.instans.vo.username&&d.RoleCenter.instans.vo.chgItemCount(702,-1);var i=e||0,n=m.ServerTime.serverTime;0<i?n-i<3600*this.hornPrescription&&(this._hornView||(this._hornView=new g.HornView),this._hornView.addHornContentHandler(t)):(this._hornView||(this._hornView=new g.HornView),this._hornView.addHornContentHandler(t))}t.type==p.enumChatType.mapChat?a.E.ins.event(r.EventName.CHAT_BUBBLE,t):this._contentManager.addContent(t)}},o.prototype.sendUnrealChat=function(t,e){this._contentManager.addContent(t,e)},o.prototype.sendChatHandler=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1),this.GM_chkStr(t)||(0==e&&(e=p.enumChatType.world),i?this.sendEnable(t,e)&&(c.GNet.chatSend(e,t),n&&(e==p.enumChatType.family?(0!=y.DateUtil.subDay(m.ServerTime.serverTime,Number(_.RemoteStorage.getItem("lastFamilyChatTime")))?_.RemoteStorage.setItem("familyChatNum",1):_.RemoteStorage.setItem("familyChatNum",Number(_.RemoteStorage.getItem("familyChatNum"))+1),_.RemoteStorage.setItem("lastFamilyChatTime",m.ServerTime.serverTime)):e!=p.enumChatType.littleHorn&&(0!=y.DateUtil.subDay(m.ServerTime.serverTime,Number(_.RemoteStorage.getItem("lastWorldChatTime")))?_.RemoteStorage.setItem("worldChatNum",1):_.RemoteStorage.setItem("worldChatNum",Number(_.RemoteStorage.getItem("worldChatNum"))+1),_.RemoteStorage.setItem("lastWorldChatTime",m.ServerTime.serverTime)))):this.simulatingSrvChat(t,e))},o.prototype.simulatingSrvChat=function(t,e){var i=new l.ChatGS2C;i.type=e,i.msg=t,i.username=d.RoleCenter.instans.vo.username,i.nickname=d.RoleCenter.instans.vo.nickname,i.vip=d.RoleCenter.instans.self.vipLv,i.job=d.RoleCenter.instans.vo.jobId,i.sex=d.RoleCenter.instans.vo.getSex(),this._contentManager.addContent(i)},o.prototype.sendEnable=function(t,e){if(void 0===e&&(e=p.enumChatType.start),e==p.enumChatType.world){if(d.RoleCenter.instans.vo.getCurLv()<1080&&d.RoleCenter.instans.vo.VIP<1)return i.FE.upItems(I.TextConst.get(310),v.BubbleEnum.center),!1;if(40<t.length)return i.FE.upItems(I.TextConst.get(311),v.BubbleEnum.center),!1}else if(e==p.enumChatType.family){if(d.RoleCenter.instans.vo.portstatus.portindex<120)return i.FE.upItems(I.TextConst.get(312),v.BubbleEnum.center),!1;if(!d.RoleCenter.instans.ufVo||!d.RoleCenter.instans.ufVo._ufdata||!d.RoleCenter.instans.ufVo.inFamily)return i.FE.upItems(I.TextConst.get(313),v.BubbleEnum.center),!1;if(200<t.length)return i.FE.upItems(I.TextConst.get(311),v.BubbleEnum.center),!1}return!(t.length<1)||(i.FE.upItems(I.TextConst.get(314),v.BubbleEnum.center),!1)},o.prototype.GM_chkStr=function(t){var e=t;if(0==e.indexOf("username")||0==e.indexOf("Username")){var i=d.RoleCenter.instans.vo.username,n=new l.ChatGS2C;return n.type=p.enumChatType.system,n.msg=i,a.E.ins.event(r.EventName.SEND_UNREAL_CHAT,[n]),!0}if(0<=e.indexOf("closesocket"))return h.GSM.doClose(),!0;if(-1==e.indexOf(o.gmstr))return!1;var s=(e=e.split(o.gmstr)[1]).split("@");("open"==s[0]&&s[1]&&s[1].length&&c.GNet.chatSend(p.enumChatType.world,t),"openGMPage"==s[0])&&(new u.GMPage).popup();return!0},o.prototype.openView=function(){this._view||(this._view=new s.NewChatView(this._contentManager)),this._view.showView()},o.prototype.completeHandler=function(){},o.gmstr="gmstr:",o}();e.ChatViewCtrl=o}),define("src/g/welfare/view/GWelfareView",["require","exports","../../../core/E","../../../manager/LayerManager","src/g/clearRes/ClearResM","../../../enum/EventName"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.bg_view.mouseThrough=!0,t.btn_list.hScrollBar.elasticDistance=200,t.btn_list.hScrollBar.on(Laya.Event.END,t,t.onScrollEndHandler),t.turn_left.on(Laya.Event.CLICK,t,t.turnLeftHandler),t.turn_right.on(Laya.Event.CLICK,t,t.turnRightHandler),t}return __extends(t,e),t.prototype.onScrollEndHandler=function(){this.turn_right.visible=this.turn_left.visible=!1,0<this.btn_list.hScrollBar.max&&(10<this.btn_list.hScrollBar.value&&(this.turn_left.visible=!0),this.btn_list.hScrollBar.value<this.btn_list.hScrollBar.max-10&&(this.turn_right.visible=!0),this.checkTurnBtnRed())},t.prototype.turnLeftHandler=function(){this.btn_list.hScrollBar.value=Math.max(this.btn_list.hScrollBar.value-this.btn_list.width,this.btn_list.hScrollBar.min),this.onScrollEndHandler()},t.prototype.turnRightHandler=function(){this.btn_list.hScrollBar.value=Math.min(this.btn_list.hScrollBar.value+this.btn_list.width,this.btn_list.hScrollBar.max),this.onScrollEndHandler()},t.prototype.showView=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),Laya.timer.frameOnce(2,this,this.checkBtnRedAndTurnTo),n.LayerManager.addInPOPWindowLayer(this,t,!0,!0,!1,e),i.E.ins.on(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),this.img_bg.restskin()},t.prototype.closeClearRes=function(){i.E.ins.off(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),Laya.loader.clearTextureRes(this.img_bg.skin),s.ClearResM.clearResFolder("fuli/"),s.ClearResM.clearResFolder("monthCard/"),s.ClearResM.clearResFolder("superMonthCard/")},t.prototype.hideView=function(){this.removeSelf(),this.closeClearRes()},t.prototype.checkTurnBtnRed=function(){if(0<this.btn_list.hScrollBar.max){for(var t,e=this.btn_con.numChildren,i=0,n=!1,s=!1;i<e;)(t=this.btn_con.getChildAt(i))&&t.img_red.displayedInStage&&1==t.img_red.visible&&(t.x+t.width-5<this.btn_list.hScrollBar.value&&(n=!0),t.x-5>this.btn_list.hScrollBar.value+this.btn_list.width&&(s=!0)),i++;this.img_left_red.visible=n,this.img_right_red.visible=s}},t.prototype.checkBtnRedAndTurnTo=function(){if(0<this.btn_list.hScrollBar.max)for(var t,e=this.btn_con.numChildren,i=0;i<e;){if((t=this.btn_con.getChildAt(i))&&1==t.img_red.visible){this.scrollToBtn(t);break}i++}},t.prototype.scrollToBtn=function(t){if(t){var e=this.btn_list;e&&(e.hScrollBar.value=Math.min(t.x,e.hScrollBar.max),this.onScrollEndHandler())}},t}(ui.welfare.WelfareViewUI);e.GWelfareView=a}),define("src/g/welfare/view/page/SignView",["require","exports","../../../../utils/ItemUtils","../../../../manager/RoleCenter","../../../net/messages/sbkUserDailySignData","src/g/Effects/UIEffectsFactory","../../../../config/GameConfig","../../../../manager/AM","../../../../enum/EventName","../../../../core/E","src/g/bag/tips/view/ItemTips","../../../net/messages/DailySignC2GS","../../../net/messages/OpResultType","../../../../manager/GameSocketManager","src/init/Switches","../../../../meta/CurrencyVo","../../../../meta/ItemVo","../../../../utils/effects/ListEffect","../../../../meta/QualiyVo","src/init/TextConst"],function(t,e,r,l,h,c,s,o,a,u,p,i,d,g,v,f,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){return n.call(this)||this}return __extends(t,n),t.prototype.init=function(){this.Item_list.renderHandler=new Laya.Handler(this,this.onListRender),this.Item_list.scrollBar.elasticDistance=200;var t=[];for(var e in s.GameConfig.signJSON)t.push(s.GameConfig.signJSON[e]);this.Item_list.dataSource=t,this.Item_list.mouseHandler=new Laya.Handler(this,this.onListeMouseHandler),u.E.ins.on(a.EventName.SIGN_STATE_CHANGED,this,this.onSignStateChanged),m.ListEffect.flyIn(this.Item_list,25,5,1,500,100)},t.prototype.onSignStateChanged=function(){this.Item_list&&this.Item_list.refresh()},t.prototype.onListeMouseHandler=function(t,e){var i=this;if(t.type==laya.events.Event.CLICK){var n=this.Item_list.selectedItem;l.RoleCenter.instans.self.dailySignData.dailyData.dailySignArr[e]==h.enumDailySignType.type_1?0<n.doubleViplevel&&l.RoleCenter.instans.vo.VIP<n.doubleViplevel?o.AM.showAdvanced(C.TextConst.get(777,n.doubleViplevel),Laya.Handler.create(this,function(){i.requestSignGet(e)}),Laya.Handler.create(this,function(){v.Switches.ins.event(101)}),null,C.TextConst.get(778),C.TextConst.get(779)):this.requestSignGet(e):n&&p.ItemTips.ins.showTip(n.bonus[0][0],Number(n.bonus[0][1]))}},t.prototype.onListRender=function(t,e){var i=t.dataSource,n=r.ItemUtils.getItemOrEq(i.bonus[0][0]),s=i.bonus[0][1],o=i.doubleViplevel||0;(t.img_ok.visible=l.RoleCenter.instans.self.dailySignData.dailyData&&l.RoleCenter.instans.self.dailySignData.dailyData.dailySignArr[i.id-1]==h.enumDailySignType.type_2,t.img_qian.visible=l.RoleCenter.instans.self.dailySignData.dailyData&&l.RoleCenter.instans.self.dailySignData.dailyData.dailySignArr[i.id-1]==h.enumDailySignType.type_1,t.Img_db_bg.visible=0<o,t.lab_day.text=C.TextConst.get(59,e+1),t.lab_vip.visible=0<o&&(t.lab_vip.text=C.TextConst.get(780,i.doubleViplevel),!0),t.effect_con.removeChildren(),t.img_qian.visible)?c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.effect_con,47,1.7,1.7).zOrder=0:n instanceof y.ItemVo?0<n.streamer&&c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.effect_con,n.streamer):n instanceof f.CurrencyVo?0<n.streamer&&c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.effect_con,n.streamer):5!=n.quality&&6!=n.quality||c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.effect_con,_.QualityStruct.Ins.getQEffById(n.quality));t.img_ok.visible?t.img_bg.skin="res/fuli/fuli_qiandao_dizhengchang.png":t.img_qian.visible?t.img_bg.skin="res/fuli/fuli_qiandao_difaguang.png":t.img_bg.skin="res/fuli/fuli_qiandao_diweiqiandao.png",t.item.img_quality.skin=r.ItemUtils.getQualitybjByQualityId(n.quality),t.item.img_item.skin=r.ItemUtils.getIconByIconId(n.icon);var a=t.item.lab_num;a.visible=1<s&&(a.text=s+"",!0)},t.prototype.requestSignGet=function(t){var e=new i.DailySignC2GS;e.msgidx=d.enumOpResultType.dailySign_get,e.dsIdx=t,g.GSM.sendServer(e)},t.prototype.destroy=function(){for(var t in this.Item_list.dataSource=null,this.Item_list.renderHandler=null,this.Item_list.mouseHandler=null,u.E.ins.off(a.EventName.SIGN_STATE_CHANGED,this,this.onSignStateChanged),n.prototype.destroy.call(this),c.UIEffectsFactory.Ins.clearAniRes(47),s.GameConfig.signJSON){var e=s.GameConfig.signJSON[t];if(e){var i="GOLD"==e.bonus[0][0]?116:Number(e.bonus[0][0]);Laya.loader.clearRes(r.ItemUtils.getIconById(i),!1)}}},t}(ui.welfare.pages.SignViewUI);e.SignView=n}),define("src/g/welfare/ctrl/SignViewCtrl",["require","exports","src/g/welfare/view/page/SignView","../../../config/GameConfig","../../../utils/ItemUtils","../../net/messages/DailySignC2GS","../../net/messages/OpResultType","../../../manager/GameSocketManager","../../../manager/RoleCenter","../../net/messages/sbkUserDailySignData","../../../enum/EventName","../../../core/E","../../../utils/system/FloatEffect","../../../meta/CurrencyVo","src/init/GameEventDispatcher","../../../manager/RedDotM"],function(t,e,i,l,h,n,s,o,c,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){}return t.prototype.init=function(){o.GSM.ins.on(u.sbkDailySignData.KEY,this,this.onInitDataBack),c.RoleCenter.instans.on(s.enumOpResultType.dailySign_get.toString(),this,this.onSignGetBack),this.requestInitData(),d.E.ins.on(p.EventName.INIT_SELFSETOVER,this,this.requestInitData)},t.prototype.showPage=function(t){this._view||(this._view=new i.SignView,this._view.init()),t.addChild(this._view)},t.prototype.hidePage=function(){},t.prototype.requestInitData=function(){var t=new n.DailySignC2GS;t.msgidx=s.enumOpResultType.dailySign_list,o.GSM.sendServer(t)},t.prototype.onInitDataBack=function(t){var e=c.RoleCenter.instans.self.dailySignData;e.dailyData.copydata(t),u.sbkUserDailySignData.chkIsHave(e),y.RedDotM.check(142),d.E.ins.event(p.EventName.SIGN_STATE_CHANGED)},t.prototype.onSignGetBack=function(t){for(var e in t.reservedata){var i=t.reservedata[e],n=l.GameConfig.signJSON[i+1],s=h.ItemUtils.getItemOrEq(n.bonus[0][0]),o=n.bonus[0][1];if(0<n.doubleViplevel&&c.RoleCenter.instans.vo.VIP>=n.doubleViplevel&&(o*=2),s instanceof v.CurrencyVo)c.RoleCenter.instans.vo[s.define]+=o,g.FE.getFloat(s.name+"x"+o,h.ItemUtils.getColorByQuality(s.quality)),c.RoleCenter.instans.event(p.EventName.ROLE_PROP_CHANGE);else{c.RoleCenter.instans.vo.chgItemCount(s.id,o);var a=h.ItemUtils.getItemVoById(s.id);if(a)for(var r=0;r<o;r++)g.FE.getFloat(a.name+"x1",h.ItemUtils.getColorByQuality(a.quality))}c.RoleCenter.instans.self.dailySignData.dailyData.dailySignArr[i]=u.enumDailySignType.type_2}u.sbkUserDailySignData.chkIsHave(c.RoleCenter.instans.self.dailySignData),y.RedDotM.check(142),d.E.ins.event(p.EventName.SIGN_STATE_CHANGED),f.GE.ins.event(11)},t.prototype.getTitle=function(){return"res/fuli/huodong_biaoti_wenzi17.png"},t}();e.SignViewCtrl=a}),define("src/g/welfare/view/page/ExchangeCodeView",["require","exports","../../../net/messages/ActivationCode","../../../../manager/GameSocketManager"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.btn_get.on(Laya.Event.CLICK,this,this.getRewardHandler)},e.prototype.getRewardHandler=function(){var t=this.input_code.text,e=new i.ActivationCodeC2GS;e.code=t,n.GSM.sendServer(e)},e}(ui.welfare.pages.ExchangeCodeViewUI);e.ExchangeCodeView=s}),define("src/g/welfare/ctrl/ExchangeCodeViewCtrl",["require","exports","src/g/clearRes/ClearResM","src/g/welfare/view/page/ExchangeCodeView","../../net/messages/ActivationCode","../../../manager/GameSocketManager","../../../utils/system/FloatEffect","../../../utils/system/ErrCodeView","../../../plugin/view/ToolTip","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(){}return t.prototype.init=function(){o.GSM.ins.on(s.ActivationCodeGS2C.KEY,this,this.onActivationCodeHandler),this._view||(this._view=new n.ExchangeCodeView,this._view.init())},t.prototype.showPage=function(t){i.ClearResM.resetViewImg(this._view),t.addChild(this._view)},t.prototype.onActivationCodeHandler=function(t){t.opresult?a.FE.upItems(h.TextConst.get(844),l.BubbleEnum.center):r.ErrCodeView.show(t.error)},t.prototype.getTitle=function(){return"res/fuli/huodong_biaoti_wenzi21.png"},t}();e.ExchangeCodeViewCtrl=c}),define("src/g/welfare/view/page/WelfareNoticeView",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.con_panel.vScrollBar.elasticDistance=100,this.htxt.style.font="SimHei",this.htxt.style.fontSize=20,this.htxt.style.color="#caaa88",this.htxt.style.leading=7,this.htxt.mouseEnabled=!0,this.htxt.innerHTML=ktgameconfig.LoginVo.gameNoitce||""},e}(ui.welfare.pages.NoticeViewUI);e.WelfareNoticeView=i}),define("src/g/welfare/ctrl/WelfareNoticeViewCtrl",["require","exports","src/g/welfare/view/page/WelfareNoticeView"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.init=function(){this._view||(this._view=new i.WelfareNoticeView,this._view.init())},t.prototype.showPage=function(t){t.addChild(this._view)},t.prototype.getTitle=function(){return"res/fuli/huodong_biaoti_wenzi22.png"},t}();e.WelfareNoticeViewCtrl=n}),define("src/g/welfare/view/page/FAQView",["require","exports","../../../../config/GameConfig"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.con_panel.vScrollBar.elasticDistance=100,this.htxt.style.font="SimHei",this.htxt.style.fontSize=20,this.htxt.style.color="#7c5a25",this.htxt.style.leading=7,this.htxt.innerHTML=i.GameConfig.Ruledesc[11].tmptext},e}(ui.welfare.pages.FAQViewUI);e.FAQView=n}),define("src/g/welfare/ctrl/FAQViewCtrl",["require","exports","src/g/welfare/view/page/FAQView"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.init=function(){this._view||(this._view=new i.FAQView,this._view.init())},t.prototype.showPage=function(t){t.addChild(this._view)},t}();e.FAQViewCtrl=n}),define("src/g/welfare/view/item/OnLineRewardItemView",["require","exports","../../../../utils/ItemUtils","../../../../manager/RoleCenter","src/g/Effects/UIEffectsFactory","../../../../core/GNet","../../../../core/E","../../../../enum/EventName","src/g/peronboss/view/ItemIconView","src/init/TextConst"],function(t,e,r,l,i,n,s,o,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.canGet=!1,t.olTime=0,t.cfgId=0,t.init(),t.onLoadUIEF(),t.addEvent(),t.refresh(),t}return __extends(t,e),t.prototype.init=function(){},t.prototype.addEvent=function(){this.icon_state.visible=!1,this.btn_get.on(Laya.Event.CLICK,this,this.getReward)},t.prototype.getReward=function(){this.canGet&&n.GNet.getOltima(this.cfgId)},t.prototype.onLoadUIEF=function(){this.ani_put=i.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_get,40,.62,.8)},t.prototype.setData=function(t){this.cfgId=t.id;var e=t.bonus,i=e.length;this.item0.visible=!1,this.item1.visible=!1,this.item2.visible=!1,this.txt_oltime.text=c.TextConst.get(775,t.timers),this.olTime=t.timers;for(var n=0;n<i;n++){this["item"+n].visible=!0;var s=e[n][0],o=e[n][1],a=r.ItemUtils.getItemOrEq(s);h.ItemIconView.setItemData(a,this["item"+n],o)}-1!=l.RoleCenter.instans.vo.onLineData.rewardIdArr.indexOf(t.id)?(this.ani_put.visible=!1,this.btn_get.visible=!1,this.icon_state.visible=!0):this.refresh()},t.prototype.refresh=function(){l.RoleCenter.instans.vo.OLTIME>=this.olTime?this.canGet=!0:this.canGet=!1,this.showAni(),s.E.ins.event(o.EventName.ONLINERED)},t.prototype.showAni=function(){this.ani_put.visible=this.canGet,this.btn_get.visible=!0,this.btn_get.disabled=!this.canGet,this.btn_get.label=this.canGet?c.TextConst.get(216):c.TextConst.get(210),this.icon_state.visible=!1},t}(ui.welfare.item.OnLineRewarditemUI);e.OnLineRewardItemView=a}),define("src/g/welfare/view/page/OnLineRewardView",["require","exports","../../../../config/GameConfig","src/g/welfare/view/item/OnLineRewardItemView","../../../../manager/RoleCenter","../../../../core/E","../../../../enum/EventName"],function(t,e,s,o,i,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){this.list.scrollBar.elasticDistance=100,this.list.itemRender=o.OnLineRewardItemView,this.list.renderHandler=new Laya.Handler(this,this.renderHandler);var t=s.GameConfig.OnLineReward,e=[];for(var i in t){var n=t[i];e.push(n)}this.list.array=e,a.E.ins.on(r.EventName.UPDATA_OLTAMA,this,this.updataOLtime)},e.prototype.renderHandler=function(t,e){t.setData(this.list.array[e])},e.prototype.updataOLtime=function(){this.txt_oltime.text=i.RoleCenter.instans.vo.OLTIME+"",this.listRefresh()},e.prototype.listRefresh=function(){this.list.refresh()},e}(ui.welfare.pages.OnLineRewardViewUI);e.OnLineRewardView=n}),define("src/g/welfare/ctrl/OnlineRewardCtrl",["require","exports","src/g/welfare/view/page/OnLineRewardView","../../../manager/GameSocketManager","../../net/messages/OltimaMsg","../../../manager/RoleCenter","../../../utils/system/ErrCodeView","../../../core/E","../../../enum/EventName","../../../utils/ItemUtils","../../../utils/system/FloatEffect","../../../manager/NewRedHintsCenter"],function(t,e,i,n,s,r,l,o,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function a(){}return a.prototype.init=function(){n.GSM.ins.on(s.OltimaGS2C.KEY,this,this.updateoltimeHandler),o.E.ins.on(h.EventName.UPDATA_OLTAMA,this,this.updata_oltama)},a.prototype.showPage=function(t){this._view||(this._view=new i.OnLineRewardView,this._view.init()),this._view.txt_oltime.text=r.RoleCenter.instans.vo.OLTIME+"",t.addChild(this._view),this.updata_oltama(),this._view.listRefresh()},a.prototype.updateoltimeHandler=function(t){a.isHave=!1,r.RoleCenter.instans.vo.OLTIME=t.onlineTime,r.RoleCenter.instans.vo.onLineData.rewardIdArr=t.rewardIdArr,this.updata_oltama(),this._view.listRefresh(),t.opresult?r.RoleCenter.instans.addInventoryToC(t.inv):l.ErrCodeView.show(t.error);for(var e=t.inv.itemList,i=0;i<e.length;i+=2){var n=e[i],s=e[i+1],o=c.ItemUtils.getItemOrEq(n);u.FE.getUpFloat(o.name+"x"+s,n)}},a.prototype.updata_oltama=function(){p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.welfare_online_reward,!1)},a.isHave=!1,a}();e.OnlineRewardCtrl=a}),define("src/g/month_card/view/MonthCardView",["require","exports","../../../manager/GameSocketManager","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../../core/GNet","../../../utils/system/ServerTime","../../net/messages/sbkVipData","../../net/messages/VipC2GS","src/g/Effects/UIEffectsFactory","src/g/clearRes/ClearResM","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return u.ClearResM.addBgUrl(t.bgimg.skin),t.btn_buy.on(Laya.Event.CLICK,t,t.onBuyHandler),n.E.ins.on(s.EventName.MONTH_CARD_END_TIME_CHANGED,t,t.updateRemainingTime),n.E.ins.on(s.EventName.MONTH_CARD_END_STATE_CHANGE,t,t.refreshData),t._ani=c.UIEffectsFactory.Ins.createUIAniById(40,!0),c.UIEffectsFactory.Ins.centered4Parent(t._ani,t.btn_buy,!0),t.htxt_num.style.fontSize=20,t.htxt_num.style.font="SimHei",t.htxt_num.style.color="#a89e8f",t.htxt_num.style.align="center",t}return __extends(t,e),t.prototype.onBuyHandler=function(){0<o.RoleCenter.instans.vo.monthCardEndTime-r.ServerTime.serverTime?this.getReward():a.GNet.toRecharge(8888)},t.prototype.getReward=function(){if(0==(o.RoleCenter.instans.self.supperMonthCardDailyBonus&l.enumMCDBType.mouthCardDailyBonus)){var t=new h.GetSupperMonthCardDailyBonusMsg;t.type=l.enumMCDBType.mouthCardDailyBonus,i.GSM.sendServer(t)}},t.prototype.refreshData=function(){this.updateRemainingTime(),this.bgimg.restskin()},t.prototype.updateRemainingTime=function(){var t=o.RoleCenter.instans.vo.monthCardEndTime-r.ServerTime.serverTime;if(0<t){this.lab_time.text=p.TextConst.get(374,Math.ceil(t/3600/24).toString());var e=0==(o.RoleCenter.instans.self.supperMonthCardDailyBonus&l.enumMCDBType.mouthCardDailyBonus);this.btn_buy.visible=!!e&&(this.btn_buy.label=p.TextConst.get(204),!0)}else this.btn_buy.label="25元抢购",this.btn_buy.visible=!0},t.prototype.destroy=function(){this.btn_buy.offAll(),n.E.ins.off(s.EventName.MONTH_CARD_END_TIME_CHANGED,this,this.updateRemainingTime),n.E.ins.off(s.EventName.MONTH_CARD_END_STATE_CHANGE,this,this.refreshData),e.prototype.destroy.call(this),this.btn_buy.destroy()},t}(ui.monthCard.MonthCardViewUI);e.MonthCardView=d}),define("src/g/month_card/ctrl/MonthCardViewCtrl",["require","exports","src/g/month_card/view/MonthCardView","../../../core/E","../../../enum/EventName","../../../utils/system/ServerTime","../../../manager/NewRedHintsCenter","../../../manager/RoleCenter","src/g/accessctrl/AccessCenter","src/g/proxy/AccessListenProxy","../../../manager/GameSocketManager","../../net/messages/VipC2GS","../../net/messages/sbkVipData","../../../config/GameConfig","src/g/account/ctrl/GetRewwardCtrl","../../../core/GNet","src/init/TextConst"],function(t,e,i,a,r,n,s,l,o,h,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(){function t(){this.url="res/atlas/res/monthCard.json"}return t.prototype.showPage=function(t){this._view||(this._view=new i.MonthCardView),t.addChild(this._view),this._view.refreshData(),this.updatePlayerNum(),v.GNet.requestRegistPlayerNum(),a.E.ins.on(r.EventName.REGIST_PLAYER_NUM_CHANGED,this,this.updatePlayerNum)},t.prototype.updatePlayerNum=function(){this._view.htxt_num.innerHTML=f.TextConst.get(632,Math.floor(l.RoleCenter.instans.vo.registPlayerNum/12+20+l.RoleCenter.instans.vo.month_num))},t.prototype.init=function(){c.GSM.ins.on(u.GetSupperMonthCardDailyBonusMsg.KEY,this,this.receiveTheAwardBack),a.E.ins.on(r.EventName.SERVER_TIME_UPDATE,this,this.onServerTimeChanged),a.E.ins.on(r.EventName.MONTH_CARD_END_TIME_CHANGED,this,this.updateCommonRed),a.E.ins.on(r.EventName.SUPER_MONTH_CARD_END_TIME_CHANGE,this,this.updateSuperRed),a.E.ins.once(r.EventName.INIT_SELFSETOVER,this,this.onRoleInited),(new h.AccessListenProxy).checkAndListen(12,new Laya.Handler(this,this.updateCommonRed)),(new h.AccessListenProxy).checkAndListen(122,new Laya.Handler(this,this.updateSuperRed))},t.prototype.onCloseHandler=function(){a.E.ins.off(r.EventName.REGIST_PLAYER_NUM_CHANGED,this,this.updatePlayerNum),this._view.removeSelf(),this._view.destroy(),this._view=null,Laya.loader.clearRes(this.url),Laya.loader.clearRes("res/monthCard/yueka_all.jpg")},t.prototype.onRoleInited=function(){this.updateRedHints()},t.prototype.onServerTimeChanged=function(){this.updateRedHints()},t.prototype.receiveTheAwardBack=function(t){if(t.type==p.enumMCDBType.clear)l.RoleCenter.instans.self.supperMonthCardDailyBonus=0,a.E.ins.event(r.EventName.MONTH_CARD_END_STATE_CHANGE),a.E.ins.event(r.EventName.SUPER_MONTH_CARD_END_STATE_CHANGE);else{var e,i=d.GameConfig.playerJSON[1];t.type==p.enumMCDBType.mouthCardDailyBonus?e=i.monthcard__dailybonus:t.type==p.enumMCDBType.superMouthCardDailyBonus&&(e=i.super_monthcard_reward);for(var n=e.length,s=0;s<n;){var o=e[s];"JUNGONG"==o[0]?l.RoleCenter.instans.vo.JUNGONG+=Number(o[1]):"GOLD"==o[0]?l.RoleCenter.instans.vo.GOLD+=Number(o[1]):"QUANMINGCOUNT"==o[0]&&(l.RoleCenter.instans.vo.QUANMINGCOUNT+=Number(o[1])),s++}g.GetRewwardCtrl.showReward2(e),l.RoleCenter.instans.self.supperMonthCardDailyBonus|=t.type,t.type==p.enumMCDBType.mouthCardDailyBonus?a.E.ins.event(r.EventName.MONTH_CARD_END_STATE_CHANGE):t.type==p.enumMCDBType.superMouthCardDailyBonus&&a.E.ins.event(r.EventName.SUPER_MONTH_CARD_END_STATE_CHANGE)}this.updateRedHints()},t.prototype.updateRedHints=function(){this.updateCommonRed(),this.updateSuperRed()},t.prototype.updateCommonRed=function(){o.AccessCenter.ins.checkOpen(12)&&l.RoleCenter.instans.vo&&l.RoleCenter.instans.vo.monthCardEndTime>n.ServerTime.serverTime&&0==(l.RoleCenter.instans.self.supperMonthCardDailyBonus&p.enumMCDBType.mouthCardDailyBonus)?s.NewRedHintsCenter.ins.setRedHintOpenOrClose(s.enumRedHints.month_card,!0):s.NewRedHintsCenter.ins.setRedHintOpenOrClose(s.enumRedHints.month_card,!1)},t.prototype.updateSuperRed=function(){o.AccessCenter.ins.checkOpen(122)&&l.RoleCenter.instans.vo&&l.RoleCenter.instans.vo.superMonthCardEndTime>n.ServerTime.serverTime&&0==(l.RoleCenter.instans.self.supperMonthCardDailyBonus&p.enumMCDBType.superMouthCardDailyBonus)?s.NewRedHintsCenter.ins.setRedHintOpenOrClose(s.enumRedHints.super_month_card,!0):s.NewRedHintsCenter.ins.setRedHintOpenOrClose(s.enumRedHints.super_month_card,!1)},t.prototype.getTitle=function(){return"res/fuli/huodong_biaoti_wenzi19.png"},t}();e.MonthCardViewCtrl=y}),define("src/g/superMonthCard/view/superMonthCardView",["require","exports","../../../manager/GameSocketManager","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../../core/GNet","../../../utils/system/ServerTime","../../net/messages/VipC2GS","../../net/messages/sbkVipData","src/g/Effects/UIEffectsFactory","src/g/clearRes/ClearResM","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.btn_buy.on(Laya.Event.CLICK,t,t.onBuyHandler),n.E.ins.on(s.EventName.SUPER_MONTH_CARD_END_TIME_CHANGE,t,t.updateRemainingTime),n.E.ins.on(s.EventName.SUPER_MONTH_CARD_END_STATE_CHANGE,t,t.refreshData),t._ani=c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.btn_buy,40),t.p_con.vScrollBar.elasticDistance=100,t.htxt_num.style.fontSize=20,t.htxt_num.style.font="SimHei",t.htxt_num.style.color="#e3cca9",t.htxt_num.style.align="center",t}return __extends(t,e),t.prototype.onBuyHandler=function(){0<o.RoleCenter.instans.vo.superMonthCardEndTime-r.ServerTime.serverTime?this.getReward():a.GNet.toRecharge(9999)},t.prototype.refreshData=function(){this.updateRemainingTime(),this.bgimg.restskin(),u.ClearResM.addBgUrl(this.bgimg.skin)},t.prototype.updateRemainingTime=function(){var t=o.RoleCenter.instans.vo.superMonthCardEndTime-r.ServerTime.serverTime;if(0<t){this.clip_time.value=Math.ceil(t/3600/24).toString();var e=0==(o.RoleCenter.instans.self.supperMonthCardDailyBonus&h.enumMCDBType.superMouthCardDailyBonus);this.btn_buy.label=e?p.TextConst.get(204):p.TextConst.get(211),this.btn_buy.disabled=!e,this._ani.visible=e}else this.clip_time.value="0",this.btn_buy.visible=!0,this.btn_buy.label=p.TextConst.get(633,88)},t.prototype.destroy=function(){this.btn_buy.offAll(),n.E.ins.off(s.EventName.SUPER_MONTH_CARD_END_TIME_CHANGE,this,this.updateRemainingTime),n.E.ins.off(s.EventName.SUPER_MONTH_CARD_END_STATE_CHANGE,this,this.refreshData),e.prototype.destroy.call(this),u.ClearResM.clearResFolder("superMonthCard/")},t.prototype.getReward=function(){if(0==(o.RoleCenter.instans.self.supperMonthCardDailyBonus&h.enumMCDBType.superMouthCardDailyBonus)){var t=new l.GetSupperMonthCardDailyBonusMsg;t.type=h.enumMCDBType.superMouthCardDailyBonus,i.GSM.sendServer(t)}},t}(ui.superMonthCard.superMonthCardViewUI);e.superMonthCardView=d}),define("src/g/superMonthCard/ctrl/superMonthCardViewCtrl",["require","exports","src/g/superMonthCard/view/superMonthCardView","../../../manager/RoleCenter","../../../enum/EventName","../../../core/E","../../../core/GNet","src/init/TextConst"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){}return t.prototype.init=function(){},t.prototype.showPage=function(t){this._view||(this._view=new i.superMonthCardView),t.addChild(this._view),this._view.refreshData(),this.updatePlayerNum(),a.GNet.requestRegistPlayerNum(),o.E.ins.on(s.EventName.REGIST_PLAYER_NUM_CHANGED,this,this.updatePlayerNum)},t.prototype.updatePlayerNum=function(){this._view.htxt_num.innerHTML=r.TextConst.get(768,Math.floor(n.RoleCenter.instans.vo.registPlayerNum/20+10+n.RoleCenter.instans.vo.super_month_num))},t.prototype.onCloseHandler=function(){o.E.ins.off(s.EventName.REGIST_PLAYER_NUM_CHANGED,this,this.updatePlayerNum),this._view.removeSelf(),this._view.destroy(),this._view=null,Laya.loader.clearRes("res/monthCard/yueka_all.jpg")},t.prototype.getTitle=function(){return"res/fuli/huodong_biaoti_wenzi20.png"},t}();e.superMonthCardViewCtrl=l}),define("src/init/CtrlBase",["require","exports","src/init/ResManager"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this.sourceUrls=new Array}return t.prototype.init=function(){},t.prototype.showPage=function(t,e){i.ResManager.getInstance().showPageCtrl(this)},t.prototype.loadUrls=function(){},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){},t.prototype.getTitle=function(){return null},t.prototype.hidePage=function(){i.ResManager.getInstance().hidePanelCtrl(this)},t.prototype.destroyPage=function(){i.ResManager.getInstance().destroyPanelCtrl(this)},t}();e.CtrlBase=n}),define("src/g/loginreward/ctrl/LoginRewardPageCtrl",["require","exports","src/init/CtrlBase","src/g/loginreward/view/NewLoginRewardView","../../../manager/RoleCenter","../../../enum/EventName","../../../core/E"],function(t,e,i,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){return null!==n&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.showPage=function(t,e){n.prototype.showPage.call(this,t,e),this._view||(this._view=new s.NewLoginRewardView);var i=o.RoleCenter.instans.vo.getLoginRewardData();i&&(this._view.showPage(i.id,t),r.E.ins.on(a.EventName.CLOSEALLWINDOWS,this,this.hidePage))},t.prototype.refreshData=function(){this._view&&this._view.refresh()},t.prototype.getTitle=function(){return"res/fuli/huodong_biaoti_wenzi18.png"},t.prototype.hidePage=function(){n.prototype.hidePage.call(this),this._view&&this._view.hidePage(),r.E.ins.off(a.EventName.CLOSEALLWINDOWS,this,this.hidePage)},t.prototype.destroyPage=function(){n.prototype.destroyPage.call(this),this._view&&this._view.doDestroy()},t}(i.CtrlBase);e.LoginRewardPageCtrl=n}),define("src/g/redpacket/view/RedPacketRecord",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.lbContent.style.fontSize=18,t.lbContent.style.font="SimHei",t}return __extends(t,e),t}(ui.activity.RedPacketRecordUI);e.RedPacketRecord=i}),define("src/g/redpacket/view/RedPacket",["require","exports","../../../utils/system/DateUitl","src/g/redpacket/view/RedPacketRecord","../../../manager/RoleCenter","src/g/Effects/UIEffectsFactory","src/init/TextConst"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.setTextStyle(t.lbZhenduoNum,14,"#dcd7c4","#663300"),t.setTextStyle(t.lbCountDown,14,"#dcd7c4","#663300"),t.initList(t.recordList,new Laya.Handler(t,t.itemRenderHander)),t}return __extends(t,e),t.prototype.initList=function(t,e){t.itemRender=n.RedPacketRecord,t.selectEnable=!0,t.vScrollBarSkin="",t.scrollBar.elasticDistance=100,t.renderHandler=e,t.array=[]},t.prototype.itemRenderHander=function(t,e){if(t.dataSource){var i=t.dataSource,n=i.userName,s=i.gold;t.lbContent.innerHTML=a.TextConst.get(874,n,s)}},t.prototype.appendRecord=function(t){var e=this.recordList.array;null==e&&(e=[]),e.unshift(t),100<e.length&&(e=e.slice(0,50)),this.recordList.array=e},t.prototype.setTextStyle=function(t,e,i,n){t.style.fontSize=e,t.style.color=i,t.style.font="SimHei",t.style.strokeColor=n,t.style.stroke=1},t.prototype.changeStatus=function(t){this.openedPacket.visible=this.receiveButton.visible=this.moneyBox.visible=t,window.enabledpay||(this.receiveButton.visible=!1),this.snatchButton.visible=!t,t?0<s.RoleCenter.instans.vo.vipData.dayCount?(this.imgSign.skin="res/redpacket/hongbao_wenzi1.png",this.showAnimation()):(this.imgSign.skin="res/redpacket/hongbao_wenzi2.png",this.clearAnimation()):this.clearAnimation()},t.prototype.showAnimation=function(){var t=this.animation;t||(this.animation=t=o.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.receiveButton,42,2,1.2),t.mouseEnabled=!1),null==t.parent&&this.receiveButton.addChild(t),t.play()},t.prototype.clearAnimation=function(){var t=this.animation;t&&(t.stop(),t.removeSelf())},t.prototype.showSnatchCD=function(t){this.lbCountDown.visible=t},t.prototype.setTotalMoney=function(t){this.updMoneyDisplay(t)},t.prototype.setSnatchedMoney=function(t,e){this.lbFreeMoney.text=e.toString(),this.lbSnatchedMoney.text=t.toString(),this.hlayout([this.lbFreeMoney,this.lbFreeMoneyUnit],0,this.moneyBox),this.hlayout([this.lbSnatchedMoney,this.lbSnatchedMoneyUnit],0,this.moneyBox)},t.prototype.updMoneyDisplay=function(t){var e=t.toString();this.imgMoney.text=e,this.hlayout([this.imgYuanBao,this.imgMoney],0,this.imgYuanBao.parent)},t.prototype.hlayout=function(t,e,i){for(var n=0,s=t.length,o=0;o<s;o++)n+=t[o].width,o!=s-1&&(n+=e);var a=i.width-n>>1;for(o=0;o<s;o++)0==o?t[0].x=a:t[o].x=t[o-1].x+t[o-1].width+e},t.prototype.updCountDownDisplay=function(t){this.lbCountDown.innerHTML=a.TextConst.get(873,i.DateUtil.getMinStr(t))},t.prototype.updLeftSnatchNum=function(t){this.lbZhenduoNum.innerHTML=0<t?a.TextConst.get(872,"#09d51f",t):a.TextConst.get(872,"#ff0f15",t)},t.prototype.onClosed=function(){this.recordList.array=[],this.clearAnimation(),this.removeSelf()},t}(ui.activity.RedPacketUI);e.RedPacket=r}),define("src/g/redpacket/ctrl/RedPacketCtrl",["require","exports","../../../core/E","../../../enum/EventName","src/g/redpacket/view/RedPacket","../../../manager/RoleCenter","src/g/index/ctrl/GameIndexCtrl","../../../utils/SoundUtils","../../../config/GameConfig","../../../utils/system/ServerTime","../../../manager/GameSocketManager","../../net/messages/redbag/RedPacketMsg","src/g/accessctrl/AccessCenter","../../../meta/CommonVo","../../net/messages/OpResultGS2C","../../../manager/AM","../../net/messages/enumStatus","../../net/messages/redbag/RedPacketMsg","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","../../../utils/CountDown","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg","src/init/CtrlBase","src/init/Switches","src/g/clearRes/ClearResM","../../../manager/NewRedHintsCenter","src/init/TextConst","src/g/activity/view/pages/CompeteUtil"],function(t,e,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w,i,S,E,T,A,R){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var L=function(i){function t(){var t=i.call(this)||this;t.maxSnatchNum=0,t.snatchedNum=0,t.snatchedMoney=0,t.nextSnatchTime=0,t.rechargeNum=0,t.receivedMoney=!1,t.freeReceivedMoney=0,t.crtPacketEndTime=0,n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,t,t.snatchSucHander),n.E.ins.on(s.EventName.ACTIVITY_DATA_INITED,t,t.onActivityDataInit),n.E.ins.on(s.EventName.ACTIVITY_DATA_ADDED,t,t.onActivityAddHandler);var e=u.GSM.ins;return e.on(p.StartRedPacketGS2C.KEY,t,t.startSnatchRedPacket),e.on(p.DismantleRedPacketGS2C.KEY,t,t.receivedPacketReward),e.on(p.RedPacketInfoGS2C.KEY,t,t.otherPlayerSnatchSuc),e.on(v.OpResultGS2C.KEY,t,t.noRechargeHander),n.E.ins.on(s.EventName.PLAY_TYPE_CHANGED,t,t.changePlaytype),n.E.ins.on(s.EventName.USER_DATA_ATTR_CHANGED+"vipData",t,t.rechargeStatusChanged),t.canSnatchCD=new I.CountDown,d.AccessCenter.ins.inited||n.E.ins.on(s.EventName.ACCESS_CENTER_INITED,t,t.onAccessInit),t}return __extends(t,i),t.prototype.onActivityAddHandler=function(t,e,i){i==R.svrActivityTrigger.RedPacket&&this.onActivityDataInit()},t.prototype.changePlaytype=function(){null!=this.enterButton&&(0==this.canDisplay()?this.updEntryButtonStatus(!1):this.updEntryButtonStatus(!0))},t.prototype.canDisplay=function(){return b.PlayManager.type==w.EPlayType.PLAYTYPE_PORT||b.PlayManager.type!=w.EPlayType.PLAYTYPE_NEWVILLAGE&&(b.PlayManager.type==w.EPlayType.PLAYTYPE_MAINCITY&&!a.RoleCenter.instans.vo.newbee)},t.prototype.onActivityDataInit=function(){var t=this.getRedPacketData();this.initActivityData(t)},t.prototype.showPage=function(t,e){i.prototype.showPage.call(this,t,e),null==this.view&&(this.view=new o.RedPacket,this.view.snatchButton.on(Laya.Event.CLICK,this,this.snatchHander),this.view.receiveButton.on(Laya.Event.CLICK,this,this.receiveRedPacket),E.ClearResM.addBgUrl(this.view.imgGround.skin),E.ClearResM.addBgUrl(this.view.openedPacket.skin)),this.view.imgGround.restskin(),this.view.openedPacket.restskin(),this.view.x=-26,t.addChild(this.view),this.initRedPacketRecord(),this.updViewStatus(),u.GSM.sendServer(new p.GetRedPacketNextTimeC2GS)},t.prototype.initRedPacketRecord=function(){if(this.getRedPacketData()){for(var t=0;t<4;t++)this.appedRecord();if(c.ServerTime.serverTime<this.crtPacketEndTime){var e=Number(g.CommonVo.getVoByKey("redPacket_robotHongBao").value);Laya.timer.loop(1e3*e,this,this.appendRecordByTimer)}}},t.prototype.appedRecord=function(){var t,e,i=(.5<Math.random()?h.GameConfig.commonJson.redPacket_ff:h.GameConfig.commonJson.redPacket_fff).value.split(",");t=this.randomBetween(Number(i[0]),Number(i[1])),e=h.GameConfig.getRandomName(1);var n={};n.userName=e,n.gold=t,this.view.appendRecord(n)},t.prototype.appendRecordByTimer=function(){this.appedRecord(),c.ServerTime.serverTime>=this.crtPacketEndTime&&Laya.timer.clear(this,this.appendRecordByTimer)},t.prototype.updViewStatus=function(){var t=0<this.snatchedMoney&&0==this.receivedMoney;this.view.changeStatus(t),t?this.view.setSnatchedMoney(this.snatchedMoney,this.freeReceivedMoney):this.view.setTotalMoney(this.caculateTotalMoney()),null==this.getRedPacketData()?(this.view.updLeftSnatchNum(5),this.view.showSnatchCD(!1)):(this.view.updLeftSnatchNum(this.maxSnatchNum-this.snatchedNum),c.ServerTime.serverTime<this.nextSnatchTime?this.timeIsOut()||this.canSnatchCD.start(this.nextSnatchTime,this.updSnatchCD,this):console.error("充值红包可抢时间错误:serverT:"+c.ServerTime.serverTime+"nextT:"+this.nextSnatchTime),this.timeIsOut()?this.view.showSnatchCD(!1):this.view.showSnatchCD(!0))},t.prototype.updSnatchCD=function(t){this.view.updCountDownDisplay(t)},t.prototype.snatchHander=function(){if(l.SoundUtils.getInstance().playBtnsounds(),null!=this.getRedPacketData()){var t=new m.GetRedPacketC2GS;u.GSM.sendServer(t)}else _.FE.upItems(A.TextConst.get(209),C.BubbleEnum.center)},t.prototype.receiveRedPacket=function(){l.SoundUtils.getInstance().playBtnsounds();var t=new m.DismantleRedPacketC2GS;u.GSM.sendServer(t)},t.prototype.hidePage=function(){i.prototype.hidePage.call(this),this.canSnatchCD.stop(),Laya.timer.clear(this,this.appendRecordByTimer),this.view&&this.view.onClosed(),Laya.loader.clearRes("res/redpacket/hongbao_biaoti.png"),this.updEntryButtonStatus(!1,!0)},t.prototype.getTitle=function(){return"res/redpacket/hongbao_biaoti.png"},t.prototype.caculateTotalMoney=function(){var t=Number(g.CommonVo.getVoByKey("redPacket_jcz").value);return t+t*(Number(g.CommonVo.getVoByKey("redPacket_bfb").value)/1e4*this.rechargeNum)>>0},t.prototype.timeIsOut=function(){return this.snatchedNum==this.maxSnatchNum},t.prototype.randomBetween=function(t,e){return Math.ceil(Math.random()*(e-t))+t},t.prototype.startSnatchRedPacket=function(t){r.GameIndexCtrl.idxView?(console.warn("发红包了。。。。。。。。。。"),this.rechargeNum=t.dayCount,this.crtPacketEndTime=t.endTime,this.nextSnatchTime=t.nextTime,t.isNew?(this.receivedMoney=!1,this.snatchedMoney=0):this.updLingQuStatus(),this.view&&this.view.parent&&this.updViewStatus(),0!=d.AccessCenter.ins.inited&&d.AccessCenter.ins.checkOpen(165)&&null!=a.RoleCenter.instans.vo.getActivityData()&&(this.updRedStatus(),this.timeIsOut()?this.updEntryButtonStatus(!1,!0):t.isNew&&(this.canDisplay()?this.updEntryButtonStatus(!0):null==this.enterButton&&(this.enterButton=new ui.activity.RedPacketButtonUI)))):n.E.ins.once(s.EventName.INDEX_VIEW_INIT_COMPLET,this,this.startSnatchRedPacket,[t])},t.prototype.updLingQuStatus=function(){var t=this.getRedPacketData();if(t)if(0==this.crtPacketEndTime)this.receivedMoney=!0;else if(t.children&&0<t.children.length){var e=t.children[0],i=e.childCountArr.indexOf(this.crtPacketEndTime);-1!=i&&(this.receivedMoney=e.childCountArr[i+2]==y.enumStatus.yilingqu)}},t.prototype.snatchSucHander=function(t,e){var i=h.GameConfig.activityJson[t];if(i&&i.trigger==R.svrActivityTrigger.RedPacket){var n=this.getRedPacketData();if(n){if(n.children&&0<n.children.length){var s=n.children[0];this.maxSnatchNum=h.GameConfig.subActivityJson[s.cfgId].value2,this.snatchedNum=s.count,this.snatchedMoney=n.allData.allCount,this.freeReceivedMoney=n.allData.time}this.updRedStatus()}n&&0!=n.allData.allCount&&(_.FE.upItems(A.TextConst.get(875,this.freeReceivedMoney),C.BubbleEnum.center),this.updViewStatus())}},t.prototype.receivedPacketReward=function(t){a.RoleCenter.instans.vo.GOLD+=t.gold,this.receivedMoney=!0,this.updViewStatus(),_.FE.upItems(A.TextConst.get(876,t.gold),C.BubbleEnum.center),this.updRedStatus()},t.prototype.otherPlayerSnatchSuc=function(t){if(d.AccessCenter.ins.checkOpen(165)&&this.view){var e={};e.userName=t.nickname,e.gold=t.gold,this.view.appendRecord(e)}},t.prototype.noRechargeHander=function(t){0==t.opresult&&"6294"==t.error&&f.AM.showGoldNotEnough(A.TextConst.get(700))},t.prototype.getRedPacketData=function(){for(var t,e,i=a.RoleCenter.instans.vo.getActivityData(),n=i.listArr.length,s=0;s<n;s++)if(t=i.listArr[s],(e=h.GameConfig.activityJson[t.cfgId])&&e.trigger==R.svrActivityTrigger.RedPacket)return t;return null},t.prototype.initActivityData=function(t){if(t)if(t.children&&0<t.children.length){var e=t.children[0],i=h.GameConfig.subActivityJson[e.cfgId];i&&(this.maxSnatchNum=i.value2,this.snatchedNum=e.count,this.snatchedMoney=t.allData.allCount,this.freeReceivedMoney=t.allData.time)}else this.maxSnatchNum=0,this.snatchedNum=0,this.snatchedMoney=0,this.receivedMoney=!1},t.prototype.updEntryButtonStatus=function(t,e){void 0===e&&(e=!1),window.enabledpay||(t=!1),t?(null==this.enterButton&&(this.enterButton=new ui.activity.RedPacketButtonUI),this.enterButton.on(Laya.Event.CLICK,this,this.openRedPacket),r.GameIndexCtrl.idxView.bag_con.addChild(this.enterButton)):this.enterButton&&(this.enterButton.removeSelf(),this.enterButton.off(Laya.Event.CLICK,this,this.openRedPacket),e&&(this.enterButton=null))},t.prototype.openRedPacket=function(){l.SoundUtils.getInstance().playBtnsounds(),S.Switches.ins.event(165)},t.prototype.updRedStatus=function(){d.AccessCenter.ins.checkOpen(165)&&null!=this.getRedPacketData()&&(this.receivedMoney?T.NewRedHintsCenter.ins.setRedHintOpenOrClose(T.enumRedHints.rechargeRedPacket,!1):0<this.snatchedMoney?0<a.RoleCenter.instans.vo.vipData.dayCount?T.NewRedHintsCenter.ins.setRedHintOpenOrClose(T.enumRedHints.rechargeRedPacket,!0):T.NewRedHintsCenter.ins.setRedHintOpenOrClose(T.enumRedHints.rechargeRedPacket,!1):this.timeIsOut()?T.NewRedHintsCenter.ins.setRedHintOpenOrClose(T.enumRedHints.rechargeRedPacket,!1):T.NewRedHintsCenter.ins.setRedHintOpenOrClose(T.enumRedHints.rechargeRedPacket,!0))},t.prototype.rechargeStatusChanged=function(t){"dayCount"==t&&this.view&&this.view.parent&&(this.updViewStatus(),this.updRedStatus())},t.prototype.onAccessInit=function(){n.E.ins.off(s.EventName.ACCESS_CENTER_INITED,this,this.onAccessInit),d.AccessCenter.ins.checkOpen(165,!1)?this.updRedStatus():d.AccessCenter.ins.on(165,this,this.redPacketHander)},t.prototype.redPacketHander=function(){d.AccessCenter.ins.off(165,this,this.redPacketHander),this.updRedStatus()},t}(i.CtrlBase);e.RedPacketCtrl=L}),define("src/g/welfare/view/WelfareBtn",["require","exports","../../../manager/RoleCenter","../../../config/GameConfig","src/g/Effects/UIEffectsFactory","../../../core/E","../../../enum/EventName"],function(t,e,n,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(s){function t(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=s.call(this)||this;return n.priority=0,n.img_select.visible=!1,n.img_red.visible=!1,n._accessId=t,n._enumRedHints=e,n._activityId=i,n.init(),n}return __extends(t,s),Object.defineProperty(t.prototype,"accessId",{get:function(){return this._accessId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activityId",{get:function(){return this._activityId},enumerable:!0,configurable:!0}),t.prototype.init=function(){if(0<this._activityId){var t=n.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=o.GameConfig.activityJson[t.cfgId];e&&(e.showEffect&&a.UIEffectsFactory.Ins.createSAniAndCenter(this.effect_con,41),this.img.skin="dynamic/activity/"+e.button+".png",this.priority=e.priority),this.img_red.visible=t.hasRed,this.effect_con.visible=t.hasRed,r.E.ins.on(l.EventName.ACTIVITY_RED_UPDATE,this,this.onActivityRedUpdata)}}else if(0<this._enumRedHints){var i=new prop.RedHintsScript;i.enumRedHints=this._enumRedHints,i.owner=this.img_red}},t.prototype.onActivityRedUpdata=function(t){if(t==this._activityId){var e=n.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&(this.img_red.visible=e.hasRed,this.effect_con.visible=e.hasRed)}},t.prototype.destroy=function(){this.effect_con.removeChildren(),this.offAll(),r.E.ins.off(l.EventName.ACTIVITY_HALL_RED_UPDATE,this,this.onActivityRedUpdata),s.prototype.destroy.call(this)},Object.defineProperty(t.prototype,"selected",{get:function(){return this.img_select.visible},set:function(t){this.img_select.visible=t},enumerable:!0,configurable:!0}),t}(ui.welfare.WelfareBtnUI);e.WelfareBtn=i}),define("src/g/welfare/ctrl/WelfareSubModule",["require","exports","src/g/proxy/AccessListenProxy"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,i){this._accessId=t,this._addBtnHandler=e,this._removeBtnHandler=i}return t.prototype.onRegist=function(){(new i.AccessListenProxy).checkAndListen(this._accessId,new Laya.Handler(this,this.updateModule))},t.prototype.updateModule=function(){},t}();e.WelfareSubModule=n}),define("src/g/welfare/ctrl/CommonWelfareSubModule",["require","exports","src/g/welfare/ctrl/WelfareSubModule","src/g/accessctrl/AccessCenter","src/g/welfare/view/WelfareBtn","../../../config/GameConfig"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(r){function t(t,e,i,n,s,o){void 0===n&&(n=0),void 0===s&&(s=""),void 0===o&&(o=0);var a=r.call(this,t,e,i)||this;return a._enumRedHints=n,a._btnSkin=s,a._priority=o,a}return __extends(t,r),t.prototype.updateModule=function(){this.checkShow()?this._addBtnHandler&&(this._btn||(this._btn=new s.WelfareBtn(this._accessId,this._enumRedHints),this._btn.priority=this._priority,this._btnSkin&&(this._btn.img.skin=this._btnSkin)),this._addBtnHandler.runWith(this._btn)):this._btn&&(this._removeBtnHandler&&this._removeBtnHandler.runWith(this._btn),this._btn.destroy(),this._btn=null)},t.prototype.checkShow=function(){var t=o.GameConfig.accessCtrlCfg[this._accessId];return t&&t.forceopen||n.AccessCenter.ins.checkOpen(this._accessId)},t}(i.WelfareSubModule);e.CommonWelfareSubModule=a}),define("src/g/welfare/ctrl/ActivityHallWelfareSubModule",["require","exports","src/g/welfare/ctrl/WelfareSubModule","src/g/accessctrl/AccessCenter","../../../core/E","../../../enum/EventName","../../../manager/ActivityManager","src/g/welfare/view/WelfareBtn"],function(t,e,i,n,s,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(o){function t(t,e,i,n){var s=o.call(this,t,e,i)||this;return s.btnList=new Laya.Dictionary,s._pos=n,s}return __extends(t,o),t.prototype.updateModule=function(){n.AccessCenter.ins.checkOpen(this._accessId)?(s.E.ins.on(a.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.changeHallHandler),this.initBtns()):s.E.ins.off(a.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.changeHallHandler)},t.prototype.changeHallHandler=function(t){t==this._pos&&this.initBtns()},t.prototype.initBtns=function(){var t=r.ActivityManager.ins.getActivityHallByPos(this._pos);if(t){for(var e=t.getActivatedIds(),i=this.idList?this.idList.length:0,n=0;n<i;)(!e||e.length<1||-1==e.indexOf(this.idList[n]))&&this.deleteActivity(this.idList[n]),n++;for(this.idList=e,i=this.idList?this.idList.length:0,n=0;n<i;)this.pushActivity(this.idList[n]),n++}},t.prototype.deleteActivity=function(t){var e=this.btnList.get(t);e&&(this._removeBtnHandler&&this._removeBtnHandler.runWith(e),e.destroy()),this.btnList.remove(t)},t.prototype.pushActivity=function(t){var e=this.btnList.get(t);e||(e=new l.WelfareBtn(this._accessId,0,t),this.btnList.set(t,e),this._addBtnHandler&&this._addBtnHandler.runWith(e))},t}(i.WelfareSubModule);e.ActivityHallWelfareSubModule=o}),define("src/g/welfare/ctrl/RedPacketSubModule",["require","exports","src/g/welfare/ctrl/CommonWelfareSubModule","../../../core/E","../../../enum/EventName","src/g/activity/view/pages/CompeteUtil","../../../config/GameConfig","../../../manager/RoleCenter"],function(t,e,i,l,h,a,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(r){function t(t,e,i,n,s,o){void 0===n&&(n=0),void 0===s&&(s=""),void 0===o&&(o=0);var a=r.call(this,t,e,i,n,s,o)||this;return l.E.ins.on(h.EventName.ACTIVITY_DATA_ADDED,a,a.onActivityAdded),l.E.ins.on(h.EventName.ACTIVITY_DELETED,a,a.onActivityDeleted),a}return __extends(t,r),t.prototype.onActivityAdded=function(t,e,i){i==a.svrActivityTrigger.RedPacket&&this.updateModule()},t.prototype.onActivityDeleted=function(t,e){var i=c.GameConfig.activityJson[t];i&&i.trigger==a.svrActivityTrigger.RedPacket&&this.updateModule()},t.prototype.checkShow=function(){var t=r.prototype.checkShow.call(this);if(t){for(var e,i=u.RoleCenter.instans.vo.getActivityData(),n=i.listArr.length,s=void 0,o=0;o<n;o++)if(s=i.listArr[o],(e=c.GameConfig.activityJson[s.cfgId])&&e.trigger==a.svrActivityTrigger.RedPacket)return!0;return!1}return t},t}(i.CommonWelfareSubModule);e.RedPacketSubModule=n}),define("src/g/welfare/ctrl/WelfareBtnsManager",["require","exports","../../../manager/ActivityManager","src/g/welfare/ctrl/CommonWelfareSubModule","../../../manager/NewRedHintsCenter","src/g/welfare/ctrl/ActivityHallWelfareSubModule","../../../enum/ActivityPos","../../../component/NumberEventDispatcher","src/g/welfare/ctrl/RedPacketSubModule"],function(t,e,o,i,n,a,r,s,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function s(){var t=null!==e&&e.apply(this,arguments)||this;return t._btnList=[],t._isChanged=!1,t}return __extends(s,e),s.prototype.init=function(){window.enabledpay&&(new i.CommonWelfareSubModule(142,new Laya.Handler(this,this.addBtnHandler),new Laya.Handler(this,this.removeBtnHandler),n.enumRedHints.welfare_sign,"res/fuli/fuli_qiandao.png",110).onRegist(),new i.CommonWelfareSubModule(12,new Laya.Handler(this,this.addBtnHandler),new Laya.Handler(this,this.removeBtnHandler),n.enumRedHints.month_card,"res/fuli/fuli_yueka.png",99).onRegist(),new i.CommonWelfareSubModule(122,new Laya.Handler(this,this.addBtnHandler),new Laya.Handler(this,this.removeBtnHandler),n.enumRedHints.super_month_card,"res/fuli/fuli_zhizunyueka.png",98).onRegist(),new l.RedPacketSubModule(165,new Laya.Handler(this,this.addBtnHandler),new Laya.Handler(this,this.removeBtnHandler),n.enumRedHints.rechargeRedPacket,"res/fuli/recharge_packet.png",97).onRegist()),new i.CommonWelfareSubModule(144,new Laya.Handler(this,this.addBtnHandler),new Laya.Handler(this,this.removeBtnHandler),0,"res/fuli/fuli_gonggao.png",95).onRegist(),new i.CommonWelfareSubModule(143,new Laya.Handler(this,this.addBtnHandler),new Laya.Handler(this,this.removeBtnHandler),0,"res/fuli/fuli_duihuanma.png",94).onRegist(),new a.ActivityHallWelfareSubModule(233,new Laya.Handler(this,this.addBtnHandler),new Laya.Handler(this,this.removeBtnHandler),r.ActivityPos.ACTIVITY_HALL_28).onRegist()},s.prototype.addBtnHandler=function(t){this._btnList.push(t),this._isChanged=!0,Laya.timer.callLater(this,this.onBtnListChanged)},s.prototype.removeBtnHandler=function(t){for(var e,i=this._btnList.length,n=0;n<i;){if((e=this._btnList[n]).accessId==t.accessId&&e.activityId==t.activityId){this._btnList.splice(n,1);break}n++}this.event(s.WELFARE_BTNS_DELETED,[e]),this._isChanged=!0,Laya.timer.callLater(this,this.onBtnListChanged)},Object.defineProperty(s.prototype,"btnList",{get:function(){return this._btnList},enumerable:!0,configurable:!0}),s.prototype.compareFunc=function(t,e){return e.priority-t.priority},s.prototype.onBtnListChanged=function(){this._isChanged&&(this._isChanged=!1,this._btnList=this._btnList.sort(this.compareFunc),this.event(s.WELFARE_BTNS_LIST_CHANGED))},s.prototype.initBtns=function(){var t=o.ActivityManager.ins.getActivityHallByPos(this._currPos);if(t){for(var e=t.getActivatedIds(),i=this.idList?this.idList.length:0,n=0;n<i;)!e||e.length<1||e.indexOf(this.idList[n]),n++;for(this.idList=e,i=this.idList?this.idList.length:0,n=0;n<i;)n++}},s.WELFARE_BTNS_LIST_CHANGED=1,s.WELFARE_BTNS_DELETED=2,s}(s.NumberEventDispatcher);e.WelfareBtnsManager=h}),define("src/g/welfare/ctrl/GWelfareViewCtrl",["require","exports","src/g/welfare/view/GWelfareView","../../../core/E","../../../enum/EventName","src/g/welfare/ctrl/SignViewCtrl","src/g/welfare/ctrl/ExchangeCodeViewCtrl","src/g/welfare/ctrl/WelfareNoticeViewCtrl","src/g/welfare/ctrl/FAQViewCtrl","../../../manager/RoleCenter","src/g/welfare/ctrl/OnlineRewardCtrl","src/init/Switches","src/g/month_card/ctrl/MonthCardViewCtrl","src/g/superMonthCard/ctrl/superMonthCardViewCtrl","src/g/clearRes/ClearResM","src/g/redpacket/ctrl/RedPacketCtrl","../../../config/GameConfig","src/g/welfare/ctrl/WelfareBtnsManager","src/g/activity/view/ActivityPageFactroy","src/g/activity/ctrl/ActivityCtrl"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(){function t(){this.closeOther=!1,this._selectedIndex=-1,this.actPageList=new Laya.Dictionary,this.lastIsActivity=!1}return t.prototype.init=function(){var t=u.Switches.ins;t.on(6,this,this.onOpenIdHandler,[142]),t.on(5,this,this.onOpenIdHandler,[5]),t.on(12,this,this.onOpenIdHandler,[12]),t.on(122,this,this.onOpenIdHandler,[122]),t.on(142,this,this.onOpenIdHandler,[142]),t.on(143,this,this.onOpenIdHandler,[143]),t.on(144,this,this.onOpenIdHandler,[144]),t.on(165,this,this.onOpenIdHandler,[165]),n.E.ins.once(s.EventName.INIT_SELFSETOVER,this,this.onRoleInfoReady),this._monthCard=new p.MonthCardViewCtrl,this._monthCard.init(),this._superMonthCard=new d.superMonthCardViewCtrl,this._superMonthCard.init(),this.redpacketCtrl=new v.RedPacketCtrl},t.prototype.onOpenIdHandler=function(t,e,i,n,s){void 0===i&&(i=!0),void 0===n&&(n=!1),void 0===s&&(s=0),e&&this.onOpenHandler(t,i,n)},t.prototype.onOpenHandler=function(t,e,i,n){void 0===e&&(e=!0),void 0===i&&(i=!1),void 0===n&&(n=0),this.pageId=t,this._activityCfgId=n,5==t&&(this.pageId=233,this._activityCfgId=_.ActivityCtrl.LOGIN_ACTIVITY_ID),this.closeOther=e,this.forceOpen=i,this.onAtlasLoaded()},t.prototype.onRoleInfoReady=function(){this._olReward=new c.OnlineRewardCtrl,this._olReward.init()},t.prototype.initPages=function(){this._sign=new o.SignViewCtrl,this._sign.init(),this._exchangeCode=new a.ExchangeCodeViewCtrl,this._exchangeCode.init(),this._notice=new r.WelfareNoticeViewCtrl,this._notice.init(),this._FAQ=new l.FAQViewCtrl,this._FAQ.init(),this._btnManager=new y.WelfareBtnsManager,this._btnManager.on(y.WelfareBtnsManager.WELFARE_BTNS_LIST_CHANGED,this,this.updateBtns),this._btnManager.on(y.WelfareBtnsManager.WELFARE_BTNS_DELETED,this,this.onBtnDeleted),this._btnManager.init()},t.prototype.onBtnDeleted=function(t){this._selectedBtn==t&&(this._selectedBtn=null,this._selectedIndex=-1),this.deleteActPage(t.activityId)},t.prototype.updateBtns=function(){this._view.btn_con.removeChildren();for(var t,e=this._btnManager.btnList.length,i=0;i<e;)(t=this._btnManager.btnList[i]).on(Laya.Event.CLICK,this,this.onSelectHandler,[i]),this._view.btn_con.addChild(t),i++;-1==this._selectedIndex&&this.onSelectHandler(0)},t.prototype.onSelectHandler=function(t){this._selectedIndex!=t&&(this._selectedIndex=t,this._selectedBtn&&(this._selectedBtn.selected=!1),this._selectedIndex<this._btnManager.btnList.length&&(this._selectedBtn=this._btnManager.btnList[this._selectedIndex],this._selectedBtn&&(this._selectedBtn.selected=!0))),this._selectedBtn&&this.onItemSelectdHandler(this._selectedBtn.accessId,this._selectedBtn.activityId)},t.prototype.setSelectdByAccessId=function(t,e){for(var i,n=this._btnManager.btnList.length,s=0;s<n;){if((i=this._btnManager.btnList[s]).accessId==t&&i.activityId==e){this.onSelectHandler(s);break}s++}},t.prototype.onItemSelectdHandler=function(t,e){switch(void 0===e&&(e=0),this.lastIsActivity&&233!=t&&this._currPage&&(this._currPage.hidePage(),this._currPage=null),this._view.page_con.removeChildren(),t){case 142:this._sign.showPage(this._view.page_con),this._view.bg_view.img_title.skin=this._sign.getTitle();break;case 12:this._monthCard.showPage(this._view.page_con),this._view.bg_view.img_title.skin=this._monthCard.getTitle();break;case 122:this._superMonthCard.showPage(this._view.page_con),this._view.bg_view.img_title.skin=this._superMonthCard.getTitle();break;case 165:this.redpacketCtrl.showPage(this._view.page_con),this._view.bg_view.img_title.skin=this.redpacketCtrl.getTitle();break;case 144:this._notice.showPage(this._view.page_con),this._view.bg_view.img_title.skin=this._notice.getTitle();break;case 143:this._exchangeCode.showPage(this._view.page_con),this._view.bg_view.img_title.skin=this._exchangeCode.getTitle();break;case 233:this.showActPage(e)}this.lastIsActivity=233==t,n.E.ins.event(s.EventName.ACCESS_INTO,t),g.ClearResM.resetViewImg(this._view)},t.prototype.deleteActPage=function(t){var e=this.actPageList.get(t);this.actPageList.remove(t),e&&(e.doDestroy(),e==this._currPage&&(this._currPage=null))},t.prototype.showActPage=function(t){this._currPage&&this._currPage.hidePage();var e=this.actPageList.get(t);if(!e){var i=h.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=f.GameConfig.activityJson[i.cfgId];n&&(e=m.ActivityPageFactroy.getActivityPage(n.clientkey))&&this.actPageList.set(t,e)}}e&&(e.showPage(t,this._view.page_con),this._currPage=e,this.setActTitle(this._currPage.getActivityId()))},t.prototype.setActTitle=function(t){if(this._view.bg_view.img_title){this._view.bg_view.img_title.skin=null;var e=h.RoleCenter.instans.vo.getActivity1Data(t);if(e){var i=f.GameConfig.activityJson[e.cfgId];i&&(this._view.bg_view.img_title.skin="dynamic/activity/titles/"+i.clientkey+".png")}}},t.prototype.findActivityIdByCfgId=function(t){if(t)for(var e,i,n=this._view.btn_con.numChildren,s=0;s<n;){if((e=this._view.btn_con.getChildAt(s))&&e.activityId&&(i=h.RoleCenter.instans.vo.getActivity1Data(e.activityId))&&i.cfgId==t)return e.activityId;s++}return 0},t.prototype.onAtlasLoaded=function(){this.realOpenView()},t.prototype.realOpenView=function(){var t=this;this._view||(this._view=new i.GWelfareView,this._view.bg_view.btn_close.on(Laya.Event.CLICK,this,this.hideView),this._view.bg_view.btn_back.on(Laya.Event.CLICK,this,this.hideView),this.initPages(),Laya.timer.frameOnce(2,this,function(){t.setSelectdByAccessId(t.pageId,t.findActivityIdByCfgId(t._activityCfgId))})),this.setSelectdByAccessId(this.pageId,this.findActivityIdByCfgId(this._activityCfgId)),this._view.showView(this.closeOther,this.forceOpen),this._view.on(Laya.Event.REMOVED,this,this.hideView),g.ClearResM.resetViewImg(this._view)},t.prototype.hideView=function(){this._view.off(Laya.Event.REMOVED,this,this.hideView),this._sign&&this._sign.hidePage(),this._view&&this._view.hideView(),this.redpacketCtrl.hidePage()},t}();e.GWelfareViewCtrl=C}),define("src/g/recharge/ctrl/RechargeCtrl",["require","exports","../../../manager/RoleCenter","../../net/messages/OpResultType","../../../config/GameConfig","../../../core/E","../../../enum/EventName","../../../utils/system/ServerTime"],function(t,e,d,i,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function p(){}return p.prototype.init=function(){d.RoleCenter.instans.on(i.enumOpResultType.recharge_result.toString(),this,this.onRechargeResultHandler)},p.prototype.onRechargeResultHandler=function(t){if(t.opresult){var e=t.reservedata[0],i=t.reservedata[1];if(0==i&&console.log("充值异常"+e),1==i){if(!this.firstIdArr){this.firstIdArr=[8003,8004,8005,8006];for(var n=this.firstIdArr.length,s=0;s<n;){0<(o=p.getCouponRechargeId(this.firstIdArr[s]))&&this.firstIdArr.push(o),s++}}var o,a=d.RoleCenter.instans.vo.vipData.buyyedIdArr;if(d.RoleCenter.instans.vo.vipData.isFirstCharge){if(-1!=this.firstIdArr.indexOf(e)&&y.ServerTime.isHF&&!d.RoleCenter.instans.vo.vipData.isCombineFirst);else if(-1==a.indexOf(e))a.push(e),0<(o=p.getCouponRechargeId(e))&&a.push(o)}else;var r=t.reservedata[2],l=g.GameConfig.rechargeJson[e];if(l)if(l.gold&&(d.RoleCenter.instans.vo.vipData.allPriceGold+=l.gold),100==l.rid){if(!d.RoleCenter.instans.self.chkMonthCard())for(n=(h=g.GameConfig.playerJSON[1].monthcard__property).length,s=0;s<n;){"MONEYGET"==(c=h[s])[0]?d.RoleCenter.instans.vo.MONEYGET+=Number(c[1]):"EXPGET"==c[0]?d.RoleCenter.instans.vo.EXPGET+=Number(c[1]):"BAGEXTENDCOUNT"==c[0]&&(d.RoleCenter.instans.vo.bagdata.equBagCount+=Number(c[1])),s++}d.RoleCenter.instans.vo.monthCardEndTime=r,d.RoleCenter.instans.vo.GOLD+=l.gold}else if(101==l.rid){if(!d.RoleCenter.instans.self.chkSupperMonthCard()){var h;for(n=(h=g.GameConfig.playerJSON[1].super_monthcard_property).length,s=0;s<n;){var c;"MONEYGET"==(c=h[s])[0]?d.RoleCenter.instans.vo.MONEYGET+=Number(c[1]):"EXPGET"==c[0]?d.RoleCenter.instans.vo.EXPGET+=Number(c[1]):"BAGEXTENDCOUNT"==c[0]?d.RoleCenter.instans.vo.bagdata.equBagCount+=Number(c[1]):"SHENBINGHJCOUNT"==c[0]&&d.RoleCenter.instans.vo.setAttrAdd("SHENBINGHJCOUNT",Number(c[1])),s++}}d.RoleCenter.instans.vo.superMonthCardEndTime=r,d.RoleCenter.instans.vo.GOLD+=l.gold}else(l.rid<100||l.rid<500&&400<=l.rid)&&(d.RoleCenter.instans.vo.vipData.isFirstCharge?d.RoleCenter.instans.vo.vipData.isCombineFirst||-1!=this.firstIdArr.indexOf(l.id)&&(d.RoleCenter.instans.vo.vipData.isCombineFirst=!0,v.E.ins.event(f.EventName.FIRST_RECHARGE_SUCCESS)):(d.RoleCenter.instans.vo.vipData.isFirstCharge=!0,d.RoleCenter.instans.vo.vipData.isCombineFirst=!0,v.E.ins.event(f.EventName.FIRST_RECHARGE_SUCCESS)),d.RoleCenter.instans.vo.GOLD+=r);v.E.ins.event(f.EventName.RECHARGE_SUCCESS);var u=new ui.account.SuccessRechargeUI;Laya.stage.addChild(u),u.y=Laya.stage.height+200,Laya.Tween.to(u,{y:Laya.stage.width/2+200},1e3,null,new Laya.Handler(this,function(){Laya.Tween.to(u,{alpha:0},1e3,null,new Laya.Handler(this,function(){u.destroy()}))}))}}},p.checkCouponAndTransId=function(t){var e=g.GameConfig.rechargeJson[t],i=!1;if(e&&e.awy_id){var n=e.awy_id.split(","),s=Number(n[0]);if(1<n.length)var o=Number(n[1]);for(var a=d.RoleCenter.instans.vo.bagdata.itemTimeArr,r=a?a.length:0,l=0,h=y.ServerTime.serverTime;l<r;){if(a[l]==s&&h<a[l+1]){i=!0;break}l+=2}}return i?o:t},p.getCouponRechargeId=function(t){var e=g.GameConfig.rechargeJson[t];if(e&&e.awy_id){var i=e.awy_id.split(",");if(1<i.length)return Number(i[1])}return 0},p}();e.RechargeCtrl=n}),define("src/g/firstRecharge/view/FirstRechargeView",["require","exports","../../../manager/LayerManager","../../../config/GameConfig","../../../utils/ItemUtils","../../../manager/RoleCenter","src/g/Effects/UIEffectsFactory","../../../manager/GameSocketManager","../../../core/GNet","../../../manager/AM","src/g/bag/tips/view/ItemTips","../../../utils/ItemCellUtils","../../net/messages/enumStatus","../../../core/E","../../../enum/EventName","../../net/messages/activity/ActivityGet","src/g/clearRes/ClearResM","../../../utils/DialogQueue","../../../meta/CommonVo","src/g/recharge/ctrl/RechargeCtrl","src/init/TextConst"],function(t,e,i,c,u,p,s,o,a,r,l,h,d,g,v,f,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t.idArr=[8001,8002,8003,8004],t.keyArr=[10,20,50,100],t._maxId=8004,t.panelbg.btn_back.visible=!1,y.ClearResM.addBgUrl(t.img_bg.skin);var e=2;window.ktgamepreloadjdk&&window.ktgamepreloadjdk.channeltype&&(e=window.ktgamepreloadjdk.channeltype);var i=_.CommonVo.getVoByKey("firstRecharge"+e);return i&&(t.idArr=i.val2numArr,t._maxId=t.idArr[t.idArr.length-1]),t.ani_put=s.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.btn_get,40),g.E.ins.on(v.EventName.FIRST_RECHARGE_SUCCESS,t,t.onFirstRecharge),t.btn_get.on(Laya.Event.CLICK,t,t.getRewardHandler),t}return __extends(t,n),t.prototype.getIdByKey=function(t){var e=this.keyArr.indexOf(t);return-1<e?this.idArr[e]:-1},t.prototype.initShow=function(){for(var t,e=this.keyArr.length,i=0,n=0,s=0;i<e;){if(n=this.keyArr[i],s=this.getIdByKey(n),this["btn_"+n].on(Laya.Event.CLICK,this,this.toRecharge,[s]),this.setHtmlStyle(this["lab_"+n]),t=c.GameConfig.rechargeJson[s]){this["lab_"+n].innerHTML=I.TextConst.get(s==this._maxId?479:478,t.gold+t.reward2),this["clip_"+n].value=t.price/100;var o=C.RechargeCtrl.checkCouponAndTransId(s);if(o!=s){var a=t.price/100,r=(t=c.GameConfig.rechargeJson[o]).price/100;this["quan_"+n].visible=!0,this["lab_coupon_"+n].changeText(a+"减"+(a-r))}else this["quan_"+n].visible=!1}i++}},t.prototype.setHtmlStyle=function(t){t.style.color="#ff6600",t.style.font="SimHei",t.style.fontSize=18,t.style.align="center"},t.prototype.onFirstRecharge=function(){this.displayedInStage&&Laya.timer.once(200,this,this.refreshData)},t.prototype.initItems=function(){var t=102,e=p.RoleCenter.instans.vo.getFirstRechargeActivityData();e&&(t=e.cfgId);var i=0,n=0;for(var s in c.GameConfig.subActivityJson){var o=c.GameConfig.subActivityJson[s];if(o.activityId==t&&1==o.childId)for(var a=o.bonus.length,r=0,l=0;r<a;){i=o.bonus[r][0],n=o.bonus[r][1];var h=u.ItemUtils.getEquipVoById(i);h?h.job==p.RoleCenter.instans.vo.jobId&&(this.fillItemCell(l,i,n),l++):(this.fillItemCell(l,i,n),l++),r++}}},t.prototype.fillItemCell=function(t,e,i){var n=this["item"+t];n&&(h.ItemCellUtils.fillCellForItemNameView(n,e,i),n.on(Laya.Event.CLICK,this,function(){l.ItemTips.ins.showTip(e,i)}))},t.prototype.toRecharge=function(t){var e=C.RechargeCtrl.checkCouponAndTransId(this._maxId);if((t=C.RechargeCtrl.checkCouponAndTransId(t))!=e){var i=c.GameConfig.rechargeJson[t],n=i.price/100,s=(i=c.GameConfig.rechargeJson[e]).price/100;r.AM.showAdvanced(I.TextConst.get(894,s,i.gold+i.reward2),new Laya.Handler(this,function(){a.GNet.toRecharge(e)}),new Laya.Handler(this,function(){a.GNet.toRecharge(t)}),null,I.TextConst.get(480,s),I.TextConst.get(480,n))}else a.GNet.toRecharge(t)},t.prototype.showView=function(t){void 0===t&&(t=!0),m.DialogQueue.getInstance().reset(),Laya.Dialog.closeAll(),this.initShow(),this.initItems(),this.refreshData(),this.img_bg.restskin(),i.LayerManager.addInPOPWindowLayer(this,t),y.ClearResM.resetViewImg(this),g.E.ins.on(v.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){g.E.ins.off(v.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),y.ClearResM.clearResFolder("firstRecharge/")},t.prototype.refreshData=function(){var t=p.RoleCenter.instans.vo.vipData.isFirstCharge;if(this.btn_10.visible=!t,this.btn_20.visible=!t,this.btn_50.visible=!t,this.btn_100.visible=!t,this.img_tj.visible=!t,this.lab_10.visible=!t,this.lab_20.visible=!t,this.lab_50.visible=!t,this.lab_100.visible=!t,this.img_ad.visible=t,this.btn_get.visible=t){var e=this.checkGetReward();this.btn_get.disabled=!e,this.ani_put.visible=e}},t.prototype.checkGetReward=function(){var t=p.RoleCenter.instans.vo.getFirstRechargeActivityData();if(t)for(var e=t.children.length,i=0;i<e;){if(t.children[i].status==d.enumStatus.kelingqu)return!0;i++}return!1},t.prototype.getRewardHandler=function(){if(p.RoleCenter.instans.bagRoomEnough()){var t=p.RoleCenter.instans.vo.getFirstRechargeActivityData();if(t)for(var e=t.children.length,i=0;i<e;){if(t.children[i].status==d.enumStatus.kelingqu){var n=new f.ActivityGetC2GS;n.id=t.id,n.activity2CfgId=t.children[i].cfgId,o.GSM.sendServer(n),this.removeSelf()}i++}}else r.AM.showBagNotEnough()},t.prototype.destroy=function(){for(var t=0;t<8;){var e=this["item"+t];e&&(e.item.effect_con.removeChildren(),e.offAll(),e.destroy()),t++}this.ani_put&&(this.ani_put.clear(),this.ani_put.destroy(),this.ani_put=null),this.btn_10.offAll(),this.btn_20.offAll(),this.btn_50.offAll(),this.btn_100.offAll(),n.prototype.destroy.call(this),y.ClearResM.clearResFolder("firstRecharge/")},t}(ui.firstRecharge.FirstRechargeViewUI);e.FirstRechargeView=n}),define("src/g/firstRecharge/view/CombineFirstRechargeView",["require","exports","../../../manager/LayerManager","../../../config/GameConfig","../../../utils/ItemUtils","../../../manager/RoleCenter","src/g/Effects/UIEffectsFactory","../../../manager/GameSocketManager","../../../core/GNet","../../../manager/AM","src/g/bag/tips/view/ItemTips","../../../utils/ItemCellUtils","../../net/messages/enumStatus","../../../core/E","../../../enum/EventName","../../net/messages/activity/ActivityGet","src/g/clearRes/ClearResM","../../../utils/DialogQueue","src/g/recharge/ctrl/RechargeCtrl","src/init/TextConst"],function(t,e,n,c,u,p,s,o,a,r,l,h,d,g,v,f,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;return t.idArr=[8003,8004,8005,8006],t.keyArr=[10,20,50,100],t._maxId=8006,t._activityId=0,t.panelbg.btn_back.visible=!1,y.ClearResM.addBgUrl(t.img_bg.skin),t.ani_put=s.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.btn_get,40),g.E.ins.on(v.EventName.FIRST_RECHARGE_SUCCESS,t,t.onFirstRecharge),t.btn_get.on(Laya.Event.CLICK,t,t.getRewardHandler),t}return __extends(t,i),t.prototype.getIdByKey=function(t){var e=this.keyArr.indexOf(t);return-1<e?this.idArr[e]:-1},t.prototype.initShow=function(){for(var t,e=this.keyArr.length,i=0,n=0,s=0;i<e;){if(n=this.keyArr[i],s=this.getIdByKey(n),this["btn_"+n].on(Laya.Event.CLICK,this,this.toRecharge,[s]),this.setHtmlStyle(this["lab_"+n]),t=c.GameConfig.rechargeJson[s]){this["lab_"+n].innerHTML=C.TextConst.get(478,t.gold+t.reward3),this["clip_"+n].value=t.price/100;var o=_.RechargeCtrl.checkCouponAndTransId(s);if(o!=s){var a=t.price/100,r=(t=c.GameConfig.rechargeJson[o]).price/100;this["quan_"+n].visible=!0,this["lab_coupon_"+n].changeText(a+"减"+(a-r))}else this["quan_"+n].visible=!1}i++}},t.prototype.setHtmlStyle=function(t){t.style.color="#ff6600",t.style.font="SimHei",t.style.fontSize=18,t.style.align="center"},t.prototype.onFirstRecharge=function(){this.displayedInStage&&Laya.timer.once(200,this,this.refreshData)},t.prototype.initItems=function(){var t=102,e=p.RoleCenter.instans.vo.getActivity1Data(this._activityId);e&&(t=e.cfgId);var i=0,n=0;for(var s in c.GameConfig.subActivityJson){var o=c.GameConfig.subActivityJson[s];if(o.activityId==t&&1==o.childId)for(var a=o.bonus.length,r=0,l=0;r<a;){i=o.bonus[r][0],n=o.bonus[r][1];var h=u.ItemUtils.getEquipVoById(i);h?h.job==p.RoleCenter.instans.vo.jobId&&(this.fillItemCell(l,i,n),l++):(this.fillItemCell(l,i,n),l++),r++}}},t.prototype.fillItemCell=function(t,e,i){var n=this["item"+t];n&&(h.ItemCellUtils.fillCellForItemNameView(n,e,i,83),n.on(Laya.Event.CLICK,this,function(){l.ItemTips.ins.showTip(e,i)}))},t.prototype.toRecharge=function(t){var e=_.RechargeCtrl.checkCouponAndTransId(this._maxId);if((t=_.RechargeCtrl.checkCouponAndTransId(t))!=e){var i=c.GameConfig.rechargeJson[t],n=i.price/100,s=(i=c.GameConfig.rechargeJson[e]).price/100;r.AM.showAdvanced(C.TextConst.get(985,s,i.gold+i.reward3),new Laya.Handler(this,function(){a.GNet.toRecharge(e)}),new Laya.Handler(this,function(){a.GNet.toRecharge(t)}),null,C.TextConst.get(480,s),C.TextConst.get(480,n))}else a.GNet.toRecharge(t)},t.prototype.showView=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this._activityId=t,n.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),m.DialogQueue.getInstance().reset(),Laya.Dialog.closeAll(),this.initShow(),this.initItems(),this.refreshData(),this.img_bg.restskin(),y.ClearResM.resetViewImg(this),g.E.ins.on(v.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){g.E.ins.off(v.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),y.ClearResM.clearResFolder("firstRecharge/")},t.prototype.refreshData=function(){var t=p.RoleCenter.instans.vo.vipData.isCombineFirst;if(this.btn_10.visible=!t,this.btn_20.visible=!t,this.btn_50.visible=!t,this.btn_100.visible=!t,this.lab_10.visible=!t,this.lab_20.visible=!t,this.lab_50.visible=!t,this.lab_100.visible=!t,this.img_ad.visible=t,this.btn_get.visible=t){var e=this.checkGetReward();this.btn_get.disabled=!e,this.ani_put.visible=e}},t.prototype.checkGetReward=function(){var t=p.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)for(var e=t.children.length,i=0;i<e;){if(t.children[i].status==d.enumStatus.kelingqu)return!0;i++}return!1},t.prototype.getRewardHandler=function(){if(p.RoleCenter.instans.bagRoomEnough()){var t=p.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)for(var e=t.children.length,i=0;i<e;){if(t.children[i].status==d.enumStatus.kelingqu){var n=new f.ActivityGetC2GS;n.id=t.id,n.activity2CfgId=t.children[i].cfgId,o.GSM.sendServer(n),this.removeSelf()}i++}}else r.AM.showBagNotEnough()},t.prototype.destroy=function(){for(var t=0;t<8;){var e=this["item"+t];e&&(e.item.effect_con.removeChildren(),e.offAll(),e.destroy()),t++}this.ani_put&&(this.ani_put.clear(),this.ani_put.destroy(),this.ani_put=null),this.btn_10.offAll(),this.btn_20.offAll(),this.btn_50.offAll(),this.btn_100.offAll(),i.prototype.destroy.call(this),y.ClearResM.clearResFolder("firstRecharge/")},t}(ui.firstRecharge.CombineFirstRechargeViewUI);e.CombineFirstRechargeView=i}),define("src/g/firstRecharge/view/FirstRechargeViewNew",["require","exports","src/g/clearRes/ClearResM","../../../meta/CommonVo","../../../core/E","../../../enum/EventName","../../../utils/UIUtils","../../../config/GameConfig","src/init/TextConst","src/g/recharge/ctrl/RechargeCtrl","../../../manager/RoleCenter","../../../meta/EquipVo","../../../utils/ItemUtils","../../../utils/ItemCellUtils","src/g/Effects/UIEffectsFactory","src/g/bag/tips/view/ItemTips","../../../component/GAnimation","../../../core/GNet","../../net/messages/enumStatus","../../../utils/DialogQueue","../../../manager/LayerManager","../../../utils/system/DateUitl","../../../utils/system/ServerTime","../../net/messages/activity/ActivityGet","../../../manager/AM","../../../manager/GameSocketManager","../../../utils/system/FloatEffect","../../../enum/FashionPos"],function(t,e,s,o,a,r,h,u,c,p,d,l,g,v,f,y,m,_,C,i,I,b,w,S,E,T,A,R){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t.idArr=[8001,8002,8003,8004],t.keyArr=[10,20,50,100],t._maxId=8004,t.btnAniIsCreated=!1,t.btn_day0.selected,t.btn_day0.on(Laya.Event.CLICK,t,t.onSelecet,[t.btn_day0.name]),t.btn_day1.on(Laya.Event.CLICK,t,t.onSelecet,[t.btn_day1.name]),t.btn_day2.on(Laya.Event.CLICK,t,t.onSelecet,[t.btn_day2.name]),t.list.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t.list.hScrollBarSkin="",t.panelbg.btn_back.visible=!1,s.ClearResM.addBgUrl(t.img_bg.skin);var e=2;window.ktgamepreloadjdk&&window.ktgamepreloadjdk.channeltype&&(e=window.ktgamepreloadjdk.channeltype);var i=o.CommonVo.getVoByKey("firstRecharge"+e);return i&&(t.idArr=i.val2numArr,t._maxId=t.idArr[t.idArr.length-1]),a.E.ins.on(r.EventName.FIRST_RECHARGE_SUCCESS,t,t.onFirstRecharge),t.btn_get.on(Laya.Event.CLICK,t,t.getRewardHandler),t}return __extends(t,n),t.prototype.onSelecet=function(t){for(var e=0;e<3;e++){var i="btn_day"+e,n=this[i];this["tabBtn_txt"+e+"_0"].visible=t==i?(n.selected=!0,this.initItems(e+1),this.selectGetReward(e),this.changeTitleBgSKin(e+1),!(this["tabBtn_txt"+e+"_1"].visible=!0)):(n.selected=!1,!(this["tabBtn_txt"+e+"_1"].visible=!1))}},t.prototype.changeTitleBgSKin=function(t){this.img_bg.skin="res/firstRecharge/shouchong_guanggao0"+t+".jpg"},t.prototype.getIdByKey=function(t){var e=this.keyArr.indexOf(t);return-1<e?this.idArr[e]:-1},t.prototype.initShow=function(){for(var t,e=this.keyArr.length,i=0,n=0,s=0;i<e;){if(n=this.keyArr[i],s=this.getIdByKey(n),this["btn_"+n].on(Laya.Event.CLICK,this,this.toRecharge,[s]),h.UIUtils.initHtmlDiv(this["lab_"+n],"#ff6600",18,"center"),t=u.GameConfig.rechargeJson[s]){var o=t.price/100;this["lab_"+n].innerHTML=c.TextConst.get((this._maxId,478),t.gold+t.reward2),this["clip_"+n].value=o;var a=p.RechargeCtrl.checkCouponAndTransId(s);if(a!=s){var r=o,l=(t=u.GameConfig.rechargeJson[a]).price/100;this["quan_"+n].visible=!0,this["lab_coupon_"+n].changeText(r+"减"+(r-l))}else this["quan_"+n].visible=!1;this["clip_"+n].value=o}i++}},t.prototype.onFirstRecharge=function(){this.displayedInStage&&Laya.timer.once(200,this,this.refreshData)},t.prototype.initItems=function(t){var e=104,i=d.RoleCenter.instans.vo.getFirstRechargeActivityData();i&&(e=i.cfgId);var n=u.GameConfig.subActivityJson;for(var s in n){var o=n[s];if(o.activityId==e&&o.childId==t){for(var a=d.RoleCenter.instans.vo.getOpenHeroByIdx(0).jobid,r=[],l=0;l<o.bonus.length;l++){var h=o.bonus[l][0],c=g.ItemUtils.getEquipVoById(h);c?c.job==a&&r.push(o.bonus[l]):r.push(o.bonus[l])}this.list.array=r,this.list.refresh(),this.checkBunusShowAni(o.bonus,o)}}},t.prototype.onRenderHandler=function(t,e){var i=t.item;(v.ItemCellUtils.fillCellForItemNameView(i,t.dataSource[0],Number(t.dataSource[1])),i.item.img_quality.visible=!1,0==e)?(i.item.img_quality.visible=!0,i.item.img_quality.skin="res/firstRecharge/jiaobiao_feimaipin.png"):g.ItemUtils.getItemOrEq(t.dataSource[0])instanceof l.EquipVo&&(i.item.img_quality.visible=!0,i.item.img_quality.skin="res/firstRecharge/jiaobiao_jueban.png");i.item.effect_con.numChildren<=0&&f.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(i.item.effect_con,36)},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list.array[e];y.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.checkBunusShowAni=function(t,e){var i,n,s=t.length,o=0;for(this.img_stage.visible=!1;o<s;){if(i=t[o][0],n=u.GameConfig.fashionJson[i]){this.loadFasionAni(n);break}if(n=u.GameConfig.titleJSON[i]){this.loadTitleAni(n);break}if(e.image&&-1!=e.image.indexOf("EUI")){var a=e.image.split("_");if(1<a.length)if(g.ItemUtils.getUIEffectsVoById(Number(a[1]))){this.loadUIEffect(Number(a[1]));break}}o++}},t.prototype.loadUIEffect=function(t){for(var e,i=f.UIEffectsFactory.Ins.getSourceUrlById(t),n=this.box_title.numChildren,s=0;s<n;){if(e=this.box_title.getChildAt(s)){e.stop(),e.clear();break}s++}if(e){if(e._url&&e._url==i)return void e.play()}else(e=new m.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2+30,e.y=this.box_title.height/2,e.rotation=0,e.scale(1.5,1.5),e.load(i)},t.prototype.loadTitleAni=function(t){var e,i="dynamic2/chenghao/"+t.icon+".json";this.img_stage.visible=!0;for(var n=this.box_title.numChildren;0<n;)if(e=this.box_title.getChildAt(0)){e.stop(),e.clear();break}if(e){if(e._url&&e._url==i)return void e.play()}else(e=new m.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2-20,e.y=this.box_title.height/2,e.rotation=0,e.scale(1,1),e.load(i)},t.prototype.loadFasionAni=function(t){var e,i,n=d.RoleCenter.instans.vo.getSex(),s=this.box_title.numChildren,o=t.position;t.position==R.FashionPos.WING?i=0:t.position==R.FashionPos.WEAPON?i=1:t.position==R.FashionPos.FASHION&&(i=2);for(var a=g.ItemUtils.getAvtoarSource(t.res,i,n);0<s;)if(e=this.box_title.getChildAt(0)){e.stop(),e.clear();break}if(e){if(e._url&&e._url==a)return void e.play()}else(e=new m.GAnimation).isLoadedShow=!0,this.box_title.addChild(e);e.x=this.box_title.width/2,e.y=this.box_title.height/2,e.rotation=0,o==R.FashionPos.WING?e.scale(.7,.7):o==R.FashionPos.WEAPON?(e.rotation=-20,e.scale(.8,.8),e.x+=100):o==R.FashionPos.FASHION&&(o=2,e.x-=30,e.y-=60,e.scale(.7,.7)),e.load(a)},t.prototype.toRecharge=function(t){var e=p.RechargeCtrl.checkCouponAndTransId(this._maxId);if((t=p.RechargeCtrl.checkCouponAndTransId(t))!=e){var i=u.GameConfig.rechargeJson[t],n=i.price/100,s=(i=u.GameConfig.rechargeJson[e]).price/100;E.AM.showAdvanced(c.TextConst.get(894,s,i.gold+i.reward2),new Laya.Handler(this,function(){_.GNet.toRecharge(e)}),new Laya.Handler(this,function(){_.GNet.toRecharge(t)}),null,c.TextConst.get(480,s),c.TextConst.get(480,n))}else _.GNet.toRecharge(t)},t.prototype.initOpen=function(){var t=0,e=d.RoleCenter.instans.vo.getFirstRechargeActivityData();if(e)for(var i=e.children.length,n=0;n<i;){if(this.setImgVisible(n,!0),e.children[n].status==C.enumStatus.kelingqu){t=n;break}e.children[n].status==C.enumStatus.yilingqu&&this.setImgVisible(n,!1),n++}this.initItems(t+1),this.selectGetReward(t),this.onSelecet("btn_day"+t)},t.prototype.showView=function(t){void 0===t&&(t=!0),i.DialogQueue.getInstance().reset(),Laya.Dialog.closeAll(),this.btn_day0.selected=!0,this.initShow(),this.refreshData(),this.initOpen(),this.img_bg.restskin(),I.LayerManager.addInPOPWindowLayer(this,t),s.ClearResM.resetViewImg(this)},t.prototype.refreshData=function(){var t=d.RoleCenter.instans.vo.vipData.isFirstCharge;if(this.btn_10.visible=!t,this.btn_20.visible=!t,this.btn_50.visible=!t,this.btn_100.visible=!t,this.img_tj.visible=!t,this.lab_10.visible=!t,this.lab_20.visible=!t,this.lab_50.visible=!t,this.lab_100.visible=!t,this.img_ad.visible=t,this.btn_get.visible=t){var e=this.checkGetReward();this.btn_get.disabled=!e,this.selectGetReward(0),this.img_txt.visible=!1,this.startTejieAni(!1)}else this.setImgVisible(1,!0),this.setImgVisible(2,!0),this.img_txt.visible=!0,this.startTejieAni(!0)},t.prototype.createBtnAni=function(){},t.prototype.clearBtnAni=function(){},t.prototype.checkGetReward=function(){var t=d.RoleCenter.instans.vo.getFirstRechargeActivityData();if(t)for(var e=t.children.length,i=0;i<e;){if(t.children[i].status==C.enumStatus.kelingqu)return!0;i++}return!1},t.prototype.selectGetReward=function(t){var e=t;this.img_baolv.visible=0==t,this.btnClickID=104001+e,104e3<e&&e<104999&&(e-=104001);var i=d.RoleCenter.instans.vo.getFirstRechargeActivityData();if(i)for(var n=this.btn_get,s=i.children,o=s.length,a=0;a<o;){if(s[a].cfgId==104001+e){if(s[a].status==C.enumStatus.kelingqu){var r=this.isGet();return n.disabled=!r,n.label="领取第"+(e+1)+"天奖励",void(r?f.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(n,40):this.removeAni())}}else n.disabled=!0,n.label="已领取",this.removeAni();a++}},t.prototype.removeAni=function(){var t=this.btn_get.getChildByName("ani");t&&t.removeSelf()},t.prototype.isGet=function(){var t=d.RoleCenter.instans.vo.getFirstRechargeActivityData(),e=!1;if(t)switch(this.btnClickID){case 104001:e=!0;break;case 104002:e=1<=b.DateUtil.subDay(w.ServerTime.serverTime,t.allData.time);break;case 104003:e=2<=b.DateUtil.subDay(w.ServerTime.serverTime,t.allData.time)}return e},t.prototype.getRewardHandler=function(){if(d.RoleCenter.instans.bagRoomEnough()){var t=d.RoleCenter.instans.vo.getFirstRechargeActivityData();if(t)for(var e=t.children.length,i=0;i<e;){if(t.children[i].cfgId==this.btnClickID)if(t.children[i].status==C.enumStatus.kelingqu)if(this.isGet()){var n=new S.ActivityGetC2GS;n.id=t.id,n.activity2CfgId=t.children[i].cfgId,T.GSM.sendServer(n),this.btnClickID,I.LayerManager.closePOPWindowsNode(this),a.E.ins.event(r.EventName.FIRST_RECHARGE_REWARD_GET)}else A.FE.upItems("未到领取时间.");i++}}else E.AM.showBagNotEnough()},t.prototype.startTejieAni=function(t){t?f.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.ani_ring,50,.25,.25):this.ani_ring.removeChildren()},t.prototype.setImgVisible=function(t,e){},t.prototype.destroy=function(){this.btn_10.offAll(),this.btn_20.offAll(),this.btn_50.offAll(),this.btn_100.offAll(),this.btn_day0.offAll(),this.btn_day1.offAll(),this.btn_day2.offAll(),this.startTejieAni(!1),n.prototype.destroy.call(this),s.ClearResM.clearResFolder("firstRecharge/")},t}(ui.firstRecharge.FirstRechargeViewNewUI);e.FirstRechargeViewNew=n}),define("src/g/proxy/uictrl/IMultStateBtnCtrl",["require","exports"],function(t,e){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.MultStateBtnState||(e.MultStateBtnState={}))[i.notStart=0]="notStart",i[i.started=1]="started",i[i.stoped=2]="stoped"}),define("src/g/proxy/uictrl/firstrechargebtn/FirstRechargeBtnCtrl",["require","exports","src/g/accessctrl/AccessCenter","../../../../manager/RoleCenter","../../../net/messages/enumStatus","../../../../enum/EventName","../../../../core/E","src/init/Switches","../../../../manager/NewRedHintsCenter","../../../../utils/SoundUtils"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(){this._activityId=0}return t.prototype.checkCurrentState=function(){if(i.AccessCenter.ins.checkOpen(13))if(this._state=1,n.RoleCenter.instans.vo.vipData.isFirstCharge){var t=n.RoleCenter.instans.vo.getFirstRechargeActivityData();t&&t.children[0].status!=s.enumStatus.yilingqu?(this._activityId=t.id,a.E.ins.on(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged)):this._state=2}else a.E.ins.once(o.EventName.FIRST_RECHARGE_SUCCESS,this,this.checkCurrentState);else i.AccessCenter.ins.on(13,this,this.onAccessChangedHandler),this._state=0;this.checkRed(),this.updateUI()},t.prototype.checkRed=function(){if(i.AccessCenter.ins.checkOpen(13)&&n.RoleCenter.instans.vo.vipData.isFirstCharge){var t=n.RoleCenter.instans.vo.getFirstRechargeActivityData();if(t&&t.children[0].status==s.enumStatus.kelingqu)return void l.NewRedHintsCenter.ins.setRedHintOpenOrClose(l.enumRedHints.recharge_btn,!0)}l.NewRedHintsCenter.ins.setRedHintOpenOrClose(l.enumRedHints.recharge_btn,!1)},t.prototype.updateUI=function(){window.enabledpay||(this._state=0),0==this._state?this._ui.parent&&(this._ui.removeSelf(),this._ui.event(o.EventName.UI_REMOVE_STAGE)):1==this._state?(this._ui instanceof Laya.Image&&(this._ui.skin="res/indexicon/Xzjm_tubiao_015.png"),this._ui.on(Laya.Event.CLICK,this,this.onBtnClickHandler),this._parent&&(this._parent.addChild(this._ui),this._ui.event(o.EventName.UI_ADD_TO_STAGE))):2==this._state&&(this._ui.parent||this._parent&&(this._parent.addChild(this._ui),this._ui.event(o.EventName.UI_ADD_TO_STAGE)),this._backHandler&&this._backHandler.run())},t.prototype.onBtnClickHandler=function(){h.SoundUtils.getInstance().playBtnsounds(),r.Switches.ins.event(13)},t.prototype.onActivityDataChanged=function(t,e){this._activityId==e&&(a.E.ins.off(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.checkCurrentState())},t.prototype.onAccessChangedHandler=function(t){t&&(i.AccessCenter.ins.off(13,this,this.onAccessChangedHandler),this.checkCurrentState())},t.prototype.run=function(t,e,i){this._ui=t,this._backHandler=e,this._parent=i,this.checkCurrentState()},t.prototype.stop=function(){a.E.ins.off(o.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),i.AccessCenter.ins.off(13,this,this.onAccessChangedHandler),a.E.ins.off(o.EventName.FIRST_RECHARGE_SUCCESS,this,this.checkCurrentState),this._ui.off(Laya.Event.CLICK,this,this.onBtnClickHandler),this._ui=null,this._parent=null,this._backHandler=null},t.prototype.refreshUI=function(){},t}();e.FirstRechargeBtnCtrl=c}),define("src/g/proxy/uictrl/firstrechargebtn/FirstRechargeBtnNewCtrl",["require","exports","src/g/accessctrl/AccessCenter","../../../../manager/RoleCenter","../../../net/messages/enumStatus","../../../../core/E","../../../../enum/EventName","../../../../manager/NewRedHintsCenter","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime","../../../../config/GameConfig","../../../../utils/SoundUtils","src/init/Switches"],function(t,e,i,a,r,n,s,o,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(){this._activityId=0,this._dayRechargeId=0,this.red=new ktgame.img.KTImage}return t.prototype.checkCurrentState=function(){if(i.AccessCenter.ins.checkOpen(13))if(this._state=1,a.RoleCenter.instans.vo.vipData.isFirstCharge){var t=a.RoleCenter.instans.vo.getFirstRechargeActivityData();t&&(this.dayOneState=t.children[0].status),t&&t.children[0].status!=r.enumStatus.yilingqu?(this._activityId=t.id,n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged)):this._state=2}else n.E.ins.once(s.EventName.FIRST_RECHARGE_SUCCESS,this,this.checkCurrentState);else i.AccessCenter.ins.on(13,this,this.onAccessChangedHandler),this._state=0;this.updateUI(),1==this._state&&this.checkRed()},t.prototype.checkRed=function(){if(i.AccessCenter.ins.checkOpen(13)&&a.RoleCenter.instans.vo.vipData.isFirstCharge){var t=a.RoleCenter.instans.vo.getFirstRechargeActivityData();if(t&&t.children[0].status==r.enumStatus.kelingqu)return void o.NewRedHintsCenter.ins.setRedHintOpenOrClose(o.enumRedHints.recharge_btn,!0);if(t&&t.children[1].status==r.enumStatus.kelingqu)return void(1<=l.DateUtil.subDay(h.ServerTime.serverTime,t.allData.time)&&o.NewRedHintsCenter.ins.setRedHintOpenOrClose(o.enumRedHints.recharge_btn,!0));if(t&&t.children[2].status==r.enumStatus.kelingqu)return void(2<=l.DateUtil.subDay(h.ServerTime.serverTime,t.allData.time)&&o.NewRedHintsCenter.ins.setRedHintOpenOrClose(o.enumRedHints.recharge_btn,!0))}o.NewRedHintsCenter.ins.setRedHintOpenOrClose(o.enumRedHints.recharge_btn,!1)},t.prototype.updateUI=function(){0==this._state?this._ui.parent&&(this._ui.removeSelf(),this._ui.event(s.EventName.UI_REMOVE_STAGE)):1==this._state?(this._ui instanceof Laya.Image&&(this._ui.skin="res/indexicon/Xzjm_tubiao_015.png",this._additionalUI=new ktgame.img.KTImage,this._additionalUI.width=90,this._additionalUI.height=90,this._additionalUI.skin="res/indexicon/Xzjm_tubiao_019.png",this._additionalUI.pos(80,0)),this._ui.on(Laya.Event.CLICK,this,this.onBtnClickHandler),this._additionalUI.on(Laya.Event.CLICK,this,this.onAdditionalBtnClickHandler),this._parent&&(this._parent.addChild(this._ui),this._ui.event(s.EventName.UI_ADD_TO_STAGE),this._ui instanceof Laya.Image&&a.RoleCenter.instans.vo.vipData.isFirstCharge&&this.dayOneState==r.enumStatus.yilingqu&&(this._ui.skin="",this._ui.off(Laya.Event.CLICK,this,this.onBtnClickHandler),this._additionalUI.pos(0,0)),a.RoleCenter.instans.vo.vipData.isFirstCharge&&0<a.RoleCenter.instans.vo.getDayRechargeActId()?(this._ui.removeChildren(),this._ui.addChild(this._additionalUI)):this._additionalUI&&this._additionalUI.removeSelf()),this.check_additionalRed()):2==this._state&&(this._ui.parent||this._parent&&(this._parent.addChild(this._ui),this._ui.event(s.EventName.UI_ADD_TO_STAGE)),this._backHandler&&this._backHandler.run(),this._additionalUI&&this._additionalUI.removeSelf())},t.prototype.check_additionalRed=function(){if(this.red.skin="res/indexicon/red_point.png",this.red.pos(59,9),this._additionalUI&&this._additionalUI.displayedInStage){var t=a.RoleCenter.instans.vo.getDayRechargeActivityData();if(t){this._dayRechargeId=t.id;for(var e,i=h.ServerTime.isHF?l.DateUtil.getHFDay(h.ServerTime.ACTIVITY_TIME_OFFSET):l.DateUtil.getKFDay(h.ServerTime.ACTIVITY_TIME_OFFSET),n=t.children.length,s=0,o=0;s<n;)(e=c.GameConfig.subActivityJson[t.children[s].cfgId])?o<e.value&&(o=e.value):console.error("天天充值数据错误："+s+"/"+JSON.stringify(t)),s++;for(0==(i%=o)&&(i=o),this._additionalUI.removeChild(this.red),n=t.children.length,s=0;s<n;){if((e=c.GameConfig.subActivityJson[t.children[s].cfgId])&&e.value==i&&t.children[s].status==r.enumStatus.kelingqu){this._additionalUI.addChild(this.red);break}s++}}else this._additionalUI&&this._additionalUI.removeSelf()}},t.prototype.onBtnClickHandler=function(){u.SoundUtils.getInstance().playBtnsounds(),p.Switches.ins.event(13)},t.prototype.onAdditionalBtnClickHandler=function(t){t.stopPropagation(),u.SoundUtils.getInstance().playBtnsounds(),p.Switches.ins.event(111)},t.prototype.onActivityDataChanged=function(t,e){this._activityId==e?this.checkCurrentState():this._dayRechargeId==e&&this.check_additionalRed()},t.prototype.onAccessChangedHandler=function(t){t&&(i.AccessCenter.ins.off(13,this,this.onAccessChangedHandler),this.checkCurrentState())},t.prototype.run=function(t,e,i){n.E.ins.on(s.EventName.ACTIVITY_DELETED,this,this.onActivityDeleted),this._ui=t,this._backHandler=e,this._parent=i,this.checkCurrentState()},t.prototype.onActivityDeleted=function(t,e){this._activityId==e&&(this._ui.parent||this._parent&&(this._parent.addChild(this._ui),this._ui.event(s.EventName.UI_ADD_TO_STAGE)),this._backHandler&&this._backHandler.run(),this._additionalUI&&this._additionalUI.removeSelf())},t.prototype.stop=function(){o.NewRedHintsCenter.ins.setRedHintOpenOrClose(o.enumRedHints.recharge_btn,!1),n.E.ins.off(s.EventName.ACTIVITY_DELETED,this,this.onActivityDeleted),n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),i.AccessCenter.ins.off(13,this,this.onAccessChangedHandler),n.E.ins.off(s.EventName.FIRST_RECHARGE_SUCCESS,this,this.checkCurrentState),this._ui.off(Laya.Event.CLICK,this,this.onBtnClickHandler),this._ui=null,this._parent=null,this._backHandler=null},t.prototype.refreshUI=function(){},t}();e.FirstRechargeBtnNewCtrl=d}),define("src/g/firstRecharge/ctrl/FirstRechargeViewCtrl",["require","exports","src/g/firstRecharge/view/FirstRechargeView","src/g/firstRecharge/view/CombineFirstRechargeView","src/init/Switches","src/g/firstRecharge/view/FirstRechargeViewNew","../../../manager/RoleCenter","src/g/activity/ctrl/ActivityCtrl"],function(t,e,n,s,i,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){this.closeOther=!1}return t.prototype.init=function(){i.Switches.ins.on(13,this,this.onOpenHandler),i.Switches.ins.on(226,this,this.onOpenCombineHandler)},t.prototype.onOpenCombineHandler=function(t,e,i,n){void 0===e&&(e=!0),void 0===i&&(i=!1),t&&n&&(this._combineView||(this._combineView=new s.CombineFirstRechargeView,this._combineView.panelbg.btn_close.on(Laya.Event.CLICK,this,this.closeCombinePanel)),this._combineView.showView(n,e,i))},t.prototype.onOpenHandler=function(t,e){void 0===e&&(e=!0),t&&this.openPanel(0,e)},t.prototype.openPanel=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!0);var i=a.RoleCenter.instans.vo.getFirstRechargeActivityData();i&&i.cfgId==r.ActivityCtrl.FIRST_RECHARGE_ACTIVITY_ID_NEW?(this._viewNew||(this._viewNew=new o.FirstRechargeViewNew,this._viewNew.panelbg.btn_back.on(Laya.Event.CLICK,this,this.closePanelNew),this._viewNew.panelbg.btn_close.on(Laya.Event.CLICK,this,this.closePanelNew)),this._viewNew.showView(this.closeOther)):(this._view||(this._view=new n.FirstRechargeView,this._view.panelbg.btn_close.on(Laya.Event.CLICK,this,this.closePanel)),this._view.showView(this.closeOther))},t.prototype.closePanelNew=function(){this._viewNew&&(this._viewNew.removeSelf(),this._viewNew.destroy(),this._viewNew=null)},t.prototype.closePanel=function(){this._view&&(this._view.removeSelf(),this._view.destroy(),this._view=null)},t.prototype.closeCombinePanel=function(){this._combineView&&(this._combineView.removeSelf(),this._combineView.destroy(),this._combineView=null)},t}();e.FirstRechargeViewCtrl=l}),define("src/g/privileges/view/PrivilegesView",["require","exports","../../../manager/LayerManager","src/g/Effects/UIEffectsFactory","../../../config/GameConfig","../../../utils/ItemUtils","../../../manager/RoleCenter","../../../enum/EventName","../../../core/E","../../net/messages/VipC2GS","../../net/messages/OpResultType","../../../manager/GameSocketManager","src/init/Switches","src/g/peronboss/view/ItemIconView","src/g/clearRes/ClearResM","../../../manager/AM","src/init/TextConst"],function(t,e,i,l,h,c,n,s,o,a,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(r){function t(){var t=r.call(this)||this;t.isdestroy=!1,v.ClearResM.addBgUrl(t.bgimg.skin),t.view.btn_back.on(Laya.Event.CLICK,t,t.clickHandler),t.view.btn_close.on(Laya.Event.CLICK,t,t.clickHandler);var e=l.UIEffectsFactory.Ins.createUIAniById(50,!0);window.oldversion?(t.bgimg.skin="res/privileges/vip5_beijingtu_old.png",v.ClearResM.addBgUrl(t.bgimg.skin),t._campatibleVipLv=3):t._campatibleVipLv=5,l.UIEffectsFactory.Ins.alignCenter(e,t.ani_con,1),t.ani_con.addChild(e);for(var i=h.GameConfig.vipJSON[t._campatibleVipLv].bons,n=0,s=0;s<i.length;s++){var o=i[s][0];if(1e4<o){var a=c.ItemUtils.getItemOrEq(o);g.ItemIconView.setItemData(a,t["item"+n]),5==c.ItemUtils.getQualityById(o)&&(t["item"+n].lvl.text=a.name+"("+c.ItemUtils.getEquipLv(a.limit)+")",t["hp"+n].text=y.TextConst.get(948,a.prop[0][1]),t["att"+n].text=y.TextConst.get(949,a.prop[1][1])),n++}}return t}return __extends(t,r),t.prototype.clickHandler=function(){this.removeSelf();for(var t=this.ani_con.numChildren-1;0<=t;){var e=this.ani_con.removeChildAt(t);e&&(e.stop(),e.clear(),e.destroy()),t--}l.UIEffectsFactory.Ins.clearAniRes(49,!0),l.UIEffectsFactory.Ins.clearAniRes(81,!0),this.view.btn_back.off(Laya.Event.CLICK,this,this.clickHandler),this.view.btn_close.off(Laya.Event.CLICK,this,this.clickHandler),o.E.ins.off(s.EventName.VIP_GET_BONS_STATE_CHANGED,this,this.changeVip),o.E.ins.off(s.EventName.VIP_EXP_CHANGED,this,this.changeVip),this.isdestroy=!0,this.destroy(!0),v.ClearResM.clearResFolder("privileges/")},t.prototype.showView=function(){n.RoleCenter.instans.self?this.changeVip():o.E.ins.once(s.EventName.INIT_SELFSETOVER,this,this.changeVip),i.LayerManager.addInPOPWindowLayer(this),this.view.btn_back.on(Laya.Event.CLICK,this,this.clickHandler),this.view.btn_close.on(Laya.Event.CLICK,this,this.clickHandler),o.E.ins.on(s.EventName.VIP_GET_BONS_STATE_CHANGED,this,this.changeVip),o.E.ins.on(s.EventName.VIP_EXP_CHANGED,this,this.changeVip),o.E.ins.on(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){o.E.ins.off(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),v.ClearResM.clearResFolder("privileges/")},t.prototype.changeVip=function(){n.RoleCenter.instans.vo.VIP>=this._campatibleVipLv?0==(n.RoleCenter.instans.self.vipData.getBons>>this._campatibleVipLv-1&1)?(this.btn_recharge.label=y.TextConst.get(211),this.btn_recharge.disabled=!0,this._btnAni&&(this._btnAni.visible=!1),this.btn_recharge.off(Laya.Event.CLICK,this,this.getGift),this.clickHandler(),d.Switches.ins.event(145)):(this.btn_recharge.label=y.TextConst.get(204),this.btn_recharge.on(Laya.Event.CLICK,this,this.getGift),this._btnAni||(this._btnAni=l.UIEffectsFactory.Ins.createUIAniById(40,!0),l.UIEffectsFactory.Ins.centered4Parent(this._btnAni,this.btn_recharge,!0))):(this.btn_recharge.label=y.TextConst.get(232),this.btn_recharge.on(Laya.Event.CLICK,this,this.rechargeHandler))},t.prototype.rechargeHandler=function(){d.Switches.ins.event(109)},t.prototype.getGift=function(){if(n.RoleCenter.instans.bagRoomEnough()){var t=new a.VipC2GS;t.msgidx=u.enumOpResultType.vip_get,t.curVip=this._campatibleVipLv,p.GSM.sendServer(t)}else f.AM.showBagNotEnough()},t}(ui.privileges.PrivilegesViewUI);e.PrivilegesView=r}),define("src/g/privileges/view/Privileges4View",["require","exports","src/g/Effects/UIEffectsFactory","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../../manager/LayerManager","src/init/Switches","../../net/messages/VipC2GS","../../net/messages/OpResultType","../../../manager/GameSocketManager","src/g/clearRes/ClearResM","../../../manager/AM","src/init/TextConst"],function(t,e,n,s,o,a,r,l,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t.isdestroy=!1,p.ClearResM.addBgUrl(t.bgimg.skin),t.view.btn_back.on(Laya.Event.CLICK,t,t.clickHandler),t.view.btn_close.on(Laya.Event.CLICK,t,t.clickHandler);var e=n.UIEffectsFactory.Ins.createUIAniById(49,!0);return n.UIEffectsFactory.Ins.alignCenter(e,t.ani_con,1),t.ani_con.addChild(e),window.oldversion?(t.bgimg.skin="res/privileges/vip6_beijingtu_old.png",p.ClearResM.addBgUrl(t.bgimg.skin),t._campatibleVipLv=4):t._campatibleVipLv=6,t}return __extends(t,i),t.prototype.clickHandler=function(){this.removeSelf();for(var t=this.ani_con.numChildren-1;0<=t;){var e=this.ani_con.removeChildAt(t);e&&(e.stop(),e.clear(),e.destroy()),t--}this.view.btn_back.off(Laya.Event.CLICK,this,this.clickHandler),this.view.btn_close.off(Laya.Event.CLICK,this,this.clickHandler),s.E.ins.off(o.EventName.VIP_GET_BONS_STATE_CHANGED,this,this.changeVip),s.E.ins.off(o.EventName.VIP_EXP_CHANGED,this,this.changeVip),this.isdestroy=!0,this.destroy(!0),this.closeClearRes()},t.prototype.showView=function(){a.RoleCenter.instans.self?this.changeVip():s.E.ins.once(o.EventName.INIT_SELFSETOVER,this,this.changeVip),r.LayerManager.addInPOPWindowLayer(this),this.view.btn_back.on(Laya.Event.CLICK,this,this.clickHandler),this.view.btn_close.on(Laya.Event.CLICK,this,this.clickHandler),s.E.ins.on(o.EventName.VIP_GET_BONS_STATE_CHANGED,this,this.changeVip),s.E.ins.on(o.EventName.VIP_EXP_CHANGED,this,this.changeVip),this.bgimg.restskin(),s.E.ins.on(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){s.E.ins.off(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),p.ClearResM.clearResFolder("privileges/")},t.prototype.changeVip=function(){a.RoleCenter.instans.vo.VIP>=this._campatibleVipLv?a.RoleCenter.instans.vo.vipRewardIsGet(this._campatibleVipLv)?(this.btn_recharge.label=g.TextConst.get(211),this.btn_recharge.disabled=!0,this._btnAni&&(this._btnAni.visible=!1),this.btn_recharge.off(Laya.Event.CLICK,this,this.getGift)):(this.btn_recharge.label=g.TextConst.get(204),this.btn_recharge.on(Laya.Event.CLICK,this,this.getGift),this._btnAni||(this._btnAni=n.UIEffectsFactory.Ins.createUIAniById(40,!0),n.UIEffectsFactory.Ins.centered4Parent(this._btnAni,this.btn_recharge,!0))):(this.btn_recharge.label=g.TextConst.get(232),this.btn_recharge.on(Laya.Event.CLICK,this,this.rechargeHandler))},t.prototype.rechargeHandler=function(){l.Switches.ins.event(109)},t.prototype.getGift=function(){if(a.RoleCenter.instans.bagRoomEnough()){this.closePage();var t=new h.VipC2GS;t.msgidx=c.enumOpResultType.vip_get,t.curVip=this._campatibleVipLv,u.GSM.sendServer(t)}else d.AM.showBagNotEnough()},t.prototype.closePage=function(){this.removeSelf();for(var t=this.ani_con.numChildren-1;0<=t;){var e=this.ani_con.removeChildAt(t);e&&(e.stop(),e.clear(),e.destroy()),t--}n.UIEffectsFactory.Ins.clearAniRes(49,!0),this.view.btn_back.off(Laya.Event.CLICK,this,this.clickHandler),this.view.btn_close.off(Laya.Event.CLICK,this,this.clickHandler)},t}(ui.privileges.Privileges4ViewUI);e.Privileges4View=i}),define("src/g/privileges/ctrl/PrivilegesCtrl",["require","exports","../../../manager/RoleCenter","src/g/privileges/view/PrivilegesView","src/g/privileges/view/Privileges4View","src/init/Switches"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){window.oldversion?(this._campatibleVipLvStage1=3,this._campatibleVipLvStage2=4):(this._campatibleVipLvStage1=5,this._campatibleVipLvStage2=6)}return t.prototype.init=function(){o.Switches.ins.on(14,this,this.completeHandler),o.Switches.ins.on(145,this,this.completeHandler)},t.prototype.completeHandler=function(){var t=0==(i.RoleCenter.instans.self.vipData.getBons>>this._campatibleVipLvStage1-1&1),e=0==(i.RoleCenter.instans.self.vipData.getBons>>this._campatibleVipLvStage2-1&1);return t?e?t&&e?(this._view&&this._view.destroy(),this._view4&&this._view4.destroy(),void o.Switches.ins.event(101)):void 0:(this._view4=new s.Privileges4View,void this._view4.showView()):(this._view=new n.PrivilegesView,void this._view.showView())},t.prototype.open4Panel=function(){0==(i.RoleCenter.instans.self.vipData.getBons>>this._campatibleVipLvStage2-1&1)?o.Switches.ins.event(101):(this._view4=new s.Privileges4View,this._view4.showView())},t}();e.PrivilegesCtrl=a}),define("src/g/dayRecharge/view/NewDayRechargeView",["require","exports","../../../core/E","../../../enum/EventName","src/g/Effects/UIEffectsFactory","../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../manager/RoleCenter","../../../manager/LayerManager","src/g/clearRes/ClearResM","../../net/messages/enumStatus","../../../config/GameConfig","src/init/Switches","../../net/messages/activity/ActivityGet","../../../manager/GameSocketManager","../../../utils/system/DateUitl","../../../utils/system/ServerTime"],function(t,e,n,s,i,o,a,r,l,h,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(e){function t(){var t=e.call(this)||this;return t._selectIndex=-1,t.img_bg.width=Laya.stage.width,t.img_bg.height=Laya.stage.height,t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,t,t.onDataUpdateHandler),t.btn_recharge.on(Laya.Event.CLICK,t,t.gotoRechargeHandler),t.btn_get.on(Laya.Event.CLICK,t,t.doGetActivityReward),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),i.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.btn_effect,28),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){o.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];a.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.onDataUpdateHandler=function(t,e){this._activityId==e&&this.refreshData()},t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.showView=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this._activityId!=t&&(this._activityId=t),this.initContent(),l.LayerManager.addInPOPWindowLayer(this,e,!1,!0,!1,i),this.refreshData(),h.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.initContent=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=f.ServerTime.isHF?v.DateUtil.getHFDay(f.ServerTime.ACTIVITY_TIME_OFFSET):v.DateUtil.getKFDay(f.ServerTime.ACTIVITY_TIME_OFFSET);this._childIndexArr=[];for(var i,n=t.children.length,s=0,o=0;s<n;)o<(i=u.GameConfig.subActivityJson[t.children[s].cfgId]).value&&(o=i.value),s++;for(0==(e%=o)&&(e=o),s=0;s<n;)(i=u.GameConfig.subActivityJson[t.children[s].cfgId]).value==e&&this._childIndexArr.push(s),s++;this._childIndexArr.sort(this.childSortFun.bind(this))}},t.prototype.closeClearRes=function(){n.E.ins.off(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),h.ClearResM.clearUrl(this.bgskin.skin)},t.prototype.refreshData=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)for(var e,i=this._childIndexArr?this._childIndexArr.length:0,n=0,s=0;n<i;){if(s=this._childIndexArr[n],(e=t.children[s]).status==c.enumStatus.weiwancheng||e.status==c.enumStatus.kelingqu)return void this.onSelectedHandler(n);n++}this.onCloseHandler()},t.prototype.childSortFun=function(t,e){var i=r.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=u.GameConfig.subActivityJson[i.children[t].cfgId],s=u.GameConfig.subActivityJson[i.children[e].cfgId];return n.childId-s.childId},t.prototype.onSelectedHandler=function(t){this._selectIndex=t,this.updateSeleced()},t.prototype.updateSeleced=function(){if(-1!=this._selectIndex){var t,e=r.RoleCenter.instans.vo.getActivity1Data(this._activityId),i=this._childIndexArr[this._selectIndex];t=e.children[i];var n=u.GameConfig.subActivityJson[t.cfgId];this.btn_effect.visible=!0,t.status==c.enumStatus.weiwancheng?(this.btn_recharge.visible=!0,this.btn_get.visible=!1,this.font_money.value=Math.max(0,n.value2-e.allData.allCount).toString()):t.status==c.enumStatus.kelingqu?(this.btn_recharge.visible=!1,this.btn_get.visible=!0,this.font_money.value="0"):t.status==c.enumStatus.yilingqu&&(this.btn_recharge.visible=!1,this.btn_get.visible=!1,this.font_money.value="0",this.btn_effect.visible=!1),this.list_item.array=n.bonus}},t.prototype.gotoRechargeHandler=function(){p.Switches.ins.event(109,[!1,!0])},t.prototype.doGetActivityReward=function(){if(!(Date.now()-this._lastRequestTime<500)){var t,e=r.RoleCenter.instans.vo.getActivity1Data(this._activityId),i=this._childIndexArr[this._selectIndex];if((t=e.children[i])&&t.status==c.enumStatus.kelingqu){var n=new d.ActivityGetC2GS;n.id=this._activityId,n.activity2CfgId=t.cfgId,g.GSM.sendServer(n),this._lastRequestTime=Date.now()}}},t}(ui.dayRecharge.NewDayRechargeViewUI);e.NewDayRechargeView=y}),define("src/g/dayRecharge/ctrl/DayRechargeViewCtrl",["require","exports","src/g/base/GameBaseCtrl","src/init/Switches","src/g/dayRecharge/view/NewDayRechargeView","../../../manager/RoleCenter"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){n.Switches.ins.on(111,this,this.openPanel)},e.prototype.openPanel=function(t){t&&this.completeHandler()},e.prototype.completeHandler=function(){this._view||(this._view=new s.NewDayRechargeView,this._view.btn_close.on(Laya.Event.CLICK,this,this.onCloseHandler)),this._view.showView(o.RoleCenter.instans.vo.getDayRechargeActId())},e.prototype.onCloseHandler=function(){this._view.removeSelf(),this._view.destroy(),this._view=null,Laya.loader.clearRes(this.url)},e}(i.GameBaseCtrl);e.DayRechargeViewCtrl=a}),define("src/g/firstRecharge/view/RechargeItem",["require","exports","../../../core/GNet","../../../manager/RoleCenter","../../../utils/system/ServerTime","../../../config/GameConfig","../../../manager/AM","src/g/recharge/ctrl/RechargeCtrl","src/init/TextConst"],function(t,e,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.on(Laya.Event.CLICK,t,t.rechargeHandler),t}return __extends(t,e),t.prototype.rechargeHandler=function(){if(this._data){var t=this._data.id;if(r.ServerTime.isHF&&!a.RoleCenter.instans.vo.vipData.isCombineFirst){var e=c.RechargeCtrl.checkCouponAndTransId(8006);if(8004==t||8005==t||8003==t){t=c.RechargeCtrl.checkCouponAndTransId(t);var i=l.GameConfig.rechargeJson[t],n=i.price/100,s=(i=l.GameConfig.rechargeJson[e]).price/100;return void h.AM.showAdvanced(u.TextConst.get(985,s,i.gold+i.reward3),new Laya.Handler(this,function(){o.GNet.toRecharge(e)}),new Laya.Handler(this,function(){o.GNet.toRecharge(t)}),null,u.TextConst.get(480,s),u.TextConst.get(480,n))}t=c.RechargeCtrl.checkCouponAndTransId(t)}else t=c.RechargeCtrl.checkCouponAndTransId(t);o.GNet.toRecharge(t)}},t.prototype.setData=function(t){if(t){var e=(this._data=t).id;this.img_icon.skin="res/firstRecharge/"+t.id+".png";var i=t.price/100;this.lab_yuan.changeText(i.toString());var n=c.RechargeCtrl.checkCouponAndTransId(t.id);if(t.id!=n){var s=t.price/100,o=(t=l.GameConfig.rechargeJson[n]).price/100;this.quan.visible=!0,this.lab_quan.changeText(s+"减"+(s-o))}else this.quan.visible=!1;-1<a.RoleCenter.instans.vo.vipData.buyyedIdArr.indexOf(e)?(this.clip_gold.value=t.gold.toString(),this.img_flag.skin=""):!a.RoleCenter.instans.vo.vipData.isFirstCharge&&0<t.reward2?(this.clip_gold.value=(t.gold+t.reward2).toString(),this.img_flag.skin="res/firstRecharge/UI_cz_shouchong.png"):(this.clip_gold.value=(t.gold+t.reward).toString(),this.img_flag.skin="res/firstRecharge/UI_cz_shuangbei.png")}},t}(ui.firstRecharge.NewRechargeItemUI);e.RechargeItem=i}),define("src/g/firstRecharge/view/RechargeView",["require","exports","../../../manager/LayerManager","src/g/firstRecharge/view/RechargeItem","../../../config/GameConfig","../../../manager/RoleCenter","../../net/messages/OpResultType","src/g/clearRes/ClearResM","../../../enum/EventName","../../../core/E","../../../utils/DialogQueue"],function(t,e,s,i,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t._data=[],t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=100,t.list.itemRender=i.RechargeItem,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t}return __extends(t,e),t.prototype.renderHandler=function(t,e){t.setData(this.list.array[e])},t.prototype.onRechargeResultHandler=function(){this.list.refresh()},t.prototype.showView=function(t){if(void 0===t&&(t=!1),a.RoleCenter.instans.on(r.enumOpResultType.recharge_result.toString(),this,this.onRechargeResultHandler),u.DialogQueue.getInstance().reset(),Laya.Dialog.closeAll(),s.LayerManager.addInPOPWindowLayer(this,!1),l.ClearResM.addBgUrl(this.bgimg1.skin),l.ClearResM.resetViewImg(this),c.E.ins.on(h.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),t){var e=o.GameConfig.rechargeJson;for(var i in e){var n=e[i];0<n.rid&&n.rid<=10&&this._data.push(n)}this.list.array=this._data}else this.list.refresh()},t.prototype.closeClearRes=function(){c.E.ins.off(h.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),l.ClearResM.clearResFolder("firstRecharge/")},t.prototype.destroy=function(){this.list.vScrollBarSkin=null,this.list.itemRender=null,this.list.renderHandler=null,this.list.array=null,this._data.length=0,this.view.btn_back.offAll(),this.view.btn_close.offAll(),a.RoleCenter.instans.off(r.enumOpResultType.recharge_result.toString(),this,this.onRechargeResultHandler),e.prototype.destroy.call(this)},t}(ui.firstRecharge.NewRechargeViewUI);e.RechargeView=n}),define("src/g/firstRecharge/ctrl/CommonRechargeCtrl",["require","exports","src/g/firstRecharge/view/RechargeView","../../../manager/RoleCenter","../../net/messages/enumStatus","src/init/Switches"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){}return t.prototype.init=function(){o.Switches.ins.on(109,this,this.onOpenHandler)},t.prototype.onOpenHandler=function(t){t&&this.openView()},t.prototype.openView=function(){var t=!0;if(n.RoleCenter.instans.vo.vipData.isFirstCharge){var e=n.RoleCenter.instans.vo.getFirstRechargeActivityData();e&&e.children[0].status!=s.enumStatus.yilingqu&&(t=!1)}else t=!1;t?this._view?this._view.showView(!1):(this._view=new i.RechargeView,this._view.view.btn_close.on(Laya.Event.CLICK,this,this.closeHandler),this._view.view.btn_back.on(Laya.Event.CLICK,this,this.closeHandler),this._view.showView(!0)):o.Switches.ins.event(13)},t.prototype.closeHandler=function(){this._view&&(this._view.removeSelf(),this._view.destroy(),this._view=null)},t}();e.CommonRechargeCtrl=a}),define("src/g/dress/view/pages/TitlePage",["require","exports","../../../../config/GameConfig","../../../../plugin/sbkPropTool","../../../net/messages/PropFightMain","../../../../manager/RoleCenter","../../../net/messages/TitleMsg","../../../../manager/GameSocketManager","../../../../core/E","../../../../enum/EventName","../../../../utils/system/ServerTime","../../../../component/GAnimation","src/init/TextConst"],function(t,e,h,o,a,c,s,r,l,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(n){function t(){var t=null!==n&&n.apply(this,arguments)||this;return t._selectIndex=-1,t}return __extends(t,n),t.prototype.initialize=function(){n.prototype.initialize.call(this),this.list_title.scrollBar.elasticDistance=200,this.list_title.renderHandler=new Laya.Handler(this,this.onListRenderHandler),this.list_title.mouseHandler=new Laya.Handler(this,this.onListMouseHandler);var t=[];for(var e in h.GameConfig.titleJSON){var i=h.GameConfig.titleJSON[e];i&&i.isShowInUI&&t.push(Number(e))}this.titleIdList=t,l.E.ins.on(u.EventName.TITLE_SHOW_CHANGED,this,this.refreshList)},t.prototype.showPage=function(){this.refreshList(),-1==this._selectIndex&&this.selectItemHandler(0)},t.prototype.destroy=function(){l.E.ins.off(u.EventName.TITLE_SHOW_CHANGED,this,this.refreshList),this.list_title.renderHandler=null,this.list_title.mouseHandler=null,n.prototype.destroy.call(this)},t.prototype.refreshList=function(){this.titleIdList.sort(this.sortFun),this.list_title.array=this.titleIdList,this.updateTitleAdd()},t.prototype.sortFun=function(t,e){var i=1e3,n=1e3;return c.RoleCenter.instans.vo.titleData.titleArr&&-1!=c.RoleCenter.instans.vo.titleData.titleArr.indexOf(t)&&(i-=1e3),c.RoleCenter.instans.vo.titleData.titleArr&&-1!=c.RoleCenter.instans.vo.titleData.titleArr.indexOf(e)&&(n-=1e3),i-n},t.prototype.onListRenderHandler=function(t,e){var i=Number(t.dataSource);t.btn_op.offAll();var n,s=-1,o=!1;c.RoleCenter.instans.vo.titleData&&(c.RoleCenter.instans.vo.titleData.titleArr&&(s=c.RoleCenter.instans.vo.titleData.titleArr.indexOf(i)),-1!=c.RoleCenter.instans.vo.titleData.curTitle.indexOf(i)&&(o=!0)),t.img_select.visible=e==this._selectIndex;for(var a=t.effect_con.numChildren;0<a;)if(n=t.effect_con.getChildAt(0)){n.stop(),n.clear();break}n||((n=new d.GAnimation).x=t.effect_con.width/2,n.y=t.effect_con.height/2,t.effect_con.addChild(n));var r="dynamic2/chenghao/"+h.GameConfig.titleJSON[i].icon+".json";if(n.forceShowFirstFrame=!0,n.load(r,-1!=s),t.btn_op.visible=-1!=s,t.lab_isget.text=-1!=s?g.TextConst.get(372):g.TextConst.get(371),t.box.gray=-1==s,t.btn_op.label=o?g.TextConst.get(373):g.TextConst.get(491),t.lab_time.visible=!1,-1!=s){t.btn_op.on(Laya.Event.CLICK,this,this.onPutOnOrOff,[i,o]);var l=c.RoleCenter.instans.vo.titleData.endTimeArr[s]-p.ServerTime.serverTime;0<l&&(t.lab_time.text=g.TextConst.get(374,Math.ceil(l/3600/24)),t.lab_time.visible=!0)}},t.prototype.onPutOnOrOff=function(t,e){var i=new s.TitleChgC2GS;i.chgType=e?2:1,i.titleId=t,r.GSM.sendServer(i)},t.prototype.onListMouseHandler=function(t,e){t.type==Laya.Event.CLICK&&this.selectItemHandler(e)},t.prototype.selectItemHandler=function(t){var e;this.updateShowTitle(t),-1!=this._selectIndex&&(e=this.list_title.getCell(this._selectIndex))&&(e.img_select.visible=!1),this._selectIndex=t,(e=this.list_title.getCell(this._selectIndex))&&(e.img_select.visible=!0)},t.prototype.updateShowTitle=function(t){if(this.list_title.array){var e=this.list_title.array[t];if(this._currShowId!=e){this._currShowId=e;var i=h.GameConfig.titleJSON[e];if(i){this.showAni?this.showAni.stop():(this.showAni=new d.GAnimation,this.showAni.isLoadedShow=!0,this.showAni.x=this.effect_con.width/2,this.showAni.y=this.effect_con.height/2,this.effect_con.addChild(this.showAni));var n="dynamic2/chenghao/"+h.GameConfig.titleJSON[e].icon+".json";this.showAni.load(n,!0),this.txt_desc.text=i.desc;var s=new a.PropFightMain;o.sbkPropTool.reSetProp(s,i.prop),this.lab_HP.text="+"+s.HP,this.lab_ATT.text="+"+s.ATT,this.lab_PDEF.text="+"+s.PDEF,this.lab_SDEF.text="+"+s.SDEF}}}},t.prototype.updateTitleAdd=function(){for(var t=new a.PropFightMain,e=c.RoleCenter.instans.vo.titleData.titleArr.length,i=0;i<e;){var n=c.RoleCenter.instans.vo.titleData.titleArr[i],s=h.GameConfig.titleJSON[n];s&&o.sbkPropTool.reSetProp(t,s.prop,!1),i++}this.lab_HP_total.text="+"+t.HP,this.lab_ATT_total.text="+"+t.ATT,this.lab_PDEF_total.text="+"+t.PDEF,this.lab_SDEF_total.text="+"+t.SDEF},t}(ui.dress.pages.TitlePageUI);e.TitlePage=i}),define("src/g/custom/SuitAttrDlg",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"array",{set:function(t){for(var e,i=t.length,n=0,s=[],o=0,a=51;n<i;)(e=new Laya.HTMLDivElement).width=500,e.style.color="#c0b4a3",e.style.font="SimHei",e.style.fontSize=16,e.style.stroke=1,e.style.strokeColor="#000000",e.innerHTML=t[n],e.x=33,e.y=a,a+=25,o=Math.max(o,e.contextWidth),s.push(e),n++;n=0;for(var r,l=48;n<i;)(r=new Laya.Image("res/custom/chuanshi_shujudi.png")).sizeGrid="4,4,4,4",r.height=23,r.width=o+10,r.x=30,r.y=l,l+=25,this.addChild(r),n++;for(n=0;n<i;)this.addChild(s[n]),n++;this.img_bg.width=this.width=o+70,this.img_bg.height=this.height=a+58,this.img_title.x=(this.width-this.img_title.width)/2},enumerable:!0,configurable:!0}),e}(ui.components.SuitAttrDlgUI);e.SuitAttrDlg=i}),define("src/g/dress/view/pages/FashionPage",["require","exports","../../../../config/GameConfig","../../../../utils/ItemUtils","../../../../manager/RoleCenter","../../../../enum/EventName","../../../../core/E","../../../net/messages/sbkFormula","../../../net/messages/PropFightMain","../../../../plugin/sbkPropTool","../../../../meta/ShuXingVo","../../../../utils/system/ServerTime","../../../net/messages/FashionC2GS","../../../net/messages/OpResultType","../../../../utils/system/FloatEffect","../../../../manager/GameSocketManager","src/g/clearRes/ClearResM","src/init/Switches","src/init/TextConst","../../../../utils/RoleUtil","src/g/custom/SuitAttrDlg","../../../../utils/UIUtils"],function(t,e,_,C,I,i,n,b,w,S,E,f,h,c,u,p,s,o,T,a,A,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._nowSelectHero=0,t._selectIndex=-1,t.starHandler=new Laya.Handler(t,t.starRender),t}return __extends(t,e),t.prototype.initialize=function(){e.prototype.initialize.call(this),s.ClearResM.addBgUrl(this.bgimg.skin),this.list_fashion.selectEnable=!0,this.list_fashion.mouseHandler=new Laya.Handler(this,this.onListSelectHandler),this.list_fashion.renderHandler=new Laya.Handler(this,this.onListRenderHandler),this.list_fashion.scrollBar.elasticDistance=200,this.head_bar.setCallbackHandler(new Laya.Handler(this,this.HeroSelect)),this.refreshHeadShow(),n.E.ins.on(i.EventName.OPENNEW_HERO,this,this.refreshHeadShow),I.RoleCenter.instans.vo.heronum<3&&(n.E.ins.on(i.EventName.ADDED_LEVEL,this,this.refreshHeadShow),n.E.ins.on(i.EventName.ADDED_ZHUANSHENG,this,this.refreshHeadShow),n.E.ins.on(i.EventName.VIP_EXP_CHANGED,this,this.refreshHeadShow)),this.btn_up.on(Laya.Event.CLICK,this,this.onUp),this.btn_op.on(Laya.Event.CLICK,this,this.onFashionOperation),this.btn_allProp.on(Laya.Event.CLICK,this,this.onAllProp),this.list_star.renderHandler=this.starHandler,n.E.ins.on(i.EventName.FASHION_STATE_CHANGED,this,this.onFashionStateChanaged),n.E.ins.on(i.EventName.FASHION_RED_NUM_CHANGED,this,this.onFashionRedChanaged)},t.prototype.onUp=function(){var t=this._nowSelectHero,e=I.RoleCenter.instans.vo.getOpenHeroByIdx(t);if(e){var i=this._tryId,n=0,s=e.fashionData,o=_.GameConfig.fashionJson[i],a=s.fashionArr.indexOf(i);if(-1==a)0<I.RoleCenter.instans.vo.bagdata.getItemCount(o.itemId[0])?n=c.enumOpResultType.fashion_activate:u.FE.upItems(T.TextConst.get(370));else{var r=new h.FashionLvMsg;r.heroidx=t,r.fashtionId=i,r.curLv=s.fashionLvArr[a]||0,p.GSM.sendServer(r)}if(0!=n){var l=new h.FashionC2GS;l.msgidx=n,l.fashtionId=i,l.heroidx=t,l.useItemId=o.itemId[0],p.GSM.sendServer(l)}}},t.prototype.onAllProp=function(){var t=new A.SuitAttrDlg,e=I.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero),i=[],n=new w.PropZhuZai,s=new w.PropFashionStar;if(t.img_title.skin="res/fashion/zb_tips_zi.png",e)for(var o=e.fashionData,a=o.fashionArr,r=o.fashionLvArr,l=a.length,h=0;h<l;h++){var c=a[h],u=_.GameConfig.fashionJson[c];u&&S.sbkPropTool.reSetProp(n,u.prop,!1);var p=r[h];(y=_.GameConfig.fashionstar[c+"_"+p])&&S.sbkPropTool.reSetProp(s,y.prop,!1)}var d=[];for(var g in n){var v=n[g];!isNaN(v)&&0<v&&d.push(g,v)}for(var g in s){v=s[g];if(!isNaN(v)&&0<v){var f=d.indexOf(g);-1==f?d.push(g,v):d[f+1]+=v}}for(h=0;h<d.length;h+=2){var y;(y=C.ItemUtils.getShuXingByName(d[h]))&&i.push("<font color='#c0b4a3'>"+y.desc+":"+E.ShuXingVo.getString4Vo(d[h+1],y)+"</font>")}var m=b.sbkFormula.calZhuZaiCombat(n)+b.sbkFormula.calCombat(0,s.HP*(1+s.HP_MULTI),s.ATT*(1+s.ATT_MULTI),s.PDEF*(1+s.PDEF_MULTI),s.SDEF*(1+s.SDEF_MULTI),0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);i.push("<font color='#c0b4a3'>"+T.TextConst.get(79,m)+"</font>"),t.array=i,t.popup()},t.prototype.onFashionRedChanaged=function(){this.displayedInStage&&(this.list_fashion.refresh(),this.updateHeadRed())},t.prototype.updateHeadRed=function(){for(var t=0;t<3;t++){var e=I.RoleCenter.instans.vo.getOpenHeroByIdx(t),i=this.head_bar.getChildByName("item_"+t);i&&(i.img_red.visible=!!e&&e.checkHasFashionRedByPos(this._showPos))}},t.prototype.onFashionOperation=function(){var t=this._tryId;if(t){var e=I.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero);if(e&&e.fashionData){var i=0;i=-1!=e.fashionData.curFashion.indexOf(t)?c.enumOpResultType.fashion_putoff:c.enumOpResultType.fashion_puton;var n=_.GameConfig.fashionJson[t];if(0!=i){var s=new h.FashionC2GS;s.msgidx=i,s.fashtionId=t,s.heroidx=this._nowSelectHero,s.useItemId=n.itemId[0],p.GSM.sendServer(s)}}}},t.prototype.onFashionStateChanaged=function(t){t==this._nowSelectHero&&(this.list_fashion.refresh(),this.updateBtnOpState())},t.prototype.refreshHeadShow=function(){this.head_bar.initData(I.RoleCenter.instans.self.openhero,this._nowSelectHero,I.RoleCenter.instans.vo)},t.prototype.HeroSelect=function(t,e){this._nowSelectHero!=t&&(I.RoleCenter.instans.vo.getOpenHeroByIdx(t)?(this._nowSelectHero=t,this.head_bar.setSelectIndex(t),this.list_fashion.refresh(),this.refreshAni(),this.updateBtnOpState(),this.updateFashionInfo(),this.updateHeadRed()):o.Switches.ins.event(15))},t.prototype.showPage=function(t){this.setShowPos(t),this.refreshAni(),this.updateNeedItemShow(),this.updateHeadRed(),this.bgimg.restskin()},t.prototype.setShowPos=function(t){var e=this._tryId,i=_.GameConfig.getFvoArrByPos(t);if(this._showPos!=t&&(this._showPos=t,this._selectIndex=-1,e=NaN),this.list_fashion.array=i,isNaN(e)){var n=i[0],s=n?n.id:-1;this._selectIndex=0,this.setTryId(s)}else{this._tryId=-1,this.setTryId(e);for(var o=0;o<i.length;o++){if(i[o].id==e){this._selectIndex=this.list_fashion.selectedIndex=o,this.list_fashion.scrollTo(o);break}}}},t.prototype.setTryId=function(t){this._tryId!=t&&(this._tryId=t,this.lab_need.visible=!1,this.lab_need_name.visible=!1,0==t?(this.layer_info2.visible=!1,this.btn_op.visible=!1,this.btn_up.visible=!1,this.box_star.visible=!1):(this.layer_info2.visible=!0,this.btn_op.visible=!0,this.updateBtnOpState(),this.updateFashionInfo()),this.refreshAni())},t.prototype.updateFashionInfo=function(){var t=this._tryId,e=_.GameConfig.fashionJson[t];if(this.box_attr_now.removeChildren(),e){var i=e.prop,n=new w.PropZhuZai,s=new w.PropFashionStar;S.sbkPropTool.reSetProp(n,i);var o=I.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero).fashionData,a=o.fashionArr.indexOf(t);if(-1!=a){var r=o.fashionLvArr[a],l=_.GameConfig.fashionstar[t+"_"+r];l&&S.sbkPropTool.reSetProp(s,l.prop)}var h=[];for(var c in n){var u=n[c];!isNaN(u)&&0<u&&h.push(c,u)}for(var c in s){u=s[c];if(!isNaN(u)&&0<u){var p=h.indexOf(c);-1==p?h.push(c,u):h[p+1]+=u}}for(var d=0;d<h.length;d+=2){var g=C.ItemUtils.getShuXingByName(h[d]);if(g){var v=E.ShuXingVo.createSXBox(g.name,h[d+1],"#349320",":","#349320");this.box_attr_now.addChild(v)}}var f=b.sbkFormula.calZhuZaiCombat(n)+b.sbkFormula.calCombat(0,s.HP*(1+s.HP_MULTI),s.ATT*(1+s.ATT_MULTI),s.PDEF*(1+s.PDEF_MULTI),s.SDEF*(1+s.SDEF_MULTI),0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);this.lab_name2.text=e.name,this.lab_fight2.text=f.toString()}},t.prototype.updateBtnOpState=function(){var t=_.GameConfig.fashionJson[this._tryId];if(t){var e=this.list_star,i=I.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero);if(i){var n=this.btn_op,s=i.fashionData,o=s.fashionArr.indexOf(this._tryId);if(-1==o){this.btn_up.label=T.TextConst.get(237),n.disabled=!0,n.skin="res/fashion/zhuangban_chuandai.png",this.box_star.visible=!1;for(var a=[],r=0;r<5;r++)a.push(0);e.array=a,this.btn_up.visible=!0}else{this.btn_up.label=T.TextConst.get(732),n.disabled=!1,-1!=s.curFashion.indexOf(this._tryId)?n.skin="res/fashion/zhuangban_tuoxia.png":n.skin="res/fashion/zhuangban_chuandai.png";var l=s.fashionLvArr[o];a=d.UIUtils.getXingArr(5,l);this.box_star.visible=0<l?(e.renderHandler=this.starHandler,!0):!!_.GameConfig.fashionstar[t.id+"_1"],e.array=a,this.btn_up.visible=!!_.GameConfig.fashionstar[t.id+"_"+(l+1)]}this.updateNeedItemShow()}}},t.prototype.updateNeedItemShow=function(){var t=this._tryId,e=_.GameConfig.fashionJson[t];if(e){var i=I.RoleCenter.instans.vo.bagdata,n=I.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero).fashionData,s=n.fashionArr.indexOf(t);if(-1==s)0<i.getItemCount(e.itemId[0])?(this.lab_need.visible=!1,this.lab_need_name.visible=!1,this.btn_op.disabled=!1):(this.lab_need.visible=!0,this.lab_need_name.visible=!0,this.lab_need_name.text=C.ItemUtils.getItemOrEq(e.itemId).name,this.btn_op.disabled=!0);else{var o=n.fashionLvArr[s],a=_.GameConfig.fashionstar[t+"_"+(o+1)];a?(this.lab_need.visible=!0,this.lab_need_name.visible=!0,this.lab_need_name.text=C.ItemUtils.getItemOrEq(a.id).name+"x"+a.cost[0][1]):(this.lab_need.visible=!1,this.lab_need_name.visible=!1)}}},t.prototype.onListSelectHandler=function(t,e){var i;t.type==Laya.Event.CLICK&&(-1!=this._selectIndex&&((i=this.list_fashion.getCell(this._selectIndex))&&(i.img_select.visible=!1),this._selectIndex=-1),(i=this.list_fashion.getCell(e))&&i.dataSource&&(i.img_select.visible=!0,this.setTryId(Number(i.dataSource.id)),this._selectIndex=e))},t.prototype.starRender=function(t,e){t.skin="res/custom/juese_jingmai_"+(t.dataSource?"xing":"kongxing")+".png"},t.prototype.onListRenderHandler=function(t,e){var i=t.dataSource;if(i){var n=t.lab_time,s=t.list_star,o=-1,a=!1,r=0;t.img_dressed.visible=!1,n.visible=!1;var l=I.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero);if(l){var h=l.fashionData,c=[];if(a=-1!=(o=h.fashionArr.indexOf(i.id))){-1!=h.curFashion.indexOf(i.id)&&(t.img_dressed.visible=!0);var u=h.endTimeArr[o]-f.ServerTime.serverTime;if(0<u&&(n.text=T.TextConst.get(8,Math.ceil(u/3600/24).toString()),n.visible=!0),0<(r=h.fashionLvArr[o])){s.renderHandler=this.starHandler;for(var p=0;p<5&&p<=r-1;p++)c.push(1);s.width=43*c.length*s.scaleX,s.x=(t.width-s.width)/2}}s.array=c,s.visible=a&&!!_.GameConfig.fashionstar[i.id+"_1"]}var d=I.RoleCenter.instans.vo.bagdata,g=_.GameConfig.fashionstar[i.id+"_"+(r+1)],v=C.ItemUtils.getItemOrEq(i.itemId);if(!v)return;t.lab_name.text=v.name,t.img_item.skin=C.ItemUtils.getIconByIconId(i.itemId[0]),t.img_select.visible=e==this._selectIndex,t.lab_name.disabled=!a,t.img_item.disabled=!a,t.img_red.visible=!a&&0<d.getItemCount(i.itemId[0])||a&&g&&d.getItemCount(g.cost[0][0])>=g.cost[0][1]}},t.prototype.refreshAni=function(){var t=_.GameConfig.fashionJson[this._tryId],e=I.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero);a.RoleUtil.refreshZww(e,100,this.role_show.wing,this.role_show.weapon,this.role_show.role,this.role_show.ani_fumo,t)},t.prototype.destroy=function(){this.list_fashion.mouseHandler=null,this.list_fashion.renderHandler=null,this.head_bar.setCallbackHandler(null),n.E.ins.off(i.EventName.OPENNEW_HERO,this,this.refreshHeadShow),n.E.ins.off(i.EventName.ADDED_LEVEL,this,this.refreshHeadShow),n.E.ins.off(i.EventName.ADDED_ZHUANSHENG,this,this.refreshHeadShow),n.E.ins.off(i.EventName.VIP_EXP_CHANGED,this,this.refreshHeadShow),this.btn_op.offAll(),n.E.ins.off(i.EventName.FASHION_STATE_CHANGED,this,this.onFashionStateChanaged),n.E.ins.off(i.EventName.FASHION_RED_NUM_CHANGED,this,this.onFashionRedChanaged),e.prototype.destroy.call(this),n.E.ins.event(i.EventName.AVTOAR)},t}(ui.dress.pages.FashionPageUI);e.FashionPage=r}),define("src/g/dress/view/DressView",["require","exports","../../../manager/LayerManager","src/g/dress/view/pages/TitlePage","src/g/dress/view/pages/FashionPage","../../../enum/FashionPos","../../../manager/RoleCenter","src/g/proxy/MultiLevelUIProxy","../../../manager/GameSocketManager","../../net/messages/FashionC2GS","../../../config/GameConfig","../../../vo/sbkBagVo","../../../enum/BagItemType"],function(t,e,i,n,h,s,w,o,a,r,S,E,T){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.initialize=function(){t.prototype.initialize.call(this),this.bg.btn_help.visible=!1,this._tabProxy=new o.MultiLevelUIProxy,this._tabProxy.registerTab(this.btnbar,0),this._tabProxy.registerTagIndex(59,0),this._tabProxy.registerTagIndex(60,1),this._tabProxy.registerTagIndex(61,2),this._tabProxy.registerTagIndex(62,3),this._tabProxy.selectHandler=new Laya.Handler(this,this.onSwitchPage),a.GSM.ins.on(r.FashionLvMsg.KEY,this,this.onFashionUp)},e.prototype.onFashionUp=function(){isNaN(this._oldSelect)||this.onSwitchPage(this._oldSelect)},e.prototype.showView=function(t){void 0===t&&(t=0),this._tabProxy.open(t),i.LayerManager.addInPOPWindowLayer(this,!1,!0)},e.prototype.onSwitchPage=function(t){switch(this.bg.box_page.removeChildren(),this._oldSelect=t){case 0:this._titlePage||(this._titlePage=new n.TitlePage),this.titleicon.skin="res/fashion/zhuangban_chenghaowenzi.png",this.bg.box_page.addChild(this._titlePage),this._titlePage.showPage();break;case 1:this.setDefault(s.FashionPos.FASHION),this.titleicon.skin="res/fashion/zhuangban_zhuangbanwenzi.png";break;case 2:this.setDefault(s.FashionPos.WEAPON),this.titleicon.skin="res/fashion/zhuangban_zhuangbanwenzi.png";break;case 3:this.setDefault(s.FashionPos.WING),this.titleicon.skin="res/fashion/zhuangban_zhuangbanwenzi.png"}},e.prototype.setDefault=function(t){this._fashionPage||(this._fashionPage=new h.FashionPage);var e=this._fashionPage._nowSelectHero,i=this.fashionId;if(i){var n=(s=this.getSelectIdx(t,i))[0];0!=n&&(e=n),this._fashionPage._showPos=t,this._fashionPage._tryId=i}else{var s=this.getSelectIdx(t);console.log(e);var o=w.RoleCenter.instans.vo.getOpenHeroByIdx(e).fashionData,a=this._fashionPage._tryId,r=o.fashionArr.indexOf(a);if(0!=a&&-1!=r){var l=o.fashionLvArr[r];S.GameConfig.fashionstar[a+"_"+(l+1)]||(a=s[1])}this._fashionPage._tryId=a}this.bg.box_page.addChild(this._fashionPage),this._fashionPage.showPage(t),this._fashionPage.HeroSelect(e)},e.prototype.getSelectIdx=function(t,e){for(var i=[],n=E.sbkBagVo.getItemArrByType(T.BagItemType.shizhuang),s=S.GameConfig.getFvoArrByPos(t),o=[],a=0;a<s.length;a++){var r=s[a];o.push(r.id);var l=n.indexOf(r.itemId[0]);-1!=l&&n.push(n.splice(l,1)[0])}var h=S.GameConfig.fashionstar,c=0,u=0,p=w.RoleCenter.instans.vo,d=p.heronum,g=isNaN(e)?-1:n.indexOf(e);for(a=0;a<d;a++){for(var v=p.getOpenHeroByIdx(a).fashionData,f=v.fashionArr,y=0;y<n.length;y++){var m=n[y];if(-1==g||e==m){var _=o.indexOf(m);if(-1!=_){var C=s[_];if(f.length!=o.length){var I=f.indexOf(m);if(-1!=I){var b=v.fashionLvArr[I];if(!h[C.id+"_"+(b+1)])continue}c=a,u=m;break}}}}if(0<u)break}return i.push(c,u),i},e.prototype.destroy=function(){this.bg.btn_help.offAll(),this.bg.btn_close.offAll(),this.bg.btn_back.offAll(),this.btnbar.selectHandler=null,a.GSM.ins.off(r.FashionLvMsg.KEY,this,this.onFashionUp),this._fashionPage&&!this._fashionPage.parent&&this._fashionPage.destroy(),this._titlePage&&!this._titlePage.parent&&this._titlePage.destroy(),this._tabProxy&&(this._tabProxy.destroy(),this._tabProxy=null),t.prototype.destroy.call(this)},e}(ui.dress.DressViewUI);e.DressView=l}),define("src/g/dress/ctrl/DressViewCtrl",["require","exports","src/g/dress/view/DressView","../../../core/E","../../../enum/EventName","../../net/messages/OpResultType","../../../manager/RoleCenter","../../../manager/GameSocketManager","../../net/messages/sbkTitleData","../../../meta/FashionVo","../../../config/GameConfig","../../../plugin/sbkPropTool","../../../utils/system/ServerTime","../../../vo/RedDot/role/RedDot_Dress","../../../vo/RedDot/EventRedDot","../../net/messages/FashionC2GS","src/init/Switches","../../../manager/NewRedHintsCenter","../../../runtime/resload/GameResLoad","../../../vo/sbkBagVo","../../../enum/BagItemType","../../../enum/FashionPos"],function(t,e,i,E,T,g,A,o,n,R,L,r,v,s,a,l,h,x,c,P,k,D){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){this.url="res/atlas/res/fashion.json"}return t.prototype.init=function(){h.Switches.ins.on(59,this,this.onOpenHandler,[59]),h.Switches.ins.on(60,this,this.onOpenHandler,[60]),h.Switches.ins.on(61,this,this.onOpenHandler,[61]),h.Switches.ins.on(62,this,this.onOpenHandler,[62]),A.RoleCenter.instans.on(g.enumOpResultType.title_showChg.toString(),this,this.onTitleShowChgBack),o.GSM.ins.on(l.FashionLvMsg.KEY,this,this.onFashionUp),o.GSM.ins.on(n.sbkTitleData.KEY,this,this.onTitleDataChangedBack),A.RoleCenter.instans.on(g.enumOpResultType.fashion_activate.toString(),this,this.onFashionOperationBack),A.RoleCenter.instans.on(g.enumOpResultType.fashion_activateAndPuton.toString(),this,this.onFashionOperationBack),A.RoleCenter.instans.on(g.enumOpResultType.fashion_putoff.toString(),this,this.onFashionOperationBack),A.RoleCenter.instans.on(g.enumOpResultType.fashion_puton.toString(),this,this.onFashionOperationBack),A.RoleCenter.instans.on(g.enumOpResultType.fashion_over.toString(),this,this.onFashionTimeOverBack),E.E.ins.once(T.EventName.INIT_SELFSETOVER,this,this.dataInited)},t.prototype.onOpenHandler=function(t,e,i){void 0===i&&(i=0),e&&(this.fashionId=i,this.openPanel(t))},t.prototype.dataInited=function(){E.E.ins.on(T.EventName.CHANGEITEM_COUNT,this,this.onItemCountChanaged),this.updateFashionRed(),this.initTimers()},t.prototype.openPanel=function(t){this._view||(c.GameResLoad.load(this.url),this._view=new i.DressView,this._view.bg.btn_close.on(Laya.Event.CLICK,this,this.closePanel),this._view.bg.btn_back.on(Laya.Event.CLICK,this,this.closePanel)),this._view.fashionId=this.fashionId,this._view.showView(t)},t.prototype.closePanel=function(){this._view&&(this._view.removeSelf(),this._view.bg.box_page.removeChildren(),this._view.destroy(),this._view=null),Laya.Loader.clearRes(this.url)},t.prototype.onTitleShowChgBack=function(t){if(t.opresult){var e=t.reservedata[0],i=t.reservedata[1];if(i){var n=A.RoleCenter.instans.vo.titleData.curTitle;if(1==e){for(var s=n.length-1,o=L.GameConfig.titleJSON[i],a=o.type;0<=s;)n[s]&&(o=L.GameConfig.titleJSON[n[s]])&&o.type==a&&n.splice(s,1),s--;n.push(i)}else if(2==e){-1!=(s=n.indexOf(i))&&n.splice(s,1)}this.updateTitlePropertyAdd(),E.E.ins.event(T.EventName.TITLE_SHOW_CHANGED)}}},t.prototype.onTitleDataChangedBack=function(t){A.RoleCenter.instans.vo.titleData.copydata(t),this.updateTitlePropertyAdd(),E.E.ins.event(T.EventName.TITLE_SHOW_CHANGED)},t.prototype.onFashionTimeOverBack=function(t){var e=t.reservedata[0],i=t.reservedata[1];if(t.opresult)this.timeOver(e,i);else{var n=t.reservedata[2];1==n||2==n?this.timeOver(e,i):3==n&&Laya.timer.once(6e4,this,this.requestTimeOver,[e,i])}},t.prototype.onFashionOperationBack=function(t){if(t.opresult){var e=t.reservedata[0],i=t.reservedata[1],n=L.GameConfig.fashionJson[i],s=A.RoleCenter.instans.vo.getOpenHeroByIdx(e);if(i&&s){var o=s.fashionData,a=o.curFashion,r=-1;if(t.msgidx==g.enumOpResultType.fashion_activate||t.msgidx==g.enumOpResultType.fashion_activateAndPuton){var l=t.reservedata[2];-1==(r=o.fashionArr.indexOf(i))?(o.fashionArr.push(i),o.fashionLvArr.push(0),o.endTimeArr.push(l),r=o.endTimeArr.length-1,A.RoleCenter.instans.vo.chgItemCount(n.itemId,-1)):o.endTimeArr[r]=l;var h=l-v.ServerTime.serverTime;0<h&&h<28800&&Laya.timer.once(1e3*(h+10),this,this.requestTimeOver,[e,i])}if(t.msgidx==g.enumOpResultType.fashion_putoff&&-1!=(r=a.indexOf(i))&&a.splice(r,1),t.msgidx==g.enumOpResultType.fashion_puton||t.msgidx==g.enumOpResultType.fashion_activateAndPuton){for(var c=n.position,u=a.length,p=0;p<u;){var d=!0;(n=L.GameConfig.fashionJson[a[p]])&&n.position!=c&&(d=!1),d&&a.splice(p,1),p++}a.push(i)}this.updatePropertyAdd(e),E.E.ins.event(T.EventName.FASHION_STATE_CHANGED,e)}}},t.prototype.onFashionUp=function(t){var e=A.RoleCenter.instans.vo,i=e.getOpenHeroByIdx(t.heroidx),n=i.fashionData,s=n.fashionArr.indexOf(t.fashtionId);-1!=s&&(n.fashionLvArr[s]=t.curLv);var o=e.combat;r.sbkPropTool.resetFashion(i),e.reCheckComBat(),A.RoleCenter.instans.event(T.EventName.FIGHT_UP,e.combat-o),this.updateFashionRed(),E.E.ins.event(T.EventName.FASHION_RED_NUM_CHANGED)},t.prototype.updatePropertyAdd=function(t){var e=A.RoleCenter.instans.vo,i=e.combat;r.sbkPropTool.resetFashion(e.getOpenHeroByIdx(t)),e.reCheckComBat(),A.RoleCenter.instans.event(T.EventName.FIGHT_UP,e.combat-i)},t.prototype.updateTitlePropertyAdd=function(){var t=A.RoleCenter.instans.vo,e=t.prop_chengHao;e.reset();for(var i=t.titleData.titleArr,n=i.length,s=0;s<n;){var o=L.GameConfig.titleJSON[i[s]];o&&r.sbkPropTool.reSetProp(e,o.prop,!1),s++}var a=t.combat;t.reCheckComBat(),A.RoleCenter.instans.event(T.EventName.FIGHT_UP,t.combat-a)},t.prototype.initTimers=function(){for(var t=0;t<3;t++){var e=A.RoleCenter.instans.vo.getOpenHeroByIdx(t);if(e&&e.fashionData)for(var i=e.fashionData.endTimeArr.length,n=0;n<i;){var s=e.fashionData.fashionArr[n],o=e.fashionData.endTimeArr[n]-v.ServerTime.serverTime;0<o&&o<28800&&Laya.timer.once(1e3*(o+10),this,this.requestTimeOver,[t,s]),n++}}},t.prototype.requestTimeOver=function(t,e){var i=A.RoleCenter.instans.vo.getOpenHeroByIdx(t);if(i&&i.fashionData){var n=i.fashionData.fashionArr.indexOf(e);if(-1!=n)if(i.fashionData.endTimeArr[n]-v.ServerTime.serverTime<10){var s=new l.FashionC2GS;s.msgidx=g.enumOpResultType.fashion_over,s.fashtionId=e,s.heroidx=t,o.GSM.sendServer(s)}}},t.prototype.timeOver=function(t,e){var i=A.RoleCenter.instans.vo.getOpenHeroByIdx(t);if(i){var n=i.fashionData,s=n.fashionArr.indexOf(e);if(-1!=s)if(n.endTimeArr[s]-v.ServerTime.serverTime<10){n.fashionArr.splice(s,1),n.endTimeArr.splice(s,1);var o=n.curFashion.indexOf(e);-1!=o&&n.curFashion.splice(o,1),this.updatePropertyAdd(t),this.updateFashionRed(),E.E.ins.event(T.EventName.FASHION_STATE_CHANGED,t)}}},t.prototype.onItemCountChanaged=function(t){for(var e in L.GameConfig.fashionJson)if(L.GameConfig.fashionJson[e].itemId==t){this.updateFashionRed(),s.RedDot_Dress.Ins.checkDress(),E.E.ins.event(a.EventRedDot.REFRESH_EQUIP),E.E.ins.event(a.EventRedDot.REFRESH_ROLE);break}},t.prototype.updateFashionRed=function(){for(var t=[0,0,0],e=[],i=[1,256,65536],n=A.RoleCenter.instans.vo,s=n.bagdata,o=n.heronum,a=L.GameConfig.fashionJson,r=P.sbkBagVo.getItemArrByType(k.BagItemType.shizhuang),l=r.length,h=0;h<o;h++){for(var c=n.getOpenHeroByIdx(h),u=c.fashionData,p=t[h],d=0;d<l;d++){var g=r[d],v=R.FashionVo.getIdByItemId(g),f=a[v].position,y=u.fashionArr.indexOf(v),m=!1;if(-1==y)m=!0;else{var _=u.fashionLvArr[y],C=L.GameConfig.fashionstar[v+"_"+(_+1)];if(C){var I=C.cost,b=0<I.length?+I[0][0]:0,w=L.GameConfig.fashionJson[b];w&&w.position==f&&s.getItemCount(b)>=I[0][1]&&(m=!0)}}var S=f-1;m&&(f==D.FashionPos.WEAPON||f==D.FashionPos.GODWEAPON?f=D.FashionPos.WEAPON:f!=D.FashionPos.WING&&f!=D.FashionPos.DRAGONWING||(f=D.FashionPos.WING),p+=i[S]),e[S]=m||e[S]}t[h]=p,c.redFashionNum=p}x.NewRedHintsCenter.ins.setRedHintOpenOrClose(x.enumRedHints.fashionDress,e[D.FashionPos.FASHION-1]),x.NewRedHintsCenter.ins.setRedHintOpenOrClose(x.enumRedHints.fashionWeapon,e[D.FashionPos.WEAPON-1]),x.NewRedHintsCenter.ins.setRedHintOpenOrClose(x.enumRedHints.fashionWing,e[D.FashionPos.WING-1]),E.E.ins.event(T.EventName.FASHION_RED_NUM_CHANGED)},t}();e.DressViewCtrl=u}),define("src/g/rechristen/view/RechristenView",["require","exports","../../../core/E","../../../enum/EventName"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return i.E.ins.on(n.EventName.CLOSERECHRISTEN,t,t.closeHander),t.btn_close.on(Laya.Event.CLICK,t,t.closeHander),t}return __extends(t,e),t.prototype.closeHander=function(){this.newname.text="",this.close()},t}(ui.rechristen.RechristenViewUI);e.RechristenView=s}),define("src/g/rechristen/ctrl/rechristenCtrl",["require","exports","src/g/rechristen/view/RechristenView","../../../utils/system/FloatEffect","../../../manager/GameSocketManager","../../../plugin/view/ToolTip","src/init/Switches","../../net/messages/CreateUserC2GS","../../net/messages/UserFamilyDataGS2C","../../../manager/RoleCenter","../../../utils/StringUtils","../../net/messages/ManageFamilyMsg","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(){}return t.prototype.init=function(){a.Switches.ins.on(123,this,this.openView1),a.Switches.ins.on(219,this,this.openView2)},t.prototype.openView1=function(){this.voData=new r.chgNicknameC2GS,this.openView(),this._view.btn_ok.offAll(Laya.Event.CLICK),this._view.btn_ok.on(Laya.Event.CLICK,this,this.onBtnStartGame),this._view.tip_txt.text=p.TextConst.get(693)},t.prototype.openView2=function(){this.voData=new l.FamilyNameChgC2GS,this.voData.fuid=h.RoleCenter.instans.vo.ufVo._ufdata.familyUId,this.openView(),this._view.btn_ok.offAll(Laya.Event.CLICK),this._view.btn_ok.on(Laya.Event.CLICK,this,this.onBtnStartGame1),this._view.tip_txt.text=p.TextConst.get(694)},t.prototype.openView=function(){this._view||(this._view=new i.RechristenView),this._view.popup()},t.prototype.onBtnStartGame=function(){for(var t=this._view.newname.text,e=0;e<t.length;e++){var i=t.charAt(e);if(-1!="<>{}[]'~!@#$%^&*()=+/-\\ ".indexOf(i))return void n.FE.upItems(p.TextConst.get(695),o.BubbleEnum.center)}6<this._view.newname.text.length?n.FE.upItems(p.TextConst.get(350,6),o.BubbleEnum.center):this._view.newname.text.length<2?n.FE.upItems(p.TextConst.get(351,2),o.BubbleEnum.center):(this.voData.nickname=this._view.newname.text,s.GSM.sendServer(this.voData))},t.prototype.onBtnStartGame1=function(){if(h.RoleCenter.instans.ufVo&&h.RoleCenter.instans.ufVo.selfFamily)for(var t=h.RoleCenter.instans.ufVo.familyInfo,e=0;e<t.memberlist.length;e++){var i=t.memberlist[e];if(i.familyPosition==u.EFPosition.CHAIRMAN&&i.username==h.RoleCenter.instans.vo.username)return c.StringUtils.checkString(this._view.newname.text)?void 0:(this.voData.newname=this._view.newname.text,void s.GSM.sendServer(this.voData))}n.FE.upItems(p.TextConst.get(697),o.BubbleEnum.center)},t}();e.RechristenCtrl=d}),define("src/g/fight/osprite/obj/SkillUnit",["require","exports","src/g/fight/osprite/obj/BaseSprite","../../../../component/GEffectAnimation","../../../../utils/ItemUtils","src/g/fight/base/RES","../../../../manager/LayerManager","src/g/fight/osprite/SceneObjManager","src/g/fight/osprite/SceneObjCtroller","../../../../component/GAnimationManager","../../../net/messages/UserAttackMsg"],function(t,e,i,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(i){function t(t){var e=i.call(this)||this;return e._skillId=t,e}return __extends(t,i),t.prototype.fire=function(t,e){var i=h.ItemUtils.getSkillVoById(this._skillId);if(i.sdur1){this.skillEffect=g.GAnimationManager.getInstance().create();var n=c.RES.getSdurl(i.sdur1,this.face);if(this.skillEffect.setCount(3),this.skillEffect.load(n),this.skillEffect.scale(i.sdur0Rate,i.sdur0Rate),this.skillEffect.once(l.GEffectAnimation.PLAY_COMPLETE,this,this.onPlayComplete),u.LayerManager.fightLayer.roleLayer.addChild(this.skillEffect),p.SceneObjManager.instans.regObject(this),this.setMapXY(t,e),this.skillEffect.zOrder=e,d.SceneObjCtroller.ins.getSelfGroup()&&d.SceneObjCtroller.ins.getSelfGroup()._targetFG)for(var s=d.SceneObjCtroller.ins.getSelfGroup()._targetFG.getFUList(),o=s?s.length:0,a=0;a<o;){var r=s[a].getMapPos();if(new Laya.Point(t,e).distance(r[0],r[1])<80&&(s[a].floatBlood(-1e4,1,v.ESkillRes.NULL,v.ESkillRes.NULL),"6"!=i.target))break;a++}}},t.prototype.onPlayComplete=function(){p.SceneObjManager.instans.unregObject(this),this.skillEffect.removeSelf(),this.skillEffect=null},t.prototype.frameMove=function(t){this.updatePoint(),this.skillEffect&&(this.skillEffect.x=this.gridX,this.skillEffect.y=this.gridY)},t}(i.BaseSprite);e.SkillUnit=n}),define("src/g/skill/ctrl/ContinuedAttkSkillCtrl",["require","exports","src/g/fight/osprite/map/MainCamera","src/g/fight/osprite/obj/SkillUnit","src/g/fight/osprite/GameScene","../../../core/E","../../../enum/EventName"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.prototype.init=function(){o.E.ins.on(a.EventName.OPEN_CONTINUED_SKILL,this,this.startFire),o.E.ins.on(a.EventName.CLOSE_CONTINUED_SKILL,this,this.stopFire)},t.prototype.startFire=function(){s.GameScene.ins.map.mouseInputLayer.on(laya.events.Event.CLICK,this,this.onCSkillFireHandler)},t.prototype.stopFire=function(){s.GameScene.ins.map.mouseInputLayer.off(laya.events.Event.CLICK,this,this.onCSkillFireHandler)},t.prototype.onCSkillFireHandler=function(t){var e=i.MainCamera.ins.stageToMap(new Laya.Point(t.stageX,t.stageY));new n.SkillUnit(6).fire(e.x,e.y)},t}();e.ContinuedAttkSkillCtrl=r}),define("src/g/copy/view/climbtower/PagodaDailyRewardDlg",["require","exports","../../../../utils/ItemCellUtils","../../../../core/E","../../../../enum/EventName"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.btn_get.on(Laya.Event.CLICK,t,t.getRewardHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderItemHandler),t.closeHandler=new Laya.Handler(t,t.onGetRewardHandler),t.bg.btn_back.visible=t.bg.btn_close.visible=!1,t}return __extends(t,e),t.prototype.showReward=function(t){this._reward=t;var e=0,i=[];for(e=0;e<t.currencyList.length;e++){var n=t.currencyList[e];i.push([n.key,n.val])}for(e=0;e<t.itemList.length;e+=2)for(var s=t.itemList[e],o=t.itemList[e+1],a=0;a<o;)i.push([s,1]),a++;for(e=0;e<t.equipList.length;e++)i.push([t.equipList[e].equtemplet,1]);for(e=0;e<t.zhanwenList.length;e++)i.push([t.zhanwenList[e].cfgId,1]);this.list_item.array=i,this.popup()},t.prototype.getRewardHandler=function(){this.close()},t.prototype.onGetRewardHandler=function(){n.E.ins.event(s.EventName.GET_PAGODA_DAILY_REWARD,this._reward),this._reward=null},t.prototype.onRenderItemHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t}(ui.copy.PagodaDailyRewardDlgUI);e.PagodaDailyRewardDlg=o}),define("src/g/copy/view/climbtower/PagodaRankDlg",["require","exports","../../../../core/GNet","../../../net/messages/rank/sbkRankDataBase","../../../../manager/GameSocketManager","../../../net/messages/rank/RankDataGS2C","../../../../manager/RoleCenter","../../../../utils/ItemUtils","../../../../utils/UIUtils","src/init/TextConst"],function(t,e,n,s,i,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t.list_rank.renderHandler=new Laya.Handler(t,t.onRenderListHandler),t.list_rank.array=[],i.GSM.ins.on(o.RankDataGS2C.KEY,t,t.resultHandler),t}return __extends(t,e),t.prototype.showView=function(){n.GNet.getRankList(s.enumRankID.rankid_11,1,100);var t=a.RoleCenter.instans.vo.portPagoda.secPortId,e=(t-25e3)/10+1>>0,i=(t-25e3)%10>>0;0==i&&(e--,i=10),this.lab_myport.changeText(h.TextConst.get(335,e,i)),this.popup()},t.prototype.resultHandler=function(t){if(t.opresult&&t.rankIdArr[0]==s.enumRankID.rankid_11){this.list_rank.array=t.rankDataArr;var e=t.rankIdArr[2];100<e?this.lab_myrank.changeText(h.TextConst.get(223)):(e+=1,this.lab_myrank.changeText(e+""))}},t.prototype.onRenderListHandler=function(t,e){var i=t.dataSource;t.lab_rank.changeText((e+1).toString()),t.lab_name.changeText(i.nickname),window.enabledpay&&(t.imgVip.skin=r.ItemUtils.getVipIconByLevel(i.vipLv),l.UIUtils.nameAndVipDisplay(t.imgVip,t.lab_name));var n=i.value1,s=(n-25e3)/10+1>>0,o=(n-25e3)%10>>0;0==o&&(s--,o=10),t.lab_port.changeText(h.TextConst.get(335,s,o))},t}(ui.copy.PagodaRankDlgUI);e.PagodaRankDlg=c}),define("src/g/copy/view/climbtower/ClimbTowerView",["require","exports","../../../../core/E","../../../../enum/EventName","../../../../config/GameConfig","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../manager/RoleCenter","../../../net/messages/PortChuangGS2C","../../../../manager/GameSocketManager","src/g/fight/info/PlayTypeVo","../../../../manager/LayerManager","../../../net/messages/ChangeSceneMsg","../../../net/messages/OpNoParaC2GS","src/g/copy/view/climbtower/PagodaDailyRewardDlg","src/g/copy/view/climbtower/PagodaRankDlg","../../../net/messages/rank/RankDataGS2C","../../../net/messages/rank/sbkRankDataBase","../../../../core/GNet","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../enum/GuideTargetName","../../../../utils/ItemUtils","../../../../utils/UIUtils","src/g/clearRes/ClearResM","src/init/TextConst"],function(t,e,i,n,l,h,c,s,o,a,r,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var T=function(e){function t(){var t=e.call(this)||this;return t._colorArr=["#127e00","#fa0c0c","#727272"],t._layerYArr=[444,372,301,236,166,103],t.btn_turntable.on(Laya.Event.CLICK,t,t.turnHandler),t.btn_fight.on(Laya.Event.CLICK,t,t.onToFightHandler),i.E.ins.on(n.EventName.PAGODA_DATA_CHANGED,t,t.onDataChanagedHandler),t.btn_dayreward.on(Laya.Event.CLICK,t,t.onOpenDailyRewardHandler),a.GSM.ins.on(o.DayBonusPagodaGS2C.KEY,t,t.onGetDayBonus),t.btn_rank.on(Laya.Event.CLICK,t,t.openRankView),a.GSM.ins.on(f.RankDataGS2C.KEY,t,t.rankHandler),i.E.ins.on(n.EventName.PAGODA_TO_FIGHT,t,t.outterToFight),t}return __extends(t,e),t.prototype.outterToFight=function(){this.displayedInStage&&this.onToFightHandler()},t.prototype.rankHandler=function(t){if(t.opresult&&this.displayedInStage&&t.rankIdArr[0]==y.enumRankID.rankid_11)for(var e,i,n,s,o=t.rankDataArr.length,a=0;a<3;){if(e=this["lab_rank_name"+a],i=this["lab_rank_port"+a],s=this["imgVip"+a],n=this["nameBox"+a],a<o){if(n&&(n.visible=!0,e.changeText(t.rankDataArr[a].nickname),window.enabledpay&&(s.skin=b.ItemUtils.getVipIconByLevel(t.rankDataArr[a].vipLv),w.UIUtils.nameAndVipDisplay(s,e))),i){i.visible=!0;var r=(t.rankDataArr[a].value1-25e3)/10+1>>0,l=(t.rankDataArr[a].value1-25e3)%10>>0;0==l&&(r--,l=10),i.changeText(E.TextConst.get(332,r,l))}}else n&&(n.visible=!1),i&&(i.visible=!1);a++}},t.prototype.openRankView=function(){this._rankView||(this._rankView=new v.PagodaRankDlg),this._rankView.showView()},t.prototype.onDataChanagedHandler=function(){this.displayedInStage&&this.refreshData()},t.prototype.turnHandler=function(){i.E.ins.event(n.EventName.OPENTURNTABLE)},t.prototype.setCurrId=function(t){if(this._currId!=t){this._currId=t;var e=(this._currId-25e3)/10+1>>0,i=(this._currId-25e3)%10>>0;0==i&&(e--,i=10),this.setCurrRound(e),this.setCurrLayer(i),this.layer_title.changeText(this._currRound.toString()),this.layer_title2.changeText(this._currLayer.toString())}},t.prototype.setCurrRound=function(t){if(this._currRound!=t){this._currRound=t;for(var e,i,n,s=l.GameConfig.pagodaJson[this._currRound],o=s?s.specialReward.length:0,a=0,r=(267-97*o)/2;a<3;)(e=this["round_reward"+a])&&(e.offAll(),a<o?(i=s.specialReward[a][0],n=Number(s.specialReward[a][1]),h.ItemCellUtils.fillCellForItemNameView(e,i,n),e.on(laya.events.Event.CLICK,this,function(t,e){c.ItemTips.ins.showTip(t,e)},[i,n]),e.visible=!0,e.x=r,r+=97):e.visible=!1),a++}},t.prototype.setCurrLayer=function(t){if(this._currLayer!=t){this._currLayer=t,this.lab_reward_curr.changeText(E.TextConst.get(333,this._currRound,this._currLayer));for(var e=this._currLayer<5?this._currLayer:this._currLayer-4,i=1;i<=6;)this["layer"+i].stroke=0,i<e?this["layer"+i].color=this._colorArr[2]:e<i?this["layer"+i].color=this._colorArr[0]:i==e&&(this["layer"+i].color=this._colorArr[1],this["layer"+i].stroke=1,this["layer"+i].strokeColor="#3c0d00"),i++;this.ligth_icon.y=this._layerYArr[e-1],this._currLayer<5?(this.layer1.changeText(E.TextConst.get(14,1)),this.layer2.changeText(E.TextConst.get(14,2)),this.layer3.changeText(E.TextConst.get(14,3)),this.layer4.changeText(E.TextConst.get(14,4)),this.layer5.changeText(E.TextConst.get(14,5)),this.layer6.changeText(E.TextConst.get(14,6))):(this.layer1.changeText(E.TextConst.get(14,5)),this.layer2.changeText(E.TextConst.get(14,6)),this.layer3.changeText(E.TextConst.get(14,7)),this.layer4.changeText(E.TextConst.get(14,8)),this.layer5.changeText(E.TextConst.get(14,9)),this.layer6.changeText(E.TextConst.get(14,10)))}},t.prototype.onToFightHandler=function(){var t=0;l.GameConfig.pagodaLayerJson[this._currId+1]&&(i.E.ins.event(n.EventName.COMPTYPE_CLICK,I.GuideTargetName.CLIMD_TOWER_BTN_FIGHT),t=this._currId+1,i.E.ins.event(n.EventName.PLAY_TYPE_CHANGE,r.PlayTypeVo.create(p.EPlayType.PLAYTYPE_PAGODA,{chuangId:this._currId,portId:t})),u.LayerManager.closeAllPOPWindow())},t.prototype.showView=function(){m.GNet.getRankList(y.enumRankID.rankid_11,1,3),this.refreshData(),this.visible=!0,S.ClearResM.addBgUrl(this.bgimg.skin),this.bgimg.restskin(),S.ClearResM.resetViewImg(this),i.E.ins.on(n.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){i.E.ins.off(n.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),S.ClearResM.clearResFolder("climbtower/")},t.prototype.refreshData=function(){var t=s.RoleCenter.instans.vo.portPagoda;this.setCurrId(t.secPortId),this.lab_dayreward.changeText(0<t.lastDayBonus?E.TextConst.get(216):E.TextConst.get(944))},t.prototype.onOpenDailyRewardHandler=function(){if(0<s.RoleCenter.instans.vo.portPagoda.lastDayBonus){var t=new d.OpNoParaC2GS;t.optype=d.EOpNopara.getPagodaDayBonus,a.GSM.sendServer(t)}else _.FE.upItems(E.TextConst.get(945),C.BubbleEnum.center)},t.prototype.onGetDayBonus=function(t){this.displayedInStage&&(this._rewardDlg||(this._rewardDlg=new g.PagodaDailyRewardDlg),this._rewardDlg.showReward(t.reward))},t}(ui.copy.ClimbTowerUI);e.ClimbTowerView=T}),define("src/g/copy/view/expcopy/EXPAttributeCardView",["require","exports","../../../../utils/ItemUtils"],function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.list.renderHandler=new Laya.Handler(t,t.onRenderHandler),t}return __extends(t,e),t.prototype.showView=function(t){this.popup(),this.list.array=t},t.prototype.onRenderHandler=function(t,e){var i=this.list.array[e];t.image_bg.skin=i.imagc,this.list.selectedIndex==e?t.imge_select.visible=!0:t.imge_select.visible=!1;var n=s.ItemUtils.getBuffVoById(i.prop);n&&(i.isShowPercentage?t.fontClip_value.value=n.ext[0]+"%":t.fontClip_value.value=n.ext[0])},t}(ui.copy.expCopy.EXPAttributeCardViewUI);e.EXPAttributeCardView=i}),define("src/g/copy/ctrl/EXPAttributeCardViewCtrl",["require","exports","src/g/copy/ExpCopyManager","src/init/TextConst"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this._leftTime=5e3,this._key=!1}return t.prototype.init=function(){},t.prototype.update=function(){if(this._key){if(this._leftTime-=Laya.timer.delta,this._leftTime<0)return this._leftTime=0,this._key=!1,void this.closePanel();this._view.text_leftTime.text=n.TextConst.get(13,Math.ceil(this._leftTime/1e3))}},t.prototype.closePanel=function(){this._view&&(this._view.close(),this._view.destroy(),this._view=null),i.ExpCopyManager.getInstance().expCardCtrl=null},t.prototype.srvSelect=function(t){},t}();e.EXPAttributeCardViewCtrl=s}),define("src/g/copy/view/expcopy/ExpCopyMainView",["require","exports","../../../../manager/LayerManager"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.mouseThrough=!0,t.width=Laya.stage.width,t.height=Laya.stage.height,t}return __extends(t,e),t.prototype.showView=function(){i.LayerManager.addInUILayer(this)},t}(ui.copy.turntable.ExpCopyMainViewUI);e.ExpCopyMainView=n}),define("src/g/index/ctrl/AutoSkillBtnCtrl",["require","exports","../../../manager/RoleCenter","../../../core/E","../../../enum/EventName","../../../manager/LayerManager","src/g/accessctrl/AccessCenter"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.setPos=function(t,e,i){this.vo=i,a.AccessCenter.ins.checkOpen(64,!1)?(this._view||(this._view=new ui.components.AutoSkillBtnUI,this._view.btn_auto.on(Laya.Event.CLICK,this,this.autoHandler),this._view.btn_close.on(Laya.Event.CLICK,this,this.closeHandler)),this._view.x=t-this._view.width,this._view.y=e,this._view.btn_close.visible=!0,this._view.btn_close.restskin(),o.LayerManager.fightLayer.addChild(this._view),this.resetBtn()):this.vo=null},t.autoSkill=function(t){if(!(Date.now()-this._starttime<2e3)&&this.vo&&this.vo.autoCombo){var e=i.RoleCenter.instans.vo.comboData.comboSkill;if(!a.AccessCenter.ins.checkOpen(64,!0))return;n.E.ins.event(s.EventName.RELEASESKILL,e[t]),this._starttime=Date.now()}},t.resetBtn=function(){this.vo.autoCombo?this._view.btn_auto.visible=!0:this._view.btn_auto.visible=!1},t.closeHandler=function(){this.vo.autoCombo=1,this.resetBtn()},t.autoHandler=function(){this.vo.autoCombo=0,this.resetBtn()},t.removeSkill=function(){this._view&&this._view.removeSelf()},t._starttime=0,t}();e.AutoSkillBtnCtrl=r}),define("src/g/copy/view/expcopy/ExpSkillBuffDialogCtrl",["require","exports","src/init/Switches","src/g/clearRes/ClearResM"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.getInstance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.showView=function(t,e){switch(void 0===e&&(e=null),window.enabledpay||(t=4),null==this._view&&(this._view=new ui.copy.expCopy.ExpCopySkillBuffDialogUI,this._view.bg.btn_close.visible=this._view.bg.btn_back.visible=!1,this._view.bg.imgInnerBg.bottom=96,this._view.bg.img_title.skin="res/unpack/gongnengjihuo.png",this._view.imgGround.skin="res/bg/YOMHZHEGE.png",this._view.btn_free.on(Laya.Event.CLICK,this,this.onFreeHandler),this._view.btn_activation.on(Laya.Event.CLICK,this,this.onActivationHandler),this._view.btn_enter.on(Laya.Event.CLICK,this,this.onEnterHandler),this._view.btn_monthCard.on(Laya.Event.CLICK,this,this.onMonthCardHandler)),this._view.closeHandler=e,t){case 1:this._view.label_free.visible=this._view.btn_free.visible=!1,this._view.label_activation.visible=this._view.btn_activation.visible=!1,this._view.btn_enter.visible=!0,this._view.label_monthCard.visible=this._view.btn_monthCard.visible=!0;break;case 2:this._view.label_free.visible=this._view.btn_free.visible=!0,this._view.label_activation.visible=this._view.btn_activation.visible=!1,this._view.btn_enter.visible=!1,this._view.label_monthCard.visible=this._view.btn_monthCard.visible=!1;break;case 3:this._view.label_free.visible=this._view.btn_free.visible=!1,this._view.label_activation.visible=this._view.btn_activation.visible=!0,this._view.btn_enter.visible=!1,this._view.label_monthCard.visible=this._view.btn_monthCard.visible=!1;break;case 4:return this._view.popup(),n.ClearResM.resetViewImg(this._view),void this.onEnterHandler()}this._view.popup(),n.ClearResM.resetViewImg(this._view)},t.prototype.hideView=function(){this._callHandler&&(this._callHandler=null),this._view&&(this._view.close(),this._view=null)},t.prototype.onFreeHandler=function(){this._callHandler&&(this._callHandler.run(),this._callHandler=null),this.hideView()},t.prototype.onActivationHandler=function(){i.Switches.ins.event(12),this._view&&(this._view.closeHandler=null),this.hideView()},t.prototype.onEnterHandler=function(){this._callHandler&&(this._callHandler.run(),this._callHandler=null),this.hideView()},t.prototype.onMonthCardHandler=function(){i.Switches.ins.event(12),this._view&&(this._view.closeHandler=null),this.hideView()},t._instance=null,t}();e.ExpSkillBuffDialogCtrl=s}),define("src/g/copy/ctrl/ExpCopyMainViewCtrl",["require","exports","src/g/copy/view/expcopy/ExpCopyMainView","../../../core/E","../../../enum/EventName","src/g/copy/ExpCopyManager","../../../utils/system/ServerTime","src/g/Effects/UIEffectsFactory","src/g/copy/view/expcopy/ExpSkillBuffDialogCtrl","src/g/guide/view/GuideTipDownView","../../../component/UDEffect","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(){function t(){this._upStr="+{0}%",this._currExp=0,this._startTime=0,this._showTimeKey=!1,this._countDownTime=100,this._imageList=[],this._callHandler=null,this._UDEffect=new c.UDEffect}return t.prototype.init=function(){n.E.ins.on(s.EventName.EXP_COPY_MAINVIEW,this,this.openPanel)},t.prototype.openPanel=function(){this._view||(this._view=new i.ExpCopyMainView,Laya.timer.frameLoop(10,this,this.update),this._view.img_noActivation.on(Laya.Event.CLICK,this,this.showBuffDialog)),this._view.showView(),this._view.box.visible=!1,this._view.leftBox.visible=!1,this._view.box_time.visible=!0,this._view.box.x=(Laya.stage.width-this._view.box.width)/2,(o.ExpCopyManager.getInstance().mainViewCtrl=this).updateTotalExp(o.ExpCopyManager.getInstance().getTotalExp()),this.updateRoundTime(o.ExpCopyManager.getInstance().getRoundTime()),this._currExp=0,this._countDownTime=o.ExpCopyManager.getInstance().getExpSetting().gametime,this.updateGameTime(this._countDownTime),this.updateUI()},t.prototype.showGuideArrow=function(t){window.enabledpay?(this._callHandler=t,this._view&&(this._view.leftBox.visible=window.enabledpay,this.addGuideArrow(this._view.noActivationBox))):t.run()},t.prototype.addGuideArrow=function(t,e){void 0===e&&(e=!0),this._ani&&(this._ani.clear(),this._ani=null),this._ani=r.UIEffectsFactory.Ins.createSAniById(24),r.UIEffectsFactory.Ins.centerSAni4Parent(this._ani,t),e&&(this._downview||(this._downview=new h.GuideTipDownView,this._downview.setTip(u.TextConst.get(331)),this._downview.x=t.width/2,this._downview.y=t.height/2-50),t.addChild(this._downview),this._UDEffect.effect(this._downview,20,300))},t.prototype.removeGuideArrow=function(){this._downview&&(this._downview.removeSelf(),this._downview=null),this._ani&&(this._ani.removeSelf(),this._ani=null),this._UDEffect.clear()},t.prototype.showBuffDialog=function(){this._callHandler?(this.removeGuideArrow(),l.ExpSkillBuffDialogCtrl.getInstance().showView(2,this._callHandler),this._callHandler=null):l.ExpSkillBuffDialogCtrl.getInstance().showView(3)},t.prototype.updateStartCountTime=function(t){this._view&&(this._view.font_time.value=Math.ceil(t/1e3).toString())},t.prototype.update=function(){if(this._showTimeKey){var t=this._countDownTime-Math.ceil(a.ServerTime.serverTime-this._startTime);t<0&&(t=0),this.updateGameTime(t)}},t.prototype.updateUI=function(){var t=o.ExpCopyManager.getInstance().currBuffId;if(this._view){var e=o.ExpCopyManager.getInstance().findBuff(t);this._view.noActivationBox.visible=e?(console.debug("怒气值回复率："+e.nuqiProp),!(this._view.activationBox.visible=!0)):!(this._view.activationBox.visible=!1)}},t.prototype.updateTotalExp=function(t){this._currExp=t,this.updateExp()},t.prototype.updateExp=function(){this._view&&(this._view.fontClip_exp.value=this._currExp.toString())},t.prototype.startTime=function(){this._showTimeKey=!0,this._startTime=a.ServerTime.serverTime,this._view&&(this._view.box_time.visible=!1,this._view.box.visible=!0,this._view.leftBox.visible=window.enabledpay)},t.prototype.updateGameTime=function(t){this._view&&(this._view.text_gameTime.value=t.toString())},t.prototype.updateRoundTime=function(t){this._view&&(this._view.text_roundTime.value=t.toString())},t.prototype.hideExpCopy=function(){this.removeGuideArrow(),this._view&&(this._view.removeSelf(),this._view.destroy(),this._view=null,Laya.timer.clear(this,this.update))},t.prototype.getIconByType=function(t){return window.sbkgame.CurrencyIcon(t)},t}();e.ExpCopyMainViewCtrl=p}),define("src/g/fight/osprite/play/GamePlaySvrBase",["require","exports","src/g/fight/osprite/play/GamePlay","../../../../manager/GameSocketManager","../../../net/messages/UserAttackGroupMsg","../../../net/messages/MonsterHPChgGS2C","src/g/fight/osprite/obj/FightGroup","src/g/index/ctrl/BtnSkiilCtrl","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../core/E","../../../../enum/EventName","../../../../utils/system/ServerTime","src/g/fight/osprite/SceneObjCtroller","../../../net/messages/UserAttackMsg","src/init/TextConst"],function(t,e,i,s,o,a,r,c,u,p,l,h,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t){var e=n.call(this,t)||this;e._monsterGroup=new r.FightGroup(null),e._msgList=[],e._msgSequenceList=[],e._allMsgSequenceList=[],e._delayKey=!1,e._delayStartTime=0,e._delayTime=1,e._currMsg=null,e._pet=null,e._contactMaxSequenceLen=40,e._contactMaxMonster=15,e._totalHurtValue=0,e.comboHitRageUpdate=!0,e._endCallHandler=new Laya.Handler(e,e.actionCompleteHandler),e._startCallHandler=new Laya.Handler(e,e.actionStartHandler);var i=s.GSM.ins;return i.on(o.UserAttackGroupGS2C.KEY,e,e.onAttackMonGroup),i.on(o.ComboHitGroupGS2C.KEY,e,e.onComboHitGroupGS2C),i.on(a.MonsterHPChgGS2C.KEY,e,e.onMonsterHPChgGS2C),e._totalHurtValue=0,e}return __extends(t,n),t.prototype.frameMove=function(){null!=this._mainRole&&0<this._msgSequenceList.length&&!this._delayKey&&(0!=this._count&&1!=this._mainRole.action||this.runOneInfo()),this._delayKey&&d.ServerTime.serverTime-this._delayStartTime>this._delayTime&&this.endDelay()},t.prototype.roleUseNewFrame=function(t){var e=this._fightGroup;if(e)for(var i=e.getFUList(),n=0;n<i.length;n++)i[n].newSkillKey=t},t.prototype.clear=function(){n.prototype.clear.call(this),s.GSM.ins.off(o.UserAttackGroupGS2C.KEY,this,this.onAttackMonGroup),s.GSM.ins.off(o.ComboHitGroupGS2C.KEY,this,this.onComboHitGroupGS2C),s.GSM.ins.off(a.MonsterHPChgGS2C.KEY,this,this.onMonsterHPChgGS2C),this.roleUseNewFrame(!1)},t.prototype.initHeroGroup=function(){console.log("GamePlaySvrBase::initHeroGroup");var t=g.SceneObjCtroller.ins.getSelfGroup();t.resetFightGroup(this.mapVo.startPoint[0]),t.addToFightLayer(),this.setFightGroup(t),this._pet=this._fightGroup.getPet(),this._pet&&(this._pet.setFightTarget(null),this._pet.status=1),this.roleUseNewFrame(!0)},t.prototype.onMonsterArrayAppear=function(t,e){if(void 0===e&&(e=!1),!e&&this.isHaveAttack())return this._msgList.push(t),this._msgSequenceList.push(4),this._allMsgSequenceList.push(4),!1;this.doMonsterArrayAppear(t)},t.prototype.doMonsterArrayAppear=function(t){},t.prototype.onFightEndHandler=function(t,e){if(void 0===e&&(e=!1),!e&&this.isHaveAttack())return this._msgList.push(t),this._msgSequenceList.push(5),this._allMsgSequenceList.push(5),!1;this.doFightEndHandler(t)},t.prototype.doFightEndHandler=function(t){},t.prototype.createMonsterByMonsterAppearExpCopyGS2C=function(t,e){if(void 0===e&&(e=!1),!e&&this.isHaveAttack())return this._msgList.push(t),this._msgSequenceList.push(2),this._allMsgSequenceList.push(2),!1;for(var i=t.monsterArr,n=0,s=-1,o=0;o<i.length;o++)n=i[o],s=t.monsterUidArr[o],this.createMonster(this._monsterGroup,n,s);return this._monsterGroup.addToFightLayer(),!0},t.prototype.onAttackMonGroup=function(t){this._msgList.push(t),this._msgSequenceList.push(1),this._allMsgSequenceList.push(1),0==this.comboHitRageUpdate&&(c.BtnSkiilCtrl.ins.progressValue(t.rageVal),this.autoSkill(t))},t.prototype.actionStartHandler=function(t){if(null==this._currMsg&&0<this._msgList.length){var e=this._currMsg=this.getAttackInfo();if(e){for(var i=this._monsterDic,n=e.heroAttack,s=0;s<n.length;s++){var o=this._fightGroup.getUnitByIndex(s);if(o)for(var a=n[s],r=0;r<a.beAttackUid.length;r++){var l=i[a.beAttackUid[r]];o.setFightTarget(l),o.playSkillEff(l,a.skillid),0!=a.bufid&&l&&l.set_buf&&l.set_buf(o,a.bufid,1);break}}this.comboHitRageUpdate&&(c.BtnSkiilCtrl.ins.progressValue(e.rageVal),this.autoSkill(e))}}},t.prototype.autoSkill=function(t){this.checkJoinSkill(t)},t.prototype.actionCompleteHandler=function(t){if(this._currMsg){var e=this._currMsg;this._currMsg=null,this.deleteAttackInfo();for(var i=null,n=-1,s=null,o=null,a=v.ESkillRes.NULL,r=e.heroAttack.length-1;-1<r;r--){if(s=this._fightGroup.getUnitByIndex(r),i=e.heroAttack[r],this._monsterDebugKey){var l=i.beAttackUid.length;1<l&&u.FE.upItems(f.TextConst.get(447,i.skillid,l),p.BubbleEnum.center)}for(var h=0;h<i.beAttackUid.length&&h<i.skillres.length;h++)n=i.beAttackUid[h],o=this._monsterDic[n],a=i.skillres[h],o&&(o.chg_HP(i.hpAfterAttack[h]-o.getHp(),s,a&v.ESkillRes.LOW_MASK,a&v.ESkillRes.HIGH_MASK),this.setMonsterHp(n,i.hpAfterAttack[h],!0))}this.comboHitRageUpdate&&c.BtnSkiilCtrl.ins.progressValue(e.rageVal),this.completeAttackInfo(e),this.runExInfo()}},t.prototype.completeAttackInfo=function(t){},t.prototype.releaseSkillHandler=function(t){this.releaseSkill(t,"")},t.prototype.startDelay=function(){this._delayKey=!0,this._delayStartTime=d.ServerTime.serverTime},t.prototype.endDelay=function(){this._delayKey=!1,this.clearSaveMonster()},t.prototype.onComboHitGroupGS2C=function(t){for(var i=[],e=0;e<t.hpChgList.length;e++)i.push(t.hpChgList[e].toString());var n=t.comboid;l.E.ins.event(h.EventName.JOINSKILLSHOW,[n]);var s=t.attackUid;Laya.timer.once(500,this,function(){if(c.BtnSkiilCtrl.ins.setKillBloddVo(i),0<s.length){var t=s[0],e=this._monsterDic[t];e&&this._fightGroup.playSkillEffById(n,e.worldX,e.worldY)}else this._fightGroup.playSkillEffById(n,-1,-1)});var o=0,a=0;this.runAllInfo();for(e=0;e<s.length;e++)o=s[e],a=t.hpAfterAttack[e],this.setMonsterHp(o,a,!1);this.comboHitRageUpdate&&c.BtnSkiilCtrl.ins.progressValue(0),this.startDelay()},t.prototype.onMonsterHPChgGS2C=function(t,e){void 0===e&&(e=!1),this.isHaveAttack()&&!e?(this._msgSequenceList.push(3),this._allMsgSequenceList.push(3),this._msgList.push(t)):this.setMonsterHp(t.monsterUid,t.hpAfterBuff,!0)},t.prototype.isHaveAttack=function(){if(this._delayKey)return!0;if(0<this._msgSequenceList.length)for(var t=0;t<this._msgSequenceList.length;t++)if(1==this._msgSequenceList[t])return!0;return!1},t.prototype.runExInfo=function(){for(;0<this._msgSequenceList.length;){var t=0,e=null;switch(this._msgSequenceList[t]){case 1:return;case 2:e=this._msgList[t],this._msgList.splice(t,1),this._msgSequenceList.splice(t,1),t--,this.createMonsterByMonsterAppearExpCopyGS2C(e,!0);break;case 3:e=this._msgList[t],this._msgList.splice(t,1),this._msgSequenceList.splice(t,1),this.onMonsterHPChgGS2C(e,!0);break;case 4:e=this._msgList[t],this._msgList.splice(t,1),this._msgSequenceList.splice(t,1),t--,this.doMonsterArrayAppear(e);break;default:return void console.log("缺少协议类型",this._msgSequenceList[t])}}this.limitSequenceLen()},t.prototype.getAttackInfo=function(){if(0<this._msgSequenceList.length)for(var t=0;t<this._msgSequenceList.length;t++)switch(this._msgSequenceList[t]){case 1:return this._msgList[t];default:console.log("找不到攻击消息，把非攻击消息清理下"),this.runExInfo()}return null},t.prototype.deleteAttackInfo=function(){this._msgSequenceList.shift(),this._msgList.shift()},t.prototype.runAllInfo=function(){this._delayKey=!1;for(;0<this._msgSequenceList.length;)this.runOneInfo()},t.prototype.runOneInfo=function(){if(0<this._msgSequenceList.length){switch(this._msgSequenceList[0]){case 1:this.actionStartHandler(-1),this.actionCompleteHandler(-1);break;case 2:case 3:this.runExInfo();break;default:alert("error:GamePlayExpCopy::runAllInfo"+JSON.stringify(this._msgList)),this._msgList.splice(0,1),this._msgSequenceList.splice(0,1)}}},t.prototype.limitSequenceLen=function(){for(var t=Math.max(0,this._contactMaxSequenceLen*(1-this._count/this._contactMaxMonster));this._msgSequenceList.length>t;)this.runOneInfo()},t.prototype.setMonsterHp=function(t,e,i){this._monsterDic[t]&&(this._totalHurtValue=this._totalHurtValue+this._monsterDic[t].getHp()-e),n.prototype.setMonsterHp.call(this,t,e,i),0==e&&this._count<=0&&this._fightGroup.stand()},t.prototype.checkIsRunAllKey=function(){return!this._delayKey&&!(0<this._msgSequenceList.length)},t.prototype.traceDebugInfo=function(){this._currMsg&&console.log("_currMsg:"+JSON.stringify(this._msgList)),console.log("monsterCount:"+this._count),console.log("_allMsgSequenceList:"+JSON.stringify(this._allMsgSequenceList)),console.log("_msgSequenceList:"+JSON.stringify(this._msgSequenceList))},t}(i.GamePlay);e.GamePlaySvrBase=n}),define("src/g/fight/osprite/play/expcopy/GamePlayExpCopy",["require","exports","../../../../../manager/GameSocketManager","../../../../net/messages/ExpCopyMsg","../../../../../utils/system/FloatEffect","../../../../../plugin/view/ToolTip","../../../../../core/E","../../../../../enum/EventName","src/g/copy/ExpCopyManager","../../../../../manager/RoleCenter","../../../../../manager/AM","../../../../net/messages/sbkComboData","src/g/fight/osprite/play/GamePlaySvrBase","../../../../../config/GameConfig","src/g/index/ctrl/AutoSkillBtnCtrl"],function(t,e,i,n,s,o,a,r,p,l,h,c,u,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(u){function t(t){var e=u.call(this,t)||this;return e._monsterExpDic={},e._maxGridNum=1,e._maxNum=20,e._gridIndex=0,console.log("游戏玩法切换到经验副本内了."),a.E.ins.on(r.EventName.EXIT_BOSS_PLAYTYPE,e,e.onExitHandler),e}return __extends(t,u),t.prototype.init=function(t){void 0===t&&(t=null),console.log("GamePlayExpCopy::init"),u.prototype.init.call(this,t),this.initHeroGroup(),i.GSM.ins.on(n.StartChallengeExpCopyGS2C.KEY,this,this.onExpCopyChallengeStart),i.GSM.ins.on(n.MonsterAppearExpCopyGS2C.KEY,this,this.onMonsterAppear),i.GSM.ins.on(n.ExpCopyEndGS2C.KEY,this,this.onExpCopyEnd),p.ExpCopyManager.getInstance().enterGamePlay(this),a.E.ins.event(r.EventName.EXP_COPY_MAINVIEW),this.registerHandler(this._mainRole),this._fightGroup.setFGTarget(this._monsterGroup);var e=d.GameConfig.playsettingJSON[this.type];g.AutoSkillBtnCtrl.setPos(Laya.stage.width,Laya.stage.height/2,e),this.startExpCopy()},t.prototype.clear=function(){u.prototype.clear.call(this),i.GSM.ins.off(n.StartChallengeExpCopyGS2C.KEY,this,this.onExpCopyChallengeStart),i.GSM.ins.off(n.MonsterAppearExpCopyGS2C.KEY,this,this.onMonsterAppear),i.GSM.ins.off(n.ExpCopyEndGS2C.KEY,this,this.onExpCopyEnd),this._monsterExpDic=null,this._monsterGroup&&(this._monsterGroup.destroyGroup(!0),this._monsterGroup=null),a.E.ins.off(r.EventName.EXIT_BOSS_PLAYTYPE,this,this.onExitHandler),p.ExpCopyManager.getInstance().exitGamePlay()},t.prototype.startExpCopy=function(){var t=1e3*p.ExpCopyManager.getInstance().getExpSetting().opendelay;Laya.timer.once(t,this,this.startBattle),p.ExpCopyManager.getInstance().countDownStart(t)},t.prototype.startBattle=function(){p.ExpCopyManager.getInstance().checkIsFirstEnter()?l.RoleCenter.instans.vo.isMonthCard?this.sendBattleMsg():p.ExpCopyManager.getInstance().showArrow(new Laya.Handler(this,this.sendBattleMsg)):this.sendBattleMsg()},t.prototype.sendBattleMsg=function(){var t=new n.StartChallengeExpCopyC2GS;i.GSM.sendServer(t)},t.prototype.onExpCopyChallengeStart=function(t){if(t.opresult){var e=t.monsters;this.createMonsterByMonsterAppearExpCopyGS2C(e),p.ExpCopyManager.getInstance().initBaseData(t.startSection,t.startExp)}else s.FE.upItems("severInfo::"+t.error,o.BubbleEnum.center)},t.prototype.onMonsterAppear=function(t){this.createMonsterByMonsterAppearExpCopyGS2C(t)},t.prototype.onExpCopyEnd=function(t){p.ExpCopyManager.getInstance().updateData(t.udExpCopy),p.ExpCopyManager.getInstance().openExpCopyAccountView(t.udExpCopy)},t.prototype.onExitHandler=function(){h.AM.exitPlay(this.type,new Laya.Handler(this,function(){this.returnAutoplayPort()}))},t.prototype.exitExpCopy=function(){this.returnAutoplayPort()},t.prototype.setMonsterHp=function(t,e,i){u.prototype.setMonsterHp.call(this,t,e,i),0==e&&this._monsterExpDic[t]&&(p.ExpCopyManager.getInstance().addExp(this._monsterExpDic[t]),this._monsterExpDic[t]=null,delete this._monsterExpDic[t])},t.prototype.createMonsterByMonsterAppearExpCopyGS2C=function(t,e){if(void 0===e&&(e=!1),u.prototype.createMonsterByMonsterAppearExpCopyGS2C.call(this,t,e)){p.ExpCopyManager.getInstance().addRound();var i=t.monsterUidArr;this._gridIndex++,this._gridIndex>=this._maxGridNum&&(this._gridIndex=0);for(var n=0,s=0,o=Math.floor(Math.random()*this._maxNum),a=0,r=0,l=null,h=0;h<i.length;h++){r=i[h],this._monsterExpDic[r]=t.monsterExpArr[h],o=Math.floor(Math.random()*this._maxNum),(a=this._gridIndex*this._maxNum+o)>=this.mapVo.monXY.length&&(a=Math.floor(Math.random()*this.mapVo.monXY.length));var c=this.mapVo.monXY[a];c&&(n=c[0],s=c[1],(l=this._monsterDic[r]).resetUnit(n,s),l.status=1)}return!0}return!1},t.prototype.completeAttackInfo=function(t){u.prototype.completeAttackInfo.call(this,t),100<=t.rageVal&&g.AutoSkillBtnCtrl.autoSkill(c.enumComboIdx.qunti)},t.prototype.autoSkill=function(t){},t}(u.GamePlaySvrBase);e.GamePlayExpCopy=v}),define("src/g/copy/view/expcopy/EXPAccountView",["require","exports","../../../../manager/LayerManager"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.showView=function(){var t=this;Laya.timer.frameOnce(2,this,function(){t.image_bg.x=-t.x,t.image_bg.y=-t.y-10}),this.image_bg.width=Laya.stage.width,this.image_bg.height=Laya.stage.height,this.centerX=this.centerY=0,i.LayerManager.addInHighUILayer(this)},e}(ui.copy.expCopy.EXPAccountViewUI);e.EXPAccountView=n}),define("src/g/copy/ctrl/EXPAccountViewCtrl",["require","exports","src/g/copy/view/expcopy/EXPAccountView","../../../enum/EventName","../../../core/E","src/g/copy/ExpCopyManager","../../../manager/RoleCenter","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","../../../manager/AM","src/g/Effects/UIEffectsFactory","src/g/clearRes/ClearResM","src/init/Switches","src/init/TextConst"],function(t,e,n,i,s,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(){function t(){this._costDouble=0,this._costThree=0,this._isFirstChallengeKey=!1,this._animation=null}return t.prototype.init=function(){s.E.ins.on(i.EventName.EXP_COPY_ACCOUNT,this,this.openPanel)},t.prototype.openPanel=function(t){this._view||(this._view=new n.EXPAccountView,this._view.btn_firstFree.on(Laya.Event.CLICK,this,this.onFreeHandler),this._view.btn_free.on(Laya.Event.CLICK,this,this.onFreeHandler),this._view.btn_gold.on(Laya.Event.CLICK,this,this.onGoldHandler),this._view.btn_doubleGold.on(Laya.Event.CLICK,this,this.onDoubleHandler)),this._view.showView(),(o.ExpCopyManager.getInstance().accountViewCtrl=this)._view.text_roundTime.text=d.TextConst.get(326,t.roundTime);var e=t.totalExp;this._view.fontClip_exp.value=e.toString(),this._view.text_expFirst.value=e.toString(),this._view.text_exp.value=e.toString(),this._view.text_expDouble.value=(2*e).toString(),this._view.text_expThree.value=(3*e).toString(),this._costDouble=o.ExpCopyManager.getInstance().getExpSetting().twocost,this._costThree=o.ExpCopyManager.getInstance().getExpSetting().threecost,this._view.text_costDouble.text=this._costDouble.toString(),this._view.text_costThree.text=this._costThree.toString();var i=t.challengeTimes;this._animation=c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this._view.btn_gold,42,1,4),1!=i&&window.enabledpay?(this._isFirstChallengeKey=!1,this._view.btn_firstFree.visible=!1,this._view.btn_free.visible=!0,this._view.btn_gold.visible=!0,this._view.btn_doubleGold.visible=!0):(this._isFirstChallengeKey=!0,this._view.btn_firstFree.visible=!0,this._view.btn_free.visible=!1,this._view.btn_gold.visible=!1,this._view.btn_doubleGold.visible=!1)},t.prototype.closePanel=function(){this._animation&&(this._animation.destroy(!0),this._animation=null),this._view&&(this._view.removeSelf(),this._view.destroy(),this._view=null,u.ClearResM.clearResFolder("expCopy"))},t.prototype.showTipAlert=function(t,e){h.AM.showAdvanced(t,Laya.Handler.create(this,this.onGetReward,[e]),null,null,d.TextConst.get(204),d.TextConst.get(327))},t.prototype.onGetReward=function(t){switch(t){case 1:o.ExpCopyManager.getInstance().sendGetExpCopyBonus(1);break;case 2:this.checkIsHaveDoubleBonus()?o.ExpCopyManager.getInstance().sendGetExpCopyBonus(2):p.Switches.ins.event(155);break;case 3:switch(this.checkIsHaveThreeBonus()){case 1:var e=o.ExpCopyManager.getInstance().getExpSetting().viplevel;r.FE.upItems(d.TextConst.get(328,e),l.BubbleEnum.center);break;case 2:p.Switches.ins.event(155);break;default:o.ExpCopyManager.getInstance().sendGetExpCopyBonus(3)}}},t.prototype.checkIsHaveDoubleBonus=function(){return!(a.RoleCenter.instans.vo.GOLD<this._costDouble)},t.prototype.checkIsHaveThreeBonus=function(){var t=o.ExpCopyManager.getInstance().getExpSetting().viplevel;return a.RoleCenter.instans.vo.VIP<t?1:a.RoleCenter.instans.vo.GOLD<this._costThree?2:3},t.prototype.onFreeHandler=function(){this._isFirstChallengeKey?this.onGetReward(1):this.showTipAlert(d.TextConst.get(329),1)},t.prototype.onGoldHandler=function(){this.showTipAlert(d.TextConst.get(330,this._costDouble),2)},t.prototype.onDoubleHandler=function(){this.onGetReward(3)},t}();e.EXPAccountViewCtrl=g}),define("src/g/copy/ExpCopyManager",["require","exports","../../core/E","../../enum/EventName","../net/messages/ExpCopyMsg","../../config/GameConfig","../../manager/RoleCenter","../net/messages/ChangeSceneMsg","src/g/fight/info/PlayTypeVo","../../utils/system/FloatEffect","../../plugin/view/ToolTip","../../manager/NewRedHintsCenter","../../manager/GameSocketManager","src/g/accessctrl/AccessCenter","src/g/copy/view/expcopy/ExpSkillBuffDialogCtrl","src/init/TextConst","../../utils/ItemUtils"],function(t,e,i,s,o,a,r,l,h,c,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function n(){this.expCopyView=null,this.expCardCtrl=null,this.mainViewCtrl=null,this.accountViewCtrl=null,this.gamePlay=null,this.getBounsAfterStartGameKey=!1,this.currBuffId=0,this.isAutoReleaseSkillKey=!1,this._totalExp=0,this._roundTime=0,this._lastTime=0,this._startCountDown=0,this._firstKey=!1}return n.getInstance=function(){return n._instance?n._instance:n._instance=new n},n.prototype.enterGamePlay=function(t){this.gamePlay=t,this._roundTime=0,this._totalExp=0,this.currBuffId=0,this.mainViewCtrl&&this.mainViewCtrl.updateUI(),this._firstKey=this.checkIsFirstEnter()},n.prototype.exitGamePlay=function(){this.gamePlay=null,this.mainViewCtrl&&(this.mainViewCtrl.hideExpCopy(),this.mainViewCtrl=null);var t=r.RoleCenter.instans.self;if(t&&t.udExpCopy){var e=r.RoleCenter.instans.vo.isMonthCard;1==t.udExpCopy.challengeTimes&&this._firstKey&&!e&&v.ExpSkillBuffDialogCtrl.getInstance().showView(3)}},n.prototype.updateData=function(t){r.RoleCenter.instans.self.udExpCopy=t,this.checkExpCopyRedPoint(),this.expCopyView&&this.expCopyView.updateUI()},n.prototype.showArrow=function(t){this.mainViewCtrl&&this.mainViewCtrl.showGuideArrow(t)},n.prototype.getTotalExp=function(){return this._totalExp},n.prototype.getRoundTime=function(){return this._roundTime},n.prototype.addExp=function(t){t?(this._totalExp+=t,this.mainViewCtrl&&this.mainViewCtrl.updateTotalExp(this._totalExp)):console.error(t)},n.prototype.addRound=function(){this._roundTime+=1,this.mainViewCtrl&&this.mainViewCtrl.updateRoundTime(this._roundTime)},n.prototype.countDownStart=function(t){this._startCountDown=t,this.mainViewCtrl&&this.mainViewCtrl,this._lastTime=Date.now(),Laya.timer.frameLoop(1,this,this.updateCountDownStart),this.updateCountDownStart()},n.prototype.updateCountDownStart=function(){var t=Date.now()-this._lastTime;this._lastTime=Date.now(),this._startCountDown-=t,this._startCountDown<0&&(this._startCountDown=0),this.mainViewCtrl&&this.mainViewCtrl.updateStartCountTime(this._startCountDown)},n.prototype.initBaseData=function(t,e){Laya.timer.clear(this,this.updateCountDownStart),this._totalExp=e,this.mainViewCtrl&&(this.mainViewCtrl.startTime(),this.mainViewCtrl.updateRoundTime(this._roundTime),this.mainViewCtrl.updateTotalExp(this._totalExp))},n.prototype.srvUseBuff=function(t){this.currBuffId=t,this.mainViewCtrl&&this.mainViewCtrl.updateUI()},n.prototype.findBuff=function(t){return a.GameConfig.ExpGameBuff[t]},n.prototype.openExpCopyAccountView=function(t){var e={};e.challengeTimes=t.challengeTimes,e.roundTime=t.challengeWaveCnt+1,e.totalExp=t.bonusExp,i.E.ins.event(s.EventName.EXP_COPY_ACCOUNT,e)},n.prototype.enterExpCopy=function(){this.enterOrExit()},n.prototype.enterOrExit=function(){this.accountViewCtrl&&(this.accountViewCtrl.closePanel(),this.accountViewCtrl=null);var t=!1;this.getBounsAfterStartGameKey?t=!(this.getBounsAfterStartGameKey=!1):this.gamePlay?this.gamePlay.exitExpCopy():t=!0,t&&(0<r.RoleCenter.instans.self.udExpCopy.expCopyChallengeTimes?n.getInstance().checkIsFirstEnter()||r.RoleCenter.instans.vo.isMonthCard?this.enter():v.ExpSkillBuffDialogCtrl.getInstance().showView(1,new Laya.Handler(this,this.enter)):c.FE.upItems(f.TextConst.get(294),u.BubbleEnum.center))},n.prototype.enter=function(){var t=n.getInstance().getExpSetting().monster_scene;i.E.ins.event(s.EventName.PLAY_TYPE_CHANGE,h.PlayTypeVo.create(l.EPlayType.PLAYTYPE_EXPCOPYPLAY,{portid:t}))},n.prototype.getExpSetting=function(){return a.GameConfig.EXPEnviroment[1]},n.prototype.checkIsFirstEnter=function(){return 0==r.RoleCenter.instans.self.udExpCopy.challengeTimes},n.prototype.sendGetExpCopyBonus=function(t){if(0<r.RoleCenter.instans.self.udExpCopy.bonusExp){var e=new o.ExpCopyGetBonusC2GS;e.bonusMultiTimes=t,d.GSM.sendServer(e)}else this.enterOrExit()},n.prototype.onGetExpCopyBonus=function(t){t.opresult?(r.RoleCenter.instans.addInventoryToC(t.reward),c.FE.addInventoryToCFloats(t.reward),this.updateData(t.udExpCopy),this.enterOrExit(),i.E.ins.event(s.EventName.CHALLENGE_EXP_COPY_COMPLETE)):c.FE.upItems("server:"+t.error,u.BubbleEnum.center)},n.prototype.onUseBuffResult=function(t){if(t.opresult){var e=r.RoleCenter.instans.getValueByType(t.currencyType);r.RoleCenter.instans.setValueByType(t.currencyType,e-t.currencyVal),n.getInstance().srvUseBuff(t.buffid)}else{var i="sever:"+t.error;c.FE.upItems(i,u.BubbleEnum.center)}},n.prototype.checkExpCopyRedPoint=function(){var t=r.RoleCenter.instans.self.udExpCopy,e=!1;y.ItemUtils.getZhuanShengVoById(r.RoleCenter.instans.vo.zhuanshengLv+1)&&g.AccessCenter.ins.checkOpen(85)&&(0<t.expCopyChallengeTimes||0<t.bonusExp)&&(e=!0),p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.exp_copy,e)},n.static_debugKey=!1,n._instance=null,n}();e.ExpCopyManager=n}),define("src/g/copy/view/expcopy/ExpCopyView",["require","exports","../../../../manager/LayerManager","src/g/copy/ExpCopyManager","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../manager/StateManger","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t.btn_fight.on(Laya.Event.CLICK,t,t.fightHandler),n.ExpCopyManager.getInstance().expCopyView=t}return __extends(t,e),t.prototype.fightHandler=function(){a.StateManger.isSpecialPlay(!0)||(0<s.RoleCenter.instans.self.udExpCopy.bonusExp?(i.LayerManager.closeAllPOPWindow(),n.ExpCopyManager.getInstance().getBounsAfterStartGameKey=!0,n.ExpCopyManager.getInstance().openExpCopyAccountView(s.RoleCenter.instans.self.udExpCopy)):(i.LayerManager.closeAllPOPWindow(),n.ExpCopyManager.getInstance().enterExpCopy()))},t.prototype.updateUI=function(){var t=s.RoleCenter.instans.self.udExpCopy;this.text_bestRecord.value="{0}".replace("{0}",t.maxWaveCnt.toString());var e=this.getExpCopyCountByVipLv();this.label_time.text="{0}/{1}".replace("{0}",t.expCopyChallengeTimes.toString()).replace("{1}",e.toString()),this.label_time.color=0==t.expCopyChallengeTimes?"#ff0f15":"#03bb00"},t.prototype.getExpCopyCountByVipLv=function(){var t=o.GameConfig.vipJSON[s.RoleCenter.instans.vo.VIP];for(var e in t.reward){var i=t.reward[e];if(i&&"EXPFREE"==i[0])return i[1]}return 0},t.prototype.showView=function(){this.visible=!0,this.updateUI(),r.ClearResM.resetViewImg(this)},t}(ui.copy.ExpCopyViewUI);e.ExpCopyView=l}),define("src/g/fight/osprite/play/GamePlayMatCopy",["require","exports","src/g/index/ctrl/BtnSkiilCtrl","src/g/fight/osprite/play/GamePlay","src/g/fight/osprite/obj/FightGroup","src/g/fight/osprite/obj/MonsterUnit_New","../../../../utils/ItemUtils","src/g/fight/osprite/SceneObjCtroller","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","src/g/fight/osprite/NetCtroller","src/g/account/ctrl/AccountViewCtrl","../../../../manager/AM","src/g/fight/osprite/SceneObjManager","../../../../config/GameConfig","src/init/GameState","src/init/TextConst"],function(t,e,n,i,s,o,a,r,l,h,c,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=function(i){function t(t){var e=i.call(this,t)||this;return e._mPosIdx=0,e._fightID=-1,e._finishMatCopy=!1,e._readySuccDlg=!1,e._exitByBtn=!1,e._deathEnd=!1,n.BtnSkiilCtrl.ins.setSkillBtnVisible(!1),e}return __extends(t,i),t.prototype.init=function(t){void 0===t&&(t=null),i.prototype.init.call(this,t),f.GameState.clientChangeHp=!1,this._portData=this.scene.matCopy,l.E.ins.on(h.EventName.EXIT_BOSS_PLAYTYPE,this,this.ExitMatCopy),this.initMatCopyPort(),n.BtnSkiilCtrl.ins.setSkillBtnVisible(!0),0<g.SceneObjManager.instans.totalDrops.length&&this._fightGroup.setPITarget(g.SceneObjManager.instans.totalDrops)},t.prototype.ExitMatCopy=function(){d.AM.exitPlay(this.type,new Laya.Handler(this,this.executeExit))},t.prototype.executeExit=function(){this._exitByBtn=!0,l.E.ins.off(h.EventName.EXIT_BOSS_PLAYTYPE,this,this.ExitMatCopy),this.returnAutoplayPort()},t.sweepMatCopy=function(t){u.NetCtroller.sendSweepMatCopy(v.GameConfig.getPortIDByMatCopyID(t))},t.sweepSelfBoss=function(t){u.NetCtroller.sendSweepSelfBoss(t)},t.prototype.clear=function(){i.prototype.clear.call(this),l.E.ins.off(h.EventName.EXIT_BOSS_PLAYTYPE,this,this.ExitMatCopy),this._monsterGroup&&this._monsterGroup.destroyGroup(!0),this.pickAllDropItem(),f.GameState.clientChangeHp=!1},t.prototype.initMatCopyPort=function(){this._monXY=this.mapVo.monXY,this.initHeroGroup(),this.initMonsterGroup(),this._fightGroup.setFGTarget(this._monsterGroup),this.fightStart(!0)},t.prototype.initHeroGroup=function(){var t=r.SceneObjCtroller.ins.getSelfGroup();t.resetFightGroup(this.mapVo.startPoint[0]),t.addToFightLayer(),this.setFightGroup(t)},t.prototype.createSceneFinalBoss=function(){this._monsterGroup.destroyGroup(!0);var t=this._portData.boss,e=new o.MonsterUnit_New,i=a.ItemUtils.getMonsterVOById(t);e.set_DATA(i),e.setFocusEff(),this._monsterGroup.addFightUnit(e),this._monsterGroup.addToFightLayer(),this._fightReward&&this._monsterGroup.assignMonsterDrop(this._fightReward),e.setHPBarYOff(-220);var n=this._monXY[this._monXY.length-1];e.setPos(n[0],n[1]),this._fightGroup.setFGTarget(this._monsterGroup)},t.prototype.fightStart=function(t){void 0===t&&(t=!0),u.NetCtroller.fightStartC2GS(t,[this._portData.boss],this._portData.id)},t.prototype.onReceiveFightStart=function(t){var e=this;i.prototype.onReceiveFightStart.call(this,t),t.opresult?(this._fightReward=t.inventory,this._fightID=t.fightid):Laya.timer.once(1500,this,function(){d.AM.show(y.TextConst.get(437,t.error)),e.returnAutoplayPort()})},t.prototype.fightEnd=function(t){void 0===t&&(t=!0),this._finishMatCopy=!0,u.NetCtroller.fightEndC2GS(this._portData.id,this.scene.fightid,t)},t.prototype.decMapCopyChallengeTimes=function(){l.E.ins.event(h.EventName.CHALLENGE_MATE_COPY_SUCCESS,this._portData.id);var t=v.GameConfig.getDataByMatCopyID(this.type);if(t){var e=t.cost.split(":")[0],i=e.split("_"),n=i[0]+"_VIP"+i[1],s=c.RoleCenter.instans.self,o=t.consume;if(!(0<s[e]))return 0<s[n]?(s[n]--,void(s.GOLD-=o)):void 0;s[e]--}},t.prototype.successDialog=function(){var t=this;this.splitFightReward(this._fightReward),p.AccountViewCtrl.ins.successFightEnd(this._fightReward,Laya.Handler.create(this,function(){t.returnAutoplayPort()}))},t.prototype.onReceiveFightEnd=function(t){var e=this;t.fightid==this._fightID&&(i.prototype.onReceiveFightEnd.call(this,t),t.opresult?(this._readySuccDlg=!0,this.decMapCopyChallengeTimes()):p.AccountViewCtrl.ins.failFightEnd(Laya.Handler.create(this,function(){e.returnAutoplayPort()})))},t.prototype.resetMonsterGroup=function(){var t=this._monXY.length;this._mPosIdx>=t||(t-1==this._mPosIdx?this.createSceneFinalBoss():this._monsterGroup.resetFightGroup(this._monXY[this._mPosIdx]),this._mPosIdx++,this._fightGroup.setFGTarget(null),this._fightGroup.setFGTarget(this._monsterGroup))},t.prototype.initMonsterGroup=function(){this._monsterGroup=new s.FightGroup(null);for(var t=this._portData.monster,e=0;e<t.length;e++){var i=new o.MonsterUnit_New,n=a.ItemUtils.getMonsterVOById(t[e]);i.set_DATA(n),this._monsterGroup.addFightUnit(i)}this._monsterGroup.addToFightLayer(),this._monsterGroup.resetFightGroup(this._monXY[this._mPosIdx]),this._mPosIdx++},t.prototype.releaseSkillHandler=function(t){this.releaseClientComboHit(t)},t.prototype.frameMove=function(){if(i.prototype.frameMove.call(this),this._fightGroup&&!this._deathEnd){if(this._fightGroup&&this._fightGroup.isDeath())return this.fightEnd(!1),void(this._deathEnd=!0);if(this._finishMatCopy)this._readySuccDlg&&0==g.SceneObjManager.instans.totalDrops.length&&(this.successDialog(),this._readySuccDlg=!1,this._fightReward&&(0<this._fightReward.currencyList.length||0<this._fightReward.itemList.length)&&(this.effectExpAndMoney(this._fightReward),this._fightReward.clear(),this._fightReward=null));else if(this._monsterGroup&&this._monsterGroup.isVanishDeath()){if(this._monXY.length==this._mPosIdx)return this.fightEnd(!0),void(0<g.SceneObjManager.instans.totalDrops.length&&this._fightGroup.setPITarget(g.SceneObjManager.instans.totalDrops));this.resetMonsterGroup()}}},t}(i.GamePlay);e.GamePlayMatCopy=m}),define("src/g/copy/view/copyplay/CopyItem",["require","exports","../../../../manager/RoleCenter","../../../../enum/EventName","../../../../manager/LayerManager","../../../../core/E","../../../../config/GameConfig","../../../../manager/StateManger","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","src/g/fight/info/PlayTypeVo","src/g/fight/osprite/play/GamePlayMatCopy","src/g/clearRes/ClearResM","src/init/Switches","src/init/TextConst","../../../../utils/ItemUtils"],function(t,e,o,i,n,s,a,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(e){function t(){var t=e.call(this)||this;return t.tiaozhan=0,t.saodang=0,t.maxCount=0,t.canSaoDang=!1,t._index=-1,t.btn_fight.on(Laya.Event.CLICK,t,t.fightHandler),t.html_tip.style.fontSize=20,t.html_tip.style.font="SimHei",t.html_tip.style.align="right",t.html_tip.style.color="#c0b4a3",t.html_tip.visible=window.enabledpay,s.E.ins.on(i.EventName.SWAPFINISH,t,t.updateHandler),t}return __extends(t,e),t.prototype.updateHandler=function(){},t.prototype.fightHandler=function(){var t=this,e=this._data;e&&(this.btn_fight.mouseEnabled=!1,Laya.timer.once(2500,this,function(){t.btn_fight.disabled||(t.btn_fight.mouseEnabled=!0)}),e.lvl>o.RoleCenter.instans.vo.getCurLv()?l.FE.upItems(g.TextConst.get(15,e.lvl),h.BubbleEnum.center):!this.canSaoDang&&r.StateManger.isSpecialPlay()||(this.con.visible&&o.RoleCenter.instans.vo.GOLD<e.consume&&0==this.tiaozhan?d.Switches.ins.event(155):0==this.canSaoDang?(s.E.ins.event(i.EventName.PLAY_TYPE_CHANGE,c.PlayTypeVo.create(this.playType)),n.LayerManager.closeAllPOPWindow()):(this.con.visible=!1,this.barbox.visible=!0,u.GamePlayMatCopy.sweepMatCopy(e.id),Laya.Tween.to(this.bar_val,{width:this.bar_bg.width},1200,null,Laya.Handler.create(this,function(){t.barbox.visible=!1,t.con.visible=!0,t.setData(e,t._index)})))))},t.prototype.setData=function(t,e){this._index=e;var i=o.RoleCenter.instans.self,n=o.RoleCenter.instans.vo.isSuperMonthCard;this.img_bg.skin="";var s="res/wanfa/fuben_"+t.icon+".png";switch(this.gold_txt.text=t.consume+"",this.img_bg.skin=s,p.ClearResM.addBgUrl(s),this.bar_val.width=0,t.id){case 11:this.maxCount=i.COPYGEN_COUNT+i.COPYGEN_VIPCOUNT,this.tiaozhan=i.COPYGEN_COUNT,this.saodang=i.COPYGEN_VIPCOUNT;break;case 12:this.maxCount=i.COPYMERIDIAN_COUNT+i.COPYMERIDIAN_VIPCOUNT,this.tiaozhan=i.COPYMERIDIAN_COUNT,this.saodang=i.COPYMERIDIAN_VIPCOUNT;break;case 13:this.maxCount=i.COPYACHIEVE_COUNT+i.COPYACHIEVE_VIPCOUNT,this.tiaozhan=i.COPYACHIEVE_COUNT,this.saodang=i.COPYACHIEVE_VIPCOUNT;break;case 14:this.maxCount=i.COPYDARGON_COUNT+i.COPYDARGON_VIPCOUNT,this.tiaozhan=i.COPYDARGON_COUNT,this.saodang=i.COPYDARGON_VIPCOUNT;break;case 15:this.maxCount=i.COPYSHIELD_COUNT+i.COPYSHIELD_VIPCOUNT,this.tiaozhan=i.COPYSHIELD_COUNT,this.saodang=i.COPYSHIELD_VIPCOUNT}this.playType=t.id,this._data=t,o.RoleCenter.instans.vo.getCurLv()<t.lvl?this.setNotOpen(t.lvl):0<this.tiaozhan?this.setBaseCount(this.tiaozhan):n?this.setType_SaoDang(this.maxCount,i.vipLv):0<this.saodang?this.setType_SaoDang(this.saodang):this.setType_SaoDang(0,i.vipLv)},t.prototype.setType_SaoDang=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),0==t?this.setNeedVip(e):this.setNowVipCount(t)},t.prototype.setNeedVip=function(t){var e=a.GameConfig.vipJSON[t+1];this.bg_icon.visible=e?(this.html_tip.innerHTML=g.TextConst.get(931,e.id,e.reward[1][1]),!0):(this.html_tip.innerHTML="",!1),this.btn_fight.disabled=!0,this.btn_fight.label=g.TextConst.get(338),this.btn_red.visible=!1,this.canSaoDang=!0,this.con.visible=!0,this.barbox.visible=!1,this.tip_lvl_txt.text=""},t.prototype.setNowVipCount=function(t){var e=g.TextConst.get(809,t);this.html_tip.innerHTML=e,this.bg_icon.visible=!0,this.con.visible=0==this.tiaozhan,this.barbox.visible=!1,this.btn_fight.disabled=!1,this.btn_fight.visible=!0,this.canSaoDang=!0,this.btn_fight.label=g.TextConst.get(338),this.btn_red.visible=!1,this.tip_lvl_txt.text=""},t.prototype.setBaseCount=function(t){var e=g.TextConst.get(810,t),i=o.RoleCenter.instans.vo.isSuperMonthCard;this.html_tip.innerHTML=e,this.bg_icon.visible=!0,this.btn_fight.disabled=!1,this.btn_fight.label=i?g.TextConst.get(340):g.TextConst.get(341),this.btn_red.visible=!0,this.canSaoDang=i,this.btn_fight.visible=!0,this.btn_fight.disabled=!1,this.barbox.visible=!1,this.con.visible=!1,this.tip_lvl_txt.text=""},t.prototype.setNotOpen=function(t){this.tip_lvl_txt.text=g.TextConst.get(343,v.ItemUtils.getLVString(t)),this.canSaoDang=!1,this.barbox.visible=!1,this.con.visible=!1,this.btn_fight.visible=!1,this.btn_red.visible=!1,this.html_tip.innerHTML="",this.bg_icon.visible=!1},t}(ui.playtype.CopyItemUI);e.CopyItem=f}),define("src/g/copy/view/copyplay/CopyView",["require","exports","src/g/clearRes/ClearResM","src/g/copy/view/copyplay/CopyItem","../../../../core/E","../../../../enum/EventName","../../../../config/GameConfig"],function(t,e,s,i,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.list.itemRender=i.CopyItem,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=50,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t}return __extends(t,e),t.prototype.updateHandler=function(){this.list.refresh()},t.prototype.renderHandler=function(t,e){t.setData(this.list.array[e],e)},t.prototype.showView=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!0);var i=r.GameConfig.copymaterialJSON;if(!this._data){for(var n in this._data=[],i)this._data.push(i[n]);this._data=this._data.sort(this.sortOn),this.list.array=this._data}this.list.refresh(),this.visible=!0,s.ClearResM.resetViewImg(this),o.E.ins.on(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){o.E.ins.off(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),s.ClearResM.clearResFolder("wafa/")},t.prototype.sortOn=function(t,e){return t.lvl-e.lvl},t}(ui.playtype.CopyViewtUI);e.CopyView=n}),define("src/g/boss/view/HugeDominateView",["require","exports","../../../component/GAnimation","../../../manager/RoleCenter","../../../config/GameConfig","../../../utils/ItemUtils","../../../core/E","../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../net/messages/ChangeSceneMsg","../../../manager/StateManger","../../../manager/AM","../../../utils/system/ServerTime","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/g/clearRes/ClearResM","src/g/peronboss/view/ItemIconView","src/g/fight/base/RES","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(e){function t(){var t=e.call(this)||this;return t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){this.lab_see.on(Laya.Event.CLICK,this,this.rewardHandler),this.btn_fight.on(Laya.Event.CLICK,this,this.onFight),a.E.ins.on(r.EventName.REFRESH_REBIRTHBOSSHURTRANK,this,this.renderLastHurt),a.E.ins.on(r.EventName.CLOSEBOSSVIEW,this,this.onRemoved),this.bgview.btn_back.on(Laya.Event.CLICK,this,this.removeSelf),this.bgview.btn_close.on(Laya.Event.CLICK,this,this.removeSelf),a.E.ins.on(r.EventName.CHANGE_HUGEDOMINATE_MSG,this,this.refreshData)},t.prototype.onRemoved=function(){this._ani&&(this._ani.destroy(!0),this._ani=null,v.ClearResM.clearResFolder("personboss/"))},t.prototype.onFight=function(){if(a.E.ins.event(r.EventName.CLOSEPERSONBOSS),!c.StateManger.isSpecialPlay())if(n.RoleCenter.instans.bagRoomEnough()){p.ServerTime.serverTime;if(-1!=n.RoleCenter.instans.vo.bossData.currentOpenRebirthBossIdx){var t=this.nowShowVo.id;a.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,l.PlayTypeVo.create(h.EPlayType.PLAYTYPE_REBORNBOSS,t))}else d.FE.upItems(m.TextConst.get(298),g.BubbleEnum.center)}else u.AM.showBagNotEnough()},t.prototype.rewardHandler=function(){a.E.ins.event(r.EventName.OPENZSREWARDVIEW)},t.prototype.refreshData=function(){this.visible=!0,this.user=n.RoleCenter.instans.vo,this.data=this.user.bossData,this.renderView(),v.ClearResM.resetViewImg(this),a.E.ins.on(r.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){a.E.ins.off(r.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),v.ClearResM.clearResFolder("personboss/")},t.prototype.renderView=function(){var t=this.data.currentOpenRebirthBossIdx;-1==t&&(t=this.data.nextOpenRebirthBossIdx),this.nowShowVo=s.GameConfig.Port_zhuanshengJSON[t+401],this.renderNow(),this.renderReward(),this.renderLastHurt(),this.refreshTimeShow()},t.prototype.refreshTimeShow=function(){var t=s.GameConfig.timingActivity[2];this.lab_waitTime.text=t.penTips,-1==this.data.currentOpenRebirthBossIdx?(this.btn_fight.label=m.TextConst.get(299),this.btn_fight.disabled=!0):(this.btn_fight.label=m.TextConst.get(300),this.btn_fight.disabled=!1)},t.prototype.renderLastHurt=function(){var t=n.RoleCenter.instans.rebirthBossHurtRank||[];t.sort(this.sortHurt),0<t.length?this.lab_lastName.text=t[0].nickname||"":this.lab_lastName.text=""},t.prototype.sortHurt=function(t,e){return t.rank-e.rank},t.prototype.renderNow=function(){var t=o.ItemUtils.getPortVoById(this.nowShowVo.port),e=o.ItemUtils.getMonsterVOById(t.boss[0]);this.showMonster(e),this.lab_bossName.text=this.nowShowVo.name},t.prototype.renderReward=function(){var t=o.ItemUtils.getBossId(this.nowShowVo.id).bonus;this._hbox.removeChildren();for(var e=0;e<t.length;e++){var i=o.ItemUtils.getItemOrEq(t[e]),n=new ui.boss.IconItemUI;this._hbox.addChild(n),f.ItemIconView.setItemData(i,n)}},t.prototype.showMonster=function(t){if(this._ani||(this._ani=new i.GAnimation,this._ani.x=300,this._ani.y=340,this.monster.addChild(this._ani)),-1==t.moResVo.dir.indexOf(5)){var e=y.RES.MONSTER_PATH+t.moResVo.res+"/3_r.json";this._ani.scale(-t.zoom,t.zoom)}else{this._ani.scale(t.zoom,t.zoom);e=y.RES.MONSTER_PATH+t.moResVo.res+"/5_r.json"}v.ClearResM.setCachUrl(e),this._ani.load(e),this.bgimg.restskin(),this.img_last1.restskin(),this.img_last2.restskin(),v.ClearResM.addBgUrl(this.bgimg.skin),v.ClearResM.addBgUrl(this.img_last1.skin),v.ClearResM.addBgUrl(this.img_last2.skin)},t}(ui.boss.HugeDominateUI);e.HugeDominateView=_}),define("src/g/copy/view/teamcopy/TeamCopyMainListItem1",["require","exports","../../../../manager/RoleCenter","../../../../utils/system/DateUitl","src/init/TextConst"],function(t,e,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.htxt_desc.style.color="#b6a98d",t.htxt_desc.style.fontSize=20,t.htxt_desc.style.font="SimHei",t}return __extends(t,e),t.prototype.setData=function(t){this.img_bg.skin="res/teamcopy/jst_list_00"+t.icon+".png",this.img_chapter.skin="res/teamcopy/jst_dijizhang_00"+t.icon+".png",this.htxt_desc.innerHTML=t.desc;var e=n.RoleCenter.instans.vo.portstatus.hfData;-1!=e.legendData.curWeekLegend.indexOf(t.id)?this.img_state_di.skin="res/teamcopy/jst_zhangdi_001.png":t.id<=e.legendData.levelPass+1?this.img_state_di.skin="res/teamcopy/jst_zhangdi_003.png":this.img_state_di.skin="res/teamcopy/jst_zhangdi_002.png",this.lab_combat.visible=!1;var i=s.DateUtil.getKFDay();t.day>i?(this.lab_open_txt.visible=!0,this.lab_open_txt.changeText(o.TextConst.get(1102,t.day))):(this.lab_open_txt.visible=!1,0<t.power&&(this.lab_combat.visible=!0,this.lab_combat.changeText(o.TextConst.get(1117,t.power))))},t}(ui.teamcopy.TeamCopyMainListItem1UI);e.TeamCopyMainListItem1=i}),define("src/g/copy/view/teamcopy/TeamCopyMainListItem2",["require","exports","src/g/bag/tips/view/ItemTips","../../../../utils/ItemCellUtils","../../../../utils/ItemUtils","../../../net/messages/TeamMsg","../../../../manager/GameSocketManager","../../../../manager/RoleCenter","../../../../manager/AM"],function(t,e,n,i,h,s,o,c,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.list_item.renderHandler=new Laya.Handler(t,t.onListRender),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t.btn_fight.on(Laya.Event.CLICK,t,t.createTeamHandler),t}return __extends(t,e),t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.onListRender=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,this.list_item.array[e][0],Number(this.list_item.array[e][1]))},t.prototype.setData=function(t,e){this._vo=t,this.list_item.array=t.itemshow;var i=h.ItemUtils.getPortVoById(t.portid),n=h.ItemUtils.getMonsterVOById(i.boss[0]);this.lab_boss_head.skin=h.ItemUtils.getBossIconByPort(t.portid),n&&(this.lab_boss_name.text=n.name);for(var s=c.RoleCenter.instans.vo.portstatus.hfData,o=s.legendData.curWeekLegend.length,a=0,r=0,l=!1;a<o;)r=s.legendData.curWeekLegend[a],t.id==r&&(l=!0),a++;this.lab_pass.visible=l?!(this.btn_fight.visible=!1):(this.btn_fight.disabled=e!=t.id,!(this.btn_fight.visible=!0))},t.prototype.createTeamHandler=function(){if(c.RoleCenter.instans.bagRoomEnough()){var t=new s.CreateTeamC2GS;t.teamType=s.enumTeamType.legend,t.copyid=this._vo.id,o.GSM.sendServer(t)}else a.AM.showBagNotEnough()},t}(ui.teamcopy.TeamCopyMainListItem2UI);e.TeamCopyMainListItem2=r}),define("src/g/copy/view/teamcopy/TeamCopyOtherInfo",["require","exports","../../../net/messages/TeamMsg","../../../../utils/ItemUtils","../../../../enum/EventName","../../../../core/E","../../../../manager/GameSocketManager","../../../../manager/RoleCenter","src/init/TextConst"],function(t,e,i,r,n,s,o,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.btn_del.on(Laya.Event.CLICK,t,t.doDelUser),t.btn_look.on(Laya.Event.CLICK,t,t.doLookUser),t}return __extends(t,e),t.prototype.doDelUser=function(){var t=new i.ExitTeamC2GS;t.teamUid=this._teamuid,t.username=this._username,o.GSM.sendServer(t),this.close()},t.prototype.doLookUser=function(){s.E.ins.event(n.EventName.OPEN_RANKROLEVIEW,[this._username]),this.close()},t.prototype.setData=function(t,e,i){this._teamuid=t,this._username=e.username,this.img_head.skin=r.ItemUtils.getHeadUrl(e.sex,e.job),this.lab_name.changeText(e.nickname),this.lab_family_name.changeText(e.familyName),this.lab_lv.changeText(0==e.lvl?"":r.ItemUtils.getLVString(e.lvl)),this.btn_del.visible=i;var n=l.RoleCenter.instans.getOtherData(this._username);if(n){for(var s=0,o=n.openhero.length,a=0;a<o;)s+=n.openhero[a].combat,a++;this.lab_fight.changeText(h.TextConst.get(684,(s/1e4).toFixed(2)))}else this.lab_fight.changeText("")},t}(ui.teamcopy.TeamCopyOtherTipUI);e.TeamCopyOtherInfo=a}),define("src/g/copy/view/teamcopy/TeamCopyInvitationListDlg",["require","exports","src/g/friend/ctrl/FriendsDataManager","../../../net/messages/friend/FriendMsg","../../../../utils/ItemUtils","../../../../manager/GameSocketManager","../../../net/messages/HelpFightMsg","../../../net/messages/TeamMsg","../../../../utils/system/FloatEffect"],function(t,e,a,r,n,i,s,o,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.list_invitation.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t.btn_close.on(Laya.Event.CLICK,t,t.close),t}return __extends(t,e),t.prototype.setData=function(t){this._context=t;for(var e,i=a.FriendsDataManager.ins.getListByRelation(r.enumFrdType.friend|r.enumFrdType.friendDouble),n=i.length,s=[],o=0;o<n;)(e=a.FriendsDataManager.ins.getFriendDataByUsername(i[o]))&&e.onLine&&s.push(i[o]),o++;this.list_invitation.array=s},t.prototype.onListRenderHandler=function(t,e){var i=a.FriendsDataManager.ins.getFriendDataByUsername(t.dataSource);i&&(t.img_head.skin=n.ItemUtils.getHeadUrl(i.sex,i.jobid),t.lab_name.changeText(i.nickname),t.lab_level.changeText(0==i.level?"":n.ItemUtils.getLVString(i.level)),t.lab_family_name.changeText(i.familyname),t.btn_invitation.offAll(),t.btn_invitation.on(Laya.Event.CLICK,this,this.doInvitation,[i.username]))},t.prototype.doInvitation=function(t){var e=new s.HelpFigthChatC2GS;e.teamType=o.enumTeamType.legend,e.unameInvite=t,i.GSM.sendServer(e),l.FE.upItems("已邀请")},t}(ui.teamcopy.TeampCopyInvitationListDlgUI);e.TeamCopyInvitationListDlg=h}),define("src/g/copy/view/teamcopy/TeamCopyInvitationDlg",["require","exports","../../../net/messages/HelpFightMsg","../../../net/messages/TeamMsg","../../../../manager/GameSocketManager","src/g/copy/view/teamcopy/TeamCopyInvitationListDlg","src/g/fight/osprite/play/team/TeamManager","../../../../config/GameConfig","../../../../utils/system/ServerTime","../../../../utils/system/FloatEffect","src/init/TextConst","../../../../manager/RoleCenter"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t._cd=0,t.lastWorldInviteTime=0,t.lastGuildInviteTime=0,t.btn_close.on(Laya.Event.CLICK,t,t.close),t.btn_world.on(Laya.Event.CLICK,t,t.worldInvitation),t.btn_gulidInv.on(Laya.Event.CLICK,t,t.gulidInvitation),t.htxt_context.style.color="#dad2b9",t.htxt_context.style.fontSize=20,t.htxt_context.style.font="SimHei",t}return __extends(t,e),t.prototype.setData=function(t){var e=a.TeamManager.getTeamFightMsg(t);if(e){var i=r.GameConfig.teamCopyVoCfg[e.level];i&&(this.htxt_context.innerHTML=this._context=c.TextConst.get(1280,i.name))}var n=r.GameConfig.teamCopySettingVoCfg.invitationTime;n&&(this._cd=Number(n.value))},t.prototype.worldInvitation=function(){var t=l.ServerTime.serverTime;if(t-this.lastWorldInviteTime>this._cd){this.close();var e=new i.HelpFigthChatC2GS;e.teamType=n.enumTeamType.legend,s.GSM.sendServer(e),this.lastWorldInviteTime=t}else h.FE.upItems(c.TextConst.get(1099,this._cd-t+this.lastWorldInviteTime))},t.prototype.popFriendListDlg=function(){this.close(),this._friendListDlg||(this._friendListDlg=new o.TeamCopyInvitationListDlg),this._friendListDlg.setData(this._context),this._friendListDlg.isPopup||this._friendListDlg.popup()},t.prototype.gulidInvitation=function(){if(u.RoleCenter.instans.self.ufData.familyUId){var t=l.ServerTime.serverTime;if(t-this.lastGuildInviteTime>this._cd){this.close();var e=new i.HelpFigthChatC2GS;e.teamType=n.enumTeamType.legend,e.unameInvite="行会频道",s.GSM.sendServer(e),this.lastGuildInviteTime=t}else h.FE.upItems(c.TextConst.get(1099,this._cd-t+this.lastGuildInviteTime))}else h.FE.upItems("您还没加入行会!")},t}(ui.teamcopy.TeamCopyInvitationPanelUI);e.TeamCopyInvitationDlg=p}),define("src/g/copy/view/teamcopy/TeamCopyTeamDlg",["require","exports","src/g/fight/osprite/play/team/TeamManager","../../../../config/GameConfig","src/g/bag/tips/view/ItemTips","../../../../utils/ItemCellUtils","../../../../manager/RoleCenter","../../../net/messages/TeamMsg","../../../../manager/GameSocketManager","../../../../core/E","../../../../enum/EventName","../../../../utils/RoleUtil","../../../../core/GNet","src/g/copy/view/teamcopy/TeamCopyOtherInfo","src/g/copy/view/teamcopy/TeamCopyInvitationDlg","../../../net/messages/HelpFightMsg","../../../../utils/system/FloatEffect","../../../../utils/system/DateUitl","src/g/chat/ctrl/ChatContentManager","../../../../utils/SoundUtils","src/g/chat/view/ChatLabel","../../../net/messages/chat/ChatGS2C","src/init/Switches","src/init/TextConst","../../../../manager/AM"],function(t,e,l,n,i,s,h,c,o,a,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(r){function t(){var t=r.call(this)||this;return t.isCaptain=!1,t._teamuid=0,t.usernameArr=[],t._widthChat=400,t._pool=[],t._allCount=0,t._showMaxCount=3,t.box_reward.itemRender=ui.custom.ItemNameViewUI,t.box_reward.renderHandler=new Laya.Handler(t,t.onListRender),t.box_reward.clickHandler=new Laya.Handler(t,t.onMouseListRender),t.btn_close.on(Laya.Event.CLICK,t,t.doExitHandler),t.btn_fight.on(Laya.Event.CLICK,t,t.doFightHandler),t.chatInit(),t}return __extends(t,r),t.prototype.doFightHandler=function(){var t=new f.HelpFightStartC2GS;t.teamType=c.enumTeamType.legend,o.GSM.sendServer(t)},t.prototype.onMouseListRender=function(t){i.ItemTips.ins.showTip(this.box_reward.array[t][0],Number(this.box_reward.array[t][1]))},t.prototype.onListRender=function(t,e){s.ItemCellUtils.fillCellForItemNameView(t,this.box_reward.array[e][0],Number(this.box_reward.array[e][1]))},t.prototype.doShowRoleInfo=function(t){var e=l.TeamManager.getTeamFightMsg(this._teamuid);e&&(this.otherInfoDlg||(this.otherInfoDlg=new g.TeamCopyOtherInfo),this.otherInfoDlg.setData(this._teamuid,0==t?e.teamState.captain:e.teamState.member[t-1],this.isCaptain),this.otherInfoDlg.isPopup||this.otherInfoDlg.popup())},t.prototype.doInvitation=function(){l.TeamManager.getTeamFightMsg(this._teamuid)&&(this.invitationDlg||(this.invitationDlg=new v.TeamCopyInvitationDlg),this.invitationDlg.setData(this._teamuid),this.invitationDlg.isPopup||this.invitationDlg.popup())},Object.defineProperty(t.prototype,"teamuid",{get:function(){return this._teamuid},enumerable:!0,configurable:!0}),t.prototype.showPage=function(t){this._teamuid=t;var e=l.TeamManager.getTeamFightMsg(t),i=n.GameConfig.teamCopyVoCfg[e.level];i&&(this.lab_title.changeText(i.name),this.box_reward.array=i.itemshow,this.isCaptain=h.RoleCenter.instans.vo.username==e.teamState.captain.username,this.btn_fight.visible=this.isCaptain,this.isCaptain&&(i.day<=m.DateUtil.getKFDay()&&-1==h.RoleCenter.instans.vo.portstatus.hfData.legendData.curWeekLegend.indexOf(e.level)?this.btn_fight.disabled=!1:this.btn_fight.disabled=!0)),this.refresh(),this.clearChatContent(),a.E.ins.on(u.EventName.EXIT_TEAM,this,this.onExitTeam),a.E.ins.on(u.EventName.DISMISS_TEAM,this,this.onDismissTeam),a.E.ins.on(u.EventName.CHAT_CONTENT_ADDED,this,this.appendContent)},t.prototype.refresh=function(){this.updateRoleShow()},t.prototype.updateRoleShow=function(){a.E.ins.off(u.EventName.OTHERDATA_UPDATE,this,this.onOtherDataBack),this.evt_area0.offAll(),this.evt_area1.offAll(),this.evt_area2.offAll(),this.lab_name1.visible=this.lab_name2.visible=!1,this.wait1.visible=this.wait2.visible=!0,this.role1.visible=this.role2.visible=!1,this.img_shadow1.visible=this.img_shadow2.visible=!0,this.img_add1.visible=this.img_add2.visible=this.isCaptain,this.isCaptain&&(this.evt_area1.on(Laya.Event.CLICK,this,this.doInvitation),this.evt_area2.on(Laya.Event.CLICK,this,this.doInvitation));var t=h.RoleCenter.instans.vo.username,e=l.TeamManager.getTeamFightMsg(this._teamuid);if(this.usernameArr.length=0,e){this.lab_name0.changeText(e.teamState.captain.nickname),this.fillRoleShow(this.role0,e.teamState.captain.username)||this.usernameArr.push(e.teamState.captain.username),t!=e.teamState.captain.username&&this.evt_area0.on(Laya.Event.CLICK,this,this.doShowRoleInfo,[0]);for(var i=e.teamState.member,n=Math.min(2,i.length),s=0;s<n;)t!=i[s].username&&(this["evt_area"+(s+1)].offAll(),this["evt_area"+(s+1)].on(Laya.Event.CLICK,this,this.doShowRoleInfo,[s+1])),this["lab_name"+(s+1)].changeText(i[s].nickname),this.fillRoleShow(this["role"+(s+1)],i[s].username)||this.usernameArr.push(i[s].username),this["role"+(s+1)].visible=!0,this["img_shadow"+(s+1)].visible=!1,this["img_add"+(s+1)].visible=!1,this["lab_name"+(s+1)].visible=!0,this["wait"+(s+1)].visible=!1,s++;0<this.usernameArr.length&&(d.GNet.getOtherData(this.usernameArr),a.E.ins.on(u.EventName.OTHERDATA_UPDATE,this,this.onOtherDataBack))}},t.prototype.fillRoleShow=function(t,e){var i;if(e==h.RoleCenter.instans.vo.username)p.RoleUtil.refreshZww(h.RoleCenter.instans.vo.getOpenHeroByIdx(0),100,t.wing,t.weapon,t.role,t.ani_fumo);else{if(!(i=h.RoleCenter.instans.getOtherData(e)))return!1;p.RoleUtil.refreshZww(i.openhero[0],100,t.wing,t.weapon,t.role,t.ani_fumo)}return!0},t.prototype.onOtherDataBack=function(){var t=l.TeamManager.getTeamFightMsg(this._teamuid);if(t){var e=this.usernameArr.indexOf(t.teamState.captain.username);-1!=e&&this.fillRoleShow(this.role0,t.teamState.captain.username)&&this.usernameArr.splice(e,1);for(var i=t.teamState.member,n=Math.min(2,i.length),s=0;s<n;)-1!=(e=this.usernameArr.indexOf(i[s].username))&&this.fillRoleShow(this["role"+(s+1)],i[s].username)&&this.usernameArr.splice(e,1),s++;this.usernameArr.length<1&&a.E.ins.off(u.EventName.OTHERDATA_UPDATE,this,this.onOtherDataBack)}},t.prototype.onDismissTeam=function(t,e){this._teamuid==t&&r.prototype.close.call(this)},t.prototype.onExitTeam=function(t,e){if(this._teamuid==t&&e==c.enumTeamType.legend){var i=l.TeamManager.getTeamFightMsg(t);if(i)if(this.isCaptain)this.updateRoleShow();else{for(var n=h.RoleCenter.instans.vo.username,s=i.teamState.member,o=s.length,a=0;a<o;){if(s[a].username==n)return void this.updateRoleShow();a++}r.prototype.close.call(this),y.FE.upItems("你已经离开队伍")}else r.prototype.close.call(this)}},t.prototype.doExitHandler=function(){var e=this;E.AM.show(S.TextConst.get(1101),new Laya.Handler(this,function(){var t=new c.ExitTeamC2GS;t.teamUid=e._teamuid,t.username=h.RoleCenter.instans.vo.username,o.GSM.sendServer(t)}))},t.prototype.onClosed=function(){a.E.ins.off(u.EventName.EXIT_TEAM,this,this.onExitTeam),a.E.ins.off(u.EventName.DISMISS_TEAM,this,this.onDismissTeam),a.E.ins.off(u.EventName.OTHERDATA_UPDATE,this,this.onOtherDataBack),a.E.ins.off(u.EventName.CHAT_CONTENT_ADDED,this,this.appendContent),this._teamuid=0},t.prototype.close=function(t,e){},t.prototype.chatInit=function(){this._widthChat=this.con_all.width,this.con_all.on(Laya.Event.CLICK,this,this.chatHandler),this.con_all.vScrollBarSkin="",this.con_all.vScrollBar.elasticDistance=50},t.prototype._createHtmlTxt=function(){var t;return 0==this._pool.length?((t=new I.ChatLabel).width=this._widthChat,t.on(Laya.Event.LINK,this,this.onLinkHandler)):t=this._pool.pop(),t},t.prototype.clearChatContent=function(){for(var t,e=this._allCount-1;0<=e;)t=this.con_all.removeChildAt(e),this._allCount--,this._pool.push(t),e--},t.prototype.appendContent=function(t,e){var i=t.msg;if(e){var n=b.ChatGS2C.getIns();n.msg=e,n.job=t.job,n.sex=t.sex,n.nickname=t.nickname,n.username=t.username;for(var s=0;s<this._allCount;)(a=this.con_all.getChildAt(s)).content==i&&(n.type=t.type,a.setTextByMsg(n)),s++;return n.resetdata(),void n.clear()}var o,a=this._createHtmlTxt();a.setTextByMsg(t),this._allCount>=this._showMaxCount&&(o=this.con_all.removeChildAt(0),this._allCount--,this._pool.push(o)),this.con_all.addChild(a),this._allCount++;s=0;for(var r=2;s<this._allCount;)(a=this.con_all.getChildAt(s))&&(a.x=2,a.y=r+2,r+=Math.max(17,a.contextHeight)),s++;this.con_all.scrollTo(0,r-this.con_all.height+3)},t.prototype.onLinkHandler=function(t){_.ChatContentManager.onLinkHandler(t),this._evtIsHandled=!0},t.prototype.chatHandler=function(t){this._evtIsHandled?this._evtIsHandled=!1:(C.SoundUtils.getInstance().playBtnsounds(),w.Switches.ins.event(24))},t}(ui.teamcopy.TeamCopyFightDlgUI);e.TeamCopyTeamDlg=r}),define("src/g/copy/ctrl/TeamCopyMainCtrl",["require","exports","src/g/clearRes/ClearResM","src/g/copy/view/teamcopy/TeamCopyMainListItem1","src/g/copy/view/teamcopy/TeamCopyMainListItem2","../../../config/GameConfig","src/g/copy/view/teamcopy/TeamCopyTeamDlg","../../../manager/GameSocketManager","../../net/messages/TeamMsg","../../../core/E","../../../enum/EventName","../../net/messages/HelpFightMsg","src/g/fight/info/PlayTypeVo","../../net/messages/ChangeSceneMsg","../../net/messages/chat/ChatGS2C","src/g/fight/osprite/play/team/TeamManager","../../net/messages/chat/ChatC2GS","../../../manager/RoleCenter","../../../utils/system/FloatEffect","../../../runtime/resload/GameResLoad","../../net/messages/LegendDataMsg","../../../utils/system/DateUitl","../../../manager/NewRedHintsCenter","src/g/accessctrl/AccessCenter","../../../manager/AM","src/init/TextConst"],function(t,e,i,n,s,a,o,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var T=function(){function t(){this.nextFightId=0,r.GSM.ins.on(u.HelpFightStartGS2C.KEY,this,this.startFight),r.GSM.ins.on(u.HelpFightMsgGS2C.KEY,this,this.onInvitationBack),h.E.ins.on(c.EventName.TEAM_COPY_WANT_TO_ADD_TEAM,this,this.tryToAddTeam),h.E.ins.on(c.EventName.JOIN_TEAM,this,this.onJoinTeamBack),r.GSM.ins.on(C.LegendDataGS2C.KEY,this,this.updateLegendDataHandler),h.E.ins.on(c.EventName.POP_TEAM_PANEL,this,this.popTeamPanelHandler),h.E.ins.on(c.EventName.TEAM_COPY_DATA_CHANGED,this,this.updateRed),h.E.ins.once(c.EventName.SERVER_TIME_UPDATE,this,this.updateRed),h.E.ins.on(c.EventName.TEAM_STATE_CHANGED,this,this.onTeamStateChanged),h.E.ins.on(c.EventName.DISMISS_TEAM,this,this.onTeamStateChanged)}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t),this._ins},enumerable:!0,configurable:!0}),t.prototype.showPage=function(t,e){this._view||(this._view=new ui.teamcopy.TeamCopyMainUI,this.init(),t.addChild(this._view)),h.E.ins.on(c.EventName.CREATE_TEAM,this,this.createTeam),h.E.ins.on(c.EventName.TEAM_COPY_DATA_CHANGED,this,this.onTeamCopyDataChanged),this.refreshData(),this._view.visible=!0,i.ClearResM.resetViewImg(this._view),this._view.box_main.open(this.getFightItemIndex())},t.prototype.getFightItemIndex=function(){for(var t=y.RoleCenter.instans.vo.portstatus.hfData,e=t.legendData.curWeekLegend.length,i=0,n=0,s=0;i<e;)n<(s=t.legendData.curWeekLegend[i])&&(n=s),i++;var o=this._view.box_main.array;for(e=o.length,i=0;i<e;){if(o[i].id-n==1)return i;i++}return-1},t.prototype.loadUrls=function(){},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){this.updateList()},t.prototype.getTitle=function(){return"res/teamcopy/jst_biaoti_002.png"},t.prototype.hidePage=function(){h.E.ins.off(c.EventName.CREATE_TEAM,this,this.createTeam),h.E.ins.off(c.EventName.TEAM_COPY_DATA_CHANGED,this,this.onTeamCopyDataChanged),this._view&&(this._view.visible=!1)},t.prototype.destroyPage=function(){},t.prototype.init=function(){this._view.box_main.spaceY=-10,this._view.box_main.subSpaceY=-10,this._view.box_main.itemRender=n.TeamCopyMainListItem1,this._view.box_main.subItemRender=s.TeamCopyMainListItem2,this._view.box_main.renderHandler=new Laya.Handler(this,this.onListRenderHandler),this._view.box_main.subRenderHandler=new Laya.Handler(this,this.onListSubRenderHandler),this._view.box_main.on(ktgame.component.FoldListBox.FOLD_LIST_ITEM_OPENED,this,this.onItemOpenedHandler)},t.prototype.onItemOpenedHandler=function(t){Laya.timer.frameOnce(2,this,this.checkScroll,[t])},t.prototype.checkScroll=function(t){if(this._view.box_main.indexIsOpen(t)){var e=this._view.box_main.getSubItemBoundsByIndex(t);if(e){var i=e.y-this._view.p_list.height+e.height;i>this._view.p_list.vScrollBar.value&&(this._view.p_list.vScrollBar.value=Math.min(i,this._view.p_list.vScrollBar.max))}}},t.prototype.updateList=function(){var t=y.RoleCenter.instans.vo.portstatus.hfData;this.nextFightId=0;var e,i=[],n=I.DateUtil.getKFDay();for(var s in a.GameConfig.teamCopyVoCfg)e=a.GameConfig.teamCopyVoCfg[s],i.push(e),0==this.nextFightId&&e.day<=n&&-1==t.legendData.curWeekLegend.indexOf(e.id)&&(this.nextFightId=e.id);this._view.box_main.array=i},t.prototype.onTeamCopyDataChanged=function(){this._view.box_main.refresh()},t.prototype.startFight=function(t){t.opres&&t.teamType==l.enumTeamType.legend&&h.E.ins.event(c.EventName.PLAY_TYPE_CHANGE,p.PlayTypeVo.create(d.EPlayType.PLAYTYPE_LEGENDCOPY,t))},t.prototype.onListRenderHandler=function(t,e){t.setData(t.dataSource)},t.prototype.onListSubRenderHandler=function(t,e){t.setData(t.dataSource,this.nextFightId)},t.prototype.createTeam=function(t,e){e==l.enumTeamType.legend&&this.popTeamDlg(t)},t.prototype.onJoinTeamBack=function(t,e){e==l.enumTeamType.legend&&this.popTeamDlg(t)},t.prototype.popTeamPanelHandler=function(t,e){if(e==l.enumTeamType.legend){var i=v.TeamManager.getTeamFightMsg(t);i&&i.teamState.teamState!=l.enumTeamState.dismiss&&this.popTeamDlg(t)}},t.prototype.popTeamDlg=function(t){_.GameResLoad.load("res/atlas/res/teamcopy.json"),this._teamDlg||(this._teamDlg=new o.TeamCopyTeamDlg),this._teamDlg.teamuid!=t?this._teamDlg.showPage(t):this._teamDlg.refresh(),this._teamDlg.isPopup||this._teamDlg.popup()},t.prototype.onInvitationBack=function(t){if(t.teamType==l.enumTeamType.legend){var e="组队",i=a.GameConfig.teamCopyVoCfg[t.level];if(i&&(e=i.name),"行会频道"==t.unameInvite){var n=t.teamState.captain;(s=new g.ChatGS2C).job=n.job,s.sex=n.sex,s.nickname=n.nickname,s.username=n.username,s.type=f.enumChatType.family,s.msg=E.TextConst.get(1280,e)+E.TextConst.get(1092,t.teamState.teamUid),h.E.ins.event(c.EventName.SEND_UNREAL_CHAT,[s])}else{var s;n=t.teamState.captain;(s=new g.ChatGS2C).job=n.job,s.sex=n.sex,s.nickname=n.nickname,s.username=n.username,s.type=f.enumChatType.world,s.msg=E.TextConst.get(1280,e)+E.TextConst.get(1092,t.teamState.teamUid),h.E.ins.event(c.EventName.SEND_UNREAL_CHAT,[s])}}},t.prototype.tryToAddTeam=function(t){if(w.AccessCenter.ins.checkOpen(265,!1)){var e=v.TeamManager.getTeamFightMsg(t);if(e){if(this.inTheTeam(e))return void m.FE.upItems(E.TextConst.get(1094));for(var i=y.RoleCenter.instans.vo.portstatus.hfData.legendData,n=1;n<e.level;){if(-1==i.curWeekLegend.indexOf(n))return void m.FE.upItems(E.TextConst.get(1106));n++}if(e.level>y.RoleCenter.instans.vo.portstatus.hfData.legendData.levelPass+1)return void m.FE.upItems(E.TextConst.get(1095));if(e.teamState.teamState==l.enumTeamState.fullTeam)return void m.FE.upItems(E.TextConst.get(1096));if(e.teamState.teamState==l.enumTeamState.inFight)return void m.FE.upItems(E.TextConst.get(1097));if(e.teamState.teamState==l.enumTeamState.dismiss)return void m.FE.upItems(E.TextConst.get(1093));if(!y.RoleCenter.instans.bagRoomEnough())return void S.AM.showBagNotEnough();var s=new l.JoinTeamC2GS;s.teamUid=t,r.GSM.sendServer(s)}else m.FE.upItems(E.TextConst.get(1093))}},t.prototype.inTheTeam=function(t){if(!t)return!1;var e=y.RoleCenter.instans.vo.username;if(t.teamState.captain.username==e)return!0;for(var i=t.teamState.member.length,n=0;n<i;){if(t.teamState.member[n].username==e)return!0;n++}return!1},t.prototype.updateLegendDataHandler=function(t){y.RoleCenter.instans.vo.portstatus.hfData.legendData.copydata(t),h.E.ins.event(c.EventName.TEAM_COPY_DATA_CHANGED)},t.prototype.updateRed=function(){if(y.RoleCenter.instans.vo){for(var t=y.RoleCenter.instans.vo.portstatus.hfData.legendData,e=t.curWeekLegend.length,i=0,n=0,s=0;i<e;)n<(s=t.curWeekLegend[i])&&(n=s),i++;var o=a.GameConfig.teamCopyVoCfg[n+1];if(o&&o.day<=I.DateUtil.getKFDay()&&w.AccessCenter.ins.checkOpen(265))return void b.NewRedHintsCenter.ins.setRedHintOpenOrClose(b.enumRedHints.team_copy,!0)}b.NewRedHintsCenter.ins.setRedHintOpenOrClose(b.enumRedHints.team_copy,!1)},t.prototype.onTeamStateChanged=function(t,e){if(e==l.enumTeamType.legend){var i=v.TeamManager.getTeamFightMsg(t);if(!i||i.teamState.teamState==l.enumTeamState.inFight||i.teamState.teamState==l.enumTeamState.dismiss){var n=E.TextConst.get(1092,t);h.E.ins.event(c.EventName.DELETE_CHAT_CONTENT,[n,f.enumChatType.world]),h.E.ins.event(c.EventName.DELETE_CHAT_CONTENT,[n,f.enumChatType.family])}}},t}();e.TeamCopyMainCtrl=T}),define("src/g/copy/view/CopyPanel",["require","exports","src/g/copy/view/climbtower/ClimbTowerView","src/g/copy/view/expcopy/ExpCopyView","../../../manager/RuledescManager","src/g/proxy/MultiLevelUIProxy","src/g/copy/view/copyplay/CopyView","../../../core/E","../../../enum/EventName","../../../enum/GuideTargetName","../../../utils/UIUtils","../../../manager/GuideCenter","../../net/messages/OpNoParaC2GS","../../../manager/GameSocketManager","../../../runtime/resload/GameResLoad","src/g/copy/ctrl/TeamCopyMainCtrl"],function(t,e,s,o,i,n,a,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(e){function t(){var t=e.call(this)||this;t._conArr=[],t._pro=new n.MultiLevelUIProxy,t.bgview.btn_help.visible=!0,t.bgview.btn_close.on(Laya.Event.CLICK,t,t.closeCopyHandler),t.bgview.btn_back.on(Laya.Event.CLICK,t,t.closeCopyHandler),t._pro.registerTab(t.tabBar,0),t._pro.registerTagIndex(78,0),t.jingyan=1,t._pro.registerTagIndex(85,t.jingyan),t.tongtianta=2,t._pro.registerTagIndex(84,t.tongtianta),t._pro.registerTagIndex(265,3);t.tabBar.getChildByName("item3");return t._pro.selectHandler=new Laya.Handler(t,t.copyRenderHandler),t}return __extends(t,e),t.prototype.closeCopyHandler=function(){this.removeSelf(),r.E.ins.event(l.EventName.COMPTYPE_CLOSEVIEW,h.GuideTargetName.COPY_VIEW),Laya.loader.clearRes("res/atlas/res/title.json")},t.prototype.showView=function(t){void 0===t&&(t=0),this._pro.open(t),g.GameResLoad.load("res/atlas/res/teamcopy.json")},t.prototype.onClick=function(t){i.RuledescManager.showRuledesc(t)},t.prototype.copyRenderHandler=function(t){for(var e=this,i=0;i<this._conArr.length;i++)this._conArr[i].visible=!1;v.TeamCopyMainCtrl.ins.hidePage();var n=!1;switch(t){case 0:this._materialview||(n=!0,this._materialview=new a.CopyView,this._conArr.push(this._materialview),this.bgview.box_page.addChild(this._materialview)),this.changeTitle(t),this.bgview.btn_help.visible=!0,this.bgview.btn_help.on(Laya.Event.CLICK,this,this.onClick,[7]),n?Laya.timer.frameOnce(3,this._materialview,this._materialview.showView):this._materialview.showView(),r.E.ins.event(l.EventName.COMPTYPE_CLICK,h.GuideTargetName.copy_tab_item1);break;case this.jingyan:this._expCopyView||(n=!0,this._expCopyView=new o.ExpCopyView,this._conArr.push(this._expCopyView),this.bgview.box_page.addChild(this._expCopyView)),this.bgview.btn_help.visible=!1,this.changeTitle(t),n?Laya.timer.frameOnce(3,this._expCopyView,this._expCopyView.showView):this._expCopyView.showView(),r.E.ins.event(l.EventName.COMPTYPE_CLICK,h.GuideTargetName.copy_tab_item3);break;case this.tongtianta:this._climbTower||(n=!0,this._climbTower=new s.ClimbTowerView,this.bgview.btn_help.visible=!0,this.bgview.btn_help.on(Laya.Event.CLICK,this,this.onClick,[6]),this._conArr.push(this._climbTower),this.bgview.box_page.addChild(this._climbTower),Laya.timer.frameOnce(2,this,function(){var t=c.UIUtils.getGlobalBound(e._climbTower.btn_fight);t&&u.GuideCenter.ins.registerInteractionArea(h.GuideTargetName.CLIMD_TOWER_BTN_FIGHT,t)})),this.bgview.btn_help.visible=!0,this.changeTitle(t),n?Laya.timer.frameOnce(3,this._climbTower,this._climbTower.showView):this._climbTower.showView(),r.E.ins.event(l.EventName.COMPTYPE_CLICK,h.GuideTargetName.copy_tab_item2);break;case 3:v.TeamCopyMainCtrl.ins.showPage(this.bgview.box_page),this.bgview.img_title.skin=v.TeamCopyMainCtrl.ins.getTitle(),this.bgview.btn_help.visible=!0,this.bgview.btn_help.on(Laya.Event.CLICK,this,this.onClick,[265])}0==t?r.E.ins.event(l.EventName.COMPTYPE_CLICK,h.GuideTargetName.copy_tab_item0):1==t?r.E.ins.event(l.EventName.COMPTYPE_CLICK,h.GuideTargetName.copy_tab_item1):2==t?r.E.ins.event(l.EventName.COMPTYPE_CLICK,h.GuideTargetName.copy_tab_item2):3==t&&r.E.ins.event(l.EventName.COMPTYPE_CLICK,h.GuideTargetName.copy_tab_item3)},t.prototype.getRebirthBossHurtRank=function(){var t=new p.OpNoParaC2GS;t.optype=p.EOpNopara.getRebirthBossHurtRank,d.GSM.sendServer(t)},t.prototype.changeTitle=function(t){switch(t){case 0:this.bgview.img_title.skin="res/title/fuben_biaoti_wenzi1.png";break;case this.tongtianta:this.bgview.img_title.skin="res/title/tongtianta_biaoti_wenzi1.png";break;case this.jingyan:this.bgview.img_title.skin="res/title/biaoti_jingyanfuben.png"}this.bgview.img_title.restskin()},t}(ui.copy.CopyPanelUI);e.CopyPanel=f}),define("src/g/copy/ctrl/CopyPanelCtrl",["require","exports","../../../core/E","../../../enum/EventName","src/g/copy/view/CopyPanel","../../../manager/LayerManager","../../../manager/RoleCenter","../../../utils/system/FloatEffect","src/init/Switches","src/g/accessctrl/AccessCenter","../../../manager/NewRedHintsCenter","../../../enum/GuideTargetName","../../../manager/GuideCenter","../../../utils/UIUtils"],function(t,e,n,s,o,a,i,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(){function t(){n.E.ins.on(s.EventName.GET_PAGODA_DAILY_REWARD,this,this.onGetDayBonus),l.Switches.ins.on(22,this,this.onOpenPage,[22]),l.Switches.ins.on(78,this,this.onOpenPage,[78]),l.Switches.ins.on(84,this,this.onOpenPage,[84]),l.Switches.ins.on(85,this,this.onOpenPage,[85]),l.Switches.ins.on(265,this,this.onOpenPage,[265]),i.RoleCenter.instans.vo?this.checkClimbTowerRed():n.E.ins.once(s.EventName.INIT_SELFSETOVER,this,this.checkClimbTowerRed),n.E.ins.on(s.EventName.PAGODA_DATA_CHANGED,this,this.onDataChanagedHandler)}return t.prototype.onOpenPage=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1),e&&(22==t?h.AccessCenter.ins.checkOpen(78)?this.showView(78,i,n):h.AccessCenter.ins.checkOpen(84)?this.showView(84,i,n):h.AccessCenter.ins.checkOpen(85)?window.enabledpay&&this.showView(85,i,n):h.AccessCenter.ins.checkOpen(265)&&this.showView(265,i,n):this.showView(t,i,n))},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._view||(this._view=new o.CopyPanel),n.E.ins.event(s.EventName.COMPTYPE_OPENVIEW,u.GuideTargetName.COPY_VIEW),a.LayerManager.addInPOPWindowLayer(this._view,e,!0,!0,!1,i),this._view.showView(t),this._isRegist||Laya.timer.frameOnce(2,this,this.registUIToGuide),p.GuideCenter.ins.registerGuideObject(u.GuideTargetName.copy_tab_item0,this._view),p.GuideCenter.ins.registerGuideObject(u.GuideTargetName.copy_tab_item1,this._view),p.GuideCenter.ins.registerGuideObject(u.GuideTargetName.copy_tab_item2,this._view),p.GuideCenter.ins.registerGuideObject(u.GuideTargetName.copy_tab_item3,this._view)},t.prototype.registUIToGuide=function(){var t=d.UIUtils.getGlobalBound(this._view.tabBar.getChildByName("item0"));t&&p.GuideCenter.ins.registerInteractionArea(u.GuideTargetName.copy_tab_item0,t),(t=d.UIUtils.getGlobalBound(this._view.tabBar.getChildByName("item1")))&&p.GuideCenter.ins.registerInteractionArea(u.GuideTargetName.copy_tab_item1,t),(t=d.UIUtils.getGlobalBound(this._view.tabBar.getChildByName("item2")))&&p.GuideCenter.ins.registerInteractionArea(u.GuideTargetName.copy_tab_item2,t),(t=d.UIUtils.getGlobalBound(this._view.tabBar.getChildByName("item3")))&&p.GuideCenter.ins.registerInteractionArea(u.GuideTargetName.copy_tab_item3,t),this._isRegist=!0},t.prototype.onGetDayBonus=function(t){t&&(i.RoleCenter.instans.addInventoryToC(t),r.FE.addInventoryToCFloats(t),i.RoleCenter.instans.vo.portPagoda.lastDayBonus=0,n.E.ins.event(s.EventName.PAGODA_DATA_CHANGED))},t.prototype.onDataChanagedHandler=function(){this.checkClimbTowerRed()},t.prototype.checkClimbTowerRed=function(){this.checkTowerDayBonusRed(),this.checkTowerTurntableRed()},t.prototype.checkTowerDayBonusRed=function(){i.RoleCenter.instans.vo&&0<i.RoleCenter.instans.vo.portPagoda.lastDayBonus?c.NewRedHintsCenter.ins.setRedHintOpenOrClose(c.enumRedHints.climb_tower_daily_reward,!0):c.NewRedHintsCenter.ins.setRedHintOpenOrClose(c.enumRedHints.climb_tower_daily_reward,!1)},t.prototype.checkTowerTurntableRed=function(){if(i.RoleCenter.instans.vo){var t=i.RoleCenter.instans.vo.portPagoda;if(t.mainPortId>t.portBonusIdx)return void c.NewRedHintsCenter.ins.setRedHintOpenOrClose(c.enumRedHints.climb_tower_turntable,!0)}c.NewRedHintsCenter.ins.setRedHintOpenOrClose(c.enumRedHints.climb_tower_turntable,!1)},t}();e.CopyPanelCtrl=g}),define("src/g/boss/ctrl/BossTimeCtrl",["require","exports","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../../config/GameConfig","../../../utils/system/ServerTime"],function(t,e,i,n,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this._loopqunmin=!1,this._qunminTime=0,this._loopshen=!1,this._shenTime=0,i.E.ins.on(n.EventName.CHECK_BOSS_TIME,this,this.checkBossTime)}return t.prototype._loopqunminHandler=function(){var t=a.RoleCenter.instans.vo.QUANMINGCOUNT,e=r.GameConfig.BossSetting[1],i=a.RoleCenter.instans.vo.bossData;t<e.quanmincount&&a.RoleCenter.instans.vo.QUANMINGCOUNT++,this._loopqunmin=!1,i.qmRecoverStartTime=l.ServerTime.serverTime,this.checkBossTime()},t.prototype._loopshenHandler=function(){var t=a.RoleCenter.instans.vo.WINGBOSSCOUNT,e=r.GameConfig.BossSetting[1],i=a.RoleCenter.instans.vo.bossData;t<e.shencount&&a.RoleCenter.instans.vo.WINGBOSSCOUNT++,this._loopshen=!1,i.shenRecoverStartTime=l.ServerTime.serverTime,this.checkBossTime()},t.prototype.checkBossTime=function(){var t=r.GameConfig.BossSetting[1],e=a.RoleCenter.instans.vo.bossData,i=a.RoleCenter.instans.vo.QUANMINGCOUNT,n=a.RoleCenter.instans.vo.WINGBOSSCOUNT;if(i>=t.quanmincount)Laya.timer.clear(this,this._loopqunminHandler),this._loopqunmin=!1,e.qmRecoverStartTime=0;else if(!this._loopqunmin){this._loopqunmin=!0;var s=t.quanminCd;0!=e.qmRecoverStartTime?(this._qunminTime=l.ServerTime.serverTime-e.qmRecoverStartTime,this._qunminTime<=0?this._qunminTime=s:this._qunminTime=s-this._qunminTime):(e.qmRecoverStartTime=l.ServerTime.serverTime,this._qunminTime=s),Laya.timer.once(1e3*this._qunminTime,this,this._loopqunminHandler)}if(n>=t.shencount)Laya.timer.clear(this,this._loopshenHandler),this._loopshen=!1,e.shenRecoverStartTime=0;else if(!this._loopshen){this._loopshen=!0;var o=t.shenCd;0!=e.shenRecoverStartTime?(this._shenTime=l.ServerTime.serverTime-e.shenRecoverStartTime,this._shenTime<=0?this._shenTime=o:this._shenTime=o-this._shenTime):(e.shenRecoverStartTime=l.ServerTime.serverTime,this._shenTime=o),Laya.timer.once(1e3*this._shenTime,this,this._loopshenHandler)}e.bossopen&&i>=t.quanmincount&&n>=t.shencount&&Laya.timer.clearAll(this)},t}();e.BossTimeCtrl=s}),define("src/g/boss/view/BossRewardView",["require","exports","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","../../../config/GameConfig","../../net/messages/ChangeSceneMsg"],function(t,e,h,i,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.btn_close.on(Laya.Event.CLICK,t,t.clickHandler),t}return __extends(t,e),t.prototype.clickHandler=function(){this.close()},t.prototype.close=function(t){void 0===t&&(t=""),e.prototype.close.call(this,t),Laya.loader.clearRes("res/atlas/res/bossreward.json",!0)},t.prototype.showView=function(t,e){this.popup();var i,n=h.ItemUtils.getBossId(t);if(i=n?n.type==u.EPlayType.PLAYTYPE_QUANMINBOSS?h.ItemUtils.getPort_quanmin(t):n.type==u.EPlayType.PLAYTYPE_SHENYUBOSS?h.ItemUtils.getPort_shenyu(t):n.type==u.EPlayType.PLAYTYPE_MIJINGBOSS?c.GameConfig.hunyinboss[t]:h.ItemUtils.getPort_vipboss(t):c.GameConfig.hunyinboss[t]){var s=i.holdAward[0][0];this.lv_txt.text=i.name;var o=h.ItemUtils.getItemOrEq(s);this.setItem(o,this.item0),this.setItem(o,this.item_0);for(var a=0;a<n.bonus.length;a++){var r=h.ItemUtils.getItemOrEq(n.bonus[a]);(l=this["item"+(a+1)])&&this.setItem(r,this["item"+(a+1)])}for(a=0;a<n.bonus.length;a++){var l;r=h.ItemUtils.getItemOrEq(n.bonus[a]);(l=this["item_"+(a+1)])&&this.setItem(r,l)}}},t.prototype.setItem=function(t,e){t&&i.ItemIconView.setItemData(t,e)},t}(ui.boss.BossRewardViewUI);e.BossRewardView=n}),define("src/g/boss/ctrl/BoossRewardViewCtrl",["require","exports","../../../core/E","../../../enum/EventName","src/g/boss/view/BossRewardView"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){}return t.prototype.init=function(){i.E.ins.on(n.EventName.BOSSREWARDOPEN,this,this.openView)},t.prototype.openView=function(t,e){Laya.loader.load([{url:"res/atlas/res/bossreward.json",type:Laya.Loader.ATLAS}],Laya.Handler.create(this,function(){(new s.BossRewardView).showView(t,e)}))},t}();e.BoossRewardViewCtrl=o}),define("src/g/boss/view/ZSRewardView",["require","exports","../../../manager/LayerManager"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.showView=function(){this.tab.selectedIndex=0,i.LayerManager.addInPOPWindowLayer(this,!1)},e}(ui.boss.ZSRewardViewUI);e.ZSRewardView=n}),define("src/g/boss/ctrl/ZSRewardViewCtrl",["require","exports","src/g/boss/view/ZSRewardView","../../../core/E","../../../enum/EventName","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","src/init/TextConst"],function(t,e,i,n,s,l,h,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){}return t.prototype.init=function(){n.E.ins.on(s.EventName.OPENZSREWARDVIEW,this,this.openView)},t.prototype.openView=function(){this._view||(this._view=new i.ZSRewardView),this._view.showView(),this.addEvent(),this.refreshKillData(1),this.refreshOtherData(401),this.tab_selectHandler(0)},t.prototype.addEvent=function(){this._view.btn_close.on(Laya.Event.CLICK,this,this.closeRoleView),this._view.btn_back.on(Laya.Event.CLICK,this,this.closeRoleView),this._view.tab.selectHandler=new Laya.Handler(this,this.tab_selectHandler)},t.prototype.closeRoleView=function(){this._view.removeSelf()},t.prototype.tab_selectHandler=function(t){switch(t){case 0:this._view.txt_title.text=o.TextConst.get(286),this.refreshKillData(t+1),this.refreshOtherData(t+401);break;case 1:this._view.txt_title.text=o.TextConst.get(287),this.refreshKillData(t+1),this.refreshOtherData(t+401);break;case 2:this._view.txt_title.text=o.TextConst.get(288),this.refreshKillData(t+1),this.refreshOtherData(t+401);break;case 3:this._view.txt_title.text=o.TextConst.get(289),this.refreshKillData(t+1),this.refreshOtherData(t+401);break;default:return}},t.prototype.refreshKillData=function(t){for(var e=0,i=4*t-3;i<=4*t;i++){e++;for(var n=l.ItemUtils.getPort_zhuangshengRank(i),s=0;s<4;s++)if(n.bonusshow[s]){var o=n.bonusshow[s][0],a=n.bonusshow[s][1],r=l.ItemUtils.getItemOrEq(o);this._view["item"+(e-1)+"_"+s].visible=!0,h.ItemIconView.setItemData(r,this._view["item"+(e-1)+"_"+s],a)}else this._view["item"+(e-1)+"_"+s].visible=!1}},t.prototype.refreshOtherData=function(t){var e=l.ItemUtils.getPort_zhuangsheng(t),i=e.killbouns[0][0],n=e.luckbonus[0][0],s=l.ItemUtils.getItemOrEq(i),o=l.ItemUtils.getItemOrEq(n);h.ItemIconView.setItemData(s,this._view.item14),h.ItemIconView.setItemData(o,this._view.item15)},t}();e.ZSRewardViewCtrl=a}),define("src/g/boss/ctrl/AotuFightCtrl",["require","exports","../../net/messages/ChangeSceneMsg","src/g/boss/vo/BossInfos","../../../manager/RoleCenter","../../../manager/StateManger","src/g/fight/info/PlayTypeVo","../../../enum/EventName","../../../core/E","../../../utils/ItemUtils","src/g/index/ctrl/BossTipCtrl","src/g/accessctrl/AccessCenter","../../net/messages/sbkSetData","../../net/messages/ActivityMessage","src/g/fight/osprite/play/PlayManager","../../../utils/system/ServerTime","../../../manager/GameSocketManager"],function(t,e,i,o,a,n,r,l,h,c,s,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(){function t(){}return t.init=function(){h.E.ins.on(l.EventName.PLAY_TYPE_CHANGED,this,this.restartHandler)},t.setBossID=function(t){s.BossTipCtrl.updateBoss()},t.restartHandler=function(){g.PlayManager.type==i.EPlayType.PLAYTYPE_PORT&&Laya.timer.once(2e3,this,this.onceHandler)},t.onceHandler=function(){Laya.timer.clear(this,this.delaHandler),Laya.timer.loop(3e3,this,this.delaHandler)},t.delaHandler=function(){if(g.PlayManager.type==i.EPlayType.PLAYTYPE_PORT&&o.BossInfos.isAutoFight&&f.GSM.connected&&a.RoleCenter.instans.bagRoomEnough()&&!n.StateManger.isSpecialPlay()&&a.RoleCenter.instans.vo.isSuperMonthCard){if(!u.AccessCenter.ins.checkOpen(73))return!1;if(0<a.RoleCenter.instans.vo.QUANMINGCOUNT){if(o.BossInfos.qmcdTime>v.ServerTime.serverTime)return;if(this.findBoss(o.BossInfos.allpersonBoss),this.bossTemp)return}if(!u.AccessCenter.ins.checkOpen(74))return!1;if(0<a.RoleCenter.instans.vo.WINGBOSSCOUNT){if(o.BossInfos.shencdTime>v.ServerTime.serverTime)return;this.findBoss(o.BossInfos.shenBoss)}else;}},t.findBoss=function(t){var e=a.RoleCenter.instans.vo;e.setData||(e.setData=new p.sbkSetData),this.bossTemp=null;for(var i=0;i<t.length;i++){var n=t[i];if(n.curstate!=d.EACTIVITY_STATE.INCD){var s=c.ItemUtils.getBossId(n.bossid);if(o.BossInfos.getBossID(s.id)==o.BossInfos.nobosstip)continue;if(s.lv>e.getCurLv())continue;this.bossTemp?this.bossTemp.lv<s.lv&&(this.bossTemp=s):this.bossTemp=s}}return!!this.bossTemp&&(h.E.ins.event(l.EventName.PLAY_TYPE_CHANGE,r.PlayTypeVo.create(this.bossTemp.type,this.bossTemp.id)),Laya.timer.clear(this,this.delaHandler),!0)},t.curpl="",t}();e.AotuFightCtrl=y}),define("src/g/boss/view/AllPersonItem",["require","exports","../../../manager/RoleCenter","../../../core/E","../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../utils/ItemUtils","../../net/messages/ActivityMessage","../../../manager/AM","../../../utils/system/DateUitl","../../../utils/system/ServerTime","../../../manager/StateManger","../../../manager/LayerManager","../../net/messages/ChangeSceneMsg","src/g/peronboss/view/ItemIconView","src/g/boss/ctrl/AotuFightCtrl","src/g/boss/vo/BossInfos","src/init/TextConst"],function(t,e,u,s,o,i,p,d,a,r,l,h,c,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t.$type=7;for(var e=0;e<3;e++){var i=t["item"+e]=new v.ItemIconView(.9);i.x=e*(.9*i.width)+10+120,i.y=40,t.addChild(i)}return t.btn_fight.on(Laya.Event.CLICK,t,t.fightHandler),s.E.ins.on(o.EventName.QUANMIN_EXIT,t,t.exitHandler),t.btn_select.on(Laya.Event.CLICK,t,t.selectClickHandler),t.btn_fight.visible=!1,t.tipLvl.visible=!1,t.yijisha.visible=!1,t}return __extends(t,n),t.prototype.selectClickHandler=function(){var t=this._bossvo;if(t){var e=this.select_ok;e.visible?(e.visible=!1,y.BossInfos.setBossID(t.id,y.BossInfos.nobosstip)):(e.visible=!0,y.BossInfos.setBossID(t.id,y.BossInfos.bosstip))}},t.prototype.exitHandler=function(){this.callLater(this.checkCdHandler)},t.prototype.checkCdHandler=function(){if(this.$data){var t,e=p.ItemUtils.getBossSettingVoById(1).reentercd;switch(this.$type){case g.EPlayType.PLAYTYPE_QUANMINBOSS:t=u.RoleCenter.instans.self.bossData.qmBossReEnterCd;break;default:t=u.RoleCenter.instans.self.bossData.shenBossReEnterCd}if(l.ServerTime.serverTime-t>e)this.btn_fight.disabled=!1,this.btn_fight.label=m.TextConst.get(341),0<=this.$data.cdtime||(this.btn_fight.visible=!0,this.btn_select.visible=!0);else{var i=t+e-l.ServerTime.serverTime;this.btn_fight.label=m.TextConst.get(293,i),this.btn_fight.disabled=!0,i<0?(s.E.ins.event(o.EventName.UPDATEBOSSSORT),Laya.timer.clearAll(this),this.btn_fight.disabled=!1,this.btn_fight.label=m.TextConst.get(341)):Laya.timer.once(1e3,this,this.checkCdHandler)}}},t.prototype.updateHandler=function(){var t=this.$data;if(t.curstate!=d.EACTIVITY_STATE.INREADY&&t){if(t.curstate!=d.EACTIVITY_STATE.INCD)return this.cd_txt.visible=!1,void(this.btn_fight.visible=!0);this.cd_txt.visible=!0,this.btn_fight.visible=!1,this.cd_txt.visible=!0,t.cdtime<=0?(Laya.timer.clear(this,this.updateHandler),this.cd_txt.visible=!1,this.btn_fight.visible=!0,this.hp_txt.text="100/100",this.progressbar.width=86):this.btn_fight.visible=!1;var e=t.cdtime-l.ServerTime.serverTime;0<=e?(this.cd_txt.text=m.TextConst.get(34,r.DateUtil.timeCountDown1(e)),this.cd_txt.visible=!0):(this.cd_txt.visible=!1,this.btn_fight.visible=!0,t.curstate=d.EACTIVITY_STATE.INREADY,y.BossInfos.getBossID(t.bossid)==y.BossInfos.bosstip&&f.AotuFightCtrl.setBossID(t))}},t.prototype.fightHandler=function(){if(this.$data)if(u.RoleCenter.instans.bagRoomEnough()){if(s.E.ins.event(o.EventName.CLOSEPERSONBOSS),!h.StateManger.isSpecialPlay()){var t=this.$type;switch(t){case g.EPlayType.PLAYTYPE_QUANMINBOSS:if(u.RoleCenter.instans.vo.QUANMINGCOUNT<=0)return void s.E.ins.event(o.EventName.peopleboss);s.E.ins.event(o.EventName.PLAY_TYPE_CHANGE,i.PlayTypeVo.create(t,this.$data.bossid)),c.LayerManager.closeAllPOPWindow();break;case g.EPlayType.PLAYTYPE_MOSTVIPBOSS1:case g.EPlayType.PLAYTYPE_MOSTVIPBOSS2:case g.EPlayType.PLAYTYPE_MOSTVIPBOSS3:s.E.ins.event(o.EventName.PLAY_TYPE_CHANGE,i.PlayTypeVo.create(t,this.$data.bossid)),c.LayerManager.closeAllPOPWindow();break;default:if(u.RoleCenter.instans.vo.WINGBOSSCOUNT<=0)return void s.E.ins.event(o.EventName.shenboss);s.E.ins.event(o.EventName.PLAY_TYPE_CHANGE,i.PlayTypeVo.create(g.EPlayType.PLAYTYPE_SHENYUBOSS,this.$data.bossid)),c.LayerManager.closeAllPOPWindow()}}}else a.AM.showBagNotEnough()},t.prototype.setData=function(t){var e=(this.$data=t).HP/t.HPMAX*100>>0||0;this.select_ok.visible=!0,y.BossInfos.getBossID(t.bossid)==y.BossInfos.nobosstip&&(this.select_ok.visible=!1),t.curstate==d.EACTIVITY_STATE.INCD?(Laya.timer.loop(1e3,this,this.updateHandler),this.hp_txt.text="0/100",this.progressbar.width=0):(Laya.timer.clear(this,this.updateHandler),this.hp_txt.text="100/100",this.progressbar.width=86,this.cd_txt.visible=!1,this.btn_fight.visible=!0),e&&(this.hp_txt.text=e+"/100",this.progressbar.width=e/100*86),this.tipLvl.text="",this.yijisha.visible=!1;var i,n=p.ItemUtils.getBossId(t.bossid),s=(this._bossvo=n).type;this.$type=s,this.checkCdHandler();for(var o=0;o<n.bonus.length;o++){var a=p.ItemUtils.getItemOrEq(n.bonus[o]);this["item"+o].setData(a),0==o&&(i=a)}var r=this.bgColor,l=!0;switch(s){case g.EPlayType.PLAYTYPE_QUANMINBOSS:r.skin="res/boss/diban_lan.png";break;case g.EPlayType.PLAYTYPE_MOSTVIPBOSS1:r.skin="res/boss/diban_cheng.png";break;case g.EPlayType.PLAYTYPE_MOSTVIPBOSS2:r.skin="res/boss/diban_hong.png";break;case g.EPlayType.PLAYTYPE_MOSTVIPBOSS3:r.skin="res/boss/diban_jin.png";break;case g.EPlayType.PLAYTYPE_SHENYUBOSS:r.skin="res/boss/diban_zi.png";break;default:l=!1}r.visible=l;var h=!0,c=n.lv;c>u.RoleCenter.instans.vo.getCurLv()?(this.select_ok.visible=!1,this.btn_fight.removeSelf(),i&&(h=!1,this.tipLvl.text=m.TextConst.get(15,p.ItemUtils.getEquipLv(c)))):this.addChild(this.btn_fight),this.btn_select.visible=h,this.danwei.skin=1e3<c?"res/boss/dengji_zhuan.png":"res/boss/dengji_ji.png",this.bosslvl_txt.value=(1e3<c?Math.floor(c/1e3):c)+"",this.m_icon.skin=p.ItemUtils.getBossIconByPort(n.port),this.bossName.text=n.name,this.updateHandler()},t}(ui.boss.AllPersonItemUI);e.AllPersonItem=n}),define("src/g/boss/view/AllPersonView",["require","exports","../../../config/GameConfig","src/g/boss/view/AllPersonItem","../../../manager/GameSocketManager","../../../core/GNet","../../net/messages/QuanMinBossMsg","../../net/messages/ActivityMessage","../../../manager/RoleCenter","../../../core/E","../../../enum/EventName","src/g/boss/vo/BossInfos","../../../utils/ItemUtils","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","../../../utils/system/ServerTime","../../../manager/AM","src/init/TextConst","src/g/custom/detailDlgs/Details_Item"],function(t,e,i,n,s,o,a,r,c,l,h,u,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(e){function t(){var t=e.call(this)||this;return t.itemid=762,t._bossset=i.GameConfig.BossSetting[1],t.panelList.vScrollBarSkin="",t.panelList.itemRender=n.AllPersonItem,t.panelList.scrollBar.elasticDistance=50,t.panelList.renderHandler=new Laya.Handler(t,t.updateItem),s.GSM.ins.on(a.MultiUserCopyStateGS2C.KEY,t,t.onQMBossData),l.E.ins.on(h.EventName.UPDATEBOSSSORT,t,t.updateHandler),l.E.ins.on(h.EventName.CHECK_BOSS_TIME,t,t.updateBossTime),t.btn_auto.on(Laya.Event.CLICK,t,t.openAutoHandler),t.btn_buy.on(Laya.Event.CLICK,t,t.buyHandler),l.E.ins.on(h.EventName.peopleboss,t,t.buyHandler),l.E.ins.on(h.EventName.CHANGEITEM_COUNT,t,t.onChangeItem),t.btn_auto.visible=window.enabledpay,t}return __extends(t,e),t.prototype.buyHandler=function(){var t=c.RoleCenter.instans.vo.bagdata.getItemCount(this.itemid);if(0<t){var e=new m.Details_Item;return e.initData(this.itemvo,t,!0),void e.popup()}var i=10,n=c.RoleCenter.instans.vo.bossData.qmBossBuyCount,s=this._bossset.quanminbuymax-n;0<s?(i=this._bossset.quanminbuycost[n],f.AM.show(y.TextConst.get(932,i,s,this._bossset.quanminbuymax),Laya.Handler.create(this,this.buyCount))):d.FE.upItems(y.TextConst.get(295),g.BubbleEnum.center)},t.prototype.buyCount=function(){var t=new r.BuyActivityCountC2GS;t.acttype=r.EACT_TYPE.quanminBoss,s.GSM.sendServer(t)},t.prototype.openAutoHandler=function(){c.RoleCenter.instans.vo.isSuperMonthCard?(this._bossOpen||(this._bossOpen=new ui.boss.BossAutoOpenUI,this._bossOpen.btn_close.on(Laya.Event.CLICK,this,this.closeHandler),this._bossOpen.btn_open.on(Laya.Event.CLICK,this,this.openHandler),this._bossOpen.desc.style.fontSize=18,this._bossOpen.desc.style.color="#c0b4a3",this._bossOpen.desc.style.leading=5,this._bossOpen.desc.innerHTML=i.GameConfig.Ruledesc[23].tmptext),this._bossOpen.popup()):d.FE.upItems(y.TextConst.get(296),g.BubbleEnum.center)},t.prototype.openHandler=function(){this._bossOpen.btn_open.visible=!1,this._bossOpen.btn_close.visible=!0,u.BossInfos.isAutoFight=!1},t.prototype.closeHandler=function(){this._bossOpen.btn_open.visible=!0,this._bossOpen.btn_close.visible=!1,u.BossInfos.isAutoFight=!0},t.prototype.updateBossTime=function(){if(0!=this.visible){var t=c.RoleCenter.instans.vo.bossData;if(this.time_value_txt.text=c.RoleCenter.instans.vo.QUANMINGCOUNT+"/"+this._bossset.quanmincount,this.time_value_txt.color=0==c.RoleCenter.instans.vo.QUANMINGCOUNT?"#ff0f15":"#03bb00",0==t.qmRecoverStartTime)this.lab_reTime.visible=!1;else if(c.RoleCenter.instans.vo.QUANMINGCOUNT>=this._bossset.quanmincount)this.lab_reTime.visible=!1;else{this.lab_reTime.visible=!0;var e=this._bossset.quanminCd,i=v.ServerTime.serverTime,n=e-(i-t.qmRecoverStartTime);n<=0&&(n=0,t.qmRecoverStartTime=i);var s=Math.floor(n/60),o=n%60;this.lab_reTime.text=y.TextConst.get(297,s/10<1?"0"+s:s,o/10<1?"0"+o:o)}}},t.prototype.onQMBossData=function(t){t.activityType==r.EACT_TYPE.quanminBoss&&this.updateHandler(),l.E.ins.event(h.EventName.PERSION_BOSS_DIE)},t.prototype.updateHandler=function(){for(var t=c.RoleCenter.instans.vo.getCurLv(),e=u.BossInfos.allpersonBoss,i=[],n=0;n<e.length;n++){var s=e[n];(l=p.ItemUtils.getBossId(s.bossid)).lv<=t&&i.push(s)}i=i.reverse(),u.BossInfos.checkBossID(i),this.panelList.scrollTo(0);for(var o=-1,a=(this.panelList.array=e).length,r=0;r<a;r++){s=e[r];var l=p.ItemUtils.getBossId(s.bossid),h=u.BossInfos.getBossID(s.bossid);if(h==u.BossInfos.defbosstip||h==u.BossInfos.bosstip){if(h==u.BossInfos.defbosstip&&-1!=o)continue;if(l.lv>t)break;if(o=r,h==u.BossInfos.bosstip)break}}if(-1!=o){2<=o&&this.panelList.scrollTo(o-2),this.panelList.tweenTo(o)}},t.prototype.showView=function(){this.visible=!0,l.E.ins.event(h.EventName.CHECK_BOSS_TIME);var t=c.RoleCenter.instans.vo.WINGBOSSCOUNT;this.time_value_txt.text=c.RoleCenter.instans.vo.QUANMINGCOUNT+"/"+this._bossset.quanmincount,this.updateBossTime(),o.GNet.getAllPersonBoss(),this.btn_auto.gray=!c.RoleCenter.instans.vo.isSuperMonthCard,t<this._bossset.quanmincount?Laya.timer.loop(1e3,this,this.updateBossTime):Laya.timer.clearAll(this),this.updateTip()},t.prototype.onChangeItem=function(t,e){t==this.itemid&&this.updateTip()},t.prototype.updateTip=function(){var t=this.itemid;this.itemvo||(this.itemvo=p.ItemUtils.getItemOrEq(t),this.tip_icon.skin=p.ItemUtils.getIconByIconId(this.itemvo.icon));var e=c.RoleCenter.instans.vo.bagdata.getItemCount(t);this.count_txt.text=":"+e+")",this.con.visible=e?(this.lab_reTime.x=this.btn_buy.x+this.btn_buy.width,!0):(this.lab_reTime.x=this.btn_buy.x+this.btn_buy.width/2,!1)},t.prototype.updateItem=function(t,e){t.setData(t.dataSource)},t.allpersonHps={},t}(ui.boss.AllPersonViewUI);e.AllPersonView=_}),define("src/g/boss/view/MonBossPop",["require","exports","src/g/clearRes/ClearResM","src/init/Switches","src/init/TextConst"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.closeH=function(){this.handler&&(this.handler.clear(),this.handler=null),t.prototype.close.call(this)},e.prototype.fightHandler=function(){this.handler&&(this.handler.run(),this.handler.clear()),this.closeH(),i.ClearResM.clearUrl(this.bg.skin)},e.prototype.close=function(){},e.prototype.showView=function(t){if(window.enabledpay){this.handler=t,this.popup();this.btn_fight.on(Laya.Event.CLICK,this,this.fightHandler),this.bgview.btn_back.visible=!1,this.bgview.btn_close.on(Laya.Event.CLICK,this,this.closeH)}},e.prototype.buyHandler=function(){if(window.enabledpay){this.btn_fight.on(Laya.Event.CLICK,this,this.buyH),this.bgview.btn_back.visible=!1,this.bgview.btn_close.on(Laya.Event.CLICK,this,this.closeH),this.popup(),this.btn_fight.label=s.TextConst.get(301)}},e.prototype.buyH=function(){n.Switches.ins.event(12),this.closeH()},e}(ui.alert.MonPopUI);e.MonBossPop=o}),define("src/g/copy/view/PersonBossUtil",["require","exports","../../../manager/RoleCenter","../../net/messages/ChangeSceneMsg"],function(t,e,n,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.getIndex=function(t){return n.RoleCenter.instans.self.bossData.bossprivatePort.indexOf(t.port)},t.checkVip=function(t){return t==i.EPlayType.PLAYTYPE_VIPBOSS||t==i.EPlayType.PLAYTYPE_MONTHBOSS||t==i.EPlayType.PLAYTYPE_SUPERBOSS},t.checkVipLv=function(t){var e=t.lv/1e5>>0,i=t.lv%1e5;return n.RoleCenter.instans.vo.getCurLv()>=i&&n.RoleCenter.instans.vo.VIP>=e},t.getVipLv=function(t){return t.lv/1e5>>0},t.getRoleLv=function(t){return t.lv%1e5},t}();e.PersonBossUtil=s}),define("src/g/boss/view/PersonWelfareBossItem",["require","exports","../../../manager/RoleCenter","../../../core/E","../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../utils/ItemUtils","../../net/messages/ActivityMessage","../../../manager/AM","../../../utils/system/DateUitl","../../../utils/system/ServerTime","../../../manager/StateManger","../../../manager/LayerManager","../../net/messages/ChangeSceneMsg","src/g/peronboss/view/ItemIconView","src/g/boss/ctrl/AotuFightCtrl","src/g/boss/vo/BossInfos","src/init/TextConst","src/g/boss/view/MonBossPop","src/init/Switches","../../../enum/GuideTargetName","src/g/copy/view/PersonBossUtil"],function(t,e,r,s,o,i,l,a,h,c,u,p,d,g,v,f,y,m,_,C,I,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t.$type=7;for(var e=0;e<3;e++){var i=t["item"+e]=new v.ItemIconView(.9);i.x=e*(.9*i.width)+10+120,i.y=40,t.addChild(i)}return t.btn_fight.on(Laya.Event.CLICK,t,t.fightHandler),s.E.ins.on(o.EventName.QUANMIN_EXIT,t,t.exitHandler),t.btn_select.on(Laya.Event.CLICK,t,t.selectClickHandler),t.date=new Date,t}return __extends(t,n),t.prototype.selectClickHandler=function(){var t=this._bossvo;if(t){var e=this.select_ok;e.visible?(e.visible=!1,y.BossInfos.setBossID(t.id,y.BossInfos.nobosstip)):(e.visible=!0,y.BossInfos.setBossID(t.id,y.BossInfos.bosstip))}},t.prototype.exitHandler=function(){this.callLater(this.checkCdHandler)},t.prototype.checkCdHandler=function(){},t.prototype.updateHandler=function(){var t=this.$data;if(t.curstate!=a.EACTIVITY_STATE.INREADY&&t){if(t.curstate!=a.EACTIVITY_STATE.INCD)return this.cd_txt.visible=!1,void(this.btn_fight.visible=!0);this.cd_txt.visible=!0,this.btn_fight.visible=!1,this.cd_txt.visible=!0,t.cdtime<=0?(Laya.timer.clear(this,this.updateHandler),this.cd_txt.visible=!1,this.btn_fight.visible=!0,this.hp_txt.text="100/100",this.progressbar.width=86):this.btn_fight.visible=!1;var e=t.cdtime-u.ServerTime.serverTime;0<=e?(this.cd_txt.text=m.TextConst.get(34,c.DateUtil.timeCountDown1(e)),this.cd_txt.visible=!0):(this.cd_txt.visible=!1,this.btn_fight.visible=!0,t.curstate=a.EACTIVITY_STATE.INREADY,y.BossInfos.getBossID(t.bossid)==y.BossInfos.bosstip&&f.AotuFightCtrl.setBossID(t))}},t.prototype.fightHandler=function(){if(p.StateManger.enterFight()&&this.$data)if(this.$data.type!=g.EPlayType.PLAYTYPE_SUPERBOSS||r.RoleCenter.instans.vo.isSuperMonthCard){if(this.$data.type==g.EPlayType.PLAYTYPE_MONTHBOSS){var t=r.RoleCenter.instans.vo.isMonthCard;if(r.RoleCenter.instans.vo.bossData.bossprivatePass[this._index]){if(!t)return void(window.enabledpay&&h.AM.show(m.TextConst.get(306),new Laya.Handler(this,function(){C.Switches.ins.event(12)}),null))}else if(!t){if(window.enabledpay)(new _.MonBossPop).showView(new Laya.Handler(this,this.handler));return}}s.E.ins.event(o.EventName.COMPTYPE_CLICK,I.GuideTargetName.PERSON_BOSS_BTN_FIGHT),d.LayerManager.closeAllPOPWindow(),this.handler()}else window.enabledpay&&h.AM.show(m.TextConst.get(349),new Laya.Handler(this,function(){C.Switches.ins.event(122)}),null)},t.prototype.handler=function(){s.E.ins.event(o.EventName.PLAY_TYPE_CHANGE,i.PlayTypeVo.create(g.EPlayType.PLAYTYPE_PRIBOSS,{idx:this._index,boss:this.$data},!0))},t.prototype.setData=function(t){this.$data=t,this.tipLvl.text="";var e=l.ItemUtils.getBossId(t.id);this._bossvo=e,this._index=b.PersonBossUtil.getIndex(e);var i=e.type;this.$type=i,this.select_ok.visible=!0,y.BossInfos.getBossID(e.id)==y.BossInfos.nobosstip&&(this.select_ok.visible=!1);for(var n=0;n<e.bonus.length;n++){var s=l.ItemUtils.getItemOrEq(e.bonus[n]);this["item"+n].setData(s),0==n&&s}var o=r.RoleCenter.instans.self.bossData.bossprivateNum[this._index];if(t.type==g.EPlayType.PLAYTYPE_MONTHBOSS)this.vip_bg.visible=!1,this.yuekatype.visible=!0,this.bosstype.visible=!0,this.yuekatype.skin="res/boss/zz_tubiao_006.png",this.bosstype.skin="res/boss/zz_wenzi_001.png",this.btn_select.visible=!0;else if(t.type==g.EPlayType.PLAYTYPE_SUPERBOSS)this.vip_bg.visible=!1,this.yuekatype.visible=!0,this.bosstype.visible=!0,this.yuekatype.skin="res/boss/zz_tubiao_005.png",this.bosstype.skin="res/boss/zz_wenzi_002.png",this.btn_select.visible=!0;else{var a=b.PersonBossUtil.getVipLv(t);this.btn_fight.visible&&(this.btn_fight.visible=b.PersonBossUtil.checkVipLv(t)),a<10&&(this.vip_num.x=49),10<=a&&(this.vip_num.x=42,this.vip_num.spaceX=-10),this._index<0?(this.yijisha.visible=!1,this.btn_fight.visible=!1,this.tipLvl.visible=!0,this.tipLvl.text="VIP"+a+"开启",this.btn_select.visible=!1):(this.tipLvl.visible=!1,this.btn_select.visible=!0),this.yuekatype.visible=!1,this.bosstype.visible=!1,this.vip_bg.visible=!0,this.vip_num.value=a+""}0<=this._index&&(0<o?(this.btn_fight.visible=!0,this.yijisha.visible=!1,this.btn_fight.label="挑战",t.type==g.EPlayType.PLAYTYPE_MONTHBOSS&&(r.RoleCenter.instans.vo.bossData.bossprivatePass[this._index]?this.btn_fight.label="挑战":this.btn_fight.label="免费挑战")):(this.btn_fight.visible=!1,this.yijisha.visible=!0));this.m_icon.skin=l.ItemUtils.getBossIconByPort(e.port)},t}(ui.boss.PersonWelfareBossItemUI);e.PersonWelfareBossItem=n}),define("src/g/boss/view/PersonWelfareBossView",["require","exports","../../../config/GameConfig","src/g/boss/view/PersonWelfareBossItem","../../../manager/GameSocketManager","../../net/messages/ActivityMessage","../../../manager/RoleCenter","../../../core/E","../../../enum/EventName","src/g/boss/vo/BossInfos","../../../utils/ItemUtils","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","../../../manager/AM","src/init/TextConst","src/g/custom/detailDlgs/Details_Item","../../net/messages/ChangeSceneMsg","src/g/copy/view/PersonBossUtil","../../../utils/system/DateUitl","src/g/index/ctrl/BossTipCtrl","src/g/accessctrl/AccessCenter"],function(t,e,r,i,n,s,c,l,h,u,p,o,a,d,g,v,f,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var I=function(e){function t(){var t=e.call(this)||this;t.itemid=762,t._bossset=r.GameConfig.BossSetting[1],t.panelList.vScrollBarSkin="",t.panelList.itemRender=i.PersonWelfareBossItem,t.panelList.scrollBar.elasticDistance=50,t.panelList.renderHandler=new Laya.Handler(t,t.updateItem);n.GSM.ins;return l.E.ins.on(h.EventName.UPDATEBOSSSORT,t,t.updateHandler),l.E.ins.on(h.EventName.CHECK_BOSS_TIME,t,t.updateBossTime),l.E.ins.on(h.EventName.REFRESH_BOSS_TIME,t,t.updateBossTime),l.E.ins.on(h.EventName.CHANGEITEM_COUNT,t,t.onChangeItem),l.E.ins.on(h.EventName.UPDATEPERSONBOSS,t,t.updateBossData),Laya.timer.loop(1e3,t,t.updateTime),t.time_value_txt.visible=!1,t}return __extends(t,e),t.prototype.updateTime=function(){var t=m.DateUtil.getServerDate();if(this.time_value_txt.visible=!0,this.time_value_txt){var e=void 0;if(12<=t.getHours()){var i=23-t.getHours();e=i<10?"0"+i:i}else{var n=11-t.getHours();e=n<10?"0"+n:n}var s=void 0,o=59-t.getMinutes();s=o<10?"0"+o:o;var a=void 0,r=60-t.getSeconds();a=r<10?"0"+r:r,this.time_value_txt.text=e+":"+s+":"+a,this.time_value_txt.color="#03bb00"}},t.prototype.updateBossData=function(){this.showView();var t=m.DateUtil.getServerDate(),e=t.getHours(),i=t.getMinutes(),n=t.getSeconds();if(12==e&&0==i&&n<3||0==e&&0==i&&n<3){var s=this.panelList.array;if(0<s.length)for(var o=0;o<s.length;o++){var a=s[o],r=p.ItemUtils.getBossId(a.id),l=y.PersonBossUtil.getIndex(r),h=u.BossInfos.getBossID(r.id);if(C.AccessCenter.ins.checkOpen(75)&&a.type==f.EPlayType.PLAYTYPE_VIPBOSS&&0<=l&&(h==u.BossInfos.bosstip||h==u.BossInfos.defbosstip)){window.enabledpay&&_.BossTipCtrl.showBossReLifePanel(r);break}}}},t.prototype.buyHandler=function(){var t=c.RoleCenter.instans.vo.bagdata.getItemCount(this.itemid);if(0<t){var e=new v.Details_Item;return e.initData(this.itemvo,t,!0),void e.popup()}var i=10,n=c.RoleCenter.instans.vo.bossData.qmBossBuyCount,s=this._bossset.quanminbuymax-n;0<s?(i=this._bossset.quanminbuycost[n],d.AM.show(g.TextConst.get(932,i,s,this._bossset.quanminbuymax),Laya.Handler.create(this,this.buyCount))):o.FE.upItems(g.TextConst.get(295),a.BubbleEnum.center)},t.prototype.buyCount=function(){var t=new s.BuyActivityCountC2GS;t.acttype=s.EACT_TYPE.quanminBoss,n.GSM.sendServer(t)},t.prototype.openAutoHandler=function(){c.RoleCenter.instans.vo.isSuperMonthCard?(this._bossOpen||(this._bossOpen=new ui.boss.BossAutoOpenUI,this._bossOpen.btn_close.on(Laya.Event.CLICK,this,this.closeHandler),this._bossOpen.btn_open.on(Laya.Event.CLICK,this,this.openHandler),this._bossOpen.desc.style.fontSize=18,this._bossOpen.desc.style.color="#c0b4a3",this._bossOpen.desc.style.leading=5,this._bossOpen.desc.innerHTML=r.GameConfig.Ruledesc[23].tmptext),this._bossOpen.popup()):o.FE.upItems(g.TextConst.get(296),a.BubbleEnum.center)},t.prototype.openHandler=function(){this._bossOpen.btn_open.visible=!1,this._bossOpen.btn_close.visible=!0,u.BossInfos.isAutoFight=!1},t.prototype.closeHandler=function(){this._bossOpen.btn_open.visible=!0,this._bossOpen.btn_close.visible=!1,u.BossInfos.isAutoFight=!0},t.prototype.updateBossTime=function(){},t.prototype.onQMBossData=function(t){t.activityType==s.EACT_TYPE.quanminBoss&&this.updateHandler(),l.E.ins.event(h.EventName.PERSION_BOSS_DIE)},t.prototype.updateHandler=function(){for(var t=c.RoleCenter.instans.vo.getCurLv(),e=u.BossInfos.vipboss,i=[],n=0;n<e.length;n++){var s=e[n];(l=p.ItemUtils.getBossId(s.bossid)).lv<=t&&i.push(s)}i=i.reverse(),u.BossInfos.checkBossID(i),this.panelList.scrollTo(0);for(var o=-1,a=(this.panelList.array=e).length,r=0;r<a;r++){s=e[r];var l=p.ItemUtils.getBossId(s.bossid),h=u.BossInfos.getBossID(s.bossid);if(h==u.BossInfos.defbosstip||h==u.BossInfos.bosstip){if(h==u.BossInfos.defbosstip&&-1!=o)continue;if(l.lv>t)break;if(o=r,h==u.BossInfos.bosstip)break}}if(-1!=o){2<=o&&this.panelList.scrollTo(o-2),this.panelList.tweenTo(o)}},t.prototype.refresh=function(){for(var t=this.panelList.array,e=[],i=t.length-1;0<=i;i--){var n=t[i],s=y.PersonBossUtil.getIndex(n),o=c.RoleCenter.instans.self.bossData.bossprivateNum[s];0==o&&(t.splice(i,1),e.push(n))}for(var a=0;a<e.length;a++)t.push(e[a]);this.panelList.array=t,this.panelList.refresh()},t.prototype.showView=function(){this.visible=!0,l.E.ins.event(h.EventName.CHECK_BOSS_TIME);var t=r.GameConfig.bossjson,e=[],i=(c.RoleCenter.instans.self.bossData.bossprivatePort,c.RoleCenter.instans.vo.VIP);if(c.RoleCenter.instans.self.bossData.bossopen)for(var n in t){var s=t[n];y.PersonBossUtil.checkVip(s.type)&&s.lv<=1e5*(i+3)+40&&e.push(s)}for(var o=[],a=1;a<9;a++)o.push(1e5*(i+a)+40);for(a=0;a<o.length;a++)for(var n in t){6==(s=t[n]).type&&s.lv==o[a]&&e.push(s)}this.panelList.array=e,this.refresh()},t.prototype.onChangeItem=function(t,e){t==this.itemid&&this.updateTip()},t.prototype.updateTip=function(){},t.prototype.updateItem=function(t,e){t.setData(t.dataSource)},t.allpersonHps={},t}(ui.boss.PersonWelfareBossViewUI);e.PersonWelfareBossView=I}),define("src/g/boss/view/ShenYUView",["require","exports","../../../manager/RoleCenter","../../../manager/GameSocketManager","../../../core/GNet","src/g/boss/view/AllPersonItem","../../../config/GameConfig","../../net/messages/QuanMinBossMsg","../../net/messages/ActivityMessage","../../../core/E","../../../enum/EventName","src/g/boss/vo/BossInfos","../../../utils/ItemUtils","../../../utils/system/ServerTime","../../../manager/AM","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/init/TextConst","src/g/custom/detailDlgs/Details_Item"],function(t,e,c,i,n,s,o,a,r,l,h,u,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(e){function t(){var t=e.call(this)||this;return t.itemid=763,t._bossset=o.GameConfig.BossSetting[1],t.panelList.itemRender=s.AllPersonItem,t.panelList.scrollBar.elasticDistance=50,t.panelList.renderHandler=new Laya.Handler(t,t.updateItem),i.GSM.ins.on(a.MultiUserCopyStateGS2C.KEY,t,t.onShenBossData),l.E.ins.on(h.EventName.UPDATEBOSSSORT,t,t.updateHandler),l.E.ins.on(h.EventName.CHECK_BOSS_TIME,t,t.updateBossTime),t.btn_buy.on(Laya.Event.CLICK,t,t.buyHandler),l.E.ins.on(h.EventName.shenboss,t,t.buyHandler),l.E.ins.on(h.EventName.CHANGEITEM_COUNT,t,t.onChangeItem),t}return __extends(t,e),t.prototype.onChangeItem=function(t,e){t==this.itemid&&this.updateTip()},t.prototype.buyHandler=function(){var t=c.RoleCenter.instans.vo.bagdata.getItemCount(this.itemid);if(0<t){var e=new m.Details_Item;return e.initData(this.itemvo,t,!0),void e.popup()}var i=10,n=c.RoleCenter.instans.vo.bossData.shenBossBuyCount,s=this._bossset.shenbuymax-n;0<s?(i=this._bossset.shenbuycost[n],g.AM.show(y.TextConst.get(932,i,s,this._bossset.shenbuymax),Laya.Handler.create(this,this.buyCount))):v.FE.upItems(y.TextConst.get(295),f.BubbleEnum.center)},t.prototype.buyCount=function(){var t=new r.BuyActivityCountC2GS;t.acttype=r.EACT_TYPE.shenBoss,i.GSM.sendServer(t)},t.prototype.updateBossTime=function(){if(0!=this.visible){var t=this._bossset,e=c.RoleCenter.instans.vo.bossData;if(this.time_value_txt.text=c.RoleCenter.instans.vo.WINGBOSSCOUNT+"/"+t.shencount,this.time_value_txt.color=0==c.RoleCenter.instans.vo.WINGBOSSCOUNT?"#ff0f15":"#03bb00",0==e.shenRecoverStartTime)this.lab_reTime.visible=!1;else{this.lab_reTime.visible=!0;var i=t.shenCd,n=d.ServerTime.serverTime,s=i-(n-e.shenRecoverStartTime);s<=0&&(s=0,e.shenRecoverStartTime=n),s=Math.min(i,s);var o=Math.floor(s/60),a=s%60;this.lab_reTime.text=y.TextConst.get(297,o/10<1?"0"+o:o,a/10<1?"0"+a:a)}}},t.prototype.onShenBossData=function(t){t.activityType==r.EACT_TYPE.shenBoss&&Laya.timer.frameOnce(2,this,this.updateHandler)},t.prototype.updateHandler=function(){for(var t=c.RoleCenter.instans.vo.getCurLv(),e=u.BossInfos.shenBoss,i=[],n=0;n<e.length;n++){var s=e[n];(l=p.ItemUtils.getBossId(s.bossid)).lv<=t&&i.push(s)}i=i.reverse(),u.BossInfos.checkBossID(i),this.panelList.scrollTo(0);for(var o=-1,a=(this.panelList.array=e).length,r=0;r<a;r++){s=e[r];var l=p.ItemUtils.getBossId(s.bossid),h=u.BossInfos.getBossID(s.bossid);if(h==u.BossInfos.defbosstip||h==u.BossInfos.bosstip){if(h==u.BossInfos.defbosstip&&-1!=o)continue;if(l.lv>t)break;if(o=r,h==u.BossInfos.bosstip)break}}if(-1!=o){2<=o&&this.panelList.scrollTo(o-2),this.panelList.tweenTo(o)}},t.prototype.showView=function(){var t=c.RoleCenter.instans.vo.WINGBOSSCOUNT;this.visible=!0,this.updateBossTime(),n.GNet.getShenYuBoss(),this.panelList.scrollTo(0),t<this._bossset.shencount?Laya.timer.loop(1e3,this,this.updateBossTime):Laya.timer.clearAll(this),l.E.ins.event(h.EventName.CHECK_BOSS_TIME),this.updateTip()},t.prototype.updateTip=function(){this.itemvo||(this.itemvo=p.ItemUtils.getItemOrEq(this.itemid),this.tip_icon.skin=p.ItemUtils.getIconByIconId(this.itemvo.icon));var t=c.RoleCenter.instans.vo.bagdata.getItemCount(this.itemid);this.count_txt.text=":"+t+")",this.con.visible=!1,this.con.visible=t?(this.lab_reTime.x=this.btn_buy.x+this.btn_buy.width,!0):(this.lab_reTime.x=this.btn_buy.x+this.btn_buy.width/2,!1)},t.prototype.updateItem=function(t,e){t.setData(t.dataSource)},t}(ui.boss.ShenYUViewUI);e.ShenYUView=_}),define("src/g/boss/view/ZhizunChildView",["require","exports","../../../manager/RoleCenter","src/g/boss/vo/BossInfos","../../net/messages/ChangeSceneMsg","../../../utils/ItemUtils","../../net/messages/ActivityMessage"],function(t,e,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.changeCurrVipInfo=function(t,e){for(var i=g.RoleCenter.instans.vo,n=t.length,s=0;s<n;s++){var o=this["vip"+s],a=!1;e==s&&(a=!0),a&&(this.selectVip.x=o.x-10,this.selectVip.y=o.y-10);var r=!1;i.VIP<t[s]&&(r=!0),o.disabled=r,o.mouseEnabled=!0}var l=v.BossInfos.vipboss;n=l.length;var h=[f.EPlayType.PLAYTYPE_MOSTVIPBOSS1,f.EPlayType.PLAYTYPE_MOSTVIPBOSS2,f.EPlayType.PLAYTYPE_MOSTVIPBOSS3],c=[],u=[];for(s=0;s<n;s++){var p=l[s],d=y.ItemUtils.getBossId(p.bossid);d.type==h[e]&&(d.lv>g.RoleCenter.instans.vo.getCurLv()?u.push(p):c.push(p))}c.sort(function(t,e){var i=y.ItemUtils.getBossId(t.bossid),n=y.ItemUtils.getBossId(e.bossid);return i.lv>n.lv?-1:1}),c.sort(function(t,e){return t.curstate==m.EACTIVITY_STATE.INCD?1:-1}),u.sort(function(t,e){var i=y.ItemUtils.getBossId(t.bossid),n=y.ItemUtils.getBossId(e.bossid);return i.lv>n.lv?1:-1}),this.vipbossList.array=c.concat(u),this.vipbossList.scrollTo(0)},e}(ui.boss.ZhizunChildViewUI);e.ZhizunChildView=i}),define("src/g/boss/view/ZhizunPersonItem",["require","exports","src/g/boss/view/AllPersonItem","../../net/messages/ChangeSceneMsg","../../net/messages/ActivityMessage"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.checkCdHandler=function(){switch(this.$type){case n.EPlayType.PLAYTYPE_MOSTVIPBOSS1:case n.EPlayType.PLAYTYPE_MOSTVIPBOSS2:case n.EPlayType.PLAYTYPE_MOSTVIPBOSS3:var t=!1;return this.$data.curstate==s.EACTIVITY_STATE.INCD&&(t=!0),this.yijisha.visible=t,this.btn_fight.visible=!t,void(this.btn_select.visible=!1)}},t.prototype.updateHandler=function(){},t.prototype.setData=function(t){e.prototype.setData.call(this,t),this.btn_select.visible=!1},t}(i.AllPersonItem);e.ZhizunPersonItem=o}),define("src/g/boss/view/ZhiZunBossView",["require","exports","src/g/boss/vo/BossInfos","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","../../../manager/RoleCenter","../../../manager/AM","../../../config/GameConfig","src/init/Switches","../../net/messages/ChangeSceneMsg","../../net/messages/ActivityMessage","src/g/clearRes/ClearResM","../../../utils/system/ServerTime","../../../utils/system/DateUitl","src/g/boss/view/ZhizunChildView","src/g/boss/view/ZhizunPersonItem","../../../enum/EventName","../../../core/E","src/init/TextConst"],function(t,e,n,r,l,a,i,h,c,u,p,d,g,v,f,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(s){function o(){var t=s.call(this)||this;t._isset=!1,t.cdtime=0;for(var e=o.vipLevels,i=e.length,n=0;n<i;n++)t["vipitem"+n].btn_fight.on(Laya.Event.CLICK,t,t.fightHandler,[e[n],n]);return t}return __extends(o,s),o.prototype.fightHandler=function(t,e){if(a.RoleCenter.instans.vo.VIP<t)this.showVipErr();else{this.currIndex=e;var i,n=this.childView;if(n)i=n.vipbossList;else{this.childView=n=new f.ZhizunChildView,(i=n.vipbossList).scrollBar.elasticDistance=50,i.itemRender=y.ZhizunPersonItem,i.renderHandler=new Laya.Handler(this,this.updateItem);for(var s=0;s<3;s++){n["vip"+s].on(Laya.Event.CLICK,this,this.vipBtnClick,[s])}}Laya.timer.clearAll(this),this.resetTime(),Laya.timer.loop(1e3,this,this.loopHandler),this.addChild(n),n.changeCurrVipInfo(o.vipLevels,e)}},o.prototype.updateItem=function(t,e){t.setData(t.dataSource)},o.prototype.vipBtnClick=function(t,e){e.currentTarget.disabled?this.showVipErr():this.childView.changeCurrVipInfo(o.vipLevels,t)},o.prototype.setItem=function(){var t=h.GameConfig.bossjson,e=[t[601],t[602],t[603]];this._isset=!0;for(var i=0;i<3;i++)for(var n=r.ItemUtils.getBossId(e[i].id).bonus,s=0;s<n.length;s++){var o=r.ItemUtils.getItemOrEq(n[s]),a=this["vipitem"+i]["item"+s];a&&(l.ItemIconView.setItemData(o,a),a.lvl.visible=!1)}},o.prototype.showVipErr=function(){i.AM.show(C.TextConst.get(308),new Laya.Handler(this,function(){c.Switches.ins.event(101)}))},o.prototype.showView=function(t){void 0===t&&(t=null),this.visible=!0,this._isset||this.setItem(),d.ClearResM.resetViewImg(this);var e=this.childView;if(e&&e.removeSelf(),t){var i=0;t.type==u.EPlayType.PLAYTYPE_MOSTVIPBOSS2?i=1:t.type==u.EPlayType.PLAYTYPE_MOSTVIPBOSS3&&(i=2);var n=o.vipLevels;this.fightHandler(n[i],i)}_.E.ins.event(m.EventName.CHECK_BOSS_TIME)},o.prototype.resetTime=function(){var t=new Date(1e3*g.ServerTime.serverTime),e=t.getTime(),i=t.getHours(),n=1;i%2==0&&(n=2),t.setHours(i+n,0,0,0),this.cdtime=Math.floor((t.getTime()-e)/1e3)},o.prototype.restVo=function(){var t=n.BossInfos.vipboss;if(t)for(var e=t.length,i=0;i<e;i++)t[i].curstate=p.EACTIVITY_STATE.INREADY},o.prototype.loopHandler=function(){this.cdtime--;var t=this.childView;if(this.cdtime<=0){var e=new Date(1e3*g.ServerTime.serverTime);if(2<=e.getHours()&&e.getHours()<=6)return Laya.timer.clearAll(this),void(t.cdTime.text=C.TextConst.get(1015));this.resetTime(),this.restVo(),t.changeCurrVipInfo(o.vipLevels,this.currIndex)}t&&(t.cdTime.text=v.DateUtil.timeCountDown1(this.cdtime))},o.vipLevels=[1,4,7],o}(ui.boss.ZhiZunBossUI);e.ZhiZunBossView=s}),define("src/g/mijing/view/MiJingPageNew",["require","exports","../../../component/GAnimation","../../../manager/GameSocketManager","../../net/messages/QuanMinBossMsg","../../../core/GNet","src/g/boss/vo/BossInfos","../../../config/GameConfig","../../../manager/RoleCenter","../../../core/E","../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../net/messages/ChangeSceneMsg","../../../manager/LayerManager","../../../utils/ItemUtils","src/g/clearRes/ClearResM","src/g/peronboss/view/ItemIconView","../../../manager/AM","../../../manager/StateManger","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","../../net/messages/ActivityMessage","../../../utils/system/DateUitl","../../../utils/system/ServerTime","src/g/fight/base/RES","src/init/TextConst"],function(t,e,c,i,n,s,r,u,p,o,a,l,h,d,g,v,f,y,m,_,C,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var T=function(e){function t(){var t=e.call(this)||this;return t.dataArr=[],t._selectid=0,t._selectIndex=0,v.ClearResM.addBgUrl(t.bgimg.skin),i.GSM.ins.on(n.MultiUserCopyStateGS2C.KEY,t,t.onQMBossData),t.btn0.on(Laya.Event.CLICK,t,t.clickHandler,[0]),t.btn1.on(Laya.Event.CLICK,t,t.clickHandler,[1]),t.btn2.on(Laya.Event.CLICK,t,t.clickHandler,[2]),t.btn3.on(Laya.Event.CLICK,t,t.clickHandler,[3]),t.btn4.on(Laya.Event.CLICK,t,t.clickHandler,[4]),t.btn_fight.on(Laya.Event.CLICK,t,t.fightHandler),Laya.timer.loop(1e3,t,t.updateHandler),t}return __extends(t,e),t.prototype.updateHandler=function(){var t=this.dataArr;if(t)for(var e=0;e<t.length;e++){var i=this["btn"+e],n=t[e],s=g.ItemUtils.getBossId(n.bossid);i.lab_name.text=s.name;var o=u.GameConfig.hunyinboss[n.bossid],a="#e1a32a";if(n.curstate!=I.EACTIVITY_STATE.INCD){if(i.lab_type.text=E.TextConst.get(359),a="#09d51f",2==o.type){var r=p.RoleCenter.instans.vo.hetiData;r&&-1==r.skillArr.indexOf(o.hetilevel)&&(i.lab_type.text=o.des)}}else{var l=n.cdtime-w.ServerTime.serverTime;l<=0?n.curstate=I.EACTIVITY_STATE.INREADY:i.lab_type.text=E.TextConst.get(34,b.DateUtil.timeCountDown1(l))}i.lab_type.color=a}},t.prototype.fightHandler=function(){p.RoleCenter.instans.vo.SECRETBOSSCOUNT<=0?_.FE.upItems(E.TextConst.get(294),C.BubbleEnum.center):p.RoleCenter.instans.bagRoomEnough()?m.StateManger.isSpecialPlay()||(o.E.ins.event(a.EventName.PLAY_TYPE_CHANGE,l.PlayTypeVo.create(h.EPlayType.PLAYTYPE_MIJINGBOSS,this._selectid)),this._ani.clear(!0),d.LayerManager.closeAllPOPWindow()):y.AM.showBagNotEnough()},t.prototype.clickHandler=function(t){var e=this.dataArr;e&&e[t]&&this.setBoss(e[t].bossid,t)},t.prototype.onQMBossData=function(t){this.resetList()},t.prototype.showView=function(){this.visible=!0,s.GNet.miJingBoss(),this.bgimg.restskin(),this.resetList()},t.prototype.resetList=function(){this.dataArr.length=0;var t=[];if(this.lab_count.text=p.RoleCenter.instans.vo.SECRETBOSSCOUNT+"",r.BossInfos.mjboss){var e=r.BossInfos.mjboss,i=u.GameConfig.hunyinboss,n=p.RoleCenter.instans.vo.zhuanshengLv/2;if(!n)return;n=Math.ceil(n);for(var s=0;s<e.length;s++){var o=e[s],a=i[o.bossid];1==a.type&&a.type2==n&&this.dataArr.push(o),2==a.type&&t.push(o)}this.dataArr&&this.dataArr.length&&(this.dataArr=this.dataArr.concat(t),this.setBoss(this.dataArr[0].bossid,0),this.updateHandler())}},t.prototype.setBoss=function(t,e){this._selectid=t,this._selectIndex=e,this.dataArr[this._selectIndex].curstate!=I.EACTIVITY_STATE.INCD?(this.btn_fight.disabled=!1,this.contip.visible=!0):(this.btn_fight.disabled=!0,this.contip.visible=!1),this._ani||(this._ani=new c.GAnimation);var i=u.GameConfig.hunyinboss[this.dataArr[this._selectIndex].bossid];if(2==i.type){var n=p.RoleCenter.instans.vo.hetiData;n&&-1==n.skillArr.indexOf(i.hetilevel)&&(this.btn_fight.disabled=!0,this.contip.visible=!1)}this["btn"+e].addChild(this.select_img);var s=g.ItemUtils.getBossId(t),o=g.ItemUtils.getMonsterVOById(g.ItemUtils.getPortVoById(s.port).boss[0]),a=this.dataArr[e].killRecord;0<a.length?(this.lab_userName.text=a[0].nickname,this.lab_familyName.text=a[0].killerFamilyname):(this.lab_userName.text="",this.lab_familyName.text=""),this._ani.x=176,this._ani.y=334,this.addChild(this._ani),this.lab_bossTitle.text=o.name;for(var r=0;r<s.bonus.length;r++){var l=g.ItemUtils.getItemOrEq(s.bonus[r]);f.ItemIconView.setItemData(l,this["item"+r],1)}var h=1;-1==o.moResVo.dir.indexOf(5)?(this.murl=S.RES.MONSTER_PATH+o.moResVo.res+"/3_s.json",h=-o.zoom):(h=o.zoom,this.murl=S.RES.MONSTER_PATH+o.moResVo.res+"/5_s.json"),Laya.loader.load(this.murl,Laya.Handler.create(this,function(){this._ani.clear(!0),this._ani.load(this.murl),this._ani.scale(h,o.zoom)}),null,Laya.Loader.ATLAS)},t}(ui.mijing.MiJingPageNewUI);e.MiJingPageNew=T}),define("src/g/boss/view/BossItemView",["require","exports","../../../manager/RoleCenter","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","src/g/copy/view/PersonBossUtil"],function(t,e,a,r,i,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.item0=new i.ItemIconView,t.item0.x=158,t.item0.y=60,t.item1=new i.ItemIconView,t.item1.x=231,t.item1.y=60,t.item2=new i.ItemIconView,t.item2.x=304,t.item2.y=60,t}return __extends(t,e),t.prototype.setData=function(t){this.btn_lv.labelColors="#d4c4a5,#f6a60b",this.tip_icon.visible=!1,this.btn_lv.gray=!1;for(var e=l.PersonBossUtil.getIndex(t),i=a.RoleCenter.instans.vo.bossData.bossprivatePass,n=a.RoleCenter.instans.self.bossData.bossprivateNum[e],s=0;s<t.bonus.length;s++)r.ItemUtils.getEquipVoById(t.bonus[s]);if(-1==e)this.btn_lv.gray=!0;else{var o=i[e];0==n&&1==o&&(this.btn_lv.labelColors="#a96262,#a96262",this.tip_icon.visible=!0)}this.btn_lv.label=t.name+" "+r.ItemUtils.getLv(t.lv)},t}(ui.boss.BossItemUI);e.BossItemView=n}),define("src/g/copy/view/personboss/PersonBoss",["require","exports","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../core/E","../../../../enum/EventName","src/g/boss/view/BossItemView","../../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","../../../../manager/StateManger","../../../../manager/AM","src/g/fight/osprite/play/GamePlayMatCopy","../../../../manager/LayerManager","src/g/fight/info/PlayTypeVo","../../../net/messages/ChangeSceneMsg","../../../../component/GAnimation","src/g/clearRes/ClearResM","../../../../manager/GameSocketManager","../../../net/messages/SweepFightMsg","../../../../enum/GuideTargetName","src/g/Effects/UIEffectsFactory","src/init/Switches","src/g/boss/view/MonBossPop","src/g/fight/base/RES","src/init/TextConst","../../../net/messages/OpResultGS2C","../../../net/messages/OpResultType","src/g/copy/view/PersonBossUtil"],function(t,e,h,s,o,a,i,c,u,n,r,l,p,d,g,v,f,y,m,_,C,I,b,w,S,E,T,A){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var R=function(e){function t(){var t=e.call(this)||this;return t._nowIdx=0,t.listSelectIndex=0,t.saodang=!1,t._list.itemRender=i.BossItemView,t._list.vScrollBarSkin="",t._list.selectEnable=!0,t._list.scrollBar.elasticDistance=50,o.E.ins.on(a.EventName.UPDATEPERSONBOSS,t,t.showView),t._list.renderHandler=new Laya.Handler(t,t.renderHandler),t._list.selectHandler=new Laya.Handler(t,t.selectHandler),t.btn_fight.on(Laya.Event.CLICK,t,t.clickHandler),t.ani_put=C.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.btn_fight,40),f.ClearResM.addBgUrl(t.bgimg.skin),y.GSM.ins.on(E.OpResultGS2C.KEY,t,t.nextDayHandler),t}return __extends(t,e),t.prototype.nextDayHandler=function(t){t.msgidx==T.enumOpResultType.activity_nextDay&&Laya.timer.once(1e3,this,this.showView)},t.prototype.superHandler=function(){},t.prototype.checkBtn=function(t){var e=h.RoleCenter.instans.self.bossData.bossprivatePort.indexOf(this._data.port);h.RoleCenter.instans.self.bossData.bossprivateNum[e]?(this.tipLvl.text=S.TextConst.get(344),this.tipLvl.color="#ff0000",this.btn_fight.disabled=!1,this.ani_put.visible=!0,t.visible=!1,this.btn_fight.label=S.TextConst.get(342),this.btn_fight.visible=!0):(this.tipLvl.text=S.TextConst.get(345),this.tipLvl.color="#9e6e4b",this.btn_fight.label=S.TextConst.get(342),this.ani_put.visible=!1,this.btn_fight.disabled=!0,t.visible=!0)},t.prototype.monHandler=function(){},t.prototype.addEvent=function(){this._list.selectedIndex=0},t.prototype.renderHandler=function(t,e){t.setData(this._list.array[e]),t.img_select.visible=e==this._nowIdx,t.img_select.restskin(),t.btn_lv.selected=e==this._nowIdx},t.prototype.showView=function(){this.selectimg.restskin(),this.bgimg.restskin();var t=s.GameConfig.bossjson,e=[];for(var i in t){var n=t[i];6==n.type&&(e.push(n),0)}this._ani||(this._ani=new v.GAnimation),this._ani.x=204,this._ani.y=this.bg.y,this.addChild(this._ani),this._list.array=e,this._list.dataSource=e,this.refresh(),this.visible=!0,this.selectHandler(this.listSelectIndex),o.E.ins.event(a.EventName.UPDATEPERSONBOSSRed)},t.prototype.registUIToGuide=function(){},t.prototype.refresh=function(){for(var t=this._list.array,e=t.length,i=[],n=h.RoleCenter.instans.self.bossData.bossprivatePort,s=h.RoleCenter.instans.self.bossData.bossprivateNum,o=e-1;0<=o;o--){var a=t[o],r=s[n.indexOf(a.port)];0==r&&(t.splice(o,1),i.push(a))}for(var l=0;l<i.length;l++)t.push(i[l]);this._list.array=t,this._list.refresh()},t.prototype.selectHandler=function(t){this.listSelectIndex=t,this.tip_boss.visible=!1,this.selectimg.visible=!1,this._nowIdx=t;for(var e=0;e<this._list.dataSource.length;e++)this._list.dataSource[e].select=e==this._nowIdx;this._list.refresh(),this.renderBase(),this.refreshMonster()},t.prototype.renderBase=function(){var t=this._list.dataSource[this._nowIdx];this.saodang=!1,t&&this.seletMon(t)},t.prototype.seletMon=function(t){this.con.visible=!1;var e=h.RoleCenter.instans.vo.bossData.bossprivatePass;this._data=t,this._index=A.PersonBossUtil.getIndex(t);for(var i=t.bonus.length-1;0<=i;i--){var n=c.ItemUtils.getItemOrEq(t.bonus[i]);u.ItemIconView.setItemData(n,this["item"+i])}var s=h.RoleCenter.instans.vo.zhuanshengLv,o=h.RoleCenter.instans.vo.getCurLv(),a=h.RoleCenter.instans.vo.isSuperMonthCard;if(this.ani_put.visible=!0,e[this._index])a?(this.saodang=!0,this.tipLvl.text=S.TextConst.get(345),this.tipLvl.color="#9e6e4b",this.btn_fight.label=S.TextConst.get(339)):n.limit<1e3&&3<=s?(this.saodang=!0,this.tipLvl.text=S.TextConst.get(345),this.tipLvl.color="#9e6e4b",this.btn_fight.label=S.TextConst.get(339)):3<=s-(n.limit/1e3>>0)?(this.saodang=!0,this.tipLvl.text=S.TextConst.get(345),this.tipLvl.color="#9e6e4b",this.btn_fight.label=S.TextConst.get(339)):(this.saodang=!1,this.tipLvl.text=S.TextConst.get(345),this.tipLvl.color="#9e6e4b",this.btn_fight.label=S.TextConst.get(342));else{this.saodang=!1,this.tipLvl.text=S.TextConst.get(344),this.tipLvl.color="#ff0000",this.btn_fight.label=S.TextConst.get(342),this.con.visible=!0;for(i=0;i<t.firstred.length;i++){var r=c.ItemUtils.getItemOrEq(t.firstred[i]);u.ItemIconView.setItemData(r,this["item"+i])}}n.limit>o?(this.btn_fight.visible=!1,this.tipLvl.text=S.TextConst.get(347),this.tipLvl.color="#686664"):this.btn_fight.visible=!0;var l=h.RoleCenter.instans.self.bossData.bossprivateNum[this._index];this.ani_put.visible=l?(this.tipLvl.text=S.TextConst.get(344),this.tipLvl.color="#ff0000",!(this.btn_fight.disabled=!1)):!(this.btn_fight.disabled=!0),this.txt_name.text=t.name},t.prototype.refreshMonster=function(){Laya.timer.callLater(this,this.delayHandler)},t.prototype.delayHandler=function(){var t=c.ItemUtils.getMonsterVOById(c.ItemUtils.getPortVoById(this._data.port).boss[0]);this.addChild(this._ani),Laya.loader.cancelLoadByUrl(this.murl);var e=1;-1==t.moResVo.dir.indexOf(5)?(this.murl=w.RES.MONSTER_PATH+t.moResVo.res+"/3_s.json",e=-t.zoom):(e=t.zoom,this.murl=w.RES.MONSTER_PATH+t.moResVo.res+"/5_s.json"),this._ani.clear(!0),this._ani.load(this.murl),this._ani.scale(e,t.zoom)},t.prototype.clickHandler=function(){if(n.StateManger.enterFight()&&this._data)if(-1!=this._data.lv||h.RoleCenter.instans.vo.isSuperMonthCard){if(-2==this._data.lv){var t=h.RoleCenter.instans.vo.isMonthCard;if(h.RoleCenter.instans.vo.bossData.bossprivatePass[this._index]){if(!t)return void(window.enabledpay&&r.AM.show(S.TextConst.get(306),new Laya.Handler(this,function(){I.Switches.ins.event(12)}),null))}else if(!t){if(window.enabledpay)(new b.MonBossPop).showView(new Laya.Handler(this,this.handler));return}}if(o.E.ins.event(a.EventName.COMPTYPE_CLICK,_.GuideTargetName.PERSON_BOSS_BTN_FIGHT),this.saodang)l.GamePlayMatCopy.sweepSelfBoss(this._data.port),y.GSM.ins.on(m.SweepFightGS2C.KEY,this,this.updateHandler);else p.LayerManager.closeAllPOPWindow(),this.handler()}else window.enabledpay&&r.AM.show(S.TextConst.get(349),new Laya.Handler(this,function(){I.Switches.ins.event(122)}),null)},t.prototype.handler=function(){o.E.ins.event(a.EventName.PLAY_TYPE_CHANGE,d.PlayTypeVo.create(g.EPlayType.PLAYTYPE_PRIBOSS,{idx:this._index,boss:this._data},!0))},t.prototype.updateHandler=function(t){if(t.opresult){var e=h.RoleCenter.instans.vo.bossData.bossprivatePort.indexOf(t.portid);-1!=e&&(h.RoleCenter.instans.vo.bossData.bossprivateNum[e]--,this.showView())}else console.error("错误")},t}(ui.copy.PersonBossViewUI);e.PersonBossView=R}),define("src/g/boss/view/BossView",["require","exports","src/g/boss/view/AllPersonView","src/g/boss/view/PersonWelfareBossView","src/g/boss/view/ShenYUView","../../../manager/RuledescManager","src/g/proxy/MultiLevelUIProxy","../../../core/E","../../../enum/EventName","src/g/mijing/view/MiJingPageNew","src/g/copy/view/personboss/PersonBoss","../../../utils/UIUtils","../../../manager/GuideCenter","../../../enum/GuideTargetName","src/g/clearRes/ClearResM","../../net/messages/ChangeSceneMsg"],function(t,e,s,o,a,i,n,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(e){function t(){var t=e.call(this)||this;(t.conarr=[],t._pro=new n.MultiLevelUIProxy,t._pro.registerTab(t.tabbar,0),t._pro.registerTagIndex(77,0),t._pro.registerTagIndex(75,1),t._pro.registerTagIndex(73,2),t._pro.registerTagIndex(67,4),t._pro.registerTagIndex(74,3),t._pro.selectHandler=new Laya.Handler(t,t.selectHandler),window.enabledpay)||(t.tabbar.getChildByName("item1").visible=!1,t.tabbar.changeLabels());return t.bgview.btn_back.on(Laya.Event.CLICK,t,t.closeHandler),t.bgview.btn_close.on(Laya.Event.CLICK,t,t.closeHandler),t.bgview.btn_back.skin="res/custom/newBtn/tongyong_fanhui.png",t.bgview.btn_back.scale(1.3,1.3),t.bgview.btn_back.x=526,t.bgview.btn_back.bottom=7,t}return __extends(t,e),t.prototype.closeHandler=function(){r.E.ins.event(l.EventName.CLOSEBOSSVIEW),this.removeSelf(),Laya.loader.clearRes("res/atlas/res/title.json"),r.E.ins.event(l.EventName.COMPTYPE_CLOSEVIEW,d.GuideTargetName.BOSS_VIEW)},t.prototype.onClick=function(t){i.RuledescManager.showRuledesc(t)},t.prototype.selectHandler=function(t){for(var e=this,i=(this.currData,0);i<this.conarr.length;i++)this.conarr[i].visible=!1;this.tabbar.items[t]&&(this.select_img.x=this.tabbar.items[t].x,this.select_img.y=this.tabbar.items[t].y+2);var n=!1;switch(t){case 0:this._personBoss||(n=!0,this._personBoss=new c.PersonBossView,this.bgview.box_page.addChild(this._personBoss),this.conarr.push(this._personBoss),Laya.timer.frameOnce(2,this,function(){var t=u.UIUtils.getGlobalBound(e._personBoss.btn_fight);t&&(p.GuideCenter.ins.registerInteractionArea(d.GuideTargetName.PERSON_BOSS_BTN_FIGHT,t),p.GuideCenter.ins.registerGuideObject(d.GuideTargetName.PERSON_BOSS_BTN_FIGHT,e))})),this.bgview.btn_help.visible=!1,this.changeTitle(t),n?Laya.timer.frameOnce(3,this._personBoss,this._personBoss.showView):this._personBoss.showView();break;case 1:window.enabledpay&&(this._personWelfareBoss||(n=!0,this._personWelfareBoss=new o.PersonWelfareBossView,this.bgview.box_page.addChild(this._personWelfareBoss),this.conarr.push(this._personWelfareBoss)),this.bgview.btn_help.visible=!0,this.bgview.btn_help.on(Laya.Event.CLICK,this,this.onClick,[2]),this.changeTitle(t),n?Laya.timer.frameOnce(3,this._personWelfareBoss,this._personWelfareBoss.showView):this._personWelfareBoss.showView());break;case 2:this._allpersonbossView||(n=!0,this._allpersonbossView=new s.AllPersonView,this.bgview.box_page.addChild(this._allpersonbossView),this.conarr.push(this._allpersonbossView)),this.bgview.btn_help.visible=!0,this.bgview.btn_help.on(Laya.Event.CLICK,this,this.onClick,[2]),this.changeTitle(t),n?Laya.timer.frameOnce(3,this._allpersonbossView,this._allpersonbossView.showView):this._allpersonbossView.showView();break;case 4:this._mijing||(n=!0,this._mijing=new h.MiJingPageNew,this.bgview.box_page.addChild(this._mijing),this.conarr.push(this._mijing)),this.changeTitle(t),n?Laya.timer.frameOnce(3,this._mijing,this._mijing.showView):this._mijing.showView();break;case 3:this._shenyuBoss||(n=!0,this._shenyuBoss=new a.ShenYUView,this.bgview.box_page.addChild(this._shenyuBoss),this.conarr.push(this._shenyuBoss)),this.bgview.btn_help.visible=!0,this.bgview.btn_help.on(Laya.Event.CLICK,this,this.onClick,[14]),this.changeTitle(t),n?Laya.timer.frameOnce(3,this._shenyuBoss,this._shenyuBoss.showView):this._shenyuBoss.showView()}0==t?r.E.ins.event(l.EventName.COMPTYPE_CLICK,d.GuideTargetName.boss_tab_item0):1==t?r.E.ins.event(l.EventName.COMPTYPE_CLICK,d.GuideTargetName.boss_tab_item1):2==t?r.E.ins.event(l.EventName.COMPTYPE_CLICK,d.GuideTargetName.boss_tab_item2):3==t?r.E.ins.event(l.EventName.COMPTYPE_CLICK,d.GuideTargetName.boss_tab_item3):4==t&&r.E.ins.event(l.EventName.COMPTYPE_CLICK,d.GuideTargetName.boss_tab_item4),this.currData=null},t.prototype.showView=function(t,e){void 0===t&&(t=0),void 0===e&&(e=null),201!=t&&202!=t&&203!=t||(e=e||{},202==t?e.type=v.EPlayType.PLAYTYPE_MOSTVIPBOSS2:203==t&&(e.type=v.EPlayType.PLAYTYPE_MOSTVIPBOSS3),t=75),this.currData=e,this._pro.open(t),r.E.ins.on(l.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),r.E.ins.event(l.EventName.COMPTYPE_OPENVIEW,d.GuideTargetName.BOSS_VIEW),this._isRegist||Laya.timer.frameOnce(2,this,this.registUIToGuide),p.GuideCenter.ins.registerGuideObject(d.GuideTargetName.boss_tab_item0,this),p.GuideCenter.ins.registerGuideObject(d.GuideTargetName.boss_tab_item1,this),p.GuideCenter.ins.registerGuideObject(d.GuideTargetName.boss_tab_item2,this),p.GuideCenter.ins.registerGuideObject(d.GuideTargetName.boss_tab_item3,this),p.GuideCenter.ins.registerGuideObject(d.GuideTargetName.boss_tab_item4,this)},t.prototype.registUIToGuide=function(){var t=u.UIUtils.getGlobalBound(this.tabbar.getChildByName("item0"));t&&p.GuideCenter.ins.registerInteractionArea(d.GuideTargetName.boss_tab_item0,t),(t=u.UIUtils.getGlobalBound(this.tabbar.getChildByName("item1")))&&p.GuideCenter.ins.registerInteractionArea(d.GuideTargetName.boss_tab_item1,t),(t=u.UIUtils.getGlobalBound(this.tabbar.getChildByName("item2")))&&p.GuideCenter.ins.registerInteractionArea(d.GuideTargetName.boss_tab_item2,t),(t=u.UIUtils.getGlobalBound(this.tabbar.getChildByName("item4")))&&p.GuideCenter.ins.registerInteractionArea(d.GuideTargetName.boss_tab_item3,t),(t=u.UIUtils.getGlobalBound(this.tabbar.getChildByName("item3")))&&p.GuideCenter.ins.registerInteractionArea(d.GuideTargetName.boss_tab_item4,t),this._isRegist=!0},t.prototype.closeClearRes=function(){r.E.ins.off(l.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),g.ClearResM.clearResFolder("zhizun/")},t.prototype.changeTitle=function(t){switch(t){case 0:this.bgview.img_title.skin="res/title/biaoti_gerenboss.png";break;case 1:this.bgview.img_title.skin="res/title/vip_boss.png";break;case 2:this.bgview.img_title.skin="res/title/biaoti_BOSSzhijia.png";break;case 4:this.bgview.img_title.skin="res/guild/mijing/mijing_biaotiwenzi2.png";break;case 3:this.bgview.img_title.skin="res/title/biaoti_shenyuBOSS.png"}},t}(ui.boss.BossViewUI);e.BossView=f}),define("src/g/boss/ctrl/BossviewCtrl",["require","exports","../../net/messages/QuanMinBossMsg","../../net/messages/QuanMinBossMsg","../../../utils/ItemUtils","../../../manager/LayerManager","../../../manager/RoleCenter","../../../manager/GameSocketManager","../../net/messages/QuanMinBossMsg","src/g/boss/vo/BossInfos","src/g/boss/view/BossView","src/init/Switches","src/g/accessctrl/AccessCenter","../../../manager/NewRedHintsCenter","../../net/messages/ActivityMessage","../../../config/GameConfig","src/g/index/ctrl/BossTipCtrl","../../../core/E","../../../enum/EventName","../../net/messages/ChangeSceneMsg","../../../runtime/resload/GameResLoad","src/g/copy/view/PersonBossUtil"],function(t,e,i,n,a,o,r,s,l,h,c,u,p,d,g,v,f,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var b=function(){function t(){}return t.prototype.init=function(){u.Switches.ins.on(23,this,this.onOpenPage,[23]),u.Switches.ins.on(77,this,this.onOpenPage,[77]),u.Switches.ins.on(73,this,this.onOpenPage,[73]),u.Switches.ins.on(74,this,this.onOpenPage,[74]),u.Switches.ins.on(75,this,this.onOpenPage,[75]),u.Switches.ins.on(201,this,this.onOpenPage,[201]),u.Switches.ins.on(202,this,this.onOpenPage,[202]),u.Switches.ins.on(203,this,this.onOpenPage,[203]),u.Switches.ins.on(67,this,this.onOpenPage,[67]);var t=s.GSM.ins;t.on(n.MultiUserCopyStateGS2C.KEY,this,this.onMutiUserCopyState),t.on(i.BossStateChangeGS2C.KEY,this,this.onOneBossStateChange),t.on(l.OneCopyBossBloodGS2C.KEY,this,this.bossHpHandler),y.E.ins.on(m.EventName.CHECK_BOSS_TIME,this,this.checkRedHandler)},t.prototype.onOpenPage=function(t,e,i,n,s){void 0===i&&(i=null),void 0===n&&(n=!0),void 0===s&&(s=!1),e&&(23==t?p.AccessCenter.ins.checkOpen(77)?this.show(77,n,s):p.AccessCenter.ins.checkOpen(74)?this.show(74,n,s):p.AccessCenter.ins.checkOpen(75)?this.show(75,n,s,i):p.AccessCenter.ins.checkOpen(67)&&this.show(67,n,s):this.show(t,n,s,i))},t.prototype.onMutiUserCopyState=function(t){if(r.RoleCenter.instans.vo){r.RoleCenter.instans.vo.getCurLv(),t.copyStateArray.length;t.activityType==g.EACT_TYPE.quanminBoss?h.BossInfos.allpersonBoss=t.copyStateArray:t.activityType==g.EACT_TYPE.shenBoss?h.BossInfos.shenBoss=t.copyStateArray:t.activityType==g.EACT_TYPE.rebirthBoss||(t.activityType==g.EACT_TYPE.vipBoss?h.BossInfos.vipboss=t.copyStateArray:t.activityType==g.EACT_TYPE.mijingBoss&&(h.BossInfos.mjboss=t.copyStateArray)),Laya.timer.once(100,this,this.checkRedHandler)}},t.prototype.onOneBossStateChange=function(t){if(r.RoleCenter.instans.vo){var e=r.RoleCenter.instans.vo.getCurLv();if(t.activityType==g.EACT_TYPE.quanminBoss)for(var i=0,n=h.BossInfos.allpersonBoss.length;i<n;i++){if((s=h.BossInfos.allpersonBoss[i]).bossid==t.copyState.bossid)h.BossInfos.allpersonBoss[i]=t.copyState,a.ItemUtils.getBossId(s.bossid).lv<=e&&(t.copyState.curstate==g.EACTIVITY_STATE.NULL||(t.copyState.curstate==g.EACTIVITY_STATE.INCD?h.BossInfos.allpersonHp[t.copyState.bossid]=0:h.BossInfos.allpersonHp[t.copyState.bossid]=t.copyState.HP/t.copyState.HPMAX))}else if(t.activityType==g.EACT_TYPE.shenBoss)for(i=0,n=h.BossInfos.shenBoss.length;i<n;i++){if((s=h.BossInfos.shenBoss[i]).bossid==t.copyState.bossid)h.BossInfos.shenBoss[i]=t.copyState,a.ItemUtils.getBossId(s.bossid).lv<=e&&(t.copyState.curstate==g.EACTIVITY_STATE.NULL||(t.copyState.curstate==g.EACTIVITY_STATE.INCD?h.BossInfos.shenBossHp[t.copyState.bossid]=0:h.BossInfos.shenBossHp[t.copyState.bossid]=t.copyState.HP/t.copyState.HPMAX))}else if(t.activityType==g.EACT_TYPE.vipBoss)for(i=0,n=h.BossInfos.vipboss.length;i<n;i++){if((s=h.BossInfos.vipboss[i]).bossid==t.copyState.bossid){h.BossInfos.vipboss[i]=t.copyState;break}}else if(t.activityType==g.EACT_TYPE.mijingBoss)for(i=0,n=h.BossInfos.mjboss.length;i<n;i++){var s;if((s=h.BossInfos.mjboss[i]).bossid==t.copyState.bossid){h.BossInfos.mjboss[i]=t.copyState;break}}f.BossTipCtrl.updateBoss(),this.checkRedHandler()}},t.prototype.bossHpHandler=function(t){if(t.activityType==g.EACT_TYPE.quanminBoss){var e=t.bossid,i=t.HP,n=a.ItemUtils.getBossId(e).port,s=a.ItemUtils.getPortVoById(n),o=a.ItemUtils.getMonsterVOById(s.boss).HP;i=t.HP/o*100>>0;h.BossInfos.allpersonHp[e]=i}else if(t.activityType==g.EACT_TYPE.shenBoss){e=t.bossid,i=t.HP,n=a.ItemUtils.getBossId(e).port,s=a.ItemUtils.getPortVoById(n),o=a.ItemUtils.getMonsterVOById(s.boss).HP,i=t.HP/o*100>>0;h.BossInfos.shenBossHp[e]=i}else t.activityType,g.EACT_TYPE.mijingBoss},t.prototype.show=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),void 0===n&&(n=null),C.GameResLoad.load("res/atlas/res/bossbtn.json");var s=!1;this._view||(s=!0,this._view=new c.BossView),o.LayerManager.addInPOPWindowLayer(this._view,e,!0,!0,!1,i),s?Laya.timer.frameOnce(3,this._view,this._view.showView,[t,n]):this._view.showView(t,n)},t.prototype.checkRedHandler=function(){this.checkRed(),this.shencheckRed(),this.checkVip(),this.checkMiJing()},t.prototype.checkRed=function(){var t=h.BossInfos.allpersonBoss,e=r.RoleCenter.instans.vo.QUANMINGCOUNT;if(p.AccessCenter.ins.checkOpen(73))if(e<=0)d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.peopleboss,!1);else{if(t)for(var i=r.RoleCenter.instans.vo.getCurLv(),n=0;n<t.length;n++){var s=t[n];if(s.curstate!=g.EACTIVITY_STATE.INCD){var o=a.ItemUtils.getBossId(s.bossid);if(o&&o.lv<i)return void d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.peopleboss,!0)}}d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.peopleboss,!1)}else d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.peopleboss,!1)},t.prototype.shencheckRed=function(){var t=h.BossInfos.shenBoss,e=r.RoleCenter.instans.vo.WINGBOSSCOUNT;if(p.AccessCenter.ins.checkOpen(74))if(e<=0)d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.shenboss,!1);else{if(t)for(var i=r.RoleCenter.instans.vo.getCurLv(),n=0;n<t.length;n++){var s=t[n];if(s.curstate!=g.EACTIVITY_STATE.INCD)if(a.ItemUtils.getBossId(s.bossid).lv<i)return void d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.shenboss,!0)}d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.shenboss,!1)}else d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.shenboss,!1)},t.prototype.checkVip=function(){var t=r.RoleCenter.instans.vo.VIP;if(p.AccessCenter.ins.checkOpen(75)){if(0!=t){var e=v.GameConfig.bossjson;r.RoleCenter.instans.self.bossData.bossprivatePort;if(r.RoleCenter.instans.self.bossData.bossopen)for(var i in e){var n=e[i];if(I.PersonBossUtil.checkVip(n.type)&&this.checkCanFight(n))return void d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.vipboss,!0)}}d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.vipboss,!1)}else d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.vipboss,!1)},t.prototype.checkCanFight=function(t){var e=I.PersonBossUtil.getIndex(t),i=r.RoleCenter.instans.self.bossData.bossprivateNum[e];if(t.type!=_.EPlayType.PLAYTYPE_MONTHBOSS)return t.type!=_.EPlayType.PLAYTYPE_SUPERBOSS?I.PersonBossUtil.checkVipLv(t)&&0<i:r.RoleCenter.instans.vo.isSuperMonthCard&&0<i;var n=r.RoleCenter.instans.vo.isMonthCard,s=r.RoleCenter.instans.vo.bossData.bossprivatePass[e];return n?0==s||0<i:0==s},t.prototype.checkMiJing=function(){var t=h.BossInfos.mjboss,e=r.RoleCenter.instans.vo.SECRETBOSSCOUNT;if(p.AccessCenter.ins.checkOpen(67))if(e<=0)d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.mijingboss,!1);else{if(t)for(var i=r.RoleCenter.instans.vo.zhuanshengLv/2,n=(i=Math.ceil(i),v.GameConfig.hunyinboss),s=0;s<t.length;s++){var o=t[s];if(o.curstate!=g.EACTIVITY_STATE.INCD)if(n[o.bossid].type2==i)return void d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.mijingboss,!0)}d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.mijingboss,!1)}else d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.mijingboss,!1)},t}();e.BossviewCtrl=b}),define("src/g/relic/ctrl/RelicPageTips",["require","exports","../../../utils/ItemUtils","../../../meta/ShuXingVo","../../../config/GameConfig"],function(t,e,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initData=function(t,e,i){void 0===i&&(i=!0),this.iVo=t,this.showBase()},e.prototype.showBase=function(){this.lab_name.text=this.iVo.name,this.lab_name.color=n.ItemUtils.getColorByQuality(this.iVo.quality),this.item_.img_item.skin=n.ItemUtils.getIconById(this.iVo.id),this.item_.img_quality.skin=n.ItemUtils.getQualitybjByQualityId(this.iVo.quality),this.item_.lab_num.changeText(""),this.item_.lab_num.text="",this.img_bg.height=this.box_attr.x+this.box_attr.height+20;for(var t=o.GameConfig.relicDebris[this.iVo.id].attrs,e=0;e<t.length;e++){var i=s.ShuXingVo.createSXBox(t[e][0],t[e][1]);this.box_attr.addChild(i),this.box_attr.height+=i.height}this.item_.lab_num.text="",this.img_bg.height=this.box_attr.x+this.box_attr.height+20,this.lab_tip.y=this.img_bg.height,this.height=this.img_bg.height},e}(ui.forge_new.ZhanWenTipsUI);e.RelicPageTips=i}),define("src/g/relic/view/RelicPageView",["require","exports","../../../manager/RoleCenter","../../../utils/RelicUtils","../../net/messages/sbkFormula","../../../utils/ItemUtils","../../net/messages/sbkRelicMsg","../../../manager/GameSocketManager","../../../utils/system/FloatEffect","../../../meta/MainButtonVo","../../../enum/EventName","src/g/Effects/UIEffectsFactory","../../../core/E","../../../enum/GuideTargetName","../../../utils/UIUtils","../../../manager/GuideCenter","../../../plugin/view/ToolTip","../../net/messages/PropFightMain","../../../config/GameConfig","../../../plugin/sbkPropTool","src/g/relic/ctrl/RelicPageTips","../../net/messages/ChangeSceneMsg","src/g/fight/info/PlayTypeVo","../../../manager/LayerManager","src/g/clearRes/ClearResM","src/init/TextConst"],function(t,e,s,r,o,l,n,a,h,i,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var T=function(e){function t(){var t=e.call(this)||this;return t.effectShow=!1,t.nowShowIdx=0,t._vo=null,t.time=200,t.resCache=[],t.list_.renderHandler=new Laya.Handler(t,t.DebrisRender),p.E.ins.on(c.EventName.ACHIVATEDEBRIS,t,t.onAchivateDebris),p.E.ins.on(c.EventName.ACHIVATERELIC,t,t.onAchivateRelic),t.once(Laya.Event.ADDED,t,t.registUIToGuide),t.on(Laya.Event.REMOVED,t,t.onRemoved),t.btn_fightPort.on(Laya.Event.CLICK,t,t.fightPort),t}return __extends(t,e),t.prototype.registUIToGuide=function(){var t=g.UIUtils.getGlobalBound(this.btn_achivateRelic);t&&v.GuideCenter.ins.registerInteractionArea(d.GuideTargetName.RELIC_ACTIVE_BTN,t)},t.prototype.onAchivateRelic=function(t){this.displayedInStage},t.prototype.onRemoved=function(){},t.prototype.onAchivateDebris=function(t){var e=this._vo.needItem2.indexOf(t);if(!(e<0)){var i=u.UIEffectsFactory.Ins.createUIAniById(60,!1,50),n=this.list_.getCell(e);u.UIEffectsFactory.Ins.centered4Parent(i,n.ani,!0),i.on(Laya.Event.COMPLETE,this,function(){i.stop(),i.removeSelf()}),i.play(0)}},t.prototype.showView=function(){var t=1;this._relic=s.RoleCenter.instans.vo.Relic,1==t?(this.changeView(this._relic.nowRelicId),t=0):(this.changeViewLeft(this._relic.nowRelicId),this.changeViewRight(this._relic.nowRelicId)),S.ClearResM.resetViewImg(this),p.E.ins.on(c.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){p.E.ins.off(c.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),S.ClearResM.clearFolderByUrl("dynamic/shenqi/"),this.onPageRemoved()},t.prototype.changeView=function(t){t>this._relic.maxRelicId&&(t=this._relic.maxRelicId),t<1&&(t=1),t>this._relic.nowRelicId+1&&(t=this._relic.nowRelicId+1),this.isNew()&&t<this._relic.startRelicID&&(t=this._relic.startRelicID),this.nowShowIdx=t,this._vo=r.RelicUtils.getRelicVo(t),this.checkNowAchivate()},t.prototype.changeViewLeft=function(t){t>this._relic.maxRelicId&&(t=this._relic.maxRelicId),t<1&&(t=1),t>this._relic.nowRelicId+1&&(t=this._relic.nowRelicId+1),this.isNew()&&t<this._relic.startRelicID&&(t=this._relic.startRelicID),Laya.timer.once(this.time,this,function(){this.nowShowIdx=t,this._vo=r.RelicUtils.getRelicVo(t),this.checkNowAchivate()}),this.btn_left.mouseEnabled=!1,this.btn_right.mouseEnabled=!1,Laya.Tween.to(this.box_group,{alpha:0},this.time,null),Laya.Tween.to(this.box_group,{x:280},this.time,null,Laya.Handler.create(this,this.onChangeLeft))},t.prototype.changeViewRight=function(t){t>this._relic.maxRelicId&&(t=this._relic.maxRelicId),t<1&&(t=1),t>this._relic.nowRelicId+1&&(t=this._relic.nowRelicId+1),this.isNew()&&t<this._relic.startRelicID&&(t=this._relic.startRelicID),Laya.timer.once(this.time,this,function(){this.nowShowIdx=t,this._vo=r.RelicUtils.getRelicVo(t),this.checkNowAchivate()}),this.btn_left.mouseEnabled=!1,this.btn_right.mouseEnabled=!1,Laya.Tween.to(this.box_group,{alpha:0},this.time,null),Laya.Tween.to(this.box_group,{x:20},this.time,null,Laya.Handler.create(this,this.onChangeRight))},t.prototype.onChangeLeft=function(){var t=this;this.box_group.x=20,this.box_group.alpha=0,Laya.Tween.to(this.box_group,{x:150},this.time,null),Laya.Tween.to(this.box_group,{alpha:1},this.time,null,Laya.Handler.create(this,function(){t.btn_left.mouseEnabled=!0,t.btn_right.mouseEnabled=!0}))},t.prototype.onChangeRight=function(){var t=this;this.box_group.x=280,this.box_group.alpha=0,Laya.Tween.to(this.box_group,{x:150},this.time,null),Laya.Tween.to(this.box_group,{alpha:1},this.time,null,Laya.Handler.create(this,function(){t.btn_left.mouseEnabled=!0,t.btn_right.mouseEnabled=!0}))},t.prototype.checkNowAchivate=function(){this._relic.relicId>=this.nowShowIdx?this.showEffect():this.stopEffect(),this.showFightNum(),this.renderView(),this.showList()},t.prototype.isNew=function(){var t=!0,e=2==(2&s.RoleCenter.instans.self.BitNumber);return this._relic.relicId<=5&&e&&(t=!1),t},t.prototype.renderView=function(){this.btn_achivateRelic.visible=this._relic.openRelicDebrisArr.length==this._vo.count&&this.nowShowIdx==this._relic.nowRelicId,this.lab_funcDes.text=this._vo.funcDesc;var t,e=r.RelicUtils.getRelicIcon(this._vo.imgIcon);if(this.resCache.indexOf(e),this.img_big.skin="",this.img_big.skin=e,this.layer_item.removeChildren(),this.layer_item.skin="",this.layer_item.visible=this.nowShowIdx==this._relic.nowRelicId,this.layer_item.visible)for(var i=this._relic.openRelicDebrisArr,n=0;n<i.length;n++){var s=l.ItemUtils.getItemVoById(i[n]),o=r.RelicUtils.getRelicIcon(s.icon+"");this.resCache.indexOf(o)<0&&this.resCache.push(o);var a=new Laya.Image(o);this.layer_item.addChild(a)}else this.layer_item.removeChildren();(this.btn_right.visible=this.nowShowIdx<this._relic.nowRelicId+1&&this.nowShowIdx!=this._relic.maxRelicId,this.btn_left.visible=this.isNew()?6<this.nowShowIdx:1!=this.nowShowIdx,this.btn_achivateRelic.visible)?this.btn_achivateRelic.getChildByName("ani")||((t=u.UIEffectsFactory.Ins.createUIAniById(40,!0)).name="ani",u.UIEffectsFactory.Ins.centered4Parent(t,this.btn_achivateRelic,!0),this.resCache.push(t.source)):(t=this.btn_achivateRelic.getChildByName("ani"))&&t.removeSelf();this.img_name.skin=r.RelicUtils.getRelicName(this._vo.title),this.img_simple.skin=r.RelicUtils.getSimpleDesc(this._vo.simpleDes),this.lab_turn.text=this._vo.turnDes||"",this.lab_turn.on(Laya.Event.CLICK,this,this.onClickTurn,[this._vo.moduleID]),this.img_big.gray=this.nowShowIdx>this._relic.relicId,this.btn_achivateRelic.clickHandler=new Laya.Handler(this,this.onAchivateRelicClick),this.renderNeed(),this.img_simple.visible=!1},t.prototype.fightPort=function(){w.LayerManager.closeAllPOPWindow(),p.E.ins.event(c.EventName.PLAY_TYPE_CHANGE,b.PlayTypeVo.create(I.EPlayType.PLAYTYPE_PORT_LEVEL,null,!1))},t.prototype.renderNeed=function(){if(this._relic.isHasCanAchDebris()||this._relic.isHasCanAchReilc())this.box_ach.visible=!0,this.box_fight.visible=!1;else{this.box_ach.visible=!1,this.box_fight.visible=!0;var t=this._relic.needAchDebris;if(0==t)return this.box_ach.visible=!0,void(this.box_fight.visible=!1);var e=l.ItemUtils.getItemVoById(t),i=e.effect[0][1],n=s.RoleCenter.instans.vo.portstatus.portindex-100-1;this.setBar(n,i),this.ned_1.text=this._relic.howNeedToHaveDebris()+"",this.ned_3.text=e.name,this.box_need.centerX=0}},t.prototype.setBar=function(t,e){var i=t;this.lab_count.changeText(i+"/"+e),0==e&&(e=1);var n=this.bar_img.width/e*i;n=0==n?1:n,this.bar_panl.width=n},t.prototype.onAchivateRelicClick=function(){this.onSendAchivateDebris(this.nowShowIdx),p.E.ins.event(c.EventName.COMPTYPE_CLICK,d.GuideTargetName.RELIC_ACTIVE_BTN)},t.prototype.onClickTurn=function(t){i.MainButtonStruct.Ins.OpenModule(t[0][1],t[1][1])},t.prototype.showEffect=function(){if(!this.effectShow){if(this.effectShow=!0,!this.relicAni.getChildByName("ani")){var t=u.UIEffectsFactory.Ins.createUIAniById(61,!0);t.name="ani",t.width*=1.67,t.height*=1.67,t.scale(1.67,1.67),this.resCache.push(t.aniUrl),u.UIEffectsFactory.Ins.centered4Parent(t,this.relicAni,!0)}this.twenUp()}},t.prototype.twenUp=function(){},t.prototype.stopEffect=function(){Laya.Tween.clearAll(this.img_big),this.img_big.y=0,this.effectShow=!1;var t=this.relicAni.getChildByName("ani");t&&t.removeSelf()},t.prototype.showFightNum=function(){var t=0,e=new y.PropFightMain;this._relic.isOpenRelic(this.nowShowIdx)&&(_.sbkPropTool.reSetProp(e,this._vo.attrs,!1),t=o.sbkFormula.calPropFightMainCombat(e),t+=this._vo.power),e=new y.PropFightMain;for(var i=0;i<this._vo.needItem2.length;i++)if(this._relic.isOpenDebris(this._vo.needItem2[i])||this._relic.isOpenRelic(this._vo.id)){var n=m.GameConfig.relicDebris[this._vo.needItem2[i]];_.sbkPropTool.reSetProp(e,n.attrs,!1)}this.fightBox.num_Fight.value=t+o.sbkFormula.calPropFightMainCombat(e)+""},t.prototype.showList=function(){this.list_.repeatX=this._vo.needItem2.length,this.list_.width=ktgame.relicRunTime.DebrisItem.itemWidth*this._vo.needItem2.length,this.list_.dataSource=this._vo.needItem2},t.prototype.DebrisRender=function(t,e){var i=t.dataSource,n=l.ItemUtils.getItemVoById(i);t._item.img_item.pos(9,7),t._item.lab_num.text="",t.showIcon(l.ItemUtils.getIconByIconId(n.icon)),t.showName(n.name);var s;(t._item.offAll(Laya.Event.CLICK),t._item.on(Laya.Event.CLICK,this,function(){var t=new C.RelicPageTips;t.initData(n,1,!1),t.popup(),console.log("弹出来")}),this._relic.isOpenRelic(this.nowShowIdx)||this._relic.isOpenDebris(i)?(t.showGet(""),t.btn_achivate.visible=!1,t.setQuality(l.ItemUtils.getQualityBjById(n.id),l.ItemUtils.getColorByQuality(n.quality)),t._item.gray=!1):this._relic.isOpenRelic(this.nowShowIdx)||this._relic.isOpenRelic(this.nowShowIdx)||!this._relic.isHasDebris(i)?(this._relic.openRelicDebrisArr.length==e&&this.nowShowIdx==this._relic.nowRelicId?t.showGet(n.desc):t.showGet(""),t.btn_achivate.visible=!1,t._item.gray=!0,t.setQuality(l.ItemUtils.getQualitybjByQualityId(1),l.ItemUtils.getColorByQuality(1)),!1):(t.showGet(""),t.btn_achivate.visible=!0,t.setQuality(l.ItemUtils.getQualitybjByQualityId(1),l.ItemUtils.getColorByQuality(1)),t._item.gray=!0,t.ClickHandler=new Laya.Handler(this,this.onSendAchivateDebris,[i,e]),!0))?t.btn_achivate.getChildByName("ani")||((s=u.UIEffectsFactory.Ins.createUIAniById(42,!0)).name="ani",u.UIEffectsFactory.Ins.centered4Parent(s,t.btn_achivate,!0)):(s=t.btn_achivate.getChildByName("ani"))&&s.removeSelf()},t.prototype.onSendAchivateDebris=function(t,e){if(void 0===e&&(e=-1),this.nowShowIdx==this._relic.nowRelicId)if(this._relic.openRelicDebrisArr.length!=e&&5e3<t)h.FE.upItems(E.TextConst.get(702),f.BubbleEnum.center);else{var i=new n.ActivateRelicC2GS;i.id=t,a.GSM.sendServer(i),p.E.ins.event(c.EventName.COMPTYPE_CLICK,d.GuideTargetName.RELIC_ACTIVE_BTN)}else h.FE.upItems(E.TextConst.get(701),f.BubbleEnum.center)},t.prototype.onPageRemoved=function(){for(var t=0;t<this.resCache.length;t++){var e=this.resCache.pop();Laya.loader.clearRes(e,!0)}},t}(ui.relic.page.Page_RelicUI);e.RelicPageView=T}),define("src/g/relic/ctrl/RelicPageCtrl",["require","exports","src/g/relic/view/RelicPageView","../../../core/E","../../../manager/GameSocketManager","../../net/messages/sbkRelicMsg","../../../manager/RoleCenter","../../../plugin/sbkPropTool","../../../enum/EventName","../../../manager/TipManager","../../../utils/RelicUtils","../../../vo/RedDot/role/RedDot_Relic","src/init/ResManager","src/init/GameEventDispatcher"],function(t,e,i,s,n,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(){function t(){n.GSM.ins.on(o.ActivateRelicGS2C.KEY,this,this.onActivate)}return t.prototype.onActivate=function(t){var e=a.RoleCenter.instans.vo;if(5e3<=t.id){e.Relic.openRelicDebrisArr.indexOf(t.id)<0&&(e.Relic.openRelicDebrisArr.push(t.id),0<e.bagdata.getItemCount(t.id)&&e.chgItemCount(t.id,-1));var i=e.combat;r.sbkPropTool.init4RelicDebris(),e.reCheckComBat(),a.RoleCenter.instans.event(l.EventName.FIGHT_UP,e.combat-i),this.refreshData(),u.RedDot_Relic.Ins.recheckRelic(),s.E.ins.event(l.EventName.ACHIVATEDEBRIS,[t.id]),d.GE.ins.event(14)}else{e.Relic.relicId=t.id,e.Relic.openRelicDebrisArr.length=0,this._view&&this._view.displayedInStage&&this._view.changeView(t.id);i=e.combat;r.sbkPropTool.init4Relic(),e.reCheckComBat(),a.RoleCenter.instans.event(l.EventName.FIGHT_UP,e.combat-i),u.RedDot_Relic.Ins.recheckRelic(),s.E.ins.event(l.EventName.ACHIVATERELIC,[t.id]);var n=c.RelicUtils.getRelicVo(t.id);h.TipManager.showType1Tip(null,null,c.RelicUtils.getRelicIcon(n.imgIcon),null,null,null,Laya.Handler.create(this,this.onTurnRight,[1]))}},t.prototype.init=function(){this._view=new i.RelicPageView},t.prototype.addEvent=function(){this._view.on(Laya.Event.REMOVED,this,this.onRemoved),this._view.btn_left.on(Laya.Event.CLICK,this,this.onTurnLeft,[-1]),this._view.btn_right.on(Laya.Event.CLICK,this,this.onTurnRight,[1])},t.prototype.onTurnLeft=function(t){this._view&&this._view.btn_left.visible&&this._view.changeViewLeft(this._view.nowShowIdx+t)},t.prototype.onTurnRight=function(t){this._view&&this._view.btn_right.visible&&this._view.changeViewRight(this._view.nowShowIdx+t)},t.prototype.showPage=function(t){this._view||this.init(),t.removeChildren(),t.addChild(this._view),this.addEvent(),this._view.showView(),null!=this._view.parent&&this.refreshData(),p.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){this._view&&this._view.displayedInStage&&this._view.changeView(this._view.nowShowIdx)},t.prototype.getTitle=function(){return"res/relic/sqtitle.png"},t.prototype.onRemoved=function(){this._view.off(Laya.Event.REMOVED,this,this.onRemoved),this._view.btn_left.off(Laya.Event.CLICK,this,this.onTurnLeft),this._view.btn_right.off(Laya.Event.CLICK,this,this.onTurnRight),this._view.onPageRemoved()},t.prototype.hidePage=function(){p.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){p.ResManager.getInstance().destroyPageCtrl(this)},t}();e.RelicPageCtrl=g}),define("src/g/relic/view/GRelicView",["require","exports","../../../manager/LayerManager"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.view_bg.btn_help.visible=!1,t}return __extends(t,e),t.prototype.init=function(){},t.prototype.showView=function(t){void 0===t&&(t=!0),i.LayerManager.addInPOPWindowLayer(this,t)},t.prototype.hideView=function(){this.view_bg.box_page.removeChildren(),this.removeSelf()},t.prototype.destroyView=function(){this.hideView()},t}(ui.relic.GRelic_BgUI);e.GRelicView=n}),define("src/g/relic/ctrl/GRelicCtrl",["require","exports","src/g/relic/ctrl/RelicPageCtrl","src/g/base/BaseCtrl","src/g/relic/view/GRelicView","../../../manager/GuideCenter","../../../enum/GuideTargetName"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.urls=["res/atlas/res/relic.json"],t}return __extends(t,e),t.prototype.initView=function(){this._view=new s.GRelicView,this._relicPage=new i.RelicPageCtrl},t.prototype.addUIEvent=function(){this._view.view_bg.btn_back.on(Laya.Event.CLICK,this,this.onClose),this._view.view_bg.btn_close.on(Laya.Event.CLICK,this,this.onClose),this._view.tab_page.selectHandler=new Laya.Handler(this,this.onChangePage),this._view.on(Laya.Event.REMOVED,this,this.onClose)},t.prototype.onAtlasLoaded=function(){this.realOpenRoleView(this.selectIndex)},t.prototype.realOpenRoleView=function(t){void 0===t&&(t=0),this._view||(this.initView(),o.GuideCenter.ins.registerGuideObject(a.GuideTargetName.RELIC_ACTIVE_BTN,this._view)),this.addUIEvent(),this._view.showView(),0==this._view.tab_page.selectedIndex?this.onChangePage(0):this._view.tab_page.selectedIndex=0},t.prototype.onChangePage=function(t){switch(void 0===t&&(t=0),t){case 0:this._page=this._relicPage}this._page.showPage(this._view.view_bg.box_page),this._view.view_bg.img_title.skin=this._page.getTitle()},t.prototype.onClose=function(){this._view.view_bg.btn_back.off(Laya.Event.CLICK,this,this.onClose),this._view.view_bg.btn_close.off(Laya.Event.CLICK,this,this.onClose),this._view.tab_page.selectHandler=null,this._view.destroyView()},t}(n.BaseCtrl);e.GRelicCtrl=r}),define("src/g/friend/view/item/FriendsPageItem",["require","exports","../../../../core/E","../../../../enum/EventName","src/g/friend/ctrl/FriendsDataManager","../../../../utils/ItemUtils","../../../../manager/AM","../../../net/messages/friend/FriendMsg","../../../../manager/GameSocketManager","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.destroy=function(){i.E.ins.off(n.EventName.FRIENDS_DATA_UPDATED,this,this.updateHandler),this.btn_del.off(Laya.Event.CLICK,this,this.doDelHandler),this.icon_head.off(Laya.Event.CLICK,this,this.popMenuHandler),this._username=null,t.prototype.destroy.call(this)},e.prototype.setData=function(t){this._username=t,i.E.ins.off(n.EventName.FRIENDS_DATA_UPDATED,this,this.updateHandler),this.btn_del.off(Laya.Event.CLICK,this,this.doDelHandler),this.icon_head.off(Laya.Event.CLICK,this,this.popMenuHandler),this._username&&(this.updateHandler(this._username),i.E.ins.on(n.EventName.FRIENDS_DATA_UPDATED,this,this.updateHandler),this.btn_del.on(Laya.Event.CLICK,this,this.doDelHandler),this.icon_head.on(Laya.Event.CLICK,this,this.popMenuHandler))},e.prototype.popMenuHandler=function(){var t=s.FriendsDataManager.ins.getFriendDataByUsername(this._username);t&&i.E.ins.event(n.EventName.OPEN_FRIENDS_MENU_DIALOG,t)},e.prototype.updateHandler=function(t){if(this._username==t){var e=s.FriendsDataManager.ins.getFriendDataByUsername(this._username);e&&(this.icon_head.skin=o.ItemUtils.getHeadUrl(e.sex,e.jobid),this.txt_name.changeText(e.nickname),this.txt_family.changeText(e.familyname),this.txt_lv.changeText(0==e.level?"":o.ItemUtils.getLVString(e.level)),e.onLine?(this.icon_head.disabled=!1,this.icon_online.skin="res/friend/haoyou_zhuangtai_zaixian.png",this.txt_online.color="#349320",this.txt_online.changeText(h.TextConst.get(501))):(this.icon_head.disabled=!0,this.icon_head.mouseEnabled=!0,this.txt_online.color="#8f8f8f",this.txt_online.changeText(h.TextConst.get(502)),this.icon_online.skin="res/friend/haoyou_zhuangtai_lixian.png"))}},e.prototype.doDelHandler=function(){var e=this,t=s.FriendsDataManager.ins.getFriendDataByUsername(this._username);t&&a.AM.show(h.TextConst.get(503,t.nickname),Laya.Handler.create(this,function(){var t=new r.DelFriendC2GS;t.type=r.enumFrdType.friend,t.username=e._username,l.GSM.sendServer(t)}))},e}(ui.friend.item.FriendPageItemUI);e.FriendsPageItem=c}),define("src/g/friend/view/FriendFindDlg",["require","exports","../../../utils/system/FloatEffect","../../net/messages/friend/FriendMsg","../../../manager/GameSocketManager","../../../plugin/view/ToolTip","src/init/TextConst"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.btn_add.on(Laya.Event.CLICK,t,t.onFindHandler),t}return __extends(t,e),t.prototype.showPanel=function(){this.input_txt.changeText(""),this.popup()},t.prototype.onFindHandler=function(){var t=this.input_txt.text;if(t.length<2)return i.FE.upItems(a.TextConst.get(499),o.BubbleEnum.center),void this.close();var e=new n.FindFriendC2GS;e.nickname=t,s.GSM.sendServer(e),this.close()},t}(ui.friend.FriendFindDlgUI);e.FriendFindDlg=r}),define("src/g/friend/view/page/FriendsPage",["require","exports","src/g/friend/view/item/FriendsPageItem","src/g/friend/ctrl/FriendsDataManager","../../../../enum/EventName","../../../../core/E","../../../net/messages/friend/FriendMsg","src/g/friend/view/FriendFindDlg","../../../../manager/NewRedHintsCenter"],function(t,e,i,a,n,s,o,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.btn_find.on(Laya.Event.CLICK,t,t.onFindFriendsHandler),t.list_f.itemRender=i.FriendsPageItem,t.list_f.scrollBar.elasticDistance=100,t.list_f.renderHandler=new Laya.Handler(t,t.listRenderHandler),s.E.ins.on(n.EventName.FRIENDS_RELATION_GROUP_UPDATED,t,t.onListDataChanged),s.E.ins.on(n.EventName.FRIENDS_DATA_UPDATED,t,t.onFriendDataChanged),t}return __extends(t,e),t.prototype.onFriendDataChanged=function(){this.initList()},t.prototype.onListDataChanged=function(t){this.displayedInStage&&0<(t&o.enumFrdType.friend)&&this.initList()},t.prototype.showPage=function(t){t.removeChildren(),this.initList(),this.width=t.width,t.addChild(this)},t.prototype.initList=function(){if(a.FriendsDataManager.ins.isInited){var t=a.FriendsDataManager.ins.getListByRelation(o.enumFrdType.friend);t.sort(this.sortFun),this.list_f.array=t,l.NewRedHintsCenter.ins.setRedHintOpenOrClose(l.enumRedHints.friends_friend,!1)}else s.E.ins.once(n.EventName.FRIENDS_DATA_INITED,this,this.initList)},t.prototype.sortFun=function(t,e){var i=a.FriendsDataManager.ins.getFriendDataByUsername(t),n=a.FriendsDataManager.ins.getFriendDataByUsername(e),s=0;i.onLine||(s+=1);var o=0;return n.onLine||(o+=1),s-o},t.prototype.onFindFriendsHandler=function(){this._findPanel||(this._findPanel=new r.FriendFindDlg),this._findPanel.showPanel()},t.prototype.listRenderHandler=function(t,e){t.setData(t.dataSource)},t}(ui.friend.page.FriendPageUI);e.FriendsPage=h}),define("src/g/friend/view/item/FriendsHeadItem",["require","exports","../../../../core/E","../../../../enum/EventName","../../../../utils/ItemUtils","src/g/friend/ctrl/FriendsDataManager"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.destroy=function(){i.E.ins.off(n.EventName.FRIENDS_DATA_UPDATED,this,this.updateHandler),i.E.ins.off(n.EventName.PRIVATE_CHAT_STATE_CHANGED,this,this.updateChatStateHandler),this._username=null,t.prototype.destroy.call(this)},e.prototype.setData=function(t){this._username=t,i.E.ins.off(n.EventName.FRIENDS_DATA_UPDATED,this,this.updateHandler),i.E.ins.off(n.EventName.PRIVATE_CHAT_STATE_CHANGED,this,this.updateChatStateHandler),this._username&&(this.updateHandler(this._username),this.updateChatStateHandler(this._username),i.E.ins.on(n.EventName.FRIENDS_DATA_UPDATED,this,this.updateHandler),i.E.ins.on(n.EventName.PRIVATE_CHAT_STATE_CHANGED,this,this.updateChatStateHandler))},e.prototype.updateChatStateHandler=function(t){this._username==t&&(this.img_red.visible=1==o.FriendsDataManager.ins.getChatState(this._username))},e.prototype.updateHandler=function(t){if(this._username==t){var e=o.FriendsDataManager.ins.getFriendDataByUsername(this._username);e&&(this.icon_head.skin=s.ItemUtils.getHeadUrl(e.sex,e.jobid),this.txt_name.changeText(e.nickname))}},e}(ui.friend.item.PrivateChatHeadItemUI);e.FriendsHeadItem=a}),define("src/g/friend/view/item/FriendsChatBubble",["require","exports","../../../../manager/RoleCenter","src/g/chat/ctrl/ChatContentManager","../../../../meta/ChatTemplateVo","../../../../utils/system/DateUitl"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.htxt.style.font="SimHei",t.htxt.style.color="#281b08",t.htxt.style.fontSize=20,t.htxt.autoSize=!0,t}return __extends(t,e),t.prototype.setData=function(t){return t.fromUsername==i.RoleCenter.instans.vo.username?this.img_bg.skin="res/friend/haoyou_qipao1.png":this.img_bg.skin="res/friend/haoyou_qipao2.png",this.currContent=n.ChatContentManager.checkInfo(s.ChatTemplateVo.transform(t.msg,!0),30),this.htxt.innerHTML=this.currContent,this.img_bg.width=this.htxt.contextWidth+20,this.img_bg.height=Math.max(46,this.htxt.contextHeight+18),this.lab_time.changeText(o.DateUtil.getHM(1e3*t.chatTime)),this.lab_time.x=this.img_bg.width+5,this.img_bg.height},t.prototype.cutChatContent=function(t){-1!=this.currContent.indexOf(t)&&(this.currContent=this.currContent.replace(t,""),this.htxt.innerHTML=this.currContent)},t}(ui.friend.item.FriendsChatBubbleUI);e.FriendsChatBubble=a}),define("src/g/friend/view/page/PrivateChatPage",["require","exports","../../../../config/GameConfig","src/g/chat/view/ExpItem","src/g/friend/view/item/FriendsHeadItem","src/g/friend/ctrl/FriendsDataManager","../../../net/messages/friend/FriendMsg","../../../../core/E","../../../../enum/EventName","../../../../utils/system/FloatEffect","../../../../manager/GameSocketManager","src/g/friend/view/item/FriendsChatBubble","../../../../manager/RoleCenter","../../../../plugin/view/ToolTip","src/g/chat/view/ChatCommonlyWord","src/g/chat/view/ChatArtWord","src/init/TextConst"],function(t,e,h,c,i,o,s,n,a,r,l,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(e){function t(){var t=e.call(this)||this;return t._initExp=!1,t._pool=[],t._pointY=0,t.input_txt.maxChars=40,t.list_panel.vScrollBarSkin="",t.list_panel.vScrollBar.elasticDistance=200,t.btn_express.on(Laya.Event.CLICK,t,t.openExp),t.btn_send.on(Laya.Event.CLICK,t,t.sendHandler),t.on(Laya.Event.CLICK,t,t.clickHandler),t.list_head.scrollBar.elasticDistance=200,t.list_head.renderHandler=new Laya.Handler(t,t.onHeadListRenderHandler),t.list_head.itemRender=i.FriendsHeadItem,t.list_head.selectEnable=!0,t.list_head.selectHandler=new Laya.Handler(t,t.onHeadListSelectHandler),t.btn_add.on(Laya.Event.CLICK,t,t.onAddFriendsHandler),n.E.ins.on(a.EventName.FRIENDS_RELATION_GROUP_UPDATED,t,t.onListDataChanged),n.E.ins.on(a.EventName.ADD_PRIVATE_CHAT_CONTENT,t,t.onAddChatContentHandler),Laya.Browser.onPC||(t.input_txt.on(Laya.Event.INPUT,t,t._onInput),t.input_txt.on(Laya.Event.BLUR,t,t._onBlur),t.input_txt.on(Laya.Event.FOCUS,t,t._onFocus)),t.commonlyButton.on(Laya.Event.CLICK,t,t.changeComWordVHander),t.listAddEvent(t.commonlyWordList,g.ChatCommonlyWord,t.renderCommonlyWord,t.selectCommonlyWord),t.list_ani_exp.vScrollBarSkin="",t.list_ani_exp.vScrollBar.elasticDistance=200,t.list_ani_exp.on(Laya.Event.CLICK,t,t.stopEventHander),t.commonlyWordList.on(Laya.Event.CLICK,t,t.stopEventHander),n.E.ins.on(a.EventName.DELETE_CHAT_CONTENT,t,t.onDelContent),t}return __extends(t,e),t.prototype.stopEventHander=function(t){t.stopPropagation()},t.prototype._onInput=function(){20<this.input_txt.text.length?this.lab_preview.changeText(this.input_txt.text.substring(this.input_txt.text.length-20)):this.lab_preview.changeText(this.input_txt.text)},t.prototype._onBlur=function(){this.lab_preview.changeText(""),this.lab_preview.visible=this.img_preview_bg.visible=!1},t.prototype._onFocus=function(){this.lab_preview.changeText(this.input_txt.text),this.lab_preview.visible=this.img_preview_bg.visible=!0},t.prototype.onListDataChanged=function(t){this.displayedInStage&&(t==s.enumFrdType.chat?this.initList():t==(s.enumFrdType.friend|s.enumFrdType.friendDouble)&&this.updateBtnAdd())},t.prototype.initList=function(){if(o.FriendsDataManager.ins.isInited){var t=o.FriendsDataManager.ins.getListByRelation(s.enumFrdType.chat);t.sort(this.compareFun);var e=(this.list_head.array=t).indexOf(this._username);-1!=e?this.list_head.selectedIndex=e:0==this.list_head.selectedIndex?this.selectFriends(0):this.list_head.selectedIndex=0}else n.E.ins.once(a.EventName.FRIENDS_DATA_INITED,this,this.initList)},t.prototype.compareFun=function(t,e){var i=o.FriendsDataManager.ins.getFriendDataByUsername(t),n=i?i.chatTime:0;1==o.FriendsDataManager.ins.getChatState(t)&&(n+=604800);var s=(i=o.FriendsDataManager.ins.getFriendDataByUsername(e))?i.chatTime:0;return 1==o.FriendsDataManager.ins.getChatState(e)&&(s+=604800),s-n},t.prototype.showPage=function(t){this.btn_add.visible=!1,this._username=null,t.removeChildren(),this.initList(),this.width=t.width,this.setExpress_panelVisible(!1),this.setComWordVisiable(!1),this.input_txt.changeText(""),t.addChild(this)},t.prototype.onDelContent=function(t){if(t)for(var e=this.list_panel,i=void 0,n=0,s=e.numChildren;n<s;)(i=e.getChildAt(n))&&i.cutChatContent(t),n++},t.prototype.openExp=function(){this.setExpress_panelVisible(!this.list_ani_exp.visible),this.list_ani_exp.visible&&this.initExpression()},t.prototype.initExpression=function(){this._initExp||(this._initExp=!0,this.initAnimation())},t.prototype.initAnimation=function(){var t,e=h.GameConfig.expression,i=[];for(var n in e)1!=(t=e[n]).type&&2!=t.type||i.push(t);for(var s,o=i.length,a=0,r=0,l=0;l<o;l++)1==(t=i[l]).type?(s=new c.ExpItem,t.width=36,t.height=t.height>>1,s.setData(t)):(s=new v.ChatArtWord).update(t),a+t.width>this.list_ani_exp.width&&(a=0,r++),s.x=a,s.pivotY=t.height>>1,a+=t.width+10>>0,s.y=45*r+18,l==o-1&&(this.animationContainer.height=s.y+(t.height>>1)),s.on(Laya.Event.CLICK,this,this.selectHandler,[t]),this.animationContainer.addChild(s)},t.prototype.selectHandler=function(t){35<this.input_txt.text.length||(this.setExpress_panelVisible(!1),this.input_txt.text+=t.id)},t.prototype.setExpress_panelVisible=function(t){this.list_ani_exp.visible=this.list_ani_exp_bg.visible=t,t&&this.setComWordVisiable(!1)},t.prototype.sendHandler=function(){var t=o.FriendsDataManager.ins.getFriendDataByUsername(this._username);if(t)if(o.FriendsDataManager.belongTo(t,s.enumFrdType.black))r.FE.upItems(f.TextConst.get(504),d.BubbleEnum.center);else{var e=this.input_txt.text.replace(/</g,"《").replace(/>/g,"》").replace(/@/g,"*").replace(/(^\s*)|(\s*$)/g,""),i=new s.PrivateChatC2GS;i.msg=e,i.username=this._username,l.GSM.sendServer(i)}this.input_txt.text=""},t.prototype.clickHandler=function(t){t.target!=this.btn_express&&this.setExpress_panelVisible(!1),t.target!=this.commonlyButton&&this.setComWordVisiable(!1)},t.prototype.onHeadListRenderHandler=function(t,e){t.setData(t.dataSource)},t.prototype.onHeadListSelectHandler=function(t){this.selectFriends(t)},t.prototype.selectFriends=function(t){var e=this.list_head.array[t];this._username!=e&&(this._username=e,this.initChatPanel()),this.updateBtnAdd()},t.prototype.updateBtnAdd=function(){var t=o.FriendsDataManager.ins.getFriendDataByUsername(this._username);t&&(o.FriendsDataManager.belongTo(t,s.enumFrdType.friend|s.enumFrdType.friendDouble)?this.btn_add.visible=!1:this.btn_add.visible=!0)},t.prototype.initChatPanel=function(){this.clearChatContent();for(var t=o.FriendsDataManager.ins.getChatList(this._username),e=t?t.length:0,i=0;i<e;)this.addChatContent(t[i]),i++;this._username&&o.FriendsDataManager.ins.setChatReaded(this._username)},t.prototype.clearChatContent=function(){for(var t=this.list_panel.numChildren-1;0<=t;){var e=this.list_panel.removeChildAt(t);e&&this._pool.push(e),t--}this.list_panel.vScrollBar.value=0,this._pointY=0},t.prototype.addChatContent=function(t){var e,i=(e=0==this._pool.length?new u.FriendsChatBubble:this._pool.pop()).setData(t);e.y=this._pointY,this._pointY+=i+5,this.list_panel.addChild(e),Laya.timer.callLater(this,this.setScroll)},t.prototype.onAddChatContentHandler=function(t){if(this.displayedInStage){var e=t.fromUsername==p.RoleCenter.instans.vo.username?t.toUsername:t.fromUsername;this._username==e?(this.addChatContent(t),o.FriendsDataManager.ins.setChatReaded(e)):this.initList()}},t.prototype.setScroll=function(){this.list_panel.vScrollBar.value=Math.max(0,this._pointY-this.list_panel.height)},t.prototype.onAddFriendsHandler=function(){var t=!0,e=o.FriendsDataManager.ins.getFriendDataByUsername(this._username);if(e)if(o.FriendsDataManager.belongTo(e,s.enumFrdType.friend|s.enumFrdType.friendDouble))r.FE.upItems(f.TextConst.get(496),d.BubbleEnum.center),t=!1;else if(o.FriendsDataManager.belongTo(e,s.enumFrdType.black))r.FE.upItems(f.TextConst.get(497),d.BubbleEnum.center),t=!1;else if(o.FriendsDataManager.belongTo(e,s.enumFrdType.apply)){var i=new s.ApplyFriendC2GS;i.isAdd=!0,i.username=this._username,l.GSM.sendServer(i),t=!1}if(t){var n=new s.AddFriendC2GS;n.type=s.enumFrdType.friend,n.username=this._username,l.GSM.sendServer(n),r.FE.upItems(f.TextConst.get(498,e.nickname),d.BubbleEnum.center)}},t.prototype.setComWordVisiable=function(t){this.commonlyWordGround.visible=this.commonlyWordList.visible=t,t&&(0==this.commonlyWordList.array.length&&this.initCommonlyWord(),this.setExpress_panelVisible(!1))},t.prototype.changeComWordVHander=function(){this.setComWordVisiable(!this.commonlyWordList.visible)},t.prototype.initCommonlyWord=function(){var t,e=h.GameConfig.expression,i=[];for(var n in e)3==(t=e[n]).type&&i.push(t);this.commonlyWordList.array=i},t.prototype.listAddEvent=function(t,e,i,n){t.itemRender=e,t.renderHandler=new Laya.Handler(this,i),t.mouseHandler=new Laya.Handler(this,n),t.vScrollBarSkin="",t.scrollBar.elasticDistance=200,t.selectEnable=!0,t.array=[]},t.prototype.renderCommonlyWord=function(t,e){t.update()},t.prototype.selectCommonlyWord=function(t,e){if(t.type==Laya.Event.CLICK){if(e<=-1)return;var i=this.commonlyWordList.array[e];if(40<(this.input_txt.text+i.res).toString().length)return;this.input_txt.text+=i.res,this.setComWordVisiable(!1)}},t}(ui.friend.page.PrivateChatPageUI);e.PrivateChatPage=y}),define("src/g/friend/view/item/BlackListPageItem",["require","exports","../../../../core/E","../../../../enum/EventName","../../../../utils/ItemUtils","src/g/friend/ctrl/FriendsDataManager","../../../../manager/AM","../../../net/messages/friend/FriendMsg","../../../../manager/GameSocketManager","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t.icon_online.visible=!1,t.txt_online.visible=!1,t}return __extends(t,e),t.prototype.destroy=function(){i.E.ins.off(n.EventName.FRIENDS_DATA_UPDATED,this,this.updateHandler),this.btn_del.off(Laya.Event.CLICK,this,this.doDelHandler),this.icon_head.off(Laya.Event.CLICK,this,this.popMenuHandler),this._username=null,e.prototype.destroy.call(this)},t.prototype.setData=function(t){this._username=t,i.E.ins.off(n.EventName.FRIENDS_DATA_UPDATED,this,this.updateHandler),this.btn_del.off(Laya.Event.CLICK,this,this.doDelHandler),this.icon_head.off(Laya.Event.CLICK,this,this.popMenuHandler),this._username&&(this.updateHandler(this._username),i.E.ins.on(n.EventName.FRIENDS_DATA_UPDATED,this,this.updateHandler),this.btn_del.on(Laya.Event.CLICK,this,this.doDelHandler),this.icon_head.on(Laya.Event.CLICK,this,this.popMenuHandler))},t.prototype.popMenuHandler=function(){var t=o.FriendsDataManager.ins.getFriendDataByUsername(this._username);t&&i.E.ins.event(n.EventName.OPEN_FRIENDS_MENU_DIALOG,t)},t.prototype.updateHandler=function(t){if(this._username==t){var e=o.FriendsDataManager.ins.getFriendDataByUsername(this._username);e&&(this.icon_head.skin=s.ItemUtils.getHeadUrl(e.sex,e.jobid),this.txt_name.changeText(e.nickname),this.txt_family.changeText(e.familyname),this.txt_lv.changeText(0==e.level?"":s.ItemUtils.getLVString(e.level)))}},t.prototype.doDelHandler=function(){var e=this,t=o.FriendsDataManager.ins.getFriendDataByUsername(this._username);t&&a.AM.show(h.TextConst.get(500,t.nickname),Laya.Handler.create(this,function(){var t=new r.DelFriendC2GS;t.type=r.enumFrdType.black,t.username=e._username,l.GSM.sendServer(t)}))},t}(ui.friend.item.FriendPageItemUI);e.BlackListPageItem=c}),define("src/g/friend/view/page/BlackListPage",["require","exports","src/g/friend/view/item/BlackListPageItem","src/g/friend/ctrl/FriendsDataManager","../../../net/messages/friend/FriendMsg","../../../../core/E","../../../../enum/EventName"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.btn_find.removeSelf(),t.list_f.itemRender=i.BlackListPageItem,t.list_f.scrollBar.elasticDistance=100,t.list_f.renderHandler=new Laya.Handler(t,t.listRenderHandler),o.E.ins.on(a.EventName.FRIENDS_RELATION_GROUP_UPDATED,t,t.onListDataChanged),t}return __extends(t,e),t.prototype.onListDataChanged=function(t){this.displayedInStage&&t==s.enumFrdType.black&&this.initList()},t.prototype.showPage=function(t){t.removeChildren(),this.initList(),this.width=t.width,t.addChild(this)},t.prototype.listRenderHandler=function(t,e){t.setData(t.dataSource)},t.prototype.initList=function(){if(n.FriendsDataManager.ins.isInited){var t=n.FriendsDataManager.ins.getListByRelation(s.enumFrdType.black);this.list_f.array=t}else o.E.ins.once(a.EventName.FRIENDS_DATA_INITED,this,this.initList)},t}(ui.friend.page.FriendPageUI);e.BlackListPage=r}),define("src/g/friend/view/item/RequestListPageItem",["require","exports","../../../../core/E","../../../../enum/EventName","src/g/friend/ctrl/FriendsDataManager","../../../../utils/ItemUtils","../../../net/messages/friend/FriendMsg","../../../../manager/GameSocketManager"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t.icon_online.visible=!1,t.txt_online.visible=!1,t}return __extends(t,e),t.prototype.destroy=function(){i.E.ins.off(n.EventName.FRIENDS_DATA_UPDATED,this,this.updateHandler),this.btn_agree.off(Laya.Event.CLICK,this,this.doAgreeHandler),this.btn_reject.off(Laya.Event.CLICK,this,this.doRejectHandler),this.icon_head.off(Laya.Event.CLICK,this,this.popMenuHandler),this._username=null,e.prototype.destroy.call(this)},t.prototype.setData=function(t){this._username=t,i.E.ins.off(n.EventName.FRIENDS_DATA_UPDATED,this,this.updateHandler),this.btn_agree.off(Laya.Event.CLICK,this,this.doAgreeHandler),this.btn_reject.off(Laya.Event.CLICK,this,this.doRejectHandler),this.icon_head.off(Laya.Event.CLICK,this,this.popMenuHandler),this._username&&(this.updateHandler(this._username),i.E.ins.on(n.EventName.FRIENDS_DATA_UPDATED,this,this.updateHandler),this.btn_agree.on(Laya.Event.CLICK,this,this.doAgreeHandler),this.btn_reject.on(Laya.Event.CLICK,this,this.doRejectHandler),this.icon_head.on(Laya.Event.CLICK,this,this.popMenuHandler))},t.prototype.popMenuHandler=function(){var t=s.FriendsDataManager.ins.getFriendDataByUsername(this._username);t&&i.E.ins.event(n.EventName.OPEN_FRIENDS_MENU_DIALOG,t)},t.prototype.updateHandler=function(t){if(this._username==t){var e=s.FriendsDataManager.ins.getFriendDataByUsername(this._username);e&&(this.icon_head.skin=o.ItemUtils.getHeadUrl(e.sex,e.jobid),this.txt_name.changeText(e.nickname),this.txt_family.changeText(e.familyname),this.txt_lv.changeText(0==e.level?"":o.ItemUtils.getLVString(e.level)))}},t.prototype.doAgreeHandler=function(){if(s.FriendsDataManager.ins.getFriendDataByUsername(this._username)){var t=new a.ApplyFriendC2GS;t.isAdd=!0,t.username=this._username,r.GSM.sendServer(t)}},t.prototype.doRejectHandler=function(){if(s.FriendsDataManager.ins.getFriendDataByUsername(this._username)){var t=new a.ApplyFriendC2GS;t.isAdd=!1,t.username=this._username,r.GSM.sendServer(t)}},t}(ui.friend.item.RequestListPageItemUI);e.RequestListPageItem=l}),define("src/g/friend/view/page/RequestListPage",["require","exports","src/g/friend/view/item/RequestListPageItem","src/g/friend/ctrl/FriendsDataManager","../../../net/messages/friend/FriendMsg","../../../../enum/EventName","../../../../core/E","../../../../manager/NewRedHintsCenter"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t.btn_find.removeSelf(),t.list_f.itemRender=i.RequestListPageItem,t.list_f.scrollBar.elasticDistance=100,t.list_f.renderHandler=new Laya.Handler(t,t.listRenderHandler),a.E.ins.on(o.EventName.FRIENDS_RELATION_GROUP_UPDATED,t,t.onListDataChanged),t}return __extends(t,e),t.prototype.onListDataChanged=function(t){this.displayedInStage&&0<(t&s.enumFrdType.apply)&&this.initList()},t.prototype.showPage=function(t){t.removeChildren(),this.initList(),this.width=t.width,t.addChild(this)},t.prototype.initList=function(){if(n.FriendsDataManager.ins.isInited){var t=n.FriendsDataManager.ins.getListByRelation(s.enumFrdType.apply);this.list_f.array=t,r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.friends_request,!1)}else a.E.ins.once(o.EventName.FRIENDS_DATA_INITED,this,this.initList)},t.prototype.listRenderHandler=function(t,e){t.setData(t.dataSource)},t}(ui.friend.page.FriendPageUI);e.RequestListPage=l}),define("src/g/friend/view/FriendView",["require","exports","../../../manager/LayerManager","src/g/friend/view/page/FriendsPage","src/g/friend/view/page/PrivateChatPage","src/g/friend/view/page/BlackListPage","src/g/friend/view/page/RequestListPage","src/g/proxy/MultiLevelUIProxy","src/init/Switches","../../../core/E","../../../enum/EventName"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t._tabProxy=new r.MultiLevelUIProxy,t._tabProxy.registerTab(t.btn_menu,0),t._tabProxy.registerTagIndex(104,0),t._tabProxy.registerTagIndex(106,1),t._tabProxy.registerTagIndex(107,2),t._tabProxy.registerTagIndex(108,3),t._tabProxy.selectHandler=new Laya.Handler(t,t.onMenuSelectHandler),t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.zOrder=200,t.btn_go.on(Laya.Event.CLICK,t,t.goToChat),t}return __extends(t,e),t.prototype.goToChat=function(){this.onCloseHandler(),l.Switches.ins.event(24)},t.prototype.onTabSelectHandler=function(t){0==t&&(this.onCloseHandler(),l.Switches.ins.event(24))},t.prototype.showView=function(t){this.y=Laya.stage.height-this.height,this.box_content.width=this.width=Laya.stage.width,this._tabProxy.open(t),i.LayerManager.addChat(this),h.E.ins.on(c.EventName.WINDOW_PANEL_ADDED,this,this.onWindowAdd)},t.prototype.onWindowAdd=function(){this.onCloseHandler()},t.prototype.revertTab=function(){this._tabProxy.revertTab()},t.prototype.onCloseHandler=function(){this.removeSelf(),h.E.ins.off(c.EventName.WINDOW_PANEL_ADDED,this,this.onWindowAdd)},t.prototype.onMenuSelectHandler=function(t){switch(t){case 0:this._view0||(this._view0=new n.FriendsPage),this._view0.showPage(this.box_content);break;case 1:this._view1||(this._view1=new s.PrivateChatPage),this._view1.showPage(this.box_content);break;case 2:this._view2||(this._view2=new a.RequestListPage),this._view2.showPage(this.box_content);break;case 3:this._view3||(this._view3=new o.BlackListPage),this._view3.showPage(this.box_content)}},t}(ui.friend.FriendViewUI);e.FriendView=u}),define("src/g/friend/view/RoleMenuDlg",["require","exports","../../../utils/ItemUtils","src/g/friend/ctrl/FriendsDataManager","../../net/messages/friend/FriendMsg","../../../utils/system/FloatEffect","../../../core/E","../../../enum/EventName","../../../manager/GameSocketManager","../../../plugin/view/ToolTip","../../../manager/RoleCenter","src/init/TextConst"],function(t,e,i,s,o,a,n,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t.btn_add.on(Laya.Event.CLICK,t,t.onAddFriendsHandler),t.btn_private.on(Laya.Event.CLICK,t,t.onPrivateChatHandler),t.btn_black.on(Laya.Event.CLICK,t,t.onAddBlackHandler),t.btn_look.on(Laya.Event.CLICK,t,t.onLookHandler),t}return __extends(t,e),t.prototype.showRole=function(t){t&&t.username!=c.RoleCenter.instans.vo.username&&(this._username=t.username,this._nickname=t.nickname,this.icon_head.skin=i.ItemUtils.getHeadUrl(t.sex,t.jobid),this.txt_name.changeText(t.nickname),this.txt_family.changeText(t.familyname),this.txt_lv.changeText(0==t.level?"":i.ItemUtils.getLVString(t.level)),this.popup())},t.prototype.onAddFriendsHandler=function(){var t=!0,e=s.FriendsDataManager.ins.getFriendDataByUsername(this._username);if(e)if(s.FriendsDataManager.belongTo(e,o.enumFrdType.friend|o.enumFrdType.friendDouble))a.FE.upItems(u.TextConst.get(496),h.BubbleEnum.center),t=!1;else if(s.FriendsDataManager.belongTo(e,o.enumFrdType.black))a.FE.upItems(u.TextConst.get(497),h.BubbleEnum.center),t=!1;else if(s.FriendsDataManager.belongTo(e,o.enumFrdType.apply)){var i=new o.ApplyFriendC2GS;i.isAdd=!0,i.username=this._username,l.GSM.sendServer(i),t=!1}if(t){var n=new o.AddFriendC2GS;n.type=o.enumFrdType.friend,n.username=this._username,l.GSM.sendServer(n),a.FE.upItems(u.TextConst.get(498,this._nickname),h.BubbleEnum.center)}this.close()},t.prototype.onPrivateChatHandler=function(){var t=!0,e=s.FriendsDataManager.ins.getFriendDataByUsername(this._username);if(e&&s.FriendsDataManager.belongTo(e,o.enumFrdType.black)&&(a.FE.upItems(u.TextConst.get(504),h.BubbleEnum.center),t=!1),t){var i=new o.ApplyPrivateChatC2GS;i.username=this._username,l.GSM.sendServer(i)}this.close()},t.prototype.onAddBlackHandler=function(){var t=!0,e=s.FriendsDataManager.ins.getFriendDataByUsername(this._username);if(e&&s.FriendsDataManager.belongTo(e,o.enumFrdType.black)&&(a.FE.upItems(u.TextConst.get(505),h.BubbleEnum.center),t=!1),t){var i=new o.AddFriendC2GS;i.type=o.enumFrdType.black,i.username=this._username,l.GSM.sendServer(i)}this.close()},t.prototype.onLookHandler=function(){n.E.ins.event(r.EventName.OPEN_RANKROLEVIEW,[this._username]),this.close()},t}(ui.friend.RoleMenuDlgUI);e.RoleMenuDlg=p}),define("src/g/friend/ctrl/FriendViewCtrl",["require","exports","src/g/friend/view/FriendView","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","src/g/friend/ctrl/FriendsDataManager","src/g/friend/view/RoleMenuDlg","../../net/messages/friend/FriendData","../../net/messages/friend/FriendMsg","../../../manager/GameSocketManager","../../net/messages/sbkFormula","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/init/Switches","../../../runtime/resload/GameResLoad","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(){function t(){}return t.prototype.init=function(){var t=g.Switches.ins;t.on(104,this,this.onOpenHandler,[104]),t.on(106,this,this.onOpenHandler,[106]),t.on(107,this,this.onOpenHandler,[107]),t.on(108,this,this.onOpenHandler,[108]),n.E.ins.on(s.EventName.OPEN_FRIENDS_MENU_DIALOG,this,this.openMenuDlg),a.FriendsDataManager.ins,c.GSM.ins.on(h.DelFriendGS2C.KEY,this,this.onDelHandler),c.GSM.ins.on(h.AddFriendGS2C.KEY,this,this.onAddHandler),c.GSM.ins.on(h.FindFriendGS2C.KEY,this,this.onFindBackHandler),c.GSM.ins.on(h.UpdateFriendGS2C.KEY,this,this.onUpdateHandler),c.GSM.ins.on(h.ApplyPrivateChatGS2C.KEY,this,this.onPrivateChatRequest),c.GSM.ins.on(h.PrivateChatGS2C.KEY,this,this.addChatContentHandler),c.GSM.ins.on(h.PrivateChat1GS2C.KEY,this,this.onGetChatContentHandler),c.GSM.ins.once(l.sbkUserFriendData.KEY,this,this.onInitDataHandler),n.E.ins.on(s.EventName.DELETE_CHAT_CONTENT,this,this.onDelContent)},t.prototype.onDelContent=function(t){t&&a.FriendsDataManager.ins.cutChatContent(t)},t.prototype.onOpenHandler=function(t,e){e?this.openPanel(t):this._view&&this._view.revertTab()},t.prototype.openPanel=function(t){void 0===t&&(t=0),this._view||(v.GameResLoad.load("res/atlas/res/friend.json"),this._view=new i.FriendView),this._view.showView(t)},t.prototype.openMenuDlg=function(t){this._menuDlg||(v.GameResLoad.load("res/atlas/res/friend.json"),this._menuDlg=new r.RoleMenuDlg),this._menuDlg.showRole(t)},t.prototype.onDelHandler=function(t){var e=a.FriendsDataManager.ins.getFriendDataByUsername(t.username);e&&(u.sbkFormula.containBit(h.enumFrdType.friend|h.enumFrdType.friendDouble,t.type)?e.relation=u.sbkFormula.subBit(e.relation,h.enumFrdType.friend|h.enumFrdType.friendDouble):e.relation=u.sbkFormula.subBit(e.relation,t.type),a.FriendsDataManager.ins.updateFriendsData(e),u.sbkFormula.containBit(t.type,h.enumFrdType.apply)&&p.FE.upItems(f.TextConst.get(493,e.nickname),d.BubbleEnum.center))},t.prototype.onAddHandler=function(t){u.sbkFormula.containBit(h.enumFrdType.friend|h.enumFrdType.friendDouble,t.type)&&p.FE.upItems(f.TextConst.get(494,t.friendData.nickname),d.BubbleEnum.center),a.FriendsDataManager.ins.updateFriendsData(t.friendData)},t.prototype.onPrivateChatRequest=function(t){a.FriendsDataManager.ins.updateFriendsData(t.friendData),g.Switches.ins.event(106)},t.prototype.onFindBackHandler=function(t){if(t.friendData)if(t.friendData.username==o.RoleCenter.instans.vo.username)p.FE.upItems(f.TextConst.get(495),d.BubbleEnum.center);else{var e=!0,i=a.FriendsDataManager.ins.getFriendDataByUsername(t.friendData.username);if(i)if(a.FriendsDataManager.belongTo(i,h.enumFrdType.friend|h.enumFrdType.friendDouble))p.FE.upItems(f.TextConst.get(496),d.BubbleEnum.center),e=!1;else if(a.FriendsDataManager.belongTo(i,h.enumFrdType.black))p.FE.upItems(f.TextConst.get(497),d.BubbleEnum.center),e=!1;else if(a.FriendsDataManager.belongTo(i,h.enumFrdType.apply)){var n=new h.ApplyFriendC2GS;n.isAdd=!0,n.username=t.friendData.username,c.GSM.sendServer(n),e=!1}if(e){var s=new h.AddFriendC2GS;s.type=h.enumFrdType.friend,s.username=t.friendData.username,c.GSM.sendServer(s),p.FE.upItems(f.TextConst.get(498,t.friendData.nickname),d.BubbleEnum.center)}}},t.prototype.onUpdateHandler=function(t){for(var e=t.friendDataArr.length,i=0;i<e;)a.FriendsDataManager.ins.updateFriendsData(t.friendDataArr[i]),i++},t.prototype.onInitDataHandler=function(t){o.RoleCenter.instans.vo.friendsData=t,a.FriendsDataManager.ins.initDataHandler()},t.prototype.addChatContentHandler=function(t){var e=t.fromUsername==o.RoleCenter.instans.vo.username?t.toUsername:t.fromUsername,i=a.FriendsDataManager.ins.getFriendDataByUsername(e);i&&(i.chatTime=t.chatTime,i.relation=u.sbkFormula.addBit(i.relation,h.enumFrdType.chat),a.FriendsDataManager.ins.updateFriendsData(i)),a.FriendsDataManager.ins.addChatContent(t,e)},t.prototype.onGetChatContentHandler=function(t){a.FriendsDataManager.ins.updateFriendsData(t.friendData);var e=new h.PrivateChatGS2C;e.msg=t.msg,e.toUsername=t.toUsername,e.fromUsername=t.friendData.username,e.chatTime=t.friendData.chatTime;var i=e.fromUsername==o.RoleCenter.instans.vo.username?e.toUsername:e.fromUsername;a.FriendsDataManager.ins.addChatContent(e,i)},t}();e.FriendViewCtrl=y}),define("src/g/monopoly/view/MonopolyBoxInfoDlg",["require","exports","../../../config/GameConfig","../../../utils/ItemCellUtils","../../../manager/RoleCenter","src/init/TextConst"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.box_reward.itemRender=ui.custom.ItemNameViewUI,t.box_reward.renderHandler=new Laya.Handler(t,t.onRenderHandler),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){n.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.showBox=function(t){var e=i.GameConfig.monopolyBoxJson[t];e&&(this.lab_title.changeText(o.TextConst.get(63,e.need)),this.box_reward.array=e.reward,e.need>s.RoleCenter.instans.vo.dfwData.circleNum?this.lab_desc.changeText(e.dec.replace("{1}",(e.need-s.RoleCenter.instans.vo.dfwData.circleNum).toString())):this.lab_desc.changeText(""),this.popup())},t}(ui.monopoly.MonopolyBoxInfoDlgUI);e.MonopolyBoxInfoDlg=a}),define("src/g/monopoly/view/MonopolyView",["require","exports","../../net/messages/sbkDaFuWengC2GS","../../net/messages/OpResultType","../../../manager/GameSocketManager","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../../config/GameConfig","../../../utils/ItemUtils","../../../manager/LayerManager","../../net/messages/sbkDaFuWengData","../../../manager/FlyManager","../../../utils/UIUtils","src/g/monopoly/view/MonopolyBoxInfoDlg","src/g/Effects/UIEffectsFactory","src/g/fight/osprite/obj/SelfBaseUnit","src/g/fight/base/RES","src/g/clearRes/ClearResM","src/init/Switches","src/init/TextConst"],function(t,e,s,o,a,i,n,r,l,h,c,u,p,d,g,v,f,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var I=laya.utils.Tween,b=laya.utils.Ease,w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._inited=!1,t._state=0,t._autoThrow=!1,t._currPos=0,t._waittingPoints=[],t._dir=1,t.lockResArr=[],t._progressArr=[],t._step=0,t._moveSpeed=4,t._targetX=0,t._targetY=0,t}return __extends(t,e),t.prototype.showPage=function(t){t.removeChildren(),t.addChild(this),this.refreshData(),m.ClearResM.addBgUrl(this.bgimg.skin),this.bgimg.restskin(),m.ClearResM.resetViewImg(this)},t.prototype.init=function(){this.lab_currnum.text=r.RoleCenter.instans.vo.dfwData.circleNum.toString(),this.onDicenumChangedHandler(),this.updateBoxState(),this.playInitEffect()},t.prototype.playInitEffect=function(){for(var t,e,i=0;i<26;)(e=this["grid"+i])&&(t=l.GameConfig.monopolyJson[i],this.setGridQuality(i,t?t.quality:1),e.img_icon.visible=!1,e.lab_num.visible=!1,e.visible=!1),i++;this._currShowIndex=0,this.showNextBox()},t.prototype.showNextBox=function(){var t=this;if(26<=this._currShowIndex)return this.refreshAll(),void this.initEvents();var e=this["grid"+this._currShowIndex];if(e){e.y;e.visible=!0,e.alpha=.5,I.to(e,{alpha:1},50,b.linearOut,Laya.Handler.create(this,function(){t._currShowIndex++,t.showNextBox()}))}else this._currShowIndex++,this.showNextBox()},t.prototype.initEvents=function(){this.btn_auto.on(Laya.Event.CLICK,this,this.onAutoThrowHandler),this.btn_throw.on(Laya.Event.CLICK,this,this.onThrowHandler),this.box1.on(Laya.Event.CLICK,this,this.onOpenBoxHandler,[1]),this.box2.on(Laya.Event.CLICK,this,this.onOpenBoxHandler,[2]),this.box3.on(Laya.Event.CLICK,this,this.onOpenBoxHandler,[3]),this.box4.on(Laya.Event.CLICK,this,this.onOpenBoxHandler,[4]),i.E.ins.on(n.EventName.DICENUM_CHANGED,this,this.onDicenumChangedHandler),a.GSM.ins.on(u.sbkDaFuWengData.KEY,this,this.onResetDataHandler),r.RoleCenter.instans.on(o.enumOpResultType.dfw_getOne.toString(),this,this.onThrowBackHandler),r.RoleCenter.instans.on(o.enumOpResultType.dfw_getBox.toString(),this,this.onGetBoxHandler),this._inited=!0},t.prototype.onCloseHandler=function(){for(this.removeSelf(),this._state=0,this._autoThrow=!1,this.btn_auto.label=C.TextConst.get(628),this.stopMove(),0<this._step&&(this._currPos+=this._step,r.RoleCenter.instans.vo.dfwData.rewardArr[this._currPos]=-1);0<this._waittingPoints.length;)this._step=this._waittingPoints.shift(),this._currPos+=this._step,r.RoleCenter.instans.vo.dfwData.rewardArr[this._currPos]=-1;this._currPos=this._step=0,this.unLockPlayerRes()},t.prototype.showView=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),c.LayerManager.addInPOPWindowLayer(this,t,!0,!0,!1,e),this.refreshData(),m.ClearResM.resetViewImg(this)},t.prototype.refreshData=function(){this._inited?this.refreshAll():this.init()},t.prototype.lockPlayerRes=function(){if(this._player){this.unLockPlayerRes();for(var t,e=0;e<8;)this._player.avatarId&&(t=y.RES.rolePath(this._player.avatarId,this._player.sex,2,e,this._player.job),this.lockResArr.push(t),m.ClearResM.setCachUrl(t),t=y.RES.rolePath(this._player.avatarId,this._player.sex,1,e,this._player.job),this.lockResArr.push(t),m.ClearResM.setCachUrl(t)),this._player.weaponId&&(t=y.RES.weaponRes(this._player.weaponId,2,e,this._player.job),this.lockResArr.push(t),m.ClearResM.setCachUrl(t),t=y.RES.weaponRes(this._player.weaponId,1,e,this._player.job),this.lockResArr.push(t),m.ClearResM.setCachUrl(t)),this._player.wingId&&(t=y.RES.wingPath(this._player.wingId,2,e,this._player.job),this.lockResArr.push(t),m.ClearResM.setCachUrl(t),t=y.RES.wingPath(this._player.wingId,1,e,this._player.job),this.lockResArr.push(t),m.ClearResM.setCachUrl(t)),e++}},t.prototype.unLockPlayerRes=function(){for(var t=this.lockResArr.length,e=0;e<t;)m.ClearResM.clearCachUrl(this.lockResArr[e]),e++;this.lockResArr.length=0},t.prototype.refreshAll=function(){if(!this._player){this._player=new f.SelfBaseUnit;var t=r.RoleCenter.instans.self;this._player.initHeroData(t.openhero[0],t.JUNGONG,t.STORYEXP),this.box_grids.addChild(this._player.body)}this._player.resetEquipData(),this.lockPlayerRes(),this._autoThrow=!1,this._state=0,this.btn_auto.label=C.TextConst.get(629),this.stopMove(),this.locationTarget(),this.resetData()},t.prototype.resetData=function(){this._currRewardArr=r.RoleCenter.instans.vo.dfwData.rewardArr.concat(),this.lab_currnum.text=r.RoleCenter.instans.vo.dfwData.circleNum.toString(),this.onDicenumChangedHandler(),this.initGridContent(),this._rewardDataChanaged=!1,this.updateBoxState()},t.prototype.locationTarget=function(){this._currPos=r.RoleCenter.instans.vo.dfwData.curIdx,this._dir=this.getDirByIndex(this._currPos),this.img_dir.rotation=this.getRotationByDir(this._dir),this.resetPlayerFace();var t=this.getPosByIndex(this._currPos);this.img_dir.x=t[0],this.img_dir.y=t[1],this._player&&this._player.body.pos(t[0],t[1])},t.prototype.updateBoxState=function(){for(var t,e=1;e<=4;)(t=l.GameConfig.monopolyBoxJson[e])&&(this._progressArr[e-1]=t.need,this["lab_round"+e].changeText(C.TextConst.get(61,t.need)),this["effect"+e].visible=!1,-1==r.RoleCenter.instans.vo.dfwData.boxIdArr.indexOf(e)?(this["box"+e].skin="res/unpack/baoxiang_lv0"+(e+1)+".png",r.RoleCenter.instans.vo.dfwData.circleNum>=t.need&&(this["effect"+e].visible=!0)):this["box"+e].skin="res/unpack/baoxiang_lv0"+(e+1)+"kai.png"),e++;this.updateBoxProgress()},t.prototype.updateBoxProgress=function(){for(var t=this._progressArr.length,e=1/(t-1),i=0,n=0,s=0,o=0,a=r.RoleCenter.instans.vo.dfwData.circleNum;i<t-1;){if(n=this._progressArr[i],!((s=this._progressArr[i+1])<=a)){o+=Math.max(0,(a-n)/(s-n)*e);break}o+=e,i++}this.progress_bar.scaleX=Math.min(1,o)},t.prototype.resetPlayerFace=function(){this._player&&(1==this._dir&&(this._player.face=2),2==this._dir&&(this._player.face=4),3==this._dir&&(this._player.face=6),4==this._dir&&(this._player.face=0),4<this._player.face?this._player.body.scaleX=-1:this._player.body.scaleX=1,this._moveing?this._player.playMove():this._player.stand())},t.prototype.onDicenumChangedHandler=function(){this.displayedInStage&&(0<r.RoleCenter.instans.vo.DICENUM?(this.img_cost.visible=!1,this.lab_cost.changeText(C.TextConst.get(630,r.RoleCenter.instans.vo.DICENUM))):(this.img_cost.visible=!0,this.lab_cost.changeText("200")))},t.prototype.initGridContent=function(){for(var t,e=r.RoleCenter.instans.vo.dfwData.rewardArr,i=e.length,n=0;n<26;){if(t=l.GameConfig.monopolyJson[n],n<i){var s=e[n];t&&-1!=s?this.fillGrid(n,t.reward[s][0],t.reward[s][1]):this.fillGrid(n,null,0)}n++}},t.prototype.getDirByIndex=function(t){var e=1;return 7<t&&e++,12<t&&e++,20<t&&e++,e},t.prototype.getRotationByDir=function(t){return 90*(t-1)},t.prototype.getPosByIndex=function(t){for(var e=Math.min(26,t+1),i=1,n=83,s=17,o=1;i<e;)8!=i&&13!=i&&21!=i||o++,1==o?n+=55:2==o?s+=56:3==o?n-=55:4==o&&(s-=56),i++;return[n,s]},t.prototype.flyIconToBag=function(t,e){var i=this["grid"+t];i&&p.FlyManager.ins.flyIconToBag("DICENUM"==e?"res/monopoly/cangbaoge_shaizitubiao.png":h.ItemUtils.getIconById(Number(e)),d.UIUtils.localToGlobal(i,new Laya.Point(i.img_icon.x,i.img_icon.y)))},t.prototype.fillGrid=function(t,e,i){var n=this["grid"+t];n&&(n.img_icon.visible=!1,e&&(n.img_icon.visible=(n.img_icon.skin="DICENUM"==e?h.ItemUtils.getIconByDefine(e):h.ItemUtils.getIconById(Number(e)),!0)),n.lab_num.visible=0<i&&(n.lab_num.changeText("×"+i),!0))},t.prototype.setGridQuality=function(t,e){var i,n=this["grid"+t];n&&(1==e?i="res/monopoly/cangbaoge_gezibai.png":2==e?i="res/monopoly/cangbaoge_gezilv.png":3==e?i="res/monopoly/cangbaoge_gezilan.png":4==e?i="res/monopoly/cangbaoge_gezizi.png":5==e?i="res/monopoly/cangbaoge_gezicheng.png":6==e&&(i="res/monopoly/cangbaoge_gezihong.png"),i&&(n.img_grid.skin=i))},t.prototype.onThrowHandler=function(){this._autoThrow||(this.img_dir.visible=!1,this.doThrowOne())},t.prototype.onAutoThrowHandler=function(){if(this.img_dir.visible=!1,this._autoThrow)return this._autoThrow=!1,void(this.btn_auto.label=C.TextConst.get(629));0==this._state&&(this._autoThrow=!0,this.img_dice.visible=!1,this.btn_auto.label=C.TextConst.get(631),this.doThrowOne())},t.prototype.doThrowOne=function(){if(0==this._state)if(0<r.RoleCenter.instans.vo.DICENUM||200<=r.RoleCenter.instans.vo.GOLD){var t=new s.sbkDaFuWengC2GS;t.msgIdx=o.enumOpResultType.dfw_getOne,a.GSM.sendServer(t)}else _.Switches.ins.event(155),this._autoThrow=!1,this.btn_auto.label=C.TextConst.get(629)},t.prototype.onOpenBoxHandler=function(t){var e=!0;if(-1==r.RoleCenter.instans.vo.dfwData.boxIdArr.indexOf(t)){var i=l.GameConfig.monopolyBoxJson[t];if(i&&r.RoleCenter.instans.vo.dfwData.circleNum>=i.need){var n=new s.sbkDaFuWengC2GS;n.msgIdx=o.enumOpResultType.dfw_getBox,n.cfgId=t,a.GSM.sendServer(n),e=!1}}e&&(this._boxInfoDlg||(this._boxInfoDlg=new g.MonopolyBoxInfoDlg),this._boxInfoDlg.showBox(t))},t.prototype.onResetDataHandler=function(t){this._autoThrow&&(this._needStopAuto=!0),this.displayedInStage&&(0!=this._state||this._currPos<r.RoleCenter.instans.vo.dfwData.rewardArr.length?this._rewardDataChanaged=!0:(this.locationTarget(),this.resetData()))},t.prototype.onThrowBackHandler=function(t){this.displayedInStage&&t.opresult&&(this._waittingPoints.push(t.reservedata[1]),this.start())},t.prototype.onGetBoxHandler=function(t){if(t.opresult){var e=t.reservedata[0],i=l.GameConfig.monopolyBoxJson[e];if(i){var n=i.reward[0][0];p.FlyManager.ins.flyIconToBag(h.ItemUtils.getIconById(Number(n)),d.UIUtils.localToGlobal(this,new Laya.Point(this["box"+e].x,this["box"+e].y)))}Laya.timer.callLater(this,this.updateBoxState)}},t.prototype.start=function(){this._autoThrow?this._state=2:this._state=1,this.exeState()},t.prototype.exeState=function(){if(1==this._state)this.doThrow();else if(2==this._state)this.doRun();else if(3==this._state)this.giveReward();else if(4==this._state){if(!this.displayedInStage)return void(this._state=0);0<this._waittingPoints.length?(this._state=2,this.exeState()):(this._state=0,this._autoThrow&&(this._needStopAuto?(this.onAutoThrowHandler(),this._needStopAuto=!1):this.doThrowOne()))}},t.prototype.doThrow=function(){var t=this;if(0<this._waittingPoints.length){this.img_dice.visible=!1,this.img_dice.skin="res/monopoly/"+this._waittingPoints[0]+".png";var e=v.UIEffectsFactory.Ins.createUIAniById(100,!1);e.x=222,e.y=25,this.box_grids.addChild(e),e.on(Laya.Event.COMPLETE,this,function(){e.stop(),e.visible=!1,e.removeSelf(),0!=t._state&&(t.img_dice.visible=!0,t._state++,t.exeState())}),e.play()}else this._state++,this.exeState()},t.prototype.doRun=function(){0<this._waittingPoints.length&&(this._step=this._waittingPoints.shift(),this.moveNextStep())},t.prototype.moveNextStep=function(){0<this._step?(this._currPos++,this._currPos>=r.RoleCenter.instans.vo.dfwData.rewardArr.length&&this._rewardDataChanaged&&this.resetData(),26<=this._currPos&&(this._currPos=0),this._dir=this.getDirByIndex(this._currPos),this.img_dir.rotation=this.getRotationByDir(this._dir),this.resetPlayerFace(),this._targetX=this.img_dir.x,this._targetY=this.img_dir.y,1==this._dir?this._targetX+=55:2==this._dir?this._targetY+=56:3==this._dir?this._targetX-=55:4==this._dir&&(this._targetY-=56),this._step--,this.doMove(),this._moveing||(this._player&&this._player.playMove(),Laya.timer.frameLoop(1,this,this.doMove),this._moveing=!0)):(this.stopMove(),this._state++,this.exeState())},t.prototype.giveReward=function(){var t,e=this._currRewardArr[this._currPos],i=l.GameConfig.monopolyJson[this._currPos];i&&i&&-1!=e&&(t=i.reward[e][0],i.reward[e][1]),this.flyIconToBag(this._currPos,t),this.fillGrid(this._currPos,null,0),r.RoleCenter.instans.vo.dfwData.rewardArr[this._currPos]=-1,this._state++,Laya.timer.once(1e3,this,this.exeState)},t.prototype.stopMove=function(){Laya.timer.clear(this,this.doMove),this._player&&this._player.stand(),this._moveing=!1},t.prototype.doMove=function(){var t=!1;1==this._dir?(this.img_dir.x+=this._moveSpeed,this.img_dir.x>=this._targetX&&(this.img_dir.x=this._targetX,t=!0)):2==this._dir?(this.img_dir.y+=this._moveSpeed,this.img_dir.y>=this._targetY&&(this.img_dir.y=this._targetY,t=!0)):3==this._dir?(this.img_dir.x-=this._moveSpeed,this.img_dir.x<=this._targetX&&(this.img_dir.x=this._targetX,t=!0)):4==this._dir&&(this.img_dir.y-=this._moveSpeed,this.img_dir.y<=this._targetY&&(this.img_dir.y=this._targetY,t=!0)),this._player&&this._player.body.pos(this.img_dir.x,this.img_dir.y),t&&this.moveNextStep()},t}(ui.monopoly.MonopolyViewUI);e.MonopolyView=w}),define("src/g/monopoly/ctrl/MonopolyViewCtrl",["require","exports","../../../core/E","../../../enum/EventName","../../../manager/GameSocketManager","../../net/messages/sbkDaFuWengData","../../../manager/RoleCenter","../../net/messages/OpResultType","../../../config/GameConfig","src/g/accessctrl/AccessCenter","../../../manager/NewRedHintsCenter","src/g/proxy/AccessListenProxy"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(){function t(){}return t.prototype.init=function(){s.GSM.ins.on(o.sbkDaFuWengData.KEY,this,this.onResetDataHandler),a.RoleCenter.instans.on(r.enumOpResultType.dfw_getOne.toString(),this,this.onThrowBackHandler),a.RoleCenter.instans.on(r.enumOpResultType.dfw_getBox.toString(),this,this.onGetBoxHandler),i.E.ins.on(n.EventName.DICENUM_CHANGED,this,this.refreshRed),(new u.AccessListenProxy).checkAndListen(10,new Laya.Handler(this,this.refreshRed))},t.prototype.refreshRed=function(){this.checkDiceNumRed(),this.checkBoxRed()},t.prototype.onThrowBackHandler=function(t){if(t.opresult){var e=t.reservedata[1];a.RoleCenter.instans.vo.dfwData.curIdx+=e;var i=a.RoleCenter.instans.vo.dfwData.rewardArr.length;a.RoleCenter.instans.vo.dfwData.curIdx>=i&&(a.RoleCenter.instans.vo.dfwData.curIdx-=i),a.RoleCenter.instans.vo.dfwData.curIdx,t.reservedata[2],a.RoleCenter.instans.vo.DICENUM=t.reservedata[4],t.reservedata[3]&&(a.RoleCenter.instans.vo.GOLD-=200)}},t.prototype.onGetBoxHandler=function(t){if(t.opresult){var e=t.reservedata[0];a.RoleCenter.instans.vo.dfwData.boxIdArr.push(e),this.checkBoxRed()}},t.prototype.onResetDataHandler=function(t){a.RoleCenter.instans.vo.dfwData.copydata(t),t.isEveryReset&&(a.RoleCenter.instans.vo.DICENUM=2)},t.prototype.checkDiceNumRed=function(){h.AccessCenter.ins.checkOpen(10)&&0<a.RoleCenter.instans.vo.DICENUM?c.NewRedHintsCenter.ins.setRedHintOpenOrClose(c.enumRedHints.monopoly_dice,!0):c.NewRedHintsCenter.ins.setRedHintOpenOrClose(c.enumRedHints.monopoly_dice,!1)},t.prototype.checkBoxRed=function(){for(var t=1;t<=4;){if(-1==a.RoleCenter.instans.vo.dfwData.boxIdArr.indexOf(t)){var e=l.GameConfig.monopolyBoxJson[t];if(e&&a.RoleCenter.instans.vo.dfwData.circleNum>=e.need)return void c.NewRedHintsCenter.ins.setRedHintOpenOrClose(c.enumRedHints.monopoly_box,!0)}t++}c.NewRedHintsCenter.ins.setRedHintOpenOrClose(c.enumRedHints.monopoly_box,!1)},t}();e.MonopolyViewCtrl=p}),define("src/g/copy/view/climbtower/PagodaTurntableDlg",["require","exports","src/g/clearRes/ClearResM","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/ItemCellUtils","../../../../manager/LayerManager","../../../net/messages/PagodaBonusMsg","../../../../manager/GameSocketManager","../../../../manager/AM","../../../../manager/FlyManager","../../../../utils/ItemUtils","../../../../utils/UIUtils","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","src/g/bag/tips/view/ItemTips","../../../../enum/EventName","../../../../core/E","../../../../meta/QualiyVo","src/init/TextConst"],function(t,e,i,h,c,o,n,s,a,u,p,d,g,v,r,l,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(e){function t(){var t=e.call(this)||this;return t._lastRequestTime=0,t.btn_start.on(Laya.Event.CLICK,t,t.onTurnClickHandler),t.img_bg.width=Laya.stage.width,t.img_bg.height=Laya.stage.height,t.img_bg.on(Laya.Event.CLICK,t,t.onCloseHandler),a.GSM.ins.on(s.PagodaBonusGS2C.KEY,t,t.onPagodaPortBonus),t}return __extends(t,e),t.prototype.onCloseHandler=function(){Laya.timer.clear(this,this.onCloseAndToFight),this.removeSelf()},t.prototype.showDlg=function(t){void 0===t&&(t=!1),this.arrow_icon.rotation=0;var e=this.item0;this.item_selected.x=e.x-13,this.item_selected.y=e.y-14,this.refreshData(),n.LayerManager.addInPOPWindowLayer(this,!1),i.ClearResM.resetViewImg(this),y.E.ins.on(f.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),t&&Laya.timer.once(5e3,this,this.onCloseAndToFight)},t.prototype.onCloseAndToFight=function(){this.onCloseHandler(),y.E.ins.event(f.EventName.PAGODA_TO_FIGHT)},t.prototype.closeClearRes=function(){y.E.ins.off(f.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),i.ClearResM.clearResFolder("turntable/")},t.prototype.refreshData=function(){var t=h.RoleCenter.instans.vo.portPagoda;this.lab_count.changeText((t.mainPortId-t.portBonusIdx).toString()),this.setRewardId(Math.ceil(t.portBonusIdx/10))},t.prototype.setRewardId=function(t){if(this._currRewardId!=t){var e=c.GameConfig.pagodaTurntableJson[t];if(e){this._currRewardId=t;for(var i,n=e.group.length,s=0;s<10;)(i=this["item"+s])&&(i.offAll(),s<n?(i.visible=!0,o.ItemCellUtils.fillCellForItemNameView(i,e.group[s][0],Number(e.group[s][1])),i.on(Laya.Event.CLICK,this,this.showTip,[e.group[s][0],Number(e.group[s][1])])):i.visible=!1),s++}}this.resetGetState()},t.prototype.resetGetState=function(){for(var t,e,i,n=h.RoleCenter.instans.vo.portPagoda,s=10*(this._currRewardId-1)+1,o=[];s<n.portBonusIdx;)(t=c.GameConfig.pagodaJson[s])&&(e=parseInt(t.zhuanpanReward[0][0]),i=t.zhuanpanReward[0][1],e==this._currRewardId&&o.push(i)),s++;var a=c.GameConfig.pagodaTurntableJson[this._currRewardId];if(a)for(var r=a.group.length,l=0;l<10;)this["lq"+l].visible=!1,l<r&&-1!=o.indexOf(l+1)&&(this["lq"+l].visible=!0),l++},t.prototype.showTip=function(t,e){l.ItemTips.ins.showTip(t,e)},t.prototype.onTurnClickHandler=function(){if(Laya.timer.clear(this,this.onCloseAndToFight),!this._running)if(Date.now()-this._lastRequestTime<800)v.FE.upItems(_.TextConst.get(336),r.BubbleEnum.center);else{var t=h.RoleCenter.instans.vo.portPagoda;if(t.mainPortId>t.portBonusIdx){var e=new s.PagodaBonusC2GS;e.portBonusIndex=h.RoleCenter.instans.vo.portPagoda.portBonusIdx,a.GSM.sendServer(e),this._lastRequestTime=Date.now()}else v.FE.upItems(_.TextConst.get(337),r.BubbleEnum.center)}},t.prototype.onPagodaPortBonus=function(a){var r=this;if(a.opresult){if(this.displayedInStage){this._currRewardId!=a.zpID&&(this.setRewardId(a.zpID),this.arrow_icon.rotation=0),this._running=!0;var l=a.zpBonusIndex-1,t=3600+36*l;this.arrow_icon.rotation%=360,Laya.Tween.to(this.arrow_icon,{rotation:t},3e3,Laya.Ease.circInOut,Laya.Handler.create(this,function(){if(r.displayedInStage){r.refreshData();var t=c.GameConfig.pagodaTurntableJson[a.zpID];if(t){var e=t.group[l][0],i=t.group[l][1],n=r["item"+l];r.item_selected.x=n.x-13,r.item_selected.y=n.y-14;var s=d.ItemUtils.getIconById(Number(e)),o=d.ItemUtils.getItemOrEq(e);v.FE.getFloat(o.name+"x"+i,m.QualityStruct.Ins.getQColorById(o.quality)),p.FlyManager.ins.flyIconToBag(s,g.UIUtils.localToGlobal(n,new Laya.Point(n.item.x,n.item.y)))}}r._running=!1}))}}else u.AM.show(a.error)},t}(ui.copy.turntable.TurnTableUI);e.PagodaTurntableDlg=C}),define("src/g/copy/ctrl/TurnTableCtrl",["require","exports","../../../core/E","../../../enum/EventName","src/g/copy/view/climbtower/PagodaTurntableDlg","../../../manager/GameSocketManager","../../net/messages/PagodaBonusMsg","../../../manager/RoleCenter"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){i.E.ins.on(n.EventName.OPENTURNTABLE,this,this.openHandler),o.GSM.ins.on(a.PagodaBonusGS2C.KEY,this,this.onPagodaPortBonus)}return t.prototype.openHandler=function(t){this.view||(this.view=new s.PagodaTurntableDlg),0<t?Laya.timer.once(t,this.view,this.view.showDlg,[!0]):this.view.showDlg()},t.prototype.onPagodaPortBonus=function(t){t.opresult?(r.RoleCenter.instans.vo.portPagoda=t.newCTGData,r.RoleCenter.instans.addInventoryToC(t.reward)):console.error("错误")},t}();e.TurnTableCtrl=l}),define("src/g/forge_new/view/GNForgeBg",["require","exports","../../../manager/LayerManager","../../../core/E","../../../enum/GuideTargetName","../../../enum/EventName","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.showView=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),n.E.ins.event(o.EventName.COMPTYPE_OPENVIEW,s.GuideTargetName.FORGE_VIEW),i.LayerManager.addInPOPWindowLayer(this,t,!0,!0,!1,e),n.E.ins.on(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),Laya.loader.load([{url:"res/atlas/res/forge_new.json",type:Laya.Loader.ATLAS}],new Laya.Handler(this,this.onloadeHandl))},e.prototype.onloadeHandl=function(){this.displayedInStage&&a.ClearResM.resetViewImg(this)},e.prototype.closeClearRes=function(){a.ClearResM.clearUrl("res/atlas/res/forge_new.json")},e.prototype.hideView=function(){this.removeSelf(),this.view_bg.box_page.removeChildren(),n.E.ins.event(o.EventName.COMPTYPE_CLOSEVIEW,s.GuideTargetName.FORGE_VIEW)},e.prototype.destroyView=function(){this.hideView()},e}(ui.forge_new.GNForgeBgUI);e.GNForgeBg=r}),define("src/g/forge_new/view/StongPage",["require","exports","../../../manager/RoleCenter","../../../utils/ItemUtils","../../../utils/RoleUtil","src/g/itemGets/View/ItemGetDlg","../../../utils/system/ErrCodeView","../../net/messages/ErrConst","../../net/messages/EquipProChgC2GS","../../net/messages/OpResultType","../../../manager/GameSocketManager","../../../meta/ShuXingVo","src/g/Effects/UIEffectsFactory","../../../core/E","../../../enum/EventName","src/g/custom/detailDlgs/SuperMonthCardTip","src/g/clearRes/ClearResM","../../../meta/CommonVo","src/g/forge_new/OnceMsgType","src/g/Effects/PressTutorialEffectProxy","../../../manager/NewRedHintsCenter","../../../vo/RedDot/RedDot_Forge","src/init/TextConst","../../../meta/QualiyVo","../../../component/LayoutUtil"],function(t,e,d,g,i,s,v,f,o,y,a,l,u,r,h,c,p,m,_,C,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t.p_nowPos=0,t.p_nowHeroPos=0,t.isAutoRunning=!1,t.ani_put=null,t.eqStrongMsg=new o.EquipProChgC2GS,t.p_lvMax=!1,t.p_canUp=!1,t.p_canUpAll=!1,t.addEvent(),p.ClearResM.addBgUrl(t.bgimg.skin),t.btn_upAll.visible=window.enabledpay;var e=t.btn_upAll.parent.getChildIndex(t.btn_upAll);t.btn_upAll.parent.getChildAt(e+1).visible=t.btn_upAll.visible;var i=t.effect_tutorial.x-t.btn_upLv.x;return E.LayoutUtil.layoutBox([t.btn_upAll,t.btn_upLv],2),t.effect_tutorial.x=t.btn_upLv.x+i,t}return __extends(t,n),t.prototype.addEvent=function(){this.btn_upLv.on(Laya.Event.CLICK,this,this.upLv),this.btn_upAll.on(Laya.Event.CLICK,this,this.onUpAll),this.btn_upLv.on(Laya.Event.MOUSE_DOWN,this,this.onUpLvMouDown),this.on(Laya.Event.MOUSE_UP,this,this.onUpLvMouUp),this.btn_upLv.on(Laya.Event.MOUSE_OUT,this,this.onUpLvMouMove),this.on(Laya.Event.REMOVED,this,this.stopAuto),this.item_cost.setJump(w.TextConst.get(238),new Laya.Handler(this,this.onShowGet)),this.on(Laya.Event.REMOVED,this,this.onRemoved),r.E.ins.on(h.EventName.CLOSEVIEW_GNFORGE,this,this.onRemoved),this.onLoadUIEF(),this.effect_tutorial.lab_wenzi.changeText(w.TextConst.get(490)),this._effectProxy=new C.PressTutorialEffectProxy(this.effect_tutorial)},t.prototype.onUpLvMouDown=function(){Laya.timer.once(m.CommonVo.getVoByKey("anzhuTimeInterval").val2num,this,this.beginAuto)},t.prototype.onUpLvMouUp=function(){this.stopAuto()},t.prototype.onUpLvMouMove=function(){this.isAutoRunning&&this.stopAuto()},t.prototype.beginAuto=function(){this.isAutoRunning||(Laya.timer.loop(m.CommonVo.getVoByKey("anzhuTime").val2num,this,this.upLv),this.isAutoRunning=!0,this._effectProxy.setState(1))},t.prototype.stopAuto=function(){Laya.timer.clear(this,this.beginAuto),Laya.timer.clear(this,this.upLv),this.isAutoRunning=!1,this._effectProxy.setState(0)},t.prototype.onUpAll=function(){this.onAutoClicked()},t.prototype.onRemoved=function(){this.stopAuto()},t.prototype.onAutoClicked=function(){if(!this.isAutoRunning){if(!d.RoleCenter.instans.vo.isSuperMonthCard)return void c.SuperMonthCardTip.create();var t=new o.EquipProChgC2GS;t.heroidx=this.p_nowHeroPos,t.msgidx=y.enumOpResultType.EquipProChg_AllStrong,a.GSM.sendServer(t),_.OnceMsgType.Msg_Strong=!0}},t.prototype.onLoadUIEF=function(){this.ani_put=u.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_upLv,42,1.3,1.1),this.ani_put.visible=!1},t.prototype.upLv=function(){var t=this.hero;if(this.p_canUp)if(this.p_lvMax)v.ErrCodeView.show(f.enumErrConst.code_2302),this.stopAuto();else{if(this.isQ)return;var e=this.p_nowPos,i=this.p_nowHeroPos,n=t.equpos,s=this.eqStrongMsg;s.heroidx=i,s.msgidx=y.enumOpResultType.EquipProChg_strong;for(var o=d.RoleCenter.instans.vo.bagdata.getItemCount(101),a=0,r=n.length,l=e;l<r;l++){var h=n[l].stronglv,c=g.ItemUtils.getEquipEnHanceVoById(g.ItemUtils.getHeroVoById(t.jobid).equip[l]+h),u=g.ItemUtils.getEquipEnHanceVoById(c.next);if(u){var p=c.cost[0][1];if(o<p)break;this.isQ=!0,p,o-=p,Laya.timer.once(130*a,this,this.sendMsg,[l+1,h,o<u.cost[0][1]||l+1==r],!1),a++}}}else this.onShowGet()},t.prototype.sendMsg=function(t,e,i){void 0===i&&(i=!1);var n=this.eqStrongMsg;n.equpos=t,n.curLv=e,a.GSM.sendServer(n),i&&(this.isQ=!1),_.OnceMsgType.Msg_Strong=!0},t.prototype.onShowGet=function(){this.stopAuto();var t=g.ItemUtils.getItemVoById(101);(new s.ItemGetDlg).initByVo(t,null).popup()},t.prototype.showView=function(t,e){t.removeChildren(),t.addChild(this),this.changePerson(e),this.bgimg.restskin()},t.prototype.changePerson=function(t,e){this.p_lvMax=!1,this.p_canUp=!1,this.p_nowHeroPos=t,this.isQ=!1,Laya.timer.clear(this,this.sendMsg),this.hero=d.RoleCenter.instans.vo.getOpenHeroByIdx(t),this.refreshData()},t.prototype.refreshData=function(){this.hero=d.RoleCenter.instans.vo.getOpenHeroByIdx(this.p_nowHeroPos),this.renderBase(),this.renderAttr(),this.renderNeed(),this.renderFightNum()},t.prototype.renderBase=function(){this.checkLv(),this.initBase()},t.prototype.renderAttr=function(){var t=this.hero.getPos(this.p_nowPos),e=g.ItemUtils.getHeroVoById(this.hero.jobid),i=g.ItemUtils.getEquipEnHanceVoById(e.equip[t.equpos-1]+t.stronglv),n=g.ItemUtils.getEquipEnHanceVoById(i.next);this._vbox.removeChildren();for(var s=0,o=0;o<i.prop.length;o++){var a=new ktgame.nforge.propItem,r=g.ItemUtils.getShuXingByName(i.prop[o][0]);a.setNow(r.desc+" +"+l.ShuXingVo.getString4Vo(i.prop[o][1],r)),n?(s+=a.height,a.setNext(" +"+l.ShuXingVo.getString4Vo(n.prop[o][1],r))):a.setNext(w.TextConst.get(208)),this._vbox.addChild(a),this._vbox.height=s}},t.prototype.renderNeed=function(){var t=this.hero.getPos(this.p_nowPos),e=g.ItemUtils.getHeroVoById(this.hero.jobid),i=g.ItemUtils.getEquipEnHanceVoById(e.equip[t.equpos-1]+t.stronglv),n=d.RoleCenter.instans.vo.bagdata.getItemCount(101),s=i.cost,o=g.ItemUtils.getItemVoById(101);if(this.item_cost.setNeedName(o.name,g.ItemUtils.getSmallIcon(o.icon)),this.item_cost.setQualColor(g.ItemUtils.getColorByQuality(o.quality)),i=g.ItemUtils.getEquipEnHanceVoById(i.next)){var a=s[0][1];this.setHtml(n,a)}else{s[0]||(s=g.ItemUtils.getEquipEnHanceVoById(e.equip[t.equpos-1]+t.stronglv-1).cost);a=0;this.setHtml(n,a)}},t.prototype.setHtml=function(t,e){if(0==e&&(this.p_lvMax=!0),t<e&&I.NewRedHintsCenter.ins.checkRedIsOpen(I.enumRedHints.strong)&&(console.log("红点信息不一致了"),b.RedDot_Forge.Ins.recheckStong()),this.p_canUp=e<=t,this.item_cost.setNeed(t,e),this.ani_put&&(this.ani_put.visible=this.p_canUp&&!this.p_lvMax),this.effect_tutorial){var i=d.RoleCenter.instans.vo.getCurLv();this.effect_tutorial.visible=this.p_canUp&&!this.p_lvMax&&38<i&&i<65,this.effect_tutorial.visible?this._effectProxy.run():this._effectProxy.stop()}},t.prototype.renderFightNum=function(){this.box_fightnum.num_Fight.value=i.RoleUtil.getHeroStrongFightNumById(this.p_nowHeroPos)+""},t.prototype.checkLv=function(){this.p_nowPos=0;var t=this.hero.equpos;this.p_canUpAll=!0;for(var e=0,i=0;i<t.length;i++)t[i].stronglv<t[this.p_nowPos].stronglv&&(this.p_nowPos=i),200==t[i].stronglv&&e++;8==e&&(this.p_canUpAll=!1),this.renderSelect(this.p_nowPos)},t.prototype.renderSelect=function(t){var e=this.hero.equpos[t].equins.equtemplet,i=g.ItemUtils.getEquipVoById(e),n=0<e?g.ItemUtils.getIconById(i.id):"res/custom/equipIcon/equip_"+ktgame.RoleDefineMod.arr_equipPosConst[t]+".png";this.img_equip.skin=n},t.prototype.initBase=function(){this.initEquip(this.hero.equpos,this.p_nowPos)},t.prototype.initEquip=function(t,e){for(var i=0;i<t.length;i++){var n=t[i],s=n.equpos-1,o=this.getChildByName("equip_"+ktgame.RoleDefineMod.arr_equipPosConst[s]);o.setClieckHD(null);var a=n.equins.equtemplet,r=0<a,l=g.ItemUtils.getEquipVoById(a);l||(r=!1);var h=r?g.ItemUtils.getIconById(l.id):"res/custom/equipIcon/equip_"+ktgame.RoleDefineMod.arr_equipPosConst[s]+".png";o.setSelect(e==i),o.setName(r?g.ItemUtils.getEquipLv(l.limit):"");var c=S.QualityStruct.Ins.transEquipQuality(l);0==c&&(c=1),o.setTrait(c,S.QualityStruct.Ins.getQPicById(c)),o.setEnhance(n.stronglv),o.setSoul(),o.showGod(!1),o.showIcon(h),o.showTip(!1),u.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(o.sp,33,1,1,"ani",!1,100).visible=!1}},t.prototype.showAniByPos=function(t){var e=this.getChildByName("equip_"+ktgame.RoleDefineMod.arr_equipPosConst[t]).sp.getChildByName("ani");e.visible=!0,e.on(Laya.Event.COMPLETE,this,function(){e.stop(),e.visible=!1}),e.play(0)},t.prototype.StopAllAni=function(){for(var t=0;t<8;t++){var e=this.getChildByName("equip_"+ktgame.RoleDefineMod.arr_equipPosConst[t]).sp.getChildByName("ani");e.stop(),e.visible=!1}},t}(ui.forge_new.page.StrongPageUI);e.StrongPage=n}),define("src/g/forge_new/ctrl/StrongPageCtrl",["require","exports","src/g/forge_new/view/StongPage","src/init/ResManager"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.prototype.init=function(){this._view=new i.StrongPage},t.prototype.showPage=function(t,e){var i=!1;this._view||(i=!0,this.init()),i?Laya.timer.frameOnce(3,this._view,this._view.showView,[t,e]):this._view.showView(t,e),n.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t,e){this._view.changePerson(t)},t.prototype.refreshData=function(){var t=this._view;t&&t.displayedInStage&&t.refreshData()},t.prototype.playAniByPos=function(t){this._view&&this._view.showAniByPos(t)},t.prototype.stopAllAni=function(){this._view&&this._view.StopAllAni()},t.prototype.getTitle=function(){return"res/title/title_qianghua.png"},t.prototype.hidePage=function(){n.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){n.ResManager.getInstance().destroyPageCtrl(this)},t}();e.StrongPageCtrl=s}),define("src/g/forge_new/view/NGemPage",["require","exports","../../../utils/system/ErrCodeView","../../net/messages/ErrConst","../../net/messages/EquipProChgC2GS","../../net/messages/OpResultType","../../../manager/RoleCenter","../../../manager/GameSocketManager","../../../utils/ItemUtils","src/g/itemGets/View/ItemGetDlg","../../../meta/StoneVo","../../../utils/RoleUtil","src/g/Effects/UIEffectsFactory","src/g/custom/detailDlgs/SuperMonthCardTip","src/g/clearRes/ClearResM","src/g/forge_new/OnceMsgType","../../../meta/CommonVo","src/g/Effects/PressTutorialEffectProxy","src/init/TextConst","../../../meta/QualiyVo","../../../component/LayoutUtil"],function(t,e,i,s,o,a,v,r,f,l,y,h,c,u,p,d,g,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t.p_nowEqPos=0,t.p_nowHeroPos=-1,t.isChangePerson=!1,t.ani_put=null,t.isAutoRunning=!1,t.p_lvMax=!1,t.p_canUp=!1,t.init(),p.ClearResM.addBgUrl(t.bgimg.skin),t.btn_autoUp.visible=window.enabledpay;var e=t.btn_autoUp.parent.getChildIndex(t.btn_autoUp);t.btn_autoUp.parent.getChildAt(e+1).visible=t.btn_autoUp.visible;var i=t.effect_tutorial.x-t.btn_upLv.x;return I.LayoutUtil.layoutBox([t.btn_autoUp,t.btn_upLv],2),t.effect_tutorial.x=t.btn_upLv.x+i,t}return __extends(t,n),t.prototype.init=function(){this.addEvent();var t=f.ItemUtils.getHeroVoById(1),e=f.ItemUtils.getItemVoById(t.stonecost);this.item_cose.setNeedName(e.name,f.ItemUtils.getSmallIcon(e.icon)),this.item_cose.setQualColor(f.ItemUtils.getColorByQuality(e.quality)),this.onLoadUIEF()},t.prototype.addEvent=function(){this.btn_upLv.on(Laya.Event.CLICK,this,this.upLv),this.btn_upLv.on(Laya.Event.MOUSE_DOWN,this,this.onUpLvMouDown),this.on(Laya.Event.MOUSE_UP,this,this.onUpLvMouUp),this.btn_upLv.on(Laya.Event.MOUSE_OUT,this,this.onUpLvMouMove),this.on(Laya.Event.REMOVED,this,this.stopAuto),this.btn_autoUp.on(Laya.Event.CLICK,this,this.onUpAll),this.item_cose.setJump(_.TextConst.get(481),new Laya.Handler(this,this.onShowGet)),this.on(Laya.Event.REMOVED,this,this.onRemoved),this.effect_tutorial.lab_wenzi.changeText(_.TextConst.get(482)),this._effectProxy=new m.PressTutorialEffectProxy(this.effect_tutorial)},t.prototype.onUpLvMouDown=function(){Laya.timer.once(g.CommonVo.getVoByKey("anzhuTimeInterval").val2num,this,this.beginAuto)},t.prototype.onUpLvMouUp=function(){this.stopAuto()},t.prototype.onUpLvMouMove=function(){this.isAutoRunning&&this.stopAuto()},t.prototype.beginAuto=function(){this.isAutoRunning||(Laya.timer.loop(g.CommonVo.getVoByKey("anzhuTime").val2num,this,this.upLv),this.isAutoRunning=!0,this._effectProxy.setState(1))},t.prototype.stopAuto=function(){Laya.timer.clear(this,this.beginAuto),Laya.timer.clear(this,this.upLv),this.isAutoRunning=!1,this._effectProxy.setState(0)},t.prototype.onUpAll=function(){this.onAutoClicked()},t.prototype.onRemoved=function(){this.isAutoRunning=!1,this.btn_autoUp.label=_.TextConst.get(483)},t.prototype.onLoadUIEF=function(){this.ani_put=c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_upLv,42,1.3,1.1),this.ani_put.visible=!1},t.prototype.upLv=function(){if(this.p_canUp)if(this.p_lvMax){var t=s.enumErrConst.code_2303;i.ErrCodeView.show(t),this.stopAuto()}else{var e=new o.EquipProChgC2GS;e.heroidx=this.p_nowHeroPos,e.equpos=this.p_nowEqPos+1,e.msgidx=a.enumOpResultType.EquipProChg_gem,e.curLv=v.RoleCenter.instans.vo.getOpenHeroByIdx(this.p_nowHeroPos).getPos(this.p_nowEqPos).gemlv,r.GSM.sendServer(e),d.OnceMsgType.Msg_Gem=!0}else this.onShowGet(),this.stopAuto()},t.prototype.onAutoClicked=function(){if(!this.isAutoRunning){if(!v.RoleCenter.instans.vo.isSuperMonthCard)return void u.SuperMonthCardTip.create();var t=new o.EquipProChgC2GS;t.heroidx=this.p_nowHeroPos,t.msgidx=a.enumOpResultType.EquipProChg_AllGem,r.GSM.sendServer(t),d.OnceMsgType.Msg_Gem=!0}},t.prototype.onShowGet=function(){this.stopAuto();var t=f.ItemUtils.getItemVoById(102);(new l.ItemGetDlg).initByVo(t,null).popup()},t.prototype.showView=function(t,e){t.removeChildren(),t.addChild(this),this.changePerson(e),this.bgimg.restskin()},t.prototype.playChangeAni=function(){for(var t=[254,142,254,365],e=[174,305,425,305],i=0;i<4;i++)this["item_"+i].x=254,this["item_"+i].y=303;for(i=0;i<4;i++)Laya.Tween.to(this["item_"+i],{x:t[i],y:e[i]},300,Laya.Ease.backOut,Laya.Handler.create(this,function(){}))},t.prototype.changePerson=function(t,e){this.isChangePerson=this.p_nowHeroPos!=t,this.p_nowHeroPos=t,this.hero=v.RoleCenter.instans.vo.getOpenHeroByIdx(t),this.initEquip(this.hero.equpos),this.refreshData(),this.isAutoRunning=!1,this.btn_autoUp.label=_.TextConst.get(484)},t.prototype.refreshData=function(){this.p_lvMax=!1,this.p_canUp=!1,this.findMin()},t.prototype.findMin=function(){for(var t=0,e=0,i=f.ItemUtils.getHeroVoById(this.hero.jobid),n=0;n<this.hero.equpos.length;n++){var s=this.hero.getPos(n),o=s.gemlv/i.stoneMaxNum>>0;if(0!=s.gemlv%i.stoneMaxNum){t=n;break}if(!(e<=o)){t=n;break}e=o}this.changeSelect(t),this.renderFightNum()},t.prototype.refreshStone=function(){for(var t=this.hero.getPos(this.p_nowEqPos),e=f.ItemUtils.getHeroVoById(this.hero.jobid),i=e.stoneMaxNum,n=[],s=0;s<4;s++)n.push(e.stone[4*this.p_nowEqPos+s]);var o=t.gemlv/i>>0,a=t.gemlv%i;for(s=0;s<i;s++){var r=this["item_"+s],l=a==s;r.setSelect(l);var h=null,c=o+(s<a?1:0);if(r.setOpen(0!=c),0==c)r.setName(_.TextConst.get(485)),r.setAttr("");else{h=y.StoneStruct.getStoneVo(n[s],c);var u=f.ItemUtils.getShuXingByName(h.prop[0][0]);r.setName(_.TextConst.get(486,c,u.desc)),r.setAttr(u.desc+" +"+h.prop[0][1])}if(l){if(h&&0!=c){u=f.ItemUtils.getShuXingByName(h.prop[0][0]);this._prop.attr0.text=u.desc+" +"+h.prop[0][1]}else this._prop.attr0.text=_.TextConst.get(485);var p=y.StoneStruct.getStoneVo(n[s],c+1);if(h&&!p)this._prop.attr1.text=_.TextConst.get(208);else{u=f.ItemUtils.getShuXingByName(p.prop[0][0]);this._prop.attr1.text=u.desc+" +"+p.prop[0][1]}var d=v.RoleCenter.instans.vo.bagdata.getItemCount(e.stonecost),g=0;g=p?p.cost:0,this.setHtml(d,g)}h||(h=y.StoneStruct.getStoneVo(n[s],1)),r.setIcon(f.ItemUtils.getStoneIconByIconId(h.icon))}},t.prototype.setHtml=function(t,e){if(0==e&&(this.p_lvMax=!0),this.p_canUp=e<=t,this.item_cose.setNeed(t,e),this.ani_put&&(this.ani_put.visible=this.p_canUp&&!this.p_lvMax),this.effect_tutorial){var i=v.RoleCenter.instans.vo.getCurLv();this.effect_tutorial.visible=this.p_canUp&&!this.p_lvMax&&38<i&&i<65,this.effect_tutorial.visible?this._effectProxy.run():this._effectProxy.stop()}},t.prototype.renderFightNum=function(){this.box_fightnum.num_Fight.value=h.RoleUtil.getHeroStoneFightNumById(this.p_nowHeroPos)+""},t.prototype.changeSelect=function(t){for(var e=0;e<8;e++){var i=this.getChildByName("equip_"+ktgame.RoleDefineMod.arr_equipPosConst[e]);i.setSelect(t==e),i.setEnhance(this.hero.equpos[e].gemlv)}var n=this.p_nowEqPos;this.p_nowEqPos=t,this.refreshStone(),this.renderFightNum(),(n!=this.p_nowEqPos||this.isChangePerson)&&(this.isChangePerson=!1,this.playChangeAni())},t.prototype.initEquip=function(t){for(var e=0;e<t.length;e++){var i=t[e],n=i.equpos-1,s=this.getChildByName("equip_"+ktgame.RoleDefineMod.arr_equipPosConst[n]);s.setClieckHD(null);var o=i.equins.equtemplet,a=f.ItemUtils.getEquipVoById(o),r=0<o?f.ItemUtils.getIconById(a.id):"res/custom/equipIcon/equip_"+ktgame.RoleDefineMod.arr_equipPosConst[n]+".png";s.setName(0<o?f.ItemUtils.getEquipLv(a.limit):"");var l=C.QualityStruct.Ins.transEquipQuality(a);0==l&&(l=1),s.setTrait(l,C.QualityStruct.Ins.getQPicById(l)),s.setSelect(!1),s.setEnhance(i.gemlv),s.setSoul(),s.showGod(!1),s.showIcon(r),s.showTip(!1)}},t}(ui.forge_new.page.GemPageUI);e.NGemPage=n}),define("src/g/forge_new/ctrl/GemPageCtrl",["require","exports","src/g/forge_new/view/NGemPage","src/init/ResManager"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.prototype.init=function(){this._view=new i.NGemPage},t.prototype.showPage=function(t,e){this._view||this.init(),this._view.showView(t,e),n.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t,e){this._view&&this._view.changePerson(t,e)},t.prototype.refreshData=function(){this._view&&this._view.refreshData()},t.prototype.getTitle=function(){return"res/title/title_baoshi.png"},t.prototype.hidePage=function(){n.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){n.ResManager.getInstance().destroyPageCtrl(this)},t}();e.GemPageCtrl=s}),define("src/g/forge_new/view/SoulPage",["require","exports","../../../manager/RoleCenter","../../../utils/ItemUtils","src/g/itemGets/View/ItemGetDlg","../../../enum/enumItem","../../../utils/RoleUtil","../../net/messages/ErrConst","../../../utils/system/ErrCodeView","../../net/messages/EquipProChgC2GS","../../net/messages/OpResultType","../../../manager/GameSocketManager","../../../meta/ShuXingVo","src/g/Effects/UIEffectsFactory","src/g/custom/detailDlgs/SuperMonthCardTip","src/g/clearRes/ClearResM","../../../meta/CommonVo","src/g/forge_new/OnceMsgType","src/g/Effects/PressTutorialEffectProxy","src/init/TextConst","../../../component/LayoutUtil"],function(t,e,g,v,i,s,o,f,y,a,m,r,l,h,c,u,p,_,d,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t.basePos_x=[186,302,381,301,184,69,-6,69],t.basePos_y=[306,252,152,51,5,52,151,251],t.p_nowPos=0,t.p_nowHeroPos=0,t.ani_put=null,t.isAutoRunning=!1,t.eqStrongMsg=new a.EquipProChgC2GS,t.p_lvMax=!1,t.p_canUp=!1,t.addEvent(),t.initBase(),u.ClearResM.addBgUrl(t.bgimg.skin),t.btn_autoUp.visible=window.enabledpay;var e=t.btn_autoUp.parent.getChildIndex(t.btn_autoUp);t.btn_autoUp.parent.getChildAt(e+1).visible=t.btn_autoUp.visible;var i=t.effect_tutorial.x-t.btn_upLv.x;return I.LayoutUtil.layoutBox([t.btn_autoUp,t.btn_upLv],2),t.effect_tutorial.x=t.btn_upLv.x+i,t}return __extends(t,n),t.prototype.addEvent=function(){this.btn_upLv.on(Laya.Event.CLICK,this,this.upLv),this.on(Laya.Event.MOUSE_UP,this,this.onUpLvMouUp),this.on(Laya.Event.REMOVED,this,this.stopAuto),this.btn_autoUp.on(Laya.Event.CLICK,this,this.onUpAll),this.item_cost.setJump(C.TextConst.get(487),new Laya.Handler(this,this.onShowGet)),this.on(Laya.Event.REMOVED,this,this.onRemoved),this.effect_tutorial.lab_wenzi.changeText(C.TextConst.get(488)),this._effectProxy=new d.PressTutorialEffectProxy(this.effect_tutorial)},t.prototype.onUpLvMouDown=function(){Laya.timer.once(p.CommonVo.getVoByKey("anzhuTimeInterval").val2num,this,this.beginAuto)},t.prototype.onUpLvMouUp=function(){this.stopAuto()},t.prototype.onUpLvMouMove=function(){this.isAutoRunning&&this.stopAuto()},t.prototype.beginAuto=function(){this.isAutoRunning||(Laya.timer.loop(p.CommonVo.getVoByKey("anzhuTime").val2num,this,this.upLv),this.isAutoRunning=!0,this._effectProxy.setState(1))},t.prototype.stopAuto=function(){Laya.timer.clear(this,this.beginAuto),Laya.timer.clear(this,this.upLv),this.isAutoRunning=!1,this._effectProxy.setState(0)},t.prototype.onUpAll=function(){this.onAutoClicked()},t.prototype.onRemoved=function(){this.isAutoRunning=!1,this.btn_autoUp.label=C.TextConst.get(489)},t.prototype.onLoadUIEF=function(){this.ani_put=h.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_upLv,42,1.3,1.1),this.ani_put.visible=!1},t.prototype.onAutoClicked=function(){if(!this.isAutoRunning){if(!g.RoleCenter.instans.vo.isSuperMonthCard)return void c.SuperMonthCardTip.create();var t=new a.EquipProChgC2GS;t.heroidx=this.p_nowHeroPos,t.msgidx=m.enumOpResultType.EquipProChg_AllSoul,r.GSM.sendServer(t),_.OnceMsgType.Msg_Soul=!0}},t.prototype.upLv=function(){if(!_.OnceMsgType.Msg_Soul){var t=this.hero;if(this.p_canUp)if(this.p_lvMax){var e=f.enumErrConst.code_2331;y.ErrCodeView.show(e),this.stopAuto()}else{if(this.isQ)return;var i=this.p_nowPos,n=this.p_nowHeroPos,s=t.equpos,o=this.eqStrongMsg;o.heroidx=n,o.msgidx=m.enumOpResultType.EquipProChg_soul;for(var a=g.RoleCenter.instans.vo.SOUL,r=0,l=s.length,h=i;h<l;h++){var c=s[h].soullv,u=v.ItemUtils.getEquipSoulVoById(v.ItemUtils.getHeroVoById(t.jobid).equip[h]+c),p=v.ItemUtils.getEquipSoulVoById(u.next);if(p){var d=u.cose[0][1];if(a<d)break;this.isQ=!0,d,a-=d,Laya.timer.once(130*r,this,this.sendMsg,[h+1,c,a<p.cose[0][1]||h+1==l],!1),r++}}}else this.onShowGet(),this.stopAuto()}},t.prototype.sendMsg=function(t,e,i){void 0===i&&(i=!1);var n=this.eqStrongMsg;n.equpos=t,n.curLv=e,r.GSM.sendServer(n),i&&(this.isQ=!1),_.OnceMsgType.Msg_Soul=!0},t.prototype.onShowGet=function(){this.stopAuto();var t=v.ItemUtils.getCurrencyByDefine("SOUL");(new i.ItemGetDlg).initByVo(null,t).popup()},t.prototype.showView=function(t,e){t.removeChildren(),t.addChild(this),this.changePerson(e),this.bgimg.restskin()},t.prototype.changePerson=function(t,e){this.p_nowHeroPos=t,this.hero=g.RoleCenter.instans.vo.getOpenHeroByIdx(t),this.p_lvMax=!1,this.p_canUp=!1,this.refreshData(),this.isAutoRunning=!1,this.btn_autoUp.label=C.TextConst.get(489),this.isQ=!1,Laya.timer.clear(this,this.sendMsg)},t.prototype.refreshData=function(){this.displayedInStage&&(this.renderBase(),this.renderAttr(),this.renderNeed(),this.renderFightNum())},t.prototype.renderBase=function(){this.checkLv()},t.prototype.renderAttr=function(){var t=this.hero.getPos(this.p_nowPos),e=v.ItemUtils.getHeroVoById(this.hero.jobid),i=v.ItemUtils.getEquipSoulVoById(e.equip[t.equpos-1]+t.soullv),n=v.ItemUtils.getEquipSoulVoById(i.next);this._vbox.removeChildren();for(var s=0;s<i.prop.length;s++){var o=new ktgame.nforge.propItem;o.img_bg.skin="res/custom/di18.png";var a=v.ItemUtils.getShuXingByName(i.prop[s][0]);o.setNow(a.desc+" +"+l.ShuXingVo.getString4Vo(i.prop[s][1],a)),n?o.setNext(" +"+l.ShuXingVo.getString4Vo(n.prop[s][1],a)):o.setNext(C.TextConst.get(208)),this._vbox.addChild(o)}},t.prototype.renderNeed=function(){var t=this.hero.getPos(this.p_nowPos),e=v.ItemUtils.getHeroVoById(this.hero.jobid),i=v.ItemUtils.getEquipSoulVoById(e.equip[t.equpos-1]+t.soullv),n=i.cose;if(i=v.ItemUtils.getEquipSoulVoById(i.next)){var s=g.RoleCenter.instans.self[n[0][0]],o=n[0][1];this.setHtml(s,o)}else{n[0]||(n=v.ItemUtils.getEquipSoulVoById(e.equip[t.equpos-1]+t.soullv-1).cose);s=g.RoleCenter.instans.self[n[0][0]],o=0;this.setHtml(s,o)}var a=v.ItemUtils.getCurrencyVoByDefine(n[0][0]);this.item_cost.setNeedName(a.name,v.ItemUtils.getSmallIcon(a.icon)),this.item_cost.setQualColor(v.ItemUtils.getColorByQuality(a.quality))},t.prototype.setHtml=function(t,e){if(0==e&&(this.p_lvMax=!0),this.p_canUp=e<=t,this.item_cost.setNeed(t,e),this.ani_put&&(this.ani_put.visible=this.p_canUp&&!this.p_lvMax),this.effect_tutorial){var i=g.RoleCenter.instans.vo.getCurLv();this.effect_tutorial.visible=this.p_canUp&&!this.p_lvMax&&38<i&&i<65,this.effect_tutorial.visible?this._effectProxy.run():this._effectProxy.stop()}},t.prototype.renderFightNum=function(){this.box_fight.num_Fight.value=o.RoleUtil.getHeroSoulFightNumById(this.p_nowHeroPos)+""},t.prototype.checkLv=function(){this.p_nowPos=0;for(var t=this.hero.equpos,e=0;e<t.length;e++)t[e].soullv<t[this.p_nowPos].soullv&&(this.p_nowPos=e);this.TweenShow(this.p_nowPos)},t.prototype.initBase=function(){for(var t=0;t<ktgame.RoleDefineMod.arr_equipPosConst.length;t++){var e=this["equip_"+ktgame.RoleDefineMod.arr_equipPosConst[t]];e.img_selected.visible=!1,e.img_icon.skin="res/custom/equipIcon/equip_"+ktgame.RoleDefineMod.arr_equipPosConst[t]+".png"}this.btn_autoUp.label=C.TextConst.get(489),this.onLoadUIEF()},t.prototype.showPosInsInfo=function(t,e){var i=this.hero.getPos(t);e.lab_lv.text="+"+i.soullv,e.lab_lv.color=s.enumItem.ForgeColor_Bule},t.prototype.TweenShow=function(t){void 0===t&&(t=0);for(var e=ktgame.RoleDefineMod.arr_equipPosConst.length,i=t,n=0;n<e;i++,n++){i%=e;var s=this["equip_"+ktgame.RoleDefineMod.arr_equipPosConst[i]];Laya.Tween.to(s,{x:this.basePos_x[n],y:this.basePos_y[n]},200),s.img_selected.visible=i==t,this.showPosInsInfo(n,this["equip_"+ktgame.RoleDefineMod.arr_equipPosConst[n]])}},t}(ui.forge_new.page.SoulPageUI);e.SoulPage=n}),define("src/g/forge_new/ctrl/SoulPageCtrl",["require","exports","src/g/forge_new/view/SoulPage","../../../vo/RedDot/RedDot_Forge","../../../core/E","../../../enum/EventName","src/g/Effects/UIEffectsFactory","src/init/ResManager"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){s.E.ins.on(o.EventName.CHANGECURRENCY,this,this.onChangeCurrency)}return t.prototype.init=function(){this._view=new i.SoulPage},t.prototype.onChangeCurrency=function(t){if("SOUL"==t)return n.RedDot_Forge.Ins.recheckSoul(),void this.refreshData()},t.prototype.playSoulAni=function(){this._view&&(a.UIEffectsFactory.Ins.playAniOnce(11,this._view.aniSp,.77,.77).autoClear=!1)},t.prototype.showPage=function(t,e){this._view||this.init(),this._view.showView(t,e),this._view.changePerson(e),r.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t,e){this._view.changePerson(t)},t.prototype.refreshData=function(){this._view&&this._view.refreshData()},t.prototype.getTitle=function(){return"res/title/title_zhuling.png"},t.prototype.hidePage=function(){r.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){r.ResManager.getInstance().destroyPageCtrl(this)},t}();e.SoulPageCtrl=l}),define("src/g/forge_new/ctrl/GNForgeCtrl",["require","exports","../../../enum/EventName","../../../core/E","src/g/base/BaseCtrl","src/g/forge_new/view/GNForgeBg","src/g/forge_new/ctrl/ZhanWenPageCtrl","../../../manager/RoleCenter","src/g/forge_new/ctrl/StrongPageCtrl","src/g/forge_new/ctrl/GemPageCtrl","src/g/forge_new/ctrl/SoulPageCtrl","../../net/messages/OpResultType","../../../utils/ItemUtils","../../../plugin/sbkPropTool","src/g/Effects/UIEffectsFactory","../../../vo/RedDot/RedDot_Forge","../../../vo/RedDot/EventRedDot","src/init/Switches","src/g/accessctrl/AccessCenter","../../../manager/GuideCenter","../../../enum/GuideTargetName","../../../utils/UIUtils","../../../meta/StoneVo"],function(t,e,u,l,i,n,s,p,o,a,r,h,d,g,c,v,f,y,m,_,C,I,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var w=function(i){function t(){var t=i.call(this)||this;t.closeOther=!1,t.forceOpen=!1,t._nowPageIdx=-1,t._nowSelectHero=0,t.urls=["res/atlas/res/forge_new.json","res/atlas/res/custom/equipIcon.json"];var e=y.Switches.ins;return e.on(28,t,t.onOpenPage,[28]),e.on(36,t,t.onOpenPage,[36]),e.on(37,t,t.onOpenPage,[37]),e.on(38,t,t.onOpenPage,[38]),e.on(39,t,t.onOpenPage,[39]),l.E.ins.on(u.EventName.OPENNEW_HERO,t,t.refreshHeroHeadShow),t.initCtrl(),t}return __extends(t,i),t.prototype.onOpenPage=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1),e&&(28==t?m.AccessCenter.ins.checkOpen(36)?this.showView(36,i,n):m.AccessCenter.ins.checkOpen(37)?this.showView(37,i,n):m.AccessCenter.ins.checkOpen(38)?this.showView(38,i,n):m.AccessCenter.ins.checkOpen(39)&&this.showView(39,i,n):this.showView(t,i,n))},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),36==t?this.onOpenNForge(0,e,i):37==t?this.onOpenNForge(3,e,i):38==t?this.onOpenNForge(1,e,i):39==t&&this.onOpenNForge(2,e,i)},t.prototype.initCtrl=function(){this._zhanwenPage=new s.ZhanWenPageCtrl,this._gemPage=new a.GemPageCtrl,this._soulPage=new r.SoulPageCtrl,this._strongPage=new o.StrongPageCtrl,p.RoleCenter.instans.on(h.enumOpResultType.EquipProChg_strong+"",this,this.onStrong),p.RoleCenter.instans.on(h.enumOpResultType.EquipProChg_gem+"",this,this.onGem),p.RoleCenter.instans.on(h.enumOpResultType.EquipProChg_soul+"",this,this.onSoul),p.RoleCenter.instans.on(h.enumOpResultType.EquipProChg_AllStrong+"",this,this.onStrongAll),p.RoleCenter.instans.on(h.enumOpResultType.EquipProChg_AllSoul+"",this,this.onSoulAll),p.RoleCenter.instans.on(h.enumOpResultType.EquipProChg_AllGem+"",this,this.onGemAll)},t.prototype.onSoulAll=function(t){for(var e=p.RoleCenter.instans.vo,i=e.getOpenHeroByIdx(t.reservedata[0]),n=0,s=1;n<8;n++,s++){i.getPos(n).soullv=t.reservedata[s]}var o=e.combat;g.sbkPropTool.reSetAllEquip(i),i.combat=i.reCheckComBat(),e.combat=e.reCheckComBat(),p.RoleCenter.instans.event(u.EventName.FIGHT_UP,e.combat-o),v.RedDot_Forge.Ins.recheckSoul(),this._soulPage&&(this._soulPage.playSoulAni(),this._soulPage.refreshData())},t.prototype.onGemAll=function(t){for(var e=p.RoleCenter.instans.vo,i=e.getOpenHeroByIdx(t.reservedata[0]),n=0,s=1;n<8;n++,s++){i.getPos(n).gemlv=t.reservedata[s]}var o=e.combat;g.sbkPropTool.reSetAllEquip(i),i.combat=i.reCheckComBat(),e.combat=e.reCheckComBat(),p.RoleCenter.instans.event(u.EventName.FIGHT_UP,e.combat-o),this.playAni("ani_strong",11,1.3,1.3),v.RedDot_Forge.Ins.recheckGem(),this._gemPage&&this._gemPage.refreshData()},t.prototype.onStrongAll=function(t){for(var e=0,i=p.RoleCenter.instans.vo,n=i.getOpenHeroByIdx(t.reservedata[0]),s=0,o=3;s<8;s++,o++){var a=n.getPos(s);e+=t.reservedata[o]-a.stronglv,a.stronglv=t.reservedata[o]}p.RoleCenter.instans.vo.chgItemCount(101,-t.reservedata[1]);var r=i.combat;g.sbkPropTool.reSetAllEquip(n),n.combat=n.reCheckComBat(),i.combat=i.reCheckComBat(),p.RoleCenter.instans.event(u.EventName.FIGHT_UP,i.combat-r),this.playAni("ani_strong",11,1.3,1.3),v.RedDot_Forge.Ins.recheckStong(),l.E.ins.event(u.EventName.STRONG_MSG_OVER,[e]),this._strongPage.refreshData()},t.prototype.onStrong=function(t){var e=t.reservedata,i=p.RoleCenter.instans.vo,n=i.getOpenHeroByIdx(e[0]),s=d.ItemUtils.getHeroVoById(n.jobid),o=n.getPos(e[1]-1),a=d.ItemUtils.getEquipEnHanceVoById(s.equip[e[1]-1]+o.stronglv);i.chgItemCount(parseInt(a.cost[0][0]),0-a.cost[0][1]),o.stronglv+=1;var r=i.combat;g.sbkPropTool.reSetAllEquip(n),i.combat=i.reCheckComBat(),p.RoleCenter.instans.event(u.EventName.FIGHT_UP,i.combat-r),l.E.ins.event(u.EventName.STRONG_MSG_OVER,[1]),this.playAni("ani_strong",11,1.3,1.3).autoClear=!1,v.RedDot_Forge.Ins.recheckStong(),this._strongPage.refreshData(),this._strongPage.playAniByPos(e[1]-1)},t.prototype.onGem=function(t){var e=t.reservedata,i=p.RoleCenter.instans.vo,n=i.getOpenHeroByIdx(e[0]),s=n.getPos(e[1]-1),o=d.ItemUtils.getHeroVoById(n.jobid),a=s.gemlv/o.stoneMaxNum>>0,r=o.stone[s.equpos-1],l=b.StoneStruct.getStoneVo(r,a+1);i.chgItemCount(o.stonecost,0-l.cost),s.gemlv+=1;var h=i.combat;g.sbkPropTool.reSetAllEquip(n);var c=i.reCheckComBat();p.RoleCenter.instans.event(u.EventName.FIGHT_UP,c-h),this.playAni("ani_strong",11,1.3,1.3),v.RedDot_Forge.Ins.recheckGem(),this._gemPage&&this._gemPage.refreshData()},t.prototype.onSoul=function(t){var e=t.reservedata,i=p.RoleCenter.instans.vo,n=p.RoleCenter.instans.vo.getOpenHeroByIdx(e[0]),s=d.ItemUtils.getHeroVoById(n.jobid),o=n.getPos(e[1]-1),a=d.ItemUtils.getEquipSoulVoById(s.soul[e[1]-1]+o.soullv);p.RoleCenter.instans.vo[a.cose[0][0]]-=a.cose[0][1],o.soullv+=1;var r=i.combat;g.sbkPropTool.reSetAllEquip(n),i.combat=i.reCheckComBat(),p.RoleCenter.instans.event(u.EventName.FIGHT_UP,i.combat-r),v.RedDot_Forge.Ins.recheckSoul(),this._soulPage&&(this._soulPage.playSoulAni(),this._soulPage.refreshData())},t.prototype.initView=function(){this._view=new n.GNForgeBg},t.prototype.addUIEvent=function(){this._view.view_bg.btn_back.on(Laya.Event.CLICK,this,this.onClose),this._view.view_bg.btn_close.on(Laya.Event.CLICK,this,this.onClose),this._view.tab_page.selectHandler=new Laya.Handler(this,this.onChangePage),this._view.tab_head.setCallbackHandler(new Laya.Handler(this,this.onChangePerson)),this._view.on(Laya.Event.REMOVED,this,this.onClose),l.E.ins.on(f.EventRedDot.REFRESH_FORGE,this,this.refreshRedDot),l.E.ins.on(u.EventName.CHANGEITEM_COUNT,this,this.onChangeItem),l.E.ins.on(u.EventName.CHANGECURRENCY,this,this.onChangeCurrency)},t.prototype.onChangeItem=function(t){return 101==t?(v.RedDot_Forge.Ins.recheckStong(),void(this._strongPage&&this._strongPage.refreshData())):102==t?(v.RedDot_Forge.Ins.recheckGem(),void(this._gemPage&&this._gemPage.refreshData())):t<=800&&880<=t?(l.E.ins.event(u.EventName.CHANGECURRENCY,"ZHANWEN"),void(this._zhanwenPage&&this._zhanwenPage.refreshData())):void 0},t.prototype.onChangeCurrency=function(t){if("SOUL"==t)return v.RedDot_Forge.Ins.recheckSoul(),void this.refreshRedDot()},t.prototype.refreshRedDot=function(){null!=this._view&&this._view.displayedInStage&&this.refreshHead4Red(this._nowPageIdx)},t.prototype.onOpenNForge=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this.selectIndex=t,this.closeOther=e,this.forceOpen=i,this.opens()},t.prototype.onAtlasLoaded=function(){this.realOpenNForge(this.selectIndex,this.closeOther,this.forceOpen)},t.prototype.refreshHeroHeadShow=function(t){void 0===t&&(t=0),this._view&&this._view.tab_head.initData(p.RoleCenter.instans.self.openhero,this._nowSelectHero,p.RoleCenter.instans.vo),this.refreshRedDot()},t.prototype.realOpenNForge=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._view||this.initView(),this.addUIEvent(),this._view.showView(e,i),this._view.tab_head.initData(p.RoleCenter.instans.self.openhero,0,p.RoleCenter.instans.vo),this._view.tab_page.selectedIndex==t?this.onChangePage(t):this._view.tab_page.selectedIndex=t,this._isRegist||Laya.timer.frameOnce(2,this,this.registUIToGuide)},t.prototype.registUIToGuide=function(){_.GuideCenter.ins.registerGuideObject(C.GuideTargetName.forge_tab_item0,this._view),_.GuideCenter.ins.registerGuideObject(C.GuideTargetName.forge_tab_item1,this._view),_.GuideCenter.ins.registerGuideObject(C.GuideTargetName.forge_tab_item2,this._view),_.GuideCenter.ins.registerGuideObject(C.GuideTargetName.forge_tab_item3,this._view),_.GuideCenter.ins.registerGuideObject(C.GuideTargetName.FORGE_BTN_BACK,this._view);var t=I.UIUtils.getGlobalBound(this._view.tab_page.getChildByName("item0"));t&&_.GuideCenter.ins.registerInteractionArea(C.GuideTargetName.forge_tab_item0,t),(t=I.UIUtils.getGlobalBound(this._view.tab_page.getChildByName("item1")))&&_.GuideCenter.ins.registerInteractionArea(C.GuideTargetName.forge_tab_item1,t),(t=I.UIUtils.getGlobalBound(this._view.tab_page.getChildByName("item2")))&&_.GuideCenter.ins.registerInteractionArea(C.GuideTargetName.forge_tab_item2,t),(t=I.UIUtils.getGlobalBound(this._view.tab_page.getChildByName("item3")))&&_.GuideCenter.ins.registerInteractionArea(C.GuideTargetName.forge_tab_item3,t),(t=I.UIUtils.getGlobalBound(this._view.view_bg.btn_back))&&_.GuideCenter.ins.registerInteractionArea(C.GuideTargetName.FORGE_BTN_BACK,t),this._isRegist=!0},t.prototype.onChangePage=function(t){if(void 0===t&&(t=0),this._nowPageIdx!=t){switch(t){case 0:this._page=this._strongPage;break;case 1:this._page=this._gemPage;break;case 2:this._page=this._soulPage;break;case 3:this._page=this._zhanwenPage}this._nowPageIdx=t,this._page.showPage(this._view.view_bg.box_page,this._nowSelectHero),this.onChangePerson(this._nowSelectHero),this.refreshRedDot(),this._view.view_bg.img_title.skin=this._page.getTitle(),0==t?l.E.ins.event(u.EventName.COMPTYPE_CLICK,C.GuideTargetName.forge_tab_item0):1==t?l.E.ins.event(u.EventName.COMPTYPE_CLICK,C.GuideTargetName.forge_tab_item1):2==t?l.E.ins.event(u.EventName.COMPTYPE_CLICK,C.GuideTargetName.forge_tab_item2):3==t&&l.E.ins.event(u.EventName.COMPTYPE_CLICK,C.GuideTargetName.forge_tab_item3)}},t.prototype.refreshHead4Red=function(t){switch(t){case 0:this._view.tab_head.refreshHeadRedHint(v.RedDot_Forge.Ins.getRed_Stong(!0));break;case 3:this._view.tab_head.refreshHeadRedHint(v.RedDot_Forge.Ins.getRed_ZhanWen(!0));break;case 1:this._view.tab_head.refreshHeadRedHint(v.RedDot_Forge.Ins.getRed_Gem(!0));break;case 2:this._view.tab_head.refreshHeadRedHint(v.RedDot_Forge.Ins.getRed_Soul(!0))}},t.prototype.onChangePerson=function(t){void 0===t&&(t=0),t+1<=p.RoleCenter.instans.vo.heronum?(this._view.tab_head.setSelectIndex(t),this._nowSelectHero=t,this._page.changePerson(t)):y.Switches.ins.event(15)},t.prototype.playAni=function(t,e,i,n){return void 0===i&&(i=1),void 0===n&&(n=1),c.UIEffectsFactory.Ins.playAniOnce(e,this._view.ani_pos,i,n)},t.prototype.stopAni=function(t){var e=this._view.ani_pos.getChildByName(t);e&&(e.stop(),e.visible=!1,e.index=0)},t.prototype.onClose=function(){this.stopAni("ani_soul"),this.stopAni("ani_strong"),this._strongPage&&this._strongPage.stopAllAni(),this._view.view_bg.box_page.removeChildren(),this._nowPageIdx=-1,this._view.view_bg.btn_back.off(Laya.Event.CLICK,this,this.onClose),this._view.view_bg.btn_close.off(Laya.Event.CLICK,this,this.onClose),this._view.tab_page.selectHandler=null,this._view.destroyView(),l.E.ins.event(u.EventName.CLOSEVIEW_GNFORGE)},t}(i.BaseCtrl);e.GNForgeCtrl=w}),define("src/g/timelimittask/view/TimeLimitTaskView",["require","exports","../../net/messages/TimeLimitTaskMsg","../../../manager/GameSocketManager","../../../manager/LayerManager","../../../manager/RoleCenter","../../../utils/system/ServerTime","../../../utils/system/DateUitl","../../net/messages/enumStatus","../../../config/GameConfig","../../../meta/MainButtonVo","../../../core/E","../../../enum/EventName","src/g/Effects/UIEffectsFactory","src/g/clearRes/ClearResM","src/init/TextConst"],function(t,e,n,s,o,a,i,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(e){function t(){var t=e.call(this)||this;return g.ClearResM.addBgUrl(t.bgimg.skin),t.bg.btn_back.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.on(Laya.Event.REMOVED,t,t.onRemovedHandler),t.list_task.renderHandler=new Laya.Handler(t,t.onRenderListHandler),t.list_task.scrollBar.elasticDistance=100,u.E.ins.on(p.EventName.TIME_LIMIT_TASK_DATA_CHANGED,t,t.onDataChangedHandler),u.E.ins.on(p.EventName.TIME_LIMIT_TASK_OPEN,t,t.onNewTaskOpen),t}return __extends(t,e),t.prototype.onNewTaskOpen=function(t){this._taskId!=t&&this.onCloseHandler()},t.prototype.onDataChangedHandler=function(t){!this.displayedInStage||t!=this._taskId&&t||this.refreshData()},t.prototype.showTask=function(t){var i=this;this._taskId=t,this._tltd=a.RoleCenter.instans.vo.getTLTDataById(this._taskId),this.cooldownHandler(),Laya.timer.loop(1e3,this,this.cooldownHandler);var e=h.GameConfig.timeLimitTaskJson[this._taskId];if(e){this.img_ad.skin="res/timelimittask/"+e.descImage+".png";var n="dynamic2/hunyin/"+e.image+".json";Laya.loader.load(n,Laya.Handler.create(this,function(){i.anim_hy.source=n;var t=Laya.loader.getRes(n).frames;for(var e in t)if(t[e]&&t[e].sourceSize){i.anim_hy.width=t[e].sourceSize.w,i.anim_hy.height=t[e].sourceSize.h;break}d.UIEffectsFactory.Ins.centered4Parent(i.anim_hy,i.box_),i.anim_hy.interval=200,i.anim_hy.play(0)}))}this.refreshData(),o.LayerManager.addInPOPWindowLayer(this),this.bgimg.restskin(),g.ClearResM.resetViewImg(this),u.E.ins.on(p.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){u.E.ins.off(p.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),g.ClearResM.clearFolderByUrl("dynamic/taskicon/")},t.prototype.refreshData=function(){for(var t=h.GameConfig.timeLimitTaskJson[this._taskId],e=t.child.length,i=0,n=[];i<e;)n.push(t.child[i]),i++;n.sort(this.compareFn.bind(this)),this.list_task.array=n,this.checkCompletCount()},t.prototype.checkCompletCount=function(){for(var t,e,i=h.GameConfig.timeLimitTaskJson[this._taskId],n=i.child.length,s=0,o=0;s<n;)e=h.GameConfig.timeLimitSubTaskJson[i.child[s]],t=this._tltd.statusArr[s],e.need<=t&&o++,s++;this.lab_progress.changeText(o+"/"+n)},t.prototype.compareFn=function(t,e){var i=h.GameConfig.timeLimitTaskJson[this._taskId],n=a.RoleCenter.instans.vo.getTLTDataById(this._taskId),s=i.child.indexOf(t);n.curStatusArr[s]==l.enumStatus.weiwancheng&&(s+=100),n.curStatusArr[s]==l.enumStatus.yilingqu&&(s+=200);var o=i.child.indexOf(e);return n.curStatusArr[o]==l.enumStatus.weiwancheng&&(o+=100),n.curStatusArr[o]==l.enumStatus.yilingqu&&(o+=200),s-o},t.prototype.onRenderListHandler=function(t,e){var i=t.dataSource,n=h.GameConfig.timeLimitTaskJson[this._taskId],s=h.GameConfig.timeLimitSubTaskJson[i],o=n.child.indexOf(i),a=this._tltd.statusArr[o],r=s.need;s.isNoCountType()&&(a=a<r?0:1,r=1),r<a&&(a=r),t.img_icon.skin="dynamic/taskicon/"+s.icon+".png",t.htxt_desc.style.color="#c0b4a3",t.htxt_desc.style.font="SimHei",t.htxt_desc.style.fontSize=20,t.htxt_desc.innerHTML=a<r?s.res+"(<font color='#F12828'>"+a+"</font>/"+r+")":s.res+"(<font color='#2ca013'>"+a+"</font>/"+r+")",t.btn_goto.offAll(),t.btn_goto.visible=!1,t.lab_complet.visible=!1,0==t.effect.numChildren&&d.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.effect,42,.8,.8),t.effect.visible=!1,r<=a?this._tltd.curStatusArr[o]==l.enumStatus.yilingqu?t.lab_complet.visible=!0:(t.btn_goto.label=v.TextConst.get(204),t.btn_goto.visible=!0,t.effect.visible=!0,t.btn_goto.on(Laya.Event.CLICK,this,this.toGetReward,[i])):s.moduleID&&0<s.moduleID.length&&(t.btn_goto.label=v.TextConst.get(228),t.btn_goto.on(Laya.Event.CLICK,this,this.gotoOp,[s]),t.btn_goto.visible=!0)},t.prototype.gotoOp=function(t){t.moduleID&&0<t.moduleID.length&&(c.MainButtonStruct.Ins.OpenModule(t.moduleID[0][1],t.moduleID[1][1]),this.removeSelf())},t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.toGetReward=function(t){if(this._tltd){var e=h.GameConfig.timeLimitTaskJson[this._taskId].child.indexOf(t);if(this._tltd.curStatusArr[e]==l.enumStatus.kelingqu){var i=new n.TimeLimitTaskGetMsg;i.taskId=this._taskId,i.taskChildId=t,s.GSM.sendServer(i)}}},t.prototype.onRemovedHandler=function(){Laya.timer.clear(this,this.cooldownHandler)},t.prototype.cooldownHandler=function(){if(this._tltd){var t=this._tltd.endTime-i.ServerTime.serverTime;this.lab_time.changeText(r.DateUtil.getHMS_countdown(t))}},t}(ui.timelimittask.TimeLimitTaskViewUI);e.TimeLimitTaskView=f}),define("src/g/timelimittask/ctrl/TimeLimitTaskCtrl",["require","exports","../../net/messages/sbkTimeLimitTaskData","../../../manager/GameSocketManager","../../../manager/RoleCenter","../../net/messages/TimeLimitTaskMsg","../../../config/GameConfig","../../../core/E","../../../enum/EventName","../../net/messages/enumStatus","../../../utils/system/ServerTime"],function(t,e,i,n,l,s,h,c,u,r,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){}return t.prototype.init=function(){n.GSM.ins.on(i.sbkTimeLimitTaskData.KEY,this,this.onDataInitHandler),n.GSM.ins.on(s.TimeLimitTaskUpdataGS2C.KEY,this,this.updateTaskHandler),n.GSM.ins.on(s.TimeLimitTaskGetMsg.KEY,this,this.getTaskRewardHandler),n.GSM.ins.on(s.TimeLimitTaskDelMsg.KEY,this,this.delTaskHandler),n.GSM.ins.on(i.TLTData.KEY,this,this.updateOneTaskHandler)},t.prototype.onDataInitHandler=function(t){for(var e,i=(l.RoleCenter.instans.vo.timeLimitTaskData=t).dataArr.length,n=0;n<i;)e=t.dataArr[n],this.setTaskTimer(e),this.updateGetState(e.id),n++;c.E.ins.event(u.EventName.TIME_LIMIT_TASK_INITED),this._inited=!0},t.prototype.setTaskTimer=function(t){if(o.ServerTime.isInited){Laya.timer.clearAll(t);var e;0<(e=t.endTime-o.ServerTime.serverTime)&&e<28800&&Laya.timer.once(1e3*e,t,function(t){var e=new s.TimeLimitTaskDelMsg;e.taskIdArr=[t],n.GSM.sendServer(e)},[t.id])}else c.E.ins.once(u.EventName.SERVER_TIME_UPDATE,this,this.reInitTimerHandler)},t.prototype.reInitTimerHandler=function(){if(this._inited)for(var t,e=l.RoleCenter.instans.vo.timeLimitTaskData,i=e.dataArr.length,n=0;n<i;)t=e.dataArr[n],this.setTaskTimer(t),n++},t.prototype.updateTaskHandler=function(t){for(var e,i,n,s,o=t.updataArr.length,a=0,r=l.RoleCenter.instans.vo.timeLimitTaskData;a<o;)(e=t.updataArr[a])&&-1!=(n=r.idArr.indexOf(e.taskId))&&(i=r.dataArr[n])&&(s=h.GameConfig.timeLimitTaskJson[e.taskId])&&-1!=(n=s.child.indexOf(e.childId))&&(i.statusArr[n]=e.value,this.updateGetState(e.taskId),c.E.ins.event(u.EventName.TIME_LIMIT_TASK_DATA_CHANGED,e.taskId)),a++},t.prototype.updateGetState=function(t){var e=l.RoleCenter.instans.vo.getTLTDataById(t);if(e)for(var i,n,s=h.GameConfig.timeLimitTaskJson[t],o=s.child.length,a=0;a<o;)(n=h.GameConfig.timeLimitSubTaskJson[s.child[a]])&&(i=e.statusArr[a],n.need<=i?(e.curStatusArr[a]!=r.enumStatus.yilingqu&&(e.curStatusArr[a]=r.enumStatus.kelingqu),0):e.curStatusArr[a]=r.enumStatus.weiwancheng),a++},t.prototype.updateOneTaskHandler=function(t){if(!(t.id<1e4||12e3<t.id)&&t){var e,i,n=l.RoleCenter.instans.vo.timeLimitTaskData;-1!=(i=n.idArr.indexOf(t.id))?(e=n.dataArr[i])&&(0==e.endTime&&0!=t.endTime&&c.E.ins.event(u.EventName.TIME_LIMIT_TASK_OPEN,t.id),e.copydata(t),this.updateGetState(t.id),this.setTaskTimer(e),c.E.ins.event(u.EventName.TIME_LIMIT_TASK_DATA_CHANGED,t.id)):(n.idArr.push(t.id),n.dataArr.push(t),0!=t.endTime&&c.E.ins.event(u.EventName.TIME_LIMIT_TASK_OPEN,t.id),this.updateGetState(t.id),this.setTaskTimer(t),c.E.ins.event(u.EventName.TIME_LIMIT_TASK_DATA_CHANGED,t.id))}},t.prototype.getTaskRewardHandler=function(t){var e,i,n=l.RoleCenter.instans.vo.timeLimitTaskData;if(-1!=(i=n.idArr.indexOf(t.taskId))&&(e=n.dataArr[i])){var s=h.GameConfig.timeLimitTaskJson[t.taskId].child.indexOf(t.taskChildId);e.curStatusArr[s]=r.enumStatus.yilingqu,c.E.ins.event(u.EventName.TIME_LIMIT_TASK_DATA_CHANGED,t.taskId),c.E.ins.event(u.EventName.TIME_LIMIT_TASK_COMPLET,t.taskId)}},t.prototype.delTaskHandler=function(t){for(var e,i,n=l.RoleCenter.instans.vo.timeLimitTaskData,s=t.taskIdArr.length,o=0;o<s;)e=t.taskIdArr[o],-1!=(i=n.idArr.indexOf(e))&&(Laya.timer.clearAll(n.dataArr[i]),n.idArr.splice(i,1),n.dataArr.splice(i,1),c.E.ins.event(u.EventName.TIME_LIMIT_TASK_DELETE,e),this.onDelTaskHandler(e)),o++},t.prototype.onDelTaskHandler=function(t){var e=h.GameConfig.timeLimitTaskJson[t];if(e&&3==e.type){var i=e.reward[0][1];l.RoleCenter.instans.vo.hetiData.skillArr.push(i),c.E.ins.event(u.EventName.HETI_SKILL_ACTIVE,i)}},t}();e.TimeLimitTaskCtrl=a}),define("src/g/phrase/ctrl/PhraseCtrl",["require","exports","../../../core/E","../../../enum/EventName","../../../manager/LayerManager"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){this._fadeIn=500,this._stay=1500,this._fadeOut=500,this._state=0,this._incre=0}return t.prototype.init=function(){i.E.ins.on(n.EventName.POP_PHRASE,this,this.onPopPhraseHandler)},t.prototype.onPopPhraseHandler=function(t){this._img||(this._img=new Laya.Label,this._img.color="#ffe9e2",this._img.fontSize=30,this._img.font="SimHei",this._img.stroke=1,this._img.strokeColor="#ff5400"),Laya.timer.clearAll(this),this._img.removeSelf(),this._img.visible=!1,this._img.text=t,this.onImgLoadedHandler()},t.prototype.onImgLoadedHandler=function(){this._img.alpha=0,this._img.x=(Laya.stage.width-this._img.width)/2,this._img.y=Laya.stage.height-this._img.height-650,this._img.visible=!0,s.LayerManager.addAlertLayer(this._img),this._state=0,this.switchState(),Laya.timer.frameLoop(1,this,this.onFrame)},t.prototype.onFrame=function(){0==this._state?1<=this._img.alpha&&(this._state=1,this.switchState()):2==this._state&&this._img.alpha<=0&&(this._state=0,Laya.timer.clearAll(this)),1!=this._state&&this._img&&(this._img.alpha+=this._incre)},t.prototype.switchState=function(){var t=this;0==this._state?this._incre=1/(this._fadeIn/33):1==this._state?Laya.timer.once(this._stay,this,function(){t._state=2,t.switchState()}):2==this._state&&(this._incre=-1/(this._fadeOut/33))},t}();e.PhraseCtrl=o}),define("src/g/peronboss/ctrl/PersonBossCtrl",["require","exports","../../../manager/RoleCenter","../../../core/E","../../../enum/EventName","../../../config/GameConfig","../../../manager/NewRedHintsCenter","../../net/messages/ChangeSceneMsg","src/g/copy/view/PersonBossUtil","src/g/accessctrl/AccessCenter"],function(t,e,o,i,n,a,r,l,s,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(){o.RoleCenter.instans.vo?this.init():i.E.ins.once(n.EventName.INIT_SELFSETOVER,this,this.init)}return t.prototype.init=function(){this.checkRed(),i.E.ins.on(n.EventName.UPDATEPERSONBOSS,this,this.checkRed),i.E.ins.on(n.EventName.PLAY_TYPE_CHANGED,this,this.checkRed),i.E.ins.on(n.EventName.UPDATEPERSONBOSSRed,this,this.checkRed)},t.prototype.checkRed=function(){var t=a.GameConfig.bossjson,e=o.RoleCenter.instans.self.bossData.bossprivatePort;if(h.AccessCenter.ins.checkOpen(77)){if(o.RoleCenter.instans.self.bossData.bossopen)for(var i=0;i<e.length;i++)for(var n in t){if((s=t[n]).type==l.EPlayType.PLAYTYPE_PRIBOSS&&s.port==e[i]){if(this.checkCanFight(s))return void r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.person_boss,!0);break}}for(var n in t){var s;if(6==(s=t[n]).type&&-1==e.indexOf(s.port)&&this.checkCanFight(s))return void r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.person_boss,!0)}r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.person_boss,!1)}else r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.person_boss,!1)},t.prototype.checkCanFight=function(t){o.RoleCenter.instans.vo;if(o.RoleCenter.instans.vo.getCurLv()>=t.lv){var e=s.PersonBossUtil.getIndex(t),i=o.RoleCenter.instans.self.bossData.bossprivateNum[e];if(i||0!=i&&(i=t.count),0<i)return!0}return!1},t}();e.PersonBossCtrl=c}),define("src/g/copy/ctrl/MaterialCopyCtrl",["require","exports","../../../manager/RoleCenter","../../../core/E","../../../enum/EventName","../../../config/GameConfig","../../../manager/NewRedHintsCenter"],function(t,e,n,i,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){n.RoleCenter.instans.vo?this.init():i.E.ins.once(s.EventName.INIT_SELFSETOVER,this,this.init)}return t.prototype.init=function(){Laya.timer.once(2e3,this,this.checkRed),i.E.ins.on(s.EventName.PLAY_TYPE_CHANGED,this,this.checkRed),i.E.ins.on(s.EventName.SWAPFINISH,this,this.onSwapHandler)},t.prototype.onSwapHandler=function(){this.checkRed()},t.prototype.checkRed=function(){var t;for(var e in o.GameConfig.copymaterialJSON)if(t=o.GameConfig.copymaterialJSON[e],this.checkFight(t))return void a.NewRedHintsCenter.ins.setRedHintOpenOrClose(a.enumRedHints.material_copy,!0);a.NewRedHintsCenter.ins.setRedHintOpenOrClose(a.enumRedHints.material_copy,!1)},t.prototype.checkFight=function(t){if(t.lvl>n.RoleCenter.instans.vo.getCurLv())return!1;var e,i=n.RoleCenter.instans.self;switch(t.id){case 11:e=i.COPYGEN_COUNT;break;case 12:e=i.COPYMERIDIAN_COUNT;break;case 13:e=i.COPYACHIEVE_COUNT;break;case 14:e=i.COPYDARGON_COUNT;break;case 15:e=i.COPYSHIELD_COUNT}return 0<e},t}();e.MaterialCopyCtrl=r}),define("src/g/field/ctrl/RevengeCtrl",["require","exports","../../../manager/RoleCenter","../../../core/E","../../../enum/EventName","../../../manager/NewRedHintsCenter"],function(t,e,n,i,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){n.RoleCenter.instans.vo?this.init():i.E.ins.once(s.EventName.INIT_SELFSETOVER,this,this.init)}return t.prototype.init=function(){this.checkRed(),i.E.ins.on(s.EventName.updaterevengelist,this,this.checkRed)},t.prototype.checkRed=function(){if(n.RoleCenter.instans.vo.meetPkData&&0<n.RoleCenter.instans.vo.meetPkData.revengelist.length){if(n.RoleCenter.instans.vo.meetPkData.revengecount<=0)return void o.NewRedHintsCenter.ins.setRedHintOpenOrClose(o.enumRedHints.revenge,!1);for(var t=n.RoleCenter.instans.vo.meetPkData.revengelist,e=t.length,i=0;i<e;){if(t[i].helpNickName||0==t[i].helpEndTime)return void o.NewRedHintsCenter.ins.setRedHintOpenOrClose(o.enumRedHints.revenge,!0);i++}}o.NewRedHintsCenter.ins.setRedHintOpenOrClose(o.enumRedHints.revenge,!1)},t}();e.RevengeCtrl=a}),define("src/g/activity/view/DailyRechargeQuick",["require","exports","../../../manager/LayerManager","../../../enum/EventName","../../../core/E","../../../manager/RoleCenter","../../net/messages/enumStatus","../../../config/GameConfig","src/init/Switches","../../net/messages/activity/ActivityGet","../../../manager/GameSocketManager","../../../utils/ItemCellUtils","src/g/Effects/UIEffectsFactory","src/g/bag/tips/view/ItemTips","src/g/clearRes/ClearResM"],function(t,e,a,r,l,c,u,p,i,s,o,n,h,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(e){function t(){var t=e.call(this)||this;return t._startShowIndex=-1,t._selectIndex=-1,t.img_bg.width=Laya.stage.width,t.img_bg.height=Laya.stage.height,t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),l.E.ins.on(r.EventName.ACTIVITY_DATA_CHANGED,t,t.onDataUpdateHandler),t.btn_recharge.on(Laya.Event.CLICK,t,t.gotoRechargeHandler),t.btn_get.on(Laya.Event.CLICK,t,t.doGetActivityReward),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),h.UIEffectsFactory.Ins.createSAniAndCenter(t.btn_effect,40),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){n.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];d.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.onDataUpdateHandler=function(t,e){this._activityId==e&&this.refreshData()},t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.showView=function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=!1),this._activityId!=t){this._activityId=t;var n=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(n){this._childIndexArr=[];for(var s=n.children.length,o=0;o<s;)this._childIndexArr.push(o),o++;this._childIndexArr.sort(this.childSortFun.bind(this))}this._startShowIndex=-1}a.LayerManager.addInPOPWindowLayer(this,e,!1,!0,!1,i),this.refreshData(),g.ClearResM.resetViewImg(this),l.E.ins.on(r.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){l.E.ins.off(r.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),g.ClearResM.clearUrl(this.bgskin.skin)},t.prototype.refreshData=function(){var t=c.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)for(var e,i=this._childIndexArr?this._childIndexArr.length:0,n=0,s=0;n<i;){if(s=this._childIndexArr[n],(e=t.children[s]).status==u.enumStatus.weiwancheng||e.status==u.enumStatus.kelingqu){var o=n/3>>0;return this.updatePage(3*o),void this.updateSeleced()}n++}this.onCloseHandler()},t.prototype.childSortFun=function(t,e){var i=c.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=p.GameConfig.subActivityJson[i.children[t].cfgId],s=p.GameConfig.subActivityJson[i.children[e].cfgId];return n.childId-s.childId},t.prototype.updatePage=function(t){this._startShowIndex=t;var e,i,n,s,o=c.RoleCenter.instans.vo.getActivity1Data(this._activityId),a=this._childIndexArr.length,r=0,l=0;for(this._selectIndex=-1;r<3;){if(e=this["img_item"+(r+1)],n=this["clip_value"+(r+1)],i=this["img_lq"+(r+1)],e.off(Laya.Event.CLICK,this,this.onSelectedHandler),this._startShowIndex+r<a){l=this._childIndexArr[this._startShowIndex+r],s=o.children[l];var h=p.GameConfig.subActivityJson[s.cfgId];n.value=h.value.toString(),s.status==u.enumStatus.yilingqu?i.visible=!0:(-1==this._selectIndex&&(this._selectIndex=r),i.visible=!1),e.on(Laya.Event.CLICK,this,this.onSelectedHandler,[r]),e.visible=!0,n.visible=!0}else e.visible=!1,n.visible=!1;r++}},t.prototype.onSelectedHandler=function(t){this._selectIndex!=t&&(this._selectIndex=t,this.updateSeleced())},t.prototype.updateSeleced=function(){if(-1!=this._selectIndex){var t=this["img_item"+(this._selectIndex+1)];this.img_select.x=t.x-12,this.img_select.y=t.y-14;var e,i=c.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=this._childIndexArr[this._startShowIndex+this._selectIndex];e=i.children[n];var s=p.GameConfig.subActivityJson[e.cfgId];this.btn_effect.visible=!0,e.status==u.enumStatus.weiwancheng?(this.btn_recharge.visible=!0,this.btn_get.visible=!1,this.font_money.value=(s.value-i.allData.allCount).toString()):e.status==u.enumStatus.kelingqu?(this.btn_recharge.visible=!1,this.btn_get.visible=!0,this.font_money.value="0"):e.status==u.enumStatus.yilingqu&&(this.btn_recharge.visible=!1,this.btn_get.visible=!1,this.font_money.value="0",this.btn_effect.visible=!1),this.list_item.array=s.bonus}},t.prototype.gotoRechargeHandler=function(){i.Switches.ins.event(109,[!1,!0])},t.prototype.doGetActivityReward=function(){if(!(Date.now()-this._lastRequestTime<500)){var t,e=c.RoleCenter.instans.vo.getActivity1Data(this._activityId),i=this._childIndexArr[this._startShowIndex+this._selectIndex];if((t=e.children[i])&&t.status==u.enumStatus.kelingqu){var n=new s.ActivityGetC2GS;n.id=this._activityId,n.activity2CfgId=t.cfgId,o.GSM.sendServer(n),this._lastRequestTime=Date.now()}}},t}(ui.activity.DailyRechargeQuickUI);e.DailyRechargeQuick=v}),define("src/g/activity/ctrl/DailyRechargeQuickCtrl",["require","exports","src/g/activity/view/DailyRechargeQuick","../../../manager/RoleCenter","../../net/messages/enumStatus","src/init/Switches"],function(t,e,n,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(){h.Switches.ins.on(146,this,this.showPanel)},t.prototype.showPanel=function(t,e,i){if(void 0===e&&(e=!0),void 0===i&&(i=!1),t){var n=r.RoleCenter.instans.vo.getDailyAccumulativeData();if(n){for(var s,o=n.children.length,a=0;a<o;){if((s=n.children[a]).status==l.enumStatus.weiwancheng||s.status==l.enumStatus.kelingqu)return void this.doOpenView(n.id,e,i);a++}h.Switches.ins.event(8,[!0,!0,204])}}},t.prototype.doOpenView=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this._view||(this._view=new n.DailyRechargeQuick),this._view.showView(t,e,i)},t}();e.DailyRechargeQuickCtrl=i}),define("src/g/common/ctrl/JointAttGuideChecker",["require","exports","../../../enum/EventName","../../../core/E","src/g/fight/osprite/play/PlayManager","../../../component/JointAttackOpenDlg","src/g/accessctrl/AccessCenter","../../../manager/LayerManager"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){}return t.checkRun=function(){return!a.AccessCenter.ins.checkOpen(120)},t.prototype.run=function(){a.AccessCenter.ins.on(120,this,this.accessChanged)},t.prototype.accessChanged=function(){a.AccessCenter.ins.checkOpen(120)&&(a.AccessCenter.ins.off(120,this,this.accessChanged),0<r.LayerManager.getWindowLayerNumChildren()?n.E.ins.on(i.EventName.CLOSEALLWINDOWS,this,this.onCloseAllWindows):Laya.timer.frameOnce(2,this,this.popQuntiPromptPanel))},t.prototype.onCloseAllWindows=function(){n.E.ins.off(i.EventName.CLOSEALLWINDOWS,this,this.onCloseAllWindows),this.popQuntiPromptPanel()},t.prototype.popQuntiPromptPanel=function(){if(s.PlayManager.isSpecialPlay())n.E.ins.once(i.EventName.PLAY_TYPE_CHANGED,this,this.popQuntiPromptPanel);else{var t=new o.JointAttackOpenDlg;a.AccessCenter.ins.checkOpen(121)?t.doShow(o.JointAttackUIType.qunti,[o.JointAttackUIType.wudi,o.JointAttackUIType.danti]):t.doShow(o.JointAttackUIType.qunti,[o.JointAttackUIType.danti])}},t}();e.JointAttGuideChecker=l}),define("src/g/common/ctrl/CommonCtrl",["require","exports","../../../core/E","../../../enum/EventName","src/g/common/ctrl/JointAttGuideChecker","src/g/accessctrl/AccessCenter"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){}return t.prototype.init=function(){o.AccessCenter.ins.inited?this.onSelfDataInited():i.E.ins.once(n.EventName.ACCESS_CENTER_INITED,this,this.onSelfDataInited)},t.prototype.onSelfDataInited=function(){s.JointAttGuideChecker.checkRun()&&(new s.JointAttGuideChecker).run()},t}();e.CommonCtrl=a}),define("src/g/helper/view/item/HelperItem",["require","exports","src/init/Switches","../../../net/messages/GuideGiftC2GS","../../../../manager/GameSocketManager","src/g/Effects/UIEffectsFactory","../../../../manager/RoleCenter","src/init/TextConst"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){this.btn_get.on(Laya.Event.CLICK,this,this.onClickGet)},t.prototype.onClickGet=function(){this.clickHandler&&this.clickHandler.run()},t.prototype.initItem=function(t){var e;t.nameurl&&""!=t.nameurl?this.img_lv.skin="dynamic/helper/"+t.nameurl+".png":this.img_lv.skin="",this.img_advert.skin="dynamic/helper/"+t.advertSrc+".png",this.img_bg.skin="dynamic/helper/"+t.giftBgSrc+".png",this.box_reward.visible=!1,this.btn_get.label=r.TextConst.get(200),e=t.moduleid[0][1],this.clickHandler=new Laya.Handler(this,this.onClicked,[e,!0]),this.aniSp&&(this.aniSp.destroy(),this.aniSp=null)},t.prototype.onClicked=function(t,e){e?13==t?0<a.RoleCenter.instans.vo.vipData.allPriceGold?i.Switches.ins.event(109):i.Switches.ins.event(13):i.Switches.ins.event(t):this.getReward(t)},t.prototype.getReward=function(t){var e=new n.GuideGiftC2GS;e.cfgId=t,s.GSM.sendServer(e)},t}(ui.helper.item.HelperItemUI);e.HelperItem=l}),define("src/g/helper/view/item/HelperTopBtn",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.clickHd=null,t.on(Laya.Event.CLICK,t,t.onClicked),t}return __extends(t,e),t.prototype.initView=function(t){this.vo=t,this.setType(t.type)},t.prototype.setType=function(t){this.img_icon.skin="dynamic/helper/type_"+t+".png"},t.prototype.setSelect=function(t){this.img_select.visible=t},t.prototype.setClickHd=function(t){this.clickHd=t},t.prototype.onClicked=function(){this.clickHd&&this.clickHd.run()},t}(ui.helper.item.HelperTopBtnUI);e.HelperTopBtn=i}),define("src/g/helper/view/HelperView",["require","exports","../../../manager/LayerManager","src/g/helper/view/item/HelperItem","src/g/helper/vo/HelperStruct","src/g/helper/view/item/HelperTopBtn","src/init/Switches","../../../manager/RoleCenter","src/g/Effects/UIEffectsFactory","../../../core/E","../../../enum/EventName","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t._nowType=1,t.advertJumpid=0,t.init(),t}return __extends(t,e),t.prototype.init=function(){this.hst=s.HelperStruct.ins,this.uvo=r.RoleCenter.instans.vo,this.initTopBar(),this.addEvent(),this.view_bg.btn_help.visible=!1,this.list_.itemRender=n.HelperItem,this.list_.renderHandler=new Laya.Handler(this,this.listRenderHandler),this.list_.scrollBar.elasticDistance=50,l.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.lab_goto,42,.5,.7)},t.prototype.listRenderHandler=function(t,e){t.initItem(t.dataSource)},t.prototype.addEvent=function(){this.view_bg.btn_back.on(Laya.Event.CLICK,this,this.closeSelf),this.view_bg.btn_close.on(Laya.Event.CLICK,this,this.closeSelf),this.lab_goto.on(Laya.Event.CLICK,this,this.onClickenAdvert)},t.prototype.initTopBar=function(){for(var t=this.hst.getTypeVo(),e=1;e<this.hst.typeLen;e++){var i=new o.HelperTopBtn;i.initView(t[e]);var n=e;i.on(Laya.Event.CLICK,this,this.showlistDataSource,[n-1]),this.panBox.addChild(i)}},t.prototype.showlistDataSource=function(t){this._nowType=t+1;for(var e=this.panBox._childs,i=0;i<e.length;i++)e[i].setSelect(t==i);var n=this.getValidArr(this.hst.getHelperVo(-1,this.hst.getTypeVo(t).type,!0));this.list_.dataSource=n,this.refreshAdvert()},t.prototype.getValidArr=function(t){return t.length&&t[0].type,t},t.prototype.refreshAdvert=function(){for(var t=this.hst.getTypeVo(this._nowType-1),e=t.check,i="",n=0;n<e.length;n++){var s=e[n][0],o=e[n][1];switch(s){case"1":this.uvo.lvl<o&&(this.advertJumpid=t.pos[n],i=t.img[n],n=e.length);break;case"5":this.uvo.VIP<o&&(this.advertJumpid=t.pos[n],i=t.img[n],n=e.length);break;case"6":this.uvo.isSuperMonthCard||(this.advertJumpid=t.pos[n],i=t.img[n],n=e.length);break;case"7":((Date.now()/1e3>>0)-ktgameconfig.LoginVo.SvrCreateTime)/86400<o&&(this.advertJumpid=t.pos[n],i=t.img[n],n=e.length)}n==e.length-1&&(this.advertJumpid=t.pos[n],i=t.img[n])}this.img_advert.skin="dynamic/helper/"+i+".png"},t.prototype.onClickenAdvert=function(){a.Switches.ins.event(this.advertJumpid)},t.prototype.refreshData=function(){this.showlistDataSource(this._nowType-1)},t.prototype.refreshRedDot=function(){},t.prototype.showView=function(t,e){void 0===t&&(t=1),void 0===e&&(e=!1),this._nowType=t,this.refreshData(),i.LayerManager.addInPOPWindowLayer(this,e),u.ClearResM.resetViewImg(this),h.E.ins.on(c.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){h.E.ins.off(c.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),u.ClearResM.clearFolderByUrl("dynamic/helper/"),u.ClearResM.clearUrl(this.bgskin.skin)},t.prototype.closeSelf=function(){this.removeSelf()},t}(ui.helper.HelperViewUI);e.HelperView=p}),define("src/g/helper/view/Tips_helperReward",["require","exports","src/g/helper/vo/HelperStruct","../../../manager/RoleCenter","../../../vo/RedDot/RedDot_Helper","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","../../net/messages/sbkTargetMsg","../../../manager/GameSocketManager","src/g/account/view/AccItem","src/g/guide/vo/RewardVo","../../../utils/ItemUtils","../../../enum/enumItem","../../../config/GameConfig","src/init/Switches","../../../meta/QualiyVo","src/init/TextConst"],function(t,e,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function i(){var t=e.call(this)||this;return t.nowTargetId=0,t.addEvent(),t.list_.itemRender=c.AccItem,t.list_.renderHandler=new Laya.Handler(t,t.listRender),t}return __extends(i,e),i.create=function(t){void 0===t&&(t=null);var e=new i;e.initData(t),e.popup()},i.prototype.addEvent=function(){this.btn_getReward.on(Laya.Event.CLICK,this,this.onGetRewardClick),this.box_0.on(Laya.Event.CLICK,this,this.jumpModule,[0]),this.box_1.on(Laya.Event.CLICK,this,this.jumpModule,[1])},i.prototype.onGetRewardClick=function(){if(this.inv)this.close();else if(o.RedDot_Helper.Ins.red){var t=new l.GetTargetTaskC2GS;t.targetId=this.user.targetId,h.GSM.sendServer(t),this.close(),32102==t.targetId&&v.Switches.ins.event(75)}else a.FE.upItems(y.TextConst.get(580),r.BubbleEnum.center)},i.prototype.jumpModule=function(t){v.Switches.ins.event(this.tvo.moduleID[t][1]),this.close()},i.prototype.initData=function(t){void 0===t&&(t=null),this.inv=t,this.user=s.RoleCenter.instans.vo,this.nowTargetId=n.HelperStruct.ins.getNextTargetId(this.user.targetId),this.tvo=n.HelperStruct.ins.getTargetVoById(this.nowTargetId),this.renderView()},i.prototype.renderView=function(){this.renderReward(),this.renderTitleAndDes(),this.renderModule()},i.prototype.renderTitleAndDes=function(){var t=o.RedDot_Helper.Ins.red;this.btn_getReward.disabled=!t,this.img_des.skin="res/helper/"+(t?this.tvo.titleB:this.tvo.titleA)+".png",this.img_title.skin="res/helper/zhushou_tankuang_biaoti"+(t?"2":"1")+".png"},i.prototype.renderReward=function(){var t=[];if(this.inv)t=p.ItemUtils.getRewardArrByInv(this.inv);else{var e=this.tvo.bonus;if(!e)return;for(var i=0;i<e.length;i++){var n=p.ItemUtils.getItemVoById(e[i][0]),s=p.ItemUtils.getCurrencyVoByDefine(e[i][0]),o=p.ItemUtils.getEquipVoById(e[i][0]),a=new u.RewardVo;n?(a.res=p.ItemUtils.getIconByIconId(n.icon),a.lv=n.uselimit,a.qualityNum=n.quality,a.quality=f.QualityStruct.Ins.getQColorById(n.quality),a.name=n.name,a.id=n.id,a.type=d.ItemType.ITEM,a.count=e[i][1],a.streamer=n.streamer):s?(a.count=e[i][1],a.name=s.name,a.type=d.ItemType.CURRENCY,a.quality=f.QualityStruct.Ins.getQColorById(s.quality),a.res=p.ItemUtils.getIconByIconId(s.icon),a.qualityNum=s.quality,a.define=s.define,a.streamer=s.streamer):o&&(a.res=p.ItemUtils.getIconByIconId(o.icon),4e3<o.id?a.lv=o.name:a.lv=o.limit,a.qualityNum=o.quality,a.quality=f.QualityStruct.Ins.getQColorById(o.quality),a.name=o.name,a.type=d.ItemType.EQ,a.id=o.id,a.job=o.job||-1),t.push(a)}}this.list_.dataSource=t},i.prototype.listRender=function(t,e){t.eqData=t.dataSource},i.prototype.renderModule=function(){for(var t=o.RedDot_Helper.Ins.red,e=0;e<2;e++){var i=this["box_"+e];if(!this.tvo.moduleID[e]||t)this.img_bg.height-=i.height,i.removeSelf();else{var n=i.getChildByName("lab_des"),s=g.GameConfig.accessCtrlCfg[this.tvo.moduleID[e][1]];n.text=s.desc}}this.height=7+this.img_bg.height},i.prototype.close=function(){Laya.loader.clearRes("res/atlas/res/helper.json"),e.prototype.close.call(this)},i}(ui.helper.TIps_HelperRewardUI);e.Tips_helperReward=i}),define("src/g/helper/ctrl/HelperCtrl",["require","exports","src/g/helper/view/HelperView","src/init/Switches","src/g/base/BaseCtrl","../../../core/E","../../../enum/EventName","src/g/helper/view/Tips_helperReward","../../../manager/GameSocketManager","../../net/messages/sbkTargetMsg","../../../manager/RoleCenter","../../../vo/RedDot/RedDot_Helper","src/init/GameEventDispatcher","../../../component/StageRewardDlg"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(e){function t(){var t=e.call(this)||this;return t._page=0,t.closeOther=!1,t.urls=["res/atlas/res/helper.json"],t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){n.Switches.ins.on(151,this,this.onOpenView,[151]),n.Switches.ins.on(193,this,this.onOpenView,[193]),l.GSM.ins.on(h.GetTargetTaskGS2C.KEY,this,this.onGetTargetTaskGS2C),o.E.ins.on(a.EventName.HELPER_MSG_CHANGE,this,this.onHelperMsgChange),o.E.ins.on(a.EventName.RELIC_DIALOG_POP,this,this.onOpenRelic)},t.prototype.onOpenRelic=function(){(new d.StageRewardDlg).popup()},t.prototype.onGetTargetTaskGS2C=function(t){c.RoleCenter.instans.vo.targetId=t.targetId,c.RoleCenter.instans.addInventoryToC(t.inv),c.RoleCenter.effectExpAndMoney(t.inv),p.GE.ins.event(10),u.RedDot_Helper.Ins.checkTarget()},t.prototype.onHelperMsgChange=function(){this._view&&this._view.displayedInStage&&this._view.refreshData()},t.prototype.onOpenView=function(t,e){void 0===t&&(t=1),void 0===e&&(e=!1),this._page=t,this.closeOther=e,this.opens()},t.prototype.onAtlasLoaded=function(){this.realOpenRoleView(this._page,this.closeOther)},t.prototype.realOpenRoleView=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!1),151==t?(this._view||(this._view=new i.HelperView),this._view.showView()):193==t&&r.Tips_helperReward.create()},t}(s.BaseCtrl);e.HelperCtrl=g}),define("src/g/tips/view/Tips_GoldInsufficient",["require","exports","../../../manager/RoleCenter","src/init/Switches","src/g/clearRes/ClearResM","../../../manager/LayerManager","src/init/TextConst","src/g/gameSdk/gameSdk","../../../vo/sbkUserVo","../../../enum/enumItem","../../net/messages/ChannelGiftMsg","../../../manager/GameSocketManager"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t.jumpId=0,t.addEvent(),t.checkPayType(),t}return __extends(t,e),t.prototype.addEvent=function(){this.btn_close.once(Laya.Event.CLICK,this,this.close),this.btn_iknow.once(Laya.Event.CLICK,this,this.close),this.btn_pay.once(Laya.Event.CLICK,this,this.gotoPay),this.btn_close.on(Laya.Event.CLICK,this,this.close)},t.prototype.Share=function(){r.gameSdk.Ins.sdk.enterShareAndFeed(JSON.stringify({}),function(t){var e=new c.TakeChannelGiftC2GS;e.id=h.ChannelGiftIdEnum.moneyShare,u.GSM.sendServer(e)}),this.close()},t.prototype.close=function(){e.prototype.close.call(this),s.ClearResM.clearResFolder("tips/")},t.prototype.checkPayType=function(){i.RoleCenter.instans.vo.vipData.isFirstCharge?(this.btn_pay.label=a.TextConst.get(864),this.jumpId=109):(this.btn_pay.label=a.TextConst.get(863),this.jumpId=13);var t=3-l.sbkUserVo.getChannelGiftCnt(h.ChannelGiftIdEnum.moneyShare);this.txt_remain.text="剩余次数："+t,this.btn_iknow.disabled=0==t},t.prototype.gotoPay=function(){o.LayerManager.closeAllPOPWindow(),Laya.Dialog.closeAll(),n.Switches.ins.event(this.jumpId),this.close()},t.create=function(){(new t).popup()},t}(ui.alert.Tips.Tips_GoldInsufficientUI);e.Tips_GoldInsufficient=p}),define("src/g/tips/view/Tips_HitBoss",["require","exports","src/init/Switches","src/g/clearRes/ClearResM"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){this.btn_bosshome.on(Laya.Event.CLICK,this,this.onJumpModule,[this.btn_bosshome.name]),this.btn_bossshenyu.on(Laya.Event.CLICK,this,this.onJumpModule,[this.btn_bossshenyu.name]),this.btn_bosszhizun.on(Laya.Event.CLICK,this,this.onJumpModule,[this.btn_bosszhizun.name]),this.btn_xunbao.on(Laya.Event.CLICK,this,this.onJumpModule,[this.btn_xunbao.name]),this.btn_close.on(Laya.Event.CLICK,this,this.close)},t.prototype.close=function(){e.prototype.close.call(this),n.ClearResM.clearResFolder("tips/"),n.ClearResM.clearUrl(this.bg.skin)},t.prototype.onJumpModule=function(t){i.Switches.ins.event(t),this.close()},t.create=function(){(new t).popup()},t}(ui.alert.Tips.Tips_HitBossUI);e.Tips_HitBoss=s}),define("src/g/tips/view/Tips_QuickUpLv",["require","exports","src/init/Switches","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/g/clearRes/ClearResM","src/g/index/ctrl/PortViewCtrl","src/init/TextConst"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){this.btn_ttt.on(Laya.Event.CLICK,this,this.onJumpModule,[this.btn_ttt.name]),this.btn_port.on(Laya.Event.CLICK,this,this.onClickPort),this.btn_close.on(Laya.Event.CLICK,this,this.close)},t.prototype.onClickPort=function(){a.PortViewCtrl.getins().isAutoBattle?n.FE.upItems(r.TextConst.get(771),s.BubbleEnum.center):i.Switches.ins.event(17),this.close()},t.prototype.close=function(){e.prototype.close.call(this),o.ClearResM.clearResFolder("tips/")},t.prototype.onJumpModule=function(t){i.Switches.ins.event(t),this.close()},t.create=function(){(new t).popup()},t}(ui.alert.Tips.Tips_QuickUpLvUI);e.Tips_QuickUpLv=l}),define("src/g/tips/view/Tips_ZhuanSheng",["require","exports","src/init/Switches","src/g/clearRes/ClearResM"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){this.btn_4.on(Laya.Event.CLICK,this,this.onJumpModule,[this.btn_4.name]),this.btn_8.on(Laya.Event.CLICK,this,this.onJumpModule,[this.btn_8.name]),this.btn_close.on(Laya.Event.CLICK,this,this.close)},t.prototype.close=function(){e.prototype.close.call(this),n.ClearResM.clearResFolder("tips/")},t.prototype.onJumpModule=function(t){i.Switches.ins.event(t),this.close()},t.create=function(){(new t).popup()},t}(ui.alert.Tips.Tips_ZhuanShengUI);e.Tips_ZhuanSheng=s}),define("src/g/tips/view/Tips_ShenZhuang",["require","exports","src/init/Switches","src/g/clearRes/ClearResM"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){this.btn_77.on(Laya.Event.CLICK,this,this.onJumpModule,[this.btn_77.name]),this.btn_73.on(Laya.Event.CLICK,this,this.onJumpModule,[this.btn_73.name]),this.btn_close.on(Laya.Event.CLICK,this,this.close)},t.prototype.close=function(){e.prototype.close.call(this),n.ClearResM.clearResFolder("tips/")},t.prototype.onJumpModule=function(t){i.Switches.ins.event(t),this.close()},t.create=function(){(new t).popup()},t}(ui.alert.Tips.Tips_ShenZhuangUI);e.Tips_ShenZhuang=s}),define("src/g/tips/ctrl/TipsViewCtrl",["require","exports","src/init/Switches","src/g/tips/view/Tips_GoldInsufficient","src/g/tips/view/Tips_HitBoss","src/g/tips/view/Tips_QuickUpLv","src/g/tips/view/Tips_ZhuanSheng","src/g/tips/view/Tips_ShenZhuang"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){var t=i.Switches.ins;t.on(155,this,this.onSwitches,[0]),t.on(152,this,this.onSwitches,[1]),t.on(153,this,this.onSwitches,[2]),t.on(156,this,this.onSwitches,[3]),t.on(154,this,this.onSwitches,[4])}return t.prototype.onSwitches=function(t){switch(t){case 0:n.Tips_GoldInsufficient.create();break;case 1:o.Tips_QuickUpLv.create();break;case 2:s.Tips_HitBoss.create();break;case 3:r.Tips_ShenZhuang.create();break;case 4:a.Tips_ZhuanSheng.create()}},t}();e.TipsViewCtrl=l}),define("src/g/activity/view/FestivalActivityHallView",["require","exports","../../../manager/LayerManager","../../../manager/ActivityManager","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","src/g/activity/view/ActivityHallViewProxy","src/g/clearRes/ClearResM","src/g/activity/view/ActivityHallViewUIProxy"],function(t,e,n,s,i,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.FESTIVAL_ACTIVITY_HALL,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_back.on(Laya.Event.CLICK,t,t.backHandler),t._uiProxy||(t._uiProxy=new h.ActivityHallViewUIProxy(t,t._pos),t._uiProxy.init()),t._contentProxy||(t._contentProxy=new r.ActivityHallViewProxy(t._pos,t.con_btn,t.con_page,t.bg.img_title),t._contentProxy.on(r.ActivityHallViewProxy.BTNS_INITED_EVENT,t,t.onBtnsUpdated)),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf(),Laya.loader.clearRes(this.img_bg.skin)},t.prototype.backHandler=function(){this._contentProxy?this._contentProxy.backHandler()&&this.onCloseHandler():this.onCloseHandler()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._contentProxy.showView(),0<t?Laya.timer.frameOnce(3,this,this.openActivityById,[t]):this._uiProxy.checkBtnRedAndTurnTo(),s.ActivityManager.ins.isInited&&n.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),l.ClearResM.resetViewImg(this),o.E.ins.on(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){o.E.ins.off(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),l.ClearResM.clearFolderByUrl("dynamic/activity/"),l.ClearResM.clearResFolder("activity")},t.prototype.onBtnsUpdated=function(){this._uiProxy&&this._uiProxy.onBtnsChanged()},t.prototype.openActivityById=function(t){if(this._uiProxy&&this._contentProxy){var e=this._uiProxy.findBtnByCfgId(t);e&&(this._contentProxy.selectActivityHandler(e.activityId),this._uiProxy.scrollToBtn(e))}},t}(ui.activity.FestivalActivityHallViewUI);e.FestivalActivityHallView=c}),define("src/g/activity/view/ActivityHallView5",["require","exports","../../../manager/LayerManager","../../../manager/ActivityManager","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","src/g/activity/view/ActivityHallViewProxy","src/g/clearRes/ClearResM","src/g/activity/view/ActivityHallViewUIProxy"],function(t,e,n,s,i,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ACTIVITY_HALL_5,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_back.on(Laya.Event.CLICK,t,t.backHandler),t._uiProxy||(t._uiProxy=new h.ActivityHallViewUIProxy(t,t._pos),t._uiProxy.init()),t._contentProxy||(t._contentProxy=new r.ActivityHallViewProxy(t._pos,t.con_btn,t.con_page,t.bg.img_title),t._contentProxy.on(r.ActivityHallViewProxy.BTNS_INITED_EVENT,t,t.onBtnsUpdated)),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.backHandler=function(){this._contentProxy?this._contentProxy.backHandler()&&this.onCloseHandler():this.onCloseHandler()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._contentProxy.showView(),0<t?Laya.timer.frameOnce(3,this,this.openActivityById,[t]):this._uiProxy.checkBtnRedAndTurnTo(),s.ActivityManager.ins.isInited&&n.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),l.ClearResM.resetViewImg(this),o.E.ins.on(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){o.E.ins.off(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),l.ClearResM.clearFolderByUrl("dynamic/activity/"),l.ClearResM.clearResFolder("activity"),Laya.loader.clearRes(this.img_bg.skin)},t.prototype.onBtnsUpdated=function(){this._uiProxy&&this._uiProxy.onBtnsChanged()},t.prototype.openActivityById=function(t){if(this._uiProxy&&this._contentProxy){var e=this._uiProxy.findBtnByCfgId(t);e&&(this._contentProxy.selectActivityHandler(e.activityId),this._uiProxy.scrollToBtn(e))}},t}(ui.activity.ActivityHallView5UI);e.ActivityHallView5=c}),define("src/g/activity/view/ActivityHallView6",["require","exports","../../../manager/LayerManager","../../../manager/ActivityManager","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","src/g/activity/view/ActivityHallViewProxy","src/g/clearRes/ClearResM","src/g/activity/view/ActivityHallViewUIProxy"],function(t,e,n,s,i,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ACTIVITY_HALL_6,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_back.on(Laya.Event.CLICK,t,t.backHandler),t._uiProxy||(t._uiProxy=new h.ActivityHallViewUIProxy(t,t._pos),t._uiProxy.init()),t._contentProxy||(t._contentProxy=new r.ActivityHallViewProxy(t._pos,t.con_btn,t.con_page,t.bg.img_title),t._contentProxy.on(r.ActivityHallViewProxy.BTNS_INITED_EVENT,t,t.onBtnsUpdated)),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.backHandler=function(){this._contentProxy?this._contentProxy.backHandler()&&this.onCloseHandler():this.onCloseHandler()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._contentProxy.showView(),0<t?Laya.timer.frameOnce(3,this,this.openActivityById,[t]):this._uiProxy.checkBtnRedAndTurnTo(),s.ActivityManager.ins.isInited&&n.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),l.ClearResM.resetViewImg(this),o.E.ins.on(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){o.E.ins.off(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),l.ClearResM.clearFolderByUrl("dynamic/activity/"),l.ClearResM.clearResFolder("activity"),Laya.loader.clearRes(this.img_bg.skin)},t.prototype.onBtnsUpdated=function(){this._uiProxy&&this._uiProxy.onBtnsChanged()},t.prototype.openActivityById=function(t){if(this._uiProxy&&this._contentProxy){var e=this._uiProxy.findBtnByCfgId(t);e&&(this._contentProxy.selectActivityHandler(e.activityId),this._uiProxy.scrollToBtn(e))}},t}(ui.activity.ActivityHallView6UI);e.ActivityHallView6=c}),define("src/g/activity/view/ActivityHallView7",["require","exports","../../../manager/LayerManager","../../../manager/ActivityManager","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","src/g/activity/view/ActivityHallViewProxy","src/g/clearRes/ClearResM","src/g/activity/view/ActivityHallViewUIProxy"],function(t,e,n,s,i,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ACTIVITY_HALL_7,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_back.on(Laya.Event.CLICK,t,t.backHandler),t._uiProxy||(t._uiProxy=new h.ActivityHallViewUIProxy(t,t._pos),t._uiProxy.init()),t._contentProxy||(t._contentProxy=new r.ActivityHallViewProxy(t._pos,t.con_btn,t.con_page,t.bg.img_title),t._contentProxy.on(r.ActivityHallViewProxy.BTNS_INITED_EVENT,t,t.onBtnsUpdated)),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.backHandler=function(){this._contentProxy?this._contentProxy.backHandler()&&this.onCloseHandler():this.onCloseHandler()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._contentProxy.showView(),0<t?Laya.timer.frameOnce(3,this,this.openActivityById,[t]):this._uiProxy.checkBtnRedAndTurnTo(),s.ActivityManager.ins.isInited&&n.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),l.ClearResM.resetViewImg(this),o.E.ins.on(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){o.E.ins.off(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),l.ClearResM.clearFolderByUrl("dynamic/activity/"),l.ClearResM.clearResFolder("activity"),Laya.loader.clearRes(this.img_bg.skin)},t.prototype.onBtnsUpdated=function(){this._uiProxy&&this._uiProxy.onBtnsChanged()},t.prototype.openActivityById=function(t){if(this._uiProxy&&this._contentProxy){var e=this._uiProxy.findBtnByCfgId(t);e&&(this._contentProxy.selectActivityHandler(e.activityId),this._uiProxy.scrollToBtn(e))}},t}(ui.activity.ActivityHallView7UI);e.ActivityHallView7=c}),define("src/g/activity/view/FlashSaleHallView",["require","exports","../../../enum/ActivityPos","../../../manager/ActivityManager","src/g/clearRes/ClearResM","../../../core/E","../../../enum/EventName","../../../manager/LayerManager","../../../manager/RoleCenter","../../../config/GameConfig","src/g/activity/view/ActivityPageFactroy"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.FLASH_SALE_HALL,t._currActivityId=0,t.img_bg.width=Laya.stage.width,t.img_bg.height=Laya.stage.height,t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),o.E.ins.on(a.EventName.ACTIVITY_HALL_LIST_CHANGED,t,t.changeHallHandler),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.changeHallHandler=function(t){t==this._pos&&this.displayedInStage&&this.updateContent()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),n.ActivityManager.ins.isInited&&(r.LayerManager.addInPOPWindowLayer(this,e,!1,!1,!1,i),this.updateContent(),s.ClearResM.resetViewImg(this),o.E.ins.on(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes))},t.prototype.closeClearRes=function(){o.E.ins.off(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),s.ClearResM.clearFolderByUrl("dynamic/activity/"),s.ClearResM.clearResFolder("activity"),s.ClearResM.clearFolderByUrl("res/activity/flash_sale")},t.prototype.updateContent=function(){var t=n.ActivityManager.ins.getActivityHallByPos(this._pos);if(t&&0<t.count){var e=t.getActivatedIds();e&&0<e.length&&(this._currActivityId=e[0],this.showActivityHandler(this._currActivityId))}else this._currPage&&(this._currPage.doDestroy(),this._currPage=null),this.displayedInStage&&this.onCloseHandler()},t.prototype.showActivityHandler=function(t){if(this._currPage){if(this._currPage.getActivityId()==t)return void this._currPage.refresh();this._currPage.doDestroy(),this._currPage=null}var e=l.RoleCenter.instans.vo.getActivity1Data(t);if(e){var i=h.GameConfig.activityJson[e.cfgId];i&&(this._currPage=c.ActivityPageFactroy.getActivityPage(i.clientkey),this._currPage&&this._currPage.showPage(t,this.con_page))}},t}(ui.activity.FlashSaleHallViewUI);e.FlashSaleHallView=u}),define("src/g/activity/view/AdvanceNoticeHallView",["require","exports","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","../../../manager/ActivityManager","src/g/clearRes/ClearResM","../../../manager/RoleCenter","../../../config/GameConfig","src/g/activity/view/ActivityPageFactroy","../../../utils/DialogQueue","../../../enum/DialogIDEnum"],function(t,e,i,s,o,a,r,n,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ADVANCE_NOTICE_HALL,t._currActivityId=0,t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),s.E.ins.on(o.EventName.ACTIVITY_HALL_LIST_CHANGED,t,t.changeHallHandler),s.E.ins.on(o.EventName.CLOSE_YUYUE_PAGE,t,t.onCloseHandler),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.close()},t.prototype.changeHallHandler=function(t){t==this._pos&&this.displayedInStage&&this.updateContent()},t.prototype.showView=function(t,e,i,n){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),void 0===n&&(n=!1),a.ActivityManager.ins.isInited&&(n?c.DialogQueue.getInstance().add(u.DialogIDEnum.ADVANCE_NOTICE,this):this.popup(),this.updateContent(),r.ClearResM.resetViewImg(this),s.E.ins.on(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes))},t.prototype.closeClearRes=function(){s.E.ins.off(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),r.ClearResM.clearFolderByUrl("dynamic/activity/"),r.ClearResM.clearResFolder("activity"),r.ClearResM.clearFolderByUrl("res/activity/advance_notice")},t.prototype.updateContent=function(){var t=a.ActivityManager.ins.getActivityHallByPos(this._pos);if(t&&0<t.count){var e=t.getActivatedIds();e&&0<e.length&&(this._currActivityId=e[0],this.showActivityHandler(this._currActivityId))}else this._currPage&&(this._currPage.doDestroy(),this._currPage=null),this.displayedInStage&&this.onCloseHandler()},t.prototype.showActivityHandler=function(t){if(this._currPage){if(this._currPage.getActivityId()==t)return void this._currPage.refresh();this._currPage.doDestroy(),this._currPage=null}var e=n.RoleCenter.instans.vo.getActivity1Data(t);if(e){var i=l.GameConfig.activityJson[e.cfgId];i&&(this._currPage=h.ActivityPageFactroy.getActivityPage(i.clientkey),this._currPage&&this._currPage.showPage(t,this.box_page))}},t}(ui.activity.AdvanceNoticeHallViewUI);e.AdvanceNoticeHallView=p}),define("src/g/activity/view/OneActivityHallView",["require","exports","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","../../../manager/ActivityManager","../../../manager/LayerManager","src/g/clearRes/ClearResM","../../../manager/RoleCenter","../../../config/GameConfig","src/g/activity/view/ActivityPageFactroy"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ONE_ACTIVITY_HALL,t._currActivityId=0,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),n.E.ins.on(s.EventName.ACTIVITY_HALL_LIST_CHANGED,t,t.changeHallHandler),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.changeHallHandler=function(t){t==this._pos&&this.displayedInStage&&this.updateContent()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),o.ActivityManager.ins.isInited&&(a.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),this.updateContent(),r.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes))},t.prototype.closeClearRes=function(){n.E.ins.off(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),r.ClearResM.clearFolderByUrl("dynamic/activity/"),r.ClearResM.clearResFolder("activity")},t.prototype.updateContent=function(){var t=o.ActivityManager.ins.getActivityHallByPos(this._pos);if(t&&0<t.count){var e=t.getActivatedIds();e&&0<e.length&&(this._currActivityId=e[0],this.showActivityHandler(this._currActivityId))}else this._currPage&&(this._currPage.doDestroy(),this._currPage=null),this.displayedInStage&&this.onCloseHandler()},t.prototype.showActivityHandler=function(t){if(this._currPage){if(this._currPage.getActivityId()==t)return void this._currPage.refresh();this._currPage.doDestroy(),this._currPage=null}var e=l.RoleCenter.instans.vo.getActivity1Data(t);if(e){var i=h.GameConfig.activityJson[e.cfgId];i&&(this._currPage=c.ActivityPageFactroy.getActivityPage(i.clientkey),this._currPage&&(this.bg.img_title.skin="dynamic/activity/"+i.clientkey+"/title.png",this._currPage.showPage(t,this.con_page)))}},t}(ui.activity.OneActivityHallViewUI);e.OneActivityHallView=u}),define("src/g/activity/view/OneActivityHallView11",["require","exports","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","../../../manager/ActivityManager","../../../manager/LayerManager","src/g/clearRes/ClearResM","../../../manager/RoleCenter","../../../config/GameConfig","src/g/activity/view/ActivityPageFactroy"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ONE_ACTIVITY_HALL_11,t._currActivityId=0,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),n.E.ins.on(s.EventName.ACTIVITY_HALL_LIST_CHANGED,t,t.changeHallHandler),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.changeHallHandler=function(t){t==this._pos&&this.displayedInStage&&this.updateContent()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),o.ActivityManager.ins.isInited&&(a.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),this.updateContent(),r.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes))},t.prototype.closeClearRes=function(){n.E.ins.off(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),r.ClearResM.clearFolderByUrl("dynamic/activity/"),r.ClearResM.clearResFolder("activity")},t.prototype.updateContent=function(){var t=o.ActivityManager.ins.getActivityHallByPos(this._pos);if(t&&0<t.count){var e=t.getActivatedIds();e&&0<e.length&&(this._currActivityId=e[0],this.showActivityHandler(this._currActivityId))}else this._currPage&&(this._currPage.doDestroy(),this._currPage=null),this.displayedInStage&&this.onCloseHandler()},t.prototype.showActivityHandler=function(t){if(this._currPage){if(this._currPage.getActivityId()==t)return void this._currPage.refresh();this._currPage.doDestroy(),this._currPage=null}var e=l.RoleCenter.instans.vo.getActivity1Data(t);if(e){var i=h.GameConfig.activityJson[e.cfgId];i&&(this._currPage=c.ActivityPageFactroy.getActivityPage(i.clientkey),this._currPage&&(this.bg.img_title.skin="dynamic/activity/"+i.clientkey+"/title.png",this._currPage.showPage(t,this.con_page)))}},t}(ui.activity.OneActivityHallView11UI);e.OneActivityHallView11=u}),define("src/g/activity/view/FlashSaleHallView2",["require","exports","../../../enum/ActivityPos","../../../manager/ActivityManager","src/g/clearRes/ClearResM","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../../config/GameConfig","src/g/activity/view/ActivityPageFactroy","../../../manager/RunTimeUIManager","../../../utils/UIUtils"],function(t,e,i,n,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(s){function t(){var t=s.call(this)||this;return t._pos=i.ActivityPos.FLASH_SALE_HALL_2,t._currActivityId=0,t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),a.E.ins.on(r.EventName.ACTIVITY_HALL_LIST_CHANGED,t,t.changeHallHandler),t}return __extends(t,s),t.prototype.onCloseHandler=function(){this.close()},t.prototype.close=function(t,e){this.mouseEnabled=!1;var i,n=u.RunTimeUIManager.ins.getUI(197);n&&(i=p.UIUtils.getGlobalBound(n)),i?Laya.Tween.to(this,{x:i.x+i.width/2,y:i.y+i.height/2,scaleX:0,scaleY:0},200,null,Laya.Handler.create(this,s.prototype.close,[t,e])):s.prototype.close.call(this,t,e)},t.prototype.changeHallHandler=function(t){t==this._pos&&this.displayedInStage&&this.updateContent()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),n.ActivityManager.ins.isInited&&(this.mouseEnabled=!0,this.isPopup||this.popup(),this.updateContent(),o.ClearResM.resetViewImg(this),a.E.ins.on(r.EventName.CLOSEALLWINDOWS,this,this.closeClearRes))},t.prototype.closeClearRes=function(){a.E.ins.off(r.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),o.ClearResM.clearFolderByUrl("dynamic/activity/"),o.ClearResM.clearResFolder("activity"),o.ClearResM.clearFolderByUrl("res/activity/flash_sale_2")},t.prototype.updateContent=function(){var t=n.ActivityManager.ins.getActivityHallByPos(this._pos);if(t&&0<t.count){var e=t.getActivatedIds();e&&0<e.length&&(this._currActivityId=e[0],this.showActivityHandler(this._currActivityId))}else this._currPage&&(this._currPage.doDestroy(),this._currPage=null),this.isPopup&&this.close()},t.prototype.showActivityHandler=function(t){if(this._currPage){if(this._currPage.getActivityId()==t)return void this._currPage.refresh();this._currPage.doDestroy(),this._currPage=null}var e=l.RoleCenter.instans.vo.getActivity1Data(t);if(e){var i=h.GameConfig.activityJson[e.cfgId];i&&(this._currPage=c.ActivityPageFactroy.getActivityPage(i.clientkey),this._currPage&&this._currPage.showPage(t,this.con_page))}},t}(ui.activity.FlashSaleHallView2UI);e.FlashSaleHallView2=s}),define("src/g/activity/view/OneActivityHallView13",["require","exports","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","../../../manager/ActivityManager","../../../manager/LayerManager","src/g/clearRes/ClearResM","../../../manager/RoleCenter","../../../config/GameConfig","src/g/activity/view/ActivityPageFactroy"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ONE_ACTIVITY_HALL_13,t._currActivityId=0,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),n.E.ins.on(s.EventName.ACTIVITY_HALL_LIST_CHANGED,t,t.changeHallHandler),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.changeHallHandler=function(t){t==this._pos&&this.displayedInStage&&this.updateContent()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),o.ActivityManager.ins.isInited&&(a.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),this.updateContent(),r.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes))},t.prototype.closeClearRes=function(){n.E.ins.off(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),r.ClearResM.clearFolderByUrl("dynamic/activity/"),r.ClearResM.clearResFolder("activity")},t.prototype.updateContent=function(){var t=o.ActivityManager.ins.getActivityHallByPos(this._pos);if(t&&0<t.count){var e=t.getActivatedIds();e&&0<e.length&&(this._currActivityId=e[0],this.showActivityHandler(this._currActivityId))}else this._currPage&&(this._currPage.doDestroy(),this._currPage=null),this.displayedInStage&&this.onCloseHandler()},t.prototype.showActivityHandler=function(t){if(this._currPage){if(this._currPage.getActivityId()==t)return void this._currPage.refresh();this._currPage.doDestroy(),this._currPage=null}var e=l.RoleCenter.instans.vo.getActivity1Data(t);if(e){var i=h.GameConfig.activityJson[e.cfgId];i&&(this._currPage=c.ActivityPageFactroy.getActivityPage(i.clientkey),this._currPage&&(this.bg.img_title.skin="dynamic/activity/"+i.clientkey+"/title.png",this._currPage.showPage(t,this.con_page)))}},t}(ui.activity.OneActivityHallView13UI);e.OneActivityHallView13=u}),define("src/g/activity/view/OneActivityHallView14",["require","exports","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","../../../manager/ActivityManager","../../../manager/LayerManager","src/g/clearRes/ClearResM","../../../manager/RoleCenter","../../../config/GameConfig","src/g/activity/view/ActivityPageFactroy"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ONE_ACTIVITY_HALL_14,t._currActivityId=0,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),n.E.ins.on(s.EventName.ACTIVITY_HALL_LIST_CHANGED,t,t.changeHallHandler),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.changeHallHandler=function(t){t==this._pos&&this.displayedInStage&&this.updateContent()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),o.ActivityManager.ins.isInited&&(a.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),this.updateContent(),r.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes))},t.prototype.closeClearRes=function(){n.E.ins.off(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),r.ClearResM.clearFolderByUrl("dynamic/activity/"),r.ClearResM.clearResFolder("activity")},t.prototype.updateContent=function(){var t=o.ActivityManager.ins.getActivityHallByPos(this._pos);if(t&&0<t.count){var e=t.getActivatedIds();e&&0<e.length&&(this._currActivityId=e[0],this.showActivityHandler(this._currActivityId))}else this._currPage&&(this._currPage.doDestroy(),this._currPage=null),this.displayedInStage&&this.onCloseHandler()},t.prototype.showActivityHandler=function(t){if(this._currPage){if(this._currPage.getActivityId()==t)return void this._currPage.refresh();this._currPage.doDestroy(),this._currPage=null}var e=l.RoleCenter.instans.vo.getActivity1Data(t);if(e){var i=h.GameConfig.activityJson[e.cfgId];i&&(this._currPage=c.ActivityPageFactroy.getActivityPage(i.clientkey),this._currPage&&(this.bg.img_title.skin="dynamic/activity/"+i.clientkey+"/title.png",this._currPage.showPage(t,this.con_page)))}},t}(ui.activity.OneActivityHallView14UI);e.OneActivityHallView14=u}),define("src/g/activity/view/OneActivityHallView15",["require","exports","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","../../../manager/ActivityManager","../../../manager/LayerManager","src/g/clearRes/ClearResM","../../../manager/RoleCenter","../../../config/GameConfig","src/g/activity/view/ActivityPageFactroy"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ONE_ACTIVITY_HALL_15,t._currActivityId=0,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),n.E.ins.on(s.EventName.ACTIVITY_HALL_LIST_CHANGED,t,t.changeHallHandler),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.changeHallHandler=function(t){t==this._pos&&this.displayedInStage&&this.updateContent()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),o.ActivityManager.ins.isInited&&(a.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),this.updateContent(),r.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes))},t.prototype.closeClearRes=function(){n.E.ins.off(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),r.ClearResM.clearFolderByUrl("dynamic/activity/"),r.ClearResM.clearResFolder("activity")},t.prototype.updateContent=function(){var t=o.ActivityManager.ins.getActivityHallByPos(this._pos);if(t&&0<t.count){var e=t.getActivatedIds();e&&0<e.length&&(this._currActivityId=e[0],this.showActivityHandler(this._currActivityId))}else this._currPage&&(this._currPage.doDestroy(),this._currPage=null),this.displayedInStage&&this.onCloseHandler()},t.prototype.showActivityHandler=function(t){if(this._currPage){if(this._currPage.getActivityId()==t)return void this._currPage.refresh();this._currPage.doDestroy(),this._currPage=null}var e=l.RoleCenter.instans.vo.getActivity1Data(t);if(e){var i=h.GameConfig.activityJson[e.cfgId];i&&(this._currPage=c.ActivityPageFactroy.getActivityPage(i.clientkey),this._currPage&&(this.bg.img_title.skin="dynamic/activity/"+i.clientkey+"/title.png",this._currPage.showPage(t,this.con_page)))}},t}(ui.activity.OneActivityHallView15UI);e.OneActivityHallView15=u}),define("src/g/activity/view/ActivityHallView16",["require","exports","../../../manager/LayerManager","../../../manager/ActivityManager","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","src/g/activity/view/ActivityHallViewProxy","src/g/clearRes/ClearResM","src/g/activity/view/ActivityHallViewUIProxy"],function(t,e,n,s,i,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ACTIVITY_HALL_16,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_back.on(Laya.Event.CLICK,t,t.backHandler),t._uiProxy||(t._uiProxy=new h.ActivityHallViewUIProxy(t,t._pos),t._uiProxy.init()),t._contentProxy||(t._contentProxy=new r.ActivityHallViewProxy(t._pos,t.con_btn,t.con_page,t.bg.img_title),t._contentProxy.on(r.ActivityHallViewProxy.BTNS_INITED_EVENT,t,t.onBtnsUpdated)),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.backHandler=function(){this._contentProxy?this._contentProxy.backHandler()&&this.onCloseHandler():this.onCloseHandler()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._contentProxy.showView(),0<t?Laya.timer.frameOnce(3,this,this.openActivityById,[t]):this._uiProxy.checkBtnRedAndTurnTo(),s.ActivityManager.ins.isInited&&n.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),l.ClearResM.resetViewImg(this),o.E.ins.on(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){o.E.ins.off(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),l.ClearResM.clearFolderByUrl("dynamic/activity/"),l.ClearResM.clearResFolder("activity"),Laya.loader.clearRes(this.img_bg.skin)},t.prototype.onBtnsUpdated=function(){this._uiProxy&&this._uiProxy.onBtnsChanged()},t.prototype.openActivityById=function(t){if(this._uiProxy&&this._contentProxy){var e=this._uiProxy.findBtnByCfgId(t);e&&(this._contentProxy.selectActivityHandler(e.activityId),this._uiProxy.scrollToBtn(e))}},t}(ui.activity.ActivityHallView7UI);e.ActivityHallView16=c}),define("src/g/activity/view/ActivityHallView17",["require","exports","../../../manager/LayerManager","../../../manager/ActivityManager","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","src/g/activity/view/ActivityHallViewProxy","src/g/clearRes/ClearResM","src/g/activity/view/ActivityHallViewUIProxy"],function(t,e,n,s,i,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ACTIVITY_HALL_17,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_back.on(Laya.Event.CLICK,t,t.backHandler),t._uiProxy||(t._uiProxy=new h.ActivityHallViewUIProxy(t,t._pos),t._uiProxy.init()),t._contentProxy||(t._contentProxy=new r.ActivityHallViewProxy(t._pos,t.con_btn,t.con_page,t.bg.img_title),t._contentProxy.on(r.ActivityHallViewProxy.BTNS_INITED_EVENT,t,t.onBtnsUpdated)),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.backHandler=function(){this._contentProxy?this._contentProxy.backHandler()&&this.onCloseHandler():this.onCloseHandler()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._contentProxy.showView(),0<t?Laya.timer.frameOnce(3,this,this.openActivityById,[t]):this._uiProxy.checkBtnRedAndTurnTo(),s.ActivityManager.ins.isInited&&n.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),l.ClearResM.resetViewImg(this),o.E.ins.on(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){o.E.ins.off(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),l.ClearResM.clearFolderByUrl("dynamic/activity/"),l.ClearResM.clearResFolder("activity"),Laya.loader.clearRes(this.img_bg.skin)},t.prototype.onBtnsUpdated=function(){this._uiProxy&&this._uiProxy.onBtnsChanged()},t.prototype.openActivityById=function(t){if(this._uiProxy&&this._contentProxy){var e=this._uiProxy.findBtnByCfgId(t);e&&(this._contentProxy.selectActivityHandler(e.activityId),this._uiProxy.scrollToBtn(e))}},t}(ui.activity.ActivityHallView7UI);e.ActivityHallView17=c}),define("src/g/activity/view/OneActivityHallView21",["require","exports","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","../../../manager/ActivityManager","../../../manager/LayerManager","src/g/clearRes/ClearResM","../../../manager/RoleCenter","../../../config/GameConfig","src/g/activity/view/ActivityPageFactroy"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ONE_ACTIVITY_HALL_21,t._currActivityId=0,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),n.E.ins.on(s.EventName.ACTIVITY_HALL_LIST_CHANGED,t,t.changeHallHandler),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.changeHallHandler=function(t){t==this._pos&&this.displayedInStage&&this.updateContent()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),o.ActivityManager.ins.isInited&&(a.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),this.updateContent(),r.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes))},t.prototype.closeClearRes=function(){n.E.ins.off(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),r.ClearResM.clearFolderByUrl("dynamic/activity/"),r.ClearResM.clearResFolder("activity")},t.prototype.updateContent=function(){var t=o.ActivityManager.ins.getActivityHallByPos(this._pos);if(t&&0<t.count){var e=t.getActivatedIds();e&&0<e.length&&(this._currActivityId=e[0],this.showActivityHandler(this._currActivityId))}else this._currPage&&(this._currPage.doDestroy(),this._currPage=null),this.displayedInStage&&this.onCloseHandler()},t.prototype.showActivityHandler=function(t){if(this._currPage){if(this._currPage.getActivityId()==t)return void this._currPage.refresh();this._currPage.doDestroy(),this._currPage=null}var e=l.RoleCenter.instans.vo.getActivity1Data(t);if(e){var i=h.GameConfig.activityJson[e.cfgId];i&&(this._currPage=c.ActivityPageFactroy.getActivityPage(i.clientkey),this._currPage&&(this.bg.img_title.skin="dynamic/activity/"+i.clientkey+"/title.png",this._currPage.showPage(t,this.con_page)))}},t}(ui.activity.OneActivityHallView21UI);e.OneActivityHallView21=u}),define("src/g/activity/view/OneActivityHallView23",["require","exports","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","../../../manager/ActivityManager","../../../manager/LayerManager","src/g/clearRes/ClearResM","../../../manager/RoleCenter","../../../config/GameConfig","src/g/activity/view/ActivityPageFactroy"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ONE_ACTIVITY_HALL_23,t._currActivityId=0,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),n.E.ins.on(s.EventName.ACTIVITY_HALL_LIST_CHANGED,t,t.changeHallHandler),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.changeHallHandler=function(t){t==this._pos&&this.displayedInStage&&this.updateContent()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),o.ActivityManager.ins.isInited&&(a.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),this.updateContent(),r.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes))},t.prototype.closeClearRes=function(){n.E.ins.off(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),r.ClearResM.clearFolderByUrl("dynamic/activity/"),r.ClearResM.clearResFolder("activity")},t.prototype.updateContent=function(){var t=o.ActivityManager.ins.getActivityHallByPos(this._pos);if(t&&0<t.count){var e=t.getActivatedIds();e&&0<e.length&&(this._currActivityId=e[0],this.showActivityHandler(this._currActivityId))}else this._currPage&&(this._currPage.doDestroy(),this._currPage=null),this.displayedInStage&&this.onCloseHandler()},t.prototype.showActivityHandler=function(t){if(this._currPage){if(this._currPage.getActivityId()==t)return void this._currPage.refresh();this._currPage.doDestroy(),this._currPage=null}var e=l.RoleCenter.instans.vo.getActivity1Data(t);if(e){var i=h.GameConfig.activityJson[e.cfgId];i&&(this._currPage=c.ActivityPageFactroy.getActivityPage(i.clientkey),this._currPage&&(this.bg.img_title.skin="dynamic/activity/"+i.clientkey+"/title.png",this._currPage.showPage(t,this.con_page)))}},t}(ui.activity.OneActivityHallView23UI);e.OneActivityHallView23=u}),define("src/g/activity/view/ActivityHallView20",["require","exports","../../../manager/LayerManager","../../../manager/ActivityManager","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","src/g/activity/view/ActivityHallViewProxy","src/g/clearRes/ClearResM","src/g/activity/view/ActivityHallViewUIProxy"],function(t,e,n,s,i,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ACTIVITY_HALL_20,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_back.on(Laya.Event.CLICK,t,t.backHandler),t._uiProxy||(t._uiProxy=new h.ActivityHallViewUIProxy(t,t._pos),t._uiProxy.init()),t._contentProxy||(t._contentProxy=new r.ActivityHallViewProxy(t._pos,t.con_btn,t.con_page,t.bg.img_title),t._contentProxy.on(r.ActivityHallViewProxy.BTNS_INITED_EVENT,t,t.onBtnsUpdated)),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.backHandler=function(){this._contentProxy?this._contentProxy.backHandler()&&this.onCloseHandler():this.onCloseHandler()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._contentProxy.showView(),0<t?Laya.timer.frameOnce(3,this,this.openActivityById,[t]):this._uiProxy.checkBtnRedAndTurnTo(),s.ActivityManager.ins.isInited&&n.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),l.ClearResM.resetViewImg(this),o.E.ins.on(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){o.E.ins.off(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),l.ClearResM.clearFolderByUrl("dynamic/activity/"),l.ClearResM.clearResFolder("activity"),Laya.loader.clearRes(this.img_bg.skin)},t.prototype.onBtnsUpdated=function(){this._uiProxy&&this._uiProxy.onBtnsChanged()},t.prototype.openActivityById=function(t){if(this._uiProxy&&this._contentProxy){var e=this._uiProxy.findBtnByCfgId(t);e&&(this._contentProxy.selectActivityHandler(e.activityId),this._uiProxy.scrollToBtn(e))}},t}(ui.activity.ActivityHallView20UI);e.ActivityHallView20=c}),define("src/g/activity/view/ActivityHallView22",["require","exports","../../../manager/LayerManager","../../../manager/ActivityManager","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","src/g/activity/view/ActivityHallViewProxy","src/g/clearRes/ClearResM","src/g/activity/view/ActivityHallViewUIProxy"],function(t,e,n,s,i,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ACTIVITY_HALL_22,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_back.on(Laya.Event.CLICK,t,t.backHandler),t._uiProxy||(t._uiProxy=new h.ActivityHallViewUIProxy(t,t._pos),t._uiProxy.init()),t._contentProxy||(t._contentProxy=new r.ActivityHallViewProxy(t._pos,t.con_btn,t.con_page,t.bg.img_title),t._contentProxy.on(r.ActivityHallViewProxy.BTNS_INITED_EVENT,t,t.onBtnsUpdated)),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.backHandler=function(){this._contentProxy?this._contentProxy.backHandler()&&this.onCloseHandler():this.onCloseHandler()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._contentProxy.showView(),0<t?Laya.timer.frameOnce(3,this,this.openActivityById,[t]):this._uiProxy.checkBtnRedAndTurnTo(),s.ActivityManager.ins.isInited&&n.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),l.ClearResM.resetViewImg(this),o.E.ins.on(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){o.E.ins.off(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),l.ClearResM.clearFolderByUrl("dynamic/activity/"),l.ClearResM.clearResFolder("activity"),Laya.loader.clearRes(this.img_bg.skin)},t.prototype.onBtnsUpdated=function(){this._uiProxy&&this._uiProxy.onBtnsChanged()},t.prototype.openActivityById=function(t){if(this._uiProxy&&this._contentProxy){var e=this._uiProxy.findBtnByCfgId(t);e&&(this._contentProxy.selectActivityHandler(e.activityId),this._uiProxy.scrollToBtn(e))}},t}(ui.activity.ActivityHallView22UI);e.ActivityHallView22=c}),define("src/g/activity/view/ActivityHallView24",["require","exports","../../../manager/LayerManager","../../../manager/ActivityManager","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","src/g/activity/view/ActivityHallViewProxy","src/g/clearRes/ClearResM","src/g/activity/view/ActivityHallViewUIProxy"],function(t,e,n,s,i,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ACTIVITY_HALL_24,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_back.on(Laya.Event.CLICK,t,t.backHandler),t._uiProxy||(t._uiProxy=new h.ActivityHallViewUIProxy(t,t._pos),t._uiProxy.init()),t._contentProxy||(t._contentProxy=new r.ActivityHallViewProxy(t._pos,t.con_btn,t.con_page,t.bg.img_title),t._contentProxy.on(r.ActivityHallViewProxy.BTNS_INITED_EVENT,t,t.onBtnsUpdated)),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.backHandler=function(){this._contentProxy?this._contentProxy.backHandler()&&this.onCloseHandler():this.onCloseHandler()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._contentProxy.showView(),0<t?Laya.timer.frameOnce(3,this,this.openActivityById,[t]):this._uiProxy.checkBtnRedAndTurnTo(),s.ActivityManager.ins.isInited&&n.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),l.ClearResM.resetViewImg(this),o.E.ins.on(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){o.E.ins.off(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),l.ClearResM.clearFolderByUrl("dynamic/activity/"),l.ClearResM.clearResFolder("activity"),Laya.loader.clearRes(this.img_bg.skin)},t.prototype.onBtnsUpdated=function(){this._uiProxy&&this._uiProxy.onBtnsChanged()},t.prototype.openActivityById=function(t){if(this._uiProxy&&this._contentProxy){var e=this._uiProxy.findBtnByCfgId(t);e&&(this._contentProxy.selectActivityHandler(e.activityId),this._uiProxy.scrollToBtn(e))}},t}(ui.activity.ActivityHallView24UI);e.ActivityHallView24=c}),define("src/g/activity/view/ActivityHallView26",["require","exports","../../../manager/LayerManager","../../../manager/ActivityManager","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","src/g/activity/view/ActivityHallViewProxy","src/g/clearRes/ClearResM","src/g/activity/view/ActivityHallViewUIProxy"],function(t,e,n,s,i,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ACTIVITY_HALL_26,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_back.on(Laya.Event.CLICK,t,t.backHandler),t._uiProxy||(t._uiProxy=new h.ActivityHallViewUIProxy(t,t._pos),t._uiProxy.init()),t._contentProxy||(t._contentProxy=new r.ActivityHallViewProxy(t._pos,t.con_btn,t.con_page,t.bg.img_title),t._contentProxy.on(r.ActivityHallViewProxy.BTNS_INITED_EVENT,t,t.onBtnsUpdated)),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.backHandler=function(){this._contentProxy?this._contentProxy.backHandler()&&this.onCloseHandler():this.onCloseHandler()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._contentProxy.showView(),0<t?Laya.timer.frameOnce(3,this,this.openActivityById,[t]):this._uiProxy.checkBtnRedAndTurnTo(),s.ActivityManager.ins.isInited&&n.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),l.ClearResM.resetViewImg(this),o.E.ins.on(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){o.E.ins.off(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),l.ClearResM.clearFolderByUrl("dynamic/activity/"),l.ClearResM.clearResFolder("activity"),Laya.loader.clearRes(this.img_bg.skin)},t.prototype.onBtnsUpdated=function(){this._uiProxy&&this._uiProxy.onBtnsChanged()},t.prototype.openActivityById=function(t){if(this._uiProxy&&this._contentProxy){var e=this._uiProxy.findBtnByCfgId(t);e&&(this._contentProxy.selectActivityHandler(e.activityId),this._uiProxy.scrollToBtn(e))}},t}(ui.activity.ActivityHallView26UI);e.ActivityHallView26=c}),define("src/g/activity/view/ActivityHallView30",["require","exports","../../../manager/LayerManager","../../../manager/ActivityManager","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","src/g/activity/view/ActivityHallViewProxy","src/g/clearRes/ClearResM","src/g/activity/view/ActivityHallViewUIProxy"],function(t,e,n,s,i,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ACTIVITY_HALL_30,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_back.on(Laya.Event.CLICK,t,t.backHandler),t._uiProxy||(t._uiProxy=new h.ActivityHallViewUIProxy(t,t._pos),t._uiProxy.init()),t._contentProxy||(t._contentProxy=new r.ActivityHallViewProxy(t._pos,t.con_btn,t.con_page,t.bg.img_title),t._contentProxy.on(r.ActivityHallViewProxy.BTNS_INITED_EVENT,t,t.onBtnsUpdated)),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.backHandler=function(){this._contentProxy?this._contentProxy.backHandler()&&this.onCloseHandler():this.onCloseHandler()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._contentProxy.showView(),0<t?Laya.timer.frameOnce(3,this,this.openActivityById,[t]):this._uiProxy.checkBtnRedAndTurnTo(),s.ActivityManager.ins.isInited&&n.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),l.ClearResM.resetViewImg(this),o.E.ins.on(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){o.E.ins.off(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),l.ClearResM.clearFolderByUrl("dynamic/activity/"),l.ClearResM.clearResFolder("activity"),Laya.loader.clearRes(this.img_bg.skin)},t.prototype.onBtnsUpdated=function(){this._uiProxy&&this._uiProxy.onBtnsChanged()},t.prototype.openActivityById=function(t){if(this._uiProxy&&this._contentProxy){var e=this._uiProxy.findBtnByCfgId(t);e&&(this._contentProxy.selectActivityHandler(e.activityId),this._uiProxy.scrollToBtn(e))}},t}(ui.activity.ActivityHallView30UI);e.ActivityHallView30=c}),define("src/g/activity/view/ActivityHallView32",["require","exports","../../../manager/LayerManager","../../../manager/ActivityManager","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","src/g/activity/view/ActivityHallViewProxy","src/g/clearRes/ClearResM","src/g/activity/view/ActivityHallViewUIProxy"],function(t,e,n,s,i,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ACTIVITY_HALL_32,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_back.on(Laya.Event.CLICK,t,t.backHandler),t._uiProxy||(t._uiProxy=new h.ActivityHallViewUIProxy(t,t._pos),t._uiProxy.init()),t._contentProxy||(t._contentProxy=new r.ActivityHallViewProxy(t._pos,t.con_btn,t.con_page,t.bg.img_title),t._contentProxy.on(r.ActivityHallViewProxy.BTNS_INITED_EVENT,t,t.onBtnsUpdated)),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.backHandler=function(){this._contentProxy?this._contentProxy.backHandler()&&this.onCloseHandler():this.onCloseHandler()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._contentProxy.showView(),0<t?Laya.timer.frameOnce(3,this,this.openActivityById,[t]):this._uiProxy.checkBtnRedAndTurnTo(),s.ActivityManager.ins.isInited&&n.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),l.ClearResM.resetViewImg(this),o.E.ins.on(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){o.E.ins.off(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),l.ClearResM.clearFolderByUrl("dynamic/activity/"),l.ClearResM.clearResFolder("activity"),Laya.loader.clearRes(this.img_bg.skin)},t.prototype.onBtnsUpdated=function(){this._uiProxy&&this._uiProxy.onBtnsChanged()},t.prototype.openActivityById=function(t){if(this._uiProxy&&this._contentProxy){var e=this._uiProxy.findBtnByCfgId(t);e&&(this._contentProxy.selectActivityHandler(e.activityId),this._uiProxy.scrollToBtn(e))}},t}(ui.activity.ActivityHallView32UI);e.ActivityHallView32=c}),define("src/g/activity/view/ActivityHallView34",["require","exports","../../../manager/LayerManager","../../../manager/ActivityManager","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","src/g/activity/view/ActivityHallViewProxy","src/g/clearRes/ClearResM","src/g/activity/view/ActivityHallViewUIProxy"],function(t,e,n,s,i,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ACTIVITY_HALL_34,t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_back.on(Laya.Event.CLICK,t,t.backHandler),t._uiProxy||(t._uiProxy=new h.ActivityHallViewUIProxy(t,t._pos),t._uiProxy.init()),t._contentProxy||(t._contentProxy=new r.ActivityHallViewProxy(t._pos,t.con_btn,t.con_page,t.bg.img_title),t._contentProxy.on(r.ActivityHallViewProxy.BTNS_INITED_EVENT,t,t.onBtnsUpdated)),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.backHandler=function(){this._contentProxy?this._contentProxy.backHandler()&&this.onCloseHandler():this.onCloseHandler()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._contentProxy.showView(),0<t?Laya.timer.frameOnce(3,this,this.openActivityById,[t]):this._uiProxy.checkBtnRedAndTurnTo(),s.ActivityManager.ins.isInited&&n.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),l.ClearResM.resetViewImg(this),o.E.ins.on(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){o.E.ins.off(a.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),l.ClearResM.clearFolderByUrl("dynamic/activity/"),l.ClearResM.clearResFolder("activity"),Laya.loader.clearRes(this.img_bg.skin)},t.prototype.onBtnsUpdated=function(){this._uiProxy&&this._uiProxy.onBtnsChanged()},t.prototype.openActivityById=function(t){if(this._uiProxy&&this._contentProxy){var e=this._uiProxy.findBtnByCfgId(t);e&&(this._contentProxy.selectActivityHandler(e.activityId),this._uiProxy.scrollToBtn(e))}},t}(ui.activity.ActivityHallView34UI);e.ActivityHallView34=c}),define("src/g/activity/view/pages/ReturnGold0",["require","exports","src/init/TextConst","../../../../manager/RoleCenter","../../../net/messages/enumStatus","../../../net/messages/activity/ActivityGet","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../config/GameConfig","src/g/Effects/UIEffectsFactory","../../../../component/GAnimation","../../../../enum/FashionPos","../../../../utils/ItemUtils","../../../../manager/NewRedHintsCenter","../../../../utils/system/ServerTime","../../../../utils/system/FloatEffect","../../../../manager/AM","../../../../manager/GameSocketManager","../../../../utils/LayoutUtil"],function(t,e,a,l,s,o,r,h,c,u,p,d,g,i,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.isOpening=!1,t.isSDChanged=!1,t.isDDChanged=!1,t.isCDChanged=!1,t.curTime=0,t._lastBuyTime=0,t}return __extends(t,e),Object.defineProperty(t.prototype,"staticData",{get:function(){return this._staticData},set:function(t){this._staticData=t,this.isSDChanged=!0,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dynamicData",{get:function(){return this._dynamicData},set:function(t){this._dynamicData=t,this.isDDChanged=!0,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"commonData",{get:function(){return this._commonData},set:function(t){this._commonData=t,this.isCDChanged=!0,this.updateView()},enumerable:!0,configurable:!0}),t.prototype.showPage=function(){this.btn_get1.on(Laya.Event.CLICK,this,this.btnClick),this.btn_get2.on(Laya.Event.CLICK,this,this.btnClick),this.btn_get3.on(Laya.Event.CLICK,this,this.btnClick),this.isOpening=!0,this.updateView()},t.prototype.doDestroy=function(){this.btn_get1.off(Laya.Event.CLICK,this,this.btnClick),this.btn_get2.off(Laya.Event.CLICK,this,this.btnClick),this.btn_get3.off(Laya.Event.CLICK,this,this.btnClick),this.isOpening=!1},t.prototype.btnClick=function(t){switch(t.target){case this.btn_get1:this.checkCanBuy(1);break;case this.btn_get2:this.checkCanBuy(2);break;case this.btn_get3:this.checkCanBuy(3)}},t.prototype.checkCanBuy=function(t){if(Date.now()-this._lastBuyTime<1e3)f.FE.upItems(a.TextConst.get(258));else if(l.RoleCenter.instans.bagRoomEnough()){var e=this.dynamicData[t-1],i=this.staticData[t-1];if(e.isReward==s.enumStatus.weiwancheng)if(e.hasRMBNum>=i.rechargeNum)if(l.RoleCenter.instans.GOLD>=i.costNum)(n=new o.ActivityGetC2GS).id=this.commonData._activityId,n.activity2CfgId=i.cfgId,m.GSM.sendServer(n),this._lastBuyTime=Date.now();else y.AM.showGoldNotEnough(a.TextConst.get(460));else y.AM.showGoldNotEnough(a.TextConst.get(1183));else if(e.isReward==s.enumStatus.kelingqu){var n;if(this.curTime>e.returnTime)(n=new o.ActivityGetC2GS).id=this.commonData._activityId,n.activity2CfgId=i.cfgId,m.GSM.sendServer(n),this._lastBuyTime=Date.now()}}else y.AM.showBagNotEnough()},t.prototype.updateView=function(){if(this.isOpening){if(this.isSDChanged)for(var t=0;t<3;t++)this.setStaticData(t+1);if(this.isCDChanged&&this.setCommonData(),this.isDDChanged){this.isRedOpen=!1;for(t=0;t<3;t++)this.setDynamicData(t+1);this.checkRedOpen()}}},t.prototype.setStaticData=function(t){var e=this.staticData[t-1];this["img_title"+t].skin="dynamic/activity/recharge_rebate/"+e.imgTitleSkin+"_name.png",this["img_fight"+t].skin="dynamic/activity/recharge_rebate/"+e.imgFightSkin+"_fight.png",this["lab_rechargeNum"+t].text=e.rechargeNum,this["lab_returnDay"+t].text=e.returnDate,this["lab_returnNum"+t].text=e.returnNum,this["lab_btnNum"+t].text=e.costNum,this["box_icon"+t].removeChildren();for(var i=0;i<3;i++){var n=new ui.custom.Item0ViewUI;r.ItemCellUtils.fillCellForItem0View(n,e.iconList[i][0],Number(e.iconList[i][1])),h.ItemTips.cellShowTip(n,e.iconList[i][0],Number(e.iconList[i][1])),n.scaleX=n.scaleY=1==t?.8:.7,this["box_icon"+t].addChild(n)}this.checkBunusShowAni(e.iconList,t,e)&&(this["img_model"+t].skin="dynamic/activity/recharge_rebate"+e.mcSkin+".png");var s=new _.LayoutUtil;s.col=3,s.gapH=-10,s.gapV=0,s.setConLayout(this["box_icon"+t])},t.prototype.checkBunusShowAni=function(t,e,i){var n,s,o=t.length,a=0,r=!0;for(this["img_model"+e].visible=!0;a<o;){if(n=t[a][0],s=c.GameConfig.fashionJson[n]){this.loadFasionAni(s,this["mc_"+e]),r=this["img_model"+e].visible=!1;break}if(s=c.GameConfig.titleJSON[n]){this.loadTitleAni(s,this["mc_"+e]),r=this["img_model"+e].visible=!1;break}a++}if(r&&i.mcSkin&&-1!=i.mcSkin.indexOf("EUI")){var l=i.mcSkin.split("_");1<l.length&&u.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this["mc_"+e],Number(l[1]))}return this["mc_"+e].visible=!this["img_model"+e].visible,this["img_model"+e].visible},t.prototype.loadTitleAni=function(t,e){for(var i,n="dynamic2/chenghao/"+t.icon+".json",s=e.numChildren;0<s;)if(i=e.getChildAt(0)){i.stop(),i.clear();break}if(i){if(i._url&&i._url==n)return void i.play()}else(i=new p.GAnimation).isLoadedShow=!0,e.addChild(i);i.x=e.width/2,i.y=e.height/2,i.rotation=0,i.scale(1,1),i.load(n)},t.prototype.loadFasionAni=function(t,e){var i,n,s=l.RoleCenter.instans.vo.getSex(),o=e.numChildren,a=t.position;a==d.FashionPos.WING?n=0:a==d.FashionPos.WEAPON?n=1:a==d.FashionPos.FASHION&&(n=2);for(var r=g.ItemUtils.getAvtoarSource(t.res,n,s);0<o;)if(i=e.getChildAt(0)){i.stop(),i.clear();break}if(i){if(i._url&&i._url==r)return void i.play()}else(i=new p.GAnimation).isLoadedShow=!0,e.addChild(i);i.x=e.width/2,i.y=e.height/2,i.rotation=0,a==d.FashionPos.WING?i.scale(.7,.7):a==d.FashionPos.WEAPON?(i.scale(.6,.6),i.x+=50,i.y+=50):a==d.FashionPos.FASHION&&(i.y-=100,i.scale(.6,.6)),i.load(r)},t.prototype.setDynamicData=function(t){var e=this.dynamicData[t-1],i=this.staticData[t-1];e.hasRMBNum>i.rechargeNum?(this["lab_hasNum"+t].text="( 已达标 )",this["lab_hasNum"+t].color="#ffe466"):(this["lab_hasNum"+t].text="("+e.hasRMBNum+"/"+i.rechargeNum+")",this["lab_hasNum"+t].color="#ff4b4b"),e.isReward==s.enumStatus.yilingqu?(this["btn_get"+t].mouseEnabled=!1,this["btn_get"+t].gray=!0,this["btn_get"+t].label="已领取",this["img_btnGold"+t].visible=!1,this["lab_btnNum"+t].visible=!1,this["lab_btnText"+t].visible=!1,this.checkBtnAni(t,!0,!1)):e.isReward==s.enumStatus.kelingqu?this.curTime>e.returnTime?(this["btn_get"+t].mouseEnabled=!0,this["btn_get"+t].label="领取",this["img_btnGold"+t].visible=!1,this["lab_btnNum"+t].visible=!1,this["lab_btnText"+t].visible=!1,this.checkBtnAni(t,!0,!0)):(this["btn_get"+t].mouseEnabled=!1,this["btn_get"+t].gray=!0,this["btn_get"+t].label="已购买",this["img_btnGold"+t].visible=!1,this["lab_btnNum"+t].visible=!1,this["lab_btnText"+t].visible=!1,this.checkBtnAni(t,!0,!1)):e.isReward==s.enumStatus.weiwancheng&&(this.commonData.endTime<this.curTime?(this["btn_get"+t].mouseEnabled=!1,this["btn_get"+t].gray=!0,this["btn_get"+t].label="已结束",this["img_btnGold"+t].visible=!1,this["lab_btnNum"+t].visible=!1,this["lab_btnText"+t].visible=!1):(this["btn_get"+t].mouseEnabled=!0,this["btn_get"+t].label="",this["img_btnGold"+t].visible=!0,this["lab_btnNum"+t].visible=!0,this["lab_btnText"+t].visible=!0),this.checkBtnAni(t,!1,!1))},t.prototype.checkBtnAni=function(t,e,i){var n=this.dynamicData[t-1],s=this.staticData[t-1];if(i)return this.isRedOpen=!0,void(this["btnAni"+t]=u.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this["btn_get"+t],40));s.rechargeNum<n.hasRMBNum&&!e?(this.isRedOpen=!0,this["btnAni"+t]=u.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this["btn_get"+t],40)):this["btnAni"+t]&&(this["btn_get"+t].removeChild(this["btnAni"+t]),this["btnAni"+t]=null)},t.prototype.checkRedOpen=function(){this.isRedOpen?i.NewRedHintsCenter.ins.setRedHintOpenOrClose(i.enumRedHints.huodong_0yuangou,!0):i.NewRedHintsCenter.ins.setRedHintOpenOrClose(i.enumRedHints.huodong_0yuangou,!1)},t.prototype.setCommonData=function(){1<Math.abs(this.curTime-this.commonData.currentTime)&&(this.curTime=this.commonData.currentTime,Laya.timer.clearAll(this)),this.commonData.endTime<this.curTime?this.lab_countDown.text="已截止购买":(this.countDown(),Laya.timer.loop(1e3,this,this.countDown))},t.prototype.countDown=function(){var t=this.commonData.endTime-v.ServerTime.serverTime;if(t<0)return this.lab_countDown.text="已截止购买",void Laya.timer.clearAll(this);var e="",i=Math.floor(t/3600/24);0<i&&(e+=a.TextConst.get(8,i));var n=Math.floor(t%86400/3600);e+=""==e&&0==n?"":10<=n?a.TextConst.get(9,n):"0"+a.TextConst.get(9,n);var s=Math.floor(t%3600/60);e+=""==e&&0==s?"":10<=s?a.TextConst.get(11,s):"0"+a.TextConst.get(11,s);var o=t%60;e+=""==e&&0==o?"":10<=o?a.TextConst.get(13,o):"0"+a.TextConst.get(13,o),this.lab_countDown.text=e+"后结束购买"},t}(ui.activity.pages.ReturnGold0UI);e.ReturnGold0=n}),define("src/g/activity/view/ReturnGold0Ctrl",["require","exports","src/g/base/BaseCtrl","src/g/activity/view/pages/ReturnGold0","../../net/messages/OpResultGS2C","../../../core/E","../../../enum/EventName","../../net/messages/OpResultType","../../../manager/RoleCenter","../../../config/GameConfig","../../../utils/system/ServerTime","../../../manager/GameSocketManager"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t._activityId=0,t.isOpening=!1,t.commonData={},t.staticData=[],t.dynamicData=[],u.GSM.ins.on(s.OpResultGS2C.KEY,t,t.nextDayHandler),o.E.ins.on(a.EventName.ACTIVITY_DATA_CHANGED,t,t.onActivityDataChanged),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.isOpening=!1,this._view.removeSelf()},t.prototype.openPage=function(t,e){this._activityId=t,this.isOpening=!0,this._view||(this._view=new n.ReturnGold0,e.addChild(this._view)),this.showPage()},t.prototype.showPage=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),this.setData(),this._view.showPage()},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&this.getDynamicData()},t.prototype.nextDayHandler=function(t){t.msgidx==r.enumOpResultType.activity_nextDay&&Laya.timer.once(1e3,this,this.getDynamicData)},t.prototype.hidePage=function(){o.E.ins.off(a.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),u.GSM.ins.off(s.OpResultGS2C.KEY,this,this.nextDayHandler)},t.prototype.setData=function(){this.commonData._activityId=this._activityId,this.getStaticData(),this.getDynamicData()},t.prototype.getStaticData=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){for(var e=[],i=0;i<3;i++){var n=new d,s=t.children[i],o=h.GameConfig.subActivityJson[s.cfgId];n.cfgId=s.cfgId,n.mcSkin=o.image,n.costNum=o.cost[0][1],n.imgFightSkin=String(o.image),n.imgTitleSkin=String(o.image),n.rechargeNum=Math.floor(o.viplevel%1e6/100),n.returnDate=o.value,n.returnNum=o.originalcost[0][1],n.iconList=o.bonus,e.push(n)}this.staticData=e,this.commonData.startTime=t.startTime,this.commonData.endTime=t.endTime,this._view.commonData=this.commonData,this._view.staticData=this.staticData}},t.prototype.getDynamicData=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){for(var e=[],i=t.children.length,n=0;n<i;n++){var s=new d,o=t.children[n];s.isReward=o.status,s.returnTime=o.childCountArr[0],s.hasRMBNum=Math.floor(t.children[n].count/100),e.push(s)}this.dynamicData=e,this.commonData.currentTime=c.ServerTime.serverTime,this._view.commonData=this.commonData,this._view.dynamicData=this.dynamicData}},t.prototype.getActivityId=function(){return this._activityId},t.prototype.doDestroy=function(){},t.prototype.refresh=function(){this.showPage()},t}(i.BaseCtrl);e.ReturnGlod0Ctrl=p;var d=function(){};e.ReturnGold0VO=d}),define("src/g/activity/view/OneActivityHallView25",["require","exports","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","../../../manager/LayerManager","src/g/clearRes/ClearResM","../../../manager/ActivityManager","src/g/activity/view/ReturnGold0Ctrl","../../../manager/RoleCenter","../../../config/GameConfig"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t._pos=i.ActivityPos.ONE_ACTIVITY_HALL_25,t._currActivityId=0,t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),n.E.ins.on(s.EventName.ACTIVITY_HALL_LIST_CHANGED,t,t.changeHallHandler),t}return __extends(t,e),t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.changeHallHandler=function(t){t==this._pos&&this.displayedInStage&&this.updateContent()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),o.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),this.updateContent(),a.ClearResM.resetViewImg(this),n.E.ins.on(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){n.E.ins.off(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.updateContent=function(){var t=r.ActivityManager.ins.getActivityHallByPos(this._pos);if(t&&0<t.count){var e=t.getActivatedIds();e&&0<e.length&&(this._currActivityId=e[0],this.showActivityHandler(this._currActivityId))}else this._currPageCtrl&&(this._currPageCtrl.doDestroy(),this._currPageCtrl=null),this.displayedInStage&&this.onCloseHandler()},t.prototype.showActivityHandler=function(t){this._currPageCtrl&&(this._currPageCtrl.doDestroy(),this._currPageCtrl=null);var e=h.RoleCenter.instans.vo.getActivity1Data(t);e&&(c.GameConfig.activityJson[e.cfgId]&&(this._currPageCtrl=new l.ReturnGlod0Ctrl,this._currPageCtrl&&this._currPageCtrl.openPage(t,this.con_page)))},t}(ui.activity.OneActivityHallView25UI);e.OneActivityHallView25=u}),define("src/g/activity/view/FlashSaleHallView3",["require","exports","../../../enum/ActivityPos","../../../manager/ActivityManager","src/g/clearRes/ClearResM","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../../config/GameConfig","src/g/activity/view/ActivityPageFactroy","../../../manager/RunTimeUIManager","../../../utils/UIUtils"],function(t,e,i,n,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(s){function t(){var t=s.call(this)||this;return t._pos=i.ActivityPos.FLASH_SALE_HALL_3,t._currActivityId=0,t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),a.E.ins.on(r.EventName.ACTIVITY_HALL_LIST_CHANGED,t,t.changeHallHandler),t}return __extends(t,s),t.prototype.onCloseHandler=function(){this.close()},t.prototype.close=function(t,e){this.mouseEnabled=!1;var i,n=u.RunTimeUIManager.ins.getUI(278);n&&(i=p.UIUtils.getGlobalBound(n)),i?Laya.Tween.to(this,{x:i.x+i.width/2,y:i.y+i.height/2,scaleX:0,scaleY:0},200,null,Laya.Handler.create(this,s.prototype.close,[t,e])):s.prototype.close.call(this,t,e)},t.prototype.changeHallHandler=function(t){t==this._pos&&this.displayedInStage&&this.updateContent()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),n.ActivityManager.ins.isInited&&(this.mouseEnabled=!0,this.isPopup||this.popup(),this.updateContent(),o.ClearResM.resetViewImg(this),a.E.ins.on(r.EventName.CLOSEALLWINDOWS,this,this.closeClearRes))},t.prototype.closeClearRes=function(){a.E.ins.off(r.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),o.ClearResM.clearFolderByUrl("dynamic/activity/"),o.ClearResM.clearResFolder("activity"),o.ClearResM.clearFolderByUrl("res/activity/flash_sale")},t.prototype.updateContent=function(){var t=n.ActivityManager.ins.getActivityHallByPos(this._pos);if(t&&0<t.count){var e=t.getActivatedIds();e&&0<e.length&&(this._currActivityId=e[0],this.showActivityHandler(this._currActivityId))}else this._currPage&&(this._currPage.doDestroy(),this._currPage=null),this.isPopup&&this.close()},t.prototype.showActivityHandler=function(t){if(this._currPage){if(this._currPage.getActivityId()==t)return void this._currPage.refresh();this._currPage.doDestroy(),this._currPage=null}var e=l.RoleCenter.instans.vo.getActivity1Data(t);if(e){var i=h.GameConfig.activityJson[e.cfgId];i&&(this._currPage=c.ActivityPageFactroy.getActivityPage(i.clientkey),this._currPage&&this._currPage.showPage(t,this.con_page))}},t}(ui.activity.FlashSaleHallView3UI);e.FlashSaleHallView3=s}),define("src/g/activity/view/OneActivityHallView27",["require","exports","../../../enum/ActivityPos","../../../core/E","../../../enum/EventName","../../../manager/RunTimeUIManager","../../../utils/UIUtils","../../../manager/ActivityManager","src/g/clearRes/ClearResM","../../../manager/RoleCenter","../../../config/GameConfig","src/g/activity/view/ActivityPageFactroy"],function(t,e,i,n,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(s){function t(){var t=s.call(this)||this;return t._pos=i.ActivityPos.ONE_ACTIVITY_HALL_27,t._currActivityId=0,t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),n.E.ins.on(o.EventName.ACTIVITY_HALL_LIST_CHANGED,t,t.changeHallHandler),t}return __extends(t,s),t.prototype.onCloseHandler=function(){this.close()},t.prototype.close=function(t,e){this.mouseEnabled=!1;var i,n=a.RunTimeUIManager.ins.getUI(308);n&&(i=r.UIUtils.getGlobalBound(n)),i?Laya.Tween.to(this,{x:i.x+i.width/2,y:i.y+i.height/2,scaleX:0,scaleY:0},200,null,Laya.Handler.create(this,s.prototype.close,[t,e])):s.prototype.close.call(this,t,e)},t.prototype.changeHallHandler=function(t){t==this._pos&&this.displayedInStage&&this.updateContent()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),l.ActivityManager.ins.isInited&&(this.mouseEnabled=!0,this.isPopup||this.popup(),this.updateContent(),h.ClearResM.resetViewImg(this))},t.prototype.updateContent=function(){var t=l.ActivityManager.ins.getActivityHallByPos(this._pos);if(t&&0<t.count){var e=t.getActivatedIds();e&&0<e.length&&(this._currActivityId=e[0],this.showActivityHandler(this._currActivityId))}else this._currPage&&(this._currPage.doDestroy(),this._currPage=null),this.displayedInStage&&this.onCloseHandler()},t.prototype.showActivityHandler=function(t){if(this._currPage){if(this._currPage.getActivityId()==t)return void this._currPage.refresh();this._currPage.doDestroy(),this._currPage=null}var e=c.RoleCenter.instans.vo.getActivity1Data(t);if(e){var i=u.GameConfig.activityJson[e.cfgId];i&&(this._currPage=p.ActivityPageFactroy.getActivityPage(i.clientkey),this._currPage&&this._currPage.showPage(t,this.con_page))}},t}(ui.activity.OneActivityHallView27UI);e.OneActivityHallView27=s}),define("src/g/activity/ctrl/ActivityHallViewCtrl",["require","exports","src/init/Switches","../../../config/GameConfig","../../../enum/ActivityPos","src/g/activity/view/ActivityHallView","src/g/activity/view/FestivalActivityHallView","src/g/activity/view/ActivityHallView5","src/g/activity/view/ActivityHallView6","src/g/activity/view/ActivityHallView7","../../../manager/ActivityManager","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/g/activity/view/FlashSaleHallView","src/g/activity/view/AdvanceNoticeHallView","src/g/activity/view/OneActivityHallView","src/g/activity/view/OneActivityHallView11","src/g/activity/view/FlashSaleHallView2","src/g/activity/view/OneActivityHallView13","src/g/activity/view/OneActivityHallView14","src/g/activity/view/OneActivityHallView15","src/init/TextConst","src/g/activity/view/ActivityHallView16","src/g/activity/view/ActivityHallView17","src/g/activity/view/OneActivityHallView21","src/g/activity/view/OneActivityHallView23","src/g/activity/view/ActivityHallView20","src/g/activity/view/ActivityHallView22","src/g/activity/view/ActivityHallView24","src/g/activity/view/ActivityHallView26","src/g/activity/view/ActivityHallView30","src/g/activity/view/ActivityHallView32","src/g/activity/view/ActivityHallView34","src/g/activity/view/OneActivityHallView25","src/g/activity/view/FlashSaleHallView3","src/g/activity/view/OneActivityHallView27"],function(t,e,i,h,o,n,s,a,r,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E,T,A,R,L,x,P,k,D,H,M,G){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function l(){i.Switches.ins.on(8,this,this.onOpenHandler,[8]),i.Switches.ins.on(158,this,this.onOpenHandler,[158]),i.Switches.ins.on(159,this,this.onOpenHandler,[159]),i.Switches.ins.on(160,this,this.onOpenHandler,[160]),i.Switches.ins.on(161,this,this.onOpenHandler,[161]),i.Switches.ins.on(162,this,this.onOpenHandler,[162]),i.Switches.ins.on(164,this,this.onOpenHandler,[164]),i.Switches.ins.on(197,this,this.onOpenHandler,[197]),i.Switches.ins.on(278,this,this.onOpenHandler,[278]),i.Switches.ins.on(168,this,this.onOpenHandler,[168]),i.Switches.ins.on(187,this,this.onOpenHandler,[187]),i.Switches.ins.on(196,this,this.onOpenHandler,[196]),i.Switches.ins.on(204,this,this.onOpenHandler,[204]),i.Switches.ins.on(205,this,this.onOpenHandler,[205]),i.Switches.ins.on(206,this,this.onOpenHandler,[206]),i.Switches.ins.on(220,this,this.onOpenHandler,[220]),i.Switches.ins.on(221,this,this.onOpenHandler,[221]),i.Switches.ins.on(224,this,this.onOpenHandler,[224]),i.Switches.ins.on(225,this,this.onOpenHandler,[225]),i.Switches.ins.on(310,this,this.onOpenHandler,[310]),i.Switches.ins.on(308,this,this.onOpenHandler,[308]),i.Switches.ins.on(227,this,this.onOpenHandler,[227]),i.Switches.ins.on(228,this,this.onOpenHandler,[228]),i.Switches.ins.on(229,this,this.onOpenHandler,[229]),i.Switches.ins.on(230,this,this.onOpenHandler,[230]),i.Switches.ins.on(236,this,this.onOpenHandler,[236]),i.Switches.ins.on(237,this,this.onOpenHandler,[237]),i.Switches.ins.on(238,this,this.onOpenHandler,[238])}return l.prototype.onOpenHandler=function(t,e,i,n,s,o){if(void 0===i&&(i=!0),void 0===n&&(n=!1),void 0===s&&(s=0),void 0===o&&(o=null),e){if(8==t)if(0!=s){var a=h.GameConfig.activityJson[s];if(a){var r=l.pos2AccessId(a.pos);0!=r&&(t=r)}}else t=158;this.openHallView(t,i,n,s,o)}},l.pos2AccessId=function(t){switch(t){case o.ActivityPos.ACTIVITY_HALL:return 158;case o.ActivityPos.FESTIVAL_ACTIVITY_HALL:return 159;case o.ActivityPos.ACTIVITY_HALL_5:return 160;case o.ActivityPos.ACTIVITY_HALL_6:return 161;case o.ActivityPos.ACTIVITY_HALL_7:return 162;case o.ActivityPos.FLASH_SALE_HALL:return 164;case o.ActivityPos.FLASH_SALE_HALL_2:return 197;case o.ActivityPos.FLASH_SALE_HALL_3:return 278;case o.ActivityPos.ADVANCE_NOTICE_HALL:return 168;case o.ActivityPos.ONE_ACTIVITY_HALL:return 187;case o.ActivityPos.ONE_ACTIVITY_HALL_11:return 196;case o.ActivityPos.ONE_ACTIVITY_HALL_13:return 204;case o.ActivityPos.ONE_ACTIVITY_HALL_14:return 205;case o.ActivityPos.ONE_ACTIVITY_HALL_15:return 206;case o.ActivityPos.ACTIVITY_HALL_16:return 220;case o.ActivityPos.ACTIVITY_HALL_17:return 221;case o.ActivityPos.ONE_ACTIVITY_HALL_21:return 224;case o.ActivityPos.ONE_ACTIVITY_HALL_23:return 225;case o.ActivityPos.ACTIVITY_HALL_20:return 227;case o.ActivityPos.ACTIVITY_HALL_22:return 228;case o.ActivityPos.ACTIVITY_HALL_24:return 229;case o.ActivityPos.ACTIVITY_HALL_26:return 230;case o.ActivityPos.ACTIVITY_HALL_30:return 236;case o.ActivityPos.ACTIVITY_HALL_32:return 237;case o.ActivityPos.ACTIVITY_HALL_34:return 238;case o.ActivityPos.ONE_ACTIVITY_HALL_25:return 310;case o.ActivityPos.ONE_ACTIVITY_HALL_27:return 308}return 0},l.prototype.canOpen=function(t,e){void 0===e&&(e=!0);var i=u.ActivityManager.ins.getActivityHallByPos(t);return!!(i&&0<i.count)||(e&&p.FE.upItems(b.TextConst.get(209),d.BubbleEnum.Left),!1)},l.prototype.openHallView=function(t,e,i,n,s){void 0===e&&(e=!0),void 0===i&&(i=!1),void 0===n&&(n=0),void 0===s&&(s=null),158==t?this.canOpen(o.ActivityPos.ACTIVITY_HALL)&&this.onOpenHallDefault(e,i,n):159==t?this.canOpen(o.ActivityPos.FESTIVAL_ACTIVITY_HALL)&&this.onOpenHallFestival(e,i,n):160==t?this.canOpen(o.ActivityPos.ACTIVITY_HALL_5)&&this.onOpenHall5(e,i,n):161==t?this.canOpen(o.ActivityPos.ACTIVITY_HALL_6)&&this.onOpenHall6(e,i,n):162==t?this.canOpen(o.ActivityPos.ACTIVITY_HALL_7)&&this.onOpenHall7(e,i,n):164==t?this.canOpen(o.ActivityPos.FLASH_SALE_HALL)&&this.onOpenHallFlashSale(e,i,n):197==t?this.canOpen(o.ActivityPos.FLASH_SALE_HALL_2)&&this.onOpenHallFlashSale2(e,i,n):278==t?this.canOpen(o.ActivityPos.FLASH_SALE_HALL_3)&&this.onOpenHallFlashSale3(e,i,n):168==t?this.canOpen(o.ActivityPos.ADVANCE_NOTICE_HALL)&&this.onOpenHallAdvanceNotice(e,i,n,s):187==t?this.canOpen(o.ActivityPos.ONE_ACTIVITY_HALL)&&this.onOpenHallOneAct(e,i,n):196==t?this.canOpen(o.ActivityPos.ONE_ACTIVITY_HALL_11)&&this.onOpenHallOne11Act(e,i,n):204==t?this.canOpen(o.ActivityPos.ONE_ACTIVITY_HALL_13)&&this.onOpenHallOne13Act(e,i,n):205==t?this.canOpen(o.ActivityPos.ONE_ACTIVITY_HALL_14)&&this.onOpenHallOne14Act(e,i,n):206==t?this.canOpen(o.ActivityPos.ONE_ACTIVITY_HALL_15)&&this.onOpenHallOne15Act(e,i,n):220==t?this.canOpen(o.ActivityPos.ACTIVITY_HALL_16)&&this.onOpenHall16(e,i,n):221==t?this.canOpen(o.ActivityPos.ACTIVITY_HALL_17)&&this.onOpenHall17(e,i,n):224==t?this.canOpen(o.ActivityPos.ONE_ACTIVITY_HALL_21)&&this.onOpenHallOne21Act(e,i,n):225==t?this.canOpen(o.ActivityPos.ONE_ACTIVITY_HALL_23)&&this.onOpenHallOne23Act(e,i,n):310==t?this.canOpen(o.ActivityPos.ONE_ACTIVITY_HALL_25)&&this.onOpenHallOne25Act(e,i,n):308==t?this.canOpen(o.ActivityPos.ONE_ACTIVITY_HALL_27)&&this.onOpenHallOne27Act(e,i,n):227==t?this.canOpen(o.ActivityPos.ACTIVITY_HALL_20)&&this.onOpenHall20(e,i,n):228==t?this.canOpen(o.ActivityPos.ACTIVITY_HALL_22)&&this.onOpenHall22(e,i,n):229==t?this.canOpen(o.ActivityPos.ACTIVITY_HALL_24)&&this.onOpenHall24(e,i,n):230==t?this.canOpen(o.ActivityPos.ACTIVITY_HALL_26)&&this.onOpenHall26(e,i,n):236==t?this.canOpen(o.ActivityPos.ACTIVITY_HALL_30)&&this.onOpenHall30(e,i,n):237==t?this.canOpen(o.ActivityPos.ACTIVITY_HALL_32)&&this.onOpenHall32(e,i,n):238==t&&this.canOpen(o.ActivityPos.ACTIVITY_HALL_34)&&this.onOpenHall34(e,i,n)},l.prototype.onOpenHallDefault=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hallDefault||(this._hallDefault=new n.ActivityHallView),this._hallDefault.showView(i,t,e)},l.prototype.onOpenHallFestival=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hallFestival||(this._hallFestival=new s.FestivalActivityHallView),this._hallFestival.showView(i,t,e)},l.prototype.onOpenHall5=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hall5||(this._hall5=new a.ActivityHallView5),this._hall5.showView(i,t,e)},l.prototype.onOpenHall6=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hall6||(this._hall6=new r.ActivityHallView6),this._hall6.showView(i,t,e)},l.prototype.onOpenHall7=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hall7||(this._hall7=new c.ActivityHallView7),this._hall7.showView(i,t,e)},l.prototype.onOpenHallFlashSale=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hallFlashSale||(this._hallFlashSale=new g.FlashSaleHallView),this._hallFlashSale.showView(i,t,e)},l.prototype.onOpenHallFlashSale2=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hallFlashSale2||(this._hallFlashSale2=new m.FlashSaleHallView2),this._hallFlashSale2.showView(i,t,e)},l.prototype.onOpenHallFlashSale3=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hallFlashSale3||(this._hallFlashSale3=new M.FlashSaleHallView3),this._hallFlashSale3.showView(i,t,e)},l.prototype.onOpenHallAdvanceNotice=function(t,e,i,n){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),void 0===n&&(n=!1),this._hallAdvanceNotice||(this._hallAdvanceNotice=new v.AdvanceNoticeHallView),this._hallAdvanceNotice.showView(i,t,e,n)},l.prototype.onOpenHallOneAct=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hallOneAct||(this._hallOneAct=new f.OneActivityHallView),this._hallOneAct.showView(i,t,e)},l.prototype.onOpenHallOne11Act=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hallOneAct11||(this._hallOneAct11=new y.OneActivityHallView11),this._hallOneAct11.showView(i,t,e)},l.prototype.onOpenHallOne13Act=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hallOneAct13||(this._hallOneAct13=new _.OneActivityHallView13),this._hallOneAct13.showView(i,t,e)},l.prototype.onOpenHallOne14Act=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hallOneAct14||(this._hallOneAct14=new C.OneActivityHallView14),this._hallOneAct14.showView(i,t,e)},l.prototype.onOpenHallOne15Act=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hallOneAct15||(this._hallOneAct15=new I.OneActivityHallView15),this._hallOneAct15.showView(i,t,e)},l.prototype.onOpenHall16=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hall16||(this._hall16=new w.ActivityHallView16),this._hall16.showView(i,t,e)},l.prototype.onOpenHall17=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hall17||(this._hall17=new S.ActivityHallView17),this._hall17.showView(i,t,e)},l.prototype.onOpenHallOne21Act=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hallOneAct21||(this._hallOneAct21=new E.OneActivityHallView21),this._hallOneAct21.showView(i,t,e)},l.prototype.onOpenHallOne23Act=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hallOneAct23||(this._hallOneAct23=new T.OneActivityHallView23),this._hallOneAct23.showView(i,t,e)},l.prototype.onOpenHallOne25Act=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hallOneAct25||(this._hallOneAct25=new H.OneActivityHallView25),this._hallOneAct25.showView(i,t,e)},l.prototype.onOpenHallOne27Act=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hallOneAct27||(this._hallOneAct27=new G.OneActivityHallView27),this._hallOneAct27.showView(i,t,e)},l.prototype.onOpenHall20=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hall20||(this._hall20=new A.ActivityHallView20),this._hall20.showView(i,t,e)},l.prototype.onOpenHall22=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hall22||(this._hall22=new R.ActivityHallView22),this._hall22.showView(i,t,e)},l.prototype.onOpenHall24=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hall24||(this._hall24=new L.ActivityHallView24),this._hall24.showView(i,t,e)},l.prototype.onOpenHall26=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hall26||(this._hall26=new x.ActivityHallView26),this._hall26.showView(i,t,e)},l.prototype.onOpenHall30=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hall30||(this._hall30=new P.ActivityHallView30),this._hall30.showView(i,t,e)},l.prototype.onOpenHall32=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hall32||(this._hall32=new k.ActivityHallView32),this._hall32.showView(i,t,e)},l.prototype.onOpenHall34=function(t,e,i){void 0===t&&(t=!0),void 0===e&&(e=!1),void 0===i&&(i=0),this._hall34||(this._hall34=new D.ActivityHallView34),this._hall34.showView(i,t,e)},l.prototype.loadAtlasArr=function(t,e,i){void 0===i&&(i=4);for(var n=[],s=0;s<t.length;s++)n.push({url:t[s],type:Laya.Loader.ATLAS,priority:i});Laya.loader.load(n,e,null,null,i)},l}();e.ActivityHallViewCtrl=l}),define("src/g/auctions/ctrl/AuctionsData",["require","exports","../../../core/E","../../../enum/EventName","../../../utils/system/ServerTime","../../../config/GameConfig"],function(t,e,o,a,r,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function s(){this._data={},this.serverList=[],this.guildList=[],this.serverHistoryList=[],this.guildHistoryList=[],Laya.timer.loop(1e3,this,this.checkOverTime)}return Object.defineProperty(s,"ins",{get:function(){return this._ins||(this._ins=new s),this._ins},enumerable:!0,configurable:!0}),s.prototype.checkOverTime=function(){for(var t=this.serverList.length-1,e=0,i=r.ServerTime.serverTime,n=!1;0<=t;)e=this.serverList[t],this._data[e].endTime<i&&(delete this._data[e],this.serverList.splice(t,1),n=!0),t--;for(n&&o.E.ins.event(a.EventName.AUCTION_LIST_UPDATE,1),t=this.guildList.length-1,n=!1;0<=t;)e=this.guildList[t],this._data[e].endTime<i&&(delete this._data[e],this.guildList.splice(t,1),n=!0),t--;n&&o.E.ins.event(a.EventName.AUCTION_LIST_UPDATE,2)},s.prototype.initServerList=function(t){this.clearList(this.serverList),this.addListToList(t,this.serverList),o.E.ins.event(a.EventName.AUCTION_LIST_UPDATE,1)},s.prototype.addServerList=function(t){this.addListToList(t,this.serverList),o.E.ins.event(a.EventName.AUCTION_LIST_UPDATE,1)},s.prototype.initGuildList=function(t){this.clearList(this.guildList),this.addListToList(t,this.guildList),o.E.ins.event(a.EventName.AUCTION_LIST_UPDATE,2)},s.prototype.addGuildList=function(t){this.addListToList(t,this.guildList),o.E.ins.event(a.EventName.AUCTION_LIST_UPDATE,2)},s.prototype.clearGuildList=function(){this.clearList(this.guildList),o.E.ins.event(a.EventName.AUCTION_LIST_UPDATE,2)},s.prototype.addListToList=function(t,e){for(var i,n=t?t.length:0,s=0;s<n;)i=t[s],e.push(i.id),this._data[i.id]=i,s++},s.prototype.clearList=function(t){for(var e=t?t.length:0,i=0;i<e;)delete this._data[t[i]],i++;t&&(t.length=0)},s.prototype.updateItemData=function(t,e){var i=this._data[t.id];i?i.copydata(t):this._data[t.id]=t;var n=-1;1==e?-1==(n=s.ins.serverList.indexOf(t.id))?(s.ins.serverList.push(t.id),o.E.ins.event(a.EventName.AUCTION_LIST_UPDATE,1),-1!=(n=s.ins.guildList.indexOf(t.id))&&(s.ins.guildList.splice(n,1),o.E.ins.event(a.EventName.AUCTION_LIST_UPDATE,2))):o.E.ins.event(a.EventName.AUCTION_ITEM_UPDATE,[e,t.id]):2==e&&(-1==(n=s.ins.guildList.indexOf(t.id))?(s.ins.guildList.push(t.id),o.E.ins.event(a.EventName.AUCTION_LIST_UPDATE,2),-1!=(n=s.ins.serverList.indexOf(t.id))&&(s.ins.serverList.splice(n,1),o.E.ins.event(a.EventName.AUCTION_LIST_UPDATE,1))):o.E.ins.event(a.EventName.AUCTION_ITEM_UPDATE,[e,t.id]))},s.prototype.getTypeByItemId=function(t){var e=s.ins.serverList.indexOf(t);return-1!=e?1:-1!=(e=s.ins.guildList.indexOf(t))?2:-1},s.prototype.getItemDataById=function(t){return this._data[t]},s.prototype.delItemData=function(t,e){delete this._data[t];var i=-1;1==e?-1!=(i=s.ins.serverList.indexOf(t))?(s.ins.serverList.splice(i,1),o.E.ins.event(a.EventName.AUCTION_LIST_UPDATE,1)):-1!=(i=s.ins.guildList.indexOf(t))&&(s.ins.guildList.splice(i,1),o.E.ins.event(a.EventName.AUCTION_LIST_UPDATE,2)):2==e&&(-1!=(i=s.ins.guildList.indexOf(t))?(s.ins.guildList.splice(i,1),o.E.ins.event(a.EventName.AUCTION_LIST_UPDATE,2)):-1!=(i=s.ins.serverList.indexOf(t))&&(s.ins.serverList.splice(i,1),o.E.ins.event(a.EventName.AUCTION_LIST_UPDATE,1)))},Object.defineProperty(s.prototype,"attentionItemIds",{get:function(){var t;if(!this._attentionItemIds)for(var e in this._attentionItemIds=[],i.GameConfig.auctionsAttentionJson)(t=i.GameConfig.auctionsAttentionJson[e])&&this._attentionItemIds.push(t.itemid);return this._attentionItemIds},enumerable:!0,configurable:!0}),s}();e.AuctionsData=n}),define("src/g/auctions/view/AuctionPageItem",["require","exports","../../net/messages/auction/AuctionMsg","../../../utils/ItemCellUtils","../../../config/GameConfig","../../../manager/RoleCenter","../../../utils/system/ServerTime","../../../utils/system/DateUitl","../../../manager/GameSocketManager","src/init/Switches","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/g/auctions/ctrl/AuctionsData","src/g/bag/tips/view/ItemTips","src/init/TextConst"],function(t,e,o,h,c,u,p,i,a,r,l,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),Object.defineProperty(e.prototype,"dataSource",{set:function(t){this._dataSource=t,this.updateData()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currType",{set:function(t){this._currType=t,this.icon_logo.visible=!0,1==this._currType?this.icon_logo.skin="res/auctions/paimai_jiaobiao2.png":2==this._currType?this.icon_logo.skin="res/auctions/paimai_jiaobiao1.png":this.icon_logo.visible=!1},enumerable:!0,configurable:!0}),e.prototype.updateData=function(){this.item.offAll(),Laya.timer.clearAll(this);var t=this._dataSource;if(t){var e=c.GameConfig.auctionsJson[t.cfgId+"_"+t.count];h.ItemCellUtils.fillCellForItemNameView(this.item,e.itemid,t.count),this.item.on(Laya.Event.CLICK,this,function(){v.ItemTips.ins.showTip(e.itemid,t.count,t.equipArr?t.equipArr[0]:null)});var i=0<t.curPrice?t.curPrice:Number(e.price[0][1]);this.lab_curr_price.changeText(i.toString());var n,s=u.RoleCenter.instans.vo.username;u.RoleCenter.instans.ufVo.inFamily&&(n=u.RoleCenter.instans.ufVo._ufdata.familyUId),0<t.curPrice?(this.lab_state.visible=!0,this.lab_state.color="#04be00",this.lab_state.changeText(f.TextConst.get(239))):(this.lab_state.color="#fdbc30",this.lab_state.changeText(f.TextConst.get(240))),-1!=t.auctionUserArr.indexOf(s)&&(this.lab_state.visible=!0,t.curUsername==s?(this.lab_state.color="#04be00",this.lab_state.changeText(f.TextConst.get(241))):(this.lab_state.color="#ff0f15",this.lab_state.changeText(f.TextConst.get(242))));var o=c.GameConfig.auctionsSettingJson[1],a=0;this.icon_share.visible=this.lab_share_lab.visible=this.lab_share.visible=!1,0<t.curPrice&&t.familyId==n&&-1!=t.userArr.indexOf(s)&&(a=Math.floor(Math.floor(t.curPrice*(1-o.tax/100))/t.userArr.length),this.icon_share.visible=this.lab_share_lab.visible=this.lab_share.visible=!0,this.lab_share.changeText(a.toString()));var r=0;if(1==e.mode||2==e.mode?(this.btn_buy.on(Laya.Event.CLICK,this,this.doBuy),this.icon_price.visible=this.lab_price.visible=this.btn_buy.visible=!0,this.btn_buy.disabled=t.publicityTime>p.ServerTime.serverTime||p.ServerTime.serverTime>t.endTime,r=e.times[0][1],this.lab_price.changeText(r.toString())):this.icon_price.visible=this.lab_price.visible=this.btn_buy.visible=!1,1==e.mode||3==e.mode)if(this.btn_bid.on(Laya.Event.CLICK,this,this.doBid),this.btn_bid.visible=!0,t.curUsername==s)this.icon_bid_price.visible=this.lab_bid_price.visible=!1,this.btn_bid.disabled=!0;else{this.icon_bid_price.visible=this.lab_bid_price.visible=!0,this.btn_bid.disabled=t.publicityTime>p.ServerTime.serverTime||p.ServerTime.serverTime>t.endTime;var l=0;l=0<t.curPrice?Math.ceil(e.percent/100*Number(e.price[0][1])+i):Number(e.price[0][1]),0<r&&r<l&&(l=r),this.lab_bid_price.changeText(l.toString())}else this.icon_bid_price.visible=this.lab_bid_price.visible=this.btn_bid.visible=!1;t.publicityTime>p.ServerTime.serverTime?(this.lab_time_desc.changeText(f.TextConst.get(40,"")),this.waitTime=t.publicityTime,this.updateCD(),Laya.timer.once(1e3*(this.waitTime-p.ServerTime.serverTime),this,this.updateData)):(t.curUsername&&""!=t.curUsername?this.lab_time_desc.changeText(f.TextConst.get(41,"")):this.lab_time_desc.changeText(f.TextConst.get(42,"")),this.waitTime=t.endTime,this.updateCD(),this.waitTime>p.ServerTime.serverTime&&Laya.timer.once(1e3*(this.waitTime-p.ServerTime.serverTime),this,this.updateData))}},e.prototype.updateCD=function(){var t=this.waitTime-p.ServerTime.serverTime;0<t?(this.lab_cd.changeText(i.DateUtil.getHMS_countdown(t)),Laya.timer.once(1e3,this,this.updateCD)):this.lab_cd.changeText("00:00:00")},e.prototype.doBuy=function(){var t=this._dataSource;if(t){var e=c.GameConfig.auctionsJson[t.cfgId+"_"+t.count];if(0<e.vip&&u.RoleCenter.instans.vo.VIP<e.vip)return void l.FE.upItems(f.TextConst.get(279,e.vip),d.BubbleEnum.center);var i=e.times[0][1];if(u.RoleCenter.instans.vo[e.price[0][0]]<i)return void("GOLD"==e.price[0][0]?r.Switches.ins.event(155):l.FE.upItems(f.TextConst.get(280),d.BubbleEnum.center));var n=new o.GetAuctionItemMsg;n.type=g.AuctionsData.ins.getTypeByItemId(t.id),n.id=t.id,n.cfgId=e.itemid,n.count=t.count,n.getType=2,n.value=i,a.GSM.sendServer(n)}},e.prototype.doBid=function(){var t=this._dataSource;if(t){var e=c.GameConfig.auctionsJson[t.cfgId+"_"+t.count];if(0<e.vip&&u.RoleCenter.instans.vo.VIP<e.vip)return void l.FE.upItems(f.TextConst.get(279,e.vip),d.BubbleEnum.center);var i,n=e.times[0][1];if(i=0<t.curPrice?Math.ceil(e.percent/100*Number(e.price[0][1])+t.curPrice):Number(e.price[0][1]),u.RoleCenter.instans.vo[e.price[0][0]]<(n<i?n:i))return void("GOLD"==e.price[0][0]?r.Switches.ins.event(155):l.FE.upItems(f.TextConst.get(280),d.BubbleEnum.center));var s=new o.GetAuctionItemMsg;s.type=g.AuctionsData.ins.getTypeByItemId(t.id),s.id=t.id,s.cfgId=e.itemid,s.count=t.count,s.getType=1,s.value=i,a.GSM.sendServer(s)}},e}(ui.auctions.item.AuctionItemUI);e.AuctionPageItem=n}),define("src/g/auctions/view/FollowSettingDlg",["require","exports","../../../core/E","../../../enum/EventName","src/g/auctions/ctrl/AuctionsData","../../../utils/ItemUtils","../../../manager/RoleCenter","../../net/messages/auction/AuctionMsg","../../../manager/GameSocketManager","../../../meta/QualiyVo"],function(t,e,r,l,i,o,h,c,u,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.btn_close.on(Laya.Event.CLICK,t,t.doCloseHandler),t.list_item.scrollBar.elasticDistance=100,t.list_item.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t.closeHandler=new Laya.Handler(t,t.submitListHandler),t}return __extends(t,e),t.prototype.onListRenderHandler=function(t,e){var i=t.dataSource,n=o.ItemUtils.getItemOrEq(i);if(n&&(t.lab_name.changeText(n.name),t.lab_name.color=a.QualityStruct.Ins.getQColorById(n.quality)),h.RoleCenter.instans.vo.auctionData){var s=h.RoleCenter.instans.vo.auctionData.myAttention;t.check_select.selected=-1==s.indexOf(i)}},t.prototype.showDlg=function(){this.list_item.array=i.AuctionsData.ins.attentionItemIds,r.E.ins.on(l.EventName.MY_AUCTION_INFO_UPDATE,this,this.myInfoUpdated),this.popup()},t.prototype.myInfoUpdated=function(){this.list_item.refresh()},t.prototype.doCloseHandler=function(){this.close()},t.prototype.submitListHandler=function(){r.E.ins.off(l.EventName.MY_AUCTION_INFO_UPDATE,this,this.myInfoUpdated);for(var t,e=[],i=this.list_item.array.length,n=0;n<i;)(t=this.list_item.getCell(n))&&0==t.check_select.selected&&e.push(t.dataSource),n++;var s=h.RoleCenter.instans.vo.auctionData.myAttention;i=e.length,n=0;for(var o=!1;n<i;){if(-1==s.indexOf(e[n])){o=!0;break}n++}if(!o)for(i=s.length,n=0;n<i;){if(-1==e.indexOf(s[n])){o=!0;break}n++}if(o){h.RoleCenter.instans.vo.auctionData.myAttention=e,r.E.ins.event(l.EventName.MY_AUCTION_INFO_UPDATE);var a=new c.SetMyAttentionC2GS;a.myAttention=e,u.GSM.sendServer(a)}},t}(ui.auctions.FollowSettingUI);e.FollowSettingDlg=n}),define("src/g/auctions/view/MyBidRecordDlg",["require","exports","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../../utils/system/DateUitl","../../../config/GameConfig","../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.btn_close.on(Laya.Event.CLICK,t,t.doCloseHandler),t.list_item.scrollBar.elasticDistance=100,t.list_item.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t.closeHandler=new Laya.Handler(t,t.onCloseHandler),t}return __extends(t,e),t.prototype.onCloseHandler=function(){i.E.ins.off(n.EventName.MY_AUCTION_INFO_UPDATE,this,this.myInfoUpdated)},t.prototype.onListRenderHandler=function(t,e){var i=t.dataSource;if(t.item.offAll(),i){var n=a.GameConfig.auctionsJson[i.cfgId+"_"+i.count];n&&(r.ItemCellUtils.fillCellForItemNameView(t.item,n.itemid,i.count),t.item.on(Laya.Event.CLICK,this,function(){l.ItemTips.ins.showTip(n.itemid,i.count,i.equipArr?i.equipArr[0]:null)})),t.lab_price.changeText(i.price.toString()),t.lab_time.changeText(o.DateUtil.getYTD_hms(1e3*i.time))}},t.prototype.showDlg=function(){this.myInfoUpdated(),i.E.ins.on(n.EventName.MY_AUCTION_INFO_UPDATE,this,this.myInfoUpdated),this.popup()},t.prototype.myInfoUpdated=function(){s.RoleCenter.instans.vo.auctionData&&(this.list_item.array=s.RoleCenter.instans.vo.auctionData.historyList)},t.prototype.doCloseHandler=function(){this.close()},t}(ui.auctions.MyBidRecordUI);e.MyBidRecordDlg=h}),define("src/g/auctions/view/BidRecordDlg",["require","exports","src/g/auctions/ctrl/AuctionsData","../../../core/E","../../../enum/EventName","../../../config/GameConfig","../../../manager/RoleCenter","../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../utils/system/DateUitl","src/init/TextConst"],function(t,e,i,n,s,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t._currType=0,t.btn_close.on(Laya.Event.CLICK,t,t.doCloseHandler),t.list_item.scrollBar.elasticDistance=100,t.list_item.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t.closeHandler=new Laya.Handler(t,t.onCloseHandler),t}return __extends(t,e),t.prototype.onCloseHandler=function(){n.E.ins.off(s.EventName.AUCTION_HISTORY_LIST_UPDATE,this,this.updateList)},t.prototype.onListRenderHandler=function(t,e){var i=t.dataSource;if((t.item.offAll(),2==this._currType?t.img_logo.skin="res/auctions/paimai_jiaobiao1.png":t.img_logo.skin="res/auctions/paimai_jiaobiao2.png",i)&&(n=r.GameConfig.auctionsJson[i.cfgId+"_"+i.count])){if(h.ItemCellUtils.fillCellForItemNameView(t.item,n.itemid,i.count),t.item.on(Laya.Event.CLICK,this,function(){c.ItemTips.ins.showTip(n.itemid,i.count,i.equipArr?i.equipArr[0]:null)}),t.img_price.visible=t.lab_price.visible=!1,t.img_share.visible=t.lab_share.visible=!1,0==i.price){if(t.lab_player_name.color="#ff0f15",t.lab_time.color="#ff0f15",2==this._currType)t.lab_player_name.changeText(p.TextConst.get(281));else if(t.lab_player_name.changeText(p.TextConst.get(282)),-1!=i.userArr.indexOf(a)){var n=r.GameConfig.auctionsJson[i.cfgId+"_"+i.count],s=r.GameConfig.auctionsSettingJson[1],o=Math.floor(Math.floor(Number(n.price[0][1])*(1-s.tax/100))/i.userArr.length);t.lab_share.changeText(o.toString()),t.img_share.visible=t.lab_share.visible=!0}}else{t.lab_time.color="#09d51f",t.lab_player_name.color="#fdbc30",t.img_price.visible=t.lab_price.visible=!0,t.lab_player_name.changeText(i.nickname),t.lab_price.changeText(i.price.toString());var a=l.RoleCenter.instans.vo.username;if(-1!=i.userArr.indexOf(a)){s=r.GameConfig.auctionsSettingJson[1],o=Math.floor(Math.floor(i.price*(1-s.tax/100))/i.userArr.length);t.lab_share.changeText(o.toString()),t.img_share.visible=t.lab_share.visible=!0}}t.htxt_time.style.color="#09d51f",t.htxt_time.style.font="SimHei",t.htxt_time.style.fontSize=18,t.htxt_time.style.align="center",t.htxt_time.innerHTML=u.DateUtil.getYTD_hms(1e3*i.time,"y/t/d<br>(h:m:s)")}},t.prototype.showDlg=function(t){this._currType=t,this.updateList(),n.E.ins.on(s.EventName.AUCTION_HISTORY_LIST_UPDATE,this,this.updateList),this.popup()},t.prototype.updateList=function(){var t;1==this._currType?t=i.AuctionsData.ins.serverHistoryList.concat():2==this._currType&&(t=i.AuctionsData.ins.guildHistoryList.concat()),this.list_item.array=t.reverse()},t.prototype.doCloseHandler=function(){this.close()},t}(ui.auctions.BidRecordUI);e.BidRecordDlg=o}),define("src/g/auctions/view/AuctionsPage",["require","exports","src/g/auctions/ctrl/AuctionsData","../../../config/GameConfig","src/g/auctions/view/AuctionPageItem","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../../utils/system/ServerTime","src/g/auctions/view/FollowSettingDlg","src/g/auctions/view/MyBidRecordDlg","src/g/auctions/view/BidRecordDlg"],function(t,e,h,c,a,i,n,u,p,s,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(o){function t(){var t=o.call(this)||this;t._currFilterType=0,t._currShowType=2;var e=c.GameConfig.auctionsSettingJson[1].typeLabels,i=e?e.length:0,n=0;t.typefilterArr=[];for(var s=[];n<i;)t.typefilterArr[n]=Number(e[n][0]),s[n]=e[n][1],n++;return t.combo_type.labels=s.join(","),t.combo_type.selectedLabel=s[0],t.combo_type.selectHandler=new Laya.Handler(t,t.onFilterSelected),t.lab_my_focus.on(Laya.Event.CLICK,t,t.openMyFocusSetting),t.list_main.itemRender=a.AuctionPageItem,t.list_main.scrollBar.elasticDistance=100,t.list_main.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t.btn_record.on(Laya.Event.CLICK,t,t.openRecordHandler),t.check_share_out.on(Laya.Event.CLICK,t,t.onShareOutFilter),t}return __extends(t,o),t.prototype.startListen=function(){i.E.ins.on(n.EventName.AUCTION_LIST_UPDATE,this,this.onListDataUpdated),i.E.ins.on(n.EventName.AUCTION_ITEM_UPDATE,this,this.onItemDataUpdated),i.E.ins.on(n.EventName.MY_AUCTION_INFO_UPDATE,this,this.myInfoUpdated)},t.prototype.stopListen=function(){i.E.ins.off(n.EventName.AUCTION_LIST_UPDATE,this,this.onListDataUpdated),i.E.ins.off(n.EventName.AUCTION_ITEM_UPDATE,this,this.onItemDataUpdated),i.E.ins.off(n.EventName.MY_AUCTION_INFO_UPDATE,this,this.myInfoUpdated)},t.prototype.onListDataUpdated=function(t){this._currShowType!=t&&3!=this._currShowType||this.updateList(),this.calculateShareOut()},t.prototype.onItemDataUpdated=function(t,e){this._currShowType!=t&&3!=this._currShowType||this.list_main.refresh(),this.calculateShareOut()},t.prototype.calculateShareOut=function(){var t,e=u.RoleCenter.instans.vo.username;u.RoleCenter.instans.ufVo.inFamily&&(t=u.RoleCenter.instans.ufVo._ufdata.familyUId);for(var i,n=h.AuctionsData.ins.serverList?h.AuctionsData.ins.serverList.length:0,s=0,o=0,a=0,r=c.GameConfig.auctionsSettingJson[1];s<n;)a=h.AuctionsData.ins.serverList[s],i=h.AuctionsData.ins.getItemDataById(a),c.GameConfig.auctionsJson[i.cfgId+"_"+i.count],0<i.curPrice&&i.familyId==t&&-1!=i.userArr.indexOf(e)&&(o+=Math.floor(Math.floor(i.curPrice*(1-r.tax/100))/i.userArr.length)),s++;for(n=h.AuctionsData.ins.guildList?h.AuctionsData.ins.guildList.length:0,s=0;s<n;)a=h.AuctionsData.ins.guildList[s],i=h.AuctionsData.ins.getItemDataById(a),c.GameConfig.auctionsJson[i.cfgId+"_"+i.count],0<i.curPrice&&i.familyId==t&&-1!=i.userArr.indexOf(e)&&(o+=Math.floor(Math.floor(i.curPrice*(1-r.tax/100))/i.userArr.length)),s++;this.lab_expect.changeText(o.toString())},t.prototype.myInfoUpdated=function(){u.RoleCenter.instans.vo.auctionData&&this.lab_hava.changeText(u.RoleCenter.instans.vo.auctionData.fenhong.toString())},t.prototype.onFilterSelected=function(t){t<this.typefilterArr.length&&(this._currFilterType=this.typefilterArr[t],this.updateList())},t.prototype.onSwitchList=function(t){this.box_info.visible=!0,0==t?this._currShowType=2:1==t?this._currShowType=1:2==t&&(this.box_info.visible=!1,this._currShowType=3),this.updateList()},t.prototype.onShareOutFilter=function(){this.updateList()},t.prototype.showPage=function(){this.updateList(),this.myInfoUpdated(),this.calculateShareOut(),this.startListen()},t.prototype.hidePage=function(){this.stopListen()},t.prototype.updateList=function(){var t;1==this._currShowType?t=h.AuctionsData.ins.serverList:2==this._currShowType?t=h.AuctionsData.ins.guildList:3==this._currShowType&&(t=h.AuctionsData.ins.guildList.concat(h.AuctionsData.ins.serverList));var e,i,n,s=t?t.length:0,o=0,a=u.RoleCenter.instans.vo.username;u.RoleCenter.instans.ufVo.inFamily&&(i=u.RoleCenter.instans.ufVo._ufdata.familyUId);for(var r=[],l=0;o<s;)if(l=t[o],(e=h.AuctionsData.ins.getItemDataById(l)).endTime<p.ServerTime.serverTime)o++;else{if(3==this._currShowType){if(-1==e.auctionUserArr.indexOf(a)){o++;continue}}else if(this.check_share_out.selected&&(e.familyId!=i||-1==e.userArr.indexOf(a))){o++;continue}0!=this._currFilterType&&(n=c.GameConfig.auctionsJson[e.cfgId+"_"+e.count])&&n.type!=this._currFilterType||r.push(e),o++}this.img_no_item.visible=r.length<1,this.list_main.array=r},t.prototype.openMyFocusSetting=function(){this._settingDlg||(this._settingDlg=new s.FollowSettingDlg),this._settingDlg.showDlg()},t.prototype.openRecordHandler=function(){3==this._currShowType?(this._myBidDlg||(this._myBidDlg=new r.MyBidRecordDlg),this._myBidDlg.showDlg()):(this._bidDlg||(this._bidDlg=new l.BidRecordDlg),this._bidDlg.showDlg(this._currShowType))},t.prototype.onListRenderHandler=function(t,e){t.currType=this._currShowType},t}(ui.auctions.page.AuctionPageUI);e.AuctionsPage=o}),define("src/g/auctions/view/AuctionsView",["require","exports","../../../manager/LayerManager","src/g/auctions/view/AuctionsPage"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t._page=new n.AuctionsPage,t.bg.box_page.addChild(t._page),t.bg.btn_back.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.tab_page.selectHandler=new Laya.Handler(t,t.onSelectHandler),t}return __extends(t,e),t.prototype.showView=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),i.LayerManager.addInPOPWindowLayer(this,t,!0,!0,!1,e),this._page.showPage(),this.tab_page.selectedIndex=0},t.prototype.onSelectHandler=function(t){this._page.onSwitchList(t)},t.prototype.onCloseHandler=function(){this.removeSelf(),this._page.hidePage()},t}(ui.auctions.AuctionsViewUI);e.AuctionsView=s}),define("src/g/auctions/ctrl/AuctionsViewCtrl",["require","exports","src/init/Switches","src/g/auctions/view/AuctionsView","../../../manager/GameSocketManager","../../net/messages/auction/AuctionMsg","src/g/auctions/ctrl/AuctionsData","../../../manager/RoleCenter","../../net/messages/auction/AuctionData","../../../core/E","../../../enum/EventName","../../../config/GameConfig","../../../manager/NewRedHintsCenter","../../../runtime/resload/GameResLoad"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(){function t(){i.Switches.ins.on(166,this,this.onOpenIdHandler),s.GSM.ins.on(o.AuctionListGS2C.KEY,this,this.onAuctionListUpdated),s.GSM.ins.on(o.AuctionItemChgGS2C.KEY,this,this.onAuctionItemChanged),s.GSM.ins.on(o.AuctionHistoryListGS2C.KEY,this,this.onAuctionHistoryListUpdated),s.GSM.ins.on(o.GetAuctionItemMsg.KEY,this,this.onGetAuctionItemBack),s.GSM.ins.on(l.AuctionData.KEY,this,this.onMyAuctionDataUpdated),s.GSM.ins.on(o.AuctionHistoryData.KEY,this,this.onAddHistoryBack),this.startListenRed(),h.E.ins.on(c.EventName.SOCIETY_LEAVE,this,this.onGuildLeaveHandler),h.E.ins.on(c.EventName.SOCIETY_JOIN,this,this.onGuildJoinHandler)}return t.prototype.onGuildLeaveHandler=function(){a.AuctionsData.ins.clearGuildList()},t.prototype.onGuildJoinHandler=function(){s.GSM.sendServer(new o.GetFamilyAuctionListDataC2GS)},t.prototype.startListenRed=function(){h.E.ins.on(c.EventName.AUCTION_LIST_UPDATE,this,this.updateRed),h.E.ins.on(c.EventName.AUCTION_ITEM_UPDATE,this,this.updateRed),h.E.ins.on(c.EventName.MY_AUCTION_INFO_UPDATE,this,this.updateRed)},t.prototype.updateRed=function(){for(var t,e,i=a.AuctionsData.ins.serverList?a.AuctionsData.ins.serverList.length:0,n=0,s=0,o=!1;n<i;){if(s=a.AuctionsData.ins.serverList[n],t=a.AuctionsData.ins.getItemDataById(s),e=u.GameConfig.auctionsJson[t.cfgId+"_"+t.count],-1!=a.AuctionsData.ins.attentionItemIds.indexOf(e.itemid)&&-1==r.RoleCenter.instans.vo.auctionData.myAttention.indexOf(e.itemid)){o=!0;break}n++}for(p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.auctions_server,o),o=!1,i=a.AuctionsData.ins.guildList?a.AuctionsData.ins.guildList.length:0,n=0;n<i;){if(s=a.AuctionsData.ins.guildList[n],t=a.AuctionsData.ins.getItemDataById(s),e=u.GameConfig.auctionsJson[t.cfgId+"_"+t.count],-1!=a.AuctionsData.ins.attentionItemIds.indexOf(e.itemid)&&-1==r.RoleCenter.instans.vo.auctionData.myAttention.indexOf(e.itemid)){o=!0;break}n++}p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.auctions_guild,o)},t.prototype.onOpenIdHandler=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),t&&this.onOpenHandler(e,i)},t.prototype.onOpenHandler=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),this._view||(d.GameResLoad.load("res/atlas/res/auctions.json"),this._view=new n.AuctionsView),this._view.showView(t,e)},t.prototype.onAuctionListUpdated=function(t){1==t.type?a.AuctionsData.ins.initServerList(t.itemList):2==t.type?a.AuctionsData.ins.initGuildList(t.itemList):3==t.type?a.AuctionsData.ins.addGuildList(t.itemList):4==t.type&&a.AuctionsData.ins.addServerList(t.itemList)},t.prototype.onAuctionItemChanged=function(t){a.AuctionsData.ins.updateItemData(t.itemData,t.type)},t.prototype.onAuctionHistoryListUpdated=function(t){1==t.type?(a.AuctionsData.ins.serverHistoryList=t.historyList,h.E.ins.event(c.EventName.AUCTION_HISTORY_LIST_UPDATE,t.type)):2==t.type?(a.AuctionsData.ins.guildHistoryList=t.historyList,h.E.ins.event(c.EventName.AUCTION_HISTORY_LIST_UPDATE,t.type)):3==t.type?(a.AuctionsData.ins.guildHistoryList=a.AuctionsData.ins.guildHistoryList.concat(t.historyList),h.E.ins.event(c.EventName.AUCTION_HISTORY_LIST_UPDATE,2)):4==t.type&&(a.AuctionsData.ins.serverHistoryList=a.AuctionsData.ins.serverHistoryList.concat(t.historyList),h.E.ins.event(c.EventName.AUCTION_HISTORY_LIST_UPDATE,1))},t.prototype.onGetAuctionItemBack=function(t){var e=u.GameConfig.auctionsJson[t.cfgId+"_"+t.count];e&&(r.RoleCenter.instans.vo[e.price[0][0]]-=t.value,r.RoleCenter.instans.event(c.EventName.ROLE_PROP_CHANGE))},t.prototype.onMyAuctionDataUpdated=function(t){r.RoleCenter.instans.vo.auctionData.copydata(t),h.E.ins.event(c.EventName.MY_AUCTION_INFO_UPDATE)},t.prototype.onAddHistoryBack=function(t){1==t.type?(a.AuctionsData.ins.serverHistoryList||(a.AuctionsData.ins.serverHistoryList=[]),a.AuctionsData.ins.serverHistoryList.push(t),h.E.ins.event(c.EventName.AUCTION_HISTORY_LIST_UPDATE,t.type)):2==t.type&&(a.AuctionsData.ins.guildHistoryList||(a.AuctionsData.ins.guildHistoryList=[]),a.AuctionsData.ins.guildHistoryList.push(t),h.E.ins.event(c.EventName.AUCTION_HISTORY_LIST_UPDATE,t.type))},t}();e.AuctionsViewCtrl=g}),define("src/g/worldboss/vo/WPortStatusVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.STATUS_OPENED=1,t.STATUS_WAIT=2,t.STATUS_CLOSED=3,t}();e.WPortStatusVo=i}),define("src/g/worldboss/view/WorlBossView",["require","exports","../../../manager/LayerManager","../../../utils/StringUtils","src/g/worldboss/vo/WPortStatusVo","../../../component/GAnimation","../../../utils/ItemUtils","src/g/clearRes/ClearResM","src/g/account/view/AccItem","src/g/fight/base/RES","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t.bgview.btn_help.visible=!1,t.bgview.img_title.skin="res/title/rexue_biaotishijieboss.png",t.initHtmlStyle(t.detailRankButton,"#09d51f",16),t.detailRankButton.innerHTML=c.TextConst.get(861),t.initList(t.oldRankList,ui.worldboss.WorldBossCtrRankItemUI,new Laya.Handler(t,t.rankItemRenderHander)),t.initList(t.portList,ui.worldboss.WorldBossPortUI,new Laya.Handler(t,t.portItemRenderHander)),t.initList(t.rewardList,l.AccItem,new Laya.Handler(t,t.rewardItemRenderHander)),t.initHtmlStyle(t.helpDes,"#a89e8f",18),t.animation=new o.GAnimation,t.animation.x=190,t.animation.y=450,t.animation.mouseEnabled=!1,t}return __extends(t,e),t.prototype.initList=function(t,e,i){t.itemRender=e,t.vScrollBarSkin="",t.scrollBar.elasticDistance=0,t.renderHandler=i,t.selectEnable=!0,t.array=[]},t.prototype.initHtmlStyle=function(t,e,i){t.style.color=e,t.style.font="SimHei",t.style.fontSize=i},t.prototype.rankItemRenderHander=function(t,e){var i=t.dataSource;switch(e){case 0:t.imgRank.skin="res/hotbloodtemple/rxsd_paihangtubiao1.png";break;case 1:t.imgRank.skin="res/hotbloodtemple/rxsd_paihangtubiao2.png";break;case 2:t.imgRank.skin="res/hotbloodtemple/rxsd_paihangtubiao3.png";break;default:t.imgRank.skin=""}t.lbName.text=i.fname,t.lbHurt.text=n.StringUtils.moneyNumToString(i.totalHurt)},t.prototype.portItemRenderHander=function(t,e){var i=t.dataSource;t.lbName.text=i.portVo.name,t.imgKilled.visible=i.status==s.WPortStatusVo.STATUS_CLOSED,i.status==s.WPortStatusVo.STATUS_OPENED?(t.lbFuHuo.visible=!0,t.fuhuoTime.visible=!1):(t.fuhuoTime.visible=!0,t.lbFuHuo.visible=!1,this.initHtmlStyle(t.fuhuoTime,"#a89e8f",16),t.fuhuoTime.style.align="center",t.fuhuoTime.innerHTML=this.createFuHuoDes(i))},t.prototype.createFuHuoDes=function(t){return c.TextConst.get(860,t.portVo.opentime[0],0==t.portVo.opentime[1]?"00":t.portVo.opentime[1])},t.prototype.onPortSelected=function(t,e){-1!=t&&(this.imgSelected.y=86*t+270,this.refreshMonster(e))},t.prototype.refreshMonster=function(t){var e=a.ItemUtils.getMonsterVOById(a.ItemUtils.getPortVoById(t).boss[0]);this.bossName.text=e.name,-1==e.moResVo.dir.indexOf(5)?(this.murl=h.RES.MONSTER_PATH+e.moResVo.res+"/3_s.json",this.dir=-1):(this.dir=1,this.murl=h.RES.MONSTER_PATH+e.moResVo.res+"/5_s.json"),this.animationScale=e.zoom,Laya.loader.load(this.murl,Laya.Handler.create(this,this.onAnimationLoaded),null,Laya.Loader.ATLAS),r.ClearResM.setCachUrl(this.murl)},t.prototype.onAnimationLoaded=function(){null!=this.animation&&(this.animation.clear(!1),this.animation.load(this.murl),this.animation.scale(this.animationScale*this.dir,this.animationScale))},t.prototype.rewardItemRenderHander=function(t,e){t.eqData=t.dataSource},t.prototype.showView=function(){this.addChild(this.animation),i.LayerManager.addInPOPWindow(this)},t.prototype.hideView=function(){},t.prototype.destroyView=function(){this.animation.stop(),this.animation.removeSelf(),this.animation=null,this.destroy(!0)},t}(ui.worldboss.WorldBossViewUI);e.WorlBossView=u}),define("src/g/worldboss/view/WorldBossRankPanel",["require","exports","../../../utils/StringUtils"],function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.bg.btn_close.visible=!1,t.initList(t.list_rank,ui.worldboss.WorldBossRankItemUI,new Laya.Handler(t,t.onRenderListHandler)),t}return __extends(t,e),t.prototype.showView=function(){this.popup()},t.prototype.initList=function(t,e,i){t.itemRender=e,t.vScrollBarSkin="",t.scrollBar.elasticDistance=0,t.renderHandler=i,t.array=[]},t.prototype.onRenderListHandler=function(t,e){var i=t.dataSource;t.lab_rank.changeText((e+1).toString()),t.lbFamilyName.changeText(i.fname),t.lbHurt.text=n.StringUtils.moneyNumToString(i.totalHurt)},t}(ui.worldboss.WorldBossRankDlgUI);e.WorldBossRankPanel=i}),define("src/g/worldboss/ctrl/WorlBossCtrl",["require","exports","src/init/Switches","src/g/worldboss/view/WorlBossView","src/g/base/BaseCtrl","../../../config/GameConfig","src/g/worldboss/vo/WPortStatusVo","../../../utils/system/ServerTime","src/g/fight/osprite/play/worldboss/WorldBossManager","../../../utils/SoundUtils","../../../utils/ItemDropUtil","../../net/messages/WorldBossMsg","../../../core/E","../../../enum/EventName","src/g/worldboss/view/WorldBossRankPanel","../../../manager/GameSocketManager"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(e){function t(){var t=e.call(this)||this;return t._opened=!1,t.url="res/atlas/res/worldboss.json",i.Switches.ins.on(184,t,t.openHandler),p.E.ins.on(d.EventName.WORLDBOSS_BOSS_COMMING,t,t.onActivityStart),p.E.ins.on(d.EventName.WORLDBOSS_BOSS_DIE,t,t.onActivityEnd),t}return __extends(t,e),t.prototype.openHandler=function(){this._opened=!0,this.rankData={},v.GSM.ins.on(u.WorldBossFamilyRankGS2C.KEY,this,this.onWorldBossFamilyRankGS2C),l.WorldBossManager.getInstance().reqLastRank(0),this.open()},t.prototype.onAtlasLoaded=function(){this._opened?this.initview():Laya.loader.clearRes(this.url)},t.prototype.initview=function(){if(!this._view){this._view=new n.WorlBossView,this._view.bgview.btn_close.on(Laya.Event.CLICK,this,this.closeHander),this._view.bgview.btn_back.on(Laya.Event.CLICK,this,this.closeHander),this._view.portList.selectHandler=new Laya.Handler(this,this.onPortSelected),this._view.btn_fihgt.on(Laya.Event.CLICK,this,this.startFightHander),this._view.detailRankButton.on(Laya.Event.CLICK,this,this.openRankHander);var t=o.GameConfig.Ruledesc[22];this._view.helpDes.innerHTML=t.tmptext}this._view.showView(),this._view.on(Laya.Event.REMOVED,this,this.onRemovedHander),null==this.portDataList&&this.initPortData(),this.updPortStatus(),this.updPortDisplay()},t.prototype.initPortData=function(){var t,e;for(var i in this.portDataList=[],o.GameConfig.worldBossVo)t=o.GameConfig.worldBossVo[i],(e=new a.WPortStatusVo).portVo=t,this.portDataList.push(e)},t.prototype.updPortStatus=function(){for(var t=new Date(1e3*r.ServerTime.serverTime),e=this.portDataList,i=0;i<e.length;i++){var n=e[i],s=n.portVo;-1==l.WorldBossManager.getInstance().openId?s.opentime[0]>=t.getHours()&&s.opentime[1]>t.getMinutes()?n.status=a.WPortStatusVo.STATUS_WAIT:n.status=a.WPortStatusVo.STATUS_CLOSED:l.WorldBossManager.getInstance().openId==s.id?n.status=a.WPortStatusVo.STATUS_OPENED:s.id>l.WorldBossManager.getInstance().openId?n.status=a.WPortStatusVo.STATUS_WAIT:n.status=a.WPortStatusVo.STATUS_CLOSED}},t.prototype.updPortDisplay=function(){this.portDataList.sort(this.portSortMethod),this._view.portList.array=this.portDataList,this._view.portList.selectedIndex=0},t.prototype.portSortMethod=function(t,e){return t.status-e.status},t.prototype.onPortSelected=function(t){if(-1!=t){h.SoundUtils.getInstance().playBtnsounds();var e=this.portDataList[t];this.selectedPort=e.portVo.id,this._view.onPortSelected(t,e.portVo.port),this._view.rewardList.array=c.ItemDropUtil.createPortRewardData(e.portVo.rewardshow),this._view.btn_fihgt.disabled=e.status!=a.WPortStatusVo.STATUS_OPENED,null!=this.rankData[e.portVo.id]?this.updTop3Rank(this.rankData[e.portVo.id]):this.updTop3Rank(null)}},t.prototype.onWorldBossFamilyRankGS2C=function(t){65535==t.bossHPPercent&&this.onGetRankData(t)},t.prototype.onGetRankData=function(t){var e=t.rankArr.concat();e.sort(this.sortByHurt),this.rankData[t.bossid]=e},t.prototype.sortByHurt=function(t,e){return-(t.totalHurt-e.totalHurt)},t.prototype.updTop3Rank=function(t){var e;t&&(e=t.concat()).splice(3),this._view&&(this._view.oldRankList.array=e)},t.prototype.startFightHander=function(){h.SoundUtils.getInstance().playBtnsounds(),l.WorldBossManager.getInstance().enterWorldBoss()&&this.closeView()},t.prototype.openRankHander=function(){null==this.rankPanel&&(this.rankPanel=new g.WorldBossRankPanel),null!=this.rankData[this.selectedPort]&&(this.rankPanel.list_rank.array=this.rankData[this.selectedPort],this.rankPanel.popup())},t.prototype.onRemovedHander=function(){this.closeView()},t.prototype.closeHander=function(){h.SoundUtils.getInstance().playBtnsounds(),this.closeView()},t.prototype.onActivityStart=function(){this._view&&(this._view.portList.selectedIndex=-1,this.updPortStatus(),this.updPortDisplay())},t.prototype.onActivityEnd=function(){this._view&&(this._view.portList.selectedIndex=-1,this.updPortStatus(),this.updPortDisplay())},t.prototype.closeView=function(){(this._opened=!1,null!=this._view)&&(this._view.off(Laya.Event.REMOVED,this,this.onRemovedHander),this._view.bgview.btn_back.off(Laya.Event.CLICK,this,this.closeView),this._view.bgview.btn_back.off(Laya.Event.CLICK,this,this.closeView),this._view.portList.selectHandler.clear(),this._view.portList.selectHandler=null,this._view.btn_fihgt.off(Laya.Event.CLICK,this,this.startFightHander),this._view.removeSelf(),this._view.destroyView(),this._view=null,this.clearCtrlRes(),this.rankPanel&&(this.rankPanel.removeSelf(),this.rankPanel.destroy(),this.rankPanel=null),v.GSM.ins.off(u.WorldBossFamilyRankGS2C.KEY,this,this.onWorldBossFamilyRankGS2C))},t}(s.BaseCtrl);e.WorlBossCtrl=f}),define("src/g/timelimittask/ctrl/TimeLimitTaskViewCtrl",["require","exports","src/init/Switches","src/g/accessctrl/AccessCenter","src/g/timelimittask/view/TimeLimitTaskView","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","../../../manager/RoleCenter","../../../utils/system/ServerTime","../../../enum/EventName","../../../core/E","../../../config/GameConfig","../../../component/TimeLimitTaskOpenDlg","../../net/messages/enumStatus","../../../manager/NewRedHintsCenter","../../../runtime/resload/GameResLoad","src/init/TextConst"],function(t,e,i,o,r,l,h,c,u,n,s,p,a,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(){function t(){i.Switches.ins.on(103,this,this.onOpenHandler),s.E.ins.on(n.EventName.TIME_LIMIT_TASK_OPEN,this,this.onTaskOpenHandler),s.E.ins.on(n.EventName.TIME_LIMIT_TASK_DELETE,this,this.onTaskChanaged),s.E.ins.on(n.EventName.TIME_LIMIT_TASK_DATA_CHANGED,this,this.onTaskChanaged),s.E.ins.on(n.EventName.TIME_LIMIT_TASK_INITED,this,this.checkRed),o.AccessCenter.ins.checkOpen(103)||o.AccessCenter.ins.on(103,this,this.openAccess)}return t.prototype.openAccess=function(){o.AccessCenter.ins.checkOpen(103)&&o.AccessCenter.ins.off(103,this,this.openAccess),this.checkRed()},t.prototype.onTaskChanaged=function(t){var e=p.GameConfig.timeLimitTaskJson[t];e&&1==e.type&&this.checkRed()},t.prototype.checkRed=function(){if(o.AccessCenter.ins.checkOpen(103)){var t=c.RoleCenter.instans.vo.timeLimitTaskData;if(t)for(var e,i=t.dataArr.length,n=0;n<i;){e=t.dataArr[n];var s=p.GameConfig.timeLimitTaskJson[e.id];if(s&&1==s.type&&e.endTime>u.ServerTime.serverTime&&-1!=e.curStatusArr.indexOf(d.enumStatus.kelingqu))return void g.NewRedHintsCenter.ins.setRedHintOpenOrClose(g.enumRedHints.time_limit_task,!0);n++}}g.NewRedHintsCenter.ins.setRedHintOpenOrClose(g.enumRedHints.time_limit_task,!1)},t.prototype.onTaskOpenHandler=function(t){var e=p.GameConfig.timeLimitTaskJson[t];e&&1==e.type&&(new a.TimeLimitTaskOpenDlg).showTask(t)},t.prototype.onOpenHandler=function(t,e){t&&this.openTaskPanelHandler(e)},t.prototype.openTaskPanelHandler=function(t){if(c.RoleCenter.instans.vo.timeLimitTaskData){if(null==t)for(var e,i=c.RoleCenter.instans.vo.timeLimitTaskData,n=i.dataArr.length,s=0;s<n;){e=i.dataArr[s];var o=p.GameConfig.timeLimitTaskJson[e.id];if(o&&1==o.type&&e.endTime>u.ServerTime.serverTime){t=e.id;break}s++}var a=c.RoleCenter.instans.vo.getTLTDataById(t);a&&a.endTime>u.ServerTime.serverTime?(this._view||(v.GameResLoad.load("res/atlas/res/timelimittask.json"),this._view=new r.TimeLimitTaskView),this._view.showTask(t)):l.FE.upItems(f.TextConst.get(455),h.BubbleEnum.center)}else l.FE.upItems(f.TextConst.get(769),h.BubbleEnum.center)},t}();e.TimeLimitTaskViewCtrl=y}),define("src/g/timelimittask/view/RxZtTaskView",["require","exports","../../../core/E","../../../enum/EventName","../../../utils/system/ServerTime","../../../utils/system/DateUitl","../../../config/GameConfig","../../../manager/GameSocketManager","../../net/messages/TimeLimitTaskMsg","../../net/messages/enumStatus","../../../meta/MainButtonVo","../../../manager/RoleCenter","../../../manager/LayerManager","src/g/clearRes/ClearResM","src/g/bag/tips/view/ItemTips","../../../utils/ItemCellUtils","src/g/Effects/UIEffectsFactory","src/init/TextConst"],function(t,e,i,n,s,o,l,r,h,a,c,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=function(e){function t(){var t=e.call(this)||this;return t.bg.btn_help.visible=!1,t.bg.btn_back.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.on(Laya.Event.REMOVED,t,t.onRemovedHandler),t.list_task.renderHandler=new Laya.Handler(t,t.onRenderListHandler),t.list_task.scrollBar.elasticDistance=100,i.E.ins.on(n.EventName.TIME_LIMIT_TASK_DATA_CHANGED,t,t.onDataChangedHandler),i.E.ins.on(n.EventName.TIME_LIMIT_TASK_OPEN,t,t.onNewTaskOpen),t.htxt_progress.style.font="SimHei",t.htxt_progress.style.fontSize=20,t.htxt_progress.style.color="#e3cca9",t.htxt_progress.style.align="center",t.box_reward.itemRender=ui.custom.ItemNameViewUI,t.box_reward.renderHandler=new Laya.Handler(t,t.onListRender),t.box_reward.clickHandler=new Laya.Handler(t,t.onMouseListRender),t.btn_get.on(Laya.Event.CLICK,t,t.toGetReward),t.ani=f.UIEffectsFactory.Ins.createUIAniById(40,!0),f.UIEffectsFactory.Ins.centered4Parent(t.ani,t.btn_get,!0),t}return __extends(t,e),t.prototype.onMouseListRender=function(t){g.ItemTips.ins.showTip(this.box_reward.array[t][0],Number(this.box_reward.array[t][1]))},t.prototype.onListRender=function(t,e){v.ItemCellUtils.fillCellForItemNameView(t,this.box_reward.array[e][0],Number(this.box_reward.array[e][1]))},t.prototype.onNewTaskOpen=function(t){this._taskId!=t&&this.onCloseHandler()},t.prototype.onDataChangedHandler=function(t){!this.displayedInStage||t!=this._taskId&&t||this.refreshData()},t.prototype.showTask=function(t){this._taskId=t,this._tltd=u.RoleCenter.instans.vo.getTLTDataById(this._taskId),this.cooldownHandler(),Laya.timer.loop(1e3,this,this.cooldownHandler),this.refreshData(),p.LayerManager.addInPOPWindowLayer(this),d.ClearResM.resetViewImg(this),i.E.ins.on(n.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),i.E.ins.on(n.EventName.TIME_LIMIT_TASK_DELETE,this,this.onDelHandler)},t.prototype.closeClearRes=function(){i.E.ins.off(n.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),d.ClearResM.clearFolderByUrl("dynamic/taskicon/")},t.prototype.refreshData=function(){var t=l.GameConfig.timeLimitTaskJson[this._taskId];this.box_reward.array=t.UIrewards;for(var e=t.child.length,i=0,n=[];i<e;)n.push(t.child[i]),i++;n.sort(this.compareFn.bind(this)),this.list_task.array=n,this.checkCompletCount()},t.prototype.checkCompletCount=function(){for(var t,e,i=l.GameConfig.timeLimitTaskJson[this._taskId],n=i.child.length,s=0,o=0;s<n;)e=l.GameConfig.timeLimitSubTaskJson[i.child[s]],t=this._tltd.statusArr[s],e.need<=t&&o++,s++;this.htxt_progress.innerHTML=y.TextConst.get(770,o,n),this.btn_get.disabled=o<n,this.ani.visible=n<=o},t.prototype.compareFn=function(t,e){var i=l.GameConfig.timeLimitTaskJson[this._taskId],n=u.RoleCenter.instans.vo.getTLTDataById(this._taskId),s=i.child.indexOf(t);n.curStatusArr[s]==a.enumStatus.weiwancheng&&(s+=100),n.curStatusArr[s]==a.enumStatus.yilingqu&&(s+=200);var o=i.child.indexOf(e);return n.curStatusArr[o]==a.enumStatus.weiwancheng&&(o+=100),n.curStatusArr[o]==a.enumStatus.yilingqu&&(o+=200),s-o},t.prototype.onRenderListHandler=function(t){var e=t.dataSource,i=l.GameConfig.timeLimitTaskJson[this._taskId],n=l.GameConfig.timeLimitSubTaskJson[e],s=i.child.indexOf(e),o=this._tltd.statusArr[s],a=n.need;n.isNoCountType()&&(o=o<a?0:1,a=1),a<o&&(o=a),t.txt_name.changeText(n.name),t.img_icon.skin="dynamic/taskicon/"+n.icon+".png",t.txt_desc.style.font="SimHei",t.txt_desc.style.fontSize=18,t.txt_desc.style.color="#ccb694",t.txt_desc.innerHTML=a<=o?n.res+'<font color="#03bb00">('+o+"/"+a+")</font>":n.res+'<font color="#ff0f15">('+o+"/"+a+")</font>",t.btn_get.offAll(),t.btn_get.visible=!1,t.lab_complet.visible=!1;var r=f.UIEffectsFactory.Ins.createUIAniById(42,!0);0==t.effect.numChildren&&(t.effect.addChild(r),f.UIEffectsFactory.Ins.alignCenter(r,t.effect,.8)),t.effect.visible=!1,a<=o?t.lab_complet.visible=!0:n.moduleID&&0<n.moduleID.length&&(t.btn_get.label=y.TextConst.get(200),t.btn_get.on(Laya.Event.CLICK,this,this.gotoOp,[n]),t.btn_get.visible=!0)},t.prototype.gotoOp=function(t){t.moduleID&&0<t.moduleID.length&&(c.MainButtonStruct.Ins.OpenModule(t.moduleID[0][1],t.moduleID[1][1]),this.removeSelf())},t.prototype.onCloseHandler=function(){i.E.ins.off(n.EventName.TIME_LIMIT_TASK_DELETE,this,this.onDelHandler),this.removeSelf()},t.prototype.onDelHandler=function(t){this._tltd&&this._tltd.id==t&&this.onCloseHandler()},t.prototype.toGetReward=function(){if(this._tltd){for(var t,e,i=l.GameConfig.timeLimitTaskJson[this._taskId],n=i.child.length,s=0,o=0;s<n;)e=l.GameConfig.timeLimitSubTaskJson[i.child[s]],t=this._tltd.statusArr[s],e.need<=t&&o++,s++;if(n<=o){var a=new h.TimeLimitTaskGetMsg;a.taskId=this._taskId,a.taskChildId=0,r.GSM.sendServer(a)}}},t.prototype.onRemovedHandler=function(){Laya.timer.clear(this,this.cooldownHandler)},t.prototype.cooldownHandler=function(){if(this._tltd){var t=this._tltd.endTime-s.ServerTime.serverTime;this.lab_time.changeText(o.DateUtil.remainingTimeStr(t))}},t}(ui.rx_zt_task.RxZtTaskViewUI);e.RxZtTaskView=m}),define("src/g/timelimittask/ctrl/RxZtTaskViewCtrl",["require","exports","src/init/Switches","src/g/accessctrl/AccessCenter","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","../../../manager/RoleCenter","../../../utils/system/ServerTime","../../../enum/EventName","../../../core/E","../../../config/GameConfig","../../net/messages/enumStatus","../../../manager/NewRedHintsCenter","src/g/timelimittask/view/RxZtTaskView","../../../runtime/resload/GameResLoad","src/init/TextConst"],function(t,e,i,o,r,l,h,c,n,s,u,a,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(){function t(){i.Switches.ins.on(186,this,this.onOpenHandler),s.E.ins.on(n.EventName.TIME_LIMIT_TASK_DELETE,this,this.onTaskChanaged),s.E.ins.on(n.EventName.TIME_LIMIT_TASK_DATA_CHANGED,this,this.onTaskChanaged),s.E.ins.on(n.EventName.TIME_LIMIT_TASK_INITED,this,this.checkRed),o.AccessCenter.ins.checkOpen(186)||o.AccessCenter.ins.on(186,this,this.openAccess)}return t.prototype.openAccess=function(){o.AccessCenter.ins.checkOpen(186)&&o.AccessCenter.ins.off(186,this,this.openAccess),this.checkRed()},t.prototype.onTaskChanaged=function(t){var e=u.GameConfig.timeLimitTaskJson[t];e&&2==e.type&&this.checkRed()},t.prototype.checkRed=function(){if(o.AccessCenter.ins.checkOpen(186)){var t=h.RoleCenter.instans.vo.timeLimitTaskData;if(t)for(var e,i=t.dataArr.length,n=0;n<i;){e=t.dataArr[n];var s=u.GameConfig.timeLimitTaskJson[e.id];if(s&&2==s.type&&e.endTime>c.ServerTime.serverTime&&-1!=e.curStatusArr.indexOf(a.enumStatus.kelingqu))return void p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.rx_zt_task,!0);n++}}p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.rx_zt_task,!1)},t.prototype.onOpenHandler=function(t,e){t&&this.openTaskPanelHandler(e)},t.prototype.openTaskPanelHandler=function(t){if(h.RoleCenter.instans.vo.timeLimitTaskData){if(null==t)for(var e,i=h.RoleCenter.instans.vo.timeLimitTaskData,n=i.dataArr.length,s=0;s<n;){e=i.dataArr[s];var o=u.GameConfig.timeLimitTaskJson[e.id];if(o&&2==o.type&&e.endTime>c.ServerTime.serverTime){t=e.id;break}s++}var a=h.RoleCenter.instans.vo.getTLTDataById(t);a&&a.endTime>c.ServerTime.serverTime?(this._view||(g.GameResLoad.load("res/atlas/res/rx_zt_task.json"),this._view=new d.RxZtTaskView),this._view.showTask(t)):r.FE.upItems(v.TextConst.get(455),l.BubbleEnum.center)}else r.FE.upItems(v.TextConst.get(769),l.BubbleEnum.center)},t}();e.RxZtTaskViewCtrl=f}),define("src/g/hotbloodtemple/view/HBloodPagodaView",["require","exports","../../../manager/LayerManager","../../../manager/RoleCenter","../../../utils/ItemUtils","../../../config/GameConfig","src/g/account/view/AccItem","../../../utils/ItemDropUtil","../../../meta/QualiyVo","src/init/TextConst"],function(t,e,o,a,r,l,i,h,c,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.rewardLevel=-1,t._timeArr=[],t.mouseThrough=!0,t.width=Laya.stage.width,t.height=Laya.stage.height,t.sReward=new i.AccItem,t.sReward.y=13,t.rewardBox.addChild(t.sReward),t.initHtmlStyle(t.timeDes,"#e3cca9",18),t.initHtmlStyle(t.rewardDes,"#e3cca9",18),t.rewardDes.style.leading=6,t}return __extends(t,e),t.prototype.initHtmlStyle=function(t,e,i){t.style.color=e,t.style.font="SimHei",t.style.fontSize=i},t.prototype.showView=function(){var t=a.RoleCenter.instans.self.bbGodData.curCfgId;this.crtPort=l.GameConfig.hbtempleJson[t];var e=r.ItemUtils.getMonsterVOById(t);e&&(this.imgBossHead.skin=r.ItemUtils.getBossIccon(e.id),this.lbBossName.text=e.name);var i=h.ItemDropUtil.createPortRewardData(this.crtPort.port_Sdrop);this.imgLayer.value=this.crtPort.getId().toString(),this.sReward.eqData=i[0],this.sReward.lv_txt.text="";for(var n=l.GameConfig.commonJson.rxsdpf.value.split(","),s=0;s<n.length;s++)this._timeArr[s]=parseFloat(n[s]);this.label_time.text="",o.LayerManager.addInUILayer(this)},t.prototype.updateHpProgress=function(t,e){this.progress_txt.changeText(t+"/"+e),this.progressBar.scaleX=Math.max(0,Math.min(1,t/e))},t.prototype.updateTime=function(t){this.label_time.text=n.TextConst.get(13,t.toString());var e=this.calculateEvaluate(t);this.updateEvaluate(e)},t.prototype.updateEvaluate=function(t){this.rewardLevel!=t&&(this.rewardLevel=t,this.updLevelDisplay(),2==this.rewardLevel?this.timeDes.innerHTML=n.TextConst.get(831,this._timeArr[this.rewardLevel-1],this.levelFont()):this.timeDes.innerHTML=n.TextConst.get(832,this._timeArr[this.rewardLevel],this.levelFont()),this.rewardDes.innerHTML=this.getRewardDes())},t.prototype.getRewardDes=function(){var t,e,i,n,s,o="";switch(this.rewardLevel){case 0:s=this.crtPort.port_Sdrop;break;case 1:s=this.crtPort.port_Adrop;break;case 2:s=this.crtPort.port_Bdrop}for(var a=0;a<s.length;a++)i=s[a],(n=r.ItemUtils.getItemOrEq(i[0]))&&(e=n.name,t=i[1],o+="<font  color='"+c.QualityStruct.Ins.getQColorById(n.quality)+"'>"+e+"x"+t+"</font>",0==a&&(o+="<br>"));return o},t.prototype.levelFont=function(){var t;switch(this.rewardLevel){case 0:t="S";break;case 1:t="A";break;case 2:t="B"}return t},t.prototype.updLevelDisplay=function(){switch(this.rewardLevel+1){case 1:this.imgLevel.skin="res/hotbloodtemple/rxsd_pingfenSda.png";break;case 2:this.imgLevel.skin="res/hotbloodtemple/rxsd_pingfenAda.png";break;case 3:this.imgLevel.skin="res/hotbloodtemple/rxsd_pingfenBda.png"}},t.prototype.calculateEvaluate=function(t){for(var e=0;e<this._timeArr.length;e++)if(t<this._timeArr[e])return e;return 2},t}(ui.hotbloodtemple.HBPagodaMainViewUI);e.HBloodPagodaView=s}),define("src/g/fight/osprite/play/hotbloodpagoda/GamePlayHotBloodPagoda",["require","exports","src/g/fight/osprite/play/GamePlaySvrBase","../../../../../manager/GameSocketManager","../../../../net/messages/BBGodFightMsg","../../../../../utils/ItemUtils","../../../../../manager/RoleCenter","../../../../../config/GameConfig","../../../../net/messages/ExpCopyMsg","../../../../../core/E","../../../../../enum/EventName","../../../../net/messages/OpResultGS2C","../../../../../utils/system/FloatEffect","../../../../../plugin/view/ToolTip","../../../../../utils/system/ServerTime","src/g/fight/osprite/play/hotbloodpagoda/HotBloodPagodaManager","../../../../../manager/AM"],function(t,e,i,n,s,u,p,d,o,a,r,l,h,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(c){function t(t){var e=c.call(this,t)||this;e._endMsg=null,e._severStartTime=-1,e._clientStartTime=1,e._fightingKey=!1,f.HotBloodPagodaManager.getInstance().enterGamePlay(e);var i=n.GSM.ins;return i.on(s.BBGodFightStartGS2C.KEY,e,e.onBBGodFightStartGS2C),i.on(s.BBGodChallengeStartMsg.KEY,e,e.onBBGodChallengeStartMsg),i.on(l.OpResultGS2C.KEY,e,e.onOpResultGS2C),i.on(s.BBGodFightEndGS2C.KEY,e,e.onBBGodFightEndGS2C),i.on(s.GetBBGodFightInvMsg.KEY,e,e.onGetBBGodFightInvMsg),a.E.ins.on(r.EventName.EXIT_BOSS_PLAYTYPE,e,e.exitHandler),e.readyAndFightStart(),e.setJoinSkill(),e}return __extends(t,c),t.prototype.clear=function(){c.prototype.clear.call(this),this.clearSaveInfo();var t=n.GSM.ins;t.off(s.BBGodFightStartGS2C.KEY,this,this.onBBGodFightStartGS2C),t.off(s.BBGodChallengeStartMsg.KEY,this,this.onBBGodChallengeStartMsg),t.off(l.OpResultGS2C.KEY,this,this.onOpResultGS2C),t.off(s.BBGodFightEndGS2C.KEY,this,this.onBBGodFightEndGS2C),t.off(s.GetBBGodFightInvMsg.KEY,this,this.onGetBBGodFightInvMsg),a.E.ins.off(r.EventName.EXIT_BOSS_PLAYTYPE,this,this.exitHandler),f.HotBloodPagodaManager.getInstance().exitGamePlay()},t.prototype.exitHandler=function(){y.AM.exitPlay(this.type,new Laya.Handler(this,function(){this.executeExit()}))},t.prototype.executeExit=function(){this.clearSaveInfo()||this.returnAutoplayPort()},t.prototype.init=function(t){void 0===t&&(t=null),c.prototype.init.call(this,t),this.initHeroGroup(),this.requestMonsterData()},t.prototype.changeMap=function(t){this.clearEff();var e=d.GameConfig.getPortByID(t);e&&this.scene&&this.scene.changeMap(e.boss_scene),f.HotBloodPagodaManager.getInstance().updateMonsterView(t)},t.prototype.readyAndFightStart=function(){this._fightingKey=!1,0<p.RoleCenter.instans.self.bbGodData.count?this.changeMap(p.RoleCenter.instans.self.bbGodData.curCfgId):this.exitHandler()},t.prototype.initHeroGroup=function(){c.prototype.initHeroGroup.call(this);var t=u.ItemUtils.getPortVoById(p.RoleCenter.instans.self.bbGodData.curCfgId),e=d.GameConfig.getMapJSON(t.boss_scene);this._fightGroup.resetFightGroup(e.startPoint[0])},t.prototype.requestMonsterData=function(){var t=new s.BBGodFightStartC2GS;t.curCfgId=p.RoleCenter.instans.self.bbGodData.curCfgId,n.GSM.sendServer(t)},t.prototype.onBBGodFightStartGS2C=function(t){if(t.opresult){var e=new o.MonsterAppearExpCopyGS2C;e.monsterArr=t.monsterArr,e.monsterUidArr=t.monsterUidArr,this.createMonsterByMonsterAppearExpCopyGS2C(e),this._fightGroup.setOnceTarget(this._monsterGroup),this.reqBBGodChallengeStartMsg()}else console.error(t.error),this.returnAutoplayPort()},t.prototype.reqBBGodChallengeStartMsg=function(){var t=new s.BBGodChallengeStartMsg;n.GSM.sendServer(t),this._clientStartTime=v.ServerTime.serverTime,this._fightingKey=!0},t.prototype.onBBGodChallengeStartMsg=function(t){this._monsterGroup.setOnceTarget(this._fightGroup),this._severStartTime=t.fightStartTime},t.prototype.reqFightEnd=function(){var t=new s.BBGodFightEndC2GS;t.useTime=v.ServerTime.serverTime-this._clientStartTime,n.GSM.sendServer(t)},t.prototype.onOpResultGS2C=function(t){t.opresult?this._monsterGroup.setOnceTarget(this._fightGroup):(h.FE.upItems(t.error,g.BubbleEnum.center),console.log(JSON.stringify(t)))},t.prototype.onBBGodFightEndGS2C=function(t){0==t.win||this.checkIsRunAllKey()?t.win?(this._fightReward=t.inv,a.E.ins.event(r.EventName.OPEN_HOTBLOOD_PAGODA_RESULT,t)):this.exitHandler():this._endMsg=t},t.prototype.reqGetBBGodFightInvMsg=function(){var t=new s.GetBBGodFightInvMsg;t.type=1,n.GSM.sendServer(t)},t.prototype.onGetBBGodFightInvMsg=function(t){p.RoleCenter.instans.addInventoryToC(this._fightReward),h.FE.addInventoryToCFloats(this._fightReward),this._fightReward=null,this.returnAutoplayPort()},t.prototype.clearSaveInfo=function(){return!!this._endMsg&&(this.runAllInfo(),this.onBBGodFightEndGS2C(this._endMsg),!(this._endMsg=null))},t.prototype.frameMove=function(){if(c.prototype.frameMove.call(this),this._endMsg&&this.checkIsRunAllKey()&&(this.onBBGodFightEndGS2C(this._endMsg),this._endMsg=null),this._fightingKey){0==this.getMonsterHp()&&(this.reqFightEnd(),this._fightingKey=!1);var t=v.ServerTime.serverTime-this._clientStartTime;f.HotBloodPagodaManager.getInstance().updateFightTime(t)}},t.prototype.createMonsterByMonsterAppearExpCopyGS2C=function(t,e){if(void 0===e&&(e=!1),c.prototype.createMonsterByMonsterAppearExpCopyGS2C.call(this,t,e)){var i=t.monsterUidArr,n=u.ItemUtils.getPortVoById(p.RoleCenter.instans.self.bbGodData.curCfgId),s=(u.ItemUtils.getMonsterVOById(n.boss[0]),d.GameConfig.getMapJSON(n.boss_scene));s||console.error("portId:"+n.boss_scene);for(var o=0,a=0,r=0,l=null,h=0;h<i.length;h++)r=i[h],l=this._monsterDic[r],s&&h<i.length&&(o=s.bossXY[h][0],a=s.bossXY[h][1]),l.resetUnit(o,a),l.status=1,l.getHp();return!0}return!1},t.prototype.setMonsterHp=function(t,e,i){c.prototype.setMonsterHp.call(this,t,e,i);var n=this.getMonsterHp();0==e&&this._count<=0&&this._fightGroup.stand(),f.HotBloodPagodaManager.getInstance().updateHp(n)},t.prototype.getMonsterHp=function(){var t=0,e=null;for(var i in this._monsterDic)(e=this._monsterDic[i])&&!e.isDeath()&&(t+=e.getHp());return t},t}(i.GamePlaySvrBase);e.GamePlayHotBloodPagoda=c}),define("src/g/hotbloodtemple/view/HotBloodPagodaBalanceView",["require","exports","src/g/account/view/AccItem"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.initHtmlStyle(t.label_time,"#e3cca9",18),t.initHtmlStyle(t.label_descInfo,"#e1a32a",18),t.initList(t.rewardList,i.AccItem,new Laya.Handler(t,t.rewardRender)),t}return __extends(t,e),t.prototype.initHtmlStyle=function(t,e,i){t.style.color=e,t.style.font="SimHei",t.style.fontSize=i,t.style.align="center"},t.prototype.initList=function(t,e,i){t.itemRender=e,t.vScrollBarSkin="",t.scrollBar.elasticDistance=100,t.renderHandler=i,t.array=[]},t.prototype.rewardRender=function(t,e){t.eqData=t.dataSource},t.prototype.showView=function(){this.popup(),this.imgGround.rotation=0,Laya.timer.loop(120,this,this.updEffectDisplay)},t.prototype.updEffectDisplay=function(){this.imgGround.rotation+=10},t}(ui.hotbloodtemple.HBPagodaResultUI);e.HotBloodPagodaBalanceView=n}),define("src/g/hotbloodtemple/ctrl/HotBloodPagodaBalanceCtrl",["require","exports","src/init/CtrlBase","src/g/hotbloodtemple/view/HotBloodPagodaBalanceView","../../../core/E","../../../enum/EventName","src/g/fight/osprite/play/hotbloodpagoda/HotBloodPagodaManager","../../../config/GameConfig","../../../utils/ItemDropUtil","../../../utils/CountDown","../../../utils/system/ServerTime","src/g/clearRes/ClearResM","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(i){function t(){var t=null!==i&&i.apply(this,arguments)||this;return t._view=null,t._data=null,t}return __extends(t,i),t.prototype.init=function(){this.countDown=new h.CountDown,s.E.ins.on(o.EventName.OPEN_HOTBLOOD_PAGODA_RESULT,this,this.showView)},t.prototype.showView=function(t){this.showPage(null,t)},t.prototype.showPage=function(t,e){i.prototype.showPage.call(this,t,e),null==this._view&&(this._view=new n.HotBloodPagodaBalanceView,this._view.closeHandler=Laya.Handler.create(this,this.onCloseHander),this._view.showView()),this._data=e,this.refreshData(),(a.HotBloodPagodaManager.getInstance().resultCtrl=this).countDown.start(c.ServerTime.serverTime+20,this.updCountDownHander,this)},t.prototype.refreshData=function(){if(i.prototype.refreshData.call(this),this._view&&this._data){switch(this._data.pingfen){case 1:this._view.imgLevel.skin="res/hotbloodtemple/rxsd_pingfenSda.png";break;case 2:this._view.imgLevel.skin="res/hotbloodtemple/rxsd_pingfenAda.png";break;case 3:this._view.imgLevel.skin="res/hotbloodtemple/rxsd_pingfenBda.png"}var t=parseFloat(r.GameConfig.commonJson.rxsdpf.value.split(",")[0]);if(this._view.label_time.innerHTML=p.TextConst.get(828,this._data.useTime),this._data.useTime>t){var e=this._data.useTime-t;this._view.label_descInfo.innerHTML=p.TextConst.get(829,e,"S")}else this._view.label_descInfo.innerHTML=p.TextConst.get(830,"S");this._view.rewardList.array=l.ItemDropUtil.createRewardList(this._data.inv)}},t.prototype.hidePage=function(){i.prototype.hidePage.call(this)},t.prototype.destroyPage=function(){i.prototype.destroyPage.call(this),this._view&&(this._view.removeSelf(),this._view.destroy(!0),this._view=null),u.ClearResM.clearResFolder("hotbloodtemple/",!0)},t.prototype.updCountDownHander=function(t){this._view.getChildByName("close").label=p.TextConst.get(243,t),0==t&&this._view.close()},t.prototype.onCloseHander=function(){this.countDown.stop(),this._view.closeHandler=null,a.HotBloodPagodaManager.getInstance().getReward()},t}(i.CtrlBase);e.HotBloodPagodaBalanceCtrl=d}),define("src/g/fight/osprite/play/hotbloodpagoda/HotBloodPagodaManager",["require","exports","../../../../../manager/RoleCenter","../../../../../core/E","../../../../../enum/EventName","../../../../../utils/system/FloatEffect","../../../../../plugin/view/ToolTip","src/g/fight/info/PlayTypeVo","../../../../net/messages/ChangeSceneMsg","../../../../../manager/NewRedHintsCenter","src/g/accessctrl/AccessCenter","../../../../../manager/AM","src/g/fight/osprite/play/PlayManager","src/init/TextConst","../../../../../config/GameConfig"],function(t,e,o,i,n,a,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function s(){this.gamePlay=null,this.viewCtrl=null,this.resultCtrl=null}return s.getInstance=function(){return null==s._instance&&(s._instance=new s),s._instance},s.prototype.enterGamePlay=function(t){this.gamePlay=t,i.E.ins.event(n.EventName.OPEN_HOTBLOOD_PAGODA)},s.prototype.exitGamePlay=function(){this.gamePlay=null,this.viewCtrl&&(this.viewCtrl.destroyPage(),this.viewCtrl=null),this.resultCtrl&&(this.resultCtrl.destroyPage(),this.resultCtrl=null),this.checkHotBloodPagodaRedPoint()},s.prototype.enterHotBloodPagoda=function(){if(!o.RoleCenter.instans.bagRoomEnough())return p.AM.showBagNotEnough(),!1;if(d.PlayManager.isSpecialPlay())return a.FE.upItems(g.TextConst.get(406),r.BubbleEnum.center),!1;var t=this.checkIsEnterHotBloodPagoda();return t?i.E.ins.event(n.EventName.PLAY_TYPE_CHANGE,l.PlayTypeVo.create(h.EPlayType.PLAYTYPE_BLOODYTEMPLE)):a.FE.upItems(g.TextConst.get(451),r.BubbleEnum.center),t},s.prototype.checkIsEnterHotBloodPagoda=function(){return 0<o.RoleCenter.instans.self.bbGodData.count},s.prototype.updateMonsterView=function(t){this.viewCtrl&&this.viewCtrl.updateMonsterInfo(t)},s.prototype.updateMaxHp=function(t){this.viewCtrl&&this.viewCtrl.updateMaxHp(t)},s.prototype.updateHp=function(t){this.viewCtrl&&this.viewCtrl.updateHp(t)},s.prototype.updateFightTime=function(t){this.viewCtrl&&this.viewCtrl.updateFightTime(t)},s.prototype.getReward=function(){this.gamePlay&&this.gamePlay.reqGetBBGodFightInvMsg()},s.prototype.checkHotBloodPagodaRedPoint=function(){var t=u.AccessCenter.ins.checkOpen(173),e=s.getInstance().checkIsEnterHotBloodPagoda(),i=o.RoleCenter.instans.self.bbGodData.curCfgId,n=v.GameConfig.hbtempleJson[i];c.NewRedHintsCenter.ins.setRedHintOpenOrClose(c.enumRedHints.hot_blood_pagoda,t&&e&&(0==i||n&&0<n.type))},s._instance=null,s}();e.HotBloodPagodaManager=s}),define("src/g/hotbloodtemple/ctrl/HBloodPagodaViewCtrl",["require","exports","src/init/CtrlBase","src/g/hotbloodtemple/view/HBloodPagodaView","src/g/fight/osprite/play/hotbloodpagoda/HotBloodPagodaManager","../../../core/E","../../../enum/EventName","../../../config/GameConfig","../../../utils/ItemUtils","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(i){function t(){var t=null!==i&&i.apply(this,arguments)||this;return t._portId=-1,t._currHp=0,t._maxHp=0,t._currTime=0,t._view=null,t}return __extends(t,i),t.prototype.init=function(){i.prototype.init.call(this),o.E.ins.on(a.EventName.OPEN_HOTBLOOD_PAGODA,this,this.showView)},t.prototype.showView=function(){this.showPage(null)},t.prototype.showPage=function(t,e){i.prototype.showPage.call(this,t,e),null==this._view&&(this._view=new n.HBloodPagodaView,this._view.showView()),this.refreshData(),s.HotBloodPagodaManager.getInstance().viewCtrl=this},t.prototype.refreshData=function(){i.prototype.refreshData.call(this),this.updateMaxHp(this._maxHp),this.updateHp(this._currHp),this.updateFightTime(this._currTime)},t.prototype.hidePage=function(){i.prototype.hidePage.call(this),this._view&&(this._view.visible=!1)},t.prototype.destroyPage=function(){i.prototype.destroyPage.call(this),this._view&&(this._view.removeSelf(),this._view.destroy(),this._view=null),this._currTime=0,h.ClearResM.clearResFolder("hotbloodtemple/",!0),s.HotBloodPagodaManager.getInstance().viewCtrl=null},t.prototype.updateHp=function(t){this._currHp=t,this._currHp>this._maxHp&&(this._maxHp=this._currHp),this._view&&this._view.updateHpProgress(this._currHp,this._maxHp)},t.prototype.updateMaxHp=function(t){this._maxHp=t,this._view&&this._view.updateHpProgress(this._currHp,this._maxHp)},t.prototype.updateMonsterInfo=function(t){if(this._portId=t,this._view){var e=r.GameConfig.getPortByID(t),i=l.ItemUtils.getMonsterVOById(e.boss);this.updateHp(i.HP)}},t.prototype.startFight=function(){},t.prototype.endFight=function(){},t.prototype.updateFightTime=function(t){this._currTime=t,this._view&&this._view.updateTime(t)},t}(i.CtrlBase);e.HBloodPagodaViewCtrl=c}),define("src/g/gift/view/GiftUseView",["require","exports","../../../utils/ItemCellUtils","../../../utils/ItemUtils","src/g/bag/tips/view/ItemTips","../../../manager/RoleCenter","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","../../net/messages/UseItemC2GS","../../../manager/GameSocketManager","../../../utils/system/ServerTime","../../../core/E","../../../enum/EventName","../../../utils/DialogQueue","../../../enum/DialogIDEnum","src/g/clearRes/ClearResM","../../../enum/BagItemType","src/init/TextConst","src/init/Switches"],function(t,e,n,h,o,s,a,r,l,c,u,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;return t.selectItemId=0,t.price=0,t.list_item.itemRender=ui.custom.ItemNameViewUI,t.list_item.renderHandler=new Laya.Handler(t,t.onItemRenderHandler),t.list_item.clickHandler=new Laya.Handler(t,t.onClickItemHandler),t.htxt_desc.style.font="SimHei",t.htxt_desc.style.color="#a89e8f",t.htxt_desc.style.fontSize=18,t.btn_get.on(Laya.Event.CLICK,t,t.onGetItemHandler),t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t}return __extends(t,i),t.prototype.onCloseHandler=function(){this.close()},t.prototype.close=function(t,e){i.prototype.close.call(this,t,e),f.ClearResM.clearResFolder("gift")},t.prototype.onItemRenderHandler=function(t,e){n.ItemCellUtils.fillCellForItemNameView(t,this.list_item.array[e][0],this.list_item.array[e][1])},t.prototype.onClickItemHandler=function(t,e){var i=this.list_item,n=this.selectItemId,s=i.array[t][0];n!=s?(this.canSelect&&(this.selectItemId=s,this.img_select.x=i.x+(e.x+86)*i.scaleX,this.img_select.y=i.y+(e.y+81)*i.scaleY,this.img_select.visible=!0),o.ItemTips.ins.showTip(this.list_item.array[t][0],this.list_item.array[t][1])):o.ItemTips.ins.showTip(s,i.array[t][1])},t.prototype.showView=function(t,e,i){this.itemId=t,this.time=e,this.useCount=i;var n=h.ItemUtils.getItemVoById(t);if(n){if(this.img_bg.skin=n.type==y.BagItemType.xhybqnlb?"res/gift/shouchongzhuanshu_diban.png":"res/gift/shouchongzhuanshu_diban2.png",n.type==y.BagItemType.xhybqnlb?(this.htxt_desc.innerHTML=m.TextConst.get(506,n.name),this.canSelect=!1,this.img_cd.visible=!0):n.type==y.BagItemType.xhybxzlb?(this.htxt_desc.innerHTML=m.TextConst.get(507,n.name),this.canSelect=!0,this.img_cd.visible=!0):n.type==y.BagItemType.bxhybxzlb&&(this.htxt_desc.innerHTML=m.TextConst.get(508),this.canSelect=!0,this.img_cd.visible=!1),this.img_select.visible=!1,this.selectItemId=0,1<this.useCount){var s=[],o=n.effect.length,a=0;for(t=0;a<o;)t=n.effect[a][0],s.push([t,this.useCount*n.effect[a][1]]),a++;this.list_item.array=s}else this.list_item.array=n.effect;var r=this.price=0;for(o=n.uselimit.length,a=0;a<o;)"GOLD"==n.uselimit[a][0]?this.price=n.uselimit[a][1]:"YUANJIA"==n.uselimit[a][0]&&(r=n.uselimit[a][1]),a++;if(0==r&&(r=this.price),0<this.price){this.box_price.visible=!0,this.txt_ori_price.changeText(r.toString());var l=Math.round(this.price/r*10);this.lab_rebate.changeText(l.toString()),this.txt_curr_price.changeText(this.price.toString()),this.btn_get.label=m.TextConst.get(509)}else this.box_price.visible=!1,this.btn_get.label=m.TextConst.get(204);this.isPopup||g.DialogQueue.getInstance().add(v.DialogIDEnum.GIFT,this)}f.ClearResM.resetViewImg(this)},t.prototype.getItemGoldPrice=function(t){if(t)for(var e=t.uselimit.length,i=0;i<e;){if("GOLD"==t.uselimit[i][0])return t.uselimit[i][1];i++}return 0},t.prototype.onGetItemHandler=function(){if(0<this.price&&s.RoleCenter.instans.vo.GOLD<this.price)_.Switches.ins.event(155);else if(this.canSelect&&0==this.selectItemId)a.FE.upItems(m.TextConst.get(510),r.BubbleEnum.center);else{if(0==this.time||this.time>u.ServerTime.serverTime){var t=new l.UseItemC2GS_type1;t.cfgId=this.itemId,t.needCfgId=Number(this.selectItemId),t.itemTime=this.time,t.count=this.useCount,c.GSM.sendServer(t)}else a.FE.upItems(m.TextConst.get(511),r.BubbleEnum.center),p.E.ins.event(d.EventName.UPDATE_BAG);this.close()}},t}(ui.gift.GiftGetDlgUI);e.GiftUseView=i}),define("src/g/gift/ctrl/GiftCtrl",["require","exports","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../../utils/ItemUtils","../../../utils/system/ServerTime","src/g/gift/view/GiftUseView","../../../manager/GameSocketManager","../../net/messages/UseItemGS2C","../../net/messages/UseItemC2GS","../../../runtime/resload/GameResLoad","../../../enum/BagItemType","../../../manager/NewRedHintsCenter","src/init/Switches"],function(t,e,r,l,c,u,p,a,n,i,s,h,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){this.url="res/atlas/res/gift.json",this.checkAndInit(),v.Switches.ins.on(194,this,this.openPanelHandler),n.GSM.ins.on(i.UpDataItemTimeGS2C.KEY,this,this.onUpdateGiftHandler)}return t.prototype.checkAndInit=function(){c.RoleCenter.instans.vo?p.ServerTime.isInited?this.init():r.E.ins.once(l.EventName.SERVER_TIME_UPDATE,this,this.checkAndInit):r.E.ins.once(l.EventName.INIT_SELFSETOVER,this,this.checkAndInit)},t.prototype.openPanelHandler=function(t,e,i,n,s,o){void 0===e&&(e=!0),void 0===i&&(i=!1),void 0===n&&(n=0),void 0===s&&(s=0),void 0===o&&(o=0),0<o&&(this._view||(h.GameResLoad.load(this.url),this._view=new a.GiftUseView),this._view.showView(n,s,o))},t.prototype.init=function(){for(var t,e,i,n,s=c.RoleCenter.instans.vo.bagdata.itemTimeArr,o=s?s.length:0,a=0,r=0,l=-1;a<o;){if(e=s[a],(i=s[a+1])>p.ServerTime.serverTime&&((n=u.ItemUtils.getItemVoById(e)).type==d.BagItemType.xhybqnlb||n.type==d.BagItemType.xhybxzlb||n.type==d.BagItemType.bxhybxzlb)){var h=this.getItemGoldPrice(n);(-1==l||h<l)&&(t=e,l=h,r=i)}a+=2}t&&Laya.timer.once(500,this,function(){v.Switches.ins.event(194,[!1,!0,t,r])}),this.checkCouponRed()},t.prototype.checkTimeOut=function(){Laya.timer.clear(this,this.checkTimeOut);for(var t=c.RoleCenter.instans.vo.bagdata.itemTimeArr,e=t?t.length:0,i=0;i<e;){if(t[i],t[i+1]>p.ServerTime.serverTime){n.GSM.sendServer(new s.chkItemTimeEndC2GS);break}i+=2}0<e&&Laya.timer.once(6e4,this,this.checkTimeOut)},t.prototype.checkCouponRed=function(){Laya.timer.clear(this,this.checkCouponRed);for(var t,e=c.RoleCenter.instans.vo.bagdata.itemTimeArr,i=e?e.length:0,n=0,s=p.ServerTime.serverTime,o=-1;n<i;){t=e[n];var a=u.ItemUtils.getItemVoById(t);if(a&&a.type==d.BagItemType.coupon){var r=e[n+1]-s;0<r&&(-1==o||r<o)&&(o=r)}n+=2}0<o?(g.NewRedHintsCenter.ins.setRedHintOpenOrClose(g.enumRedHints.recharge_coupon,!0),Laya.timer.once(1e3*o,this,this.checkCouponRed)):g.NewRedHintsCenter.ins.setRedHintOpenOrClose(g.enumRedHints.recharge_coupon,!1)},t.prototype.getItemGoldPrice=function(t){if(t)for(var e=t.uselimit.length,i=0;i<e;){if("GOLD"==t.uselimit[i][0])return t.uselimit[i][1];i++}return 0},t.prototype.onUpdateGiftHandler=function(t){var e=c.RoleCenter.instans.vo.bagdata.itemTimeArr;if(1==t.type)e.push(t.itemId),e.push(t.itemTime),(s=u.ItemUtils.getItemVoById(t.itemId)).type!=d.BagItemType.xhybqnlb&&s.type!=d.BagItemType.xhybxzlb&&s.type!=d.BagItemType.bxhybxzlb||r.E.ins.event(l.EventName.POP_ITEM_GET_PROPMT,[t.itemId,1,t.itemTime]);else if(2==t.type)for(var i,n,s,o=e.length,a=0;a<o;){if(i=e[a],n=e[a+1],i==t.itemId&&n==t.itemTime){e.splice(a,2);break}a+=2}r.E.ins.event(l.EventName.UPDATE_BAG),this.checkCouponRed()},t}();e.GiftCtrl=o}),define("src/g/boss/ctrl/HugeDominateViewCtrl",["require","exports","src/g/boss/view/HugeDominateView","../../../manager/LayerManager","src/init/Switches","../../net/messages/OpNoParaC2GS","../../../manager/GameSocketManager"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){s.Switches.ins.on(76,this,this.openHandler)}return t.prototype.openHandler=function(){this._view||(this._view=new i.HugeDominateView),this.getRebirthBossHurtRank(),this._view.refreshData(),this._view.bgview.img_title.skin="res/title/biaoti_dazhuzai.png",n.LayerManager.addInPOPWindowLayer(this._view)},t.prototype.getRebirthBossHurtRank=function(){var t=new o.OpNoParaC2GS;t.optype=o.EOpNopara.getRebirthBossHurtRank,a.GSM.sendServer(t)},t}();e.HugeDominateViewCtrl=r}),define("src/g/accesspop/view/AccessOpenPrompt",["require","exports","../../../config/GameConfig","../../../manager/LayerManager","../../../manager/RunTimeUIManager","../../../utils/UIUtils","../../../core/E","../../../enum/EventName","src/g/clearRes/ClearResM","src/init/GameEventDispatcher"],function(t,e,o,a,r,l,h,c,u,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.defualtAlpha=0,t.on(Laya.Event.CLICK,t,t.close),t}return __extends(t,e),t.prototype.showView=function(t){this._id=t,0==this.defualtAlpha&&(this.defualtAlpha=UIConfig.popupBgAlpha),UIConfig.popupBgAlpha=.9;var e=o.GameConfig.accessCtrlCfg[t];e&&(this.img_icon.skin="dynamic/accessicon/"+t+".png",this.lab_prompt.changeText(e.popPrompt)),this.popup(),i.GE.ins.event(9),Laya.timer.once(4e3,this,this.close)},t.prototype.onClosed=function(){e.prototype.onClosed.call(this),UIConfig.popupBgAlpha=this.defualtAlpha,this.onCloseHandler()},t.prototype.onCloseHandler=function(){Laya.timer.clear(this,this.close);var t=o.GameConfig.accessCtrlCfg[this._id],e=!0;if(t&&t.fly2AccessId){var i=r.RunTimeUIManager.ins.getUI(t.fly2AccessId);if(i&&i.displayedInStage){e=!1;var n=new Laya.Image(this.img_icon.skin),s=l.UIUtils.getGlobalBound(this.img_icon);n.width=this.img_icon.width,n.height=this.img_icon.height,n.x=s.x,n.y=s.y,a.LayerManager.addAlertLayer(n),s=l.UIUtils.getGlobalBound(i),Laya.Tween.to(n,{x:s.x,y:s.y},1e3,Laya.Ease.circOut,new Laya.Handler(this,function(){n.removeSelf(),n.destroy(),u.ClearResM.clearUrl(n.skin),h.E.ins.event(c.EventName.POP_ACCESS_OPEN_PROMPT_COMPLET)}))}}e&&h.E.ins.event(c.EventName.POP_ACCESS_OPEN_PROMPT_COMPLET)},t}(ui.access.AccessOpenPopWInUI);e.AccessOpenPrompt=n}),define("src/g/accesspop/ctrl/AccessPopCtrl",["require","exports","src/g/accessctrl/AccessCenter","../../../core/E","../../../enum/EventName","../../../config/GameConfig","../../../manager/LayerManager","src/g/accesspop/view/AccessOpenPrompt","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){this._waitList=[],i.AccessCenter.ins.inited?this.onInit():n.E.ins.once(s.EventName.ACCESS_CENTER_INITED,this,this.onInit)}return t.prototype.onInit=function(){n.E.ins.on(s.EventName.ACCESS_OPEN,this,this.onAccessOpen)},t.prototype.onAccessOpen=function(t){var e=o.GameConfig.accessCtrlCfg[t];e&&e.popPrompt&&(this._waitList.push(t),this.checkPopPrompt())},t.prototype.checkPopPrompt=function(){this.running||(l.PlayManager.type==h.EPlayType.PLAYTYPE_PAGODA?n.E.ins.once(s.EventName.PLAY_TYPE_CHANGED,this,this.changePlaytype):0<a.LayerManager.getWindowLayerNumChildren()?n.E.ins.once(s.EventName.WINDOW_PANEL_REMOVED,this,this.onWindowClose):this.doPopView())},t.prototype.changePlaytype=function(){this.checkPopPrompt()},t.prototype.onWindowClose=function(){this.checkPopPrompt()},t.prototype.doPopView=function(){0<this._waitList.length&&(this._view||(this._view=new r.AccessOpenPrompt),c.ClearResM.resetViewImg(this._view),this._view.showView(this._waitList.shift()),this.running=!0,n.E.ins.once(s.EventName.POP_ACCESS_OPEN_PROMPT_COMPLET,this,this.onPopComplet))},t.prototype.onPopComplet=function(){this.running=!1,0<this._waitList.length?this.checkPopPrompt():c.ClearResM.clearUrl(this._view.img_di.skin)},t}();e.AccessPopCtrl=u}),define("src/g/fightactivity/ctrl/ActivtyTip",["require","exports","../../../manager/LayerManager","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg","src/g/fight/osprite/play/MainCityManager","src/g/fight/osprite/play/family/SandCityFManager","src/init/Switches","../../../core/E","../../../enum/EventName"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(){l.E.ins.on(h.EventName.GOTO_ACTIVTY,this,this.gotActivity)}return t.prototype.gotActivity=function(t){i.LayerManager.closeAllPOPWindow(),t&&(t.npcid?n.PlayManager.type==s.EPlayType.PLAYTYPE_MAINCITY?o.MainCityManager.getInstance().gotoNpcById(t.npcid):o.MainCityManager.getInstance().ChangeToMainCity({portid:100,npcid:t.npcid}):112==t.gongneng?a.SandCityFManager.getInstance().reqSandCityData():r.Switches.ins.event(t.gongneng))},t}();e.ActivityTip=c}),define("src/g/index/view/ItemView",["require","exports","../../../utils/system/FloatEffect"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.count=1,t.itemId=1,t.on(Laya.Event.CLICK,t,t.clickHandler),t}return __extends(t,e),t.prototype.clickHandler=function(){i.FE.popTip(this.itemId)},t}(ui.index.ItemViewUI);e.ItemView=n}),define("src/g/role/view/ZsRewardDlgView",["require","exports","../../net/messages/ZhuanshengC2GS","../../../manager/GameSocketManager","../../../manager/RoleCenter","../../../utils/ItemUtils","src/g/guide/vo/RewardVo","src/g/account/view/AccItem","../../../enum/enumItem","../../../meta/EquipVo","../../../meta/QualiyVo","../../../meta/ItemVo","src/g/clearRes/ClearResM"],function(t,e,i,n,s,r,a,l,h,c,u,p,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.uvo=null,t.zsvo=null,t.popupEffect=null,t.btn_getReward.on(Laya.Event.CLICK,t,t.onGetBtnClick),t}return __extends(t,e),t.prototype.onGetBtnClick=function(){var t=new i.GetZhuanshengRewardMSG;t.zhuanshenglv=this.zsvo.id,n.GSM.sendServer(t),this.closeDlg()},t.prototype.refreshView=function(){this.uvo=s.RoleCenter.instans.vo;for(var t=this.uvo.getZSReward,e=1;e<=22;e++)if(!(e>this.uvo.zhuanshengLv)&&-1==t.indexOf(e)){this.zsvo=r.ItemUtils.getZhuanShengVoById(e);break}this.clip_lv.value=this.zsvo.id+"",this.refreshReward(),this.refreshImgShow()},t.prototype.refreshReward=function(){var t=this.zsvo.reward;this.panelList.removeChildren(),this.panelList.hScrollBarSkin="";for(var e=new Laya.Sprite,i=0;i<t.length;i++){var n=t[i],s=new a.RewardVo;s.count=n[1],this.getReType(n,s);var o=new l.AccItem;o.eqData=s,e.addChild(o),o.x=e.width,e.width+=o.width}e.height=o.height,this.panelList.addChild(e),e.width>this.panelList.width?e.x=0:e.x=this.panelList.width/2-e.width/2},t.prototype.getReType=function(t,e){var i=null,n=r.ItemUtils.getCurrencyByDefine(t[0]);if(n)return i=n,e.type=h.ItemType.CURRENCY,e.name=n.name,e.quality=u.QualityStruct.Ins.getQColorById(n.quality),e.qualityNum=n.quality,e.define=t[0],e.streamer=n.streamer,void(e.res=r.ItemUtils.getIconByIconId(i.icon));var s=r.ItemUtils.getItemVoById(t[0]);if(s)return i=s,e.type=h.ItemType.ITEM,e.lv=s.uselimit,e.qualityNum=s.quality,e.quality=u.QualityStruct.Ins.getQColorById(s.quality),e.name=s.name,e.id=s.id,e.count=t[1],e.streamer=s.streamer,void(e.res=r.ItemUtils.getIconByIconId(i.icon));var o=r.ItemUtils.getItemOrEq(t[0]);if(o&&o instanceof p.ItemVo)return i=o,e.type=h.ItemType.ZHANWEN,e.lv=s.uselimit,e.qualityNum=s.quality,e.quality=u.QualityStruct.Ins.getQColorById(s.quality),e.name=s.name,e.id=s.id,e.count=t[1],e.streamer=s.streamer,void(e.res=r.ItemUtils.getIconByIconId(i.icon));if(o){if((i=o)instanceof c.EquipVo)e.name=o.name,e.type=h.ItemType.EQ;else{var a=r.ItemUtils.getWingEquipVoById(t[0]);e.name=a.name,e.type=h.ItemType.WING}return e.lv=o.limit,e.qualityNum=o.quality,e.quality=u.QualityStruct.Ins.getQColorById(o.quality),e.id=o.id,e.job=o.job,void(e.res=r.ItemUtils.getIconByIconId(i.icon))}},t.prototype.refreshImgShow=function(){this.img_open.skin="res/role/zhuansheng/uplvdlg/"+this.zsvo.image+".png"},t.prototype.closeDlg=function(){e.prototype.close.call(this),o.ClearResM.clearUrl("res/atlas/res/role/zhuansheng/uplvdlg.json")},t.prototype.close=function(){},t}(ui.role.Reincarnation.ZSRewardDlgUI);e.ZsRewardDlgView=d}),define("src/g/role/ctrl/ZsRewardDlgCtrl",["require","exports","../../../core/E","../../../enum/EventName","src/g/base/BaseCtrl","src/g/role/view/ZsRewardDlgView","src/g/clearRes/ClearResM","../../../manager/RoleCenter","../../../utils/DialogQueue","../../../enum/DialogIDEnum"],function(t,e,n,s,i,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function i(){var t=e.call(this)||this;return t._view=null,(i._ins=t).urls=["res/atlas/res/role/zhuansheng/uplvdlg.json"],n.E.ins.on(s.EventName.ADDED_ZHUANSHENG,t,t.checkHasNotGet),n.E.ins.on(s.EventName.ACCESS_CENTER_INITED,t,t.checkHasNotGet),t}return __extends(i,e),Object.defineProperty(i,"Ins",{get:function(){return i._ins||new i},enumerable:!0,configurable:!0}),i.prototype.checkHasNotGet=function(){for(var t=r.RoleCenter.instans.vo,e=t.getZSReward,i=1;i<=22;i++)if(!(i>t.zhuanshengLv)&&-1==e.indexOf(i))return void this.onZhuanShengAdd()},i.prototype.onZhuanShengAdd=function(){this.opens()},i.prototype.onAtlasLoaded=function(){this.onShowDlg()},i.prototype.onShowDlg=function(){this._view||(this._view=new o.ZsRewardDlgView),a.ClearResM.resetViewImg(this._view),this._view.refreshView(),l.DialogQueue.getInstance().add(h.DialogIDEnum.ZS_REWARD,this._view)},i._ins=null,i}(i.BaseCtrl);e.ZsRewardDlgCtrl=c}),define("src/g/boss/vo/KBossInfo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.teamInfo={},t.selftemid=0,t}();e.KBossInfo=i}),define("src/g/crossserboss/ctrl/CSBossResultCtrl",["require","exports","../../../utils/ItemDropUtil","../../../utils/CountDown","../../../utils/system/ServerTime","../../../utils/SoundUtils","src/g/account/view/AccItem","src/init/TextConst"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){this.countDown=new n.CountDown}return t.prototype.showResult=function(t,e){null==this.view&&this.initView(),this.view.imgGlow.visible=e?(this.view.imgFightResult.skin="res/ksever/jiesuan_zhenyingshengli.png",this.view.imgRewardTitle.skin="res/ksever/jiesuan_zhenyingshengli_jiangli.png",this.view.imGround.skin="res/jiesuan/shenglidi2.png",this.view.imgGlow.rotation=0,Laya.timer.loop(120,this,this.updEffectDisplay),!0):(this.view.imgFightResult.skin="res/ksever/jiesuan_zhenyingzhanbai.png",this.view.imgRewardTitle.skin="res/ksever/jiesuan_zhenyingzhanbai_jiangli.png",!(this.view.imGround.skin="res/jiesuan/shibaibj2.png")),this.view.rewardList.array=i.ItemDropUtil.createRewardList(t),this.countDown.start(s.ServerTime.serverTime+5,this.updCountDownHander,this),this.view.popup()},t.prototype.updCountDownHander=function(t){this.view.closeButton.label=r.TextConst.get(243,t),0==t&&this.view.close()},t.prototype.updEffectDisplay=function(){this.view.imgGlow.rotation+=10},t.prototype.initView=function(){this.view=new ui.crossserver.CSBossResultUI,this.initList(this.view.rewardList,this.rewardRender,a.AccItem),this.view.closeHandler=Laya.Handler.create(this,this.destoryView),this.view.closeButton.on(Laya.Event.CLICK,this,this.closeByButton)},t.prototype.initList=function(t,e,i){t.itemRender=i,t.selectEnable=!0,t.vScrollBarSkin="",t.scrollBar.elasticDistance=100,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.rewardRender=function(t,e){t.eqData=t.dataSource},t.prototype.closeByButton=function(){o.SoundUtils.getInstance().playBtnsounds(),this.view.close()},t.prototype.destoryView=function(){Laya.timer.clear(this,this.updEffectDisplay),this.countDown.stop(),this.view.closeHandler=null,this.view.destroy(!0),this.view=null},t}();e.CSBossResultCtrl=l}),define("src/g/fight/osprite/play/CrossSvrBoss/GamePlayCrossSvrBoss",["require","exports","src/g/fight/osprite/play/RealTimeBossScene","../../../../../manager/GameSocketManager","../../../../../core/E","../../../../../enum/EventName","../../../../../manager/AM","src/g/fight/osprite/play/CrossSvrBoss/CrossSvrBossManager","src/g/fight/osprite/obj/FightGroup","../../../../../config/GameConfig","src/g/fight/osprite/play/baseplay/SvrPeopleBossMonster","../../../../../manager/RoleCenter","../../../../../utils/ItemUtils","../../../../../utils/system/FloatEffect","../../../../../plugin/view/ToolTip","src/g/fight/osprite/SceneObjManager","../../../../../utils/DropUtil","src/g/boss/vo/KBossInfo","../../../../../enum/JobEnum","src/g/crossserboss/ctrl/CSBossResultCtrl","../../../../net/messages/kuafu/AllWorldBattleMsg","src/init/TextConst"],function(t,e,i,a,r,l,n,h,c,s,u,p,d,g,v,f,y,m,_,C,I,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(o){function i(t,e){var i=o.call(this,t)||this;i._ownerFG=null,i._tombStoneMonsterFG=null,i._enterPortId=-1,i._bossStateChangeKey=!1,i._bossRelifeTime=-1,i._lastLeftTime=-1,i._currPortId=0,i._csBossMgr=null,i._selfCampId=-1,i._deadMonUid=0,i._sendaliveflg=!1,i.calculateEnterCondition(),i._csBossMgr=h.CrossSvrBossManager.getIns(),a.GSM.ins.on(I.AllWorldBattleBossHPGS2C.KEY,i,i.onCrossSvrBossHPGS2C);var n=i._csBossMgr.getPortId();i.createAreaMatrixList(n),r.E.ins.on(l.EventName.EXIT_BOSS_PLAYTYPE,i,i.onExitHandler),i.enablePK(!0),i._bossGroup=new c.FightGroup(null),i._csBossMgr.enterGamePlay(i,e);var s=i._csBossMgr.getSettingVal("tombstone");return i._tombStoneMonsterFG=i.createTombStoneMonster(s),i}return __extends(i,o),i.prototype.createTombStoneMonster=function(t){var e=null,i=d.ItemUtils.getMonsterVOById(t);if(i){e=new c.FightGroup(null);var n=new u.SvrPeopleBossMonster(!0,!0);n.moveModulus=0,n.set_DATA(i),e.addFightUnit(n)}return e},i.prototype.getStartPoint=function(){return this.startPt[0]},i.prototype.clear=function(){o.prototype.clear.call(this),r.E.ins.off(l.EventName.EXIT_BOSS_PLAYTYPE,this,this.onExitHandler),this._csBossMgr.exitGamePlay(),this._tombStoneMonsterFG&&(this._tombStoneMonsterFG.destroyGroup(!0),this._tombStoneMonsterFG=null),Laya.timer.clearAll(this)},i.prototype.visibleTombStone=function(t){this._tombStoneMonsterFG&&(t?this._tombStoneMonsterFG.addToFightLayer():this._tombStoneMonsterFG.removeFromFightLayer())},i.prototype.onExitHandler=function(){var t=this._csBossMgr.getPortStatus(this._currPortId);t&&t.bossState==I.EAllWorldBossState.END_CHALLENGE?this.executeExit():n.AM.exitPlay(this.type,new Laya.Handler(this,function(){this.executeExit()}))},i.prototype.onPKEndMUSG2C=function(t){o.prototype.onPKEndMUSG2C.call(this,t),console.log(t,"------------收到pk结果消息");var e=t.pksrc;if(t.win&&(e=t.pktarget),e==p.RoleCenter.instans.vo.username){var i=1e3*this._csBossMgr.getSettingVal("rebornTime")+100;Laya.timer.once(i,this,this.rebrithUser),this._csBossMgr.showDeath(i)}},i.prototype.rebrithUser=function(){this._csBossMgr.sendReborn(),Laya.timer.once(2e3,this,this.checkAgain),this._sendaliveflg=!0},i.prototype.checkAgain=function(){this._sendaliveflg?this.rebrithUser():Laya.timer.clear(this,this.checkAgain)},i.prototype.init=function(t){o.prototype.init.call(this,t),this.enterfail&&this.returnbackHangUp()},i.prototype.onActivityRebirthGS2C=function(t){this.resetHero(t.userAcc,t.posx,t.posy);var e=this._playerDic[t.userAcc];e&&console.log(e.getNickName(),"------------复活消息"),p.RoleCenter.instans.vo.username==t.userAcc&&(this._sendaliveflg=!1,Laya.timer.clear(this,this.checkAgain)),e?this.updateColor(e):console.error("跨服Boss--找不到复活的角色：userName="+t.userAcc),o.prototype.onActivityRebirthGS2C.call(this,t)},i.prototype.onAwStageStartGS2C=function(t){for(var e=null,i=null,n=t.teamInfo,s=0;s<n.length;s++){i=n[s];for(var o=0;o<i.unamelist.length;o++)(e=i.unamelist[o])==p.RoleCenter.instans.self.username&&(this._selfCampId=i.teamid,m.KBossInfo.selftemid=this._selfCampId)}for(s=0;s<n.length;s++){i=n[s];for(o=0;o<i.unamelist.length;o++)e=i.unamelist[o],this.allocationCamp(e,i.teamid)}},i.prototype.allocationCamp=function(t,e){var i=this._playerDic[t];i?(i.campId=e,i.campId!=this._selfCampId&&this.addEnemy(i),this.updateColor(i)):console.error("跨服Boss要分配阵营的角色找不到：userName = "+t)},i.prototype.updateColor=function(t){t.setCampType(t.campId==this._selfCampId)},i.prototype.addEnemy=function(t){o.prototype.addPPlayer.call(this,t)},i.prototype.onAwTeamInfoChgGS2C=function(t){1==t.chgtype&&this.allocationCamp(t.username,t.teamid)},i.prototype.onSelectPkTarget=function(t){var e=this._playerDic[t];e&&(-1==e.campId?(g.FE.upItems(b.TextConst.get(420),v.BubbleEnum.center),console.error("对方没有阵营:username:"+t)):e.campId!=this._selfCampId?o.prototype.onSelectPkTarget.call(this,t):g.FE.upItems(b.TextConst.get(421),v.BubbleEnum.center))},i.prototype.onMsgEnter=function(t){return o.prototype.onMsgEnter.call(this,t)},i.prototype.setMainRoleByMsg=function(t){o.prototype.setMainRoleByMsg.call(this,t),t.opresult&&(this._currPortId=t.portid,this.showMonster(this._csBossMgr.getPortId(),t.monsterUid),t.enter&&(p.RoleCenter.instans.vo.MUSBCNT=p.RoleCenter.instans.vo.MUSBCNT-1))},i.prototype.showMonster=function(t,e){this._bossGroup.destroyGroup(!1),this.releaseAllMonsterRes();var i=s.GameConfig.getPortByID(t),n=s.GameConfig.getMapJSON(i.boss_scene);n&&0<n.bossXY.length&&(this._monsterDic[-1]=this.createMonster(this._bossGroup,i.boss,e),this._bossGroup.resetFightGroup(n.bossXY[0]),this._bossGroup.setMapXY(n.bossXY[0][0],n.bossXY[0][1]),this._tombStoneMonsterFG&&this._tombStoneMonsterFG.setMapXY(n.bossXY[0][0],n.bossXY[0][1])),this.updateBossState(t)},i.prototype.updateBossState=function(t){t==this._currPortId&&(this._bossStateChangeKey=!0)},Object.defineProperty(i.prototype,"portId",{get:function(){return this._currPortId},enumerable:!0,configurable:!0}),i.prototype.onBossReviveGS2C=function(t){this._csBossMgr.getPortId()==t.portid&&this.showMonster(t.portid,t.monsterUid)},i.prototype.attackBoss=function(){this.startKillMonster()},i.prototype.gotoBoss=function(t){void 0===t&&(t=0),t||(t=this._csBossMgr.getPortId());var e=s.GameConfig.getPortByID(t),i=s.GameConfig.getMapJSON(e.boss_scene);i&&0<i.bossXY.length&&this.followTargetPos(i.bossXY[0][0],i.bossXY[0][1])},i.prototype.onCrossSvrBossHPGS2C=function(t){if(this._monsterDic[t.monsterUid]){var e=this._monsterDic[t.monsterUid].getTotalHp();this._csBossMgr.setMonsterHp(Math.floor(t.bossHP/e*1e4)/100),0==(e=~~t.bossHP)&&(this._deadMonUid=t.monsterUid,e=1),this.setMonsterHp(t.monsterUid,e,!0)}},i.prototype.onCSBossEndGS2C=function(t){this._bossGroup.assignMonsterDrop(t.invent),this._bossGroup.getFUList()[0].dropProcess=!0,this.setMonsterHp(this._deadMonUid,0,!0),this.bossDead();var e=!1;this._fightGroup&&this._fightGroup.campId==t.ownerteamid&&(e=!0),p.RoleCenter.instans.addInventoryToC(t.invent,!0),y.DropUtil.isfly=!0,Laya.timer.once(i.ITEM_GETDEALY,this,function(){this._fightGroup.setPITarget(f.SceneObjManager.instans.totalDrops)}),this._csBossMgr.setState(_.KState.bossdeath),Laya.timer.once(3.8*i.ITEM_GETDEALY,this,function(){(new C.CSBossResultCtrl).showResult(t.invent,e)})},i.prototype.setBossOwner=function(t){this._ownerFG=t,this._bossGroup&&!this._bossGroup.isDeath()&&this._bossGroup.setOnceTarget(this._ownerFG)},i.prototype.executeExit=function(){this._csBossMgr.exitCrossSvrBoss(),a.GSM.ins.off(I.AllWorldBattleBossHPGS2C.KEY,this,this.onCrossSvrBossHPGS2C)},i.prototype.calculateEnterCondition=function(){return!0},i.prototype.setEnterPortId=function(t){this._enterPortId=t},i.prototype.frameMove=function(){if(o.prototype.frameMove.call(this),this._fightGroup.isDeath(),this._ownerFG&&this._csBossMgr.updateBossOwnerHp(this._ownerFG.getHp(),this._ownerFG.getTotalHp()),this._bossStateChangeKey){this._bossStateChangeKey=!1;var t=this._csBossMgr.getPortStatus(this._currPortId);if(t)switch(t.bossState){case I.EAllWorldBossState.WAIT_CHALLENGE:case I.EAllWorldBossState.END_CHALLENGE:this._lastLeftTime=-1,this.visibleBossFG(!1),this.visibleTombStone(!0);break;case I.EAllWorldBossState.CAN_CHALLENGE:this.visibleBossFG(!0),this._csBossMgr.setState(_.KState.bosslive),this.visibleTombStone(!1)}else this.visibleBossFG(!1),this.visibleTombStone(!1)}},i.ITEM_GETDEALY=700,i}(i.RealTimeBossScene);e.GamePlayCrossSvrBoss=o}),define("src/g/boss/view/KSeverView",["require","exports","src/g/boss/vo/KBossInfo","../../../enum/EventName","../../../core/E","../../../utils/ItemUtils","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg","src/g/fight/osprite/play/CrossSvrBoss/CrossSvrBossManager","../../../utils/system/ServerTime","src/init/GameMain","src/g/clearRes/ClearResM","../../net/messages/kuafu/AllWorldBattleMsg"],function(t,e,a,s,o,r,n,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(t){var e=i.call(this)||this;return e.lefttime=0,e.leftList.vScrollBarSkin="",e.rightList.vScrollBarSkin="",e.selecticon.removeSelf(),e.leftList.renderHandler=new Laya.Handler(e,e.leftHandler),e.rightList.selectEnable=!0,e.rightList.mouseHandler=new Laya.Handler(e,e.mselecHandler),e.leftList.scrollBar.elasticDistance=100,e.rightList.renderHandler=new Laya.Handler(e,e.rightHandler),e.rightList.scrollBar.elasticDistance=100,o.E.ins.on(s.EventName.PLAY_TYPE_CHANGED,e,e.removeHandler),e.bossvo=r.ItemUtils.getBossId(t),e.bossicon.skin=r.ItemUtils.getBossIccon(e.bossvo.port),e.m_name.text=e.bossvo.name,e.btn_attBoss.on(Laya.Event.CLICK,e,e.clickHandler),e.btn_attower.on(Laya.Event.CLICK,e,e.owerHandler),e.height=Laya.stage.height-200,e.updateTime(),o.E.ins.on(s.EventName.CHANGE_PK_TARGET,e,e.attackTargetChangedHander),e}return __extends(t,i),t.prototype.attackTargetChangedHander=function(t){this.selecticon.visible=!!t,this.refreshRight()},t.prototype.refreshRight=function(){Laya.timer.callLater(this,this.delayHandler)},t.prototype.delayHandler=function(){var t=this.rightList.array;if(t){for(var e=[],i=[],n=0;n<t.length;n++){var s=t[n],o=a.KBossInfo.teamInfo[s];o&&o.isDeath()?i.push(t[n]):e.push(t[n])}this.rightList.dataSource=e.concat(i),this.leftList.refresh()}},t.prototype.updateTime=function(){this.timecon.visible=!1,Laya.timer.clearAll(this);var t=h.CrossSvrBossManager.getIns().getPortStatus(this.bossvo.port);t&&(this.lefttime=t.leftOpenTime-c.ServerTime.serverTime,t.bossState==d.EAllWorldBossState.WAIT_CHALLENGE&&0<this.lefttime&&(Laya.timer.loop(1e3,this,this.loopHandler),this.timecon.visible=!0))},t.prototype.loopHandler=function(){var t=this.lefttime--;this.time_font.value=t+"",t<=0&&(Laya.timer.clearAll(this),this.timecon.visible=!1,this.btn_attBoss.visible=!0)},t.prototype.clickHandler=function(){o.E.ins.event(s.EventName.attboss)},t.prototype.owerHandler=function(){var t=h.CrossSvrBossManager.getIns().getOwer();o.E.ins.event(s.EventName.pkOther,t)},t.prototype.updateBtn=function(){},t.prototype.removeHandler=function(){n.PlayManager.type!=l.EPlayType.PLAYTYPE_ALLWORLDBOSS&&(this.removeSelf(),Laya.timer.clearAll(this),p.ClearResM.clearResFolder("ksever/"),o.E.ins.off(s.EventName.PLAY_TYPE_CHANGED,this,this.removeHandler),o.E.ins.off(s.EventName.CHANGE_PK_TARGET,this,this.attackTargetChangedHander))},t.prototype.mselecHandler=function(t){if(t.type==Laya.Event.CLICK){var e=this.rightList.selectedIndex;if(this.rightList&&this.rightList.length&&0<=e){var i=this.rightList.array[e];o.E.ins.event(s.EventName.pkOther,i);var n=this.rightList.getCell(e);n&&(this.selecticon.visible=!0,n.addChildAt(this.selecticon,0))}}},t.prototype.leftHandler=function(t,e){var i=this.leftList.array[e];i&&this.setInofo(t,e,i)},t.prototype.rightHandler=function(t,e){var i=this.rightList.array[e];this.setInofo(t,e,i)},t.prototype.setInofo=function(t,e,i){var n=t.getChildByName("role_name"),s=t.getChildByName("role_icon"),o=a.KBossInfo.teamInfo[i];o&&(o.isDeath()?t.gray=!0:t.gray=!1,o.userData?n.text=u.GameMain.getDisSvrId(o.userData.username)+o.getNickName():o.otherData&&(n.text=u.GameMain.getDisSvrId(o.otherData.username)+o.getNickName()),s.skin=r.ItemUtils.getHeadurlYuan(o.getSex(),o.getJob()))},t}(ui.boss.KServerBossViewUI);e.KSeverView=i}),define("src/g/boss/view/RankKFItem",["require","exports","../../../manager/RoleCenter","src/g/fight/osprite/SceneObjCtroller","src/init/GameMain","src/init/TextConst"],function(t,e,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function n(){var t=i.call(this)||this,e=o.SceneObjCtroller.ins.getSelfGroup();return n.selfteam=e.campId,t}return __extends(n,i),n.prototype.setData=function(t,e){t&&(this.select.visible=!1,this.rolename.text=a.GameMain.getDisSvrId(t.username)+t.nickname,this.sc_txt.text=t.scorenum+"",t.username==s.RoleCenter.instans.vo.username&&(this.select.visible=!0),t.team_id==n.selfteam?this.team_txt.text=r.TextConst.get(302):this.team_txt.text=r.TextConst.get(303),this.font_value.visible=3<=e?(this.rank_icon.visible=!1,this.font_value.value=e+1+"",!0):(this.rank_icon.skin=0==e?"res/rank/new/paihang_huizhang1st.png":1==e?"res/rank/new/paihang_huizhang2st.png":2==e?"res/rank/new/paihang_huizhang3st.png":"",this.rank_icon.restskin(),!1))},n.selfteam=0,n}(ui.boss.KFRankItemUI);e.RankKFItem=i}),define("src/g/boss/ctrl/KSeverViewCtrl",["require","exports","src/g/boss/view/KSeverView","../../../manager/LayerManager","src/g/worldboss/ctrl/Death","../../../utils/ItemUtils","src/g/fight/osprite/SceneObjCtroller","../../../enum/JobEnum","src/g/boss/view/RankKFItem","src/g/clearRes/ClearResM","src/g/boss/vo/KBossInfo","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(){function t(t){this._view=new i.KSeverView(t),this._view.see_rank.on(Laya.Event.CLICK,this,this.seeRankHandler),this._death=new s.Death(u.TextConst.get(285))}return t.prototype.seeRankHandler=function(){this._rank=new ui.boss.KFRankViewUI,this._rank.rankList.itemRender=l.RankKFItem,this._rank.rankList.vScrollBarSkin="",this._rank.rankList.scrollBar.elasticDistance=100,this._rank.rankList.dataSource=this._rankList.scoreRank,this._rank.popup(),this._rank.bg.btn_back.once(Laya.Event.CLICK,this,this.closeHandler),this._rank.bg.btn_close.once(Laya.Event.CLICK,this,this.closeHandler),this._rank.rankList.renderHandler=new Laya.Handler(this,this.rankHandler)},t.prototype.closeHandler=function(){this._rank.close()},t.prototype.rankHandler=function(t,e){t.setData(this._rankList.scoreRank[e],e)},t.prototype.showView=function(){n.LayerManager.addInUILayer(this._view),h.ClearResM.resetViewImg(this._view)},t.prototype.hideView=function(){this._view.removeSelf()},t.prototype.setState=function(t){switch(t){case r.KState.bosslive:this._view.mon_con.visible=!0,this._view.btn_con.visible=!0;break;case r.KState.bossdeath:this._view.mon_con.visible=!1,this._view.btn_con.visible=!1}},t.prototype.updateRank=function(t){this._rankList=t,this._view.one_name.text=t.scoreRank[0].nickname,this._view.one_sc.text=t.scoreRank[0].scorenum+""},t.prototype.updateBossOwnerHp=function(t,e){this._view.ower_con.visible=!(t<=0),this._view.owerhp.width=t/e*80},t.prototype.updateBossState=function(t){this._view.updateTime()},t.prototype.updateRoleState=function(t){this._view.refreshRight()},t.prototype.updateBossHp=function(t){this._view.m_hp.text=t+"%",this._view.m_hpbg.width=t/100*380},t.prototype.updateBossOwner=function(t){if(t){this._view.ower_con.visible=!0,this._view.ower_name.text=t.getNickName(),this._view.owericon.skin=o.ItemUtils.getHeadurlYuan(t.getSex(),t.getJob());var e=a.SceneObjCtroller.ins.getSelfGroup();t.campId==e.campId?(this._view.flgicon.skin="res/ksever/you.png",this._view.flgbg.skin="res/ksever/01.png",this._view.btn_attower.visible=!1,this._view.btn_attBoss.visible=!0):(this._view.flgicon.skin="res/ksever/di.png",this._view.flgbg.skin="res/ksever/02.png",this._view.btn_attower.visible=!0,this._view.btn_attBoss.visible=!1)}else this._view.ower_con.visible=!1,this._view.btn_attower.visible=!1,this._view.btn_attBoss.visible=!0},t.prototype.temInfoList=function(t){var e=[],i=[];i=0==c.KBossInfo.selftemid?(e=e.concat(t[0].unamelist),i.concat(t[1].unamelist)):(e=e.concat(t[1].unamelist),i.concat(t[0].unamelist)),this._view.leftList.dataSource=e,this._view.rightList.dataSource=i,this._view.left_num.text=this._view.leftList.array.length+"",this._view.right_num.text=this._view.rightList.array.length+"";var n=100*this._view.rightList.array.length,s=100*this._view.leftList.array.length;500<=n&&(n=500),500<=s&&(s=500),this._view.rightList.height=n,this._view.leftList.height=s,this._view.left_bg.height=this._view.leftList.height+30,this._view.right_bg.height=this._view.rightList.height+30},t.prototype.showDeath=function(t){this._death.start("",null,t/1e3>>0,0),this._view.addChild(this._death),this._death.centerX=0,this._death.centerY=0,this._death.fuhuoButton.visible=!1},t.prototype.hideDeth=function(){this._death.close()},t}();e.KSeverViewCtrl=p}),define("src/g/fight/osprite/play/CrossSvrBoss/CrossSvrBossManager",["require","exports","../../../../../core/E","../../../../../enum/EventName","../../../../../manager/GameSocketManager","../../../../../config/GameConfig","../../../../../manager/RoleCenter","../../../../../utils/system/FloatEffect","../../../../../plugin/view/ToolTip","../../../../../utils/system/ServerTime","src/g/fight/info/PlayTypeVo","../../../../net/messages/ChangeSceneMsg","../../../../net/messages/EnterMuSceneC2GS","src/init/TextConst","../../../../net/messages/ActivityMessage","../../../../../manager/AM","src/g/fight/osprite/play/PlayManager","src/g/boss/ctrl/KSeverViewCtrl","src/g/boss/vo/KBossInfo","../../../../net/messages/chat/ChatGS2C","../../../../net/messages/chat/ChatC2GS","src/g/index/ctrl/BossTipCtrl","../../../../net/messages/kuafu/AllWorldBattleMsg"],function(t,e,a,r,o,i,l,h,c,u,p,d,g,v,f,y,m,_,C,n,s,I,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var w=function(){function t(){this.gamePlay=null,this._csBossOpenStateMsg=null,this._bossVoDic={},this._bossInfoDic={},this._ownerFG=null,this._enterPortId=-1,this._enterTime=0,this._openPanelKey=!1,this.viewCtrl=null,this._curCSBossId=0,this._teamInfo=[],this._scoreRank=null,this._owername="";var t=o.GSM.ins;t.on(b.AllWorldBattleBossStateAll.KEY,this,this.onBattleBossStateAll),t.on(b.AllWorldBattleBossStateGS2C.KEY,this,this.bossStateChange)}return t.getIns=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.getPortId=function(){return t.getIns().getCSBossVo(this._curCSBossId).port},t.prototype.onCSBossActOpenState=function(t){this._csBossOpenStateMsg=t,a.E.ins.event(r.EventName.CROSSVR_BOSS_ACTIVITY)},t.prototype.ActOpenState=function(){return this._csBossOpenStateMsg},t.prototype.getPortStatus=function(t){return this._bossInfoDic[t]},t.prototype.enterGamePlay=function(t,e){a.E.ins.event(r.EventName.CROSSSVRBOSS_SCEPANEL),this.bossid=e;var i=o.GSM.ins;i.on(b.AllWorldBattleBossEndGS2C.KEY,this,this.onCSBossEndGS2C),i.on(f.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),i.on(f.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChangeGS2C),i.on(g.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C),i.on(b.AllWorldStageStartGS2C.KEY,this,this.onAwStageStartGS2C),i.on(b.AWTeamInfoChgGS2C.KEY,this,this.onAwTeamInfoChgGS2C),i.on(b.AllWorldScoreRank.KEY,this,this.onAwScoreRankGS2C),this.viewCtrl=new _.KSeverViewCtrl(e),this.viewCtrl.showView(),this.setBossOwner(null),this.gamePlay=t,C.KBossInfo.teamInfo=this.gamePlay.playerDic,-1!=this._enterPortId&&(this.gamePlay.setEnterPortId(this._enterPortId),this._enterPortId=-1);var n=this.getPortId(),s=this.gamePlay.getStartPoint();this.gamePlay.sendEnterMuSceneC2GS(!0,n,s[0],s[1]),a.E.ins.on(r.EventName.pkOther,this,this.selectPKHandler),a.E.ins.on(r.EventName.attboss,this,this.attBossHandler)},t.prototype.attBossHandler=function(){this.gamePlay.attackBoss()},t.prototype.selectPKHandler=function(t){this.gamePlay&&this.gamePlay.onSelectPkTarget(t)},t.prototype.onAwStageStartGS2C=function(t){this._teamInfo=t.teamInfo,this.gamePlay&&this.gamePlay.onAwStageStartGS2C(t),this.viewCtrl.temInfoList(this._teamInfo),t.owneruname&&this.initOwer(t.owneruname)},t.prototype.onAwScoreRankGS2C=function(t){this._scoreRank=t,this.viewCtrl.updateRank(t)},t.prototype.pkUser=function(t){this.gamePlay&&this.gamePlay.pkStartAndTestDistance(t)},t.prototype.onAwTeamInfoChgGS2C=function(t){switch(this.gamePlay&&this.gamePlay.onAwTeamInfoChgGS2C(t),t.chgtype){case 1:this.addMember(t.teamid,t.username);break;case 2:this.removeMember(t.teamid,t.username)}},t.prototype.addMember=function(t,e){this._teamInfo[t].unamelist.push(e),this.viewCtrl.temInfoList(this._teamInfo)},t.prototype.removeMember=function(t,e){var i=this._teamInfo[t].unamelist.indexOf(e);-1<i?this._teamInfo[t].unamelist.splice(i,1):console.error("跨服Boss队伍“{0}”找不到成员{1}".replace("{0}",t.toString()).replace("{1}",e)),this.viewCtrl.temInfoList(this._teamInfo)},t.prototype.onCSBossEndGS2C=function(t){a.E.ins.event(r.EventName.OPEN_CSBOSS_RESULT,t),this.gamePlay&&this.gamePlay.portId==t.portid&&(this.gamePlay.onCSBossEndGS2C(t),this.setBossOwner(null))},t.prototype.showDeath=function(t){this.viewCtrl.showDeath(t)},t.prototype.onActivityRebirthGS2C=function(t){this.gamePlay&&this.gamePlay.onActivityRebirthGS2C(t),t.opresult?(t.userAcc==l.RoleCenter.instans.self.username&&(l.RoleCenter.instans.vo.GOLD-=t.decGold,this.viewCtrl&&this.viewCtrl.hideDeth()),this.viewCtrl.updateRoleState(t.userAcc)):console.error(t.error)},t.prototype.onEnterMuSceneGS2C=function(t){if(t.opresult)t.enter?this.gamePlay&&this.gamePlay.setMainRoleByMsg(t):this.gamePlay?this.gamePlay.returnbackHangUp():Laya.timer.once(1e3,this,function(){a.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,p.PlayTypeVo.create(d.EPlayType.PLAYTYPE_PORT)),h.FE.upItems(v.TextConst.showErrorInfo(t.error),c.BubbleEnum.center)});else{this.gamePlay?this.gamePlay.returnbackHangUp():Laya.timer.once(1e3,this,function(){a.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,p.PlayTypeVo.create(d.EPlayType.PLAYTYPE_PORT)),h.FE.upItems(v.TextConst.showErrorInfo(t.error),c.BubbleEnum.center)});var e=new n.ChatGS2C;e.type=s.enumChatType.system,e.msg=v.TextConst.showErrorInfo(t.error)+t.error,a.E.ins.event(r.EventName.SEND_UNREAL_CHAT,[e]),h.FE.upItems(v.TextConst.get(812),c.BubbleEnum.center)}},t.prototype.exitGamePlay=function(){this.gamePlay=null;var t=o.GSM.ins;t.off(b.AllWorldBattleBossEndGS2C.KEY,this,this.onCSBossEndGS2C),t.off(f.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),t.off(f.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChangeGS2C),t.off(g.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C),t.off(b.AllWorldStageStartGS2C.KEY,this,this.onAwStageStartGS2C),t.off(b.AWTeamInfoChgGS2C.KEY,this,this.onAwTeamInfoChgGS2C),t.off(b.AllWorldScoreRank.KEY,this,this.onAwScoreRankGS2C),a.E.ins.off(r.EventName.pkOther,this,this.selectPKHandler),a.E.ins.off(r.EventName.attboss,this,this.attBossHandler)},t.prototype.setMonsterHp=function(t){this.viewCtrl&&this.viewCtrl.updateBossHp(t)},t.prototype.exitCrossSvrBoss=function(){if(this.gamePlay){var t=this.getCSBossVo(this._curCSBossId).port;this.gamePlay.sendEnterMuSceneC2GS(!1,t,0,0)}},t.prototype.getCSBossVo=function(t){var e=i.GameConfig.crossSvrBossVo[t];return e||null},t.prototype.getSettingVal=function(t){var e=i.GameConfig.msBOSSsettingVo[t];return e?e.value:(console.error("CrossSvrBossManager::getSettingVal:key="+t),0)},t.prototype.reqOpenBossInfoPanel=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!0);var i=new b.AllWorldBattleBossStateC2GS;i.portid=t,i.requestAll=0==t,o.GSM.sendServer(i),this._openPanelKey=e},t.prototype.openBossInfoPanel=function(){a.E.ins.event(r.EventName.CROSSSVR_BOSS_INITED)},t.prototype.onBattleBossStateAll=function(t){for(var e=null,i=0;i<t.bossStateArr.length;i++)e=t.bossStateArr[i],this._bossInfoDic[e.portid]=e;this._openPanelKey&&(this._openPanelKey=!1,this.openBossInfoPanel()),a.E.ins.event(r.EventName.CSBOSS_DATA_UPDATE),I.BossTipCtrl.updateBoss()},t.prototype.bossStateChange=function(t){this._bossInfoDic[t.portid]=t,this.gamePlay&&this.gamePlay.updateBossState(t.portid),I.BossTipCtrl.updateBoss(),a.E.ins.event(r.EventName.CSBOSS_DATA_UPDATE),this.viewCtrl&&this.viewCtrl.updateBossState(t)},t.prototype.onCSBossReviveGS2C=function(t){var e=this._bossInfoDic[t.portid];e&&(e.bossState=b.EAllWorldBossState.CAN_CHALLENGE,this.bossStateChange(e),this.reqOpenBossInfoPanel(t.portid),0==this.checkChangeCondition(e.portid)&&a.E.ins.event(r.EventName.CS_BOSSREVIVE,e)),this.gamePlay&&this.gamePlay.onBossReviveGS2C(t)},t.prototype.checkChangeCondition=function(t){return 0},t.prototype.getOwer=function(){return this._owername},t.prototype.initOwer=function(t){if(""==t)this.setBossOwner(null),this._owername="";else{var e=this.gamePlay.getPlayerFG(t);this._owername=t,this.setBossOwner(e)}},t.prototype.onBossOwnerChangeGS2C=function(t){if(""==t.newowner)this.setBossOwner(null),this._owername="";else{var e=this.gamePlay.getPlayerFG(t.newowner);this._owername=t.newowner,this.setBossOwner(e)}},t.prototype.updateBossOwner=function(t){this.viewCtrl&&this.viewCtrl.updateBossOwner(t)},t.prototype.setState=function(t){this.viewCtrl.setState(t)},t.prototype.setBossOwner=function(t){this._ownerFG!=t&&(this._ownerFG=t,this.updateBossOwner(t)),this.gamePlay&&this.gamePlay.setBossOwner(t)},t.prototype.updateBossOwnerHp=function(t,e){this.viewCtrl&&this.viewCtrl.updateBossOwnerHp(t,e)},t.prototype.sendReborn=function(){if(this.gamePlay){var t,e=new f.ActivityRebirthC2GS;e.acttype=f.EACT_TYPE.allWorldBoss,e.freeRebirth=!0,t=this.gamePlay.getStartPoint(),e.posx=t[0],e.posy=t[1],o.GSM.sendServer(e)}else console.error("不在玩法中")},t.prototype.checkIsEnter=function(t){var e=this.getCSBossVo(t);if(l.RoleCenter.instans.vo.getCurLv()<e.limit1)return 2;if(!this._csBossOpenStateMsg.allworldbattleOpen)return 0;var i=this.getCSBossVo(t);if(!i)return 6;var n=this.getPortStatus(i.port);return n&&n.bossState!=b.EAllWorldBossState.WAIT_CHALLENGE&&n.bossState!=b.EAllWorldBossState.CAN_CHALLENGE?5:3},t.prototype.enterCrossSvrBoss=function(t){if(void 0===t&&(t=1001),!l.RoleCenter.instans.bagRoomEnough())return y.AM.showBagNotEnough(),!1;if(m.PlayManager.isSpecialPlay())return h.FE.upItems(v.TextConst.get(406),c.BubbleEnum.center),!1;var e=this.checkIsEnter(t);switch(e){case 0:h.FE.upItems(v.TextConst.get(414),c.BubbleEnum.center);break;case 6:h.FE.upItems(v.TextConst.get(415),c.BubbleEnum.center);break;case 4:h.FE.upItems(v.TextConst.get(416),c.BubbleEnum.center);break;case 5:h.FE.upItems(v.TextConst.get(417),c.BubbleEnum.center);break;case 1:var i=this._enterTime-u.ServerTime.serverTime,n=v.TextConst.get(418,i);h.FE.upItems(n,c.BubbleEnum.center);break;case 2:var s=v.TextConst.get(419);h.FE.upItems(s,c.BubbleEnum.center);break;case 3:var o=p.PlayTypeVo.create(d.EPlayType.PLAYTYPE_ALLWORLDBOSS,t);this._curCSBossId=t,a.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,o)}return 3==e},t.prototype.bossStateData=function(t){return this._bossInfoDic[t]},t._instance=null,t}();e.CrossSvrBossManager=w}),define("src/g/crossserboss/ctrl/CSerBossInfo",["require","exports","src/g/account/view/AccItem","../../../utils/ItemDropUtil","src/g/fight/osprite/play/CrossSvrBoss/CrossSvrBossManager","../../../manager/RoleCenter","../../../utils/system/DateUitl","../../../core/E","../../../enum/EventName","../../net/messages/kuafu/AllWorldBattleMsg"],function(t,e,n,i,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(t,e,i){this.vo=t,this.rewardScale=i,this.rewardList=e.rewardList,this.imgRefresh=e.imgRefresh,this.imgCD=e.imgCD,this.enterButton=e.enterButton,this.enterBtnAni=e.enterButtonAni,this.enterButton.on(Laya.Event.CLICK,this,this.enterHander),this.initList(this.rewardList,this.rankRenderHander,n.AccItem)}return t.prototype.initList=function(t,e,i){t.selectEnable=!0,t.itemRender=i,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.rankRenderHander=function(t,e){t.eqData=t.dataSource,t.scaleX=t.scaleY=this.rewardScale,t.lv_txt.visible=!1,this.updJiaoBiao(t)},t.prototype.updJiaoBiao=function(t){var e=t.dataSource,i=t.getChildByName("jiaobiao");-1==this.vo.personReward.indexOf(e.id)?i&&i.removeSelf():(null==i&&((i=new Laya.Image).skin="res/csboss/gerenBOSS_paiming.png"),t.addChild(i),i.x=18,i.y=12)},t.prototype.updateReward=function(){var t=this.vo.showReward.concat(this.vo.personReward);this.rewardList.array=i.ItemDropUtil.createPortRewardData(t)},t.prototype.updateStatus=function(){var t=s.CrossSvrBossManager.getIns().bossStateData(this.vo.port);if(null==t)return console.log("csboss没有状态数据"),void this.hideInFo();var e=s.CrossSvrBossManager.getIns().getCSBossVo(this.vo.id);console.log("跨服boss_"+this.vo.id+"的状态"+t.bossState),e?o.RoleCenter.instans.vo.getCurLv()>=e.limit1?t.bossState==h.EAllWorldBossState.WAIT_CHALLENGE||t.bossState==h.EAllWorldBossState.CAN_CHALLENGE?(this.imgCD.visible=this.imgRefresh.visible=!1,this.enterButton.visible=this.enterBtnAni.visible=!0,this.enterBtnAni.play()):(this.imgCD.visible=this.imgRefresh.visible=!0,this.enterButton.visible=this.enterBtnAni.visible=!1,this.enterBtnAni.stop(),this.imgCD.value=a.DateUtil.getHM(1e3*t.leftOpenTime)):this.hideInFo():console.warn("CSerBossInfo:配置表中没有boss")},t.prototype.hideInFo=function(){this.imgCD.visible=this.imgRefresh.visible=this.enterButton.visible=this.enterBtnAni.visible=!1,this.enterBtnAni.stop()},t.prototype.enterHander=function(){r.E.ins.event(l.EventName.CROSSSVR_BOSS_VIEW,this.vo)},t.prototype.clear=function(){this.rewardList.array=[],this.hideInFo()},t}();e.CSerBossInfo=c}),define("src/g/crossserboss/ctrl/CSBossViewCtrl",["require","exports","../../../core/E","../../../enum/EventName","src/g/clearRes/ClearResM","../../../component/GAnimation","../../../utils/ItemUtils","src/g/account/view/AccItem","../../../utils/ItemDropUtil","src/g/fight/osprite/play/CrossSvrBoss/CrossSvrBossManager","src/g/fight/base/RES"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){i.E.ins.on(n.EventName.CROSSSVR_BOSS_VIEW,this,this.openViewHander)}return t.prototype.openViewHander=function(t){this.vo=t,null==this.view&&(this.view=new ui.crossserver.CSBossViewUI,this.view.bgView.img_title.skin="res/csboss/kuafu_biaoti.png",this.view.bgView.btn_back.visible=!1,this.view.bgView.btn_close.on(Laya.Event.CLICK,this,this.closeView,[!0]),this.view.challenageButton.on(Laya.Event.CLICK,this,this.challenageHander),s.ClearResM.addBgUrl(this.view.imgGround.skin),this.animation=new o.GAnimation,this.animation.x=270,this.animation.y=410,this.view.addChild(this.animation)),this.view.imgGround.restskin(),this.updBossTitle(),this.refreshMonster(),this.initList(this.view.rewardList,this.rankRenderHander,r.AccItem);var e=this.vo.showReward.concat(this.vo.personReward),i=l.ItemDropUtil.createPortRewardData(e);this.view.rewardList.repeatX=i.length,this.view.rewardList.array=i,this.view.popup()},t.prototype.updJiaoBiao=function(t){var e=t.dataSource,i=t.getChildByName("jiaobiao");-1==this.vo.personReward.indexOf(e.id)?i&&i.removeSelf():(null==i&&((i=new Laya.Image).skin="res/csboss/gerenBOSS_paiming.png"),t.addChild(i),i.x=18,i.y=12)},t.prototype.updBossTitle=function(){switch(this.vo.id){case 1301:this.view.imgBossName.skin="res/csboss/kuafu_bossming_002.png";break;case 1302:this.view.imgBossName.skin="res/csboss/kuafu_bossming_001.png";break;case 1303:this.view.imgBossName.skin="res/csboss/kuafu_bossming_003.png"}},t.prototype.refreshMonster=function(){var t=a.ItemUtils.getMonsterVOById(a.ItemUtils.getPortVoById(this.vo.port).boss[0]),e=1;-1==t.moResVo.dir.indexOf(5)?(this.murl=c.RES.MONSTER_PATH+t.moResVo.res+"/3_r.json",e=-t.zoom):(e=t.zoom,this.murl=c.RES.MONSTER_PATH+t.moResVo.res+"/5_r.json");var i=this.animation;i&&(i.clear(!0),i.load(this.murl),i.scale(e,t.zoom))},t.prototype.initList=function(t,e,i){t.selectEnable=!0,t.itemRender=i,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.rankRenderHander=function(t,e){t.eqData=t.dataSource,t.lv_txt.visible=!1,this.updJiaoBiao(t)},t.prototype.closeView=function(t){this.view&&(this.animation.stop(),this.view.rewardList.array=[],this.view.close())},t.prototype.challenageHander=function(){h.CrossSvrBossManager.getIns().enterCrossSvrBoss(this.vo.id),this.closeView(!1)},t}();e.CSBossViewCtrl=u}),define("src/g/crossserboss/ctrl/CSerBossListCtrl",["require","exports","src/g/clearRes/ClearResM","../../../core/E","../../../enum/EventName","../../../config/GameConfig","src/g/crossserboss/ctrl/CSerBossInfo","../../../manager/RoleCenter","src/g/crossserboss/ctrl/CSBossViewCtrl","src/g/index/ctrl/GameIndexCtrl","src/g/accessctrl/AccessCenter"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){this.opend=!1,this.sourceUrls=[],new l.CSBossViewCtrl,n.E.ins.once(s.EventName.INDEX_VIEW_INIT_COMPLET,this,this.onIndexInit),n.E.ins.on(s.EventName.CROSSVR_BOSS_ACTIVITY,this,this.activityStateChanged)}return t.prototype.onIndexInit=function(){this.updEnterBtnDisplay()},t.prototype.activityStateChanged=function(){h.GameIndexCtrl.idxView&&h.GameIndexCtrl.idxView.isInited&&this.updEnterBtnDisplay()},t.prototype.updEnterBtnDisplay=function(){var t=h.GameIndexCtrl.idxView.right_btncon.btn_CSBoss;c.AccessCenter.ins.checkOpen(199)?t.visible=!0:t.visible=!1},t.prototype.init=function(){},t.prototype.showPage=function(t,e){null==this.view&&(this.view=new ui.crossserver.CrossSerBossListUI,i.ClearResM.addBgUrl(this.view.imgGround.skin)),this.initBossData(),this.updBossStatus(),this.opend||(this.updBossReward(),this.opend=!0),this.updBossStatus(),this.view.letTime.text=r.RoleCenter.instans.vo.MUSBCNT+"",this.view.imgGround.restskin(),t.addChild(this.view)},t.prototype.initBossData=function(){var t,e;if(null==this.bossList){this.bossList=[];var i=0;for(var n in o.GameConfig.crossSvrBossVo)t=o.GameConfig.crossSvrBossVo[n],e=new a.CSerBossInfo(t,this.view["bossInfo"+i],0==i?1:.9),this.bossList.push(e),i++}},t.prototype.updBossStatus=function(){for(var t=0;t<this.bossList.length;t++)this.bossList[t].updateStatus()},t.prototype.updBossReward=function(){for(var t=0;t<this.bossList.length;t++)this.bossList[t].updateReward()},t.prototype.getTitle=function(){return"res/csboss/kuafu_biaoti.png"},t.prototype.hidePage=function(){this.view&&this.view.removeSelf()},t.prototype.destroyPage=function(){this.hidePage(),this.opend=!1,n.E.ins.off(s.EventName.CSBOSS_DATA_UPDATE,this,this.updBossStatus);for(var t=0;t<this.bossList.length;t++)this.bossList[t].clear()},t.prototype.loadUrls=function(){},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){},t}();e.CSerBossListCtrl=u}),define("src/g/crossserboss/view/KFHotBloodPortItem",["require","exports","../../../manager/RoleCenter","../../../utils/system/ServerTime","../../../utils/system/DateUitl","src/g/fight/osprite/play/kfhotblood/KfHotBloodManager","../../net/messages/kuafu/KfrxBattleMsg","src/init/TextConst"],function(t,e,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(){var t=this.dataSource,e=a.KFHotBloodManager.ins().getPortStatus(t.port);if(this.lbName.text=t.name,e.bossState==r.KFRXEBattleBossState.WAIT_REVIVE)this.countDownBox.visible=!0,this.lbStatus.visible=!1,this.lbScoreLimit.visible=!1,this.startCD();else{this.countDownBox.visible=!1,this.lbStatus.visible=!0;var i="#e1a32a";n.RoleCenter.instans.vo.getCurLv()>=t.limit1&&n.RoleCenter.instans.self.getRXPingFen()>=1e4*t.limit2?(i="#09d51f",this.lbStatus.text=l.TextConst.get(359),this.lbStatus.visible=!0,this.lbScoreLimit.visible=!1):(this.lbScoreLimit.text=l.TextConst.get(348,t.limit2),this.lbStatus.visible=!1,this.lbScoreLimit.visible=!0),this.lbStatus.color=i,this.stopCD()}},t.prototype.hlayout=function(t,e){for(var i=0,n=[],s=0;s<e.numChildren;s++)n.push(e.getChildAt(s));var o=n.length;for(s=0;s<o;s++)i+=n[s].width,s!=o-1&&(i+=t);var a=e.width-i>>1;for(s=0;s<o;s++)0==s?n[0].x=a:n[s].x=n[s-1].x+n[s-1].width+t},t.prototype.startCD=function(){Laya.timer.loop(1e3,this,this.updCd),this.updCd()},t.prototype.updCd=function(){console.log("热血boss死亡倒计时");var t=this.dataSource;if(t){var e=a.KFHotBloodManager.ins().getPortStatus(t.port);if(e){var i=e.lastDieTime+t.cd-s.ServerTime.serverTime;0<i?(this.lbCountDown.text=o.DateUtil.getHMS_countdown(i),this.hlayout(0,this.lbCountDown.parent)):this.stopCD()}}},t.prototype.stopCD=function(){Laya.timer.clear(this,this.updCd)},t.prototype.destroy=function(t){this.stopCD(),e.prototype.destroy.call(this,t)},t}(ui.hotblood.HotBloodPortItemUI);e.KFHotBloodPortItem=i}),define("src/g/hotblood/view/HotBloodRecordItem",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(ui.hotblood.HotBloodRecordItemUI);e.HotBloodRecordItem=i}),define("src/g/hotblood/view/HotBloodPortItem",["require","exports","../../net/messages/BloodyBattleMsg","src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager","../../../manager/RoleCenter","../../../utils/system/ServerTime","../../../utils/system/DateUitl","src/init/TextConst"],function(t,e,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(){var t=this.dataSource,e=s.HotBloodWarManager.getInstance().getPortStatus(t.port);if(this.lbName.text=t.name,e.bossState==n.EBattleBossState.WAIT_REVIVE)this.countDownBox.visible=!0,this.lbStatus.visible=!1,this.lbScoreLimit.visible=!1,this.startCD();else{this.countDownBox.visible=!1,this.lbStatus.visible=!0;var i="#e1a32a";o.RoleCenter.instans.vo.getCurLv()>=t.limit1&&o.RoleCenter.instans.self.getRXPingFen()>=1e4*t.limit2?(i="#09d51f",this.lbStatus.text=l.TextConst.get(359),this.lbStatus.visible=!0,this.lbScoreLimit.visible=!1):(this.lbScoreLimit.text=l.TextConst.get(348,t.limit2),this.lbStatus.visible=!1,this.lbScoreLimit.visible=!0),this.lbStatus.color=i,this.stopCD()}},t.prototype.hlayout=function(t,e){for(var i=0,n=[],s=0;s<e.numChildren;s++)n.push(e.getChildAt(s));var o=n.length;for(s=0;s<o;s++)i+=n[s].width,s!=o-1&&(i+=t);var a=e.width-i>>1;for(s=0;s<o;s++)0==s?n[0].x=a:n[s].x=n[s-1].x+n[s-1].width+t},t.prototype.startCD=function(){Laya.timer.loop(1e3,this,this.updCd),this.updCd()},t.prototype.updCd=function(){console.log("热血boss死亡倒计时");var t=this.dataSource,e=s.HotBloodWarManager.getInstance().getPortStatus(t.port),i=e.lastDieTime+e.bossCD-a.ServerTime.serverTime;0<i?(this.lbCountDown.text=r.DateUtil.getHMS_countdown(i),this.hlayout(0,this.lbCountDown.parent)):this.stopCD()},t.prototype.stopCD=function(){Laya.timer.clear(this,this.updCd)},t.prototype.destroy=function(t){this.stopCD(),e.prototype.destroy.call(this,t)},t}(ui.hotblood.HotBloodPortItemUI);e.HotBloodPortItem=i}),define("src/g/hotblood/view/HotBloodWarEntry",["require","exports","src/g/hotblood/view/HotBloodPortItem","../../../utils/ItemUtils","../../../component/GAnimation","src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager","src/g/hotblood/view/HotBloodRecordItem","src/g/account/view/AccItem","../../../utils/system/DateUitl","src/g/clearRes/ClearResM","src/g/fight/base/RES","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t.initHtmlStyle(t.lbHelp,"#a89e8f",16),t.lbHelp.style.wordWrap=!0,t.initList(t.bossList,i.HotBloodPortItem,new Laya.Handler(t,t.bossItemRenderHander)),t.bossList.scrollBar.elasticDistance=0,t.bossList.selectEnable=!0,t.initList(t.recordList,a.HotBloodRecordItem,new Laya.Handler(t,t.recordItemRenderHandler)),t.animation=new s.GAnimation,t.animation.x=190,t.animation.y=340,t.addChild(t.animation),t.initList(t.rewardList,r.AccItem,new Laya.Handler(t,t.rewardRenderHander)),t.initHtmlStyle(t.detailButton,"#09d51f",16),t.detailButton.innerHTML=u.TextConst.get(886),h.ClearResM.addBgUrl(t.imgTopBg.skin),h.ClearResM.addBgUrl(t.imgBottomBg.skin),t}return __extends(t,e),t.prototype.initList=function(t,e,i){t.itemRender=e,t.vScrollBarSkin="",t.scrollBar.elasticDistance=100,t.renderHandler=i,t.array=[]},t.prototype.hlayout=function(t,e){for(var i=0,n=[],s=0;s<e.numChildren;s++)n.push(e.getChildAt(s));var o=n.length;for(s=0;s<o;s++)i+=n[s].width,s!=o-1&&(i+=t);var a=e.width-i>>1;for(s=0;s<o;s++)0==s?n[0].x=a:n[s].x=n[s-1].x+n[s-1].width+t},t.prototype.initHtmlStyle=function(t,e,i){t.style.color=e,t.style.font="SimHei",t.style.fontSize=i,t.style.wordWrap=!1},t.prototype.recordItemRenderHandler=function(t,e){var i=t.dataSource;t.text_userNick.text=i.userNick,t.text_killTime.text=l.DateUtil.getHMS(1e3*i.killTime)},t.prototype.bossItemRenderHander=function(t,e){t.update(),this.imgSelected.y=70*this.bossList.selectedIndex+164},t.prototype.selectBossByIndex=function(t){this.bossList.selectedIndex=t},t.prototype.updReXueScore=function(t){t<1e5?(this.imgWan.visible=!1,this.imgWan.width=0):(this.imgWan.visible=!0,this.imgWan.width=25,t=t/1e4>>0);var e=t.toString();this.imgHotValue.value=e,this.imgHotValue.width=22*e.length,this.hlayout(0,this.imgHotValue.parent)},t.prototype.updGuiShuZhi=function(t){this.lbPointNum.text=t.toString()},t.prototype.initPlayRule=function(t){this.lbHelp.innerHTML=t},t.prototype.refreshMonster=function(){var t=n.ItemUtils.getMonsterVOById(n.ItemUtils.getPortVoById(this.selectedPort.port).boss[0]),e=1;-1==t.moResVo.dir.indexOf(5)?(this.murl=c.RES.MONSTER_PATH+t.moResVo.res+"/3_s.json",e=-t.zoom):(e=t.zoom,this.murl=c.RES.MONSTER_PATH+t.moResVo.res+"/5_s.json"),Laya.loader.load([{url:this.murl,type:Laya.Loader.ATLAS}],Laya.Handler.create(this,function(){null!=this.animation&&(this.animation.clear(!0),this.animation.load(this.murl),this.animation.scale(e,t.zoom))}))},t.prototype.onPortSelected=function(t){this.selectedPort=t,this.refreshMonster(),this.enterButton.disabled=0!=o.HotBloodWarManager.getInstance().checkChangeCondition(this.selectedPort.port)},t.prototype.updRewardDisplay=function(t){this.rewardList.array=t},t.prototype.updRecord=function(t){this.recordList.array=t},t.prototype.rewardRenderHander=function(t,e){t.eqData=t.dataSource},t.prototype.updAllPortStatus=function(){0<this.bossList.array.length&&(this.bossList.refresh(),this.enterButton.disabled=0!=o.HotBloodWarManager.getInstance().checkChangeCondition(this.selectedPort.port))},t.prototype.closeView=function(){this.animation&&(this.animation.clear(!0),this.animation.stop(),this.animation.removeSelf(),this.animation=null)},t}(ui.hotblood.HotBloodWarEntryUI);e.HotBloodWarEntry=p}),define("src/g/hotblood/ctrl/HotBloodReportCtrl",["require","exports","../../../core/E","../../../enum/EventName","src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager","../../../utils/ItemUtils","src/init/TextConst"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this.portReportData={},i.E.ins.on(n.EventName.HOTBLOOD_REPORT_RECEIVED,this,this.onReceivedPortData)}return t.prototype.requestData=function(t,e){void 0===e&&(e=null),this.callBackHander=e,null==this.portReportData[t]?s.HotBloodWarManager.getInstance().reqBossKillState(t,1):this.callBackHander.run()},t.prototype.onReceivedPortData=function(t){this.portReportData[t.portid]=t,null!=this.callBackHander&&this.callBackHander.run()},t.prototype.showReportView=function(t){if(null!=this.portReportData[t]){null==this.view&&(this.view=new ui.hotblood.HotBloodWarReportUI,this.view.bg.btn_close.visible=!1,this.initList(this.view.playerList,this.playerItemRender,ui.hotblood.HotBloodReportItemUI));var e=this.portReportData[t];if(this.view.playerList.array=this.createListData(e),null==e.ownernick||""==e.ownernick)this.view.guishuzhe.visible=!1;else{this.view.guishuzhe.visible=!0,this.view.guishuzhe.lbName.text=e.ownernick,this.view.guishuzhe.lbFight.text=e.ownercombat.toString(),this.view.guishuzhe.lbFamily.text=e.ownerfnick;var i=e.usernick.indexOf(e.ownernick);this.view.guishuzhe.imgHead.skin=o.ItemUtils.getHeadurlYuan(e.sexlist[i],e.joblist[i])}this.view.popup()}},t.prototype.createListData=function(t){for(var e,i=[],n=0;n<t.usernick.length;n++)t.usernick[n]!=t.ownernick&&((e={}).name=t.usernick[n],e.fight=t.combat[n],e.family=t.familynick[n],e.job=t.joblist[n],e.sex=t.sexlist[n],i.push(e));return i},t.prototype.initList=function(t,e,i){t.selectEnable=!0,t.vScrollBarSkin="",t.itemRender=i,t.scrollBar.elasticDistance=100,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.playerItemRender=function(t,e){var i=t.dataSource;t.lbName.text=i.name,t.lbFight.text=i.fight.toString(),t.lbFamily.text=i.family,t.imgHead.skin=o.ItemUtils.getHeadurlYuan(i.sex,i.job)},t.prototype.getGuiShuZhe=function(t){var e=this.portReportData[t];return null!=e&&""!=e.ownernick?e.ownernick:a.TextConst.get(358)},t.prototype.getTotalPlayerNum=function(t){var e=this.portReportData[t];return null!=e?e.usernick.length:0},t.prototype.exit=function(){this.callBackHander=null,this.view&&(this.view.close(),this.view.destroy(!0)),i.E.ins.off(n.EventName.HOTBLOOD_REPORT_RECEIVED,this,this.onReceivedPortData)},t}();e.HotBloodReportCtrl=r}),define("src/g/hotblood/ctrl/HotBloodWarEntryCtrl",["require","exports","../../../core/E","../../../enum/EventName","src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager","src/g/hotblood/view/HotBloodWarEntry","../../../config/GameConfig","src/g/base/BaseCtrl","../../net/messages/BloodyBattleMsg","src/g/guide/vo/RewardVo","../../../vo/ReXueUtil","../../../enum/enumItem","../../../utils/ItemUtils","../../../manager/RoleCenter","src/g/hotblood/ctrl/HotBloodReportCtrl","src/g/clearRes/ClearResM","../../../meta/QualiyVo","src/init/TextConst"],function(t,e,i,n,r,s,o,a,l,h,c,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=function(e){function t(){var t=e.call(this)||this;return t.url="res/atlas/res/hotblood.json",t.rewardDict={},t.portDataList=[],t.viewLayer=new Laya.Sprite,t.viewLayer.width=600,t.viewLayer.height=731,t}return __extends(t,e),t.prototype.loadUrls=function(){},t.prototype.getTitle=function(){return"res/hotblood/rxzc_biaotiwenzi1.png"},t.prototype.showPage=function(t,e){t.removeChildren(),t.addChild(this.viewLayer),this.viewLayer.x=0,this.open()},t.prototype.onAtlasLoaded=function(){if(null!=this.viewLayer.parent){if(null==this.view){this.view=new s.HotBloodWarEntry;var t=o.GameConfig.Ruledesc[20];this.view.initPlayRule(t.tmptext),this.viewLayer.addChild(this.view),this.view.enterButton.on(Laya.Event.CLICK,this,this.enterPortHander),this.view.bossList.selectHandler=new Laya.Handler(this,this.onPortSelected),this.view.detailButton.on(Laya.Event.CLICK,this,this.showFightReport)}i.E.ins.on(n.EventName.HOTBLOOD_DATA_INITED,this,this.dataInitHander),i.E.ins.on(n.EventName.HOTBLOOD_DATA_UPDATE,this,this.updPortStatus),r.HotBloodWarManager.getInstance().reqOpenBossInfoPanel(0),v.ClearResM.resetViewImg(this.view)}},t.prototype.showFightReport=function(){this.selectedPort&&this.reportCtrl.showReportView(this.selectedPort.port)},t.prototype.dataInitHander=function(){if(i.E.ins.off(n.EventName.HOTBLOOD_DATA_INITED,this,this.dataInitHander),null!=this.viewLayer.parent&&null!=this.view){0==this.portDataList.length&&(this.portDataList=this.createPortList()),0==this.view.bossList.array.length?this.view.bossList.array=this.portDataList:this.view.bossList.refresh();var t=this.checkCanChallengePort();this.view.bossList.selectedIndex=t,this.view.updReXueScore(d.RoleCenter.instans.self.getRXPingFen()),this.view.updGuiShuZhi(d.RoleCenter.instans.vo.BBCNT),this.view.leftHelpCount.text=d.RoleCenter.instans.vo.BBHELPCNT.toString()}},t.prototype.createPortList=function(){var t=[],e=o.GameConfig.rexiezhanchangVo,i=null;for(var n in e)i=e[n],this.rewardDict[i.port]=this.createPortRewardData(i.showReward),t.push(i);return t},t.prototype.createPortRewardData=function(t){for(var e,i=[],n=0;n<t.length;n++){e=t[n];var s=new h.RewardVo;if(c.ReXueUtil.getEquipVoById(e)){var o=c.ReXueUtil.getEquipVoById(e);s.res=p.ItemUtils.getIconByIconId(o.icon),s.lv=o.limit,s.qualityNum=o.quality,s.quality=f.QualityStruct.Ins.getQColorById(o.quality),s.name=o.name,s.type=u.ItemType.REXUE,s.id=o.id,i.push(s)}else if(p.ItemUtils.getItemVoById(e)){var a=p.ItemUtils.getItemVoById(e);s.res=p.ItemUtils.getIconByIconId(a.icon),s.lv=a.uselimit,s.qualityNum=a.quality,s.quality=f.QualityStruct.Ins.getQColorById(a.quality),s.name=a.name,s.id=a.id,s.type=u.ItemType.ITEM,s.count=0,s.streamer=a.streamer,i.push(s)}else if(p.ItemUtils.getEquipVoById(e)){var r=p.ItemUtils.getEquipVoById(e);s.res=p.ItemUtils.getIconByIconId(r.icon),s.lv=r.limit,s.qualityNum=r.quality,s.quality=f.QualityStruct.Ins.getQColorById(r.quality),s.name=r.name,s.type=u.ItemType.EQ,s.id=r.id,s.job=r.job,i.push(s)}}return i},t.prototype.checkCanChallengePort=function(){for(var t,e,i=this.view.bossList.array,n=0;n<i.length;n++)if(t=i[n],e=r.HotBloodWarManager.getInstance().getPortStatus(t.port),0==r.HotBloodWarManager.getInstance().checkChangeCondition(t.port)&&e.bossState==l.EBattleBossState.CAN_CHALLENGE)return n;return 0},t.prototype.onPortSelected=function(t){if(t<0||t>=this.portDataList.length)console.error("热血战选择关卡错误"+t);else{this.selectedPort=this.view.bossList.getItem(t);var e=r.HotBloodWarManager.getInstance().getPortStatus(this.selectedPort.port);if(this.view.onPortSelected(this.selectedPort),this.view.updRewardDisplay(this.rewardDict[this.selectedPort.port]),null==this.reportCtrl&&(this.reportCtrl=new g.HotBloodReportCtrl),e.bossState==l.EBattleBossState.WAIT_REVIVE){this.view.killRecordBox.visible=!0,this.view.warReportBox.visible=!1;for(var i=e.killRecord,n=null,s=[],o=i.usernick.length,a=0;a<o;a++)(n=new _).userNick=i.usernick[a],n.killTime=i.killTime[a],s.push(n);s.sort(this.sortByKillTime),3<s.length&&s.splice(3),this.view.updRecord(s)}else this.view.killRecordBox.visible=!1,this.view.warReportBox.visible=!0,this.reportCtrl.requestData(this.selectedPort.port,new Laya.Handler(this,this.onReceivedPortReport))}},t.prototype.sortByKillTime=function(t,e){return-(t.killTime-e.killTime)},t.prototype.onReceivedPortReport=function(){var t=this.reportCtrl.getGuiShuZhe(this.selectedPort.port);this.view.BossGuiShuzhe.text=t,this.view.lbPeopleNum.text=y.TextConst.get(101,this.reportCtrl.getTotalPlayerNum(this.selectedPort.port))},t.prototype.enterPortHander=function(){!!this.selectedPort&&r.HotBloodWarManager.getInstance().enterHotBloodWar(this.selectedPort.port)&&this.destroyPage()},t.prototype.init=function(){},t.prototype.refreshData=function(){},t.prototype.changePerson=function(t,e){},t.prototype.updPortStatus=function(){this.view&&this.view.updAllPortStatus()},t.prototype.hidePage=function(){},t.prototype.destroyPage=function(){console.log("执行销毁view逻辑"),this.view&&(this.view.enterButton.off(Laya.Event.CLICK,this,this.enterPortHander),this.view.detailButton.off(Laya.Event.CLICK,this,this.showFightReport),this.view.bossList.selectHandler.clear(),this.view.bossList.selectHandler=null,this.view.closeView(),this.view.removeSelf(),this.view.destroy(!0),this.selectedPort=null,this.view=null,this.reportCtrl&&(this.reportCtrl.exit(),this.reportCtrl=null)),i.E.ins.off(n.EventName.HOTBLOOD_DATA_UPDATE,this,this.updPortStatus)},t}(a.BaseCtrl);e.HotBloodWarEntryCtrl=m;var _=function(){};e.HotBloodKillRecordItemData=_}),define("src/g/crossserboss/view/KFHotBloodWarEntry",["require","exports","../../../utils/ItemUtils","../../../component/GAnimation","src/g/account/view/AccItem","../../../utils/system/DateUitl","src/g/clearRes/ClearResM","src/g/fight/base/RES","src/g/crossserboss/view/KFHotBloodPortItem","src/g/hotblood/view/HotBloodRecordItem","src/g/fight/osprite/play/kfhotblood/KfHotBloodManager","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t.initHtmlStyle(t.lbHelp,"#a89e8f",16),t.lbHelp.style.wordWrap=!0,t.initList(t.bossList,l.KFHotBloodPortItem,new Laya.Handler(t,t.bossItemRenderHander)),t.bossList.scrollBar.elasticDistance=0,t.bossList.selectEnable=!0,t.initList(t.recordList,h.HotBloodRecordItem,new Laya.Handler(t,t.recordItemRenderHandler)),t.animation=new n.GAnimation,t.animation.x=190,t.animation.y=340,t.addChild(t.animation),t.initList(t.rewardList,s.AccItem,new Laya.Handler(t,t.rewardRenderHander)),t.initHtmlStyle(t.detailButton,"#09d51f",16),t.detailButton.innerHTML=u.TextConst.get(886),a.ClearResM.addBgUrl(t.imgTopBg.skin),a.ClearResM.addBgUrl(t.imgBottomBg.skin),t.on(Laya.Event.UNDISPLAY,t,t.unDisplay),t}return __extends(t,e),t.prototype.unDisplay=function(){a.ClearResM.clearUrl(this.murl)},t.prototype.selectHandler=function(){var t=this.bossList.getCell(this.bossList.selectedIndex);t&&(this.imgSelected.x=this.imgSelected.y=0,t.addChild(this.imgSelected))},t.prototype.initList=function(t,e,i){t.itemRender=e,t.vScrollBarSkin="",t.scrollBar.elasticDistance=100,t.renderHandler=i,t.array=[]},t.prototype.hlayout=function(t,e){for(var i=0,n=[],s=0;s<e.numChildren;s++)n.push(e.getChildAt(s));var o=n.length;for(s=0;s<o;s++)i+=n[s].width,s!=o-1&&(i+=t);var a=e.width-i>>1;for(s=0;s<o;s++)0==s?n[0].x=a:n[s].x=n[s-1].x+n[s-1].width+t},t.prototype.initHtmlStyle=function(t,e,i){t.style.color=e,t.style.font="SimHei",t.style.fontSize=i,t.style.wordWrap=!1},t.prototype.recordItemRenderHandler=function(t,e){var i=t.dataSource;t.text_userNick.text=i.userNick,t.text_killTime.text=o.DateUtil.getHMS(1e3*i.killTime)},t.prototype.bossItemRenderHander=function(t,e){t.update()},t.prototype.selectBossByIndex=function(t){this.bossList.selectedIndex=t},t.prototype.updReXueScore=function(t){t<1e5?(this.imgWan.visible=!1,this.imgWan.width=0):(this.imgWan.visible=!0,this.imgWan.width=25,t=t/1e4>>0);var e=t.toString();this.imgHotValue.value=e,this.imgHotValue.width=22*e.length,this.hlayout(0,this.imgHotValue.parent)},t.prototype.updGuiShuZhi=function(t){this.lbPointNum.text=t.toString()},t.prototype.initPlayRule=function(t){this.lbHelp.innerHTML=t},t.prototype.refreshMonster=function(){var t=i.ItemUtils.getMonsterVOById(i.ItemUtils.getPortVoById(this.selectedPort.port).boss[0]),e=1;-1==t.moResVo.dir.indexOf(5)?(this.murl=r.RES.MONSTER_PATH+t.moResVo.res+"/3_s.json",e=-t.zoom):(e=t.zoom,this.murl=r.RES.MONSTER_PATH+t.moResVo.res+"/5_s.json"),Laya.loader.load(this.murl,Laya.Handler.create(this,function(){null!=this.animation&&(this.animation.clear(!0),this.animation.load(this.murl),this.animation.scale(e,t.zoom))}),null,Laya.Loader.ATLAS)},t.prototype.onPortSelected=function(t){this.selectedPort=t,this.refreshMonster(),this.enterButton.disabled=0!=c.KFHotBloodManager.ins().checkChangeCondition(this.selectedPort.port),this.selectHandler()},t.prototype.updRewardDisplay=function(t){this.rewardList.array=t},t.prototype.updRecord=function(t){this.recordList.array=t},t.prototype.rewardRenderHander=function(t,e){t.eqData=t.dataSource},t.prototype.updAllPortStatus=function(){0<this.bossList.array.length&&(this.bossList.refresh(),this.enterButton.disabled=0!=c.KFHotBloodManager.ins().checkChangeCondition(this.selectedPort.port))},t.prototype.closeView=function(){this.animation&&(this.animation.clear(!0),this.animation.stop(),this.animation.removeSelf(),this.animation=null)},t}(ui.hotblood.HotBloodWarEntryUI);e.KFHotBloodWarEntry=p}),define("src/g/crossserboss/ctrl/KFHotBloodReportCtrl",["require","exports","../../../utils/ItemUtils","src/g/fight/osprite/play/kfhotblood/KfHotBloodManager","../../../manager/GameSocketManager","../../net/messages/kuafu/KfrxBattleMsg","src/init/GameMain","src/init/TextConst"],function(t,e,n,i,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){this.portReportData={},s.GSM.ins.on(o.KFRXBossKillStateGS2C.KEY,this,this.onReceivedPortData)}return t.prototype.requestData=function(t,e){void 0===e&&(e=null),this.callBackHander=e,null==this.portReportData[t]?i.KFHotBloodManager.ins().reqBossKillState(t,1):this.callBackHander.run()},t.prototype.onReceivedPortData=function(t){this.portReportData[t.portid]=t,null!=this.callBackHander&&this.callBackHander.run()},t.prototype.showReportView=function(t){if(null!=this.portReportData[t]){null==this.view&&(this.view=new ui.hotblood.HotBloodWarReportUI,this.view.bg.btn_close.visible=!1,this.initList(this.view.playerList,this.playerItemRender,ui.hotblood.HotBloodReportItemUI));var e=this.portReportData[t];if(this.view.playerList.array=this.createListData(e),null==e.ownernick||""==e.ownernick)this.view.guishuzhe.visible=!1;else{this.view.guishuzhe.visible=!0,this.view.guishuzhe.lbName.text=e.ownernick,this.view.guishuzhe.lbFight.text=e.ownercombat.toString(),this.view.guishuzhe.lbFamily.text=e.ownerfnick;var i=e.usernick.indexOf(e.ownernick);this.view.guishuzhe.imgHead.skin=n.ItemUtils.getHeadurlYuan(e.sexlist[i],e.joblist[i])}this.view.popup()}},t.prototype.createListData=function(t){for(var e,i=[],n=0;n<t.usernick.length;n++)t.usernick[n]!=t.ownernick&&((e={}).name=t.usernick[n],e.fight=t.combat[n],e.family=t.familynick[n],e.job=t.joblist[n],e.sex=t.sexlist[n],i.push(e));return i},t.prototype.initList=function(t,e,i){t.selectEnable=!0,t.vScrollBarSkin="",t.itemRender=i,t.scrollBar.elasticDistance=100,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.playerItemRender=function(t,e){var i=t.dataSource;t.lbName.text=i.name,t.lbFight.text=i.fight.toString(),t.lbFamily.text=i.family,t.imgHead.skin=n.ItemUtils.getHeadurlYuan(i.sex,i.job)},t.prototype.getGuiShuZhe=function(t){var e=this.portReportData[t];return null==e||""==e.ownernick?r.TextConst.get(358):a.GameMain.getDisSvrId(e.owneruname)+e.ownernick},t.prototype.getTotalPlayerNum=function(t){var e=this.portReportData[t];return null!=e?e.usernick.length:0},t.prototype.exit=function(){this.callBackHander=null,this.view&&(this.view.close(),this.view.destroy(!0))},t}();e.KFHotBloodReportCtrl=l}),define("src/g/crossserboss/ctrl/KFRXCtrl",["require","exports","../../../core/E","../../../enum/EventName","../../../config/GameConfig","src/g/base/BaseCtrl","src/g/guide/vo/RewardVo","../../../vo/ReXueUtil","../../../enum/enumItem","../../../utils/ItemUtils","../../../manager/RoleCenter","src/g/clearRes/ClearResM","../../../meta/QualiyVo","src/g/fight/osprite/play/kfhotblood/KfHotBloodManager","src/g/crossserboss/view/KFHotBloodWarEntry","src/g/crossserboss/ctrl/KFHotBloodReportCtrl","../../net/messages/kuafu/KfrxBattleMsg","src/init/TextConst"],function(t,e,i,n,s,o,l,h,c,u,a,r,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=function(e){function t(){var t=e.call(this)||this;return t.url="res/atlas/res/hotblood.json",t.rewardDict={},t.portDataList=[],t.viewLayer=new Laya.Sprite,t.viewLayer.width=600,t.viewLayer.height=731,t}return __extends(t,e),t.prototype.loadUrls=function(){},t.prototype.getTitle=function(){return"res/csboss/wangzhezhanc_biaoti.png"},t.prototype.showPage=function(t,e){t.removeChildren(),t.addChild(this.viewLayer),this.viewLayer.x=0,this.open()},t.prototype.onAtlasLoaded=function(){null!=this.viewLayer.parent&&(null==this.view&&(this.view=new g.KFHotBloodWarEntry,this.view.tan_icon.visible=!1,this.viewLayer.addChild(this.view),this.view.enterButton.on(Laya.Event.CLICK,this,this.enterPortHander),this.view.bossList.selectHandler=new Laya.Handler(this,this.onPortSelected),this.view.detailButton.on(Laya.Event.CLICK,this,this.showFightReport)),this.onPortSelected(this.view.bossList.selectedIndex),i.E.ins.on(n.EventName.KFHOTBLOOD_DATA_INITED,this,this.dataInitHander),i.E.ins.on(n.EventName.KFHOTBLOOD_DATA_INITED,this,this.updPortStatus),this.manager().reqOpenBossInfoPanel(0),r.ClearResM.resetViewImg(this.view),d.KFHotBloodManager.ins().checkKFRXWarRedPoint())},t.prototype.showFightReport=function(){this.selectedPort&&this.reportCtrl.showReportView(this.selectedPort.port)},t.prototype.dataInitHander=function(){if(i.E.ins.off(n.EventName.KFHOTBLOOD_DATA_INITED,this,this.dataInitHander),null!=this.viewLayer.parent&&null!=this.view){0==this.portDataList.length&&(this.portDataList=this.createPortList()),0==this.view.bossList.array.length?this.view.bossList.array=this.portDataList:this.view.bossList.refresh();var t=this.checkCanChallengePort();this.view.bossList.selectedIndex=t,this.view.updReXueScore(a.RoleCenter.instans.self.getRXPingFen()),this.view.updGuiShuZhi(a.RoleCenter.instans.vo.KFRX_CNT),this.view.leftHelpCount.text=a.RoleCenter.instans.vo.KFRX_HELPCNT.toString()}},t.prototype.createPortList=function(){var t=[],e=s.GameConfig.kfrxvo,i=null;for(var n in e)i=e[n],this.rewardDict[i.port]=this.createPortRewardData(i.showReward),t.push(i);return t},t.prototype.createPortRewardData=function(t){for(var e,i=[],n=0;n<t.length;n++){e=t[n];var s=new l.RewardVo;if(h.ReXueUtil.getEquipVoById(e)){var o=h.ReXueUtil.getEquipVoById(e);s.res=u.ItemUtils.getIconByIconId(o.icon),s.lv=o.limit,s.qualityNum=o.quality,s.quality=p.QualityStruct.Ins.getQColorById(o.quality),s.name=o.name,s.type=c.ItemType.REXUE,s.id=o.id,i.push(s)}else if(u.ItemUtils.getItemVoById(e)){var a=u.ItemUtils.getItemVoById(e);s.res=u.ItemUtils.getIconByIconId(a.icon),s.lv=a.uselimit,s.qualityNum=a.quality,s.quality=p.QualityStruct.Ins.getQColorById(a.quality),s.name=a.name,s.id=a.id,s.type=c.ItemType.ITEM,s.count=0,s.streamer=a.streamer,i.push(s)}else if(u.ItemUtils.getEquipVoById(e)){var r=u.ItemUtils.getEquipVoById(e);s.res=u.ItemUtils.getIconByIconId(r.icon),s.lv=r.limit,s.qualityNum=r.quality,s.quality=p.QualityStruct.Ins.getQColorById(r.quality),s.name=r.name,s.type=c.ItemType.EQ,s.id=r.id,s.job=r.job,i.push(s)}else if(u.ItemUtils.getXwEquipVoById(e)){r=u.ItemUtils.getXwEquipVoById(e);s.res=u.ItemUtils.getIconByIconId(r.icon),s.lv=r.limit,s.qualityNum=r.quality,s.quality=p.QualityStruct.Ins.getQColorById(r.quality),s.name=r.name,s.type=c.ItemType.EQ,s.id=r.id,i.push(s)}}return i},t.prototype.checkCanChallengePort=function(){for(var t,e,i=this.view.bossList.array,n=0;n<i.length;n++)if(t=i[n],e=this.manager().getPortStatus(t.port),0==this.manager().checkChangeCondition(t.port)&&e.bossState==f.KFRXEBattleBossState.CAN_CHALLENGE)return n;return 0},t.prototype.manager=function(){return d.KFHotBloodManager.ins()},t.prototype.onPortSelected=function(t){if(t<0||t>=this.portDataList.length)console.error("热血战选择关卡错误"+t);else{var e=this.view.bossList.getItem(t);if(e){var i=this.manager().getPortStatus(e.port);if(this.view.onPortSelected(e),this.view.updRewardDisplay(this.rewardDict[e.port]),this.selectedPort=e,null==this.reportCtrl&&(this.reportCtrl=new v.KFHotBloodReportCtrl),i.bossState==f.KFRXEBattleBossState.WAIT_REVIVE){this.view.killRecordBox.visible=!0,this.view.warReportBox.visible=!1;for(var n=i.killRecord,s=null,o=[],a=n.usernick.length,r=0;r<a;r++)(s=new _).userNick=n.usernick[r],s.killTime=n.killTime[r],o.push(s);o.sort(this.sortByKillTime),3<o.length&&o.splice(3),this.view.updRecord(o)}else this.view.killRecordBox.visible=!1,this.view.warReportBox.visible=!0,this.reportCtrl.requestData(this.selectedPort.port,new Laya.Handler(this,this.onReceivedPortReport))}}},t.prototype.sortByKillTime=function(t,e){return-(t.killTime-e.killTime)},t.prototype.onReceivedPortReport=function(){var t=this.reportCtrl.getGuiShuZhe(this.selectedPort.port);this.view.BossGuiShuzhe.text=t,this.view.lbPeopleNum.text=y.TextConst.get(101,this.reportCtrl.getTotalPlayerNum(this.selectedPort.port))},t.prototype.enterPortHander=function(){!!this.selectedPort&&this.manager().enterHotBloodWar(this.selectedPort.port)&&this.destroyPage()},t.prototype.init=function(){},t.prototype.refreshData=function(){},t.prototype.changePerson=function(t,e){},t.prototype.updPortStatus=function(){this.view&&this.view.updAllPortStatus(),d.KFHotBloodManager.ins().checkKFRXWarRedPoint()},t.prototype.hidePage=function(){},t.prototype.destroyPage=function(){console.log("执行销毁view逻辑"),this.view&&(this.view.enterButton.off(Laya.Event.CLICK,this,this.enterPortHander),this.view.detailButton.off(Laya.Event.CLICK,this,this.showFightReport),this.view.bossList.selectHandler.clear(),this.view.bossList.selectHandler=null,this.view.closeView(),this.view.removeSelf(),this.view.destroy(!0),this.selectedPort=null,this.view=null,this.reportCtrl&&(this.reportCtrl.exit(),this.reportCtrl=null)),i.E.ins.off(n.EventName.HOTBLOOD_DATA_UPDATE,this,this.updPortStatus)},t}(o.BaseCtrl);e.KFRXCtrl=m;var _=function(){};e.HotBloodKillRecordItemData=_}),define("src/g/rank/view/DengJiItem",["require","exports","../../../config/GameConfig","../../net/messages/rank/sbkRankDataBase","../../../core/E","../../../enum/EventName","../../../utils/StringUtils","../../../utils/ItemUtils","../../../utils/UIUtils","src/init/TextConst"],function(t,e,i,r,n,s,o,l,h,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t.on(Laya.Event.CLICK,t,t.onOtherOpenRole),t}return __extends(t,e),t.prototype.onOtherOpenRole=function(t){var e=this.itemData.data;n.E.ins.event(s.EventName.OPEN_RANKROLEVIEW,[e.username,e.svrid])},t.prototype.setData=function(t,e){if(t){this.visible=!0;var i=(this.itemData=t).data,n=i.vipLv;switch(this.imgVip.skin=l.ItemUtils.getVipIconByLevel(n),t.type){case r.enumRankID.rankid_1:this.zhanliHandler();break;case r.enumRankID.rankid_2:this.dengjiHandler();break;case r.enumRankID.rankid_3:this.zhanshengHandler();break;case r.enumRankID.rankid_4:this.fashenHandler();break;case r.enumRankID.rankid_5:this.daozunHandler();break;case r.enumRankID.rankid_6:this.guanzhiHandler();break;case r.enumRankID.rankid_7:this.shenyiHandler();break;case r.enumRankID.rankid_8:this.tiantiHandler();break;case r.enumRankID.rankid_9:this.yezhanHandler();break;case r.enumRankID.rankid_10:this.longzhuHandler()}this.user_name.text=i.nickname,h.UIUtils.nameAndVipDisplay(this.imgVip,this.user_name),e+=2,this.rankHandler(e);var s=this.vip_num,o=this.vip_icon,a=this.month_icon;n?s.visible=!(100<n)&&(s.value=n+"",o.visible=!0):(s.visible=!1,o.visible=!1),a.visible=!1,s.visible=!1,o.visible=!1,o.x=28,s.x=57,a.x=5,!a.visible&&s.visible&&o.visible?(o.x-=12,s.x-=12):a.visible||s.visible||!o.visible?!a.visible||s.visible||o.visible||(a.x+=26):o.x-=4,window.enabledpay||(this.vip_icon.visible=!1,this.month_icon.visible=!1,this.vip_num.visible=!1,this.imgVip.visible=!1)}else this.visible=!1},t.prototype.rankHandler=function(t){this.rank_num.value=t+"",this.img_bg1.skin=this.img_bg2.skin=3<t?(this.rank_icon.visible=!1,this.rank_num.visible=!0,"res/di/paihangbang_diban.png"):(this.rank_num.visible=!1,this.rank_icon.visible=!0,this.rank_icon.skin="res/rank/new/paihang_huizhang"+t+"st.png","res/di/paihangbang_"+t+"stdiban.png")},t.prototype.dengjiHandler=function(){this.lvl_txt.visible=!0;var t=this.itemData.data.value1%1e3,e=this.itemData.data.value1/1e3>>0;this.lvl_txt.text=0<e?a.TextConst.get(18,e,t):a.TextConst.get(16,t),this.fight_txt.visible=!1,this.kfSevName.visible=!1,this.wei_txt.text=""},t.prototype.lvlHandler=function(){var t=this.itemData.data.value2%1e3,e=this.itemData.data.value2/1e3>>0;this.lvl_txt.text=0<e?a.TextConst.get(18,e,t):a.TextConst.get(16,t),this.fight_txt.visible=!1,this.wei_txt.text="",this.lvl_txt.visible=!1,this.kfSevName.visible=!1},t.prototype.zhanliHandler=function(){this.lvlHandler(),this.fight_txt.text=a.TextConst.get(684,(this.itemData.data.value1/1e4).toFixed(2)),this.fight_txt.visible=!0},t.prototype.zhanshengHandler=function(){this.lvlHandler(),this.fight_txt.text=a.TextConst.get(685,(this.itemData.data.value1/1e4).toFixed(2)),this.fight_txt.visible=!0},t.prototype.fashenHandler=function(){this.lvlHandler(),this.fight_txt.text=a.TextConst.get(686,(this.itemData.data.value1/1e4).toFixed(2)),this.fight_txt.visible=!0},t.prototype.daozunHandler=function(){this.lvlHandler(),this.fight_txt.text=a.TextConst.get(687,(this.itemData.data.value1/1e4).toFixed(2)),this.fight_txt.visible=!0},t.prototype.shenyiHandler=function(){this.lvlHandler(),this.fight_txt.text=a.TextConst.get(688,(this.itemData.data.value1/1e4).toFixed(2)),this.fight_txt.visible=!0},t.prototype.yezhanHandler=function(){this.lvlHandler(),this.fight_txt.text=a.TextConst.get(88,this.itemData.data.value1),this.fight_txt.visible=!0},t.prototype.longzhuHandler=function(){this.lvlHandler(),this.fight_txt.text=a.TextConst.get(104,this.itemData.data.value1),this.fight_txt.visible=!0},t.prototype.tiantiHandler=function(){this.lvlHandler(),this.fight_txt.visible=!1},t.prototype.guanzhiHandler=function(){this.lvlHandler();var t=a.TextConst.get(689),e=i.GameConfig.chopJSON[this.itemData.data.value1+1];e&&(t=e.name),this.wei_txt.text=a.TextConst.get(89,o.StringUtils.NumString(this.itemData.data.value1)),this.fight_txt.text=t?a.TextConst.get(90,t):a.TextConst.get(90,a.TextConst.get(690)),this.fight_txt.visible=!0},t}(ui.rank.DengJiUI);e.DengJiItem=c}),define("src/g/rank/view/MRTItem",["require","exports","src/g/rank/view/DengJiItem","../../../utils/UIUtils","../../net/messages/kuafu/kfRankMsg","../../../manager/GameSocketManager","../../../manager/RoleCenter","../../../utils/ItemUtils","src/init/TextConst"],function(t,e,i,p,d,o,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(u){function t(){var t=u.call(this)||this;return t.img_bg1.width=t.img_bg2.width=272,t.img_bg2.x=544,t.name_box.x=60,t.fight_txt.x+=50,t.width=544,t.mrt_box.x=450,t}return __extends(t,u),t.prototype.onOtherOpenRole=function(t){if(t.target==this.img_dz){var e=new d.KfRankMoBaiC2GS,i=this.itemData,n=i.type,s=i.data;e.svrid=s.svrid,e.rankId=Math.abs(n),e.username=s.username,e.familyuid=s.familyuid,o.GSM.sendServer(e)}else{if(!this.notGotoInfo)return;u.prototype.onOtherOpenRole.call(this,t)}},t.prototype.setData=function(t,e){if(u.prototype.setData.call(this,t,e),t){var i=t.data;this.mrt_box.visible=!0;var n=g.RoleCenter.instans.self,s=Math.abs(t.type),o=n.combat_mobai[s],a=!1,r=!1,l=!1,h=!1;switch(s){case d.enumKfRankID.rankid_combat:case d.enumKfRankID.rankid_ss:case d.enumKfRankID.rankid_sy:case d.enumKfRankID.rankid_zl:case d.enumKfRankID.rankid_pet:a=n.mobai_user_name[s]==i.username,this.zhanliHandler(),h=l=!0;break;case d.enumKfRankID.rankid_family:a=n.mobai_user_name[d.enumKfRankID.rankid_family]==i.familyuid,r=!0,this.ghFVip.skin=v.ItemUtils.getVipIconByLevel(i.vipLv),p.UIUtils.nameAndVipDisplay(this.ghFVip,this.ghFName),this.ghSev.text=i.svrname,this.ghFName.text=i.nickname,this.ghName.text=i.familyname,this.ghFight.text=f.TextConst.get(1,f.TextConst.get(877,i.value1))}this.rank_icon.restskin(),this.name_box.visible=this.fight_txt.visible=l,this.ghInfo.visible=r,this.ghFInfo.visible=r;var c=!1;0==o&&(c=!0),this.img_dz.visible=c,this.lab_dz.visible=!c,this.kfSevName.visible=h,this.kfSevName.text=i.svrname,this.lab_dz.text=i.value2+"\n"+(a?f.TextConst.get(691):"")}},t.prototype.rankHandler=function(t){t-=1,u.prototype.rankHandler.call(this,t)},t}(i.DengJiItem);e.MRTItem=n}),define("src/g/crossserboss/ctrl/CSerBossMingRenCtrl",["require","exports","src/g/clearRes/ClearResM","../../../manager/GameSocketManager","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../../core/GNet","../../../vo/RedDot/RankItemVo","src/g/rank/view/MRTItem","../../net/messages/kuafu/kfRankMsg","../../../utils/RoleUtil","../../net/messages/OpResultGS2C","../../net/messages/OpResultType","src/init/TextConst","../../../manager/RedDotM"],function(t,e,n,i,g,v,f,s,y,o,m,a,r,l,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function t(){this.gs2cArr=[],this.lastTime=0;var t=i.GSM.ins;t.on(m.KfRankListDataGS2C.KEY,this,this.resultHandler),t.on(m.KfRankMoBaiGS2C.KEY,this,this.mobaiCB),t.on(r.OpResultGS2C.KEY,this,this.onOpResult)}return t.prototype.onOpResult=function(t){if(t.msgidx==l.enumOpResultType.activity_nextDay){this.gs2cArr.splice(0,this.gs2cArr.length);var e=this.view;if(e&&e.displayedInStage){var i=e.tab.selectedIndex;e.tab.selectedIndex=-1,e.tab.selectedIndex=i}}},t.prototype.mobaiCB=function(t){var e=t.rankId,i=this.gs2cArr[e];if(i){i.mobai_user_name=i.mobai_user_name;for(var n=0;n<this.gs2cArr.length;n++)this.gs2cArr[n]&&(this.gs2cArr[n].combat_mobai=t.combat_mobai);var s=i.rankArr,o=t.kfMobaiOneRank;if(s)for(n=0;n<s.length;n++){var a=s[n];if(a.username==t.username&&a.svrid==t.svrid||a.username==t.username&&a.familyuid==t.familyuid){0!=o&&(a.value2=o);break}}this.resultHandler(i),g.E.ins.event(v.EventName.UPDATE_REDDOT,216)}},t.prototype.onClick=function(t){switch(t.currentTarget){case this.view.clickRect:var e=this.rankData;e&&g.E.ins.event(v.EventName.OPEN_RANKROLEVIEW,[e.username,e.svrid])}},t.prototype.rendHandler=function(t,e){var i=this.view;t.notGotoInfo=1!=i.tab.selectedIndex,t.setData(i.list.array[e],e)},t.prototype.resultHandler=function(t){var e=t.rankId,i=this.view,n=this.gs2cArr[e];this.gs2cArr[e]=t;var s,o=i.tab.selectedIndex,a=t.rankArr,r=0;switch(o){case 0:r=m.enumKfRankID.rankid_combat;break;case 1:r=-m.enumKfRankID.rankid_family;break;case 2:r=-m.enumKfRankID.rankid_sy;break;case 3:r=-m.enumKfRankID.rankid_zl;break;case 4:r=-m.enumKfRankID.rankid_pet}s=t.my_combat_rank[Math.abs(r)];var l=f.RoleCenter.instans.self;if(l.mobai_user_name=t.mobai_user_name,l.combat_mobai=t.combat_mobai,n||g.E.ins.event(v.EventName.UPDATE_REDDOT,216),a){var h=_.TextConst.get(223);0<s&&(h=s+""),i.myRank.text=h;for(var c=[],u=0;u<a.length;u++){var p=new y.RankItemVo;p.type=r,p.data=a[u],c.push(p)}var d=c[0];this.getfirstData(d),i.list.array=c,C.RedDotM.check(216)}},t.prototype.getfirstData=function(t){if(t){g.E.ins.once(v.EventName.OTHERDATA_UPDATE,this,this.otherDataHandler);var e=t.data;this.rankData=e,s.GNet.getOtherData([e.username],!0,e.svrid)}},t.prototype.otherDataHandler=function(){var t=this.rankData;if(t){var e=f.RoleCenter.instans.getOtherData(t.username);e&&this.setOnePerson(e)}},t.prototype.setOnePerson=function(t){var e=this.view;a.RoleUtil.refreshZww(t.openhero[0],100,e.wing_res,e.weapon_res,e.role_res,e.ani_fumo)},t.prototype.showPage=function(t,e){var i=this.view;i||(this.view=i=new ui.crossserver.CrossSerMingRenUI,n.ClearResM.addBgUrl(i.bgimg.skin),i.list.scrollBar.elasticDistance=50,i.list.itemRender=o.MRTItem,i.list.renderHandler=new Laya.Handler(this,this.rendHandler),i.tab.selectHandler=new Laya.Handler(this,this.tabselectHandle),i.clickRect.on(Laya.Event.CLICK,this,this.onClick)),i.tab.selectedIndex=-1,i.tab.selectedIndex=0,i.bgimg.restskin(),t.addChild(i)},t.prototype.reqRankList=function(t){var e=new m.KfRankListDataC2GS;e.rankId=t,i.GSM.sendServer(e)},t.prototype.tabselectHandle=function(t){var e=0;switch(t){case 0:e=m.enumKfRankID.rankid_combat;break;case 1:e=-m.enumKfRankID.rankid_family;break;case 2:e=-m.enumKfRankID.rankid_sy;break;case 3:e=-m.enumKfRankID.rankid_zl;break;case 4:e=-m.enumKfRankID.rankid_pet}var i=this.view;i.list.array=[];var n,s=Math.abs(e),o=Date.now(),a=this.gs2cArr[s];switch(a?6e4<o-this.lastTime?(this.lastTime=o,this.reqRankList(s)):this.resultHandler(a):this.reqRankList(s),t){case 0:n=[_.TextConst.get(352),_.TextConst.get(353),_.TextConst.get(354),_.TextConst.get(355)];break;case 1:n=[_.TextConst.get(352),_.TextConst.get(356),_.TextConst.get(357),_.TextConst.get(355)];break;case 2:n=[_.TextConst.get(352),_.TextConst.get(356),"神玉装备战力",_.TextConst.get(355)];break;case 3:n=[_.TextConst.get(352),_.TextConst.get(356),"战灵总战力",_.TextConst.get(355)];break;case 4:n=[_.TextConst.get(352),_.TextConst.get(356),"神兽幻化战力",_.TextConst.get(355)];break;default:console.log("index:"+t)}if(n)for(var r=i.name_box,l=0;l<n.length;l++){r.getChildByName("lab"+l).text=n[l]}},t.prototype.getTitle=function(){return"res/csboss/mingrentang_biaoti.png"},t.prototype.hidePage=function(){this.view&&this.view.removeSelf()},t.prototype.destroyPage=function(){this.hidePage()},t.prototype.init=function(){},t.prototype.loadUrls=function(){},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){},t}();e.CSerBossMingRenCtrl=h}),define("src/g/kftb/view/KFTBView",["require","exports","../../../config/GameConfig","../../../utils/system/DateUitl","src/g/fight/osprite/play/kftplay/KFTManager","../../../manager/RoleCenter","../../../utils/system/FloatEffect","../../../manager/RuledescManager","../../net/messages/kuafu/KftbBattleMsg","../../../manager/GameSocketManager"],function(t,e,o,a,r,l,i,n,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.btn_kf1.on(Laya.Event.CLICK,t,t.goHandler,[1]),t.btn_kf2.on(Laya.Event.CLICK,t,t.goHandler,[2]),t.btn_kf3.on(Laya.Event.CLICK,t,t.goHandler,[3]),t.btn_kf4.on(Laya.Event.CLICK,t,t.goHandler,[4]),t.btn_kf5.on(Laya.Event.CLICK,t,t.goHandler,[5]),t.btn_help.on(Laya.Event.CLICK,t,t.helpHandler),Laya.timer.once(2e3,t,t.showView),t}return __extends(t,e),t.prototype.helpHandler=function(){n.RuledescManager.showRuledesc(231)},t.prototype.goHandler=function(t){console.log(t);var e=o.GameConfig.kfTBWorldMapVo[t];e.dayopen<=a.DateUtil.getKFDay()&&(r.KFTManager.ins().getPortState(e.portid)?r.KFTManager.ins().enterHotBloodWar(e):i.FE.upItems("当前跨服没有连上"))},t.prototype.showView=function(){this.xiezhu_count.text=l.RoleCenter.instans.vo.KFTB_HELPCNT+"",this.guishu_count.text=l.RoleCenter.instans.vo.KFTB_CNT+"";var t=o.GameConfig.kfTBWorldMapVo;for(var e in t){var i=t[e];if(i.dayopen>a.DateUtil.getKFDay())this["btn_kf"+e].gray=!0,this["lock"+e].visible=!0,i.dayopen<900?this["tip"+e].text="开服第"+i.dayopen+"天开启":this["tip"+e].text="敬请期待";else{this["btn_kf"+e].gray=!1;var n=r.KFTManager.ins().getPortState(i.portid);if(n)this["tip"+e].text="当前地图人数："+(n.userCount+1);else{var s=new h.KFTBSceneStateC2GS;s.portid=i.portid,c.GSM.sendServer(s),this["tip"+e].text="当前地图人数："+(5*Math.random()>>0)}this["lock"+e].visible=!1}}},t}(ui.kft.KFTBViewUI);e.KFTBView=s}),define("src/g/kftb/ctrl/KFTBCtrl",["require","exports","src/g/kftb/view/KFTBView","src/g/fight/osprite/play/kftplay/KFTManager","src/g/base/BaseCtrl","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){},e.prototype.showPage=function(t,e){t.removeChildren(),this._view||(this._view=new i.KFTBView),t.addChild(this._view),this._view.showView(),o.ClearResM.resetViewImg(this._view)},e.prototype.manager=function(){return n.KFTManager.ins()},e.prototype.getTitle=function(){return"res/kft/yuanzheng_biaoti_wenzi.png"},e.prototype.hidePage=function(){this._view&&this._view.removeSelf()},e.prototype.destroyPage=function(){this.hidePage()},e.prototype.changePerson=function(t,e){},e.prototype.loadUrls=function(){},e.prototype.refreshData=function(){},e}(s.BaseCtrl);e.KFTBCtrl=a}),define("src/g/fight/osprite/play/kfsd/GamePlayKFSD",["require","exports","../../../../../config/GameConfig","../../../../../core/E","../../../../../utils/system/ServerTime","../../../../../enum/EventName","src/g/fight/osprite/obj/FightGroup","../../../../../manager/GameSocketManager","src/g/fight/osprite/play/RealTimeBossScene","../../../../../manager/RoleCenter","../../../../../manager/AM","../../../../../utils/system/DateUitl","src/init/TextConst","src/g/fight/osprite/play/kfsd/KFSDWarManager","../../../../net/messages/kuafu/KfsdBattleMsg"],function(t,e,s,o,a,r,l,h,i,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t){var e=n.call(this,t)||this;e._showDebugKey=!1,e._currPortId=0,e._waitTime=0,e._ownerFG=null,e._sendCdTime=3,e._outInfoKey=!1,e._sceneOpenStateDic={},e._tombStoneMonsterFG=null,e._bossStateChangeKey=!1,e._bossRelifeTime=-1,e._lastLeftTime=-1,e._autoBattleKey=!1,e._enterPortId=-1,e._waitAutoAttackBossTime=-1,e._autoAttackBossTime=5,h.GSM.ins.on(v.KFSDBattleBossHPGS2C.KEY,e,e.onBattleBossHPGS2C),o.E.ins.on(r.EventName.EXIT_BOSS_PLAYTYPE,e,e.onExitHandler);var i=e.manager().getPortId();return e._currPortId=i,e.createAreaMatrixList(i),e.drawRect(),e.enablePK(!0),e._bossGroup=new l.FightGroup(null),e.manager().enterGamePlay(e),e.creatMonster(),e.visibleBossFG(!1),e.visibleTombStone(!1),e}return __extends(t,n),t.prototype.creatMonster=function(){this._tombStoneMonsterFG=this.createTombStoneMonster(27e3)},t.prototype.drawRect=function(){},t.prototype.getStartPoint=function(){return this.startPt[0]},t.prototype.clear=function(){n.prototype.clear.call(this),this._enterPortId=-1,this._tombStoneMonsterFG&&(this._tombStoneMonsterFG.destroyGroup(!0),this._tombStoneMonsterFG=null),h.GSM.ins.off(v.KFSDBattleBossHPGS2C.KEY,this,this.onBattleBossHPGS2C),o.E.ins.off(r.EventName.EXIT_BOSS_PLAYTYPE,this,this.onExitHandler),this.manager().exitGamePlay()},t.prototype.allInit=function(){n.prototype.allInit.call(this),this._fightGroup&&this._mainRole&&this._fightGroup.setFGMapXY(this._mainRole.mapX,this._mainRole.mapY),this._waitTime=a.ServerTime.serverTime+3},t.prototype.frameMove=function(){n.prototype.frameMove.call(this),this.updatePlay()},t.prototype.updatePlay=function(){if(this._ownerFG&&this.manager().updateBossOwnerHp(this._ownerFG.getHp(),this._ownerFG.getTotalHp()),this._bossStateChangeKey)if(this._bossStateChangeKey=!1,n=this.manager().getPortStatus(this._currPortId))switch(n.bossState){case v.EKfsdBossState.CAN_CHALLENGE:this._bossRelifeTime=a.ServerTime.serverTime,this.visibleBossFG(!0),this.visibleTombStone(!1),this.checkToAttackMonster();break;default:this._bossRelifeTime=n.monsterOpenTime,this._lastLeftTime=-1,this.visibleBossFG(!1),this.visibleTombStone(!0)}else this.visibleBossFG(!1),this.visibleTombStone(!1),this._bossRelifeTime=a.ServerTime.serverTime;var t=this._bossRelifeTime-a.ServerTime.serverTime;if(-1!=this._bossRelifeTime&&0<t&&t!=this._lastLeftTime){this._lastLeftTime=t;var e=this._tombStoneMonsterFG,i=e?e.getUnitByIndex(0):null;i&&(i.topHpBar.headName=p.DateUtil.getHMS_countdown(t))}if(this._currTargetFG&&this._currTargetFG.isDeath()&&this.changeBattleState(0),0==this._invincibleKey&&null==this._targetName&&this._mainRole){switch(this._battleState){case 0:if(this._currTargetFG||2==this._mainRole.action)this._waitAutoAttackBossTime=a.ServerTime.serverTime,this._currTargetFG=null;else if(this._currTargetFG=this.getFreeRevengeTarget(),null==this._currTargetFG){var n=this.manager().getPortStatus(this._currPortId),s=a.ServerTime.serverTime-this._waitAutoAttackBossTime>this._autoAttackBossTime;n&&n.bossState==v.EKfsdBossState.CAN_CHALLENGE&&s&&(this._waitAutoAttackBossTime=a.ServerTime.serverTime,this._bossGroup&&this.startKillMonster())}}this._currTargetFG&&this.pkStartAndTestDistance(this._currTargetFG.groupID)}},t.prototype.checkToAttackMonster=function(){if(!this._currTargetFG){var t=this.manager().getPortStatus(this._currPortId);t&&t.bossState==v.EKfsdBossState.CAN_CHALLENGE&&this._bossGroup&&this.startKillMonster()}},t.prototype.changeBattleState=function(t){var e=n.prototype.changeBattleState.call(this,t);return e&&0==t&&(this._waitAutoAttackBossTime=a.ServerTime.serverTime),e},t.prototype.visibleTombStone=function(t){this._tombStoneMonsterFG&&(t?this._tombStoneMonsterFG.addToFightLayer():this._tombStoneMonsterFG.removeFromFightLayer(),this._tombStoneMonsterFG.visibleTopHpBar(t))},t.prototype.addFightGroupSvrID=function(t,e){},t.prototype.setMainRoleByMsg=function(t){n.prototype.setMainRoleByMsg.call(this,t),this.addFightGroupSvrID(this._fightGroup,c.RoleCenter.instans.vo.username),t.opresult&&this.changeScene(t.portid,t.monsterUid)},t.prototype.changeScene=function(t,e){this._waitTime=a.ServerTime.serverTime,this.clearOtherPlayer(),this.clearAllState(),this.showMosnter(t,e)},t.prototype.showMosnter=function(t,e){this._bossGroup.destroyGroup(!1),this.releaseAllMonsterRes();var i=s.GameConfig.getPortByID(t),n=s.GameConfig.getMapJSON(i.boss_scene);n&&0<n.bossXY.length&&(this._monsterDic[-1]=this.createMonster(this._bossGroup,i.boss,e),this._bossGroup.resetFightGroup(n.bossXY[0]),this._bossGroup.setMapXY(n.bossXY[0][0],n.bossXY[0][1]),this._tombStoneMonsterFG&&this._tombStoneMonsterFG.setMapXY(n.bossXY[0][0],n.bossXY[0][1])),this.updateBossState(t)},t.prototype.updateBossState=function(t){t==this._currPortId&&(this._bossStateChangeKey=!0)},t.prototype.changeMatrix=function(){for(var t=[],e=null,i=0;i<this.matrixList.length;i++)(e=this.matrixList[i]).id==this._currPortId&&t.push(e);return t},t.prototype.onExitHandler=function(){u.AM.exitPlay(this.type,new Laya.Handler(this,function(){this.executeExit()}))},t.prototype.executeExit=function(){this.manager().exitHotBloodWar()},t.prototype.onBattleBossHPGS2C=function(t){this._monsterDic[t.monsterUid]&&(this.manager().setMonsterHp(t.bossHP),this.setMonsterHp(t.monsterUid,t.bossHP,!0),t.bossHP<=0&&this.bossDead())},t.prototype.onBattleBossReviveGS2C=function(t){this.getCurrPortId()==t.portid&&this.showMosnter(t.portid,t.monsterUid)},t.prototype.onActivityRebirthGS2C=function(t){this.resetHero(t.userAcc,t.posx,t.posy),n.prototype.onActivityRebirthGS2C.call(this,t)},t.prototype.showDeadAlert=function(t,e){n.prototype.showDeadAlert.call(this,t,e),this.manager().showDeadAlert(e)},t.prototype.gotoPortCenter=function(t){for(var e=null,i=0;i<this.matrixList.length;i++)if(t==this.matrixList[i].id){e=this.matrixList[i];break}if(e){var n=this.getCoordinatePos(e);this.followTargetPos(n[0],n[1],0)}},t.prototype.gotoBoss=function(t){var e=s.GameConfig.getPortByID(t),i=s.GameConfig.getMapJSON(e.boss_scene);i&&0<i.bossXY.length&&this.followTargetPos(i.bossXY[0][0],i.bossXY[0][1]),this._autoBattleKey=!0},t.prototype.onMoveEndSC=function(t){n.prototype.onMoveEndSC.call(this,t);var e=Math.floor(t/l.FightGroup.HERO_MAXNUM),i=t%l.FightGroup.HERO_MAXNUM;this._mainRole&&e==this.fightGroup.uId&&i==this._mainRole.index&&this._autoBattleKey&&(this._autoBattleKey=!1,this.startKillMonster())},t.prototype.addPPlayer=function(t){var e=t.getFamilyUid();""==e||null==e?n.prototype.addPPlayer.call(this,t):t.getFamilyUid()!=this._fightGroup.getFamilyUid()?n.prototype.addPPlayer.call(this,t):this.addFamilyMemeber(t)},t.prototype.onSelectPkTarget=function(t){var e=this._playerDic[t];if(e){var i=e.getFamilyUid();""==i||null==i?n.prototype.onSelectPkTarget.call(this,t):i!=this._fightGroup.getFamilyUid()?n.prototype.onSelectPkTarget.call(this,t):u.AM.show(d.TextConst.get(453,e.getNickName()),Laya.Handler.create(this,this.surePkTarget,[t]))}},t.prototype.manager=function(){return g.KFSDWarManager.getInstance()},t.prototype.setBossOwner=function(t){this._ownerFG=t,this._bossGroup&&!this._bossGroup.isDeath()&&this._bossGroup.setOnceTarget(this._ownerFG)},t.prototype.surePkTarget=function(t){n.prototype.onSelectPkTarget.call(this,t)},t.prototype.onClearTargetHandler=function(t){n.prototype.onClearTargetHandler.call(this,t),this._outInfoKey=!0,this._autoBattleKey=!1},t.prototype.setEnterPortId=function(t){this._enterPortId=t},t.prototype.getCurrPortId=function(){return this._currPortId},t}(i.RealTimeBossScene);e.GamePlayKFSD=n}),define("src/g/hotblood/view/HotBloodWarResult",["require","exports","src/g/account/view/AccItem","../../../utils/ItemUtils"],function(t,e,i,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.initList(t.rewardList,t.rewardRender,i.AccItem),t}return __extends(t,e),t.prototype.initList=function(t,e,i){t.itemRender=i,t.selectEnable=!0,t.vScrollBarSkin="",t.scrollBar.elasticDistance=100,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.rewardRender=function(t,e){t.eqData=this.rewardList.array[e]},t.prototype.showView=function(){this.popup(),this.img_bg.rotation=0,Laya.timer.loop(120,this,this.updEffectDisplay)},t.prototype.updEffectDisplay=function(){this.img_bg.rotation+=10},t.prototype.showResult=function(t,e,i){if(0!=t&&1!=t||null==e?this.rewardList.visible=!1:(this.rewardList.visible=!0,this.rewardList.array=e),this.lbFailDes.visible=2==t,2!=t)this.winSignBox.visible=!0,this.guiShuZheBox.visible=!1,this.lbNoTime.visible=null==e,this.winRewardTitle.skin=0==t?(this.wintitle.skin="res/jiesuan/jiesuan_woshiguishuzhe.png","res/jiesuan/jiesuan_guishujiangli.png"):(this.wintitle.skin="res/jiesuan/zhuzhanchenggong.png","res/jiesuan/zhuzhanjiangli.png");else if(this.winSignBox.visible=!1,this.lbNoTime.visible=!1,this.guiShuZheBox.visible=!0,i){var n=i.getUnitByIndex(0);n&&(this.imgHead.skin=s.ItemUtils.getHeadurlYuan(n.sex,n.job),this.lbName.text=n.actorName)}},t}(ui.hotblood.HotWarResultUI);e.HotBloodWarResult=n}),define("src/g/hotblood/ctrl/HotBloodWarResultCtrl",["require","exports","src/g/hotblood/view/HotBloodWarResult","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager","../../../utils/CountDown","../../../utils/system/ServerTime","../../../utils/ItemDropUtil","../../../utils/SoundUtils","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg","src/g/fight/osprite/play/kfhotblood/KfHotBloodManager","src/init/TextConst","src/g/fight/osprite/play/kftplay/KFTManager"],function(t,e,s,i,n,o,a,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(){function t(){this.countDown=new r.CountDown,i.E.ins.on(n.EventName.OPEN_HOTBLOOD_RESULT,this,this.showResultHander)}return t.prototype.showResultHander=function(t){if(null==this.view){this.view=new s.HotBloodWarResult,this.view.closeHandler=Laya.Handler.create(this,this.destoryView);var e=void 0,i=void 0;switch(e=t.bossowner==o.RoleCenter.instans.self.username?(i=0,t.zeroBBCNT?null:h.ItemDropUtil.createRewardList(t.invent)):t.helpData&&t.helpData.isHelp?(i=1,h.ItemDropUtil.createRewardList(t.helpData.invent)):(i=2,null),u.PlayManager.type){case p.EPlayType.PLAYTYPE_KFRX:var n=d.KFHotBloodManager.ins().getPlayerFG(t.bossowner);break;case p.EPlayType.PLAYTYPE_KFTB:n=v.KFTManager.ins().getPlayerFG(t.bossowner);default:n=a.HotBloodWarManager.getInstance().getPlayerFG(t.bossowner)}this.view.showResult(i,e,n),this.view.showView(),this.countDown.start(l.ServerTime.serverTime+5,this.updCountDownHander,this)}},t.prototype.updCountDownHander=function(t){this.view.getChildByName("close").label=g.TextConst.get(243,t),0==t&&this.view.close()},t.prototype.destoryView=function(){c.SoundUtils.getInstance().playBtnsounds(),this.countDown.stop(),this.view.closeHandler=null,this.view.destroy(!0),this.view=null},t}();e.HotBloodWarResultCtrl=f}),define("src/g/kfsd/ctrl/KFSDWarCtrl",["require","exports","../../../core/E","../../../enum/EventName","../../../utils/ItemUtils","../../../enum/SettingEnum","src/g/setting/vo/SettingInfo","src/g/setting/ctrl/SettingCtrl","src/g/fight/osprite/play/kfsd/KFSDWarManager","src/g/hotblood/view/HotBloodWar","src/g/hotblood/ctrl/HotBloodWarDeathCtrl","../../net/messages/chat/ChatC2GS","../../net/messages/chat/ChatGS2C","src/init/TextConst"],function(t,e,n,s,o,i,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(){function t(){this._bossHp=0,this.deathCtrl=new c.HotBloodWarDeathCtrl}return t.prototype.showBattlePanel=function(t){this.currportid=t,n.E.ins.on(s.EventName.UPDATE_REVENGE_VIEW_TARGET,this,this.updateFoeListHandler),n.E.ins.on(s.EventName.UPDATE_VIEW_TARGET,this,this.updPlayerListHander),n.E.ins.on(s.EventName.UPDATE_VIEW_FAMILYMEMBER,this,this.updateMyFamilyList),n.E.ins.on(s.EventName.CHANGE_PK_TARGET,this,this.attackTargetChangedHander),n.E.ins.on(s.EventName.OTHER_PLAYER_STATUS_CHANGED,this,this.onOPlayerStatusChanged),null==this.view&&(this.view=new h.HotBloodWar,this.view.showView(),this.view.familyFriendLink.visible=!0),this.updHideBtnStatus(),this.view.attackBoss.on(Laya.Event.CLICK,this,this.attackBossHander),this.view.bossHead.on(Laya.Event.CLICK,this,this.attackBossHander),this.view.hideOPlayerButton.on(Laya.Event.CLICK,this,this.hidePlayer),this.view.visible=!0;var e=o.ItemUtils.getBossVoByPortId(t),i=o.ItemUtils.getMonsterVOById(t);e&&i&&this.view.setBoss(e,i.HP),this.view.familyFriendLink.offAll(Laya.Event.CLICK),this.view.familyFriendLink.on(Laya.Event.CLICK,this,this.onLinkHandler)},t.prototype.onLinkHandler=function(){var t=new p.ChatGS2C;t.type=u.enumChatType.family;var e="@12@#"+this.manager().getPortId();t.msg=e,n.E.ins.event(s.EventName.SEND_CHAT,[e,u.enumChatType.family])},t.prototype.hideBattlePanel=function(t){void 0===t&&(t=!0),this.view&&(n.E.ins.off(s.EventName.UPDATE_REVENGE_VIEW_TARGET,this,this.updateFoeListHandler),n.E.ins.off(s.EventName.UPDATE_VIEW_TARGET,this,this.updPlayerListHander),n.E.ins.off(s.EventName.UPDATE_VIEW_FAMILYMEMBER,this,this.updateMyFamilyList),n.E.ins.off(s.EventName.CHANGE_PK_TARGET,this,this.attackTargetChangedHander),n.E.ins.off(s.EventName.OTHER_PLAYER_STATUS_CHANGED,this,this.onOPlayerStatusChanged),this.view.attackBoss.off(Laya.Event.CLICK,this,this.attackBossHander),this.view.bossHead.off(Laya.Event.CLICK,this,this.attackBossHander),this.view.hideOPlayerButton.off(Laya.Event.CLICK,this,this.hidePlayer),this.view.visible=!1)},t.prototype.updateFoeListHandler=function(t){this.view&&this.view.updFoeList(t)},t.prototype.updateMyFamilyList=function(t){this.view&&this.view.updMyFamilyList(t)},t.prototype.updPlayerListHander=function(t){this.view&&this.view.updPlayerList(t)},t.prototype.attackTargetChangedHander=function(t){this.view&&this.view.changeAttackTarget(t)},t.prototype.exit=function(){this.manager().viewCtrl=null,this.view&&(this.view.visible&&this.hideBattlePanel(!1),this.view.removeSelf(),this.view.destroy(!0),this.view=null),this.deathCtrl.relase(),r.SettingCtrl.getInstance().hideOtehrPlayer(!1)},t.prototype.updateBossHp=function(t){this._bossHp=t,this.view&&this.view.updBossHP(t)},t.prototype.updateBossOwner=function(t){this.view&&this.view.setGuiShuZhe(t)},t.prototype.updateBossOwnerHp=function(t,e){this.view&&this.view.updGuiShuZheHP(t,e)},t.prototype.updateBossState=function(t){this.view},t.prototype.visibleBossView=function(t){this.view&&this.view.visibleBossView(t)},t.prototype.attackBossHander=function(){this.manager().findBoss()},t.prototype.manager=function(){return l.KFSDWarManager.getInstance()},t.prototype.getDeathCtrl=function(){return this.deathCtrl},t.prototype.onDeath=function(t,e,i){this.deathCtrl.onDeath(t,e,i),this.view&&this.view.visible&&this.view.onDeath()},t.prototype.updJianMianHurt=function(t){this.view&&(this.view.lbHurtJianMian.text=d.TextConst.get(888,t))},t.prototype.onOPlayerStatusChanged=function(){this.updHideBtnStatus()},t.prototype.updHideBtnStatus=function(){1==a.SettingInfo.getSettingValue(i.SettingEnum.hideOtherPlayer)?this.view.hideOPlayerButton.skin="res/fightview/rexue_pingbiguan.png":this.view.hideOPlayerButton.skin="res/fightview/rexue_pingbikai.png"},t.prototype.hidePlayer=function(){a.SettingInfo.getSettingValue(i.SettingEnum.hideOtherPlayer)?r.SettingCtrl.getInstance().hideOtehrPlayer(!1):r.SettingCtrl.getInstance().hideOtehrPlayer(!0)},t}();e.KFSDWarCtrl=g}),define("src/g/fight/osprite/play/kfsd/KFSDWarManager",["require","exports","../../../../../manager/GameSocketManager","../../../../net/messages/EnterMuSceneC2GS","../../../../../config/GameConfig","../../../../../core/E","../../../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../../../utils/system/FloatEffect","src/init/TextConst","../../../../net/messages/ChangeSceneMsg","../../../../../plugin/view/ToolTip","../../../../../manager/AM","../../../../../manager/RoleCenter","../../../../../utils/system/ServerTime","../../../../../utils/ItemUtils","src/g/fight/osprite/play/PlayManager","../../../../net/messages/ActivityMessage","../../../../net/messages/BloodyBattleMsg","../../../../net/messages/kuafu/KfsdBattleMsg","src/g/kfsd/ctrl/KFSDWarCtrl"],function(t,e,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,i,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var I=function(){function t(){this.gamePlay=null,this._battleOpenStateMsg=null,this._bossVoInitKey=!1,this._bossVoDic={},this._bossInfoDic={},this._enterTime=-1,this._ownerFG=null,this._relifeTime=-1,this._enterPortId=-1,this._openPanelKey=!1,this.viewCtrl=null,this._cdtime=0,this._panelReqKey=!1}return t.getInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.enterGamePlay=function(t){this.viewCtrl||(this.viewCtrl=new C.KFSDWarCtrl);var e=n.GSM.ins;e.on(m.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),e.on(_.KFSDBattleBossEndGS2C.KEY,this,this.onBloodyBattleBossEndGS2C),e.on(m.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChangeGS2C),this.setBossOwner(null),this.gamePlay=t,this.gamePlay.setEnterPortId(this._enterPortId);var i=this.gamePlay.getStartPoint();e.on(s.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C),this.gamePlay.sendEnterMuSceneC2GS(!0,this._enterPortId,i[0],i[1])},t.prototype.exitGamePlay=function(){this.viewCtrl&&(this.viewCtrl.exit(),this.viewCtrl=null),this._enterPortId=-1,this.setBossOwner(null);var t=n.GSM.ins;t.off(m.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),t.off(i.BloodyBattleBossEndGS2C.KEY,this,this.onBloodyBattleBossEndGS2C),t.off(m.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChangeGS2C),this.gamePlay=null,t.off(s.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C)},t.prototype.onEnterMuSceneGS2C=function(t){if(t.opresult)if(t.enter){if(this.viewCtrl){var e=t.portid;this.viewCtrl.showBattlePanel(e),this.setBossOwner(null),this.reqBossKillState(e),this.reqOpenBossInfoPanel(e)}this.gamePlay.setMainRoleByMsg(t)}else a.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,l.PlayTypeVo.create(u.EPlayType.PLAYTYPE_PORT));else a.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,l.PlayTypeVo.create(u.EPlayType.PLAYTYPE_PORT)),console.log("HotBloodWarManager::onEnterMuSceneGS2C:"+t.error),h.FE.upItems(c.TextConst.showErrorInfo(t.error),p.BubbleEnum.center)},t.prototype.enterHotBloodWar=function(t,e){if(void 0===e&&(e=u.EPlayType.PLAYTYPE_KFSD),!g.RoleCenter.instans.bagRoomEnough())return d.AM.showBagNotEnough(),!1;if(y.PlayManager.isSpecialPlay()&&y.PlayManager.type!=e)return h.FE.upItems(c.TextConst.get(406),p.BubbleEnum.center),!1;if(30<v.ServerTime.serverTime-this._cdtime)return this._cdtime=v.ServerTime.serverTime,this._enterPortId=t,this.getPortStatus(this._enterPortId),a.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,l.PlayTypeVo.create(e)),!0;var i=30-(v.ServerTime.serverTime-this._cdtime);return h.FE.upItems(c.TextConst.get(984,i),p.BubbleEnum.center),!1},t.prototype.sendEvt=function(t){a.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,l.PlayTypeVo.create(t))},t.prototype.exitHotBloodWar=function(){this.gamePlay&&this.gamePlay.sendEnterMuSceneC2GS(!1,this.gamePlay.getCurrPortId(),0,0)},t.prototype.getBossVoByPortId=function(t){if(0==this._bossVoInitKey){this._bossVoInitKey=!0;var e=null,i=o.GameConfig.rexiezhanchangVo;for(var n in i)e=i[n],this._bossVoDic[e.port]=e}return this._bossVoDic[t]},t.prototype.findBoss=function(){this.gamePlay&&this.gamePlay.startKillMonster()},t.prototype.onBloodyBattleActOpenState=function(t){this._battleOpenStateMsg=t},t.prototype.reqOpenBossInfoPanel=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!0);var i=new _.KFSDBattleBossStateC2GS;i.portid=t,i.requestAll=0==t,n.GSM.sendServer(i),this._openPanelKey=e},t.prototype.onBattleBossStateAll=function(t){for(var e=null,i=0;i<t.bossStateArr.length;i++)e=t.bossStateArr[i],this._bossInfoDic[e.portid]=e;this._openPanelKey&&(this._openPanelKey=!1,this.openBossInfoPanel())},t.prototype.openBossInfoPanel=function(){a.E.ins.event(r.EventName.HOTBLOOD_DATA_INITED)},t.prototype.getPortStatus=function(t){return this._bossInfoDic[t]},t.prototype.getBossInfoDic=function(){return this._bossInfoDic},t.prototype.onBattleBossStateGS2C=function(t){this._bossInfoDic[t.portid];this._bossInfoDic[t.portid]=t,this.bossStateChange(t)},t.prototype.onBattleBossReviveGS2C=function(t){var e=this._bossInfoDic[t.portid];e&&(e.bossState=_.EKfsdBossState.CAN_CHALLENGE,this.bossStateChange(e),this.reqOpenBossInfoPanel(t.portid)),this.gamePlay&&this.gamePlay.onBattleBossReviveGS2C(t)},t.prototype.reqBossKillState=function(t,e){void 0===e&&(e=0);var i=new _.KFSDBossKillStateC2GS;i.portid=t,n.GSM.sendServer(i),1==e&&(this._panelReqKey=!0)},t.prototype.onBossKillStateGS2C=function(t){if(this._panelReqKey)this._panelReqKey=!1,a.E.ins.event(r.EventName.HOTBLOOD_REPORT_RECEIVED,t);else{if(this.setDecHurt(t.bossOwnerDecHurt),this.gamePlay){var e=this.gamePlay.getPlayerFG(t.owneruname);this.setBossOwner(e)}this._bossInfoDic[t.portid]&&this.bossStateChange(this._bossInfoDic[t.portid])}},t.prototype.onBossOwnerChangeGS2C=function(t){if(""==t.newowner)this.setBossOwner(null);else{var e=this.gamePlay.getPlayerFG(t.newowner);this.setBossOwner(e)}},t.prototype.showDeadAlert=function(t){this.viewCtrl.onDeath(t,new Laya.Handler(this,this.onMoneyLife),new Laya.Handler(this,this.onReLife))},t.prototype.onReLife=function(){this.sendRebord(!0)},t.prototype.onMoneyLife=function(){this.sendRebord(!1)},t.prototype.onActivityRebirthGS2C=function(t){this.gamePlay&&this.gamePlay.onActivityRebirthGS2C(t),t.opresult?t.userAcc==g.RoleCenter.instans.self.username&&this.viewCtrl.getDeathCtrl().relase():console.error(t.error)},t.prototype.onBloodyBattleBossEndGS2C=function(t){null!=t.bossowner&&""!=t.bossowner?(t.bossowner==g.RoleCenter.instans.self.username&&t.invent&&(g.RoleCenter.instans.addInventoryToC(t.invent),h.FE.addInventoryToCFloats(t.invent)),t.helpData&&t.helpData.isHelp&&t.helpData.invent&&(g.RoleCenter.instans.addInventoryToC(t.helpData.invent),h.FE.addInventoryToCFloats(t.helpData.invent))):console.warn("热血战场结算没有归属者"),a.E.ins.event(r.EventName.OPEN_HOTBLOOD_RESULT,t),this.gamePlay&&this.gamePlay.getCurrPortId()==t.portid&&this.setBossOwner(null)},t.prototype.sendRebord=function(t){if(this.gamePlay){var e=null,i=new m.ActivityRebirthC2GS;i.acttype=m.EACT_TYPE.kfsd,e=(i.freeRebirth=t)?this.gamePlay.getStartPoint():this.gamePlay.getSelfPos(),i.posx=e[0],i.posy=e[1],n.GSM.sendServer(i)}else console.error("不在玩法中")},t.prototype.outConditionErrInfo=function(t,e){var i=this.getBossVoByPortId(e),n=null;switch(t){case 0:break;case 1:n=c.TextConst.get(458,f.ItemUtils.getEquipLv(i.limit1));break;case 2:n=c.TextConst.get(459,i.limit2);break;case 3:n=c.TextConst.get(469)}n&&h.FE.upItems(n,p.BubbleEnum.center)},t.prototype.getSelfPos=function(){return this.gamePlay?this.gamePlay.getSelfPos():[0,0]},t.prototype.getPlayerFG=function(t){return this.gamePlay?this.gamePlay.getPlayerFG(t):null},t.prototype.getPortId=function(){return this._enterPortId},t.prototype.changePortId=function(t){},t.prototype.setMonsterHp=function(t){if(this.viewCtrl){this.viewCtrl.updateBossHp(t);this._bossInfoDic[this.getPortId()]}},t.prototype.setBossOwner=function(t){this._ownerFG!=t&&(this._ownerFG=t,this.updateBossOwner(t)),this.gamePlay&&this.gamePlay.setBossOwner(t)},t.prototype.setDecHurt=function(t){this.viewCtrl&&this.viewCtrl.updJianMianHurt(t)},t.prototype.updateBossOwner=function(t){this.viewCtrl&&this.viewCtrl.updateBossOwner(t)},t.prototype.updateBossOwnerHp=function(t,e){this.viewCtrl&&this.viewCtrl.updateBossOwnerHp(t,e)},t.prototype.bossStateChange=function(t){var e=t.portid;this.viewCtrl&&this.viewCtrl.updateBossState(e),this.gamePlay&&this.gamePlay.updateBossState(e),this.checkIsShowBossView(e)},t.prototype.checkIsShowBossView=function(t){if(this.viewCtrl&&(this.gamePlay&&this.gamePlay.getCurrPortId()==t))if(this._bossInfoDic[t])switch(this._bossInfoDic[t].bossState){case _.EKfsdBossState.CAN_CHALLENGE:this.viewCtrl.visibleBossView(!0);break;default:this.viewCtrl.visibleBossView(!1)}else this.viewCtrl.visibleBossView(!1)},t._instance=null,t}();e.KFSDWarManager=I}),define("src/g/kfsd/view/KFSDView",["require","exports","../../../config/GameConfig","../../../manager/RoleCenter","../../net/messages/kuafu/KfsdBattleMsg","../../../manager/GameSocketManager","src/g/fight/osprite/play/kfsd/KFSDWarManager","../../../utils/system/ServerTime","../../../utils/system/DateUitl","../../../utils/system/FloatEffect","../../../component/GAnimation","../../../utils/ItemUtils","src/g/fight/base/RES","src/g/peronboss/view/ItemIconView","src/g/clearRes/ClearResM","../../../manager/RuledescManager","src/init/Switches"],function(t,e,p,d,a,r,i,g,v,n,s,h,c,u,l,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(o){function t(){var t=o.call(this)||this;t._monstList=[],t._bossStateArr=[];var e=d.RoleCenter.instans.vo.username.split("_")[1];e&&0<e.length&&(t.svrid=parseInt(e)),Laya.timer.loop(1e3,t,t.loopHandler);var i=p.GameConfig.kfsdvo,n=0;for(var s in i)t._monstList.push(i[s]),t["i"+n].on(Laya.Event.CLICK,t,t.clickHandler,[t._monstList[n]]),n++;return t.btn_Link.on(Laya.Event.CLICK,t,function(){y.Switches.ins.event(239)}),r.GSM.ins.on(a.KFSDBattleBossStateAll.KEY,t,t.KFSDBattleBossStateAll),t.btn_help.on(Laya.Event.CLICK,t,t.helpHandler),t}return __extends(t,o),t.prototype.helpHandler=function(){f.RuledescManager.showRuledesc(241)},t.prototype.clickHandler=function(t){if(!(this._bossStateArr&&this._bossStateArr.length<=0))if(t.limit2>d.RoleCenter.instans.vo.ssLv){var e=p.GameConfig.SSLv[t.limit2];e&&n.FE.upItems(e.name+"开启")}else{var i=this._bossStateArr[this._bossStateArr.length-1];if(i.portid==t.port)if(!(i.leftOpenTime-g.ServerTime.serverTime<=0))return void n.FE.upItems("暂未开启");this._view||(this._view=new ui.crossserver.KFSDBossViewUI,this._animation=new s.GAnimation,this._animation.x=270,this._animation.y=410,this._view.addChild(this._animation),this._view.bgView.btn_close.on(Laya.Event.CLICK,this,this.closeHandler),this._view.closeHandler=new Laya.Handler(this,this.clear),this._view.challenageButton.on(Laya.Event.CLICK,this,this.enterHandler)),this._cvo=t,this._view.popup(),this.refreshMonster(t),l.ClearResM.resetViewImg(this._view)}},t.prototype.enterHandler=function(){i.KFSDWarManager.getInstance().enterHotBloodWar(this._cvo.port)},t.prototype.clear=function(){l.ClearResM.clearUrl(this._animation._url)},t.prototype.closeHandler=function(){this._view.close()},t.prototype.refreshMonster=function(t){var e=h.ItemUtils.getMonsterVOById(h.ItemUtils.getPortVoById(t.port).boss[0]);this._view.bossname.text=e.name,this._view.item0.visible=!1,this._view.item1.visible=!1;for(var i=t.showReward,n=0;n<i.length;n++){var s=h.ItemUtils.getItemOrEq(i[n]),o=this._view["item"+n];o&&(o.visible=!0,u.ItemIconView.setItemData(s,o,1))}var a,r=1,l=e.moResVo;-1==l.dir.indexOf(5)?(a=c.RES.monsterPath(l.res,3,3),r=-e.zoom):(r=e.zoom,a=c.RES.monsterPath(l.res,3,5)),Laya.loader.load(a,Laya.Handler.create(this,function(){null!=this._animation&&(this._animation.clear(!0),this._animation.load(a),this._animation.scale(r,e.zoom))}),null,Laya.Loader.ATLAS)},t.prototype.KFSDBattleBossStateAll=function(t){t.bossStateArr&&(this._bossStateArr=t.bossStateArr,this.loopHandler())},t.prototype.loopHandler=function(){for(var t=0;t<this._monstList.length;t++){var e=this._monstList[t],i=this["t"+t],n=this["n"+t],s=this["ti"+t],o=this["sv"+t],a=this["tb"+t],r=this._bossStateArr[t];if(r){s.visible=!1,i.visible=!0;var l=r.monsterOpenTime-g.ServerTime.serverTime;if(t==this._monstList.length-1){l=r.leftOpenTime-g.ServerTime.serverTime;i.text=v.DateUtil.getHMS_countdown(l)}0<l?(i.visible=!0,a.visible=!0,i.text=v.DateUtil.getHMS_countdown(l)):(i.visible=!1,a.visible=!1);var h=r.ownernick;if(h){var c=Math.abs(r.ownersvrid-ktgameconfig.LoginVo.startsvid);r.ownersvrid==ktgameconfig.LoginVo.SvrData.svrID?o.text="本服":o.text="S"+c+"区",n.text=h,o.visible=n.visible=!0}else n.text=o.text="",s.color="#a89e8f",s.visible=!0,s.text="无人占领";if(d.RoleCenter.instans.vo.ssLv<e.limit2){var u=p.GameConfig.SSLv[e.limit2];u&&(s.text=u.name+"开启"),o.visible=n.visible=!1,s.color="#D53127",s.visible=!0,i.visible=!1,a.visible=!1}}}},t.prototype.showView=function(){var t=new a.KFSDBattleBossStateC2GS;t.requestAll=!0,r.GSM.sendServer(t),this.ower_count.text=d.RoleCenter.instans.vo.KFSDCNT+"",this.help_count.text=d.RoleCenter.instans.vo.KFSDHELPCNT+""},t}(ui.kfsd.KFSDViewUI);e.KFSDView=o}),define("src/g/kfsd/ctrl/KFSDCtrl",["require","exports","src/g/base/BaseCtrl","src/g/clearRes/ClearResM","src/g/kfsd/view/KFSDView"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(){},e.prototype.showPage=function(t,e){t.removeChildren(),this._view||(this._view=new s.KFSDView),t.addChild(this._view),this._view.showView(),n.ClearResM.resetViewImg(this._view)},e.prototype.getTitle=function(){return"res/kfsd/lingdi_biaoti.png"},e.prototype.hidePage=function(){this._view&&this._view.removeSelf()},e.prototype.destroyPage=function(){this.hidePage()},e.prototype.changePerson=function(t,e){},e.prototype.loadUrls=function(){},e.prototype.refreshData=function(){},e}(i.BaseCtrl);e.KFSDCtrl=o}),define("src/g/crossserboss/csathletics/ctrl/CSAthleticsData",["require","exports","../../../net/messages/kuafu/KfjjcMsg","../../../../manager/GameSocketManager","../../../../component/NumberEventDispatcher","../../../../manager/RoleCenter","../../../../enum/EventName","../../../../core/E","../../../../manager/LayerManager","src/g/fight/info/PlayTypeVo","../../../net/messages/ChangeSceneMsg","../../../../config/GameConfig","../../../../manager/NewRedHintsCenter","src/g/accessctrl/AccessCenter","../../../../utils/system/ServerTime","../../../../manager/AM","../../../../utils/system/FloatEffect","src/init/TextConst"],function(t,e,h,c,i,u,n,s,o,a,r,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function l(){var t=e.call(this)||this;return t._lastReqFightTime=0,t.initNetListenner(),g.AccessCenter.ins.inited?t.onInitRed():s.E.ins.on(n.EventName.ACCESS_CENTER_INITED,t,t.onInitRed),t}return __extends(l,e),Object.defineProperty(l,"ins",{get:function(){return l._ins||(l._ins=new l),l._ins},enumerable:!0,configurable:!0}),l.prototype.onInitRed=function(){g.AccessCenter.ins.checkOpen(242)?this.checkRed():g.AccessCenter.ins.on(242,this,this.checkRed)},l.prototype.reqToFight=function(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var s=p.GameConfig.kfjjcVoCfg.rechance,o=Number(s.value);if(l.ins.challengeData.count<o){if(!u.RoleCenter.instans.bagRoomEnough())return void f.AM.showBagNotEnough();var a=Date.now();if(1e4<a-this._lastReqFightTime){var r=new h.KfjjcFightC2GS;r.svrid=t,r.username=e,r.category=i,r.recordId=n,c.GSM.sendServer(r),this._lastReqFightTime=a}else y.FE.upItems(m.TextConst.get(258))}else y.FE.upItems(m.TextConst.get(1069))},l.prototype.onInitInfoBack=function(t){this.initData=t,this.event(l.INIT_DATA_CHANGED),this.checkRed()},l.prototype.initNetListenner=function(){c.GSM.ins.on(h.KfjjcGetChallengeListG2C.KEY,this,this.updateChallengeData),c.GSM.ins.on(h.KfjjcBuyCountGS2C.KEY,this,this.onBuyCountback),c.GSM.ins.on(h.KfjjcGetRecordListGS2GC.KEY,this,this.onRecordListHandler),c.GSM.ins.on(h.KfjjcGetLastRankGS2C.KEY,this,this.updateLastRankList),c.GSM.ins.on(h.KfjjcGetRankGS2C.KEY,this,this.updateRankList),c.GSM.ins.on(h.KfjjcFightGS2C.KEY,this,this.startFightBack),c.GSM.ins.on(h.KfjjcOpenStateGS2C.KEY,this,this.onInitInfoBack)},l.prototype.onRecordListHandler=function(t){this.recordListData=t,this.event(l.CHALLENGE_RECORD_CHANGED)},l.prototype.updateChallengeData=function(t){this.challengeData=t,this.event(l.CHALLENGE_DATA_CHANGED),this.checkRed(),this.checkAutoRecoveryTime()},l.prototype.checkAutoRecoveryTime=function(){if(Laya.timer.clear(this,this.recoveryTime),0<this.challengeData.count){var t=v.ServerTime.serverTime,e=p.GameConfig.kfjjcVoCfg.cd,i=Number(e.value),n=i-(t-this.challengeData.restoreTime)%i;Laya.timer.once(1e3*n,this,this.recoveryTime)}},l.prototype.recoveryTime=function(){this.challengeData.count--,this.event(l.CHALLENGE_DATA_CHANGED),this.checkRed()},l.prototype.updateLastRankList=function(t){this.lastRankListData=t,this.event(l.LAST_RANK_DATA_CHANGED)},l.prototype.updateRankList=function(t){this.ranklistData=t,this.event(l.RANK_DATA_CHANGED)},l.prototype.onBuyCountback=function(t){u.RoleCenter.instans.GOLD-=t.usedGold,u.RoleCenter.instans.event(n.EventName.ROLE_PROP_CHANGE),this.challengeData.count=t.curKfjjcCount,this.challengeData.buyCount=t.curKfjjcBuyCount,this.challengeData.restoreTime=t.curKfjjcRestoreTime,this.event(l.CHALLENGE_DATA_CHANGED),this.checkRed(),this.checkAutoRecoveryTime()},l.prototype.startFightBack=function(t){this._lastReqFightTime=0,t.opresult?(s.E.ins.event(n.EventName.PLAY_TYPE_CHANGE,a.PlayTypeVo.create(r.EPlayType.PLAYTYPE_KFJJC,t)),o.LayerManager.closeAllPOPWindow()):console.error(t.error)},l.prototype.checkRed=function(){if(g.AccessCenter.ins.checkOpen(242)&&this.initData&&this.initData.isOpen){var t=p.GameConfig.kfjjcVoCfg.rechance,e=Number(t.value);if((this.challengeData?this.challengeData.count:this.initData.count)<e)return void d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.kfjjc_fight_list,!0)}d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.kfjjc_fight_list,!1)},l.CHALLENGE_DATA_CHANGED=1,l.CHALLENGE_RECORD_CHANGED=2,l.LAST_RANK_DATA_CHANGED=3,l.RANK_DATA_CHANGED=4,l.INIT_DATA_CHANGED=5,l}(i.NumberEventDispatcher);e.CSAthleticsData=l}),define("src/g/crossserboss/view/CSAthleticsPage",["require","exports","../../../utils/system/DateUitl","../../../utils/system/ServerTime","src/g/crossserboss/csathletics/ctrl/CSAthleticsData","../../../manager/RuledescManager","src/init/Switches"],function(t,e,n,s,i,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.btn_enter.on(Laya.Event.CLICK,t,t.onEnterAthleticsPanel),t.list_rank.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t.btn_help.on(Laya.Event.CLICK,t,t.helpHandler),t}return __extends(t,e),t.prototype.helpHandler=function(){o.RuledescManager.showRuledesc(242)},t.prototype.onListRenderHandler=function(t,e){var i=t.dataSource;1==i.rank?t.img_rank.skin="res/rank/new/paihang_huizhang1st.png":2==i.rank?t.img_rank.skin="res/rank/new/paihang_huizhang2st.png":3==i.rank&&(t.img_rank.skin="res/rank/new/paihang_huizhang3st.png"),t.lab_svr.changeText(i.svrname),t.lab_name.changeText(i.familyname),t.lab_score.changeText(i.jjcScore.toString())},t.prototype.onEnterAthleticsPanel=function(){a.Switches.ins.event(243)},t.prototype.setData=function(t){this._data&&this._data.off(i.CSAthleticsData.INIT_DATA_CHANGED,this,this.onInitDataChanged),this._data=t,this._data&&this._data.on(i.CSAthleticsData.INIT_DATA_CHANGED,this,this.onInitDataChanged),this.onInitDataChanged()},t.prototype.onInitDataChanged=function(){this._data&&this._data.initData&&(this._initData=this._data.initData,this._initData.isOpen?this.lab_time.changeText(n.DateUtil.getYTD_hms(1e3*this._data.initData.startTime,"y-t-d h点")+"——"+n.DateUtil.getYTD_hms(1e3*this._data.initData.endTime,"y-t-d h点")):this.lab_time.changeText("未开启"),this.cooldownHandler(),this.list_rank.array=this._initData.familyArr,this.btn_enter.disabled=!this._initData.isOpen)},t.prototype.cooldownHandler=function(){var t=!1;if(this._initData){var e=s.ServerTime.serverTime;t=e>this._initData.startTime&&e<this._initData.endTime;var i=this._initData.endTime-e;86400<i?(this.lab_cd.changeText(n.DateUtil.remainingDHStr(i)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=i?(this.lab_cd.changeText(n.DateUtil.getHMS_countdown(i)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_cd.changeText("00:00:00")}this.lab_cd.visible=this.lab_start_lab.visible=t},t}(ui.crossserver.CSAthleticsPageUI);e.CSAthleticsPage=r}),define("src/g/crossserboss/ctrl/CSAthleticsPageCtrl",["require","exports","src/g/crossserboss/view/CSAthleticsPage","../../../manager/GameSocketManager","../../net/messages/kuafu/KfjjcMsg","src/g/crossserboss/csathletics/ctrl/CSAthleticsData","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.prototype.init=function(){},t.prototype.showPage=function(t,e){t&&(t.removeChildren(),this._view||(this._view=new i.CSAthleticsPage,this._view.setData(o.CSAthleticsData.ins)),t.addChild(this._view),a.ClearResM.resetViewImg(this._view),n.GSM.sendServer(new s.KfjjcOpenStateC2GS))},t.prototype.loadUrls=function(){},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){},t.prototype.getTitle=function(){return"res/csboss/kfjj_biaotizi_001.png"},t.prototype.hidePage=function(){},t.prototype.destroyPage=function(){this._view.destroy(),this._view=null},t}();e.CSAthleticsPageCtrl=r}),define("src/g/crossserboss/ctrl/CSerBossMainViewCtrl",["require","exports","../../../manager/LayerManager","src/g/crossserboss/ctrl/CSerBossListCtrl","../../../utils/SoundUtils","src/g/crossserboss/ctrl/KFRXCtrl","src/g/crossserboss/ctrl/CSerBossMingRenCtrl","src/g/proxy/MultiLevelUIProxy","src/g/kftb/ctrl/KFTBCtrl","src/g/clearRes/ClearResM","src/g/kfsd/ctrl/KFSDCtrl","src/g/crossserboss/ctrl/CSAthleticsPageCtrl","src/init/Switches"],function(t,e,n,s,i,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(){this._pro=new r.MultiLevelUIProxy,this.bossListCtrl=new s.CSerBossListCtrl,p.Switches.ins.on(199,this,this.onOpenHandler,[231]),p.Switches.ins.on(200,this,this.onOpenHandler,[200]),p.Switches.ins.on(215,this,this.onOpenHandler,[215]),p.Switches.ins.on(216,this,this.onOpenHandler,[216]),p.Switches.ins.on(242,this,this.onOpenHandler,[242])}return t.prototype.onOpenHandler=function(t,e){if(e){var i=this.view;null==i&&(this.view=i=new ui.crossserver.CSerBossMainViewUI,i.bgview.btn_close.on(Laya.Event.CLICK,this,this.closeHander,[!0]),i.bgview.btn_back.on(Laya.Event.CLICK,this,this.closeHander,[!0]),this._pro.registerTab(i.tab,0),this._pro.registerTagIndex(199,1),this._pro.registerTagIndex(200,1),this._pro.registerTagIndex(215,2),this._pro.registerTagIndex(242,3),this._pro.registerTagIndex(216,0),this._pro.selectHandler=new Laya.Handler(this,this.tab_selectHandler)),this._pro.open(t),n.LayerManager.addInPOPWindowLayer(i),h.ClearResM.resetViewImg(i.tab)}},t.prototype.tab_selectHandler=function(t){if(void 0===t&&(t=0),!(t<0)){var e=this.view;e.tab.items[t]&&(e.select_img.x=e.tab.items[t].x,e.select_img.y=e.tab.items[t].y),this.crtSubCtrl&&this.crtSubCtrl.hidePage();var i=e.bgview.box_page;switch(i.removeChildren(),t){case 1:this.bossListCtrl||(this.bossListCtrl=new s.CSerBossListCtrl),this.crtSubCtrl=this.bossListCtrl;break;case 4:this._kftbCtrl||(this._kftbCtrl=new l.KFTBCtrl),this.crtSubCtrl=this._kftbCtrl;break;case 2:this.kfrxctrl||(this.kfrxctrl=new o.KFRXCtrl),this.crtSubCtrl=this.kfrxctrl;break;case 0:this.kfmrctrl||(this.kfmrctrl=new a.CSerBossMingRenCtrl),this.crtSubCtrl=this.kfmrctrl;break;case 5:this.kfsdctrl||(this.kfsdctrl=new c.KFSDCtrl),this.crtSubCtrl=this.kfsdctrl;break;case 3:this.cs_athletics_ctrl||(this.cs_athletics_ctrl=new u.CSAthleticsPageCtrl),this.crtSubCtrl=this.cs_athletics_ctrl}this.crtSubCtrl.showPage(i),e.bgview.img_title.skin=this.crtSubCtrl.getTitle()}},t.prototype.closeHander=function(t){t&&i.SoundUtils.getInstance().playBtnsounds(),this.view.off(Laya.Event.REMOVED,this,this.closeHander),this.crtSubCtrl=null,this.view&&this.view.removeSelf(),h.ClearResM.clearResFolder("kft"),h.ClearResM.clearResFolder("kfsd")},t}();e.CSerBossMainViewCtrl=d}),define("src/g/role_other/view/role/OtherEquipPage",["require","exports","../../../net/messages/rank/sbkOtherData","src/g/clearRes/ClearResM","src/g/custom/detailDlgs/Details_Equip","../../../../utils/ItemUtils","../../../../meta/QualiyVo","src/g/Effects/UIEffectsFactory","../../../../enum/enumItem","../../../../enum/EventName","../../../../core/E","../../../../meta/CommonVo","src/init/TextConst","../../../../utils/RoleUtil"],function(t,e,s,i,d,g,v,f,h,c,u,p,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t._hidx=0,t}return __extends(t,e),t.prototype.showData=function(t,e){this.p_heroData=t,i.ClearResM.resetViewImg(this),this.initShow(t,e)},t.prototype.initShow=function(t,e){t||(t=new s.sbkOtherData),this._hidx=e;var i=(this.p_heroData=t).familyName;this.box_gh.visible=!!i&&(this.lab_ghName.text=i,!0);var n=t.openhero[e];n&&(this.view_fightNum.setFightNum(n.combat),this.initEquip(n.equpos)),this.refreshAni(e),this.initDragon(e),this.initHideBtn(),this.initRing()},t.prototype.initHideBtn=function(){this.btn_showAttr.visible=!1,this.btn_dress.visible=!1,this.btn_ss.visible=!1,this.btn_chengzhuang.disabled=!0,this.btn_shenbing.disabled=!1,this.btn_rexue.disabled=!1,this.btn_govern.disabled=!1,this.btn_shenzhu.disabled=!0,this.red_chengzhuang.removeSelf(),this.red_godCast.removeSelf(),this.red_govern.removeSelf(),this.img_red_dress.removeSelf(),this.red_rexue.removeSelf(),this.red_shenbing.removeSelf(),this.btn_putOn.removeSelf(),this.btn_shenbing.removeChildren(),this.btn_rough.removeSelf()},t.prototype.initEquip=function(t){for(var e=0;e<t.length;e++){var i=t[e],n=i.equpos-1,s=this.getChildByName("equip_"+ktgame.RoleDefineMod.arr_equipPosConst[n]);s.setClieckHD(null);var o=i.equins.equtemplet,a=0<o;if(a){var r=new Laya.Handler(this,function(t){var e=new d.Details_Equip;e.initData(t),e.popup()},[i]);s.setClieckHD(r)}var l=g.ItemUtils.getEquipVoById(o),h=v.QualityStruct.Ins.transEquipQuality(l);0==h&&(h=1),l||(a=!1);var c=a?g.ItemUtils.getIconById(l.id):"res/custom/equipIcon/equip_"+ktgame.RoleDefineMod.arr_equipPosConst[n]+".png";s.setName(a?g.ItemUtils.getEquipLv(l.limit):""),s.setTrait(h,v.QualityStruct.Ins.getQPicById(h));var u=v.QualityStruct.Ins.getQEffByEquip(i);if(0<u){var p=s.qualAni.getChildByName("ani_"+u);p||(s.qualAni.removeChildren(),(p=f.UIEffectsFactory.Ins.createUIAniById(u,!0)).name="ani_"+u,f.UIEffectsFactory.Ins.centered4Parent(p,s.qualAni,!0),p.play())}else s.qualAni.removeChildren();s.setEnhance(a?i.stronglv:0),s.setSoul(a?i.soullv:0),s.showGod(!!a&&0<i.shenzhulv),s.showTip(!1),s.showIcon(c)}},t.prototype.refreshAni=function(t){o.RoleUtil.refreshZww(this.p_heroData.openhero[t],100,this.ani_wing,this.ani_weapon,this.ani_role,this.ani_fumo)},t.prototype.initRing=function(){for(var o,a=this,r=[n.TextConst.get(139),n.TextConst.get(140)],t=function(t){var e=l.getChildByName("ring_"+ktgame.RoleDefineMod.arr_ringPosConst[t]);e.setName(r[t]),e.lab_enhance.x=50,e.lab_enhance.y=72;var i=t;o=new Laya.Handler(l,function(t){u.E.ins.event(c.EventName.OTHERSHOW_RING,[i,a._hidx,a.p_heroData])},[e.name]),e.setClieckHD(o);var n=0==t?l.p_heroData.openhero[l._hidx].ring1Id:l.p_heroData.openhero[l._hidx].ring2Id;e.setEnhance(n),e.setTrait(h.enumItem.orange,v.QualityStruct.Ins.getQPicById(h.enumItem.orange)),e.setSoul(),e.showGod(!1),e.showTip(!1);var s=n<=0?"_gray":"";e.img_tip.visible=!1,e.showIcon("res/custom/equipIcon/ring_"+ktgame.RoleDefineMod.arr_ringPosConst[t]+s+".png"),n<=0?(e.setTrait(h.enumItem.gray,v.QualityStruct.Ins.getQPicById(h.enumItem.gray)),e.sp.removeChildren(),e.img_item.visible=!0):(e.img_item.visible=!1,0==e.sp.numChildren&&f.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(e.sp,49+t,.3,.3),e.setTrait(h.enumItem.orange,v.QualityStruct.Ins.getQPicById(h.enumItem.orange))),e.lab_ItemName.color="#dcc026",e.img_bg.skin=g.ItemUtils.getQualitybjByQualityId(p.CommonVo.getVoByKey("qulity_mabi").val2num)},l=this,e=0;e<2;e++)t(e)},t.prototype.initDragon=function(t){for(var e=0;e<2;e++){this.getChildByName("dragon_"+ktgame.RoleDefineMod.arr_dragonPosConst[e]).visible=!1}},t}(ui.role.Equip.EquipViewUI);e.OtherEquipPage=a}),define("src/g/role_other/ctrl/role/OtherEquipPageCtrl",["require","exports","src/g/role_other/view/role/OtherEquipPage","src/init/ResManager","../../../../core/E","../../../../enum/EventName","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this._nowSelectHero=0}return t.prototype.init=function(){return this._view||(this._view=new i.OtherEquipPage),this.initAllCtrlEv(),this},t.prototype.initAllCtrlEv=function(){this._view.btn_govern.on(Laya.Event.CLICK,this,this.onGovernClick),this._view.btn_rexue.on(Laya.Event.CLICK,this,this.onReXueClick),this._view.btn_shenbing.on(Laya.Event.CLICK,this,this.onShenBingClick)},t.prototype.onGovernClick=function(){s.E.ins.event(o.EventName.OTHERSHOW_GOVERN,[0,0,this._other])},t.prototype.onReXueClick=function(){s.E.ins.event(o.EventName.OTHERSHOW_REXUE,[this._other])},t.prototype.onShenBingClick=function(){s.E.ins.event(o.EventName.OTHERSHOW_SHENBING,[this._other])},t.prototype.showPage=function(t,e){this._view||this.init(),this._other=e,this._parent=t,this._parent.removeChildren(),this.refreshData(e),a.ClearResM.resetViewImg(this._view),this._parent.addChild(this._view),n.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t,e){this._nowSelectHero=t,this.refreshData(e)},t.prototype.refreshData=function(t){t&&t.heronum<this._nowSelectHero+1&&(this._nowSelectHero=0),this._view.showData(t,this._nowSelectHero)},t.prototype.getTitle=function(){return"res/role/roletitle.png"},t.prototype.hidePage=function(){n.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){n.ResManager.getInstance().destroyPageCtrl(this)},t}();e.OtherEquipPageCtrl=r}),define("src/g/role_other/view/GOtherRoleDlg",["require","exports","../../../manager/LayerManager"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){for(var t=n.call(this)||this,e=0;e<4;e++){var i=t.tab_pageBtn.getChildByName("item"+e);1<e&&i.removeSelf(),t.red_equip.removeSelf(),t.red_jingmai.removeSelf()}return t}return __extends(t,n),t.prototype.init=function(){},t.prototype.showView=function(){i.LayerManager.addInPOPWindowLayer(this)},t.prototype.hideView=function(){this.removeSelf()},t.prototype.destroyView=function(){},t}(ui.role.Page_RoleBgUI);e.GOtherRoleDlg=n}),define("src/g/role_other/view/role/OtherArtifactsView",["require","exports","src/g/clearRes/ClearResM","src/g/Effects/UIEffectsFactory","../../../../config/GameConfig","../../../../meta/QualiyVo","../../../../utils/ItemUtils","../../../net/messages/sbkFormula","src/init/TextConst","src/g/artifacts/view/ArtifactsSkillTip","../../../net/messages/PropFightMain","../../../../plugin/sbkPropTool"],function(t,e,i,r,f,l,y,g,h,n,v,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(s){function t(t){var e=s.call(this)||this;return e.nameUrlArr=["wenzi_wuqi","wenzi_xiongjia","wenzi_shouzhuo","wenzi_jiezhi","wenzi_toukui","wenzi_xianglian","wenzi_yaodai","wenzi_huxue"],e._data=t,i.ClearResM.addBgUrl(e.bgimg.skin),e}return __extends(t,s),t.prototype.init=function(){this.aniArr=[];for(var t=["wenzi_xing","wenzi_yue","wenzi_sheng"],e=1;e<=8;e++){var i=r.UIEffectsFactory.Ins.createSAniById(90+e);this.aniArr.push(i);var n=f.GameConfig.artifactsJSON[e],s=this.item_con.getChildByName("item"+e);if(s){s.img_red.visible=!1;var o=this.uvo.artifactsData.artifacesLvArr[e-1],a="17"+e;0<o?(s.txt_lv.text=h.TextConst.get(7,o),s.txt_lv.visible=!0,r.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(s.ani_con,l.QualityStruct.Ins.getQEffById(5)),s.img_bg.skin=y.ItemUtils.getQualitybjByQualityId(5)):(s.txt_lv.visible=!1,a+="_hui"),s.img_item.skin="res/artifacts/"+a+".png",s.img_select.visible=!1,s.img_type.skin="res/artifacts/"+t[n.xType-1]+".png",s.on(Laya.Event.CLICK,this,this.selectItem,[e])}}this.selectItem(1)},t.prototype.updateFightNum=function(t){var e=0,i=0,n=0,s=0,o=this.uvo.artifactsData.artifacesLvArr[t-1],a=0;if(0<o){var r=this._data.getArtifactsLevelVo(t,o);if(r){a=r.power;for(var l=r.prop2.length,h=0;h<l;){var c=r.prop2[h];"HP"==c[0]?e+=c[1]:"ATT"==c[0]?i+=c[1]:"PDEF"==c[0]?n+=c[1]:"SDEF"==c[0]&&(s+=c[1]),h++}}}var u=new v.PropYcSkill,p=m.sbkPropTool.calChuanShiProp(this.uvo.artifactsData,u),d=g.sbkFormula.calCombat(0,0,0,0,0,u.STRONG,u.STRONGHURT,0,0,0,0,0,0,0,0,u.FIXEDATT,0,0,0,0,0,0,0,0,0,0,0,0,0);d+=g.sbkFormula.calEquipCombat(e,i,n,s)*this.uvo.heronum+a,d+=p,this.fight_num_bar.num_Fight.value=d+""},Object.defineProperty(t.prototype,"currSelectId",{get:function(){return this._currSelectId},enumerable:!0,configurable:!0}),t.prototype.selectItem=function(t){this._currSelectId=t,this._currSelectItem&&(this._currSelectItem.img_select.visible=!1,this._currSelectItem=null),this._currSelectItem=this.item_con.getChildByName("item"+t),this._currSelectItem&&(this._currSelectItem.img_select.visible=!0),this.showItem(t)},t.prototype.showItem=function(t){this.switchAni(t),this.switchProp(t)},t.prototype.switchAni=function(t){f.GameConfig.artifactsJSON[t];this._currItemAni&&(this.ani_con.removeChild(this._currItemAni),this._currItemAni.stop()),this._currItemAni=this.aniArr[t-1],this._currItemAni&&(this.ani_con.addChild(this._currItemAni),this._currItemAni.play())},t.prototype.switchProp=function(t){var e=f.GameConfig.artifactsJSON[t];this.txt_des.text=e.des?e.des:"",this.img_curr_name.skin="res/artifacts/"+this.nameUrlArr[t-1]+".png";var i=this.uvo.artifactsData.artifacesLvArr[t-1];this._data.getMaxLevelByType(t),this._data.getArtifactsLevelVo(t,i);this.item_cost.visible=!1,this.btn_ok.visible=!1,this.showCurrLvProp(t,i),this.showNextLvProp(t,i),this.updateFightNum(t)},t.prototype.showCurrLvProp=function(t,e){if(0<e){var i=this._data.getArtifactsLevelVo(t,e);if(i){for(var n=i.prop2.length,s=0;s<n;){var o=i.prop2[s];"HP"==o[0]?this.txt_HP.text=o[1]:"ATT"==o[0]?this.txt_ATT.text=o[1]:"PDEF"==o[0]?this.txt_PDEF.text=o[1]:"SDEF"==o[0]&&(this.txt_SDEF.text=o[1]),s++}return}}this.txt_HP.text="0",this.txt_ATT.text="0",this.txt_PDEF.text="0",this.txt_SDEF.text="0"},t.prototype.showNextLvProp=function(t,e){if(e<this._data.getMaxLevelByType(t)){var i=this._data.getArtifactsLevelVo(t,e+1);if(i){for(var n=i.prop2.length,s=0;s<n;){var o=i.prop2[s];"HP"==o[0]?this.txt_next_HP.text=o[1]:"ATT"==o[0]?this.txt_next_ATT.text=o[1]:"PDEF"==o[0]?this.txt_next_PDEF.text=o[1]:"SDEF"==o[0]&&(this.txt_next_SDEF.text=o[1]),s++}return}}this.txt_next_HP.text="0",this.txt_next_ATT.text="0",this.txt_next_PDEF.text="0",this.txt_next_SDEF.text="0"},t.prototype.updateSkill=function(){var t,e,i,n=0,s=9999,o=9999,a=9999,r=0;for(var l in f.GameConfig.artifactsJSON)t=f.GameConfig.artifactsJSON[l],0<(r=this.uvo.artifactsData.artifacesLvArr[t.id-1])&&n++,1==t.xType?s=Math.min(r,s):2==t.xType&&(o=Math.min(r,o)),3==t.xType&&(a=Math.min(r,a));var h,c,u,p=0,d=0,g=0,v=0;for(var l in f.GameConfig.skillOpen)(e=f.GameConfig.skillOpen[l])&&(5==e.type?(this["lab_buff"+p]&&(this["lab_buff"+p].color=n<e.level?"#c0b4a3":"#2ba212",i=y.ItemUtils.getSkillDefItem(e.skillId),this["lab_buff"+p].changeText(e.level+"件套装： "+i.desc)),p++):6==e.type?(0==d||s>=e.level)&&(d=e.level,h=e):7==e.type?(0==g||o>=e.level)&&(g=e.level,c=e):8==e.type&&(0==v||a>=e.level)&&(v=e.level,u=e));i=y.ItemUtils.getSkillDefItem(h.skillId),this.skill_icon0.skin=y.ItemUtils.getSkillIconByIconId(i.icon),this.skill_icon0.gray=s<d,this.lab_skill_lv0.color=this.lab_skill_name0.color=s<d?"#c0b4a3":"#2ba212",this.lab_skill_lv0.changeText("星套等级"+d),this.lab_skill_name0.changeText(i.name),this.skill_icon0.offAll(),this.skill_icon0.on(Laya.Event.CLICK,this,this.showSkillTip,[h,s]),i=y.ItemUtils.getSkillDefItem(c.skillId),this.skill_icon1.skin=y.ItemUtils.getSkillIconByIconId(i.icon),this.skill_icon1.gray=o<g,this.lab_skill_lv1.color=this.lab_skill_name1.color=o<g?"#c0b4a3":"#2ba212",this.lab_skill_lv1.changeText("月套等级"+g),this.lab_skill_name1.changeText(i.name),this.skill_icon1.offAll(),this.skill_icon1.on(Laya.Event.CLICK,this,this.showSkillTip,[c,o]),i=y.ItemUtils.getSkillDefItem(u.skillId),this.skill_icon2.skin=y.ItemUtils.getSkillIconByIconId(i.icon),this.skill_icon2.gray=a<v,this.lab_skill_lv2.color=this.lab_skill_name2.color=a<v?"#c0b4a3":"#2ba212",this.lab_skill_lv2.changeText("圣套等级"+v),this.lab_skill_name2.changeText(i.name),this.skill_icon2.offAll(),this.skill_icon2.on(Laya.Event.CLICK,this,this.showSkillTip,[u,a])},t.prototype.showSkillTip=function(t,e){var i=new n.ArtifactsSkillTip;i.initData(t,e),i.popup()},t.prototype.showView=function(t){this.uvo=t,this.bgimg.restskin(),this.init(),this._currItemAni&&this._currItemAni.play();for(var e=1;e<=8;e++){var i=this.item_con.getChildByName("item"+e);if(i){var n=i.ani_con.getChildAt(0);n&&n.play()}}var s=this.getPrioritySelectindex();-1!=s&&this.selectItem(s),this.updateSkill()},t.prototype.getPrioritySelectindex=function(){for(var t=this._data.redPromptState,e=1;e<=8;e++)if(1==(t>>e-1&1))return e;return-1},t.prototype.closePanel=function(){this.removeSelf(),this._currItemAni&&this._currItemAni.stop();for(var t=0;t<this.aniArr.length;t++)Laya.loader.clearRes(this.aniArr[t].source);for(var e=1;e<=8;e++){var i=this.item_con.getChildByName("item"+e);if(i){var n=i.ani_con.getChildAt(0);n&&n.stop()}}},t.prototype.destroy=function(){for(var t in this._data=null,this.item_cost.setJump("",null),this.btn_ok.offAll(),this.aniArr)this.aniArr[t].clear();this.aniArr.length=0,s.prototype.destroy.call(this);for(var e=1;e<=8;e++){r.UIEffectsFactory.Ins.clearAniRes(90+e);var i="17"+e;Laya.loader.clearRes("res/artifacts/"+i+".png"),Laya.loader.clearRes("res/artifacts/"+i+"_hui.png")}for(var n in Laya.loader.clearRes("res/artifacts/wenzi_xing.png"),Laya.loader.clearRes("res/artifacts/wenzi_yue.png"),Laya.loader.clearRes("res/artifacts/wenzi_sheng.png"),r.UIEffectsFactory.Ins.clearAniRes(34),this.nameUrlArr)Laya.loader.clearRes("res/artifacts/"+this.nameUrlArr[n]+".png");this.nameUrlArr.length=0},t}(ui.artifacts.ArtifactsViewUI);e.OtherArtifactsView=s}),define("src/g/role_other/ctrl/role/OtherArtifactsCtrl",["require","exports","src/g/artifacts/ctrl/ArtifactsData","src/g/role_other/view/role/OtherArtifactsView","src/init/ResManager","../../../../runtime/resload/GameResLoad"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){this.url="res/atlas/res/artifacts.json"}return t.prototype.init=function(){this._viewData=new i.ArtifactsData,this._viewData.init()},t.prototype.openPanel=function(){this._view||(this.init(),o.GameResLoad.load(this.url),this._view=new n.OtherArtifactsView(this._viewData),this._view.on(Laya.Event.REMOVED,this,this.closePanel)),this._view.showView(this.uvo)},t.prototype.showPage=function(t,e){this.uvo=e,this._parent=t,this._parent.removeChildren(),this.openPanel(),this._parent.addChild(this._view),s.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.closePanel=function(){this._view&&(this._view.removeSelf(),this._view.destroy(),this._view=null),Laya.loader.clearRes(this.url)},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){},t.prototype.getTitle=function(){return"res/role/biaoti_chuanshi.png"},t.prototype.hidePage=function(){s.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){s.ResManager.getInstance().destroyPageCtrl(this)},t}();e.OtherArtifactsViewCtrl=a}),define("src/g/role_other/view/subrole/OtherRingView",["require","exports","../../../../utils/ItemUtils","../../../net/messages/sbkFormula","src/g/roleSubJoin/view/RingView","src/init/TextConst"],function(t,e,a,r,i,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.btn_Up.visible=!1,t.item_cost.visible=!1,t}return __extends(t,e),t.prototype.addEvent=function(){},t.prototype.refreshData=function(t,e,i){this.uvo=i,this._selectType=e,this.p_hero=this.uvo.openhero[t],this.refreshIcon(),this.refreshAttr()},t.prototype.refreshAttr=function(){var t=0,e="";if(0==this._selectType){t=this.p_hero.ring1Id,e=l.TextConst.get(961);var i=a.ItemUtils.getRing1VoById(t);this.box_fight.setFightNum(i.power||0),this.lab_lv.text=0==t?l.TextConst.get(485).split("").join("\n"):l.TextConst.get(17,t);for(var n=0;n<i.prop.length;n++){var s="%"==(o=a.ItemUtils.getShuXingByName(i.prop[n][0])).unit?i.prop[n][1]/r.sbkFormula.BASEPERCENTAGE:i.prop[n][1];this["lab_now_"+n].text=o.desc+":",this["lab_nownum_"+n].text=s+(o.unit||"")}for(n=0;n<5;n++)i.prop[n]?(this["lab_now_"+n].visible=!0,this["lab_nownum_"+n].visible=!0):(this["lab_now_"+n].visible=!1,this["lab_nownum_"+n].visible=!1);this.box_next.visible=!1}else if(1==this._selectType){t=this.p_hero.ring2Id,e=l.TextConst.get(960);i=a.ItemUtils.getRing2VoById(t);this.box_fight.setFightNum(i.power||0),this.lab_lv.text=0==t?l.TextConst.get(485).split("").join("\n"):l.TextConst.get(17,t);for(n=0;n<i.prop.length;n++){s="%"==(o=a.ItemUtils.getShuXingByName(i.prop[n][0])).unit?i.prop[n][1]/r.sbkFormula.BASEPERCENTAGE:i.prop[n][1];this["lab_now_"+n].text=o.desc+":",this["lab_nownum_"+n].text=s+(o.unit||"")}for(n=0;n<5;n++)i.prop[n]?(this["lab_now_"+n].visible=!0,this["lab_nownum_"+n].visible=!0):(this["lab_now_"+n].visible=!1,this["lab_nownum_"+n].visible=!1);this.box_next.visible=!1}else if(2==this._selectType){t=this.p_hero.ring3Id,e=l.TextConst.get(1066);i=a.ItemUtils.getRing3VoById(t);this.box_fight.setFightNum(i.getTotalPower()||0),this.lab_lv.text=0==t?l.TextConst.get(485).split("").join("\n"):l.TextConst.get(17,t);for(n=0;n<i.prop.length;n++){s="%"==(o=a.ItemUtils.getShuXingByName(i.prop[n][0])).unit?i.prop[n][1]/r.sbkFormula.BASEPERCENTAGE:i.prop[n][1];this["lab_now_"+n].text=o.desc+":",this["lab_nownum_"+n].text=s+(o.unit||"")}for(n=0;n<5;n++)i.prop[n]?(this["lab_now_"+n].visible=!0,this["lab_nownum_"+n].visible=!0):(this["lab_now_"+n].visible=!1,this["lab_nownum_"+n].visible=!1);this.box_next.visible=!1}else if(3==this._selectType){t=this.p_hero.ring4Id,e=l.TextConst.get(1065);i=a.ItemUtils.getRing4VoById(t);this.box_fight.setFightNum(i.getTotalPower()||0),this.lab_lv.text=0==t?l.TextConst.get(485).split("").join("\n"):l.TextConst.get(17,t);for(n=0;n<i.prop.length;n++){var o;s="%"==(o=a.ItemUtils.getShuXingByName(i.prop[n][0])).unit?i.prop[n][1]/r.sbkFormula.BASEPERCENTAGE:i.prop[n][1];this["lab_now_"+n].text=o.desc+":",this["lab_nownum_"+n].text=s+(o.unit||"")}for(n=0;n<5;n++)i.prop[n]?(this["lab_now_"+n].visible=!0,this["lab_nownum_"+n].visible=!0):(this["lab_now_"+n].visible=!1,this["lab_nownum_"+n].visible=!1);this.box_next.visible=!1}this.lab_desc.text=e},t}(i.RingView);e.OtherRingView=n}),define("src/g/role_other/ctrl/subrole/OtherRingViewCtrl",["require","exports","src/g/base/BaseCtrl","src/g/role_other/view/subrole/OtherRingView","src/g/roleSubJoin/view/SubJoinDlg","../../../../core/E","../../../../enum/EventName","src/g/proxy/MultiLevelUIProxy","src/g/clearRes/ClearResM","../../../../manager/LayerManager","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t._nowSelectHero=0,t._selectType=0,t.urls=["res/atlas/res/roleSubjoin.json"],o.E.ins.on(a.EventName.OTHERSHOW_RING,t,t.fromPanel),t}return __extends(t,e),t.prototype.fromPanel=function(t,e,i){this.uvo=i,0==t?this.showView(49,e):1==t&&this.showView(50,e)},t.prototype.init=function(){return this._view||(this._view=new n.OtherRingView,this._viewdlg=new s.SubJoinDlg,this._viewdlg.initTabName([c.TextConst.get(145),c.TextConst.get(146)],[]),this._viewdlg.addPage(this._view),this._tadProxy=new r.MultiLevelUIProxy,this._tadProxy.registerTab(this._viewdlg.tab_pageBtn,0),this._tadProxy.registerTagIndex(49,0),this._tadProxy.registerTagIndex(50,1),this._tadProxy.selectHandler=new Laya.Handler(this,this.pageSelectHander),this._viewdlg.red_0.removeSelf(),this._viewdlg.red_1.removeSelf()),this.addEvent(),this.refreshHeadShow(),this},t.prototype.addEvent=function(){this._viewdlg.bgView.btn_back.on(Laya.Event.CLICK,this,this.closeView),this._viewdlg.bgView.btn_close.on(Laya.Event.CLICK,this,this.closeView),this._viewdlg.tab_head.setCallbackHandler(new Laya.Handler(this,this.p_changePerson))},t.prototype.refreshHeadShow=function(){this._viewdlg.tab_head.initData(this.uvo.openhero,this._nowSelectHero,!1)},t.prototype.p_changePerson=function(t){this.uvo.openhero[t]&&(this._nowSelectHero=t,this._viewdlg.tab_head.setSelectIndex(t),this.showTitle(),this._view.refreshData(t,this._selectType,this.uvo))},t.prototype.refreshData=function(){this._view&&this._view.refreshData(this._nowSelectHero,this._selectType,this.uvo)},t.prototype.changePerson=function(t,e){this._nowSelectHero=t,this._view&&this.p_changePerson(t)},t.prototype.pageSelectHander=function(t){this._viewdlg.tab_pageBtn.items[t]&&(this._viewdlg.select_img.x=this._viewdlg.tab_pageBtn.items[t].x,this._viewdlg.select_img.y=this._viewdlg.tab_pageBtn.items[t].y),this.p_changePerson(this._nowSelectHero),this._selectType=t,this.showTitle(),this._view.refreshData(this._nowSelectHero,this._selectType,this.uvo),l.ClearResM.resetViewImg(this._view)},t.prototype.showView=function(t,e){this._typ=t,this._hidx=e,this.opens()},t.prototype.onAtlasLoaded=function(){this.realOpenRoleView()},t.prototype.realOpenRoleView=function(){this._nowSelectHero=this._hidx,49==this._typ?this._selectType=0:50==this._typ?this._selectType=1:246==this._typ?this._selectType=3:247==this._typ?this._selectType=2:269==this._typ&&(this._selectType=4),this._view||this.init(),this.refreshHeadShow(),this._tadProxy.open(this._typ),this._view.refreshData(this._nowSelectHero,this._selectType,this.uvo),h.LayerManager.addInPOPWindowLayer(this._viewdlg,!1)},t.prototype.showTitle=function(){this._viewdlg.bgView.img_title.skin="res/roleSubjoin/ring_"+this._selectType+".png"},t.prototype.closeView=function(){this._viewdlg.hideView(),o.E.ins.event(a.EventName.CLOSEVIEW_RING)},t}(i.BaseCtrl);e.OtherRingViewCtrl=u}),define("src/g/role_other/view/govern/OtherGovernPage",["require","exports","src/g/Effects/UIEffectsFactory","../../../../utils/ItemUtils","../../../../meta/ShuXingVo","../../../net/messages/PropFightMain","../../../net/messages/sbkFormula","../../../../core/E","../../../../enum/EventName","../../../../plugin/sbkPropTool","src/g/role/vo/GovernStruct","src/init/TextConst"],function(t,e,c,u,p,d,g,i,n,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.isUpLv=!0,t.nSPos=0,t.nHeroIdx=0,t.hvo=null,t.uvo=null,t.isLvMax=!1,t.canUp=!1,t.isOpen=!1,t.limitOk=!1,t.arr_lv=[],t.arr_open=[],t.addEvent(),t.item_cost.visible=!1,t}return __extends(t,e),t.prototype.addEvent=function(){this.item_0.on(Laya.Event.CLICK,this,this.changeSelect,[0]),this.item_1.on(Laya.Event.CLICK,this,this.changeSelect,[1]),this.item_2.on(Laya.Event.CLICK,this,this.changeSelect,[2]),this.item_3.on(Laya.Event.CLICK,this,this.changeSelect,[3]),this.list_star.renderHandler=new Laya.Handler(this,this.starRender),this.box_upLv.visible=!1,this.btn_up.visible=!1},t.prototype.starRender=function(t,e){t.skin="res/role/govern/xing"+(t.dataSource?"":"0")+".png"},t.prototype.changeHero=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=-1),this.uvo=i,this.hvo=this.uvo.openhero[t],this.nHeroIdx=t,this.arr_lv=this.hvo.zhuzai.lvArr,this.arr_open=this.hvo.zhuzai.activationArr,this.refreshData(e)},t.prototype.changePageType=function(t){this.isUpLv=t,this.refreshData()},t.prototype.refreshData=function(t){void 0===t&&(t=-1),-1<t&&(this.nSPos=t),this.renderBase(),this.refreshAttr()},t.prototype.refreshAttr=function(){this.list_star.visible=!this.isUpLv;var t,e=f.GovernStruct.Ins.getGovernVo(this.nSPos+1,this.arr_lv[this.nSPos]);t=u.ItemUtils.getItemVoById(parseInt(e.activationcost[0][0]));var i=this.aniSp_equip.getChildByName(t.id+"");i||(this.aniSp_equip.removeChildren(),(i=c.UIEffectsFactory.Ins.createUIAniById(t.id,!0)).name=t.id+"",c.UIEffectsFactory.Ins.centered4Parent(i,this.aniSp_equip,!0));var n=f.GovernStruct.Ins.getGovernVo(this.nSPos+1,this.arr_lv[this.nSPos]),s=new d.PropZhuZai;this.attrBox.removeChildren();for(var o=0;o<n.prop.length;o++){var a=new Laya.Image("res/role/govern/zhuzaitaozhuang_shuxingdi.png");a.width=200;var r=p.ShuXingVo.createSXBox(n.prop[o][0],n.prop[o][1]);r.x=(a.width-r.width)/2,r.y=(a.height-r.height)/2,a.addChild(r),this.attrBox.addChild(a)}if(v.sbkPropTool.reSetProp(s,n.prop),this.box_fight.setFightNum(g.sbkFormula.calZhuZaiCombat(s)),this.isUpLv)e.limit[0]?this.lab_lv.text=u.ItemUtils.getLv(e.limit[0][1]):this.lab_lv.text=y.TextConst.get(208),this.limitOk=this.uvo.getCurLv()>=e.limit[0][1],this.lab_oknum.text=Math.floor(e.probability/100)+"%";else{this.limitOk=!0;var l=Math.floor(e.level/1e4),h=[];for(o=1;o<=5;o++)h.push(o<=l);this.list_star.dataSource=h}},t.prototype.changeSelect=function(t){this.nSPos=t;for(var e=0;e<4;e++)this["item_"+e].img_select.visible=e==this.nSPos;i.E.ins.event(n.EventName.GOVERN_CHANGEITEMIDX,[this.nSPos]),this.refreshData()},t.prototype.renderBase=function(){for(var t,e=[y.TextConst.get(141),y.TextConst.get(142),y.TextConst.get(143),y.TextConst.get(144)],i=0;i<4;i++){if(t=this["item_"+i],this.arr_open[i]<=0)t.lab_lv.text=y.TextConst.get(485),t.ani_qual.removeChildren();else{t.lab_lv.text="LV."+this.arr_lv[i]%1e3;var n=t.ani_qual.getChildByName("ani");n||((n=c.UIEffectsFactory.Ins.createUIAniById(83,!0)).name="ani",c.UIEffectsFactory.Ins.centered4Parent(n,t.ani_qual,!0))}t.lab_name.text=e[i];var s=0<this.arr_open[i];t.img_icon.skin="res/custom/equipIcon/suit_"+ktgame.RoleDefineMod.arr_suitPosConst[i]+".png",t.img_icon.gray=!s,t.img_red.visible=!1}},t.prototype.stopAni=function(t){var e=this.ani_up.getChildByName(t);e&&(e.stop(),e.visible=!1,e.index=0)},t}(ui.role.Govern.Page.GovernPageUI);e.OtherGovernPageN=s}),define("src/g/role_other/ctrl/govern/OtherGovernPageCtrl",["require","exports","../../../../core/E","../../../../enum/EventName","src/init/ResManager","src/g/role_other/view/govern/OtherGovernPage","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this.nSPos=0}return t.prototype.init=function(){this._view||(this._view=new o.OtherGovernPageN,i.E.ins.on(n.EventName.GOVERN_CHANGEITEMIDX,this,this.onChangeIdx))},t.prototype.onChangeIdx=function(t){this.nSPos=t},t.prototype.changeType=function(t){void 0===t&&(t=!1),this._view&&this._view.changePageType(t)},t.prototype.showPage=function(t,e){this.uvo=e,t.removeChildren(),this.init(),this.nSPos=0,this.refreshData(),a.ClearResM.resetViewImg(this._view),t.addChild(this._view),s.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t,e){this.uvo=e,this.init(),this._view.changeHero(t,this.nSPos,this.uvo),this.refreshData()},t.prototype.refreshData=function(){this._view.changeSelect(this.nSPos)},t.prototype.getTitle=function(){return"res/role/govern/wenzi_zhuzaitaozhuang.png"},t.prototype.hidePage=function(){s.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){s.ResManager.getInstance().destroyPageCtrl(this)},t}();e.OtherGovernPageNCtrl=r}),define("src/g/role_other/view/govern/OtherGovernVIew",["require","exports","src/init/TextConst"],function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(n){function t(){for(var t=n.call(this)||this,e=0;e<3;e++){var i=t.tab_page.getChildByName("item"+e);0<e?i.removeSelf():i.label=s.TextConst.get(718)}return t}return __extends(t,n),t}(ui.role.Govern.GGovernVIewUI);e.OtherGovernView=i}),define("src/g/role_other/ctrl/govern/OtherGovernCtrl",["require","exports","src/g/base/BaseCtrl","../../../../manager/LayerManager","../../../../core/E","../../../../enum/EventName","../../../../vo/RedDot/role/RedDot_Govern","../../../../vo/RedDot/EventRedDot","src/g/clearRes/ClearResM","src/g/role_other/ctrl/govern/OtherGovernPageCtrl","src/g/role_other/view/govern/OtherGovernVIew"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t._nowSelectHero=0,t._selectPos=0,t._pos=0,t._heroIdx=0,t.urls=["res/atlas/res/role/govern.json"],s.E.ins.on(o.EventName.OTHERSHOW_GOVERN,t,t.showView),t}return __extends(t,e),t.prototype.refreshData=function(){null!=this._view&&null!=this._page&&(a.RedDot_Govern.Ins.checkAll(),this._page.changePerson(this._nowSelectHero,this.uvo),s.E.ins.event(r.EventRedDot.REFRESH_EQUIP))},t.prototype.init=function(){this._view=new c.OtherGovernView,this._ngovernUp=new h.OtherGovernPageNCtrl,this._view.bgView.btn_help.visible=!1,this.addEvent()},t.prototype.addEvent=function(){this._view.tab_head.setCallbackHandler(new Laya.Handler(this,this.HeroSelect)),this._view.tab_page.selectHandler=new Laya.Handler(this,this.changePage),this._view.bgView.btn_back.on(Laya.Event.CLICK,this,this.hideView),this._view.bgView.btn_close.on(Laya.Event.CLICK,this,this.hideView),this._view.red_resolve.removeSelf(),this._view.red_upLv.removeSelf(),this._view.red_upStar.removeSelf(),s.E.ins.on(o.EventName.GOVERN_CHANGEITEMIDX,this,this.onChangeIdx)},t.prototype.onChangeIdx=function(t){this._selectPos=t},t.prototype.showView=function(t,e,i){void 0===e&&(e=0),this.uvo=i,this._pos=t,this._heroIdx=e,this.opens()},t.prototype.onAtlasLoaded=function(){this.realOpenRoleView()},t.prototype.realOpenRoleView=function(){var t=this._pos;this._selectPos=t,this._view||this.init(),this._view.tab_head.initData(this.uvo.openhero,0,!1),this.changePage(0),this._view.tab_page.selectedIndex=0,this.HeroSelect(this._heroIdx,null),this.refreshData(),n.LayerManager.addInPOPWindowLayer(this._view,!1),l.ClearResM.resetViewImg(this._view)},t.prototype.HeroSelect=function(t,e){t+1<=this.uvo.heronum&&(this._view.tab_head.setSelectIndex(t),this._nowSelectHero=t,this._ngovernUp.changePerson(t,this.uvo))},t.prototype.changePage=function(t){switch(this._view.tab_head.visible=!0,t){case 0:this._ngovernUp.changeType(!0),this._page=this._ngovernUp;break;default:return}this.refreshData(),this._view.bgView.img_title.skin=this._page.getTitle(),this._page.showPage(this._view.bgView.box_page,this.uvo),this._page.changePerson(this._nowSelectHero,this.uvo)},t.prototype.hideView=function(){this._view.bgView.box_page.removeChildren(),this._view.removeSelf(),s.E.ins.event(o.EventName.CLOSEVIEW_ZHUZAI)},t}(i.BaseCtrl);e.OtherGovernCtrl=u}),define("src/g/role_other/view/rexue/OtherReXueView",["require","exports","../../../../manager/LayerManager"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.showView=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),i.LayerManager.addInPOPWindowLayer(this,t,!0,!0,!1,e)},e.prototype.hideView=function(){this.bg_view.box_page.removeChildren(),this.removeSelf()},e.prototype.destroyView=function(){this.hideView()},e}(ui.rexue.ReXueBgUI);e.OtherReXueDlgView=n}),define("src/g/rexue/view/Tips/RxTips_or",["require","exports","../../../../manager/RoleCenter","../../../../vo/ReXueUtil","../../../../utils/ItemUtils","../../../../meta/ShuXingVo","../../../../config/GameConfig","src/init/Switches","../../../../meta/CommonVo","../../../../utils/RoleUtil","src/init/TextConst","../../../../enum/enumItem"],function(t,e,s,l,h,c,u,n,o,a,r,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(t){var e=i.call(this)||this;return e._isopen=!1,e.isOther=!1,t?(e.uvo=t,e.isOther=!0,e.btn_comp.removeSelf()):e.btn_comp.once(Laya.Event.CLICK,e,e.onBtnCompClick),e}return __extends(t,i),t.prototype.onBtnCompClick=function(){console.log("打开进阶界面"),this.close(),n.Switches.ins.event(170,[!1,!1,this._heroIdx,this._pos])},t.prototype.initData=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=-1),this._heroIdx=t,this._pos=e,this.isOther?this.rxData=this.uvo.openhero[t].rxData:this.rxData=s.RoleCenter.instans.vo.getOpenHeroByIdx(t).rxData;var n=this.rxData.curNeishiLv[e];-1!=i&&(n=i),this._isopen=0<n,0==n&&(n=1),this._suitLv=n,this.orVo=l.ReXueUtil.getOrnamentVo(e+1,n),this.btn_comp.label=this._isopen?r.TextConst.get(715):r.TextConst.get(716),this.renderTip(),this.box_fight.setFightNum(a.RoleUtil.calFightByProp(this.orVo.prop)),this.clip_score.value=this.box_fight.num_Fight.value},t.prototype.renderTip=function(){this.renderBase(),this.renderProp(),this.renderSuit()},t.prototype.renderBase=function(){this.lab_name.text=this.orVo.name,this.lab_name.color=h.ItemUtils.getColorByQuality(o.CommonVo.getVoByKey("qulity_rexuejihuo").val2num),this.lab_pos.text=r.TextConst.get(950)+p.enumItem.arr_equipPosNameNs[this._pos],this.lab_job.text=r.TextConst.get(118),this._item.setIcon("res/custom/equipIcon/rx_"+ktgame.RoleDefineMod.arr_suitPosConst[this._pos]+".png"),this._item.setUnLock(!0),this._item.setStarSmall(this.orVo.suit),this._item.setName("","",h.ItemUtils.getQualitybjByQualityId(o.CommonVo.getVoByKey("qulity_rexuejihuo").val2num))},t.prototype.renderProp=function(){for(var t=this.orVo.prop.length,e=0;e<6;e++){var i=this["attr_"+e];if(t<=e)i.removeSelf();else if(this.orVo.prop[e]){var n=this.orVo.prop[e],s=i.getChildByName("sname"),o=i.getChildByName("svalue"),a=h.ItemUtils.getShuXingByName(n[0]);s.text=a.desc+":";var r=n[1];"%"==a.unit?(r=n[1]/100,o.text=r+"%"):o.text=r+""}}},t.prototype.renderSuit=function(){var t=this.rxData.curNeishiSuitlv,e=0==t;e&&(t=1);var i=u.GameConfig.rexue_suit_neishi[t];this.suititem.initItems(l.ReXueUtil.getReXueSuitPosArr_neishi(this._heroIdx,this.rxData.curNeishiSuitlv,this.uvo),p.enumItem.arr_equipPosNameNs),this.lab_suitName.text=i.name;for(var n=i.prop,s=0;s<10;s++){var o=this.box_suit.getChildByName("sname_"+s);if(n[s]){var a=h.ItemUtils.getShuXingByName(n[s][0]),r=n[s][1];o.text=a.desc+" : "+c.ShuXingVo.getString4Vo(r,a),o.color=e?"#a89e8f":"#09d51f"}else o.removeSelf()}},t}(ui.rexue.tips.RxTips_OrUI);e.RxTips_or=i}),define("src/g/role_other/view/rexue/OtherReXueEquipPage",["require","exports","../../../../utils/ItemUtils","../../../net/messages/PutonEquipC2GS","src/g/Effects/UIEffectsFactory","../../../../meta/QualiyVo","../../../../meta/CommonVo","src/g/rexue/view/Tips/RxTips_eq","../../../../vo/ReXueUtil","src/g/rexue/view/Tips/RxTips_or","../../../../vo/SkillTipsVo","../../../../utils/RoleUtil"],function(t,e,r,n,l,h,c,s,u,o,a,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t._heroIdx=0;for(var e=1;e<=8;e++)t.getChildByName("eq_"+e).setClickHandler(new Laya.Handler(t,t.onEquipClick));for(e=0;e<4;e++)t.getChildByName("or_"+e).setClickHandler(new Laya.Handler(t,t.onOrnamentClick));return t.btn_suit.visible=!1,t.btn_xw.removeSelf(),t}return __extends(t,i),t.prototype.refreshData=function(t,e){this.uvo=e,this._hero=e.openhero[t],this._heroIdx=t,this._data=this._hero.rxData,this.renderView()},t.prototype.renderView=function(){this.refreshAni(),this.renderEquip(),this.renderOrnament(),this.renderSkill(),this.renderScore()},t.prototype.onEquipClick=function(t,e){if(null!=t){if(e==n.EPosEquip.wuqi||e==n.EPosEquip.yifu){if(!u.ReXueUtil.getEquipVoById(t.equins.equtemplet))return;return(i=new s.RxTips_eq(this.uvo)).initData(this._heroIdx,e,t,t.equins,!0,!1),void i.popup()}var i;if(t&&0!=t.equins.equid)(i=new s.RxTips_eq(this.uvo)).initData(this._heroIdx,e,t,t.equins),i.popup()}},t.prototype.onOrnamentClick=function(t,e){if(0!=this._data.curNeishiLv[e]){var i=new o.RxTips_or(this.uvo);t?i.initData(this._heroIdx,e):i.initData(this._heroIdx,e,0),i.popup()}},t.prototype.renderEquip=function(){for(var t=1;t<=8;t++){var e=this._data.openPosArr.indexOf(t),i=0<=e,n=this[ktgame.RoleDefineMod.arr_equipPosConst[t-1]];if(i){var s=this._data.equipArr[e];if(0==s.equins.equid)n.setIcon("res/custom/equipIcon/rx_"+ktgame.RoleDefineMod.arr_equipPosConst[t-1]+".png"),n.setStarSmall(),n.setName("","",r.ItemUtils.getQualitybjByQualityId(c.CommonVo.getVoByKey("qulity_rexue").val2num)),1!=t&&3!=t||n.setName("","#3ecf1a",r.ItemUtils.getQualitybjByQualityId(c.CommonVo.getVoByKey("qulity_rexue").val2num)),n.item.item.effect_con.removeChildren();else{var o=u.ReXueUtil.getEquipVoById(s.equins.equtemplet);n.setIcon(r.ItemUtils.getIconByIconId(o.icon)),n.setStarSmall(o.id%10),n.setName(o.name,r.ItemUtils.getColorByQuality(o.quality),r.ItemUtils.getQualitybjByQualityId(o.quality));var a=h.QualityStruct.Ins.getQEffById(o.quality);l.UIEffectsFactory.Ins.createAndCenter(n.item.item.effect_con,a,!0,1,1)}n.setData(s,t),n.setUnLock(!0)}else n.setIcon("res/custom/equipIcon/rx_"+ktgame.RoleDefineMod.arr_equipPosConst[t-1]+".png"),n.setUnLock(!1),n.setData(null,t),n.setStarSmall(),n.setName("","#3ecf1a",r.ItemUtils.getQualitybjByQualityId(c.CommonVo.getVoByKey("qulity_rexue").val2num),!1),n.item.item.effect_con.removeChildren()}},t.prototype.renderOrnament=function(){for(var t=0;t<4;t++){var e=this["or_"+ktgame.RoleDefineMod.arr_suitPosConst[t]],i=u.ReXueUtil.getOrnamentVo(t+1,this._data.curNeishiLv[t]),n=i&&0!=i.level?"":"_gray";i&&0!=i.level?(e.setStarSmall(i.suit),e.setName(i.name,r.ItemUtils.getColorByQuality(c.CommonVo.getVoByKey("qulity_rexuejihuo").val2num),r.ItemUtils.getQualitybjByQualityId(c.CommonVo.getVoByKey("qulity_rexuejihuo").val2num))):(e.setStarSmall(),e.setName("","",r.ItemUtils.getQualitybjByQualityId(c.CommonVo.getVoByKey("qulity_rexue").val2num))),e.setIcon("res/custom/equipIcon/rx_"+ktgame.RoleDefineMod.arr_suitPosConst[t]+n+".png"),e.setData(i,t),e.setUnLock(!0)}},t.prototype.renderSkill=function(){for(var t,e=[],i=0;i<3;i++){e.length=0,t=this["skill_"+i];a.SkillTipsStruct.getVoById1(t.name);t.img_icon.skin="res/rexue/rexue_jineng_0"+(i+1)+".png",e=(e=e.concat(u.ReXueUtil.getReXueSuitPosArr_shenbing(this._heroIdx,i+1,this.uvo))).concat(u.ReXueUtil.getReXueSuitPosArr_shouhu(this._heroIdx,i+1,this.uvo));for(var n=0,s=0;s<e.length;s++)e[s][1]&&(n+=1);t.setOpenNum(n)}},t.prototype.renderScore=function(){this.box_score.img_titile.skin="res/rexue/rexue_pingfen"+this._hero.jobid+".png",this._data.resetPingFen(),this.box_score.clip_score.value=this._data.pingfen+"",this.box_fight.num_Fight.value=this._data.pingfen+""},t.prototype.refreshAni=function(){p.RoleUtil.refreshZww(this._hero,120,this.ani_wing,this.ani_weapon,this.ani_role,this.ani_fumo)},t}(ui.rexue.page.ReXueEquipPageUI);e.OtherReXueEquipPage=i}),define("src/g/role_other/ctrl/rexue/OtherReXueEquipCtrl",["require","exports","src/init/ResManager","src/g/role_other/view/rexue/OtherReXueEquipPage"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this.addEvent()}return t.prototype.loadUrls=function(){},t.prototype.addEvent=function(){},t.prototype.init=function(){this._view=new n.OtherReXueEquipPage},t.prototype.showPage=function(t,e){this._view||this.init(),t.removeChildren(),t.addChild(this._view),this._view.img_bg1.restskin(),this._view.img_bg2.restskin(),this.changePerson(0,e),i.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t,e){this._view&&this._view.refreshData(t,e)},t.prototype.refreshData=function(){this._view&&this._view.renderView()},t.prototype.getTitle=function(){return"res/rexue/rexue_biaotiwenzi1.png"},t.prototype.hidePage=function(){i.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){i.ResManager.getInstance().destroyPageCtrl(this)},t}();e.OtherReXueEquipCtrl=s}),define("src/g/role_other/ctrl/rexue/OtherReXueDlgCtrl",["require","exports","src/g/base/BaseCtrl","src/g/role_other/view/rexue/OtherReXueView","src/g/role_other/ctrl/rexue/OtherReXueEquipCtrl","../../../../enum/EventName","../../../../core/E","src/init/ResManager"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t._nowSelectHero=0,t._openArg=[],t.urls=["res/atlas/res/rexue.json"],t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){a.E.ins.on(o.EventName.OTHERSHOW_REXUE,this,this.onOpenHandler),a.E.ins.on(o.EventName.REXIE_UP_NEISHI,this,this.refreshData),a.E.ins.on(o.EventName.OPENNEW_HERO,this,this.refreshHeroHeadShow)},t.prototype.refreshHeroHeadShow=function(t){void 0===t&&(t=0),this._view&&this._view.tab_head.initData(this.uvo.openhero,this._nowSelectHero,!1)},t.prototype.onOpenHandler=function(t){this.uvo=t,this.openReXueView()},t.prototype.tab_selectHandler=function(t){this._page&&this._page.hidePage(),0==t&&(this._view.tab_head.visible=!0,this._page=this._equip),this._page&&this._page.showPage(this._view.bg_view.box_page,this.uvo),this._view.bg_view.img_title.skin=this._page.getTitle()},t.prototype.initView=function(){this._view=new n.OtherReXueDlgView,this._equip=new s.OtherReXueEquipCtrl,this._view.tab_page.selectHandler=new Laya.Handler(this,this.tab_selectHandler),this._view.tab_head.setCallbackHandler(new Laya.Handler(this,this.HeroSelect)),this._view.item1.visible=!1,this._view.item2.visible=!1,this._view.red_equip.removeSelf(),this._view.red_stone.removeSelf(),this.refreshHeroHeadShow(this._nowSelectHero),this._view.bg_view.btn_back.on(Laya.Event.CLICK,this,this.hidePage),this._view.bg_view.btn_close.on(Laya.Event.CLICK,this,this.hidePage)},t.prototype.openReXueView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._openArg.length=0,this._openArg.push(t),this._openArg.push(e),this._openArg.push(i),this.opens()},t.prototype.onAtlasLoaded=function(){this.realOpenReXueView(this._openArg[0],this._openArg[1],this._openArg[2])},t.prototype.realOpenReXueView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._view||this.initView(),this.tab_selectHandler(0),this._view.showView(e,i)},t.prototype.HeroSelect=function(t,e){this.uvo.openhero[t]&&(this._nowSelectHero=t,this._view.tab_head.setSelectIndex(t),this._page.changePerson(t,this.uvo))},t.prototype.init=function(){return null},t.prototype.showPage=function(t,e){this.refreshHeroHeadShow(),r.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){this._page&&this._page.refreshData()},t.prototype.getTitle=function(){return null},t.prototype.hidePage=function(){this._view&&this._view.hideView(),this._equip&&this._equip.hidePage()},t.prototype.destroyPage=function(){this._view&&this._view.destroyView(),this._equip&&this._equip.destroyPage(),r.ResManager.getInstance().destroyPageCtrl(this),this.clearCtrlRes()},t}(i.BaseCtrl);e.OtherReXueDlgCtrl=l}),define("src/g/role_other/view/shenbing/OtherShenBingBgView",["require","exports","../../../../manager/LayerManager"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.red_huanjing.removeSelf(),t.red_tianfu.removeSelf(),t.item1.removeSelf(),t.item2.removeSelf(),t}return __extends(t,e),t.prototype.showView=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),i.LayerManager.addInPOPWindowLayer(this,t,!0,!0,!1,e)},t.prototype.hideView=function(){this.bg_view.box_page.removeChildren(),this.removeSelf()},t.prototype.destroyView=function(){this.hideView()},t}(ui.shenbing.ShenBingBgUI);e.OtherShenBingBgView=n}),define("src/g/role_other/view/shenbing/OtherShenBingPage",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setBtnSelect=function(t){for(var e=0;e<3;e++){var i=this["skill_"+e];i.img_select.visible=i.name==t+"",i.img_jobIcon.skin="res/shenbing/shenbing/shenbing_icon"+(e+1)+".png"}},e}(ui.shenbing.page.ShenBingPageUI);e.OtherShenBingPage=i}),define("src/g/role_other/view/shenbing/OtherSb_SkillPage",["require","exports","../../../../config/GameConfig","../../../../utils/ItemUtils","src/g/Effects/UIEffectsFactory","src/g/clearRes/ClearResM","../../../../utils/SbUtils","src/init/TextConst","src/g/shenbing/view/subpage/Sb_SkillPage","../../../../utils/ItemCellUtils"],function(t,e,l,h,v,s,f,c,i,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.btn_upLv.removeSelf(),t.lab_reset.removeSelf(),t.hecheng.removeSelf(),t}return __extends(t,e),t.prototype.addEvent=function(){this.changePage.on(Laya.Event.CLICK,this,this.onChangePage),this.on(Laya.Event.UNDISPLAY,this,this.onRemoved)},t.prototype.onChangePage=function(){var t=this.type;isNaN(t)?this.type=t=0:this.type=t=0==t?1:0;var e=this.nowJob,i="res/bg/shenbing_tianfu_beijing",n="res/shenbing/shenbing/";switch(t){case 0:this.bg_1.skin=i+(e+"_1.jpg"),this.changePage.skin=n+"shenbing_anniu_shengwu.png",this.tianfu.visible=!0,this.zhuangbei.visible=!1,this.renderSkill(),this.renderTianFuLvBar();break;case 1:this.changePage.skin=n+"shenbing_anniu_tianfu.png",this.bg_1.skin=i+(e+"_2.jpg"),this.tianfu.visible=!1,this.zhuangbei.visible=!0,this.updateShengwu()}this.bg_1.skin&&s.ClearResM.addBgUrl(this.bg_1.skin)},t.prototype.updateShengwu=function(){for(var t=this._one,e=t.lv,i=l.GameConfig.commonJson.shengwupos.value.split(","),n=i.length,s=0;s<n;s++){var o=this["item"+s],a=+i[s];if(u.ItemCellUtils.fillSbItem(o,null),a<=e){var r=t.equipArr[s]||0;0!=r&&u.ItemCellUtils.fillSbItem(o,h.ItemUtils.getItemVoById(r))}else o.img_lock.visible=!0,o.item.lab_name.text=c.TextConst.get(25,a)}},t.prototype.refreshPage=function(t,e){this.uvo=e,this.nowJob=t,this._one=f.SbUtils.getOneSbDataByJob(t,e),this.jobSet=f.SbUtils.getSbSettingByJob(t);var i=this.type;isNaN(i)||(this.type=i=0==i?1:0),this.onChangePage(),s.ClearResM.resetViewImg(this)},t.prototype.renderSkill=function(){var t=this._one;if(t)for(var e=f.SbUtils.getArr_TianFuByJob(this.nowJob),i=f.SbUtils.getExtLvBySbData(t),n=f.SbUtils.getExtQualityBySbData(t),s=0;s<e.length;s++){var o=e[s],a=o.id,r=t.giftArr,l=r.indexOf(a),h=this["tf_"+s];this["tf_"+s+"j"].visible=!1,h.skin=f.SbUtils.getTianfuIcon(o.icon),h.dataSource=o,h.gray=-1==l,this.setTianFuPos(h,this["tf_"+s+"l"],s);var c=this.tianfu.getChildByName("lab_"+s),u=this.tianfu.getChildByName("ani_"+s),p=n[a];null!=p?(u&&u.removeSelf(),u=v.UIEffectsFactory.Ins.createSAniById(p,1,1,"ani_"+s),this.tianfu.addChild(u),u.x=h.x,u.y=h.y):u&&u.removeSelf();var d=0;d=-1!=l?r[l+1]:0;var g=i[a]||0;0<g&&(h.gray=!1),c.text="("+(d+g)+"/"+(o.maxlv+g)+")",d+g==0?c.color="#999999":d+g<o.maxlv+g?c.color="#09d51f":c.color="#ffd906"}},t}(i.Sb_SkillPage);e.OtherSb_SkillPage=n}),define("src/g/role_other/ctrl/shenbing/OtherSb_SkillCtrl",["require","exports","src/g/clearRes/ClearResM","src/g/role_other/view/shenbing/OtherSb_SkillPage"],function(t,e,s,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){this._nowJob=0}return t.prototype.init=function(){this._view=new i.OtherSb_SkillPage},t.prototype.showPage=function(t,e,i){this.uvo=i;var n=this._view;n||(this.init(),n=this._view),n.parent!=t&&t.removeChildren(),t.addChild(n),s.ClearResM.resetViewImg(n),this._nowJob=e,this.changePerson(e)},t.prototype.changePerson=function(t,e){this._nowJob=t,this.refreshData()},t.prototype.refreshData=function(){this._view.refreshPage(this._nowJob,this.uvo)},t.prototype.getTitle=function(){return""},t.prototype.hidePage=function(){},t.prototype.destroyPage=function(){},t.prototype.loadUrls=function(){},t}();e.OtherSb_SkillCtrl=n}),define("src/g/role_other/ctrl/shenbing/OtherShenBingPageCtrl",["require","exports","src/init/ResManager","src/g/clearRes/ClearResM","src/g/role_other/view/shenbing/OtherShenBingPage","src/g/role_other/ctrl/shenbing/OtherSb_SkillCtrl","../../../../utils/SbUtils"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this._nowJob=1,this._skill=new o.OtherSb_SkillCtrl}return t.prototype.init=function(){this._view=new s.OtherShenBingPage,this.addEvent()},t.prototype.addEvent=function(){this._view.skill_0.on(Laya.Event.CLICK,this,this.changePerson,[1]),this._view.skill_1.on(Laya.Event.CLICK,this,this.changePerson,[2]),this._view.skill_2.on(Laya.Event.CLICK,this,this.changePerson,[3])},t.prototype.showPage=function(t,e){this.uvo=e,this._data=e.sbData,this._view||this.init(),t.removeChildren(),t.addChild(this._view),n.ClearResM.resetViewImg(this._view),this._nowJob=1,this.changePerson(1),i.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t,e){this._nowJob=t;a.SbUtils.getOneSbDataByJob(t,this.uvo);this._view.setBtnSelect(t),this._skill.showPage(this._view.box_page,t,this.uvo)},t.prototype.refreshData=function(){this.changePerson(this._nowJob)},t.prototype.getTitle=function(){return"res/shenbing/shenbing/shenbing_renwu_biaoti.png"},t.prototype.hidePage=function(){i.ResManager.getInstance().hidePageCtrl(this),this._view&&this._view.removeSelf()},t.prototype.destroyPage=function(){this.hidePage()},t.prototype.loadUrls=function(){},t}();e.OtherShenBingPageCtrl=r}),define("src/g/role_other/ctrl/shenbing/OtherShenBingBgCtrl",["require","exports","src/g/base/BaseCtrl","src/g/role_other/view/shenbing/OtherShenBingBgView","src/g/role_other/ctrl/shenbing/OtherShenBingPageCtrl","../../../../core/E","../../../../enum/EventName","src/init/ResManager","src/g/clearRes/ClearResM","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t._nowJob=1,t.urls=["res/atlas/res/shenbing/shenbing.json","res/atlas/res/shenbing/sb_fantasy.json"],t.initCtrl(),t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){o.E.ins.on(a.EventName.OTHERSHOW_SHENBING,this,this.openShenBingView)},t.prototype.initCtrl=function(){this._shenbing=new s.OtherShenBingPageCtrl},t.prototype.tab_selectHandler=function(t){this._page&&this._page.hidePage(),0==t&&(this._view.tab_head.visible=!1,this._page=this._shenbing),this._page&&this._page.showPage(this._view.bg_view.box_page,this.uvo),this._view.bg_view.img_title.skin=this._page.getTitle()},t.prototype.initView=function(){this._view=new n.OtherShenBingBgView,this._view.tab_head.setCallbackHandler(new Laya.Handler(this,this.HeroSelect)),this._view.bg_view.btn_back.on(Laya.Event.CLICK,this,this.hidePage),this._view.bg_view.btn_close.on(Laya.Event.CLICK,this,this.hidePage)},t.prototype.openShenBingView=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this.uvo=t,3==this.uvo.heronum?this.opens():h.FE.upItems(u.TextConst.get(717),c.BubbleEnum.center)},t.prototype.onAtlasLoaded=function(){this.realOpenReXueView()},t.prototype.realOpenReXueView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._view||this.initView(),this.tab_selectHandler(0),this._view.showView(e,i)},t.prototype.HeroSelect=function(t,e){this.uvo.openhero[t]&&(this._nowJob=t,this._view.tab_head.setSelectIndex(t),this._page.changePerson(t,this.uvo.openhero[t]))},t.prototype.init=function(){return null},t.prototype.showPage=function(t,e){r.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){this._page&&this._page.refreshData()},t.prototype.getTitle=function(){return null},t.prototype.hidePage=function(){this._view&&this._view.hideView(),this._shenbing&&this._shenbing.hidePage(),this.destroyPage()},t.prototype.destroyPage=function(){this._view&&this._view.destroyView(),this._shenbing&&this._shenbing.destroyPage(),l.ClearResM.clearFolderByUrl("dynamic/shenbing/skillIcon/")},t}(i.BaseCtrl);e.OtherShenBingBgCtrl=p}),define("src/g/role_other/ctrl/GOtherRoleCtrl",["require","exports","src/g/base/BaseCtrl","../../../core/E","../../../enum/EventName","../../../core/GNet","../../../enum/GuideTargetName","../../../manager/RoleCenter","src/g/role_other/ctrl/role/OtherEquipPageCtrl","src/g/role_other/view/GOtherRoleDlg","src/g/role_other/ctrl/role/OtherArtifactsCtrl","src/g/role_other/ctrl/subrole/OtherRingViewCtrl","src/g/role_other/ctrl/govern/OtherGovernCtrl","src/g/role_other/ctrl/rexue/OtherReXueDlgCtrl","src/g/role_other/ctrl/shenbing/OtherShenBingBgCtrl"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(e){function t(){var t=e.call(this)||this;return t._targetUser="",t._targetSvrid=0,t._nowSelectHero=0,t.trul="res/atlas/res/rank.json",t.urls=["res/atlas/res/role/wing.json"],n.E.ins.on(s.EventName.OPEN_RANKROLEVIEW,t,t.openWithUname),t}return __extends(t,e),t.prototype.addOtherData=function(){this.findSelfTarget()},t.prototype.showOtherInfo=function(t){(this._other=t)&&this.openOtherRoleView()},t.prototype.findSelfTarget=function(){var t=this._targetUser;if(""!=t){var e=r.RoleCenter.instans.getOtherData(t);(this._other=e)?(this._targetUser="",this.openOtherRoleView()):o.GNet.getOtherData([t],!1,this._targetSvrid)}},t.prototype.addEvent=function(){this._view.bg_view.btn_close.on(Laya.Event.CLICK,this,this.closeRoleView),this._view.bg_view.btn_back.on(Laya.Event.CLICK,this,this.closeRoleView),this._view.tab_head.setCallbackHandler(new Laya.Handler(this,this.HeroSelect))},t.prototype.initview=function(){this._view=new h.GOtherRoleDlg,this._otherEquip=new l.OtherEquipPageCtrl,this._otherArtifacts=new c.OtherArtifactsViewCtrl,new u.OtherRingViewCtrl,new p.OtherGovernCtrl,new d.OtherReXueDlgCtrl,new g.OtherShenBingBgCtrl,this.addEvent(),this.initBtnEv()},t.prototype.initBtnEv=function(){this._view.tab_pageBtn.selectHandler=new Laya.Handler(this,this.tabSelectHandler)},t.prototype.tabSelectHandler=function(t){switch(t){case 0:this._view.tab_head.visible=!0,this._page=this._otherEquip;break;case 1:this._view.tab_head.visible=!1,this._page=this._otherArtifacts}this._page.showPage(this._view.bg_view.box_page,this._other)},t.prototype.openWithUname=function(t,e){void 0===e&&(e=0),n.E.ins.on(s.EventName.OTHERDATA_UPDATE,this,this.addOtherData),this._targetUser=t,this._targetSvrid=e,this.findSelfTarget()},t.prototype.refreshHeroHeadShow=function(t){void 0===t&&(t=0),this._other&&this._view.tab_head.initData(this._other.openhero,this._nowSelectHero,!1)},t.prototype.HeroSelect=function(t,e){this._other.openhero[t]&&(this._nowSelectHero=t,this._view.tab_head.setSelectIndex(t),this._otherEquip.changePerson(t,this._other))},t.prototype.openOtherRoleView=function(){this.opens()},t.prototype.onAtlasLoaded=function(){this.realOpenRoleView()},t.prototype.realOpenRoleView=function(){this._view||this.initview(),this.refreshHeroHeadShow(),0==this._nowSelectHero&&(this._nowSelectHero=-1),this._nowSelectHero=0,this._view.tab_pageBtn.selectedIndex=0,this.tabSelectHandler(0),this._view.showView(),this.refreshHeroHeadShow()},t.prototype.closeRoleView=function(){n.E.ins.off(s.EventName.OTHERDATA_UPDATE,this,this.addOtherData),this._view.hideView(),n.E.ins.event(s.EventName.COMPTYPE_CLOSEVIEW,a.GuideTargetName.ROLE_VIEW)},t}(i.BaseCtrl);e.GOtherRoleCtrl=v}),define("src/g/crossserboss/view/KFHotBloodPortItem2",["require","exports","../../../utils/system/ServerTime","../../../utils/system/DateUitl","src/g/fight/osprite/play/kfhotblood/KfHotBloodManager","src/init/TextConst"],function(t,e,n,s,o,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(){var t=this.dataSource;this.text_bossName.text=t.bossName,t.stateKey?(this.stopCD(),this.text_state.color="#09d51f",this.text_state.text=i.TextConst.get(344)):(this.text_state.color="#ffd409",this.startCD())},t.prototype.startCD=function(){Laya.timer.loop(1e3,this,this.updCd),this.updCd()},t.prototype.updCd=function(){if(this.dataSource){var t=o.KFHotBloodManager.ins(),e=t.getBossVoByPortId(this.dataSource.portId),i=t.getPortStatus(e.port).lastDieTime+e.cd-n.ServerTime.serverTime;i<=0?this.stopCD():this.text_state.text=s.DateUtil.getHMS_countdown(i)}},t.prototype.stopCD=function(){Laya.timer.clear(this,this.updCd)},t.prototype.destroy=function(t){this.stopCD(),e.prototype.destroy.call(this,t)},t}(ui.hotblood.HotBloodBossInfoItemUI);e.KFHotBloodPortItem2=a}),define("src/g/crossserboss/view/KFHotBloodTotalInfoView",["require","exports","src/g/fight/osprite/GameScene","../../../config/GameConfig","../../../manager/LayerManager","../../net/messages/BloodyBattleMsg","../../../utils/ItemUtils","src/g/fight/osprite/play/kfhotblood/KfHotBloodManager","src/g/crossserboss/view/KFHotBloodPortItem2"],function(t,e,h,c,n,l,u,p,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t._smallMap=null,t._smallMapSprite=new Laya.Sprite,t._bossSprite=new Laya.Sprite,t._image=null,t._monsterList=[],t.width=Laya.stage.width,t.mouseThrough=!0,t.initList(t.bossInfoList,t.onRenderHandler,s.KFHotBloodPortItem2),t.bossInfoList.selectEnable=!0,t.bossInfoList.selectHandler=new Laya.Handler(t,t.onSelectHandler),t.updateListInfo(),t._image=new Laya.Image("res/hotblood/rxzc_wanjiaweizhi.png"),t._image.on(Laya.Event.LOADED,t,t.onRoleImage),t._smallMapSprite.addChild(t._image);for(var e=0;e<8;e++)t._monsterList[e]=new Laya.Image("res/hotblood/rxzc_hongdian01.png"),t._bossSprite.addChild(t._monsterList[e]);return t}return __extends(t,i),t.prototype.onRoleImage=function(){this._image.x=-this._image.width/2,this._image.y=-this._image.height/2},t.prototype.initList=function(t,e,i){t.selectEnable=!0,t.vScrollBarSkin="",t.itemRender=i,t.scrollBar.elasticDistance=100,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.onRenderHandler=function(t,e){t.update()},t.prototype.onSelectHandler=function(t){if(-1<t&&t<this.bossInfoList.length){var e=this.bossInfoList.array[t];p.KFHotBloodManager.ins().gotoBossArea(e.portId),this.bossInfoList.selectedIndex=-1}},t.prototype.updateListInfo=function(){var t=p.KFHotBloodManager.ins().getBossInfoDic(),e=null,i=null,n=[],s=null,o=null;for(var a in t)if(e=t[a]){var r=p.KFHotBloodManager.ins().getBossVoByPortId(e.portid);e.lastDieTime,r.cd;switch(i=new d,n.push(i),s=c.GameConfig.getPortByID(r.port),o=u.ItemUtils.getMonsterVOById(s.boss),i.bossName=o.name,i.portId=r.port,e.bossState){case l.EBattleBossState.WAIT_REVIVE:console.log("等待复活"),i.stateKey=!1;break;case l.EBattleBossState.CAN_CHALLENGE:console.log("可挑战"),i.stateKey=!0;break;case l.EBattleBossState.NULL:console.error("null")}}this.bossInfoList.array=n},t.prototype.show=function(){if(null==this._smallMap){var t=(u.ItemUtils.getMapUrl()+"{0}/small_2.jpg").replace("{0}","531");this._smallMap=new Laya.Image(t),this.mapBox.addChild(this._smallMap),this.mapBox.addChild(this._smallMapSprite),this.mapBox.addChild(this._bossSprite);n.LayerManager.addInUILayer(this)}this.visible=!0,Laya.timer.frameLoop(1,this,this.update)},t.prototype.hide=function(){Laya.timer.clear(this,this.update),this.visible=!1},t.prototype.exit=function(){Laya.timer.clear(this,this.update),this._smallMapSprite&&(this._smallMapSprite.removeSelf(),this._smallMapSprite=null),this._smallMap&&(this._smallMap.removeSelf(),this._smallMap=null)},t.prototype.update=function(){var t=p.KFHotBloodManager.ins();if(t.gamePlay&&this._smallMap){var e=t.gamePlay.getSelfPos(),i=this._smallMap.width*this._smallMap.scaleX,n=this._smallMap.height*this._smallMap.scaleY,s=e[0]/h.GameScene.ins.map.width*i,o=e[1]/h.GameScene.ins.map.height*n;this._smallMapSprite.x=s,this._smallMapSprite.y=o;for(var a=0;a<this._monsterList.length;a++){var r=c.GameConfig.getPortByID(4e4+a+1),l=c.GameConfig.getMapJSON(r.boss_scene);l&&0<l.bossXY.length&&(s=l.bossXY[0][0]/h.GameScene.ins.map.width*i,o=l.bossXY[0][1]/h.GameScene.ins.map.height*n,this._monsterList[a].x=s-9,this._monsterList[a].y=o-9)}}},t}(ui.hotblood.HotBloolSceneViewUI);e.KFHotBloodTotalInfoView=i;var d=function(){this.stateKey=!1,this.portId=-1};e.HotBloodBossInfoItemData=d}),define("src/g/crossserboss/view/KFHotBloodWar",["require","exports","src/g/crossserboss/PointWarPlayer","../../../manager/LayerManager","../../../core/E","../../../enum/EventName","src/g/boss/view/SCFoeHead","../../../utils/ItemUtils","../../../manager/RoleCenter","../../net/messages/chat/ChatGS2C","../../net/messages/chat/ChatC2GS","src/g/fight/osprite/play/kfhotblood/KfHotBloodManager","../../../utils/GPUtils","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(e){function t(){var t=e.call(this)||this;return t.mouseThrough=!0,t.width=Laya.stage.width,t.height=Laya.stage.height,t.foeIndexDict=new Laya.Dictionary,t.familyIndexDict=new Laya.Dictionary,t.playerIndexDict=new Laya.Dictionary,t.bossHead=new i.PointWarPlayer,t.bossHead.setType(0),t.bossHead.right=0,t.bossHead.y=137,t.addChild(t.bossHead),t.guiShuZhe=new i.PointWarPlayer,t.guiShuZhe.setType(1),t.guiShuZhe.y=34,t.guiShuZheBox.addChildAt(t.guiShuZhe,0),t.setGuiShuZhe(null),t.imgAttack.visible=t.myFMember.visible=t.foeFMember.visible=!1,t.initList(t.foeList,t.foeRender,i.PointWarPlayer),t.initList(t.myFamilyList,t.familyPlayerRender,i.PointWarPlayer),t.initList(t.playerList,t.playerRender,i.PointWarPlayer),t.familyFriendLink.on(Laya.Event.CLICK,t,t.onLinkHandler),t.guiShuZheBox.on(Laya.Event.CLICK,t,t.attackGuiShuzheHander),t.hideOPlayerButton.visible=!1,t}return __extends(t,e),t.prototype.attackGuiShuzheHander=function(){var t=this.guiShuZhe.getDataAsFightGroup();t&&s.E.ins.event(o.EventName.SELECT_PK_TARGET,t.groupID)},t.prototype.initList=function(t,e,i){t.selectEnable=!0,t.vScrollBarSkin="",t.itemRender=i,t.scrollBar.elasticDistance=100,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.foeRender=function(t,e){t.update2("left"),t.showAttackerEf(),t.on(Laya.Event.CLICK,this,this.attFoeHander)},t.prototype.familyPlayerRender=function(t,e){t.update2("left"),t.on(Laya.Event.CLICK,this,this.attackFamilyList)},t.prototype.playerRender=function(t,e){t.update2("right"),t.on(Laya.Event.CLICK,this,this.attplayerHander)},t.prototype.showView=function(){n.LayerManager.addInUILayer(this)},t.prototype.updFoeList=function(t){var e=p.GPUtils.deleteEmptyData(t,this.foeIndexDict);this.foeList.array=e,p.GPUtils.caculateListH(this.foeList,3),this.imgAttack.visible=e&&0!=e.length},t.prototype.updMyFamilyList=function(t){var e=p.GPUtils.deleteEmptyData(t,this.familyIndexDict);this.myFamilyList.array=e,p.GPUtils.caculateListH(this.myFamilyList,2),this.myFMember.visible=e&&0!=e.length,this.myFMemberNum.text=d.TextConst.get(360,e.length)},t.prototype.updPlayerList=function(t){var e=p.GPUtils.deleteEmptyData(t,this.playerIndexDict,!0);this.playerList.array=e,p.GPUtils.caculateListH(this.playerList,4),this.foeFMember.visible=e&&0!=e.length,this.foeFMemberNum.text=d.TextConst.get(361,e.length)},t.prototype.attplayerHander=function(t){var e=t.currentTarget,i=this.playerIndexDict.get(e.dataSource);s.E.ins.event(o.EventName.SELECT_TARGET_INDEX,i)},t.prototype.attFoeHander=function(t){var e=t.currentTarget,i=this.foeIndexDict.get(e.dataSource);s.E.ins.event(o.EventName.SELECT_REVENGE_TARGET_INDEX,i)},t.prototype.attackFamilyList=function(t){var e=t.currentTarget,i=this.familyIndexDict.get(e.dataSource);s.E.ins.event(o.EventName.SELECT_FAMILYMEMBER_INDEX,i)},t.prototype.changeAttackTarget=function(t){this.clearAttackSign(),null!=t&&(""==t?this.bossHead.updStatus(a.SCFoeHead.BE_ATTACK):(null!=this.guiShuZhe.getDataAsFightGroup()&&this.guiShuZhe.getDataAsFightGroup().groupID==t&&this.guiShuZhe.updStatus(a.SCFoeHead.BE_ATTACK),this.showAttackSignInList(this.foeList,t),this.showAttackSignInList(this.playerList,t),this.showAttackSignInList(this.myFamilyList,t)))},t.prototype.clearAttackSign=function(){this.bossHead.reset(),this.guiShuZhe.reset(),this.clearListAttackSign(this.foeList),this.clearListAttackSign(this.playerList),this.clearListAttackSign(this.myFamilyList)},t.prototype.clearListAttackSign=function(t){for(var e=0;e<t.cells.length;e++)t.cells[e].reset()},t.prototype.showAttackSignInList=function(t,e){for(var i,n=0;n<t.cells.length;n++)(i=t.cells[n]).getName()==e&&i.updStatus(a.SCFoeHead.BE_ATTACK)},t.prototype.onDeath=function(){this.clearAttackSign()},t.prototype.setBoss=function(t,e){this.bossMaxHP=e,this.imgBossHead.skin=r.ItemUtils.getBossIconByPort(t.port),this.lbBossName.text=t.name,this.bossHead.updateBoss(t)},t.prototype.updBossHP=function(t){var e=Math.min(380*t/this.bossMaxHP>>0,380);this.progressBar.width=e,this.progress_txt.text=(t/this.bossMaxHP*100).toFixed(2)+"%"},t.prototype.setGuiShuZhe=function(t){t?(this.guiShuZheBox.visible=!0,this.guiShuZhe.updWinner2(t),l.RoleCenter.instans.self.username==t.groupID||l.RoleCenter.instans.self.ufData.familyUId==t.getFamilyUid()&&""!=l.RoleCenter.instans.self.ufData.familyUId?this.imgFamily.skin="res/fightview/rxzc_wohuitubiao.png":this.imgFamily.skin="res/fightview/rxzc_dihuitubiao.png",l.RoleCenter.instans.self.username==t.groupID?(this.imgowner.visible=!0,this.attackBoss.visible=!1):(this.imgowner.visible=!1,this.attackBoss.visible=!0)):(this.guiShuZheBox.visible=!1,this.imgowner.visible=!1,this.attackBoss.visible=!0)},t.prototype.updGuiShuZheHP=function(t,e){this.guiShuZhe.updBlood(t,e)},t.prototype.visibleBossView=function(t){this.bossInFoBox.visible=t,this.bossHead.visible=t,this.buttonBox.visible=t},t.prototype.onLinkHandler=function(){var t=new h.ChatGS2C;t.type=c.enumChatType.family;var e="@10@#"+u.KFHotBloodManager.ins().getPortId();t.msg=e,s.E.ins.event(o.EventName.SEND_CHAT,[e,c.enumChatType.family])},t}(ui.hotblood.HotBloodWarUI);e.KFHotBloodWar=g}),define("src/g/crossserboss/ctrl/KFHotBloodWarCtrl",["require","exports","../../../core/E","../../../enum/EventName","../../../utils/ItemUtils","src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager","../../../enum/SettingEnum","src/g/setting/vo/SettingInfo","src/g/setting/ctrl/SettingCtrl","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg","src/g/fight/osprite/play/kfhotblood/KfHotBloodManager","src/g/hotblood/ctrl/HotBloodWarDeathCtrl","src/g/crossserboss/view/KFHotBloodTotalInfoView","src/g/crossserboss/view/KFHotBloodWar","src/init/TextConst"],function(t,e,n,s,o,i,a,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(){function t(){this.totalInfoView=null,this._bossHp=0,this.deathCtrl=new p.HotBloodWarDeathCtrl,n.E.ins.on(s.EventName.KFHOTBLOODWAR_SCENE_PANEL,this,this.openPanel)}return t.prototype.openPanel=function(){null==(this.manager().viewCtrl=this).totalInfoView&&(this.totalInfoView=new d.KFHotBloodTotalInfoView,this.totalInfoView.show(),this.totalInfoView.fhzc.on(Laya.Event.CLICK,this,this.fhzcHandler),this.showLastBossScene())},t.prototype.showBattlePanel=function(t){this.currportid=t,this.lastportid=NaN,n.E.ins.on(s.EventName.UPDATE_REVENGE_VIEW_TARGET,this,this.updateFoeListHandler),n.E.ins.on(s.EventName.UPDATE_VIEW_TARGET,this,this.updPlayerListHander),n.E.ins.on(s.EventName.UPDATE_VIEW_FAMILYMEMBER,this,this.updateMyFamilyList),n.E.ins.on(s.EventName.CHANGE_PK_TARGET,this,this.attackTargetChangedHander),n.E.ins.on(s.EventName.OTHER_PLAYER_STATUS_CHANGED,this,this.onOPlayerStatusChanged),null==this.view&&(this.view=new g.KFHotBloodWar,this.view.showView()),this.updHideBtnStatus(),this.view.attackBoss.on(Laya.Event.CLICK,this,this.attackBossHander),this.view.bossHead.on(Laya.Event.CLICK,this,this.attackBossHander),this.view.hideOPlayerButton.on(Laya.Event.CLICK,this,this.hidePlayer),this.view.visible=!0;var e=o.ItemUtils.getBossVoByPortId(t),i=o.ItemUtils.getMonsterVOById(t);e&&i&&this.view.setBoss(e,i.HP),this.totalInfoView.hide()},t.prototype.hideBattlePanel=function(t){void 0===t&&(t=!0),this.view&&(n.E.ins.off(s.EventName.UPDATE_REVENGE_VIEW_TARGET,this,this.updateFoeListHandler),n.E.ins.off(s.EventName.UPDATE_VIEW_TARGET,this,this.updPlayerListHander),n.E.ins.off(s.EventName.UPDATE_VIEW_FAMILYMEMBER,this,this.updateMyFamilyList),n.E.ins.off(s.EventName.CHANGE_PK_TARGET,this,this.attackTargetChangedHander),n.E.ins.off(s.EventName.OTHER_PLAYER_STATUS_CHANGED,this,this.onOPlayerStatusChanged),this.view.attackBoss.off(Laya.Event.CLICK,this,this.attackBossHander),this.view.bossHead.off(Laya.Event.CLICK,this,this.attackBossHander),this.view.hideOPlayerButton.off(Laya.Event.CLICK,this,this.hidePlayer),this.view.visible=!1),t&&(this.totalInfoView.show(),this.showLastBossScene())},t.prototype.fhzcHandler=function(){var t=this.lastportid;isNaN(t)||u.KFHotBloodManager.ins().gotoBossArea(t)},t.prototype.showLastBossScene=function(){var t=!0;isNaN(this.lastportid)&&(t=!1);var e=this.totalInfoView;e&&(e.fhzc.visible=t)},t.prototype.updateFoeListHandler=function(t){this.view&&this.view.updFoeList(t)},t.prototype.updateMyFamilyList=function(t){this.view&&this.view.updMyFamilyList(t)},t.prototype.updPlayerListHander=function(t){this.view&&this.view.updPlayerList(t)},t.prototype.attackTargetChangedHander=function(t){this.view&&this.view.changeAttackTarget(t)},t.prototype.exit=function(){this.manager().viewCtrl=null,this.view&&(this.view.visible&&this.hideBattlePanel(!1),this.view.removeSelf(),this.view.destroy(!0),this.view=null),this.totalInfoView&&(this.totalInfoView.exit(),this.totalInfoView.removeSelf(),this.totalInfoView.destroy(!0),this.totalInfoView=null),this.currportid=this.lastportid=NaN,this.deathCtrl.relase(),l.SettingCtrl.getInstance().hideOtehrPlayer(!1)},t.prototype.updateBossHp=function(t){this._bossHp=t,this.view&&this.view.updBossHP(t)},t.prototype.updateBossOwner=function(t){this.view&&this.view.setGuiShuZhe(t)},t.prototype.updateBossOwnerHp=function(t,e){this.view&&this.view.updGuiShuZheHP(t,e)},t.prototype.updateBossState=function(t){this.view,this.totalInfoView&&this.totalInfoView.updateListInfo()},t.prototype.visibleBossView=function(t){this.view&&this.view.visibleBossView(t)},t.prototype.attackBossHander=function(){this.manager().findBoss()},t.prototype.manager=function(){return h.PlayManager.type==c.EPlayType.PLAYTYPE_KFRX?u.KFHotBloodManager.ins():i.HotBloodWarManager.getInstance()},t.prototype.getDeathCtrl=function(){return this.deathCtrl},t.prototype.onDeath=function(t,e,i){var n=this.manager().checkIsMainScene();this.lastportid=n?NaN:this.currportid,this.deathCtrl.onDeath(t,e,i,n),this.view&&this.view.visible&&this.view.onDeath()},t.prototype.updJianMianHurt=function(t){this.view&&(this.view.lbHurtJianMian.text=v.TextConst.get(888,t))},t.prototype.onOPlayerStatusChanged=function(){this.updHideBtnStatus()},t.prototype.updHideBtnStatus=function(){1==r.SettingInfo.getSettingValue(a.SettingEnum.hideOtherPlayer)?this.view.hideOPlayerButton.skin="res/fightview/rexue_pingbiguan.png":this.view.hideOPlayerButton.skin="res/fightview/rexue_pingbikai.png"},t.prototype.hidePlayer=function(){r.SettingInfo.getSettingValue(a.SettingEnum.hideOtherPlayer)?l.SettingCtrl.getInstance().hideOtehrPlayer(!1):l.SettingCtrl.getInstance().hideOtehrPlayer(!0)},t}();e.KFHotBloodWarCtrl=f}),define("src/g/moneyreward/view/MoneyRewardDlg",["require","exports","src/g/bag/tips/view/ItemTips","../../../utils/ItemCellUtils","../../../manager/RoleCenter","../../net/messages/sbkMoneyRewardData","../../net/messages/enumStatus","../../../manager/GameSocketManager","../../../core/E","../../../enum/EventName","../../../utils/system/DateUitl","../../../utils/system/ServerTime","../../../config/GameConfig","src/init/Switches","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(e){function t(){var t=e.call(this)||this;return t._played=!1,t._state=0,t.htxt_desc.style.font="SimHei",t.htxt_desc.style.color="#3b0b28",t.htxt_desc.style.align="center",t.htxt_desc.style.fontSize=20,t.box_item.itemRender=ui.custom.Item0ViewUI,t.box_item.spaceX=-15,t.box_item.renderHandler=new Laya.Handler(t,t.onListRender),t.box_item.clickHandler=new Laya.Handler(t,t.onMouseListRender),t.btn_enter.on(Laya.Event.CLICK,t,t.onClickHandler),t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t}return __extends(t,e),t.prototype.onMouseListRender=function(t){i.ItemTips.ins.showTip(this.box_item.array[t][0],Number(this.box_item.array[t][1]))},t.prototype.onListRender=function(t,e){n.ItemCellUtils.fillCellForItem0View(t,this.box_item.array[e][0],Number(this.box_item.array[e][1]))},t.prototype.onClickHandler=function(){var t=s.RoleCenter.instans.vo.moneyRewardData;if(t){var e=p.GameConfig.moneyRewardVoCfg[t.day];if(1==this._state)(n=new o.BuyMoneyRewardC2GS).subscribeDay=t.day,r.GSM.sendServer(n);else if(2==this._state)e&&e.link&&(this.close(),d.Switches.ins.event(e.link,[!1,!0]));else if(3==this._state){var i=new o.GetMoneyRewardGS2C;i.day=t.day,r.GSM.sendServer(i)}else if(4==this._state){var n;(n=new o.BuyMoneyRewardC2GS).subscribeDay=t.day+1,r.GSM.sendServer(n)}}},t.prototype.onCloseHandler=function(){this.close()},t.prototype.onClosed=function(){e.prototype.onClosed.call(this),l.E.ins.off(h.EventName.MONEY_REWARD_DATA_UPDATED,this,this.updateUI),Laya.timer.clear(this,this.cooldownHandler),Laya.timer.clear(this,this.playKill),Laya.Tween.clearAll(this.img_killed),this._played=!1},t.prototype.showView=function(){this.updateUI(),this.nextTime=c.DateUtil.getZeroBySecond(u.ServerTime.serverTime),this.cooldownHandler(),l.E.ins.on(h.EventName.MONEY_REWARD_DATA_UPDATED,this,this.updateUI),this.isPopup||this.popup()},t.prototype.updateState=function(t){if(this._state=0,t.subscribeDay<t.day)this._state=1;else if(t.subscribeDay>=t.day)if(t.status==a.enumStatus.weiwancheng)this._state=2;else if(t.status==a.enumStatus.kelingqu)this._state=3;else{if(t.subscribeDay<t.day+1)p.GameConfig.moneyRewardVoCfg[t.day+1]&&(this._state=4);else this._state=5}},t.prototype.updateUI=function(){var t=s.RoleCenter.instans.vo.moneyRewardData;if(t){this.updateState(t),this.btn_enter.visible=!0,this.btn_enter.disabled=!1,1==this._state?this.btn_enter.label=g.TextConst.get(625):2==this._state?this.btn_enter.label=g.TextConst.get(626):3==this._state?this.btn_enter.label=g.TextConst.get(204):4==this._state?this.btn_enter.label=g.TextConst.get(627):5==this._state?(this.btn_enter.label=g.TextConst.get(623),this.btn_enter.disabled=!0):this.btn_enter.visible=!1;var e=p.GameConfig.moneyRewardVoCfg[t.day+1];this.box_org_cost.visible=4==this._state,this.box_cost.visible=1==this._state||4==this._state,1==this._state?this.box_cost.x=193:4==this._state&&(this.box_cost.x=293),this.box_cd.visible=4==this._state,4<this._state&&e?this.img_pic.skin="dynamic/moneyreward/"+(t.day+1)+".jpg":this.img_pic.skin="dynamic/moneyreward/"+t.day+".jpg",this.btn_enter.visible=0<this._state,this.htxt_desc.visible=0<this._state&&this._state<4,this.img_next_desc.visible=3<this._state,this.img_killed.visible=!1,2<this._state&&this._state<=4&&(this.img_killed.visible=!0,0==this._played&&(this._played=!0,this.img_killed.scale(5,5),Laya.timer.once(300,this,this.playKill)));var i=p.GameConfig.moneyRewardVoCfg[t.day];if(i){if(this._state<=4?(this.box_item.array=i.rewardUI,this.box_item.visible=!0,this.list_wenhao.visible=!1):(this.box_item.visible=!1,this.list_wenhao.visible=!0),this._state<4){var n=Math.min(t.value,i.need);this.htxt_desc.innerHTML=i.desc+"("+n+"/"+i.need+")"}1==this._state&&this.lab_cost.changeText(i.cost.toString())}4==this._state&&e&&(this.lab_cost.changeText(e.cost1.toString()),this.lab_org_cost.changeText(e.cost.toString()))}},t.prototype.playKill=function(){Laya.Tween.to(this.img_killed,{scaleX:1,scaleY:1},80,Laya.Ease.quadIn)},t.prototype.cooldownHandler=function(){var t,e=this.nextTime-u.ServerTime.serverTime;if(0<e)t=c.DateUtil.getHMS_countdown(e),this.lab_time.changeText(t),this.box_cd.visible&&this.lab_cd.changeText("("+t+")");else{this.nextTime=c.DateUtil.getZeroBySecond(u.ServerTime.serverTime);var i=c.DateUtil.getHMS_countdown(0);this.lab_time.changeText(i),this.box_cd.visible&&this.lab_cd.changeText("("+i+")")}Laya.timer.once(1e3,this,this.cooldownHandler)},t}(ui.moneyreward.MoneyRewardDlgUI);e.MoneyRewardDlg=v}),define("src/g/moneyreward/ctrl/MoneyRewardCtrl",["require","exports","src/init/Switches","src/g/moneyreward/view/MoneyRewardDlg","../../../manager/GameSocketManager","../../net/messages/sbkMoneyRewardData","../../../manager/RoleCenter","../../../core/E","../../../enum/EventName"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function t(){i.Switches.ins.on(218,this,this.onOpenIdHandler,[218]),s.GSM.ins.on(o.sbkMoneyRewardData.KEY,this,this.onDataUpdateHandler)}return t.prototype.onOpenIdHandler=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1),e&&this.onOpenHandler(t,i,n)},t.prototype.onOpenHandler=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this._view||(this._view=new n.MoneyRewardDlg),this._view.showView()},t.prototype.onDataUpdateHandler=function(t){a.RoleCenter.instans.vo.moneyRewardData?a.RoleCenter.instans.vo.moneyRewardData.copydata(t):a.RoleCenter.instans.vo.moneyRewardData=t,r.E.ins.event(l.EventName.MONEY_REWARD_DATA_UPDATED)},t}();e.MoneyRewardCtrl=h}),define("src/init/ChannelTimer",["require","exports","../manager/RoleCenter"],function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){t._ins=this}return Object.defineProperty(t,"ins",{get:function(){return t._ins||new t},enumerable:!0,configurable:!0}),t.prototype.checkTimer=function(){this.checkPush()},t.prototype.checkPush=function(){if(window.plus){var t=o.RoleCenter.instans.vo,e=utils.LocalUtil.getAnyLocal("LocalPushTimes")||{firstLoginTIme:0,pushTargetTime:0},i=t.lastloginTime,n=(new Date).getTime()/1e3>>0;if(0==e.firstLoginTIme||e.firstLoginTIme>=e.pushTargetTime||0==i||86400<n-i)e.firstLoginTIme=n,e.pushTargetTime=n+86400,this.createPush(86400);else{var s=e.pushTargetTime-e.firstLoginTIme;this.createPush(s)}utils.LocalUtil.setAnyLocal("LocalPushTimes",e)}},t.prototype.createPush=function(t){},t._ins=null,t}();e.ChannelTimer=i}),define("src/g/account/view/Tips_openSz",["require","exports","../../../manager/RoleCenter","src/g/clearRes/ClearResM","../../../config/GameConfig","../../../enum/FashionPos","src/init/Switches","../../../utils/RoleUtil"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t._tryId=0,t.img_title.restskin(),t.goto.on(Laya.Event.CLICK,t,t.gotoHandler),t.on(Laya.Event.UNDISPLAY,t,t.unDisplay),t}return __extends(t,e),t.prototype.unDisplay=function(){n.ClearResM.clearUrl(this.img_title.skin)},t.prototype.gotoHandler=function(t){var e=this._tryId,i=s.GameConfig.fashionJson[e],n=0;i&&(i.position==o.FashionPos.WING?n=62:i.position==o.FashionPos.WEAPON?n=61:i.position==o.FashionPos.FASHION&&(n=60)),0!=n&&a.Switches.ins.event(n,e),this.close()},t.prototype.refreshAni=function(){var t=s.GameConfig.fashionJson[this._tryId],e=i.RoleCenter.instans.vo.getOpenHeroByIdx(0);r.RoleUtil.refreshZww(e,100,this.role_show.wing,this.role_show.weapon,this.role_show.role,this.role_show.ani_fumo,t)},t}(ui.account.Tips_openSzUI);e.Tips_openSz=l}),define("src/g/account/ctrl/OpenTipsCtrl",["require","exports","../../../core/E","../../../enum/EventName","../../../utils/ItemUtils","../../../enum/BagItemType","src/g/account/view/Tips_openSz","src/g/clearRes/ClearResM","../../../manager/RoleCenter","../../net/messages/OpResultType","../../../config/GameConfig","src/g/account/view/Tips_openSkill","../../../manager/GameSocketManager","../../net/messages/sbkPetData","../../net/messages/sbkPhantomData"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(){function t(){i.E.ins.on(n.EventName.CHANGEITEM_COUNT,this,this.onChangeItem);var t=l.RoleCenter.instans;t.on(h.enumOpResultType.longWen+"",this,this.longWenHandler),t.on(h.enumOpResultType.longLin+"",this,this.longLinHandler),t.on(h.enumOpResultType.longWen_all+"",this,this.longWenHandler),t.on(h.enumOpResultType.longLin_all+"",this,this.longLinHandler),t.on(h.enumOpResultType.PromoteWing_uselevelItem+"",this,this.wingHandler),t.on(h.enumOpResultType.PromoteWing_starPromote+"",this,this.wingHandler),t.on(h.enumOpResultType.JingmaiStage+"",this,this.onJingMaiStage),p.GSM.ins.on(g.PhantomLvMSG.KEY,this,this.hlUp),p.GSM.ins.on(d.FeedPetGS2C.KEY,this,this.feedPetGS2C)}return t.prototype.feedPetGS2C=function(t){var e=t.petid;if(l.RoleCenter.instans.vo.petData.petid<e){var i=c.GameConfig.godpet[e].skill;0<i&&this.showDlg([i])}},t.prototype.hlUp=function(t){if(!l.RoleCenter.instans.vo.newbee)for(var e=l.RoleCenter.instans.self.phData.phLv,i=t.phLv-e,n=0;n<i;n++)this.showSkill(e+n+1,33)},t.prototype.wingHandler=function(t){var e=t.reservedata[3];l.RoleCenter.instans.vo.getOpenHeroByIdx(t.reservedata[0]).heroWing.level!=e&&this.showSkill(e,4)},t.prototype.onJingMaiStage=function(t){var e=t.reservedata[1];this.showSkill(e,3)},t.prototype.longWenHandler=function(t){for(var e=l.RoleCenter.instans.vo,i=t.reservedata[1],n=e.getOpenHeroByIdx(t.reservedata[0]).longwenID,s=i-n,o=0;o<s;o++)this.showSkill(n+o+1,2)},t.prototype.longLinHandler=function(t){for(var e=l.RoleCenter.instans.vo,i=t.reservedata[1],n=e.getOpenHeroByIdx(t.reservedata[0]).longlinID,s=i-n,o=0;o<s;o++)this.showSkill(n+o+1,1)},t.prototype.showSkill=function(t,e){var i=c.GameConfig.skillOpen[e+"_"+t];i&&this.showDlg([i.skillId])},t.prototype.showDlg=function(t){var e=new u.Tips_openSkill;e.openList.array=t,e.popup()},t.prototype.onChangeItem=function(t,e){var i=s.ItemUtils.getItemVoById(t);if(i&&i.type==o.BagItemType.shizhuang&&0<e){var n=new a.Tips_openSz;r.ClearResM.addBgUrl(n.bg_l.skin),n.lab_name.color=s.ItemUtils.getColorByQuality(i.quality),n.lab_name.text=i.name,n._tryId=t,n.refreshAni(),n.popup()}},t}();e.OpenTipsCtrl=v}),define("src/g/account/view/SeekHelpDlg",["require","exports","../../net/messages/TeamMsg","../../../manager/GameSocketManager","../../net/messages/HelpFightMsg","../../../manager/RoleCenter","../../../config/GameConfig","src/init/TextConst","../../../utils/ItemUtils","../../../plugin/view/ToolTip","../../../utils/system/FloatEffect","src/g/fight/osprite/play/team/TeamManager"],function(t,e,a,o,r,l,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(s){function n(t){var e=s.call(this)||this;e.isExit=!0,e.selfUn=l.RoleCenter.instans.vo.username;var i=e.lab_count.style;i.align="center",i.font="SimHei",i.color="#e3cca9",i.fontSize=20,e.on(Laya.Event.UNDISPLAY,e,e.unDisplay),e.btn_hand.on(Laya.Event.CLICK,e,e.teamHandler);for(var n=0;n<2;n++)e["item"+n].getChildByName("btn_close").on(Laya.Event.CLICK,e,e.qiangT);return e.setData(t),e}return __extends(n,s),n.prototype.setData=function(t){if(t){this.isExit=!0;var e=o.GSM.ins;e.on(r.HelpFightMsgGS2C.KEY,this,this.newTeamUpdate),e.on(a.DismissTeamGS2C.KEY,this,this.dismissTeam),e.on(a.ExitTeamGS2C.KEY,this,this.exitTeam),e.on(a.JoinTeamGS2C.KEY,this,this.joinTeam),e.on(r.HelpFightStartGS2C.KEY,this,this.startFight);var i=t.captain.username==this.selfUn,n=!0;i||(n=!1),this.btn_send.visible=n,this.lab_time.visible=n,this.teamState=t.teamState,this.isSelfCreate=i,this.updateAll(t)}},n.prototype.startFight=function(t){t.teamType==a.enumTeamType.helpFight&&(this.isExit=!1,this.close())},n.prototype.qiangT=function(t){var e=this.teamData,i=e.captain,n=t.currentTarget==this.item0?i:e.member[0];if(n.username!=i.username){var s=new a.ExitTeamC2GS;s.teamUid=e.teamUid,s.username=n.username,o.GSM.sendServer(s)}},n.prototype.joinTeam=function(t){var e=t.teamUid,i=this.teamData;i.teamType==a.enumTeamType.helpFight&&t.opres&&i.teamUid==e&&(i=t.teamStateData,this.updateAll(i))},n.prototype.exitTeam=function(t){var e=t.teamUid,i=this.teamData,n=g.TeamManager.getTeamFightMsg(e);if(n&&n.teamType==a.enumTeamType.helpFight&&t.opres&&i.teamUid==e){if(t.uname==this.selfUn)return d.FE.upItems(c.TextConst.get(1001),p.BubbleEnum.center),this.isExit=!1,void this.close();for(var s=i.member,o=s.length-1;0<=o;o--)s[o].username==t.uname&&s.splice(o,1);this.updateAll(i)}},n.prototype.dismissTeam=function(t){var e=this.teamData,i=t.teamUid,n=g.TeamManager.getTeamFightMsg(i);n&&n.teamType==a.enumTeamType.helpFight&&t.opres&&e.teamUid==i&&(this.isExit=!1,this.close())},n.prototype.teamHandler=function(){var t=this.teamState;this.isSelfCreate?t==a.enumTeamState.readyJoin?this.close():t==a.enumTeamState.fullTeam&&o.GSM.sendServer(new r.HelpFightStartC2GS):this.close()},n.prototype.updateAll=function(t){this.teamData=t,this.teamState=t.teamState,this.updateTime(),this.updateView()},n.prototype.updateView=function(){var t=this.teamData,e=this.teamState,i=this.isSelfCreate,n="";i?e==a.enumTeamState.readyJoin?n=c.TextConst.get(327):e==a.enumTeamState.fullTeam&&(n=c.TextConst.get(341)):n=c.TextConst.get(202),this.btn_hand.label=n,this.updateInfo(this.item0,t.captain,!0),this.updateInfo(this.item1,t.member[0]);var s=l.RoleCenter.instans.vo.portstatus.hfData;this.lab_count.innerHTML=i?c.TextConst.get(995,s.HELPFIGHT_ME):c.TextConst.get(996,s.HELPFIGHT_OTHER)},n.prototype.updateInfo=function(t,e,i){void 0===i&&(i=!1);var n=t.getChildByName("btn_close"),s=t.getChildByName("img_head"),o=t.getChildByName("img_headNull"),a=t.getChildByName("lab_name"),r=t.getChildByName("lab_power");if(!e)return s.visible=!1,n.visible=!1,o.visible=!0,a.text="",void(r.text="");s.visible=!0,o.visible=!1,n.visible=!i&&!(e.username==this.selfUn),a.text=e.nickname,s.skin=u.ItemUtils.getHeadurlYuan(e.sex,e.job),r.text=c.TextConst.get(80,e.combat)},n.prototype.newTeamUpdate=function(t){if(t.teamType==a.enumTeamType.helpFight){var e=t.teamState,i=this.teamData;i&&e&&i.teamUid==e.teamUid&&this.updateAll(e)}},n.prototype.updateTime=function(){var t=this.isSelfCreate;if(!this.isTime&&t){var e=0,i=0;if(t&&(e=Date.now()),0!=(n.lastTime=e))this.isTime=!0,i=1e3*+h.GameConfig.commonJson.callforhelp.value+e;n.nextTime=i,Laya.timer.clear(this,this.loopHandler),0!=e&&(this.loopHandler(),this.btn_send.disabled=!0,Laya.timer.loop(1e3,this,this.loopHandler))}},n.prototype.loopHandler=function(){var t=Date.now(),e=n.nextTime,i="";e<=t?(Laya.timer.clear(this,this.loopHandler),this.btn_send.disabled=!1):i="("+Math.floor((e-t)/1e3)+")",this.lab_time.text=i},n.prototype.unDisplay=function(){var t=this.teamData;if(t){if(this.teamData=null,this.isExit){var e=new a.ExitTeamC2GS;e.teamUid=t.teamUid,e.username=this.selfUn,o.GSM.sendServer(e)}var i=o.GSM.ins;i.off(r.HelpFightMsgGS2C.KEY,this,this.newTeamUpdate),i.off(a.DismissTeamGS2C.KEY,this,this.dismissTeam),i.off(a.ExitTeamGS2C.KEY,this,this.exitTeam),i.off(a.JoinTeamGS2C.KEY,this,this.joinTeam),i.off(r.HelpFightStartGS2C.KEY,this,this.startFight)}},n.prototype.close=function(t,e){"side"!=t&&s.prototype.close.call(this,t,e)},n}(ui.account.SeekHelpDlgUI);e.SeekHelpDlg=i}),define("src/g/account/ctrl/SeekHelpCtrl",["require","exports","../../../manager/GameSocketManager","../../net/messages/TeamMsg","../../../plugin/view/ToolTip","../../../utils/system/FloatEffect","src/g/account/view/SeekHelpDlg","../../net/messages/HelpFightMsg","../../../enum/EventName","../../../core/E","../../net/messages/chat/ChatC2GS","../../net/messages/chat/ChatGS2C","../../../utils/ItemUtils","../../../utils/StringUtils","src/g/fight/osprite/play/team/TeamManager","src/g/fight/info/PlayTypeVo","../../net/messages/ChangeSceneMsg","../../../manager/RoleCenter","../../../core/GNet","src/init/TextConst","src/init/GameState"],function(t,e,n,u,s,o,i,a,p,d,g,v,r,f,l,h,c,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var I=function(){function t(){this.seekChat=[];var t=n.GSM.ins;t.on(u.CreateTeamGS2C.KEY,this,this.createTeam),t.on(u.TeamStateChgGS2C.KEY,this,this.teamStateChange),t.on(a.HelpFightMsgGS2C.KEY,this,this.newTeamUpdate),t.on(u.DismissTeamGS2C.KEY,this,this.dismissTeam),t.on(u.ExitTeamGS2C.KEY,this,this.exitTeam),t.on(u.JoinTeamGS2C.KEY,this,this.joinTeam),t.on(a.HelpFightStartGS2C.KEY,this,this.startFight),d.E.ins.on(p.EventName.OTHERDATA_UPDATE,this,this.memberHandler),d.E.ins.on(p.EventName.GAME_RESTART,this,this.onGameReStart)}return t.prototype.onGameReStart=function(){if(0<C.GameState.my_team_uid){var t=new u.ExitTeamC2GS;t.teamUid=C.GameState.my_team_uid,t.username=y.RoleCenter.instans.vo.username,n.GSM.sendServer(t),C.GameState.my_team_uid=0}},t.prototype.showDlg=function(t){var e=this.dlg;return e||(this.dlg=e=new i.SeekHelpDlg,e.btn_send.on(Laya.Event.CLICK,this,this.hanhua)),e.setData(t),e.isPopup||e.popup(),e},t.prototype.hanhua=function(){var t=this.dlg;if(t){var e=t.teamData;if(e){if(0<e.member.length)return void o.FE.upItems(_.TextConst.get(998),s.BubbleEnum.center);this.removeChat(e);var i=new a.HelpFigthChatC2GS;i.teamType=u.enumTeamType.helpFight,n.GSM.sendServer(i),t.isTime=!1}}},t.prototype.memberHandler=function(){var t=this.startMsg;if(t){var e=l.TeamManager.getMemberUn(t);if(e)y.RoleCenter.instans.getOtherData(e)&&(this.startMsg=null,d.E.ins.event(p.EventName.PLAY_TYPE_CHANGE,h.PlayTypeVo.create(c.EPlayType.PLAYTYPE_HELPFIGHT,t)))}},t.prototype.startFight=function(t){if(t.opres&&t.teamType==u.enumTeamType.helpFight){this.startMsg=t;var e=this.dlg;e&&(e.isExit=!1),m.GNet.getOtherData([l.TeamManager.getMemberUn(t)])}},t.prototype.joinTeam=function(t){if(t.opres){var e=t.teamStateData;l.TeamManager.updateTeamState(t.teamUid,e),d.E.ins.event(p.EventName.JOIN_TEAM,[t.teamUid,e.teamType]),e.teamType==u.enumTeamType.helpFight&&this.showDlg(e)}else o.FE.upItems(""+t.errcode)},t.prototype.teamStateChange=function(t){var e=t.teamUid,i=l.TeamManager.updateTeamState(e,t.teamState);i&&(d.E.ins.event(p.EventName.TEAM_STATE_CHANGED,[t.teamUid,i.teamType]),i.teamType==u.enumTeamType.helpFight&&this.showChat(i))},t.prototype.exitTeam=function(t){var e=t.teamUid;if(t.opres){var i=l.TeamManager.updateTeamState(e,t);i&&(t.uname==i.captain.username?d.E.ins.event(p.EventName.DISMISS_TEAM,[e,i.teamType]):d.E.ins.event(p.EventName.EXIT_TEAM,[e,i.teamType]),i.teamType==u.enumTeamType.helpFight&&this.showChat(i))}else o.FE.upItems(""+t.errcode)},t.prototype.dismissTeam=function(t){var e=t.teamUid;if(t.opres){var i=l.TeamManager.updateTeamState(e,u.enumTeamState.dismiss);i&&(d.E.ins.event(p.EventName.DISMISS_TEAM,[t.teamUid,i.teamType]),i.teamType==u.enumTeamType.helpFight&&this.showChat(i))}else o.FE.upItems(""+t.errcode)},t.prototype.newTeamUpdate=function(t){var e=t.teamState,i=e.teamUid,n=l.TeamManager.getTeamFightMsg(i),s=!1;n&&n.teamState.teamState==e.teamState&&n.teamType==u.enumTeamType.helpFight&&(s=!0),s&&this.removeChat(n.teamState),l.TeamManager.updateTeamState(i,t),d.E.ins.event(p.EventName.TEAM_DATA_CHANGED,[e.teamUid,e.teamType]),e&&e.teamType==u.enumTeamType.helpFight&&this.showChat(e)},t.prototype.showChat=function(t){var e=this.getVo(t),i=t.teamState;if(e){var n=e.text,s=e.addtext,o=n+f.StringUtils.replaceDymaicParam(s,""+t.teamUid),a=n+f.StringUtils.replaceDymaicParam(s.replace(s.replace(/<\s*span[^>]*>(.*?)<\s*\/\s*span>/g,"$1"),""),""+t.teamUid),r=a,l=t.captain,h=this.seekChat,c=new v.ChatGS2C;c.job=l.job,c.sex=l.sex,c.nickname=l.nickname,c.username=l.username,c.type=g.enumChatType.world,i!=u.enumTeamState.readyJoin?o=n+f.StringUtils.replaceDymaicParam(s,""+t.teamUid):-1==h.indexOf(o)?r="":(r=o,o=a),-1==h.indexOf(o)&&h.push(o),c.msg=o,d.E.ins.event(p.EventName.SEND_UNREAL_CHAT,[c,r])}},t.prototype.removeChat=function(t){var e=this.getVo(t);if(e){var i=e.text,n=e.addtext,s=i+f.StringUtils.replaceDymaicParam(n,""+t.teamUid),o=this.seekChat,a=o.indexOf(s);-1!=a&&o.splice(a,1)}},t.prototype.getVo=function(t){var e=0;return t.teamType==u.enumTeamType.helpFight&&(e=207),r.ItemUtils.getNoticeById(e)},t.prototype.createTeam=function(t){if(t.opres){var e=t.teamStateData;if(l.TeamManager.updateTeamState(e.teamUid,t),d.E.ins.event(p.EventName.CREATE_TEAM,[e.teamUid,e.teamType]),e.teamType==u.enumTeamType.helpFight){var i=this.dlg;i&&(i.isTime=!1),this.showDlg(e)}}else o.FE.upItems(""+t.errcode,s.BubbleEnum.center)},t}();e.SeekHelpCtrl=I}),define("src/g/timelimittask/ctrl/TimeLimitTaskUtil",["require","exports","../../../manager/RoleCenter","../../../config/GameConfig","../../../utils/system/ServerTime","../../net/messages/enumStatus"],function(t,e,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.checkTaskRed=function(t){var e=a.RoleCenter.instans.vo.timeLimitTaskData;if(e)for(var i,n=e.dataArr.length,s=0;s<n;){i=e.dataArr[s];var o=r.GameConfig.timeLimitTaskJson[i.id];if(o&&o.type==t&&i.endTime>l.ServerTime.serverTime&&-1!=i.curStatusArr.indexOf(h.enumStatus.kelingqu))return!0;s++}return!1},t.findOpenTaskId=function(t){for(var e,i=a.RoleCenter.instans.vo.timeLimitTaskData,n=i.dataArr.length,s=0;s<n;){e=i.dataArr[s];var o=r.GameConfig.timeLimitTaskJson[e.id];if(o&&o.type==t&&e.endTime>l.ServerTime.serverTime)return e.id;s++}return 0},t}();e.TimeLimitTaskUtil=i}),define("src/g/timelimittask/view/HtTaskPage",["require","exports","../../../core/E","../../../enum/EventName","../../../config/GameConfig","../../net/messages/TimeLimitTaskMsg","../../../manager/GameSocketManager","../../../manager/RoleCenter","src/g/clearRes/ClearResM","../../net/messages/enumStatus","src/g/Effects/UIEffectsFactory","src/init/TextConst","../../../meta/MainButtonVo","../../../utils/RoleUtil","src/g/timelimittask/ctrl/TimeLimitTaskUtil","../../../component/Type4TipView"],function(t,e,n,s,l,o,a,r,h,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(t){var e=i.call(this)||this;return e._closeViewHandler=t,e.list_task.renderHandler=new Laya.Handler(e,e.onRenderListHandler),n.E.ins.on(s.EventName.TIME_LIMIT_TASK_DATA_CHANGED,e,e.onDataChangedHandler),e.box_bg.scrollRect=new Laya.Rectangle(0,0,e.box_bg.width,e.box_bg.height),e}return __extends(t,i),t.prototype.toActiveHandler=function(){var t=v.TimeLimitTaskUtil.findOpenTaskId(3);if(this._taskId!=t){var e=l.GameConfig.timeLimitTaskJson[this._taskId];f.Type4TipView.showHeTi(3900,Number(e.image)),t?this.showTask(t):this._closeViewHandler&&this._closeViewHandler.run()}},t.prototype.onDataChangedHandler=function(t){!this.displayedInStage||t!=this._taskId&&t||this.refreshData()},t.prototype.showTask=function(t){this._taskId=t,this._tltd=r.RoleCenter.instans.vo.getTLTDataById(this._taskId),this.updateImage(),this.updateRoleShow(),this.refreshData(),n.E.ins.on(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.updateImage=function(){var t=l.GameConfig.timeLimitTaskJson[this._taskId];this.img_skill_name.skin="res/ht_task/heti_wenzi_00"+t.descImage+".png",this.img_desc.skin="res/ht_task/heti_wenzi_di00"+t.descImage+".png",this.img_skill_icon.skin="res/index1/heiti_jineng_00"+t.descImage+".png",this.lab_desc.changeText(p.TextConst.get(1011+Number(t.descImage)))},t.prototype.updateRoleShow=function(){var t=l.GameConfig.timeLimitTaskJson[this._taskId];g.RoleUtil.refreshZww(r.RoleCenter.instans.vo.getOpenHeroByIdx(0),100,this.role_show.wing,this.role_show.weapon,this.role_show.role,this.role_show.ani_fumo,null,!0,3900,Number(t.image))},t.prototype.closeClearRes=function(){n.E.ins.off(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),h.ClearResM.clearFolderByUrl("dynamic/taskicon/")},t.prototype.refreshData=function(){for(var t=l.GameConfig.timeLimitTaskJson[this._taskId],e=t.child.length,i=0,n=[],s=0;i<e;)this._tltd.curStatusArr[i]==c.enumStatus.yilingqu&&s++,n.push(t.child[i]),i++;this._uEf&&(this._uEf.offAll(),this._uEf.clear(),this._uEf=null),this._uEf2&&(this._uEf2.clear(),this._uEf2=null),e<=s?(this.font_progress.visible=!1,this.img_dianji.visible=!0,this._uEf=u.UIEffectsFactory.Ins.createSAniById(24),u.UIEffectsFactory.Ins.centerSAni4Parent(this._uEf,this.con_effect),this._uEf.on(Laya.Event.CLICK,this,this.toActiveHandler),this._uEf2=u.UIEffectsFactory.Ins.createSAniById(150),u.UIEffectsFactory.Ins.centerSAni4Parent(this._uEf2,this.con_effect)):(this.font_progress.visible=!0,this.img_dianji.visible=!1),this.list_task.array=n,this.progress_mask.y=(1-s/e)*this.progress_mask.height,this.font_progress.value=Math.floor(s/e*100)+"%"},t.prototype.compareFn=function(t,e){var i=l.GameConfig.timeLimitTaskJson[this._taskId],n=r.RoleCenter.instans.vo.getTLTDataById(this._taskId),s=i.child.indexOf(t);n.curStatusArr[s]==c.enumStatus.weiwancheng&&(s+=100),n.curStatusArr[s]==c.enumStatus.yilingqu&&(s+=200);var o=i.child.indexOf(e);return n.curStatusArr[o]==c.enumStatus.weiwancheng&&(o+=100),n.curStatusArr[o]==c.enumStatus.yilingqu&&(o+=200),s-o},t.prototype.onRenderListHandler=function(t,e){t.btn_get.left=e%2==0?(t.img_complet.right=NaN,t.img_complet.left=11,t.lab_complet.right=NaN,t.lab_complet.left=79,t.lab_name.right=NaN,t.lab_name.left=81,t.lab_name.align="left",t.lab_progress.right=NaN,t.lab_progress.left=81,t.lab_progress.align="left",t.btn_get.right=NaN,151):(t.img_complet.right=11,t.img_complet.left=NaN,t.lab_complet.right=79,t.lab_complet.left=NaN,t.lab_name.right=81,t.lab_name.left=NaN,t.lab_name.align="right",t.lab_progress.right=81,t.lab_progress.left=NaN,t.lab_progress.align="right",t.btn_get.right=151,NaN);var i=t.dataSource,n=l.GameConfig.timeLimitTaskJson[this._taskId],s=l.GameConfig.timeLimitSubTaskJson[i],o=n.child.indexOf(i),a=this._tltd.statusArr[o],r=s.need;s.isNoCountType()&&(a=a<r?0:1,r=1),a=s.transfer(a),(r=s.transfer(r))<a&&(a=r),t.lab_name.changeText(s.res),t.lab_progress.changeText(a+"/"+r),t.btn_get.offAll(),t.btn_get.visible=!1,t.lab_complet.visible=!1,t.img_red.visible=this._tltd.curStatusArr[o]==c.enumStatus.kelingqu,r<=a?(t.img_complet.skin="res/ht_task/heti_baoshi_001.png",this._tltd.curStatusArr[o]==c.enumStatus.yilingqu?(t.lab_complet.visible=!0,t.lab_progress.visible=!1):(t.btn_get.label=p.TextConst.get(204),t.btn_get.visible=!0,t.btn_get.on(Laya.Event.CLICK,this,this.toGetReward,[i]))):(t.img_complet.skin="res/ht_task/heti_baoshi_002.png",s.moduleID&&0<s.moduleID.length&&(t.btn_get.label=p.TextConst.get(200),t.btn_get.on(Laya.Event.CLICK,this,this.gotoOp,[s]),t.btn_get.visible=!0))},t.prototype.gotoOp=function(t){t.moduleID&&0<t.moduleID.length&&d.MainButtonStruct.Ins.OpenModule(t.moduleID[0][1],t.moduleID[1][1])},t.prototype.toGetReward=function(t){if(this._tltd){var e=l.GameConfig.timeLimitTaskJson[this._taskId].child.indexOf(t);if(this._tltd.curStatusArr[e]==c.enumStatus.kelingqu){var i=new o.TimeLimitTaskGetMsg;i.taskId=this._taskId,i.taskChildId=t,a.GSM.sendServer(i)}}},t}(ui.ht_task.HTTaskPageUI);e.HtTaskPage=i}),define("src/g/timelimittask/view/HtTaskView",["require","exports","../../../manager/LayerManager","src/g/clearRes/ClearResM","src/g/timelimittask/view/HtTaskPage"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.btn_back.on(Laya.Event.CLICK,t,t.onCloseHandler),t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t}return __extends(t,e),t.prototype.showTask=function(t){this._currPage||(this._currPage=new s.HtTaskPage(new Laya.Handler(this,this.onCloseHandler)),this.con_page.addChild(this._currPage)),this._currPage.showTask(t),i.LayerManager.addInPOPWindowLayer(this),n.ClearResM.resetViewImg(this)},t.prototype.onCloseHandler=function(){this.removeSelf()},t}(ui.ht_task.HTTaskViewUI);e.HtTaskView=o}),define("src/g/timelimittask/ctrl/HtTaskViewCtrl",["require","exports","src/g/accessctrl/AccessCenter","src/init/Switches","../../../core/E","../../../enum/EventName","../../../config/GameConfig","../../../manager/NewRedHintsCenter","src/g/timelimittask/ctrl/TimeLimitTaskUtil","../../../utils/system/FloatEffect","src/init/TextConst","../../../plugin/view/ToolTip","../../../manager/RoleCenter","src/g/timelimittask/view/HtTaskView","../../../utils/system/ServerTime","../../../runtime/resload/GameResLoad"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(){function t(){this.taskType=3,this.accessId=234,n.Switches.ins.on(this.accessId,this,this.onOpenHandler),s.E.ins.on(o.EventName.TIME_LIMIT_TASK_DELETE,this,this.onTaskChanaged),s.E.ins.on(o.EventName.TIME_LIMIT_TASK_DATA_CHANGED,this,this.onTaskChanaged),s.E.ins.on(o.EventName.TIME_LIMIT_TASK_INITED,this,this.checkRed),i.AccessCenter.ins.checkOpen(this.accessId)||i.AccessCenter.ins.on(this.accessId,this,this.openAccess)}return t.prototype.openAccess=function(){i.AccessCenter.ins.checkOpen(this.accessId)&&i.AccessCenter.ins.off(this.accessId,this,this.openAccess),this.checkRed()},t.prototype.onTaskChanaged=function(t){var e=a.GameConfig.timeLimitTaskJson[t];e&&e.type==this.taskType&&this.checkRed()},t.prototype.checkRed=function(){i.AccessCenter.ins.checkOpen(this.accessId)&&r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.ht_task,l.TimeLimitTaskUtil.checkTaskRed(this.taskType)),r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.ht_task,!1)},t.prototype.onOpenHandler=function(t,e){t&&this.openTaskPanelHandler(e)},t.prototype.openTaskPanelHandler=function(t){if(p.RoleCenter.instans.vo.timeLimitTaskData){null==t&&(t=l.TimeLimitTaskUtil.findOpenTaskId(this.taskType));var e=p.RoleCenter.instans.vo.getTLTDataById(t);e&&e.endTime>g.ServerTime.serverTime?(this._view||(v.GameResLoad.load("res/atlas/res/ht_task.json"),this._view=new d.HtTaskView),this._view.showTask(t)):h.FE.upItems(c.TextConst.get(455),u.BubbleEnum.center)}else h.FE.upItems(c.TextConst.get(769),u.BubbleEnum.center)},t}();e.HtTaskViewCtrl=f}),define("src/g/hteffect/ctrl/HtEffectCtrl",["require","exports","../../../core/E","../../../enum/EventName"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){i.E.ins.on(n.EventName.HETI_EFFECT_SHOW,this,this.showAni)}return t.prototype.showAni=function(t){t&&(this.stopAni(),this.di||(this.di=new Laya.Image),this.di.skin="res/ht_effect/beijign_di_00"+t+".png",this.di.x=-600,Laya.stage.addChild(this.di),Laya.Tween.to(this.di,{x:(Laya.stage.width-600)/2},150,Laya.Ease.circIn),this.ren||(this.ren=new Laya.Image),this.ren.skin="res/ht_effect/beijign_ren_00"+t+".png",this.ren.x=-600,Laya.stage.addChild(this.ren),Laya.Tween.to(this.ren,{x:(Laya.stage.width-600)/2},150,Laya.Ease.circIn,null,150),this.zi||(this.zi=new Laya.Image),this.zi.skin="res/ht_effect/beijign_zi_00"+t+".png",this.zi.x=Laya.stage.width,Laya.stage.addChild(this.zi),Laya.Tween.to(this.zi,{x:(Laya.stage.width-600)/2+100},150,Laya.Ease.circIn,null,200),Laya.timer.once(2e3,this,this.stopAni),i.E.ins.on(n.EventName.PLAY_TYPE_CHANGED,this,this.stopAni))},t.prototype.stopAni=function(){i.E.ins.off(n.EventName.PLAY_TYPE_CHANGED,this,this.stopAni),Laya.timer.clear(this,this.stopAni),this.di&&(this.di.removeSelf(),Laya.Tween.clearAll(this.di)),this.ren&&(this.ren.removeSelf(),Laya.Tween.clearAll(this.ren)),this.zi&&(this.zi.removeSelf(),Laya.Tween.clearAll(this.zi))},t}();e.HtEffectCtrl=s}),define("src/g/role/view/RoleSsView",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.bg_view.btn_help.visible=!1,t}return __extends(t,e),t}(ui.role.Page_RoleSsUI);e.RoleSsView=i}),define("src/g/role/view/GetSsEXPDlg",["require","exports","../../../manager/GameSocketManager","../../../config/GameConfig","../../../manager/RoleCenter","../../../utils/ItemUtils","src/g/custom/detailDlgs/Details_Item","../../net/messages/OpResultType","../../net/messages/UseItemC2GS","src/g/Effects/UIEffectsFactory","src/init/Switches","../../../enum/EventName","../../../core/E","src/init/TextConst","../../../utils/UIUtils","../../../enum/LoadPriority","src/g/clearRes/ClearResM","../../net/messages/shenshi/sbkShenShiMsg"],function(t,e,s,a,o,r,i,l,h,c,u,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t.set=a.GameConfig.SSSetting,t.btnUpAni=null,t._showLevel=-1,t._showExp=-1,t._showTotalExp=-1,t._targetExp=-1,t._addExpSpeed=10;for(var e=0;e<3;e++)t["text_"+e].style.fontSize=20,t["text_"+e].style.font="SimHei",t["text_canget_"+e].style.fontSize=20,t["text_canget_"+e].style.font="SimHei",t["icon_"+e].on(Laya.Event.CLICK,t,t.onClickIcon,[e]),t["btn_"+e].on(Laya.Event.CLICK,t,t.onClickUseBtn,[e]);return t.canUseArr=t.set.exchangecount,t.uvo=o.RoleCenter.instans.vo,t.bg.imgInnerBg.bottom=90,t.btn_up.on(Laya.Event.CLICK,t,t.onUp),t.bg.btn_back.on(Laya.Event.CLICK,t,t.close),t.bg.btn_close.on(Laya.Event.CLICK,t,t.close),t.on(Laya.Event.UNDISPLAY,t,t.unDisplay),o.RoleCenter.instans.on(l.enumOpResultType.shenshi_downLv+"",t,t.onDownLv),o.RoleCenter.instans.on(l.enumOpResultType.shenshi_reset+"",t,t.reSetZS),d.E.ins.on(p.EventName.CHANGECURRENCY,t,t.onChangeCurrency),d.E.ins.on(p.EventName.USEITEMOVER,t,t.onUse),t}return __extends(t,n),t.prototype.unDisplay=function(){o.RoleCenter.instans.off(l.enumOpResultType.shenshi_downLv+"",this,this.onDownLv),o.RoleCenter.instans.off(l.enumOpResultType.shenshi_reset+"",this,this.reSetZS),d.E.ins.off(p.EventName.CHANGECURRENCY,this,this.onChangeCurrency),d.E.ins.off(p.EventName.USEITEMOVER,this,this.onUse)},t.prototype.popup=function(t,e){n.prototype.popup.call(this,t,e);var i="res/atlas/res/role/zhuansheng.json";Laya.loader.getRes(i)?this.onAtlasLoaded():v.UIUtils.loadAtlas(i,this,this.onAtlasLoaded,f.LoadPriority.UI)},t.prototype.onAtlasLoaded=function(){y.ClearResM.resetViewImg(this),this.refreshData()},t.prototype.reSetZS=function(t){t.opresult&&this.refreshData()},t.prototype.onDownLv=function(t){this.refreshData()},t.prototype.onUse=function(t){var e=this.uvo.SSCountArr;t.cfgId!=this.set.item1&&t.cfgId!=this.set.item2||(t.cfgId==this.set.item1?e[1]++:t.cfgId==this.set.item2&&e[2]++,this.refreshData())},t.prototype.onUp=function(){var t=a.GameConfig.SSLv[this.uvo.ssLv+1];if(t&&this.uvo.SSEXP>=t.cost[0][1]){var e=new m.sbkShenShiLvC2GS;e.msgidx=l.enumOpResultType.shenshi,s.GSM.sendServer(e)}},t.prototype.onChangeCurrency=function(t){"SSEXP"==t&&this.initExp()},t.prototype.onClickUseBtn=function(t){if(0==t)return(e=new m.sbkShenShiLvC2GS).msgidx=l.enumOpResultType.shenshi_downLv,void s.GSM.sendServer(e);if(0<this.uvo.bagdata.getItemCount(this.set["item"+t])){(e=new h.UseItemC2GS).cfgId=this.set["item"+t],e.count=1,s.GSM.sendServer(e)}else{var e=new h.BuyAndUseItemC2GS,i=r.ItemUtils.getShop2VoByItemId(this.set["item"+t]);if(o.RoleCenter.instans.vo.GOLD<i.cost[0][1])return u.Switches.ins.event(155),void this.close();e.cfgId=i.id,s.GSM.sendServer(e)}this["btn_"+t].disabled=!0},t.prototype.onClickIcon=function(t){var e=new i.Details_Item;0==t?e.initData_CurrencyVo(r.ItemUtils.getCurrencyVoByDefine(this.set.item0),this.expnum):e.initData(r.ItemUtils.getItemVoById(this.set["item"+t]),1,!1),e.popup()},t.prototype.refreshData=function(){this.setIcon(),this.setCanGetCount(),this.setAddText(),this.checkHave(),this.initExp()},t.prototype.setCanGetCount=function(){var t=this.uvo.SSCountArr;this.text_canget_0.innerHTML=this.getCanUse(this.canUseArr[0]-t[0]),this.text_canget_1.innerHTML=this.getCanUse(this.canUseArr[1]-t[1]),this.text_canget_2.innerHTML=this.getCanUse(this.canUseArr[2]-t[2])},t.prototype.setIcon=function(){this.icon_0.img_item.skin=r.ItemUtils.getIconByDefine(this.set.item0),this.icon_0.img_quality.skin=r.ItemUtils.getQualitybjByQualityId(r.ItemUtils.getCurrencyByDefine(this.set.item0).quality),this.icon_0.lab_num.visible=!1;for(var t=1;t<3;t++){var e=this["icon_"+t];e.img_item.skin=r.ItemUtils.getIconById(this.set["item"+t]),e.img_quality.skin=r.ItemUtils.getQualityBjById(this.set["item"+t]),e.lab_num.text=""}},t.prototype.checkHave=function(){for(var t=this.uvo.bagdata.getItemCount(this.set.item1),e=this.uvo.bagdata.getItemCount(this.set.item2),i=this.uvo.SSCountArr,n=0;n<3;n++){var s=!1;i[n]>=this.set.exchangecount[n]&&(s=!0),0==n&&a.GameConfig.commonJson.sslevelmin.value>this.uvo.lvl&&(s=!0),this["btn_"+n].disabled=s}if(0==this.btn_0.disabled){var o=this.ani_downLv.getChildByName("ani");o||((o=c.UIEffectsFactory.Ins.createUIAniById(42,!0)).height*=1.1,o.scaleY=1.1,o.width*=1.3,o.scaleX=1.3,o.name="ani",c.UIEffectsFactory.Ins.centered4Parent(o,this.ani_downLv,!0))}else this.ani_downLv.removeChildren();0<t&&(this.box_1.getChildByName("text_useCount").text=g.TextConst.get(727,t)),this.btn_1.label=0<t?g.TextConst.get(728):g.TextConst.get(729),this.box_1.getChildByName("box_show").visible=!(0<t),this.box_1.getChildByName("text_useCount").visible=0<t,this.red_item.visible=!this.btn_1.disabled&&0<t,0<e&&(this.box_2.getChildByName("text_useCount").text=g.TextConst.get(727,e)),this.btn_2.label=0<e?g.TextConst.get(728):g.TextConst.get(729),this.box_2.getChildByName("box_show").visible=!(0<e),this.box_2.getChildByName("text_useCount").visible=0<e,this.red_superItem.visible=!this.btn_2.disabled&&0<e},t.prototype.setAddText=function(){var t=a.GameConfig.commonJson.sslevelmin.value;this.lab_limit.text=g.TextConst.get(1040,t);var e=this.uvo.lvl-t;e=this.set.levelzsexp[e],this.btn_0.disabled=!1,(this.expnum=e)||(e=0,this.expnum=0,this.btn_0.disabled=!0),this.text_0.innerHTML=this.getAddText(e);var i=r.ItemUtils.getItemVoById(this.set.item1);this.text_1.innerHTML=this.getAddText(i.effect[0][1]),this.txt_item1.text=i.name,i=r.ItemUtils.getItemVoById(this.set.item2),this.text_2.innerHTML=this.getAddText(i.effect[0][1]),this.txt_item2.text=i.name},t.prototype.getAddText=function(t){return g.TextConst.get(1039,t)},t.prototype.getCanUse=function(t){return g.TextConst.get(731,0!=t?"#03bb00":"#ff0f15",t)},t.prototype.initExp=function(){var t=a.GameConfig.SSLv[this.uvo.ssLv],e=a.GameConfig.SSLv[this.uvo.ssLv+1];if(e&&this.uvo.SSEXP>=e.cost[0][1]?(this.btnUpAni||(this.btnUpAni=c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_up,42,2.5,1.5),this.btnUpAni.y+=5),this.btnUpAni.visible=!0):this.btnUpAni&&(this.btnUpAni.visible=!1),this.text_max.text=t.name,!e)return this.text_count.changeText(g.TextConst.get(208)),this.bar_count.width=374,this.box_lv.visible=!1,this.btn_up.disabled=!0,void(this.text_max.visible=!0);this.text_left.text=t.name,this.text_right.text=e.name,this.box_lv.visible=!0,this.text_max.visible=!1,Laya.timer.callLater(this,this.setExpPro)},t.prototype.setExpPro=function(){-1==this._showLevel&&-1==this._showExp?(this._showLevel=this.uvo.ssLv,this._showExp=this.uvo.SSEXP,this._showTotalExp=this.getLevelExp(this.uvo.ssLv),this.calculateAddSpeed(),this.updateExpProcess(this.uvo.SSEXP,this._showTotalExp)):(this.uvo.ssLv>this._showLevel?this._targetExp=this.getLevelExp(this._showLevel):this._targetExp=this.uvo.SSEXP,Laya.timer.frameLoop(1,this,this.updateExp,null,!0))},t.prototype.updateExp=function(){this._showExp=this._showExp+this._addExpSpeed,this._showExp>this._targetExp&&(this._showExp=this._targetExp,this.uvo.ssLv>this._showLevel?(this._showLevel+=1,this._showTotalExp=this.getLevelExp(this._showLevel),this.calculateAddSpeed(),this._showExp=0,this._showLevel==this.uvo.ssLv?this._targetExp=this.uvo.SSEXP:this._targetExp=this._showTotalExp):Laya.timer.clear(this,this.updateExp)),this.updateExpProcess(this._showExp,this._showTotalExp)},t.prototype.calculateAddSpeed=function(){this._addExpSpeed=Math.floor(this.getLevelExp(this._showLevel)/50),this._addExpSpeed<1&&(this._addExpSpeed=1)},t.prototype.getLevelExp=function(t){var e=a.GameConfig.SSLv[t+1];return e||(e=a.GameConfig.SSLv[t]),e.cost[0][1]},t.prototype.updateExpProcess=function(t,e){this.text_count.changeText(t+"/"+e);var i=!1;t<e&&(i=!0),this.btn_up.disabled=i;var n=t/e*374;this.bar_count.width=374<=n?374:n},t.prototype.close=function(){Laya.timer.clearAll(this),y.ClearResM.clearUrl("res/atlas/res/role/zhuansheng.json"),n.prototype.close.call(this)},t}(ui.role.Shenshi.GetSsEXPDlgUI);e.GetSsEXPDlg=n}),define("src/g/role/view/ShenshiPage",["require","exports","../../../utils/ItemUtils","../../../manager/RoleCenter","src/g/Effects/UIEffectsFactory","src/g/clearRes/ClearResM","../../../utils/RoleUtil","src/g/role/view/GetSsEXPDlg","../../../config/GameConfig","../../../manager/RedDotM","src/init/TextConst","src/g/lottery/view/ShenyuSkillDlg"],function(t,e,p,i,d,g,s,n,v,f,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.skillId=5401,t.onLoadUIEF(),t.btn_getZSEXP.on(Laya.Event.CLICK,t,t.OngetZSEXP),t.jnicon.on(Laya.Event.CLICK,t,t.jnClick),t}return __extends(t,e),t.prototype.jnClick=function(){var t=new a.ShenyuSkillDlg,e=p.ItemUtils.getSkillDefItem(this.skillId),i=e.desc;t.lab_open.text="",t.lab_desc.innerHTML=i,t.setIcon(e),t.popup()},t.prototype.OngetZSEXP=function(){(new n.GetSsEXPDlg).popup()},t.prototype.refreshShow=function(t){this.ssData=t,this.showAttr(),this.setNeedAndHas();for(var e=t.ssLv,i=0;i<3;i++){var n=!1;0!=e&&i<=(e-1)%3&&(n=!0);var s=this["sp_y"+i];s.visible=n;var o=s.getChildByName("ani");n&&(o=d.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(s,161)),o&&(o.visible=n)}var a=this.ani_put;a&&(f.RedDotM.isSsGetExp?a.visible=!0:a.visible=!1);var r=this.loadMask,l=e%3,h=1;2==l?h=60:0<e&&0==l&&(h=150),Laya.Tween.clearAll(r),1==h?r.width=h:Laya.Tween.to(r,{width:h},500),this.img_lv.skin=0<e?"dynamic/shenshi/"+v.GameConfig.SSLv[e].image+".png":"";var c=this.jnicon,u=p.ItemUtils.getSkillDefItem(this.skillId);u&&(c.getChildByName("lab_name").text=u.name,c.skin=p.ItemUtils.getSkillIconByIconId(u.icon)),g.ClearResM.resetViewImg(this)},t.prototype.onLoadUIEF=function(){this.ani_up=d.UIEffectsFactory.Ins.createUIAniById(40,!0),d.UIEffectsFactory.Ins.centered4Parent(this.ani_up,this.btn_up,!0),this.ani_put=d.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_getZSEXP,42,1,.9),this.ani_put.visible=!1},t.prototype.showAttr=function(){for(var t=this.ssData,e=v.GameConfig.SSLv[t.ssLv],i=v.GameConfig.SSLv[t.ssLv+1],n=0;n<e.prop.length;n++)this["lab_now_"+n].text=p.ItemUtils.getShuXingByName(e.prop[n][0]).desc+":"+e.prop[n][1];for(n=0;n<e.prop.length;n++)this["lab_next_"+n].text=i?p.ItemUtils.getShuXingByName(i.prop[n][0]).desc+":"+i.prop[n][1]:o.TextConst.get(208);this.box_fight.setFightNum(s.RoleUtil.calFightByProp(e.prop))},t.prototype.setNeedAndHas=function(){var t=i.RoleCenter.instans.vo.SSEXP;this.lab_has.text=t+"";var e=v.GameConfig.SSLv[this.ssData.ssLv+1];e?(this.lab_need.text=e.cost[0][1]+"",this.btn_getZSEXP.visible=!0,this.btn_up.visible=!0,e.cost[0][1]>t?(this.ani_up.visible=!1,this.lab_has.color="#ff0f15"):(this.ani_up.visible=!0,this.lab_has.color="#03bb00")):(this.lab_need.text="0",this.btn_up.visible=!1,this.btn_getZSEXP.visible=!1,this.lab_has.color="#03bb00")},t}(ui.role.Shenshi.ShenshiPageUI);e.ShenshiPage=r}),define("src/g/role/ctrl/ShenshiPageCtrl",["require","exports","../../net/messages/OpResultType","../../../manager/RoleCenter","../../../enum/EventName","../../../manager/GameSocketManager","src/g/fight/osprite/SceneObjCtroller","../../../plugin/sbkPropTool","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/init/ResManager","src/init/TextConst","src/g/role/view/ShenshiPage","../../../config/GameConfig","../../net/messages/shenshi/sbkShenShiMsg","src/g/base/BaseCtrl","../../../manager/RedDotM","../../../core/E"],function(t,e,n,s,o,a,r,l,h,c,i,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=function(e){function t(){var t=e.call(this)||this;return t.url="res/atlas/res/role/shenshi.json",t}return __extends(t,e),t.prototype.init=function(){return this._view||(this._view=new p.ShenshiPage),this._view.on(Laya.Event.REMOVED,this,this.onRemoved),this},t.prototype.onRemoved=function(){this._view&&(this._view.removeSelf(),this._view.destroy(),this._view=null)},t.prototype.addEvent=function(){s.RoleCenter.instans.on(n.enumOpResultType.shenshi+"",this,this.OnZhuanShengOVER),s.RoleCenter.instans.on(n.enumOpResultType.shenshi_downLv+"",this,this.refreshData),s.RoleCenter.instans.on(n.enumOpResultType.shenshi_reset+"",this,this.refreshData),this._view.btn_up.on(Laya.Event.CLICK,this,this.onUpZSLEVEL),y.E.ins.on(o.EventName.CHANGECURRENCY,this,this.ssExpChange)},t.prototype.ssExpChange=function(t){"SSEXP"==t&&this._view&&this._view.displayedInStage&&this.refreshData()},t.prototype.closeRoleView=function(){this._view.removeSelf(),this._view.destroy(),this._view=null},t.prototype.OnZhuanShengOVER=function(t){var e=s.RoleCenter.instans.vo,i=d.GameConfig.SSLv[t.reservedata[0]];e.ssLv=t.reservedata[0],l.sbkPropTool.resetSs(),e.combat=e.reCheckComBat(),s.RoleCenter.instans.vo.SSEXP-=i.cost[0][1],s.RoleCenter.instans.event(o.EventName.FIGHT_UP,t.reservedata[1]),f.RedDotM.check(239),this._view.displayedInStage&&this.refreshData(),r.SceneObjCtroller.ins.getSelfGroup().resetHP()},t.prototype.onUpZSLEVEL=function(){var t=s.RoleCenter.instans.vo,e=t.SSEXP;if(d.GameConfig.SSLv[t.ssLv+1].cost[0][1]<=e){var i=new g.sbkShenShiLvC2GS;i.msgidx=n.enumOpResultType.shenshi,a.GSM.sendServer(i)}else h.FE.upItems(u.TextConst.get(1041),c.BubbleEnum.center)},t.prototype.showPage=function(t){this._parent=t,this.open()},t.prototype.onAtlasLoaded=function(){this._view||(this.init(),this.addEvent(),this._parent.removeChildren(),this._parent.addChild(this._view),this.refreshData())},t.prototype.changePerson=function(t){},t.prototype.refreshData=function(){this._view&&(f.RedDotM.check(239),this._view.refreshShow(s.RoleCenter.instans.vo.ssData))},t.prototype.getTitle=function(){return"res/title/ss_biaoti.png"},t.prototype.hidePage=function(){i.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){i.ResManager.getInstance().destroyPageCtrl(this)},t}(v.BaseCtrl);e.ShenshiPageCtrl=m}),define("src/g/role/SsUtils",["require","exports","../../vo/sbkBagVo","../../config/GameConfig","../../manager/RoleCenter"],function(t,e,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.getNiceEq=function(t){for(var e,i=h.RoleCenter.instans.vo,n=r.sbkBagVo.getSsEq(),s=0;s<n.length;s++){var o=n[s],a=l.GameConfig.SSEquip[o.equtemplet];i.ssLv<a.limit||a.pos!=t||(e?a.limit>l.GameConfig.SSEquip[e.equtemplet].limit&&(e=o):e=o)}return e},t}();e.SsUtils=i}),define("src/g/role/view/ShenshiEquip",["require","exports","src/g/clearRes/ClearResM","../../net/messages/shenshi/sbkShenShiHeroData","../../net/messages/shenshi/sbkShenShiMsg","../../../manager/GameSocketManager","src/g/role/view/SsTips_Eq","../../../config/GameConfig","src/g/role/SsUtils","../../../manager/RedDotM","src/g/role/view/SsResolveDlg","../../net/messages/sbkFormula","../../../utils/system/FloatEffect","src/init/TextConst","../../../utils/StringUtils","src/g/Effects/UIEffectsFactory"],function(t,e,T,A,a,r,l,R,h,L,i,x,c,P,k,D){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t.on(Laya.Event.REMOVED,t,t.onRemoved),t.img_fj.on(Laya.Event.CLICK,t,t.fjClick);for(var e=A.SSPosEquip.sdShengWu;e<=A.SSPosEquip.sdZhanXue;e++){var i=t["box"+e];i.on(Laya.Event.CLICK,t,t.equipClick),i.name=e+""}return t}return __extends(t,n),t.prototype.fjClick=function(){var t=new i.SsResolveDlg;t.refreshData(),t.popup()},t.prototype.equipClick=function(t){var e=+t.currentTarget.name,i=this.sshData.equpos[e-1].ins;if(0==i.equid){var n=h.SsUtils.getNiceEq(e);if(n){var s=new a.PutonSSEquipC2GS;s.equipId=n.equid,s.heroIdx=this.hidx,s.equipPos=e,r.GSM.sendServer(s)}else c.FE.upItems(P.TextConst.get(1042))}else{var o=new l.SsTips_Eq(this.hidx);o.initData(!0,i),o.popup()}},t.prototype.onRemoved=function(){T.ClearResM.clearUrl(this.imgbg.skin)},t.prototype.refresh=function(t,e){if(this.hidx=t,e){for(var i=(this.sshData=e).equpos,n=0,s=L.RedDotM._ssERed,o=!1,a=0;a<i.length;a++){var r=i[a];if(r){var l=r.pos,h=r.ins,c=l,u=this["box"+l];if(u){var p=u.getChildByName("e"),d=u.getChildByName("r"),g=u.getChildByName("eq"),v=u.getChildByName("l"),f=u.getChildByName("lv"),y=u.getChildByName("i"),m=h.equtemplet,_=R.GameConfig.SSEquip[m],C=r.strongLv;f.text=0!=m&&0<C?"+"+C:"",d.visible=!!s[t]&&s[t][l].hasRed(),l==A.SSPosEquip.sdShengMian||l==A.SSPosEquip.sdShengKui||l==A.SSPosEquip.sdShengLian||l==A.SSPosEquip.sdZhanJie||l==A.SSPosEquip.sdZhanXi||l==A.SSPosEquip.sdZhanPi?l=A.SSPosEquip.sdShengDun:l!=A.SSPosEquip.sdShengDun&&l!=A.SSPosEquip.sdZhanWan||(l=A.SSPosEquip.sdZhanXue);var I=u.getChildByName("ani");if(I&&I.removeSelf(),0==h.equid)p.skin="",g.skin="res/role/shenshiE/ssdi_"+c+"_0.png",y.visible=v.visible=!1;else{var b=0,w=_.quality-30,S=w-1;0<(b=c==A.SSPosEquip.sdShengWu?411+S:c==A.SSPosEquip.sdShengJia?421+S:c==A.SSPosEquip.sdZhanWan||c==A.SSPosEquip.sdZhanXue||c==A.SSPosEquip.sdShengDun?431+S:c==A.SSPosEquip.sdZhanYao?441+S:451+S)&&(I=D.UIEffectsFactory.Ins.createSAniAndCenter(u,b),u.setChildIndex(I,2)),p.skin="res/role/shenshiE/ss_"+c+"_"+w+".png",g.skin="res/role/shenshiE/ssdi_"+l+"_"+w+".png",y.visible=v.visible=!0,v.text=P.TextConst.get(7,k.StringUtils.getNumStr(_.suitlv))}var E=r.strongProp;n+=h.combat+x.sbkFormula.calEquipCombat(E.HP,E.ATT,E.PDEF,E.SDEF,0,E.SSATT,E.SSDEF)}else o=!0}}o&&console.log("神使装备数据异常"),this.box_fight.setFightNum(n),T.ClearResM.resetViewImg(this)}},t.prototype.getStr=function(t){var e=t+"",i=[P.TextConst.get(1029),P.TextConst.get(1030),P.TextConst.get(1031),P.TextConst.get(1032),P.TextConst.get(1033),P.TextConst.get(1034),P.TextConst.get(1035),P.TextConst.get(1036),P.TextConst.get(1037),P.TextConst.get(1038)],n="";if(10==t)n=i[i.length-1];else if(t<20&&10<t)n=i[i.length-1],n+=i[+e[1]-1];else for(var s=0;s<e.length;s++)n+=0==+e[s]?i[i.length-1]:i[+e[s]-1];return n},t}(ui.role.Shenshi.ShenshiEquipUI);e.ShenshiEquip=n}),define("src/g/role/ctrl/ShenshiEquipCtrl",["require","exports","src/g/role/view/ShenshiEquip","../../../manager/RoleCenter","../../../manager/GameSocketManager","../../net/messages/shenshi/sbkShenShiMsg","../../../plugin/sbkPropTool","../../../enum/EventName","../../../core/NumE"],function(t,e,i,r,n,s,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){this._nowSelectHero=0}return t.prototype.init=function(){return this._view||(this._view=new i.ShenshiEquip),n.GSM.ins.on(s.updateSSEquipPosGS2C.KEY,this,this.ssEPos),n.GSM.ins.on(s.SSEquipProChgMsg.KEY,this,this.refreshData),this._view},t.prototype.ssEPos=function(t){var e=r.RoleCenter.instans.vo,i=t.heroIdx,n=e.getOpenHeroByIdx(i).sshData,s=t.ssEqu;n.equpos[s.pos-1].copydata(s),c.NumE.ins.event(s.ins.equtemplet+c.NumE.CHANGED);var o=e.combat;l.sbkPropTool.resetSs(i);var a=e.reCheckComBat();r.RoleCenter.instans.event(h.EventName.FIGHT_UP,a-o),this.refreshData()},t.prototype.showPage=function(t,e){this._parent=t,this._view||this.init(),t.removeChildren(),t.addChild(this._view),this.refreshData()},t.prototype.changePerson=function(t,e){this._nowSelectHero=t,this._view&&this._view.parent==this._parent&&this.refreshData()},t.prototype.refreshData=function(){if(this._view){var t=this._nowSelectHero;this._view.refresh(t,r.RoleCenter.instans.vo.getOpenHeroByIdx(t).sshData)}},t.prototype.getTitle=function(){return"res/title/ss_biaoti.png"},t.prototype.hidePage=function(){},t.prototype.destroyPage=function(){},t}();e.ShenshiEquipCtrl=o}),define("src/g/redhints/RedListenner",["require","exports","../../manager/NewRedHintsCenter"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];this._activate=!0,this._hasRed=!1,this.keyList=[],this._key=t}return Object.defineProperty(t.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activate",{get:function(){return this._activate},enumerable:!0,configurable:!0}),t.prototype.setActivate=function(t,e){void 0===e&&(e=!1),this._activate!=t&&(this._activate=t,0<this._bindRed&&(this._activate?i.NewRedHintsCenter.ins.setRedHintOpenOrClose(this._bindRed,this.hasRed()):i.NewRedHintsCenter.ins.setRedHintOpenOrClose(this._bindRed,!1))),e&&this.setActivateChild(t,e)},t.prototype.setActivateChild=function(t,e){void 0===e&&(e=!1);for(var i,n=this.keyList.length,s=0;s<n;)(i=this[this.keyList[s]])&&i.setActivate(t,e),s++},t.prototype.bindRed=function(t){this._bindRed=t,this._activate&&i.NewRedHintsCenter.ins.setRedHintOpenOrClose(t,this.hasRed())},t.prototype.unbindRed=function(){0<this._bindRed&&this._activate&&i.NewRedHintsCenter.ins.setRedHintOpenOrClose(this._bindRed,!1),this._bindRed=0},t.prototype.hasRed=function(){return this._hasRed},Object.defineProperty(t.prototype,"red",{set:function(t){this._hasRed!=t&&(this._hasRed=t,this.parent&&this.parent.onChildRedChanged(this),0<this._bindRed&&this._activate&&i.NewRedHintsCenter.ins.setRedHintOpenOrClose(this._bindRed,this.hasRed()))},enumerable:!0,configurable:!0}),t.prototype.getChildrenRed=function(){return null},t.prototype.onChildRedChanged=function(t){var e=t.hasRed();!e&&this._hasRed?this.red=this.checkChildRed():this.red=e},t.prototype.checkChildRed=function(){for(var t,e=this.keyList.length,i=0;i<e;){if((t=this[this.keyList[i]])&&t.hasRed())return!0;i++}return!1},t.prototype.getKeyList=function(){return this.keyList},t.prototype.removeChild=function(t){if(t&&t.parent==this){t.parent=null,delete this[t.key.toString()];var e=this.keyList.indexOf(t.key);-1<e&&this.keyList.splice(e,1),this._hasRed&&(this.red=this.checkChildRed())}},t.prototype.addChild=function(t){t&&(t.parent&&t.parent.removeChild(t),(t.parent=this)[t.key.toString()]=t,this.keyList.push(t.key),t.hasRed()&&(this.red=!0))},t}();e.RedListenner=n}),define("src/g/lottery/SsRedListenner",["require","exports","src/g/redhints/RedListenner","src/g/accessctrl/AccessCenter","../../vo/sbkBagVo","../../core/E","../../enum/EventName","../../manager/RoleCenter","../../core/NumE","../../config/GameConfig","../net/messages/OpResultType","../../manager/GameSocketManager","../net/messages/shenshi/sbkShenShiMsg"],function(t,e,i,g,v,f,y,m,n,_,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(s){function t(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=s.call(this,t)||this;return n.heroIdx=e[0],n.addEvent(),n}return __extends(t,s),t.prototype.addEvent=function(){f.E.ins.on(y.EventName.ADDED_ZHUANSHENG,this,this.checkRed),a.GSM.ins.on(r.SSEquipProChgMsg.KEY,this,this.checkRed),m.RoleCenter.instans.on(o.enumOpResultType.shenshi+"",this,this.checkRed);var t=n.NumE.ins,e=_.GameConfig.SSEquip;for(var i in e){e[i].pos==this.key&&t.on(+i+n.NumE.CHANGED,this,this.checkRed)}},t.prototype.removeEvent=function(){},t.prototype.checkRed=function(){if(g.AccessCenter.ins.checkOpen(240)){this.removeEvent();var t=m.RoleCenter.instans.vo,e=t.getOpenHeroByIdx(this.heroIdx);if(e){for(var i=e.sshData.equpos,n=this.key,s=_.GameConfig.SSEquip,o=v.sbkBagVo.getSsEq(),a=i[n-1].ins,r=0!=a.equid?s[a.equtemplet]:null,l=!1,h=0;h<o.length;h++){var c=s[o[h].equtemplet];if(r){if(r.pos==c.pos&&r.suitlv<c.suitlv&&c.limit<=t.ssLv){l=!0;break}}else if(n==c.pos&&c.limit<=t.ssLv){l=!0;break}}var u=!1;if(0!=a.equid){var p=i[n-1].strongLv,d=_.GameConfig.SSequipenhance[n+"_"+p];_.GameConfig.SSequipenhance[n+"_"+(p+1)]&&(u=t.bagdata.getItemCount(d.cost[0][0])>=d.cost[0][1])}this.eqStrong=u,this.eqReplace=l,this.red=l||u}else f.E.ins.on(y.EventName.OPENNEW_HERO,this,this.checkRed)}},t}(i.RedListenner);e.SsRedListenner=s}),define("src/g/role/ctrl/RoleSsCtrl",["require","exports","src/init/Switches","src/g/role/view/RoleSsView","../../../manager/RoleCenter","src/g/proxy/MultiLevelUIProxy","src/g/role/ctrl/ShenshiPageCtrl","src/g/clearRes/ClearResM","../../../manager/LayerManager","../../net/messages/OpResultGS2C","../../net/messages/OpResultType","../../../core/E","../../../enum/EventName","../../../manager/GameSocketManager","src/g/role/ctrl/ShenshiEquipCtrl","../../../manager/RedDotM","../../../config/GameConfig","../../../core/NumE","../../net/messages/shenshi/sbkShenShiMsg","../../../plugin/sbkPropTool"],function(t,e,i,a,l,r,n,h,c,s,o,u,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(){function t(){this.curIndex=0,this._nowSelectHero=0,i.Switches.ins.on(239,this,this.onOpenHandler,[239]),i.Switches.ins.on(240,this,this.onOpenHandler,[240]),d.GSM.ins.on(s.OpResultGS2C.KEY,this,this.onOpResult),d.GSM.ins.on(m.SSEquipProChgMsg.KEY,this,this.propHandler)}return t.prototype.equipChange=function(){this._shenshiE&&this._shenshiE.refreshData(),this.updateHeadRed(1)},t.prototype.propHandler=function(t){var e=t.heroidx,i=l.RoleCenter.instans.vo,n=t.equpos,s=i.getOpenHeroByIdx(e).sshData.equpos[n-1],o=f.GameConfig.SSequipenhance[n+"_"+s.strongLv];i.chgItemCount(o.cost[0][0],-o.cost[0][1]),s.strongLv=t.curLv;var a=i.combat;_.sbkPropTool.resetSs(e);var r=i.reCheckComBat();l.RoleCenter.instans.event(p.EventName.FIGHT_UP,r-a)},t.prototype.onOpResult=function(t){t.msgidx==o.enumOpResultType.activity_nextDay&&(l.RoleCenter.instans.vo.SSCountArr=[0,0,0],u.E.ins.event(p.EventName.CHANGECURRENCY,["SSEXP"]),v.RedDotM.check(239))},t.prototype.onOpenHandler=function(t,e,i,n){if(void 0===i&&(i=!0),void 0===n&&(n=!1),e){if(!this._view){this._view=new a.RoleSsView,this._view.tab_head.initData(l.RoleCenter.instans.self.openhero,0,l.RoleCenter.instans.vo),this._tabProxy=new r.MultiLevelUIProxy,this._tabProxy.registerTab(this._view.tab_pageBtn,0),this._tabProxy.registerTagIndex(239,0),this._tabProxy.registerTagIndex(240,1),this._view.bg_view.btn_close.on(Laya.Event.CLICK,this,this.closeRoleView),this._view.bg_view.btn_back.on(Laya.Event.CLICK,this,this.closeRoleView),this._view.bg_view.btn_help.visible=!1,this._tabProxy.selectHandler=new Laya.Handler(this,this.tab_selectHandler),this._view.tab_head.setCallbackHandler(new Laya.Handler(this,this.HeroSelect));var s=f.GameConfig.SSEquip;for(var o in s)y.NumE.ins.on(+o+y.NumE.CHANGED,this,this.equipChange)}this._tabProxy.open(t),h.ClearResM.resetViewImg(this._view),c.LayerManager.addInPOPWindowLayer(this._view,i,!0,!0,!1,n)}},t.prototype.HeroSelect=function(t,e){l.RoleCenter.instans.vo.heronum>t?(this._nowSelectHero=t,this._view.tab_head.setSelectIndex(t),this._shenshi&&this._shenshi.changePerson(t),this._shenshiE&&this._shenshiE.changePerson(t),this._nowSelectHero==this.curIndex?this.curIndex=this._nowSelectHero:this._nowSelectHero>this.curIndex?this.curIndex=this._nowSelectHero:this._nowSelectHero<this.curIndex&&(this.curIndex=this._nowSelectHero)):i.Switches.ins.event(15)},t.prototype.tab_selectHandler=function(t){var e=!0;switch(t){case 0:this._shenshi||(this._shenshi=new n.ShenshiPageCtrl),this._page=this._shenshi,e=!1;break;case 1:this._shenshiE||(this._shenshiE=new g.ShenshiEquipCtrl),this._page=this._shenshiE;break;case 2:break;case 3:e=!1}var i=this._view.tab_head;i.visible=e,i.initData(l.RoleCenter.instans.self.openhero,this._nowSelectHero,l.RoleCenter.instans.vo),this._page.showPage(this._view.bg_view.box_page),this._view.bg_view.img_title.skin=this._page.getTitle(),this.updateHeadRed(t)},t.prototype.updateHeadRed=function(t){if(0!=t){for(var e,i=v.RedDotM._ssERed,n=[],s=0;s<3;)1==t&&(e=i[s]),e&&n.push(e.hasRed()),s++;this._view&&this._view.tab_head.refreshHeadRedHint(n)}},t.prototype.closeRoleView=function(){this._view.bg_view.box_page.removeChildren(),this._view.removeSelf()},t}();e.RoleSsCtrl=C}),define("src/g/share/vo/ShareSeekHelpVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.id=t[i++],this.maxNum=t[i++],this.bonus=t[i++],e[this.id]=this},t}();e.ShareSeekHelpVo=i}),define("src/g/share/view/ShareSeekHelpItem",["require","exports","../../../utils/ItemUtils","../../../manager/GameSocketManager","../../../manager/RoleCenter","src/g/peronboss/view/ItemIconView","src/init/TextConst","../../net/messages/share/sbkShareData"],function(t,e,o,i,n,a,s,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t.vo=null,t.btn_get.on(Laya.Event.CLICK,t,t.onReceive),t.list_item.renderHandler=new Laya.Handler(t,t.renderHandler),t}return __extends(t,e),t.prototype.renderHandler=function(t,e){var i=t.dataSource[0],n=t.dataSource[1],s=o.ItemUtils.getItemOrEq(i);a.ItemIconView.setItemData(s,t,n)},t.prototype.setData=function(t){this.vo=t,this.list_item.array=this.vo.bonus,this.refresh()},t.prototype.hasTime=function(t){var e=n.RoleCenter.instans.vo.shareData;return!(!e||-1==e.hasTimeArr.indexOf(t))},t.prototype.refresh=function(){var t=n.RoleCenter.instans.vo.shareData;t&&(this.lab_title.text="累计"+this.vo.maxNum+"次（"+t.totalTime+"/"+this.vo.maxNum+"）",this.btn_get.visible=!0,this.hasTime(this.vo.maxNum)?this.btn_get.visible=!1:t.totalTime<this.vo.maxNum?(this.btn_get.disabled=!0,this.btn_get.label=s.TextConst.get(210)):(this.btn_get.disabled=!1,this.btn_get.label=s.TextConst.get(216)))},t.prototype.onReceive=function(){if(this.vo){var t=new r.getRequestHelpRewardC2GS;t.time=this.vo.maxNum,i.GSM.sendServer(t)}else console.log("累计奖励信息为null")},t}(ui.share1.ShareSeekHelpItemUI);e.ShareSeekHelpItem=l}),define("src/g/share/vo/ShareVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.value=null,this.reward=null}return t.prototype.init=function(t,e){var i=0;this.key=t[i++],this.value=t[i++],this.desc=t[i++],this.reward=t[i++],e[this.key]=this},t}();e.ShareVo=i}),define("src/g/share/ShareTools",["require","exports","src/g/share/vo/ShareVo","../../config/GameConfig","src/g/gameSdk/gameSdk","../net/messages/share/sbkShareData","../../manager/GameSocketManager","../../manager/RoleCenter"],function(t,e,i,n,s,o,a,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function r(){}return r.getShareJSON=function(t){var e=n.GameConfig.shareJSON[t];return e||(console.error("找不到数据:key="+t),new i.ShareVo)},r.getShareReward=function(t){var e=[],i=r.getShareJSON(t);if(i)for(var n=String(i.reward).split(","),s=void 0,o=void 0,a=0;a<n.length;a++)o={id:(s=n[a].split(":"))[0],num:s[1]},e.push(o);return e},r.isLowLvFriend=function(t){var e=l.RoleCenter.instans.vo.shareData;return!(!e||-1==e.hasLowLvArr.indexOf(t))},r.isHightLvFriend=function(t){var e=l.RoleCenter.instans.vo.shareData;return!(!e||-1==e.hasHighLvArr.indexOf(t))},r.getPowerItemID=function(){var t=r.getShareJSON("FanliItem");return t?l.RoleCenter.instans.vo.bagdata.getItemCount(t.value):0},r.startShare=function(t){this._init||(this._init=!0,wx.onShow(function(){console.error("-----1212121212------------"),this._callbackf&&this._callbackf.apply(null)}.bind(this))),this._callbackf=t;var e=l.RoleCenter.instans.vo.username,i=JSON.stringify({username:e});s.gameSdk.Ins.sdk.enterShareAndFeed(i,function(t){},function(){var t=new ui.alert.ShareTipUI;t.once(Laya.Event.CLICK,t,t.close),t.popup()}.bind(this))},r.fristShare=function(){var t=new o.getFirstShareRewardC2GS;a.GSM.sendServer(t)},r._init=!1,r}();e.ShareTools=r}),define("src/g/share/view/ShareSeekHelpView",["require","exports","src/g/share/view/ShareSeekHelpItem","../../../manager/RoleCenter","../../../config/GameConfig","src/init/Switches","src/g/share/ShareTools"],function(t,e,i,o,a,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.barWidth=0,t.list.itemRender=i.ShareSeekHelpItem,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=50,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t.img_shop.on(Laya.Event.CLICK,t,t.onJump),o.RoleCenter.instans.on("UPDATE_SHARE_DATA",t,t.refreshHandler),t.init(),t}return __extends(t,e),t.prototype.refreshHandler=function(){this.refresh(),this.refreshList()},t.prototype.showView=function(t){t.addChild(this),this.visible=!0,this.refresh(),this.refreshList()},t.prototype.init=function(){var t=this.box.getChildByName("img_bar");this.barWidth=t.width;var e=s.ShareTools.getShareJSON("IncomeLeijinumber").value;this.box.getChildByName("lab_tips").text="（每天前"+e+"次开启宝箱才计算累计次数）"},t.prototype.refresh=function(){var t=o.RoleCenter.instans.vo.shareData.totalTime,e=this.find(t);this.box.getChildByName("lab_bar").text=t+"/"+e;var i=this.barWidth/e;this.box.getChildByName("img_bar").width=i*t},t.prototype.refreshList=function(){var t=o.RoleCenter.instans.vo.shareData.totalTime,e=[],i=[];for(var n in a.GameConfig.shareRewardJSON){var s=a.GameConfig.shareRewardJSON[n];t<s.maxNum||t==s.maxNum&&!this.hasTime(s.maxNum)?e.push(s):i.push(s)}e.concat(i),this.list.array=e},t.prototype.renderHandler=function(t,e){t.setData(this.list.array[e])},t.prototype.hasTime=function(t){var e=o.RoleCenter.instans.vo.shareData;return!(!e||-1==e.hasTimeArr.indexOf(t))},t.prototype.find=function(t){for(var e in a.GameConfig.shareRewardJSON){var i=a.GameConfig.shareRewardJSON[e];if(t<i.maxNum||t==i.maxNum&&!this.hasTime(i.maxNum))return i.maxNum}return-1},t.prototype.onJump=function(){n.Switches.ins.event(261)},t}(ui.share1.ShareSeekHelpViewUI);e.ShareSeekHelpView=r}),define("src/g/share/view/ShareFriendItem",["require","exports","../../../manager/GameSocketManager","../../net/messages/share/sbkShareData","src/g/share/ShareTools"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t._index=0,t.btn_get.on(Laya.Event.CLICK,t,t.onReceive),t}return __extends(t,e),t.prototype.setData=function(t,e){this._index=t,this.playerInfo=e,this.lab_title.text="第"+(this._index+1)+"位好友",this.refresh()},t.prototype.state=function(){var t=s.ShareTools.getShareJSON("HelpAppointLv").value;if(this.playerInfo){if(s.ShareTools.isLowLvFriend(this.playerInfo.username))return 1;if(this.playerInfo.lvl>=t)return 2}return 0},t.prototype.refresh=function(){var t=0,e=s.ShareTools.getShareJSON("HelpAppointLv").value;switch(this.state()){case 0:this.btn_get.visible=!0,this.btn_get.disabled=!0,this.lab_lingqu.visible=!1;break;case 1:this.btn_get.visible=!1,this.btn_get.disabled=!0,this.lab_lingqu.visible=!0;break;case 2:this.btn_get.visible=!0,this.btn_get.disabled=!1,this.lab_lingqu.visible=!1}this.playerInfo?(t=Math.min(this.playerInfo.lvl,e),this.lab_icon.visible=!1,this.img_icon.skin="res/custom/heads/"+(this.playerInfo.showHeroIdx+1)+"_0.png"):this.lab_icon.visible=!0,this.lab_lv.text="Lv."+t+"/"+e;var i=s.ShareTools.getShareJSON("HelpMaxPeopleAppointLv").reward[this._index][1];this.lab_reward.text="奖励："+i},t.prototype.onReceive=function(){if(this.playerInfo){var t=new n.getHelpLowLvRewardC2GS;t.childUsername=this.playerInfo.username,i.GSM.sendServer(t)}else console.log("下家信息为null")},t}(ui.share1.ShareFriendItemUI);e.ShareFriendItem=o}),define("src/g/share/view/ShareHelpView",["require","exports","../../../manager/RoleCenter","src/g/share/view/ShareFriendItem","src/init/Switches","src/g/share/ShareTools"],function(t,e,s,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.barWidth=0,t.list.itemRender=i.ShareFriendItem,t.list.hScrollBarSkin="",t.list.scrollBar.elasticDistance=50,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t.img_shop.on(Laya.Event.CLICK,t,t.onJump),s.RoleCenter.instans.on("UPDATE_SHARE_DATA",t,t.refreshHandler),t.init(),t}return __extends(t,e),t.prototype.refreshHandler=function(){this.refresh(),this.refreshList()},t.prototype.showView=function(t){t.addChild(this),this.visible=!0,this.refreshHandler()},t.prototype.renderHandler=function(t,e){t.setData(e,this.list.array[e])},t.prototype.refreshList=function(){for(var t=o.ShareTools.getShareJSON("HelpMaxPeople").value,e=null,i=[],n=0;n<t;++n)(e=s.RoleCenter.instans.vo.shareData.sonPlayerInfoArr[n])?i.push(e):i.push(null);this.list.array=i},t.prototype.init=function(){var t=o.ShareTools.getShareJSON("HelpAppointLv").value;this.lab_tips.text="达到"+t+"级可获得奖励";var e=this.box.getChildByName("img_bar");this.barWidth=e.width},t.prototype.refresh=function(){var t=o.ShareTools.getShareJSON("HelpLeijiPeople").value,e=Math.min(t,s.RoleCenter.instans.vo.shareData.hasLowLvArr.length);this.box.getChildByName("lab_bar").text=e+"/"+t;var i=this.box.getChildByName("img_bar"),n=this.barWidth/t;i.width=n*e},t.prototype.onJump=function(){n.Switches.ins.event(261)},t}(ui.share1.ShareHelpViewUI);e.ShareHelpView=a}),define("src/g/share/view/ShareFriendHLvelItem",["require","exports","../../../manager/GameSocketManager","../../net/messages/share/sbkShareData","src/g/share/ShareTools"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t._index=0,t.btn_get.on(Laya.Event.CLICK,t,t.onReceive),t}return __extends(t,e),t.prototype.setData=function(t,e){this._index=t,this.playerInfo=e,this.lab_title.text="第"+(this._index+1)+"位好友",this.refresh()},t.prototype.state=function(){var t=s.ShareTools.getShareJSON("HighAppointLv").value;if(this.playerInfo){if(s.ShareTools.isHightLvFriend(this.playerInfo.username))return 1;if(this.playerInfo.lvl>=t)return 2}return 0},t.prototype.refresh=function(){var t=0,e=s.ShareTools.getShareJSON("HighAppointLv").value;switch(this.state()){case 0:this.btn_get.visible=!0,this.btn_get.disabled=!0,this.lab_lingqu.visible=!1;break;case 1:this.btn_get.visible=!1,this.btn_get.disabled=!0,this.lab_lingqu.visible=!0;break;case 2:this.btn_get.visible=!0,this.btn_get.disabled=!1,this.lab_lingqu.visible=!1}this.playerInfo?(t=Math.min(this.playerInfo.lvl,e),this.lab_icon.visible=!1,this.img_icon.skin="res/custom/heads/"+(this.playerInfo.showHeroIdx+1)+"_0.png"):this.lab_icon.visible=!0,this.lab_lv.text="Lv."+t+"/"+e;var i=s.ShareTools.getShareJSON("HighMaxPeopleAppointLv").reward[this._index][1];this.lab_reward.text="奖励："+i},t.prototype.onReceive=function(){if(this.playerInfo){var t=new n.getHelpHighLvRewardC2GS;t.childUsername=this.playerInfo.username,i.GSM.sendServer(t)}else console.log("下家信息为null")},t}(ui.share1.ShareFriendItemUI);e.ShareFriendHLvelItem=o}),define("src/g/share/view/ShareUpgradeView",["require","exports","../../../manager/RoleCenter","src/init/Switches","src/g/share/ShareTools","src/g/share/view/ShareFriendHLvelItem"],function(t,e,s,i,o,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.list.itemRender=n.ShareFriendHLvelItem,t.list.hScrollBarSkin="",t.list.scrollBar.elasticDistance=50,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t.img_shop.on(Laya.Event.CLICK,t,t.onJump),s.RoleCenter.instans.on("UPDATE_SHARE_DATA",t,t.refreshHandler),t}return __extends(t,e),t.prototype.refreshHandler=function(){this.refresh(),this.refreshList()},t.prototype.showView=function(t){t.addChild(this),this.visible=!0,this.refreshHandler()},t.prototype.renderHandler=function(t,e){t.setData(e,this.list.array[e])},t.prototype.refreshList=function(){for(var t=o.ShareTools.getShareJSON("HelpMaxPeople").value,e=null,i=[],n=0;n<t;++n)(e=s.RoleCenter.instans.vo.shareData.sonPlayerInfoArr[n])?i.push(e):i.push(null);this.list.array=i},t.prototype.refresh=function(){var t=o.ShareTools.getShareJSON("HighAppointLv").value;this.box.getChildByName("lab_tips").text="升级到"+t+"级"},t.prototype.onJump=function(){i.Switches.ins.event(261)},t}(ui.share1.ShareUpgradeViewUI);e.ShareUpgradeView=a}),define("src/g/share/view/ShareRebateItem",["require","exports","../../../manager/GameSocketManager","../../net/messages/share/sbkShareData"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.money=0,t._index=0,t.on(Laya.Event.CLICK,t,t.onReceive),t}return __extends(t,e),t.prototype.setData=function(t,e){this._index=t,this.money=e,this.refresh()},t.prototype.refresh=function(){this.lab_num.text=this.money+""},t.prototype.onReceive=function(){if(0!=this.money){var t=new n.getBackRedC2GS;t.num=this.money,i.GSM.sendServer(t)}else console.log("领取的奖励为0")},t}(ui.share1.ShareRedPacketItemUI);e.ShareRebateItem=s}),define("src/g/share/view/ShareRebateView",["require","exports","../../../manager/RoleCenter","src/g/share/view/ShareRebateItem","src/init/Switches","src/g/share/ShareTools"],function(t,e,s,i,n,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.list.itemRender=i.ShareRebateItem,t.list.hScrollBarSkin="",t.list.scrollBar.elasticDistance=50,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t.img_shop.on(Laya.Event.CLICK,t,t.onJump),s.RoleCenter.instans.on("UPDATE_SHARE_DATA",t,t.refreshList),t.init(),t}return __extends(t,e),t.prototype.showView=function(t){t.addChild(this),this.visible=!0,this.refreshList()},t.prototype.renderHandler=function(t,e){t.setData(e,this.list.array[e])},t.prototype.init=function(){var t=100*o.ShareTools.getShareJSON("RebateBaifenbiReward").value;this.lab_tips.text="您可以获得订单"+t+"%的元宝"},t.prototype.refreshList=function(){for(var t=o.ShareTools.getShareJSON("RebateMaxPeople").value,e=[],i=0,n=0;n<t;++n)(i=s.RoleCenter.instans.vo.shareData.backRedArr[n])?e.push(i):e.push(0);this.list.array=e},t.prototype.onJump=function(){n.Switches.ins.event(261)},t}(ui.share1.ShareRebateViewUI);e.ShareRebateView=a}),define("src/g/share/view/SharePowerView",["require","exports","../../../manager/RoleCenter","src/init/Switches","src/g/share/ShareTools"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.lab_exchange.on(Laya.Event.CLICK,t,t.onJump),i.RoleCenter.instans.on("UPDATE_SHARE_DATA",t,t.refreshHandler),t.init(),t}return __extends(t,e),t.prototype.refreshHandler=function(){var t=i.RoleCenter.instans.vo.shareData.helpPowerUserArr.length;this.lab_friends.text=""+t},t.prototype.showView=function(t){t.addChild(this),this.visible=!0,this.refreshHandler()},t.prototype.init=function(){var t=s.ShareTools.getShareJSON("DaHelpAppointLv").value,e=s.ShareTools.getShareJSON("DaHelpPeopleAppointLv").reward;this.lab_tips.text="升级至"+(t+"").charAt(0)+"转可获得"+e[0][1]+"助力币"},t.prototype.onJump=function(){n.Switches.ins.event(261)},t}(ui.share1.SharePowerViewUI);e.SharePowerView=o}),define("src/g/share/view/ShareActivityDig",["require","exports","src/g/share/view/ShareSeekHelpView","src/g/share/view/ShareHelpView","src/g/share/view/ShareUpgradeView","src/g/share/view/ShareRebateView","src/g/share/view/SharePowerView","src/g/proxy/MultiLevelUIProxy","../../../manager/RoleCenter","src/g/share/ShareTools","../../../utils/system/DateUitl","../../../utils/system/ServerTime","../../../manager/NewRedHintsCenter"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;(t._conArr=[],t.maxTime=0,t._tabProxy=new r.MultiLevelUIProxy,t._tabProxy.registerTab(t.tab,0),t._tabProxy.registerTagIndex(255,0),t._tabProxy.registerTagIndex(256,1),t._tabProxy.registerTagIndex(257,2),t._tabProxy.registerTagIndex(258,3),t._tabProxy.registerTagIndex(259,4),t._tabProxy.selectHandler=new Laya.Handler(t,t.renderHandler),window.enabledpay)||(t.tab.getChildByName("item4").visible=!1,t.tab.changeLabels());return t.maxTime=h.ShareTools.getShareJSON("OpenCaseBox").value,t}return __extends(t,e),t.prototype.loopHandler=function(){var t=l.RoleCenter.instans.vo.shareData.nextOpenTime-u.ServerTime.serverTime;t<=0?(this.lab_cd.visible=!1,this.btn_open.disabled=!1,t=0,Laya.timer.clear(this,this.loopHandler)):(this.lab_cd.visible=!0,this.btn_open.disabled=!0),this.lab_cd.text=c.DateUtil.getMinStr1(t)},t.prototype.showView=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),this._tabProxy.open(t),this.refresh(),this.popup()},t.prototype.refresh=function(){var t=l.RoleCenter.instans.vo.shareData.todayShareTime;this.lab_title.text="每天可开启宝箱（"+t+"/"+this.maxTime+"）";var e=h.ShareTools.getPowerItemID();this.lab_zhuli.text=e+"",this.loopHandler(),t>=this.maxTime?(this.btn_open.disabled=!0,p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.qiuzhu,!1)):Laya.timer.loop(1e3,this,this.loopHandler)},t.prototype.close=function(){Laya.timer.clear(this,this.loopHandler),l.RoleCenter.instans.vo.shareData.todayShareTime>=this.maxTime&&p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.qiuzhu,!1),e.prototype.close.call(this)},t.prototype.hideBoxHelp=function(){this.box_zhuli.visible=!1},t.prototype.showBoxHelp=function(){this.box_zhuli.visible=!0},t.prototype.renderHandler=function(t){for(var e=0;e<this._conArr.length;e++)this._conArr[e].visible=!1;switch(t){case 0:this._seekHelpView||(this._seekHelpView=new i.ShareSeekHelpView,this._conArr.push(this._seekHelpView)),this.hideBoxHelp(),this._seekHelpView.showView(this.box);break;case 1:this._helpView||(this._helpView=new n.ShareHelpView,this._conArr.push(this._helpView)),this.showBoxHelp(),this._helpView.showView(this.box);break;case 2:this._upgradeView||(this._upgradeView=new s.ShareUpgradeView,this._conArr.push(this._upgradeView)),this.showBoxHelp(),this._upgradeView.showView(this.box);break;case 3:this._powerView||(this._powerView=new a.SharePowerView,this._conArr.push(this._powerView)),this.hideBoxHelp(),this._powerView.showView(this.box);break;case 4:this._rebateView||(this._rebateView=new o.ShareRebateView,this._conArr.push(this._rebateView)),this.hideBoxHelp(),this._rebateView.showView(this.box)}},t}(ui.share1.ShareActivityDigUI);e.ShareActivityDig=d}),define("src/g/share/view/ShareDlg",["require","exports","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","../../../core/E","src/g/share/ShareTools","../../../manager/RoleCenter","../../net/messages/share/sbkShareData","../../../manager/GameSocketManager","../../../manager/AM"],function(t,e,a,r,i,l,n,s,o,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t._entercdtime=0,t.btn_share.on(Laya.Event.CLICK,t,t.onShare),t.btn_close.on(Laya.Event.CLICK,t,t.close),t}return __extends(t,e),t.prototype.popup=function(){this.refresh(),e.prototype.popup.call(this)},t.prototype.close=function(){this.closeEffect=null,e.prototype.close.call(this),this.btn_share.off(Laya.Event.CLICK,this,this.close),this.btn_close.off(Laya.Event.CLICK,this,this.close),Laya.timer.clear(this,this.onGetShare),Laya.timer.once(100,this,function(){this.destroy()})},t.prototype.onShare=function(){var t=n.RoleCenter.instans.vo.shareData.hasGetFirstReward,e=n.RoleCenter.instans.vo.shareData.totalTime;0==t&&0<e?(l.ShareTools.fristShare(),i.E.ins.event("UPDATE_FIRSTSHARE_STATE"),this.close()):(this._entercdtime=Date.now()/1e3,l.ShareTools.startShare(this.onGetShare.bind(this)),Laya.timer.once(5e3,this,this.onGetShare))},t.prototype.onGetShare=function(){if(5e3<=Date.now()/1e3-this._entercdtime){var t=new s.openShareBoxC2GS;o.GSM.sendServer(t)}else h.AM.show("分享失败，请分享到微信群",new Laya.Handler(this,function(){l.ShareTools.startShare(null);var t=new s.openShareBoxC2GS;o.GSM.sendServer(t)}))},t.prototype.refresh=function(){for(var t=l.ShareTools.getShareJSON("ShouCangReward").reward,e=0;e<t.length;++e){var i=t[e][0],n=Number(t[e][1]),s=a.ItemUtils.getItemOrEq(i);if(s){var o=this["item"+e];r.ItemIconView.setItemData(s,o,n)}}},t}(ui.share1.ShareDlgUI);e.ShareDlg=c}),define("src/g/share/view/SharePreviewDlg",["require","exports","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","src/g/share/ShareTools"],function(t,e,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.btn_close.on(Laya.Event.CLICK,t,t.close),t}return __extends(t,e),t.prototype.popup=function(){this.refresh(),e.prototype.popup.call(this)},t.prototype.close=function(){e.prototype.close.call(this)},t.prototype.refresh=function(){for(var t=l.ShareTools.getShareJSON("CaseReward").reward,e=0;e<t.length;++e){var i=t[e][0],n=Number(t[e][1]),s=a.ItemUtils.getItemOrEq(i);if(s){var o=this["item"+e];r.ItemIconView.setItemData(s,o,n)}}},t}(ui.share1.SharePreviewDlgUI);e.SharePreviewDlg=i}),define("src/g/share/ctrl/ShareCtrl",["require","exports","../../../enum/EventName","../../../core/E","src/g/share/view/ShareActivityDig","src/init/Switches","../../net/messages/share/sbkShareData","../../../manager/GameSocketManager","src/g/share/view/ShareDlg","../../../manager/RoleCenter","src/g/share/view/SharePreviewDlg","src/g/share/ShareTools","../../../manager/NewRedHintsCenter","../../../manager/AM"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(){function t(){this._entertime=0;var t=o.Switches.ins;t.on(255,this,this.onOpenIdHandler,[255]),t.on(256,this,this.onOpenIdHandler,[256]),t.on(257,this,this.onOpenIdHandler,[257]),t.on(258,this,this.onOpenIdHandler,[258]),t.on(259,this,this.onOpenIdHandler,[259]),t.on(260,this,this.onOpenFirstHandler),t.on(261,this,this.destoryView),n.E.ins.once(i.EventName.INDEX_VIEW_INIT_COMPLET,this,this.onInit),h.RoleCenter.instans.on("UPDATE_SHARE_DATA",this,this.refreshHandler)}return t.prototype.refreshHandler=function(){this._view&&this._view.refresh(),this.redset()},t.prototype.redset=function(){var t=u.ShareTools.getShareJSON("OpenCaseBox").value;h.RoleCenter.instans.vo.shareData.todayShareTime<t?p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.qiuzhu,!0):p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.qiuzhu,!1)},t.prototype.onInit=function(){var t=window.ktgamepreloadjdk.frid;if(t){var e=new a.createSuccessC2GS;e.sharename=t,r.GSM.sendServer(e)}Laya.timer.once(2e3,this,this.redset)},t.prototype.onOpenFirstHandler=function(){(new l.ShareDlg).popup()},t.prototype.onShowPreview=function(){this.showPreview()},t.prototype.showPreview=function(t){void 0===t&&(t=!1),this.previewDlg||(this.previewDlg=new c.SharePreviewDlg),this.previewDlg.titleImage.skin=t?"res/share/getshareward.png":"res/share/fenxiang_preview.png",this.previewDlg.popup()},t.prototype.onOpenIdHandler=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1),e&&this.onOpenHandler(t,i,n)},t.prototype.addEvent=function(){this._view&&(this._view.btn_close.on(Laya.Event.CLICK,this,this.destoryView),this._view.lab_help_tips.on(Laya.Event.CLICK,this,this.onShowPreview),this._view.btn_open.on(Laya.Event.CLICK,this,this.onShare),this._view.closeHandler=Laya.Handler.create(this,this.destoryView))},t.prototype.removeEvent=function(){this._view&&(this._view.btn_close.off(Laya.Event.CLICK,this,this.destoryView),this._view.lab_help_tips.off(Laya.Event.CLICK,this,this.onShowPreview),this._view.btn_open.off(Laya.Event.CLICK,this,this.onShare),this._view.closeHandler=null)},t.prototype.onOpenHandler=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._view||(this._view=new s.ShareActivityDig),this.addEvent(),this._view.showView(t,e,i),this.redset()},t.prototype.destoryView=function(){this._view&&(this.removeEvent(),this._view.close()),Laya.timer.clear(this,this.onGetShare)},t.prototype.onGetShare=function(){if(console.error(this._entertime,Date.now()/1e3-this._entertime),5<=Date.now()/1e3-this._entertime){var t=new a.openShareBoxC2GS;r.GSM.sendServer(t),p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.qiuzhu,!1),this.sharepop()}else d.AM.alertTipOK("分享失败，请分享到微信群",new Laya.Handler(this,function(){}))},t.prototype.sharepop=function(){this._view.close(),h.RoleCenter.instans.vo.shareData.todayShareTime>=this._view.maxTime||this.showPreview(!0)},t.prototype.onShare=function(){var e=this;wx.getUserInfo({success:function(t){0<e._entertime?(Laya.timer.once(2e3,e,function(){var t=new a.openShareBoxC2GS;r.GSM.sendServer(t),p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.qiuzhu,!1),e.sharepop(),e._entertime=0}),u.ShareTools.startShare(null)):(e._entertime=Date.now()/1e3,u.ShareTools.startShare(e.onGetShare.bind(e)))},fail:function(t){n.E.ins.event(i.EventName.getUserInfo)}})},t}();e.ShareCtrl=g}),define("src/g/share/vo/ShareShopVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.id=0}return t.prototype.init=function(t,e){var i=0;this.id=t[i++],this.permit=t[i++]||0,this.daypermit=t[i++]||0,this.limit=t[i++]||0,this.itemid=t[i++],this.cost=t[i++],e[this.id]=this},t}();e.ShareShopVo=i}),define("src/g/share/view/ShareShopItem",["require","exports","../../../utils/ItemUtils","../../../manager/GameSocketManager","../../../manager/RoleCenter","src/g/peronboss/view/ItemIconView","../../net/messages/share/sbkShareData","src/g/share/ShareTools"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t.btn_buy.on(Laya.Event.CLICK,t,t.buyHandler),t}return __extends(t,e),t.prototype.buyHandler=function(){if(r.ShareTools.getPowerItemID()<parseInt(this.cost_txt.text))console.log("助力币不足");else if(this._vo){var t=new a.helpItemExchangeC2GS;t.shopCfgId=this._vo.id,n.GSM.sendServer(t)}},t.prototype.setData=function(t){this._vo=t;var e=i.ItemUtils.getItemOrEq(t.itemid[0][0]);this._itemVo=e,this.refresh()},t.prototype.refresh=function(){if(this.item_name.text=this._itemVo.name,o.ItemIconView.setItemData(this._itemVo,this.item,this._vo.itemid[0][1]),this.cost_txt.text=this._vo.cost[0][1]+"",this.item.lvl.visible=!1,this._vo.permit<=0&&this._vo.daypermit<=0)this.lab_state.text="无限制";else if(0<this._vo.permit&&this._vo.daypermit<=0){var t=this._vo.permit-this.findNum(this._vo.id,1);this.lab_state.text="永久限购("+t+"/"+this._vo.permit+")个",t<=0&&(this.btn_buy.disabled=!1)}else{t=this._vo.daypermit-this.findNum(this._vo.id,0);this.lab_state.text="每日限购("+t+"/"+this._vo.daypermit+")个",t<=0&&(this.btn_buy.disabled=!1)}},t.prototype.findNum=function(t,e){var i=s.RoleCenter.instans.vo.shareData.hasBuyCfgidArr.indexOf(t);if(-1!=i){var n=s.RoleCenter.instans.vo.shareData.hasBuyArr[i];if(n&&0==e)return n[0];if(n&&1==e)return n[1]}return 0},t}(ui.share1.ShareShopItemUI);e.ShareShopItem=l}),define("src/g/share/view/ShareShopStore",["require","exports","../../../config/GameConfig","src/g/clearRes/ClearResM","src/g/share/view/ShareShopItem","src/g/share/ShareTools","../../../manager/RoleCenter"],function(t,e,n,i,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.list.itemRender=s.ShareShopItem,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=50,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),a.RoleCenter.instans.on("UPDATE_SHARE_DATA",t,t.refreshHandler),t}return __extends(t,e),t.prototype.refreshHandler=function(){this.refreshList(),this.updateCost()},t.prototype.renderHandler=function(t,e){t.setData(this.list.array[e])},t.prototype.showView=function(t){t.addChild(this),this.visible=!0,i.ClearResM.resetViewImg(this),this.refreshHandler()},t.prototype.refreshList=function(){var t=[];for(var e in n.GameConfig.shareShopJSON){var i=n.GameConfig.shareShopJSON[e];i&&t.push(i)}this.list.array=t},t.prototype.updateCost=function(){var t=o.ShareTools.getPowerItemID();this.lab_cost.changeText(t.toString())},t}(ui.share1.ShareShopStoreUI);e.ShareShopStore=r}),define("src/g/share/view/ShareShopView",["require","exports","../../../enum/EventName","../../../core/E","../../../manager/LayerManager","src/g/proxy/MultiLevelUIProxy","src/g/clearRes/ClearResM","src/g/share/view/ShareShopStore"],function(t,e,n,s,o,i,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return t.bg.btn_close.on(Laya.Event.CLICK,t,t.closeHandler),t.btn_back.on(Laya.Event.CLICK,t,t.closeHandler),t._tabProxy=new i.MultiLevelUIProxy,t._tabProxy.registerTab(t.tab,0),t._tabProxy.registerTagIndex(261,0),t._tabProxy.selectHandler=new Laya.Handler(t,t.renderHandler),t}return __extends(t,e),t.prototype.showView=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),o.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),this._tabProxy.open(t),s.E.ins.on(n.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),a.ClearResM.resetViewImg(this)},t.prototype.closeHandler=function(){this.removeSelf()},t.prototype.closeClearRes=function(){console.log("ShareShopView clear"),s.E.ins.off(n.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),a.ClearResM.clearResFolder("shop/")},t.prototype.renderHandler=function(t){this._view||(this._view=new r.ShareShopStore),this._view.showView(this.box)},t}(ui.share1.ShareShopViewUI);e.ShareShopView=l}),define("src/g/share/ctrl/ShareShopCtrl",["require","exports","src/init/Switches","src/g/share/view/ShareShopView"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){i.Switches.ins.on(261,this,this.onOpenIdHandler,[261])}return t.prototype.onOpenIdHandler=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1),e&&this.onOpenHandler(t,i,n)},t.prototype.onOpenHandler=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._view||(this._view=new n.ShareShopView),this._view.showView(t,e,i)},t}();e.ShareShopCtrl=s}),define("src/g/crossserboss/csathletics/view/CSAthleticsMainView",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ui.crossserver.csathletics.CSAthleticsMainViewUI);e.CSAthleticsMainView=i}),define("src/g/crossserboss/vo/RyghVo",["require","exports","../../../utils/RoleUtil","../../../manager/RoleCenter"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.id=t[i++],this.name=t[i++],this.prop=t[i++],this.power=t[i++],this.desc=t[i++],this.times=t[i++],this.effect=t[i++],e[this.id]=this},t.prototype.getTotalPower=function(){return i.RoleUtil.calFightByProp(this.prop)*n.RoleCenter.instans.vo.heronum+this.power},t}();e.RyghVo=s}),define("src/g/crossserboss/csathletics/view/HaloTip",["require","exports","../../../../config/GameConfig","src/g/Effects/UIEffectsFactory","../../../../utils/ItemUtils"],function(t,e,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setHeloId=function(t,e){var i=l.GameConfig.Rygh[t];this.img_name.skin="res/csboss/kfjj_ghmsz_00"+i.id+".png",this.img_rank.skin=0<e&&e<=3?"res/csboss/kfjj_ghpm_00"+e+".png":0<e&&e<=10?"res/csboss/kfjj_ghpm_004.png":"",this.font_fight.value=i.getTotalPower()+"";for(var n=i.prop,s=0;s<n.length;s++){var o=n[s],a=this["lab_attr"+s];if(a){var r=c.ItemUtils.getShuXingByName(o[0]);a.text=r.desc+":"+o[1]}}h.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.ani,i.effect)},e}(ui.crossserver.csathletics.HaloTipUI);e.HaloTip=i}),define("src/g/crossserboss/csathletics/view/CSAthleticsPlayerListItem",["require","exports","../../../../enum/EventName","../../../../core/E","../../../../manager/RoleCenter","../../../../utils/RoleUtil","src/g/crossserboss/csathletics/view/HaloTip","../../../../config/GameConfig","src/g/Effects/UIEffectsFactory","src/g/crossserboss/csathletics/ctrl/CSAthleticsData","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._halo=0,t}return __extends(t,e),t.prototype.setData=function(t,e){this._data=t,n.E.ins.on(i.EventName.OTHERDATA_UPDATE,this,this.otherDataHandler),this.img_di.skin=3<t.rank?"res/csboss/kfjj_paimingdi_002.png":"res/csboss/kfjj_paimingdi_001.png",this.lab_name.color=s.RoleCenter.instans.vo.username==t.username?"#dcc026":"#ceb394",this.lab_name.changeText(t.nickname),this.lab_svrname.changeText(t.svrname),this.lab_score.changeText(t.jjcScore.toString()),this.font_rank.value=t.rank.toString(),t.rank<10?this.font_rank.scale(1,1):this.font_rank.scale(.6,.6),this._halo=0,t.rank<=e.length&&(this._halo=Number(e[t.rank-1])),this.btn_tip.visible=0<this._halo,this.btn_tip.on(Laya.Event.CLICK,this,this.showTip),this.btn_fight.on(Laya.Event.CLICK,this,this.goFight),this.btn_fight.visible=s.RoleCenter.instans.vo.username!=t.username,this.otherDataHandler()},t.prototype.clearAni=function(){for(var t=this.ani.numChildren-1;0<=t;){var e=this.ani.removeChildAt(t);e&&e.destroy(),t--}},t.prototype.showTip=function(){var t=new a.HaloTip;t.setHeloId(this._halo,this._data.rank),t.popup()},t.prototype.goFight=function(){h.CSAthleticsData.ins.reqToFight(this._data.svrid,this._data.username)},t.prototype.clear=function(){this.clearAni(),this.unlockRes(),n.E.ins.off(i.EventName.OTHERDATA_UPDATE,this,this.otherDataHandler),this._data=null,this.role.wing&&this.role.wing.clear(),this.role.weapon&&this.role.weapon.clear(),this.role.role&&this.role.role.clear(),this.role.ani_fumo&&this.role.ani_fumo.clear()},t.prototype.unlockRes=function(){for(var t=this.cachUrlArr?this.cachUrlArr.length:0,e=0;e<t;)c.ClearResM.clearCachUrl(this.cachUrlArr[e]),e++;this.cachUrlArr=null},t.prototype.lockRes=function(){for(var t=this.cachUrlArr?this.cachUrlArr.length:0,e=0;e<t;)c.ClearResM.setCachUrl(this.cachUrlArr[e]),e++},t.prototype.otherDataHandler=function(){this.clearAni(),this.unlockRes();var t=s.RoleCenter.instans.getOtherData(this._data.username);if(t&&(this.cachUrlArr=o.RoleUtil.refreshZww(t.openhero[0],100,this.role.wing,this.role.weapon,this.role.role,this.role.ani_fumo),this.lockRes(),n.E.ins.off(i.EventName.OTHERDATA_UPDATE,this,this.otherDataHandler),0<this._halo)){var e=r.GameConfig.Rygh[this._halo];l.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.ani,e.effect)}},t}(ui.crossserver.csathletics.CSAthleticsPlayerListItemUI);e.CSAthleticsPlayerListItem=u}),define("src/g/crossserboss/csathletics/view/CSAthleticsRecordItem",["require","exports","../../../../utils/system/DateUitl","src/g/crossserboss/csathletics/ctrl/CSAthleticsData","src/init/TextConst"],function(t,e,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.htxt_desc.style.font="SimHei",t.htxt_desc.style.fontSize=20,t.htxt_desc.style.color="#ceb394",t.htxt_title.style.font="SimHei",t.htxt_title.style.fontSize=20,t.htxt_title.style.color="#ceb394",t}return __extends(t,e),t.prototype.setData=function(t){var e=t.category,i=t.addScore,n=t.result;this.lab_time.changeText(o.DateUtil.getYTD_hms(1e3*t.createTime,"y-t-d h:m:s")),this.htxt_title.innerHTML=t.isOwner?r.TextConst.get(1049,this.getAction(e),t.otherSvrname,t.otherNickname):r.TextConst.get(1046,t.otherSvrname,t.otherNickname,this.getAction(e));var s=this.htxt_desc;t.isOwner?s.innerHTML=r.TextConst.get(1050,this.getAction(e),n?r.TextConst.get(661):r.TextConst.get(662),i):s.innerHTML=n?0==e?r.TextConst.get(1048,this.getAction(e),i):r.TextConst.get(1047,this.getAction(e),i):r.TextConst.get(1050,this.getAction(e),n?r.TextConst.get(661):r.TextConst.get(662),i),this.btn_fight.offAll(),n&&1!=t.state?(this.btn_fight.visible=!0,this.btn_fight.label=this.getReplyAction(t.isOwner,e),this.btn_fight.on(Laya.Event.CLICK,this,function(){a.CSAthleticsData.ins.reqToFight(t.otherSvrid,t.otherUsername,t.isOwner?0:0==e?1:2,t.recordId)})):this.btn_fight.visible=!1},t.prototype.getAction=function(t){return 0==t?r.TextConst.get(341):1==t?r.TextConst.get(1051):2==t?r.TextConst.get(1052):""},t.prototype.getReplyAction=function(t,e){return t?r.TextConst.get(1053):0==e?r.TextConst.get(1051):1==e?r.TextConst.get(1052):2==e?r.TextConst.get(1052):void 0},t}(ui.crossserver.csathletics.CSAthleticsRecordItemUI);e.CSAthleticsRecordItem=i}),define("src/g/crossserboss/csathletics/view/CSAthleticsRecordDlg",["require","exports","src/g/crossserboss/csathletics/ctrl/CSAthleticsData","src/g/crossserboss/csathletics/view/CSAthleticsRecordItem"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.bg.btn_back.on(Laya.Event.CLICK,t,t.doCloseHandler),t.bg.btn_close.on(Laya.Event.CLICK,t,t.doCloseHandler),t.list_info.itemRender=n.CSAthleticsRecordItem,t.list_info.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t}return __extends(t,e),t.prototype.onListRenderHandler=function(t,e){t.setData(t.dataSource)},t.prototype.doCloseHandler=function(){this.close(),this._data&&(this._data.off(i.CSAthleticsData.CHALLENGE_RECORD_CHANGED,this,this.onChallengeDataChanged),this._data=null)},t.prototype.setData=function(t){this._data&&this._data.off(i.CSAthleticsData.CHALLENGE_RECORD_CHANGED,this,this.onChallengeDataChanged),this._data=t,this._data&&this._data.on(i.CSAthleticsData.CHALLENGE_RECORD_CHANGED,this,this.onChallengeDataChanged),this.onChallengeDataChanged()},t.prototype.onChallengeDataChanged=function(){this._data&&this._data.recordListData&&(this.list_info.array=this._data.recordListData.recordList.concat().reverse())},t}(ui.crossserver.csathletics.CSAthleticsRecordUI);e.CSAthleticsRecordDlg=s}),define("src/g/crossserboss/view/CSCheckGh",["require","exports","../../../manager/GameSocketManager","../../net/messages/sbkHaloData","../../../manager/RoleCenter","../../../config/GameConfig","../../../utils/system/ServerTime","../../../utils/ItemUtils","src/g/Effects/UIEffectsFactory","../../../utils/system/DateUitl","../../../plugin/sbkPropTool","../../../enum/EventName","src/init/TextConst"],function(t,e,n,s,u,p,d,g,v,f,o,a,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;return t.bg.btn_close.on(Laya.Event.CLICK,t,t.close),t.list_gh.renderHandler=new Laya.Handler(t,t.renderHandler),t}return __extends(t,i),t.prototype.popup=function(t,e){i.prototype.popup.call(this,t,e),this.refresh(),n.GSM.ins.on(s.sbkHaloData.KEY,this,this.haloData)},t.prototype.renderHandler=function(t){var e=t.getChildByName("img_name"),i=t.getChildByName("img_rank"),n=t.getChildByName("font_fight"),s=t.dataSource,o=s.id,a=this.list_gh.array.length-o+1;e.skin="res/csboss/kfjj_ghmsz_00"+o+".png",i.skin="res/csboss/kfjj_ghpm_00"+a+".png",n.value=s.getTotalPower()+"";for(var r=s.prop,l=0;l<r.length;l++){var h=r[l],c=t.getChildByName("lab_p"+l);if(c){var u=g.ItemUtils.getShuXingByName(h[0]);c.text=u.desc+":"+h[1]}}v.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.getChildByName("ani"),s.effect)},t.prototype.refresh=function(){var t=u.RoleCenter.instans.vo._vo.haloData,e=p.GameConfig.Rygh,i=t.curId,n=0!=i,s=d.ServerTime.serverTime,o=this.box_time,a=this.lab_ghName;if(o.visible=n){var r=t.endTimeArr[t.idArr.indexOf(i)];o.visible=0!=r&&s<=r,a.text=e[i].name;var l=r-s;this.count=l,this.lab_ghTime.text=f.DateUtil.getHMS_countdown(l),Laya.timer.loop(1e3,this,this.loopHandler),this.loopHandler()}else a.text=y.TextConst.get(485);var h=[];for(var c in e)h.push(e[c]);h.sort(function(t,e){return e.id-t.id}),this.list_gh.array=h},t.prototype.loopHandler=function(){var t=this.count;if(t--,(this.count=t)<=0){this.lab_ghName.text=y.TextConst.get(485),this.box_time.visible=!1;var e=u.RoleCenter.instans.vo,i=e.combat;return o.sbkPropTool.resetHalo(),void u.RoleCenter.instans.event(a.EventName.FIGHT_UP,e.reCheckComBat()-i)}this.lab_ghTime.text=f.DateUtil.getHMS_countdown(t)},t.prototype.close=function(t,e){i.prototype.close.call(this,t,e),n.GSM.ins.off(s.sbkHaloData.KEY,this,this.haloData),Laya.timer.clear(this,this.loopHandler)},t.prototype.haloData=function(t){this.refresh()},t}(ui.crossserver.csathletics.CSCheckGhUI);e.CSCheckGh=i}),define("src/g/crossserboss/csathletics/view/CSAthleticsPlayerListPage",["require","exports","src/g/crossserboss/csathletics/ctrl/CSAthleticsData","../../../net/messages/kuafu/KfjjcMsg","../../../../config/GameConfig","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","src/g/crossserboss/csathletics/view/CSAthleticsPlayerListItem","../../../../core/GNet","../../../../manager/GameSocketManager","../../../../manager/RoleCenter","../../../../manager/AM","src/g/crossserboss/csathletics/view/CSAthleticsRecordDlg","src/g/crossserboss/view/CSCheckGh","../../../../utils/system/FloatEffect","src/g/clearRes/ClearResM","src/init/TextConst","src/init/Switches"],function(t,e,i,o,a,s,r,l,n,h,c,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=function(e){function t(){var t=e.call(this)||this;return t.playerItemPool=[],t.btn_add.on(Laya.Event.CLICK,t,t.doBuyChallengeCount),t.btn_halo.on(Laya.Event.CLICK,t,t.openHalo),t.lab_record.on(Laya.Event.CLICK,t,t.openRecordDlg),t}return __extends(t,e),t.prototype.setData=function(t){this._data&&this._data.off(i.CSAthleticsData.CHALLENGE_DATA_CHANGED,this,this.onChallengeDataChanged),this._data=t,this._data&&this._data.on(i.CSAthleticsData.CHALLENGE_DATA_CHANGED,this,this.onChallengeDataChanged),this.onChallengeDataChanged()},t.prototype.onChallengeDataChanged=function(){if(Laya.timer.clear(this,this.cooldownHandler),this._data&&this._data.challengeData){var t=a.GameConfig.kfjjcVoCfg.rechance,e=Number(t.value);this.lab_myrank.changeText(this._data.challengeData.myRank.toString()),this.lab_myscore.changeText(this._data.challengeData.myScore.toString()),this.lab_count.changeText((e-this._data.challengeData.count).toString()),0==this._data.challengeData.count?this.lab_cd.changeText("已满"):this.cooldownHandler(),this.updatePlayerList(this._data.challengeData.playerArr)}},t.prototype.cooldownHandler=function(){if(this._data&&this._data.challengeData){var t=s.ServerTime.serverTime,e=a.GameConfig.kfjjcVoCfg.cd,i=Number(e.value),n=i-(t-this._data.challengeData.restoreTime)%i;0<n?this.lab_cd.changeText(r.DateUtil.getHMS_countdown(n)):this.lab_cd.changeText("00:00:00"),Laya.timer.once(1e3,this,this.cooldownHandler)}},t.prototype.hidePage=function(){this._data&&this._data.off(i.CSAthleticsData.CHALLENGE_DATA_CHANGED,this,this.onChallengeDataChanged),Laya.timer.clear(this,this.cooldownHandler),this.clearAllPlayer()},t.prototype.clearAllPlayer=function(){for(var t,e=this.player_con.numChildren-1;0<=e;)(t=this.player_con.removeChildAt(e))&&t.clear(),e--},t.prototype.updatePlayerList=function(t){this.clearAllPlayer();var e,i=t.length,n=0,s=a.GameConfig.kfjjcVoCfg.ghreward.value.split(",");for(this.requestRoleList=t.concat();n<i;)(e=new l.CSAthleticsPlayerListItem).setData(t[n],s),e.x=(this.player_con.width/2-e.width)/2,n%2!=0&&(e.x+=this.player_con.width/2),e.y=60+n*e.height*.6,this.player_con.addChild(e),n++;this.doRequestRoleInfo()},t.prototype.doRequestRoleInfo=function(){if(this.requestRoleList&&0<this.requestRoleList.length){var t=this.requestRoleList.shift();n.GNet.getOtherData([t.username],!1,t.svrid),Laya.timer.once(100,this,this.doRequestRoleInfo)}},t.prototype.getVipAddCount=function(){var t=a.GameConfig.vipJSON[c.RoleCenter.instans.vo.VIP.toString()];for(var e in t.reward){var i=t.reward[e];if(i&&"JJCBUYCOUNT"==i[0])return i[1]}return 0},t.prototype.doBuyChallengeCount=function(){var t=a.GameConfig.kfjjcVoCfg.rechance;if(this._data&&this._data.challengeData&&0<this._data.challengeData.count){t=a.GameConfig.kfjjcVoCfg.maxbuycount;var e=Number(t.value)+this.getVipAddCount();if(this._data.challengeData.buyCount<e){var i=(t=a.GameConfig.kfjjcVoCfg.buycost).value.split(","),n=Math.min(this._data.challengeData.buyCount,i.length-1),s=Number(i[n]);if(c.RoleCenter.instans.GOLD<s)return void y.Switches.ins.event(155);u.AM.showAdvanced(f.TextConst.get(1045,s,e-this._data.challengeData.buyCount),new Laya.Handler(this,function(){h.GSM.sendServer(new o.KfjjcBuyCountC2GS)}))}else g.FE.upItems(f.TextConst.get(1054))}else g.FE.upItems(f.TextConst.get(1055))},t.prototype.openHalo=function(){var t=this.haloDlg;t||(this.haloDlg=t=new d.CSCheckGh),v.ClearResM.resetViewImg(this.haloDlg),t.isPopup||t.popup()},t.prototype.openRecordDlg=function(){this._recordDlg||(this._recordDlg=new p.CSAthleticsRecordDlg),h.GSM.sendServer(new o.KfjjcGetRecordListC2GS),this._recordDlg.setData(this._data),v.ClearResM.resetViewImg(this._recordDlg),this._recordDlg.isPopup||this._recordDlg.popup()},t}(ui.crossserver.csathletics.CSAthleticsPlayerListUI);e.CSAthleticsPlayerListPage=m}),define("src/g/crossserboss/csathletics/ctrl/CSAthleticsPlayerListPageCtrl",["require","exports","src/g/crossserboss/csathletics/view/CSAthleticsPlayerListPage","../../../../manager/GameSocketManager","../../../net/messages/kuafu/KfjjcMsg","src/g/clearRes/ClearResM","../../../../utils/system/DateUitl","../../../../utils/system/ServerTime"],function(t,e,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(){},t.prototype.showPage=function(t,e){if(t){t.removeChildren(),this._view||(this._view=new n.CSAthleticsPlayerListPage),this._view.setData(e),t.addChild(this._view),a.ClearResM.resetViewImg(this._view),s.GSM.sendServer(new o.KfjjcGetChallengeListC2GS);var i=r.DateUtil.getZeroTime()-l.ServerTime.serverTime;i<3600&&Laya.timer.once(1e3*(i+10),this,this.reRequestHandler)}},t.prototype.reRequestHandler=function(){s.GSM.sendServer(new o.KfjjcGetChallengeListC2GS)},t.prototype.loadUrls=function(){},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){},t.prototype.getTitle=function(){return"res/csboss/kfjj_biaotizi_001.png"},t.prototype.hidePage=function(){Laya.timer.clear(this,this.reRequestHandler),this._view&&this._view.hidePage()},t.prototype.destroyPage=function(){},t}();e.CSAthleticsPlayerListPageCtrl=i}),define("src/g/crossserboss/csathletics/view/CSAthleticsRankPage",["require","exports","src/g/crossserboss/csathletics/ctrl/CSAthleticsData"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.tab.selectHandler=new Laya.Handler(t,t.onTabSelectHandler),t.list_rank.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t}return __extends(t,e),t.prototype.onTabSelectHandler=function(t){this._data&&this._data.ranklistData&&(this.list_rank.array=0==t?this._data.ranklistData.playerArr:this._data.ranklistData.familyArr,this.lab_rank_lab.changeText(0==t?"我的排名:":"行会排名:"),this.lab_rank.changeText(0==t?this._data.ranklistData.myUserRank+"":this._data.ranklistData.myFamilyRank+""))},t.prototype.setData=function(t){this._data&&this._data.off(i.CSAthleticsData.RANK_DATA_CHANGED,this,this.onRankListDataChanged),this._data=t,this._data&&this._data.on(i.CSAthleticsData.RANK_DATA_CHANGED,this,this.onRankListDataChanged),0==this.tab.selectedIndex?this.onTabSelectHandler(this.tab.selectedIndex):this.tab.selectedIndex=0},t.prototype.onRankListDataChanged=function(){this.onTabSelectHandler(this.tab.selectedIndex)},t.prototype.onListRenderHandler=function(t,e){var i=t.dataSource;i&&(t.img_rank.visible=!0,t.lab_rank.visible=!1,1==i.rank?t.img_rank.skin="res/rank/new/paihang_huizhang1st.png":2==i.rank?t.img_rank.skin="res/rank/new/paihang_huizhang2st.png":3==i.rank?t.img_rank.skin="res/rank/new/paihang_huizhang3st.png":(t.img_rank.visible=!1,t.lab_rank.visible=!0,t.lab_rank.changeText(i.rank.toString())),t.lab_name.changeText(0==this.tab.selectedIndex?i.nickname:i.familyname),t.lab_svr.changeText(i.svrname),t.lab_score.changeText(i.jjcScore.toString()))},t.prototype.hidePage=function(){this._data&&this._data.off(i.CSAthleticsData.LAST_RANK_DATA_CHANGED,this,this.onRankListDataChanged)},t}(ui.crossserver.csathletics.CSAthleticsRankUI);e.CSAthleticsRankPage=n}),define("src/g/crossserboss/csathletics/ctrl/CSAthleticsRankPageCtrl",["require","exports","src/g/crossserboss/csathletics/view/CSAthleticsRankPage","../../../../manager/GameSocketManager","../../../net/messages/kuafu/KfjjcMsg","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){}return t.prototype.init=function(){},t.prototype.showPage=function(t,e){t&&(t.removeChildren(),this._view||(this._view=new i.CSAthleticsRankPage),this._view.setData(e),t.addChild(this._view),o.ClearResM.resetViewImg(this._view),n.GSM.sendServer(new s.KfjjcGetRankC2GS))},t.prototype.loadUrls=function(){},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){},t.prototype.getTitle=function(){return"res/csboss/kfjj_biaotizi_002.png"},t.prototype.hidePage=function(){this._view&&this._view.hidePage()},t.prototype.destroyPage=function(){},t}();e.CSAthleticsRankPageCtrl=a}),define("src/g/crossserboss/csathletics/view/CSAthleticsRewardItem",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItem0View(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.setData=function(t){this.img_rank.visible=!0,this.lab_rank.visible=!1,"1"==t.label?this.img_rank.skin="res/rank/new/paihang_huizhang1.png":"2"==t.label?this.img_rank.skin="res/rank/new/paihang_huizhang2.png":"3"==t.label?this.img_rank.skin="res/rank/new/paihang_huizhang3.png":(this.img_rank.visible=!1,this.lab_rank.visible=!0,this.lab_rank.changeText(t.label)),this.list_item.array=t.reward},t}(ui.crossserver.csathletics.CSAthleticsRewardItemUI);e.CSAthleticsRewardItem=s}),define("src/g/crossserboss/csathletics/view/CSAthleticsRewardPage",["require","exports","../../../../config/GameConfig","src/g/crossserboss/csathletics/view/CSAthleticsRewardItem"],function(t,e,o,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.tab.selectHandler=new Laya.Handler(t,t.onTabSelectHandler),t.list_rank.itemRender=i.CSAthleticsRewardItem,t.list_rank.renderHandler=new Laya.Handler(t,t.onListRenderHandler),t.initPersonlReward(),t.initFamilyReward(),t.tab.selectedIndex=0,t}return __extends(t,e),t.prototype.initPersonlReward=function(){this._personlReward=[];var t,e,i=1,n=0;for(var s in o.GameConfig.kfjjcRewardVoCfg)1==(e=o.GameConfig.kfjjcRewardVoCfg[s]).type&&(t=0<(n=Number(e.rank))-i?i+"-"+n:e.rank.toString(),i=n+1,this._personlReward.push({label:t,reward:e.clientreward}))},t.prototype.initFamilyReward=function(){this._familyReward=[];var t,e,i=1,n=0;for(var s in o.GameConfig.kfjjcRewardVoCfg)2==(e=o.GameConfig.kfjjcRewardVoCfg[s]).type&&(t=0<(n=Number(e.rank))-i?i+"-"+n:e.rank.toString(),i=n+1,this._familyReward.push({label:t,reward:e.clientreward}))},t.prototype.onTabSelectHandler=function(t){this.list_rank.array=0==t?(this.lab_title.changeText("个人奖励"),this._personlReward):(this.lab_title.changeText("行会奖励（活动结束后进入行会拍卖行）"),this._familyReward)},t.prototype.onListRenderHandler=function(t,e){t.setData(t.dataSource)},t}(ui.crossserver.csathletics.CSAthleticsRewardUI);e.CSAthleticsRewardPage=n}),define("src/g/crossserboss/csathletics/ctrl/CSAthleticsRewardPageCtrl",["require","exports","src/g/crossserboss/csathletics/view/CSAthleticsRewardPage","src/g/clearRes/ClearResM"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.prototype.init=function(){},t.prototype.showPage=function(t,e){t&&(t.removeChildren(),this._view||(this._view=new i.CSAthleticsRewardPage),t.addChild(this._view),n.ClearResM.resetViewImg(this._view))},t.prototype.loadUrls=function(){},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){},t.prototype.getTitle=function(){return""},t.prototype.hidePage=function(){},t.prototype.destroyPage=function(){},t}();e.CSAthleticsRewardPageCtrl=s}),define("src/g/crossserboss/csathletics/view/CSAthleticsPreRankPage",["require","exports","src/g/crossserboss/csathletics/ctrl/CSAthleticsData","../../../../config/GameConfig","../../../../core/GNet","../../../../core/E","../../../../enum/EventName","../../../../utils/RoleUtil","../../../../manager/RoleCenter","src/g/Effects/UIEffectsFactory","src/g/clearRes/ClearResM"],function(t,e,i,a,n,r,l,o,h,c,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t.requestIndex=0,t.filled=[],t.tab.selectHandler=new Laya.Handler(t,t.onTabSelectHandler),t.tab.selectedIndex=0,t.list_rank.renderHandler=new Laya.Handler(t,t.onPersonlListRenderHandler),t.list_rank_family.renderHandler=new Laya.Handler(t,t.onFamilyListRenderHandler),t}return __extends(t,e),t.prototype.onTabSelectHandler=function(t){this.box_family.visible=1==t,this.box_personl.visible=0==t},t.prototype.onPersonlListRenderHandler=function(t,e){var i=t.dataSource;i&&(t.img_rank.visible=!0,t.lab_rank.visible=!1,1==i.rank?t.img_rank.skin="res/rank/new/paihang_huizhang1st.png":2==i.rank?t.img_rank.skin="res/rank/new/paihang_huizhang2st.png":3==i.rank?t.img_rank.skin="res/rank/new/paihang_huizhang3st.png":(t.img_rank.visible=!1,t.lab_rank.visible=!0,t.lab_rank.changeText(i.rank.toString())),t.lab_name.changeText(i.nickname),t.lab_svr.changeText(i.svrname),t.lab_score.changeText(i.jjcScore.toString()))},t.prototype.onFamilyListRenderHandler=function(t,e){var i=t.dataSource;i&&(t.img_rank.visible=!0,t.lab_rank.visible=!1,1==i.rank?t.img_rank.skin="res/rank/new/paihang_huizhang1st.png":2==i.rank?t.img_rank.skin="res/rank/new/paihang_huizhang2st.png":3==i.rank?t.img_rank.skin="res/rank/new/paihang_huizhang3st.png":(t.img_rank.visible=!1,t.lab_rank.visible=!0,t.lab_rank.changeText(i.rank.toString())),t.lab_name.changeText(i.familyname),t.lab_svr.changeText(i.svrname),t.lab_score.changeText(i.jjcScore.toString()))},t.prototype.setData=function(t){this._data&&this._data.off(i.CSAthleticsData.LAST_RANK_DATA_CHANGED,this,this.onRankListDataChanged),this._data=t,this._data&&this._data.on(i.CSAthleticsData.LAST_RANK_DATA_CHANGED,this,this.onRankListDataChanged),this.onRankListDataChanged()},t.prototype.onRankListDataChanged=function(){if(this._data&&this._data.lastRankListData){var t,e=this._data.lastRankListData.playerArr.sort(function(t,e){return t.rank-e.rank}),i=e.length,n=a.GameConfig.kfjjcVoCfg.ghreward.value.split(","),s=1;for(this.requestRoleList=[];s<=3;){if(t=s<=i?e[s-1]:null){this["lab_svr"+s].changeText(t.svrname),this["lab_name"+s].changeText(t.nickname),this["lab_score"+s].changeText("积分:"+t.jjcScore.toString()),this["img_buff"+s].skin="res/csboss/kfjj_ghmsz_00"+n[s-1]+".png",this["title"+s].visible=!0,this.requestRoleList.push(t);var o=a.GameConfig.Rygh[n[s-1]];c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this["ani"+s],o.effect)}else this["lab_svr"+s].changeText(""),this["lab_name"+s].changeText(""),this["lab_score"+s].changeText(""),this["title"+s].visible=!1,this.clearAni(this["ani"+s]);s++}this.requestIndex=0,this.filled.length=0,this.doRequestRoleInfo(),r.E.ins.on(l.EventName.OTHERDATA_UPDATE,this,this.otherDataHandler),this.list_rank.array=3<i?e.slice(3):null,this.list_rank_family.array=this._data.lastRankListData.familyArr,this.unlockRes(),this.otherDataHandler()}},t.prototype.clearAni=function(t){for(var e=t.numChildren-1;0<=e;){var i=t.removeChildAt(e);i&&i.destroy(),e--}},t.prototype.unlockRes=function(){for(var t=this.cachUrlArr?this.cachUrlArr.length:0,e=0;e<t;)s.ClearResM.clearCachUrl(this.cachUrlArr[e]),e++;this.cachUrlArr=null},t.prototype.lockRes=function(t){for(var e=t?t.length:0,i=0;i<e;)s.ClearResM.setCachUrl(t[i]),i++},t.prototype.doRequestRoleInfo=function(){var t=this.requestRoleList?this.requestRoleList.length:0;if(this.requestIndex<t){var e=this.requestRoleList[this.requestIndex];this.requestIndex++,n.GNet.getOtherData([e.username],!1,e.svrid),Laya.timer.once(100,this,this.doRequestRoleInfo)}},t.prototype.otherDataHandler=function(){var t,e=0,i=0;this.cachUrlArr=[];for(var n=Math.min(3,this.requestRoleList.length);e<n;){if(i=e+1,(t=h.RoleCenter.instans.getOtherData(this.requestRoleList[e].username))&&-1==this.filled.indexOf(i)){this.filled.push(i);var s=o.RoleUtil.refreshZww(t.openhero[0],100,this["role"+i].wing,this["role"+i].weapon,this["role"+i].role,this["role"+i].ani_fumo);s&&(this.lockRes(s),this.cachUrlArr=this.cachUrlArr.concat(s))}e++}},t.prototype.hidePage=function(){this._data&&this._data.off(i.CSAthleticsData.LAST_RANK_DATA_CHANGED,this,this.onRankListDataChanged),r.E.ins.off(l.EventName.OTHERDATA_UPDATE,this,this.otherDataHandler)},t}(ui.crossserver.csathletics.CSAthleticsPreRankUI);e.CSAthleticsPreRankPage=u}),define("src/g/crossserboss/csathletics/ctrl/CSAthleticsPreRankPageCtrl",["require","exports","src/g/crossserboss/csathletics/view/CSAthleticsPreRankPage","../../../../manager/GameSocketManager","../../../net/messages/kuafu/KfjjcMsg","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){}return t.prototype.init=function(){},t.prototype.showPage=function(t,e){t&&(t.removeChildren(),this._view||(this._view=new i.CSAthleticsPreRankPage),this._view.setData(e),t.addChild(this._view),o.ClearResM.resetViewImg(this._view),n.GSM.sendServer(new s.KfjjcGetLastRankC2GS))},t.prototype.loadUrls=function(){},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){},t.prototype.getTitle=function(){return"res/csboss/kfjj_biaotizi_004.png"},t.prototype.hidePage=function(){this._view&&this._view.hidePage()},t.prototype.destroyPage=function(){},t}();e.CSAthleticsPreRankPageCtrl=a}),define("src/g/crossserboss/csathletics/ctrl/CSAthleticsMainViewCtrl",["require","exports","src/g/crossserboss/csathletics/view/CSAthleticsMainView","../../../../utils/SoundUtils","src/g/clearRes/ClearResM","../../../../manager/LayerManager","src/g/crossserboss/csathletics/ctrl/CSAthleticsPlayerListPageCtrl","src/g/crossserboss/csathletics/ctrl/CSAthleticsRankPageCtrl","src/g/crossserboss/csathletics/ctrl/CSAthleticsRewardPageCtrl","src/g/crossserboss/csathletics/ctrl/CSAthleticsPreRankPageCtrl","src/g/crossserboss/csathletics/ctrl/CSAthleticsData","../../../../manager/GameSocketManager","../../../net/messages/sbkHaloData","../../../../manager/RoleCenter","src/g/fight/osprite/SceneObjCtroller","../../../../core/E","../../../../enum/EventName","../../../net/messages/kuafu/KfjjcMsg","src/init/Switches"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(){function t(){this.data=c.CSAthleticsData.ins,m.Switches.ins.on(243,this,this.onOpenHandler,[243]),u.GSM.ins.on(p.sbkHaloData.KEY,this,this.onHaloDataUpdated),v.E.ins.on(f.EventName.INIT_INDEX,this,this.onInit)}return t.prototype.onInit=function(){u.GSM.sendServer(new y.KfjjcOpenStateC2GS)},t.prototype.onHaloDataUpdated=function(t){d.RoleCenter.instans.vo.haloData.copydata(t);var e=g.SceneObjCtroller.ins.getSelfGroup();e&&e.refreshHalo()},t.prototype.onOpenHandler=function(t,e){e&&(this._view||(this._view=new i.CSAthleticsMainView,this._view.bgview.btn_close.on(Laya.Event.CLICK,this,this.closeHander,[!0]),this._view.bgview.btn_back.on(Laya.Event.CLICK,this,this.closeHander,[!0]),this._view.tab.selectHandler=new Laya.Handler(this,this.onSelectTabHandler)),o.LayerManager.addInPOPWindowLayer(this._view),s.ClearResM.resetViewImg(this._view),0==this._view.tab.selectedIndex?this.onSelectTabHandler(0):this._view.tab.selectedIndex=0)},t.prototype.onSelectTabHandler=function(t){switch(this._view.bgview.box_page.removeChildren(),this._selectPage&&this._selectPage.hidePage(),t){case 0:this.playerlist||(this.playerlist=new a.CSAthleticsPlayerListPageCtrl),this._selectPage=this.playerlist;break;case 1:this.rank||(this.rank=new r.CSAthleticsRankPageCtrl),this._selectPage=this.rank;break;case 2:this.rankReward||(this.rankReward=new l.CSAthleticsRewardPageCtrl),this._selectPage=this.rankReward;break;case 3:this.perRank||(this.perRank=new h.CSAthleticsPreRankPageCtrl),this._selectPage=this.perRank}this._selectPage&&(this._selectPage.showPage(this._view.bgview.box_page,this.data),this._view.bgview.img_title.skin=this._selectPage.getTitle())},t.prototype.closeHander=function(t){t&&n.SoundUtils.getInstance().playBtnsounds(),this._view&&this._view.removeSelf(),s.ClearResM.clearResFolder("csboss")},t}();e.CSAthleticsMainViewCtrl=_}),define("src/g/copy/view/teamcopy/TeamCopyFightWinDlg",["require","exports","../../../../config/GameConfig","src/g/bag/tips/view/ItemTips","../../../../utils/ItemCellUtils","../../../net/messages/ActivityMessage","../../../../utils/ItemUtils","src/g/friend/ctrl/FriendsDataManager","../../../net/messages/friend/FriendMsg","../../../../manager/GameSocketManager","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../meta/CommonVo","../../../net/messages/HelpFightMsg","../../../../manager/RoleCenter","../../../../utils/system/DateUitl","src/init/TextConst"],function(t,e,u,i,n,p,d,s,o,g,a,r,v,f,y,m,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t._cd=0,t.isCaptain=!1,t.box_reward.itemRender=ui.custom.ItemNameViewUI,t.box_reward.renderHandler=new Laya.Handler(t,t.onListRender),t.box_reward.clickHandler=new Laya.Handler(t,t.onMouseListRender),t}return __extends(t,e),t.prototype.onMouseListRender=function(t){i.ItemTips.ins.showTip(this.box_reward.array[t][0],Number(this.box_reward.array[t][1]))},t.prototype.onListRender=function(t,e){n.ItemCellUtils.fillCellForItemNameView(t,this.box_reward.array[e][0],Number(this.box_reward.array[e][1]))},t.prototype.showPage=function(t,e,i,n){this._exitHandler=i,this._continueHandler=n,this.box_reward.array=d.ItemUtils.inv2ItemArr(e.inventory);var s=0;if(t){var o=t.teamState.captain;this.isCaptain=o.username==y.RoleCenter.instans.vo.username,this.imghead.skin=d.ItemUtils.getHeadUrl(o.sex,o.job),this.txt_Name.changeText(o.nickname),this.lab_assister_name0.visible=this.lab_assister_name1.visible=!1,this.lab_assister_add0.visible=this.lab_assister_add1.visible=!1,this.lab_assister_add0.offAll(),this.lab_assister_add1.offAll();for(var a=t.teamState.member,r=a.length,l=0;l<r;)o=a[l],this["lab_assister_name"+l].visible=!0,this["lab_assister_name"+l].changeText(o.nickname),l++;var h=u.GameConfig.teamCopyVoCfg[t.level+1];h&&h.day<=m.DateUtil.getKFDay()&&(s=t.level+1)}(this.btn_continue.offAll(),this.btn_get.offAll(),this.btn_continue.visible=!1,this.lab_wait.visible=!this.isCaptain,this.btn_get.visible=this.isCaptain,this.lab_desc.visible=!1,this.isCaptain)&&(this.btn_get.on(Laya.Event.CLICK,this,this.doClose),0<s?(this.btn_continue.disabled=!1,this.btn_get.x=100,this.btn_continue.visible=!0,this.btn_continue.on(Laya.Event.CLICK,this,this.doContinue,[s]),this.btn_continue.visible=!0,-1!=y.RoleCenter.instans.vo.portstatus.hfData.legendData.curWeekLegend.indexOf(s)&&(this.btn_continue.disabled=!0,this.lab_desc.visible=!0)):this.btn_get.x=211);var c=v.CommonVo.getVoByKey("jiesuandaojishi");this._cd=null!=c?Number(c.value):5,this.isCaptain||(this._cd+=2),this.cdHandler(),this.isCaptain||(g.GSM.ins.on(p.exitLegenC2GS.KEY,this,this.doClose),g.GSM.ins.on(f.HelpFightStartGS2C.KEY,this,this.captainContinue)),this.popup()},t.prototype.captainContinue=function(){e.prototype.close.call(this)},t.prototype.cdHandler=function(){Laya.timer.clear(this,this.cdHandler),0<this._cd?(this.isCaptain?this.btn_get.label=l.TextConst.get(244,this._cd):this.lab_wait.text=l.TextConst.get(1300,this._cd),this._cd--,Laya.timer.once(1e3,this,this.cdHandler)):this.doClose()},t.prototype.doContinue=function(){this._continueHandler&&this._continueHandler.run(),e.prototype.close.call(this)},t.prototype.doClose=function(){this._exitHandler&&this._exitHandler.run(),e.prototype.close.call(this)},t.prototype.canAddFriend=function(t){if(t==y.RoleCenter.instans.vo.username)return!1;var e=s.FriendsDataManager.ins.getFriendDataByUsername(t);if(e){if(s.FriendsDataManager.belongTo(e,o.enumFrdType.friend|o.enumFrdType.friendDouble))return!1;if(s.FriendsDataManager.belongTo(e,o.enumFrdType.black))return!1;if(s.FriendsDataManager.belongTo(e,o.enumFrdType.apply))return!1}return!0},t.prototype.addFriend=function(t,e){this["lab_assister_add"+e].visible=!1,this["lab_assister_add"+e].offAll();var i=new o.AddFriendC2GS;i.type=o.enumFrdType.friend,i.username=t.username,g.GSM.sendServer(i),a.FE.upItems(l.TextConst.get(498,t.nickname),r.BubbleEnum.center)},t.prototype.onClosed=function(){g.GSM.ins.off(p.exitLegenC2GS.KEY,this,this.doClose),g.GSM.ins.off(f.HelpFightStartGS2C.KEY,this,this.captainContinue),Laya.timer.clear(this,this.cdHandler),this._exitHandler=null},t.prototype.close=function(t,e){},t}(ui.account.TeamCopyWinUI);e.TeamCopyFightWinDlg=h}),define("src/g/fight/osprite/play/team/GamePlayTeamCopy",["require","exports","../../../../net/messages/HelpFightMsg","src/g/fight/osprite/play/team/TeamManager","../../../../../manager/RoleCenter","src/g/fight/osprite/SceneObjCtroller","src/g/fight/osprite/play/baseplay/SvrHeroUnit","../../../../../manager/GameSocketManager","src/g/fight/osprite/play/baseplay/SvrPeopleBossMonster","../../../../net/messages/TeamMsg","../../../../../core/E","../../../../../enum/EventName","src/g/fight/osprite/play/GamePlaySvrBase","../../../../net/messages/MonsterAppearMsg","../../../../net/messages/ActivityMessage","src/g/fight/osprite/NetCtroller","src/g/account/ctrl/AccountViewCtrl","src/g/copy/view/teamcopy/TeamCopyFightWinDlg","src/g/fight/osprite/map/MapCovert","../../../../../config/GameConfig","../../../../../utils/system/DateUitl","../../../../../utils/system/ServerTime","../../../../../manager/AM"],function(t,e,i,l,h,c,u,o,a,r,v,f,n,s,p,d,y,m,_,C,I,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(g){function t(t){var e=g.call(this,t)||this;return e.isCaptain=!1,e._teamUid=0,e.nextId=0,e.numTime=0,e.posIndex=0,e.monAttackable=!1,e.isStartFight=!1,e.comboHitRageUpdate=!1,v.E.ins.on(f.EventName.EXIT_BOSS_PLAYTYPE,e,e.onExitHandler),o.GSM.ins.on(s.MonsterArrayGS2C.KEY,e,e.onMonsterArrayAppear),o.GSM.ins.on(p.ActivityEndGS2C.KEY,e,e.doFightEndHandler),o.GSM.ins.on(p.ActivityRebirthGS2C.KEY,e,e.onActivityRebirthGS2C),o.GSM.ins.on(p.UserExitActivityGS2C.KEY,e,e.onUserExitMsg),o.GSM.ins.on(p.PlaySceneEndTimeGS2C.KEY,e,e.onEndTime),e}return __extends(t,g),t.prototype.onEndTime=function(t){v.E.ins.event(f.EventName.SHOW_TEAM_COPY_FIGHT_VIEW,[this,t.endTime-b.ServerTime.serverTime])},t.prototype.init=function(t){void 0===t&&(t=null),console.log("GamePlayTeamCopy::init"),g.prototype.init.call(this,t),this._teamUid=this.msg.teamUid,this.initHeroGroup(),this.registerHandler(this._mainRole),v.E.ins.event(f.EventName.SHOW_TEAM_COPY_FIGHT_VIEW,this),this._team=l.TeamManager.getTeamFightMsg(this.msg.teamUid),this._team&&(this.isCaptain=this._team.teamState.captain.username==h.RoleCenter.instans.vo.username),this.startBattle()},t.prototype.startBattle=function(){Laya.timer.loop(10,this,this.checkWayHandler)},t.prototype.checkWayHandler=function(){this._mainRole.ways.length<=1&&(Laya.timer.clear(this,this.checkWayHandler),d.NetCtroller.JoinInQMBossCopy(this.msg.teamUid,p.EACT_TYPE.legendCopy))},t.prototype.clear=function(){g.prototype.clear.call(this),o.GSM.ins.off(s.MonsterArrayGS2C.KEY,this,this.onMonsterArrayAppear),o.GSM.ins.off(p.ActivityEndGS2C.KEY,this,this.doFightEndHandler),o.GSM.ins.off(p.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),o.GSM.ins.off(p.PlaySceneEndTimeGS2C.KEY,this,this.onEndTime),o.GSM.ins.off(p.UserExitActivityGS2C.KEY,this,this.onUserExitMsg),this._monsterGroup&&(this._monsterGroup.destroyGroup(!0),this._monsterGroup=null),v.E.ins.off(f.EventName.FIGHT_UNIT_START_ATTACK,this,this.onStartFight),v.E.ins.off(f.EventName.EXIT_BOSS_PLAYTYPE,this,this.onExitHandler),v.E.ins.event(f.EventName.CLOSE_TEAM_COPY_FIGHT_VIEW),this._team=null,this.isCaptain=!1},t.prototype.doFightEndHandler=function(t){this.onActivityEndHandler(t)},t.prototype.onActivityEndHandler=function(t){if(t.win){if((new m.TeamCopyFightWinDlg).showPage(this._team,t,new Laya.Handler(this,this.exitExpCopy),new Laya.Handler(this,this.toContinue)),this._team)C.GameConfig.teamCopyVoCfg[this._team.level+1]&&(this._team.level++,this.nextId=this._team.level,v.E.ins.event(f.EventName.TEAM_DATA_CHANGED,[this._team.teamState.teamUid,this._team.teamState.teamType]));h.RoleCenter.instans.addInventoryToC(t.inventory)}else y.AccountViewCtrl.ins.failFightEnd(Laya.Handler.create(this,this.enterIntoPort))},t.prototype.onExitHandler=function(){w.AM.exitPlay(this.type,new Laya.Handler(this,function(){d.NetCtroller.ExitQMBossCopy(this.msg.teamUid,p.EACT_TYPE.legendCopy),this.returnAutoplayPort()}))},t.prototype.exitExpCopy=function(){if(this.returnAutoplayPort(),this.isCaptain){var t=new p.exitLegenC2GS;t.actid=this._teamUid,t.acttype=p.EACT_TYPE.legendCopy,o.GSM.sendServer(t)}var e=l.TeamManager.getTeamFightMsg(this._teamUid),i=C.GameConfig.teamCopyVoCfg[this.nextId],n=!1;this.isCaptain&&(-1!=h.RoleCenter.instans.vo.portstatus.hfData.legendData.curWeekLegend.indexOf(this.nextId)&&(n=!0));if(!n&&e&&e.teamState.teamState!=r.enumTeamState.dismiss&&i&&i.day<=I.DateUtil.getKFDay())v.E.ins.event(f.EventName.POP_TEAM_PANEL,[this._teamUid,r.enumTeamType.legend]);else if(this.isCaptain){var s=new r.ExitTeamC2GS;s.teamUid=this._teamUid,s.username=h.RoleCenter.instans.vo.username,o.GSM.sendServer(s)}},t.prototype.toContinue=function(){var t=new i.HelpFightStartC2GS;t.teamType=r.enumTeamType.legend,o.GSM.sendServer(t)},t.prototype.doMonsterArrayAppear=function(t){this.isStartFight=!1,g.prototype.doMonsterArrayAppear.call(this,t),this._monsterGroup.destroyGroup(),this._monsterGroup.setOnceTarget(null);var e,i,n=0,s=-1,o=0,a=[];if(1==t.monsterArray.length)a=[this.mapVo.monXY[this.posIndex]];else{for(var r=_.MapCovert.getFreePosList(this.mapVo.monXY[this.posIndex]),l=[this.mapVo.monXY[this.posIndex]],h=0,c=r.length;h<4;)h<c?l.push(r[h]):l.push(this.mapVo.monXY[this.posIndex]),h++;if(a=l,5<t.monsterArray.length){var u=[this.mapVo.monXY[this.posIndex+1]];for(h=0,c=(r=_.MapCovert.getFreePosList(this.mapVo.monXY[this.posIndex+1])).length;h<4;)h<c?u.push(r[h]):u.push(this.mapVo.monXY[this.posIndex+1]),h++;a=a.concat(u)}}for(var p=0;p<t.monsterArray.length;p++)o++,n=(e=t.monsterArray[p]).monDataID,s=e.monUID,i=this.createMonster(this._monsterGroup,n,s),4==this.numTime?i.resetUnit(this.mapVo.bossXY[0][0],this.mapVo.bossXY[0][1]):i.resetUnit(a[p][0],a[p][1]),i.status=1;for(var d in this._monsterGroup.addToFightLayer(),5<o?this.posIndex+=2:this.posIndex++,this.numTime++,v.E.ins.once(f.EventName.FIGHT_UNIT_START_ATTACK,this,this.onStartFight),this.playerDic)this.playerDic[d].setOnceTarget(this._monsterGroup);3==this.numTime||5==this.numTime?this.showTargetBossFg=this._monsterGroup:this.showTargetBossFg=null,this.currBeAttackUsername=null,this.monAttackable=!0},t.prototype.onStartFight=function(t){this.isStartFight=!0,v.E.ins.off(f.EventName.FIGHT_UNIT_START_ATTACK,this,this.onStartFight);var e=this.playerDic[this.currBeAttackUsername];this._monsterGroup.setFGTarget(e)},t.prototype.initHeroGroup=function(){var t=c.SceneObjCtroller.ins.getSelfGroup();t.resetFightGroup(this.mapVo.startPoint[0]),t.addToFightLayer(),this.setFightGroup(t);var e=l.TeamManager.getTeamFightMsg(this.msg.teamUid);if(e){var i,n=h.RoleCenter.instans.vo.username;if(e.teamState.captain.username!=n)(r=h.RoleCenter.instans.getOtherData(e.teamState.captain.username))&&(i=u.SvrHeroUnit.createFightGroup(r,this.mapVo.startPoint[0]),this.addPlayerFG(i),r&&r.vipLv&&i.getFUList()[0].showOff());for(var s=e.teamState.member,o=s.length,a=0;a<o;){var r;if(s[a].username!=n)(r=h.RoleCenter.instans.getOtherData(s[a].username))&&(i=u.SvrHeroUnit.createFightGroup(r,this.mapVo.startPoint[0]),this.addPlayerFG(i),r&&r.vipLv&&i.getFUList()[0].showOff());a++}}},t.prototype.onActivityRebirthGS2C=function(t){if(t.opresult){var e=this._playerDic[t.userAcc];if(e){var i=t.userAcc==h.RoleCenter.instans.self.username;e.resetFightGroup(e.getFUList()[0].get_POS(),!0),(null==this._monsterGroup.getFGTarget()||this._monsterGroup.getFGTarget().isDeath())&&v.E.ins.once(f.EventName.FIGHT_UNIT_START_ATTACK,this,this.onStartFight),e.setOnceTarget(this._monsterGroup),i&&(this.switchRole(!0),v.E.ins.event(f.EventName.GAME_PLAY_MAIN_ROLE_REBORN))}}else console.error(t.error)},t.prototype.setCurrBeAttackUsername=function(t){if(this.currBeAttackUsername!=t&&(this.currBeAttackUsername=t,this.isStartFight&&this._monsterGroup&&!this._monsterGroup.isDeath())){var e=this.playerDic[this.currBeAttackUsername];this._monsterGroup.setFGTarget(e)}},t.prototype.onHpChg=function(t){if(this.setCurrBeAttackUsername(t.beAttack),g.prototype.onHpChg.call(this,t),t.beAttack==h.RoleCenter.instans.vo.username&&null==this._mainRole){for(var e,i,n=this._monsterGroup.getFUList(),s=n.length,o=0;o<s;){if(!n[o].isDeath()){e=n[o];break}o++}e instanceof a.SvrPeopleBossMonster&&(i=e.data),v.E.ins.event(f.EventName.GAME_PLAY_MAIN_ROLE_DEAD,i?[i.name]:null)}},t.prototype.frameMove=function(){if(g.prototype.frameMove.call(this),this.monAttackable&&this._monsterGroup.isDeath()){this.monAttackable=!1;var t=new p.FreshNextBossC2GS;t.actid=this.msg.teamUid,t.acttype=p.EACT_TYPE.legendCopy,o.GSM.sendServer(t)}},t.prototype.onUserExitMsg=function(t){if(t.opresult){var e=this._playerDic[t.username];e&&(e.setAllDaeth(),this.removePlayerFG(e,!0))}else console.error(t)},t}(n.GamePlaySvrBase);e.GamePlayTeamCopy=g}),define("src/g/copy/ctrl/TeamCopyFightViewCtrl",["require","exports","../../../core/E","../../../enum/EventName","../../../manager/LayerManager","../../../utils/ItemUtils","../../../manager/RoleCenter","src/g/worldboss/ctrl/Death","../../../config/GameConfig","../../../utils/system/DateUitl","src/g/fight/osprite/play/team/TeamManager","src/g/crossserboss/PointWarPlayer"],function(t,e,o,a,r,l,i,n,h,s,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(){function t(){this.endTime=0,o.E.ins.on(a.EventName.SHOW_TEAM_COPY_FIGHT_VIEW,this,this.showView),o.E.ins.on(a.EventName.CLOSE_TEAM_COPY_FIGHT_VIEW,this,this.hideView)}return t.prototype.showView=function(t,e){void 0===e&&(e=NaN),this._play=t,this._view||(this._view=new ui.teamcopy.TeamCopyFightViewUI,r.LayerManager.addInUILayer(this._view),this.initList(this._view.playerList,this.renderPlayer,u.PointWarPlayer),Laya.timer.frameLoop(2,this,this.frameMove)),o.E.ins.on(a.EventName.GAME_PLAY_MAIN_ROLE_DEAD,this,this.onMainRoleDead),o.E.ins.on(a.EventName.GAME_PLAY_MAIN_ROLE_REBORN,this,this.onMainRoleReborn),Laya.timer.clear(this,this.cooldownHandler),this.endTime=0;var i=h.GameConfig.teamCopySettingVoCfg.copyTime;i&&(this.endTime=Number(i.value)),isNaN(e)||(this.endTime=e),this.cooldownHandler();var n=c.TeamManager.getTeamFightMsg(t.msg.teamUid);if(n){var s=h.GameConfig.teamCopyVoCfg[n.level];s&&this._view.lab_name.changeText(s.name)}},t.prototype.cooldownHandler=function(){0<=this.endTime?(this._view.lab_time.changeText(s.DateUtil.getHMS_countdown(this.endTime)),Laya.timer.once(1e3,this,this.cooldownHandler),this.endTime--):(Laya.timer.clear(this,this.cooldownHandler),this._view.lab_time.changeText("00:00:00"))},t.prototype.hideView=function(){o.E.ins.off(a.EventName.GAME_PLAY_MAIN_ROLE_DEAD,this,this.onMainRoleDead),o.E.ins.off(a.EventName.GAME_PLAY_MAIN_ROLE_REBORN,this,this.onMainRoleReborn),Laya.timer.clear(this,this.frameMove),this.death&&(this.death.close(),this.death=null),this._play=null,this._view&&this._view.destroy(),this._view=null,Laya.timer.clear(this,this.cooldownHandler)},t.prototype.frameMove=function(){this._play&&(this.updateBoss(this._play.showTargetBossFg),this.updateTeamList())},t.prototype.updateBoss=function(t){var e=this._view.bossBar;if(t){e.visible=!0,e.lvl_txt.text="";var i=t.getUnitByIndex(0);i.data&&(e.imgTargetFoeHead.skin=l.ItemUtils.getBossIccon(i.data.id),e.boss_name.changeText(i.data.name));var n=t.getHp(),s=t.getTotalHp(),o=Math.min(380*n/s>>0,380);e.progressBar.width=o,e.progress_txt.text=(n/s*100).toFixed(2)+"%"}else e.visible=!1},t.prototype.updateTeamList=function(){var t=[];for(var e in this._play.playerDic)e!=i.RoleCenter.instans.vo.username&&t.push(this._play.playerDic[e]);this._view.playerList.array=t,this._view.lab_team_lab.visible=0<t.length},t.prototype.initList=function(t,e,i){t.itemRender=i,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.renderPlayer=function(t,e){t.update2("right")},t.prototype.onMainRoleDead=function(t){if(this._view){null==this.death&&(this.death=new n.Death),this.death.centerX=0,this.death.bottom=330,this.death.fuhuoButton.visible=!1,this._view.addChild(this.death);var e=l.ItemUtils.getBossSettingVoById(1);this.death.start(t,null,e.revivecd,0)}},t.prototype.onMainRoleReborn=function(){this.death&&this.death.close()},t}();e.TeamCopyFightViewCtrl=p}),define("src/g/zhanyu/view/KFZYHotBloodPortItem2",["require","exports","../../../utils/system/ServerTime","src/g/fight/osprite/play/kfzy/KFZYManager","../../../utils/system/DateUitl","src/init/TextConst"],function(t,e,s,o,a,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(){var t=this.dataSource;this.text_bossName.text=t.bossName,t.stateKey?(this.stopCD(),this.text_state.color="#09d51f",this.text_state.text=i.TextConst.get(344)):(this.text_state.color="#ffd409",this.startCD())},t.prototype.startCD=function(){Laya.timer.loop(1e3,this,this.updCd),this.updCd()},t.prototype.updCd=function(){if(this.dataSource){var t=o.KFZYManager.ins(),e=t.getBossVoByPortId(this.dataSource.portId),i=t.getPortStatus(e.port);if(i){var n=i.lastDieTime+e.cd-s.ServerTime.serverTime;n<=0?this.stopCD():this.text_state.text=a.DateUtil.getHMS_countdown(n)}}},t.prototype.stopCD=function(){Laya.timer.clear(this,this.updCd)},t.prototype.destroy=function(t){this.stopCD(),e.prototype.destroy.call(this,t)},t}(ui.hotblood.HotBloodBossInfoItemUI);e.KFZYHotBloodPortItem2=n}),define("src/g/zhanyu/view/KFZYHotBloodTotalInfoView",["require","exports","src/g/fight/osprite/play/kfzy/KFZYManager","src/g/fight/osprite/GameScene","../../../config/GameConfig","src/g/zhanyu/view/KFZYHotBloodPortItem2","../../../utils/ItemUtils","../../net/messages/BloodyBattleMsg","../../../manager/LayerManager"],function(t,e,h,r,c,n,u,p,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t._smallMap=null,t._smallMapSprite=new Laya.Sprite,t._bossSprite=new Laya.Sprite,t._image=null,t._monsterList=[],t.width=Laya.stage.width,t.mouseThrough=!0,t.initList(t.bossInfoList,t.onRenderHandler,n.KFZYHotBloodPortItem2),t.bossInfoList.selectEnable=!0,t.bossInfoList.selectHandler=new Laya.Handler(t,t.onSelectHandler),t.updateListInfo(),t._image=new Laya.Image("res/hotblood/rxzc_wanjiaweizhi.png"),t._image.on(Laya.Event.LOADED,t,t.onRoleImage),t._smallMapSprite.addChild(t._image);for(var e=0;e<8;e++)t._monsterList[e]=new Laya.Image("res/hotblood/rxzc_hongdian01.png"),t._bossSprite.addChild(t._monsterList[e]);return t}return __extends(t,i),t.prototype.onRoleImage=function(){this._image.x=-this._image.width/2,this._image.y=-this._image.height/2},t.prototype.initList=function(t,e,i){t.selectEnable=!0,t.vScrollBarSkin="",t.itemRender=i,t.scrollBar.elasticDistance=100,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.onRenderHandler=function(t,e){t.update()},t.prototype.onSelectHandler=function(t){if(-1<t&&t<this.bossInfoList.length){var e=this.bossInfoList.array[t];h.KFZYManager.ins().gotoBossArea(e.portId),this.bossInfoList.selectedIndex=-1}},t.prototype.updateListInfo=function(){var t=h.KFZYManager.ins().getBossInfoDic(),e=null,i=null,n=[],s=null,o=null,a=h.KFZYManager.ins().layer;for(var r in t)if(e=t[r]){var l=h.KFZYManager.ins().getBossVoByPortId(e.portid);if(l.layer!=a)continue;e.lastDieTime,l.cd;switch(i=new d,n.push(i),s=c.GameConfig.getPortByID(l.port),o=u.ItemUtils.getMonsterVOById(s.boss),i.bossName=o.name,i.portId=l.port,e.bossState){case p.EBattleBossState.WAIT_REVIVE:console.log("等待复活"),i.stateKey=!1;break;case p.EBattleBossState.CAN_CHALLENGE:console.log("可挑战"),i.stateKey=!0;break;case p.EBattleBossState.NULL:console.error("null")}}this.bossInfoList.array=n},t.prototype.show=function(){if(null==this._smallMap){var t=(u.ItemUtils.getMapUrl()+"{0}/small_2.jpg").replace("{0}","819");this._smallMap=new Laya.Image(t),this.mapBox.addChild(this._smallMap),this.mapBox.addChild(this._smallMapSprite),this.mapBox.addChild(this._bossSprite);s.LayerManager.addInUILayer(this)}this.visible=!0,Laya.timer.frameLoop(1,this,this.update)},t.prototype.hide=function(){Laya.timer.clear(this,this.update),this.visible=!1},t.prototype.exit=function(){Laya.timer.clear(this,this.update),this._smallMapSprite&&(this._smallMapSprite.removeSelf(),this._smallMapSprite=null),this._smallMap&&(this._smallMap.removeSelf(),this._smallMap=null)},t.prototype.update=function(){var t=h.KFZYManager.ins();if(t.gamePlay&&this._smallMap){var e=t.gamePlay.getSelfPos(),i=e[0]/r.GameScene.ins.map.width*this._smallMap.width,n=e[1]/r.GameScene.ins.map.height*this._smallMap.height;this._smallMapSprite.x=i,this._smallMapSprite.y=n;for(var s=0;s<this._monsterList.length;s++){var o=c.GameConfig.getPortByID(75100+s+1),a=c.GameConfig.getMapJSON(o.boss_scene);a&&0<a.bossXY.length&&(i=a.bossXY[0][0]/r.GameScene.ins.map.width*this._smallMap.width,n=a.bossXY[0][1]/r.GameScene.ins.map.height*this._smallMap.height,this._monsterList[s].x=i-9,this._monsterList[s].y=n-9)}}},t}(ui.hotblood.HotBloolSceneViewUI);e.KFZYHotBloodTotalInfoView=i;var d=function(){this.stateKey=!1,this.portId=-1};e.HotBloodBossInfoItemData=d}),define("src/g/zhanyu/view/KFZYHotBloodWar",["require","exports","../../../manager/LayerManager","../../../core/E","../../../enum/EventName","src/g/boss/view/SCFoeHead","../../../utils/ItemUtils","../../../manager/RoleCenter","src/g/fight/osprite/play/kfhotblood/KfHotBloodManager","../../../utils/GPUtils","../../../meta/ChatTemplateVo","src/init/TextConst","src/g/crossserboss/PointWarPlayer"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.mouseThrough=!0,t.width=Laya.stage.width,t.height=Laya.stage.height,t.foeIndexDict=new Laya.Dictionary,t.familyIndexDict=new Laya.Dictionary,t.playerIndexDict=new Laya.Dictionary,t.bossHead=new p.PointWarPlayer,t.bossHead.setType(0),t.bossHead.right=0,t.bossHead.y=137,t.addChild(t.bossHead),t.guiShuZhe=new p.PointWarPlayer,t.guiShuZhe.setType(1),t.guiShuZhe.y=34,t.guiShuZheBox.addChildAt(t.guiShuZhe,0),t.setGuiShuZhe(null),t.imgAttack.visible=t.myFMember.visible=t.foeFMember.visible=!1,t.initList(t.foeList,t.foeRender,p.PointWarPlayer),t.initList(t.myFamilyList,t.familyPlayerRender,p.PointWarPlayer),t.initList(t.playerList,t.playerRender,p.PointWarPlayer),t.familyFriendLink.visible=!1,t.guiShuZheBox.on(Laya.Event.CLICK,t,t.attackGuiShuzheHander),t.hideOPlayerButton.visible=!1,t}return __extends(t,e),t.prototype.attackGuiShuzheHander=function(){var t=this.guiShuZhe.getDataAsFightGroup();t&&n.E.ins.event(s.EventName.SELECT_PK_TARGET,t.groupID)},t.prototype.initList=function(t,e,i){t.selectEnable=!0,t.vScrollBarSkin="",t.itemRender=i,t.scrollBar.elasticDistance=100,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.foeRender=function(t,e){t.update2("left"),t.showAttackerEf(),t.on(Laya.Event.CLICK,this,this.attFoeHander)},t.prototype.familyPlayerRender=function(t,e){t.update2("left"),t.on(Laya.Event.CLICK,this,this.attackFamilyList)},t.prototype.playerRender=function(t,e){t.update2("right"),t.on(Laya.Event.CLICK,this,this.attplayerHander)},t.prototype.showView=function(){i.LayerManager.addInUILayer(this)},t.prototype.updFoeList=function(t){var e=h.GPUtils.deleteEmptyData(t,this.foeIndexDict);this.foeList.array=e,h.GPUtils.caculateListH(this.foeList,3),this.imgAttack.visible=e&&0!=e.length},t.prototype.updMyFamilyList=function(t){var e=h.GPUtils.deleteEmptyData(t,this.familyIndexDict);this.myFamilyList.array=e,h.GPUtils.caculateListH(this.myFamilyList,2),this.myFMember.visible=e&&0!=e.length,this.myFMemberNum.text=u.TextConst.get(360,e.length)},t.prototype.updPlayerList=function(t){var e=h.GPUtils.deleteEmptyData(t,this.playerIndexDict,!0);this.playerList.array=e,h.GPUtils.caculateListH(this.playerList,4),this.foeFMember.visible=e&&0!=e.length,this.foeFMemberNum.text=u.TextConst.get(361,e.length)},t.prototype.attplayerHander=function(t){var e=t.currentTarget,i=this.playerIndexDict.get(e.dataSource);n.E.ins.event(s.EventName.SELECT_TARGET_INDEX,i)},t.prototype.attFoeHander=function(t){var e=t.currentTarget,i=this.foeIndexDict.get(e.dataSource);n.E.ins.event(s.EventName.SELECT_REVENGE_TARGET_INDEX,i)},t.prototype.attackFamilyList=function(t){var e=t.currentTarget,i=this.familyIndexDict.get(e.dataSource);n.E.ins.event(s.EventName.SELECT_FAMILYMEMBER_INDEX,i)},t.prototype.changeAttackTarget=function(t){this.clearAttackSign(),null!=t&&(""==t?this.bossHead.updStatus(o.SCFoeHead.BE_ATTACK):(null!=this.guiShuZhe.getDataAsFightGroup()&&this.guiShuZhe.getDataAsFightGroup().groupID==t&&this.guiShuZhe.updStatus(o.SCFoeHead.BE_ATTACK),this.showAttackSignInList(this.foeList,t),this.showAttackSignInList(this.playerList,t),this.showAttackSignInList(this.myFamilyList,t)))},t.prototype.clearAttackSign=function(){this.bossHead.reset(),this.guiShuZhe.reset(),this.clearListAttackSign(this.foeList),this.clearListAttackSign(this.playerList),this.clearListAttackSign(this.myFamilyList)},t.prototype.clearListAttackSign=function(t){for(var e=0;e<t.cells.length;e++)t.cells[e].reset()},t.prototype.showAttackSignInList=function(t,e){for(var i,n=0;n<t.cells.length;n++)(i=t.cells[n]).getName()==e&&i.updStatus(o.SCFoeHead.BE_ATTACK)},t.prototype.onDeath=function(){this.clearAttackSign()},t.prototype.setBoss=function(t,e){this.bossMaxHP=e,this.imgBossHead.skin=a.ItemUtils.getBossIconByPort(t.port),this.lbBossName.text=t.name,this.bossHead.updateBoss(t)},t.prototype.updBossHP=function(t){var e=Math.min(380*t/this.bossMaxHP>>0,380);this.progressBar.width=e,this.progress_txt.text=(t/this.bossMaxHP*100).toFixed(2)+"%"},t.prototype.setGuiShuZhe=function(t){t?(this.guiShuZheBox.visible=!0,this.guiShuZhe.updWinner2(t),r.RoleCenter.instans.self.username==t.groupID||r.RoleCenter.instans.self.ufData.familyUId==t.getFamilyUid()&&""!=r.RoleCenter.instans.self.ufData.familyUId?this.imgFamily.skin="res/fightview/rxzc_wohuitubiao.png":this.imgFamily.skin="res/fightview/rxzc_dihuitubiao.png",r.RoleCenter.instans.self.username==t.groupID?(this.imgowner.visible=!0,this.attackBoss.visible=!1):(this.imgowner.visible=!1,this.attackBoss.visible=!0)):(this.guiShuZheBox.visible=!1,this.imgowner.visible=!1,this.attackBoss.visible=!0)},t.prototype.updGuiShuZheHP=function(t,e){this.guiShuZhe.updBlood(t,e)},t.prototype.visibleBossView=function(t){this.bossInFoBox.visible=t,this.bossHead.visible=t,this.buttonBox.visible=t},t.prototype.onLinkHandler=function(){c.ChatTemplateVo.sendChatTemp(10,[l.KFHotBloodManager.ins().getPortId()])},t}(ui.hotblood.HotBloodWarUI);e.KFZYHotBloodWar=d}),define("src/g/zhanyu/ctrl/KFZYHotBloodWarCtrl",["require","exports","src/g/fight/osprite/play/kfzy/KFZYManager","src/g/hotblood/ctrl/HotBloodWarDeathCtrl","src/g/zhanyu/view/KFZYHotBloodTotalInfoView","src/g/zhanyu/view/KFZYHotBloodWar","../../../enum/EventName","../../../core/E","../../../utils/ItemUtils","src/g/setting/ctrl/SettingCtrl","../../../enum/SettingEnum","src/g/setting/vo/SettingInfo","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(){this.totalInfoView=null,this._bossHp=0,this.deathCtrl=new n.HotBloodWarDeathCtrl,r.E.ins.on(a.EventName.KFZYHOTBLOODWAR_SCENE_PANEL,this,this.openPanel)}return t.prototype.openPanel=function(){null==(this.manager().viewCtrl=this).totalInfoView&&(this.totalInfoView=new s.KFZYHotBloodTotalInfoView,this.totalInfoView.show(),this.totalInfoView.fhzc.on(Laya.Event.CLICK,this,this.fhzcHandler),this.showLastBossScene())},t.prototype.showBattlePanel=function(t){this.currportid=t,this.lastportid=NaN,r.E.ins.on(a.EventName.UPDATE_REVENGE_VIEW_TARGET,this,this.updateFoeListHandler),r.E.ins.on(a.EventName.UPDATE_VIEW_TARGET,this,this.updPlayerListHander),r.E.ins.on(a.EventName.UPDATE_VIEW_FAMILYMEMBER,this,this.updateMyFamilyList),r.E.ins.on(a.EventName.CHANGE_PK_TARGET,this,this.attackTargetChangedHander),r.E.ins.on(a.EventName.OTHER_PLAYER_STATUS_CHANGED,this,this.onOPlayerStatusChanged),null==this.view&&(this.view=new o.KFZYHotBloodWar,this.view.showView()),this.updHideBtnStatus(),this.view.attackBoss.on(Laya.Event.CLICK,this,this.attackBossHander),this.view.bossHead.on(Laya.Event.CLICK,this,this.attackBossHander),this.view.hideOPlayerButton.on(Laya.Event.CLICK,this,this.hidePlayer),this.view.visible=!0;var e=l.ItemUtils.getBossVoByPortId(t),i=l.ItemUtils.getMonsterVOById(t);e&&i&&this.view.setBoss(e,i.HP),this.totalInfoView.hide()},t.prototype.hideBattlePanel=function(t){void 0===t&&(t=!0),this.view&&(r.E.ins.off(a.EventName.UPDATE_REVENGE_VIEW_TARGET,this,this.updateFoeListHandler),r.E.ins.off(a.EventName.UPDATE_VIEW_TARGET,this,this.updPlayerListHander),r.E.ins.off(a.EventName.UPDATE_VIEW_FAMILYMEMBER,this,this.updateMyFamilyList),r.E.ins.off(a.EventName.CHANGE_PK_TARGET,this,this.attackTargetChangedHander),r.E.ins.off(a.EventName.OTHER_PLAYER_STATUS_CHANGED,this,this.onOPlayerStatusChanged),this.view.attackBoss.off(Laya.Event.CLICK,this,this.attackBossHander),this.view.bossHead.off(Laya.Event.CLICK,this,this.attackBossHander),this.view.hideOPlayerButton.off(Laya.Event.CLICK,this,this.hidePlayer),this.view.visible=!1),t&&(this.totalInfoView.show(),this.showLastBossScene())},t.prototype.fhzcHandler=function(){var t=this.lastportid;isNaN(t)||this.manager().gotoBossArea(t)},t.prototype.showLastBossScene=function(){var t=!0;isNaN(this.lastportid)&&(t=!1);var e=this.totalInfoView;e&&(e.fhzc.visible=t)},t.prototype.updateFoeListHandler=function(t){this.view&&this.view.updFoeList(t)},t.prototype.updateMyFamilyList=function(t){this.view&&this.view.updMyFamilyList(t)},t.prototype.updPlayerListHander=function(t){this.view&&this.view.updPlayerList(t)},t.prototype.attackTargetChangedHander=function(t){this.view&&this.view.changeAttackTarget(t)},t.prototype.exit=function(){this.manager().viewCtrl=null,this.view&&(this.view.visible&&this.hideBattlePanel(!1),this.view.removeSelf(),this.view.destroy(!0),this.view=null),this.totalInfoView&&(this.totalInfoView.exit(),this.totalInfoView.removeSelf(),this.totalInfoView.destroy(!0),this.totalInfoView.fhzc.off(Laya.Event.CLICK,this,this.fhzcHandler),this.totalInfoView=null),this.currportid=this.lastportid=NaN,this.deathCtrl.relase(),h.SettingCtrl.getInstance().hideOtehrPlayer(!1)},t.prototype.updateBossHp=function(t){this._bossHp=t,this.view&&this.view.updBossHP(t)},t.prototype.updateBossOwner=function(t){this.view&&this.view.setGuiShuZhe(t)},t.prototype.updateBossOwnerHp=function(t,e){this.view&&this.view.updGuiShuZheHP(t,e)},t.prototype.updateBossState=function(t){this.view,this.totalInfoView&&this.totalInfoView.updateListInfo()},t.prototype.visibleBossView=function(t){this.view&&this.view.visibleBossView(t)},t.prototype.attackBossHander=function(){this.manager().findBoss()},t.prototype.manager=function(){return i.KFZYManager.ins()},t.prototype.getDeathCtrl=function(){return this.deathCtrl},t.prototype.onDeath=function(t,e,i){var n=this.manager().checkIsMainScene();this.lastportid=n?NaN:this.currportid,this.deathCtrl.onDeath(t,e,i,n),this.view&&this.view.visible&&this.view.onDeath()},t.prototype.updJianMianHurt=function(t){this.view&&(this.view.lbHurtJianMian.text=p.TextConst.get(888,t))},t.prototype.onOPlayerStatusChanged=function(){this.updHideBtnStatus()},t.prototype.updHideBtnStatus=function(){1==u.SettingInfo.getSettingValue(c.SettingEnum.hideOtherPlayer)?this.view.hideOPlayerButton.skin="res/fightview/rexue_pingbiguan.png":this.view.hideOPlayerButton.skin="res/fightview/rexue_pingbikai.png"},t.prototype.hidePlayer=function(){u.SettingInfo.getSettingValue(c.SettingEnum.hideOtherPlayer)?h.SettingCtrl.getInstance().hideOtehrPlayer(!1):h.SettingCtrl.getInstance().hideOtehrPlayer(!0)},t}();e.KFZYHotBloodWarCtrl=d}),define("src/g/zhanling/view/ZlXisui",["require","exports","../../../manager/RoleCenter","../../../plugin/sbkPropTool","../../../utils/ItemUtils","src/g/Effects/UIEffectsFactory","src/g/bag/tips/view/ItemTips","src/g/bag/vo/BagDataVo","../../net/messages/sbkZhanLingData","../../../manager/GameSocketManager","../../../config/GameConfig","src/init/TextConst"],function(t,e,y,m,_,C,l,h,c,u,I,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.bg.btn_close.on(Laya.Event.CLICK,t,t.closeSelf),t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t.list.mouseHandler=new Laya.Handler(t,t.mouseHandler),t}return __extends(t,e),t.prototype.setData=function(t,e){this.levels=t,this.typeid=e,this.updataList()},t.prototype.updataList=function(){var t=this.list.array||[];t.splice(0,t.length);for(var e=this.levels,i=0;i<e.length;i++){var n=e[i];0==n&&(n=1),t.push(I.GameConfig.getZlDrugVo(i+1,n))}this.list.array=t},t.prototype.mouseHandler=function(t,e){var i=t.currentTarget;if(t.type==Laya.Event.CLICK){var n=this.list.array[e];switch(t.target){case i.getChildByName("item"):var s=n.cost[0][0],o=_.ItemUtils.getItemVoById(s),a=new h.BagDataVo;a.id=s,a.ItmVo=o,a.num=0,l.ItemTips.ins.showTips(a);break;case i.getChildByName("btn_use"):var r=new c.zhanlingDrugUpMsg;r.type=n.type,r.typeId=this.typeid,r.curDrugLv=this.levels[n.type-1],u.GSM.sendServer(r)}}},t.prototype.renderHandler=function(t,e){var i=this.list.array[e],n=I.GameConfig.getZlDrugVo(i.type,i.level+1),s=I.GameConfig.getZlDrugVo(i.type,i.level-1),o=t.getChildByName("btn_use"),a=t.getChildByName("power"),r=t.getChildByName("lab_count"),l=t.getChildByName("item");r.style.color="#a89e8f",r.style.font="SimHei",r.style.fontSize=18,o.label=b.TextConst.get(740);var h=JSON.parse(JSON.stringify(i.prop));i.power;if(s){s.power;for(var c=0;c<h.length;c++){(u=h[c])[1]=u[1]-s.prop[c][1]}}for(c=0;c<4;c++){var u=h[c],p=t.getChildByName("lab_"+c);p.style.color="#a89e8f",p.style.font="SimHei",p.style.fontSize=18;var d=!0;u?p.innerHTML=_.ItemUtils.getShuXingByName(u[0]).desc+'：<font color="#e3cca9">'+u[1]+"</font>":d=!1,p.visible=d}a.value=m.sbkPropTool.getZlXsCombet(i.type,i.level)+"";var g=i.cost[0][0],v=y.RoleCenter.instans.vo.bagdata.getItemCount(g);o.disabled=(0==v||!n)&&(n||(o.label=b.TextConst.get(208)),!0),r.innerHTML=b.TextConst.get(858,v);var f=_.ItemUtils.getItemVoById(g);(l.item.img_quality.skin=_.ItemUtils.getQualityBjById(g),l.item.img_item.skin=_.ItemUtils.getIconById(g),0<f.streamer)?l.effect_con.getChildByName("ani_"+f.streamer)||(l.effect_con.removeChildren(),C.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(l.effect_con,f.streamer,1,1,"ani_"+f.streamer)):l.effect_con.removeChildren();l.img_occupation.removeSelf()},t.prototype.closeSelf=function(t){this.close()},t}(ui.zhanling.ZlXisuiUI);e.ZlXisui=i}),define("src/g/zhanling/view/ZlYc",["require","exports","src/g/itemGets/View/ItemGetDlg","../../../utils/ItemUtils","../../../manager/RoleCenter","../../net/messages/sbkZhanLingData","../../../config/GameConfig","src/g/zhanling/view/ZlXisui","../../../utils/system/FloatEffect","../../../manager/GameSocketManager","src/init/Switches","src/g/Effects/UIEffectsFactory","../../../plugin/sbkPropTool","../../../vo/RedDot/RedDot_Zl","src/init/TextConst"],function(t,e,o,A,R,L,x,d,g,v,f,P,n,k,D){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t.monsterObj={},t.tComp=new Laya.Handler(t,t.tweenComp),t.item_cost.setJump(D.TextConst.get(238),new Laya.Handler(t,t.onShowGetDlg)),t.list_star.renderHandler=new Laya.Handler(t,t.starH),t.selectList.renderHandler=new Laya.Handler(t,t.selectH),t.xisui.on(Laya.Event.CLICK,t,t.onclick),t.hh_use.on(Laya.Event.CLICK,t,t.onclick),t.huanhua.on(Laya.Event.CLICK,t,t.onclick),t.taozhuang.on(Laya.Event.CLICK,t,t.onclick);for(var e=0;e<4;e++)t["skill"+e].on(Laya.Event.CLICK,t,t.onclick);return t.btn_up.handler=new Laya.Handler(t,t.onUpLv),t}return __extends(t,i),t.prototype.onUpLv=function(){var t=this.currZlData,e=this.getTypeId(),i=this.getStarLv(),n=x.GameConfig.getZlStarVo(e,i),s=x.GameConfig.getZlStarVo(e,i+1);if(!s)return!1;var o=t?s.cost[0][0]:0==n.activationcost.length?0:n.activationcost[0][0],a=t?s.cost[0][1]:0==n.activationcost.length?0:n.activationcost[0][1],r=0!=o?R.RoleCenter.instans.vo.bagdata.getItemCount(o):0;if(0!=o&&r<a)return this.onShowGetDlg(),!1;var l=new L.zhanlingStarUpMsg;return l.typeId=this.getTypeId(),l.curStarLv=this.getStarLv(),l.curStarExp=this.getStarExp(),v.GSM.sendServer(l),!0},t.prototype.onclick=function(t){var e=t.currentTarget,i=this.currZlData;switch(e){case this.xisui:if(i){var n=this.xsDlg;n||(this.xsDlg=n=new d.ZlXisui),n.setData(i.drugArr,i.typeId),n.popup()}else g.FE.upItems(D.TextConst.get(794));break;case this.huanhua:f.Switches.ins.event(209);break;case this.taozhuang:break;case this.skill0:case this.skill1:case this.skill2:case this.skill3:var s=+e.name.charAt(e.name.length-1),o=x.GameConfig.zltype[this.getTypeId()].skill[s],a=x.GameConfig.zlskill[o[0]],r=new ui.lottery.ShenyuSkillDlgUI;r.lab_desc.style.font="SimHei",r.lab_desc.style.align="left",r.lab_desc.style.color="#a89e8f",r.lab_desc.style.stroke=1,r.lab_desc.style.fontSize=20,r.lab_desc.style.wordWrap=!0,r.lab_desc.style.strokeColor="#060606",r.lab_open.text=i&&o[1]<=i.starLv?D.TextConst.get(524):D.TextConst.get(795,o[1]);for(var l=a.desc,h=0;h<a.specialSkill.length;h++){var c=a.specialSkill[h];l=l.replace("{"+c[0]+"}",("BLOODRECOVERY"==c[0]?c[1]:c[1]/100)+"")}for(h=0;h<a.prop1.length;h++){var u=a.prop1[h];l=l.replace("{"+u[0]+"}",A.ItemUtils.getShuXingByName(u[0]).desc)}r.lab_desc.innerHTML=l,r.lab_skillName.text=a.name,r.img_skillIcon.skin=A.ItemUtils.getSkillIconByIconId(a.icon),r.popup();break;case this.hh_use:var p=new L.zhanlingHuanHuaMsg;p.typeId=this.getTypeId(),v.GSM.sendServer(p)}},t.prototype.setType=function(t){switch(void 0===t&&(t=0),t){case 0:this.selectList.visible=!1,this.huanhua.visible=!0,this.xisui.visible=!0,this.hh_use.visible=!1;break;case 1:this.hh_use.visible=!0,this.selectList.visible=!0,this.huanhua.visible=!1,this.xisui.visible=!1}},t.prototype.selectH=function(t,e){var i=this.selectList.array[e].id;t.getChildAt(0).visible=k.RedDot_Zl.zlArr[i-1],t.skin="res/zhanling/icon"+i+".png"},t.prototype.starH=function(t,e){var i;i=t.dataSource?"xing":"kongxing",t.skin="res/custom/juese_jingmai_"+i+".png"},t.prototype.updateProp=function(t,e){void 0===e&&(e=!0);for(var i=e?this.box_currAttr:this.box_nextAttr,n=0;n<2;n++){var s=t?t[n]:null,o=i.getChildByName("lab_"+n);o.text=s||e?A.ItemUtils.getShuXingByName(s[0]).desc+":"+s[1]:D.TextConst.get(208)}},t.prototype.updatePower=function(){var t=this.currZlData,e=0;t&&(e=n.sbkPropTool.getZlOneCombet(t)),this.box_fight.setFightNum(e)},t.prototype.updateRed=function(){var t=this.selectId;if(t==L.sbkZhanLingData.baseId){var e=!1;k.RedDot_Zl.isHh&&(e=!0),this.red_hh.visible=e;var i=!1;k.RedDot_Zl.isXs&&(i=!0),this.red_xs.visible=i}var n=!1,s=this.zlUp;k.RedDot_Zl.zlArr[t-1]&&(s||(this.zlUp=s=P.UIEffectsFactory.Ins.createSAniAndCenter(this.btn_up,42,1.6)),n=!0),s&&(s.visible=n),this.selectList.refresh()},t.prototype.refreshData=function(t){k.RedDot_Zl.check();var e=R.RoleCenter.instans.self.zlData,i=e.getOneZhanLing(t),n=i?i.typeId:t;this.selectId=n,this.currZlData=i;for(var s=this.getTypeId(),o=this.getStarLv(),a=x.GameConfig.zltype[s].skill,r=0;r<a.length;r++){var l=a[r];if(l){var h=x.GameConfig.zlskill[l[0]],c=this["skill"+r];c.skin=A.ItemUtils.getSkillIconByIconId(h.icon);var u=!0;i&&l[1]<=i.starLv&&(u=!1),c.disabled=u,c.mouseEnabled=!0}else console.log("当前技能数据异常,currZlData:"+!i+"typeId:"+s+",selectId:"+n+",id:"+t)}var p=L.sbkZhanLingData.baseId,d=!0,g=e.getOneZhanLing(p);if((!g||g.starLv>=x.GameConfig.zltype[p].skill[1][1])&&(d=!1),this.descAni.visible=d,this.updateRed(),n!=p){var v="zhanling_chuzhan",f=!0,y=!0;n==e.huanhuaId?(f=!1,v="zhanling_chuzhaning"):i||(y=!1),this.hh_use.visible=y,this.hh_use.mouseEnabled=f,this.hh_use.skin="res/zhanling/"+v+".png"}this.zlName.skin="res/zhanling/zl_name"+n+".png";var m=x.GameConfig.getZlStarVo(s,o),_=x.GameConfig.getZlStarVo(s,o+1),C=D.TextConst.get(732),I=!1,b=!0;i?_?this.updateXhTip(_.cost):(I=!0,this.item_cost.visible=!1,C=D.TextConst.get(208),b=!1):0==m.activationcost.length?(this.item_cost.visible=!1,C=D.TextConst.get(796),b=!1):(this.updateXhTip(m.activationcost),C=D.TextConst.get(237)),this.box_exp.visible=b,this.list_star.visible=b,this.btn_up.disabled=I,this.btn_up.label=C,this.updateProp(m.prop),this.updateProp(_?_.prop:null,!1);var w=this.monsterObj[s];w||(this.monsterObj[s]=w=P.UIEffectsFactory.Ins.createAndCenter(this.monster_pos,x.GameConfig.zltype[s].image,!0),w.name=""+s);var S=this.monster_pos,E=!1;if(0<S.numChildren){var T=S.getChildAt(0);+T.name!=s&&(E=!0,T.stop())}w.parent||w.play(0,!0),E&&S.removeChildren(),S.addChild(w),this.updateLvOther(o),this.updatePower()},t.prototype.tweenComp=function(){0==this.getStarExp()&&this.bar_panel.width==this.bar_img.width&&(this.bar_panel.width=1)},t.prototype.updateLvOther=function(t){var e=this.getStarLv(),i=this.getStarExp(),n=x.GameConfig.getZlStarVo(this.getTypeId(),e).exp;Laya.Tween.clearAll(this.bar_panel),Laya.Tween.to(this.bar_panel,{width:i/n*this.bar_img.width},100,null,this.tComp),this.lab_exp.text=i+"/"+n;for(var s=e%10,o=Math.floor(e/10),a=[],r=0;r<10;r++)a.push(r<s);this.list_star.array=a,this.curr_lv.skin="res/zhanling/zhanling_jie"+(0==o?1:o+1)+".png",t<e&&P.UIEffectsFactory.Ins.playAniOnce(11,this.upAni_pos,1.3,1.3)},t.prototype.updateXhTip=function(t){var e=t[0][0],i=this.item_cost,n=R.RoleCenter.instans.vo.bagdata.getItemCount(e),s=A.ItemUtils.getItemVoById(e);i.visible=!0,i.setNeedName(s.name,A.ItemUtils.getSmallIcon(s.icon)),i.setQualColor(A.ItemUtils.getColorByQuality(s.quality)),i.setNeed(n,t[0][1])},t.prototype.onShowGetDlg=function(){var t=this.currZlData,e=this.getTypeId(),i=this.getStarLv(),n=x.GameConfig.getZlStarVo(e,i),s=x.GameConfig.getZlStarVo(e,i+1);o.ItemGetDlg.create(t?s.cost[0][0]:n.activationcost[0][0])},t.prototype.getStarLv=function(){var t=this.currZlData;return t?t.starLv:0},t.prototype.getStarExp=function(){var t=this.currZlData;return t?t.starExp:0},t.prototype.getTypeId=function(){var t=this.currZlData;return t?t.typeId:this.selectId},t}(ui.zhanling.ZlYcUI);e.Zlyc=i}),define("src/g/zhanling/ctrl/ZlYcCtrl",["require","exports","src/g/zhanling/view/ZlYc","src/g/clearRes/ClearResM","../../../manager/GameSocketManager","../../net/messages/sbkZhanLingData","../../../manager/RoleCenter","../../../config/GameConfig","../../../plugin/sbkPropTool","../../../enum/EventName","../../../core/E","src/g/Effects/UIEffectsFactory","../../../component/Type3TipView"],function(t,e,i,n,s,v,f,y,h,c,o,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){this.unJhData=[]}return t.prototype.init=function(){var t;this.view=t=new i.Zlyc,t.selectList.mouseHandler=new Laya.Handler(this,this.selectClick);var e=s.GSM.ins;return e.on(v.sbkOneZLData.KEY,this,this.receiveMsg),e.on(v.zhanlingDrugUpMsg.KEY,this,this.receiveMsg),e.on(v.zhanlingStarUpMsg.KEY,this,this.receiveMsg),e.on(v.zhanlingHuanHuaMsg.KEY,this,this.receiveMsg),o.E.ins.on(c.EventName.WINDOW_PANEL_REMOVED,this,this.otherPR),n.ClearResM.addBgUrl(t.bg.skin),this},t.prototype.otherPR=function(){var t=this.view,e=this.currZlId;t.displayedInStage&&!isNaN(e)&&t.refreshData(e)},t.prototype.selectClick=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.view,n=i.selectList.array[e].id;n!=this.currZlId&&(this.currZlId=n,i.refreshData(n))}},t.prototype.setType=function(t){var e=this.view;e.setType(t);var i=v.sbkZhanLingData.baseId;if(1==t){var n=[],s=y.GameConfig.zltype;for(var o in s)+o!=i&&n.push(s[o]);e.selectList.array=n,this.currZlId=0<n.length?n[0].id:i}else this.currZlId=i;this.title=0==t?"res/zhanling/zhanling_biaoti1.png":"res/zhanling/huanhua_biaoti.png"},t.prototype.receiveMsg=function(t){var e=t.typeId;if(e==this.currZlId){var i=this.view,n=this.unJhData,s=f.RoleCenter.instans.self.zlData,o=s.getOneZhanLing(e);switch(t.msgKey){case v.sbkOneZLData.KEY:o||(o=new v.sbkOneZLData),-1==n.indexOf(o)&&n.push(o),o.copydata(t),_.Type3TipView.showZlTip(e);break;case v.zhanlingDrugUpMsg.KEY:var a=y.GameConfig.getZlDrugVo(t.type,t.curDrugLv);f.RoleCenter.instans.vo.chgItemCount(+a.cost[0][0],-a.cost[0][1]),o&&(o.drugArr[t.type-1]=t.curDrugLv,i.xsDlg&&i.xsDlg.setData(o.drugArr,o.typeId),this.updateFight(),i.refreshData(e));break;case v.zhanlingStarUpMsg.KEY:var r=void 0,l=o?o.starLv:0,h=!1;if(o){var c=y.GameConfig.getZlStarVo(o.typeId,l),u=y.GameConfig.getZlStarVo(o.typeId,l+1);r=u?u.cost:c.cost}else{h=!0;for(var p=0;p<n.length;p++)if(n[p].typeId==t.typeId){o=n[p],n.splice(p,1),s.zlArr.push(o);break}r=y.GameConfig.getZlStarVo(o.typeId,l).activationcost}0<r.length&&f.RoleCenter.instans.vo.chgItemCount(+r[0][0],-r[0][1]);var d=t.curStarLv;if(o.starLv=d,o.starExp=t.curStarExp,l!=d||h){var g=29;0!=d&&d%10==0?g=11:h&&(g=38),m.UIEffectsFactory.Ins.playAniOnce(g,i),this.updateFight()}i.selectList.refresh(),i.refreshData(e),i.updateLvOther(l);break;case v.zhanlingHuanHuaMsg.KEY:s.huanhuaId=t.typeId,i.refreshData(e)}}},t.prototype.updateFight=function(){var t=this.currZlId,e=f.RoleCenter.instans.self.zlData.getOneZhanLing(t);if(e)for(var i=e.skillArr,n=y.GameConfig.zltype[t].skill,s=0;s<n.length;s++){var o=n[s],a=+o[0];e.starLv>=o[1]&&-1==i.indexOf(a)&&i.push(a)}var r=f.RoleCenter.instans.vo.combat;h.sbkPropTool.resetZl();var l=f.RoleCenter.instans.vo.reCheckComBat();f.RoleCenter.instans.event(c.EventName.FIGHT_UP,l-r)},t.prototype.showPage=function(t,e){var i=this.view;t.removeChildren(),t.addChild(i),n.ClearResM.resetViewImg(i),this.refreshData()},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){this.view.refreshData(this.currZlId)},t.prototype.getTitle=function(){return this.title},t.prototype.hidePage=function(){},t.prototype.destroyPage=function(){},t}();e.ZlYcCtrl=a}),define("src/g/shenshou/view/ShenHuanView",["require","exports","../../../config/GameConfig","../../net/messages/sbkPetData","../../../manager/GameSocketManager","../../../utils/ItemUtils","../../../manager/RoleCenter","../../../utils/system/FloatEffect","src/g/itemGets/View/ItemGetDlg","src/init/TextConst"],function(t,e,f,n,s,y,m,i,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t._notC="#ff0000",t._cor="#03bb00",t.list.renderHandler=new Laya.Handler(t,t.rendHandler),t.list.hScrollBarSkin="",t.list.scrollBar.elasticDistance=100,t.list.selectEnable=!0,t.list.selectHandler=new Laya.Handler(t,t.itemseleHandler),t.btn_act.on(Laya.Event.CLICK,t,t.petHHC2GS),s.GSM.ins.on(n.PetHHGS2C.KEY,t,t.petHHGS2CHandler),s.GSM.ins.on(n.PetAvatarGS2C.KEY,t,t.petAvatarGS2C),t.desc.style.font="SimHei",t.desc.style.fontSize=18,t.desc.style.color="#a89e8f",t.desc.style.leading=5,t.desc.style.wordWrap=!0,t.btn_shang.on(Laya.Event.CLICK,t,t.shangHandler),t.btn_xie.on(Laya.Event.CLICK,t,t.xieHandler),t.get_item.on(Laya.Event.CLICK,t,t.getItemHandler),t}return __extends(t,e),t.prototype.getItemHandler=function(){o.ItemGetDlg.create(this.itemid)},t.prototype.petAvatarGS2C=function(t){if(t.opresult){m.RoleCenter.instans.vo.petData.disAvatar=t.hhid;var e=m.RoleCenter.instans.vo.petData;m.RoleCenter.instans.vo.petData=e,i.FE.upItems("切换成功"),this.itemseleHandler(this.list.selectedIndex)}},t.prototype.shangHandler=function(){var t=this.list.array[this.list.selectedIndex].res[0][1],e=new n.PetAvatarC2GS;e.hhid=t,s.GSM.sendServer(e)},t.prototype.xieHandler=function(){var t=new n.PetAvatarC2GS;t.hhid=0,s.GSM.sendServer(t)},t.prototype.itemseleHandler=function(t){var e=this.list;e.selectedIndex!=t&&(e.selectedIndex=t,e.tweenTo(t));var i=this.select,n=(this.jinbi_txt,this.list.array[t]),s=n.skill[0][0],o=f.GameConfig.godpetskill[s];this.lvtxt.text=o.name,this.desc.innerHTML=o.desc;var a=this.list.getCell(t);a&&a.addChild(this.select),this.ani.source="dynamic2/zhiwawa/pet/"+n.res[0][1]+".json";var r=f.GameConfig.godpet[n.res[0][1]],l=r.activationcost[0][0];this.itemid=l;var h=r.activationcost[0][1],c=m.RoleCenter.instans.vo.bagdata.getItemCount(l);this.jinbi_txt.color=h<=c?this._cor:this._notC,this.jinbi_txt.text=c+"/"+h,this.icon.skin=y.ItemUtils.getSmallIcon(l);var u=m.RoleCenter.instans.vo.petData,p=n.res[0][1];this.skillicon.skin=y.ItemUtils.getSkillIconByIconId(r.skill),this.con.visible=!1,this.btn_xie.visible=!1,this.btn_shang.visible=!1;var d=-1!=u.hhIdArr.indexOf(p);if(a){var g=a.getChildByName("qian_icon"),v=a.getChildByName("m_icon");v.gray=d?(u.disAvatar!=p?(this.btn_shang.visible=!0,g.skin="res/shenshou/1.png"):(this.btn_xie.visible=!0,g.skin="res/shenshou/2.png"),!1):(this.con.visible=!0,!(g.skin=""))}else i.removeSelf()},t.prototype.petHHGS2CHandler=function(t){if(t.opresult){m.RoleCenter.instans.vo.petData=t.petdata,i.FE.upItems(a.TextConst.get(973));var e=m.RoleCenter.instans.vo.bagdata.getItemCount(t.hhItemId);0<(e-=t.hhItemNum)&&(e*=-1),m.RoleCenter.instans.vo.chgItemCount(t.hhItemId,e),this.itemseleHandler(this.list.selectedIndex)}},t.prototype.petHHC2GS=function(){var t=new n.PetHHC2GS,e=this.list.array[this.list.selectedIndex],i=f.GameConfig.godpet[e.res[0][1]].id;t.destHHId=i,s.GSM.sendServer(t)},t.prototype.rendHandler=function(t,e){var i=t.getChildByName("m_icon"),n=t.getChildByName("qian_icon"),s=this.list.array[e];i.skin="dynamic/peticon/"+s.res[0][1]+".png";var o=s.res[0][1],a=m.RoleCenter.instans.vo.petData;t.getChildByName("txt_name").text=s.name,a&&(-1!=a.hhIdArr.indexOf(o)?(a.disAvatar!=o?n.skin="res/shenshou/1.png":n.skin="res/shenshou/2.png",i.gray=!1):(n.skin="",i.gray=!0))},t.prototype.showView=function(){var t=f.GameConfig.godpetseting,e=[];for(var i in t)switch(i){case"1":case"2":break;default:e.push(t[i])}this.list.array=e,this.list.selectedIndex=0,this.itemseleHandler(0)},t}(ui.shenshou.ShenHuanUI);e.ShenHuanView=r}),define("src/g/shenshou/view/ShenActTip",["require","exports","../../../utils/SoundUtils","../../../component/GAnimation","src/g/Effects/UIEffectsFactory"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.ani=new n.GAnimation,t.popupEffect=null,t.once(Laya.Event.CLICK,t,t.close),t}return __extends(t,e),t.prototype.popTip=function(t){var e=this.ani;e.clear(),e.alpha=.5,Laya.Tween.to(this.title_img,{y:-100},1500,Laya.Ease.elasticOut),Laya.Tween.to(e,{alpha:1},1e3),i.SoundUtils.getInstance().playSoundById(135),e.parent||s.UIEffectsFactory.Ins.centerSAni4Parent(e,this.sp_ani),e.load(t),this.popup()},t.prototype.close=function(){e.prototype.close.call(this)},t}(ui.alert.ShenActTipUI);e.ShenActTip=o}),define("src/g/shenshou/view/ShenShouActiveView",["require","exports","../../../config/GameConfig","../../net/messages/OpNoParaC2GS","../../../manager/GameSocketManager","../../../enum/GuideTargetName","../../../core/E","../../../enum/EventName","src/g/Effects/UIEffectsFactory"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t._isregist=!1,t.btn_call.on(Laya.Event.CLICK,t,t.callHandler),t}return __extends(t,e),t.prototype.showView=function(){this._vop=i.GameConfig.godpetseting[2];var t=this._vop.res[0][1];this._aniurl="dynamic2/zhiwawa/pet/"+t+".json",this.ani.source=this._aniurl,this._isregist||(this.registUIToGuide(),a.E.ins.event(r.EventName.COMPTYPE_CLICK,o.GuideTargetName.PERSON_BOSS_MONTH_BTN))},t.prototype.callHandler=function(){var t=new n.OpNoParaC2GS;t.optype=n.EOpNopara.activatePet,s.GSM.sendServer(t)},t.prototype.registUIToGuide=function(){this._isregist=!0,this.gani.source=l.UIEffectsFactory.Ins.getSourceUrlById(24)},t}(ui.shenshou.ShenShouActiveUI);e.ShenShouActiveView=h}),define("src/g/shenshou/view/ShouSkillTip",["require","exports","../../../utils/ItemUtils"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.lab_desc.style.font="SimHei",t.lab_desc.style.fontSize=18,t.lab_desc.style.color="#a89e8f",t.lab_desc.style.leading=5,t.lab_desc.style.wordWrap=!0,t}return __extends(t,e),t.prototype.showTip=function(t){this.lab_desc.innerHTML=t.desc,this.imgSkill.skin=i.ItemUtils.getSkillIconByIconId(t.icon),this.popup()},t}(ui.skill.SkillTipUI);e.ShouSkillTip=n}),define("src/g/shenshou/view/ShenYangView",["require","exports","../../net/messages/sbkPetData","../../../manager/RoleCenter","../../../config/GameConfig","../../../utils/ItemUtils","../../net/messages/sbkPetData","../../../manager/GameSocketManager","../../../utils/system/FloatEffect","src/g/shenshou/view/ShouSkillTip","src/g/itemGets/View/ItemGetDlg","../../net/messages/OpNoParaC2GS","../../../enum/EventName","src/init/TextConst","../../../component/GAnimation","../../../meta/CommonVo"],function(t,e,s,v,f,u,o,a,l,r,i,h,c,y,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t._notC="#ff0000",t._cor="#03bb00",t.perPetMaxLv=100,t.maxLv=0,t.isAutoRunning=!1,t.itemid=0,t.myshowindex=1,t._curindex=0,t.btn_eat.on(Laya.Event.CLICK,t,t.eatHandler),t.btn_eat.on(Laya.Event.MOUSE_DOWN,t,t.onUpLvMouDown),t.on(Laya.Event.MOUSE_UP,t,t.onUpLvMouUp),t.btn_eat.on(Laya.Event.MOUSE_OUT,t,t.onUpLvMouMove),t.on(Laya.Event.REMOVED,t,t.stopAuto);var e=a.GSM.ins;e.on(o.FeedPetGS2C.KEY,t,t.feedPetGS2C),e.on(s.PetNewCombatGS2C.KEY,t,t.petNewCombatGS2C),t.skill_icon0.on(Laya.Event.CLICK,t,t.clickHandler),t.skill_icon1.on(Laya.Event.CLICK,t,t.clickHandler),t.skill_icon2.on(Laya.Event.CLICK,t,t.clickHandler),t.skill_icon3.on(Laya.Event.CLICK,t,t.clickHandler),t.get_item.on(Laya.Event.CLICK,t,t.getItemHandler),t.btn_jin.on(Laya.Event.CLICK,t,t.jinHandler),t.pre_btn.on(Laya.Event.CLICK,t,t.preHandler),t.next_btn.on(Laya.Event.CLICK,t,t.nextHandler);var i=f.GameConfig.godpetseting[2].res.length;return t.maxLv=f.GameConfig.godpetseting[2].res[i-1][0],t.showlist.renderHandler=new Laya.Handler(t,t.rendHandler),t.showlist.hScrollBarSkin="",t.showlist.scrollBar.elasticDistance=100,t}return __extends(t,n),t.prototype.onUpLvMouDown=function(){this.parent&&Laya.timer.once(d.CommonVo.getVoByKey("anzhuTimeInterval").val2num,this,this.beginAuto)},t.prototype.onUpLvMouUp=function(){this.stopAuto()},t.prototype.onUpLvMouMove=function(){this.isAutoRunning&&this.stopAuto()},t.prototype.beginAuto=function(){this.parent&&(this.isAutoRunning||(Laya.timer.loop(d.CommonVo.getVoByKey("anzhuTime").val2num,this,this.eatHandler),this.isAutoRunning=!0))},t.prototype.stopAuto=function(){Laya.timer.clear(this,this.beginAuto),Laya.timer.clear(this,this.eatHandler),this.isAutoRunning=!1},t.prototype.rendHandler=function(t,e){var i=this.showlist.array[e],n=t.getChildByName("huanid0");n.skin="dynamic/peticon/"+i.res[0][1]+".png",t.getChildByName("huanname0").text=i.name,this.setState(n,i.res[0][1])},t.prototype.nextHandler=function(){var t=this._curindex+1;this.showSkill(t,101*t)},t.prototype.preHandler=function(){var t=this._curindex-1;this.showSkill(t,101*t||1)},t.prototype.petNewCombatGS2C=function(t){this.next_txt.text=y.TextConst.get(976,t.combat)},t.prototype.getItemHandler=function(){i.ItemGetDlg.create(this.itemid)},t.prototype.clickHandler=function(t){var e=new r.ShouSkillTip,i=t.target.skillid,n=f.GameConfig.godpetskill[i];e.showTip(n),e.skill_name.text=n.name,e.di_icon.skin="",e.petskin.visible=!0},t.prototype.feedPetGS2C=function(t){if(t.opresult){var e=v.RoleCenter.instans.vo.petData,i=e.petid;e.petexp=t.petexp,e.petid=t.petid;var n=e.petid,s=f.GameConfig.godpet[n];if(l.FE.upItems(y.TextConst.get(975)),e.petlvl=s.level,e.combat!=t.newcombat&&t.newcombat){e.combat=t.newcombat;var o=v.RoleCenter.instans.vo.combat,a=v.RoleCenter.instans.vo.reCheckComBat();v.RoleCenter.instans.event(c.EventName.FIGHT_UP,a-o)}var r=f.GameConfig.godpet[i];r&&r.const.length&&v.RoleCenter.instans.vo.chgItemCount(r.const[0][0],-r.const[0][1]),t.newskill&&(l.FE.upItems(y.TextConst.get(977)),-1==e.openSkill.indexOf(t.newskill)&&e.openSkill.push(t.newskill)),v.RoleCenter.instans.vo.petData=e,this.showView(!0)}},t.prototype.eatHandler=function(){var t=v.RoleCenter.instans.vo,e=t.petData.petid,i=f.GameConfig.godpet[e];if(t.bagdata.getItemCount(i.const[0][0])){var n=new o.FeedPetC2GS;n.feedTimes=1,a.GSM.sendServer(n)}else this.stopAuto(),l.FE.upItems(y.TextConst.get(520))},t.prototype.jinHandler=function(){var t=v.RoleCenter.instans.vo.petData,e=t.petid,i=f.GameConfig.godpet[e],n=(i.exp-t.petexp)/i.perExp;if(n<=1&&(n=1),n*i.const[0][1]<=v.RoleCenter.instans.vo.bagdata.getItemCount(i.const[0][0])){var s=new o.FeedPetC2GS;s.feedTimes=n,a.GSM.sendServer(s)}else l.FE.upItems(y.TextConst.get(520))},t.prototype.setState=function(t,e){-1!=v.RoleCenter.instans.vo.petData.hhIdArr.indexOf(e)?t.gray=!1:t.gray=!0},t.prototype.showView=function(t){this._ani||(this._ani=new p.GAnimation,this.m_con.addChild(this._ani)),this.probarcon.visible=!0,this.btn_jin.visible=!1,this.btn_eat.visible=!0;var e=v.RoleCenter.instans.vo.petData,i=e.petid,n=f.GameConfig.godpet[i],s=f.GameConfig.godpetseting,o=[];for(var a in s)switch(a){case"1":case"2":break;default:o.push(s[a])}if(this.showlist.array=o,this.con.visible=!0,this.man_txt.visible=!1,0==n.const.length)this.pre_btn.visible=!0,this.next_btn.visible=!1,this.con.visible=!1,this.man_txt.visible=!0;else{this.pre_btn.visible=!1,this.next_btn.visible=!0,this.cur_txt.text=y.TextConst.get(976,e.combat),this.costicon.skin=u.ItemUtils.getSmallIcon(n.const[0][0]);var r=v.RoleCenter.instans.vo.bagdata.getItemCount(n.const[0][0]);if(e.petlvl%100==0){this.btn_eat.visible=!1,this.btn_jin.visible=!0,this.probarcon.visible=!1;var l=(n.exp-e.petexp)/n.perExp;l<=1&&(l=1),this.count_txt.text=r+"/"+n.const[0][1]*l,r<n.const[0][1]*l?this.count_txt.color=this._notC:this.count_txt.color=this._cor}else r>=n.const[0][1]?this.count_txt.color=this._cor:this.count_txt.color=this._notC,this.count_txt.text=r+"/"+n.const[0][1];this.itemid=n.const[0][0],this.getCombat()}this.pro_txt.text=e.petexp+"/"+n.exp;var h=e.petexp/n.exp*400;Laya.Tween.clearAll(this.progro),t?h<this.progro.width?Laya.Tween.to(this.progro,{width:400},300,null,Laya.Handler.create(this,this.endPro,[h])):Laya.Tween.to(this.progro,{width:h},300,null):this.progro.width=h,this.qin_value.value=e.petlvl+"";var c=(e.petlvl-1)/this.perPetMaxLv>>0;this.myshowindex=c+1,this.showSkill(c,e.petlvl)},t.prototype.endPro=function(t){this.progro.width=0,Laya.Tween.to(this.progro,{width:t},300,null)},t.prototype.effectExp=function(){},t.prototype.showSkill=function(t,e){if(!(this.myshowindex<t||(this.next_btn.visible=!0,this.pre_btn.visible=!0,t<=0&&(this.next_btn.visible=!0,this.pre_btn.visible=!1),t<0))){var i=f.GameConfig.godpetseting[2].skill;if(t==i.length/4-1&&(this.next_btn.visible=!1,this.pre_btn.visible=!0),!(t>=i.length/4)){var n=v.RoleCenter.instans.vo.petData;this._curindex=t;for(var s=0,o=Math.min(i.length,4*t+4),a=Math.min(4*t,i.length-4);a<o;a++){var r=this["skill_qin"+s],l=this["skill_icon"+s],h=i[a][0]>>0,c=f.GameConfig.godpetskill[h];l.skin="dynamic/skillicon/"+c.icon+".png",r.text=y.TextConst.get(978,i[a][1]),r.color="#ff2705",-1==n.openSkill.indexOf(h)?l.gray=!0:(l.gray=!1,r.text=c.name,r.color="#fff452"),l.skillid=h,s++}var u=f.GameConfig.godpet[e];if(u){this.huanname.text=u.name;var p=1e3,d=f.GameConfig.godpetseting[2].res;for(var g in d){if(d[g][0]>>0>u.level)break;p=d[g][1]>>0}this._ani._url!="dynamic2/zhiwawa/pet/"+p+".json"&&this._ani.clear(!0),this._ani.load("dynamic2/zhiwawa/pet/"+p+".json",!0,3),this.icon.skin="dynamic/peticon/"+p+".png"}}}},t.prototype.getCombat=function(){var t=new h.OpNoParaC2GS;t.optype=h.EOpNopara.nextLvCombat,a.GSM.sendServer(t)},t}(ui.shenshou.ShenYangUI);e.ShenYangView=n}),define("src/g/shenshou/view/ShenShouView",["require","exports","src/g/shenshou/view/ShenHuanView","../../../manager/RoleCenter","src/g/shenshou/view/ShenShouActiveView","src/g/shenshou/view/ShenYangView"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.showView=function(t){switch(this.bgview.box_page.removeChildren(),this.bgview.img_title.skin="res/shenshou/shenshou_biaoti_wenzi.png",t){case 0:this.checkAct();break;case 1:this._shenhuan||(this._shenhuan=new i.ShenHuanView),this.bgview.box_page.addChild(this._shenhuan),this._shenhuan.showView()}},e.prototype.checkAct=function(){n.RoleCenter.instans.vo.petData&&n.RoleCenter.instans.vo.petData.open?(this._shenyang||(this._shenyang=new o.ShenYangView),this.bgview.box_page.addChild(this._shenyang),this._shenyang.showView(!1)):(this._noactive||(this._noactive=new s.ShenShouActiveView),this.bgview.box_page.addChild(this._noactive),this._noactive.showView())},e}(ui.shenshou.ShenShouUI);e.ShenShouView=a}),define("src/g/zhanling/ctrl/ZlHhCtrl",["require","exports","src/init/Switches","src/g/proxy/MultiLevelUIProxy","../../../manager/LayerManager","src/g/clearRes/ClearResM","src/g/zhanling/ctrl/ZlYcCtrl","src/g/base/BaseCtrl","src/g/shenshou/view/ShenShouView"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.urls=["res/atlas/res/zhanling.json"],i.Switches.ins.on(209,t,t.onOpenHandler,[209]),t}return __extends(t,e),t.prototype.onOpenHandler=function(t,e,i){void 0===i&&(i=!1),e&&(this.id=t,this.closeOther=i,this.opens())},t.prototype.onAtlasLoaded=function(){var t=this.view,e=this._tabProxy;t||(this.view=t=new l.ShenShouView,t.tab.visible=!1,this._tabProxy=e=new n.MultiLevelUIProxy,e.registerTab(t.tab,0),e.registerTagIndex(209,0),e.selectHandler=new Laya.Handler(this,this.tab_selectHandler),t.bgview.btn_close.on(Laya.Event.CLICK,this,this.closeSelf),t.bgview.btn_back.on(Laya.Event.CLICK,this,this.closeSelf)),e.open(this.id),t.displayedInStage||(s.LayerManager.addInPOPWindowLayer(t,this.closeOther),o.ClearResM.resetViewImg(t))},t.prototype.closeSelf=function(){this.view.bgview.box_page.removeChildren(),this.view.removeSelf()},t.prototype.tab_selectHandler=function(t){void 0===t&&(t=0);var e=this._page;switch(e&&e.hidePage(),t){case 0:this.zlyc||(this.zlyc=(new a.ZlYcCtrl).init()),this.zlyc.setType(1),e=this.zlyc}e&&(e.showPage(this.view.bgview.box_page),this.view.bgview.img_title.skin=e.getTitle()),this._page=e},t}(r.BaseCtrl);e.ZlHhCtrl=h}),define("src/init/GameInit",["require","exports","src/g/shop/ctrl/ShopCtrl","src/g/field/ctrl/FieldViewCtrl","src/g/account/ctrl/OffLineViewCtrl","src/g/account/ctrl/PortEffectUpViewCtrl","src/g/account/ctrl/AccountViewCtrl","src/g/index/ctrl/EnterPortViewCtrl","src/g/role/ctrl/GRoleViewCtrl","src/g/index/ctrl/FightCtrl","src/g/fight/osprite/NetCtroller","../manager/RoleCenter","../g/net/messages/messageBase/MessageInit","src/g/skill/ctrl/SkillViewCtrl","src/g/bag/ctrl/BagViewCtrl","src/g/index/ctrl/GameIndexCtrl","src/g/login/ctrl/LoginViewCtrl","src/g/configjson/ctrl/ConfigJsonCtrl","../manager/LayerManager","src/g/openHero/Ctrl/OpenHeroCtrl","src/g/mail/ctrl/MailViewCtrl","src/g/vip/ctrl/VipViewCtrl","src/g/role/ctrl/Govern/GGovernCtrl","../manager/OpenPanelManager","src/g/chat/ctrl/ChatViewCtrl","src/g/welfare/ctrl/GWelfareViewCtrl","src/g/firstRecharge/ctrl/FirstRechargeViewCtrl","src/g/recharge/ctrl/RechargeCtrl","src/g/privileges/ctrl/PrivilegesCtrl","src/g/activity/ctrl/ActivityCtrl","src/g/dayRecharge/ctrl/DayRechargeViewCtrl","src/g/firstRecharge/ctrl/CommonRechargeCtrl","src/g/dress/ctrl/DressViewCtrl","src/g/rechristen/ctrl/rechristenCtrl","../prop/sbkPublicFun","../utils/DropUtil","src/g/skill/ctrl/ContinuedAttkSkillCtrl","src/g/copy/ctrl/CopyPanelCtrl","src/g/boss/ctrl/BossTimeCtrl","src/g/boss/ctrl/BoossRewardViewCtrl","src/g/boss/ctrl/ZSRewardViewCtrl","src/g/boss/ctrl/BossviewCtrl","src/g/relic/ctrl/GRelicCtrl","src/g/friend/ctrl/FriendViewCtrl","src/g/monopoly/ctrl/MonopolyViewCtrl","src/g/copy/ctrl/TurnTableCtrl","src/g/forge_new/ctrl/GNForgeCtrl","src/g/timelimittask/ctrl/TimeLimitTaskCtrl","src/g/accessctrl/AccessCenter","src/g/copy/ctrl/EXPAttributeCardViewCtrl","src/g/copy/ctrl/ExpCopyMainViewCtrl","src/g/copy/ctrl/EXPAccountViewCtrl","src/g/phrase/ctrl/PhraseCtrl","src/g/peronboss/ctrl/PersonBossCtrl","src/g/copy/ctrl/MaterialCopyCtrl","src/g/field/ctrl/RevengeCtrl","src/g/Effects/GameUIEffectCtrl","src/g/activity/ctrl/DailyRechargeQuickCtrl","src/g/common/ctrl/CommonCtrl","src/g/helper/ctrl/HelperCtrl","src/g/tips/ctrl/TipsViewCtrl","src/g/activity/ctrl/ActivityHallViewCtrl","src/g/auctions/ctrl/AuctionsViewCtrl","src/g/hotblood/ctrl/HotBloodWarCtrl","src/g/worldboss/ctrl/WorlBossCtrl","src/g/timelimittask/ctrl/TimeLimitTaskViewCtrl","src/g/timelimittask/ctrl/RxZtTaskViewCtrl","src/g/hotbloodtemple/ctrl/HBloodPagodaViewCtrl","src/g/hotbloodtemple/ctrl/HotBloodPagodaBalanceCtrl","src/g/worldboss/ctrl/WorldBossWarCtrl","src/g/gift/ctrl/GiftCtrl","src/g/boss/ctrl/HugeDominateViewCtrl","src/g/accesspop/ctrl/AccessPopCtrl","src/g/fightactivity/ctrl/ActivtyTip","src/g/copy/view/expcopy/ExpSkillBuffDialogCtrl","src/g/gameSdk/gameSdk","src/g/role/ctrl/ZsRewardDlgCtrl","src/g/crossserboss/ctrl/CSerBossMainViewCtrl","src/g/role_other/ctrl/GOtherRoleCtrl","src/g/crossserboss/ctrl/KFHotBloodWarCtrl","src/g/moneyreward/ctrl/MoneyRewardCtrl","src/init/ChannelTimer","src/g/account/ctrl/OpenTipsCtrl","src/g/account/ctrl/SeekHelpCtrl","src/g/kftb/ctrl/KFTBHotBloodWarCtrl","src/g/timelimittask/ctrl/HtTaskViewCtrl","src/g/hteffect/ctrl/HtEffectCtrl","src/g/role/ctrl/RoleSsCtrl","../manager/RedDotM","src/g/share/ctrl/ShareCtrl","src/g/share/ctrl/ShareShopCtrl","src/g/crossserboss/csathletics/ctrl/CSAthleticsMainViewCtrl","src/g/copy/ctrl/TeamCopyFightViewCtrl","src/g/copy/ctrl/TeamCopyMainCtrl","src/g/zhanyu/ctrl/KFZYHotBloodWarCtrl","src/g/zhanling/ctrl/ZlHhCtrl"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E,T,A,R,L,x,P,k,D,H,M,G,B,N,U,V,O,F,q,K,Y,j,J,W,z,X,Q,Z,$,tt,et,it,nt,st,ot,at,rt,lt,ht,ct,ut,pt,dt,gt,vt,ft,yt,mt,_t,Ct,It,bt,wt,St,Et,Tt,At,Rt,Lt,xt,Pt,kt,Dt,Ht,Mt,Gt,Bt,Nt,Ut,Vt,Ot){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var Ft=function(){function t(){}return t.init=function(){It.gameSdk.Ins.init(),p.MessageInit.init(),p.MessageInit.initPoolFunc(),u.RoleCenter.instans.init(),m.LayerManager.init(),c.NetCtroller.init(),Ht.RedDotM.init(),t.initCtrl(),w.OpenPanelManager.init(),new H.sbkPublicFun,M.DropUtil.init(),W.AccessCenter.ins,At.ChannelTimer.ins},t.initCtrl=function(){new Dt.RoleSsCtrl,new Lt.SeekHelpCtrl,new Rt.OpenTipsCtrl,new bt.ZsRewardDlgCtrl,new at.TipsViewCtrl,(new st.CommonCtrl).init(),new B.CopyPanelCtrl,new y.ConfigJsonCtrl,(new n.FieldViewCtrl).init(),(new s.OffLineViewCtrl).init(),new f.LoginViewCtrl,new h.FightCtrl,new N.BossTimeCtrl,(new O.BossviewCtrl).init(),new v.GameIndexCtrl,(new g.BagViewCtrl).init(),new d.SkillViewCtrl,new l.GRoleViewCtrl,new j.GNForgeCtrl,new ot.HelperCtrl,new r.EnterPortViewCtrl,(new a.AccountViewCtrl).init(),(new o.PortEffectUpViewCtrl).init(),new F.GRelicCtrl,(new i.ShopCtrl).init(),new _.OpenHeroCtrl,(new C.MailViewCtrl).init(),(new I.VipViewCtrl).init(),new b.GGovernCtrl,(new U.BoossRewardViewCtrl).init(),(new S.ChatViewCtrl).init(),(new E.GWelfareViewCtrl).init(),new St.GOtherRoleCtrl,(new T.FirstRechargeViewCtrl).init(),(new A.RechargeCtrl).init(),(new R.PrivilegesCtrl).init(),(new L.ActivityCtrl).init(),(new x.DayRechargeViewCtrl).init(),(new V.ZSRewardViewCtrl).init(),(new D.RechristenCtrl).init(),(new P.CommonRechargeCtrl).init(),(new k.DressViewCtrl).init(),(new G.ContinuedAttkSkillCtrl).init(),(new q.FriendViewCtrl).init(),(new K.MonopolyViewCtrl).init(),new Y.TurnTableCtrl,(new z.EXPAttributeCardViewCtrl).init(),(new X.ExpCopyMainViewCtrl).init(),(new Q.EXPAccountViewCtrl).init(),(new Z.PhraseCtrl).init(),new $.PersonBossCtrl,new tt.MaterialCopyCtrl,new et.RevengeCtrl,new it.GameUIEffectCtrl,(new nt.DailyRechargeQuickCtrl).init(),new rt.ActivityHallViewCtrl,new lt.AuctionsViewCtrl,new ht.HotBloodWarCtrl,new Et.KFHotBloodWarCtrl,new xt.KFTBHotBloodWarCtrl,new ut.TimeLimitTaskViewCtrl,(new J.TimeLimitTaskCtrl).init(),new pt.RxZtTaskViewCtrl,(new dt.HBloodPagodaViewCtrl).init(),(new gt.HotBloodPagodaBalanceCtrl).init(),new ct.WorlBossCtrl,new vt.WorldBossWarCtrl,new ft.GiftCtrl,new yt.HugeDominateViewCtrl,new mt.AccessPopCtrl,new _t.ActivityTip,new Ct.ExpSkillBuffDialogCtrl,new wt.CSerBossMainViewCtrl,new Tt.MoneyRewardCtrl,new Bt.CSAthleticsMainViewCtrl,new Pt.HtTaskViewCtrl,new kt.HtEffectCtrl,new Mt.ShareCtrl,new Gt.ShareShopCtrl,Ut.TeamCopyMainCtrl.ins,new Nt.TeamCopyFightViewCtrl,new Vt.KFZYHotBloodWarCtrl,new Ot.ZlHhCtrl,window.isNewLogin||window.requirejs(["src/g/a/GameInit2"],function(t){})},t}();e.GameInit=Ft}),define("src/g/chat/view/ChatFontClip",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t._clip=new Laya.FontClip,t._clip.skin="res/custom/vip_shuzi.png",t._clip.sheet="0123456789",t.addChild(t._clip),t._clip.on(Laya.Event.RESIZE,t,t.onResizeHandler),t}return __extends(t,e),Object.defineProperty(t.prototype,"value",{set:function(t){this._clip.value=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"spaceX",{set:function(t){this._clip.spaceX=t},enumerable:!0,configurable:!0}),t.prototype.onResizeHandler=function(){this.contextWidth=20,this.contextHeight=20,this.layout(),this._layoutLater()},t}(laya.html.dom.HTMLDivElement);e.ChatFontClip=i}),define("src/init/GameMain",["require","exports","../enum/GameConst","../manager/AM","src/init/GameInit","../enum/EventName","../debug/Debug","../utils/system/FloatEffect","../config/GameConfig","../meta/ErrCodeVo","../g/net/messages/sbkFormula","../utils/SoundUtils","../component/ChatAni","src/g/fight/osprite/map/MapConst","src/g/chat/view/ChatFontClip","../component/ChatImage","src/g/gameSdk/gameSdk","../utils/StringUtils","src/init/ResManager"],function(t,e,i,n,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function s(){if(this.taFocusIn=this.delayScrollBody.bind(this),this.taFocusOut=this.removeDelayScrollBody.bind(this),g.MapConst.SCREEN_WIDTH=Laya.stage.width,g.MapConst.SCREEN_HEIGHT=Laya.stage.height,Laya.loader.clearRes("dynamic2/uieffect/EUI1_2.png"),u.sbkFormula.initFakeRand(),Laya.ClassUtils.regClass("chatimg",d.ChatAni),Laya.ClassUtils.regClass("chatfontclip",v.ChatFontClip),Laya.ClassUtils.regClass("chatimage",f.ChatImage),ktgame.customView.ItemNeedCtrol.NumStringInt=m.StringUtils.NumStringInt,Laya.stage.on(laya.events.Event.VISIBILITY_CHANGE,this,this.onVisibleChange),wx.onHide&&wx.onHide(function(t){Laya.stage.renderingEnabled=!1,console.error("隐藏")}),wx.onShow&&wx.onShow(function(t){Laya.stage.renderingEnabled=!0,console.error("显示")}),r.Debug.init(),Laya.Render.isWebGL){var e=Laya.Node.prototype.destroy;Laya.Node.prototype.destroy=function(t){this.event(a.EventName.ON_UI_DESTROYED),e.call(this,t)};var t=Laya.WebGLImage.prototype.onresize;Laya.WebGLImage.prototype.onresize=function(){t.call(this),this._allowMerageInAtlas=!1},Laya.Render.optimizeTextureMemory=function(t,e){return!(e&&e.bitmap&&e.bitmap instanceof Laya.WebGLImage)}}window.ktgamepreloadjdk.iswxMode?window.requirejs(["src/core/E"],function(t){var n=t.E.prototype.event;t.E.prototype.event=function(t,e){var i=n.call(this,t,e);return ktgame.E.event(t,e),i}}):window.require(["core/E"],function(t){var n=t.E.prototype.event;t.E.prototype.event=function(t,e){var i=n.call(this,t,e);return ktgame.E.event(t,e),i}}),Laya.FontClip.prototype.restskin=function(){var t=this.skin;if(t){var e=Laya.loader.getRes(t);e?(this.loadComplete(t,e),this.callLater(this.changeValue)):(this.skin="",this.skin=t)}},Laya.SoundManager.autoReleaseSound=!1;var i=Laya.WebAudioSoundChannel.prototype.stop;Laya.WebAudioSoundChannel.prototype.stop=function(){i.call(this);var t=s.delay;0!=t&&Laya.timer.once(t,null,Laya.SoundManager.disposeSoundIfNotUsed,[this.url],!1)};var n=Laya.WebAudioSoundChannel.prototype.pause;Laya.WebAudioSoundChannel.prototype.pause=function(){n.call(this);var t=s.delay;0!=t&&Laya.timer.once(t,null,Laya.SoundManager.disposeSoundIfNotUsed,[this.url],!1)},Laya.stage.on(Laya.Event.CLICK,this,this.mouseHandler),UIConfig.popupBgAlpha=.9,ktgame.component.AccordionBox.floatTextHandler=Laya.Handler.create(null,function(t,e){l.FE.upItems(t,e)},null,!1),this.completeHandler(),Laya.Loader.getRes=this.getRes}return s.prototype.getRes=function(t){if(!t||" "==t)return"";var e=Laya.Loader.loadedMap[Laya.URL.formatURL(t)];return e||!_.ResManager.getInstance().checkIsInLimitMemery()&&(-1<t.indexOf(".jpg")||-1<t.indexOf(".png"))&&((e=s.texture).bitmap||(e.bitmap=new Laya.Bitmap)),e},s.getDisSvrId=function(t){var e,i=t.split("_")[1];if(!(i&&0<i.length))return"S0.";e=parseInt(i);return y.gameSdk.Ins.diyObj&&y.gameSdk.Ins.diyObj.startSvrId?this._startSvrId=y.gameSdk.Ins.diyObj.startSvrId:this._startSvrId=1e3,"S"+(e-this._startSvrId)+"."},s.getSvrIdStr=function(t){var e=1e3;return this._startSvrId=ktgameconfig.LoginVo.startsvid,(e=t-this._startSvrId)<0&&(e=-e),"S"+e},s.prototype.onVisibleChange=function(){},s.prototype.mouseHandler=function(t){t.target instanceof Laya.Button&&p.SoundUtils.getInstance().playBtnsounds()},s.prototype.completeHandler=function(){Laya.loader.load([{url:i.GameConst.errorCode_JSON,type:Laya.Loader.JSON}],Laya.Handler.create(this,this.preHandler))},s.prototype.preHandler=function(){h.GameConfig.errorCodeJSON=this.initVo4Json(Laya.Loader.getRes(i.GameConst.errorCode_JSON),c.ErrCodeVo),o.GameInit.init(),n.AM.init(),Laya.Browser.onIOS||this.initLayaInput()},s.prototype.initVo4Json=function(t,e){if(t){for(var i={},n=0;n<t.length;n++){(new e).init(t[n],i)}return i}},s.prototype.initLayaInput=function(){var t=Laya.Input.input;t.rows=1,t.onfocus=this.taFocusIn,t.onblur=this.taFocusOut},s.prototype.delayScrollBody=function(){Laya.timer.loop(500,this,this.scrollDocBody)},s.prototype.scrollDocBody=function(){Laya.Browser.document.body.scrollTop=Laya.Browser.document.body.scrollHeight},s.prototype.removeDelayScrollBody=function(){Laya.timer.clear(this,this.scrollDocBody)},s._startSvrId=0,s.delay=1e4,s.texture=new Laya.Texture(new Laya.Bitmap),s}();new(e.GameMain=s)}),define("src/g/crossserboss/PointWarPlayer",["require","exports","src/g/boss/view/SCFoeHead","../../utils/ItemUtils","src/g/fight/osprite/play/PlayManager","../net/messages/ChangeSceneMsg","src/init/GameMain"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.imgNameGround.sizeGrid="",t.imgNameGround.height=23,t}return __extends(t,e),t.prototype.update2=function(t){if(void 0===t&&(t="right"),this._data=this.dataSource,this.layout(t),this._data){var e=void 0;if(0<this._data.getFightCount()&&(e=this._data.getUnitByIndex(0)),e)switch(this.imgHead.skin=n.ItemUtils.getHeadurlYuan(e.sex,e.job),this.imgHead.gray=this._data.isDeath(),s.PlayManager.type){case o.EPlayType.PLAYTYPE_KFRX:this._data.userData?this.lbName.text=a.GameMain.getDisSvrId(this._data.userData.username)+this._data.getNickName():this._data.otherData&&(this.lbName.text=a.GameMain.getDisSvrId(this._data.otherData.username)+this._data.getNickName());break;default:this.lbName.text=e.actorName}else this.reset()}else this.reset()},t.prototype.updWinner2=function(t){if(this._data=t,this._data){var e=void 0;if(0<this._data.getFightCount()&&(e=this._data.getUnitByIndex(0)),e)switch(this.winnerimgHead.skin=n.ItemUtils.getHeadurlYuan(e.sex,e.job),s.PlayManager.type){case o.EPlayType.PLAYTYPE_KFRX:t.userData?this.winnerlbName.text=a.GameMain.getDisSvrId(t.userData.username)+t.getNickName():t.otherData&&(this.winnerlbName.text=a.GameMain.getDisSvrId(t.otherData.username)+t.getNickName());break;default:this.winnerlbName.text=e.actorName}else this.reset()}else this.reset()},t.prototype.getDataAsFightGroup=function(){return this._data},t.prototype.onTypePlayer=function(){this.bossContaner.visible=this.winnerContainer.visible=!1,this.normalContainer.visible=!0,this.height=90,this.width=140},t}(i.SCFoeHead);e.PointWarPlayer=r}),define("src/g/hotblood/view/HotBloodWar",["require","exports","src/g/crossserboss/PointWarPlayer","../../../manager/LayerManager","../../../core/E","../../../enum/EventName","src/g/boss/view/SCFoeHead","../../../utils/ItemUtils","../../../manager/RoleCenter","../../net/messages/chat/ChatGS2C","../../net/messages/chat/ChatC2GS","src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.mouseThrough=!0,t.width=Laya.stage.width,t.height=Laya.stage.height,t.foeIndexDict=new Laya.Dictionary,t.familyIndexDict=new Laya.Dictionary,t.playerIndexDict=new Laya.Dictionary,t.bossHead=new i.PointWarPlayer,t.bossHead.setType(0),t.bossHead.right=0,t.bossHead.y=137,t.addChild(t.bossHead),t.guiShuZhe=new i.PointWarPlayer,t.guiShuZhe.setType(1),t.guiShuZhe.y=34,t.guiShuZheBox.addChildAt(t.guiShuZhe,0),t.setGuiShuZhe(null),t.imgAttack.visible=t.myFMember.visible=t.foeFMember.visible=!1,t.initList(t.foeList,t.foeRender,i.PointWarPlayer),t.initList(t.myFamilyList,t.familyPlayerRender,i.PointWarPlayer),t.initList(t.playerList,t.playerRender,i.PointWarPlayer),t.familyFriendLink.on(Laya.Event.CLICK,t,t.onLinkHandler),t.guiShuZheBox.on(Laya.Event.CLICK,t,t.attackGuiShuzheHander),t.hideOPlayerButton.visible=!1,t}return __extends(t,e),t.prototype.attackGuiShuzheHander=function(){s.E.ins.event(o.EventName.SELECT_PK_TARGET,this.guiShuZhe.getDataAsFightGroup().groupID)},t.prototype.initList=function(t,e,i){t.selectEnable=!0,t.vScrollBarSkin="",t.itemRender=i,t.scrollBar.elasticDistance=100,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.caculateListH=function(t,e){if(null==t.array||0==t.array.length)t.height=0;else{var i=Math.min(e,t.array.length),n=90*i+(i-1)*t.spaceY;t.height=n}},t.prototype.foeRender=function(t,e){t.update2("left"),t.showAttackerEf(),t.on(Laya.Event.CLICK,this,this.attFoeHander)},t.prototype.familyPlayerRender=function(t,e){t.update2("left"),t.on(Laya.Event.CLICK,this,this.attackFamilyList)},t.prototype.playerRender=function(t,e){t.update2("right"),t.on(Laya.Event.CLICK,this,this.attplayerHander)},t.prototype.showView=function(){n.LayerManager.addInUILayer(this)},t.prototype.updFoeList=function(t){var e=this.deleteEmptyData(t,this.foeIndexDict);this.foeList.array=e,this.caculateListH(this.foeList,3),this.imgAttack.visible=e&&0!=e.length},t.prototype.updMyFamilyList=function(t){var e=this.deleteEmptyData(t,this.familyIndexDict);this.myFamilyList.array=e,this.caculateListH(this.myFamilyList,2),this.myFMember.visible=e&&0!=e.length,this.myFMemberNum.text=p.TextConst.get(360,e.length)},t.prototype.updPlayerList=function(t){var e=this.deleteEmptyData(t,this.playerIndexDict,!0);this.playerList.array=e,this.caculateListH(this.playerList,4),this.foeFMember.visible=e&&0!=e.length,this.foeFMemberNum.text=p.TextConst.get(361,e.length)},t.prototype.deleteEmptyData=function(t,e,i){void 0===i&&(i=!1),e.clear();var n=[];if(t)for(var s=t.length,o=void 0,a=0;a<s;a++)null!=(o=t[a])&&(i&&(0!=o.isInSafeArea||o.isDeath())||(n.push(o),e.set(o,a)));return n},t.prototype.attplayerHander=function(t){var e=t.currentTarget,i=this.playerIndexDict.get(e.dataSource);s.E.ins.event(o.EventName.SELECT_TARGET_INDEX,i)},t.prototype.attFoeHander=function(t){var e=t.currentTarget,i=this.foeIndexDict.get(e.dataSource);s.E.ins.event(o.EventName.SELECT_REVENGE_TARGET_INDEX,i)},t.prototype.attackFamilyList=function(t){var e=t.currentTarget,i=this.familyIndexDict.get(e.dataSource);s.E.ins.event(o.EventName.SELECT_FAMILYMEMBER_INDEX,i)},t.prototype.changeAttackTarget=function(t){this.clearAttackSign(),null!=t&&(""==t?this.bossHead.updStatus(a.SCFoeHead.BE_ATTACK):(null!=this.guiShuZhe.getDataAsFightGroup()&&this.guiShuZhe.getDataAsFightGroup().groupID==t&&this.guiShuZhe.updStatus(a.SCFoeHead.BE_ATTACK),this.showAttackSignInList(this.foeList,t),this.showAttackSignInList(this.playerList,t),this.showAttackSignInList(this.myFamilyList,t)))},t.prototype.clearAttackSign=function(){this.bossHead.reset(),this.guiShuZhe.reset(),this.clearListAttackSign(this.foeList),this.clearListAttackSign(this.playerList),this.clearListAttackSign(this.myFamilyList)},t.prototype.clearListAttackSign=function(t){for(var e=0;e<t.cells.length;e++)t.cells[e].reset()},t.prototype.showAttackSignInList=function(t,e){for(var i,n=0;n<t.cells.length;n++)(i=t.cells[n]).getName()==e&&i.updStatus(a.SCFoeHead.BE_ATTACK)},t.prototype.onDeath=function(){this.clearAttackSign()},t.prototype.setBoss=function(t,e){this.bossMaxHP=e,this.imgBossHead.skin=r.ItemUtils.getBossIconByPort(t.port),this.lbBossName.text=t.name,this.bossHead.updateBoss(t)},t.prototype.updBossHP=function(t){var e=Math.min(380*t/this.bossMaxHP>>0,380);this.progressBar.width=e,this.progress_txt.text=(t/this.bossMaxHP*100).toFixed(2)+"%",this.bossInFoBox.visible=!(t<=0)},t.prototype.setGuiShuZhe=function(t){t?(this.guiShuZheBox.visible=!0,this.guiShuZhe.updWinner2(t),l.RoleCenter.instans.self.username==t.groupID||l.RoleCenter.instans.self.ufData.familyUId==t.getFamilyUid()&&""!=l.RoleCenter.instans.self.ufData.familyUId?this.imgFamily.skin="res/fightview/rxzc_wohuitubiao.png":this.imgFamily.skin="res/fightview/rxzc_dihuitubiao.png",l.RoleCenter.instans.self.username==t.groupID?(this.imgowner.visible=!0,this.attackBoss.visible=!1):(this.imgowner.visible=!1,this.attackBoss.visible=!0)):(this.guiShuZheBox.visible=!1,this.imgowner.visible=!1,this.attackBoss.visible=!0)},t.prototype.updGuiShuZheHP=function(t,e){this.guiShuZhe.updBlood(t,e)},t.prototype.visibleBossView=function(t){this.bossInFoBox.visible=t,this.bossHead.visible=t,this.buttonBox.visible=t},t.prototype.onLinkHandler=function(){var t=new h.ChatGS2C;t.type=c.enumChatType.family;var e="@7@#"+u.HotBloodWarManager.getInstance().getPortId();t.msg=e,s.E.ins.event(o.EventName.SEND_CHAT,[e,c.enumChatType.family])},t}(ui.hotblood.HotBloodWarUI);e.HotBloodWar=d}),define("src/g/hotblood/ctrl/HotBloodWarCtrl",["require","exports","src/g/hotblood/view/HotBloodWar","../../../core/E","../../../enum/EventName","../../../utils/ItemUtils","src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager","src/g/hotblood/view/HotBloodTotalInfoView","src/g/hotblood/ctrl/HotBloodWarResultCtrl","../../../enum/SettingEnum","src/g/setting/vo/SettingInfo","src/g/setting/ctrl/SettingCtrl","src/g/hotblood/ctrl/HotBloodWarDeathCtrl","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg","src/g/fight/osprite/play/kfhotblood/KfHotBloodManager","src/init/TextConst"],function(t,e,n,s,o,a,i,r,l,h,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(){function t(){this.totalInfoView=null,this._bossHp=0,new l.HotBloodWarResultCtrl,this.deathCtrl=new p.HotBloodWarDeathCtrl,s.E.ins.on(o.EventName.HOTBLOODWAR_SCENE_PANEL,this,this.openPanel)}return t.prototype.openPanel=function(){null==(this.manager().viewCtrl=this).totalInfoView&&(this.totalInfoView=new r.HotBloodTotalInfoView,this.totalInfoView.show(),this.totalInfoView.fhzc.on(Laya.Event.CLICK,this,this.fhzcHandler),this.showLastBossScene())},t.prototype.showBattlePanel=function(t){this.currportid=t,this.lastportid=NaN,s.E.ins.on(o.EventName.UPDATE_REVENGE_VIEW_TARGET,this,this.updateFoeListHandler),s.E.ins.on(o.EventName.UPDATE_VIEW_TARGET,this,this.updPlayerListHander),s.E.ins.on(o.EventName.UPDATE_VIEW_FAMILYMEMBER,this,this.updateMyFamilyList),s.E.ins.on(o.EventName.CHANGE_PK_TARGET,this,this.attackTargetChangedHander),s.E.ins.on(o.EventName.OTHER_PLAYER_STATUS_CHANGED,this,this.onOPlayerStatusChanged),null==this.view&&(this.view=new n.HotBloodWar,this.view.showView()),this.updHideBtnStatus(),this.view.attackBoss.on(Laya.Event.CLICK,this,this.attackBossHander),this.view.bossHead.on(Laya.Event.CLICK,this,this.attackBossHander),this.view.hideOPlayerButton.on(Laya.Event.CLICK,this,this.hidePlayer),this.view.visible=!0;var e=a.ItemUtils.getBossVoByPortId(t),i=a.ItemUtils.getMonsterVOById(t);e&&i&&this.view.setBoss(e,i.HP),this.totalInfoView.hide()},t.prototype.hideBattlePanel=function(t){void 0===t&&(t=!0),this.view&&(s.E.ins.off(o.EventName.UPDATE_REVENGE_VIEW_TARGET,this,this.updateFoeListHandler),s.E.ins.off(o.EventName.UPDATE_VIEW_TARGET,this,this.updPlayerListHander),s.E.ins.off(o.EventName.UPDATE_VIEW_FAMILYMEMBER,this,this.updateMyFamilyList),s.E.ins.off(o.EventName.CHANGE_PK_TARGET,this,this.attackTargetChangedHander),s.E.ins.off(o.EventName.OTHER_PLAYER_STATUS_CHANGED,this,this.onOPlayerStatusChanged),this.view.attackBoss.off(Laya.Event.CLICK,this,this.attackBossHander),this.view.bossHead.off(Laya.Event.CLICK,this,this.attackBossHander),this.view.hideOPlayerButton.off(Laya.Event.CLICK,this,this.hidePlayer),this.view.visible=!1),t&&(this.totalInfoView.show(),this.showLastBossScene())},t.prototype.fhzcHandler=function(){var t=this.lastportid;isNaN(t)||i.HotBloodWarManager.getInstance().gotoBossArea(t)},t.prototype.showLastBossScene=function(){var t=!0;isNaN(this.lastportid)&&(t=!1);var e=this.totalInfoView;e&&(e.fhzc.visible=t)},t.prototype.updateFoeListHandler=function(t){this.view&&this.view.updFoeList(t)},t.prototype.updateMyFamilyList=function(t){this.view&&this.view.updMyFamilyList(t)},t.prototype.updPlayerListHander=function(t){this.view&&this.view.updPlayerList(t)},t.prototype.attackTargetChangedHander=function(t){this.view&&this.view.changeAttackTarget(t)},t.prototype.exit=function(){this.manager().viewCtrl=null,this.view&&(this.view.visible&&this.hideBattlePanel(!1),this.view.removeSelf(),this.view.destroy(!0),this.view=null),this.totalInfoView&&(this.totalInfoView.exit(),this.totalInfoView.removeSelf(),this.totalInfoView.destroy(!0),this.totalInfoView.fhzc.off(Laya.Event.CLICK,this,this.fhzcHandler),this.totalInfoView=null),this.currportid=this.lastportid=NaN,this.deathCtrl.relase(),u.SettingCtrl.getInstance().hideOtehrPlayer(!1)},t.prototype.updateBossHp=function(t){this._bossHp=t,this.view&&this.view.updBossHP(t)},t.prototype.updateBossOwner=function(t){this.view&&this.view.setGuiShuZhe(t)},t.prototype.updateBossOwnerHp=function(t,e){this.view&&this.view.updGuiShuZheHP(t,e)},t.prototype.updateBossState=function(t){this.view,this.totalInfoView&&this.totalInfoView.updateListInfo()},t.prototype.visibleBossView=function(t){this.view&&this.view.visibleBossView(t)},t.prototype.attackBossHander=function(){this.manager().findBoss()},t.prototype.manager=function(){return d.PlayManager.type==g.EPlayType.PLAYTYPE_KFRX?v.KFHotBloodManager.ins():i.HotBloodWarManager.getInstance()},t.prototype.getDeathCtrl=function(){return this.deathCtrl},t.prototype.onDeath=function(t,e,i){var n=this.manager().checkIsMainScene();this.lastportid=n?NaN:this.currportid,this.deathCtrl.onDeath(t,e,i,n),this.view&&this.view.visible&&this.view.onDeath()},t.prototype.updJianMianHurt=function(t){this.view&&(this.view.lbHurtJianMian.text=f.TextConst.get(888,t))},t.prototype.onOPlayerStatusChanged=function(){this.updHideBtnStatus()},t.prototype.updHideBtnStatus=function(){1==c.SettingInfo.getSettingValue(h.SettingEnum.hideOtherPlayer)?this.view.hideOPlayerButton.skin="res/fightview/rexue_pingbiguan.png":this.view.hideOPlayerButton.skin="res/fightview/rexue_pingbikai.png"},t.prototype.hidePlayer=function(){c.SettingInfo.getSettingValue(h.SettingEnum.hideOtherPlayer)?u.SettingCtrl.getInstance().hideOtehrPlayer(!1):u.SettingCtrl.getInstance().hideOtehrPlayer(!0)},t}();e.HotBloodWarCtrl=y}),define("src/g/fight/osprite/play/kfzy/GamePlayKFZY",["require","exports","src/g/fight/osprite/play/hotbloodwar/GamePlayHotBloodWar","../../../../../manager/GameSocketManager","src/g/fight/osprite/play/kfzy/KFZYManager","../../../../../utils/ItemUtils","../../../../../config/GameConfig","../../../../../manager/RoleCenter","../../../../net/messages/kuafu/kfzyMsg"],function(t,e,i,n,a,l,h,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(i){function t(t){var e=i.call(this,t)||this;return n.GSM.ins.on(o.KFZYBattleBossHPGS2C.KEY,e,e.onBattleBossHPGS2C),e}return __extends(t,i),t.prototype.manager=function(){return a.KFZYManager.ins()},t.prototype.clear=function(){i.prototype.clear.call(this),n.GSM.ins.off(o.KFZYBattleBossHPGS2C.KEY,this,this.onBattleBossHPGS2C),this.manager().removeShow()},t.prototype.drawRect=function(){var t=0,e=this.manager().centerPort(),i="layer"+this.manager().layer+"PortId2",n=this.manager().getSetting(i).value||"";t=e,this.createAreaMatrixList(t,t,this._showDebugKey);var s=l.ItemUtils.getPortVoById(t),o=h.GameConfig.getMapJSON(s.boss_scene).doorXY;this.drawSafeArea(o[0],o[1],o[2]);for(var a=n.split(","),r=0;r<a.length;r++)t=Number(a[r]),this.createAreaMatrixList(t,t,this._showDebugKey)},t.prototype.removePlayerFG=function(t,e){t&&(t.groupID==s.RoleCenter.instans.vo.username?console.error(s.RoleCenter.instans.vo.username):i.prototype.removePlayerFG.call(this,t,e))},t.prototype.calculateEnterCondition=function(){var t=!1,e=0,i=a.KFZYManager.ins().centerPort();this._sceneOpenStateDic[i]=!0;for(var n="layer"+this.manager().layer+"PortId2",s=(this.manager().getSetting(n).value||"").split(","),o=0;o<s.length;o++)e=Number(s[o]),t=0==this.manager().checkChangeCondition(e),this._sceneOpenStateDic[e]=t},t.prototype.init=function(t){i.prototype.init.call(this,t),this.enterfail&&this.returnbackHangUp()},t.prototype.onMsgEnter=function(t){return i.prototype.onMsgEnter.call(this,t)},t}(i.GamePlayHotBloodWar);e.GamePlayKFZY=r}),define("src/g/fight/osprite/play/kfzy/KFZYManager",["require","exports","../../../../../core/E","../../../../net/messages/ChangeSceneMsg","../../../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../../../manager/RoleCenter","../../../../../meta/ReXieZhanChangSettingVo","../../../../../config/GameConfig","../../../../../manager/GameSocketManager","../../../../net/messages/ActivityMessage","../../../../net/messages/EnterMuSceneC2GS","../../../../../utils/system/FloatEffect","../../../../../plugin/view/ToolTip","src/g/fight/osprite/play/PlayManager","../../../../../utils/ItemUtils","../../../../../utils/system/ServerTime","../../../../net/messages/BloodyBattleMsg","src/g/accessctrl/AccessCenter","../../../../../manager/NewRedHintsCenter","../../../../../manager/LayerManager","../../../../../utils/system/DateUitl","src/init/TextConst","../../../../../manager/AM","../../../../net/messages/kuafu/kfzyMsg"],function(t,e,o,s,a,n,l,r,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function i(){this.gamePlay=null,this._battleOpenStateMsg=null,this._bossVoInitKey=!1,this._bossVoDic={},this._bossInfoDic={},this._enterTime=-1,this._ownerFG=null,this._relifeTime=-1,this._enterPortId=-1,this._openPanelKey=!1,this.viewCtrl=null,this._layer=1,this._layers={},this._centerLayer={},this._lefttime=0,this._countitem=0,this._panelReqKey=!1,this._layers[1]=this.getSetting("layer1PortId2").value.split(","),this._layers[2]=this.getSetting("layer2PortId2").value.split(","),this._layers[3]=this.getSetting("layer3PortId2").value.split(","),this._layers[4]=this.getSetting("layer4PortId2").value.split(","),this._centerLayer=this.getSetting("layerPortId").value.split(",")}return i.prototype.getLayerPorts=function(t){return this._layers[t]},i.ins=function(){return this._ins||(this._ins=new i),this._ins},Object.defineProperty(i.prototype,"layer",{get:function(){return this._layer},set:function(t){this._layer=t},enumerable:!0,configurable:!0}),i.prototype.centerPort=function(){return this._centerLayer[this._layer-1]>>0},i.prototype.getSetting=function(t){var e=h.GameConfig.kfzyseting[t];return e||(e=new r.KFZYsettingVo)},i.prototype.getBossInfoDic=function(){return this._bossInfoDic},i.prototype.checkIsMainScene=function(){var t=this.centerPort();return this.getPortId()==t},i.prototype.getPortId=function(){return this.gamePlay?this.gamePlay.getCurrPortId():-1},i.prototype.exitHotBloodWar=function(){this.gamePlay&&this.gamePlay.sendEnterMuSceneC2GS(!1,this.gamePlay.getCurrPortId(),0,0)},i.prototype.onBossKillStateGS2C=function(t){if(this._panelReqKey)this._panelReqKey=!1;else{if(this.setDecHurt(t.bossOwnerDecHurt),this.gamePlay){var e=this.gamePlay.getPlayerFG(t.owneruname);this.setBossOwner(e)}this._bossInfoDic[t.portid]&&this.bossStateChange(this._bossInfoDic[t.portid])}},i.prototype.setDecHurt=function(t){this.viewCtrl&&this.viewCtrl.updJianMianHurt(t)},i.prototype.getPortStatus=function(t){return this._bossInfoDic[t]},i.prototype.updateBossOwnerHp=function(t,e){this.viewCtrl&&this.viewCtrl.updateBossOwnerHp(t,e)},i.prototype.findBoss=function(){this.gamePlay&&this.gamePlay.startKillMonster()},i.prototype.gotoBossArea=function(t){if(this.gamePlay&&this._bossInfoDic[t]){var e=this.checkChangeCondition(t);0==e?this.gamePlay.gotoBoss(t):this.outConditionErrInfo(e,t)}},i.prototype.enterGamePlay=function(t){o.E.ins.event(a.EventName.KFZYHOTBLOODWAR_SCENE_PANEL);var e=c.GSM.ins;e.on(u.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),e.on(E.KFZYBattleBossEndGS2C.KEY,this,this.onKFRXBattleBossEndGS2C),e.on(u.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChangeGS2C),this.setBossOwner(null),this.gamePlay=t;var i=this.centerPort(),n=this.gamePlay.getStartPoint();e.on(p.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C),this.gamePlay.sendEnterMuSceneC2GS(!0,i,n[0],n[1]),I.LayerManager.addInUILayer(this.view);var s=l.RoleCenter.instans.vo.bagdata.getItemCount(8527);this._countitem=s-2>>0,this._lefttime=30*s,Laya.timer.loop(1e3,this,this.updateShow),this._view.lefttime.text=""},Object.defineProperty(i.prototype,"view",{get:function(){return this._view||(this._view=new ui.index.KFZYShowUI),this._view},enumerable:!0,configurable:!0}),i.prototype.updateShow=function(){this._view.lefttime.text=b.DateUtil.timeCountDown1(this._lefttime),this._lefttime-=1,this._lefttime<=0&&(Laya.timer.clear(this,this.updateShow),this._view.lefttime.text="00:00:00")},i.prototype.removeShow=function(){this.view.removeSelf(),Laya.timer.clear(this,this.updateShow)},i.prototype.getLayerPortId=function(t){var e=this.getSetting("layerPortId").value.split(",");return parseInt(e[t])},i.prototype.exitGamePlay=function(){this.viewCtrl&&(this.viewCtrl.exit(),this.viewCtrl=null),this._enterPortId=-1,this.setBossOwner(null),this._enterTime=y.ServerTime.serverTime+this.getSetting("outTimeCD").value;var t=c.GSM.ins;t.off(u.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),t.off(E.KFZYBattleBossEndGS2C.KEY,this,this.onKFRXBattleBossEndGS2C),t.off(u.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChangeGS2C),this.gamePlay=null,t.off(p.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C)},i.prototype.setMonsterHp=function(t){this.viewCtrl&&this.viewCtrl.updateBossHp(t)},i.prototype.showDeadAlert=function(t){this.viewCtrl.onDeath(t,new Laya.Handler(this,this.onMoneyLife),new Laya.Handler(this,this.onReLife))},i.prototype.onReLife=function(){this.sendRebord(!0)},i.prototype.onMoneyLife=function(){var t=this.getSetting("payForLife").value;l.RoleCenter.instans.self.GOLD<t?d.FE.upItems(w.TextConst.get(460),g.BubbleEnum.center):this.sendRebord(!1)},i.prototype.sendRebord=function(t){if(this.gamePlay){var e=null,i=new u.ActivityRebirthC2GS;i.acttype=u.EACT_TYPE.kfzy,e=(i.freeRebirth=t)?this.gamePlay.getStartPoint():this.gamePlay.getSelfPos(),i.posx=e[0],i.posy=e[1],c.GSM.sendServer(i)}else console.error("不在玩法中")},i.prototype.reqBossKillState=function(t,e){void 0===e&&(e=0);var i=new E.KFZYBossKillStateC2GS;i.portid=t,c.GSM.sendServer(i),1==e&&(this._panelReqKey=!0)},i.prototype.onBloodyBattleActOpenState=function(t){this._battleOpenStateMsg=t},i.prototype.bossStateChange=function(t){var e=t.portid;this.viewCtrl&&this.viewCtrl.updateBossState(e),this.gamePlay&&this.gamePlay.updateBossState(e),this.checkIsShowBossView(e),o.E.ins.event(a.EventName.HOTBLOOD_DATA_UPDATE)},i.prototype.onBattleBossStateGS2C=function(t){var e=this._bossInfoDic[t.portid];e&&e.bossState==E.KFZYEBattleBossState.CAN_CHALLENGE&&t.bossState==E.KFZYEBattleBossState.WAIT_REVIVE&&o.E.ins.event(a.EventName.HB_BOSSDEATH,t),this._bossInfoDic[t.portid]=t,this.bossStateChange(t)},i.prototype.onBattleBossStateAll=function(t){for(var e=null,i=0;i<t.bossStateArr.length;i++)e=t.bossStateArr[i],this._bossInfoDic[e.portid]=e;this._openPanelKey&&(this._openPanelKey=!1,this.openBossInfoPanel()),o.E.ins.event(a.EventName.HOTBLOOD_DATA_UPDATE)},i.prototype.openBossInfoPanel=function(){o.E.ins.event(a.EventName.KFHOTBLOOD_DATA_INITED)},i.prototype.checkIsShowBossView=function(t){if(this.viewCtrl&&(this.gamePlay&&this.gamePlay.getCurrPortId()==t))if(this._bossInfoDic[t])switch(this._bossInfoDic[t].bossState){case m.EBattleBossState.CAN_CHALLENGE:this.viewCtrl.visibleBossView(!0);break;case m.EBattleBossState.WAIT_REVIVE:this.viewCtrl.visibleBossView(!1)}else this.viewCtrl.visibleBossView(!1)},i.prototype.onBattleBossReviveGS2C=function(t){var e=this._bossInfoDic[t.portid];e&&(e.bossState=E.KFZYEBattleBossState.CAN_CHALLENGE,this.bossStateChange(e),this.reqOpenBossInfoPanel(t.portid)),this.gamePlay&&this.gamePlay.onBattleBossReviveGS2C(t)},i.prototype.reqOpenBossInfoPanel=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!0);var i=new E.KFZYBattleBossStateC2GS;i.portid=t,i.requestAll=0==t,c.GSM.sendServer(i),this._openPanelKey=e},i.prototype.onEnterMuSceneGS2C=function(t){if(t.opresult){var e=this.centerPort();t.portid==e?this.viewCtrl&&this.viewCtrl.hideBattlePanel():(this.viewCtrl&&this.viewCtrl.showBattlePanel(t.portid),this.setBossOwner(null),this.reqBossKillState(t.portid),this.reqOpenBossInfoPanel(t.portid)),t.enter?(t.enterType==p.EEnterMuSceneType.REVIVE&&this.viewCtrl.getDeathCtrl().relase(),this.gamePlay.setMainRoleByMsg(t)):o.E.ins.event(a.EventName.PLAY_TYPE_CHANGE,n.PlayTypeVo.create(s.EPlayType.PLAYTYPE_PORT))}else this.gamePlay?this.gamePlay.returnbackHangUp():Laya.timer.once(1e3,this,function(){o.E.ins.event(a.EventName.PLAY_TYPE_CHANGE,n.PlayTypeVo.create(s.EPlayType.PLAYTYPE_PORT)),d.FE.upItems(w.TextConst.showErrorInfo(t.error),g.BubbleEnum.center)})},i.prototype.outConditionErrInfo=function(t,e){var i=this.getBossVoByPortId(e),n=null;switch(t){case 0:break;case 1:n=w.TextConst.get(458,f.ItemUtils.getEquipLv(i.limit1));break;case 2:n=w.TextConst.get(459,i.limit2);break;case 3:n=w.TextConst.get(469)}n&&d.FE.upItems(n,g.BubbleEnum.center)},i.prototype.enterHotBloodWar=function(t,e){if(void 0===e&&(e=s.EPlayType.PLAYTYPE_KFZY),!l.RoleCenter.instans.bagRoomEnough())return S.AM.showBagNotEnough(),!1;if(v.PlayManager.isSpecialPlay()&&v.PlayManager.type!=e)return d.FE.upItems(w.TextConst.get(406),g.BubbleEnum.center),!1;var i=this.checkChangeCondition(t);if(0!=i)return this.outConditionErrInfo(i,t),!1;if(null!=this.gamePlay)return!1;if(!this._battleOpenStateMsg)return!1;if(!this._battleOpenStateMsg.actOpen)return d.FE.upItems(w.TextConst.get(455),g.BubbleEnum.center),!1;var n=this._enterTime-y.ServerTime.serverTime;return 0<n?(d.FE.upItems(w.TextConst.get(984,n),g.BubbleEnum.center),!1):(this._enterPortId=t,this.sendEvt(e),!0)},i.prototype.onBossOwnerChangeGS2C=function(t){if(""==t.newowner)this.setBossOwner(null);else{var e=this.gamePlay.getPlayerFG(t.newowner);this.setBossOwner(e)}},i.prototype.setBossOwner=function(t){this._ownerFG!=t&&(this._ownerFG=t,this.updateBossOwner(t)),this.gamePlay&&this.gamePlay.setBossOwner(t)},i.prototype.updateBossOwner=function(t){this.viewCtrl&&this.viewCtrl.updateBossOwner(t)},i.prototype.getPlayerFG=function(t){return this.gamePlay?this.gamePlay.getPlayerFG(t):null},i.prototype.checkKFRXWarRedPoint=function(){this.checkIsEnter()?C.NewRedHintsCenter.ins.setRedHintOpenOrClose(C.enumRedHints.kfrxred,!0):C.NewRedHintsCenter.ins.setRedHintOpenOrClose(C.enumRedHints.kfrxred,!1)},i.prototype.onKFRXBattleBossEndGS2C=function(t){var e=this.gamePlay;null!=t.bossowner&&""!=t.bossowner?(t.bossowner==l.RoleCenter.instans.self.username&&(t.invent&&(l.RoleCenter.instans.addInventoryToC(t.invent),d.FE.addInventoryToCFloats(t.invent)),this.checkKFRXWarRedPoint()),t.helpData&&t.helpData.isHelp&&t.helpData.invent&&(l.RoleCenter.instans.addInventoryToC(t.helpData.invent),d.FE.addInventoryToCFloats(t.helpData.invent))):console.warn("热血战场结算没有归属者"),o.E.ins.event(a.EventName.OPEN_HOTBLOOD_RESULT,t),e&&e.getCurrPortId()==t.portid&&this.setBossOwner(null)},i.prototype.onActivityRebirthGS2C=function(t){this.gamePlay&&this.gamePlay.onActivityRebirthGS2C(t),t.opresult?t.userAcc==l.RoleCenter.instans.self.username&&(l.RoleCenter.instans.vo.GOLD-=t.decGold,this.viewCtrl.showLastBossScene()):console.error(t.error)},i.prototype.checkChangeCondition=function(t){return i.ins().centerPort(),0},i.prototype.sendEvt=function(t){o.E.ins.event(a.EventName.PLAY_TYPE_CHANGE,n.PlayTypeVo.create(t))},i.prototype.getBossVoByPortId=function(t){if(0==this._bossVoInitKey){this._bossVoInitKey=!0;var e=null,i=h.GameConfig.kfzyjson;for(var n in i)e=i[n],this._bossVoDic[e.port]=e}return this._bossVoDic[t]},i.prototype.checkIsHaveBossTask=function(){var t=null,e=h.GameConfig.kfrxvo;for(var i in e)if(t=e[i],0==this.checkChangeCondition(t.port))return!0;return!1},i.prototype.checkIsEnter=function(){var t=_.AccessCenter.ins.checkOpen(303),e=i.ins().checkIsHaveBossTask();return!(!t||!e)},i.prototype.getFirstChallgeBoss=function(){if(!this.checkIsEnter())return null;var t=l.RoleCenter.instans.vo,e=t.getAllShengZhanPF(),i=t.getAllShengMoPF(),n=t.getAllShengDaoPF(),s=this._bossInfoDic,o=null,a=null;for(var r in s)if(o=s[r])switch(o.bossState){case m.EBattleBossState.WAIT_REVIVE:break;case m.EBattleBossState.CAN_CHALLENGE:if(0==this.checkChangeCondition(o.portid)&&(!(a=this.getBossVoByPortId(o.portid)).limit2.length||e>=a.limit2[0][1]&&i>=a.limit2[1][1]&&n>=a.limit2[2][1]))return a;break;case m.EBattleBossState.NULL:}return null},i._ins=null,i}();e.KFZYManager=i}),define("src/g/hotblood/ctrl/HotBloodWarDeathCtrl",["require","exports","../../../utils/CountDown","src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager","../../../utils/system/ServerTime","../../../manager/LayerManager","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg","src/init/TextConst","src/g/fight/osprite/play/kfhotblood/KfHotBloodManager","src/g/fight/osprite/play/kftplay/KFTManager","../../../utils/system/FloatEffect","src/g/fight/osprite/play/kfzy/KFZYManager"],function(t,e,i,a,r,l,h,c,u,p,d,n,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this.fuhuoCD=new i.CountDown,this._endtime=0}return t.prototype.onDeath=function(t,e,i,n){if(void 0===n&&(n=!1),this.freeFuHuoCallBack=i,this.moneyFuHuoCallBack=e,this._endtime=0,null==this.view){this.view=new ui.hotblood.HotBloodWarDeathUI,this.view.lbDeathDes.style.font="SimHei",this.view.lbDeathDes.style.align="center",this.view.lbDeathDes.style.color="#e3cca9",this.view.lbDeathDes.style.stroke=1,this.view.lbDeathDes.style.strokeColor="#0d0500",this.view.lbDeathDes.style.fontSize=24,this.view.centerX=0,this.view.bottom=440,l.LayerManager.addInHighUILayer(this.view);var s=0,o=t.getUnitByIndex(0);switch(this.view.lbDeathDes.innerHTML=u.TextConst.get(290,o?o.actorName:""),h.PlayManager.type){case c.EPlayType.PLAYTYPE_KFRX:this.view.freeFuhuoButton.centerX=0,this.view.moneyFuHuoButton.visible=!1,this.view.fuhuoMoney.text=p.KFHotBloodManager.ins().getSetting("payForLife").value,s=r.ServerTime.serverTime+p.KFHotBloodManager.ins().getSetting("rebornTime").value;break;case c.EPlayType.PLAYTYPE_KFSD:this.view.moneyFuHuoButton.visible=!1,this.view.freeFuhuoButton.centerX=0,s=r.ServerTime.serverTime+12,this._endtime=s;break;case c.EPlayType.PLAYTYPE_KFTB:this.view.moneyFuHuoButton.visible=!1,this.view.freeFuhuoButton.centerX=0,this.view.fuhuoMoney.text=d.KFTManager.ins().getSetting("payForLife").value,s=r.ServerTime.serverTime+d.KFTManager.ins().getSetting("rebornTime").value,d.KFTManager.ins().isBigMap()?this._endtime=0:this._endtime=s;break;case c.EPlayType.PLAYTYPE_KFZY:this.view.moneyFuHuoButton.visible=!1,this.view.freeFuhuoButton.centerX=0,this.view.fuhuoMoney.text=g.KFZYManager.ins().getSetting("payForLife").value,s=r.ServerTime.serverTime+g.KFZYManager.ins().getSetting("rebornTime").value,this._endtime=s;break;default:this.view.fuhuoMoney.text=a.HotBloodWarManager.getInstance().getSetting("payForLife").value,s=r.ServerTime.serverTime+a.HotBloodWarManager.getInstance().getSetting("rebornTime").value}this.view.freeFuhuoButton.on(Laya.Event.CLICK,this,this.freeFuHuoHander),this.view.moneyFuHuoButton.on(Laya.Event.CLICK,this,this.moneyFuHuoHander),this.fuhuoCD.start(s,this.updFuHuoCountDown,this),n&&(this.view.moneyFuHuoButton.visible=!1,this.view.freeFuhuoButton.centerX=0)}},t.prototype.freeFuHuoHander=function(){this._endtime<=r.ServerTime.serverTime?this.freeFuHuoCallBack.run():n.FE.upItems("时间未到，请稍后")},t.prototype.moneyFuHuoHander=function(){this.moneyFuHuoCallBack.run()},t.prototype.relase=function(){this.view&&(this.fuhuoCD.stop(),this.view.freeFuhuoButton.off(Laya.Event.CLICK,this,this.freeFuHuoHander),this.view.moneyFuHuoButton.off(Laya.Event.CLICK,this,this.moneyFuHuoHander),this.freeFuHuoCallBack=null,this.moneyFuHuoCallBack=null,this.view.removeSelf(),this.view.destroy(),this.view=null)},t.prototype.updFuHuoCountDown=function(t){this.view.lbFuHuoCD.text=u.TextConst.get(887,t),0==t&&this.freeFuHuoHander()},t}();e.HotBloodWarDeathCtrl=s}),define("src/g/kftb/view/KFTBHotBloodTotalInfoView",["require","exports","src/g/fight/osprite/GameScene","../../../config/GameConfig","../../../manager/LayerManager","../../../utils/ItemUtils","src/g/fight/osprite/play/kftplay/KFTManager"],function(t,e,o,a,r,l,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t._smallMap=null,t._bossSprite=new Laya.Sprite,t._monsterList=[],t._posX=[],t._posY=[],t.__scaleX=1,t.__scaleY=1,t.width=Laya.stage.width,t.mouseThrough=!0;for(var e=0;e<10;e++)t["num"+e].portindex=e,t["num"+e].on(Laya.Event.CLICK,t,t.clickHandler,[e]);for(var i=0;i<10;i++)t._monsterList[i]=new Laya.Image("res/hotblood/rxzc_hongdian01.png"),t._bossSprite.addChild(t._monsterList[i]);return t}return __extends(t,n),t.prototype.clickHandler=function(t,e){this.manager().gamePlay.gotoPass(t),this.btn_mask.visible=!0,e&&(this.btn_mask.x=e.currentTarget.x,this.btn_mask.y=e.currentTarget.y,this.btn_mask.visible=!0)},t.prototype.rendHandler=function(t,e){},t.prototype.manager=function(){return i.KFTManager.ins()},t.prototype.show=function(){if(null==this._smallMap){var t=this.manager().kfTBWorldMapVo().portid,e=l.ItemUtils.getPortVoById(t),i=a.GameConfig.getMapJSON(e.boss_scene),n="dynamic/map/{0}/small_2.jpg".replace("{0}",i.mapID);this._smallMap=new Laya.Image(n),this._tUrl=n,this.mapBox.addChild(this._smallMap),this.mapBox.addChild(this._point),this.mapBox.addChild(this._bossSprite),this._smallMap.centerX=0;this._smallMap.centerY=0;r.LayerManager.addInUILayer(this),Laya.loader.load(n,new Laya.Handler(this,this.onloadHandler))}if(this.visible=!0,Laya.timer.frameLoop(1,this,this.update),this.btn_show.on(Laya.Event.CLICK,this,this.showHandler),this.btn_hide.on(Laya.Event.CLICK,this,this.hideHandler),this.manager().gamePlay)for(var s=this.manager().gamePlay.enterObj(),o=0;o<s.length;o++){s[o]&&this["num"+o]&&(this["num"+o].gray=!0)}},t.prototype.hideHandler=function(){for(var t=0;t<10;t++){var e=this["num"+t];Laya.Tween.to(e,{y:390,x:0,alpha:0},200)}this.btn_hide.visible=!1,this.btn_show.visible=!0,this.btn_mask.visible=!1},t.prototype.showHandler=function(){this.btn_hide.visible=!0,this.btn_show.visible=!1;for(var t=0;t<5;t++){(i=this["num"+t]).visible=!0,i.alpha=1,i.y=384,Laya.Tween.to(i,{y:306-77*t},200)}var e=0;for(t=5;t<10;t++){var i;(i=this["num"+t]).alpha=1,i.visible=!0,i.x=0,Laya.Tween.to(i,{x:83+77*e},200),e++}},t.prototype.showList=function(t,e,i,n){this._posX[t]=i,this._posY[t]=n},t.prototype.onloadHandler=function(){var t=Laya.loader.getRes(this._tUrl);t&&this._smallMap&&(this.__scaleX=t.width/this._smallMap.width,this.__scaleY=t.height/this._smallMap.height)},t.prototype.hide=function(){Laya.timer.clear(this,this.update),this.visible=!1,this.btn_mask.visible=!1},t.prototype.exit=function(){Laya.timer.clear(this,this.update),this._point&&this._point.removeSelf(),this._smallMap&&(this._smallMap.removeSelf(),this._smallMap=null)},t.prototype.update=function(){var t=this.manager();if(t.gamePlay&&this._smallMap){var e=t.gamePlay.getSelfPos(),i=e[0]/o.GameScene.ins.map.width*this._smallMap.width*this.__scaleX,n=e[1]/o.GameScene.ins.map.height*this._smallMap.height*this.__scaleY;this._point.x=i,this._point.y=n;for(var s=0;s<this._monsterList.length;s++)this._posX[s]&&(i=this._posX[s]/o.GameScene.ins.map.width*this._smallMap.width,n=this._posY[s]/o.GameScene.ins.map.height*this._smallMap.height,this._monsterList[s].x=i-9,this._monsterList[s].y=n-9)}},t}(ui.hotblood.KFTBBloolSceneViewUI);e.KFTBHotBloodTotalInfoView=n}),define("src/g/kftb/view/KFTBHotBloodWar",["require","exports","src/g/crossserboss/PointWarPlayer","../../../manager/LayerManager","../../../core/E","../../../enum/EventName","src/g/boss/view/SCFoeHead","../../../utils/ItemUtils","../../../manager/RoleCenter","../../net/messages/chat/ChatGS2C","../../net/messages/chat/ChatC2GS","src/init/TextConst","src/g/fight/osprite/play/kftplay/KFTManager","../../net/messages/kuafu/KftbBattleMsg"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(e){function t(){var t=e.call(this)||this;return t.bossMaxHP=380,t._currentHp=200,t.mouseThrough=!0,t.width=Laya.stage.width,t.height=Laya.stage.height,t.foeIndexDict=new Laya.Dictionary,t.familyIndexDict=new Laya.Dictionary,t.playerIndexDict=new Laya.Dictionary,t.bossHead=new i.PointWarPlayer,t.bossHead.setType(0),t.bossHead.right=0,t.bossHead.y=137,t.addChild(t.bossHead),t.guiShuZhe=new i.PointWarPlayer,t.guiShuZhe.setType(1),t.guiShuZhe.y=34,t.guiShuZheBox.addChildAt(t.guiShuZhe,0),t.setGuiShuZhe(null),t.imgAttack.visible=t.myFMember.visible=t.foeFMember.visible=!1,t.initList(t.foeList,t.foeRender,i.PointWarPlayer),t.initList(t.myFamilyList,t.familyPlayerRender,i.PointWarPlayer),t.initList(t.playerList,t.playerRender,i.PointWarPlayer),t.familyFriendLink.on(Laya.Event.CLICK,t,t.onLinkHandler),t.guiShuZheBox.on(Laya.Event.CLICK,t,t.attackGuiShuzheHander),t.hideOPlayerButton.visible=!1,t.btn_see.on(Laya.Event.CLICK,t,t.seeHandler),t.familyFriendLink.visible=!1,t}return __extends(t,e),t.prototype.seeHandler=function(){p.KFTManager.ins().findBoss(!1)},t.prototype.attackGuiShuzheHander=function(){this.guiShuZhe.getDataAsFightGroup()&&s.E.ins.event(o.EventName.SELECT_PK_TARGET,this.guiShuZhe.getDataAsFightGroup().groupID)},t.prototype.initList=function(t,e,i){t.selectEnable=!0,t.vScrollBarSkin="",t.itemRender=i,t.scrollBar.elasticDistance=100,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.caculateListH=function(t,e){if(null==t.array||0==t.array.length)t.height=0;else{var i=Math.min(e,t.array.length),n=90*i+(i-1)*t.spaceY;t.height=n}},t.prototype.foeRender=function(t,e){t.update2("left"),t.showAttackerEf(),t.on(Laya.Event.CLICK,this,this.attFoeHander)},t.prototype.familyPlayerRender=function(t,e){t.update2("left"),t.on(Laya.Event.CLICK,this,this.attackFamilyList)},t.prototype.playerRender=function(t,e){t.update2("right"),t.on(Laya.Event.CLICK,this,this.attplayerHander)},t.prototype.showView=function(){n.LayerManager.addInUILayer(this)},t.prototype.updFoeList=function(t){var e=this.deleteEmptyData(t,this.foeIndexDict);this.foeList.array=e,this.caculateListH(this.foeList,3),this.imgAttack.visible=e&&0!=e.length},t.prototype.updMyFamilyList=function(t){var e=this.deleteEmptyData(t,this.familyIndexDict);this.myFamilyList.array=e,this.caculateListH(this.myFamilyList,2),this.myFMember.visible=e&&0!=e.length,this.myFMemberNum.text=u.TextConst.get(360,e.length)},t.prototype.updPlayerList=function(t){var e=this.deleteEmptyData(t,this.playerIndexDict,!0);this.playerList.array=e,this.caculateListH(this.playerList,4),this.foeFMember.visible=e&&0!=e.length,this.foeFMemberNum.text=u.TextConst.get(361,e.length)},t.prototype.deleteEmptyData=function(t,e,i){void 0===i&&(i=!1),e.clear();var n=[];if(t)for(var s=t.length,o=void 0,a=0;a<s;a++)null!=(o=t[a])&&(i&&(0!=o.isInSafeArea||o.isDeath())||(n.push(o),e.set(o,a)));return n},t.prototype.attplayerHander=function(t){var e=t.currentTarget,i=this.playerIndexDict.get(e.dataSource);s.E.ins.event(o.EventName.SELECT_TARGET_INDEX,i)},t.prototype.attFoeHander=function(t){var e=t.currentTarget,i=this.foeIndexDict.get(e.dataSource);s.E.ins.event(o.EventName.SELECT_REVENGE_TARGET_INDEX,i)},t.prototype.attackFamilyList=function(t){var e=t.currentTarget,i=this.familyIndexDict.get(e.dataSource);s.E.ins.event(o.EventName.SELECT_FAMILYMEMBER_INDEX,i)},t.prototype.changeAttackTarget=function(t){this.clearAttackSign(),null!=t&&(""==t?this.bossHead.updStatus(a.SCFoeHead.BE_ATTACK):(null!=this.guiShuZhe.getDataAsFightGroup()&&this.guiShuZhe.getDataAsFightGroup().groupID==t&&this.guiShuZhe.updStatus(a.SCFoeHead.BE_ATTACK),this.showAttackSignInList(this.foeList,t),this.showAttackSignInList(this.playerList,t),this.showAttackSignInList(this.myFamilyList,t)))},t.prototype.clearAttackSign=function(){this.bossHead.reset(),this.guiShuZhe.reset(),this.clearListAttackSign(this.foeList),this.clearListAttackSign(this.playerList),this.clearListAttackSign(this.myFamilyList)},t.prototype.clearListAttackSign=function(t){for(var e=0;e<t.cells.length;e++)t.cells[e].reset()},t.prototype.showAttackSignInList=function(t,e){for(var i,n=0;n<t.cells.length;n++)(i=t.cells[n]).getName()==e&&i.updStatus(a.SCFoeHead.BE_ATTACK)},t.prototype.onDeath=function(){this.clearAttackSign()},t.prototype.setBoss=function(t,e,i){this.bossMaxHP=e,this.imgBossHead.skin=r.ItemUtils.getBossIccon(i.id),this.lbBossName.text=t?t.name:i.name,this.bossHead.updateBoss(t,i),this.imgBossHead.skin=r.ItemUtils.getBossIccon(i.id),this.initupdateBossHP()},t.prototype.updBossHP=function(t){this._currentHp=t;var e=Math.min(380*t/this.bossMaxHP>>0,380);this.progressBar.width=e;var i=(t/this.bossMaxHP*100).toFixed(2);100<Number(i)&&(i="100"),this.progress_txt.text=(t/this.bossMaxHP*100).toFixed(2)+"%"},t.prototype.initupdateBossHP=function(){this._currentHp||(this._currentHp=200),this.updBossHP(this._currentHp)},t.prototype.setGuiShuZhe=function(t){t?(this.guiShuZheBox.visible=!0,this.guiShuZhe.updWinner2(t),l.RoleCenter.instans.self.username==t.groupID||l.RoleCenter.instans.self.ufData.familyUId==t.getFamilyUid()&&""!=l.RoleCenter.instans.self.ufData.familyUId?this.imgFamily.skin="res/fightview/rxzc_wohuitubiao.png":this.imgFamily.skin="res/fightview/rxzc_dihuitubiao.png",l.RoleCenter.instans.self.username==t.groupID?(this.imgowner.visible=!0,this.attackBoss.visible=!1):(this.imgowner.visible=!1,this.attackBoss.visible=!0)):(this.guiShuZheBox.visible=!1,this.imgowner.visible=!1,this.attackBoss.visible=!0)},t.prototype.updGuiShuZheHP=function(t,e){this.guiShuZhe.updBlood(t,e)},t.prototype.visibleBossView=function(t){var e=p.KFTManager.ins();if(t){var i=e.getCurBoss();if(i)switch(i.bossState){case d.KFTBEBattleBossState.CAN_CHALLENGE:var n=r.ItemUtils.getMonsterVOById(i.monid);n&&(this.bossMaxHP=n.HP,this.setBoss(null,n.HP,n),this.bossInFoBox.visible=t,this.bossHead.visible=t,this.buttonBox.visible=t);break;default:this.bossInFoBox.visible=!1}}else this.bossInFoBox.visible=t,this.bossHead.visible=t,this.buttonBox.visible=t},t.prototype.onLinkHandler=function(){var t=new h.ChatGS2C;t.type=c.enumChatType.family;var e="@10@#"+p.KFTManager.ins().getPortId();t.msg=e,s.E.ins.event(o.EventName.SEND_CHAT,[e,c.enumChatType.family])},t}(ui.hotblood.HotBloodWarUI);e.KFTBHotBloodWar=g}),define("src/g/kftb/ctrl/KFTBHotBloodWarCtrl",["require","exports","../../../core/E","../../../enum/EventName","../../../utils/ItemUtils","../../../enum/SettingEnum","src/g/setting/vo/SettingInfo","src/g/setting/ctrl/SettingCtrl","src/g/hotblood/ctrl/HotBloodWarDeathCtrl","src/g/hotblood/ctrl/HotBloodWarResultCtrl","src/init/TextConst","src/g/kftb/view/KFTBHotBloodTotalInfoView","src/g/kftb/view/KFTBHotBloodWar","src/g/fight/osprite/play/kftplay/KFTManager","../../net/messages/kuafu/KftbBattleMsg","../../../config/GameConfig","src/g/peronboss/view/ItemIconView","../../../utils/system/DateUitl","src/g/clearRes/ClearResM"],function(t,e,i,n,o,s,a,r,l,h,c,u,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(){function t(){this.totalInfoView=null,this._bossHp=0,new h.HotBloodWarResultCtrl,this.deathCtrl=new l.HotBloodWarDeathCtrl,i.E.ins.on(n.EventName.KFTBHOTBLOODWAR_SCENE_PANEL,this,this.openPanel)}return t.prototype.openPanel=function(){null==(this.manager().viewCtrl=this).totalInfoView&&(this.totalInfoView=new u.KFTBHotBloodTotalInfoView,this.totalInfoView.show(),this.showLastBossScene()),m.ClearResM.resetViewImg(this.totalInfoView)},t.prototype.updateBoss=function(){},t.prototype.showPassList=function(t,e,i,n){this.totalInfoView&&this.totalInfoView.showList(t,e,i,n)},t.prototype.showBattlePanel=function(t){this.currportid=t,this.lastportid=NaN,i.E.ins.on(n.EventName.UPDATE_REVENGE_VIEW_TARGET,this,this.updateFoeListHandler),i.E.ins.on(n.EventName.UPDATE_VIEW_TARGET,this,this.updPlayerListHander),i.E.ins.on(n.EventName.UPDATE_VIEW_FAMILYMEMBER,this,this.updateMyFamilyList),i.E.ins.on(n.EventName.CHANGE_PK_TARGET,this,this.attackTargetChangedHander),i.E.ins.on(n.EventName.OTHER_PLAYER_STATUS_CHANGED,this,this.onOPlayerStatusChanged),m.ClearResM.clearResFolder("kft"),null==this.view&&(this.view=new p.KFTBHotBloodWar,this.view.showView()),m.ClearResM.resetViewImg(this.view),this.updHideBtnStatus(),this.view.attackBoss.on(Laya.Event.CLICK,this,this.attackBossHander),this.view.bossHead.on(Laya.Event.CLICK,this,this.attackBossHander),this.view.hideOPlayerButton.on(Laya.Event.CLICK,this,this.hidePlayer),this.view.visible=!0,this.totalInfoView.hide()},t.prototype.hideBattlePanel=function(t){void 0===t&&(t=!0),this.view&&(i.E.ins.off(n.EventName.UPDATE_REVENGE_VIEW_TARGET,this,this.updateFoeListHandler),i.E.ins.off(n.EventName.UPDATE_VIEW_TARGET,this,this.updPlayerListHander),i.E.ins.off(n.EventName.UPDATE_VIEW_FAMILYMEMBER,this,this.updateMyFamilyList),i.E.ins.off(n.EventName.CHANGE_PK_TARGET,this,this.attackTargetChangedHander),i.E.ins.off(n.EventName.OTHER_PLAYER_STATUS_CHANGED,this,this.onOPlayerStatusChanged),this.view.attackBoss.off(Laya.Event.CLICK,this,this.attackBossHander),this.view.bossHead.off(Laya.Event.CLICK,this,this.attackBossHander),this.view.hideOPlayerButton.off(Laya.Event.CLICK,this,this.hidePlayer),this.view.visible=!1),t&&(this.totalInfoView.show(),m.ClearResM.resetViewImg(this.totalInfoView),this.showLastBossScene())},t.prototype.showLastBossScene=function(){isNaN(this.lastportid);this.totalInfoView},t.prototype.updateFoeListHandler=function(t){this.view&&this.view.updFoeList(t)},t.prototype.updateMyFamilyList=function(t){this.view&&this.view.updMyFamilyList(t)},t.prototype.updPlayerListHander=function(t){this.view&&this.view.updPlayerList(t)},t.prototype.attackTargetChangedHander=function(t){this.view&&this.view.changeAttackTarget(t)},t.prototype.exit=function(){this.manager().viewCtrl=null,this.view&&(this.view.visible&&this.hideBattlePanel(!1),this.view.removeSelf(),this.view.destroy(!0),this.view=null),this.totalInfoView&&(this.totalInfoView.exit(),this.totalInfoView.removeSelf(),this.totalInfoView.destroy(!0),this.totalInfoView=null),this.currportid=this.lastportid=NaN,this.deathCtrl.relase(),r.SettingCtrl.getInstance().hideOtehrPlayer(!1),m.ClearResM.clearResFolder("kft")},t.prototype.updateBossHp=function(t){this._bossHp=t,this.view&&this.view.updBossHP(t)},t.prototype.updateBossOwner=function(t){this.view&&this.view.setGuiShuZhe(t)},t.prototype.updateBossOwnerHp=function(t,e){this.view&&this.view.updGuiShuZheHP(t,e)},t.prototype.updateBossState=function(t){},t.prototype.visibleBossView=function(t,e){var i=this.view;if(i){switch(i.buttonBox.visible=!0,i.visibleBossView(t),i.bossHead.visible=!1,e){case g.KFTBEBattleBossState.SLEEP:i.bossInFoBox.visible=!1,i.btn_see.visible=!0,i.attackBoss.visible=!1;break;case g.KFTBEBattleBossState.CAN_CHALLENGE:i.bossInFoBox.visible=!0,i.btn_see.visible=!1,i.bossHead.visible=!0,i.attackBoss.visible=!0,i.visibleBossView(!0);break;case g.KFTBEBattleBossState.WAIT_REVIVE:case g.KFTBEBattleBossState.NULL:i.bossInFoBox.visible=!1,i.btn_see.visible=!1,i.buttonBox.visible=!1,i.bossHead.visible=!1,i.attackBoss.visible=!1,i.visibleBossView(!1);case g.KFTBEBattleBossState.MONSTER_ESCAPE:i.bossInFoBox.visible=!1,i.btn_see.visible=!1,i.buttonBox.visible=!0,i.bossHead.visible=!1,i.attackBoss.visible=!1;break;default:i.btn_see.visible=!1,i.attackBoss.visible=!1}i.btn_see.restskin()}},t.prototype.attackBossHander=function(){this.manager().findBoss(!0)},t.prototype.manager=function(){return d.KFTManager.ins()},t.prototype.getDeathCtrl=function(){return this.deathCtrl},t.prototype.onDeath=function(t,e,i){var n=this.manager().checkIsMainScene();this.lastportid=n?NaN:this.currportid,this.deathCtrl.onDeath(t,e,i,n),this.view&&this.view.visible&&this.view.onDeath()},t.prototype.updJianMianHurt=function(t){this.view&&(this.view.lbHurtJianMian.text=c.TextConst.get(888,t))},t.prototype.updateLeftTime=function(t){this.view&&(this.view.tip_txt.visible=!0,this.view.left_time_txt.visible=!0,this.view.tip_txt.visible=!0,0<=t||(t=0),this.view.left_time_txt.text=y.DateUtil.getHMS_countdown(t))},t.prototype.updateBossPanel=function(t){if(this.totalInfoView&&t==this.manager().kfTBWorldMapVo().portid){var e=this.manager().getPortState(t);if(e){this.totalInfoView.boss_num.value=e.bossCount+"",this.totalInfoView.box_num.value=e.boxCount+"";var i=v.GameConfig.kfTBWorldMapVo;for(var n in i){var s=i[n];if(s.portid==t){this.setItems(s);break}}}}},t.prototype.setItems=function(t){for(var e=0;e<t.showreward.length;e++){var i=t.showreward[e],n=o.ItemUtils.getItemOrEq(i),s=this.totalInfoView["item"+e];f.ItemIconView.setItemData(n,s)}},t.prototype.onOPlayerStatusChanged=function(){this.updHideBtnStatus()},t.prototype.updHideBtnStatus=function(){1==a.SettingInfo.getSettingValue(s.SettingEnum.hideOtherPlayer)?this.view.hideOPlayerButton.skin="res/fightview/rexue_pingbiguan.png":this.view.hideOPlayerButton.skin="res/fightview/rexue_pingbikai.png"},t.prototype.hidePlayer=function(){a.SettingInfo.getSettingValue(s.SettingEnum.hideOtherPlayer)?r.SettingCtrl.getInstance().hideOtehrPlayer(!1):r.SettingCtrl.getInstance().hideOtehrPlayer(!0)},t}();e.KFTBHotBloodWarCtrl=_}),define("src/g/fight/osprite/play/kftplay/KFTManager",["require","exports","../../../../../core/E","../../../../net/messages/ChangeSceneMsg","../../../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../../../manager/RoleCenter","../../../../../meta/ReXieZhanChangSettingVo","../../../../../config/GameConfig","../../../../../manager/GameSocketManager","../../../../net/messages/ActivityMessage","../../../../net/messages/EnterMuSceneC2GS","../../../../../utils/system/FloatEffect","src/init/TextConst","../../../../../plugin/view/ToolTip","../../../../../manager/AM","src/g/fight/osprite/play/PlayManager","../../../../../utils/system/ServerTime","src/g/accessctrl/AccessCenter","../../../../net/messages/kuafu/KftbBattleMsg"],function(t,e,o,a,r,l,h,i,c,u,p,d,g,v,f,y,m,_,n,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function s(){this.gamePlay=null,this._battleOpenStateMsg=null,this._bossVoInitKey=!1,this._bossVoDic={},this._bossInfoDic={},this._ownerFG=null,this._relifeTime=-1,this._enterPortId=-1,this._openPanelKey=!1,this.viewCtrl=null,this._portBoss={},this._cdArr={},this._panelReqKey=!1,this._enterObj={},u.GSM.ins.on(C.KFTBSceneStateGS2C.KEY,this,this.KFTBSceneStateGS2C)}return s.ins=function(){return this._ins||(this._ins=new s),this._ins},s.prototype.getSetting=function(t){var e=c.GameConfig.kftsetting[t];return e||(e=new i.KFTSettingVo)},s.prototype.KFTBSceneStateGS2C=function(t){this._portBoss[t.portid]=t,this.viewCtrl&&this.viewCtrl.updateBossPanel(t.portid)},s.prototype.showPassList=function(t,e,i,n){this.viewCtrl&&this.viewCtrl.showPassList(t,e,i,n)},s.prototype.updateBossPanel=function(t){this.viewCtrl&&this.viewCtrl.updateBossPanel(t)},s.prototype.updateLeftTime=function(t){this.viewCtrl&&this.viewCtrl.updateLeftTime(t)},s.prototype.getPortState=function(t){return void 0===t&&(t=0),t||(t=this.getPortId()),this._portBoss[t]},s.prototype.getBossInfoDic=function(){return this._bossInfoDic},s.prototype.checkIsMainScene=function(){var t=s.ins().kfTBWorldMapVo().portid;return this.getPortId()==t},s.prototype.getPortId=function(){return this.gamePlay?this.gamePlay.getCurrPortId():-1},s.prototype.exitHotBloodWar=function(){this.gamePlay&&this.gamePlay.sendEnterMuSceneC2GS(!1,this.gamePlay.getCurrPortId(),0,0)},s.prototype.onBossKillStateGS2C=function(t){if(this._panelReqKey)this._panelReqKey=!1;else{if(this.setDecHurt(t.bossOwnerDecHurt),this.gamePlay){var e=this.gamePlay.getPlayerFG(t.owneruname);this.setBossOwner(e)}this._bossInfoDic[t.portid]&&this.bossStateChange(this._bossInfoDic[t.portid])}},s.prototype.setDecHurt=function(t){this.viewCtrl&&this.viewCtrl.updJianMianHurt(t)},s.prototype.updateBossOwnerHp=function(t,e){this.viewCtrl&&this.viewCtrl.updateBossOwnerHp(t,e)},s.prototype.getPortStatus=function(t){return this._bossInfoDic[t]||this.reqOpenBossInfoPanel(t),this._bossInfoDic[t]},s.prototype.findBoss=function(t){this.gamePlay&&(t?this.gamePlay.startKillMonster():this.gamePlay.wakeupBoss())},s.prototype.enterGamePlay=function(t){o.E.ins.event(r.EventName.KFTBHOTBLOODWAR_SCENE_PANEL);var e=u.GSM.ins;e.on(p.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),e.on(C.KFTBBattleBossEndGS2C.KEY,this,this.onKFRXBattleBossEndGS2C),e.on(p.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChangeGS2C),e.on(d.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C),this.setBossOwner(null),this.gamePlay=t,-1!=this._enterPortId&&(this.gamePlay.setEnterPortId(this._enterPortId),this._enterPortId=-1);var i=this._kfTBWorldMapVo.portid,n=this.gamePlay.getStartPoint();this.gamePlay.sendEnterMuSceneC2GS(!0,i,n[0],n[1])},s.prototype.getPortCD=function(t){return this._cdArr[t]},s.prototype.exitGamePlay=function(){this.viewCtrl&&(this.viewCtrl.exit(),this.viewCtrl=null),this._enterPortId=-1,this.setBossOwner(null);var t=this._kfTBWorldMapVo.portid;this._cdArr[t]=_.ServerTime.serverTime+this.getSetting("outTimeCD").value;var e=u.GSM.ins;e.off(p.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),e.off(C.KFTBBattleBossEndGS2C.KEY,this,this.onKFRXBattleBossEndGS2C),e.off(p.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChangeGS2C),this.gamePlay=null,e.off(d.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C)},s.prototype.setMonsterHp=function(t){this.viewCtrl&&this.viewCtrl.updateBossHp(t)},s.prototype.showDeadAlert=function(t){this.viewCtrl.onDeath(t,new Laya.Handler(this,this.onMoneyLife),new Laya.Handler(this,this.onReLife))},s.prototype.onReLife=function(){this.sendRebord(!1)},s.prototype.onMoneyLife=function(){var t=this.getSetting("payForLife").value;h.RoleCenter.instans.self.GOLD<t?g.FE.upItems(v.TextConst.get(460),f.BubbleEnum.center):this.sendRebord(!0)},s.prototype.sendRebord=function(t){if(this.gamePlay){var e=new p.ActivityRebirthC2GS;e.acttype=p.EACT_TYPE.kftb,e.freeRebirth=!0;var i=this.gamePlay.getCurrPortId(),n=c.GameConfig.getPortByID(i),s=c.GameConfig.getMapJSON(n.boss_scene),o=s.startPoint[0][0],a=s.startPoint[0][1];e.posx=o,e.posy=a,u.GSM.sendServer(e)}else console.error("不在玩法中")},s.prototype.reqBossKillState=function(t,e){void 0===e&&(e=0);var i=new C.KFTBBossKillStateC2GS;i.portid=t,u.GSM.sendServer(i),1==e&&(this._panelReqKey=!0)},s.prototype.onBloodyBattleActOpenState=function(t){this._battleOpenStateMsg=t},s.prototype.bossStateChange=function(t){var e=t.portid;this.viewCtrl&&this.viewCtrl.updateBossState(e),this.gamePlay&&this.gamePlay.updateBossState(e),this.checkIsShowBossView(e)},s.prototype.onBattleBossStateGS2C=function(t){this._bossInfoDic[t.portid]=t,this.bossStateChange(t)},s.prototype.onBattleBossStateAll=function(t){for(var e=null,i=0;i<t.bossStateArr.length;i++)e=t.bossStateArr[i],this._bossInfoDic[e.portid]=e},s.prototype.checkIsShowBossView=function(t){if(this.viewCtrl&&this.gamePlay&&this.gamePlay.getCurrPortId()==t)if(this._bossInfoDic[t]){var e=this._bossInfoDic[t];this.viewCtrl.visibleBossView(!0,e.bossState)}else this.viewCtrl.visibleBossView(!1,null)},s.prototype.onBattleBossReviveGS2C=function(t){var e=this._bossInfoDic[t.portid];e&&(e.bossState=C.KFTBEBattleBossState.CAN_CHALLENGE,this.bossStateChange(e),this.reqOpenBossInfoPanel(t.portid)),this.gamePlay&&this.gamePlay.onBattleBossReviveGS2C(t)},s.prototype.reqOpenBossInfoPanel=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!0);var i=new C.KFTBBattleBossStateC2GS;i.portid=t,i.requestAll=0==t,u.GSM.sendServer(i),this._openPanelKey=e},s.prototype.getIsEnterPort=function(t){return this._enterObj[t]},s.prototype.onEnterMuSceneGS2C=function(t){if(t.opresult){if(this.viewCtrl){var e=s.ins().kfTBWorldMapVo().portid;t.portid==e?this.viewCtrl&&this.viewCtrl.hideBattlePanel():(this.viewCtrl&&this.viewCtrl.showBattlePanel(t.portid),this.setBossOwner(null),this.reqBossKillState(t.portid),this.reqOpenBossInfoPanel(t.portid))}t.enter?(t.enterType==d.EEnterMuSceneType.REVIVE&&this.viewCtrl.getDeathCtrl().relase(),this.gamePlay.setMainRoleByMsg(t)):o.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,l.PlayTypeVo.create(a.EPlayType.PLAYTYPE_PORT))}else o.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,l.PlayTypeVo.create(a.EPlayType.PLAYTYPE_PORT)),console.log(v.TextConst.showErrorInfo(t.error),t.portid)},s.prototype.enterHotBloodWar=function(t,e){if(void 0===e&&(e=a.EPlayType.PLAYTYPE_KFTB),!h.RoleCenter.instans.bagRoomEnough())return y.AM.showBagNotEnough(),!1;if(m.PlayManager.isSpecialPlay()&&m.PlayManager.type!=e)return g.FE.upItems(v.TextConst.get(406),f.BubbleEnum.center),!1;var i=s.ins().getPortCD(t.portid)-_.ServerTime.serverTime;if(0<=i)return g.FE.upItems(v.TextConst.get(984,i),f.BubbleEnum.center),!1;this._enterPortId=t.portid,this.getPortStatus(this._enterPortId);var n=new C.KFTBSceneStateC2GS;return n.portid=this._enterPortId,u.GSM.sendServer(n),this._kfTBWorldMapVo=t,o.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,l.PlayTypeVo.create(e,t)),!0},s.prototype.kfTBWorldMapVo=function(){return this._kfTBWorldMapVo},s.prototype.isBigMap=function(){return this._kfTBWorldMapVo.portid==this.gamePlay.getCurrPortId()},s.prototype.onBossOwnerChangeGS2C=function(t){if(""==t.newowner)this.setBossOwner(null);else{var e=this.gamePlay.getPlayerFG(t.newowner);this.setBossOwner(e)}},s.prototype.setBossOwner=function(t){this._ownerFG!=t&&(this._ownerFG=t,this.updateBossOwner(t)),this.gamePlay&&this.gamePlay.setBossOwner(t)},s.prototype.updateBossOwner=function(t){this.viewCtrl&&this.viewCtrl.updateBossOwner(t)},s.prototype.getPlayerFG=function(t){return this.gamePlay?this.gamePlay.getPlayerFG(t):null},s.prototype.getCurBoss=function(){var t=this.gamePlay.getCurrPortId();return this.getPortStatus(t)},s.prototype.onKFRXBattleBossEndGS2C=function(t){null!=t.bossowner&&""!=t.bossowner?(t.bossowner==h.RoleCenter.instans.self.username&&t.invent&&(h.RoleCenter.instans.addInventoryToC(t.invent),g.FE.addInventoryToCFloats(t.invent)),t.helpData&&t.helpData.isHelp&&t.helpData.invent&&(h.RoleCenter.instans.addInventoryToC(t.helpData.invent),g.FE.addInventoryToCFloats(t.helpData.invent))):console.warn("热血战场结算没有归属者"),o.E.ins.event(r.EventName.OPEN_HOTBLOOD_RESULT,t),this.gamePlay&&this.gamePlay.getCurrPortId()==t.portid&&this.setBossOwner(null)},s.prototype.onActivityRebirthGS2C=function(t){this.gamePlay&&this.gamePlay.onActivityRebirthGS2C(t),t.opresult?t.userAcc==h.RoleCenter.instans.self.username&&this.viewCtrl.getDeathCtrl().relase():console.error(t.error)},s.prototype.onBossKillRecordGS2C=function(t){},s.prototype.checkChangeCondition=function(t){return 0},s.prototype.sendEvt=function(t){o.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,l.PlayTypeVo.create(t))},s.prototype.getBossVoByPortId=function(t){if(0==this._bossVoInitKey){this._bossVoInitKey=!0;var e=null,i=c.GameConfig.kftvo;for(var n in i)e=i[n],this._bossVoDic[e.portId]=e}return this._bossVoDic[t]},s.prototype.checkIsHaveBossTask=function(){if(0<h.RoleCenter.instans.vo.KFRX_CNT||0<h.RoleCenter.instans.vo.KFRX_HELPCNT){var t=null,e=c.GameConfig.kfrxvo;for(var i in e)if(t=e[i],0==this.checkChangeCondition(t.port))return!0}return!1},s.prototype.checkIsEnter=function(){return!0},s.prototype.getFirstChallgeBoss=function(){return null},s._ins=null,s}();e.KFTManager=s}),define("src/g/fight/osprite/play/hotbloodwar/GamePlayHotBloodWar",["require","exports","src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager","../../../../../utils/ItemUtils","../../../../../config/GameConfig","../../../../../core/E","../../../../../utils/system/ServerTime","../../../../../enum/EventName","src/g/fight/osprite/obj/FightGroup","../../../../net/messages/BloodyBattleMsg","../../../../../manager/GameSocketManager","src/g/fight/osprite/play/RealTimeBossScene","../../../../net/messages/EnterMuSceneC2GS","../../../../../manager/RoleCenter","../../../../../utils/system/FloatEffect","../../../../../plugin/view/ToolTip","../../../../../manager/AM","../../../../../utils/system/DateUitl","src/init/TextConst"],function(t,e,i,r,l,s,c,o,a,u,h,n,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(n){function t(t){var e=n.call(this,t)||this;return e._showDebugKey=!1,e._currPortId=0,e._currMatrixList=[],e._waitTime=0,e._ownerFG=null,e._sendCdTime=3,e._outInfoKey=!1,e._sceneOpenStateDic={},e._tombStoneMonsterFG=null,e._bossStateChangeKey=!1,e._bossRelifeTime=-1,e._lastLeftTime=-1,e._autoBattleKey=!1,e._enterPortId=-1,e._waitAutoAttackBossTime=-1,e._autoAttackBossTime=5,h.GSM.ins.on(u.BattleBossHPGS2C.KEY,e,e.onBattleBossHPGS2C),s.E.ins.on(o.EventName.EXIT_BOSS_PLAYTYPE,e,e.onExitHandler),s.E.ins.on(o.EventName.REXUE_SCORE_CHANGE,e,e.calculateEnterCondition),e.calculateEnterCondition(),e.drawRect(),e.enablePK(!0),e._bossGroup=new a.FightGroup(null),e.manager().enterGamePlay(e),e.creatMonster(),e}return __extends(t,n),t.prototype.creatMonster=function(){var t=this.manager().getSetting("tombstone").value;this._tombStoneMonsterFG=this.createTombStoneMonster(t)},t.prototype.drawRect=function(){var t=0,e=this.manager().getSetting("portId").value,i=this.manager().getSetting("portId2").value||"";t=e,this.createAreaMatrixList(t,t,this._showDebugKey);var n=r.ItemUtils.getPortVoById(t),s=l.GameConfig.getMapJSON(n.boss_scene).doorXY;this.drawSafeArea(s[0],s[1],s[2]);for(var o=i.split(","),a=0;a<o.length;a++)t=Number(o[a]),this.createAreaMatrixList(t,t,this._showDebugKey)},t.prototype.calculateEnterCondition=function(){var t=!1,e=0,i=(this.manager().getSetting("portId"),this.manager().getSetting("portId").value);this._sceneOpenStateDic[i]=!0;for(var n=(this.manager().getSetting("portId2").value||"").split(","),s=0;s<n.length;s++)e=Number(n[s]),t=0==this.manager().checkChangeCondition(e),this._sceneOpenStateDic[e]=t},t.prototype.getStartPoint=function(){return this.getCoordinatePos(this.matrixList[0])},t.prototype.clear=function(){n.prototype.clear.call(this),this._enterPortId=-1,this._tombStoneMonsterFG&&(this._tombStoneMonsterFG.destroyGroup(!0),this._tombStoneMonsterFG=null),h.GSM.ins.off(u.BattleBossHPGS2C.KEY,this,this.onBattleBossHPGS2C),s.E.ins.off(o.EventName.EXIT_BOSS_PLAYTYPE,this,this.onExitHandler),s.E.ins.off(o.EventName.REXUE_SCORE_CHANGE,this,this.calculateEnterCondition),this.manager().exitGamePlay()},t.prototype.allInit=function(){n.prototype.allInit.call(this),this._fightGroup&&this._mainRole&&this._fightGroup.setFGMapXY(this._mainRole.mapX,this._mainRole.mapY),this._waitTime=c.ServerTime.serverTime+3,-1!=this._enterPortId&&(this.manager().gotoBossArea(this._enterPortId),this._enterPortId=-1)},t.prototype.frameMove=function(){n.prototype.frameMove.call(this),this.updatePlay()},t.prototype.updatePlay=function(){if(c.ServerTime.serverTime>this._waitTime&&this._mainRole){var t=this._mainRole.mapX,e=this._mainRole.mapY;if(this._currMatrixList&&0<this._currMatrixList.length&&!this.isInMatrixList(this._currMatrixList,t,e))for(var i=null,n=0;n<this.matrixList.length;n++)i=this.matrixList[n],this._currPortId!=i.id&&i.intCoordinate(t,e)&&(this._sceneOpenStateDic[i.id]?(this.reqChangeScene(i.id),this._waitTime=c.ServerTime.serverTime+this._sendCdTime):this._outInfoKey&&(this._outInfoKey=!1,g.FE.upItems(m.TextConst.get(452),v.BubbleEnum.center)))}if(this._ownerFG&&this.manager().updateBossOwnerHp(this._ownerFG.getHp(),this._ownerFG.getTotalHp()),this._bossStateChangeKey)if(this._bossStateChangeKey=!1,l=this.manager().getPortStatus(this._currPortId))switch(l.bossState){case u.EBattleBossState.WAIT_REVIVE:var s=this.manager().getBossVoByPortId(this._currPortId);this._bossRelifeTime=l.lastDieTime+(l.bossCD||s.cd),this._lastLeftTime=-1,this.visibleBossFG(!1),this.visibleTombStone(!0);break;case u.EBattleBossState.CAN_CHALLENGE:this._bossRelifeTime=c.ServerTime.serverTime,this.visibleBossFG(!0),this.visibleTombStone(!1),this.checkToAttackMonster()}else this.visibleBossFG(!1),this.visibleTombStone(!1),this._bossRelifeTime=c.ServerTime.serverTime;var o=this._bossRelifeTime-c.ServerTime.serverTime;if(-1!=this._bossRelifeTime&&0<o&&o!=this._lastLeftTime){this._lastLeftTime=o;var a=this._tombStoneMonsterFG,r=a?a.getUnitByIndex(0):null;r&&(r.topHpBar.headName=y.DateUtil.getHMS_countdown(o))}if(this._currTargetFG&&this._currTargetFG.isDeath()&&this.changeBattleState(0),0==this._invincibleKey&&null==this._targetName&&this._mainRole){switch(this._battleState){case 0:if(this._currTargetFG||2==this._mainRole.action)this._waitAutoAttackBossTime=c.ServerTime.serverTime,this._currTargetFG=null;else if(this._currTargetFG=this.getFreeRevengeTarget(),null==this._currTargetFG){var l=this.manager().getPortStatus(this._currPortId),h=c.ServerTime.serverTime-this._waitAutoAttackBossTime>this._autoAttackBossTime;l&&l.bossState==u.EBattleBossState.CAN_CHALLENGE&&h&&(this._waitAutoAttackBossTime=c.ServerTime.serverTime,this._bossGroup&&this.startKillMonster())}}this._currTargetFG&&this.pkStartAndTestDistance(this._currTargetFG.groupID)}},t.prototype.checkToAttackMonster=function(){if(!this._currTargetFG){var t=this.manager().getPortStatus(this._currPortId);t&&t.bossState==u.EBattleBossState.CAN_CHALLENGE&&this._bossGroup&&this.startKillMonster()}},t.prototype.changeBattleState=function(t){var e=n.prototype.changeBattleState.call(this,t);return e&&0==t&&(this._waitAutoAttackBossTime=c.ServerTime.serverTime),e},t.prototype.visibleTombStone=function(t){this._tombStoneMonsterFG&&(t?this._tombStoneMonsterFG.addToFightLayer():this._tombStoneMonsterFG.removeFromFightLayer(),this._tombStoneMonsterFG.visibleTopHpBar(t))},t.prototype.reqChangeScene=function(t){if(this._mainRole){var e=this._mainRole.mapX,i=this._mainRole.mapY,n=this._mainRole.ways;if(0<n.length){var s=n[n.length-1];this.sendEnterMuSceneC2GS(!0,t,e,i,p.EEnterMuSceneType.CLIENT_REQUEST_SCENE,s.x,s.y)}else this.sendEnterMuSceneC2GS(!0,t,e,i,p.EEnterMuSceneType.CLIENT_REQUEST_SCENE)}},t.prototype.addFightGroupSvrID=function(t,e){},t.prototype.setMainRoleByMsg=function(t){n.prototype.setMainRoleByMsg.call(this,t),this.addFightGroupSvrID(this._fightGroup,d.RoleCenter.instans.vo.username),t.opresult&&this.changeScene(t.portid,t.monsterUid)},t.prototype.changeScene=function(t,e){this._waitTime=c.ServerTime.serverTime,this._currPortId!=t&&(this._currPortId=t,this._currMatrixList=this.changeMatrix()),this.clearOtherPlayer(),this.clearAllState(),this.showMosnter(t,e)},t.prototype.showMosnter=function(t,e){this._bossGroup.destroyGroup(!1),this.releaseAllMonsterRes();var i=l.GameConfig.getPortByID(t),n=l.GameConfig.getMapJSON(i.boss_scene);n&&0<n.bossXY.length&&(this._monsterDic[-1]=this.createMonster(this._bossGroup,i.boss,e),this._bossGroup.resetFightGroup(n.bossXY[0]),this._bossGroup.setMapXY(n.bossXY[0][0],n.bossXY[0][1]),this._tombStoneMonsterFG&&this._tombStoneMonsterFG.setMapXY(n.bossXY[0][0],n.bossXY[0][1])),this.updateBossState(t)},t.prototype.updateBossState=function(t){t==this._currPortId&&(this._bossStateChangeKey=!0)},t.prototype.changeMatrix=function(){for(var t=[],e=null,i=0;i<this.matrixList.length;i++)(e=this.matrixList[i]).id==this._currPortId&&t.push(e);return t},t.prototype.onExitHandler=function(){f.AM.exitPlay(this.type,new Laya.Handler(this,function(){this.executeExit()}))},t.prototype.executeExit=function(){this.manager().exitHotBloodWar()},t.prototype.onBattleBossHPGS2C=function(t){this._monsterDic[t.monsterUid]&&(this.manager().setMonsterHp(t.bossHP),this.setMonsterHp(t.monsterUid,t.bossHP,!0),0==t.bossHP&&this.bossDead())},t.prototype.onBattleBossReviveGS2C=function(t){this.getCurrPortId()==t.portid&&this.showMosnter(t.portid,t.monsterUid)},t.prototype.onActivityRebirthGS2C=function(t){this.resetHero(t.userAcc,t.posx,t.posy),n.prototype.onActivityRebirthGS2C.call(this,t)},t.prototype.showDeadAlert=function(t,e){n.prototype.showDeadAlert.call(this,t,e),this.manager().showDeadAlert(e)},t.prototype.gotoPortCenter=function(t){for(var e=null,i=0;i<this.matrixList.length;i++)if(t==this.matrixList[i].id){e=this.matrixList[i];break}if(e){var n=this.getCoordinatePos(e);this.followTargetPos(n[0],n[1],0)}},t.prototype.gotoBoss=function(t){var e=l.GameConfig.getPortByID(t),i=l.GameConfig.getMapJSON(e.boss_scene);i&&0<i.bossXY.length&&this.followTargetPos(i.bossXY[0][0],i.bossXY[0][1]),this._autoBattleKey=!0},t.prototype.onMoveEndSC=function(t){n.prototype.onMoveEndSC.call(this,t);var e=Math.floor(t/a.FightGroup.HERO_MAXNUM),i=t%a.FightGroup.HERO_MAXNUM;this._mainRole&&e==this.fightGroup.uId&&i==this._mainRole.index&&this._autoBattleKey&&(this._autoBattleKey=!1,this.startKillMonster())},t.prototype.addPPlayer=function(t){var e=t.getFamilyUid();""==e||null==e?n.prototype.addPPlayer.call(this,t):t.getFamilyUid()!=this._fightGroup.getFamilyUid()?n.prototype.addPPlayer.call(this,t):this.addFamilyMemeber(t)},t.prototype.onSelectPkTarget=function(t){var e=this._playerDic[t];if(e){var i=e.getFamilyUid();""==i||null==i?n.prototype.onSelectPkTarget.call(this,t):i!=this._fightGroup.getFamilyUid()?n.prototype.onSelectPkTarget.call(this,t):f.AM.show(m.TextConst.get(453,e.getNickName()),Laya.Handler.create(this,this.surePkTarget,[t]))}},t.prototype.manager=function(){return i.HotBloodWarManager.getInstance()},t.prototype.setBossOwner=function(t){this._ownerFG=t,this._bossGroup&&!this._bossGroup.isDeath()&&this._bossGroup.setOnceTarget(this._ownerFG)},t.prototype.surePkTarget=function(t){n.prototype.onSelectPkTarget.call(this,t)},t.prototype.onClearTargetHandler=function(t){n.prototype.onClearTargetHandler.call(this,t),this._outInfoKey=!0,this._autoBattleKey=!1},t.prototype.setEnterPortId=function(t){this._enterPortId=t},t.prototype.getCurrPortId=function(){return this._currPortId},t}(n.RealTimeBossScene);e.GamePlayHotBloodWar=_}),define("src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager",["require","exports","../../../../../manager/GameSocketManager","../../../../net/messages/EnterMuSceneC2GS","../../../../../config/GameConfig","../../../../../core/E","../../../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../../../utils/system/FloatEffect","src/init/TextConst","../../../../net/messages/ChangeSceneMsg","../../../../../plugin/view/ToolTip","../../../../../meta/ReXieZhanChangSettingVo","../../../../net/messages/BloodyBattleMsg","../../../../net/messages/ActivityMessage","../../../../../manager/AM","../../../../../manager/RoleCenter","../../../../../utils/system/ServerTime","../../../../../utils/ItemUtils","../../../../../manager/NewRedHintsCenter","src/g/accessctrl/AccessCenter","src/g/fight/osprite/play/PlayManager"],function(t,e,o,a,r,l,h,i,c,u,p,d,n,g,v,f,y,m,_,C,I,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function s(){this.gamePlay=null,this._battleOpenStateMsg=null,this._bossVoInitKey=!1,this._bossVoDic={},this._bossInfoDic={},this._enterTime=-1,this._ownerFG=null,this._relifeTime=-1,this._enterPortId=-1,this._openPanelKey=!1,this.viewCtrl=null,this._panelReqKey=!1}return s.getInstance=function(){return null==s._instance&&(s._instance=new s),s._instance},s.prototype.enterGamePlay=function(t){l.E.ins.event(h.EventName.HOTBLOODWAR_SCENE_PANEL);var e=o.GSM.ins;e.on(g.BossKillRecordGS2C.KEY,this,this.onBossKillRecordGS2C),e.on(v.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),e.on(g.BloodyBattleBossEndGS2C.KEY,this,this.onBloodyBattleBossEndGS2C),e.on(v.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChangeGS2C),this.setBossOwner(null),this.gamePlay=t,-1!=this._enterPortId&&(this.gamePlay.setEnterPortId(this._enterPortId),this._enterPortId=-1);var i=this.getSetting("portId").value,n=this.gamePlay.getStartPoint();e.on(a.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C),this.gamePlay.sendEnterMuSceneC2GS(!0,i,n[0],n[1])},s.prototype.exitGamePlay=function(){this.viewCtrl&&(this.viewCtrl.exit(),this.viewCtrl=null),this._enterPortId=-1,this.setBossOwner(null),this._enterTime=m.ServerTime.serverTime+this.getSetting("outTimeCD").value;var t=o.GSM.ins;t.off(g.BossKillRecordGS2C.KEY,this,this.onBossKillRecordGS2C),t.off(v.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),t.off(g.BloodyBattleBossEndGS2C.KEY,this,this.onBloodyBattleBossEndGS2C),t.off(v.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChangeGS2C),this.gamePlay=null,t.off(a.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C)},s.prototype.onEnterMuSceneGS2C=function(t){if(t.opresult){if(this.viewCtrl){var e=t.portid;e==s.getInstance().getSetting("portId").value?this.viewCtrl.hideBattlePanel():(this.viewCtrl.showBattlePanel(e),this.setBossOwner(null),this.reqBossKillState(e),this.reqOpenBossInfoPanel(e))}t.enter?(t.enterType==a.EEnterMuSceneType.REVIVE&&this.viewCtrl.getDeathCtrl().relase(),this.gamePlay.setMainRoleByMsg(t)):l.E.ins.event(h.EventName.PLAY_TYPE_CHANGE,i.PlayTypeVo.create(p.EPlayType.PLAYTYPE_PORT))}else l.E.ins.event(h.EventName.PLAY_TYPE_CHANGE,i.PlayTypeVo.create(p.EPlayType.PLAYTYPE_PORT)),console.log("HotBloodWarManager::onEnterMuSceneGS2C:"+t.error),c.FE.upItems(u.TextConst.showErrorInfo(t.error),d.BubbleEnum.center)},s.prototype.enterHotBloodWar=function(t,e){if(void 0===e&&(e=p.EPlayType.PLAYTYPE_BLOODYBATTLE),!y.RoleCenter.instans.bagRoomEnough())return f.AM.showBagNotEnough(),!1;if(b.PlayManager.isSpecialPlay()&&b.PlayManager.type!=e)return c.FE.upItems(u.TextConst.get(406),d.BubbleEnum.center),!1;var i=this.checkChangeCondition(t);if(0!=i)return this.outConditionErrInfo(i,t),!1;if(null!=this.gamePlay)return this._enterPortId=t,s.getInstance().gotoBossArea(t),!1;if(!this._battleOpenStateMsg)return console.error("HotBloodWarManager::enterHotBloodWar:_battleOpenStateMsg = null"),!1;if(!this._battleOpenStateMsg.actOpen)return c.FE.upItems(u.TextConst.get(455),d.BubbleEnum.center),!1;var n=this._enterTime-m.ServerTime.serverTime;return 0<n?(c.FE.upItems(u.TextConst.get(454,n),d.BubbleEnum.center),!1):(this._enterPortId=t,this.sendEvt(e),!0)},s.prototype.sendEvt=function(t){l.E.ins.event(h.EventName.PLAY_TYPE_CHANGE,i.PlayTypeVo.create(t))},s.prototype.exitHotBloodWar=function(){this.gamePlay&&this.gamePlay.sendEnterMuSceneC2GS(!1,this.gamePlay.getCurrPortId(),0,0)},s.prototype.getSetting=function(t){var e=r.GameConfig.rexiezhanchangSettingVo[t];return e||(console.error("HotBloodWarManager::getSetting:key="+t),e=new n.ReXieZhanChangSettingVo)},s.prototype.getBossVoByPortId=function(t){if(0==this._bossVoInitKey){this._bossVoInitKey=!0;var e=null,i=r.GameConfig.rexiezhanchangVo;for(var n in i)e=i[n],this._bossVoDic[e.port]=e}return this._bossVoDic[t]},s.prototype.findBoss=function(){this.gamePlay&&this.gamePlay.startKillMonster()},s.prototype.gotoBossArea=function(t){if(this.gamePlay&&this._bossInfoDic[t]){var e=this.checkChangeCondition(t);0==e?this.gamePlay.gotoBoss(t):this.outConditionErrInfo(e,t)}},s.prototype.onBloodyBattleActOpenState=function(t){this._battleOpenStateMsg=t},s.prototype.reqOpenBossInfoPanel=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!0);var i=new g.BattleBossStateC2GS;i.portid=t,i.requestAll=0==t,o.GSM.sendServer(i),this._openPanelKey=e},s.prototype.onBattleBossStateAll=function(t){for(var e=null,i=0;i<t.bossStateArr.length;i++)e=t.bossStateArr[i],this._bossInfoDic[e.portid]=e;this._openPanelKey&&(this._openPanelKey=!1,this.openBossInfoPanel()),l.E.ins.event(h.EventName.HOTBLOOD_DATA_UPDATE)},s.prototype.openBossInfoPanel=function(){l.E.ins.event(h.EventName.HOTBLOOD_DATA_INITED)},s.prototype.getPortStatus=function(t){return this._bossInfoDic[t]},s.prototype.getBossInfoDic=function(){return this._bossInfoDic},s.prototype.onBattleBossStateGS2C=function(t){var e=this._bossInfoDic[t.portid];e&&e.bossState==g.EBattleBossState.CAN_CHALLENGE&&t.bossState==g.EBattleBossState.WAIT_REVIVE&&l.E.ins.event(h.EventName.HB_BOSSDEATH,t),this._bossInfoDic[t.portid]=t,this.bossStateChange(t)},s.prototype.onBossKillRecordGS2C=function(t){console.log("portId:"+t.portid);for(var e=0;e<t.usernick.length&&e<t.killTime.length&&e<t.combat.length&&e<t.familynick.length;e++)console.log("userNick:"+t.usernick[e]+" killTime:"+t.killTime[e]+" combat:"+t.combat[e]+" familyNick:"+t.familynick[e])},s.prototype.onBattleBossReviveGS2C=function(t){var e=this._bossInfoDic[t.portid];e&&(e.bossState=g.EBattleBossState.CAN_CHALLENGE,this.bossStateChange(e),this.reqOpenBossInfoPanel(t.portid)),this.gamePlay&&this.gamePlay.onBattleBossReviveGS2C(t)},s.prototype.reqBossKillState=function(t,e){void 0===e&&(e=0);var i=new g.BossKillStateC2GS;i.portid=t,o.GSM.sendServer(i),1==e&&(this._panelReqKey=!0)},s.prototype.onBossKillStateGS2C=function(t){if(this._panelReqKey)this._panelReqKey=!1,l.E.ins.event(h.EventName.HOTBLOOD_REPORT_RECEIVED,t);else{if(this.setDecHurt(t.bossOwnerDecHurt),this.gamePlay){var e=this.gamePlay.getPlayerFG(t.owneruname);this.setBossOwner(e)}this._bossInfoDic[t.portid]&&this.bossStateChange(this._bossInfoDic[t.portid])}},s.prototype.onBossOwnerChangeGS2C=function(t){if(""==t.newowner)this.setBossOwner(null);else{var e=this.gamePlay.getPlayerFG(t.newowner);this.setBossOwner(e)}},s.prototype.showDeadAlert=function(t){this.viewCtrl.onDeath(t,new Laya.Handler(this,this.onMoneyLife),new Laya.Handler(this,this.onReLife))},s.prototype.onReLife=function(){this.sendRebord(!0)},s.prototype.onMoneyLife=function(){var t=this.getSetting("payForLife").value;y.RoleCenter.instans.self.GOLD<t?c.FE.upItems(u.TextConst.get(460),d.BubbleEnum.center):this.sendRebord(!1)},s.prototype.onActivityRebirthGS2C=function(t){this.gamePlay&&this.gamePlay.onActivityRebirthGS2C(t),t.opresult?t.userAcc==y.RoleCenter.instans.self.username&&(y.RoleCenter.instans.vo.GOLD-=t.decGold,this.viewCtrl.showLastBossScene(),this.viewCtrl.getDeathCtrl().relase()):console.error(t.error)},s.prototype.onBloodyBattleBossEndGS2C=function(t){null!=t.bossowner&&""!=t.bossowner?(t.bossowner==y.RoleCenter.instans.self.username&&(0<y.RoleCenter.instans.vo.BBCNT&&y.RoleCenter.instans.vo.BBCNT--,t.invent&&(y.RoleCenter.instans.addInventoryToC(t.invent),c.FE.addInventoryToCFloats(t.invent)),this.checkHotBloodWarRedPoint()),t.helpData&&t.helpData.isHelp&&(0<y.RoleCenter.instans.vo.BBHELPCNT&&y.RoleCenter.instans.vo.BBHELPCNT--,t.helpData.invent&&(y.RoleCenter.instans.addInventoryToC(t.helpData.invent),c.FE.addInventoryToCFloats(t.helpData.invent)))):console.warn("热血战场结算没有归属者"),l.E.ins.event(h.EventName.OPEN_HOTBLOOD_RESULT,t),this.gamePlay&&this.gamePlay.getCurrPortId()==t.portid&&this.setBossOwner(null)},s.prototype.sendRebord=function(t){if(this.gamePlay){var e=null,i=new v.ActivityRebirthC2GS;i.acttype=v.EACT_TYPE.bloodybattle,e=(i.freeRebirth=t)?this.gamePlay.getStartPoint():this.gamePlay.getSelfPos(),i.posx=e[0],i.posy=e[1],o.GSM.sendServer(i)}else console.error("不在玩法中")},s.prototype.checkChangeCondition=function(t){if(t==s.getInstance().getSetting("portId").value)return 0;var e=this.getBossVoByPortId(t);if(e){var i=y.RoleCenter.instans.self.getRXPingFen();return y.RoleCenter.instans.self.getCurLv()>=e.limit1?i>=1e4*e.limit2?0:2:1}return 3},s.prototype.checkIsHaveBossTask=function(){if(0<y.RoleCenter.instans.self.BBCNT){var t=null,e=r.GameConfig.rexiezhanchangVo;for(var i in e)if(t=e[i],0==this.checkChangeCondition(t.port))return!0}return!1},s.prototype.outConditionErrInfo=function(t,e){var i=this.getBossVoByPortId(e),n=null;switch(t){case 0:break;case 1:n=u.TextConst.get(458,_.ItemUtils.getEquipLv(i.limit1));break;case 2:n=u.TextConst.get(459,i.limit2);break;case 3:n=u.TextConst.get(469)}n&&c.FE.upItems(n,d.BubbleEnum.center)},s.prototype.getSelfPos=function(){return this.gamePlay?this.gamePlay.getSelfPos():[0,0]},s.prototype.getPlayerFG=function(t){return this.gamePlay?this.gamePlay.getPlayerFG(t):null},s.prototype.checkIsMainScene=function(){var t=s.getInstance().getSetting("portId").value;return this.getPortId()==t},s.prototype.getPortId=function(){return this.gamePlay?this.gamePlay.getCurrPortId():-1},s.prototype.changePortId=function(t){},s.prototype.setMonsterHp=function(t){this.viewCtrl&&this.viewCtrl.updateBossHp(t)},s.prototype.setBossOwner=function(t){this._ownerFG!=t&&(this._ownerFG=t,this.updateBossOwner(t)),this.gamePlay&&this.gamePlay.setBossOwner(t)},s.prototype.setDecHurt=function(t){this.viewCtrl&&this.viewCtrl.updJianMianHurt(t)},s.prototype.updateBossOwner=function(t){this.viewCtrl&&this.viewCtrl.updateBossOwner(t)},s.prototype.updateBossOwnerHp=function(t,e){this.viewCtrl&&this.viewCtrl.updateBossOwnerHp(t,e)},s.prototype.bossStateChange=function(t){var e=t.portid;this.viewCtrl&&this.viewCtrl.updateBossState(e),this.gamePlay&&this.gamePlay.updateBossState(e),this.checkIsShowBossView(e),l.E.ins.event(h.EventName.HOTBLOOD_DATA_UPDATE)},s.prototype.checkIsShowBossView=function(t){if(this.viewCtrl&&(this.gamePlay&&this.gamePlay.getCurrPortId()==t))if(this._bossInfoDic[t])switch(this._bossInfoDic[t].bossState){case g.EBattleBossState.CAN_CHALLENGE:this.viewCtrl.visibleBossView(!0);break;case g.EBattleBossState.WAIT_REVIVE:this.viewCtrl.visibleBossView(!1)}else this.viewCtrl.visibleBossView(!1)},s.prototype.checkHotBloodWarRedPoint=function(){this.checkIsEnter()?C.NewRedHintsCenter.ins.setRedHintOpenOrClose(C.enumRedHints.hot_blood_war,!0):C.NewRedHintsCenter.ins.setRedHintOpenOrClose(C.enumRedHints.hot_blood_war,!1)},s.prototype.checkIsEnter=function(){var t=I.AccessCenter.ins.checkOpen(172),e=s.getInstance().checkIsHaveBossTask();return!(!t||!e)},s.prototype.getFirstChallgeBoss=function(){if(!this.checkIsEnter())return null;var t=this._bossInfoDic,e=null;for(var i in t)if(e=t[i])switch(e.bossState){case g.EBattleBossState.WAIT_REVIVE:break;case g.EBattleBossState.CAN_CHALLENGE:if(0==this.checkChangeCondition(e.portid))return _.ItemUtils.getBossVoByPortId(e.portid);break;case g.EBattleBossState.NULL:}return null},s._instance=null,s}();e.HotBloodWarManager=s}),define("src/g/fightactivity/view/ActivtyPop",["require","exports","../../../core/E","../../../enum/EventName","src/g/clearRes/ClearResM"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.btn_fight.on(Laya.Event.CLICK,t,t.closeHandler),t}return __extends(t,e),t.prototype.setData=function(t){this._vo=t,this.ti_icon.skin="dynamic2/activity/t"+t.id+".png",this.des.text=t.penDes;var e,i="res/huodong/";switch(t.id){case 1:e=i+"shijie.png";break;case 2:e=i+"zhuansheng.png";break;case 3:e=i+"shacheng.png";break;case 4:e=i+"paodian.png";break;case 5:e=i+"yezhan.png";break;case 6:e=i+"shenweiyu.png";break;default:e="dynamic2/activity/a"+t.id+".png"}this.act_icon.skin=e,s.ClearResM.resetViewImg(this.act_icon)},t.prototype.closeHandler=function(){this.removeSelf(),this.gotActivity(this._vo)},t.prototype.gotActivity=function(t){t&&i.E.ins.event(n.EventName.GOTO_ACTIVTY,t)},t}(ui.index.ActivtyPopUI);e.ActivtyPop=o}),define("src/g/index/ctrl/BossTipCtrl",["require","exports","src/g/boss/vo/BossInfos","../../../manager/AM","../../../manager/RoleCenter","../../../manager/StateManger","../../../core/E","../../../enum/EventName","src/g/accessctrl/AccessCenter","../../net/messages/ActivityMessage","../../../utils/ItemUtils","../../net/messages/sbkSetData","../../../config/GameConfig","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg","src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager","src/g/index/ctrl/GameIndexCtrl","src/g/fightactivity/view/ActivtyPop","src/init/Switches","src/g/boss/view/ZhiZunBossView","src/g/fight/osprite/play/CrossSvrBoss/CrossSvrBossManager","../../../manager/NewRedHintsCenter","src/g/fight/osprite/play/kfhotblood/KfHotBloodManager","../../net/messages/kuafu/AllWorldBattleMsg","src/g/fight/osprite/play/kftplay/KFTManager","src/g/copy/view/PersonBossUtil"],function(t,e,_,i,C,n,s,o,I,h,b,a,w,r,S,l,c,u,p,d,g,v,f,y,E,T){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=function(){function m(){}return m.setupView=function(){this.openIndex[S.EPlayType.PLAYTYPE_QUANMINBOSS]=73,this.openIndex[S.EPlayType.PLAYTYPE_MOSTVIPBOSS1]=75,this.openIndex[S.EPlayType.PLAYTYPE_MOSTVIPBOSS2]=75,this.openIndex[S.EPlayType.PLAYTYPE_MOSTVIPBOSS3]=75,this.openIndex[S.EPlayType.PLAYTYPE_MIJINGBOSS]=67,this.openIndex[S.EPlayType.PLAYTYPE_SHENYUBOSS]=74,this.openIndex[S.EPlayType.PLAYTYPE_BLOODYBATTLE]=172,this.openIndex[S.EPlayType.PLAYTYPE_ALLWORLDBOSS]=200,this.openIndex[S.EPlayType.PLAYTYPE_KFRX]=215,this.openIndex[S.EPlayType.PLAYTYPE_VIPBOSS]=75,Laya.timer.clear(this,this.checkHandler),this.initkfList(),Laya.timer.loop(5e3,this,this.checkHandler),Laya.timer.once(6e3,this,this.checkVipBossTipOnLogin),s.E.ins.on(o.EventName.PLAY_TYPE_CHANGED,this,this.restartHandler),s.E.ins.on(o.EventName.HOTBLOOD_DATA_UPDATE,this,this.updateData),Laya.timer.once(1e4,this,function(){l.HotBloodWarManager.getInstance().checkIsEnter()&&l.HotBloodWarManager.getInstance().reqOpenBossInfoPanel(),f.KFHotBloodManager.ins().checkIsEnter()&&f.KFHotBloodManager.ins().reqOpenBossInfoPanel(),E.KFTManager.ins().checkIsEnter()&&E.KFTManager.ins().reqOpenBossInfoPanel(),f.KFHotBloodManager.ins().checkKFRXWarRedPoint()})},m.checkVipBossTipOnLogin=function(){var t=w.GameConfig.bossjson,e=[];if(C.RoleCenter.instans.self.bossData.bossopen)for(var i in t){var n=t[i];T.PersonBossUtil.checkVip(n.type)&&e.push(n)}for(var s=C.RoleCenter.instans.vo.VIP,o=[],a=1;a<9;a++)o.push(1e5*(s+a)+40);for(var r=0;r<o.length;r++)for(var i in t){6==(n=t[i]).type&&n.lv==o[r]&&e.push(n)}for(var l=[],h=e.length-1;0<=h;h--){n=e[h];var c=T.PersonBossUtil.getIndex(n);0==(y=C.RoleCenter.instans.self.bossData.bossprivateNum[c])&&(e.splice(h,1),l.push(n))}for(var u=0;u<l.length;u++)e.push(l[u]);if(0<e.length)for(var p=0;p<e.length;p++){var d=e[p],g=b.ItemUtils.getBossId(d.id),v=T.PersonBossUtil.getIndex(g),f=_.BossInfos.getBossID(g.id),y=C.RoleCenter.instans.self.bossData.bossprivateNum[v];if(I.AccessCenter.ins.checkOpen(75)&&0<y&&d.type==S.EPlayType.PLAYTYPE_VIPBOSS&&0<=v&&(f==_.BossInfos.bosstip||f==_.BossInfos.defbosstip)){window.enabledpay&&m.showBossReLifePanel(g);break}}},m.initkfList=function(){for(var t in this._kfbossList={},w.GameConfig.bossjson){var e=w.GameConfig.bossjson[t];e.type==S.EPlayType.PLAYTYPE_ALLWORLDBOSS&&(this._kfbossList[t]=e)}},m.checkKFBoss=function(){if(v.NewRedHintsCenter.ins.setRedHintOpenOrClose(v.enumRedHints.kffightred,!1),this._kfbossList||this.initkfList(),!I.AccessCenter.ins.checkOpen(199))return!1;var t=C.RoleCenter.instans.vo.getCurLv();for(var e in this._kfbossList){var i=this._kfbossList[e],n=g.CrossSvrBossManager.getIns().bossStateData(i.port);if(n&&(n.bossState==y.EAllWorldBossState.CAN_CHALLENGE||n.bossState==y.EAllWorldBossState.WAIT_CHALLENGE)&&i.lv<=t)return this.bossTemp=i,v.NewRedHintsCenter.ins.setRedHintOpenOrClose(v.enumRedHints.kffightred,!0),!0}return!1},m.updateBoss=function(){this.checkHandler()},m.setTipValue=function(t){this.bossTemp&&this.bossTemp.id==t&&this.showBossReLifePanel(null)},m.updateData=function(t){var e=l.HotBloodWarManager.getInstance().getFirstChallgeBoss()||f.KFHotBloodManager.ins().getFirstChallgeBoss();if(e){if(this._rexueboss&&this._rexueboss.id==e.id)return;this._rexueboss=e,this.bossTemp=this._rexueboss,this.checkHandler()}else this.bossTemp&&this.bossTemp.type==S.EPlayType.PLAYTYPE_BLOODYBATTLE&&(this.bossTemp=null,this.showBossReLifePanel(null)),this._rexueboss=null},m.activtyPop=function(t){if(r.PlayManager.type==S.EPlayType.PLAYTYPE_PORT||r.PlayManager.type==S.EPlayType.PLAYTYPE_MAINCITY){if(!this.actPop){this.actPop=new u.ActivtyPop;var e=w.GameConfig.timingActivity,i=t;for(var n in e){var s=e[n];if(s.gongneng==i){this.actPop.setData(s);break}}this.actPop.btn_close.on(Laya.Event.CLICK,this,this.clickHandler),this.actPop.btn_fight.on(Laya.Event.CLICK,this,function(){})}this.tweenView(this.actPop)}},m.clickHandler=function(){this.actPop.visible=!1,this.actPop.destroy(!0),this.actPop=null},m.hideActPop=function(){this.actPop&&this.actPop.removeSelf()},m.restartHandler=function(){r.PlayManager.type==S.EPlayType.PLAYTYPE_PORT&&Laya.timer.once(5e3,this,this.checkHandler),this.setVisible(!1),this.hideActPop()},m.checkHandler=function(){if(this.bossTemp=null,I.AccessCenter.ins.checkOpen(23))if(this.checkKFBoss())this.showBossReLifePanel(this.bossTemp);else if(this.checkMiJing())this.showBossReLifePanel(this.bossTemp);else if(this.checkShenBoss())this.showBossReLifePanel(this.bossTemp);else{if(!this.checkQBoss())return this._rexueboss?(this.bossTemp=this._rexueboss,void this.showBossReLifePanel(this._rexueboss)):void this.showBossReLifePanel(this.bossTemp);this.showBossReLifePanel(this.bossTemp)}},m.checkQBoss=function(){if(this.bossTemp=null,!I.AccessCenter.ins.checkOpen(23))return!1;var t=[];return 0<C.RoleCenter.instans.vo.QUANMINGCOUNT&&(t=_.BossInfos.allpersonBoss,this.findboss(t))},m.findboss=function(t){var e=C.RoleCenter.instans.vo;e.setData||(e.setData=new a.sbkSetData);for(var i=0;i<t.length;i++){var n=t[i];if(n.curstate!=h.EACTIVITY_STATE.INCD){var s=b.ItemUtils.getBossId(n.bossid);if(_.BossInfos.getBossID(s.id)==_.BossInfos.nobosstip)continue;if(s.lv>e.getCurLv())continue;this.bossTemp?this.bossTemp.lv<s.lv&&(this.bossTemp=s):this.bossTemp=s}}return!!this.bossTemp},m.checkShenBoss=function(){this.bossTemp=null;var t=_.BossInfos.shenBoss,e=C.RoleCenter.instans.vo.WINGBOSSCOUNT;return!!I.AccessCenter.ins.checkOpen(74)&&(!(e<=0)&&this.findboss(t))},m.checkNewVipBoss=function(){var t=_.BossInfos.vipboss,e=C.RoleCenter.instans.vo,i=e.VIP;if(!i)return!1;if(!I.AccessCenter.ins.checkOpen(75))return!1;var n,s=e.getCurLv(),o=d.ZhiZunBossView.vipLevels;if(t)for(var a=0;a<t.length;a++){var r=t[a];if(r.curstate!=h.EACTIVITY_STATE.INCD){var l=b.ItemUtils.getBossId(r.bossid);if(l.lv>s)break;i>=o[0]&&l.type==S.EPlayType.PLAYTYPE_MOSTVIPBOSS1?n=l:i>=o[1]&&l.type==S.EPlayType.PLAYTYPE_MOSTVIPBOSS2?n=l:i>=o[2]&&l.type==S.EPlayType.PLAYTYPE_MOSTVIPBOSS3&&(n=l)}}return!!(this.bossTemp=n)},m.checkVip=function(){var t=_.BossInfos.vipboss,e=C.RoleCenter.instans.vo,i=e.VIP;if(!i)return!1;var n,s=e.getCurLv(),o=d.ZhiZunBossView.vipLevels;if(t)for(var a=0;a<t.length;a++){var r=t[a];if(r.curstate!=h.EACTIVITY_STATE.INCD){var l=b.ItemUtils.getBossId(r.bossid);if(l.lv>s)break;i>=o[0]&&l.type==S.EPlayType.PLAYTYPE_MOSTVIPBOSS1?n=l:i>=o[1]&&l.type==S.EPlayType.PLAYTYPE_MOSTVIPBOSS2?n=l:i>=o[2]&&l.type==S.EPlayType.PLAYTYPE_MOSTVIPBOSS3&&(n=l)}}return!!(this.bossTemp=n)},m.checkMiJing=function(){var t=_.BossInfos.mjboss,e=C.RoleCenter.instans.vo.SECRETBOSSCOUNT;if(!I.AccessCenter.ins.checkOpen(67))return!1;if(e<=0)return!1;var i=C.RoleCenter.instans.vo.zhuanshengLv/2;if(i){i=Math.ceil(i);var n=w.GameConfig.hunyinboss;if(t)for(var s=0;s<t.length;s++){var o=t[s];if(o.curstate!=h.EACTIVITY_STATE.INCD)if(n[o.bossid].type2==i)return this.bossTemp=b.ItemUtils.getBossId(o.bossid),!0}return!1}},m.setVisible=function(t){this.view&&(this.view.visible=t),t||(Laya.timer.clear(this,this.checkHandler),Laya.timer.loop(3e4,this,this.checkHandler))},m.fightHandler=function(t){if(t.stopPropagation(),C.RoleCenter.instans.bagRoomEnough()){if(!n.StateManger.isSpecialPlay()){var e=this.bossTemp;p.Switches.ins.event(this.openIndex[e.type],e),this.hideView(),this.bossTemp=null}}else i.AM.showBagNotEnough()},m.showBossReLifePanel=function(t){if(this.bossTemp=t,!C.RoleCenter.instans.vo||I.AccessCenter.ins.checkOpen(198))if(r.PlayManager.type==S.EPlayType.PLAYTYPE_PORT||r.PlayManager.type==S.EPlayType.PLAYTYPE_MAINCITY)if(t){switch(this.view||(this.view=new ui.boss.BossTipUI,this.view.visible=!1,this.view.btn_fight.on(Laya.Event.CLICK,this,this.fightHandler),this.view.btn_close.on(Laya.Event.CLICK,this,this.hideView)),t.type){case S.EPlayType.PLAYTYPE_VIPBOSS:this.view.tip_img.skin="res/bosstip/BOSS_tixing_biaotizi_017.png";break;case S.EPlayType.PLAYTYPE_MOSTVIPBOSS1:case S.EPlayType.PLAYTYPE_MOSTVIPBOSS2:case S.EPlayType.PLAYTYPE_MOSTVIPBOSS3:this.view.tip_img.skin="res/bosstip/27.png";break;default:this.view.tip_img.skin="res/bosstip/"+t.type+".png"}if(Laya.timer.clear(this,this.checkHandler),this.view.visible=!0,t.type==S.EPlayType.PLAYTYPE_VIPBOSS){var e=T.PersonBossUtil.getVipLv(t);this.view.boss_name.text=t.name+"(vip"+e+")",this.view.drop_tip.visible=!1}else{var i=b.ItemUtils.getLv(t.lv);this.view.boss_name.text=t.name+"("+i+")",this.view.drop_tip.text=t.desc}this.tweenView(this.view),this.view.bossicon.skin=b.ItemUtils.getBossIconByPort(t.port)}else this.hideView();else this.hideView()},m.tweenView=function(t){t.x=Laya.stage.width/2,t.y=Laya.stage.height-350,c.GameIndexCtrl.idxView.addChild(t),t.scale(0,0),Laya.Tween.to(t,{scaleX:1,scaleY:1},200)},m.hideView=function(){this.view&&(this.view.visible=!1,this.view.removeSelf())},m._kfbossList=null,m.openIndex={},m}();e.BossTipCtrl=m}),define("src/g/boss/vo/BossInfos",["require","exports","src/g/index/ctrl/BossTipCtrl","../../../manager/RoleCenter","../../../utils/system/ServerLocal"],function(t,e,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function i(){}return i.setBossID=function(t,e){this.bossTipInfo[t]=e,o.ServerLocal.ins().bossTip=this.bossTipInfo,s.RoleCenter.instans.sendSetData(),e==this.nobosstip&&n.BossTipCtrl.setTipValue(t)},i.getBossID=function(t){return this.bossTipInfo[t]||i.defbosstip},i.getBossTipInfo=function(){return this.bossTipInfo},i.checkBossID=function(t){for(var e=0;e<t.length;e++){i.getBossID(t[e].bossid)==i.defbosstip&&2<e&&i.setBossID(t[e].bossid,i.nobosstip)}},i.setBossTipInfo=function(t){this.bossTipInfo=t},Object.defineProperty(i,"qmbossRemData",{set:function(t){this._qmbossRemData=t},enumerable:!0,configurable:!0}),Object.defineProperty(i,"shenbossRemData",{set:function(t){this._shenbossRemData=t},enumerable:!0,configurable:!0}),i.PA="a",i.PB="b",i.PC="c",i.PD="d",i.isAutoFight=!1,i.allpersonHp={},i.shenBossHp={},i.vipBossHp={},i.bosstip=2,i.nobosstip=1,i.defbosstip=0,i.qmcdTime=0,i.shencdTime=0,i.bossTipInfo={},i.allpersonBoss=[],i.shenBoss=[],i.vipboss=[],i.mjboss=[],i._qmbossRemData=[],i._shenbossRemData=[],i}();e.BossInfos=i}),define("src/g/openRing/vo/TeJieUtil",["require","exports","../../../utils/ItemUtils","../../../manager/RoleCenter","../../net/messages/sbkFormula","../../net/messages/PropFightMain","../../../meta/ZhanWenVo"],function(t,e,_,C,I,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.checkIsOpen=function(t){var e=C.RoleCenter.instans.vo.tejie,i=e.jihuoArr.indexOf(t);return i<0?0:e.jihuoArr[i+1]/100>>0},t.checkProgress=function(t){var e,i=_.ItemUtils.getTeJieTaskVoById(t),n=C.RoleCenter.instans.vo;if(-1<n.tejie.taskArr.indexOf(t)){if(i.need)return i.need;if(i.target)return i.target}switch(i.type){case 1:return n.lvl>=i.target?i.target:n.lvl;case 2:for(var s=0,o=0;o<n.heronum;o++){e=n.getOpenHeroByIdx(o);for(var a=0;a<e.equpos.length;a++){var r=e.equpos[a];if(r.equins&&0<r.equins.equtemplet&&r.equins.chengzhuang)(y=_.ItemUtils.getEquipVoById(r.equins.equtemplet))&&y.limit>=i.target&&s++}}return s>=i.need?i.need:s;case 3:var l=0;for(o=0;o<n.heronum;o++)(e=n.getOpenHeroByIdx(o)).heroWing.level>l&&(l=e.heroWing.level);return l>=i.target?i.target:l;case 4:return n.combat>=i.target?i.target:n.combat;case 5:var h=0;for(o=0;o<n.heronum;o++)(e=n.getOpenHeroByIdx(o)).heroWing.wingSuitLv>h&&(h=e.heroWing.wingSuitLv);return h>=i.target?i.target:h;case 6:var c=0;for(o=0;o<n.heronum;o++)(e=n.getOpenHeroByIdx(o)).blessSuitLv>c&&(c+=e.heroWing.wingSuitLv);return c>=i.target?i.target:c;case 7:var u=0;for(o=0;o<n.heronum;o++)u+=(e=n.getOpenHeroByIdx(o)).zhuzai.getAllLv();return u>=i.target?i.target:u;case 8:return 1;case 9:for(var p=0,d=0;d<n.heronum;d++){e=n.getOpenHeroByIdx(d);var g=new b.PropZhanwen;for(o=0;o<e.zhanwen.zhanwenArr.length;o++){var v=e.zhanwen.zhanwenArr[o],f=w.ZhanWenStruct.Ins.getZhanWenVoByIvo(v.zhuanwentype,v.quality,v.lv);for(a=0;a<f.attr.length;a++)g[f.attr[a][0]]+=f.attr[a][1]}for(o=0;o<8;o++){var y=e.getPos(o),m=e.getEquipPos_MILTI(y.equpos,1)/I.sbkFormula.BASEDIV_VAL;g.HP+=(y.equins.HP||0)*m,g.ATT+=(y.equins.ATT||0)*m,g.PDEF+=(y.equins.PDEF||0)*m,g.SDEF+=(y.equins.SDEF||0)*m}p+=I.sbkFormula.calCombat(0,g.HP,g.ATT,g.PDEF,g.SDEF,0,0,0,0,0,0,0,0,0,0,g.FIXEDATT,0,g.FIXEDEF,0,0,0,0,0,0,0,0,0,0,0)}return p>=i.target?i.target:p}return 1},t.checkTask=function(t){var e,i=_.ItemUtils.getTeJieTaskVoById(t),n=C.RoleCenter.instans.vo;if(-1<n.tejie.taskArr.indexOf(t))return 2;switch(i.type){case 1:if(n.lvl>=i.target)return 1;break;case 2:for(var s=0,o=0;o<n.heronum;o++){e=n.getOpenHeroByIdx(o);for(var a=0;a<e.equpos.length;a++){var r=e.equpos[a];if(r.equins&&0<r.equins.equtemplet&&r.equins.chengzhuang)(v=_.ItemUtils.getEquipVoById(r.equins.equtemplet))&&v.limit>=i.target&&s++}}if(s>=i.need)return 1;break;case 3:for(o=0;o<n.heronum;o++)if((e=n.getOpenHeroByIdx(o)).heroWing.level>=i.target)return 1;break;case 4:if(n.combat>=i.target)return 1;break;case 5:for(o=0;o<n.heronum;o++)if((e=n.getOpenHeroByIdx(o)).heroWing.wingSuitLv>=i.target)return 1;break;case 6:var l=0;for(o=0;o<n.heronum;o++)l+=(e=n.getOpenHeroByIdx(o)).blessSuitLv;if(l>=i.target)return 1;break;case 7:var h=0;for(o=0;o<n.heronum;o++)h+=(e=n.getOpenHeroByIdx(o)).zhuzai.getAllLv();if(h>=i.target)return 1;break;case 8:return 1;case 9:for(var c=0,u=0;u<n.heronum;u++){e=n.getOpenHeroByIdx(u);var p=new b.PropZhanwen;for(o=0;o<e.zhanwen.zhanwenArr.length;o++){var d=e.zhanwen.zhanwenArr[o],g=w.ZhanWenStruct.Ins.getZhanWenVoByIvo(d.zhuanwentype,d.quality,d.lv);for(a=0;a<g.attr.length;a++)p[g.attr[a][0]]+=g.attr[a][1]}for(o=0;o<8;o++){var v=e.getPos(o),f=e.getEquipPos_MILTI(v.equpos,1)/I.sbkFormula.BASEDIV_VAL;p.HP+=(v.equins.HP||0)*f,p.ATT+=(v.equins.ATT||0)*f,p.PDEF+=(v.equins.PDEF||0)*f,p.SDEF+=(v.equins.SDEF||0)*f}c+=I.sbkFormula.calCombat(0,p.HP,p.ATT,p.PDEF,p.SDEF,0,0,0,0,0,0,0,0,0,0,p.FIXEDATT,0,p.FIXEDEF,0,0,0,0,0,0,0,0,0,0,0)}if(c>=i.target)return 1}return 0},t}();e.TeJieUtil=i}),define("src/g/index/view/Ring4index",["require","exports","src/g/accessctrl/AccessCenter","src/init/Switches","../../../enum/EventName","../../../core/E","../../../config/GameConfig","../../../manager/RoleCenter","src/g/clearRes/ClearResM","src/g/openRing/vo/TeJieUtil","src/g/Effects/UIEffectsFactory","../../../vo/RedDot/RedDot_RingOpen"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t.nowAchId=0,t.addEvent(),t.updVisible(i.AccessCenter.ins.checkOpen(11)),t.visible||i.AccessCenter.ins.on(11,t,t.updateAccessHandler),t.refreshView(),t}return __extends(t,e),t.prototype.updateAccessHandler=function(){this.updVisible(i.AccessCenter.ins.checkOpen(11)),this.visible&&i.AccessCenter.ins.off(11,this,this.updateAccessHandler)},t.prototype.updVisible=function(t){this.visible=t,o.E.ins.event(s.EventName.RING_STAUTS_CHANGED,this.visible)},t.prototype.addEvent=function(){this.on(Laya.Event.CLICK,this,this.onOpenRingView),o.E.ins.on(s.EventName.RINGOPEN_TASK_REFRESH,this,this.refreshView)},t.prototype.refreshView=function(){var t=r.RoleCenter.instans.vo;a.GameConfig.commonJson.tejienum.value;for(var e in a.GameConfig.openRing){var i=a.GameConfig.openRing[e],n=t.tejie.jihuoArr.indexOf(i.id);if(!(-1<n&&200==t.tejie.jihuoArr[n+1])){this.nowAchId=i.id;break}}this.refreshIcon(),this.refreshEffect(),this.refreshBar()},t.prototype.refreshBar=function(){var t=a.GameConfig.openRing[this.nowAchId],e=a.GameConfig.ringtask[t.taskID[1]],i=h.TeJieUtil.checkTask(e.id),n=h.TeJieUtil.checkProgress(e.id);this.img_.skin="res/index1/rtasktitle_"+e.id+".png",2==i?this.setBar(0,0,!1):this.setBar(n,e.need)},t.prototype.setBar=function(t,e,i){if(void 0===i&&(i=!0),i){var n=t;0==e&&(e=1);var s=this.bar_nar.width/e*n;s=0==s?1:s,this.bar_pan.width=s}else this.box_bar.visible=!1},t.prototype.refreshEffect=function(){this._ani||(this._ani=c.UIEffectsFactory.Ins.createAndCenter(this.aniSp,41,!0,1,1)),this._ani.visible=u.RedDot_RingOpen.Ins.red},t.prototype.refreshIcon=function(){var t=a.GameConfig.openRing[this.nowAchId];if(t){var e="dynamic/tejie/"+t.icon+".png";this.img_icon.skin=e,l.ClearResM.setCachUrl(e)}},t.prototype.onOpenRingView=function(){n.Switches.ins.event(11)},t}(ui.index.Ring4IndexUI);e.Ring4Index=p});define("src/g/fightactivity/view/ActivityBtn",["require","exports","src/init/Switches","src/g/accessctrl/AccessCenter","../../../core/E","../../../enum/EventName","src/g/fightactivity/ctrl/FightActivityCtrl","../../../manager/GameSocketManager","../../net/messages/GetSvrTimeGS2C","../../../utils/system/ServerTime","../../../utils/system/DateUitl","src/init/TextConst","src/g/clearRes/ClearResM"],function(t,e,n,s,o,a,g,r,l,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t.visible=!1,t.startAct(""),t.checkOpen(),t.on(Laya.Event.CLICK,t,t.clickHandler);var e=o.E.ins;return e.on(a.EventName.openAct,t,t.startAct),e.on(a.EventName.GAME_RESTART,t,t.restart),e.on(a.EventName.PLAY_TYPE_CHANGED,t,t.checkOpen),r.GSM.ins.on(l.GetSvrTimeGS2C.KEY,t,t.restart),t}return __extends(t,i),t.prototype.restart=function(){this.startAct(""),this.checkOpen()},t.prototype.checkOpen=function(){s.AccessCenter.ins.checkOpen(195)&&(this.visible=!0)},t.prototype.startAct=function(t){var e,i=this.descTime,n=this.ac_icon,s=this.descIcon,o="res/huodong/",a="dynamic2/uieffect/EUI1_110.json",r="dynamic2/uieffect/EUI1_111.json";if(t)this.ani_ani.play(),n.skin=t,this.ani_ani.source=a,this.huan_.source=r,this.tip.visible=!0,i.visible=!1,t==o+"shijie.png"?e=o+"huodong_wenzi_005.png":t==o+"zhuansheng.png"?e=o+"huodong_wenzi_006.png":t==o+"shacheng.png"?e=o+"huodong_wenzi_001.png":t==o+"paodian.png"?e=o+"huodong_wenzi_004.png":t==o+"yezhan.png"?e=o+"huodong_wenzi_002.png":t==o+"dati.png"?e=o+"huodong_wenzi_003.png":t==o+"shenweiyu.png"&&(e=o+"huodong_wenzi_008.png"),s.skin=e;else{i.visible=!0,this.tip.visible=!1,this.ani_ani.stop(),this.ani_ani.source=" ",this.huan_.source=" ",m.ClearResM.clearUrl(a),m.ClearResM.clearUrl(r);var l=f.DateUtil.getKFDay(),h=new Date(v.ServerTime.adjustAreaMS(1e3*v.ServerTime.serverTime)),c=h.getDay(),u=g.FightActivityCtrl.getLastActByDay(c,l);if(u){var p=u.startTime;this.showIconById(u.id),i.color="#00ff1b",i.text=y.TextConst.get(476,p[0]<10?"0"+p[0]:p[0],p[1]<10?"0"+p[1]:p[1])}else{var d=0;6!=c&&(d=c+1),h.setHours(24),h.setMinutes(0),h.setSeconds(0),h.setMilliseconds(0),u=g.FightActivityCtrl.getLastActByDay(d,l+1,h.getTime()),1==l&&u?(i.color="#ff0f15",i.text=y.TextConst.get(474),this.showIconById(u.id)):(i.color="#ff0f15",i.text=y.TextConst.get(475),s.skin=o+"huodong_wenzi_007.png")}}m.ClearResM.resetViewImg(this)},t.prototype.showIconById=function(t){var e,i,n="res/huodong/";switch(t){case 1:i=n+"shijie.png",e=n+"huodong_wenzi_005.png";break;case 2:i=n+"zhuansheng.png",e=n+"huodong_wenzi_006.png";break;case 3:i=n+"shacheng.png",e=n+"huodong_wenzi_001.png";break;case 4:i=n+"paodian.png",e=n+"huodong_wenzi_004.png";break;case 5:i=n+"yezhan.png",e=n+"huodong_wenzi_002.png";break;case 6:i=n+"shenweiyu.png",e=n+"huodong_wenzi_008.png"}this.ac_icon.skin=i,this.descIcon.skin=e},t.prototype.clickHandler=function(){n.Switches.ins.event(191)},t}(ui.index.ActivityBtnUI);e.ActivityBtn=i}),define("src/g/index/ctrl/RightListViewCtrl",["require","exports","../../../utils/SoundUtils","../../../core/E","../../../enum/EventName","src/init/Switches","src/g/accessctrl/AccessCenter","../../../manager/GuideCenter","../../../enum/GuideTargetName","../../../manager/LayerManager","src/g/index/ctrl/BossTipCtrl","src/g/fightactivity/view/ActivityBtn"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(){function t(t){this.view=t,c.BossTipCtrl.setupView(),t.addChild(new u.ActivityBtn),this.view.btn_boss.on(Laya.Event.CLICK,this,this.bossHandler),this.view.btn_copy.on(Laya.Event.CLICK,this,this.copyHandler),this.view.btn_pvp.on(Laya.Event.CLICK,this,this.openPvPHandler),this.view.bnt_play.on(Laya.Event.CLICK,this,this.playHandler),n.E.ins.on(s.EventName.OPEN_REVENGE,this,this.openRevenge),a.AccessCenter.ins.checkOpen(23)&&(this.view.new_boss.removeSelf(),this.view.new_boss=null),a.AccessCenter.ins.checkOpen(19)&&(this.view.new_play.removeSelf(),this.view.new_play=null),a.AccessCenter.ins.checkOpen(21)&&(this.view.new_pvp.removeSelf(),this.view.new_pvp=null),a.AccessCenter.ins.checkOpen(22)&&(this.view.new_copy.removeSelf(),this.view.new_copy=null),Laya.timer.frameOnce(2,this,function(){r.GuideCenter.ins.registerRaletAccessId(l.GuideTargetName.MAIN_COPY_BTN,22),r.GuideCenter.ins.registerGuideObject(l.GuideTargetName.MAIN_COPY_BTN,h.LayerManager.getMainGuideLayer()),r.GuideCenter.ins.registerRaletAccessId(l.GuideTargetName.MAIN_BOSS_BTN,23),r.GuideCenter.ins.registerGuideObject(l.GuideTargetName.MAIN_BOSS_BTN,h.LayerManager.getMainGuideLayer())})}return t.prototype.bossHandler=function(){i.SoundUtils.getInstance().playBtnsounds(),a.AccessCenter.ins.checkOpen(23,!0)&&(this.view.new_boss&&(this.view.new_boss.removeSelf(),this.view.new_boss=null),o.Switches.ins.event(23)),c.BossTipCtrl.setVisible(!1)},t.prototype.copyHandler=function(){a.AccessCenter.ins.checkOpen(22,!0)&&(this.view.new_copy&&(this.view.new_copy.removeSelf(),this.view.new_copy=null),n.E.ins.event(s.EventName.COMPTYPE_CLICK,l.GuideTargetName.MAIN_COPY_BTN),o.Switches.ins.event(22))},t.prototype.playHandler=function(){a.AccessCenter.ins.checkOpen(19,!0)&&(this.view.new_play&&(this.view.new_play.removeSelf(),this.view.new_play=null),o.Switches.ins.event(19))},t.prototype.openPvPHandler=function(){a.AccessCenter.ins.checkOpen(21,!0)&&(this.view.new_pvp&&(this.view.new_pvp.removeSelf(),this.view.new_pvp=null),o.Switches.ins.event(86),n.E.ins.event(s.EventName.COMPTYPE_CLICK,l.GuideTargetName.MAIN_PRACTICE_BTN))},t.prototype.openRevenge=function(){o.Switches.ins.event(89)},t}();e.RightListViewCtrl=p}),define("src/g/index/ctrl/FAQiBtnCtrl",["require","exports","src/g/index/ctrl/GameIndexCtrl","../../../utils/SoundUtils","src/init/Switches","../../../enum/EventName","../../../enum/GuideTargetName","../../../core/E","../../../manager/RoleCenter","../../../meta/HunYinVo","../../../config/GameConfig","../../net/messages/enumStatus","../../../utils/UIUtils","../../../manager/GuideCenter","../../../manager/LayerManager","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg","../../../utils/ItemUtils"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=function(){function t(){this._angle=90,this.view=i.GameIndexCtrl.idxView.btn_faqi,this.view.on(Laya.Event.CLICK,this,this.clickHandler),0==v.PlayManager.type?r.E.ins.once(o.EventName.PLAY_TYPE_CHANGED,this,this.init):this.init()}return t.prototype.init=function(){v.PlayManager.type==f.EPlayType.PLAYTYPE_NEWVILLAGE||v.PlayManager.type==f.EPlayType.PLAYTYPE_MAINCITY&&l.RoleCenter.instans.vo.newbee?r.E.ins.once(o.EventName.PLAY_TYPE_CHANGED,this,this.init):this.doInit()},t.prototype.doInit=function(){y.ItemUtils.getUIEffectsVoById(115);this.updateShow(),r.E.ins.on(o.EventName.HUNYIN_OPEN_JIE,this,this.updateShow),r.E.ins.on(o.EventName.AEGIS_TASK_DATA_CHANGED,this,this.onTaskChangedHandler),r.E.ins.on(o.EventName.HUN_YIN_TASK_DATA_CHANGED,this,this.onTaskChangedHandler),Laya.timer.frameOnce(2,this,this.registUIToGuide)},t.prototype.registUIToGuide=function(){var t=p.UIUtils.getGlobalBound(this.view.img_bg);t&&(d.GuideCenter.ins.registerInteractionArea(a.GuideTargetName.MAIN_JOINT_ATTACK_BTN,t),d.GuideCenter.ins.registerGuideObject(a.GuideTargetName.MAIN_JOINT_ATTACK_BTN,g.LayerManager.getMainGuideLayer()))},t.prototype.onTaskChangedHandler=function(t){t==this._taskId&&this.setProgress()},t.prototype.updateShow=function(){for(var t=l.RoleCenter.instans.vo.comboData,e=1,i=c.GameConfig.hunyin.length,n=1;n<=i&&(e=n,-1!=t.curHunYinJieArr.indexOf(e));)n++;this._hunyinId=e;var s=h.HeJiStruct.Ins.getHunYinVo(this._hunyinId);this.loadAni(e,this.view.ani,s.mainAniScale),this._taskId=s.taskId,this.setProgress()},t.prototype.setProgress=function(){var t=c.GameConfig.hunTask[this._taskId],e=l.RoleCenter.instans.vo.getHunTLTDataById(this._taskId),i=0;if(e)for(var n=0;n<e.curStatusArr.length;n++)e.curStatusArr[n]==u.enumStatus.yilingqu&&i++;var s=i/t.child.length*360+90;s!=this._angle&&this.setAngle(s)},t.prototype.setAngle=function(t){this._angle=t,this.view.sp_mask&&(this.view.sp_mask.graphics.clear(),this.view.sp_mask.graphics.drawPie(43.5,43.5,43.5,90,this._angle,"#ff0000"))},t.prototype.loadAni=function(t,n,s){void 0===s&&(s=1);var o="dynamic2/hunyin/"+h.HeJiStruct.Ins.getHunYinVo(t).id+"a.json";Laya.loader.load([{url:o,type:Laya.Loader.ATLAS}],Laya.Handler.create(this,function(){if(Laya.loader.getRes(o)){n.source=o;var t=Laya.loader.getRes(o).frames;for(var e in t)if(t[e]&&t[e].sourceSize){n.width=t[e].sourceSize.w,n.height=t[e].sourceSize.h;break}n.scale(s,s);var i=n.parent;n.x=(i.width-n.width*s)/2,n.y=(i.height-n.height*s)/2,n.interval=200,n.play(0)}}))},t.prototype.clickHandler=function(){n.SoundUtils.getInstance().playBtnsounds(),s.Switches.ins.event(63),r.E.ins.event(o.EventName.COMPTYPE_CLICK,a.GuideTargetName.MAIN_JOINT_ATTACK_BTN)},t}();e.FAQiBtnCtrl=m}),define("src/g/index/ctrl/BottmListViewCtrl",["require","exports","../../../core/E","../../../enum/EventName","../../../config/GameConfig","../../../manager/RoleCenter","../../../utils/SoundUtils","../../../manager/LayerManager","src/g/fight/osprite/SceneObjCtroller","src/g/index/ctrl/BtnSkiilCtrl","src/init/Switches","src/g/accessctrl/AccessCenter","../../../manager/NewRedHintsCenter","../../../enum/GuideTargetName","src/g/index/ctrl/GameIndexCtrl","src/g/index/ctrl/FAQiBtnCtrl","src/init/TextConst","src/g/guide/view/GuideTipDownView","../../../component/UDEffect","src/g/Effects/UIEffectsFactory"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(){function e(t){this._showLevel=-1,this._showExp=-1,this._showTotalExp=-1,this._targetExp=-1,this._addExpSpeed=10,this.ef=new m.UDEffect,this.view=t,new v.FAQiBtnCtrl;var e=Laya.Event.CLICK;t.btn_role.on(e,this,this.roleHandler),t.btn_bag.on(e,this,this.bagHandler),t.btn_forge.on(e,this,this.forgeHandler),t.btn_guild.on(e,this,this.openGuild),t.btn_growup.on(e,this,this.growUpHandler),t.btn_day.on(e,this,this.dayHandler),t.chongbtn.on(e,this,this.clickHandler),i.E.ins.on(n.EventName.ADDED_EXP,this,this.initExp),r.LayerManager.addBottom(this.view),new h.BtnSkiilCtrl(g.GameIndexCtrl.idxView.skillBox),this.initExp(),this.onHpChange(),i.E.ins.on(n.EventName.ROLE_HP_CHANGE,this,this.onHpChange),i.E.ins.on(n.EventName.CHANGECURRENCY,this,this.checkPet),i.E.ins.on(n.EventName.CLOSEALLWINDOWS,this,this.closeAll)}return e.prototype.closeAll=function(){r.LayerManager.isOpenGuild()||e.showSelect()},e.showSelect=function(t){var e,i=this.lastSelect;i&&((e=i.getChildByName("select"))&&(e.visible=!1));t&&(_.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t,24,1,1,"select"),(e=t.getChildByName("select")).visible=!0);this.lastSelect=t},e.prototype.clickHandler=function(){u.AccessCenter.ins.checkOpen(222)&&c.Switches.ins.event(222),this.removeGuideArrow()},e.prototype.initExp=function(t){if(t=t||s.GameConfig.playerJSON[1].exp__value,o.RoleCenter.instans.vo.lvl>=t.length)return this.view.exp_txt.changeText(f.TextConst.get(208)),void(this.view.progress.width=558);Laya.timer.callLater(this,this.setExpPro),this.checkPet()},e.prototype.checkPet=function(){u.AccessCenter.ins.checkOpen(222)?(i.E.ins.off(n.EventName.CHANGECURRENCY,this,this.checkPet),this.view.chongbtn.visible=!0,o.RoleCenter.instans.vo.petData.open?p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.chongwujihuo,!1):(p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.chongwujihuo,!0),this.addGuideArrow())):this.view.chongbtn.visible=!1},e.prototype.setExpPro=function(){var t=o.RoleCenter.instans.vo;-1==this._showLevel&&-1==this._showExp?(this._showLevel=t.lvl,this._showExp=t.EXP,this._showTotalExp=this.getLevelExp(t.lvl),this.calculateAddSpeed(),this.updateExpProcess(t.EXP,this._showTotalExp)):(t.lvl>this._showLevel?this._targetExp=this.getLevelExp(this._showLevel):this._targetExp=t.EXP,Laya.timer.frameLoop(1,this,this.updateExp,null,!0))},e.prototype.addGuideArrow=function(){this.isGuide||(Laya.timer.once(100,this,this.calllaterHandler),this.isGuide=!0)},e.prototype.calllaterHandler=function(){this._uEf&&(this._uEf.clear(),this._uEf=null),this._uEf=_.UIEffectsFactory.Ins.createUIAniById(24,!0),this._downview||(this._downview=new y.GuideTipDownView,this._downview.setTip(f.TextConst.get(969))),this._downview.x=this.view.width/2,this._uEf.x=this.view.width/2-this._uEf.width/2-5,this.view.addChild(this._uEf),this.view.addChild(this._downview),this.ef.effect(this._downview,20,300)},e.prototype.removeGuideArrow=function(){this._downview&&this._downview.removeSelf(),this._uEf&&this._uEf.removeSelf(),this.ef.clear()},e.prototype.updateExp=function(){this._showExp=this._showExp+this._addExpSpeed,this._showExp>this._targetExp&&(this._showExp=this._targetExp,o.RoleCenter.instans.vo.lvl>this._showLevel?(this._showLevel+=1,this._showTotalExp=this.getLevelExp(this._showLevel),this.calculateAddSpeed(),this._showExp=0,this._showLevel==o.RoleCenter.instans.vo.lvl?this._targetExp=o.RoleCenter.instans.vo.EXP:this._targetExp=this._showTotalExp):Laya.timer.clear(this,this.updateExp)),this.updateExpProcess(this._showExp,this._showTotalExp)},e.prototype.calculateAddSpeed=function(){this._addExpSpeed=Math.floor(this.getLevelExp(this._showLevel)/50),this._addExpSpeed<1&&(this._addExpSpeed=1)},e.prototype.getLevelExp=function(t){var e=e||s.GameConfig.playerJSON[1].exp__value;return e[t-1]},e.prototype.updateExpProcess=function(t,e){this.view.exp_txt.changeText(t+"/"+e),this.view.progress.width=t/e*1100},e.prototype.roleHandler=function(t){e.showSelect(t.currentTarget),a.SoundUtils.getInstance().playBtnsounds(),c.Switches.ins.event(40),i.E.ins.event(n.EventName.COMPTYPE_CLICK,d.GuideTargetName.MAIN_ROLE_BTN)},e.prototype.dayHandler=function(t){a.SoundUtils.getInstance().playBtnsounds(),c.Switches.ins.event(18)&&e.showSelect(t.currentTarget),i.E.ins.event(n.EventName.COMPTYPE_CLICK,d.GuideTargetName.MAIN_PRACTICE_BTN)},e.prototype.growUpHandler=function(t){e.showSelect(t.currentTarget),a.SoundUtils.getInstance().playBtnsounds(),c.Switches.ins.event(27)},e.prototype.bagHandler=function(t){e.showSelect(t.currentTarget),a.SoundUtils.getInstance().playBtnsounds(),c.Switches.ins.event(30)},e.prototype.forgeHandler=function(t){e.showSelect(t.currentTarget),a.SoundUtils.getInstance().playBtnsounds(),c.Switches.ins.event(28),i.E.ins.event(n.EventName.COMPTYPE_CLICK,d.GuideTargetName.MAIN_FORGE_BTN)},e.prototype.openGuild=function(t){a.SoundUtils.getInstance().playBtnsounds(),c.Switches.ins.event(31)&&e.showSelect(t.currentTarget)},e.prototype.onHpChange=function(){var t=l.SceneObjCtroller.ins.getSelfGroup();if(t){var e=t.getPercentCountHp();isNaN(e)&&(e=0),this.view.hong_eff.y=this.view.hp_bian.y=this.view.hp_mask.y=this.view.hp_mask.height*(1-e)+2,this.view.hong_eff.y-=6;var i=1;e<.95&&(i=.66),e<.65&&(i=.33),e<.33&&(i=.01),this.view.lan_eff.y=this.view.mp_bian.y=this.view.mp_mask.y=this.view.mp_mask.height*(1-i)+2,this.view.lan_eff.y-=6}},e}();e.BottmListViewCtrl=C}),define("src/g/index/view/ChangeBtnView",["require","exports","src/g/fight/osprite/play/PlayManager","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../../manager/LayerManager","../../../manager/StateManger","../../net/messages/ChangeSceneMsg","src/g/accessctrl/AccessCenter","src/g/fight/osprite/play/MainCityManager","src/g/index/ctrl/GameIndexCtrl","../../../utils/UIUtils","../../../manager/GuideCenter","../../../enum/GuideTargetName"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(){function t(t){this._view=t;var e=u.GameIndexCtrl.idxView.topbar;n.E.ins.on(s.EventName.PLAY_TYPE_CHANGED,this,this.changePlay),this._view.btn_back.on(Laya.Event.CLICK,this,this.backHandler),e.btn_zhucheng.on(Laya.Event.CLICK,this,this.goto_zhucheng),e.btn_field.on(Laya.Event.CLICK,this,this.hangupClick),this._view.visible=h.AccessCenter.ins.checkOpen(16),this._view.visible||h.AccessCenter.ins.on(16,this,this.updateAccessHandler),Laya.timer.frameOnce(2,this,this.registUIToGuide)}return t.prototype.registUIToGuide=function(){var t=u.GameIndexCtrl.idxView.topbar,e=p.UIUtils.getGlobalBound(t.btn_field);e&&(d.GuideCenter.ins.registerInteractionArea(g.GuideTargetName.MAIN_BACK_CITY_BTN,e),d.GuideCenter.ins.registerGuideObject(g.GuideTargetName.MAIN_BACK_CITY_BTN,a.LayerManager.getMainGuideLayer()))},t.prototype.updateAccessHandler=function(){this._view.visible=h.AccessCenter.ins.checkOpen(16),this._view.visible&&h.AccessCenter.ins.off(16,this,this.updateAccessHandler)},t.prototype.intoMainCity=function(){var t=this,e=u.GameIndexCtrl.idxView.topbar;e.btn_zhucheng.visible?(e.img_zi.skin="res/bottom/zhujiemian_huicheng_wenzi1.png",e.btn_zhucheng.visible=!0,e.btn_field.visible=!1):(e.btn_zhucheng.scaleX=0,e.btn_zhucheng.visible=!0,e.btn_zhucheng.mouseEnabled=!1,this.outPort(new Laya.Handler(this,function(){Laya.Tween.to(e.btn_zhucheng,{scaleX:1},200,null,new Laya.Handler(t,function(){e.img_zi.skin="res/bottom/zhujiemian_huicheng_wenzi1.png",e.btn_zhucheng.visible=!0,e.btn_zhucheng.mouseEnabled=!0}))})))},t.prototype.outPort=function(t){var e=u.GameIndexCtrl.idxView.topbar;e.btn_field.visible?(e.btn_field.scaleX=1,e.btn_field.mouseEnabled=!1,Laya.Tween.to(e.btn_field,{scaleX:0},200,null,new Laya.Handler(this,function(){e.btn_field.visible=!1,e.btn_field.mouseEnabled=!0,t.run()}))):t.run()},t.prototype.outMainCity=function(t){var e=u.GameIndexCtrl.idxView.topbar;e.btn_zhucheng.visible?(e.btn_zhucheng.scaleX=1,e.btn_zhucheng.mouseEnabled=!1,Laya.Tween.to(e.btn_zhucheng,{scaleX:0},200,null,new Laya.Handler(this,function(){e.btn_zhucheng.visible=!1,e.btn_zhucheng.mouseEnabled=!0,t.run()}))):t.run()},t.prototype.intoPort=function(){var t=this,e=u.GameIndexCtrl.idxView.topbar;e.btn_field.visible?(e.img_zi.skin="res/bottom/zhujiemian_huicheng_wenzi2.png",e.btn_zhucheng.visible=!1,e.btn_field.visible=!0):(e.btn_field.scaleX=0,e.btn_field.visible=!0,e.btn_field.mouseEnabled=!1,this.outMainCity(new Laya.Handler(this,function(){Laya.Tween.to(e.btn_field,{scaleX:1},200,null,new Laya.Handler(t,function(){e.img_zi.skin="res/bottom/zhujiemian_huicheng_wenzi2.png",e.btn_field.visible=!0,e.btn_field.mouseEnabled=!0}))})))},t.prototype.changePlay=function(){var t=u.GameIndexCtrl.idxView.topbar;switch(i.PlayManager.type){case l.EPlayType.PLAYTYPE_PORT:this._view.btn_back.visible=!1,this.intoMainCity();break;case l.EPlayType.PLAYTYPE_MAINCITY:this._view.btn_back.visible=!1,this.intoPort();break;case l.EPlayType.PLAYTYPE_PVP:case l.EPlayType.PLAYTYPE_COPYLADDER:case l.EPlayType.PLAYTYPE_MEETBOSS:case l.EPlayType.PLAYTYPE_PORT_LEVEL:case l.EPlayType.PLAYTYPE_HELPFIGHT:case l.EPlayType.PLAYTYPE_KFJJC:t.btn_field.visible=!1,this._view.btn_back.visible=!1,t.btn_zhucheng.visible=!1;break;default:t.btn_field.visible=!1,this._view.btn_back.visible=!0,t.btn_zhucheng.visible=!1}},t.prototype.backHandler=function(){this.okcalback()},t.prototype.okcalback=function(){n.E.ins.event(s.EventName.EXIT_BOSS_PLAYTYPE),a.LayerManager.fightLayer.popLayer.removeChildren(),a.LayerManager.fightLayer.effectLayer.removeChildren()},t.prototype.goto_zhucheng=function(){r.StateManger.isSpecialPlay()||o.RoleCenter.instans.self.newbee||h.AccessCenter.ins.checkOpen(1e3,!0)&&(c.MainCityManager.getInstance().ChangeToMainCity(),n.E.ins.event(s.EventName.COMPTYPE_CLICK,g.GuideTargetName.MAIN_BACK_CITY_BTN))},t.prototype.hangupClick=function(){o.RoleCenter.instans.self.newbee||h.AccessCenter.ins.checkOpen(1e3,!0)&&(c.MainCityManager.getInstance().ExitMainCity(),n.E.ins.event(s.EventName.COMPTYPE_CLICK,g.GuideTargetName.MAIN_BACK_CITY_BTN))},t}();e.ChangeBtnViewCtrl=v}),define("src/g/helper/view/Helper4Index",["require","exports","src/init/Switches","../../../core/E","../../../enum/EventName","src/g/helper/vo/HelperStruct","../../../vo/RedDot/RedDot_Helper","../../../manager/RoleCenter","src/g/Effects/UIEffectsFactory","src/init/GameEventDispatcher","../../../utils/RelicUtils","../../../component/StageRewardDlg"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";var p;Object.defineProperty(e,"__esModule",{value:!0}),(p=e.HelperEntranceType||(e.HelperEntranceType={}))[p.SHENQI=0]="SHENQI",p[p.HELPER=1]="HELPER";var d=function(e){function t(){var t=e.call(this)||this;return t.flag=!0,t.jumponceflag=!0,t.addEvent(),t.flag=!1,t.refreshView(),t.flag=!0,t}return __extends(t,e),t.prototype.addEvent=function(){this.on(Laya.Event.CLICK,this,this.openHelper),n.E.ins.on(s.EventName.HELPER_MSG_CHANGE,this,this.refreshView),h.GE.ins.on(10,this,this.setFlag),n.E.ins.on(s.EventName.RELIC_LITTLE_TARGET_SHOW_EFFECT,this,this.changeEffect)},t.prototype.setFlag=function(){this.jumponceflag=!0},t.prototype.getCurEnranceType=function(){var t=r.RoleCenter.instans.vo.Relic;return t.relicId>=t.startRelicID-1?1:0},t.prototype.openHelper=function(){switch(this.curEntranceType){case 1:i.Switches.ins.event(193,1);break;case 0:(new u.StageRewardDlg).popup()}},t.prototype.refreshView=function(){switch(this.curEntranceType=1,this.curEntranceType){case 1:this.refreshHelperView();break;case 0:this.refreshShenqiView()}},t.prototype.refreshHelperView=function(){a.RedDot_Helper.Ins.hasNext||this.checkCanRemoveSelf(),this.shenqi_des.text="",this.red_helper.visible=a.RedDot_Helper.Ins.red,a.RedDot_Helper.Ins.red?l.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.ani_flash,117):this.ani_flash.removeChildren();var t=o.HelperStruct.ins.getNextTargetId(r.RoleCenter.instans.vo.targetId),e=o.HelperStruct.ins.getTargetVoById(t);e&&(this.img_icon.skin="res/index1/"+e.mainIcon+".png",this.img_icon.scale(1,1),this.img_icon.x=37,this.img_icon.y=(e.mainIcon="mainIcon4")?27:31,a.RedDot_Helper.Ins.red?(this.lab_des.text="",this.lab_title.text="",this.img_canGet.visible=!0,window.enabledpay&&this.flag&&this.jumponceflag&&(this.jumponceflag=!1,this.openHelper())):(this.lab_des.text=e.desc2,this.lab_title.text=e.desc1,this.img_canGet.visible=!1,this.jumponceflag=!0))},t.prototype.refreshShenqiView=function(){var t=r.RoleCenter.instans.vo.Relic.nowRelicId,e=c.RelicUtils.getRelicVo(t);e&&(this.img_icon.pos(45,-6),this.img_icon.scale(.5,.5),this.img_icon.skin="dynamic/shenqi/"+e.imgIcon+".png",this.lab_title.text="",this.lab_des.text="",this.shenqi_des.text=e.name,n.E.ins.event(s.EventName.UPDATE_REDDOT,17))},t.prototype.changeEffect=function(t){t?l.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.ani_flash,117):this.ani_flash.removeChildren()},t.prototype.checkCanRemoveSelf=function(){this.off(Laya.Event.CLICK,this,this.openHelper),n.E.ins.off(s.EventName.HELPER_MSG_CHANGE,this,this.refreshView),h.GE.ins.off(10,this,this.setFlag),this.removeSelf()},t}(ui.index.helper4indexUI);e.Helper4Index=d}),define("src/g/moneyreward/view/MoneyRewardBar",["require","exports","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../net/messages/enumStatus","src/init/Switches","../../../config/GameConfig","../../../manager/NewRedHintsCenter","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t._state=0,t.updateUI(),i.E.ins.on(n.EventName.MONEY_REWARD_DATA_UPDATED,t,t.updateUI),t.on(Laya.Event.CLICK,t,t.onClickHandler),t}return __extends(t,e),t.prototype.updateState=function(t){if(this._state=0,t.subscribeDay<t.day)this._state=1;else if(t.subscribeDay>=t.day)if(t.status==o.enumStatus.weiwancheng)this._state=2;else if(t.status==o.enumStatus.kelingqu)this._state=3;else{if(t.subscribeDay<t.day+1)r.GameConfig.moneyRewardVoCfg[t.day+1]&&(this._state=4);else this._state=5}},t.prototype.updateUI=function(){var t=s.RoleCenter.instans.vo.moneyRewardData;if(t)if(this.updateState(t),l.NewRedHintsCenter.ins.setRedHintOpenOrClose(l.enumRedHints.money_reward,1==this._state||3==this._state||4==this._state),3<this._state)this.img_desc.skin="res/moneyreward/shangjin_zhujimian_wenzi2.png",4<this._state?this.lab_progress.changeText(h.TextConst.get(623)):this.lab_progress.changeText(h.TextConst.get(624));else if(this.img_desc.skin="res/moneyreward/shangjin_zhujimian_wenzi1.png",1==this._state)this.lab_progress.changeText(h.TextConst.get(624));else{var e=t.value,i=r.GameConfig.moneyRewardVoCfg[t.day];i&&(e=i.need);var n=Math.min(t.value,e);this.lab_progress.changeText("("+n+"/"+e+")")}},t.prototype.onClickHandler=function(){a.Switches.ins.event(218)},t}(ui.moneyreward.MoneyRewardBarUI);e.MoneyRewardBar=c}),define("src/g/activity/view/PetCamivalBar",["require","exports","../../../manager/RoleCenter","../../../config/GameConfig","../../../utils/MathUtils","../../../core/E","../../../enum/EventName","src/g/clearRes/ClearResM"],function(t,e,l,h,c,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.showPage=function(t){this._activityId=t,this.findBoxUid(),this.updateProgerss(),i.E.ins.on(n.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),s.ClearResM.resetViewImg(this),s.ClearResM.addCachUrl(this.img_desc.skin),s.ClearResM.addCachUrl(this.img_progress.skin),s.ClearResM.addCachUrl(this.img_progress_bg.skin)},e.prototype.hidePage=function(){i.E.ins.off(n.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),s.ClearResM.delCachUrl(this.img_desc.skin),s.ClearResM.delCachUrl(this.img_progress.skin),s.ClearResM.delCachUrl(this.img_progress_bg.skin)},e.prototype.onActivityDataChanged=function(t,e){e==this._boxActUid&&this.updateProgerss()},e.prototype.findBoxUid=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t)for(var e,i=t.children.length,n=0;n<i;){if(e=t.children[n],0==h.GameConfig.subActivityJson[e.cfgId].childId){this._boxActUid=e.childCountArr[0];break}n++}},e.prototype.updateProgerss=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._boxActUid);if(t){var e,i,n=t.children.length,s=0,o=0;for(this._progressArr=[0];s<n;)e=t.children[s],i=h.GameConfig.subActivityJson[e.cfgId],this._progressArr.push(i.value),o=i.value>o?i.value:o,s++;var a=Math.min(o,t.allData.allCount);if(this._progressArr){var r=c.MathUtils.sectionProgress(this._progressArr,a);this.box_progress.scrollRect=new Laya.Rectangle(0,0,this.box_progress.width*r,this.box_progress.height)}}},e}(ui.activity.PetCamivalBarUI);e.PetCamivalBar=o}),define("src/g/activity/ctrl/PetCamivalBarCtrl",["require","exports","src/g/activity/view/PetCamivalBar","../../../utils/SoundUtils","src/init/Switches","../../../manager/ActivityManager","src/g/accessctrl/AccessCenter","../../../enum/ActivityTemplate","../../../core/E","../../../enum/EventName","../../../config/GameConfig","../../../manager/RoleCenter"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(){function t(){this._weight=0,this._clientkey=r.ActivityTemplateKey.pet_camival,this.accessId=225}return t.prototype.init=function(t,e,i){this._baseWeight=t,this._addWeight=e,this._weightChangedBack=i,this.initHandler()},t.prototype.getWeight=function(){return this._weight},t.prototype.showPage=function(t){this._bar||(this._bar=new i.PetCamivalBar,this._bar.on(Laya.Event.CLICK,this,this.toOpenViewFun)),this.actEntity&&this._bar.showPage(this.actEntity.id),t.addChild(this._bar)},t.prototype.hidePage=function(){this._bar&&(this._bar.removeSelf(),this._bar.hidePage())},t.prototype.initHandler=function(){this.accessId&&!a.AccessCenter.ins.checkOpen(this.accessId)?(this._weight=0,a.AccessCenter.ins.on(this.accessId,this,this.onActivityAccessUpdate)):this.doInit()},t.prototype.onActivityAccessUpdate=function(){a.AccessCenter.ins.checkOpen(this.accessId)&&(a.AccessCenter.ins.off(this.accessId,this,this.onActivityAccessUpdate),this.doInit())},t.prototype.doInit=function(){if(this.accessId&&this._clientkey){if(this.actEntity=o.ActivityManager.ins.getActivityByClientkey(this._clientkey),this.actEntity){if(this.actEntity.on(o.ActivityEntity.ACTIVITY_ENTITY_CHANGED,this,this.calWeight),this.actEntity.on(o.ActivityEntity.ACTIVITY_ENTITY_DESTROY,this,this.onDestroy),l.E.ins.on(h.EventName.ACTIVITY_RED_UPDATE,this,this.onActivityRedUpdata),this._bar){var t=u.RoleCenter.instans.vo.getActivity1Data(this.actEntity.id);t&&(this._bar.img_red.visible=t.hasRed)}}else l.E.ins.on(h.EventName.ACTIVITY_DATA_ADDED,this,this.onActivityAdded);this.calWeight()}},t.prototype.onDestroy=function(){this.actEntity&&(this.actEntity.off(o.ActivityEntity.ACTIVITY_ENTITY_CHANGED,this,this.calWeight),this.actEntity.off(o.ActivityEntity.ACTIVITY_ENTITY_DESTROY,this,this.onDestroy),this.actEntity=null),l.E.ins.off(h.EventName.ACTIVITY_RED_UPDATE,this,this.onActivityRedUpdata),l.E.ins.off(h.EventName.ACTIVITY_DATA_ADDED,this,this.onActivityAdded),this.doInit()},t.prototype.onActivityRedUpdata=function(t){if(this._bar&&this.actEntity&&t==this.actEntity.id){var e=u.RoleCenter.instans.vo.getActivity1Data(t);e&&(this._bar.img_red.visible=e.hasRed),this.calWeight()}},t.prototype.onActivityAdded=function(t,e,i){var n=c.GameConfig.activityJson[t];n&&n.clientkey==this._clientkey&&(l.E.ins.off(h.EventName.ACTIVITY_DATA_ADDED,this,this.onActivityAdded),Laya.timer.frameOnce(2,this,this.doInit))},t.prototype.calWeight=function(){var t=0;if(this.actEntity&&this.actEntity.isActive){t+=this._baseWeight;var e=u.RoleCenter.instans.vo.getActivity1Data(this.actEntity.id);e&&e.hasRed&&(t+=this._addWeight)}this._weight!=t&&(this._weight=t,this._weightChangedBack&&this._weightChangedBack.run())},t.prototype.toOpenViewFun=function(){n.SoundUtils.getInstance().playBtnsounds(),s.Switches.ins.event(this.accessId,[!0,!0,this.actEntity.id])},t}();e.PetCamivalBarCtrl=p}),define("src/g/helper/ctrl/Helper4IndexCtrl",["require","exports","src/g/helper/view/Helper4Index","../../../manager/RunTimeUIManager","../../../vo/RedDot/RedDot_Helper","../../../manager/NewRedHintsCenter","../../../core/E","../../../enum/EventName","src/g/accessctrl/AccessCenter"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function t(){this._weight=0,this.accessId=151}return t.prototype.init=function(t,e,i){this._baseWeight=t,this._addWeight=e,this._weightChangedBack=i,this.initHandler()},t.prototype.getWeight=function(){return this._weight},t.prototype.showPage=function(t){this._bar||(this._bar=new i.Helper4Index,n.RunTimeUIManager.ins.registerUI(193,this._bar)),t.addChild(this._bar)},t.prototype.hidePage=function(){this._bar&&this._bar.removeSelf()},t.prototype.initHandler=function(){this.accessId&&!l.AccessCenter.ins.checkOpen(this.accessId)?(this._weight=0,l.AccessCenter.ins.on(this.accessId,this,this.onActivityAccessUpdate)):this.doInit()},t.prototype.onActivityAccessUpdate=function(){l.AccessCenter.ins.checkOpen(this.accessId)&&(l.AccessCenter.ins.off(this.accessId,this,this.onActivityAccessUpdate),this.doInit())},t.prototype.doInit=function(){s.RedDot_Helper.Ins.hasNext&&(o.NewRedHintsCenter.ins.on(o.enumRedHints.helper,this,this.calWeight),a.E.ins.on(r.EventName.HELPER_MSG_CHANGE,this,this.calWeight),this.calWeight())},t.prototype.calWeight=function(t){void 0===t&&(t=!1);var e=0;s.RedDot_Helper.Ins.hasNext?(e+=this._baseWeight,o.NewRedHintsCenter.ins.checkRedIsOpen(o.enumRedHints.helper)&&(e+=this._addWeight)):(a.E.ins.off(r.EventName.HELPER_MSG_CHANGE,this,this.calWeight),o.NewRedHintsCenter.ins.off(o.enumRedHints.helper,this,this.calWeight)),this._weight!=e&&(this._weight=e,!t&&this._weightChangedBack&&this._weightChangedBack.run())},t}();e.Helper4IndexCtrl=h}),define("src/g/moneyreward/ctrl/MoneyRewardBarCtrl",["require","exports","src/g/moneyreward/view/MoneyRewardBar","../../../manager/RoleCenter","../../../enum/EventName","../../../core/E"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){this._weight=0}return t.prototype.init=function(t,e,i){this._baseWeight=t,this._addWeight=e,this._weightChangedBack=i,this.initHandler()},t.prototype.getWeight=function(){return this._weight},t.prototype.showPage=function(t){this._bar||(this._bar=new i.MoneyRewardBar),t.addChild(this._bar)},t.prototype.hidePage=function(){this._bar&&this._bar.removeSelf()},t.prototype.initHandler=function(){o.E.ins.on(s.EventName.MONEY_REWARD_DATA_UPDATED,this,this.calWeight),this.calWeight(!0)},t.prototype.calWeight=function(t){void 0===t&&(t=!1);var e=0;n.RoleCenter.instans.vo.moneyRewardData&&(e+=this._baseWeight),this._weight!=e&&(this._weight=e,!t&&this._weightChangedBack&&this._weightChangedBack.run())},t}();e.MoneyRewardBarCtrl=a}),define("src/g/index/ctrl/UpperLeftBarCtrl",["require","exports","src/g/activity/ctrl/PetCamivalBarCtrl","src/g/helper/ctrl/Helper4IndexCtrl","src/g/moneyreward/ctrl/MoneyRewardBarCtrl"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t){this._container=t,this.ctrlList=[new i.PetCamivalBarCtrl,new s.MoneyRewardBarCtrl,new n.Helper4IndexCtrl]}return t.prototype.init=function(){for(var t=this.ctrlList.length,e=0;e<t;)this.ctrlList[e].init(t-e,100,new Laya.Handler(this,this.onWeightChangedHandler)),e++;this.onWeightChangedHandler()},t.prototype.onWeightChangedHandler=function(){for(var t=this.ctrlList.length,e=0,i=0,n=0,s=null;e<t;)0<(n=this.ctrlList[e].getWeight())&&i<n&&(i=n,s=this.ctrlList[e]),e++;s!=this._currCtrl&&(this._currCtrl&&this._currCtrl.hidePage(),this._currCtrl=s,this._currCtrl&&this._currCtrl.showPage(this._container))},t}();e.UpperLeftBarCtrl=o}),define("src/g/index/ctrl/LeftListViewCtrl",["require","exports","../../../enum/EventName","../../../core/E","../../../manager/RoleCenter","../../../utils/SoundUtils","src/g/accessctrl/AccessCenter","src/init/Switches","../../../vo/RedDot/RedDot_Friend","../../../manager/NewRedHintsCenter","src/g/index/ctrl/GameIndexCtrl","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg","src/g/index/ctrl/UpperLeftBarCtrl"],function(t,e,n,s,o,i,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(){function t(){this._hideSec=0,this._disSec=0,this.openOne=!1,this.openTwo=!1}return t.prototype.init=function(t,e){this.view=t,this.indexView=e,this.openNewHeroCheck(),s.E.ins.on(n.EventName.OPENNEW_HERO,this,this.openNewHeroCheck),s.E.ins.on(n.EventName.RED_MAIL_UPDATE,this,this.mail_redHandler),a.AccessCenter.ins.checkOpen(1)||a.AccessCenter.ins.on(1,this,this.onAccess_inited);var i=Laya.Event.CLICK;e.btn_friend.on(i,this,this.friendHandler),e.btn_mail.on(i,this,this.mailHandler),e.btn_mail.x=e.btn_mail.y=0,this.mail_redHandler(),e.btn_share_first.on(i,this,this.firstShareHandler),e.btn_share_activity.on(i,this,this.shareActivityHandler),s.E.ins.on("UPDATE_FIRSTSHARE_STATE",this,this.firstShareRvHandler),this.checkFirstShare(),h.NewRedHintsCenter.ins.on(h.NewRedHintsCenter.RED_HINT_VALUE_CHANGED,this,this.onFriendRedChange),this.onFriendRedChange(h.enumRedHints.friend),a.AccessCenter.ins.checkOpen(104)||a.AccessCenter.ins.on(13,this,this.onAccessChangedHandler,[104]),this.upperLeftBar=new d.UpperLeftBarCtrl(t),this.upperLeftBar.init()},t.instance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.onFriendRedChange=function(t){var e=this;if(3<=o.RoleCenter.instans.vo.heronum&&this.indexView&&(this.indexView.btn_friend.removeSelf(),this.indexView.btn_friend.event(n.EventName.UI_REMOVE_STAGE)),t==h.enumRedHints.friend&&l.RedDot_Friend.Ins.red_all){var i;if(i=1==o.RoleCenter.instans.vo.heronum,this.indexView.friend_prompt.skin="res/unpack/"+(i?"zhujiemian_guanggaotishi1":"zhujiemian_guanggaotishiVIP4")+".png",i){if(this.openOne)return void(this.indexView.friend_prompt.visible=!1);this.indexView.friend_prompt.visible=!0,this.indexView.btn_friend.once(Laya.Event.CLICK,this,function(){e.openOne=!0,e.indexView.friend_prompt.visible=!1}),this.indexView.friend_prompt.once(Laya.Event.CLICK,this,function(){e.openOne=!0,e.indexView.friend_prompt.visible=!1})}else{if(this.openTwo)return void(this.indexView.friend_prompt.visible=!1);this.indexView.friend_prompt.visible=!0,this.indexView.friend_prompt.once(Laya.Event.CLICK,this,function(){e.openTwo=!0,e.indexView.friend_prompt.visible=!1}),this.indexView.btn_friend.once(Laya.Event.CLICK,this,function(){e.openTwo=!0,e.indexView.friend_prompt.visible=!1})}}else t==h.enumRedHints.friend&&(this.indexView.friend_prompt.visible=!1)},t.prototype.onAccessChangedHandler=function(t,e){104==t&&this.openNewHeroCheck(),104==t&&this.onFriendRedChange(h.enumRedHints.friend)},t.prototype.onAccess_inited=function(){a.AccessCenter.ins.checkOpen(1)&&(a.AccessCenter.ins.off(1,this,this.onAccess_inited),this.mail_redHandler())},t.prototype.playTypeChanged=function(){this.mail_redHandler()},t.prototype.mailHandler=function(){i.SoundUtils.getInstance().playBtnsounds(),r.Switches.ins.event(1)},t.prototype.mail_redHandler=function(){var t=a.AccessCenter.ins.checkOpen(1),e=c.GameIndexCtrl.idxView;e.red_mail.visible=o.RoleCenter.instans.vo.mailData.isHave,e.btn_mail.visible=o.RoleCenter.instans.vo.mailData.isHave&&t,t&&o.RoleCenter.instans.vo.mailData.isHave&&(u.PlayManager.type==p.EPlayType.PLAYTYPE_PORT||u.PlayManager.type==p.EPlayType.PLAYTYPE_MAINCITY||u.PlayManager.type==p.EPlayType.PLAYTYPE_NEWVILLAGE)?e.bag_con.addChild(e.btn_mail):e.btn_mail.removeSelf()},t.prototype.openNewHeroCheck=function(){2<o.RoleCenter.instans.vo.heronum&&(this.indexView.btn_friend.removeSelf(),this.indexView.btn_friend.event(n.EventName.UI_REMOVE_STAGE))},t.prototype.friendHandler=function(){i.SoundUtils.getInstance().playBtnsounds(),r.Switches.ins.event(15)},t.prototype.firstShareHandler=function(){i.SoundUtils.getInstance().playBtnsounds(),r.Switches.ins.event(260)},t.prototype.shareActivityHandler=function(){i.SoundUtils.getInstance().playBtnsounds(),r.Switches.ins.event(255)},t.prototype.checkFirstShare=function(){var t=a.AccessCenter.ins.checkOpen(260),e=o.RoleCenter.instans.vo.shareData.hasGetFirstReward;t&&1==e&&(this.indexView.btn_share_first.removeSelf(),this.indexView.btn_share_first.event(n.EventName.UI_REMOVE_STAGE))},t.prototype.firstShareRvHandler=function(){a.AccessCenter.ins.checkOpen(260)&&(this.indexView.btn_share_first.removeSelf(),this.indexView.btn_share_first.event(n.EventName.UI_REMOVE_STAGE))},t}();e.LeftListViewCtrl=g}),define("src/g/chat/view/ChatPreview",["require","exports","src/g/chat/ctrl/ChatContentManager","../../net/messages/chat/ChatGS2C","../../../core/E","../../../enum/EventName","../../../utils/SoundUtils","../../net/messages/chat/ChatC2GS","src/init/Switches","../../../config/GameConfig","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","../../../manager/LayerManager","../../../utils/UIUtils","src/init/TextConst","src/g/chat/view/ChatLabel"],function(t,e,i,r,s,o,n,a,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(e){function t(){var t=e.call(this)||this;return t._widthChat=400,t._pool=[],t._allCount=0,t._privateCount=0,t._showMaxCount=3,t.expInited=!1,t._isScrolling=!1,t._timesend=0,t._widthChat=t.con_all.width,s.E.ins.on(o.EventName.CHAT_CONTENT_ADDED,t,t.appendContent),s.E.ins.on(o.EventName.ADD_PRIVATE_CHAT_CONTENT,t,t.appendPrivateContent),s.E.ins.on(o.EventName.DELETE_CHAT_CONTENT,t,t.onDelContent),s.E.ins.on(o.EventName.CHAT_CONTENT_BANED,t,t.onBanContent),t.con_all.on(Laya.Event.CLICK,t,t.chatHandler),t.con_private.on(Laya.Event.CLICK,t,t.chatPrivateHandler),t.btn_toFriend.on(Laya.Event.CLICK,t,t.switchExpShow),t.con_all.vScrollBarSkin="",t.con_all.vScrollBar.elasticDistance=50,Laya.timer.once(1e3,t,t.addDefultChat),t}return __extends(t,e),t.prototype.addDefultChat=function(){var t=new r.ChatGS2C;t.type=a.enumChatType.system,t.msg=g.TextConst.get(315),s.E.ins.event(o.EventName.SEND_UNREAL_CHAT,[t]),Laya.timer.once(1e3,this,function(){var t=new r.ChatGS2C;t.type=a.enumChatType.addIfNoMsg,t.msg=g.TextConst.get(316),s.E.ins.event(o.EventName.SEND_UNREAL_CHAT,[t])}),Laya.timer.once(2e3,this,function(){var t=new r.ChatGS2C;t.type=a.enumChatType.addIfNoMsg,t.msg=g.TextConst.get(317),s.E.ins.event(o.EventName.SEND_UNREAL_CHAT,[t])})},t.prototype._createHtmlTxt=function(){var t;return 0==this._pool.length?((t=new v.ChatLabel).width=this._widthChat,t.on(Laya.Event.LINK,this,this.onLinkHandler)):t=this._pool.pop(),t},t.prototype.onDelContent=function(t,e){if(t)for(var i=0;i<this._allCount;)this.con_all.getChildAt(i).cutChatContent(t),i++},t.prototype.onBanContent=function(t){for(var e,i=this._allCount-1;-1<i;)(e=this.con_all.getChildAt(i))&&e.usename==t&&(e=this.con_all.removeChildAt(i),this._allCount--,this._pool.push(e)),i--;this.relayout()},t.prototype.appendContent=function(t,e){var i=t.msg;if(e){var n=r.ChatGS2C.getIns();n.msg=e,n.job=t.job,n.sex=t.sex,n.nickname=t.nickname,n.username=t.username;for(var s=0;s<this._allCount;)(a=this.con_all.getChildAt(s)).content==i&&(n.type=t.type,a.setTextByMsg(n)),s++;return n.resetdata(),void n.clear()}var o,a=this._createHtmlTxt();a.setTextByMsg(t),this._allCount>=this._showMaxCount&&(o=this.con_all.removeChildAt(0),this._allCount--,this._pool.push(o)),this.con_all.addChild(a),this._allCount++,this.relayout()},t.prototype.relayout=function(){for(var t,e=0,i=2;e<this._allCount;)(t=this.con_all.getChildAt(e))&&(t.x=2,t.y=i+2,i+=Math.max(17,t.contextHeight)),e++;this.con_all.scrollTo(0,i-this.con_all.height+3)},t.prototype.appendPrivateContent=function(t){var e,i=this._createHtmlTxt();i.setTextByMsg(t),this._privateCount>=this._showMaxCount&&(e=this.con_private.removeChildAt(0),this._privateCount--,this._pool.push(e)),this.con_private.addChild(i),this._privateCount++;for(var n=0,s=2;n<this._privateCount;)(i=this.con_private.getChildAt(n))&&(i.x=2,i.y=s,s+=22),n++},t.prototype.onLinkHandler=function(t){i.ChatContentManager.onLinkHandler(t),this._evtIsHandled=!0},t.prototype.chatHandler=function(t){this._evtIsHandled?this._evtIsHandled=!1:(n.SoundUtils.getInstance().playBtnsounds(),l.Switches.ins.event(24))},t.prototype.chatPrivateHandler=function(){n.SoundUtils.getInstance().playBtnsounds(),l.Switches.ins.event(104)},t.prototype.initExpression=function(){this.p_content.hScrollBarSkin="",this.p_content.hScrollBar.elasticDistance=100,this.b_content.removeChildren();var t=d.UIUtils.getGlobalPos(this.b_biaoqing);this.b_biaoqing.x=t.x,this.b_biaoqing.y=t.y;var e,i,n=this.p_content.height,s=0,o=h.GameConfig.expression,a=1;for(var r in o)4==(e=o[r]).type&&(i=new Laya.Image("dynamic2/expression/"+e.res+".jpg"),a=e.height>n?n/e.height:1,i.width=e.width*a,i.height=e.height*a,i.x=s,s+=i.width+4,i.y=(n-i.height)/2,i.on(Laya.Event.CLICK,this,this.selectHandler,[e]),this.b_content.addChild(i));this.b_content.height=n,this.b_content.width=s,this.btn_page.on(Laya.Event.CLICK,this,this.doScroll),this.expInited=!0},t.prototype.doScroll=function(){var t=this;if(0==this._isScrolling&&0<this.p_content.hScrollBar.max){var e=0;e=-1==this.btn_page.scaleX?Math.max(0,this.p_content.hScrollBar.value-this.p_content.width):Math.min(this.p_content.hScrollBar.max,this.p_content.hScrollBar.value+this.p_content.width),this._isScrolling=!0,Laya.Tween.to(this.p_content.hScrollBar,{value:e},200,null,new Laya.Handler(this,function(){t._isScrolling=!1,t.resetBtnDir()}))}},t.prototype.resetBtnDir=function(){0==this.p_content.hScrollBar.value?this.btn_page.scaleX=1:this.p_content.hScrollBar.value==this.p_content.hScrollBar.max&&(this.btn_page.scaleX=-1)},t.prototype.switchExpShow=function(){this.b_biaoqing.visible?this.closeExp():this.openExp()},t.prototype.openExp=function(){this.expInited||this.initExpression(),this.p_content.hScrollBar.value=0,this.resetBtnDir(),this.b_biaoqing.visible=!0,p.LayerManager.addInHighUILayer(this.b_biaoqing)},t.prototype.closeExp=function(){this.b_biaoqing.visible=!1,this.b_biaoqing.removeSelf(),Laya.Tween.clearAll(this.p_content.hScrollBar),this._isScrolling=!1},t.prototype.selectHandler=function(t){var e=5,i=h.GameConfig.commonJson.quickChat;i&&(e=Number(i.value));var n=Math.ceil((Date.now()-this._timesend)/1e3);n<e?c.FE.upItems(g.TextConst.get(318,e-n),u.BubbleEnum.center):(this._timesend=Date.now(),s.E.ins.event(o.EventName.SEND_CHAT,[t.id,a.enumChatType.mapChat]),this.closeExp())},t}(ui.chat.ChatPreviewUI);e.ChatPreview=f}),define("src/g/index/ctrl/FlashSaleBtnCtrl",["require","exports","../../../enum/EventName","src/g/accessctrl/AccessCenter","../../../core/E","../../../enum/ActivityPos","../../../manager/ActivityManager","../../../manager/RoleCenter","../../../config/GameConfig","src/init/Switches","../../../utils/SoundUtils","../../../utils/system/DateUitl","../../../utils/system/ServerTime","src/g/fight/osprite/play/PlayManager"],function(t,e,o,i,a,n,r,l,h,c,u,s,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(){function t(t,e){this._pos=n.ActivityPos.FLASH_SALE_HALL,this._opened=!1,this._currActivityId=0,this._limitLv=0,this._btn=t,this._cdLab=e,this._btn&&(this._btn.on(Laya.Event.CLICK,this,this.onOpHandler),this._parent=this._btn.parent),this._btn.visible=!0,this.init()}return t.prototype.onOpHandler=function(){this._currActivityId&&(u.SoundUtils.getInstance().playBtnsounds(),c.Switches.ins.event(164))},t.prototype.init=function(){this._opened=!0,this._btn&&(this._btn.once(o.EventName.ON_UI_DESTROYED,this,this.doDestroy),i.AccessCenter.ins.checkOpen(164)?this.doInit():(this._btn.parent&&(this._btn.removeSelf(),this._btn.event(o.EventName.UI_REMOVE_STAGE)),i.AccessCenter.ins.on(164,this,this.onActivityAccessUpdate),this._opened=!1))},t.prototype.onActivityAccessUpdate=function(){i.AccessCenter.ins.checkOpen(164)&&(i.AccessCenter.ins.off(164,this,this.onActivityAccessUpdate),this.doInit())},t.prototype.doInit=function(){a.E.ins.on(o.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.onActivityHallChanged),this.updateBtnShow()},t.prototype.onActivityHallChanged=function(t){this._pos==t&&this.updateBtnShow()},t.prototype.updateBtnShow=function(){a.E.ins.off(o.EventName.PLAY_TYPE_CHANGED,this,this.changePlaytype);var t=!1,e=r.ActivityManager.ins.getActivityHallByPos(this._pos);if(e&&0<e.count){t=!0;var i=e.getActivatedIds();if(i&&0<i.length){this._currActivityId=i[0];var n=l.RoleCenter.instans.vo.getActivity1Data(this._currActivityId);if(n){var s=h.GameConfig.activityJson[n.cfgId];this._limitLv=Number(s.value),0<this._limitLv&&l.RoleCenter.instans.vo.getCurLv()<this._limitLv&&(a.E.ins.on(o.EventName.ADDED_LEVEL,this,this.onAddLvHandler),t=!1,this._opened=!1)}}}t?(this._parent&&(this._parent.addChild(this._btn),this._btn.event(o.EventName.UI_ADD_TO_STAGE)),this._opened||(this._currActivityId&&(d.PlayManager.canGoToFuben()?(u.SoundUtils.getInstance().playBtnsounds(),c.Switches.ins.event(164)):a.E.ins.on(o.EventName.PLAY_TYPE_CHANGED,this,this.changePlaytype)),this._opened=!0),this.updateCD()):(Laya.timer.clear(this,this.updateCD),this._btn.parent&&(this._btn.removeSelf(),this._btn.event(o.EventName.UI_REMOVE_STAGE)))},t.prototype.changePlaytype=function(){d.PlayManager.canGoToFuben()&&(a.E.ins.off(o.EventName.PLAY_TYPE_CHANGED,this,this.changePlaytype),u.SoundUtils.getInstance().playBtnsounds(),c.Switches.ins.event(164))},t.prototype.onAddLvHandler=function(){l.RoleCenter.instans.vo.getCurLv()>=this._limitLv&&(a.E.ins.off(o.EventName.ADDED_LEVEL,this,this.onAddLvHandler),this.updateBtnShow())},t.prototype.updateCD=function(){if(this._cdLab){var t=s.DateUtil.getZeroTime()-p.ServerTime.serverTime;this._cdLab.changeText(s.DateUtil.getHMS_countdown(t)),Laya.timer.once(1e3,this,this.updateCD)}},t.prototype.doDestroy=function(){this._btn=null,this._cdLab=null,this._parent=null,a.E.ins.off(o.EventName.ADDED_LEVEL,this,this.onAddLvHandler),i.AccessCenter.ins.off(164,this,this.onActivityAccessUpdate),a.E.ins.off(o.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.onActivityHallChanged)},t}();e.FlashSaleBtnCtrl=g}),define("src/g/index/ctrl/AdvanceNoticeBtnCtrl",["require","exports","../../../enum/ActivityPos","../../../utils/SoundUtils","src/init/Switches","src/g/accessctrl/AccessCenter","../../../enum/EventName","../../../core/E","../../../manager/ActivityManager","../../../manager/RoleCenter","../../../config/GameConfig","../../../utils/system/ServerTime","../../../utils/system/DateUitl","src/g/clearRes/ClearResM","../../../manager/RemoteStorage"],function(t,e,n,i,h,s,c,u,p,d,g,v,o,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e,i){this._pos=n.ActivityPos.ADVANCE_NOTICE_HALL,this._currActivityId=-1,this._limitLv=0,this._btn=t,this.defSkin=this._btn.skin,this._cdLab=e,this._effect=i,this._btn&&(this._btn.on(Laya.Event.CLICK,this,this.onOpHandler),this._parent=this._btn.parent),this._btn.visible=!0,this.init()}return t.prototype.onOpHandler=function(){if(this._currActivityId){var t=this._btn.getChildByName("img_red");t&&(t.visible=!1),this._effect&&(this._effect.visible=!1),i.SoundUtils.getInstance().playBtnsounds(),h.Switches.ins.event(168)}},t.prototype.init=function(){this._btn&&(this._btn.once(c.EventName.ON_UI_DESTROYED,this,this.doDestroy),s.AccessCenter.ins.checkOpen(168)?this.doInit():(this._btn.parent&&(this._btn.removeSelf(),this._btn.event(c.EventName.UI_REMOVE_STAGE)),s.AccessCenter.ins.on(168,this,this.onActivityAccessUpdate)))},t.prototype.onActivityAccessUpdate=function(){s.AccessCenter.ins.checkOpen(168)&&(s.AccessCenter.ins.off(168,this,this.onActivityAccessUpdate),this._currActivityId=0,this.doInit())},t.prototype.doInit=function(){u.E.ins.on(c.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.onActivityHallChanged),this.updateBtnShow()},t.prototype.onActivityHallChanged=function(t){this._pos==t&&this.updateBtnShow()},t.prototype.updateBtnShow=function(){var t=!1,e=!1,i=!1;if(-1==this._currActivityId){i=!0;var n=y.RemoteStorage.getItem("lastPopAdvanceNoticeTime");14400<v.ServerTime.serverTime-Number(n)&&(e=!0)}var s=p.ActivityManager.ins.getActivityHallByPos(this._pos);if(s&&0<s.count){var o=s.getActivatedIds();if(o&&0<o.length){-1<this._currActivityId&&this._currActivityId!=o[0]&&(e=!0),this._currActivityId=o[0];var a=d.RoleCenter.instans.vo.getActivity1Data(this._currActivityId);if(a){var r=g.GameConfig.activityJson[a.cfgId];f.ClearResM.delCachUrl(this._btn.skin),r.button?this._btn.skin="dynamic/activity/"+r.button+".png":this._btn.skin=this.defSkin,f.ClearResM.addCachUrl(this._btn.skin),this._limitLv=Number(r.value),0<this._limitLv&&d.RoleCenter.instans.vo.getCurLv()<this._limitLv?(this._currActivityId=0,u.E.ins.on(c.EventName.ADDED_LEVEL,this,this.onAddLvHandler)):t=!0}}}if(t){if(this._parent&&(this._parent.addChild(this._btn),this._btn.event(c.EventName.UI_ADD_TO_STAGE)),this.updateCD(),e&&Laya.timer.once(200,this,function(){h.Switches.ins.event(168,[!1,!0,0,i])}),e||i){var l=this._btn.getChildByName("img_red");l&&(l.visible=!0),this._effect&&(this._effect.visible=!0),this._btn.event(c.EventName.UI_ADD_TO_STAGE)}}else Laya.timer.clear(this,this.updateCD),this._btn.parent&&(this._btn.removeSelf(),this._btn.event(c.EventName.UI_REMOVE_STAGE))},t.prototype.onAddLvHandler=function(){d.RoleCenter.instans.vo.getCurLv()>=this._limitLv&&(u.E.ins.off(c.EventName.ADDED_LEVEL,this,this.onAddLvHandler),this.updateBtnShow())},t.prototype.updateCD=function(){if(this._cdLab){var t=0,e=d.RoleCenter.instans.vo.getActivity1Data(this._currActivityId);e&&(t=e.rewardTime);var i=t-v.ServerTime.serverTime;0<i?(this._cdLab.changeText(o.DateUtil.getHMS_countdown(i)),Laya.timer.once(1e3,this,this.updateCD)):this._cdLab.changeText("00:00:00")}},t.prototype.doDestroy=function(){this._btn=null,this._cdLab=null,this._parent=null,u.E.ins.off(c.EventName.ADDED_LEVEL,this,this.onAddLvHandler),s.AccessCenter.ins.off(168,this,this.onActivityAccessUpdate),u.E.ins.off(c.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.onActivityHallChanged)},t}();e.AdvanceNoticeBtnCtrl=a}),define("src/g/proxy/compents/DrawerEffectProxy",["require","exports","../../../enum/EventName","src/g/proxy/compents/DrawerEffectManager"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e,i){this._key=t,this._ui=e,this._dir=i,this._ui&&this._dir&&this.init()}return t.prototype.init=function(){this._ui.on(i.EventName.ON_UI_DESTROYED,this,this.destroy),"left"==this._dir?(this._initialValue=this._ui.x,this._closeValue=-1*(this._ui.x+this._ui.width),this._ui.x=this._closeValue):"right"==this._dir?(this._initialValue=this._ui.x,this._closeValue=this._ui.parent.width,this._ui.x=this._closeValue):"top"==this._dir?(this._initialValue=this._ui.y,this._closeValue=-1*(this._ui.y+this._ui.height),this._ui.y=this._closeValue):"bottom"==this._dir&&(this._initialValue=this._ui.y,this._closeValue=this._ui.parent.height,this._ui.y=this._closeValue),this._open=!1,this.open=!0,0<this._key&&n.DrawerEffectManager.ins.regisEffecter(this._key,this)},t.prototype.destroy=function(){n.DrawerEffectManager.ins.unregisEffecter(this._key),this._ui.off(i.EventName.ON_UI_DESTROYED,this,this.destroy),this._ui=null},Object.defineProperty(t.prototype,"open",{get:function(){return this._open},set:function(t){var e=this;t!=this._open&&(this._open=t,this._ui&&(Laya.Tween.clearAll(this._ui),"left"==this._dir||"right"==this._dir?Laya.Tween.to(this._ui,{x:this._open?this._initialValue:this._closeValue},200,null,new Laya.Handler(this,function(){e.uiMovedHandler()})):"top"!=this._dir&&"bottom"!=this._dir||Laya.Tween.to(this._ui,{y:this._open?this._initialValue:this._closeValue},200,null,new Laya.Handler(this,function(){e.uiMovedHandler()}))))},enumerable:!0,configurable:!0}),t.prototype.uiMovedHandler=function(){this._ui.event(i.EventName.DRAWER_MOVE_COMPLET),this._ui.event(i.EventName.UI_MOVED);for(var t=this._ui.numChildren,e=0;e<t;)this._ui.getChildAt(e).event(i.EventName.UI_MOVED),e++},t}();e.DrawerEffectProxy=s}),define("src/g/proxy/compents/DrawerEffectManager",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,n=function(){function t(){this.effectList=new Laya.Dictionary}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t),this._ins},enumerable:!0,configurable:!0}),t.prototype.regisEffecter=function(t,e){this.effectList.get(t)||this.effectList.set(t,e)},t.prototype.unregisEffecter=function(t){this.effectList.remove(t)},t.prototype.onSimplyHandler=function(t){for(var e in this.effectList.values)this.effectList.values[e].open=!t},t}();e.DrawerEffectManager=n,(i=e.enumIndexUi||(e.enumIndexUi={}))[i.top_btn_con=1]="top_btn_con",i[i.left_btn_con=2]="left_btn_con",i[i.right_btn_con=3]="right_btn_con",i[i.btn_daily=4]="btn_daily"}),define("src/g/index/view/SmallIconLayer",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(n){function t(){var t=n.call(this)||this;return t._space=0,t.queue=[],t}return __extends(t,n),t.prototype.addChild=function(t){return t&&(this.queue.push(new s(t,1)),this.run()),t},t.prototype.removeChild=function(t){return t&&(this.queue.push(new s(t,2)),this.run()),t},t.prototype.run=function(){if(!this._running&&0<this.queue.length){var t=this.queue.shift();1==t.action?this.doAdd(t.target):2==t.action&&this.doRemove(t.target),t.destroy()}},t.prototype.doAdd=function(t){var e=this;if(t.destroyed||t.parent==this)this._running=!1,this.run();else if(this._running=!0,this.updateWidth(),this.width=this.width+this._space+t.width,t.x=this.width-t.width,this.parent){var i=(this.parent.width-this.width)/2;Laya.Tween.to(this,{x:i},500,null,new Laya.Handler(this,function(){e.doDrop(t)}))}else n.prototype.addChild.call(this,t),this._running=!1,this.run()},t.prototype.doDrop=function(t){var e=this;t.destroyed?(this._running=!1,this.run()):(t.y=-600,n.prototype.addChild.call(this,t),Laya.Tween.to(t,{y:0},1e3,Laya.Ease.bounceOut,new Laya.Handler(this,function(){e._running=!1,e.run()})))},t.prototype.updateWidth=function(){for(var t,e=this.numChildren,i=0,n=0;n<e;)(t=this.getChildAt(n)).x=i,i+=t.width+this._space,n++;0<i&&(i-=this._space),this.width=i},t.prototype.doRemove=function(t){var e=this;if(t.destroyed||t.parent!=this)this._running=!1,this.run();else if(this._running=!0,n.prototype.removeChild.call(this,t),this.updateWidth(),this.parent){var i=(this.parent.width-this.width)/2;0<this.width?Laya.Tween.to(this,{x:i},500,null,new Laya.Handler(this,function(){e._running=!1,e.run()})):(this.x=i,this._running=!1,this.run())}else this._running=!1,this.run()},t}(Laya.Box);e.SmallIconLayer=i;var s=function(){function t(t,e){this.target=t,this.action=e}return t.prototype.destroy=function(){this.target=null},t}();e.FlyOperation=s}),define("src/g/index/ctrl/IndexBtnsManager",["require","exports","../../../enum/EventName"],function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.addGridCon=function(t){t.autoLayout=!1,t.initOrder(),this.initBtns(t),this._head?this._head.link(t):this._head=t},t.prototype.run=function(){for(var t=this._head;t;){if(!t.inited)return void t.once("AutoLayoutGridInited",this,this.run);t=t.next}this.onUIShowChanaged()},t.prototype.initBtns=function(t){for(var e,i=t.numChildren,n=0;n<i;)(e=t.getChildAt(n))&&(e.on(s.EventName.UI_ADD_TO_STAGE,this,this.onUIShowChanaged),e.on(s.EventName.UI_REMOVE_STAGE,this,this.onUIShowChanaged)),n++},t.prototype.onUIShowChanaged=function(){Laya.timer.clear(this,this.onLayoutHandler),Laya.timer.frameOnce(1,this,this.onLayoutHandler)},t.prototype.onLayoutHandler=function(){for(var t=[],e=this._head;e;)t=t.concat(e._childs),e.clearNum(),e=e.next;t.sort(function(t,e){return t.zOrder-e.zOrder});for(var i,n=t.length,s=0;s<n;)(i=t[s]).visible&&this._head.join(i),s++;for(e=this._head;e;)e.layoutHandler(),e=e.next},t.prototype.update=function(){for(var t=this._head;t;)t.layoutHandler(),t=t.next},t}();e.IndexBtnsManager=i}),define("src/g/index/ctrl/LoginRewardBtnCtrl",["require","exports","../../../utils/SoundUtils","src/init/Switches","src/g/accessctrl/AccessCenter","../../../enum/EventName","../../../manager/RoleCenter","../../../utils/system/DateUitl","../../../config/GameConfig","../../../utils/system/ServerTime","src/g/clearRes/ClearResM","../../../core/E"],function(t,e,i,n,s,a,r,l,h,c,u,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(){function t(t){this._currActivityId=0,this._btn=t,this._btn&&(this._btn.on(Laya.Event.CLICK,this,this.onOpHandler),this._parent=this._btn.parent),o.E.ins.on(a.EventName.PAYChanged,this,this.checkPay)}return t.prototype.checkPay=function(){window.enabledpay&&(this._btn.visible=!0,this.init(),o.E.ins.off(a.EventName.PAYChanged,this,this.checkPay))},t.prototype.onOpHandler=function(){i.SoundUtils.getInstance().playBtnsounds(),n.Switches.ins.event(5)},t.prototype.init=function(){this._btn&&(this._btn.once(a.EventName.ON_UI_DESTROYED,this,this.doDestroy),s.AccessCenter.ins.checkOpen(5)?this.doInit():(this._btn.parent&&(this._btn.removeSelf(),this._btn.event(a.EventName.UI_REMOVE_STAGE)),s.AccessCenter.ins.on(5,this,this.onActivityAccessUpdate)))},t.prototype.onActivityAccessUpdate=function(){s.AccessCenter.ins.checkOpen(5)&&(s.AccessCenter.ins.off(5,this,this.onActivityAccessUpdate),this.doInit())},t.prototype.doInit=function(){this.updateBtnShow()},t.prototype.updateBtnShow=function(){if(r.RoleCenter.instans.vo){Laya.timer.clear(this,this.updateBtnShow);var t=r.RoleCenter.instans.vo.getLoginRewardData();if(t){var e=l.DateUtil.getDayFromStartTime(t.startTime,c.ServerTime.ACTIVITY_TIME_OFFSET)+1;if(e=14<e?14:e){var i=t.children.length,n=0;for(u.ClearResM.delCachUrl(this._btn.skin);n<i;){var s=h.GameConfig.subActivityJson[t.children[n].cfgId];if(s&&s.value==e){s.image?this._btn.skin="dynamic/activity/login_reward/"+s.image+".png":this._btn.skin="dynamic/activity/login_reward/1.png";break}n++}u.ClearResM.addCachUrl(this._btn.skin);var o=l.DateUtil.getZeroTime()-c.ServerTime.serverTime;o<=0&&(o=1),o<28800&&Laya.timer.once(1e3*o,this,this.updateBtnShow)}this._parent&&(this._parent.addChild(this._btn),this._btn.event(a.EventName.UI_ADD_TO_STAGE))}else this._btn.parent&&(this._btn.removeSelf(),this._btn.event(a.EventName.UI_REMOVE_STAGE))}},t.prototype.doDestroy=function(){this._btn=null,this._parent=null,s.AccessCenter.ins.off(5,this,this.onActivityAccessUpdate)},t}();e.LoginRewardBtnCtrl=p}),define("src/g/index/view/ShareViewDlg",["require","exports","../../../utils/ItemUtils","src/g/clearRes/ClearResM","../../../config/GameConfig","src/g/gameSdk/gameSdk","../../../enum/enumItem","src/g/guide/vo/RewardVo","../../../meta/QualiyVo","src/g/account/view/AccItem","../../../vo/sbkUserVo","../../net/messages/ChannelGiftMsg","../../../manager/GameSocketManager","../../../utils/system/DateUitl"],function(t,e,c,i,n,s,u,p,d,g,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t._lastShareTime=0,t.beforTime=72e5,t.btn_share.on(Laya.Event.CLICK,t,t.onShare),t}return __extends(t,e),t.prototype.popup=function(){this.cgvo=n.GameConfig.cGift[u.ChannelGiftIdEnum.share],this.cnt=o.sbkUserVo.getChannelGiftCnt(u.ChannelGiftIdEnum.share),this.lab_count.text="("+this.cnt+"/"+this.cgvo.count+")",this.initByPanle(this.cgvo.rewate2Inventory()),this._lastShareTime=parseInt(utils.LocalUtil.getAnyLocal("lastShareTime")||0),this.img_follow.visible=!1,this.lab_text.text="发送给朋友，有丰厚奖励哦！",this.img_title.skin="res/unpack/channel_title_share.png",this.img_tip.skin="res/unpack/channel_tip_share.png",Laya.timer.loop(1e3,this,this.loopTime),this.loopTime(),e.prototype.popup.call(this)},t.prototype.close=function(){this.closeEffect=null,Laya.timer.clear(this,this.loopTime),e.prototype.close.call(this),this.btn_share.off(Laya.Event.CLICK,this,this.close),Laya.timer.once(100,this,function(){this.destroy(),i.ClearResM.clearResFolder("share")})},t.prototype.loopTime=function(){var t=(new Date).getTime()-this._lastShareTime;t>this.beforTime?this.box_shareTime.visible=!1:(this.box_shareTime.visible=!0,t=(this.beforTime-t)/1e3>>0,this.lab_shareTime.text=l.DateUtil.getHMS_countdown(t))},t.prototype.onShare=function(){var i=this;s.gameSdk.Ins.sdk.enterShareAndFeed(JSON.stringify({}),function(t){if((new Date).getTime()-i._lastShareTime>i.beforTime){var e=new a.TakeChannelGiftC2GS;e.id=u.ChannelGiftIdEnum.share,r.GSM.sendServer(e),utils.LocalUtil.setAnyLocal("lastShareTime",(new Date).getTime())}},function(){var t=new ui.alert.ShareTipUI;t.once(Laya.Event.CLICK,t,t.close),t.popup()}.bind(this)),this.close()},t.prototype.initByPanle=function(t){if(t.currencyList){this.panelList.hScrollBarSkin="";for(var e=new Laya.Sprite,i=t.currencyList,n=0;n<i.length;n++){var s=new p.RewardVo;s.count=i[n].val;var o=c.ItemUtils.getCurrencyByDefine(i[n].key);s.name=o.name,s.type=u.ItemType.CURRENCY,s.quality=d.QualityStruct.Ins.getQColorById(o.quality),s.res=c.ItemUtils.getIconByIconId(o.icon),s.qualityNum=o.quality,s.define=i[n].key,s.streamer=o.streamer,(r=new g.AccItem).eqData=s,e.addChild(r),r.x=e.width,e.width+=r.width}}if(t.itemList){var a=t.itemList;for(n=0;n<a.length;n+=2){var r,l=new p.RewardVo,h=c.ItemUtils.getItemVoById(a[n]);l.res=c.ItemUtils.getIconByIconId(h.icon),l.lv=h.uselimit,l.qualityNum=h.quality,l.quality=d.QualityStruct.Ins.getQColorById(h.quality),l.name=h.name,l.id=h.id,l.type=u.ItemType.ITEM,l.count=a[n+1],l.streamer=h.streamer,(r=new g.AccItem).eqData=l,e.addChild(r),r.x=e.width,e.width+=r.width}}e.height=r.height,this.panelList.addChild(e),e.width>this.panelList.width?e.x=0:e.x=this.panelList.width/2-e.width/2},t}(ui.share.ShareViewUI);e.ShareViewDlg=h}),define("src/g/index/ctrl/GameShareCtrl",["require","exports","../../../utils/SoundUtils","src/g/gameSdk/gameSdk","../../../enum/EventName","../../../manager/RoleCenter","../../../core/E","src/g/index/view/ShareViewDlg"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t){this._isAdd=!1,this._btn=t,this._btn&&(this._btn.on(Laya.Event.CLICK,this,this.onOpHandler),this._parent=this._btn.parent),this._btn.visible=!1}return t.prototype.onOpHandler=function(){i.SoundUtils.getInstance().playBtnsounds(),(new r.ShareViewDlg).popup()},t.prototype.init=function(){this._btn&&(this._btn.once(s.EventName.ON_UI_DESTROYED,this,this.doDestroy),n.gameSdk.Ins.sdk.isShowShare?this.doInit():this._btn.parent&&(this._btn.removeSelf(),this._btn.event(s.EventName.UI_REMOVE_STAGE)))},t.prototype.doInit=function(){this.updateBtnShow()},t.prototype.updateBtnShow=function(){o.RoleCenter.instans.vo&&(n.gameSdk.Ins.sdk.isShowShare?this._parent&&!this._isAdd&&(this._isAdd=!0,this._parent.addChild(this._btn),this._btn.event(s.EventName.UI_ADD_TO_STAGE),a.E.ins.on(s.EventName.CHANNEL_GIFT_GET,this,this.updateBtnShow)):this._btn.parent&&(this._btn.removeSelf(),this._btn.event(s.EventName.UI_REMOVE_STAGE)))},t.prototype.doDestroy=function(){this._btn=null,this._parent=null,a.E.ins.off(s.EventName.CHANNEL_GIFT_GET,this,this.updateBtnShow)},t}();e.GameShareCtrl=l}),define("src/g/index/view/HTTaskBar",["require","exports","../../../manager/TaskManager","../../../core/E","../../../enum/EventName","../../../utils/MathUtils","src/init/GameState","src/g/timelimittask/ctrl/TimeLimitTaskUtil","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg","../../../config/GameConfig","../../../manager/RoleCenter","../../net/messages/enumStatus","src/init/Switches","src/g/accessctrl/AccessCenter","src/g/Effects/UIEffectsFactory"],function(t,e,n,s,o,a,r,l,h,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t.taskId=0,t.y=Laya.stage.height-270,t.centerX=0,t.visible=!1,n.TaskManager.ins.inited?t.init():s.E.ins.once(o.EventName.TASK_INIT_COMPLETE,t,t.init),t.on(Laya.Event.CLICK,t,t.openHTTaskPanel);var e=f.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.bgsp,18,1,1,"gift");return e.mouseEnabled=!1,t.bgsp.addChild(e),t}return __extends(t,i),t.prototype.openHTTaskPanel=function(){g.Switches.ins.event(234,this.taskId)},t.prototype.init=function(){Laya.timer.once(500,this,this.updateVis)},t.prototype.addEvents=function(){s.E.ins.on(o.EventName.BATTLE_STATE_CHANGED,this,this.updateVis),s.E.ins.on(o.EventName.ENTER_SUB_GAMEPLAY,this,this.updateVis),s.E.ins.on(o.EventName.EXIT_SUB_GAMEPLAY,this,this.updateVis),s.E.ins.on(o.EventName.TIME_LIMIT_TASK_OPEN,this,this.updateVis),s.E.ins.on(o.EventName.TIME_LIMIT_TASK_DELETE,this,this.updateVis),s.E.ins.on(o.EventName.TIME_LIMIT_TASK_DATA_CHANGED,this,this.updateVis),s.E.ins.on(o.EventName.PLAY_TYPE_CHANGED,this,this.updateVis),v.AccessCenter.ins.checkOpen(234)||v.AccessCenter.ins.on(234,this,this.updateVis)},t.prototype.removeEvents=function(){s.E.ins.off(o.EventName.BATTLE_STATE_CHANGED,this,this.updateVis),s.E.ins.off(o.EventName.ENTER_SUB_GAMEPLAY,this,this.updateVis),s.E.ins.off(o.EventName.EXIT_SUB_GAMEPLAY,this,this.updateVis),s.E.ins.off(o.EventName.TIME_LIMIT_TASK_OPEN,this,this.updateVis),s.E.ins.off(o.EventName.TIME_LIMIT_TASK_DELETE,this,this.updateVis),s.E.ins.off(o.EventName.TIME_LIMIT_TASK_DATA_CHANGED,this,this.updateVis),s.E.ins.off(o.EventName.PLAY_TYPE_CHANGED,this,this.updateVis),v.AccessCenter.ins.off(234,this,this.updateVis)},t.prototype.updateVis=function(){if(this.removeEvents(),s.E.ins.off(o.EventName.CURRENT_TASK_CHANGE,this,this.updateVis),n.TaskManager.ins.currentTask)return s.E.ins.on(o.EventName.CURRENT_TASK_CHANGE,this,this.updateVis),void(this.visible=!1);if(this.addEvents(),this.visible=!1,v.AccessCenter.ins.checkOpen(234)&&(h.PlayManager.type==c.EPlayType.PLAYTYPE_NEWVILLAGE||h.PlayManager.type==c.EPlayType.PLAYTYPE_PORT||h.PlayManager.type==c.EPlayType.PLAYTYPE_MAINCITY)&&!a.MathUtils.containBit(r.GameState.battle_state,r.GameState.battle_state_heji)){var t=l.TimeLimitTaskUtil.findOpenTaskId(3);if(t){this.visible=!0,this.taskId=t;var e=u.GameConfig.timeLimitTaskJson[t];this.img_desc.skin="res/ht_task_bar/heti_zjm_00"+e.descImage+".png";var i=e.reward[0][1];22==i?this.img_skill_icon.skin="res/index1/heiti_jineng_001.png":23==i&&(this.img_skill_icon.skin="res/index1/heiti_jineng_002.png"),24==i&&(this.img_skill_icon.skin="res/index1/heiti_jineng_003.png"),this.updateProgress(t)}}},t.prototype.updateProgress=function(t){for(var e=u.GameConfig.timeLimitTaskJson[t],i=p.RoleCenter.instans.vo.getTLTDataById(t),n=e.child.length,s=0,o=0;s<n;)i.curStatusArr[s]==d.enumStatus.yilingqu&&o++,s++;this.img_progress.scaleX=o/n,this.bgsp.visible=-1!=i.curStatusArr.indexOf(d.enumStatus.kelingqu)},t}(ui.ht_task.HTTaskBarUI);e.HTTaskBar=i}),define("src/g/gift/view/WXGuideViewl",["require","exports","../../../config/GameConfig","../../../enum/enumItem","../../../vo/sbkUserVo","../../net/messages/ChannelGiftMsg","../../../manager/GameSocketManager","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","../../../utils/system/FloatEffect","../../../manager/AM"],function(t,e,i,o,n,a,r,l,s,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t._curindex=0,t._cururl=[],t.btnget.on(Laya.Event.CLICK,t,t.getHandler),t.btnleft.on(Laya.Event.CLICK,t,t.leftHandler),t.btnright.on(Laya.Event.CLICK,t,t.rightHandler),t.item0.on(Laya.Event.CLICK,t,t.moveHandler,[1]),t.item1.on(Laya.Event.CLICK,t,t.moveHandler,[2]),t.item2.on(Laya.Event.CLICK,t,t.moveHandler,[3]),t.item3.on(Laya.Event.CLICK,t,t.moveHandler,[4]),t.btn_close.on(Laya.Event.CLICK,t,t.close),t}return __extends(t,e),t.prototype.update=function(){for(var t=0;t<this.cgvo.reward.length;t++){var e=l.ItemUtils.getItemOrEq(this.cgvo.reward[t][0]),i=this["reitem"+t];i&&s.ItemIconView.setItemData(e,i,this.cgvo.reward[t][1])}},t.prototype.rightHandler=function(){this._curindex+=1,this.moveHandler(this._curindex)},t.prototype.leftHandler=function(){this._curindex-=1,this.moveHandler(this._curindex)},t.prototype.moveHandler=function(t){this._curindex=t,4<=this._curindex?this._curindex=4:this._curindex<=1&&(this._curindex=1),this.viewskin.skin=this._cururl[this._curindex],this.selectbtn.x=this["item"+[this._curindex-1]].x},t.prototype.getHandler=function(){var t=this.getcurrent();if(t==o.ChannelGiftIdEnum.wxzuijin){if(1089!=window.wxscene)return void c.AM.show("请从微信聊天主界面下拉进入！");this.close()}var e=new a.TakeChannelGiftC2GS;e.id=t,r.GSM.sendServer(e);for(var i=0;i<this.cgvo.reward.length;i++){var n=l.ItemUtils.getItemOrEq(this.cgvo.reward[i][0]),s=this.cgvo.reward[i][1];this["reitem"+i]&&n&&h.FE.getUpfloatQ(n.name+"X"+s,n.quality)}},t.prototype.popup=function(){e.prototype.popup.call(this),this._curindex=0,this.getcurrent(),this.update()},t.prototype.refreshHandler=function(){this._curindex=0,this.getcurrent(),this.update(),this.moveHandler(1)},t.prototype.getcurrent=function(){var t=n.sbkUserVo.getChannelGiftCnt(o.ChannelGiftIdEnum.wxguide),e=n.sbkUserVo.getChannelGiftCnt(o.ChannelGiftIdEnum.wxzuijin);return t<=0?(this.cgvo=i.GameConfig.cGift[o.ChannelGiftIdEnum.wxguide],this.cnt=n.sbkUserVo.getChannelGiftCnt(o.ChannelGiftIdEnum.wxguide),this._cururl=["","res/wxguide/xcx_beijingtu_001.png","res/wxguide/xcx_beijingtu_002.png","res/wxguide/xcx_beijingtu_003.png","res/wxguide/xcx_beijingtu_004.png"],o.ChannelGiftIdEnum.wxguide):0<=e?(this.cgvo=i.GameConfig.cGift[o.ChannelGiftIdEnum.wxzuijin],this.cnt=n.sbkUserVo.getChannelGiftCnt(o.ChannelGiftIdEnum.wxzuijin),this._cururl=["","res/wxguide/xcx_beijingtu_001.png","res/wxguide/xcx_beijingtu_002.png","res/wxguide/xcx_beijingtu_003.png","res/wxguide/xcx_beijingtu_005.png"],o.ChannelGiftIdEnum.wxzuijin):(this.cgvo=i.GameConfig.cGift[o.ChannelGiftIdEnum.wxguide],this.cnt=n.sbkUserVo.getChannelGiftCnt(o.ChannelGiftIdEnum.wxguide),o.ChannelGiftIdEnum.wxguide)},t}(ui.gift.WXGuideUI);e.WXGuideViewl=u}),define("src/g/gift/view/WXCareView",["require","exports","../../../config/GameConfig","../../../enum/enumItem","../../../vo/sbkUserVo","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","src/g/gameSdk/gameSdk","../../net/messages/ChannelGiftMsg","../../../manager/GameSocketManager"],function(t,e,o,a,r,l,h,i,n,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(s){function t(){var t=s.call(this)||this;t.btn_get.on(Laya.Event.CLICK,t,t.linkHandler),t.btn_link.on(Laya.Event.CLICK,t,t.linkHandler),t.btn_link.removeSelf(),t.cgvo=o.GameConfig.cGift[a.ChannelGiftIdEnum.wxguanzhu],t.cnt=r.sbkUserVo.getChannelGiftCnt(a.ChannelGiftIdEnum.wxguanzhu),t.cgvo=o.GameConfig.cGift[a.ChannelGiftIdEnum.wxguanzhu];for(var e=0;e<t.cgvo.reward.length;e++){var i=l.ItemUtils.getItemOrEq(t.cgvo.reward[e][0]),n=t["item"+e];n&&h.ItemIconView.setItemData(i,n,t.cgvo.reward[e][1])}return t.codetip.text=window.channeltipname,t.qcode.skin=window.codetip,t}return __extends(t,s),t.prototype.popup=function(){s.prototype.popup.call(this);try{i.gameSdk.Ins.sdk.subscribe(function(t){if(t&&r.sbkUserVo.getChannelGiftCnt(a.ChannelGiftIdEnum.wxguanzhu)<=0)return this.btn_get.off(Laya.Event.CLICK,this,this.linkHandler),this.btn_get.on(Laya.Event.CLICK,this,this.getreward),void(this.btn_get.label="领取奖励")}.bind(this))}catch(t){console.log("------------")}},t.prototype.getreward=function(){var t=new n.TakeChannelGiftC2GS;t.id=a.ChannelGiftIdEnum.wxguanzhu,c.GSM.sendServer(t),this.close()},t.prototype.linkHandler=function(){i.gameSdk.Ins.sdk.openKefu()},t}(ui.gift.WXCareViewUI);e.WXCareView=s;var u=function(e){function t(){var t=e.call(this)||this;return t.qcode.skin=window.codetip,t}return __extends(t,e),t}(ui.gift.QcodeUI);e.QcodeView=u}),define("src/g/gift/ctrl/WXGuideCtrl",["require","exports","src/g/gift/view/WXGuideViewl","../../../vo/sbkUserVo","../../../enum/enumItem","../../../enum/EventName","../../../core/E","src/g/gift/view/WXCareView","src/g/gameSdk/gameSdk"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function t(t){(this._btn=t).visible=!0,this._btn.on(Laya.Event.CLICK,this,this.openHandler),a.E.ins.on(o.EventName.CHANNEL_GIFT_GET,this,this.closeHandler),this.closeHandler(null)}return t.prototype.openHandler=function(){this._dlg=new i.WXGuideViewl,this._dlg.popup()},t.prototype.closeHandler=function(t){var e=n.sbkUserVo.getChannelGiftCnt(s.ChannelGiftIdEnum.wxguide),i=n.sbkUserVo.getChannelGiftCnt(s.ChannelGiftIdEnum.wxzuijin);0<e&&0<i?this._btn.parent&&(this._btn.removeSelf(),this._btn.event(o.EventName.UI_REMOVE_STAGE)):this._dlg&&this._dlg.refreshHandler()},t}();e.WxGuideCtrl=h;var c=function(){function t(t){this._btn=t,this._btn.on(Laya.Event.CLICK,this,this.openHandler),a.E.ins.on(o.EventName.CHANNEL_GIFT_GET,this,this.closeHandler),Laya.stage.on(Laya.Event.VISIBILITY_CHANGE,this,this.foucHandler),window.iswx&&(t.visible=!0),this.closeHandler();try{l.gameSdk.Ins.sdk.subscribe(function(t){t&&this.closeHandler()}.bind(this))}catch(t){}}return t.prototype.foucHandler=function(){console.error("------------------------")},t.prototype.openHandler=function(){this._dlg=new r.WXCareView,this._dlg.popup()},t.prototype.closeHandler=function(){if(0<n.sbkUserVo.getChannelGiftCnt(s.ChannelGiftIdEnum.wxguanzhu))return this._btn.parent&&(this._btn.removeSelf(),this._btn.event(o.EventName.UI_REMOVE_STAGE)),void a.E.ins.off(o.EventName.CHANNEL_GIFT_GET,this,this.closeHandler)},t}();e.WxCareCtrl=c;var u=function(){function t(t){t.on(Laya.Event.CLICK,this,this.popHandler),t.visible=!0}return t.prototype.popHandler=function(){l.gameSdk.Ins.sdk.showFollow(null)},t}();e.WxCareCtrlShow=u}),define("src/g/index/ctrl/GameShare001Ctrl",["require","exports","src/g/gameSdk/gameSdk"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t){t.on(Laya.Event.CLICK,this,this.openHandler)}return t.prototype.openHandler=function(){i.gameSdk.Ins.sdk.openKefu()},t}();e.GameShare001Ctrl=n}),define("src/g/gift/view/WXGuide2View",["require","exports","../../../config/GameConfig","../../../enum/enumItem","../../../vo/sbkUserVo","../../net/messages/ChannelGiftMsg","../../../manager/GameSocketManager","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","../../../utils/system/FloatEffect","../../../manager/AM","../../../enum/EventName","../../../core/E"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t._curindex=0,t._cururl=[],t.btnget.on(Laya.Event.CLICK,t,t.getHandler),t.btnleft.on(Laya.Event.CLICK,t,t.leftHandler),t.btnright.on(Laya.Event.CLICK,t,t.rightHandler),t.item0.on(Laya.Event.CLICK,t,t.moveHandler,[1]),t.item1.on(Laya.Event.CLICK,t,t.moveHandler,[2]),t.item2.on(Laya.Event.CLICK,t,t.moveHandler,[3]),t.item3.on(Laya.Event.CLICK,t,t.moveHandler,[4]),t.btn_close.on(Laya.Event.CLICK,t,t.close),t}return __extends(t,e),t.prototype.update=function(){for(var t=0;t<this.cgvo.reward.length;t++){var e=r.ItemUtils.getItemOrEq(this.cgvo.reward[t][0]),i=this["reitem"+t];i&&l.ItemIconView.setItemData(e,i,this.cgvo.reward[t][1])}},t.prototype.rightHandler=function(){this._curindex+=1,this.moveHandler(this._curindex)},t.prototype.leftHandler=function(){this._curindex-=1,this.moveHandler(this._curindex)},t.prototype.moveHandler=function(t){this._curindex=t,4<=this._curindex?this._curindex=4:this._curindex<=1&&(this._curindex=1),this.viewskin.skin=this._cururl[this._curindex],this.selectbtn.x=this["item"+[this._curindex-1]].x},t.prototype.getHandler=function(){var t=this.getcurrent();if(t==n.ChannelGiftIdEnum.wxanzhuangGift&&window.iswx)return c.AM.show("请下载安装包领取奖励!"),void this.close();var e=new o.TakeChannelGiftC2GS;e.id=t,a.GSM.sendServer(e),this.close(),s.sbkUserVo.getChannelGiftCnt(t)<=0||h.FE.upItems("奖励已领取"),p.E.ins.event(u.EventName.CHANNEL_GIFT_GET)},t.prototype.popup=function(){e.prototype.popup.call(this),this._curindex=0,this.getcurrent(),this.update(),this.moveHandler(1)},t.prototype.refreshHandler=function(){this._curindex=0,this.getcurrent(),this.update(),this.moveHandler(1)},t.prototype.getcurrent=function(){var t=window.channelRes;return s.sbkUserVo.getChannelGiftCnt(n.ChannelGiftIdEnum.wxanzhuangGift)<=0?(this.cgvo=i.GameConfig.cGift[n.ChannelGiftIdEnum.wxanzhuangGift],this.cnt=s.sbkUserVo.getChannelGiftCnt(n.ChannelGiftIdEnum.wxanzhuangGift),this._cururl=["","res/wxguide2/"+t+"/1.jpg","res/wxguide2/"+t+"/2.jpg","res/wxguide2/"+t+"/3.jpg","res/wxguide2/"+t+"/4.jpg"]):(this.cgvo=i.GameConfig.cGift[n.ChannelGiftIdEnum.wxanzhuangGift],this._cururl=["","res/wxguide2/"+t+"/1.jpg","res/wxguide2/"+t+"/2.jpg","res/wxguide2/"+t+"/3.jpg","res/wxguide2/"+t+"/4.jpg"],this.cnt=s.sbkUserVo.getChannelGiftCnt(n.ChannelGiftIdEnum.wxanzhuangGift)),n.ChannelGiftIdEnum.wxanzhuangGift},t}(ui.gift.WXGuide2UI);e.WXGuide2View=d}),define("src/g/gift/view/WXCare2View",["require","exports","src/g/gift/ctrl/WXGuide2Ctrl"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.btn_close.on(Laya.Event.CLICK,t,t.close),t.btn_copy.on(Laya.Event.CLICK,t,t.copyStrToSystem),t.lab_channle.text=window.officialaccountname,t}return __extends(t,e),t.prototype.popup=function(){e.prototype.popup.call(this)},t.prototype.copyStrToSystem=function(){i.WxCare2Ctrl.setClipboardData(window.officialaccountname)},t}(ui.gift.WXCare2ViewUI);e.WXCare2View=n}),define("src/g/gift/ctrl/WXGuide2Ctrl",["require","exports","../../../vo/sbkUserVo","../../../enum/enumItem","../../../enum/EventName","../../../core/E","src/g/gameSdk/gameSdk","src/g/gift/view/WXGuide2View","src/g/gift/view/WXCare2View","../../../config/GameConfig","../../../utils/system/ServerTime","../../../utils/system/DateUitl","../../../manager/RoleCenter","src/g/accessctrl/AccessCenter","../../../manager/GameSocketManager","../../net/messages/temporary/temporary"],function(t,e,n,s,i,o,a,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(){function t(t){this._isAdd=!1,this._btn=t,this._btn.visible=!0,this._btn.on(Laya.Event.CLICK,this,this.openHandler),o.E.ins.on(i.EventName.CHANNEL_GIFT_GET,this,this.removeHandler),o.E.ins.on(i.EventName.ADDED_LEVEL,this,this.onLvChanged),this._parent=this._btn.parent,this.closeHandler(null)}return t.prototype.openHandler=function(){this._dlg=new r.WXGuide2View,this._dlg.popup()},t.prototype.closeHandler=function(t){var e=n.sbkUserVo.getChannelGiftCnt(s.ChannelGiftIdEnum.wxanzhuangGift),i=!0;i=!window.iswx&&!a.gameSdk.Ins.sdk.hasInstallGift,0<e||i?this.removeBtn():(this._dlg&&this._dlg.refreshHandler(),d.AccessCenter.ins.checkOpen(998)?this.addBtn():this.removeBtn())},t.prototype.onLvChanged=function(){n.sbkUserVo.getChannelGiftCnt(s.ChannelGiftIdEnum.wxanzhuangGift)<=0&&d.AccessCenter.ins.checkOpen(998)?this.addBtn():this.removeBtn()},t.prototype.removeHandler=function(){0<n.sbkUserVo.getChannelGiftCnt(s.ChannelGiftIdEnum.wxanzhuangGift)&&(this.removeBtn(),o.E.ins.off(i.EventName.CHANNEL_GIFT_GET,this,this.removeHandler),o.E.ins.off(i.EventName.ADDED_LEVEL,this,this.onLvChanged))},t.prototype.addBtn=function(){this._parent&&!this._isAdd&&(this._isAdd=!0,this._parent.addChild(this._btn),this._btn.event(i.EventName.UI_ADD_TO_STAGE))},t.prototype.removeBtn=function(){this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE))},t}();e.WXGuide2Ctrl=f;var y=function(){function t(t){this.isPop=!1,this._isAdd=!1,this._isSubscribe=!1,this._popTime=0,this._btn=t,this._btn.on(Laya.Event.CLICK,this,this.openHandler),this.popTimeArr=h.GameConfig.commonJson.gongzhonghaotime,this.firstDayPopTimeArr=h.GameConfig.commonJson.gongzhonghaotime1day,o.E.ins.on(i.EventName.ADDED_LEVEL,this,this.onLvChanged),this._parent=this._btn.parent,this.limitPopTimes=h.GameConfig.commonJson.gongzhonghaotanshu.val2num,this._popTime=p.RoleCenter.instans.self.temporaryData.gzht,d.AccessCenter.ins.checkOpen(999)||this.removeHandler();try{a.gameSdk.Ins.sdk.subscribe(function(t){t?(this.removeHandler(),this._isSubscribe=!0):d.AccessCenter.ins.checkOpen(999)?(1==u.DateUtil.getKFDay()?this.autoFirstDayPopHandler():this.autoPopHandler(),this._parent&&!this._isAdd&&(this._isAdd=!0,this._parent.addChild(this._btn),this._btn.event(i.EventName.UI_ADD_TO_STAGE))):this.removeHandler()}.bind(this))}catch(t){this.removeHandler()}}return t.prototype.foucHandler=function(){console.error("------------------------")},t.prototype.openHandler=function(){this._dlg=new l.WXCare2View,this._dlg.popup()},t.prototype.removeHandler=function(){this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE))},t.prototype.autoPopHandler=function(){for(var t=this,e=this.popTimeArr.val2numArr,i=u.DateUtil.getTodayZeroTime(),n=0;n<e.length;n++){var s=e[n];e[n]=i+3600*s}console.log("timeLimitArr",e);var o=c.ServerTime.serverTime,a=e,r=!1;for(n=0;n<a.length;n+=2)if(a[n]<o&&o<a[n+1]){r=!0;break}r&&this._popTime<this.limitPopTimes&&Laya.timer.once(2e3,this,function(){t.openHandler(),t.addPopTime()})},t.prototype.autoFirstDayPopHandler=function(){for(var t=this,e=this.firstDayPopTimeArr.val2numArr,i=u.DateUtil.getTodayZeroTime(),n=0;n<e.length;n++){var s=e[n];e[n]=i+3600*s}console.log("DayOnetimeLimitArr",e);var o=c.ServerTime.serverTime,a=e,r=!1;for(n=0;n<a.length;n+=2)if(a[n]<o&&o<a[n+1]){r=!0;break}r&&this._popTime<this.limitPopTimes&&Laya.timer.once(2e3,this,function(){t.openHandler(),t.addPopTime()})},t.setClipboardData=function(t){wx.setClipboardData&&wx.setClipboardData({data:t,success:function(t){console.log("复制成功")}})},t.prototype.onLvChanged=function(){d.AccessCenter.ins.checkOpen(999)?this.addAndPop():this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE))},t.prototype.addAndPop=function(){var t=this;!this._parent||this._isAdd||this._isSubscribe||(this._isAdd=!0,this._parent.addChild(this._btn),this._btn.event(i.EventName.UI_ADD_TO_STAGE),this.checkIsPopTime()&&this._popTime<this.limitPopTimes&&Laya.timer.once(2e3,this,function(){t.openHandler(),t.addPopTime()}))},t.prototype.checkIsPopTime=function(){for(var t=this.popTimeArr.val2numArr,e=u.DateUtil.getTodayZeroTime(),i=0;i<t.length;i++){var n=t[i];t[i]=e+3600*n}console.log("checkTimeArr",t);var s=c.ServerTime.serverTime,o=t,a=!1;for(i=0;i<o.length;i+=2)if(o[i]<s&&s<o[i+1]){a=!0;break}return a},t.prototype.addPopTime=function(){var t=new v.RemoteStorageNumberC2GS;t.key="gzht",g.GSM.sendServer(t),p.RoleCenter.instans.self.temporaryData.gzht+=1},t}();e.WxCare2Ctrl=y}),define("src/g/activity/view/FlashSale3Prompt",["require","exports","../../../utils/SoundUtils","src/init/Switches","../../../utils/system/DateUitl","../../../utils/system/ServerTime"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.btn_goto.on(Laya.Event.CLICK,t,t.onGotoHandler),t}return __extends(t,e),t.prototype.onGotoHandler=function(){this.close(),i.SoundUtils.getInstance().playBtnsounds(),n.Switches.ins.event(278)},t.prototype.showPrompt=function(){this.isPopup||(this.popup(),this.cooldownHandler())},t.prototype.onClosed=function(){Laya.timer.clear(this,this.cooldownHandler)},t.prototype.cooldownHandler=function(){var t=s.DateUtil.getZeroTime()-o.ServerTime.serverTime;0<=t?(this.lab_time.changeText(s.DateUtil.getHMS_countdown(t)),Laya.timer.once(1e3,this,this.cooldownHandler)):this.lab_time.changeText("00:00:00")},t}(ui.activity.FlashSale3PromptUI);e.FlashSale3Prompt=a}),define("src/g/index/ctrl/FlashSale3BtnCtrl",["require","exports","../../../enum/ActivityPos","../../../utils/SoundUtils","src/init/Switches","src/g/accessctrl/AccessCenter","../../../enum/EventName","../../../core/E","../../../manager/ActivityManager","../../../manager/RoleCenter","../../../config/GameConfig","../../net/messages/enumStatus","src/g/fight/osprite/play/PlayManager","src/g/activity/view/FlashSale3Prompt","../../../utils/system/DateUitl","../../../utils/system/ServerTime"],function(t,e,i,n,s,o,l,h,c,u,p,d,a,r,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(){function t(t,e){this._pos=i.ActivityPos.FLASH_SALE_HALL_3,this._opened=!1,this._currActivityId=0,this._btn=t,this._cdLab=e,this._btn&&(this._btn.on(Laya.Event.CLICK,this,this.onOpHandler),this._parent=this._btn.parent),this._btn.visible=!0,this.init()}return t.prototype.onOpHandler=function(){this._currActivityId&&(n.SoundUtils.getInstance().playBtnsounds(),s.Switches.ins.event(278))},t.prototype.init=function(){this._btn&&(this._btn.once(l.EventName.ON_UI_DESTROYED,this,this.doDestroy),o.AccessCenter.ins.checkOpen(278)?this.doInit():(this._btn.parent&&(this._btn.removeSelf(),this._btn.event(l.EventName.UI_REMOVE_STAGE)),o.AccessCenter.ins.on(278,this,this.onActivityAccessUpdate)))},t.prototype.onActivityAccessUpdate=function(){o.AccessCenter.ins.checkOpen(278)&&(o.AccessCenter.ins.off(278,this,this.onActivityAccessUpdate),this.doInit())},t.prototype.doInit=function(){h.E.ins.on(l.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.onActivityHallChanged),this.updateBtnShow()},t.prototype.onActivityHallChanged=function(t){this._pos==t&&this.updateBtnShow()},t.prototype.updateBtnShow=function(){h.E.ins.off(l.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),h.E.ins.off(l.EventName.PLAY_TYPE_CHANGED,this,this.changePlaytype);var t=!1,e=c.ActivityManager.ins.getActivityHallByPos(this._pos);if(e&&0<e.count){var i=e.getActivatedIds();if(i&&0<i.length){this._currActivityId=i[0];var n=u.RoleCenter.instans.vo.getActivity1Data(this._currActivityId);if(n)for(var s,o=n.children.length,a=0;a<o;){if(s=n.children[a]){var r=p.GameConfig.subActivityJson[s.cfgId];if(r&&n.allData.allCount==r.value&&s.status==d.enumStatus.kelingqu){h.E.ins.on(l.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),t=!0;break}}a++}}}t?(this._parent&&(this._parent.addChild(this._btn),this._btn.event(l.EventName.UI_ADD_TO_STAGE)),this._opened||(this.popPrompt(),this._opened=!0),this.updateCD()):(Laya.timer.clear(this,this.updateCD),this._btn.parent&&(this._btn.removeSelf(),this._btn.event(l.EventName.UI_REMOVE_STAGE)))},t.prototype.onActivityDataChanged=function(t,e){e==this._currActivityId&&this.updateBtnShow()},t.prototype.popPrompt=function(){if(this._currActivityId)if(a.PlayManager.canGoToFuben()){var t=u.RoleCenter.instans.vo.getActivity1Data(this._currActivityId);if(t)for(var e,i=t.children.length,n=0;n<i;){if(e=t.children[n]){var s=p.GameConfig.subActivityJson[e.cfgId];if(s&&t.allData.allCount==s.value&&e.status==d.enumStatus.kelingqu){(new r.FlashSale3Prompt).showPrompt();break}}n++}}else h.E.ins.on(l.EventName.PLAY_TYPE_CHANGED,this,this.changePlaytype)},t.prototype.changePlaytype=function(){h.E.ins.off(l.EventName.PLAY_TYPE_CHANGED,this,this.changePlaytype),this.popPrompt()},t.prototype.updateCD=function(){if(this._cdLab){var t=g.DateUtil.getZeroTime()-v.ServerTime.serverTime;this._cdLab.changeText(g.DateUtil.getHMS_countdown(t)),Laya.timer.once(1e3,this,this.updateCD)}},t.prototype.doDestroy=function(){this._btn=null,this._cdLab=null,this._parent=null,o.AccessCenter.ins.off(278,this,this.onActivityAccessUpdate),h.E.ins.off(l.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.onActivityHallChanged),h.E.ins.off(l.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged)},t}();e.FlashSale3BtnCtrl=f}),define("src/g/gift/view/WXAuthGiftView",["require","exports","../../../config/GameConfig","../../../enum/enumItem","../../../vo/sbkUserVo","../../net/messages/ChannelGiftMsg","../../../manager/GameSocketManager","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","../../../utils/system/FloatEffect","../../../manager/AM","../../../enum/EventName","../../../core/E","src/g/gameSdk/gameSdk"],function(t,e,n,s,o,a,r,l,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;return t._cururl=[],t.btn_close.on(Laya.Event.CLICK,t,t.close),t.btnget.visible=!1,t}return __extends(t,i),t.prototype.update=function(){for(var t=0;t<this.cgvo.reward.length;t++){var e=l.ItemUtils.getItemOrEq(this.cgvo.reward[t][0]),i=this["reitem"+t];i&&h.ItemIconView.setItemData(e,i,this.cgvo.reward[t][1])}},t.prototype.getHandler=function(){var t=s.ChannelGiftIdEnum.wxauthGift;if(!window.iswx)return u.AM.show("微信授权领取!"),void this.close();var e=new a.TakeChannelGiftC2GS;e.id=t,r.GSM.sendServer(e),this.close(),o.sbkUserVo.getChannelGiftCnt(t)<=0||c.FE.upItems("奖励已领取"),d.E.ins.event(p.EventName.CHANNEL_GIFT_GET)},t.prototype.popup=function(){this.getcurrent(),this.update(),i.prototype.popup.call(this)},t.prototype.refreshHandler=function(){this.getcurrent(),this.update()},t.prototype.getcurrent=function(){this.cgvo=n.GameConfig.cGift[s.ChannelGiftIdEnum.wxauthGift]},t.prototype.close=function(t,e){"side"!=t&&(i.prototype.close.call(this,t,e),g.gameSdk.Ins.sdk.hideWxAuth&&g.gameSdk.Ins.sdk.hideWxAuth()&&console.log("隐藏授权"))},t}(ui.gift.WXAuthGiftUI);e.WXAuthGiftView=i}),define("src/g/gift/ctrl/WXAuthGiftCtrl",["require","exports","../../../vo/sbkUserVo","../../../enum/enumItem","../../../enum/EventName","../../../core/E","src/g/accessctrl/AccessCenter","src/g/gift/view/WXAuthGiftView","src/g/gameSdk/gameSdk","../../../utils/system/FloatEffect"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(t){this._isAdd=!1,this._btn=t,this._btn.visible=!0,this._btn.on(Laya.Event.CLICK,this,this.openHandler),o.E.ins.on(s.EventName.CHANNEL_GIFT_GET,this,this.removeHandler),o.E.ins.on(s.EventName.ADDED_LEVEL,this,this.onLvChanged),o.E.ins.on(s.EventName.getUserInfo,this,this.openHandler),this._parent=this._btn.parent,this.closeHandler(null)}return t.prototype.openHandler=function(){this._dlg=new r.WXAuthGiftView,this._dlg.popup();try{l.gameSdk.Ins.sdk.showWxAuth(function(t){t?this._dlg.getHandler():(h.FE.upItems("授权后可领取奖励"),this._dlg.close())}.bind(this))}catch(t){this.removeHandler()}},t.prototype.closeHandler=function(t){0<i.sbkUserVo.getChannelGiftCnt(n.ChannelGiftIdEnum.wxauthGift)?this.removeBtn():(this._dlg&&this._dlg.refreshHandler(),a.AccessCenter.ins.checkOpen(997)?this.addBtn():this.removeBtn())},t.prototype.onLvChanged=function(){a.AccessCenter.ins.checkOpen(997)?this.addBtn():this.removeBtn()},t.prototype.removeHandler=function(){0<i.sbkUserVo.getChannelGiftCnt(n.ChannelGiftIdEnum.wxauthGift)&&(this.removeBtn(),o.E.ins.off(s.EventName.CHANNEL_GIFT_GET,this,this.removeHandler),o.E.ins.off(s.EventName.ADDED_LEVEL,this,this.onLvChanged))},t.prototype.addBtn=function(){this._parent&&!this._isAdd&&(this._isAdd=!0,this._parent.addChild(this._btn),this._btn.event(s.EventName.UI_ADD_TO_STAGE))},t.prototype.removeBtn=function(){this._btn.parent&&(this._btn.removeSelf(),this._btn.event(s.EventName.UI_REMOVE_STAGE))},t}();e.WXAuthGiftCtrl=c}),define("src/g/gift/view/VIPServiceView",["require","exports","../../../manager/LayerManager","src/g/clearRes/ClearResM","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","../../../config/GameConfig","src/init/TextConst","../../../manager/RoleCenter"],function(t,e,i,n,o,a,s,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.view.btn_back.on(Laya.Event.CLICK,t,t.closeHandler),t.view.btn_close.on(Laya.Event.CLICK,t,t.closeHandler),t}return __extends(t,e),t.prototype.showView=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),i.LayerManager.addInPOPWindowLayer(this,t,!0,!0,!1,e),this.setComponent(),this.update(),n.ClearResM.resetViewImg(this)},t.prototype.update=function(){for(var t=0;t<this.cgvo.length;t++){var e=this.cgvo[t].split(":"),i=o.ItemUtils.getItemOrEq(e[0]),n=this["reitem"+t];n&&a.ItemIconView.setItemData(i,n,e[1])}this.lab_content.innerHTML=r.TextConst.get(1301),this.lab_award.innerHTML=r.TextConst.get(1302);var s=l.RoleCenter.instans.self.vipLv>=this.achievVIPLv;this.lab_qq.text=this.text_qqnum,this.lab_unachieve.text=this.text_unachieve,this.box_qq.visible=s,this.lab_unachieve.visible=!s},t.prototype.setComponent=function(){this.cgvo=s.GameConfig.commonJson.vipsupergiftshow.val2strArr,this.text_qqnum=s.GameConfig.commonJson.vipsupergiftyeshua.val2str,this.text_unachieve=s.GameConfig.commonJson.vipsupergiftnohua.val2str,this.achievVIPLv=s.GameConfig.commonJson.vipsuperlv.value,this.lab_content.style.leading=15,this.lab_content.style.bold=!0},t.prototype.closeHandler=function(){this.removeSelf()},t}(ui.gift.VIPServiceViewUI);e.VIPServiceView=h}),define("src/g/gift/ctrl/VIPServiceBtnCtrl",["require","exports","../../../enum/EventName","../../../core/E","src/g/accessctrl/AccessCenter","src/g/gift/view/VIPServiceView"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t){this._isAdd=!1,this._btn=t,this._btn.visible=!0,this._btn.on(Laya.Event.CLICK,this,this.openHandler),n.E.ins.on(i.EventName.VIP_EXP_CHANGED,this,this.btnShowHandler),n.E.ins.on(i.EventName.ADDED_LEVEL,this,this.onLvChanged),this._parent=this._btn.parent,this.btnShowHandler(null)}return t.prototype.openHandler=function(){this.open()},t.prototype.btnShowHandler=function(t){s.AccessCenter.ins.checkOpen(996)?this.addBtn():this.removeBtn()},t.prototype.addBtn=function(){this._parent&&!this._isAdd&&(this._isAdd=!0,this._parent.addChild(this._btn),this._btn.event(i.EventName.UI_ADD_TO_STAGE))},t.prototype.removeBtn=function(){this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE))},t.prototype.open=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1);var i=this._view;i||(this._view=i=new o.VIPServiceView),i.showView(t,e)},t.prototype.onLvChanged=function(){s.AccessCenter.ins.checkOpen(996)?this.addBtn():this.removeBtn()},t}();e.VIPServiceBtnCtrl=a}),define("src/g/index/view/IndexView",["require","exports","../../../manager/LayerManager","../../../core/E","src/g/index/ctrl/TaskLeftCtrl","../../../enum/EventName","../../../manager/RoleCenter","src/g/index/view/BattleModeShow","../../../utils/SoundUtils","../../../manager/NewRedHintsCenter","../../../utils/UIUtils","src/g/index/ctrl/HeadTopCtrl","src/g/index/ctrl/RightListViewCtrl","src/g/index/ctrl/BottmListViewCtrl","src/g/index/view/ChangeBtnView","src/g/index/ctrl/LeftListViewCtrl","../../../manager/FlyManager","../../net/messages/ChangeSceneMsg","src/g/accessctrl/AccessCenter","src/init/Switches","src/g/clearRes/ClearResM","../../../component/UDEffect","src/g/chat/view/ChatPreview","../../../enum/GuideTargetName","src/g/index/ctrl/FlashSaleBtnCtrl","src/g/index/ctrl/AdvanceNoticeBtnCtrl","src/g/proxy/compents/DrawerEffectManager","src/g/fightactivity/ctrl/FightActivityCtrl","src/g/index/view/SmallIconLayer","../../../utils/DialogQueue","src/g/fight/osprite/play/PlayManager","src/g/index/ctrl/IndexBtnsManager","src/g/index/ctrl/FlashSale2BtnCtrl","src/g/index/ctrl/LoginRewardBtnCtrl","src/g/index/ctrl/GameShareCtrl","src/g/index/view/HTTaskBar","../../../runtime/resload/GameResLoad","src/g/boss/ctrl/AotuFightCtrl","src/g/configjson/ctrl/ConfigJsonCtrl","src/g/gameSdk/gameSdk","src/g/gift/ctrl/WXGuideCtrl","src/g/index/ctrl/GameShare001Ctrl","src/g/gift/ctrl/WXGuide2Ctrl","src/g/index/ctrl/FlashSale3BtnCtrl","src/g/gift/ctrl/WXAuthGiftCtrl","src/g/gift/ctrl/VIPServiceBtnCtrl"],function(t,e,s,i,n,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E,T,A,R,L,x,P,k,D,H,M,G,B,N,U,V,O,F,q,K,Y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var j=function(e){function t(){var t=e.call(this)||this;return t.furl="dynamic/configjson/fword.txt",t.isInited=!1,t.bag_con=new R.SmallIconLayer,t.addChild(t.bag_con),new A.FightActivityCtrl,Laya.timer.frameOnce(1,t,t.viewInit),t.mapbg.width=Laya.stage.width,C.ClearResM.clearLogin(),t.btnsMgr=new P.IndexBtnsManager,t.btnsMgr.addGridCon(t.top_con),t.btnsMgr.addGridCon(t.left_con),t.btnsMgr.run(),B.AotuFightCtrl.init(),t.chatListHandler(),t}return __extends(t,e),t.prototype.chatListHandler=function(){var t=this.furl,e=Laya.loader;e.getRes(t);e.clearRes(t)},t.prototype.viewInit=function(){var t=window.debugbtn,e=window.sbkdiv;t&&(t.style.display="none"),e&&(e.style.display="none"),this.mouseThrough=!0,this.top_con.mouseThrough=!0,s.LayerManager.bgSkin=this.topbar.bg,this.mapbg.visible=!1,Laya.timer.frameOnce(1,this,this.initEvents),new u.HeadTopCtrl(this.topbar),new p.RightListViewCtrl(this.right_btncon),new d.BottmListViewCtrl(this.bottombar),new g.ChangeBtnViewCtrl(this.btn_change),v.LeftListViewCtrl.instance().init(this.leftcon,this),new S.FlashSaleBtnCtrl(this.btn_flashsale,this.lab_flashsale_cd),new k.FlashSale2BtnCtrl(this.btn_flashsale2,this.lab_flashsale2_cd),new q.FlashSale3BtnCtrl(this.btn_flashsale3,this.lab_flashsale3_cd),new D.LoginRewardBtnCtrl(this.login_reward),this.btn_share_activity.removeSelf(),this.btn_share001.removeSelf(),this.btn_wxguide.removeSelf(),this.btn_guide2.removeSelf(),this.btn_vipservice.removeSelf(),window.isbaize&&(this.btn_care.removeSelf(),this.btn_vipservice.removeSelf(),this.btn_kefu.removeSelf(),this.btn_share_first.removeSelf()),window.isdunwang,window.iswx?(window.isShenhe?(this.btn_wxguide.removeSelf(),this.btn_care.removeSelf(),this.btn_share.removeSelf(),this.btn_kefu.removeSelf(),this.btn_care2.removeSelf(),this.btn_share_activity.removeSelf(),this.btn_share_first.removeSelf(),this.btn_guide2.removeSelf(),this.btn_shop.removeSelf()):(new V.WxGuideCtrl(this.btn_wxguide),new V.WxCareCtrl(this.btn_care),new H.GameShareCtrl(this.btn_share),new O.GameShare001Ctrl(this.btn_kefu),new F.WxCare2Ctrl(this.btn_care2)),window.btn_authGift_show?new K.WXAuthGiftCtrl(this.btn_authGift):this.btn_authGift.removeSelf()):(this.btn_wxguide.removeSelf(),this.btn_care.removeSelf(),this.btn_share.removeSelf(),this.btn_kefu.removeSelf(),this.btn_care2.removeSelf(),this.btn_share_activity.removeSelf(),this.btn_share_first.removeSelf(),new V.WxCareCtrlShow(this.btn_follow),this.btn_authGift.removeSelf()),new E.AdvanceNoticeBtnCtrl(this.btn_advance_notice,this.btn_advance_notice_cd,this.effect_advance_notice),U.gameSdk.Ins.sdk.isHideInstall?this.btn_guide2.removeSelf():new F.WXGuide2Ctrl(this.btn_guide2),new Y.VIPServiceBtnCtrl(this.btn_vipservice),Laya.timer.frameOnce(2,this,this.registUIToGuide),Laya.timer.once(5e3,this,this.onAniHandler);var i=window.ktgamepreloadjdk.offY;this.topbar.y+=i,this.top_con.y+=i,this.leftcon.y+=i,this.left_con.y=this.leftcon.y+60;this.left_con.height=Laya.stage.height-400-this.left_con.y,this.left_con.capacity=Math.floor(this.left_con.height/82),this.btn_faqi.y+=30<i?20:0;var n=[{url:"res/atlas/res/bottom.json",type:Laya.Loader.ATLAS},{url:"res/atlas/res/indexicon.json",type:Laya.Loader.ATLAS},{url:"res/atlas/res/chat.json",type:Laya.Loader.ATLAS},{url:"res/atlas/res/fighteffect.json",type:Laya.Loader.ATLAS}];window.isNewLogin&&(Laya.timer.once(5e3,this,function(){U.gameSdk.Ins.sdk.customEventApp("entergame_5s")}),Laya.timer.once(55e3,this,function(){U.gameSdk.Ins.sdk.customEventApp("entergame_55s")}),Laya.timer.once(6e4,this,function(){N.ConfigJsonCtrl.ins.newcomerJoson()}),Laya.timer.once(7e4,this,function(){U.gameSdk.Ins.sdk.customEventApp("entergame_77s")}),Laya.timer.once(8e4,this,function(){wx.loadSubpackage({name:"core3",success:function(){window.requirejs(["src/g/a/GameInit2"],function(t){})}})})),Laya.timer.once(1e3,this,function(){G.GameResLoad.load(n)}),console.log(Laya.Browser.now()),console.log(" ClearResM.preprocessing",Laya.Browser.now())},t.prototype.diviData=function(t){},t.prototype.onAniHandler=function(){},t.prototype.dayHandler=function(){l.SoundUtils.getInstance().playBtnsounds(),_.Switches.ins.event(18),i.E.ins.event(o.EventName.COMPTYPE_CLICK,w.GuideTargetName.MAIN_PRACTICE_BTN)},t.prototype.registUIToGuide=function(){},t.prototype.initEvents=function(){a.RoleCenter.instans;i.E.ins.on(o.EventName.PLAY_TYPE_CHANGED,this,this.changePlaytype),this.btn_shop.on(Laya.Event.CLICK,this,this.shopClickHandler),this.btn_chat.on(Laya.Event.CLICK,this,this.chatHandler),this.btn_friends.on(Laya.Event.CLICK,this,this.openFriendsHandler),this.btn_private_chat.on(Laya.Event.CLICK,this,this.openPrivateChat),h.NewRedHintsCenter.ins.checkRedIsOpen(h.enumRedHints.friends_chat)&&this.appendPrivateContent(),i.E.ins.on(o.EventName.ADD_PRIVATE_CHAT_CONTENT,this,this.appendPrivateContent),i.E.ins.on(o.EventName.SOCIETY_APPLYLISTCHANGE,this,this.checkGuildApplyList),Laya.timer.frameOnce(1,this,this.initOtherUIAndCtrl),this.upShareType()},t.prototype.upShareType=function(){},t.prototype.openFriendsHandler=function(){l.SoundUtils.getInstance().playBtnsounds(),_.Switches.ins.event(104)},t.prototype.appendPrivateContent=function(){this._chatBtnEffect||(this._chatBtnEffect=new I.UDEffect),this.btn_private_chat.visible=!0,this._chatBtnEffect.effectAlpha(this.btn_private_chat,.5,500)},t.prototype.openPrivateChat=function(){this._chatBtnEffect&&(this._chatBtnEffect.clear(),this._chatBtnEffect=null),this.btn_private_chat.visible=!1,l.SoundUtils.getInstance().playBtnsounds(),_.Switches.ins.event(106)},t.prototype.initOtherUIAndCtrl=function(){var t=(new n.TaskLeftCtrl).init();this.addChild(t),this.addChild(new M.HTTaskBar),this.taskView=t,this.chatbox.addChild(new b.ChatPreview),this.addChild(this.chatbox),new r.BattleModeShow(this.img_battle_mode),this.city_fun_container.visible=!1,Laya.timer.frameOnce(1,this,this.doInit),this.skillBox.zOrder=9999},t.prototype.doInit=function(){this.init(),this.shopTipHandler();var t=c.UIUtils.localToGlobal(this.bottombar.btn_bag.parent,new Laya.Point(this.bottombar.btn_bag.x+this.bottombar.btn_bag.width/2,this.bottombar.btn_bag.y+this.bottombar.btn_bag.height/2));f.FlyManager.ins.registerPos(f.FlyManager.BTN_BAG,t),i.E.ins.event(o.EventName.INDEX_VIEW_INIT_COMPLET),this.isInited=!0},t.prototype.onSimplyHandler=function(t){this._simplyState=t,this.updateEffectShow(),T.DrawerEffectManager.ins.onSimplyHandler(t)},t.prototype.checkGuildApplyList=function(){},t.prototype.shopTipHandler=function(){Laya.timer.once(2e3,this,function(){20<a.RoleCenter.instans.vo.getCurLv()&&(this.shop_tip.visible=!0,this.shop_tip.alpha=1,Laya.Tween.to(this.shop_tip,{alpha:1},2e3,null,Laya.Handler.create(this,function(){this.shop_tip.removeSelf()})))})},t.prototype.updateEffectShow=function(){this.effect_layer.visible=this._effectShow&&!this._simplyState},t.prototype.changePlaytype=function(){this.city_fun_container.visible=x.PlayManager.type==y.EPlayType.PLAYTYPE_MAINCITY&&!a.RoleCenter.instans.vo.newbee,v.LeftListViewCtrl.instance().playTypeChanged(),x.PlayManager.type==y.EPlayType.PLAYTYPE_PORT?(this.right_btncon.visible=!0,this.btn_faqi.visible=!0,this.leftcon.visible=window.enabledpay,this.left_con.visible=!0,this._effectShow=!0,i.E.ins.event(o.EventName.HANGUP),this.top_con.visible=!0,this.topbar.visible=!0):x.PlayManager.type==y.EPlayType.PLAYTYPE_NEWVILLAGE?(this.right_btncon.visible=!1,this.btn_faqi.visible=!1,this.leftcon.visible=!1,this.left_con.visible=!1,this._effectShow=!1,this.top_con.visible=!0,this.topbar.visible=!0):x.PlayManager.type==y.EPlayType.PLAYTYPE_MAINCITY?(a.RoleCenter.instans.vo.newbee?(this.right_btncon.visible=!1,this.btn_faqi.visible=!1,this.leftcon.visible=!1,this.left_con.visible=!1,this._effectShow=!1):(this.right_btncon.visible=!0,this.btn_faqi.visible=!0,this.leftcon.visible=window.enabledpay,this.left_con.visible=!0,this._effectShow=!0),this.top_con.visible=!0):(this.right_btncon.visible=!1,this.btn_faqi.visible=!1,this.leftcon.visible=!1,this.left_con.visible=!1,this._effectShow=!1,i.E.ins.event(o.EventName.HITBOSS),this.top_con.visible=!1,this.topbar.visible=!1),this.updateEffectShow(),i.E.ins.event(o.EventName.SC_ENTRANCE_STATUS_CHANGED),L.DialogQueue.getInstance().isInit()||L.DialogQueue.getInstance().init()},t.prototype.shopClickHandler=function(){l.SoundUtils.getInstance().playBtnsounds(),m.AccessCenter.ins.checkOpen(7,!0)&&(h.NewRedHintsCenter.ins.setRedHintOpenOrClose(h.enumRedHints.shop,!1),this.shop_tip.removeSelf(),_.Switches.ins.event(7))},t.prototype.chatHandler=function(){l.SoundUtils.getInstance().playBtnsounds(),_.Switches.ins.event(24)},t.prototype.init=function(){},t.prototype.showView=function(){},t.prototype.hideView=function(){},t.prototype.destroyView=function(){},t}(ui.index.IndexUI);e.IndexView=j}),define("src/g/guide/view/GuideTipUpView",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setTip=function(t){this.txt.text=t},e}(ui.guide.GuideTipUpUI);e.GuideTipUpView=i}),define("src/g/guide/ctrl/GuideTipCtrl",["require","exports","../../../manager/LayerManager","../../../enum/EventName","src/g/guide/view/GuideTipUpView","src/g/guide/view/GuideTipDownView","../../../core/E","src/g/Effects/UIEffectsFactory","../../../component/UDEffect","../../../manager/GuideCenter","../../../manager/RunTimeUIManager","../../../utils/UIUtils"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(){function t(){this.ef=new l.UDEffect,this._tryNum=0}return t.prototype.init=function(){a.E.ins.on(n.EventName.POP_GUIDE_TIP,this,this.onPopGuideTip),a.E.ins.on(n.EventName.CLOSE_GUIDE_TIP,this,this.onCloseGuideTip),a.E.ins.on(n.EventName.SET_INTERACTION_AREA,this,this.onSetInteractionArea)},t.prototype.onSetInteractionArea=function(t){i.LayerManager.setGuideInteractionArea(t)},t.prototype.onPopGuideTip=function(t){if(this.vo=t,this._tryNum++,this._uEf=r.UIEffectsFactory.Ins.createUIAniById(24,!0),this._tryNum=0,1==t.direction){if(this._upview||(this._upview=new s.GuideTipUpView),this._upview.setTip(t.text),!t.mask&&h.GuideCenter.ins.getGuideObject(t.guideObj))(e=h.GuideCenter.ins.getGuideObject(t.guideObj)).addChild(this._uEf),e.addChild(this._upview);else i.LayerManager.addTaskGuideLayer(this._uEf),i.LayerManager.addTaskGuideLayer(this._upview);i.LayerManager.setTaskGuideLayerMask(t.mask,h.GuideCenter.ins.getGuideObject(t.guideObj)),t.mask&&a.E.ins.event(n.EventName.GUIDE_MASK_START,t.guideObj),this.ef.effect(this._upview,20,300)}else if(2==t.direction){var e;if(this._downview||(this._downview=new o.GuideTipDownView),this._downview.setTip(t.text),!t.mask&&h.GuideCenter.ins.getGuideObject(t.guideObj))(e=h.GuideCenter.ins.getGuideObject(t.guideObj)).addChild(this._uEf),e.addChild(this._downview);else i.LayerManager.addTaskGuideLayer(this._uEf),i.LayerManager.addTaskGuideLayer(this._downview);i.LayerManager.setTaskGuideLayerMask(t.mask,h.GuideCenter.ins.getGuideObject(t.guideObj)),t.mask&&a.E.ins.event(n.EventName.GUIDE_MASK_START,t.guideObj),this.ef.effect(this._downview,20,300)}Laya.timer.frameLoop(1,this,this.onLoop),this.onLoop()},t.prototype.onLoop=function(){var t,e=c.RunTimeUIManager.ins.getUI(h.GuideCenter.ins.getRaletAccessId(this.vo.guideObj));e&&e.displayedInStage&&(t=u.UIUtils.getGlobalBound(e)),t||(t=h.GuideCenter.ins.getInteractionArea(this.vo.guideObj));var i=this.vo.point[0],n=this.vo.point[1];t&&(i=t.x+t.width/2,n=t.y+t.height/2),1==this.vo.direction?(n+=50,this._upview.x=i,this._upview.y=n,this._uEf.x=i-this._uEf.width/2,this._uEf.y=n-50-this._uEf.height/2):(n-=50,this._downview.x=i,this._downview.y=n,this._uEf.x=i-this._uEf.width/2,this._uEf.y=n+50-this._uEf.height/2)},t.prototype.onCloseGuideTip=function(){Laya.timer.clear(this,this.onLoop),this._upview&&this._upview.parent&&this._upview.parent.removeChild(this._upview),this._downview&&this._downview.parent&&this._downview.parent.removeChild(this._downview),this._uEf&&this._uEf.parent&&this._uEf.parent.removeChild(this._uEf),this.ef.clear(),i.LayerManager.setTaskGuideLayerMask(!1),a.E.ins.event(n.EventName.GUIDE_MASK_STOP)},t}();e.GuideTipCtrl=p}),define("src/g/index/ctrl/GameIndexCtrl",["require","exports","../../../enum/JobEnum","src/g/index/ctrl/PortViewCtrl","../../net/messages/StartAutoFightGS2C","../../../manager/GameSocketManager","../../../manager/TaskManager","src/g/guide/ctrl/NewComerCtrl","src/g/fight/osprite/GameScene","../../../manager/RoleCenter","../../../manager/BulletManager","src/g/index/view/IndexView","../../../core/E","../../../enum/EventName","../../../manager/LayerManager","../../net/messages/UserDataChangeGS2C","../../../manager/GuideCenter","src/g/guide/ctrl/GuideTipCtrl","../../../enum/GuideTargetName","../../../utils/UIUtils","src/g/fight/info/PlayTypeVo","../../net/messages/ChangeSceneMsg","../../../utils/ItemUtils","src/init/Switches","src/g/fight/osprite/play/MainCityManager","../../net/messages/DivinationData"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var T=function(){function t(){this.showIconArr=[],this.showNameArr=[],this.state=0,p.E.ins.on(d.EventName.INIT_INDEX,this,this.init),w.Switches.ins.on(147,this,this.guideHandler),w.Switches.ins.on(148,this,this.guidTaskGuideHandler),o.GSM.ins.on(E.DivinationData.KEY,this,this.diviData)}return t.prototype.diviData=function(t){this._view&&this._view.diviData(t)},t.prototype.guideHandler=function(t,e){p.E.ins.event(d.EventName.PLAY_TYPE_CHANGE,C.PlayTypeVo.create(I.EPlayType.PLAYTYPE_TASKBOSS,{portid:e}))},t.prototype.guidTaskGuideHandler=function(t,e){p.E.ins.event(d.EventName.PLAY_TYPE_CHANGE,C.PlayTypeVo.create(I.EPlayType.PLAYTYPE_TASKFAMILY,{portid:e}))},t.prototype.addElement=function(t){this._view.addChildAt(t,0)},t.prototype.right_conHandler=function(t){this._view.addChildAt(t,0)},t.prototype.init=function(){l.GameScene.ins.initScene(),p.E.ins.on(d.EventName.LOGINCTRLDESTROY,this,this.initGameHandler),a.TaskManager.ins.init(),f.GuideCenter.ins.init(),p.E.ins.event(d.EventName.COMPLETE_INDEX)},t.prototype.initGameHandler=function(){this.state=1,Laya.timer.frameLoop(1,this,this.initFrameHandler)},t.prototype.initFrameHandler=function(){1==this.state?(c.BulletManager.init(),this.state++):2==this.state?(this._view||(this._view=new u.IndexView,t.idxView=this._view,g.LayerManager.addInUILayer(this._view)),this._view.isInited&&this.state++):3==this.state?(this._portCtrl||(this._portCtrl=new n.PortViewCtrl),this.state++):4==this.state?(this.initData(),this.state++):5==this.state?(this._guideTipCtrl||(this._guideTipCtrl=new y.GuideTipCtrl,this._guideTipCtrl.init(),Laya.timer.once(800,this,function(){f.GuideCenter.ins.startGuide()}),this.registUIToGuide()),this.state++):6==this.state?this.state++:7==this.state&&(Laya.timer.clear(this,this.initFrameHandler),this.state=0)},t.prototype.registUIToGuide=function(){var t=_.UIUtils.getGlobalBound(this._view.bottombar.btn_role);t&&(f.GuideCenter.ins.registerInteractionArea(m.GuideTargetName.MAIN_ROLE_BTN,t),f.GuideCenter.ins.registerGuideObject(m.GuideTargetName.MAIN_ROLE_BTN,g.LayerManager.getMainGuideLayer())),(t=_.UIUtils.getGlobalBound(this._view.bottombar.btn_forge))&&(f.GuideCenter.ins.registerInteractionArea(m.GuideTargetName.MAIN_FORGE_BTN,t),f.GuideCenter.ins.registerGuideObject(m.GuideTargetName.MAIN_FORGE_BTN,g.LayerManager.getMainGuideLayer())),(t=_.UIUtils.getGlobalBound(this._view.bottombar.btn_day))&&(f.GuideCenter.ins.registerInteractionArea(m.GuideTargetName.MAIN_PRACTICE_BTN,t),f.GuideCenter.ins.registerGuideObject(m.GuideTargetName.MAIN_PRACTICE_BTN,g.LayerManager.getMainGuideLayer()))},t.prototype.startAutoFightGS2C=function(t){h.RoleCenter.instans.self.portstatus.portindex=t.portidx,h.RoleCenter.instans.event(d.EventName.ROLE_PROP_CHANGE+v.EUType.newport),p.E.ins.event(d.EventName.PLAY_TYPE_CHANGE,C.PlayTypeVo.create(I.EPlayType.PLAYTYPE_PORT))},t.prototype.initData=function(){this._isInitData||(o.GSM.ins.on(s.StartAutoFightGS2C.KEY,this,this.startAutoFightGS2C),l.GameScene.ins.initScene(),(new r.NewComerCtrl).init(),this._isInitData=!0),this.reInitData()},t.prototype.reInitData=function(){h.RoleCenter.instans.self.newbee?a.TaskManager.ins.currentTask&&1900<=a.TaskManager.ins.currentTask.id&&a.TaskManager.ins.currentTask.id<=2400?(p.E.ins.event(d.EventName.PLAY_TYPE_CHANGE,C.PlayTypeVo.create(I.EPlayType.PLAYTYPE_MAINCITY,{portid:100})),p.E.ins.event(d.EventName.CHANGE_PORT_MODE,i.TypeMode.ZHUCHENG)):(p.E.ins.event(d.EventName.PLAY_TYPE_CHANGE,C.PlayTypeVo.create(I.EPlayType.PLAYTYPE_NEWVILLAGE)),p.E.ins.event(d.EventName.CHANGE_PORT_MODE,i.TypeMode.NEWCOMER)):h.RoleCenter.instans.vo.portstatus.inMainCity?S.MainCityManager.getInstance().ChangeToMainCity():(p.E.ins.event(d.EventName.PLAY_TYPE_CHANGE,C.PlayTypeVo.create(I.EPlayType.PLAYTYPE_PORT)),p.E.ins.event(d.EventName.CHANGE_PORT_MODE,i.TypeMode.GUAJI))},t.prototype.clickHeadHandler=function(t){p.E.ins.event(d.EventName.SELECT_TARGET_INDEX,t)},t.prototype.updateHeadIcon=function(t){if(t)for(var e=null,i=null,n=null,s=null,o=0;o<t.length;o++)n=t[o],this.showIconArr[o]?(e=this.showIconArr[o],i=this.showNameArr[o]):((e=this.showIconArr[o]=new Laya.Image).on(Laya.Event.CLICK,this,this.clickHeadHandler,[o]),Laya.stage.addChild(e),(i=this.showNameArr[o]=new Laya.Text).color="#10b1e6",i.strokeColor="#000000",i.stroke=2,i.fontSize=18,Laya.stage.addChild(i)),n&&0<n.getFightCount()?((s=n.getUnitByIndex(0))&&(e.skin=b.ItemUtils.getHeadUrl(s.sex,s.job),i.text=s.actorName),e.visible=!0,e.width=50,e.height=50,i.visible=!0,i.x=e.x=500,i.y=e.y=200+51*o):(e.visible=!1,i.visible=!1);else this.hideAllHead()},t.prototype.hideAllHead=function(){for(var t=0;t<this.showIconArr.length;t++)this.showIconArr[t].visible=!1,this.showNameArr[t].visible=!1},t}();e.GameIndexCtrl=T}),define("src/g/index/ctrl/PortViewCtrl",["require","exports","../../../manager/AM","src/g/fight/osprite/play/PlayManager","../../../manager/RoleCenter","src/g/fight/osprite/GameScene","../../../enum/EventName","../../../core/E","../../../utils/UIUtils","../../../enum/GuideTargetName","../../../manager/StateManger","src/g/fight/info/PlayTypeVo","src/g/index/ctrl/GameIndexCtrl","../../net/messages/ChangeSceneMsg","../../../utils/system/FloatEffect","src/g/Effects/UIEffectsFactory","src/g/accessctrl/AccessCenter","../../../plugin/view/ToolTip","src/g/guide/view/GuideTipDownView","../../../component/UDEffect","src/g/fight/osprite/play/MainCityManager","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I){"use strict";var b;Object.defineProperty(e,"__esModule",{value:!0}),(b=e.EPortViewS||(e.EPortViewS={}))[b.hide=0]="hide",b[b.notEnoughCount=1]="notEnoughCount",b[b.canChallenge=2]="canChallenge",b[b.reddot=3]="reddot";var w=function(){function t(){this._onAutoBegin=!1,this._count=0,this._total=10,this.ef=new _.UDEffect,this.init(),this.initview(),t._ins=this}return t.getins=function(){return this._ins?this._ins:new t},t.prototype.onLoadUIEF=function(){this.ani_put=v.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this._view.btn_autoBegin,19,.68,.52)},t.prototype.init=function(){r.E.ins.on(a.EventName.KILL_MONSTERWAVE,this,this.waveMonsterSet),r.E.ins.on(a.EventName.OFF_AUTO_FIGHT,this,this.offAutoFight),r.E.ins.on(a.EventName.ENTER_PORT_COPY,this,this.onEnterPort),r.E.ins.on(a.EventName.PLAY_TYPE_CHANGED,this,this.setPortVisible)},t.prototype.setPortVisible=function(){this._view&&n.PlayManager.type==d.EPlayType.PLAYTYPE_MAINCITY&&(this._view.visible=!1)},t.prototype.setTimeCount=function(t,e){this._view&&(this._count=t,this._total=e,this._view.img_bar.width=91*(1-this._count/e),this._view.visible=!0,this.setVisibleHandler(),this._view.port_value.value=s.RoleCenter.instans.vo.portstatus.portindex-100+"",0==t?(this._view.port_ani.visible=!0,this.isAutoBattle&&this.onViewClick()):this._view.port_ani.visible=!1)},t.prototype.setVisibleHandler=function(){f.AccessCenter.ins.checkOpen(102)?this._view.btn_autoBegin.label=I.TextConst.get(598):this._view.btn_autoBegin.label=I.TextConst.get(341)},t.prototype.delayHandler=function(){this.onViewClick()},t.prototype.onEnterPort=function(){f.AccessCenter.ins.checkOpen(20)?this.checkEnter()&&(n.PlayManager.ins.crtType==d.EPlayType.PLAYTYPE_MAINCITY&&C.MainCityManager.getInstance().ExitMainCity(),this.addGuideArrow()):this.onViewClick()},t.prototype.addGuideArrow=function(){if(this._view){if(this._view.parent&&this._view.parent.addChild(this._view),!this.isGuide){s.RoleCenter.instans.vo.portstatus.portindex;var t=this._view.port_bg,e=l.UIUtils.getBoundForContianer(t,this._view);this._uEf&&(this._uEf.clear(),this._uEf=null),this._uEf=v.UIEffectsFactory.Ins.createUIAniById(24,!0),this._uEf.x=e.x+e.width/2-this._uEf.width/2,this._uEf.y=e.y+e.height/2-this._uEf.height/2+10,this._downview||(this._downview=new m.GuideTipDownView,this._downview.setTip(I.TextConst.get(599))),this._downview.x=e.x+e.width/2,this._downview.y=e.y+e.height/2-50,this._view.addChild(this._uEf),this._view.addChild(this._downview),this.ef.effect(this._downview,20,300),this.isGuide=!0}}else g.FE.upItems(I.TextConst.get(600),y.BubbleEnum.center)},t.prototype.removeGuideArrow=function(){this._downview&&this._downview.removeSelf(),this._uEf&&this._uEf.removeSelf(),this.ef.clear(),this.isGuide=!1},t.prototype.checkEnter=function(){return!n.PlayManager.loading&&(!c.StateManger.isSpecialPlay()&&(!!s.RoleCenter.instans.bagRoomEnough()||(this.offAutoFight(),i.AM.showBagNotEnough(),!1)))},t.prototype.onViewClick=function(){this.checkEnter()&&(s.RoleCenter.instans.vo.portstatus.portindex%10==0?(r.E.ins.event(a.EventName.PLAY_TYPE_CHANGE,u.PlayTypeVo.create(d.EPlayType.PLAYTYPE_PORT_LEVEL,null,!1)),this.removeGuideArrow()):(this.removeGuideArrow(),r.E.ins.event(a.EventName.PLAY_TYPE_CHANGE,u.PlayTypeVo.create(d.EPlayType.PLAYTYPE_PORT_LEVEL,null,!1))))},Object.defineProperty(t.prototype,"isAutoBattle",{get:function(){return this._onAutoBegin},enumerable:!0,configurable:!0}),t.prototype.onAutoBegin=function(){this._onAutoBegin=!0,this.ani_put.visible=!0,this._count<=1&&this.onViewClick(),this._count=5},t.prototype.offAutoFight=function(){this._onAutoBegin=!1,this.ani_put.visible=!1},t.prototype.initview=function(){this._view||(this._view=p.GameIndexCtrl.idxView.right_btncon.portview,this._view.visible=!1,this.onLoadUIEF(),this._view.btn_autoBegin.on(Laya.Event.CLICK,this,this.clickOnAutoBegin),this._view.port_bg.on(Laya.Event.CLICK,this,this.onViewClick),this.offAutoFight()),r.E.ins.on(a.EventName.GUIDE_MASK_START,this,this.onGuideMaskStart),r.E.ins.on(a.EventName.GUIDE_MASK_STOP,this,this.onGuideMaskStop),Laya.timer.frameOnce(2,this,this.registUIToGuide)},t.prototype.onGuideMaskStart=function(){},t.prototype.onGuideMaskStop=function(){},t.prototype.clickOnAutoBegin=function(){if(f.AccessCenter.ins.checkOpen(102,!0))return s.RoleCenter.instans.bagRoomEnough()?(r.E.ins.event(a.EventName.COMPTYPE_CLICK,h.GuideTargetName.PORT_BTN_AUTO_START),void(this._onAutoBegin?this.offAutoFight():(this.onAutoBegin(),this.removeGuideArrow()))):(this.offAutoFight(),void i.AM.showBagNotEnough());this.onViewClick()},t.prototype.registUIToGuide=function(){},t.prototype.waveMonsterSet=function(t){o.GameScene.ins.port.count},t}();e.PortViewCtrl=w}),define("src/g/pvp1v1/view/Port_RankItem",["require","exports","../../../utils/ItemUtils","../../../utils/UIUtils"],function(t,e,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(t,e){this.rank_icon.visible=e<3?(this.rank_icon.skin="res/rank/new/paihang_huizhang"+(e+1)+".png",!0):(this.indexfont.value=e+1+"",!1),this.name_txt.text=t.nickname,this.imgVip.skin=s.ItemUtils.getVipIconByLevel(t.vipLv),this.imgVip.visible=window.enabledpay,o.UIUtils.nameAndVipDisplay(this.imgVip,this.name_txt),this.count.text=t.value1%1e4+"";var i=Math.floor(t.value1/1e6),n=9-Math.floor(t.value1%1e6/1e5);this.icon.skin=4==i?"res/tianti/tianti_xunzhang0041.png":"res/tianti/tianti_xunzhang00"+i+n+".png"},e}(ui.playtype.Port_RankItemUI);e.Port_RankItem=i}),define("src/g/pvp1v1/view/PortHighRankPage",["require","exports","../../net/messages/rank/RankDataGS2C","../../../manager/GameSocketManager","../../../core/GNet","../../net/messages/rank/sbkRankDataBase","src/g/pvp1v1/view/Port_RankItem","../../../manager/RoleCenter","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.mouseThrough=!0,n.GSM.ins.on(i.RankDataGS2C.KEY,t,t.resultHandler),t.list.itemRender=a.Port_RankItem,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=100,t.list.renderHandler=new Laya.Handler(t,t.rendHandler),t}return __extends(t,e),t.prototype.rendHandler=function(t,e){t.setData(this.list.array[e],e)},t.prototype.resultHandler=function(t){if(t.opresult&&t.rankIdArr[0]==o.enumRankID.rankid_8){this.list.array=t.rankDataArr;var e=t.rankIdArr[2];this.myRank_txt.text=200<e?l.TextConst.get(682):l.TextConst.get(683,t.rankIdArr[2]+1)}},t.prototype.showView=function(){var t=r.RoleCenter.instans.vo.getKingData();4!=t.group?this.icon_icon.skin="res/tianti/tianti_xunzhang00"+t.group+t.dan+".png":this.icon_icon.skin="res/tianti/tianti_xunzhang0041.png",this.chuang_txt.text=l.TextConst.get(87,t.victoryFight),s.GNet.getRankList(o.enumRankID.rankid_8,1,50)},t}(ui.playtype.Port_High_RankUI);e.PortHighRankPage=h}),define("src/g/pvp1v1/view/LastWeekItem",["require","exports","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","src/init/TextConst"],function(t,e,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(t,e){void 0===e&&(e=-1),this.rank_name.text="";var i=t.group;4==i?this.rank_name.text=r.TextConst.get(667):3==i?this.rank_name.text=r.TextConst.get(668):2==i?this.rank_name.text=r.TextConst.get(669):1==i&&(this.rank_name.text=r.TextConst.get(670)),this.icon.scaleX=.5,this.icon.scaleY=.5,4==t.group?this.icon.skin="res/tianti/tianti_xunzhang0041.png":this.icon.skin="res/tianti/tianti_xunzhang00"+t.group+"5.png";var n=parseInt(t.reward[0][0]),s=o.ItemUtils.getItemOrEq(n);a.ItemIconView.setItemData(s,this.item)},e}(ui.playtype.LastWeekItemtsUI);e.LastWeekItem=i}),define("src/g/pvp1v1/view/LastFiveItem",["require","exports","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","src/init/TextConst"],function(t,e,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(t,e){void 0===e&&(e=0),this.rank_name.text=a.TextConst.get(666,e+1),this.icon.skin="res/tianti/tianti_xunzhang001.png";var i=parseInt(t.reward[0][0]),n=s.ItemUtils.getItemOrEq(i);o.ItemIconView.setItemData(n,this.item),this.index_txt.text=e+1+"",this.icon_rank.skin=e<3?"res/index1/yezhan_paimingjiangli_"+(e+1)+".png":"",this.item.lvl.text=""},e}(ui.playtype.LastFiveItemUI);e.LastFiveItem=i}),define("src/g/pvp1v1/view/LastWeekView",["require","exports","../../../config/GameConfig","../../net/messages/KingDataGS2C","../../../core/GNet","src/g/pvp1v1/view/LastWeekItem","../../net/messages/OpNoParaC2GS","../../../manager/GameSocketManager","../../../manager/RoleCenter","src/g/pvp1v1/view/LastFiveItem","src/g/Effects/UIEffectsFactory","../../../manager/NewRedHintsCenter","src/init/TextConst"],function(t,e,o,i,s,n,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.list2.itemRender=n.LastWeekItem,t.list1.vScrollBarSkin="",t.list2.vScrollBarSkin="",t.list1.scrollBar.elasticDistance=100,t.list2.scrollBar.elasticDistance=100,t.list1.itemRender=h.LastFiveItem,r.GSM.ins.on(i.KingRankGS2C.KEY,t,t.lastWeekRank),t.list1.renderHandler=new Laya.Handler(t,t.render1Handler),t.list2.renderHandler=new Laya.Handler(t,t.render2Handler),t.mouseThrough=!0,t.onLoadUIEF(),t}return __extends(t,e),t.prototype.onLoadUIEF=function(){this.ani_put=c.UIEffectsFactory.Ins.createUIAniById(40,!0),c.UIEffectsFactory.Ins.centered4Parent(this.ani_put,this.btn_get,!0)},t.prototype.render1Handler=function(t,e){t.setData(this.list1.array[e],e)},t.prototype.render2Handler=function(t,e){t.setData(this.list2.array[e])},t.prototype.lastWeekRank=function(t){var e=t.lastWeekRankFive;if(e.length)this.list1.array=e;else{var i=[],n=o.GameConfig.kingRankRewards;for(var s in n)i.push(n[s]);this.list1.array=i}},t.prototype.showView=function(t){s.GNet.sendFight(a.EOpNopara.updateKingRankData);t=o.GameConfig.KingVo;var e=[];for(var i in t){e[parseInt(t[i].group)-1]=t[i]}e.reverse(),this.list2.array=e,this.jingshengchang_txt.text=p.TextConst.get(87,1),this.icon_icon.skin="";var n=l.RoleCenter.instans.vo.getKingData();this.jingshengchang_txt.text=p.TextConst.get(87,n.lastWeekVF),4==n.lastWeekGroup?this.icon_icon.skin="res/tianti/tianti_xunzhang0041.png":this.icon_icon.skin="res/tianti/tianti_xunzhang00"+n.lastWeekGroup+n.lastWeekDan+".png",this.btn_get.visible=!1,this.ani_put.visible=!1,n.lastWeekBonus&&(this.btn_get.visible=!0,this.ani_put.visible=!0,this.btn_get.once(Laya.Event.CLICK,this,function(){s.GNet.sendFight(a.EOpNopara.getLastWeekBonus),this.btn_get.visible=!1,this.ani_put.visible=!1,u.NewRedHintsCenter.ins.setRedHintOpenOrClose(u.enumRedHints.lastweekBtn,!1),n.lastWeekBonus=0}))},t}(ui.playtype.LastWeekViewUI);e.LastWeekView=d}),define("src/g/pvp1v1/view/Port_highView.",["require","exports","../../../enum/EventName","../../../core/E","../../../manager/LayerManager","src/g/pvp1v1/view/PortHighRankPage","src/g/pvp1v1/view/LastWeekView"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.view.btn_back.on(Laya.Event.CLICK,t,t.closeHandler),t.view.btn_close.on(Laya.Event.CLICK,t,t.closeHandler),t.tab.selectHandler=new Laya.Handler(t,t.selecteHandler),n.E.ins.on(i.EventName.PORT_HIGHVIEW_CLOSE,t,t.closeHandler),t}return __extends(t,e),t.prototype.closeHandler=function(){this.removeSelf()},t.prototype.selecteHandler=function(t){this.setItemView(),0==t?(this._view2||(this._view2=new o.PortHighRankPage),this.title_img.skin="res/title/pamingjiangli.png",this._view2.showView(),this.addChild(this._view2)):(this._view3||(this._view3=new a.LastWeekView),this.title_img.skin="res/title/biaoti_tianti.png",this._view3.showView(),this.addChild(this._view3))},t.prototype.setItemView=function(){this._view2&&this._view2.removeSelf(),this._view3&&this._view3.removeSelf()},t.prototype.showView=function(){s.LayerManager.addInPOPWindowLayer(this),this.tab.selectedIndex=0,this._view1&&this._view1.showView()},t}(ui.playtype.Port_highViewUI);e.Port_highView=r}),define("src/g/pvp1v1/ctrl/ChallengeRecover",["require","exports","../../../utils/ItemUtils","../../../manager/RoleCenter","../../../utils/system/ServerTime","../../../core/E","../../../enum/EventName"],function(t,e,n,s,i,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this._recoverStartTime=0,this._recoverGap=7200,this.timerRunning=!1}return t.prototype.init=function(){this.updRecoverStatus(!0)},t.instance=function(){return null==t._ins&&(t._ins=new t),t._ins},t.prototype.updRecoverStatus=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=0),this.isAutoRecover(e)?0==this.timerRunning&&(this._recoverStartTime=t?s.RoleCenter.instans.vo.getKingData().cdStartTime:i.ServerTime.serverTime,Laya.timer.loop(1e3,this,this.countDownHander),this.timerRunning=!0):this.stopAutoRecover()},t.prototype.countDownHander=function(){this._recoverGap-(i.ServerTime.serverTime-this._recoverStartTime)<=0&&(s.RoleCenter.instans.vo.KING++,o.E.ins.event(a.EventName.CHALLENGE_RECOVER),o.E.ins.event(a.EventName.KING_ATHLETICS_NUM_OF_CHALLENGES),this.isAutoRecover()?this._recoverStartTime=i.ServerTime.serverTime:this.stopAutoRecover())},t.prototype.stopAutoRecover=function(){this.timerRunning=!1,this._recoverStartTime=0,Laya.timer.clear(this,this.countDownHander)},t.prototype.isAutoRecover=function(t){void 0===t&&(t=0);var e=n.ItemUtils.getKingSettingById(1),i=s.RoleCenter.instans.vo.getKingData();return!(s.RoleCenter.instans.vo.KING+i.goldBuyCnt+t>=e.maxcount)},t.prototype.totalPointCanBeUsed=function(){var t=s.RoleCenter.instans.vo.getKingData();return s.RoleCenter.instans.vo.KING+t.goldBuyCnt},t.prototype.recoverStartTime=function(){return this._recoverStartTime},t.prototype.recoverGap=function(){return this._recoverGap},t}();e.ChallengeRecover=r}),define("src/g/pvp1v1/view/PortHighFightPage",["require","exports","src/g/index/ctrl/PortViewCtrl","../../../meta/KingVo","../../../manager/AM","src/g/fight/info/PlayTypeVo","../../../enum/EventName","../../../core/E","../../net/messages/KingDataGS2C","../../../utils/ItemUtils","../../../core/GNet","../../../manager/GameSocketManager","../../../manager/RoleCenter","../../net/messages/OpNoParaC2GS","../../../config/GameConfig","../../../utils/system/FloatEffect","../../../manager/StateManger","../../../manager/LayerManager","../../net/messages/ChangeSceneMsg","../../../plugin/view/ToolTip","src/g/pvp1v1/view/Port_highView.","../../../utils/system/ServerTime","../../../utils/system/DateUitl","src/g/pvp1v1/ctrl/ChallengeRecover","src/g/clearRes/ClearResM","src/init/Switches","../../net/messages/ErrConst","src/init/TextConst","../../net/messages/sbkHeroData"],function(t,e,n,s,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E,T,A,R,L,x){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function o(){var t=i.call(this)||this;t.stars=0,t._count=-1;var e=d.GSM.ins;return e.on(c.KingMatchGS2C.KEY,t,t.kingMatchGS2CHandler),e.on(c.GoldBuyKingTimes.KEY,t,t.buyByGoldHandler),t.mouseThrough=!0,t.btn_add.on(Laya.Event.CLICK,t,t.buyHandler),t.btn_fight.on(Laya.Event.CLICK,t,t.fightHandler),t.btn_rank.on(Laya.Event.CLICK,t,t.openRankHandler),t}return __extends(o,i),o.prototype.openRankHandler=function(){this.view=new b.Port_highView,this.view.showView()},o.prototype.buyHandler=function(){var t=g.RoleCenter.instans.vo.getKingData();if(0<t.MaxGodBuyCnt){var e=u.ItemUtils.getKingSettingById(1),i=e.maxbuycount,n=e.buycost.split(",")[i-t.MaxGodBuyCnt]||200;a.AM.show(L.TextConst.get(879,n,t.MaxGodBuyCnt,i),Laya.Handler.create(this,this.buyCount))}else a.AM.show(L.TextConst.get(878))},o.prototype.buyCount=function(){var t=g.RoleCenter.instans.vo.getKingData(),e=u.ItemUtils.getKingSettingById(1),i=e.maxbuycount,n=e.buycost.split(",")[i-t.MaxGodBuyCnt]||200;n=parseInt(n+""),g.RoleCenter.instans.vo.GOLD<n?Laya.timer.once(200,this,function(){A.Switches.ins.event(155)}):p.GNet.sendFight(v.EOpNopara.buyKingMatchTimes)},o.prototype.buyByGoldHandler=function(t){if(t.opresult&&t.type==c.KingType.Normal){g.RoleCenter.instans.vo.GOLD-=t.GOLD;var e=g.RoleCenter.instans.vo.getKingData();e.goldBuyCnt=t.goldBuyCnt,e.MaxGodBuyCnt=t.MaxGodBuyCnt,h.E.ins.event(l.EventName.KING_ATHLETICS_NUM_OF_CHALLENGES),E.ChallengeRecover.instance().updRecoverStatus(),this.updPointDisplay();var i=u.ItemUtils.getKingSettingById(1);E.ChallengeRecover.instance().totalPointCanBeUsed()==i.maxcount&&this.stopCountDown(),console.warn("竞技购买数量变化:"+e.goldBuyCnt)}},o.prototype.kingMatchGS2CHandler=function(t){var e=this;if(h.E.ins.event(l.EventName.PORT_HIGHVIEW_CLOSE),t.type==c.KingType.Normal)if(t.opresult&&t.type==c.KingType.Normal)this.updateOtherInfo(t.matchUser[0].nickname),this.isResult=!0,Laya.timer.once(1e3,this,function(){e.isResult=!1,_.LayerManager.closeAllPOPWindow(),h.E.ins.event(l.EventName.PLAY_TYPE_CHANGE,r.PlayTypeVo.create(C.EPlayType.PLAYTYPE_COPYLADDER,t))});else if(parseInt(t.error)==R.enumErrConst.code_3006){var i=g.RoleCenter.instans.vo;i.KING=0,i.getKingData().goldBuyCnt=0,a.AM.show(L.TextConst.get(294))}else a.AM.show(t.error)},o.prototype.getKingVo=function(t,e){4==t&&(e=0);var i=f.GameConfig.KingVo;for(var n in i)if(i[n].group==t&&i[n].dan==e)return i[n];return new s.KingVo},o.prototype.showView=function(){this.checkSleep(),this.btn_fight.disabled=!1,this.btn_fight.label=L.TextConst.get(671);var t="res/tianti/l"+g.RoleCenter.instans.vo.jobId+"_"+g.RoleCenter.instans.vo.getOpenHeroByIdx(0).sex+".png";T.ClearResM.addBgUrl(t),this.my_role.skin=t,this.my_role.restskin();t="res/tianti/yingzi.png";this.other_role_icon.skin=t,T.ClearResM.addBgUrl(t),this.other_role_icon.restskin();var e=g.RoleCenter.instans.vo.getKingData(),i=this.getKingVo(e.group,e.dan);this._data=i,this.winrate_txt.text="",this.nick_name_txt.text=g.RoleCenter.instans.vo.nickname,this.level_txt.text=i.name;var n=e.totalFight||1;this.winrate_txt.text=((e.victoryFight/n*100).toFixed(2)||0)+"%",o.group=e.group,o.dan=e.dan,this.week_su_count.text=e.victoryFight+"",this.week_total.text=e.totalFight+"",this.showStart(),this.updContinuousVictory(e.consecutiveWin,this.ft_winNum,this.box_lwinNum),this.resetOtherInfo(),this.visible=!0,this.updPointDisplay(),this.updRecover(),h.E.ins.on(l.EventName.CHALLENGE_RECOVER,this,this.updPointDisplay),this.on(Laya.Event.UNDISPLAY,this,this.onRemovedHander),4==e.group?(this.imgDuanWei.skin="res/tianti/tianti_xunzhang0041.png",this.imgContentGround.visible=this.black_start.visible=this.jin_start.visible=!1,this.imgKingGround.skin="res/tianti/jingji_wangzheditu.jpg"):(this.imgContentGround.visible=this.black_start.visible=this.jin_start.visible=!0,this.imgKingGround.skin="",this.imgDuanWei.skin="res/tianti/tianti_xunzhang00"+e.group+e.dan+".png"),this.title_txt.text=this.currLV(e.dan,e.group),this.updColor(e.group),this.imgDuanWei.restskin(),Laya.timer.once(10,this,function(){T.ClearResM.resetViewImg(this)}),Laya.timer.frameLoop(1e3,this,this.checkSleep),h.E.ins.once(l.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},o.prototype.closeClearRes=function(){h.E.ins.off(l.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),T.ClearResM.clearResFolder("tianti/"),T.ClearResM.clearResFolder("tianti1/"),m.StateManger.isMatching=!1,this.isResult||Laya.timer.clearAll(this),this._count=0},o.prototype.updColor=function(t){1==t?(this.title_txt.color="#fafffe",this.title_txt.strokeColor="#00123b"):2==t?(this.title_txt.color="#fbea8f",this.title_txt.strokeColor="#291501"):3==t&&(this.title_txt.color="#a5feff",this.title_txt.strokeColor="#000f3b")},o.prototype.currLV=function(t,e){var i,n;return 1==t?i=L.TextConst.get(672):2==t?i=L.TextConst.get(673):3==t?i=L.TextConst.get(674):4==t?i=L.TextConst.get(675):5==t&&(i=L.TextConst.get(676)),1==e?n=L.TextConst.get(677):2==e?n=L.TextConst.get(678):3==e?n=L.TextConst.get(679):4==e&&(n=L.TextConst.get(680),i=""),n+i},o.prototype.updPointDisplay=function(){var t=u.ItemUtils.getKingSettingById(1),e=E.ChallengeRecover.instance().totalPointCanBeUsed();this.count_rate.text=e+"/"+t.maxcount,this.count_rate.color=0==e?"#ff0f15":"#349320"},o.prototype.randomDan=function(t){var e=t+2;5<e&&(e=5);var i=t-2;return i<1&&(i=1),(Math.random()*(e-i)>>0)+i},o.prototype.updRecover=function(){E.ChallengeRecover.instance().isAutoRecover()?this.startCountDown():this.stopCountDown()},o.prototype.startCountDown=function(){this.lbRecoverDes.visible=!1,this.countDownBox.visible=!0,Laya.timer.loop(1e3,this,this.updCountDownHander),this.updCountDownHander()},o.prototype.updCountDownHander=function(){var t=E.ChallengeRecover.instance().recoverGap()-(w.ServerTime.serverTime-E.ChallengeRecover.instance().recoverStartTime());this.lbCountDown.changeText(S.DateUtil.timeCountDown1(t)),0==E.ChallengeRecover.instance().recoverStartTime()&&this.stopCountDown()},o.prototype.stopCountDown=function(){Laya.timer.clear(this,this.updCountDownHander),this.lbRecoverDes.visible=!0,this.countDownBox.visible=!1,this.lbCountDown.text=""},o.prototype.onRemovedHander=function(){this.stopCountDown(),this.off(Laya.Event.UNDISPLAY,this,this.onRemovedHander),h.E.ins.off(l.EventName.CHALLENGE_RECOVER,this,this.updPointDisplay)},o.prototype.resetOtherInfo=function(){var t="res/tianti/yingzi.png";this.other_role_icon.skin=t,this.other_role_icon.restskin(),T.ClearResM.addBgUrl(t),this.updContinuousVictory(0,this.ft_winNum_r,this.box_rwinNum,!1),this.other_name.text="",this.other_level_txt.text="",this.other_winrate_txt.text=""},o.prototype.updateOtherInfo=function(t){this.other_name.text=t;var e=g.RoleCenter.instans.vo.getKingData(),i=this.getKingVo(e.group,this.randomDan(e.dan));this.other_level_txt.text=i.name;var n="res/tianti/r"+(1+Math.random()*x.EnumJob.DAOSHI>>0)+"_"+(2*Math.random()>>0)+".png";this.other_role_icon.skin=n,this.other_role_icon.restskin(),this.updContinuousVictory(this.randomVictory(),this.ft_winNum_r,this.box_rwinNum,!1)},o.prototype.updContinuousVictory=function(t,e,i,n){void 0===n&&(n=!0),t<2?i.visible=!1:(i.visible=!0,e.value=t.toString(),t<10?n?this.winerLogo.x=38:this.ft_winNum_r.x=45:n?this.winerLogo.x=68:this.ft_winNum_r.x=12)},o.prototype.getGroupDanFromExp=function(t){var e=f.GameConfig.KingVo;for(var i in e){null==e[i].dan&&(e[i].dan=0);var n=e[i];t>=n.exp?t-=n.exp:(this.stars=t,o.stars=t)}},o.prototype.checkSleep=function(){var t=!1,e=new Date;e.setTime(1e3*w.ServerTime.serverTime);var i=e.getDay(),n=e.getHours(),s=e.getMinutes();i<=1&&(0==i?23<=n&&(23==n?50<=s&&(t=!0):t=!0):n<=0&&s<10&&(t=!0)),this.box_sleep.visible=t,this.btn_fight.visible=!t},o.prototype.fightHandler=function(){g.RoleCenter.instans.bagRoomEnough()?E.ChallengeRecover.instance().totalPointCanBeUsed()<=0?y.FE.upItems(L.TextConst.get(294),I.BubbleEnum.center):m.StateManger.isSpecialPlay()||0<this._count||(this._count=5,n.PortViewCtrl.getins().offAutoFight(),m.StateManger.isMatching=!0,this.btn_fight.disabled=!0,this.btn_fight.label=L.TextConst.get(681),Laya.timer.loop(500,this,this.randomRole)):a.AM.showBagNotEnough()},o.prototype.randomRole=function(){if(this._count--,this._count<=0)return Laya.timer.clearAll(this),p.GNet.sendFight(v.EOpNopara.matchKingOponent),this._count=-1,this.btn_fight.disabled=!1,this.btn_fight.label=L.TextConst.get(671),void console.warn("攻打后次数:"+g.RoleCenter.instans.vo.KING);this.updateOtherInfo(f.GameConfig.getRandomName())},o.prototype.randomVictory=function(){return 2+(Math.random()*g.RoleCenter.instans.vo.getKingData().consecutiveWin>>0)},o.prototype.showStart=function(){var t=this._data.exp;o.star=this._data.exp;var e=g.RoleCenter.instans.vo.getKingData();this.getGroupDanFromExp(e.kingExp);var i=this.jin_start,n=this.black_start;i.visible=!1,n.visible=!1,i.value=" ",n.value=" ",t&&(n.visible=!0,n.value=utils.repeat(1,t));var s=this.stars;5<s&&(this.stars=s=0,console.error("星级有问题")),s&&(i.visible=!0,i.value=utils.repeat(1,s))},o.group=0,o.dan=0,o.stars=0,o.star=0,o}(ui.playtype.PortHighFightPageUI);e.PortHighFightPage=i}),define("src/g/account/view/HighFightEndView",["require","exports","src/g/account/view/AccItem","src/g/guide/vo/RewardVo","../../../utils/ItemUtils","../../../enum/enumItem","../../../manager/RoleCenter","../../../config/GameConfig","src/g/pvp1v1/view/PortHighFightPage","../../../meta/QualiyVo","../../../utils/StringUtils"],function(t,e,n,y,m,_,C,I,h,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=laya.utils.Ease,i=function(i){function t(){var t=i.call(this)||this;return t.stars=0,t.starDis=0,t.groups=0,t.newDan=0,t.popupEffect=null,t.rewardList.vScrollBarSkin="",t.rewardList.itemRender=n.AccItem,t.rewardList.renderHandler=Laya.Handler.create(t,t.rewardRenderHander,null,!1),t}return __extends(t,i),t.prototype.close=function(t,e){i.prototype.close.call(this,t,e),this.destroy(!0)},t.prototype.rewardRenderHander=function(t,e){t.scale(.8,.8),t.eqData=this.rewardList.array[e]},t.prototype.creatItem=function(t){var e=new n.AccItem;e.scale(.8,.8),e.eqData=t},t.prototype.TweenStar=function(){for(var t=1;t<=this.starDis;t++)Laya.Tween.to(this.starView["star"+this.stars+"_"+t],{scaleX:1,scaleY:1},50,c.sineIn)},t.prototype.DuanWeiIcon=function(){4==this.groups?this.duan_icon.skin="res/tianti/tianti_xunzhang0041.png":this.duan_icon.skin="res/tianti/tianti_xunzhang00"+this.groups+this.newDan+".png",this.icon_zi.skin="res/tianti/zi_chenghao00"+this.groups+".png",4==h.PortHighFightPage.group?this.dan_txt.text="":this.dan_txt.text=w.StringUtils.curDan(this.newDan),Laya.Tween.to(this.duan_icon,{scaleX:1},100,null,Laya.Handler.create(this,this.DuanWeiIcon1))},t.prototype.DuanWeiIcon1=function(){Laya.Tween.to(this.duan_icon,{scaleX:1.3,scaleY:1.3},200,null,Laya.Handler.create(this,this.DuanWeiIcon2))},t.prototype.DuanWeiIcon2=function(){Laya.Tween.to(this.duan_icon,{scaleX:1,scaleY:1},100),this.starDis||this.starDis||(this.chengStar(this.stars,this.starDis),console.log("星星不动了 "))},t.prototype.changeDuanWeiIcon=function(){4==this.groups?this.duan_icon.skin="res/tianti/tianti_xunzhang0041.png":this.duan_icon.skin="res/tianti/tianti_xunzhang00"+h.PortHighFightPage.group+h.PortHighFightPage.dan+".png",this.icon_zi.skin="res/tianti/zi_chenghao00"+h.PortHighFightPage.group+".png",4==h.PortHighFightPage.group?this.dan_txt.text="":this.dan_txt.text=w.StringUtils.curDan(h.PortHighFightPage.dan),Laya.Tween.to(this.duan_icon,{scaleX:0},100,null,Laya.Handler.create(this,this.DuanWeiIcon))},t.prototype.tween1=function(){for(var t=1;t<=h.PortHighFightPage.star;t++)Laya.Tween.to(this.starView["star"+h.PortHighFightPage.star+"_"+t],{scaleX:1,scaleY:1},50,c.sineIn)},t.prototype.chengIcon=function(t,e,i,n){var s=this.starView;if(t==h.PortHighFightPage.group&&e==h.PortHighFightPage.dan)this.duan_icon.skin=4==t?"res/tianti/tianti_xunzhang0041.png":"res/tianti/tianti_xunzhang00"+t+e+".png",this.chengStar(n,i);else if(0==i){s.star3.visible=!1,s.star4.visible=!1,s.star5.visible=!1,s.visible=!0,s["star"+h.PortHighFightPage.star].visible=!0;for(var o=1;o<=h.PortHighFightPage.star;o++)s["star"+h.PortHighFightPage.star+"_"+o].visible=!0;for(var a=h.PortHighFightPage.stars+1;a<=h.PortHighFightPage.star;a++){s["star"+h.PortHighFightPage.star+"_"+a].visible=!0,s["star"+h.PortHighFightPage.star+"_"+a].scaleX=0,s["star"+h.PortHighFightPage.star+"_"+a].scaleY=0;var r=h.PortHighFightPage.star-h.PortHighFightPage.stars;Laya.Tween.to(s["star"+h.PortHighFightPage.star+"_"+a],{scaleX:1.5,scaleY:1.5},150*r,c.sineIn,Laya.Handler.create(this,this.tween1))}4==this.groups?this.duan_icon.skin="res/tianti/tianti_xunzhang0041.png":this.duan_icon.skin="res/tianti/tianti_xunzhang00"+h.PortHighFightPage.group+h.PortHighFightPage.dan+".png",this.icon_zi.skin="res/tianti/zi_chenghao00"+h.PortHighFightPage.group+".png",4==h.PortHighFightPage.group?this.dan_txt.text="":this.dan_txt.text=w.StringUtils.curDan(h.PortHighFightPage.dan),Laya.timer.once(800,this,function(){this.changeDuanWeiIcon()}),Laya.timer.once(800,this,function(){this.chengStar(n,i)})}else{this.chengStar(n,i);var l=n-h.PortHighFightPage.stars;4==this.groups?this.duan_icon.skin="res/tianti/tianti_xunzhang0041.png":this.duan_icon.skin="res/tianti/tianti_xunzhang00"+h.PortHighFightPage.group+h.PortHighFightPage.dan+".png",this.icon_zi.skin="res/tianti/zi_chenghao00"+h.PortHighFightPage.group+".png",4==h.PortHighFightPage.group?this.dan_txt.text="":this.dan_txt.text=w.StringUtils.curDan(h.PortHighFightPage.dan),Laya.timer.once(800*l,this,function(){this.changeDuanWeiIcon()})}},t.prototype.chengStar=function(t,e){var i=this.starView;if(t){i.star3.visible=!1,i.star4.visible=!1,i.star5.visible=!1,i.visible=!0;for(var n=1;n<=t;n++)i["star"+t+"_"+n].visible=!1;for(var s=1;s<=e;s++)i["star"+t+"_"+s].visible=!0;i["star"+t].visible=!0;for(var o=h.PortHighFightPage.stars+1;o<=e;o++){i["star"+t+"_"+o].visible=!0,i["star"+t+"_"+o].scaleX=0,i["star"+t+"_"+o].scaleY=0;var a=e-h.PortHighFightPage.stars;Laya.Tween.to(i["star"+t+"_"+o],{scaleX:1.5,scaleY:1.5},300*a,c.sineIn,Laya.Handler.create(this,this.TweenStar))}this.stars=t,this.starDis=e}else i.visible=!1},t.prototype.setData=function(t,e){if(t){this.starView.star3.visible=!1,this.starView.star4.visible=!1,this.starView.star5.visible=!1;var i=C.RoleCenter.instans.vo.getKingData();if(this.groups=i.group,this.newDan=e.newDan,this.icon_zi.skin="res/tianti/zi_chenghao00"+i.group+".png",e){4==i.group?this.dan_txt.text="":this.dan_txt.text=w.StringUtils.curDan(e.newDan);var n=this.width-(58+this.dan_txt.width)>>1;this.icon_zi.x=n,this.dan_txt.x=this.icon_zi.x+58;var s=e.newGroup;for(var o in I.GameConfig.KingVo){var a=I.GameConfig.KingVo[o];if(a.group==s){a.exp;break}}this.chengIcon(i.group,e.newDan,e.starDis,a.exp)}var r=[],l=t.currencyList;if(l)for(var h=0;h<l.length;h++){var c=new y.RewardVo;c.count=l[h].val;var u=m.ItemUtils.getCurrencyByDefine(l[h].key);c.name=u.name,c.type=_.ItemType.CURRENCY,c.qualityNum=u.quality,c.quality=b.QualityStruct.Ins.getQColorById(u.quality),c.res=m.ItemUtils.getIconByIconId(u.icon),c.streamer=u.streamer,r.push(c)}var p=t.equipList;if(p)for(h=0;h<p.length;h++){var d=new y.RewardVo,g=m.ItemUtils.getItemOrEq(p[h].equtemplet);d.res=m.ItemUtils.getIconByIconId(g.icon),d.lv=g.limit,d.quality=b.QualityStruct.Ins.getQColorById(g.quality),d.name=g.name,d.type=_.ItemType.EQ,d.id=g.id,d.job=g.job,r.push(d)}if(t.itemList){var v=t.itemList;for(h=0;h<v.length;h+=2){d=new y.RewardVo;var f=m.ItemUtils.getItemVoById(v[h]);d.res=m.ItemUtils.getIconByIconId(f.icon),d.lv=f.uselimit,d.quality=b.QualityStruct.Ins.getQColorById(f.quality),d.name=f.name,d.id=f.id,d.type=_.ItemType.ITEM,d.count=v[h+1],d.qualityNum=f.quality,d.streamer=f.streamer,r.push(d)}}this.rewardList.array=r}else console.error("掉落为空")},t}(ui.account.HighFightSucessUI);e.HighFightEndView=i}),define("src/g/account/view/HighFightFailView",["require","exports","../../../config/GameConfig","src/g/guide/vo/RewardVo","../../../utils/ItemUtils","../../../enum/enumItem","../../../manager/RoleCenter","src/g/account/view/AccItem","../../../meta/QualiyVo","../../../utils/StringUtils"],function(t,e,y,m,_,C,I,i,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.popupEffect=null,t}return __extends(t,e),t.prototype.creatItem=function(t){var e=new i.AccItem;e.scale(.8,.8),e.eqData=t,this.conList.addChild(e)},t.prototype.setData=function(t,e){if(t){var i=this.starView;i.star3.visible=!1,i.star4.visible=!1,i.star5.visible=!1;var n=I.RoleCenter.instans.vo.getKingData();if(this.duan_icon.skin="res/tianti/tianti_xunzhang00"+n.group+e.newDan+".png",this.icon_zi.skin="res/tianti/zi_chenghao00"+n.group+".png",e){this.dan_txt.visible=4!=n.group,this.dan_txt.text=w.StringUtils.curDan(e.newDan);var s=e.newGroup,o=0;for(var a in y.GameConfig.KingVo){var r=y.GameConfig.KingVo[a];if(r.group==s){o=r.exp;break}}if(i.star3.visible=!1,i.star4.visible=!1,i.star5.visible=!1,i.visible=!0,o){for(var l=1;l<=o;l++)i["star"+o+"_"+l].visible=!1;i["star"+o].visible=!0;for(l=1;l<=e.starDis;l++)i["star"+o+"_"+l].visible=!0}else this.dan_txt.text="Ⅴ",i.visible=!1}var h=t.currencyList,c=t.equipList;if(h)for(l=0;l<h.length;l++){var u=new m.RewardVo;u.count=h[l].val;var p=_.ItemUtils.getCurrencyByDefine(h[l].key);u.name=p.name,u.type=C.ItemType.CURRENCY,u.qualityNum=p.quality,u.quality=b.QualityStruct.Ins.getQColorById(p.quality),u.res=_.ItemUtils.getIconByIconId(p.icon),u.streamer=p.streamer,this.creatItem(u)}if(c)for(l=0;l<c.length;l++){var d=new m.RewardVo,g=_.ItemUtils.getEquipVoById(c[l].equtemplet);d.res=_.ItemUtils.getIconByIconId(g.icon),d.lv=g.limit,d.quality=b.QualityStruct.Ins.getQColorById(g.quality),d.name=g.name,d.type=C.ItemType.EQ,d.id=g.id,d.job=g.job,this.creatItem(d)}if(t.itemList){var v=t.itemList;for(l=0;l<v.length;l+=2){d=new m.RewardVo;var f=_.ItemUtils.getItemVoById(v[l]);d.res=_.ItemUtils.getIconByIconId(f.icon),d.lv=f.uselimit,d.quality=b.QualityStruct.Ins.getQColorById(f.quality),d.qualityNum=p.quality,d.name=f.name,d.id=f.id,d.count=v[l+1],d.type=C.ItemType.ITEM,d.streamer=f.streamer,this.creatItem(d)}}}else console.error("掉落为空")},t}(ui.account.HighFightFailUI);e.HighFightFailView=n}),define("src/g/fight/osprite/play/baseplay/vo/WolrdBossVo",["require","exports","../../../../../../manager/RoleCenter","../../../../../../enum/EventName","../../../../../../core/E"],function(t,e,s,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){this._allplayers={},this.ownerAcc="",this.selfAcc="",this.startPoints=[],this._mPosIdx=1,this.attplayers=[],this.attPlayername=""}return t.prototype.init=function(t,e,i){this.portData=i,this.portQuanMin=t,this.endTime=t?t.finishtime:0,this.bossPosstion=e.bossXY[0],this.heroPosstion=e.startPoint[0];var n=e.startPoint;this.selfStartPoint=n[0],this.startPoints=n,this.bossplayID=t?t.id:0,this.selfAcc=s.RoleCenter.instans.self.username,this.mapVo=e},t.prototype.getNextStartPoint=function(){var t=this.startPoints[this._mPosIdx];return this._mPosIdx++,this._mPosIdx>=this.startPoints.length&&(this._mPosIdx=0),t},t.prototype.addPlayers=function(t){this._allplayers[t.username]=t},t.prototype.getPlayer=function(t){return this._allplayers[t]},t.prototype.getPlayers=function(){return this._allplayers},t.prototype.addAttPlayer=function(t){for(var e=0;e<this.attplayers.length;e++){if(this.attplayers[e].username==t.username)return}this.attplayers.push(t),n.E.ins.event(i.EventName.BOSS_UPDATE_ATTACK_LIST)},t.prototype.removeAttPlayer=function(t){for(var e=0;e<this.attplayers.length;e++){if(this.attplayers[e].username==t){this.attplayers.splice(e,1);break}}n.E.ins.event(i.EventName.BOSS_UPDATE_ATTACK_LIST)},t.prototype.resetAttPlayers=function(){this.attplayers.length=0,n.E.ins.event(i.EventName.BOSS_UPDATE_ATTACK_LIST)},t.prototype.getAttackSelfCount=function(){return this.attplayers.length},t.prototype.getAttackList=function(){return this.attplayers},t}();e.WolrdBossVo=o}),define("src/g/account/ctrl/AccountViewCtrl",["require","exports","src/g/account/view/FailView","src/g/account/view/AccountView","src/g/account/view/HighFightEndView","src/g/account/view/HighFightFailView","../../../utils/SoundUtils","../../../manager/RoleCenter","../../../utils/ItemUtils","../../net/messages/rank/sbkOtherData","../../../core/GNet","src/init/Switches","../../../manager/LayerManager","../../../component/FlyHighEq","src/g/peronboss/view/ItemIconView","../../../utils/ItemDropUtil","../../../meta/QualiyVo","../../../meta/CommonVo","src/init/TextConst","../../net/messages/TeamMsg","../../../manager/GameSocketManager","../../net/messages/rank/sbkOtherHeroData"],function(t,e,s,d,o,a,g,v,f,y,h,n,r,l,c,m,u,_,C,p,i,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var b=function(){function t(){this._count=5}return t.prototype.init=function(){},t.prototype.failview=function(){this._fivew||(this._fivew=new s.FailView)},Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t),this._ins},enumerable:!0,configurable:!0}),t.prototype.successFightEnd=function(t,e,i,n,s,o){if(void 0===i&&(i=C.TextConst.get(197)),void 0===o&&(o=!1),this._view||(this._view=new d.AccountView),n&&0<n.ownerAcc.length){var a="",r=0,l="",h=0;if(this._view.att_name.text=n.attPlayername,n.attPlayername?(this._view.fuchou_con.visible=!0,this._view.att_name.text=n.attPlayername):this._view.fuchou_con.visible=!1,n.ownerAcc==v.RoleCenter.instans.vo.username)this._view.bossWinBox.visible=!0,this._view.affil.visible=!1,this._view.title.visible=!1,this._view.titleTxt.visible=!1,this._view.award.y=430,this._view.list.height=260;else{this._view.bossWinBox.visible=!1,this._view.affil.visible=!0,this._view.title.visible=!0,this._view.titleTxt.visible=!0;var c=n.getPlayer(n.ownerAcc);c||(c=new y.sbkOtherData).openhero.push(new I.sbkOtherHeroData),a=c.familyName||"",r=c.openhero[0]?c.openhero[0].jobid:1,h=c.openhero[0]?c.openhero[0].sex:1,l=c.nickname||C.TextConst.get(198),this._view.imghead.skin=f.ItemUtils.getHeadurlYuan(h,r),this._view.txt_familyName.text=a,this._view.txt_Name.text=l,this._view.award.y=423,this._view.list.height=230}}else this._view.bossWinBox.visible=!1,this._view.affil.visible=!1,this._view.award.y=319,this._view.list.height=o?240:330,this.checkAdvert(o);if(s){var u=_.CommonVo.getVoByKey("jiesuandaojishi"),p=null!=u?Number(u.value):5;this._count=p}else this._view.hurt.visible=!1,this._view.last.visible=!1,this._count=5;this._handler=e,0<this._count&&(this._view.btn_get.label=C.TextConst.get(243,this._count),Laya.timer.loop(1e3,this,this.loopHandler)),this._view.titleTxt.text=i,this._view.btn_get.once(Laya.Event.CLICK,this,this.clickHandler),this._view.btn_gotofuchou.on(Laya.Event.CLICK,this,this.fuchouHandler),this._view.list.array=m.ItemDropUtil.createRewardList(t),this._view.popup(),g.SoundUtils.getInstance().playSoundById(107)},t.prototype.fuchouHandler=function(){this.clickHandler(),n.Switches.ins.event(89)},t.prototype.checkAdvert=function(t){var e=this;if(void 0===t&&(t=!1),this._view.box_advert.visible=t&&window.enabledpay,t){var i=0;this._view.img_advertBg.skin="",v.RoleCenter.instans.vo.vipData.allPriceGold<=0?(i=13,window.oldversion?this._view.img_advertBg.skin="res/jiesuan/shouchong_old.png":this._view.img_advertBg.skin="res/jiesuan/shouchong.png"):(i=99,this._view.img_advertBg.skin="res/jiesuan/dazhuzai_zi01_jinzhuang.png"),this._view.box_advert.once(Laya.Event.CLICK,this,function(){e._handler&&e._handler.runWith(!0),Laya.loader.clearRes(e._view.img_advertBg.skin,!0),e._view.img_advertBg.skin="",n.Switches.ins.event(i),e.clickHandler()})}},t.prototype.VIPBossFightEnd=function(t){if(0<t.mostHurt.length){var e="",i=0,n="",s=0,o="",a=0,r="",l=0;t.ownerAcc==v.RoleCenter.instans.vo.username?(o=v.RoleCenter.instans.self.ufData.familyName,a=v.RoleCenter.instans.vo.jobId,l=v.RoleCenter.instans.vo.getSex(),r=v.RoleCenter.instans.vo.nickname):(this.ownerAccName=t.ownerAcc,h.GNet.getOtherData([this.ownerAccName])),t.mostHurt==v.RoleCenter.instans.vo.username?(e=v.RoleCenter.instans.self.ufData.familyName,i=v.RoleCenter.instans.vo.jobId,s=v.RoleCenter.instans.vo.getSex(),n=v.RoleCenter.instans.vo.nickname):h.GNet.getOtherData([t.mostHurt]),this._view.hurt.visible=!0,this._view.last.visible=!0,this._view.img_hurtHead.skin=f.ItemUtils.getHeadurlYuan(s,i),this._view.img_lastHead.skin=f.ItemUtils.getHeadurlYuan(l,a),this._view.txt_hurtFamilyNAME.text=e,this._view.txt_lastFamilyNAME.text=o,this._view.txt_hurtName.text=n,this._view.txt_lastName.text=r,this._view.award.y=540,this._view.list.height=198}else this._view.hurt.visible=!1,this._view.last.visible=!1},t.prototype.otherDataHandler=function(){this.ownerAccData=v.RoleCenter.instans.getOtherData(this.ownerAccName),this.mostHurtData=v.RoleCenter.instans.getOtherData(this.mostHurtName)},t.prototype.highFightSucess=function(t,e,i){var n=new o.HighFightEndView;this.initview(n,t,e,i),g.SoundUtils.getInstance().playSoundById(107)},t.prototype.highFightFail=function(t,e,i){var n=new a.HighFightFailView;this.initview(n,t,e,i),g.SoundUtils.getInstance().playSoundById(108)},t.prototype.initview=function(t,e,i,n){t.setData(e,i),t.popup(),this._handler=n;var s=5;t.btn_get.label=C.TextConst.get(243,s),Laya.timer.loop(1e3,this,function(){--s<=0&&(Laya.timer.clearAll(this),this._handler&&(t.close(),this._handler.run())),t.btn_get.label=C.TextConst.get(243,s)}),t.btn_get.once(Laya.Event.CLICK,this,function(){Laya.timer.clearAll(this),this._handler&&(t.close(),this._handler.runWith(this._handler.args))})},t.prototype.failFightEnd=function(t,e,i){void 0===e&&(e=p.enumTeamType.NULL),this.failview();var n=this._fivew;i?n.setState(s.FailView.AWARD):n.setState(s.FailView.NORMAL),n.btn_help.once(Laya.Event.CLICK,this,this.onHelpHandler),this._count=20,n.lab_get.text=C.TextConst.get(202),n.lab_getTime.text="("+this._count+"s)",Laya.timer.loop(1e3,this,this.loopHandlerFail),n.showHelp(e),n.popup(),n.handler=t,g.SoundUtils.getInstance().playSoundById(108)},t.prototype.onHelpHandler=function(){var t=this._fivew.copyid;this.clickHandler();var e=new p.CreateTeamC2GS;e.teamType=p.enumTeamType.helpFight,e.copyid=t,i.GSM.sendServer(e)},t.prototype.loopHandler=function(){this._count--,this._count<=0&&(Laya.timer.clear(this,this.loopHandler),this.clickHandler(),this._handler&&this._handler.runWith(this._handler.args)),this._view&&(this._view.btn_get.label=C.TextConst.get(243,this._count))},t.prototype.loopHandlerFail=function(){this._count--,this._count<=0&&(Laya.timer.clear(this,this.loopHandlerFail),this.clickHandler(),this._handler&&this._handler.runWith(this._handler.args)),this._fivew&&(this._fivew.lab_get.text=C.TextConst.get(202),this._fivew.lab_getTime.text="("+this._count+"s)")},t.prototype.clickHandler=function(){this._view&&(this._view.close(),this._view.destroy(!0),this._view=null),this._fivew&&(this._fivew.close(),this._fivew.destroy(!0),this._fivew=null),this._count=0,Laya.timer.clear(this,this.loopHandlerFail),Laya.timer.clear(this,this.loopHandler),this._handler&&(this._handler.runWith(this._handler.args),this._handler=null)},t.redEq=function(t,e){var i=this,n=f.ItemUtils.getEquipVoById(t);if(n&&!(n.quality<5)){var s=e.quality;0==(s=u.QualityStruct.Ins.transEquipQuality(n))&&(s=1);var o=new l.FlyHighEq;c.ItemIconView.setItemData(n,o.item0),o.eq_name.text=n.name,o.eq_name.color=u.QualityStruct.Ins.getQColorById(s),o.zhandouli.value=e.combat+"",this._highEqa.push(o),r.LayerManager.addInBubblesLayer(o),o.y=1200,o.x=(Laya.stage.width-o.width)/2,Laya.Tween.to(o,{y:400+100*this._highEqa.length},1300-100*this._highEqa.length,null,new Laya.Handler(this,function(){Laya.Tween.to(o,{alpha:0},500,null,new Laya.Handler(i,function(){o.destroy(!0),this._highEqa.shift()}),600)}),200*this._highEqa.length,!0)}},t._highEqa=[],t}();e.AccountViewCtrl=b}),define("src/g/fight/osprite/obj/MapAnimObj",["require","exports","src/g/fight/osprite/obj/BaseSprite","../../../../component/GAnimation","../../../../utils/ItemUtils","src/g/fight/osprite/SceneObjManager"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._eff=new n.GAnimation,t.baseUIEffectsPath="dynamic2/uieffect",t}return __extends(t,e),t.prototype.setEffectId=function(t){var e=s.ItemUtils.getUIEffectsVoById(t);if(e){this._eff.interval=e.interval;var i=(e.urlPath?e.urlPath:this.baseUIEffectsPath)+"/"+e.name+".json";this._eff.load(i)}},t.prototype.addMap=function(t,e){this.setWorldXY(t,e),this.view.effectLayer.addChild(this._eff),o.SceneObjManager.instans.regObject(this)},t.prototype.removeMap=function(){this._eff.removeSelf(),o.SceneObjManager.instans.unregObject(this)},t.prototype.destroy=function(){this.removeMap(),this._eff.clear(!0),this._eff=null},t.prototype.frameMove=function(t){this.updatePoint(),this._eff.x=this.gridX,this._eff.y=this.gridY},t}(i.BaseSprite);e.MapAnimObj=a}),define("src/g/fight/osprite/play/RobotNpc",["require","exports","src/g/fight/osprite/obj/HeroUnit","../../../net/messages/sbkUserData","../../../../manager/RoleCenter","../../../../config/GameConfig","src/g/fight/osprite/obj/FightGroup","src/g/fight/osprite/obj/MonsterUnit_New","../../../../utils/ItemUtils","../../../../manager/LayerManager","src/g/fight/osprite/obj/PassiveMgr","src/g/fight/osprite/map/MapCovert"],function(t,e,i,v,f,y,n,m,_,C,h,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.udata=null,t.robGroup=new n.FightGroup(null),t.monGroup=new n.FightGroup(null),t.changeHPKey=!1,t.showHpKey=!1,t}return __extends(t,e),t.prototype.initRobotFromHero=function(t,e,i){void 0===i&&(i=1),this.udata=v.sbkUserData.getins(),this.udata.copydata(f.RoleCenter.instans.self),this.udata.nickname=y.GameConfig.getRandomName(1);var n=this.udata.openhero[0];this.showHpKey&&(n.HP=1);for(var s=0;s<t.attrs.length;s++)n[t.attrs[s][0]]=t.attrs[s][1];n.openSkill=[t.skill],this.job=t.pro,this.sex=t.sex,this.weaponId=t.weapon,this.avatarId=t.clothes,t.wing&&(this.wingId=t.wing),this.initHeroData(n,this.udata.JUNGONG,this.udata.STORYEXP,this.udata.nickname,6);var o=e[0],a=e[1];this.setWorldXY(o,a),this.setAsShow(!this.showHpKey),t.title&&(this.topHpBar.titleArr=[t.title]),this.showHpKey&&(this.topHpBar.typeElement=2),C.LayerManager.fightLayer.addUnit(this),this.robGroup.addFightUnit(this);for(var r,l,h,c=t.monid.length,u=0,p=0,d=I.MapCovert.getFreePosList(e),g=d.length;u<c;)0<g?(g<=p&&(p=0),p<g&&(r=d[p],p++)):r=e,(l=_.ItemUtils.getMonsterVOById(t.monid[u]))&&((h=new m.MonsterUnit_New(!1)).set_DATA(l),h.setWorldXY(r[0],r[1]),h.setAsShow(!0),C.LayerManager.fightLayer.addUnit(h),this.monGroup.addFightUnit(h)),u++;this.robGroup.setFGTarget(this.monGroup),this.monGroup.setFGTarget(this.robGroup)},t.prototype.initHeroData=function(t,e,i,n,s){void 0===n&&(n=""),void 0===s&&(s=1),this.actorName=n,this.set_DATA(t);var o=t.openSkill.concat(),a=t.skillLvl.concat(),r=o.indexOf(14);-1<r&&(o.splice(r,1),a.splice(r,1)),this.sk_Manager.register_skill(o,a),this.actorType=s,this.face=6,this.chopLv=e,this.resetEquipData(),this.stand(),0<n.length&&(this.topHpBar.headName=n),this.resetHP(),this.passiveMgr=new h.PassiveMgr,this.passiveMgr.initPassiveMgr(this);var l=_.ItemUtils.getHeroVoById(this.job);this.attackDis=l.value,this.station=l.station},t.prototype.resetEquipData=function(){},t.prototype.chg_HP=function(t,e,i,n){this.changeHPKey&&(this.setHp(this.getHp()+t),this.floatBlood(t,e?e.job:0,i,n))},t.prototype.get_extHURT=function(t){return 0},t.prototype.destroyUnit=function(){this.udata.release(),e.prototype.destroyUnit.call(this),this.robGroup.destroyGroup(!1),this.monGroup.destroyGroup(!1),this.robGroup=null,this.monGroup=null},t}(i.HeroUnit);e.RobotNpc=s}),define("src/g/shenjiang/vo/SjSuitVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function n(){}return n.prototype.init=function(t,e){var i=0;this.id=t[i++],this.name=t[i++],this.level=t[i++],this.need=t[i++],this.prop=t[i++],e[this.level+"_"+this.need]=this,n.lvArr.push(this.level)},n.lvArr=[],n}();e.SjSuitVo=i}),define("src/g/shenjiang/vo/SjVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.id=t[i++],this.res=t[i++],this.prop=t[i++],this.skill=t[i++],this.condition=t[i++],e[this.id]=this},t}();e.SjVo=i}),define("src/g/shenjiang/SjUtils",["require","exports","../../manager/RoleCenter","src/g/shenjiang/vo/SjSuitVo","../../config/GameConfig"],function(t,e,r,l,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.getAllEqPosLvCount=function(){for(var t={},e=r.RoleCenter.instans.self.generalData.lvArr,i=l.SjSuitVo.lvArr,n=0;n<e.length;n++){var s=e[n];if(0<s)for(var o=s;0<o;o--)if(-1!=i.indexOf(o)){var a=t[o]||0;a++,t[o]=a}}return t},t.getMinSuitLv=function(){var t=this.getAllEqPosLvCount(),e=o.GameConfig.sj,i=0;for(var n in e){var s=e[n].condition;if(!(t[s[0]]>=s[1]))break;i=+n}return i},t}();e.SjUtils=i}),define("src/g/fight/osprite/play/GamePlay",["require","exports","src/g/fight/osprite/GameScene","../../../../manager/TaskManager","../../../../core/E","../../../../enum/EventName","src/g/fight/osprite/map/MapCovert","../../../../manager/GameSocketManager","../../../net/messages/FightStartGS2C","../../../net/messages/FightEndGS2C","src/g/fight/osprite/SceneObjManager","../../../../manager/RoleCenter","src/g/fight/osprite/SceneObjCtroller","../../../net/messages/CurrencyType","../../../../utils/system/FloatEffect","../../../../utils/DropUtil","../../../../utils/ItemUtils","src/g/fight/osprite/play/SceneNPCFight","../../../../enum/JobEnum","src/g/account/ctrl/AccountViewCtrl","src/g/fight/info/PlayTypeVo","../../../../manager/LayerManager","../../../net/messages/SweepFightMsg","../../../../utils/SoundUtils","src/g/fight/base/RES","../../../net/messages/UserAttackMsg","../../../net/messages/HPChangeGS2C","../../../net/messages/ChangeSceneMsg","../../../../enum/PlayType","../../../../config/GameConfig","src/g/fight/osprite/obj/FightGroup","src/g/fight/osprite/obj/MapAnimObj","../../../net/messages/PassiveResultGS2C","src/g/index/ctrl/BtnSkiilCtrl","src/g/fight/osprite/obj/MonsterUnit_New","src/g/fight/osprite/play/baseplay/SvrPeopleBossMonster","src/g/fight/osprite/play/RobotNpc","src/g/index/ctrl/AutoSkillBtnCtrl","../../../../plugin/view/ToolTip","../../../net/messages/RingRecoverGS2C","src/g/fight/osprite/play/MainCityManager","../../../net/messages/sbkComboData","src/init/Switches","../../../../manager/StateManger","../../../net/messages/ZLAppearGS2C","../../../net/messages/sbkZhanLingData","src/init/TextConst","../../../net/messages/sbkPetData","../../../net/messages/ChangeAttackTargetMsg","../../../net/messages/RingSkillGS2C","../../../net/messages/RoughSkillGS2C","src/g/shenjiang/SjUtils","../../../net/messages/PhComboAttGS2C","../../../../enum/HpType"],function(t,e,a,i,c,u,r,n,s,l,h,p,d,g,m,v,f,y,_,C,I,b,w,S,E,T,A,R,L,x,P,k,D,H,M,G,B,N,U,V,O,F,q,K,Y,j,J,W,z,X,Q,Z,$,tt){"use strict";var o,et;Object.defineProperty(e,"__esModule",{value:!0}),(o=e.EPortState||(e.EPortState={}))[o.null=0]="null",o[o.challengeBossState=1]="challengeBossState",o[o.inBossMap=2]="inBossMap",o[o.readyEnterNewPort=3]="readyEnterNewPort",(et=e.EFightState||(e.EFightState={}))[et.free=0]="free",et[et.startMsgSend=1]="startMsgSend",et[et.startMsgReceive=2]="startMsgReceive",et[et.endMsgSend=3]="endMsgSend",et[et.endMsgReceive=4]="endMsgReceive";var it=function(){function o(t){this.type=-1,this._enterfail=!1,this._curPortState=0,this._portToEnter=0,this._portProductivityUp=!1,this._useInfoAddValueKey=!0,this._fightReward=null,this._mainRole=null,this._fightGroup=null,this._playerDic={},this._otherPlayerDic={},this._startCallHandler=null,this._endCallHandler=null,this._otherPVKey=!0,this._monsterVKey=!0,this._npcVKey=!0,this._unitAllHideKey=!1,this._monsterFGArr=[],this._monsterDic={},this._monsterTypeDic={},this._monsterTypeCountDic={},this._monsterDebugKey=!1,this._count=0,this.isDestroySelfKey=!0,this._saveUidArr=[],this._isready=!1,this.maxGroupNum=5,this.nowGroupNum=0,this.effectsXY=[],this.effectsIns=[],this.type=t;var e=n.GSM.ins;e.on(s.FightStartGS2C.KEY,this,this.onReceiveFightStart),e.on(l.FightEndGS2C.KEY,this,this.onReceiveFightEnd),e.on(w.SweepFightGS2C.KEY,this,this.onReceiveSweepMatCopy),e.on(T.UserAttackGS2C.KEY,this,this.onAttackMsg),e.on(A.UserHPChageGS2C.KEY,this,this.onUserHPChg),e.on(A.HPChangeGS2C.KEY,this,this.onHpChg),e.on(D.PassiveResultGS2C.KEY,this,this.onPassiveResultGS2C),e.on(D.SyPassiveResGS2C.KEY,this,this.onSyPassiveResultGS2C),e.on(V.RingRecoverGS2C.KEY,this,this.onRingRecoverGS2C),e.on(Y.ZLAppearGS2C.KEY,this,this.onZlAni),e.on(T.ComboHitGS2C.KEY,this,this.onComboHit),e.on(W.PetHPAddGS2C.KEY,this,this.petHpAdd),e.on(W.PetAttackGS2C.KEY,this,this.petAttack),e.on($.PhComboAttGS2C.KEY,this,this.phCombo),e.on($.GeneralAttGS2C.KEY,this,this.onGeneral),e.on(X.CutHurtGS2C.KEY,this,this.onCutHurt),e.on(Q.RoughSkillGS2C.KEY,this,this.onRoughSkillHandler),e.on(X.RingSkillGS2C.KEY,this,this.RingSkillGS2C),c.E.ins.on(u.EventName.RELEASESKILL,this,this.releaseSkillHandler),c.E.ins.on(u.EventName.ClEAR_TARGET,this,this.onClearTargetHandler),c.E.ins.on(u.EventName.updateringling,this,this.updateRingLing),this.setMsgState(0),this._portToEnter=p.RoleCenter.instans.self.portstatus.portindex,e.on(W.PetRecoverGS2C.KEY,this,this.petRecoverGS2C),e.on(D.YcPassiveGS2C.KEY,this,this.winHandler),e.on(z.UserKillMsgGS2C.KEY,this,this.userKillMsgGS2C),this.playSettingVo=x.GameConfig.playsettingJSON[t],this.playSettingVo||console.error("找不到该玩法的配置type:"+t),c.E.ins.on(u.EventName.CHAT_BUBBLE,this,this.onChatBubbleHanlder)}return Object.defineProperty(o.prototype,"enterfail",{get:function(){return this._enterfail},set:function(t){this._enterfail=t},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"fightGroup",{get:function(){return this._fightGroup},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"playerDic",{get:function(){return this._playerDic},enumerable:!0,configurable:!0}),o.prototype.onGeneral=function(t){var e=t.buffTrigger,i=t.hpDec,n=this._playerDic[t.targetUserName];if(n){var s=n.getUnitByIndex(t.attackHIdx);s&&(s.svrSetHP(s.getHp()-i),this.fgDeathHide(n),m.FE.shenjiang(e,i,s.body))}else{var o=this._monsterDic[-1];o&&m.FE.shenjiang(e,i,o.body)}Z.SjUtils.getMinSuitLv()},o.prototype.onCutHurt=function(t){var e=this._playerDic[t.uname];if(e){var i=e.getFUList()[0];if(i){var n=i.topHpBar;m.FE.mashAttFloat(n.x,n.y,"qiege")}}},o.prototype.onRoughSkillHandler=function(t){var e=this._playerDic[t.srcUname];if(e){var i=e.getMainRole();i&&m.FE.roughFloat(t.skillid,i.topHpBar.x-50,i.topHpBar.y+100)}},o.prototype.winHandler=function(t){console.log("---技能效果-------",t.sidArr);var e=this._playerDic[t.username];if(e)for(var i=0;i<t.sidArr.length;i++)for(var n=0;n<3;n++){if(e.getUnitByIndex(n))break}},o.prototype.userKillMsgGS2C=function(t){var e,i,n=this._playerDic[t.srcuname];n&&(i=n.getNickName());var s=this._playerDic[t.deathuname];s&&(e=s.getNickName()),i&&e&&c.E.ins.event(u.EventName.POP_KILL_TIP,[e,i])},o.prototype.petRecoverGS2C=function(t){var e=this._playerDic[t.uname];if(e){for(var i=!1,n=t.hhSkill,s=0;s<t.hpRecover.length;s++){var o=e.getUnitByIndex(s);o&&t.hpRecover[s]&&(o.svrSetHP(o.hp+t.hpRecover[s]),m.FE.greenBlood(t.hpRecover[s],o.face,o.topHpBar.x,o.topHpBar.y)),i||t.decdef&&(i=!0,m.FE.godPetSkill(t.decdef,o))}if(0!=n){var a=e.getUnitByIndex(0);a&&m.FE.godPetSkill(n,a)}}},o.prototype.onZlAni=function(t){var e=this._fightGroup;if(e){var i=t.hpAddVal,n=j.sbkZhanLingData.baseId,s=t.hhid||n;p.RoleCenter.instans.self.zlData.getOneZhanLing(n).starLv>=x.GameConfig.zltype[n].skill[1][1]&&c.E.ins.event(u.EventName.ZL_ANI,s);var o=e.getFUList()[t.hpAddIdx];if(o&&!o.isDeath()&&!o.isSummonPet()){var a=o.getHp()+i+o.hpAddAbs+o.hpAddPercent,r=o.getMultied_HP();r<a&&(a=r),o.setHp(a);var l=o.topHpBar;l&&m.FE.greenBlood(i,o.face,l.x,l.y,1)}}},o.prototype.setJoinSkill=function(){var t=x.GameConfig.playsettingJSON[this.type];N.AutoSkillBtnCtrl.setPos(Laya.stage.width,Laya.stage.height/2,t)},o.prototype.checkJoinSkill=function(t){100<=t.rageVal&&N.AutoSkillBtnCtrl.autoSkill(F.enumComboIdx.danti)},o.prototype.releaseSkillHandler=function(t){throw Error("释放合击技能 子类必须复写")},o.prototype.releaseSkill=function(t,e){if(this._fightGroup.isDeath())m.FE.upItems(J.TextConst.get(698),U.BubbleEnum.center);else{var i=new T.ComboHitC2GS;i.comboid=t,i.beAttackAcc=e,n.GSM.sendServer(i)}},o.prototype.onClearTargetHandler=function(t){},o.prototype.onComboHit=function(t){if(0<t.invincibleTime){var e=this._playerDic[t.attackAcc];if(e){for(var i=Date.now()+t.invincibleTime,n=e.getCount(),s=0;s<n;s++)e.getUnitByIndex(s).setInvincibleState(i);e&&this.updateHp(e,t.hpAfterAttack)}}var o=this._playerDic[t.attackAcc];if(o&&o.playJoinAttSkill(t),t.invincibleTime<=0){var a=this._playerDic[t.beAttackAcc];a&&(this.updateHp(a,t.hpAfterAttack),a.isDeath()&&a.delayDeathHide())}0==t.comboid&&(H.BtnSkiilCtrl.ins.progressValue(100),console.error(t.beAttackAcc))},o.prototype.setAttackMsg=function(t){this.onAttackMsg(t)},o.prototype.onAttackMsg=function(t){var e=this._playerDic[t.attackAcc],i=this._playerDic[t.beAttackAcc];if(e&&i){for(var n=t.heroAttack,s=null,o=null,a=0;a<n.length;a++)s=n[a],(o=e.getUnitByIndex(a))&&0<s.suckHp&&(o.svrSetHP(o.getHp()+s.suckHp),m.FE.greenBlood(s.suckHp,o.face,o.topHpBar.x,o.topHpBar.y));i&&(e.getChopLv()>i.getChopLv()&&i.getMainRole()&&m.FE.chopFloat(i.getMainRole()),this.updateHp(i,t.hpAfterAttack))}this._useInfoAddValueKey&&t.attackAcc==p.RoleCenter.instans.self.username&&H.BtnSkiilCtrl.ins.progressValue(t.rageVal)},o.prototype.updateHp=function(t,e){for(var i=t.getCount(),n=null,s=0;s<e.length&&s<i;s++)(n=t.getUnitByIndex(s)).isSummonPet()||(p.RoleCenter.instans.self.username==t.groupID&&0==n.isHeTi&&0<n.getHp()&&0==e[s]&&(n.svrSetHP(e[s]),this.switchRole()),n.svrSetHP(e[s]))},o.prototype.ringup=function(t,e,i){void 0===i&&(i=0);if(t){var n=t._ringUnit;if(n){var s=n.topHpBar;if(s){var o=s.x,a=s.y-50;8012==Number(e)?m.FE.ringSkillFloat(o,a,e,i,!0):m.FE.mashAttFloat(o,a,e)}}}},o.prototype.RingSkillGS2C=function(t){console.error(t);var e=t.hpAdd,i=t.wsState;if(this._playerDic){var n=this._playerDic[t.uname];if(n){var s=n.getFUList()[0],o=this._playerDic[t.targetUname];if(t.critHit&&s)m.FE.baoJi(s.body.x,s.body.y);else{var a=t.skillId;switch(console.log("收到戒灵技能消息: 技能id:"+a+"血量数组:",e),a){case 8003:if(s){var r=s.topHpBar;if(r){var l=r.x,h=r.y;m.FE.ringskill("zd_pz_120.png",l,h,t.attTotal)}}break;case 8004:if(t.shieldOrHp)this.ringup(n,"zd_pz_144");else for(var c=0;c<e.length;c++){var u=n.getUnitByIndex(c),p=e[c];u&&0<p&&u.setHp(u.hp+p)}break;case 8005:case 8007:case 8008:case 8009:case 8010:case 8011:case 8015:if(this.ringup(n,a+""),8010==a)for(var d=0;d<e.length;d++){u=n.getUnitByIndex(d),p=e[d];u&&0<p&&u.setHp(u.hp+p)}else if(8015==a)for(var g=0;g<e.length;g++){u=n.getUnitByIndex(g),p=e[g];u&&0<p&&u.setHp(p)}else if((8005==a||8007==a)&&o)for(var v=0;v<e.length;v++){var f=o.getUnitByIndex(v);p=e[v];if(f&&0<p){f.setHp(f.hp-p);var y=f.body;y&&m.FE.floatBlood(p,f.face,f.job,y.x,y.y)}}break;default:this.ringup(n,a+"",i)}}}}},o.prototype.updateRingLing=function(){if(this.fightGroup){var t=p.RoleCenter.instans.vo.ringLing.chuzhanId;this.fightGroup.showFollowRing(f.ItemUtils.getRingUrl(t))}},o.prototype.phCombo=function(t){var e=t.hpDec,i=t.comboAttIdx,n=this._playerDic[t.targetUserName];if(n){var s=n.getUnitByIndex(t.attackHIdx);s&&(s.svrSetHP(s.getHp()-e),this.fgDeathHide(n),m.FE.lianji(i,e,s.body))}else{var o=this._monsterDic[-1];o&&m.FE.lianji(i,e,o.body)}var a=Date.now(),r=0;isNaN(this.lastTime)||(r=a-this.lastTime),this.lastTime=a,console.log("距离上次释放连击已过"+r/1e3+"秒");var l=p.RoleCenter.instans.vo.phData.huanIDArr,h=0==l.length?1:l[Math.floor(Math.random()*l.length)];c.E.ins.event(u.EventName.HL_ANI,h)},o.prototype.petAttack=function(t){var e,i=t.bFireShield,n=t.skyMeshSkill,s=t.customData,o=t.fireSkillID,a=t.hpDec,r=this._playerDic[t.targetUserName];if(r){var l;(l=r.getUnitByIndex(t.attackHIdx))&&(l.svrSetHP(l.getHp()-a),this.fgDeathHide(r),e=l.topHpBar)}else{var h=this._monsterDic[-1];h&&(e=h.topHpBar)}(r=this._playerDic[t.username])&&((l=r.getUnitByIndex(t.attackHIdx))&&(e=l.topHpBar));if(e){m.FE.petAtt(a,e.x,e.y);var c=void 0,u=!0;if(n&&(c="zzx_piapzi"),i&&(c="zd_pz_014"),0<s){if(2920==o||2929==o)return void m.FE.ringSkillFloat(e.x,e.y,o+"",s,!1);2922==o?c="pz_00"+s:2926==o?(c="xrpz_"+s,u=!1):2927==o?(c="dmpz_"+s,u=!1):2928==o?(c="hhpz_"+s,u=!1):(c="zq_zdz_00"+s,m.FE.mashAttFloat(e.x-50,e.y-20,"zq_yuelaing_00"+s))}if(c&&m.FE.mashAttFloat(e.x,e.y,c),o&&u)return void m.FE.mashAttFloat(e.x,e.y,o+"")}else{var p=this._mainRole;if(o)return void(p&&(e=p.topHpBar)&&m.FE.mashAttFloat(e.x,e.y,o+""))}},o.prototype.petHpAdd=function(t){var e=this._fightGroup;if(e){var i=t.hpAddAbs,n=t.hpAddPercent,s=e.getFUList();if(0<s.length)for(var o=0;o<s.length;o++){var a=s[o];a.isDeath()||a.isSummonPet()||(a.hpAddAbs=i[o],a.hpAddPercent=n[o],a.resetHP(!1))}}},o.prototype.onPassiveResultGS2C=function(t){var e=this._playerDic[t.username];if(e){var i=e.getFGTarget(),n=e.getUnitByIndex(t.heroIdx),s=n.fightTarget;if(t.destUsername){if(!(i=this._playerDic[t.destUsername]))return;s=i.getUnitByIndex(t.destHeroIdx)}if(e){n&&n.triggerPassive(t.passiveID);var o=n.job,a=null,r=0,l=f.ItemUtils.getPassiveVoById(t.passiveID),h=null,c=!1;if(l){var u=!1;switch(l.type){case 1:0<t.recoverHP?r=t.recoverHP:(console.error("recoverHP:"+t.recoverHP),u=!0);var p=n.getHp()+r;p<n.getTotalHp()?n.svrSetHP(p):n.svrSetHP(n.getTotalHp()),h=n,m.FE.greenBlood(r,h.face,h.topHpBar.x,h.topHpBar.y);break;case 4:a="fanshang_"+o+".png",h=s,r=t.hitBack,n.svrSetHP(n.getHp()-r);break;case 5:t.triggerHpHurt||(console.error("致命效果与心法效果对不上"),u=!0);break;case 6:a="canfei_"+o+".png",h=s,t.triggerDecAtt||(console.error("残废效果与心法效果对不上"),u=!0),r=l.getEffectValue(),c=!0;break;case 7:a="fuzhuo_"+o+".png",h=s,t.triggerDecDef||(console.error("腐蚀效果与心法效果对不上"),u=!0),r=l.getEffectValue(),c=!0;break;case 8:t.ringRevive&&n.showOff(200),n.resetUnit(n.worldX,n.worldY),n.svrSetHP(t.reviveHP)}u&&console.log(JSON.stringify(t))}a&&h&&h.topHpBar&&m.FE.hurtFloat(a,r,n.job,h.topHpBar.x,h.topHpBar.y,c)}}else console.error(JSON.stringify(t))},o.prototype.onSyPassiveResultGS2C=function(t){var e=this._playerDic[t.username];if(e){var i=e.getUnitByIndex(t.heroIdx);e&&i&&i.triggerShenYu(t)}else console.error(JSON.stringify(t))},o.prototype.distanceToBoss=function(t){return 0},o.prototype.onUserHPChg=function(t){var e=this._playerDic[t.beAttackAcc];e&&this.updateHp(e,t.hpAfterAttack)},o.prototype.onRingRecoverGS2C=function(t){if(this._fightGroup){var e=this._fightGroup.getUnitByIndex(t.heroidx);e&&(m.FE.greenBlood(t.hpadd,e.face,e.topHpBar.x,e.topHpBar.y),e.svrSetHP(e.getHp()+t.hpadd))}},o.prototype.onHpChg=function(t){if(0<t.suckHP){var e=this._playerDic[t.attackAcc];if(e)(o=e.getUnitByJob(_.JobEnum.DAOSHI))&&(m.FE.greenBlood(t.suckHP,o.face,o.topHpBar.x,o.topHpBar.y),o.svrSetHP(o.getHp()+t.suckHP),o.playExtEff&&o.playExtEff(E.RES.getSdurl("E1_59")))}var i=null;if(i=this._playerDic[t.beAttack]){var n=null;if(255==t.beAttackHidx)for(var s=i.getCount(),o=null,a=0;a<s;a++)(o=i.getUnitByIndex(a)).isSummonPet()||(n=o)&&n.svrSetHP(Math.max(n.getHp()-t.hpChange,0));else(n=i.getUnitByIndex(t.beAttackHidx))&&n.svrSetHP(t.hpAfterAttack)}else console.log("error:GamePlayeMine:onHpChg:tFightGroup == null");t.beAttack==p.RoleCenter.instans.self.username&&t.hpAfterAttack<=0&&this.switchRole()},o.prototype.splitFightReward=function(t){if(t){for(var e=t.itemList,i=e.length,n=0;n<i;n+=2)for(var s=e[n],o=e[n+1],a=0;a<o;a++)e.push(s),e.push(1);e.splice(0,i)}},o.prototype.setMsgState=function(t){this._fMsgState=t},o.prototype.getMsgState=function(){return this._fMsgState},o.prototype.setPortState=function(t){this._curPortState=t},o.prototype.onReceiveSweepMatCopy=function(t){0!=t.opresult&&(p.RoleCenter.instans.addInventoryToC(t.invent),t.invent.currencyList.length=0,this.splitFightReward(t.invent),this.effectExpAndMoney(t.invent),t.invent.clear(),c.E.ins.event(u.EventName.SWAPFINISH,t))},o.prototype.init=function(t){void 0===t&&(t=null),this.mapData=t,console.log("初始化玩法:"+L.PlayTypeName.PlayName[this.type]+" 类型："+this.type),Laya.timer.once(500,this,this.initRingUnit),this.initEffect(t),Laya.timer.once(200,this,this.checkPlot),this._isready=!0},Object.defineProperty(o.prototype,"isready",{get:function(){return this._isready},enumerable:!0,configurable:!0}),o.prototype.returnbackHangUp=function(){this.enterfail=!0,this.isready&&this.returnAutoplayPort()},o.prototype.onChatBubbleHanlder=function(t){var e=this.getPlayerFG(t.username);if(e){var i=e.getMainRole();i&&i.talkBubble(t.msg)}},o.prototype.checkPlot=function(){if(this._portData){var t=x.GameConfig.portPlotJson[this._portData.id];t&&c.E.ins.event(u.EventName.POP_PHRASE,t.desc)}},o.prototype.initRingUnit=function(){c.E.ins.on(u.EventName.AEGIS_UPGRADE_SUCCESS,this,this.initRingUnit);var t=x.GameConfig.commonJson.ringhasexterior;t&&Number(t.value);var e=p.RoleCenter.instans.vo.ringLing.chuzhanId;1<=p.RoleCenter.instans.vo.aegisData.level||e?this.updateRingLing():c.E.ins.on(u.EventName.AEGIS_UPGRADE_SUCCESS,this,this.initRingUnit)},o.prototype.redEqAddTask=function(t){if(i.TaskManager.ins.currentTask&&41==i.TaskManager.ins.currentTask.type)for(var e=0;e<t.equipList.length;e++)t.equipList[e].chengzhuang&&(p.RoleCenter.instans.self.taskdata.getRedEquipNumByLv++,c.E.ins.event(u.EventName.SHENZHUANG_CHANGETASK))},o.prototype.onReceiveFightStart=function(t){this.setMsgState(2),t.opresult||console.log("战斗开始error",t.error),this.scene.fightid=t.fightid},o.prototype.onReceiveFightEnd=function(t){this.setMsgState(4),this.scene.fightid=t.fightid+1;var e=this._fightReward;t.opresult?(this._portToEnter=t.portidx,e&&(0<t.moneyconvert&&e.addCurrency(g.CurrencyType.MONEY,t.moneyconvert),p.RoleCenter.instans.addInventoryToC(e))):e&&e.clear()},o.prototype.pickUpEnd=function(){this._fightReward&&p.RoleCenter.instans.addInventoryItemToC(this._fightReward)},o.prototype.frameMove=function(){},o.prototype.onTaskUpdate=function(){this.task=i.TaskManager.ins.currentTask},o.prototype.effectExpAndMoney=function(t){p.RoleCenter.effectExpAndMoney(t)},o.prototype.pickAllDropItem=function(){var t=h.SceneObjManager.instans.totalDrops;if(0<t.length)for(var e=0;e<t.length;e++)v.DropUtil.pickUpDrop(t[e].unit_uid)},o.prototype.getInitPos=function(t,e){var i=t,n=e,s=a.GameScene.ins.map;return s.isCross([i-o.OFFSET_POS,n])?[i-o.OFFSET_POS,n]:s.isCross([i+o.OFFSET_POS,n])?[i+o.OFFSET_POS,n]:s.isCross([i,n-o.OFFSET_POS])?[i,n-o.OFFSET_POS]:s.isCross([i,n+o.OFFSET_POS])?[i,n+o.OFFSET_POS]:[i,n]},Object.defineProperty(o.prototype,"roleCenter",{get:function(){return p.RoleCenter.instans},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"scene",{get:function(){return a.GameScene.ins},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"mapVo",{get:function(){return this.scene.mapVo},enumerable:!0,configurable:!0}),o.prototype.returnAutoplayPort=function(){if(n.GSM.connected){var t=x.GameConfig.playsettingJSON[this.type];t&&0!=t.exitOpenPanel&&q.Switches.ins.event(t.exitOpenPanel),p.RoleCenter.instans.vo.portstatus.inMainCity?O.MainCityManager.getInstance().ChangeToMainCity():c.E.ins.event(u.EventName.PLAY_TYPE_CHANGE,I.PlayTypeVo.create(R.EPlayType.PLAYTYPE_PORT))}},o.prototype.returnGuildMonster=function(){c.E.ins.event(u.EventName.PLAY_TYPE_CHANGE,I.PlayTypeVo.create(R.EPlayType.PLAYTYPE_PORT)),c.E.ins.event(u.EventName.OPEN_GUILD_MONSTER_PAGE)},o.prototype.fightFailedProcess=function(){this._portToEnter=p.RoleCenter.instans.self.portstatus.portindex,C.AccountViewCtrl.ins.failFightEnd(Laya.Handler.create(this,this.returnAutoplayPort))},o.prototype.enterNextPort=function(t){this.pickAllDropItem(),console.log("enterNextPort",t);var e=f.ItemUtils.getPortVoById(t);this.scene.port=e;var i=p.RoleCenter.instans.self.portstatus;t!=i.portindex&&(i.killMonsterGroups=0,this._portProductivityUp=!0),i.portindex=t,c.E.ins.event(u.EventName.CHANGE_PORT_MODE,_.TypeMode.GUAJI),c.E.ins.event(u.EventName.PLAY_TYPE_CHANGE,I.PlayTypeVo.create(R.EPlayType.PLAYTYPE_PORT,e.boss_scene,!1)),this.setPortState(0)},o.prototype.enterIntoPort=function(){this.enterNextPort(this._portToEnter)},o.prototype.createSceneNPCFight=function(t,e,i){void 0===i&&(i=!1);var n=new y.SceneNPCFight;return i?n.createFight(t,-1,e):n.createFight(t,this.scene.port.monster[0],e),n},o.prototype.clear=function(){N.AutoSkillBtnCtrl.removeSkill(),d.SceneObjCtroller.ins.self&&(d.SceneObjCtroller.ins.self.status=0),this.pickAllDropItem(),b.LayerManager.fightLayer.showAutoSearch(!1),Laya.timer.clearAll(this),S.SoundUtils.getInstance().stopAll();var t=n.GSM.ins;t.off(X.RingSkillGS2C.KEY,this,this.RingSkillGS2C),t.off(s.FightStartGS2C.KEY,this,this.onReceiveFightStart),t.off(l.FightEndGS2C.KEY,this,this.onReceiveFightEnd),t.off(w.SweepFightGS2C.KEY,this,this.onReceiveSweepMatCopy),t.off(Y.ZLAppearGS2C.KEY,this,this.onZlAni),t.off(T.UserAttackGS2C.KEY,this,this.onAttackMsg),t.off(A.UserHPChageGS2C.KEY,this,this.onUserHPChg),t.off(A.HPChangeGS2C.KEY,this,this.onHpChg),t.off(T.ComboHitGS2C.KEY,this,this.onComboHit),t.off(D.PassiveResultGS2C.KEY,this,this.onPassiveResultGS2C),t.off(D.SyPassiveResGS2C.KEY,this,this.onSyPassiveResultGS2C),t.off(V.RingRecoverGS2C.KEY,this,this.onRingRecoverGS2C),t.off(W.PetRecoverGS2C.KEY,this,this.petRecoverGS2C),t.off(W.PetHPAddGS2C.KEY,this,this.petHpAdd),t.off(W.PetAttackGS2C.KEY,this,this.petAttack),t.off(D.YcPassiveGS2C.KEY,this,this.winHandler),t.off($.PhComboAttGS2C.KEY,this,this.phCombo),c.E.ins.off(u.EventName.PICK_ALL_ITEM,this,this.pickUpEnd),c.E.ins.off(u.EventName.updateringling,this,this.updateRingLing),t.off(X.CutHurtGS2C.KEY,this,this.onCutHurt),t.off(Q.RoughSkillGS2C.KEY,this,this.onRoughSkillHandler),t.off($.GeneralAttGS2C.KEY,this,this.onGeneral),this.task=null,b.LayerManager.fightLayer.shadowLayer.removeChildren(),b.LayerManager.fightLayer.removeAllUnit(),b.LayerManager.fightLayer.popLayer.removeChildren(),this.isDestroySelfKey&&d.SceneObjCtroller.ins.destroySelfGroup(),E.RES.clearSceneRoleInfo(),c.E.ins.off(u.EventName.RELEASESKILL,this,this.releaseSkillHandler),c.E.ins.off(u.EventName.ClEAR_TARGET,this,this.onClearTargetHandler),this._mainRole&&(this.clearHandler(this._mainRole),this._mainRole=null),this._fightGroup&&0<this._fightGroup.getFightCount()&&h.SceneObjManager.instans.setLock(this._fightGroup.getUnitByIndex(0)),this.clearOtherPlayer(),this.clearEff(),this.releaseAllMonsterRes();for(var e=0;e<this._monsterFGArr.length;e++)this._monsterFGArr[e].destroyGroup(!0);this._monsterFGArr.length=0;var i=d.SceneObjCtroller.ins.getSelfGroup();i&&(i.forceLoad(),i.stand()),K.StateManger.isMatching=!1,c.E.ins.off(u.EventName.AEGIS_UPGRADE_SUCCESS,this,this.initRingUnit),c.E.ins.off(u.EventName.CHAT_BUBBLE,this,this.onChatBubbleHanlder)},o.prototype.clearEff=function(){for(var t=this.effectsIns.length,e=0;e<t;)this.effectsIns[e].destroy(),e++;this.effectsIns.length=0},o.prototype.setFightGroup=function(t){this._fightGroup=t,this.switchRole(),this._playerDic[t.groupID]=t,this.initRingUnit()},o.prototype.addPlayerFG=function(t){if(t){var e=t.groupID;this._playerDic[e]||this.nowGroupNum++;var i=this._unitAllHideKey;this.nowGroupNum>this.maxGroupNum&&t.forceHide(i),t.limitDraw(!this._otherPVKey,i),this._playerDic[e]=t;var n=(this._otherPlayerDic[e]=t).otherData;if(n){var s=n.aegisData;if(s&&1<=s.level){var o=x.GameConfig.commonJson.ringhasexterior;o&&Number(o.value);var a=n.rwData.chuzhanId;t.showFollowRing(f.ItemUtils.getRingUrl(a),!0)}}}else console.error("GamePlay::addPlayerFG:fg == null")},o.prototype.removePlayerFG=function(t,e){var i=t.groupID;this._playerDic[i]&&(e&&t.destroyGroup(!0),this.nowGroupNum--,delete this._playerDic[i]);var n=this._otherPlayerDic;n[i]&&(n[i]=null,delete n[i])},o.prototype.getPlayerFG=function(t){return this._playerDic[t]?this._playerDic[t]:null},o.prototype.clearOtherPlayer=function(){for(var t in this._otherPlayerDic)this._otherPlayerDic[t]&&this.removePlayerFG(this._otherPlayerDic[t],!0);this._otherPlayerDic={}},o.prototype.createMonsterFGArr=function(t,e,i,n){for(var s=null,o=0,a=-1,r=-1,l=0;l<e.length;l++){s=new P.FightGroup(null),o=e[l];for(var h=0;h<o;h++)if(++a<t.length&&a<i.length){var c=f.ItemUtils.getMonsterVOById(t[a]),u=i[a];if(r=-1,a<n.length&&(r=n[a]),6==c.type){var p=x.GameConfig.robotNpcCfg[c.id];if(p){var d=new B.RobotNpc;d.showHpKey=!0,d.initRobotFromHero(p,u),-1!=r&&(d.face=r),d.stand(),d.setMapXY(u[0],u[1]),d.viewDis=450,d.setHp(c.HP),d.changeHPKey=!0,d.fightRealTimePathKey=!0,s.addFightUnit(d)}else console.error("找不到NPC数据:npcId:"+c.id.toString())}else{var g=new M.MonsterUnit_New;g.set_DATA(c),g.viewDis=450,g.setMapXY(u[0],u[1]),g.fightRealTimePathKey=!0,g.face=r,s.addFightUnit(g)}}s.addToFightLayer(),this._monsterFGArr.push(s)}},o.prototype.createMonsterFG=function(t,e){for(var i=new P.FightGroup(null),n=0;n<t.length;n++)e?this.createMonster(i,t[n],e[n]):this.createMonster(i,t[n],-1);return i},o.prototype.createMonster=function(t,e,i,n){void 0===n&&(n=tt.HpType.monster);this.type,R.EPlayType.PLAYTYPE_MZJD;var s=n!=tt.HpType.noShow,o=new G.SvrPeopleBossMonster(s);this._monsterTypeDic[e]=o;var a=this._monsterTypeCountDic[e]||0;a++,this._monsterTypeCountDic[e]=a,o.moveModulus=2,s&&(o.topHpBar.typeElement=n);var r=f.ItemUtils.getMonsterVOById(e);return r&&o.set_DATA(r),t.addFightUnit(o),this._monsterDebugKey&&console.log("增加怪物：uId:"+i.toString()),this._monsterDic[i]=o,this._count++,o},o.prototype.releaseAllMonsterRes=function(){var t=null;for(t in this._monsterDic)this.setMonsterHp(t,0,!0);for(t in this._monsterDic={},this._monsterTypeDic)this._monsterTypeDic[t]&&(this._monsterTypeDic[t].destroyUnit(),delete this._monsterTypeDic[t]);this._monsterTypeDic={}},o.prototype.setMonsterHp=function(t,e,i){this._monsterDic[t]?this._monsterDic[t].svrSetHP(e):(console.log("怪物找不到,id:"+t),console.log("怪物找不到,id:"+t)),0==e&&(i?this.clearMonster(t):this._monsterDic[t]&&(this._monsterDic[t].startDeadDelayHide(),-1==this._saveUidArr.indexOf(t)&&this._saveUidArr.push(t)))},o.prototype.clearMonster=function(t){if(this._monsterDebugKey&&console.error("删除怪物,id:"+t+" count:"+this._count),!(-1<this._saveUidArr.indexOf(t))){var e=this._monsterDic[t];if(e&&e.vo){var i=e.vo.id;this._monsterTypeCountDic[i]&&(this._monsterTypeCountDic[i]--,0==this._monsterTypeCountDic[i]&&this.releaseMonsterRes(i))}e&&e.getFightGroup()&&e.getFightGroup().removeFightUnit(this._monsterDic[t]),this._monsterDic[t]=null,delete this._monsterDic[t],this._count--}},o.prototype.clearSaveMonster=function(){for(var t=0;t<this._saveUidArr.length;t++)this.clearMonster(this._saveUidArr[t]);this._saveUidArr.length=0},o.prototype.releaseMonsterRes=function(t){this.clearSaveMonster(),this._monsterTypeDic[t]&&(this._monsterTypeDic[t].destroyUnit(),delete this._monsterTypeDic[t])},o.prototype.switchRole=function(t){if(void 0===t&&(t=!1),this._mainRole&&this._mainRole.isDeath()&&(this.clearHandler(this._mainRole),this._mainRole=null),t&&(this._mainRole=null),null==this._mainRole){var e=this._fightGroup.getValidArr();0<e.length&&(this._mainRole=e[0],this.registerHandler(this._mainRole),h.SceneObjManager.instans.setLock(this._mainRole))}},o.prototype.registerHandler=function(t){t&&(t.registerStartCallHandler(this._startCallHandler),t.registerCompleteCallHandler(this._endCallHandler))},o.prototype.clearHandler=function(t){t&&(t.clearStartCallHandler(),t.clearCompleteCallHandler())},o.prototype.initEffect=function(t){if(t&&t.map_effect){if(this.effects=r.MapCovert.parseToNumber(t.map_effect),!t.effect_bornplace)return;this.effectsXY=r.MapCovert.parseBySemicolon(t.effect_bornplace);for(var e,i=this.effects.length,n=0,s=0;n<i;)s=this.effects[n],(e=new k.MapAnimObj).setEffectId(s),e.addMap(this.effectsXY[n][0],this.effectsXY[n][1]),this.effectsIns.push(e),n++}},o.prototype.otherPlayerVisible=function(t){if(this._otherPVKey!=t)for(var e in this._otherPVKey=t,this._otherPlayerDic)this._otherPlayerDic[e]&&this._otherPlayerDic[e].limitDraw(!t,this._unitAllHideKey)},o.prototype.monsterVisible=function(t){this._monsterVKey!=t&&(this._monsterVKey=t)},o.prototype.npcVisible=function(t){this._npcVKey!=t&&(this._npcVKey=t)},o.prototype.releaseClientComboHit=function(t){if(this._fightGroup){var e=new T.ComboHitGS2C;e.comboid=t,e.beAttackAcc="",e.hpAfterAttack=[0,0,0,0,0,0],this._fightGroup.playClientJoinAttSkill(e),H.BtnSkiilCtrl.ins.progressValue(0),H.BtnSkiilCtrl.ins.resetPortSkillProgress()}else console.error("GamePlay::releaseClientComboHit:_fightGroup = null")},o.prototype.releaseClientComboHit2=function(t){if(this._fightGroup){var e=f.ItemUtils.getSkillVoById(t).target,i=new T.ComboHitGS2C;1==e&&(i.invincibleTime=10,i.hpAdd=1e3),i.comboid=t,i.beAttackAcc="",i.hpAfterAttack=[1e3*-Math.random()-3e3>>0,1e3*-Math.random()-2e3>>0,1e3*-Math.random()-1e3>>0,1e3*-Math.random()-1e3>>0,1e3*-Math.random()-1e3>>0],this._fightGroup.playClientJoinAttSkill(i),H.BtnSkiilCtrl.ins.progressValue(0),H.BtnSkiilCtrl.ins.resetPortSkillProgress()}else console.error("GamePlay::releaseClientComboHit2:_fightGroup = null")},o.prototype.fgDeathHide=function(t,e,i){void 0===e&&(e=!1),t&&t.isDeath()&&(t.delayDeathHide(),e&&t.setOnceTarget(i))},o.OFFSET_POS=9,o}();e.GamePlay=it}),define("src/g/fight/osprite/play/skyLadder/GamePlaySkyLadder",["require","exports","src/g/fight/osprite/play/GamePlay","src/g/fight/osprite/obj/FightGroup","src/g/fight/osprite/SceneObjCtroller","../../../../../core/E","../../../../../enum/EventName","../../../../net/messages/KingDataGS2C","src/g/account/ctrl/AccountViewCtrl","../../../../../manager/RoleCenter","../../../../../manager/GameSocketManager","src/g/fight/osprite/play/baseplay/SvrHeroUnit","src/g/fight/osprite/NetCtroller","src/g/pvp1v1/ctrl/ChallengeRecover","../../../../../manager/StateManger","../../../../../enum/HpType"],function(t,e,i,a,n,s,o,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(i){function t(t){var e=i.call(this,t)||this;return e._bossaccname="",e}return __extends(t,i),t.prototype.init=function(t){void 0===t&&(t=null),i.prototype.init.call(this,t),s.E.ins.on(o.EventName.EXIT_BOSS_PLAYTYPE,this,this.exitHandler),c.GSM.ins.on(r.KingMatchCombatResultGS2C.KEY,this,this.onEndMsg),p.NetCtroller.fightStartC2GS(!0,[],1),this.startHandler(this.msg),this.setJoinSkill()},t.prototype.startHandler=function(t){var e=t.matchUser[0];this.heroPostion=this.mapVo.startPoint[0],this.bossGroup=new a.FightGroup(e.username),this._bossaccname=e.username,this.addPlayerFG(this.bossGroup);for(var i=e.openhero,n=i.length,s=0;s<n;s++){var o=i[s];this.createEnamy(o,e.chopLv,0,e.nickname,this.bossGroup,s)}this.selfGroup||this.initHeroGroup(),this.selfGroup.setOnceTarget(this.bossGroup),Laya.timer.once(1e3,this,function(){this.bossGroup.setFGTarget(this.selfGroup)}),this.handlerVo()},t.prototype.handlerVo=function(){var t=h.RoleCenter.instans.vo.getKingData();0<h.RoleCenter.instans.vo.KING?h.RoleCenter.instans.vo.KING--:t.goldBuyCnt--,d.ChallengeRecover.instance().updRecoverStatus(),s.E.ins.event(o.EventName.KING_ATHLETICS_NUM_OF_CHALLENGES),t.totalFight++},t.prototype.createEnamy=function(t,e,i,n,s,o){var a=this.mapVo.bossXY[0],r=(a=this.mapVo.bossXY[0],new u.SvrHeroUnit);r.heroIndex=o,s.addFightUnit(r),r.initHeroData(t,e,i,n),r.topHpBar.typeElement=v.HpType.monster,r.pkGold=!0,s.resetFightGroup(a),s.addToFightLayer()},t.prototype.initHeroGroup=function(){this.selfGroup=n.SceneObjCtroller.ins.getSelfGroup(),this.selfGroup.resetFightGroup(this.heroPostion),this.selfGroup.addToFightLayer(),this.setFightGroup(this.selfGroup),h.RoleCenter.instans.vo.VIP&&n.SceneObjCtroller.ins.self.showOff()},t.prototype.getUserVo=function(){return h.RoleCenter.instans.vo.getKingData()},t.prototype.onEndMsg=function(t){var e=this.getUserVo();this.win=t.win,this.reward=t.reward,e.kingExp+=t.kingExpGet,t.win?(e.victoryFight++,e.consecutiveWin++):e.consecutiveWin=0,e.dan=t.newDan,e.group=t.newGroup,this.win?Laya.timer.once(1e3,this,function(){l.AccountViewCtrl.ins.highFightSucess(this.reward,t,Laya.Handler.create(this,this.exitHandler))}):l.AccountViewCtrl.ins.highFightFail(this.reward,t,Laya.Handler.create(this,this.exitHandler)),h.RoleCenter.instans.addInventoryMoneyToC(this.reward),h.RoleCenter.effectExpAndMoney(this.reward),this.reward.itemList&&0<this.reward.itemList.length&&h.RoleCenter.instans.addInventoryItemToC(this.reward)},t.prototype.exitHandler=function(){this.returnAutoplayPort(),s.E.ins.off(o.EventName.EXIT_BOSS_PLAYTYPE,this,this.exitHandler)},t.prototype.frameMove=function(){i.prototype.frameMove.call(this)},t.prototype.clear=function(){s.E.ins.off(o.EventName.EXIT_BOSS_PLAYTYPE,this,this.exitHandler),c.GSM.ins.off(r.KingMatchCombatResultGS2C.KEY,this,this.onEndMsg),this.bossGroup&&this.bossGroup.destroyGroup(!0),this.selfGroup&&this.selfGroup.destroyGroup(!0),i.prototype.clear.call(this),g.StateManger.isMatching=!1},t.prototype.onHpChg=function(t){i.prototype.onHpChg.call(this,t);var e=this.bossGroup;e&&!t.beAttack&&e.getUnitByIndex(t.beAttackHidx).svrSetHP(t.hpAfterAttack[t.beAttackHidx])},t.prototype.onAttackMsg=function(t){i.prototype.onAttackMsg.call(this,t),this.checkJoinSkill(t)},t.prototype.releaseSkillHandler=function(t){this.releaseSkill(t,this._bossaccname)},t}(i.GamePlay);e.GamePlaySkyLadder=f}),define("src/g/fight/osprite/play/family/GamePlayFamilyRuQin",["require","exports","src/g/fight/osprite/play/GamePlay","src/g/fight/osprite/obj/FightGroup","src/g/fight/osprite/SceneObjCtroller","src/g/fight/osprite/obj/MonsterUnit_New","../../../../../utils/ItemUtils","src/g/fight/osprite/SceneObjManager","src/g/account/ctrl/AccountViewCtrl","../../../../net/messages/ManageFamilyMsg","../../../../../manager/GameSocketManager","../../../../../core/E","../../../../../enum/EventName"],function(t,e,i,s,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t,e){var i=n.call(this,t)||this;return i._mPosIdx=0,i._fightID=-1,i._deathEnd=!1,i.portid=e,i}return __extends(t,n),t.prototype.clear=function(){n.prototype.clear.call(this),this.pickAllDropItem(),this._monsterGroup&&this._monsterGroup.destroyGroup(),u.GSM.ins.off(c.ChallegeInvadeEndGS2C.KEY,this,this.onFightEnd),p.E.ins.off(d.EventName.EXIT_FAIMLY_RUQIN,this,this.exit),p.E.ins.event(d.EventName.GUILD_RUQIN_FIGHTOVER),p.E.ins.off(d.EventName.EXIT_BOSS_PLAYTYPE,this,this.exit)},t.prototype.init=function(t){n.prototype.init.call(this,t),u.GSM.ins.on(c.ChallegeInvadeEndGS2C.KEY,this,this.onFightEnd),p.E.ins.on(d.EventName.EXIT_FAIMLY_RUQIN,this,this.exit),this._portData=r.ItemUtils.getPortVoById(this.portid),this._monXY=this.mapVo.monXY,this.initHeroGroup(),this.initMonsterGroup(),this._fightGroup.setFGTarget(this._monsterGroup),p.E.ins.event(d.EventName.FAIMLY_RUQIN_ID,this.portid),p.E.ins.on(d.EventName.EXIT_BOSS_PLAYTYPE,this,this.exit)},t.prototype.resetMonsterGroup=function(){var t=this._monXY.length;this._mPosIdx>=t||(this._monsterGroup.resetFightGroup(this._monXY[this._mPosIdx]),this._mPosIdx++,this._fightGroup.setFGTarget(this._monsterGroup))},t.prototype.exit=function(){this.returnAutoplayPort(),this.fightEnd(!1)},t.prototype.initHeroGroup=function(){var t=o.SceneObjCtroller.ins.getSelfGroup();t.resetFightGroup(this.mapVo.startPoint[0]),t.addToFightLayer(),this.setFightGroup(t)},t.prototype.initMonsterGroup=function(){this._monsterGroup=new s.FightGroup(null);for(var t=this._portData.monster,e=0;e<t.length;e++){var i=new a.MonsterUnit_New,n=r.ItemUtils.getMonsterVOById(t[e]);i.set_DATA(n),this._monsterGroup.addFightUnit(i)}this._monsterGroup.addToFightLayer(),this._monsterGroup.resetFightGroup(this._monXY[this._mPosIdx]),this._mPosIdx++},t.prototype.fightEnd=function(t){var e=new c.ChallegeInvadeEndC2GS;e.win=t,e.portid=this.portid,u.GSM.sendServer(e),this._deathEnd=!0},t.prototype.onFightEnd=function(t){t.opresult?(this._monsterGroup,t.win?h.AccountViewCtrl.ins.successFightEnd(t.invent,Laya.Handler.create(this,this.returnGuildMonster)):h.AccountViewCtrl.ins.failFightEnd(Laya.Handler.create(this,this.returnGuildMonster)),p.E.ins.event(d.EventName.FAIMLY_RUQIN_END,t)):console.log(t.error)},t.prototype.fightBoss=function(){var t=this._portData.boss;this._monsterGroup.destroyGroup();for(var e=0;e<t.length;e++){var i=this.boss=new a.MonsterUnit_New,n=t[e],s=r.ItemUtils.getMonsterVOById(n);i.set_DATA(s),this._monsterGroup.addFightUnit(i)}this._monsterGroup.resetFightGroup(this.mapVo.monXY[0]),this._monsterGroup.addToFightLayer(),this._fightGroup.setFGTarget(this._monsterGroup),this._mPosIdx++},t.prototype.onComboHit=function(t){},t.prototype.releaseSkillHandler=function(t){this.releaseClientComboHit2(t)},t.prototype.frameMove=function(){n.prototype.frameMove.call(this);var t=this._fightGroup;if(!this._deathEnd)if(t&&t.isDeath())this.fightEnd(!1);else if(this._monsterGroup&&this._monsterGroup.isAllDeathHide()){if(this._monXY.length==this._mPosIdx)return void this.fightBoss();if(this._monXY.length+1==this._mPosIdx){var e=l.SceneObjManager.instans.totalDrops;return 0<e.length&&t&&t.setPITarget(e),void this.fightEnd(!0)}this.resetMonsterGroup()}},t}(i.GamePlay);e.GamePlayFamilyRuQin=n}),define("src/g/fight/osprite/play/family/GamePlayFamilySecret",["require","exports","src/g/fight/osprite/play/GamePlay","src/g/fight/osprite/obj/FightGroup","src/g/fight/osprite/obj/MonsterUnit_New","../../../../../utils/ItemUtils","src/g/fight/osprite/SceneObjCtroller","src/g/fight/manager/ItemManager","src/g/fight/osprite/SceneObjManager","../../../../../core/E","../../../../../enum/EventName","src/g/account/ctrl/AccountViewCtrl","../../../../../utils/system/FloatEffect","../../../../../manager/RoleCenter","../../../../net/messages/FamilyMijingMsg","../../../../../manager/GameSocketManager","../../../../../manager/AM"],function(t,e,i,s,o,a,n,r,l,h,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(i){function t(t){var e=i.call(this,t)||this;return e._isWait=!1,e._isDead=!1,e._isClear=!1,e}return __extends(t,i),t.prototype.init=function(t){void 0===t&&(t=null),i.prototype.init.call(this,t),v.GSM.ins.on(g.ChallengeMijingStartGS2C.KEY,this,this.onFightStart),h.E.ins.on(c.EventName.EXIT_FAIMLY_MIJING,this,this.exitHandler),this.fightStart()},t.prototype.getBonusArrFromScrietID=function(){var t=a.ItemUtils.getFamilyMiJingById(this._secretId);return t?t.reward:[]},t.prototype.initBossGroup=function(){this.bossGroup&&this.bossGroup.destroyGroup(!0),this.bossGroup=new s.FightGroup(null);for(var t=this.scene.port.boss,e=0;e<1;e++){var i=this.bossUnit=new o.MonsterUnit_New;this._bossId=t[e];var n=a.ItemUtils.getMonsterVOById(this._bossId);i.set_DATA(n),i.setDropArr(r.ItemManager.getDropArrayFromArray(this.getBonusArrFromScrietID())),this.bossGroup.addFightUnit(i),this.bossUnit=i}this.result.win||(this.bossUnit.virtualHp=200*Math.random()),this.bossGroup.resetFightGroup(this.bossPostion),this.bossGroup.addToFightLayer()},t.prototype.initHeroGroup=function(t){void 0===t&&(t=!0);var e=n.SceneObjCtroller.ins.getSelfGroup();t&&e.resetFightGroup(this.heroPostion),e.addToFightLayer(),this.setFightGroup(e),this.result.win&&(this._mainRole.virtualHp=200*Math.random())},t.prototype.checkEnd=function(){this._isClear||this.bossGroup&&this.bossGroup.isDeath()&&(this._isWait||(this._mainRole.status=2,this.bossUnit.getDropNum()?h.E.ins.once(c.EventName.PICK_ALL_ITEM,this,this.pickupOver):this.fightEnd(),this._isWait=!0))},t.prototype.pickupOver=function(){var t=this,e=this.getBonusArrFromScrietID();p.FE.getUpFloats(e),d.RoleCenter.instans.addInventoryToC(this.result.invent,!1),this._sendFightEndHand=setTimeout(function(){t._fightGroup.stand(),t.fightEnd(),t._sendFightEndHand=null},1e3),this._fightGroup.resetHP()},t.prototype.fightEnd=function(){this.result.win?this.goNext():this.returnAutoplayPort()},t.prototype.fightStart=function(){var t=new g.ChallengeMijingStartC2GS;t.challengeMJId=this._secretId,v.GSM.sendServer(t)},t.prototype.onFightStart=function(t){t.opresult||(f.AM.show(t.error),this.exitHandler()),d.RoleCenter.instans.ufVo._ufdata.challengeMJPort=t.mijingid,this.result=t,this.bossPostion=this.mapVo.bossXY[0],this.heroPostion=this.mapVo.startPoint[0],this.initBossGroup(),!this._fightGroup&&this.initHeroGroup(),this._isWait=!1,this._fightGroup.resetHP(),this._fightGroup.setFGTarget(this.bossGroup),this.bossGroup.setFGTarget(this._fightGroup),h.E.ins.event(c.EventName.FAIMLY_MIJING_ID,t.mijingPort)},t.prototype.goNext=function(){this._secretId++;var t=a.ItemUtils.getFamilyMiJingById(this._secretId);if(!t)return console.log("没有找到新的秘境ID:"+this._secretId),void this.exitHandler();this._portId=t.portConfig[0][1],this.scene.port=a.ItemUtils.getPortVoById(this._portId)},t.prototype.checkLose=function(){this._isClear||this._fightGroup&&this._fightGroup.isDeath()&&(this._isDead||(this._isDead=!0,u.AccountViewCtrl.ins.failFightEnd(Laya.Handler.create(this,this.exitHandler))))},t.prototype.exitHandler=function(){this.returnAutoplayPort()},t.prototype.frameMove=function(){i.prototype.frameMove.call(this),0<l.SceneObjManager.instans.totalDrops.length&&this._fightGroup.setPITarget(l.SceneObjManager.instans.totalDrops),this.checkEnd(),this.checkLose()},t.prototype.clear=function(){i.prototype.clear.call(this),this._isClear=!0,this._sendFightEndHand&&clearTimeout(this._sendFightEndHand),v.GSM.ins.off(g.ChallengeMijingStartGS2C.KEY,this,this.onFightStart),h.E.ins.off(c.EventName.EXIT_CHUANG,this,this.exitHandler),this.bossGroup.destroyGroup(!0),this._mainRole.virtualHp=0},t}(i.GamePlay);e.GamePlayFamilySecret=y}),define("src/g/fight/osprite/play/baseplay/WorldBossGamePlay",["require","exports","src/g/clearRes/ClearResM","../../../../../enum/EventName","../../../../../core/E","src/g/fight/osprite/obj/FightUnit","src/g/fight/osprite/SceneObjCtroller","../../../../../utils/ItemUtils","src/g/fight/osprite/play/GamePlay","../../../../../manager/GameSocketManager","../../../../net/messages/ActivityMessage","../../../../net/messages/HPChangeGS2C","../../../../net/messages/UserAttackMsg","src/g/fight/osprite/obj/FightGroup","../../../../../manager/RoleCenter","src/g/fight/osprite/play/baseplay/SvrPeopleBossMonster","src/g/fight/osprite/play/baseplay/SvrHeroUnit","src/g/fight/osprite/play/baseplay/vo/WolrdBossVo","../../../../net/messages/ChangeAttackTargetMsg","src/g/boss/view/AllPersonFightView","src/g/index/ctrl/BtnSkiilCtrl","../../../../../utils/DropUtil","../../../../../utils/system/FloatEffect","src/g/account/ctrl/AccountViewCtrl","src/init/TextConst"],function(t,e,n,r,l,h,s,o,i,a,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var E,T=function(i){function t(t){var e=i.call(this,t)||this;return e._autoBeatBackKey=!0,e._updateListKey=!1,e._showAttackBtnKey=!1,e.tPlayerList=[],e._attackTarget="",e}return __extends(t,i),t.prototype.init=function(t){i.prototype.init.call(this,t),this.bossSettingVo=o.ItemUtils.getBossSettingVoById(1);var e=a.GSM.ins;e.on(c.JoinInActivityGS2C.KEY,this,this.onJoinInActMsg),e.on(c.UserJoinInActivityGS2C.KEY,this,this.onOtherUserJoinMsg),e.on(c.UserExitActivityGS2C.KEY,this,this.onUserExitMsg),e.on(c.RobBossOwnerGS2C.KEY,this,this.onOwnerResultMsg),e.on(c.ActivityEndGS2C.KEY,this,this.onActivityEndMsg),e.on(c.ActivityRebirthGS2C.KEY,this,this.onReBornMsg),e.on(c.MonsterShieldChg.KEY,this,this.onShowHuDunMsg),e.on(c.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChange),e.on(m.ChangeAttackTargetGS2C.KEY,this,this.onAttackTargetChange),l.E.ins.on(r.EventName.BOSS_UPDATE_ATTACK_LIST,this,this.updateAttackListHandler)},t.prototype.ownerAttackTarget=function(t){var e=new m.ChangeAttackTargetC2GS;e.actid=this.vo.bossplayID,e.acttype=y.WolrdBossVo.PORT_TYPE,e.beAttackAcc=t,a.GSM.sendServer(e)},t.prototype.fightBackHander=function(){this._autoBeatBackKey=!0,this.autoBeatBack()},t.prototype.autoBeatBack=function(){if(this._autoBeatBackKey){var t=this.getFreeBeatBackTarget();t&&this.beatBack(t.groupID)}},t.prototype.getFreeBeatBackTarget=function(){for(var t=null,e=null,i=this.vo.getAttackList(),n=0;n<i.length;n++)if(e=i[n],(t=this._otherPlayerDic[e.username])&&!t.isDeath())return t;return null},t.prototype.beatBack=function(t){if(this._autoBeatBackKey){var e=this._fightGroup.getFGTarget();(null==e||""==e.groupID||e.isDeath())&&(this.vo.ownerAcc==g.RoleCenter.instans.vo.username?this._mainRole&&0<this.vo.getAttackSelfCount()&&this.ownerAttackTarget(t):console.error("error::GamePlayPeopleBoss:beatBack"))}},t.prototype.initBossGroup=function(){this.bossGroup=new d.FightGroup("");for(var t=this.vo.portData.boss,e=0;e<t.length;e++){var i=new v.SvrPeopleBossMonster,n=o.ItemUtils.getMonsterVOById(t[e]);i.set_DATA(n),i.topHpBar.typeElement=3,this.bossGroup.addFightUnit(i),this.bossUnit=i}this.bossGroup.resetFightGroup(this.vo.mapVo.bossXY[0]),this.bossGroup.addToFightLayer()},t.prototype.initSelfGroup=function(){this._fightGroup=s.SceneObjCtroller.ins.getSelfGroup(),this._fightGroup.resetFightGroup(this.mapVo.startPoint[0]),this._fightGroup.setFGTarget(this.bossGroup),this._fightGroup.addToFightLayer(),this.setFightGroup(this._fightGroup),g.RoleCenter.instans.vo.VIP&&s.SceneObjCtroller.ins.self.showOff()},t.prototype.initPlayers=function(t){for(var e,i=t.otherUserList,n=i.length,s=(t.damageList,0);s<n;s++){var o=i[s],a=o.username;t.bossOwner==a?e=this.addAtherPlayerSbkOtherHeroData(o):this.addAtherPlayerSbkOtherHeroData(o)}e&&this.bossGroup.setFGTarget(e),this.setBossOwnWithAcc(t.bossOwner)},t.prototype.getOtherPlayer=function(t){var e=this._playerDic[t];return e?e.getFUList()[0]:null},t.prototype.addAtherPlayerSbkOtherHeroData=function(t){var e=this.getNextStartPoint(),i=f.SvrHeroUnit.createFightGroup(t,e);return this.addPlayerFG(i),this._updateListKey=!0,t.vipLv&&i.getFUList()[0].showOff(),i.setOnceTarget(this.bossGroup),i},t.prototype.addAtherPlayer=function(t,e,i,n,s,o){var a=this.getNextStartPoint(),r=new f.SvrHeroUnit;o.addFightUnit(r),r.initHeroData(e,i,n,s),o.resetFightGroup(a),r.frameMove(0,0);this.bossGroup.getFGTarget();return o.setOnceTarget(this.bossGroup),o.addToFightLayer(),r},t.prototype.getNextStartPoint=function(){return this.vo.getNextStartPoint()},t.prototype.distanceToBoss=function(t){var e=t.mapX-this.bossUnit.mapX,i=t.mapY-this.bossUnit.mapY;return e*e+i*i},t.prototype.onHpChg=function(t){var e=0;switch(t.beAttack){case"":this.changeBossHP(t);var i=this._playerDic[t.attackAcc];if(i)for(var n=null,s=i.getCount(),o=0;o<t.hpChgList.length&&o<t.skillList.length&&o<s;o++){var a=new h.AttackInfo;e=t.hpChgList[o],a.skillId=t.skillList[o],(n=i.getUnitByIndex(o))&&0!=e&&(a.targets.push(this.bossGroup.getMainRole()),a.hps.push(-e),a.skillResLower.push(t.skillRes[o]||p.ESkillRes.COMMON_HURT),a.skillResHigh.push(p.ESkillRes.NULL)),n.addAttackInfo(a)}break;case g.RoleCenter.instans.vo.username:this.changeSelfHP(t);break;default:this.changeOtherHP(t)}this.updateOwerHp()},t.prototype.onAttackMsg=function(t){i.prototype.onAttackMsg.call(this,t);var e=this._playerDic[t.beAttackAcc];e&&e.isDeath()&&this.vo.removeAttPlayer(t.beAttackAcc),t.beAttackAcc==g.RoleCenter.instans.self.username&&this.checkSelfIsDead(t.attackAcc)},t.prototype.onUserHPChg=function(t){i.prototype.onUserHPChg.call(this,t);var e=this._playerDic[t.beAttackAcc];e&&e.isDeath()&&this.vo.removeAttPlayer(e.groupID),t.beAttackAcc==g.RoleCenter.instans.self.username&&this.checkSelfIsDead(t.attackAcc),this.updateOwerHp()},t.prototype.updateOwerHp=function(){},t.prototype.onComboHit=function(t){if(i.prototype.onComboHit.call(this,t),t.comboid){var e=this._playerDic[t.beAttackAcc];e&&e.isDeath()&&this.vo.removeAttPlayer(e.groupID),t.beAttackAcc==g.RoleCenter.instans.self.username&&this.checkSelfIsDead(t.attackAcc)}},t.prototype.checkSelfIsDead=function(t){if(this._fightGroup.isDeath())if(t){var e=this.vo.getPlayer(t);_.AllPersonFightView.ins.showCountDownPan(e.nickname),this.vo.ownerAcc==this.vo.selfAcc&&(this.vo.attPlayername=e.nickname)}else _.AllPersonFightView.ins.showCountDownPan("BOSS")},t.prototype.changeBossHP=function(t){t.attackAcc;var e=this.bossUnit;e&&e.svrSetHP(t.hpAfterAttack)},t.prototype.changeOtherHP=function(t){var e=this._playerDic[t.beAttack];if(e){var i=e.getFUList()[t.beAttackHidx];i&&(i.svrSetHP(t.hpAfterAttack),i.floatBlood(-t.hpChange,5,p.ESkillRes.NULL,p.ESkillRes.NULL)),this._playerDic[t.beAttack].isDeath()&&this.vo.removeAttPlayer(t.beAttack)}else console.error("处理多人Boss时，碰到了空的FightGroup.")},t.prototype.changeSelfHP=function(t){this.bossUnit;if(this._fightGroup&&!this._fightGroup.isDeath()){var e=this._fightGroup.getFUList()[t.beAttackHidx];e&&e.svrSetHP(t.hpAfterAttack),this._fightGroup.isDeath()&&this.playSettingVo&&C.BtnSkiilCtrl.ins.progressValue(this.playSettingVo.rage)}},t.prototype.onBossOwnerChange=function(t){var e=this._playerDic[t.newowner];e?e.setFGTarget(this.bossGroup):t.newowner==g.RoleCenter.instans.vo.username&&this._fightGroup.setFGTarget(this.bossGroup),this.vo.ownerAcc=t.newowner,this._updateListKey=!0,this.setBossOwnWithAcc(t.newowner),this.updateBossBattleState()},t.prototype.setBossOwnWithAcc=function(t){var e=null,i="";i=t!=g.RoleCenter.instans.self.username&&(e=this.vo.getPlayer(t))?e.nickname:g.RoleCenter.instans.self.nickname,l.E.ins.off(r.EventName.UPDATE_COMBAT,this,this.updateCombat),t==this.vo.selfAcc&&l.E.ins.on(r.EventName.UPDATE_COMBAT,this,this.updateCombat);var n=this._playerDic[t];n&&this.setBossOwn(t,i,e,g.RoleCenter.instans.self,n.getFightCount())},t.prototype.setBossOwn=function(t,e,i,n,s){_.AllPersonFightView.ins.setOwnerInfo(t,e,i,n,s)},t.prototype.updateCombat=function(){throw"必须复写方法"},t.prototype.onUserExitMsg=function(t){if(t.opresult){var e=this._playerDic[t.username];e&&(e.setAllDaeth(),this.removePlayerFG(e,!0),this._updateListKey=!0)}else console.error(t)},t.prototype.onJoinInActMsg=function(t){throw"必须复写方法"},t.prototype.onOtherUserJoinMsg=function(t){throw"必须复写方法"},t.prototype.onUserAttackGS2C=function(t){throw"必须复写方法"},t.prototype.onShowHuDunMsg=function(t){t.shieldStart?_.AllPersonFightView.ins.showHuDunView(this.bossSettingVo.hudunHP,this.type):_.AllPersonFightView.ins.hideHuDunView()},t.prototype.rebornPlayer=function(t,e,i,n){void 0===n&&(n=!0),t.resetFightGroup([e,i]),t.setOnceTarget(this.bossGroup)},t.prototype.onReBornMsg=function(t){if(t.opresult){this.vo.removeAttPlayer(t.userAcc);var e=null;if(t.userAcc==g.RoleCenter.instans.self.username)g.RoleCenter.instans.vo.GOLD-=t.decGold,this.vo.resetAttPlayers(),l.E.ins.event(r.EventName.CHANGE_PK_TARGET,""),this._attackTarget="",this._autoBeatBackKey=!0,this.updateBossBattleState(),this._fightGroup.isDeath()&&(e=this.vo.selfStartPoint,this.rebornPlayer(this._fightGroup,e[0],e[1]),_.AllPersonFightView.ins.hideCountDownPan(),_.AllPersonFightView.ins.setBossHead()),this.switchRole(!0);else{var i=this._playerDic[t.userAcc];if(!i)return;i.isDeath()&&(e=this.vo.getNextStartPoint(),this.rebornPlayer(i,e[0],e[1],!1))}}},t.prototype.onOwnerResultMsg=function(t){throw"必须复写方法"},t.prototype.onActivityEndMsg=function(t){throw"必须复写方法"},t.prototype.onAttackTargetChange=function(t){var e=g.RoleCenter.instans.vo.username;if(t.attackAcc==e&&(l.E.ins.event(r.EventName.CHANGE_PK_TARGET,t.beAttackAcc),this._attackTarget=t.beAttackAcc),t.beAttackAcc!=e&&t.attackAcc!=e||this.updateBossBattleState(),0==t.beAttackAcc.length){var i=this._playerDic[t.attackAcc];i&&(i.setOnceTarget(this.bossGroup),t.attackAcc==g.RoleCenter.instans.vo.username&&_.AllPersonFightView.ins.setBossHead(),this.vo.ownerAcc==g.RoleCenter.instans.vo.username&&this.autoBeatBack())}else{var n=this._playerDic[t.attackAcc],s=this._playerDic[t.beAttackAcc];if(n&&s&&n.setOnceTarget(s),t.beAttackAcc==g.RoleCenter.instans.vo.username){if(this.vo.ownerAcc==g.RoleCenter.instans.vo.username){var o=this.vo.getPlayer(t.attackAcc);this.vo.addAttPlayer(o),this.beatBack(t.attackAcc)}}else if(t.attackAcc==g.RoleCenter.instans.vo.username){var a=this.vo.getPlayer(t.beAttackAcc);_.AllPersonFightView.ins.setFightTargetInfo(a)}}},t.prototype.updateBossBattleState=function(){this.vo.ownerAcc==g.RoleCenter.instans.self.username?0<this._attackTarget.length?_.AllPersonFightView.ins.updateState(2,this._showAttackBtnKey):_.AllPersonFightView.ins.updateState(1,this._showAttackBtnKey):0<this._attackTarget.length?_.AllPersonFightView.ins.updateState(3,this._showAttackBtnKey):_.AllPersonFightView.ins.updateState(4,this._showAttackBtnKey)},t.prototype.onUserHpChange=function(t){throw"必须复写方法"},t.prototype.frameMove=function(){if(i.prototype.frameMove.call(this),this._updateListKey){for(var t in this._updateListKey=!1,this.tPlayerList.length=0,this._otherPlayerDic)t!=this.vo.ownerAcc&&this.tPlayerList.push(this._otherPlayerDic[t]);l.E.ins.event(r.EventName.BOSS_UPDATE_PLAYERLIST,[this.tPlayerList])}},t.prototype.updatePanelState=function(t){t.opresult&&(this._attackTarget="",this.updateBossBattleState(),t.bossOwner==g.RoleCenter.instans.self.username?_.AllPersonFightView.ins.updateState(1,this._showAttackBtnKey):_.AllPersonFightView.ins.updateState(4,this._showAttackBtnKey))},t.prototype.changeShowAttakBtnKey=function(t){t!=this._showAttackBtnKey&&(this._showAttackBtnKey=t,this.updateBossBattleState())},t.prototype.updateAttackListHandler=function(){this.changeShowAttakBtnKey(0<this.vo.getAttackSelfCount())},t.prototype.sendStartAttackC2GS=function(){var t=new p.StartAttackC2CS;t.attack=!0,a.GSM.sendServer(t),console.log("发送战斗开始")},t.prototype.dropFly=function(t,e,i){g.RoleCenter.instans.addInventoryToC(i.inventory),e&&t&&0<t.length?(l.E.ins.once(r.EventName.PICK_ALL_FLYITEMS,this,this.dropOver,[i]),I.DropUtil.createDrop(t,new Laya.Point(e.worldX,e.worldY)),I.DropUtil.flyToRole(e)):this.dropOver(i)},t.prototype.dropOver=function(e){var i=this,n=e.inventory;b.FE.addInventoryToCFloats(n),Laya.timer.clearAll(this),Laya.timer.once(2e3,this,function(){var t=i.vo.ownerAcc==i.vo.selfAcc;w.AccountViewCtrl.ins.successFightEnd(n,Laya.Handler.create(i,i.returnAutoplayPort),t?S.TextConst.get(411):S.TextConst.get(203),i.vo,e),_.AllPersonFightView.ins.hideView()})},t.prototype.clear=function(){i.prototype.clear.call(this),this.bossGroup&&this.bossGroup.destroyGroup(),this.tPlayerList.length=0,l.E.ins.event(r.EventName.BOSS_UPDATE_PLAYERLIST,null);var t=a.GSM.ins;t.off(c.JoinInActivityGS2C.KEY,this,this.onJoinInActMsg),t.off(c.UserJoinInActivityGS2C.KEY,this,this.onOtherUserJoinMsg),t.off(c.UserExitActivityGS2C.KEY,this,this.onUserExitMsg),t.off(c.RobBossOwnerGS2C.KEY,this,this.onOwnerResultMsg),t.off(c.ActivityEndGS2C.KEY,this,this.onActivityEndMsg),t.off(c.ActivityRebirthGS2C.KEY,this,this.onReBornMsg),t.off(c.MonsterShieldChg.KEY,this,this.onShowHuDunMsg),t.off(c.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChange),t.off(m.ChangeAttackTargetGS2C.KEY,this,this.onAttackTargetChange),t.off(u.UserHPChageGS2C.KEY,this,this.onUserHpChange),t.off(p.UserAttackGS2C.KEY,this,this.onUserAttackGS2C),l.E.ins.off(r.EventName.BOSS_UPDATE_ATTACK_LIST,this,this.updateAttackListHandler),_.AllPersonFightView.ins.destroyView(),n.ClearResM.clearResFolder("fightview/",!0),n.ClearResM.clearChengHao()},t}(i.GamePlay);e.WorldBossGamePlay=T,(E=e.EBossBattleState||(e.EBossBattleState={}))[E.BATTLE_NULL=0]="BATTLE_NULL",E[E.BATTLE_OWNER=1]="BATTLE_OWNER",E[E.BATTLE_OWNER_ATTACK_OTHER=2]="BATTLE_OWNER_ATTACK_OTHER",E[E.BATTLE_ATTACK_OWNER=3]="BATTLE_ATTACK_OWNER",E[E.BATTLE_ATTACK_BOSS=4]="BATTLE_ATTACK_BOSS"}),define("src/g/boss/view/HpBarView",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.view=null,this.barList=[],this.barBgList=[],this.curreWidth=380,this._rect=new Laya.Rectangle,this._lastBarIndex=-1,this._lastBarHp=-1,this._barIndex=0,this._barHp=0,this._singleBarHp=0,this._subHp=0,this._lastTime=-1,this._time=2}return t.prototype.initBar=function(t){this.view=t,this.barList.push(t.progressBar,t.progressBar1,t.progressBar2,t.progressBar3,t.progressBar4,t.progressBar5,t.progressBar6,t.progressBar7,t.progressBar8,t.progressBar9),this.barBgList.push(t.bg,t.bg1,t.bg2,t.bg3,t.bg4,t.bg5,t.bg6,t.bg7,t.bg8,t.bg9)},t.prototype.updateHp=function(t,e,i){for(var n=0;n<this.barList.length;n++)this.barList[n].visible=!1;this.hideHpBg();var s=Math.ceil(e/i);this._singleBarHp=s;var o=Math.floor(t/s),a=null,r=null,l=" ";if(i<=(this._barIndex=o))(a=this.barList[this.barList.length-1]).visible=!0,a.scrollRect=null,this._barHp=0,1!=i&&(l="x"+i),this.view.fontClip_hpCount.value=l;else{o+1!=1&&(l="x"+(o+1)),this.view.fontClip_hpCount.value=l,(a=this.barList[o]).visible=!0;var h=o-1;-1<h&&((r=this.barList[h]).visible=!0,r.y=0,r.scrollRect=null);var c=Math.floor(t%s);this._rect.setTo(0,-1,c/s*this.curreWidth,17),a.y=-1,a.scrollRect=this._rect,this._barHp=c}if(-1==this._lastBarIndex&&-1==this._lastBarHp){this._lastBarIndex=this._barIndex,this._lastBarHp=this._barHp;var u=i*this._time;this._subHp=e/u}else{for(n=o;n<=this._lastBarIndex;n++)n<this.barBgList.length&&(this.barBgList[n].visible=!0,this.barBgList[n].width=this.curreWidth);this._lastTime=Date.now(),this.drawBar(),Laya.stage.frameLoop(1,this,this.updateBar,null,!0)}},t.prototype.updateBar=function(){this._lastBarHp=this._lastBarHp-(Date.now()-this._lastTime)/1e3*this._subHp,this._lastTime=Date.now(),this._lastBarIndex>this._barIndex?this._lastBarHp<0&&(this._lastBarIndex-=1,this._lastBarHp=this._singleBarHp):this._lastBarHp<this._barHp&&(this._lastBarHp=this._barHp,Laya.stage.clearTimer(this,this.updateBar),this.hideHpBg()),this.drawBar()},t.prototype.hideHpBg=function(){for(var t=0;t<this.barBgList.length;t++)this.barBgList[t].visible=!1},t.prototype.drawBar=function(){this._lastBarIndex<this.barBgList.length&&(this.barBgList[this._lastBarIndex].width=this._lastBarHp/this._singleBarHp*this.curreWidth)},t.prototype.destory=function(){this.barList&&(this.barList.length=0),this.barBgList&&(this.barBgList.length=0)},t}();e.HpBarView=i}),define("src/g/boss/view/AllPersonFightView",["require","exports","src/g/fight/osprite/play/PlayManager","../../../manager/LayerManager","../../../utils/ItemUtils","../../../core/E","../../../enum/EventName","../../net/messages/ActivityMessage","../../net/messages/ChangeSceneMsg","../../../manager/RoleCenter","../../net/messages/rank/sbkOtherData","../../net/messages/LuckyUserMsg","../../../manager/GameSocketManager","../../net/messages/chat/ChatGS2C","../../net/messages/chat/ChatC2GS","../../../config/GameConfig","src/g/boss/view/SCFoeHead","src/g/boss/view/HpBarView","src/init/TextConst","src/g/fight/osprite/SceneObjCtroller","../../../meta/CommonVo","src/g/clearRes/ClearResM"],function(t,e,n,r,l,s,o,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function a(){var t=i.call(this)||this;t.maxHp=0,t._actId=0,t._showAttackBtnKey=!1,t.isClose=!0,t.countTime=10,t.hunDunMaxvalue=0,t.huDunValue=0,t._maxHpBarNum=10,t._hpBarView=new _.HpBarView,t.hurtArr=[],t.endTime=0,t.btn_heti.on(Laya.Event.CLICK,t,t.hetiHandler),t.btn_chakan.on(Laya.Event.CLICK,t,t.chakanHandler),t.panle_hurlList.list_.renderHandler=new Laya.Handler(t,t.renderHandler_rankList),t.hudunBarWidth=t.hudunBar.width,t.tip_html.style.font="SimHei",t.tip_html.style.color="#e3cca9",t.tip_html.style.stroke=1,t.tip_html.style.strokeColor="#0d0500",t.tip_html.style.fontSize=24,t.tip_html.style.align="center",t.owercon=new m.SCFoeHead,t.owercon.setType(0),t.owercon.right=0,t.owercon.top=156,t.addChild(t.owercon),t.crtHolder=new m.SCFoeHead,t.crtHolder.setType(1),t.crtHolder.x=20,t.crtHolder.y=27,t.ownerView.addChild(t.crtHolder),t.imgAttack.visible=t.imgZhengduo.visible=!1,t.initList(t.attList,new Laya.Handler(t,t.renderAttacker)),t.initList(t.playerList,new Laya.Handler(t,t.renderPlayer));var e=g.GSM.ins;return e.on(d.LuckyUserStartGS2C.KEY,t,t.onLuckyUserStartGS2C),e.on(d.LuckyPTGenGS2C.KEY,t,t.onLuckyPTGenGS2C),s.E.ins.on(o.EventName.BOSS_UPDATE_ATTACK_LIST,t,t.updateAttackListHandler),s.E.ins.on(o.EventName.BOSS_UPDATE_PLAYERLIST,t,t.updPlayerListDisplay),s.E.ins.on(o.EventName.CHANGE_PK_TARGET,t,t.attackTargetChangedHander),t.setHp(0),t._hpBarView.initBar(t.hpBar),t.kuangBaoBox.visible=!1,t.leftButtonEF.visible=!1,t.rightButtonEF.visible=!1,t.btn_att_boss.visible=!1,t.btn_att_lboss.visible=!1,t.btn_att_owner.visible=!1,t.fightBackButton.visible=!1,t}return __extends(a,i),a.prototype.hetiHandler=function(){I.SceneObjCtroller.ins.getSelfGroup().startHeti()},a.prototype.initList=function(t,e){t.itemRender=m.SCFoeHead,t.vScrollBarSkin="",t.scrollBar.elasticDistance=100,t.renderHandler=e,t.array=[]},a.prototype.renderAttacker=function(t,e){t.update(),t.showAttackerEf()},a.prototype.renderPlayer=function(t,e){t.update2("right")},Object.defineProperty(a.prototype,"Actid",{get:function(){return this._actId},set:function(t){this.isClose||(this._actId=t)},enumerable:!0,configurable:!0}),Object.defineProperty(a,"ins",{get:function(){return a._ins||(a._ins=new a),a._ins},enumerable:!0,configurable:!0}),a.prototype.setBossHead=function(){if(!this.isClose){var t=l.ItemUtils.getBossId(this.vo.bossplayID);t&&(this.boss_icon.skin=l.ItemUtils.getBossIconByPort(t.port),this.bossNameTxt.text=t.name,this.owercon.updateBoss(t),this.bosslvl.text=l.ItemUtils.getLv(t.lv))}},a.prototype.setAttShow=function(){this.isClose||(this.dangerBg.visible=!0,this.dangerBg.alpha=1,Laya.Tween.to(this.dangerBg,{alpha:.2},300,null,new Laya.Handler(this,function(){this.dangerBg.alpha=1,Laya.Tween.to(this.dangerBg,{alpha:.2},300,null,new Laya.Handler(this,function(){this.dangerBg.visible=!1}))})))},a.prototype.setBossHeadByPortId=function(t){if(!this.isClose){var e=l.ItemUtils.getBossVoByPortId(t);e&&(this.boss_icon.skin=l.ItemUtils.getBossIconByPort(e.port),this.bossNameTxt.text=e.name,this.owercon.updateBoss(e))}},a.prototype.showWinTip=function(t,e){var i=this;this.isClose||(this.showTipTween&&(Laya.Tween.clear(this.showTipTween),this.showTipTween=null),this.hideWinTipSetTimeouter&&(clearTimeout(this.hideWinTipSetTimeouter),this.hideWinTipSetTimeouter=null),this.winTxt.text=t,this.failTxt.text=e,this.showTipTween=Laya.Tween.to(this.winTip,{alpha:1},.4),this.hideWinTipSetTimeouter=setTimeout(function(){i.hideWinTip()},2400))},a.prototype.onLuckyUserStartGS2C=function(t){var e=b.CommonVo.getVoByKey("automaticroll").value,i=Number(e);u.RoleCenter.instans.vo.VIP,this.view_lucky.setClickHander(Laya.Handler.create(this,this.onSendLuckyGen,[this.Actid]))},a.prototype.onSendLuckyGen=function(){var t=new d.LuckyPTGenC2GS;n.PlayManager.type==c.EPlayType.PLAYTYPE_REBORNBOSS&&(t.acttype=h.EACT_TYPE.rebirthBoss),n.PlayManager.type==c.EPlayType.PLAYTYPE_MIJINGBOSS&&(t.acttype=h.EACT_TYPE.mijingBoss),t.actid=this.Actid,g.GSM.sendServer(t)},a.prototype.onLuckyPTGenGS2C=function(t){if(t.opresult){t.nickname==u.RoleCenter.instans.vo.nickname&&this.view_lucky.showLuckyNum(t.luckypt);var e=new v.ChatGS2C;e.type=f.enumChatType.system,e.msg=C.TextConst.get(806,t.nickname,t.luckypt),s.E.ins.event(o.EventName.SEND_UNREAL_CHAT,[e])}},a.prototype.hideWinTip=function(){this.isClose||(this.hideTipTween&&(Laya.Tween.clear(this.hideTipTween),this.hideTipTween=null),this.hideWinTipSetTimeouter&&(clearTimeout(this.hideWinTipSetTimeouter),this.hideWinTipSetTimeouter=null),this.hideTipTween=Laya.Tween.to(this.winTip,{alpha:0},.4))},a.prototype.showCountDownPan=function(t){this.isClose||(this.attList.array=[],this.btns_list.visible=!1,this.fuhuotip.visible=!0,this.updOwerconDisplay(!1),this.gold_txt.text=y.GameConfig.BossSetting[1].revivecdCost,this.tip_html.innerHTML=C.TextConst.get(290,t),Laya.timer.clear(this,this.countHandler),Laya.timer.loop(1e3,this,this.countHandler),this.countTime=0,this.countTime=y.GameConfig.BossSetting[1].revivecd,this.countDownText.text=C.TextConst.get(291,this.countTime))},a.prototype.countHandler=function(){this.countTime--,this.countTime<=0&&Laya.timer.clear(this,this.countHandler),this.countDownText.text=C.TextConst.get(291,this.countTime)},a.prototype.hideCountDownPan=function(){this.isClose||(this.updOwerconDisplay(!0),this.fuhuotip.visible=!1,this.clearCounDownInterval(),this.playType!=h.EACT_TYPE.rebirthBoss&&(this.btns_list.visible=!0,this.ownerView.visible=!0))},a.prototype.clearCounDownInterval=function(){Laya.timer.clear(this,this.countHandler)},a.prototype.setOwnerInfo=function(t,e,i,n,s){this.isClose||this.crtHolder.updateWinner(t,i,n,e)},a.prototype.updateCombat=function(t){},a.prototype.hideOwnerInfo=function(){this.isClose||(this.ownerView.visible=!1)},a.prototype.showOwnerInfo=function(){this.isClose||(this.ownerView.visible=!0,n.PlayManager.type==c.EPlayType.PLAYTYPE_REBORNBOSS&&(this.ownerView.visible=!1))},a.prototype.showView=function(t,e,i,n){void 0===n&&(n=0);var s=l.ItemUtils.getBossVoByPortId(n);this._maxHpBarNum=s.hpcount,this.isClose=!1,this.playType=t,this.playID=e;var o=l.ItemUtils.getMonsterVOById(i);e?a.ins.setBossHead():a.ins.setBossHeadByPortId(n),a.ins.setMaxHp(o.HP),Laya.Tween.clearAll(this),this.hudunView.visible=!1,this.ownerView.visible=!0,this.endCountDownText.visible=!1,this.tip_tip.alpha=1,Laya.Tween.to(this.tip_tip,{alpha:0},4e3),t==h.EACT_TYPE.rebirthBoss?(this.ownerView.visible=!1,this.updOwerconDisplay(!1),this.btn_chakan.visible=!1,this.btns_list.visible=!1,this.panle_hurlList.visible=!0,this.owercon.visible=!1,this.attList.visible=!1,this.playerList.visible=!1,this.leftButtonEF.visible=this.rightButtonEF.visible=!1):(this.ownerView.visible=!0,this.updOwerconDisplay(!0),this.btn_chakan.visible=!0,this.btns_list.visible=!0,this.panle_hurlList.visible=!1),this.width=Laya.stage.width,this.height=Laya.stage.height,r.LayerManager.addInUILayer(this),Laya.timer.once(200,this,this.reload),w.ClearResM.resetViewImg(this)},a.prototype.reload=function(){w.ClearResM.resetViewImg(this)},a.prototype.hideView=function(){this.removeSelf(),this.isClose=!0},a.prototype.destroyView=function(){if(Laya.timer.clear(this,this.reload),!this.destroyed){var t=g.GSM.ins;t.off(d.LuckyPTGenGS2C.KEY,this,this.onLuckyPTGenGS2C),t.off(d.LuckyUserStartGS2C.KEY,this,this.onLuckyUserStartGS2C),s.E.ins.off(o.EventName.BOSS_UPDATE_ATTACK_LIST,this,this.updateAttackListHandler),s.E.ins.off(o.EventName.BOSS_UPDATE_PLAYERLIST,this,this.updPlayerListDisplay),s.E.ins.off(o.EventName.CHANGE_PK_TARGET,this,this.attackTargetChangedHander),this.destroy(!0),this._hpBarView&&(this._hpBarView.destory(),this._hpBarView=null),a._ins=null}a._ins=null},a.prototype.updAttackerListDisplay=function(){this.playType!=h.EACT_TYPE.rebirthBoss&&(this.attList.array=this.vo.attplayers,this.caculateListH(this.attList,4),this.imgAttack.visible=this.vo.attplayers&&0!=this.vo.attplayers.length)},a.prototype.caculateListH=function(t,e){if(null==t.array||0==t.array.length)t.height=0;else{var i=Math.min(e,t.array.length),n=108*i+(i-1)*t.spaceY;t.height=n}},a.prototype.renderHandler_rankList=function(t,e){var i=t.dataSource,n=t.getChildByName("lab_idx"),s=t.getChildByName("lab_name"),o=t.getChildByName("lab_hurt"),a=t.getChildByName("di_bg");o.text=i.hurt+"",s.text=i.userData.nickname,n.text=e+1+"",a.skin="res/fightview/di_"+e%2+".png"},a.prototype.hurtRankBase=function(t){if(!this.isClose){this.hurtArr=[];for(var e=0;e<t.damageList.length;e++){var i=new S;i.account=t.otherUserList[e].username,i.hurt=t.damageList[e],i.userData=t.otherUserList[e],this.hurtArr.push(i)}var n=new S;n.account=u.RoleCenter.instans.vo.username,n.hurt=0,n.userData=new p.sbkOtherData,n.userData.nickname=u.RoleCenter.instans.vo.nickname,this.hurtArr.push(n),this.showHurtRank()}},a.prototype.addUser=function(t,e,i){void 0===i&&(i=0);for(var n=0;n<this.hurtArr.length;n++)if(this.hurtArr[n].account==e)return;var s=new S;s.account=e,s.hurt=i,s.userData=t,this.hurtArr.push(s)},a.prototype.addUserHurt=function(t,e){for(var i=0;i<this.hurtArr.length;i++)if(this.hurtArr[i].account==t)return void(this.hurtArr[i].hurt+=e)},a.prototype.hurtRankOtherJoin=function(t){if(!this.isClose){for(var e=0;e<t.newuser.length;e++)this.addUser(t.newuser[e],t.newuser[e].username);this.showHurtRank()}},a.prototype.changeRank=function(t){this.isClose||(this.addUserHurt(t.attackAcc,t.hpChange),this.showHurtRank())},a.prototype.showHurtRank=function(){this.hurtArr.sort(this.sortHurt);for(var t=[],e=0;e<5;e++)this.hurtArr[e]&&t.push(this.hurtArr[e]);this.panle_hurlList.list_.dataSource=this.hurtArr},a.prototype.sortHurt=function(t,e){return e.hurt-t.hurt},a.prototype.onZSBOSSKilled=function(){this.isClose||(u.RoleCenter.instans.vo.bossData.currentOpenRebirthBossIdx=-1,s.E.ins.event(o.EventName.CHANGE_HUGEDOMINATE_MSG),this.hurtArr.length=0)},a.prototype.setMaxHp=function(t){this.isClose||(this.maxHp=t)},a.prototype.setHp=function(t){if(!this.isClose&&this._hpBarView)if(this.playType==h.EACT_TYPE.rebirthBoss){if(1e4<t)return;this._hpBarView.updateHp(100-t/100,100,1),this.progress_txt.text=(100-t/100).toFixed(2)+"%"}else this._hpBarView.updateHp(t,this.maxHp,this._maxHpBarNum),this.progress_txt.text=t+"/"+this.maxHp},a.prototype.setOwerHp=function(t,e){this.isClose||(this.ownerView.visible=!(t<=0),this.crtHolder.updBlood(t,e))},a.prototype.chakanHandler=function(){s.E.ins.event(o.EventName.BOSSREWARDOPEN,[this.playID,this.crtHolder.getName()])},a.prototype.showHuDunView=function(t,e){if(!this.isClose){var i=l.ItemUtils.getBossSettingVoById(1),n=i.hudunHP,s=i.hudunMinus;switch(e){case c.EPlayType.PLAYTYPE_QUANMINBOSS:s=i.quanminHudunMinus;break;case c.EPlayType.PLAYTYPE_QUANMINBOSS:case c.EPlayType.PLAYTYPE_QUANMINBOSS:case c.EPlayType.PLAYTYPE_QUANMINBOSS:s=i.VIPhudunMinus;break;case c.EPlayType.PLAYTYPE_SHENYUBOSS:s=i.shenyuHudunMinus;break;case c.EPlayType.PLAYTYPE_MIJINGBOSS:s=i.quanminHudunMinus}this.showShield(t,n,s)}},a.prototype.showShield=function(t,e,i){this.isClose||(this.hudunView.visible=!0,this.hunDunMaxvalue=e,this.hdValue=t,this.clearHuDunBarTween(),this.huDunBarTween=Laya.Tween.to(this,{hdValue:0},t/i*1e3))},a.prototype.hideHuDunView=function(){this.isClose||(this.clearHuDunBarTween(),this.hudunView.visible=!1)},a.prototype.clearHuDunBarTween=function(){this.huDunBarTween&&(Laya.Tween.clear(this.huDunBarTween),this.huDunBarTween=null)},Object.defineProperty(a.prototype,"hdValue",{get:function(){return this.huDunValue},set:function(t){this.huDunValue=t,this.hudunBar.width=t/this.hunDunMaxvalue*this.hudunBarWidth},enumerable:!0,configurable:!0}),a.prototype.setFightTargetInfo=function(t){},a.prototype.setFightTargetVisible=function(t){},a.prototype.setFightTargetBarValue=function(t){},a.prototype.showEndCoundDown=function(t){this.isClose||(this.endCountDownText.visible=!0,this.endTime=t,this.startEndTimeInterval())},a.prototype.setEndTimeText=function(t){this.endCountDownText.style.font="SimHei",this.endCountDownText.style.fontSize=20,this.endCountDownText.style.bold=!0,this.endCountDownText.innerHTML=C.TextConst.get(292,t)},a.prototype.startEndTimeInterval=function(){var i=this;this.clearEndTimeInterval(),this.endTimeInterval=setInterval(function(){var t=~~(i.endTime/60),e=i.endTime%60;i.setEndTimeText(C.TextConst.get(45,t,e)),i.endTime--},1e3)},a.prototype.clearEndTimeInterval=function(){this.endTimeInterval&&(clearInterval(this.endTimeInterval),this.endTimeInterval=null)},a.prototype.destroy=function(t){this.clearCounDownInterval(),this.clearEndTimeInterval(),this.clearHuDunBarTween(),i.prototype.destroy.call(this,t)},a.prototype.updOwerconDisplay=function(t){},a.prototype.updateState=function(t,e){if(!this.isClose)switch(this.lbOwner.visible=!1,this.btn_att_boss.visible=this.btn_att_owner.visible=this.btn_att_lboss.visible=this.fightBackButton.visible=!1,this.leftButtonEF.visible=this.rightButtonEF.visible=!1,this.leftImgLabel.skin=this.rightImgLabel.skin="",t){case 1:e?(this.leftImgLabel.skin=this.getUrlById(1),this.leftButtonEF.visible=!0,this.fightBackButton.visible=!0,this.rightImgLabel.skin=this.getUrlById(2)):this.lbOwner.visible=!0;break;case 2:this.btn_att_lboss.visible=!0,this.leftImgLabel.skin=this.getUrlById(3),this.rightImgLabel.skin=this.getUrlById(4),this.rightButtonEF.visible=!0;break;case 3:this.rightImgLabel.skin=this.getUrlById(5),this.rightButtonEF.visible=!0,this.btn_att_boss.visible=!0,this.leftImgLabel.skin=this.getUrlById(3);break;case 4:this.leftImgLabel.skin=this.getUrlById(1),this.leftButtonEF.visible=!0,this.btn_att_owner.visible=!0,this.rightImgLabel.skin=this.getUrlById(6)}},a.prototype.getUrlById=function(t){var e;switch(t){case 1:e="res/fightview/fightBoss.png";break;case 2:e="res/fightview/zhandou_fanji.png";break;case 3:e="res/fightview/zhandou_anniu_gongjiBOSS.png";break;case 4:e="res/fightview/zhandou_fanjizhong.png";break;case 5:e="res/fightview/fightowenr.png";break;case 6:e="res/fightview/zhandou_anniu_gongjiguishuzhe.png"}return e},a.prototype.changeShowAttakBtnKey=function(t){t!=this._showAttackBtnKey&&(this._showAttackBtnKey=t)},a.prototype.updateAttackListHandler=function(){this.isClose||this.playType!=h.EACT_TYPE.rebirthBoss&&(this.changeShowAttakBtnKey(0<this.vo.getAttackSelfCount()),this.updAttackerListDisplay(),this._showAttackBtnKey&&this.setAttShow())},a.prototype.updPlayerListDisplay=function(t){this.isClose||this.playType!=h.EACT_TYPE.rebirthBoss&&(this.playerList.array=t,this.caculateListH(this.playerList,4),this.imgZhengduo.visible=t&&0<t.length)},a.prototype.clearAttackSign=function(){this.crtHolder.reset(),this.owercon.reset(),this.clearListAttackSign(this.attList),this.clearListAttackSign(this.playerList)},a.prototype.attackTargetChangedHander=function(t){this.playType!=h.EACT_TYPE.rebirthBoss&&(this.clearAttackSign(),t==this.owercon.getName()?this.owercon.updStatus(m.SCFoeHead.BE_ATTACK):t==this.crtHolder.getName()?this.crtHolder.updStatus(m.SCFoeHead.BE_ATTACK):(this.showAttackSignInList(this.attList,t),this.showAttackSignInList(this.playerList,t)))},a.prototype.showAttackSignInList=function(t,e){for(var i,n=0;n<t.cells.length;n++)(i=t.cells[n]).getName()==e&&i.updStatus(m.SCFoeHead.BE_ATTACK)},a.prototype.clearListAttackSign=function(t){for(var e=0;e<t.cells.length;e++)t.cells[e].reset()},a}(ui.boss.BossFigthViewUI);e.AllPersonFightView=i;var S=function(){};e.userHurtObj=S}),define("src/g/fight/osprite/play/allpeopleboss/vo/PeopleBossVo",["require","exports","src/g/fight/osprite/play/baseplay/vo/WolrdBossVo"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(i.WolrdBossVo);e.PeopleBossVo=n}),define("src/g/fight/osprite/play/allpeopleboss/GamePlayPeopleBoss",["require","exports","../../../../../manager/RoleCenter","../../../../net/messages/ActivityMessage","src/g/fight/osprite/NetCtroller","../../../../../core/E","../../../../../enum/EventName","src/g/account/ctrl/AccountViewCtrl","src/g/boss/view/AllPersonFightView","../../../../../manager/AM","../../../../../manager/GameSocketManager","../../../../../utils/system/FloatEffect","../../../../../utils/system/ServerTime","src/g/fight/osprite/play/baseplay/WorldBossGamePlay","src/g/fight/osprite/play/allpeopleboss/vo/PeopleBossVo","../../../../net/messages/ChangeSceneMsg","src/g/fight/osprite/obj/Pet","../../../../../plugin/view/ToolTip","src/g/fight/osprite/SceneObjManager","src/g/fight/osprite/play/baseplay/vo/WolrdBossVo","../../../../../manager/LayerManager","src/init/Switches","src/init/TextConst","src/g/boss/vo/BossInfos","../../../../../utils/ItemUtils","src/g/fight/manager/ItemManager","../../../../../utils/DropUtil"],function(t,e,l,i,n,s,o,a,r,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E,T){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var A=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.initViewVo=function(){this.vo=new g.PeopleBossVo,this.vo.init(this.scene.getPortBossVo(),this.mapVo,this._portData);var t=r.AllPersonFightView.ins;t.roleName=l.RoleCenter.instans.vo.nickname,t.vo=this.vo,t.showView(i.EACT_TYPE.quanminBoss,this.vo.bossplayID,this._portData.boss[0],this._portData.id),this.initUIEvent()},t.prototype.initUIEvent=function(){var t=r.AllPersonFightView.ins;t.btn_cost.on(Laya.Event.CLICK,this,this.sendReBorn),t.btn_att_boss.on(Laya.Event.CLICK,this,this.attBossHandler),t.btn_att_owner.on(Laya.Event.CLICK,this,this.startGetOwnerBattleHandler),t.btn_att_lboss.on(Laya.Event.CLICK,this,this.attBossHandlerOwner),t.fightBackButton.on(Laya.Event.CLICK,this,this.fightBackHander),this._autoBeatBackKey=!0},t.prototype.attBossHandlerOwner=function(){this._autoBeatBackKey=!1,this.ownerAttackTarget("")},t.prototype.init=function(t){void 0===t&&(t=null),e.prototype.init.call(this,t),this._portData=this.scene.matCopy,this.initViewVo(),this.initBossGroup(),this.initSelfGroup(),s.E.ins.on(o.EventName.EXIT_BOSS_PLAYTYPE,this,this.alertTip),this.startBattle()},t.prototype.onBossOwnerChange=function(t){console.log("Boss归属权发生变化了："+t.newowner),e.prototype.onBossOwnerChange.call(this,t),t.newowner==l.RoleCenter.instans.vo.username&&r.AllPersonFightView.ins.setBossHead()},t.prototype.startBattle=function(){Laya.timer.loop(10,this,this.checkWayHandler)},t.prototype.checkWayHandler=function(){this._mainRole.ways.length<=1&&(Laya.timer.clear(this,this.checkWayHandler),n.NetCtroller.JoinInQMBossCopy(this.vo.bossplayID,i.EACT_TYPE.quanminBoss),console.log("发送全民bossid-------",this.vo.bossplayID))},t.prototype.clear=function(){e.prototype.clear.call(this),this.bossGroup&&(this.bossGroup.destroyGroup(),this.bossGroup=null),this.pickAllDropItem(),s.E.ins.off(o.EventName.EXIT_BOSS_PLAYTYPE,this,this.alertTip),s.E.ins.event(o.EventName.QUANMIN_EXIT),s.E.ins.event(o.EventName.QUANMIN_BOSS_BUBBLE_HIDE)},t.prototype.releaseSkillHandler=function(t){this._fightGroup.getFGTarget()&&this.releaseSkill(t,this._fightGroup.getFGTarget().groupID)},t.prototype.exitHandler=function(){console.error("GamePlayPeopleBoss::exitHandler");var t=p.ServerTime.serverTime;l.RoleCenter.instans.self.bossData.qmBossReEnterCd=t,n.NetCtroller.ExitQMBossCopy(this.vo.bossplayID,i.EACT_TYPE.quanminBoss),this.returnAutoplayPort(),s.E.ins.event(o.EventName.QUANMIN_BOSS_BUBBLE_HIDE);var e=S.ItemUtils.getBossSettingVoById(1).reentercd;w.BossInfos.qmcdTime=e+t},t.prototype.alertTip=function(){h.AM.exitPlay(this.type,new Laya.Handler(this,function(){this.exitHandler()}))},t.prototype.startGetOwnerBattleHandler=function(){this._fightGroup.isDeath()?u.FE.upItems(b.TextConst.get(407),y.BubbleEnum.center):this.vo.selfAcc!=this.vo.ownerAcc?(u.FE.upItems(b.TextConst.get(409),y.BubbleEnum.center),this.sendGetBossOwner()):u.FE.upItems(b.TextConst.get(408),y.BubbleEnum.center)},t.prototype.onJoinInActMsg=function(t){this.updatePanelState(t),t.opresult?(C.LayerManager.closeAllPOPWindow(),this.vo.ownerAcc=t.bossOwner,t.acttype==i.EACT_TYPE.quanminBoss&&(this.bossGroup.setFGTarget(this._playerDic[this.vo.ownerAcc]),l.RoleCenter.instans.vo.QUANMINGCOUNT--),t.acttype==i.EACT_TYPE.rebirthBoss&&(r.AllPersonFightView.ins.Actid=t.actid,r.AllPersonFightView.ins.hurtRankBase(t),this.bossGroup.setFGTarget(this._fightGroup)),r.AllPersonFightView.ins.setMaxHp(t.bossMaxHP),r.AllPersonFightView.ins.setHp(t.bossHP),this.initPlayers(t),t.shieldHP&&r.AllPersonFightView.ins.showHuDunView(t.shieldHP,v.EPlayType.PLAYTYPE_QUANMINBOSS),this.sendStartAttackC2GS()):(console.log(t,"----------该Boss已被击杀------------"),u.FE.upItems(b.TextConst.get(410),y.BubbleEnum.center),this.returnAutoplayPort(),Laya.timer.clearAll(this))},t.prototype.initPlayers=function(t){for(var e,i=t.otherUserList,n=i.length,s=(t.damageList,0);s<n;s++){var o=i[s],a=o.username;if(this.vo.addPlayers(o),t.bossOwner==a)e=this.addAtherPlayerSbkOtherHeroData(o);else{var r=this.addAtherPlayerSbkOtherHeroData(o);t.userDeathStateList[s]&&r.setDeath()}}e&&this.bossGroup.setOnceTarget(e),this.setBossOwnWithAcc(t.bossOwner),this.vo.addPlayers(l.RoleCenter.instans.vo)},t.prototype.onOtherUserJoinMsg=function(t){if(t.opresult){for(var e=t.newuser,i=e.length,n=0;n<i;n++){var s=e[n];this.vo.addPlayers(s),this.addAtherPlayerSbkOtherHeroData(s)}r.AllPersonFightView.ins.showOwnerInfo(),r.AllPersonFightView.ins.hurtRankOtherJoin(t)}},t.prototype.onOwnerResultMsg=function(t){console.log("抢夺消息"),t.opresult},t.prototype.updateCombat=function(){r.AllPersonFightView.ins.updateCombat(l.RoleCenter.instans.vo.combat)},t.prototype.updateOwerHp=function(){if(this.vo){var t=this._playerDic[this.vo.ownerAcc],e=0,i=0;if(t){for(var n=t.getFUList(),s=0;s<n.length;s++)n[s]instanceof f.Pet||(e+=n[s].getTotalHp(),i+=n[s].getHp());r.AllPersonFightView.ins.setOwerHp(i,e)}}},t.prototype.onComboHit=function(t){e.prototype.onComboHit.call(this,t),t.invincibleTime<=0&&(t.beAttackAcc||r.AllPersonFightView.ins.setHp(t.hpAfterAttack[0]))},t.prototype.changeSelfHP=function(t){this._fightGroup&&(e.prototype.changeSelfHP.call(this,t),this._fightGroup.isDeath()&&r.AllPersonFightView.ins.showCountDownPan("BOSS"))},t.prototype.changeBossHP=function(t){e.prototype.changeBossHP.call(this,t),0<t.hpPercent?(r.AllPersonFightView.ins.changeRank(t),r.AllPersonFightView.ins.setHp(t.hpPercent)):r.AllPersonFightView.ins.setHp(t.hpAfterAttack)},t.prototype.onActivityEndMsg=function(t){var e=t.inventory;T.DropUtil.isfly=!0,this.dropFly(E.ItemManager.getDropArray(e),this._fightGroup.getFUList()[0],t),s.E.ins.event(o.EventName.QUANMIN_KILL_BOSS),401<=t.actid&&t.actid<=404&&r.AllPersonFightView.ins.onZSBOSSKilled(),this.redEqAddTask(e)},t.prototype.checkHandler=function(e){var i=this;m.SceneObjManager.instans.totalDrops.length<=0&&(Laya.timer.clearAll(this),Laya.timer.once(3e3,this,function(){var t=i.vo.ownerAcc==i.vo.selfAcc;a.AccountViewCtrl.ins.successFightEnd(e.inventory,Laya.Handler.create(i,i.returnAutoplayPort),t?b.TextConst.get(411):b.TextConst.get(203),i.vo,e),r.AllPersonFightView.ins.hideView()}))},t.prototype.sendReBorn=function(){if(l.RoleCenter.instans.GOLD<this.bossSettingVo.revivecdCost)I.Switches.ins.event(155);else{var t=new i.ActivityRebirthC2GS;t.actid=this.vo.bossplayID,t.acttype=_.WolrdBossVo.PORT_TYPE,c.GSM.sendServer(t)}},t.prototype.sendGetBossOwner=function(){this.sendRobBossOwnerC2GS(!0)},t.prototype.attBossHandler=function(){this.sendRobBossOwnerC2GS(!1)},t.prototype.sendRobBossOwnerC2GS=function(t){var e=new i.RobBossOwnerC2GS;e.actid=this.vo.bossplayID,e.acttype=_.WolrdBossVo.PORT_TYPE,e.rob=t,c.GSM.sendServer(e)},t.prototype.onUserExitMsg=function(t){e.prototype.onUserExitMsg.call(this,t),this.vo.removeAttPlayer(t.username)},t}(d.WorldBossGamePlay);e.GamePlayPeopleBoss=A}),define("src/g/fight/osprite/play/baseplay/GamePlayPVE",["require","exports","src/g/fight/osprite/play/GamePlay","src/g/fight/osprite/obj/FightGroup","src/g/fight/osprite/SceneObjCtroller","../../../../../enum/EventName","../../../../../core/E","../../../../../manager/StateManger"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(i){function t(t){var e=i.call(this,t)||this;return a.E.ins.on(o.EventName.EXIT_BOSS_PLAYTYPE,e,e.exitHandler),r.StateManger.fightsvrmode=!0,e.setJoinSkill(),e}return __extends(t,i),t.prototype.init=function(t){i.prototype.init.call(this,t),this._portData=this.scene.port,this.initBossGroup(),this.initSelftGroup()},t.prototype.initBossGroup=function(){this.bossGroup=new n.FightGroup(null);var t=this._portData.boss;this.bossFightUnit=this.createMonster(this.bossGroup,t,-1),this.bossGroup.resetFightGroup(this.mapVo.bossXY[0]),this.bossGroup.addToFightLayer(),this.bossFightUnit.setFocusEff()},t.prototype.initSelftGroup=function(){var t=s.SceneObjCtroller.ins.getSelfGroup();null==t&&(t=s.SceneObjCtroller.ins.getSelfGroup()),this.isDestroySelfKey&&t.resetFightGroup(this.mapVo.startPoint[0]),t.addToFightLayer(),t.setOnceTarget(this.bossGroup),this.setFightGroup(t)},t.prototype.exitHandler=function(){this.returnAutoplayPort()},t.prototype.clear=function(){this.bossFightUnit&&(this.bossFightUnit.offAll(),this.bossFightUnit=null),this.bossGroup&&(this.bossGroup.destroyGroup(),this.bossGroup=null),a.E.ins.off(o.EventName.EXIT_BOSS_PLAYTYPE,this,this.exitHandler),i.prototype.clear.call(this)},t.prototype.onComboHit=function(t){i.prototype.onComboHit.call(this,t),t.invincibleTime<=0&&(t.beAttackAcc||(this.bossFightUnit.svrSetHP(t.hpAfterAttack[0]),this.bossGroup&&this.bossGroup.isDeath()&&this.bossGroup.delayDeathHide()))},t}(i.GamePlay);e.GamePlayPVE=l}),define("src/g/fight/osprite/play/skyPort/vo/PataVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){};e.PataVo=i}),define("src/g/account/view/PagodaFightWin",["require","exports","src/init/Switches","../../../utils/ItemCellUtils","../../../manager/RoleCenter","../../../config/GameConfig","src/g/account/ctrl/GetRewwardCtrl","src/init/TextConst"],function(t,e,i,n,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t._nextLayer=0,t._state=0,t.popupEffect=null,t.list_item.renderHandler=new Laya.Handler(t,t.onRenderListHandler),t.btn_get.on(Laya.Event.CLICK,t,t.onGetHandler),t.btn_tonext.on(Laya.Event.CLICK,t,t.onToNextHandler),t.btn_goto.on(Laya.Event.CLICK,t,t.gotoHandler),t}return __extends(t,e),t.prototype.gotoHandler=function(){this.onGetHandler(),Laya.timer.once(200,this,function(){i.Switches.ins.event(100)})},t.prototype.showView=function(t,e,i){this.popup(),this.list_item.array=t,this._stopHandler=e,this._nextHandler=i;var n=!(this._cooldown=5);if(h.GameConfig.pagodaLayerJson[l.RoleCenter.instans.vo.portPagoda.secPortId]&&(n=!0),this._nextLayer=(l.RoleCenter.instans.vo.portPagoda.secPortId-25e3)%10>>0,0==this._nextLayer&&(this._nextLayer=10),Laya.timer.loop(1e3,this,this.cooldownHandler),1!=this._nextLayer&&n)this.btn_get.label=u.TextConst.get(203),this.btn_get.x=118,this.btn_tonext.visible=!0,this.btn_tonext.label=u.TextConst.get(245,this._nextLayer,5),this._state=2;else{this.btn_get.x=223,this.btn_tonext.visible=!1,this.btn_get.label=u.TextConst.get(243,5),this._state=1;var s=h.GameConfig.pagodaJson[l.RoleCenter.instans.vo.portPagoda.mainPortId-1];if(s){for(var o=s.specialReward.length,a=0,r=[];a<o;)r.push(s.specialReward[a][0]),r.push(s.specialReward[a][1]),a++;c.GetRewwardCtrl.showReward(r)}}},t.prototype.cooldownHandler=function(){this._cooldown--,this._cooldown<1?1==this._state?this.onGetHandler():this.onToNextHandler():1==this._state?this.btn_get.label=u.TextConst.get(243,this._cooldown):2==this._state&&(this.btn_tonext.label=u.TextConst.get(245,this._nextLayer,this._cooldown))},t.prototype.onRenderListHandler=function(t,e){n.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onGetHandler=function(){this._stopHandler&&this._stopHandler.run(),this.onCloseHandler()},t.prototype.onToNextHandler=function(){this._nextHandler&&this._nextHandler.run(),this.onCloseHandler()},t.prototype.onCloseHandler=function(){this._nextHandler=null,this._stopHandler=null,Laya.timer.clear(this,this.cooldownHandler),this.close()},t}(ui.account.PagodaFightWinUI);e.PagodaFightWin=s}),define("src/g/account/ctrl/PagodaAccountCtrl",["require","exports","src/g/account/view/PagodaFightWin","../../../utils/SoundUtils","src/g/account/view/FailView","../../net/messages/TeamMsg"],function(t,e,a,r,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.showWin=function(t,e,i){this.winView||(this.winView=new a.PagodaFightWin);var n,s=[];for(n=0;n<t.currencyList.length;n++){var o=t.currencyList[n];s.push([o.key,o.val])}for(n=0;n<t.itemList.length;n+=2)s.push([t.itemList[n],t.itemList[n+1]]);for(n=0;n<t.equipList.length;n++)s.push([t.equipList[n].equtemplet,1]);for(n=0;n<t.zhanwenList.length;n++)s.push([t.zhanwenList[n].cfgId,1]);this.winView.showView(s,e,i),r.SoundUtils.getInstance().playSoundById(107)},t.showFail=function(t){var e=this.failView;e||(this.failView=e=new i.FailView),e.showHelp(n.enumTeamType.NULL),e.setState(i.FailView.NORMAL),e.showView(t,5),r.SoundUtils.getInstance().playSoundById(108)},t}();e.PagodaAccountCtrl=s}),define("src/g/boss/view/PagodaBossHpBar",["require","exports","../../../manager/LayerManager","../../../utils/ItemUtils","../../../config/GameConfig","../../../utils/ItemCellUtils","../../../utils/CountDown","src/init/TextConst"],function(t,e,o,a,h,c,i,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.monsterUid=-1,t._hp=0,t._maxHp=0,t.kuangBaoCd=new i.CountDown,t.kuangBaoBox.visible=!1,t}return __extends(t,e),t.prototype.showView=function(t,e,i){this.monsterUid=i;var n=(e-25e3)/10+1>>0,s=(e-25e3)%10>>0;0==s&&(n--,s=10),this.img_head.skin=a.ItemUtils.getBossIccon(t.id),this.txt_name.changeText(r.TextConst.get(334,n,s,t.name,a.ItemUtils.getLVString(t.lv))),this._hp=t.HP,this.setMaxHp(t.HP),this.updateCurrLayerReward(e),this.updateCurrRoundReward(n),o.LayerManager.addInUILayer(this),console.log("进入新的层级"),this.kuangBaoCd.isRun()&&(this.kuangBaoCd.stop(),this.kuangBaoBox.visible=!1)},t.prototype.startKuangBaoCountDown=function(t){this.kuangBaoBox.visible=!0,this.kuangBaoCd.start(t,this.updKBCountDown,this)},t.prototype.updKBCountDown=function(t){0!=t?this.kuangBaoBox.imgSecond.value=t.toString():this.kuangBaoBox.visible=!1},t.prototype.updateHp=function(t){this._hp=t,this.setHpProgress()},t.prototype.setMaxHp=function(t){this._maxHp=t,this.setHpProgress()},t.prototype.setHpProgress=function(){this.lab_progress.changeText(this._hp+"/"+this._maxHp),this.img_progress.scaleX=Math.max(0,Math.min(1,this._hp/this._maxHp))},t.prototype.hideView=function(){this.kuangBaoCd.stop(),this.kuangBaoBox.visible=!1,this.removeSelf()},t.prototype.updateCurrLayerReward=function(t){for(var e,i,n,s=h.GameConfig.pagodaLayerJson[t],o=s?s.bonus.length:0,a=0,r=64*(3-o)/2+118;a<3;)(e=this["item"+a])&&(a<o?(i=s.bonus[a][0],n=Number(s.bonus[a][1]),c.ItemCellUtils.fillCellForItemNameView(e,i,n),e.visible=!0,e.x=r,r+=64):e.visible=!1),a++},t.prototype.updateCurrRoundReward=function(t){for(var e,i,n,s,o=h.GameConfig.pagodaJson[t],a=o?o.specialReward.length:0,r=0,l=64*(3-a)/2+320;r<3;)e=this["item1"+r],s=this["img_flg"+r],e&&(r<a?(i=o.specialReward[r][0],n=Number(o.specialReward[r][1]),c.ItemCellUtils.fillCellForItemNameView(e,i,n),e.visible=!0,e.x=l,s&&(s.visible=!0,s.x=l+4),l+=64):(e.visible=!1,s&&(s.visible=!1))),r++},t}(ui.boss.PagodaBossHpBarUI);e.PagodaBossHpBar=n}),define("src/g/fight/osprite/play/skyPort/GamePlayPagoda",["require","exports","../../../../net/messages/CTGFightMsg","../../../../../manager/RoleCenter","../../../../../manager/GameSocketManager","../../../../../core/E","../../../../../enum/EventName","src/g/fight/osprite/play/skyPort/vo/PataVo","src/g/fight/osprite/SceneObjManager","../../../../../utils/DropUtil","src/g/account/ctrl/PagodaAccountCtrl","../../../../../utils/ItemUtils","src/g/fight/osprite/SceneObjCtroller","src/g/boss/view/PagodaBossHpBar","src/g/index/ctrl/BtnSkiilCtrl","../../../../../utils/system/FloatEffect","src/init/Switches","src/g/fight/osprite/play/GamePlaySvrBase","../../../../../manager/StateManger","../../../../net/messages/ExpCopyMsg","../../../../net/messages/OpResultGS2C","../../../../../plugin/view/ToolTip","../../../../net/messages/BossCriticalHit","../../../../../utils/system/ServerTime","../../../../../config/GameConfig"],function(t,e,n,g,s,o,a,r,i,l,h,v,c,f,u,p,y,d,m,_,C,I,b,w,S){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var E=function(d){function t(t){var e=d.call(this,t)||this;e._state=0,e._isWin=!1,e._endMsg=null,e._failEndMsg=null,e._delayFailKey=!1,e._criticalHitDelayTime=-1,o.E.ins.on(a.EventName.EXIT_BOSS_PLAYTYPE,e,e.exitHandler),m.StateManger.fightsvrmode=!0,e.vo=new r.PataVo;var i=s.GSM.ins;return i.on(n.CTGFightStartGS2C.KEY,e,e.onPagodaFightStart),i.on(n.CTGFightEndGS2C.KEY,e,e.onPagodaFightEnd),i.on(C.OpResultGS2C.KEY,e,e.onOpResultGS2C),i.on(b.BossCriticalHitCDGS2C.KEY,e,e.onBossCriticalHitCDGS2C),i.on(b.BossCriticalHitGS2C.KEY,e,e.onBossCriticalHitGS2C),e}return __extends(t,d),t.prototype.init=function(t){void 0===t&&(t=null),this.clearBattleField(),d.prototype.init.call(this,t),this._portData=this.scene.port,this.initHeroGroup(),this.readyAndFightStart(),this.setJoinSkill()},t.prototype.autoSkill=function(t){this.checkJoinSkill(t)},t.prototype.clearBattleField=function(){u.BtnSkiilCtrl.ins.resetProcess(),this.mon_start_fight=!1},t.prototype.initHeroGroup=function(){d.prototype.initHeroGroup.call(this);var t=v.ItemUtils.getPortVoById(g.RoleCenter.instans.vo.portPagoda.secPortId),e=S.GameConfig.getMapJSON(t.boss_scene);this._fightGroup.resetFightGroup(e.startPoint[0])},t.prototype.readyAndFightStart=function(){this.requestMonsterData();var t=v.ItemUtils.getPortVoById(g.RoleCenter.instans.vo.portPagoda.secPortId),e=S.GameConfig.getMapJSON(t.boss_scene);this._fightGroup.resetFightGroup(e.startPoint[0]),this._fightGroup.setOnceTarget(this._monsterGroup),this.fightStart()},t.prototype.listenStartAttack=function(t){t==c.SceneObjCtroller.ins.self&&(o.E.ins.off(a.EventName.START_ATTACK,this,this.listenStartAttack),this.fightStart())},t.prototype.requestMonsterData=function(){var t=new n.CTGFightStartC2GS;t.pagoda=!0,t.mainportid=g.RoleCenter.instans.vo.portPagoda.mainPortId,t.secportid=g.RoleCenter.instans.vo.portPagoda.secPortId,s.GSM.sendServer(t),console.log("向服务器发请求：CTGFightStartC2GS-mainPortId="+t.mainportid+"-secPortId"+t.secportid)},t.prototype.onPagodaFightStart=function(t){console.log("收到怪物信息，创建怪物"),this._fightReward=t.invent;var e=new _.MonsterAppearExpCopyGS2C;e.monsterArr=t.monsterArr,e.monsterUidArr=t.monsterUidArr,this.createMonsterByMonsterAppearExpCopyGS2C(e),this._state=1,this._isWin=!1,this._monsterGroup.assignMonsterDrop(this._fightReward),this._fightGroup&&this._fightGroup.setOnceTarget(this._monsterGroup)},t.prototype.fightStart=function(){console.log("发送请求战斗");var t=new n.CTGChallengeStartC2GS;s.GSM.sendServer(t)},t.prototype.onOpResultGS2C=function(t){t.opresult?(console.log("通天塔请求战斗开始成功"),this._monsterGroup.setOnceTarget(this._fightGroup)):(p.FE.upItems(t.error,I.BubbleEnum.center),console.log(JSON.stringify(t)))},t.prototype.onBossCriticalHitCDGS2C=function(t){if(this._hpBar){var e=w.ServerTime.serverTime+t.cd;this._hpBar.startKuangBaoCountDown(e)}},t.prototype.onBossCriticalHitGS2C=function(t){if(this._monsterDic&&this._monsterDic[t.bossuid]){var e=this._monsterDic[t.bossuid];if(e){var i=S.GameConfig.bossCrit[t.critSkillId];i&&e.playExtEff(i.effect),t.userDeath&&(this._delayFailKey=!0,this._criticalHitDelayTime=w.ServerTime.serverTime+2)}}},t.prototype.onPagodaFightEnd=function(t){console.log("通天塔战斗结束:"),0==t.win||this.checkIsRunAllKey()?(this.clearBattleField(),t.win?(0<i.SceneObjManager.instans.totalDrops.length?o.E.ins.once(a.EventName.PICK_ALL_FLYITEMS,this,this.pickAllDrops,[t]):Laya.timer.once(500,this,this.popWinPanel),l.DropUtil.isfly=!0,g.RoleCenter.instans.vo.portPagoda=t.newctgData,g.RoleCenter.instans.addInventoryToC(this._fightReward),p.FE.addInventoryToCFloats(this._fightReward),this._state=2,this._isWin=!0,o.E.ins.event(a.EventName.PAGODA_FIGHT_WIN)):this._delayFailKey?this._failEndMsg=t:(this._hpBar&&this._hpBar.hideView(),h.PagodaAccountCtrl.showFail(Laya.Handler.create(this,this.exitHandler)))):this._endMsg=t},t.prototype.pickAllDrops=function(t){Laya.timer.once(1500,this,this.popWinPanel)},t.prototype.popWinPanel=function(){h.PagodaAccountCtrl.showWin(this._fightReward,Laya.Handler.create(this,this.exitHandler),Laya.Handler.create(this,this.gotoNextHandler))},t.prototype.gotoNextHandler=function(){this.readyAndFightStart()},t.prototype.releaseSkillHandler=function(t){this.releaseSkill(t,"")},t.prototype.onExitMsgHandler=function(){return this._endMsg?(this.runAllInfo(),this.onPagodaFightEnd(this._endMsg),!(this._endMsg=null)):!!this._failEndMsg&&(this.onPagodaFightEnd(this._failEndMsg),!(this._failEndMsg=null))},t.prototype.exitHandler=function(){if(!this.onExitMsgHandler()){var t=(g.RoleCenter.instans.vo.portPagoda.secPortId-25e3)%10>>0;this._isWin&&1==t&&this.turnHandler(),this.returnAutoplayPort(),y.Switches.ins.event(84,[!1,!0])}},t.prototype.turnHandler=function(){o.E.ins.event(a.EventName.OPENTURNTABLE,800)},t.prototype.frameMove=function(){d.prototype.frameMove.call(this),this._endMsg&&this.checkIsRunAllKey()&&(this.onPagodaFightEnd(this._endMsg),this._endMsg=null),this._failEndMsg&&this._delayFailKey&&w.ServerTime.serverTime>this._criticalHitDelayTime&&(this._delayFailKey=!1,this.onPagodaFightEnd(this._failEndMsg),this._failEndMsg=null),2==this._state?this._monsterGroup&&this._monsterGroup.isVanishDeath()&&(this._hpBar&&this._hpBar.hideView(),this._state=3):3==this._state&&(0<i.SceneObjManager.instans.totalDrops.length&&this._fightGroup.setPITarget(i.SceneObjManager.instans.totalDrops),this._state=4)},t.prototype.clear=function(){this.onExitMsgHandler(),d.prototype.clear.call(this);var t=s.GSM.ins;t.off(n.CTGFightStartGS2C.KEY,this,this.onPagodaFightStart),t.off(n.CTGFightEndGS2C.KEY,this,this.onPagodaFightEnd),t.off(C.OpResultGS2C.KEY,this,this.onOpResultGS2C),t.off(b.BossCriticalHitCDGS2C.KEY,this,this.onBossCriticalHitCDGS2C),t.off(b.BossCriticalHitGS2C.KEY,this,this.onBossCriticalHitGS2C),o.E.ins.off(a.EventName.PICK_ALL_FLYITEMS,this,this.pickAllDrops),o.E.ins.off(a.EventName.START_ATTACK,this,this.listenStartAttack),o.E.ins.off(a.EventName.EXIT_BOSS_PLAYTYPE,this,this.exitHandler),this._hpBar&&(this._hpBar.hideView(),this._hpBar=null),this._isWin=!1,this._state=0,this.mon_start_fight=!1},t.prototype.createMonsterByMonsterAppearExpCopyGS2C=function(t,e){if(void 0===e&&(e=!1),d.prototype.createMonsterByMonsterAppearExpCopyGS2C.call(this,t,e)){var i=t.monsterUidArr;this._hpBar||(this._hpBar=new f.PagodaBossHpBar);var n=v.ItemUtils.getPortVoById(g.RoleCenter.instans.vo.portPagoda.secPortId),s=v.ItemUtils.getMonsterVOById(n.boss[0]);this._hpBar.showView(s,g.RoleCenter.instans.vo.portPagoda.secPortId,i[i.length-1]);var o=S.GameConfig.getMapJSON(n.boss_scene);o||console.error("portId:"+n.boss_scene);for(var a=0,r=0,l=0,h=0,c=null,u=o.bossXY.length,p=0;p<i.length;p++)h=i[p],c=this._monsterDic[h],o&&p<i.length&&p<u&&(r=o.bossXY[p][0],l=o.bossXY[p][1]),c.resetUnit(r,l),c.status=1,a+=c.getHp();return this._hpBar&&(this._hpBar.setMaxHp(a),this._hpBar.updateHp(a)),!0}return!1},t.prototype.setMonsterHp=function(t,e,i){d.prototype.setMonsterHp.call(this,t,e,i);var n=0,s=null;for(var o in this._monsterDic)(s=this._monsterDic[o])&&!s.isDeath()&&(n+=s.getHp());this._hpBar&&this._hpBar.updateHp(n),0==e&&this._count<=0&&this._fightGroup.stand()},t}(d.GamePlaySvrBase);e.GamePlayPagoda=E}),define("src/g/fight/osprite/play/shenboss/vo/ShenBossVo",["require","exports","src/g/fight/osprite/play/baseplay/vo/WolrdBossVo"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(i.WolrdBossVo);e.ShenBossVo=n}),define("src/g/fight/osprite/play/shenboss/GamePlayShenBoss",["require","exports","src/g/boss/view/AllPersonFightView","../../../../../manager/RoleCenter","src/g/fight/osprite/play/allpeopleboss/GamePlayPeopleBoss","src/g/fight/osprite/NetCtroller","../../../../net/messages/ActivityMessage","../../../../../utils/system/ServerTime","src/g/fight/osprite/play/shenboss/vo/ShenBossVo","../../../../../utils/system/FloatEffect","../../../../../plugin/view/ToolTip","../../../../../config/GameConfig","src/init/TextConst","../../../../../utils/ItemUtils","src/g/boss/vo/BossInfos","../../../../../utils/DropUtil","src/g/fight/manager/ItemManager"],function(t,e,n,s,i,o,a,r,l,h,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t)},t.prototype.initViewVo=function(){this.vo=new l.ShenBossVo,this.vo.init(this.scene.getPortBossVo(),this.mapVo,this._portData),n.AllPersonFightView.ins.vo=this.vo;var t=n.AllPersonFightView.ins;t.roleName=s.RoleCenter.instans.vo.nickname,t.showView(a.EACT_TYPE.shenBoss,this.vo.bossplayID,this._portData.boss[0],this._portData.id),this.initUIEvent()},t.prototype.startBattle=function(){o.NetCtroller.JoinInQMBossCopy(this.vo.bossplayID,a.EACT_TYPE.shenBoss)},t.prototype.onJoinInActMsg=function(t){if(this.updatePanelState(t),t.opresult){s.RoleCenter.instans.vo,u.GameConfig.BossSetting[1];this.vo.ownerAcc=t.bossOwner,t.acttype==a.EACT_TYPE.rebirthBoss&&(n.AllPersonFightView.ins.Actid=t.actid,n.AllPersonFightView.ins.hurtRankBase(t)),this.initPlayers(t),this.sendStartAttackC2GS(),s.RoleCenter.instans.vo.WINGBOSSCOUNT--}else h.FE.upItems(p.TextConst.get(410),c.BubbleEnum.center),this.returnAutoplayPort()},t.prototype.startGetOwnerBattleHandler=function(){this._fightGroup.isDeath()?h.FE.upItems(p.TextConst.get(407),c.BubbleEnum.center):this.vo.selfAcc!=this.vo.ownerAcc?(h.FE.upItems(p.TextConst.get(409),c.BubbleEnum.center),this.sendGetBossOwner()):h.FE.upItems(p.TextConst.get(408),c.BubbleEnum.center)},t.prototype.exitHandler=function(t){void 0===t&&(t=!0);var e=r.ServerTime.serverTime;s.RoleCenter.instans.self.bossData.shenBossReEnterCd=e,o.NetCtroller.ExitQMBossCopy(this.vo.bossplayID,a.EACT_TYPE.shenBoss),this.returnAutoplayPort(),n.AllPersonFightView.ins.hideView();var i=d.ItemUtils.getBossSettingVoById(1).reentercd;g.BossInfos.shencdTime=i+e},t.prototype.onActivityEndMsg=function(t){v.DropUtil.isfly=!0,this.dropFly(f.ItemManager.getDropArray(t.inventory),this._fightGroup.getFUList()[0],t)},t.prototype.dropOver=function(t){e.prototype.dropOver.call(this,t),401<=t.actid&&t.actid<=404&&n.AllPersonFightView.ins.onZSBOSSKilled()},t}(i.GamePlayPeopleBoss);e.GamePlayShenBoss=y}),define("src/g/fight/osprite/play/vipboss/GamePlayVipBoss",["require","exports","../../../../../manager/RoleCenter","../../../../net/messages/ActivityMessage","src/g/fight/osprite/NetCtroller","../../../../../core/E","../../../../../enum/EventName","src/g/account/ctrl/AccountViewCtrl","src/g/boss/view/AllPersonFightView","../../../../../manager/AM","../../../../../manager/GameSocketManager","../../../../../utils/system/FloatEffect","src/g/fight/osprite/play/baseplay/WorldBossGamePlay","../../../../net/messages/ChangeSceneMsg","src/g/fight/osprite/obj/Pet","../../../../../plugin/view/ToolTip","src/g/fight/osprite/SceneObjManager","src/g/fight/osprite/play/baseplay/vo/WolrdBossVo","../../../../../manager/LayerManager","src/init/Switches","src/g/boss/vo/BossInfos","src/init/TextConst"],function(t,e,l,s,i,n,o,a,r,h,c,u,p,d,g,v,f,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var b=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.initViewVo=function(){this.vo=new y.WolrdBossVo,this.vo.init(this.scene.getPortBossVo(),this.mapVo,this._portData);var t=r.AllPersonFightView.ins;t.roleName=l.RoleCenter.instans.vo.nickname,t.vo=this.vo,t.showView(s.EACT_TYPE.vipBoss,this.vo.bossplayID,this._portData.boss[0],this._portData.id),t.btn_cost.on(Laya.Event.CLICK,this,this.sendReBorn),t.btn_att_boss.on(Laya.Event.CLICK,this,this.attBossHandler),t.btn_att_owner.on(Laya.Event.CLICK,this,this.startGetOwnerBattleHandler),t.btn_att_lboss.on(Laya.Event.CLICK,this,this.attBossHandlerOwner),t.fightBackButton.on(Laya.Event.CLICK,this,this.fightBackHander),this._autoBeatBackKey=!0},t.prototype.attBossHandlerOwner=function(){this._autoBeatBackKey=!1,this.ownerAttackTarget("")},t.prototype.init=function(t){void 0===t&&(t=null),e.prototype.init.call(this,t),this._portData=this.scene.matCopy,this.initViewVo(),this.initBossGroup(),this.initSelfGroup(),n.E.ins.on(o.EventName.EXIT_BOSS_PLAYTYPE,this,this.alertTip),this.startBattle()},t.prototype.onBossOwnerChange=function(t){console.log("Boss归属权发生变化了："+t.newowner),e.prototype.onBossOwnerChange.call(this,t),t.newowner==l.RoleCenter.instans.vo.username&&r.AllPersonFightView.ins.setBossHead()},t.prototype.attBossHandler=function(t){void 0===t&&(t=!1);var e=new s.RobBossOwnerC2GS;e.actid=this.vo.bossplayID,e.acttype=y.WolrdBossVo.PORT_TYPE,e.rob=!1,c.GSM.sendServer(e)},t.prototype.startBattle=function(){Laya.timer.loop(10,this,this.checkWayHandler)},t.prototype.checkWayHandler=function(){this._mainRole.ways.length<=1&&(Laya.timer.clear(this,this.checkWayHandler),console.log("发送vipbossid-------",this.vo.bossplayID),i.NetCtroller.JoinInQMBossCopy(this.vo.bossplayID,s.EACT_TYPE.vipBoss))},t.prototype.clear=function(){e.prototype.clear.call(this),this.bossGroup&&(this.bossGroup.destroyGroup(),this.bossGroup=null),this.pickAllDropItem(),n.E.ins.off(o.EventName.EXIT_BOSS_PLAYTYPE,this,this.alertTip)},t.prototype.releaseSkillHandler=function(t){this._fightGroup.getFGTarget()&&this.releaseSkill(t,this._fightGroup.getFGTarget().groupID)},t.prototype.exitHandler=function(t){t&&i.NetCtroller.ExitQMBossCopy(this.vo.bossplayID,s.EACT_TYPE.vipBoss),this.returnAutoplayPort(),r.AllPersonFightView.ins.hideView()},t.prototype.alertTip=function(){h.AM.exitPlay(this.type,new Laya.Handler(this,function(){this.exitHandler(!0)}))},t.prototype.startGetOwnerBattleHandler=function(){this._fightGroup.isDeath()?u.FE.upItems(I.TextConst.get(407),v.BubbleEnum.center):this.vo.selfAcc!=this.vo.ownerAcc?(u.FE.upItems(I.TextConst.get(409),v.BubbleEnum.center),this.sendGetBossOwner()):u.FE.upItems(I.TextConst.get(408),v.BubbleEnum.center)},t.prototype.onJoinInActMsg=function(t){if(this.updatePanelState(t),t.opresult)m.LayerManager.closeAllPOPWindow(),this.vo.ownerAcc=t.bossOwner,this.bossGroup.setFGTarget(this._playerDic[this.vo.ownerAcc]),r.AllPersonFightView.ins.setMaxHp(t.bossMaxHP),r.AllPersonFightView.ins.setHp(t.bossHP),this.initPlayers(t),t.shieldHP&&r.AllPersonFightView.ins.showHuDunView(t.shieldHP,d.EPlayType.PLAYTYPE_MOSTVIPBOSS1),this.sendStartAttackC2GS();else{for(var e=C.BossInfos.vipboss,i=0;i<e.length;i++){var n=e[i];n.bossid==this.vo.bossplayID&&(n.curstate=s.EACTIVITY_STATE.INCD)}console.log(t,"----------该Boss已被击杀------------"),u.FE.upItems(I.TextConst.get(410),v.BubbleEnum.center),this.exitHandler(!1)}},t.prototype.initPlayers=function(t){for(var e,i=t.otherUserList,n=i.length,s=(t.damageList,0);s<n;s++){var o=i[s],a=o.username;if(this.vo.addPlayers(o),t.bossOwner==a)e=this.addAtherPlayerSbkOtherHeroData(o);else{var r=this.addAtherPlayerSbkOtherHeroData(o);t.userDeathStateList[s]&&r.setDeath()}}e&&this.bossGroup.setOnceTarget(e),this.setBossOwnWithAcc(t.bossOwner),this.vo.addPlayers(l.RoleCenter.instans.vo)},t.prototype.onOtherUserJoinMsg=function(t){if(t.opresult){for(var e=t.newuser,i=e.length,n=0;n<i;n++){var s=e[n];this.vo.addPlayers(s),this.addAtherPlayerSbkOtherHeroData(s)}r.AllPersonFightView.ins.showOwnerInfo(),r.AllPersonFightView.ins.hurtRankOtherJoin(t)}},t.prototype.onOwnerResultMsg=function(t){console.log("抢夺消息"),t.opresult},t.prototype.updateCombat=function(){r.AllPersonFightView.ins.updateCombat(l.RoleCenter.instans.vo.combat)},t.prototype.setFightTargetWithAcc=function(t){},t.prototype.updateOwerHp=function(){var t=this._playerDic[this.vo.ownerAcc],e=0,i=0;if(t){for(var n=t.getFUList(),s=0;s<n.length;s++)n[s]instanceof g.Pet||(e+=n[s].getTotalHp(),i+=n[s].getHp());r.AllPersonFightView.ins.setOwerHp(i,e)}},t.prototype.onComboHit=function(t){e.prototype.onComboHit.call(this,t),t.invincibleTime<=0&&(t.beAttackAcc||r.AllPersonFightView.ins.setHp(t.hpAfterAttack[0]))},t.prototype.changeSelfHP=function(t){if(e.prototype.changeSelfHP.call(this,t),this._fightGroup.isDeath())return t.attackAcc,void r.AllPersonFightView.ins.showCountDownPan("BOSS")},t.prototype.changeBossHP=function(t){e.prototype.changeBossHP.call(this,t),0<t.hpPercent?(r.AllPersonFightView.ins.changeRank(t),r.AllPersonFightView.ins.setHp(t.hpPercent)):r.AllPersonFightView.ins.setHp(t.hpAfterAttack)},t.prototype.onActivityEndMsg=function(t){l.RoleCenter.instans.addInventoryToC(t.inventory),this.redEqAddTask(t.inventory),n.E.ins.off(o.EventName.UPDATE_COMBAT,this,this.updateCombat),Laya.timer.loop(30,this,this.checkHandler,[t])},t.prototype.checkHandler=function(t){if(f.SceneObjManager.instans.totalDrops.length<=0){Laya.timer.clearAll(this);var e=this.vo.ownerAcc==this.vo.selfAcc;a.AccountViewCtrl.ins.successFightEnd(t.inventory,Laya.Handler.create(this,this.returnAutoplayPort),e?I.TextConst.get(411):I.TextConst.get(203),this.vo,t),r.AllPersonFightView.ins.hideView()}},t.prototype.sendReBorn=function(){if(l.RoleCenter.instans.GOLD<this.bossSettingVo.revivecdCost)_.Switches.ins.event(155);else{var t=new s.ActivityRebirthC2GS;t.actid=this.vo.bossplayID,t.acttype=y.WolrdBossVo.PORT_TYPE,c.GSM.sendServer(t)}},t.prototype.sendGetBossOwner=function(){var t=new s.RobBossOwnerC2GS;t.actid=this.vo.bossplayID,t.acttype=y.WolrdBossVo.PORT_TYPE,t.rob=!0,c.GSM.sendServer(t)},t.prototype.onUserExitMsg=function(t){e.prototype.onUserExitMsg.call(this,t),this.vo.removeAttPlayer(t.username)},t}(p.WorldBossGamePlay);e.GamePlayVipBoss=b}),define("src/g/fight/osprite/play/zsboss/GamePlayZSBoss",["require","exports","src/g/boss/view/AllPersonFightView","../../../../../manager/RoleCenter","src/g/fight/osprite/play/allpeopleboss/GamePlayPeopleBoss","../../../../../manager/GameSocketManager","src/g/fight/osprite/NetCtroller","../../../../net/messages/ActivityMessage","../../../../../utils/system/ServerTime","../../../../../utils/system/FloatEffect","../../../../../plugin/view/ToolTip","src/g/fight/osprite/play/baseplay/vo/WolrdBossVo","../../../../../manager/LayerManager","../../../../net/messages/ChangeSceneMsg","../../../../net/messages/BossCriticalHit","../../../../../utils/CountDown","src/init/TextConst"],function(t,e,n,s,i,o,a,r,l,h,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(i){function t(t){var e=i.call(this,t)||this;return e.kuangBaoCd=new v.CountDown,e.setJoinSkill(),e}return __extends(t,i),t.prototype.initViewVo=function(){this.vo=new u.WolrdBossVo,this.vo.init(this.scene.getPortBossVo(),this.mapVo,this._portData),n.AllPersonFightView.ins.vo=this.vo;var t=n.AllPersonFightView.ins;t.roleName=s.RoleCenter.instans.vo.nickname,t.showView(r.EACT_TYPE.rebirthBoss,this.vo.bossplayID,this._portData.boss[0],this._portData.id),this.initUIEvent()},t.prototype.init=function(t){void 0===t&&(t=null),i.prototype.init.call(this,t),o.GSM.ins.on(g.BossCriticalHitCDGS2C.KEY,this,this.onBossCriticalHitCDGS2C)},t.prototype.onAttackMsg=function(t){i.prototype.onAttackMsg.call(this,t),this.checkJoinSkill(t)},t.prototype.onBossCriticalHitCDGS2C=function(t){0==n.AllPersonFightView.ins.destroyed&&(n.AllPersonFightView.ins.kuangBaoBox.visible=!0,this.kuangBaoCd.start(t.cd+l.ServerTime.serverTime,this.updKBCountDown,this))},t.prototype.updKBCountDown=function(t){0==n.AllPersonFightView.ins.destroyed&&(0!=t?n.AllPersonFightView.ins.kuangBaoBox.imgSecond.value=t.toString():n.AllPersonFightView.ins.kuangBaoBox.visible=!1)},t.prototype.clear=function(){i.prototype.clear.call(this),this.kuangBaoCd.stop(),o.GSM.ins.off(g.BossCriticalHitCDGS2C.KEY,this,this.onBossCriticalHitCDGS2C)},t.prototype.startBattle=function(){this.bossGroup&&(this.bossGroup.getFUList()[0].topHpBar.typeElement=3),a.NetCtroller.JoinInQMBossCopy(this.vo.bossplayID,u.WolrdBossVo.PORT_TYPE)},t.prototype.startGetOwnerBattleHandler=function(){this._fightGroup.isDeath()?h.FE.upItems(f.TextConst.get(407),c.BubbleEnum.center):this.vo.selfAcc!=this.vo.ownerAcc?(h.FE.upItems(f.TextConst.get(409),c.BubbleEnum.center),this.sendGetBossOwner()):h.FE.upItems(f.TextConst.get(408),c.BubbleEnum.center)},t.prototype.exitHandler=function(){var t=l.ServerTime.serverTime;s.RoleCenter.instans.self.bossData.rebirthBossReEnterCd=t,a.NetCtroller.ExitQMBossCopy(this.vo.bossplayID,u.WolrdBossVo.PORT_TYPE),this.returnAutoplayPort(),n.AllPersonFightView.ins.hideView()},t.prototype.onJoinInActMsg=function(t){t.opresult?(p.LayerManager.closeAllPOPWindow(),n.AllPersonFightView.ins.Actid=t.actid,n.AllPersonFightView.ins.hurtRankBase(t),this.bossGroup.setFGTarget(this._fightGroup),n.AllPersonFightView.ins.setMaxHp(t.bossMaxHP),n.AllPersonFightView.ins.setHp(t.bossHP),this.initPlayers(t),t.shieldHP&&n.AllPersonFightView.ins.showHuDunView(t.shieldHP,d.EPlayType.PLAYTYPE_REBORNBOSS),this.sendStartAttackC2GS()):(h.FE.upItems(f.TextConst.get(298),c.BubbleEnum.center),this.returnAutoplayPort())},t}(i.GamePlayPeopleBoss);e.GamePlayZSBoss=y}),define("src/g/account/view/PortFightSuc",["require","exports","../../../enum/enumItem","src/g/guide/vo/RewardVo","../../../utils/ItemUtils","src/g/account/view/AccItem","../../../meta/QualiyVo"],function(t,e,d,g,v,n,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;return t.popupEffect=null,t.list.itemRender=n.AccItem,t.list.repeatX=4,t.list.repeatY=4,t.list.selectEnable=!0,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=100,t.list.renderHandler=new Laya.Handler(t,t.rendHandler),t}return __extends(t,i),t.prototype.rendHandler=function(t,e){t.eqData=this.list.dataSource[e],t.scale(1,1)},t.prototype.setData=function(t){if(console.warn("野战胜利"),t){var e=[];if(t.currencyList){for(var i=t.currencyList,n=0;n<i.length;n++){var s=new g.RewardVo;s.count=i[n].val;var o=v.ItemUtils.getCurrencyByDefine(i[n].key);s.name=o.name,s.type=d.ItemType.CURRENCY,s.quality=f.QualityStruct.Ins.getQColorById(o.quality),s.res=v.ItemUtils.getIconByIconId(o.icon),s.qualityNum=o.quality,s.define=i[n].key,s.streamer=o.streamer,e.push(s)}e.reverse()}if(t.itemList){var a=[],r=t.itemList;for(n=0;n<r.length;n+=2){var l=new g.RewardVo,h=v.ItemUtils.getItemVoById(r[n]);l.res=v.ItemUtils.getIconByIconId(h.icon),l.lv=h.uselimit,l.qualityNum=h.quality,l.quality=f.QualityStruct.Ins.getQColorById(h.quality),l.name=h.name,console.warn("结算得出奖励"+h.id),l.id=h.id,l.type=d.ItemType.ITEM,l.count=r[n+1],l.streamer=h.streamer,a.push(l)}a.sort(this.sortArr),e=e.concat(a)}if(t.equipList){var c=[],u=t.equipList;for(n=0;n<u.length;n++){l=new g.RewardVo;var p=v.ItemUtils.getEquipVoById(u[n].equtemplet);l.res=v.ItemUtils.getIconByIconId(p.icon),l.lv=p.limit,l.qualityNum=p.quality,l.quality=f.QualityStruct.Ins.getQColorById(p.quality),l.name=p.name,l.type=d.ItemType.EQ,l.id=p.id,l.job=p.job,c.push(l)}c.sort(this.sortArr),e=e.concat(c)}this.list.dataSource=e}else console.error("掉落为空")},t.prototype.popup=function(t,e){this.img_bg.rotation=0,Laya.timer.loop(120,this,function(){this.img_bg.rotation+=10}),i.prototype.popup.call(this,t,e)},t.prototype.close=function(t,e){console.warn("野战胜利关闭"),Laya.timer.clearAll(this.img_bg),Laya.timer.clearAll(this),i.prototype.close.call(this,t,e)},t.prototype.sortArr=function(t,e){return e.qualityNum-t.qualityNum},t}(ui.account.PortFightSucUI);e.PortFightSuc=i}),define("src/g/account/ctrl/PortFightSucCtrl",["require","exports","src/g/account/view/PortFightSuc","../../../utils/SoundUtils","../../../utils/ItemUtils","src/init/TextConst"],function(t,e,o,a,l,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.suipianDropGap=NaN}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t),this._ins},enumerable:!0,configurable:!0}),t.prototype.hideInfo=function(){var t=this._view;t&&(t.waitBox.visible=!1,t.lbEquipName.visible=!1,t.imgRewardTip.visible=!1)},t.prototype.fightSuccess=function(t,e,i){var n;if(this._view||(this._view=new o.PortFightSuc),this._handler=e,this._count=5,this._view.btn_get.label=r.TextConst.get(243,this._count),this._view.btn_get.once(Laya.Event.CLICK,this,this.clickHandler),Laya.timer.loop(1e3,this,this.loopHandler),this._view.setData(t),this._view.popup(),a.SoundUtils.getInstance().playSoundById(107),t&&t.itemList&&(n=this.getSuiPianVo(t.itemList)),null!=n)this.suipianDropGap=0,this.showSuiPianReward(n);else{var s=this.getNextSuiPianPort(5001,i);this.suipianDropGap=s-i,this.showDropGap()}},t.prototype.showSuiPianReward=function(t){this._view.waitBox.visible=!1,this._view.lbEquipName.text=null!=t?t.name:"";this._view.width,this._view.imgRewardTip.width,this._view.lbEquipName.width;this._view.imgRewardTip.visible=this._view.lbEquipName.visible=!0},t.prototype.showDropGap=function(){this._view.waitBox.visible=!0,this._view.lbWaitPortNum.text=this.suipianDropGap.toString(),this._view.imgRewardTip.visible=this._view.lbEquipName.visible=!1},t.prototype.getSuiPianVo=function(t){if(t)for(var e=0;e<t.length;e+=2){if(console.warn("关卡itemlistID:"+t[e]),5001<=t[e]&&t[e]<=5278)return l.ItemUtils.getItemVoById(t[e])}return null},t.prototype.getNextSuiPianPort=function(t,e){if(t<5001)return console.error("关卡boss掉落碎片ID错误:"+t),1;var i,n,s;if(!this.itemIdList){this.itemIdList=[];for(var o=t;o<5278;o++)(i=l.ItemUtils.getItemVoById(o))&&this.itemIdList.push(o);this.itemIdList=this.itemIdList.sort(this.sortItem)}for(var a=this.itemIdList.length,r=0;r<a;){if((i=l.ItemUtils.getItemVoById(this.itemIdList[r]))&&(i.effect&&0<i.effect.length&&(s=i.effect[0]),s&&2==s.length&&"port"==s[0]&&e<(n=Number(s[1])+100)))return n;r++}return-1},t.prototype.sortItem=function(t,e){var i,n=0,s=0,o=l.ItemUtils.getItemVoById(t);return o.effect&&0<o.effect.length&&(i=o.effect[0]),i&&2==i.length&&"port"==i[0]&&(n=Number(i[1])+100),(o=l.ItemUtils.getItemVoById(e)).effect&&0<o.effect.length&&(i=o.effect[0]),i&&2==i.length&&"port"==i[0]&&(s=Number(i[1])+100),n-s},t.prototype.clickHandler=function(){this._view.close(),this._count=0,Laya.timer.clear(this,this.loopHandler),this._handler&&(this._handler.runWith(this._handler.args),this._handler=null)},t.prototype.loopHandler=function(){this._count--,console.warn("关卡计算倒计时运行中"),this._count<=0&&this.clickHandler(),this._view&&(this._view.btn_get.label=r.TextConst.get(243,this._count))},t}();e.PortFightSucCtrl=i}),define("src/g/fight/osprite/play/levelboss/GamePlayLevel",["require","exports","src/g/fight/osprite/play/baseplay/GamePlayPVE","src/g/fight/osprite/NetCtroller","src/g/fight/osprite/play/PlayManager","src/g/fight/osprite/SceneObjManager","src/g/account/ctrl/AccountViewCtrl","../../../../../manager/RoleCenter","src/g/index/ctrl/BtnSkiilCtrl","../../../../../utils/DropUtil","../../../../../enum/EventName","../../../../../core/E","src/g/index/ctrl/PortViewCtrl","src/g/fight/osprite/obj/PassGateUnit","src/g/fight/osprite/SceneObjCtroller","src/g/account/ctrl/PortFightSucCtrl","../../../../../config/GameConfig","../../../../../utils/SoundUtils","../../../../../manager/LayerManager","../../../../net/messages/TeamMsg","../../../../../meta/CommonVo"],function(t,e,i,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function i(t){var e=n.call(this,t)||this;return e.currentPortID=0,e.nextPortID=-1,e.resetPosKey=!1,e._success=!1,e.isDestroySelfKey=!1,e.resetPosKey=!1,e.changeMap(l.RoleCenter.instans.self.portstatus.portindex),e}return __extends(i,n),i.prototype.changeMap=function(t){var e=y.GameConfig.getPortByID(t);e&&this.scene&&(null==this.scene.mapVo||this.scene.mapVo.id!=e.boss_scene?(this.resetPosKey=!0,this.scene.changeMap(e.boss_scene)):(this.init(null),m.SoundUtils.getInstance().playMusicById(this.mapVo.soundId))),i._sp.skin="res/unpack/maskbg.png",i._sp.width=Laya.stage.width+10,i._sp.height=Laya.stage.height,_.LayerManager.fightLayer.addChild(i._sp)},i.prototype.init=function(t){n.prototype.init.call(this,t),o.PlayManager.loading=!1,102<=this._portData.id&&(c.DropUtil.isfly=!0),p.E.ins.event(u.EventName.CHALLENGEBOSS_START,{isBoss:!0,isPrivateBoss:!1,isMeetPK:!1,portId:this._portData.id}),p.E.ins.event(u.EventName.BOSSWARNINGSHOW),this.currentPortID=this._portData.id,this.nextPortID=this.currentPortID,p.E.ins.on(u.EventName.START_ATTACK,this,this.listenStartAttack),this.initPlayer(),this.resetPosKey&&(this.resetPosKey=!1,this._fightGroup&&this._fightGroup.resetFightGroup(this.mapVo.startPoint[0]));var e=103,i=I.CommonVo.getVoByKey("hejiyindao");i&&(e=i.val2numArr[0]),this._portData.id==e&&(p.E.ins.event(u.EventName.READY_JOINT_ATTACK_GUIDE),this.guide1=this.startGuide1,this.guide2=this.startGuide2,this.bossFightUnit.on(u.EventName.HP_CHANGED,this,this.onHpChanaged))},i.prototype.onHpChanaged=function(t){var e=this.bossFightUnit.getTotalHp();this.guide2&&t<.7*e?(this.guide2(),this.guide2=null,this.bossFightUnit.off(u.EventName.HP_CHANGED,this,this.onHpChanaged)):this.guide1&&t<.8*e&&(this.guide1(),this.guide1=null)},i.prototype.startGuide1=function(){p.E.ins.event(u.EventName.DANGERSHOW)},i.prototype.startGuide2=function(){console.log("开始引导合击"),p.E.ins.event(u.EventName.OPEN_JOINT_ATTACK_GUIDE)},i.prototype.initPlayer=function(){this.mon_start_fight=!1,v.SceneObjCtroller.ins.self.removeWeaponEff(),this._fightGroup.setOnceTarget(this.bossGroup),this.bossFightUnit.face=8-v.SceneObjCtroller.ins.self.face,this.setJoinSkill(),this._mainRole.resetSkillPlay(-1)},i.prototype.listenStartAttack=function(t){t==v.SceneObjCtroller.ins.self&&(p.E.ins.off(u.EventName.START_ATTACK,this,this.listenStartAttack),this.fightStart())},i.prototype.fightStart=function(){i._sp&&i._sp.removeSelf(),s.NetCtroller.fightStartC2GS(!0,this._portData.boss,this._portData.id)},i.prototype.onReceiveFightEnd=function(t){n.prototype.onReceiveFightEnd.call(this,t),console.log("收到战斗结算"),h.BtnSkiilCtrl.ins.removeGuideArrow(),p.E.ins.event(u.EventName.CHALLENGEBOSS_END,t),t.opresult?(this.switchRole(),c.DropUtil.isfly?Laya.timer.once(500,this,function(){this._fightGroup.setPITarget(a.SceneObjManager.instans.totalDrops),Laya.timer.loop(200,this,this.checkHandler)}):(this._fightGroup.setPITarget(a.SceneObjManager.instans.totalDrops),Laya.timer.loop(600,this,this.checkHandler))):(d.PortViewCtrl.getins().offAutoFight(),this.failHandler())},i.prototype.checkHandler=function(){a.SceneObjManager.instans.totalDrops.length<=0&&(Laya.timer.clear(this,this.checkHandler),this.challengeBossSuccess(0))},i.prototype.challengeBossSuccess=function(t){Laya.timer.clearAll(this),f.PortFightSucCtrl.ins.fightSuccess(this._fightReward,Laya.Handler.create(this,this.sucessHandler),this.nextPortID),this._fightReward&&(this.effectExpAndMoney(this._fightReward),this._fightReward.clear(),this._fightReward=null)},i.prototype.sucessHandler=function(){this._success=!0;var t=l.RoleCenter.instans.vo.portstatus.portindex;Laya.timer.loop(100,this,this.checkWayHandler),t%10==0&&this.mapVo.bossDoorXY&&this.mapVo.bossDoorXY.length?(this.passItem=new g.PassGateUnit,this.passItem.setup(this.mapVo.bossDoorXY[0][0],this.mapVo.bossDoorXY[0][1],""),this._fightGroup.moveToPoint(this.mapVo.bossDoorXY[0]),Laya.timer.loop(100,this,this.checkWayHandler)):this.enterIntoPort()},i.prototype.checkWayHandler=function(){var t=this._mainRole;t?t.ways.length<=0&&(Laya.timer.clear(this,this.checkWayHandler),this.enterIntoPort()):(Laya.timer.clear(this,this.checkWayHandler),this.enterIntoPort())},i.prototype.enterIntoPort=function(){n.prototype.enterIntoPort.call(this)},i.prototype.failHandler=function(){r.AccountViewCtrl.ins.failFightEnd(Laya.Handler.create(this,this.exitHandler),C.enumTeamType.helpFight),p.E.ins.event(u.EventName.BATTLE_FAILED)},i.prototype.onReceiveFightStart=function(t){if(n.prototype.onReceiveFightStart.call(this,t),t.opresult){this._fightReward=t.inventory;var e=this.bossGroup;e&&e.assignMonsterDrop(this._fightReward)}else this.exitHandler()},i.prototype.exitHandler=function(){d.PortViewCtrl.getins().offAutoFight(),this.enterIntoPort(),Laya.timer.clearAll(this)},i.prototype.clear=function(){p.E.ins.off(u.EventName.START_ATTACK,this,this.listenStartAttack),Laya.timer.clearAll(this),this.passItem&&(a.SceneObjManager.instans.unregObject(this.passItem),this.passItem.destory(),this.passItem=null),n.prototype.clear.call(this),this._success&&Laya.timer.once(100,this,function(){p.E.ins.event(u.EventName.PORTEFFECTUP)}),this.bossGroup&&this.bossGroup.destroyGroup(),this.mon_start_fight=!1,i._sp.removeSelf()},i.prototype.releaseSkillHandler=function(t){this.releaseSkill(t,"")},i.prototype.onAttackMsg=function(t){this.mon_start_fight||(this.bossGroup.setOnceTarget(this._fightGroup),this.mon_start_fight=!0),n.prototype.onAttackMsg.call(this,t),this.bossFightUnit.svrSetHP(t.hpAfterAttack[0]),this.checkJoinSkill(t)},i.prototype.onHpChg=function(t){n.prototype.onHpChg.call(this,t),t.beAttack||this.bossFightUnit.svrSetHP(t.hpAfterAttack[0])},i._sp=new Laya.Image,i}(i.GamePlayPVE);e.GamePlayLevel=n}),define("src/g/fight/osprite/obj/MineNpc",["require","exports","../../../../manager/RoleCenter","src/g/fight/osprite/obj/Npc"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.uId=null,t.useKey=!1,t.userNameStr=null,t.endTime=0,t.robState=-1,i.RoleCenter.instans.self.newbee&&(t.body.on(Laya.Event.CLICK,t,t.onClick),t.body.hitArea=new Laya.Rectangle(-40,-150,80,150)),t}return __extends(t,e),t.prototype.onClick=function(){this._callFunction&&this._callFunction.call(this._caller,this.userNameStr)},t.prototype.setHeadName=function(t){this.actorName=t,this.topHpBar.headName="",this.topHpBar.htmlHeadName=t},t.prototype.setHeadBlood=function(t){this.topHpBar.showTime(t)},t.prototype.setHeadState=function(t,e){this.robState!=t&&(this.robState=t,this.topHpBar.setWorkerState(this.robState,e))},t.prototype.registerClickHandler=function(t,e,i){this._caller=t,this._callFunction=e,this.userNameStr=i},t.prototype.clearrClickHandler=function(){this._caller=null,this._callFunction=null,this.destory()},t.prototype.destory=function(){this.clearBuf(),e.prototype.destory.call(this)},t}(n.NPC);e.MineNPC=s}),define("src/g/fight/osprite/play/GamePlayMine",["require","exports","src/g/fight/osprite/play/GamePlay","src/g/fight/osprite/SceneObjCtroller","../../../../enum/EventName","../../../../core/E","../../../../manager/LayerManager","src/g/fight/osprite/GameScene","../../../../manager/RoleCenter","../../../net/messages/EscortTaskUserDataGS2C","../../../../manager/GameSocketManager","../../../../manager/MineIngManager","../../../../utils/system/ServerTime","../../../net/messages/StartRobETaskMsg","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","src/g/fight/osprite/play/baseplay/SvrHeroUnit","src/g/index/ctrl/BtnSkiilCtrl","src/g/account/ctrl/AccountViewCtrl","../../../../utils/system/DateUitl","src/g/fight/osprite/obj/PassGateUnit","../../../../enum/JobEnum","src/g/clearRes/ClearResM","src/init/GameEventDispatcher","src/init/TextConst","../../../../vo/MinePlayerVo"],function(t,e,i,r,p,d,g,s,v,o,a,f,y,l,h,c,u,m,_,C,I,b,w,S,E,T){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t){var e=n.call(this,t)||this;e._loadingKey=!1,e._loadingKey=!0,e._mineNpcList=[],e._passGameRadius=1e4,d.E.ins.on(p.EventName.EXIT_BOSS_PLAYTYPE,e,e.exitHandler);var i=r.SceneObjCtroller.ins.getSelfGroup();return e.setFightGroup(i),e._nextPassGateUnit=new I.PassGateUnit,e._prePassGateUint=new I.PassGateUnit,f.MineIngManager.instance.gamePlayMine=e,f.MineIngManager.instance.clearScene(),d.E.ins.event(p.EventName.OPENMINE),a.GSM.ins.on(l.StartRobETaskGS2C.KEY,e,e.onStartRobETaskGS2C),d.E.ins.on(p.EventName.PLAY_TYPE_CHANGED,e,e.onPlayTypeChanged),e}return __extends(t,n),t.prototype.onPlayTypeChanged=function(){m.BtnSkiilCtrl.ins.setSkillBtnVisible(!1),d.E.ins.off(p.EventName.PLAY_TYPE_CHANGED,this,this.onPlayTypeChanged)},t.prototype.init=function(t){void 0===t&&(t=null),n.prototype.init.call(this,t),this._loadingKey=!1,this._pkTargetName=null,this.setHeroGroupPos(),this.setPassGatePos(),this.updateWorkerInfo()},t.prototype.setPassGatePos=function(){this._nextPassGateUnit.setup(s.GameScene.ins.mapVo.bossDoorXY[0][0],s.GameScene.ins.mapVo.bossDoorXY[0][1],E.TextConst.get(438)),this._prePassGateUint.setup(s.GameScene.ins.mapVo.bossDoorXY[1][0],s.GameScene.ins.mapVo.bossDoorXY[1][1],E.TextConst.get(439)),this.updatePassGateVisible()},t.prototype.updatePassGateVisible=function(){this._prePassGateUint.show(),this._nextPassGateUnit.show(),0==f.MineIngManager.instance.getSceneLevel()&&this._prePassGateUint.hide(),f.MineIngManager.instance.getSceneLevel()==f.MineIngManager.instance.getMaxSceneLevel()-1&&this._nextPassGateUnit.hide()},t.prototype.updatePassGate=function(){if(this._mainRole){var t=0,e=0;this._prePassGateUint&&this._prePassGateUint.visible&&(t=this._prePassGateUint.mapX-this._mainRole.mapX)*t+(e=this._prePassGateUint.mapY-this._mainRole.mapY)*e<this._passGameRadius&&(this._fightGroup.resetFightGroupPos(this.mapVo.startPoint[0],!0),f.MineIngManager.instance.setSceneLevel(f.MineIngManager.instance.getSceneLevel()-1)),this._nextPassGateUnit&&this._nextPassGateUnit.visible&&(t=this._nextPassGateUnit.mapX-this._mainRole.mapX)*t+(e=this._nextPassGateUnit.mapY-this._mainRole.mapY)*e<this._passGameRadius&&(this._fightGroup.resetFightGroupPos(this.mapVo.startPoint[0],!0),f.MineIngManager.instance.setSceneLevel(f.MineIngManager.instance.getSceneLevel()+1))}},t.prototype.onStartRobETaskGS2C=function(t){if(console.log("GamePlayTest::onStartRobETaskGS2C"),t.opresult){if(f.MineIngManager.instance.subRobTime(),t.fightTarget.length<1)return;1<t.fightTarget.length&&console.log("waring::GamePlayeMine::onStartRobETaskGS2C:msg.fightTarget.length > 1"),this.createPkTargetGroup(t.fightTarget[0]);var e=this._playerDic[this._pkTargetName];e&&this._fightGroup?(this._fightGroup.setFGTarget(e),f.MineIngManager.instance.startRobBattling(),this._fightGroup.showOtherUnit(this._mainRole.worldX,this._mainRole.worldY)):(console.log("error:GamePlayMine:onStartRobETaskGS2C"),null==e&&console.error("this.tTargetFG == null"),null==this._fightGroup&&console.error("this._fightGroup == null"))}else h.FE.upItems(t.error,c.BubbleEnum.center)},t.prototype.createPkTargetGroup=function(t){var e=u.SvrHeroUnit.createFightGroup(t,this.mapVo.startPoint[0]);e.addToFightLayer(),this.addPlayerFG(e),this._pkTargetName=t.username,this._fightGroup.separateFG(e)},t.prototype.setHeroGroupPos=function(){console.log("GamePlayTest::initHeroGroup"),this._fightGroup.resetFightGroup(this.mapVo.startPoint[0]),this._fightGroup.addToFightLayer(),this._fightGroup.hideOtherUnit()},t.prototype.frameMove=function(){n.prototype.frameMove.call(this)},t.prototype.onRobTaskResultGS2C=function(t){var e=this;f.MineIngManager.instance.endRobBattling(),t.win?(v.RoleCenter.instans.addInventoryToC(t.reward),console.log("GamePlayMine::onRobTaskResultGS2C:战胜"),_.AccountViewCtrl.ins.successFightEnd(t.reward,Laya.Handler.create(this,function(){null!=e._fightGroup&&(e._fightGroup.resetHP(),e._fightGroup.hideOtherUnit(),e.switchRole(!0))})),h.FE.addInventoryToCFloats(t.reward,!1,!0)):(console.log("GamePlayMine::onRobTaskResultGS2C:失败"),_.AccountViewCtrl.ins.failFightEnd(Laya.Handler.create(this,function(){e._fightGroup.resetHP(),e._fightGroup.hideOtherUnit(),e.switchRole(!0)})));var i=this._playerDic[this._pkTargetName];i&&this.removePlayerFG(i,!0),this._fightGroup.hideOtherUnit(),this.setMsgState(4)},t.prototype.releaseSkillHandler=function(t){this.releaseSkill(t,this._pkTargetName)},t.prototype.updateWorkerInfo=function(){if(!this._loadingKey){console.log("GamePlayTest::updateWorkerInfo");var t=f.MineIngManager.instance.escortTaskUserDataGS2C,e=f.MineIngManager.instance.escortTaskListGS2C;if(e){var i=null,n=0;for(n=0;n<this._mineNpcList.length;n++)(i=this._mineNpcList[n]).useKey=!1;var s=null,o=f.MineIngManager.instance.getSceneLevel()*f.MineIngManager.instance.GetDarConfig().displayCount,a=f.MineIngManager.instance.getCurrScenePeople(),r=0,l=[],h=void 0;for(n=o;n<o+a;n++){if(s=e.inEscortTaskList[n],i=this.findNpc(s,r),r++,i){i.endTime=s.endtime;var c=i.endTime-y.ServerTime.serverTime,u=!1;(s.username==v.RoleCenter.instans.self.username||t.canRobOtherTimes<=0)&&(u=!0),i.setHeadState(f.MineIngManager.instance.getRobState(s),u),f.MineIngManager.instance.getDartVoByQuality(s.quality)?i.setHeadName(f.MineIngManager.getWorkerDesc(s)):i.setHeadName(E.TextConst.get(440,s.userNick)),i.setHeadBlood(C.DateUtil.getMinStr1(c))}if(s&&s.username!=v.RoleCenter.instans.self.username)1==f.MineIngManager.instance.getRobState(s)&&((h=new T.MinePlayerVo).job=s.job,h.sex=s.sex,h.minerQuality=s.quality,h.nickName=s.userNick,h.endtime=s.endtime,l.push(h))}for(n=0;n<this._mineNpcList.length;n++)(i=this._mineNpcList[n]).useKey||(g.LayerManager.fightLayer.removeUnit(i),i.destory(),this._mineNpcList.splice(n,1),n--);d.E.ins.event(p.EventName.MINER_LIST_CHANGED,[l])}}},t.prototype.updateNpcTime=function(){for(var t=null,e=0;e<this._mineNpcList.length;e++)if(t=this._mineNpcList[e]){var i=t.endTime-y.ServerTime.serverTime;i<0&&(i=0),t.setHeadBlood(C.DateUtil.getMinStr1(i))}},t.prototype.findNpc=function(t,e){for(var i,n=0;n<this._mineNpcList.length;n++)if(i=this._mineNpcList[n],t&&i.uId==t.username)return i.useKey=!0,i;var s=f.MineIngManager.instance.getDartVoByQuality(t.quality),o=4;this.mapVo.face&&0<this.mapVo.face.length?o=this.mapVo.face[e]:console.log("找不到朝向：index:"+e.toString());var a=s.maleNpcID;return t.sex==b.Sex.female&&(a=s.femaleNpcID),i=r.SceneObjCtroller.ins.createMineNPC(a,this.mapVo.monXY[e],this.mapVo.monXY[e],o,e),t&&(i.userNameStr=t.userNick,i.registerClickHandler(this,this.onNpcClickHandler,i.userNameStr)),g.LayerManager.fightLayer.addUnit(i),this._mineNpcList.push(i),i.useKey=!0,i},t.prototype.onNpcClickHandler=function(t){var e=null,i=null,n=f.MineIngManager.instance.escortTaskListGS2C;if(this._mineNpcList&&0<this._mineNpcList.length){for(var s=0;s<this._mineNpcList.length;s++)if((e=this._mineNpcList[s]).userNameStr==t){for(var o=0;o<n.inEscortTaskList.length;o++)if(t==(i=n.inEscortTaskList[o]).userNick){if(t==v.RoleCenter.instans.self.nickname)h.FE.upItems(E.TextConst.get(441),c.BubbleEnum.center);else if(f.MineIngManager.instance.escortTaskUserDataGS2C&&0<f.MineIngManager.instance.escortTaskUserDataGS2C.canRobOtherTimes)switch(e.robState){case 1:d.E.ins.event(p.EventName.showConPlunderView,i);break;case 2:h.FE.upItems(E.TextConst.get(442),c.BubbleEnum.center);break;case 3:h.FE.upItems(E.TextConst.get(443),c.BubbleEnum.center);break;case 4:h.FE.upItems(E.TextConst.get(444),c.BubbleEnum.center)}else h.FE.upItems(E.TextConst.get(445),c.BubbleEnum.center);break}break}}else console.log("error::GamePlayTest:onNpcClickHandler")},t.prototype.updateWoker=function(t,e){var i=new o.TakeEscortTaskC2GS;return 0<t?(i.refresh=!0,console.log("使用免费刷新")):e?(i.refreshByItem=!0,console.log("使用道具刷新")):(i.refreshByGold=!0,console.log("使用元宝刷新")),a.GSM.sendServer(i),i.refreshByItem?-1:0},t.prototype.heightFreshWoker=function(){var t=new o.TakeEscortTaskC2GS;t.refreshOnce=!0,a.GSM.sendServer(t)},t.prototype.startWork=function(){var t=new o.TakeEscortTaskC2GS;t.takeTask=!0,a.GSM.sendServer(t),S.GE.ins.event(15)},t.prototype.quickFinishTask=function(){var t=new o.TakeEscortTaskC2GS;t.goldFinish=!0,console.log("使用金币快速完成任务"),a.GSM.sendServer(t)},t.prototype.getMyRobRecord=function(){var t=new o.TakeEscortTaskC2GS;t.getMyRobRecord=!0,console.log("获取记录"),a.GSM.sendServer(t)},t.prototype.clear=function(){for(var t=null,e=0;e<this._mineNpcList.length;e++)(t=this._mineNpcList[e]).useKey||(g.LayerManager.fightLayer.removeUnit(t),t.destory());this._mineNpcList=null,a.GSM.ins.off(l.StartRobETaskGS2C.KEY,this,this.onStartRobETaskGS2C),f.MineIngManager.instance.gamePlayMine=null,f.MineIngManager.instance.mineAccountCtrl=null,d.E.ins.off(p.EventName.EXIT_BOSS_PLAYTYPE,this,this.exitHandler),this._nextPassGateUnit&&(this._nextPassGateUnit.destory(),this._nextPassGateUnit=null),this._prePassGateUint&&(this._prePassGateUint.destory(),this._prePassGateUint=null),n.prototype.clear.call(this),w.ClearResM.clearResFolder("wakuang/")},t.prototype.exitHandler=function(){f.MineIngManager.instance.isRobBattling()?h.FE.upItems(E.TextConst.get(446),c.BubbleEnum.center):(d.E.ins.off(p.EventName.PLAY_TYPE_CHANGED,this,this.onPlayTypeChanged),m.BtnSkiilCtrl.ins.setSkillBtnVisible(!0),this.returnAutoplayPort())},t}(i.GamePlay);e.GamePlayMine=n}),define("src/g/field/vo/RevengeVo",["require","exports","../../net/messages/ChangeSceneMsg","src/init/TextConst"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.getFightTitle=function(t){switch(t){case i.EPlayType.PLAYTYPE_REVENGE:return n.TextConst.get(393);case i.EPlayType.PLAYTYPE_PVP:return n.TextConst.get(394);case i.EPlayType.PLAYTYPE_COPYLADDER:return n.TextConst.get(395);case i.EPlayType.PLAYTYPE_FIGHTSC:return n.TextConst.get(396);case i.EPlayType.PLAYTYPE_SWBIQI:case i.EPlayType.PLAYTYPE_SWBIQIBOSS:return n.TextConst.get(397);case i.EPlayType.PLAYTYPE_MOSTVIPBOSS1:case i.EPlayType.PLAYTYPE_MOSTVIPBOSS2:case i.EPlayType.PLAYTYPE_MOSTVIPBOSS3:return n.TextConst.get(398);case i.EPlayType.PLAYTYPE_COMBOEXERCISE:return n.TextConst.get(399);case i.EPlayType.PLAYTYPE_ENTERMINE:return n.TextConst.get(402);case i.EPlayType.PLAYTYPE_QUANMINBOSS:return n.TextConst.get(400);case i.EPlayType.PLAYTYPE_ESCORT_PRISONER:return n.TextConst.get(401);case i.EPlayType.PLAYTYPE_ENTERMINE:return n.TextConst.get(402);case i.EPlayType.PLAYTYPE_SHENYUBOSS:return n.TextConst.get(403);case i.EPlayType.PLAYTYPE_MIJINGBOSS:return n.TextConst.get(404);case i.EPlayType.PLAYTYPE_FIMILYHELPREVENGE:return n.TextConst.get(1003);default:return n.TextConst.get(395)}},t}();e.RevengeVo=s}),define("src/g/fight/osprite/play/fieldrevenge/GamePlayFiledRevenge",["require","exports","src/g/fight/osprite/play/GamePlay","../../../../../manager/RoleCenter","../../../../../core/E","../../../../../enum/EventName","src/g/fight/osprite/SceneObjCtroller","src/g/fight/osprite/play/baseplay/SvrHeroUnit","src/g/fight/osprite/NetCtroller","../../../../net/messages/MeetPKC2GS","../../../../../manager/AM","src/g/account/ctrl/AccountViewCtrl","src/g/field/vo/RevengeVo","src/init/TextConst"],function(t,e,i,s,o,a,r,l,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t,e){var i=n.call(this,t)||this;return i._fightID=-1,i._finishRevengeCopy=!1,i._bossaccname="",e instanceof d.RevengeVo?i._reveData=e:(i._bossaccname=e,i._reveData=new d.RevengeVo,i._reveData.othervo=s.RoleCenter.instans.getOtherData(i._bossaccname)),i}return __extends(t,n),t.prototype.init=function(t){void 0===t&&(t=null),n.prototype.init.call(this,t),this._portData=this.scene.matCopy,this._revengeList=s.RoleCenter.instans.self.meetPkData.revengelist,this.initRevengeCopy(),o.E.ins.event(a.EventName.HITBOSS)},t.prototype.clear=function(){n.prototype.clear.call(this),this.bossGroup&&this.bossGroup.destroyGroup(!0),this.pickAllDropItem()},t.prototype.initRevengeCopy=function(){this.initHeroGroup(),this._reveData&&(this.createPkTargetGroup(),this._fightGroup.setFGTarget(this.bossGroup),this.fightStart())},t.prototype.initHeroGroup=function(){var t=r.SceneObjCtroller.ins.getSelfGroup();t.resetFightGroup(this.mapVo.startPoint[0]),this.setFightGroup(t),t.addToFightLayer()},t.prototype.createPkTargetGroup=function(){this.bossGroup=l.SvrHeroUnit.createFightGroup(this._reveData.othervo,this.mapVo.bossXY[0],!0,!1,!0),this._fightGroup.setFGTarget(this.bossGroup),this.addPlayerFG(this.bossGroup),this._bossaccname=this._reveData.othervo.username,this._reveData.othervo.vipLv&&this.bossGroup.getFUList()[0].showOff()},t.prototype.fightStart=function(t){void 0===t&&(t=!0),h.NetCtroller.meetPkStart(this._reveData.othervo.username,this._reveData.othervo.nickname,this._reveData.othervo.getCurLv(),c.EMPKTYPE.revenge)},t.prototype.onReceiveFightStart=function(t){n.prototype.onReceiveFightStart.call(this,t),t.opresult?(this._fightReward=t.inventory,this._fightID=t.fightid):(u.AM.show(g.TextConst.get(433,t.error)),this.returnAutoplayPort())},t.prototype.deleteRevengeData=function(){for(var t=s.RoleCenter.instans.vo.meetPkData.revengelist,e=0;e<t.length;e++){if(t[e].otherUsername==this._bossaccname){t.splice(e,1);break}}},t.prototype.onReceiveFightEnd=function(t){var e=this;t.fightid==this._fightID&&(n.prototype.onReceiveFightEnd.call(this,t),t.opresult?(this.deleteRevengeData(),p.AccountViewCtrl.ins.successFightEnd(this._fightReward,Laya.Handler.create(this,function(){e.returnAutoplayPort()}))):p.AccountViewCtrl.ins.failFightEnd(Laya.Handler.create(this,function(){e.returnAutoplayPort()})))},t.prototype.frameMove=function(){n.prototype.frameMove.call(this)},t.prototype.onHpChg=function(t){n.prototype.onHpChg.call(this,t);var e=this.bossGroup;e&&!t.beAttack&&e.getUnitByIndex(t.beAttackHidx).svrSetHP(t.hpAfterAttack[t.beAttackHidx])},t.prototype.releaseSkillHandler=function(t){this.releaseSkill(t,this._bossaccname)},t}(i.GamePlay);e.GamePlayFiledRevenge=n}),define("src/g/fight/osprite/play/hangup/plus/BaseFight",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t){this.play=t},t.prototype.sendfightStart=function(t){console.error("必须复写函数")},t.prototype.onReceiveFightStart=function(t){console.error("必须复写函数")},t.prototype.onreceiveFightEnd=function(t){console.error("必须复写函数")},t.prototype.sendfightEnd=function(){console.error("必须复写函数")},t.prototype.onAttackMsg=function(t){console.error("必须复写函数")},t.prototype.onUserHPChg=function(t){console.error("必须复写函数")},t.prototype.onHpChg=function(t){console.error("必须复写函数")},t.prototype.releaseSkillHandler=function(t){console.error("必须复写函数")},t.prototype.onComboHit=function(t){console.error("必须复写函数")},t.prototype.frameMove=function(){},t.prototype.clear=function(){console.error("必须复写函数")},t.prototype.monsterVisible=function(t){},t.prototype.npcVisible=function(t){},t.prototype.otherPlayerVisible=function(t){},t}();e.BaseFight=i}),define("src/g/fight/osprite/play/hangup/plus/PVPFight",["require","exports","src/g/fight/osprite/play/hangup/plus/BaseFight","../../../../../../manager/RoleCenter","src/g/fight/osprite/play/baseplay/SvrHeroUnit","src/g/fight/osprite/NetCtroller","../../../../../net/messages/MeetPKC2GS","src/g/fight/osprite/SceneObjCtroller","src/g/account/ctrl/AccountViewCtrl","src/g/fight/osprite/SceneObjManager","../../../../../../core/E","../../../../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../../../net/messages/ChangeSceneMsg","../../../../../../utils/DropUtil","../../../../../../manager/AM","src/g/fight/manager/ItemManager","src/init/TextConst"],function(t,e,i,s,o,n,a,r,l,h,c,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=function(e){function t(){var t=e.call(this)||this;return t._bossaccname="",t}return __extends(t,e),t.prototype.init=function(t){this.play=t,this.mapVo=t.mapVo,this.initself(),this.play.setJoinSkill()},t.prototype.initself=function(){var t=r.SceneObjCtroller.ins.getSelfGroup();t.resetFightGroup(this.play.mapVo.startPoint[1]),r.SceneObjCtroller.ins.self.removeWeaponEff(),t.stand(),this.play.setFightGroup(t)},t.prototype.sendfightStart=function(t){c.E.ins.event(u.EventName.COMPLETE_MEETPK,null),g.DropUtil.isfly=!0,this._bossaccname=t;var e=s.RoleCenter.instans.getOtherData(t);if(e)var i=o.SvrHeroUnit.createFightGroup(e,this.mapVo.npcXY[0],!0,!1,!0);else{var n=s.RoleCenter.instans.self;i=o.SvrHeroUnit.createFightGroup(n,this.mapVo.npcXY[0],!0,!1,!0)}i.addToFightLayer(),this.play.addPlayerFG(i),e.vipLv&&i.getFUList()[0].showOff(),s.RoleCenter.instans.vo.VIP&&r.SceneObjCtroller.ins.self.showOff(),this.play.fightGroup.addToFightLayer(),this.play.fightGroup.setOnceTarget(i),Laya.timer.loop(10,this,this.checkWayHandler)},t.prototype.checkWayHandler=function(){var t=r.SceneObjCtroller.ins.self;if(t&&t.ways.length<=1){Laya.timer.clear(this,this.checkWayHandler),this.play.playerDic[this._bossaccname].setOnceTarget(this.play.fightGroup);var e=s.RoleCenter.instans.getOtherData(this._bossaccname);e?n.NetCtroller.meetPkStart(e.username,e.nickname,e.getCurLv(),a.EMPKTYPE.meetuser):this.play.returnAutoplayPort()}},t.prototype.onReceiveFightStart=function(t){if(!t.opresult)return v.AM.show(y.TextConst.get(930,t.error)),void c.E.ins.event(u.EventName.PLAY_TYPE_CHANGE,p.PlayTypeVo.create(d.EPlayType.PLAYTYPE_PORT));var e=s.RoleCenter.instans.vo.meetPkData.pkuserlist,i=e.indexOf(this._bossaccname);-1<i&&e.splice(i,1),this._fightReward=t.inventory},t.prototype.onreceiveFightEnd=function(t){var e=this;if(t.opresult){var i=f.ItemManager.getDropArray(this._fightReward),n=this.play.fightGroup.getFUList()[0];4<n.face||(n=this.play.playerDic[this._bossaccname].getFUList()[0]),g.DropUtil.createDrop(i,new Laya.Point(n.worldX,n.worldY)),console.log("PVP PK战斗结束"),this.play.fightGroup.setPITarget(h.SceneObjManager.instans.totalDrops),Laya.timer.once(3e3,this,function(){var t=this;s.RoleCenter.effectExpAndMoney(this._fightReward),l.AccountViewCtrl.ins.successFightEnd(this._fightReward,Laya.Handler.create(this,function(){t.play&&t.play.returnAutoplayPort()}))})}else l.AccountViewCtrl.ins.failFightEnd(Laya.Handler.create(this,function(){e.play&&e.play.returnAutoplayPort()}))},t.prototype.onAttackMsg=function(t){this.play.checkJoinSkill(t)},t.prototype.onUserHPChg=function(t){if(t.beAttackAcc)for(var e=null,i=this.play.playerDic[t.beAttackAcc],n=0;n<t.hpAfterAttack.length;n++)(e=i.getNoPetArr()[n])&&e.svrSetHP(t.hpAfterAttack[n])},t.prototype.onHpChg=function(t){var e=this.play.playerDic[t.beAttack];if(e){var i=e.getUnitByIndex(t.beAttackHidx);i&&i.svrSetHP(t.hpAfterAttack[t.beAttackHidx])}},t.prototype.releaseSkillHandler=function(t){this.play&&this.play.releaseSkill(t,this._bossaccname)},t.prototype.onComboHit=function(t){console.log(t,"合击技能");var e=this.play.playerDic[t.attackAcc];if(e){e.playJoinAttSkill(t);var i=this.play.playerDic[t.beAttackAcc];if(i)for(var n=null,s=0;s<t.hpAfterAttack.length;s++)(n=i.getNoPetArr()[s])&&n.svrSetHP(t.hpAfterAttack[s])}},t.prototype.clear=function(){this.play.fightGroup.setFGTarget(null),this.play.clearOtherPlayer(),this.play=null,Laya.timer.clearAll(this)},t}(i.BaseFight);e.PVPFight=m}),define("src/g/fight/osprite/play/hangup/plus/MeetBossFight",["require","exports","src/g/fight/osprite/play/hangup/plus/BaseFight","../../../../../../manager/RoleCenter","src/g/fight/osprite/NetCtroller","../../../../../net/messages/MeetPKC2GS","src/g/fight/osprite/SceneObjCtroller","src/g/account/ctrl/AccountViewCtrl","src/g/fight/osprite/SceneObjManager","../../../../../../core/E","../../../../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../../../net/messages/ChangeSceneMsg","src/g/fight/osprite/obj/FightGroup","src/g/fight/osprite/play/baseplay/SvrPeopleBossMonster","../../../../../../utils/ItemUtils","../../../../../../utils/DropUtil"],function(t,e,i,a,r,l,n,s,o,h,c,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(t){this.play=t,this.mapVo=t.mapVo,this.initself()},e.prototype.initself=function(){var t=n.SceneObjCtroller.ins.getSelfGroup();t.resetFightGroup(this.play.mapVo.startPoint[1]),t.addToFightLayer(),this.play.setFightGroup(t)},e.prototype.sendfightStart=function(t){void 0===t&&(t=""),f.DropUtil.isfly=!0;var e=a.RoleCenter.instans.self.meetPkData.meetBoss;this.bossGroup=new d.FightGroup(null);var i=new g.SvrPeopleBossMonster,n=v.ItemUtils.getPortVoById(e),s=v.ItemUtils.getMonsterVOById(n.boss);i.set_DATA(s),this.bossFightUnit=i,this.bossGroup.addFightUnit(i),this.bossGroup.resetFightGroup(this.mapVo.bossXY[0]),this.bossGroup.addToFightLayer(),this.play.fightGroup.setFGTarget(this.bossGroup),Laya.timer.once(2e3,this,function(){r.NetCtroller.meetPkStart(e+"",null,null,l.EMPKTYPE.meetboss)});var o=a.RoleCenter.instans.vo.portstatus.portindex;h.E.ins.event(c.EventName.CHALLENGEBOSS_START,{isBoss:!0,isPrivateBoss:!1,isMeetPK:!0,portId:o})},e.prototype.onReceiveFightStart=function(t){this._fightReward=t.inventory,this.bossGroup.assignMonsterDrop(t.inventory)},e.prototype.onreceiveFightEnd=function(t){h.E.ins.event(c.EventName.CHALLENGEBOSS_END,t),t.opresult?(this.play.fightGroup.setPITarget(o.SceneObjManager.instans.totalDrops),a.RoleCenter.instans.self.meetPkData.meetBoss=0,Laya.timer.loop(500,this,this.checkResult)):s.AccountViewCtrl.ins.failFightEnd(Laya.Handler.create(this,function(){h.E.ins.event(c.EventName.PLAY_TYPE_CHANGE,u.PlayTypeVo.create(p.EPlayType.PLAYTYPE_PORT))}))},e.prototype.checkResult=function(){o.SceneObjManager.instans.totalDrops.length<=0&&(Laya.timer.clear(this,this.checkResult),s.AccountViewCtrl.ins.successFightEnd(this._fightReward,Laya.Handler.create(this,function(){h.E.ins.event(c.EventName.PLAY_TYPE_CHANGE,u.PlayTypeVo.create(p.EPlayType.PLAYTYPE_PORT))})))},e.prototype.onAttackMsg=function(t){this.bossFightUnit.svrSetHP(t.hpAfterAttack[0])},e.prototype.onUserHPChg=function(t){console.log("血量变化")},e.prototype.onHpChg=function(t){if(t.beAttack){var e=this.play.fightGroup.getUnitByIndex(t.beAttackHidx);e&&e.svrSetHP(t.hpAfterAttack)}else this.bossFightUnit.svrSetHP(t.hpAfterAttack[0])},e.prototype.releaseSkillHandler=function(t){this.play&&this.play.releaseSkill(t,"")},e.prototype.onComboHit=function(t){t.beAttackAcc||this.play.fightGroup.playJoinAttSkill(t)},e.prototype.clear=function(){this.bossGroup.setFGTarget(null),this.play=null,this.bossGroup.destroyGroup(),this.bossFightUnit=null,this.bossGroup=null,Laya.timer.clearAll(this)},e}(i.BaseFight);e.MeetBossFight=y}),define("src/g/fight/osprite/play/hangup/plus/HangUpFight",["require","exports","src/g/fight/osprite/play/hangup/plus/BaseFight","src/g/fight/osprite/obj/FightGroup","src/g/fight/osprite/obj/MonsterUnit_New","../../../../../../utils/ItemUtils","../../../../../../manager/BulletManager","src/g/fight/osprite/NetCtroller","../../../../../../manager/RoleCenter","../../../../../../enum/EventName","../../../../../../core/E","src/g/fight/osprite/SceneObjManager","src/g/fight/osprite/SceneObjCtroller","src/g/index/ctrl/PortViewCtrl","../../../../../../utils/DropUtil","src/g/fight/osprite/map/MapCovert","src/g/fight/osprite/play/baseplay/SvrHeroUnit","../../../../../../core/GNet","../../../../../../config/GameConfig","src/g/proxy/AccessListenProxy"],function(t,e,i,l,h,c,u,n,s,o,a,r,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(e){function t(){var t=e.call(this)||this;return t._monsterList=[],t._pickItemKey=!1,t._total=2,t._timeCount=15,t.index=0,t.idx=0,t.step=1,t._count=0,t}return __extends(t,e),t.prototype.init=function(t){if(t.mapVo.startPoint[1]){this.play=t;var e=v.MapCovert.getMonsterPos(t.mapVo.startPoint[1][0],t.mapVo.startPoint[1][1],3);this._monXY=e.concat(e),this.initself(),this.initMonsterGroup(),g.DropUtil.isfly=!1,this._total=this._timeCount=this.play._portData.count||2,(new _.AccessListenProxy).checkAndListen(20,new Laya.Handler(this,this.countTimer))}},t.prototype.countTimer=function(){Laya.timer.loop(1e3,this,this.portVisible),this.portVisible()},t.prototype.portVisible=function(){this._timeCount--,this._timeCount<=0&&Laya.timer.clear(this,this.portVisible),d.PortViewCtrl.getins().setTimeCount(this._timeCount,this._total)},t.prototype.initself=function(){var t=p.SceneObjCtroller.ins.getSelfGroup();t.resetFightGroup(this.play.mapVo.startPoint[0]),t.addToFightLayer(),this.play.setFightGroup(t);var e=s.RoleCenter.instans.self.meetPkData;if(e)if(e.pkuserlist&&e.pkuserlist.length)var i=e.pkuserlist[0];else i=s.RoleCenter.instans.vo.username;else i=s.RoleCenter.instans.vo.username;if(s.RoleCenter.instans.vo.lvl<30)this.npcInit(i);else if(.5<Math.random()){if(50<s.RoleCenter.instans.vo.lvl)return;this.npcInit(i)}},t.prototype.npcInit=function(t){Laya.Render.isWebGL&&(y.GNet.getOtherData([t]),Laya.timer.once(3e3,this,this.npccreatHandler,[t]))},t.prototype.npccreatHandler=function(t){this._npc=new l.FightGroup("niubi");var e=s.RoleCenter.instans.vo.username,i=s.RoleCenter.instans.getOtherData(t);i&&(t==e&&(i.nickname=m.GameConfig.getRandomName(1),i.titleData.curTitle=[]),this._npc=f.SvrHeroUnit.createFightGroup(i,this.play.mapVo.startPoint[0]),this._npc.addToFightLayer(),this.creatNpcMonster(),this._npc.setFGTarget(this._npcMonster),this.play.addPlayerFG(this._npc),.5<Math.random()&&this._npc.getFUList()[0].showOff(),this._npc.limitDraw(!this.play.getOhterPlayerVisible(),!1))},t.prototype.creatNpcMonster=function(){this._npcMonster=new l.FightGroup("");for(var t=this.play._portData.monster,e=0;e<t.length;e++){var i=new h.MonsterUnit_New,n=c.ItemUtils.getMonsterVOById(t[e]);i.set_DATA(n),this._npcMonster.addFightUnit(i)}var s=this.getPos();this._npcMonster.addToFightLayer(),this._npcMonster.resetFightGroup([s[0],s[1]]),this._npcMonster.limitDraw(!this.play.getMonsterVisible(),!0),this.setMonsterHurtNum(this._npcMonster)},t.prototype.initMonsterGroup=function(){this.bossGroup&&this.bossGroup.destroyGroup(!0),this._monsterList.length,this._monsterList=[];var t=this.play._portData.monster,e=t.length;Laya.Render.isWebGL||(e=1);for(var i=null,n=0;n<e;n++){i=new l.FightGroup(null),this._monsterList.push(i);for(var s=0;s<e;s++){var o=new h.MonsterUnit_New,a=c.ItemUtils.getMonsterVOById(t[s]);o.set_DATA(a),i.addFightUnit(o),this.play&&i.limitDraw(!this.play.getMonsterVisible(),!0),o.viewDis=300,o.fightRealTimePathKey=!0}var r=this.getPos();i.addToFightLayer(),console.log(r,"坐标点"),i.resetFightGroup([r[0],r[1]]),this.setMonsterHurtNum(i)}Math.random()&&(this._monster=o).topHpBar.setTalk(u.BulletManager.createTalkPop()),this.bossGroup=this._monsterList[0],this.play.fightGroup.setFGTarget(this.bossGroup),this.fightStart()},t.prototype.resetPos=function(){this.index++,this.index>=this._monsterList.length&&(this.index=0);for(var t=0;t<this._monsterList.length;t++)if(this._monsterList[t].isAllDeathHide()){var e=this.getPos();this._monsterList[t].resetFightGroup([e[0],e[1]]),this._monsterList[t].setOnceTarget(this.play.fightGroup),this.setMonsterHurtNum(this._monsterList[t])}this.bossGroup=this._monsterList[this.index],this.play.fightGroup.setFGTarget(this.bossGroup)},t.prototype.setMonsterHurtNum=function(t){for(var e=null,i=t.getCount(),n=0;n<i;n++){e=t.getUnitByIndex(n);var s=m.GameConfig.commonJson.killmonste;s&&e.setHurtNum(parseInt(s.value))}},t.prototype.getPos=function(){return this.idx>=this._monXY.length-1?this.step=-1:this.idx<=0&&(this.step=1),this.idx+=this.step,this._monXY[this.idx]},t.prototype.fightStart=function(){n.NetCtroller.fightStartC2GS(!1,this.play._portData.monster,this.play._portData.id)},t.prototype.sendfightStart=function(){},t.prototype.onReceiveFightStart=function(t){this.bossGroup&&(this._rewar&&(this._rewar.length=0),this.bossGroup.assignMonsterDrop(t.inventory),this._rewar=t.inventory)},t.prototype.frameMove=function(){null!=this.bossGroup&&this.bossGroup.isAllDeathHide()&&(this.fightEnd(),this.play.fightGroup.setFGTarget(null),this.bossGroup.resetFightGroup(this.getPos()),this.bossGroup.setOnceTarget(this.play.fightGroup),this.setMonsterHurtNum(this.bossGroup),this.bossGroup=null,this.play.fightGroup.setPITarget(r.SceneObjManager.instans.totalDrops),this._pickItemKey=!0),this._npcMonster&&this._npcMonster.isAllDeathHide()&&(this._npcMonster.resetFightGroup(this.getPos()),this.setMonsterHurtNum(this._npcMonster)),this._pickItemKey&&r.SceneObjManager.instans.totalDrops.length<=0&&(this._pickItemKey=!1,this.resetMonsterAndFigth(),this.play.fightGroup.resetHP(),this._rewar=null),this._count++,this._monster&&this._monster.isDeath()&&100<this._count&&(this._count=0,this._monster.topHpBar&&this._monster.topHpBar.setTalk(u.BulletManager.createTalkPop()))},t.prototype.onreceiveFightEnd=function(){var t=s.RoleCenter.instans.self.portstatus;t.killMonsterGroups=this.play._portData.count,t.killMonsterGroups<this.play._portData.count&&t.killMonsterGroups++,a.E.ins.event(o.EventName.KILL_MONSTERWAVE,t.killMonsterGroups)},t.prototype.onComboHit=function(){},t.prototype.releaseSkillHandler=function(t){this.play&&this.play.releaseClientComboHit2(t)},t.prototype.resetMonsterAndFigth=function(){this._monXY.length&&(this.resetPos(),this.fightStart())},t.prototype.fightEnd=function(t){void 0===t&&(t=!0),2==this.play.getMsgState()?n.NetCtroller.fightEndC2GS(this.play._portData.id,this.play.scene.fightid,t):console.log("战斗消息绪列出错.")},t.prototype.clear=function(){if(Laya.timer.clearAll(this),this._monsterList)for(var t=0;t<this._monsterList.length;t++)this._monsterList[t].destroyGroup();this.play=null,this.bossGroup=null,this._monsterList=null,this._npc&&(this._npc.destroyGroup(),this._npc=null),this._npcMonster&&(this._npcMonster.destroyGroup(!0),this._npcMonster=null)},t.prototype.monsterVisible=function(t){for(var e=0;e<this._monsterList.length;e++)this._monsterList[e].limitDraw(!t,!0);this._npcMonster&&this._npcMonster.limitDraw(!t,!0)},t.prototype.npcVisible=function(){},t.prototype.otherPlayerVisible=function(t){this._npc&&this._npc.limitDraw(!t,!0)},t}(i.BaseFight);e.HangUpFight=C}),define("src/g/fight/osprite/play/hangup/GamePlayHangUp",["require","exports","src/g/fight/osprite/play/GamePlay","src/g/fight/osprite/play/PlayManager","src/g/fight/osprite/play/hangup/plus/PVPFight","src/g/fight/osprite/play/hangup/plus/MeetBossFight","src/g/fight/osprite/play/hangup/plus/HangUpFight","../../../../net/messages/ChangeSceneMsg","../../../../../manager/RoleCenter","../../../../../config/GameConfig","../../../../../manager/LayerManager","src/g/fight/osprite/SceneObjCtroller"],function(t,e,i,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t,e){var i=n.call(this,t)||this;return i.passData=e,t==l.EPlayType.PLAYTYPE_PVP?(i.pvpBaseFight=new o.PVPFight,i.currBaseFight=i.pvpBaseFight):t==l.EPlayType.PLAYTYPE_PORT?(i.hangupBaseFight=new r.HangUpFight,i.currBaseFight=i.hangupBaseFight):(i.meetBossBaseFight=new a.MeetBossFight,i.currBaseFight=i.meetBossBaseFight),i.isDestroySelfKey=!1,i.changeMap(h.RoleCenter.instans.self.portstatus.portindex),i}return __extends(t,n),t.prototype.changeMap=function(t){u.LayerManager.fightLayer.skilleffectLayer.removeChildren(),p.SceneObjCtroller.ins.getSelfGroup().removeWeaponEff(),u.LayerManager.fightLayer.popLayer.removeChildren();var e=c.GameConfig.getPortByID(t);e&&this.scene&&(null==this.scene.mapVo||this.scene.mapVo.id!=e.boss_scene?this.scene.changeMap(e.boss_scene):this.init(null))},t.prototype.init=function(t){void 0===t&&(t=null),n.prototype.init.call(this,t),s.PlayManager.loading=!1,this._portData=this.scene.port,this.initPlayPort();var e=h.RoleCenter.instans.vo.portstatus;e.inMainCity=!1,e.posX=0,e.posY=0},t.prototype.initPlayPort=function(){this.currBaseFight&&(this.currBaseFight.init(this),this.currBaseFight.sendfightStart(this.passData)),this.pickAllDropItem()},t.prototype.onReceiveFightStart=function(t){s.PlayManager.loading||(n.prototype.onReceiveFightStart.call(this,t),this._fightReward=t.inventory,this.currBaseFight.onReceiveFightStart(t))},t.prototype.onReceiveFightEnd=function(t){s.PlayManager.loading||(n.prototype.onReceiveFightEnd.call(this,t),this.currBaseFight.onreceiveFightEnd(t))},t.prototype.onAttackMsg=function(t){n.prototype.onAttackMsg.call(this,t),this.currBaseFight.onAttackMsg(t)},t.prototype.onUserHPChg=function(t){this.currBaseFight.onUserHPChg(t)},t.prototype.onHpChg=function(t){n.prototype.onHpChg.call(this,t),this.currBaseFight.onHpChg(t)},t.prototype.releaseSkillHandler=function(t){this.currBaseFight.releaseSkillHandler(t)},t.prototype.onComboHit=function(t){this.currBaseFight.onComboHit(t)},t.prototype.frameMove=function(){n.prototype.frameMove.call(this),this.currBaseFight&&this.currBaseFight.frameMove()},t.prototype.clear=function(){this.currBaseFight.clear(),n.prototype.clear.call(this)},t.prototype.monsterVisible=function(t){n.prototype.monsterVisible.call(this,t),this.currBaseFight&&this.currBaseFight.monsterVisible(t)},t.prototype.npcVisible=function(t){n.prototype.npcVisible.call(this,t),this.currBaseFight&&this.currBaseFight.npcVisible(t)},t.prototype.otherPlayerVisible=function(t){n.prototype.otherPlayerVisible.call(this,t),this.currBaseFight&&this.currBaseFight.otherPlayerVisible(t)},t.prototype.getMonsterVisible=function(){return this._monsterVKey},t.prototype.getNpcVisible=function(){return this._npcVKey},t.prototype.getOhterPlayerVisible=function(){return this._otherPVKey},t}(i.GamePlay);e.GamePlayHangUp=n}),define("src/g/fight/osprite/obj/MonsterNewVillage",["require","exports","src/g/fight/osprite/obj/MonsterUnit_New","../../../../manager/TaskManager","../../../../enum/Task","../../../../enum/EventName","../../../../core/E"],function(t,e,i,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t){void 0===t&&(t=!0);var e=n.call(this,t)||this;return e.beAttackState=!1,e.newUid=-1,e._sendFightEndKey=!1,e._surplus=0,e}return __extends(t,n),t.prototype.listenHp=function(t,e){this._surplus=t,this._hpBackFun=e},t.prototype.resetHpBar=function(){n.prototype.resetHpBar.call(this),0<this._surplus&&this.getHp()<this.getTotalHp()*this._surplus&&(this._surplus=0,this._hpBackFun&&(this._hpBackFun.run(),this._hpBackFun=null))},t.prototype.resetHP=function(){n.prototype.resetHP.call(this),this.topHpBar&&(this.topHpBar.visible=!0)},t.prototype.getViewRadius=function(){return 200},t.prototype.setFightTarget=function(t){n.prototype.setFightTarget.call(this,t),t||this.stand()},t.prototype.frameMove=function(t,e){if(-1!=this.newUid&&!this._sendFightEndKey&&this.isDeath()&&(null==this._dropArr||this._dropArr.length<=0)&&s.TaskManager.ins.currentTask&&s.TaskManager.ins.currentTask.type==o.TaskType.KillMonsters&&0<s.TaskManager.ins.currentTask.need){var i=this.newUid;r.E.ins.event(a.EventName.TASK_SEND_FIGHT_END,i),this._sendFightEndKey=!0}n.prototype.frameMove.call(this,t,e)},t}(i.MonsterUnit_New);e.MonsterNewVillage=n}),define("src/g/fight/osprite/play/GamePlayTask",["require","exports","src/g/fight/osprite/play/GamePlay","src/g/fight/osprite/map/MapCovert","src/g/fight/osprite/SceneObjCtroller","../../../../manager/LayerManager","../../../../config/GameConfig","src/g/fight/osprite/obj/FightGroup","../../../../manager/TaskManager","../../../../enum/EventName","../../../../core/E","../../../../enum/Task","src/g/fight/osprite/SceneObjManager","src/g/fight/osprite/NetCtroller","../../../../manager/RoleCenter","../../../../utils/ItemUtils","../../../../utils/DropUtil","../../../net/messages/UseItemC2GS","../../../../manager/GameSocketManager","../../../net/messages/ChangeSceneMsg","../../../net/messages/PutonEquipC2GS"],function(t,e,i,s,c,u,o,p,a,r,l,h,d,g,v,f,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n,b,w=function(n){function t(t){var e=n.call(this,t)||this;return e._monsterUnits=[],e._currTaskId=0,e._schedule=[],e._fightStartList=[],e._requestStartList=[],e._fightEndList=[],e._currStartMonId=0,e._currEndMonId=0,e}return __extends(t,n),t.prototype.init=function(t){void 0===t&&(t=null),n.prototype.init.call(this,t),this.initData(t),this.initNPC(),this.initMapMonster(),this.initSelfGroup(),this.initTask(),_.GSM.ins.on(Laya.Event.OPEN,this,this.onReConntent)},t.prototype.clear=function(){this.clearTask(),this.clearNPC(),this.clearMapMonster(),this.clearSelfGroup(),_.GSM.ins.off(Laya.Event.OPEN,this,this.onReConntent),n.prototype.clear.call(this)},t.prototype.onReConntent=function(t){if(t){var e=new C.ChangeSceneC2GS;e.playtype=this.type,_.GSM.sendServer(e)}},t.prototype.initData=function(t){void 0===t&&(t=null),this.npcs=s.MapCovert.parseToNumber(t.npc_id),this.monsters=s.MapCovert.parseToNumber(t.monstor_id),this.mapVo.startPoint=s.MapCovert.parseBySemicolon(t.player_bornplace),this.mapVo.monXY=s.MapCovert.parseBySemicolon(t.monstor_bornplace),this.mapVo.npcXY=s.MapCovert.parseBySemicolon(t.npc_bornplace),this.mapVo.taskXY=s.MapCovert.parseBySemicolon(t.task_place)},t.prototype.initNPC=function(){var t=0;for(this._npcArray=[],t=0;t<this.npcs.length;t++){var e=this._npcArray[t]=c.SceneObjCtroller.ins.createNPC(this.npcs[t],this.mapVo.npcXY[t],this.mapVo.taskXY[t],t+1);u.LayerManager.fightLayer.addUnit(e)}},t.prototype.clearNPC=function(){this.npcs=null;for(var t=0;t<this._npcArray.length;t++)this._npcArray[t]&&this._npcArray[t].destroyUnit();this._npcArray=[]},t.prototype.initMapMonster=function(){for(var t,e=0;e<this.monsters.length;e++)this.monsters[e]&&(t=this._monsterUnits[e]=c.SceneObjCtroller.ins.createNewVillageMon(this.monsters[e],this.mapVo.monXY[e],e+1),u.LayerManager.fightLayer.addUnit(t))},t.prototype.getMonsterIdByIndex=function(t){return this.monsters&&t<this.monsters.length?this.monsters[t]:0},t.prototype.getMonsterPosByIndex=function(t){return this.mapVo&&t<this.mapVo.monXY.length?this.mapVo.monXY[t]:null},t.prototype.clearMapMonster=function(){this.monsters=null;for(var t=0;t<this._monsterUnits.length;t++)this._monsterUnits[t]&&(this._monsterUnits[t].destroyUnit(),this._monsterUnits[t]=null);this._monsterUnits=[]},t.prototype.initSelfGroup=function(){var t=c.SceneObjCtroller.ins.getSelfGroup();t.addToFightLayer(),this.setFightGroup(t)},t.prototype.clearSelfGroup=function(){this._mainRole&&this._mainRole.setTargetSelEff(null)},t.prototype.initTask=function(){a.TaskManager.ins.currentTask&&c.SceneObjCtroller.ins.resetSelfGroupPos(this.getLastPosFromTask(a.TaskManager.ins.currentTask.id)),l.E.ins.on(r.EventName.CURRENT_TASK_CHANGE,this,this.onTaskUpdate),l.E.ins.on(r.EventName.AUTO_TASK_ACTIVE_CHANGE,this,this.onAutoTaskActiveChanged),this.onTaskUpdate()},t.prototype.clearTask=function(){this.breakCurrTask(),l.E.ins.off(r.EventName.CURRENT_TASK_CHANGE,this,this.onTaskUpdate),l.E.ins.off(r.EventName.AUTO_TASK_ACTIVE_CHANGE,this,this.onAutoTaskActiveChanged)},t.prototype.onAutoTaskActiveChanged=function(t){t?this.reStartCurrTask():this.breakCurrTask()},t.prototype.onTaskUpdate=function(){if(n.prototype.onTaskUpdate.call(this),this.task&&this.task.id!=this._currTaskId&&(this.breakCurrTask(),this._currTaskId=this.task.id,this._schedule.length=0,this._schedule.push(1)),a.TaskManager.ins.active){if(1900<=this.task.id&&this.type!=C.EPlayType.PLAYTYPE_MAINCITY)return;this.reStartCurrTask()}},t.prototype.breakCurrTask=function(){if(this._isRunTask){if(0<this._schedule.length)switch(this._schedule[0]){case 1:break;case 2:this.breakKillMonster();break;case 3:this.breakPickUp();break;case 4:this.breakMove();break;case 5:break;case 6:this.stopToNpc()}this._isRunTask=!1}},t.prototype.reStartCurrTask=function(){this._isRunTask||(this.doSth(),this._isRunTask=!0)},t.prototype.doSth=function(){if(0<this._schedule.length)switch(this._schedule[0]){case 1:this.readyTask();break;case 2:this.killMonster();break;case 3:this._tryNum=0,this.doPickUp();break;case 4:this.moveToPoint();break;case 5:this.createMonsters();break;case 6:this.talkingToNpc()}},t.prototype.readyTask=function(){this.task&&(this.task.type==h.TaskType.KillMonsters?this.readyKillMonTask():this.task.type==h.TaskType.Dialogue?this.readyDialogue():this.task.type==h.TaskType.pickUp?this.readyPickUp():this.task.type==h.TaskType.IntoAutoCopy&&Laya.timer.frameOnce(3,this,function(){l.E.ins.event(r.EventName.GUIDE_END)}),this.readCommonOp());var t=this._schedule.indexOf(1);-1!=t&&this._schedule.splice(t,1),this._schedule.sort(),this.doSth()},t.prototype.readCommonOp=function(){v.RoleCenter.instans.self.taskdata.need<this.task.need&&(this.task.cMonIds&&0<this.task.cMonIds.length&&this._schedule.push(5),this.task.movePos&&0<this.task.movePos.length&&this._schedule.push(4))},t.prototype.readyKillMonTask=function(){if(v.RoleCenter.instans.self.taskdata.need<this.task.need){var t,e=this.task.monsterIndexs,i=Math.min(e.length,this.task.need-v.RoleCenter.instans.self.taskdata.need);this._monsterGroup=new p.FightGroup(null);for(var n=0;n<i;n++){var s=e[n]-1;(t=this._monsterUnits[s]).newUid=this.monsters[s],this._monsterGroup.addFightUnit(t)}this._monsterGroup.resetHP(),this._monsterGroup.setVisible(!0),0<i&&this._schedule.push(2)}this.task.npcId&&this._schedule.push(6)},t.prototype.readyDialogue=function(){this.task&&this.task.npcId&&this.getNPCFromId(this.task.npcId)&&this._schedule.push(6)},t.prototype.readyPickUp=function(){if(this.task&&v.RoleCenter.instans.self.taskdata.need<this.task.need&&this.task.dropArr&&0<this.task.dropArr.length&&this.task.dropPos&&0<this.task.dropPos.length){for(var t,e,i=[],n=this.task.dropArr.length,s=0;s<n;){if(t=this.task.dropArr[s][0],1e4<parseInt(t)&&parseInt(t)<4e4){var o=f.ItemUtils.getEquipVoById(t);o&&o.job==v.RoleCenter.instans.vo.jobId&&(i.push(parseInt(t)),i.push(1))}else i.push(t),e=parseInt(this.task.dropArr[s][1]),i.push(e);s++}y.DropUtil.createDrop(i,new Laya.Point(this.task.dropPos[0],this.task.dropPos[1])),this.taskNeedPickItems=i.concat(),0<d.SceneObjManager.instans.totalDrops.length&&-1==this._schedule.indexOf(3)&&this._schedule.push(3)}},t.prototype.killMonster=function(){this._monsterGroup&&0<this._monsterGroup.getValidArr().length&&(l.E.ins.on(r.EventName.TASK_SEND_FIGHT_START,this,this.sendFightStart),l.E.ins.on(r.EventName.TASK_SEND_FIGHT_END,this,this.sendFightEnd),this._mainRole.setTargetSelEff("dynamic2/uieffect/EUI1_28.json"),this._fightGroup.setFGTarget(this._monsterGroup))},t.prototype.breakKillMonster=function(){this._fightGroup.setFGTarget(null),this._monsterGroup&&this._monsterGroup.setFGTarget(null),1==c.SceneObjCtroller.ins.self.status&&(c.SceneObjCtroller.ins.self.status=0),c.SceneObjCtroller.ins.self.ability.clearDelayAttack()},t.prototype.sendFightStart=function(t){this._fightStartList.push(t),this.doSendFightStart()},t.prototype.doSendFightStart=function(){0==this._currStartMonId&&0<this._fightStartList.length&&(this._currStartMonId=this._fightStartList[0],console.log("rFightStart"+this._currStartMonId),g.NetCtroller.fightStartC2GS(!1,[this._fightStartList[0]],this.scene.selfInfo.portstatus.portindex))},t.prototype.sendFightEnd=function(t){this._fightEndList.push(t),this.doSendFightEnd()},t.prototype.doSendFightEnd=function(){0==this._currEndMonId&&0<this._fightEndList.length&&(this._currEndMonId=this._fightEndList[0],-1==this._requestStartList.indexOf(this._currEndMonId)?(-1==this._fightStartList.indexOf(this._currEndMonId)&&this.sendFightStart(this._currEndMonId),this._currEndMonId=0):(console.log("rFightEnd"+this._currEndMonId),g.NetCtroller.fightEndC2GS(v.RoleCenter.instans.self.portstatus.portindex,this.scene.fightid,!0)))},t.prototype.onReceiveFightStart=function(t){if(n.prototype.onReceiveFightStart.call(this,t),t.opresult&&(this._fightReward=t.inventory,this._monsterGroup&&(this._monsterGroup.assignMonsterDrop(this._fightReward),(0<this._fightReward.currencyList.length||0<this._fightReward.itemList.length||0<this._fightReward.equipList.length)&&-1==this._schedule.indexOf(3)&&(this._schedule.push(3),this._schedule.sort())),0<this._currStartMonId)){var e=this._fightStartList.indexOf(this._currStartMonId);-1!=e&&this._fightStartList.splice(e,1),this._requestStartList.push(this._currStartMonId),console.log("backFightStart"+this._currStartMonId),this.doSendFightEnd(),this._currStartMonId=0,this.doSendFightStart()}},t.prototype.onReceiveFightEnd=function(t){if(n.prototype.onReceiveFightEnd.call(this,t),t.opresult){if(0<this._currEndMonId){var e=this._fightEndList.indexOf(this._currEndMonId);-1!=e&&this._fightEndList.splice(e,1),-1!=(e=this._requestStartList.indexOf(this._currEndMonId))&&this._requestStartList.splice(e,1),console.log("backFightEnd"+this._currEndMonId),this._currEndMonId=0,this.doSendFightEnd()}if(this.task.type==h.TaskType.KillMonsters&&(v.RoleCenter.instans.self.taskdata.need++,l.E.ins.event(r.EventName.TASK_KILL_PROGRESS)),a.TaskManager.ins.currentTask&&v.RoleCenter.instans.self.taskdata.need>=a.TaskManager.ins.currentTask.need){l.E.ins.off(r.EventName.TASK_SEND_FIGHT_START,this,this.sendFightStart),l.E.ins.off(r.EventName.TASK_SEND_FIGHT_END,this,this.sendFightEnd),this.fightEnd();var i=this._schedule.indexOf(2);-1!=i&&this._schedule.splice(i,1),this.doSth()}}this._fightGroup.resetHP()},t.prototype.fightEnd=function(){(this._fightReward&&0<this._fightReward.currencyList.length||0<this._fightReward.itemList.length)&&(this.effectExpAndMoney(this._fightReward),this._fightReward.clear()),this._monsterGroup=null,this._fightGroup.setFGTarget(null)},t.prototype.doPickUp=function(){0<d.SceneObjManager.instans.totalDrops.length?(this._tryNum=0,l.E.ins.on(r.EventName.PICK_ALL_FLYITEMS,this,this.pickAllDrops),l.E.ins.on(r.EventName.PICK_ALL_ITEM,this,this.pickAllDrops),y.DropUtil.isfly=!0,this._fightGroup.setPITarget(d.SceneObjManager.instans.totalDrops)):Laya.timer.once(300,this,this.tryAgainToDoPickUp)},t.prototype.tryAgainToDoPickUp=function(){if(this._tryNum++,2<this._tryNum){this._tryNum=0;var t=this._schedule.indexOf(3);-1!=t&&this._schedule.splice(t,1),this.doSth()}else this.doPickUp()},t.prototype.breakPickUp=function(){this._fightGroup.setPITarget(null)},t.prototype.pickAllDrops=function(){if(l.E.ins.off(r.EventName.PICK_ALL_FLYITEMS,this,this.pickAllDrops),l.E.ins.off(r.EventName.PICK_ALL_ITEM,this,this.pickAllDrops),this.task&&this.task.type==h.TaskType.pickUp){_.GSM.ins.on(m.GetItemMsg.KEY,this,this.onTaskPickUpBackHandler);for(var t,e,i=this.taskNeedPickItems?this.taskNeedPickItems.length:0,n=0;n<i;){t=this.taskNeedPickItems[n],n++,e=this.taskNeedPickItems[n],n++;var s=new m.GetItemMsg;s.cfgId=t,s.count=e,_.GSM.sendServer(s)}}else{-1!=(n=this._schedule.indexOf(3))&&this._schedule.splice(n,1),this.doSth()}},t.prototype.onTaskPickUpBackHandler=function(t){if(this.task&&this.task.type==h.TaskType.pickUp){for(var e,i,n=this.taskNeedPickItems?this.taskNeedPickItems.length:0,s=0,o=-1;s<n;){if(e=this.taskNeedPickItems[s],i=this.taskNeedPickItems[s+1],o=t.cfgId,1e4<t.cfgId&&(o=this.checkEquipAndPutOn(t.cfgId)),e==o){this.taskNeedPickItems.splice(s,2),0==this.taskNeedPickItems.length&&_.GSM.ins.off(m.GetItemMsg.KEY,this,this.onTaskPickUpBackHandler),v.RoleCenter.instans.self.taskdata.need+=i,l.E.ins.event(r.EventName.TASK_DATA_CHANGED);break}s+=2}if(v.RoleCenter.instans.self.taskdata.need>=this.task.need)_.GSM.ins.off(m.GetItemMsg.KEY,this,this.onTaskPickUpBackHandler),-1!=(s=this._schedule.indexOf(3))&&this._schedule.splice(s,1),this.doSth()}else _.GSM.ins.off(m.GetItemMsg.KEY,this,this.onTaskPickUpBackHandler)},t.prototype.checkEquipAndPutOn=function(t){var e=v.RoleCenter.instans.vo.bagdata.getEquip(t);if(e){var i=o.GameConfig.equipJSON[e.equtemplet];for(var n in o.GameConfig.blessJSON){var s=o.GameConfig.blessJSON[n];if(s.pos==i.pos){g.NetCtroller.putonEquipC2GS(t,0,s.pos),i.pos==I.EPosEquip.wuqi?(v.RoleCenter.instans.weaponID=i.weaponRes,l.E.ins.event(r.EventName.EQUIPS_PUTON+i.job+I.EPosEquip.wuqi,i.weaponRes)):i.pos==I.EPosEquip.yifu&&(v.RoleCenter.instans.roleID=i.roleRes,l.E.ins.event(r.EventName.EQUIPS_PUTON+i.job+I.EPosEquip.yifu,i.roleRes));break}}return e.equtemplet}return-1},t.prototype.talkingToNpc=function(){this.task&&(l.E.ins.on(r.EventName.TALK_TO_NPC_OVER,this,this.findTheNPC),this._fightGroup.setNPCTarget(this.getNPCFromId(this.task.npcId)))},t.prototype.stopToNpc=function(){l.E.ins.off(r.EventName.TALK_TO_NPC_OVER,this,this.findTheNPC),c.SceneObjCtroller.ins.self.ability.resetPrevPos()},t.prototype.findTheNPC=function(){l.E.ins.off(r.EventName.TALK_TO_NPC_OVER,this,this.findTheNPC),l.E.ins.event(r.EventName.POPTASK,this.task.npcId)},t.prototype.moveToPoint=function(){l.E.ins.on(r.EventName.SELF_UNIT_MOVE_END,this,this.onMoveEnd),c.SceneObjCtroller.ins.self.status=4,this._fightGroup.moveToPoint(this.task.movePos)},t.prototype.breakMove=function(){l.E.ins.off(r.EventName.SELF_UNIT_MOVE_END,this,this.onMoveEnd),this._fightGroup.moveStop()},t.prototype.onMoveEnd=function(){if(c.SceneObjCtroller.ins.self.worldX==this.task.movePos[0]&&c.SceneObjCtroller.ins.self.worldY==this.task.movePos[1]){l.E.ins.off(r.EventName.SELF_UNIT_MOVE_END,this,this.onMoveEnd);var t=this._schedule.indexOf(4);-1!=t&&this._schedule.splice(t,1),this.doSth()}},t.prototype.createMonsters=function(){var t,e=this._monsterUnits.length,i=this.task.cMonIds.length,n=0,s=[[1,-1],[1,1],[-1,1],[-1,-1],[0,-1],[1,0],[0,1],[-1,0]],o=0,a=c.SceneObjCtroller.ins.self,r=0,l=0,h=0;for(this._monsterGroup=new p.FightGroup(null);n<i;)h=n%2+1,r=s[o=n%8][0]*h,l=s[o][1]*h,t=this._monsterUnits[e]=c.SceneObjCtroller.ins.createNewVillageMon(this.task.cMonIds[n],[a.worldX+r,a.worldY+l],e),u.LayerManager.fightLayer.addUnit(t),t.newUid=this.task.cMonIds[n],this._monsterGroup.addFightUnit(t),e++,n++;this._monsterGroup.resetHP(),this._monsterGroup.setVisible(!0),-1!=(n=this._schedule.indexOf(5))&&this._schedule.splice(n,1),-1==this._schedule.indexOf(2)&&(this._schedule.push(2),this._schedule.sort()),this.doSth()},t.prototype.getNPCFromId=function(t){for(var e=0;e<this._npcArray.length;e++)if(this._npcArray[e].id==t)return this._npcArray[e];return null},t.prototype.getLastPosFromTask=function(t){var e=this.scene.mapVo.startPoint,i=a.TaskManager.ins.getPrevTaskNpc(t);return 0==i?e[0]:this.getNPCFromId(i).findNode},t.prototype.releaseSkillHandler=function(t){this.releaseClientComboHit(t)},t}(i.GamePlay);e.GamePlayTask=w,(b=n||(n={}))[b.ready=1]="ready",b[b.kill_mon=2]="kill_mon",b[b.pick_up=3]="pick_up",b[b.move_to=4]="move_to",b[b.create_mon=5]="create_mon",b[b.find_npc=6]="find_npc"}),define("src/g/fight/osprite/play/NewComerRobot",["require","exports","src/g/fight/osprite/obj/HeroUnit","../../../net/messages/sbkUserData","src/g/fight/osprite/obj/FightGroup","../../../../config/GameConfig","../../../../enum/Task","../../../../utils/ItemUtils","../../../net/messages/sbkHeroData","src/g/fight/osprite/map/MapCovert","../../../../manager/LayerManager","../../../../manager/GameSocketManager"],function(t,e,i,l,s,h,o,c,u,p,a,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function r(t,e){void 0===e&&(e=null);var i=n.call(this,e)||this;return i.robGroup=new s.FightGroup(null),i.monGroup=new s.FightGroup(null),i.udata=null,i.startTaskID=0,i.curTaskID=0,i._village=null,i._killMonState=!1,i._monTarget=null,i._deadMonTarget=null,i._mgr=t,i._killMonState=!1,i}return __extends(r,n),Object.defineProperty(r.prototype,"taskID",{get:function(){return this.curTaskID},enumerable:!0,configurable:!0}),r.prototype.frameMove=function(t,e){if(n.prototype.frameMove.call(this,t,e),this._mgr.running){if(this._killMonState&&this.monGroup.isVanishDeath()){this.recoverMonsters();var i=h.GameConfig.getNPCVoByTaskID(this.curTaskID);this.talkingToNpc(i.NpcID),this._killMonState=!1}}else this.destroyUnit()},r.prototype.onMoveEnd=function(){if(this._mgr&&this._mgr.running){var t=h.GameConfig.taskJSON[this.curTaskID];t.type==o.TaskType.pickUp?this.worldX==t.dropPos[0]&&this.worldY==t.dropPos[1]&&this.moveNextTask():1900==this.curTaskID?this._passDoorPos&&0<this._passDoorPos.length&&this.worldX==this._passDoorPos[0][0]&&this.worldY==this._passDoorPos[0][1]&&this.moveNextTask():this.ability.checkNearNpc()}},r.prototype.talkingToNpc=function(t){this.robGroup.setNPCTarget(this._village.getNPCFromId(t))},r.prototype.moveNextTask=function(){var t=this;if(d.GSM.connected){var e=h.GameConfig.taskJSON[this.curTaskID],i=h.GameConfig.taskJSON[e.follow];e.type==o.TaskType.pickUp&&this.processTaskBonus(e.dropArr),Laya.timer.once(1e3,this,function(){t.destoryed||(t.processTaskBonus(e.bonus),t.curTaskID=i.id,t.onTaskChange(t.curTaskID))})}else d.GSM.ins.once(Laya.Event.OPEN,this,this.onReConntent)},r.prototype.onReConntent=function(t){t&&this.moveNextTask()},r.prototype.processTaskBonus=function(t){for(var e=0;e<t.length;e++){var i=t[e],n=parseInt(i[0]);if(n&&1e4<n){var s=c.ItemUtils.getEquipVoById(n),o=this.udata.openhero[0];if(s.job!=o.jobid)continue;o.equpos[s.pos-1].equins.equtemplet=s.id,this.resetEquipData();for(var a=0;a<s.prop.length;a++)o[s.prop[a][0]]+=s.prop[a][1]}}},r.prototype.recoverMonsters=function(){this.monGroup.destroyGroup(!1);for(var t=this._killMonsterList?this._killMonsterList.length:0,e=0;e<t;)this._mgr.recoverMonster(this._killMonsterList[e]),e++;this._killMonsterList=null},r.prototype.startKillMonster=function(){var e=this;if(this._mgr&&this._mgr.running){this.recoverMonsters(),this._killMonsterList=this._mgr.createKillMonster(this.curTaskID);for(var t=this._killMonsterList?this._killMonsterList.length:0,i=0;i<t;)this._killMonsterList[i].beAttackState=!0,this.monGroup.addFightUnit(this._killMonsterList[i]),i++;0<t?(this.robGroup.setFGTarget(this.monGroup),this._killMonState=!0):Laya.timer.once(2e3,this,function(){var t=h.GameConfig.getNPCVoByTaskID(e.curTaskID);e.talkingToNpc(t.NpcID),e._killMonState=!1})}},r.prototype.onTaskChange=function(t){var e=h.GameConfig.taskJSON[t];if(this._killMonState&&(this.recoverMonsters(),this.robGroup.setFGTarget(null),this._killMonState=!1),1850!=t)if(r.ENDMISSION<t)this.destroyUnit();else{if(1900==t)return this._passDoorPos=this._village.getPassDoorPos(),void(this._passDoorPos&&0<this._passDoorPos.length?this.robGroup.moveToPoint(this._passDoorPos[0]):this.moveNextTask());switch(e.type){case o.TaskType.KillMonsters:this.startKillMonster();break;case o.TaskType.Dialogue:this.talkingToNpc(e.npcId);break;case o.TaskType.pickUp:this.moveToDropPos(e.dropPos)}}else{var i=h.GameConfig.getNPCVoByTaskID(t);this.talkingToNpc(i.NpcID)}},r.prototype.moveToDropPos=function(t){t&&0<t.length&&this.robGroup.moveToPoint(t)},r.prototype.initRobotFromHero=function(t,e){var i=this;this._village=e,this.udata=l.sbkUserData.getins(),this.udata.copydata(t),this.udata.nickname=h.GameConfig.getRandomName(1);var n=this.udata.openhero[0];switch(n.jobid){case u.EnumJob.ZHANSHI:n.openSkill=[1];break;case u.EnumJob.FASHI:n.openSkill=[6];break;case u.EnumJob.DAOSHI:n.openSkill=[11]}n.sex=n.sex,this.initHeroData(n,t.JUNGONG,t.STORYEXP,this.udata.nickname,6),this.curTaskID=r.STARTMISSION;var s=this._village.getLastPosFromTask(r.STARTMISSION);Laya.timer.once(3e3,this,function(){i.destoryed||i.onTaskChange(i.curTaskID)});var o=(s=p.MapCovert.getFreePos(s))[0],a=s[1];this.setWorldXY(o,a),this.setAsShow(!0),this.stand(),this.robGroup.addFightUnit(this)},r.prototype.destroyUnit=function(){Laya.timer.clearAll(this),this._mgr.onRobotDestroy(),a.LayerManager.fightLayer.removeUnit(this),this.recoverMonsters(),this.udata.release(),n.prototype.destroyUnit.call(this),this.robGroup.destroyGroup(!1),this.monGroup.destroyGroup(!1),this._monTarget=null,this._killMonState=!1,this._mgr=null},r.STARTMISSION=1e3,r.ENDMISSION=1900,r}(i.HeroUnit);e.NewComerRobot=n}),define("src/g/fight/osprite/play/RobotMgr",["require","exports","src/g/fight/osprite/play/NewComerRobot","../../../net/messages/sbkUserData","../../../../manager/RoleCenter","../../../../manager/LayerManager","../../../../manager/TaskManager","../../../../config/GameConfig","src/g/fight/osprite/map/MapCovert","src/g/fight/osprite/SceneObjCtroller","../../../../manager/GameSocketManager","../../../../enum/JobEnum"],function(t,e,n,s,o,a,r,h,c,l,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function i(){this._robotCount=0,this._village=null,this._userTemplet=new s.sbkUserData,this._monsterPool={},this.InPoolSign="__InPool"}return i.prototype.initRobotMgr=function(t){this.running=!0,this._userTemplet.copydata(o.RoleCenter.instans.self),this._village=t,n.NewComerRobot.STARTMISSION=r.TaskManager.ins.currentTask.id,this.addNewRob()},i.prototype.addNewRob=function(){if(u.GSM.connected){if(this._robotCount<i.MAX_ROBOTINSCENE){var t=new n.NewComerRobot(this),e=this._userTemplet.openhero[0].sex;e=e==p.Sex.female?p.Sex.male:p.Sex.female,this._userTemplet.openhero[0].sex=e,t.initRobotFromHero(this._userTemplet,this._village),a.LayerManager.fightLayer.addUnit(t),this._robotCount++}Laya.timer.once(1e3*(1+4*Math.random()),this,this.addNewRob)}else u.GSM.ins.once(Laya.Event.OPEN,this,this.onReConntent)},i.prototype.onReConntent=function(t){t&&this.addNewRob()},i.prototype.destroy=function(){this.running=!1,Laya.timer.clearAll(this),Laya.timer.once(4e3,this,this.clearAllMonsterPool)},i.prototype.onRobotDestroy=function(){this._robotCount--},i.prototype.createKillMonster=function(t){for(var e,i,n,s,o=h.GameConfig.taskJSON[t],a=0<o.monsterIndexs.length?1:0,r=0,l=[];r<a;)e=o.monsterIndexs[r],i=this._village.getMonsterIdByIndex(e-1),n=this._village.getMonsterPosByIndex(e-1),i&&n&&(n=c.MapCovert.getFreePos(n),s=this.popMonsterFromPool(i,n),l.push(s)),r++;return l},i.prototype.recoverMonster=function(t){t[this.InPoolSign]||(t[this.InPoolSign]=!0,this.getMonsterPoolById(t.monid).push(t))},i.prototype.getMonsterPoolById=function(t){return this._monsterPool[t]||(this._monsterPool[t]=[])},i.prototype.popMonsterFromPool=function(t,e){var i,n=this.getMonsterPoolById(t);return 0<n.length&&(i=n.pop()),i?(i.beAttackState=!1,i.resetUnit(e[0],e[1])):(i=l.SceneObjCtroller.ins.createNewVillageMon(t,e),a.LayerManager.fightLayer.addUnit(i)),i[this.InPoolSign]=!1,i},i.prototype.clearAllMonsterPool=function(){for(var t in this._monsterPool)for(var e=this._monsterPool[t],i=e.length,n=0;n<i;)e[n].destroyUnit(),n++;this._monsterPool={}},i.MAX_ROBOTINSCENE=10,i}();e.RobotMgr=i}),define("src/g/fight/osprite/play/GamePlayVillage",["require","exports","src/g/fight/osprite/play/GamePlayTask","src/g/fight/osprite/play/RobotMgr","../../../../manager/RoleCenter","src/g/fight/osprite/play/NewComerRobot","../../../../manager/TaskManager","../../../../component/JointAttackOpenDlg","../../../../core/E","../../../../enum/EventName","../../../../config/GameConfig","src/g/fight/osprite/obj/FightGroup","src/g/fight/osprite/play/RobotNpc","src/g/fight/osprite/SceneObjCtroller","src/init/GameState","../../../net/messages/ChangeSceneMsg","src/g/fight/osprite/obj/PassGateUnit","src/g/fight/osprite/SceneObjManager","src/g/fight/info/PlayTypeVo","src/g/fight/osprite/play/MainCityManager","src/g/index/ctrl/GameIndexCtrl","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var b=function(i){function t(t){var e=i.call(this,t)||this;return e._rNpcList=[],e}return __extends(t,i),t.prototype.init=function(t){void 0===t&&(t=null),i.prototype.init.call(this,t),this.initRobot(),this.initRobotNpc(),this.initPassGate(),g.GameState.clientChangeHp=!0,this._inited=!0},t.prototype.initPassGate=function(){this.mapVo.bossDoorXY&&this.mapVo.bossDoorXY.length&&(this.passItem=new f.PassGateUnit,this.passItem.setup(this.mapVo.bossDoorXY[0][0],this.mapVo.bossDoorXY[0][1],""))},t.prototype.clear=function(){this._robotMgr&&this._robotMgr.destroy();for(var t=this._rNpcList.length,e=0;e<t;)this._rNpcList[e].destroyUnit(),e++;this._rNpcList.length=0,this.passItem&&(y.SceneObjManager.instans.unregObject(this.passItem),this.passItem.destory(),this.passItem=null),l.E.ins.off(h.EventName.ROLE_HP_CHANGE,this,this.onHpChange),g.GameState.clientChangeHp=!1,i.prototype.clear.call(this),I.ClearResM.clearChengHao()},t.prototype.initRobot=function(){s.RoleCenter.instans.self.taskdata.taskid<o.NewComerRobot.ENDMISSION&&(this._robotMgr=new n.RobotMgr,this._robotMgr.initRobotMgr(this))},t.prototype.initRobotNpc=function(){var t;for(var e in c.GameConfig.robotNpcCfg){t=c.GameConfig.robotNpcCfg[e];var i=this.getNPCFromId(t.npcid);if(i){var n=new p.RobotNpc;n.initRobotFromHero(t,i.get_POS()),this.type==v.EPlayType.PLAYTYPE_MAINCITY?(n.face=8*Math.random()>>0,n.status=0,n.stand()):n.playMove()}}},t.prototype.createPkTargetGroup=function(t){this._pkTargetGroup=new u.FightGroup(null);var e=this.createSceneNPCFight(t,this.mapVo.startPoint[0],!0).npcData;if(this._pkTargetGroup.addFightUnit(e.player),e.otherUnit)for(var i=e.otherUnit,n=0;n<i.length;n++)this._pkTargetGroup.addFightUnit(i[n]);this._pkTargetGroup.addToFightLayer(),this._pkTargetGroup.resetFightGroup(this.mapVo.startPoint[0])},t.prototype.getRobKillMonster=function(t){return t<this._monsterUnits.length?this._monsterUnits[t]:null},t.prototype.getPassDoorPos=function(){return this.mapVo.bossDoorXY},t.prototype.onTaskUpdate=function(){i.prototype.onTaskUpdate.call(this),l.E.ins.off(h.EventName.TASK_KILL_PROGRESS,this,this.startGuide1),this.mon&&(this.mon.listenHp(0,null),this.mon=null),this.task&&(this.task&&this._inited&&1900==this.task.id&&(this.passItem?(l.E.ins.on(h.EventName.SELF_UNIT_MOVE_END,this,this.onMoveEndHandler),this._fightGroup.moveToPoint(this.mapVo.bossDoorXY[0]),g.GameState.transmitting=!0):l.E.ins.event(h.EventName.PLAY_TYPE_CHANGE,m.PlayTypeVo.create(v.EPlayType.PLAYTYPE_MAINCITY))),1850==this.task.id&&l.E.ins.on(h.EventName.ROLE_HP_CHANGE,this,this.onHpChange))},t.prototype.onHpChange=function(){var t=d.SceneObjCtroller.ins.getSelfGroup();if(t){var e=t.getPercentCountHp();e<=.4&&l.E.ins.event(h.EventName.DANGERSHOW),e<=.3&&(l.E.ins.off(h.EventName.ROLE_HP_CHANGE,this,this.onHpChange),g.GameState.clientChangeHp=!1,this.startGuide1())}},t.prototype.onMoveEndHandler=function(){d.SceneObjCtroller.ins.self.worldX==this.mapVo.bossDoorXY[0][0]&&d.SceneObjCtroller.ins.self.worldY==this.mapVo.bossDoorXY[0][1]&&(l.E.ins.off(h.EventName.SELF_UNIT_MOVE_END,this,this.onMoveEndHandler),Laya.timer.once(400,this,function(){g.GameState.transmitting=!1,_.MainCityManager.getInstance().ChangeToMainCity()}))},t.prototype.startGuide1=function(){a.TaskManager.ins.active=!1,g.GameState.joint_attack_guide_state=!0,l.E.ins.event(h.EventName.OPEN_JOINT_ATTACK_GUIDE,[null,r.JointAttackUIType.danti]),C.GameIndexCtrl.idxView.taskView&&(C.GameIndexCtrl.idxView.taskView.visible=!1)},t.prototype.startGuide2=function(){a.TaskManager.ins.active=!1,g.GameState.joint_attack_guide_state=!0,l.E.ins.event(h.EventName.JOINT_ATTACK_GUIDE,2)},t.prototype.startGuide3=function(){a.TaskManager.ins.active=!1,g.GameState.joint_attack_guide_state=!0,l.E.ins.event(h.EventName.JOINT_ATTACK_GUIDE,3)},t}(i.GamePlayTask);e.GamePlayVillage=b}),define("src/g/fight/osprite/play/gonghuiRevege/GamePlayGongHuiRevenge",["require","exports","../../../../net/messages/ManageFamilyMsg","src/g/fight/osprite/play/GamePlay","../../../../../manager/RoleCenter","../../../../../core/E","../../../../../enum/EventName","src/g/fight/osprite/SceneObjCtroller","src/g/fight/osprite/play/baseplay/SvrHeroUnit","../../../../../manager/AM","src/g/account/ctrl/AccountViewCtrl","../../../../../manager/GameSocketManager","src/g/field/vo/RevengeVo","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(n){function t(t,e){var i=n.call(this,t)||this;return i._fightID=-1,i._finishRevengeCopy=!1,i._bossaccname="",i._revegeID=0,i._bossaccname=e.otherUsername,i._revegeID=e.revegeid,i._reveData=new p.RevengeVo,i._reveData.othervo=s.RoleCenter.instans.getOtherData(i._bossaccname),i}return __extends(t,n),t.prototype.init=function(t){void 0===t&&(t=null),n.prototype.init.call(this,t),this._portData=this.scene.matCopy,this.initRevengeCopy(),o.E.ins.event(a.EventName.HITBOSS)},t.prototype.clear=function(){n.prototype.clear.call(this),this.bossGroup&&this.bossGroup.destroyGroup(!0),this.pickAllDropItem()},t.prototype.initRevengeCopy=function(){this.initHeroGroup(),this._reveData&&(this.createPkTargetGroup(),this.selfGroup.setFGTarget(this.bossGroup),Laya.timer.loop(10,this,this.checkWayHandler))},t.prototype.checkWayHandler=function(){this._mainRole.ways.length<=0&&(Laya.timer.clear(this,this.checkWayHandler),this.fightStart())},t.prototype.initHeroGroup=function(){this.selfGroup=r.SceneObjCtroller.ins.getSelfGroup(),this.selfGroup.resetFightGroup(this.mapVo.startPoint[0]),this.selfGroup.addToFightLayer(),this.setFightGroup(this.selfGroup),s.RoleCenter.instans.vo.VIP&&r.SceneObjCtroller.ins.self.showOff()},t.prototype.createPkTargetGroup=function(){this.bossGroup=l.SvrHeroUnit.createFightGroup(this._reveData.othervo,this.mapVo.bossXY[0],!0,!1,!0),this.selfGroup.setFGTarget(this.bossGroup),this.bossGroup.setFGTarget(this.selfGroup),this.addPlayerFG(this.bossGroup),this._bossaccname=this._reveData.othervo.username,this._reveData.othervo.vipLv&&this.bossGroup.getFUList()[0].showOff()},t.prototype.fightStart=function(t){void 0===t&&(t=!0);var e=new i.FHelpRevengeStartC2GS;e.id=this._revegeID,u.GSM.sendServer(e)},t.prototype.onReceiveFightStart=function(t){n.prototype.onReceiveFightStart.call(this,t),t.opresult?(this._fightReward=t.inventory,this._fightID=t.fightid):(h.AM.show(d.TextConst.get(433,t.error)),this.returnAutoplayPort())},t.prototype.onReceiveFightEnd=function(t){var e=this;t.fightid==this._fightID&&(n.prototype.onReceiveFightEnd.call(this,t),t.opresult?(o.E.ins.event(a.EventName.GongHuiFuChouWanCheng,{otherUsername:this._bossaccname,id:this._revegeID,resuult:!0}),c.AccountViewCtrl.ins.successFightEnd(this._fightReward,Laya.Handler.create(this,function(){e.returnAutoplayPort()}))):(o.E.ins.event(a.EventName.GongHuiFuChouWanCheng,{otherUsername:this._bossaccname,id:this._revegeID,resuult:!1}),c.AccountViewCtrl.ins.failFightEnd(Laya.Handler.create(this,function(){e.returnAutoplayPort()}))))},t.prototype.frameMove=function(){n.prototype.frameMove.call(this)},t.prototype.onHpChg=function(t){n.prototype.onHpChg.call(this,t);var e=this.bossGroup;e&&!t.beAttack&&e.getUnitByIndex(t.beAttackHidx).svrSetHP(t.hpAfterAttack[t.beAttackHidx])},t.prototype.releaseSkillHandler=function(t){this.releaseSkill(t,this._bossaccname)},t}(n.GamePlay);e.GamePlayGongHuiRevenge=g}),define("src/g/fight/osprite/play/GamePlayFamilyTask",["require","exports","src/g/fight/osprite/play/GamePlay","../../../../utils/ItemUtils","src/g/fight/osprite/SceneObjCtroller","../../../../core/E","../../../../enum/EventName","src/g/fight/osprite/NetCtroller","src/g/account/ctrl/AccountViewCtrl","src/g/fight/osprite/SceneObjManager","../../../../config/GameConfig","src/g/fight/osprite/map/MapConst","src/init/GameState","src/g/fight/manager/ItemManager","../../../../utils/DropUtil","src/g/clearRes/ClearResM","src/init/TextConst"],function(t,e,i,n,o,a,r,l,h,c,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(s){function t(t,e){var i=s.call(this,t)||this;return i._currMonsterFG=null,i._monsterGroupArr=[],i._fightID=-1,i._readySuccDlg=!1,i._exitByBtn=!1,i._startFrameKey=!1,i._selfDeadKey=!1,i._monsterDeadKey=!1,i._pickItemKey=!1,d.GameState.clientChangeHp=!0,i._portid=e?e.portid:21253,i}return __extends(t,s),t.prototype.init=function(t){void 0===t&&(t=null),s.prototype.init.call(this,t),this._portData=this.scene.port,a.E.ins.on(r.EventName.EXIT_BOSS_PLAYTYPE,this,this.onExitGamePlayHandler),this.initHeroGroup(),this.initMonsterGroup(),this._startFrameKey=!0,this.fightStart(),a.E.ins.event(r.EventName.INTO_GUIDE_COPY)},t.prototype.initHeroGroup=function(){var t=o.SceneObjCtroller.ins.getSelfGroup();t.resetFightGroup(this.mapVo.startPoint[0]);for(var e=t.getCount(),i=null,n=0;n<e;n++)(i=t.getUnitByIndex(n))&&i.setMapXY(this.mapVo.startPoint[0][0],this.mapVo.startPoint[0][1]);t.addToFightLayer(),this.setFightGroup(t)},t.prototype.initMonsterGroup=function(){var t=[],e=u.GameConfig.commonJson.familyTaskMonsterArr;if(e)for(var i=e.value.split(","),n=0;n<i.length;n++)t.push(parseFloat(i[n]));var s=this.mapVo.monXY,o=this.mapVo.face,a=[];for(n=0;n<this._portData.monster.length;n++)a.push(this._portData.monster[n]);a.push(this._portData.boss),this.createMonsterFGArr(a,t,s,o);for(n=0;n<this._monsterFGArr.length;n++)this._monsterGroupArr.push(this._monsterFGArr[n])},t.prototype.fightStart=function(){var t=n.ItemUtils.getPortVoById(this._portid);l.NetCtroller.fightStartC2GS(!0,t.boss,this._portid)},t.prototype.onReceiveFightStart=function(t){s.prototype.onReceiveFightStart.call(this,t),t.opresult?(this._fightReward=t.inventory,this._fightID=t.fightid):this.returnAutoplayPort()},t.prototype.fightEnd=function(t){void 0===t&&(t=!0),l.NetCtroller.fightEndC2GS(this._portid,0,t)},t.prototype.successDialog=function(){var t=this;this.splitFightReward(this._fightReward),h.AccountViewCtrl.ins.successFightEnd(this._fightReward,Laya.Handler.create(this,function(){t.returnAutoplayPort()}))},t.prototype.onReceiveFightEnd=function(t){var e=this;s.prototype.onReceiveFightEnd.call(this,t),t.opresult?(h.AccountViewCtrl.ins.successFightEnd(this._fightReward,Laya.Handler.create(this,this.sucessHandler)),this._fightReward&&(this.effectExpAndMoney(this._fightReward),this._fightReward.clear(),this._fightReward=null)):h.AccountViewCtrl.ins.failFightEnd(Laya.Handler.create(this,function(){e.returnAutoplayPort()}))},t.prototype.sucessHandler=function(){this.returnAutoplayPort()},t.prototype.releaseSkillHandler=function(t){this.releaseClientComboHit(t)},t.prototype.frameMove=function(){if(s.prototype.frameMove.call(this),this._mainRole&&this._mainRole.isDeath()&&this.switchRole(),this._startFrameKey){if(!this._selfDeadKey&&this._fightGroup.isDeath()&&(this.fightEnd(!1),this._selfDeadKey=!0),!this._monsterDeadKey&&(null==this._currMonsterFG||this._currMonsterFG.isDeath()))if(0<this._monsterGroupArr.length)this._currMonsterFG=this._monsterGroupArr.shift(),this._fightGroup.setFGTarget(this._currMonsterFG);else{this._pickItemKey=!0,this._monsterDeadKey=!0;var t=g.ItemManager.getDropArray(this._fightReward),e=this.mapVo.monXY[this.mapVo.monXY.length-1],i=Math.floor(e[0]/p.MapConst.MAP_TILED_W),n=Math.floor(e[1]/p.MapConst.MAP_TILED_W);v.DropUtil.createDrop(t,new Laya.Point(i,n)),this._fightGroup.setPITarget(c.SceneObjManager.instans.totalDrops)}this._pickItemKey&&0==c.SceneObjManager.instans.totalDrops.length&&(this.fightEnd(!0),this._pickItemKey=!1,this._startFrameKey=!1)}},t.prototype.clear=function(){s.prototype.clear.call(this),a.E.ins.off(r.EventName.EXIT_BOSS_PLAYTYPE,this,this.onExitGamePlayHandler),this._currMonsterFG=null,this._monsterGroupArr.length=0,this.pickAllDropItem(),d.GameState.clientChangeHp=!1,f.ClearResM.clearChengHao(),a.E.ins.event(r.EventName.POP_PHRASE,y.TextConst.get(434))},t.prototype.onExitGamePlayHandler=function(){this._exitByBtn=!0,a.E.ins.off(r.EventName.EXIT_BOSS_PLAYTYPE,this,this.onExitGamePlayHandler),this.returnAutoplayPort()},t}(i.GamePlay);e.GamePlayFamilyTask=s}),define("src/g/fight/osprite/play/mijing/MJBossVo",["require","exports","src/g/fight/osprite/play/baseplay/vo/WolrdBossVo"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(i.WolrdBossVo);e.MJBossVo=n}),define("src/g/fight/osprite/play/mijing/GamePlayMJBoss",["require","exports","../../../../../utils/system/FloatEffect","src/g/boss/view/AllPersonFightView","src/g/fight/osprite/play/allpeopleboss/GamePlayPeopleBoss","src/g/fight/osprite/NetCtroller","../../../../net/messages/ActivityMessage","../../../../../manager/RoleCenter","src/g/fight/osprite/play/mijing/MJBossVo","../../../../../plugin/view/ToolTip","src/init/TextConst","../../../../../utils/DropUtil","src/g/fight/manager/ItemManager"],function(t,e,n,s,i,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(i){function t(t,e){return i.call(this,t)||this}return __extends(t,i),t.prototype.initViewVo=function(){this.vo=new l.MJBossVo,this.vo.init(this.scene.getPortBossVo(),this.mapVo,this._portData);var t=s.AllPersonFightView.ins;t.roleName=r.RoleCenter.instans.vo.nickname,t.vo=this.vo,t.showView(a.EACT_TYPE.mijingBoss,this.vo.bossplayID,this._portData.boss[0],this._portData.id),this.initUIEvent()},t.prototype.onJoinInActMsg=function(t){this.updatePanelState(t),t.opresult?(this.initPlayers(t),r.RoleCenter.instans.vo.SECRETBOSSCOUNT--,t.acttype==a.EACT_TYPE.mijingBoss&&(s.AllPersonFightView.ins.Actid=t.actid),this.sendStartAttackC2GS()):(n.FE.upItems(c.TextConst.get(410),h.BubbleEnum.center),this.exitHandler(!1),console.error(t))},t.prototype.startBattle=function(){Laya.timer.loop(10,this,this.checkWaysHandler)},t.prototype.checkWaysHandler=function(){this._mainRole.ways.length<=1&&(Laya.timer.clear(this,this.checkWaysHandler),console.log("发送全民bossid-------",this.vo.bossplayID),o.NetCtroller.JoinInQMBossCopy(this.vo.bossplayID,a.EACT_TYPE.mijingBoss))},t.prototype.onActivityEndMsg=function(t){var e=t.inventory;u.DropUtil.isfly=!0,this.dropFly(p.ItemManager.getDropArray(e),this._fightGroup.getFUList()[0],t)},t.prototype.exitHandler=function(t){void 0===t&&(t=!0),t&&o.NetCtroller.ExitQMBossCopy(this.vo.bossplayID,a.EACT_TYPE.mijingBoss),this.returnAutoplayPort(),s.AllPersonFightView.ins.hideView()},t}(i.GamePlayPeopleBoss);e.GamePlayMJBoss=d}),define("src/g/fight/osprite/play/family/GamePlayCallBoss",["require","exports","src/g/fight/osprite/play/baseplay/SvrPeopleBossMonster","src/g/account/ctrl/AccountViewCtrl","src/g/fight/osprite/SceneObjManager","src/g/fight/osprite/NetCtroller","../../../../net/messages/ActivityMessage","src/g/fight/osprite/play/baseplay/WorldBossGamePlay","../../../../../manager/RoleCenter","../../../../../plugin/view/ToolTip","../../../../../utils/system/FloatEffect","../../../../../enum/EventName","../../../../../core/E","../../../../../manager/LayerManager","../../../../../manager/AM","src/g/fight/osprite/play/baseplay/vo/WolrdBossVo","../../../../../utils/ItemUtils","src/g/fight/osprite/obj/FightGroup","../../../../../config/GameConfig","src/init/TextConst"],function(t,e,s,i,o,a,r,n,l,h,c,u,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(n){function t(t,e){var i=n.call(this,t)||this;return i.cdcount=0,i._data=e,i.vo=new v.WolrdBossVo,d.LayerManager.closeGuidWin(),i._view=new ui.components.BossCallTimeUI,i}return __extends(t,n),t.prototype.init=function(t){void 0===t&&(t=null),n.prototype.init.call(this,t),this.vo.init(this.scene.getPortBossVo(),this.mapVo,f.ItemUtils.getPortVoById(this._data.portid)),this.initBossGroup(),this.initSelfGroup(),p.E.ins.on(u.EventName.EXIT_BOSS_PLAYTYPE,this,this.alertTip),this.startBattle()},t.prototype.initBossGroup=function(){this.bossGroup=new y.FightGroup("");for(var t=this.vo.portData.boss,e=0;e<t.length;e++){var i=new s.SvrPeopleBossMonster,n=f.ItemUtils.getMonsterVOById(t[e]);i.set_DATA(n),this.bossGroup.addFightUnit(i),this.bossUnit=i}this.bossGroup.resetFightGroup(this.vo.mapVo.bossXY[0]),this.bossGroup.addToFightLayer()},t.prototype.setBossOwnWithAcc=function(){this.bossGroup.setFGTarget(this._fightGroup)},t.prototype.onAttackMsg=function(t){n.prototype.onAttackMsg.call(this,t),this.checkSelfIsDead(),console.log("攻击消息")},t.prototype.startBattle=function(){Laya.timer.loop(10,this,this.checkWayHandler)},t.prototype.checkWayHandler=function(){this._mainRole.ways.length<=1&&(Laya.timer.clear(this,this.checkWayHandler),this.bossGroup.setOnceTarget(this._fightGroup),a.NetCtroller.JoinInQMBossCopy(this._data.bossuid,r.EACT_TYPE.fsummonBoss))},t.prototype.clear=function(){n.prototype.clear.call(this),this.bossGroup&&(this.bossGroup.destroyGroup(),this.bossGroup=null),this.pickAllDropItem(),p.E.ins.off(u.EventName.EXIT_BOSS_PLAYTYPE,this,this.alertTip),this._view&&this._view.destroy()},t.prototype.releaseSkillHandler=function(t){this._fightGroup.getFGTarget()&&this.releaseSkill(t,this._fightGroup.getFGTarget().groupID)},t.prototype.exitHandler=function(t){t&&a.NetCtroller.ExitQMBossCopy(this._data.bossuid,r.EACT_TYPE.fsummonBoss),p.E.ins.event(u.EventName.GUILD_CALLBOSS_FIGHTOVER),this.returnAutoplayPort()},t.prototype.alertTip=function(){g.AM.exitPlay(this.type,new Laya.Handler(this,function(){this.exitHandler(!0)}))},t.prototype.onJoinInActMsg=function(t){t.opresult?(d.LayerManager.closeAllPOPWindow(),this.vo.ownerAcc=t.bossOwner,this.initPlayers(t),this.bossGroup.setOnceTarget(this._fightGroup),Laya.stage.addChild(this._view),this._view.x=(Laya.stage.stage.width-this._view.width)/2,this._view.y=200,this.cdcount=m.GameConfig.commonJson.meetfighttime.value,this._view.timevale.value=this.cdcount--+"",Laya.timer.loop(1e3,this,this.delayHandler),this.sendStartAttackC2GS()):(console.log(t,"----------该Boss已被击杀------------"),c.FE.upItems(_.TextConst.get(410),h.BubbleEnum.center),this.returnAutoplayPort())},t.prototype.delayHandler=function(){this.cdcount,this.cdcount?this._view.timevale.value=this.cdcount--+"":Laya.timer.clear(this,this.delayHandler)},t.prototype.initPlayers=function(t){for(var e,i=t.otherUserList,n=i.length,s=0;s<n;s++){var o=i[s],a=o.username;this.vo.addPlayers(o),t.bossOwner==a?e=this.addAtherPlayerSbkOtherHeroData(o):this.addAtherPlayerSbkOtherHeroData(o)}e&&this.bossGroup.setOnceTarget(e),this.setBossOwnWithAcc(),this.vo.addPlayers(l.RoleCenter.instans.vo)},t.prototype.onOtherUserJoinMsg=function(t){if(t.opresult)for(var e=t.newuser,i=e.length,n=0;n<i;n++){var s=e[n];this.vo.addPlayers(s),this.addAtherPlayerSbkOtherHeroData(s)}},t.prototype.setFightTargetWithAcc=function(){},t.prototype.checkSelfIsDead=function(){!this._fightGroup||this._fightGroup.isDeath()},t.prototype.changeSelfHP=function(t){n.prototype.changeSelfHP.call(this,t),!this._fightGroup||this._fightGroup.isDeath()},t.prototype.changeBossHP=function(t){n.prototype.changeBossHP.call(this,t),t.hpPercent},t.prototype.onActivityEndMsg=function(t){this._fightReward=t.inventory,l.RoleCenter.instans.addInventoryToC(t.inventory),Laya.timer.loop(30,this,this.checkHandler,[t])},t.prototype.checkHandler=function(){this._view&&this._view.removeSelf(),o.SceneObjManager.instans.totalDrops.length<=0&&(Laya.timer.clearAll(this),i.AccountViewCtrl.ins.successFightEnd(this._fightReward,Laya.Handler.create(this,this.returnAutoplayPort)))},t.prototype.onUserExitMsg=function(t){n.prototype.onUserExitMsg.call(this,t),this.vo.removeAttPlayer(t.username)},t.prototype.frameMove=function(){n.prototype.frameMove.call(this)},t}(n.WorldBossGamePlay);e.GamePlayCallBoss=C}),define("src/g/fight/osprite/play/sandynight/SandyNightManager",["require","exports","../../../../net/messages/EnterMuSceneC2GS","../../../../../core/E","../../../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../../net/messages/ChangeSceneMsg","../../../../../meta/NightCitySettingVo","../../../../../config/GameConfig","../../../../../utils/system/FloatEffect","src/init/TextConst","../../../../../plugin/view/ToolTip","../../../../../manager/GameSocketManager","../../../../net/messages/SandyNightMsg","../../../../../manager/BulletManager","../../../../../manager/RoleCenter","../../../../../manager/AM","../../../../../utils/system/ServerTime","../../../../net/messages/ActivityMessage","../../../../net/messages/DeathAdditionBuffGS2C","src/g/fightactivity/ctrl/FightActivityCtrl"],function(t,e,s,o,a,i,n,r,l,h,c,u,p,d,g,v,f,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var I=function(){function t(){this.gamePlay=null,this._openKey=!1,this._startTime=-1,this._endTime=-1,this._enterTime=-1,this._actionEndTime=0,this._actionLeftTime=0,this._level=0,this._levelStartTime=0,this._levelEndTime=0,this._levelLeftTime=-1,this._teamInfo=[],this._personScore=0,this._scoreAwardVoArr=[],this.viewCtrl=null,this._nextBonusIndex=0,this._itemDataArr=[]}return t.getInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.enterGamePlay=function(t){this._nextBonusIndex=0,this.gamePlay=t,o.E.ins.event(a.EventName.SANDYCITYNIGHT_SCENE_PANEL);var e=p.GSM.ins;e.on(s.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C),e.on(d.SNStageStartGS2C.KEY,this,this.onSNStageStartGS2C),e.on(d.SNTeamInfoChgGS2C.KEY,this,this.onSNTeamInfoChgGS2C),e.on(d.SandyNightScoreGS2C.KEY,this,this.onSandyNightScoreGS2C),e.on(m.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),e.on(d.SandyNightScoreRank.KEY,this,this.onSandyNightScoreRank),e.on(_.DeathAdditionBuffGS2C.KEY,this,this.onDeathAdditionBuffGS2C),e.on(d.GetScoreBonusGS2C.KEY,this,this.onGetScoreBonusGS2C);var i=this.getSetting("port").value,n=this.gamePlay.getStartPoint();this.gamePlay.sendEnterMuSceneC2GS(!0,i,n[0],n[1]),Laya.timer.frameLoop(1,this,this.updateTime)},t.prototype.updateTime=function(){var t=this._levelEndTime-y.ServerTime.serverTime;this._levelLeftTime!=t&&(this._levelLeftTime=t,this.viewCtrl&&this.viewCtrl.updateLevelTime(this._levelLeftTime)),t=this._actionEndTime-y.ServerTime.serverTime,this._actionLeftTime!=t&&(this._actionLeftTime=t,this.viewCtrl&&this.viewCtrl.updateActionTime(this._actionLeftTime))},t.prototype.getActionLeftTime=function(){return this._actionLeftTime},t.prototype.exitGamePlay=function(){this.gamePlay=null;var t=p.GSM.ins;t.off(s.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C),t.off(d.SNStageStartGS2C.KEY,this,this.onSNStageStartGS2C),t.off(d.SNTeamInfoChgGS2C.KEY,this,this.onSNTeamInfoChgGS2C),t.off(d.SandyNightScoreGS2C.KEY,this,this.onSandyNightScoreGS2C),t.off(m.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),t.off(d.SandyNightScoreRank.KEY,this,this.onSandyNightScoreRank),t.off(_.DeathAdditionBuffGS2C.KEY,this,this.onDeathAdditionBuffGS2C),t.off(d.GetScoreBonusGS2C.KEY,this,this.onGetScoreBonusGS2C),Laya.timer.clear(this,this.updateTime),this._levelEndTime=0,this.viewCtrl&&(this.viewCtrl.exit(),this.viewCtrl=null),this._enterTime=y.ServerTime.serverTime+this.getSetting("reentercd").value},t.prototype.onEnterMuSceneGS2C=function(t){t.opresult?t.enter?this.gamePlay&&this.gamePlay.setMainRoleByMsg(t):this.gamePlay&&this.gamePlay.returnAutoplayPort():(this.gamePlay&&this.gamePlay.returnAutoplayPort(),h.FE.upItems(c.TextConst.showErrorInfo(t.error),u.BubbleEnum.center))},t.prototype.onSNStageStartGS2C=function(t){this._teamInfo=t.teamInfo,this._actionEndTime=t.actEndSec,this._levelStartTime=t.startSec,this._levelEndTime=t.stageEndSec,this._level=t.stageIdx,this._nextBonusIndex=t.scoreBonuxIdx,this.viewCtrl&&(this.viewCtrl.onCampChanged(),this.viewCtrl.onFuHuo()),this.updatePersonScore(t.mybaseScore),this.gamePlay&&this.gamePlay.onSNStageStartGS2C(t)},t.prototype.getLevel=function(){return this._level},t.prototype.getLevelLeftTime=function(){return this._levelLeftTime},t.prototype.onSandyNightScoreRank=function(t){for(var e=null,i=null,n=[],s=0;s<t.scoreRank.length;s++)e=t.scoreRank[s],(i={}).userName=e.username,i.nickName=e.nickname,i.score=e.scorenum,i.familyname=e.familyname,i.rankIdx=e.rankIdx,n.push(i);this._itemDataArr=n.sort(this.sortByRank),t.request?this.viewCtrl&&this.viewCtrl.onReceivedTotalRank(this._itemDataArr):this.updateRankScore(),this.updatePersonScore(t.myScore.scorenum)},t.prototype.sortByRank=function(t,e){return t.rankIdx-e.rankIdx},t.prototype.getRankData=function(){return this._itemDataArr},t.prototype.onSNTeamInfoChgGS2C=function(t){switch(this.gamePlay&&this.gamePlay.onSNTeamInfoChgGS2C(t),t.chgtype){case 1:this.addMember(t.teamid,t.username);break;case 2:this.removeMember(t.teamid,t.username)}},t.prototype.addMember=function(t,e){this._teamInfo[t].unamelist.push(e)},t.prototype.removeMember=function(t,e){var i=this._teamInfo[t].unamelist.indexOf(e);-1<i?this._teamInfo[t].unamelist.splice(i,1):console.error("队伍“{0}”找不到成员{1}".replace("{0}",t.toString()).replace("{1}",e))},t.prototype.onSandyNightScoreGS2C=function(t){var e=c.TextConst.getSCNSoreTextByType(t.scoreFrom)+t.scoreGet.toString();h.FE.upItems(e,u.BubbleEnum.center),this._personScore+=t.scoreGet,this.updatePersonScore(this._personScore);for(var i=null,n=0;n<this._itemDataArr.length;n++)if((i=this._itemDataArr[n]).userName==v.RoleCenter.instans.self.username){i.score=this._personScore;break}this.updateRankScore()},t.prototype.onDeathAdditionBuffGS2C=function(t){var e=t.ATT/100,i=t.DEF/100;this.viewCtrl&&this.viewCtrl.updateBuffInfo(e,i)},t.prototype.exitSandyNight=function(){if(this.gamePlay){var t=this.getSetting("port").value;this.gamePlay.sendEnterMuSceneC2GS(!1,t,0,0)}},t.prototype.checkIsEnter=function(){if(this._openKey){if(y.ServerTime.serverTime<this._endTime)return y.ServerTime.serverTime>=this._enterTime?2:1;this._openKey=!1}return 0},t.prototype.enterSandyNight=function(){if(!v.RoleCenter.instans.bagRoomEnough())return f.AM.showBagNotEnough(),!1;switch(this.checkIsEnter()){case 0:h.FE.upItems(c.TextConst.get(414),u.BubbleEnum.center);break;case 1:var t=this._enterTime-y.ServerTime.serverTime;h.FE.upItems(c.TextConst.get(467,t),u.BubbleEnum.center);break;case 2:o.E.ins.event(a.EventName.PLAY_TYPE_CHANGE,i.PlayTypeVo.create(n.EPlayType.PLAYTYPE_SANDYNIGHT))}},t.prototype.getSetting=function(t){var e=l.GameConfig.nightCitySettingVo[t];return e||(console.error("找不到数据:key="+t),new r.NightCitySettingVo)},t.prototype.getScoreRewardSeting=function(t){return 0==this._scoreAwardVoArr.length&&this.initScoreAwardVo(),-1<t&&t<this._scoreAwardVoArr.length?this._scoreAwardVoArr[t]:null},t.prototype.initScoreAwardVo=function(){var t=null;for(var e in l.GameConfig.nightCityRankVo)2==(t=l.GameConfig.nightCityRankVo[e]).type&&this._scoreAwardVoArr.push(t)},t.prototype.getScoreRewardVo=function(){return 0==this._scoreAwardVoArr.length&&this.initScoreAwardVo(),this._scoreAwardVoArr},t.prototype.onSandyNightStartGS2C=function(t){this._openKey=!0,g.BulletManager.addBroadcastById(t.startHornId),this._startTime=t.startTime,this._endTime=t.endTime,C.FightActivityCtrl.startActivity(n.EPlayType.PLAYTYPE_SANDYNIGHT,this._endTime)},t.prototype.onSandyNightStateGS2C=function(t){this._openKey=!0,this._startTime=t.startSec,this._endTime=t.endSec,this._enterTime=t.lastExitTime+this.getSetting("reentercd").value,C.FightActivityCtrl.startActivity(n.EPlayType.PLAYTYPE_SANDYNIGHT,this._endTime)},t.prototype.onSandyNightEndGS2C=function(t){this._openKey=!1,this.gamePlay&&this.gamePlay.returnAutoplayPort(),this.viewCtrl&&this.viewCtrl.onWarEnd(t),C.FightActivityCtrl.endActivtiy(n.EPlayType.PLAYTYPE_SANDYNIGHT)},t.prototype.reqScoreBouns=function(){var t=this.getScoreRewardSeting(this._nextBonusIndex);if(t){if(this._personScore>t.value){var e=new d.GetScoreBonusC2GS;return e.scoreIdx=this._nextBonusIndex,p.GSM.sendServer(e),!0}h.FE.upItems(c.TextConst.get(468),u.BubbleEnum.center)}else h.FE.upItems(c.TextConst.get(469),u.BubbleEnum.center),console.error(this._nextBonusIndex);return!1},t.prototype.onGetScoreBonusGS2C=function(t){t.opres?(this._nextBonusIndex++,v.RoleCenter.instans.addInventoryToC(t.invent),h.FE.addInventoryToCFloats(t.invent),this.viewCtrl&&this.viewCtrl.onGetRewardSuc(this._nextBonusIndex-1)):console.error(t.error)},t.prototype.isGetAllScoreReward=function(){return 6==this._nextBonusIndex},t.prototype.nextLevelRewardNeedScore=function(){return this.getScoreRewardSeting(this._nextBonusIndex).value},t.prototype.showDeadAlert=function(t){this.viewCtrl&&this.viewCtrl.onDeath(t,new Laya.Handler(this,this.onMoneyLife))},t.prototype.onReLife=function(){this.sendRebord(!0)},t.prototype.onMoneyLife=function(){var t=this.getSetting("buyRebornCdCost").value;v.RoleCenter.instans.self.GOLD<t?h.FE.upItems(c.TextConst.get(460),u.BubbleEnum.center):this.sendRebord(!1)},t.prototype.sendRebord=function(t){if(this.gamePlay){var e=null,i=new m.ActivityRebirthC2GS;i.acttype=m.EACT_TYPE.sandynight,e=(i.freeRebirth=t)?this.gamePlay.getStartPoint():this.gamePlay.getSelfPos(),i.posx=e[0],i.posy=e[1],p.GSM.sendServer(i)}else console.error("不在玩法中")},t.prototype.onActivityRebirthGS2C=function(t){this.gamePlay&&this.gamePlay.onActivityRebirthGS2C(t),t.opresult?t.userAcc==v.RoleCenter.instans.self.username&&(v.RoleCenter.instans.vo.GOLD-=t.decGold,this.viewCtrl&&this.viewCtrl.onFuHuo()):console.error(t.error)},t.prototype.updateRankScore=function(){this.viewCtrl&&this.viewCtrl.updateRankData(this._itemDataArr)},t.prototype.updatePersonScore=function(t){this._personScore=t,this.viewCtrl&&this.viewCtrl.updatePersonScore(t)},t._instance=null,t}();e.SandyNightManager=I}),define("src/g/fight/osprite/play/sandynight/GamePlaySandyNight",["require","exports","../../../../../core/E","../../../../../enum/EventName","src/g/fight/osprite/play/sandynight/SandyNightManager","src/g/fight/osprite/play/RealTimeBossScene","../../../../../manager/AM","../../../../../manager/RoleCenter","../../../../../utils/system/FloatEffect","../../../../../plugin/view/ToolTip","src/init/TextConst"],function(t,e,s,o,a,i,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t){var e=n.call(this,t)||this;e._selfCampId=-1;var i=a.SandyNightManager.getInstance().getSetting("port").value;return e.createAreaMatrixList(i),s.E.ins.on(o.EventName.EXIT_BOSS_PLAYTYPE,e,e.onExitHandler),e.enablePK(!0),a.SandyNightManager.getInstance().enterGamePlay(e),e}return __extends(t,n),t.prototype.clear=function(){n.prototype.clear.call(this),s.E.ins.off(o.EventName.EXIT_BOSS_PLAYTYPE,this,this.onExitHandler),a.SandyNightManager.getInstance().exitGamePlay()},t.prototype.init=function(t){n.prototype.init.call(this,t)},t.prototype.frameMove=function(){n.prototype.frameMove.call(this)},t.prototype.showDeadAlert=function(t,e){n.prototype.showDeadAlert.call(this,t,e),a.SandyNightManager.getInstance().showDeadAlert(e)},t.prototype.onActivityRebirthGS2C=function(t){this.resetHero(t.userAcc,t.posx,t.posy);var e=this._playerDic[t.userAcc];e?this.updateColor(e):console.error("找不到复活的角色：userName="+t.userAcc),n.prototype.onActivityRebirthGS2C.call(this,t)},t.prototype.onExitHandler=function(){r.AM.exitPlay(this.type,new Laya.Handler(this,function(){this.executeExit()}))},t.prototype.executeExit=function(){a.SandyNightManager.getInstance().exitSandyNight()},t.prototype.getStartPoint=function(){return this.getCoordinatePos(this.matrixList[0])},t.prototype.onSNStageStartGS2C=function(t){this.clearAllState();for(var e=null,i=null,n=t.teamInfo,s=0;s<n.length;s++){i=n[s];for(var o=0;o<i.unamelist.length;o++)(e=i.unamelist[o])==l.RoleCenter.instans.self.username&&(this._selfCampId=i.teamid)}for(s=0;s<n.length;s++){i=n[s];for(o=0;o<i.unamelist.length;o++)e=i.unamelist[o],this.allocationCamp(e,i.teamid)}var a=null,r=null;for(s=0;s<t.userPosArr.length;s++)r=t.userPosArr[s],(a=this._playerDic[r.username]).resetHP(),a.setMapXY(r.posx,r.posy),this.setHeroPos(r.username,r.posx,r.posy)},t.prototype.onSNTeamInfoChgGS2C=function(t){1==t.chgtype&&this.allocationCamp(t.username,t.teamid)},t.prototype.allocationCamp=function(t,e){var i=this._playerDic[t];i?(i.campId=e,i.campId!=this._selfCampId&&this.addEnemy(i),this.updateColor(i)):console.error("要分配阵营的角色找不到：userName = "+t)},t.prototype.updateColor=function(t){t.setCampType(t.campId==this._selfCampId)},t.prototype.addEnemy=function(t){n.prototype.addPPlayer.call(this,t)},t.prototype.onSelectPkTarget=function(t){var e=this._playerDic[t];e&&(-1==e.campId?(h.FE.upItems(u.TextConst.get(420),c.BubbleEnum.center),console.error("对方没有阵营:username:"+t)):e.campId!=this._selfCampId?n.prototype.onSelectPkTarget.call(this,t):h.FE.upItems(u.TextConst.get(421),c.BubbleEnum.center))},t}(i.RealTimeBossScene);e.GamePlaySandyNight=n}),define("src/g/boss/view/SBHJFightView",["require","exports","../../../utils/ItemUtils","../../../config/GameConfig","../../../utils/ItemCellUtils","../../../manager/LayerManager","../../../utils/system/DateUitl","../../../meta/QualiyVo","../../../utils/SbUtils","src/init/TextConst"],function(t,e,l,h,o,a,i,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.monsterUid=-1,t._hp=0,t._maxHp=0,t.lv=["D","C","B","A","S"],t._nextLevel=0,t._dps=0,t.htxt_desc.style.font="SimHei",t.htxt_desc.style.color="#e3cca9",t.htxt_desc.style.fontSize=18,t.htxt_reward_desc.style.font="SimHei",t.htxt_reward_desc.style.color="#e3cca9",t.htxt_reward_desc.style.fontSize=18,t}return __extends(t,e),t.prototype.showView=function(t,e,i){this.monsterUid=i;var n=this._portId=e;Laya.timer.clear(this,this.updateCd);var s=h.GameConfig.sbPortInfoJson[n];s&&(this._cd=s.time+1,o.ItemCellUtils.fillCellForItem0View(this.item0,s.bonus[0][0],s.bonus[0][1]),this.updateCd()),this.updateTargetDpsDesc(e),this.updateProgress(),this.img_head.skin=l.ItemUtils.getBossIccon(t.id),this.txt_name.changeText(t.name),this.bosslvl.changeText(l.ItemUtils.getLVString(t.lv)),a.LayerManager.addInUILayer(this)},t.prototype.updateCd=function(){this._cd--,0<this._cd?(Laya.timer.once(1e3,this,this.updateCd),this.lab_cd.changeText(i.DateUtil.getHMS_countdown(this._cd))):this.lab_cd.changeText("00:00:00")},t.prototype.updateTargetDpsDesc=function(t){for(var e,i=2;i<=4;){if((e=u.SbUtils.getSbTepVo(t,i))&&e.tep/100>this._dps/this._maxHp)return void this.setNextLevel(i);i++}this.htxt_desc.innerHTML=p.TextConst.get(304),this.img_score.skin="res/hotbloodtemple/rxsd_pingfenSda.png"},t.prototype.setNextLevel=function(t){if(this._nextLevel!=t){this._nextLevel=t;var e=u.SbUtils.getSbTepVo(this._portId,t);this.targetDps=e.tep,this.htxt_desc.innerHTML=p.TextConst.get(305,e.tep,this.lv[t]);for(var i=e.item.length,n=0,s="",o=!1;n<i;){if(o=!1,4==this._nextLevel){var a=h.GameConfig.sbPortInfoJson[this._portId];a&&e.item[n][0]==a.bonus[0][0]&&e.item[n][1]==a.bonus[0][1]&&(o=!0)}if(!o){var r=l.ItemUtils.getItemOrEq(e.item[n][0]);r&&(s+="<font color='"+c.QualityStruct.Ins.getQColorById(r.quality)+"'>"+r.name+"x"+e.item[n][1]+"</font><br>")}n++}this.htxt_reward_desc.innerHTML=s,this.img_score.skin="res/hotbloodtemple/rxsd_pingfen"+this.lv[t-1]+"da.png"}},t.prototype.updateProgress=function(){var t=360*Math.min(1,this._dps/this.targetDps);this.sp_progress.graphics.clear(),this.sp_progress.graphics.drawPie(38,38,38,0,t,"#ff0000")},t.prototype.updateHp=function(t){this._hp=t,this.setHpProgress()},t.prototype.setDps=function(t){t<0&&(t=0),this._dps=t,this.clip_dps.value=t.toString(),this.updateTargetDpsDesc(this._portId),this.updateProgress()},t.prototype.setMaxHp=function(t){this._maxHp=t,this.setHpProgress()},t.prototype.setHpProgress=function(){this.lab_progress.changeText(this._hp+"/"+this._maxHp),this.img_progress.scaleX=Math.max(0,Math.min(1,this._hp/this._maxHp))},t.prototype.hideView=function(){this.removeSelf()},t}(ui.boss.SBHJFightViewUI);e.SBHJFightView=n}),define("src/g/account/view/SBHJFightWin",["require","exports","../../../utils/ItemCellUtils","src/init/TextConst"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.levelStr=["D","C","B","A","S"],t.popupEffect=null,t.list_item.itemRender=ui.custom.ItemNameViewUI,t.list_item.renderHandler=new Laya.Handler(t,t.onRenderListHandler),t.btn_get.on(Laya.Event.CLICK,t,t.onGetHandler),t}return __extends(t,e),t.prototype.showView=function(t,e,i,n){this.popup(),this.img_score.skin="res/hotbloodtemple/rxsd_pingfen"+this.levelStr[t]+"da.png",this.txt_dps.changeText(e.toString()),this.list_item.array=i,this._okHandler=n,this._cooldown=5,Laya.timer.loop(1e3,this,this.cooldownHandler)},t.prototype.cooldownHandler=function(){this._cooldown--,this._cooldown<1?this.onGetHandler():this.btn_get.label=n.TextConst.get(243,this._cooldown)},t.prototype.onRenderListHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onGetHandler=function(){this._okHandler&&this._okHandler.run(),this.onCloseHandler()},t.prototype.onCloseHandler=function(){this._okHandler=null,Laya.timer.clear(this,this.cooldownHandler),this.close()},t}(ui.account.SBHJFightWinUI);e.SBHJFightWin=s}),define("src/g/fight/osprite/play/GamePlaySBHJ",["require","exports","src/g/fight/osprite/play/GamePlaySvrBase","../../../../enum/EventName","../../../../core/E","../../../../manager/StateManger","../../../../manager/GameSocketManager","src/g/fight/osprite/play/skyPort/vo/PataVo","../../../net/messages/OpResultGS2C","../../../net/messages/BossCriticalHit","src/g/index/ctrl/BtnSkiilCtrl","../../../../utils/ItemUtils","../../../../manager/RoleCenter","../../../../config/GameConfig","src/g/fight/osprite/SceneObjCtroller","../../../net/messages/ExpCopyMsg","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../net/messages/sbkShenBingData","src/g/boss/view/SBHJFightView","../../../../utils/SoundUtils","src/g/account/view/SBHJFightWin","src/g/account/ctrl/GetRewwardCtrl"],function(t,e,i,n,s,o,a,r,l,h,c,d,g,v,u,f,y,m,_,C,I,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(p){function t(t){var e=p.call(this,t)||this;e._endMsg=null,s.E.ins.on(n.EventName.EXIT_BOSS_PLAYTYPE,e,e.exitHandler),o.StateManger.fightsvrmode=!0,e.vo=new r.PataVo;var i=a.GSM.ins;return i.on(_.SBHJFightStartGS2C.KEY,e,e.onPagodaFightStart),i.on(_.SBHJFightEndGS2C.KEY,e,e.onPagodaFightEnd),i.on(l.OpResultGS2C.KEY,e,e.onOpResultGS2C),i.on(h.BossCriticalHitGS2C.KEY,e,e.onBossCriticalHitGS2C),i.on(_.GetSBHJFightInvMsg.KEY,e,e.onExitBackHandler),e.setJoinSkill(),e}return __extends(t,p),t.prototype.init=function(t){void 0===t&&(t=null),this.clearBattleField(),p.prototype.init.call(this,t),this._portData=this.scene.port,this.initHeroGroup(),this.readyAndFightStart()},t.prototype.clearBattleField=function(){c.BtnSkiilCtrl.ins.resetProcess()},t.prototype.initHeroGroup=function(){p.prototype.initHeroGroup.call(this);var t=d.ItemUtils.getPortVoById(g.RoleCenter.instans.vo.shenbing.huanJingCfgId),e=v.GameConfig.getMapJSON(t.boss_scene);this._fightGroup.resetFightGroup(e.startPoint[0])},t.prototype.readyAndFightStart=function(){this.requestMonsterData();var t=d.ItemUtils.getPortVoById(g.RoleCenter.instans.vo.shenbing.huanJingCfgId),e=v.GameConfig.getMapJSON(t.boss_scene);this._fightGroup.resetFightGroup(e.startPoint[0]),this._fightGroup.setOnceTarget(this._monsterGroup),this.fightStart()},t.prototype.listenStartAttack=function(t){t==u.SceneObjCtroller.ins.self&&(s.E.ins.off(n.EventName.START_ATTACK,this,this.listenStartAttack),this.fightStart())},t.prototype.requestMonsterData=function(){var t=new _.SBHJFightStartC2GS;t.curCfgId=g.RoleCenter.instans.vo.shenbing.huanJingCfgId,a.GSM.sendServer(t)},t.prototype.onPagodaFightStart=function(t){console.log("收到怪物信息，创建怪物");var e=new f.MonsterAppearExpCopyGS2C;e.monsterArr=t.monsterArr,e.monsterUidArr=t.monsterUidArr,this.createMonsterByMonsterAppearExpCopyGS2C(e),this._fightGroup.setFGTarget(this._monsterGroup)},t.prototype.fightStart=function(){console.log("发送请求战斗");var t=new _.SBHJChallengeStartMsg;a.GSM.sendServer(t)},t.prototype.onOpResultGS2C=function(t){t.opresult?(console.log("神兵幻境请求战斗开始成功"),this._monsterGroup.setOnceTarget(this._fightGroup)):y.FE.upItems(t.error,m.BubbleEnum.center)},t.prototype.onBossCriticalHitGS2C=function(t){if(this._monsterDic&&this._monsterDic[t.bossuid]){var e=this._monsterDic[t.bossuid];if(e){var i=v.GameConfig.bossCrit[t.critSkillId];i&&e.playExtEff(i.effect)}}},t.prototype.onPagodaFightEnd=function(t){console.log("神兵幻境战斗结束:"),this.checkIsRunAllKey()?(this.clearBattleField(),t.win&&(this._fightReward=t.inv,Laya.timer.once(500,this,this.popWinPanel,[t]))):this._endMsg=t},t.prototype.popWinPanel=function(t){this.showWin(t,Laya.Handler.create(this,this.getRewardRequest))},t.prototype.showWin=function(t,e){var i,n=t.inv,s=new b.SBHJFightWin,o=[];for(i=0;i<n.currencyList.length;i++){var a=n.currencyList[i];o.push([a.key,a.val])}for(i=0;i<n.itemList.length;i+=2)o.push([n.itemList[i],n.itemList[i+1]]);for(i=0;i<n.equipList.length;i++)o.push([n.equipList[i].equtemplet,1]);for(i=0;i<n.zhanwenList.length;i++)o.push([n.zhanwenList[i].cfgId,1]);s.showView(t.pingfen,t.DPS,o,e),I.SoundUtils.getInstance().playSoundById(107)},t.prototype.releaseSkillHandler=function(t){this.releaseSkill(t,"")},t.prototype.getRewardRequest=function(){var t=new _.GetSBHJFightInvMsg;t.type=1,a.GSM.sendServer(t)},t.prototype.cancalRewardRequest=function(){var t=new _.GetSBHJFightInvMsg;t.type=2,a.GSM.sendServer(t),this.exitHandler()},t.prototype.onExitBackHandler=function(t){1==t.type&&(g.RoleCenter.instans.addInventoryToC(this._fightReward),y.FE.addInventoryToCFloats(this._fightReward),w.GetRewwardCtrl.inventoryAddGS2C(this._fightReward)),this.exitHandler()},t.prototype.exitHandler=function(){this.onExitMsgHandler()||this.returnAutoplayPort()},t.prototype.frameMove=function(){p.prototype.frameMove.call(this),null==this._mainRole&&this.runAllInfo(),this._endMsg&&this.checkIsRunAllKey()&&(this.onPagodaFightEnd(this._endMsg),this._endMsg=null)},t.prototype.onExitMsgHandler=function(){return!!this._endMsg&&(this.runAllInfo(),this.onPagodaFightEnd(this._endMsg),!(this._endMsg=null))},t.prototype.clear=function(){this.onExitMsgHandler(),p.prototype.clear.call(this);var t=a.GSM.ins;t.off(_.SBHJFightStartGS2C.KEY,this,this.onPagodaFightStart),t.off(_.SBHJFightEndGS2C.KEY,this,this.onPagodaFightEnd),t.off(l.OpResultGS2C.KEY,this,this.onOpResultGS2C),t.off(h.BossCriticalHitGS2C.KEY,this,this.onBossCriticalHitGS2C),t.off(_.GetSBHJFightInvMsg.KEY,this,this.onExitBackHandler),s.E.ins.off(n.EventName.START_ATTACK,this,this.listenStartAttack),s.E.ins.off(n.EventName.EXIT_BOSS_PLAYTYPE,this,this.exitHandler),this._hpBar&&(this._hpBar.hideView(),this._hpBar=null)},t.prototype.createMonsterByMonsterAppearExpCopyGS2C=function(t,e){if(void 0===e&&(e=!1),p.prototype.createMonsterByMonsterAppearExpCopyGS2C.call(this,t,e)){var i=t.monsterUidArr;this._hpBar||(this._hpBar=new C.SBHJFightView);var n=d.ItemUtils.getPortVoById(g.RoleCenter.instans.vo.shenbing.huanJingCfgId),s=d.ItemUtils.getMonsterVOById(n.boss[0]);this._hpBar.showView(s,g.RoleCenter.instans.vo.shenbing.huanJingCfgId,i[i.length-1]);var o=v.GameConfig.getMapJSON(n.boss_scene);o||console.error("portId:"+n.boss_scene);for(var a=0,r=0,l=0,h=0,c=null,u=0;u<i.length;u++)h=i[u],c=this._monsterDic[h],o&&u<i.length&&(r=o.bossXY[u][0],l=o.bossXY[u][1]),c.resetUnit(r,l),c.status=1,a+=c.getHp();return this._hpBar&&(this._hpBar.setMaxHp(a),this._hpBar.updateHp(a),this._hpBar.setDps(0)),!0}return!1},t.prototype.setMonsterHp=function(t,e,i){p.prototype.setMonsterHp.call(this,t,e,i);var n=0,s=null;for(var o in this._monsterDic)(s=this._monsterDic[o])&&!s.isDeath()&&(n+=s.getHp());this._hpBar&&this._hpBar.updateHp(n),0==e&&this._count<=0&&this._fightGroup.stand(),this._hpBar&&this._hpBar.setDps(this._totalHurtValue)},t}(i.GamePlaySvrBase);e.GamePlaySBHJ=p}),define("src/g/fight/osprite/play/personboss/GamePlayPersonBoss",["require","exports","src/g/fight/osprite/play/baseplay/GamePlayPVE","src/g/fight/osprite/NetCtroller","src/g/fight/osprite/play/PlayManager","src/g/fight/osprite/SceneObjManager","src/g/account/ctrl/AccountViewCtrl","../../../../../manager/RoleCenter","../../../../../utils/DropUtil","../../../../../enum/EventName","../../../../../core/E","src/g/fight/osprite/play/baseplay/SvrPeopleBossMonster","src/g/fight/osprite/obj/FightGroup","../../../../../utils/ItemUtils","src/g/boss/view/MonBossPop","../../../../../manager/AM","src/init/TextConst"],function(t,e,i,n,s,a,r,l,h,c,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(o){function t(t){var e=o.call(this,t)||this;return e._pribossIndex=-1,e._privateBossPort=0,e._ispop=!1,e}return __extends(t,o),t.prototype.init=function(t){o.prototype.init.call(this,t),h.DropUtil.isfly=!0,Laya.timer.once(2e3,this,function(){n.NetCtroller.fightStartC2GS(!0,this.vo.boss,this.vo.id)}),this.bossGroup.setFGTarget(this._fightGroup)},t.prototype.initBossGroup=function(){this.bossGroup=new d.FightGroup(null);var t=new p.SvrPeopleBossMonster,e=l.RoleCenter.instans.self.bossData.bossprivatePort[this._pribossIndex],i=g.ItemUtils.getMonsterVOById(g.ItemUtils.getPortVoById(e).boss[0]);t.set_DATA(i),this.bossFightUnit=t,this.bossGroup.addFightUnit(t),this.bossGroup.resetFightGroup(this.mapVo.bossXY[0]),this.bossGroup.addToFightLayer(),t.setFocusEff()},t.prototype.onReceiveFightEnd=function(t){o.prototype.onReceiveFightEnd.call(this,t),console.log("收到战斗结算"),this.redEqAddTask(this._fightReward),this._fightGroup.setPITarget(a.SceneObjManager.instans.totalDrops);var e=l.RoleCenter.instans.self.bossData.bossprivatePass,i=l.RoleCenter.instans.self.bossData.bossprivateNum;if(t.opresult){if(u.E.ins.event(c.EventName.CHALLENGE_PERSON_BOSS_SUCCESS,this.vo.id),console.log("CHALLENGE_PERSON_BOSS_SUCCESS"+this.vo.id),0<=this._pribossIndex){var n=l.RoleCenter.instans.self.bossData.bossprivatePort[this._pribossIndex];g.ItemUtils.getMonsterVOById(g.ItemUtils.getPortVoById(n).boss[0]);if(-2==this.bossvo.lv){var s=l.RoleCenter.instans.vo.isMonthCard;e[this._pribossIndex]=(s?e[this._pribossIndex]&&(i[this._pribossIndex]=Math.max(0,i[this._pribossIndex]-1)):this._ispop=!0,1)}else i[this._pribossIndex]=Math.max(0,i[this._pribossIndex]-1),e[this._pribossIndex]=1;this._pribossIndex=-1}Laya.timer.once(3e3,this,this.delayHandler,[t])}else this.fightFailedProcess()},t.prototype.endPop=function(){(new v.MonBossPop).buyHandler()},t.prototype.delayHandler=function(t){t.opresult?this._fightGroup.isDeath()?this.fightFailedProcess():(r.AccountViewCtrl.ins.successFightEnd(this._fightReward,Laya.Handler.create(this,this.executeExit,[!1]),y.TextConst.get(197),null,null,!0),this._fightReward&&(this.effectExpAndMoney(this._fightReward),this._fightReward.clear(),this._fightReward=null)):this.fightFailedProcess()},t.prototype.onReceiveFightStart=function(t){s.PlayManager.loading||(o.prototype.onReceiveFightStart.call(this,t),this.scene.fightid=t.fightid,t.opresult?(this._fightReward=t.inventory,this.bossGroup.assignMonsterDrop(this._fightReward)):(console.log("开始失败消息"),this.executeExit()))},t.prototype.exitHandler=function(t){void 0===t&&(t=!0),f.AM.exitPlay(this.type,new Laya.Handler(this,this.executeExit))},t.prototype.executeExit=function(){o.prototype.exitHandler.call(this),Laya.timer.clearAll(this)},t.prototype.clear=function(){this.vo=null,Laya.timer.clearAll(this),o.prototype.clear.call(this),this._ispop&&this.endPop()},t.prototype.releaseSkillHandler=function(t){this.releaseSkill(t,"")},t.prototype.onAttackMsg=function(t){o.prototype.onAttackMsg.call(this,t),this.bossFightUnit.svrSetHP(t.hpAfterAttack[0]),this.checkJoinSkill(t)},t.prototype.onHpChg=function(t){o.prototype.onHpChg.call(this,t),t.beAttack||this.bossFightUnit.svrSetHP(t.hpAfterAttack[0])},t}(i.GamePlayPVE);e.GamePlayPersonBoss=o}),define("src/g/fight/osprite/play/zhanling/GamePlayZL",["require","exports","src/g/fight/osprite/play/GamePlayMatCopy","../../../../../manager/RoleCenter"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.decMapCopyChallengeTimes=function(){n.RoleCenter.instans.vo.COPYZLCOUNT--},e}(i.GamePlayMatCopy);e.GamePlayZL=s}),define("src/g/account/view/SeekWinOverDlg",["require","exports","../../../utils/ItemUtils","../../net/messages/friend/FriendMsg","src/g/friend/ctrl/FriendsDataManager","src/init/TextConst"],function(t,e,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(r){function t(t){var e=r.call(this)||this,i=t.nickname,n=t.username,s=new h.FindFriendC2GS;s.nickname=i,e.msg=s,e.btn_hand.on(Laya.Event.CLICK,e,e.reqHaoyou),e.lab_name.text=i,e.lab_power.text=t.combat+"",e.item0.getChildByName("img_head").skin=l.ItemUtils.getHeadurlYuan(t.sex,t.job);var o=c.FriendsDataManager.ins,a="";return o.userInMyList(n,h.enumFrdType.friend)?a=u.TextConst.get(498,i):o.userInMyList(n,h.enumFrdType.friendDouble)?a=u.TextConst.get(494,i):o.userInMyList(n,h.enumFrdType.black)&&(a=u.TextConst.get(497)),e.btn_hand.visible=""==a,e.lab_tip.text=a,e.btn_hand.label="确定",e}return __extends(t,r),t.prototype.reqHaoyou=function(){this.close()},t}(ui.account.SeekWinOverDlgUI);e.SeekWinOverDlg=i}),define("src/g/fight/osprite/play/team/GamePlayTeam",["require","exports","src/g/fight/osprite/play/GamePlay","../../../../../manager/GameSocketManager","src/g/fight/osprite/SceneObjCtroller","src/g/fight/osprite/obj/FightGroup","src/g/index/ctrl/BtnSkiilCtrl","../../../../../config/GameConfig","src/g/fight/osprite/play/team/TeamManager","src/g/fight/osprite/play/baseplay/SvrHeroUnit","../../../../../manager/RoleCenter","../../../../net/messages/ActivityMessage","src/g/fight/osprite/SceneObjManager","src/g/account/ctrl/AccountViewCtrl","src/g/fight/osprite/NetCtroller","src/g/account/view/SeekWinOverDlg","src/g/account/ctrl/PortFightSucCtrl"],function(t,e,i,p,d,n,s,g,v,f,y,m,l,h,o,c,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(u){function t(t,e){void 0===e&&(e=+g.GameConfig.commonJson.helpportid.value);var i=u.call(this,t)||this;i._rageAdd=5,i._rageInitValue=0,i._portVo=null,i._mapVo=null;var n=i.playSettingVo;return n&&(i._rageAdd=n.rageAdd,i._rageInitValue=n.rage),s.BtnSkiilCtrl.ins.autoProcess(i._rageInitValue,i._rageAdd),i._portVo=g.GameConfig.getPortByID(e),i._mapVo=g.GameConfig.getMapJSON(i._portVo.boss_scene),i}return __extends(t,u),t.prototype.onBossOwnerChange=function(t){var e=this._playerDic[t.newowner];e&&(this._bossFG.setOnceTarget(e),l.SceneObjManager.instans.setLock(e.getUnitByIndex(0)))},t.prototype.releaseSkillHandler=function(t){var e=this._fightGroup.getFGTarget();e&&this.releaseSkill(t,e.groupID)},t.prototype.fightEnd=function(t){var e=this.msg.teamUid;if(t.actid==e)if(t.win){var i=this.gs2c,n=!1,s=i.teamState.member[0];i&&(n=i.teamState.captain.username==y.RoleCenter.instans.vo.username);var o=this._portToEnter,a=t.portidx;0<a&&(this._portToEnter=a),this._fightGroup.setPITarget(l.SceneObjManager.instans.totalDrops);var r=_.PortFightSucCtrl.ins;r.fightSuccess(t.inventory,Laya.Handler.create(this,function(){y.RoleCenter.instans.addInventoryToC(t.inventory),this.enterIntoPort(),n&&s&&new c.SeekWinOverDlg(s).popup()}),o),n||r.hideInfo()}else h.AccountViewCtrl.ins.failFightEnd(Laya.Handler.create(this,this.enterIntoPort))},t.prototype.init=function(t){u.prototype.init.call(this,t);var e=this.msg,i=e.teamUid,n=v.TeamManager.getTeamFightMsg(i);this.gs2c=n;var s=this._bossFG;if(n){n.teamState.teamState=e.teamState;var o=g.GameConfig.getPortByID(n.level);this._bossFG=s=this.createBossFG(o.boss[0]),s.addToFightLayer(),s.resetFightGroup(this._mapVo.bossXY[0]),Laya.timer.loop(10,this,this.checkWayHandler);var a=this._mapVo.startPoint,r=d.SceneObjCtroller.ins.getSelfGroup();r.resetFightGroup(a[0]),r.addToFightLayer(),r.setOnceTarget(s),this.setFightGroup(r);var l=y.RoleCenter.instans.getOtherData(v.TeamManager.getMemberUn(e)),h=f.SvrHeroUnit.createFightGroup(l,a[1]);this.addPlayerFG(h),l.vipLv&&h.getFUList()[0].showOff(),h.setOnceTarget(s);var c=p.GSM.ins;c.on(m.ActivityEndGS2C.KEY,this,this.fightEnd),c.on(m.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChange)}else this.returnAutoplayPort()},t.prototype.checkWayHandler=function(){this._mainRole.ways.length<=1&&(Laya.timer.clear(this,this.checkWayHandler),o.NetCtroller.JoinInQMBossCopy(this.msg.teamUid,m.EACT_TYPE.helpfight))},t.prototype.onHpChg=function(t){t.beAttack?u.prototype.onHpChg.call(this,t):this.setMonsterHp(this.bossId,t.hpAfterAttack,!0)},t.prototype.createBossFG=function(t){this.bossId=t;var e=new n.FightGroup(null);this.createMonster(e,t,t);return e},t.prototype.clear=function(){u.prototype.clear.call(this);var t=this._bossFG;t&&t.destroyGroup(),this.msg=null;var e=p.GSM.ins;e.off(m.ActivityEndGS2C.KEY,this,this.fightEnd),e.off(m.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChange),Laya.timer.clear(this,this.checkWayHandler)},t}(i.GamePlay);e.GamePlayTeam=a}),define("src/g/account/view/CSAthleticsWin",["require","exports","../../../utils/ItemCellUtils"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.list_item.renderHandler=new Laya.Handler(t,t.onRenderListHandler),t.btn_get.on(Laya.Event.CLICK,t,t.onGetHandler),t}return __extends(t,e),t.prototype.setData=function(t,e){this._stopHandler=e;var i,n=t.reward,s=[];for(i=0;i<n.currencyList.length;i++){var o=n.currencyList[i];s.push([o.key,o.val])}for(i=0;i<n.itemList.length;i+=2)s.push([n.itemList[i],n.itemList[i+1]]);for(i=0;i<n.equipList.length;i++)s.push([n.equipList[i].equtemplet,1]);for(i=0;i<n.zhanwenList.length;i++)s.push([n.zhanwenList[i].cfgId,1]);this.list_item.array=s,this.lab_name.changeText("【"+t.otherSvrname+"】"+t.otherNickname),this.font_score.value=t.addScore.toString()},t.prototype.onRenderListHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onGetHandler=function(){this.onCloseHandler()},t.prototype.onClosed=function(){this._stopHandler&&(this._stopHandler.run(),this._stopHandler=null)},t.prototype.onCloseHandler=function(){this.close()},t}(ui.account.CSAthleticsWinUI);e.CSAthleticsWin=n}),define("src/g/account/view/CSAthleticsFail",["require","exports","../../../utils/ItemCellUtils"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.list_item.renderHandler=new Laya.Handler(t,t.onRenderListHandler),t.btn_get.on(Laya.Event.CLICK,t,t.onGetHandler),t}return __extends(t,e),t.prototype.setData=function(t,e){this._stopHandler=e;var i,n=t.reward,s=[];for(i=0;i<n.currencyList.length;i++){var o=n.currencyList[i];s.push([o.key,o.val])}for(i=0;i<n.itemList.length;i+=2)s.push([n.itemList[i],n.itemList[i+1]]);for(i=0;i<n.equipList.length;i++)s.push([n.equipList[i].equtemplet,1]);for(i=0;i<n.zhanwenList.length;i++)s.push([n.zhanwenList[i].cfgId,1]);this.list_item.array=s,this.font_score.value=t.addScore.toString()},t.prototype.onRenderListHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onGetHandler=function(){this.onCloseHandler()},t.prototype.onClosed=function(){this._stopHandler&&(this._stopHandler.run(),this._stopHandler=null)},t.prototype.onCloseHandler=function(){this.close()},t}(ui.account.CSAthleticsFailUI);e.CSAthleticsFail=n}),define("src/g/fight/osprite/play/skyLadder/GamePlayCSAthletics",["require","exports","../../../../net/messages/kuafu/KfjjcMsg","src/g/fight/osprite/obj/FightGroup","src/g/fight/osprite/play/GamePlay","../../../../../core/E","../../../../../enum/EventName","../../../../net/messages/KingDataGS2C","../../../../../manager/GameSocketManager","src/g/fight/osprite/NetCtroller","../../../../../manager/RoleCenter","src/g/fight/osprite/play/baseplay/SvrHeroUnit","src/g/fight/osprite/SceneObjCtroller","src/g/account/view/CSAthleticsWin","src/g/account/view/CSAthleticsFail","../../../../../enum/HpType"],function(t,e,n,a,i,s,o,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(i){function t(t){var e=i.call(this,t)||this;return e._bossaccname="",e}return __extends(t,i),t.prototype.init=function(t){void 0===t&&(t=null),i.prototype.init.call(this,t),s.E.ins.on(o.EventName.EXIT_BOSS_PLAYTYPE,this,this.exitHandler),l.GSM.ins.on(n.KfjjcCombatResultGS2C.KEY,this,this.onEndMsg),h.NetCtroller.fightStartC2GS(!0,[],1),this.startHandler(this.fightMsg),this.setJoinSkill()},t.prototype.startHandler=function(t){var e=t.matchUser;c.RoleCenter.instans.addOtherData(e),this.heroPostion=this.mapVo.startPoint[0],this.bossGroup=new a.FightGroup(e.username),this._bossaccname=e.username,this.addPlayerFG(this.bossGroup);for(var i=e.openhero,n=i.length,s=0;s<n;s++){var o=i[s];this.createEnamy(o,e.chopLv,0,e.nickname,this.bossGroup,s)}this.selfGroup||this.initHeroGroup(),this.selfGroup.setOnceTarget(this.bossGroup),Laya.timer.once(1e3,this,function(){this.bossGroup.setFGTarget(this.selfGroup)})},t.prototype.createEnamy=function(t,e,i,n,s,o){var a=this.mapVo.bossXY[0],r=(a=this.mapVo.bossXY[0],new u.SvrHeroUnit);r.heroIndex=o,s.addFightUnit(r),r.initHeroData(t,e,i,n),r.topHpBar.typeElement=v.HpType.monster,r.pkGold=!0,s.resetFightGroup(a),s.addToFightLayer()},t.prototype.initHeroGroup=function(){this.selfGroup=p.SceneObjCtroller.ins.getSelfGroup(),this.selfGroup.resetFightGroup(this.heroPostion),this.selfGroup.addToFightLayer(),this.setFightGroup(this.selfGroup),c.RoleCenter.instans.vo.VIP&&p.SceneObjCtroller.ins.self.showOff()},t.prototype.onEndMsg=function(t){l.GSM.ins.off(n.KfjjcCombatResultGS2C.KEY,this,this.onEndMsg),Laya.timer.once(1e3,this,this.delayEndMsg,[t])},t.prototype.delayEndMsg=function(t){this.win=t.win;var e=t.reward;if(this.reward=e,this.win){var i=new d.CSAthleticsWin;i.setData(t,new Laya.Handler(this,this.exitHandler)),i.popup()}else{var n=new g.CSAthleticsFail;n.setData(t,new Laya.Handler(this,this.exitHandler)),n.popup()}c.RoleCenter.instans.addInventoryMoneyToC(e),c.RoleCenter.effectExpAndMoney(e),e.itemList&&0<e.itemList.length&&c.RoleCenter.instans.addInventoryItemToC(e)},t.prototype.exitHandler=function(){this.returnAutoplayPort(),s.E.ins.off(o.EventName.EXIT_BOSS_PLAYTYPE,this,this.exitHandler)},t.prototype.frameMove=function(){i.prototype.frameMove.call(this)},t.prototype.clear=function(){s.E.ins.off(o.EventName.EXIT_BOSS_PLAYTYPE,this,this.exitHandler),l.GSM.ins.off(n.KfjjcCombatResultGS2C.KEY,this,this.onEndMsg),l.GSM.ins.off(r.KingMatchCombatResultGS2C.KEY,this,this.onEndMsg),this.bossGroup&&this.bossGroup.destroyGroup(!0),this.selfGroup&&this.selfGroup.destroyGroup(!0),i.prototype.clear.call(this),Laya.timer.clearAll(this)},t.prototype.onHpChg=function(t){i.prototype.onHpChg.call(this,t);var e=this.bossGroup;e&&!t.beAttack&&e.getUnitByIndex(t.beAttackHidx).svrSetHP(t.hpAfterAttack[t.beAttackHidx])},t.prototype.onAttackMsg=function(t){i.prototype.onAttackMsg.call(this,t),this.checkJoinSkill(t)},t.prototype.releaseSkillHandler=function(t){this.releaseSkill(t,this._bossaccname)},t}(i.GamePlay);e.GamePlayCSAthletics=f}),define("src/g/fight/osprite/play/shenweiyu/ShenweiyuManager",["require","exports","src/g/fight/osprite/play/PlayManager","../../../../../utils/system/FloatEffect","../../../../../utils/system/ServerTime","../../../../../core/E","../../../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../../../config/GameConfig","../../../../../manager/GameSocketManager","../../../../../manager/RoleCenter","../../../../../utils/ItemUtils","../../../../../meta/ShenweiyuVo","../../../../../core/GNet","../../../../net/messages/EnterMuSceneC2GS","../../../../net/messages/rank/RankDataGS2C","../../../../net/messages/SWYMsg","../../../../net/messages/ActivityMessage","../../../../net/messages/ChangeSceneMsg","../../../../net/messages/rank/sbkRankDataBase","src/g/fight/osprite/GameScene","src/init/TextConst","../../../../../manager/AM"],function(t,e,n,r,s,l,h,c,u,p,d,g,i,o,v,f,y,m,_,C,I,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function a(){this._ownerFG=null,this._enterTime=-1,this._enterPortId=-1,this.gamePlay=null,this._bossInfoDic={},this.viewCtrl=null,this._battleOpenStateMsg=null,this._levelLeftTime=-1,this.portId=0,this.actionTime=-1,p.GSM.ins.on(y.swyOpenState.KEY,this,this.onBloodyBattleActOpenState)}return a.getInstance=function(){return this._instance||(this._instance=new a),this._instance},a.prototype.enterGamePlay=function(t){l.E.ins.event(h.EventName.SHENWEIYU_SCENE_PANEL);var e=p.GSM.ins;e.on(m.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),e.on(m.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChangeGS2C),e.on(v.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C),e.on(y.swyallBossHPGS2C.KEY,this,this.onBattleBossStateAll),e.on(y.swyJiFenGS2C.KEY,this,this.onShenweiyuRoleDataChange),e.on(y.swyUserListGS2C.KEY,this,this.onNearByData),e.on(f.RankDataGS2C.KEY,this,this.refushRankData),e.on(y.swyGameOverGS2C.KEY,this,this.onShowSettlePanel),this.setBossOwner(null),this.gamePlay=t,-1!=this._enterPortId&&(this.gamePlay.setEnterPortId(this._enterPortId),this._enterPortId=-1);var i=d.RoleCenter.instans.self.swyLayer,n=this.getSetting(i).portID[0],s=g.ItemUtils.getPortVoById(n);this.actionTime=60*Number(u.GameConfig.commonJson.shenweiyu.value);var o=0,a=0,r=u.GameConfig.getMapJSON(s.boss_scene);r&&(o=r.startPoint[0][0],a=r.startPoint[0][1]),this.gamePlay.sendEnterMuSceneC2GS(!0,n,o,a),Laya.timer.frameLoop(1,this,this.updateTime)},a.prototype.updateTime=function(){var t=this.actionTime-(s.ServerTime.serverTime-this._battleOpenStateMsg.openTime);this._levelLeftTime!=t&&(this._levelLeftTime=t,this.viewCtrl&&this.viewCtrl.updateTime(t))},a.prototype.enterShenWeiYuWar=function(t,e){if(void 0===e&&(e=_.EPlayType.PLAYTYPE_SWY),1==this.getShenweiyuIsKf(t)&&(e=_.EPlayType.PLAYTYPE_SWYKF),!d.RoleCenter.instans.bagRoomEnough())return w.AM.showBagNotEnough(),!1;if(n.PlayManager.isSpecialPlay()&&n.PlayManager.type!=e)return r.FE.upItems(b.TextConst.get(406)),!1;if(null!=this.gamePlay)return this._enterPortId=t,a.getInstance().gotoBossArea(t),!1;if(!this._battleOpenStateMsg)return console.error("HotBloodWarManager::enterHotBloodWar:_battleOpenStateMsg = null"),!1;if(!this._battleOpenStateMsg.actOpen)return r.FE.upItems(b.TextConst.get(455)),!1;if(0<this._battleOpenStateMsg.quitTime&&s.ServerTime.serverTime-this._battleOpenStateMsg.quitTime<30)return r.FE.upItems(b.TextConst.get(1266,30-(s.ServerTime.serverTime-this._battleOpenStateMsg.quitTime))),!1;var i=this._enterTime-s.ServerTime.serverTime;return 0<i?(r.FE.upItems(b.TextConst.get(1266,i)),!1):(this._enterPortId=t,this.sendEvt(e),!0)},a.prototype.sendEvt=function(t){l.E.ins.event(h.EventName.PLAY_TYPE_CHANGE,c.PlayTypeVo.create(t))},a.prototype.exitShenWeiYu=function(){if(this.gamePlay){var t=d.RoleCenter.instans.self.swyLayer,e=this.getSetting(t).portID[0];this.gamePlay.sendEnterMuSceneC2GS(!1,e,0,0),this.gamePlay.returnAutoplayPort(),Laya.timer.clear(this,this.updateTime)}},a.prototype.getSetting=function(t){t<=0&&(t=1);var e=u.GameConfig.shenweiyuCfg[t];return e||(console.error("找不到数据:id="+t),new i.ShenweiyuVo)},a.prototype.getShenweiyuLayer=function(t){for(var e in u.GameConfig.shenweiyuCfg){var i=u.GameConfig.shenweiyuCfg[e];if(0<=i.portID.indexOf(t))return i.id}return 0},a.prototype.getShenweiyuIsKf=function(t){for(var e in u.GameConfig.shenweiyuCfg){var i=u.GameConfig.shenweiyuCfg[e];if(0<=i.portID.indexOf(t))return i.crossService}},a.prototype.onActivityRebirthGS2C=function(t){this.gamePlay&&this.gamePlay.onActivityRebirthGS2C(t),t.opresult?t.userAcc==d.RoleCenter.instans.self.username&&this.viewCtrl.getDeathCtrl().relase():console.error(t.error)},a.prototype.exitGamePlay=function(){this.viewCtrl&&(this.viewCtrl.exit(),this.viewCtrl=null),this._enterPortId=-1,this.setBossOwner(null),this._enterTime=s.ServerTime.serverTime+30;var t=p.GSM.ins;t.off(m.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),t.off(m.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChangeGS2C),t.off(y.swyUserListGS2C.KEY,this,this.onNearByData),t.off(v.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C),t.off(y.swyJiFenGS2C.KEY,this,this.onShenweiyuRoleDataChange),t.off(f.RankDataGS2C.KEY,this,this.refushRankData),t.off(y.swyGameOverGS2C.KEY,this,this.onShowSettlePanel),this.gamePlay=null},a.prototype.onEnterMuSceneGS2C=function(t){if(t.opresult){if(this.viewCtrl){var e=this.getShenweiyuLayer(this.portId);l.E.ins.event(h.EventName.SHENWEIYU_CHNAGE_LAYER,e);var i=t.portid,n=this.getShenweiyuLayer(i);if(e==n){i==(s=a.getInstance().getSetting(e).portID[0])?this.viewCtrl.hideBattlePanel():(this.viewCtrl.showBattlePanel(i),this.setBossOwner(null))}else{d.RoleCenter.instans.self.swyLayer=n,this.viewCtrl.hideBattlePanel(),this.viewCtrl.updateLayerShow(n),this.gamePlay.resetRectData(),r.FE.upItems(b.TextConst.get(1268,n));var s=a.getInstance().getSetting(n).portID[0],o=g.ItemUtils.getPortVoById(s);I.GameScene.ins.changeMap(o.boss_scene)}this.portId=i}t.enter?(t.enterType==v.EEnterMuSceneType.REVIVE&&this.viewCtrl.getDeathCtrl().relase(),this.gamePlay.setMainRoleByMsg(t)):l.E.ins.event(h.EventName.PLAY_TYPE_CHANGE,c.PlayTypeVo.create(_.EPlayType.PLAYTYPE_PORT))}else l.E.ins.event(h.EventName.PLAY_TYPE_CHANGE,c.PlayTypeVo.create(_.EPlayType.PLAYTYPE_PORT)),console.log("ShenweiyuWarManager::onEnterMuSceneGS2C:"+t.error),r.FE.upItems(b.TextConst.showErrorInfo(t.error))},a.prototype.onBloodyBattleActOpenState=function(t){this._battleOpenStateMsg=t},a.prototype.onShenweiyuRoleDataChange=function(t){d.RoleCenter.instans.self.swyLayer=t.layer,d.RoleCenter.instans.self.swyJiFen=t.jifen,d.RoleCenter.instans.self.swyLing1=t.ling1,d.RoleCenter.instans.self.swyLing2=t.ling2,d.RoleCenter.instans.self.swyTime=t.swytime,this.viewCtrl&&this.viewCtrl.updateRoleJifen(t.layer,t.jifen),this.rankListData()},a.prototype.onBossOwnerChangeGS2C=function(t){if(""==t.newowner)this.setBossOwner(null);else{var e=this.gamePlay.getPlayerFG(t.newowner);this.setBossOwner(e)}},a.prototype.onBattleBossStateAll=function(t){for(var e=null,i=0;i<t.bossHPArr.length;i++)e=t.bossHPArr[i],(this._bossInfoDic[e.portid]=e).portid==this.getPortId()&&this.bossStateChange(e.portid,0==e.bossHP)},a.prototype.gotoBossArea=function(t){this.gamePlay&&this._bossInfoDic[t]&&this.gamePlay.gotoBoss(t)},a.prototype.onNearByData=function(t){this.viewCtrl&&this.viewCtrl.updateNearByListData(t.userList)},a.prototype.findBoss=function(){this.gamePlay&&this.gamePlay.startKillMonster()},a.prototype.setBossOwner=function(t){this._ownerFG!=t&&(this._ownerFG=t,this.updateBossOwner(t)),this.gamePlay&&this.gamePlay.setBossOwner(t)},a.prototype.updateBossOwner=function(t){this.viewCtrl&&this.viewCtrl.updateBossOwner(t)},a.prototype.updateBossOwnerHp=function(t,e){this.viewCtrl&&this.viewCtrl.updateBossOwnerHp(t,e)},a.prototype.setMonsterHp=function(t){this.viewCtrl&&this.viewCtrl.updateBossHp(t)},a.prototype.getPortStatus=function(t){return this._bossInfoDic[t]},a.prototype.getBossInfoDic=function(){return this._bossInfoDic},a.prototype.bossStateChange=function(t,e){this.gamePlay&&this.gamePlay.updateBossState(t),this.viewCtrl&&(this._bossInfoDic[t]?this.viewCtrl.visibleBossView(!e):this.viewCtrl.visibleBossView(!1))},a.prototype.checkIsMainScene=function(){var t=d.RoleCenter.instans.self.swyLayer,e=this.getSetting(t).portID[0];return this.getPortId()==e},a.prototype.getPortId=function(){return this.gamePlay?this.gamePlay.getCurrPortId():-1},a.prototype.checkIsCrossService=function(){var t=this.getShenweiyuLayer(this.portId);return 1==this.getSetting(t).crossService},a.prototype.showDeadAlert=function(t){var e=d.RoleCenter.instans.self.swyLayer;this.viewCtrl.onDeath(new Laya.Handler(this,this.sendRebord),this.getSetting(e))},a.prototype.sendRebord=function(){if(this.gamePlay){var t=new m.ActivityRebirthC2GS;t.acttype=this.checkIsCrossService()?m.EACT_TYPE.KFSWYBoss:m.EACT_TYPE.SWYBoss,p.GSM.sendServer(t)}else console.error("不在玩法中")},a.prototype.sendNextLayer=function(){var t=new y.swyUpC2GS;t.portid=this.getPortId(),p.GSM.sendServer(t)},a.prototype.sendNearByData=function(){var t=new y.swyGetUserListC2GS;t.portid=this.getPortId(),p.GSM.sendServer(t)},a.prototype.rankListData=function(t){var e;void 0===t&&(t=0),e=0===t?this.checkIsCrossService()?C.enumRankID.rankid_23:C.enumRankID.rankid_22:t;var i=u.GameConfig.rankconfigJSON[e].count||100;o.GNet.getRankList(e,1,i)},a.prototype.refushRankData=function(t){this.viewCtrl&&this.viewCtrl.updateRankData(t)},a.prototype.onShowSettlePanel=function(t){this.viewCtrl&&this.viewCtrl.onShowSettlePanel(Laya.Handler.create(this,this.exitShenWeiYu))},a.prototype.showHuDunView=function(){this.viewCtrl&&this.viewCtrl.showHuDunView()},a.prototype.hideHuDunView=function(){this.viewCtrl&&this.viewCtrl.hideHuDunView()},a._instance=null,a}();e.ShenweiyuWarManager=a}),define("src/g/fight/osprite/play/shenweiyu/GamePlayShenWeiYu",["require","exports","src/g/fight/osprite/play/RealTimeBossScene","../../../../../core/E","../../../../../enum/EventName","src/g/fight/osprite/obj/FightGroup","../../../../../utils/system/ServerTime","../../../../../manager/RoleCenter","../../../../../config/GameConfig","../../../../../manager/GameSocketManager","../../../../../utils/system/FloatEffect","src/g/fight/osprite/play/shenweiyu/ShenweiyuManager","../../../../net/messages/SWYMsg","../../../../net/messages/EnterMuSceneC2GS","../../../../../utils/system/DateUitl","../../../../net/messages/ActivityMessage","../../../../../utils/DropUtil","src/g/fight/manager/ItemManager","src/init/TextConst","../../../../../manager/AM"],function(t,e,i,s,o,a,u,p,r,l,d,h,c,g,v,f,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t){var e=n.call(this,t)||this;e._ownerFG=null,e._enterPortId=-1,e._currPortId=0,e._bossStateChangeKey=!1,e._currMatrixList=[],e._waitTime=0,e._showDebugKey=!1,e._autoBattleKey=!1,e._waitAutoAttackBossTime=-1,e._sceneOpenStateDic={},e._sendCdTime=3,e._outInfoKey=!1,e._tombStoneMonsterFG=null,e._autoAttackBossTime=2,e._bossRelifeTime=-1,e._lastLeftTime=-1,e.curPkName="";var i=l.GSM.ins;return i.on(c.swyBossHPGS2C.KEY,e,e.onBattleBossHPGS2C),i.on(f.MonsterShieldChg.KEY,e,e.onShowHuDunMsg),i.on(c.swylingjiangGS2C.KEY,e,e.onReward),s.E.ins.on(o.EventName.EXIT_BOSS_PLAYTYPE,e,e.onExitHandler),s.E.ins.on(o.EventName.SELECT_PK_TARGET1,e,e.onSelectPkTarget1),e.calculateEnterCondition(),e.drawRect(),e.enablePK(!0),e._bossGroup=new a.FightGroup(null),e.manager().enterGamePlay(e),e.creatMonster(),e}return __extends(t,n),t.prototype.onShowHuDunMsg=function(t){t.shieldStart?this.manager().showHuDunView():this.manager().hideHuDunView()},t.prototype.onReward=function(t){if(100==t.type&&this._bossGroup.isDeath()){var e=m.ItemManager.getDropArray(t.inV),i=this._fightGroup.getFUList()[0];y.DropUtil.isfly=!0,i&&(y.DropUtil.createDrop(e,new Laya.Point(i.worldX,i.worldY)),y.DropUtil.flyToRole(i),p.RoleCenter.effectExpAndMoney(t.inV))}},t.prototype.resetRectData=function(){this._sceneOpenStateDic={},this.matrixList=[],this.calculateEnterCondition(),this.drawRect()},t.prototype.creatMonster=function(){var t=p.RoleCenter.instans.self.swyLayer,e=this.manager().getSetting(t).tombstone;this._tombStoneMonsterFG=this.createTombStoneMonster(e)},t.prototype.onExitHandler=function(){var t=this;C.AM.exitPlay(this.type,new Laya.Handler(this,function(){t.executeExit()}))},t.prototype.executeExit=function(){h.ShenweiyuWarManager.getInstance().exitShenWeiYu()},t.prototype.calculateEnterCondition=function(){var t=0,e=p.RoleCenter.instans.self.swyLayer,i=this.manager().getSetting(e).portID[0];this._sceneOpenStateDic[i]=!0;for(var n=this.manager().getSetting(e).portID,s=0;s<n.length;s++)t=Number(n[s]),this._sceneOpenStateDic[t]=!0},t.prototype.setMainRoleByMsg=function(t){n.prototype.setMainRoleByMsg.call(this,t),t.opresult&&this.changeScene(t.portid,t.monsterUid)},t.prototype.clear=function(){n.prototype.clear.call(this),this._enterPortId=-1,this._tombStoneMonsterFG&&(this._tombStoneMonsterFG.destroyGroup(!0),this._tombStoneMonsterFG=null),s.E.ins.off(o.EventName.EXIT_BOSS_PLAYTYPE,this,this.onExitHandler),l.GSM.ins.off(c.swyBossHPGS2C.KEY,this,this.onBattleBossHPGS2C);var t=l.GSM.ins;t.off(c.swyBossHPGS2C.KEY,this,this.onBattleBossHPGS2C),t.off(f.MonsterShieldChg.KEY,this,this.onShowHuDunMsg),t.off(c.swylingjiangGS2C.KEY,this,this.onReward),this.manager().exitGamePlay()},t.prototype.allInit=function(){n.prototype.allInit.call(this);var t=this._mainRole;this._fightGroup&&t&&this._fightGroup.setFGMapXY(t.mapX,t.mapY),this._waitTime=u.ServerTime.serverTime+3,-1!=this._enterPortId&&(this.manager().gotoBossArea(this._enterPortId),this._enterPortId=-1)},t.prototype.gotoBoss=function(t){var e=r.GameConfig.getPortByID(t),i=r.GameConfig.getMapJSON(e.boss_scene);i&&0<i.bossXY.length&&this.followTargetPos(i.bossXY[0][0],i.bossXY[0][1]),this._autoBattleKey=!0},t.prototype.drawRect=function(){var t=0,e=p.RoleCenter.instans.self.swyLayer,i=this.manager().getSetting(e).portID[0],n=this.manager().getSetting(e).portID;t=i,this.createAreaMatrixList(t,t,this._showDebugKey);for(var s=1;s<n.length;s++)t=Number(n[s]),this.createAreaMatrixList(t,t,this._showDebugKey)},t.prototype.manager=function(){return h.ShenweiyuWarManager.getInstance()},t.prototype.changeScene=function(t,e){this._waitTime=u.ServerTime.serverTime,this._currPortId!=t&&(this._currPortId=t,this._currMatrixList=this.changeMatrix()),this.clearOtherPlayer(),this.clearAllState(),this.showMosnter(t,e)},t.prototype.showMosnter=function(t,e){this._bossGroup.destroyGroup(!1),this.releaseAllMonsterRes();var i=r.GameConfig.getPortByID(t),n=r.GameConfig.getMapJSON(i.boss_scene);n&&0<n.bossXY.length&&(this._monsterDic[-1]=this.createMonster(this._bossGroup,i.boss,e),this._bossGroup.resetFightGroup(n.bossXY[0]),this._bossGroup.setMapXY(n.bossXY[0][0],n.bossXY[0][1]),this._tombStoneMonsterFG&&this._tombStoneMonsterFG.setMapXY(n.bossXY[0][0],n.bossXY[0][1])),this.updateBossState(t)},t.prototype.onBattleBossRevive=function(t,e){this.getCurrPortId()==t&&this.showMosnter(t,e)},t.prototype.updateBossState=function(t){t==this._currPortId&&(this._bossStateChangeKey=!0)},t.prototype.changeMatrix=function(){for(var t=[],e=null,i=0;i<this.matrixList.length;i++)(e=this.matrixList[i]).id==this._currPortId&&t.push(e);return t},t.prototype.frameMove=function(){n.prototype.frameMove.call(this),this.updatePlay()},t.prototype.updatePlay=function(){var t=this._mainRole;if(u.ServerTime.serverTime>this._waitTime&&t){var e=t.mapX,i=t.mapY;if(this._currMatrixList&&0<this._currMatrixList.length&&!this.isInMatrixList(this._currMatrixList,e,i))for(var n=null,s=0;s<this.matrixList.length;s++)n=this.matrixList[s],this._currPortId!=n.id&&n.intCoordinate(e,i)&&(this._sceneOpenStateDic[n.id]?(this.reqChangeScene(n.id),this._waitTime=u.ServerTime.serverTime+this._sendCdTime):this._outInfoKey&&(this._outInfoKey=!1,d.FE.upItems(_.TextConst.get(452))))}if(this._ownerFG&&this.manager().updateBossOwnerHp(this._ownerFG.getHp(),this._ownerFG.getTotalHp()),this._bossStateChangeKey)if(this._bossStateChangeKey=!1,h=this.manager().getPortStatus(this._currPortId))if(0==h.bossHP){var o=p.RoleCenter.instans.self.swyLayer;this._bossRelifeTime=h.bossdietime+this.manager().getSetting(o).time[0],this._lastLeftTime=-1,this.visibleBossFG(!1),this.visibleTombStone(!0)}else this._bossRelifeTime=u.ServerTime.serverTime,this.visibleBossFG(!0),this.checkToAttackMonster(),this.visibleTombStone(!1);else this.visibleBossFG(!1),this.visibleTombStone(!1),this._bossRelifeTime=u.ServerTime.serverTime;var a=this._bossRelifeTime-u.ServerTime.serverTime;if(-1!=this._bossRelifeTime&&0<a&&a!=this._lastLeftTime){this._lastLeftTime=a;var r=this._tombStoneMonsterFG,l=r?r.getUnitByIndex(0):null;l&&(l.topHpBar.headName=v.DateUtil.getHMS_countdown(a))}if(this._currTargetFG&&this._currTargetFG.isDeath()&&(this.changeBattleState(0),this._currTargetFG.deathAllPet()),this.fightGroup&&this.fightGroup.isDeath()&&this.fightGroup.deathAllPet(),0==this._invincibleKey&&null==this._targetName&&this._mainRole){switch(this._battleState){case 0:if(this._currTargetFG||2==this._mainRole.action)this._waitAutoAttackBossTime=u.ServerTime.serverTime,this._currTargetFG=null;else if(this._currTargetFG=this.getFreeRevengeTarget(),null==this._currTargetFG){var h=this.manager().getPortStatus(this._currPortId),c=u.ServerTime.serverTime-this._waitAutoAttackBossTime>this._autoAttackBossTime;h&&0<h.bossHP&&c&&c&&(this._waitAutoAttackBossTime=u.ServerTime.serverTime,this._bossGroup&&this.startKillMonster())}}this._currTargetFG&&this.pkStartAndTestDistance(this._currTargetFG.groupID)}},t.prototype.checkToAttackMonster=function(){if(!this._currTargetFG&&""==this.curPkName){var t=this.manager().getPortStatus(this._currPortId);t&&0<t.bossHP&&this._bossGroup&&this.startKillMonster()}},t.prototype.changeBattleState=function(t){var e=n.prototype.changeBattleState.call(this,t);return e&&0==t&&(this._waitAutoAttackBossTime=u.ServerTime.serverTime),e},t.prototype.visibleTombStone=function(t){var e=this._tombStoneMonsterFG;e&&(t?e.addToFightLayer():e.removeFromFightLayer(),e.visibleTopHpBar(t))},t.prototype.reqChangeScene=function(t){var e=this._mainRole;if(e){var i=e.mapX,n=e.mapY,s=e.ways;if(0<s.length){var o=s[s.length-1];this.sendEnterMuSceneC2GS(!0,t,i,n,g.EEnterMuSceneType.CLIENT_REQUEST_SCENE,o.x,o.y)}else this.sendEnterMuSceneC2GS(!0,t,i,n,g.EEnterMuSceneType.CLIENT_REQUEST_SCENE)}},t.prototype.showDeadAlert=function(t,e){n.prototype.showDeadAlert.call(this,t,e),this.manager().showDeadAlert(e)},t.prototype.onBattleBossHPGS2C=function(t){var e=this.manager().getPortStatus(t.portid);null==e?this.manager().getBossInfoDic[t.portid]=t:(0==e.bossHP&&0<t.bossHP&&(this.manager().bossStateChange(t.portid,!1),this.onBattleBossRevive(t.portid,t.monsterUid)),e.bossHP=t.bossHP,e.bossdietime=t.bossdietime),this._monsterDic[t.monsterUid]&&(this.manager().setMonsterHp(t.bossHP),this.setMonsterHp(t.monsterUid,t.bossHP,!0),0==t.bossHP&&(this.bossDead(),this.manager().bossStateChange(t.portid,!0)))},t.prototype.onActivityRebirthGS2C=function(t){this.resetHero(t.userAcc,t.posx,t.posy),n.prototype.onActivityRebirthGS2C.call(this,t)},t.prototype.onMoveEndSC=function(t){n.prototype.onMoveEndSC.call(this,t);var e=Math.floor(t/a.FightGroup.HERO_MAXNUM),i=t%a.FightGroup.HERO_MAXNUM;this._mainRole&&e==this.fightGroup.uId&&i==this._mainRole.index&&(this._autoBattleKey&&(this._autoBattleKey=!1,this.startKillMonster()),""!=this.curPkName&&(this.onSelectPkTarget(this.curPkName),this.curPkName=""))},t.prototype.addPPlayer=function(t){var e=t.getFamilyUid();""==e||null==e?n.prototype.addPPlayer.call(this,t):t.getFamilyUid()!=this._fightGroup.getFamilyUid()?n.prototype.addPPlayer.call(this,t):this.addFamilyMemeber(t)},t.prototype.onSelectPkTarget=function(t){this._playerDic[t]&&n.prototype.onSelectPkTarget.call(this,t)},t.prototype.onSelectPkTarget1=function(t){this.clearAttackStatusList(),this.changeBattleState(0),this._fightGroup.setOnceTarget(null);var e=t.username;this.curPkName=e;var i=this._playerDic[p.RoleCenter.instans.self.username],n=i?i.portId:NaN;n&&n==t.portid?this.onSelectPkTarget(e):this.followTargetPos(t.posx,t.posy)},t.prototype.surePkTarget=function(t){n.prototype.onSelectPkTarget.call(this,t)},t.prototype.setBossOwner=function(t){this._ownerFG=t,this._bossGroup&&!this._bossGroup.isDeath()&&this._bossGroup.setOnceTarget(t)},t.prototype.onClearTargetHandler=function(t){n.prototype.onClearTargetHandler.call(this,t),this._outInfoKey=!0,this._autoBattleKey=!1},t.prototype.setEnterPortId=function(t){this._enterPortId=t},t.prototype.getCurrPortId=function(){return this._currPortId},t}(i.RealTimeBossScene);e.GamePlayShenWeiYu=n}),define("src/g/fight/osprite/play/GamePlayRough",["require","exports","src/g/fight/osprite/play/GamePlayMatCopy","../../../../manager/RoleCenter"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.decMapCopyChallengeTimes=function(){n.RoleCenter.instans.vo.COPYROUGHCOUNT--},e}(i.GamePlayMatCopy);e.GamePlayRough=s}),define("src/g/crossserboss/view/KFShenQiJinDiPortItem",["require","exports","../../../utils/system/ServerTime","../../../utils/system/DateUitl","src/g/fight/osprite/play/kfshenqijindi/KfShenQiJinDiManager","src/init/TextConst"],function(t,e,s,o,a,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(){var t=this.dataSource;this.text_bossName.text=t.bossName,this.text_level.text=t.level+"",this.img_icon.skin=t.iconSkin,t.stateKey?(this.stopCD(),this.text_state.color="#09d51f",this.text_state.text=i.TextConst.get(344)):(this.text_state.color="#ffd409",this.startCD())},t.prototype.startCD=function(){Laya.timer.loop(1e3,this,this.updCd),this.updCd()},t.prototype.updCd=function(){if(this.dataSource){var t=a.KfShenQiJinDiManager.ins(),e=t.getBossVoByPortId(this.dataSource.portId),i=t.getPortStatus(e.port);if(i){var n=i.lastDieTime+e.cd-s.ServerTime.serverTime;n<=0?this.stopCD():this.text_state.text=o.DateUtil.getHMS_countdown(n)}}},t.prototype.stopCD=function(){Laya.timer.clear(this,this.updCd)},t.prototype.destroy=function(t){this.stopCD(),e.prototype.destroy.call(this,t)},t}(ui.hotblood.KFSQJDBossInfoItemUI);e.KFShenQiJinDiPortItem=n}),define("src/g/crossserboss/view/KFShenQiJinDiWarView",["require","exports","src/g/fight/osprite/GameScene","../../../config/GameConfig","../../../manager/LayerManager","../../net/messages/BloodyBattleMsg","../../../utils/ItemUtils","src/g/fight/osprite/play/kfshenqijindi/KfShenQiJinDiManager","src/g/crossserboss/view/KFShenQiJinDiPortItem","../../../core/E","../../../enum/EventName","src/g/boss/view/SCFoeHead","../../../manager/RoleCenter","../../../utils/GPUtils","../../../meta/ChatTemplateVo","src/g/crossserboss/PointWarPlayer","src/init/TextConst"],function(t,e,g,v,i,l,h,f,o,n,a,r,c,u,p,d,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(s){function t(){var t=s.call(this)||this;t._smallMap=null,t._smallMapSprite=new Laya.Sprite,t._bossSprite=new Laya.Sprite,t._image=null,t._monsterList=[];var e=Laya.stage.width,i=Laya.stage.height;t.width=e,t.height=i,t.battleBox.width=e,t.battleBox.height=i,t.battleBox.mouseThrough=!0,t.mouseThrough=!0,t.initList(t.bossInfoList,t.onRenderHandler,o.KFShenQiJinDiPortItem),t.bossInfoList.selectEnable=!0,t.bossInfoList.selectHandler=new Laya.Handler(t,t.onSelectHandler),t.updateListInfo(),t._image=new Laya.Image("res/hotblood/rxzc_wanjiaweizhi.png"),t._image.on(Laya.Event.LOADED,t,t.onRoleImage),t._smallMapSprite.addChild(t._image);for(var n=0;n<6;n++)t._monsterList[n]=new Laya.Image("res/hotblood/rxzc_hongdian01.png"),t._bossSprite.addChild(t._monsterList[n]);return t.foeIndexDict=new Laya.Dictionary,t.familyIndexDict=new Laya.Dictionary,t.playerIndexDict=new Laya.Dictionary,t.bossHead=new d.PointWarPlayer,t.bossHead.setType(0),t.bossHead.right=0,t.bossHead.y=180,t.battleBox.addChild(t.bossHead),t.guiShuZhe=new d.PointWarPlayer,t.guiShuZhe.setType(1),t.guiShuZhe.y=34,t.guiShuZheBox.addChildAt(t.guiShuZhe,0),t.setGuiShuZhe(null),t.imgAttack.visible=t.myFMember.visible=t.foeFMember.visible=!1,t.initList(t.foeList,t.foeRender,d.PointWarPlayer),t.initList(t.myFamilyList,t.familyPlayerRender,d.PointWarPlayer),t.initList(t.playerList,t.playerRender,d.PointWarPlayer),t.familyFriendLink.on(Laya.Event.CLICK,t,t.onLinkHandler),t.guiShuZheBox.on(Laya.Event.CLICK,t,t.attackGuiShuzheHander),t.hideOPlayerButton.visible=!1,t}return __extends(t,s),t.prototype.onRoleImage=function(){this._image.x=-this._image.width/2,this._image.y=-this._image.height/2},t.prototype.initList=function(t,e,i){t.selectEnable=!0,t.hScrollBarSkin="",t.itemRender=i,t.scrollBar.elasticDistance=100,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.onRenderHandler=function(t,e){t.update()},t.prototype.onSelectHandler=function(t){if(-1<t&&t<this.bossInfoList.length){var e=this.bossInfoList.array[t];f.KfShenQiJinDiManager.ins().gotoBossArea(e.portId),this.bossInfoList.selectedIndex=-1}},t.prototype.updateListInfo=function(){var t=f.KfShenQiJinDiManager.ins().getBossInfoDic(),e=null,i=null,n=[],s=null,o=null;for(var a in t)if(e=t[a]){var r=f.KfShenQiJinDiManager.ins().getBossVoByPortId(e.portid);switch(i=new m,n.push(i),s=v.GameConfig.getPortByID(r.port),o=h.ItemUtils.getMonsterVOById(s.boss),i.bossName=o.name,i.portId=r.port,i.level=r.shenliValue,i.iconSkin=h.ItemUtils.getBossIccon(o.id),e.bossState){case l.EBattleBossState.WAIT_REVIVE:console.log("等待复活"),i.stateKey=!1;break;case l.EBattleBossState.CAN_CHALLENGE:console.log("可挑战"),i.stateKey=!0;break;case l.EBattleBossState.NULL:console.error("null")}}this.bossInfoList.array=n},t.prototype.show=function(){if(null==this._smallMap){var t=(h.ItemUtils.getMapUrl()+"{0}/small_2.jpg").replace("{0}","531");this._smallMap=new Laya.Image(t),this.mapBox.addChild(this._smallMap),this.mapBox.addChild(this._smallMapSprite),this.mapBox.addChild(this._bossSprite);i.LayerManager.addInUILayer(this)}this.visible=!0,Laya.timer.frameLoop(1,this,this.update)},t.prototype.hide=function(){Laya.timer.clear(this,this.update),this.visible=!1},t.prototype.exit=function(){Laya.timer.clear(this,this.update),this._smallMapSprite&&(this._smallMapSprite.removeSelf(),this._smallMapSprite=null),this._smallMap&&(this._smallMap.removeSelf(),this._smallMap=null)},t.prototype.update=function(){var t=f.KfShenQiJinDiManager.ins(),e=this._smallMap,i=g.GameScene.ins.map;if(t.gamePlay&&e){var n=t.gamePlay.getSelfPos(),s=n[0]/i.width*e.width,o=n[1]/i.height*e.height;this._smallMapSprite.x=s,this._smallMapSprite.y=o;for(var a=t.getSetting("portId1").value,r=t.getSetting("portId2").value,l=t.getSetting("portId3").value,h=t.getEnterPortID(),c=0;c<this._monsterList.length;c++){var u=a;h==r?u=r:h==l&&(u=l);var p=v.GameConfig.getPortByID(u+c+1),d=v.GameConfig.getMapJSON(p.boss_scene);d&&0<d.bossXY.length&&(s=d.bossXY[0][0]/i.width*e.width,o=d.bossXY[0][1]/i.height*e.height,this._monsterList[c].x=s-9,this._monsterList[c].y=o-9)}}},t.prototype.attackGuiShuzheHander=function(){var t=this.guiShuZhe.getDataAsFightGroup();t&&n.E.ins.event(a.EventName.SELECT_PK_TARGET,t.groupID)},t.prototype.foeRender=function(t,e){t.update2("left"),t.showAttackerEf(),t.on(Laya.Event.CLICK,this,this.attFoeHander)},t.prototype.familyPlayerRender=function(t,e){t.update2("left"),t.on(Laya.Event.CLICK,this,this.attackFamilyList)},t.prototype.playerRender=function(t,e){t.update2("right"),t.on(Laya.Event.CLICK,this,this.attplayerHander)},t.prototype.showView=function(){i.LayerManager.addInUILayer(this)},t.prototype.updFoeList=function(t){var e=u.GPUtils.deleteEmptyData(t,this.foeIndexDict);this.foeList.array=e,u.GPUtils.caculateListH(this.foeList,3),this.imgAttack.visible=e&&0!=e.length},t.prototype.updMyFamilyList=function(t){var e=u.GPUtils.deleteEmptyData(t,this.familyIndexDict);this.myFamilyList.array=e,u.GPUtils.caculateListH(this.myFamilyList,2),this.myFMember.visible=e&&0!=e.length,this.myFMemberNum.text=y.TextConst.get(360,e.length)},t.prototype.updPlayerList=function(t){var e=u.GPUtils.deleteEmptyData(t,this.playerIndexDict,!0);this.playerList.array=e,u.GPUtils.caculateListH(this.playerList,4),this.foeFMember.visible=e&&0!=e.length,this.foeFMemberNum.text=y.TextConst.get(361,e.length)},t.prototype.attplayerHander=function(t){var e=t.currentTarget,i=this.playerIndexDict.get(e.dataSource);n.E.ins.event(a.EventName.SELECT_TARGET_INDEX,i)},t.prototype.attFoeHander=function(t){var e=t.currentTarget,i=this.foeIndexDict.get(e.dataSource);n.E.ins.event(a.EventName.SELECT_REVENGE_TARGET_INDEX,i)},t.prototype.attackFamilyList=function(t){var e=t.currentTarget,i=this.familyIndexDict.get(e.dataSource);n.E.ins.event(a.EventName.SELECT_FAMILYMEMBER_INDEX,i)},t.prototype.changeAttackTarget=function(t){this.clearAttackSign(),null!=t&&(""==t?this.bossHead.updStatus(r.SCFoeHead.BE_ATTACK):(null!=this.guiShuZhe.getDataAsFightGroup()&&this.guiShuZhe.getDataAsFightGroup().groupID==t&&this.guiShuZhe.updStatus(r.SCFoeHead.BE_ATTACK),this.showAttackSignInList(this.foeList,t),this.showAttackSignInList(this.playerList,t),this.showAttackSignInList(this.myFamilyList,t)))},t.prototype.clearAttackSign=function(){this.bossHead.reset(),this.guiShuZhe.reset(),this.clearListAttackSign(this.foeList),this.clearListAttackSign(this.playerList),this.clearListAttackSign(this.myFamilyList)},t.prototype.clearListAttackSign=function(t){for(var e=0;e<t.cells.length;e++)t.cells[e].reset()},t.prototype.showAttackSignInList=function(t,e){for(var i,n=0;n<t.cells.length;n++)(i=t.cells[n]).getName()==e&&i.updStatus(r.SCFoeHead.BE_ATTACK)},t.prototype.onDeath=function(){this.clearAttackSign()},t.prototype.setBoss=function(t,e){this.bossMaxHP=e,this.bossBar.imgTargetFoeHead.skin=h.ItemUtils.getBossIconByPort(t.port),this.bossBar.boss_name.text=t.name,this.bossBar.lvl_txt.visible=!1,this.bossHead.updateBoss(t)},t.prototype.updBossHP=function(t){var e=Math.min(380*t/this.bossMaxHP>>0,380);this.bossBar.progressBar.width=e,this.bossBar.progress_txt.text=(t/this.bossMaxHP*100).toFixed(2)+"%"},t.prototype.setGuiShuZhe=function(t){var e=c.RoleCenter.instans.self;t?(this.guiShuZheBox.visible=!0,this.guiShuZhe.updWinner2(t),e.username==t.groupID||e.ufData.familyUId==t.getFamilyUid()&&""!=e.ufData.familyUId?this.imgFamily.skin="res/fightview/rxzc_wohuitubiao.png":this.imgFamily.skin="res/fightview/rxzc_dihuitubiao.png",e.username==t.groupID?(this.imgowner.visible=!0,this.attackBoss.visible=!1):(this.imgowner.visible=!1,this.attackBoss.visible=!0)):(this.guiShuZheBox.visible=!1,this.imgowner.visible=!1,this.attackBoss.visible=!0)},t.prototype.updGuiShuZheHP=function(t,e){this.guiShuZhe.updBlood(t,e)},t.prototype.visibleBossView=function(t){this.bossBar.visible=t,this.bossHead.visible=t,this.buttonBox.visible=t},t.prototype.onLinkHandler=function(){p.ChatTemplateVo.sendChatTemp(10,[f.KfShenQiJinDiManager.ins().getPortId()])},t}(ui.hotblood.KFSQJDWarUI);e.KFShenQiJinDiWarView=s;var m=function(){this.stateKey=!1,this.portId=-1,this.level=0,this.iconSkin=""};e.HotBloodBossInfoItemData=m}),define("src/g/crossserboss/ctrl/KFShenQiJinDiWarCtrl",["require","exports","../../../core/E","../../../enum/EventName","../../../utils/ItemUtils","../../../enum/SettingEnum","src/g/setting/vo/SettingInfo","src/g/setting/ctrl/SettingCtrl","src/g/fight/osprite/play/kfshenqijindi/KfShenQiJinDiManager","src/g/hotblood/ctrl/HotBloodWarDeathCtrl","src/g/crossserboss/view/KFShenQiJinDiWarView","../../../manager/LayerManager","src/init/TextConst"],function(t,e,n,s,o,i,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(){this._bossHp=0,this.shenliBox=null,this.deathCtrl=new h.HotBloodWarDeathCtrl,n.E.ins.on(s.EventName.KFSHENQIJINDI_SCENE_PANEL,this,this.openPanel)}return t.prototype.openPanel=function(){null==(this.manager().viewCtrl=this).view&&(this.view=new c.KFShenQiJinDiWarView,this.view.fhzc.on(Laya.Event.CLICK,this,this.fhzcHandler),this.view.battleBox.visible=!1,this.view.showView()),null==this.shenliBox&&(this.shenliBox=new ui.hotblood.ShenLiItemUI,this.shenliBox.pos(440,750),this.shenliBox.right=0,u.LayerManager.addInUILayer(this.shenliBox),this.updateShenLiValue(0))},t.prototype.showBattlePanel=function(t){this.currportid=t,this.lastportid=NaN,n.E.ins.on(s.EventName.UPDATE_REVENGE_VIEW_TARGET,this,this.updateFoeListHandler),n.E.ins.on(s.EventName.UPDATE_VIEW_TARGET,this,this.updPlayerListHander),n.E.ins.on(s.EventName.UPDATE_VIEW_FAMILYMEMBER,this,this.updateMyFamilyList),n.E.ins.on(s.EventName.CHANGE_PK_TARGET,this,this.attackTargetChangedHander),n.E.ins.on(s.EventName.OTHER_PLAYER_STATUS_CHANGED,this,this.onOPlayerStatusChanged),this.updHideBtnStatus(),this.view.attackBoss.on(Laya.Event.CLICK,this,this.attackBossHander),this.view.bossHead.on(Laya.Event.CLICK,this,this.attackBossHander),this.view.hideOPlayerButton.on(Laya.Event.CLICK,this,this.hidePlayer),this.view.battleBox.visible=!0;var e=o.ItemUtils.getBossVoByPortId(t),i=o.ItemUtils.getMonsterVOById(t);e&&i&&this.view.setBoss(e,i.HP),this.showLastBossScene()},t.prototype.hideBattlePanel=function(t){void 0===t&&(t=!0),this.view&&(n.E.ins.off(s.EventName.UPDATE_REVENGE_VIEW_TARGET,this,this.updateFoeListHandler),n.E.ins.off(s.EventName.UPDATE_VIEW_TARGET,this,this.updPlayerListHander),n.E.ins.off(s.EventName.UPDATE_VIEW_FAMILYMEMBER,this,this.updateMyFamilyList),n.E.ins.off(s.EventName.CHANGE_PK_TARGET,this,this.attackTargetChangedHander),n.E.ins.off(s.EventName.OTHER_PLAYER_STATUS_CHANGED,this,this.onOPlayerStatusChanged),this.view.attackBoss.off(Laya.Event.CLICK,this,this.attackBossHander),this.view.bossHead.off(Laya.Event.CLICK,this,this.attackBossHander),this.view.hideOPlayerButton.off(Laya.Event.CLICK,this,this.hidePlayer),this.view.battleBox.visible=!1),t&&this.showLastBossScene()},t.prototype.fhzcHandler=function(){var t=this.lastportid;isNaN(t)||l.KfShenQiJinDiManager.ins().gotoBossArea(t)},t.prototype.showLastBossScene=function(){var t=!0;isNaN(this.lastportid)&&(t=!1),this.view&&(this.view.fhzc.visible=t)},t.prototype.updateFoeListHandler=function(t){this.view&&this.view.updFoeList(t)},t.prototype.updateMyFamilyList=function(t){this.view&&this.view.updMyFamilyList(t)},t.prototype.updPlayerListHander=function(t){this.view&&this.view.updPlayerList(t)},t.prototype.attackTargetChangedHander=function(t){this.view&&this.view.changeAttackTarget(t)},t.prototype.exit=function(){this.manager().viewCtrl=null,this.view&&(this.view.battleBox.visible&&this.hideBattlePanel(!1),this.view.removeSelf(),this.view.destroy(!0),this.view=null),this.shenliBox&&(this.shenliBox.removeSelf(),this.shenliBox.destroy(!0),this.shenliBox=null),this.currportid=this.lastportid=NaN,this.deathCtrl.relase(),r.SettingCtrl.getInstance().hideOtehrPlayer(!1)},t.prototype.updateBossHp=function(t){this._bossHp=t,this.view&&this.view.updBossHP(t)},t.prototype.updateBossOwner=function(t){this.view&&this.view.setGuiShuZhe(t)},t.prototype.updateBossOwnerHp=function(t,e){this.view&&this.view.updGuiShuZheHP(t,e)},t.prototype.updateBossState=function(t){this.view&&this.view.updateListInfo()},t.prototype.visibleBossView=function(t){this.view&&this.view.visibleBossView(t)},t.prototype.attackBossHander=function(){this.manager().findBoss()},t.prototype.manager=function(){return l.KfShenQiJinDiManager.ins()},t.prototype.getDeathCtrl=function(){return this.deathCtrl},t.prototype.onDeath=function(t,e,i){var n=this.manager().checkIsMainScene();this.lastportid=n?NaN:this.currportid,this.deathCtrl.onDeath(t,e,i,n),this.view&&this.view.battleBox.visible&&this.view.onDeath()},t.prototype.updJianMianHurt=function(t){this.view&&(this.view.lbHurtJianMian.text=p.TextConst.get(888,t))},t.prototype.onOPlayerStatusChanged=function(){this.updHideBtnStatus()},t.prototype.updHideBtnStatus=function(){1==a.SettingInfo.getSettingValue(i.SettingEnum.hideOtherPlayer)?this.view.hideOPlayerButton.skin="res/fightview/rexue_pingbiguan.png":this.view.hideOPlayerButton.skin="res/fightview/rexue_pingbikai.png"},t.prototype.hidePlayer=function(){a.SettingInfo.getSettingValue(i.SettingEnum.hideOtherPlayer)?r.SettingCtrl.getInstance().hideOtehrPlayer(!1):r.SettingCtrl.getInstance().hideOtehrPlayer(!0)},t.prototype.updateShenLiValue=function(t){100<t&&(t=100),t<0&&(t=0);this.shenliBox.Img_shenli.width=t/100*100,this.shenliBox.Lab_shenli.text=t+"/100"},t}();e.KFShenQiJinDiWarCtrl=d}),define("src/g/fight/osprite/play/kfshenqijindi/KfShenQiJinDiManager",["require","exports","../../../../../core/E","../../../../net/messages/ChangeSceneMsg","../../../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../../../manager/RoleCenter","../../../../../meta/KFSQJDVo","../../../../../config/GameConfig","../../../../../manager/GameSocketManager","../../../../net/messages/ActivityMessage","../../../../net/messages/EnterMuSceneC2GS","../../../../../utils/system/FloatEffect","../../../../../plugin/view/ToolTip","src/g/fight/osprite/play/PlayManager","../../../../../utils/ItemUtils","../../../../../utils/system/ServerTime","../../../../net/messages/BloodyBattleMsg","src/g/accessctrl/AccessCenter","../../../../net/messages/kuafu/KfsqjdBattleMsg","src/init/TextConst","../../../../../manager/AM"],function(t,e,o,a,r,l,h,i,c,n,u,p,d,g,v,f,y,m,_,C,I,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function s(){this.gamePlay=null,this._battleOpenStateMsg=null,this._bossVoInitKey=!1,this._bossVoDic={},this._bossInfoDic={},this._enterTime=-1,this._ownerFG=null,this._relifeTime=-1,this._enterPortId=-1,this.viewCtrl=null,this.isRes=!1,this._panelReqKey=!1}return s.ins=function(){return this._ins||(this._ins=new s),this._ins},s.prototype.getSetting=function(t){var e=c.GameConfig.KFSQJDSettingVo[t];return e||(e=new i.KFSQJDSettingVo)},s.prototype.getBossInfoDic=function(){return this._bossInfoDic},s.prototype.checkIsMainScene=function(t){void 0===t&&(t=0),0==t&&(t=this._enterPortId);var e=s.ins().getSetting("portId1").value,i=s.ins().getSetting("portId2").value,n=s.ins().getSetting("portId3").value;return t==e||t==i||t==n},s.prototype.getPortId=function(){return this.gamePlay?this.gamePlay.getCurrPortId():-1},s.prototype.exitHotBloodWar=function(){this.gamePlay&&this.gamePlay.sendEnterMuSceneC2GS(!1,this.gamePlay.getCurrPortId(),0,0)},s.prototype.onBossKillStateGS2C=function(t){if(this._panelReqKey)this._panelReqKey=!1;else{if(this.setDecHurt(t.bossOwnerDecHurt),this.gamePlay){var e=this.gamePlay.getPlayerFG(t.owneruname);this.setBossOwner(e)}this._bossInfoDic[t.portid]&&this.bossStateChange(this._bossInfoDic[t.portid])}},s.prototype.setDecHurt=function(t){this.viewCtrl&&this.viewCtrl.updJianMianHurt(t)},s.prototype.getPortStatus=function(t){return this._bossInfoDic[t]},s.prototype.updateBossOwnerHp=function(t,e){this.viewCtrl&&this.viewCtrl.updateBossOwnerHp(t,e)},s.prototype.findBoss=function(){this.gamePlay&&this.gamePlay.startKillMonster()},s.prototype.gotoBossArea=function(t){if(this.gamePlay&&this._bossInfoDic[t]){var e=this.checkChangeCondition(t);0==e?this.gamePlay.gotoBoss(t):this.outConditionErrInfo(e,t)}},s.prototype.enterGamePlay=function(t){o.E.ins.event(r.EventName.KFSHENQIJINDI_SCENE_PANEL);var e=n.GSM.ins;e.on(C.KFSQJDBossKillRecordGS2C.KEY,this,this.onBossKillRecordGS2C),e.on(u.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),e.on(C.KFSQJDBattleBossEndGS2C.KEY,this,this.onKFSQJDBattleBossEndGS2C),e.on(u.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChangeGS2C),this.setBossOwner(null),this.gamePlay=t,-1!=this._enterPortId&&t.setEnterPortId(this._enterPortId),e.on(p.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C),Laya.timer.once(3e3,this,this.delayCheck),this.delayCheck(!0)},s.prototype.delayCheck=function(t){if(void 0===t&&(t=!1),this.gamePlay&&(!this.isRes||t)){var e=this.gamePlay,i=this._enterPortId,n=e.getStartPoint();if(!t)return void o.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,l.PlayTypeVo.create(a.EPlayType.PLAYTYPE_PORT));e.sendEnterMuSceneC2GS(!0,i,n[0],n[1])}},s.prototype.exitGamePlay=function(){this.viewCtrl&&(this.viewCtrl.exit(),this.viewCtrl=null),this._enterPortId=-1,this.setBossOwner(null),this._enterTime=y.ServerTime.serverTime+this.getSetting("outTimeCD").value;var t=n.GSM.ins;t.off(C.KFSQJDBossKillRecordGS2C.KEY,this,this.onBossKillRecordGS2C),t.off(u.ActivityRebirthGS2C.KEY,this,this.onActivityRebirthGS2C),t.off(C.KFSQJDBattleBossEndGS2C.KEY,this,this.onKFSQJDBattleBossEndGS2C),t.off(u.BossOwnerChangeGS2C.KEY,this,this.onBossOwnerChangeGS2C),this.gamePlay=null,t.off(p.EnterMuSceneGS2C.KEY,this,this.onEnterMuSceneGS2C),this.checkKFSQJDWarRedPoint(),Laya.timer.clear(this,this.delayCheck)},s.prototype.setMonsterHp=function(t){this.viewCtrl&&this.viewCtrl.updateBossHp(t)},s.prototype.showDeadAlert=function(t){this.viewCtrl.onDeath(t,new Laya.Handler(this,this.onMoneyLife),new Laya.Handler(this,this.onReLife))},s.prototype.onReLife=function(){this.sendRebord(!0)},s.prototype.onMoneyLife=function(){var t=this.getSetting("payForLife").value;h.RoleCenter.instans.self.GOLD<t?d.FE.upItems(I.TextConst.get(460),g.BubbleEnum.center):this.sendRebord(!1)},s.prototype.sendRebord=function(t){if(this.gamePlay){var e=null,i=new u.ActivityRebirthC2GS;i.acttype=u.EACT_TYPE.kfsqjd,e=(i.freeRebirth=t)?this.gamePlay.getStartPoint():this.gamePlay.getSelfPos(),i.posx=e[0],i.posy=e[1],n.GSM.sendServer(i)}else console.error("不在玩法中")},s.prototype.reqBossKillState=function(t,e){void 0===e&&(e=0);var i=new C.KFSQJDBossKillStateC2GS;i.portid=t,n.GSM.sendServer(i),1==e&&(this._panelReqKey=!0)},s.prototype.onKFSQJDBattleActOpenState=function(t){this._battleOpenStateMsg=t},s.prototype.bossStateChange=function(t){var e=t.portid;this.viewCtrl&&this.viewCtrl.updateBossState(e),this.gamePlay&&this.gamePlay.updateBossState(e),this.checkIsShowBossView(e)},s.prototype.onBattleBossStateGS2C=function(t){if(this._bossInfoDic[t.portid]){var e=this._bossInfoDic[t.portid];e&&e.bossState==C.KFSQJDBattleBossState.CAN_CHALLENGE&&t.bossState==C.KFSQJDBattleBossState.WAIT_REVIVE&&o.E.ins.event(r.EventName.HB_BOSSDEATH,t),this._bossInfoDic[t.portid]=t,this.bossStateChange(t)}},s.prototype.onBattleBossStateAll=function(t){this._bossInfoDic={};for(var e=null,i=0;i<t.bossStateArr.length;i++)e=t.bossStateArr[i],this._bossInfoDic[e.portid]=e},s.prototype.checkIsShowBossView=function(t){if(this.viewCtrl&&(this.gamePlay&&this.gamePlay.getCurrPortId()==t))if(this._bossInfoDic[t])switch(this._bossInfoDic[t].bossState){case m.EBattleBossState.CAN_CHALLENGE:this.viewCtrl.visibleBossView(!0);break;case m.EBattleBossState.WAIT_REVIVE:this.viewCtrl.visibleBossView(!1)}else this.viewCtrl.visibleBossView(!1)},s.prototype.onUpdateShenLiValueGS2C=function(t){h.RoleCenter.instans.self.username==t.kf_username&&(this.viewCtrl&&this.viewCtrl.updateShenLiValue(t.shenliValue),100<=t.shenliValue&&this.tipExitGame(10))},s.prototype.tipExitGame=function(t){t<=0||(d.FE.upItems(t+"秒之后退出神器禁地",g.BubbleEnum.center),t-=1,Laya.timer.once(1e3,this,this.tipExitGame,[t]))},s.prototype.onBattleBossReviveGS2C=function(t){var e=this._bossInfoDic[t.portid];e&&(e.bossState=C.KFSQJDBattleBossState.CAN_CHALLENGE,this.bossStateChange(e),this.reqOpenBossInfoPanel(t.portid)),this.gamePlay&&this.gamePlay.onBattleBossReviveGS2C(t)},s.prototype.reqOpenBossInfoPanel=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!0);var i=new C.KFSQJDBattleBossStateC2GS;0==(i.portid=t)&&(i.portid=this.getSetting("portId1").value),i.requestAll=!1,n.GSM.sendServer(i)},s.prototype.onEnterMuSceneGS2C=function(t){if(this.isRes=!0,t.opresult){var e=this.viewCtrl;this.checkIsMainScene(t.portid)?e&&e.hideBattlePanel():(e&&e.showBattlePanel(t.portid),this.setBossOwner(null),this.reqBossKillState(t.portid),this.reqOpenBossInfoPanel(t.portid)),t.enter?(t.enterType==p.EEnterMuSceneType.REVIVE&&e.getDeathCtrl().relase(),this.gamePlay.setMainRoleByMsg(t)):o.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,l.PlayTypeVo.create(a.EPlayType.PLAYTYPE_PORT))}else o.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,l.PlayTypeVo.create(a.EPlayType.PLAYTYPE_PORT)),d.FE.upItems(I.TextConst.showErrorInfo(t.error),g.BubbleEnum.center)},s.prototype.outConditionErrInfo=function(t,e){var i=this.getBossVoByPortId(e),n=null;switch(t){case 0:break;case 1:n=I.TextConst.get(458,f.ItemUtils.getEquipLv(i.limit1));break;case 2:n=I.TextConst.get(459,i.limit2);break;case 3:n=I.TextConst.get(469)}n&&d.FE.upItems(n,g.BubbleEnum.center)},s.prototype.enterHotBloodWar=function(t,e){if(void 0===e&&(e=a.EPlayType.PLAYTYPE_KFSQJD),!h.RoleCenter.instans.bagRoomEnough())return b.AM.showBagNotEnough(),!1;if(v.PlayManager.isSpecialPlay()&&v.PlayManager.type!=e)return d.FE.upItems(I.TextConst.get(406),g.BubbleEnum.center),!1;var i=this.checkChangeCondition(t);if(0!=i)return this.outConditionErrInfo(i,t),!1;if(null!=this.gamePlay)return this._enterPortId=t,s.ins().gotoBossArea(t),!1;if(!this._battleOpenStateMsg)return!1;if(!this._battleOpenStateMsg.actOpen)return d.FE.upItems(I.TextConst.get(455),g.BubbleEnum.center),!1;var n=this._enterTime-y.ServerTime.serverTime;return 0<n?(d.FE.upItems(I.TextConst.get(984,n),g.BubbleEnum.center),!1):(this._enterPortId=t,o.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,l.PlayTypeVo.create(e)),!0)},s.prototype.getEnterPortID=function(){return this._enterPortId},s.prototype.onBossOwnerChangeGS2C=function(t){if(""==t.newowner)this.setBossOwner(null);else{var e=this.gamePlay.getPlayerFG(t.newowner);this.setBossOwner(e)}},s.prototype.setBossOwner=function(t){this._ownerFG!=t&&(this._ownerFG=t,this.updateBossOwner(t)),this.gamePlay&&this.gamePlay.setBossOwner(t)},s.prototype.updateBossOwner=function(t){this.viewCtrl&&this.viewCtrl.updateBossOwner(t)},s.prototype.getPlayerFG=function(t){return this.gamePlay?this.gamePlay.getPlayerFG(t):null},s.prototype.checkKFSQJDWarRedPoint=function(){o.E.ins.event(r.EventName.UPDATE_REDDOT,268)},s.prototype.onKFSQJDBattleBossEndGS2C=function(t){null!=t.bossowner&&""!=t.bossowner?(t.bossowner==h.RoleCenter.instans.self.username&&t.invent&&(h.RoleCenter.instans.addInventoryToC(t.invent),d.FE.addInventoryToCFloats(t.invent)),t.helpData&&t.helpData.isHelp&&t.helpData.invent&&(h.RoleCenter.instans.addInventoryToC(t.helpData.invent),d.FE.addInventoryToCFloats(t.helpData.invent))):console.warn("神器禁地结算没有归属者"),o.E.ins.event(r.EventName.OPEN_HOTBLOOD_RESULT,t),this.gamePlay&&this.gamePlay.getCurrPortId()==t.portid&&this.setBossOwner(null)},s.prototype.onActivityRebirthGS2C=function(t){this.gamePlay&&this.gamePlay.onActivityRebirthGS2C(t),t.opresult?t.userAcc==h.RoleCenter.instans.self.username&&(h.RoleCenter.instans.vo.GOLD-=t.decGold,this.viewCtrl.showLastBossScene()):console.error(t.error)},s.prototype.onBossKillRecordGS2C=function(t){},s.prototype.checkChangeCondition=function(t){if(this.checkIsMainScene(t))return 0;var e=this.getBossVoByPortId(t);if(e){var i=h.RoleCenter.instans.self.getRXPingFen();return h.RoleCenter.instans.self.getCurLv()>=e.limit1?i>=1e4*e.limit2?0:2:1}return 3},s.prototype.getBossVoByPortId=function(t){if(0==this._bossVoInitKey){this._bossVoInitKey=!0;var e=null,i=c.GameConfig.kfsqjdVo;for(var n in i)e=i[n],this._bossVoDic[e.port]=e}return this._bossVoDic[t]},s.prototype.checkIsHaveBossTask=function(){if(0<h.RoleCenter.instans.vo.KFSQJD_CNT){var t=null,e=c.GameConfig.kfsqjdVo;for(var i in e)if(t=e[i],0==this.checkChangeCondition(t.port))return!0}return!1},s.prototype.checkIsEnter=function(){return!!(_.AccessCenter.ins.checkOpen(268)&&0<h.RoleCenter.instans.vo.KFSQJD_CNT)},s.prototype.getFirstChallgeBoss=function(){if(!this.checkIsEnter())return null;var t=this._bossInfoDic,e=null;for(var i in t)if(e=t[i])switch(e.bossState){case m.EBattleBossState.WAIT_REVIVE:break;case m.EBattleBossState.CAN_CHALLENGE:if(0==this.checkChangeCondition(e.portid))return f.ItemUtils.getBossVoByPortId(e.portid);break;case m.EBattleBossState.NULL:}return null},s._ins=null,s}();e.KfShenQiJinDiManager=s}),define("src/g/fight/osprite/play/kfshenqijindi/GamePlayKfShenQiJinDi",["require","exports","../../../../net/messages/kuafu/KfsqjdBattleMsg","../../../../../utils/ItemUtils","../../../../../config/GameConfig","../../../../../core/E","../../../../../utils/system/ServerTime","../../../../../enum/EventName","src/g/fight/osprite/obj/FightGroup","../../../../net/messages/BloodyBattleMsg","../../../../../manager/GameSocketManager","src/g/fight/osprite/play/RealTimeBossScene","../../../../net/messages/EnterMuSceneC2GS","../../../../../manager/RoleCenter","../../../../../utils/system/FloatEffect","../../../../../utils/system/DateUitl","src/g/fight/osprite/play/kfshenqijindi/KfShenQiJinDiManager","src/init/TextConst","../../../../../manager/AM"],function(t,e,s,r,l,o,h,a,c,u,p,i,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t){var e=n.call(this,t)||this;e._showDebugKey=!1,e._currPortId=0,e._currMatrixList=[],e._waitTime=0,e._ownerFG=null,e._sendCdTime=3,e._outInfoKey=!1,e._sceneOpenStateDic={},e._tombStoneMonsterFG=null,e._bossStateChangeKey=!1,e._bossRelifeTime=-1,e._lastLeftTime=-1,e._autoBattleKey=!1,e._enterPortId=-1,e._waitAutoAttackBossTime=-1,e._autoAttackBossTime=5;var i=p.GSM.ins;return i.on(u.BattleBossHPGS2C.KEY,e,e.onBattleBossHPGS2C),i.on(s.KFSQJDBattleBossHPGS2C.KEY,e,e.onBattleBossHPGS2C),o.E.ins.on(a.EventName.EXIT_BOSS_PLAYTYPE,e,e.onExitHandler),o.E.ins.on(a.EventName.REXUE_SCORE_CHANGE,e,e.calculateEnterCondition),e.calculateEnterCondition(),e.drawRect(),e.enablePK(!0),e._bossGroup=new c.FightGroup(null),e.manager().enterGamePlay(e),e.creatMonster(),e}return __extends(t,n),t.prototype.creatMonster=function(){var t=this.manager().getSetting("tombstone").value;this._tombStoneMonsterFG=this.createTombStoneMonster(t)},t.prototype.drawRect=function(){var t=0,e=this.manager().getEnterPortID(),i=this.manager().getSetting("portAllId1").value||"";e==this.manager().getSetting("portId2").value?i=this.manager().getSetting("portAllId2").value||"":e==this.manager().getSetting("portId3").value&&(i=this.manager().getSetting("portAllId3").value||""),t=e,this.createAreaMatrixList(t,t,this._showDebugKey);var n=r.ItemUtils.getPortVoById(t),s=l.GameConfig.getMapJSON(n.boss_scene).doorXY;this.drawSafeArea(s[0],s[1],s[2]);for(var o=i.split(","),a=0;a<o.length;a++)t=Number(o[a]),this.createAreaMatrixList(t,t,this._showDebugKey)},t.prototype.calculateEnterCondition=function(){var t=!1,e=0,i=this.manager().getEnterPortID(),n=this.manager().getSetting("portAllId1").value||"";i==this.manager().getSetting("portId2").value?n=this.manager().getSetting("portAllId2").value||"":i==this.manager().getSetting("portId3").value&&(n=this.manager().getSetting("portAllId3").value||""),this._sceneOpenStateDic[i]=!0;for(var s=n.split(","),o=0;o<s.length;o++)e=Number(s[o]),t=0==this.manager().checkChangeCondition(e),this._sceneOpenStateDic[e]=t},t.prototype.getStartPoint=function(){return this.getCoordinatePos(this.matrixList[0])},t.prototype.clear=function(){n.prototype.clear.call(this),this._enterPortId=-1,this._tombStoneMonsterFG&&(this._tombStoneMonsterFG.destroyGroup(!0),this._tombStoneMonsterFG=null);var t=p.GSM.ins;t.off(u.BattleBossHPGS2C.KEY,this,this.onBattleBossHPGS2C),t.off(s.KFSQJDBattleBossHPGS2C.KEY,this,this.onBattleBossHPGS2C),o.E.ins.off(a.EventName.EXIT_BOSS_PLAYTYPE,this,this.onExitHandler),o.E.ins.off(a.EventName.REXUE_SCORE_CHANGE,this,this.calculateEnterCondition),this.manager().exitGamePlay()},t.prototype.allInit=function(){n.prototype.allInit.call(this),this._fightGroup&&this._mainRole&&this._fightGroup.setFGMapXY(this._mainRole.mapX,this._mainRole.mapY),this._waitTime=h.ServerTime.serverTime+3,-1!=this._enterPortId&&(this.manager().gotoBossArea(this._enterPortId),this._enterPortId=-1)},t.prototype.frameMove=function(){n.prototype.frameMove.call(this),this.updatePlay()},t.prototype.updatePlay=function(){if(h.ServerTime.serverTime>this._waitTime&&this._mainRole){var t=this._mainRole.mapX,e=this._mainRole.mapY;if(this._currMatrixList&&0<this._currMatrixList.length&&!this.isInMatrixList(this._currMatrixList,t,e))for(var i=null,n=0;n<this.matrixList.length;n++)i=this.matrixList[n],this._currPortId!=i.id&&i.intCoordinate(t,e)&&(this._sceneOpenStateDic[i.id]?(this.reqChangeScene(i.id),this._waitTime=h.ServerTime.serverTime+this._sendCdTime):this._outInfoKey&&(this._outInfoKey=!1,v.FE.upItems(m.TextConst.get(452))))}if(this._ownerFG&&this.manager().updateBossOwnerHp(this._ownerFG.getHp(),this._ownerFG.getTotalHp()),this._bossStateChangeKey)if(this._bossStateChangeKey=!1,a=this.manager().getPortStatus(this._currPortId))switch(a.bossState){case u.EBattleBossState.WAIT_REVIVE:this._bossRelifeTime=a.lastDieTime+a.bossCD,this._lastLeftTime=-1,this.visibleBossFG(!1),this.visibleTombStone(!0);break;case u.EBattleBossState.CAN_CHALLENGE:this._bossRelifeTime=h.ServerTime.serverTime,this.visibleBossFG(!0),this.visibleTombStone(!1),this.checkToAttackMonster()}else this.visibleBossFG(!1),this.visibleTombStone(!1),this._bossRelifeTime=h.ServerTime.serverTime;var s=this._bossRelifeTime-h.ServerTime.serverTime;if(-1!=this._bossRelifeTime&&0<s&&s!=this._lastLeftTime){this._lastLeftTime=s;var o=this._tombStoneMonsterFG.getUnitByIndex(0);o&&(o.topHpBar.headName=f.DateUtil.getHMS_countdown(s))}if(this._currTargetFG&&this._currTargetFG.isDeath()&&this.changeBattleState(0),0==this._invincibleKey&&null==this._targetName&&this._mainRole){switch(this._battleState){case 0:if(this._currTargetFG||2==this._mainRole.action)this._waitAutoAttackBossTime=h.ServerTime.serverTime,this._currTargetFG=null;else if(this._currTargetFG=this.getFreeRevengeTarget(),null==this._currTargetFG){var a=this.manager().getPortStatus(this._currPortId),r=h.ServerTime.serverTime-this._waitAutoAttackBossTime>this._autoAttackBossTime;a&&a.bossState==u.EBattleBossState.CAN_CHALLENGE&&r&&(this._waitAutoAttackBossTime=h.ServerTime.serverTime,this._bossGroup&&this.startKillMonster())}}this._currTargetFG&&this.pkStartAndTestDistance(this._currTargetFG.groupID)}},t.prototype.checkToAttackMonster=function(){if(!this._currTargetFG){var t=this.manager().getPortStatus(this._currPortId);t&&t.bossState==u.EBattleBossState.CAN_CHALLENGE&&this._bossGroup&&this.startKillMonster()}},t.prototype.changeBattleState=function(t){var e=n.prototype.changeBattleState.call(this,t);return e&&0==t&&(this._waitAutoAttackBossTime=h.ServerTime.serverTime),e},t.prototype.visibleTombStone=function(t){var e=this._tombStoneMonsterFG;e&&(t?e.addToFightLayer():e.removeFromFightLayer(),e.visibleTopHpBar(t))},t.prototype.reqChangeScene=function(t){if(this._mainRole){var e=this._mainRole.mapX,i=this._mainRole.mapY,n=this._mainRole.ways;if(0<n.length){var s=n[n.length-1];this.sendEnterMuSceneC2GS(!0,t,e,i,d.EEnterMuSceneType.CLIENT_REQUEST_SCENE,s.x,s.y)}else this.sendEnterMuSceneC2GS(!0,t,e,i,d.EEnterMuSceneType.CLIENT_REQUEST_SCENE)}},t.prototype.addFightGroupSvrID=function(t,e){},t.prototype.setMainRoleByMsg=function(t){n.prototype.setMainRoleByMsg.call(this,t),this.addFightGroupSvrID(this._fightGroup,g.RoleCenter.instans.vo.username),t.opresult&&this.changeScene(t.portid,t.monsterUid)},t.prototype.changeScene=function(t,e){this._waitTime=h.ServerTime.serverTime,this._currPortId!=t&&(this._currPortId=t,this._currMatrixList=this.changeMatrix()),this.clearOtherPlayer(),this.clearAllState(),this.showMosnter(t,e)},t.prototype.showMosnter=function(t,e){var i=this._bossGroup;i.destroyGroup(!1),this.releaseAllMonsterRes();var n=l.GameConfig.getPortByID(t),s=l.GameConfig.getMapJSON(n.boss_scene);if(s){var o=s.bossXY;0<o.length&&(this._monsterDic[-1]=this.createMonster(i,n.boss,e),i.resetFightGroup(o[0]),i.setMapXY(o[0][0],o[0][1]),this._tombStoneMonsterFG&&this._tombStoneMonsterFG.setMapXY(o[0][0],o[0][1]))}this.updateBossState(t)},t.prototype.updateBossState=function(t){t==this._currPortId&&(this._bossStateChangeKey=!0)},t.prototype.changeMatrix=function(){for(var t=[],e=null,i=0;i<this.matrixList.length;i++)(e=this.matrixList[i]).id==this._currPortId&&t.push(e);return t},t.prototype.onExitHandler=function(){var t=this;_.AM.exitPlay(this.type,new Laya.Handler(this,function(){t.executeExit()}))},t.prototype.executeExit=function(){this.manager().exitHotBloodWar()},t.prototype.onBattleBossHPGS2C=function(t){this._monsterDic[t.monsterUid]&&(this.manager().setMonsterHp(t.bossHP),this.setMonsterHp(t.monsterUid,t.bossHP,!0),0==t.bossHP&&this.bossDead())},t.prototype.onBattleBossReviveGS2C=function(t){this.getCurrPortId()==t.portid&&this.showMosnter(t.portid,t.monsterUid)},t.prototype.onActivityRebirthGS2C=function(t){this.resetHero(t.userAcc,t.posx,t.posy),n.prototype.onActivityRebirthGS2C.call(this,t)},t.prototype.showDeadAlert=function(t,e){n.prototype.showDeadAlert.call(this,t,e),this.manager().showDeadAlert(e),this.fgDeathHide(e),this.fgDeathHide(t),e.isDeath()&&e.deathAllPet(),t.isDeath()&&t.deathAllPet()},t.prototype.gotoPortCenter=function(t){for(var e=null,i=0;i<this.matrixList.length;i++)if(t==this.matrixList[i].id){e=this.matrixList[i];break}if(e){var n=this.getCoordinatePos(e);this.followTargetPos(n[0],n[1],0)}},t.prototype.gotoBoss=function(t){var e=l.GameConfig.getPortByID(t),i=l.GameConfig.getMapJSON(e.boss_scene);i&&0<i.bossXY.length&&this.followTargetPos(i.bossXY[0][0],i.bossXY[0][1]),this._autoBattleKey=!0},t.prototype.onMoveEndSC=function(t){n.prototype.onMoveEndSC.call(this,t);var e=Math.floor(t/c.FightGroup.HERO_MAXNUM),i=t%c.FightGroup.HERO_MAXNUM;this._mainRole&&e==this.fightGroup.uId&&i==this._mainRole.index&&this._autoBattleKey&&(this._autoBattleKey=!1,this.startKillMonster())},t.prototype.addPPlayer=function(t){var e=t.getFamilyUid();""==e||null==e?n.prototype.addPPlayer.call(this,t):t.getFamilyUid()!=this._fightGroup.getFamilyUid()?n.prototype.addPPlayer.call(this,t):this.addFamilyMemeber(t)},t.prototype.onSelectPkTarget=function(t){var e=this._playerDic[t];if(e){var i=e.getFamilyUid();""==i||null==i?n.prototype.onSelectPkTarget.call(this,t):i!=this._fightGroup.getFamilyUid()?n.prototype.onSelectPkTarget.call(this,t):_.AM.show(m.TextConst.get(453,e.getNickName()),Laya.Handler.create(this,this.surePkTarget,[t]))}},t.prototype.setBossOwner=function(t){this._ownerFG=t,this._bossGroup&&!this._bossGroup.isDeath()&&this._bossGroup.setOnceTarget(this._ownerFG)},t.prototype.surePkTarget=function(t){n.prototype.onSelectPkTarget.call(this,t)},t.prototype.onClearTargetHandler=function(t){n.prototype.onClearTargetHandler.call(this,t),this._outInfoKey=!0,this._autoBattleKey=!1},t.prototype.setEnterPortId=function(t){this._enterPortId=t},t.prototype.getCurrPortId=function(){return this._currPortId},t.prototype.manager=function(){return y.KfShenQiJinDiManager.ins()},t.prototype.onMsgEnter=function(t){return n.prototype.onMsgEnter.call(this,t)},t}(i.RealTimeBossScene);e.GamePlayKfShenQiJinDi=n}),define("src/g/fight/osprite/play/PlayManager",["require","exports","src/g/fight/osprite/play/GamePlay","src/g/fight/osprite/play/GamePlayMatCopy","../../../../manager/RoleCenter","src/g/fight/osprite/play/GamePlayMainCity","../../../net/messages/ActivityMessage","src/g/fight/osprite/play/skyLadder/GamePlaySkyLadder","src/g/fight/osprite/play/family/GamePlayFamilyRuQin","src/g/fight/osprite/play/family/GamePlayFamilySecret","src/g/fight/osprite/play/allpeopleboss/GamePlayPeopleBoss","../../../net/messages/ChangeSceneMsg","src/g/fight/osprite/play/skyPort/GamePlayPagoda","src/g/fight/osprite/play/shenboss/GamePlayShenBoss","src/g/fight/osprite/play/vipboss/GamePlayVipBoss","src/g/fight/osprite/play/zsboss/GamePlayZSBoss","src/g/fight/osprite/play/levelboss/GamePlayLevel","src/g/fight/osprite/play/GamePlayMine","src/g/fight/osprite/play/fieldrevenge/GamePlayFiledRevenge","src/g/fight/osprite/play/expcopy/GamePlayExpCopy","src/g/fight/osprite/play/hangup/GamePlayHangUp","src/g/fight/osprite/play/GamePlayVillage","src/g/fight/osprite/play/gonghuiRevege/GamePlayGongHuiRevenge","src/g/fight/osprite/play/baseplay/vo/WolrdBossVo","src/g/fight/osprite/play/family/GamePlaySandyCityFight","src/g/fight/osprite/play/GamePlayFamilyTask","src/g/fight/osprite/play/mijing/GamePlayMJBoss","src/g/fight/osprite/play/family/GamePlayCallBoss","src/g/fight/osprite/play/hangupexp/GamePlayHangUpExp","src/g/fight/osprite/play/hotbloodwar/GamePlayHotBloodWar","src/g/fight/osprite/play/hotbloodpagoda/GamePlayHotBloodPagoda","src/g/fight/osprite/play/worldboss/GamePlayWorldBoss","src/g/fight/osprite/play/sandynight/GamePlaySandyNight","src/g/fight/osprite/play/GamePlaySBHJ","../../../../core/E","../../../../enum/EventName","src/g/fight/osprite/play/personboss/GamePlayPersonBoss","src/g/fight/osprite/play/CrossSvrBoss/GamePlayCrossSvrBoss","src/g/fight/osprite/play/zhanling/GamePlayZL","src/g/fight/osprite/play/kfhotblood/GamePlayKfHotBlood","src/g/fight/osprite/play/kftplay/GamePlayKFT","src/g/fight/osprite/play/team/GamePlayTeam","src/g/fight/osprite/play/kfsd/GamePlayKFSD","src/g/fight/osprite/play/skyLadder/GamePlayCSAthletics","src/g/fight/osprite/play/team/GamePlayTeamCopy","src/init/GameState","src/g/fight/osprite/play/shenweiyu/GamePlayShenWeiYu","src/g/fight/osprite/play/GamePlayRough","src/g/fight/osprite/play/kfshenqijindi/GamePlayKfShenQiJinDi","src/g/fight/osprite/play/kfzy/GamePlayKFZY"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b,w,S,E,T,A,R,L,x,P,k,D,H,M,G,B,N,U,V,O,F,q,K,Y,j,J,W,z){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var X=function(){function e(){this.crtType=0,this._otherPVKey=!0,this._monsterVKey=!0,this._npcVKey=!0,e._ins=this,H.E.ins.on(M.EventName.GAME_RESTART,this,this.onGameReStart)}return e.prototype.onGameReStart=function(){switch(console.error("PlayManager::onGameReStart"),this.crtType){case u.EPlayType.PLAYTYPE_MAINCITY:case u.EPlayType.PLAYTYPE_PORT:break;default:this.play&&this.play.returnAutoplayPort()}},Object.defineProperty(e,"loading",{get:function(){return this._loading},set:function(t){this._loading=t},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ins",{get:function(){return this._ins},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"play",{get:function(){return this._play},enumerable:!0,configurable:!0}),e.isSpecialPlay=function(t){if(void 0===t&&(t=null),0==this.type)return!1;return 0<Y.GameState.my_team_uid&&(!0,t&&(t!=u.EPlayType.PLAYTYPE_HELPFIGHT&&t!=u.EPlayType.PLAYTYPE_LEGENDCOPY||!1)),!this.canGoToFuben()||e.loading},e.canGoToFuben=function(){return(u.EPlayType.PLAYTYPE_PORT==this.type||u.EPlayType.PLAYTYPE_MAINCITY==this.type)&&!s.RoleCenter.instans.self.newbee},Object.defineProperty(e,"type",{get:function(){return this._ins?this._ins.crtType:0},enumerable:!0,configurable:!0}),e.isCrossSvr=function(){return this.type==u.EPlayType.PLAYTYPE_ALLWORLDBOSS},e.prototype.setPlay=function(t,e){switch(this.crtType=t,this._play&&this._play.clear(),t){case u.EPlayType.PLAYTYPE_MAINCITY:s.RoleCenter.instans.self.newbee?this._play=new I.GamePlayVillage(u.EPlayType.PLAYTYPE_MAINCITY):this._play=new o.GamePlayMainCity(u.EPlayType.PLAYTYPE_MAINCITY,e);break;case u.EPlayType.PLAYTYPE_PRIBOSS:this._play=new G.GamePlayPersonBoss(u.EPlayType.PLAYTYPE_PRIBOSS);break;case u.EPlayType.PLAYTYPE_MEETBOSS:case u.EPlayType.PLAYTYPE_PVP:case u.EPlayType.PLAYTYPE_PORT:this._play=new C.GamePlayHangUp(t,e);break;case u.EPlayType.PLAYTYPE_PORT_LEVEL:this._play=new f.GamePlayLevel(u.EPlayType.PLAYTYPE_PORT_LEVEL);break;case u.EPlayType.PLAYTYPE_REVENGE:this._play=new m.GamePlayFiledRevenge(u.EPlayType.PLAYTYPE_REVENGE,e);break;case u.EPlayType.PLAYTYPE_FIMILYHELPREVENGE:this._play=new b.GamePlayGongHuiRevenge(u.EPlayType.PLAYTYPE_REVENGE,e);break;case u.EPlayType.PLAYTYPE_COPYLADDER:this._play=new r.GamePlaySkyLadder(u.EPlayType.PLAYTYPE_COPYLADDER);break;case u.EPlayType.PLAYTYPE_EXPCOPYPLAY:this._play=new _.GamePlayExpCopy(u.EPlayType.PLAYTYPE_EXPCOPYPLAY);break;case u.EPlayType.PLAYTYPE_COPYGEM:case u.EPlayType.PLAYTYPE_COPYJM:case u.EPlayType.PLAYTYPE_COPYCJ:case u.EPlayType.PLAYTYPE_COPYLL:case u.EPlayType.PLAYTYPE_COPYLW:this._play=new n.GamePlayMatCopy(t);break;case u.EPlayType.PLAYTYPE_COPYZL:this._play=new N.GamePlayZL(t);break;case u.EPlayType.PLAYTYPE_NEWVILLAGE:this._play=new I.GamePlayVillage(u.EPlayType.PLAYTYPE_NEWVILLAGE);break;case u.EPlayType.PLAYTYPE_QUANMINBOSS:w.WolrdBossVo.PORT_TYPE=a.EACT_TYPE.quanminBoss,this._play=new c.GamePlayPeopleBoss(t);break;case u.EPlayType.PLAYTYPE_SHENYUBOSS:w.WolrdBossVo.PORT_TYPE=a.EACT_TYPE.shenBoss,this._play=new d.GamePlayShenBoss(t);break;case u.EPlayType.PLAYTYPE_REBORNBOSS:w.WolrdBossVo.PORT_TYPE=a.EACT_TYPE.rebirthBoss,this._play=new v.GamePlayZSBoss(t);break;case u.EPlayType.PLAYTYPE_WORLDBOSS:this._play=new P.GamePlayWorldBoss(t);break;case u.EPlayType.PLAYTYPE_VIPBOSS:case u.EPlayType.PLAYTYPE_MONTHBOSS:case u.EPlayType.PLAYTYPE_SUPERBOSS:w.WolrdBossVo.PORT_TYPE=a.EACT_TYPE.vipBoss,this._play=new g.GamePlayVipBoss(t);break;case u.EPlayType.PLAYTYPE_PAGODA:this._play=new p.GamePlayPagoda(t);break;case u.EPlayType.PLAYTYPE_SBHJ:this._play=new D.GamePlaySBHJ(t);break;case u.EPlayType.PLAYTYPE_GUILD_INVADE:this._play=new l.GamePlayFamilyRuQin(t,e.portid);break;case u.EPlayType.PLAYTYPE_GUILD_SECRET:this._play=new h.GamePlayFamilySecret(t);break;case u.EPlayType.PLAYTYPE_SUMMONBOSS:w.WolrdBossVo.PORT_TYPE=a.EACT_TYPE.fsummonBoss,this._play=new A.GamePlayCallBoss(t,e);break;case u.EPlayType.PLAYTYPE_MIJINGBOSS:w.WolrdBossVo.PORT_TYPE=a.EACT_TYPE.mijingBoss,this._play=new T.GamePlayMJBoss(t,e);break;case u.EPlayType.PLAYTYPE_FIGHTSC:this._play=new S.GamePlaySandyCityFight(t);break;case u.EPlayType.PLAYTYPE_ENTERMINE:this._play=new y.GamePlayMine(t);break;case u.EPlayType.PLAYTYPE_TASKBOSS:break;case u.EPlayType.PLAYTYPE_TASKFAMILY:this._play=new E.GamePlayFamilyTask(t,e);break;case u.EPlayType.PLAYTYPE_PASSIONPOINT:this._play=new R.GamePlayHangUpExp(t);break;case u.EPlayType.PLAYTYPE_BLOODYBATTLE:this._play=new L.GamePlayHotBloodWar(t);break;case u.EPlayType.PLAYTYPE_KFRX:this._play=new U.GamePlayKfHotBlood(t);break;case u.EPlayType.PLAYTYPE_KFZY:this._play=new z.GamePlayKFZY(t);break;case u.EPlayType.PLAYTYPE_KFTB:this._play=new V.GamePlayKFT(t);break;case u.EPlayType.PLAYTYPE_BLOODYTEMPLE:this._play=new x.GamePlayHotBloodPagoda(t);break;case u.EPlayType.PLAYTYPE_SANDYNIGHT:this._play=new k.GamePlaySandyNight(t);break;case u.EPlayType.PLAYTYPE_ALLWORLDBOSS:this._play=new B.GamePlayCrossSvrBoss(t,e);break;case u.EPlayType.PLAYTYPE_HELPFIGHT:this._play=new O.GamePlayTeam(t);break;case u.EPlayType.PLAYTYPE_KFSD:this._play=new F.GamePlayKFSD(t);break;case u.EPlayType.PLAYTYPE_KFJJC:this._play=new q.GamePlayCSAthletics(u.EPlayType.PLAYTYPE_KFJJC);break;case u.EPlayType.PLAYTYPE_KFSQJD:this._play=new W.GamePlayKfShenQiJinDi(t);break;case u.EPlayType.PLAYTYPE_LEGENDCOPY:this._play=new K.GamePlayTeamCopy(t);break;case u.EPlayType.PLAYTYPE_SWY:case u.EPlayType.PLAYTYPE_SWYKF:this._play=new j.GamePlayShenWeiYu(t);break;case u.EPlayType.PLAYTYPE_ROUGHCOPY:this._play=new J.GamePlayRough(t);break;default:this._play=new i.GamePlay(t)}this._play.otherPlayerVisible(this._otherPVKey),this._play.monsterVisible(this._monsterVKey),this._play.npcVisible(this._npcVKey)},e.prototype.otherPlayerVisible=function(t){this._otherPVKey!=t&&(this._otherPVKey=t,this._play&&this._play.otherPlayerVisible(t))},e.prototype.monsterVisible=function(t){this._monsterVKey!=t&&(this._monsterVKey=t,this.play&&this.play.monsterVisible(t))},e.prototype.npcVisible=function(t){this._npcVKey!=t&&(this._npcVKey=t,this.play&&this.play.npcVisible(t))},e._loading=!1,e}();e.PlayManager=X}),define("src/g/fight/osprite/obj/SelfUnit",["require","exports","../../../../manager/StateManger","../../../../component/GEffectAnimation","../../../../core/E","../../../../enum/EventName","../../../net/messages/PutonEquipC2GS","../../../../manager/TaskManager","../../../../enum/Task","../../../../manager/RoleCenter","src/g/fight/osprite/obj/SelfBaseUnit","../../../../utils/SoundUtils","../../../../enum/JobEnum","../../../../manager/LayerManager","../../../../config/GameConfig","src/g/fight/osprite/play/PlayManager","../../../net/messages/ChangeSceneMsg","src/g/fight/osprite/play/MainCityManager","src/g/fight/osprite/map/MapConst","src/init/GameState"],function(t,e,o,i,a,r,s,l,h,c,n,u,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(n){function t(){var t=n.call(this)||this;t.pathFindEffect=new i.GEffectAnimation,t.pathFindEffect.y=250,t.pathFindEffect.x=100,t.pathFindEffect.interval=100,t.view.bgLayer.addChild(t.pathFindEffect);var e=a.E.ins;return e.on(r.EventName.EQUIPS_PUTON+t.job+s.EPosEquip.wuqi,t,t.putOnWeapon),e.on(r.EventName.EQUIPS_PUTON+t.job+s.EPosEquip.yifu,t,t.putOnCoat),e.on(r.EventName.UPDATE_MEDAL_STAR,t,t.updateMedalHandler),e.on(r.EventName.TITLE_SHOW_CHANGED,t,t.titleIconHandler),e.on(r.EventName.ZL_ANI,t,t.showZlAni),e.on(r.EventName.HL_ANI,t,t.showHlAni),e.on(r.EventName.CHG_NICKNAME,t,t.changeName),e.on(r.EventName.SOCIETY_SELFUFDATACHANGE,t,t.changeFamilyName),e.on(r.EventName.Fchange,t,t.changeFamilyName),t}return __extends(t,n),t.prototype.checkHandlerCoat=function(){var t;t=this.sex?"male":"female";for(var e=[],i=1;i<=3;i++){var n="dynamic2/role/"+t+"/0/"+i+"_a.json";e.push(n);n="dynamic2/role/"+t+"/0/"+i+"_r.json";e.push(n);n="dynamic2/role/"+t+"/0/"+i+"_s.json";e.push(n)}var s=!0;for(i=0;i<e.length;i++)Laya.Loader.getAtlas(e[i])||(s=!1);s&&(Laya.timer.clear(this,this.checkHandlerCoat),o.StateManger.coatvisible=!0),this.coat.visible=s},t.prototype.changeName=function(){this.topHpBar&&(this.topHpBar.headName=c.RoleCenter.instans.vo.nickname)},t.prototype.changeFamilyName=function(){Laya.timer.once(1e3,this,function(){this.topHpBar&&(this.topHpBar.familyName=c.RoleCenter.instans.ufVo._ufdata.familyName)})},t.prototype.set_DATA=function(t){n.prototype.set_DATA.call(this,t),this.updateMedalHandler(),this.topHpBar.typeElement=1},t.prototype.titleIconHandler=function(){this.setTitleArr(c.RoleCenter.instans.vo.titleData.curTitle.concat())},t.prototype.updateMedalHandler=function(){var t=c.RoleCenter.instans.vo.medal_star;if(this.topHpBar){t&&this.topHpBar.setMedalIcon(t);var e=c.RoleCenter.instans.ufVo._ufdata.familyName;e&&(this.topHpBar.familyName=e);var i=c.RoleCenter.instans.vo.chopLv;if(60<=c.RoleCenter.instans.vo.getCurLv())for(var n in g.GameConfig.chopJSON){var s=g.GameConfig.chopJSON[n];if(s.level==i){this.topHpBar.setChopName(" "+s.name+" ",s.quality);break}}}},t.prototype.onMoveEnd=function(){if(3==this.status)this.ability.checkNearNpc();else if(this.moveTarget){var t=this.moveTarget;this.moveTarget=null,a.E.ins.event(r.EventName.OPEN_NPC_PANEL,[t.data.moduleID,t.id]),console.log("走到npc跟前了moduleID:"+t.data.moduleID)}u.SoundUtils.getInstance().stopSoundById(u.SoundUtils.soundMoveId),d.LayerManager.fightLayer.showAutoSearch(!1),this.handleSafeArea(),a.E.ins.event(r.EventName.SELF_UNIT_MOVE_END),n.prototype.onMoveEnd.call(this)},t.prototype.handleSafeArea=function(){v.PlayManager.type==f.EPlayType.PLAYTYPE_MAINCITY&&y.MainCityManager.getInstance().checkIsSafe(this.mapX,this.mapY)},t.prototype.move=function(t,e){n.prototype.move.call(this,t,e),c.RoleCenter.instans.self.newbee&&this.changeMusic()},t.prototype.changeMusic=function(){},t.prototype.chg_HP=function(t,e,i,n){if(this.hpchanges.length)t=this.hpchanges.pop();else{if(!_.GameState.clientChangeHp)return;var s=this.getHp()+t;this.setHp(s)}this.floatBlood(t,5,i,n),a.E.ins.event(r.EventName.ROLE_HP_CHANGE)},t.prototype.svrSetHP=function(t,e){void 0===e&&(e=!0);var i=t-this.getHp();e&&this.hpchanges.push(i),this.setHp(t)},t.prototype.resetHP=function(t){void 0===t&&(t=!0),n.prototype.resetHP.call(this,t),a.E.ins.event(r.EventName.ROLE_HP_CHANGE)},t.prototype.playAnimation=function(t,e,i){void 0===e&&(e=-1),void 0===i&&(i=null),n.prototype.playAnimation.call(this,t,e,i),2!=t&&(u.SoundUtils.getInstance().stopSoundById(u.SoundUtils.soundMoveId),d.LayerManager.fightLayer.showAutoSearch(!1))},t.prototype.moveToMapPoint=function(t,e,i){this.moveTarget=i,n.prototype.moveToMapPoint.call(this,t,e)},t.prototype.setNPCTarget=function(t){t.topHpBar.tanHao(!0),n.prototype.setNPCTarget.call(this,t)},t.prototype.moveToNpcPoint=function(t,e){this.moveToMapPoint(t[0]*m.MapConst.MAP_TILED_W+m.MapConst.MAP_TILED_W/2,t[1]*m.MapConst.MAP_TILED_W+m.MapConst.MAP_TILED_W/2,e),this.ways.length&&d.LayerManager.fightLayer.showAutoSearch(!0)},t.prototype.moveTo=function(t){n.prototype.moveTo.call(this,t),this.ways.length&&d.LayerManager.fightLayer.showAutoSearch(!0)},t.prototype.setFightTarget=function(t){if(t&&l.TaskManager.ins.currentTask&&l.TaskManager.ins.currentTask.type==h.TaskType.KillMonsters&&(!this.pickupTargets||0==this.pickupTargets.length)&&!l.TaskManager.ins.isFinish){var e=t.newUid;a.E.ins.event(r.EventName.TASK_SEND_FIGHT_START,e)}n.prototype.setFightTarget.call(this,t)},t.prototype.deathHide=function(){if(n.prototype.deathHide.call(this),this.job==p.JobEnum.DAOSHI){var t=this._fightGroup;t&&t.deathAllPet()}},t.prototype.putOnWeapon=function(t){this.weaponId=t;for(var e=[],i=1;i<=3;i++){var n="dynamic2/weapon/"+t+"/"+i+"_a.json";e.push(n);n="dynamic2/weapon/"+t+"/"+i+"_r.json";e.push(n);n="dynamic2/weapon/"+t+"/"+i+"_s.json";e.push(n)}Laya.loader.load(e)},t.prototype.putOnCoat=function(t){this.avatarId=t},t.prototype.destroyUnit=function(){var t=a.E.ins;t.off(r.EventName.EQUIPS_PUTON+this.job+s.EPosEquip.wuqi,this,this.putOnWeapon),t.off(r.EventName.EQUIPS_PUTON+this.job+s.EPosEquip.yifu,this,this.putOnCoat),t.off(r.EventName.UPDATE_MEDAL_STAR,this,this.updateMedalHandler),t.off(r.EventName.TITLE_SHOW_CHANGED,this,this.titleIconHandler),t.off(r.EventName.ZL_ANI,this,this.showZlAni),t.off(r.EventName.HL_ANI,this,this.showHlAni),t.off(r.EventName.CHG_NICKNAME,this,this.changeName),t.off(r.EventName.SOCIETY_SELFUFDATACHANGE,this,this.changeFamilyName),t.off(r.EventName.Fchange,this,this.changeFamilyName),n.prototype.destroyUnit.call(this)},t}(n.SelfBaseUnit);e.SelfUnit=C}),define("src/g/fight/base/InteractionLayer",["require","exports","src/g/fight/osprite/map/MainCamera","src/g/fight/osprite/obj/MapTargetPoint","src/g/fight/osprite/SceneObjCtroller","src/g/fight/osprite/GameScene","../../../manager/TaskManager","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","src/init/GameState","../../../manager/GameSocketManager"],function(t,e,u,p,d,g,v,f,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function c(t){(this._layer=t).on(laya.events.Event.CLICK,this,this.onClickHandler)}return c.prototype.destroy=function(){this._layer.off(laya.events.Event.CLICK,this,this.onClickHandler);var t=this._targtAni;t&&(t.destory(),this._targtAni=null)},c.prototype.onClickHandler=function(t){var e=v.TaskManager.ins;if(C.GSM.connected&&!_.GameState.joint_attack_guide_state&&!_.GameState.transmitting&&(c.tracePosKey||c.canClick)&&(!e.currentTask||1850!=e.currentTask.id)){var i=this._targtAni;i||(this._targtAni=i=new p.MapTargetPoint,i.init());var n=d.SceneObjCtroller.ins.self,s=d.SceneObjCtroller.ins.getSelfGroup(),o=g.GameScene.ins.map;if(n){var a=u.MainCamera.ins.stageToMap(new Laya.Point(t.stageX,t.stageY));i.setMapXY(a.x,a.y);var r=i.worldX,l=i.worldY,h=!1;if(c.netMove&&!m.RoleCenter.instans.self.newbee&&(h=!0),o.isCross([r,l]))e.active=!1,s&&s.stand(),i.addToMap(!0),f.E.ins.event(y.EventName.ClEAR_TARGET,{move:!0,x:a.x,y:a.y}),s.moveToMapPoint(a.x,a.y,h),n.ability.clearDelayAttack(),0==n.ways.length?n.stand():n.playMove(),i.alpha=1,Laya.timer.clearAll(this),2==o.getMapDate(r,l)&&(i.alpha=.4),n.ability.resetPrevPos();else i.addToMap(!1),f.E.ins.event(y.EventName.ClEAR_TARGET,{move:!1,x:a.x,y:a.y})}}},c.canClick=!0,c.netMove=!1,c.tracePosKey=!1,c}();e.InteractionLayer=i}),define("src/g/fight/osprite/map/MapMask",["require","exports","../../../../core/E","../../../../enum/EventName","../../../../utils/UIUtils","../../../../enum/LoadPriority"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){this.urls=["dynamic/mapmask/black00.png","dynamic/mapmask/black02.png"]}return t.prototype.init=function(t){this._container=t,i.E.ins.on(n.EventName.OPEN_CONTINUED_SKILL,this,this.onOpenContinuedSkill),i.E.ins.on(n.EventName.CLOSE_CONTINUED_SKILL,this,this.onCloseContinuedSkill)},t.prototype.onOpenContinuedSkill=function(){this._open||(this._open=!0,s.UIUtils.loadAtlasArr(this.urls,this,this.onAtlasLoaded,o.LoadPriority.UI))},t.prototype.onAtlasLoaded=function(){this._open&&this._container&&(this.img1=new Laya.Image(this.urls[0]),this.img1.width=Laya.stage.width,this.img1.height=Laya.stage.height,this.img1.alpha=0,this.img2=new Laya.Image(this.urls[1]),this.img2.width=Laya.stage.width,this.img2.height=Laya.stage.height,this.img2.alpha=0,this._container.addChild(this.img1),this._container.addChild(this.img2),Laya.Tween.to(this.img1,{alpha:.5},500),Laya.Tween.to(this.img2,{alpha:1},1e3))},t.prototype.onCloseContinuedSkill=function(){this._open=!1,this.img1&&(Laya.Tween.clearAll(this.img1),this.img1.removeSelf(),this.img1.destroy(),this.img1=null),this.img2&&(Laya.Tween.clearAll(this.img2),this.img2.removeSelf(),this.img2.destroy(),this.img2=null)},t.prototype.destroy=function(){this.onCloseContinuedSkill(),this._container=null,i.E.ins.off(n.EventName.OPEN_CONTINUED_SKILL,this,this.onOpenContinuedSkill),i.E.ins.off(n.EventName.CLOSE_CONTINUED_SKILL,this,this.onCloseContinuedSkill)},t}();e.MapMask=a}),define("src/g/fight/osprite/map/MapScene",["require","exports","../../../../manager/LayerManager","src/g/fight/osprite/map/MapConst","src/g/fight/osprite/map/MapLayers","../../../../enum/GameConst","src/g/fight/base/InteractionLayer","../../../../core/E","../../../../enum/EventName","src/g/fight/osprite/map/MapMask","src/g/fight/osprite/map/MapLoadQueue"],function(t,e,s,v,o,a,r,i,n,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(){this._id=0,this._x=0,this._y=0,this._width=0,this._height=0,this._countW=0,this._countH=0,this._mapTileW=0,this._mapTileH=0,this._rect=new Laya.Rectangle,this._paddingRect=new Laya.Rectangle,this._mapSprite=null,this._mouseInputLayer=null,this._mapMask=null,this._gridArray=[],this._gridW=0,this._gridH=0,this._gridWidth=256,this._gridHeight=256,this._mapRect=new u,this._mapLastRect=new u,this._colorArray=["FF","00","33","66"],this._scale=1,this._pivotScaleX=1,this._pivotScaleY=1,this._centerX=0,this._centerY=0,this._viewPortX=0,this._viewPortY=0,this._viewPortWidth=0,this._viewPortHeight=0,this._isDeBug=!1,this.mapjson="",this._resetLastViewRectKey=!1,this.canMove=!1,v.MapConst.SCREEN_WIDTH=Laya.stage.width,v.MapConst.SCREEN_HEIGHT=Laya.stage.height,this._viewRect=new Laya.Rectangle(0,0,v.MapConst.SCREEN_WIDTH,v.MapConst.SCREEN_HEIGHT)}return t.prototype.createMap=function(t,e){var i=(this.mapVo=t).mapID;this.canMove=!!t.move,this._rect.x=this._viewRect.x,this._rect.y=this._viewRect.y,this._rect.width=this._viewRect.width,this._rect.height=this._viewRect.height,this._viewPortWidth=this._viewRect.width/this._scale,this._viewPortHeight=this._viewRect.height/this._scale,this._paddingRect.setTo(0,0,0,0),this._mapComplte=e,null==this._mapLayer&&(this._mapLayer=new o.MapLayers),this._mapSprite=new Laya.Sprite,s.LayerManager.fightLayer.bgLayer.addChild(this._mapSprite),this._mouseInputLayer||(this._mouseInputLayer=new Laya.Sprite,this._mouseInputLayer.width=Laya.stage.width,this._mouseInputLayer.height=Laya.stage.height,this._mouseInputLayer.mouseEnabled=!0,s.LayerManager.fightLayer.bgLayer.addChild(this._mouseInputLayer)),this._moveCtrl&&(this._moveCtrl.destroy(),this._moveCtrl=null);var n=a.GameConst.MAP_RES_URL+i+"/"+i+".json";this._mapjsonurl=n,o.MapLayers.mapsmallurl&&Laya.loader.clearRes(o.MapLayers.mapsmallurl,!0),o.MapLayers.mapsmallurl=a.GameConst.MAP_RES_URL+i+"/small.jpg",this._mapLayer.showSmallMap(),this._mapLayer.scrollRect=new Laya.Rectangle(0,0,Laya.stage.width,Laya.stage.height),Laya.timer.clear(this,this.retryHandler),Laya.loader.cancelLoadByUrl(n),h.MapLoadQueue.instans.mapJsonIndex[i]||(h.MapLoadQueue.instans.mapJsonIndex[i]=1),Laya.loader.load(n,new Laya.Handler(this,this.jsonComplete))},t.prototype.enalbeScrollRect=function(t){this._mapLayer&&(this._mapLayer.scrollRect=t?new Laya.Rectangle(0,0,Laya.stage.width,Laya.stage.height):null)},t.prototype.checkLinePath=function(t,e,i,n){var s=v.MapConst.MAP_TILED_W,o=Math.floor(t/s),a=Math.floor(e/s),r=Math.floor(i/s),l=Math.floor(n/s),h=new Laya.Point(i-t,n-e);h.normalize(),0==h.x&&(h.x=1e-6);var c=1;h.y<0&&(c=-1);var u=1;h.x<0&&(u=-1);for(var p=o;0<=u?p<=r:r<=p;p+=u){var d=0<u?p+u:p+u+1,g=Math.floor(((d*s-t)/h.x*h.y+e)/s);if(!this.isCrossXY(p,a))return!1;for(;(0<=c?a<g:g<a)&&(0<=c?a<l:l<a);)if(a+=c,!this.isCrossXY(p,a))return!1}return!0},t.prototype.retryHandler=function(){Laya.loader.load(this._mapjsonurl,new Laya.Handler(this,this.jsonComplete))},t.prototype.jsonComplete=function(t){if(t){for(this.mapData=t.data,this._id=t.id,this._res=t.res,this._countW=t._mapTileNumW,this._countH=t._mapTileNumH,this._mapTileW=v.MapConst.MAP_TILED_W,this._mapTileH=v.MapConst.MAP_TILED_W,this._width=v.MapConst.MAP_TILED_W*this._countW,this._height=v.MapConst.MAP_TILED_W*this._countH,this._mapLayer.setSmallSize(this._width,this._height),this._mapLastRect.top=this._mapLastRect.bottom=this._mapLastRect.left=this._mapLastRect.right=-1,this._gridWidth=Math.floor(this._gridWidth/this._mapTileW)*this._mapTileW,this._gridHeight=Math.floor(this._gridHeight/this._mapTileH)*this._mapTileH,this._gridW=Math.ceil(this._width/this._gridWidth),this._gridH=Math.ceil(this._height/this._gridHeight),o=0;o<this._gridW;o++){var e=[];this._gridArray.push(e);for(var i=0;i<this._gridH;i++)e.push(null)}this._mapLayer.init(this),this._mapSprite.addChild(this._mapLayer),this._mapMask?(this._mapMask.destroy(),this._mapMask=null):(this._mapMask=new l.MapMask,this._mapMask.init(this._mapSprite)),this._isDeBug&&(this._mapBlockLayer=new Laya.Image,this._mapBlockLayer.alpha=.5,this._mapSprite.addChild(this._mapBlockLayer),this._pathLayer=new Laya.Image,this._mapSprite.addChild(this._pathLayer)),this.graph=null;for(var n,s=[],o=0;o<this._countH;o++){n=new Array(this._countW);for(i=0;i<this._countW;i++)n[i]=t.data[o*this._countW+i],this._isDeBug&&0<n[i]&&this._mapBlockLayer.graphics.drawRect(i*v.MapConst.MAP_TILED_W,o*v.MapConst.MAP_TILED_W,v.MapConst.MAP_TILED_W,v.MapConst.MAP_TILED_W,"#ff0000","#000000");s[o]=n}if(this.graph=new window.Graph(s,{diagonal:!0}),this._mapComplte){if(!this.graph)throw new Error("Graph 不应该为空");this._mapComplte.runWith(t)}this.canMove&&null==this._moveCtrl&&(this._moveCtrl=new r.InteractionLayer(this._mouseInputLayer)),this._resetLastViewRectKey=!0}else Laya.timer.once(1e3,this,this.retryHandler)},t.prototype.getMapDate=function(t,e){return this.mapData[e*this._countW+t]},t.prototype.doSearch=function(t,e,i,n){if(this.checkLinePath(t,e,i,n))return[new Laya.Point(i,n)];for(var s=this.doSearch2(t/v.MapConst.MAP_TILED_W,e/v.MapConst.MAP_TILED_W,i/v.MapConst.MAP_TILED_W,n/v.MapConst.MAP_TILED_W),o=null,a=0;a<s.length;a++)o=new Laya.Point(s[a].y*v.MapConst.MAP_TILED_W+v.MapConst.MAP_TILED_W/2,s[a].x*v.MapConst.MAP_TILED_W+v.MapConst.MAP_TILED_W/2),s[a]=o;return o=new Laya.Point(i,n),s.push(o),1==s.length?s:this.bestPath(t,e,s)},t.prototype.doSearch2=function(t,e,i,n){var s=[];try{if(!this.graph)return[];var o=Math.floor(t),a=Math.floor(e),r=Math.floor(i),l=Math.floor(n);if(o<0||a<0||r<0||l<0)return[];if(o>=this._countW||r>=this._countW)return[];if(a>=this._countH||l>=this._countH)return[];var h=this.graph.grid[a][o],c=this.graph.grid[l][r];return h&&c?(s=window.astar.search(this.graph,h,c),this._isDeBug&&this.drewPath(s,"#0000ff"),s):[]}catch(t){return[]}},t.prototype.drewPath=function(t,e){for(var i=t.length,n=0;n<i-1;)this._pathLayer.graphics.drawLine(t[n].y*v.MapConst.MAP_TILED_W+v.MapConst.MAP_TILED_W/2,t[n].x*v.MapConst.MAP_TILED_W+v.MapConst.MAP_TILED_W/2,t[n+1].y*v.MapConst.MAP_TILED_W+v.MapConst.MAP_TILED_W/2,t[n+1].x*v.MapConst.MAP_TILED_W+v.MapConst.MAP_TILED_W/2,e),n++},t.prototype.drewLocalPath=function(t,e){if(this._isDeBug)for(var i=t.length,n=0;n<i;)this._pathLayer.graphics.drawCircle(t[n].x,t[n].y,5,e),n++},t.prototype.bestPath=function(t,e,i){for(var n=[],s=t,o=e,a=0,r=0,l=0;l<i.length;l++)a=this.checkLinePath(s,o,i[l].x,i[l].y)?l:(s=i[l=a].x,o=i[l].y,n.push(i[l]),r=l,++l);return 0<i.length&&r!=i.length-1&&n.push(i[i.length-1]),n},t.prototype.tryLineTo=function(t,e){var i=t.x*v.MapConst.MAP_TILED_W+v.MapConst.MAP_TILED_W/2,n=t.y*v.MapConst.MAP_TILED_W+v.MapConst.MAP_TILED_W/2,s=e.x*v.MapConst.MAP_TILED_W+v.MapConst.MAP_TILED_W/2,o=e.y*v.MapConst.MAP_TILED_W+v.MapConst.MAP_TILED_W/2;return this.checkLinePath(i,n,s,o)},t.prototype.isSameMap=function(t){return!(!t||this._id!=t)&&!!this.graph},t.prototype.isCross=function(t){return!!this.graph&&(!!this.graph.grid&&(!(t[0]<0||t[1]<0)&&(!!this.graph.grid[t[1]]&&(!!this.graph.grid[t[1]][t[0]]&&(!(this.graph.grid.length<=t[1]||this.graph.grid[t[1]].length<=t[0])&&this.graph.grid[t[1]][t[0]].weight!=v.MapConst.TILED_WEIGHT_NOPASS)))))},t.prototype.isCrossXY=function(t,e){return!!this.graph&&(!!this.graph.grid&&(!(t<0||e<0)&&(!!this.graph.grid[e]&&(!!this.graph.grid[e][t]&&(!(this.graph.grid.length<=e||this.graph.grid[e].length<=t)&&this.graph.grid[e][t].weight!=v.MapConst.TILED_WEIGHT_NOPASS)))))},t.prototype.isCrossMapXY=function(t,e){return this.isCrossXY(Math.floor(t/v.MapConst.MAP_TILED_W),Math.floor(e/v.MapConst.MAP_TILED_W))},t.prototype.findNextStep=function(t,e){if(t&&e){if(t[0]-e[0]==0&&t[1]-e[1]==0)return null;if(Math.abs(t[0]-e[0])<=1&&Math.abs(t[1]-e[1])<=1)return this.isCross(e)?this.graph.grid[e[1]][e[0]]:null;var i=[],n=t[0],s=t[1];i.push([n-1,s]),i.push([n+1,s]),i.push([n,s-1]),i.push([n,s+1]),i.push([n-1,s-1]),i.push([n+1,s-1]),i.push([n-1,s+1]),i.push([n+1,s+1]);for(var o,a=i.length,r=0,l=-1,h=-1;r<a;)this.isCross(i[r])&&(o=(i[r][0]!=t[0]&&i[r][1]!=t[1]?1.41421:1)+(Math.abs(i[r][0]-e[0])+Math.abs(i[r][1]-e[1])),(-1==l||o<l)&&(l=o,h=r)),r++;if(-1!=h)return this.graph.grid[i[h][1]][i[h][0]]}return null},t.prototype.isTranslucent=function(t){return!(!this.graph.grid[t[1]]||!this.graph.grid[t[1]][t[0]])&&this.graph.grid[t[1]][t[0]].weight==v.MapConst.TILED_WEIGHT_TRANSLUCENT},t.prototype.setViewPortPivotByScale=function(t,e){this._pivotScaleX=t,this._pivotScaleY=e},t.prototype.shock=function(){this._mapLayer.x=5,this._mapLayer.y=20,Laya.Tween.clearAll(this._mapLayer),Laya.Tween.to(this._mapLayer,{y:0},300,Laya.Ease.elasticOut),Laya.Tween.to(this._mapLayer,{x:0},250,Laya.Ease.elasticInOut)},Object.defineProperty(t.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale=t,this._viewPortWidth=this._rect.width/t,this._viewPortHeight=this._rect.height/t,this._mapSprite.scale(this._scale,this._scale),this.updateViewPort()},enumerable:!0,configurable:!0}),t.prototype.moveViewPort=function(t,e){this._x=-t,this._y=-e,this._rect.x=t,this._rect.y=e,this.updateViewPort()},t.prototype.changeViewPort=function(t,e,i,n){this._x=-t,this._y=-e,this._rect.x=t,this._rect.y=e,this._rect.width=i,this._rect.height=n,this._viewPortWidth=i/this._scale,this._viewPortHeight=n/this._scale,this.updateViewPort()},t.prototype.changeViewPortBySize=function(t,e,i){return void 0===i&&(i=null),null==i&&(i=new Laya.Rectangle),this._centerX=this._rect.x+this._rect.width*this._pivotScaleX,this._centerY=this._rect.y+this._rect.height*this._pivotScaleY,i.x=this._centerX-t*this._pivotScaleX,i.y=this._centerY-e*this._pivotScaleY,i.width=t,i.height=e,this.changeViewPort(i.x,i.y,i.width,i.height),i},t.prototype.updateViewPort=function(){this._centerX=this._rect.x+this._rect.width*this._pivotScaleX,this._centerY=this._rect.y+this._rect.height*this._pivotScaleY,this._viewPortX=this._centerX-this._rect.width*this._pivotScaleX/this._scale,this._viewPortY=this._centerY-this._rect.height*this._pivotScaleY/this._scale;var t=this._paddingRect;this._mapRect.top=Math.floor((this._viewPortY-t.y)/this._gridHeight),this._mapRect.bottom=Math.floor((this._viewPortY+this._viewPortHeight+t.height+t.y)/this._gridHeight),this._mapRect.left=Math.floor((this._viewPortX-t.x)/this._gridWidth),this._mapRect.right=Math.floor((this._viewPortX+this._viewPortWidth+t.width+t.x)/this._gridWidth),this._resetLastViewRectKey&&(this._resetLastViewRectKey=!1,this._mapLastRect.top=this._mapRect.top-1,this._mapLastRect.bottom=this._mapRect.top-1,this._mapLastRect.left=this._mapRect.left-1,this._mapLastRect.right=this._mapRect.left-1),this.clipViewPort(),this._mapLastRect.top=this._mapRect.top,this._mapLastRect.bottom=this._mapRect.bottom,this._mapLastRect.left=this._mapRect.left,this._mapLastRect.right=this._mapRect.right,this._mapLayer.updateGridPos(),this._isDeBug&&(this._pathLayer.x=this._mapBlockLayer.x=0-this._viewPortX,this._pathLayer.y=this._mapBlockLayer.y=0-this._viewPortY)},t.prototype.clipViewPort=function(){var t,e,i=0,n=0;if(this._mapRect.left>this._mapLastRect.left){if(0<(i=this._mapRect.left-this._mapLastRect.left))for(e=this._mapLastRect.left;e<this._mapLastRect.left+i;e++)for(t=this._mapLastRect.top;t<=this._mapLastRect.bottom;t++)this.hideGrid(e,t)}else if(0<(n=this._mapLastRect.left-this._mapRect.left))for(e=this._mapRect.left;e<this._mapRect.left+n;e++)for(t=this._mapRect.top;t<=this._mapRect.bottom;t++)this.showGrid(e,t);if(this._mapRect.right>this._mapLastRect.right){if(0<(n=this._mapRect.right-this._mapLastRect.right))for(e=this._mapLastRect.right+1;e<=this._mapLastRect.right+n;e++)for(t=this._mapRect.top;t<=this._mapRect.bottom;t++)this.showGrid(e,t)}else if(1<(i=this._mapLastRect.right-this._mapRect.right))for(e=this._mapRect.right+1;e<=this._mapRect.right+i;e++)for(t=this._mapLastRect.top;t<=this._mapLastRect.bottom;t++)this.hideGrid(e,t);if(this._mapRect.top>this._mapLastRect.top){if(0<(i=this._mapRect.top-this._mapLastRect.top))for(t=this._mapLastRect.top;t<this._mapLastRect.top+i;t++)for(e=this._mapLastRect.left;e<=this._mapLastRect.right;e++)this.hideGrid(e,t)}else if(0<(n=this._mapLastRect.top-this._mapRect.top))for(t=this._mapRect.top;t<this._mapRect.top+n;t++)for(e=this._mapRect.left;e<=this._mapRect.right;e++)this.showGrid(e,t);if(this._mapRect.bottom>this._mapLastRect.bottom){if(0<(n=this._mapRect.bottom-this._mapLastRect.bottom))for(t=this._mapLastRect.bottom+1;t<=this._mapLastRect.bottom+n;t++)for(e=this._mapRect.left;e<=this._mapRect.right;e++)this.showGrid(e,t)}else if(0<(i=this._mapLastRect.bottom-this._mapRect.bottom))for(t=this._mapRect.bottom+1;t<=this._mapRect.bottom+i;t++)for(e=this._mapLastRect.left;e<=this._mapLastRect.right;e++)this.hideGrid(e,t)},t.prototype.showGrid=function(t,e){if(!(t<0||t>=this._gridW||e<0||e>=this._gridH)){var i=this._gridArray[t][e];null==i&&(i=this._mapLayer.getDrawSprite(t,e),this._gridArray[t][e]=i,this._mapLayer.addChild(i)),i.show()}},t.prototype.hideGrid=function(t,e){if(!(t<0||t>=this._gridW||e<0||e>=this._gridH)){var i=this._gridArray[t][e];i&&i.hide()}},t.prototype.destroy=function(){for(var t=0;t<this._gridW;t++)for(var e=0;e<this._gridH;e++)this._gridArray[t][e]&&this._gridArray[t][e].clearAll();this._gridArray=[],this._width=0,this._height=0,this._countW=0,this._countH=0,this._mapTileW=0,this._mapTileH=0,this.graph=null,this._rect.setTo(0,0,0,0),this.mapVo&&1==h.MapLoadQueue.instans.mapJsonIndex[this.mapVo.mapID]&&(h.MapLoadQueue.instans.mapJsonIndex[this.mapVo.mapID]=2),this._mapLayer&&(this._mapLayer.destroy(!1),this._mapLayer=null),this._mapSprite&&(this._mapSprite.destroy(),this._mapSprite=null),this._mapMask&&(this._mapMask.destroy(),this._mapMask=null),this._mouseInputLayer&&(this._mouseInputLayer.destroy(),this._mouseInputLayer=null),this._moveCtrl&&(this._moveCtrl.destroy(),this._moveCtrl=null),this._mapRect.clearAll(),this._mapLastRect.clearAll(),this._gridWidth=256,this._gridHeight=256,this._gridW=0,this._gridH=0,this._x=0,this._y=0,this._mapComplte=null,this._mapBlockLayer&&this._mapBlockLayer.graphics.clear(),i.E.ins.event(n.EventName.REFRESH_TASK,1)},Object.defineProperty(t.prototype,"mouseInputLayer",{get:function(){return this._mouseInputLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tileWidth",{get:function(){return this._mapTileW},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tileHeight",{get:function(){return this._mapTileH},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numColumnsTile",{get:function(){return this._countW},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numRowsTile",{get:function(){return this._countH},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewPortX",{get:function(){return-this._viewPortX},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewPortY",{get:function(){return-this._viewPortY},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewPortWidth",{get:function(){return this._viewPortWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"viewPortHeight",{get:function(){return this._viewPortHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gridWidth",{get:function(){return this._gridWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gridHeight",{get:function(){return this._gridHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numColumnsGrid",{get:function(){return this._gridW},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numRowsGrid",{get:function(){return this._gridH},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"res",{get:function(){return this._res},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camera",{get:function(){return this._rect},enumerable:!0,configurable:!0}),t.prototype.forceMove=function(){this.canMove=!0,this._moveCtrl||(this._moveCtrl=new r.InteractionLayer(this._mouseInputLayer))},t.prototype.drawPath=function(t){if(this._mapSprite){this._mapSprite.graphics.clear();for(var e=null,i=null,n=0;n<t.length-1;n++)e=t[n],i=t[n+1],this._mapSprite.graphics.drawLine(e.x,e.y,i.x,i.y,"#ff0000",2)}},t}();e.MapScene=c;var u=function(){function t(){}return t.prototype.clearAll=function(){this.left=this.top=this.right=this.bottom=0},t}()}),define("src/g/fight/osprite/map/MainCamera",["require","exports","src/g/fight/osprite/map/MapConst","src/g/fight/osprite/GameScene","../../../../manager/LayerManager","src/g/fight/osprite/obj/Unit_New","../../../../core/E","../../../../enum/EventName"],function(t,e,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function n(){this._limit=30,this._offset=0,this._velocity=0,this._startX=0,this._startY=0,this._targetX=0,this._targetY=0,this._moveKey=!1,this._forceKey=!1,this._currLen=0,this._speed=500,this._len=0,this._dir=new Laya.Point,this._shakeKey=!1,this._totalTime=0,this.rect=new Laya.Rectangle}return Object.defineProperty(n,"ins",{get:function(){return n.self?n.self:n.self=new n},enumerable:!0,configurable:!0}),n.prototype.setCameraBylockXy=function(t,e,i){this._forceKey&&(i=this._moveKey?(this._currLen=this._currLen+this._speed*(t-r.Unit_New.LastFrame_DT)/1e3,this._currLen>=this._len&&(this._currLen=this._len,this._moveKey=!1,l.E.ins.event(h.EventName.CAMERA_MOVE_END)),e=this._startX+this._dir.x*this._currLen,this._startY+this._dir.y*this._currLen):(e=this._targetX,this._targetY)),this._shakeKey&&(this.updateShadeCamera(),a.LayerManager.fightLayer.scaleY=a.LayerManager.fightLayer.scaleX=1+this._offset/this._limit*.3,a.LayerManager.fightLayer.x=(s.MapConst.SCREEN_WIDTH-s.MapConst.SCREEN_WIDTH*a.LayerManager.fightLayer.scaleX)/2,a.LayerManager.fightLayer.y=(s.MapConst.SCREEN_HEIGHT-s.MapConst.SCREEN_HEIGHT*a.LayerManager.fightLayer.scaleY)/2,this._totalTime=this._totalTime+(t-r.Unit_New.LastFrame_DT),3e3<this._totalTime&&this.endShadeScreen()),e<=.5*s.MapConst.SCREEN_WIDTH?(this.rect.x=0,this.lockGridX=e):e>=this.map.width-.5*s.MapConst.SCREEN_WIDTH?(this.rect.x=this.map.width-s.MapConst.SCREEN_WIDTH,this.lockGridX=e-this.rect.x):(this.rect.x=e-.5*s.MapConst.SCREEN_WIDTH,this.lockGridX=.5*s.MapConst.SCREEN_WIDTH),i<=.6*s.MapConst.SCREEN_HEIGHT?(this.rect.y=0,this.lockGridY=i):i>=this.map.height-.4*s.MapConst.SCREEN_HEIGHT?(this.rect.y=this.map.height-s.MapConst.SCREEN_HEIGHT,this.lockGridY=i-this.rect.y):(this.rect.y=i-.6*s.MapConst.SCREEN_HEIGHT,this.lockGridY=.6*s.MapConst.SCREEN_HEIGHT),this.rect.width=s.MapConst.SCREEN_WIDTH,this.rect.height=s.MapConst.SCREEN_HEIGHT,o.GameScene.ins.map.moveViewPort(this.rect.x,this.rect.y)},n.prototype.setCamera=function(t,e){t*s.MapConst.MAP_TILED_W<=.5*s.MapConst.SCREEN_WIDTH?(this.rect.x=0,this.lockGridX=t*s.MapConst.MAP_TILED_W):t*s.MapConst.MAP_TILED_W>=this.map.width-.5*s.MapConst.SCREEN_WIDTH?(this.rect.x=this.map.width-s.MapConst.SCREEN_WIDTH,this.lockGridX=t*s.MapConst.MAP_TILED_W-this.rect.x):(this.rect.x=t*s.MapConst.MAP_TILED_W-.5*s.MapConst.SCREEN_WIDTH,this.lockGridX=.5*s.MapConst.SCREEN_WIDTH),e*s.MapConst.MAP_TILED_W<=.6*s.MapConst.SCREEN_HEIGHT?(this.rect.y=0,this.lockGridY=e*s.MapConst.MAP_TILED_W):e*s.MapConst.MAP_TILED_W>=this.map.height-.4*s.MapConst.SCREEN_HEIGHT?(this.rect.y=this.map.height-s.MapConst.SCREEN_HEIGHT,this.lockGridY=e*s.MapConst.MAP_TILED_W-this.rect.y):(this.rect.y=e*s.MapConst.MAP_TILED_W-.6*s.MapConst.SCREEN_HEIGHT,this.lockGridY=.6*s.MapConst.SCREEN_HEIGHT),this.rect.width=s.MapConst.SCREEN_WIDTH,this.rect.height=s.MapConst.SCREEN_HEIGHT,o.GameScene.ins.map.moveViewPort(this.rect.x,this.rect.y)},n.prototype.updateShadeCamera=function(){this._offset+=this._velocity,this._offset*=.8,this._velocity*=.8,this._offset>this._limit&&(this._velocity*=-1),this._offset<-this._limit&&(this._velocity*=-1)},Object.defineProperty(n.prototype,"camera",{get:function(){return this.rect},enumerable:!0,configurable:!0}),n.prototype.stageToMap=function(t){return t.x+=this.rect.x,t.y+=this.rect.y,t},n.prototype.contains=function(t,e){var i=this.rect;return n.maxRect.setTo(i.x-200,i.y-200,i.width+400,i.height+400),n.maxRect.contains(t,e)},Object.defineProperty(n.prototype,"map",{get:function(){return o.GameScene.ins.map},enumerable:!0,configurable:!0}),n.prototype.moveToPoint=function(t,e){this._forceKey=!0,this._startX=this.rect.x+.5*s.MapConst.SCREEN_WIDTH,this._startY=this.rect.y+.5*s.MapConst.SCREEN_HEIGHT,this._targetX=t,this._targetY=e,this._moveKey=!0,this._dir.setTo(this._targetX-this._startX,this._targetY-this._startY),this._len=Math.sqrt(this._dir.x*this._dir.x+this._dir.y*this._dir.y),this._dir.normalize(),this._currLen=0},n.prototype.endForce=function(){this._moveKey=!1,this._forceKey=!1,this.endShadeScreen()},n.prototype.startShakeScreen=function(){a.LayerManager.enalbeScrollRect(!1),this._offset=0,this._velocity=30,this._shakeKey=!0,this._totalTime=0},n.prototype.endShadeScreen=function(){a.LayerManager.enalbeScrollRect(!0),this._shakeKey&&(this._shakeKey=!1,this._totalTime=0,a.LayerManager.fightLayer.scaleY=a.LayerManager.fightLayer.scaleX=1,a.LayerManager.fightLayer.x=a.LayerManager.fightLayer.y=0)},n.maxRect=new Laya.Rectangle,n}();e.MainCamera=i}),define("src/g/fight/osprite/obj/HeroUnit",["require","exports","../../../../utils/system/FloatEffect","../../../net/messages/PutonEquipC2GS","src/g/fight/osprite/obj/Unit_New","../../../../component/GItemAnimation","src/g/fight/osprite/obj/UnitCovert","src/g/fight/base/RES","../../../../utils/ItemUtils","../../../../core/E","../../../../enum/EventName","src/g/Effects/UIEffectsFactory","src/g/fight/osprite/obj/PassiveMgr","src/g/fight/osprite/map/MainCamera","../../../../enum/LoadPriority","src/g/clearRes/ClearResM","../../../../enum/FashionPos","src/g/fight/osprite/obj/FightGroup","../../../../component/GAnimationManager","src/g/fight/osprite/play/PlayManager","../../../net/messages/ChangeSceneMsg","../../../../enum/GameConst","../../../../enum/HpType","src/init/GameMain"],function(t,e,c,u,p,n,o,s,d,g,v,i,f,a,r,y,m,_,C,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var T=function(){function t(){this.localIndex=-1,this.skillVo=null,this.timeEle=0,this.effplay=!1,this.beAttackEffPlay=!1,this.useSvrKey=!1,this.attackInfo=null}return t.prototype.reset=function(t,e){this.localIndex=e,this.skillVo=t,this.timeEle=0,this.effplay=!1,this.beAttackEffPlay=!1,this.useSvrKey=!1,this.attackInfo=null},t}();e.SkillDelayPlay=T;var l=function(h){function l(t,e){void 0===t&&(t=null),void 0===e&&(e=!1);var i=h.call(this,!0,e)||this;return i.hpchanges=[],i.passiveMgr=null,i.weaponId=0,i.wingId=0,i.chopLv=999999999,i._skillPlay=null,i.playSpeed=1,i.hpAddAbs=0,i.hpAddPercent=0,i._svr=!1,i.weapon=new n.GItemAnimation(e),i.wing=new n.GItemAnimation(e),i.wing.pivot(250,250),i.wing.scaleX=i.wing.scaleY=1.2,i.body.addChildAt(i.wing,0),i.body.addChildAt(i.weapon,0),i.coat.addChildAni(i.wing),i.coat.addChildAni(i.weapon),i.scaleRate=1,i.status=0,i.unit_uid=d.ItemUtils.ID,i._skillPlay=new T,i.loadPriority=r.LoadPriority.OTHER_ROLE_ANI,i}return __extends(l,h),l.prototype.titleIconHandler=function(){var t=this.data.curTitle;t&&this.setTitleArr(t.concat())},l.prototype.startPkMode=function(){this.body.on(Laya.Event.CLICK,this,this.onClick),this.body.hitArea=new Laya.Rectangle(-40,-150,80,150)},l.prototype.mouseThrough=function(t){this.body.mouseThrough=t},l.prototype.onClick=function(){g.E.ins.event(v.EventName.SELECT_PK_TARGET,this.username)},l.prototype.onLvlUp=function(){if(this.body){var t=this.lvlupEff;t&&t.setPlayComplete(),this.lvlupEff=t=C.GAnimationManager.getInstance().create(),t.isRecovery=!1,t.play(),t.y=-120,4<this.face?t.scaleX=-l.lvlUPScale:t.scaleX=l.lvlUPScale,t.scaleY=l.lvlUPScale,t.interval=120,this.body.addChild(t),i.UIEffectsFactory.Ins.playAnim(15,t),s.RES.setResUrl(i.UIEffectsFactory.Ins.getSourceUrlById(15))}},l.prototype.showOff=function(t){if(void 0===t&&(t=0),t||(t=74),this.body){var e=this.lvlupEff;e&&e.setPlayComplete(),this.lvlupEff=e=C.GAnimationManager.getInstance().create(),e.isRecovery=!1,e.play(),e.y=0,4<this.face?e.scaleX=-l.lvlUPScale:e.scaleX=l.lvlUPScale,e.scaleY=l.lvlUPScale,e.interval=120,this.body.addChild(e),i.UIEffectsFactory.Ins.playAnim(t,e),s.RES.setResUrl(i.UIEffectsFactory.Ins.getSourceUrlById(t))}},l.prototype.cancelLoad=function(){this.coat&&this.coat.cancelLoad(),this.weapon&&this.weapon.cancelLoad(),this.wing&&this.wing.cancelLoad()},l.prototype.set_DATA=function(t){h.prototype.set_DATA.call(this,t),this.setHp(t.HP),this.hpchanges.length=0;var e=this.topHpBar;6==this.actorType?e.typeElement=S.HpType.npc:e.typeElement=S.HpType.role,e.offY=-120,e.totalHp=this.getHp(),this.titleIconHandler(),this.drawDebugCircle()},l.prototype.setAsShow=function(t){void 0===t&&(t=!0),h.prototype.setAsShow.call(this,t);var e=this.topHpBar;e&&this.data&&(e.totalHp=this.data.HP,e.hp=this.getHp())},l.prototype.getMultied_HP=function(){return this.totalHp+this.hpAddAbs+this.hpAddPercent},l.prototype.get_ATT=function(){return 0|this.hd.ATT},l.prototype.get_ATT_MULTI=function(){return 0|this.hd.ATT_MULTI},l.prototype.get_PDEF=function(){return 0|this.hd.PDEF},l.prototype.get_PDEF_MULTI=function(){return 0|this.hd.PDEF_MULTI},l.prototype.get_SDEF=function(){return 0|this.hd.SDEF},l.prototype.get_SDEF_MULTI=function(){return 0|this.hd.SDEF_MULTI},l.prototype.get_INCHURT=function(){return 0|this.hd.INCHURT},l.prototype.get_DECHURT=function(){return 0|this.hd.DECHURT},l.prototype.get_HIT=function(){return 0|this.hd.HIT},l.prototype.get_MISS=function(){return 0|this.hd.MISS},l.prototype.get_CHAOS=function(){return 0|this.hd.CHOAS},l.prototype.get_ANTICHAOS=function(){return 0|this.hd.ANTICHOAS},l.prototype.get_HITBACKRATE=function(){return 0},l.prototype.get_HITBACK=function(){return 0|this.hd.HITBACK},l.prototype.get_STRONG=function(){return 0|this.hd.STRONG},l.prototype.get_ANTISTRONG=function(){return 0|this.hd.ANTISTRONG},l.prototype.get_STRONGHURT=function(){return 0|this.hd.STRONGHURT},l.prototype.get_BOSSSTRONG=function(){return this.hd.BOSSSTRONG},l.prototype.get_BOSSDECHURT=function(){return this.hd.BOSSDECHURT},l.prototype.get_BOSSINCHURT=function(){return this.hd.BOSSINCHURT},l.prototype.get_JUNGONG=function(){return this.chopLv},l.prototype.getWingSkillID=function(){return this.data.heroWing.wingEquipSkillLv},l.prototype.get_PassiveMgr=function(){return this.passiveMgr},l.prototype.get_extHURT=function(t){for(var e=d.ItemUtils.getSkillVoById(t),i=this.hd.openSkill,n=0,s=0;s<i.length;s++)if(i[s]==t){n=this.hd.skillLvl[s];break}return 0==n?e.ext[0]:e.ext[n-1]},l.prototype.resetEquipData=function(){h.prototype.resetEquipData.call(this);var t,e=this.avatarId,i=this.weaponId,n=this.data;if(this.changedAvatarId?this.avatarId=this.changedAvatarId:this.avatarId=this.getFashionId(m.FashionPos.FASHION),!this.avatarId){var s=(t=n.equpos[u.EPosEquip.yifu-1]).equins.equtemplet;if(0<s){var o=d.ItemUtils.getEquipVoById(s),a=0;o?a=o.roleRes:console.error("装备找不到"),this.avatarId=a}else this.avatarId=0}if(this.changedWeaponId?this.weaponId=this.changedWeaponId:this.weaponId=this.getFashionId(m.FashionPos.WEAPON),!this.weaponId&&0<(t=n.equpos[u.EPosEquip.wuqi-1]).equins.equtemplet){var r=d.ItemUtils.getEquipVoById(t.equins.equtemplet);r&&(this.weaponId=r.weaponRes)}if(e!=this.avatarId||this.weaponId!=i){var l=this.action;this.action=l+1,null==l?this.stand():this.playAnimation(l,0,null)}},l.prototype.getFashionId=function(t){var e=this.data;if(e&&e.fashionData)for(var i,n=e.fashionData.curFashion.length,s=0;s<n;){var o=e.fashionData.curFashion[s];if((i=d.ItemUtils.getFashionVo(o))&&i.position==t)return i.res;s++}return 0},l.prototype.getNewSkill=function(){for(var t=0;t<this.hd.openSkill.length;t++)this.sk_Manager.add_skill(this.hd.openSkill[t],this.hd.skillLvl[t])},l.prototype.initHeroData=function(t,e,i,n,s){void 0===n&&(n=""),void 0===s&&(s=1),this.actorName=n,this.set_DATA(t);var o=t.openSkill.concat(),a=t.skillLvl.concat(),r=o.indexOf(14);-1<r&&(o.splice(r,1),a.splice(r,1)),this.sk_Manager.register_skill(o,a),this.actorType=s,this.face=6,this.sex=t.sex,this.job=t.jobid,this.chopLv=e,this.wingHandler(),this.resetEquipData(),this.stand(),this.updateNickname(n),g.E.ins.on(v.EventName.PUTNEWEQUIPED,this,this.resetEquipData),g.E.ins.on(v.EventName.CHANGEROLE_SHOW,this,this.resetEquipData),g.E.ins.on(v.EventName.GET_NEW_SKILL,this,this.getNewSkill),g.E.ins.on(v.EventName.AVTOAR,this,this.wingHandler),g.E.ins.on(v.EventName.PASSIVEDATA_CHANGE,this,this.onPassiveChange),g.E.ins.on(v.EventName.FASHION_STATE_CHANGED,this,this.onFashionStateChanaged),g.E.ins.on(v.EventName.SEX_CHANGED,this,this.onSexChanged),this.resetHP(),this.passiveMgr=new f.PassiveMgr,this.passiveMgr.initPassiveMgr(this);var l=d.ItemUtils.getHeroVoById(this.job);l&&(this.attackDis=l.value,this.station=l.station)},l.prototype.onSexChanged=function(){this.isSelfUnit&&this.playAnimation(this.action,0,null)},l.prototype.updateNickname=function(t){if(void 0===t&&(t=""),0<t.length){switch(I.PlayManager.type){case b.EPlayType.PLAYTYPE_ALLWORLDBOSS:case b.EPlayType.PLAYTYPE_KFRX:case b.EPlayType.PLAYTYPE_KFSD:case b.EPlayType.PLAYTYPE_KFTB:t=E.GameMain.getDisSvrId(this._fightGroup.groupID+"")+t}this.topHpBar.headName=t}},l.prototype.onFashionStateChanaged=function(t){this.wingHandler(),this.resetEquipData()},l.prototype.onPassiveChange=function(){this.passiveMgr&&this.passiveMgr.onPassiveChg()},l.prototype.wingHandler=function(){if(this.wingId=this.getFashionId(m.FashionPos.WING),!this.wingId&&this.data.openWing){var t=d.ItemUtils.getWingLevelVoById(this.data.heroWing.level);this.wingId=t.res}},l.prototype.playAnimation=function(t,e,i){if(void 0===e&&(e=-1),this.isCanMove&&(this.action=t,this.coat)){this.coat.completeCallBack=i;var n=p.Unit_New.ANIMATION_INTERNAL_UNIT;if(this.unrealAction=this.action,1==this.action?this.coat.interval=2*n:3==this.action?this.coat.interval=n*this.attackSpeedUpCoef:this.coat.interval=n/this.playSpeed,3==this.action)this.fightTarget&&(this.face=o.UnitCovert.calcFace(this.getMapPos(),this.fightTarget.getMapPos())),this.weaponEff&&this.weaponEff.removeSelf(),this.weaponId&&this.weapon.load(this.getWeaponRes),this.wingId&&this.wing.load(this.getWingRes),this.coat.forceFirstIndex(),this.coat.load(this.getRoleRes(this.unrealAction),!0,this.unrealAction,"",this.loadPriority),this.coat.isLoop=!1,0<=e?this._skillPlay.reset(this.getSkillId(e),e):this._skillPlay.reset(null,-1);else{var s=this.getWeaponRes;s.length&&this.weapon.load(s),this.weaponEff&&this.weaponEff.removeSelf(),(s=this.getWingRes).length&&this.wing.load(s),this.coat.load(this.getRoleRes(this.unrealAction),!0,this.unrealAction,"",this.loadPriority),this.coat.isLoop=!0}this.updateBodyZOrder()}},l.prototype.playWeaponEffect=function(t,e){if(a.MainCamera.ins.contains(this.mapX,this.mapY)){var i=s.RES.getSdul0(t,this.face),n=e?e.sdur0Rate:1.2;this.weaponEff=C.GAnimationManager.getInstance().create(n,90*this.attackSpeedUpCoef),this.body.addChild(this.weaponEff),this.weaponEff.load(i)}},l.prototype.removeWeaponEff=function(){h.prototype.removeWeaponEff.call(this),this.weaponEff&&this.weaponEff.removeSelf()},l.prototype.frameMove=function(t,e){if(h.prototype.frameMove.call(this,t,e),this.body&&this.body.visible){var i=p.Unit_New.LastFrame_DT;this.lvlupEff&&(4<this.face?this.lvlupEff.scaleX=-l.lvlUPScale:this.lvlupEff.scaleX=l.lvlUPScale),0<this.getHp()&&this.passiveMgr&&this.passiveMgr.framemove(t);var n=this._skillPlay;if(null!=n.skillVo&&(n.timeEle+=t-i,!n.effplay&&n.timeEle>n.skillVo.skillEffDelay*this.attackSpeedUpCoef&&(n.skillVo.sdur0&&this.playWeaponEffect(n.skillVo.sdur0,n.skillVo),n.effplay=!0),!n.beAttackEffPlay&&n.timeEle>n.skillVo.beSkillEffDelay*this.attackSpeedUpCoef&&(n.beAttackEffPlay=!0,this.calSkillHurtEff(n.localIndex)),n.timeEle>n.skillVo.hurtDelay*this.attackSpeedUpCoef)){if(n.useSvrKey){var s=n.attackInfo;if(s)for(var o=0;o<s.targets.length&&o<s.hps.length&&o<s.skillResLower.length&&o<s.skillResHigh.length;o++){var a=s.targets[o];if(a){var r=s.hps[o];this.isWuShi&&c.FE.passiveFloat(this.face,w.GameConst.FIGHTRES+"piaozi_wushiwudi.png",this.body),a.floatBlood(r,this.job,s.skillResLower[o],s.skillResHigh[o],this.isHeTi,this.isWuShi)}}else console.error("目标为NULL")}else this.calSkillHurt(n.localIndex);n.reset(null,-1)}}},l.prototype.resetSkillPlay=function(t){t<0?this._skillPlay.reset(null,-1):this._skillPlay.reset(this.getSkillId(t),t)},l.prototype.newFrameMove=function(t,e){h.prototype.frameMove.call(this,t,e)},l.prototype.resetActionState=function(){this.setFightTarget(null),this.status=0,this.stand(),this.weaponEff&&this.weaponEff.setPlayComplete(),this._skillPlay.reset(null,-1)},l.prototype.deathHide=function(){h.prototype.deathHide.call(this),this.playDeath(),this.sk_Manager.clear_buff()},l.prototype.clearBuf=function(){h.prototype.clearBuf.call(this),this.passiveMgr&&this.passiveMgr.clearPassiveState()},l.prototype.resetHP=function(t){void 0===t&&(t=!0),this.getHp()<=0&&t&&this.resetUnit(this.worldX,this.worldY);var e=this.getMultied_HP();this.setHp(e),this.topHpBar.totalHp=e,this.topHpBar.hp=this.getHp(),this.passiveMgr&&this.passiveMgr.clearPassiveState()},l.prototype.chg_HP=function(t,e,i,n,s){void 0===s&&(s=!1),this._svr&&this.hpchanges.length&&(t=this.hpchanges.pop(),this.setHp(this.getHp()-t)),h.prototype.chg_HP.call(this,t,e,i,n,s),this.floatBlood(t,e?e.job:0,i,n,s)},Object.defineProperty(l.prototype,"svrMode",{set:function(t){this._svr=t},enumerable:!0,configurable:!0}),l.prototype.svrSetHP=function(t,e){void 0===e&&(e=!0);var i=t-this.getHp();e&&this.hpchanges.push(i),this.setHp(t)},l.prototype.resetUnit=function(t,e){this.destoryed||(this.body.visible=!0,this.stand(),this.resetHP(!1),this.sk_Manager.clear_buff(),this.shadow&&!this._limitDrawKey&&(this.shadow.visible=!0),this.coat&&!this._limitDrawKey&&(this.coat.visible=!0),this.topHpBar&&!this._limitDrawKey&&(this.topHpBar.visible=!0),this.setWorldXY(t,e),h.prototype.resetUnit.call(this,t,e))},l.prototype.updateBodyZOrder=function(){switch(this.face){case 3:case 4:case 5:this.wing.zOrder=0,this.coat.zOrder=1,this.weapon.zOrder=2;break;case 0:this.wing.zOrder=2,this.weapon.zOrder=0,this.coat.zOrder=1;break;case 6:case 2:3==this.action?(this.wing.zOrder=0,this.weapon.zOrder=2,this.coat.zOrder=1):(this.wing.zOrder=1,this.weapon.zOrder=2,this.coat.zOrder=0);break;case 1:case 7:this.wing.zOrder=1,this.weapon.zOrder=2,this.coat.zOrder=0}this.lvlupEff&&(this.lvlupEff.zOrder=6)},Object.defineProperty(l.prototype,"getWeaponRes",{get:function(){var t="";return this.weaponId&&(t=s.RES.weaponRes(this.weaponId,this.unrealAction,this.face,this.job)),t},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"getWingRes",{get:function(){return this.wingId?s.RES.wingPath(this.wingId,this.unrealAction,this.face,this.job):""},enumerable:!0,configurable:!0}),l.prototype.getRoleRes=function(t){return s.RES.rolePath(this.avatarId,this.sex,t,this.face,this.job)},Object.defineProperty(l.prototype,"sex",{get:function(){return this.data.sex},set:function(t){this._sex=t},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"hd",{get:function(){return this.data},enumerable:!0,configurable:!0}),l.prototype.destroyUnit=function(){y.ClearResM.clearRole(this.avatarId,this.sex,this.job),y.ClearResM.clearWing(this.wingId,this.job),y.ClearResM.clearWeapon(this.weaponId,this.job),h.prototype.destroyUnit.call(this),this.wing&&this.wing.clear(),this.weapon&&this.weapon.clear(),this.cancelLoad(),g.E.ins.off(v.EventName.PASSIVEDATA_CHANGE,this,this.onPassiveChange),g.E.ins.off(v.EventName.PUTNEWEQUIPED,this,this.resetEquipData),g.E.ins.off(v.EventName.CHANGEROLE_SHOW,this,this.resetEquipData),g.E.ins.off(v.EventName.GET_NEW_SKILL,this,this.getNewSkill),g.E.ins.off(v.EventName.AVTOAR,this,this.wingHandler),g.E.ins.off(v.EventName.FASHION_STATE_CHANGED,this,this.onFashionStateChanaged),g.E.ins.off(v.EventName.SEX_CHANGED,this,this.onSexChanged),this.passiveMgr&&(this.passiveMgr.clear(),this.passiveMgr=null),this.openhero=null},l.prototype.playFight=function(t,e){var i=null;0<this._attackInfoList.length&&(i=this._attackInfoList.shift(),e=this.sk_Manager.getIndexById(i.skillId)),h.prototype.playFight.call(this,t,e),i&&(this._skillPlay.useSvrKey=!0,this._skillPlay.attackInfo=i)},l.prototype.addAttackInfo=function(t){this._attackInfoList.push(t)},l.prototype.onMoveEnd=function(){this.bSelfUnit&&g.E.ins.event(v.EventName.UNIT_MOVE_END,this.groupUid*_.FightGroup.HERO_MAXNUM+this.index)},l.prototype.limitDraw=function(t,e){h.prototype.limitDraw.call(this,t,e),this.wing&&this.wing.limitDraw(t),this.weapon&&this.weapon.limitDraw(t);var i=this.topHpBar;e&&i&&(i.visible=!t)},l.prototype.setCamp=function(t){var e=this.topHpBar;e&&e.setCamp(t)},l.HERO_UIDVAL=9e5,l.lvlUPScale=2,l}(p.Unit_New);e.HeroUnit=l}),define("src/g/fight/osprite/obj/SelfOtherUnit",["require","exports","../../../../enum/EventName","../../../../core/E","src/g/fight/osprite/obj/SelfBaseUnit","src/init/GameState"],function(t,e,a,r,i,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return __extends(t,o),t.prototype.chg_HP=function(t,e,i,n){if(!this._constantHp){if(l.GameState.clientChangeHp){var s=this.getHp()+t;this.setHp(s)}o.prototype.chg_HP.call(this,t,e,i,n),r.E.ins.event(a.EventName.ROLE_HP_CHANGE)}},t.prototype.resetHP=function(t){void 0===t&&(t=!0),o.prototype.resetHP.call(this,t),r.E.ins.event(a.EventName.ROLE_HP_CHANGE)},t}(i.SelfBaseUnit);e.SelfOtherUnit=n}),define("src/g/fight/osprite/obj/DaoShiUnit",["require","exports","src/g/fight/osprite/obj/SelfOtherUnit"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.deathHide=function(){e.prototype.deathHide.call(this);var t=this._fightGroup;t&&t.deathAllPet()},t}(i.SelfOtherUnit);e.DaoShiUnit=n}),define("src/g/fight/osprite/SceneObjCtroller",["require","exports","src/g/fight/osprite/obj/Unit_New","src/g/fight/osprite/obj/FightGroup","../../../utils/DropUtil","../../../config/GameConfig","../../../manager/RoleCenter","src/g/fight/osprite/GameScene","src/g/fight/osprite/obj/SelfUnit","src/g/fight/osprite/SceneObjManager","../../../enum/EventName","../../../core/E","src/g/fight/osprite/obj/Npc","../../../enum/JobEnum","src/g/fight/osprite/obj/MonsterUnit_New","src/g/fight/osprite/obj/MonsterNewVillage","../../../manager/LayerManager","src/g/fight/osprite/obj/Pet","../../../utils/ItemUtils","src/g/fight/osprite/obj/SelfOtherUnit","src/g/fight/osprite/obj/DaoShiUnit","src/g/fight/osprite/obj/MineNpc","src/g/fight/osprite/obj/Shenjiang","../../../enum/enumPet"],function(t,e,o,u,n,r,p,s,d,g,v,f,a,y,l,h,c,m,_,C,I,b,w,S){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this,e=f.E.ins;return e.on(v.EventName.OPENNEW_HERO,t,t.openNewHero),e.on(v.EventName.GET_NEW_SKILL,t,t.onSkillOpen),e.on(v.EventName.UPDATE_SB_SKILL,t,t.updateSelfSkill),t}return __extends(t,i),Object.defineProperty(t,"ins",{get:function(){return t._ins?t._ins:t._ins=new t},enumerable:!0,configurable:!0}),t.prototype.onSkillOpen=function(t){14==t&&this.createPetAddToStage(1)},t.prototype.resetSelfGroupPos=function(t){for(var e=this._selfGroup.getFUList(),i=0;i<e.length;i++){var n=e[i];0==i?n.setWorldXY(t[0],t[1]):1==i?n.setWorldXY(t[0]-1,t[1]-1):2==i?n.setWorldXY(t[0]-1,t[1]):3==i&&n.setWorldXY(t[0],t[1]-1)}},t.prototype.openNewHero=function(t){var e=p.RoleCenter.instans.self,i=e.openhero.length-1,n=t.jobid==y.JobEnum.DAOSHI?new I.DaoShiUnit:new C.SelfOtherUnit,s=this._selfGroup.getFUList()[0],o=[s.worldX,s.worldY];if(n.initHeroData(t,e.JUNGONG,e.STORYEXP),1==i?n.setWorldXY(o[0]-1,o[1]-1):2==i?n.setWorldXY(o[0]-1,o[1]):3==i&&n.setWorldXY(o[0],o[1]-1),c.LayerManager.fightLayer.addUnit(n),this._selfGroup.isDeath()&&n.svrSetHP(0),this._selfGroup.getPet()){var a=this._selfGroup.getCount();0<a?this._selfGroup.insertFightUnit(a-1,n):this._selfGroup.insertFightUnit(0,n)}else this._selfGroup.addFightUnit(n),Number(t.jobid)==y.JobEnum.DAOSHI&&this.createPetAddToStage(1);this._selfGroup.getFGTarget()&&this._selfGroup.setFGTarget(this._selfGroup.getFGTarget())},t.prototype.resetSj=function(t){if(this.sjId!=t){this.sjId=t;var e=this._selfGroup;if(e){var i=e.getPet(S.enumPet.shenjiang);if(i)i.avatarId=t,i.resetCoat();else{i=new w.Shenjiang(t);var n=e.getFUList()[0];n&&(e.addFightUnit(i),i.resetUnit(n.worldX,n.worldY),i.addToFightLayer())}i.set_DATA(_.ItemUtils.getPetVoById(1))}}},t.prototype.getSelfGroup=function(){var t=this._selfGroup;if(t)return t;var e,i=p.RoleCenter.instans.self;this._selfGroup=t=new u.FightGroup(i.username),t.isSelf=!0,t.userData=i;var n=new d.SelfUnit;(this.self=n).heroIndex=0;var s=i.openhero;n.bSelfUnit=!0;var o=(n.openhero=s)[0];-1<o.openSkill.indexOf(14)&&(e=o),o.curTitle=i.titleData?i.titleData.curTitle:0,t.addFightUnit(n),n.initHeroData(o,i.JUNGONG,i.STORYEXP,i.nickname),n.username=i.username,f.E.ins.on(v.EventName.ADDED_LEVEL,this,this.onLvlUp),g.SceneObjManager.instans.setLock(n);for(var a=1;a<s.length;a++){o=s[a];var r=Number(o.jobid)==y.JobEnum.DAOSHI?new I.DaoShiUnit:new C.SelfOtherUnit;r.bSelfUnit=!0,r.heroIndex=a,-1<o.openSkill.indexOf(14)&&(e=o),t.addFightUnit(r),r.initHeroData(o,i.JUNGONG,i.STORYEXP)}var l=i.petData;if(e){var h=this.createPetByHeroData(e);t.addFightUnit(h)}else l&&l.open&&this.createPetShen();this.updateSelfSkill();var c=this.sjId;return this.sjId=NaN,isNaN(c)||this.resetSj(c),t},t.prototype.createPetShen=function(){this.createPetAddToStage(10)},t.prototype.updateSelfSkill=function(){this.updateSbSkill(p.RoleCenter.instans.self.sbData,this._selfGroup)},t.prototype.updateSbSkill=function(t,e){if(t){this.clearReplaceSkill(e);for(var i=null,n=void 0,s=null,o=null,a=e.getCount(),r=0;r<a;r++)if(!(o=e.getUnitByIndex(r)).isSummonPet()&&(i=t.getOneSBDataByJob(o.job))){s=i.giftPropC,n=Math.floor(s.length/2);for(var l=0;l<n;l++)o.sk_Manager.replaceSkill(s[2*l],s[2*l+1])}}},t.prototype.clearReplaceSkill=function(t){if(t)for(var e=null,i=t.getCount(),n=0;n<i;n++)(e=t.getUnitByIndex(n)).isSummonPet()||e.sk_Manager.clearReplaceSkill()},t.prototype.createPetByHeroData=function(t){var e=t.openSkill.indexOf(14);if(!(e<0)){var i=t.skillLvl[e];return this.createPet(i)}},t.prototype.createPet=function(t){var e=_.ItemUtils.getPetVoById(t),i=1e3,n=p.RoleCenter.instans.vo.petData;n.open&&(i=_.ItemUtils.getPetAvid(n));var s=new m.Pet(i);return s.set_DATA(e),s},t.prototype.createPetAddToStage=function(t){var e=this._selfGroup,i=e.getPet();if(i)i.resetCoat();else{(i=this.createPet(t)).addToFightLayer();var n=e.getFUList()[0];n&&(i.resetUnit(n.worldX,n.worldY),e.addFightUnit(i))}},t.prototype.onLvlUp=function(){this.self.onLvlUp()},t.prototype.createMonster=function(t,e,i){void 0===i&&(i=1);var n=r.GameConfig.getMonster(t);if(!n)return null;var s=new l.MonsterUnit_New;return s.set_DATA(n),s.face=o.Unit_New.getRandomFace(),s.waveIndex=i,s.setWorldXY(e[0],e[1]),s},t.prototype.createNewVillageMon=function(t,e,i){void 0===i&&(i=1);var n=r.GameConfig.getMonster(t);if(!n)return null;var s=new h.MonsterNewVillage;return s.set_DATA(n),s.face=o.Unit_New.getRandomFace(),s.waveIndex=i,s.setWorldXY(e[0],e[1]),s},t.prototype.createNPC=function(t,e,i,n){void 0===n&&(n=1);var s=r.GameConfig.getNpcByID(t),o=new a.NPC;if(!s)throw new Error("游戏内找不到NPC ID:"+t);return o.initNPCData(s,e,i,4,n),g.SceneObjManager.instans.addNpc(o),o},t.prototype.createMineNPC=function(t,e,i,n,s){void 0===s&&(s=1);var o=r.GameConfig.getNpcByID(t),a=new b.MineNPC;if(!o)throw new Error("游戏内找不到NPC ID:"+t);return a.initNPCData(o,e,i,n,s),g.SceneObjManager.instans.addNpc(a),a},t.prototype.createDrops=function(t,e,i){void 0===i&&(i=0),n.DropUtil.createDrop([10002,1],e)},t.prototype.destroySelfGroup=function(){this._selfGroup&&(this._selfGroup.destroyGroup(!0),this._selfGroup=null)},t.prototype.setWaveOpen=function(t,e){void 0===t&&(t=2),void 0===e&&(e=1)},Object.defineProperty(t.prototype,"scene",{get:function(){return s.GameScene.ins},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"manager",{get:function(){return g.SceneObjManager.instans},enumerable:!0,configurable:!0}),t}(Laya.EventDispatcher);e.SceneObjCtroller=i}),define("src/g/fight/osprite/obj/Npc",["require","exports","src/g/fight/osprite/obj/Unit_New","src/g/fight/base/RES","../../../../manager/RoleCenter","../../../../utils/SoundUtils","../../../../enum/LoadPriority","src/g/fight/osprite/play/MainCityManager","../../../../utils/ItemUtils"],function(t,e,i,o,n,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(i){function s(){var t=i.call(this)||this;return t._npcRes=0,t.res=0,t.body.on(Laya.Event.CLICK,t,t.onClick),t.body.hitArea=new Laya.Rectangle(-40,-150,80,150),t.body.on(Laya.Event.CLICK,t,t.playSound),t.loadPriority=r.LoadPriority.OTHER_ROLE_ANI,t}return __extends(s,i),s.prototype.playSound=function(){var t=this.data;a.SoundUtils.getInstance().playNpcSound(t.soundId)},s.prototype.onClick=function(){l.MainCityManager.getInstance().gotoToNpc(this)},s.prototype.set_DATA=function(t){var e=t;this.status=0,this._npcRes=e.res,this.actorName=e.name,this.actorType=4,this.action=1,this.id=e.NpcID,this.setHp(100),this.topHpBar.typeElement=3,!n.RoleCenter.instans.vo.newbee&&e.nameurl?this.topHpBar.tipIcon(e.nameurl):e.res?(this.topHpBar.headName=e.name,this.topHpBar.headNameColor="#09d51f"):this.setUnitVis(!1),this.scaleRate=e.scale,i.prototype.set_DATA.call(this,t)},s.prototype.playAnimation=function(t,e,i){if(void 0===e&&(e=-1),this._npcRes&&this.action!=t){this.action=t;var n=o.RES.npcPath(this._npcRes,this.action,this.face);n&&(this.coat.interval=s.NPCANI_INTERNAL,this.coat.load(n,!0,t,"",this.loadPriority))}},s.prototype.initNPCData=function(t,e,i,n,s){void 0===s&&(s=1),e&&1<e.length?this.setWorldXY(e[0],e[1]):console.log("error::Npc:initNPCData,pos == null"),this.teamId=h.ItemUtils.ID,this.waveIndex=s,this.findNode=i,t.isUseFace?this.face=n:this.face=-1,this.set_DATA(t),this.action=-1,this.stand()},s.prototype.frameMove=function(t,e){i.prototype.frameMove.call(this,t,e)},s.NPC_VALID=100,s.NPCANI_INTERNAL=280,s}(i.Unit_New);e.NPC=s}),define("src/g/fight/osprite/SceneObjManager",["require","exports","src/g/fight/osprite/obj/Unit_New","../../../core/E","../../../enum/EventName","../../../utils/DropUtil","src/g/fight/osprite/map/MainCamera"],function(t,e,o,i,n,s,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this.unitDic=[],this.objArr=[],this.dropDict=new Laya.Dictionary,this.npcDic=new Laya.Dictionary,i.E.ins.on(n.EventName.PLAY_TYPE_CHANGED,this,this.removeDropHandler)}return Object.defineProperty(t,"instans",{get:function(){return t.self?t.self:t.self=new t},enumerable:!0,configurable:!0}),t.prototype.removeDropHandler=function(){},t.prototype.regObject=function(t){-1==this.objArr.indexOf(t)&&this.objArr.push(t)},t.prototype.unregObject=function(t){var e=this.objArr.indexOf(t);-1!=e&&this.objArr.splice(e,1)},t.prototype.draw=function(t){var e=Date.now();if(null!=this.lockUnit){!this.lockUnit||isNaN(this.lockUnit.mapX)||isNaN(this.lockUnit.mapY)||a.MainCamera.ins.setCameraBylockXy(e,this.lockUnit.mapX,this.lockUnit.mapY);for(var i=this.unitDic,n=0;n<i.length;n++)i[n].frameMove(e,t);for(n=0;n<this.objArr.length;n++)this.objArr[n].frameMove(e);var s=this.totalDrops;for(n=0;n<s.length;n++){s[n].draw()}o.Unit_New.LastFrame_DT=e}},t.prototype.drawDebugCircle=function(){for(var t=this.unitDic,e=0;e<t.length;e++)t[e].showDebug()},t.prototype.addUnitN=function(t){this.unitDic.push(t)},t.prototype.getUnitCount=function(){return this.unitDic.length},t.prototype.delUnitN=function(t){var e=this.unitDic.indexOf(t);0<=e&&this.unitDic.splice(e,1)},t.prototype.setLock=function(t){if(t){this.lockUnit&&(this.lockUnit.lock=!1),t.lock=!0;var e=(this.lockUnit=t).actorName;t.updateNickname&&t.updateNickname(e)}else console.error("SceneObjManager:setLock:unit = null")},Object.defineProperty(t.prototype,"lock",{get:function(){return this.lockUnit},enumerable:!0,configurable:!0}),t.prototype.addNpc=function(t){this.npcDic.set(t.unit_uid,t),t.init()},t.prototype.getNpc=function(t){return this.npcDic.get(t)},t.prototype.addDrop=function(t){this.dropDict.set(t.unit_uid,t),t.init()},t.prototype.getDrop=function(t){return this.dropDict.get(t)},t.prototype.deleDrops=function(t){null!=t&&(this.dropDict.remove(t.unit_uid),this.dropDict.values.length<=0&&(s.DropUtil.isfly=!1))},Object.defineProperty(t.prototype,"totalDrops",{get:function(){return this.dropDict.values},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalCanSelectDrops",{get:function(){for(var t=this.dropDict.values,e=[],i=0;i<t.length;i++)1==t[i].canSelect&&e.push(t[i]);return e},enumerable:!0,configurable:!0}),t.prototype.clear=function(){var t=0;this.npcDic.clear();var e=this.totalDrops;for(t=0;t<e.length;t++){e[t].bePickUp()}this.dropDict.clear()},t}();e.SceneObjManager=r}),define("src/g/fight/osprite/GameScene",["require","exports","../../../manager/RoleCenter","../../../config/GameConfig","../../../enum/EventName","src/g/fight/osprite/SceneObjManager","src/g/fight/osprite/SceneObjCtroller","src/g/fight/osprite/map/MapScene","../../../core/E","src/g/fight/osprite/play/PlayManager","../../net/messages/UserDataChangeGS2C","../../../utils/ItemUtils","../../../manager/LayerManager","../../../utils/SoundUtils","../../../manager/GameSocketManager","../../net/messages/ChangeSceneMsg","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/g/index/ctrl/PortViewCtrl","../../../manager/StateManger","src/g/setting/ctrl/SettingCtrl","src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager","../../../manager/AM","src/g/fight/osprite/play/sandynight/SandyNightManager","../../../utils/DialogQueue","src/g/fight/osprite/play/CrossSvrBoss/CrossSvrBossManager","src/g/fight/osprite/play/kfhotblood/KfHotBloodManager","src/init/TextConst","src/g/fight/osprite/play/kftplay/KFTManager","src/g/fight/osprite/play/kfsd/KFSDWarManager","src/g/fight/osprite/play/team/TeamManager","src/g/fight/osprite/play/shenweiyu/ShenweiyuManager","src/g/fight/osprite/play/kfshenqijindi/KfShenQiJinDiManager","src/g/fight/osprite/play/kfzy/KFZYManager"],function(t,e,S,E,T,i,o,n,A,a,s,R,r,l,h,L,x,c,u,p,d,P,g,k,v,D,H,f,M,G,B,N,U,V){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=laya.media.SoundManager,m=function(){function t(){this._copyMaterial=null,this._portBossVo=null,this.mapVo=null,this.fightid=0,this.autoFight=!1,this.statetype=L.EPlayType.PLAYTYPE_NULL,this._deltaTime=0,this._lastTime=0,y.setMusicVolume(.3)}return Object.defineProperty(t,"ins",{get:function(){return t.self?t.self:t.self=new t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"matCopy",{get:function(){return this._copyMaterial},enumerable:!0,configurable:!0}),t.prototype.getPortBossVo=function(){return this._portBossVo},t.prototype.initScene=function(){this._isInited||(A.E.ins.on(T.EventName.PLAY_TYPE_CHANGE,this,this.onPlayTypeChangeHandler),A.E.ins.on(T.EventName.NET_OFFLINE,this,this.onOffline),h.GSM.ins.on(Laya.Event.OPEN,this,this.onReLogin),S.RoleCenter.instans.on(T.EventName.ROLE_PROP_CHANGE+s.EUType.newport,this,this.portUpdate),this.port=E.GameConfig.getPortByID(S.RoleCenter.instans.self.portstatus.portindex),h.GSM.ins.on(L.ChangeSceneGS2C.KEY,this,this.onSceneChange),this.map=new n.MapScene,this.playMan=new a.PlayManager,d.SettingCtrl.getInstance(),this._isInited=!0),this.playtype=this.playMan.crtType},t.prototype.onReLogin=function(t){t&&this.startTimer()},t.prototype.onOffline=function(){console.log("^^^^^^^^断线了"),this.stopTimer(),S.RoleCenter.instans.vo.clearSummonBossList(),p.StateManger.isMatching=!1,this.fightid=0},t.prototype.bagIsFull=function(t){switch(t){case L.EPlayType.PLAYTYPE_PORT:case L.EPlayType.PLAYTYPE_MAINCITY:return!1;default:return!S.RoleCenter.instans.bagRoomEnough()&&(g.AM.showBagNotEnough(),!0)}},t.prototype.onPlayTypeChangeHandler=function(t){var e=t.playType;if(!this.bagIsFull(e)){var i=o.SceneObjCtroller.ins.getSelfGroup();if(Laya.Tween.clearAll(i),Laya.timer.clearAll(i),r.LayerManager.fightLayer.skilleffectLayer.removeChildren(),r.LayerManager.fightLayer.popLayer.removeChildren(),e==L.EPlayType.PLAYTYPE_COPYLADDER&&(p.StateManger.isMatching=!1),p.StateManger.isMatching)return x.FE.upItems(f.TextConst.get(405),c.BubbleEnum.center);if(v.DialogQueue.getInstance().reset(),Laya.Dialog.closeAll(),e!=L.EPlayType.PLAYTYPE_FIGHTSC&&e!=L.EPlayType.PLAYTYPE_LEGENDCOPY){var n=this._type;if(n&&e==n.playType)return;if(a.PlayManager.loading)return void x.FE.upItems(f.TextConst.get(405),c.BubbleEnum.center);if(e!=L.EPlayType.PLAYTYPE_PORT_LEVEL&&e!=L.EPlayType.PLAYTYPE_PORT&&u.PortViewCtrl.getins().offAutoFight(),a.PlayManager.isSpecialPlay()&&e>L.EPlayType.PLAYTYPE_PORT)return void x.FE.upItems(f.TextConst.get(406),c.BubbleEnum.center)}this._type=t;var s=new L.ChangeSceneC2GS;s.playtype=e,h.GSM.sendServer(s),a.PlayManager.loading=!0,r.LayerManager.leftPop.removeChildren(),r.LayerManager.bubblesLayer.removeChildren()}},t.prototype.onSceneChange=function(t){p.StateManger.isMatching=!1,t.opresult||(a.PlayManager.loading=!1,console.error("切换地图失败",t.error),this._type.playType=L.EPlayType.PLAYTYPE_PORT),this._type&&this._type.playType==a.PlayManager.type&&this._type.playType==L.EPlayType.PLAYTYPE_NEWVILLAGE||(this.onPlayTypeChange(this._type),this.playtype=this._type.playType,r.LayerManager.fightLayer.skilleffectLayer.removeChildren(),r.LayerManager.fightLayer.popLayer.removeChildren(),r.LayerManager.closeGuidWin(),this.playtype==L.EPlayType.PLAYTYPE_PORT_LEVEL||this.playtype==L.EPlayType.PLAYTYPE_PORT||this.playtype==L.EPlayType.PLAYTYPE_MAINCITY||r.LayerManager.closeAllPOPWindow())},t.prototype.distanceToBoss=function(t){return this.playMan.play.distanceToBoss(t)},t.prototype.onPlayTypeChange=function(t){x.FE._floatcount=0;var e=this.statetype=t.playType;switch(e){case L.EPlayType.PLAYTYPE_NEWVILLAGE:case L.EPlayType.PLAYTYPE_MAINCITY:case L.EPlayType.PLAYTYPE_PORT:A.E.ins.event(T.EventName.EXIT_SUB_GAMEPLAY);break;default:A.E.ins.event(T.EventName.ENTER_SUB_GAMEPLAY)}this.port=E.GameConfig.getPortByID(S.RoleCenter.instans.self.portstatus.portindex),this.playMan.crtType=e,this.data=t.data;var i=null;e!=L.EPlayType.PLAYTYPE_MAINCITY&&this.playMan.setPlay(e,t.data);var n=this.playMan.play;switch(e){case L.EPlayType.PLAYTYPE_MAINCITY:this.port=i=R.ItemUtils.getPortVoById(t.data.portid),this.changeMap(i.boss_scene),this.playMan.setPlay(e,t.data);break;case L.EPlayType.PLAYTYPE_PRIBOSS:var s=t.data.idx;this.port=i=R.ItemUtils.getPortVoById(S.RoleCenter.instans.self.bossData.bossprivatePort[s]),n.vo=i,n._pribossIndex=s,n.bossvo=t.data.boss,this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_NEWVILLAGE:this.changeMap(1);break;case L.EPlayType.PLAYTYPE_REVENGE:var o=E.GameConfig.getPortByID(E.GameConfig.gameSetting.revengeMapID);this.changeMap(o.boss_scene);break;case L.EPlayType.PLAYTYPE_FIMILYHELPREVENGE:var a=E.GameConfig.getPortByID(E.GameConfig.gameSetting.revengeMapID);this.changeMap(a.boss_scene);break;case L.EPlayType.PLAYTYPE_QUANMINBOSS:this._portBossVo=R.ItemUtils.getPort_quanmin(t.data),this._copyMaterial=i=R.ItemUtils.getPortVoById(this._portBossVo.port),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_SHENYUBOSS:this._portBossVo=R.ItemUtils.getPort_shenyu(t.data),this._copyMaterial=i=R.ItemUtils.getPortVoById(this._portBossVo.port),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_MIJINGBOSS:this._portBossVo=R.ItemUtils.getHunyinBoss(t.data),this._copyMaterial=i=R.ItemUtils.getPortVoById(this._portBossVo.port),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_REBORNBOSS:this._portBossVo=R.ItemUtils.getPort_zhuangsheng(t.data),this._copyMaterial=i=R.ItemUtils.getPortVoById(this._portBossVo.port),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_WORLDBOSS:break;case L.EPlayType.PLAYTYPE_VIPBOSS:case L.EPlayType.PLAYTYPE_MONTHBOSS:case L.EPlayType.PLAYTYPE_SUPERBOSS:this._portBossVo=R.ItemUtils.getPort_vipboss(t.data),this._copyMaterial=i=R.ItemUtils.getPortVoById(this._portBossVo.port),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_PAGODA:this.onPagodaChangeMap();break;case L.EPlayType.PLAYTYPE_SBHJ:this.onSBHJChangeMap();break;case L.EPlayType.PLAYTYPE_COPYLADDER:n.msg=t.data;var r=R.ItemUtils.getKingSettingById(1).port;this._copyMaterial=i=R.ItemUtils.getPortVoById(r),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_COPYGEM:case L.EPlayType.PLAYTYPE_COPYJM:case L.EPlayType.PLAYTYPE_COPYCJ:case L.EPlayType.PLAYTYPE_COPYLL:case L.EPlayType.PLAYTYPE_COPYLW:this._copyMaterial=E.GameConfig.getPortByID(E.GameConfig.getPortIDByMatCopyID(e)),this.changeMap(this._copyMaterial.boss_scene);break;case L.EPlayType.PLAYTYPE_COPYZL:this._copyMaterial=E.GameConfig.getPortByID(20011),this.changeMap(this._copyMaterial.boss_scene);break;case L.EPlayType.PLAYTYPE_GUILD_SECRET:var l=this.data.portid;this.port=i=R.ItemUtils.getPortVoById(l),n._portid=l,n._secretId=this.data.mijingid,this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_TASKBOSS:case L.EPlayType.PLAYTYPE_TASKFAMILY:case L.EPlayType.PLAYTYPE_ENTERMINE:case L.EPlayType.PLAYTYPE_GUILD_INVADE:case L.EPlayType.PLAYTYPE_SUMMONBOSS:case L.EPlayType.PLAYTYPE_EXPCOPYPLAY:console.log("执行：EPlayType.PLAYTYPE_EXPCOPYPLAY"),this.port=i=R.ItemUtils.getPortVoById(this.data.portid),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_PASSIONPOINT:var h=E.GameConfig.pointSettingVo[1];this.port=i=R.ItemUtils.getPortVoById(h.port),console.log("GameScene::onPlayTypeChange:tPortVo.boss_scene="+i.boss_scene),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_BLOODYBATTLE:var c=P.HotBloodWarManager.getInstance().getSetting("portId");this.port=i=R.ItemUtils.getPortVoById(c.value),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_KFRX:var u=H.KFHotBloodManager.ins().getSetting("portId");this.port=i=R.ItemUtils.getPortVoById(u.value),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_KFZY:var p=V.KFZYManager.ins().centerPort();this.port=i=R.ItemUtils.getPortVoById(p),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_KFTB:var d=M.KFTManager.ins().kfTBWorldMapVo().portid;this.port=i=R.ItemUtils.getPortVoById(d),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_BLOODYTEMPLE:break;case L.EPlayType.PLAYTYPE_SANDYNIGHT:var g=k.SandyNightManager.getInstance().getSetting("port").value;this.port=i=R.ItemUtils.getPortVoById(g),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_ALLWORLDBOSS:var v=D.CrossSvrBossManager.getIns().getCSBossVo(t.data).port;this.port=i=R.ItemUtils.getPortVoById(v),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_HELPFIGHT:n.msg=t.data;var f=+E.GameConfig.commonJson.helpportid.value;this.port=i=R.ItemUtils.getPortVoById(f),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_KFSD:var y=G.KFSDWarManager.getInstance().getPortId();this.port=i=R.ItemUtils.getPortVoById(y),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_KFJJC:n.fightMsg=t.data;var m=E.GameConfig.kfjjcVoCfg.port;this.port=i=R.ItemUtils.getPortVoById(Number(m.value)),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_KFSQJD:var _=U.KfShenQiJinDiManager.ins().getEnterPortID();this.port=i=R.ItemUtils.getPortVoById(_),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_LEGENDCOPY:n.msg=t.data;var C=B.TeamManager.getTeamFightMsg(t.data.teamUid);if(C){var I=E.GameConfig.teamCopyVoCfg[C.level];I&&(this.port=i=E.GameConfig.getPortByID(I.portid),this.changeMap(i.boss_scene))}break;case L.EPlayType.PLAYTYPE_SWY:var b=S.RoleCenter.instans.self.swyLayer,w=N.ShenweiyuWarManager.getInstance().getSetting(b);this.port=i=R.ItemUtils.getPortVoById(w.portID[0]),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_SWYKF:b=S.RoleCenter.instans.self.swyLayer,w=N.ShenweiyuWarManager.getInstance().getSetting(b),this.port=i=R.ItemUtils.getPortVoById(w.portID[0]),this.changeMap(i.boss_scene);break;case L.EPlayType.PLAYTYPE_ROUGHCOPY:this._copyMaterial=E.GameConfig.getPortByID(20020),this.changeMap(this._copyMaterial.boss_scene)}A.E.ins.event(T.EventName.PLAY_TYPE_CHANGED,this.playMan.crtType)},t.prototype.onPagodaChangeMap=function(){var t=S.RoleCenter.instans.vo.portPagoda.secPortId,e=R.ItemUtils.getPortVoById(t);this.changeMap(e.boss_scene)},t.prototype.onSBHJChangeMap=function(){var t=S.RoleCenter.instans.vo.shenbing.huanJingCfgId,e=R.ItemUtils.getPortVoById(t);this.changeMap(e.boss_scene)},t.prototype.changeMap=function(t,e){a.PlayManager.loading=!0,Laya.timer.clear(this,this.frameHandler),r.LayerManager.fightLayer.skilleffectLayer.removeChildren(),r.LayerManager.fightLayer.popLayer.removeChildren(),i.SceneObjManager.instans.clear(),this.map.destroy(),this.mapVo=E.GameConfig.getMapJSON(t),this.mapVo?this.map.createMap(this.mapVo,new Laya.Handler(this,this.mapCompleteHandler)):console.log("找不到地图数据，地图ID:"+t)},t.prototype.mapCompleteHandler=function(t){r.LayerManager.fightLayer.skilleffectLayer.removeChildren(),r.LayerManager.fightLayer.popLayer.removeChildren(),console.log("地图配置加载完成, ID:"+this.mapVo.mapID),Laya.Tween.clearAll(o.SceneObjCtroller.ins.getSelfGroup()),this.startTimer(),l.SoundUtils.getInstance().playMusicById(this.mapVo.soundId),a.PlayManager.loading=!1,this.playMan.play.init(t)},t.prototype.portUpdate=function(){this.port=E.GameConfig.getPortByID(S.RoleCenter.instans.self.portstatus.portindex),this.playMan.crtType==L.EPlayType.PLAYTYPE_PORT&&this.changeMap(this.port.boss_scene)},t.prototype.startTimer=function(){Laya.timer.loop(t.frameLoop,this,this.frameHandler),this._lastTime=Date.now()},t.prototype.stopTimer=function(){Laya.timer.clear(this,this.frameHandler),y.stopAll()},t.prototype.frameHandler=function(){this._deltaTime=Date.now()-this._lastTime,this._lastTime=Date.now(),this.map&&this.map.graph&&i.SceneObjManager.instans.draw(this._deltaTime),this.playMan.play&&(this.playMan.play.frameMove(),this.map&&this.map.graph&&r.LayerManager.fightLayer.updateItem())},Object.defineProperty(t.prototype,"selfInfo",{get:function(){return S.RoleCenter.instans.self},enumerable:!0,configurable:!0}),t.frameLoop=33,t.fps=30,t.OFFLIEN_MODE=!0,t}();e.GameScene=m}),define("src/g/fight/osprite/map/MapCovert",["require","exports","src/g/fight/osprite/GameScene","../../../net/messages/InventoryAddGS2C"],function(t,e,h,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.parseBySemicolon=function(t){for(var e=t.split(";"),i=[],n=0;n<e.length;n++){var s=e[n].split("|"),o=[];o[0]=parseInt(s[0]),o[1]=parseInt(s[1]),i.push(o)}return i},t.parseToArr2=function(t){for(var e=t.split(";"),i=[],n=0;n<e.length;n++){var s=e[n].split("|");i.push(parseInt(s[0])),i.push(parseInt(s[1]))}return i},t.parseArrByDot=function(t){for(var e=[],i=t.length/2,n=0;n<i;n++){var s=[];s[0]=t[2*n],s[1]=t[2*n+1],e.push(s)}return e},t.parseToArrNum=function(t){var e=[],i=t.split("|");return e[0]=parseInt(i[0]),e[1]=parseInt(i[1]),e},t.parseToNumber=function(t){for(var e=t.split(","),i=[],n=0;n<e.length;n++)i.push(parseInt(e[n]));return i},t.getMonsterPos=function(t,e,i){void 0===i&&(i=3);var n=[];n[0]=[t,e-i],n[1]=[t+i,e-i],n[2]=[t+i,e],n[3]=[t+i,e+i],n[4]=[t,e+i],n[5]=[t-i,e+i],n[6]=[t-i,e],n[7]=[t-i,e-i];for(var s=[],o=0;o<8;o++)h.GameScene.ins.map.isCross(n[o])&&s.push(n[o]);if(s.length<=0)for(var a=0;a<8;a++)s.push([t,e]);return s},t.getNearPoint=function(t,e,i){void 0===e&&(e=3),void 0===i&&(i=!0);var n=[];if(n[0]=[t[0],t[1]-1],n[1]=[t[0]+1,t[1]-1],n[2]=[t[0]+1,t[1]],n[3]=[t[0]+1,t[1]+1],n[4]=[t[0],t[1]+1],n[5]=[t[0]-1,t[1]+1],n[6]=[t[0]-1,t[1]],n[7]=[t[0]-1,t[1]-1],n[8]=[t[0],t[1]],i)for(var s=n.length-1;0<=s;s--)h.GameScene.ins.map.isCross(n[s])||n.splice(s,1);var o=[];if(n.length<e)if(0==n.length)console.error("请检查种怪点周围是否能放下"+e+"只怪");else for(s=0;s<e-n.length;s++)n.push(t);for(var a=0;o.length<e;)a=Math.random()*n.length>>0,o.push(n[a]),n.splice(a,1);return o},t.getSeedPoint=function(){return this.seed[~~(this.seed.length*Math.random())]},t.getDrops=function(t,e){for(var i=[],n=0;n<e;n++)i[n]=new l.InventoryAddGS2C;for(var s=t.currencyList,o=t.itemList,a=t.equipList,r=0;r<s.length;r++){i[Math.random()*e>>0].currencyList.push(s[r])}for(r=0;r<o.length;r++){i[Math.random()*e>>0].itemList.push(o[r])}for(r=0;r<a.length;r++){i[Math.random()*e>>0].equipList.push(a[r])}return i},t.getICON=function(t){},t.getFreePos=function(t){if(t){var e=[[1,-1],[1,1],[-1,1],[-1,-1],[0,-1],[1,0],[0,1],[-1,0]],i=h.GameScene.ins.map,n=4*Math.random()>>0,s=e[n][0]+t[0],o=e[n][1]+t[1];if(i.isCross([s,o]))return[s,o];for(var a=0;a<8;){var r=e[a][0]+t[0],l=e[a][1]+t[1];if(i.isCross([r,l]))return[r,l];a++}}return t},t.getPos=function(){},t.getFreePosList=function(t,e){void 0===e&&(e=!0);for(var i,n,s=[[1,-1],[1,1],[-1,1],[-1,-1],[0,-1],[1,0],[0,1],[-1,0]],o=h.GameScene.ins.map,a=[],r=0,l=s.length;r<l;)i=[s[r][0]+t[0],s[r][1]+t[1]],o.isCross(i)&&a.push(i),r++;if(e)for(r=0,l=a.length;r<l;)(n=r<4?Math.random()*Math.min(4,l)>>0:Math.random()*Math.min(8,l)+4>>0)!=r&&(i=a[n],a[n]=a[r],a[r]=i),r++;return a},t.seed=[[60,33],[60,31],[61,30],[62,30]],t}();e.MapCovert=i}),define("src/g/fight/osprite/obj/JoinAttSkillItem",["require","exports","src/g/fight/osprite/obj/BaseSprite","src/g/fight/osprite/SceneObjManager","../../../../manager/LayerManager","../../../../core/E","../../../../enum/EventName","../../../../component/ShockEffect"],function(t,e,i,o,a,n,s,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(e){function t(){var t=e.call(this)||this;return n.E.ins.once(s.EventName.PLAY_TYPE_CHANGED,t,t.onPlayComplete),t}return __extends(t,e),t.prototype.fire=function(t,e,i,n,s){void 0===n&&(n=!1),this.skillEffect=r.ShockEffect.create(),this.skillEffect.scale(s,s),this.skillEffect.load(i),this.skillEffect.once(r.ShockEffect.PLAY_COMPLETE,this,this.onPlayComplete),n&&(this.skillEffect.shockframeIndex=2),o.SceneObjManager.instans.regObject(this),a.LayerManager.fightLayer.skilleffectLayer.addChild(this.skillEffect),this.setWorldXY(t,e)},t.prototype.onPlayComplete=function(){o.SceneObjManager.instans.unregObject(this),n.E.ins.off(s.EventName.PLAY_TYPE_CHANGED,this,this.onPlayComplete),this.skillEffect.removeSelf()},t.prototype.frameMove=function(t){this.updatePoint(),this.skillEffect&&(this.skillEffect.x=this.gridX,this.skillEffect.y=this.gridY)},t.STARTSHOCKSCREEN="STARTSHOCKSCREEN",t}(i.BaseSprite);e.JoinAttSkillItem=l}),define("src/g/fight/osprite/obj/SoulUnit",["require","exports","src/g/fight/osprite/obj/Unit_New","src/g/fight/base/RES","src/g/fight/osprite/obj/Npc","src/g/fight/osprite/GameScene","../../../../component/GAnimation","src/g/fight/osprite/obj/BaseSprite","src/g/fight/osprite/SceneObjManager","../../../../manager/LayerManager","src/g/fight/osprite/map/MapConst"],function(t,e,n,s,o,p,a,i,r,l,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(i){function t(t){void 0===t&&(t=null);var e=i.call(this)||this;return e._bodys=[],e.body=new Laya.Sprite,e.coat=new a.GAnimation,e.body.addChild(e.coat),e.shadow=new Laya.Sprite,e.shadow.graphics.drawTexture(Laya.loader.getRes("res/custom/yingzi.png")),e.shadow.pivot(65,50),t||(t=s.RES.npcPath(99,-1,-1)),t&&(e.coat.interval=o.NPC.NPCANI_INTERNAL,e.coat.load(t)),e.actorType=7,e}return __extends(t,i),t.prototype.setScale=function(t){void 0===t&&(t=1),this.coat.scale(t,t)},t.prototype.setOffsetY=function(t){this.coat.y=t},t.prototype.reloadUrl=function(t){this.coat.load(t)},t.prototype.follow=function(t,e){void 0===e&&(e=1),this._target=t,this._distance=e},t.prototype.addMap=function(){l.LayerManager.fightLayer.roleLayer.addChild(this.body),l.LayerManager.fightLayer.shadowLayer.addChild(this.shadow),r.SceneObjManager.instans.regObject(this)},t.prototype.removeMap=function(){this.body.removeSelf(),this.shadow.removeSelf(),r.SceneObjManager.instans.unregObject(this)},t.prototype.addObstruct=function(t){t!=this&&-1==this._bodys.indexOf(t)&&this._bodys.push(t)},t.prototype.removeObstruct=function(t){var e=this._bodys.indexOf(t);-1!=e&&this._bodys.splice(e,1)},t.prototype.targetPoint=function(){return this._targetPoint?this._targetPoint:[this.worldX,this.worldY]},t.prototype.frameMove=function(t){if(this._targetPoint)this.move(t);else{var e=this._target.getMainRole();if(e){for(var i=!1,n=this.worldX,s=this.worldY,o=this._bodys.length,a=0;a<o;){var r=this._bodys[a].targetPoint();if(r[0]==this.worldX&&r[1]==this.worldY){e?Math.abs(this.worldX-e.worldX)>Math.abs(this.worldY-e.worldY)?0<this.worldY-e.worldY?s--:s++:0<this.worldX-e.worldX?n--:n++:.5<Math.random()?n++:s++,this._targetPoint=[n,s],i=!0;break}a++}if(!i&&this._target){var l=this.worldX-e.worldX,h=this.worldY-e.worldY,c=Math.abs(l)-this._distance,u=Math.abs(h)-this._distance;0<c&&(n=0<l?this.worldX-1:this.worldX+1),0<u&&(s=0<h?this.worldY-1:this.worldY+1),(0<n||0<s)&&(this._targetPoint=[n,s])}}}this.updatePoint(),this.body.pos(this.gridX,this.gridY),this.shadow.x=this.body.x,this.shadow.y=this.body.y},Object.defineProperty(t.prototype,"move_speed",{get:function(){return n.Unit_New.move_SPEED},enumerable:!0,configurable:!0}),t.prototype.move=function(t){var e=[this.mapX,this.mapY],i=this._targetPoint,n=e[0],s=e[1],o=i[0]*d.MapConst.MAP_TILED_W+d.MapConst.MAP_TILED_W/2,a=i[1]*d.MapConst.MAP_TILED_W+d.MapConst.MAP_TILED_W/2,r=this.move_speed/p.GameScene.fps,l=Math.sqrt(Math.pow(n-o,2)+Math.pow(s-a,2)),h=Math.atan2(a-s,o-n),c=Math.sin(h),u=Math.cos(h);l<=r?(this.setMapXY(o,a),this._targetPoint=null):this.setMapXY(r*u+n,r*c+s),p.GameScene.ins.map.isTranslucent([this.worldX,this.worldY])?this.body.alpha=.2:this.body.alpha=1},t.prototype.destroyUnit=function(){this.removeMap(),this.coat&&this.coat.clear(),this.body&&(this.body.destroy(!1),this.body=null,this.coat=null),this.shadow&&(this.shadow.destroy(!0),this.shadow=null),this._bodys=null,i.prototype.destory.call(this)},t}(i.BaseSprite);e.SoulUnit=h}),define("src/g/fight/osprite/skill/MonsterAttack",["require","exports","src/g/fight/osprite/skill/BaseSkill","../../../../utils/SoundUtils"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.fire=function(t){this._holdBy&&this._holdBy.fightTarget&&(this._holdBy.fightTarget.isSelfUnit&&this._holdBy.data.moResVo&&this._holdBy.data.moResVo.soundAtt&&n.SoundUtils.getInstance().playSound("sound/monster/"+this._holdBy.data.moResVo.soundAtt+".mp3",1,1))},e}(i.BaseSkill);e.MonsterAttack=s}),define("src/g/fight/osprite/skill/PetAttack",["require","exports","src/g/fight/osprite/skill/BaseSkill"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(t,e,i){return n.call(this,t,e,i)||this}return __extends(t,n),t}(i.BaseSkill);e.PetAttack=n}),define("src/g/fight/osprite/skill/SkillConstants",["require","exports","src/g/fight/osprite/skill/BaseSkill","src/g/fight/osprite/skill/MonsterAttack","src/g/fight/osprite/skill/PetAttack","src/g/fight/osprite/skill/ClientSkill"],function(t,e,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.createClientSkill=function(t,e,i,n){return new r.ClientSkill(t,e,i,n)},t.createSkill=function(t,e,i){var n;switch(e){case 16:case 17:case 18:case 19:n=new o.MonsterAttack(t,e,i);break;case 20:n=new a.PetAttack(t,e,i);break;default:n=new s.BaseSkill(t,e,i)}return n},t.SKILL_TYPE_DAMAGE="1",t.SKILL_TYPE_BUFF="2",t.SKILL_TYPE_PET="3",t.DAMAGE_PHYSICS_MODE="PHYSICS",t.DAMAGE_SPELL_MODE="SPELL",t.TARGET_SELF="1",t.TARGET_OWN_ONLY="2",t.TARGET_OWN_SOME="3",t.TARGET_OWN_ALL="4",t.TARGET_ENEMY_ONLY="5",t.TARGET_ENEMY_SOME="6",t.TARGET_ENEMY_ALL="7",t.TARGET_OWN_OTHER="9",t}();e.SkillConstants=i}),define("src/g/fight/osprite/skill/SkillTarget",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.SELF=1,t.SELF_UNIT=2,t.SELF_ALL=3,t.ENEMY=5,t.ENEMY_ALL=6,t.PET=8,t.SELF_OTHER=9,t}();e.SkillTarget=i}),define("src/g/fight/osprite/buff/ChoasBuff",["require","exports","src/g/fight/osprite/buff/basic/DurationBuff"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(s){function t(t,e,i,n){return s.call(this,t,e,i,n)||this}return __extends(t,s),t.prototype.reset=function(){s.prototype.reset.call(this),this.addEffect()},t.prototype.addEffect=function(){this.target&&(this.target.isInChoas=!0)},t.prototype.onUpdate=function(t){return s.prototype.onUpdate.call(this,t)},t.prototype.removeEffect=function(){this.target&&(this.target.isInChoas=!1)},t.BUFF_ID=5,t}(i.DurationBuff);e.ChoasBuff=n}),define("src/g/fight/osprite/skill/BaseSkill",["require","exports","../../../../utils/ItemUtils","src/g/fight/osprite/skill/SkillConstants","../../../net/messages/sbkFormula","../../../../meta/WingPassiveVo","../../../../utils/SoundUtils","../../../../enum/GameConst","../../../../utils/system/FloatEffect","src/g/fight/osprite/skill/SkillTarget","src/g/fight/osprite/buff/ChoasBuff","../../../net/messages/UserAttackMsg"],function(t,e,n,s,b,i,o,w,S,a,r,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e,i){this._cd=0,this._fireTime=0,this.level=0,this._holdBy=t,this.data=n.ItemUtils.getSkillVoById(e),this.level=i,this.data?this._cd=1e3*this.data.cd:(this._cd=1,0<e&&console.error(e))}return t.prototype.clear=function(){this._holdBy=null,this.data=null},t.prototype.excute=function(t){return!!this.cooldown(t)},t.prototype.fireSkill=function(t,e){this._fireTime=t,this.fire(e)},t.prototype.fire=function(t,e){if(void 0===e&&(e=!0),this._holdBy){var i=this._holdBy.getFightGroup();this.data.sound&&i&&i.isSelf&&o.SoundUtils.getInstance().playSoundById(this.data.sound)}},t.prototype.playHurtEffByIndex=function(t){void 0===t&&(t=0);var e=this.getTargets();""!=this.data.mode&&null!=this.data.mode&&e&&0<e.length&&this.playHurtEff(e.shift())},t.prototype.playHurtEff=function(t){t&&t.beHit(this.data)},t.prototype.cooldown=function(t){return t-this._fireTime>=this._cd*this._holdBy.attackSpeedUpCoef},t.prototype.getTargets=function(){var e=this,i=new Array;switch(""+this.data.target){case s.SkillConstants.TARGET_ENEMY_ONLY:i.push(this._holdBy.fightTarget);break;case s.SkillConstants.TARGET_OWN_ONLY:break;case s.SkillConstants.TARGET_ENEMY_SOME:if(!this._holdBy.fightTarget)break;var t=this._holdBy.fightTarget.getFightGroup();t?i=t.getValidArr():i.push(this._holdBy.fightTarget);break;case s.SkillConstants.TARGET_OWN_SOME:i=6==this._holdBy.actorType?[this._holdBy]:this._holdBy.getFightGroup().getFUList();break;case s.SkillConstants.TARGET_ENEMY_ALL:i.push(this._holdBy.fightTarget);break;case s.SkillConstants.TARGET_OWN_ALL:break;case s.SkillConstants.TARGET_SELF:i.push(this._holdBy);break;case s.SkillConstants.TARGET_OWN_OTHER:this._holdBy.getFightGroup().getNoPetArr().forEach(function(t){t!=e._holdBy&&i.push(t)})}return i},t.prototype.doBuffSkill=function(){var t=[],e=this.getTargets();this.data.type==a.SkillTarget.SELF_UNIT&&this._holdBy.beHit(this.data,!0);for(var i=0;i<e.length;i++){var n=e[i];n&&(n.set_buf(this._holdBy,this.data.buff,this.level),this.data.type!=a.SkillTarget.SELF_UNIT&&n.beHit(this.data,!1),t.push(E.ESkillRes.COMMON_HURT))}return t},t.prototype.getWingSkillHurtRate=function(t){var e=t.getWingSkillID();if(!e)return 1;var i=n.ItemUtils.getWingPassiveVoById(e);return Math.random()<=i.spellRate?i.hurtRate:1},t.prototype.getWeiSheIncHurt=function(t,e){return t.getGuanZhi()>e.getGuanZhi()?i.WingPassiveVo.WEISHE_INCHURT:0},t.prototype.getJianTiDecHurt=function(t,e){return e.get_STORYEXP()>t.get_STORYEXP()?i.WingPassiveVo.JIANTI_DECHURT:0},t.prototype.doSkillHurt=function(t,e,i,n,s){void 0===s&&(s=1);var o=!1,a=!1;2==t.actorType&&(o=!0),1==t.actorType&&(a=!0);var r=this._holdBy.get_PassiveMgr(),l=t.get_PassiveMgr(),h=this._holdBy;if(!t.destoryed&&!h.destoryed){if(b.sbkFormula.isMiss(h.get_HIT(),t.get_MISS()))return S.FE.passiveFloat(this._holdBy.face,w.GameConst.FIGHTRES+"shanbi.png",t.body),E.ESkillRes.MISS;var c=E.ESkillRes.COMMON_HURT,u=h.get_INCHURT(),p=t.get_DECHURT(),d=h.get_STRONG(),g=h.get_ATT();o&&(u+=h.get_BOSSINCHURT(),d+=h.get_BOSSSTRONG()),2==h.actorType&&a&&(p+=h.get_BOSSDECHURT());var v=0;1==h.actorType&&1==t.actorType&&l&&((v=this.getWeiSheIncHurt(h,t))&&S.FE.chopFloat(t),u+=v,p+=this.getJianTiDecHurt(h,t)),l&&(g-=l.passive_DECATT()*g),r&&(e-=r.passive_DECDEF()*e);var f,y=b.sbkFormula.skillAttackHurt(g,h.get_ATT_MULTI(),e,i,n,u,p,h.get_extHURT(this.data.id));f=!h.isSummonPet&&2!=h.actorType&&b.sbkFormula.isCrit(d,t.get_ANTISTRONG())?(c=E.ESkillRes.CRIT,b.sbkFormula.calCritHurt(y,h.get_STRONGHURT())):y;var m=0;b.sbkFormula.isHitBack(t.get_HITBACKRATE())&&(m=b.sbkFormula.calHitBackHurt(f,t.get_HITBACK()));var _=0;l&&(_=f*l.passive_HITBACK()),0!=(m=-Math.floor(m+_))&&h.chg_HP(m,t,E.ESkillRes.NULL,E.ESkillRes.NULL,t.isHeTi);var C=this.getWingSkillHurtRate(h);f*=C;var I=E.ESkillRes.NULL;return 1!=C&&(I=E.ESkillRes.JIFENG),0<t.buf_ROA&&(f*=1-t.buf_ROA),r&&(f+=r.passive_HP_HURT(t)*f),(f*=s)<1&&(f=1),f=-Math.floor(f),t.chg_HP(f,h,c,I,h.isHeTi),c}},t.prototype.calSkillHurt=function(){this._holdBy;var t=this.getTargets();if(""==this.data.mode||null==this.data.mode)return this.doBuffSkill();for(var e=[],i=0;i<t.length;i++){var n=t[i];if(n){var s=0,o=0,a=0;a="PHYSICS"==this.data.mode?(s=n.get_PDEF(),o=n.get_PDEF_MULTI(),n.buf_PDEF):(s=n.get_SDEF(),o=n.get_SDEF_MULTI(),n.buf_SDEF);var r=1;this.data.rate.length>=this.level&&(r=this.data.rate[this.level-1]/100);var l=this.doSkillHurt(n,s,o,a,r);e.push(l),l!=E.ESkillRes.MISS&&this.data.buff&&n.set_buf(this._holdBy,this.data.buff,this.level),1==t.length&&l!=E.ESkillRes.MISS&&this.addMabi(n)}}return e},t.prototype.addMabi=function(t){var e=0|this._holdBy.data.CHOAS;if(e){var i=e/1e4*(1-(0|t.data.ANTICHOAS)/1e4);Math.random()<=i&&(S.FE.passiveFloat(t.face,w.GameConst.FIGHTRES+"mabi_"+this._holdBy.job+".png",t.body),t.set_buf(this._holdBy,r.ChoasBuff.BUFF_ID,this.level))}},t}();e.BaseSkill=l}),define("src/g/fight/osprite/skill/ClientSkill",["require","exports","src/g/fight/osprite/skill/BaseSkill"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(o){function t(t,e,i,n){void 0===n&&(n=!0);var s=o.call(this,t,e,i)||this;return s.isAutoDel=!0,s._state=-1,s.startTime=0,s.isAutoDel=n,s}return __extends(t,o),t.prototype.run=function(){this._state=0},t.prototype.frameMove=function(t,e){if(0==this._state)this.startTime=t,this.data.sdur0&&this._holdBy.playWeaponEffect(this.data.sdur0,this.data),this._state++;else if(1==this._state)t-this.startTime>=this.data.skillEffDelay&&(this.targetList=this.getTargets(),this._state++);else if(2==this._state){if(t-this.startTime>=this.data.beSkillEffDelay){if(this.data.sdur1)for(var i=this.targetList?this.targetList.length:0,n=0;n<i;)this.targetList[n].playWeaponEffect(this.data.sdur1,this.data),n++;this._state++}}else if(3==this._state){if(t-this.startTime>=this.data.hurtDelay){var s=this.data.buffArr;if(s)for(i=this.targetList?this.targetList.length:0,n=0;n<i;){for(var o=0;o<s.length;o++)this.targetList[n].set_buf(this.targetList[n],s[o],10);n++}this._state++}}else 4==this._state&&(this.isAutoDel&&this.removeSelf(),this.targetList=null,this._state++);this.next&&this.next.frameMove(t,e)},t.prototype.addLastSkill=function(t){t&&(this.next?this.next.addLastSkill(t):(this.next=t).pre=this)},t.prototype.removeSelf=function(){this.pre&&(this.pre.next=this.next),this.next&&(this.next.pre=this.pre),this.pre=null,this.next=null},t.prototype.clear=function(){this.removeSelf(),o.prototype.clear.call(this)},t}(i.BaseSkill);e.ClientSkill=n}),define("src/g/fight/osprite/obj/HaloEffectObj",["require","exports","../../../../utils/data/ListSimple","../../../../utils/system/ServerTime","../../../../config/GameConfig","src/g/Effects/UIEffectsFactory","../../../../component/GAnimation","src/g/fight/base/RES"],function(t,e,i,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(o){function t(){return null!==o&&o.apply(this,arguments)||this}return __extends(t,o),t.prototype.setData=function(t,e,i){if(t&&i>a.ServerTime.serverTime){var n=r.GameConfig.Rygh[e];if(n){var s=l.UIEffectsFactory.Ins.getSourceUrlById(n.effect);this.haloEff||(this.haloEff=new h.GAnimation,c.RES.setResUrl(s),this.haloEff.load(s,!0)),this.haloEff.zOrder=0,t.addHaloLayer(this.haloEff)}Laya.timer.once(1e3*(i-a.ServerTime.serverTime),this,this.clear)}else o.prototype.clear.call(this)},t.prototype.clear=function(){Laya.timer.clear(this,this.clear),this.haloEff&&(this.haloEff.removeSelf(),this.haloEff=null),o.prototype.clear.call(this)},t}(i.ListSimple);e.HaloEffectObj=n}),define("src/g/fight/osprite/obj/FightGroup",["require","exports","src/g/fight/osprite/obj/Unit_New","src/g/fight/osprite/map/MapCovert","../../../net/messages/CurrencyType","../../../../utils/DropUtil","src/g/fight/osprite/obj/HeroUnit","src/g/fight/osprite/obj/UnitCovert","../../../../manager/LayerManager","../../../../utils/SoundUtils","../../../../utils/ItemUtils","src/g/fight/osprite/obj/JoinAttSkillItem","src/g/index/ctrl/BtnSkiilCtrl","src/g/fight/osprite/obj/SelfUnit","src/g/fight/osprite/SceneObjManager","../../../../utils/system/FloatEffect","src/g/fight/osprite/GameScene","../../../../meta/SkillVo","../../../../core/E","../../../../enum/EventName","src/g/fight/osprite/map/MapConst","../../../../manager/GameSocketManager","../../../net/messages/UserMoveMsg","../../../../enum/JobEnum","../../../../manager/RoleCenter","src/g/fight/base/RES","src/g/fight/osprite/skill/ClientSkill","../../../../utils/system/ServerTime","src/g/fight/osprite/obj/HaloEffectObj","src/g/fight/osprite/obj/Shenjiang","../../../../enum/HpType","../../../../enum/enumPet"],function(t,e,h,c,l,u,r,s,o,p,C,d,I,g,a,b,v,f,y,m,_,w,S,E,T,A,R,L,x,P,k,D){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function n(t){var e=i.call(this)||this;return e.groupID="",e._fightUnitArr=[],e._fgNum=0,e._targetFG=null,e._targetPI=null,e._targetNPC=null,e._mainRole=null,e.isSelf=!1,e.uId=-1,e.portId=-1,e.heroData=null,e.otherData=null,e.userData=null,e._limitDrawKey=!1,e._forceHideKey=!1,e._allHideKey=!1,e._isInSafeAreaKey=!1,e.campId=-1,e._removeUnitArr=[],e.deathCount=0,e._posx=0,e._posy=0,e.groupID=t||"",e.uId=n.GET_UID(),e}return __extends(n,i),n.GET_UID=function(){return n.UID+=1},n.prototype.clearFightTarget=function(){for(var t=0;t<this._fightUnitArr.length;t++)this._fightUnitArr[t].setFightTarget(null)},n.prototype.getUnitByIndex=function(t){return this._fightUnitArr[t]},n.prototype.getMainRole=function(){if(this._mainRole&&!this._mainRole.isDeath())return this._mainRole;this._mainRole=null;for(var t=0;t<this._fightUnitArr.length;t++)if(!this._fightUnitArr[t].isDeath()){this._mainRole=this._fightUnitArr[t];break}return this._mainRole},n.prototype.startHeti=function(){var t=new f.SkillVo;t.sdur0Rate=2;for(var e,i=this.getNoPetArr(),n=i.length-1;0<=n;)e=i[n],0==n?e.playWeaponEffect("fa_huo",t):e.playWeaponEffect("E1_48",t),n--;Laya.timer.once(1e3,this,this.doAddBuff)},n.prototype.doAddBuff=function(){var t=this._fightUnitArr[0];t.set_buf(t,11,1),t.set_buf(t,12,1),t.set_buf(t,13,1),t.set_buf(t,15,1)},n.prototype.showFollowRing=function(t,e){void 0===e&&(e=!1);var i=this.getMainRole();if(i){var n=this._ringUnit;n?n.avatarId=t:(this._ringUnit=n=new P.RingLingPet(t),n.addToFightLayer(),n.resetUnit(i.worldX,i.worldY),this.addFightUnit(n));var s=e?k.HpType.monster:k.HpType.role;n.setTopHpBarType(s),n.set_DATA(C.ItemUtils.getPetVoById(1));var o=i.fightTarget;return o&&1==i.status&&n.setFightTarget(o),n}},n.prototype.getTotalAtt=function(){for(var t=0,e=0;e<this._fightUnitArr.length;e++)t+=this._fightUnitArr[e].get_ATT();return t},n.prototype.getTotalHp=function(){for(var t=0,e=null,i=0;i<this._fightUnitArr.length;i++)(e=this._fightUnitArr[i]).isSummonPet()||(t+=e.totalHp);return t},n.prototype.getHp=function(){for(var t=0,e=null,i=0;i<this._fightUnitArr.length;i++)(e=this._fightUnitArr[i]).isSummonPet()||(t+=e.hp);return t},n.prototype.assignmentFightTarget=function(){if(this._targetFG){var t=this._targetFG.getValidArr(),e=t.length;if(0!=e){var i,n=null;this._targetFG.groupID&&(n=this._targetFG.getSortBeAttackUnit());for(var s=0;s<this._fgNum;s++)(i=this._fightUnitArr[s])&&(i.isDeath()||(i.status=0,n?i.setFightTarget(n):i.setFightTarget(t[s%e])));var o=this.getValidArr(),a=o.length;n=null,this.isHeroFG()&&(n=this.getSortBeAttackUnit());for(var r=this._targetFG.getCount(),l=0;l<r;l++)(i=this._targetFG.getUnitByIndex(l)).isDeath()||(i.status=0,n?i.setFightTarget(n):i.setFightTarget(o[l%a]))}}else this.clearFightTarget()},n.prototype.getValidArr=function(){for(var t=[],e=0,i=this._fightUnitArr.length;e<i;e++){var n=this._fightUnitArr[e];n.isDeath()||n.isSummonPet()||t.push(n)}return t},n.prototype.getNoPetArr=function(){for(var t=[],e=0,i=this._fightUnitArr.length;e<i;e++){var n=this._fightUnitArr[e];n.isSummonPet()||t.push(n)}return t},n.prototype.isHeroFG=function(){return!!this.groupID},n.prototype.deathAllPet=function(){for(var t=this._fightUnitArr,e=0;e<t.length;e++){var i=t[e];i.isSummonPet()&&i.setHp(0)}},n.prototype.getPet=function(t){void 0===t&&(t=D.enumPet.normal);for(var e=this._fightUnitArr,i=0;i<e.length;i++){var n=e[i];if(n.isSummonPet()&&n.petType==t)return n}return null},n.prototype.assignmentPickItem=function(){for(var t=!1,e=null,i=0;i<this._fightUnitArr.length;i++)(e=this._fightUnitArr[i]).isDeath()||(!t&&this._targetPI?(e.setPickupTargets(this._targetPI),t=!0):(e.status=0,e.stand()))},n.prototype.getFUList=function(){return this._fightUnitArr},n.prototype.refreshHalo=function(){for(var t=0;t<this._fightUnitArr.length;t++)this.checkAndAddHaloEffect(this._fightUnitArr[t])},n.prototype.checkAndAddHaloEffect=function(t){if(L.ServerTime.isInited){if(!t.isSummonPet()&&2!=t.actorType&&6!=t.actorType){var e;if(t.clearAllHalo(),this.userData)e=this.userData.haloData;else if(this.otherData)e=this.otherData.haloData;else{var i=T.RoleCenter.instans.getOtherData(this.groupID);if(!i)return void console.error("FightGroup里没有sbkUserData数据");e=i.haloData}if(e){for(var n=0,s=e.endTimeArr.length,o=0,a=L.ServerTime.serverTime,r=0;o<s;){if(a<(r=e.endTimeArr[o])){n=e.idArr[o];break}o++}if(n){var l=new x.HaloEffectObj;l.setData(t,n,r),t.addHalo(l)}}}}else y.E.ins.once(m.EventName.SERVER_TIME_UPDATE,this,this.refreshHalo)},n.prototype.addFightUnit=function(t){this.checkAndAddHaloEffect(t),t.groupUid=this.uId,t.index=this._fightUnitArr.length,this._fightUnitArr.push(t),t.setFightGroup(this),this._fgNum=this._fightUnitArr.length,(this._limitDrawKey||this._forceHideKey)&&t.limitDraw(!0,this._allHideKey)},n.prototype.insertFightUnit=function(t,e){var i=this._fightUnitArr.splice(t,this._fightUnitArr.length-t);this.addFightUnit(e);for(var n=0;n<i.length;n++)this.addFightUnit(i[n])},n.prototype.getNextMonster=function(){var t=this._fightUnitArr[this._midx];return this._midx++,this._midx>=this._fightUnitArr.length&&(this._midx=0),t},n.prototype.assignMonsterDrop=function(t){this._midx=Math.floor(Math.random()*this._fightUnitArr.length);for(var e=t.currencyList,i=0;i<this._fightUnitArr.length;i++)this._fightUnitArr[i].clearDrop();for(i=0;i<e.length;i++){if(!(e[i].val<=0))(a=this.getNextMonster())&&(e[i].key==l.CurrencyType.MONEY?a&&a.pushDrop(u.DropUtil.MONEYID,e[i].val):e[i].key==l.CurrencyType.GOLD?a&&a.pushDrop(u.DropUtil.GOLDID,e[i].val):(e[i].key,l.CurrencyType.EXP))}for(i=0;i<t.itemList.length;i+=2)for(var n=t.itemList[i],s=t.itemList[i+1],o=0;o<s;o++){(a=this.getNextMonster())&&a.pushDrop(n,1)}for(i=0;i<t.equipList.length;i++){var a,r=t.equipList[i];(a=this.getNextMonster())&&a.pushDrop(r.equtemplet,1)}},n.prototype.resetHP=function(){for(var t=0;t<this._fightUnitArr.length;t++)this._fightUnitArr[t].resetHP();this.deathCount=0},n.prototype.removePartner=function(){for(var t=1;t<this._fightUnitArr.length;t++){var e=this._fightUnitArr[t];e.removeFromFightLayer(),e.destroyUnit()}0<this._fightUnitArr.length&&(this._fightUnitArr.length=1)},n.prototype.setFGTarget=function(t){t?((this._targetFG=t)._targetFG=this).assignmentFightTarget():(this._targetFG=null,this.assignmentFightTarget())},n.prototype.setOnceTarget=function(t){if(this._targetFG=t,this._targetFG){var e=this._targetFG.getValidArr(),i=e.length;if(0!=i){var n,s=null;this._targetFG.isHeroFG()&&(s=this._targetFG.getSortBeAttackUnit());for(var o=0;o<this._fgNum;o++)(n=this._fightUnitArr[o])&&(n.isDeath()||(n.status=0,s?n.setFightTarget(s):n.setFightTarget(e[o%i])))}}else this.clearFightTarget()},n.prototype.getFGTarget=function(){return this._targetFG},n.prototype.setPITarget=function(t){if(!t)return this._targetPI=null,void this.assignmentPickItem();this._targetPI=t,this.assignmentPickItem(),p.SoundUtils.getInstance().playSoundById(134)},n.prototype.setNPCTarget=function(t){if(t){this._targetNPC=t;for(var e=0;e<this._fightUnitArr.length;e++)this._fightUnitArr[e].setNPCTarget(t)}},n.prototype.moveToPoint=function(t){if(v.GameScene.ins.map.isCross(t))for(var e=0,i=0,n=null,s=!0,o=0;o<this._fightUnitArr.length;o++)this._fightUnitArr[o].isDeath()||(e=(n=s?(s=!1,t):c.MapCovert.getFreePos(t))[0]*_.MapConst.MAP_TILED_W+_.MapConst.MAP_TILED_W/2,i=n[1]*_.MapConst.MAP_TILED_W+_.MapConst.MAP_TILED_W/2,this._fightUnitArr[o].moveToMapPoint(e,i))},n.prototype.moveToMapPoint=function(t,e,i,n){void 0===i&&(i=!1),void 0===n&&(n=null);var s=0,o=0,a=!0,r=!1,l=Laya.Point.TEMP,h=null;l.setTo(0,0);for(var c=0;c<this._fightUnitArr.length;c++)if(h=this._fightUnitArr[c],r=!1,!this._fightUnitArr[c].isDeath())if(n?n==h&&(r=!0):a&&(r=!(a=!1)),r)if(h.moveToMapPoint(t,e),1<h.ways.length)l.x=h.ways[h.ways.length-2].x-h.ways[h.ways.length-1].x,l.y=h.ways[h.ways.length-2].y-h.ways[h.ways.length-1].y,l.normalize();else{if(!(0<h.ways.length))break;l.x=h.mapX-h.ways[h.ways.length-1].x,l.y=h.mapY-h.ways[h.ways.length-1].y,l.normalize()}else{var u=60*c;s=t+l.x*u*.8,o=e+l.y*u*.8,h.moveToMapPoint(s,o)}i&&this.moveToPointNet(t,e)},n.prototype.moveToPointNet=function(t,e){if(this.getMainRole(),-1!=this.portId&&this._mainRole){var i=new S.UserMoveC2GS;i.portid=this.portId,i.username=this.groupID,i.targetx=t,i.targety=e,i.posx=this._mainRole.mapX,i.posy=this._mainRole.mapY,w.GSM.sendServer(i)}},n.prototype.moveStop=function(){for(var t=0;t<this._fightUnitArr.length;t++)this._fightUnitArr[t].moveStop(null)},n.prototype.faceTarget=function(t){for(var e=t.getMapPos(),i=0;i<this._fightUnitArr.length;i++){var n=this._fightUnitArr[i].getMapPos();this._fightUnitArr[i].face=s.UnitCovert.calcFace(n,e)}},n.prototype.getState=function(){if(!this.getFGTarget())return!1;var t=this._fightUnitArr;if(!t)return!1;for(var e=0;e<t.length;e++){var i=t[e];if(!i.isSummonPet()&&2!=i.get_ACTION())return!0}return!1},n.prototype.isDeath=function(){for(var t=this._fightUnitArr,e=0;e<t.length;e++){var i=t[e];if(!i.isSummonPet()&&!i.isDeath())return!1}return!0},n.prototype.isAllDeathHide=function(){for(var t=this._fightUnitArr,e=0;e<t.length;e++){var i=t[e];if(!i.isSummonPet()&&!i.isShowDeath())return!1}return!0},n.prototype.delayDeathHide=function(){for(var t=this._fightUnitArr,e=0;e<t.length;e++){var i=t[e];i.isSummonPet()||i.isDeath()&&i.startDeadDelayHide()}},n.prototype.isVanishDeath=function(){for(var t=this._fightUnitArr,e=0;e<t.length;e++){if(!t[e].isDeath())return!1;if(!t[e].isVanishDeath())return!1}return!0},n.prototype.setDeath=function(){for(var t=this.getFUList(),e=0;e<t.length;e++)t[e].svrSetHP(0)},n.prototype.setVisible=function(t){for(var e=this.getFUList(),i=0;i<e.length;i++)e[i].setUnitVis(t)},n.prototype.setConstHP=function(t){for(var e=this.getFUList(),i=0;i<e.length;i++)e[i].constantHp=t},n.prototype.resetFightGroup=function(t,e){if(void 0===e&&(e=!0),t){for(var i=0;i<this._removeUnitArr.length;i++)this._fightUnitArr.push(this._removeUnitArr[i]);this._removeUnitArr.length=0,this._mainRole=null;var n=this.getFUList(),s=n.length;if(!(s<=0)){if(n[0].coat.scale(1,1),(h.Unit_New.hetiScale=1)==s)n[0].resetUnit(t[0],t[1]);else for(var o=c.MapCovert.getNearPoint(t,s,e),a=o.length,r=0;r<s;r++){var l=r;a<=l&&(l=0),o[l]&&(n[r].resetUnit(o[l][0],o[l][1]),n[r].frameMove(0,0))}this.deathCount=0}}},n.prototype.resetPartner=function(t){if(t){for(var e=this.getFUList(),i=c.MapCovert.getNearPoint(t,e.length),n=1;n<e.length;n++)e[n].resetUnit(i[n][0],i[n][1]);this.deathCount=0}},n.prototype.getTargetAliveFU=function(){if(this.isHeroFG())return this.getSortBeAttackUnit();for(var t=this.getFUList(),e=0;e<t.length;e++)if(!t[e].isDeath())return t[e];return null},n.prototype.getSortBeAttackUnit=function(){for(var t=6,e=null,i=null,n=0;n<this._fightUnitArr.length;n++)!(i=this._fightUnitArr[n]).isDeath()&&i.job<t&&(t=i.job,e=i);return e},n.prototype.getUnitByJob=function(t){for(var e=null,i=0;i<this._fightUnitArr.length&&((e=this._fightUnitArr[i]).isDeath()||e.job!=t);i++);return e},n.prototype.getCount=function(){return this._fightUnitArr?this._fightUnitArr.length:0},n.prototype.getFightCount=function(){for(var t=0,e=this.getNoPetArr(),i=0;i<e.length;i++){t+=e[i].getCombat()}return t},n.prototype.getHpCount=function(){for(var t=0,e=this.getFUList(),i=0;i<e.length;i++){t+=e[i].getHp()}return t},n.prototype.getOrginHpCount=function(){for(var t=0,e=this.getNoPetArr(),i=0;i<e.length;i++){t+=e[i].getTotalHp()}return t},n.prototype.clearBuf=function(){for(var t=this.getNoPetArr(),e=0;e<t.length;e++){t[e].clearBuf()}},n.prototype.removeWeaponEff=function(){for(var t=this.getNoPetArr(),e=0;e<t.length;e++){var i=t[e];i&&i.removeWeaponEff&&i.removeWeaponEff()}},n.prototype.getPercentCountHp=function(){for(var t=0,e=0,i=this.getNoPetArr(),n=0;n<i.length;n++){var s=i[n];e+=s.getTotalHp(),t+=s.getHp()}return 0==e?0:Math.min(1,t/e)},n.prototype.stand=function(){for(var t=this.getFUList(),e=0;e<t.length;e++){var i=t[e];i.status=0,i.stand()}return 0},n.prototype.setPerHp=function(t){for(var e=this.getFUList(),i=0;i<e.length;i++){e[i].setPerHp(t)}},n.prototype.setAllDaeth=function(){for(var t=this.getFUList(),e=0;e<t.length;e++){var i=t[e];i.svrSetHP(0),i.deathHide()}},n.prototype.setConstantHp=function(t){for(var e=this.getFUList(),i=0;i<e.length;i++){e[i].constantHp=t}},n.prototype.addToFightLayer=function(){for(var t=this.getFUList(),e=0;e<t.length;e++){var i=t[e];o.LayerManager.fightLayer.addUnit(i)}},n.prototype.removeFromFightLayer=function(){for(var t=null,e=0;e<this._fightUnitArr.length;e++)t=this._fightUnitArr[e],o.LayerManager.fightLayer.removeUnit(t)},n.prototype.oneUnitDeath=function(t){this.deathCount++,this.deathCount==this._fightUnitArr.length&&this.event(n.ALL_DEATH)},n.prototype.hideOtherUnit=function(){for(var t=null,e=0;e<this._fightUnitArr.length;e++)t=this._fightUnitArr[e],0!=e&&t.setUnitVis(!1)},n.prototype.showOtherUnit=function(t,e){for(var i=null,n=0;n<this._fightUnitArr.length;n++)i=this._fightUnitArr[n],0!=n&&(i.setUnitVis(!0),i.resetUnit(t,e))},n.prototype.resetFightGroupPos=function(t,e){if(void 0===e&&(e=!1),t)for(var i=this.getFUList(),n=c.MapCovert.getNearPoint(t,i.length),s=n.length,o=0;o<i.length;o++){var a=o;s<=a&&(a=0),n[a]&&i[o].resetUnitPos(n[a][0],n[a][1]),e&&(i[o]instanceof r.HeroUnit||i[o]instanceof g.SelfUnit)&&i[o].resetActionState()}},n.prototype.setMapXY=function(t,e){for(var i=0;i<this._fightUnitArr.length;i++)this._fightUnitArr[i].ways.length=0,this._fightUnitArr[i].setMapXY(t,e),this._fightUnitArr[i].stand()},n.prototype.setFGMapXY=function(t,e,i){void 0===i&&(i=60);for(var n=null,s=0;s<this._fightUnitArr.length;s++)if(n=this._fightUnitArr[s],0==s)n.setMapXY(t,e);else{var o=Laya.Point.TEMP;o.setTo(Math.random(),Math.random()),o.normalize();for(var a=t+o.x*(i-1),r=e+o.y*(i-1),l=null,h=Laya.Matrix.TEMP,c=1;!v.GameScene.ins.map.isCrossMapXY(a,r)&&c<8;)h.identity(),h.rotate(Math.PI/4*c),l=h.transformPoint(o),o.setTo(l.x,l.y),a=t+o.x*(i-1),r=e+o.y*(i-1),c++;n.mapX==a&&n.mapY==r||n.setMapXY(a,r)}},n.prototype.visibleTopHpBar=function(t){for(var e=null,i=0;i<this._fightUnitArr.length;i++)(e=this._fightUnitArr[i]).clearBeFocus(),e.topHpBar&&(e.topHpBar.visible=t)},n.prototype.destroyGroup=function(t){if(void 0===t&&(t=!0),this._fightUnitArr){if(t)for(var e=0;e<this._fightUnitArr.length;e++){var i=this._fightUnitArr[e];0,i&&(a.SceneObjManager.instans.delUnitN(i),i.destroyUnit())}this._fightUnitArr=[],this._fgNum=0,this._mainRole=null,this.deathCount=0,this._ringUnit&&(this._ringUnit.destroyUnit(),this._ringUnit=null)}},n.prototype.removeFightUnit=function(t){var e=this._fightUnitArr.indexOf(t);-1<e&&(a.SceneObjManager.instans.delUnitN(t),o.LayerManager.fightLayer.removeUnit(t),this._fightUnitArr.splice(e,1),this._fgNum=this._fightUnitArr.length)},n.prototype.beAttJoinAttSkill=function(t){var e=this.getFUList()[0];this._posx=e.worldX,this._posy=e.worldY,Laya.timer.once(500,this,this.beDeplayJoinAttSkillClient,[t])},n.prototype.beDeplayJoinAttSkillClient=function(){},n.prototype.playClientJoinAttSkill=function(t){y.E.ins.event(m.EventName.JOINSKILLSHOW,[t.comboid]);var e=this.getFGTarget();if(e){var i=e.getValidArr();i.length<=0&&(i=this.getFUList()),this._posx=i[0].worldX,this._posy=i[0].worldY}Laya.timer.once(500,this,this.deplayJoinAttSkillClient,[t])},n.prototype.deplayJoinAttSkillClient=function(t){var e=C.ItemUtils.getSkillVoById(t.comboid);if(e){var i=T.RoleCenter.instans.vo.comboData.comboSkill.indexOf(e.id),n=T.RoleCenter.instans.vo.comboData.comboLvArr[i],s=e.ext.length-1,o=0;if(o=(o=null!=e.ext[n]?e.ext[n]:e.ext[s])||0,1==e.target&&t.invincibleTime<=0&&(t.invincibleTime=10,t.hpAdd=1e3),0<t.invincibleTime)for(var a=this.getNoPetArr(),r=0;r<a.length;r++){var l=a[r].getHp()+t.hpAdd,h=a[r].getTotalHp(),c=a[r];if(!c||!c.isDeath()){h<=l&&(l=h);var u=e.buffArr;if(u)for(var p=0;p<u.length;p++)a[r].set_buf(a[r],u[p],10);a[r].svrSetHP(l);var d=a[r];b.FE.resetHp(t.hpAdd,d.topHpBar.x,d.topHpBar.y+20*r)}}else{if(!this.getFGTarget())return;a=this.getFGTarget().getValidArr();for(var g=[],v=this.getTotalAtt(),f=0;f<a.length;f++){a[f].getHp(),t.hpAfterAttack[f]||(a[f].getTotalHp(),Math.random());t.hpAfterAttack[f]<0&&(t.hpAfterAttack[f]=0);var y=e.target,m=v;m*=5==y?6.5+.05*Math.random():2+.05*Math.random(),m+=o,g.push(m>>0);var _=a[f].getHp();if((_-=m)<0&&(_=0),a[f].svrSetHP(_),a[f].isDeath()&&a[f].startDeadDelayHide(),5==y)break}I.BtnSkiilCtrl.ins.setKillBloddVo(g)}this.playSkillEff(e,this._posx,this._posy),this.hetiHandler(t.comboid)}},n.prototype.getPoxy=function(){var t=this.getFGTarget();if(t){var e=t.getValidArr();e&&0<e.length&&(this._posx=e[0].worldX,this._posy=e[0].worldY)}},n.prototype.playSkillEffById=function(t,e,i){var n=C.ItemUtils.getSkillVoById(t);n&&(this.playSkillEff(n,e,i),this.hetiHandler(t))},n.prototype.playJoinAttSkill=function(t){if(0!=t.comboid){var e=this.getFGTarget();if(e){var i=e.getFUList();i&&0<i.length&&(this._posx=i[0].worldX,this._posy=i[0].worldY)}y.E.ins.event(m.EventName.JOINSKILLSHOW,[t.comboid]),Laya.timer.once(500,this,this.deplayJoinAttSkill,[t])}else console.log("error::"+JSON.stringify(t))},n.prototype.deplayJoinAttSkill=function(t){var e=C.ItemUtils.getSkillVoById(t.comboid);e&&(this.playSillFlyBloodEff(t,e),this.playSkillEff(e),this.hetiHandler(t.comboid))},n.prototype.hetiHandler=function(t){var e=C.ItemUtils.getSkillVoById(t);if(e&&-1!=T.RoleCenter.instans.vo.hetiData.skillArr.indexOf(t)&&(this.relatSkillHandler(e),this.isSelf)){var i=1;22==t?i=1:23==t?i=3:24==t&&(i=2),y.E.ins.event(m.EventName.HETI_EFFECT_SHOW,[i])}},n.prototype.relatSkillHandler=function(t){var e=this.getValidArr()[0];if(e)for(var i,n=t.relatSkill.length,s=0;s<n;)i=new R.ClientSkill(e,t.relatSkill[s],1),e.registClientSkill(i),i.run(),s++},n.prototype.playSillFlyBloodEff=function(t,e){var i=-1;if(5==e.target&&(i=1),1==e.target&&t.invincibleTime<=0&&(t.invincibleTime=10,t.hpAdd=1e3),0<t.invincibleTime)for(var n=this.getNoPetArr(),s=0;s<n.length;s++){var o=n[s].getHp();if(!(o<=0)){var a=o+t.hpAdd,r=n[s].getTotalHp();r<=a&&(a=r);var l=e.buffArr;if(l)for(var h=0;h<l.length;h++)n[s].set_buf(n[s],l[h],10);var c=n[s];b.FE.resetHp(t.hpAdd,c.topHpBar.x,c.topHpBar.y+20*s)}}else{if(!this.getFGTarget())return;for(var u=[],p=(n=this.getFGTarget().getFUList(),0);p<n.length;p++){var d=t.hpChg[p]||1e3;u.push(d)}I.BtnSkiilCtrl.ins.setKillBloddVo(u)}-1!=i&&(u.length=i)},n.prototype.playSkillEff=function(t,e,i){void 0===e&&(e=-1),void 0===i&&(i=-1),p.SoundUtils.getInstance().playSoundById(t.sound);var n=t.target,s="",o=t.sdur1;switch(o&&(s=A.RES.getSdurl(o)),n){case 1:var a=this.getValidArr()[0];if(a)(new d.JoinAttSkillItem).fire(a.worldX,a.worldY,s,!0,t.sdur0Rate);break;case 2:case 3:break;case 5:this.getPoxy(),-1!=e&&(this._posx=e),-1!=i&&(this._posy=i),(new d.JoinAttSkillItem).fire(this._posx,this._posy,s,!0,t.sdurlRate*h.Unit_New.hetiScale);break;case 6:this.getPoxy(),-1!=e&&(this._posx=e),-1!=i&&(this._posy=i),(new d.JoinAttSkillItem).fire(this._posx,this._posy,s,!0,t.sdurlRate*h.Unit_New.hetiScale)}},n.prototype.playJoinSkill=function(t,e){},n.prototype.getLevel=function(){return this.otherData?this.otherData.lvl:this.userData?this.userData.lvl:0},n.prototype.getFamilyUid=function(){return this.otherData?this.otherData.familyUid:this.userData?this.userData.ufData.familyUId:null},n.prototype.getFamilyName=function(){return this.otherData?this.otherData.familyName:this.userData?this.userData.ufData.familyName:null},n.prototype.getChopLv=function(){return this.otherData?this.otherData.chopLv:this.userData?this.userData.chopData.chopLv:0},n.prototype.getNickName=function(){return this.otherData?this.otherData.nickname:this.userData?this.userData.nickname:""},n.prototype.getSex=function(){return this.otherData&&0<this.otherData.openhero.length?this.otherData.openhero[0].sex:this.userData&&0<this.userData.openhero.length?this.userData.openhero[0].sex:E.Sex.male},n.prototype.getJob=function(){return this.otherData&&0<this.otherData.openhero.length?this.otherData.openhero[0].jobid:this.userData&&0<this.userData.openhero.length?this.userData.openhero[0].jobid:0},n.prototype.separateFG=function(t){var e=this.getMainRole(),i=t.getMainRole();if(e&&i){var n=e.mapX-i.mapX,s=e.mapY-i.mapY,o=Math.sqrt(n*n+s*s),a=e.station+i.station+_.MapConst.MAP_TILED_W;if(o<a){var r=Laya.Point.TEMP.setTo(i.mapX-e.mapX,i.mapY-e.mapY);0==r.x&&0==r.y&&(r.x=1),r.normalize();for(var l=a-o,h=t.getCount(),c=0;c<h;c++)n=(i=t.getUnitByIndex(c)).mapX+r.x*l,s=i.mapY+r.y*l,v.GameScene.ins.map.isCrossXY(Math.floor(n/_.MapConst.MAP_TILED_W),Math.floor(s/_.MapConst.MAP_TILED_W))&&i.setMapXY(n,s)}}},n.prototype.limitDraw=function(t,e){if(this._allHideKey=e,this._limitDrawKey!=t&&(this._limitDrawKey=t,!this._forceHideKey))for(var i=0;i<this._fightUnitArr.length;i++)this._fightUnitArr[i].limitDraw(t,this._allHideKey)},n.prototype.forceHide=function(t){if(this._allHideKey=t,!this._forceHideKey){this._forceHideKey=!0;for(var e=0;e<this._fightUnitArr.length;e++)this._fightUnitArr[e].limitDraw(!0,this._allHideKey)}},n.prototype.releaseForceHide=function(){if(this._forceHideKey){this._forceHideKey=!1;for(var t=0;t<this._fightUnitArr.length;t++)this._fightUnitArr[t].limitDraw(this._limitDrawKey,this._allHideKey)}},n.prototype.getIsForceHide=function(){return this._forceHideKey},Object.defineProperty(n.prototype,"isInSafeArea",{get:function(){return this._isInSafeAreaKey},set:function(t){this._isInSafeAreaKey=t},enumerable:!0,configurable:!0}),n.prototype.setCampType=function(t){for(var e=null,i=0;i<this._fightUnitArr.length;i++)(e=this._fightUnitArr[i]).isSummonPet()||e.setCamp(t)},n.prototype.forceLoad=function(){for(var t=null,e=0;e<this._fightUnitArr.length;e++)(t=this._fightUnitArr[e]).playMove(),t.removeWeaponEff()},n.prototype.playEff=function(t){for(var e=0;e<this._fightUnitArr.length;e++)this._fightUnitArr[e].playExtEff(t)},n.ALL_DEATH="fightGroup_all_death",n.HERO_MAXNUM=10,n.UID=0,n}(Laya.EventDispatcher);e.FightGroup=i}),define("src/g/fight/osprite/obj/IFightUnit",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),define("src/g/fight/osprite/obj/BuffObject",["require","exports","../../../../component/GAnimation","../../../../utils/ItemUtils","src/g/fight/base/RES"],function(t,e,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function i(t,e){this.bufid=t;var i=o.ItemUtils.getBuffVoById(t);if(null!=i.buffres&&""!=i.buffres){var n=a.RES.getSdul0(i.buffres,e);this.bufEffect=new s.GAnimation,this.bufEffect.load(n)}else 2==t&&(this.colorFilter=new Laya.ColorFilter([0,0,0,0,0,.4,.2,.4,0,0,0,0,0,0,0,0,0,0,1,0]))}return i.prototype.clear=function(){this.bufEffect.clear(),this.colorFilter=null},i.CreateBuffObj=function(t,e){return new i(t,e)},i}();e.BuffObject=i}),define("src/g/fight/osprite/obj/Unit_New",["require","exports","../../../../component/GAnimation","../../../../config/GameConfig","../../../../utils/ItemUtils","src/g/fight/base/RES","src/g/fight/osprite/GameScene","src/g/fight/osprite/obj/UnitCovert","src/g/fight/osprite/obj/FightUnit","src/g/fight/osprite/obj/BuffObject","src/g/fight/osprite/SceneObjManager","../../../../utils/DropUtil","../../../../manager/LayerManager","../../../../component/SkillAni","../../../../utils/system/FloatEffect","src/g/Effects/UIEffectsFactory","../../../../component/GAnimationManager","src/init/TextConst"],function(t,e,n,i,a,r,p,d,s,l,h,c,u,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(s){function o(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1);var i=s.call(this,t)||this;return i._dropArr=[],i._godEff=null,i.ways=[],i.addies=[],i.prev_TIME=0,i.moveStep=0,i.steps=0,i._buffObjs=[],i.useColorFilterKey=!0,i._extEff=null,i.__isdroppk=!1,i._poxX=[[-60,-60],[60,-60],[-60,60],[60,60],[-80,-60],[80,-80],[-80,80],[80,80]],i._testDebugKey=!1,i.body=new Laya.Sprite,i.forceShow=e,i.coat=new n.GAnimation(e),i.coat.interval=o.ANIMATION_INTERNAL_UNIT,i.body.addChild(i.coat),i.face=0,i.shadow=new Laya.Sprite,i.shadow.graphics.drawTexture(Laya.loader.getRes("res/custom/yingzi.png")),i.shadow.pivot(65,50),i.haloLayer=new Laya.Sprite,i.view.effectLayer.addChild(i.haloLayer),i}return __extends(o,s),Object.defineProperty(o,"ANIMATION_INTERNAL_UNIT",{get:function(){var t=i.GameConfig.gameSetting;return t?t.ANIMATION_INTERNAL:100},enumerable:!0,configurable:!0}),Object.defineProperty(o,"move_SPEED",{get:function(){var t=i.GameConfig.gameSetting;return t?t.move_SPEED:250},enumerable:!0,configurable:!0}),o.prototype.addHaloLayer=function(t){this.haloLayer&&this.haloLayer.addChild(t)},o.prototype.setDropArr=function(t){this._dropArr=t},o.getRandomFace=function(){return Math.floor(8*Math.random())},o.prototype.set_DATA=function(t,e){void 0===e&&(e=!0),s.prototype.set_DATA.call(this,t),this._vanishDeath=!1},o.prototype.pushDrop=function(t,e){var i=this._dropArr.length;this._dropArr[i]=t,this._dropArr[i+1]=e},o.prototype.clearDrop=function(){this._dropArr.length=0},o.prototype.getDropNum=function(){return this._dropArr.length/2},o.prototype.setPos=function(t,e){this.setWorldXY(t,e)},o.prototype.isVanishDeath=function(){return this._vanishDeath},o.prototype.playAnimation=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=null)},o.prototype.set_buf=function(t,e,i){if(s.prototype.set_buf.call(this,t,e,i),!this.has_buf_eff(e)){var n=l.BuffObject.CreateBuffObj(e,this.face);null!=n.bufEffect?(this.body.addChild(n.bufEffect),n.bufEffect.zOrder=10):null!=n.colorFilter&&this.useColorFilterKey&&this.coat&&(this.coat.filters=[n.colorFilter]),this._buffObjs.push(n)}},o.prototype.has_buf_eff=function(t){for(var e=0;e<this._buffObjs.length;e++)if(this._buffObjs[e].bufid==t)return!0;return!1},o.prototype.reset_filters=function(){if(this.useColorFilterKey){for(var t=this._buffObjs.length-1;0<=t;t--)if(null!=this._buffObjs[t].colorFilter)return void(this.coat&&(this.coat.filters=[this._buffObjs[t].colorFilter]));this.coat&&(this.coat.filters=[])}},o.prototype.rmv_buf=function(t){for(var e=!1,i=this._buffObjs.length-1;0<=i;i--)this._buffObjs[i].bufid==t&&(null!=this._buffObjs[i].bufEffect?(this.body.removeChild(this._buffObjs[i].bufEffect),this._buffObjs[i].clear()):null!=this._buffObjs[i].colorFilter&&(e=!0),this._buffObjs.splice(i,1));e&&this.reset_filters()},o.prototype.rmv_all_buf=function(){for(var t=this._buffObjs,e=t.length-1;0<=e;e--){var i=t[e];null!=i.bufEffect&&(this.body&&this.body.removeChild(i.bufEffect),i.clear()),t.splice(e,1)}this.reset_filters()},o.prototype.clearBuf=function(){this.sk_Manager.clear_buff()},o.prototype.beHit=function(t,e){if(void 0===e&&(e=!1),this.body){var i=t.sdur1;if(i){var n=r.RES.getSdurl(i,this.face);g.SkillAni.createSkillAni().fire(this.worldX,this.worldY,n,t.sdurlRate*o.hetiScale)}if(this.__isdroppk){var s=this._poxX.shift();s&&c.DropUtil.creatDropMapXY("COMBATGAINS",new Laya.Point(this.mapX,this.mapY),this.mapX+s[0],this.mapY+s[1])}}},Object.defineProperty(o.prototype,"pkGold",{set:function(t){this.__isdroppk=t},enumerable:!0,configurable:!0}),o.prototype.moveTo=function(t){this.prev_TIME=0,this.moveToMapPoint(t.getMapPos()[0],t.getMapPos()[1])},o.prototype.moveToMapPoint=function(t,e){t!=this.mapX||e!=this.mapY?(this.ways=p.GameScene.ins.map.doSearch(this.mapX,this.mapY,t,e),this.playMove()):this.onMoveEnd()},Object.defineProperty(o.prototype,"move_speed",{get:function(){return o.move_SPEED},enumerable:!0,configurable:!0}),o.prototype.move=function(t,e){if(this.body&&this.body.visible&&!this.isInChoas&&!this.isInStun&&2==this.action&&this.isCanMove){var i=this.getMapPos(),n=i[0],s=i[1],o=this.ways[0].x,a=this.ways[0].y,r=this.move_speed*e/1e3,l=Math.sqrt(Math.pow(n-o,2)+Math.pow(s-a,2)),h=Math.atan2(a-s,o-n);this.face=d.UnitCovert.radiansToFace(h);var c=Math.sin(h),u=Math.cos(h);l<=r?(this.setMapXY(o,a),this.ways.shift(),this.ways.length||(this.stand(),this.onMoveEnd())):(this.setMapXY(r*u+n,r*c+s),this.playMove()),p.GameScene.ins.map.isTranslucent([this.worldX,this.worldY])?this.body.alpha=.5:this.body.alpha=1}},o.prototype.onMoveEnd=function(){},o.prototype.moveStop=function(){this.canMove=!1,this.ways.length=0,this.stand()},o.prototype.updateUnitZorder=function(){this.destoryed||(this.body.zOrder=this.mapY)},o.prototype.setUnitVis=function(t){this.body&&(this.body.visible=t,this.shadow.visible=t,this.haloLayer.visible=t,this.topHpBar&&(this.topHpBar.visible=t))},o.prototype.deadHandler=function(){this.shadow&&(this.shadow.visible=!1),this.haloLayer&&(this.haloLayer.visible=!1),this.body&&(this.body.visible=!1),this.topHpBar&&(this.topHpBar.visible=!1)},o.prototype.deathHide=function(){if(s.prototype.deathHide.call(this),8!=this.action){this.status=0,this.stand();var t=p.GameScene.ins.map.id;this.getHp()<=0&&(this.clearTalk(),this.coat.isLoop=!1,p.GameScene.ins.map.isSameMap(t)&&c.DropUtil.createDrop(this._dropArr,new Laya.Point(this.worldX,this.worldY)),this._dropArr.length=0,this._vanishDeath=!0,this.playDeath(),this.deadHandler())}},o.prototype.resetUnit=function(t,e){this._vanishDeath=!1,s.prototype.resetUnit.call(this,t,e)},o.prototype.frameMove=function(t,e){if(!this.destoryed){this.isDeath()?this.delayHideKey?(this.currDelayHideTime+=e,this.currDelayHideTime>=this.maxDelayHideTime&&(this.delayHideKey=!1)):(this.isUpdateHpBar()&&s.prototype.frameMove.call(this,t,e),0!=this.getShowHp()||this._vanishDeath||this.deathHide()):s.prototype.frameMove.call(this,t,e);var i=this.body;this.updatePoint(),this.updateUnitZorder(),i.scaleX=this.scaleX*this.scaleRate,i.scaleY=this.scaleRate,i.pos(this.gridX,this.gridY),this.topHpBar&&(this.topHpBar.x=this.shadow.x=this.haloLayer.x=i.x,this.topHpBar.y=this.shadow.y=this.haloLayer.y=i.y),this._bubble&&(this._bubble.x=i.x-40,this._bubble.y=i.y-140),this.talkTip&&(this.talkTip.x=i.x-200,this.talkTip.y=i.y-250),this.beFocus&&(this.beFocus.x=this.shadow.x,this.beFocus.y=this.shadow.y),0<this.ways.length&&this.move(t,e)}},o.prototype.addToFightLayer=function(){u.LayerManager.fightLayer.addUnit(this)},o.prototype.removeFromFightLayer=function(){u.LayerManager.fightLayer.removeUnit(this)},o.prototype.show=function(t){this.body.visible=t,this.shadow.visible=t,this.haloLayer.visible=t,this.topHpBar&&(this.topHpBar.body.visible=t)},o.prototype.destroyUnit=function(){this.coat&&this.coat.clear(),this.weaponEff&&this.weaponEff.clear(),this.lvlupEff&&this.lvlupEff.clear(),Laya.timer.clearAll(this),s.prototype.destroyUnit.call(this),this.body&&(this.body.destroy(!1),this.body=null,this.coat=null,this.weaponEff=null),this.shadow&&(this.shadow.destroy(!0),this.shadow=null),this.haloLayer&&(this.haloLayer.destroy(!0),this.haloLayer=null),this.topHpBar&&(this.topHpBar.destroy(!0),this.topHpBar=null),this.ways.length=0,s.prototype.destory.call(this),h.SceneObjManager.instans.delUnitN(this)},o.prototype.drawDebugCircle=function(){this._testDebugKey&&(this.body.graphics.setAlpha(.25),this.body.graphics.drawCircle(0,0,this.attackDis,"#FF0000"),this.body.graphics.drawCircle(0,0,this.station,"#00FF00"),this.body.graphics.setAlpha(1))},o.prototype.showDebug=function(){this._testDebugKey||(this._testDebugKey=!0,this.drawDebugCircle())},o.prototype.triggerPassive=function(t){s.prototype.triggerPassive.call(this,t);var e=null,i=a.ItemUtils.getPassiveVoById(t);if(i){var n=null;switch(i.quality){case 5:e=m.TextConst.passiveDic,n=m.TextConst.passiveBg;break;case 6:e=m.TextConst.realPassiveDic,n=m.TextConst.realPassiveBg}if(i&&e)switch(i.type){case 1:case 4:case 5:case 6:case 7:v.FE.passiveFloat2(e[i.type],n,this.face,i.name,this.body)}}},o.prototype.triggerShenYu=function(t){var e=m.TextConst.shenyuSrcDic;t.cs_trigger&&v.FE.shenyuFloat(e[1],this.face,this.body),t.lx_trigger&&v.FE.shenyuFloat(e[3],this.face,this.body),t.yh_trigger&&v.FE.shenyuFloat(e[2],this.face,this.body),t.ch_trigger&&v.FE.shenyuFloat(e[4],this.face,this.body)},o.prototype.showReLife=function(){s.prototype.showReLife.call(this),this._godEff||(this._godEff=y.GAnimationManager.getInstance().create()),f.UIEffectsFactory.Ins.playAnim(15,this._godEff),this.body.addChild(this._godEff)},o.prototype.limitDraw=function(t,e){s.prototype.limitDraw.call(this,t,e),this.coat&&this.coat.limitDraw(t),e&&(this.shadow&&(this.shadow.visible=!t),this.haloLayer&&(this.haloLayer.visible=!t))},o.prototype.playExtEff=function(t){this._extEff&&this._extEff.setPlayComplete(),this._extEff=y.GAnimationManager.getInstance().create(),this._extEff.isRecovery=!1,this._extEff.play(),this._extEff.y=-120,this._extEff.interval=120,this.body.addChild(this._extEff),this._extEff.load(t),r.RES.setResUrl(t)},o.prototype.setCamp=function(t){},o.hetiScale=1,o.LastFrame_DT=Date.now(),o.SKILLPLAY_DELAY=100,o.MOVESTAND_TIME=120,o.DEATHHIDE_DELAY=300,o}(s.FightUnit);e.Unit_New=o}),define("src/g/fight/base/FightLayer",["require","exports","../../../manager/RoleCenter","src/g/fight/osprite/SceneObjManager"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.autoSearchTip=new Laya.Animation,t._itemLayer=new Laya.Sprite,t._bgLayer=new Laya.Sprite,t.danger=new Laya.Sprite,t._shadowLayer=new Laya.Sprite,t._dropLayer=new Laya.Sprite,t._roleLayer=new Laya.Sprite,t._nameLayer=new Laya.Sprite,t._hpLayer=new Laya.Sprite,t._weaponLayer=new Laya.Sprite,t._effectLayer=new Laya.Sprite,t._skilleffectLayer=new Laya.Sprite,t._popLayer=new Laya.Sprite,t._units=[],t._items=[],t.init(),t}return __extends(t,e),t.prototype.init=function(){this.addChild(this._bgLayer),this.addChild(this._itemLayer),this._itemLayer.width=this._itemLayer.height=Laya.stage.height,this._itemLayer.mouseThrough=!0,this.addChild(this._shadowLayer),this.addChild(this._effectLayer),this.addChild(this._dropLayer),this.addChild(this._roleLayer),this.addChild(this._weaponLayer),this.addChild(this._skilleffectLayer),this.addChild(this._hpLayer),this.addChild(this._nameLayer),this.addChild(this.autoSearchTip),this.addChild(this._popLayer),this.autoSearchTip.visible=!1,this.autoSearchTip.pos((Laya.stage.width-206)/2,Laya.stage.height/2-200),console.log("战斗层级构建完成")},t.prototype.showAutoSearch=function(t){if(i.RoleCenter.instans.self){var e=this.autoSearchTip;t&&e.loadAtlas("dynamic2/uieffect/EUI1_14.json"),(e.visible=t)?e.play():e.stop()}},Object.defineProperty(t.prototype,"bgLayer",{get:function(){return this._bgLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"popLayer",{get:function(){return this._popLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skilleffectLayer",{get:function(){return this._skilleffectLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nameLayer",{get:function(){return this._nameLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hpLayer",{get:function(){return this._hpLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadowLayer",{get:function(){return this._shadowLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dropLayer",{get:function(){return this._dropLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"roleLayer",{get:function(){return this._roleLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weaponLayer",{get:function(){return this._weaponLayer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effectLayer",{get:function(){return this._effectLayer},enumerable:!0,configurable:!0}),t.prototype.addUnit=function(t){if(t&&!(-1<this._units.indexOf(t))){this._units.push(t);var e=t.topHpBar;e&&this._hpLayer.addChild(e.body),this._roleLayer.addChild(t.body),this._shadowLayer.addChild(t.shadow),n.SceneObjManager.instans.addUnitN(t)}},t.prototype.addItem=function(t){this._items.push(t),this._itemLayer.addChild(t.disp)},t.prototype.removeItem=function(t){var e=this._items.indexOf(t);-1<e&&(this._items.splice(e,1),this._itemLayer.removeChild(t.disp))},t.prototype.removeAllItem=function(){for(var t=0;t<this._items.length;t++){this._items[t].destory(),t--}this._items.length=0},t.prototype.removeUnit=function(t){if(t){var e=this._units.indexOf(t);e<0||(this._units.splice(e,1),t.topHpBar&&this._hpLayer.removeChild(t.topHpBar.body),this._roleLayer.removeChild(t.body),this._shadowLayer.removeChild(t.shadow),n.SceneObjManager.instans.delUnitN(t))}},t.prototype.removeAllUnit=function(){for(var t=this._units.length-1;-1<t;t--){var e=this._units[t];this.removeUnit(e)}},t.prototype.updateItem=function(){for(var t=this._items,e=t.length,i=0;i<e;i++){t[i].frameMove(10)}},t}(Laya.Sprite);e.FightLayer=s}),define("src/g/fight/osprite/obj/BaseSprite",["require","exports","src/g/fight/osprite/map/MapConst","../../../../manager/LayerManager","src/g/fight/osprite/map/MainCamera","../../../../utils/ItemUtils"],function(t,e,n,s,o,a){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.ESPRITE_FACE||(e.ESPRITE_FACE={}))[i.top=0]="top",i[i.topright=1]="topright",i[i.right=2]="right",i[i.bottomright=3]="bottomright",i[i.bottom=4]="bottom",i[i.bottomleft=5]="bottomleft",i[i.left=6]="left",i[i.topleft=7]="topleft";var r=function(e){function i(){var t=e.call(this)||this;return t.guid=i.GUID_START++,t.actorName="",t.nameHeight=100,t.canSelect=!1,t.isInStage=!1,t.scaleX=1,t.gridX=0,t.gridY=0,t.visible=!0,t.zOrder=0,t.teamId=0,t.data=null,t.findNode=[],t.job=1,t.lock=!1,t.waveIndex=0,t.destoryed=!1,t.bSelfUnit=!1,t._sex=0,t.unit_uid=a.ItemUtils.ID,t}return __extends(i,e),Object.defineProperty(i.prototype,"mapX",{get:function(){return this._mapX},set:function(t){this._mapX=t,this._worldX=Math.floor(this._mapX/n.MapConst.MAP_TILED_W)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"mapY",{get:function(){return this._mapY},set:function(t){this._mapY=t,this._worldY=Math.floor(this._mapY/n.MapConst.MAP_TILED_W)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"worldX",{get:function(){return this._worldX},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"worldY",{get:function(){return this._worldY},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sex",{get:function(){return this._sex},set:function(t){this._sex=t},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"action",{get:function(){return this._action},set:function(t){this._action=t},enumerable:!0,configurable:!0}),i.prototype.setWorldXY=function(t,e){this._worldX=t,this._worldY=e,this._mapX=t*n.MapConst.MAP_TILED_W+n.MapConst.MAP_TILED_W/2,this._mapY=e*n.MapConst.MAP_TILED_W+n.MapConst.MAP_TILED_W/2},i.prototype.setMapXY=function(t,e){this._mapX=t,this._mapY=e,this._worldX=Math.floor(this._mapX/n.MapConst.MAP_TILED_W),this._worldY=Math.floor(this._mapY/n.MapConst.MAP_TILED_W)},i.prototype.init=function(t){void 0===t&&(t=null)},i.prototype.draw=function(){this.updatePoint(),this.checkShow(),this.checkScale()},i.prototype.checkShow=function(){this.isInStage?this.visible=!0:this.visible=!1},i.prototype.updatePoint=function(){this.gridX=this.mapX-this.camera.x,this.gridY=this.mapY-this.camera.y,this.checkInStage(),this.checkScale()},i.prototype.checkScale=function(){4<this.face?this.scaleX=-1:this.scaleX=1},i.prototype.checkInStage=function(){this.isInStage=this.camera.contains(this.worldX*n.MapConst.MAP_TILED_W,this.worldY*n.MapConst.MAP_TILED_W)},i.prototype.addiexPoint=function(){var t=n.MapConst.MAP_TILED_W;this._mapX=this.worldX*t+t/2,this._mapY=this.worldY*t+t/2},Object.defineProperty(i.prototype,"isInPoint",{get:function(){return this.worldX%1<=1e-4&&this.worldY%1<=1e-4},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"camera",{get:function(){return o.MainCamera.ins.camera},enumerable:!0,configurable:!0}),i.prototype.setUnitVis=function(t){},i.prototype.destory=function(){this.unit_uid=null,this.avatarId=null,this.actorType=null,this.actorName=null,this.sex=0,this.nameHeight=null,this.canSelect=null,this.isInStage=null,this.scaleX=null,this.face=null,this._worldX=null,this._worldY=null,this.gridX=null,this.gridY=null,this.action=8,this.visible=!1,this.zOrder=null,this.destoryed=!0},Object.defineProperty(i.prototype,"view",{get:function(){return s.LayerManager.fightLayer},enumerable:!0,configurable:!0}),i.GUID_START=1e3,i}(Laya.EventDispatcher);e.BaseSprite=r}),define("src/g/fight/osprite/buff/basic/StepBuff",["require","exports","src/g/fight/osprite/buff/basic/BaseBuff"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.reset=function(){t.prototype.reset.call(this),this._step=this.data.step,this._interval=this.data.cd/this.data.step*1e3,this._effectTime=Date.now()+this._interval},e.prototype.onUpdate=function(t){return null},e.prototype.canExecute=function(t){return!(this._step<=0)&&(t>this._effectTime&&(this._effectTime=this._effectTime+this._interval,this._step--,!0))},e.prototype.getEffectValue=function(){return 0},e}(i.BaseBuff);e.StepBuff=n}),define("src/g/fight/osprite/buff/DrugBuff",["require","exports","src/g/fight/osprite/buff/basic/StepBuff","../../../../manager/RoleCenter","../../../net/messages/UserAttackMsg"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(i){function t(){return null!==i&&i.apply(this,arguments)||this}return __extends(t,i),t.prototype.reset=function(){i.prototype.reset.call(this);var t=this.data.rate;this.buffRate=t[Math.min(this.level-1,t.length-1)]/100;var e=this.data.ext;this.bufExt=e[Math.min(this.level-1,e.length-1)]},t.prototype.onUpdate=function(t){return this.canExecute(t)&&!n.RoleCenter.instans.self.newbee&&this.target&&(this.target.setPoisonBlood(!0),this.target.chg_HP(-this.getEffectValue(),this.user,s.ESkillRes.NULL,s.ESkillRes.NULL),this.target.setPoisonBlood(!1)),0<this._step},t.prototype.getEffectValue=function(){return~~(this.user.get_ATT()*this.buffRate+this.bufExt)},t}(i.StepBuff);e.DrugBuff=o}),define("src/g/fight/osprite/buff/MagicShield",["require","exports","src/g/fight/osprite/buff/basic/DurationBuff"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.reset=function(){t.prototype.reset.call(this),this.ROA=this.getEffectValue(),this.addEffect()},e.prototype.getEffectValue=function(){var t=this.data.rate;return t[Math.min(this.level-1,t.length-1)]/100},e.prototype.addEffect=function(){this.target&&(this.target.buf_ROA=this.ROA)},e.prototype.removeEffect=function(){this.target&&(this.target.buf_ROA=0)},e}(i.DurationBuff);e.MagicShield=n}),define("src/g/fight/osprite/buff/GhostArmor",["require","exports","src/g/fight/osprite/buff/basic/DurationBuff"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(s){function t(){return null!==s&&s.apply(this,arguments)||this}return __extends(t,s),Object.defineProperty(t.prototype,"added",{get:function(){return this._added},set:function(t){this._added=t},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.removeEffect(),s.prototype.reset.call(this);var t=this.data.ext,e=Math.min(this.level-1,t.length-1),i=t[e]/1e4,n=this.data.prop[e];this.PDEF=~~(this.user.get_PDEF()*i)+n.PDEF,this.SDEF=~~(this.user.get_SDEF()*i)+n.SDEF,this.addEffect()},t.prototype.onUpdate=function(t){return s.prototype.onUpdate.call(this,t)},t.prototype.addEffect=function(){this.added||(this.added=!0,this.target&&(this.target.buf_SDEF=this.SDEF,this.target.buf_PDEF=this.PDEF))},t.prototype.removeEffect=function(){this.added&&(this.added=!1,this.target&&(this.target.buf_SDEF=0,this.target.buf_PDEF=0))},t}(i.DurationBuff);e.GhostArmor=n}),define("src/g/fight/osprite/buff/StunBuff",["require","exports","src/g/fight/osprite/buff/basic/DurationBuff"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(s){function t(t,e,i,n){return s.call(this,t,e,i,n)||this}return __extends(t,s),t.prototype.reset=function(){s.prototype.reset.call(this),this.addEffect()},t.prototype.addEffect=function(){this.target&&(this.target.isInStun=!0)},t.prototype.onUpdate=function(t){return s.prototype.onUpdate.call(this,t)},t.prototype.removeEffect=function(){this.target&&(this.target.isInStun=!1)},t.BUFF_ID=1,t}(i.DurationBuff);e.StunBuff=n}),define("src/g/fight/osprite/buff/AttSpeedUpBuff",["require","exports","src/g/fight/osprite/buff/basic/DurationBuff"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.coef=-1,t._isVaild=!1,t}return __extends(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),Laya.timer.frameOnce(2,this,this.addEffect)},t.prototype.getEffectValue=function(){if(-1==this.coef||null==this.coef){this.data.rate;this.coef=.66}return this.coef},t.prototype.addEffect=function(){!this._isVaild&&this.target&&(this.target.attackSpeedUpCoef-=this.getEffectValue(),this._isVaild=!0)},t.prototype.removeEffect=function(){this._isVaild&&this.target&&(this.target.attackSpeedUpCoef+=this.getEffectValue(),this._isVaild=!1)},t}(i.DurationBuff);e.ATTSpeedUpBuff=n}),define("src/g/fight/osprite/buff/MergeBuff",["require","exports","src/g/fight/osprite/buff/basic/DurationBuff","../../../../meta/SkillVo"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isVaild=!1,t}return __extends(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),Laya.timer.frameOnce(2,this,this.addEffect)},t.prototype.addEffect=function(){!this._isVaild&&this.target&&(this.target.setHeTi(!0),this._isVaild=!0)},t.prototype.removeEffect=function(){if(this._isVaild&&this.target){if(this.data.stopEff&&!this.target.isDeath()){var t=new n.SkillVo;t.sdur0Rate=2,this.target.playWeaponEffect(this.data.stopEff,t)}this.target.setHeTi(!1),this._isVaild=!1}},t}(i.DurationBuff);e.MergeBuff=s}),define("src/g/fight/osprite/buff/ChangeAvatarBuff",["require","exports","src/g/fight/osprite/buff/basic/DurationBuff"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=-1,t._isVaild=!1,t}return __extends(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),Laya.timer.frameOnce(2,this,this.addEffect)},t.prototype.getEffectValue=function(){if(-1==this.value||null==this.value){var t=this.data.rate;this.value=t[Math.min(this.level-1,t.length-1)]}return this.value},t.prototype.addEffect=function(){this._isVaild||!this.target||this.target.isDeath()||(this.target.changedAvatarId=this.getEffectValue(),this.target.resetEquipData(),this._isVaild=!0)},t.prototype.removeEffect=function(){this._isVaild&&this.target&&(this.target.changedAvatarId=0,this.target.resetEquipData(),this._isVaild=!1)},t}(i.DurationBuff);e.ChangeAvatarBuff=n}),define("src/g/fight/osprite/buff/HideBuff",["require","exports","src/g/fight/osprite/buff/basic/DurationBuff","../../../../meta/SkillVo"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isVaild=!1,t}return __extends(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),Laya.timer.frameOnce(2,this,this.addEffect)},t.prototype.addEffect=function(){!this._isVaild&&this.target&&(this.target.setUnitVis(!1),this._isVaild=!0)},t.prototype.removeEffect=function(){if(this._isVaild&&this.target){if(!this.target.isDeath()&&(this.target.setUnitVis(!0),this.data.stopEff)){var t=new n.SkillVo;t.sdur0Rate=2,this.target.playWeaponEffect(this.data.stopEff,t)}this._isVaild=!1}},t}(i.DurationBuff);e.HideBuff=s}),define("src/g/fight/osprite/buff/ChangeWeaponBuff",["require","exports","src/g/fight/osprite/buff/basic/DurationBuff"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=-1,t._isVaild=!1,t}return __extends(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),Laya.timer.frameOnce(2,this,this.addEffect)},t.prototype.getEffectValue=function(){if(-1==this.value||null==this.value){var t=this.data.rate;this.value=t[Math.min(this.level-1,t.length-1)]}return this.value},t.prototype.addEffect=function(){this._isVaild||!this.target||this.target.isDeath()||(this.target.changedWeaponId=this.getEffectValue(),this.target.resetEquipData(),this._isVaild=!0)},t.prototype.removeEffect=function(){this._isVaild&&this.target&&(this.target.changedWeaponId=0,this.target.resetEquipData(),this._isVaild=!1)},t}(i.DurationBuff);e.ChangeWeaponBuff=n}),define("src/g/fight/osprite/buff/WuShiBuff",["require","exports","src/g/fight/osprite/buff/basic/DurationBuff"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isVaild=!1,t}return __extends(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),Laya.timer.frameOnce(2,this,this.addEffect)},t.prototype.addEffect=function(){!this._isVaild&&this.target&&(this.target.isWuShi=!0,this._isVaild=!0)},t.prototype.removeEffect=function(){this._isVaild&&this.target&&(this.target.isWuShi=!1,this._isVaild=!1)},t}(i.DurationBuff);e.WuShiBuff=n}),define("src/g/fight/osprite/buff/ShanBiBuff",["require","exports","src/g/fight/osprite/buff/basic/DurationBuff"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isVaild=!1,t}return __extends(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),Laya.timer.frameOnce(2,this,this.addEffect)},t.prototype.addEffect=function(){!this._isVaild&&this.target&&(this.target.isShanBi=!0,this._isVaild=!0)},t.prototype.removeEffect=function(){this._isVaild&&this.target&&(this.target.isShanBi=!1,this._isVaild=!1)},t}(i.DurationBuff);e.ShanBiBuff=n}),define("src/g/fight/osprite/buff/HaloBuff",["require","exports","src/g/fight/osprite/buff/basic/DurationBuff","src/g/fight/base/RES","../../../../component/GAnimation"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isVaild=!1,t}return __extends(t,e),t.prototype.reset=function(){e.prototype.reset.call(this),Laya.timer.frameOnce(2,this,this.addEffect)},t.prototype.addEffect=function(){if(!this._isVaild&&this.target){var t="dynamic2/uieffect/"+this.data.stopEff+".json";this.beFocus||(this.beFocus=new s.GAnimation,n.RES.setResUrl(t),this.beFocus.load(t,!0)),this.beFocus.zOrder=0,this.target.addHaloLayer(this.beFocus),this._isVaild=!0}},t.prototype.removeEffect=function(){this._isVaild&&this.target&&(this.beFocus&&(this.beFocus.removeSelf(),this.beFocus=null),this._isVaild=!1)},t}(i.DurationBuff);e.HaloBuff=o}),define("src/g/fight/osprite/buff/BuffConstants",["require","exports","src/g/fight/osprite/buff/basic/BaseBuff","../../../../utils/ItemUtils","src/g/fight/osprite/buff/DrugBuff","src/g/fight/osprite/buff/MagicShield","src/g/fight/osprite/buff/GhostArmor","src/g/fight/osprite/buff/ChoasBuff","src/g/fight/osprite/buff/StunBuff","src/g/fight/osprite/buff/AttSpeedUpBuff","src/g/fight/osprite/buff/HugeBuff","src/g/fight/osprite/buff/MergeBuff","src/g/fight/osprite/buff/ChangeAvatarBuff","src/g/fight/osprite/buff/HideBuff","src/g/fight/osprite/buff/ChangeWeaponBuff","src/g/fight/osprite/buff/WuShiBuff","src/g/fight/osprite/buff/ShanBiBuff","src/g/fight/osprite/buff/HaloBuff"],function(t,e,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function a(){}return a.createBuff=function(t,e,i,n){var s,o=l.ItemUtils.getBuffVoById(i);if(o){switch(o.type){case a.TYPE_STUN:s=new d.StunBuff(t,e,i,n);break;case a.TYPE_HURT:s=new h.DrugBuff(t,e,i,n);break;case a.TYPE_CURE:s=new r.BaseBuff(t,e,i,n);break;case a.TYPE_DEFENCE:s=new c.MagicShield(t,e,i,n);break;case a.TYPE_CHAOS:s=new p.ChoasBuff(t,e,i,n);break;case a.TYPE_PROP:s=new u.GhostArmor(t,e,i,n);break;case a.TYPE_ATT_SPEED_UP:s=new g.ATTSpeedUpBuff(t,e,i,n);break;case a.TYPE_HUGE:s=new v.HugeBuff(t,e,i,n);break;case a.TYPE_MERGE:s=new f.MergeBuff(t,e,i,n);break;case a.TYPE_CHANGE_AVATAR:s=new y.ChangeAvatarBuff(t,e,i,n);break;case a.TYPE_HIDE:s=new m.HideBuff(t,e,i,n);break;case a.TYPE_CHANGE_WEAPON:s=new _.ChangeWeaponBuff(t,e,i,n);break;case a.TYPE_WUSHI:s=new C.WuShiBuff(t,e,i,n);break;case a.TYPE_SHANBI:s=new I.ShanBiBuff(t,e,i,n);break;case a.TYPE_GUANGHUAN:s=new b.HaloBuff(t,e,i,n);break;default:s=new r.BaseBuff(t,e,i,n)}return s}console.log(i)},a.TYPE_STUN="STUN",a.TYPE_HURT="HURT",a.TYPE_CURE="CURE",a.TYPE_DEFENCE="DEFENCE",a.TYPE_CHAOS="CHAOS",a.TYPE_PROP="PROP",a.TYPE_ATT_SPEED_UP="ATTSPEEDBuff",a.TYPE_HUGE="HUGE",a.TYPE_MERGE="MERGE",a.TYPE_CHANGE_AVATAR="CHANGEAVATAR",a.TYPE_WUDI="WUDI",a.TYPE_HIDE="HIDE",a.TYPE_CHANGE_WEAPON="CHANGEWEAPON",a.TYPE_WUSHI="WUSHI",a.TYPE_SHANBI="SHANBI",a.TYPE_GUANGHUAN="GUANGHUAN",a.TYPE_JIAXUE="JIAXUE",a.TYPE_PETRIFY="PETRIFY",a}();e.BuffConstants=i}),define("src/g/fight/osprite/obj/UnitSkillManager",["require","exports","src/g/fight/osprite/skill/SkillConstants","src/g/fight/osprite/buff/BuffConstants"],function(t,e,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this._attackInterval=0,this._attackTime=0,this._holdBy=t,this._skills=[],this._replaceSkills=[],this._buffs=[],this._randomStart=Date.now(),this._attackTime=this._randomStart+this._attackInterval}return t.prototype.clear=function(){if(this._holdBy=null,this._skills){for(var t=0;t<this._skills.length;t++)this._skills[t].clear();this._skills.length=0}if(this._buffs){for(t=0;t<this._buffs.length;t++)this._buffs[t].clear();this._buffs.length=0}},t.prototype.setRandomStart=function(t){this._randomStart=t},t.prototype.add_buff=function(t,e,i){var n=this.get_buff(e);if(n)n.reset(),n.level=i;else{var s=o.BuffConstants.createBuff(this._holdBy,t,e,i);s&&this._buffs.push(s)}},t.prototype.get_buff=function(t){var e=0,i=this._buffs.length;for(e=0;e<i;e++)if(this._buffs[e].id==t)return this._buffs[e];return null},t.prototype.getBuffByType=function(t){var e=0,i=this._buffs.length;for(e=0;e<i;e++)if(this._buffs[e].data.type==t)return this._buffs[e];return null},t.prototype.remove_buff=function(t){for(var e=this._buffs.length-1;0<=e;e--)this._buffs[e].id==t&&this._buffs.splice(e,1)},t.prototype.clear_buff=function(){for(var t=this._buffs.length-1;0<=t;t--)this._buffs[t].removeEffect();this._buffs.length=0,this._holdBy.rmv_all_buf()},t.prototype.register_skill=function(t,e){void 0===e&&(e=null);for(var i=0;i<t.length;i++)this.add_skill(t[i],e?e[i]:1)},t.prototype.getSkillId=function(t){return this._skills[t]?this._skills[t].data.id:-1},t.prototype.add_skill=function(t,e){var i=this.has_skill(t);null==i?this._skills.push(s.SkillConstants.createSkill(this._holdBy,t,e)):i.level=e},t.prototype.replaceSkill=function(t,e){var i=this.has_skill(t);if(i){var n=this._skills.indexOf(i);-1<n&&(this._replaceSkills[n]=this._skills[n],this._skills[n]=s.SkillConstants.createSkill(this._holdBy,e,i.level))}else console.error("找来到要替换的技能:srcId"+t+" destId:"+e)},t.prototype.clearReplaceSkill=function(){for(var t=0;t<this._replaceSkills.length;t++)this._replaceSkills[t]&&(this._skills[t]=this._replaceSkills[t],this._replaceSkills[t]=null)},t.prototype.has_skill=function(t){for(var e=0;e<this._skills.length;e++)if(this._skills[e].data.id==t)return this._skills[e];return null},t.prototype.calSkillHurtEff=function(t){this._skills[t]&&this._skills[t].playHurtEffByIndex()},t.prototype.calSkillHurt=function(t){this._skills[t]&&this._skills[t].calSkillHurt()},t.prototype.updateBuff=function(t){for(var e=this._buffs.length-1;-1<e;e--){var i=this._buffs[e];i.onUpdate(t)||(this._holdBy.rmv_buf(i.id),this._buffs.splice(e,1))}},t.prototype.checkIsPlaySkill=function(t){if(this._holdBy.isInChoas||this._holdBy.isInStun)return-1;if(t<this._randomStart)return-1;if(1!=this._holdBy.status||3!=this._holdBy.get_ACTION())return-1;for(var e=this._skills.length-1;0<=e;e--){var i=this._skills[e];if((12!=i.data.id||6!=this._holdBy.actorType)&&i.excute(t))return e}return-1},t.prototype.playSkillByIndex=function(t,e){-1<e&&e<this._skills.length&&this._skills[e].fireSkill(t,e)},t.prototype.getIndexById=function(t){for(var e=0;e<this._skills.length;e++)if(this._skills[e].data.id==t)return e;return-1},t.prototype.playSkillEff=function(t,e){for(var i=null,n=0;n<this._skills.length;n++)(i=this._skills[n]).data.id==t&&(i.fireSkill(0,t),i.playHurtEff(e))},t.MIN_CDTIME=800,t}();e.UnitSkillManager=i}),define("src/init/StateElement",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){this.enter=null,this.update=null,this.exit=null};e.StateElement=i}),define("src/init/StateMachine",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._currState=null}return t.prototype.setState=function(t){this._currState!=t&&(this._currState&&this._currState.exit&&this._currState.exit.run(),this._currState=t,this._currState&&this._currState.enter&&this._currState.enter.run())},t.prototype.update=function(t){this._currState&&this._currState.update&&this._currState.update.runWith(t)},t}();e.StateMachine=i}),define("src/g/fight/osprite/obj/BattleStateController",["require","exports","../../../../enum/EventName","../../../../utils/DropUtil","../../../../core/E","../../../../manager/RoleCenter","src/init/StateElement","src/init/StateMachine","src/g/fight/osprite/map/MapConst"],function(t,e,n,s,o,a,i,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._prev_POS=[],t._PICKUP_INTERVAL=120,t._pickup_TIME=0,t._pickTimeStart=0,t.stateLazy=null,t.stateFight=null,t.statePickUpItem=null,t.stateNpcTarget=null,t.stateMove=null,t._battleMachine=new c,t._picktime=0,t}return __extends(t,e),t.prototype.init=function(t){this._holdBy=t,this.stateLazy=new i.StateElement,this.stateLazy.enter=new Laya.Handler(this,this.lazyEnter),this.stateLazy.update=new Laya.Handler(this,this.lazyUpdate),this.stateLazy.exit=new Laya.Handler(this,this.lazyExit),this.statePickUpItem=new i.StateElement,this.statePickUpItem.update=new Laya.Handler(this,this.doPickUpItem),this.stateFight=new i.StateElement,this.stateFight.enter=new Laya.Handler(this,this.enterFightState),this.stateFight.update=new Laya.Handler(this,this.updateFightState),this.stateFight.exit=new Laya.Handler(this,this.exitFightState),this._battleMachine.findTargetState=new i.StateElement,this._battleMachine.findTargetState.enter=new Laya.Handler(this,this.findTargetEnter),this._battleMachine.findTargetState.update=new Laya.Handler(this,this.findTargetUpdate),this._battleMachine.findTargetState.exit=new Laya.Handler(this,this.finidTargetExit),this._battleMachine.moveTargetState=new i.StateElement,this._battleMachine.moveTargetState.enter=new Laya.Handler(this,this.moveTargetEnter),this._battleMachine.moveTargetState.update=new Laya.Handler(this,this.moveTargetUpdate),this._battleMachine.moveTargetState.exit=new Laya.Handler(this,this.moveTargetExit),this._battleMachine.fightTargetState=new i.StateElement,this._battleMachine.fightTargetState.enter=new Laya.Handler(this,this.fightTargetEnter),this._battleMachine.fightTargetState.update=new Laya.Handler(this,this.fightTargetUpdate),this._battleMachine.fightTargetState.exit=new Laya.Handler(this,this.fightTargetExit)},t.prototype.setStateByType=function(t){switch(t){case 0:this.setState(this.stateLazy);break;case 1:this.setState(this.stateFight);break;case 4:this.setState(this.stateMove);break;case 3:this.setState(this.stateNpcTarget);break;case 2:this.setState(this.statePickUpItem)}},t.prototype.lazyEnter=function(){this._holdBy&&this._holdBy.stand()},t.prototype.lazyUpdate=function(){},t.prototype.lazyExit=function(){},t.prototype.stopAndAttack=function(){7!=this._holdBy.actorType&&(this._holdBy.canAttck=!0,this._holdBy.action=3)},t.prototype.clear=function(){this.clearDelayAttack(),this._holdBy=null},t.prototype.clearDelayAttack=function(){Laya.timer.clearAll(this)},t.prototype.resetPrevPos=function(){this._prev_POS[0]=0,this._prev_POS[1]=0},t.prototype.canPickItem=function(t,e){if(1==t.pickupTargets.length&&t.worldX==e.worldX&&t.worldY==e.worldY)return!0;var i=t.mapX-e.mapX,n=t.mapY-e.mapY;return i*i+n*n<160},t.prototype.doPickUpItem=function(t){if(!(Date.now()-this._picktime<100))if(this._picktime=Date.now(),null!=this._holdBy.pickupTargets&&0<this._holdBy.pickupTargets.length){if(s.DropUtil.isfly)return this._holdBy.stand(),this._holdBy.status=0,void s.DropUtil.flyToRole(this._holdBy);var e=this._holdBy.pickupTargets[0];if(0==e.worldX||0==e.worldY)return this._holdBy.stand(),void s.DropUtil.flyToRole(this._holdBy);if(null==this._prev_POS||this._prev_POS[0]!=e.worldX||this._prev_POS[1]!=e.worldY)this._prev_POS[0]=e.worldX,this._prev_POS[1]=e.worldY,this.canPickItem(this._holdBy,e)?(this.doPickUpItem(t),this._holdBy.playPickUp()):(2!=this._holdBy.action&&0<this._holdBy.pickupTargets.length&&this._holdBy.moveToMapPoint(e.finalPos[0],e.finalPos[1]),this._pickTimeStart=Date.now());else{var i=400<Date.now()-this._pickTimeStart;a.RoleCenter.instans.self.lvl<20&&(i=!1),(this.canPickItem(this._holdBy,e)||i)&&(0==this._pickup_TIME?(this._pickup_TIME=t+this._PICKUP_INTERVAL,this._holdBy.playPickUp()):t>=this._pickup_TIME&&(this._pickup_TIME=0,s.DropUtil.pickUpDrop(this._holdBy.pickupTargets[0].unit_uid),this._holdBy.pickupTargets.length||o.E.ins.event(n.EventName.PICK_ALL_ITEM)))}}else this._pickup_TIME=0},t.prototype.findTargetEnter=function(){this._holdBy.moveStop(),this.findTargetUpdate()},t.prototype.findTargetUpdate=function(){if(null!=this._holdBy&&!this._holdBy.isDeath()&&this._holdBy.getFightGroup()){if(null==this._holdBy.fightTarget||this._holdBy.fightTarget.isDeath()){var t=null,e=this._holdBy.getFightGroup()._targetFG;e&&(t=e.getTargetAliveFU()),t&&this._holdBy.setFightTarget(t)}if(this._holdBy.fightTarget&&!this._holdBy.fightTarget.isDeath()){var i=this._holdBy.fightTarget.getMapPos();this.getDistance(i[0],i[1])<this._holdBy.getViewRadius()&&this._battleMachine.setState(this._battleMachine.moveTargetState)}}},t.prototype.finidTargetExit=function(){},t.prototype.moveTargetEnter=function(){var t=this._holdBy.fightTarget.getMapPos();this._prev_POS[0]=t[0],this._prev_POS[1]=t[1],this._holdBy.playMove(),this._holdBy.moveTo(this._holdBy.fightTarget)},t.prototype.moveTargetUpdate=function(){if(null==this._holdBy.fightTarget||this._holdBy.fightTarget.isDeath())this._battleMachine.setState(this._battleMachine.findTargetState);else{var t=this._holdBy.fightTarget.getMapPos();this.getDistance(t[0],t[1])<=this._holdBy.get_ATTACKDISTANCE()+this._holdBy.fightTarget.getStationRadius()?(this._battleMachine.setState(this._battleMachine.fightTargetState),o.E.ins.event(n.EventName.FIGHT_UNIT_START_ATTACK,this._holdBy)):(this._holdBy.fightRealTimePathKey||2!=this._holdBy.action)&&this.moveTargetEnter()}},t.prototype.moveTargetExit=function(){},t.prototype.fightTargetEnter=function(){this._holdBy&&!this._holdBy.isDeath()&&(this._holdBy.ways.length=0,this._holdBy.stand()),this.stopAndAttack(),o.E.ins.event(n.EventName.START_ATTACK,this._holdBy)},t.prototype.fightTargetUpdate=function(){if(null==this._holdBy.fightTarget||this._holdBy.fightTarget.isDeath())this._holdBy.stand(),this._holdBy.fightTarget=null,this._battleMachine.setState(this._battleMachine.findTargetState);else{var t=this._holdBy.fightTarget.getMapPos();this.getDistance(t[0],t[1])<=this._holdBy.get_ATTACKDISTANCE()+this._holdBy.fightTarget.getStationRadius()?this.stopAndAttack():this._battleMachine.setState(this._battleMachine.moveTargetState)}},t.prototype.fightTargetExit=function(){},t.prototype.enterFightState=function(){this._battleMachine.setState(this._battleMachine.findTargetState)},t.prototype.updateFightState=function(t){this._battleMachine.update(t)},t.prototype.exitFightState=function(){},t.prototype.getNearNPCPt=function(t){var e=this._holdBy,i=t[0]*l.MapConst.MAP_TILED_W,n=t[1]*l.MapConst.MAP_TILED_W,s=new Laya.Point(e.mapX-i,e.mapY-n);return s.normalize(),s.x*=60,s.y*=60,[Math.floor((i+s.x)/l.MapConst.MAP_TILED_W),Math.floor((n+s.y)/l.MapConst.MAP_TILED_W)]},t.prototype.runToNPC=function(t){var e=this._holdBy.npcTarget.findNode,i=this._holdBy;e?null!=this._prev_POS&&this._prev_POS[0]==e[0]&&this._prev_POS[1]==e[1]||(e=this.getNearNPCPt(e),!this._prev_POS&&(this._prev_POS=[]),this._prev_POS[0]=e[0],this._prev_POS[1]=e[1],i.playMove(),i.status=3,i.moveToNpcPoint?i.moveToNpcPoint(this._prev_POS):i.moveToMapPoint(this._prev_POS[0]*l.MapConst.MAP_TILED_W+l.MapConst.MAP_TILED_W/2,this._prev_POS[1]*l.MapConst.MAP_TILED_W+l.MapConst.MAP_TILED_W/2)):console.error("npcpos == null")},t.prototype.clearPrev_POS=function(){this._prev_POS=null},t.prototype.checkNearNpc=function(){if(this._holdBy.npcTarget&&this.pointOverlay(this._prev_POS||[0,0]))if(this._holdBy.status=0,this._holdBy.stand(),this._holdBy.bSelfUnit){o.E.ins.event(n.EventName.TALK_TO_NPC_OVER);var t=this._holdBy.npcTarget.topHpBar;t&&t.tanHao(!0)}else this._holdBy.npcTarget=null,this._holdBy.moveNextTask()},t.prototype.getDistance=function(t,e){return new Laya.Point(this._holdBy.mapX,this._holdBy.mapY).distance(t,e)},t.prototype.pointOverlay=function(t){return this._holdBy.worldX==t[0]&&this._holdBy.worldY==t[1]},t.prototype.over=function(){},t}(r.StateMachine);e.BattleStateController=h;var c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.findTargetState=null,t.moveTargetState=null,t.fightTargetState=null,t}return __extends(t,e),t}(r.StateMachine);e.BattleMachine=c}),define("src/g/fight/osprite/obj/GodPetFuTiSkillEff",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){};e.GodPetFuTiSkillEff=i}),define("src/g/fight/osprite/obj/FightUnit",["require","exports","../../../../utils/system/FloatEffect","src/g/fight/osprite/obj/BaseSprite","src/g/fight/osprite/obj/UnitSkillManager","../../../../component/GAnimation","../../../../component/TopHpBar","../../../../component/TalkTip","src/g/fight/osprite/map/MainCamera","../../../../manager/RoleCenter","../../../../utils/ItemUtils","src/g/fight/osprite/obj/BattleStateController","../../../net/messages/UserAttackMsg","../../../../config/GameConfig","src/g/fight/base/RES","../../../../enum/LoadPriority","../../../../component/TalkBubble","../../../../manager/LayerManager","src/g/fight/osprite/buff/BuffConstants","src/g/fight/osprite/skill/ClientSkill","../../../../enum/GameConst","../../../../enum/HpType","../../../../enum/enumPet","src/g/fight/osprite/obj/HaloEffectObj","../../../../enum/EventName"],function(t,e,u,i,n,h,s,o,p,a,r,l,d,c,g,v,f,y,m,_,C,I,b,w,S){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var E=function(i){function t(t){void 0===t&&(t=!0);var e=i.call(this)||this;return e.heroIndex=0,e._lastFightTime=0,e._fightGroup=null,e._vanishDeath=!1,e.petType=b.enumPet.notPet,e._hp=0,e._showHp=0,e.canMove=!1,e.canAttck=!1,e.buf_SDEF=0,e.buf_PDEF=0,e.buf_ROA=0,e.isInChoas=!1,e.isInStun=!1,e.pickInFly=!0,e._targetSelEff=null,e.isCanMove=!0,e.scaleRate=1,e.strong=0,e._constantHp=!1,e.isSelfUnit=!1,e.virtualHp=0,e.invincibleState=!1,e.invincibleTime=0,e.attackDis=0,e.attackSpeedUpCoef=1,e.changedAvatarId=0,e.changedWeaponId=0,e.viewDis=1e5,e.delayHideKey=!1,e.maxDelayHideTime=1e3,e.currDelayHideTime=0,e.station=0,e.index=-1,e.groupUid=-1,e.fightRealTimePathKey=!1,e._limitDrawKey=!1,e.forceShow=!1,e._status=0,e._startCallHandler=null,e._endCallHandler=null,e._completeCallKey=!1,e.newSkillKey=!1,e._attackInfoList=[],e.isShowBelonger=!1,e._lastFace=0,e._poison=!1,e._guardHp=0,e.isShanBi=!1,e.isWuShi=!1,e._isHeTi=!1,t&&e.initHpBar(),e.sk_Manager=new n.UnitSkillManager(e),e.ability=new l.BattleStateController,e.ability.init(e),e}return __extends(t,i),Object.defineProperty(t.prototype,"fightTarget",{get:function(){return this._fightTarget},set:function(t){this._fightTarget=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},set:function(t){var e=t!=this._status;this._status=t,this.ability&&e&&this.ability.setStateByType(t)},enumerable:!0,configurable:!0}),t.prototype.initHpBar=function(){this.topHpBar=new s.TopHpBar},t.prototype.showQuanMinHeadIcon=function(t){this.isShowBelonger=t;var e=this.isSelfUnit?a.RoleCenter.instans.vo.titleData.curTitle:this.data.curTitle;e&&this.setTitleArr(e.concat())},t.prototype.showHlAni=function(t){var e=this.topHpBar;if(e){var i=new h.GAnimation;i.completeCallBack=Laya.Handler.create(this,function(){i.removeSelf()}),i.x=60,i.load("dynamic2/huanling/"+(t<10?"0"+t:t)+".json",!0,0,"",v.LoadPriority.OTHER_ROLE_ANI),e.showAni(i)}},t.prototype.showZlAni=function(t){var e=this.topHpBar;if(e){var i=this.action,n=new h.GAnimation,s=this.face,o=c.GameConfig.getMonsterRes(c.GameConfig.zltype[t].res),a=1;0==s?s=1:2==s||4==s?s=3:5==s||6==s?(s=3,a=-1):7==s&&(a=-(s=1));var r=o.dir;1==s&&-1==r.indexOf(1)?(s=7,a=-a):3==s&&-1==r.indexOf(3)&&(s=5,a=-a);var l=g.RES.monsterPath(o.res,3,s);n.completeCallBack=Laya.Handler.create(this,function(){n.removeSelf()}),n.scale(a,1),n.load(l,!0,i,"",v.LoadPriority.OTHER_ROLE_ANI),e.showAni(n)}},t.prototype.setTitleArr=function(t){if((!this._limitDrawKey||this.forceShow)&&this.topHpBar){for(var e=t.length-1;0<=e;)t[e]&&c.GameConfig.titleJSON[t[e]]||t.splice(e,1),e--;t.length<=2?(this.isShowBelonger&&t.push(6999),t.sort(this.titleSortFun)):(t.sort(this.titleSortFun),this.isShowBelonger&&(t[0]=6999)),this.topHpBar.titleArr=t}},t.prototype.titleSortFun=function(t,e){var i=c.GameConfig.titleJSON[t],n=c.GameConfig.titleJSON[e],s=i?i.type:99;return(n?n.type:99)-s},t.prototype.stand=function(){1!=this.action&&this.playAnimation(1,0,null)},t.prototype.playFight=function(t,e){this.sk_Manager.playSkillByIndex(t,e),this.playAnimation(3,e,null)},t.prototype.playMove=function(){2==this.action&&this._lastFace==this.face||(this._lastFace=this.face,this.playAnimation(2,0,null))},t.prototype.playPickUp=function(){6!=this.action&&this.playAnimation(6,0,null)},t.prototype.playDeath=function(){8!=this.action&&this.playAnimation(8,0,null)},t.prototype.setSkillRandomDelay=function(){this.sk_Manager.setRandomStart(Date.now()+2e3*Math.random())},t.prototype.playSkillEff=function(t,e){if(this.fightTarget=t){this.sk_Manager.playSkillEff(e,t);var i=r.ItemUtils.getSkillVoById(e);i?i.sdur0&&this.playWeaponEffect(i.sdur0,i):console.error("FightUnit::playSkillEff:找不到技能，技能ID："+e.toString())}},t.prototype.playWeaponEffect=function(t,e){},t.prototype.setAsShow=function(t){void 0===t&&(t=!0),this._constantHp=t;var e=this.topHpBar;t?e&&(e.typeElement=I.HpType.npc):e&&(e.typeElement=I.HpType.role)},t.prototype.setHPBarYOff=function(t){this.topHpBar.offY=t},t.prototype.setTargetSelEff=function(t){this._targetSelEff=t},t.prototype.set_DATA=function(t){this.data=t,this._vanishDeath=!1},t.prototype.get_ACTION=function(){return this.action},t.prototype.get_ATT=function(){return 0},t.prototype.get_ATT_MULTI=function(){return 0},t.prototype.get_PDEF=function(){return 0},t.prototype.get_PDEF_MULTI=function(){return 0},t.prototype.get_SDEF=function(){return 0},t.prototype.get_SDEF_MULTI=function(){return 0},t.prototype.get_INCHURT=function(){return 0},t.prototype.get_DECHURT=function(){return 0},t.prototype.get_HIT=function(){return 0},t.prototype.get_MISS=function(){return 0},t.prototype.get_CHAOS=function(){return 0},t.prototype.get_ANTICHAOS=function(){return 0},t.prototype.get_HITBACKRATE=function(){return 0},t.prototype.get_HITBACK=function(){return 0},t.prototype.get_STRONG=function(){return 0},t.prototype.get_ANTISTRONG=function(){return 0},t.prototype.get_STRONGHURT=function(){return 0},t.prototype.get_extHURT=function(t){return 0},t.prototype.get_BOSSSTRONG=function(){return 0},t.prototype.get_BOSSDECHURT=function(){return 0},t.prototype.get_BOSSINCHURT=function(){return 0},t.prototype.get_POS=function(){return[this.worldX,this.worldY]},t.prototype.getMapPos=function(){return[this.mapX,this.mapY]},t.prototype.getGuanZhi=function(){return this.data.chopLv||0},t.prototype.setGuanzhi=function(t){this.data.chopLv=t},t.prototype.get_ATTACKDISTANCE=function(){return this.attackDis},t.prototype.getStationRadius=function(){return this.station},t.prototype.getViewRadius=function(){return this.viewDis},t.prototype.get_JUNGONG=function(){return 999999999},t.prototype.get_STORYEXP=function(){return 999999999},t.prototype.getWingSkillID=function(){return 0},t.prototype.get_PassiveMgr=function(){return null},t.prototype.isDeath=function(){return this.getHp()<=0},t.prototype.isShowDeath=function(){return this.getShowHp()<=0},t.prototype.setFightGroup=function(t){this._fightGroup=t},t.prototype.getFightGroup=function(){return this._fightGroup},Object.defineProperty(t.prototype,"beFocusEffect",{set:function(t){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"constantHp",{get:function(){return this._constantHp},set:function(t){this._constantHp=t},enumerable:!0,configurable:!0}),t.prototype.addHaloLayer=function(t){},t.prototype.addUpperLayer=function(t){},t.prototype.setFightTarget=function(t){(this.fightTarget=t,this.status=t?1:0,this._targetSelEff&&t)&&(t.beFocusEffect=this._targetSelEff)},t.prototype.getCombat=function(){return this.data&&this.data.combat||0},t.prototype.setPickupTargets=function(t){t&&(this.status=2,this.pickupTargets=t,this.ability.resetPrevPos())},t.prototype.setNPCTarget=function(t){this.npcTarget=t,this.status=3,this.ability.resetPrevPos(),this.ability.runToNPC(10)},t.prototype.isSummonPet=function(){return 0<(1&this.petType)},t.prototype.set_buf=function(t,e,i){this.sk_Manager.add_buff(t,e,i)},t.prototype.rmv_buf=function(t){},t.prototype.rmv_all_buf=function(){},t.prototype.setPoisonBlood=function(t){this._poison=t},t.prototype.chg_HP=function(t,e,i,n,s){void 0===s&&(s=!1),this.getHp()<this.virtualHp&&this.setHp(this.virtualHp),0==this.getHp()&&this.death()},t.prototype.playExtEff=function(t){},t.prototype.floatBlood=function(t,e,i,n,s,o,a){if(void 0===s&&(s=!1),void 0===o&&(o=!1),void 0===a&&(a=0),!(0<t)&&p.MainCamera.ins.contains(this.mapX,this.mapY)){var r=this.topHpBar;if(r){var l=r.x,h=r.y,c=this.face;if(n!=d.ESkillRes.CHENGJIE||(this.playExtEff(g.RES.getSdurl("TE04")),i!=d.ESkillRes.CRIT))if(n!=d.ESkillRes.JIFENG)switch(i){case d.ESkillRes.CRIT:if(n==d.ESkillRes.CRIT){u.FE.hurtFloat("ssAtt.png",t,e,l,h,!1,a);break}s?u.FE.hurtFloat("heiti_piaozi_002.png",t,e,l-200,h+150*Math.random()):u.FE.hurtFloat("baoji_"+e+".png",t,e,l,h);break;case d.ESkillRes.RX_KNYJ:u.FE.hurtFloat("hb_hit.png",t,e,l,h);break;case d.ESkillRes.RX_RXLJ:u.FE.hurtFloat("hb_double.png",t,e,l,h),this.playExtEff(g.RES.getSdurl("TE01"));break;case d.ESkillRes.RX_MSTL:u.FE.hurtFloat("hb_killHit.png",t,e,l,h),this.playExtEff(g.RES.getSdurl("TE02"));break;default:this.isShanBi&&!o?u.FE.passiveFloat(this.face,C.GameConst.FIGHTRES+"piaozi_hetishanbi.png",this.body):this.invincibleState&&!o?s?u.FE.passiveFloat(this.face,C.GameConst.FIGHTRES+"piaozi_hetishanbi.png",this.body):(u.FE.zeroFloat=!0,u.FE.floatBlood(0,c,e,l,h),u.FE.zeroFloat=!1):s?u.FE.hurtFloat("heiti_piaozi_001.png",t,c,e,l-200,h+150*Math.random()):u.FE.floatBlood(t,c,e,l,h,this._poison)}else u.FE.hurtFloat("windsword.png",t,e,l,h)}}},t.prototype.getShowHp=function(){return this._showHp},Object.defineProperty(t.prototype,"guardHp",{get:function(){return this._guardHp},set:function(t){var e=this.topHpBar;e&&(0<t&&(e.typeElement=I.HpType.tiangangshouhu),t<=0&&(e.typeElement=I.HpType.role),e.hp3=t),this._guardHp=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hp",{get:function(){return this._hp},enumerable:!0,configurable:!0}),t.prototype.getHp=function(){var t=this._fightGroup,e=this._hp;if(this._isHeTi){if(!t)return e;for(var i=t.getNoPetArr(),n=i.length,s=0;s<n;s++){var o=i[s];o&&o!=this&&(e+=o.hp)}return e}return e},t.prototype.setHp=function(t){t<0&&(t=0);var e=this.totalHp,i=this._guardHp;t!=e&&0<i&&(e<t?(i=e+i-t)<0&&(i=0):i=0,this.guardHp=i),t=Math.floor(t),this._hp!=t&&(this._hp=t,this.event(S.EventName.HP_CHANGED,this._hp))},t.prototype.setHPMax=function(t){this.topHpBar&&(this.topHpBar.totalHp=t)},t.prototype.setPerHp=function(t){this.setHp(t*this.getTotalHp())},Object.defineProperty(t.prototype,"totalHp",{get:function(){var t=this.data;return t?t.HP:0},enumerable:!0,configurable:!0}),t.prototype.getTotalHp=function(){var t=this.totalHp,e=this._fightGroup;if(this._isHeTi){var i=t;if(!e)return i;for(var n=e.getNoPetArr(),s=n.length,o=0;o<s;o++){var a=n[o];a&&a!=this&&(i+=a.totalHp)}return i}return t},t.prototype.startDeadDelayHide=function(){this.delayHideKey=!0,this.currDelayHideTime=0},t.prototype.endDeadDelayHide=function(){this.delayHideKey=!1,this.currDelayHideTime=0},t.prototype.moveTo=function(t){},t.prototype.moveStop=function(){},t.prototype.resetUnit=function(t,e){this.virtualHp=0,this.isInChoas=!1,this.isInStun=!1,this.endDeadDelayHide()},t.prototype.resetUnitPos=function(t,e){this.setWorldXY(t,e)},t.prototype.beHit=function(t,e){void 0===e&&(e=!1)},t.prototype.playAnimation=function(t,e,i){void 0===e&&(e=0)},t.prototype.calSkillHurtEff=function(t){this.sk_Manager.calSkillHurtEff(t)},t.prototype.calSkillHurt=function(t){this.sk_Manager.calSkillHurt(t)},t.prototype.getSkillId=function(t){var e=null,i=this.sk_Manager.getSkillId(t);return-1!=i&&(e=r.ItemUtils.getSkillVoById(i)),e},t.prototype.setInvincibleState=function(t){this.invincibleState=!0,this.invincibleTime=t},t.prototype.frameMove=function(t,e){this.invincibleState&&t>this.invincibleTime&&(this.invincibleState=!1,this.invincibleTime=0);var i=this.getHp(),n=this.topHpBar;if(n){n.hp=i;var s=this._showHp;if(s!=i&&(s-i<n.getLimitHp()?s=i:this._hp<=0?s+=(i-s)/2:s+=(i-s)/5,n.showHp=s,this._showHp=s),this._isHeTi){var o=this.sk_Manager.getBuffByType(m.BuffConstants.TYPE_MERGE);o&&(n.totalHp2=1e3*o.data.cd,n.hp2=Math.max(0,o.endTime-Date.now()))}n&&(n.holdByScaleRate=this.scaleRate),this.ability.update(t),this.checkPlaySkill(t),this.sk_Manager.updateBuff(t),this._clientShill&&this._clientShill.next&&this._clientShill.frameMove(t,e)}},Object.defineProperty(t.prototype,"isHeTi",{get:function(){return this._isHeTi},enumerable:!0,configurable:!0}),t.prototype.setHeTi=function(t){if(this._isHeTi!=t){this._isHeTi=t;var e=this.topHpBar;t?e&&(e.typeElement=I.HpType.heti):e&&(e.typeElement=I.HpType.role),this.setHPMax(this.getTotalHp())}},t.prototype.checkPlaySkill=function(t){if(t-this._lastFightTime>n.UnitSkillManager.MIN_CDTIME*this.attackSpeedUpCoef){this._completeCallKey&&this._endCallHandler&&(this._completeCallKey=!1,this._endCallHandler.runWith(this.unit_uid));var e=this.sk_Manager.checkIsPlaySkill(t);-1!=e&&(this.playFight(t,e),this._lastFightTime=t,this._startCallHandler&&(this._completeCallKey=!0,this._startCallHandler.runWith(this.unit_uid)))}},t.prototype.isUpdateHpBar=function(){return this._showHp!=this.getHp()},t.prototype.setTalkText=function(t,e,i){void 0===e&&(e=90),void 0===i&&(i=!1),this.talkTip||(this.talkTip=new o.TalkTip,this.view.nameLayer.addChild(this.talkTip),this.talkTip.x=-200,this.talkTip.y=-140,this.talkTip.height=e),this.talkTip.text=t},t.prototype.clearTalk=function(){this.talkTip&&(this.talkTip.removeSelf(),this.talkTip.destroy(!0),this.talkTip=null)},t.prototype.talkBubble=function(t){t&&(this._bubble||(this._bubble=new f.TalkBubble),this._bubble.saySth(t),y.LayerManager.fightLayer.popLayer.addChild(this._bubble))},t.prototype.death=function(){},t.prototype.deathHide=function(){this.clearAllClientSkill()},t.prototype.clearAllClientSkill=function(){for(;this._clientShill&&this._clientShill.next;)this._clientShill.next.clear()},t.prototype.destroyUnit=function(){this.sk_Manager&&this.sk_Manager.clear(),this.ability&&this.ability.clear(),this.fightTarget=null,this.npcTarget=null,this.pickupTargets=null,this._fightGroup=null,this.isCanMove=!0,this.isInChoas=!1,this.isInStun=!1,this.virtualHp=0,this.clearTalk(),this.clearAllClientSkill(),i.prototype.destory.call(this)},t.prototype.svrSetHP=function(t,e){void 0===e&&(e=!0)},t.prototype.registerCompleteCallHandler=function(t){this._endCallHandler=t},t.prototype.clearCompleteCallHandler=function(){this._endCallHandler=null},t.prototype.registerStartCallHandler=function(t){this._startCallHandler=t},t.prototype.clearStartCallHandler=function(){this._startCallHandler=null},t.prototype.triggerPassive=function(t){},t.prototype.triggerShenYu=function(t){},t.prototype.showReLife=function(){},t.prototype.addAttackInfo=function(t){},t.prototype.removeWeaponEff=function(){},t.prototype.resetEquipData=function(){},t.prototype.clearBeFocus=function(){this.beFocus&&(this.beFocus.clear(),this.beFocus.destroy(!0),this.beFocus=null)},t.prototype.limitDraw=function(t,e){this._limitDrawKey!=t&&(this._limitDrawKey=t,this._limitDrawKey)},t.prototype.isLimitDraw=function(){return this._limitDrawKey},t.prototype.registClientSkill=function(t){this._clientShill||(this._clientShill=new _.ClientSkill(this,0,0,!1)),this._clientShill.addLastSkill(t)},t.prototype.addHalo=function(t){this._haloList||(this._haloList=new w.HaloEffectObj),this._haloList.addLastSkill(t)},t.prototype.clearAllHalo=function(){this._haloList&&(this._haloList.clearAll(),this._haloList=null)},t.prototype.hasHalo=function(){return null!=this._haloList&&null!=this._haloList.next},t.CHAOSBUFF_ID=5,t}(i.BaseSprite);e.FightUnit=E;var T=function(){this.targets=[],this.hps=[],this.skillResLower=[],this.skillResHigh=[],this.skillId=-1};e.AttackInfo=T}),define("src/g/fight/osprite/obj/PassiveMgr",["require","exports","../../../../utils/ItemUtils","../../../net/messages/UserAttackMsg"],function(t,e,o,n){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.EPassiveType||(e.EPassiveType={}))[i.RECOVER=1]="RECOVER",i[i.INCHURT=2]="INCHURT",i[i.DECHURT=3]="DECHURT",i[i.HITBACK=4]="HITBACK",i[i.HP_HURT=5]="HP_HURT",i[i.DECATT=6]="DECATT",i[i.DECDEF=7]="DECDEF",i[i.REVIVE=8]="REVIVE",i[i.END=9]="END";var a=function(){this.lastTriggerTime=0,this.inTriggerState=!1,this.inCD=!1,this.touch=!1};e.Passive=a;var s=function(){function t(){this.passiveDic=[]}return t.prototype.clear=function(){this.hero=null,this.passiveDic.length=0},t.prototype.initPassiveMgr=function(t){for(var e=t.data.passive.idArr,i=0;i<9;i++)this.passiveDic[i]=null;this.hero=t;for(i=0;i<e.length;i++)if(e[i]){var n=o.ItemUtils.getPassiveVoById(e[i]),s=new a;(this.passiveDic[n.type]=s).passiveType=n.type,s.param0=n.pram0,s.param1=n.pram1,s.rate=n.rate/1e4,s.param0&&50<=s.param0&&(s.param0/=1e4),1==n.type?1<n.effect.length?(s.effectVal=n.effect[1][1],s.effectValMulti=n.effect[0][1]/1e4):(s.effectVal=n.effect[0][1],s.effectValMulti=0):s.effectVal=n.effect[0][1]/1e4}},t.prototype.onPassiveChg=function(){for(var t=this.hero.data.passive.idArr,e=0;e<9;e++)this.passiveDic[e]&&(this.passiveDic[e].touch=!1);for(e=0;e<t.length;e++)if(t[e]){var i=o.ItemUtils.getPassiveVoById(t[e]);if(this.passiveDic[i.type]&&this.passiveDic[i.type].id==t[e])this.passiveDic[i.type].touch=!0;else{this.passiveDic[i.type]||(this.passiveDic[i.type]=new a);var n=this.passiveDic[i.type];n.touch=!0,n.passiveType=i.type,n.param0=i.pram0,n.param1=i.pram1,n.rate=i.rate/1e4,n.param0&&50<=n.param0&&(n.param0/=1e4),1==i.type?1<i.effect.length?(n.effectVal=i.effect[1][1],n.effectValMulti=i.effect[0][1]/1e4):(n.effectVal=i.effect[0][1],n.effectValMulti=0):n.effectVal=i.effect[0][1]/1e4}}for(e=0;e<9;e++)this.passiveDic[e]&&0==this.passiveDic[e].touch&&(this.passiveDic[e]=null)},t.prototype.passive_INCHURT=function(){return 0},t.prototype.passive_DECHURT=function(){return 0},t.prototype.passive_HITBACK=function(){return this.passiveDic[4]&&Math.random()<=this.passiveDic[4].rate?(this.float(4),this.passiveDic[4].effectVal):0},t.prototype.passive_HP_HURT=function(t){if(!this.passiveDic[5])return 0;var e=this.passiveDic[5];return t.getHp()/t.getTotalHp()>e.param0?0:Math.random()<e.param0?e.effectVal:0},t.prototype.passive_DECATT=function(){if(!this.passiveDic[6])return 0;var t=this.passiveDic[6];return t.inTriggerState?t.effectVal:t.inCD?0:Math.random()<=t.rate?(t.lastTriggerTime=Date.now(),t.inTriggerState=!0,this.float(6),t.effectVal):0},t.prototype.decAttDefFrameMove=function(t,e){if(this.passiveDic[e]){var i=this.passiveDic[e];(i.inCD||i.inTriggerState)&&(t-i.lastTriggerTime>=1e3*i.param0&&(i.inCD=!0,i.inTriggerState=!1),t-i.lastTriggerTime>=1e3*i.param1&&(i.inCD=!1))}},t.prototype.passive_DECDEF=function(){if(!this.passiveDic[7])return 0;var t=this.passiveDic[7];return t.inTriggerState?t.effectVal:t.inCD?0:Math.random()<=t.rate?(t.lastTriggerTime=Date.now(),t.inTriggerState=!0,this.float(7),t.effectVal):0},t.prototype.passive_REVIVE=function(){if(!this.passiveDic[8])return 0;var t=this.passiveDic[8];return Math.random()<=t.rate?t.effectVal:0},t.prototype.recoverFrameMove=function(t){var e=this.passiveDic[1];if(this.hero.getHp()/this.hero.getTotalHp()<=e.param0){var i=void 0;if(1e3<=t-e.lastTriggerTime)i=e.effectVal,i+=Math.floor(this.hero.getTotalHp()*e.effectValMulti),this.hero.chg_HP(i,null,n.ESkillRes.NULL,n.ESkillRes.NULL),0==e.lastTriggerTime?e.lastTriggerTime=t:e.lastTriggerTime+=1e3}},t.prototype.framemove=function(t){this.passiveDic[1]&&this.recoverFrameMove(t),this.passiveDic[6]&&this.decAttDefFrameMove(t,6),this.passiveDic[7]&&this.decAttDefFrameMove(t,7)},t.prototype.clearPassiveState=function(){this.passiveDic[6]&&(this.passiveDic[6].inCD=!1,this.passiveDic[6].inTriggerState=!1),this.passiveDic[7]&&(this.passiveDic[7].inCD=!1,this.passiveDic[7].inTriggerState=!1),this.passiveDic[1]&&(this.passiveDic[1].lastTriggerTime=0)},t.prototype.float=function(t){},t}();e.PassiveMgr=s}),define("src/init/TextConst",["require","exports","../g/net/messages/EnterMuSceneC2GS","../g/net/messages/SandyNightMsg","../config/GameConfig","../enum/enumItem"],function(t,e,i,n,a,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){}return t.showErrorInfo=function(t){var e="";return this._errDic[t]&&(e=this._errDic[t],console.log(this._errDic[t])),e},t.replace=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=Laya.Text.langPacks;t=n?n[t]||t||"":t||"";for(var s=0;s<e.length;s++)t=t.replace("{"+s+"}",e[s]);return t},t.get=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=a.GameConfig.lang,s="";if(n){var o=n[t];o&&(s=o.val),s=this.replace.apply(this,__spreadArrays([s],e))}return s},t.initTextDic=function(){var t=null;this.SCF_ENTER_PALACE=this.get(952),this.SCF_ENTER_INNERCITY=this.get(953),ktgame.customView.ItemNeedCtrol.max=this.get(208),ktgame.Skill.HandBookItem.str1=this.get(761),ktgame.Skill.HandBookItem.str2=this.get(763),ktgame.component.AccordionBox.getStr=this.get(854),ktgame.bossRuntime.LuckyView.time=this.get(82),s.enumItem.arr_Job=[this.get(118),this.get(119),this.get(120),this.get(121)],s.enumItem.arr_equipPosName=[this.get(122),this.get(123),this.get(124),this.get(125),this.get(126),this.get(127),this.get(128)],s.enumItem.arr_equipPosNameSs=[this.get(1017),this.get(1018),this.get(1019),this.get(1020),this.get(1021),this.get(1022),this.get(1023),this.get(1024),this.get(1025),this.get(1026),this.get(1027),this.get(1028)],s.enumItem.arr_equipPosNameRx=[this.get(123),this.get(124),this.get(125),this.get(126),this.get(127),this.get(127),this.get(128),this.get(128)],s.enumItem.arr_equipPosNameNs=[this.get(129),this.get(130),this.get(131),this.get(132)],s.enumItem.arr_srEquipPosNameNs=[this.get(1175),this.get(1176),this.get(1177),this.get(1178)],s.enumItem.arr_fsEquipPosNameNs=["武器","衣服","头盔","项链","左镯","右镯","左戒","右戒","腰带","鞋子"],s.enumItem.arr_srEquipPosNameNs=[this.get(1175),this.get(1176),this.get(1177),this.get(1178)],null==this._errDic&&((t=this._errDic={})[i.ErrEnterCode.ERR_PORTID]=this.get(904),t[i.ErrEnterCode.ERR_PLAYTYPE]=this.get(905),t[i.ErrEnterCode.ERR_ENTERCD]=this.get(906),t[i.ErrEnterCode.ERR_NOT_OPEN]=this.get(455),t[i.ErrEnterCode.ERR_LOWLEVEL]=this.get(907),t[i.ErrEnterCode.ERR_NOTIN_FAMILY]=this.get(908),t[i.ErrEnterCode.ERR_ALREADY_INSCENE]=this.get(909),t[i.ErrEnterCode.ERR_MUST_OUTCITY]=this.get(910),t[i.ErrEnterCode.ERR_SCENE_ORDER]=this.get(911),t[i.ErrEnterCode.ERR_INNERCITY_CD]=this.get(912),t[i.ErrEnterCode.ERR_PALACE_ENTER]=this.get(913),t[i.ErrEnterCode.ERR_ILLEGAL_INITPOS]=this.get(914),t[i.ErrEnterCode.ERR_EXIT_NOTIN_SCENE]=this.get(915),t[i.ErrEnterCode.ERR_NOT_INCITY]=this.get(916),t[i.ErrEnterCode.ERR_PASSIONPOINT_NOTOPEN]=this.get(917),t[i.ErrEnterCode.ERR_NOTIN_SAFEAREA]=this.get(918),t[i.ErrEnterCode.ERR_SANDYNIGHT_NOTOPEN]=this.get(919),t[i.ErrEnterCode.ERR_INITBB_PORTID]=this.get(920),t[i.ErrEnterCode.ERR_BBTRANS_PORTID]=this.get(921),t[i.ErrEnterCode.ERR_NOTIN_TRANSAREA]=this.get(922),t[i.ErrEnterCode.ERR_LOW_SCORE]=this.get(923)),null==this.passiveDic&&((t=this.passiveDic={})[1]="nRelife",t[2]="nHitSoul",t[3]="nShield",t[4]="nCounter",t[5]="nDead",t[6]="nSoul",t[7]="nDrug",t[8]="nGod"),null==this.realPassiveDic&&((t=this.realPassiveDic={})[1]="realRelife",t[2]="realHitSoul",t[3]="realShield",t[4]="realCounter",t[5]="realDead",t[6]="realSoul",t[7]="realDrug",t[8]="realGod"),null==this.SCNScoreDic&&((t=this.SCNScoreDic={})[n.ScoreGetType.killUser]=this.get(924),t[n.ScoreGetType.helpKillUser]=this.get(925),t[n.ScoreGetType.beKilled]=this.get(926),t[n.ScoreGetType.inScene]=this.get(927),t[n.ScoreGetType.killMonster]=this.get(928),t[n.ScoreGetType.gmAdd]=this.get(929)),null==this.SCNScoreDic&&((t=this.SCNScoreDic={})[n.ScoreGetType.killUser]=this.get(924),t[n.ScoreGetType.helpKillUser]=this.get(925),t[n.ScoreGetType.beKilled]=this.get(926),t[n.ScoreGetType.inScene]=this.get(927),t[n.ScoreGetType.killMonster]=this.get(928),t[n.ScoreGetType.gmAdd]=this.get(929)),null==this.shenyuSrcDic&&((t=this.shenyuSrcDic={})[1]="rxjineng_01",t[2]="rxjineng_02",t[3]="rxjineng_03",t[4]="rxjineng_04")},t.getSCNSoreTextByType=function(t){return this.SCNScoreDic[t]},t._errDic=null,t.passiveDic=null,t.passiveBg="nBg",t.realPassiveDic=null,t.realPassiveBg="realBg",t.SCNScoreDic=null,t.shenyuSrcDic=null,t}();e.TextConst=o}),define("src/g/role/vo/SsESuitVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e){var i=0;this.id=t[i++],this.name=t[i++],this.type=t[i++],this.need=t[i++],this.suitskill=t[i++],e[this.id]=this},t}();e.SsESuitVo=i}),define("src/g/shenjiang/vo/SjEqUpVo",["require","exports","../../../utils/VoUtils"],function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function n(){}return n.prototype.init=function(t,e){var i=0;this.id=t[i++],this.prop=t[i++],this.cost=t[i++],this.power=t[i++],s.VoUtils.setCostIdArr(n.costIdArr,this.cost),e[this.id]=this},n.costIdArr=[],n}();e.SjEqUpVo=i}),define("src/g/configjson/ctrl/ConfigJsonCtrl",["require","exports","../../../meta/FamilyTaskVo","../../../meta/FamilySkillsVo","../../../meta/FamilyOrderVo","../../../meta/FamilyMiJingVo","../../../meta/FamilyLevelVo","../../../meta/FamilySettingVo","../../../meta/BlessMasterVo","../../../meta/WingSuitVo","src/g/role/vo/GovernStruct","../../../meta/GovernVo","../../../meta/Port_zhuanshengVo","../../../meta/PassiveVo","../../../meta/PassiveConfigVo","src/g/lottery/Vo/ShengShiVo","../../../meta/ChopVo","../../../meta/JingMaiConfigVo","../../../meta/NewRoleConfigVo","../../../meta/RankConfigVo","../../../meta/Shop1Vo","../../../meta/CopymaterialVo","../../../meta/MeetrankrewardVo","src/g/lottery/Vo/ChengZhuangVo","../../../enum/enumItem","../../../meta/ShuXingVo","../../../meta/ShieldVo","../../../meta/BossVo","../../../meta/UIEffectsVo","../../../meta/StoneVo","../../../meta/BagCostVo","../../../meta/WingConfigVo","../../../meta/EquipSoulVo","../../../meta/CurrencyVo","../../../meta/ActiveTaskVo","../../../meta/GuideVo","../../../meta/TaskVo","../../../meta/MapVO","../../../meta/NPCVo","../../../meta/MonsterVO","../../../meta/ItemVo","../../../meta/EquipVo","../../../meta/SkillVo","../../../meta/PortVo","../../../meta/BlessVo","../../../meta/BossmeetingVo","../../../meta/EquipEnHanceVo","../../../meta/HeroVo","../../../meta/MeridianLevelVo","../../../meta/MeridianStageVo","../../../meta/DragonScalesVo","../../../meta/NoticeVo","../../../meta/PetVo","../../../meta/PlayerVo","../../../meta/PlayerSettingVo","../../../meta/PowerVo","../../../meta/Ring1Vo","../../../meta/Ring2Vo","../../../meta/RobotVo","../../../meta/SkillSettingVo","../../../meta/SuitVo","../../../meta/WingLevelVo","../../../meta/WingStarVo","../../../meta/ZhuanShengVo","../../../meta/BuffVo","../../../enum/EventName","../../../core/E","../../../config/GameConfig","../../../meta/Shop3Vo","../../../meta/Shop2Vo","../../../meta/TitleVo","../../../meta/ZhuanShengSettingVo","../../../meta/Lottery","../../../meta/WingEquipVo","../../../meta/Port_quanminVo","../../../meta/MailVo","../../../meta/BossSettingVo","src/g/skill/vo/PassiveStruct","../../../meta/SignVo","../../../meta/VipVo","../../../meta/Port_shenyuVo","../../../meta/ArtifactsVo","../../../meta/ArtifactsLevelVo","../../../meta/KingSettingVo","../../../meta/WingPassiveVo","../../../vo/GodWingVo","../../../meta/KingVo","../../../meta/KingRankRewardVo","../../../meta/ExpressVo","../../../meta/MainButtonVo","../../../meta/AchieveVo","../../../meta/MedalVo","../../../meta/MeetsettingVo","../../../meta/ActivityVo","../../../meta/SubActivityVo","../../../meta/ActivityRankVo","../../../meta/RechargeVo","../../../meta/SandyCitySettingVo","../../../meta/SandyCityRankVo","../../../meta/FashionVo","../../../meta/DartVo","../../../meta/DartConfig","../../../meta/RuledescVo","../../../meta/BossCallVo","../../../meta/PortCallVo","../../../meta/Port_zhuanshengrankVo","../../../meta/EquipSpiritVo","../../../meta/MainCityEleVo","../../../meta/MeetRewardVo","../../../meta/ChatTemplateVo","../../../meta/OnLineRewardvo","../../../meta/RelicVo","../../../meta/MonopolyVo","../../../meta/MonopolyBoxVo","../../../meta/CommonVo","../../../meta/MaterialportVo","../../../meta/MedalStarVo","../../../meta/ZhanWenVo","../../../meta/FengshenVo","../../../meta/PagodaLayerVo","../../../meta/PagodaTurntableVo","../../../meta/PagodaVo","../../../meta/TeJieVo","../../../meta/TimeLimitTaskVo","../../../meta/TimeLimitSubTaskVo","../../../meta/HunYinVo","../../../meta/VipBossVo","../../../meta/FuWenBoxVo","../../../meta/AccessCfgVo","../../../meta/ChopTaskVo","src/g/copy/vo/EXPAttributeCardVo","src/g/copy/vo/EXPEnviromentVo","../../../meta/BlessSuitVo","../../../meta/RobotNpcVo","../../../meta/CardListVo","../../../meta/CardVo","../../../meta/CardLevel","../../../meta/CardSuitVo","../../../meta/ExpGameBuffVo","../../../meta/FuWenTroughVo","../../../meta/PlaysettingVo","../../../meta/RelicDebrisVo","../../../meta/PkConfigVo","../../../meta/PKBoxVo","../../../meta/HunYinVoBoss","src/g/helper/vo/HelperStruct","../../../meta/ActivityShopVo","../../../meta/ActivityWheelVo","../../../meta/TeJieTaskVo","../../../meta/AnswerConfig","../../../meta/BossCritVo","../../../meta/PointSettingVo","../../../meta/AuctionsVo","../../../meta/AuctionsSettingVo","../../../meta/PointAwardVo","../../../meta/HunTaskVo","../../../meta/HunSubTaskVo","../../../meta/TimingActivityVO","../../../meta/AuctionsAttentionVo","../../../meta/AegisLevelVo","../../../meta/AegisStarVo","../../../meta/AegisTaskVo","../../../meta/ReXieZhanChangeVo","../../../meta/ReXieZhanChangSettingVo","../../../meta/ReXueAttrVo","../../../meta/ReXueStoneVo","../../../meta/ReXueEquipVo","../../../meta/ReXueOrnamentVo","../../../meta/ReXueSuitVo","../../../meta/AegisTaskGroupVo","../../../meta/ReXueCaoOpenVo","../../../meta/ReXueOrSuitVo","../../../meta/ReXueStSuitVo","../../../meta/HBTemplePortVo","../../../meta/WorldBossVo","../../../vo/SbExpVo","../../../vo/SbTianFuVo","../../../vo/SbTepVo","../../../vo/SbTaskVo","../../../vo/SbPortVo","../../../vo/SbSettingVo","../../../vo/SbPortInfoVo","../../../meta/NightCitySettingVo","src/init/VoAsyncLoader","../../../meta/NightCityRankVo","../../../meta/TargetVo","../../../meta/PortPlotVo","../../../vo/SkillTipsVo","../../../meta/QualiyVo","../../../meta/MultiSvrBossVo","../../../vo/SbHechengVo","../../../vo/SbEquipVo","../../../meta/MultiserverBOSSsettingVo","src/g/lottery/Vo/SySuitVo","src/g/lottery/Vo/SyLevelVo","src/g/zhanling/vo/ZlTypeVo","src/g/zhanling/vo/ZlSkillVo","src/g/zhanling/vo/ZlDrugVo","src/g/zhanling/vo/ZlStarVo","../../../meta/ReXueOrCompVo","src/g/zhanling/vo/ZlCopyVo","../../../meta/GameEventVo","../../../vo/XwEVo","../../../vo/XwEsVo","../../../meta/KFRXVo","../../../vo/XwPropVo","../../../vo/XwStrongVo","../../../meta/MoneyRewardVo","../../../meta/LangVo","src/init/TextConst","../../../meta/GodPet","src/g/jineng/vo/SkillOpenVo","../../../meta/LotteryDrawVo","../../../meta/ShopSettingVo","../../../meta/KFTVo","../../../meta/FuMoVo","../../../meta/ChannelGiftVo","src/g/role/vo/SsLvVo","src/g/role/vo/SsESuitVo","src/g/role/vo/SsEVo","../../../meta/KFSDVo","src/g/share/vo/ShareSeekHelpVo","src/g/share/vo/ShareVo","src/g/share/vo/ShareShopVo","../../../meta/MonsterLangVo","src/g/role/vo/SsStrongVo","../../../meta/Ring3Vo","../../../meta/Ring4Vo","../../../meta/KfjjcCfgVo","../../../meta/KfjjcRewardCfgVo","../../../meta/FashionStarVo","src/g/crossserboss/vo/RyghVo","src/g/gameSdk/gameSdk","../../../meta/SoundVo","../../../meta/TeamCopySettingVo","../../../meta/TeamCopyVo","../../../meta/ShenWeiYuRankVo","../../../meta/ShenweiyuVo","../../../meta/RingLingSkillVo","../../../meta/RingLingUpVo","../../../meta/AccessRongDuanVo","../../../meta/PetSoulVo","src/g/shenjiang/vo/SjVo","src/g/shenjiang/vo/SjSuitVo","src/g/shenjiang/vo/SjEqUpVo","../../../meta/RoughSkillVo","../../../meta/RoughGlovesVo","../../../meta/RoughStrongVo","../../../meta/RoughSuitVo","../../../meta/RoughCopyVo","../../../meta/ShenQiVo","../../../meta/ShenQiLevelVo","../../../meta/ShenQiStarLevelVo","../../../meta/KFSQJDVo","../../../meta/BladeequipVo","../../../meta/BladelvVo","../../../meta/BladesetingVo","../../../meta/FsEquipBreachVo","../../../meta/FeiShengVo","../../../meta/FsEquipVo","../../../meta/FsEquipSuitVo","../../../meta/FsEquipStrongVo","../../../meta/KFZYBoss","../../../meta/HlUpVo","../../../meta/HlHhUpVo"],function(t,e,r,l,h,c,u,i,n,p,s,o,d,g,v,f,y,m,_,C,I,b,w,S,E,T,A,R,L,x,P,k,D,H,M,G,B,N,U,V,O,F,q,K,Y,j,J,W,z,X,Q,Z,$,tt,et,it,nt,st,ot,at,rt,lt,ht,ct,ut,pt,dt,gt,vt,ft,yt,mt,_t,Ct,It,bt,wt,St,Et,Tt,At,Rt,Lt,xt,Pt,kt,Dt,Ht,Mt,Gt,Bt,Nt,Ut,Vt,Ot,Ft,qt,Kt,Yt,jt,Jt,Wt,zt,Xt,Qt,Zt,$t,te,ee,ie,ne,se,oe,ae,re,le,he,ce,ue,pe,de,ge,ve,fe,ye,me,_e,Ce,Ie,be,we,Se,Ee,Te,Ae,Re,Le,xe,Pe,ke,De,He,Me,Ge,Be,Ne,Ue,Ve,Oe,Fe,qe,Ke,Ye,je,Je,We,ze,Xe,Qe,Ze,$e,ti,ei,ii,ni,si,oi,ai,ri,li,hi,ci,ui,pi,di,gi,vi,fi,yi,mi,_i,Ci,Ii,bi,wi,Si,Ei,Ti,Ai,Ri,Li,xi,Pi,ki,Di,Hi,Mi,Gi,Bi,Ni,Ui,Vi,Oi,Fi,qi,Ki,Yi,ji,Ji,Wi,zi,Xi,Qi,Zi,$i,tn,en,nn,sn,on,an,rn,ln,hn,cn,un,pn,dn,gn,vn,fn,yn,mn,_n,Cn,In,bn,wn,Sn,En,Tn,An,Rn,Ln,xn,Pn,kn,Dn,Hn,Mn,Gn,Bn,Nn,Un,Vn,On,Fn,qn,Kn,Yn,jn,Jn,Wn,zn,Xn){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function a(){this.isNewComer=!1,a.ins=this}return a.prototype.uijosnzip=function(){a._resMetaJSONS=window.ktjson,a.ins.onPerloadComplet(),a.ins.mapjson()},a.prototype.mapjson=function(){a._samemap=window.ktjson.sameMap},Object.defineProperty(a.prototype,"sameMap",{get:function(){return a._samemap||(a._samemap=[])},enumerable:!0,configurable:!0}),a.prototype.getResJson=function(t){var e=window.ktgamepreloadjdk.platform;return e&&a._resMetaJSONS[t+e]||a._resMetaJSONS[t]},a.prototype.onLoadedMonsterRes=function(t){gt.GameConfig.MonsterRes=t,this._monsterVOLoader=new bi.VoAsyncLoader(V.MonsterVO,Laya.Handler.create(this,this.onLoadedMonster),this.getResJson("monster")).load()},a.prototype.onAllLoaded=function(){(delete this._monsterVOLoader,delete this._monsterResVOLoader,this.releaseAllJsonString(),this.isNewComer)||(gt.GameConfig.loadOver=!0,console.log("数据表解析完成--------",Laya.Browser.now()),this.overLoad())},a.prototype.onLoadedMonster=function(t){gt.GameConfig.monsterJSON=t,Laya.timer.frameOnce(1,this,this.onAllLoaded)},a.prototype.newcomerJoson=function(){this.isNewComer=!0;for(var s=[],o=0;o<4;o++)s.push("dynamic/configjson/ktjson_big"+o+".json");Laya.loader.load(s,Laya.Handler.create(this,function(){console.log("新手后续加载...");var t={};for(o=0;o<4;o++){var e=Laya.loader.getRes(s[o]);for(var i in e)t[i]=e[i]}a._resMetaJSONS=t;var n=gt.GameConfig;t.sound&&(n.SoundJSON=this.initVo4Json(t.sound,_n.SoundVo)),this.getResJson("lang_zh")&&(n.lang=this.initVo4Json(this.getResJson("lang_zh"),Ji.LangVo)),this.getResJson("monsterlang")&&(n.MonsterLang=this.initVo4Json(this.getResJson("monsterlang"),cn.MonsterLangVo)),this.getResJson("specialskillopen")&&(n.skillOpen=this.initVo4Json(this.getResJson("specialskillopen"),Xi.SkillOpenVo)),Wi.TextConst.initTextDic(),this.getResJson("sslevel")&&(n.SSLv=this.initVo4Json(this.getResJson("sslevel"),nn.SsLvVo)),this.getResJson("ssequip")&&(n.SSEquip=this.initVo4Json(this.getResJson("ssequip"),on.SsEVo)),this.getResJson("ssequipsuit")&&(n.SSEquipSuit=this.initVo4Json(this.getResJson("ssequipsuit"),sn.SsESuitVo)),this.getResJson("ssequipenhance")&&(n.SSequipenhance=this.initVo4Json(this.getResJson("ssequipenhance"),un.SsStrongVo)),this.getResJson("zhuanshengsettings")&&(n.SSSetting=this.initZhuanShengSetting(this.getResJson("zhuanshengsettings"),1)),this.getResJson("xwequip")&&(n.xwequip=this.initVo4Json(this.getResJson("xwequip"),Oi.XwEVo)),this.getResJson("xwequipporp")&&(n.xwProp=this.initVo4Json(this.getResJson("xwequipporp"),Ki.XwPropVo)),this.getResJson("xwequipsuit1")&&(n.xwequipsuit=this.initVo4Json(this.getResJson("xwequipsuit1"),Fi.XwEsVo)),this.getResJson("xwequipenhance")&&(n.xwequipenhance=this.initVo4Json(this.getResJson("xwequipenhance"),Yi.XwStrongVo)),this.getResJson("xwequipsetting")&&(n.xwZ7z8=this.initVo4Json(this.getResJson("xwequipsetting"),re.CommonVo)),this.getResJson("cardsuit")&&this.initVo4Json(this.getResJson("cardsuit"),xe.CardSuitVo),this.getResJson("rexueneishihecheng")&&(n.rexue_ornament_comp=this.initVo4Json(this.getResJson("rexueneishihecheng"),Ni.ReXueOrCompVo)),this.getResJson("zhanling")&&(n.zltype=this.initVo4Json(this.getResJson("zhanling"),Hi.ZlTypeVo)),this.getResJson("zhanlingdrug")&&(n.zldrug=this.initVo4Json(this.getResJson("zhanlingdrug"),Gi.ZlDrugVo)),this.getResJson("zhanlingskill")&&(n.zlskill=this.initVo4Json(this.getResJson("zhanlingskill"),Mi.ZlSkillVo)),this.getResJson("zhanlingstar")&&(n.zlstar=this.initVo4Json(this.getResJson("zhanlingstar"),Bi.ZlStarVo)),this.getResJson("zlcopy")&&(n.zlcopy=this.initVo4Json(this.getResJson("zlcopy"),Ui.ZlCopyVo)),this.getResJson("shenyusuit")&&(n.sysuit=this.initVo4Json(this.getResJson("shenyusuit"),ki.SySuitVo)),this.getResJson("shenyulevel")&&(n.sylevel=this.initVo4Json(this.getResJson("shenyulevel"),Di.SyLevelVo)),this.getResJson("shenbingequip")&&(n.sb_equip=this.initVo4Json(this.getResJson("shenbingequip"),xi.SbEquipVo)),this.getResJson("shenbingshengwuhecheng")&&(n.sb_hecheng=this.initVo4Json(this.getResJson("shenbingshengwuhecheng"),Li.SbHechengVo)),this.getResJson("shenbingtianfu")&&(n.sb_tianfu=this.initVo4Json(this.getResJson("shenbingtianfu"),vi.SbTianFuVo)),this.getResJson("shenbingtep")&&(n.sb_tep=this.initVo4Json(this.getResJson("shenbingtep"),fi.SbTepVo)),this.getResJson("shenbingtask")&&(n.sb_task=this.initVo4Json(this.getResJson("shenbingtask"),yi.SbTaskVo)),this.getResJson("shenbingport")&&(n.sb_port=this.initVo4Json(this.getResJson("shenbingport"),mi.SbPortVo)),this.getResJson("shenbinghuanjing")&&(n.sb_setting=this.initVo4Json(this.getResJson("shenbinghuanjing"),_i.SbSettingVo)),this.getResJson("shenbingexp")&&(n.sb_exp=this.initVo4Json(this.getResJson("shenbingexp"),gi.SbExpVo)),this.getResJson("port_shenbing")&&(n.sbPortInfoJson=this.initVo4Json(this.getResJson("port_shenbing"),Ci.SbPortInfoVo)),this.getResJson("quality")&&this.initVo4Json(this.getResJson("quality"),Ai.QualityVo),this.getResJson("target")&&this.initVo4Json(this.getResJson("target"),Si.TargetVo),this.getResJson("skilltips")&&this.initVo4Json(this.getResJson("skilltips"),Ti.SkillTipsVo),this.getResJson("hunyin")&&(n.hunyin=this.initVo4Json(this.getResJson("hunyin"),me.HunYinVo)),this.getResJson("hunyincost")&&(n.hunyincost=this.initVo4Json(this.getResJson("hunyincost"),me.HunYinCostVo)),this.getResJson("hunyinprop")&&(n.hunyinProp=this.initVo4Json(this.getResJson("hunyinprop"),me.HunYinPropVo)),this.getResJson("heskillcost")&&this.initVo4Json(this.getResJson("heskillcost"),me.HeSkillCostVo),this.getResJson("cardbooklist")&&(n.cardlist=this.initVo4Json(this.getResJson("cardbooklist"),Ae.CardListVo)),this.getResJson("carddecompose")&&(n.carddecompose=this.initVo4Json(this.getResJson("carddecompose"),Re.CardVo)),this.getResJson("cardlevel")&&this.initVo4Json(this.getResJson("cardlevel"),Le.CardLevelVo),this.getResJson("rexieneishitaozhuang")&&(n.rexue_suit_neishi=this.initVo4Json(this.getResJson("rexieneishitaozhuang"),ci.ReXueOrSuitVo)),this.getResJson("fuwenTrough")&&(n.fuwenTrough=this.initVo4Json(this.getResJson("fuwenTrough"),ke.FuWenTroughVo)),this.getResJson("rexiezhuangbeicao")&&(n.rexuecaoopen=this.initVo4Json(this.getResJson("rexiezhuangbeicao"),hi.ReXueCaoOpen)),this.getResJson("ringopen")&&(n.openRing=this.initVo4Json(this.getResJson("ringopen"),ve.TeJieVo)),this.getResJson("ringtask")&&(n.ringtask=this.initVo4Json(this.getResJson("ringtask"),Oe.TeJieTaskVo)),this.getResJson("shenqi")&&(n.relic=this.initVo4Json(this.getResJson("shenqi"),se.RelicVo)),this.getResJson("shenqisuipian")&&(n.relicDebris=this.initVo4Json(this.getResJson("shenqisuipian"),He.RelicDebrisVo)),this.getResJson("zhanwenequip")&&this.initVo4Json(this.getResJson("zhanwenequip"),ce.ZhanWenVo),this.getResJson("oltima")&&(n.OnLineReward=this.initVo4Json(this.getResJson("oltima"),ne.OnLineRewardvo)),this.getResJson("dart")&&(n.Dart=this.initVo4Json(this.getResJson("dart"),Jt.DartVo)),this.getResJson("dartconfig")&&(n.DartConfig=this.initVo4Json(this.getResJson("dartconfig"),Wt.DartConfigVo)),this.getResJson("ruledesc")&&(n.Ruledesc=this.initVo4Json(this.getResJson("ruledesc"),zt.RuledescVo)),this.getResJson("familysetting")&&(n.FamilySettingVo=this.initFamilySetting(this.getResJson("familysetting"))),this.getResJson("familylevel")&&(n.FamilyLevel=this.initVo4Json(this.getResJson("familylevel"),u.FamilyLevelVo)),this.getResJson("familymijing")&&(n.FamilyMiJing=this.initVo4Json(this.getResJson("familymijing"),c.FamilyMiJingVo)),this.getResJson("familyorder")&&(n.FamilyOrder=this.initVo4Json(this.getResJson("familyorder"),h.FamilyOrderVo)),this.getResJson("familyskills")&&(n.FamilySkills=this.initVo4Json(this.getResJson("familyskills"),l.FamilySkillsVo)),this.getResJson("familytask")&&(n.FamilyTask=this.initVo4Json(this.getResJson("familytask"),r.FamilyTaskVo)),this.getResJson("hunyinrenwu1")&&(n.hunTask=this.initVo4Json(this.getResJson("hunyinrenwu1"),We.HunTaskVo)),this.getResJson("hunyinrenwu2")&&(n.hunSubTask=this.initVo4Json(this.getResJson("hunyinrenwu2"),ze.HunSubTaskVo)),this.getResJson("rexiehunshitaozhuang")&&(n.rexue_suit_hunshi=this.initVo4Json(this.getResJson("rexiehunshitaozhuang"),ui.ReXueStSuitVo)),this.getResJson("helpertype")&&this.initHelperTypeVo(this.getResJson("helpertype")),this.getResJson("guideGift")&&this.initHelperVo(this.getResJson("guideGift")),this.getResJson("item")&&(n.itemJSON=this.initItem(this.getResJson("item"))),this.getResJson("equip")&&(n.equipJSON=this.initEquip(this.getResJson("equip"))),this.getResJson("equipsuit")&&this.initVo4Json(this.getResJson("equipsuit"),S.EquipSuitVo),this.getResJson("guide")&&(n.guideJSON=this.initVo4Json(this.getResJson("guide"),G.GuideVo)),this.getResJson("task")&&(n.taskJSON=this.initVo4Json(this.getResJson("task"),B.TaskVo)),this.getResJson("UIEffects")&&(n.UIEffects=this.initVo4Json(this.getResJson("UIEffects"),L.UIEffectsVo)),this.getResJson("NPC")&&(n.NPCJSON=this.initVo4Json(this.getResJson("NPC"),U.NPCVo)),this.getResJson("player")&&(n.playerJSON=this.initVo4Json(this.getResJson("player"),tt.PlayerVo)),this.getResJson("playsetting")&&(n.playsettingJSON=this.initVo4Json(this.getResJson("playsetting"),De.PlaysettingVo)),this.getResJson("port")&&(n.portJSON=this.initPort(this.getResJson("port"))),this.getResJson("map")&&(n.mapJSON=this.initMap(this.getResJson("map"))),this.getResJson("skill")&&(n.skillJSON=this.initSkill(this.getResJson("skill"))),this.getResJson("passive")&&(n.PassiveJson=this.initPassiveVo(this.getResJson("passive"))),this.getResJson("pet")&&(n.petJSON=this.initVo4Json(this.getResJson("pet"),$.PetVo)),this.getResJson("client_randomname")&&(n.randomJSON=this.initRandomName(this.getResJson("client_randomname"))),this.getResJson("winglevel")&&(n.winglevelJSON=this.initVo4Json(this.getResJson("winglevel"),lt.WingLevelVo)),this.getResJson("mainbutton")&&(n.MainButton=this.initMainButton(this.getResJson("mainbutton"))),this.getResJson("blesssuit")&&(n.BlessMaster=this.initBlessMaster(this.getResJson("blesssuit"))),this.getResJson("wingequip")&&(n.wingEquipJSON=this.initWingEquip(this.getResJson("wingequip"))),this.getResJson("wingsuit")&&(n.WingSuit=this.initVo4Json(this.getResJson("wingsuit"),p.WingSuitVo)),this.getResJson("wingpassive")&&(n.WingPassiveJson=this.initVo4Json(this.getResJson("wingpassive"),Pt.WingPassiveVo)),this.getResJson("zhuzai")&&(n.ZhuZaiJson=this.initZhuZaiJson(this.getResJson("zhuzai"))),this.getResJson("zhuzai")&&(n.suitJSON=this.initVo4Json(this.getResJson("zhuzai"),rt.SuitVo)),this.getResJson("bosssetting")&&(n.BossSetting=this.initVo4Json(this.getResJson("bosssetting"),wt.BossSettingVo)),this.getResJson("passivesetting")&&(n.PassiveConfig=this.initPassiveConfig(this.getResJson("passivesetting"))),this.getResJson("jingmaiconfig")&&(n.JingMaiConfig=this.initJingMaiConfig(this.getResJson("jingmaiconfig"))),this.getResJson("zhuanshengsettings")&&(n.ZSSetting=this.initZhuanShengSetting(this.getResJson("zhuanshengsettings"),0)),this.getResJson("shuxing")&&(n.ShuXing_Json=this.initVo4Json(this.getResJson("shuxing"),T.ShuXingVo)),this.getResJson("longsoul")&&(n.longsoulJSON=this.initVo4Json(this.getResJson("longsoul"),Q.DragonScalesVo)),this.getResJson("shield")&&(n.Shield=this.initVo4Json(this.getResJson("shield"),A.ShieldVo)),this.getResJson("buff")&&(n.BuffJson=this.initVo4Json(this.getResJson("buff"),ut.BuffVo)),this.getResJson("newroleconfig")&&(n.NewRoleConfig=this.initVo4Json(this.getResJson("newroleconfig"),_.NewRoleConfigVo)),this.getResJson("activetask")&&(n.activeTaskJSON=this.initVo4Json(this.getResJson("activetask"),M.ActiveTaskVo)),this.getResJson("currency")&&(n.currencyJSON=this.initVo4Json(this.getResJson("currency"),H.CurrencyVo)),this.getResJson("bagcost")&&(n.BagCostJson=this.initVo4Json(this.getResJson("bagcost"),P.BagCostVo)),this.getResJson("bless")&&(n.blessJSON=this.initVo4Json(this.getResJson("bless"),Y.BlessVo)),this.getResJson("bossmeeting")&&(n.bossmeetingJSON=this.initVo4Json(this.getResJson("bossmeeting"),j.BossmeetingVo)),this.getResJson("equipenhance")&&(n.equipenhanceJSON=this.initVo4Json(this.getResJson("equipenhance"),J.EquipEnHanceVo)),this.getResJson("equipsoul")&&(n.equipsoulJSON=this.initVo4Json(this.getResJson("equipsoul"),D.EquipSoulVo)),this.getResJson("equipfuling")&&(n.equipSpiritJSON=this.initVo4Json(this.getResJson("equipfuling"),$t.EquipSpiritVo)),this.getResJson("hero")&&(n.heroJSON=this.initVo4Json(this.getResJson("hero"),W.HeroVo)),this.getResJson("jingmailevel")&&(n.jingmailevelJSON=this.initVo4Json(this.getResJson("jingmailevel"),z.MeridianLevelVo)),this.getResJson("jingmaistage")&&(n.jingmaistageJSON=this.initVo4Json(this.getResJson("jingmaistage"),X.MeridianStageVo)),this.getResJson("notice")&&(n.noticeJSON=this.initVo4Json(this.getResJson("notice"),Z.NoticeVo)),this.getResJson("playersetting")&&(n.playersettingJSON=this.initPlayerSetting(this.getResJson("playersetting"))),this.getResJson("power")&&(n.powerJSON=this.initVo4Json(this.getResJson("power"),it.PowerVo)),this.getResJson("ring1")&&(n.ring1JSON=this.initVo4Json(this.getResJson("ring1"),nt.Ring1Vo)),this.getResJson("ring2")&&(n.ring2JSON=this.initVo4Json(this.getResJson("ring2"),st.Ring2Vo)),this.getResJson("ring3")&&(n.ring3JSON=this.initVo4Json(this.getResJson("ring3"),pn.Ring3Vo)),this.getResJson("ring4")&&(n.ring4JSON=this.initVo4Json(this.getResJson("ring4"),dn.Ring4Vo)),this.getResJson("robot")&&(n.robotJSON=this.initVo4Json(this.getResJson("robot"),ot.RobotVo)),this.getResJson("skillsetting")&&(n.skillsettingJSON=this.initVo4Json(this.getResJson("skillsetting"),at.SkillSettingVo)),this.getResJson("rexieshuxing")&&(n.rexue_attr=this.initVo4Json(this.getResJson("rexieshuxing"),ni.ReXueAttrVo)),this.getResJson("rexiehunshi")&&(n.rexue_stone=this.initVo4Json(this.getResJson("rexiehunshi"),si.ReXueStoneVo)),this.getResJson("rexiezhuangbei")&&(n.rexue_equip=this.initVo4Json(this.getResJson("rexiezhuangbei"),oi.ReXueEquipVo)),this.getResJson("rexieneishi")&&(n.rexue_ornament=this.initVo4Json(this.getResJson("rexieneishi"),ai.ReXueOrnamentVo)),this.getResJson("rexiestaozhuang")&&(n.rexue_suit=this.initVo4Json(this.getResJson("rexiestaozhuang"),ri.ReXueSuitVo)),this.getResJson("wingstar")&&(n.wingstarJSON=this.initVo4Json(this.getResJson("wingstar"),ht.WingStarVo)),this.getResJson("zhuansheng")&&(n.zhuanshengJSON=this.initVo4Json(this.getResJson("zhuansheng"),ct.ZhuanShengVo)),this.getResJson("wingconfig")&&(n.WingConfigJson=this.initVo4Json(this.getResJson("wingconfig"),k.WingConfigVo)),this.getResJson("stone")&&(n.stoneJSON=this.initVo4Json(this.getResJson("stone"),x.StoneVo)),this.getResJson("boss")&&(n.bossjson=this.initVo4Json(this.getResJson("boss"),R.BossVo)),this.getResJson("meetrankreward")&&(n.meetrankrewardJSON=this.initVo4Json(this.getResJson("meetrankreward"),w.MeetrankrewardVo)),this.getResJson("copymaterial")&&(n.copymaterialJSON=this.initVo4Json(this.getResJson("copymaterial"),b.CopymaterialVo)),this.getResJson("shop1")&&(n.Shop1JSON=this.initVo4Json(this.getResJson("shop1"),I.Shop1Vo)),this.getResJson("shop2")&&(n.Shop2JSON=this.initVo4Json(this.getResJson("shop2"),ft.Shop2Vo)),this.getResJson("shop3")&&(n.Shop3JSON=this.initVo4Json(this.getResJson("shop3"),vt.Shop3Vo)),this.getResJson("title")&&(n.titleJSON=this.initVo4Json(this.getResJson("title"),yt.TitleVo)),this.getResJson("rankconfig")&&(n.rankconfigJSON=this.initVo4Json(this.getResJson("rankconfig"),C.RankConfigVo)),this.getResJson("chop")&&(n.chopJSON=this.initVo4Json(this.getResJson("chop"),y.ChopVo)),this.getResJson("lotterysetting")&&(n.lotterySettingJSON=this.initVo4Json(this.getResJson("lotterysetting"),_t.LotteryVo)),this.getResJson("wingequip")&&(n.wingEquipJSON=this.initVo4Json(this.getResJson("wingequip"),Ct.WingEquipVo)),this.getResJson("port_quanmin")&&(n.port_quanminJSON=this.initVo4Json(this.getResJson("port_quanmin"),It.Port_quanminVo)),this.getResJson("port_shen")&&(n.port_shenyuJSON=this.initVo4Json(this.getResJson("port_shen"),At.Port_shenyuVo)),this.getResJson("mail")&&(n.mailJSON=this.initVo4Json(this.getResJson("mail"),bt.MailVo)),this.getResJson("blesssuit")&&(n.blessSuit=this.initVo4Json(this.getResJson("blesssuit"),Ee.BlessSuitVo)),this.getResJson("dailysign")&&(n.signJSON=this.initVo4Json(this.getResJson("dailysign"),Et.SignVo)),this.getResJson("vip")&&(n.vipJSON=this.initVo4Json(this.getResJson("vip"),Tt.VipVo)),this.getResJson("port_zhuansheng")&&(n.Port_zhuanshengJSON=this.initVo4Json(this.getResJson("port_zhuansheng"),d.Port_zhuanshengVo)),this.getResJson("port_zhuanshengrank")&&(n.Port_zhuanshengRankJSON=this.initVo4Json(this.getResJson("port_zhuanshengrank"),Zt.Port_zhuanshengrankVo)),this.getResJson("artifacts")&&(n.artifactsJSON=this.initVo4Json(this.getResJson("artifacts"),Rt.ArtifactsVo)),this.getResJson("artifactslevel")&&(n.artifactsLevelJSON=this.initVo4Json(this.getResJson("artifactslevel"),Lt.ArtifactsLevelVo)),this.getResJson("kingsetting")&&(n.kingSettingJSON=this.initVo4Json(this.getResJson("kingsetting"),xt.KingSettingVo)),this.getResJson("kingrankreward")&&(n.kingRankRewards=this.initVo4Json(this.getResJson("kingrankreward"),Ht.KingRankRewardVo)),this.getResJson("king")&&(n.KingVo=this.initVo4Json(this.getResJson("king"),Dt.KingVo)),this.getResJson("expression")&&(n.expression=this.initVo4Json(this.getResJson("expression"),Mt.ExpressVo)),this.getResJson("achieve")&&(n.achieve=this.initVo4Json(this.getResJson("achieve"),Bt.AchieveVo)),this.getResJson("medal")&&(n.medal=this.initVo4Json(this.getResJson("medal"),Nt.MedalVo)),this.getResJson("meetsetting")&&(n.meetsetting=this.initVo4Json(this.getResJson("meetsetting"),Ut.MeetsettingVo)),this.getResJson("activity1")&&(n.activityJson=this.initVo4Json(this.getResJson("activity1"),Vt.ActivityVo)),this.getResJson("activity2")&&(n.subActivityJson=this.initVo4Json(this.getResJson("activity2"),Ot.SubActivityVo)),this.getResJson("activityRank")&&(n.activityRankJson=this.initVo4Json(this.getResJson("activityRank"),Ft.ActivityRankVo)),this.getResJson("recharge")&&(n.rechargeJson=this.initVo4Json(this.getResJson("recharge"),qt.RechargeVo)),this.getResJson("SandyCitySetting")&&(n.sandyCitySettingJson=this.initVo4Json(this.getResJson("SandyCitySetting"),Kt.SandyCitySettingVo)),this.getResJson("ruledesc2")&&(n.ruledesc2JSON=this.getResJson("ruledesc2")),this.getResJson("SandyCityRank")&&(n.sandyCityRankJson=this.initVo4Json(this.getResJson("SandyCityRank"),Yt.SandyCityRankVo)),this.getResJson("fashion")&&(n.fashionJson=this.initVo4Json(this.getResJson("fashion"),jt.FashionVo)),this.getResJson("fashionstar")&&(n.fashionstar=this.initVo4Json(this.getResJson("fashionstar"),fn.FashionStarVo)),this.getResJson("dart")&&(n.dartJSON=this.initVo4Json(this.getResJson("dart"),Jt.DartVo)),this.getResJson("dartconfig")&&(n.dartConfigJSON=this.initVo4Json(this.getResJson("dartconfig"),Wt.DartConfigVo)),this.getResJson("bosscall")&&(n.bossCallJson=this.initVo4Json(this.getResJson("bosscall"),Xt.BossCallVo)),this.getResJson("port_call")&&(n.portCallJson=this.initVo4Json(this.getResJson("port_call"),Qt.PortCallVo)),this.getResJson("maincityelement")&&(n.mainCityElesJson=this.initVo4Json(this.getResJson("maincityelement"),te.MainCityEleVo)),this.getResJson("meetreward")&&(n.meetrewardJson=this.initVo4Json(this.getResJson("meetreward"),ee.MeetRewardVo)),this.getResJson("chatTemplate")&&(n.chatTemplateJson=this.initVo4Json(this.getResJson("chatTemplate"),ie.ChatTemplateVo)),this.getResJson("dafuweng")&&(n.monopolyJson=this.initVo4Json(this.getResJson("dafuweng"),oe.MonopolyVo)),this.getResJson("dafuwengbox")&&(n.monopolyBoxJson=this.initVo4Json(this.getResJson("dafuwengbox"),ae.MonopolyBoxVo)),this.getResJson("z7z8")&&(n.commonJson=this.initVo4Json(this.getResJson("z7z8"),re.CommonVo)),this.getResJson("materialport")&&(n.materialport=this.initVo4Json(this.getResJson("materialport"),le.MaterialportVo)),this.getResJson("medal2")&&(n.medalStarJson=this.initVo4Json(this.getResJson("medal2"),he.MedalStarVo)),this.getResJson("fengshen")&&(n.fengshenJson=this.initVo4Json(this.getResJson("fengshen"),ue.FengshenVo)),this.getResJson("pagoda")&&(n.pagodaJson=this.initVo4Json(this.getResJson("pagoda"),ge.PagodaVo)),this.getResJson("port_pagoda")&&(n.pagodaLayerJson=this.initVo4Json(this.getResJson("port_pagoda"),pe.PagodaLayerVo)),this.getResJson("zhuanpan")&&(n.pagodaTurntableJson=this.initVo4Json(this.getResJson("zhuanpan"),de.PagodaTurntableVo)),this.getResJson("vipboss")&&(n.port_vipbossJSON=this.initVo4Json(this.getResJson("vipboss"),_e.VipBossVo)),this.getResJson("xianshirenwu1")&&(n.timeLimitTaskJson=this.initVo4Json(this.getResJson("xianshirenwu1"),fe.TimeLimitTaskVo)),this.getResJson("xianshirenwu2")&&(n.timeLimitSubTaskJson=this.initVo4Json(this.getResJson("xianshirenwu2"),ye.TimeLimitSubTaskVo)),this.getResJson("fuwencishu")&&(n.fuwenBoxJson=this.initVo4Json(this.getResJson("fuwencishu"),Ce.FuWenBoxVo)),this.getResJson("gongnengkaiqi1")&&(n.accessCtrlCfg=this.initVo4Json(this.getResJson("gongnengkaiqi1"),Ie.AccessCfgVo)),this.getResJson("choptask")&&(n.chopTaskCfg=this.initVo4Json(this.getResJson("choptask"),be.ChopTaskVo)),this.getResJson("robotNPC")&&(n.robotNpcCfg=this.initVo4Json(this.getResJson("robotNPC"),Te.RobotNpcVo)),this.getResJson("expgamecard")&&(n.EXPAttributeCard=this.initVo4Json(this.getResJson("expgamecard"),we.EXPAttributeCardVo)),this.getResJson("expgameSetting")&&(n.EXPEnviroment=this.initVo4Json(this.getResJson("expgameSetting"),Se.EXPEnviromentVo)),this.getResJson("expgamebuff")&&(n.ExpGameBuff=this.initVo4Json(this.getResJson("expgamebuff"),Pe.ExpGameBuffVo)),this.getResJson("pkboxconfig")&&(n.pkconfig=this.initVo4Json(this.getResJson("pkboxconfig"),Me.PkConfigVo)),this.getResJson("pkbox")&&(n.pkbox=this.initVo4Json(this.getResJson("pkbox"),Ge.PKBoxVo)),this.getResJson("hunyinboss")&&(n.hunyinboss=this.initVo4Json(this.getResJson("hunyinboss"),Be.HunYinVoBoss)),this.getResJson("activityshop")&&(n.activityShop=this.initVo4Json(this.getResJson("activityshop"),Ue.ActivityShopVo)),this.getResJson("activitywheel")&&(n.activityWheelJson=this.initVo4Json(this.getResJson("activitywheel"),Ve.ActivityWheelVo)),this.getResJson("bossCrit")&&(n.bossCrit=this.initVo4Json(this.getResJson("bossCrit"),qe.BossCritVo)),this.getResJson("answerconfig")&&(n.answerconfig=this.initVo4Json(this.getResJson("answerconfig"),Fe.AnswerConfig)),this.getResJson("answerrankreward")&&(n.answerrankrewardvo=this.initVo4Json(this.getResJson("answerrankreward"),Fe.AnswerConfig)),this.getResJson("answer")&&(n.answervo=this.initVo4Json(this.getResJson("answer"),Fe.AnswerVo)),this.getResJson("pointsetting")&&(n.pointSettingVo=this.initVo4Json(this.getResJson("pointsetting"),Ke.PointSettingVo)),this.getResJson("pointaward")&&(n.pointAwardVo=this.initVo4Json(this.getResJson("pointaward"),Je.PointAwardVo)),this.getResJson("rexiezhanchang")&&(n.rexiezhanchangVo=this.initVo4Json(this.getResJson("rexiezhanchang"),ei.ReXieZhanChangeVo)),this.getResJson("kfrx")&&(n.kfrxvo=this.initVo4Json(this.getResJson("kfrx"),qi.KFRXVo)),this.getResJson("multiserverBOSS")&&(n.crossSvrBossVo=this.initVo4Json(this.getResJson("multiserverBOSS"),Ri.MultiSvrBossVo)),this.getResJson("rexiezhanchangSetting")&&(n.rexiezhanchangSettingVo=this.initVo4Json(this.getResJson("rexiezhanchangSetting"),ii.ReXieZhanChangSettingVo)),this.getResJson("kfrxSetting")&&(n.KFRXSettingVo=this.initVo4Json(this.getResJson("kfrxSetting"),ii.KFRXSettingVo)),this.getResJson("kfsdSetting")&&(n.KFSDRXSettingVo=this.initVo4Json(this.getResJson("kfsdSetting"),ii.KFSDSettingVo)),this.getResJson("multiserverBOSSsetting")&&(n.msBOSSsettingVo=this.initVo4Json(this.getResJson("multiserverBOSSsetting"),Pi.MultiserverBOSSsettingVo)),this.getResJson("kftb")&&(n.kftvo=this.initVo4Json(this.getResJson("kftb"),$i.KFTVo)),this.getResJson("kftbSetting")&&(n.kftsetting=this.initVo4Json(this.getResJson("kftbSetting"),ii.KFTSettingVo)),this.getResJson("kftbworldmap")&&(n.kfTBWorldMapVo=this.initVo4Json(this.getResJson("kftbworldmap"),$i.KFTBWorldMapVo)),this.getResJson("nightcitysetting")&&(n.nightCitySettingVo=this.initVo4Json(this.getResJson("nightcitysetting"),Ii.NightCitySettingVo)),this.getResJson("channelgift")&&(n.cGift=this.initVo4Json(this.getResJson("channelgift"),en.ChannelGiftVo)),this.getResJson("paimai")&&(n.auctionsJson=this.initVo4Json(this.getResJson("paimai"),Ye.AuctionsVo)),this.getResJson("paimaisetting")&&(n.auctionsSettingJson=this.initVo4Json(this.getResJson("paimaisetting"),je.AuctionsSettingVo)),this.getResJson("paimaiattention")&&(n.auctionsAttentionJson=this.initVo4Json(this.getResJson("paimaiattention"),Qe.AuctionsAttentionVo)),this.getResJson("timingactivity")&&(n.timingActivity=this.initVo4Json(this.getResJson("timingactivity"),Xe.TimingActivityVO)),this.getResJson("aegislevel")&&(n.aegisLevelJson=this.initVo4Json(this.getResJson("aegislevel"),Ze.AegisLevelVo)),this.getResJson("aegisstar")&&(n.aegisStarJson=this.initVo4Json(this.getResJson("aegisstar"),$e.AegisStarVo)),this.getResJson("aegistask")&&(n.aegisTaskJson=this.initVo4Json(this.getResJson("aegistask"),ti.AegisTaskVo)),this.getResJson("aegistask1")&&(n.aegisTaskGroupJson=this.initVo4Json(this.getResJson("aegistask1"),li.AegisTaskGroupVo)),this.getResJson("port_rexieshengdian")&&(n.hbtempleJson=this.initVo4Json(this.getResJson("port_rexieshengdian"),pi.HBTemplePortVo)),this.getResJson("port_worldboss")&&(n.worldBossVo=this.initVo4Json(this.getResJson("port_worldboss"),di.WorldBossVo)),this.getResJson("nightcityrank")&&(n.nightCityRankVo=this.initVo4Json(this.getResJson("nightcityrank"),wi.NightCityRankVo)),this.getResJson("portplot")&&(n.portPlotJson=this.initVo4Json(this.getResJson("portplot"),Ei.PortPlotVo)),this.getResJson("game_event")&&(n.gameEventVoCfg=this.initVo4Json(this.getResJson("game_event"),Vi.GameEventVo)),this.getResJson("moneyreward")&&(n.moneyRewardVoCfg=this.initVo4Json(this.getResJson("moneyreward"),ji.MoneyRewardVo)),this.getResJson("amazinggift")&&(n.lotteryDrawVoCfg=this.initVo4Json(this.getResJson("amazinggift"),Qi.LotteryDrawVo)),this.getResJson("godpet")&&(n.godpet=this.initVo4Json(this.getResJson("godpet"),zi.GodPet)),this.getResJson("godpetskill")&&(n.godpetskill=this.initVo4Json(this.getResJson("godpetskill"),zi.GodPetSkill)),this.getResJson("godpetsetting")&&(n.godpetseting=this.initVo4Json(this.getResJson("godpetsetting"),zi.GodSetting)),this.getResJson("shopsetting")&&(n.shopSettingVoCfg=this.initVo4Json(this.getResJson("shopsetting"),Zi.ShopSettingVo)),this.getResJson("fumo")&&(n.fumoVoCfg=this.initVo4Json(this.getResJson("fumo"),tn.FuMoVo)),this.getResJson("kfsd")&&(n.kfsdvo=this.initVo4Json(this.getResJson("kfsd"),an.KFSDVo)),this.getResJson("kfjjcsetting")&&(n.kfjjcVoCfg=this.initVo4Json(this.getResJson("kfjjcsetting"),gn.KfjjcCfgVo)),this.getResJson("kfjjcreward")&&(n.kfjjcRewardVoCfg=this.initVo4Json(this.getResJson("kfjjcreward"),vn.KfjjcRewardCfgVo)),this.getResJson("guanghuan")&&(n.Rygh=this.initVo4Json(this.getResJson("guanghuan"),yn.RyghVo)),this.getResJson("sharereward")&&(n.shareRewardJSON=this.initVo4Json(this.getResJson("sharereward"),rn.ShareSeekHelpVo)),this.getResJson("share")&&(n.shareJSON=this.initVo4Json(this.getResJson("share"),ln.ShareVo)),this.getResJson("shareshop")&&(n.shareShopJSON=this.initVo4Json(this.getResJson("shareshop"),hn.ShareShopVo)),this.getResJson("teamcopymaterial")&&(n.teamCopyVoCfg=this.initVo4Json(this.getResJson("teamcopymaterial"),In.TeamCopyVo)),this.getResJson("teamcopySetting")&&(n.teamCopySettingVoCfg=this.initVo4Json(this.getResJson("teamcopySetting"),Cn.TeamCopySettingVo)),this.getResJson("shenweiyurank")&&(n.shenweiyuRankVo=this.initVo4Json(this.getResJson("shenweiyurank"),bn.ShenWeiYuRankVo)),this.getResJson("shenweiyu")&&(n.shenweiyuCfg=this.initVo4Json(this.getResJson("shenweiyu"),wn.ShenweiyuVo)),this.getResJson("gongnengrongduan")&&(n.accessRongDuanCfg=this.initVo4Json(this.getResJson("gongnengrongduan"),Tn.AccessRongDuanVo)),this.getResJson("shouhun")&&(n.petSoulJSON=this.initVo4Json(this.getResJson("shouhun"),An.PetSoulVo)),this.getResJson("general")&&(n.sj=this.initVo4Json(this.getResJson("general"),Rn.SjVo)),this.getResJson("generalsuit")&&(n.sjSuit=this.initVo4Json(this.getResJson("generalsuit"),Ln.SjSuitVo)),this.getResJson("generallevel")&&(n.sjEqUp=this.initVo4Json(this.getResJson("generallevel"),xn.SjEqUpVo)),this.getResJson("roughskill")&&(n.roughSkillCfg=this.initVo4Json(this.getResJson("roughskill"),Pn.RoughSkillVo)),this.getResJson("roughgloves")&&(n.roughGlovesCfg=this.initVo4Json(this.getResJson("roughgloves"),kn.RoughGlovesVo)),this.getResJson("roughgloves")&&(n.roughStrongCfg=this.initVo4Json(this.getResJson("roughstrong"),Dn.RoughStrongVo)),this.getResJson("roughgloves")&&(n.roughSuitCfg=this.initVo4Json(this.getResJson("roughsuit"),Hn.RoughSuitVo)),this.getResJson("roughgloves")&&(n.roughcopy=this.initVo4Json(this.getResJson("roughcopy"),Mn.RoughCopyVo)),this.getResJson("forbidarts")&&(n.ShenQiJson=this.initVo4Json(this.getResJson("forbidarts"),Gn.ShenQiVo)),this.getResJson("forbidartslevel")&&(n.ShenQiLevelJson=this.initVo4Json(this.getResJson("forbidartslevel"),Bn.ShenQiLevelVo)),this.getResJson("forbidartsstarlevel")&&(n.ShenQiStarLevelJson=this.initVo4Json(this.getResJson("forbidartsstarlevel"),Nn.ShenQiStarLevelVo)),this.getResJson("kfsqjd")&&(n.kfsqjdVo=this.initVo4Json(this.getResJson("kfsqjd"),Un.KFSQJDVo)),this.getResJson("kfsqjdSetting")&&(n.KFSQJDSettingVo=this.initVo4Json(this.getResJson("kfsqjdSetting"),Un.KFSQJDSettingVo)),this.getResJson("feisheng")&&(n.feishengjson=this.initVo4Json(this.getResJson("feisheng"),Kn.FeiShengVo)),this.getResJson("fsequip")&&(n.fsequipjson=this.initVo4Json(this.getResJson("fsequip"),Yn.FsEquipVo)),this.getResJson("fsequipbreach")&&(n.fsequipbreachjson=this.initVo4Json(this.getResJson("fsequipbreach"),qn.FsEquipBreachVo)),this.getResJson("fsequipstrong")&&(n.fsequipstrongjson=this.initVo4Json(this.getResJson("fsequipstrong"),Jn.FsEquipStrongVo)),this.getResJson("fsequipsuit")&&(n.fsequipsuitjson=this.initVo4Json(this.getResJson("fsequipsuit"),jn.FsEquipSuitVo)),this.getResJson("kfzy")&&(n.kfzyjson=this.initVo4Json(this.getResJson("kfzy"),Wn.KFZYBoss)),this.getResJson("kfzyseting")&&(n.kfzyseting=this.initVo4Json(this.getResJson("kfzyseting"),ii.KFZYsettingVo)),this.getResJson("bladeequip")&&(n.bladeequipjson=this.initVo4Json(this.getResJson("bladeequip"),Vn.BladeequipVo)),this.getResJson("bladelv")&&(n.bladelvjson=this.initVo4Json(this.getResJson("bladelv"),On.BladelvVo)),this.getResJson("bladeseting")&&(n.bladesetingjson=this.initVo4Json(this.getResJson("bladeseting"),Fn.BladesetingVo)),this.getResJson("zhuanshengsettings")&&(n.fsseting=this.initZhuanShengSetting(this.getResJson("zhuanshengsettings"),2)),this.getResJson("phantomlv")&&(n.HuanlingUp=this.initVo4Json(this.getResJson("phantomlv"),zn.HlUpVo)),this.getResJson("phantomhuan")&&(n.HuanlingHhUp=this.initVo4Json(this.getResJson("phantomhuan"),Xn.HlHhUpVo)),this.getResJson("phantomsetting")&&(n.HuanlingSetting=this.initVo4Json(this.getResJson("phantomsetting"),re.CommonVo)),Laya.timer.once(1,this,this.monsterJoson)}),null,Laya.Loader.JSON)},a.prototype.monsterJoson=function(){this._monsterResVOLoader=new bi.VoAsyncLoader(V.MoResVo,Laya.Handler.create(this,this.onLoadedMonsterRes),this.getResJson("monsteRes")).load()},a.prototype.onPerloadComplet=function(){window.isNewLogin&&mn.gameSdk.Ins.sdk.customEventApp("step5_configjson"),console.log("configjsonstart",Laya.Browser.now());var t=gt.GameConfig;t.SoundJSON=this.initVo4Json(this.getResJson("sound"),_n.SoundVo),t.lang=this.initVo4Json(this.getResJson("lang_zh"),Ji.LangVo),t.MonsterLang=this.initVo4Json(this.getResJson("monsterlang"),cn.MonsterLangVo),t.skillOpen=this.initVo4Json(this.getResJson("specialskillopen"),Xi.SkillOpenVo),Wi.TextConst.initTextDic(),t.SSLv=this.initVo4Json(this.getResJson("sslevel"),nn.SsLvVo),t.SSEquip=this.initVo4Json(this.getResJson("ssequip"),on.SsEVo),t.SSEquipSuit=this.initVo4Json(this.getResJson("ssequipsuit"),sn.SsESuitVo),t.SSequipenhance=this.initVo4Json(this.getResJson("ssequipenhance"),un.SsStrongVo),t.SSSetting=this.initZhuanShengSetting(this.getResJson("zhuanshengsettings"),1),t.xwequip=this.initVo4Json(this.getResJson("xwequip"),Oi.XwEVo),t.xwProp=this.initVo4Json(this.getResJson("xwequipporp"),Ki.XwPropVo),t.xwequipsuit=this.initVo4Json(this.getResJson("xwequipsuit1"),Fi.XwEsVo),t.xwequipenhance=this.initVo4Json(this.getResJson("xwequipenhance"),Yi.XwStrongVo),t.xwZ7z8=this.initVo4Json(this.getResJson("xwequipsetting"),re.CommonVo),t.HuanlingUp=this.initVo4Json(this.getResJson("phantomlv"),zn.HlUpVo),t.HuanlingHhUp=this.initVo4Json(this.getResJson("phantomhuan"),Xn.HlHhUpVo),t.HuanlingSetting=this.initVo4Json(this.getResJson("phantomsetting"),re.CommonVo),t.rexue_ornament_comp=this.initVo4Json(this.getResJson("rexueneishihecheng"),Ni.ReXueOrCompVo),t.zltype=this.initVo4Json(this.getResJson("zhanling"),Hi.ZlTypeVo),t.zldrug=this.initVo4Json(this.getResJson("zhanlingdrug"),Gi.ZlDrugVo),t.zlskill=this.initVo4Json(this.getResJson("zhanlingskill"),Mi.ZlSkillVo),t.zlstar=this.initVo4Json(this.getResJson("zhanlingstar"),Bi.ZlStarVo),t.zlcopy=this.initVo4Json(this.getResJson("zlcopy"),Ui.ZlCopyVo),t.sysuit=this.initVo4Json(this.getResJson("shenyusuit"),ki.SySuitVo),t.sylevel=this.initVo4Json(this.getResJson("shenyulevel"),Di.SyLevelVo),t.sb_equip=this.initVo4Json(this.getResJson("shenbingequip"),xi.SbEquipVo),t.sb_hecheng=this.initVo4Json(this.getResJson("shenbingshengwuhecheng"),Li.SbHechengVo),t.sb_tianfu=this.initVo4Json(this.getResJson("shenbingtianfu"),vi.SbTianFuVo),t.sb_tep=this.initVo4Json(this.getResJson("shenbingtep"),fi.SbTepVo),t.sb_task=this.initVo4Json(this.getResJson("shenbingtask"),yi.SbTaskVo),t.sb_port=this.initVo4Json(this.getResJson("shenbingport"),mi.SbPortVo),t.sb_setting=this.initVo4Json(this.getResJson("shenbinghuanjing"),_i.SbSettingVo),t.sb_exp=this.initVo4Json(this.getResJson("shenbingexp"),gi.SbExpVo),t.sbPortInfoJson=this.initVo4Json(this.getResJson("port_shenbing"),Ci.SbPortInfoVo),this.initVo4Json(this.getResJson("quality"),Ai.QualityVo),this.initVo4Json(this.getResJson("target"),Si.TargetVo),this.initVo4Json(this.getResJson("skilltips"),Ti.SkillTipsVo),t.hunyin=this.initVo4Json(this.getResJson("hunyin"),me.HunYinVo),t.hunyincost=this.initVo4Json(this.getResJson("hunyincost"),me.HunYinCostVo),t.hunyinProp=this.initVo4Json(this.getResJson("hunyinprop"),me.HunYinPropVo),this.initVo4Json(this.getResJson("heskillcost"),me.HeSkillCostVo),t.cardlist=this.initVo4Json(this.getResJson("cardbooklist"),Ae.CardListVo),t.carddecompose=this.initVo4Json(this.getResJson("carddecompose"),Re.CardVo),this.initVo4Json(this.getResJson("cardlevel"),Le.CardLevelVo),this.initVo4Json(this.getResJson("cardsuit"),xe.CardSuitVo),t.rexue_suit_neishi=this.initVo4Json(this.getResJson("rexieneishitaozhuang"),ci.ReXueOrSuitVo),t.fuwenTrough=this.initVo4Json(this.getResJson("fuwenTrough"),ke.FuWenTroughVo),t.rexuecaoopen=this.initVo4Json(this.getResJson("rexiezhuangbeicao"),hi.ReXueCaoOpen),t.openRing=this.initVo4Json(this.getResJson("ringopen"),ve.TeJieVo),t.ringtask=this.initVo4Json(this.getResJson("ringtask"),Oe.TeJieTaskVo),t.relic=this.initVo4Json(this.getResJson("shenqi"),se.RelicVo),t.relicDebris=this.initVo4Json(this.getResJson("shenqisuipian"),He.RelicDebrisVo),this.initVo4Json(this.getResJson("zhanwenequip"),ce.ZhanWenVo),t.OnLineReward=this.initVo4Json(this.getResJson("oltima"),ne.OnLineRewardvo),t.Dart=this.initVo4Json(this.getResJson("dart"),Jt.DartVo),t.DartConfig=this.initVo4Json(this.getResJson("dartconfig"),Wt.DartConfigVo),t.Ruledesc=this.initVo4Json(this.getResJson("ruledesc"),zt.RuledescVo),t.FamilySettingVo=this.initFamilySetting(this.getResJson("familysetting")),t.FamilyLevel=this.initVo4Json(this.getResJson("familylevel"),u.FamilyLevelVo),t.FamilyMiJing=this.initVo4Json(this.getResJson("familymijing"),c.FamilyMiJingVo),t.FamilyOrder=this.initVo4Json(this.getResJson("familyorder"),h.FamilyOrderVo),t.FamilySkills=this.initVo4Json(this.getResJson("familyskills"),l.FamilySkillsVo),t.FamilyTask=this.initVo4Json(this.getResJson("familytask"),r.FamilyTaskVo),t.hunTask=this.initVo4Json(this.getResJson("hunyinrenwu1"),We.HunTaskVo),t.hunSubTask=this.initVo4Json(this.getResJson("hunyinrenwu2"),ze.HunSubTaskVo),t.rexue_suit_hunshi=this.initVo4Json(this.getResJson("rexiehunshitaozhuang"),ui.ReXueStSuitVo),this.initHelperTypeVo(this.getResJson("helpertype")),this.initHelperVo(this.getResJson("guideGift")),t.itemJSON=this.initItem(this.getResJson("item")),t.equipJSON=this.initEquip(this.getResJson("equip")),this.initVo4Json(this.getResJson("equipsuit"),S.EquipSuitVo),t.guideJSON=this.initVo4Json(this.getResJson("guide"),G.GuideVo),t.taskJSON=this.initVo4Json(this.getResJson("task"),B.TaskVo),t.UIEffects=this.initVo4Json(this.getResJson("UIEffects"),L.UIEffectsVo),t.NPCJSON=this.initVo4Json(this.getResJson("NPC"),U.NPCVo),t.playerJSON=this.initVo4Json(this.getResJson("player"),tt.PlayerVo),t.playsettingJSON=this.initVo4Json(this.getResJson("playsetting"),De.PlaysettingVo),t.portJSON=this.initPort(this.getResJson("port")),t.mapJSON=this.initMap(this.getResJson("map")),t.skillJSON=this.initSkill(this.getResJson("skill")),t.PassiveJson=this.initPassiveVo(this.getResJson("passive")),t.petJSON=this.initVo4Json(this.getResJson("pet"),$.PetVo),t.randomJSON=this.initRandomName(this.getResJson("client_randomname")),t.winglevelJSON=this.initVo4Json(this.getResJson("winglevel"),lt.WingLevelVo),t.MainButton=this.initMainButton(this.getResJson("mainbutton")),t.BlessMaster=this.initBlessMaster(this.getResJson("blesssuit")),t.wingEquipJSON=this.initWingEquip(this.getResJson("wingequip")),t.WingSuit=this.initVo4Json(this.getResJson("wingsuit"),p.WingSuitVo),t.WingPassiveJson=this.initVo4Json(this.getResJson("wingpassive"),Pt.WingPassiveVo),t.ZhuZaiJson=this.initZhuZaiJson(this.getResJson("zhuzai")),t.suitJSON=this.initVo4Json(this.getResJson("zhuzai"),rt.SuitVo),t.BossSetting=this.initVo4Json(this.getResJson("bosssetting"),wt.BossSettingVo),t.PassiveConfig=this.initPassiveConfig(this.getResJson("passivesetting")),t.JingMaiConfig=this.initJingMaiConfig(this.getResJson("jingmaiconfig")),t.ZSSetting=this.initZhuanShengSetting(this.getResJson("zhuanshengsettings"),0),t.ShuXing_Json=this.initVo4Json(this.getResJson("shuxing"),T.ShuXingVo),t.longsoulJSON=this.initVo4Json(this.getResJson("longsoul"),Q.DragonScalesVo),t.Shield=this.initVo4Json(this.getResJson("shield"),A.ShieldVo),t.BuffJson=this.initVo4Json(this.getResJson("buff"),ut.BuffVo),t.NewRoleConfig=this.initVo4Json(this.getResJson("newroleconfig"),_.NewRoleConfigVo),t.activeTaskJSON=this.initVo4Json(this.getResJson("activetask"),M.ActiveTaskVo),t.currencyJSON=this.initVo4Json(this.getResJson("currency"),H.CurrencyVo),t.BagCostJson=this.initVo4Json(this.getResJson("bagcost"),P.BagCostVo),t.blessJSON=this.initVo4Json(this.getResJson("bless"),Y.BlessVo),t.bossmeetingJSON=this.initVo4Json(this.getResJson("bossmeeting"),j.BossmeetingVo),t.equipenhanceJSON=this.initVo4Json(this.getResJson("equipenhance"),J.EquipEnHanceVo),t.equipsoulJSON=this.initVo4Json(this.getResJson("equipsoul"),D.EquipSoulVo),t.equipSpiritJSON=this.initVo4Json(this.getResJson("equipfuling"),$t.EquipSpiritVo),t.heroJSON=this.initVo4Json(this.getResJson("hero"),W.HeroVo),t.jingmailevelJSON=this.initVo4Json(this.getResJson("jingmailevel"),z.MeridianLevelVo),t.jingmaistageJSON=this.initVo4Json(this.getResJson("jingmaistage"),X.MeridianStageVo),t.noticeJSON=this.initVo4Json(this.getResJson("notice"),Z.NoticeVo),t.playersettingJSON=this.initPlayerSetting(this.getResJson("playersetting")),t.powerJSON=this.initVo4Json(this.getResJson("power"),it.PowerVo),t.ring1JSON=this.initVo4Json(this.getResJson("ring1"),nt.Ring1Vo),t.ring2JSON=this.initVo4Json(this.getResJson("ring2"),st.Ring2Vo),t.ring3JSON=this.initVo4Json(this.getResJson("ring3"),pn.Ring3Vo),t.ring4JSON=this.initVo4Json(this.getResJson("ring4"),dn.Ring4Vo),t.robotJSON=this.initVo4Json(this.getResJson("robot"),ot.RobotVo),t.skillsettingJSON=this.initVo4Json(this.getResJson("skillsetting"),at.SkillSettingVo),t.rexue_attr=this.initVo4Json(this.getResJson("rexieshuxing"),ni.ReXueAttrVo),t.rexue_stone=this.initVo4Json(this.getResJson("rexiehunshi"),si.ReXueStoneVo),t.rexue_equip=this.initVo4Json(this.getResJson("rexiezhuangbei"),oi.ReXueEquipVo),t.rexue_ornament=this.initVo4Json(this.getResJson("rexieneishi"),ai.ReXueOrnamentVo),t.rexue_suit=this.initVo4Json(this.getResJson("rexiestaozhuang"),ri.ReXueSuitVo),t.wingstarJSON=this.initVo4Json(this.getResJson("wingstar"),ht.WingStarVo),t.zhuanshengJSON=this.initVo4Json(this.getResJson("zhuansheng"),ct.ZhuanShengVo),t.WingConfigJson=this.initVo4Json(this.getResJson("wingconfig"),k.WingConfigVo),t.stoneJSON=this.initVo4Json(this.getResJson("stone"),x.StoneVo),t.bossjson=this.initVo4Json(this.getResJson("boss"),R.BossVo),t.meetrankrewardJSON=this.initVo4Json(this.getResJson("meetrankreward"),w.MeetrankrewardVo),t.copymaterialJSON=this.initVo4Json(this.getResJson("copymaterial"),b.CopymaterialVo),t.Shop1JSON=this.initVo4Json(this.getResJson("shop1"),I.Shop1Vo),t.Shop2JSON=this.initVo4Json(this.getResJson("shop2"),ft.Shop2Vo),t.Shop3JSON=this.initVo4Json(this.getResJson("shop3"),vt.Shop3Vo),t.titleJSON=this.initVo4Json(this.getResJson("title"),yt.TitleVo),t.rankconfigJSON=this.initVo4Json(this.getResJson("rankconfig"),C.RankConfigVo),t.chopJSON=this.initVo4Json(this.getResJson("chop"),y.ChopVo),t.lotterySettingJSON=this.initVo4Json(this.getResJson("lotterysetting"),_t.LotteryVo),t.wingEquipJSON=this.initVo4Json(this.getResJson("wingequip"),Ct.WingEquipVo),t.port_quanminJSON=this.initVo4Json(this.getResJson("port_quanmin"),It.Port_quanminVo),t.port_shenyuJSON=this.initVo4Json(this.getResJson("port_shen"),At.Port_shenyuVo),t.mailJSON=this.initVo4Json(this.getResJson("mail"),bt.MailVo),t.blessSuit=this.initVo4Json(this.getResJson("blesssuit"),Ee.BlessSuitVo),t.signJSON=this.initVo4Json(this.getResJson("dailysign"),Et.SignVo),t.vipJSON=this.initVo4Json(this.getResJson("vip"),Tt.VipVo),t.Port_zhuanshengJSON=this.initVo4Json(this.getResJson("port_zhuansheng"),d.Port_zhuanshengVo),t.Port_zhuanshengRankJSON=this.initVo4Json(this.getResJson("port_zhuanshengrank"),Zt.Port_zhuanshengrankVo),t.artifactsJSON=this.initVo4Json(this.getResJson("artifacts"),Rt.ArtifactsVo),t.artifactsLevelJSON=this.initVo4Json(this.getResJson("artifactslevel"),Lt.ArtifactsLevelVo),t.kingSettingJSON=this.initVo4Json(this.getResJson("kingsetting"),xt.KingSettingVo),t.kingRankRewards=this.initVo4Json(this.getResJson("kingrankreward"),Ht.KingRankRewardVo),t.KingVo=this.initVo4Json(this.getResJson("king"),Dt.KingVo),t.expression=this.initVo4Json(this.getResJson("expression"),Mt.ExpressVo),t.achieve=this.initVo4Json(this.getResJson("achieve"),Bt.AchieveVo),t.medal=this.initVo4Json(this.getResJson("medal"),Nt.MedalVo),t.meetsetting=this.initVo4Json(this.getResJson("meetsetting"),Ut.MeetsettingVo),t.activityJson=this.initVo4Json(this.getResJson("activity1"),Vt.ActivityVo),t.subActivityJson=this.initVo4Json(this.getResJson("activity2"),Ot.SubActivityVo),t.activityRankJson=this.initVo4Json(this.getResJson("activityRank"),Ft.ActivityRankVo),t.rechargeJson=this.initVo4Json(this.getResJson("recharge"),qt.RechargeVo),t.sandyCitySettingJson=this.initVo4Json(this.getResJson("SandyCitySetting"),Kt.SandyCitySettingVo),t.ruledesc2JSON=this.getResJson("ruledesc2"),t.sandyCityRankJson=this.initVo4Json(this.getResJson("SandyCityRank"),Yt.SandyCityRankVo),t.fashionJson=this.initVo4Json(this.getResJson("fashion"),jt.FashionVo),t.fashionstar=this.initVo4Json(this.getResJson("fashionstar"),fn.FashionStarVo),t.dartJSON=this.initVo4Json(this.getResJson("dart"),Jt.DartVo),t.dartConfigJSON=this.initVo4Json(this.getResJson("dartconfig"),Wt.DartConfigVo),t.bossCallJson=this.initVo4Json(this.getResJson("bosscall"),Xt.BossCallVo),t.portCallJson=this.initVo4Json(this.getResJson("port_call"),Qt.PortCallVo),t.mainCityElesJson=this.initVo4Json(this.getResJson("maincityelement"),te.MainCityEleVo),t.meetrewardJson=this.initVo4Json(this.getResJson("meetreward"),ee.MeetRewardVo),t.chatTemplateJson=this.initVo4Json(this.getResJson("chatTemplate"),ie.ChatTemplateVo),t.monopolyJson=this.initVo4Json(this.getResJson("dafuweng"),oe.MonopolyVo),t.monopolyBoxJson=this.initVo4Json(this.getResJson("dafuwengbox"),ae.MonopolyBoxVo),t.commonJson=this.initVo4Json(this.getResJson("z7z8"),re.CommonVo),t.materialport=this.initVo4Json(this.getResJson("materialport"),le.MaterialportVo),t.medalStarJson=this.initVo4Json(this.getResJson("medal2"),he.MedalStarVo),t.fengshenJson=this.initVo4Json(this.getResJson("fengshen"),ue.FengshenVo),t.pagodaJson=this.initVo4Json(this.getResJson("pagoda"),ge.PagodaVo),t.pagodaLayerJson=this.initVo4Json(this.getResJson("port_pagoda"),pe.PagodaLayerVo),t.pagodaTurntableJson=this.initVo4Json(this.getResJson("zhuanpan"),de.PagodaTurntableVo),t.port_vipbossJSON=this.initVo4Json(this.getResJson("vipboss"),_e.VipBossVo),t.timeLimitTaskJson=this.initVo4Json(this.getResJson("xianshirenwu1"),fe.TimeLimitTaskVo),t.timeLimitSubTaskJson=this.initVo4Json(this.getResJson("xianshirenwu2"),ye.TimeLimitSubTaskVo),t.fuwenBoxJson=this.initVo4Json(this.getResJson("fuwencishu"),Ce.FuWenBoxVo),t.accessCtrlCfg=this.initVo4Json(this.getResJson("gongnengkaiqi1"),Ie.AccessCfgVo),t.chopTaskCfg=this.initVo4Json(this.getResJson("choptask"),be.ChopTaskVo),t.robotNpcCfg=this.initVo4Json(this.getResJson("robotNPC"),Te.RobotNpcVo),t.EXPAttributeCard=this.initVo4Json(this.getResJson("expgamecard"),we.EXPAttributeCardVo),t.EXPEnviroment=this.initVo4Json(this.getResJson("expgameSetting"),Se.EXPEnviromentVo),t.ExpGameBuff=this.initVo4Json(this.getResJson("expgamebuff"),Pe.ExpGameBuffVo),t.pkconfig=this.initVo4Json(this.getResJson("pkboxconfig"),Me.PkConfigVo),t.pkbox=this.initVo4Json(this.getResJson("pkbox"),Ge.PKBoxVo),t.hunyinboss=this.initVo4Json(this.getResJson("hunyinboss"),Be.HunYinVoBoss),t.activityShop=this.initVo4Json(this.getResJson("activityshop"),Ue.ActivityShopVo),t.activityWheelJson=this.initVo4Json(this.getResJson("activitywheel"),Ve.ActivityWheelVo),t.bossCrit=this.initVo4Json(this.getResJson("bossCrit"),qe.BossCritVo),t.answerconfig=this.initVo4Json(this.getResJson("answerconfig"),Fe.AnswerConfig),t.answerrankrewardvo=this.initVo4Json(this.getResJson("answerrankreward"),Fe.AnswerConfig),t.answervo=this.initVo4Json(this.getResJson("answer"),Fe.AnswerVo),t.pointSettingVo=this.initVo4Json(this.getResJson("pointsetting"),Ke.PointSettingVo),t.pointAwardVo=this.initVo4Json(this.getResJson("pointaward"),Je.PointAwardVo),t.rexiezhanchangVo=this.initVo4Json(this.getResJson("rexiezhanchang"),ei.ReXieZhanChangeVo),t.kfrxvo=this.initVo4Json(this.getResJson("kfrx"),qi.KFRXVo),t.crossSvrBossVo=this.initVo4Json(this.getResJson("multiserverBOSS"),Ri.MultiSvrBossVo),t.rexiezhanchangSettingVo=this.initVo4Json(this.getResJson("rexiezhanchangSetting"),ii.ReXieZhanChangSettingVo),t.KFRXSettingVo=this.initVo4Json(this.getResJson("kfrxSetting"),ii.KFRXSettingVo),t.KFSDRXSettingVo=this.initVo4Json(this.getResJson("kfsdSetting"),ii.KFSDSettingVo),t.msBOSSsettingVo=this.initVo4Json(this.getResJson("multiserverBOSSsetting"),Pi.MultiserverBOSSsettingVo),t.kftvo=this.initVo4Json(this.getResJson("kftb"),$i.KFTVo),t.kftsetting=this.initVo4Json(this.getResJson("kftbSetting"),ii.KFTSettingVo),t.kfTBWorldMapVo=this.initVo4Json(this.getResJson("kftbworldmap"),$i.KFTBWorldMapVo),t.nightCitySettingVo=this.initVo4Json(this.getResJson("nightcitysetting"),Ii.NightCitySettingVo),t.cGift=this.initVo4Json(this.getResJson("channelgift"),en.ChannelGiftVo),t.auctionsJson=this.initVo4Json(this.getResJson("paimai"),Ye.AuctionsVo),t.auctionsSettingJson=this.initVo4Json(this.getResJson("paimaisetting"),je.AuctionsSettingVo),t.auctionsAttentionJson=this.initVo4Json(this.getResJson("paimaiattention"),Qe.AuctionsAttentionVo),t.timingActivity=this.initVo4Json(this.getResJson("timingactivity"),Xe.TimingActivityVO),t.aegisLevelJson=this.initVo4Json(this.getResJson("aegislevel"),Ze.AegisLevelVo),t.aegisStarJson=this.initVo4Json(this.getResJson("aegisstar"),$e.AegisStarVo),t.aegisTaskJson=this.initVo4Json(this.getResJson("aegistask"),ti.AegisTaskVo),t.aegisTaskGroupJson=this.initVo4Json(this.getResJson("aegistask1"),li.AegisTaskGroupVo),t.hbtempleJson=this.initVo4Json(this.getResJson("port_rexieshengdian"),pi.HBTemplePortVo),t.worldBossVo=this.initVo4Json(this.getResJson("port_worldboss"),di.WorldBossVo),t.nightCityRankVo=this.initVo4Json(this.getResJson("nightcityrank"),wi.NightCityRankVo),t.portPlotJson=this.initVo4Json(this.getResJson("portplot"),Ei.PortPlotVo),t.gameEventVoCfg=this.initVo4Json(this.getResJson("game_event"),Vi.GameEventVo),t.moneyRewardVoCfg=this.initVo4Json(this.getResJson("moneyreward"),ji.MoneyRewardVo),t.lotteryDrawVoCfg=this.initVo4Json(this.getResJson("amazinggift"),Qi.LotteryDrawVo),t.godpet=this.initVo4Json(this.getResJson("godpet"),zi.GodPet),t.godpetskill=this.initVo4Json(this.getResJson("godpetskill"),zi.GodPetSkill),t.godpetseting=this.initVo4Json(this.getResJson("godpetsetting"),zi.GodSetting),t.shopSettingVoCfg=this.initVo4Json(this.getResJson("shopsetting"),Zi.ShopSettingVo),t.fumoVoCfg=this.initVo4Json(this.getResJson("fumo"),tn.FuMoVo),t.kfsdvo=this.initVo4Json(this.getResJson("kfsd"),an.KFSDVo),t.kfjjcVoCfg=this.initVo4Json(this.getResJson("kfjjcsetting"),gn.KfjjcCfgVo),t.kfjjcRewardVoCfg=this.initVo4Json(this.getResJson("kfjjcreward"),vn.KfjjcRewardCfgVo),t.Rygh=this.initVo4Json(this.getResJson("guanghuan"),yn.RyghVo),t.shareRewardJSON=this.initVo4Json(this.getResJson("sharereward"),rn.ShareSeekHelpVo),t.shareJSON=this.initVo4Json(this.getResJson("share"),ln.ShareVo),t.shareShopJSON=this.initVo4Json(this.getResJson("shareshop"),hn.ShareShopVo),t.teamCopyVoCfg=this.initVo4Json(this.getResJson("teamcopymaterial"),In.TeamCopyVo),t.teamCopySettingVoCfg=this.initVo4Json(this.getResJson("teamcopySetting"),Cn.TeamCopySettingVo),t.shenweiyuRankVo=this.initVo4Json(this.getResJson("shenweiyurank"),bn.ShenWeiYuRankVo),t.shenweiyuCfg=this.initVo4Json(this.getResJson("shenweiyu"),wn.ShenweiyuVo),t.accessRongDuanCfg=this.initVo4Json(this.getResJson("gongnengrongduan"),Tn.AccessRongDuanVo),t.ringLingSkillvo=this.initVo4Json(this.getResJson("ringwraithskill"),Sn.RingLingSkillVo),t.ringLingvo=this.initVo4Json(this.getResJson("ringwraithlevel"),En.RingLingUpVo),t.ringLingShow=this.initVo4Json(this.getResJson("ringwraith"),Sn.RingShow),t.proDan=this.initVo4Json(this.getResJson("shuxingdan"),En.ProDan),t.petSoulJSON=this.initVo4Json(this.getResJson("shouhun"),An.PetSoulVo),Laya.timer.once(1,this,this.monsterJoson),t.sj=this.initVo4Json(this.getResJson("general"),Rn.SjVo),t.sjSuit=this.initVo4Json(this.getResJson("generalsuit"),Ln.SjSuitVo),t.sjEqUp=this.initVo4Json(this.getResJson("generallevel"),xn.SjEqUpVo),t.roughSkillCfg=this.initVo4Json(this.getResJson("roughskill"),Pn.RoughSkillVo),t.roughGlovesCfg=this.initVo4Json(this.getResJson("roughgloves"),kn.RoughGlovesVo),t.roughStrongCfg=this.initVo4Json(this.getResJson("roughstrong"),Dn.RoughStrongVo),t.roughSuitCfg=this.initVo4Json(this.getResJson("roughsuit"),Hn.RoughSuitVo),t.roughcopy=this.initVo4Json(this.getResJson("roughcopy"),Mn.RoughCopyVo),t.ShenQiJson=this.initVo4Json(this.getResJson("forbidarts"),Gn.ShenQiVo),t.ShenQiLevelJson=this.initVo4Json(this.getResJson("forbidartslevel"),Bn.ShenQiLevelVo),t.ShenQiStarLevelJson=this.initVo4Json(this.getResJson("forbidartsstarlevel"),Nn.ShenQiStarLevelVo),t.kfsqjdVo=this.initVo4Json(this.getResJson("kfsqjd"),Un.KFSQJDVo),t.KFSQJDSettingVo=this.initVo4Json(this.getResJson("kfsqjdSetting"),Un.KFSQJDSettingVo),t.feishengjson=this.initVo4Json(this.getResJson("feisheng"),Kn.FeiShengVo),t.fsequipjson=this.initVo4Json(this.getResJson("fsequip"),Yn.FsEquipVo),t.fsequipbreachjson=this.initVo4Json(this.getResJson("fsequipbreach"),qn.FsEquipBreachVo),t.fsequipstrongjson=this.initVo4Json(this.getResJson("fsequipstrong"),Jn.FsEquipStrongVo),t.fsequipsuitjson=this.initVo4Json(this.getResJson("fsequipsuit"),jn.FsEquipSuitVo),t.kfzyjson=this.initVo4Json(this.getResJson("kfzy"),Wn.KFZYBoss),t.kfzyseting=this.initVo4Json(this.getResJson("kfzyseting"),ii.KFZYsettingVo),t.bladeequipjson=this.initVo4Json(this.getResJson("bladeequip"),Vn.BladeequipVo),t.bladelvjson=this.initVo4Json(this.getResJson("bladelv"),On.BladelvVo),t.bladesetingjson=this.initVo4Json(this.getResJson("bladeseting"),Fn.BladesetingVo),t.fsseting=this.initZhuanShengSetting(this.getResJson("zhuanshengsettings"),2)},a.prototype.releaseAllJsonString=function(){for(var t in a._resMetaJSONS)delete a._resMetaJSONS[t]},a.prototype.overLoad=function(){Laya.timer.once(10,this,function(){dt.E.ins.event(pt.EventName.RES_LOAD_OVER)})},a.prototype.initRandomName=function(t){return t},a.prototype.initHelperTypeVo=function(t){for(var e=0;e<t.length;e++){(new Ne.HelperTypeVo).init(t[e])}},a.prototype.initHelperVo=function(t){for(var e=0;e<t.length;e++){(new Ne.HelperVo).init(t[e])}},a.prototype.initWingEquip=function(t){for(var e={},i=0;i<t.length;i++){var n=new Ct.WingEquipVo;n.init(t[i],e),kt.GodWingStruct.Ins.addVo4Data(n)}return e},a.prototype.initMainButton=function(t){for(var e={},i=0;i<t.length;i++){var n=new Gt.MainButtonVo;Gt.MainButtonStruct.Ins.AddMainButtonVo(n.init(t[i],e))}return e},a.prototype.initZhuZaiJson=function(t){for(var e={},i=0;i<t.length;i++){var n=new o.GovernVo;n.init(t[i],e),s.GovernStruct.Ins.addVo4Data(n)}return e},a.prototype.initFamilySetting=function(t){return(new i.FamilySettingVo).init(t[0])},a.prototype.initBlessMaster=function(t){return(new n.BlessMasterVo).init(t[0])},a.prototype.initPassiveVo=function(t){for(var e={},i=0;i<t.length;i++){var n=new g.PassiveVo;n.init(t[i],e),St.PassiveStruct.Ins.add4Arr(n)}return e},a.prototype.initPassiveConfig=function(t){var e=new v.PassiveConfigVo;return e.init(t[0]),e},a.prototype.initJingMaiConfig=function(t){var e=new m.JingMaiConfigVo;return e.init(t[0]),e},a.prototype.initZhuanShengSetting=function(t,e){var i=new mt.ZhuanShengSettingVo;return i.init(t[e]),i},a.prototype.initPlayerSetting=function(t){var e=new et.PlayerSettingVo;return e.init(t),e},a.prototype.initMap=function(t){for(var e={},i=0;i<t.length;i++){(new N.MapVO).init(t[i],e)}return e},a.prototype.initMonsterRes=function(t){for(var e={},i=0;i<t.length;i++){(new V.MoResVo).init(t[i],e)}return e},a.prototype.initMoster=function(t){for(var e={},i=0;i<t.length;i++){(new V.MonsterVO).init(t[i],e)}return e},a.prototype.initPort=function(t){for(var e={},i=0;i<t.length;i++){(new K.PortVo).init(t[i],e)}return e},a.prototype.initSkill=function(t){for(var e={},i=0;i<t.length;i++){(new q.SkillVo).init(t[i],e)}return e},a.prototype.initEquip=function(t){for(var e,i,n={},s=0;s<t.length;s++){var o=new F.EquipVo;o.init(t[s],n),o.quality==E.enumItem.orange&&(e=new S.ChengZhuangVo(o.id,o.job,o.pos,o.limit),S.ChengZhuangStruct.Ins.LvArr.indexOf(o.limit)<0&&(S.ChengZhuangStruct.Ins.LvArr.push(o.limit),S.ChengZhuangStruct.Ins.LvArr.sort(this.sortByNum)),S.ChengZhuangStruct.Ins.addChengZhuang(e)),o.quality==E.enumItem.red&&(i=new f.ShengShiVo(o.id,o.pos,o.job,o.limit),f.ShengShiStruct.Ins.LvArr.indexOf(o.limit)<0&&f.ShengShiStruct.Ins.LvArr.push(o.limit),f.ShengShiStruct.Ins.addShengShi(i))}return n},a.prototype.sortByNum=function(t,e){return t-e},a.prototype.initItem=function(t){for(var e={},i=0;i<t.length;i++){(new O.ItemVo).init(t[i],e)}return e},a.prototype.initVo4Json=function(t,e){var i={};if(t)for(var n=0;n<t.length;n++){(new e).init(t[n],i)}return i},a._samemap=[],a}();e.ConfigJsonCtrl=a}),define("src/g/login/view/QueueView",["require","exports","../../../utils/system/DateUitl","src/init/TextConst"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.initHtmlStyle(t.label_info,"#e3cca9",22),t.initHtmlStyle(t.server,"#e3cca9",22),t.initHtmlStyle(t.waitTime,"#e3cca9",22),t.server.visible=!1,t.waitTime.visible=!1,t}return __extends(t,e),t.prototype.initHtmlStyle=function(t,e,i){t.style.color=e,t.style.font="SimHei",t.style.fontSize=i,t.style.align="center"},t.prototype.setServerName=function(t){this.server.innerHTML=n.TextConst.get(834,t)},t.prototype.setWaitId=function(t){this.label_info.innerHTML=n.TextConst.get(835,t)},t.prototype.setWaitTime=function(t){this.waitTime.innerHTML=n.TextConst.get(836,i.DateUtil.getHMS_countdown(t))},t.prototype.show=function(){this.popup()},t.prototype.hide=function(){this.close()},t}(ui.queue.QueueUI);e.QueueView=s}),define("src/g/login/ctrl/QueueViewCtrl",["require","exports","src/g/login/view/QueueView","src/g/gameSdk/gameSdk"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this._view=null}return t.prototype.showView=function(){null==this._view&&(this._view=new i.QueueView,this._view.exitButton.on(Laya.Event.CLICK,this,this.exitHandler),this._view.closeHandler=new Laya.Handler(this,this.exitHandler)),this._view.show()},t.prototype.hideView=function(){this._view&&(this._view.closeHandler=null,this._view.exitButton.off(Laya.Event.CLICK,this,this.exitHandler),this._view.hide(),this._view.destroy(),this._view=null)},t.prototype.updateInfo=function(t){this._view&&this._view.setWaitId(t)},t.prototype.exitHandler=function(){n.gameSdk.Ins.sdk.logout(""),window.reload()},t}();e.QueueViewCtrl=s}),define("src/g/createrole/view/CreateRoleNew",["require","exports","../../../manager/LayerManager","../../../config/GameConfig","../../net/messages/CreateUserC2GS","src/init/TextConst","../../../enum/JobEnum"],function(t,e,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t._resurl={},t._arr=[],t._isRandomName=!1,t.voData=new o.CreateUserC2GS,t.img_zy_zhan_male.on(Laya.Event.CLICK,t,t.selectHandler,[t.img_zy_zhan_male,1,r.Sex.male]),t.img_zy_zhan_female.on(Laya.Event.CLICK,t,t.selectHandler,[t.img_zy_zhan_female,1,r.Sex.female]),t.img_zy_fa_male.on(Laya.Event.CLICK,t,t.selectHandler,[t.img_zy_fa_male,2,r.Sex.male]),t.img_zy_fa_female.on(Laya.Event.CLICK,t,t.selectHandler,[t.img_zy_fa_female,2,r.Sex.female]),t.img_zy_dao_male.on(Laya.Event.CLICK,t,t.selectHandler,[t.img_zy_dao_male,3,r.Sex.male]),t.img_zy_dao_female.on(Laya.Event.CLICK,t,t.selectHandler,[t.img_zy_dao_female,3,r.Sex.female]);var e=t.list_random;return e.scrollRect=new Laya.Rectangle(0,0,e.width,e.height),t.img_random.on(Laya.Event.CLICK,t,t.onNameChg),t.input_.on(Laya.Event.INPUT,t,t.onInput),t}return __extends(t,i),t.prototype.selectHandler=function(t,e,i){var n="res/createrole/new/"+e+"_"+i+".jpg";this.role_bg.skin=n,this._resurl[n]=1,this.selectimg.x=t.x,this.selectimg.y=t.y,this.voData.sex=i,this.voData.job=e},t.prototype.onInput=function(){this.voData.nickname=this.input_.text,this._isRandomName=!1},t.prototype.showView=function(){this.onNameChg(1),Laya.timer.once(1e3,this,this.createRandom),this.selectHandler(this.img_zy_zhan_male,1,1),n.LayerManager.addInUILayer(this)},t.prototype.createRandom=function(){var t=this._arr;if(4<this._arr.length){var e=t.shift();e.removeSelf()}else e=new Laya.HTMLDivElement;e.style.align="center",e.style.fontSize=20,e.innerHTML=a.TextConst.get(902,this.onGetName(1)),e.y=130,e.width=600;var i=300+(200*Math.random()>>0);t.push(e);for(var n=0;n<t.length;n++)Laya.Tween.to(this._arr[n],{y:t[n].y-25},i);this.list_random.addChild(e),Laya.timer.once(2e3+1e3*Math.random()>>0,this,this.createRandom)},t.prototype.onGetName=function(t){return s.GameConfig.getRandomName(t)},Object.defineProperty(t.prototype,"isRandomName",{get:function(){return this._isRandomName},enumerable:!0,configurable:!0}),t.prototype.onNameChg=function(t){t=this.voData.sex||t;var e=this.onGetName(t);this.input_.changeText(e),this.input_.focus=!0,this.voData.nickname=e,this.input_.focus=!1,this._isRandomName=!0},t.prototype.destroyView=function(){for(var t in this.hideView(),Laya.timer.clearAll(this),this.destroy(),this._arr.length=0,this.removeSelf(),this._resurl)Laya.loader.clearRes(t)},t.prototype.hideView=function(){},t}(ui.createrole.CreateRoleViewUI);e.CreateRoleNew=i}),define("src/g/createrole/ctrl/CreateRoleViewCtrl",["require","exports","../../../utils/system/FloatEffect","../../../manager/GameSocketManager","../../../enum/EventName","../../../core/E","../../net/messages/CreateUserGS2C","../../../utils/system/ErrCodeView","src/g/datacollection/ctrl/DataCollections","../../../manager/StateManger","../../../plugin/view/ToolTip","src/g/createrole/view/CreateRoleNew","../../../utils/StringUtils","src/init/TextConst","src/g/gameSdk/gameSdk","../../net/messages/CreateUserC2GS","../../../enum/JobEnum","../../../config/GameConfig","src/init/GameState","../../net/messages/share/transformJobMsg","../../../utils/SoundUtils"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var I=function(){function e(){this.autoCreateNum=0,this._count=15,n.GSM.ins.on(a.CreateUserGS2C.KEY,this,this.onCreateUserCmd),o.E.ins.on(s.EventName.COMPLETE_INDEX,this,this.destroyViewHandler),this.showView()}return e.prototype.destroyViewHandler=function(){this._view&&(this._view.destroyView(),this._view.btn_startGame.offAll(Laya.Event.CLICK),this._view=null),o.E.ins.off(s.EventName.OPENVIEW_CREATEROLE,this,this.showView),n.GSM.ins.off(a.CreateUserGS2C.KEY,this,this.onCreateUserCmd),o.E.ins.off(s.EventName.INIT_INDEX,this,this.destroyViewHandler)},e.prototype.showView=function(){o.E.ins.event(s.EventName.READY_CREATEROLE),C.SoundUtils.getInstance().playMusicById(1e4),window.isNewUser=!0;window.debugconfig.unpass;m.GameState.passCreateRole=!1,this._view||(this._view=new u.CreateRoleNew,this.initViewEvent(),g.gameSdk.Ins.sdk.sendMessageToPlatform(JSON.stringify({dataType:g.RoleInfoCtrlType.sendSelfMsg,selfMsg:"entercreateroleavu"}),null)),this._view.showView(),this._view.on(Laya.Event.CLICK,this,this.clearTimeHandler),this._view.input_.on(Laya.Event.INPUT,this,this.clearTimeHandler),o.E.ins.event(s.EventName.USERCREATE_OVER)},e.prototype.autoCreateRole=function(){this.autoCreateNum++,g.gameSdk.Ins.sdk.sendMessageToPlatform(JSON.stringify({dataType:g.RoleInfoCtrlType.sendSelfMsg,selfMsg:"entercreateroleavu"}),null);var t=f.Sex.female,e=new v.CreateUserC2GS;e.job=1,e.sex=t,e.nickname=y.GameConfig.getRandomName(e.sex),2<this.autoCreateNum&&(e.nickname+=this.autoCreateNum-2+""),n.GSM.sendServer(e)},e.test=function(t){var e=new _.sendTransformItemC2GS;e.flo=t,n.GSM.sendServer(e)},e.prototype.clearTimeHandler=function(){Laya.timer.clear(this,this.loopHandler),this._view&&(this._view.tip_txt.visible=!1,this._view.tip_txt1.visible=!1)},e.prototype.initViewEvent=function(){this._view.btn_startGame.on(Laya.Event.CLICK,this,this.onBtnStartGame),Laya.timer.loop(1e3,this,this.loopHandler)},e.prototype.loopHandler=function(){if(this._count--,this._count<=0)return Laya.timer.clear(this,this.loopHandler),void this.onBtnStartGame();var t=this._view;t&&(t.tip_txt.text=this._count+"s")},e.prototype.onBtnStartGame=function(){Laya.timer.clear(this,this.loopHandler),l.DataCollections.iscreateRole=!0;var t=this._view.input_.text;if(!p.StringUtils.checkString(t)){if(6<this._view.input_.text.length)i.FE.upItems(d.TextConst.get(350,6),c.BubbleEnum.center);else if(this._view.input_.text.length<2)i.FE.upItems(d.TextConst.get(351,2),c.BubbleEnum.center);else{var e=.5<Math.random()?f.Sex.male:f.Sex.female;this.preload(e),n.GSM.sendServer(this._view.voData)}}},e.prototype.preload=function(t){h.StateManger.coatvisible=!1},e.prototype.onCreateUserCmd=function(t){if(1==t.opresult)return this._view.destroyView(),m.GameState.passCreateRole&&e.test(1),void o.E.ins.event(s.EventName.READY_ENTERGAME);console.error("创建角色失败. Error : "+t.error),m.GameState.passCreateRole?this.autoCreateRole():r.ErrCodeView.show(t.errorID)},e}();e.CreateRoleViewCtrl=I}),define("src/g/login/ctrl/LoginViewCtrl",["require","exports","../../../config/GameConfig","../../../config/vo/gameSettingVo","../../../enum/GameConst","../../net/messages/LoginGS2C","../../net/messages/LoginC2GS","../../../manager/GameSocketManager","../../../enum/EventName","../../../core/E","../../../utils/system/ServerTime","src/g/datacollection/ctrl/DataCollections","src/g/configjson/ctrl/ConfigJsonCtrl","src/g/login/ctrl/QueueViewCtrl","src/g/gameSdk/gameSdk","src/g/createrole/ctrl/CreateRoleViewCtrl"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(){function t(){this.gameSettingUrls=[{url:s.GameConst.GAMESETTING_JSON,type:Laya.Loader.JSON}],this._sessionKey="",this._queueViewCtrl=null,i.GameConfig.gameSetting=this.initGameConfig([["ANIMATION_INTERNAL",100,"两帧动画之间的间隔毫秒数."],["NPC_INTERNAL",180,"NPC动画间隔"],["MONSTER_INTERNAL",180,"怪物动画间隔"],["move_SPEED",250,"人物移动速度 像素/每秒"],["HttpsUse",null,"!!!是否使用https方式连接(为微信强制使用https保留配置)"],["ServerSelect",1,"登录服列表编号"],["AutoEquipResloveTime",500,"一键强化间隔时间"],["revengeMapID",20720,"复仇的地图ID"],["bubbleMax",20,"最大气泡数量"],["bubbleMaxShowTime",80,"气泡透明递减间隔时间"],["bubbleSubAlphaNum",.1,"气泡每次透明递减值"],["bubbleTweenTime",200,"气泡缓动的时间"],["saveTimeByCreate",100,"气泡生成后停留多长时间之后再往上升"],["saveTime",4e3,"气泡的停留时间(在这个时间后开始消失)"],["pkdistance",80,"主城双方PK距离"]]),this.initLoginView()}return t.prototype.initGameConfig=function(t){var e=new n.gameSettingVo;return e.init(t),e},t.prototype.initVo4ServerJson=function(t,e){for(var i={},n=0;n<t.length;n++){(new e).init(t[n],i)}return i},t.prototype.initLoginView=function(){this.startLoadingHandler()},t.prototype.startLoadingHandler=function(){u.DataCollections.SvrData=ktgameconfig.LoginVo.SvrData,r.GSM.ins.on(Laya.Event.OPEN,this,this.onLoginSocket),r.GSM.ins.on(o.LoginGS2C.KEY,this,this.onLogined),r.GSM.initByIp(ktgameconfig.LoginVo.ip,ktgameconfig.LoginVo.port),h.E.ins.on(l.EventName.JSON2CONFIG,this,this.onConfigJson),h.E.ins.on(l.EventName.RES_LOAD_OVER,this,this.onEnterGame),g.gameSdk.Ins.sdk.dataPlacement(90100)},t.prototype.onLoginSocket=function(t){console.info("连接游戏服成功, 发送登录消息 ");var e=ktgameconfig.LoginVo.vo,i=new a.LoginC2GS;i.isReLogin=t,i.loginkey=e.L2CAccountDaya.loginkey,i.useraccount=e.L2CAccountDaya.acname,i.channelID=u.DataCollections.channel_l,i.platform=u.DataCollections.platform_s,i.version=u.DataCollections.app_version_code_s,i.svrId=u.DataCollections.SvrData.svrID,i.svrStatus=u.DataCollections.SvrData.svrStatus,i.device_id=JSON.stringify(g.gameSdk.Ins.sdk.devInfo),i.sujieChannel=g.gameSdk.Ins.sdk.devInfo.channel,r.GSM.sendServer(i),console.log(i),window.ktgamepreloadjdk.serverID=i.svrId},t.prototype.onLogined=function(t){if(0!=t.opresult)1==t.opresult&&(this._queueViewCtrl&&(this._queueViewCtrl.hideView(),this._queueViewCtrl=null),console.info("登录游戏服成功. LoginGS2C : "+JSON.stringify(t)),0==(ktgameconfig.LoginVo.LoginGS2C=t).usercreate?(ktgameconfig.LoginVo.isnewcomer=!0,this.createRoleRes()):h.E.ins.event(l.EventName.READY_ENTERGAME),c.ServerTime.init());else{var e=JSON.parse(t.error);e.pending?(null==this._queueViewCtrl&&(this._queueViewCtrl=new d.QueueViewCtrl,this._queueViewCtrl.showView()),this._queueViewCtrl.updateInfo(e.pending)):console.error("登录游戏服失败. Error : "+t.error)}},t.prototype.createRoleRes=function(){Laya.loader.load([{url:"res/atlas/res/createrole/new.json",type:Laya.Loader.ATLAS},{url:"dynamic/configjson/client_randomname.json",type:Laya.Loader.JSON}],new Laya.Handler(this,this.createRoleHandler))},t.prototype.createRoleHandler=function(){i.GameConfig.randomJSON=Laya.loader.getRes("dynamic/configjson/client_randomname.json"),new v.CreateRoleViewCtrl},t.prototype.onConfigJson=function(){p.ConfigJsonCtrl.ins.uijosnzip()},t.prototype.onEnterGame=function(){h.E.ins.off(l.EventName.RES_LOAD_OVER,this,this.onEnterGame),r.GSM.enterGame(),Laya.timer.once(10,this,function(){Laya.timer.once(10,this,function(){h.E.ins.event(l.EventName.LOGINCTRLDESTROY)})})},t.USE_WEBSOCKET=!0,t.notificationCount=1,t}();e.LoginViewCtrl=f}),define("src/g/accessctrl/AccessKFTimeListenner",["require","exports","src/g/accessctrl/AccessListenner","../../utils/system/ServerTime","../../utils/system/DateUitl"],function(t,e,i,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.addListenner=function(t){this._backHandler=t,Laya.timer.clearAll(this);var e=a.DateUtil.getZeroBySecond(ktgameconfig.LoginVo.SvrCreateTime),i=a.DateUtil.getZeroBySecond(o.ServerTime.serverTime),n=(i-e)/24/3600+1;if(this._value-n==1){var s=i-o.ServerTime.serverTime;0<s&&Laya.timer.once(1e3*s,this,this.onChangedHandler)}},e.prototype.onChangedHandler=function(){this._backHandler&&this._backHandler.runWith(this)},e.prototype.check=function(){var t=a.DateUtil.getZeroBySecond(ktgameconfig.LoginVo.SvrCreateTime);return(a.DateUtil.getZeroBySecond(o.ServerTime.serverTime)-t)/24/3600+1>=this._value},e.prototype.removeListenner=function(){Laya.timer.clearAll(this)},e}(i.AccessListenner);e.AccessKFTimeListenner=n}),define("src/g/accessctrl/AccessHunYinOpenListenner",["require","exports","src/g/accessctrl/AccessListenner","../../core/E","../../enum/EventName","../../manager/RoleCenter"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.addListenner=function(t){this._backHandler=t,n.E.ins.on(s.EventName.HUNYIN_OPEN_JIE,this,this.onChangedHandler)},e.prototype.onChangedHandler=function(){this._backHandler&&this._backHandler.runWith(this)},e.prototype.check=function(){return-1!=o.RoleCenter.instans.vo.comboData.curHunYinJieArr.indexOf(this._value)},e.prototype.removeListenner=function(){n.E.ins.off(s.EventName.HUNYIN_OPEN_JIE,this,this.onChangedHandler)},e}(i.AccessListenner);e.AccessHunYinOpenListenner=a}),define("src/g/accessctrl/AccessKFWeekListenner",["require","exports","src/g/accessctrl/AccessListenner","../../utils/system/DateUitl","../../utils/system/ServerTime"],function(t,e,i,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.addListenner=function(t){this._backHandler=t,Laya.timer.clearAll(this);var e=s.DateUtil.getKFWeek();if(this._value-e==1){var i=o.ServerTime.serverTime;if(0==new Date(1e3*i).getDay()){var n=s.DateUtil.getZeroBySecond(i)-i;0<n&&Laya.timer.once(1e3*n,this,this.onChangedHandler)}}},e.prototype.onChangedHandler=function(){this._backHandler&&this._backHandler.runWith(this)},e.prototype.check=function(){return s.DateUtil.getKFWeek()>=this._value},e.prototype.removeListenner=function(){Laya.timer.clearAll(this)},e}(i.AccessListenner);e.AccessKFWeekListenner=n}),define("src/g/accessctrl/AccessShenDunLvListenner",["require","exports","src/g/accessctrl/AccessListenner","../../manager/RoleCenter","../../core/E","../../enum/EventName"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.addListenner=function(t){e.prototype.addListenner.call(this,t),t&&s.E.ins.on(o.EventName.AEGIS_UPGRADE_SUCCESS,this,this.onChangedHandler)},t.prototype.onChangedHandler=function(){this._backHandler&&this._backHandler.runWith(this)},t.prototype.check=function(){return n.RoleCenter.instans.vo.aegisData.level>=this._value},t.prototype.removeListenner=function(){s.E.ins.off(o.EventName.AEGIS_UPGRADE_SUCCESS,this,this.onChangedHandler),this._backHandler=null},t}(i.AccessListenner);e.AccessShenDunLvListenner=a}),define("src/g/accessctrl/AccessStoneRefine",["require","exports","src/g/accessctrl/AccessListenner","../../core/E","../../enum/EventName","../../manager/RoleCenter"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.addListenner=function(t){e.prototype.addListenner.call(this,t),t&&n.E.ins.on(s.EventName.STONE_REFINE_SUCCESS,this,this.onChangedHandler)},t.prototype.onChangedHandler=function(){this._backHandler&&this._backHandler.runWith(this)},t.prototype.check=function(){return o.RoleCenter.instans.vo.getAllGemLv()>=this._value},t.prototype.removeListenner=function(){n.E.ins.off(s.EventName.STONE_REFINE_SUCCESS,this,this.onChangedHandler),this._backHandler=null},t}(i.AccessListenner);e.AccessStoneRefine=a}),define("src/g/accessctrl/AccessListenFactory",["require","exports","src/g/accessctrl/AccessLevelListenner","src/g/accessctrl/AccessTaskListenner","src/g/accessctrl/AccessShenqiListenner","src/g/accessctrl/AccessPortListenner","src/g/accessctrl/AccessVipListenner","src/g/accessctrl/AccessSuperMonthListenner","src/g/accessctrl/AccessKFTimeListenner","src/g/accessctrl/AccessHunYinOpenListenner","src/g/accessctrl/AccessKFWeekListenner","src/g/accessctrl/AccessShenDunLvListenner","src/g/accessctrl/AccessStoneRefine"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d,g=function(){function t(){}return t.createAccessListenner=function(t,e){return 1==t?new i.AccessLevelListenner(e):3==t?new n.AccessTaskListenner(e):4==t?new s.AccessShenqiListenner(e):2==t?new o.AccessPortListenner(e):5==t?new a.AccessVipListenner(e):6==t?new r.AccessSuperMonthListenner(e):7==t?new l.AccessKFTimeListenner(e):8==t?new h.AccessHunYinOpenListenner(e):10==t?new c.AccessKFWeekListenner(e):9==t?new u.AccessShenDunLvListenner(e):11==t?new p.AccessStoneRefine(e):null},t}();e.AccessListenFactory=g,(d=e.AccessType||(e.AccessType={}))[d.level=1]="level",d[d.port=2]="port",d[d.task=3]="task",d[d.shenqi=4]="shenqi",d[d.vip=5]="vip",d[d.zz_month_card=6]="zz_month_card",d[d.kf_time=7]="kf_time",d[d.hunyi_open=8]="hunyi_open",d[d.shendun_lv=9]="shendun_lv",d[d.kf_week=10]="kf_week",d[d.stone_lv=11]="stone_lv"}),define("src/g/accessctrl/AccessEntity",["require","exports","../../config/GameConfig","src/g/accessctrl/AccessListenFactory","src/g/accessctrl/AccessCenter"],function(t,e,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this._id=t,this._listenArr=[]}return t.prototype.run=function(t){if(!this._isRunning){var e=l.GameConfig.accessCtrlCfg[this._id];if(e){this._always=t;for(var i,n,s=e.require?e.require.length:0,o=0;o<s;){i=e.require[o][0],n=e.require[o][1];var a=h.AccessListenFactory.createAccessListenner(i,n);a&&(a.addListenner(new Laya.Handler(this,this.onChangedHandler)),-1==this._listenArr.indexOf(a)&&this._listenArr.push(a)),o++}var r=this.addCheck();if(r?c.AccessCenter.ins.setAccessOpen(this._id,1):c.AccessCenter.ins.setAccessOpen(this._id,0),r&&!this._always)return void this.stop();this._isRunning=!0}}},t.prototype.onChangedHandler=function(t){this.addCheck()?(c.AccessCenter.ins.setAccessOpen(this._id,1),this._always||this.stop()):c.AccessCenter.ins.setAccessOpen(this._id,0)},t.prototype.addCheck=function(){for(var t=this._listenArr?this._listenArr.length:0,e=0;e<t;){if(0==this._listenArr[e].check())return!1;e++}return 0<t},t.prototype.stop=function(){if(this._isRunning)for(var t=this._listenArr?this._listenArr.length:0,e=0;e<t;)this._listenArr[e].removeListenner(),e++},t.prototype.restart=function(){this.stop(),this.run(this._always)},t.prototype.destroy=function(){this.stop(),this._listenArr&&(this._listenArr.length=0),this._listenArr=null},t}();e.AccessEntity=i}),define("src/g/accessctrl/AccessCenter",["require","exports","../../component/NumberEventDispatcher","../../core/E","../../enum/EventName","../../config/GameConfig","../../manager/RoleCenter","../../manager/TaskManager","src/g/accessctrl/AccessEntity","src/g/accessctrl/AccessData","../../utils/system/ServerTime","src/g/fight/osprite/play/hotbloodpagoda/HotBloodPagodaManager","src/g/fight/osprite/play/hotbloodwar/HotBloodWarManager","src/g/copy/ExpCopyManager"],function(t,e,i,s,o,a,n,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g,v=function(e){function t(){var t=e.call(this)||this;return t._inited=!1,t._accessArr=[],t.checkAndInit(),t}return __extends(t,e),Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t),this._ins},enumerable:!0,configurable:!0}),t.prototype.checkAndInit=function(){n.RoleCenter.instans.vo?r.TaskManager.ins.inited?c.ServerTime.isInited?this.init():s.E.ins.once(o.EventName.SERVER_TIME_UPDATE,this,this.checkAndInit):s.E.ins.once(o.EventName.TASK_INIT_COMPLETE,this,this.checkAndInit):s.E.ins.once(o.EventName.INIT_SELFSETOVER,this,this.checkAndInit)},Object.defineProperty(t.prototype,"inited",{get:function(){return this._inited},enumerable:!0,configurable:!0}),t.prototype.init=function(){var t=a.GameConfig.accessCtrlCfg;for(var e in t){var i=t[e];if(i){if(i.flag){this.setAccessOpen(i.id,1);continue}var n=new l.AccessEntity(i.id);this._accessArr.push(n),n.run(!1)}}this._inited=!0,s.E.ins.event(o.EventName.ACCESS_CENTER_INITED),this.checkInitRedPoint()},t.prototype.checkInitRedPoint=function(){this.register(173,u.HotBloodPagodaManager.getInstance(),u.HotBloodPagodaManager.getInstance().checkHotBloodPagodaRedPoint),this.register(172,p.HotBloodWarManager.getInstance(),p.HotBloodWarManager.getInstance().checkHotBloodWarRedPoint),this.register(85,d.ExpCopyManager.getInstance(),d.ExpCopyManager.getInstance().checkExpCopyRedPoint)},t.prototype.register=function(t,e,i){this.checkOpen(t)?i.call(e):this.on(t,e,i)},t.prototype.restart=function(){for(var t=this._accessArr?this._accessArr.length:0,e=0;e<t;)this._accessArr[e].restart(),e++},t.prototype.setAccessOpen=function(t,e){h.AccessData.setAccessOpen(t,e)&&(this.event(t,e),e&&s.E.ins.event(o.EventName.ACCESS_OPEN,t))},t.prototype.checkOpen=function(t,e){return void 0===e&&(e=!1),h.AccessData.checkOpen(t,e)},t}(i.NumberEventDispatcher);e.AccessCenter=v,(g=e.enumAccessId||(e.enumAccessId={}))[g.mail=1]="mail",g[g.rank=2]="rank",g[g.chop=3]="chop",g[g.zhuanSheng=4]="zhuanSheng",g[g.loginReward=5]="loginReward",g[g.welfare=6]="welfare",g[g.shop=7]="shop",g[g.activity=8]="activity",g[g.xunBao=9]="xunBao",g[g.monopoly=10]="monopoly",g[g.ring=11]="ring",g[g.monthCard=12]="monthCard",g[g.firstRecharge=13]="firstRecharge",g[g.getGodsEquip=14]="getGodsEquip",g[g.partner=15]="partner",g[g.backCity=16]="backCity",g[g.relic=17]="relic",g[g.daily=18]="daily",g[g.playing=19]="playing",g[g.port=20]="port",g[g.athletics=21]="athletics",g[g.copy=22]="copy",g[g.boss=23]="boss",g[g.chat=24]="chat",g[g.task=25]="task",g[g.jointAttack=26]="jointAttack",g[g.education=27]="education",g[g.forge=28]="forge",g[g.role=29]="role",g[g.bag=30]="bag",g[g.family=31]="family",g[g.skills=32]="skills",g[g.books=33]="books",g[g.card=34]="card",g[g.acupoint=35]="acupoint",g[g.strengthen=36]="strengthen",g[g.runes=37]="runes",g[g.stones=38]="stones",g[g.soul=39]="soul",g[g.equipment=40]="equipment",g[g.chuanshi=41]="chuanshi",g[g.wings=42]="wings",g[g.shenyu=43]="shenyu",g[g.shenyu_equipment=44]="shenyu_equipment",g[g.shenyu_compose=45]="shenyu_compose",g[g.shenyu_transform=46]="shenyu_transform",g[g.longlin=47]="longlin",g[g.longdun=48]="longdun",g[g.mabi=49]="mabi",g[g.hushen=50]="hushen",g[g.zhuzai=51]="zhuzai",g[g.zhuzai_shengji=52]="zhuzai_shengji",g[g.zhuzai_jinjie=53]="zhuzai_jinjie",g[g.zhuzai_fenjie=54]="zhuzai_fenjie",g[g.shenzhuang=55]="shenzhuang",g[g.shengshi=56]="shengshi",g[g.shenzhu=57]="shenzhu",g[g.zhuangban=58]="zhuangban",g[g.zhuangban_chenghao=59]="zhuangban_chenghao",g[g.zhuangban_shizhuang=60]="zhuangban_shizhuang",g[g.zhuangban_wuqi=61]="zhuangban_wuqi",g[g.zhuangban_chibang=62]="zhuangban_chibang",g[g.zhenheji=63]="zhenheji",g[g.zhenhunguiwei=64]="zhenhunguiwei",g[g.hunli=65]="hunli",g[g.hunyin=66]="hunyin",g[g.fengyinzhita=67]="fengyinzhita",g[g.bag_zhuangbei=68]="bag_zhuangbei",g[g.bag_daoju=69]="bag_daoju",g[g.bag_fuwen=70]="bag_fuwen",g[g.huishou=71]="huishou",g[g.yijianhuishou=72]="yijianhuishou",g[g.bosszhijia=73]="bosszhijia",g[g.shenyuboss=74]="shenyuboss",g[g.zhizunboss=75]="zhizunboss",g[g.dazhuzai=76]="dazhuzai",g[g.myboss=77]="myboss",g[g.cailiaoCopy=78]="cailiaoCopy",g[g.acupointCopy=79]="acupointCopy",g[g.wingsCopy=80]="wingsCopy",g[g.longlinCopy=81]="longlinCopy",g[g.longdunCopy=82]="longdunCopy",g[g.stonesCopy=83]="stonesCopy",g[g.tongtianta=84]="tongtianta",g[g.jingyanCopy=85]="jingyanCopy",g[g.yezhan=86]="yezhan",g[g.wangzhejingji=87]="wangzhejingji",g[g.kuangdong=88]="kuangdong",g[g.fuchou=89]="fuchou",g[g.dailyTask=90]="dailyTask",g[g.achievement=91]="achievement",g[g.xunzhang=92]="xunzhang",g[g.fengshen=93]="fengshen",g[g.chopTask=94]="chopTask",g[g.shop1=95]="shop1",g[g.shop2=96]="shop2",g[g.shop3=97]="shop3",g[g.shop4=98]="shop4",g[g.xunBaoshenzhuang=99]="xunBaoshenzhuang",g[g.xunBaofuwen=100]="xunBaofuwen",g[g.vip=101]="vip",g[g.zidong=102]="zidong",g[g.timeLimitTask=103]="timeLimitTask",g[g.friends=104]="friends",g[g.zaoyuboss=105]="zaoyuboss",g[g.privateChat=106]="privateChat",g[g.friendsRequestList=107]="friendsRequestList",g[g.blackList=108]="blackList",g[g.recharge=109]="recharge",g[g.port_panel=110]="port_panel",g[g.day_recharge=111]="day_recharge",g[g.attackCity=112]="attackCity",g[g.rank1=113]="rank1",g[g.rank2=114]="rank2",g[g.rank3=115]="rank3",g[g.rank4=116]="rank4",g[g.rank5=117]="rank5",g[g.rank6=118]="rank6",g[g.rank7=119]="rank7",g[g.heji2=120]="heji2",g[g.heji3=121]="heji3",g[g.super_monthCard=122]="super_monthCard",g[g.hanghuitask=130]="hanghuitask",g[g.rename_card=123]="rename_card",g[g.familyManage=124]="familyManage",g[g.familyBase=125]="familyBase",g[g.familyMember=126]="familyMember",g[g.familyList=127]="familyList",g[g.familyHelp=128]="familyHelp",g[g.familySkills=129]="familySkills",g[g.familyTask=130]="familyTask",g[g.familyTaskTask=131]="familyTaskTask",g[g.familyTaskAct=132]="familyTaskAct",g[g.familyrenwu_BOSS=133]="familyrenwu_BOSS",g[g.familyrenwu_mijing=134]="familyrenwu_mijing",g[g.familyWareHouse=135]="familyWareHouse",g[g.familyWareHouseBox=136]="familyWareHouseBox",g[g.familyWareHouseRedBag=137]="familyWareHouseRedBag",g[g.familyWareHouseNote=138]="familyWareHouseNote",g[g.familyShop=139]="familyShop",g[g.familyShop1=140]="familyShop1",g[g.familyShop2=141]="familyShop2",g[g.sign=142]="sign",g[g.exchangeCode=143]="exchangeCode",g[g.notice=144]="notice",g[g.vip4Get=145]="vip4Get",g[g.rechargeQuick=146]="rechargeQuick",g[g.guideALLPersonBoss=147]="guideALLPersonBoss",g[g.guideGuidTaskBoss=148]="guideGuidTaskBoss",g[g.guildCallBoss=149]="guildCallBoss",g[g.helper=151]="helper",g[g.expGuide=152]="expGuide",g[g.equipGuide=153]="equipGuide",g[g.zhuanshengGuide=154]="zhuanshengGuide",g[g.goldInsufficient=155]="goldInsufficient",g[g.equipGuide2=156]="equipGuide2",g[g.onLineReward=157]="onLineReward",g[g.activity_hall_default=158]="activity_hall_default",g[g.activity_hall_festival=159]="activity_hall_festival",g[g.activity_hall_5=160]="activity_hall_5",g[g.activity_hall_6=161]="activity_hall_6",g[g.activity_hall_7=162]="activity_hall_7",g[g.flash_sale_hall=164]="flash_sale_hall",g[g.red_packet=165]="red_packet",g[g.answer=163]="answer",g[g.auctions=166]="auctions",g[g.hot_spring=167]="hot_spring",g[g.advance_notice_hall=168]="advance_notice_hall",g[g.aegis=169]="aegis",g[g.rexue_ornament=170]="rexue_ornament",g[g.rexue_battlefield=172]="rexue_battlefield",g[g.rexue_templeOfGod=173]="rexue_templeOfGod",g[g.rexue_function=174]="rexue_function",g[g.rexue_equip=175]="rexue_equip",g[g.rexue_soulStone=176]="rexue_soulStone",g[g.helper_1=177]="helper_1",g[g.helper_2=178]="helper_2",g[g.helper_3=179]="helper_3",g[g.helper_4=180]="helper_4",g[g.helper_5=181]="helper_5",g[g.helper_6=182]="helper_6",g[g.night_fighting=183]="night_fighting",g[g.world_boss=184]="world_boss",g[g.treasure=185]="treasure",g[g.rx_zt_task=186]="rx_zt_task",g[g.one_activity_hall=187]="one_activity_hall",g[g.sb_shenbing=188]="sb_shenbing",g[g.sb_fantasy=189]="sb_fantasy",g[g.fight=190]="fight",g[g.play_activity=191]="play_activity",g[g.guild_chest=192]="guild_chest",g[g.helper_tipReward=193]="helper_tipReward",g[g.gift=194]="gift",g[g.activityIcon=195]="activityIcon",g[g.one_activity_hall_11=196]="one_activity_hall_11",g[g.flash_sale_hall_2=197]="flash_sale_hall_2",g[g.bosstip=198]="bosstip",g[g.cross_server=199]="cross_server",g[g.cross_server_boss=200]="cross_server_boss",g[g.zhizunvip1=201]="zhizunvip1",g[g.zhizunvip2=202]="zhizunvip2",g[g.zhizunvip3=203]="zhizunvip3",g[g.activity_hall_13=204]="activity_hall_13",g[g.activity_hall_14=205]="activity_hall_14",g[g.activity_hall_15=206]="activity_hall_15",g[g.shenyuTaozhuang=207]="shenyuTaozhuang",g[g.zhanlingYc=208]="zhanlingYc",g[g.zhanlingHh=209]="zhanlingHh",g[g.xunBaoJade=210]="xunBaoJade",g[g.rexueOrnamentComp=211]="rexueOrnamentComp",g[g.automonthboss=212]="automonthboss",g[g.realNameAuthention=213]="realNameAuthention",g[g.zlFb=214]="zlFb",g[g.kfrxz=215]="kfrxz",g[g.kfmrt=216]="kfmrt",g[g.xw=217]="xw",g[g.moneyReward=218]="moneyReward",g[g.fcname=219]="fcname",g[g.activity_hall_16=220]="activity_hall_16",g[g.activity_hall_17=221]="activity_hall_17",g[g.Godpet=222]="Godpet",g[g.Godpetskin=223]="Godpetskin",g[g.one_activity_hall_21=224]="one_activity_hall_21",g[g.one_activity_hall_23=225]="one_activity_hall_23",g[g.combineFirstRecharge=226]="combineFirstRecharge",g[g.activity_hall_20=227]="activity_hall_20",g[g.activity_hall_22=228]="activity_hall_22",g[g.activity_hall_24=229]="activity_hall_24",g[g.activity_hall_26=230]="activity_hall_26",g[g.kftbworldmap=231]="kftbworldmap",g[g.fumo=232]="fumo",g[g.activity_hall_28=233]="activity_hall_28",g[g.ht_task=234]="ht_task",g[g.tarrow=235]="tarrow",g[g.activity_hall_30=236]="activity_hall_30",g[g.activity_hall_32=237]="activity_hall_32",g[g.activity_hall_34=238]="activity_hall_34",g[g.shenshiUp=239]="shenshiUp",g[g.shenshiEquip=240]="shenshiEquip",g[g.kfld=241]="kfld",g[g.share_seekhelp=255]="share_seekhelp",g[g.share_help=256]="share_help",g[g.share_upgrade=257]="share_upgrade",g[g.share_power=258]="share_power",g[g.share_rebate=259]="share_rebate",g[g.share_first=260]="share_first",g[g.share_shop=261]="share_shop",g[g.cross_server_athletics=242]="cross_server_athletics",g[g.cross_server_athletics_panel=243]="cross_server_athletics_panel",g[g.superKefu=244]="superKefu",g[g.guildStorage=245]="guildStorage",g[g.defense_ring=246]="defense_ring",g[g.attack_ring=247]="attack_ring",g[g.shenshimoshi=248]="shenshimoshi",g[g.shenshijindi=249]="shenshijindi",g[g.shengyu_contest_enter_fight=250]="shengyu_contest_enter_fight",g[g.shengyu_contest_shop=251]="shengyu_contest_shop",g[g.shengyu_contest_reward=252]="shengyu_contest_reward",g[g.shengyu_contest_info=253]="shengyu_contest_info",g[g.shengyu_contest_record=254]="shengyu_contest_record",g[g.shengyulongmai=263]="shengyulongmai",g[g.kfworldboss=262]="kfworldboss",g[g.Mjollnir=264]="Mjollnir",g[g.team_copy=265]="team_copy",g[g.kf3v3=266]="kf3v3",g[g.shenqi_view=267]="shenqi_view",g[g.kfsqjd=268]="kfsqjd",g[g.shield_ring=269]="shield_ring",g[g.shenhua=270]="shenhua",g[g.huanling=271]="huanling",g[g.huanlingHh=272]="huanlingHh",g[g.kfTianti=273]="kfTianti",g[g.shenjiang=274]="shenjiang",g[g.kf_fun_list=275]="kf_fun_list",g[g.flash_sale_hall_3=278]="flash_sale_hall_3",g[g.returnGold=310]="returnGold",g[g.ring_ling=287]="ring_ling",g[g.shenweiyuSelf=291]="shenweiyuSelf",g[g.shenweiyuCross=292]="shenweiyuCross",g[g.feisheng=300]="feisheng",g[g.shengzhuang=301]="shengzhuang",g[g.shuangren=302]="shuangren",g[g.kfzy=303]="kfzy",g[g.shengzhaungHeCheng=304]="shengzhaungHeCheng",g[g.rechargeMoney3=308]="rechargeMoney3",g[g.top_back_city_btn=1e3]="top_back_city_btn",g[g.authGift_btn=997]="authGift_btn",g[g.install_btn=998]="install_btn",g[g.wx_guanzhu_btn=999]="wx_guanzhu_btn",g[g.vipService_btn=996]="vipService_btn",g[g.rough=500]="rough",g[g.rough_copy=501]="rough_copy",g[g.end=502]="end"}),define("src/g/activity/ctrl/red/ActivityRedHandlerBase",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this._activityId=t}return Object.defineProperty(t.prototype,"activityId",{get:function(){return this._activityId},enumerable:!0,configurable:!0}),t.prototype.onGoldChanged=function(){return!1},t.prototype.onItemCountChanged=function(t,e){return!1},t.prototype.onLevelChanged=function(t){return!1},t.prototype.onPassDay=function(){return!1},t.prototype.updateRed=function(){},t}();e.ActivityRedHandlerBase=i}),define("src/g/activity/ctrl/red/ActivityReadRed",["require","exports","src/g/activity/ctrl/red/ActivityRedHandlerBase","../../../../manager/RoleCenter","../../../../manager/ActivityManager","../../../../enum/EventName","../../../../core/E"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.updateRed=function(){var t=n.RoleCenter.instans.vo.getActivity1Data(this.activityId),e=t.hasRed;t.hasRed=!s.ActivityManager.ins.activityHasRead(this.activityId),t.hasRed!=e&&a.E.ins.event(o.EventName.ACTIVITY_RED_UPDATE,this.activityId)},e}(i.ActivityRedHandlerBase);e.ActivityReadRed=r}),define("src/g/activity/ctrl/red/GoldFallRed",["require","exports","src/g/activity/ctrl/red/ActivityRedHandlerBase","../../../../manager/RoleCenter","../../../net/messages/enumStatus","../../../../config/GameConfig","../../../../enum/EventName","../../../../core/E","../../../../manager/ActivityManager"],function(t,e,i,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onGoldChanged=function(){return!0},e.prototype.updateRed=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this.activityId),e=t.hasRed;if(t.hasRed=!u.ActivityManager.ins.activityHasRead(this.activityId),!t.hasRed)for(var i=t.children.length,n=0,s=-1;n<i;){if(t.children[n].status!=r.enumStatus.yilingqu&&-1==s){s=n;var o=l.GameConfig.subActivityJson[t.children[n].cfgId];o&&a.RoleCenter.instans.vo.GOLD>=Number(o.cost[0][1])&&(t.children[n].hasRed=!0,t.hasRed=!0);break}n++}t.hasRed!=e&&c.E.ins.event(h.EventName.ACTIVITY_RED_UPDATE,this.activityId)},e}(i.ActivityRedHandlerBase);e.GoldFallRed=n}),define("src/g/activity/ctrl/red/MysteryStoreRed",["require","exports","src/g/activity/ctrl/red/ActivityRedHandlerBase","../../../../manager/RoleCenter","../../../../manager/ActivityManager","../../../../core/E","../../../../enum/EventName"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.updateRed=function(){var t=n.RoleCenter.instans.vo.getActivity1Data(this.activityId),e=t.hasRed;t.hasRed=!s.ActivityManager.ins.activityHasRead(this.activityId),t.hasRed!=e&&o.E.ins.event(a.EventName.ACTIVITY_RED_UPDATE,this.activityId)},e}(i.ActivityRedHandlerBase);e.MysteryStoreRed=r}),define("src/g/activity/ctrl/red/RechargeAndRebateRed",["require","exports","src/g/activity/ctrl/red/ActivityRedHandlerBase","../../../../manager/RoleCenter","../../../net/messages/enumStatus","../../../../enum/EventName","../../../../core/E","../../../../config/GameConfig","../../../../utils/system/ServerTime"],function(t,e,i,s,a,o,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.waitLevel=0,t.waitPassDay=!1,t}return __extends(t,e),t.prototype.onLevelChanged=function(t){return 0<this.waitLevel&&t>=this.waitLevel},t.prototype.onPassDay=function(){return this.waitPassDay},t.prototype.updateRed=function(){var t=s.RoleCenter.instans.vo.getActivity1Data(this.activityId);if(t&&t.children){var e=!1;this.waitLevel=0,this.waitPassDay=!1;for(var i=t.children.length,n=0;n<i;){if(this.checkActivity2Data(t,n)){e=!0;break}if(0<this.waitLevel||this.waitPassDay)break;n++}t.hasRed!=e&&(t.hasRed=e,r.E.ins.event(o.EventName.ACTIVITY_RED_UPDATE,this.activityId))}},t.prototype.checkActivity2Data=function(t,e){if(t&&t.children){var i=t.children[e],n=l.GameConfig.subActivityJson[i.cfgId];if(i.status==a.enumStatus.weiwancheng&&h.ServerTime.serverTime<t.endTime){var s=!0;return i.count<n.viplevel%1e6&&(s=!1),s}if(i.status!=a.enumStatus.kelingqu)return!1;var o=!1;return i.childCountArr[0]<=h.ServerTime.serverTime&&(o=!0),o}},t}(i.ActivityRedHandlerBase);e.RechargeAndRebateRed=n}),define("src/g/activity/ctrl/red/TimeLimitListRed",["require","exports","src/g/activity/ctrl/red/ActivityRedHandlerBase","../../../../manager/RoleCenter","../../../../enum/EventName","../../../../core/E","../../../../config/GameConfig","../../../net/messages/enumStatus"],function(t,e,i,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.waitLevel=0,t.waitPassDay=!1,t}return __extends(t,e),t.prototype.onLevelChanged=function(t){return 0<this.waitLevel&&t>=this.waitLevel},t.prototype.onPassDay=function(){return this.waitPassDay},t.prototype.updateRed=function(){for(var t=r.RoleCenter.instans.vo.getActivity1Data(this.activityId),e=!1,i=t.children.length,n=1;n<i;){var s=t.children[n];c.GameConfig.subActivityJson[s.cfgId];s.status==u.enumStatus.kelingqu&&(e=!0),n++}var o=c.GameConfig.subActivityJson[t.children[0].cfgId],a=o.originalcost[1][0];o.originalcost[1][1]<=r.RoleCenter.instans.vo.bagdata.getItemCount(a)&&(e=!0),t.hasRed!=e&&(t.hasRed=e,h.E.ins.event(l.EventName.ACTIVITY_RED_UPDATE,this.activityId))},t}(i.ActivityRedHandlerBase);e.TimeLimitListRed=n}),define("src/g/activity/ctrl/red/FireWorksRed",["require","exports","src/g/activity/ctrl/red/ActivityRedHandlerBase","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../core/E","../../../../enum/EventName"],function(t,e,i,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.waitLevel=0,t.waitPassDay=!1,t}return __extends(t,e),t.prototype.onLevelChanged=function(t){return 0<this.waitLevel&&t>=this.waitLevel},t.prototype.onPassDay=function(){return this.waitPassDay},t.prototype.updateRed=function(){var t=s.RoleCenter.instans.vo.getActivity1Data(this.activityId),e=!1,i=o.GameConfig.subActivityJson[t.children[0].cfgId],n=i.originalcost[1][0];i.originalcost[1][1]<=s.RoleCenter.instans.vo.bagdata.getItemCount(n)&&(e=!0),t.hasRed!=e&&(t.hasRed=e,a.E.ins.event(r.EventName.ACTIVITY_RED_UPDATE,this.activityId))},t}(i.ActivityRedHandlerBase);e.FireWorksRed=n}),define("src/g/activity/ctrl/red/Identify_Gem3Red",["require","exports","src/g/activity/ctrl/red/ActivityRedHandlerBase","../../../../manager/RoleCenter","../../../../enum/EventName","../../../../core/E","../../../../config/GameConfig"],function(t,e,i,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.waitLevel=0,t.waitPassDay=!1,t}return __extends(t,e),t.prototype.onLevelChanged=function(t){return 0<this.waitLevel&&t>=this.waitLevel},t.prototype.onPassDay=function(){return this.waitPassDay},t.prototype.updateRed=function(){var t=s.RoleCenter.instans.vo.getActivity1Data(this.activityId),e=!1;t.allData.time<=0&&(e=!0);var i=r.GameConfig.subActivityJson[t.children[0].cfgId],n=i.cost[1][0];i.cost[1][1]<=s.RoleCenter.instans.vo.bagdata.getItemCount(n)&&(e=!0),t.hasRed!=e&&(t.hasRed=e,a.E.ins.event(o.EventName.ACTIVITY_RED_UPDATE,this.activityId))},t}(i.ActivityRedHandlerBase);e.Identify_Gem3Red=n}),define("src/g/activity/ctrl/red/Wheel_duobao_red",["require","exports","src/g/activity/ctrl/red/ActivityRedHandlerBase","../../../../manager/RoleCenter","../../../../enum/EventName","../../../../core/E","../../../../config/GameConfig","../../../net/messages/enumStatus"],function(t,e,i,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.updateRed=function(){var t=a.RoleCenter.instans.vo.getActivity1Data(this.activityId),e=!1,i=t.children[0],n=h.GameConfig.subActivityJson[t.children[0].cfgId];i.count<=n.value&&(e=!0);for(var s=t.children.length,o=1;o<s;)(i=t.children[o]).status==c.enumStatus.kelingqu&&(e=!0),o++;t.hasRed!=e&&(t.hasRed=e,l.E.ins.event(r.EventName.ACTIVITY_RED_UPDATE,this.activityId))},e}(i.ActivityRedHandlerBase);e.Wheel_duobao_red=n}),define("src/g/activity/ctrl/red/JoyTreasureRed",["require","exports","src/g/activity/ctrl/red/ActivityRedHandlerBase","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../core/E","../../../../enum/EventName"],function(t,e,i,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.waitLevel=0,t.waitPassDay=!1,t}return __extends(t,e),t.prototype.onLevelChanged=function(t){return 0<this.waitLevel&&t>=this.waitLevel},t.prototype.onPassDay=function(){return this.waitPassDay},t.prototype.updateRed=function(){for(var t=a.RoleCenter.instans.vo.getActivity1Data(this.activityId),e=!1,i=t.children.length,n=1;n<i;)1!=t.children[n].childCountArr[1]&&(e=!0),n++;var s=r.GameConfig.subActivityJson[t.children[0].cfgId],o=s.cost[1][0];s.cost[1][1]<=a.RoleCenter.instans.vo.bagdata.getItemCount(o)&&(e=!0),t.hasRed!=e&&(t.hasRed=e,l.E.ins.event(h.EventName.ACTIVITY_RED_UPDATE,this.activityId))},t}(i.ActivityRedHandlerBase);e.JoyTreasureRed=n}),define("src/g/activity/ctrl/red/InvestmentPlanRed",["require","exports","src/g/activity/ctrl/red/ActivityRedHandlerBase","../../../../manager/RoleCenter","../../../net/messages/enumStatus","../../../../config/GameConfig","../../../../utils/system/ServerTime","../../../../core/E","../../../../enum/EventName"],function(t,e,i,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onPassDay=function(){return!0},e.prototype.updateRed=function(){for(var t=o.RoleCenter.instans.vo.getActivity1Data(this.activityId),e=!1,i=t.children.length,n=0;n<i;){var s=t.children[n];if(s&&s.status==a.enumStatus.kelingqu){r.GameConfig.subActivityJson[s.cfgId];if(l.ServerTime.serverTime>=s.count){e=!0;break}}n++}t.hasRed!=e&&(t.hasRed=e,h.E.ins.event(c.EventName.ACTIVITY_RED_UPDATE,this.activityId))},e}(i.ActivityRedHandlerBase);e.InvestmentPlanRed=n}),define("src/g/activity/ctrl/red/ActivityRedFactroy",["require","exports","../../../../enum/ActivityTemplate","src/g/activity/ctrl/red/GoldFallRed","src/g/activity/ctrl/red/MysteryStoreRed","src/g/activity/ctrl/red/ActivityReadRed","src/g/activity/ctrl/red/RechargeAndRebateRed","src/g/activity/ctrl/red/TimeLimitListRed","src/g/activity/ctrl/red/FireWorksRed","src/g/activity/ctrl/red/Identify_Gem3Red","src/g/activity/ctrl/red/Wheel_duobao_red","src/g/activity/ctrl/red/JoyTreasureRed","src/g/activity/ctrl/red/InvestmentPlanRed"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(){}return t.getActivityRed=function(t,e){switch(t){case i.ActivityTemplateKey.gold_fall:return new n.GoldFallRed(e);case i.ActivityTemplateKey.mystery_store:return new s.MysteryStoreRed(e);case i.ActivityTemplateKey.boss_score_exchange:case i.ActivityTemplateKey.common_exchange:case i.ActivityTemplateKey.limit_gift:case i.ActivityTemplateKey.specialgift:case i.ActivityTemplateKey.vip_limit_sale:case i.ActivityTemplateKey.vip_limit_discount:case i.ActivityTemplateKey.treasure_appraisal:case i.ActivityTemplateKey.lucky_buy:case i.ActivityTemplateKey.groupDiscount:return new o.ActivityReadRed(e);case i.ActivityTemplateKey.recharge_rebate:return new a.RechargeAndRebateRed(e);case i.ActivityTemplateKey.time_limit_list:return new r.TimeLimitListRed(e);case i.ActivityTemplateKey.fireWorks:return new l.FireWorksRed(e);case i.ActivityTemplateKey.Identify_Gem3:return new h.Identify_Gem3Red(e);case i.ActivityTemplateKey.Wheel_duobao:return new c.Wheel_duobao_red(e);case i.ActivityTemplateKey.joyTreasure:return new u.JoyTreasureRed(e);case i.ActivityTemplateKey.investment_plan:return new p.InvestmentPlanRed(e)}return null},t}();e.ActivityRedFactroy=d}),define("src/g/activity/interface/ActivityViewInterface",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),define("src/g/activity/view/item/FestivalLoginItem",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(ui.activity.item.FestivalLoginItemUI);e.FestivalLoginItem=i}),define("src/g/activity/view/item/LimitPurchaseItem",["require","exports","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../manager/RoleCenter","../../../../manager/AM","../../../../config/GameConfig","../../../../plugin/view/ToolTip","../../../../utils/system/FloatEffect","src/init/Switches","../../../net/messages/activity/ActivityGet","../../../../manager/GameSocketManager","src/g/Effects/UIEffectsFactory","src/init/TextConst"],function(t,e,i,n,r,s,l,o,a,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(e){function t(){var t=e.call(this)||this;return t.btn_buy.on(Laya.Event.CLICK,t,t.buyHandler),t.list_item.renderHandler=new Laya.Handler(t,t.onRenderHandler),t.list_item.mouseHandler=new Laya.Handler(t,t.onMouseHandler),t}return __extends(t,e),t.prototype.onRenderHandler=function(t,e){i.ItemCellUtils.fillCellForItemNameView(t,t.dataSource[0],Number(t.dataSource[1]))},t.prototype.onMouseHandler=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.list_item.array[e];n.ItemTips.ins.showTip(i[0],Number(i[1]))}},t.prototype.buyHandler=function(){var t=r.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=t.children[this._childIndex];if(e){if(!r.RoleCenter.instans.bagRoomEnough())return void s.AM.showBagNotEnough();var i=l.GameConfig.subActivityJson[e.cfgId];if(0<i.value2&&i.value2-e.count<=0)return void a.FE.upItems(d.TextConst.get(218),o.BubbleEnum.center);if(0<i.viplevel&&r.RoleCenter.instans.vo.VIP<i.viplevel)return void a.FE.upItems(d.TextConst.get(219),o.BubbleEnum.center);if("MONEY"==i.cost[0][0]&&r.RoleCenter.instans.vo.MONEY<i.cost[0][1])return void a.FE.upItems(d.TextConst.get(220),o.BubbleEnum.center);if("GOLD"==i.cost[0][0]&&r.RoleCenter.instans.vo.GOLD<i.cost[0][1])return void h.Switches.ins.event(155);var n=new c.ActivityGetC2GS;n.id=this._activityId,n.activity2CfgId=e.cfgId,u.GSM.sendServer(n)}}},t.prototype.setData=function(t,e){this._activityId=t,this._childIndex=e;var i=r.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=i.children[e];if(n){var s=l.GameConfig.subActivityJson[n.cfgId];this.list_item.array=s.bonus,this.type_icon.define=s.originalcost[0][0],this.type_icon1.define=s.cost[0][0],this.cost_old_txt.text=s.originalcost[0][1],this.cost_new_txt.text=s.cost[0][1],this.txt_rebate.text=s.discost+"";var o=s.value2-n.count;s.value2;this.count_txt.color=o<1?"#ff0000":"#03bb00",this.count_txt.text=s.value2-n.count+"/"+s.value2,this.lab_remain.changeText(d.TextConst.get(259,12)),s.viplevel?(this.vip_con.visible=!0,this.vip_value.value=s.viplevel+""):this.vip_con.visible=!1;var a=!0;0<s.value2&&s.value2-n.count<=0&&(a=!1),0<s.viplevel&&r.RoleCenter.instans.vo.VIP<s.viplevel&&(a=!1),"MONEY"==s.cost[0][0]&&r.RoleCenter.instans.vo.MONEY<s.cost[0][1]&&(a=!1),"GOLD"==s.cost[0][0]&&r.RoleCenter.instans.vo.GOLD<s.cost[0][1]&&(a=!1),a?(this.ani||(this.ani=p.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_buy,40,.62,.8)),-1==this.btn_buy.getChildIndex(this.ani)&&p.UIEffectsFactory.Ins.centerSAni4Parent(this.ani,this.btn_buy),this.ani.play()):this.ani&&(this.ani.stop(),-1!=this.btn_buy.getChildIndex(this.ani)&&this.btn_buy.removeChild(this.ani))}}},t}(ui.activity.item.Limit_Purchase_itemUI);e.LimitPurchaseItem=g}),define("src/g/activity/view/pages/LimitPurchasePage",["require","exports","src/g/clearRes/ClearResM","../../../../core/E","../../../../enum/EventName","src/g/activity/view/item/LimitPurchaseItem","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl"],function(t,e,i,n,s,o,l,h,c,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._activityId=0,t._nextRoundTime=0,t}return __extends(t,e),t.prototype.getActivityId=function(){return this._activityId},t.prototype.showPage=function(t,e){this._activityId!=t?(this._activityId=t,this.updateUnchanged()):i.ClearResM.resetViewImg(this),this.refresh(),this.cooldownHandler(),n.E.ins.on(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),e.addChild(this)},t.prototype.refresh=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);t&&this.lab_allcount.changeText(t.allData.allCount.toString()),this.updateList()},t.prototype.hidePage=function(){n.E.ins.off(s.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.removeSelf(),i.ClearResM.clearFolderByUrl("dynamic/activity/limit_purchase/"),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.backHandler=function(){return!0},t.prototype.doDestroy=function(){this.hidePage(),e.prototype.destroy.call(this)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&Laya.timer.frameOnce(2,this,this.refresh)},t.prototype.initialize=function(){e.prototype.initialize.call(this),this.list_main.itemRender=o.LimitPurchaseItem,this.list_main.scrollBar.elasticDistance=100,this.list_main.renderHandler=new Laya.Handler(this,this.onListMainItemRenderHandler)},t.prototype.onListMainItemRenderHandler=function(t,e){t.setData(this._activityId,this._childIndexArr[e])},t.prototype.updateList=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=h.GameConfig.activityJson[t.cfgId];if(e){var i=Math.floor((c.ServerTime.serverTime-t.startTime)/Number(e.value))+1,n=0;this._childIndexArr=[];for(var s,o,a=t.children.length,r=0;r<a;)s=t.children[r],(o=h.GameConfig.subActivityJson[s.cfgId])&&(o.value==i&&this._childIndexArr.push(r),n=Math.max(o.value,n)),r++;this.lab_time_lab.visible=this.time_txt.visible=i<n&&(this._nextRoundTime=i*Number(e.value)+t.startTime,!0),this.list_main.array=this._childIndexArr.sort(this.childSortFun.bind(this))}}},t.prototype.childSortFun=function(t,e){var i=l.RoleCenter.instans.vo.getActivity1Data(this._activityId),n=h.GameConfig.subActivityJson[i.children[t].cfgId],s=h.GameConfig.subActivityJson[i.children[e].cfgId];return n.childId-s.childId},t.prototype.updateUnchanged=function(){var t=l.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=h.GameConfig.activityJson[t.cfgId];e&&(this.bg_img.skin="dynamic/activity/limit_purchase/"+e.bg_img+".png",this.desc_txt.text=e.desc)}},t.prototype.cooldownHandler=function(){if(this.time_txt.visible){Laya.timer.once(1e3,this,this.cooldownHandler);var t=this._nextRoundTime-c.ServerTime.serverTime;86400<t?this.time_txt.changeText(a.DateUtil.remainingDHStr(t)):0<t?this.time_txt.changeText(a.DateUtil.getHMS_countdown(t)):(this.updateList(),this.time_txt.changeText("00:00:00"))}},t}(ui.activity.pages.Limit_PurchaseUI);e.LimitPurchasePage=r}),define("src/g/boss/ctrl/BossRedCtrl",["require","exports","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){this._bossRedCount=0,this._personBossCount=0,this._allpersonBossCount=0,this._shenbossCount=0}return Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t),this._ins},enumerable:!0,configurable:!0}),t.prototype.init=function(t){(this.btn_boss_red_=t).visible=!1,i.E.ins.on(n.EventName.PERSION_BOSS_DIE,this,this.updateBossRedCount),this.updateBossRedCount()},Object.defineProperty(t.prototype,"bossRedCount",{set:function(t){this._bossRedCount=t},enumerable:!0,configurable:!0}),t.prototype.updateBossRedCount=function(){this._bossRedCount=this._personBossCount+this._allpersonBossCount+this._shenbossCount,this.btn_boss_red_&&(0<this._bossRedCount?this.btn_boss_red_.visible=!0:this.btn_boss_red_.visible=!1)},Object.defineProperty(t.prototype,"personRedCount",{set:function(t){this._personBossCount=t,this.btn_personboss_red&&(0<this._personBossCount?this.btn_personboss_red.visible=!0:this.btn_personboss_red.visible=!1),this.updateBossRedCount()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allpersonRedCount",{get:function(){return this._allpersonBossCount},set:function(t){var e=s.RoleCenter.instans.vo;e&&(e.QUANMINGCOUNT<=0?this._allpersonBossCount=0:this._allpersonBossCount=t,this.btn_allpersonboss_red&&(0<this._allpersonBossCount?this.btn_allpersonboss_red.visible=!0:this.btn_allpersonboss_red.visible=!1),this.updateBossRedCount())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shenRedCount",{get:function(){return this._shenbossCount},set:function(t){var e=s.RoleCenter.instans.vo;e&&(e.WINGBOSSCOUNT<=0?this._shenbossCount=0:this._shenbossCount=t),this.btn_shenboss_red&&(0<this._shenbossCount?this.btn_shenboss_red.visible=!0:this.btn_shenboss_red.visible=!1),this.updateBossRedCount()},enumerable:!0,configurable:!0}),t}();e.BossRedCtrl=o}),define("src/g/boss/view/BossRemindDlg",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.pivot(t.width/2,t.height/2),t.x=Laya.stage.width/2,t.y=Laya.stage.height-2*t.height,t}return __extends(t,e),t.prototype.showView=function(t){this.scale(0,0),Laya.Tween.to(this,{scaleX:1,scaleY:1},300,null,new Laya.Handler(this,this.completeHandler))},t.prototype.completeHandler=function(){},t}(ui.boss.BossTipUI);e.BossRemindDlg=i}),define("src/g/boss/ctrl/BossRemindDlgCtrl",["require","exports","src/g/boss/view/BossRemindDlg","src/g/index/ctrl/GameIndexCtrl"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.showView=function(){this._view||(this._view=new i.BossRemindDlg),this._view.showView(null),n.GameIndexCtrl.idxView.addChild(this._view)},t}();e.BossRemindDlgCtrl=s}),define("src/g/boss/view/AttItemView",["require","exports","../../../manager/GameSocketManager","../../../utils/ItemUtils","../../net/messages/ChangeAttackTargetMsg","src/g/fight/osprite/play/baseplay/vo/WolrdBossVo"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.accname="",t.on(Laya.Event.CLICK,t,t.clickHandler),t}return __extends(t,e),t.prototype.setData=function(t,e){this.bossplayID=t,this.accname=e.username,this.att_icon.skin=n.ItemUtils.getHeadurlYuan(e.openhero[0].sex,e.openhero[0].jobid),this.att_icon.restskin(),this.att_name.text=e.nickname},t.prototype.clickHandler=function(){var t=new s.ChangeAttackTargetC2GS;t.actid=this.bossplayID,t.acttype=o.WolrdBossVo.PORT_TYPE,t.beAttackAcc=this.accname,i.GSM.sendServer(t)},t.prototype.destroy=function(t){this.off(Laya.Event.CLICK,this,this.clickHandler),e.prototype.destroy.call(this,t)},t}(ui.boss.AttViewItemUI);e.AttItemView=a}),define("src/g/boss/view/VipBossItem",["require","exports","../../../manager/LayerManager","../../../utils/ItemUtils","../../../core/E","../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../manager/RoleCenter","../../../utils/system/FloatEffect","../../net/messages/ActivityMessage","../../../utils/system/ServerTime","../../../plugin/view/ToolTip","../../../manager/AM","src/init/Switches","../../../manager/StateManger","../../../config/GameConfig","src/g/boss/ctrl/AotuFightCtrl","src/init/TextConst"],function(t,e,n,s,o,a,r,l,h,c,u,p,d,g,v,f,i,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=function(){function t(t){this.vip=1,this.cdtime=0,this._view=t,this._view.btn_fight.on(Laya.Event.CLICK,this,this.fightHandler),o.E.ins.on(a.EventName.VIPBOSS_COUNT,this,this.updateCount)}return t.prototype.fightHandler=function(){if(l.RoleCenter.instans.bagRoomEnough()){if(!v.StateManger.isSpecialPlay()){var t=l.RoleCenter.instans.vo,e=f.GameConfig.errorCodeJSON[6273].des;if(t.VIP<=0)d.AM.show(e,new Laya.Handler(this,function(){g.Switches.ins.event(101)}));else if(0<this.cdtime)h.FE.upItems(y.TextConst.get(307),p.BubbleEnum.center);else if(this.vip<=t.VIP){if(this.vo){var i=s.ItemUtils.getBossId(this.vo.bossid);o.E.ins.event(a.EventName.PLAY_TYPE_CHANGE,r.PlayTypeVo.create(i.type,this.vo.bossid)),n.LayerManager.closeAllPOPWindow()}}else this.vip>t.VIP?(e=f.GameConfig.errorCodeJSON[6275].des,d.AM.show(e,new Laya.Handler(this,function(){g.Switches.ins.event(101)}))):(e=f.GameConfig.errorCodeJSON[6274].des,h.FE.upItems(e,p.BubbleEnum.center))}}else d.AM.showBagNotEnough()},t.prototype.setData=function(t){this.vip=t,this.updateCount()},t.prototype.updateCount=function(){},t.prototype.setVo=function(t){if(t){this.vo=t;l.RoleCenter.instans.vo;if(t.curstate==c.EACTIVITY_STATE.INCD){Laya.timer.loop(1e3,this,this.updateHandler);var e=new Date(1e3*u.ServerTime.serverTime),i=e.getMinutes();this.cdtime=30<i?60*(60-i)+60-e.getSeconds():60*(30-i)+60-e.getSeconds(),this.updateHandler()}else Laya.timer.clear(this,this.updateHandler)}},t.prototype.updateHandler=function(){if(this.cdtime--,0<=this.cdtime);else{Laya.timer.clear(this,this.updateHandler),this.vo.curstate=c.EACTIVITY_STATE.INREADY;var t=l.RoleCenter.instans.vo;this.vip<=t.VIP&&i.AotuFightCtrl.setBossID(this.vo)}},t}();e.VipBossItem=m}),define("src/g/boss/view/ZhuanShengChouJiang",["require","exports","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","src/init/TextConst"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.countDownNum=5,t.countDownMaxNum=5,t.barWidth=t.bar.width,t.sureBtn.on(Laya.Event.CLICK,t,t.sureHandler),t}return __extends(t,e),t.prototype.sureHandler=function(){this.close(),this.destroy()},t.prototype.showView=function(){this.x=(Laya.stage.width-this.width)/2,this.y=(Laya.stage.height-this.height)/2;var t=i.ItemUtils.getItemOrEq(142),e=new n.ItemIconView;e.setData(t),this.itemContainer.addChild(e),this.popup(),this.startCountDown()},t.prototype.startCountDown=function(){var t=this;this.clearCountDownInterval(),this._countDownInterval=setInterval(function(){t.countDownNum--,t.countDownNum<0?t.sureHandler():(t.bar.width=t.countDownNum/t.countDownMaxNum*t.barWidth,t.countDownText.text=s.TextConst.get(13,t.countDownNum))},1e3)},t.prototype.clearCountDownInterval=function(){this._countDownInterval&&(clearInterval(this._countDownInterval),this._countDownInterval=null)},t.prototype.destroy=function(t){this.clearCountDownInterval(),e.prototype.destroy.call(this,t)},t.show=function(){(new t).showView()},t}(ui.boss.ZhuanShengChouJiangUI);e.ZhuanShengChouJiang=o}),define("src/g/boss/view/ZsHurtRankDlg",["require","exports","../../../manager/RoleCenter"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.btn_back.on(Laya.Event.CLICK,t,t.close),t.btn_close.on(Laya.Event.CLICK,t,t.close),t.list_.renderHandler=new Laya.Handler(t,t.listRenderHandler),t}return __extends(t,e),t.prototype.init=function(t){var e=i.RoleCenter.instans.rebirthBossHurtRank[t]||[];e.sort(this.sortHurt),this.list_.dataSource=e},t.prototype.listRenderHandler=function(t,e){var i=t.getChildByName("idx"),n=t.getChildByName("name"),s=t.getChildByName("hurt"),o=t.dataSource;i.text=o.rank+"",n.text=o.nickname,s.text=o.hurtval+""},t.prototype.sortHurt=function(t,e){return t.rank-e.rank},t}(ui.boss.ZsHurtRankDlgUI);e.ZsHurtRankDlg=n}),define("src/g/boss/vo/PersonBossVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){this.index=0,this.count=0};e.PersonBossVo=i}),define("src/g/chat/view/NewChatNoticeItem",["require","exports","src/g/chat/ctrl/ChatContentManager"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.style.color="#a89e8f",t.style.font="SimHei",t.style.fontSize=20,t.autoSize=!0,t.style.valign="middle",t}return __extends(t,e),t.prototype.setData=function(t){this.offAll(),this.innerHTML=i.ChatContentManager.chatMsgToStr(t,!1,!0),this.on(Laya.Event.LINK,this,this.onLinkHandler)},t.prototype.onLinkHandler=function(t){i.ChatContentManager.onLinkHandler(t)},t}(Laya.HTMLDivElement);e.NewChatNoticeItem=n}),define("src/g/crossserboss/view/KFShenQiJinDiPage",["require","exports","src/g/clearRes/ClearResM","src/g/fight/osprite/play/kfshenqijindi/KfShenQiJinDiManager","../../../utils/ItemUtils","../../net/messages/kuafu/KfsqjdBattleMsg","../../../config/GameConfig","../../../manager/RoleCenter","../../../manager/GameSocketManager","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../core/E","../../../enum/EventName","../../../manager/AM","src/init/TextConst"],function(t,e,n,p,d,s,h,g,o,v,f,a,r,l,c,u,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var e=i.call(this)||this;e.chooseIndex=-1,e.rewardDict={},e.portID0=0,e.portAllID0=[],e.portID1=0,e.portAllID1=[],e.portID2=0,e.portAllID2=[],e.on(Laya.Event.UNDISPLAY,e,e.unDisplay),e.btn_enter.on(Laya.Event.CLICK,e,e.enterGame),o.GSM.ins.on(s.KFSQJDBuyEnterCntGS2C.KEY,e,e.onBuyEnterCntGS2C),e.initList();for(var t=0;t<3;t++)e["btn_floor"+t].on(Laya.Event.CLICK,e,e.refreshList,[t]);return e.openlevel=p.KfShenQiJinDiManager.ins().getSetting("openlevel").value.split(","),e.buyTime=p.KfShenQiJinDiManager.ins().getSetting("buyTime").value.split(","),e.txt_buyGold.text=e.buyTime[1],e.lab_buy.on(Laya.Event.CLICK,e,function(){var t=g.RoleCenter.instans.vo.KFSQJD_BUYCNT;0<t?u.AM.show(y.TextConst.get(1090,e.buyTime[1],t,e.buyTime[0]),Laya.Handler.create(e,e.buyCount)):u.AM.show(y.TextConst.get(878))}),e.refreshList(),e}return __extends(t,i),t.prototype.unDisplay=function(){n.ClearResM.clearUrl(this.murl),n.ClearResM.clearFolderByUrl("dynamic/zhizunshenqi/iconTM")},t.prototype.initList=function(){this.card_list.mouseHandler=new Laya.Handler(this,this.clickMonster),this.reward_list.renderHandler=new Laya.Handler(this,this.rewardRenderHander),this.reward_list.mouseHandler=new Laya.Handler(this,this.click),this.reward_list.scrollBar.elasticDistance=50,this.initMonster(),this.initReward()},t.prototype.click=function(t){if(t.type==Laya.Event.CLICK){var e=t.currentTarget;r.ItemTips.ins.showTip(e.dataSource,1)}},t.prototype.initMonster=function(){var t=p.KfShenQiJinDiManager.ins();this.portID0=t.getSetting("portId1").value||0;var e=t.getSetting("portAllId1").value||"";this.portAllID0=e.split(","),this.portID1=t.getSetting("portId2").value||0,e=t.getSetting("portAllId2").value||"",this.portAllID1=e.split(","),this.portID2=t.getSetting("portId3").value||0,e=t.getSetting("portAllId3").value||"",this.portAllID2=e.split(",")},t.prototype.initReward=function(){var t=h.GameConfig.kfsqjdVo,e=null,i=[];for(var n in t){var s=(e=t[n]).showReward;this.rewardDict[e.port]=s;for(var o=0;o<3;o++)if(i[o]||(i[o]=[]),0<=this["portAllID"+o].indexOf(e.port+""))for(var a=0;a<s.length;a++)i[o].indexOf(s[a])<0&&i[o].push(s[a])}for(o=0;o<3;o++)this.rewardDict[this["portID"+o]]=i[o]},t.prototype.buyCount=function(){if(g.RoleCenter.instans.vo.GOLD<Number(this.buyTime[1]))v.FE.upItems("购买神器禁地进入次数失败，元宝不足",f.BubbleEnum.center);else{var t=new s.KFSQJDBuyEnterCntC2GS;t.kf_username=g.RoleCenter.instans.self.username,t.buyCnt=1,o.GSM.sendServer(t)}},t.prototype.onBuyEnterCntGS2C=function(t){if(g.RoleCenter.instans.self.username==t.kf_username){var e=t.buyEnterState;if(e==s.KFSQJDBuyEnterState.SUCCESS)this.updateChallengeNum(t.enterCnt);else switch(e){case s.KFSQJDBuyEnterState.FAILED_0:v.FE.upItems("购买神器禁地进入次数失败，元宝不足",f.BubbleEnum.center);break;case s.KFSQJDBuyEnterState.FAILED_1:v.FE.upItems("购买神器禁地进入次数失败，超出次数上限",f.BubbleEnum.center)}}},t.prototype.updateChallengeNum=function(t){void 0===t&&(t=0),this.lab_lastNum.text=t+"",this.btn_enter.disabled=0==t,l.E.ins.event(c.EventName.UPDATE_REDDOT,268),n.ClearResM.resetViewImg(this)},t.prototype.refreshList=function(t){if(void 0===t&&(t=0),this.chooseIndex!=t){var e=this.openlevel;if(1==t&&Number(e[0])>g.RoleCenter.instans.vo.getCurLv())v.FE.upItems("达到"+Math.floor(Number(e[0])/1e3)+"转开启",f.BubbleEnum.center);else if(2==t&&Number(e[1])>g.RoleCenter.instans.vo.getCurLv())v.FE.upItems("达到"+Math.floor(Number(e[1])/1e3)+"转开启",f.BubbleEnum.center);else{this.chooseIndex=t;for(var i=0;i<3;i++)this["Img_choose"+i].visible=i==t;var n=[],s=this["portAllID"+t];for(i=0;i<s.length;i++){var o=Number(s[i]),a=d.ItemUtils.getPortVoById(o);if(a){var r=d.ItemUtils.getMonsterVOById(a.boss[0]);if(r){var l=r.id,h=d.ItemUtils.getBossIccon(l);n.push({card_name:"dynamic/zhizunshenqi/iconTM/"+l+".png",card_skin:h,monsterID:l})}}}this.card_list.array=n;var c=p.KfShenQiJinDiManager.ins().getSetting("portId"+(t+1)).value||"";this.reward_list.array=this.rewardDict[c];var u=p.KfShenQiJinDiManager.ins().getSetting("portId"+(t+1)).value;p.KfShenQiJinDiManager.ins().reqOpenBossInfoPanel(u)}}},t.prototype.enterGame=function(){if(!(this.chooseIndex<0||2<this.chooseIndex)){var t=p.KfShenQiJinDiManager.ins().getSetting("portId"+(this.chooseIndex+1)).value;p.KfShenQiJinDiManager.ins().enterHotBloodWar(t)&&this.parent.removeChildren()}},t.prototype.rewardRenderHander=function(t,e){a.ItemCellUtils.fillCellForItem0View(t,t.dataSource,1)},t.prototype.clickMonster=function(t,e){if(t.type==Laya.Event.CLICK){var i=this.card_list.getItem(e).monsterID,n=d.ItemUtils.getMonsterVOById(i),s="dynamic2/monster/mon_"+n.res+"/3_s.json";this.murl=s;var o=this.bossView;o||(this.bossView=o=new ui.crossserver.KFSQJDBossViewUI,o.list_reward.renderHandler=new Laya.Handler(this,this.rewardRenderHander),o.list_reward.mouseHandler=new Laya.Handler(this,this.click),o.list_reward.scrollBar.elasticDistance=50),o.ani.loadAtlas(s,new Laya.Handler(this,function(){var t=o.ani.frames[0]._one[0].sourceWidth,e=o.width/2-t/2;o.ani.x=e,o.ani.y=300-t/2,1e3<=t&&(o.ani.y+=100)})),o.txt_name.text=n.name,o.list_reward.array=this.rewardDict[i];var a=h.GameConfig.kfsqjdVo,r=null;for(var l in a)(r=a[l]).port==i&&(o.lab_shenqiValue.text=r.shenliValue+"",o.lab_time.text=Math.floor(r.cd/60)+"分钟");o.bg.restskin(),o.popup()}},t}(ui.crossserver.CSShenQiJinDIUI);e.KFShenQiJinDiPage=i}),define("src/g/crossserboss/ctrl/KFShenQiJinDiPageCtrl",["require","exports","src/g/crossserboss/view/KFShenQiJinDiPage","src/g/base/BaseCtrl","../../../manager/RoleCenter"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.urls=["res/atlas/res/shenqijindi.json","res/bg/chongwutips_diban.png"],t}return __extends(t,e),t.prototype.init=function(){},t.prototype.showPage=function(t,e){t&&(this._parent=t,this.opens())},t.prototype.onAtlasLoaded=function(){this._parent&&(this._parent.removeChildren(),this._view||(this._view=new i.KFShenQiJinDiPage),this._view.updateChallengeNum(s.RoleCenter.instans.vo.KFSQJD_CNT),this._parent.addChild(this._view))},t.prototype.loadUrls=function(){},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){},t.prototype.getTitle=function(){return"res/title/szly_biaoti_001.png"},t.prototype.hidePage=function(){this._view&&this._view.removeSelf()},t.prototype.destroyPage=function(){this.hidePage()},t}(n.BaseCtrl);e.KFShenQiJinDiPageCtrl=o}),define("src/g/login/vo/voLoginData",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.key="voLoginDataNew",t.secondKey="allUserName",t.thirdlyKey="allUserPassward",t}();e.voLoginData=i}),define("src/g/custom/TestChannelItem",["require","exports","src/g/login/vo/voLoginData","src/g/gameSdk/gameSdk"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.voLoginD=new i.voLoginData,t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){this.btn_user.on(Laya.Event.CLICK,this,this.onClick,[])},t.prototype.onClick=function(t,e){if(utils.LocalUtil.getAnyLocal(utils.LocalEnum.thirdlyKey)){var i=utils.LocalUtil.getAnyLocal(utils.LocalEnum.thirdlyKey);i=i.replace("null","");new Array;e=i.split(",")[this.chackName(this.btn_user.label)],this.voLoginD.username=this.btn_user.label,this.voLoginD.passward=e,utils.LocalUtil.setAnyLocal(utils.LocalEnum.voLoginDataNew,this.voLoginD),n.gameSdk.Ins.sdk.logout(""),window.reload()}},t.prototype.chackName=function(t){var e=utils.LocalUtil.getAnyLocal(utils.LocalEnum.secondKey);e=e.replace("null","");var i=new Array;i=e.split(",");for(var n=0;n<i.length;n++)if(i[n]==t)return n},t.prototype.setSkin=function(t){this.btn_user.label=t,""==this.btn_user.label&&(this.visible=!1)},t}(ui.custom.TestChannelItemUI);e.TestChannelItem=s}),define("src/g/custom/TestChannel",["require","exports","src/g/custom/TestChannelItem","src/g/gameSdk/gameSdk"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.init(),t}return __extends(t,e),t.prototype.onClean=function(){utils.LocalUtil.setAnyLocal(utils.LocalEnum.voLoginDataNew,this._channelItem.voLoginD),window.reload(),n.gameSdk.Ins.sdk.logout(""),Laya.LocalStorage.clear()},t.prototype.rendHandler=function(t,e){t.setSkin(t.dataSource)},t.prototype.init=function(){if(utils.LocalUtil.getAnyLocal(utils.LocalEnum.secondKey)){this._channelItem||(this._channelItem=new i.TestChannelItem),this.list.vScrollBarSkin="",this.list.scrollBar.elasticDistance=50,this.list.itemRender=i.TestChannelItem,this.list.renderHandler=new Laya.Handler(this,this.rendHandler),this.btn_clean.on(Laya.Event.CLICK,this,this.onClean);var t=utils.LocalUtil.getAnyLocal(utils.LocalEnum.secondKey);t=t.replace("null","");var e=new Array;e=t.split(","),this.list.array=e}},t}(ui.custom.TestChannelUI);e.TestChannel=s}),define("src/g/custom/TipPOP",["require","exports","../../utils/ItemUtils"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(t){var e=i.ItemUtils.getItemVoById(t);this.item_name.text=e.name,this.item_name.color=i.ItemUtils.getQualityColorById(t),this.img_quality.skin=i.ItemUtils.getQualityBjById(t),this.img_item.skin=i.ItemUtils.getIconById(t),this.item_des.text=e.desc},e}(ui.index.TipPOPUI);e.TipPOP=n}),define("src/g/feisheng/view/GetFSExp",["require","exports","../../../manager/GameSocketManager","../../../config/GameConfig","../../../manager/RoleCenter","../../../utils/ItemUtils","src/g/custom/detailDlgs/Details_Item","../../net/messages/OpResultType","../../net/messages/UseItemC2GS","src/g/Effects/UIEffectsFactory","../../../enum/EventName","../../../core/E","../../net/messages/feishengzhuang/sbkFeiShengZhuangMsg","src/init/Switches","src/init/TextConst"],function(t,e,s,a,o,r,n,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t.set=a.GameConfig.fsseting,t.btnUpAni=null,t._showLevel=-1,t._showExp=-1,t._showTotalExp=-1,t._targetExp=-1,t._addExpSpeed=10;for(var e=0;e<3;e++)t["text_"+e].style.fontSize=20,t["text_"+e].style.font="SimHei",t["text_canget_"+e].style.fontSize=20,t["text_canget_"+e].style.font="SimHei",t["icon_"+e].on(Laya.Event.CLICK,t,t.onClickIcon,[e]),t["btn_"+e].on(Laya.Event.CLICK,t,t.onClickUseBtn,[e]);return t.canUseArr=t.set.exchangecount,t.uvo=o.RoleCenter.instans.vo,t.bg.imgInnerBg.bottom=90,t.btn_up.on(Laya.Event.CLICK,t,t.onUp),t.bg.btn_back.on(Laya.Event.CLICK,t,t.close),t.bg.btn_close.on(Laya.Event.CLICK,t,t.close),t.on(Laya.Event.UNDISPLAY,t,t.unDisplay),o.RoleCenter.instans.on(l.enumOpResultType.feisheng_downLv+"",t,t.onDownLv),o.RoleCenter.instans.on(l.enumOpResultType.feisheng_reset+"",t,t.reSetZS),p.E.ins.on(u.EventName.CHANGECURRENCY,t,t.onChangeCurrency),p.E.ins.on(u.EventName.USEITEMOVER,t,t.onUse),t}return __extends(t,i),t.prototype.unDisplay=function(){o.RoleCenter.instans.off(l.enumOpResultType.shenshi_downLv+"",this,this.onDownLv),o.RoleCenter.instans.off(l.enumOpResultType.shenshi_reset+"",this,this.reSetZS),p.E.ins.off(u.EventName.CHANGECURRENCY,this,this.onChangeCurrency),p.E.ins.off(u.EventName.USEITEMOVER,this,this.onUse)},t.prototype.popup=function(t,e){i.prototype.popup.call(this,t,e),this.onAtlasLoaded()},t.prototype.onAtlasLoaded=function(){this.refreshData()},t.prototype.reSetZS=function(t){t.opresult&&this.refreshData()},t.prototype.onDownLv=function(t){this.refreshData()},t.prototype.onUse=function(t){var e=this.uvo.fsData.fsArrCount;t.cfgId!=this.set.item1&&t.cfgId!=this.set.item2||(t.cfgId==this.set.item1?e[1]++:t.cfgId==this.set.item2&&e[2]++,this.refreshData())},t.prototype.onUp=function(){var t=a.GameConfig.feishengjson[this.uvo.fsData.fsLv+1];if(t&&this.uvo.FSEXP>=t.cost[0][1]){var e=new d.sbkFeiShengC2GS;e.msgidx=l.enumOpResultType.feisheng,s.GSM.sendServer(e)}},t.prototype.onChangeCurrency=function(t){"FSEXP"==t&&this.initExp()},t.prototype.onClickUseBtn=function(t){if(0==t)return(i=new d.sbkFeiShengC2GS).msgidx=l.enumOpResultType.feisheng_downLv,void s.GSM.sendServer(i);var e=this.set["item"+t];if(0<this.uvo.bagdata.getItemCount(e)){(i=new h.UseItemC2GS).cfgId=e,i.count=1,s.GSM.sendServer(i)}else{var i,n=r.ItemUtils.getShop2VoByItemId(e);if(o.RoleCenter.instans.vo.GOLD<n.cost[0][1])return g.Switches.ins.event(155),void this.close();(i=new h.BuyAndUseItemC2GS).cfgId=n.id,s.GSM.sendServer(i)}this["btn_"+t].disabled=!0},t.prototype.onClickIcon=function(t){var e=new n.Details_Item;0==t?e.initData_CurrencyVo(r.ItemUtils.getCurrencyVoByDefine(this.set.item0),this.expnum):e.initData(r.ItemUtils.getItemVoById(this.set["item"+t]),1,!1),e.popup()},t.prototype.refreshData=function(){this.setIcon(),this.setCanGetCount(),this.setAddText(),this.checkHave(),this.initExp(),p.E.ins.event(u.EventName.FLYUPCHANGE),this.refreshHandler&&this.refreshHandler.run()},t.prototype.setCanGetCount=function(){var t=this.uvo.fsData.fsArrCount;this.text_canget_0.innerHTML=this.getCanUse(this.canUseArr[0]-t[0]),this.text_canget_1.innerHTML=this.getCanUse(this.canUseArr[1]-t[1]),this.text_canget_2.innerHTML=this.getCanUse(this.canUseArr[2]-t[2])},t.prototype.setIcon=function(){this.icon_0.img_item.skin=r.ItemUtils.getIconByDefine(this.set.item0),this.icon_0.img_quality.skin=r.ItemUtils.getQualitybjByQualityId(r.ItemUtils.getCurrencyByDefine(this.set.item0).quality),this.icon_0.lab_num.visible=!1;for(var t=1;t<3;t++){var e=this["icon_"+t];e.img_item.skin=r.ItemUtils.getIconById(this.set["item"+t]),e.img_quality.skin=r.ItemUtils.getQualityBjById(this.set["item"+t]),e.lab_num.text=""}},t.prototype.checkHave=function(){for(var t=this.uvo.bagdata.getItemCount(this.set.item1),e=this.uvo.bagdata.getItemCount(this.set.item2),i=this.uvo.fsData.fsArrCount,n=0;n<3;n++){var s=!1;i[n]>=this.canUseArr[n]&&(s=!0),0==n&&a.GameConfig.commonJson.fslevelmin.value>this.uvo.lvl&&(s=!0),this["btn_"+n].disabled=s}if(0==this.btn_0.disabled){var o=this.ani_downLv.getChildByName("ani");o||((o=c.UIEffectsFactory.Ins.createUIAniById(42,!0)).height*=1.1,o.scaleY=1.1,o.width*=1.3,o.scaleX=1.3,o.name="ani",c.UIEffectsFactory.Ins.centered4Parent(o,this.ani_downLv,!0))}else this.ani_downLv.removeChildren();0<t&&(this.box_1.getChildByName("text_useCount").text=v.TextConst.get(727,t)),this.btn_1.label=0<t?v.TextConst.get(728):v.TextConst.get(729),this.box_1.getChildByName("box_show").visible=!(0<t),this.box_1.getChildByName("text_useCount").visible=0<t,this.red_item.visible=!this.btn_1.disabled&&0<t,0<e&&(this.box_2.getChildByName("text_useCount").text=v.TextConst.get(727,e)),this.btn_2.label=0<e?v.TextConst.get(728):v.TextConst.get(729),this.box_2.getChildByName("box_show").visible=!(0<e),this.box_2.getChildByName("text_useCount").visible=0<e,this.red_superItem.visible=!this.btn_2.disabled&&0<e},t.prototype.setAddText=function(){var t=a.GameConfig.commonJson.fslevelmin.value;this.lab_limit.text=v.TextConst.get(1040,t);var e=this.uvo.lvl-t;e=this.set.levelzsexp[e],this.btn_0.disabled=!1,(this.expnum=e)||(e=0,this.expnum=0,this.btn_0.disabled=!0),this.text_0.innerHTML=this.getAddText(e);var i=r.ItemUtils.getItemVoById(this.set.item1);this.text_1.innerHTML=this.getAddText(i.effect[0][1]),this.txt_item1.text=i.name,i=r.ItemUtils.getItemVoById(this.set.item2),this.text_2.innerHTML=this.getAddText(i.effect[0][1]),this.txt_item2.text=i.name},t.prototype.getAddText=function(t){return v.TextConst.get(1179,t)},t.prototype.getCanUse=function(t){return v.TextConst.get(731,0!=t?"#03bb00":"#ff0f15",t)},t.prototype.initExp=function(){var t=a.GameConfig.feishengjson[this.uvo.fsData.fsLv],e=a.GameConfig.feishengjson[this.uvo.fsData.fsLv+1];if(e&&this.uvo.FSEXP>=e.cost[0][1]?(this.btnUpAni||(this.btnUpAni=c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_up,42,2.5,1.5),this.btnUpAni.y+=5),this.btnUpAni.visible=!0):this.btnUpAni&&(this.btnUpAni.visible=!1),this.text_max.text=t.name,!e)return this.text_count.changeText(v.TextConst.get(208)),this.bar_count.width=374,this.box_lv.visible=!1,this.btn_up.disabled=!0,void(this.text_max.visible=!0);this.text_left.text=t.name,this.text_right.text=e.name,this.box_lv.visible=!0,this.text_max.visible=!1,Laya.timer.callLater(this,this.setExpPro)},t.prototype.setExpPro=function(){-1==this._showLevel&&-1==this._showExp?(this._showLevel=this.uvo.fsData.fsLv,this._showExp=this.uvo.FSEXP,this._showTotalExp=this.getLevelExp(this.uvo.fsData.fsLv),this.calculateAddSpeed(),this.updateExpProcess(this.uvo.FSEXP,this._showTotalExp)):(this.uvo.fsData.fsLv>this._showLevel?this._targetExp=this.getLevelExp(this._showLevel):this._targetExp=this.uvo.FSEXP,Laya.timer.frameLoop(1,this,this.updateExp,null,!0))},t.prototype.updateExp=function(){this._showExp=this._showExp+this._addExpSpeed,this._showExp>this._targetExp&&(this._showExp=this._targetExp,this.uvo.fsData.fsLv>this._showLevel?(this._showLevel+=1,this._showTotalExp=this.getLevelExp(this._showLevel),this.calculateAddSpeed(),this._showExp=0,this._showLevel==this.uvo.fsData.fsLv?this._targetExp=this.uvo.FSEXP:this._targetExp=this._showTotalExp):Laya.timer.clear(this,this.updateExp)),this.updateExpProcess(this._showExp,this._showTotalExp)},t.prototype.calculateAddSpeed=function(){this._addExpSpeed=Math.floor(this.getLevelExp(this._showLevel)/50),this._addExpSpeed<1&&(this._addExpSpeed=1)},t.prototype.getLevelExp=function(t){var e=a.GameConfig.feishengjson[t+1];return e||(e=a.GameConfig.feishengjson[t]),e.cost[0][1]},t.prototype.updateExpProcess=function(t,e){this.text_count.changeText(t+"/"+e);var i=!1;t<e&&(i=!0),this.btn_up.disabled=i;var n=t/e*374;this.bar_count.width=374<=n?374:n},t.prototype.close=function(){Laya.timer.clearAll(this),i.prototype.close.call(this),this.refreshHandler&&this.refreshHandler.clear(),this.refreshHandler=null,p.E.ins.event(u.EventName.FLYUPCHANGE)},t}(ui.feisheng.GetFSEXPDlgUI);e.GetFSExp=i}),define("src/g/feisheng/view/FeiShengView",["require","exports","../../../manager/RoleCenter","../../../config/GameConfig","../../../utils/ItemUtils","../../../utils/RoleUtil","src/g/feisheng/view/GetFSExp","../../net/messages/feishengzhuang/sbkFeiShengZhuangMsg","../../net/messages/OpResultType","../../../manager/GameSocketManager","src/g/Effects/UIEffectsFactory","../../../manager/NewRedHintsCenter","src/init/TextConst"],function(t,e,r,l,h,c,i,n,s,o,a,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.btn_getZSEXP.on(Laya.Event.CLICK,t,t.ongetZSEXP),t.btn_up.on(Laya.Event.CLICK,t,t.upHandler),t.onLoadUIEF(),t}return __extends(t,e),t.prototype.onLoadUIEF=function(){this.ani_up=a.UIEffectsFactory.Ins.createUIAniById(40,!0),a.UIEffectsFactory.Ins.centered4Parent(this.ani_up,this.btn_up,!0),this.ani_put=a.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_getZSEXP,42,1,.9),this.ani_put.visible=!1,this.ani_up.visible=!1},t.prototype.upHandler=function(){var t=r.RoleCenter.instans.vo,e=l.GameConfig.feishengjson[t.fsData.fsLv+1];if(e&&t.FSEXP>=e.cost[0][1]){var i=new n.sbkFeiShengC2GS;i.msgidx=s.enumOpResultType.feisheng,o.GSM.sendServer(i)}},t.prototype.closeHandler=function(){this.removeSelf()},t.prototype.ongetZSEXP=function(){var t=new i.GetFSExp;t.popup(),t.refreshHandler=new Laya.Handler(this,this.showView)},t.prototype.showView=function(){var t=r.RoleCenter.instans.vo,e=t.fsData;if(e){for(var i=e.fsLv,n=l.GameConfig.feishengjson[i],s=l.GameConfig.feishengjson[i+1],o=n.prop,a=0;a<o.length;a++)this["cpro"+a].text=h.ItemUtils.getShuXingByName(o[a][0]).desc+":"+o[a][1];if(s)for(a=0;a<o.length;a++)this["npro"+a].text=s?h.ItemUtils.getShuXingByName(s.prop[a][0]).desc+":"+s.prop[a][1]:p.TextConst.get(208);this.box_fight.setFightNum(c.RoleUtil.calFightByProp(o)*t.heronum),this.jie.num.value=n.id+""}this.setNeedAndHas(),this.ani_put.visible=u.NewRedHintsCenter.ins.checkRedIsOpen(u.enumRedHints.flyuppage)},t.prototype.setNeedAndHas=function(){var t=r.RoleCenter.instans.vo,e=t.FSEXP,i=t.fsData;this.lab_has.text=e+"",this.ani_up.visible=!1;var n=l.GameConfig.feishengjson[i.fsLv+1];n?(this.lab_need.text=n.cost[0][1]+"",this.btn_getZSEXP.visible=!0,this.btn_up.visible=!0,n.cost[0][1]>e?this.lab_has.color="#ff0f15":(this.ani_up.visible=!0,this.lab_has.color="#03bb00")):(this.lab_need.text="0",this.btn_up.visible=!1,this.btn_getZSEXP.visible=!1,this.lab_has.color="#03bb00")},t}(ui.feisheng.FlyUpViewUI);e.FeiShengView=d}),define("src/g/feisheng/ctrl/FeishengCtrl",["require","exports","src/g/base/BaseCtrl","src/g/feisheng/view/FeiShengView","src/g/accessctrl/AccessCenter","../../../config/GameConfig","../../../manager/RoleCenter","../../../plugin/sbkPropTool","../../../enum/EventName","src/g/fight/osprite/SceneObjCtroller","../../net/messages/OpResultType","../../../core/E","../../../manager/NewRedHintsCenter"],function(t,e,i,n,h,c,u,s,o,a,r,l,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.url="res/atlas/res/feisheng.json",u.RoleCenter.instans.on(r.enumOpResultType.feisheng+"",t,t.OnZhuanShengOVER),l.E.ins.on(o.EventName.FLYUPCHANGE,t,t.redHandler),t}return __extends(t,e),t.prototype.init=function(){},t.prototype.showPage=function(t,e){t&&(this._parent=t,this.open())},t.prototype.redHandler=function(){this.checkredHandler()},t.prototype.checkredHandler=function(){if(h.AccessCenter.ins.checkOpen(300)){var t=u.RoleCenter.instans.vo,e=t.FSEXP,i=t.fsData,n=c.GameConfig.feishengjson[i.fsLv+1];p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.flyuppage,!1),n?n.cost[0][1]<=e&&p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.flyuppage,!0):p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.flyuppage,!1);var s=c.GameConfig.fsseting,o=s.exchangecount,a=i.fsArrCount;o[0]>a[0]&&c.GameConfig.commonJson.fslevelmin.value<t.lvl&&p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.flyuppage,!0);var r=t.bagdata.getItemCount(s.item1),l=t.bagdata.getItemCount(s.item2);o[1]>a[1]&&r&&p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.flyuppage,!0),o[2]>a[2]&&l&&p.NewRedHintsCenter.ins.setRedHintOpenOrClose(p.enumRedHints.flyuppage,!0)}},t.prototype.onAtlasLoaded=function(){this._view||(this._view=new n.FeiShengView),this._parent&&(this._parent.removeChildren(),this._parent.addChild(this._view),this.checkredHandler(),this._view.showView())},t.prototype.OnZhuanShengOVER=function(t){var e=u.RoleCenter.instans.vo,i=c.GameConfig.feishengjson[t.reservedata[0]];e.fsData.fsLv=t.reservedata[0],s.sbkPropTool.resetFeisheng(),e.combat=e.reCheckComBat(),u.RoleCenter.instans.vo.FSEXP-=i.cost[0][1],u.RoleCenter.instans.event(o.EventName.FIGHT_UP,t.reservedata[1]),this.redHandler(),this._view&&this._view.displayedInStage&&this._view.showView(),a.SceneObjCtroller.ins.getSelfGroup().resetHP()},t.prototype.loadUrls=function(){},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){},t.prototype.getTitle=function(){return"res/title/feisheng.png"},t.prototype.hidePage=function(){this._view&&this._view.removeSelf()},t.prototype.destroyPage=function(){this.hidePage()},t}(i.BaseCtrl);e.FeishengCtrl=d}),define("src/g/field/ctrl/FieldRedDotCtr",["require","exports","../../../manager/RoleCenter","../../../enum/EventName","../../../core/E"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t){this._red_view=t,s.E.ins.on(n.EventName.MEETPKDATA_CHANGE,this,this.updateFieldRed),Laya.timer.once(2e3,this,this.updateFieldRed),s.E.ins.on(n.EventName.HANGUP,this,this.updateFieldRed)}return t.prototype.updateFieldRed=function(){i.RoleCenter.instans.vo.portstatus.portindex<120&&(this._red_view.visible=!1);var t=i.RoleCenter.instans.vo.meetPkData;(this._red_view.visible=!1,t.isopen)&&(t.pkuserlist.length+t.revengelist.length&&(this._red_view.visible=!0))},t.prototype.portChangeHandler=function(){},t}();e.FieldRedDotCtr=o}),define("src/g/field/view/FieldItem",["require","exports","../../../utils/ItemUtils","../../../enum/EventName","../../../core/E","../../../manager/RoleCenter","../../../manager/AM","../../../manager/StateManger","../../../utils/system/ServerTime","../../../utils/system/DateUitl","../../net/messages/OpNoParaC2GS","../../../core/GNet","src/g/fight/info/PlayTypeVo","../../../manager/LayerManager","../../../config/GameConfig","../../net/messages/ChangeSceneMsg","src/init/Switches","src/init/TextConst"],function(t,e,h,i,n,c,s,o,u,a,r,l,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=function(e){function t(){var t=e.call(this)||this;return t.otherUsername="",t._timeCount=0,t.btn_fight.on(Laya.Event.CLICK,t,t.fightHandler),t.btn_find.on(Laya.Event.CLICK,t,t.findNewPerson),t}return __extends(t,e),t.prototype.findNewPerson=function(){var t=c.RoleCenter.instans.self.meetPkData.goldRefCnt,e=g.GameConfig.meetsetting[1].searchcost;t>e.length-1&&(t=e.length-1);var i=e[t],n=(t=c.RoleCenter.instans.self.meetPkData.goldRefCnt,y.TextConst.get(903,i,t));s.AM.show(n,Laya.Handler.create(this,this.okHandler,[i]))},t.prototype.okHandler=function(t){c.RoleCenter.instans.vo.GOLD<t?Laya.timer.once(2,this,function(){f.Switches.ins.event(155)}):l.GNet.sendFight(r.EOpNopara.goldSearchPKEnemy)},t.prototype.fightHandler=function(){c.RoleCenter.instans.bagRoomEnough()?o.StateManger.isSpecialPlay()||(c.RoleCenter.instans.fieldWarBoxSlotEnough()?this.excuteFight():s.AM.showAdvanced(y.TextConst.get(379),Laya.Handler.create(this,this.excuteFight),Laya.Handler.create(this,this.showNearPlayerView),null,y.TextConst.get(380),y.TextConst.get(381))):s.AM.showBagNotEnough()},t.prototype.showNearPlayerView=function(){f.Switches.ins.event(21)},t.prototype.excuteFight=function(){n.E.ins.event(i.EventName.PLAY_TYPE_CHANGE,p.PlayTypeVo.create(v.EPlayType.PLAYTYPE_PVP,this.otherUsername,!1,!1)),d.LayerManager.closeAllPOPWindow()},t.prototype.setData=function(t,e){if(this.con1.visible=!1,this.con2.visible=!1,t){this.con1.visible=!0,this.otherUsername=t.username;var i=t.getCurLv();for(var n in g.GameConfig.meetrewardJson){var s=g.GameConfig.meetrewardJson[n];if(i>=s.lv[0]&&i<=s.lv[1]){this.reward_con.setData(s.reward);break}}var o=t.openhero[0].jobid;this.user_name.text=t.nickname,this.lvl_txt.text=h.ItemUtils.getLVString(i);var a=1;a=t.openhero[0].sex?1:0,this.icon.skin=h.ItemUtils.getHeadUrl(a,o)}else{var r=c.RoleCenter.instans.self.meetPkData;this.con2.visible=!0;var l=u.ServerTime.serverTime;this._timeCount=g.GameConfig.meetsetting[1].interval-(l-r.refreshtime),Laya.timer.clear(this,this.loopHandler),Laya.timer.loop(1e3,this,this.loopHandler)}},t.prototype.loopHandler=function(){if(this._timeCount<=0){this._timeCount=g.GameConfig.meetsetting[1].interval;var t=u.ServerTime.serverTime;return c.RoleCenter.instans.self.meetPkData.refreshtime=t>>0,void(c.RoleCenter.instans.vo.meetPkData.pkuserlist.length<=0&&n.E.ins.event(i.EventName.MEETPKDATA_CHANGE))}t=u.ServerTime.serverTime;this._timeCount=g.GameConfig.meetsetting[1].interval-(t-c.RoleCenter.instans.self.meetPkData.refreshtime),this.time_count.text=a.DateUtil.getMinStr(this._timeCount)},t}(ui.field.FieldItemUI);e.FieldItem=m}),define("src/g/field/view/HelpDialog",["require","exports","../../../utils/ItemUtils","src/g/field/vo/RevengeVo","../../net/messages/MeetPKC2GS","../../../manager/GameSocketManager","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/init/TextConst"],function(t,e,o,a,i,n,s,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.btn_close.once(Laya.Event.CLICK,t,t.close),t.btn_send.on(Laya.Event.CLICK,t,t.sendHandler),t.name_lvl_txt.style.fontSize=24,t.name_lvl_txt.style.leading=3,t}return __extends(t,e),t.prototype.sendHandler=function(){var t=this.des_input.text;if(10<t.length)s.FE.upItems(l.TextConst.get(382),r.BubbleEnum.center);else if(0!=t.length){if(this.close(),t){var e=new i.HelpRevenge2FamilyMsg;e.otherUsername=this._data.itemvo.otherUsername,e.type=this._data.itemvo.type,e.msg=t,n.GSM.sendServer(e)}}else s.FE.upItems(l.TextConst.get(383),r.BubbleEnum.center)},t.prototype.setData=function(t){var e=(this._data=t).othervo.openhero[0].jobid;if(t.othervo.openhero[0].sex)var i=1;else i=0;this.icon.skin=o.ItemUtils.getHeadUrl(i,e);var n=t.othervo.getCurLv(),s=o.ItemUtils.getLVString(n);this.name_lvl_txt.innerHTML=l.TextConst.get(898,t.othervo.nickname,s,a.RevengeVo.getFightTitle(this._data.itemvo.type))},t}(ui.field.HelpDialogUI);e.HelpDialog=h}),define("src/g/field/view/RevengeItem",["require","exports","../../../core/E","../../../enum/EventName","../../../utils/ItemUtils","../../../manager/RoleCenter","../../../manager/AM","src/g/fight/info/PlayTypeVo","../../../manager/StateManger","../../../config/GameConfig","../../net/messages/ChangeSceneMsg","../../../manager/LayerManager","src/g/field/vo/RevengeVo","src/g/field/view/HelpDialog","../../../utils/system/ServerTime","../../../utils/system/DateUitl","../../net/messages/MeetPKC2GS","../../../manager/GameSocketManager","src/init/TextConst"],function(t,e,n,s,c,o,a,r,l,u,h,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this,e=Laya.Event.CLICK;return t.btn_gonghui.on(e,t,t.gotoHelp),t.btn_self.on(e,t,t.clickHandler),t.btn_get.on(e,t,t.getHandler),t.name_lvl_txt.innerHTML="",t.name_lvl_txt.style.fontSize=20,t.name_lvl_txt.style.leading=3,t.name_lvl_txt.style.font="SimHei",Laya.timer.loop(1e3,t,t.loopHandler),t}return __extends(t,i),t.prototype.gotoHelp=function(){var t=new g.HelpDialog;t.popup(),t.setData(this._data)},t.prototype.selfFight=function(){},t.prototype.getHandler=function(){var t=new y.GetHelpRevengeMsg;t.otherUsername=this._data.othervo.username,t.type=this._data.itemvo.type,m.GSM.sendServer(t)},t.prototype.clickHandler=function(){o.RoleCenter.instans.vo.meetPkData.revengecount?o.RoleCenter.instans.bagRoomEnough()?l.StateManger.isSpecialPlay()||(p.LayerManager.closeAllPOPWindow(),this._data.othervo.openhero.length&&n.E.ins.event(s.EventName.PLAY_TYPE_CHANGE,r.PlayTypeVo.create(h.EPlayType.PLAYTYPE_REVENGE,this._data))):a.AM.showBagNotEnough():a.AM.show(_.TextConst.get(389),new Laya.Handler(this,function(){Laya.timer.once(10,this,function(){n.E.ins.event(s.EventName.BUYCOUNTFUCHOU)})}))},t.prototype.loopHandler=function(){if(this._data){var t=this._data.itemvo.helpEndTime-v.ServerTime.serverTime;0<t&&(this.time_count.text=f.DateUtil.getHMS_countdown(t))}},t.prototype.setData=function(t,e){var i=(this._data=t).othervo;if(i){var n,s=i.zhuanshengLv;n=s?_.TextConst.get(18,s,i.lvl):_.TextConst.get(16,i.lvl);var o=_.TextConst.get(898,i.nickname,n,d.RevengeVo.getFightTitle(this._data.itemvo.type));if(t.itemvo.helpNickName?(Laya.timer.clear(this,this.loopHandler),t.itemvo.helpEndTime=0,o=_.TextConst.get(390),this.btn_get.visible=!0,this.btn_self.visible=!1,this.btn_gonghui.visible=!1):(this.btn_get.visible=!1,this.btn_self.visible=!0,this.btn_gonghui.visible=!0),this._data.itemvo.helpEndTime-v.ServerTime.serverTime<=0&&(this._data.itemvo.helpEndTime=0),t.itemvo.helpEndTime?(this.time_con.visible=!0,this.tip_show_con.visible=!1,this.btn_con.visible=!1,Laya.timer.loop(1e3,this,this.loopHandler)):(this.time_con.visible=!1,this.tip_show_con.visible=!0,this.btn_con.visible=!0),i.openhero.length){for(var a in u.GameConfig.meetrewardJson){var r=u.GameConfig.meetrewardJson[a];if(i.lvl>=r.lv[0]&&i.lvl<=r.lv[1]){this.reward_con.setData(r.revengereward);break}}var l=i.openhero[0].jobid;if(i.openhero[0].sex)var h=1;else h=0;this.icon.skin=c.ItemUtils.getHeadUrl(h,l),this.name_lvl_txt.innerHTML=o}}},t}(ui.field.RevengeItemUI);e.RevengeItem=i}),define("src/g/field/view/RevengeView",["require","exports","../../../manager/RoleCenter","src/g/field/view/RevengeItem","../../net/messages/OpNoParaC2GS","../../../core/GNet","../../../manager/GameSocketManager","../../net/messages/OpResultGS2C","../../net/messages/OpResultType","../../../manager/AM","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","../../../core/E","../../../enum/EventName","src/g/field/vo/RevengeVo","../../net/messages/MeetPKC2GS","../../../utils/SoundUtils","../../../config/GameConfig","../../../utils/system/ServerTime","src/init/Switches","src/g/clearRes/ClearResM","src/init/TextConst"],function(t,e,o,n,s,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t.list.itemRender=n.RevengeItem,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=50,t.list.renderHandler=new Laya.Handler(t,t.rendeHandler),t.buy_count.on(Laya.Event.CLICK,t,t.buy_countHandler),t.count_txt.style.fontSize=18,t.count_txt.style.font="SimHei";var e=r.GSM.ins;return e.on(f.GetHelpRevengeMsg.KEY,t,t.updateRevList),e.on(f.HelpRevenge2FamilyMsg.KEY,t,t.onHelpRevenge2FamilyMsg),t.btn_guild.on(Laya.Event.CLICK,t,t.openGuild),d.E.ins.on(g.EventName.BUYCOUNTFUCHOU,t,t.buy_countHandler),d.E.ins.on(g.EventName.updaterevengelist,t,t.updateHandler),t}return __extends(t,i),t.prototype.openGuild=function(){y.SoundUtils.getInstance().playBtnsounds(),C.Switches.ins.event(31)},t.prototype.updateRevList=function(t){for(var e=o.RoleCenter.instans.vo.meetPkData.revengelist,i=0;i<e.length;i++)if(e[i].otherUsername==t.otherUsername){e.splice(i,1);break}this.updateHandler()},t.prototype.onHelpRevenge2FamilyMsg=function(t){for(var e=o.RoleCenter.instans.vo.meetPkData.revengelist,i=0;i<e.length;i++)if(e[i].otherUsername==t.otherUsername&&t.type==e[i].type){e[i].helpEndTime=_.ServerTime.serverTime+43200;break}this.updateHandler(),o.RoleCenter.instans.vo.meetPkData.revengecount--,u.FE.upItems(b.TextConst.get(391),p.BubbleEnum.center),d.E.ins.event(g.EventName.HelpRevenge2FamilyOk),this.updateCount()},t.prototype.rendeHandler=function(t,e){t.setData(this.list.array[e],e)},t.prototype.buy_countHandler=function(){var t=m.GameConfig.meetsetting[1].revengecost;c.AM.show(b.TextConst.get(896,t),Laya.Handler.create(this,this.okBuyHandler))},t.prototype.okBuyHandler=function(){var t=o.RoleCenter.instans.vo.meetPkData,e=m.GameConfig.meetsetting[1].revengebuycount;t.goldrevengecnt>=e?u.FE.upItems(b.TextConst.get(392),p.BubbleEnum.center):o.RoleCenter.instans.vo.GOLD<100?Laya.timer.once(100,this,function(){C.Switches.ins.event(155)}):a.GNet.sendFight(s.EOpNopara.goldBuyRevengeTime)},t.prototype.updateHandler=function(){d.E.ins.off(g.EventName.OTHERDATA_UPDATE,this,this.updateHandler);for(var t=[],e=o.RoleCenter.instans.self.meetPkData.revengelist,i=0;i<e.length;i++){var n=new v.RevengeVo;n.itemvo=e[i];var s=o.RoleCenter.instans.getOtherData(n.itemvo.otherUsername);s?(n.othervo=s,t.push(n)):console.error("复仇者信息没有")}this.list.array=t},t.prototype.showView=function(){d.E.ins.on(g.EventName.OTHERDATA_UPDATE,this,this.updateHandler);for(var t=o.RoleCenter.instans.vo.meetPkData.revengelist,e=[],i=0;i<t.length;i++)e.push(t[i].otherUsername);this.updateCount(),a.GNet.getOtherData(e);var n=r.GSM.ins;l.OpResultGS2C,n.on(l.OpResultGS2C.KEY,this,this.opResultGS2CHandler),this.visible=!0,I.ClearResM.addBgUrl(this.bgimg.skin),this.bgimg.restskin(),d.E.ins.event(g.EventName.updaterevengelist)},t.prototype.updateCount=function(){var t=o.RoleCenter.instans.vo.meetPkData.revengecount,e=t+"/"+m.GameConfig.meetsetting[1].revengecount;if(0<t)var i=b.TextConst.get(897,"#03bb00",e);else i=b.TextConst.get(897,"#ff0f15",e);this.count_txt.innerHTML=i},t.prototype.opResultGS2CHandler=function(t){t.msgidx==h.enumOpResultType.GodBuyRevengeTimes&&(o.RoleCenter.instans.vo.meetPkData.revengecount=t.reservedata[0],o.RoleCenter.instans.vo.meetPkData.goldrevengecnt=t.reservedata[1],this.updateCount(),o.RoleCenter.instans.vo.GOLD-=t.reservedata[2])},t}(ui.field.RevengeUI);e.RevengeView=i}),define("src/g/guide/view/EqItemView",["require","exports","../../../enum/enumItem","../../../utils/ItemUtils","src/g/bag/tips/view/ItemTips","../../../meta/CurrencyVo","src/g/Effects/UIEffectsFactory","../../../meta/QualiyVo","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e.prototype,"eqData",{set:function(t){this.ani_sp.visible=!1,5!=t.qualityNum&&6!=t.qualityNum||(a.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.ani_sp,r.QualityStruct.Ins.getQEffById(t.qualityNum)),this.ani_sp.visible=!0),this.iconSkin.skin=t.res,t.type==i.ItemType.CURRENCY?(1e4<=t.count?this.countNum.text=l.TextConst.get(1,(t.count/1e4).toFixed(1)):(this.countNum.text=t.count+"",t.count<=1&&(this.countNum.text="")),this.pinzhi.skin=n.ItemUtils.getQualitybjByQualityId(t.qualityNum)):t.type==i.ItemType.EQ?this.countNum.text="":t.type==i.ItemType.ITEM&&(this.countNum.text=t.count+"",t.count<=1&&(this.countNum.text="")),t.id&&(this.pinzhi.skin=n.ItemUtils.getQualityBjById(t.id)),this.lv_txt.color=t.quality,1e4<t.id?this.lv_txt.text=n.ItemUtils.getLv(t.lv):this.lv_txt.text=t.name,this.job_icon.skin=n.ItemUtils.getJobIcon(t.job),this.offAll(),this.on(Laya.Event.CLICK,this,function(){s.ItemTips.ins.showTip(t instanceof o.CurrencyVo?t.define:t.id,t.count)})},enumerable:!0,configurable:!0}),e}(ui.guide.EqItemUI);e.EqItemView=h}),define("src/g/field/view/RankItem",["require","exports","src/g/guide/view/EqItemView","../../../utils/ItemUtils","../../../enum/enumItem","src/g/guide/vo/RewardVo","../../../meta/QualiyVo","src/init/TextConst"],function(t,e,s,o,a,r,l,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.jungong_item=t.createList("JUNGONG"),t.soul_item=t.createList("SOUL"),t}return __extends(t,e),t.prototype.setData=function(t,e){2<e?this.rankicon.visible=!1:(this.rankicon.visible=!0,this.rankicon.skin="res/rank/new/paihang_huizhang"+(e+1)+".png"),this.rank_txt.text=i.TextConst.get(388,t.rank.toString().replace(",","-")),this.index_font.value=e+1+"",this.jungong_item.countNum.text=t.JUNGONG+"",this.soul_item.countNum.text=t.SOUL+""},t.prototype.setData1=function(t,e){2<e?this.rankicon.visible=!1:(this.rankicon.visible=!0,this.rankicon.skin="res/rank/new/paihang_huizhang"+(e+1)+".png"),this.rank_txt.text=i.TextConst.get(388,t.rank.toString().replace(",","-")),this.index_font.value=e+1+"",this.jungong_item.countNum.text=t.JUNGONG+"",this.soul_item.countNum.text=t.SOUL+""},t.prototype.createList=function(t){var e=new r.RewardVo;e.type=a.ItemType.CURRENCY;var i=o.ItemUtils.getCurrencyByDefine(t);switch(e.quality=l.QualityStruct.Ins.getQColorById(i.quality),e.qualityNum=i.quality,e.res=o.ItemUtils.getIconByIconId(i.icon),t){case"SOUL":e.id=81}var n=new s.EqItemView;return n.scale(.9,.9),n.eqData=e,this.conList.addChild(n),n},t}(ui.field.RankItemUI);e.RankItem=n}),define("src/g/field/view/RankItem1",["require","exports","../../../utils/ItemUtils","../../../utils/UIUtils"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(t,e){e+=1,this.index_font.value=e+"",this.role_name.text=t.data.nickname,this.pk_txt.text=t.data.value1+"",window.enabledpay&&(this.imgVip.skin=i.ItemUtils.getVipIconByLevel(t.data.vipLv),n.UIUtils.nameAndVipDisplay(this.imgVip,this.role_name)),this.rankicon.skin="",e<4&&(this.rankicon.skin="res/rank/new/paihang_huizhang"+e+".png"),this.img_bg.skin=e%2==0?"res/unpack/paihang_paimingdi2.png":"res/unpack/paihang_paimingdi1.png"},e}(ui.field.FieldRankItemUI);e.RankItem1=s}),define("src/g/field/view/RankView",["require","exports","../../../config/GameConfig","../../../manager/RoleCenter","src/g/field/view/RankItem","../../net/messages/rank/sbkRankDataBase","../../../manager/GameSocketManager","../../../core/GNet","../../net/messages/rank/RankDataGS2C","../../../vo/RedDot/RankItemVo","src/g/field/view/RankItem1","src/init/TextConst"],function(t,e,n,s,i,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t.x=33,t.y=110,t.list.itemRender=i.RankItem,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=50,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t.list_rank.itemRender=c.RankItem1,t.list_rank.vScrollBarSkin="",t.list_rank.scrollBar.elasticDistance=50,t.list_rank.renderHandler=new Laya.Handler(t,t.rankRenderHandler),t}return __extends(t,e),t.prototype.rankRenderHandler=function(t,e){t.setData(this.list_rank.array[e],e)},t.prototype.renderHandler=function(t,e){t.setData(this.list.array[e],e)},t.prototype.resultHandler=function(t){if(t.opresult){for(var e=[],i=t.rankDataArr,n=0;n<i.length;n++){var s=new h.RankItemVo;s.data=i[n],s.type=t.rankIdArr[0],e.push(s)}this.list_rank.array=e;var o=t.rankIdArr[2]>>0;this.rank_txt.text=200<o?u.TextConst.get(384):u.TextConst.get(385,o+1)}else console.log(t.error)},t.prototype.showView=function(t){void 0===t&&(t=0),this.reward_con.visible=0==t?!(this.con_rankList.visible=!0):!(this.con_rankList.visible=!1),r.GNet.getRankList(o.enumRankID.rankid_9,1,200),a.GSM.ins.once(l.RankDataGS2C.KEY,this,this.resultHandler),this.data=[];var e=n.GameConfig.meetrankrewardJSON;for(var i in e)this.data.push(e[i]);this.list.array=this.data,this.pk_txt.text=s.RoleCenter.instans.vo.HONOR+""},t}(ui.field.RankViewUI);e.RankView=p}),define("src/g/field/view/FieldRankView",["require","exports","src/g/field/view/RankView","../../../manager/LayerManager"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t._arrcon=[],t.view.btn_help.visible=!1,t.tab.selectHandler=new Laya.Handler(t,t.selectHandler),t.view.btn_close.on(Laya.Event.CLICK,t,t.closekHandler),t.view.btn_back.on(Laya.Event.CLICK,t,t.closekHandler),t}return __extends(t,e),t.prototype.closekHandler=function(){this.removeSelf()},t.prototype.showView=function(t,e){void 0===t&&(t=0),void 0===e&&(e=!0),n.LayerManager.addInPOPWindowLayer(this,e),this.tab.selectedIndex=0},t.prototype.selectHandler=function(t){this._rankView||(this._rankView=new i.RankView,this._arrcon.push(this._rankView)),this.view.img_title.skin="res/field/yezhan_jianglbiaoti.png",this._rankView.showView(t),this._rankView.visible=!0,this.addChild(this._rankView)},t.prototype.checkRedDot=function(){},t}(ui.field.FieldRankUI);e.FieldRankView=s}),define("src/g/field/vo/TresureBoxVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){this.isopen=!1,this.index=0,this.vip=0};e.TresureBoxVo=i}),define("src/g/field/view/PKBoxItem",["require","exports","../../../manager/AM","src/init/Switches","../../../utils/system/ServerTime","../../../utils/system/DateUitl","../../net/messages/MeetPKTotalDataGS2C","../../../manager/GameSocketManager","../../../config/GameConfig","../../../manager/RoleCenter","src/g/Effects/UIEffectsFactory","src/g/clearRes/ClearResM","src/init/TextConst"],function(t,e,o,a,r,n,i,s,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.con0.on(Laya.Event.CLICK,t,t.openHandler),t.con1.on(Laya.Event.CLICK,t,t.openHandler),t.con2.on(Laya.Event.CLICK,t,t.costHandler),t.con4.on(Laya.Event.CLICK,t,t.openHandler4),t}return __extends(t,e),t.prototype.playEffect=function(){null==this.ef&&(this.ef=c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this,33,1,1,"ani",!1,100),this.ef.mouseEnabled=!1,this.ef.x-=7,this.ef.y-=10),this.ef.on(Laya.Event.COMPLETE,this,this.removeAniHander),this.ef.play(),Laya.timer.once(100,this,function(){this._data&&this.setData(this._data)})},t.prototype.removeAniHander=function(){this.ef.stop(),this.ef.removeSelf()},t.prototype.openHandler4=function(){if(h.RoleCenter.instans.bagRoomEnough()){var t=new i.sbkOpenPkBoxC2GS;t.endTime=this._data.boxvo.endTime,s.GSM.sendServer(t)}else o.AM.showBagNotEnough()},t.prototype.costHandler=function(){if(h.RoleCenter.instans.bagRoomEnough()){var t=l.GameConfig.pkconfig[1],e=h.RoleCenter.instans.vo.GOLD,i=this._data.boxvo.endTime-r.ServerTime.serverTime,n=Math.ceil(i/30*t.clearCdAcer);if(n<=e){var s=p.TextConst.get(900,n);o.AM.show(s,Laya.Handler.create(this,this.okHandler,[n]))}else a.Switches.ins.event(155)}else o.AM.showBagNotEnough()},t.prototype.okHandler=function(t){if(this._data&&this._data.boxvo){var e=new i.sbkOpenPkBoxC2GS;e.endTime=this._data.boxvo.endTime,e.useGold=t,s.GSM.sendServer(e)}},t.prototype.openHandler=function(){this._data.isopen||o.AM.show(p.TextConst.get(386),new Laya.Handler(this,function(){a.Switches.ins.event(101)}))},t.prototype.setData=function(t){if(Laya.timer.clear(this,this.loopHandler),this._data=t,this.con0.visible=!1,this.con1.visible=!1,this.con2.visible=!1,this.con4.visible=!1,this.startClip.visible=!1,this._openAni&&(this._openAni.removeSelf(),this._openAni.stop()),t){if(t.isopen)if(t.boxvo){var e=this._data.boxvo.endTime-r.ServerTime.serverTime,i=l.GameConfig.pkbox[t.boxvo.cfgId];if(i){var n=i.res;this.box1.skin=this.box0.skin="res/unpack/"+n+".png",this.startClip.value=utils.repeat(1,i.quality-2)}if(this.startClip.visible=!0,0<e){this.con2.visible=!0;var s=l.GameConfig.pkconfig[1],o=Math.ceil(e/30*s.clearCdAcer);this.gold_txt.text=o+"",Laya.timer.loop(1e3,this,this.loopHandler)}else this.con4.visible=!0,this.creatAni()}else this.con1.visible=!0;else this.con0.visible=!0,this.vip_txt.text=p.TextConst.get(387,t.vip);u.ClearResM.resetViewImg(this)}},t.prototype.creatAni=function(){this._openAni||(this._openAni=c.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.con4,39,1,1,"ani",!0,100),this._openAni.y=30,this._openAni.x=50),this._openAni.play(),this.con4.addChild(this._openAni)},t.prototype.loopHandler=function(){this.con0.visible=!1,this.con1.visible=!1,this.con2.visible=!1,this.con4.visible=!1;var t=this._data.boxvo.endTime-r.ServerTime.serverTime,e=l.GameConfig.pkconfig[1],i=Math.ceil(t/30*e.clearCdAcer);this.gold_txt.text=i+"",t<0?(Laya.timer.clear(this,this.loopHandler),this.con4.visible=!0,this.creatAni()):(this.con2.visible=!0,this.time_count.text=n.DateUtil.getMinStr(t))},t}(ui.field.TreasureBoxUI);e.PKBoxItem=d}),define("src/g/pvp1v1/view/MineRecordView",["require","exports","../../../manager/MineIngManager","../../../core/E","../../../enum/EventName","../../../manager/NewRedHintsCenter","src/init/TextConst"],function(t,e,o,i,n,s,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(e){function t(){var t=e.call(this)||this;return t.bg.btn_close.on(Laya.Event.CLICK,t,t.onClose),t.list.itemRender=h,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=100,i.E.ins.on(n.EventName.OPEN_REVENGE,t,t.onClose),s.NewRedHintsCenter.ins.setRedHintOpenOrClose(s.enumRedHints.mine_rob_record,!1),t}return __extends(t,e),t.prototype.onClose=function(){this.close()},t.prototype.renderHandler=function(t,e){if(this.list&&this.list.array.length){t.htmlLabel_time.visible=!0,t.htmlLabel_info.visible=!0,t.label_result.visible=!0,t.htmlLabel_time.style.fontSize=18,t.htmlLabel_time.style.font="SimHei",t.htmlLabel_time.style.color="#ccb694",t.htmlLabel_info.style.fontSize=22,t.htmlLabel_info.style.font="SimHei",t.img_bg.skin=e%2==0?"res/unpack/paihang_paimingdi2.png":"res/unpack/paihang_paimingdi1.png";var i=this.list.array[e];i&&(t.htmlLabel_time.innerHTML=i.timeStr,t.htmlLabel_info.innerHTML=i.infoDesc,i.revengeKey?(t.lab_hurtHim.visible=!0,t.label_result.visible=!1):(t.lab_hurtHim.visible=!1,t.label_result.visible=!0),t.label_result.text=i.resultStr,t.label_result.color=i.resultStr==a.TextConst.get(661)?"#09d51f":"#d50909")}else t.htmlLabel_time.visible=!1,t.htmlLabel_info.visible=!1,t.label_result.visible=!1},t.prototype.updateUI=function(t){var e;console.log("掠夺记录长度："+t.robRecordList.length);for(var i=[],n=0;n<t.robRecordList.length;n++){e=t.robRecordList[n];var s=new l;s.timeStr=o.MineIngManager.getRobRecordTime(e),s.infoDesc=o.MineIngManager.getRobRecordInfo(e),s.resultStr=o.MineIngManager.getRobRecordResult(e),e.beRob&&e.win&&(s.revengeKey=!0),i.push(s)}this.list.array=i,this.list.refresh()},t}(ui.pvp1v1.MineRecordViewUI);e.MineRecordView=r;var l=function(){this.timeStr=null,this.infoDesc=null,this.resultStr=null,this.revengeKey=!1};e.MineRecordItemData=l;var h=function(e){function t(){var t=e.call(this)||this;return t.lab_hurtHim.on(Laya.Event.CLICK,t,t.onRevengeHandler),t}return __extends(t,e),t.prototype.onRevengeHandler=function(){i.E.ins.event(n.EventName.OPEN_REVENGE)},t}(ui.pvp1v1.MineRecordItemUI);e.MineRecordItem=h}),define("src/g/field/view/NearPlayerView",["require","exports","../../../enum/EventName","../../../utils/ItemUtils","../../../manager/RoleCenter","src/g/field/view/FieldItem","../../../manager/GameSocketManager","../../../core/E","../../../core/GNet","../../net/messages/rank/sbkRankDataBase","../../net/messages/OpResultType","../../net/messages/OpResultGS2C","../../../config/GameConfig","src/g/field/view/FieldRankView","src/g/field/view/PKBoxItem","src/g/field/vo/TresureBoxVo","../../net/messages/MeetPKTotalDataGS2C","src/g/clearRes/ClearResM","src/init/TextConst","../../../utils/system/DateUitl","src/g/field/vo/RevengeVo"],function(t,e,s,o,p,a,r,l,h,i,c,u,d,g,v,f,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function t(){var t=n.call(this)||this;t.oldRankNum=0,t.list.itemRender=a.FieldItem,t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=100,t.list.renderHandler=new Laya.Handler(t,t.refreshHandler);var e=p.RoleCenter.instans.self.openhero[0].sex,i=p.RoleCenter.instans.self.openhero[0].jobid;return t.icon.skin=o.ItemUtils.getHeadUrl(e,i),l.E.ins.on(s.EventName.MEETPKDATA_CHANGE,t,t.refreshList),l.E.ins.on(s.EventName.OTHERDATA_UPDATE,t,t.pklistHandler),t.btn_rank.on(Laya.Event.CLICK,t,t.onRank),t.treasure_list.itemRender=v.PKBoxItem,t.treasure_list.renderHandler=new Laya.Handler(t,t.treasure_listHandler),t.treasure_list.hScrollBarSkin="",t.treasure_list.scrollBar.elasticDistance=100,l.E.ins.on(s.EventName.updatePKBox,t,t.boxHandler),l.E.ins.on(s.EventName.addNewPKBox,t,t.updBoxHander),t.btn_link.on(Laya.Event.CLICK,t,t.seeHandler),r.GSM.ins.on(y.pkBoxInfoList.KEY,t,t.pkBoxInfoList),t}return __extends(t,n),t.prototype.onRank=function(){this._rankView=this._rankView||new g.FieldRankView,this._rankView.showView()},t.prototype.pkBoxInfoList=function(t){this._recod=new ui.pvp1v1.MineRecordViewUI,this._recod.bg.btn_close.once(Laya.Event.CLICK,this,this.closeReDlg),this._recod.list.itemRender=b,this._recod.list.renderHandler=new Laya.Handler(this,this.renderHandler),this._recod.list.vScrollBarSkin="",this._recod.list.scrollBar.elasticDistance=100,this._recod.popup(),this._recod.list.array=t.infoArr},t.prototype.renderHandler=function(t,e){var i=this._recod.list.array[e];t.date_txt.text=C.DateUtil.getDate(1e3*i.time),1==i.type?t.desc.innerHTML=_.TextConst.get(1002,"我",I.RevengeVo.getFightTitle(i.playType),i.user2,i.boxName):t.desc.innerHTML=_.TextConst.get(1002,i.user1,I.RevengeVo.getFightTitle(i.playType),"我",i.boxName)},t.prototype.seeHandler=function(){var t=new y.GetPkBoxInfoList;r.GSM.sendServer(t)},t.prototype.closeReDlg=function(){this._recod.close()},t.prototype.treasure_listHandler=function(t,e){t.setData(this.treasure_list.array[e])},t.prototype.refreshHandler=function(t,e){t.setData(this.list.array[e],e)},t.prototype.opResultGS2CHandler=function(t){if(t.opresult&&t.msgidx==c.enumOpResultType.rank_self&&t.reservedata[0]==i.enumRankID.rankid_9){var e=t.reservedata[1];this.oldRankNum=e+1,200<this.oldRankNum?this.rank_txt.text=_.TextConst.get(384):this.rank_txt.text=_.TextConst.get(385,this.oldRankNum),r.GSM.ins.off(u.OpResultGS2C.KEY,this,this.opResultGS2CHandler)}},t.prototype.showView=function(){r.GSM.ins.on(u.OpResultGS2C.KEY,this,this.opResultGS2CHandler),h.GNet.rankOpResultC2GS(c.enumOpResultType.rank_self,i.enumRankID.rankid_9),this.visible=!0,this.boxHandler(),this.refreshList(),this.pklistHandler(),m.ClearResM.resetViewImg(this)},t.prototype.updBoxHander=function(t){this.boxHandler();for(var e,i,n=this.treasure_list.array,s=n.length-1;0<=s;s--)if((e=n[s]).isopen&&null!=e.boxvo&&e.boxvo==t){(i=this.treasure_list.getCell(s))&&i.playEffect(),3<s&&this.treasure_list.scrollTo(s);break}},t.prototype.boxHandler=function(){var t=[],e=p.RoleCenter.instans.vo.sbkPkBoxData;if(e){for(var i=0;i<e.openArr.length;i++){(l=new f.TresureBoxVo).boxvo=e.dataArr[i]||null,l.isopen=!0,l.index=i,t.push(l)}for(var n=d.GameConfig.vipJSON,s=d.GameConfig.pkconfig[1].count-e.openArr.length,o=(e.openArr.length,e.openArr.length-d.GameConfig.pkconfig[1].open),a=!1,r=1;r<=s;r++){var l=new f.TresureBoxVo;for(var h in l.boxvo=null,a=l.isopen=!1,o++,n){var c=n[h];for(var u in c.reward){if("PKBOXGROOVECOUNT"==c.reward[u][0]&&c.reward[u][1]==o){a=!0,l.vip=c.id;break}if(a)break}}t.push(l)}this.treasure_list.array=t}},t.prototype.refreshList=function(){var t=p.RoleCenter.instans.self.meetPkData,e=t.pkuserlist;this.pk_txt.text=p.RoleCenter.instans.vo.HONOR+"",this.SOUL_txt.text=t.SOUL+"",this.JUNGONG_txt.text=t.JUNGONG+"",!this.oldRankNum||200<this.oldRankNum?this.rank_txt.text=_.TextConst.get(384):this.rank_txt.text=_.TextConst.get(385,this.oldRankNum);for(var i=[],n=0;n<e.length;n++){p.RoleCenter.instans.getOtherData(e[n])||i.push(e[n])}0<i.length&&h.GNet.getOtherData(i),this.pklistHandler(),this.pkcount.text=_.TextConst.get(901,t.rewardcount,20),this.pkcount.color=0==t.rewardcount?"#ff0f15":"#03bb00"},t.prototype.pklistHandler=function(){for(var t=p.RoleCenter.instans.self.meetPkData,e=t.pkuserlist,i=[],n=0;n<e.length;n++){var s=p.RoleCenter.instans.getOtherData(e[n]);s&&i.push(s)}var o=d.GameConfig.meetsetting[1];i.length<o.maxmeetcount&&i.push(0),this.list.array=i,this.pkcount.text=_.TextConst.get(901,t.rewardcount,20)},t}(ui.field.NearPlayerUI);e.NearPlayerView=n;var b=function(e){function t(){var t=e.call(this)||this;return t.desc.style.fontSize=18,t.desc.style.font="SimHei",t.desc.style.color="#ccb694",t.desc.style.fontSize=22,t}return __extends(t,e),t}(ui.field.PKRecordItemUI);e.PKRecordItem=b}),define("src/g/field/view/PKBoxGetDlg",["require","exports","../../../core/E","../../net/messages/MeetPKTotalDataGS2C","../../../config/GameConfig","../../../utils/system/ServerTime","../../../utils/system/DateUitl","../../../manager/GameSocketManager","../../../manager/RoleCenter","../../../manager/AM","../../../enum/EventName","src/init/Switches"],function(t,e,i,o,a,r,l,h,c,u,n,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(s){function t(){var t=s.call(this)||this;return t.btn_ok.on(Laya.Event.CLICK,t,t.openHandler),t.btn_close.once(Laya.Event.CLICK,t,t.close),t.btn_ok.visible=!1,t}return __extends(t,s),t.prototype.openHandler=function(){if(c.RoleCenter.instans.bagRoomEnough()){var t=a.GameConfig.pkconfig[1],e=c.RoleCenter.instans.vo.GOLD;if(t.consumesGold<=e){var i=this._data.endTime-r.ServerTime.serverTime,n=(e=Math.ceil(i/30*t.clearCdAcer),new o.sbkOpenPkBoxC2GS);n.endTime=this._data.endTime,n.useGold=t.consumesGold,h.GSM.sendServer(n),s.prototype.close.call(this)}else p.Switches.ins.event(155)}else u.AM.showBagNotEnough()},t.prototype.close=function(){o.sbkPkBoxData.addPkBox(c.RoleCenter.instans.vo.sbkPkBoxData,this._data),s.prototype.close.call(this),i.E.ins.event(n.EventName.addNewPKBox,this._data)},t.prototype.showView=function(t){this._data=t;var e=a.GameConfig.pkbox[t.cfgId].res;this.box.skin="res/unpack/"+e+".png";var i=t.endTime-r.ServerTime.serverTime;this.time_count.text=l.DateUtil.getMinStr(i),this.popup(),this.zOrder=9999;i=this._data.endTime-r.ServerTime.serverTime;var n=a.GameConfig.pkbox[t.cfgId];this.lbBoxName.text=n.name},t}(ui.field.PKBoxGetUI);e.PKBoxGetDlg=s}),define("src/g/field/view/PKDlgView",["require","exports","../../../config/GameConfig","../../net/messages/MeetPKTotalDataGS2C","../../../utils/system/ServerTime","../../../utils/system/DateUitl","../../../manager/RoleCenter","../../../manager/AM","../../../manager/GameSocketManager","src/init/Switches","src/init/TextConst"],function(t,e,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(s){function t(){var t=s.call(this)||this;return t.btn_cancel.once(Laya.Event.CLICK,t,t.closeDlg),t.btn_ok.on(Laya.Event.CLICK,t,t.openHandler),t.btn_close.once(Laya.Event.CLICK,t,t.closeDlg),t}return __extends(t,s),t.prototype.openHandler=function(){if(h.RoleCenter.instans.bagRoomEnough()){var t=o.GameConfig.pkconfig[1],e=h.RoleCenter.instans.vo.GOLD;if(t.consumesGold<=e){var i=this._data.endTime-r.ServerTime.serverTime,n=(e=Math.ceil(i/30*t.clearCdAcer),new a.sbkOpenPkBoxC2GS);n.endTime=this._data.endTime,n.useGold=t.consumesGold,u.GSM.sendServer(n),s.prototype.close.call(this)}else p.Switches.ins.event(155)}else c.AM.showBagNotEnough()},t.prototype.closeDlg=function(){var t=new a.sbkOpenPkBoxC2GS;t.endTime=this._data.endTime,t.useGold=-1,u.GSM.sendServer(t),s.prototype.close.call(this)},t.prototype.showView=function(t){this._data=t;var e=o.GameConfig.pkbox[t.cfgId].res;this.box.skin="res/unpack/"+e+".png";var i=t.endTime-r.ServerTime.serverTime;this.time_count.text=l.DateUtil.getMinStr(i),this.popup(),this.zOrder=9999;var n=o.GameConfig.pkconfig[1],s=(i=this._data.endTime-r.ServerTime.serverTime)/10*n.clearCdAcer>>0;this.tip_txt.text=d.TextConst.get(899,s)},t.prototype.close=function(){},t}(ui.field.PKDlgUI);e.PKDlgView=i}),define("src/g/fight/osprite/buff/BaseBuff",["require","exports","../../../../utils/ItemUtils"],function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,i){this._target=t,this.id=e,this.level=i,this.data=n.ItemUtils.getBuffVoById(e),this.register()}return t.prototype.reset=function(){this._endTime=Date.now()+1e3*this.data.cd},t.prototype.register=function(){this.reset()},t.prototype.remove=function(){},t.prototype.get_END=function(){return this._endTime},t.prototype.onUpdate=function(t){},t.prototype.getEffectValue=function(){return 0},t.prototype.removeEffect=function(){},t}();e.BaseBuff=i}),define("src/g/fight/osprite/buff/WuDiBuff",["require","exports","src/g/fight/osprite/buff/basic/DurationBuff"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(i.DurationBuff);e.WuDiBuff=n}),define("src/g/fight/osprite/obj/BossNewVillage",["require","exports","src/g/fight/osprite/obj/MonsterNewVillage"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._start=!1,t}return __extends(t,e),t.prototype.resetHpBar=function(){e.prototype.resetHpBar.call(this),!this._start&&this.getHp()<.5*this.getTotalHp()&&this.readyStart()},t.prototype.readyStart=function(){this._start=!0},t}(i.MonsterNewVillage);e.BossNewVillage=n}),define("src/g/fight/osprite/obj/HitTestSprite",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.hitTestPoint=function(t,e){var i=this.fromParentPoint(Laya.Point.TEMP.setTo(t,e)),n=this._childs[0];return!(!n&&!this.hitArea)&&(n?n.hitTestPoint(i.x,i.y):this.hitArea.contains(i.x,i.y))},e}(Laya.Sprite);e.HitTestSprite=i}),define("src/g/fight/osprite/play/GamePlayNewVillage",["require","exports","../../../../config/GameConfig","src/g/fight/osprite/play/GamePlay","../../../../enum/EventName","../../../../core/E","src/g/fight/osprite/SceneObjCtroller","src/g/fight/osprite/map/MapCovert","../../../../enum/Task","src/g/fight/osprite/SceneObjManager","src/g/fight/osprite/NetCtroller","../../../../manager/TaskManager","src/g/fight/osprite/obj/FightGroup","../../../../manager/RoleCenter","src/g/fight/osprite/play/NewComerRobot","src/g/fight/osprite/play/RobotMgr","../../../../manager/LayerManager","../../../net/messages/ChangeSceneMsg","src/g/fight/osprite/obj/Unit_New","src/g/fight/osprite/obj/BossNewVillage","../../../../utils/ItemUtils","../../../../utils/DropUtil","../../../net/messages/UseItemC2GS","../../../../manager/GameSocketManager"],function(t,e,l,i,h,c,u,p,o,n,s,d,g,v,f,y,m,_,C,I,b,w,S,E){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(a){function r(t){var e=a.call(this,t)||this;return e._monsterUnits=[],e._nvPortId=0,e._robotMgr=new y.RobotMgr,e._canSendEnd=!0,e._index=-1,e}return __extends(r,a),r.prototype.clear=function(){c.E.ins.off(h.EventName.TASK_CHANGE,this,this.onTaskUpdate),c.E.ins.off(h.EventName.TASK_FIGHT_BREAK,this,this.taskFightBreak),c.E.ins.off(h.EventName.TASK_SEND_FIGHT_START,this,this.sendFightStart),c.E.ins.off(h.EventName.TASK_SEND_FIGHT_END,this,this.sendFightEnd),this._heroGroup.getFUList()[0].setTargetSelEff(null),this.npcs=null,this.monsters=null;for(var t=0;t<this._monsterUnits.length;t++)this._monsterUnits[t]&&(this._monsterUnits[t].destroyUnit(),this._monsterUnits[t]=null);this._monsterUnits=[],this._robotMgr.destroy();for(t=0;t<this._npcArray.length;t++)this._npcArray[t]&&this._npcArray[t].destroyUnit();this._npcArray=[],a.prototype.clear.call(this)},r.prototype.getNPCFromId=function(t){for(var e=0;e<this._npcArray.length;e++)if(this._npcArray[e].id==t)return this._npcArray[e];return null},r.prototype.init=function(t){void 0===t&&(t=null),a.prototype.init.call(this,t),c.E.ins.on(h.EventName.TASK_CHANGE,this,this.onTaskUpdate),c.E.ins.on(h.EventName.TASK_FIGHT_BREAK,this,this.taskFightBreak),c.E.ins.on(h.EventName.TASK_SEND_FIGHT_START,this,this.sendFightStart),c.E.ins.on(h.EventName.TASK_SEND_FIGHT_END,this,this.sendFightEnd),this.npcs=p.MapCovert.parseToNumber(t.npc_id),this.monsters=p.MapCovert.parseToNumber(t.monstor_id),this.mapVo.startPoint=p.MapCovert.parseBySemicolon(t.player_bornplace),this.mapVo.monXY=p.MapCovert.parseBySemicolon(t.monstor_bornplace),this.mapVo.npcXY=p.MapCovert.parseBySemicolon(t.npc_bornplace),this.mapVo.taskXY=p.MapCovert.parseBySemicolon(t.task_place),this._heroGroup=u.SceneObjCtroller.ins.getSelfGroup(),this._heroGroup.addToFightLayer(),this._heroGroup.getFUList()[0].inSafe=!1;var e,i=0;for(this._npcArray=[],i=0;i<this.npcs.length;i++){var n=this._npcArray[i]=u.SceneObjCtroller.ins.createNPC(this.npcs[i],this.mapVo.npcXY[i],this.mapVo.taskXY[i],i+1);m.LayerManager.fightLayer.addUnit(n)}for(i=0;i<this.monsters.length;i++)if(this.monsters[i]){if(30005==this.monsters[i]){var s=l.GameConfig.getMonster(30005);if(s){var o=new I.BossNewVillage;o.set_DATA(s),o.face=C.Unit_New.getRandomFace(),o.waveIndex=i+1,o.setWorldXY(this.mapVo.monXY[i][0],this.mapVo.monXY[i][1]),e=this._monsterUnits[i]=o}}else e=this._monsterUnits[i]=u.SceneObjCtroller.ins.createNewVillageMon(this.monsters[i],this.mapVo.monXY[i],i+1);m.LayerManager.fightLayer.addUnit(e)}v.RoleCenter.instans.self.taskdata.taskid<=f.NewComerRobot.ENDMISSION&&this._robotMgr.initRobotMgr(this),this.onTaskUpdate(!0),this._nvPortId=v.RoleCenter.instans.self.portstatus.portindex,u.SceneObjCtroller.ins.resetSelfGroupPos(this.getLastPosFromTask(this.task.id)),this.specialTaskInit(),c.E.ins.event(h.EventName.REFRESH_TASK,1),r.MAPLOAD_COMPLETE=!0},r.prototype.specialTaskInit=function(){d.TaskManager.ins.currentTask&&d.TaskManager.ins.currentTask.type==o.TaskType.IntoAutoCopy&&c.E.ins.event(h.EventName.TASK_CHANGE)},r.prototype.getLastPosFromTask=function(t){var e=this.scene.mapVo.startPoint,i=d.TaskManager.ins.getPrevTaskNpc(t);return 0==i?e[0]:this.getNPCFromId(i).findNode},r.prototype.fightEnd=function(t){void 0===t&&(t=!0),(0<this._fightReward.currencyList.length||0<this._fightReward.itemList.length)&&(this.effectExpAndMoney(this._fightReward),this._fightReward.clear()),this._monsterGroup=null,this._heroGroup.setFGTarget(null)},r.prototype.onReceiveFightEnd=function(t){a.prototype.onReceiveFightEnd.call(this,t),t.opresult&&d.TaskManager.ins.currentTask&&v.RoleCenter.instans.self.taskdata.need==d.TaskManager.ins.currentTask.need&&c.E.ins.event(h.EventName.TASK_PROGRESS,[this.openMonsters]),this._heroGroup.resetHP()},r.prototype.onReceiveFightStart=function(t){a.prototype.onReceiveFightStart.call(this,t),t.opresult&&(this._fightReward=t.inventory,this._monsterGroup&&this._monsterGroup.assignMonsterDrop(this._fightReward))},r.prototype.getRobKillMonster=function(t){for(var e=1;e<=3;e++)if(!this._monsterUnits[t+e].beAttackState)return this._monsterUnits[t+e];return null},r.prototype.startKillMonster=function(){this.openMonsters=[];var t=this.task.monsterIndexs,e=t.length;e=this.task.need-v.RoleCenter.instans.self.taskdata.need;for(var i=0;i<e;i++)this.openMonsters.push(this.monsters[t[i]-1]);if(v.RoleCenter.instans.self.taskdata.need>=this.task.need){this.openMonsters=[],e=t.length;for(i=0;i<e;i++)this.openMonsters.push(this.monsters[t[i]-1]);c.E.ins.event(h.EventName.TASK_PROGRESS,[this.openMonsters])}else{var n;this._monsterGroup=new g.FightGroup(null);for(i=0;i<t.length;i++){var s=t[i]-1;(n=this._monsterUnits[s]).__index=this.monsters[s],this._monsterGroup.addFightUnit(n)}this._monsterGroup.getValidArr().length<e&&(this._monsterGroup.resetHP(),this._monsterGroup.setVisible(!0)),this._heroGroup.getFUList()[0].setTargetSelEff(r.TARGETSEL_EFFECT),this._heroGroup.setFGTarget(this._monsterGroup)}},r.prototype.doPickUp=function(){this.checkCreateDrops(),0<n.SceneObjManager.instans.totalDrops.length&&(this._heroGroup.setPITarget(n.SceneObjManager.instans.totalDrops),u.SceneObjCtroller.ins.self.status=2)},r.prototype.pickAllDrops=function(){c.E.ins.off(h.EventName.PICK_ALL_FLYITEMS,this,this.pickAllDrops),c.E.ins.off(h.EventName.PICK_ALL_ITEM,this,this.pickAllDrops);for(var t,e,i=this.taskNeedPickItems?this.taskNeedPickItems.length:0,n=0;n<i;){t=this.taskNeedPickItems[n],n++,e=this.taskNeedPickItems[n],n++;var s=new S.GetItemMsg;s.cfgId=t,s.count=e,E.GSM.sendServer(s)}E.GSM.ins.on(S.GetItemMsg.KEY,this,this.onTaskPickUpBackHandler)},r.prototype.onTaskPickUpBackHandler=function(t){if(this.task&&this.task.type==o.TaskType.pickUp)for(var e,i,n=this.taskNeedPickItems?this.taskNeedPickItems.length:0,s=0;s<n;){if(e=this.taskNeedPickItems[s],i=this.taskNeedPickItems[s+1],e==t.cfgId){this.taskNeedPickItems.splice(s,2),0==this.taskNeedPickItems.length&&E.GSM.ins.off(S.GetItemMsg.KEY,this,this.onTaskPickUpBackHandler),v.RoleCenter.instans.self.taskdata.need+=i,c.E.ins.event(h.EventName.TASK_DATA_CHANGED);break}s+=2}else E.GSM.ins.off(S.GetItemMsg.KEY,this,this.onTaskPickUpBackHandler)},r.prototype.checkCreateDrops=function(){if(this.task&&this.task.dropArr&&0<this.task.dropArr.length&&this.task.dropPos&&0<this.task.dropPos.length){for(var t,e,i=[],n=this.task.dropArr.length,s=0;s<n;){if(t=this.task.dropArr[s][0],1e4<parseInt(t)&&parseInt(t)<4e4){var o=b.ItemUtils.getEquipVoById(t);o&&o.job==v.RoleCenter.instans.vo.jobId&&(i.push(parseInt(t)),i.push(1))}else i.push(t),e=parseInt(this.task.dropArr[s][1]),i.push(e);s++}w.DropUtil.createDrop(i,new Laya.Point(this.task.dropPos[0],this.task.dropPos[1])),this.taskNeedPickItems=i.concat(),c.E.ins.once(h.EventName.PICK_ALL_FLYITEMS,this,this.pickAllDrops),c.E.ins.once(h.EventName.PICK_ALL_ITEM,this,this.pickAllDrops)}},r.prototype.sendFightStart=function(t){this._index=t,this._canSendEnd=!0,s.NetCtroller.fightStartC2GS(!1,[t],this.scene.selfInfo.portstatus.portindex)},r.prototype.sendFightEnd=function(){this._canSendEnd||this.sendFightStart(this._index),this._canSendEnd=!1,s.NetCtroller.fightEndC2GS(this._nvPortId,this.scene.fightid,!0)},r.prototype.taskFightBreak=function(){this._heroGroup.setFGTarget(null),this._monsterGroup&&(this._monsterGroup.setFGTarget(null),this._canSendEnd&&(this._canSendEnd=!1,s.NetCtroller.fightEndC2GS(this._nvPortId,this.scene.fightid,!1)))},r.prototype.onTaskUpdate=function(t){if(void 0===t&&(t=!1),a.prototype.onTaskUpdate.call(this),v.RoleCenter.instans.self.taskdata.taskid=this.task.id,0!=d.TaskManager.ins.active&&!(1900<=this.task.id&&this.type!=_.EPlayType.PLAYTYPE_MAINCITY))switch(t&&u.SceneObjCtroller.ins.resetSelfGroupPos(this.getLastPosFromTask(this.task.id)),this.task.type){case o.TaskType.KillMonsters:this.startKillMonster();break;case o.TaskType.Dialogue:this.talkingToNpc(this.task.npcId);break;case o.TaskType.pickUp:this.doPickUp()}},r.prototype.talkingToNpc=function(t){this._heroGroup.setNPCTarget(this.getNPCFromId(t))},r.prototype.resetHeroMonsterGroup=function(){for(var t=this._monsterGroup.getFUList(),e=0;e<t.length;e++){var i=t[e];i.isDeath()&&i.resetUnit(i.worldX,i.worldY)}},r.prototype.checkPickUp=function(){if(this._monsterGroup){var t=this._monsterGroup.getFUList();if(!(t.length<=0)){var e=t[0];e.isDeath()&&0<e.getDropNum()&&(u.SceneObjCtroller.ins.self.status=2)}}},r.prototype.frameMove=function(){a.prototype.frameMove.call(this),this.checkPickUp(),this._monsterGroup&&this._monsterGroup.isVanishDeath()&&(0<n.SceneObjManager.instans.totalDrops.length?this._heroGroup.setPITarget(n.SceneObjManager.instans.totalDrops):this.fightEnd())},r.prototype.releaseSkillHandler=function(t){this.releaseClientComboHit(t)},r.TARGETSEL_EFFECT="dynamic2/uieffect/EUI1_28.json",r.MAPLOAD_COMPLETE=!1,r}(i.GamePlay);e.GamePlayNewVillage=a}),define("src/g/fight/osprite/play/baseplay/GamePlayPVP",["require","exports","src/g/fight/osprite/play/GamePlay","../../../../../enum/EventName","../../../../../core/E","src/g/fight/osprite/obj/FightGroup","src/g/fight/osprite/SceneObjCtroller","src/g/fight/osprite/play/baseplay/SvrHeroUnit"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(i){function t(t){var e=i.call(this,t)||this;return s.E.ins.on(n.EventName.EXIT_BOSS_PLAYTYPE,e,e.exitHandler),e}return __extends(t,i),t.prototype.init=function(t){i.prototype.init.call(this,t)},t.prototype.initBossGroup=function(){this.bossGroup=new o.FightGroup(null)},t.prototype.initSelftGroup=function(){var t=a.SceneObjCtroller.ins.getSelfGroup();t.resetFightGroup(this.mapVo.startPoint[0]),t.addToFightLayer(),t.setFGTarget(this.bossGroup),this.setFightGroup(t)},t.prototype.createEnamy=function(t,e,i,n,s){var o=this.mapVo.bossXY[0],a=(o=this.mapVo.bossXY[0],new r.SvrHeroUnit);s.addFightUnit(a),a.initHeroData(t,e,i,n),a.topHpBar.typeElement=2,s.resetFightGroup(o),s.setFGTarget(this.bossGroup),s.addToFightLayer()},t.prototype.exitHandler=function(){this.returnAutoplayPort(),s.E.ins.off(n.EventName.EXIT_BOSS_PLAYTYPE,this,this.exitHandler)},t}(i.GamePlay);e.GamePlayPVP=l}),define("src/g/fight/osprite/play/baseplay/PeopleBoss",["require","exports","src/g/fight/osprite/obj/MonsterUnit_New"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(i){function t(t){void 0===t&&(t=!0);var e=i.call(this,t)||this;return e._chhps=[],e}return __extends(t,i),t.prototype.chg_HP=function(t,e,i,n,s){void 0===s&&(s=!1),this._chhps.length&&this.setHp(this.getHp()+this._chhps.pop()),this.floatBlood(t,e?e.job:0,i,n,s),this.resetHpBar()},t}(i.MonsterUnit_New);e.PeopleBossMonster=n}),define("src/g/fight/osprite/play/family/data/UserListItemData",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.setDate=function(t){return this.job=t.jobid,this.sex=t.sex,this.nickname=t.combat+"",this},t}();e.UserListItemData=i}),define("src/g/fight/osprite/play/family/PlayerItemView",["require","exports","src/g/fight/osprite/play/family/data/UserListItemData","../../../../../utils/ItemUtils"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t._userdata=new i.UserListItemData,t}return __extends(t,e),t.prototype.setData=function(t){var e=this._userdata.setDate(t);this.img_head.skin=n.ItemUtils.getHeadurlYuan(e.sex,e.job)},t}(ui.guild.combat.playerItemUI);e.PlayerItemView=s}),define("src/g/fight/osprite/play/family/DieTipView",["require","exports","../../../../../manager/RoleCenter","src/init/Switches"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.isChecked=!1,t.isshow=!1,t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){this.btn_close.on(Laya.Event.CLICK,this,this.clickHander),this.btn_ok.on(Laya.Event.CLICK,this,this.okHander),this.btn_cancel.on(Laya.Event.CLICK,this,this.clickHander),this.img_check.on(Laya.Event.CLICK,this,this.isCheck)},t.prototype.clickHander=function(){this.close()},t.prototype.isCheck=function(){this.isshow=!this.isshow,this.img_check.skin=this.isshow?"res/allpersonboss/boss_gouxuan.png":""},t.prototype.okHander=function(){this.isshow&&(this.isChecked=!0),i.RoleCenter.instans.vo._vo.GOLD>=parseInt(this.txt_need.text)?(this.close(),this.isChecked&&(this.box.visible=!1)):n.Switches.ins.event(155)},t}(ui.guild.combat.DieTipUI);e.DieTipView=s}),define("src/g/fight/osprite/play/family/CombatView",["require","exports","../../../../../manager/LayerManager","../../../../../core/E","../../../../../enum/EventName","src/g/fight/info/PlayTypeVo","src/g/fight/osprite/play/family/PlayerItemView","src/g/fight/osprite/play/family/DieTipView","../../../../../manager/RoleCenter","../../../../net/messages/ChangeSceneMsg","src/init/Switches","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t.arr=[],t.arrName=[],t.init(),t}return __extends(t,e),t.prototype.init=function(){this.dieTip||(this.dieTip=new r.DieTipView),this.btn_enter.on(Laya.Event.CLICK,this,this.onClick),this.list.vScrollBarSkin="",this.list.selectEnable=!1,this.list.scrollBar.elasticDistance=50,this.list.itemRender=a.PlayerItemView,this.list.renderHandler=new Laya.Handler(this,this.renderHandler),this.btn_enter.visible=!1,this.qingChuBtn.on(Laya.Event.CLICK,this,this.qingChuClickHander)},t.prototype.onClick=function(){n.E.ins.event(s.EventName.TRANS_POINT_CLICK,1)},t.prototype.clear=function(){this.btn_enter.off(Laya.Event.CLICK,this,this.onClick),this.clearUserList(),t._ins=null},t.prototype.addUserListItem=function(t,e){this.arrName.indexOf(t)<1&&(this.arrName.push(t),this.arr.push(e)),this.list.array=this.arr},t.prototype.removeUserListItem=function(t){for(var e=[],i=0;i<this.arr.length;i++)this.arrName[i]!=t&&e.push(this.arr[i]);this.arr=null,this.arr=e,this.list.array=this.arr},t.prototype.qingChuClickHander=function(){this.dieTip.isChecked?l.RoleCenter.instans.vo._vo.GOLD>=5*this.dieCountDown||c.Switches.ins.event(155):(this.dieTip.txt_need.text=5*this.dieCountDown+"",this.dieTip.popup())},t.prototype.clearUserList=function(){this.arrName=null,this.arr=null,this.list.array=this.arr},t.show=function(t){this.create(),this._ins.mouseThrough=!0,this._ins.setViewType(t),i.LayerManager.addInUILayer(this.ins)},t.prototype.initType=function(){for(var t=1;t<4;t++)this["img"+t].disabled=!0;for(t=1;t<3;t++)this["bar"+t].visible=!1;this.countDownPan.visible=!1,this.escheatage.visible=!1,this.gift.visible=!1,this.lab_tip.visible=!1},t.prototype.renderHandler=function(t,e){t.setData(this.list.array[e])},t.prototype.setViewType=function(t){switch(this.initType(),t){case 1:this.onType1(t);break;case 2:this.onType2(t);break;case 3:this.onType3(t)}},t.prototype.setActivityCountDown=function(){var t=1200;this.txt_timeDown.text=u.TextConst.get(45,t/60>>0,t%60>>0),Laya.timer.loop(1e3,this,function(){--t<=0&&this.endActivityCountDownPan&&this.endActivityCountDownPan(),this.txt_timeDown.text=u.TextConst.get(45,t/60>>0,t%60>>0)})},t.prototype.enterScene=function(){var t=this._enterParam;t&&(this.btn_enter.visible&&(this.btn_enter.visible=!1),this.sendEnterSceneEvent(t[0],t[1]))},t.prototype.exitScene=function(){var t=this._exitParam;t&&this.sendEnterSceneEvent(t[0],t[1])},t.prototype.onType1=function(t){this._enterParam=[20301,2];for(var e=1;e<=t;e++)this["img"+e].disabled=!1;this.btn_enter.visible=!0,this.btn_enter.label=u.TextConst.get(422),this.lab_tip.visible=!1,this.list.visible=!1,this.txt_title.text=u.TextConst.get(423)},t.prototype.onType2=function(t){this._exitParam=[20300,1],this._enterParam=[20302,3];for(var e=1;e<=t;e++)this["img"+e].disabled=!1;this.bar1.visible=!0,this.btn_enter.visible=!0,this.btn_enter.label=u.TextConst.get(424),this.lab_tip.visible=!0,this.list.visible=!0,this.txt_title.text=u.TextConst.get(425)},t.prototype.onType3=function(t){this._exitParam=[20301,2];for(var e=1;e<=t;e++)this["img"+e].disabled=!1;this.bar1.visible=!0,this.bar2.visible=!0,this.btn_enter.visible=!1,this.lab_tip.visible=!0,this.list.visible=!0,this.txt_title.text=u.TextConst.get(426)},t.prototype.showRedImg=function(){this.img_red.visible=!0;var t=0;Laya.timer.loop(300,this,function(){t++,this.img_red.alpha=Math.sin(t)})},t.prototype.hideRedImg=function(){this.img_red.visible=!1},t.prototype.showWinTip=function(t,e){var i=this;this.showTipTween&&(Laya.Tween.clear(this.showTipTween),this.showTipTween=null),this.hideWinTipSetTimeouter&&(clearTimeout(this.hideWinTipSetTimeouter),this.hideWinTipSetTimeouter=null),this.winTip.winTxt.text=t,this.winTip.failTxt.text=e,this.showTipTween=Laya.Tween.to(this.winTip,{alpha:1},.4),this.hideWinTipSetTimeouter=setTimeout(function(){i.hideWinTip()},2400)},t.prototype.hideWinTip=function(){this.hideTipTween&&(Laya.Tween.clear(this.hideTipTween),this.hideTipTween=null),this.hideWinTipSetTimeouter&&(clearTimeout(this.hideWinTipSetTimeouter),this.hideWinTipSetTimeouter=null),this.hideTipTween=Laya.Tween.to(this.winTip,{alpha:0},.4)},t.prototype.setAttr=function(t,e,i,n,s){this.txt_firstName1.text=t,this.txt_firstName2.text=t,this.txt_firstNum.text=e+"",this.txt_selfRanking.text=n+"",this.txt_selfNum.text=i+"",this.txt_count.text=u.TextConst.get(19,s)},t.prototype.showCountDownPan=function(){var t=20;this.countDownText.text=u.TextConst.get(291,t),Laya.timer.loop(1e3,this,function(){t--,(this.dieCountDown=t)<=0&&this.endCountDownPan&&this.endCountDownPan(),this.countDownText.text=u.TextConst.get(291,t)}),this.countDownPan.visible=!0,this.btn_enter.visible=!1},t.prototype.showEscheatageCountDownPan=function(t,e){var i=20;this.escheatage.escheatagetText.text=u.TextConst.get(427,i),Laya.timer.loop(1e3,this,function(){--i<=0&&(this.endEscheatageCountDown&&this.endEscheatageCountDown(),t&&e&&e.call(t)),this.escheatage.escheatagetText.text=u.TextConst.get(427,i)}),this.escheatage.visible=!0},t.prototype.sendEnterSceneEvent=function(t,e){n.E.ins.event(s.EventName.PLAY_TYPE_CHANGE,o.PlayTypeVo.create(h.EPlayType.PLAYTYPE_FIGHTSC,{portid:t,lvl:e},!0,!0,!1))},t.remove=function(){this._ins.removeSelf(),this._ins.clear(),this._ins=null},t.create=function(){this._ins||(this._ins=new t)},Object.defineProperty(t,"ins",{get:function(){return this._ins||(this._ins=new t)},enumerable:!0,configurable:!0}),t}(ui.guild.combat.combatViewUI);e.CombatView=p}),define("src/g/fight/osprite/play/gameplayguide/ClientHero",["require","exports","src/g/fight/osprite/obj/HeroUnit"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(s){function t(t){return void 0===t&&(t=null),s.call(this,t)||this}return __extends(t,s),t.prototype.chg_HP=function(t,e,i,n){s.prototype.chg_HP.call(this,t,e,i,n),this.setHp(this.getHp()+t)},t}(i.HeroUnit);e.ClientHeroUnit=n}),define("src/g/fight/osprite/play/hangup/plus/LevelBossFight",["require","exports","src/g/fight/osprite/play/hangup/plus/BaseFight","src/g/fight/osprite/play/baseplay/SvrPeopleBossMonster","src/g/fight/osprite/obj/FightGroup","src/g/fight/osprite/SceneObjCtroller","../../../../../../utils/DropUtil","../../../../../../utils/ItemUtils","src/g/fight/osprite/NetCtroller","src/g/fight/osprite/SceneObjManager","src/g/account/ctrl/AccountViewCtrl","../../../../../net/messages/ChangeSceneMsg","src/g/fight/info/PlayTypeVo","../../../../../../core/E","../../../../../../enum/EventName"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(e){function t(){var t=e.call(this)||this;return t._portData=null,t}return __extends(t,e),t.prototype.init=function(t){this.play=t,this.mapVo=t.mapVo,this.initself()},t.prototype.initself=function(){o.SceneObjCtroller.ins.getSelfGroup()},t.prototype.sendfightStart=function(t){a.DropUtil.isfly=!0,this._portData=t,this.bossGroup=new s.FightGroup(null);var e=new n.SvrPeopleBossMonster,i=r.ItemUtils.getMonsterVOById(t.boss);e.set_DATA(i),this.bossFightUnit=e,this.bossGroup.addFightUnit(e),this.bossGroup.resetFightGroup(this.mapVo.bossXY[0]),this.bossGroup.addToFightLayer(),this.play.fightGroup.setFGTarget(this.bossGroup),l.NetCtroller.fightStartC2GS(!0,this._portData.boss,this._portData.id)},t.prototype.onReceiveFightStart=function(t){t.opresult&&(this._fightReward=t.inventory,this.bossGroup.assignMonsterDrop(this._fightReward))},t.prototype.onreceiveFightEnd=function(t){t.opresult?(this.play.fightGroup.setPITarget(h.SceneObjManager.instans.totalDrops),Laya.timer.loop(500,this,this.checkResult)):c.AccountViewCtrl.ins.failFightEnd(Laya.Handler.create(this,function(){d.E.ins.event(g.EventName.PLAY_TYPE_CHANGE,p.PlayTypeVo.create(u.EPlayType.PLAYTYPE_PORT))}))},t.prototype.checkResult=function(){h.SceneObjManager.instans.totalDrops.length},t.prototype.onAttackMsg=function(t){this.bossFightUnit.svrSetHP(t.hpAfterAttack[0])},t.prototype.onUserHPChg=function(t){},t.prototype.onHpChg=function(t){if(t.beAttack){var e=this.play.fightGroup.getUnitByIndex(t.beAttackHidx);e&&e.svrSetHP(t.hpAfterAttack)}else this.bossFightUnit.svrSetHP(t.hpAfterAttack[0])},t.prototype.releaseSkillHandler=function(t){this.play&&this.play.releaseSkill(t,"")},t.prototype.onComboHit=function(t){t.beAttackAcc||this.play.fightGroup.playJoinAttSkill(t)},t.prototype.clear=function(){this.bossGroup.setFGTarget(null),this.play=null,this.bossGroup.destroyGroup(),this.bossFightUnit=null,this.bossGroup=null,Laya.timer.clearAll(this)},t}(i.BaseFight);e.LevelBossFight=v}),define("src/g/fight/osprite/play/quanmin/data/GroupInfo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.hpInfos=[]}return t.prototype.setHp=function(t,e){this.hpInfos[t]=e},t.prototype.getHp=function(t){return this.hpInfos[t]},t.prototype.setGroupHp=function(t){for(var e=t.getFUList(),i=e.length,n=0;n<i;n++){var s=e[n];this.setHp(n,s.getHp())}},t.prototype.setHpInfoToGroup=function(t){for(var e=t.getFUList(),i=e.length,n=0;n<i;n++){e[n].setHp(this.getHp(n))}},t}();e.GroupInfo=i}),define("src/g/fight/osprite/play/skyLadder/GamePlayaKFTT",["require","exports","src/g/fight/osprite/play/skyLadder/GamePlaySkyLadder"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(i.GamePlaySkyLadder);e.GamePlayaKFTT=n}),define("src/g/fight/osprite/play/skyLadder/SkyLadderData",["require","exports","../../../../../utils/ItemUtils"],function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.init=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=!0),this.chuangId=t;var n=this.portChuangVo=s.ItemUtils.getPort_chuang(this.chuangId);this.maxPortId=n.port[1],this.minPortId=n.port[0],i&&(this.currentPortId=this.minPortId),e&&(this.currentPortId=e),this.portVo=s.ItemUtils.getPortVoById(this.currentPortId)},t.prototype.next=function(){this.currentPortId++,this.currentPortId>this.maxPortId&&this.chuangId++,this.init(this.chuangId,0,!1)},t}();e.SkyLadderData=i}),define("src/g/fight/osprite/skill/CrazyRun",["require","exports","src/g/fight/osprite/skill/BaseSkill","src/g/fight/base/RES","src/g/fight/osprite/obj/UnitCovert","src/g/fight/osprite/GameScene","src/g/fight/osprite/map/MapConst","src/g/fight/osprite/buff/StunBuff","../../../net/messages/ChangeSceneMsg","../../../../component/GAnimationManager"],function(t,e,i,d,g,v,f,y,n,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(p){function t(){var t=null!==p&&p.apply(this,arguments)||this;return t.tweenEnemy=null,t}return __extends(t,p),t.prototype.fire=function(t){var e=this,i=this._holdBy.fightTarget;if(i){var n=this._holdBy,s=Math.atan2(i.mapY-n.mapY,i.mapX-n.mapX);n.face=g.UnitCovert.radiansToFace(s),n.playMove(),n.isCanMove=!1;var o=this.checkPlay(i);if(!i.strong&&o){var a=Math.sin(s),r=Math.cos(s),l=i.mapX+100*r,h=i.mapY+100*a;v.GameScene.ins.map.getMapDate(~~(l/f.MapConst.MAP_TILED_W),~~(h/f.MapConst.MAP_TILED_W))&&(Laya.Tween.to(this._holdBy,{mapX:i.mapX,mapY:i.mapY},200),Laya.Tween.to(i,{mapX:l,mapY:h},150),this.tweenEnemy=i)}Laya.timer.once(200,this,function(){e._holdBy&&(e._holdBy.isCanMove=!0,i.set_buf(e._holdBy,y.StunBuff.BUFF_ID,e.level))}),this._holdBy.resetSkillPlay(t),n.coat.interval=10;var c=m.GAnimationManager.getInstance().create();if(c.interval=300,this.data.sdur0){var u=d.RES.getSdul0(this.data.sdur0,n.face);c.load(u),this._holdBy&&this._holdBy.body.addChild(c)}p.prototype.fire.call(this,t,!1)}},t.prototype.checkPlay=function(t){var e=v.GameScene.ins.playtype;return e!=n.EPlayType.PLAYTYPE_QUANMINBOSS&&e!=n.EPlayType.PLAYTYPE_SHENYUBOSS&&e!=n.EPlayType.PLAYTYPE_MOSTVIPBOSS1&&e!=n.EPlayType.PLAYTYPE_SUMMONBOSS||v.GameScene.ins.distanceToBoss(t)<25600},t.prototype.clear=function(){this._holdBy&&Laya.Tween.clearAll(this._holdBy),this.tweenEnemy&&(Laya.Tween.clearAll(this.tweenEnemy),this.tweenEnemy=null),p.prototype.clear.call(this)},t}(i.BaseSkill);e.CrazyRun=s}),define("src/g/fight/osprite/widget/UnitWidget",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.offsetX=0,t.offsetY=0,t}return __extends(t,e),t.prototype.init=function(){},t.prototype.destroy=function(){},t.prototype.update=function(t,e){this.disp&&this.disp.pos(t+this.offsetX,e+this.offsetY)},t}(Laya.EventDispatcher);e.UnitWidget=i}),define("src/g/fight/osprite/widget/manager/BaseWidgetManger",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(o){function t(){var t=null!==o&&o.apply(this,arguments)||this;return t.widgets=[],t}return __extends(t,o),t.prototype.init=function(){},t.prototype.add=function(t){this.widgets.push(t)},t.prototype.remove=function(t){var e=this.widgets.indexOf(t);-1<e&&this.widgets.splice(e,1)},t.prototype.update=function(t,e){for(var i=this.widgets,n=i.length,s=0;s<n;s++)i[s].update(t,e)},t.prototype.event=function(t,e){for(var i=this.widgets,n=i.length,s=0;s<n;s++)i[s].event(t,e);return o.prototype.event.call(this,t,e)},t.prototype.destroy=function(){for(var t=this.widgets,e=t.length,i=0;i<e;i++)t[i].destroy();t.length=0},t}(Laya.EventDispatcher);e.BaseWidgetManager=i}),define("src/g/guide/view/TaskGuideContiner",["require","exports","../../../core/E","../../../enum/EventName","src/init/GameState","../../../plugin/view/Bubble","../../../plugin/view/Bubble1"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=Laya.Sprite,l=Laya.HitArea,h=function(e){function t(){var t=e.call(this)||this;return Laya.timer.frameOnce(2,t,t.init),t}return __extends(t,e),t.prototype.init=function(){this.guideContainer=new r,this.guideContainer.cacheAs="bitmap";var t=new r;t.alpha=.5,t.graphics.drawRect(0,0,1,1,"#000000"),t.scale(Laya.stage.width,Laya.stage.height),this.guideContainer.addChild(t),this.interactionArea=new r,this.interactionArea.blendMode="destination-out",this.guideContainer.addChild(this.interactionArea),this._hitArea=new l,this._hitArea.hit.drawRect(0,0,Laya.stage.width,Laya.stage.height,"#000000"),this.guideContainer.hitArea=this._hitArea,this.guideContainer.mouseEnabled=!0,this.mouseEnabled=!0,this.guideContainer.visible=!1,this.addChild(this.guideContainer),i.E.ins.on(n.EventName.ENTER_SUB_GAMEPLAY,this,this.hideLayer),i.E.ins.on(n.EventName.EXIT_SUB_GAMEPLAY,this,this.showLayer)},t.prototype.hideLayer=function(){this.visible=!1},t.prototype.showLayer=function(){this.visible=!0},t.prototype.setInteractionArea=function(t){this._hitArea.unHit.clear(),this._hitArea.unHit.drawRect(t.x,t.y,t.width,t.height,"#000000"),this.interactionArea.graphics.clear(),this.interactionArea.graphics.drawRect(t.x,t.y,t.width,t.height,"#000000")},t.prototype.setPolyInteractionArea=function(t,e,i){this._hitArea.unHit.clear(),this._hitArea.unHit.drawPoly(t,e,i,"#000000"),this.interactionArea.graphics.clear(),this.interactionArea.graphics.drawPoly(t,e,i,"#000000")},t.prototype.showMask=function(t){this.guideContainer.visible=t?(s.GameState.task_guide_mask_show=!0,o.Bubble.clearAllBubble(),a.BubbleCenter.clearAllBubble(),!0):s.GameState.task_guide_mask_show=!1},t}(Laya.Sprite);e.TaskGuideContiner=h}),define("src/g/hotbloodtemple/view/HBTemplePort",["require","exports","../../../utils/ItemUtils","../../../component/GAnimation","src/g/fight/base/RES"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o,a=function(e){function t(){var t=e.call(this)||this;return t.dire=1,t.animationScale=.5,t.animation=new n.GAnimation,t.animation.x=84,t.animation.y=85,t.addChild(t.animation),t.addChildAt(t.animation,t.getChildIndex(t.levelContainer)),t}return __extends(t,e),t.prototype.update=function(t,e,i){this.isCrtPort=i,this.status=e,this.disabled=2==e,this.imgGround.skin="res/hotbloodtemple/rxsd_bossdizuo"+(i?1:2)+".png",t&&(this.imgFloor.value=t.getId().toString(),this.refreshMonster(t.boss[0]))},t.prototype.refreshMonster=function(t){var e=i.ItemUtils.getMonsterVOById(t);e?e.moResVo?(-1==e.moResVo.dir.indexOf(5)?(this.murl=s.RES.MONSTER_PATH+e.moResVo.res+"/3_r.json",this.dire=-1):(this.dire=1,this.murl=s.RES.MONSTER_PATH+e.moResVo.res+"/5_r.json"),Laya.loader.load(this.murl,Laya.Handler.create(this,this.onAnimationLoaded),null,Laya.Loader.ATLAS)):console.error("yxq:热血神殿bossId"+t+"没有对应的ResVo"):console.error("yxq:热血神殿bossId"+t+"没有对应的monstervo")},t.prototype.onAnimationLoaded=function(){null!=this.animation&&(this.animation.clear(!0),this.animation.load(this.murl),this.animation.scale(this.dire*this.animationScale,this.animationScale),this.isCrtPort?this.animation.play():this.animation.stop())},t.prototype.destroy=function(t){this.animation&&(this.animation.stop(),this.animation=null),e.prototype.destroy.call(this,t)},t}(ui.hotbloodtemple.HBTemplePortUI);e.HBTemplePort=a,(o=e.TemplePortEnum||(e.TemplePortEnum={}))[o.STATUS_CAN_CHALLENAGE=0]="STATUS_CAN_CHALLENAGE",o[o.STATUS_WAIT_CHALLENAGE=1]="STATUS_WAIT_CHALLENAGE",o[o.STATUS_CANT_CHALLENAGE=2]="STATUS_CANT_CHALLENAGE"}),define("src/g/hotbloodtemple/view/HBloodTempleEntry",["require","exports","src/g/hotbloodtemple/view/HBTemplePort","src/g/account/view/AccItem","src/init/Switches","src/g/hotbloodtemple/ctrl/HBloodTempleEntryCtrl","src/g/clearRes/ClearResM","src/init/TextConst","../../../manager/RoleCenter"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.initHtmlStyle(t.lbHelp,"#a89e8f",16),t.lbHelp.style.leading=2,t.initHtmlStyle(t.challenageNum,"#e3cca9",18),t.challenageNum.style.align="center",t.initHtmlStyle(t.detailRankButton,"#09d51f",16),t.detailRankButton.innerHTML=r.TextConst.get(861),t.initHtmlStyle(t.lbLevelDes,"#e3cca9",15),t.lbLevelDes.style.align="center",t.initHtmlStyle(t.lbDes,"#e3cca9",15),t.lbDes.style.align="center",t.initPort(),t.extraReward=new n.AccItem,t.extraReward.x=429,t.extraReward.y=497,t.addChild(t.extraReward),t.initList(t.aLevelRewardList,n.AccItem,new Laya.Handler(t,t.rewardRender)),t.initList(t.bLevelRewardList,n.AccItem,new Laya.Handler(t,t.rewardRender)),t.initList(t.sLevelRewardList,n.AccItem,new Laya.Handler(t,t.rewardRender)),t.initList(t.top3RankList,ui.hotbloodtemple.HBTempleRankItem1UI,new Laya.Handler(t,t.rankItemRender)),t.lbDes.on(Laya.Event.CLICK,t,t.openRexueHander),a.ClearResM.addBgUrl(t.imgTopBg.skin),a.ClearResM.addBgUrl(t.imgBottomBg.skin),t}return __extends(t,e),t.prototype.initHtmlStyle=function(t,e,i){t.style.color=e,t.style.font="SimHei",t.style.fontSize=i},t.prototype.hlayout=function(t,e){for(var i=0,n=[],s=0;s<e.numChildren;s++)n.push(e.getChildAt(s));var o=n.length;for(s=0;s<o;s++)i+=n[s].width,s!=o-1&&(i+=t);var a=e.width-i>>1;for(s=0;s<o;s++)0==s?n[0].x=a:n[s].x=n[s-1].x+n[s-1].width+t},t.prototype.initList=function(t,e,i){t.itemRender=e,t.vScrollBarSkin="",t.scrollBar.elasticDistance=0,t.renderHandler=i,t.array=[]},t.prototype.rewardRender=function(t,e){t.scaleX=t.scaleY=.75,t.countNum.fontSize=28,t.eqData=t.dataSource,t.lv_txt.text=""},t.prototype.initPort=function(){var t;this.portPanel.vScrollBarSkin="",this.portList=[];for(var e=0;e<4;e++){switch(t=new i.HBTemplePort,e){case 0:t.x=159,t.y=439;break;case 1:t.x=18,t.y=300;break;case 2:t.x=158,t.y=162;break;case 3:t.x=9,t.y=20}this.portPanel.addChild(t),this.portList.push(t)}},t.prototype.setPortList=function(t,e){for(var i=l.RoleCenter.instans.self.bbGodData.curCfgId,n=1==t.length&&(!t[0].type||t[0].id!=i),s=this.portList.length,o=0;o<s;o++){var a=this.portList[o],r=t[o];null==r?a.visible=!1:r==e?n?a.update(r,2,!1):a.update(r,0,!0):r.id==e.id+1?a.update(r,1,!1):a.update(r,2,!1),o==s-1&&(a.levelContainer.visible=!1)}this.setPassPortFight(e.power)},t.prototype.setPassPortFight=function(t){var e=t.toString();this.passPortFight.value=e,this.passPortFight.width=22*e.length,this.hlayout(0,this.passPortFight.parent)},t.prototype.setLeftFightNum=function(t,e){this.challenageNum.innerHTML=0==t?r.TextConst.get(885,"#ff0000",t,e):r.TextConst.get(885,"#09d51f",t,e)},t.prototype.setReward=function(t,e,i,n,s,o){this.aLevelRewardList.array=t,this.bLevelRewardList.array=e,this.sLevelRewardList.array=i,0<n.length?(this.extraReward.eqData=n[0],this.extraReward.lv_txt.text="",this.extraReward.visible=!0,this.lbDes.visible=this.lbLevelDes.visible=!0,this.lbLevelDes.innerHTML=r.TextConst.get(833,s),null==o&&(o=""),this.lbDes.innerHTML=o,this.imgExtraDes.visible=!0):(this.extraReward.visible=!1,this.lbDes.visible=this.lbLevelDes.visible=!1,this.imgExtraDes.visible=!1)},t.prototype.openRexueHander=function(){s.Switches.ins.event(175,[!0,!0])},t.prototype.rankItemRender=function(t,e){var i=t.dataSource;switch(e){case 0:t.imgRank.skin="res/hotbloodtemple/rxsd_paihangtubiao1.png";break;case 1:t.imgRank.skin="res/hotbloodtemple/rxsd_paihangtubiao2.png";break;case 2:t.imgRank.skin="res/hotbloodtemple/rxsd_paihangtubiao3.png"}t.lbName.text=i.nickname,t.lbLayer.text=r.TextConst.get(14,o.HBloodTempleEntryCtrl.layer(i.value1)),t.lbTime.text=r.TextConst.get(13,o.HBloodTempleEntryCtrl.time(i.value1))},t}(ui.hotbloodtemple.HBloodTempleEntryUI);e.HBloodTempleEntry=h}),define("src/g/hotbloodtemple/view/HBTemplePanel",["require","exports","../../../utils/ItemUtils","../../../utils/UIUtils","src/g/hotbloodtemple/ctrl/HBloodTempleEntryCtrl","src/init/TextConst"],function(t,e,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.initList(t.list_rank,ui.hotbloodtemple.HBTempleRankItem2UI,new Laya.Handler(t,t.onRenderListHandler)),t}return __extends(t,e),t.prototype.showView=function(){this.popup()},t.prototype.initList=function(t,e,i){t.itemRender=e,t.vScrollBarSkin="",t.scrollBar.elasticDistance=0,t.renderHandler=i,t.array=[]},t.prototype.resultHandler=function(t){this.list_rank.array=t.rankDataArr;var e=t.rankIdArr[2]+1;if(100<e)this.lab_myrank.changeText(a.TextConst.get(223)),this.lab_myport.visible=this.lbTime.visible=!1;else{this.lab_myrank.changeText(e+""),this.lab_myport.visible=this.lbTime.visible=!0;var i=t.rankDataArr[e-1];i&&(this.lab_myport.text=a.TextConst.get(14,o.HBloodTempleEntryCtrl.layer(i.value1)),this.lbTime.text=a.TextConst.get(884,o.HBloodTempleEntryCtrl.time(i.value1)))}},t.prototype.onRenderListHandler=function(t,e){var i=t.dataSource;t.lab_rank.changeText((e+1).toString()),t.lab_name.changeText(i.nickname),window.enabledpay&&(t.imgVip.skin=n.ItemUtils.getVipIconByLevel(i.vipLv),s.UIUtils.nameAndVipDisplay(t.imgVip,t.lab_name)),t.lab_port.text=o.HBloodTempleEntryCtrl.layer(i.value1)+"",t.lbTime.text=a.TextConst.get(13,o.HBloodTempleEntryCtrl.time(i.value1))},t}(ui.hotbloodtemple.HBTempleRankDlgUI);e.HBTemplePanel=i}),define("src/g/hotbloodtemple/ctrl/HBloodTempleEntryCtrl",["require","exports","src/g/base/BaseCtrl","../../../config/GameConfig","src/g/hotbloodtemple/view/HBloodTempleEntry","../../../manager/RoleCenter","../../../meta/CommonVo","src/g/fight/osprite/play/hotbloodpagoda/HotBloodPagodaManager","../../../utils/ItemDropUtil","../../../manager/GameSocketManager","../../net/messages/rank/RankDataGS2C","../../net/messages/rank/sbkRankDataBase","../../../core/GNet","src/g/hotbloodtemple/view/HBTemplePanel","src/g/clearRes/ClearResM","../../../core/E","../../../enum/EventName"],function(t,e,i,r,n,l,h,s,c,o,a,u,p,d,g,v,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var y=function(e){function t(){var t=e.call(this)||this;return t.sourceUrls=[],t.url="res/atlas/res/hotbloodtemple.json",t.init(),t}return __extends(t,e),t.prototype.loadUrls=function(){},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){},t.prototype.getTitle=function(){return"res/title/rxsd_biaotiwenzi.png"},t.prototype.init=function(){o.GSM.ins.on(a.RankDataGS2C.KEY,this,this.onReceivedRankData),v.E.ins.on(f.EventName.HB_PORTID_CHANGED,this,this.onPortIDChanged)},t.prototype.onPortIDChanged=function(){var t=l.RoleCenter.instans.self.bbGodData.curCfgId;console.log("热血神殿关卡ID变化了"+t),0<t&&this.view&&this.updPortInfo()},t.prototype.showPage=function(t,e){this.viewParent=t,this.open()},t.prototype.onAtlasLoaded=function(){if(null!=this.viewParent){null==this.view&&(this.view=new n.HBloodTempleEntry);var t=r.GameConfig.accessCtrlCfg[173];l.RoleCenter.instans.vo.getCurLv()<t.Srequire[0][1]?(this.view.openLimit.visible=this.view.challenageButton.disabled=!0,this.view.challenageNum.visible=!1):(this.view.openLimit.visible=this.view.challenageButton.disabled=!1,this.view.challenageNum.visible=!0),this.view.challenageButton.on(Laya.Event.CLICK,this,this.challagePort),this.view.detailRankButton.on(Laya.Event.CLICK,this,this.showRankPanel);var e=r.GameConfig.Ruledesc[21];this.view.lbHelp.innerHTML=e.tmptext,l.RoleCenter.instans.self.bbGodData.curCfgId&&this.updPortInfo()}},t.prototype.updPortInfo=function(){var t=this.view,e=this.viewParent;if(e){var i=l.RoleCenter.instans.self.bbGodData,n=i.curCfgId,s=r.GameConfig.hbtempleJson[n];if(n){var o=!1;s.type||(n-=1,s=r.GameConfig.hbtempleJson[n],o=!0);var a=h.CommonVo.getVoByKey("rxsdtimes");t.setPortList(this.getPortData(),s),t.setLeftFightNum(i.count,a.value),t.challenageButton.disabled=o,t.setReward(c.ItemDropUtil.createPortRewardData(s.port_Adrop,!0),c.ItemDropUtil.createPortRewardData(s.port_Bdrop,!0),c.ItemDropUtil.createPortRewardData(s.port_Sdrop,!0),c.ItemDropUtil.createPortRewardData(s.bonus,!0),n-36e3,s.bonusDesc),e.addChild(t),g.ClearResM.resetViewImg(t),p.GNet.getRankList(u.enumRankID.rankid_13,1,3)}else console.log("热血圣殿.关卡ID不存在"+n)}},t.prototype.getPortData=function(){var t=l.RoleCenter.instans.self.bbGodData.curCfgId,e=r.GameConfig.hbtempleJson[t],i=[];e.type||(t-=1,e=r.GameConfig.hbtempleJson[t]);for(var n=0;n<4;n++){var s=r.GameConfig.hbtempleJson[t+n];if(!s||!s.type)break;i.push(s)}return i},t.prototype.challagePort=function(){s.HotBloodPagodaManager.getInstance().enterHotBloodPagoda()&&this.destroyPage()},t.prototype.hidePage=function(){this.viewParent=null},t.prototype.destroyPage=function(){console.log("执行销毁view逻辑"),this.viewParent=null,this.view&&(this.rankPanel&&(this.rankPanel.removeSelf(),this.rankPanel=null),this.view.removeSelf(),this.view.destroy(!0),this.view=null),this.clearCtrlRes(),g.ClearResM.clearBgUrl()},t.prototype.onReceivedRankData=function(t){if(t.opresult&&t.rankIdArr[0]==u.enumRankID.rankid_13){if(this.view){var e=t.rankDataArr.concat();3<e.length&&e.splice(3),this.view.top3RankList.array=e}this.rankPanel&&null!=this.rankPanel.parent&&this.rankPanel.resultHandler(t)}},t.layer=function(t){return Math.floor(t/1e3)-36e3},t.time=function(t){return 1e3-t%1e3},t.prototype.showRankPanel=function(){null==this.rankPanel&&(this.rankPanel=new d.HBTemplePanel),this.rankPanel.showView(),p.GNet.getRankList(u.enumRankID.rankid_13,1,100)},t}(i.BaseCtrl);e.HBloodTempleEntryCtrl=y}),define("src/g/index/view/MainActivityBtn",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(t){var e=i.call(this)||this;return e._id=0,e._id=t,e}return __extends(t,i),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),t}(ui.activity.ActivityBtnUI);e.MainActivityBtn=i}),define("src/g/index/ctrl/ActivityBtnContainerCtrl",["require","exports","../../../core/E","../../../enum/EventName","../../../manager/ActivityManager","src/g/index/view/MainActivityBtn","../../../manager/RoleCenter","../../../config/GameConfig","src/g/Effects/UIEffectsFactory"],function(t,e,i,n,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){this._pos=0,this._id2Btn=new Laya.Dictionary,this._pos=t,this._container=e}return t.prototype.init=function(t){this._changedFun=t,i.E.ins.on(n.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.onBtnsChanged),i.E.ins.on(n.EventName.ACTIVITY_HALL_RED_UPDATE,this,this.onActivityRedUpdata),this.onBtnsChanged(this._pos),this.onActivityRedUpdata(this._pos)},t.prototype.onBtnsChanged=function(t){var s=this;if(this._pos==t){this._id2Btn.values.forEach(function(t){t.removeSelf()});var e=o.ActivityManager.ins.getActivatedIdsByPos(this._pos);e&&e.forEach(function(t){var e=s._id2Btn.get(t);if(null==e){e=new a.MainActivityBtn(t);var i=r.RoleCenter.instans.vo.getActivity1Data(t);if(i){var n=l.GameConfig.activityJson[i.cfgId];n&&(n.button&&(e.img.skin="dynamic/activity/"+n.button+".png"),n.showEffect&&h.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(e.effect_con,41))}s._id2Btn.set(t,e)}s._container.addChild(e)}),this._changedFun&&this._changedFun.run()}},t.prototype.onActivityRedUpdata=function(t){var n=this;t==this._pos&&this._id2Btn.keys.forEach(function(t){var e=r.RoleCenter.instans.vo.getActivity1Data(t);if(e){var i=n._id2Btn.get(t);i&&(i.img_red.visible=e.hasRed,i.effect_con.visible=e.hasRed)}})},t}();e.ActivityBtnContainerCtrl=s}),define("src/g/index/ctrl/EnterBBSCtrl",["require","exports","../../../utils/SoundUtils","src/g/gameSdk/gameSdk"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t){this._isAdd=!1,this._btn=t,this._btn&&(this._btn.on(Laya.Event.CLICK,this,this.onOpHandler),this._parent=this._btn.parent),1970==n.gameSdk.Ins.sdk.chid&&n.gameSdk.Ins.sdk.isShowEntBBS?this._btn.visible=!0:this._btn.removeSelf()}return t.prototype.onOpHandler=function(){i.SoundUtils.getInstance().playBtnsounds(),n.gameSdk.Ins.sdk.enterBBS("")},t}();e.EnterBBSCtrl=s}),define("src/g/index/view/FollowDlgCtrl",["require","exports","../../../utils/ItemUtils","src/g/clearRes/ClearResM","../../../config/GameConfig","src/g/gameSdk/gameSdk","../../../enum/enumItem","src/g/guide/vo/RewardVo","../../../meta/QualiyVo","src/g/account/view/AccItem","../../../vo/sbkUserVo","../../net/messages/ChannelGiftMsg","../../../manager/GameSocketManager"],function(t,e,c,n,s,o,u,p,d,g,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;return t.btn_share.on(Laya.Event.CLICK,t,t.onShare),t}return __extends(t,i),t.prototype.popup=function(){var t=s.GameConfig.cGift[u.ChannelGiftIdEnum.awyFollow],e=a.sbkUserVo.getChannelGiftCnt(u.ChannelGiftIdEnum.awyFollow);"aiweiyou"==o.gameSdk.Ins.sdk.sdkChannelName?this.lab_text.text="关注爱微游公众号,好礼等你拿":this.lab_text.text="关注游戏社区,好礼等你拿",this.lab_count.text="("+e+"/"+t.count+")",this.initByPanle(t.rewate2Inventory()),this.btn_share.label="关注领奖",this.box_shareTime.visible=!1,this.img_share.visible=!1,this.img_title.skin="res/unpack/channel_title_follow.png",this.img_tip.skin="res/unpack/channel_tip_follow.png",i.prototype.popup.call(this)},t.prototype.close=function(){this.closeEffect=null,i.prototype.close.call(this),this.btn_share.off(Laya.Event.CLICK,this,this.close),Laya.timer.once(100,this,function(){this.destroy(),n.ClearResM.clearResFolder("share")})},t.prototype.onShare=function(){o.gameSdk.Ins.sdk.showFollow("",function(){t.getFollowGift()}.bind(this)),this.close()},t.getFollowGift=function(){var t=new r.TakeChannelGiftC2GS;t.id=u.ChannelGiftIdEnum.awyFollow,l.GSM.sendServer(t)},t.prototype.initByPanle=function(t){if(t.currencyList){this.panelList.hScrollBarSkin="";for(var e=new Laya.Sprite,i=t.currencyList,n=0;n<i.length;n++){var s=new p.RewardVo;s.count=i[n].val;var o=c.ItemUtils.getCurrencyByDefine(i[n].key);s.name=o.name,s.type=u.ItemType.CURRENCY,s.quality=d.QualityStruct.Ins.getQColorById(o.quality),s.res=c.ItemUtils.getIconByIconId(o.icon),s.qualityNum=o.quality,s.define=i[n].key,s.streamer=o.streamer,(r=new g.AccItem).eqData=s,e.addChild(r),r.x=e.width,e.width+=r.width}}if(t.itemList){var a=t.itemList;for(n=0;n<a.length;n+=2){var r,l=new p.RewardVo,h=c.ItemUtils.getItemVoById(a[n]);l.res=c.ItemUtils.getIconByIconId(h.icon),l.lv=h.uselimit,l.qualityNum=h.quality,l.quality=d.QualityStruct.Ins.getQColorById(h.quality),l.name=h.name,l.id=h.id,l.type=u.ItemType.ITEM,l.count=a[n+1],l.streamer=h.streamer,(r=new g.AccItem).eqData=l,e.addChild(r),r.x=e.width,e.width+=r.width}}e.height=r.height,this.panelList.addChild(e),e.width>this.panelList.width?e.x=0:e.x=this.panelList.width/2-e.width/2},t}(ui.share.ShareViewUI);e.FollowViewDlg=i}),define("src/g/index/ctrl/FollowCtrl",["require","exports","../../../enum/EventName","src/g/gameSdk/gameSdk","../../../utils/SoundUtils","../../../manager/RoleCenter","../../../core/E","../../../vo/sbkUserVo","../../../enum/enumItem","src/g/index/view/FollowDlgCtrl"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(t){this._isAdd=!1,this._btn=t,this._btn&&(this._btn.on(Laya.Event.CLICK,this,this.onOpHandler),this._parent=this._btn.parent),this._btn.visible=!0,this.init()}return t.prototype.onOpHandler=function(){s.SoundUtils.getInstance().playBtnsounds(),(new h.FollowViewDlg).popup()},t.prototype.init=function(){if(this._btn){this._btn.once(i.EventName.ON_UI_DESTROYED,this,this.doDestroy);var t=r.sbkUserVo.getChannelGiftCnt(l.ChannelGiftIdEnum.awyFollow);n.gameSdk.Ins.sdk.isShowFollow&&0==t?n.gameSdk.Ins.sdk.isShowFollow&&0==t&&n.gameSdk.Ins.sdk.isfocus&&1==n.gameSdk.Ins.sdk.isfocus?(h.FollowViewDlg.getFollowGift(),this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE))):this.doInit():this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE))}},t.prototype.doInit=function(){this.updateBtnShow()},t.prototype.updateBtnShow=function(){o.RoleCenter.instans.vo&&(0<r.sbkUserVo.getChannelGiftCnt(l.ChannelGiftIdEnum.awyFollow)?this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE)):n.gameSdk.Ins.sdk.isShowFollow?this._parent&&!this._isAdd&&(this._isAdd=!0,this._parent.addChild(this._btn),this._btn.event(i.EventName.UI_ADD_TO_STAGE),a.E.ins.on(i.EventName.CHANNEL_GIFT_GET,this,this.updateBtnShow)):this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE)))},t.prototype.doDestroy=function(){this._btn=null,this._parent=null,a.E.ins.off(i.EventName.CHANNEL_GIFT_GET,this,this.updateBtnShow)},t}();e.FollowCtrl=c}),define("src/g/index/view/PhoneViewDlg",["require","exports","../../../utils/ItemUtils","src/g/clearRes/ClearResM","../../../config/GameConfig","src/g/gameSdk/gameSdk","../../../enum/enumItem","src/g/guide/vo/RewardVo","../../../meta/QualiyVo","src/g/account/view/AccItem","../../../vo/sbkUserVo","../../net/messages/ChannelGiftMsg","../../../manager/GameSocketManager"],function(t,e,c,n,s,o,u,p,d,g,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;return t.btn_share.on(Laya.Event.CLICK,t,t.onShare),t}return __extends(t,i),t.prototype.popup=function(){var t=s.GameConfig.cGift[u.ChannelGiftIdEnum.phone],e=a.sbkUserVo.getChannelGiftCnt(u.ChannelGiftIdEnum.phone);this.lab_text.text="此信息只用于爱微游官方，不会向第三方泄露",this.lab_text.visible=!0,this.lab_count.text="("+e+"/"+t.count+")",this.lab_count.visible=!1,this.initByPanle(t.rewate2Inventory()),this.btn_share.label="绑定手机",this.box_shareTime.visible=!1,this.img_follow.visible=!1,this.img_title.skin="res/unpack/channel_title_phone.png",this.img_tip.skin="res/unpack/channel_tip_phone.png",i.prototype.popup.call(this)},t.prototype.close=function(){this.closeEffect=null,i.prototype.close.call(this),this.btn_share.off(Laya.Event.CLICK,this,this.close),Laya.timer.once(100,this,function(){this.destroy(),n.ClearResM.clearResFolder("share")})},t.prototype.onShare=function(){o.gameSdk.Ins.sdk.bindPhone("",function(){t.getPhoneGift(),console.log("TakeChannelGiftC2GS")}.bind(this)),this.close()},t.getPhoneGift=function(){var t=new r.TakeChannelGiftC2GS;t.id=u.ChannelGiftIdEnum.phone,l.GSM.sendServer(t)},t.prototype.initByPanle=function(t){if(t.currencyList){this.panelList.hScrollBarSkin="";for(var e=new Laya.Sprite,i=t.currencyList,n=0;n<i.length;n++){var s=new p.RewardVo;s.count=i[n].val;var o=c.ItemUtils.getCurrencyByDefine(i[n].key);s.name=o.name,s.type=u.ItemType.CURRENCY,s.quality=d.QualityStruct.Ins.getQColorById(o.quality),s.res=c.ItemUtils.getIconByIconId(o.icon),s.qualityNum=o.quality,s.define=i[n].key,s.streamer=o.streamer,(r=new g.AccItem).eqData=s,e.addChild(r),r.x=e.width,e.width+=r.width}}if(t.itemList){var a=t.itemList;for(n=0;n<a.length;n+=2){var r,l=new p.RewardVo,h=c.ItemUtils.getItemVoById(a[n]);l.res=c.ItemUtils.getIconByIconId(h.icon),l.lv=h.uselimit,l.qualityNum=h.quality,l.quality=d.QualityStruct.Ins.getQColorById(h.quality),l.name=h.name,l.id=h.id,l.type=u.ItemType.ITEM,l.count=a[n+1],l.streamer=h.streamer,(r=new g.AccItem).eqData=l,e.addChild(r),r.x=e.width,e.width+=r.width}}e.height=r.height,this.panelList.addChild(e),e.width>this.panelList.width?e.x=0:e.x=this.panelList.width/2-e.width/2},t}(ui.share.ShareViewUI);e.PhoneViewDlg=i}),define("src/g/index/ctrl/PhoneViewCtrl",["require","exports","../../../enum/EventName","src/g/gameSdk/gameSdk","../../../utils/SoundUtils","../../../manager/RoleCenter","../../../core/E","../../../vo/sbkUserVo","../../../enum/enumItem","src/g/index/view/PhoneViewDlg"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(t){this._isAdd=!1,this._btn=t,this._btn&&(this._btn.on(Laya.Event.CLICK,this,this.onOpHandler),this._parent=this._btn.parent),this._btn.visible=!0,this.init()}return t.prototype.onOpHandler=function(){s.SoundUtils.getInstance().playBtnsounds(),(new h.PhoneViewDlg).popup()},t.prototype.init=function(){if(this._btn){this._btn.once(i.EventName.ON_UI_DESTROYED,this,this.doDestroy);var t=r.sbkUserVo.getChannelGiftCnt(l.ChannelGiftIdEnum.phone),e=o.RoleCenter.instans.self.svrid;!n.gameSdk.Ins.sdk.isShowPhone||0!=t||40001!=e&&40002!=o.RoleCenter.instans.self.svrid&&10025!=window.KtChannelId?this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE)):n.gameSdk.Ins.sdk.isShowPhone&&0==t&&n.gameSdk.Ins.sdk.isphone&&1==n.gameSdk.Ins.sdk.isphone?(h.PhoneViewDlg.getPhoneGift(),this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE))):this.doInit()}},t.prototype.doInit=function(){this.updateBtnShow()},t.prototype.updateBtnShow=function(){o.RoleCenter.instans.vo&&(0<r.sbkUserVo.getChannelGiftCnt(l.ChannelGiftIdEnum.phone)?this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE)):n.gameSdk.Ins.sdk.isShowPhone?this._parent&&!this._isAdd&&(this._isAdd=!0,this._parent.addChild(this._btn),this._btn.event(i.EventName.UI_ADD_TO_STAGE),a.E.ins.on(i.EventName.CHANNEL_GIFT_GET,this,this.updateBtnShow)):this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE)))},t.prototype.doDestroy=function(){this._btn=null,this._parent=null,a.E.ins.off(i.EventName.CHANNEL_GIFT_GET,this,this.updateBtnShow)},t}();e.PhoneCtrl=c}),define("src/g/index/view/CollectionView",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ui.share.CollectionViewUI);e.CollectionDlg=i}),define("src/g/index/ctrl/SendToDesktopCtrl",["require","exports","../../../manager/RoleCenter","../../../enum/EventName","../../../utils/SoundUtils","../../../manager/GameSocketManager","../../../core/E","src/g/index/view/CollectionView","../../../manager/AM","../../net/messages/share/sbkShareData"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(t,e){this._isAdd=!1,this.layoutMnger=e,this._btn=t,this._btn&&(this._btn.on(Laya.Event.CLICK,this,this.onOpHandler),this._parent=this._btn.parent),this._btn.visible=!1,this.init(),i.RoleCenter.instans.on("UPDATE_SHARE_DATA",this,this.refreshHandler),this.refreshHandler()}return t.prototype.refreshHandler=function(){this._btn.visible=!i.RoleCenter.instans.vo.shareData.hasGetCollectReward,this._btn.visible?this._parent.addChild(this._btn):(this._view&&this._view.parent&&this._view.close(),this._btn.removeSelf()),this.layoutMnger.update()},t.prototype.onOpHandler=function(){s.SoundUtils.getInstance().playBtnsounds(),this._view||(this._view=new r.CollectionDlg,this._view.btn_get.on(Laya.Event.CLICK,this,this.onGet)),this._view.popup(!0)},t.prototype.onGet=function(){if(1001==window.wxscene||1103==window.wxscene||1104==window.wxscene||1089==window.wxscene){var t=new h.getCollectRewardC2GS;o.GSM.sendServer(t)}else l.AM.show("请从小程序入口进入！")},t.prototype.init=function(){},t.prototype.doInit=function(){this.updateBtnShow()},t.prototype.updateBtnShow=function(){},t.prototype.doDestroy=function(){this._btn=null,this._parent=null,a.E.ins.off(n.EventName.CHANNEL_GIFT_GET,this,this.updateBtnShow)},t}();e.SendToDesktopCtrl=c}),define("src/g/index/ctrl/TimeLimitTaskBtnCtrl",["require","exports","../../../manager/RoleCenter","../../../core/E","../../../enum/EventName","../../../utils/system/ServerTime","../../../utils/system/DateUitl","src/init/Switches","../../../config/GameConfig"],function(t,e,o,a,r,l,i,n,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this._type=1}return t.prototype.init=function(t,e,i,n,s){void 0===s&&(s=1),this._btn=t,this._btn.on(Laya.Event.CLICK,this,this.onOpHandler),this._cdLab=e,this._layout=i,this._type=s,this._openId=n,this.doInit()},t.prototype.onOpHandler=function(){this._tltd&&n.Switches.ins.event(this._openId,this._tltd.id)},t.prototype.doInit=function(){if(o.RoleCenter.instans.vo.timeLimitTaskData)if(l.ServerTime.isInited){for(var t,e=o.RoleCenter.instans.vo.timeLimitTaskData,i=e.dataArr.length,n=0;n<i;){t=e.dataArr[n];var s=h.GameConfig.timeLimitTaskJson[t.id];if(s&&s.type==this._type&&t.endTime>l.ServerTime.serverTime){this.openTask(t);break}n++}a.E.ins.on(r.EventName.TIME_LIMIT_TASK_OPEN,this,this.onOpenHandler),a.E.ins.on(r.EventName.TIME_LIMIT_TASK_DELETE,this,this.onDelHandler)}else a.E.ins.once(r.EventName.SERVER_TIME_UPDATE,this,this.doInit);else a.E.ins.once(r.EventName.TIME_LIMIT_TASK_INITED,this,this.doInit)},t.prototype.openTask=function(t){t?(this._btn.visible=!0,this._layout&&this._layout.run(),this._tltd=t,this.cooldownHandler()):console.log("开启任务为空")},t.prototype.cooldownHandler=function(){if(this._tltd){var t=this._tltd.endTime-l.ServerTime.serverTime;86400<t?(this._cdLab.changeText(i.DateUtil.remainingDHStr(t)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=t?(this._cdLab.changeText(i.DateUtil.getHMS_countdown(t)),Laya.timer.once(1e3,this,this.cooldownHandler)):this._cdLab.changeText("00:00:00")}},t.prototype.onOpenHandler=function(t){var e=h.GameConfig.timeLimitTaskJson[t];if(e&&e.type==this._type){this._tltd&&this.onDelHandler(this._tltd.id);var i=o.RoleCenter.instans.vo.timeLimitTaskData,n=i.idArr.indexOf(t);this.openTask(i.dataArr[n])}},t.prototype.onDelHandler=function(t){this._tltd&&this._tltd.id==t&&(this._btn.visible=!1,this._layout&&this._layout.run(),this._tltd=null,Laya.timer.clearAll(this))},t}();e.TimeLimitTaskBtnCtrl=s}),define("src/g/realname/view/RealNameAuthentionView",["require","exports","../../../manager/LayerManager","src/g/clearRes/ClearResM","../../../core/E","../../../enum/EventName","../../../config/GameConfig","src/g/account/view/AccItem","../../../enum/enumItem","../../../meta/QualiyVo","../../../utils/ItemUtils","src/g/guide/vo/RewardVo","src/g/gameSdk/gameSdk","../../net/messages/ChannelGiftMsg","../../../manager/GameSocketManager"],function(t,e,i,n,s,o,a,c,u,p,d,g,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(e){function t(){var t=e.call(this)||this;return t.img_bg.width=Laya.stage.width,t.img_bg.height=Laya.stage.height,t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.btn_get.on(Laya.Event.CLICK,t,t.doGetReward),t.initReward(),t}return __extends(t,e),t.prototype.showView=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),i.LayerManager.addInPOPWindowLayer(this,t,!0,!0,!1,e),this.bgskin.restskin(),s.E.ins.on(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){s.E.ins.off(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),n.ClearResM.clearUrl(this.bgskin.skin)},t.prototype.onCloseHandler=function(){this.removeSelf()},t.prototype.initReward=function(){var t=a.GameConfig.cGift[u.ChannelGiftIdEnum.authentication];this.initByPanle(t.rewate2Inventory())},t.prototype.doGetReward=function(){r.gameSdk.Ins.sdk.showUserAuthentication("",function(t){var e=new l.TakeChannelGiftC2GS;e.id=u.ChannelGiftIdEnum.authentication,h.GSM.sendServer(e)}),this.onCloseHandler()},t.prototype.initByPanle=function(t){if(t.currencyList){this.panelList.hScrollBarSkin="";for(var e=new Laya.Sprite,i=t.currencyList,n=0;n<i.length;n++){var s=new g.RewardVo;s.count=i[n].val;var o=d.ItemUtils.getCurrencyByDefine(i[n].key);s.name=o.name,s.type=u.ItemType.CURRENCY,s.quality=p.QualityStruct.Ins.getQColorById(o.quality),s.res=d.ItemUtils.getIconByIconId(o.icon),s.qualityNum=o.quality,s.define=i[n].key,s.streamer=o.streamer,(r=new c.AccItem).eqData=s,e.addChild(r),r.x=e.width,e.width+=r.width}}if(t.itemList){var a=t.itemList;for(n=0;n<a.length;n+=2){var r,l=new g.RewardVo,h=d.ItemUtils.getItemVoById(a[n]);l.res=d.ItemUtils.getIconByIconId(h.icon),l.lv=h.uselimit,l.qualityNum=h.quality,l.quality=p.QualityStruct.Ins.getQColorById(h.quality),l.name=h.name,l.id=h.id,l.type=u.ItemType.ITEM,l.count=a[n+1],l.streamer=h.streamer,(r=new c.AccItem).eqData=l,e.addChild(r),r.x=e.width,e.width+=r.width}}e.height=r.height,this.panelList.addChild(e),e.width>this.panelList.width?e.x=0:e.x=this.panelList.width/2-e.width/2},t}(ui.real_name_authention.RealNameAuthentionViewUI);e.RealNameAuthentionView=v}),define("src/g/index/ctrl/UserAuthenticationCtrl",["require","exports","../../../enum/EventName","../../../manager/RoleCenter","src/g/gameSdk/gameSdk","../../../utils/SoundUtils","../../../core/E","../../../vo/sbkUserVo","../../../enum/enumItem","src/g/realname/view/RealNameAuthentionView"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(t){this._isAdd=!1,this._btn=t,this._btn&&(this._btn.on(Laya.Event.CLICK,this,this.onOpHandler),this._parent=this._btn.parent),this._btn.visible=!0,this.init()}return t.prototype.onOpHandler=function(){o.SoundUtils.getInstance().playBtnsounds(),(new h.RealNameAuthentionView).showView()},t.prototype.init=function(){if(this._btn){this._btn.once(i.EventName.ON_UI_DESTROYED,this,this.doDestroy);var t=r.sbkUserVo.getChannelGiftCnt(l.ChannelGiftIdEnum.authentication);s.gameSdk.Ins.sdk.isUserAuthentication&&0==t?this.doInit():this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE))}},t.prototype.doInit=function(){this.updateBtnShow()},t.prototype.updateBtnShow=function(){n.RoleCenter.instans.vo&&(0<r.sbkUserVo.getChannelGiftCnt(l.ChannelGiftIdEnum.authentication)?this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE)):s.gameSdk.Ins.sdk.isUserAuthentication?this._parent&&!this._isAdd&&(this._isAdd=!0,this._parent.addChild(this._btn),this._btn.event(i.EventName.UI_ADD_TO_STAGE),a.E.ins.on(i.EventName.CHANNEL_GIFT_GET,this,this.updateBtnShow)):this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE)))},t.prototype.doDestroy=function(){this._btn=null,this._parent=null,a.E.ins.off(i.EventName.CHANNEL_GIFT_GET,this,this.updateBtnShow)},t}();e.UserAuthentication=c}),define("src/g/index/view/PortView",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t.btn_autoBegin.visible=!1,t}return __extends(t,e),t}(ui.index.PortViewUI);e.PortView=i}),define("src/g/index/vo/FightPortVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){};e.FightPortVo=i}),define("src/g/login/vo/voPrecinctData",["require","exports","../../net/messages/GSData"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(i.GSData);e.voPrecinctGroupData=n}),define("src/g/loginreward/view/LoginDayItem",["require","exports","../../../manager/RoleCenter","../../net/messages/enumStatus","src/g/Effects/UIEffectsFactory"],function(t,e,n,s,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t._index=-1,t}return __extends(t,e),t.prototype.setData=function(t){this._index=t-1;var e=n.RoleCenter.instans.vo.getLoginRewardData();if(e)var i=e.children[this._index].status;this.day_value.value=t+"",7==t||14==t?(this.bigBox.visible=!0,this.smallBox.visible=!1,this.hitArea=new Laya.Rectangle(40,60,180,204),this.bigRewardGet.visible=i==s.enumStatus.yilingqu,7==t?(this.bigRewardGet.x=44,this.bigRewardGet.y=31,this.bigReward.skin="res/loginreward/denglu_7.png",i==s.enumStatus.weiwancheng?this.removeEffect2():i==s.enumStatus.kelingqu?this.addEffect2():this.removeEffect2()):(this.bigRewardGet.x=114,this.bigRewardGet.y=51,i==s.enumStatus.weiwancheng?(this.bigReward.skin="res/loginreward/denglu_14_0.png",this.removeEffect2()):i==s.enumStatus.kelingqu?(this.bigReward.skin="res/loginreward/denglu_14_0.png",this.addEffect2()):(this.bigReward.skin="res/loginreward/denglu_14_1.png",this.removeEffect2())),console.log("............yxq登录奖励测试index:"+t+":state:"+i+":skin:"+this.bigReward.skin)):(this.bigBox.visible=!1,this.smallBox.visible=!0,this.hitArea=new Laya.Rectangle(12,20,104,100),this.next_arrow.visible=!this.arrowHide(t),this.displayLogoByIndex(t),this.get_icon.visible=!1,i==s.enumStatus.kelingqu?(this.itemskin.skin="res/loginreward/denglu_baoxiang001.png",this.addEffect()):i==s.enumStatus.weiwancheng?(this.removeEf(),this.itemskin.skin="res/loginreward/denglu_baoxiang001.png"):i==s.enumStatus.yilingqu&&(this.removeEf(),this.get_icon.visible=!0,this.itemskin.skin="res/loginreward/denglu_baoxiang003.png"),console.log("............yxq登录奖励测试index:"+t+":state:"+i+":skin:"+this.itemskin.skin))},t.prototype.displayLogoByIndex=function(t){var e;switch(t){case 2:e="res/loginreward/denglu_chuanshiyaodai.png";break;case 4:e="res/loginreward/denglu_juebantujian.png";break;case 6:e="res/loginreward/denglu_yanlongzhihun.png"}this.imghuxue.visible=null!=e&&(this.imghuxue.skin=e,!0)},t.prototype.onSamllBoxSelected=function(t){this.smallBox.addChildAt(t,1)},t.prototype.arrowHide=function(t){return 3==t||6==t||10==t||13==t},t.prototype.removeEf=function(){null!=this.kelingquEf&&(this.kelingquEf.stop(),this.kelingquEf.removeSelf())},t.prototype.addEffect=function(){null==this.kelingquEf&&(this.kelingquEf=i.UIEffectsFactory.Ins.createSAniById(39,.7,.7),this.kelingquEf.x=(this.width-this.kelingquEf.width*this.kelingquEf.scaleX)/2,this.kelingquEf.y=(this.height-this.kelingquEf.height*this.kelingquEf.scaleY)/2+8),this.addChildAt(this.kelingquEf,0)},t.prototype.addEffect2=function(){null==this.effect2&&(this.effect2=new Laya.Image,this.effect2.skin="res/loginreward/denglu_effect.png",this.effect2.anchorX=this.effect2.anchorY=.5,this.effect2.x=116,this.effect2.y=177,this.effect2.scaleX=this.effect2.scaleY=1.5),Laya.timer.loop(50,this,this.playEffect),this.addChildAt(this.effect2,0)},t.prototype.playEffect=function(){this.effect2.rotation+=5,360==this.effect2.rotation&&(this.effect2.rotation=0)},t.prototype.removeEffect2=function(){null!=this.effect2&&(Laya.timer.clearAll(this),this.effect2.removeSelf())},t.prototype.refresh=function(){-1!=this._index&&this.setData(this._index+1)},t}(ui.loginreward.ItemBoxUI);e.LoginDayItem=o}),define("src/g/lottery/VoUtils",["require","exports","../../config/GameConfig"],function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.getCurrLvVo=function(t,e){var i;if(0==e)return i;var n=a.GameConfig.sylevel;for(var s in n){var o=n[s];if(o.type==t&&o.level==e){i=o;break}}return i},t.getCurrTzVo=function(t,e){var i;if(0==e)return i;var n=a.GameConfig.sysuit;for(var s in n){var o=n[s];if(o.type==t&&o.level==e){i=o;break}}return i},t}();e.VoUtils=i}),define("src/g/lottery/view/page/ChengZhuangPage",["require","exports","../../../../manager/GameSocketManager","../../../net/messages/sbkFormula","src/g/lottery/Vo/ChengZhuangVo","../../../../utils/ItemUtils","../../../../manager/RoleCenter","../../../net/messages/PutonEquipC2GS","../../../net/messages/PropFightMain","../../../net/messages/CompoundEquipC2GS","../../../../utils/system/ErrCodeView","../../../net/messages/ErrConst","../../../../utils/system/FloatEffect","src/g/Effects/UIEffectsFactory","../../../../vo/RedDot/lottery/RedDot_ChengZhuang","../../../../plugin/view/ToolTip","../../../../meta/QualiyVo","src/init/TextConst","src/g/lottery/Vo/ShengShiVo"],function(t,e,i,c,K,Y,j,J,u,n,s,o,a,W,r,l,z,y,X){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.czIns=K.ChengZhuangStruct.Ins,t.user=j.RoleCenter.instans.vo,t._nowSelectHero=-1,t._nowSelectPos=J.EPosEquip.wuqi,t._eid=0,t._canUp=!1,t._maxLv=!1,t._notNeed=!1,t._levelOk=!1,t.aniType=!1,t.minLv=0,t.suitNum=0,t.btn_up.on(Laya.Event.CLICK,t,t.onUp),t.lab_showSuit.on(Laya.Event.CLICK,t,t.changeViewType,[!0]),t.box_suit.on(Laya.Event.CLICK,t,t.changeViewType,[!1]),t.onLoadUIEF(),t.on(Laya.Event.REMOVED,t,t.onRemoved),t}return __extends(t,e),t.prototype.onRemoved=function(){Laya.loader.clearRes(this.imgbg.skin,!0)},t.prototype.onLoadUIEF=function(){this.ani_put=W.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.ani,42,1.6,1),this.ani_btnPut=W.UIEffectsFactory.Ins.createUIAniById(40,!0),W.UIEffectsFactory.Ins.centered4Parent(this.ani_btnPut,this.btn_up,!0),this.ani_btnPut.visible=!1},t.prototype.onUp=function(){if(this._maxLv)a.FE.upItems(y.TextConst.get(614),l.BubbleEnum.center);else if(this._notNeed)s.ErrCodeView.show(o.enumErrConst.code_2207);else if(!this._canUp||this._levelOk){var t=new n.CompoundEquipC2GS;t.heroidx=this._nowSelectHero,t.equpos=this._nowSelectPos,t.equipCfgId=this._eid,i.GSM.sendServer(t)}else s.ErrCodeView.show(o.enumErrConst.code_2413)},t.prototype.showEquip=function(){(this._maxLv||this._notNeed)&&(this.ani_btnPut.visible=!1),this._notNeed&&(this.ani_btnPut.visible=!1),this._canUp&&(this._levelOk||(this.ani_btnPut.visible=!1));var t,e=this._hero.getPos(this._nowSelectPos-1),i=j.RoleCenter.instans.vo.zhuanshengLv,n=e.equins.equid==J.EPosEquip.null,s=this._nowSelectPos,o=j.RoleCenter.instans.vo.lvl,a=this["equip_"+ktgame.RoleDefineMod.arr_equipPosConst[s-1]];this._nowSelectPos!=J.EPosEquip.shouzhuo1&&this._nowSelectPos!=J.EPosEquip.shouzhuo2||(s=J.EPosEquip.shouzhuo),this._nowSelectPos!=J.EPosEquip.jiezhi1&&this._nowSelectPos!=J.EPosEquip.jiezhi2||(s=J.EPosEquip.jiezhi),t=this.czIns.getChengZhuangVo(this._hero.jobid,s,i,o);var r;for(Y.ItemUtils.getEquipVoById(e.equins.equtemplet);0<a.qualAni.numChildren;)(r=a.qualAni.removeChildAt(a.qualAni.numChildren-1))&&r.destroy();var l=z.QualityStruct.Ins.getQEffByEquip(e);if(0<l&&(r=W.UIEffectsFactory.Ins.createUIAniById(l,!0),W.UIEffectsFactory.Ins.centered4Parent(r,a.qualAni,!0),r.play()),n||!e.equins.chengzhuang){var h=1;if(!e.equins.chengzhuang&&!n){var c=Y.ItemUtils.getEquipVoById(e.equins.equtemplet);h=K.ChengZhuangStruct.Ins.LvArr.indexOf(c.limit)}for(var u=h,p=h;0<p;p--){var d=K.ChengZhuangStruct.Ins.LvArr[p],g=K.ChengZhuangStruct.Ins.getChengZhuangVoByLv(this._hero.jobid,e.equpos,d);if(g){c=Y.ItemUtils.getEquipVoById(g.id);var v=Y.ItemUtils.getEquipVoById(e.equins.equtemplet||g.id),f=0<e.equins.equtemplet?e.equins.combat:v.Combat;if(c.Combat<=f)break;u=p}}var y=K.ChengZhuangStruct.Ins.LvArr[u];if(t=K.ChengZhuangStruct.Ins.getChengZhuangVoByLv(this._hero.jobid,e.equpos,y),e.equins.red){t.id=e.equins.equtemplet;c=Y.ItemUtils.getEquipVoById(e.equins.equtemplet);t.nowLv=c.limit}this.checkShowRightBox(!1),this.showNow(t);var m=Y.ItemUtils.getEquipVoById(t.id),_=this.user.bagdata.getItemCount(parseInt(m.worth[0][0])),C=Y.ItemUtils.getItemVoById(m.worth[0][0]);this.item_cost.setNeedName(C.name,Y.ItemUtils.getSmallIcon(C.icon)),this.item_cost.setQualColor(Y.ItemUtils.getColorByQuality(C.quality));var I=m.worth[0][1],b=0,w=0;1<m.worth.length&&(b=this.user.bagdata.getItemCount(parseInt(m.worth[1][0])),C=Y.ItemUtils.getItemVoById(m.worth[1][0]),this.item_cost2.setNeedName(C.name,Y.ItemUtils.getSmallIcon(C.icon)),this.item_cost2.setQualColor(Y.ItemUtils.getColorByQuality(C.quality)),w=m.worth[1][1]);var S=!1,E=m.id;if(X.ShengShiStruct.Ins.isShengShi(E)){var T=X.ShengShiStruct.Ins.getNextShengShiVo(this._nowSelectPos,m.limit,m.job);if(T){var A=Y.ItemUtils.getEquipVoById(T.id);E=A.id,I=A.worth[0][1]-I,1<m.worth.length&&(w=A.worth[1][1]-w)}else S=!(w=I=0)}return this.showNeed(_,I,b,w,S),this._eid=E,this.checkLevelOk(t.nowLv),X.ShengShiStruct.Ins.isShengShi(E)?void(a.img_tip.visible=I<=_&&!S):void(e.equins.red?(a.img_tip.visible=!1,this.btn_up.disabled=!0,this.ani_btnPut.visible=!1):(a.img_tip.visible=this._canUp&&this._levelOk,this.btn_up.disabled=!1))}var R=Y.ItemUtils.getEquipVoById(e.equins.equtemplet),L=this.czIns.getNextLvByLv(R.limit);if(0==L){this.showNow(t),this.checkShowRightBox(!1);var x=this.user.bagdata.getItemCount(parseInt(R.worth[0][0])),P=Y.ItemUtils.getItemVoById(R.worth[0][0]);this.item_cost.setNeedName(P.name,Y.ItemUtils.getSmallIcon(P.icon)),this.item_cost.setQualColor(Y.ItemUtils.getColorByQuality(P.quality));S=0==this.czIns.getNextLvByLv(R.limit);var k=0,D=0;return 1<R.worth.length&&(k=this.user.bagdata.getItemCount(parseInt(R.worth[1][0])),D=R.worth[1][1],P=Y.ItemUtils.getItemVoById(R.worth[1][0]),this.item_cost2.setNeedName(P.name,Y.ItemUtils.getSmallIcon(P.icon)),this.item_cost2.setQualColor(Y.ItemUtils.getColorByQuality(P.quality))),this.showNeed(x,R.worth[0][1],k,D,S),this.checkLevelOk(L),a.img_tip.visible=this._canUp&&this._levelOk,void(this._eid=R.id)}this.checkShowRightBox(!0);for(var H=this.czIns.getChengZhuangVoByLv(this._hero.jobid,e.equpos,R.limit),M=Y.ItemUtils.getEquipVoById(H.id),G=this.czIns.getNextLvByLv(H.nowLv),B=this.czIns.getChengZhuangVoByLv(this._hero.jobid,e.equpos,G),N=Y.ItemUtils.getEquipVoById(B.id);M.Combat>=N.Combat;)G=this.czIns.getNextLvByLv(G),B=this.czIns.getChengZhuangVoByLv(this._hero.jobid,e.equpos,G),N=Y.ItemUtils.getEquipVoById(B.id);if(this.showNow(H),H.nowLv==t.nowLv){var U=this.czIns.getNextLvByLv(H.nowLv);t=this.czIns.getChengZhuangVoByLv(this._hero.jobid,e.equpos,U)}else t=B;var V=Y.ItemUtils.getEquipVoById(t.id);this.showNext(t);var O=this.user.bagdata.getItemCount(parseInt(R.worth[0][0])),F=V.worth[0][1]-R.worth[0][1];this.checkLevelOk(B.nowLv);var q=Y.ItemUtils.getItemVoById(R.worth[0][0]);this.item_cost.setNeedName(q.name,Y.ItemUtils.getSmallIcon(q.icon)),this.item_cost.setQualColor(Y.ItemUtils.getColorByQuality(q.quality));k=0,D=0;1<V.worth.length&&(k=this.user.bagdata.getItemCount(parseInt(V.worth[1][0])),D=1<R.worth.length?V.worth[1][1]-R.worth[1][1]:V.worth[1][1],q=Y.ItemUtils.getItemVoById(V.worth[1][0]),this.item_cost2.setNeedName(q.name,Y.ItemUtils.getSmallIcon(q.icon)),this.item_cost2.setQualColor(Y.ItemUtils.getColorByQuality(q.quality))),this.showNeed(O,F,k,D,!1),a.img_tip.visible=this._canUp&&this._levelOk,this.btn_up.disabled=!1,this._eid=V.id,(this._maxLv||this._notNeed)&&(this.ani_btnPut.visible=!1),this._notNeed&&(this.ani_btnPut.visible=!1),this._canUp&&(this._levelOk||(this.ani_btnPut.visible=!1))},t.prototype.checkLevelOk=function(t){var e=1e3*this.user.zhuanshengLv+this.user.lvl;this._levelOk=t<=e},t.prototype.checkShowRightBox=function(t){this.box_now.x=t?18:(this.box_comp.width-this.box_now.width)/2,this.box_next.visible=t;for(var e=0;e<4;e++)this["prop_now_"+e].align=t?"left":"center"},t.prototype.showNow=function(t){var e=Y.ItemUtils.getEquipVoById(t.id);this.lab_nowEName.text=e.name,this.item_now.setName(Y.ItemUtils.getEquipLv(e.limit));var i=z.QualityStruct.Ins.transEquipQuality(e);this.item_now.setTrait(i,z.QualityStruct.Ins.getQPicById(i)),this.item_now.showIcon(Y.ItemUtils.getIconById(t.id));for(var n=new u.PropFightMain,s=new u.PropFightMain,o=e.max/100,a=0;a<4;a++)if(e.prop.length>a){n[e.prop[a][0]]=e.prop[a][1],s[e.prop[a][0]]=Math.floor(e.prop[a][1]*o);var r,l=Y.ItemUtils.getShuXingByName(e.prop[a][0]),h=e.prop[a][1]+s[e.prop[a][0]];r=l.desc+": "+h,this["prop_now_"+a].text=r,this["prop_now_"+a].visible=!0,this["tip_"+a].visible=!0}else this["tip_"+a].visible=!1,this["prop_now_"+a].visible=!1;this.lab_now_grade.text=y.TextConst.get(85,c.sbkFormula.calPropFightMainCombat(n)+c.sbkFormula.calPropFightMainCombat(s))},t.prototype.showNext=function(t){var e=Y.ItemUtils.getEquipVoById(t.id);this.lab_nextEName.text=e.name,this.item_next.setName(Y.ItemUtils.getEquipLv(e.limit));var i=z.QualityStruct.Ins.transEquipQuality(e);this.item_next.setTrait(i,z.QualityStruct.Ins.getQPicById(i)),this.item_next.showIcon(Y.ItemUtils.getIconById(t.id));for(var n=new u.PropFightMain,s=new u.PropFightMain,o=e.max/100,a=0;a<4;a++)if(e.prop.length>a){n[e.prop[a][0]]=e.prop[a][1],s[e.prop[a][0]]=Math.floor(e.prop[a][1]*o);var r;r=e.prop[a][1]+s[e.prop[a][0]]+"",this["prop_next_"+a].text=r,this["prop_next_"+a].visible=!0,this["tipImg_"+a].visible=!0}else this["prop_next_"+a].visible=!1,this["tipImg_"+a].visible=!1;this.lab_next_grade.text=y.TextConst.get(85,c.sbkFormula.calPropFightMainCombat(n)+c.sbkFormula.calPropFightMainCombat(s))},t.prototype.showNeed=function(t,e,i,n,s){this._canUp=this._maxLv=this._notNeed=!1,this._maxLv=s,this._canUp=!s&&e<=t&&n<=i,this._notNeed=t<e||i<n,this.item_cost.setNeed(t,e),this.item_cost2.visible=0<n,this.item_cost2.setNeed(i,n),this.btn_up.label=this.box_next.visible?y.TextConst.get(615):y.TextConst.get(616),this._canUp?this.ani_btnPut.visible=!0:s&&(this.ani_btnPut.visible=!1)},t.prototype.chenge_next=function(){if(this._maxLv||this._notNeed||this._canUp&&!this._levelOk)for(var t=0;t<8&&(this._nowSelectPos=this._nowSelectPos%8+1,this.cleckHandler(this._nowSelectPos),!this._canUp||!this._levelOk);t++);},t.prototype.refreshData=function(t){void 0===t&&(t=0);var e=r.RedDot_ChengZhuang.Ins.red_canreslove;this.ani_put.visible=!!e,this._nowSelectHero=t,this._hero=j.RoleCenter.instans.vo.getOpenHeroByIdx(t),this.showBase(),this.cleckHandler(this._nowSelectPos),this.showEquip(),this.chenge_next()},t.prototype.playCanResolve=function(){this.stopCanResolev(),Laya.timer.loop(100,this,this.onPlayResolve)},t.prototype.onPlayResolve=function(){this.ani.alpha<=0?this.aniType=!0:1<=this.ani.alpha&&(this.aniType=!1);var t=this.aniType?.1:-.1;this.ani.alpha+=t},t.prototype.stopCanResolev=function(){Laya.timer.clear(this,this.playCanResolve)},t.prototype.showBase=function(){var e=this,t=this._nowSelectPos;this.findMin();for(var i=0;i<8;i++){var n=this._hero.getPos(i),s=n.equpos-1;this._nowSelectPos=n.equpos,this.showEquip();var o=void 0;o=this["equip_"+ktgame.RoleDefineMod.arr_equipPosConst[s]];var a=n.equins.chengzhuang||n.equins.red?n.equins.equtemplet:0,r=new Laya.Handler(this,function(t){e.cleckHandler(t.equpos)},[n]);o.setClieckHD(r);var l=Y.ItemUtils.getEquipVoById(a),h=void 0;if(0==a){var c=K.ChengZhuangStruct.Ins.getChengZhuangVoByLv(this._hero.jobid,n.equpos,this.minLv);h=Y.ItemUtils.getEquipVoById(c.id)}else h=l;var u=this["suit_"+ktgame.RoleDefineMod.arr_equipPosConst[s]];u.setIcon(Y.ItemUtils.getIconByIconId(h.icon));var p=h.limit,d=0!=a,g="";g=1e3<p?y.TextConst.get(44,p/1e3>>0):y.TextConst.get(16,p),u.lab_des.text=h.name+" ("+g+")",u.lab_des.color=d?"#349320":"#a89e8f",u.img_icon.gray=!d;var v=0<a?Y.ItemUtils.getIconById(l.id):"res/custom/equipIcon/equip_"+ktgame.RoleDefineMod.arr_equipPosConst[s]+".png";o.showIcon(v),o.setName(0<a?Y.ItemUtils.getEquipLv(l.limit):"");var f=z.QualityStruct.Ins.transEquipQuality(l);0==f&&(f=1),o.setTrait(f,z.QualityStruct.Ins.getQPicById(f))}this._nowSelectPos=t,0<this._nowSelectPos&&this.cleckHandler(this._nowSelectPos),this.showSuit()},t.prototype.showSuit=function(){this.title_comp.setlv(this.minLv),this.title_comp.setCount(this.suitNum),this.title_suit.setlv(this.minLv),this.title_suit.setCount(this.suitNum);var t=K.ChengZhuangStruct.Ins.getSuitByLv(this.minLv);this.lab_suitDes.text=y.TextConst.get(883,t.prop[0][1]/100>>0)},t.prototype.findMin=function(){this.minLv=1,this.suitNum=0;for(var t=this.minLv,e=0,i=0;i<8;i++){var n=this._hero.getPos(i);if(0!=n.equins.equtemplet)if(n.equins.red)this.suitNum+=1;else if(n.equins.chengzhuang){var s=Y.ItemUtils.getEquipVoById(n.equins.equtemplet);0!=s.limit?(1==this.minLv&&0!=s.limit&&0==e?t=s.limit:s.limit<t&&(t=s.limit),this.suitNum+=1,e++):this.suitNum+=1}}this.minLv=t},t.prototype.cleckHandler=function(t){this._nowSelectPos=t,this.setSelect(t),this.showEquip()},t.prototype.changeViewType=function(t){void 0===t&&(t=!1),this.box_suit.visible=t,this.box_comp.visible=!t},t.prototype.setSelect=function(t){for(var e=0;e<8;e++){var i=this._hero.getPos(e);this["equip_"+ktgame.RoleDefineMod.arr_equipPosConst[e]].setSelect(i.equpos==t)}i=this._hero.getPos(this._nowSelectPos-1)},t}(ui.lottery.Pages.ChengZhuangPageUI);e.ChengZhuangPage=h}),define("src/g/lottery/ctrl/ChengZhuangCtrl",["require","exports","src/g/lottery/view/page/ChengZhuangPage","../../../core/E","../../../enum/EventName","src/g/Effects/UIEffectsFactory","../../../vo/RedDot/EventRedDot","src/init/ResManager","src/g/clearRes/ClearResM","src/init/TextConst","../../../vo/RedDot/lottery/RedDot_ShengShi","../../../vo/RedDot/lottery/RedDot_ChengZhuang"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(){function t(){this._nowSelectHero=0}return t.prototype.init=function(){return this._view||(this._view=new i.ChengZhuangPage),this.addEvent(),this},t.prototype.onRefreshShow=function(){this._view&&this.refreshData()},t.prototype.showPage=function(t){t.removeChildren(),t.addChild(this._view),l.ClearResM.resetViewImg(this._view),r.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.onOpenResolveDlg=function(){n.E.ins.event(s.EventName.OPENCHENGZHANGRESOLVE)},t.prototype.changePerson=function(t){this._nowSelectHero=t,this.refreshData()},t.prototype.refreshData=function(){this._view.refreshData(this._nowSelectHero)},t.prototype.addEvent=function(){n.E.ins.on(s.EventName.PUTCZORSSEQUIP,this,this.onPutNew),n.E.ins.on(s.EventName.CHANGEROLE_SHOW,this,this.onRefreshShow),n.E.ins.on(s.EventName.EQUIPSPLITOVER,this,this.onRefreshShow),n.E.ins.on(a.EventRedDot.REFRESH_CHENGZHUANG,this,this.refreshChengZhuang),this._view.item_cost.setJump(h.TextConst.get(608),new Laya.Handler(this,this.onOpenResolveDlg)),this._view.item_cost2.setJump(h.TextConst.get(1100),new Laya.Handler(this,this.onOpenResolveDlg))},t.prototype.onPutNew=function(t){t.arr[0].red?(c.RedDot_ShengShi.Ins.reCheckCanReslove(),c.RedDot_ShengShi.Ins.reCheckShengShi()):t.arr[0].chengzhuang&&(u.RedDot_ChengZhuang.Ins.recheckChengZhuang(),u.RedDot_ChengZhuang.Ins.reCheckCanReslove())},t.prototype.refreshChengZhuang=function(){this._view.displayedInStage&&this.refreshData()},t.prototype.showAni=function(t){if(this._view.displayedInStage)o.UIEffectsFactory.Ins.playAniOnce(t?68:11,this._view.ani_pos,1.3,1.3);this._view.chenge_next()},t.prototype.stopAni=function(){this._view&&this._view.ani_pos.removeChildren()},t.prototype.getTitle=function(){return"res/lottery/xunbao_biaoti_wenzi2.png"},t.prototype.hidePage=function(){r.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){r.ResManager.getInstance().destroyPageCtrl(this)},t}();e.ChengZhuangPageCtrl=p}),define("src/g/lottery/view/CzResolveDlg",["require","exports","../../../manager/RoleCenter","../../../utils/ItemUtils","../../../enum/enumItem","../../net/messages/EquipSplitC2GS","../../../manager/GameSocketManager","src/g/itemGets/View/ItemGet_TipItem","src/init/TextConst"],function(t,e,i,a,n,s,o,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t.bag=i.RoleCenter.instans.vo.bagdata,t._datasrc=[],t.bg.imgInnerBg.bottom=14,t.addEvent(),t}return __extends(t,e),t.prototype.refreshData=function(){this.addGetGo(),this._datasrc=[];for(var t=0;t<this.bag.equBagData.length;t++){var e=a.ItemUtils.getEquipVoById(this.bag.equBagData[t].equtemplet);e&&(e.quality==n.enumItem.orange&&this._datasrc.push(this.bag.equBagData[t]))}this.list_.dataSource=this._datasrc},t.prototype.addGetGo=function(){this.vbox.removeChildren();for(var t=a.ItemUtils.getItemVoById(104),e=2;e<t.link.length;e++){var i=(new r.ItemGet_TipItem).init(t.link[e][0],t.link[e][1]);i.on(Laya.Event.CLICK,this,this.close),this.vbox.addChild(i),this.vbox.height+=i.height}},t.prototype.onRender=function(t,e){var i=t.dataSource,n=a.ItemUtils.getEquipVoById(i.equtemplet);if(!(n&&n.worth.length<=0)){var s=a.ItemUtils.getItemVoById(parseInt(n.worth[0][0]));t.setQualityBg(a.ItemUtils.getQualityBjById(n.id)),t.html_text.style.fontSize=18,t.html_text.innerHTML=l.TextConst.get(857,a.ItemUtils.getColorByQuality(n.quality),n.name),t.setLv(a.ItemUtils.getEquipLv(n.limit)),t.setIcon(a.ItemUtils.getIconById(n.id)),t.setJob(n.job),t.setGet(s.name+"x"+n.worth[0][1]),t.lab_canGet.color=a.ItemUtils.getColorByQuality(n.quality),t.lab_canGet2.visible=!1,1<n.worth.length&&(t.lab_canGet2.visible=!0,s=a.ItemUtils.getItemVoById(parseInt(n.worth[1][0])),t.lab_canGet2.changeText(s.name+"x"+n.worth[1][1]),t.lab_canGet2.color=a.ItemUtils.getColorByQuality(n.quality));var o=new Laya.Handler(this,this.SplitHandler);t.setResolveHandler(o)}},t.prototype.SplitHandler=function(t){var e=new s.EquipSplitC2GS;e.splittype=s.ESplitType.ChengEquip,e.equipidarr.push(t.equid),o.GSM.sendServer(e)},t.prototype.completeHandler=function(){this._ani&&this._ani.stop()},t.prototype.oneSendHandler=function(){if(!(this._datasrc.length<=0)){var t=new s.EquipSplitC2GS;t.splittype=s.ESplitType.ChengEquip;for(var e=0;e<this._datasrc.length;e++)t.equipidarr.push(this._datasrc[e].equid),14<t.equipidarr.length&&(o.GSM.sendServer(t),t.equipidarr=[]);o.GSM.sendServer(t)}},t.prototype.addEvent=function(){this.list_.renderHandler=new Laya.Handler(this,this.onRender),this.btn_one.on(Laya.Event.CLICK,this,this.oneSendHandler)},t}(ui.lottery.resolveCZDlgUI);e.CzResolveDlg=h}),define("src/g/lottery/ctrl/CzResolveDlgCtrl",["require","exports","../../../core/E","../../../enum/EventName","src/g/lottery/view/CzResolveDlg","../../../vo/RedDot/lottery/RedDot_ChengZhuang"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){this.init()}return t.prototype.init=function(){this._view||(this._view=new s.CzResolveDlg),this.addEvent()},t.prototype.addEvent=function(){i.E.ins.on(n.EventName.OPENCHENGZHANGRESOLVE,this,this.onResolveChengZhuang),i.E.ins.on(n.EventName.EQUIPSPLITOVER,this,this.onEquipSplit),this._view.btn_back.on(Laya.Event.CLICK,this,this.onClose),this._view.bg.btn_close.on(Laya.Event.CLICK,this,this.onClose)},t.prototype.onEquipSplit=function(t){o.RedDot_ChengZhuang.Ins.reCheckCanReslove(),o.RedDot_ChengZhuang.Ins.recheckChengZhuang(),this._view.displayedInStage&&this._view.refreshData()},t.prototype.onResolveChengZhuang=function(){this._view.refreshData(),this._view.popup()},t.prototype.onClose=function(){this._view.close()},t}();e.CzResolveDlgCtrl=a}),define("src/g/lottery/view/page/FuMoSkillTip",["require","exports","src/init/TextConst","../../../../utils/ItemUtils"],function(t,e,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this,e=t.lab_desc.style;return e.font="SimHei",e.color="#a89e8f",e.stroke=1,e.fontSize=20,e.wordWrap=!0,e.strokeColor="#060606",t}return __extends(t,i),t.prototype.initData=function(t,e){this.lab_open.text=e?o.TextConst.get(524):o.TextConst.get(485);var i=a.ItemUtils.getSkillDefItem(t);this.lab_skillName.color="#fff55c",this.lab_skillName.changeText(i.name);for(var n=i.desc,s=0;s<i.effect.length;s++)n=n.replace("{"+i.effect[s][0]+"}",i.effect[s][1]/1e4+"");n=n.replace("{rate}",i.rate/100+""),this.lab_desc.innerHTML=n},t}(ui.lottery.Pages.fumo.FuMoSkillTipUI);e.FuMoSkillTip=i}),define("src/g/lottery/view/page/FuMoPage",["require","exports","../../../../manager/RoleCenter","../../../net/messages/PutonEquipC2GS","../../../../utils/ItemUtils","../../../../meta/QualiyVo","../../../../config/GameConfig","../../../net/messages/sbkEquipIns","src/init/TextConst","src/g/Effects/UIEffectsFactory","../../../net/messages/EquipProChgC2GS","../../../net/messages/OpResultType","../../../../manager/GameSocketManager","src/g/custom/SuitAttrDlg","../../../../core/NumE","src/g/lottery/view/page/FuMoSkillTip","../../../../utils/effects/BesselEffect","src/g/itemGets/View/ItemGetDlg"],function(t,e,r,n,p,d,l,o,c,g,s,a,h,u,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(t){var e=i.call(this)||this;return e._nowSelectHero=-1,e._nowSelectPos=n.EPosEquip.wuqi,e.waitPos=0,e.currPlayItemIndex=0,e.listenItemId=0,e.btn_up.on(Laya.Event.CLICK,e,e.doLevelUpHandler),e.btn_suit.on(Laya.Event.CLICK,e,e.onShowSuitAttr),e._redCtrl=t,e}return __extends(t,i),t.prototype.refreshData=function(t){void 0===t&&(t=0),this._nowSelectHero=t,this._hero=r.RoleCenter.instans.vo.getOpenHeroByIdx(t),this.updateEquips(),this.updateSelectedPosSkill(this._nowSelectPos),this.updateSelectedPosAttr(this._nowSelectPos),this.updateSelectedPosCost(this._nowSelectPos),this.updateSelectedPosLvBtn(this._nowSelectPos),this.updateHeadRed()},t.prototype.showPage=function(t){this._tab_head=t,this.updateHeadRed()},t.prototype.updateHeadRed=function(){if(this._tab_head){for(var t,e=[],i=0;i<3;)(t=this._redCtrl[i.toString()])&&e.push(t.hasRed()),i++;this._tab_head.refreshHeadRedHint(e)}},t.prototype.onHidePage=function(){0<this.listenItemId&&(v.NumE.ins.off(this.listenItemId+v.NumE.CHANGED,this,this.onItemChangedHandler),this.listenItemId=0)},t.prototype.updateEquips=function(){for(var e=this,t=0;t<8;t++){var i=this._hero.getPos(t),n=void 0,s=ktgame.RoleDefineMod.arr_equipPosConst[i.equpos-1];n=this["equip_"+s],this._selectedEquipItem||this._nowSelectPos!=i.equpos||(this._selectedEquipItem=n).setSelect(!0),n.img_tip.visible=this.getRed(i.equpos);var o=i.equins.chengzhuang||i.equins.red?i.equins.equtemplet:0,a=new Laya.Handler(this,function(t){e.onEquipClickHandler(t.equpos)},[i]);n.setClieckHD(a);var r=p.ItemUtils.getEquipVoById(o),l=0<o?p.ItemUtils.getIconById(r.id):"res/custom/equipIcon/equip_"+s+".png";n.showIcon(l),n.setName(0<o?p.ItemUtils.getEquipLv(r.limit):"");var h,c=d.QualityStruct.Ins.transEquipQuality(r);for(0==c&&(c=1),n.setTrait(c,d.QualityStruct.Ins.getQPicById(c));0<n.qualAni.numChildren;)(h=n.qualAni.removeChildAt(n.qualAni.numChildren-1))&&h.destroy();var u=d.QualityStruct.Ins.getQEffByEquip(i);0<u&&(h=g.UIEffectsFactory.Ins.createUIAniById(u,!0),g.UIEffectsFactory.Ins.centered4Parent(h,n.qualAni,!0),h.play())}},t.prototype.onEquipClickHandler=function(t){var e;this._playing||(this._nowSelectPos=t,this._selectedEquipItem&&this._selectedEquipItem.setSelect(!1),e=this["equip_"+ktgame.RoleDefineMod.arr_equipPosConst[t-1]],this._selectedEquipItem=e,this._selectedEquipItem&&this._selectedEquipItem.setSelect(!0),this.updateSelectedPosSkill(this._nowSelectPos),this.updateSelectedPosAttr(this._nowSelectPos),this.updateSelectedPosCost(this._nowSelectPos),this.updateSelectedPosLvBtn(this._nowSelectPos))},t.prototype.updateSelectedPosSkill=function(t){if(this._playing)this.waitPos=t;else{this.waitPos=0,this._skillMapArr||(this._skillMapArr=[]);var e=this._skillMapArr[t],i=!1;e||(1==t?e=new ui.lottery.Pages.fumo.FuMoItem1UI:2==t?e=new ui.lottery.Pages.fumo.FuMoItem2UI:3==t?e=new ui.lottery.Pages.fumo.FuMoItem3UI:4==t?e=new ui.lottery.Pages.fumo.FuMoItem4UI:5==t?e=new ui.lottery.Pages.fumo.FuMoItem5UI:6==t?e=new ui.lottery.Pages.fumo.FuMoItem6UI:7==t?e=new ui.lottery.Pages.fumo.FuMoItem7UI:8==t&&(e=new ui.lottery.Pages.fumo.FuMoItem8UI),this._skillMapArr[t]=e,i=!0),e&&(this.updateSkillMap(e,t),this._lastSkillMap!=e&&(this._lastSkillMap&&this.skillMapOut(this._lastSkillMap),this.skillMapIn(e,i),this._lastSkillMap=e))}},t.prototype.skillMapIn=function(t,e){var i=this;if(this._playing=!0,e)for(var n=0;n<12;n++)t["item"+n].visible=!1;t.pivot(this.box_skill.width/2,this.box_skill.height/2),t.x=this.box_skill.width/2,t.y=this.box_skill.height/2,t.scale(0,0),this.box_skill.addChild(t),y.BesselEffect.fly(t,new Laya.Point(t.x,t.y),t.x,0,500,new Laya.Handler(this,function(){e?(i.currPlayItemIndex=0,i.skillInitAni(t)):(i._playing=!1,0<i.waitPos&&i.updateSelectedPosSkill(i.waitPos))})),Laya.Tween.to(t,{scaleX:1,scaleY:1},500,Laya.Ease.cubicIn)},t.prototype.skillInitAni=function(t){var e=this;if(this.currPlayItemIndex<12){var i=t["item"+this.currPlayItemIndex];i.scale(3,3),i.visible=!0,this.currPlayItemIndex++,Laya.Tween.to(i,{scaleX:1,scaleY:1},200,Laya.Ease.cubicIn),Laya.timer.once(100,this,function(t){e.skillInitAni(t)},[t])}else this._playing=!1,0<this.waitPos&&this.updateSelectedPosSkill(this.waitPos)},t.prototype.skillMapOut=function(t){t.pivot(this.box_skill.width/2,this.box_skill.height/2),t.x=this.box_skill.width/2,t.y=this.box_skill.height/2,t.scale(1,1),y.BesselEffect.fly(t,new Laya.Point(t.x,t.x),-t.width/2,0,500,new Laya.Handler(this,function(){t.removeSelf()})),Laya.Tween.to(t,{scaleX:0,scaleY:0},500,Laya.Ease.cubicIn)},t.prototype.updateSelectedPosAttr=function(t){var e=this.getFuMoLv(t),i=0<e?Math.floor((e-1)/10):0,n=e%10;0<e&&0==n&&(n=10),this.lab_lv.changeText(c.TextConst.get(7,i)+c.TextConst.get(16,n));var s=p.ItemUtils.getFuMoVo(t,e);if(s)for(var o=s.prop.length,a=0;a<3;a++)if(a<o){var r,l="%"==(h=p.ItemUtils.getShuXingByName(s.prop[a][0])).unit?s.prop[a][1]/100:s.prop[a][1];r=h.desc+": "+l+h.unit,this["prop_now_"+a].color=h.color,this["prop_now_"+a].text=r,this["prop_now_"+a].visible=!0,this["tip_"+a].visible=!0}else this["tip_"+a].visible=!1,this["prop_now_"+a].visible=!1;if(s=p.ItemUtils.getFuMoVo(t,e+1)){this.box_next.visible=!0;for(o=s.prop.length,a=0;a<3;a++)if(a<o){var h;l="%"==(h=p.ItemUtils.getShuXingByName(s.prop[a][0])).unit?s.prop[a][1]/100:s.prop[a][1];this["prop_next_"+a].color=h.color,this["prop_next_"+a].text=""+l+h.unit,this["prop_next_"+a].visible=!0,this["tipImg_"+a].visible=!0}else this["tipImg_"+a].visible=!1,this["prop_next_"+a].visible=!1}else this.box_next.visible=!1},t.prototype.updateSelectedPosCost=function(t){0<this.listenItemId&&(v.NumE.ins.off(this.listenItemId+v.NumE.CHANGED,this,this.onItemChangedHandler),this.listenItemId=0);var e=this.getFuMoLv(t),i=p.ItemUtils.getFuMoVo(t,e);if(i)if(i.cost&&0<i.cost.length){var n=Number(i.cost[0][0]),s=i.cost[0][1],o=r.RoleCenter.instans.vo.bagdata.getItemCount(n),a=p.ItemUtils.getItemVoById(n);this.item_cost.visible=!0,this.item_cost.setNeedName(a.name,p.ItemUtils.getSmallIcon(a.icon)),this.item_cost.setQualColor(p.ItemUtils.getColorByQuality(a.quality)),this.item_cost.setNeed(o,s),this.item_cost.setJump(c.TextConst.get(238),new Laya.Handler(this,this.onShowGet)),this.listenItemId=n,v.NumE.ins.on(n+v.NumE.CHANGED,this,this.onItemChangedHandler)}else this.item_cost.visible=!1},t.prototype.onShowGet=function(){var t=this.listenItemId;if(0!=t){var e=p.ItemUtils.getItemVoById(t);(new m.ItemGetDlg).initByVo(e,null).popup()}},t.prototype.onItemChangedHandler=function(){this.displayedInStage&&this.updateSelectedPosCost(this._nowSelectPos)},t.prototype.updateSelectedPosLvBtn=function(t){this._btnAni&&(this._btnAni.visible=!1),this.lab_prompt.visible=!1;var e=this._hero.getPos(t-1);if(e){this.btn_up.label=0<e.fumoLv&&e.fumoLv%10==0?c.TextConst.get(236):c.TextConst.get(615);var i=!1,n=p.ItemUtils.getFuMoVo(t,e.fumoLv);if(n&&n.cost&&0<n.cost.length){if(e.equins&&e.equins.quality>=o.enumQuality.hong)if(5080<=p.ItemUtils.getEquipVoById(e.equins.equtemplet).limit){i=!0;var s=n.cost[0][0];n.cost[0][1]<=r.RoleCenter.instans.vo.bagdata.getItemCount(s)&&(this._btnAni||(this._btnAni=g.UIEffectsFactory.Ins.createUIAniById(40,!0),g.UIEffectsFactory.Ins.centered4Parent(this._btnAni,this.btn_up,!0)),this._btnAni.visible=!0)}this.lab_prompt.visible=!i}this.btn_up.disabled=!i}},t.prototype.doLevelUpHandler=function(){var t=this._hero.getPos(this._nowSelectPos-1);if(t){var e=p.ItemUtils.getFuMoVo(this._nowSelectPos,t.fumoLv);if(e&&e.cost&&0<e.cost.length)if(t.equins&&t.equins.quality>=o.enumQuality.hong)if(5080<=p.ItemUtils.getEquipVoById(t.equins.equtemplet).limit){var i=e.cost[0][0];if(e.cost[0][1]<=r.RoleCenter.instans.vo.bagdata.getItemCount(i)){var n=new s.EquipProChgMSG;n.msgidx=a.enumOpResultType.EquipProChg_fumo,n.heroidx=this._nowSelectHero,n.equpos=this._nowSelectPos,n.curLv=t.fumoLv,h.GSM.sendServer(n)}}}},t.prototype.onShowSuitAttr=function(){this._suitDlg||(this._suitDlg=new u.SuitAttrDlg);var t,e,i,n=this.getMinFumoStage(),s=[];for(var o in l.GameConfig.skillOpen)(t=l.GameConfig.skillOpen[o])&&10==t.type&&(i="<font color='"+(n<t.level?"#c0b4a3":"#2ba212")+"'>"+(e=p.ItemUtils.getSkillDefItem(t.skillId)).name+":"+e.desc+"</font>",s.push(i));this._suitDlg.array=s,this._suitDlg.isPopup||this._suitDlg.popup()},t.prototype.getMinFumoStage=function(){for(var t=9999999,e=this._hero.equpos.length,i=0;i<e;i++)t=Math.min(this._hero.equpos[i].fumoLv,t);return t=Math.floor((t-1)/10)},t.prototype.updateSkillMap=function(t,e){for(var i,n,s=this.getFuMoLv(e),o=0<s?Math.floor((s-1)/10):0,a=0;a<12;a++)i=10*(a+1)+1,n=l.GameConfig.skillOpen["11_"+(1e3*e+i)],1==a?this.fillSkillItemBig(t["item"+a],s<i?a+1:0,o,n.skillId,1):4==a?this.fillSkillItemBig(t["item"+a],s<i?a+1:0,o,n.skillId,2):7==a?this.fillSkillItemBig(t["item"+a],s<i?a+1:0,o,n.skillId,3):11==a?this.fillSkillItemBig(t["item"+a],s<i?a+1:0,o,n.skillId,4):this.fillSkillItemSml(t["item"+a],s<i?a+1:0,o,n.skillId)},t.prototype.fillSkillItemSml=function(t,e,i,n){if(t.img_bg.gray=0<e,t.lab_name.visible=0<e&&e-i==1,t.lab_name.changeText(c.TextConst.get(997,e)),t.img_bg.offAll(),t.img_bg.on(Laya.Event.CLICK,this,this.popSkillTip,[n,0==e]),0==e)g.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.sp_ani,4);else for(var s,o=t.sp_ani.numChildren-1;0<=o;)(s=t.sp_ani.removeChildAt(o))&&s.destroy(),o--},t.prototype.fillSkillItemBig=function(t,e,i,n,s){if(t.img_bg.skin="res/fumo/fomo_quan_00"+s+".png",0<e)t.img_icon.skin="res/fumo/fomo_suo.png";else{var o=p.ItemUtils.getSkillDefItem(n);t.img_icon.skin=p.ItemUtils.getSkillIconByIconId(o.icon)}if(t.lab_name.visible=0<e&&e-i==1,t.lab_name.changeText(c.TextConst.get(997,e)),t.img_icon.offAll(),t.img_icon.on(Laya.Event.CLICK,this,this.popSkillTip,[n,0==e]),t.sp_ani.removeChildren(),0==e)g.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.sp_ani,126+s);else for(var a,r=t.sp_ani.numChildren-1;0<=r;)(a=t.sp_ani.removeChildAt(r))&&a.destroy(),r--},t.prototype.popSkillTip=function(t,e){this._skillTip||(this._skillTip=new f.FuMoSkillTip),this._skillTip.initData(t,e),this._skillTip.isPopup||this._skillTip.popup()},t.prototype.getFuMoLv=function(t){var e=0,i=this._hero.getPos(t-1);return i&&(e=i.fumoLv),e},t.prototype.getRed=function(t){if(this._redCtrl){var e=this._redCtrl[this._nowSelectHero.toString()][t.toString()];if(e)return e.hasRed()}return!1},t}(ui.lottery.Pages.FuMoPageUI);e.FuMoPage=i}),define("src/g/lottery/ctrl/FuMoRedListenner",["require","exports","src/g/redhints/RedListenner","../../../manager/RoleCenter","../../../utils/ItemUtils","../../net/messages/sbkEquipIns","../../../core/NumE","../../../core/E","../../../enum/EventName","src/g/accessctrl/AccessCenter"],function(t,e,i,o,a,r,n,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(s){function t(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var n=s.call(this,t)||this;return n.costItemId=0,n.heroIdx=e[0],n.pos=e[1],n.checkRed(),n}return __extends(t,s),t.prototype.addEvent=function(){0<this.costItemId&&n.NumE.ins.on(this.costItemId+n.NumE.CHANGED,this,this.checkRed),l.E.ins.on(h.EventName.PUTNEWCHENGZHUANG,this,this.checkRed)},t.prototype.removeEvent=function(){0<this.costItemId&&(n.NumE.ins.off(this.costItemId+n.NumE.CHANGED,this,this.checkRed),this.costItemId=0),l.E.ins.off(h.EventName.PUTNEWCHENGZHUANG,this,this.checkRed),l.E.ins.off(h.EventName.OPENNEW_HERO,this,this.checkRed)},t.prototype.checkRed=function(){if(c.AccessCenter.ins.checkOpen(232)){this.removeEvent();var t=!1,e=o.RoleCenter.instans.vo.getOpenHeroByIdx(this.heroIdx);if(e){var i=e.getPos(this.pos-1);if(i){var n=a.ItemUtils.getFuMoVo(this.pos,i.fumoLv);if(n&&n.cost&&0<n.cost.length){if(i.equins&&i.equins.quality>=r.enumQuality.hong)if(5080<=a.ItemUtils.getEquipVoById(i.equins.equtemplet).limit){var s=Number(n.cost[0][0]);this.costItemId=s,n.cost[0][1]<=o.RoleCenter.instans.vo.bagdata.getItemCount(s)&&(t=!0)}this.addEvent()}}this.red=t}else l.E.ins.on(h.EventName.OPENNEW_HERO,this,this.checkRed)}},t}(i.RedListenner);e.FuMoRedListenner=s}),define("src/g/lottery/ctrl/FuMoPageCtrl",["require","exports","src/g/lottery/view/page/FuMoPage","src/g/clearRes/ClearResM","../../../manager/RoleCenter","../../../manager/GameSocketManager","../../net/messages/EquipProChgC2GS","../../../runtime/resload/GameResLoad","../../../plugin/sbkPropTool","../../../enum/EventName","src/g/redhints/RedListenner","src/g/lottery/ctrl/FuMoRedListenner","../../../manager/NewRedHintsCenter","../../../core/E"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(){function t(){this._nowSelectHero=0}return t.prototype.init=function(){this.initRed(),this._view||(r.GameResLoad.load("res/atlas/res/fumo.json"),this._view=new i.FuMoPage(this._fumoRed)),this.addEvent()},t.prototype.initRed=function(){var t;this._fumoRed=new c.RedListenner(1),this._fumoRed.bindRed(p.enumRedHints.fumo);for(var e=0,i=0;i<3;i++){var n;for(t=new c.RedListenner(i),e=1;e<9;)n=new u.FuMoRedListenner(e,i,e),t.addChild(n),e++;this._fumoRed.addChild(t)}},t.prototype.addEvent=function(){o.GSM.ins.on(a.EquipProChgMSG.KEY,this,this.onFuMoLvUpBack)},t.prototype.onFuMoLvUpBack=function(t){var e=s.RoleCenter.instans.vo.getOpenHeroByIdx(t.heroidx);e.getPos(t.equpos-1).fumoLv=t.curLv,this._nowSelectHero==t.heroidx&&this._view.displayedInStage&&this.refreshData();var i=s.RoleCenter.instans.vo.combat;l.sbkPropTool.reSetSkill(),l.sbkPropTool.resetFumo(e),s.RoleCenter.instans.vo.reCheckComBat(),s.RoleCenter.instans.event(h.EventName.FIGHT_UP,s.RoleCenter.instans.vo.combat-i),d.E.ins.event(h.EventName.FU_MO_LEVEL_UP,[t.heroidx,t.equpos])},t.prototype.showPage=function(t,e){this._view||(this.init(),this._view.refreshData(this._nowSelectHero)),t.removeChildren(),t.addChild(this._view),this._view.showPage(e),n.ClearResM.resetViewImg(this._view)},t.prototype.changePerson=function(t){this._nowSelectHero=t,this.refreshData()},t.prototype.refreshData=function(){this._view&&this._view.refreshData(this._nowSelectHero)},t.prototype.getTitle=function(){return"res/fumo/fomo_biaoti.png"},t.prototype.hidePage=function(){this._view&&this._view.onHidePage()},t.prototype.destroyPage=function(){this._view&&this._view.onHidePage()},t}();e.FuMoPageCtrl=g}),define("src/g/lottery/view/GLotteryView",["require","exports","src/g/clearRes/ClearResM","../../../manager/LayerManager","../../../enum/EventName","../../../core/E"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.bgView.btn_help.visible=!1,t.on(Laya.Event.REMOVED,t,t.onRemoved),t}return __extends(t,e),t.prototype.onRemoved=function(){},t.prototype.init=function(){return this},t.prototype.showView=function(t){void 0===t&&(t=!0),n.LayerManager.addInPOPWindowLayer(this,t),i.ClearResM.resetViewImg(this),o.E.ins.on(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){o.E.ins.off(s.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.hideView=function(){this.bgView.box_page.removeChildren(),this.removeSelf()},t.prototype.destroyView=function(){this.hideView()},t}(ui.lottery.LotteryViewUI);e.GLotteryView=a}),define("src/g/lottery/view/page/ShengShiPage",["require","exports","../../../../enum/EventName","src/g/lottery/Vo/ShengShiVo","../../../../enum/enumItem","../../../../manager/RoleCenter","../../../../manager/GameSocketManager","../../../net/messages/CompoundEquipC2GS","../../../../utils/ItemUtils","../../../net/messages/PropFightMain","../../../net/messages/sbkFormula","../../../../core/E","../../../../meta/ShuXingVo","../../../../utils/system/FloatEffect","src/g/Effects/UIEffectsFactory","../../../../plugin/view/ToolTip","src/g/clearRes/ClearResM","../../../../meta/QualiyVo","src/init/TextConst"],function(t,e,o,C,I,b,i,n,w,S,E,a,T,r,A,l,h,R,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(s){function t(){var t=s.call(this)||this;t._nowSelectHero=0,t._nowSelectPos=0,t._equPos=0,t.bag=b.RoleCenter.instans.vo.bagdata,t._datasrc=[],t._has=0,t._need=0,t.uvo=b.RoleCenter.instans.vo,t.hvo=t.uvo.getOpenHeroByIdx(t._nowSelectHero),a.E.ins.on(o.EventName.SHENGSHI_TEXIAO,t,t.ShengShiTX),t.ani_put=A.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.btn_up,42,1.6),t.btn_up.on(Laya.Event.CLICK,t,t.compoundEquip),t.item_cost.setJump(c.TextConst.get(617),new Laya.Handler(t,t.onGetItem)),t.ShengShiAni=A.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.item_cost.lab_jump,42,1.6,.9),t.on(Laya.Event.REMOVED,t,t.onRemoved);for(var e=0;e<4;e++){var i=t["item_"+e];i.on(Laya.Event.CLICK,t,t.ClickHandler,[i,e]),i.setTitle(parseInt(i.name),t.uvo.jobId);var n=C.ShengShiStruct.Ins.getShengShiVo(parseInt(i.name),0,0==e?t.hvo.jobid:0);i.setIcon(w.ItemUtils.getIconById(n.id)),t.ClickHandler(i,e)}return t._nowSelectPos=0,t}return __extends(t,s),t.prototype.onRemoved=function(){Laya.loader.clearRes(this.imgbg.skin,!0)},t.prototype.ShengShiTX=function(t){this.ShengShiAni.visible=1==t},t.prototype.onGetItem=function(){a.E.ins.event(o.EventName.OPENSHENGSHIRESOLVE)},t.prototype.compoundEquip=function(){if(this.checkCanCompound()){var t=new n.CompoundEquipC2GS;t.heroidx=this._nowSelectHero,t.equpos=this._equPos,t.equipCfgId=this._targetId,i.GSM.sendServer(t)}},t.prototype.checkCanCompound=function(){var t=this.hvo.getPos(this._equPos-1),e=w.ItemUtils.getEquipVoById(this._targetId);if(!e)return r.FE.upItems(c.TextConst.get(618),l.BubbleEnum.center),!1;var i=this.uvo.bagdata.getItemCount(parseInt(e.worth[0][0]+""));if(1e3*this.uvo.zhuanshengLv+this.uvo.lvl<e.limit)return r.FE.upItems(c.TextConst.get(619,e.limit/1e3>>0),l.BubbleEnum.center),!1;if(0==i)return r.FE.upItems(c.TextConst.get(620),l.BubbleEnum.center),!1;var n=0;if(t.equins.red){var s=w.ItemUtils.getEquipVoById(t.equins.equtemplet);n-=parseInt(s.worth[0][1]+"")}return i<(n+=parseInt(e.worth[0][1]+""))?(r.FE.upItems(c.TextConst.get(620),l.BubbleEnum.center),!1):n<=i},t.prototype.showBase=function(){for(var t=this._nowSelectPos,e=0;e<4;e++){var i=this["item_"+e];this.ClickHandler(i,e)}var n=this["item_"+t];this.ClickHandler(n,t)},t.prototype.refreshData=function(t,e){void 0===e&&(e=0),this._nowSelectHero=t,this.hvo=this.uvo.getOpenHeroByIdx(t),-1!=e&&(this._nowSelectPos=e),this.showBase(),this.showIcon(),this.imgbg.restskin(),h.ClearResM.addBgUrl(this.imgbg.skin),this._datasrc=[];for(var i=0;i<this.bag.equBagData.length;i++){var n=w.ItemUtils.getEquipVoById(this.bag.equBagData[i].equtemplet);n&&(n.quality==I.enumItem.red&&this._datasrc.push(this.bag.equBagData[i]))}0!=this._datasrc.length?this.ShengShiTX(!0):this.ShengShiTX(!1)},t.prototype.showAttr=function(t){this.hvo=this.uvo.getOpenHeroByIdx(this._nowSelectHero);var e,i,n,s=this.hvo.getPos(this._equPos-1),o=0,a=w.ItemUtils.getEquipVoById(s.equins.equtemplet),r=!1,l=0,h=t.qualAni.getChildByName("ani_22");if(a&&a.quality==I.enumItem.red)h||((h=A.UIEffectsFactory.Ins.createUIAniById(R.QualityStruct.Ins.getQEffById(6),!0)).name="ani_22",A.UIEffectsFactory.Ins.centered4Parent(h,t.qualAni,!0),h.play()),e=C.ShengShiStruct.Ins.getShengShiVo(this._equPos,a.limit,a.job),r=!(i=C.ShengShiStruct.Ins.getNextShengShiVo(this._equPos,a.limit,a.job));else if(!a||a.quality!=I.enumItem.red){h&&h.removeSelf();var c=s.equpos;e=C.ShengShiStruct.Ins.getShengShiVo(this._equPos,0,1==c?this.hvo.jobid:0)}a=w.ItemUtils.getEquipVoById(e.id);for(var u=w.ItemUtils.getLv(a.limit),p=new S.PropFightMain,d=0;d<4;d++)if(a.prop[d]){var g=Math.ceil(a.prop[d][1]*(a.max/100)),v=w.ItemUtils.getShuXingByName(a.prop[d][0]);this["lab_now_"+d].text=v.desc+":"+T.ShuXingVo.getString4Vo(a.prop[d][1]+g,v),p[a.prop[d][0]]=a.prop[d][1],this["lab_now_"+d].visible=!0}else this["lab_now_"+d].visible=!1;if(this.refreshAni(a),this._targetId=a.id,this.fen_value.value=E.sbkFormula.calPropFightMainCombat(p)+"",o=a.worth[0][1],l=a.limit,s.equins.red&&i){var f=w.ItemUtils.getEquipVoById(i.id),y=w.ItemUtils.getEquipVoById(s.equins.equtemplet);o=parseInt(f.worth[0][1]+"")-parseInt(y.worth[0][1]+""),l=f.limit}var m=w.ItemUtils.getItemVoById(a.worth[0][0]);this.item_cost.setNeedName(m.name,w.ItemUtils.getSmallIcon(m.icon)),this.item_cost.setQualColor(w.ItemUtils.getColorByQuality(m.quality)),n=this.uvo.bagdata.getItemCount(parseInt(a.worth[0][0]));var _=null;if(i){a=w.ItemUtils.getEquipVoById(i.id),_=w.ItemUtils.getLv(a.limit);for(d=0;d<4;d++)if(a.prop[d]&&0<a.prop[d].length)g=Math.ceil(a.prop[d][1]*(a.max/100)),v=w.ItemUtils.getShuXingByName(a.prop[d][0]),parseInt(T.ShuXingVo.getString4Vo(a.prop[d][1],v)),parseInt(T.ShuXingVo.getString4Vo(g,v));this._targetId=a.id;for(d=0;d<4;d++);}else for(d=0;d<4;d++);parseInt(u)>=b.RoleCenter.instans.vo.zhuanshengLv&&(this.ani_put.visible=!1),t.setlv(u,_),this.showNeed(n,r?0:o),!r&&parseInt(u)<=b.RoleCenter.instans.vo.zhuanshengLv&&0!=l?this.ani_put.visible=t.img_red.visible=o<=n&&l<=this.uvo.getCurLv():(this.ani_put.visible=!1,t.img_red.visible=!1)},t.prototype.ClickHandler=function(t,e){this._nowSelectPos=e;for(var i=0;i<4;i++)this["item_"+i].setSelect(i==this._nowSelectPos,this.title_icon);this._equPos=t.SelfPos,this.showAttr(t)},t.prototype.showIcon=function(){var t=this.item_0,e=C.ShengShiStruct.Ins.getShengShiVo(parseInt(t.name),0,this.hvo.jobid);t.setIcon(w.ItemUtils.getIconById(e.id)),t.setTitle(parseInt(t.name),this.hvo.jobid)},t.prototype.showNeed=function(t,e){this.item_cost.setNeed(t,e),this.item_cost.visible=!0;var i=w.ItemUtils.getEquipVoById(this.hvo.getPos(this._equPos-1).equins.equtemplet),n=!1;n=!(!i||i.quality!=I.enumItem.red),this.btn_up.label=n?c.TextConst.get(615):c.TextConst.get(616),this.btn_up.disabled=0==e,0==e&&(this.ani_put.visible=!1)},t.prototype.refreshAni=function(t){t&&-1!=t.name.indexOf("盛世")&&6==t.quality&&(this.p_heroData=b.RoleCenter.instans.vo.getOpenHeroByIdx(this._nowSelectHero),this.p_heroData&&(t.roleRes&&this.setAniSource(this.ani_role,t.roleRes,2),t.weaponRes&&this.setAniSource(this.ani_weapon,t.weaponRes,1)))},t.prototype.setAniSource=function(t,e,i){var n=w.ItemUtils.getAvtoarSource(e,i,this.p_heroData.sex);n&&(t.source&&(t.source=" "),t.loadAtlas(n))},t.prototype.hideView=function(){this.removeSelf()},t}(ui.lottery.Pages.ShengShiPageUI);e.ShengShiPage=s}),define("src/g/lottery/ctrl/ShengShiCtrl",["require","exports","../../../enum/EventName","src/g/lottery/view/page/ShengShiPage","../../../core/E","src/g/Effects/UIEffectsFactory","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this._nowSelectHero=0,this.addEvent()}return t.prototype.init=function(){return this._view||(this._view=new n.ShengShiPage),this.addEvent(),s.E.ins.on(i.EventName.CHANGEITEM_COUNT,this,this.onChangeItem),this},t.prototype.onChangeItem=function(t){190==t&&this._view&&this.refreshData()},t.prototype.showAni=function(t){if(this._view.displayedInStage)o.UIEffectsFactory.Ins.playAniOnce(t?11:68,this._view.ani_pos,t?1:1.3,t?1:1.3)},t.prototype.stopAni=function(){this._view&&this._view.ani_pos.removeChildren()},t.prototype.addEvent=function(){s.E.ins.on(i.EventName.CHANGEROLE_SHOW,this,this.onPutOver)},t.prototype.onPutOver=function(t){this._view&&this._view.displayedInStage&&this._view.showBase()},t.prototype.showPage=function(t){t.removeChildren(),t.addChild(this._view),a.ClearResM.resetViewImg(this._view)},t.prototype.changePerson=function(t){this._nowSelectHero=t,this.refreshData()},t.prototype.refreshData=function(){this._view.refreshData(this._nowSelectHero,-1)},t.prototype.getTitle=function(){return"res/lottery/xunbao_biaoti_wenzi3.png"},t.prototype.hidePage=function(){},t.prototype.destroyPage=function(){},t}();e.ShengShiCtrl=r}),define("src/g/lottery/view/SsResolveDlg",["require","exports","../../../manager/RoleCenter","../../../utils/ItemUtils","../../../enum/enumItem","../../net/messages/EquipSplitC2GS","../../../manager/GameSocketManager","src/g/itemGets/View/ItemGet_TipItem","../../../core/E","../../../enum/EventName","src/init/TextConst"],function(t,e,i,a,n,s,o,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t.bag=i.RoleCenter.instans.vo.bagdata,t._datasrc=[],t.addEvent(),t}return __extends(t,e),t.prototype.refreshData=function(){this.addGetGo(),this._datasrc=[];for(var t=0;t<this.bag.equBagData.length;t++){var e=a.ItemUtils.getEquipVoById(this.bag.equBagData[t].equtemplet);e&&(e.quality==n.enumItem.red&&this._datasrc.push(this.bag.equBagData[t]))}this.list_.dataSource=this._datasrc,0!=this._datasrc.length?l.E.ins.event(h.EventName.SHENGSHI_TEXIAO,!0):l.E.ins.event(h.EventName.SHENGSHI_TEXIAO,!1)},t.prototype.addGetGo=function(){this.vbox.removeChildren();for(var t=a.ItemUtils.getItemVoById(190),e=2;e<t.link.length;e++){var i=(new r.ItemGet_TipItem).init(t.link[e][0],t.link[e][1]);this.vbox.addChild(i),this.vbox.height+=i.height}},t.prototype.onRender=function(t,e){var i=t.dataSource,n=a.ItemUtils.getEquipVoById(i.equtemplet),s=a.ItemUtils.getItemVoById(parseInt(n.worth[0][0]));t.setQualityBg(a.ItemUtils.getQualityBjById(n.id)),t.html_text.style.fontSize=18,t.html_text.innerHTML=c.TextConst.get(857,a.ItemUtils.getColorByQuality(n.quality),n.name),t.setLv(a.ItemUtils.getEquipLv(n.limit)),t.setIcon(a.ItemUtils.getIconById(n.id)),t.setJob(n.job),t.setGet(s.name+"x"+n.worth[0][1]),t.lab_canGet.color=a.ItemUtils.getColorByQuality(n.quality);var o=new Laya.Handler(this,this.SplitHandler);t.setResolveHandler(o)},t.prototype.SplitHandler=function(t){var e=new s.EquipSplitC2GS;e.splittype=s.ESplitType.RedEquip,e.equipidarr.push(t.equid),o.GSM.sendServer(e)},t.prototype.addEvent=function(){this.list_.renderHandler=new Laya.Handler(this,this.onRender)},t}(ui.lottery.resolveSSDLgUI);e.SsResolveDlg=u}),define("src/g/lottery/ctrl/SsResolveDlgCtrl",["require","exports","src/g/lottery/view/SsResolveDlg","../../../core/E","../../../enum/EventName"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){this.init()}return t.prototype.init=function(){this._view||(this._view=new i.SsResolveDlg,this._view.bg.btn_back.visible=this._view.bg.btn_close.visible=!1,this._view.bg.imgInnerBg.bottom=14),this.addEvent()},t.prototype.addEvent=function(){n.E.ins.on(s.EventName.OPENSHENGSHIRESOLVE,this,this.onResolveChengZhuang),n.E.ins.on(s.EventName.EQUIPSPLITOVER,this,this.onEquipSplit),n.E.ins.on(s.EventName.OPENMODULEJUMP,this,this.onClose),this._view.btn_back.on(Laya.Event.CLICK,this,this.onClose),this._view.btn_close.on(Laya.Event.CLICK,this,this.onClose)},t.prototype.onEquipSplit=function(t){this._view.displayedInStage&&this._view.refreshData()},t.prototype.onResolveChengZhuang=function(){this._view.refreshData(),this._view.popup()},t.prototype.onClose=function(){this._view.close()},t}();e.SsResolveDlgCtrl=o}),define("src/g/lottery/view/SyTips_suit",["require","exports","../../../config/GameConfig"],function(t,e,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(t){for(var e=1;e<=2;e++){var i=t["suitLv_"+e];0==i&&(i=1);var n=h.GameConfig.getSyTzVo(e,i),s=this["tzInfo"+(e-1)];s.getChildByName("tzName").text=n.name;for(var o=n.pos,a=0;a<o.length;a++){var r=h.GameConfig.getSyLvVo(o[a],t.lvArr[o[a]-1]),l=s.getChildByName("part"+a);l.color=r?"#349320":"#a89e8f",l.text=r?r.name+" LV "+r.level:(r=h.GameConfig.getSyLvVo(o[a],1)).name+" LV 0"}}},e}(ui.lottery.SyTips_suitUI);e.SyTips_suit=i}),define("src/g/lottery/view/page/ShenyuPage",["require","exports","../../../../manager/RoleCenter","../../../../meta/ShuXingVo","../../../../utils/ItemUtils","src/g/Effects/UIEffectsFactory","../../../../config/GameConfig","../../../net/messages/sbkShenYuData","../../../../manager/GameSocketManager","../../../net/messages/sbkFormula","../../../net/messages/PropFightMain","../../../../plugin/sbkPropTool","src/g/lottery/view/SyTips_suit","src/g/itemGets/View/ItemGetDlg","src/init/TextConst","src/g/lottery/view/ShenyuSkillDlg"],function(t,e,h,c,f,b,w,i,n,u,a,p,s,r,S,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(o){function t(){var t=o.call(this)||this;t.fight=new a.PropFightMain;for(var e=t.equip,i=e.numChildren,n=0;n<i;n++)e.getChildAt(n).on(Laya.Event.CLICK,t,t.select);t.active.on(Laya.Event.CLICK,t,t.upLvHandler);var s=t.selectPanel.hScrollBar;return s.on(Laya.Event.CHANGE,t,t.changeBar),s.elasticDistance=50,t.btn_turn_left.on(Laya.Event.CLICK,t,t.leftClick),t.btn_turn_right.on(Laya.Event.CLICK,t,t.rightClick),t.lab_jump.on(Laya.Event.CLICK,t,t.jumpClick),t.jn1.on(Laya.Event.CLICK,t,t.jnClick),t.jn2.on(Laya.Event.CLICK,t,t.jnClick),t.tzBtn.on(Laya.Event.CLICK,t,t.tzInfoShow),t.ani=b.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(t.active,40),t.selectPage(0),t.checkRed(),t}return __extends(t,o),t.prototype.jumpClick=function(){var t=this.currIndex,e=this.data.lvArr[t];0==e&&(e=1);var i=w.GameConfig.getSyLvVo(t+1,e);r.ItemGetDlg.create(i.upcost[0][0])},t.prototype.tzInfoShow=function(t){var e=new s.SyTips_suit;e.setData(this.data),e.popup()},t.prototype.jnClick=function(t){var e=t.currentTarget,i=this.currIndex,n=this.data.lvArr[i],s=w.GameConfig.getSyLvVo(i+1,n),o=w.GameConfig.getSyLvVo(i+1,n+1),a=s?w.GameConfig.getSyTzVo(s.suit,this.data["suitLv_"+s.suit]):null,r=!0;if(!a){r=!1;var l=this.data["suitLv_"+(o?o.suit:s.suit)];0==l&&(l=1),a=w.GameConfig.getSyTzVo(o?o.suit:s.suit,l)}var h,c=a.skill_id,u=new y.ShenyuSkillDlg;h=this.jn1==e?f.ItemUtils.getSkillDefItem(c[0]):f.ItemUtils.getSkillDefItem(c[1]),u.lab_open.text=""+(r?S.TextConst.get(524):S.TextConst.get(485));for(var p=h.desc.replace("{rate}",h.rate/100+""),d=h.effect,g=0;g<d.length;g++){var v=d[g];p=p.replace("{"+v[0]+"}",v[1]/100+"")}u.lab_desc.innerHTML=p,u.setIcon(h),u.popup()},t.prototype.checkRed=function(){this.img_left_red.visible=!1,this.img_right_red.visible=!1;var t=this.selectPanel.hScrollBar,e=t.value,i=t.max,n=t.min;if(e!=i||e!=n)for(var s=this.equip,o=0;o<s.numChildren;o++){var a=s.getChildAt(o).getChildAt(4);(a||a&&a._red)&&(s.x+a.x+a.width<=e?this.btn_turn_left.visible&&(this.img_left_red.visible=!0):s.x>=e+this.selectPanel.width&&this.btn_turn_right.visible&&(this.img_right_red.visible=!0))}},t.prototype.leftClick=function(){var t=this.selectPanel.hScrollBar,e=t.value,i=t.min;(e-=90)<i&&(e=i),t.value=e,this.checkRed()},t.prototype.rightClick=function(){var t=this.selectPanel.hScrollBar,e=t.value,i=t.max;i<(e+=90)&&(e=i),t.value=e,this.checkRed()},t.prototype.changeBar=function(){var t=this.selectPanel.hScrollBar,e=!0,i=!0;t.value==t.max?i=!1:t.value==t.min&&(e=!1),this.btn_turn_left.visible=e,this.btn_turn_right.visible=i},t.prototype.upLvHandler=function(t){var e=new i.ShenYuUpGradeMsg;e.heroidx=this._nowSelectHero,e.type=this.currIndex+1,e.curLv=this.data.lvArr[this.currIndex],n.GSM.sendServer(e)},t.prototype.select=function(t){this.selectPage(this.equip.getChildIndex(t.currentTarget))},t.prototype.selectPage=function(t){this.currIndex=t;var e=this.data;if(e){for(var i,n=e.lvArr,s=this.equip,o=s.numChildren,a=b.UIEffectsFactory.Ins,r=0;r<o;r++){(i=s.getChildAt(r)).getChildAt(2).visible=!1;var l=i.getChildAt(1);a.createCenterSAniAndMonopolize(l,89,1,1,"shenyuAni");var h=!1,c=!1;0==n[r]?c=!0:h=!0,l.visible=h,i.getChildAt(0).disabled=c,i.getChildAt(2).disabled=c,i.getChildAt(3).disabled=c,i.mouseEnabled=!0}(i=s.getChildAt(t)).getChildAt(2).visible=!0,this.syName.skin="res/shenyu/n"+(t+1)+".png";var u=n[t],p=w.GameConfig.getSyLvVo(t+1,u),d=w.GameConfig.getSyLvVo(t+1,u+1),g="",v=!1,f=p?e["suitLv_"+p.suit]:0,y=w.GameConfig.getSyTzVo(p?p.suit:d.suit,0==f?1:f);0==f?v=!0:g="LV "+y.level,this.upJninfo(y),this.jn1.disabled=v,this.jn2.disabled=v,this.jn1.mouseEnabled=this.jn2.mouseEnabled=!0,this.jnl1.text=g,this.jnl2.text=g;var m=this.active;m.disabled=!1;var _=this.box_cost;d?this.updProp(d):this.updProp(p);var C=this.font_lv;p?(C.value=p.level+"",d?(_.visible=!0,m.label=S.TextConst.get(615)):(_.visible=!1,m.label=S.TextConst.get(208),m.disabled=!0,this.ani.visible=!1)):(m.label=S.TextConst.get(237),_.visible=!0),C.visible=!!p;var I=this.aniSp;for(r=0;r<I.numChildren;r++){I.getChildAt(r).visible=!1}a.createCenterSAniAndMonopolize(I,200+t+1,1,1,"ani"+t).visible=!0}},t.prototype.upJninfo=function(t){var e=t.skill_id,i=f.ItemUtils.getSkillDefItem(e[0]),n=f.ItemUtils.getSkillDefItem(e[1]);this.jn1.skin=f.ItemUtils.getSkillIconByIconId(i.icon),this.jn2.skin=f.ItemUtils.getSkillIconByIconId(n.icon)},t.prototype.updProp=function(t){for(var e=t.prop,i=0;i<e.length;i++){var n=e[i],s=f.ItemUtils.getShuXingByName(n[0]);this.getChildByName("lab_"+i).text=s.desc+":"+c.ShuXingVo.getString4Vo(n[1],s)}var o=this.fight;o.reset(),p.sbkPropTool.reSetProp(o,t.prop),this.box_fight.setFightNum(t.power+u.sbkFormula.calPropFightMainCombat(o));var a=t.upcost[0][0],r=h.RoleCenter.instans.vo.bagdata.getItemCount(a),l=t.upcost[0][1];this.img_icon.skin=f.ItemUtils.getSmallIcon(a),this.lab_need.text=r+"/"+l,this.lab_need.color=l<=r?"#c0b4a3":"#ff0f15",this.ani.visible=l<=r},t.prototype.refreshData=function(t){void 0===t&&(t=0),this._nowSelectHero=t,this.data=h.RoleCenter.instans.self.openhero[t].syData,this.selectPage(this.currIndex)},t}(ui.lottery.Pages.ShenyuPageUI);e.ShenyuPage=o}),define("src/g/lottery/ctrl/ShenyuCtrl",["require","exports","src/g/clearRes/ClearResM","src/init/ResManager","src/g/base/BaseCtrl","../../../manager/GameSocketManager","src/g/lottery/view/page/ShenyuPage","../../net/messages/sbkShenYuData","../../../manager/RoleCenter","../../../plugin/sbkPropTool","../../../config/GameConfig","../../../enum/EventName","../../../vo/RedDot/lottery/RedDot_Shenyu","../../../vo/RedDot/EventRedDot","../../../core/E","src/g/Effects/UIEffectsFactory"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(e){function t(){var t=e.call(this)||this;return t.url="res/atlas/res/shenyu.json",t}return __extends(t,e),t.prototype.init=function(){return this.$view||(this.$view=new a.ShenyuPage,i.ClearResM.addBgUrl(this.$view.bg.skin),o.GSM.ins.on(r.ShenYuUpGradeMsg.KEY,this,this.receiveMsg),o.GSM.ins.on(r.ShenYuSuitUpGradeGS2C.KEY,this,this.receiveMsg),g.E.ins.on(u.EventName.CHANGEITEM_COUNT,this,this.onChangeItem)),this},t.prototype.onChangeItem=function(t){var e=p.RedDot_Shenyu.Ins.needIds;if(e&&-1!=e.indexOf(t)){var i=this.$view;i&&i.checkRed()}},t.prototype.receiveMsg=function(t){var e=l.RoleCenter.instans.self.openhero[this._nowSelectHero||0].syData;switch(t.msgKey){case r.ShenYuUpGradeMsg.KEY:var i=t.curLv,n=this.$view,s=void 0;s=i-1==0?38:11,v.UIEffectsFactory.Ins.playAniOnce(s,n),e.lvArr[t.type-1]=i;var o=c.GameConfig.getSyLvVo(t.type,i).upcost[0];l.RoleCenter.instans.vo.chgItemCount(+o[0],-o[1]),this.refreshData();var a=l.RoleCenter.instans.vo.combat;h.sbkPropTool.resetJsShenyu(),l.RoleCenter.instans.event(u.EventName.FIGHT_UP,l.RoleCenter.instans.vo.reCheckComBat()-a),g.E.ins.event(d.EventRedDot.REFRESH_LOTTERY);break;case r.ShenYuSuitUpGradeGS2C.KEY:e.suitLv_1=t.suitLv_1,e.suitLv_2=t.suitLv_2,this.refreshData()}},t.prototype.showPage=function(t,e){this.parent=t,this.open()},t.prototype.onAtlasLoaded=function(){var t=this.parent;t.removeChildren();var e=this.init().$view;t.addChild(e),i.ClearResM.resetViewImg(e),i.ClearResM.resetViewImg(t.parent.img_title),n.ResManager.getInstance().showRolePageCtrl(this),this.changePerson(this._nowSelectHero)},t.prototype.changePerson=function(t,e){this._nowSelectHero=t,p.RedDot_Shenyu.Ins.checkIdxHero(t),this.refreshData()},t.prototype.refreshData=function(){this.$view&&this.$view.refreshData(this._nowSelectHero)},t.prototype.getTitle=function(){return"res/shenyu/biaoti.png"},t.prototype.hidePage=function(){n.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){n.ResManager.getInstance().destroyPageCtrl(this)},t.prototype.destroyRes=function(){this.clearCtrlRes();for(var t=201;t<=208;t++)i.ClearResM.clearUrl(v.UIEffectsFactory.Ins.getSourceUrlById(t))},t}(s.BaseCtrl);e.ShenyuCtrl=f}),define("src/g/lottery/ctrl/GLotteryCtrl",["require","exports","../../../utils/ItemUtils","../../../manager/RoleCenter","../../../enum/EventName","../../../core/E","src/g/lottery/ctrl/ChengZhuangCtrl","src/g/lottery/view/GLotteryView","src/g/lottery/ctrl/CzResolveDlgCtrl","src/g/lottery/ctrl/ShengShiCtrl","src/g/lottery/ctrl/SsResolveDlgCtrl","../../../plugin/sbkPropTool","../../../vo/RedDot/lottery/RedDot_ChengZhuang","../../../vo/RedDot/EventRedDot","../../../vo/RedDot/role/RedDot_Equip","../../../vo/RedDot/lottery/RedDot_ShengShi","../../../vo/RedDot/lottery/RedDot_Shenyu","src/init/Switches","src/g/proxy/MultiLevelUIProxy","src/g/lottery/ctrl/ShenyuCtrl","src/g/lottery/ctrl/FuMoPageCtrl"],function(t,e,a,r,l,h,i,n,s,o,c,u,p,d,g,v,f,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var I=function(){function t(){this._nowSelectHero=0,y.Switches.ins.on(55,this,this.onOpenHandler,[55]),y.Switches.ins.on(56,this,this.onOpenHandler,[56]),y.Switches.ins.on(207,this,this.onOpenHandler,[207]),y.Switches.ins.on(232,this,this.onOpenHandler,[232]),h.E.ins.on(l.EventName.CHANGEITEM_COUNT,this,this.onItemChange),h.E.ins.on(d.EventRedDot.REFRESH_LOTTERY,this,this.refreshData),h.E.ins.on(l.EventName.ADDED_ZHUANSHENG,this,this.onZhuanSheng)}return t.prototype.onOpenHandler=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=0),e&&this.openHandler(t,i,n)},t.prototype.init=function(){this._view=(new n.GLotteryView).init(),this._tabProxy=new m.MultiLevelUIProxy,this._tabProxy.registerTab(this._view.tab_pageBtn,0),this._tabProxy.registerTagIndex(55,0),this._tabProxy.registerTagIndex(56,2),this._tabProxy.registerTagIndex(207,3),this._tabProxy.registerTagIndex(232,1),this._tabProxy.selectHandler=new Laya.Handler(this,this.tab_selectHandler),this._chengZhuang=(new i.ChengZhuangPageCtrl).init(),this._shengshi=(new o.ShengShiCtrl).init(),this._shenyu=new _.ShenyuCtrl,this._fumo=new C.FuMoPageCtrl,this._fumo.init(),new s.CzResolveDlgCtrl,new c.SsResolveDlgCtrl,this.refreshHeroHeadShow(),this.addEvent(),h.E.ins.on(l.EventName.LOTTERY_STATE_CHANGED,this,this.refreshLotteryRed)},t.prototype.refreshLotteryRed=function(){h.E.ins.event(d.EventRedDot.REFRESH_LOTTERY)},t.prototype.onZhuanSheng=function(){v.RedDot_ShengShi.Ins.reCheckShengShi(),h.E.ins.event(d.EventRedDot.REFRESH_LOTTERY)},t.prototype.addEvent=function(){this._view.bgView.btn_close.on(Laya.Event.CLICK,this,this.closeLotteryView),this._view.bgView.btn_back.on(Laya.Event.CLICK,this,this.closeLotteryView),this._view.tab_head.setCallbackHandler(new Laya.Handler(this,this.HeroSelect)),h.E.ins.on(l.EventName.PUTCZORSSEQUIP,this,this.onPutNew),h.E.ins.on(l.EventName.EQUIPSPLITOVER,this,this.refreshHeroHeadShow),h.E.ins.on(l.EventName.OPENNEW_HERO,this,this.refreshHeroHeadShow),r.RoleCenter.instans.vo.heronum<3&&(h.E.ins.on(l.EventName.ADDED_LEVEL,this,this.refreshHeroHeadShow),h.E.ins.on(l.EventName.ADDED_ZHUANSHENG,this,this.refreshHeroHeadShow),h.E.ins.on(l.EventName.VIP_EXP_CHANGED,this,this.refreshHeroHeadShow))},t.prototype.onItemChange=function(t){104==t||190==t?(h.E.ins.event(d.EventRedDot.REFRESH_EQUIP),h.E.ins.event(d.EventRedDot.REFRESH_ROLE),h.E.ins.event(d.EventRedDot.REFRESH_LOTTERY)):1011<=t&&t<=1018&&h.E.ins.event(d.EventRedDot.REFRESH_LOTTERY)},t.prototype.refreshData=function(){this.refreshHeroHeadShow()},t.prototype.onPutNew=function(t){var e=r.RoleCenter.instans.vo,i=e.getOpenHeroByIdx(t.heroidx);i.getPos(t.equpos-1).equins=t.arr[0],t.arr[1]&&e.addEquipIns(t.arr[1]);var n=a.ItemUtils.getEquipVoById(t.arr[0].equtemplet),s=parseInt(n.worth[0][0]);u.sbkPropTool.reSetAllEquip(i);var o=e.combat;e.reCheckComBat(),r.RoleCenter.instans.event(l.EventName.FIGHT_UP,e.combat-o),e.chgItemCount(s,0-t.constItemNum),t.arr[0].red?(v.RedDot_ShengShi.Ins.reCheckCanReslove(),v.RedDot_ShengShi.Ins.reCheckShengShi(),this._shengshi.showAni(t.arr[1])):t.arr[0].chengzhuang&&(p.RedDot_ChengZhuang.Ins.recheckChengZhuang(),p.RedDot_ChengZhuang.Ins.reCheckCanReslove(),this._chengZhuang.showAni(t.arr[1])),g.RedDot_Equip.Ins.checkEquip(),h.E.ins.event(l.EventName.CHANGEROLE_SHOW),h.E.ins.event(d.EventRedDot.REFRESH_EQUIP),h.E.ins.event(d.EventRedDot.REFRESH_ROLE),h.E.ins.event(l.EventName.PUTNEWCHENGZHUANG)},t.prototype.openHandler=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=0),this.pidx=t,this._nowShero=i,this._closeOther=e,this.onAtlasLoaded()},t.prototype.onAtlasLoaded=function(){this.realOpen(this.pidx,this._nowShero)},t.prototype.realOpen=function(t,e){switch(void 0===t&&(t=0),void 0===e&&(e=0),this._nowSelectHero="number"==typeof e?e:0,this._view||this.init(),t){case 55:this._view.tab_head.refreshHeadRedHint(p.RedDot_ChengZhuang.Ins.getChengZhuang(!0)),this._chengZhuang.showPage(this._view.bgView.box_page),this._chengZhuang.changePerson(this._nowSelectHero);break;case 56:this._view.tab_head.refreshHeadRedHint(v.RedDot_ShengShi.Ins.getRed(!0)),this._shengshi.showPage(this._view.bgView.box_page),this._shengshi.changePerson(this._nowSelectHero);break;case 207:this._view.tab_head.refreshHeadRedHint(f.RedDot_Shenyu.Ins.getRed(!0)),this._shenyu.showPage(this._view.bgView.box_page),this._shenyu.changePerson(this._nowSelectHero);break;case 232:this._fumo.showPage(this._view.bgView.box_page,this._view.tab_head),this._fumo.changePerson(this._nowSelectHero)}this._tabProxy.open(t),this._view.tab_head.setSelectIndex(e),this._view.displayedInStage||this._view.showView(this._closeOther),this.refreshHeroHeadShow()},t.prototype.tab_selectHandler=function(t){switch(void 0===t&&(t=0),this._view.tab_head.visible=!0,t){case 0:this._chengZhuang.changePerson(this._nowSelectHero),this._page=this._chengZhuang;break;case 2:this._shengshi.changePerson(this._nowSelectHero),this._page=this._shengshi;break;case 3:this._shenyu.changePerson(this._nowSelectHero),this._page=this._shenyu;break;case 1:this._fumo.changePerson(this._nowSelectHero),this._page=this._fumo}this.refreshHeroHeadShow(),this._page.showPage(this._view.bgView.box_page,this._view.tab_head),this._view.bgView.img_title.skin=this._page.getTitle()},t.prototype.HeroSelect=function(t,e){r.RoleCenter.instans.self.openhero[t]?(this._nowSelectHero=t,this._view.tab_head.setSelectIndex(t),this._chengZhuang.changePerson(t),this._shengshi.changePerson(t),this._shenyu.changePerson(t),this._fumo.changePerson(t),this.refreshHeroHeadShow()):y.Switches.ins.event(15)},t.prototype.refreshHeroHeadShow=function(t){if(void 0===t&&(t=0),null!=this._view){var e=this._nowSelectHero;switch(this._view.tab_head.initData(r.RoleCenter.instans.self.openhero,e,r.RoleCenter.instans.vo),this._view.tab_pageBtn.selectedIndex){case 0:this._view.tab_head.refreshHeadRedHint(p.RedDot_ChengZhuang.Ins.getChengZhuang(!0)),this._chengZhuang.changePerson(e);break;case 2:this._view.tab_head.refreshHeadRedHint(v.RedDot_ShengShi.Ins.getRed(!0)),this._shengshi.changePerson(e);break;case 3:this._view.tab_head.refreshHeadRedHint(f.RedDot_Shenyu.Ins.getRed(!0)),this._shenyu.changePerson(e)}}},t.prototype.closeLotteryView=function(){this._chengZhuang.stopAni(),this._shengshi.stopAni(),this._shenyu.destroyRes(),1==this._view.tab_pageBtn.selectedIndex&&h.E.ins.event(l.EventName.CLOSEVIEW_CHENGZHANG),this._view.hideView()},t}();e.GLotteryCtrl=I}),define("src/g/lottery/view/LotteryAwardDlg",["require","exports","src/g/bag/vo/BagDataVo","../../../utils/ItemUtils","../../../config/GameConfig","src/init/TextConst"],function(t,e,h,c,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t._isFlying=!1,t.btn_enter.on(Laya.Event.CLICK,t,t.onCloseHandler),t.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.list_.renderHandler=new Laya.Handler(t,t.onListRender),t.list_.scrollBar.elasticDistance=200,t.listP=new Laya.Point,t.listP.x=t.list_.x,t.listP.y=t.list_.y,t}return __extends(t,e),t.prototype.onListRender=function(t,e){var i=t.dataSource,n=i.id,s=i.num;i.equVo?(t.lab_lv.text=c.ItemUtils.getEquipLv(i.equVo.limit),t.item0.img_occupation.skin=c.ItemUtils.getOccupationIconById(n),t.item0.img_occupation.visible=!0):i.ItmVo&&(t.lab_lv.text=i.ItmVo.name,t.item0.img_occupation.visible=!1),t.lab_lv.color=c.ItemUtils.getQualityColorById(n),t.item0.item.img_quality.skin=c.ItemUtils.getQualityBjById(n),t.item0.item.img_item.skin=c.ItemUtils.getIconById(n);var o=t.item0.item.lab_num;o.visible=1<s&&(o.text=s+"",!0)},t.prototype.showChange=function(t){i.GameConfig.lotterySettingJSON[1];this.desc.text=t?n.TextConst.get(611):n.TextConst.get(612),this.btn_buy.label=t?n.TextConst.get(613,10):n.TextConst.get(613,1),this.layer_one.visible=!t,this.layer_ten.visible=t},t.prototype.showBase=function(t){this.arr_item=[];for(var e=t.idArr.length,i=0;i<e;){var n=t.idArr[i],s=t.equipIdArr.indexOf(n);if(-1!=s){var o=c.ItemUtils.getEquipVoById(t.equipObj[s].equtemplet);if(!o||!o.id){i++;continue}(l=new h.BagDataVo).equid=n,l.id=o.id,l.num=1,l.equVo=o,this.arr_item.push(l)}else{var a=c.ItemUtils.getItemVoById(n);if(!a||!a.id){i++;continue}for(var r=0;r<t.numArr[i];r++){var l;(l=new h.BagDataVo).id=a.id,l.num=1,l.ItmVo=a,this.arr_item.push(l)}}i++}this.list_.dataSource=this.arr_item,0<e&&this.fly()},Object.defineProperty(t.prototype,"isFlying",{get:function(){return this._isFlying},enumerable:!0,configurable:!0}),t.prototype.fly=function(){var t=this;this._isFlying=!0,this.list_.scale(0,0),this.list_.pos(this.x+this.width/2,this.y+this.height-280),Laya.Tween.to(this.list_,{scaleX:1,scaleY:1,x:this.listP.x,y:this.listP.y},400,null,Laya.Handler.create(this,function(){t._isFlying=!1}))},t.prototype.onCloseHandler=function(){this.close()},t}(ui.lottery.LotteryAwardDlgUI);e.LotterAwardDlg=s}),define("src/g/lottery/view/LotteryBuyAlert",["require","exports","../../../manager/StateManger"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.txt_txt.style.color="#c0b4a3",this.txt_txt.style.fontFamily="SimHei",this.txt_txt.style.fontSize=24,this.txt_txt.style.valign="middle",this.txt_txt.style.align="center",this.btn_close.on(Laya.Event.CLICK,this,this.onCloseHandler),this.btn_cancel.on(Laya.Event.CLICK,this,this.onCancelHandler),this.btn_ok.on(Laya.Event.CLICK,this,this.onEnterHandler),this.check_no_alert.on(Laya.Event.CLICK,this,this.onCheckSelectHandler)},e.prototype.showAlert=function(t,e){this._okHandler=e,this.check_select.visible=!1,this.txt_txt.innerHTML=t,this.popup()},e.prototype.onCheckSelectHandler=function(){this.check_select.visible=!this.check_select.visible},e.prototype.onEnterHandler=function(){this._okHandler&&this._okHandler.run(),i.StateManger.showLotteryBuyAlert=!this.check_select.visible,this.onCloseHandler()},e.prototype.onCancelHandler=function(){i.StateManger.showLotteryBuyAlert=!this.check_select.visible,this.onCloseHandler()},e.prototype.onCloseHandler=function(){this.close()},e}(ui.alert.AlertViewDlgUI);e.LotteryBuyAlert=n}),define("src/g/lottery/ctrl/LotteryAwardCtrl",["require","exports","src/g/lottery/view/LotteryAwardDlg","../../net/messages/sbkLotteryBagData","../../../manager/RoleCenter","../../net/messages/sbkLotteryC2GS","../../net/messages/OpResultType","../../../manager/GameSocketManager","../../../config/GameConfig","../../../enum/EventName","../../../manager/StateManger","src/g/lottery/view/LotteryBuyAlert","src/init/Switches","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(){function t(){this.isBuyTen=!1,this.init()}return t.prototype.init=function(){this._view||(this._view=new i.LotterAwardDlg),this.addEvent()},t.prototype.addEvent=function(){this._view.btn_buy.on(Laya.Event.CLICK,this,this.doBuyHandler)},t.prototype.doBuyHandler=function(){this._view.isFlying||(this.isBuyTen?this.onBuyTenClickHandler():this.onBuyOneClickHandler())},t.prototype.showView=function(t,e){this.isBuyTen=e,this._view.showBase(t),this._view.showChange(t.type==n.enumLotteryBagDataType.lottery_10_GOLD||t.type==n.enumLotteryBagDataType.lottery_10_coin),this._view.popup()},t.prototype.onBuyOneHandler=function(){var t=l.GameConfig.lotterySettingJSON[1],e=t.cost1[0][1];if(s.RoleCenter.instans.vo.bagdata.getItemCount(t.lottery)||s.RoleCenter.instans.self.GOLD>=e){var i=new o.sbkLotteryC2GS;i.msgidx=a.enumOpResultType.lottery_buy1,i.lotteryId=t.lotteryId,r.GSM.sendServer(i)}},t.prototype.onBuyOneClickHandler=function(){var t=l.GameConfig.lotterySettingJSON[1];if(c.StateManger.showLotteryBuyAlert&&s.RoleCenter.instans.vo.bagdata.getItemCount(t.lottery)<1){this._buyAlert||(this._buyAlert=new u.LotteryBuyAlert);var e=t.cost1[0][1];this._buyAlert.showAlert(d.TextConst.get(609,e,1),Laya.Handler.create(this,this.onBuyOneHandler))}else this.onBuyOneHandler()},t.prototype.onBuyTenClickHandler=function(){var t=l.GameConfig.lotterySettingJSON[1];if(c.StateManger.showLotteryBuyAlert&&s.RoleCenter.instans.vo.bagdata.getItemCount(t.lottery)<10){this._buyAlert||(this._buyAlert=new u.LotteryBuyAlert);var e=t.const2[0][1];this._buyAlert.showAlert(d.TextConst.get(609,e,10),Laya.Handler.create(this,this.onBuyTenHandler))}else this.onBuyTenHandler()},t.prototype.onBuyTenHandler=function(){var t=l.GameConfig.lotterySettingJSON[1],e=t.const2[0][1];if(10<=s.RoleCenter.instans.vo.bagdata.getItemCount(t.lottery)||s.RoleCenter.instans.self.GOLD>=e){var i=new o.sbkLotteryC2GS;i.msgidx=a.enumOpResultType.lottery_buy10,i.lotteryId=t.lotteryId,r.GSM.sendServer(i)}else p.Switches.ins.event(155)},t.prototype.lotterySuccess=function(t){var e=l.GameConfig.lotterySettingJSON[1];t.type==n.enumLotteryBagDataType.lottery_10_GOLD?(s.RoleCenter.instans.vo.GOLD-=e.const2[0][1],s.RoleCenter.instans.event(h.EventName.ROLE_PROP_CHANGE)):t.type==n.enumLotteryBagDataType.lottery_10_coin?(s.RoleCenter.instans.vo.bagdata.getItemCount(e.lottery)<10&&console.log("寻宝消耗与后台不同步了"),s.RoleCenter.instans.vo.chgItemCount(e.lottery,-10)):t.type==n.enumLotteryBagDataType.lottery_1_coin?(s.RoleCenter.instans.vo.bagdata.getItemCount(e.lottery)<1&&console.log("寻宝消耗与后台不同步了"),s.RoleCenter.instans.vo.chgItemCount(e.lottery,-1)):t.type==n.enumLotteryBagDataType.lottery_1_GOLD&&(s.RoleCenter.instans.vo.GOLD-=e.cost1[0][1],s.RoleCenter.instans.event(h.EventName.ROLE_PROP_CHANGE))},t}();e.LotteryAwardCtrl=g}),define("src/g/lottery/view/page/LotteryPage",["require","exports","src/g/Effects/UIEffectsFactory","../../../../config/GameConfig","../../../../utils/ItemUtils","src/g/custom/detailDlgs/Details_Equip","src/g/custom/detailDlgs/Details_Item","../../../../meta/QualiyVo"],function(t,e,h,c,u,i,n,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t._url_bg="res/lottery/chengzhuang/fenjie/003.jpg",t.prevY=0,t._des=new laya.html.dom.HTMLDivElement,t._des.width=t.txt_con.width,t._des.style.leading=8,t.txt_con.addChild(t._des),t.txt_con.on(Laya.Event.MOUSE_DOWN,t,t.startScrollText),t.on(Laya.Event.REMOVED,t,t.onRemoved),t}return __extends(t,e),t.prototype.onRemoved=function(){this.imgbg.skin=null,Laya.loader.clearRes(this._url_bg,!0)},t.prototype.startScrollText=function(t){this.prevY=this.txt_con.mouseY,Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.scrollText),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.finishScrollText)},t.prototype.finishScrollText=function(t){Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.scrollText),Laya.stage.off(Laya.Event.MOUSE_UP,this,this.finishScrollText),0<this._des.y&&Laya.Tween.to(this._des,{y:0},200);var e=0;200<this._des.height&&(e=Math.min(-(this._des.height-this.txt_con.height),0)),this._des.y<e&&Laya.Tween.to(this._des,{y:e},200)},t.prototype.scrollText=function(t){var e=this.txt_con.mouseY;this._des.y+=e-this.prevY,this.prevY=e},t.prototype.appendHTML=function(t){this._des&&(this._des.appendHTML(t),this._des.layout(),this._des.height<=200?this._des.y=0:this._des.y=Math.min(0-(this._des.height-this.txt_con.height),0))},t.prototype.init=function(){for(var t=c.GameConfig.lotterySettingJSON[1],e=(t.show.length,0);e<12;){var i=t.show[e],n=u.ItemUtils.getEquipVoById(i),s=u.ItemUtils.getItemVoById(i),o=i?u.ItemUtils.getIconById(i):"";if(e<2){var a=this["item"+e],r=h.UIEffectsFactory.Ins.createUIAniById(p.QualityStruct.Ins.getQEffById(5),!0);h.UIEffectsFactory.Ins.centered4Parent(r,a.ani,!0),a.setIcon(o),0<i&&a.setClieckHD(this.setTip(n,s))}else{var l=this["item"+e];l&&(l.setJob(0),l.setIcon(o),l.setLv(null),0<i&&l.setClieckHD(this.setTip(n,s)),s&&(l.setLv(u.ItemUtils.getLv(s.quality)),l.setJob(0)),n&&(l.setLv(u.ItemUtils.getEquipLv(n.limit)),l.setJob(n.job)))}e++}this.buy1_cost.text=t.cost1[0][1]+"",this.buy10_cost.text=t.const2[0][1]+""},t.prototype.showBase=function(){},t.prototype.setTip=function(t,e){return t?new Laya.Handler(this,function(t){var e=new i.Details_Equip;e.initData(null,null,t),e.popup()},[t]):e?new Laya.Handler(this,function(t){var e=new n.Details_Item;e.initData(t,1,!1),e.popup()},[e]):null},t.prototype.refreshData=function(){this.imgbg.skin=this._url_bg},t}(ui.lottery.Pages.LotteryPageUI);e.LotteryPage=s}),define("src/g/lottery/ctrl/LotteryCtrl",["require","exports","../../../utils/ItemUtils","../../../manager/GameSocketManager","src/g/lottery/view/page/LotteryPage","../../net/messages/sbkLotteryC2GS","../../net/messages/OpResultType","../../../manager/RoleCenter","../../net/messages/sbkLotteryShowListGS2C","../../../config/GameConfig","../../net/messages/sbkLotteryBagData","src/g/lottery/ctrl/LotteryAwardCtrl","../../../manager/StateManger","src/g/lottery/view/LotteryBuyAlert","src/init/Switches","src/init/ResManager","src/g/clearRes/ClearResM","../../../core/E","../../../enum/EventName","src/init/TextConst"],function(t,e,r,n,i,s,o,a,l,h,c,u,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(){function t(){}return t.prototype.addEvent=function(){this._view.btn_buyOne.on(laya.events.Event.CLICK,this,this.onBuyOneClickHandler),this._view.btn_buyTen.on(laya.events.Event.CLICK,this,this.onBuyTenClickHandler),a.RoleCenter.instans.on(o.enumOpResultType.lottery_buy1+"",this,this.onBuyOneBack),a.RoleCenter.instans.on(o.enumOpResultType.lottery_buy10+"",this,this.onBuyTenBack),n.GSM.ins.on(l.sbkLotteryShowListGS2C.KEY,this,this.onInitDataBack),n.GSM.ins.on(l.sbkLotteryShowListData.KEY,this,this.onAddShowDataBack),n.GSM.ins.on(c.sbkLotteryBagData.KEY,this,this.onLotteryDataBack),this._view.btn_test.on(Laya.Event.CLICK,this,this.onTestClick)},t.prototype.onTestClick=function(){this._view.txt_con.visible=!this._view.txt_con.visible,this._view.panel_test.visible=!this._view.txt_con.visible},t.prototype.addTest=function(t,e){var i=new Laya.Label;i.x=0,i.y=this._view.vBox_test.height,i.width=468,i.color=r.ItemUtils.getQualityColorById(e),i.fontSize=20,i.wordWrap=!0,i.text=t,i.layoutEnabled=!0,this._view.vBox_test.addChild(i),Laya.timer.frameOnce(3,this,this.setTestSbr)},t.prototype.setTestSbr=function(){this._view.panel_test.vScrollBar.value=this._view.panel_test.vScrollBar.max},t.prototype.requestInitData=function(){var t=h.GameConfig.lotterySettingJSON[1],e=new s.sbkLotteryC2GS;e.msgidx=o.enumOpResultType.lottery_showList,e.lotteryId=t.lotteryId,n.GSM.sendServer(e)},t.prototype.onInitDataBack=function(t){for(var e=t.showList.length,i=0;i<e;)this.onAddShowDataBack(t.showList[i]),i++},t.prototype.onAddShowDataBack=function(t){var e="",i=r.ItemUtils.getQualityColorById(t.itemCfgId),n=r.ItemUtils.getItemVoById(t.itemCfgId);n&&(e=n.name);var s=r.ItemUtils.getEquipVoById(t.itemCfgId);s&&(e=s.name+"("+r.ItemUtils.getEquipLv(s.limit)+" "+r.ItemUtils.getJobCNById(s.id)+")");var o=r.ItemUtils.getWingEquipVoById(t.itemCfgId);o&&(e=o.name);var a=_.TextConst.get(610,t.userName,i,e);this._view.appendHTML(a)},t.prototype.onBuyOneClickHandler=function(){var t=h.GameConfig.lotterySettingJSON[1];if(p.StateManger.showLotteryBuyAlert&&a.RoleCenter.instans.vo.bagdata.getItemCount(t.lottery)<1){this._buyAlert||(this._buyAlert=new d.LotteryBuyAlert);var e=t.cost1[0][1];this._buyAlert.showAlert(_.TextConst.get(609,e,1),Laya.Handler.create(this,this.onBuyOneHandler))}else this.onBuyOneHandler()},t.prototype.onBuyTenClickHandler=function(){var t=h.GameConfig.lotterySettingJSON[1];if(p.StateManger.showLotteryBuyAlert&&a.RoleCenter.instans.vo.bagdata.getItemCount(t.lottery)<10){this._buyAlert||(this._buyAlert=new d.LotteryBuyAlert);var e=t.const2[0][1];this._buyAlert.showAlert(_.TextConst.get(609,e,10),Laya.Handler.create(this,this.onBuyTenHandler))}else this.onBuyTenHandler()},t.prototype.onBuyOneHandler=function(){var t=h.GameConfig.lotterySettingJSON[1],e=t.cost1[0][1];if(a.RoleCenter.instans.vo.bagdata.getItemCount(t.lottery)||a.RoleCenter.instans.self.GOLD>=e){var i=new s.sbkLotteryC2GS;i.msgidx=o.enumOpResultType.lottery_buy1,i.lotteryId=t.lotteryId,n.GSM.sendServer(i)}else g.Switches.ins.event(155)},t.prototype.onBuyOneBack=function(t){t.opresult?console.log("买1个成功！"):console.log("买1个失败！")},t.prototype.onBuyTenHandler=function(){var t=h.GameConfig.lotterySettingJSON[1],e=t.const2[0][1];if(10<=a.RoleCenter.instans.vo.bagdata.getItemCount(t.lottery)||a.RoleCenter.instans.self.GOLD>=e){var i=new s.sbkLotteryC2GS;i.msgidx=o.enumOpResultType.lottery_buy10,i.lotteryId=t.lotteryId,n.GSM.sendServer(i)}else g.Switches.ins.event(155)},t.prototype.onBuyTenBack=function(t){t.opresult?console.log("买10个成功！"):console.log("买10个失败！")},t.prototype.onLotteryDataBack=function(t){if(t.type!=c.enumLotteryBagDataType.bag){var e,i=t.type==c.enumLotteryBagDataType.lottery_10_coin||t.type==c.enumLotteryBagDataType.lottery_10_GOLD;this._awardShowCtrl.showView(t,i),this._awardShowCtrl.lotterySuccess(t);for(var n=0;n<t.idArr.length;n++){var s=t.idArr[n];if(104!=s)if(s<1e4){var o=h.GameConfig.itemJSON[s];e="id:"+o.id+" name:"+o.name+" 品质："+o.quality,this.addTest(e,s)}else{var a=t.equipIdArr.indexOf(s),r=h.GameConfig.equipByID(t.equipObj[a].equtemplet);e="id:"+r.id+" name:"+r.name+" 品质："+r.quality+" limit:"+r.limit,this.addTest(e,r.id)}}}},t.prototype.showPage=function(t){t.removeChildren(),this.refreshData(),t.addChild(this._view),f.ClearResM.resetViewImg(t),y.E.ins.on(m.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){f.ClearResM.clearResFolder("lottery/shengshi/")},t.prototype.init=function(){return this._view||(this._view=new i.LotteryPage),this.addEvent(),this._view.init(),this._view.showBase(),this.requestInitData(),this._awardShowCtrl=new u.LotteryAwardCtrl,this},t.prototype.refreshData=function(){this._view.refreshData()},t.prototype.onRefreshShow=function(){this._view.displayedInStage&&this._view.showBase()},t.prototype.changePerson=function(t){this.onRefreshShow()},t.prototype.getTitle=function(){return"res/lottery/xunbao_biaoti_wenzi1.png"},t.prototype.hidePage=function(){v.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){v.ResManager.getInstance().destroyPageCtrl(this)},t}();e.LotteryCtrl=C}),define("src/g/lottery/view/page/LotteryWarehousePage",["require","exports","../../../../enum/EventName","src/g/bag/vo/BagDataVo","../../../../utils/ItemUtils","../../../../manager/RoleCenter","../../../../core/E"],function(t,e,i,l,h,c,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.init=function(){this.list_.renderHandler=new Laya.Handler(this,this.onListRender),this.list_.scrollBar.elasticDistance=200,n.E.ins.on(i.EventName.LOTTERY_WAREHOUSE_DATA_CHANGED,this,this.onDataChanged)},e.prototype.onListRender=function(t,e){var i=t.dataSource,n=i.id,s=i.num;i.equVo?(t.lab_lv.text=h.ItemUtils.getEquipLv(i.equVo.limit),t.item0.img_occupation.skin=h.ItemUtils.getOccupationIconById(n),t.item0.img_occupation.visible=!0):i.ItmVo&&(t.lab_lv.text=i.ItmVo.name,t.item0.img_occupation.skin="res/indexicon/red_point.png",t.item0.img_occupation.visible=!1),t.lab_lv.color=h.ItemUtils.getQualityColorById(n),t.item0.item.img_quality.skin=h.ItemUtils.getQualityBjById(n),t.item0.item.img_item.skin=h.ItemUtils.getIconById(n);var o=t.item0.item.lab_num;o.visible=1<s&&(o.text=s+"",!0)},e.prototype.onDataChanged=function(t){(1==t||this.displayedInStage)&&this.showBase()},e.prototype.showBase=function(){var t=c.RoleCenter.instans.self.lotteryData.bagData;this.arr_item=[];for(var e=t.idArr.length,i=0;i<e;){var n=t.idArr[i],s=t.equipIdArr.indexOf(n);if(-1!=s){var o=h.ItemUtils.getEquipVoById(t.equipObj[s].equtemplet);if(!o||!o.id){i++;continue}(a=new l.BagDataVo).equid=n,a.id=o.id,a.num=1,a.equVo=o,this.arr_item.push(a)}else{var a,r=h.ItemUtils.getItemVoById(n);if(!r||!r.id){i++;continue}(a=new l.BagDataVo).id=r.id,a.num=t.numArr[i],a.ItmVo=r,this.arr_item.push(a)}i++}this.list_.dataSource=this.arr_item},e}(ui.lottery.Pages.WarehousePageUI);e.LotteryWarehousePage=s}),define("src/g/mail/vo/MailItemVo",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.isGet=!1}return t.prototype.setVo=function(t){this._vo=t},Object.defineProperty(t.prototype,"vo",{get:function(){return this._vo},enumerable:!0,configurable:!0}),t}();e.MailItemVo=i}),define("src/g/mijing/ctrl/MiJingPageCtrl",["require","exports","src/g/mijing/view/MiJingPageNew","src/init/ResManager"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this.addEvent()}return t.prototype.addEvent=function(){},t.prototype.init=function(){var t=this;Laya.loader.load("res/atlas/res/society.json",Laya.Handler.create(this,function(){t._view=new i.MiJingPageNew,t._parent&&t._parent.addChild(t._view)}))},t.prototype.showPage=function(t,e){t.removeChildren,this._parent=t,this._view?t.addChild(this._view):this.init(),n.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){},t.prototype.getTitle=function(){return""},t.prototype.hidePage=function(){n.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){n.ResManager.getInstance().destroyPageCtrl(this)},t}();e.MiJingPageCtrl=s}),define("src/g/openRing/view/OpenRingBg",["require","exports","../../../manager/LayerManager","src/g/clearRes/ClearResM","../../../core/E","../../../enum/EventName"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.view_bg.btn_help.visible=!1,t.view_bg.btn_back.visible=!0,t}return __extends(t,e),t.prototype.init=function(){},t.prototype.addEvent=function(){this.view_bg.btn_close.on(Laya.Event.CLICK,this,this.destroyView),this.view_bg.btn_back.on(Laya.Event.CLICK,this,this.destroyView)},t.prototype.removeEvent=function(){this.view_bg.btn_close.off(Laya.Event.CLICK,this,this.destroyView)},t.prototype.showView=function(t){void 0===t&&(t=!0),i.LayerManager.addInPOPWindowLayer(this,t),this.addEvent(),n.ClearResM.resetViewImg(this),s.E.ins.on(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t.prototype.closeClearRes=function(){s.E.ins.off(o.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),n.ClearResM.clearFolderByUrl("dynamic2/rings/"),n.ClearResM.clearFolderByUrl("dynamic2/ringst/")},t.prototype.hideView=function(){this.removeEvent(),this.view_bg.box_page.removeChildren(),this.removeSelf()},t.prototype.destroyView=function(){this.hideView()},t}(ui.openring.openRingBgUI);e.OpenRingBg=a}),define("src/g/openRing/view/item/RingItem",["require","exports","../../../../core/E","../../../../enum/EventName","src/g/openRing/vo/TeJieUtil","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","src/init/Switches","../../../../vo/RedDot/RedDot_RingOpen"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(e){function t(){var t=e.call(this)||this;return t._data=null,t.canJump=!1,i.E.ins.on(n.EventName.RING_REFRESH_PRE,t,t.renderItem),i.E.ins.on(n.EventName.OPENRING_RED_CHANGE,t,t.refreshRed),t}return __extends(t,e),t.prototype.refreshRed=function(){var t=l.RedDot_RingOpen.Ins.getRingRedArr().indexOf(this._data.id);this.img_red.visible=-1!=t&&l.RedDot_RingOpen.Ins.getRingRedArr()[t+1]},t.prototype.initData=function(t,e){void 0===e&&(e=!0),this._data=t,e&&(this.img_bg.skin="res/openring/X_tejiediban_001.png",this.img_bg.pos(0,0),this.img_icon.pos(90,75),this.img_name.pos(235,29),this.img_red.pos(374,69),this.lab_desc.pos(235,77)),this.renderItem(),this.on(Laya.Event.CLICK,this,this.onClickedItem)},t.prototype.renderItem=function(){this.refreshRed(),this.img_icon.skin="dynamic/tejie/"+this._data.icon+".png",Laya.loader.getRes(this.img_icon.skin)||this.img_icon.restskin(),this.img_name.skin="dynamic/tejie/"+this._data.name+".png",Laya.loader.getRes(this.img_name.skin)||this.img_name.restskin();var t=s.TeJieUtil.checkIsOpen(this._data.id);this.gray=0==t,this.canJump=0!=t,0==t?this.lab_desc.text=this._data.ringTaskNeed:(this.lab_desc.text=this._data.ringTaskDec,this.img_icon.gray=1==t)},t.prototype.onClickedItem=function(){this.canJump?r.Switches.ins.event(11,[!0,!0,1,this._data]):o.FE.upItems(this._data.ringTaskNeed,a.BubbleEnum.center)},t}(ui.openring.item.ringItemUI);e.RingItem=h}),define("src/g/openRing/view/RingPerView",["require","exports","src/g/openRing/view/item/RingItem","../../../config/GameConfig","../../../core/E","../../../enum/EventName"],function(t,e,o,a,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t._selfItemArr=[],t.initView(),t}return __extends(t,e),t.prototype.showView=function(t){t.removeChildren(),t.addChild(this),i.E.ins.event(n.EventName.RING_REFRESH_PRE)},t.prototype.initView=function(){var t=[];for(var e in a.GameConfig.openRing)t.push(a.GameConfig.openRing[e]);var i=0,n=0;for(e=0;e<t.length;e++){var s=new o.RingItem;this.box_panl.addChild(s),e%2==1?(s.initData(t[e],!1),s.pos(136,i*s.height+93+88*i),i++):(s.pos(0,n*s.height+88*n),s.initData(t[e]),n++),this._selfItemArr.push(s)}},t}(ui.openring.page.RingPreViewUI);e.RingPerView=s}),define("src/g/openRing/view/RingInfoView",["require","exports","../../../core/E","../../../enum/EventName","src/init/Switches","src/g/openRing/vo/TeJieUtil","../../../utils/ItemUtils","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","../../net/messages/Ring12C2GS","../../../manager/GameSocketManager","../../../vo/RedDot/RedDot_RingOpen","src/g/Effects/UIEffectsFactory","src/init/TextConst"],function(t,e,i,n,s,a,r,o,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(e){function t(){var t=e.call(this)||this;return t.bar_panl.width=1,i.E.ins.on(n.EventName.RING_REFRESH_INFO,t,t.refreshView),i.E.ins.on(n.EventName.OPENRING_RED_CHANGE,t,t.refreshRed),t.lab_skilldes.style.font="SimHei",t.lab_skilldes.style.fontSize=16,t.btn_achivate.on(Laya.Event.CLICK,t,t.onAchivate),i.E.ins.on(n.EventName.TEJIE_ACHIVATE,t,t.playAchivateAnim),t}return __extends(t,e),t.prototype.playAchivateAnim=function(){this.displayedInStage&&p.UIEffectsFactory.Ins.playAniOnce(38,this.box_effect,1.3,1.3)},t.prototype.refreshRed=function(){this.renderTask()},t.prototype.onAchivate=function(){if(2==a.TeJieUtil.checkTask(this._data.taskID[0])&&2==a.TeJieUtil.checkTask(this._data.taskID[1])){var t=new h.TejieActivateMsg;t.cfgId=this._data.id,c.GSM.sendServer(t)}else o.FE.upItems(d.TextConst.get(652),l.BubbleEnum.center)},t.prototype.backToPre=function(){s.Switches.ins.event(11,[!0,!0,0])},t.prototype.showView=function(t,e){t.removeChildren(),t.addChild(this),this._data=e,this.renderView()},t.prototype.refreshView=function(){this.displayedInStage&&this.renderView()},t.prototype.renderView=function(){this.img_des.skin="dynamic/tejie/desc/"+this._data.name+".png",this.img_name.skin="dynamic/tejie/"+this._data.name+".png",this.img_skillIcon.skin="dynamic/tejie/"+this._data.skillIcon+".png",this.lab_skilldes.innerHTML=this._data.skillDec,this.lab_skillname.text=this._data.skillName,this.lab_dec.text=this._data.desc,this.renderAchivateBtn(),this.renderBigImg(),this.renderTask(),this.setBar()},t.prototype.renderBigImg=function(){2==a.TeJieUtil.checkIsOpen(this._data.id)?(this.img_ring.skin="",this.ani_ring.source="dynamic2/rings/"+this._data.image+".json"):(this.ani_ring.source=" ",this.img_ring.skin="dynamic/tejie/"+this._data.image+".png",this.img_ring.gray=!0)},t.prototype.renderTask=function(){for(var t=!0,e=0;e<this._data.taskID.length;e++)this.renderByTaskBox(e,this._data.taskID[e]),2!=a.TeJieUtil.checkTask(this._data.taskID[e])&&(t=!1);this.btn_achivate.visible=t},t.prototype.renderAchivateBtn=function(){switch(a.TeJieUtil.checkIsOpen(this._data.id)){case 0:this.btn_achivate.label=d.TextConst.get(347),this.btn_achivate.disabled=!0;break;case 1:this.btn_achivate.label=d.TextConst.get(653),this.btn_achivate.disabled=!1;break;case 2:this.btn_achivate.label=d.TextConst.get(524),this.btn_achivate.disabled=!0}},t.prototype.renderByTaskBox=function(t,e){var i=this["task_"+t],n=r.ItemUtils.getTeJieTaskVoById(e);i.img_icon.skin="dynamic/taskicon/"+n.taskIcon+".png",i.img_icon.restskin(),i.img_over.restskin(),i.box_taskTitle.width=1,i.lab_name.text=n.name,i.box_taskTitle.width+=i.lab_name.width,i.lab_need.text="("+a.TeJieUtil.checkProgress(e)+"/"+(n.need||n.target)+")",i.box_taskTitle.width+=i.lab_need.width,i.lab_need.x=i.lab_name.width;var s=a.TeJieUtil.checkTask(e);i.btn_jump.offAll(),2==s?(i.btn_jump.visible=!1,i.img_over.visible=!0,i.lab_reward.visible=!1):(i.lab_reward.visible=!0,i.btn_jump.visible=!0,1==s?(i.btn_jump.label=d.TextConst.get(654),i.btn_jump.on(Laya.Event.CLICK,this,this.getTaskReward,[e])):0==n.moduleID.length?i.btn_jump.visible=!1:(i.btn_jump.label=d.TextConst.get(200),i.btn_jump.on(Laya.Event.CLICK,this,this.taskJump,[n.moduleID[0][1]])),i.img_over.visible=!1);var o=u.RedDot_RingOpen.Ins.getTaskArr().indexOf(this._data.id);i.img_red.visible=-1!=t&&u.RedDot_RingOpen.Ins.getTaskArr()[o+1]},t.prototype.getTaskReward=function(t){var e=new h.TejieTaskGetMsg;e.cfgId=t,c.GSM.sendServer(e)},t.prototype.taskJump=function(t){s.Switches.ins.event(t)},t.prototype.setBar=function(){var t=0;if(2==a.TeJieUtil.checkIsOpen(this._data.id))t=this._data.taskID.length;else for(var e=0;e<this._data.taskID.length;e++)2==a.TeJieUtil.checkTask(this._data.taskID[e])&&t++;var i=this._data.taskID.length;this.lab_barCount.changeText(t+"/"+i);var n=this.bar_img.width/i*t;n=0==n?1:n,this.bar_panl.width=n},t}(ui.openring.page.RingInfoViewUI);e.RingInfoView=g}),define("src/g/openRing/ctrl/OpenRingBgCtrl",["require","exports","src/g/openRing/view/OpenRingBg","src/g/base/BaseCtrl","../../net/messages/Ring12C2GS","../../../manager/GameSocketManager","../../../manager/RoleCenter","../../../vo/RedDot/RedDot_RingOpen","src/init/Switches","src/g/openRing/view/RingPerView","src/g/openRing/view/RingInfoView","../../../core/E","../../../enum/EventName","../../../utils/ItemUtils","../../../utils/system/FloatEffect","../../net/messages/sbkTejieData","../../../plugin/sbkPropTool","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var m=function(e){function t(){var t=e.call(this)||this;return t.urls=["res/atlas/res/openring.json"],t.initCtrl(),t}return __extends(t,e),t.prototype.onOpenRing=function(t,e,i,n,s){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===i&&(i=!0),void 0===n&&(n=0),this.selectIndex=n,this._data=s,this.opens()},t.prototype.onAtlasLoaded=function(){this.realOpenRoleView(this.selectIndex)},t.prototype.realOpenRoleView=function(t){switch(void 0===t&&(t=0),this._view||this.initView(),this._view.displayedInStage||this._view.showView(),t){case 0:this.perView||(this.perView=new h.RingPerView),this.perView.showView(this._view.view_bg.box_page),this._view.view_bg.btn_back.off(Laya.Event.CLICK,this,this.backRing);break;case 1:this.infoView||(this.infoView=new c.RingInfoView),this._view.view_bg.btn_back.once(Laya.Event.CLICK,this,this.backRing),this.infoView.showView(this._view.view_bg.box_page,this._data)}},t.prototype.backRing=function(){l.Switches.ins.event(11,[!0,!0,0])},t.prototype.addEvent=function(){l.Switches.ins.on(11,this,this.onOpenRing);var t=o.GSM.ins;t.on(s.TejieOpenGS2C.KEY,this,this.onTeJieOpenGS2C),t.on(s.TejieActivateMsg.KEY,this,this.onTejieActivateMsg),t.on(s.TejieTaskGetMsg.KEY,this,this.onTejieTaskGetMsg)},t.prototype.onTejieTaskGetMsg=function(t){this.user=a.RoleCenter.instans.vo,this.user.tejie.taskArr.indexOf(t.cfgId)<0&&this.user.tejie.taskArr.push(t.cfgId);var e=d.ItemUtils.getTeJieTaskVoById(t.cfgId);g.FE.getFloat(y.TextConst.get(73,e.bonus[0][1]),d.ItemUtils.getColorByQuality(6)),u.E.ins.event(p.EventName.RING_REFRESH_INFO),u.E.ins.event(p.EventName.TEJIE_TASKACHIVATE)},t.prototype.onTejieActivateMsg=function(t){this.user=a.RoleCenter.instans.vo;var e=this.user.tejie.jihuoArr.indexOf(t.cfgId);this.user.tejie.jihuoArr[e+1]=200;var i=this.user.combat;f.sbkPropTool.resetTeJie(),u.E.ins.event(p.EventName.TEJIE_ACHIVATE),this.user.reCheckComBat(),r.RedDot_RingOpen.Ins.recheckRingOpen(),a.RoleCenter.instans.event(p.EventName.FIGHT_UP,this.user.combat-i),u.E.ins.event(p.EventName.RING_REFRESH_INFO),u.E.ins.event(p.EventName.RING_REFRESH_PRE)},t.prototype.onTeJieOpenGS2C=function(t){this.user=a.RoleCenter.instans.vo;for(var e=0;e<t.idArr.length;e++)v.sbkTejieData.addKejihuo(this.user.tejie,t.idArr[e]);r.RedDot_RingOpen.Ins.recheckRingOpen()},t.prototype.initCtrl=function(){this.addEvent()},t.prototype.initView=function(){this._view=new i.OpenRingBg},t}(n.BaseCtrl);e.OpenRingBgCtrl=m}),define("src/g/pay/PayTipDlg",["require","exports","../../core/E","../../enum/EventName","../../manager/RoleCenter","src/init/Switches"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){this.btn_close.on(Laya.Event.CLICK,this,this.onCloseDlg),this.btn_fail.on(Laya.Event.CLICK,this,this.onCloseDlg),this.btn_ok.on(Laya.Event.CLICK,this,this.onPay)},t.prototype.onPay=function(){s.RoleCenter.instans.vo.vipData.isFirstCharge?o.Switches.ins.event(109):o.Switches.ins.event(13),i.E.ins.event(n.EventName.CLOSE_GETDLG),this.close()},t.prototype.onCloseDlg=function(){this.close()},t}(ui.pay.PayTipDlgUI);e.PayTipDlg=a}),define("src/g/proxy/ActivityBtnEnterByTrigger",["require","exports","../../enum/EventName","src/g/accessctrl/AccessCenter","../../core/E","../../manager/ActivityManager","../../utils/SoundUtils","src/init/Switches","../../manager/RoleCenter"],function(t,e,n,i,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function t(t,e,i,n){this._btn=t,this._btn.visible=!0,this._btn&&(this._parent=this._btn.parent),this.accessId=i,this.trigger=e,this.banActivityCfgId=n,this.init()}return t.prototype.init=function(){this._btn&&(this._btn.once(n.EventName.ON_UI_DESTROYED,this,this.doDestroy),this.accessId&&!i.AccessCenter.ins.checkOpen(this.accessId)?(this._btn.parent&&(this._btn.removeSelf(),this._btn.event(n.EventName.UI_REMOVE_STAGE)),i.AccessCenter.ins.on(this.accessId,this,this.onActivityAccessUpdate)):this.doInit())},t.prototype.onActivityAccessUpdate=function(){i.AccessCenter.ins.checkOpen(this.accessId)&&(i.AccessCenter.ins.off(this.accessId,this,this.onActivityAccessUpdate),this.doInit())},t.prototype.doInit=function(){if(this.accessId&&this.trigger){if(this._btn.on(Laya.Event.CLICK,this,this.toOpenViewFun),this.actEntity=o.ActivityManager.ins.getActivityByTrigger(this.trigger,[this.banActivityCfgId]),this.actEntity){if(this.actEntity.on(o.ActivityEntity.ACTIVITY_ENTITY_CHANGED,this,this.updateBtnShow),this.actEntity.on(o.ActivityEntity.ACTIVITY_ENTITY_DESTROY,this,this.doDestroy),this._btn.getChildByName("img_red")){var t=l.RoleCenter.instans.vo.getActivity1Data(this.actEntity.id);t&&(this._btn.getChildByName("img_red").visible=t.hasRed,s.E.ins.on(n.EventName.ACTIVITY_RED_UPDATE,this,this.onActivityRedUpdata))}}else s.E.ins.on(n.EventName.ACTIVITY_DATA_ADDED,this,this.onActivityAdded);this.updateBtnShow()}else this.doDestroy()},t.prototype.onActivityAdded=function(t,e,i){i==this.trigger&&t!=this.banActivityCfgId&&(s.E.ins.off(n.EventName.ACTIVITY_DATA_ADDED,this,this.onActivityAdded),Laya.timer.frameOnce(2,this,this.doInit))},t.prototype.onActivityRedUpdata=function(t){if(this.actEntity&&t==this.actEntity.id){var e=l.RoleCenter.instans.vo.getActivity1Data(t);e&&(this._btn.getChildByName("img_red").visible=e.hasRed)}},t.prototype.updateBtnShow=function(){this.actEntity&&this.actEntity.isActive?this._parent&&(this._parent.addChild(this._btn),this._btn.event(n.EventName.UI_ADD_TO_STAGE)):this._btn.parent&&(this._btn.removeSelf(),this._btn.event(n.EventName.UI_REMOVE_STAGE))},t.prototype.toOpenViewFun=function(){a.SoundUtils.getInstance().playBtnsounds(),r.Switches.ins.event(this.accessId,[!0,!0,this.actEntity.id])},t.prototype.doDestroy=function(){s.E.ins.off(n.EventName.ACTIVITY_RED_UPDATE,this,this.onActivityRedUpdata),this._btn.parent&&(this._btn.removeSelf(),this._btn.event(n.EventName.UI_REMOVE_STAGE)),this._btn.offAll(),this._btn=null,this._parent=null,this.accessId&&(i.AccessCenter.ins.off(this.accessId,this,this.onActivityAccessUpdate),this.accessId=0),this.actEntity&&(this.actEntity.off(o.ActivityEntity.ACTIVITY_ENTITY_CHANGED,this,this.updateBtnShow),this.actEntity.off(o.ActivityEntity.ACTIVITY_ENTITY_DESTROY,this,this.doDestroy),this.actEntity=null)},t}();e.ActivityBtnEnterByTrigger=h}),define("src/g/proxy/ActivityBtnEnterCtrlProxy",["require","exports","../../enum/EventName","src/g/accessctrl/AccessCenter","../../core/E","../../manager/ActivityManager","../../utils/SoundUtils","src/init/Switches","../../manager/RoleCenter"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function t(t,e,i,n){this.params=0,this._btn=t,this._btn.visible=!0,this._btn&&(this._parent=this._btn.parent),this.accessId=i,this.activityCfgId=e,this.params=n,this.init()}return t.prototype.init=function(){this._btn&&(this._btn.once(i.EventName.ON_UI_DESTROYED,this,this.doDestroy),this.accessId&&!n.AccessCenter.ins.checkOpen(this.accessId)?(this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE)),n.AccessCenter.ins.on(this.accessId,this,this.onActivityAccessUpdate)):this.doInit())},t.prototype.onActivityAccessUpdate=function(){n.AccessCenter.ins.checkOpen(this.accessId)&&(n.AccessCenter.ins.off(this.accessId,this,this.onActivityAccessUpdate),this.doInit())},t.prototype.doInit=function(){if(this.accessId&&this.activityCfgId){if(this._btn.on(Laya.Event.CLICK,this,this.toOpenViewFun),this.actEntity=o.ActivityManager.ins.getActivityByCfgId(this.activityCfgId),this.actEntity){if(this.actEntity.on(o.ActivityEntity.ACTIVITY_ENTITY_CHANGED,this,this.updateBtnShow),this.actEntity.on(o.ActivityEntity.ACTIVITY_ENTITY_DESTROY,this,this.doDestroy),this._btn.getChildByName("img_red")){var t=l.RoleCenter.instans.vo.getActivity1Data(this.actEntity.id);t&&(this._btn.getChildByName("img_red").visible=t.hasRed,s.E.ins.on(i.EventName.ACTIVITY_RED_UPDATE,this,this.onActivityRedUpdata))}}else s.E.ins.on(i.EventName.ACTIVITY_DATA_ADDED,this,this.onActivityAdded);this.updateBtnShow()}else this.doDestroy()},t.prototype.onActivityAdded=function(t,e){t==this.activityCfgId&&(s.E.ins.off(i.EventName.ACTIVITY_DATA_ADDED,this,this.onActivityAdded),Laya.timer.frameOnce(2,this,this.doInit))},t.prototype.onActivityRedUpdata=function(t){if(this.actEntity&&t==this.actEntity.id){var e=l.RoleCenter.instans.vo.getActivity1Data(t);e&&(this._btn.getChildByName("img_red").visible=e.hasRed)}},t.prototype.updateBtnShow=function(){this.actEntity&&this.actEntity.isActive?this._parent&&(this._parent.addChild(this._btn),this._btn.event(i.EventName.UI_ADD_TO_STAGE)):this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE))},t.prototype.toOpenViewFun=function(){a.SoundUtils.getInstance().playBtnsounds(),r.Switches.ins.event(this.accessId,[!0,!0,this.params])},t.prototype.doDestroy=function(){s.E.ins.off(i.EventName.ACTIVITY_RED_UPDATE,this,this.onActivityRedUpdata),this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE)),this._btn.offAll(),this._btn=null,this._parent=null,this.accessId&&(n.AccessCenter.ins.off(this.accessId,this,this.onActivityAccessUpdate),this.accessId=0),this.actEntity&&(this.actEntity.off(o.ActivityEntity.ACTIVITY_ENTITY_CHANGED,this,this.updateBtnShow),this.actEntity.off(o.ActivityEntity.ACTIVITY_ENTITY_DESTROY,this,this.doDestroy),this.actEntity=null)},t}();e.ActivityBtnEnterCtrlProxy=h}),define("src/g/proxy/ActivityHallEnterCtrlProxy",["require","exports","../../enum/EventName","src/g/accessctrl/AccessCenter","src/g/activity/ctrl/ActivityHallViewCtrl","../../core/E","../../manager/ActivityManager","../../utils/system/DateUitl","../../utils/system/ServerTime","../../manager/RoleCenter","../../config/GameConfig","../../enum/ActivityTemplate"],function(t,e,i,n,s,o,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){this._btn=t,this._btn.visible=!0,this._btn&&(this._parent=this._btn.parent),this._pos=e,this.init()}return t.prototype.init=function(){this._btn&&(this._btn.once(i.EventName.ON_UI_DESTROYED,this,this.doDestroy),this.accessId=s.ActivityHallViewCtrl.pos2AccessId(this._pos),this.accessId&&!n.AccessCenter.ins.checkOpen(this.accessId)?(this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE)),n.AccessCenter.ins.on(this.accessId,this,this.onActivityAccessUpdate)):this.doInit())},t.prototype.onActivityAccessUpdate=function(){n.AccessCenter.ins.checkOpen(this.accessId)&&(n.AccessCenter.ins.off(this.accessId,this,this.onActivityAccessUpdate),this.doInit(),this.accessId=0)},t.prototype.doInit=function(){o.E.ins.on(i.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.onActivityHallChanged),this.updateBtnShow()},t.prototype.onActivityHallChanged=function(t){this._pos==t&&this.updateBtnShow()},t.prototype.updateBtnShow=function(){var t=l.ActivityManager.ins.getActivityHallByPos(this._pos);t&&0<t.count?this._parent&&(this._parent.addChild(this._btn),this._btn.event(i.EventName.UI_ADD_TO_STAGE),this._lab_cd=this._btn.getChildByName("lab_cd"),this._lab_cd&&(c.ServerTime.isInited?this.findEndTime():o.E.ins.once(i.EventName.SERVER_TIME_UPDATE,this,this.findEndTime))):(Laya.timer.clear(this,this.cooldownHandler),this._btn.parent&&(this._btn.removeSelf(),this._btn.event(i.EventName.UI_REMOVE_STAGE)))},t.prototype.doDestroy=function(){this._btn=null,this.accessId&&(n.AccessCenter.ins.off(this.accessId,this,this.onActivityAccessUpdate),this.accessId=0),o.E.ins.off(i.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.onActivityHallChanged),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.findEndTime=function(){var t=l.ActivityManager.ins.getActivityHallByPos(this._pos);if(t){for(var e,i,n=t.getActivatedIds(),s=n?n.length:0,o=0,a=0,r=0;o<s;)(e=u.RoleCenter.instans.vo.getActivity1Data(n[o]))&&(r=!(i=p.GameConfig.activityJson[e.cfgId])||i.clientkey!=d.ActivityTemplateKey.limit_gift&&i.clientkey!=d.ActivityTemplateKey.time_limit_accumulative_recharge?e.rewardTime:h.DateUtil.getZeroTime())>=c.ServerTime.serverTime&&(0==a||r<a)&&(a=r),o++;this._cdtime=a,this.cooldownHandler()}},t.prototype.cooldownHandler=function(){if(this._lab_cd){var t=this._cdtime-c.ServerTime.serverTime;604800<t?this._lab_cd.changeText(""):86400<t?(this._lab_cd.changeText(h.DateUtil.remainingDHStr(t)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<t?(this._lab_cd.changeText(h.DateUtil.getHMS_countdown(t)),Laya.timer.once(1e3,this,this.cooldownHandler)):t<=0&&(this._lab_cd.changeText("00:00:00"),Laya.timer.once(1e3,this,this.updateBtnShow))}},t}();e.ActivityHallEnterCtrlProxy=a}),define("src/g/proxy/IUICtrlProxy",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0})}),define("src/g/proxy/OneActivityHallEnterCtrlProxy",["require","exports","../../enum/EventName","src/g/accessctrl/AccessCenter","src/g/activity/ctrl/ActivityHallViewCtrl","../../core/E","../../manager/ActivityManager","../../utils/system/DateUitl","../../utils/system/ServerTime","../../manager/RoleCenter","../../config/GameConfig","../../enum/ActivityTemplate","src/g/clearRes/ClearResM"],function(t,e,s,i,n,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(t,e){this._activityId=0,this._btn=t,this._btn.visible=!0,this._btn&&(this._parent=this._btn.parent),this.defSkin=this._btn.skin?this._btn.skin:this._btn._gskin,this._pos=e,this.init()}return t.prototype.init=function(){this._btn&&(this._btn.once(s.EventName.ON_UI_DESTROYED,this,this.doDestroy),this.accessId=n.ActivityHallViewCtrl.pos2AccessId(this._pos),this.accessId&&!i.AccessCenter.ins.checkOpen(this.accessId)?(this._btn.parent&&(this._btn.removeSelf(),this._btn.event(s.EventName.UI_REMOVE_STAGE)),i.AccessCenter.ins.on(this.accessId,this,this.onActivityAccessUpdate)):this.doInit())},t.prototype.onActivityAccessUpdate=function(){i.AccessCenter.ins.checkOpen(this.accessId)&&(i.AccessCenter.ins.off(this.accessId,this,this.onActivityAccessUpdate),this.doInit(),this.accessId=0)},t.prototype.doInit=function(){o.E.ins.on(s.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.onActivityHallChanged),this.updateBtnShow()},t.prototype.onActivityHallChanged=function(t){this._pos==t&&this.updateBtnShow()},t.prototype.updateBtnShow=function(){var t=a.ActivityManager.ins.getActivityHallByPos(this._pos);if(t&&0<t.count){var e=t.getActivatedIds();if(e&&0<e.length){this._activityId=e[0];var i=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(i){var n=c.GameConfig.activityJson[i.cfgId];return p.ClearResM.delCachUrl(this._btn.skin),n.button?this._btn.skin="dynamic/activity/"+n.button+".png":this._btn.skin=this.defSkin,p.ClearResM.addCachUrl(this._btn.skin),void(this._parent&&(this._parent.addChild(this._btn),this._btn.event(s.EventName.UI_ADD_TO_STAGE),this._lab_cd=this._btn.getChildByName("lab_cd"),this._lab_cd&&(l.ServerTime.isInited?this.findEndTime():o.E.ins.once(s.EventName.SERVER_TIME_UPDATE,this,this.findEndTime))))}}}Laya.timer.clear(this,this.cooldownHandler),this._btn.parent&&(this._btn.removeSelf(),this._btn.event(s.EventName.UI_REMOVE_STAGE))},t.prototype.findEndTime=function(){var t=h.RoleCenter.instans.vo.getActivity1Data(this._activityId);if(t){var e=c.GameConfig.activityJson[t.cfgId];!e||e.clientkey!=u.ActivityTemplateKey.limit_gift&&e.clientkey!=u.ActivityTemplateKey.time_limit_accumulative_recharge?this._cdtime=t.rewardTime:this._cdtime=r.DateUtil.getZeroTime(),this.cooldownHandler()}},t.prototype.doDestroy=function(){this._btn=null,this.accessId&&(i.AccessCenter.ins.off(this.accessId,this,this.onActivityAccessUpdate),this.accessId=0),o.E.ins.off(s.EventName.ACTIVITY_HALL_LIST_CHANGED,this,this.onActivityHallChanged),Laya.timer.clear(this,this.cooldownHandler)},t.prototype.cooldownHandler=function(){if(this._lab_cd){var t=this._cdtime-l.ServerTime.serverTime;86400<t?(this._lab_cd.changeText(r.DateUtil.remainingDHStr(t)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<t?(this._lab_cd.changeText(r.DateUtil.getHMS_countdown(t)),Laya.timer.once(1e3,this,this.cooldownHandler)):t<=0?Laya.timer.once(1e3,this,this.updateBtnShow):this._lab_cd.changeText("00:00:00")}},t}();e.OneActivityHallEnterCtrlProxy=d}),define("src/g/proxy/uictrl/EnumUICtrl",["require","exports"],function(t,e){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.EnumUICtrl||(e.EnumUICtrl={}))[i.index_first_recharge_btn_ctrl=1]="index_first_recharge_btn_ctrl",i[i.index_first_recharge_prompt_ctrl=2]="index_first_recharge_prompt_ctrl",i[i.index_ring_btn_ctrl=3]="index_ring_btn_ctrl",i[i.index_vip3_ring_prompt_ctrl=4]="index_vip3_ring_prompt_ctrl",i[i.index_hero_prompt_ctrl=5]="index_hero_prompt_ctrl",i[i.index_daily_task_btn_prompt_ctrl=6]="index_daily_task_btn_prompt_ctrl",i[i.index_yueka_btn_ctrl=7]="index_yueka_btn_ctrl",i[i.index_day_recharge_prompt_ctrl=8]="index_day_recharge_prompt_ctrl",i[i.index_combine_first_recharge_ctrl=9]="index_combine_first_recharge_ctrl"}),define("src/g/proxy/uictrl/firstrechargebtn/DayRechargeBtnCtrl",["require","exports","src/g/accessctrl/AccessCenter","../../../../manager/RoleCenter","../../../net/messages/enumStatus","../../../../enum/EventName","../../../../core/E","src/init/Switches","../../../../manager/NewRedHintsCenter","../../../../utils/SoundUtils","../../../../utils/system/DateUitl","../../../../config/GameConfig","../../../../utils/system/ServerTime"],function(t,e,r,l,h,c,u,i,a,n,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this._activityId=0}return t.prototype.checkCurrentState=function(){if(r.AccessCenter.ins.checkOpen(111)){this._state=1;var t=!0,e=l.RoleCenter.instans.vo.getDayRechargeActivityData();if(e){this._activityId=e.id;for(var i,n=g.ServerTime.isHF?p.DateUtil.getHFDay(g.ServerTime.ACTIVITY_TIME_OFFSET):p.DateUtil.getKFDay(g.ServerTime.ACTIVITY_TIME_OFFSET),s=e.children.length,o=0,a=0;o<s;)(i=d.GameConfig.subActivityJson[e.children[o].cfgId])?a<i.value&&(a=i.value):console.error("天天充值数据错误："+o+"/"+JSON.stringify(e)),o++;for(0==(n%=a)&&(n=a),s=e.children.length,o=0;o<s;){if((i=d.GameConfig.subActivityJson[e.children[o].cfgId])&&i.value==n&&e.children[o].status!=h.enumStatus.yilingqu){t=!1;break}o++}}0==t?u.E.ins.on(c.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged):this._state=2}else r.AccessCenter.ins.on(111,this,this.onAccessChangedHandler),this._state=0;this.checkRed(),this.updateUI()},t.prototype.checkRed=function(){if(r.AccessCenter.ins.checkOpen(111)){var t=l.RoleCenter.instans.vo.getDayRechargeActivityData();if(t){for(var e,i=g.ServerTime.isHF?p.DateUtil.getHFDay(g.ServerTime.ACTIVITY_TIME_OFFSET):p.DateUtil.getKFDay(g.ServerTime.ACTIVITY_TIME_OFFSET),n=t.children.length,s=0,o=0;s<n;)(e=d.GameConfig.subActivityJson[t.children[s].cfgId])&&o<e.value&&(o=e.value),s++;for(0==(i%=o)&&(i=o),n=t.children.length,s=0;s<n;){if((e=d.GameConfig.subActivityJson[t.children[s].cfgId])&&e.value==i&&t&&t.children[s].status==h.enumStatus.kelingqu)return void a.NewRedHintsCenter.ins.setRedHintOpenOrClose(a.enumRedHints.recharge_btn,!0);s++}}}a.NewRedHintsCenter.ins.setRedHintOpenOrClose(a.enumRedHints.recharge_btn,!1)},t.prototype.updateUI=function(){0==this._state?this._ui.parent&&(this._ui.removeSelf(),this._ui.event(c.EventName.UI_REMOVE_STAGE)):1==this._state?(this._ui instanceof Laya.Image&&(this._ui.skin="res/indexicon/Xzjm_tubiao_019.png"),this._ui.on(Laya.Event.CLICK,this,this.onBtnClickHandler),this._parent&&(this._parent.addChild(this._ui),this._ui.event(c.EventName.UI_ADD_TO_STAGE))):2==this._state&&(this._ui.parent||this._parent&&(this._parent.addChild(this._ui),this._ui.event(c.EventName.UI_ADD_TO_STAGE)),this._backHandler&&this._backHandler.run())},t.prototype.onBtnClickHandler=function(){n.SoundUtils.getInstance().playBtnsounds(),i.Switches.ins.event(111)},t.prototype.onActivityDataChanged=function(t,e){this._activityId==e&&(u.E.ins.off(c.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.checkCurrentState())},t.prototype.onAccessChangedHandler=function(t){t&&(r.AccessCenter.ins.off(111,this,this.onAccessChangedHandler),this.checkCurrentState())},t.prototype.run=function(t,e,i){this._ui=t,this._backHandler=e,this._parent=i,this.checkCurrentState()},t.prototype.stop=function(){u.E.ins.off(c.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),r.AccessCenter.ins.off(111,this,this.onAccessChangedHandler),this._ui.off(Laya.Event.CLICK,this,this.onBtnClickHandler),this._ui=null,this._parent=null,this._backHandler=null},t.prototype.refreshUI=function(){u.E.ins.off(c.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.checkCurrentState()},t}();e.DayRechargeBtnCtrl=s}),define("src/g/proxy/uictrl/firstrechargebtn/DayAddUpRechargebtnCtrl",["require","exports","src/g/accessctrl/AccessCenter","../../../../manager/RoleCenter","../../../net/messages/enumStatus","../../../../enum/EventName","../../../../core/E","src/init/Switches","../../../../manager/NewRedHintsCenter","../../../../utils/SoundUtils"],function(t,e,n,s,o,a,r,i,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(){}return t.prototype.checkCurrentState=function(){if(n.AccessCenter.ins.checkOpen(8)){this._state=2;var t=s.RoleCenter.instans.vo.getDailyAccumulativeData();if(t)for(var e=t.children.length,i=0;i<e;){if(t.children[i].status!=o.enumStatus.yilingqu){this._activityId=t.id,r.E.ins.on(a.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this._state=1;break}i++}}else n.AccessCenter.ins.on(8,this,this.onAccessChangedHandler),this._state=0;this.checkRed(),this.updateUI()},t.prototype.checkRed=function(){if(n.AccessCenter.ins.checkOpen(8)){var t=s.RoleCenter.instans.vo.getDailyAccumulativeData();if(t&&t.hasRed)return void l.NewRedHintsCenter.ins.setRedHintOpenOrClose(l.enumRedHints.recharge_btn,!0)}l.NewRedHintsCenter.ins.setRedHintOpenOrClose(l.enumRedHints.recharge_btn,!1)},t.prototype.updateUI=function(){0==this._state?this._ui.parent&&(this._ui.removeSelf(),this._ui.event(a.EventName.UI_REMOVE_STAGE)):1==this._state?(this._ui instanceof Laya.Image&&(this._ui.skin="res/index1/zhujiemian_meirileichong.png"),this._ui.on(Laya.Event.CLICK,this,this.onBtnClickHandler),this._parent&&(this._parent.addChild(this._ui),this._ui.event(a.EventName.UI_ADD_TO_STAGE))):2==this._state&&(this._ui.parent||this._parent&&(this._parent.addChild(this._ui),this._ui.event(a.EventName.UI_ADD_TO_STAGE)),this._backHandler&&this._backHandler.run())},t.prototype.onBtnClickHandler=function(){h.SoundUtils.getInstance().playBtnsounds(),i.Switches.ins.event(146)},t.prototype.onActivityDataChanged=function(t,e){e==this._activityId&&(r.E.ins.off(a.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.checkCurrentState())},t.prototype.onAccessChangedHandler=function(t){t&&(n.AccessCenter.ins.off(8,this,this.onAccessChangedHandler),this.checkCurrentState())},t.prototype.run=function(t,e){this._ui=t,this._backHandler=e,this._parent=this._ui.parent,this.checkCurrentState()},t.prototype.stop=function(){r.E.ins.off(a.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),n.AccessCenter.ins.off(8,this,this.onAccessChangedHandler),this._ui.off(Laya.Event.CLICK,this,this.onBtnClickHandler),this._ui=null,this._parent=null,this._backHandler=null},t.prototype.refreshUI=function(){},t}();e.DayAddUpRechargebtnCtrl=c}),define("src/g/proxy/uictrl/firstrechargebtn/DayRechargeBtnNewCtrl",["require","exports","src/g/accessctrl/AccessCenter","../../../../manager/RoleCenter","../../../../utils/system/ServerTime","../../../../utils/system/DateUitl","../../../../config/GameConfig","../../../net/messages/enumStatus","../../../../core/E","../../../../enum/EventName","../../../../manager/NewRedHintsCenter","src/g/Effects/UIEffectsFactory","../../../../utils/SoundUtils","src/init/Switches"],function(t,e,l,h,c,u,p,d,g,v,r,a,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this._activityId=0,this._activityFirstId=0,this.ischeck=!1,this.isDayRechargeEnd=!0,this.canGet=!0,this.isRewardAll=!1}return t.prototype.checkCurrentState=function(){if(l.AccessCenter.ins.checkOpen(111)){this._state=1;var t=!0,e=h.RoleCenter.instans.vo.getDayRechargeActivityData(),i=h.RoleCenter.instans.vo.getFirstRechargeActivityData();if(this.firstData=i,e){this._activityId=e.id;for(var n,s=c.ServerTime.isHF?u.DateUtil.getHFDay(c.ServerTime.ACTIVITY_TIME_OFFSET):u.DateUtil.getKFDay(c.ServerTime.ACTIVITY_TIME_OFFSET),o=e.children.length,a=0,r=0;a<o;)(n=p.GameConfig.subActivityJson[e.children[a].cfgId])?r<n.value&&(r=n.value):console.error("天天充值数据错误："+a+"/"+JSON.stringify(e)),a++;for(0==(s%=r)&&(s=r),o=e.children.length,a=0;a<o;){if((n=p.GameConfig.subActivityJson[e.children[a].cfgId])&&n.value==s&&e.children[a].status!=d.enumStatus.yilingqu){t=!1;break}a++}}if(this.firstData){this._activityFirstId=i.id,this.isRewardAll=!0;for(a=0;a<3;a++)this.firstData.children[a].status==d.enumStatus.kelingqu&&(this.isRewardAll=!1);this.canGet=!this.isRewardAll,this.isDayRechargeEnd=t}else this.canGet=!1,this.isDayRechargeEnd=t;0==t||1==this.canGet?(g.E.ins.on(v.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),g.E.ins.on(v.EventName.FIRST_RECHARGE_REWARD_GET,this,this.onIconUpdate)):this._state=2,0==this.canGet&&1==this.isDayRechargeEnd&&(this._state=2)}else l.AccessCenter.ins.on(111,this,this.onAccessChangedHandler),this._state=0;this.updateUI(),1==this._state&&this.checkRed()},t.prototype.checkRed=function(){if(l.AccessCenter.ins.checkOpen(111)){var t=h.RoleCenter.instans.vo.getDayRechargeActivityData();if(t){for(var e,i=c.ServerTime.isHF?u.DateUtil.getHFDay(c.ServerTime.ACTIVITY_TIME_OFFSET):u.DateUtil.getKFDay(c.ServerTime.ACTIVITY_TIME_OFFSET),n=t.children.length,s=0,o=0;s<n;)(e=p.GameConfig.subActivityJson[t.children[s].cfgId])&&o<e.value&&(o=e.value),s++;for(0==(i%=o)&&(i=o),n=t.children.length,s=0;s<n;){if((e=p.GameConfig.subActivityJson[t.children[s].cfgId])&&e.value==i&&t&&t.children[s].status==d.enumStatus.kelingqu)return void r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.recharge_btn,!0);s++}}if(this.firstData&&1==this.isDayRechargeEnd&&1==this.canGet){var a=u.DateUtil.subDay(c.ServerTime.serverTime,this.firstData.allData.time);if(1<=a&&a<2&&this.firstData.children[1].status!=d.enumStatus.yilingqu)return void r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.recharge_btn,!0);if(2<=a&&a<3&&this.firstData.children[2].status!=d.enumStatus.yilingqu)return void r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.recharge_btn,!0)}}r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.recharge_btn,!1)},t.prototype.updateUI=function(){var t=this._ui;if(t){var e,i=new ktgame.img.KTImage,n=new Laya.Sprite;if(0==this._state)t.parent&&(t.removeSelf(),t.event(v.EventName.UI_REMOVE_STAGE));else if(1==this._state){if(t instanceof Laya.Image&&(t.removeChildren(),1==this.isDayRechargeEnd&&1==this.canGet?(t.skin="res/indexicon/Xzjm_tubiao_015.png",t.removeChildren(),r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.recharge_btn,!1)):(t.skin="res/indexicon/Xzjm_tubiao_019.png",t.removeChildByName("eff")),this._additionalUI=new ktgame.img.KTImage,this._additionalUI.width=90,this._additionalUI.height=90,this._additionalUI.skin="res/indexicon/Xzjm_tubiao_015.png",this._additionalUI.pos(80,0),i.skin="res/indexicon/red_point.png",i.pos(59,9),n.width=64,n.height=64,(e=a.UIEffectsFactory.Ins.createSAniById(41))&&(e.pivotX=e.width/2,e.pivotY=e.height/2,e.x=32,e.y=32,e.scale(.5,.5))),t.on(Laya.Event.CLICK,this,this.onBtnClickHandler),this._additionalUI.on(Laya.Event.CLICK,this,this.onAddtionalBtnClickHandler),this._parent){if(this._parent.addChild(t),t.event(v.EventName.UI_ADD_TO_STAGE),this.firstData){this.isRewardAll=!0;for(var s=0;s<3;s++)this.firstData.children[s].status==d.enumStatus.kelingqu&&(this.isRewardAll=!1)}if(this.firstData){var o=u.DateUtil.subDay(c.ServerTime.serverTime,this.firstData.allData.time);this.isRewardAll?this._additionalUI&&this._additionalUI.removeSelf():(t.removeChildren(),r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.recharge_btn,!1),t.addChild(this._additionalUI)),this._additionalUI.addChild(e),this._additionalUI.removeChildren(),1<=o&&o<2&&this.firstData.children[1].status!=d.enumStatus.yilingqu?this._additionalUI.addChild(i):2<=o&&o<3&&this.firstData.children[2].status!=d.enumStatus.yilingqu&&this._additionalUI.addChild(i)}else t.removeChildren(),r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.recharge_btn,!1)}1==this.isDayRechargeEnd&&1==this.canGet&&this._additionalUI&&this._additionalUI.removeSelf()}else 2==this._state&&(t.parent||this._parent&&(this._parent.addChild(t),t.event(v.EventName.UI_ADD_TO_STAGE)),this._backHandler&&this._backHandler.run(),this._additionalUI&&this._additionalUI.removeSelf())}},t.prototype.onBtnClickHandler=function(){i.SoundUtils.getInstance().playBtnsounds(),1==this.isDayRechargeEnd&&1==this.canGet?n.Switches.ins.event(13):n.Switches.ins.event(111)},t.prototype.onAddtionalBtnClickHandler=function(t){t.stopPropagation(),i.SoundUtils.getInstance().playBtnsounds(),n.Switches.ins.event(13)},t.prototype.onActivityDataChanged=function(t,e){this._activityId!=e&&this._activityFirstId!=e||(g.E.ins.off(v.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.checkCurrentState())},t.prototype.onAccessChangedHandler=function(t){t&&(l.AccessCenter.ins.off(111,this,this.onAccessChangedHandler),this.checkCurrentState())},t.prototype.run=function(t,e,i){g.E.ins.on(v.EventName.ACTIVITY_DELETED,this,this.onActivityDeleted),this._ui=t,this._backHandler=e,this._parent=i,this.checkCurrentState()},t.prototype.onReward=function(){},t.prototype.onActivityDeleted=function(t,e){this._activityFirstId==e&&this.checkCurrentState()},t.prototype.stop=function(){r.NewRedHintsCenter.ins.setRedHintOpenOrClose(r.enumRedHints.recharge_btn,!1),g.E.ins.off(v.EventName.ACTIVITY_DELETED,this,this.onActivityDeleted),g.E.ins.off(v.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),l.AccessCenter.ins.off(111,this,this.onAccessChangedHandler),this._ui.off(Laya.Event.CLICK,this,this.onBtnClickHandler),this._ui=null,this._parent=null,this._backHandler=null},t.prototype.refreshUI=function(){g.E.ins.off(v.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.checkCurrentState()},t.prototype.onIconUpdate=function(){g.E.ins.off(v.EventName.FIRST_RECHARGE_REWARD_GET,this,this.onIconUpdate),Laya.timer.frameOnce(2,this,this.checkCurrentState)},t.prototype.removeAdd=function(){var t=this;Laya.timer.frameOnce(2,this,function(){t._additionalUI.removeSelf()}),Laya.timer.frameOnce(2,this,this.checkCurrentState)},t}();e.DayRechargeBtnNewCtrl=s}),define("src/g/proxy/uictrl/firstrechargebtn/IndexFirstRechargeBtnCtrl",["require","exports","src/g/proxy/uictrl/firstrechargebtn/FirstRechargeBtnCtrl","src/g/proxy/uictrl/firstrechargebtn/DayRechargeBtnCtrl","../../../../enum/EventName","../../../../manager/GameSocketManager","../../../net/messages/OpResultGS2C","../../../net/messages/OpResultType","../../../../core/E","../../../../manager/RoleCenter","src/init/GameState","src/g/activity/ctrl/ActivityCtrl","src/g/proxy/uictrl/firstrechargebtn/FirstRechargeBtnNewCtrl","src/g/proxy/uictrl/firstrechargebtn/DayRechargeBtnNewCtrl"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(){function t(){this._state=0,l.E.ins.on(s.EventName.PAYChanged,this,this.checkPay),o.GSM.ins.on(a.OpResultGS2C.KEY,this,this.onOpResult)}return t.prototype.doDestroy=function(){c.GameState.index_first_recharge_state=0,o.GSM.ins.off(a.OpResultGS2C.KEY,this,this.onOpResult),Laya.timer.clearAll(this),this._ctrler&&(this._ctrler.stop(),this._ctrler=null),this._ui&&(this._ui.removeSelf(),this._ui.event(s.EventName.UI_REMOVE_STAGE),this._ui=null),l.E.ins.off(s.EventName.PAYChanged,this,this.checkPay)},t.prototype.onOpResult=function(t){t.opresult&&t.msgidx==r.enumOpResultType.activity_nextDay&&(this._state=0,this._ctrler&&(this._ctrler.stop(),this._ctrler=null),c.GameState.index_first_recharge_state=0,Laya.timer.clearAll(this),Laya.timer.frameOnce(2,this,this.run))},t.prototype.setUI=function(t){t.visible=window.enabledpay,this._ui=t,this._ui.once(s.EventName.ON_UI_DESTROYED,this,this.doDestroy),this._state=0,this.checkPay()},t.prototype.run=function(){if(window.enabledpay||(this._state=2),this._ui.parent&&(this._parent=this._ui.parent),h.RoleCenter.instans.vo.getActivityData()){if(this._ctrler,0==this._state)(t=h.RoleCenter.instans.vo.getFirstRechargeActivityData())&&t.cfgId==u.ActivityCtrl.FIRST_RECHARGE_ACTIVITY_ID_NEW?this._ctrler=new p.FirstRechargeBtnNewCtrl:this._ctrler=new i.FirstRechargeBtnCtrl,c.GameState.index_first_recharge_state=1;else if(1==this._state){var t;(t=h.RoleCenter.instans.vo.getFirstRechargeActivityData())&&t.cfgId==u.ActivityCtrl.FIRST_RECHARGE_ACTIVITY_ID_NEW?this._ctrler=new d.DayRechargeBtnNewCtrl:this._ctrler=new n.DayRechargeBtnCtrl,c.GameState.index_first_recharge_state=2}else 2==this._state&&this.doStop();this._ctrler&&this._ctrler.run(this._ui,new Laya.Handler(this,this.toNextState),this._parent)}else l.E.ins.once(s.EventName.ACTIVITY_DATA_INITED,this,this.run)},t.prototype.toNextState=function(){this._ctrler&&(this._ctrler.stop(),this._ctrler=null),this._state++,this.run()},t.prototype.doStop=function(){c.GameState.index_first_recharge_state=0,Laya.timer.clearAll(this),this._ctrler&&(this._ctrler.stop(),this._ctrler=null),this._ui&&this._ui.parent&&(this._ui.removeSelf(),this._ui.event(s.EventName.UI_REMOVE_STAGE)),l.E.ins.off(s.EventName.PAYChanged,this,this.checkPay)},t.prototype.checkPay=function(){this._ui&&(this._ui.visible=window.enabledpay),window.enabledpay&&Laya.timer.frameOnce(2,this,this.run)},t}();e.IndexFirstRechargeBtnCtrl=g}),define("src/g/proxy/uictrl/firstrechargebtn/IndexFirstRechargePromptCtrl",["require","exports","src/g/accessctrl/AccessCenter","../../../../manager/RoleCenter","../../../../core/E","../../../../enum/EventName","src/g/fight/osprite/SceneObjCtroller","src/init/Switches","../../../../utils/SoundUtils","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(){s.E.ins.on(o.EventName.PAYChanged,this,this.checkPay)}return t.prototype.checkPay=function(){window.enabledpay&&Laya.timer.frameOnce(2,this,this.run)},t.prototype.doDestroy=function(){Laya.timer.clearAll(this),i.AccessCenter.ins.off(13,this,this.onAccessChangedHandler),s.E.ins.off(o.EventName.ADDED_LEVEL,this,this.onLevelChanged),s.E.ins.off(o.EventName.ROLE_HP_CHANGE,this,this.onHpChange),s.E.ins.off(o.EventName.PAYChanged,this,this.checkPay),this._ui&&(this.closePrompt(),this._ui=null),this._parent=null,s.E.ins.off(o.EventName.PAYChanged,this,this.checkPay)},t.prototype.setUI=function(t){t.visible=window.enabledpay,this._ui=t,this._ui.once(o.EventName.ON_UI_DESTROYED,this,this.doDestroy),this.checkPay()},t.prototype.run=function(){n.RoleCenter.instans.vo.getActivityData()?(this._parent=this._ui.parent,this._ui.removeSelf(),this._ui.on(Laya.Event.CLICK,this,this.onBtnClickHandler),this.checkAndRun()):s.E.ins.once(o.EventName.ACTIVITY_DATA_INITED,this,this.run)},t.prototype.onBtnClickHandler=function(){l.SoundUtils.getInstance().playBtnsounds(),r.Switches.ins.event(13)},t.prototype.checkAndRun=function(t){void 0===t&&(t=!1),n.RoleCenter.instans.vo.vipData.isFirstCharge?(i.AccessCenter.ins.off(13,this,this.onAccessChangedHandler),s.E.ins.off(o.EventName.ADDED_LEVEL,this,this.onLevelChanged),s.E.ins.off(o.EventName.ROLE_HP_CHANGE,this,this.onHpChange),this.closePrompt(),this._ui&&h.ClearResM.clearUrl(this._ui.skin),this._ui=null,this._parent=null):i.AccessCenter.ins.checkOpen(13)?n.RoleCenter.instans.vo.getCurLv()<28?s.E.ins.on(o.EventName.ADDED_LEVEL,this,this.onLevelChanged):(s.E.ins.on(o.EventName.ROLE_HP_CHANGE,this,this.onHpChange),this.popPrompt(t)):i.AccessCenter.ins.on(13,this,this.onAccessChangedHandler)},t.prototype.popPrompt=function(t){void 0===t&&(t=!1),this._ui.parent||this._parent&&(window.oldversion?(this._ui.skin="res/unpack/zhujiemian_shouchongtishi_old.png",this._ui.x=83,this._ui.y=-56):this._ui.skin="res/unpack/zhujiemian_shouchongtishi.png",this._ui.visible=!0,this._ui.alpha=1,this._parent.addChild(this._ui),r.Switches.ins.on(13,this,this.closePrompt),t||Laya.timer.once(1e4,this,this.onCloseFChargePrompt))},t.prototype.closePrompt=function(){r.Switches.ins.off(13,this,this.closePrompt),Laya.timer.clearAll(this),Laya.Tween.clearAll(this._ui),this._ui.off(Laya.Event.CLICK,this,this.onBtnClickHandler),this._ui.removeSelf(),s.E.ins.off(o.EventName.PAYChanged,this,this.checkPay)},t.prototype.onCloseFChargePrompt=function(){Laya.Tween.to(this._ui,{alpha:0},1500,Laya.Ease.linearIn,new Laya.Handler(this,this.closePrompt))},t.prototype.onHpChange=function(){var t=a.SceneObjCtroller.ins.getSelfGroup();t&&(t.getPercentCountHp()<=0&&(n.RoleCenter.instans.vo.vipData.isFirstCharge||this.checkAndRun()))},t.prototype.onLevelChanged=function(){28<=n.RoleCenter.instans.vo.getCurLv()&&(s.E.ins.off(o.EventName.ADDED_LEVEL,this,this.onLevelChanged),this.checkAndRun(!0))},t.prototype.onAccessChangedHandler=function(t){t&&(i.AccessCenter.ins.off(13,this,this.onAccessChangedHandler),this.checkAndRun())},t}();e.IndexFirstRechargePromptCtrl=c}),define("src/g/proxy/uictrl/ringbtn/Vip3RingBtnCtrl",["require","exports","src/g/accessctrl/AccessCenter","../../../../enum/EventName","src/init/Switches","../../../../manager/RoleCenter","../../../../core/E","../../../../utils/SoundUtils"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){}return t.prototype.checkCurrentState=function(){if(i.AccessCenter.ins.checkOpen(14)){this._state=1;var t=window.oldversion?3:5;o.RoleCenter.instans.vo.vipRewardIsGet(t)?this._state=2:a.E.ins.once(n.EventName.VIP_GET_BONS_STATE_CHANGED,this,this.onVipGetBons)}else i.AccessCenter.ins.on(14,this,this.onAccessChangedHandler),this._state=0;this.updateUI()},t.prototype.onVipGetBons=function(){this.checkCurrentState()},t.prototype.updateUI=function(){0==this._state?this._ui.parent&&(this._ui.removeSelf(),this._ui.event(n.EventName.UI_REMOVE_STAGE)):1==this._state?(this._ui instanceof Laya.Image&&(this._ui.skin="res/indexicon/Xzjm_tubiao_021.png"),this._ui.on(Laya.Event.CLICK,this,this.onBtnClickHandler),this._parent&&(this._parent.addChild(this._ui),this._ui.event(n.EventName.UI_ADD_TO_STAGE))):2==this._state&&(this._ui.parent||this._parent&&(this._parent.addChild(this._ui),this._ui.event(n.EventName.UI_ADD_TO_STAGE)),this._backHandler&&this._backHandler.run())},t.prototype.onBtnClickHandler=function(){r.SoundUtils.getInstance().playBtnsounds(),s.Switches.ins.event(14)},t.prototype.onAccessChangedHandler=function(t){t&&(i.AccessCenter.ins.off(14,this,this.onAccessChangedHandler),this.checkCurrentState())},t.prototype.run=function(t,e){this._ui=t,this._backHandler=e,this._parent=this._ui.parent,this.checkCurrentState()},t.prototype.stop=function(){i.AccessCenter.ins.off(14,this,this.onAccessChangedHandler),this._ui.off(Laya.Event.CLICK,this,this.onBtnClickHandler),this._ui=null,this._parent=null,this._backHandler=null},t.prototype.refreshUI=function(){},t}();e.Vip3RingBtnCtrl=l}),define("src/g/proxy/uictrl/ringbtn/Vip4RingBtnCtrl",["require","exports","src/g/accessctrl/AccessCenter","src/init/Switches","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../core/E","../../../../utils/SoundUtils"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){}return t.prototype.checkCurrentState=function(){if(i.AccessCenter.ins.checkOpen(14)){this._state=1;var t=window.oldversion?4:6;o.RoleCenter.instans.vo.vipRewardIsGet(t)?this._state=2:a.E.ins.once(s.EventName.VIP_GET_BONS_STATE_CHANGED,this,this.onVipGetBons)}else i.AccessCenter.ins.on(14,this,this.onAccessChangedHandler),this._state=0;this.updateUI()},t.prototype.onVipGetBons=function(){this.checkCurrentState()},t.prototype.updateUI=function(){0==this._state?this._ui.parent&&(this._ui.removeSelf(),this._ui.event(s.EventName.UI_REMOVE_STAGE)):1==this._state?(this._ui instanceof Laya.Image&&(this._ui.skin="res/indexicon/Xzjm_tubiao_020.png"),this._ui.on(Laya.Event.CLICK,this,this.onBtnClickHandler),this._parent&&(this._parent.addChild(this._ui),this._ui.event(s.EventName.UI_ADD_TO_STAGE))):2==this._state&&(this._ui.parent||this._parent&&(this._parent.addChild(this._ui),this._ui.event(s.EventName.UI_ADD_TO_STAGE)),this._backHandler&&this._backHandler.run())},t.prototype.onBtnClickHandler=function(){r.SoundUtils.getInstance().playBtnsounds(),n.Switches.ins.event(145)},t.prototype.onAccessChangedHandler=function(t){t&&(i.AccessCenter.ins.off(14,this,this.onAccessChangedHandler),this.checkCurrentState())},t.prototype.run=function(t,e){this._ui=t,this._backHandler=e,this._parent=this._ui.parent,this.checkCurrentState()},t.prototype.stop=function(){i.AccessCenter.ins.off(14,this,this.onAccessChangedHandler),this._ui.off(Laya.Event.CLICK,this,this.onBtnClickHandler),this._ui=null,this._parent=null,this._backHandler=null},t.prototype.refreshUI=function(){},t}();e.Vip4RingBtnCtrl=l}),define("src/g/proxy/uictrl/ringbtn/IndexRingBtnCtrl",["require","exports","../../../../enum/EventName","src/g/proxy/uictrl/ringbtn/Vip3RingBtnCtrl","src/g/proxy/uictrl/ringbtn/Vip4RingBtnCtrl","../../../../core/E"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){this._state=0,o.E.ins.on(i.EventName.PAYChanged,this,this.checkPay)}return t.prototype.doDestroy=function(){Laya.timer.clearAll(this),this._ctrler&&(this._ctrler.stop(),this._ctrler=null),this._ui&&(this._ui.removeSelf(),this._ui.event(i.EventName.UI_REMOVE_STAGE),this._ui=null),o.E.ins.off(i.EventName.PAYChanged,this,this.checkPay)},t.prototype.checkPay=function(){this._ui&&(this._ui.visible=window.enabledpay),window.enabledpay&&Laya.timer.frameOnce(2,this,this.run)},t.prototype.setUI=function(t){this._ui=t,this._ui.once(i.EventName.ON_UI_DESTROYED,this,this.doDestroy),this._state=0,this.checkPay()},t.prototype.run=function(){window.enabledpay||(this._state=2),this._ctrler,0==this._state?this._ctrler=new n.Vip3RingBtnCtrl:1==this._state?this._ctrler=new s.Vip4RingBtnCtrl:2==this._state&&this.doDestroy(),this._ctrler&&this._ctrler.run(this._ui,new Laya.Handler(this,this.toNextState))},t.prototype.toNextState=function(){this._ctrler&&(this._ctrler.stop(),this._ctrler=null),this._state++,this.run()},t}();e.IndexRingBtnCtrl=a}),define("src/g/proxy/uictrl/ringbtn/IndexVip3RingPromptCtrl",["require","exports","src/g/accessctrl/AccessCenter","../../../../enum/EventName","src/init/Switches","../../../../manager/RoleCenter","../../../../utils/SoundUtils","src/g/clearRes/ClearResM","../../../../core/E"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function t(){l.E.ins.on(n.EventName.PAYChanged,this,this.checkPay)}return t.prototype.doDestroy=function(){Laya.timer.clearAll(this),i.AccessCenter.ins.off(14,this,this.onAccessChangedHandler),this._ui&&(this.closePrompt(),r.ClearResM.clearUrl(this._ui.skin),this._ui=null),this._parent=null,l.E.ins.off(n.EventName.PAYChanged,this,this.checkPay)},t.prototype.setUI=function(t){this._ui=t,this._ui.once(n.EventName.ON_UI_DESTROYED,this,this.doDestroy),this.checkPay()},t.prototype.checkPay=function(){window.enabledpay&&Laya.timer.frameOnce(2,this,this.run)},t.prototype.run=function(){this._parent=this._ui.parent,this._ui.removeSelf(),this._ui.on(Laya.Event.CLICK,this,this.onBtnClickHandler),this.checkAndRun()},t.prototype.onBtnClickHandler=function(){a.SoundUtils.getInstance().playBtnsounds(),s.Switches.ins.event(14)},t.prototype.checkAndRun=function(){window.enabledpay?i.AccessCenter.ins.checkOpen(14)?this.doDestroy():i.AccessCenter.ins.on(14,this,this.onAccessChangedHandler):this.doDestroy()},t.prototype.popPrompt=function(){this._ui.parent||this._parent&&(this._ui.skin="res/unpack/zhujiemian_guanggaotishi2.png",this._ui.visible=!0,this._ui.alpha=1,this._parent.addChild(this._ui),s.Switches.ins.on(14,this,this.closePrompt),Laya.timer.once(1e4,this,this.onCloseFChargePrompt))},t.prototype.closePrompt=function(){s.Switches.ins.off(14,this,this.closePrompt),Laya.timer.clearAll(this),Laya.Tween.clearAll(this._ui),this._ui.off(Laya.Event.CLICK,this,this.onBtnClickHandler),this._ui.removeSelf(),l.E.ins.off(n.EventName.PAYChanged,this,this.checkPay)},t.prototype.onCloseFChargePrompt=function(){Laya.Tween.to(this._ui,{alpha:0},1500,Laya.Ease.linearIn,new Laya.Handler(this,this.closePrompt))},t.prototype.onAccessChangedHandler=function(t){t&&(i.AccessCenter.ins.off(14,this,this.onAccessChangedHandler),o.RoleCenter.instans.vo.vipRewardIsGet(3)?this.doDestroy():this.popPrompt())},t}();e.IndexVip3RingPromptCtrl=h}),define("src/g/proxy/uictrl/ringbtn/IndexHeroPromptCtrl",["require","exports","src/g/accessctrl/AccessCenter","src/init/Switches","../../../../manager/RoleCenter","../../../../utils/SoundUtils","../../../../enum/EventName","src/g/clearRes/ClearResM","../../../../vo/RedDot/RedDot_Friend","../../../../manager/NewRedHintsCenter","../../../../core/E"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){this._setLesi=!1}return t.prototype.doDestroy=function(){Laya.timer.clearAll(this),i.AccessCenter.ins.off(15,this,this.onAccessChangedHandler),this._ui&&(this.closePrompt(),r.ClearResM.clearUrl(this._ui.skin),this._ui=null),this._parent=null},t.prototype.checkPay=function(){},t.prototype.setUI=function(t){this._ui=t,this._ui.once(a.EventName.ON_UI_DESTROYED,this,this.doDestroy),Laya.timer.frameOnce(2,this,this.run)},t.prototype.run=function(){var t=s.RoleCenter.instans.vo.heronum,e=s.RoleCenter.instans.vo.lvl;this._parent=this._ui.parent,this._ui.removeSelf(),this._ui.on(Laya.Event.CLICK,this,this.onBtnClickHandler),15<=e&&t<3&&this.checkAndRun(),c.E.ins.on(a.EventName.BATTLE_FAILED,this,this.checkAndRun)},t.prototype.onBtnClickHandler=function(){o.SoundUtils.getInstance().playBtnsounds(),n.Switches.ins.event(15)},t.prototype.checkAndRun=function(){this._setLesi||(this._setLesi=!0,h.NewRedHintsCenter.ins.on(h.NewRedHintsCenter.RED_HINT_VALUE_CHANGED,this,this.onFriendRedChange)),this.popPrompt()},t.prototype.onFriendRedChange=function(t){t==h.enumRedHints.friend&&this.checkAndRun()},t.prototype.popPrompt=function(){if(this._ui.parent){t=s.RoleCenter.instans.vo.heronum;this._ui.skin="res/unpack/"+(1==t?"zhujiemian_guanggaotishi1":"zhujiemian_guanggaotishiVIP4")+".png",this._ui.visible=!0,this._ui.alpha=1,Laya.timer.once(1e4,this,this.onCloseFChargePrompt)}else if(this._parent){var t=s.RoleCenter.instans.vo.heronum;this._ui.skin="res/unpack/"+(1==t?"zhujiemian_guanggaotishi1":"zhujiemian_guanggaotishiVIP4")+".png",this._ui.visible=!0,this._ui.alpha=1,this._parent.addChild(this._ui),n.Switches.ins.on(15,this,this.closePrompt),Laya.timer.once(1e4,this,this.onCloseFChargePrompt)}},t.prototype.closePrompt=function(){n.Switches.ins.off(15,this,this.closePrompt),Laya.timer.clearAll(this),Laya.Tween.clearAll(this._ui),this._ui.off(Laya.Event.CLICK,this,this.onBtnClickHandler),this._ui.removeSelf()},t.prototype.onCloseFChargePrompt=function(){Laya.Tween.to(this._ui,{alpha:0},1500,Laya.Ease.linearIn,new Laya.Handler(this,this.closePrompt))},t.prototype.onAccessChangedHandler=function(t){t&&(l.RedDot_Friend.Ins.red_all?this.popPrompt():this.doDestroy())},t}();e.IndexHeroPromptCtrl=u}),define("src/g/proxy/uictrl/dailybtn/IndexDailyTaskBtnPromptCtrl",["require","exports","src/g/accessctrl/AccessCenter","../../../../core/E","../../../../enum/EventName","../../../../manager/RoleCenter","src/g/fight/osprite/SceneObjCtroller","src/init/Switches"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){}return t.prototype.doDestroy=function(){Laya.timer.clearAll(this),i.AccessCenter.ins.off(18,this,this.onAccessChangedHandler),n.E.ins.off(s.EventName.ADDED_LEVEL,this,this.onLevelChanged),n.E.ins.off(s.EventName.ROLE_HP_CHANGE,this,this.onHpChange),this._ui&&(this.closePrompt(),this._ui=null),this._parent=null},t.prototype.checkPay=function(){},t.prototype.setUI=function(t){this._ui=t,this._ui.once(s.EventName.ON_UI_DESTROYED,this,this.doDestroy),Laya.timer.frameOnce(2,this,this.run)},t.prototype.run=function(){this._parent=this._ui.parent,this._ui.removeSelf(),this.checkAndRun()},t.prototype.checkAndRun=function(){80<o.RoleCenter.instans.vo.getCurLv()?(i.AccessCenter.ins.off(18,this,this.onAccessChangedHandler),n.E.ins.off(s.EventName.ADDED_LEVEL,this,this.onLevelChanged),n.E.ins.off(s.EventName.ROLE_HP_CHANGE,this,this.onHpChange),this.closePrompt(),this._ui=null,this._parent=null):i.AccessCenter.ins.checkOpen(18)?o.RoleCenter.instans.vo.getCurLv()<70?n.E.ins.on(s.EventName.ADDED_LEVEL,this,this.onLevelChanged):n.E.ins.on(s.EventName.ROLE_HP_CHANGE,this,this.onHpChange):i.AccessCenter.ins.on(18,this,this.onAccessChangedHandler)},t.prototype.popPrompt=function(){this._ui.parent||this._parent&&(this._ui.visible=!0,this._ui.alpha=1,this._ui.getChildAt(0).skin="res/unpack/tishi_diban.png",this._ui.getChildAt(1).skin="res/unpack/tishi_jiantou.png",this._ui.getChildAt(2).skin="res/unpack/tishi_wenzi_001.png",this._parent.addChild(this._ui),r.Switches.ins.on(18,this,this.closePrompt),Laya.timer.once(1e4,this,this.onCloseFChargePrompt))},t.prototype.closePrompt=function(){r.Switches.ins.off(18,this,this.closePrompt),Laya.timer.clearAll(this),Laya.Tween.clearAll(this._ui),this._ui.removeSelf()},t.prototype.onCloseFChargePrompt=function(){Laya.Tween.to(this._ui,{alpha:0},1500,Laya.Ease.linearIn,new Laya.Handler(this,this.closePrompt))},t.prototype.onHpChange=function(){var t=a.SceneObjCtroller.ins.getSelfGroup();t&&(t.getPercentCountHp()<=0&&this.popPrompt())},t.prototype.onLevelChanged=function(){70<=o.RoleCenter.instans.vo.getCurLv()&&(n.E.ins.off(s.EventName.ADDED_LEVEL,this,this.onLevelChanged),this.checkAndRun())},t.prototype.onAccessChangedHandler=function(t){t&&(i.AccessCenter.ins.off(18,this,this.onAccessChangedHandler),this.checkAndRun())},t}();e.IndexDailyTaskBtnPromptCtrl=l}),define("src/g/proxy/uictrl/yueka/MonthBtnCtrl",["require","exports","src/g/accessctrl/AccessCenter","../../../../manager/RoleCenter","../../../../utils/system/ServerTime","../../../../core/E","../../../../enum/EventName","../../../../utils/SoundUtils","src/init/Switches"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function t(){}return t.prototype.checkCurrentState=function(){i.AccessCenter.ins.checkOpen(12)?(this._state=1,n.RoleCenter.instans.vo.monthCardEndTime>s.ServerTime.serverTime?this._state=2:o.E.ins.once(a.EventName.MONTH_CARD_END_TIME_CHANGED,this,this.checkCurrentState)):(i.AccessCenter.ins.on(12,this,this.onAccessChangedHandler),this._state=0),this.updateUI()},t.prototype.updateUI=function(){0==this._state?this._ui.parent&&(this._ui.removeSelf(),this._ui.event(a.EventName.UI_REMOVE_STAGE)):1==this._state?(this._ui instanceof Laya.Image&&(this._ui.skin="res/indexicon/Xzjm_tubiao_017.png"),this._ui.on(Laya.Event.CLICK,this,this.onBtnClickHandler),this._parent&&(this._parent.addChild(this._ui),this._ui.event(a.EventName.UI_ADD_TO_STAGE))):2==this._state&&(this._ui.parent||this._parent&&(this._parent.addChild(this._ui),this._ui.event(a.EventName.UI_ADD_TO_STAGE)),this._backHandler&&this._backHandler.run())},t.prototype.onBtnClickHandler=function(){r.SoundUtils.getInstance().playBtnsounds(),l.Switches.ins.event(12)},t.prototype.onAccessChangedHandler=function(t){t&&(i.AccessCenter.ins.off(12,this,this.onAccessChangedHandler),this.checkCurrentState())},t.prototype.run=function(t,e){this._ui=t,this._backHandler=e,this._parent=this._ui.parent,this.checkCurrentState()},t.prototype.stop=function(){i.AccessCenter.ins.off(12,this,this.onAccessChangedHandler),o.E.ins.off(a.EventName.MONTH_CARD_END_TIME_CHANGED,this,this.checkCurrentState),this._ui.off(Laya.Event.CLICK,this,this.onBtnClickHandler),this._ui=null,this._parent=null,this._backHandler=null},t.prototype.refreshUI=function(){},t}();e.MonthBtnCtrl=h}),define("src/g/proxy/uictrl/yueka/SuperMonthBtnCtrl",["require","exports","src/g/accessctrl/AccessCenter","../../../../manager/RoleCenter","../../../../utils/system/ServerTime","../../../../core/E","../../../../enum/EventName","../../../../utils/SoundUtils","src/init/Switches"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function t(){}return t.prototype.checkCurrentState=function(){i.AccessCenter.ins.checkOpen(122)?(this._state=1,n.RoleCenter.instans.vo.superMonthCardEndTime>s.ServerTime.serverTime?this._state=2:o.E.ins.once(a.EventName.SUPER_MONTH_CARD_END_TIME_CHANGE,this,this.checkCurrentState)):(i.AccessCenter.ins.on(122,this,this.onAccessChangedHandler),this._state=0),this.updateUI()},t.prototype.updateUI=function(){0==this._state?this._ui.parent&&(this._ui.removeSelf(),this._ui.event(a.EventName.UI_REMOVE_STAGE)):1==this._state?(this._ui instanceof Laya.Image&&(this._ui.skin="res/indexicon/Xzjm_tubiao_018.png"),this._ui.on(Laya.Event.CLICK,this,this.onBtnClickHandler),this._parent&&(this._parent.addChild(this._ui),this._ui.event(a.EventName.UI_ADD_TO_STAGE))):2==this._state&&(this._ui.parent||this._parent&&(this._parent.addChild(this._ui),this._ui.event(a.EventName.UI_ADD_TO_STAGE)),this._backHandler&&this._backHandler.run())},t.prototype.onBtnClickHandler=function(){r.SoundUtils.getInstance().playBtnsounds(),l.Switches.ins.event(122)},t.prototype.onAccessChangedHandler=function(t){t&&(i.AccessCenter.ins.off(122,this,this.onAccessChangedHandler),this.checkCurrentState())},t.prototype.run=function(t,e){this._ui=t,this._backHandler=e,this._parent=this._ui.parent,this.checkCurrentState()},t.prototype.stop=function(){i.AccessCenter.ins.off(122,this,this.onAccessChangedHandler),o.E.ins.off(a.EventName.SUPER_MONTH_CARD_END_TIME_CHANGE,this,this.checkCurrentState),this._ui.off(Laya.Event.CLICK,this,this.onBtnClickHandler),this._ui=null,this._parent=null,this._backHandler=null},t.prototype.refreshUI=function(){},t}();e.SuperMonthBtnCtrl=h}),define("src/g/proxy/uictrl/yueka/IndexYuekaBtnCtrl",["require","exports","../../../../enum/EventName","src/g/proxy/uictrl/yueka/MonthBtnCtrl","src/g/proxy/uictrl/yueka/SuperMonthBtnCtrl","../../../../core/E"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){this._state=0,o.E.ins.on(i.EventName.PAYChanged,this,this.checkPay)}return t.prototype.doDestroy=function(){Laya.timer.clearAll(this),this._ctrler&&(this._ctrler.stop(),this._ctrler=null),this._ui&&(this._ui.removeSelf(),this._ui.event(i.EventName.UI_REMOVE_STAGE),this._ui=null),o.E.ins.off(i.EventName.PAYChanged,this,this.checkPay)},t.prototype.checkPay=function(){this._ui&&(this._ui.visible=window.enabledpay),window.enabledpay&&Laya.timer.frameOnce(2,this,this.run)},t.prototype.setUI=function(t){this._ui=t,this._ui.once(i.EventName.ON_UI_DESTROYED,this,this.doDestroy),this._state=0,this.checkPay()},t.prototype.run=function(){this._ctrler,0==this._state?this._ctrler=new n.MonthBtnCtrl:1==this._state?this._ctrler=new s.SuperMonthBtnCtrl:2==this._state&&this.doDestroy(),this._ctrler&&this._ctrler.run(this._ui,new Laya.Handler(this,this.toNextState))},t.prototype.toNextState=function(){this._ctrler&&(this._ctrler.stop(),this._ctrler=null),this._state++,this.run()},t}();e.IndexYuekaBtnCtrl=a}),define("src/g/proxy/uictrl/firstrechargebtn/DayRechargePromptCtrl",["require","exports","src/g/accessctrl/AccessCenter","../../../../enum/EventName","../../../../core/E","../../../../manager/RoleCenter","../../../../utils/SoundUtils","src/init/Switches","../../../net/messages/enumStatus","../../../../utils/system/DateUitl","../../../../config/GameConfig","../../../../utils/system/ServerTime"],function(t,e,l,h,c,u,i,n,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this._state=0,c.E.ins.on(h.EventName.PAYChanged,this,this.checkPay)}return t.prototype.doDestroy=function(){Laya.timer.clearAll(this),l.AccessCenter.ins.off(111,this,this.onAccessChangedHandler),this._ui&&(this.closePrompt(),this._ui=null),this._parent=null,c.E.ins.off(h.EventName.PAYChanged,this,this.checkPay)},t.prototype.checkPay=function(){window.enabledpay&&Laya.timer.frameOnce(2,this,this.run)},t.prototype.setUI=function(t){t.visible=window.enabledpay,this._ui=t,this._ui.once(h.EventName.ON_UI_DESTROYED,this,this.doDestroy),this.checkPay()},t.prototype.run=function(){u.RoleCenter.instans.vo.getActivityData()?(this._parent=this._ui.parent,this._ui.removeSelf(),this._ui.on(Laya.Event.CLICK,this,this.onBtnClickHandler),this.checkAndRun(),c.E.ins.off(h.EventName.PAYChanged,this,this.checkPay)):c.E.ins.once(h.EventName.ACTIVITY_DATA_INITED,this,this.run)},t.prototype.onBtnClickHandler=function(){i.SoundUtils.getInstance().playBtnsounds(),n.Switches.ins.event(111)},t.prototype.checkAndRun=function(t){if(void 0===t&&(t=!1),0==this._state)c.E.ins.off(h.EventName.FIRST_RECHARGE_SUCCESS,this,this.checkAndRun),u.RoleCenter.instans.vo.vipData.isFirstCharge?(this._state=1,this.checkAndRun()):c.E.ins.once(h.EventName.FIRST_RECHARGE_SUCCESS,this,this.checkAndRun);else if(1==this._state){c.E.ins.off(h.EventName.ACTIVITY_DATA_CHANGED,this,this.checkAndRun),(e=u.RoleCenter.instans.vo.getFirstRechargeActivityData())&&e.children[0].status!=p.enumStatus.yilingqu?c.E.ins.once(h.EventName.ACTIVITY_DATA_CHANGED,this,this.checkAndRun):(this._state=2,this.checkAndRun())}else if(2==this._state)l.AccessCenter.ins.off(111,this,this.onAccessChangedHandler),l.AccessCenter.ins.checkOpen(111)?(this._state=3,this.checkAndRun()):l.AccessCenter.ins.on(111,this,this.checkAndRun);else if(3==this._state){var e,i=!0;if(e=u.RoleCenter.instans.vo.getDayRechargeActivityData()){for(var n,s=v.ServerTime.isHF?d.DateUtil.getHFDay(v.ServerTime.ACTIVITY_TIME_OFFSET):d.DateUtil.getKFDay(v.ServerTime.ACTIVITY_TIME_OFFSET),o=e.children.length,a=0,r=0;a<o;)(n=g.GameConfig.subActivityJson[e.children[a].cfgId])&&r<n.value&&(r=n.value),a++;for(0==(s%=r)&&(s=r),o=e.children.length,a=0;a<o;){if((n=g.GameConfig.subActivityJson[e.children[a].cfgId])&&n.value==s&&e.children[a].status!=p.enumStatus.yilingqu){i=!1;break}a++}}0==i?this.popPrompt():(this._state=4,this.checkAndRun())}else 4==this._state&&this.doDestroy()},t.prototype.popPrompt=function(t){void 0===t&&(t=!1),this._ui.parent||this._parent&&(this._ui.skin="res/unpack/zhujiemian_cjzsdtanchu.png",this._ui.visible=!0,this._ui.alpha=1,this._parent.addChild(this._ui),n.Switches.ins.on(111,this,this.closePrompt),t||Laya.timer.once(5e3,this,this.onCloseFChargePrompt))},t.prototype.closePrompt=function(){n.Switches.ins.off(111,this,this.closePrompt),Laya.timer.clearAll(this),Laya.Tween.clearAll(this._ui),this._ui.off(Laya.Event.CLICK,this,this.onBtnClickHandler),this._ui.removeSelf()},t.prototype.onCloseFChargePrompt=function(){Laya.Tween.to(this._ui,{alpha:0},1500,Laya.Ease.linearIn,new Laya.Handler(this,this.closePrompt))},t.prototype.onAccessChangedHandler=function(t){t&&(l.AccessCenter.ins.off(111,this,this.onAccessChangedHandler),this.checkAndRun())},t}();e.DayRechargePromptCtrl=s}),define("src/g/proxy/uictrl/firstrechargebtn/CombineFirstRechargeBtnCtrl",["require","exports","../../../../enum/EventName","../../../../manager/ActivityManager","src/g/accessctrl/AccessCenter","../../../../manager/RoleCenter","../../../../core/E","../../../../utils/SoundUtils","src/init/Switches","../../../net/messages/enumStatus"],function(t,e,n,i,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(){this.accessId=226,this.trigger="Recharge_First",this.banActivityCfgId=102,this._activityId=0,a.E.ins.on(n.EventName.PAYChanged,this,this.checkPay)}return t.prototype.checkPay=function(){window.enabledpay&&Laya.timer.frameOnce(2,this,this.init)},t.prototype.setUI=function(t){t.visible=window.enabledpay,this._btn=t,this.checkPay()},t.prototype.init=function(){this._btn&&(this._parent=this._btn.parent,this._btn.visible=!0,this._btn.once(n.EventName.ON_UI_DESTROYED,this,this.doDestroy),this.accessId&&!s.AccessCenter.ins.checkOpen(this.accessId)?(this._btn.parent&&(this._btn.removeSelf(),this._btn.event(n.EventName.UI_REMOVE_STAGE)),s.AccessCenter.ins.on(this.accessId,this,this.onActivityAccessUpdate)):this.doInit())},t.prototype.onActivityAccessUpdate=function(){s.AccessCenter.ins.checkOpen(this.accessId)&&(s.AccessCenter.ins.off(this.accessId,this,this.onActivityAccessUpdate),this.doInit())},t.prototype.doInit=function(){if(this.accessId&&this.trigger){if(this._btn.on(Laya.Event.CLICK,this,this.toOpenViewFun),this.actEntity=i.ActivityManager.ins.getActivityByTrigger(this.trigger,[this.banActivityCfgId]),this.actEntity){if(this.actEntity.on(i.ActivityEntity.ACTIVITY_ENTITY_CHANGED,this,this.updateBtnShow),this.actEntity.on(i.ActivityEntity.ACTIVITY_ENTITY_DESTROY,this,this.doDestroy),this._btn.getChildByName("img_red")){var t=o.RoleCenter.instans.vo.getActivity1Data(this.actEntity.id);t&&(this._btn.getChildByName("img_red").visible=t.hasRed,a.E.ins.on(n.EventName.ACTIVITY_RED_UPDATE,this,this.onActivityRedUpdata))}}else a.E.ins.on(n.EventName.ACTIVITY_DATA_ADDED,this,this.onActivityAdded);this.updateBtnShow()}else this.doDestroy()},t.prototype.onActivityAdded=function(t,e,i){i==this.trigger&&t!=this.banActivityCfgId&&(a.E.ins.off(n.EventName.ACTIVITY_DATA_ADDED,this,this.onActivityAdded),Laya.timer.frameOnce(2,this,this.doInit))},t.prototype.onActivityRedUpdata=function(t){if(this.actEntity&&t==this.actEntity.id){var e=o.RoleCenter.instans.vo.getActivity1Data(t);e&&(this._btn.getChildByName("img_red").visible=e.hasRed)}},t.prototype.updateBtnShow=function(){a.E.ins.off(n.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),a.E.ins.off(n.EventName.FIRST_RECHARGE_SUCCESS,this,this.updateBtnShow);var t=!1;if(this.actEntity&&this.actEntity.isActive)if(t=!0,o.RoleCenter.instans.vo.vipData.isCombineFirst){var e=o.RoleCenter.instans.vo.getActivity1Data(this.actEntity.id);e&&e.children[0].status!=h.enumStatus.yilingqu?(this._activityId=e.id,a.E.ins.on(n.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged)):t=!1}else a.E.ins.once(n.EventName.FIRST_RECHARGE_SUCCESS,this,this.updateBtnShow);t?this._parent&&(this._parent.addChild(this._btn),this._btn.event(n.EventName.UI_ADD_TO_STAGE)):this._btn.parent&&(this._btn.removeSelf(),this._btn.event(n.EventName.UI_REMOVE_STAGE))},t.prototype.onActivityDataChanged=function(t,e){this._activityId==e&&(a.E.ins.off(n.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this.updateBtnShow())},t.prototype.toOpenViewFun=function(){r.SoundUtils.getInstance().playBtnsounds(),l.Switches.ins.event(this.accessId,[!0,!0,this.actEntity.id])},t.prototype.doDestroy=function(){a.E.ins.off(n.EventName.ACTIVITY_RED_UPDATE,this,this.onActivityRedUpdata),a.E.ins.off(n.EventName.FIRST_RECHARGE_SUCCESS,this,this.updateBtnShow),a.E.ins.off(n.EventName.ACTIVITY_DATA_CHANGED,this,this.onActivityDataChanged),this._btn.parent&&(this._btn.removeSelf(),this._btn.event(n.EventName.UI_REMOVE_STAGE)),this._btn.offAll(),this._btn=null,this._parent=null,this.accessId&&(s.AccessCenter.ins.off(this.accessId,this,this.onActivityAccessUpdate),this.accessId=0),this.actEntity&&(this.actEntity.off(i.ActivityEntity.ACTIVITY_ENTITY_CHANGED,this,this.updateBtnShow),this.actEntity.off(i.ActivityEntity.ACTIVITY_ENTITY_DESTROY,this,this.doDestroy),this.actEntity=null),a.E.ins.off(n.EventName.PAYChanged,this,this.checkPay)},t}();e.CombineFirstRechargeBtnCtrl=c}),define("src/g/proxy/UICtrlProxyFactory",["require","exports","src/g/proxy/uictrl/firstrechargebtn/IndexFirstRechargeBtnCtrl","src/g/proxy/uictrl/firstrechargebtn/IndexFirstRechargePromptCtrl","src/g/proxy/uictrl/ringbtn/IndexRingBtnCtrl","src/g/proxy/uictrl/ringbtn/IndexVip3RingPromptCtrl","src/g/proxy/uictrl/ringbtn/IndexHeroPromptCtrl","src/g/proxy/uictrl/dailybtn/IndexDailyTaskBtnPromptCtrl","src/g/proxy/uictrl/yueka/IndexYuekaBtnCtrl","src/g/proxy/uictrl/firstrechargebtn/DayRechargePromptCtrl","src/g/proxy/uictrl/firstrechargebtn/CombineFirstRechargeBtnCtrl"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){}return t.getProxy=function(t){switch(t){case 1:return new i.IndexFirstRechargeBtnCtrl;case 2:return new n.IndexFirstRechargePromptCtrl;case 3:return new s.IndexRingBtnCtrl;case 4:return new o.IndexVip3RingPromptCtrl;case 6:return new r.IndexDailyTaskBtnPromptCtrl;case 7:return new l.IndexYuekaBtnCtrl;case 8:return new h.DayRechargePromptCtrl;case 9:return new c.CombineFirstRechargeBtnCtrl;case 5:return new a.IndexHeroPromptCtrl}return null},t}();e.UICtrlProxyFactory=u}),define("src/g/proxy/compents/UIPosBindProxy",["require","exports","../../../enum/EventName","../../../manager/RunTimeUIManager","../../../utils/UIUtils"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this._offsetX=0,this._offsetY=0,this._bindAccessId=e,this._offsetX=i,this._offsetY=n,this.setUI(t),this.init()}return t.prototype.init=function(){this._bindUI=n.RunTimeUIManager.ins.getUI(this._bindAccessId),this._bindUI?(this.synchro(),this._bindUI.on(i.EventName.UI_MOVED,this,this.synchro)):n.RunTimeUIManager.ins.on(n.RunTimeUIManager.ON_REGISTER_UI,this,this.onUIRegisHandler)},t.prototype.onUIRegisHandler=function(t){this._bindAccessId==t&&(n.RunTimeUIManager.ins.off(n.RunTimeUIManager.ON_REGISTER_UI,this,this.onUIRegisHandler),this.init())},t.prototype.synchro=function(){if(this._ui.off(i.EventName.UI_ADD_TO_STAGE,this,this.synchro),this._ui.parent){var t=s.UIUtils.getGlobalPos(this._bindUI),e=s.UIUtils.getGlobalPos(this._ui.parent);this._ui.x=t.x-e.x+this._offsetX,this._ui.y=t.y-e.y+this._offsetY}else this._ui.on(i.EventName.UI_ADD_TO_STAGE,this,this.synchro)},t.prototype.setUI=function(t){this._ui=t,this._ui.once(i.EventName.ON_UI_DESTROYED,this,this.doDestroy)},t.prototype.doDestroy=function(){Laya.timer.clearAll(this),n.RunTimeUIManager.ins.off(n.RunTimeUIManager.ON_REGISTER_UI,this,this.onUIRegisHandler),this._ui&&(this._ui.off(i.EventName.UI_ADD_TO_STAGE,this,this.synchro),this._ui=null),this._bindUI&&(this._bindUI.off(i.EventName.UI_MOVED,this,this.synchro),this._bindUI=null)},t}();e.UIPosBindProxy=o}),define("src/g/proxy/compents/UIShowStateBindProxy",["require","exports","../../../enum/EventName","../../../manager/RunTimeUIManager"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){this._bindAccessId=e,this.setUI(t),this._ui.visible=!0,this.init()}return t.prototype.init=function(){this._bindUI=n.RunTimeUIManager.ins.getUI(this._bindAccessId),this._bindUI?(this.synchro(),this._bindUI.on(i.EventName.UI_REMOVE_STAGE,this,this.synchro),this._bindUI.on(i.EventName.UI_ADD_TO_STAGE,this,this.synchro)):(this._ui.parent&&(this._ui.removeSelf(),this._ui.event(i.EventName.UI_REMOVE_STAGE)),n.RunTimeUIManager.ins.on(n.RunTimeUIManager.ON_REGISTER_UI,this,this.onUIRegisHandler))},t.prototype.onUIRegisHandler=function(t){this._bindAccessId==t&&(n.RunTimeUIManager.ins.off(n.RunTimeUIManager.ON_REGISTER_UI,this,this.onUIRegisHandler),this.init())},t.prototype.synchro=function(){this._bindUI.visible&&this._bindUI.displayedInStage?this._parent&&this._ui.parent!=this._parent&&(this._parent.addChild(this._ui),this._ui.event(i.EventName.UI_ADD_TO_STAGE)):this._ui.parent&&(this._ui.removeSelf(),this._ui.event(i.EventName.UI_REMOVE_STAGE))},t.prototype.setUI=function(t){this._ui=t,this._parent=this._ui.parent,this._ui.once(i.EventName.ON_UI_DESTROYED,this,this.doDestroy)},t.prototype.doDestroy=function(){Laya.timer.clearAll(this),n.RunTimeUIManager.ins.off(n.RunTimeUIManager.ON_REGISTER_UI,this,this.onUIRegisHandler),this._ui&&(this._ui.removeSelf(),this._ui.event(i.EventName.UI_REMOVE_STAGE),this._ui=null),this._bindUI&&(this._bindUI.off(i.EventName.UI_REMOVE_STAGE,this,this.synchro),this._bindUI.off(i.EventName.UI_ADD_TO_STAGE,this,this.synchro),this._bindUI=null),this._parent=null},t}();e.UIShowStateBindProxy=s}),define("src/g/proxy/compents/XinShowCtrlProxy",["require","exports","src/g/accessctrl/AccessData","../../../enum/EventName","src/g/accessctrl/AccessCenter","../../../core/E","../../../utils/SoundUtils","src/init/Switches"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e,i){void 0===i&&(i=!1),this._accessId=e,this.setUI(t),this._ui.visible=!0,r.Switches.ins._payfilters[e]?this._ui.visible=window.enabledpay:this._ui.visible=!0,i&&this._ui.on(Laya.Event.CLICK,this,this.onBtnClickHandler),this.init()}return t.prototype.onBtnClickHandler=function(){a.SoundUtils.getInstance().playBtnsounds(),r.Switches.ins.event(this._accessId)},t.prototype.init=function(){s.AccessCenter.ins.inited?this.updateUI():o.E.ins.once(n.EventName.ACCESS_CENTER_INITED,this,this.init)},t.prototype.updateUI=function(){i.AccessData.checkOpen(this._accessId,!1)?this.doDestroy():s.AccessCenter.ins.on(this._accessId,this,this.accessOpenHandler)},t.prototype.accessOpenHandler=function(){i.AccessData.checkOpen(this._accessId,!1)&&(s.AccessCenter.ins.off(this._accessId,this,this.accessOpenHandler),this._parent&&this._ui.parent!=this._parent&&(this._parent.addChild(this._ui),this._ui.event(n.EventName.UI_ADD_TO_STAGE)),o.E.ins.on(n.EventName.ACCESS_INTO,this,this.intoHandler))},t.prototype.intoHandler=function(t){t==this._accessId&&this.doDestroy()},t.prototype.setUI=function(t){this._ui=t,this._parent=this._ui.parent,this._ui.parent&&(this._ui.removeSelf(),this._ui.event(n.EventName.UI_REMOVE_STAGE)),this._ui.once(n.EventName.ON_UI_DESTROYED,this,this.doDestroy)},t.prototype.doDestroy=function(){Laya.timer.clearAll(this),s.AccessCenter.ins.off(this._accessId,this,this.accessOpenHandler),o.E.ins.off(n.EventName.ACCESS_INTO,this,this.intoHandler),this._ui&&(this._ui.removeSelf(),this._ui.event(n.EventName.UI_REMOVE_STAGE),this._ui.offAll(),this._ui=null),this._parent=null},t}();e.XinShowCtrlProxy=l}),define("src/g/proxy/uictrl/access/AccessCtrlUIShowProxy",["require","exports","../../../../enum/EventName","src/g/accessctrl/AccessData","src/g/accessctrl/AccessCenter","../../../../core/E"],function(t,e,n,i,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function e(t,e,i){this._accessId=e,this._ctrlMode=i,this.setUI(t),s.AccessCenter.ins.on(this._accessId,this,this.updateUI),this.updateUI(),o.E.ins.once(n.EventName.PAYChanged,this,this.checkPay)}return e.prototype.updateUI=function(){this.doShow(i.AccessData.checkOpen(this._accessId,!1))},e.prototype.doShow=function(t){this._ui&&!this._ui.destroyed&&(window.enabledpay||e._payfilters[this._accessId]&&(t=!1),"visible"==this._ctrlMode?this._ui.visible!=t&&((this._ui.visible=t)?this._ui.event(n.EventName.UI_ADD_TO_STAGE):this._ui.event(n.EventName.UI_REMOVE_STAGE)):"disabled"==this._ctrlMode?this._ui.disabled=!t:"gray"==this._ctrlMode?this._ui.gray=!t:t?(this._ui.visible=!0,this._parent&&this._ui.parent!=this._parent&&(this._parent.addChild(this._ui),this._ui.event(n.EventName.UI_ADD_TO_STAGE))):this._ui.parent&&(this._ui.removeSelf(),this._ui.event(n.EventName.UI_REMOVE_STAGE)))},e.prototype.setUI=function(t){this._ui=t,this._parent=this._ui.parent,this._ui.once(n.EventName.ON_UI_DESTROYED,this,this.doDestroy)},e.prototype.doDestroy=function(){o.E.ins.off(n.EventName.PAYChanged,this,this.checkPay),Laya.timer.clearAll(this),s.AccessCenter.ins.off(this._accessId,this,this.updateUI),this._ui&&(this._ui.removeSelf(),this._ui.event(n.EventName.UI_REMOVE_STAGE),this._ui=null),this._parent=null},e.prototype.checkPay=function(){this.updateUI()},e._payfilters={166:!0},e}();e.AccessCtrlUIShowProxy=a}),define("src/g/proxy/uictrl/timelimittask/TimeLimitTaskBtnCtrlProxy",["require","exports","../../../../enum/EventName","../../../../manager/RoleCenter","../../../../core/E","src/init/Switches","../../../../utils/system/ServerTime","../../../../config/GameConfig","../../../../utils/system/DateUitl"],function(t,e,o,a,r,i,l,h,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e,i){this.type=0,this._btn=t,this._btn.visible=!0,this._btn&&(this._parent=this._btn.parent),this.accessId=e,this.type=i,this.init()}return t.prototype.init=function(){this._btn&&(this._lab_cd=this._btn.getChildByName("lab_cd"),this._btn.on(Laya.Event.CLICK,this,this.onOpHandler),this._btn.once(o.EventName.ON_UI_DESTROYED,this,this.doDestroy),this._btn.parent&&(this._btn.removeSelf(),this._btn.event(o.EventName.UI_REMOVE_STAGE)),this.doInit())},t.prototype.doDestroy=function(){this._btn.parent&&(this._btn.removeSelf(),this._btn.event(o.EventName.UI_REMOVE_STAGE)),this._btn.offAll(),this._btn=null,this._parent=null},t.prototype.onOpHandler=function(){this._tltd&&i.Switches.ins.event(this.accessId,this._tltd.id)},t.prototype.doInit=function(){if(a.RoleCenter.instans.vo.timeLimitTaskData)if(l.ServerTime.isInited){for(var t,e=a.RoleCenter.instans.vo.timeLimitTaskData,i=e.dataArr.length,n=0;n<i;){t=e.dataArr[n];var s=h.GameConfig.timeLimitTaskJson[t.id];if(s&&s.type==this.type&&t.endTime>l.ServerTime.serverTime){this.openTask(t);break}n++}r.E.ins.on(o.EventName.TIME_LIMIT_TASK_OPEN,this,this.onOpenHandler),r.E.ins.on(o.EventName.TIME_LIMIT_TASK_DELETE,this,this.onDelHandler)}else r.E.ins.once(o.EventName.SERVER_TIME_UPDATE,this,this.doInit);else r.E.ins.once(o.EventName.TIME_LIMIT_TASK_INITED,this,this.doInit)},t.prototype.openTask=function(t){t?(this._parent&&(this._parent.addChild(this._btn),this._btn.event(o.EventName.UI_ADD_TO_STAGE)),this._tltd=t,this.cooldownHandler()):console.log("开启任务为空")},t.prototype.cooldownHandler=function(){if(this._tltd&&this._lab_cd){var t=this._tltd.endTime-l.ServerTime.serverTime;86400<t?(this._lab_cd.changeText(n.DateUtil.remainingDHStr(t)),Laya.timer.once(1e3,this,this.cooldownHandler)):0<=t?(this._lab_cd.changeText(n.DateUtil.getHMS_countdown(t)),Laya.timer.once(1e3,this,this.cooldownHandler)):this._lab_cd.changeText("00:00:00")}},t.prototype.onOpenHandler=function(t){var e=h.GameConfig.timeLimitTaskJson[t];if(e&&e.type==this.type){this._tltd&&this.onDelHandler(this._tltd.id);var i=a.RoleCenter.instans.vo.timeLimitTaskData,n=i.idArr.indexOf(t);this.openTask(i.dataArr[n])}},t.prototype.onDelHandler=function(t){this._tltd&&this._tltd.id==t&&(this._btn.parent&&(this._btn.removeSelf(),this._btn.event(o.EventName.UI_REMOVE_STAGE)),this._tltd=null,Laya.timer.clearAll(this))},t}();e.TimeLimitTaskBtnCtrlProxy=s}),define("src/g/pvp1v1/view/CreateMinerView",["require","exports","../../../manager/LayerManager","../../../config/GameConfig","../../../utils/ItemUtils","../../../manager/MineIngManager","src/g/peronboss/view/ItemIconView","src/g/clearRes/ClearResM"],function(t,e,i,a,c,u,p,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(o){function t(){var t=o.call(this)||this;t.nowidx=0,t.movieAttr=0,t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t.list.selectHandler=new Laya.Handler(t,t.selectHandler);var e=a.GameConfig.Dart,i=[];for(var n in e){var s=e[n];i.push(s)}return t.list.array=i,t.imgSelected.visible=!1,t}return __extends(t,o),t.prototype.showView=function(){i.LayerManager.addInPOPWindowLayer(this,!1),n.ClearResM.resetViewImg(this)},t.prototype.renderHandler=function(t,e){t.item0.visible=!1,t.item1.visible=!1,t.item2.visible=!1;var i=this.list.array[e];t.text_noRob.visible=3==e,t.starBox.x=1==e?27:17;for(var n=0;n<i.reward.length+i.fixedReward.length&&n<u.MineIngManager.instance.maxRewardNum;n++){t["item"+n].visible=!0;var s=0,o=0,a=n;o=n<i.reward.length?(s=i.reward[n][0],i.reward[n][1]):(a=n-i.reward.length,s=i.fixedReward[a][0],i.fixedReward[a][1]);var r=c.ItemUtils.getItemOrEq(s);p.ItemIconView.setItemData(r,t["item"+n],o),t["item"+n].lvl.visible=!1}t.img_select.visible=e==this.nowidx,t.img_bg.skin="res/wakuang/"+i.res+".png";var l=e+1;t.image_headIcon.skin="res/wakuang/workimg_"+l+".png",t.colorground.skin="res/wakuang/bgcolor"+l+".png";var h=3==e?4:e;for(n=0;n<t.starBox.numChildren;n++)t.starBox.getChildAt(n).visible=n<=h},t.prototype.selectHandler=function(t){this.nowidx=t},t.prototype.setQulityIndex=function(t,e){this._index=t,e?(this.list.selectedIndex=-1,this.imgRandom.visible=!0,this.btn_enter.disabled=this.btn_update.disabled=!0,this.imgSelected.visible=!0,this.imgSelected.y=109,this.startMovie(12+t),this.movieAttr=0):this.onMovieComplete()},t.prototype.onMovieComplete=function(){this.imgRandom.visible=!1,this.list.selectedIndex=this._index,this.imgSelected.visible=!1,this.btn_enter.disabled=!1,this.btn_update.disabled=3==this._index},t.prototype.startMovie=function(t){var e=new Laya.Handler(this,this.onMovieComplete);this.tween=Laya.Tween.to(this,{movieAttr:t},3e3,Laya.Ease.quadInOut,e),this.tween.update=new Laya.Handler(this,this.onTweenUpd)},t.prototype.onTweenUpd=function(){var t=(this.movieAttr>>0)%4;this.imgSelected.y=130*t+109},t}(ui.pvp1v1.CreateMinerUI);e.CreateMinerView=s}),define("src/g/pvp1v1/ctrl/CreateMinerCtrl",["require","exports","../../../core/E","../../../enum/EventName","src/g/pvp1v1/view/CreateMinerView","../../../manager/RoleCenter","../../net/messages/EscortTaskUserDataGS2C","../../../manager/MineIngManager","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","../../../manager/NewRedHintsCenter","src/init/Switches","src/g/fight/osprite/GameScene","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(){function t(){this._useItemKey=!1,this._itemCount=0}return t.prototype.init=function(){i.E.ins.on(n.EventName.CREATEMINER,this,this.openPanel)},t.prototype.openPanel=function(t){this._view||(this._view=new s.CreateMinerView,this._view.bgview.btn_back.on(Laya.Event.CLICK,this,this.onCloseHandler),this._view.bgview.btn_close.on(Laya.Event.CLICK,this,this.onCloseHandler),this._view.on(Laya.Event.REMOVED,this,this.onCloseHandler),this._view.btn_enter.on(Laya.Event.CLICK,this,this.onStartWork),this._view.image_select.on(Laya.Event.CLICK,this,this.onSelectHandler),this._view.btn_update.on(Laya.Event.CLICK,this,this.onUpdateWorker)),(r.MineIngManager.instance.createMinerCtrl=this)._view.showView(),this._gamePlayType=p.GameScene.ins.playMan.play,this._view.list.selectedIndex=0,this._useItemKey=!1,this._view.html_itemCount.style.fontSize=24,this._itemCount=o.RoleCenter.instans.self.bagdata.getItemCount(r.MineIngManager.instance.GetDarConfig().itemId),this.updateUI(t),c.NewRedHintsCenter.ins.setRedHintOpenOrClose(c.enumRedHints.mine_select_worker,!1)},t.prototype.onSelectHandler=function(){this._useItemKey=!this._useItemKey,this._view.image_key&&(this._view.image_key.visible=this._useItemKey)},t.prototype.onCloseHandler=function(){this._view.off(Laya.Event.REMOVED,this,this.onCloseHandler),r.MineIngManager.instance.createMinerCtrl=null,this._view.removeSelf(),this._view.destroy(!0),this._view=null,this._gamePlayType=null},t.prototype.updateUI=function(t){var e=r.MineIngManager.instance.escortTaskUserDataGS2C;if(this._view){if(e){this._view.label_robTime.text=e.escortTimes.toString()+"/"+r.MineIngManager.instance.GetDarConfig().dartCount.toString(),this._view.label_robTime.color=0==e.escortTimes?"#ff0f15":"#03bb00";var i=r.MineIngManager.instance.getDartVoByQuality(e.escortTask.quality);if(i){var n=void 0;n=4==e.escortTask.quality?0:Math.min(e.blessingVal/i.blessing,1),console.log("祝福值当前进度比例"+n),this._view.processBar_bless.width=420*n}var s=r.MineIngManager.instance.GetDarConfig().qualityFreeCount-e.escortTask.refreshTimes;s<0&&(s=0),this._view.label_time.visible=0==s?(i&&i.qualityBuyCount&&(this._view.text_desc.text=i.qualityBuyCount.toString()),!(this._view.costBox.visible=!0)):!(this._view.costBox.visible=!1),this._gamePlayType&&this._view.setQulityIndex(r.MineIngManager.instance.getIndexByQuality(e.escortTask.quality),0<s&&t&&0<e.escortTimes),this.updateItemCount()}this._view.image_key&&(this._view.image_key.visible=this._useItemKey)}},t.prototype.updateItemCount=function(){var t=this._itemCount;this._view.html_itemCount.innerHTML="<span color = '#db8c43'>{0}</span>".replace("{0}",t.toString())},t.prototype.isMaxHighQuality=function(){var t=r.MineIngManager.instance.escortTaskUserDataGS2C;return!(!t||t.escortTask.quality!=r.MineIngManager.instance.GetDarConfig().maxQuality)},t.prototype.onStartWork=function(){console.log("CreateMinerCtrl::onStartWork"),0<r.MineIngManager.instance.escortTaskUserDataGS2C.escortTimes?r.MineIngManager.instance.getSelfTaskState()==a.EEscortTaskStatus.ToTake?(this._gamePlayType.startWork(),this.onCloseHandler(),i.E.ins.event(n.EventName.BOSSWARNINGSHOW,"res/wakuang/startWakuang.png")):this.showTipsNoUpdateByState():l.FE.upItems(d.TextConst.get(656),h.BubbleEnum.center)},t.prototype.onUpdateWorker=function(){if(console.log("CreateMinerCtrl::onUpdate"),r.MineIngManager.instance.escortTaskUserDataGS2C.escortTimes<=0)l.FE.upItems(d.TextConst.get(656),h.BubbleEnum.center);else if(this.isMaxHighQuality())l.FE.upItems(d.TextConst.get(657),h.BubbleEnum.center);else if(r.MineIngManager.instance.getSelfTaskState()==a.EEscortTaskStatus.ToTake){var t=r.MineIngManager.instance.GetDarConfig().qualityFreeCount-r.MineIngManager.instance.escortTaskUserDataGS2C.escortTask.refreshTimes,e=this._useItemKey;if(t<=0&&(e&&(console.log("选择了使用道具，道具ID:"+r.MineIngManager.instance.GetDarConfig().itemId+" count:"+this._itemCount),this._itemCount<1&&(e=!1)),0==e)){var i=r.MineIngManager.instance.escortTaskUserDataGS2C.escortTask,n=r.MineIngManager.instance.getDartVoByQuality(i.quality);if(o.RoleCenter.instans.self.GOLD<n.qualityBuyCount)return void u.Switches.ins.event(155)}var s=this._gamePlayType.updateWoker(t,e);r.MineIngManager.instance.useItemNum+=s,this._itemCount+=s,this.updateItemCount()}else this.showTipsNoUpdateByState()},t.prototype.showTipsNoUpdateByState=function(){switch(r.MineIngManager.instance.getSelfTaskState()){case a.EEscortTaskStatus.InEscort:l.FE.upItems(d.TextConst.get(658),h.BubbleEnum.center);break;case a.EEscortTaskStatus.toGetBonus:l.FE.upItems(d.TextConst.get(659),h.BubbleEnum.center);break;default:l.FE.upItems("CreateMinerCtrl::showTipsNoUpdateByState:state"+r.MineIngManager.instance.getSelfTaskState().toString(),h.BubbleEnum.center)}},t}();e.CreateMinerCtrl=g}),define("src/g/pvp1v1/view/MineAccountView",["require","exports","../../../manager/LayerManager"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.showView=function(){i.LayerManager.addCenterLayer(this),this.x=(Laya.stage.width-this.width)/2,this.y=(Laya.stage.height-this.height)/2,this.label_robDesc1.style.font="SimHei",this.label_robDesc1.style.fontSize=20,this.label_robDesc2.style.font="SimHei",this.label_robDesc2.style.fontSize=20,this.label_robDesc1.style.align="center",this.label_robDesc2.style.align="center",this.nun0.style.font="SimHei",this.nun0.style.fontSize=20,this.nun1.style.font="SimHei",this.nun1.style.fontSize=20,this.nun2.style.font="SimHei",this.nun2.style.fontSize=20},e}(ui.pvp1v1.MineAccountUI);e.MineAccountView=n}),define("src/g/pvp1v1/ctrl/MineAccountCtrl",["require","exports","../../../core/E","../../../enum/EventName","src/g/pvp1v1/view/MineAccountView","../../../manager/MineIngManager","../../../utils/ItemUtils","../../../manager/RoleCenter","src/init/Switches","../../../manager/LayerManager"],function(t,e,i,n,s,p,d,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){}return t.prototype.init=function(){i.E.ins.on(n.EventName.MINEACCOUNT,this,this.openPanel)},t.prototype.openPanel=function(){this._view||(this._view=new s.MineAccountView,this._view.btn_finish.on(Laya.Event.CLICK,this,this.finishHandler),this._view.btn_doubleFinish.on(Laya.Event.CLICK,this,this.doubleFinishHandler)),this._view.showView(),this._labelList=[this._view.label_robDesc1,this._view.label_robDesc2],p.MineIngManager.instance.mineAccountCtrl=this},t.prototype.updateUI=function(){if(null!=this._view){for(var t=0;t<this._labelList.length;t++)this._labelList[t].visible=!1;var e=p.MineIngManager.instance.escortTaskUserDataGS2C.escortTask;this._view.image_headIcon.skin="res/wakuang/workimg_"+e.quality.toString()+".png",this._view.imgLevel.skin="res/wakuang/prisoner_"+e.quality+".png";var i=p.MineIngManager.instance.getDartVoByQuality(e.quality);this._view.text_consumption.text=i.doubleRaward.toString();var n=0,s=p.MineIngManager.instance.escortRobRecordGS2CList;if(s){if(0==s.length)this._view.isPlunded.visible=!0;else{this._view.isPlunded.visible=!1;for(t=0;t<s.length&&t<this._labelList.length;t++){var o=p.MineIngManager.getRobRecordInfo(s[t]);console.log("MineAccountCtrl::updateUI"+o),this._labelList[t].visible=!0,this._labelList[t].innerHTML=o}}n=s.length*i.percent/100}for(t=0;t<p.MineIngManager.instance.maxRewardNum;t++)this._view["box_"+t].visible=!1;var a=0,r=0,l=0;for(t=0;t<i.reward.length+i.fixedReward.length&&t<p.MineIngManager.instance.maxRewardNum;t++){r=(l=t)<i.reward.length?(a=i.reward[t][0],Math.floor(i.reward[t][1])):(l=t-i.reward.length,a=i.fixedReward[l][0],i.fixedReward[l][1]);var h=d.ItemUtils.getItemOrEq(a),c=this._view["nun"+t],u="<span color = '#e3cca9'>"+h.name+": </span>";u+="<span color = '#03bb00'>x"+r+"</span>",t<i.reward.length&&0<n&&(u+="<span color = '#ff0000'>(-"+Math.floor(i.reward[t][1]*n)+")</span>"),c.innerHTML=u,this._view["icon"+t].skin=d.ItemUtils.getIconById(a),this._view["box_"+t].visible=!0}}},t.prototype.finishHandler=function(){console.log("MineAccountCtrl::finishHandler"),p.MineIngManager.instance.finishTask(!1),this.onCloseHandler()},t.prototype.doubleFinishHandler=function(){console.log("MineAccountCtrl::doubleFinishHandler");var t=p.MineIngManager.instance.escortTaskUserDataGS2C.escortTask,e=p.MineIngManager.instance.getDartVoByQuality(t.quality);o.RoleCenter.instans.self.GOLD<e.doubleRaward?a.Switches.ins.event(155):(p.MineIngManager.instance.finishTask(!0),this.onCloseHandler())},t.prototype.onCloseHandler=function(){(p.MineIngManager.instance.mineAccountCtrl=null)!=this._view&&(r.LayerManager.removeFromCenter(this._view),this._view.destroy(),this._view=null)},t}();e.MineAccountCtrl=l}),define("src/g/pvp1v1/view/MineIngView",["require","exports","../../../manager/LayerManager","../../../utils/ItemUtils","../../../manager/MineIngManager"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.mouseThrough=!0,t.width=Laya.stage.width,t.height=Laya.stage.height,t.sprite_botBar.bottom=213,t.initList(t.playerList,t.renderPlayerCell,ui.pvp1v1.minePlayerHeadUI),t}return __extends(t,e),t.prototype.initList=function(t,e,i){t.selectEnable=!0,t.vScrollBarSkin="",t.itemRender=i,t.scrollBar.elasticDistance=100,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.renderPlayerCell=function(t,e){t.on(Laya.Event.CLICK,this,this.lueDuoHander);var i=t.dataSource;t.imgHead.skin=n.ItemUtils.getHeadurlYuan(i.sex,i.job),t.lbName.text=i.nickName,t.imgLevel.skin="res/wakuang/prisoner_"+i.minerQuality+".png"},t.prototype.updPlayerList=function(t){this.playerList.array=t,this.imgLueDuo.visible=null!=t&&0!=t.length,this.caculateListH(this.playerList,5)},t.prototype.caculateListH=function(t,e){if(null==t.array||0==t.array.length)t.height=0;else{var i=Math.min(e,t.array.length),n=90*i+(i-1)*t.spaceY;t.height=n}},t.prototype.lueDuoHander=function(t){var e=t.currentTarget.dataSource;s.MineIngManager.instance.gamePlayMine.onNpcClickHandler(e.nickName)},t.prototype.showView=function(){i.LayerManager.addInUILayer(this)},t}(ui.pvp1v1.MineIngVIewUI);e.MineIngView=o}),define("src/g/pvp1v1/ctrl/MineIngViewCtrl",["require","exports","src/g/pvp1v1/view/MineIngView","src/g/pvp1v1/view/MineRecordView","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../net/messages/EscortTaskUserDataGS2C","../../../utils/system/ServerTime","src/g/fight/osprite/GameScene","../../../manager/GameSocketManager","../../../manager/MineIngManager","../../../manager/AM","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg","../../../utils/system/DateUitl","../../../manager/NewRedHintsCenter","src/init/Switches","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v,f,y,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var _=function(){function t(){this._updateTimeKey=!1,this._quickMoney=0,this.isRandom=!0}return t.prototype.init=function(){s.E.ins.on(o.EventName.OPENMINE,this,this.openPanel),s.E.ins.on(o.EventName.MINER_LIST_CHANGED,this,this.updPlayerList)},t.prototype.openPanel=function(){this._view||(this._view=new i.MineIngView,this._view.btn_create.on(Laya.Event.CLICK,this,this.createMiner),this._view.btn_record.on(Laya.Event.CLICK,this,this.openRecord),this._view.label_quickFinish.on(Laya.Event.CLICK,this,this.onQuickFinish)),this._view.showView(),u.MineIngManager.instance.mineIngViewCtrl=this,c.GSM.ins.on(r.ETRobRecordListGS2C.KEY,this,this.openRecordStep),s.E.ins.on(o.EventName.PLAY_TYPE_CHANGED,this,this.hideMine),this.updateUI(!0),u.MineIngManager.instance.escortTaskUserDataGS2C.escortTask.escortTaskState==r.EEscortTaskStatus.toGetBonus&&s.E.ins.event(o.EventName.MINEACCOUNT),this.updatSceneLevel()},t.prototype.update=function(){if(null!=this._view){var t=u.MineIngManager.instance.escortTaskUserDataGS2C;if(this._updateTimeKey&&t){var e=t.escortTask.endtime-l.ServerTime.serverTime;e<=0&&(e=0),this._view.label_leftTime.text=v.DateUtil.getMinStr1(e)}}},t.prototype.updatSceneLevel=function(){var t=u.MineIngManager.instance.getSceneLevel()+1;u.MineIngManager.instance.getMaxSceneLevel();this._view.text_sceneLevel.text=t.toString(),this.updatePeopleNum()},t.prototype.updatePeopleNum=function(){this._view.text_peopleNum.text=u.MineIngManager.instance.getCurrScenePeople().toString()},t.prototype.onGetReward=function(){this.isRandom=!0},t.prototype.updateUI=function(t){void 0===t&&(t=!1);var e=u.MineIngManager.instance.escortTaskUserDataGS2C;if(e){this._view&&e&&console.log(u.MineIngManager.getTaskStateDesc(e.escortTask));var i=!1,n=!1;switch(this._updateTimeKey=!1,this.showTime(!1),e.escortTask.escortTaskState){case r.EEscortTaskStatus.NULL:break;case r.EEscortTaskStatus.ToTake:0<e.escortTimes&&(i=!0);break;case r.EEscortTaskStatus.InEscort:this._updateTimeKey=!0,this.showTime(!0),n=!0;break;case r.EEscortTaskStatus.toGetBonus:n=!0}n&&e.escortTask.robtimes<=0&&(n=!1),u.MineIngManager.instance.redPointKey=n,f.NewRedHintsCenter.ins.setRedHintOpenOrClose(f.enumRedHints.mine_rob_record,n),t&&f.NewRedHintsCenter.ins.setRedHintOpenOrClose(f.enumRedHints.mine_select_worker,i)}else console.log("挖矿数据为null")},t.prototype.createMiner=function(){s.E.ins.event(o.EventName.CREATEMINER,this.isRandom),this.isRandom=!1},t.prototype.openRecord=function(){var t=h.GameScene.ins.playMan.play;t&&t.getMyRobRecord()},t.prototype.openRecordStep=function(t){console.log("MineIngViewCtrl::openRecordStep"),this._record||(this._record=new n.MineRecordView),this._record.popup(),this._record.updateUI(t)},t.prototype.onQuickFinish=function(){console.log("MineIngViewCtrl::onQuickFinish");var t=u.MineIngManager.instance.escortTaskUserDataGS2C.escortTask.endtime-l.ServerTime.serverTime;this._quickMoney=u.MineIngManager.instance.GetDarConfig().clearCdAcer*Math.ceil(t/10),this._quickMoney<0&&(this._quickMoney=0),p.AM.show(m.TextConst.get(660,this._quickMoney),Laya.Handler.create(this,this.onOkQuickFinish))},t.prototype.onOkQuickFinish=function(){if(a.RoleCenter.instans.self.GOLD<this._quickMoney)Laya.timer.once(1,this,function(){y.Switches.ins.event(155)});else{var t=h.GameScene.ins.playMan.play;t&&t.quickFinishTask()}},t.prototype.showTime=function(t){this._view&&(this._view.label_timeDesc.visible=t,this._view.label_leftTime.visible=t,this._view.img_di.visible=t,this._view.label_quickFinish.visible=t,this._view.btn_create.visible=!t)},t.prototype.hideMine=function(){d.PlayManager.type!=g.EPlayType.PLAYTYPE_ENTERMINE&&(u.MineIngManager.instance.mineIngViewCtrl=null,this._view&&(this._view.removeSelf(),this._view.destroy(),this._view=null,s.E.ins.off(o.EventName.PLAY_TYPE_CHANGED,this,this.hideMine)))},t.prototype.showPartView=function(){this._view&&(this._view.sprite_botBar.visible=!0,this._view.playerContainer.visible=!0)},t.prototype.hidePartView=function(){this._view&&(this._view.sprite_botBar.visible=!1,this._view.playerContainer.visible=!1)},t.prototype.updPlayerList=function(t){this._view&&this._view.updPlayerList(t.sort(this.sortByEndTime))},t.prototype.sortByEndTime=function(t,e){return t.endtime-e.endtime},t}();e.MineIngViewCtrl=_}),define("src/g/pvp1v1/view/MineView",["require","exports","../../../manager/LayerManager","../../../manager/RoleCenter","../../../manager/MineIngManager","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return o.ClearResM.addBgUrl(t.bgimg.skin),t.btn_enter.on(Laya.Event.CLICK,t,t.enterHandler),t}return __extends(t,e),t.prototype.enterHandler=function(){s.MineIngManager.instance.enterMine()&&i.LayerManager.closeAllPOPWindow()},t.prototype.showView=function(){this.visible=!0;var t=n.RoleCenter.instans.self.escortTask;this.label_MineTime.text=t.escortTimes.toString()+"/"+s.MineIngManager.instance.GetDarConfig().dartCount.toString(),this.label_robTime.text=t.canRobOtherTimes.toString()+"/"+s.MineIngManager.instance.GetDarConfig().robberyCount.toString(),this.label_MineTime.color=0==t.escortTimes?"#ff0f15":"#03bb00",this.label_robTime.color=0==t.canRobOtherTimes?"#ff0f15":"#03bb00",this.bgimg.restskin()},t}(ui.pvp1v1.MineViewUI);e.MineView=a}),define("src/g/pvp1v1/view/PVP1V1Panel",["require","exports","../../../core/E","src/g/field/view/NearPlayerView","src/g/field/view/RevengeView","src/g/pvp1v1/view/MineView","../../../manager/RuledescManager","src/g/proxy/MultiLevelUIProxy","src/g/pvp1v1/view/PortHighFightPage","src/g/pvp1v1/ctrl/ChallengeRecover","src/g/clearRes/ClearResM","../../../enum/EventName"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t._conarr=[],t._pro=new r.MultiLevelUIProxy,t.view.btn_back.on(Laya.Event.CLICK,t,t.closePVPHandler),t.view.btn_close.on(Laya.Event.CLICK,t,t.closePVPHandler),t._pro.registerTab(t.tabbar,0),t._pro.registerTagIndex(86,0),t._pro.registerTagIndex(87,1),t._pro.registerTagIndex(88,2),t._pro.registerTagIndex(89,3),t._pro.selectHandler=new Laya.Handler(t,t.selectHandler),t}return __extends(t,e),t.prototype.closeClearRes=function(){i.E.ins.off(u.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),c.ClearResM.clearResFolder("field/"),c.ClearResM.clearResFolder("tianti/"),c.ClearResM.clearResFolder("tianti1/")},t.prototype.onClick=function(t){a.RuledescManager.showRuledesc(t)},t.prototype.selectHandler=function(t){void 0===t&&(t=0);for(var e=0;e<this._conarr.length;e++)this._conarr[e].visible=!1;1==t?(this.view.btn_help.visible=!0,this.view.btn_help.on(Laya.Event.CLICK,this,this.onClick,[4])):this.view.btn_help.visible=!1;var i=!1;switch(t){case 0:this._nearPerson||(i=!0,this._nearPerson=new n.NearPlayerView,this.view.box_page.addChild(this._nearPerson),this._conarr.push(this._nearPerson)),this._nearPerson.showView();break;case 1:this._portHighview||(i=!0,h.ChallengeRecover.instance().init(),this._portHighview=new l.PortHighFightPage,this.view.box_page.addChild(this._portHighview),this._conarr.push(this._portHighview)),i?Laya.timer.frameOnce(3,this._portHighview,this._portHighview.showView):this._portHighview.showView();break;case 2:this._mineView||(i=!0,this._mineView=new o.MineView,this.view.box_page.addChild(this._mineView),this._conarr.push(this._mineView)),i?Laya.timer.frameOnce(3,this._mineView,this._mineView.showView):this._mineView.showView();break;case 3:this._revengeView||(this._revengeView=new s.RevengeView,this.view.box_page.addChild(this._revengeView),this._conarr.push(this._revengeView)),i?Laya.timer.frameOnce(3,this._revengeView,this._revengeView.showView):this._revengeView.showView()}this.changeTitle(t)},t.prototype.changeTitle=function(t){switch(t){case 0:this.title_img.skin="res/title/biaoti_fujinderen.png";break;case 1:this.title_img.skin="res/title/biaoti_tianti.png";break;case 2:this.title_img.skin="res/title/biaoti_kuangdong.png";break;case 3:this.title_img.skin="res/title/biaoti_fuchou.png";break;default:this.title_img.skin="res/title/biaoti_fujinderen.png"}},t.prototype.closePVPHandler=function(){this.removeSelf()},t.prototype.showView=function(t){void 0===t&&(t=0),this._pro.open(t),i.E.ins.on(u.EventName.CLOSEALLWINDOWS,this,this.closeClearRes)},t}(ui.pvp1v1.PVP1V1UI);e.PVP1V1Panel=p}),define("src/g/pvp1v1/view/ConPlunderView",["require","exports","../../../manager/MineIngManager","../../../utils/ItemUtils","src/g/peronboss/view/ItemIconView","src/init/TextConst"],function(t,e,g,v,f,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function t(){var t=e.call(this)||this;return t._beRobUserName=null,t.btn_rob.on(Laya.Event.CLICK,t,t.onRob),t}return __extends(t,e),t.prototype.showView=function(t,e,i,n){this._beRobUserName=t.username,this.popup(),this.lab_name.text=t.userNick;var s=t.quality;this.img_workTitle.skin="res/wakuang/prisoner_"+s.toString()+".png",t.familyNick?this.lab_name_guild.text=t.familyNick:this.lab_name_guild.text=y.TextConst.get(533);var o=g.MineIngManager.instance.getDartVoByQuality(n),a=g.MineIngManager.instance.getIndexByQuality(n);o&&(this.text_fight.text=t.combat.toString());for(var r=0;r<g.MineIngManager.instance.maxRewardNum;r++)this["item"+r].visible=!1;if(a<g.MineIngManager.instance.dartVoList.length){var l=g.MineIngManager.instance.GetDarConfig(),h=g.MineIngManager.instance.dartVoList[a].revengeReward,c=0,u=0,p=v.ItemUtils.getItemOrEq(c);for(r=0;r<h.length+l.Reward.length&&r<g.MineIngManager.instance.maxRewardNum+1;r++)this["item"+r].visible=!0,u=r<h.length?(c=h[r][0],h[r][1]):(c=l.Reward[r-h.length][0],l.Reward[r-h.length][1]),p=v.ItemUtils.getItemOrEq(c),f.ItemIconView.setItemData(p,this["item"+r],u)}var d=g.MineIngManager.instance.escortTaskUserDataGS2C;this&&d&&(this.label_workTime.text=d.canRobOtherTimes.toString()+"/"+g.MineIngManager.instance.GetDarConfig().robberyCount.toString())},t.prototype.onRob=function(){this._beRobUserName&&(g.MineIngManager.instance.startRob(this._beRobUserName),this._beRobUserName=null),this.close()},t}(ui.pvp1v1.page.ConPlunderUI);e.ConPlunderView=i}),define("src/g/pvp1v1/ctrl/PVP1V1Ctrl",["require","exports","../../../core/E","../../../enum/EventName","src/g/pvp1v1/view/PVP1V1Panel","../../../manager/LayerManager","src/init/Switches","src/g/accessctrl/AccessCenter","src/g/proxy/AccessListenProxy","../../../manager/RoleCenter","../../../manager/NewRedHintsCenter","src/g/pvp1v1/view/ConPlunderView","../../../manager/MineIngManager"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(){var t=a.Switches.ins;t.on(21,this,this.onOpenPage,[21]),t.on(86,this,this.onOpenPage,[86]),t.on(87,this,this.onOpenPage,[87]),t.on(88,this,this.onOpenPage,[88]),t.on(89,this,this.onOpenPage,[89]),(new l.AccessListenProxy).checkAndListen(87,new Laya.Handler(this,this.checkJingJiRed)),i.E.ins.on(n.EventName.KING_ATHLETICS_NUM_OF_CHALLENGES,this,this.checkJingJiRed),i.E.ins.on(n.EventName.showConPlunderView,this,this.showConPlunderView)}return t.prototype.showConPlunderView=function(t){(new u.ConPlunderView).showView(t,p.MineIngManager.getWorkerDesc(t),t.userNick,t.quality)},t.prototype.checkJingJiRed=function(){var t=h.RoleCenter.instans.vo.getKingData();r.AccessCenter.ins.checkOpen(87);t.lastWeekBonus?c.NewRedHintsCenter.ins.setRedHintOpenOrClose(c.enumRedHints.lastweekBtn,!0):(c.NewRedHintsCenter.ins.setRedHintOpenOrClose(c.enumRedHints.lastweekBtn,!1),0<t.goldBuyCnt+h.RoleCenter.instans.vo.KING?c.NewRedHintsCenter.ins.setRedHintOpenOrClose(c.enumRedHints.kingred,!0):c.NewRedHintsCenter.ins.setRedHintOpenOrClose(c.enumRedHints.kingred,!1))},t.prototype.onOpenPage=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1),e&&(21==t?r.AccessCenter.ins.checkOpen(86)?this.showView(86,i,!0):r.AccessCenter.ins.checkOpen(87)?this.showView(87,i,n):r.AccessCenter.ins.checkOpen(88)?this.showView(88,i,n):r.AccessCenter.ins.checkOpen(89)&&this.showView(89,i,n):this.showView(t,i,n))},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._view||(this._view=new s.PVP1V1Panel),this._view.showView(t),o.LayerManager.addInPOPWindowLayer(this._view,e,!0,!0,!1,i)},t}();e.PVP1V1Ctrl=d}),define("src/g/pvp1v1/view/MineRewardPreview",["require","exports","src/g/account/view/AccItem","../../../utils/SoundUtils","../../../manager/MineIngManager"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t.centerX=t.centerY=0,t.width=Laya.stage.width,t.height=Laya.stage.height,t.bg=new Laya.Sprite,t.bg.width=t.width,t.bg.height=t.height,t.addChildAt(t.bg,0),t.bg.on(Laya.Event.CLICK,t,t.closeHander),t.contentBox.centerX=t.contentBox.centerY=0,t.initList(t.rewardList,t.onRenderHandler,i.AccItem),t.lingquButton.on(Laya.Event.CLICK,t,t.enterMineHander),t}return __extends(t,e),t.prototype.closeHander=function(){this.destroy(!0)},t.prototype.initList=function(t,e,i){t.selectEnable=!0,t.itemRender=i,t.renderHandler=new Laya.Handler(this,e),t.array=[]},t.prototype.onRenderHandler=function(t,e){t.eqData=t.dataSource},t.prototype.updReward=function(t){this.rewardList.array=t},t.prototype.enterMineHander=function(){n.SoundUtils.getInstance().playBtnsounds(),this.destroy(!0),s.MineIngManager.instance.enterMine()},t}(ui.pvp1v1.MineRewardPreviewUI);e.MineRewardPreview=o});var ShowItem,RandomAnimation=function(){function t(){this.frameGap=20,this.frameGapA=1,this.lastRunFrameNum=0,this.minGap=5,this.runTime=0}return t.prototype.start=function(t,e){this.update=e,this.totalTime=t,this.runTime=0,this.lastRunFrameNum=0,this.frameGap=(t/3>>0)*this.frameGapA+this.minGap,this.frameGapA=-Math.abs(this.frameGapA),Laya.timer.frameLoop(2,this,this.frameHander)},t.prototype.stop=function(){Laya.timer.clearAll(this)},t.prototype.frameHander=function(){this.lastRunFrameNum++,this.lastRunFrameNum==this.frameGap&&(this.runTime>this.totalTime/3>>0&&this.runTime<this.totalTime/3*2<<0?(this.frameGapA<0&&(this.frameGapA=-this.frameGapA),console.log("未执行变速")):(this.frameGap+=this.frameGapA,console.log("在执行变速")),this.runTime++,this.lastRunFrameNum=0,this.runTime==this.totalTime?(this.stop(),this.update.runWith([this.runTime,!0,this.frameGap])):this.update.runWith([this.runTime,!1,this.frameGap]))},t}();define("src/g/rank/view/RankView",["require","exports","src/g/clearRes/ClearResM","../../../core/E","../../../config/GameConfig","../../../utils/ItemUtils","../../../vo/RedDot/RankItemVo","src/g/rank/view/DengJiItem","../../net/messages/rank/RankDataGS2C","../../../manager/GameSocketManager","../../../manager/LayerManager","../../../core/GNet","../../net/messages/rank/sbkRankDataBase","../../../manager/RoleCenter","../../net/messages/OpResultType","../../net/messages/OpResultGS2C","../../../enum/EventName","../../../utils/StringUtils","../../../utils/system/FloatEffect","src/init/TextConst","../../../utils/RoleUtil","../../net/messages/sbkHeroData","../../../manager/RedDotM"],function(t,e,o,a,r,l,h,c,u,p,d,g,v,f,y,i,m,_,C,I,n,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(s){function t(){var t=s.call(this)||this;t._dataList=[],t._expLsit=[],t._moneyLsit=[],t._fisuserName="",t._buttons=[],t._types=[],t._images=[],t._currenIndex=0,t._count=100,t.bg.btn_close.once(Laya.Event.CLICK,t,t.closeHandler),t.bg.btn_back.visible=!1,t.tab.selectHandler=new Laya.Handler(t,t.selectHandler),t.list.vScrollBarSkin="",t.list.scrollBar.elasticDistance=50,t.list.itemRender=c.DengJiItem,t.list.renderHandler=new Laya.Handler(t,t.rendHandler),t.btn_mobai.on(Laya.Event.CLICK,t,t.worshipHandler),t._fisrtItem=new c.DengJiItem,t._fisrtItem.x=27,t._fisrtItem.y=375,t.btn_one_icon.on(Laya.Event.CLICK,t,t.sendOtherHandler),t.list.array=[],o.ClearResM.addBgUrl(t.bgimg.skin),t._buttons.push(t.btn_com,t.btn_lvl,t.btn_zhansheng,t.btn_fashen,t.btn_daozun,t.btn_shenyi,t.btn_guanzhi),t._types.push(v.enumRankID.rankid_1,v.enumRankID.rankid_2,v.enumRankID.rankid_3,v.enumRankID.rankid_4,v.enumRankID.rankid_5,v.enumRankID.rankid_7,v.enumRankID.rankid_6);for(var e=0,i=t._buttons.length;e<i;e++){var n=new Laya.Image("res/indexicon/red_point.png");n.pos(92,-1),n.visible=!1,t._buttons[e].addChild(n),t._images.push(n)}return window.enabledpay?(t.vip_icon.visible=!0,t.month_icon.visible=!0):(t.vip_icon.visible=!1,t.month_icon.visible=!1,t.user_name.y=t.user_name.y-6),t}return __extends(t,s),t.prototype.updatePoint=function(){for(var t=0,e=this._buttons.length;t<e;t++)this._images[t].visible=this.checkHasMobai(this._types[t])},t.prototype.sendOtherHandler=function(){a.E.ins.event(m.EventName.OPEN_RANKROLEVIEW,[this._fisuserName])},t.prototype.rendHandler=function(t,e){t.setData(this.list.array[e],e)},t.prototype.unabledrank=function(t){var e=f.RoleCenter.instans.vo.getrankUserData().mobaidata;e&&-1==e.indexOf(t)&&e.push(t),w.RedDotM.check(2)},t.prototype.resultHandler=function(t){if(!this.destroyed&&t.opresult){if(this.list.array||(this.list.array=[]),0!=this.list.array.length)return;this.cur_box.visible=!0,101<t.rankIdArr[2]?this.rank_count.text=I.TextConst.get(83,I.TextConst.get(223)):this.rank_count.text=I.TextConst.get(83,t.rankIdArr[2]+1);var e=t.rankDataArr;if(!e)return;if(e.length<=0)this.cur_box.visible=!1,this.head_icon_ani.clear(),this._fisrtItem.visible=!1,this.btn_one_icon.off(Laya.Event.CLICK,this,this.sendOtherHandler);else{this.btn_one_icon.on(Laya.Event.CLICK,this,this.sendOtherHandler),this._fisrtItem.visible=!0,this.cur_box.visible=!0;for(var i=[],n=0;n<e.length;n++){var s=new h.RankItemVo;s.data=e[n],s.type=t.rankIdArr[0],i.push(s)}var o=i[0];this.getfirstData(o),this._fisuserName=o.data.username,this.setFirstData(o);var a=[];(a=a.concat(i)).shift(),this.list.array=a}}},t.prototype.setFirstData=function(t){var e=t.data.value1%1e3,i=t.data.value1/1e3>>0;switch(this.lvl_txt.text=0<i?I.TextConst.get(18,i,e):I.TextConst.get(16,e),this.fight_txt.text="",this.wei_txt.text="",this.user_name.text=t.data.nickname,this.lvl_txt.visible=!1,this.month_icon.skin="",this.vip_icon.skin=l.ItemUtils.getVipIconByLevel(t.data.vipLv),t.type){case v.enumRankID.rankid_1:this.fight_txt.text=I.TextConst.get(684,(t.data.value1/1e4).toFixed(2));break;case v.enumRankID.rankid_2:this.lvl_txt.visible=!0,this.fight_txt.text="",this.wei_txt.text="";break;case v.enumRankID.rankid_3:this.fight_txt.text=I.TextConst.get(685,(t.data.value1/1e4).toFixed(2)),this.wei_txt.text="";break;case v.enumRankID.rankid_4:this.fight_txt.text=I.TextConst.get(686,(t.data.value1/1e4).toFixed(2)),this.wei_txt.text="";break;case v.enumRankID.rankid_5:this.fight_txt.text=I.TextConst.get(687,(t.data.value1/1e4).toFixed(2)),this.wei_txt.text="";break;case v.enumRankID.rankid_6:var n=I.TextConst.get(689),s=r.GameConfig.chopJSON[t.data.value1+1];s&&(n=s.name),this.wei_txt.text=I.TextConst.get(89,_.StringUtils.NumString(t.data.value1)),this.fight_txt.text=n?I.TextConst.get(90,n):I.TextConst.get(90,I.TextConst.get(690)),this.fight_txt.visible=!0;break;case v.enumRankID.rankid_7:this.fight_txt.text=I.TextConst.get(688,(t.data.value1/1e4).toFixed(2)),this.wei_txt.text=""}this.img_fight.visible=!1,this.img_wei.visible=!1},t.prototype.getfirstData=function(t){if(!this.destroyed&&t){a.E.ins.on(m.EventName.OTHERDATA_UPDATE,this,this.otherDataHandler),this.curApplyOtherUsername=t.data.username,g.GNet.getOtherData([this.curApplyOtherUsername],!0);for(var e=r.GameConfig.rankconfigJSON[t.type],i=e.EXP,n=f.RoleCenter.instans.vo.getCurLv(),s=0;s<i.length;s++){if(n<parseInt(i[s][0])){this.exp_txt.text=I.TextConst.get(1,(i[s-1][1]/1e4).toFixed(1)),this._expLsit[t.type]=i[s-1][1];break}}n>parseInt(i[i.length-1][0])&&(this.exp_txt.text=I.TextConst.get(1,(i[i.length-1][1]/1e4).toFixed(1)),this._expLsit[t.type]=i[i.length-1][1]);i=e.MONEY;for(var o=0;s<i.length;o++){if(n<parseInt(i[s][0])){this.money_txt.text=I.TextConst.get(1,(i[s-1][1]/1e4).toFixed(1)),this._moneyLsit[t.type]=i[s-1][1];break}}n>parseInt(i[i.length-1][0])&&(this.money_txt.text=I.TextConst.get(1,(i[i.length-1][1]/1e4).toFixed(1)),this._moneyLsit[t.type]=i[i.length-1][1])}},t.prototype.otherDataHandler=function(){var t=f.RoleCenter.instans.getOtherData(this.curApplyOtherUsername);this.setOnePerson(t)},t.prototype.setOnePerson=function(t){if(t&&(this.head_icon_ani.visible=!0,a.E.ins.off(m.EventName.OTHERDATA_UPDATE,this,this.otherDataHandler),!this.destroyed)){this.wing_res.visible=!1,this.role_res.visible=!1,this.weapon_res.visible=!1;var e=0;if(2==this.tab.selectedIndex)for(var i=0;i<t.openhero.length;i++){if(t.openhero[i].jobid==b.EnumJob.ZHANSHI){e=i;break}e=0}else if(3==this.tab.selectedIndex)for(i=0;i<t.openhero.length;i++){if(t.openhero[i].jobid==b.EnumJob.FASHI){e=i;break}e=0}else if(4==this.tab.selectedIndex)for(i=0;i<t.openhero.length;i++){if(t.openhero[i].jobid==b.EnumJob.DAOSHI){e=i;break}e=0}n.RoleUtil.refreshZww(t.openhero[e],100,this.wing_res,this.weapon_res,this.role_res,this.ani_fumo)}},t.prototype.worshipHandler=function(){g.GNet.rankOpResultC2GS(y.enumOpResultType.rank_mobai,this._currenIndex),p.GSM.ins.on(i.OpResultGS2C.KEY,this,this.opHandler),C.FE.upItems(I.TextConst.get(692),2)},t.prototype.opHandler=function(t){if(!this.destroyed){if(t.opresult&&t.msgidx==y.enumOpResultType.rank_mobai){f.RoleCenter.instans.vo.getrankUserData().mobaidata[t.reservedata[0]]=t.reservedata[0],this.checkIsMobai(t.reservedata[0]);var e=this._expLsit[t.reservedata[0]],i=this._moneyLsit[t.reservedata[0]];f.RoleCenter.instans.vo.EXP+=e;var n=l.ItemUtils.getCurrencyVoByDefine("MONEY"),s=l.ItemUtils.getCurrencyVoByDefine("EXP");C.FE.getFloat(n.name+"x"+i,l.ItemUtils.getColorByQuality(n.quality)),C.FE.getFloat(s.name+"x"+e,l.ItemUtils.getColorByQuality(s.quality)),a.E.ins.event(m.EventName.UPDATERANKREDDOT);var o=this.tab.selectedIndex;o<=7&&(this.tab.selectedIndex=o+1)}this.updatePoint()}},t.prototype.closeHandler=function(){this.visible=!1,this.removeSelf(),this.destroyView()},t.prototype.showView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this.bgimg.restskin(),d.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),this.visible=!0,this.tab.selectedIndex=t;var n=p.GSM.ins;this.list.scrollTo(0),a.E.ins.on(m.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),n.on(u.RankDataGS2C.KEY,this,this.resultHandler)},t.prototype.closeClearRes=function(){a.E.ins.off(m.EventName.CLOSEALLWINDOWS,this,this.closeClearRes),o.ClearResM.clearResFolder("rank/")},t.prototype.destroyView=function(){p.GSM.ins.off(u.RankDataGS2C.KEY,this,this.resultHandler),a.E.ins.off(m.EventName.OTHERDATA_UPDATE,this,this.otherDataHandler),this.destroy(!0)},t.prototype.selectHandler=function(t){this.updatePoint(),this["rankList"+t]&&(this.wing_res.visible=!1,this.role_res.visible=!1,this.weapon_res.visible=!1,this.cur_box.visible=!1,this.list.scrollTo(0),this.list.array=[],this["rankList"+t]())},t.prototype.checkIsMobai=function(t){this._currenIndex=t,this.head_icon_ani.visible=!1;var e=r.GameConfig.rankconfigJSON[t];return 0<e.title.length?this.head_icon_ani.source="dynamic2/chenghao/"+e.title[0]+".json":this.head_icon_ani.clear(),-1==f.RoleCenter.instans.vo.getrankUserData().mobaidata.indexOf(t)?(this.btn_mobai.visible=!0,!(this.btn_geted.visible=!1)):(this.btn_mobai.visible=!1,this.btn_geted.visible=!0,w.RedDotM.check(2),!1)},t.prototype.checkHasMobai=function(t){return-1==f.RoleCenter.instans.vo.getrankUserData().mobaidata.indexOf(t)},t.prototype.rankList0=function(){var t=r.GameConfig.rankconfigJSON[v.enumRankID.rankid_1].count||100;g.GNet.getRankList(v.enumRankID.rankid_1,1,t),this.checkIsMobai(v.enumRankID.rankid_1)},t.prototype.rankList1=function(){var t=r.GameConfig.rankconfigJSON[v.enumRankID.rankid_2].count||100;g.GNet.getRankList(v.enumRankID.rankid_2,1,t),this.checkIsMobai(v.enumRankID.rankid_2)},t.prototype.rankList2=function(){var t=r.GameConfig.rankconfigJSON[v.enumRankID.rankid_3].count||100;g.GNet.getRankList(v.enumRankID.rankid_3,1,t),this.checkIsMobai(v.enumRankID.rankid_3)},t.prototype.rankList3=function(){var t=r.GameConfig.rankconfigJSON[v.enumRankID.rankid_4].count||100;g.GNet.getRankList(v.enumRankID.rankid_4,1,t),this.checkIsMobai(v.enumRankID.rankid_4)},t.prototype.rankList4=function(){var t=r.GameConfig.rankconfigJSON[v.enumRankID.rankid_5].count||100;g.GNet.getRankList(v.enumRankID.rankid_5,1,t),this.checkIsMobai(v.enumRankID.rankid_5)},t.prototype.rankList5=function(){var t=r.GameConfig.rankconfigJSON[v.enumRankID.rankid_7].count||100;g.GNet.getRankList(v.enumRankID.rankid_7,1,t),this.checkIsMobai(v.enumRankID.rankid_7)},t.prototype.rankList6=function(){var t=r.GameConfig.rankconfigJSON[v.enumRankID.rankid_6].count||100;g.GNet.getRankList(v.enumRankID.rankid_6,1,t),this.checkIsMobai(v.enumRankID.rankid_6)},t}(ui.rank.RankViewUI);e.RankView=s}),define("src/g/rank/ctrl/RankViewCtrl",["require","exports","src/g/rank/view/RankView","src/init/Switches","../../../core/GNet","../../../manager/GameSocketManager","../../net/messages/rank/RankDataGS2C","../../../manager/RoleCenter","../../../manager/RedDotM","../../../core/E","../../../enum/EventName"],function(t,e,n,i,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){}return t.prototype.init=function(){i.Switches.ins.on(2,this,function(t,e,i,n){void 0===e&&(e=!0),void 0===i&&(i=!1),void 0===n&&(n=0),this.openPanel(n,e,i)}),o.GSM.ins.on(a.RankDataGS2C.KEY,this,this.resultHandler2),h.E.ins.once(c.EventName.COMPLETE_INDEX,this,function(){for(var t=1;t<=7;t++)s.GNet.getRankList(t,1,1)})},t.prototype.resultHandler2=function(t){if(t.opresult){var e=t.rankDataArr;if(!e||0==e.length)return void this.unabledrank(t.rankIdArr[0])}},t.prototype.unabledrank=function(t){var e=r.RoleCenter.instans.vo.getrankUserData().mobaidata;e&&-1==e.indexOf(t)&&e.push(t),l.RedDotM.check(2)},t.prototype.openPanel=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._selectIndex=t,this._view&&this._view.destroy(),this._view=new n.RankView,this._view.showView(this._selectIndex,e,i)},t.prototype.completeHandler=function(){},t}();e.RankViewCtrl=u}),define("src/g/realname/ctrl/RealNameAuthentionCtrl",["require","exports","src/init/Switches","src/g/realname/view/RealNameAuthentionView"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){i.Switches.ins.on(213,this,this.onOpenIdHandler)}return t.prototype.onOpenIdHandler=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),t&&this.onOpenHandler(e,i)},t.prototype.onOpenHandler=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),this._view||(this._view=new n.RealNameAuthentionView),this._view.showView(t,e)},t}();e.RealNameAuthentionCtrl=s}),define("src/g/relic/view/Relic4Index",["require","exports","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../../utils/RelicUtils","../../../utils/ItemUtils","src/g/accessctrl/AccessCenter","../../net/messages/ChangeSceneMsg","src/init/Switches","src/g/Effects/UIEffectsFactory","../../../vo/RedDot/role/RedDot_Relic"],function(t,e,i,n,s,o,a,r,l,h,c,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(e){function t(){var t=e.call(this)||this;return t._nowPort=0,t._nowshowId=0,t._vo=null,t.addEvent(),t.visible=r.AccessCenter.ins.checkOpen(17),t.visible||r.AccessCenter.ins.on(17,t,t.updateAccessHandler),t}return __extends(t,e),t.prototype.updateAccessHandler=function(){this.visible=r.AccessCenter.ins.checkOpen(17),this.visible&&r.AccessCenter.ins.off(17,this,this.updateAccessHandler)},t.prototype.addEvent=function(){this.on(Laya.Event.CLICK,this,this.onOpenRelic),i.E.ins.on(n.EventName.ACHIVATEDEBRIS,this,this.refreshData),i.E.ins.on(n.EventName.ACHIVATERELIC,this,this.refreshData),i.E.ins.on(n.EventName.CHANGEITEM_COUNT,this,this.onChangeItem),i.E.ins.on(n.EventName.PLAY_TYPE_CHANGE,this,this.onPortPlay)},t.prototype.onPortPlay=function(t){t.playType==l.EPlayType.PLAYTYPE_PORT&&this.refreshData()},t.prototype.onChangeItem=function(t,e){5e3<t&&t<=5275&&0<e&&(u.RedDot_Relic.Ins.recheckRelic(),this.refreshData())},t.prototype.onOpenRelic=function(){h.Switches.ins.event(17)},t.prototype.refreshData=function(){this._nowPort=s.RoleCenter.instans.vo.portstatus.portindex-100,this._relic=s.RoleCenter.instans.vo.Relic,this._nowshowId=this._relic.nowRelicId,this._nowshowId>=this._relic.maxRelicId&&(this._nowshowId=this._relic.maxRelicId),7<this._nowshowId&&(this.visible=!1),this._vo=o.RelicUtils.getRelicVo(this._nowshowId),this.showNowRelic(),this.needRelicDebris(),this._relic.relicId==this._relic.maxRelicId&&this.showDes(0,!1,!1,!0)},t.prototype.showNowRelic=function(){this.img_icon.skin=o.RelicUtils.getRelicIcon(this._vo.imgIcon),this.img_name.skin="/dynamic/sqnamesmail/"+this._vo.title+".png"},t.prototype.needRelicDebris=function(){var t=this._vo.needItem2,e=this._relic.openRelicDebrisArr;if(t.length!=e.length){var i=t[e.length];if(this._relic.isHasDebris(i))this.showDes(0,!0);else{var n=a.ItemUtils.getItemVoById(i).effect[0][1];this.showDes(n-this._nowPort+1)}}else this.showDes(0,!0,!0)},t.prototype.showDes=function(t,e,i,n){if(void 0===t&&(t=0),void 0===e&&(e=!1),void 0===i&&(i=!1),void 0===n&&(n=!1),n)return this.img_type.skin="res/index1/sq_kejihuo2.png",this.box_need.visible=!1,void this.showAni(!1);e?(this.img_type.skin="res/index1/sq_kejihuo.png",this.box_need.visible=!1,this.showAni(!0,i)):(this.img_type.skin="",this.num_needport.value=t+"",this.box_need.visible=!0,this.showAni(!1))},t.prototype.showAni=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);var i=this.sp.getChildByName("ani_20");t?i||(this.sp.removeChildren(),(i=c.UIEffectsFactory.Ins.createUIAniById(20,!0,100)).name="ani_20",c.UIEffectsFactory.Ins.centered4Parent(i,this.sp,!0)):this.sp.removeChildren()},t}(ui.index.relicIndexViewUI);e.Relic4Index=p}),define("src/g/rexue/view/ReXueDlgView",["require","exports","../../../manager/LayerManager"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.showView=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),i.LayerManager.addInPOPWindowLayer(this,t,!0,!0,!1,e)},e.prototype.hideView=function(){this.bg_view.box_page.removeChildren(),this.removeSelf()},e.prototype.destroyView=function(){this.hideView()},e}(ui.rexue.ReXueBgUI);e.ReXueDlgView=n}),define("src/g/rexue/view/Tips/RxTips_suit",["require","exports","../../../../manager/RoleCenter","../../../../meta/ShuXingVo","../../../../utils/ItemUtils","../../../../config/GameConfig","../../../../vo/ReXueUtil","../../../../enum/enumItem"],function(t,e,n,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function i(){var t=e.call(this)||this;return t.suit1id=0,t.suit2id=0,t}return __extends(i,e),i.create=function(t){var e=new i;e.initData(t),e.popup()},i.prototype.initData=function(t){this._heroIdx=t,this._heroVo=n.RoleCenter.instans.vo.getOpenHeroByIdx(t),this._data=this._heroVo.rxData,this.suit1id=this._data.curType1SuitId,this.suit2id=this._data.curType2SuitId,this.renderView()},i.prototype.renderView=function(){this.renderNowAttr(),this.renderShenBingAttr(),this.renderShouHuAttr()},i.prototype.renderNowAttr=function(){var t=this._data.equipSuitProp,e=[];for(var i in t)"number"==typeof t[i]&&(t[i]<=0||e.push([i,t[i]]));0==e.length?this.box_has.removeSelf():this.lab_notHave.removeSelf();for(var n=0;n<8;n++){var s=this["has_"+n];if(e[n]){var o=r.ItemUtils.getShuXingByName(e[n][0]);o?s.text=o.desc+":"+a.ShuXingVo.getString4Vo(e[n][1],o):s.removeSelf()}else s.removeSelf()}},i.prototype.renderShenBingAttr=function(){var t=this.suit1id+2;0==this.suit1id&&(t=1);var e=l.GameConfig.rexue_suit[t];if(e){this.suit_view_1.initItems(h.ReXueUtil.getReXueSuitPosArr_shenbing(this._heroIdx,(t+1)/2>>0),c.enumItem.arr_equipPosNameRx),this.lab_name_suit1.text=e.name;for(var i=e.prop,n=0;n<10;n++){var s=this.box_suit1.getChildByName("sname_"+n);if(i[n]){var o=r.ItemUtils.getShuXingByName(i[n][0]);s.text=o.desc+":"+a.ShuXingVo.getString4Vo(i[n][1],o)}else s.removeSelf()}}else this.box_suit1.removeSelf()},i.prototype.renderShouHuAttr=function(){var t=this.suit2id+2,e=l.GameConfig.rexue_suit[t];if(e){this.suit_view_2.initItems(h.ReXueUtil.getReXueSuitPosArr_shouhu(this._heroIdx,t/2>>0),c.enumItem.arr_equipPosNameRx),this.lab_name_suit2.text=e.name;for(var i=e.prop,n=0;n<10;n++){var s=this.box_suit2.getChildByName("sname_"+n);if(i[n]){var o=r.ItemUtils.getShuXingByName(i[n][0]);s.text=o.desc+":"+a.ShuXingVo.getString4Vo(i[n][1],o)}else s.removeSelf()}}else this.box_suit2.removeSelf()},i}(ui.rexue.tips.RxTips_suitUI);e.RxTips_suit=i}),define("src/g/rexue/view/Tips/RxTips_Skill",["require","exports","../../../../manager/RoleCenter","../../../../vo/ReXueUtil","../../../../vo/SkillTipsVo","../../../net/messages/rexue/sbkRXMsg","../../../../manager/GameSocketManager","src/init/TextConst","../../../../enum/enumItem"],function(t,e,i,o,s,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function n(){var t=e.call(this)||this;return t._hidx=0,t._skillTarg=0,t._skillOpen=!1,t.lab_des.style.font="SimHei",t.lab_des.style.fontSize=18,t.lab_des.style.color="#a89e8f",t.addEvent(),t}return __extends(n,e),n.create=function(t,e){void 0===t&&(t=0),void 0===e&&(e=6);var i=new n;i.initData(t,e),i.popup()},n.prototype.addEvent=function(){this.btn_go.once(Laya.Event.CLICK,this,this.onOpenClick)},n.prototype.onOpenClick=function(){var t=new a.RXEquipSuitSkill_JiHuoC2GS;t.heroIdx=this._hidx,t.skillId=this._skillTarg,r.GSM.sendServer(t),this.close()},n.prototype.initData=function(t,e){this._hidx=t,this._skillTarg=e,this._hero=i.RoleCenter.instans.vo.getOpenHeroByIdx(t),this._rxData=this._hero.rxData,this._skillOpen=-1<this._rxData.equipSuitSkills_jihuo.indexOf(e),this._vo=s.SkillTipsStruct.getVoById1(e),this.renderView()},n.prototype.renderView=function(){this.renderDlg(),this.renderBtn(),this.renderSuit()},n.prototype.renderBtn=function(){this.btn_go.visible=!this._skillOpen},n.prototype.renderSuit=function(){var t=[],e=0,i=0;switch(this._skillTarg){case 6:i=e=1;break;case 7:i=e=2;break;case 8:i=e=3}this.lab_need.text=l.TextConst.get(870,e),t=(t=t.concat(o.ReXueUtil.getReXueSuitPosArr_shenbing(this._hidx,e))).concat(o.ReXueUtil.getReXueSuitPosArr_shouhu(this._hidx,i));for(var n=0,s=0;s<t.length;s++)t[s][1]&&n++;this.btn_go.disabled=8!=n,this.suitItem.initItems(t,h.enumItem.arr_equipPosNameRx)},n.prototype.renderDlg=function(){this.img_tip.skin="dynamic/skilltips/"+this._vo.descPic+".png",this.img_title.skin="dynamic/skilltips/"+this._vo.namePic+".png",this.img_ani.skin="dynamic/skilltips/"+this._vo.ani+".png";for(var t=s.SkillTipsStruct.getWingPvo(this._vo.id_1),e=t.desc,i=0;i<t.effect.length;i++)e=e.replace("{"+t.effect[i][0]+"}",t.effect[i][1]);e=e.replace("{rate}",(t.rate/100).toFixed(1)+""),this.lab_des.innerHTML=e},n}(ui.rexue.tips.RxTips_SkillUI);e.RxTips_Skill=n}),define("src/g/rexue/view/page/ReXueEquipPage",["require","exports","../../../../utils/ItemUtils","../../../../config/GameConfig","../../../../vo/ReXueUtil","src/g/rexue/view/page/ReXueEqChangeDlg","../../../net/messages/PutonEquipC2GS","src/g/rexue/view/Tips/RxTips_or","src/g/rexue/view/Tips/RxTips_eq","src/g/rexue/view/page/ReXueCompDlg","../../../../vo/ReXueStruct","../../../../manager/RoleCenter","src/g/Effects/UIEffectsFactory","src/g/rexue/view/Tips/RxTips_suit","src/init/Switches","../../../../vo/RedDot/RedDot_ReXue","src/g/rexue/view/Tips/RxTips_Skill","../../../../vo/SkillTipsVo","../../../../meta/QualiyVo","../../../../meta/CommonVo","src/init/TextConst","../../../../utils/RoleUtil"],function(t,e,l,h,c,a,r,n,u,p,d,g,v,i,f,s,o,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var b=function(e){function t(){var t=e.call(this)||this;return t._heroIdx=0,t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){for(var t=1;t<=8;t++)this.getChildByName("eq_"+t).setClickHandler(new Laya.Handler(this,this.onEquipClick));for(t=0;t<4;t++)this.getChildByName("or_"+t).setClickHandler(new Laya.Handler(this,this.onOrnamentClick));for(t=0;t<3;t++)this["skill_"+t].on(Laya.Event.CLICK,this,this.onSkillClick,[this["skill_"+t].name]);this.btn_suit.on(Laya.Event.CLICK,this,this.showSuit),this.btn_xw.on(Laya.Event.CLICK,this,this.onxwClick)},t.prototype.onxwClick=function(t){f.Switches.ins.event(217,[!1])},t.prototype.onSkillClick=function(t){o.RxTips_Skill.create(this._heroIdx,parseInt(t+""))},t.prototype.showSuit=function(){i.RxTips_suit.create(this._heroIdx)},t.prototype.refreshData=function(t,e){this._hero=e,this._heroIdx=t,this._data=e.rxData},t.prototype.renderView=function(){this.refreshAni(),this.renderEquip(),this.renderOrnament(),this.renderSkill(),this.renderScore()},t.prototype.renderEquipRed=function(){var t=s.RedDot_ReXue.ins.getEquipRedbyHero(this._heroIdx);if(t)for(var e=1;e<=8;e++){this[ktgame.RoleDefineMod.arr_equipPosConst[e-1]].setRed(t[e-1])}t=s.RedDot_ReXue.ins.getSuitAchivateRedByHidx(this._heroIdx);for(e=0;e<3;e++){this["skill_"+e].img_red.visible=t[e]}},t.prototype.renderOrnamentRed=function(){var t=s.RedDot_ReXue.ins.getOrRedByHero(this._heroIdx);if(t)for(var e=0;e<4;e++){this["or_"+ktgame.RoleDefineMod.arr_suitPosConst[e]].setRed(t[e])}},t.prototype.onEquipClick=function(t,e){if(null!=t)if(t&&0!=t.equins.equid||e!=r.EPosEquip.wuqi&&e!=r.EPosEquip.yifu)if(e!=r.EPosEquip.wuqi&&e!=r.EPosEquip.yifu){if(t&&0!=t.equins.equid)(i=new u.RxTips_eq).initData(this._heroIdx,e,t,t.equins),i.popup();else a.ReXueEqChangeDlg.create(this._heroIdx,e)}else{var i,n=c.ReXueUtil.getEquipVoById(t.equins.equtemplet),s=d.ReXueStruct.Ins.getNexLimit(n.limit);for(n=null;!(0==s||n||g.RoleCenter.instans.vo.getCurLv()<s);)(n=c.ReXueUtil.getEquipVo(e,s))||(s=d.ReXueStruct.Ins.getNexLimit(s));n?(i=new u.RxTips_eq).initData(this._heroIdx,e,t,t.equins,!0,!0):(i=new u.RxTips_eq).initData(this._heroIdx,e,t,t.equins,!0,!1),i.popup()}else p.ReXueCompDlg.create(this._heroIdx,e);else{var o=h.GameConfig.rexuecaoopen[e-1];f.Switches.ins.event(o.module[0][1],[!0,!0])}},t.prototype.onOrnamentClick=function(t,e){var i=new n.RxTips_or;t?i.initData(this._heroIdx,e):i.initData(this._heroIdx,e,0),i.popup()},t.prototype.renderEquip=function(){for(var t=1;t<=8;t++){var e=this._data.openPosArr.indexOf(t),i=0<=e,n=this[ktgame.RoleDefineMod.arr_equipPosConst[t-1]];if(i){var s=this._data.equipArr[e];if(0==s.equins.equid)n.setIcon("res/custom/equipIcon/rx_"+ktgame.RoleDefineMod.arr_equipPosConst[t-1]+".png"),n.setStarSmall(0),n.setName("","",l.ItemUtils.getQualitybjByQualityId(_.CommonVo.getVoByKey("qulity_rexue").val2num)),1!=t&&3!=t||n.setName(C.TextConst.get(707),"#3ecf1a",l.ItemUtils.getQualitybjByQualityId(_.CommonVo.getVoByKey("qulity_rexue").val2num)),n.item.item.effect_con.removeChildren();else{var o=c.ReXueUtil.getEquipVoById(s.equins.equtemplet);n.setIcon(l.ItemUtils.getIconByIconId(o.icon)),n.setStarSmall(o.id%10),n.setName(o.name,l.ItemUtils.getColorByQuality(o.quality),l.ItemUtils.getQualitybjByQualityId(o.quality));var a=m.QualityStruct.Ins.getQEffById(o.quality);v.UIEffectsFactory.Ins.createAndCenter(n.item.item.effect_con,a,!0,1,1)}n.setData(s,t),n.setUnLock(!0)}else{var r=h.GameConfig.rexuecaoopen[t-1];n.setIcon("res/custom/equipIcon/rx_"+ktgame.RoleDefineMod.arr_equipPosConst[t-1]+".png"),n.setUnLock(!1),n.setData(null,t),n.setStarSmall(0),n.setName(r.channel,"#3ecf1a",l.ItemUtils.getQualitybjByQualityId(_.CommonVo.getVoByKey("qulity_rexue").val2num),!1),n.item.item.effect_con.removeChildren()}}},t.prototype.renderOrnament=function(){for(var t=0;t<4;t++){var e=this["or_"+ktgame.RoleDefineMod.arr_suitPosConst[t]],i=c.ReXueUtil.getOrnamentVo(t+1,this._data.curNeishiLv[t]),n=i&&0!=i.level?"":"_gray";i&&0!=i.level?(e.setStarSmall(i.suit),e.setName(i.name,l.ItemUtils.getColorByQuality(_.CommonVo.getVoByKey("qulity_rexuejihuo").val2num),l.ItemUtils.getQualitybjByQualityId(_.CommonVo.getVoByKey("qulity_rexuejihuo").val2num))):(e.setStarSmall(0),e.setName("","",l.ItemUtils.getQualitybjByQualityId(_.CommonVo.getVoByKey("qulity_rexue").val2num))),e.setIcon("res/custom/equipIcon/rx_"+ktgame.RoleDefineMod.arr_suitPosConst[t]+n+".png"),e.setData(i,t),e.setUnLock(!0)}},t.prototype.renderSkill=function(){for(var t,e=[],i=0;i<3;i++){e.length=0,t=this["skill_"+i];y.SkillTipsStruct.getVoById1(t.name);t.img_icon.skin="res/rexue/rexue_jineng_0"+(i+1)+".png",e=(e=e.concat(c.ReXueUtil.getReXueSuitPosArr_shenbing(this._heroIdx,i+1))).concat(c.ReXueUtil.getReXueSuitPosArr_shouhu(this._heroIdx,i+1));for(var n=0,s=0;s<e.length;s++)e[s][1]&&(n+=1);t.setOpenNum(n)}},t.prototype.renderScore=function(){this.box_score.img_titile.skin="res/rexue/rexue_pingfen"+this._hero.jobid+".png",this.box_score.clip_score.value=this._data.pingfen+"",this.box_fight.num_Fight.value=this._data.pingfen+""},t.prototype.refreshAni=function(){I.RoleUtil.refreshZww(this._hero,120,this.ani_wing,this.ani_weapon,this.ani_role,this.ani_fumo)},t}(ui.rexue.page.ReXueEquipPageUI);e.ReXueEquipPage=b}),define("src/g/rexue/ctrl/page/ReXueEquipCtrl",["require","exports","src/g/rexue/view/page/ReXueEquipPage","../../../../manager/RoleCenter","src/init/ResManager","../../../../core/E","../../../../enum/EventName","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(){this.addEvent()}return t.prototype.loadUrls=function(){},t.prototype.addEvent=function(){},t.prototype.init=function(){this._view=new i.ReXueEquipPage},t.prototype.showPage=function(t,e){var i=this._view;i||(this.init(),i=this._view),t.removeChildren(),t.addChild(i),this.changePerson(e,n.RoleCenter.instans.vo.getOpenHeroByIdx(e)),o.E.ins.on(a.EventName.REXUE_RED_EQUIPPAGE,this,this.redChangeHandler),r.ClearResM.resetViewImg(i),s.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t,e){this._view&&(this._view.refreshData(t,e),this.refreshData())},t.prototype.refreshData=function(){this._view&&(this._view.renderView(),this.redChangeHandler())},t.prototype.getTitle=function(){return"res/rexue/rexue_biaotiwenzi1.png"},t.prototype.redChangeHandler=function(){var t=this._view;t&&(t.renderEquipRed(),t.renderOrnamentRed())},t.prototype.hidePage=function(){o.E.ins.off(a.EventName.REXUE_RED_EQUIPPAGE,this,this.redChangeHandler),s.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){s.ResManager.getInstance().destroyPageCtrl(this)},t}();e.ReXueEquipCtrl=l}),define("src/g/rexue/view/page/ReXueStoneSelectDlg",["require","exports","../../../../config/GameConfig","../../../../manager/RoleCenter","../../../../utils/ItemUtils","../../../../meta/ShuXingVo","../../../net/messages/rexue/sbkRXMsg","../../../../manager/GameSocketManager","src/g/itemGets/View/ItemGetDlg","src/g/bag/view/BagMini"],function(t,e,n,a,d,g,r,l,s,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(i){function o(){var t=i.call(this)||this;return t._heroIdx=0,t._eqPos=0,t._stpos=0,t._data=0,t.rexue_stone=n.GameConfig.rexue_stone,t.hc=Laya.Handler.create(t,t.hcCall,null,!1),t.upLv=Laya.Handler.create(t,t.upLvCall,null,!1),t.change=Laya.Handler.create(t,t.changeCall,null,!1),t.putDown=Laya.Handler.create(t,t.putDownCall,null,!1),t.bgview.img_title.y=5,l.GSM.ins.on(r.RXStoneUpgradeMoreMsg.KEY,t,t.hcReceive),t}return __extends(o,i),o.prototype.getTitleUrl=function(){return"res/rexue/rexue_biaotiwenzi1.png"},o.prototype.getRender=function(){return ktgame.rexueequip.ReXueStoneSelectItem},o.create=function(t,e,i,n){var s=new o;s.initData(t,e,i,n),s.popup()},o.prototype.initData=function(t,e,i,n){this._heroIdx=t,this._eqPos=e,this._stpos=i,this._data=n,this.initbag()},o.prototype.initbag=function(){var t=a.RoleCenter.instans.vo.bagdata,e=[],i=this.rexue_stone;for(var n in i){var s=i[n],o=t.getItemCount(s.id);0<o&&e.push({svo:s,num:o})}e.sort(this.sortStoneList),0<this._data&&e.splice(0,0,{svo:i[this._data],num:1}),this.list.dataSource=e},o.prototype.sortStoneList=function(t,e){return e.lv-t.lv},o.prototype.renderHandler=function(t,e){var i=t.dataSource.svo,n=i.id,s=t.dataSource.num,o=0==e&&this._data==n,a=this.rexue_stone[n+1],r=i.name+(1<s?" x"+s:"");if(t.setIcon(d.ItemUtils.getIconByIconId(i.icon)),t.setName(r,d.ItemUtils.getColorByQuality(i.quality)),t.setlv(i.lv),t.isPutIng(o),!o){var l=!1;(!a||s<i.worth[0][1]+1)&&(l=!0),t.btn_hc.disabled=l}for(var h="",c=i.prop,u=0;u<c.length;u++){var p=d.ItemUtils.getShuXingByName(c[u][0]);h+=p.desc+" +"+g.ShuXingVo.getString4Vo(c[u][1],p)+"    "}t.setAttr(h),t.setData(n),t.setCallBackHandler(this.putDown,this.change,this.upLv,this.hc),o&&(t.btn_upLv.visible=!!a)},o.prototype.hcReceive=function(t){this.initbag()},o.prototype.hcCall=function(t){var e=this.rexue_stone[t],i=this.rexue_stone[t+1],n=e.worth,s=a.RoleCenter.instans.vo.bagdata.getItemCount(n[0][0]);if(i&&!(n[0][1]+1>s)){var o=new r.RXStoneUpgradeMoreMsg;o.stoneArr=[t+1,1],l.GSM.sendServer(o)}},o.prototype.putDownCall=function(t){var e=new r.RXStoneMsg;e.heroIdx=this._heroIdx,e.pos=this._eqPos,e.idx=this._stpos,e.type=2,e.stoneId=t,l.GSM.sendServer(e),this.close()},o.prototype.upLvCall=function(t){var e=this.rexue_stone[t],i=a.RoleCenter.instans.vo.bagdata.getItemCount(e.worth[0][0]);if(e.worth[0][1]>i){(new s.ItemGetDlg).initByVo(d.ItemUtils.getItemVoById(e.id),null).popup()}else{var n=new r.RXStoneUpgradeMsg;n.heroIdx=this._heroIdx,n.pos=this._eqPos,n.idx=this._stpos,n.stoneId=t,l.GSM.sendServer(n),this.close()}},o.prototype.close=function(t,e){i.prototype.close.call(this,t,e),this.hc.recover(),this.upLv.recover(),this.change.recover(),this.putDown.recover(),l.GSM.ins.off(r.RXStoneUpgradeMoreMsg.KEY,this,this.hcReceive)},o.prototype.changeCall=function(t){var e=new r.RXStoneMsg;e.heroIdx=this._heroIdx,e.pos=this._eqPos,e.idx=this._stpos,e.type=1,e.stoneId=t,l.GSM.sendServer(e),this.close()},o}(i.BagMini);e.ReXueStoneSelectDlg=o}),define("src/g/rexue/view/page/ReXueEquipResloveDlg",["require","exports","../../../../enum/EventName","../../../net/messages/EquipSplitC2GS","../../../net/messages/sbkEquipIns","../../../../manager/RoleCenter","../../../../vo/ReXueUtil","../../../../utils/ItemUtils","../../../../manager/GameSocketManager","src/g/bag/tips/view/ItemTips","../../../../core/E","../../../../meta/CommonVo","src/g/bag/vo/BagDataVo","src/g/bag/view/BagMini","../../../../vo/sbkBagVo","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(e){function t(){var t=e.call(this)||this;return t.bgview.img_title.y=5,c.E.ins.on(i.EventName.RESLOVE_EQUIP_REXUE,t,t.initData),t.initData(),t}return __extends(t,e),t.prototype.getTitleUrl=function(){return"res/rexue/rexue_biaotiwenzi1.png"},t.prototype.getRender=function(){return ktgame.rexueequip.ReXueChangItem},t.create=function(){(new t).popup()},t.prototype.initData=function(){this.bag=o.RoleCenter.instans.vo.bagdata;for(var t=[],e=g.sbkBagVo.rxEqArr,i=0;i<e.length;i++){a.ReXueUtil.getEquipVoById(e[i].equtemplet).limit<=o.RoleCenter.instans.vo.getCurLv()&&t.push(e[i])}this.list.dataSource=t},t.prototype.renderHandler=function(t,e){var i=t.dataSource;t.lab_fight.text=i.combat+"",t.lab_score.text=t.lab_fight.text;var n=a.ReXueUtil.getEquipVoById(i.equtemplet);t.setClickedHandler(new Laya.Handler(this,this.clickHandler,[i])),t.item_.setIcon(r.ItemUtils.getIconByIconId(n.icon)),t.item_.setName("","",r.ItemUtils.getQualitybjByQualityId(u.CommonVo.getVoByKey("qulity_rexuejihuo").val2num)),t.item_.setData(i,n.pos),t.setTipsHandler(new Laya.Handler(this,this.onShowEqTip,[i])),t.item_.setStarSmall(n.id%10),t.item_.setUnLock(!0),t.btn_change.label=v.TextConst.get(811)},t.prototype.onShowEqTip=function(t){var e=new p.BagDataVo;e.type=s.enumEquipType.rxEquip,e.equid=t.equid,h.ItemTips.ins.showTips(e)},t.prototype.clickHandler=function(t){var e=new n.EquipSplitC2GS;e.splittype=n.ESplitType.rxEquip,e.equipidarr.push(t.equid),l.GSM.sendServer(e)},t.prototype.close=function(){c.E.ins.off(i.EventName.RESLOVE_EQUIP_REXUE,this,this.initData),e.prototype.close.call(this)},t}(d.BagMini);e.ReXueEquipResloveDlg=f}),define("src/g/rexue/view/Tips/RxTips_stone",["require","exports","../../../../manager/RoleCenter","../../../../meta/ShuXingVo","../../../../utils/ItemUtils","../../../../vo/ReXueStruct"],function(t,e,n,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function i(){var t=e.call(this)||this;return t.suit1id=0,t.suit2id=0,t.suit3id=0,t}return __extends(i,e),i.create=function(t){var e=new i;e.initData(t),e.popup()},i.prototype.initData=function(t){this._heroIdx=t,this._heroVo=n.RoleCenter.instans.vo.getOpenHeroByIdx(t),this._data=this._heroVo.rxData,this.suit1id=this._data.curStoneSuit1lv,this.suit2id=this._data.curStoneSuit2lv,this.suit3id=this._data.curStoneSuit3lv,this.renderView()},i.prototype.renderView=function(){this.renderNowAttr(),this.renderHpSuit(),this.renderAttSuit(),this.renderDefSuit()},i.prototype.renderNowAttr=function(){var t=this._data.stouneSuitProp,e=[];for(var i in t){if("number"==typeof t[i])if(!(t[i]<=0))(s=r.ItemUtils.getShuXingByName(i))&&e.push([i,t[i]])}0==e.length?this.box_attr.removeSelf():this.lab_notHave.removeSelf();for(var n=0;n<8;n++){var s,o=this["has_"+n];if(e[n])(s=r.ItemUtils.getShuXingByName(e[n][0]))?o.text=s.desc+":"+a.ShuXingVo.getString4Vo(e[n][1],s):o.removeSelf();else o.removeSelf()}},i.prototype.renderHpSuit=function(){var t=l.ReXueStruct.Ins.getNextStLv(this.suit1id);if(0!=t){var e=l.ReXueStruct.Ins.getStSuitVo(1,t);if(e){this.lab_name_hp.text=e.name;for(var i=e.prop,n=0;n<10;n++){var s=this.box_hp.getChildByName("sname_"+n);if(i[n]){var o=r.ItemUtils.getShuXingByName(i[n][0]);s.text=o.desc+":"+a.ShuXingVo.getString4Vo(i[n][1],o)}else s.removeSelf()}}else this.box_hp.removeSelf()}else this.box_hp.removeSelf()},i.prototype.renderAttSuit=function(){var t=l.ReXueStruct.Ins.getNextStLv(this.suit2id);if(0!=t){var e=l.ReXueStruct.Ins.getStSuitVo(2,t);if(e){this.lab_name_att.text=e.name;for(var i=e.prop,n=0;n<10;n++){var s=this.box_att.getChildByName("sname_"+n);if(i[n]){var o=r.ItemUtils.getShuXingByName(i[n][0]);s.text=o.desc+":"+a.ShuXingVo.getString4Vo(i[n][1],o)}else s.removeSelf()}}else this.box_attr.removeSelf()}else this.box_attr.removeSelf()},i.prototype.renderDefSuit=function(){var t=l.ReXueStruct.Ins.getNextStLv(this.suit3id);if(0!=t){var e=l.ReXueStruct.Ins.getStSuitVo(3,t);if(e){this.lab_name_def.text=e.name;for(var i=e.prop,n=0;n<10;n++){var s=this.box_def.getChildByName("sname_"+n);if(i[n]){var o=r.ItemUtils.getShuXingByName(i[n][0]);s.text=o.desc+":"+a.ShuXingVo.getString4Vo(i[n][1],o)}else s.removeSelf()}}else this.box_def.removeSelf()}else this.box_def.removeSelf()},i}(ui.rexue.tips.RxTips_stoneUI);e.RxTips_stone=i}),define("src/g/rexue/view/page/SoulStonePage",["require","exports","../../../../config/GameConfig","../../../../vo/ReXueUtil","../../../../utils/ItemUtils","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","src/g/rexue/view/page/ReXueStoneSelectDlg","../../../../meta/ShuXingVo","src/g/rexue/view/page/ReXueEquipResloveDlg","../../../net/messages/sbkFormula","src/g/Effects/UIEffectsFactory","src/g/rexue/view/Tips/RxTips_stone","../../../net/messages/rexue/sbkRXMsg","../../../../manager/GameSocketManager","../../../../manager/RoleCenter","../../../../vo/RedDot/RedDot_ReXue","../../../../meta/QualiyVo","../../../../meta/CommonVo","../../../../vo/sbkBagVo","../../../../core/E","../../../../enum/EventName","src/init/TextConst"],function(t,e,u,l,h,p,d,i,n,s,o,c,a,r,g,v,f,y,m,_,C,I,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var w=function(e){function t(){var t=e.call(this)||this;return t._heroIdx=0,t._pos=-1,t.bagStoneNumObj={},t.initView(),t.lab_reslove.on(Laya.Event.CLICK,t,t.openResloveDlg),t.btn_showSuit.on(Laya.Event.CLICK,t,t.openHunSuitDlg),t.btn_comp.on(Laya.Event.CLICK,t,t.onAutoPut),C.E.ins.on(I.EventName.REXUE_EQUIP_CHANGE,t,t.refreshResloveAni),t}return __extends(t,e),t.prototype.onAutoPut=function(){if(0!=this._postion.equins.equid){var t=v.RoleCenter.instans.vo.bagdata,e=[],i=[];for(var n in u.GameConfig.rexue_stone){var s=u.GameConfig.rexue_stone[n],o=t.getItemCount(s.id);0<o&&e.push({svo:s,num:o})}if(0!=e.length){e.sort(this.sortStoneList);for(n=0;n<e.length;n++)i.push(e[n].svo.id);for(var a=0;a<this._postion.stoneIdArr.length;a++)if(0!=e.length){var r=this._postion.stoneIdArr[a];if(0!=r){var l=u.GameConfig.rexue_stone[r],h=l.worth;if(h&&0!=h.length){var c=i.indexOf(parseInt(h[0][0]+""));if(-1!=c&&e[c].num>=h[0][1])this.sendUpMsg(a,i[c]),e[c].num==h[0][1]?(e.splice(c,1),i.splice(c,1)):e[c].num-=h[0][1];else for(n=0;n<e.length;n++)if(l.type==e[n].svo.type&&l.lv<e[n].svo.lv){this.sendChangeMsg(a,i[n]),1==e[n].num?(e.splice(n,1),i.splice(n,1)):e[n].num-=1;break}}}else this.sendChangeMsg(a,i[0]),1==e[0].num?(e.splice(0,1),i.splice(0,1)):e[0].num-=1}}else p.FE.upItems(b.TextConst.get(841),d.BubbleEnum.center)}else p.FE.upItems(b.TextConst.get(840),d.BubbleEnum.center)},t.prototype.sortStoneList=function(t,e){return e.svo.lv-t.svo.lv},t.prototype.sendChangeMsg=function(t,e){var i=new r.RXStoneMsg;i.heroIdx=this._heroIdx,i.pos=this._pos,i.idx=t,i.type=1,i.stoneId=e,g.GSM.sendServer(i)},t.prototype.sendUpMsg=function(t,e){var i=new r.RXStoneUpgradeMsg;i.heroIdx=this._heroIdx,i.pos=this._pos,i.idx=t,i.stoneId=e,g.GSM.sendServer(i)},t.prototype.openHunSuitDlg=function(){a.RxTips_stone.create(this._heroIdx)},t.prototype.openResloveDlg=function(){s.ReXueEquipResloveDlg.create()},t.prototype.initView=function(){for(var t=0;t<3;t++){var e=t;this["stone_"+t].on(Laya.Event.CLICK,this,this.stoneClick,[e])}for(t=1;t<=8;t++){e=t;this[ktgame.RoleDefineMod.arr_equipPosConst[t-1]].on(Laya.Event.CLICK,this,this.eqItemSelect,[e])}c.UIEffectsFactory.Ins.createAndCenter(this.aniSp,42,!0)},t.prototype.refreshData=function(t,e){this._hero=e,this._heroIdx=t,this._data=e.rxData,this.renderView()},t.prototype.renderView=function(){this.renderEquip(),this.renderSelectEquip(),this.renderEqItem(),this.renderAttr(),this.renderFight(),this.redChangeHandler(),this.refreshResloveAni()},t.prototype.refreshResloveAni=function(){for(var t=[],e=_.sbkBagVo.rxEqArr,i=0;i<e.length;i++){l.ReXueUtil.getEquipVoById(e[i].equtemplet).limit<=v.RoleCenter.instans.vo.getCurLv()&&t.push(e[i])}this.aniSp&&(this.aniSp.visible=0<t.length)},t.prototype.redChangeHandler=function(){this instanceof t&&(this.refershUIEFF(),this.refreshRedHint(),this.refreshRedByBase())},t.prototype.refershUIEFF=function(){},t.prototype.refreshRedHint=function(){for(var t=f.RedDot_ReXue.ins.getHunStoneRedByHeroIdx(this._heroIdx),e=1;e<=8;e++){this[ktgame.RoleDefineMod.arr_equipPosConst[e-1]].setRed(t[e-1])}},t.prototype.refreshRedByBase=function(){for(var t=f.RedDot_ReXue.ins.getHunStoneRedByPos(this._heroIdx,this._postion.equpos),e=0;e<3;e++){this["stone_"+e].img_red.visible=t[e]}},t.prototype.renderFight=function(){this.clip_score.value=o.sbkFormula.calPropFightMainCombat(this._hero.prop_rxStone)+"",this.box_fight.setFightNum(o.sbkFormula.calPropFightMainCombat(this._hero.prop_rxStone))},t.prototype.renderSelectEquip=function(){this.setSelect(this._pos),this.renderStone()},t.prototype.renderStone=function(){for(var t=0==this._postion.equins.equid,e=0;e<3;e++){var i=this["stone_"+e];if(t)i.img_icon.skin="",i.img_lock.visible=!0,i.lab_lv.text="";else if(0==this._postion.stoneIdArr[e])i.img_icon.skin="",i.img_lock.visible=!1,i.lab_lv.text="";else{var n=u.GameConfig.rexue_stone[this._postion.stoneIdArr[e]];i.img_icon.skin=h.ItemUtils.getIconByIconId(n.icon),i.img_lock.visible=!1,i.lab_lv.text="Lv."+n.lv}}this.refreshRedByBase()},t.prototype.openView=function(t,e){this._hero=e,this._heroIdx=t,this._data=e.rxData,this.findOpen(),this.eqItemSelect(this._pos)},t.prototype.findOpen=function(){for(var t in this.bagStoneNumObj={},u.GameConfig.rexue_stone){var e=v.RoleCenter.instans.vo.bagdata.getItemCount(u.GameConfig.rexue_stone[t].id);0<e&&(this.bagStoneNumObj[t]=e,this.bagStoneNumObj.length&&0!=this.bagStoneNumObj.length||(this.bagStoneNumObj.length=0),this.bagStoneNumObj.length++)}for(var i=0;i<this._data.openPosArr.length;i++)if(this.checkByPos(this._data.equipArr[i]))return this._pos=this._data.openPosArr[i],void(this._postion=this._data.equipArr[i]);this._pos=this._data.openPosArr[0],this._postion=this._data.equipArr[0]},t.prototype.checkByPos=function(t){if(0==t.equins.equid)return!1;for(var e=[],i=t.stoneIdArr,n=0;n<3;n++){var s=i[n];if(0!=s){var o=u.GameConfig.rexue_stone[s].worth;if(o&&0<o.length)for(var a=0;a<o.length;a++)!this.bagStoneNumObj[o[a][0]]||this.bagStoneNumObj[o[a][0]]<o[a][1]?e.push(!1):this.bagStoneNumObj[o[a][0]]<o[a][1]?e.push(!1):e.push(!0);else e.push(!1)}else e.push(0<this.bagStoneNumObj.length)}return 0<e.length},t.prototype.stoneClick=function(t){0!=this._postion.equins.equid?i.ReXueStoneSelectDlg.create(this._heroIdx,this._pos,t,this._postion.stoneIdArr[t]):p.FE.upItems(b.TextConst.get(712),d.BubbleEnum.center)},t.prototype.eqItemSelect=function(t){var e=this._data.openPosArr.indexOf(t);-1!=e?(this._pos=t,this._postion=this._data.equipArr[e],this.renderView()):p.FE.upItems(b.TextConst.get(713),d.BubbleEnum.center)},t.prototype.renderEqItem=function(){var t=l.ReXueUtil.getEquipVoById(this._postion.equins.equtemplet);this.img_item.item.item.item.img_quality.visible=!1,t?(this.img_item.setStarSmall(),this.img_item.setIcon(h.ItemUtils.getIconByIconId(t.icon)),this.img_item.setName("",h.ItemUtils.getColorByQuality(t.quality),h.ItemUtils.getQualitybjByQualityId(t.quality))):(this.img_item.setIcon(),this.img_item.setStarSmall(),this.img_item.setName("",y.QualityStruct.Ins.getQColorById(m.CommonVo.getVoByKey("qulity_rexue").val2num),h.ItemUtils.getQualitybjByQualityId(m.CommonVo.getVoByKey("qulity_rexue").val2num),!1)),this.img_item.setUnLock(!0)},t.prototype.renderAttr=function(){for(var t in this._hero.prop_rxStone){var e=h.ItemUtils.getShuXingByName(t);e&&!isNaN(this._hero.prop_rxStone[t])&&(this["lab_"+e.name].text=e.desc+" : "+n.ShuXingVo.getString4Vo(this._hero.prop_rxStone[t],e))}},t.prototype.renderEquip=function(){for(var t=1;t<=8;t++){var e=this._data.openPosArr.indexOf(t),i=0<=e,n=this[ktgame.RoleDefineMod.arr_equipPosConst[t-1]];if(i){var s=this._data.equipArr[e];if(0==s.equins.equid)n.setIcon("res/custom/equipIcon/rx_"+ktgame.RoleDefineMod.arr_equipPosConst[t-1]+".png"),n.setStarSmall(),n.setName("","",h.ItemUtils.getQualitybjByQualityId(m.CommonVo.getVoByKey("qulity_rexue").val2num)),n.item.item.effect_con.removeChildren();else{var o=l.ReXueUtil.getEquipVoById(s.equins.equtemplet);n.setIcon(h.ItemUtils.getIconByIconId(o.icon)),n.setStarSmall(o.id%10),n.setName(o.name,h.ItemUtils.getColorByQuality(o.quality),h.ItemUtils.getQualitybjByQualityId(o.quality));var a=y.QualityStruct.Ins.getQEffById(o.quality);c.UIEffectsFactory.Ins.createAndCenter(n.item.item.effect_con,a,!0,1,1)}n.setData(s,t),n.setUnLock(!0)}else{var r=u.GameConfig.rexuecaoopen[t-1];n.setIcon(),n.setUnLock(!1),n.setData(null,t),n.setStarSmall(),n.setName(r.channel,"#3ecf1a",h.ItemUtils.getQualitybjByQualityId(m.CommonVo.getVoByKey("qulity_rexue").val2num),!1),n.item.item.effect_con.removeChildren()}}},t.prototype.setSelect=function(t){for(var e=1;e<=8;e++){this[ktgame.RoleDefineMod.arr_equipPosConst[e-1]].setSelect(t==e)}},t}(ui.rexue.page.SoulStonePageUI);e.SoulStonePage=w}),define("src/g/rexue/ctrl/page/SoulStoneCtrl",["require","exports","../../../../manager/RoleCenter","src/g/rexue/view/page/SoulStonePage","../../../../enum/EventName","../../../../core/E"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){}return t.prototype.init=function(){this._view=new n.SoulStonePage},t.prototype.showPage=function(t,e){this._view||this.init(),t.removeChildren(),t.addChild(this._view),o.E.ins.on(s.EventName.REXUE_RED_SOULSTONEPAGE,this,this.changeRed),this.changePerson(e,i.RoleCenter.instans.vo.getOpenHeroByIdx(e)),this._view.bg.restskin()},t.prototype.changeRed=function(){this._view&&this._view.displayedInStage&&(this._view.redChangeHandler(),this._view.refreshResloveAni())},t.prototype.loadUrls=function(){},t.prototype.changePerson=function(t,e){this._view&&this._view.openView(t,e)},t.prototype.refreshData=function(){this._view&&this._view.renderView()},t.prototype.getTitle=function(){return"res/rexue/rexue_biaotihunshi.png"},t.prototype.hidePage=function(){this._view&&o.E.ins.off(s.EventName.REXUE_RED_SOULSTONEPAGE,this,this._view.redChangeHandler)},t.prototype.destroyPage=function(){},t}();e.SoulStoneCtrl=a}),define("src/g/rexue/view/page/ReXueOrnamentCompPage",["require","exports","../../../../vo/ReXueStruct","../../../../utils/system/ErrCodeView","../../../net/messages/ErrConst","../../../../manager/RoleCenter","../../../../manager/GameSocketManager","../../../net/messages/rexue/sbkRXMsg","../../../../utils/ItemUtils","../../../../vo/ReXueUtil","src/g/peronboss/view/ItemIconView","src/g/rexue/view/Tips/RxTips_eq","src/g/rexue/view/page/ReXueCompSelectDlg","src/g/itemGets/View/ItemGetDlg","src/g/Effects/UIEffectsFactory","../../../../meta/QualiyVo","../../../../vo/RedDot/RedDot_ReXue","../../../../vo/sbkBagVo","../../../../core/E","../../../../enum/EventName","src/init/TextConst"],function(t,e,i,n,s,o,a,r,h,c,l,u,p,d,g,v,f,y,m,_,C){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var I=function(e){function t(){var t=e.call(this)||this;return t.nowSelectIdx=-1,t.eqidArr=[0,0],t.btn_comp.on(Laya.Event.CLICK,t,t.onBtnClick),t.item_1.on(Laya.Event.CLICK,t,t.eqItemClick,[0]),t.item_2.on(Laya.Event.CLICK,t,t.eqItemClick,[1]),t.lab_getItem.on(Laya.Event.CLICK,t,t.onGetItem),m.E.ins.on(_.EventName.REXUE_RED_ORCOMP,t,t.renderRed),t}return __extends(t,e),t.prototype.onGetItem=function(){d.ItemGetDlg.create(170)},t.prototype.eqItemClick=function(t){var e=c.ReXueUtil.getEquipVoById(this.orCompVo["equId"+(t+1)][0]);if(this.eqidArr[t]){var i=new u.RxTips_eq;i.initData(0,e.pos,null,this.bag.getEquip(this.eqidArr[t]),!0),i.popup()}else{for(var n=c.ReXueUtil.getEquipVoById(this.orCompVo["equId"+(t+1)][0]),s=[],o=0;o<2;o++)0<this.eqidArr[o]&&s.push(this.bag.getEquip(this.eqidArr[o]));p.ReXueCompSelectDlg.create(n.pos,t,this.orCompVo["equId"+(t+1)],s,new Laya.Handler(this,this.eqSelectCallBack,[t]))}},t.prototype.setSelect=function(t){this.nowSelectIdx=t,this.orCompVo=i.ReXueStruct.getRxOrCompVoById(t+1),this.eqidArr=[0,0],this.uvo=o.RoleCenter.instans.vo,this.bag=this.uvo.bagdata,this.rxData=null,this.renderTopItem(),this.renderEquips(),this.renderNeedItem(),this.renderAttr(),this.renderRed()},t.prototype.renderRed=function(){for(var t=f.RedDot_ReXue.ins.getOrCompRed(!0),e=0;e<4;e++)this["red_"+e].visible=t[e]},t.prototype.renderTopItem=function(){l.ItemIconView.setItemData(h.ItemUtils.getItemVoById(this.orCompVo.reward[0]),this.item_reward)},t.prototype.renderEquips=function(){for(var t=0;t<this.eqidArr.length;t++)this.renderEqFor(t)},t.prototype.renderEqFor=function(t){var e=this.eqidArr[t],i=this["item_"+(t+1)];i.setUnLock(!0);for(var n=0;n<this.eqidArr.length;n++)0==this.eqidArr[n]&&0;var s=0,o=this.orCompVo["equId"+(t+1)];for(n=0;n<o.length;n++)s+=y.sbkBagVo.hasRxIdEqCount(o[n]);for(n=0;n<this.eqidArr.length;n++)0!=this.eqidArr[n]&&s--;var a,r=this.bag.getEquip(e);if(0==e)i.showAdd(!0),i.setIcon(""),a=c.ReXueUtil.getEquipVoById(this.orCompVo["equId"+(t+1)][0]),i.setStarSmall(),i.setName(a.name,h.ItemUtils.getColorByQuality(a.quality),h.ItemUtils.getQualitybjByQualityId(a.quality)),i.item.item.effect_con.removeChildren(),i.item.img_red.visible=1<=s;else{a=c.ReXueUtil.getEquipVoById(r.equtemplet),i.showAdd(!1),i.setIcon(h.ItemUtils.getIconByIconId(a.icon)),i.setStarSmall(a.id%10),i.setName(a.name,h.ItemUtils.getColorByQuality(a.quality),h.ItemUtils.getQualitybjByQualityId(a.quality));var l=v.QualityStruct.Ins.getQEffById(a.quality);g.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(i.item.item.effect_con,l),i.item.img_red.visible=!1}},t.prototype.renderNeedItem=function(){l.ItemIconView.setItemData(h.ItemUtils.getItemVoById(this.orCompVo.needItem[0]),this.item_needItem),this.item_needItem.lvl.visible=!1;var t=h.ItemUtils.getItemVoById(this.orCompVo.needItem[0]);this.lab_item_name.text=t.name,this.lab_item_name.color=h.ItemUtils.getColorByQuality(t.quality);var e=this.bag.getItemCount(this.orCompVo.needItem[0][0]);this.lab_item_count.text="("+e+"/"+this.orCompVo.needItem[0][1]+")",this.lab_item_count.color=e>=this.orCompVo.needItem[0][1]?"#09d51f":"#ff0f15"},t.prototype.renderAttr=function(){for(var t=0;t<this.uvo.heronum;t++){var e=this.uvo.getOpenHeroByIdx(t).rxData;this.rxData||(this.rxData=e),e.curNeishiLv[this.nowSelectIdx]>this.rxData.curNeishiLv[this.nowSelectIdx]&&(this.rxData=e)}var i=c.ReXueUtil.getOrnamentVo(this.nowSelectIdx+1,this.rxData.curNeishiLv[this.nowSelectIdx]+1),n=i?i.prop.length:0;for(t=0;t<3;t++){var s=this["lab_attr_"+t];if(n<=t&&0!=n)s.visible=!1;else if(s.visible=!0,i&&i.prop&&i.prop[t]){var o=i.prop[t],a=h.ItemUtils.getShuXingByName(o[0]);s.text=a.desc+":";var r=o[1];"%"==a.unit?(r=o[1]/100,s.text+=r+"%"):s.text+=r+""}else s.text=C.TextConst.get(711)}},t.prototype.eqSelectCallBack=function(t,e){this.eqidArr[t]=e.equid,this.renderEquips()},t.prototype.onBtnClick=function(){var t=this.bag.getItemCount(this.orCompVo.needItem[0][0]);if(-1!=this.eqidArr.indexOf(0)||t<this.orCompVo.needItem[0][1])n.ErrCodeView.show(s.enumErrConst.code_2207);else{var e=new r.CompoundRXDecorateC2GS;e.equipIdArr.push(this.eqidArr[0]),e.equipIdArr.push(this.eqidArr[1]),e.recipeId=this.nowSelectIdx+1,a.GSM.sendServer(e)}},t}(ui.rexue.page.ReXueOrnamentCompPageUI);e.ReXueOrnamentCompPage=I}),define("src/g/rexue/ctrl/page/ReXueOrnamentCompPageCtrl",["require","exports","src/g/rexue/view/page/ReXueOrnamentCompPage","src/init/ResManager","../../../../core/E","../../../../enum/EventName"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(){this.nowSelectIdx=-1}return t.prototype.init=function(){this._view=new i.ReXueOrnamentCompPage,this._view.tab_select.selectHandler=new Laya.Handler(this,this.onViewTabSelectChange),s.E.ins.on(o.EventName.CHANGEITEM_COUNT,this,this.onItemCountChange)},t.prototype.onItemCountChange=function(t){170==t&&this._view&&this._view.displayedInStage&&this._view.renderNeedItem()},t.prototype.showPage=function(t,e){this._view||this.init(),t.removeChildren(),t.addChild(this._view),0==this.nowSelectIdx?this.onViewTabSelectChange(0):this._view.tab_select.selectedIndex=0,this._view.bg.restskin(),this._view.renderNeedItem()},t.prototype.loadUrls=function(){},t.prototype.onViewTabSelectChange=function(t){this.nowSelectIdx=t,this._view.setSelect(t)},t.prototype.changePerson=function(t,e){this._view},t.prototype.refreshData=function(){this._view&&this._view.displayedInStage&&this._view.setSelect(this.nowSelectIdx)},t.prototype.getTitle=function(){return"res/rexue/rxzc_hechengbiaoti.png"},t.prototype.hidePage=function(){n.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){n.ResManager.getInstance().destroyPageCtrl(this)},t}();e.ReXueOrnamentCompPageCtrl=a}),define("src/g/rexue/ctrl/ReXueDlgCtrl",["require","exports","src/init/Switches","src/g/accessctrl/AccessCenter","src/g/rexue/view/ReXueDlgView","src/g/proxy/MultiLevelUIProxy","src/g/rexue/ctrl/page/ReXueEquipCtrl","../../../manager/RoleCenter","../../../manager/GameSocketManager","../../net/messages/rexue/sbkRXMsg","../../net/messages/rexue/sbkRXData","src/init/ResManager","src/g/rexue/ctrl/page/SoulStoneCtrl","src/g/base/BaseCtrl","../../../plugin/sbkPropTool","../../../enum/EventName","../../../core/E","../../../vo/RedDot/RedDot_ReXue","src/g/rexue/ctrl/page/ReXueOrnamentCompPageCtrl","../../../vo/ReXueStruct","../../../utils/system/FloatEffect","../../../vo/sbkBagVo","src/init/GameEventDispatcher"],function(t,e,i,s,n,o,a,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var w=function(e){function t(){var t=e.call(this)||this;return t._nowSelectHero=0,t._openArg=[],t.urls=["res/atlas/res/rexue.json"],t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){i.Switches.ins.on(174,this,this.onOpenHandler,[174]),i.Switches.ins.on(175,this,this.onOpenHandler,[175]),i.Switches.ins.on(176,this,this.onOpenHandler,[176]),i.Switches.ins.on(211,this,this.onOpenHandler,[211]);var t=l.GSM.ins;t.on(h.RXEquipSuitGS2C.KEY,this,this.onRXEquipSuitGS2C),t.on(c.sbkRXEquipPosition.KEY,this,this.onsbkRXEquipPosition),t.on(h.RXStoneSuitGS2C.KEY,this,this.onRXStoneSuitGS2C),t.on(h.RXStoneUpgradeMsg.KEY,this,this.onRXStoneUpgradeMsg),t.on(h.RXStoneMsg.KEY,this,this.onRXStoneMsg),t.on(h.RXEquipSuitSkill_JiHuoGS2C.KEY,this,this.onRXEquipSuitSkill_JiHuoGS2C),t.on(h.CompoundRXDecorateGS2C.KEY,this,this.onCompoundRXDecorateGS2C),f.E.ins.on(v.EventName.REXIE_UP_NEISHI,this,this.refreshData),f.E.ins.on(v.EventName.OPENNEW_HERO,this,this.refreshHeroHeadShow),f.E.ins.on(v.EventName.REXUE_RED_EQUIPPAGE,this,this.refreshRedHead)},t.prototype.onCompoundRXDecorateGS2C=function(t){for(var e=0;e<t.equipIdArr.length;e++)I.sbkBagVo.delEquipIns(t.equipIdArr[e]);var i=_.ReXueStruct.getRxOrCompVoById(t.recipeId);for(e=0;e<t.itemArr.length;e+=2)r.RoleCenter.instans.vo.chgItemCount(t.itemArr[e],-t.itemArr[e+1]);r.RoleCenter.instans.vo.chgItemCount(i.reward[0][0],i.reward[0][1]),C.FE.getUpFloats(i.reward),this._orComp&&this._orComp.refreshData()},t.prototype.refreshHeroHeadShow=function(t){void 0===t&&(t=0),this._view&&this._view.tab_head.initData(r.RoleCenter.instans.self.openhero,this._nowSelectHero,r.RoleCenter.instans.vo),this.refreshRedHead()},t.prototype.onRXEquipSuitSkill_JiHuoGS2C=function(t){r.RoleCenter.instans.vo.getOpenHeroByIdx(t.heroIdx).rxData.equipSuitSkills_jihuo=t.equipSuitSkills_jihuo,y.RedDot_ReXue.ins.reCheckAll()},t.prototype.onRXStoneMsg=function(t){var e=r.RoleCenter.instans.vo.getOpenHeroByIdx(t.heroIdx),i=e.rxData;i.equipArr[i.openPosArr.indexOf(t.pos)].stoneIdArr[t.idx]=t.stoneId,g.sbkPropTool.reSetAllReXue(e);var n=r.RoleCenter.instans.vo.combat,s=r.RoleCenter.instans.vo.reCheckComBat();r.RoleCenter.instans.event(v.EventName.FIGHT_UP,s-n),y.RedDot_ReXue.ins.reCheckAll(),this._soulstone&&this._soulstone.refreshData(),b.GE.ins.event(5)},t.prototype.onRXStoneUpgradeMsg=function(t){var e=r.RoleCenter.instans.vo.getOpenHeroByIdx(t.heroIdx),i=e.rxData;i.equipArr[i.openPosArr.indexOf(t.pos)].stoneIdArr[t.idx]=t.stoneId,g.sbkPropTool.reSetAllReXue(e);var n=r.RoleCenter.instans.vo.combat,s=r.RoleCenter.instans.vo.reCheckComBat();r.RoleCenter.instans.event(v.EventName.FIGHT_UP,s-n),y.RedDot_ReXue.ins.reCheckAll(),this._soulstone&&this._soulstone.refreshData()},t.prototype.onRXStoneSuitGS2C=function(t){var e=r.RoleCenter.instans.vo.getOpenHeroByIdx(t.heroIdx),i=e.rxData;i.curStoneSuit1lv=t.curStoneSuit1lv,i.curStoneSuit2lv=t.curStoneSuit2lv,i.curStoneSuit3lv=t.curStoneSuit3lv,g.sbkPropTool.reSetAllReXue(e);var n=r.RoleCenter.instans.vo.combat,s=r.RoleCenter.instans.vo.reCheckComBat();r.RoleCenter.instans.event(v.EventName.FIGHT_UP,s-n)},t.prototype.onsbkRXEquipPosition=function(t){var e=r.RoleCenter.instans.vo.getOpenHeroByIdx(t.heroIdx),i=e.rxData.openPosArr.indexOf(t.equpos);0<=i?e.rxData.equipArr[i].copydata(t):(e.rxData.openPosArr.push(t.equpos),e.rxData.equipArr.push(t)),g.sbkPropTool.reSetAllReXue(e);var n=r.RoleCenter.instans.vo.combat,s=r.RoleCenter.instans.vo.reCheckComBat();r.RoleCenter.instans.event(v.EventName.FIGHT_UP,s-n),y.RedDot_ReXue.ins.reCheckAll(),this._equip&&this._page==this._equip&&this._equip.refreshData()},t.prototype.onRXEquipSuitGS2C=function(t){var e=r.RoleCenter.instans.vo.getOpenHeroByIdx(t.heroIdx).rxData;e.curType1SuitId=t.curType1SuitId,e.curType2SuitId=t.curType2SuitId,g.sbkPropTool.reSetAllReXue(r.RoleCenter.instans.vo.getOpenHeroByIdx(t.heroIdx));var i=r.RoleCenter.instans.vo.combat,n=r.RoleCenter.instans.vo.reCheckComBat();r.RoleCenter.instans.event(v.EventName.FIGHT_UP,n-i),y.RedDot_ReXue.ins.reCheckAll()},t.prototype.onOpenHandler=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1),e&&(174==t?s.AccessCenter.ins.checkOpen(175)?this.openReXueView(175,i,n):s.AccessCenter.ins.checkOpen(176)?this.openReXueView(176,i,n):s.AccessCenter.ins.checkOpen(211)&&this.openReXueView(211,i,n):this.openReXueView(t,i,n))},t.prototype.tab_selectHandler=function(t){this._page&&this._page.hidePage();var e=!0;0==t?this._page=this._equip:1==t?this._page=this._soulstone:2==t&&(e=!1,this._page=this._orComp),this._view.tab_head.visible=e,this._page&&(this._page.showPage(this._view.bg_view.box_page,this._nowSelectHero),this.refreshRedHead()),this._view.bg_view.img_title.skin=this._page.getTitle()},t.prototype.initView=function(){this._view=new n.ReXueDlgView,this._equip=new a.ReXueEquipCtrl,this._soulstone=new p.SoulStoneCtrl,this._orComp=new m.ReXueOrnamentCompPageCtrl,this._tabProxy=new o.MultiLevelUIProxy,this._tabProxy.registerTab(this._view.tab_page,0),this._tabProxy.registerTagIndex(175,0),this._tabProxy.registerTagIndex(176,1),this._tabProxy.registerTagIndex(211,2),this._tabProxy.selectHandler=new Laya.Handler(this,this.tab_selectHandler),this._view.tab_head.setCallbackHandler(new Laya.Handler(this,this.HeroSelect)),this.refreshHeroHeadShow(this._nowSelectHero),this._view.bg_view.btn_back.on(Laya.Event.CLICK,this,this.hidePage),this._view.bg_view.btn_close.on(Laya.Event.CLICK,this,this.hidePage)},t.prototype.openReXueView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._openArg.length=0,this._openArg.push(t),this._openArg.push(e),this._openArg.push(i),this.opens()},t.prototype.onAtlasLoaded=function(){this.realOpenReXueView(this._openArg[0],this._openArg[1],this._openArg[2])},t.prototype.realOpenReXueView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._view||this.initView(),this._tabProxy.open(t),this._view.showView(e,i)},t.prototype.HeroSelect=function(t,e){r.RoleCenter.instans.self.openhero[t]?(this._nowSelectHero=t,this._view.tab_head.setSelectIndex(t),this._page.changePerson(t,r.RoleCenter.instans.vo.getOpenHeroByIdx(t))):i.Switches.ins.event(15)},t.prototype.refreshRedHead=function(){if(this._view)switch(this._view.tab_page.selectedIndex){case 0:this._view.tab_head.refreshHeadRedHint(y.RedDot_ReXue.ins.getEquipPageRed(!0));break;case 1:this._view.tab_head.refreshHeadRedHint(y.RedDot_ReXue.ins.getStonePageRed(!0))}this._page&&this._page==this._equip&&this._page.refreshData()},t.prototype.init=function(){return null},t.prototype.showPage=function(t,e){u.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){this._page&&this._page.refreshData()},t.prototype.getTitle=function(){return null},t.prototype.hidePage=function(){this._view&&this._view.hideView(),this._equip&&this._equip.hidePage(),this._soulstone&&this._soulstone.hidePage(),this._orComp&&this._orComp.hidePage()},t.prototype.destroyPage=function(){this._view&&this._view.destroyView(),this._equip&&this._equip.destroyPage(),this._soulstone&&this._soulstone.destroyPage(),this._orComp&&this._orComp.destroyPage(),u.ResManager.getInstance().destroyPageCtrl(this),this.clearCtrlRes()},t}(d.BaseCtrl);e.ReXueDlgCtrl=w}),define("src/g/rexue/view/ReXueOrnamentDlgView",["require","exports","../../../manager/LayerManager"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.showView=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),i.LayerManager.addInPOPWindowLayer(this,t,!0,!0,!1,e)},e.prototype.hideView=function(){this.bg_view.box_page.removeChildren(),this.removeSelf()},e.prototype.destroyView=function(){this.hideView()},e}(ui.rexue.ReXueOrnamentBgUI);e.ReXueOrnamentDlgView=n}),define("src/g/rexue/view/Tips/RxTips_orsuit",["require","exports","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../meta/ShuXingVo","../../../../utils/ItemUtils","../../../../vo/ReXueUtil","../../../../enum/enumItem"],function(t,e,n,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(e){function i(){var t=e.call(this)||this;return t.suitlv=0,t}return __extends(i,e),i.create=function(t){var e=new i;e.initData(t),e.popup()},i.prototype.initData=function(t){this._heroIdx=t,this._heroVo=n.RoleCenter.instans.vo.getOpenHeroByIdx(t),this._data=this._heroVo.rxData,this.suitlv=this._data.curNeishiSuitlv,this.renderView()},i.prototype.renderView=function(){this.renderNowAttr(),this.renderSuit()},i.prototype.renderNowAttr=function(){if(0!=this.suitlv){this.lab_notHave.removeSelf();var t=this._data.neishiSuitProp,e=[];for(var i in t){if("number"==typeof t[i])if(!(t[i]<=0))(s=l.ItemUtils.getShuXingByName(i))&&e.push([i,t[i]])}0==e.length?this.box_attr.removeSelf():this.lab_notHave.removeSelf();for(var n=0;n<8;n++){var s,o=this["has_"+n];if(e[n])(s=l.ItemUtils.getShuXingByName(e[n][0]))?o.text=s.desc+":"+r.ShuXingVo.getString4Vo(e[n][1],s):o.removeSelf();else o.removeSelf()}}else this.box_attr.removeSelf()},i.prototype.renderSuit=function(){var t=this.suitlv+1,e=a.GameConfig.rexue_suit_neishi[t];if(e){this.lab_name_suit.text=e.name,this.suititem.initItems(h.ReXueUtil.getReXueSuitPosArr_neishi(this._heroIdx,t),c.enumItem.arr_equipPosNameNs);for(var i=e.prop,n=0;n<10;n++){var s=this.box_suit.getChildByName("sname_"+n);if(i[n]){var o=l.ItemUtils.getShuXingByName(i[n][0]);s.text=o.desc+":"+r.ShuXingVo.getString4Vo(i[n][1],o)}else s.removeSelf()}}else this.box_suit.removeSelf()},i}(ui.rexue.tips.RxTips_orsuitUI);e.RxTips_orsuit=i}),define("src/g/rexue/view/page/ReXueOrmentPage",["require","exports","../../../../manager/RoleCenter","../../../../vo/ReXueUtil","../../../../utils/ItemUtils","src/g/itemGets/View/ItemGetDlg","../../../net/messages/rexue/sbkRXMsg","../../../../manager/GameSocketManager","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../meta/ShuXingVo","src/g/rexue/view/Tips/RxTips_orsuit","../../../../utils/RoleUtil","src/init/TextConst"],function(t,e,i,o,a,n,r,l,h,c,u,s,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var g=function(e){function t(){var t=e.call(this)||this;return t._lv=0,t._isUpStage=!1,t.btn_achivate.on(Laya.Event.CLICK,t,t.onUpClick),t.btn_suitInfo.on(Laya.Event.CLICK,t,t.onShowSuit),t}return __extends(t,e),t.prototype.onShowSuit=function(){s.RxTips_orsuit.create(this._heroIdx)},t.prototype.redChangeHandler=function(){},t.prototype.onUpClick=function(){var t;if(this._isUpStage)h.FE.upItems(d.TextConst.get(708),c.BubbleEnum.center);else{t=0==this._lv?this.orvo.activationcost:this.orvo.cost;for(var e=0,i=0;i<t.length;i++){var n=t[i][0];if(e=t[i][1],this._bag.getItemCount(n)<e)return void h.FE.upItems(d.TextConst.get(709),c.BubbleEnum.center)}var s=new r.RXNeiShiUpgradeMsg;s.heroIdx=this._heroIdx,s.type=this._pos,s.curLv=this._lv,l.GSM.sendServer(s)}},t.prototype.refreshData=function(t,e){this._heroIdx=t,this._pos=e+1,this.hero=i.RoleCenter.instans.vo.getOpenHeroByIdx(t),this._data=this.hero.rxData,this._bag=i.RoleCenter.instans.vo.bagdata,this.renderView()},t.prototype.renderView=function(){this._lv=this._data.curNeishiLv[this._pos-1],this.orvo=o.ReXueUtil.getOrnamentVo(this._pos,this._lv),this.renderOrItem(),this.renderBalls(),this.refreshBallProgress(),this.renderAttr(),this.renderNeed(),this.renderFight()},t.prototype.renderOrItem=function(){0==this._lv?this.item_.skin="res/custom/equipIcon/rx_"+ktgame.RoleDefineMod.arr_suitPosConst[this._pos-1]+"_gray.png":this.item_.skin="res/custom/equipIcon/rx_"+ktgame.RoleDefineMod.arr_suitPosConst[this._pos-1]+".png",this.itemName.skin="res/rexue/rexueOr_itemName"+this._pos+".png",this.setRexueOrStar()},t.prototype.renderItems=function(){for(var t=0;t<5;t++){var e=this["item_"+t];e.lab_lv.text="",0!=this._lv?this.orvo.star>t?(e.img_lock.visible=!1,e.img_di.skin="res/rexue/rexue_hunshi_yuandi2.png"):(e.img_lock.visible=!0,e.img_di.skin="res/rexue/rexue_hunshi_yuandi.png"):(e.img_lock.visible=!0,e.img_di.skin="res/rexue/rexue_hunshi_yuandi.png")}},t.prototype.renderBalls=function(){for(var t=0;t<5;t++){var e=this["ball_"+t];if(0!=this._lv)if(this.orvo.star>t){var i=new Laya.Image("res/rexue/rexueOr_point.png");e.addChild(i),e.skin="res/rexue/rexueOr_pointBg.png"}else e.removeChildren(),e.skin="res/rexue/rexueOr_pointBg.png";else e.removeChildren(),e.skin="res/rexue/rexueOr_pointBg.png"}},t.prototype.refreshBallProgress=function(){var t=this.orvo.star,e=this.loadMask,i=1;switch(t){case 1:i=1;break;case 2:i=70;break;case 3:i=160;break;case 4:i=260;break;case 5:i=320;break;default:i=1}Laya.Tween.clearAll(e),1==i?e.width=i:Laya.Tween.to(e,{width:i},500)},t.prototype.setRexueOrStar=function(){for(var t=0;t<5;t++){var e=this["star_"+t];if(0!=this.orvo.suit)if(this.orvo.suit>t){var i=new Laya.Image("res/rexue/rexueOr_star.png");e.addChild(i)}else e.removeChildren();else e.removeChildren(),e.skin="res/rexue/rexueOr_starBg.png"}},t.prototype.renderAttr=function(){for(var t=o.ReXueUtil.getOrnamentVo(this.orvo.type,this.orvo.level+1),e=0;e<3;e++){var i=this["lab_now_"+e],n=this["lab_next_"+e];if(this.orvo.prop[e]){i.visible=!0,n.visible=!0;var s=a.ItemUtils.getShuXingByName(this.orvo.prop[e][0]);i.text=s.desc+":"+u.ShuXingVo.getString4Vo(this.orvo.prop[e][1],s),n.text=t?s.desc+":"+u.ShuXingVo.getString4Vo(t.prop[e][1],s):d.TextConst.get(208)}else i.visible=!1,n.visible=!1}},t.prototype.renderFight=function(){this.box_fight.setFightNum(p.RoleUtil.calFightByProp(this.orvo.prop))},t.prototype.renderNeed=function(){var t,e;if(this._isUpStage=!1,this.btn_achivate.visible=!0,this.btn_achivate.disabled=!1,0==this._lv)this.item_cost_1.visible=!1,this.item_cost_0.visible=!0,t=a.ItemUtils.getItemVoById(this.orvo.activationcost[0][0]),e=this.orvo.activationcost[0][1],this.item_cost_0.setNeed(this._bag.getItemCount(t.id),e),this.item_cost_0.setJump(d.TextConst.get(481),new Laya.Handler(this,this.onShowGet,[t.id])),this.item_cost_0.setQualColor(a.ItemUtils.getColorByQuality(t.quality)),this.item_cost_0.setNeedName(t.name,a.ItemUtils.getIconByIconId(t.icon)),this.btn_achivate.label=d.TextConst.get(237),this.btn_red.visible=this._bag.getItemCount(this.orvo.activationcost[0][1])>=e;else{if(5==this.orvo.star&&(!this.orvo.cost||0==this.orvo.cost.length))return this.item_cost_0.visible=!1,this.item_cost_1.visible=!1,this.btn_achivate.disabled=!0,this.btn_red.visible=!1,void(this.btn_achivate.label=d.TextConst.get(208));if(this.item_cost_0.visible=!0,this.item_cost_1.visible=!0,t=a.ItemUtils.getItemVoById(this.orvo.cost[0][0]),e=this.orvo.cost[0][1],this.item_cost_0.setNeed(this._bag.getItemCount(t.id),e),this.item_cost_0.setJump(d.TextConst.get(481),new Laya.Handler(this,this.onShowGet,[t.id])),this.item_cost_0.setQualColor(a.ItemUtils.getColorByQuality(t.quality)),this.item_cost_0.setNeedName(t.name,a.ItemUtils.getIconByIconId(t.icon)),!this.orvo.cost[1])return void(this.item_cost_1.visible=!1);t=a.ItemUtils.getItemVoById(this.orvo.cost[1][0]),e=this.orvo.cost[1][1],this.item_cost_1.setNeed(this._bag.getItemCount(t.id),e),this.item_cost_1.setJump(d.TextConst.get(481),new Laya.Handler(this,this.onShowGet,[t.id])),this.item_cost_1.setQualColor(a.ItemUtils.getColorByQuality(t.quality)),this.item_cost_1.setNeedName(t.name,a.ItemUtils.getIconByIconId(t.icon)),this.btn_achivate.label=5==this.orvo.star?d.TextConst.get(514):d.TextConst.get(615);for(var i=!1,n=0;n<this.orvo.cost.length;n++)this._bag.getItemCount(this.orvo.cost[0][1])<e&&(i=!1);this.btn_red.visible=i}},t.prototype.onShowGet=function(t){var e=a.ItemUtils.getItemVoById(t);(new n.ItemGetDlg).initByVo(e,null).popup()},t}(ui.rexue.page.ReXueOrnamentPageUI);e.ReXueOrmentPage=g}),define("src/g/rexue/ctrl/page/ReXueOrmentCtrl",["require","exports","src/g/rexue/view/page/ReXueOrmentPage","src/g/clearRes/ClearResM"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.prototype.init=function(){this._view=new i.ReXueOrmentPage,n.ClearResM.addBgUrl(this._view.bg.skin)},t.prototype.showPage=function(t,e){this._view||this.init(),t.removeChildren(),t.addChild(this._view),this.changePerson(e[0],e[1]),this._view.bg.restskin()},t.prototype.loadUrls=function(){},t.prototype.changePerson=function(t,e){this._view&&this._view.refreshData(t,e)},t.prototype.refreshData=function(){this._view&&this._view.renderView()},t.prototype.getTitle=function(){return"res/rexue/rexue_neishibiaoti.png"},t.prototype.hidePage=function(){},t.prototype.destroyPage=function(){},t}();e.ReXueOrmentCtrl=s}),define("src/g/rexue/ctrl/ReXueOrnamentBgCtrl",["require","exports","src/g/rexue/view/ReXueOrnamentDlgView","src/init/Switches","src/g/accessctrl/AccessCenter","../../../manager/GameSocketManager","../../net/messages/rexue/sbkRXMsg","../../../manager/RoleCenter","src/g/proxy/MultiLevelUIProxy","src/init/ResManager","src/g/rexue/ctrl/page/ReXueOrmentCtrl","../../../plugin/sbkPropTool","../../../enum/EventName","../../../core/E","../../../vo/RedDot/RedDot_ReXue"],function(t,e,i,n,a,s,o,r,l,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(){function t(){this._nowSelectHero=0,this._pos=0,this.addEvent()}return t.prototype.addEvent=function(){n.Switches.ins.on(170,this,this.onOpenHandler,[170]);var t=s.GSM.ins;t.on(o.RXNeiShiUpgradeMsg.KEY,this,this.onRXNeiShiUpgradeMsg),t.on(o.RXNeiShiSuitGS2C.KEY,this,this.onRXNeiShiSuitGS2C),d.E.ins.on(p.EventName.OPENNEW_HERO,this,this.refreshHeroHeadShow),d.E.ins.on(p.EventName.REXUE_RED_ORNAMENTPAGE,this,this.onRefreshRedDot)},t.prototype.onRefreshRedDot=function(){this.refreshHeroHeadShow()},t.prototype.onRXNeiShiSuitGS2C=function(t){var e=r.RoleCenter.instans.vo.getOpenHeroByIdx(t.heroIdx);e.rxData.curNeishiSuitlv=t.curNeishiSuitlv,u.sbkPropTool.reSetAllReXue(e);var i=r.RoleCenter.instans.vo.combat,n=r.RoleCenter.instans.vo.reCheckComBat();r.RoleCenter.instans.event(p.EventName.FIGHT_UP,n-i),this._ornamenet&&this._page==this._ornamenet&&this._ornamenet.refreshData()},t.prototype.onRXNeiShiUpgradeMsg=function(t){var e=r.RoleCenter.instans.vo.getOpenHeroByIdx(t.heroIdx);e.rxData.curNeishiLv[t.type-1]=t.curLv,u.sbkPropTool.reSetAllReXue(e);var i=r.RoleCenter.instans.vo.combat,n=r.RoleCenter.instans.vo.reCheckComBat();r.RoleCenter.instans.event(p.EventName.FIGHT_UP,n-i),this._ornamenet&&this._page==this._ornamenet&&this._ornamenet.changePerson(t.heroIdx,t.type-1),d.E.ins.event(p.EventName.REXIE_UP_NEISHI)},t.prototype.onOpenHandler=function(t,e,i,n,s,o){void 0===i&&(i=!1),void 0===n&&(n=!1),void 0===s&&(s=0),void 0===o&&(o=0),this._nowSelectHero=s,this._pos=o,e&&(170==t?a.AccessCenter.ins.checkOpen(170)&&this.openReXueView(170,i,n):this.openReXueView(t,i,n))},t.prototype.tab_selectHandler=function(t){this._page&&this._page.hidePage(),0==t&&(this._view.tab_head.visible=!0,this._page=this._ornamenet),this._page&&this._page.showPage(this._view.bg_view.box_page,[this._nowSelectHero,this._pos]),this._view.bg_view.img_title.skin=this._page.getTitle()},t.prototype.initView=function(){this._view=new i.ReXueOrnamentDlgView,this._ornamenet=new c.ReXueOrmentCtrl,this._tabProxy=new l.MultiLevelUIProxy,this._tabProxy.registerTab(this._view.tab_page,0),this._tabProxy.registerTagIndex(170,0),this._tabProxy.selectHandler=new Laya.Handler(this,this.tab_selectHandler),this._view.tab_head.setCallbackHandler(new Laya.Handler(this,this.HeroSelect)),this.refreshHeroHeadShow(),this._view.bg_view.btn_back.on(Laya.Event.CLICK,this,this.hidePage),this._view.bg_view.btn_close.on(Laya.Event.CLICK,this,this.hidePage)},t.prototype.refreshHeroHeadShow=function(t){void 0===t&&(t=0),this._view&&this._view.tab_head.initData(r.RoleCenter.instans.self.openhero,this._nowSelectHero,r.RoleCenter.instans.vo),this.refreshRedHead()},t.prototype.openReXueView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._view||this.initView(),this._view.tab_head.setSelectIndex(this._nowSelectHero),this._tabProxy.open(t),this._view.showView(e,i)},t.prototype.HeroSelect=function(t,e){r.RoleCenter.instans.self.openhero[t]?(this._nowSelectHero=t,this._view.tab_head.setSelectIndex(t),this.changePerson(t)):n.Switches.ins.event(15)},t.prototype.refreshRedHead=function(){if(this._view)switch(this._view.tab_page.selectedIndex){case 0:for(var t=[],e=0;e<3;e++)t.push(g.RedDot_ReXue.ins.getOrRedByHero(e)[this._pos]);this._view.tab_head.refreshHeadRedHint(t)}},t.prototype.init=function(){return null},t.prototype.showPage=function(t,e){h.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t,e){this._page.changePerson(this._nowSelectHero,this._pos)},t.prototype.refreshData=function(){},t.prototype.getTitle=function(){return null},t.prototype.hidePage=function(){this._view&&this._view.hideView(),this._ornamenet&&this._ornamenet.hidePage()},t.prototype.destroyPage=function(){this._view&&this._view.destroyView(),this._ornamenet&&this._ornamenet.destroyPage(),h.ResManager.getInstance().destroyPageCtrl(this)},t}();e.ReXueOrnamentBgCtrl=v}),define("src/g/role/view/Govern/GovernUpLvPage",["require","exports","../../../net/messages/ErrConst","../../../../utils/system/ErrCodeView","../../../net/messages/sbkFormula","../../../net/messages/zhuzaiC2GS","../../../../enum/enumItem","src/g/role/vo/GovernStruct","../../../../manager/RoleCenter","../../../../utils/ItemUtils","../../../net/messages/OpResultType","../../../../manager/GameSocketManager","../../../net/messages/PropFightMain","../../../../core/E","../../../../enum/EventName","src/g/Effects/UIEffectsFactory","src/g/itemGets/View/ItemGetDlg","../../../../utils/system/FloatEffect","../../../../vo/RedDot/role/RedDot_Govern","../../../../plugin/view/ToolTip","src/init/TextConst","../../../../meta/QualiyVo"],function(t,e,o,a,r,l,h,c,n,u,p,d,g,s,v,f,i,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var b=function(e){function t(){var t=e.call(this)||this;return t._Itempos=0,t._openArr=[],t._lvArr=[],t._nowSelectHeroIdx=0,t.addEvent(),t.onLoadUIEF(),t}return __extends(t,e),t.prototype.onLoadUIEF=function(){this.ani_put=f.UIEffectsFactory.Ins.createUIAniById(40,!0),f.UIEffectsFactory.Ins.centered4Parent(this.ani_put,this.btn_upLv,!0)},t.prototype.addEvent=function(){for(var t,e=[C.TextConst.get(141),C.TextConst.get(142),C.TextConst.get(143),C.TextConst.get(144)],i=0;i<4;i++)(t=this["item_"+i]).setName(e[i]),t.setSelect(!1),t.showGod(!1),t.showTip(!1),t.setSoul(),t.setEnhance(),t.setClieckHD(new Laya.Handler(this,this.itemClickHander,[parseInt(t.name)]));this.btn_upLv.on(Laya.Event.CLICK,this,this.onUpLvClick),this.item_cost.setJump(C.TextConst.get(238),new Laya.Handler(this,this.onShowGetItem))},t.prototype.onShowGetItem=function(){var t,e=c.GovernStruct.Ins.getGovernVo(this.nowSelectItemPos+1,this._lvArr[this.nowSelectItemPos]);t=0==this._openArr[this.nowSelectItemPos]?u.ItemUtils.getItemVoById(parseInt(e.activationcost[0][0])):u.ItemUtils.getItemVoById(125),(new i.ItemGetDlg).initByVo(t).popup()},t.prototype.onUpLvClick=function(){var t=c.GovernStruct.Ins.getGovernVo(this.nowSelectItemPos+1,this._lvArr[this.nowSelectItemPos]),e=0,i=0,n=0==this._openArr[this.nowSelectItemPos];if(n){if((i=this.uvo.bagdata.getItemCount(parseInt(t.activationcost[0][0])))<(e=t.activationcost[0][1]))return void y.FE.upItems(C.TextConst.get(520),_.BubbleEnum.center);if(1e3*this.uvo.zhuanshengLv+this.uvo.lvl<t.limit[0][1])return void a.ErrCodeView.show(o.enumErrConst.code_2102)}else{if(0==t.cost.length)return;if((i=this.uvo.bagdata.getItemCount(parseInt(t.cost[0][0])))<(e=t.cost[0][1]))return void y.FE.upItems(C.TextConst.get(520),_.BubbleEnum.center);if(1e3*this.uvo.zhuanshengLv+this.uvo.lvl<t.limit2[0][1])return void a.ErrCodeView.show(o.enumErrConst.code_2102)}if(e<=i){var s=new l.zhuzaiC2GS;s.heroidx=this._nowSelectHeroIdx,s.msgidx=n?p.enumOpResultType.zhuzai_activation:p.enumOpResultType.zhuzai_upLv,s.type=this.nowSelectItemPos+1,d.GSM.sendServer(s)}},Object.defineProperty(t.prototype,"nowSelectItemPos",{get:function(){return this._Itempos},set:function(t){this._Itempos=t},enumerable:!0,configurable:!0}),t.prototype.init=function(){for(var t,e=0;e<4;e++){t=this["item_"+e];var i=0<this._openArr[e]?"":"_gray",n=c.GovernStruct.Ins.getGovernVo(e+1,this._lvArr[e]),s=u.ItemUtils.getItemVoById(n.activationcost[0][0]),o=1e4<=n.level;t.setEnhance(n.level%1e4);var a=0==i.length?o?h.enumItem.orange:s.quality:1;t.setTrait(a,I.QualityStruct.Ins.getQPicById(a)),t.showIcon("res/custom/equipIcon/suit_"+ktgame.RoleDefineMod.arr_suitPosConst[e]+i+".png")}},t.prototype.itemClickHander=function(t){this._Itempos=t,this.setSelectPos(),this.showAttr()},t.prototype.refreshData=function(t,e){this._nowSelectHeroIdx=t,this._Itempos=e,this.uvo=n.RoleCenter.instans.vo,this.hvo=this.uvo.getOpenHeroByIdx(t),this._openArr=this.hvo.zhuzai.activationArr,this._lvArr=this.hvo.zhuzai.lvArr,this.init(),this.itemClickHander(this._Itempos),this.refreshRedHint(),this.showFightNum()},t.prototype.refreshRedHint=function(){this.uvo=n.RoleCenter.instans.vo,this.hvo=this.uvo.getOpenHeroByIdx(this._nowSelectHeroIdx);for(var t=m.RedDot_Govern.Ins,e=0;e<4;e++){this["item_"+e].showTip(t.getActiveByHeroIdx(this._nowSelectHeroIdx,!0)[e]||t.getUpLvByHeroIdx(this._nowSelectHeroIdx,!0)[e])}},t.prototype.playAni=function(t,e,i,n){void 0===i&&(i=1),void 0===n&&(n=1),f.UIEffectsFactory.Ins.playAniOnce(e,this.anisp,i,n)},t.prototype.stopAni=function(t){var e=this.anisp.getChildByName(t);e&&(e.stop(),e.visible=!1,e.index=0)},t.prototype.playUpLvAni=function(t){var e=this["item_"+t],i=e.sp.getChildByName("up");if(i)i.visible=!0;else{var n=f.UIEffectsFactory.Ins.createUIAniById(70,!1);n.name="up",f.UIEffectsFactory.Ins.centered4Parent(n,e.sp,!0),n.on(Laya.Event.COMPLETE,this,function(){n.stop(),n.visible=!1}),i=n}e.sp.scale(1.3,1.3),i.on(Laya.Event.COMPLETE,this,this.stopUpLvAni,[t]),i.play(0)},t.prototype.stopUpLvAni=function(t){var e=this["item_"+t].sp.getChildByName("up");e&&(e.stop(),Laya.loader.clearRes(e.source),e.removeSelf())},t.prototype.showFightNum=function(){for(var t=0,e=0;e<this._lvArr.length;e++){var i=new g.PropZhuZai;if(1==this._openArr[e])for(var n=c.GovernStruct.Ins.getGovernVo(e+1,this._lvArr[e]),s=0;s<n.prop.length;s++)i[n.prop[s][0]]=n.prop[s][1];t+=r.sbkFormula.calZhuZaiCombat(i)}this.FightNum.num_Fight.value=t+""},t.prototype.showAttr=function(){for(var t=c.GovernStruct.Ins.getGovernVo(this.nowSelectItemPos+1,this._lvArr[this.nowSelectItemPos]),e=c.GovernStruct.Ins.getGovernVo(this.nowSelectItemPos+1,this._lvArr[this.nowSelectItemPos]+1),i=new g.PropFightMain,n=0;n<t.prop.length;n++){var s=u.ItemUtils.getShuXingByName(t.prop[n][0]),o="%"==s.unit?t.prop[n][1]/100:t.prop[n][1];if(this["lab_now_"+n].text=s.desc+" : "+o+s.unit,i[t.prop[n][0]]=t.prop[n][1],null!=e){var a="%"==s.unit?e.prop[n][1]/100:e.prop[n][1];this["lab_next_"+n].text=s.desc+" : "+a+s.unit,this.showNeed(),this.box_upBox.visible=!(null==t.probability||0==t.limit2.length),this.btn_upLv.disabled=null==t.probability||0==t.limit2.length,this.btn_upLv.label=C.TextConst.get(615),this.btn_upLv.disabled=!1}else this["lab_next_"+n].text=C.TextConst.get(208),this.lab_lv.text=C.TextConst.get(208),this.item_cost.setNeed(0,0,!0,!0),this.lab_oknum.text="0%",this.btn_upLv.label=C.TextConst.get(208),this.btn_upLv.disabled=!0}this.lab_showLv.text=C.TextConst.get(733,t.level%1e3)},t.prototype.showNeed=function(){var t,e,i=c.GovernStruct.Ins.getGovernVo(this.nowSelectItemPos+1,this._lvArr[this.nowSelectItemPos]);this.box_upBox.visible=!(null==i.prop||0==i.prop.length),this.btn_upLv.disabled=null==i.prop||0==i.prop.length;var n=0,s=0;n=0==this._openArr[this.nowSelectItemPos]?(this.btn_upLv.label=C.TextConst.get(237),t=u.ItemUtils.getItemVoById(parseInt(i.activationcost[0][0])),e=u.ItemUtils.getLv(i.limit[0][1]),s=this.uvo.bagdata.getItemCount(parseInt(i.activationcost[0][0])),i.activationcost[0][1]):(this.btn_upLv.label=C.TextConst.get(615),t=u.ItemUtils.getItemVoById(parseInt(i.cost[0][0])),e=u.ItemUtils.getLv(i.limit2[0][1]),s=this.uvo.bagdata.getItemCount(parseInt(i.cost[0][0])),i.cost[0][1]),this.lab_lv.text=e,this.lab_oknum.text=Math.floor(i.probability/100)+"%",this.item_cost.setNeedName(t.name,u.ItemUtils.getSmallIcon(t.icon)),this.item_cost.setQualColor(u.ItemUtils.getColorByQuality(t.quality)),this.item_cost.setNeed(s,n)},t.prototype.setSelectPos=function(){for(var t,e=0;e<4;e++)(t=this["item_"+e]).setSelect(e==this._Itempos),t.img_select.scale(1.1,1.1);this.uvo=n.RoleCenter.instans.vo,this.hvo=this.uvo.getOpenHeroByIdx(this._nowSelectHeroIdx);var i=m.RedDot_Govern.Ins;this.ani_put.visible=i.getActiveByHeroIdx(this._nowSelectHeroIdx,!0)[this._Itempos]||i.getUpLvByHeroIdx(this._nowSelectHeroIdx,!0)[this._Itempos],s.E.ins.event(v.EventName.GOVERN_CHANGEITEMIDX,[this._Itempos])},t}(ui.role.Govern.Page.GovernUpLvUI);e.GovernUpLvPage=b}),define("src/g/role/ctrl/Govern/GovernUpLvCtrl",["require","exports","../../../../manager/TipManager","src/g/role/vo/GovernStruct","../../../../manager/RoleCenter","src/g/role/view/Govern/GovernUpLvPage","../../../net/messages/OpResultType","../../../../enum/EventName","../../../../core/E","../../../net/messages/PropFightMain","../../../../plugin/sbkPropTool","src/init/ResManager"],function(t,e,o,a,r,i,n,l,h,c,u,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var p=function(){function t(){this._nowSelectHero=0,this._itemIdx=0}return t.prototype.init=function(){this._view||(this._view=new i.GovernUpLvPage),r.RoleCenter.instans.on(n.enumOpResultType.zhuzai_activation+"",this,this.onJiHuo),r.RoleCenter.instans.on(n.enumOpResultType.zhuzai_upLv+"",this,this.onUpLv),h.E.ins.on(l.EventName.GOVERN_CHANGEITEMIDX,this,this.onChangeIdx)},t.prototype.onChangeIdx=function(t){this._itemIdx=t},t.prototype.onJiHuo=function(t){var e=t.reservedata,i=r.RoleCenter.instans.vo,n=i.getOpenHeroByIdx(e[0]);n.zhuzai.activationArr[e[1]-1]=1,n.zhuzai.lvArr[e[1]-1]=e[2];var s=a.GovernStruct.Ins.getGovernVo(e[1],e[2]);i.chgItemCount(parseInt(s.activationcost[0][0]),0-s.activationcost[0][1]),o.TipManager.showType2Tip(e[1]-1+121),n.prop_zhuzai[e[1]-1]=new c.PropZhuZai,u.sbkPropTool.reSetProp(n.prop_zhuzai[e[1]-1],s.prop),n.combat=n.reCheckComBat(),i.combat=i.reCheckComBat(),r.RoleCenter.instans.event(l.EventName.FIGHT_UP,e[3]),this.refreshData()},t.prototype.onUpLv=function(t){this._view.stopAni("upLv");var e=t.reservedata,i=r.RoleCenter.instans.vo,n=i.getOpenHeroByIdx(e[0]);if(this._view&&this._view.playUpLvAni(e[1]-1),0==e[3]?(this._view.stopAni("upLvOk"),this._view.playAni("upLvFail",35),this.refreshData()):(this._view.stopAni("upLvFail"),this._view.playAni("upLvOk",8,1.3,1.3),n.zhuzai.lvArr[e[1]-1]=e[2]),0!=e[3]){var s=a.GovernStruct.Ins.getGovernVo(e[1],e[2]);n.prop_zhuzai[e[1]-1]=new c.PropZhuZai,u.sbkPropTool.reSetProp(n.prop_zhuzai[e[1]-1],s.prop),n.combat=n.reCheckComBat(),i.combat=i.reCheckComBat(),r.RoleCenter.instans.event(l.EventName.FIGHT_UP,e[3])}var o=a.GovernStruct.Ins.getGovernVo(e[1],n.zhuzai.lvArr[e[1]-1]);0==o.cost.length&&(o=a.GovernStruct.Ins.getGovernVo(e[1],99)),i.chgItemCount(parseInt(o.cost[0][0]),0-o.cost[0][1]),h.E.ins.event(l.EventName.GOVERN_UPLV),this.refreshData()},t.prototype.showPage=function(t,e){t.removeChildren(),this.init(),this._itemIdx=e,this.refreshData(),this._view.stopAni("upLv"),t.addChild(this._view),s.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t){this._nowSelectHero=t,this.init(),this.refreshData(),this._view.stopAni("upLv")},t.prototype.refreshData=function(){this._view.refreshData(this._nowSelectHero,this._itemIdx)},t.prototype.getTitle=function(){return"res/role/govern/wenzi_zhuzaitaozhuang.png"},t.prototype.hidePage=function(){s.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){s.ResManager.getInstance().destroyPageCtrl(this)},t}();e.GovernUpLvCtrl=p}),define("src/g/role/view/Govern/GovernUpStage",["require","exports","../../../../utils/system/FloatEffect","src/g/role/vo/GovernStruct","../../../../utils/ItemUtils","../../../net/messages/zhuzaiC2GS","../../../net/messages/OpResultType","../../../../manager/GameSocketManager","../../../../manager/RoleCenter","../../../net/messages/PropFightMain","../../../net/messages/sbkFormula","../../../../enum/enumItem","../../../../core/E","../../../../enum/EventName","src/g/itemGets/View/ItemGetDlg","src/g/Effects/UIEffectsFactory","../../../../vo/RedDot/role/RedDot_Govern","../../../../plugin/view/ToolTip","src/init/TextConst","../../../../meta/QualiyVo"],function(t,e,s,r,l,o,a,h,n,c,u,p,d,g,i,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(e){function t(){var t=e.call(this)||this;return t._Itempos=0,t._openArr=[],t._lvArr=[],t._nowSelectHeroIdx=0,t.addEvent(),t.onLoadUIEF(),t}return __extends(t,e),t.prototype.onLoadUIEF=function(){this.ani_put=v.UIEffectsFactory.Ins.createUIAniById(40,!0),v.UIEffectsFactory.Ins.centered4Parent(this.ani_put,this.btn_upStar,!0)},t.prototype.addEvent=function(){for(var t,e=[m.TextConst.get(141),m.TextConst.get(142),m.TextConst.get(143),m.TextConst.get(144)],i=0;i<4;i++)(t=this["item_"+i]).setName(e[i]),t.setSelect(!1),t.showGod(!1),t.showTip(!1),t.setSoul(),t.setEnhance(),t.setClieckHD(new Laya.Handler(this,this.itemClickHander,[parseInt(t.name)]));this.btn_upStar.on(Laya.Event.CLICK,this,this.onUpStage),this.list_star.renderHandler=new Laya.Handler(this,this.starRender),this.item_cost.setJump(m.TextConst.get(238),new Laya.Handler(this,this.onShowGetItem))},t.prototype.onShowGetItem=function(){var t;r.GovernStruct.Ins.getGovernVo(this.nowSelectItemPos+1,this._lvArr[this.nowSelectItemPos]);t=l.ItemUtils.getItemVoById(126),(new i.ItemGetDlg).initByVo(t).popup()},t.prototype.starRender=function(t,e){t.skin="res/role/govern/xing"+(t.dataSource?"":"0")+".png"},t.prototype.setStar=function(){for(var t=r.GovernStruct.Ins.getGovernVo(this.nowSelectItemPos+1,this._lvArr[this.nowSelectItemPos]),e=Math.floor(t.level/1e4),i=[],n=1;n<=5;n++)i.push(n<=e);this.list_star.dataSource=i},t.prototype.onUpStage=function(){var t,e,i=r.GovernStruct.Ins.getGovernVo(this.nowSelectItemPos+1,this._lvArr[this.nowSelectItemPos]);if(null!=r.GovernStruct.Ins.getGovernVo(i.type,i.level+1e4))if((e=this.uvo.bagdata.getItemCount(parseInt(i.advanced[0][0])))<(t=i.advanced[0][1]))s.FE.upItems(m.TextConst.get(520),y.BubbleEnum.center);else if(t<=e){var n=new o.zhuzaiC2GS;n.heroidx=this._nowSelectHeroIdx,n.msgidx=a.enumOpResultType.zhuzai_upStar,n.type=this.nowSelectItemPos+1,h.GSM.sendServer(n)}},Object.defineProperty(t.prototype,"nowSelectItemPos",{get:function(){return this._Itempos},set:function(t){this._Itempos=t},enumerable:!0,configurable:!0}),t.prototype.init=function(){for(var t,e=0;e<4;e++){t=this["item_"+e];var i=0<this._openArr[e]?"":"_gray",n=r.GovernStruct.Ins.getGovernVo(e+1,this._lvArr[e]),s=l.ItemUtils.getItemVoById(n.activationcost[0][0]);t.setEnhance(n.level%1e4);var o=1e4<=n.level,a=0==i.length?o?p.enumItem.orange:s.quality:1;t.setTrait(a,_.QualityStruct.Ins.getQPicById(a)),t.showIcon("res/custom/equipIcon/suit_"+ktgame.RoleDefineMod.arr_suitPosConst[e]+i+".png")}},t.prototype.itemClickHander=function(t){this._Itempos=t,this.setSelectPos(),this.showAttr()},t.prototype.refreshData=function(t,e){this._nowSelectHeroIdx=t,this._Itempos=e,this.uvo=n.RoleCenter.instans.vo,this.hvo=this.uvo.getOpenHeroByIdx(t),this._openArr=this.hvo.zhuzai.activationArr,this._lvArr=this.hvo.zhuzai.lvArr,this.init(),this.itemClickHander(this._Itempos),this.refreshRedHint(),this.showFightNum()},t.prototype.refreshRedHint=function(){this.uvo=n.RoleCenter.instans.vo,this.hvo=this.uvo.getOpenHeroByIdx(this._nowSelectHeroIdx);for(var t=f.RedDot_Govern.Ins,e=0;e<4;e++){this["item_"+e].showTip(t.getUpStarByHeroIdx(this._nowSelectHeroIdx,!0)[e])}},t.prototype.showFightNum=function(){for(var t=0,e=0;e<this._lvArr.length;e++){var i=new c.PropZhuZai;if(1==this._openArr[e])for(var n=r.GovernStruct.Ins.getGovernVo(e+1,this._lvArr[e]),s=0;s<n.prop.length;s++)i[n.prop[s][0]]=n.prop[s][1];t+=u.sbkFormula.calZhuZaiCombat(i)}this.FightNum.num_Fight.value=t+""},t.prototype.showAttr=function(){for(var t=r.GovernStruct.Ins.getGovernVo(this.nowSelectItemPos+1,this._lvArr[this.nowSelectItemPos]),e=r.GovernStruct.Ins.getGovernVo(this.nowSelectItemPos+1,this._lvArr[this.nowSelectItemPos]+1e4),i=new c.PropZhuZai,n=0;n<t.prop.length;n++){var s=l.ItemUtils.getShuXingByName(t.prop[n][0]),o="%"==s.unit?t.prop[n][1]/100:t.prop[n][1];if(this["lab_now_"+n].text=s.desc+" : "+o+s.unit,i[t.prop[n][0]]=t.prop[n][1],null!=e){var a="%"==s.unit?e.prop[n][1]/100:e.prop[n][1];this["lab_next_"+n].text=s.desc+" : "+a+s.unit}else this["lab_next_"+n].text=m.TextConst.get(208)}this.setStar(),this.showNeed()},t.prototype.playUpLvAni=function(t){var e=this["item_"+t],i=e.sp.getChildByName("up");if(i)i.visible=!0;else{var n=v.UIEffectsFactory.Ins.createUIAniById(71,!1);n.name="up",v.UIEffectsFactory.Ins.centered4Parent(n,e.sp,!0),n.on(Laya.Event.COMPLETE,this,function(){n.stop(),n.visible=!1}),i=n}e.sp.scale(1.5,1.5),i.on(Laya.Event.COMPLETE,this,this.stopUpLvAni,[t]),i.play(0)},t.prototype.stopUpLvAni=function(t){var e=this["item_"+t].sp.getChildByName("up");e&&(e.stop(),Laya.loader.clearRes(e.source),e.removeSelf())},t.prototype.showNeed=function(){var t,e=r.GovernStruct.Ins.getGovernVo(this.nowSelectItemPos+1,this._lvArr[this.nowSelectItemPos]),i=0,n=0;if(0==this._openArr[this.nowSelectItemPos])return this.box_noJihuo.visible=!0,void(this.box_upView.visible=!1);if(this.box_noJihuo.visible=!1,this.box_upView.visible=!0,this.btn_upStar.label=m.TextConst.get(615),0==e.advanced.length){var s=r.GovernStruct.Ins.getGovernVo(this.nowSelectItemPos+1,this._lvArr[this.nowSelectItemPos]-1e4),o=l.ItemUtils.getItemVoById(parseInt(s.advanced[0][0]));this.item_cost.setNeedName(o.name,l.ItemUtils.getSmallIcon(o.icon)),this.item_cost.setNeed(0,0,!0,!0),this.btn_upStar.visible=!1}else t=l.ItemUtils.getItemVoById(parseInt(e.advanced[0][0])),n=this.uvo.bagdata.getItemCount(parseInt(e.advanced[0][0])),i=e.advanced[0][1],this.item_cost.setNeedName(t.name,l.ItemUtils.getSmallIcon(t.icon)),this.item_cost.setQualColor(l.ItemUtils.getColorByQuality(t.quality)),this.item_cost.setNeed(n,i),this.btn_upStar.visible=!0},t.prototype.setSelectPos=function(){for(var t,e=0;e<4;e++)(t=this["item_"+e]).setSelect(e==this._Itempos),t.img_select.scale(1.1,1.1);this.uvo=n.RoleCenter.instans.vo,this.hvo=this.uvo.getOpenHeroByIdx(this._nowSelectHeroIdx);var i=f.RedDot_Govern.Ins;this.ani_put.visible=i.getUpStarByHeroIdx(this._nowSelectHeroIdx,!0)[this._Itempos],d.E.ins.event(g.EventName.GOVERN_CHANGEITEMIDX,[this._Itempos])},t}(ui.role.Govern.Page.GovernUpStageUI);e.GovernUpStagePage=C}),define("src/g/role/ctrl/Govern/GovernUpStageCtrl",["require","exports","../../../../enum/EventName","src/g/role/vo/GovernStruct","src/g/role/view/Govern/GovernUpStage","../../../net/messages/OpResultType","../../../../manager/RoleCenter","../../../../core/E","../../../net/messages/PropFightMain","../../../../plugin/sbkPropTool","../../../../vo/RedDot/role/RedDot_Govern","../../../../vo/RedDot/EventRedDot","src/init/ResManager"],function(t,e,a,r,i,n,l,h,c,u,p,d,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){this._nowSelectHero=0,this._itemIdx=0}return t.prototype.init=function(){this._view||(this._view=new i.GovernUpStagePage),l.RoleCenter.instans.on(n.enumOpResultType.zhuzai_upStar+"",this,this.onUpStage),h.E.ins.on(a.EventName.GOVERN_CHANGEITEMIDX,this,this.onChangeIdx)},t.prototype.onChangeIdx=function(t){this._itemIdx=t},t.prototype.onUpStage=function(t){var e=t.reservedata,i=l.RoleCenter.instans.vo,n=i.getOpenHeroByIdx(e[0]),s=r.GovernStruct.Ins.getGovernVo(e[1],n.zhuzai.lvArr[e[1]-1]);n.zhuzai.lvArr[e[1]-1]=e[2];var o=r.GovernStruct.Ins.getGovernVo(e[1],e[2]);this._view&&this._view.playUpLvAni(e[1]-1),n.prop_zhuzai[e[1]-1]=new c.PropZhuZai,u.sbkPropTool.reSetProp(n.prop_zhuzai[e[1]-1],o.prop),n.combat=n.reCheckComBat(),i.combat=i.reCheckComBat(),l.RoleCenter.instans.event(a.EventName.FIGHT_UP,e[3]),i.chgItemCount(parseInt(s.advanced[0][0]),0-s.advanced[0][1]),p.RedDot_Govern.Ins.checkAll(),h.E.ins.event(d.EventRedDot.REFRESH_ROLE),h.E.ins.event(d.EventRedDot.REFRESH_EQUIP),this.refreshData()},t.prototype.showPage=function(t,e){t.removeChildren(),this.init(),this._itemIdx=e,this.refreshData(),t.addChild(this._view),s.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t){this._nowSelectHero=t,this.init(),this.refreshData()},t.prototype.refreshData=function(){this._view.refreshData(this._nowSelectHero,this._itemIdx)},t.prototype.getTitle=function(){return"res/role/govern/wenzi_zhuzaitaozhuang.png"},t.prototype.hidePage=function(){s.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){s.ResManager.getInstance().destroyPageCtrl(this)},t}();e.GovernUpStageCtrl=o}),define("src/g/role/view/GGovernView",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(ui.role.Govern.GGovernVIewUI);e.GGovernView=i}),define("src/g/role_other/view/role/OtherReincamationPage",["require","exports","src/g/clearRes/ClearResM","../../../../utils/ItemUtils","../../../../utils/RoleUtil","src/init/TextConst"],function(t,e,i,n,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.loopTime=60,t.rotateAdd=2,t.on(Laya.Event.REMOVED,t,t.onRemoved),i.ClearResM.addBgUrl(t.imgbg.skin),i.ClearResM.addBgUrl(t.img_quan.skin),t}return __extends(t,e),t.prototype.onRemoved=function(){Laya.timer.clear(this,this.bgRotate),this.rotateAdd=1,this.loopTime=60,i.ClearResM.clearUrl(this.imgbg.skin),i.ClearResM.clearUrl(this.img_quan.skin)},t.prototype.onAdded=function(){this.rotateAdd=1,Laya.timer.loop(this.loopTime,this,this.bgRotate)},t.prototype.bgRotate=function(){this.img_quan.rotation+=this.rotateAdd},t.prototype.refreshShow=function(){this.showAttr(),this.setTitle(),this.imgbg.restskin(),this.img_quan.restskin()},t.prototype.showAttr=function(){for(var t=n.ItemUtils.getZhuanShengVoById(this._uvo.zhuanshengLv),e=n.ItemUtils.getZhuanShengVoById(this._uvo.zhuanshengLv+1),i=0;i<t.prop.length;i++)this["lab_now_"+i].text=n.ItemUtils.getShuXingByName(t.prop[i][0]).desc+":"+t.prop[i][1];for(i=0;i<t.prop.length;i++)this["lab_next_"+i].text=e?n.ItemUtils.getShuXingByName(e.prop[i][0]).desc+":"+e.prop[i][1]:o.TextConst.get(208);this.view_fightBox.setFightNum(s.RoleUtil.calFightByProp(t.prop))},t.prototype.setTitle=function(){this.lab_nowLv.text=o.TextConst.get(719,this._uvo.zhuanshengLv)},t}(ui.role.Reincarnation.ReincarnationViewUI);e.OtherReincamationPage=a}),define("src/g/role_other/ctrl/role/OtherReincamationPageCtrl",["require","exports","src/init/ResManager","src/g/role_other/view/role/OtherReincamationPage"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){}return t.prototype.init=function(){return this._view||(this._view=new n.OtherReincamationPage),this._view.on(Laya.Event.REMOVED,this,this.onRemoved),this},t.prototype.onRemoved=function(){this._view&&(this._view.removeSelf(),this._view.destroy(),this._view=null,Laya.loader.clearRes("res/bg/zhuansheng_beijing.jpg"))},t.prototype.addEvent=function(){},t.prototype.closeRoleView=function(){this._view.removeSelf(),this._view.destroy(),this._view=null},t.prototype.showPage=function(t,e){if(this._parent=t,!this._view&&(this.init(),this.addEvent(),this._parent.removeChildren(),this._parent.addChild(this._view),this.refreshData(),this._view&&this._view.onAdded))try{this._view.onAdded()}catch(t){}},t.prototype.changePerson=function(t){this._view.parent==this._parent&&this.refreshData()},t.prototype.refreshData=function(){this._view&&this._view.refreshShow()},t.prototype.getTitle=function(){return"res/role/zhuanshengtitle.png"},t.prototype.hidePage=function(){i.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){i.ResManager.getInstance().destroyPageCtrl(this)},t}();e.OtherReincamationPageCtrl=s}),define("src/g/share/view/ShareRebateItem ",["require","exports","../../../manager/GameSocketManager","../../net/messages/share/sbkShareData"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(e){function t(){var t=e.call(this)||this;return t.money=0,t._index=0,t.on(Laya.Event.CLICK,t,t.onReceive),t}return __extends(t,e),t.prototype.setData=function(t,e){this._index=t,this.money=e,this.refresh()},t.prototype.refresh=function(){this.lab_num.text=this.money+""},t.prototype.onReceive=function(){var t=new n.getBackRedC2GS;t.num=this.money,i.GSM.sendServer(t)},t}(ui.share1.ShareRedPacketItemUI);e.ShareRebateItem=s}),define("src/g/share/view/ShareUpgradeItem",["require","exports","../../../manager/GameSocketManager","../../net/messages/share/sbkShareData","src/g/share/ShareTools"],function(t,e,i,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function t(){var t=e.call(this)||this;return t._index=0,t.btn_get.on(Laya.Event.CLICK,t,t.onReceive),t}return __extends(t,e),t.prototype.setData=function(t,e){this._index=t,this.playerInfo=e,this.refresh()},t.prototype.refresh=function(){var t=this.playerInfo.lvl,e=s.ShareTools.getShareJSON("HelpAppointLv").value;this.lab_lv.text="Lv."+t+"/"+e;var i=s.ShareTools.getShareJSON("HelpMaxPeopleAppointLv").reward[this._index][1];this.lab_reward.text="奖励："+i,this.lab_title.text="第"+this._index+"位好友"},t.prototype.onReceive=function(){var t=new n.getHelpLowLvRewardC2GS;t.childUsername="",i.GSM.sendServer(t)},t}(ui.share1.ShareFriendItemUI);e.ShareFriendItem=o}),define("src/g/shenbing/ShenBingBgView",["require","exports","../../manager/LayerManager"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.showView=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1),i.LayerManager.addInPOPWindowLayer(this,t,!0,!0,!1,e)},e.prototype.hideView=function(){this.bg_view.box_page.removeChildren(),this.removeSelf()},e.prototype.destroyView=function(){this.hideView()},e}(ui.shenbing.ShenBingBgUI);e.ShenBingBgView=n}),define("src/g/shenbing/view/page/ShenBingPage",["require","exports","../../../../vo/RedDot/Reddot_shenbing"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.setBtnSelect=function(t){for(var e=0;e<3;e++){var i=this["skill_"+e];i.img_select.visible=i.name==t+"",i.img_jobIcon.skin="res/shenbing/shenbing/shenbing_icon"+(e+1)+".png"}},e.prototype.refreshRed=function(){for(var t=i.Reddot_shenbing.Ins.getRed(!0),e=0;e<3;e++){this["skill_"+e].img_red.visible=t[e]}},e}(ui.shenbing.page.ShenBingPageUI);e.ShenBingPage=n}),define("src/g/shenbing/ctrl/subpage/Sb_SkillCtrl",["require","exports","src/g/shenbing/view/subpage/Sb_SkillPage","src/g/clearRes/ClearResM"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this._nowJob=0}return t.prototype.init=function(){this._view=new i.Sb_SkillPage},t.prototype.showPage=function(t,e){this._view||this.init();var i=this._view;i.parent!=t&&t.removeChildren(),t.addChild(i),n.ClearResM.resetViewImg(i),this._nowJob=e,this.changePerson(e)},t.prototype.changePerson=function(t,e){this._nowJob=t,this.refreshData()},t.prototype.refreshData=function(){this._view.refreshPage(this._nowJob)},t.prototype.getTitle=function(){return""},t.prototype.hidePage=function(){},t.prototype.destroyPage=function(){},t.prototype.loadUrls=function(){},t}();e.Sb_SkillCtrl=s}),define("src/g/shenbing/view/subpage/Sb_TaskPage",["require","exports","../../../net/messages/sbkShenBingData","../../../../manager/RoleCenter","../../../../utils/system/FloatEffect","../../../../plugin/view/ToolTip","../../../../manager/GameSocketManager","src/init/Switches","../../../../utils/SbUtils","src/init/TextConst"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t.nowJob=0,t.isGetTask=!1,t.btn_task.on(Laya.Event.CLICK,t,t._btn_click),t.list_.renderHandler=new Laya.Handler(t,t.listRender),t}return __extends(t,e),t.prototype.refreshPage=function(t){this.nowJob=t,this._data=n.RoleCenter.instans.vo.shenbing,this.nowTaskId=this._data.curTaskId,this.taskNum=this._data.curTaskNum,this.jobSet=l.SbUtils.getSbSettingByJob(this.nowJob),this.isGetTask=this.nowJob==l.SbUtils.getJobByTaskId(this.nowTaskId),this.renderView()},t.prototype.renderView=function(){this.lab_sbName.text=this.jobSet.name,this.renderSkill(),this.renderTask(),this.renderBtn()},t.prototype._btn_click=function(){if(this.isGetTask){var t=l.SbUtils.getSbTaskVo(this.nowTaskId);if(this.taskNum>=t.num)return void this.click_getTask();this.click_jumpModule()}else this.click_getTask()},t.prototype.renderSkill=function(){this.list_.dataSource=this.jobSet.tianfuShowArr},t.prototype.renderTask=function(){var t;t=this.isGetTask?l.SbUtils.getSbTaskVo(this.nowTaskId):l.SbUtils.getSbTaskVo(this.jobSet.task_id),0!=this.nowTaskId&&this.isGetTask?this.taskNum==t.num?this.lab_task.text=t.res+"(1/1)":this.lab_task.text=t.res+"(0/1)":this.lab_task.text=h.TextConst.get(748)},t.prototype.listRender=function(t,e){var i=t.dataSource,n=l.SbUtils.getTianFuVo(i);t.setSkillIcon(l.SbUtils.getTianfuIcon(n.icon)),t.setSkillNameSkin(l.SbUtils.getTianFuName(i)),t.setDes(l.SbUtils.getSbTianfuDesStrByStr(i))},t.prototype.renderBtn=function(){var t=l.SbUtils.getSbTaskVo(this.nowTaskId),e=t&&this.isGetTask?t.num:0;this.btn_task.label=this.isGetTask?this._data.curTaskNum>=e?h.TextConst.get(749):h.TextConst.get(750):h.TextConst.get(625)},t.prototype.click_getTask=function(){var t;0==this.nowTaskId||this.isGetTask?(0==this.nowTaskId?((t=new i.GetSBTaskMSG).type=1,t.curTaskId=this.jobSet.task_id):((t=new i.GetSBTaskMSG).type=2,t.curTaskId=this.nowTaskId),a.GSM.sendServer(t)):s.FE.upItems(h.TextConst.get(751),o.BubbleEnum.center)},t.prototype.click_jumpModule=function(){var t=l.SbUtils.getSbTaskVo(this.nowTaskId);r.Switches.ins.event(t.jump[0][1])},t}(ui.shenbing.subpage.TaskPageUI);e.Sb_TaskPage=c}),define("src/g/shenbing/ctrl/subpage/Sb_TaskCtrl",["require","exports","src/g/shenbing/view/subpage/Sb_TaskPage","src/g/clearRes/ClearResM"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this._nowJob=0}return t.prototype.init=function(){this._view=new i.Sb_TaskPage},t.prototype.showPage=function(t,e){this._view||this.init(),t.removeChildren(),t.addChild(this._view),n.ClearResM.resetViewImg(this._view),this._nowJob=e,this.changePerson(e)},t.prototype.changePerson=function(t,e){this._nowJob=t,this.refreshData()},t.prototype.refreshData=function(){this._view.refreshPage(this._nowJob)},t.prototype.getTitle=function(){return""},t.prototype.hidePage=function(){},t.prototype.destroyPage=function(){},t.prototype.loadUrls=function(){},t}();e.Sb_TaskCtrl=s}),define("src/g/shenbing/ctrl/page/ShenBingPageCtrl",["require","exports","src/g/shenbing/view/page/ShenBingPage","../../../../manager/RoleCenter","src/init/ResManager","src/g/shenbing/ctrl/subpage/Sb_SkillCtrl","../../../../enum/EventName","../../../../core/E","src/g/clearRes/ClearResM"],function(t,e,i,n,s,o,a,r,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function t(){this._nowJob=1,this._skill=new o.Sb_SkillCtrl}return t.prototype.init=function(){this._view=new i.ShenBingPage,this.addEvent()},t.prototype.addEvent=function(){this._view.skill_0.on(Laya.Event.CLICK,this,this.changePerson,[1]),this._view.skill_1.on(Laya.Event.CLICK,this,this.changePerson,[2]),this._view.skill_2.on(Laya.Event.CLICK,this,this.changePerson,[3]),r.E.ins.on(a.EventName.SHENBING_RED_ALL,this,this.onRedRefresh)},t.prototype.onRedRefresh=function(){this._view&&this._view.displayedInStage&&this._view.refreshRed()},t.prototype.showPage=function(t,e){this._data=n.RoleCenter.instans.vo.shenbing,this._view||this.init(),t.removeChildren(),t.addChild(this._view),l.ClearResM.resetViewImg(this._view),this._nowJob=e,this.changePerson(e),s.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t,e){this._page=this._skill,this._nowJob=t,this._view.setBtnSelect(t),this._view.refreshRed(),this._page.showPage(this._view.box_page,t)},t.prototype.refreshData=function(){this.changePerson(this._nowJob)},t.prototype.getTitle=function(){return"res/shenbing/shenbing/shenbing_renwu_biaoti.png"},t.prototype.hidePage=function(){s.ResManager.getInstance().hidePageCtrl(this),this._view&&this._view.removeSelf()},t.prototype.destroyPage=function(){this.hidePage()},t.prototype.loadUrls=function(){},t}();e.ShenBingPageCtrl=h}),define("src/g/shenbing/view/page/ShenBingFantasyPage",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(ui.shenbing.page.sb_fantasy_pageUI);e.ShenBingFantasyPage=i}),define("src/g/shenbing/ctrl/page/ShenBingFantasyPageCtrl",["require","exports","src/g/shenbing/view/page/ShenBingFantasyPage","src/init/CtrlBase","../../../../core/GNet","../../../net/messages/rank/sbkRankDataBase","../../../../manager/GameSocketManager","../../../net/messages/rank/RankDataGS2C","../../../../manager/RoleCenter","../../../../config/GameConfig","../../../../utils/ItemCellUtils","src/g/bag/tips/view/ItemTips","../../../../manager/LayerManager","../../../../core/E","../../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../../net/messages/ChangeSceneMsg","src/g/clearRes/ClearResM","../../../../utils/SbUtils","src/init/TextConst"],function(t,e,n,i,s,l,o,a,h,c,r,u,p,d,g,v,f,y,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(i){function t(){return null!==i&&i.apply(this,arguments)||this}return __extends(t,i),t.prototype.showPage=function(t,e){i.prototype.showPage.call(this,t,e),this._view||(this._view=new n.ShenBingFantasyPage,this._view.btn_fight.on(Laya.Event.CLICK,this,this.onToFightHandler)),t.addChild(this._view),o.GSM.ins.on(a.RankDataGS2C.KEY,this,this.resultHandler),s.GNet.getRankList(l.enumRankID.rankid_14,1,3),y.ClearResM.resetViewImg(this._view),this.refreshData(),d.E.ins.on(g.EventName.USER_DATA_ATTR_CHANGED+"sbData",this,this.onLayerDataChanged),d.E.ins.on(g.EventName.USER_DATA_ATTR_CHANGED+"SHENBINGHJCOUNT",this,this.onFightNumChanged)},t.prototype.onLayerDataChanged=function(){this.updateLayer()},t.prototype.onFightNumChanged=function(){this.updateNum()},t.prototype.hidePage=function(){i.prototype.hidePage.call(this),this._view&&this._view.removeSelf(),o.GSM.ins.off(a.RankDataGS2C.KEY,this,this.resultHandler),d.E.ins.off(g.EventName.USER_DATA_ATTR_CHANGED+"sbData",this,this.onLayerDataChanged),d.E.ins.off(g.EventName.USER_DATA_ATTR_CHANGED+"SHENBINGHJCOUNT",this,this.onFightNumChanged)},t.prototype.resultHandler=function(t){if(t.opresult&&this._view&&this._view.displayedInStage&&t.rankIdArr[0]==l.enumRankID.rankid_14)for(var e,i,n,s,o,a=Math.min(3,t.rankDataArr.length),r=0;r<3;)i=r+1,e=t.rankDataArr[r],n=this._view["lab_name"+i],s=this._view["lab_layer"+i],o=this._view["lab_time"+i],r<a?(n&&(n.visible=!0,n.changeText(e.nickname)),s&&(s.visible=!0,s.changeText(_.TextConst.get(14,Math.floor(e.value1/1e3)-37e3)))):(n&&(n.visible=!1),s&&(s.visible=!1)),o&&(o.visible=!1),r++},t.prototype.refreshData=function(){this.updateLayer(),this.updateNum()},t.prototype.updateNum=function(){var t=c.GameConfig.commonJson.SBHJBaseCount.value,e=h.RoleCenter.instans.vo.getAttr("SHENBINGHJCOUNT"),i=t+this.getVipAddCount()+this.getMonthCardAddCount();this._view.lab_progress.changeText(e+"/"+i)},t.prototype.getVipAddCount=function(){var t=c.GameConfig.vipJSON[h.RoleCenter.instans.vo.VIP.toString()];for(var e in t.reward){var i=t.reward[e];if(i&&"SHENBINGHJCOUNT"==i[0])return i[1]}return 0},t.prototype.getMonthCardAddCount=function(){if(h.RoleCenter.instans.vo.isSuperMonthCard){var t=c.GameConfig.playerJSON[1];for(var e in t.super_monthcard_property){var i=t.super_monthcard_property[e];if(i&&"SHENBINGHJCOUNT"==i[0])return i[1]}}return 0},t.prototype.updateLayer=function(){var t=h.RoleCenter.instans.vo.shenbing;if(t){var e,i,n=t.huanJingCfgId,s=n-37e3,o=Math.floor((s-1)/10)+1,a=s-1;for(0==a&&(a=1);!(null!=e&&0!=e.type||(i=a+2,e=c.GameConfig.sbPortInfoJson[i+37e3],--a<1)););a=i-2;for(var r=0;r<3;)this._view["item"+r].visible=a+r<=i&&(this.fillListItem(this._view["item"+r],a+r,s),!0),r++;this.update10Reward(o);var l=c.GameConfig.sbPortInfoJson[n];this._view.clip_fight.value=l?l.recommend_fight.toString():"0"}},t.prototype.fillListItem=function(t,e,i){t.clip_layer.value=_.TextConst.get(62,e);var n=c.GameConfig.sbPortInfoJson[e+37e3];n&&(t.item0.off(Laya.Event.CLICK,this,this.showTip),t.item1.off(Laya.Event.CLICK,this,this.showTip),t.item0.on(Laya.Event.CLICK,this,this.showTip,[n.port_drop[0][0],n.port_drop[0][1]]),t.item1.on(Laya.Event.CLICK,this,this.showTip,[n.bonus[0][0],n.bonus[0][1]]),r.ItemCellUtils.fillCellForItemNameView(t.item0,n.port_drop[0][0],n.port_drop[0][1]),r.ItemCellUtils.fillCellForItemNameView(t.item1,n.bonus[0][0],n.bonus[0][1])),t.img_s.visible=!1,i<e?(t.lab_open.visible=!0,t.lab_open.color="#ff0f15",t.lab_open.changeText(_.TextConst.get(347))):e<i?(t.lab_open.visible=!1,t.img_s.visible=!0):(t.lab_open.visible=!0,t.lab_open.color="#09d51f",t.lab_open.changeText(_.TextConst.get(582)),this._view.item_select.x=t.x,this._view.item_select.y=t.y)},t.prototype.showTip=function(t,e){u.ItemTips.ins.showTip(t,e)},t.prototype.update10Reward=function(t){var e=m.SbUtils.getSbPortVo(t);e&&(this._view.lab_reward.changeText(_.TextConst.get(62,e.port-37e3)),this._view.item_reward.off(Laya.Event.CLICK,this,this.showTip),this._view.item_reward.on(Laya.Event.CLICK,this,this.showTip,[e.item[0][0],e.item[0][1]]),r.ItemCellUtils.fillCellForItem0View(this._view.item_reward,e.item[0][0],e.item[0][1]),this._view.clip_reward_count.value="x"+e.item[0][1])},t.prototype.getTitle=function(){return"res/shenbing/sb_fantasy/shenbing_huanjing_biaoti.png"},t.prototype.onToFightHandler=function(){if(0<h.RoleCenter.instans.vo.getAttr("SHENBINGHJCOUNT")){var t=h.RoleCenter.instans.vo.shenbing;if(t){var e=t.huanJingCfgId,i=c.GameConfig.sbPortInfoJson[e];i&&0<i.type&&(d.E.ins.event(g.EventName.PLAY_TYPE_CHANGE,v.PlayTypeVo.create(f.EPlayType.PLAYTYPE_SBHJ,{chuangId:e-1,portId:e})),p.LayerManager.closeAllPOPWindow())}}},t}(i.CtrlBase);e.ShenBingFantasyPageCtrl=C}),define("src/g/shenjiang/view/SjTips_Skill",["require","exports","../../../config/GameConfig","../../../utils/ItemUtils","src/g/shenjiang/SjUtils","src/init/TextConst"],function(t,e,u,d,p,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(h){function c(){var t=h.call(this)||this,e=[],i=p.SjUtils.getMinSuitLv(),n=u.GameConfig.sj;for(var s in t.lv=i,n){var o=+s,a=n[s];i!=o&&i+1!=o||e.push(a)}t.list.renderHandler=new Laya.Handler(t,t.renderHandler),t.list.array=e;var r=t.lab_desc;r.style.fontSize=18,r.style.color="#e6c278",r.style.fontFamily="SimHei",r.innerHTML=g.TextConst.get(1128),t.allCount=p.SjUtils.getAllEqPosLvCount();var l=c.cellW;return t.height=400+l*e.length,t.list.height=l*e.length,t}return __extends(c,h),c.prototype.renderHandler=function(t,e){var i=t.dataSource,n=i.condition,s=t.getChildByName("img_bg1"),o=t.getChildByName("img_bg2"),a=t.getChildByName("lab_name"),r=t.getChildByName("lab_desc"),l=t.getChildByName("lab_active"),h=d.ItemUtils.getSkillDefItem(i.skill);r.style.fontFamily="SimHei",r.style.fontSize=16,r.style.color="#a89e8f",r.innerHTML=h.desc,a.style.fontFamily="SimHei",a.style.fontSize=18,a.style.color="#ff7c07",a.innerHTML=h.name;var c=i.id,u=this.lv>=c;s.skin=o.skin="res/di/tiao_"+(u?1:0)+".png";var p=this.allCount[n[0]]||0;u?(l.color="#09d51f",l.text=g.TextConst.get(524)):(l.text=g.TextConst.get(1129,n[0],p,n[1]),l.color="#a89e8f")},c.cellW=80,c}(ui.shenjiang.SjTips_SkillUI);e.SjTips_Skill=i}),define("src/g/shenjiang/SjEnum",["require","exports"],function(t,e){"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),(i=e.SjEnum||(e.SjEnum={}))[i.eqPosStart=260]="eqPosStart",i[i.shenjiangStart=3e3]="shenjiangStart",i[i.maxLv=10]="maxLv"}),define("src/g/shenjiang/view/SjTips_Lv",["require","exports","../../../config/GameConfig","src/g/shenjiang/SjUtils","src/g/shenjiang/SjEnum","src/g/fight/base/RES","../../../component/GAnimation","src/g/Effects/UIEffectsFactory","src/init/TextConst"],function(t,e,l,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(r){function t(){var t=r.call(this)||this;t.ani=new p.GAnimation;var e=h.SjUtils.getMinSuitLv(),i=l.GameConfig.sj[e],n=0,s=!1;l.GameConfig.sj[e+1]?n=e+1:i?(n=e,s=!0):n=e+1,t.lab_max.visible=s;var o=t.ani;o.scale(1.5,1.5),o.clear(),o.load(u.RES.petPath(c.SjEnum.shenjiangStart+(n>c.SjEnum.maxLv?c.SjEnum.maxLv:n),1,4)),o.parent||d.UIEffectsFactory.Ins.centerSAni4Parent(o,t.sp_ani),t.font_lv.value=n+"";var a=t.lab_desc;return a.style.fontSize=18,a.style.color="#e6c278",a.style.fontFamily="SimHei",a.innerHTML=g.TextConst.get(1133),t}return __extends(t,r),t}(ui.shenjiang.SjTips_LvUI);e.SjTips_Lv=i}),define("src/g/shenjiang/view/SjTips_Prop",["require","exports","../../../manager/RoleCenter","../../../utils/ItemUtils","../../../meta/ShuXingVo","../../../config/GameConfig","src/g/shenjiang/SjUtils"],function(t,e,R,L,x,P,k){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(A){function t(){var t=A.call(this)||this,e=R.RoleCenter.instans.self.generalData.suitProp,i=t.box_curr,n=t.box_preview,s=0;for(var o in e){var a=L.ItemUtils.getShuXingByName(o);if("ALL_MULTI"!=o&&a){var r=e[o],l=i.getChildByName("lab_"+s),h=0<r;h&&(l.text=a.desc+":"+x.ShuXingVo.getString4Vo(r,a),l.color="#2ba212"),l.visible=h,s++}}var c=P.GameConfig.sjSuit,u=k.SjUtils.getAllEqPosLvCount(),p=!1,d=!(s=0);for(var o in c){a=c[o];var g=o.split("_"),v=+g[0],f=+g[1];if((u[v]||0)<f){if(!(E=n.getChildByName(s+"")))break;d=!1;var y=E.getChildByName("lab_key"),m=E.getChildByName("lab_val"),_=E.getChildByName("lab_num");y.visible=m.visible=_.visible=!0,y.text=a.name,_.text=(u[a.level]||0)+"/"+a.need;for(var C="",I=a.prop,b=0;b<I.length;b++){var w=I[b],S=L.ItemUtils.getShuXingByName(w[0]);C+=S.desc+":"+x.ShuXingVo.getString4Vo(w[1],S),b+1<I.length&&(C+="\n")}m.text=C,s++}else p=!0}for(;s<3;){var E;if(E=n.getChildByName(s+"")){y=E.getChildByName("lab_key"),m=E.getChildByName("lab_val"),_=E.getChildByName("lab_num");y.visible=m.visible=_.visible=!1}s++}var T=t.img_preP;return T.height=2*Math.abs(T.y-n.y)+n.height,t.height=p?(d&&t.box_preP.removeSelf(),t.vBox.y+t.vBox.height+60):(t.box_currP.removeSelf(),280),t}return __extends(t,A),t}(ui.shenjiang.SjTips_PropUI);e.SjTips_Prop=i}),define("src/g/shenjiang/view/Sj",["require","exports","../../../utils/ItemUtils","src/g/itemGets/View/ItemGetDlg","../../../manager/GameSocketManager","../../../manager/RoleCenter","src/g/shenjiang/vo/SjEqUpVo","../../../config/GameConfig","src/g/Effects/UIEffectsFactory","../../../utils/system/FloatEffect","../../../plugin/sbkPropTool","../../net/messages/PropFightMain","../../net/messages/sbkFormula","src/g/shenjiang/view/SjTips_Skill","src/g/shenjiang/SjUtils","src/g/shenjiang/view/SjTips_Lv","../../../manager/RedDotM","src/g/shenjiang/view/SjTips_Prop","src/g/shenjiang/SjEnum","src/init/TextConst","../../net/messages/sbkGeneralData"],function(t,e,T,i,o,A,h,R,L,a,x,P,k,n,f,s,y,r,D,H,m){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var l=function(l){function t(){var t=l.call(this)||this;t.clickHandler=new Laya.Handler(t,t.getItemDlg),t.boxPoints=[],t.btn_up.on(Laya.Event.CLICK,t,t.upClick),t.img_left.on(Laya.Event.CLICK,t,t.onLeft),t.img_right.on(Laya.Event.CLICK,t,t.onRight),t.img_suit.on(Laya.Event.CLICK,t,t.onSuit),t.img_skill.on(Laya.Event.CLICK,t,t.onSkill),t.lab_preview.on(Laya.Event.CLICK,t,t.onPreview),t.item_cost.setJump(H.TextConst.get(487),t.clickHandler);for(var e=h.SjEqUpVo.costIdArr,i=H.TextConst.get(1131).split(","),n=0;n<m.enumGemeraType.xue;n++){var s=t["box"+n];s.on(Laya.Event.CLICK,t,t.onBoxClick,[n]);var o=+s.name,a=e[o-1];s.img_icon.skin=T.ItemUtils.getIconById(a),s.img_title.skin="res/shenbing/shenjiang/t"+o+".png",s.lab_name.text=i[o-1],t.boxPoints.push([s.x,s.y])}var r=t.lab_desc;return r.style.fontSize=18,r.style.color="#e6c278",r.style.fontFamily="SimHei",r.style.align="center",t}return __extends(t,l),t.prototype.onSuit=function(){(new r.SjTips_Prop).popup()},t.prototype.onPreview=function(){(new s.SjTips_Lv).popup()},t.prototype.onSkill=function(){(new n.SjTips_Skill).popup()},t.prototype.moveBox=function(t,e,i){for(var n=this.boxPoints,s=e;s<i;s++){var o=this["box"+s],a=n[t];Laya.Tween.to(o,{x:a[0],y:a[1]},200,null,Laya.Handler.create(this,this.effctComp,[s])),t++}},t.prototype.effctComp=function(t){if(this.currBoxIdx==t){var e=this["box"+t],i=this.box_eq,n=i.numChildren-1;e.lab_name.visible=!1,e.img_title.visible=!0,i.setChildIndex(this.eq_pos,n),i.setChildIndex(e,n);var s=+e.name,o=A.RoleCenter.instans.vo,a=o.generalData.lvArr[s-1],r=R.GameConfig.sjEqUp[1e4*s+a],l=R.GameConfig.sjEqUp[1e4*s+a+1],h=void 0,c=+(h=l?l.cost:r.cost)[0][0],u=T.ItemUtils.getItemVoById(c),p=A.RoleCenter.instans.vo.bagdata.getItemCount(c),d=h[0][1],g=this.item_cost;this.type=s,this.itemid=c,g.setNeedName(u.name,T.ItemUtils.getSmallIcon(u.icon)),g.setQualColor(T.ItemUtils.getColorByQuality(u.quality)),g.setNeed(p,d);for(var v=r?r.prop:null,f=l?l.prop:null,y=0;y<4;y++){var m=this["box_prop"+y],_=m.getChildByName("curr"),C=m.getChildByName("next"),I=!0;if(v){var b=v[y],w=T.ItemUtils.getShuXingByName(b[0]);_.text=w.desc+":+"+b[1],C.text=f?"→"+f[y][1]:"→"+H.TextConst.get(208)}else{if(b=f[y]){w=T.ItemUtils.getShuXingByName(b[0]);_.text=w.desc+":+0",C.text="→"+b[1]}else I=!1}(m.visible=I)&&m.refresh()}L.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.eq_pos,D.SjEnum.eqPosStart+s);var S=0;if(0<a){var E=new P.PropHalo;x.sbkPropTool.reSetProp(E,r.prop),S+=k.sbkFormula.calPropFightMainCombat(E)*o.heronum,S+=r.power}this.box_fight.setFightNum(S),this.btn_up.label=0==a?H.TextConst.get(237):H.TextConst.get(615),this.btn_up.visible=!!l,g.visible=!!l}},t.prototype.startEffect=function(){for(var t=this.currBoxIdx,e=0,i=m.enumGemeraType.xue,n=0;n<i;n++)Laya.Tween.clearTween(this["box"+n]);this.moveBox(e,t,i),(e=i-t)<i&&(this.moveBox(e,0,t),e+=t)},t.prototype.onBoxClick=function(t){var e=this.currBoxIdx;if(isNaN(t)&&(t=0),e!=t){if(!isNaN(e)){var i=this["box"+e];i.lab_name.visible=!0,i.img_title.visible=!1}this.currBoxIdx=t,this.startEffect()}else this.effctComp(e)},t.prototype.getItemDlg=function(){var t=T.ItemUtils.getItemVoById(this.itemid);(new i.ItemGetDlg).initByVo(t).popup()},t.prototype.upClick=function(){var t,e=this.type,i=A.RoleCenter.instans.self.generalData.lvArr[e-1],n=R.GameConfig.sjEqUp[1e4*e+i+1];if(n)if(t=n.cost,A.RoleCenter.instans.vo.bagdata.getItemCount(t[0][0])<t[0][1])a.FE.upItems(H.TextConst.get(370));else{var s=new m.GeneralLvMSG;s.type=e,s.Lv=i,o.GSM.sendServer(s)}else a.FE.upItems(H.TextConst.get(208))},t.prototype.onRight=function(){var t=this.currBoxIdx;++t>=m.enumGemeraType.xue&&(t=0),this.currBoxIdx=t,this.startEffect()},t.prototype.onLeft=function(){var t=this.currBoxIdx;--t<0&&(t=m.enumGemeraType.xue-1),this.currBoxIdx=t,this.startEffect()},t.prototype.refresh=function(){for(var t=A.RoleCenter.instans.self.generalData.lvArr,e=y.RedDotM._sj,i=0;i<m.enumGemeraType.xue;i++){var n=this["box"+i],s=+n.name,o=t[+s-1];n.lab_count.text=o+"",n.img_red.visible=e[s].hasRed()}var a=R.GameConfig.sj,r="",l=f.SjUtils.getMinSuitLv(),h=f.SjUtils.getAllEqPosLvCount(),c=a[l],u=a[l+1];if(u){var p=u.condition,d=p[0],g=p[1],v=h[d]||0;r=0==l?H.TextConst.get(1135,v,g,d):H.TextConst.get(1136,v,g,d,u.id)}else r=H.TextConst.get(1137,c.id);this.lab_desc.innerHTML=r,this.onBoxClick(this.currBoxIdx)},t}(ui.shenjiang.SjUI);e.Sj=l}),define("src/g/shenjiang/ctrl/ShenjiangCtrl",["require","exports","src/g/base/BaseCtrl","src/g/clearRes/ClearResM","../../../manager/GameSocketManager","../../../manager/RoleCenter","src/g/Effects/UIEffectsFactory","../../../plugin/sbkPropTool","../../../enum/EventName","../../../core/NumE","src/g/shenjiang/view/Sj","src/g/shenjiang/vo/SjEqUpVo","src/g/shenshou/view/ShenActTip","src/g/shenjiang/SjEnum","src/g/shenjiang/SjUtils","src/g/fight/base/RES","src/g/fight/osprite/SceneObjCtroller","../../../config/GameConfig","../../../core/E","../../net/messages/sbkGeneralData"],function(t,e,i,n,s,c,u,o,a,p,r,l,d,g,v,f,y,m,h,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var C=function(e){function t(){var t=e.call(this)||this;return t.url="res/atlas/res/shenbing/shenjiang.json",s.GSM.ins.on(_.GeneralLvMSG.KEY,t,t.lvUp),h.E.ins.on(a.EventName.ADDED_ZHUANSHENG,t,t.refreshData),t}return __extends(t,e),t.prototype.lvUp=function(t){var e=t.Lv,i=t.type,n=c.RoleCenter.instans.vo.generalData.lvArr,s=v.SjUtils.getMinSuitLv();n[i-1]=e;var o=m.GameConfig.sjEqUp[1e4*i+e];p.NumE.ins.event(+o.cost[0][0]+p.NumE.CHANGED);var a=g.SjEnum.shenjiangStart,r=v.SjUtils.getMinSuitLv();if(s<r){var l=a+(r>g.SjEnum.maxLv?g.SjEnum.maxLv:r),h=new d.ShenActTip;h.ani.scale(1.5,1.5),h.popTip(f.RES.petPath(l,1,4)),h.ani.x+=30,h.ani.y+=30,y.SceneObjCtroller.ins.resetSj(l)}u.UIEffectsFactory.Ins.playAniOnce(11,this._view,1.3,1.3),this.updCombat(),this.refreshData()},t.prototype.updCombat=function(){var t=c.RoleCenter.instans.vo,e=t.combat;o.sbkPropTool.resetShenjiang();var i=t.reCheckComBat();c.RoleCenter.instans.event(a.EventName.FIGHT_UP,i-e)},t.prototype.init=function(){this._view=new r.Sj,this._view.on(Laya.Event.UNDISPLAY,this,this.unDisplay);for(var t=p.NumE.ins,e=l.SjEqUpVo.costIdArr,i=0;i<e.length;i++)t.on(e[i]+p.NumE.CHANGED,this,this.refreshData)},t.prototype.unDisplay=function(){this.clearCtrlRes()},t.prototype.onAtlasLoaded=function(){n.ClearResM.resetViewImg(this._view)},t.prototype.showPage=function(t,e){this._view||this.init(),t.removeChildren(),t.addChild(this._view),this.open(),this.refreshData()},t.prototype.loadUrls=function(){},t.prototype.changePerson=function(t,e){this.refreshData()},t.prototype.refreshData=function(){var t=this._view;t&&t.refresh()},t.prototype.getTitle=function(){return"res/title/shenjiang.png"},t.prototype.hidePage=function(){this._view&&this._view.removeSelf()},t.prototype.destroyPage=function(){},t}(i.BaseCtrl);e.ShenjiangCtrl=C}),define("src/g/shenbing/ctrl/ShenBingBgCtrl",["require","exports","src/g/shenbing/ShenBingBgView","../../../manager/GameSocketManager","src/init/Switches","src/g/accessctrl/AccessCenter","src/g/base/BaseCtrl","../../../manager/RoleCenter","src/g/proxy/MultiLevelUIProxy","src/init/ResManager","src/g/clearRes/ClearResM","src/g/shenbing/ctrl/page/ShenBingPageCtrl","../../net/messages/sbkShenBingData","src/g/shenbing/ctrl/page/ShenBingFantasyPageCtrl","../../../core/E","../../../enum/EventName","../../../vo/RedDot/Reddot_shenbing","../../../plugin/sbkPropTool","../../../utils/SbUtils","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/init/TextConst","src/g/shenjiang/ctrl/ShenjiangCtrl"],function(t,e,n,s,o,a,i,r,l,h,c,u,p,d,g,v,f,y,m,_,C,I,b){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var w=function(i){function t(){var t=i.call(this)||this;t._nowJob=1,t._openArg=[],t.urls=["res/atlas/res/shenbing/shenbing.json","res/atlas/res/shenbing/sb_fantasy.json"],t._shenjiang=new b.ShenjiangCtrl,t._shenbing=new u.ShenBingPageCtrl,t._fantasy=new d.ShenBingFantasyPageCtrl,o.Switches.ins.on(188,t,t.onOpenHandler,[188]),o.Switches.ins.on(189,t,t.onOpenHandler,[189]),o.Switches.ins.on(274,t,t.onOpenHandler,[274]),o.Switches.ins.on(502,t,t.onOpenHandler,[502]);var e=s.GSM.ins;return e.on(p.sbkShenBingData.KEY,t,t.onsbkShenBingData),e.on(p.oneSBData.KEY,t,t.ononeSBData),e.on(p.GetSBTaskMSG.KEY,t,t.onGetSBTaskMSG),e.on(p.AddSBExpGS2C.KEY,t,t.onAddSBExpGS2C),e.on(p.AddSBGiftMSG.KEY,t,t.onAddSBGiftMSG),t}return __extends(t,i),t.prototype.onsbkShenBingData=function(t){this._user||(this._user=r.RoleCenter.instans.vo),this._user.shenbing.copydata(t),f.Reddot_shenbing.Ins.reCheckTask(),y.sbkPropTool.reSetAllShenBing(),this._user.reCheckComBat(!1),this._shenbing&&this._page==this._shenbing&&this._shenbing.refreshData()},t.prototype.ononeSBData=function(t){this._user||(this._user=r.RoleCenter.instans.vo);var e=this._user.shenbing.jobArr.indexOf(t.job);-1<e?this._user.shenbing.oneArr[e]=t:(this._user.shenbing.oneArr.push(t),this._user.shenbing.jobArr.push(t.job)),f.Reddot_shenbing.Ins.reCheckTask();var i=this._user.combat;y.sbkPropTool.reSetAllShenBing();var n=this._user.reCheckComBat();r.RoleCenter.instans.event(v.EventName.FIGHT_UP,n-i),this._page==this._shenbing&&this._shenbing.refreshData(),g.E.ins.event(v.EventName.UPDATE_SB_SKILL)},t.prototype.onGetSBTaskMSG=function(t){this._user||(this._user=r.RoleCenter.instans.vo),this._user.shenbing.curTaskId=t.curTaskId,this._user.shenbing.curTaskNum=0,f.Reddot_shenbing.Ins.reCheckTask(),this._page==this._shenbing&&this._shenbing.refreshData()},t.prototype.onAddSBExpGS2C=function(t){this._user||(this._user=r.RoleCenter.instans.vo);var e=m.SbUtils.getOneSbDataByJob(t.job);e.exp=t.curExp,e.lv=t.curLv,e.giftCount=t.giftCount,f.Reddot_shenbing.Ins.reCheckTask(),this._page==this._shenbing&&this._shenbing.refreshData();var i=this._user.combat;y.sbkPropTool.reSetAllShenBing();var n=this._user.reCheckComBat();r.RoleCenter.instans.event(v.EventName.FIGHT_UP,n-i),g.E.ins.event(v.EventName.SHENBING_COMBAT_ADD,y.sbkPropTool.reSetShenBingByJob(t.job))},t.prototype.onAddSBGiftMSG=function(t){this._user||(this._user=r.RoleCenter.instans.vo);var e=m.SbUtils.getOneSbDataByJob(t.job),i=e.giftArr.indexOf(t.curGiftId);-1==i?(e.giftArr.push(t.curGiftId),e.giftArr.push(t.curLv)):e.giftArr[i+1]=t.curLv,e.giftCount-=1,f.Reddot_shenbing.Ins.reCheckTask(),this._page==this._shenbing&&this._shenbing.refreshData();var n=m.SbUtils.getTianFuVo(t.curGiftId);n.Tskill_id&&0!=n.Tskill_id&&(e.giftPropC.push(n.skill_id),e.giftPropC.push(n.Tskill_id),g.E.ins.event(v.EventName.UPDATE_SB_SKILL));var s=this._user.combat;y.sbkPropTool.reSetAllShenBing();var o=this._user.reCheckComBat();r.RoleCenter.instans.event(v.EventName.FIGHT_UP,o-s),g.E.ins.event(v.EventName.SHENBING_TIANFU_UPLV),g.E.ins.event(v.EventName.SHENBING_COMBAT_ADD,y.sbkPropTool.reSetShenBingByJob(t.job))},t.prototype.initCtrl=function(){this._shenbing=new u.ShenBingPageCtrl,this._fantasy=new d.ShenBingFantasyPageCtrl},t.prototype.onOpenHandler=function(t,e,i,n){if(void 0===i&&(i=!0),void 0===n&&(n=!1),e)if(188==t)if(a.AccessCenter.ins.checkOpen(188)){if(3!=r.RoleCenter.instans.vo.heronum)return void _.FE.upItems(I.TextConst.get(739),C.BubbleEnum.center);this.openShenBingView(188,i,n)}else a.AccessCenter.ins.checkOpen(189)&&this.openShenBingView(189,i,n);else this.openShenBingView(t,i,n)},t.prototype.tab_selectHandler=function(t){this._page&&this._page.hidePage();0==t?this._page=this._shenbing:1==t?this._page=this._fantasy:2==t&&(this._page=this._shenjiang),this._view.tab_head.visible=!1,this._nowJob=r.RoleCenter.instans.vo.getOpenHeroByIdx(0).jobid,this._page&&this._page.showPage(this._view.bg_view.box_page,this._nowJob),this._view.bg_view.img_title.skin=this._page.getTitle(),c.ClearResM.resetViewImg(this._view.bg_view)},t.prototype.initView=function(){this._view=new n.ShenBingBgView,this._tabProxy=new l.MultiLevelUIProxy,this._tabProxy.registerTab(this._view.tab_page,0),this._tabProxy.registerTagIndex(188,0),this._tabProxy.registerTagIndex(189,1),this._tabProxy.registerTagIndex(274,2),this._tabProxy.registerTagIndex(502,3),this._tabProxy.selectHandler=new Laya.Handler(this,this.tab_selectHandler),this._view.tab_head.setCallbackHandler(new Laya.Handler(this,this.HeroSelect)),this._view.bg_view.btn_back.on(Laya.Event.CLICK,this,this.hidePage),this._view.bg_view.btn_close.on(Laya.Event.CLICK,this,this.hidePage)},t.prototype.openShenBingView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._openArg.length=0,this._openArg.push(t),this._openArg.push(e),this._openArg.push(i),this.opens()},t.prototype.onAtlasLoaded=function(){this.realOpenReXueView(this._openArg[0],this._openArg[1],this._openArg[2])},t.prototype.realOpenReXueView=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=!0),void 0===i&&(i=!1),this._view||this.initView(),this._tabProxy.open(t),this._view.showView(e,i)},t.prototype.HeroSelect=function(t,e){r.RoleCenter.instans.self.openhero[t]?(this._nowJob=r.RoleCenter.instans.vo.getOpenHeroByIdx(t).jobid,this._view.tab_head.setSelectIndex(t),this._page.changePerson(t,r.RoleCenter.instans.vo.getOpenHeroByIdx(t))):o.Switches.ins.event(15)},t.prototype.init=function(){return null},t.prototype.showPage=function(t,e){h.ResManager.getInstance().showRolePageCtrl(this)},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){this._page&&this._page.refreshData()},t.prototype.getTitle=function(){return null},t.prototype.hidePage=function(){this._view&&this._view.hideView(),this._shenbing&&this._shenbing.hidePage(),this.destroyPage()},t.prototype.destroyPage=function(){this._view&&this._view.destroyView(),this._shenbing&&this._shenbing.destroyPage(),this.clearCtrlRes(),c.ClearResM.clearResFolder("shenbing/"),c.ClearResM.clearFolderByUrl("dynamic/shenbing/skillIcon/")},t}(i.BaseCtrl);e.ShenBingBgCtrl=w}),define("src/g/shenbing/ctrl/ShenBingFantasyCtrl",["require","exports","../../../manager/RoleCenter","../../../enum/EventName","../../../core/E","src/g/accessctrl/AccessCenter","../../../manager/NewRedHintsCenter"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){s.E.ins.on(n.EventName.USER_DATA_ATTR_CHANGED+"SHENBINGHJCOUNT",this,this.checkRed),o.AccessCenter.ins.inited?this.onInitRed():s.E.ins.once(n.EventName.ACCESS_CENTER_INITED,this,this.onInitRed)}return t.prototype.onInitRed=function(){o.AccessCenter.ins.checkOpen(189)?this.checkRed():o.AccessCenter.ins.on(189,this,this.accessChanged)},t.prototype.accessChanged=function(){o.AccessCenter.ins.checkOpen(189)&&(o.AccessCenter.ins.off(189,this,this.accessChanged),this.checkRed())},t.prototype.checkRed=function(){if(o.AccessCenter.ins.checkOpen(189)&&0<i.RoleCenter.instans.vo.getAttr("SHENBINGHJCOUNT"))return void a.NewRedHintsCenter.ins.setRedHintOpenOrClose(a.enumRedHints.sb_fantasy,!0);a.NewRedHintsCenter.ins.setRedHintOpenOrClose(a.enumRedHints.sb_fantasy,!1)},t}();e.ShenBingFantasyCtrl=r}),define("src/g/shenjiang/SjRedListener",["require","exports","src/g/redhints/RedListenner","src/g/accessctrl/AccessCenter","../../manager/RoleCenter","src/g/shenjiang/vo/SjEqUpVo","../../config/GameConfig","../../core/NumE","../../core/E","../../enum/EventName","../net/messages/sbkGeneralData"],function(t,e,s,h,c,o,u,a,r,l,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(n){function t(t){for(var e=n.call(this,t)||this,i=p.enumGemeraType.ren;i<=p.enumGemeraType.xue;i++)e.addChild(new s.RedListenner(i));return e.addLis(),r.E.ins.on(l.EventName.INIT_SELFSETOVER,e,e.onInit),r.E.ins.on(l.EventName.CHANGEITEM_COUNT,e,e.checkRed),e}return __extends(t,n),t.prototype.onInit=function(){this.addLis(),this.checkRed()},t.prototype.addLis=function(){var t=a.NumE.ins;if(!this.init){this.init=!0;for(var e=o.SjEqUpVo.costIdArr,i=0;i<e.length;i++)t.on(e[i]+a.NumE.CHANGED,this,this.checkRed)}h.AccessCenter.ins.register(274,this,this.checkRed)},t.prototype.checkRed=function(){if(h.AccessCenter.ins.checkOpen(274))for(var t=c.RoleCenter.instans.vo,e=t.generalData.lvArr,i=u.GameConfig.sjEqUp,n=t.bagdata,s=0;s<e.length;s++){var o=!1,a=s+1,r=i[1e4*a+e[s]+1],l=void 0;r&&(l=r.cost),r&&n.getItemCount(l[0][0])>=l[0][1]&&(o=!0),this[a].red=o}},t}(s.RedListenner);e.SjRedListener=i}),define("src/g/zhanling/view/ZlExp",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(ui.zhanling.ZlExpUI);e.ZlExp=i}),define("src/g/zhanling/ctrl/ZlExpCtrl",["require","exports","src/g/zhanling/view/ZlExp","src/g/clearRes/ClearResM","../../../config/GameConfig","../../../manager/RoleCenter","../../../core/E","../../../enum/EventName","src/g/fight/info/PlayTypeVo","../../net/messages/ChangeSceneMsg","../../../vo/RedDot/RedDot_Zl"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(){}return t.prototype.init=function(){var t=this.view;return t||(this.view=t=new i.ZlExp,t.btn_tz.on(Laya.Event.CLICK,this,this.onClick)),this},t.prototype.showPage=function(t,e){var i=this.view;t.removeChildren(),t.addChild(i),n.ClearResM.resetViewImg(i),this.refreshData()},t.prototype.changePerson=function(t,e){this.refreshData()},t.prototype.refreshData=function(){c.RedDot_Zl.check();var t=o.RoleCenter.instans.vo.COPYZLCOUNT,e=this.view;e.label_count.color=0==t?"#ff0f15":"#03bb00",e.btn_tz.disabled=0==t,e.label_count.text=t+"/"+s.GameConfig.zlcopy[20011].chance},t.prototype.getTitle=function(){return"res/zhanling/zlfb_bt.png"},t.prototype.hidePage=function(){},t.prototype.destroyPage=function(){},t.prototype.onClick=function(t){var e=this.view;switch(t.currentTarget){case e.btn_tz:a.E.ins.event(r.EventName.PLAY_TYPE_CHANGE,l.PlayTypeVo.create(h.EPlayType.PLAYTYPE_COPYZL))}},t}();e.ZlExpCtrl=u}),define("src/g/shenshou/ctrl/ShenShouCtrl",["require","exports","src/init/Switches","src/g/shenshou/view/ShenShouView","src/g/proxy/MultiLevelUIProxy","../../../manager/LayerManager","../../../manager/GameSocketManager","../../net/messages/sbkPetData","../../../manager/RoleCenter","src/g/shenshou/view/ShenActTip","../../../config/GameConfig","../../../manager/NewRedHintsCenter","../../../enum/EventName","../../../core/E","src/g/base/BaseCtrl","../../../vo/RedDot/RedDot_Zl","src/g/zhanling/ctrl/ZlYcCtrl","src/g/zhanling/ctrl/ZlExpCtrl","src/g/clearRes/ClearResM","src/g/fight/osprite/SceneObjCtroller","../../../utils/ItemUtils"],function(t,e,o,i,a,r,l,h,c,u,p,d,g,v,n,f,y,m,_,C,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(n){function s(){var t=n.call(this)||this;t._pro=new a.MultiLevelUIProxy,t.urls=["res/atlas/res/zhanling.json","res/atlas/res/shenshou.json"];var e=l.GSM.ins;e.on(h.sbkPetData.KEY,t,t.sbkPetData),e.on(h.ActivatePetGS2C.KEY,t,t.ActivatePetGS2C);var i=o.Switches.ins;return i.on(222,t,t.openHandler,[222]),i.on(223,t,t.openHandler,[223]),i.on(208,t,t.openHandler,[208]),i.on(214,t,t.openHandler,[214]),v.E.ins.on(g.EventName.CHANGEITEM_COUNT,t,t.checkItems),v.E.ins.on(g.EventName.CLOSEALLWINDOWS,t,t.closeHandler),v.E.ins.on(g.EventName.SHENSHOU_CHECKRED,s,s.checkPetRed),t}return __extends(s,n),s.prototype.checkItems=function(t){s._idsObj[t]&&s.checkPetRed();var e=f.RedDot_Zl.costAllId;if(e&&-1!=e.indexOf(t)){f.RedDot_Zl.check();var i=this.zlyc;i&&i.view&&i.view.updateRed()}},s.prototype.ActivatePetGS2C=function(t){if(t.opresult){var e="dynamic2/zhiwawa/pet/"+p.GameConfig.godpetseting[2].res[0][1]+".json";(new u.ShenActTip).popTip(e),c.RoleCenter.instans.vo.petData=t.petdata,d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.chongwujihuo,!1),t.opresult&&this._pro.open(0)}},s.prototype.sbkPetData=function(t){c.RoleCenter.instans.vo.petData=t,s.checkPetRed();var e=c.RoleCenter.instans.vo.petData;if(e.open){var i=C.SceneObjCtroller.ins.getSelfGroup().getPet();i?(i.avatarId=I.ItemUtils.getPetAvid(e),i.resetCoat()):C.SceneObjCtroller.ins.createPetShen()}},s.checkPetRed=function(){var t=c.RoleCenter.instans.vo.petData,e=p.GameConfig.godpet[t.petid].const;if(e.length){var i=e[0][0];if(this._idsObj[i]=i,e[0][1]<=c.RoleCenter.instans.vo.bagdata.getItemCount(i)){t.petlvl;d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.chongwushengji,!0)}else d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.chongwushengji,!1)}d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.chongwuhuanhua,!1);var n=p.GameConfig.godpetseting[3];this.setRedHuanHua(n);n=p.GameConfig.godpetseting[4];this.setRedHuanHua(n);n=p.GameConfig.godpetseting[5];this.setRedHuanHua(n);n=p.GameConfig.godpetseting[6];this.setRedHuanHua(n)},s.setRedHuanHua=function(t){if(!t)return!1;var e=t.res[0][1],i=c.RoleCenter.instans.vo.petData,n=p.GameConfig.godpet[e].activationcost;if(n.length){var s=n[0][0];if(this._idsObj[s]=s,n[0][1]<=c.RoleCenter.instans.vo.bagdata.getItemCount(s)&&-1==i.hhIdArr.indexOf(e))return d.NewRedHintsCenter.ins.setRedHintOpenOrClose(d.enumRedHints.chongwuhuanhua,!0),!0}return!1},s.prototype.openHandler=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1),c.RoleCenter.instans.vo.petData&&e&&(this.id=t,this.closeOther=i,this.opens(),this.showBlock())},s.prototype.onAtlasLoaded=function(){},s.prototype.showBlock=function(){var t=this.view,e=this._pro;t||(this.view=t=new i.ShenShouView,this.bgUrl="res/bg/shenshou_beijing.jpg",_.ClearResM.addBgUrl(this.bgUrl),e.registerTab(t.tab,0),e.registerTagIndex(222,0),e.registerTagIndex(223,1),e.registerTagIndex(208,2),e.registerTagIndex(214,3),e.selectHandler=new Laya.Handler(this,this.tab_selectHandler),t.bgview.btn_back.on(Laya.Event.CLICK,this,this.closeHandler),t.bgview.btn_close.on(Laya.Event.CLICK,this,this.closeHandler)),e.open(this.id),r.LayerManager.addInPOPWindowLayer(t,this.closeOther)},s.prototype.closeHandler=function(){var t=this.view;t&&t.removeSelf(),this.clearCtrlRes()},s.prototype.tab_selectHandler=function(t){void 0===t&&(t=0);var e=this._page;e&&(e.hidePage(),e=null);var i=this.view,n=i.bgview;switch(t){case 2:this.zlyc||(this.zlyc=(new y.ZlYcCtrl).init()),this.zlyc.setType(0),e=this.zlyc;break;case 3:this.zlfb||(this.zlfb=(new m.ZlExpCtrl).init()),e=this.zlfb;break;default:n.img_bg.skin=this.bgUrl,i.showView(t)}e&&(n.img_bg.skin=" ",e.showPage(n.box_page),n.img_title.skin=e.getTitle()),this._page=e,_.ClearResM.resetViewImg(i)},s._idsObj={},s}(n.BaseCtrl);e.ShenShouCtrl=s}),define("src/g/skill/view/CompDlg",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(ui.skill.CompoundTipDlgUI);e.CompDlg=i}),define("src/g/task/TaskScript",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.prototype.start=function(){},t.prototype.stop=function(){},t}();e.TaskScript=i}),define("src/g/task/TaskAction",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.type=1}return t.prototype.detect=function(){return!0},t.prototype.enter=function(){},t.prototype.exit=function(){for(var t=(this._children?this._children.length:0)-1;0<=t;)this._children[t].exit(),t--;this.parent&&this.parent.onChildExit(this)},t.prototype.addChild=function(t){1!=this.type&&(this._children||(this._children=[]),this._children.push(t),t.parent=this)},t.prototype.onChildExit=function(t){if(this._children){var e=this._children.indexOf(t);-1!=e&&this._children.splice(e,1)}},t}();e.TaskAction=i}),define("src/g/task/SequenceTaskAction",["require","exports","src/g/task/TaskAction"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.type=2,t}return __extends(t,e),t.prototype.detect=function(){for(var t=this._children?this._children.length:0,e=0;e<t;){if(this._children[e].detect())return!0;e++}return!1},t.prototype.enter=function(){this._run=!0,this.doNext()},t.prototype.doNext=function(){if(this._children&&0<this._children.length){var t=this._children[0];t.detect()?t.enter():t.exit()}else this.exit()},t.prototype.onChildExit=function(t){e.prototype.onChildExit.call(this,t),this._run&&this.doNext()},t.prototype.exit=function(){this._run=!1,e.prototype.exit.call(this)},t}(i.TaskAction);e.SequenceTaskAction=n}),define("src/g/task/actions/MoveToNpcMap",["require","exports","src/g/task/TaskAction","../../../manager/TaskManager","../../../config/GameConfig","src/g/fight/osprite/play/PlayManager","../../net/messages/ChangeSceneMsg","../../../core/E","../../../enum/EventName","src/g/fight/info/PlayTypeVo","src/g/fight/osprite/GameScene","../../../meta/MapVO","../../../meta/PortVo"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.detect=function(){return!0},e.prototype.enter=function(){var t=n.TaskManager.ins.currentTask;if(t){var e=s.GameConfig.getNPCVoByTaskID(t.id);e&&(1==e.mapID?this.wantType=a.EPlayType.PLAYTYPE_NEWVILLAGE:100==e.mapID&&(this.wantType=a.EPlayType.PLAYTYPE_MAINCITY,this.data={portid:100,npcid:e.NpcID})),this.wantType&&(o.PlayManager.ins.crtType!=this.wantType?(r.E.ins.on(l.EventName.PLAY_TYPE_CHANGED,this,this.onPlayTypeChanged),c.GameScene.ins.mapVo=new u.MapVO,c.GameScene.ins.mapVo.startPoint=[[0,0]],c.GameScene.ins.port=new p.PortVo,r.E.ins.event(l.EventName.PLAY_TYPE_CHANGE,h.PlayTypeVo.create(this.wantType,this.data))):this.exit())}else this.exit()},e.prototype.onPlayTypeChanged=function(){Laya.timer.clear(this,this.exit),o.PlayManager.ins.crtType==this.wantType&&Laya.timer.once(500,this,this.exit)},e.prototype.exit=function(){this.wantType=0,r.E.ins.off(l.EventName.PLAY_TYPE_CHANGED,this,this.onPlayTypeChanged),t.prototype.exit.call(this)},e}(i.TaskAction);e.MoveToNpcMap=d}),define("src/g/task/actions/MoveToNpc",["require","exports","src/g/task/TaskAction","../../../manager/TaskManager","../../../config/GameConfig","src/g/fight/osprite/SceneObjCtroller","src/g/fight/osprite/play/PlayManager","src/g/fight/osprite/play/GamePlayVillage","src/g/fight/osprite/play/GamePlayMainCity","../../../core/E","../../../enum/EventName","../../net/messages/ChangeSceneMsg"],function(t,e,i,o,a,r,l,h,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.detect=function(){return!0},e.prototype.enter=function(){u.E.ins.off(p.EventName.TALK_TO_NPC_OVER,this,this.findTheNPC),u.E.ins.off(p.EventName.PLAY_TYPE_CHANGED,this,this.onPlayTypeChanged);var t=o.TaskManager.ins.currentTask;if(t){var e=a.GameConfig.getNPCVoByTaskID(t.id);if(e){1==e.mapID?this.wantType=d.EPlayType.PLAYTYPE_NEWVILLAGE:100==e.mapID&&(this.wantType=d.EPlayType.PLAYTYPE_MAINCITY);var i=r.SceneObjCtroller.ins.getSelfGroup();if(i){var n=l.PlayManager.ins.play,s=void 0;n instanceof h.GamePlayVillage?s=n.getNPCFromId(e.NpcID):n instanceof c.GamePlayMainCity&&(s=n.getNPCFromId(e.NpcID)),s&&i.setNPCTarget(s)}}u.E.ins.on(p.EventName.PLAY_TYPE_CHANGED,this,this.onPlayTypeChanged),u.E.ins.on(p.EventName.TALK_TO_NPC_OVER,this,this.findTheNPC)}else this.exit()},e.prototype.onPlayTypeChanged=function(){Laya.timer.clear(this,this.enter),l.PlayManager.ins.crtType==this.wantType?Laya.timer.once(500,this,this.enter):u.E.ins.off(p.EventName.TALK_TO_NPC_OVER,this,this.findTheNPC)},e.prototype.exit=function(){u.E.ins.off(p.EventName.TALK_TO_NPC_OVER,this,this.findTheNPC),u.E.ins.off(p.EventName.PLAY_TYPE_CHANGED,this,this.onPlayTypeChanged),t.prototype.exit.call(this)},e.prototype.findTheNPC=function(){this.exit()},e}(i.TaskAction);e.MoveToNpc=n}),define("src/g/task/actions/DialogueToNpc",["require","exports","src/g/task/TaskAction","../../../enum/Task","../../../manager/TaskManager","../../../core/E","../../../enum/EventName","../../../config/GameConfig","src/init/Switches","src/g/fight/osprite/NetCtroller"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.detect=function(){return!0},e.prototype.enter=function(){var t=s.TaskManager.ins.currentTask;if(t&&t.npcId)if(t.type==n.TaskType.Dialogue)if(0<t.need){var e=r.GameConfig.getNpcByID(t.npcId);0<e.moduleID&&(l.Switches.ins.event(e.moduleID),h.NetCtroller.finishTask(s.TaskManager.ins.currentTask.id,s.TaskManager.ins.currentTask.follow))}else o.E.ins.event(a.EventName.POPTASK,t.npcId);else o.E.ins.event(a.EventName.POPTASK,t.npcId);this.exit()},e}(i.TaskAction);e.DialogueToNpc=c}),define("src/g/task/scripts/DialogueTaskScript",["require","exports","src/g/task/TaskScript","src/g/task/SequenceTaskAction","src/g/task/actions/MoveToNpcMap","src/g/task/actions/MoveToNpc","src/g/task/actions/DialogueToNpc"],function(t,e,i,n,s,o,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.start=function(){var t=new n.SequenceTaskAction,e=new n.SequenceTaskAction;e.addChild(new s.MoveToNpcMap),e.addChild(new o.MoveToNpc),t.addChild(e),t.addChild(new a.DialogueToNpc),(this._currAction=t).detect()&&t.enter()},e.prototype.stop=function(){this._currAction&&(this._currAction.exit(),this._currAction=null)},e}(i.TaskScript);e.DialogueTaskScript=r}),define("src/g/task/DoTask",["require","exports","../../manager/TaskManager","../../enum/Task","../../core/E","../../enum/EventName","src/g/task/scripts/DialogueTaskScript","src/g/fight/osprite/play/PlayManager","../net/messages/ChangeSceneMsg","src/g/fight/info/PlayTypeVo","src/g/fight/osprite/NetCtroller","src/g/fight/osprite/play/MainCityManager","../../enum/TaskCofigEnum"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(){function t(){}return t.prototype.start=function(){this.onTaskUpdate(),s.E.ins.on(o.EventName.CURRENT_TASK_CHANGE,this,this.onTaskUpdate)},t.prototype.stop=function(){s.E.ins.off(o.EventName.CURRENT_TASK_CHANGE,this,this.onTaskUpdate),this._currScript&&(this._currScript.stop(),this._currScript=null)},t.prototype.onTaskUpdate=function(){this._currScript&&(this._currScript.stop(),this._currScript=null),i.TaskManager.ins.currentTask&&(i.TaskManager.ins.currentTask.id<p.TaskCofigEnum.startTask||(i.TaskManager.ins.currentTask.type==n.TaskType.Dialogue?(this._currScript=new a.DialogueTaskScript,this._currScript.start()):i.TaskManager.ins.currentTask.type==n.TaskType.IntoAutoCopy?(r.PlayManager.ins.crtType!=l.EPlayType.PLAYTYPE_PORT&&s.E.ins.event(o.EventName.PLAY_TYPE_CHANGE,h.PlayTypeVo.create(l.EPlayType.PLAYTYPE_PORT)),c.NetCtroller.finishTask(i.TaskManager.ins.currentTask.id,i.TaskManager.ins.currentTask.follow)):i.TaskManager.ins.currentTask.type==n.TaskType.CompleteOnePort&&r.PlayManager.ins.crtType==l.EPlayType.PLAYTYPE_MAINCITY&&u.MainCityManager.getInstance().ExitMainCity()))},t}();e.DoTask=d}),define("src/g/task/ParallelTaskAction",["require","exports","src/g/task/TaskAction"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.type=4,t}return __extends(t,e),t}(i.TaskAction);e.ParallelTaskAction=n}),define("src/g/task/SelectorTaskAction",["require","exports","src/g/task/TaskAction"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.type=3,t}return __extends(t,e),t}(i.TaskAction);e.SelectorTaskAction=n}),define("src/g/taskview/TaskCompletDlg",["require","exports","src/init/Switches"],function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){function t(){var t=e.call(this)||this;return t.btn_go.on(Laya.Event.CLICK,t,t.onBtnClickHandler),t}return __extends(t,e),t.prototype.onBtnClickHandler=function(){this.close(),i.Switches.ins.event(93)},t}(ui.alert.TaskCompletDlgUI);e.TaskCompletDlg=n}),define("src/g/treasure/TreasureView",["require","exports","../../manager/LayerManager","src/g/proxy/MultiLevelUIProxy","src/g/relic/ctrl/RelicPageCtrl","src/g/skill/ctrl/GHandBookCtrl"],function(t,e,n,i,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.helpIndex=0,t.bg.btn_back.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_close.on(Laya.Event.CLICK,t,t.onCloseHandler),t.bg.btn_help.visible=!1,t._tabProxy=new i.MultiLevelUIProxy,t._tabProxy.registerTab(t.tab_page,0),t._tabProxy.selectHandler=new Laya.Handler(t,t.changePage),t}return __extends(t,e),t.prototype.showView=function(t,e,i){void 0===e&&(e=!0),void 0===i&&(i=!1),n.LayerManager.addInPOPWindowLayer(this,e,!0,!0,!1,i),this._tabProxy.open(t)},t.prototype.changePage=function(t){switch(t){case 0:this.relicPage||(this.relicPage=new s.RelicPageCtrl),this._page=this.relicPage,this.bg.img_title.skin="res/relic/sqtitle.png";break;case 1:this._handBook||(this._handBook=new o.GHandBookCtrl),this._page=this._handBook,this.bg.img_title.skin=this._handBook.getTitle()}this._page&&this._page.showPage(this.bg.box_page)},t.prototype.onCloseHandler=function(){this.removeSelf()},t}(ui.treasure.TreasureViewUI);e.TreasureView=a}),define("src/g/treasure/ctrl/TreasureViewCtrl",["require","exports","src/init/Switches","src/g/treasure/TreasureView"],function(t,e,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){i.Switches.ins.on(185,this,this.onOpenPage,[17])}return t.prototype.onOpenPage=function(t,e,i,n){void 0===i&&(i=!0),void 0===n&&(n=!1),e&&this.openActive(t,i,n)},t.prototype.openActive=function(t,e,i){void 0===t&&(t=0),this._view||(this._view=new n.TreasureView),this._view.showView(t,e,i)},t}();e.TreasureViewCtrl=s}),define("src/g/twoBlade/view/TwoBladeTotalTipsView",["require","exports","../../../manager/RoleCenter","../../net/messages/PropFightMain","../../../config/GameConfig","../../../plugin/sbkPropTool","../../../utils/ItemUtils","../../../meta/ShuXingVo"],function(t,e,c,u,p,d,g,l){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(n){function t(){for(var t=n.call(this)||this,e=c.RoleCenter.instans.vo,i=0;i<e.heronum;i++)t.initData(i);return t}return __extends(t,n),t.prototype.initData=function(t){for(var e=new u.PropBlade,i=c.RoleCenter.instans.self.openhero[t].bladeData.twoBladeArr,n=0;n<i.length;n++){var s=i[n];if(0<s.id){var o=p.GameConfig.bladelvjson[s.id];o&&d.sbkPropTool.reSetProp(e,o.prop,!1)}for(var a=s.equipInsArr,r=0;r<a.length;r++){var l=a[r];if(0!=l.equid){var h=g.ItemUtils.getSrEquipVoById(l.equtemplet);h&&d.sbkPropTool.reSetProp(e,h.prop,!1)}}}this.showProp(e,t)},t.prototype.showProp=function(t,e){var i=[];for(var n in t)if(t.hasOwnProperty(n)&&0<=t[n]){var s=[];s.push(n,t[n]),i.push(s)}for(var o=0;o<i.length;o++){var a=this["lab_"+e+"_"+o],r=g.ItemUtils.getShuXingByName(i[o][0]);a.text=r.desc+":"+l.ShuXingVo.getString4Vo(i[o][1],r),a.color=r.color}},t}(ui.twoBlade.TwoBladeTotalTipsViewUI);e.TwoBladeTotalTipsView=i}),define("src/g/twoBlade/view/TwoBladeModuleTips",["require","exports","../../../config/GameConfig","src/g/Effects/UIEffectsFactory","../../../utils/ItemUtils","../../../meta/ShuXingVo"],function(t,e,c,u,p,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(t,e,i){var n=c.GameConfig.bladelvjson[1e4*t+e];this.moudleNameTxt.text=n.name+"高阶预览";var s=c.GameConfig.bladesetingjson[t].res[0];u.UIEffectsFactory.Ins.createAndCenter(this.aniSp,s,!0);for(var o=0;o<5;o++){var a=this.vbox_base.getChildByName("box_"+o).getChildByName("base");if(a){var r=c.GameConfig.bladelvjson[1e4*t+o+1];if(r){var l=p.ItemUtils.getShuXingByName(r.prop[4][0]);a.text=o+1+"阶"+r.name+"  "+l.desc+":"+d.ShuXingVo.getString4Vo(r.prop[4][1],l);var h=e<o+1?"#c0b4a3":"#2ba212";0==i&&(h="#c0b4a3"),a.color=h}}}},e}(ui.twoBlade.TwoBladeModuleTipsUI);e.TwoBladeModuleTips=i}),define("src/g/twoBlade/view/TwoBladeView",["require","exports","../../../manager/RoleCenter","../../../config/GameConfig","src/g/itemGets/View/ItemGetDlg","../../../utils/ItemUtils","../../../meta/ShuXingVo","../../net/messages/blade/TwoBladeMsg","../../../manager/GameSocketManager","../../../meta/QualiyVo","src/g/Effects/UIEffectsFactory","src/g/twoBlade/view/TwoBladeTipsView","src/g/twoBlade/view/TwoBladeTotalTipsView","../../net/messages/PropFightMain","../../../plugin/sbkPropTool","../../net/messages/sbkFormula","src/g/twoBlade/view/TwoBladeModuleTips","../../../enum/enumItem","src/init/TextConst","../../../vo/RedDot/RedDot_TwoBlade"],function(t,e,p,l,i,y,m,h,c,_,C,u,n,r,d,g,s,I,o,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.curPage=1,t.curJie=1,t._needItemId=0,t.ani_put=null,t.addEvent(),t}return __extends(t,e),t.prototype.addEvent=function(){this.btn_lv_up.on(Laya.Event.CLICK,this,this.onUpClick),this.tipsBtn.on(Laya.Event.CLICK,this,this.onShowTips),this.leftImg.on(Laya.Event.CLICK,this,this.onLeftImgClick),this.rightImg.on(Laya.Event.CLICK,this,this.onRightImgClick),this.btnClick.on(Laya.Event.CLICK,this,this.onAniClick),this.costbar.setJump(o.TextConst.get(238),new Laya.Handler(this,this.ongetClieck)),this.lisr_curr_attr.renderHandler=new Laya.Handler(this,this.onListCurrAttrRender),this.lisr_next_attr.renderHandler=new Laya.Handler(this,this.onListNextAttrRender),this.onLoadUIEF()},t.prototype.onLoadUIEF=function(){this.ani_put=C.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(this.btn_lv_up,42,1.6,1.1),this.ani_put.visible=!1},t.prototype.ongetClieck=function(){if(this._needItemId){var t=y.ItemUtils.getItemVoById(this._needItemId);(new i.ItemGetDlg).initByVo(t).popup()}},t.prototype.onShowTips=function(){(new n.TwoBladeTotalTipsView).popup()},t.prototype.onUpClick=function(){var t=new h.UpBladeC2GS;t.heroidx=this.p_heroIdx,t.type=this.curPage,c.GSM.sendServer(t)},t.prototype.onLeftImgClick=function(){this.curPage--,this.showData(this.p_heroIdx)},t.prototype.onRightImgClick=function(){this.curPage++,this.showData(this.p_heroIdx)},t.prototype.showData=function(t){this.p_heroIdx=t,this.p_heroData=p.RoleCenter.instans.vo.getOpenHeroByIdx(this.p_heroIdx),this.curData=this.p_heroData.twoBladeData.twoBladeArr[this.curPage-1],this.initShow(),this.initEquip(this.curData.equipInsArr)},t.prototype.initEquip=function(t){for(var e,i,n=0,s=0;s<t.length;s++){var o=t[s],a=s+1,r=this.getChildByName("equip_"+s);if(r){r.setClieckHD(null);var l=o.equtemplet?o.equtemplet:0,h=new Laya.Handler(this,this.equipClick,[o,s+1]);r.setClieckHD(h);var c=0<l,u=y.ItemUtils.getSrEquipVoById(l);u||(c=!1);var p=c?y.ItemUtils.getIconByIconId(u.icon):"res/custom/equipIcon/shuangren_"+a+".png";r.setName(I.enumItem.arr_srEquipPosNameNs[a-1]);var d,g=c?u.quality:1;for(r.setTrait(g,_.QualityStruct.Ins.getQPicById(17)),0!=o.equtemplet?r.setJie(o.equtemplet%10):r.showJie(!1),r.showSuo(0==this.curData.id),this.tips&&this.tips.isPopup&&this.curPos==s+1&&this.tips.setEquipData(this.p_heroIdx,this.curPos,o,this.curPage);0<r.qualAni.numChildren;)(d=r.qualAni.removeChildAt(r.qualAni.numChildren-1))&&d.destroy();if(u&&5<=u.quality){var v=_.QualityStruct.Ins.getQEffById(u.quality);d=C.UIEffectsFactory.Ins.createUIAniById(v,!0),C.UIEffectsFactory.Ins.centered4Parent(d,r.qualAni,!0),d.play()}r.showIcon(p),r.img_god.visible=r.lab_soul.visible=r.lab_enhance.visible=!1,u&&(n+=u.prop[4][1],i=u.prop[4][0])}}if(0<n){var f=y.ItemUtils.getShuXingByName(i);e=m.ShuXingVo.getString4Vo(n,f)}else e=n+"%";this.cutvalueNum2.value=e},t.prototype.equipClick=function(t,e){0!=this.curData.id&&(t.equid?this.hasDress(t,e):this.noDress(t,e))},t.prototype.noDress=function(t,e){for(var i=p.RoleCenter.instans.self.bagdata.equBagData,n=[],s=0;s<i.length;s++){var o=i[s],a=y.ItemUtils.getSrEquipVoById(o.equtemplet);a&&(a.pos==100*this.curPage+e&&n.push(o))}if(0<n.length){var r=new h.PutBladeEquipC2GS;r.heroidx=this.p_heroIdx,r.type=this.curPage,r.pos=e,r.equid=n[0].equid,c.GSM.sendServer(r)}else this.tips||(this.tips=new u.TwoBladeTipsView),this.tips.setEquipData(this.p_heroIdx,e,t,this.curPage),this.tips.popup()},t.prototype.hasDress=function(t,e){this.tips||(this.tips=new u.TwoBladeTipsView),this.curPos=e,this.tips.setEquipData(this.p_heroIdx,e,t,this.curPage),this.tips.popup()},t.prototype.initShow=function(){if(0==this.curData.id?(this.lisr_curr_attr.x=242,this.curLvTxt.x=271,this.jiantouImg.visible=!1,this.lisr_next_attr.visible=!1,this.nextLvTxt.visible=!1,this.qiegeBox.gray=!0,this.btn_lv_up.label="激活",this.cutvalueNum1.value="0",this.cutvalueNum2.value="0",this.curJie=1):(this.lisr_curr_attr.x=106,this.curLvTxt.x=135,this.jiantouImg.visible=!0,this.lisr_next_attr.visible=!0,this.nextLvTxt.visible=!0,this.qiegeBox.gray=!1,this.btn_lv_up.label="提升",this.curJie=this.curData.id%1e4),1==this.curPage)this.leftImg.visible=!1,this.rightImg.visible=!0,(t=this.rightImg.getChildByName("red")).visible=v.RedDot_TwoBlade.Ins.getTwoBladeCurRed(this.p_heroIdx,2)||v.RedDot_TwoBlade.Ins.getTwoBladeCurRed(this.p_heroIdx,3)||v.RedDot_TwoBlade.Ins.getTwoBladeCurRed(this.p_heroIdx,4);else if(4==this.curPage){this.leftImg.visible=!0,this.rightImg.visible=!1,(t=this.leftImg.getChildByName("red")).visible=v.RedDot_TwoBlade.Ins.getTwoBladeCurRed(this.p_heroIdx,1)||v.RedDot_TwoBlade.Ins.getTwoBladeCurRed(this.p_heroIdx,2)||v.RedDot_TwoBlade.Ins.getTwoBladeCurRed(this.p_heroIdx,3)}else{this.leftImg.visible=this.rightImg.visible=!0;var t=this.leftImg.getChildByName("red"),e=this.rightImg.getChildByName("red");2==this.curPage?(t.visible=v.RedDot_TwoBlade.Ins.getTwoBladeCurRed(this.p_heroIdx,1),e.visible=v.RedDot_TwoBlade.Ins.getTwoBladeCurRed(this.p_heroIdx,3)||v.RedDot_TwoBlade.Ins.getTwoBladeCurRed(this.p_heroIdx,4)):(t.visible=v.RedDot_TwoBlade.Ins.getTwoBladeCurRed(this.p_heroIdx,1)||v.RedDot_TwoBlade.Ins.getTwoBladeCurRed(this.p_heroIdx,2),e.visible=v.RedDot_TwoBlade.Ins.getTwoBladeCurRed(this.p_heroIdx,4))}var i=l.GameConfig.bladelvjson[1e4*this.curPage+this.curJie],n=l.GameConfig.bladelvjson[1e4*this.curPage+this.curJie+1];if(this.nameImg.skin="res/twoBlade/shuangren_daomz_00"+this.curPage+".png",this.curLvTxt.text=this.getCurTxt(this.curJie),n){var s=n.upcost[0][0],o=n.upcost[0][1],a=p.RoleCenter.instans.vo.bagdata.getItemCount(s),r=y.ItemUtils.getItemVoById(s);this.costbar.setNeedName(r.name,y.ItemUtils.getSmallIcon(r.icon)),this.costbar.setQualColor(y.ItemUtils.getColorByQuality(r.quality)),this.costbar.setNeed(a,o),this.ani_put.visible=o<=a,this._needItemId=s,this.costbar.visible=!0}this.lisr_curr_attr.array=i.prop,this.cutvalueNum1.value=0==this.curData.id?"0%":i.prop[4][1]/100+"%",5<=this.curJie?(this.maxLvTxt.visible=!0,this.lisr_next_attr.visible=!1,this.nextLvTxt.visible=!1,this.costbar.visible=!1,this.jiantouImg.visible=!1,this.lisr_curr_attr.x=242,this.curLvTxt.x=271,this.btn_lv_up.visible=!1):(0!=this.curData.id&&(this.lisr_next_attr.visible=!0,this.lisr_next_attr.array=n.prop,this.nextLvTxt.text=this.getCurTxt(this.curJie+1),this.nextLvTxt.visible=!0),this.maxLvTxt.visible=!1,this.btn_lv_up.visible=!0),this.updatePower(),this.showEffect(),this.checkEquipRed()},t.prototype.checkEquipRed=function(){for(var t=this.curData.equipInsArr,e=0;e<t.length;e++){var i=t[e],n=this.getChildByName("equip_"+e);if(n)if(n.showTip(!1),0==i.equid){if(0!=this.curData.id)for(var s=p.RoleCenter.instans.self.bagdata.equBagData,o=0;o<s.length;o++){var a,r=s[o];(a=y.ItemUtils.getSrEquipVoById(r.equtemplet))&&(a.pos==100*this.curPage+e+1&&n.showTip(!0))}}else if(a=y.ItemUtils.getSrEquipVoById(i.equtemplet+1))for(var l=a.uplv[0][1],h=a.uplv[0][0],c=0,u=(s=p.RoleCenter.instans.self.bagdata.equBagData,0);u<s.length;u++){(r=s[u]).equtemplet==h&&c++,l<=c&&n.showTip(!0)}}},t.prototype.showEffect=function(){var t=l.GameConfig.bladesetingjson[this.curPage].res[0];C.UIEffectsFactory.Ins.createAndCenter(this.aniSp,t,!0)},t.prototype.onAniClick=function(){var t=new s.TwoBladeModuleTips;t.setData(this.curPage,this.curJie,this.curData.id),t.popup()},t.prototype.showView=function(){this.curPage=1},t.prototype.updatePower=function(){var t=0,e=new r.PropFightMain;if(0<this.curData.id){var i=l.GameConfig.bladelvjson[this.curData.id];d.sbkPropTool.reSetProp(e,i.prop,!1),t+=i.power}for(var n=this.curData.equipInsArr,s=0;s<n.length;s++){var o=n[s];if(0<o.equid){var a=y.ItemUtils.getSrEquipVoById(o.equtemplet);a&&(d.sbkPropTool.reSetProp(e,a.prop,!1),t+=a.power)}}t+=g.sbkFormula.calPropFightMainCombat(e),this.box_fight.setFightNum(t)},t.prototype.onListCurrAttrRender=function(t,e){var i=this.lisr_curr_attr.array[e],n=i[0],s=i[1],o=l.GameConfig.ShuXing_Json[n];o?t.lab_name.changeText(o.desc+":"):t.lab_name.changeText("???:"),t.lab_value.changeText(s.toString())},t.prototype.onListNextAttrRender=function(t,e){t.lab_name.color=t.lab_value.color="#09d51f";var i=this.lisr_next_attr.array[e],n=i[0],s=i[1],o=l.GameConfig.ShuXing_Json[n];o?t.lab_name.changeText(o.desc+":"):t.lab_name.changeText("???:"),t.lab_value.changeText(s.toString())},t.prototype.getCurTxt=function(t){var e;switch(t){case 1:e="一阶";break;case 2:e="二阶";break;case 3:e="三阶";break;case 4:e="四阶";break;case 5:e="五阶"}return e},t}(ui.twoBlade.TwoBladeViewUI);e.TwoBladeView=a}),define("src/g/twoBlade/ctrl/TwoBladeCtrl",["require","exports","src/g/base/BaseCtrl","src/g/clearRes/ClearResM","src/g/twoBlade/view/TwoBladeView","../../net/messages/blade/TwoBladeMsg","../../../manager/RoleCenter","../../../core/E","../../../vo/RedDot/EventRedDot","../../../plugin/sbkPropTool","../../../enum/EventName","src/g/accessctrl/AccessCenter","../../net/messages/blade/TwoBladeData","../../../manager/GameSocketManager","src/init/ResManager","../../../vo/RedDot/RedDot_TwoBlade"],function(t,e,i,n,s,o,a,r,l,h,c,u,p,d,g,v){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var f=function(e){function t(){var t=e.call(this)||this;return t._nowSelectHero=0,t.checkOpen(),d.GSM.ins.on(o.BladeUpdateGS2C.KEY,t,t.updateBlade),t}return __extends(t,e),t.prototype.checkOpen=function(){if(u.AccessCenter.ins.checkOpen(302))for(var t=a.RoleCenter.instans.vo.heronum,e=0;e<t;e++){if(0==a.RoleCenter.instans.self.openhero[e].bladeData.twoBladeArr[0].id){var i=new o.UpBladeC2GS;i.heroidx=e,i.type=p.BladeType.tld,d.GSM.sendServer(i)}}},t.prototype.updateBlade=function(t){a.RoleCenter.instans.self.openhero[t.heroidx].bladeData.twoBladeArr[t.type-1]=t.data,this._view&&this.refreshData(),v.RedDot_TwoBlade.Ins.checkTwoBlade(),r.E.ins.event(l.EventRedDot.REFRESH_TWOBLADE),this.onBladeDataChanged(t.heroidx)},t.prototype.onBladeDataChanged=function(t){var e=a.RoleCenter.instans.vo.combat,i=a.RoleCenter.instans.vo.getOpenHeroByIdx(t);h.sbkPropTool.resetTwoBlade(i),a.RoleCenter.instans.event(c.EventName.FIGHT_UP,a.RoleCenter.instans.vo.reCheckComBat()-e)},t.prototype.init=function(){this._view=new s.TwoBladeView},t.prototype.showPage=function(t,e){this._view||this.init(),t.removeChildren(),t.addChild(this._view),this.addEvent(),this._view.showView(),n.ClearResM.resetViewImg(this._view),g.ResManager.getInstance().showRolePageCtrl(this),this.changePerson(0)},t.prototype.changePerson=function(t,e){this._nowSelectHero=t,this._view&&this.refreshData()},t.prototype.addEvent=function(){this._view.on(Laya.Event.REMOVED,this,this.onRemoved)},t.prototype.onRemoved=function(){this._view.off(Laya.Event.REMOVED,this,this.onRemoved)},t.prototype.refreshData=function(){this._view&&this._view.showData(this._nowSelectHero)},t.prototype.getTitle=function(){return"res/title/shuangren_biaoti.png"},t.prototype.hidePage=function(){g.ResManager.getInstance().hidePageCtrl(this)},t.prototype.destroyPage=function(){g.ResManager.getInstance().destroyPageCtrl(this)},t}(i.BaseCtrl);e.TwoBladeCtrl=f}),function(t){var e=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.arr_traitColor=["#646464","#207f06","#1d97cc","#7637be","#d29400","#d24000"],t}return __extends(t,e),t.prototype.setTrait=function(t,e,i){void 0===i&&(i=!1),this.lab_lv.color=i?this.arr_traitColor[0]:this.arr_traitColor[t-1],this.item_.img_quality.skin="res/custom/"+e+".png"},t.prototype.setName=function(t){void 0===t&&(t=null),this.lab_lv.text=t||""},t.prototype.showIcon=function(t){this.item_.img_item.skin=t},t.prototype.setNum=function(t){this.item_.lab_num.text=0<t?t+"":""},t}(ui.vip.ShowItemUI);t.VipItem=e}(ShowItem||(ShowItem={})),define("src/g/xingwang/view/XwBg",["require","exports"],function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e}(ui.xingwang.XwBgUI);e.XwBg=i}),define("src/g/xingwang/view/XwJieSuoDlg",["require","exports","../../../manager/GameSocketManager","../../../config/GameConfig","../../../manager/RoleCenter","../../../utils/ItemUtils","src/g/itemGets/View/ItemGetDlg","../../net/messages/rexue/sbkXWData","src/init/TextConst","../../../utils/ItemCellUtils"],function(t,e,i,y,m,_,C,I,b,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(f){function t(t,e,i){var n,s=f.call(this)||this;s.req=n=new I.sbkXWJiHuoMsg,n.heroIdx=t,n.rxPos=e,n.equpos=i;var o=y.GameConfig.xwZ7z8.posOpenCostNum.value,a=s.item_cost;a.setJump(b.TextConst.get(238),new Laya.Handler(s,function(){C.ItemGetDlg.create(o)}));var r=_.ItemUtils.getItemVoById(o);a.setNeedName(r.name,_.ItemUtils.getSmallIcon(r.icon)),a.setQualColor(_.ItemUtils.getColorByQuality(r.quality));for(var l,h,c=m.RoleCenter.instans.vo.bagdata.getItemCount(o),u=y.GameConfig.xwequipsuit[e],p=u.cost,d=u.set,g=0;g<p.length&&(l=p[g],h=d[g],+l[0]!=i);g++)l=h=null;var v=l[1];return a.setNeed(c,v),w.ItemCellUtils.fillXwItem(s.item,-1,h[1]),s.btn_js.disabled=c<v,s.btn_js.on(Laya.Event.CLICK,s,s.on_js),s.bgview.btn_close.on(Laya.Event.CLICK,s,s.close),s}return __extends(t,f),t.prototype.close=function(t,e){f.prototype.close.call(this,t,e)},t.prototype.on_js=function(){i.GSM.sendServer(this.req),this.close()},t}(ui.xingwang.XwJieSuoDlgUI);e.XwJieSuoDlg=n}),define("src/g/xingwang/view/XwStrong",["require","exports","../../net/messages/rexue/sbkXWData","../../../utils/XwUtils","../../../manager/GameSocketManager","../../../config/GameConfig","../../../vo/sbkBagVo","../../../utils/ItemUtils","../../../utils/RoleUtil","../../../enum/XwEnum","src/init/TextConst","../../../utils/system/FloatEffect","../../../utils/ItemCellUtils"],function(t,e,a,r,l,y,i,m,_,n,C,h,I){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(o){function t(t,e){var i=o.call(this)||this,n=r.XwUtils.getData(t,e);i.xwData=n;var s=new a.sbkXWStrongMsg;return s.rxPos=e,s.heroIdx=t,i.req=s,i.btn_qh.on(Laya.Event.CLICK,i,i.onClick),i.btn_sAll.on(Laya.Event.CLICK,i,i.onClick),i.bgview.btn_close.on(Laya.Event.CLICK,i,i.close),i.list.renderHandler=new Laya.Handler(i,i.renderHandler),l.GSM.ins.on(a.sbkXWStrongMsg.KEY,i,i.msgHandler),i.$render(),i.updateZb(),i}return __extends(t,o),t.prototype.updateZb=function(){var t=r.XwUtils.getLimitEq(i.sbkBagVo.getXwEq(),n.XwEnum.minLevel);t.sort(function(t,e){var i=m.ItemUtils.getXwEquipVoById(t.equtemplet),n=m.ItemUtils.getXwEquipVoById(e.equtemplet);return i.level-n.level}),4<t.length&&(t.length=4),this.eqArr=t,this.list.array=t},t.prototype.renderHandler=function(t,e){var i=this.eqArr[e];I.ItemCellUtils.fillXwItem(t,i.equtemplet)},t.prototype.$render=function(){var t=this.xwData,e=this.preview,i=t.strongLv,n=this.req.rxPos;I.ItemCellUtils.fillXwItem(e,-1),e.img_lock.visible=!1,e.lab_name.text=C.TextConst.get(100,i),e.item.item.item.img_item.skin="res/xingwang/"+n+".png";var s=t.strongExp||0,o=y.GameConfig.xwequipenhance[n+"_"+i],a=y.GameConfig.xwequipenhance[n+"_"+(i+1)];this.box_fight.setFightNum(_.RoleUtil.calFightByProp(o.prop));for(var r=this.curr_attr,l=this.next_attr,h=0;h<4;h++){var c=r.getChildByName("lab_"+h),u=l.getChildByName("lab_"+h),p=o.prop[h],d=!1;if(p&&(d=!0,c.text=m.ItemUtils.getShuXingByName(p[0]).desc+":"+p[1]),c.visible=d,d=!1,a){var g=a.prop[h];g&&(d=!0,u.text=m.ItemUtils.getShuXingByName(g[0]).desc+":"+g[1])}else p&&(d=!0,u.text=C.TextConst.get(208));u.visible=d}var v=0<o.cost.length?o.cost[0][1]:0;this.lab_exp.changeText(s+"/"+v),0==v&&(v=1);var f=this.bar_img.width*s/v;f=0==f?1:f,Laya.Tween.clearAll(this.bar_panel),Laya.Tween.to(this.bar_panel,{width:f},80)},t.prototype.msgHandler=function(t){this.$render(),this.updateZb()},t.prototype.onClick=function(t){switch(t.currentTarget){case this.btn_qh:var e=this.req,i=this.eqArr;if(0==i.length)break;var n=this.xwData,s=n.strongLv,o=this.req.rxPos;if(!y.GameConfig.xwequipenhance[o+"_"+(s+1)]){h.FE.upItems(C.TextConst.get(208));break}e.strongLv=n.strongLv,e.strongExp=n.strongExp;for(var a=[],r=0;r<i.length;r++)a.push(i[r].equid);e.equipIdArr=a,l.GSM.sendServer(this.req);break;case this.btn_sAll:}},t.prototype.close=function(t,e){o.prototype.close.call(this,t,e),l.GSM.ins.off(a.sbkXWStrongMsg.KEY,this,this.msgHandler)},t}(ui.xingwang.XwStrongUI);e.XwStrong=s}),define("src/g/xingwang/view/XwTips_EqTz",["require","exports","../../../config/GameConfig","../../../utils/XwUtils","../../../utils/ItemUtils","src/g/Effects/UIEffectsFactory","src/g/xingwang/view/XwStrong","../../../enum/XwEnum","../../../utils/RoleUtil"],function(t,e,g,v,f,y,i,m,_){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(d){function t(t,e){var i=d.call(this)||this;i.job=t,i.rxPos=e,y.UIEffectsFactory.Ins.createSAniAndCenter(i.eq_pos,m.XwEnum.effectStart+e,.8,.8);var n=g.GameConfig.xwZ7z8.xwSuit.value.split(","),s=v.XwUtils.getData(t,e),o=v.XwUtils.getMinTzLvByXwData(s),a=g.GameConfig.xwequipsuit[e],r=a.set;v.XwUtils.setSuitInfo(i.suit_shouhu,s,r),v.XwUtils.setSuitProp(i.box_tz,a.prop[0!=o?o-1:0],o),i.lab_tztitle.text=n[0!=o?o-1:0];for(var l=g.GameConfig.xwequipenhance[e+"_"+s.strongLv].prop,h=0;h<4;h++){var c=i.box_xj.getChildByName("sname_"+h),u=l[h];u?c.text=f.ItemUtils.getShuXingByName(u[0]).desc+":"+u[1]:c.removeSelf()}i.btn_replace.disabled=0==o;var p=g.GameConfig.xwequipenhance[e+"_"+s.strongLv];return i.box_fight.setFightNum(_.RoleUtil.calFightByProp(p.prop)),i.lab_name.text=g.GameConfig.xwequipsuit[e].name,i.btn_replace.on(Laya.Event.CLICK,i,i.onClick),i}return __extends(t,d),t.prototype.onClick=function(t){switch(t.currentTarget){case this.btn_replace:new i.XwStrong(this.job,this.rxPos).popup(),this.close()}},t}(ui.xingwang.XwTips_EqTzUI);e.XwTips_EqTz=n}),define("src/g/xingwang/view/Xw",["require","exports","../../../utils/XwUtils","../../../config/GameConfig","src/g/xingwang/view/XwJieSuoDlg","../../../manager/RoleCenter","../../../utils/system/FloatEffect","../../../plugin/view/ToolTip","src/g/xingwang/view/XwBag","src/g/xingwang/view/XwTips_Eq","src/g/xingwang/view/XwTips_EqTz","src/g/Effects/UIEffectsFactory","../../../enum/XwEnum","../../../vo/RedDot/RedDot_Xw","src/init/TextConst","../../../utils/ItemCellUtils"],function(t,e,a,_,u,i,r,l,p,d,h,C,I,b,c,w){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(n){function m(){var t=n.call(this)||this;t.boxPoints=[];for(var e=0;e<m.itemCount;e++){t["item"+e].on(Laya.Event.CLICK,t,t.onItemClick)}for(e=0;e<m.boxCount;e++){var i=t["box"+e];i.getChildByName("lab_name").text=_.GameConfig.xwequipsuit[t.getPos(e)].name,i.on(Laya.Event.CLICK,t,t.onClick),t.boxPoints.push([i.x,i.y])}return t.xwjx.on(Laya.Event.CLICK,t,t.onClick),t.eq_pos.on(Laya.Event.CLICK,t,t.onClick),t}return __extends(m,n),m.prototype.moveBox=function(t,e,i){for(var n=this.boxPoints,s=e;s<i;s++){var o=this["box"+s],a=n[t];Laya.Tween.to(o,{x:a[0],y:a[1]},200,null,Laya.Handler.create(this,this.effctComp,[s])),t++}},m.prototype.effctComp=function(t){if(this.currBoxIdx==t){for(var e=this.job,i=this.getPos(),n=_.GameConfig.xwequipsuit[i].set,s=_.GameConfig.xwZ7z8.xwposneed.value.split(","),o=b.RedDot_Xw.zbRed?b.RedDot_Xw.zbRed[e+"_"+i]:{},a=b.RedDot_Xw.qhRed?b.RedDot_Xw.qhRed[e+"_"+i]:{},r=m.itemCount,l=0;l<r;l++){var h=this["item"+l],c=+n[l][0],u=this.getZbId(c);w.ItemCellUtils.fillXwItem(h,u,c);var p=h.getChildByName("lab_limit");if(!p){(p=new Laya.HTMLDivElement).name="lab_limit",p.style.align="center",p.style.fontSize=18,p.style.font="SimHei";var d=h.lab_name;p.x=d.x,p.y=d.y,p.width=d.width}p.innerHTML=s[n[l][1]-1],h.addChild(p),o&&(h.item.img_red.visible=1==o[l+1])}var g=this.getXwData().getCombat();this.box_fight.setFightNum(g),this.rxScore.value=g+"";var v=C.UIEffectsFactory.Ins,f=this.eq_pos,y=I.XwEnum.effectStart;for(l=0;l<f.numChildren;l++){f.getChildAt(l).visible=!1}v.createCenterSAniAndMonopolize(f,y+i,1,1,"ani"+i).visible=!0,this.ani=v.createCenterSAniAndMonopolize(f,24),this.ani.visible=!!a,f.setChildIndex(this.ani,f.numChildren-1)}},m.prototype.getZbId=function(t){var e=-1,i=this.getXwData();if(!i)return e;var n=i.openPosArr.indexOf(t);if(-1!=n){var s=i.equipArr[n].equins;e=0<s.length?s[0].equtemplet:0}return e<0&&0==a.XwUtils.getCostIdxByType(this.getPos(),t)&&(e=0),e},m.prototype.getPosIdx=function(t){return void 0===t&&(t=this.currBoxIdx),this.rxdata.openPosArr.indexOf(this.getPos(t))},m.prototype.getXwData=function(t){void 0===t&&(t=this.getPosIdx());var e,i=this.rxdata.equipArr[t];return i&&(e=i.xwData),e},m.prototype.startEffect=function(){for(var t=this.currBoxIdx,e=0,i=m.boxCount,n=0;n<i;n++)Laya.Tween.clearTween(this["box"+n]);this.moveBox(e,t,i),(e=i-t)<i&&(this.moveBox(e,0,t),e+=t)},m.prototype.updateTzLv=function(){for(var t=0;t<m.boxCount;t++){var e=this["box"+t],i=this.getXwData(this.getPosIdx(t)),n=i?i.strongLv:0,s=e.getChildByName("img_icon"),o=e.getChildByName("lab_count");s.disabled=0==a.XwUtils.getMinTzLvByXwData(i),o.text=n+""}},m.prototype.onItemClick=function(t){for(var e=t.currentTarget,i=0,n=0;n<m.itemCount;n++)if(this["item"+n]==e){i=n;break}var s=this.getPos(),o=+_.GameConfig.xwequipsuit[s].set[i][0],a=this.job,r=this.getZbId(o),l=this.getXwData();if(-1==r)new u.XwJieSuoDlg(a,s,o).popup();else if(0<r){var h=l.openPosArr.indexOf(o),c=new d.XwTips_Eq;c.initData(!1,l.equipArr[h]),c.popup()}else new p.XwBag(a,s,o).popup()},m.prototype.onClick=function(t){for(var e=t.currentTarget,i=-1,n=0;n<m.boxCount;n++)if(this["box"+n]==e){i=n;break}switch(e){case this.eq_pos:var s=this.getPos(),o=this.job;new h.XwTips_EqTz(o,s).popup();break;case this.xwjx:break;default:if(-1!=i&&i!=this.currBoxIdx){if(this.rxdata)if(-1==this.getPosIdx(i)){r.FE.upItems(c.TextConst.get(783),l.BubbleEnum.center);break}this.currBoxIdx=i,this.startEffect()}}},m.prototype.getPos=function(t){return void 0===t&&(t=this.currBoxIdx),a.XwUtils.getPos(t)},m.prototype.getIdx=function(t){return a.XwUtils.getIdx(t)},m.prototype.refreshData=function(t){this.job=t,this.rxdata=i.RoleCenter.instans.vo.getOpenHeroByIdx(t).rxData,this.currBoxIdx=this.getIdx(_.GameConfig.xwZ7z8.firstpos.value),this.updatePartRed(),this.startEffect(),this.updateTzLv()},m.prototype.updatePartRed=function(){var t=this.job,e=b.RedDot_Xw.qhRed;if(e)for(var i=0;i<m.boxCount;i++){var n=this["box"+i],s=this.getPos(i),o=n.getChildByName("lab_name"),a=n.getChildByName("img_red"),r=e[t+"_"+s];a.visible=null!=b.RedDot_Xw.zbRed[t+"_"+s]||r,o.text=_.GameConfig.xwequipsuit[s].name}},m.boxCount=8,m.itemCount=6,m}(ui.xingwang.XwUI);e.Xw=n}),define("src/g/xingwang/ctrl/XwCtrl",["require","exports","src/g/clearRes/ClearResM","src/g/xingwang/view/Xw","../../../manager/GameSocketManager","../../net/messages/rexue/sbkXWData","../../../manager/RoleCenter","../../../config/GameConfig","../../../utils/XwUtils","../../../plugin/sbkPropTool","../../../enum/EventName","../../../core/E","../../../vo/RedDot/RedDot_Xw"],function(t,e,n,i,s,p,d,o,g,v,f,a,y){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this._nowJob=0}return t.prototype.init=function(){this.view=new i.Xw,this.openId=o.GameConfig.xwZ7z8.posOpenCostNum.value;var t=s.GSM.ins;return t.on(p.sbkXWJiHuoMsg.KEY,this,this.receiveMsg),t.on(p.sbkXWEquipPosition.KEY,this,this.receiveMsg),t.on(p.sbkXWStrongMsg.KEY,this,this.receiveMsg),a.E.ins.on(f.EventName.CHANGEITEM_COUNT,this,this.onChangeItem),this},t.prototype.onChangeItem=function(t){t==this.openId&&y.RedDot_Xw.check()},t.prototype.receiveMsg=function(t){var e,i=this.view,n=d.RoleCenter.instans,s=t.rxPos,o=t.equpos,a=t.heroIdx,r=g.XwUtils.getData(a,s),l=!1,h=t.equins;switch(t.msgKey){case p.sbkXWJiHuoMsg.KEY:n.vo.chgItemCount(this.openId,-g.XwUtils.getCostIdxByType(s,o)),r.addNewPosition(a,s,o);break;case p.sbkXWEquipPosition.KEY:var c=r.openPosArr.indexOf(o);e=r.equipArr[c].equins[0],r.equipArr[c].equins[0]=h[0],l=!0;break;case p.sbkXWStrongMsg.KEY:var u=t.strongLv;l=r.strongLv!=u,r.strongLv=u,r.strongExp=t.strongExp}if(y.RedDot_Xw.check(),l&&(v.sbkPropTool.reSetAllReXue(n.vo.getOpenHeroByIdx(this._nowJob)),n.vo.reCheckComBat(),h&&h instanceof Array)){h[0].combat;e&&e.combat,n.event(f.EventName.FIGHT_UP,h[0].combat)}i.displayedInStage&&(i.updatePartRed(),i.effctComp(g.XwUtils.getIdx(s)),i.updateTzLv())},t.prototype.showPage=function(t,e){var i=this.view;t.removeChildren(),t.addChild(i),n.ClearResM.resetViewImg(i),this._nowJob=e,this.refreshData()},t.prototype.changePerson=function(t,e){this._nowJob=t,this.refreshData()},t.prototype.refreshData=function(){this.view.refreshData(this._nowJob)},t.prototype.getTitle=function(){return"res/xingwang/xingwang_biaoti.png"},t.prototype.hidePage=function(){},t.prototype.destroyPage=function(){},t}();e.XwCtrl=r}),define("src/g/xingwang/ctrl/XwBgCtrl",["require","exports","src/init/Switches","src/g/proxy/MultiLevelUIProxy","../../../manager/LayerManager","src/g/clearRes/ClearResM","src/g/base/BaseCtrl","src/g/xingwang/view/XwBg","src/g/xingwang/ctrl/XwCtrl","../../../manager/RoleCenter","../../../enum/EventName","../../../core/E","../../../manager/GameSocketManager","../../net/messages/rexue/sbkXWData","src/g/Effects/UIEffectsFactory"],function(t,e,n,s,o,a,i,r,l,h,c,u,p,d,g){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var v=function(i){function t(){var t=i.call(this)||this;t._nowJob=0,t.urls=["res/atlas/res/xingwang.json"],n.Switches.ins.on(217,t,t.onOpenHandler,[217]),u.E.ins.on(c.EventName.CLOSEALLWINDOWS,t,t.closeSelf),u.E.ins.on(c.EventName.OPENNEW_HERO,t,t.refreshHeadShow);var e=p.GSM.ins;return e.on(d.sbkXWJiHuoMsg.KEY,t,t.receiveMsg),e.on(d.sbkXWEquipPosition.KEY,t,t.receiveMsg),e.on(d.sbkXWStrongMsg.KEY,t,t.receiveMsg),t}return __extends(t,i),t.prototype.receiveMsg=function(){Laya.timer.clear(this,this.refreshHeadShow),Laya.timer.callLater(this,this.refreshHeadShow)},t.prototype.onOpenHandler=function(t,e,i){void 0===i&&(i=!0),e&&(this.id=t,this.closeOther=i,this.opens())},t.prototype.refreshHeadShow=function(){var t=h.RoleCenter.instans,e=this.view;e&&e.tab_head.initData(t.self.openhero,this._nowJob,t.vo)},t.prototype.onAtlasLoaded=function(){var t=this.view,e=this._tabProxy;t||(this.view=t=new r.XwBg,t.tab_head.id=ktgame.PersonBoxId.xw,t.tab_head.setCallbackHandler(new Laya.Handler(this,this.HeroSelect)),this._tabProxy=e=new s.MultiLevelUIProxy,e.registerTab(t.tab_page,0),e.registerTagIndex(217,0),e.selectHandler=new Laya.Handler(this,this.tab_selectHandler),t.bg_view.btn_close.on(Laya.Event.CLICK,this,this.closeSelf),t.bg_view.btn_back.on(Laya.Event.CLICK,this,this.closeSelf),this.refreshHeadShow()),e.open(this.id),t.displayedInStage||(o.LayerManager.addInPOPWindowLayer(t,this.closeOther),a.ClearResM.resetViewImg(t))},t.prototype.HeroSelect=function(t,e){h.RoleCenter.instans.self.openhero[t]?(this._nowJob=t,this.view.tab_head.setSelectIndex(t),this._page.changePerson(t,h.RoleCenter.instans.vo.getOpenHeroByIdx(t))):n.Switches.ins.event(15)},t.prototype.closeSelf=function(){var t=this.view;t&&(t.bg_view.box_page.removeChildren(),t.removeSelf()),this.clearCtrlRes();for(var e=211;e<=218;e++)a.ClearResM.clearUrl(g.UIEffectsFactory.Ins.getSourceUrlById(e))},t.prototype.tab_selectHandler=function(t){void 0===t&&(t=0);var e=this._page;switch(e&&e.hidePage(),t){case 0:this.xw||(this.xw=(new l.XwCtrl).init()),e=this.xw}e&&(e.showPage(this.view.bg_view.box_page,this._nowJob),this.receiveMsg(),this.view.bg_view.img_title.skin=e.getTitle()),this._page=e},t}(i.BaseCtrl);e.XwBgCtrl=v}),define("src/g/zhanyu/view/ZhanYUItem",["require","exports","src/g/fight/osprite/play/kfzy/KFZYManager","../../../manager/RoleCenter"],function(t,e,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t.layerCutchurtArr=[],t._isopen=!0;var e=n.KFZYManager.ins().getSetting("layerCutchurt").value;return t.layerCutchurtArr=e.split(","),t}return __extends(t,i),Object.defineProperty(t.prototype,"isopen",{get:function(){return this._isopen},enumerable:!0,configurable:!0}),t.prototype.setData=function(t,e,i,n){this.boss=t;s.RoleCenter.instans.vo;this.showtip.visible=!0,t.limit2.length&&(this.zhan.text=e+"/"+t.limit2[0][1],this.fa.text=i+"/"+t.limit2[1][1],this.dao.text=n+"/"+t.limit2[2][1],this._isopen=e>=t.limit2[0][1]&&i>=t.limit2[1][1]&&n>=t.limit2[2][1],this._isopen?this.tip.text="可进入地图":this.tip.text="未解锁地图"),this.bosslayer.skin="res/zhanyu/"+t.layer+".png",this.layerCutchurtArr[t.layer-1]&&(this.layerCutchurt.text="切割伤害抗性："+this.layerCutchurtArr[t.layer-1])},t}(ui.zhanyu.ZhanyuBossItemUI);e.ZhanYUItem=i}),define("src/g/zhanyu/view/ZhanYuView",["require","exports","../../../config/GameConfig","src/g/fight/osprite/play/kfzy/KFZYManager","src/g/zhanyu/view/ZhanYUItem","../../../manager/RoleCenter","src/g/peronboss/view/ItemIconView","../../../utils/ItemUtils","../../../utils/system/FloatEffect","../../net/messages/kuafu/kfzyMsg"],function(t,e,r,l,h,c,s,o,i,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(a){function t(){var t=a.call(this)||this;t.dic={},t.itemid=8527,t._layerlist=[],t._selectindex=1,t.bosscount={};var e=r.GameConfig.kfzyjson;for(var i in e){var n=e[i];t._layerlist[n.layer]=n}t._selectItem.list.hScrollBarSkin="",t._selectItem.list.scrollBar.elasticDistance=100,t._selectItem.list.renderHandler=new Laya.Handler(t,t.renderHandler);for(var s=1;s<=5;s++){var o=t["_item"+s]=new h.ZhanYUItem;t.panelList.addChild(t["_item"+s]),o.y=o.height*(s-1),o.setData(t._layerlist[s],0,0,0),o.con.on(Laya.Event.CLICK,t,t.clickHandler,[s])}return t._selectItem.btn_enter.on(Laya.Event.CLICK,t,t.enterHandler),t}return __extends(t,a),t.prototype.renderHandler=function(t,e){var i=this._selectItem.list.array;if(i[e]){var n=o.ItemUtils.getItemOrEq(i[e]);t&&s.ItemIconView.setItemData(n,t,1)}},t.prototype.clickHandler=function(t){this.selectIndex(t)},t.prototype.showView=function(){this.bosscount[1]=0,this.bosscount[2]=0,this.bosscount[3]=0,this.bosscount[4]=0,this.bosscount[5]=0,this.selectIndex(1);var t=c.RoleCenter.instans.vo.bagdata.getItemCount(this.itemid);this.itemcount.text=t+" (可在战绩商店获取)",this.refresh(),this._selectItem.costzhanyu.text=t+"/2"},t.prototype.selectIndex=function(t){void 0===t&&(t=1);var e=0,i=c.RoleCenter.instans.vo;this._selectindex=t;for(var n=i.getAllShengZhanPF(),s=i.getAllShengMoPF(),o=i.getAllShengDaoPF(),a=1;a<=5;a++){var r=this["_item"+a];r.setData(this._layerlist[a],n,s,o),t==a?(r.height=200+this._selectItem.height,r.con.addChild(this.selectimg),r.addChild(this._selectItem),this._selectItem.btn_enter.disabled=!r.isopen):r.height=200,r.y=e,e+=r.height}var l=this._layerlist[t].showReward;this._selectItem.list.array=l;for(a=0;a<l.length;a++);},t.prototype.enterHandler=function(){if(c.RoleCenter.instans.vo.bagdata.getItemCount(this.itemid)>=l.KFZYManager.ins().getSetting("enterItem").value){l.KFZYManager.ins().layer=this._selectindex;var t=this._layerlist[this._selectindex];l.KFZYManager.ins().enterHotBloodWar(t.port)}else i.FE.upItems("道具不足！")},t.prototype.refresh=function(){var t=l.KFZYManager.ins(),e=t.getBossInfoDic();for(var i in this.bosscount[1]=0,this.bosscount[2]=0,this.bosscount[3]=0,this.bosscount[4]=0,this.bosscount[5]=0,e){var n=e[i],s=t.getBossVoByPortId(n.portid);n.bossState==u.KFZYEBattleBossState.CAN_CHALLENGE&&this.bosscount[s.layer]++}for(var o=1;o<=5;o++){this["_item"+o].bosscount.text=this.bosscount[o]}},t}(ui.zhanyu.ZhanYuBossViewUI);e.ZhanYuView=n}),define("src/g/zhanyu/ctrl/ZhanyuCtrl",["require","exports","src/g/base/BaseCtrl","src/g/zhanyu/view/ZhanYuView","src/g/accessctrl/AccessCenter","src/g/fight/osprite/play/kfzy/KFZYManager","../../../core/E","../../../enum/EventName","../../../manager/NewRedHintsCenter","../../../manager/RoleCenter"],function(t,e,i,n,s,o,a,r,l,h){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var c=function(e){function t(){var t=e.call(this)||this;return t.url="res/atlas/res/zhanyu.json",a.E.ins.on(r.EventName.HOTBLOOD_DATA_UPDATE,t,t.refresh),a.E.ins.once(r.EventName.INIT_SELFSETOVER,t,t.readyHandler),t}return __extends(t,e),t.prototype.init=function(){},t.prototype.readyHandler=function(){this.manager().reqOpenBossInfoPanel(0)},t.prototype.manager=function(){return o.KFZYManager.ins()},t.prototype.onAtlasLoaded=function(){this._view||(this._view=new n.ZhanYuView),this._parent&&(this._view.showView(),this._parent.removeChildren(),this._parent.addChild(this._view))},t.prototype.refresh=function(){this._view&&this._view.refresh();var t=o.KFZYManager.ins().getFirstChallgeBoss();l.NewRedHintsCenter.ins.setRedHintOpenOrClose(l.enumRedHints.kfzy,!1);var e=s.AccessCenter.ins.checkOpen(303);t&&e&&(h.RoleCenter.instans.vo.bagdata.getItemCount(8527)>=o.KFZYManager.ins().getSetting("enterItem").value&&l.NewRedHintsCenter.ins.setRedHintOpenOrClose(l.enumRedHints.kfzy,!0))},t.prototype.showPage=function(t,e){t&&(this.manager().reqOpenBossInfoPanel(0),this._parent=t,this.open())},t.prototype.loadUrls=function(){},t.prototype.changePerson=function(t,e){},t.prototype.refreshData=function(){},t.prototype.getTitle=function(){return"res/title/kfzy.png"},t.prototype.hidePage=function(){this._view&&this._view.removeSelf()},t.prototype.destroyPage=function(){this.hidePage()},t}(i.BaseCtrl);e.ZhanyuCtrl=c}),define("src/g/zzsq/ZzsqRedListener",["require","exports","src/g/redhints/RedListenner","../../core/E","../../enum/EventName","src/g/accessctrl/AccessCenter","../../meta/ShenQiVo","../../manager/RoleCenter","../../config/GameConfig"],function(t,e,s,o,a,A,R,L,x){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(n){function t(t){var e=n.call(this,t)||this;e.allRed=[];for(var i=1;i<=3;i++)e.addChild(new s.RedListenner(i));return A.AccessCenter.ins.register(267,e,e.checkRed),o.E.ins.on(a.EventName.UPDATE_ZZSQRED,e,e.checkRed),e}return __extends(t,n),t.prototype.checkRed=function(){if(A.AccessCenter.ins.checkOpen(267)){var t=L.RoleCenter.instans.vo,e=t.zzshenqiData,i=t.bagdata,n=R.ShenQiVo.voByType,s=x.GameConfig.ShenQiLevelJson,o=x.GameConfig.ShenQiStarLevelJson,a=this.allRed;for(var r in n){for(var l=this[r],h=n[r],c=[],u=!1,p=0;p<h.length;p++){var d=!1,g=!1,v=h[p],f=v.id,y=v.activation,m=v.activation1,_=e.getLV(f),C=e.getXingLV(f),I=-1==C?0:C,b=(s[f+"_"+(-1==_?0:_)],s[f+"_"+(_+1)]),w=(o[f+"_"+I],o[f+"_"+(C+1)]);if(-1==_)if(m[0]){var S=m[0][1],E=m[0][0];S<=e.getLV(+E)&&(d=!0)}else d=!y[0]||i.getItemCount(y[0][0])>=y[0][1];else{if(w){var T=w.upcost;g=i.getItemCount(T[0][0])>=T[0][1]}if(b){T=b.upcost;d=i.getItemCount(T[0][0])>=T[0][1]}}(d||g)&&(u=!0),c.push([d,g])}l.red=u,a[+r-1]=c}}},t}(s.RedListenner);e.ZzsqRedListener=i}),define("src/g/zzsq/view/ShenQiView",["require","exports","../../../manager/RoleCenter","../../../meta/ShenQiVo","../../../utils/ItemUtils","../../../config/GameConfig","../../../meta/ShenQiLevelVo","../../../meta/ShuXingVo","../../net/messages/ZZShenQiC2GS","../../../manager/GameSocketManager","../../net/messages/OpResultType","src/g/jineng/vo/SkillOpenVo","src/g/lottery/view/ShenyuSkillDlg","src/g/itemGets/View/ItemGetDlg","../../../plugin/sbkPropTool","../../net/messages/PropFightMain","../../net/messages/sbkFormula","src/g/zzsq/ZzsqUtils","../../../core/E","../../../enum/EventName","../../../manager/RedDotM","src/g/Effects/UIEffectsFactory","src/init/TextConst"],function(t,e,W,o,z,X,a,Q,r,l,h,Z,u,c,$,tt,et,it,n,s,p,nt,st){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(i){function t(){var t=i.call(this)||this;t.btn_up.on(Laya.Event.CLICK,t,t.itemUp),t.img_starup.on(Laya.Event.CLICK,t,t.starUp),t.tab.selectHandler=new Laya.Handler(t,t.change),t.tab.selectedIndex=0,t.list.renderHandler=new Laya.Handler(t,t.itemR),t.list.selectHandler=new Laya.Handler(t,t.select),t.item_cost.setJump(st.TextConst.get(238),new Laya.Handler(t,t.getItemDlg));for(var e=0;e<4;e++){t["img_skill"+e].on(Laya.Event.CLICK,t,t.skillIconClick,[e])}return t}return __extends(t,i),t.prototype.skillIconClick=function(t){for(var e=this.list.array[this.lastSIdx],i=e.id,n=this.zzshenqiData.getLV(i),s=Z.SkillOpenVo.getSkillList(e.skill)[t],o=new u.ShenyuSkillDlg,a=z.ItemUtils.getSkillDefItem(s.skillId),r=a.desc,l=a.effect,h=0;h<l.length;h++){var c=l[h];r=r.replace("{"+c[0]+"}",c[1]/1e4+"")}r=r.replace("{rate}",a.rate/100+""),o.lab_open.text=n>=s.level?st.TextConst.get(524):st.TextConst.get(485),o.lab_desc.innerHTML=r,o.setIcon(a),o.popup()},t.prototype.getItemDlg=function(){var t=this.list.array[this.lastSIdx],e=t.id,i=this.zzshenqiData.getLV(e),n=-1==i?0:i,s=X.GameConfig.ShenQiLevelJson[e+"_"+n],o=-1==i?+t.activation[0][0]:s.upcost[0][0],a=z.ItemUtils.getItemVoById(o);(new c.ItemGetDlg).initByVo(a).popup()},t.prototype.select=function(t){if(-1!=t){var e=this.list,i=this.lastSIdx;this.lastSIdx=t,isNaN(i)||this.itemR(e.getCell(i),i);var n=this.zzshenqiData,s=e.array[t];if(s){var o=s.id,a=n.getLV(o),r=n.getXingLV(o),l=-1==a?0:a,h=X.GameConfig.ShenQiLevelJson[o+"_"+l],c=X.GameConfig.ShenQiLevelJson[o+"_"+(a+1)],u=this.btn_up,p=this.lab_max,d=this.item_cost,g=s.activation,v=s.activation1,f=!1,y=!1,m=!1,_=!0,C=st.TextConst.get(237),I=469;if(this.itemR(e.getCell(t),t),-1==a)if(v[0]){var b=st.TextConst.get(1153).split(","),w=v[0][0],S=v[0][1];(y=n.getLV(+w)<S)?(f=!(_=!(I=490)),p.text=st.TextConst.get(48,b[b.indexOf(w)+1],S)):m=!1}else g[0]&&(m=!0,y=this.updateCost(g));else c?(m=!0,C=st.TextConst.get(615),y=this.updateCost(c.upcost)):_=m=!1;d.visible=m,this.box_pro.y=I,u.label=C,u.visible=_,u.disabled=y,p.visible=f;for(var E=0;E<4;E++){var T=this["lab_now_"+E],A=this["lab_next_"+E];T.parent.refresh();var R=h.prop,L=z.ItemUtils.getShuXingByName(R[E][0]);if(c){var x=c.prop,P=z.ItemUtils.getShuXingByName(x[E][0]);T.text=Q.ShuXingVo.getString4Vo(R[E][1],L,!0),A.text=Q.ShuXingVo.getString4Vo(x[E][1],P)}else T.text=Q.ShuXingVo.getString4Vo(R[E][1],L,!0),A.text=st.TextConst.get(208)}this.box_fight.setFightNum(h.power),this.font_lv.value=l+"",this.img_name.skin="dynamic/zhizunshenqi/title2/"+o+".png";var k=this.ani;k.removeChildren(),it.ZzsqUtils.createAni(k,"dynamic2/zhizunshenqi/"+o+".json");var D=Z.SkillOpenVo.getSkillList(s.skill);for(E=0;E<D.length;E++){var H=this["img_skill"+E],M=this["lab_name"+E],G=D[E],B=z.ItemUtils.getSkillDefItem(G.skillId),N=!0,U="#ff0000",V=st.TextConst.get(524);H.skin=z.ItemUtils.getSkillIconByIconId(B.icon),a>=G.level?(N=!1,U="#09d51f"):V=st.TextConst.get(1303,G.level),M.text=V,M.color=U,H.gray=N}var O=tt.PropFightMain.getins(),F=tt.PropFightMain.getins(),q=tt.PropFightMain.getins();$.sbkPropTool.resetZzsqOne(o,a,r,O,F);for(E=0;E<D.length;E++){var K=D[E];a>=K.level&&$.sbkPropTool.reSetProp(q,z.ItemUtils.getSkillDefItem(K.skillId).prop,!1)}var Y=et.sbkFormula.calPropFightMainCombat(O)+et.sbkFormula.calPropFightMainCombat(F)+et.sbkFormula.calPropFightMainCombat(q);this.box_fight.setFightNum(Y*W.RoleCenter.instans.vo.heronum),O.release(),F.release(),q.release();var j=this.heroRed.allRed[this.tab.selectedIndex][t],J=u.getChildByName("ani");j[0]?J?J.visible=!0:nt.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(u,40):J&&(J.visible=!1),this.img_starRed.visible=j[1]}}},t.prototype.updateCost=function(t){var e=W.RoleCenter.instans.vo.bagdata,i=this.item_cost,n=+t[0][0],s=z.ItemUtils.getItemVoById(n);i.setNeedName(s.name,z.ItemUtils.getSmallIcon(s.icon)),i.setQualColor(z.ItemUtils.getColorByQuality(s.quality));var o=e.getItemCount(n),a=t[0][1];return i.setNeed(o,a),o<a},t.prototype.itemR=function(t,e){if(t){var i=t.dataSource,n=t.txt_lv,s=t.img_item;if(i){var o=i.id,a="dynamic/zhizunshenqi/",r=this.zzshenqiData.getLV(o);0<=r?(s.gray=!1,n.text=0<r?"+"+r:""):(n.text="",s.gray=!0),s.skin=a+"icon/"+o+".png",t.img_name.skin=a+"iconT/"+o+".png"}t.img_select.visible=this.lastSIdx==e,this.heroRed.allRed[this.tab.selectedIndex][e]&&(t.img_red.visible=-1!=this.heroRed.allRed[this.tab.selectedIndex][e].indexOf(!0))}},t.prototype.itemUp=function(){var t=this.list.array[this.lastSIdx].id,e=this.zzshenqiData,i=e.IDArr.indexOf(t),n=-1==i?-1:e.LvArr[i],s=new r.ZZShenQiC2GS;s.msgidx=-1==n?h.enumOpResultType.zzshenqi_jihuo:h.enumOpResultType.zzshenqi_up,s.id=t,l.GSM.sendServer(s)},t.prototype.starUp=function(){n.E.ins.event(s.EventName.OPEN_ZZSQ_UPSTAR,[this.heroidx,this.list.array[this.lastSIdx]])},t.prototype.refresh=function(t){this.heroidx=t;var e=W.RoleCenter.instans.vo;this.zzshenqiData=e.zzshenqiData;var i=e.bagdata,n=a.ShenQiLevelVo.costIdArr,s=p.RedDotM._zzsq;this.heroRed=s;for(var o=0;o<n.length;o++)this["tab_red"+o].visible=s[o+1].hasRed(),this["num"+o].text="x"+i.getItemCount(n[o]);this.change(this.tab.selectedIndex)},t.prototype.change=function(t){for(var e=0;e<=2;++e)this["tab_select_"+e].visible=e==t;var i=this.lastSIdx,n=this.list,s=o.ShenQiVo.voByType[t+1];n.array=s,n.selectedIndex=-1,i==s.length&&(i=s.length-1),n.selectedIndex=isNaN(i)?0:i},t}(ui.shenqi.ShenQiViewUI);e.ShenQiView=i}),define("src/g/zzsq/view/ShenQiStar",["require","exports","../../../manager/RoleCenter","../../../config/GameConfig","../../../utils/ItemUtils","src/g/itemGets/View/ItemGetDlg","../../net/messages/ZZShenQiC2GS","../../net/messages/OpResultType","../../../manager/GameSocketManager","../../../meta/ShuXingVo","src/g/zzsq/ZzsqUtils","../../net/messages/PropFightMain","../../../plugin/sbkPropTool","../../net/messages/sbkFormula","src/g/Effects/UIEffectsFactory","src/init/TextConst"],function(t,e,D,H,M,o,i,n,s,G,B,N,U,V,O,F){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=function(e){function t(){var t=e.call(this)||this;return t.starlist.renderHandler=new Laya.Handler(t,t.starRender),t.btn_up.on(Laya.Event.CLICK,t,t.onUp),t.item_cost.setJump(F.TextConst.get(238),new Laya.Handler(t,t.getItemDlg)),t}return __extends(t,e),t.prototype.refresh=function(t,e){this.vo=e,this.heroidx=t;var i=e.id,n=D.RoleCenter.instans.vo,s=n.zzshenqiData;this.zzshenqiData=s,this.img_name.skin="dynamic/zhizunshenqi/title/"+i+".png";var o=this.ani;o.removeChildren(),B.ZzsqUtils.createAni(o,"dynamic2/zhizunshenqi/"+i+".json");for(var a=s.getXingLV(i),r=-1==a?0:a,l=[],h=0;h<this.starlist.repeatX;h++)if(-1!=r&&h<r)if(10<r){var c=r/10<<0;h<r%10?l.push(c+1):l.push(c)}else l.push(1);else l.push(0);this.starlist.dataSource=l;var u=H.GameConfig.ShenQiStarLevelJson[i+"_"+r],p=H.GameConfig.ShenQiStarLevelJson[i+"_"+(r+1)],d=N.PropFightMain.getins();for(h=0;h<4;h++){var g=this["lab_now_"+h],v=this["lab_next_"+h],f=u.prop,y=M.ItemUtils.getShuXingByName(f[h][0]);if(p){var m=p.prop,_=M.ItemUtils.getShuXingByName(m[h][0]);g.text=G.ShuXingVo.getString4Vo(f[h][1],y,!0),v.text=G.ShuXingVo.getString4Vo(m[h][1],_,!0),U.sbkPropTool.reSetProp(d,f)}else g.text=G.ShuXingVo.getString4Vo(f[h][1],y,!0),U.sbkPropTool.reSetProp(d,f),v.text=F.TextConst.get(208)}this.box_fight.setFightNum(V.sbkFormula.calPropFightMainCombat(d)*n.heronum);var C=!p,I=this.item_cost,b=!1;if(C)I.visible=!1;else{var w=p.upcost,S=+w[0][0],E=M.ItemUtils.getItemVoById(S);I.setNeedName(E.name,M.ItemUtils.getSmallIcon(E.icon)),I.setQualColor(M.ItemUtils.getColorByQuality(E.quality));var T=n.bagdata.getItemCount(S),A=w[0][1];I.setNeed(T,A),I.visible=!0,b=A<=T}var R=this.btn_up,L=s.checkEnable(i),x=!L||C||!b;if(R.disabled=x,!C&&L&&b)O.UIEffectsFactory.Ins.createCenterSAniAndMonopolize(R,42,1.6);else{var P=R.getChildByName("ani");P&&P.removeSelf()}var k=!0;C&&(k=!1),R.visible=k,this.lab_max.visible=!k,d.release()},t.prototype.starRender=function(t,e){1<t.dataSource?t.skin="res/custom/shenqiStar"+t.dataSource+".png":t.skin="res/custom/juese_jingmai_"+(t.dataSource?"xing":"kongxing")+".png"},t.prototype.onUp=function(){var t=this.vo.id,e=new i.ZZShenQiC2GS;e.msgidx=n.enumOpResultType.zzshenqi_xing,e.id=t,s.GSM.sendServer(e)},t.prototype.getItemDlg=function(){var t=this.vo.id,e=this.zzshenqiData.getXingLV(t),i=-1==e?0:e,n=+H.GameConfig.ShenQiStarLevelJson[t+"_"+i].upcost[0][0],s=M.ItemUtils.getItemVoById(n);(new o.ItemGetDlg).initByVo(s).popup()},t}(ui.shenqi.ShenQiStarUI);e.ShenQiStar=a}),define("src/g/zzsq/ctrl/ZzsqUpStarCtrl",["require","exports","../../../manager/LayerManager","src/g/clearRes/ClearResM","src/g/base/BaseCtrl","src/g/shenshou/view/ShenShouView","src/g/zzsq/view/ShenQiStar","../../../core/E","../../../enum/EventName","../../net/messages/OpResultType","../../../manager/RoleCenter","src/g/Effects/UIEffectsFactory","../../../meta/ShenQiStarLevelVo"],function(t,e,i,n,s,o,a,r,l,h,c,u,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var d=function(e){function t(){var t=e.call(this)||this;return t.url="res/atlas/res/shenqi.json",r.E.ins.on(l.EventName.OPEN_ZZSQ_UPSTAR,t,t.onOpenHandler),t}return __extends(t,e),t.prototype.onOpenHandler=function(t,e){this.heroidx=t,this.vo=e,this.open()},t.prototype.onAtlasLoaded=function(){var t=this.view;t||(this.view=t=new o.ShenShouView,t.tab.visible=!1,t.tab.selectHandler=new Laya.Handler(this,this.tab_selectHandler),t.bgview.btn_close.on(Laya.Event.CLICK,this,this.closeSelf),t.bgview.btn_back.on(Laya.Event.CLICK,this,this.closeSelf),c.RoleCenter.instans.on(h.enumOpResultType.zzshenqi_xing+"",this,this.upHandler),r.E.ins.on(l.EventName.CHANGEITEM_COUNT,this,this.onChangeItem)),t.tab.selectedIndex=0,this.tab_selectHandler(0),t.displayedInStage||(i.LayerManager.addInPOPWindowLayer(t,!1),n.ClearResM.resetViewImg(t))},t.prototype.onChangeItem=function(t){-1!=p.ShenQiStarLevelVo.costIdArr.indexOf(t)&&this.upHandler()},t.prototype.upHandler=function(t){var e=this.star;e&&(u.UIEffectsFactory.Ins.playAniOnce(29,e.ani_node),e.refresh(this.heroidx,this.vo))},t.prototype.closeSelf=function(){this.view.bgview.box_page.removeChildren(),this.view.removeSelf()},t.prototype.tab_selectHandler=function(t){void 0===t&&(t=0);var e=this._page;switch(e&&e.hidePage(),t){case 0:var i=this.star;i||(this.star=i=new a.ShenQiStar),i.refresh(this.heroidx,this.vo),this.view.bgview.box_page.addChild(i),n.ClearResM.resetViewImg(i)}e&&(e.showPage(this.view.bgview.box_page),this.view.bgview.img_title.skin=e.getTitle()),this.view.bgview.img_title.skin="res/title/SQ_biaoti_wenzi001.png",this._page=e},t}(s.BaseCtrl);e.ZzsqUpStarCtrl=d}),define("src/g/zzsq/ctrl/ZzsqCtrl",["require","exports","src/g/base/BaseCtrl","src/g/zzsq/view/ShenQiView","../../../core/E","../../../enum/EventName","../../../manager/RoleCenter","../../net/messages/OpResultType","src/g/Effects/UIEffectsFactory","../../../plugin/sbkPropTool","src/g/zzsq/ctrl/ZzsqUpStarCtrl"],function(t,e,i,n,s,o,a,r,l,h,c){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var u=function(e){function t(){var t=e.call(this)||this;return t._nowSelectHero=0,t.url="res/atlas/res/shenqi.json",new c.ZzsqUpStarCtrl,t}return __extends(t,e),t.prototype.init=function(){var t=this._view;return t||(this._view=t=new n.ShenQiView,s.E.ins.on(o.EventName.CLOSEALLWINDOWS,this,this.destroyPage),a.RoleCenter.instans.on(r.enumOpResultType.zzshenqi_up+"",this,this.upHandler),a.RoleCenter.instans.on(r.enumOpResultType.zzshenqi_xing+"",this,this.upHandler),a.RoleCenter.instans.on(r.enumOpResultType.zzshenqi_jihuo+"",this,this.upHandler)),t},t.prototype.upHandler=function(t){var e,i=a.RoleCenter.instans.vo;switch(t.msgidx){case r.enumOpResultType.zzshenqi_up:e=11;break;case r.enumOpResultType.zzshenqi_jihuo:e=38}isNaN(e)||l.UIEffectsFactory.Ins.playAniOnce(e,this._view.aniUp),this.refreshData();var n=i.combat;h.sbkPropTool.resetZzsq(),h.sbkPropTool.resetSkill(),a.RoleCenter.instans.event(o.EventName.FIGHT_UP,i.reCheckComBat()-n)},t.prototype.showPage=function(t,e){t.removeChildren(),this.parent=t,this.open()},t.prototype.changePerson=function(t,e){this._nowSelectHero=t,this.refreshData()},t.prototype.loadUrls=function(){},t.prototype.refreshData=function(){var t=this._view;t&&t.refresh(this._nowSelectHero)},t.prototype.getTitle=function(){return"res/title/SQ_biaoti_wenzi001.png"},t.prototype.hidePage=function(){},t.prototype.destroyPage=function(){this.clearCtrlRes()},t.prototype.onAtlasLoaded=function(){if(this.parent.numChildren<=0){var t=this.init();this.parent.addChild(t),this.refreshData()}},t}(i.BaseCtrl);e.ZzsqCtrl=u});