var egret=window.egret,$E=window.egret,$G=game=window.game={},$C=customui=window.customui={},__reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(a,r,s,c){return new(s||(s=Promise))(function(e,t){function i(e){try{o(c.next(e))}catch(e){t(e)}}function n(e){try{o(c.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(i,n)}o((c=c.apply(a,r||[])).next())})},__generator=this&&this.__generator||function(i,n){var o,a,r,e,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,a&&(r=a[2&t[0]?"return":t[0]?"throw":"next"])&&!(r=r.call(a,t[1])).done)return r;switch(a=0,r&&(t=[0,r.value]),t[0]){case 0:case 1:r=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,a=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(r=0<(r=s.trys).length&&r[r.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!r||t[1]>r[0]&&t[1]<r[3])){s.label=t[1];break}if(6===t[0]&&s.label<r[1]){s.label=r[1],r=t;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(t);break}r[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(i,s)}catch(e){t=[6,e],a=0}finally{o=r=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};!function(e){var t=function(t){function e(){var e=t.call(this)||this;return e._tileX=0,e._tileY=0,e.zorder=0,e.zOrderDirtyframePass=0,e.serverTileX=0,e.serverTileY=0,e.addEventListener(egret.Event.ENTER_FRAME,e.enterFrame,e),e}return __extends(e,t),e.prototype.onDestroy=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrame,this)},e.prototype.checkPosValid=function(e,t){return this.map.checkPosValid(e,t)},e.prototype.enterFrame=function(){var e=this;if(this.isUICreated){if(this.isPosDirty){this.isPosDirty=!1;var t=this.map.tile2Pos(this._tileX,this._tileY);if(!this.hasEnterMap||1!=this.mapObjType&&2!=this.mapObjType)this.x=t.x,this.y=t.y,this.tileXYChange();else{this.isMoving=!0;var i=(t.x-this.x)*this.map.scaleX,n=(t.y-this.y)*this.map.scaleY;this.tileXYChange(),egret.Tween.get(this).to({x:t.x,y:t.y},this.map.npcMovingDura).call(function(){e.isMoving=!1,e.onAfterWalk()}),1==this.mapObjType&&this.map.scrollByOffset(i,n)}egret.Point.release(t)}this.isZOrderDirty&&(this.isZOrderDirty=!1,this.map.reqCalAllZOrder()),this.tileXYChangeFrameCheck()}},e.prototype.updateFixedPos=function(){var e=this.map.tile2Pos(this._tileX,this._tileY);this.x=e.x,this.y=e.y,this.tileXYChange(),this.map.reqCalAllZOrder()},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.width=139,this.height=70,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height,this.gp_foot=new eui.Group,this.gp_foot.width=this.width,this.gp_foot.height=this.height,this.gp_foot.horizontalCenter=0,this.gp_foot.bottom=38,this.addChild(this.gp_foot),this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.onDestroy()},this),this.isUICreated=!0,this.touchEnabled=!1,this.gp_foot.touchEnabled=!0,this.gp_foot.touchChildren=!1},e.prototype.tileXYChangeFrameCheck=function(){if(this.zOrderDirtyframePass&&(this.zOrderDirtyframePass--,this.zOrderDirtyframePass<=0)){this.zorder=10*this.map.getTileIndex(this._tileX,this._tileY);this.map.tile2Deep(this._tileX,this._tileY);0,this.isZOrderDirty=!0}},e.prototype.tileXYChange=function(){this.zOrderDirtyframePass=5},e.prototype.onAfterWalk=function(){},Object.defineProperty(e.prototype,"tileX",{get:function(){return this._tileX},set:function(e){e!=this._tileX&&(this._tileX=e||0,this.isPosDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tileY",{get:function(){return this._tileY},set:function(e){e!=this._tileY&&(this._tileY=e||0,this.isPosDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.hasEnterMap=!1},e.prototype.onOPComeBackCB=function(){var e=this;this.hasEventListener(egret.Event.ENTER_FRAME)||this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrame,this),this.hasEventListener(egret.Event.REMOVED_FROM_STAGE)||this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.onDestroy()},this)},e}(eui.Component);e.MapObj=t,__reflect(t.prototype,"game.MapObj")}(game||(game={}));var EPropertyType={EPropertyTypeDiamond:1,EPropertyTypeGold:2,EPropertyTypeArena:3,EPropertyTypeDevote:4,EPropertyTypeBossHonor:5,EpropertyTypeWorldKingHonor:6,EPropertyTypeWorldKingGrade:7,EPropertyTypeExpedition:8,EPropertyTypeIntegralShop:9,EPropertyTypeTeamExpedition:10,EPropertyTypeFriendIntimacy:11,EPropertyTypeSoul:12,EPropertyTypeSpaceTime:13,EPropertyTypeQqxyxXingBi:14,EPropertyTypeManor:15,EPropertyTypeTribeBattleGoods:16,EPropertyTypePeakWarMoney:17},EExpType={EExpTypePlayer:1,EExpTypeVip:2,EExpTypeGuild:3,EExpTypeBraveBook:4,EExpTypeNewBraveBook:5},EPropType={EPropTypeGemeral:0,EPropTypePokemonExp:1,EPropTypePokemonFoster:2,EPropTypePokemonBall:3,EPropTypeGem:4,EPropTypeVictory:5,EPropTypeSkillBook:6,EPropTypeFashion:7,EPropTypeRandomBox:8,EPropTypeSelectBox:9,EPropTypeEdenTimes:10,EPropTypeFixedBox:11,EPropTypeChip:12,EPropTypeMonthCard:13,EPropTypeRecharge:14,EPropTypeWorldBoss:15,EPropTypeRedPacket:16,EPropTypeMap:17,EPropTypeAvatar:18,EPropTypeBraveBook:19,EPropTypeFrame:20,EPropTypeNewBraveBook:21,EPropTypeStormWarScore:22,EPropTypeHeroSpirit:23,EPropTypeManorScore:24,EPropTypePeakWarScore:25},EVictoryPropType={EVictoryPropTypeAddVit:1,EVictoryPropTypeKillCreep:2,EVictoryPropTypeBonus:3,EVictoryPropTypeAddRange:4},EGemType={EGemTypeLife:1,EGemTypePhysicalAtk:2,EGemTypeMagicAtk:3,EGemTypePhysicalDefense:4,EGemTypeMagicDefense:5,EGemTypeSpeed:6},EEntityType={EEntityTypeMoney:1,EEntityTypeExp:2,EEntityTypeItem:3,EEntityTypeHero:4,EEntityTypePlayer:5,EEntityTypeGuild:6,EEntityTypeHeroUuid:7,EEntityTypeHeroEquip:8,EEntityTypeHeroArtifact:9,EEntityTypePet:10,EEntityTypeTreasure:11,EEntityTypeMagical:12,EEntityTypeMap:13,EEntityTypeDerma:14,EEntityTypeHeroArtifactCode:15,EEntityTypeVestageItem:16,EEntityTypeVestageHero:17,EEntityTypeTitle:18,EEntityTypeHorse:19,EEntityTypeFashion:20},BattleEntityType={Hero:1,Creep:2,Boss:3,Magical:4,Pet:5},EColorType={EColorTypeWhite:1,EColorTypeGreen:2,EColorTypeBlue:3,EColorTypePurple:4,EColorTypeOrange:5,EColorTypeRed:6,EColorTypeLegend:7},EAttrType={Atk:1,Life:2,Defence:3,Speed:4,Anger:5,Crit:11,CritHurt:12,Toughness:13,Hit:14,Miss:15,HurtRate:16,FreeHurtRate:17,Precise:18,Parry:19,ParryCoff:20,FreeControl:21,ArmorBreak:22,SockBlood:23,AntiInjury:24,Crue:25,BeCrue:26,SkillHurt:27,BeSkillHurt:28,SkillHurtAdd:29,SkillHurtFree:30,BossHurtAdd:31,FreeHurtRate2:32,BuffControl:33,Tenacity:34,HurtRate2:35},ESAttrType={Control:1,Profession:2,Race:3},EBuffType={Invalid:0,Benumb:1,BloodResume:2,Silence:3,Disperse:4,DebuffsDisperse:5,Firing:6,SockBlood:7,Posioned:8,AppointedDisperse:9,Frozen:10,Petrified:11,Taunt:12,Sign:13,SkillChange:14,Shield:15,ConvertedLife:16,RoundAdd:17,Immune:18,ControlAttrAdd:19,CareerAttrAdd:20,RaceAttrAdd:21,ControlAttrReduce:22,CareerAttrReduce:23,RaceAttrReduce:24,ActionChange:25,Absorb:26,SockBlood2:27,FreeDead:29,FreeHurt:30,StaticEle:31,WineMist:32,Transform:33,DeathSign:34,MAttack:35,FreeCure:36,NormalFree:37,Link:38,BreakAway:39,Egg:40,TriEle:41,RandomEle:42,FireEle:43,IceEle:44,ThunderEle:45,SockBlood4:46,Soul:47,ConditionAttrAdd:48,ConditionAttrReduce:49,Farewell:50,Shield2:51,Shelter:52,TauntReverse:53,Stealth:54,Spurting:55,Shield3:56,Show:57,Doppelganger:58,Revenge:59,DeadWord:60,Detonate:61,Shield4:62,NoCumulativeAttrAdd:63,NoCumulativeAttrReduce:64,Shield5:65,LifeMaxAdd:66,DecreaseAttrAdd:67,DecreaseAttrReduce:68,SkillChange2:69,DirectDeath:70,BuffRoundAdd:71,AttackAdd:101,LifeAdd:102,DefenceAdd:103,SpeedAdd:104,AngerAdd:105,CritAdd:111,CritHurtAdd:112,ToughAdd:113,HitAdd:114,MissAdd:115,HurtAdd:116,FreeHurtAdd:117,PreciseAdd:118,ParryAdd:119,ParryCoffAdd:120,FreeControlAdd:121,ArmorBreakAdd:122,SockBloodAdd:123,AntiInjuryAdd:124,CrueAdd:125,BeCrueAdd:126,SkillHurtAdd:127,BeSkillHurtAdd:128,SkillHurtAddAdd:129,SkillHurtFreeAdd:130,FreeHurtRate2Add:132,BuffControlAdd:133,TenacityAdd:134,HurtRate2Add:135,AttackReducce:201,LifeReducce:202,DefenceReducce:203,SpeedReducce:204,AngerReducce:205,CritReducce:211,CritHurtReducce:212,ToughReducce:213,HitReducce:214,MissReducce:215,HurtReducce:216,FreeHurtReducce:217,PreciseReducce:218,ParryReducce:219,ParryCoffReducce:220,FreeControlReducce:221,ArmorBreakReducce:222,SockBloodReducce:223,AntiInjuryReducce:224,CrueReduce:225,BeCrueReduce:226,SkillHurtReduce:227,BeSkillHurtReduce:228,SkillHurtAddReduce:229,SkillHurtFreeReduce:230,FreeHurtRate2Reduce:232,BuffControlReduce:233,TenacityReduce:234,HurtRate2Reduce:235},PropAttr={Miss:1,BeCrit:2,Parry:3,BeMiss:4,Crit:5,BeParry:6},EConditionType={Control:1,PropEffect:2,RoundNumEach:3,RoundNumUpper:4,BeginBattle:5,Forever:6,Damage:7,Death:8,NormalSkill:9,AngerSkill:10,HurtResultLowerTotalLife:11,LifeLowerTotalLife:12,LifeUpperTotalLife:13,OpponentCareer:14,OpponentRace:15,Cure:16,HurtResultUpperTotalLife:17,RoundClosing:18,BuffTrigger:19,Prop:20,SignNum:21,LiveNum:22,ControlNum:23,LifeNum:24,BeginBattleLimit:25,LifeCost:26,RevengeNum:27,ProfessionNum:28,OnAttack:29,SpeedLowSelf:30,SpeedHighSelf:31,EmptyPosNum:32},EBuffOverlayType={No:0,OnlyTimes:1,OnlyEffect:2,Both:3},EBuffActionType={None:0,DirectlyModify:1,Add:2,Minus:3,Plus:4,Divide:5},EEffectStatus={Miss:0,Crit:1,Parry:2},EBuffDispelType={EBuffDispelNone:0,EBuffDispelOk:1},EBuffGainType={EBuffGainTypeNone:0,EBuffGainTypeBuff:1,EBuffGainTypeDebuff:2},ETargetType={Self:1,Friend:2,Enemy:3,Target:4,All:5},EHurtTargetType={Position:0,Random:1,All:2,Front:3,Back:5,MinLife:8,MaxLife:9,MaxRatioLife:10,MinRatioLife:11,MaxAttack:12,MinAttack:13,MaxSpeed:14,MinSpeed:15,MaxAnger:16,MinAnger:17,Catapult:18,Multistage:19,FrontFix:20,BackFix:21,MultiAttack:22,AllNotSelf:23,MaxMiss:24,MinMiss:25},ESkillType={None:0,Damage:1,Cure:2,Action:3,Normal:4,AttackBack:5,LastEffectors:6,LastTarget:7,CopyEffect:8},ESkillActionType={Normal:1,Action:2,Passive:3},EBattleSide={EBattleSideAttack:1,EBattleSideDefence:2},PositionType={Normal:0,OneTwo:1,TwoOne:2,ZeroOne:3,ZeroOneBig:4,Chess8V8:5},BattleNumberSource={Atk:0,LastDamage:1,Life:2,MaxLife:3,AngerCost:4,Cure:5,Damage:6,TLife:7,TMaxLife:8},EHurtUp={Num:1,Anger:2,Sign:3,AngerCost:4,LifeDown:5,RevengeNum:6,ProfessionNum:7},EHurtAddition={Atk:1,Life:2,TAtk:3,TLife:4,TMLife:5,Fix:6,TCLife:7,CLife:8},EFreeDeadType={Hurt:1,Life:2},EComboType={Prop:1,Kill:2},EEquipPartType={EEquipPartTypeHat:1,EEquipPartTypeJacket:2,EEquipPartTypeBottom:3,EEquipPartTypeGlove:4,EEquipPartTypeShoes:5,EEquipPartTypeOrnaments:6},EBattleResult={EBattleResultWin:1,EBattleResultLose:2,EBattleResultDraw:3},EEnergyRecovery={Attack:1,Defence:2,Kill:3,EnergyDefence:4},EBattleType={EBattleTypeTest:1,EBattleTypeFortress:2,EBattleTypeDailyFortress:3,EBattleTypeArena:5,EBattleTypeGuildBoss:6,EBattleTypeGuide:8,EBattleTypePvP:9,EBattleTypeServerBoss:10,EBattleTypeWorldKing:11,EBattleTypeChampion:12,EBattleTypeTeamArena:13,EBattleTypeBattleBack:14,EBattleTypeBattleExpedition:15,EBattleTypeTeamExpedition:16,EBattleTypeHeroChallenge:17,EBattleTypeRisk:18,EBattleTypeGuildTranscript:19,EBattleTypeGuildWar:20,EBattleTypeExtremeBattle:21,EBattleTypeHeroChallenge2:22,EBattleTypeWchess:23,EBattleTypeChampionHelp:24,EBattleTypeDemon:25,EBattleTypeZoneBoss:26,EBattleTypeManor:27,EBattleTypeAbyssLair:28,EBattleTypeFishingSnatch:29,EBattleTypeVestage:30,EBattleTypeStormWar:31,EBattleTypeTribeBattle:32,EBattleTypePeakWar:33,EBattleTypeMidAutumn:34},EMailStatus={EMailStatusUnread:0,EMailStatusRead:1},EMailType={EMailTypeSystem:1,EMailTypeReward:2,EMailTypeArena:3,EMailTypeGuildDevote:4,EMailTypeGuildKillReward:5,EMailTypeGuildBossHurt:6,EMailTypeRecharge:7,EMailTypeCreateRole:8,EMailTypeServerBossPlayerHurt:9,EMailTypeWorldKingLevel:10,EMailTypeWorldKingServerRank:11,EMailTypeWorldKingWorldRank:12,EMailTypeTeamArena:13,EMailTypeTeamExpedition:14,EMailTypeNoBagCapacity:15,EMailTypeTeamExpeditionFirstPass:16,EMailTypeGuildCollectTaskFinish:17,EMailTypeChallengeBossKill:18,EMailTypeFightCapActivity:19,EMailTypeGuildTranscript:20,EMailTypeGuildWarWin:21,EMailTypeGuildWarLose:22,EMailTypeGuildWarRank:23,EMailTypeWholeLifeCardReward:24,EMailTypeBraveBookRecharge:25,EMailTypeBraveBookLevelRecharge:26,EMailTypeServerBossWeekPlayerHurt:27,EMailTypeMonthCardReward:28,EMailTypeTeamArenaTransfer:29,EMailTypeTeamExpeditionServerFirstPass:30,EMailTypeRechargeDuplicate:31,EMailTypeNewYearWeekCard:32,EMailTypeActivityZoneConsumeRank:33,EMailTypeNewBraveBookRecharge:34,EMailTypeVipLevel:35,EMailTypeZoneAuction:36,EMailTypeZoneAuctionItem:37,EMailTypeChampionClear:38,EMailTypeDemonFoundReward:39,EMailTypeChessGradeRanking:40,EMailTypeDemonKillReward:41,EMailTypeDemonFoundReward2:42,EMailTypeZoneBossTaskTarget:43,EMailTypeZoneBossTaskFirstRank:44,EMailTypeTeamArenaVoteWinReward:45,EMailTypeTeamArenaVoteLoseReward:46,EMailTypeZoneBossKillReward:47,EMailTypeZoneBossPassedReward:48,EMailTypeZoneActivityDevoteGoodsRank:49,EMailTypeItemExpiredNotice:50,EMailTypeNewZoneActivityConsumeRank:51,EMailTypeResetHeroArtifactBaptize:52,EMailTypeManorBeKilledAccount:53,EMailTypeManorLeaveAccount:54,EMailTypeZoneBossMagicalRewards:55,EMailTypeOpenServerPetRewards:56,EMailTypeV4PetReissueRewards:57,EMailType110LevelPetReissueRewards:58,EMailTypeRollback:59,EMailTypeActivityNewZoneZongZiGradeRank:60,EMailTypeActivityNewZoneDragonBoatGradeRank:61,EMailTypeFirstRechargeRewards:62,EMailTypeManorCloseAccount:63,EMailTypeDiamondRebate:64,EMailTypeNewZoneGroupPurchaseAccount:65,EMailTypeInvitationCode:66,EMailTypeNewZoneActivityConsumeRank1:67,EMailTypeActivityZoneFishing:68,EMailTypeActivityZoneFishingEnd:69,EMailTypePlatformGift:70,EMailTypeActivityStormWarPlayer:71,EMailTypeActivityStormWarGuild:72,EMailTypePetResetReturnRewards:73,EMailTypeMagicalResetReturnRewards:74,EMailTypeStormWarChampionRewards:75,EMailTypeStormWarPlayerScoreRewards:76,EMailTypeStormWarPlayerIncomeRewards:77,EMailTypeMagpieActivityRewards:78,EMailTypeTribeBattlePlayerRewards:79,EMailTypeTribeBattleGuildRewards:80,EMailTypeManorPlayerRankRewards:81,EMailTypeManorGuildRankRewards:82,EMailTypeTribeBattlePlayerAchievement:83,EMailTypeTribeBattleGuildAchievement:84,EMailTypePeakWarFreedomRankRewards:85,EMailTypePeakWarHighLadderRankRewards:86,EMailTypeQuoraFinishRewards:87,EMailTypeZoneQuoraFinishRewards:88,EMailTypeZoneQuoraRank:89},EMailValueType={EMailValueTypeText:1,EMailValueTypeCode:2},EChatStatus={EChatStatusUnread:1,EChatStatusRead:2},EChatChannelType={EChatChannelTypeWorld:1,EChatChannelTypeGuild:2,EChatChannelTypeSystem:3,EChatChannelTypePrivate:4,SameServer:5,EChatChannelTypeZone:6,EChatChannelNewZone:7},EChatSendCheckType={None:1,Level:2,Length:3,LevelAndLength:4},EChatJumpType={JumpModule:1,ShowInfo:2},EFriendType={EFriendTypeStranger:0,EFriendTypeApply:1,EFriendTypeNormal:2,EFriendTypeRelieve:3,EFriendTypeBlack:4},EGuildPositionType={EGuildPositionTypeNone:0,EGuildPositionTypeOridinary:1,EGuildPositionTypeVicePresident:2,EGuildPositionTypePresident:3},EGuildQuitType={EGuildQuitTypeNone:0,EGuildQuitTypeTick:1,EGuildQuitTypeQuit:2},EGuildUpdateType={Base:1,Member:2,Apply:3},EGuildOperationType={AppointVice:1,RelieveVice:2,TickOut:3,Transfer:4,Quit:5,Join:6,CancelJoin:7,AgreeJoin:8,AgreeAll:9,RejectJoin:10,RejectAll:11,CancelAll:12},ESexType={ESexTypeMale:1,ESexTypeFemale:2},ShopType={ShopTypeArena:2,ShopTypeGuild:3,ShopTypeRefresh:4,ShopTypeWorldKing:5,ShopTypeTeamArena:6,ShopTypeExpedition:7,ShopTypeTeamExpedition:8,ShopTypeDecompose:9,ShopTypeRaceGashapon:10,ShopTypeSmithy:11,ShopTypeShare:12,ShopTypeHeroChallenge:13,ShopTypeManor:14,ShopTypePeakWar:15},ShopWorkType={Common:1,FreeAndBuyRefresh:2,BuyRefresh:3,NoneGridRefresh:4,Drop:5},ShopItemUnlockType={None:0,Level:1,Vip:2,ArenaRank:3,GuildLevel:4,WorldKing:5,TeamArenaRank:6},ShopBuyLimitType={Unlimit:0,Daily:1,Week:2,Month:3,Year:4,Career:5},VictoryEventType={VictoryEventTypeLock:0,VictoryEventTypeEmpty:1,VictoryEventTypeCreep:2,VictoryEventTypeItem:3,VictoryEventTypeShop:4,VictoryEventTypeBox:5,VictoryEventTypeEntry:6},VictoryBuffType={VictoryBuffTypeBonus:1,VictoryBuffTypeRange:2},MODULE={Team:1,Team2:2,Team3:3,Team4:4,Team5:5,Team6:6,Ranking:101,CityMain:201,Task:301,TaskSecAchieve:303,Reward:401,Recharge:501,VIP:601,Chat:701,ChatWorld:702,ChatPrivate:703,Friend:801,FightSkip:901,FightSpeed:902,FightSkipForVestage:903,Bag:1001,Decompose:1002,DecomposeEquip:1003,Stronger:1101,Champion:1301,ChampionHelp:1302,HeroArtifact:1401,HeroArtifactUpGrade:1402,HeroArtifactUpAttach:1403,HeroArtifactBaptize:1404,HeroArtifactDecompose:1405,HeroArtifactUpStar:1406,HeroArtifactRollback:1407,HeroEquip:1501,HeroEquipUpGrade:1502,HeroEquipEnchat:1503,HeroEquipQuenchce:1504,HeroEquipMaster:1505,Treasure:1601,TreasureJewelUpGrade:1602,Hero:1701,HeroGaCha:1702,HeroUpGrade:1703,HeroUpStar:1704,HeroUpSection:1705,HeroRollback:1706,HeroResonate:1707,HeroAwaken:1708,StarDoor:1713,Replacement:1714,HeroUpGradeAuto:1715,HeroArtifactUpQuality:1716,HeroArtifactResoante:1717,HeroPractice:1718,HeroSpirit:1719,Pet:1801,PetUpGrade:1802,PetUpStar:1803,PetUpSection:1804,PetUpSkill:1805,Arena:1901,ArenaSaoDang:1902,TeamArena:2001,DailyFortress:2102,Expedition:2104,ExpeditionSaoDang:2105,GuardianSecret:2110,GuardianSecretSweep:2111,AbyssLair:2130,Mail:2201,TeamExpedition:2301,WorldKing:2401,ServerBoss:2501,Magical:2601,MagicalUpGrade:2602,MagicalUpSection:2603,Risk:2701,RiskDifficulty:2702,RiskFingerToXY:2711,RiskMeToXY:2712,RiskQuickBattle:2713,RiskFingerAppearToXY:2714,Demon:2715,RiskMulti:2730,TouchGoldHand:2801,Smithy:2901,Shop:3e3,ShopMystical:3001,ShopExpedition:3002,ShopTeamExpedition:3003,ShopDecompose:3004,ShopRaceGashapon:3005,ShopArean:3006,ShopHeroChallenge:3007,Guild:4001,GuildCopy:4002,GuildBoss:4003,GuildInbreak:4004,GuildTask:4005,GuildBounty:4006,GuildSubway:4007,GuildSkill:4008,GuildShop:4009,GuildHall:4010,GuildLuckyMoney:4011,GuildManor:4012,GuildCollect:4013,GuildTranscript:4002,GuildWar:4015,Challenge:5001,Challenge10x:5002,HeroChallenge:6001,Wchess:7001,ZoneBoss:8001,HeroDerma:9001,HeroDermaUpGrade:9002,Manor:1e4,LuckyTurntable:10200,Vestage:10210,StormWar:10220,MagpieActivity:10230,MagpieActivityCtrl:10231,TribeBattle:10240,TribeBattleChallenge:10241,TribeBattleRevenge:10242,PeakWar:10250,PeakWarFreedomChallenge:10251,PeakWarFreedomRefresh:10252,PeakWarHighLadderRefresh:10253,PeakWarHighLadderChallenge:10254,Title:10260,Fashion:10270,RoleSkill:10280,Horse:10290,Activity:1e5,ActivityBrave:10091,ActivityNewBrave:10092,ActivityZoneAuction:10093,ChampionChallengeActivity:10322,ActivityBraveBaoZang:10323,ActivityNewBraveBaoZang:10324,ActivityProfessionSuit:10325,ActivityInvitationCode:10400},RankingType={RankingTypeArena:1,RankingTypeFightCap:2,RankingTypeLevel:3,RankingTypeGuild:4,RankingTypeGuildBoss:5,RankingTypeGuildLevel:6,RankingTypeFortress:7,RankingTypeServerWorldKing:8,RankingTypeWorldWorldKing:9,RankingTypePlayerServerBossHurt:10,RankingTypeTeamArena:11,RankingTypeZoneFightCap:12,RankingTypeZoneExpeditionRobot:13,RankingTypeChampion:14,RankingTypeTeamExpedition:15,RankingTypeFightCapActivity:16,RankingTypeGuildTranscript:17,RankingTypeGuildWarScore:18,RankingTypeWeekPlayerServerBossHurt:19,RankingTypeHeroChallenge:20,RankingTypeActivityZoneConsumeRank:21,RankingTypeSingleTeamArena:22,RankingTypeSinglePlayerServerBossHurt:23,RankingTypeSingleWeekPlayerServerBossHurt:24,RankingTypeSingleGuildWarScore:25,RankingTypeChessGrade:26,RankingTypeTeamArenaMatch:27,RankingTypeTeamArenaEliminate:28,RankingTypeTeamArenaEliminateSingle:29,RankingTypeActivityZoneDevoteGoodsRank:30,RankingTypeActivityNewZoneConsumeRank:31,RankingTypeAbyssLair:32,RankingTypeActivityNewZoneZongZiGradeRank:33,RankingTypeActivityNewZoneDragonBoatGradeRank:34,RankingTypeActivityNewZoneConsumeRank1:35,RankingTypeActivityZoneFishing:36,RankingTypeActivityStormWarPlayer:37,RankingTypeActivityStormWarGuild:38,RankingTypeActivityStormWarTopThree:39,RankingTypeTribeBattlePlayer:40,RankingTypeTribeBattleGuild:41,RankingTypeManorPlayer:42,RankingTypeManorGuild:43,RankingTypeActivityRechargeRank:44,RankingTypeHeroSpirit:45,RankingTypePeakWarFreedom:46,RankingTypePeakWarHighLadder:47,RankingTypePeakWarLevelFightCap:48,RankingTypeNewZoneActivityQuora:49},RankingSubType={Normal:1,Total:2,Three:3},RobotType={RobotTypeArena:1,RobotTypeExpedition:2,RobotTypeTeamArena:3,RobotTypeWorldKing:4},TaskTarget={Target:1,Untarget:2},TaskType={Guide:1,Daily:2,Achievement:3,BraveBook:4,HideAchievement:5,Unlock:6,Apprentice:7,NewBraveBook:8,NewNewBraveBook:9,DifficultyGuide:10,SecondAchievement:11},TaskSubType={HeroUpGradeNums:101,HeroUpGradeTimes:102,HeroUpSectionNums:103,HeroUpSectionTimes:104,HeroUpStarTimes:105,HeroEquipStarNums:106,HeroEquipNums:107,HeroPutOnPos:108,HeroPutOnFront:109,MagicalActivate:110,DecomposeTimes:111,HeroStarNums:112,DecomposeHeroNums:113,HeroEquipColorNums:114,HeroArtifactColorNums:115,HeroStarOne:116,HeroMaxUpGrade:117,HeroEquipPutOnTimes:118,MagicalActivateNum:119,HeroEquipUpGradeTimes:120,HeroEquipEnchantTimes:121,TreasureInlayUpGradeTimes:122,HeroArtifactUpGradeTimes:123,MagicalUpGradeTimes:124,HeroArtifactPutOnTimes:125,FightCap:126,LowerGashaponTimes:201,HighGashaponTimes:202,ArenaChallengeTimes:203,ArenaChallengeRank:204,TeamArenaChallengeTimes:205,TeamArenaChallengeRank:206,ChampionLayer:207,TeamExpeditionSection:208,ExpeditionSection:209,DoneAllDailyTask:210,TouchGoldHand:211,GiveFriendPokeBall:212,ReceiveRiksMineRewards:213,DailyFortressTimes:214,TeamExpeditionTimes:215,ChampionTimes:216,ShopBuyTimes:217,ExpeditionSuccessTimes:218,FriendGashaponHeroStarTimes:219,RaceGashaponTimes:220,JoinGuild:221,CompoundHeroTimes:222,ChallengeTimes:223,GuildCollectFinishTimes:224,GuildTranscriptTimes:225,GuildBoss:226,DoneNewNewBraveBook:227,WorldKingTimes:228,AbyssLairStageNo:229,AbyssLairAllStars:230,VestageMaxMap:231,VipLevelChange:301,LevelUpTeam:302,RiskChatNPC:401,RiskCreeep:402,RiskCollectItem:403,RiskEventFinish:404,RiskLayerNewEnter:405,RiskMultiEventFinish:406,RiskLayerMaxClear:407,RiskMapOpenTimes:408,MixTask:501,ExtremeBattleStage:601,CommentBeLikeMax:701,CommentTimes:702,LikeTimes:703,ChallengeCircle:704,SmithyTimes:705,ActivityGashapon:706,ActivityGashapon1:707,ActivityConsumeDiamond:708,FriendShare:801,MysticalShopRefreshTime:901,GuildCollectTime:902,HeroArtifactUpStarNum:903,MagicalUpGrade:904,PetUpGrade:905,TreasureJewelTotalLevel:906,QuenchceMasterMaxLevel:907,HeroArtifactTotalBaptizeNum:908,HeroStarSubTypeNum:909,QuoraNum:910,RechargeMoney:911},TaskUpdateType={Add:1,cover:0},TaskResetType={None:1,Daily:2},GuideActionType={MAP_NPC_MOVE:1,MAP_NPC_EMOJI:2,MAP_NPC_TALK:3,MAP_NPC_FIXED_UPDATE:4,MAP_MAP_SWITCH:10,MAP_FADE_REWARD:20,TASK_FINISH:30,INIT_PKM:50,MAP_FIGHT:60,MAP_GUIDE_END:99},GuideDir={LEFT:0,RIGHT:1},RoleMapDir={YOU:0,ZHENG:1,ZUO:2,HOU:3},ActivityStartType={General:1,ServerOpen:2,CreateRole:3,GeneralServerOpen:4,NewGeneralServerOpen:5},ActivityOper={Add:1,Remove:2},EActivityType={SignIn:1,OnlineReward:2,FirstRecharge:3,FirstRecharge1:1003,LevelReward:4,RechargeReward:5,TargetReward:6,LoginReward:7,FlashSale:8,MonthCard:9,FlashCapsuleHigh:10,FlashCapsuleHigh1:1010,FlashCapsuleHigh2:2010,FlashCapsuleHigh3:3010,FlashCapsuleHigh4:4010,FlashCapsuleHigh5:5010,FlashCapsuleHigh6:6010,FlashCapsuleHigh7:7010,FlashCapsuleHigh8:8010,FlashCapsuleHigh9:9010,FlashCapsuleHigh10:10010,FlashCapsuleHigh11:11010,FlashCapsuleHigh12:12010,CollectHero:11,ChampionChallenge:12,HandbookRank:13,ExchangeCode:14,ShareLink:15,VipGift:16,AppDownLoad:17,DailyRecharge:18,Rotate:19,OpenServerRecharge:20,SecondLoginReward:21,PurchaseGiftBag:22,ModuleGoalReward:23,AdvancedRotate:24,DailyHundred:25,GrowFund:26,ExtremeBattle:27,GroupPurchase:28,PropRotate:29,DiamondRotate:30,GymChallenge:31,FightCapRank:32,DiamondReward:33,PokemonCatch:34,SeveralDayRecharge:35,SecondRecharge:36,ConsumeRotate:37,ConsumeRotateReward:38,GuildFightRank:39,GuildLevelTarget:40,GuildTaskReward:41,GuildTaskExpReward:42,WeChatShare:43,OnceShare:44,SecondGiftBag:45,HolidayOnlineReward:46,HolidayOpenServerRecharge:47,HolidayFlashSale:48,ShouCangYouLi:49,GuanZhuGongZhongHao:1049,ShiMingRenZheng:2049,WeiDuanXiaZai:3049,ActivityShop:50,SecondModuleGoalReward:51,SecondOpenServerRecharge:52,SecondOpenServerRecharge1:1052,SecondOpenServerRecharge2:2052,SecondOpenServerRecharge3:3052,SecondOpenServerRecharge4:4052,SecondOpenServerRecharge5:5052,SecondOpenServerRecharge6:6052,SecondOpenServerRecharge7:7052,SecondOpenServerRecharge8:8052,SecondOpenServerRecharge9:9052,SecondOpenServerRecharge10:10052,SecondOpenServerRecharge11:11052,SecondOpenServerRecharge12:12052,EggReward:53,SecondDiamondRotate:54,ZoneAuction:55,ZoneAuction1:1055,SecondCollectPokemon:56,HangUpDrop:57,ActivityGashapon:58,ActivityGashapon1:1058,ActivityGashaponRank:59,ExchangeReward:60,WonderfulActivity:61,SingleRecharge:62,IntegralShop:63,BossDoubleReward:64,TeamBuying:65,ActivityBoss:66,SecondMonthCard:67,DailyLogin:68,MythicalPokemonGift:69,DiscountGiftBag:70,DiscountGiftBag1:1070,DiscountGiftBag2:2070,DiscountGiftBag3:3070,DiscountGiftBag4:4070,DiscountGiftBag5:5070,DiscountGiftBag6:6070,DiscountGiftBag7:7070,DiscountGiftBag8:8070,DiscountGiftBag9:9070,DiscountGiftBag10:10070,DiscountGiftBag11:11070,DiscountGiftBag12:12070,DiscountGiftBag13:13070,DiscountGiftBag14:14070,DiscountGiftBag15:15070,DiscountGiftBag16:16070,DiscountGiftBag17:17070,DiscountGiftBag18:18070,DiscountGiftBag19:19070,DiscountGiftBag20:20070,DiscountGiftBag21:21070,DiscountGiftBag22:22070,DiscountGiftBag23:23070,DiscountGiftBag24:24070,DiscountGiftBag25:25070,DiscountGiftBag26:26070,BoutiqueShop:71,DiscountRechargeGiftBag:72,LuckyReward:73,ZoneConsumeRank:74,DailyFirstRecharge:75,SixFlash:76,InvestRebate:77,ZeroGiftBag:78,SingleServerAuction:79,GashaponDiscount:80,RechargeRank:81,FlashCapsuleRace:82,FlashCapsuleRace1:1082,FlashCapsuleRace2:2082,FlashCapsuleRace3:3082,RiskLayer:83,LuckyRotate:84,LuckyRotate1:1084,WeekGift:85,MonthGift:86,EnjoyCard:87,EnjoyCard1:1087,EnjoyCard2:2087,EnjoyCard3:3087,EnjoyCard4:4087,EnjoyCard5:5087,DiamondGifts:88,DiamondGifts1:1088,DiamondGifts2:2088,DiamondGifts3:3088,DiamondGifts4:4088,DiamondGifts5:5088,ItemGifts:89,ItemGifts1:1089,ItemGifts2:2089,ItemGifts3:3089,ItemGifts4:4089,ItemGifts5:5089,ItemGifts6:6089,ItemGifts7:7089,ItemGifts8:8089,ItemGifts9:9089,ItemGifts10:10089,ItemGifts11:11089,ItemGifts12:12089,ItemGifts13:13089,ItemGifts14:14089,ItemGifts15:15089,TriggerGifts:90,BraveBook:91,WholeLifeCard:92,DailyLuxuryGifts:93,DailyLuxuryGifts1:1093,DailyLuxuryGifts2:2093,DailyLuxuryGifts3:3093,DailyLuxuryGifts4:4093,VipLevelGift:94,CommentLike:95,TouchGoldHandTask:96,TouchGoldHandTask1:1096,ArenaChallengeTask:97,ArenaChallengeTask1:1097,SmithyTimeTask:98,SmithyTimeTask1:1098,SmithyTimeTask2:2098,ChallengeCircleTask:99,ChallengeCircleTask1:1099,ChallengeCircleTask2:2099,FriendShare:100,OneYuanGifts:101,SixtyEightYuanGifts:10101,OneYuanGifts2:20101,NewYearWeekCrad:102,MysticalShopRefreshTask:103,MysticalShopRefreshTask1:1103,GuildCollectTask:104,GuildCollectTask1:1104,NewYearChallenge:105,CollectWords:106,TimerLuckyMoney:107,OnlineSpecialDrop:108,OnlineSpecialDrop1:1108,OnlineSpecialDrop2:2108,OnlineSpecialDrop3:3108,OnlineSpecialDrop4:4108,OnlineSpecialDrop5:5108,DailyLoginWeal:109,DailyLoginWeal1:1109,DailyLoginWeal2:2109,DailyLoginWeal3:3109,DailyLoginWeal4:4109,DailyLoginWeal5:5109,ActivityGashaponTask:110,ActivityGashaponTask1:1110,CommonShopSpecialItem:111,CommonShopSpecialItem1:10111,CommonShopSpecialItem2:20111,HeroRollback:112,HeroConvert:113,GashaponMustAppear:114,GashaponMustAppear1:10114,GashaponMustAppear2:1114,DrawCardRatioImprove:115,DrawCardRatioImprove1:1115,NewBraveBook:116,OneChoice:117,ThirdOpenServerRecharge:118,ThirdOpenServerRecharge1:1118,ThirdOpenServerRecharge2:2118,WchessShow:119,HuntTreasure:120,HuntTreasure1:1120,HuntTreasure2:2120,HuntTreasure3:3120,HuntTreasure4:4120,HuntTreasure5:5120,ProfessionSuit:121,ProfessionSuit1:1121,ProfessionSuit2:2121,NewItemGifts:122,NewItemGifts1:1122,NewItemGifts2:2122,CommonTask:123,CommonTask1:1123,CommonTask2:2123,CommonTask3:3123,CommonTask4:4123,CommonTask5:5123,CommonTask6:6123,CommonTask7:7123,CommonTask8:8123,CommonTask9:9123,DermaJump:124,DermaJump1:1124,DermaJump2:2124,ConsumeDiamondTask:125,ZoneDevoteGoods:126,RechargeRotate:127,RechargeRotate1:1127,BasicHeroGifts:128,NewZoneConsumeRank:129,NewZoneConsumeRank1:1129,WishGifts:130,WishGifts1:1130,WishGifts2:2130,WishGifts3:3130,WishGifts4:4130,WishGifts5:5130,WishGifts6:6130,WishGifts7:7130,WishGifts8:8130,WishGifts9:9130,WishGifts10:10130,WishGifts11:11130,QQZoneVipGift:131,NewHeroShow:132,OtherDiamondGifts:134,NewGrowFund:135,RechargeItem:136,NewZoneZongZiGradeRank:137,NewZoneDragonBoatGradeRank:138,EatingZongZi:139,DragonBoatGrade:140,NewNewItemGifts:141,DiamondRebate:142,NewZoneGroupPurchase:143,NewTurntable:144,FourthOpenServerRecharge:145,FourthOpenServerRecharge1:1145,FourthOpenServerRecharge2:2145,FourthOpenServerRecharge3:3145,InvitationCode:146,HeroArtifactUpStarTask:147,PushGiftBag:148,NewOneYuanGifts:149,ZoneFishing:150,EverydayTurntable:151,SecondDiamondGifts:152,DiscountGiftBagDaily:153,DiscountGiftBagDaily1:1153,DiscountGiftBagDaily2:2153,DiscountGiftBagDaily3:3153,DiscountGiftBagDaily4:4153,DiscountGiftBagDaily5:5153,DiscountGiftBagDaily6:6153,DiscountGiftBagDaily7:7153,DiscountGiftBagDaily8:8153,DiscountGiftBagDaily9:9153,DiscountGiftBagDaily10:10153,FifthOpenServerRecharge:154,FifthOpenServerRecharge1:1154,FifthOpenServerRecharge2:2154,FifthOpenServerRecharge3:3154,ContinueRechargeReward:155,ContinueRechargeReward1:1155,ContinueRechargeReward2:2155,ContinueRechargeReward3:3155,ContinueRechargeReward4:4155,VipPreferentialGift:156,SecondContinueRechargeReward:157,SecondContinueRechargeReward1:1157,SecondContinueRechargeReward2:2157,SecondContinueRechargeReward3:3157,SeventhOpenServerRecharge:158,SeventhOpenServerRecharge1:1158,SeventhOpenServerRecharge2:2158,SeventhOpenServerRecharge3:3158,SeventhOpenServerRecharge4:4158,SeventhOpenServerRecharge5:5158,SeventhOpenServerRecharge6:6158,SeventhOpenServerRecharge7:7158,ThirdDiamondGifts:159,ThirdDiamondGifts1:1159,ThirdDiamondGifts2:2159,ThirdDiamondGifts3:3159,ThirdDiamondGifts4:4159,AwakenGiftBag:160,StormWar:161,WishTree:162,WishTree1:1162,BlessingBox:163,MagicalUpGradeTask:164,PetUpGradeTask:165,TreasureJewelTotalLevelTask:166,QuenchceMasterMaxLevelTask:167,HeroArtifactTotalBaptizeTask:168,MagpieActivity:169,DiamondLottery:170,QqzoneOpenServerRecharge:171,SecondNewItemGifts:172,HeroStarSubTypeNumTask:173,SecondDailyGifts:174,VipWelfare:175,WeekFund:176,WeekFund1:1176,WeekFund2:2176,WeekFund3:3176,WeekFund4:4176,WorldRechargeRank:177,TodayActivity:178,SecondLevelReward:179,MidAutumn:180,RandomEvent:181,MoonCake:182,MidAutumnSun:183,Quora:184,ProfessionSuitReplacement:185,NewZoneQuora:186,ZhongQiuTask:187,QuoraNumTask:188},ActivityPushType={Zero:1,Add:2,Remove:3},ETargetActivityType={TGemLevel:1,TRiding:2,THandbook:3,TFashion:4,TEnchant:5,TForge:6,TWing:7,TFightCap:8,TLevel:9,TMedal:10,TPet:11,TOrnament:12,TField:13,TAura:14,TBadge:15,TFoster:16,TTote:17,TFortress:18,TGashapon:19},ModuleGoalType={ArenaRank:1,Champion:2,EdenCatch:3,Boss:4,HandbookLevel:5,Gym:6,RefreshShop:7,Fortress:8,BattleSubway:9,GuildFortress:10,ServerBossPlayerHonor:11,GuildLevelRank:12,PlayerLevel:13,PlayerFightCap:14,TeamFortress:15,WorldKingLevel:16,WildEncounter:17,ChallengeTeamCount:18,ChallengeRocketCount:19,BattleZoneArenaBattle:20},EChampionRedPointType={Achievement:1},GuildBountyStatus={Able:1,Unable:2,GotReward:3},CollectPokemonActivityCollectType={Add:1,Reduce:2},BroadcastType={System:1,HeroUpStar:2,GuildWarStart:3,GuildWarFirstRank:4,ArenaRankChangeFirst:8,ServerBossOpen:12,ServerBossKill:13,ChallengeChampion:24,TeamExpedition:25,TeamExpeditionInvite:26,TeamArena:27,TeamArenaInvite:28,TeamExpeditionFirstPass:29,JoinGuildInvitation:30,ExtremeBattle:31,ServerBossFirstRank:32,LowerGashaponFiveHero:33,FriendGashaponFiveHero:34,HighGashaponFiveHero:35,RaceGashaponFiveHero:36,OpenRiskMap:37,WorldKingFirstWorldRank:38,ActivityGashaponFiveHero:39,Wchess:40,ChampionRequestHelp:41,ChampionHelpResult:42,WorldKingFirstServerRank:43,HuntTreasureActivity:44,ZoneBossInvite:45,SpecialManor:46,StormWarChampionTransfer:47,DiamondLottery:48,PeakWarRankChangeFirst:50,PeakWarEndFirst:51,NewZoneQuoraFirstRank:52},FriendGoodType={FriendPokeBall:11},FriendGoodOperationType={GetOperation:1,GiveOperation:2,GetAndGiveOperation:3,QuickGetAndGiveOperation:4},PlayerOnlineState={Online:1,Offline:2},RelationType={Recommend:1},SyncOperationType={UpRelation:1,DownRelation:2},RelationRewardRequireType={Level:1,Recharge:2},RewardSendType={Email:1,Push:2},OperationType={Act_Share:1,Act_AppDownload:2,Act_ShouCangYouLi:3,Act_GuanZhuGongZhongHao:4,Act_ShiMingRenZheng:5},DailyRechargeLevel={First:10,Second:30,Third:50,Fourth:100},ChatMsgSourceType={Player:1,System:2},ManorType={City:1,Suburb:2,Cancel:3,InitData:4},ManorCancelType={Self:1,Other:2,Init:3,End:4},ManorBattleRecordType={Attack:1,Defense:2},ManorQualityType={Normal:1,Legend:2,Epic:3},ManorMapType={Normal:1,Safe:2},ManorRewardType={personal:1,guild:2},RechargeType={Recharge:1,MonthCard:2,PurchaseGiftBag:3,WeekGift:4,MonthGift:5,EnjoyCard:6,DiscountGiftBag:7,TriggerGifts:8,BraveBook:9,BraveBookLevel:10,WholeLifeCard:11,DailyLuxuryGifts:12,OneYuanGifts:13,NewYearWeekCrad:14,NewBraveBook:15,ZoneBoss:16,BasicHeroGifts:17,WishGifts:18,NewGrowFund:19,RechargeItem:20,PushGiftBag:21,BlessingBox:22,SecondDailyGifts:23,SecondLevelReward:24},LuckyMoneyStatus={WaitingSend:1,HaveSend:2,Empty:3},PushRewardSource={EggRewardActivity:1,HangUpDrop:2,Redeem:3,RiskEvent:4,ZoneAuctionCostReturn:5,ZoneAuctionBid:6,GmCost:7},AdvancedRotateRewardType={Buff:1,Loot:2,Time:3,Entity:4,Revenge:5},SystemMessageShow={Broadcast:1,ChatChannel:2,BroadChatChannel:3},SystemMessageTrigger={event:1,time:2},UnlockType={Level:0,VipLevel:1,LevelOrVipLevel:2,LevelAndVipLevel:3,GuildLevel:4,ChampionNum:5,Task:6,VipLevelTask:7,HeroLevel:8,ServerOpenDay:9,Enable:999,LevelAndServerOpenDay:10,LevelAndGuildLevelAndServerOpenDay:11},QuoraResult={QuoraResultWin:1,QuoraResultFail:2,QuoraResultOverTime:3},QuoraStatus={QuoraStatusClose:1,QuoraStatusAnswered:2,QuoraStatusAnswering:3},EFightCapChangeSource={ChangeFormation:1},UseTaskUnlockType={Module:1,Pokemon:2},WeChatTargetType={Share2Friend:-3,Regular:0,Champion:2,Arena:5,ObtainFiveStarHero:9,RiskAxe:10,RiskClear:12},HeroProfessionType={Common:0,Warrior:1,Enchanter:2,Pastor:3,Assassinator:4,Hunter:5,Pet:6},HeroProfessionSubType={Common:0,DefenseWarrior:101,MadWarrior:102,ElementEnchanter:201,RiotEnchanter:202,WizardEnchanter:203,FetePastor:301,Warlock:302,RiotHunter:501,NightHunter:502},HeroRaceType={Common:0,Human:1,Orc:2,Elf:3,Athanasy:4,Demon:5,Eldar:6,Pet:7},HeroUpStarCostType={Appoint:1,Condition:2},HeroArtifactUpStarCostType={Appoint:1,Condition:2},HeroEquipKind={Normal:1,Suit:2},HeroEquipType={Weapon:1,Armour:2,Shoe:3,Ornament:4},HeroEquipColor={White:1,Green:2,Blue:3,Purple:4,Orange:5,Red:6},HeroArtifactCostType={Appoint:1,Condition:2},HeroArtifactType={Normal:1,Exp:2,AdvanceExp:3},GashaponType={Lower:1,High:2,Race:3,Friend:4},GashaponSubType={Human:1,Orc:2,Elf:3,Athanasy:4,DemonAndEldar:5},TreasureJewelType={Atk:1,Life:2,Crit:3,Parry:4},TeamExpeditionType={Master:1,Boss:2},WorldKingRewardType={Level:1,LevelAccount:2,BattleTimes:3,SingleLevel:4},ServerBossRewardType={Hurt:1,ChallengeTimes:2},ChallengeEventType={Empty:1,Box:2,DoubleDice:3,OnearmBandit:4,PlayFinger:5,Ahead:6,Backward:7,Move:8,Stop:9,Ending:10,AttackBoss:11,Box2:12},ChallengeEffectType={DoubleDice:1},RiskDifficultyType={Normal:0,Difficulty:1},RiskEventType={None:0,Creep:1,Fortress:2,Maze:3,Tavern:4,Shop:5,Box:6,Quora:7,Mine:8,Hinder:9,Gate:10,Start:11,Npc:12,Select:13,Collect:14,FingerGame:15,GuessSize:16,Trigger:17,Recharge:18,StoryCreep:19,BoxCreep:20,Trigger2:21,MysticalShop:22,Manor:23,Task:24,StormWarCreep:25},RiskTrigger2Type={FlipCard:1,Unicursal:2,Puzzle:3,Sieve:4},FingerGameType={Rock:1,Scissors:2,Paper:3},GuessSizeType={Big:1,Small:2},RiskShopType={Normal:1,Refresh:2},GateType={Any:1,UpOne:2,UpTwo:3,DownOne:4,DownTwo:5,Quit:6,start:7},RiskDataType={Creep:1,Fortress:2,Maze:3,Box:6,Npc:7,Mine:8,Main:13},RiskNodeType={Risk:1,Fortress:2,Maze:3},RiskTaskStatus={UnGot:0,Got:1,Finish:2},GuildWarStatus={NotOpen:0,Close:1,Enroll:2,Adjust:3,Battle:4,Wait:5,UnEnroll:6,WaitBattle:7,BattleEnd:8},TeamArenaStatus={NotOpen:0,Close:1,Enroll:2,Adjust:3,Battle:4,Wait:5,UnEnroll:6,WaitBattle:7,BattleEnd:8,MatchAdjust:9,MatchBattle:10,MatchWaitBattle:12,Rest:13},TeamArenaTeamStatus={UnEnroll:1,Match:2,NoInEliminate:3,UnEliminate:4,Eliminated:5},TriggerGiftsTriggerType={HeroUpStar:2,TeamLevelUp:3},RiskMineType={PlayerExp:1,HeroExp:2,Gold:3,Diamond:4,Artifact:5,Equip:6},EItemUseType={None:0,Direct:1,Compound:2,Prompt:3,Jump:4},CommentType={GiveLike:1,Comment:2,CommentGiveLike:3},HeroChallengeModel={OneVsOne:1,ThreeVsThree:2,SixVsSix:3},HeroHaloType={Race:1,Profession:2},HaloType={Normal:1,Chess:2},EWchessRoomStatus={ToMatch:1,Matching:2,Matched:3,Handle:4,Battle:5,ChickenDinner:6},HeroEquipDecomposeType={Allowable:0,Forbidden:1},EHaleAttrType={Atk:1,Life:2,Defence:3,Speed:4,Anger:5,Crit:11,CritHurt:12,Toughness:13,Hit:14,Miss:15,HurtRate:16,FreeHurtRate:17,Precise:18,Parry:19,ParryCoff:20,FreeControl:21,ArmorBreak:22,SockBlood:23,AntiInjury:24,Crue:25,BeCrue:26,SkillHurt:27,BeSkillHurt:28,SkillHurtAdd:29,SkillHurtFree:30,InitAngerFront:31,InitAngerAll:32,BloodResume:33,BloodResumeMaxLifeRatio:34},ZoneAuctionInfoPType={Refresh:1,Account:2,Bidding:3,Bid:4},AuctionItemStatus={Bidding:1,Bid:2},ZoneAuctionRewardPType={Reward:1,CostReturn:2},HeroEquipCompoundType={Normal:1,ProfessionSuit:2,ProfessionSuitReplacement:3},EZoneBossStatusType={NotUnlock:1,Unlock:2,Kill:3,RealKill:4},EZoneBossTaskType={HighGashaponTimes:101,RaceGashaponTimes:102,TouchGoldHandTimes:103,SmithyTimes:104,GuildCollectHeroExp:105,GuildCollectGold:106,ArenaChallengeTimes:107,ChallengeTimes:108,ChallengeCycleTimes:109,RefreshShopRefreshTimes:110,RefreshShopBuyTimes:111,ServerBossTimes:112,TeamExpeditionTimes:113,ServerBossLifeNum:114,GiveFriendPokeBall:115,GuildCollectFourStar:116,HeroChallengeCheckPointNum:201,WorldKingTotalGrade:202,ChampionCheckPointNum:301,RiskFortressNum:302,GuildTranscriptCheckPointNum:303,PlayerTotalLevel:304,TeamExpeditionCheckPointNum:305,HeroPutOnTotalLevel:401,GuildSkillTotalLevel:402,HeroPutOnTotalStar:403},EChessAchieveType={NumBloodCheckenDinner:1,LessNumHaloCheckenDinner:2,OuHuang:3,LessNumHeroCheckenDinner:4,PerfectBody:5,FirstWin:6,MoreNumHundredCheckenDinner:7,CostMoreNumCheckenDinner:8,MassExplosion:9,WchessRank:10,MoreNumHaloCheckenDinner:11,RecommendLineupCheckenDinner:12,AllRaceHerosNumStar:13,LessNumBloodWin:14,OneBloodWin:15,RacimolareHaloCheckenDinner:16,TurnTheTide:17,DestinyOuHuang:18,RefreshCostLessNumCheckenDinner:19,MoreSixtyThousandHurt:20,NoLessThreeCostCheckenDinner:21,WinningStreak:22,CumulativeCheckenDinner:23,TotalGameTimes:24,EightHeroNumTimesCheckenDinner:25,StabilizingTopThree:26},EGiftType={CareerGift:1,DailyGift:2,HolidayGift:3,VipGift:4},ChatFilterResult={Normal:0,Shield:1,Warning:2},ManorPlayerCoordinateChangeType={Normal:0,Battle:1,ManorDisapper:2,NoHero:3},ManorRewardShowType={Normal:0,Low:1,Middle:2,High:3},EGuardianRaceType={Human:1,Orc:2,Elf:3,Athanasy:4,DemonNEldar:5},ERoleKeepType={Normal:1,Rollback:2},HeroEquipMasterType={Upgrade:1,Enchant:2,Quenchce:3},FishingActivityOper={ChangeRod:1,ChangeBait:2,ChangeCreel:3,Snatch:4,Revenge:5,StartFishing:6,BuySnatch:7,GetFish:8,RefreshSnatchList:9},VestagePointStatus={UnPassed:1,Passed:2,Just:3,Success:4,Fail:5},VestageEventType={Empty:0,Unknown:1,Creep:2,Shop:3,Box:4,Campsite:5,CureLife:6,UpHeroStar:7},VestageCreepType={Normal:2001,Elite:2002,Boss:2003},VestagePropType={Gold:1,Buff:2,LifePotion:3,AngerPotion:4,ResuscitatedPotion:5,BuffPotion:6,GoldBuff:7,StoreBuff:8,ReduceLife:9,IncreaseLife:10},VestageItemUseType={None:1,Direct:2,Prompt:3},VestageChoiceType={Empty:0,Cost:2,Reward:3,Event:4},VestageResultSubType={None:0,AddLife:1,MinusLife:2,MinusGold:3,GetHero:4,GetBuff:5,GetPotion:6,GetGold:7},VestageProcessType={SelectInitHero:1,GetStartedBuff:2,EnterMap:3},StormWarPlayerStatus={Normal:1,Battle:2},WishTreeOper={SetWishId:1,Wish:2},MagpieEventType={Empty:0,Box:1,FingerGame:2,Talk:3,Item:4,Gift:5,GuessSize:6},MagpiePointStatus={Finish:4,NotFinish:5},MagpieActivityOper={TriggerEvent:1,ThrowDice:2,BuyCount:3,GetAchievement:4,BuyGift:5},MagpieAchieveType={Collect:1,FinishRound:2,ThrowDiceTimes:3,ChatWith:4},TribeBattleAchieveType={SelfAchieve:1,GuildAchieve:2},SkillEffectType={Single:-1,Normal:0,Race:1,Profession:2},FashionMasterType={Level:1},RoleSkillUnlockType={Or:0,And:1},BaseClass=function(){function e(){}return e.getInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=this;return i._instance||(i._instance=new(i.bind.apply(i,[void 0].concat(e)))),i._instance},e}();__reflect(BaseClass.prototype,"BaseClass");var BaseMediator=function(n){function e(e,t){void 0===e&&(e=""),void 0===t&&(t=null);var i=n.call(this,e,t)||this;return i._view={},i.afterViewShowCB={},i.resGroupNames=new Array,i._name=e,i.initSubView(),i}return __extends(e,n),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【"+this._name+"】："].concat(e))},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.initSubView=function(){},e.prototype.handleNotice=function(e){},e.prototype.addRootView=function(e,t,i,n){void 0===t&&(t=0),void 0===i&&(i=void 0),void 0===n&&(n=void 0),this.viewComponent&&this.viewComponent.parent?(this.hideAllSubView(!1),this.viewComponent.visible=!0):(GameRootLayer.gameLayer().setViewStackDirty(),this.viewComponent=null,this.viewComponent=new e,this.viewComponent.mediator=this,GameRootLayer.gameLayer().bindView(this.viewComponent,t,i||this.viewComponent.getParentView(),n),this.viewComponent.checkForGuide&&game.AppFacade.getInstance().sendNotification(CN.GUIDE_VIEW_STACK_CHANGE,{}),game.MainJumpConfig.confirmPush()),this.onViewCreate()},e.prototype.addSubView=function(e,t,i,n,o){void 0===e&&(e=void 0),void 0===i&&(i=void 0),void 0===n&&(n=void 0),void 0===o&&(o=!1),this._view[e]||(this._view[e]={className:t,obj:void 0,z:i,resPack:n,jumpCode:void 0,keepAlive:o})},e.prototype._topView=function(e){this._view[e]&&this._view[e].obj&&this._view[e].obj.parent&&(this._view[e].obj.parent.setChildIndex(this._view[e].obj,-1),this._view[e].obj.visible=!0,1==e&&(this.viewComponent||(this.viewComponent=this._view[e].obj)),this.afterViewShowCB[e]&&(this.afterViewShowCB[e](),delete this.afterViewShowCB[e]),this.onViewResume(e))},e.prototype.updateView=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var n=void 0;if(e){var o=this._view[e];if(!o)return void egret.log("BaseMediator:updateView",this._name,e,"no init");n=o.obj}else n=this.viewComponent;n&&n.parent&&n.updateView&&n.isCreateComplete?n.updateView.apply(n,t):egret.log("BaseMediator:updateView",this._name,e,"no show")},e.prototype.removeFromParent=function(){this.viewComponent&&this.viewComponent.parent&&this.viewComponent.parent.removeChild(this.viewComponent)&&GameRootLayer.gameLayer().arrangeViewVisible()},e.prototype.getSubView=function(e){var t=this._view[e];if(t)return t.obj;egret.log("BaseMediator:getSubView",this._name,e,"no init")},e.prototype.showSubView=function(t,e){var i=this;void 0===e&&(e=void 0);var n=this._view[t];if(n){var o=n.obj;if(o)GameRootLayer.gameLayer().setViewStackDirty(),o.parent||GameRootLayer.gameLayer().bindView(o,void 0,o.getParentView(),n.zOrder),o.isCreateComplete?o.updateView(e):o.setUpdateParamsAfterCreated(e),this._topView(t),o.checkForGuide&&game.AppFacade.getInstance().sendNotification(CN.GUIDE_VIEW_STACK_CHANGE,{}),n.jumpCode=game.MainJumpConfig.confirmPush();else{var a=function(){if(!o){if(!(o=new n.className).perShow(e))return void(o=void 0);o.viewID=t.toString(),o.mediator=i}i._view[t].obj=o,i._view[t].jumpCode=game.MainJumpConfig.confirmPush(),GameRootLayer.gameLayer().setViewStackDirty(),o.setUpdateParamsAfterCreated(e,function(){i._topView(t),i.onViewCreate(t)}),"BasePanel"==o.viewType()?PopUpManager.addPopUp({effectType:o.popActionType(),obj:o,clickDarkClose:e&&e.clickDarkClose,onDarkClick:function(e){return 1==t?i.hideAllSubView(!1):i.hideSubView(t),!0},closeCB:e&&e.closeCB,context:i,interruptButNotBreakGuide:e?e.interruptButNotBreakGuide:void 0}):(GameRootLayer.gameLayer().bindView(o,void 0,o.getParentView(),n.zOrder),o.checkForGuide&&game.AppFacade.getInstance().sendNotification(CN.GUIDE_VIEW_STACK_CHANGE,{}))};null!=n.resPack?this.preloadRes(n.resPack,function(){a()}):a()}}},e.prototype.hideSubView=function(e,t,i,n){void 0===t&&(t=void 0),void 0===i&&(i=!1),void 0===n&&(n=!1);var o=void 0;if("object"==typeof e)for(var a in this._view)this._view[a].obj==e&&(e=a,o=this._view[a]);else o=this._view[e];if(o&&o.obj){var r=o.obj;r&&r.parent&&(r.perClose(),o.keepAlive&&!n||(GameRootLayer.gameLayer().setViewStackDirty(),"BasePanel"==r.viewType()?PopUpManager.removePopUp(r,void 0,t):(r.parent.removeChild(r),r.checkForGuide&&game.AppFacade.getInstance().sendNotification(CN.GUIDE_VIEW_STACK_CHANGE,{}),GameRootLayer.gameLayer().arrangeViewVisible()),this._view[e].obj=void 0,i||game.MainJumpConfig.confirmSpliceIfTop(this._view[e].jumpCode)))}},e.prototype.hideAllSubView=function(e,t){for(var i in void 0===e&&(e=!0),void 0===t&&(t=!1),this._view)this.hideSubView(i,void 0,e,t)},e.prototype.onViewCreate=function(e){},e.prototype.onViewResume=function(e){},e.prototype.switchMenLoading=function(e,t){var i=this;GameRootLayer.gameLayer().isMenShow?this.preloadRes(e,t):GameRootLayer.gameLayer().switchMenLoading(!0,function(){i.preloadRes(e,function(){GameRootLayer.gameLayer().switchMenLoading(!1,void 0,"BM_SWITCH_MEN_LOADING"),t&&t()})},"BM_SWITCH_MEN_LOADING")},e.prototype.preloadRes=function(e,t){var i=this;this.resGroupNames.splice(0);("string"==typeof e?[e]:e).forEach(function(e,t){RES.isGroupLoaded(e)||i.resGroupNames.push(e)}),0<this.resGroupNames.length?(egret.log("加载资源",this.resGroupNames),this.facade.sendNotification(CN.SHOW_LOADING,{groupNames:this.resGroupNames,resDoneCB:t})):t&&t()},e.prototype.setCBAfterSubViewShow=function(e,t){this.getSubView(e)&&this.getSubView(e).visible?t&&t():t&&(this.afterViewShowCB[e]=t)},e}(puremvc.Mediator);__reflect(BaseMediator.prototype,"BaseMediator",["puremvc.IMediator","puremvc.INotifier"]);var BaseView=function(t){function e(){var e=t.call(this)||this;return e._CLASS_NAME_="BaseView",e.isCreateComplete=!1,e._popActionType=0,e._removeActionType=0,e.checkForGuide=!0,e.guideEffectWait=!1,e.curGuideAvailable=!1,e.EVENT_GUIDE_AVAILABLE="EVENT_GUIDE_AVAILABLE",e.registerNotices=[],e.percentWidth=100,e.percentHeight=100,e.scaleX=Utils.DeviceUtils.additionScale(),e.scaleY=Utils.DeviceUtils.additionScale(),Utils.DebugUtils.isDebug&&(window._a=e),e.once(egret.Event.REMOVED_FROM_STAGE,e.onDestroy,e),e.once(egret.Event.REMOVED_FROM_STAGE,e.removeNotice,e),e}return __extends(e,t),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【"+this.skinName+"】："].concat(e))},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.isCreateComplete=!0,this.guideEffectWait||egret.setTimeout(function(){e&&e.parent&&e.setGuideAvailable()},this,200)},e.prototype.onOtherPanelPopup=function(e){},e.prototype.setUpdateParamsAfterCreated=function(e,t){var i=this;this.once(eui.UIEvent.CREATION_COMPLETE,function(){t&&t(),i.updateView(e,!0)},this)},e.prototype.setGuideAvailable=function(){this.curGuideAvailable=!0,this.dispatchEventWith(this.EVENT_GUIDE_AVAILABLE)},e.prototype.setGuideCB=function(e){this.curGuideAvailable?e():this.once(this.EVENT_GUIDE_AVAILABLE,e,this)},e.prototype.adaptForGuide=function(e){if(e){var t=this.skin;for(var i in t){var n=t[i];n instanceof eui.Scroller&&e&&(n.scrollPolicyH=n.scrollPolicyV=eui.ScrollPolicy.OFF)}var o=game.GameMVC.mainMed.mainUI;o&&(o.vs_top_left.visible=!1)}},e.prototype.viewType=function(){return this._CLASS_NAME_},e.prototype.getParentView=function(){},e.prototype.updateView=function(e,t){void 0===t&&(t=!1),this.updateNotice()},e.prototype.perClose=function(){},e.prototype.perShow=function(e){return!0},e.prototype.getRes=function(e){var t=null;return e._source&&"string"==typeof e._source&&(t=e._source),e._icon&&"string"==typeof e._icon&&(t=e._icon),t},e.prototype.getAllRes=function(e){if(0==egret.is(e,"egret.DisplayObjectContainer"))return[];for(var t=new Array,i=0;i<e.numChildren;i++)this.getRes(e.getChildAt(i))&&t.push(this.getRes(e.getChildAt(i))),t=t.concat(this.getAllRes(e.getChildAt(i)));return t},e.prototype.destroyAllRes=function(){for(var e=this.getAllRes(this).filter(function(e,t,i){return i.indexOf(e)==t}),t=0;t<e.length;t++)RES.destroyRes(e[t])&&egret.log("RES.destroyRes res=",e[t])},e.prototype.onDestroy=function(){},e.prototype.updateNotice=function(){NoticeManager.updateNotice(this.registerNotices)},e.prototype.removeNotice=function(){this.registerNotices.forEach(function(e){NoticeManager.removeNoticeListener(e)})},e.prototype.popActionType=function(){return this._popActionType},e.prototype.removeActionType=function(){return this._removeActionType},e.prototype.hide=function(t){try{this.mediator.hideSubView(this)}catch(e){PopUpManager.removePopUp(this,void 0,t)}},e}(eui.Component);__reflect(BaseView.prototype,"BaseView");var BaseFull=function(t){function e(){var e=t.call(this)||this;return e._CLASS_NAME_="BaseFull",e}return __extends(e,t),e.prototype.viewType=function(){return this._CLASS_NAME_},e.prototype.getParentView=function(){return GameRootLayer.gameLayer().mainLayer},e}(BaseView);__reflect(BaseFull.prototype,"BaseFull"),function(e){var t=function(){function e(){}return e.prototype.update=function(e){this.isExpire=!1,this.isInited=!0},e.updateArr=function(e,t,i){if(Array.isArray(e)){for(var n=0,o=0,a=e;o<a.length;o++){var r=a[o];t[n]?t[n].update(r):t.push(new i(r)),n++}t.splice(n)}},e}();e.BaseVO=t,__reflect(t.prototype,"game.BaseVO");var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.iAmClean=function(){this.isDirty=!1},t.prototype.isDiff=function(e){if(!e||!this.caseDirtyKeys)return!0;for(var t=!1,i=0,n=this.caseDirtyKeys;i<n.length;i++){var o=n[i];if(this[o]&&"object"==typeof this[o]){if(this[o].isDiff&&this[o].isDiff(e[o])){t=!0;break}if(!this[o].isDiff){for(var a="string"==typeof e[o]?JSON.parse(e[o]):e[o],r=0,s=Object.keys(a);r<s.length;r++){var c=s[r];if(this[o][c]!=a[c]){t=!0;break}}if(t)break}}else if(this[o]!=e[o]){t=!0;break}}return t},t}(t);e.DirtyValueVO=i,__reflect(i.prototype,"game.DirtyValueVO")}(game||(game={})),EPropertyType.EPropertyTypeArena;var _h,_j,_k,_l,_m,_o,_p,_q,_r,GuideConditionType={PLAYER:0,FORTRESS:1,VIEW:2,HERO:3,BAG:4,TASK:5,GACHA:6,GUIDE:7,FIGHT:8,EQUIP:9,RISK:10,TOWER:12,RECHARGE:14},GuideConditionSubType={PLAYER_LEVEL_MATCH:1,FORTRESS_ID_DONE:10,FORTRESS_ID_UNDONE:11,VIEW_STACK:20,VIEW_STACK_NOT:21,VIEW_CUR_RISK_TYPE:22,HERO_HAS_HERO_LEVEL_GREATER:30,HERO_HAS_HERO_SECTION_GREATER:31,HERO_POS_OCCUPY:32,HERO_CUR_SELECTED:33,HERO_VIEW_CUR_INDEX:34,HERO_HAS_FREE:35,HERO_NO_SUBTYPE_ON_FORM:36,BAG_HAS_ENOUGH:40,BAG_ONE_TYPE_HAS_ENOUGH:41,BAG_VIEW_CUR_INDEX:42,BAG_CHIP_AVAILABLE:43,BAG_EQUIP_AVAILABLE:44,BAG_ARTIFACT_AVAILABLE:45,TASK_GUIDE_TASK_CUR_CODE:50,TASK_GUIDE_TASK_STATUS:51,GACHA_HTIMES:60,GUIDE_RECODRD:70,GUIDE_FLOW_TARGET:71,GUIDE_FLOW_COND:72,FIGHT_RESULT:80,EQUIP_POS_HAS_STH:90,EQUIP_POS_GEM_LEVEL:91,EQUIP_ALL_MIN_LEVEL:92,RISK_EVENT_EXIST:100,RISK_EVENT_COMPLETE:101,RISK_CUR_POS:102,ACTIVITY_OPEN:110,TOWER_LEVEL_PASS:120,UNLOCK_ID_UNLOCK:130,FIRST_RECHARGE_OPEN:140},GuideOperationType={BUTTON_TAP:1,DRAG:2,MAP_GUIDE:3,EVENT_INTERACT:4},TaskStatus={UNDONE:0,DONE:1,RECEIVE:2},AttrConfig=((_a={})[EAttrType.Atk]={name:"攻击",icon:"_hero_ar_m_json.common_shuxing_gongji"},_a[EAttrType.Atk+1e3]={name:"全体攻击",icon:"_hero_ar_m_json.common_shuxing_gongji"},_a[EAttrType.Life]={name:"生命",icon:"_hero_ar_m_json.common_shuxing_shengming"},_a[EAttrType.Life+1e3]={name:"全体生命",icon:"_hero_ar_m_json.common_shuxing_shengming"},_a[EAttrType.Defence]={name:"防御",icon:"_hero_ar_m_json.common_shuxing_fangyu"},_a[EAttrType.Defence+1e3]={name:"全体防御",icon:"_hero_ar_m_json.common_shuxing_fangyu"},_a[EAttrType.Speed]={name:"速度",icon:"_hero_ar_m_json.common_shuxing_sudu"},_a[EAttrType.Speed+1e3]={name:"全体速度",icon:"_hero_ar_m_json.common_shuxing_sudu"},_a[EAttrType.Anger]={name:"怒气",icon:void 0},_a[EAttrType.Anger+1e3]={name:"全体怒气",icon:void 0},_a[EAttrType.Crit]={name:"暴击率",icon:void 0},_a[EAttrType.Crit+1e3]={name:"全体暴击率",icon:void 0},_a[EAttrType.CritHurt]={name:"暴击伤害率",icon:void 0},_a[EAttrType.CritHurt+1e3]={name:"全体暴击伤害率",icon:void 0},_a[EAttrType.Toughness]={name:"抗暴率",icon:void 0},_a[EAttrType.Toughness+1e3]={name:"全体抗暴率",icon:void 0},_a[EAttrType.Hit]={name:"命中率",icon:void 0},_a[EAttrType.Hit+1e3]={name:"全体命中率",icon:void 0},_a[EAttrType.Miss]={name:"闪避率",icon:void 0},_a[EAttrType.Miss+1e3]={name:"全体闪避率",icon:void 0},_a[EAttrType.HurtRate]={name:"增伤",icon:void 0},_a[EAttrType.HurtRate+1e3]={name:"全体增伤",icon:void 0},_a[EAttrType.FreeHurtRate]={name:"免伤",icon:void 0},_a[EAttrType.FreeHurtRate+1e3]={name:"全体免伤",icon:void 0},_a[EAttrType.Precise]={name:"精准率",icon:void 0},_a[EAttrType.Precise+1e3]={name:"全体精准率",icon:void 0},_a[EAttrType.Parry]={name:"格挡率",icon:void 0},_a[EAttrType.Parry+1e3]={name:"全体格挡率",icon:void 0},_a[EAttrType.ParryCoff]={name:"格挡强度",icon:void 0},_a[EAttrType.ParryCoff+1e3]={name:"全体格挡强度",icon:void 0},_a[EAttrType.FreeControl]={name:"免控率",icon:void 0},_a[EAttrType.FreeControl+1e3]={name:"全体免控率",icon:void 0},_a[EAttrType.ArmorBreak]={name:"破甲",icon:void 0},_a[EAttrType.ArmorBreak+1e3]={name:"全体破甲",icon:void 0},_a[EAttrType.SockBlood]={name:"吸血",icon:void 0},_a[EAttrType.SockBlood+1e3]={name:"全体吸血",icon:void 0},_a[EAttrType.AntiInjury]={name:"反伤",icon:void 0},_a[EAttrType.AntiInjury+1e3]={name:"全体反伤",icon:void 0},_a[EAttrType.Crue]={name:"治疗效果",icon:void 0},_a[EAttrType.Crue+1e3]={name:"全体治疗效果",icon:void 0},_a[EAttrType.BeCrue]={name:"被治疗效果",icon:void 0},_a[EAttrType.BeCrue+1e3]={name:"全体被治疗效果",icon:void 0},_a[EAttrType.SkillHurt]={name:"技能系数加成",icon:void 0},_a[EAttrType.SkillHurt+1e3]={name:"全体技能系数加成",icon:void 0},_a[EAttrType.BeSkillHurt]={name:"受伤技能系数",icon:void 0},_a[EAttrType.BeSkillHurt+1e3]={name:"全体受伤技能系数",icon:void 0},_a[EAttrType.SkillHurtAdd]={name:"技能增伤",icon:void 0},_a[EAttrType.SkillHurtAdd+1e3]={name:"全体技能增伤",icon:void 0},_a[EAttrType.BuffControl]={name:"控制率",icon:void 0},_a[EAttrType.FreeHurtRate2]={name:"最终免伤",icon:void 0},_a[EAttrType.Tenacity]={name:"韧性",icon:void 0},_a[EAttrType.Tenacity+1e3]={name:"全体韧性",icon:void 0},_a),ChessAttrConfig=((_b={})[EHaleAttrType.InitAngerFront]={name:"前排初始怒气",icon:void 0},_b[EHaleAttrType.InitAngerAll]={name:"全体初始怒气",icon:void 0},_b),ProfessionConfig=((_c={})[0]={name:"",icon:""},_c[HeroProfessionType.Assassinator]={name:"刺客",icon:""},_c[HeroProfessionType.Enchanter]={name:"法师",icon:"_hero_ar_m_json.common_icon_zhiye_fashi"},_c[HeroProfessionType.Warrior]={name:"战士",icon:"_hero_ar_m_json.common_icon_zhiye_zhanshi"},_c[HeroProfessionType.Hunter]={name:"游侠",icon:"_hero_ar_m_json.common_icon_zhiye_youxia"},_c[HeroProfessionType.Pastor]={name:"牧师",icon:"_hero_ar_m_json.common_icon_zhiye_mushi"},_c),SubProfessionConfig=((_d={})[0]={name:"",icon:""},_d[HeroProfessionSubType.DefenseWarrior]={name:"防战",icon:"_hero_ar_m_json.common_icon_zhiye_fangzhan",haoloIcon:"halo_11_png"},_d[HeroProfessionSubType.MadWarrior]={name:"狂战",icon:"_hero_ar_m_json.common_icon_zhiye_kuangzhan",haoloIcon:"halo_12_png"},_d[HeroProfessionSubType.ElementEnchanter]={name:"元素师",icon:"_hero_ar_m_json.common_icon_zhiye_yuansu",haoloIcon:"halo_15_png"},_d[HeroProfessionSubType.RiotEnchanter]={name:"魔导师",icon:"_hero_ar_m_json.common_icon_zhiye_modao",haoloIcon:"halo_16_png"},_d[HeroProfessionSubType.WizardEnchanter]={name:"巫师",icon:"_hero_ar_m_json.common_icon_zhiye_wushi",haoloIcon:"halo_17_png"},_d[HeroProfessionSubType.FetePastor]={name:"祭司",icon:"_hero_ar_m_json.common_icon_zhiye_jisi",haoloIcon:"halo_18_png"},_d[HeroProfessionSubType.Warlock]={name:"术士",icon:"_hero_ar_m_json.common_icon_zhiye_shushi",haoloIcon:"halo_19_png"},_d[HeroProfessionSubType.RiotHunter]={name:"猎魔",icon:"_hero_ar_m_json.common_icon_zhiye_liemo",haoloIcon:"halo_13_png"},_d[HeroProfessionSubType.NightHunter]={name:"夜行者",icon:"_hero_ar_m_json.common_icon_zhiye_yexingzhe",haoloIcon:"halo_14_png"},_d),GachaTypeInfo=((_e={})[GashaponType.Lower]={name:"低级招募"},_e[GashaponType.High]={name:"高级招募"},_e[GashaponType.Race]={name:"种族招募"},_e),HeroRaceConfig=((_f={})[0]={name:"",raceIcon:"",raceIconBig:"",bgSrc:"yingxiong_bg_3_png",baseSrc:"yingxiong_dizuo_3_png",haoloIcon:"halo_01_png"},_f[HeroRaceType.Human]={name:"人族",raceIcon:"_hero_ar_m_json.common_icon_zhiyexiaotubiao_1",raceIconBig:"_hero_ar_m_json.common_icon_zhongzu_1",bgSrc:"yingxiong_bg_3_png",baseSrc:"yingxiong_dizuo_3_png",haoloIcon:"halo_01_png"},_f[HeroRaceType.Orc]={name:"兽族",raceIcon:"_hero_ar_m_json.common_icon_zhiyexiaotubiao_2",raceIconBig:"_hero_ar_m_json.common_icon_zhongzu_2",bgSrc:"yingxiong_bg_4_png",baseSrc:"yingxiong_dizuo_4_png",haoloIcon:"halo_02_png"},_f[HeroRaceType.Athanasy]={name:"不死族",raceIcon:"_hero_ar_m_json.common_icon_zhiyexiaotubiao_3",raceIconBig:"_hero_ar_m_json.common_icon_zhongzu_3",bgSrc:"yingxiong_bg_2_png",baseSrc:"yingxiong_dizuo_2_png",haoloIcon:"halo_04_png"},_f[HeroRaceType.Elf]={name:"精灵族",raceIcon:"_hero_ar_m_json.common_icon_zhiyexiaotubiao_4",raceIconBig:"_hero_ar_m_json.common_icon_zhongzu_4",bgSrc:"yingxiong_bg_1_png",baseSrc:"yingxiong_dizuo_1_png",haoloIcon:"halo_03_png"},_f[HeroRaceType.Demon]={name:"魔族",raceIcon:"_hero_ar_m_json.common_icon_zhiyexiaotubiao_5",raceIconBig:"_hero_ar_m_json.common_icon_zhongzu_5",bgSrc:"yingxiong_bg_6_png",baseSrc:"yingxiong_dizuo_6_png",haoloIcon:"halo_06_png"},_f[HeroRaceType.Eldar]={name:"神族",raceIcon:"_hero_ar_m_json.common_icon_zhiyexiaotubiao_6",raceIconBig:"_hero_ar_m_json.common_icon_zhongzu_6",bgSrc:"yingxiong_bg_5_png",baseSrc:"yingxiong_dizuo_5_png",haoloIcon:"halo_05_png"},_f[HeroRaceType.Pet]={name:"宠物",raceIcon:"_hero_ar_m_json.common_icon_zhiyexiaotubiao_2",raceIconBig:"_hero_ar_m_json.common_icon_zhongzu_2",bgSrc:"yingxiong_bg_2_png",baseSrc:"yingxiong_dizuo_2_png",haoloIcon:"halo_02_png"},_f),COMPONENT_ENUM={LABEL:1,IMAGE:2},NUM_TO_ROMAN_NUM={1:"Ⅰ",2:"Ⅱ",3:"Ⅲ"},SKILL_CODE={0:"normalSkill",1:"actSkill",2:"posSkill1",3:"posSkill2",4:"posSkill3",5:"posSkill4"},DAILY_COPY_DIFFICULT_ICON={1:"nandu_icon_1_png",2:"nandu_icon_2_png",3:"nandu_icon_3_png",4:"nandu_icon_4_png",5:"nandu_icon_5_png",6:"nandu_icon_6_png",7:"nandu_icon_7_png",8:"nandu_icon_8_png",9:"nandu_icon_9_png",10:"nandu_icon_10_png"},CommonIconStyle={BOTTOM:1,RIGHT:2},DefaultValue={avatar:"head_016_2",pokemon:"40100100"},COLOR_2_FRAME={0:"",1:"_border_m_json.common_img_pinzhikuang_1",2:"_border_m_json.common_img_pinzhikuang_2",3:"_border_m_json.common_img_pinzhikuang_3",4:"_border_m_json.common_img_pinzhikuang_4",5:"_border_m_json.common_img_pinzhikuang_5",6:"_border_m_json.common_img_pinzhikuang_6",7:"_border_m_json.common_img_pinzhikuang_9"},SPRITE_COLOR_2_FRAME={0:"",1:"common_img_touxiangkuang15_png",2:"common_img_touxiangkuang14_png",3:"common_img_touxiangkuang13_png",4:"common_img_touxiangkuang13_png",5:"common_img_touxiangkuang13_png",6:"common_img_touxiangkuang13_png",7:"common_img_touxiangkuang13_png"},COLOR_2_FONT_COLOR={1:16777215,2:1761866,3:1416959,4:11608317,5:16688896,6:16714810,7:16775225,8:16777215},COLOR_CONFIG=((_g={})[EColorType.EColorTypeWhite]={name:"白色"},_g[EColorType.EColorTypeGreen]={name:"绿色"},_g[EColorType.EColorTypeBlue]={name:"蓝色"},_g[EColorType.EColorTypePurple]={name:"紫色"},_g[EColorType.EColorTypeOrange]={name:"橙色"},_g[EColorType.EColorTypeRed]={name:"红色"},_g[EColorType.EColorTypeLegend]={name:"金色"},_g),MAIL_STATUS_ICON={0:"mail_img_weikaiqi_png",1:"mail_img_yikaiqi_png",2:"mail_img_weilingqulibao_png",3:"mail_img_yilingqulibao_png"},SEX_HEAD={1:"main_img_touxian_01_png",2:"main_img_touxian_02_png"},EQUIP_COLOR_NAME_IMG={1:"equip_txt_bai_png",2:"equip_txt_lv_png",3:"equip_txt_lan_png",4:"equip_txt_zi_png",5:"equip_txt_cheng_png",6:"equip_txt_hong_png"},EQUIP_PART_ICON={1:"equip_txt_mz_png",2:"equip_txt_sy_png",3:"equip_txt_kz_png",4:"equip_txt_st_png",5:"equip_txt_xz_png",6:"equip_txt_sp_png"},CHAMPION_GROUP_RES={shenlin:[["champion_beijing_1_png","champion_beijing_2_png","champion_beijing_3_png"],["champion_shui_png","champion_shui_png","champion_shui_1_png"],["champion_caodi_png","champion_caodi_png","champion_caodi_png","champion_caodi_png","champion_caodi_png","champion_caodi_png","champion_caodi_2_png","champion_caodi_1_png"],["champion_caocong_png","","","","","","champion_taijie_png"]],shamo:[["champion_shamo_beijing_2_png","champion_shamo_beijing_1_png"],["champion_shamo_5_png","champion_shamo_5_png","champion_shamo_4_png"],["champion_shamo_1_png","champion_shamo_1_png","champion_shamo_1_png","champion_shamo_1_png","champion_shamo_1_png","champion_shamo_1_png","champion_shamo_2_png","champion_shamo_3_png"],["champion_shamo_xianrenzhang_png","","","","","","champion_shamo_taijie_png"]]},EXPLORED_BUILDING_RES=["xunluo_bg_jianzhu_5_png","xunluo_bg_jianzhu_4_png","xunluo_bg_jianzhu_3_png","xunluo_bg_jianzhu_2_png","xunluo_bg_jianzhu_1_png"],EXPLORED_BACKGROUND_RES=["xunluo_bg_1_jpg","xunluo_bg_2_jpg","xunluo_bg_3_jpg","xunluo_bg_4_jpg"],GUIDE_QIANQI_END_LEVEL=10,MAP_GUIDE_START_CODE=10,MAP_GUIDE_END_CODE=10,GUIDE_WELCOME_CONTENT=[["欢迎来到\n口袋妖怪的世界！","大木博士"],["这个世界上有被称为精灵的\n不可思议的生物","大木博士"],["_EFFECT_","大木博士"],["我们和精灵一起生活\n互相帮助，完成艰难的任务","大木博士"],["听我说了这么多\n能先告诉我关于你的事情吗？","大木博士"],["_MAKE_ROLE_","大木博士"],["欢迎你，%s ！\n属于你的故事即将开始！","大木博士"],["现在就开始吧！\n向着精灵的世界出发！",""]],GUIDE_EVO_AFTER_CATCH={40101300:40105700,40100200:40102600,40102400:40107600},GUIDE_SPECIAL_DISMISS_WHEN_WAIT_STEP={},GUIDE_SPECIAL_FLOW={CATCH:2051,CATCH2:1008,WORLD_MAP:2161,TUJIAN:3021,TUJIAN_ZUIGAOPINZHI:1010,JINHUA:3001},GUIDE_ILLUSTRATE={40101300:40101300,40100200:40100200,40102400:40102400},GUILD_AVATAR_RES=["_guild_m_json.gonghui_icon_qizhi01","_guild_m_json.gonghui_icon_qizhi02","_guild_m_json.gonghui_icon_qizhi03","_guild_m_json.gonghui_icon_qizhi04","_guild_m_json.gonghui_icon_qizhi05","_guild_m_json.gonghui_icon_qizhi06","_guild_m_json.gonghui_icon_qizhi07","_guild_m_json.gonghui_icon_qizhi08","_guild_m_json.gonghui_icon_qizhi09","_guild_m_json.gonghui_icon_qizhi10","_guild_m_json.gonghui_icon_qizhi11","_guild_m_json.gonghui_icon_qizhi12","_guild_m_json.gonghui_icon_qizhi13","_guild_m_json.gonghui_icon_qizhi14","_guild_m_json.gonghui_icon_qizhi15","_guild_m_json.gonghui_icon_qizhi16","_guild_m_json.gonghui_icon_qizhi17","_guild_m_json.gonghui_icon_qizhi18"],GUILD_POSITION_NAME=["未加入公会","成员","副会长","会长"],MID_EFFECT_RES={qianghua:{text:"强化成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_ji_png"},jinjie:{text:"进阶成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_jie_png"},shengxing:{text:"升星成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_xing_png"},fumo:{text:"附魔成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_ji_png"},duanzao:{text:"锻造成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_jie_png"},shengji:{text:"升级成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_ji_png"},jihuo:{text:"激活成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_ji_png"},baoshi:{text:"宝石提升",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_ji_png"},peiyang:{text:"培养成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_ci_png"},jinhua:{text:"进化成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_ji_png"},tupo:{text:"突破成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_ji_png"}},MID_EFFECT_RES_SECOND={jihuo:{effect_src:"common_tujian"},tupo:{effect_src:"common_tupo"}},HARM_TIPS_RES={1:"_fight_m_json.fight_txt_xiaoguobuhao",2:"_fight_m_json.fight_txt_yiban",3:"_fight_m_json.fight_txt_youxiaoguo",4:"_fight_m_json.fight_txt_xiaoguojuejia"},HARM_TIPS_TEXT={1:"效果不好！",2:"效果一般！",3:"效果很好！",4:"效果绝佳！"},BOSS_POS_CONFIG={0:{index:0,startPoint:[4,5],standPoint:[4,6],dir:1},1:{index:1,startPoint:[6,5],standPoint:[6,6],dir:1},2:{index:2,startPoint:[9,8],standPoint:[8,8],dir:2},3:{index:3,startPoint:[9,10],standPoint:[8,10],dir:2},4:{index:4,startPoint:[4,13],standPoint:[4,12],dir:3},5:{index:5,startPoint:[6,13],standPoint:[6,12],dir:3},6:{index:6,startPoint:[1,8],standPoint:[2,8],dir:0},7:{index:7,startPoint:[1,10],standPoint:[2,10],dir:0},8:{index:8,startPoint:[9,8],standPoint:[8,8],dir:1}},CHAT_RANDOM_CONTENT=["眼前的非不是非，快来帮我聚一波欧气吧！","自从玩了这个游戏，我也是家里有矿的人了。","小小魔物算个球，快来瞻仰哥的英姿吧。","稀有英雄这么好抽，你不来试试手气？","我与BOSS的差距，就差一个你，等你！","也许你不知道，这里都是朕为你打下的江山。","千层魔塔的重点在哪，我想与你一起见证。","放置游戏也能激情四射，快来与我并肩作战吧。","一支穿云箭，千军万马来相见，速来支援！","好东西就要分享，兄弟们一起来战吧！"],ECharactorType={ECharactorQinFen:1,ECharactorKaiLang:2,ECharactorYongGan:3,ECharactorRenZhen:4,ECharactorChenZhuo:5,ECharactorHaiXiu:6},BADGE_LOCATION_ENUM={LEFT_TOP:0,RIGHT_TOP:1,LEFT_BOTTOM:2,RIGHT_BOTTOM:3,CENTER:4},GUILD_POST_INFO=["注意种族克制，战前换阵能有奇效","战斗中怒气集满可释放神器技能，一旦释放甚至可能扭转战局","公会采集可获得海量的高价值的奖励哦","冒险世界的探险，可遇见很多趣味的事情哦","英雄的星级越高，属性越强大哦","好友每天可以互赠友情点哦","神器激活后，佩戴后可以在战斗中释放超炫技能哦"],UNIQUE_REQ={},LOADING_TIPS=["注意种族克制，战前换阵能有奇效","战斗中怒气集满可释放神器技能，一旦释放甚至可能扭转战局","公会采集可获得海量的高价值的奖励哦","冒险世界的探险，可遇见很多趣味的事情哦","占领多个同样的矿产资源，提高产出效率哦","矿产资源有累计上限哦，别忘回来收菜啦","英雄的星级越高，属性越强大哦","好友每天可以互赠友情点哦","神器激活后，佩戴后可以在战斗中释放超炫技能哦","竞技场每天21点结算排名奖励","限时挑战通关就能获得神秘大礼哦","找不到目标，不知道做什么？不妨跟着红点一起走哦","多多收集英雄，激活羁绊一飞冲天","组队副本太难怎么办，让我们紧跟大神，老司机带带我","时空之门可把英雄置换成自己想要的英雄哦"],ACTIVITY_ENTRANCE={ACTIVITY:1,JINGCAI:2,HEFU:3,HOLIDAY:4,HOLIDAY2:5,HOLIDAY3:6,HOLIDAY4:7},GOAL_REWARD_DESC=((_h={})[ModuleGoalType.ArenaRank]="竞技场历史最高达到第%d名",_h[ModuleGoalType.Champion]="通关冠军之路第%d层",_h[ModuleGoalType.EdenCatch]="今日沙狐乐园捕捉%d次",_h[ModuleGoalType.Boss]="今日神兽挑战%d次",_h[ModuleGoalType.HandbookLevel]="图鉴总等级达到%d级",_h[ModuleGoalType.Gym]="通关%s",_h[ModuleGoalType.RefreshShop]="今日神秘商店刷新%d次",_h[ModuleGoalType.Fortress]="关卡挑战通关%d关",_h[ModuleGoalType.BattleSubway]="战斗地铁通关第%d关",_h[ModuleGoalType.GuildFortress]="公会副本通关%d章",_h[ModuleGoalType.ServerBossPlayerHonor]="今日世界BOSS个人荣誉达到%d",_h[ModuleGoalType.GuildLevelRank]="当前公会排名达到%d名",_h[ModuleGoalType.PlayerLevel]="玩家达到%d级",_h[ModuleGoalType.PlayerFightCap]="总战力达到%s战力",_h[ModuleGoalType.TeamFortress]="组队副本通过%d关",_h[ModuleGoalType.WorldKingLevel]="争霸赛达到%s段位",_h[ModuleGoalType.WildEncounter]="遭遇战当天挑战次数",_h[ModuleGoalType.ChallengeTeamCount]="天空塔挑战%d次",_h[ModuleGoalType.ChallengeRocketCount]="火箭军团挑战%d次",_h[ModuleGoalType.BattleZoneArenaBattle]="跨服竞技场挑战%d次",_h),REWARD_STATUS={AVAILABLE:1,CANBUY:2,GO_RECHARGE:3,UNAVAILABLE_BUY:4,UNAVAILABLE:5,RECEIVED:6,HASBUY:7,NEXT_REWARD:1008},COMMON_DIRECTION={UP:1,RIGHT:2,DOWN:3,LEFT:4},SOUND_EFF_TYPE={btn_tap:"sound_btn_tap_mp3",btn_tap_error:"sound_btn_tap_error_mp3",sound_beibao:"sound_beibao_mp3",sound_beibaohuanye:"sound_beibaohuanye_mp3",sound_chouka:"sound_chouka_mp3",sound_chouka_wuxingka:"sound_chouka_wuxingka_mp3",sound_dianjin:"sound_dianjin_mp3",sound_jiaobu:"sound_jiaobu_mp3",sound_jinjie:"sound_jinjie_mp3",sound_shengji:"sound_shengji_mp3",sound_shengli:"sound_shengli_mp3",sound_shengxing:"sound_shengxing_mp3",sound_shibai:"sound_shibai_mp3",sound_view_close:"sound_view_close_mp3"},SOUND_BGM_TYPE={zhu_cheng:"bgm_zhucheng_mp3",zhan_dou:"bgm_zhandou_mp3"},ACTIVITY_COMMON_UI_STYLE={baseItemScale:.72,img_oper:.8},BADGE_STATUS={ACTIVE:1,LEVEL_UP:2,ADVANCED:3,MAX_LEVEL:4},SHOP_NOT_ALLOW_TIPS={0:"无锁",1:"人物等级不足",2:"VIP等级不足",3:"竞技场排名不足",4:"公会等级不足",5:"未通关指定关卡",6:"未通关指定关卡",7:"探险时长不足",8:"未通关该道馆",9:"未达到该段位",10:"未满足通关层数",11:"累计挑战次数不足",12:"累计扭蛋次数不足"},ONLY_VIP=!0,HATCH_COLOR_PIC={3:"boss_icon_dan_06_png",4:"boss_icon_dan_09_png",5:"boss_icon_dan_03_png",6:"boss_icon_dan_05_png"},CHANGE_ARRAY_TYPE={HAVE:1,IS_NULL:2,LOCK:3},ACTIVITY_TO_MODULE={27:238,45:581,21:500},MULTI_CAMP_TO_COLOR={1:16722766,2:16771584,3:50943},MULTI_CAMP_TO_NAME={1:"红队",2:"黄队",3:"蓝队"},MULTI_CAMP_TO_SOURCE={1:"kuafu_img_yingdi_hong_png",2:"kuafu_img_yingdi_huang_png",3:"kuafu_img_yingdi_lan_png"},GUILD_NOTICE_LIMIT=["公会诚邀各位玩家，致敬最铁的我们。","是兄弟，就来战，一起打造属于我们最强的公会。","傲于天下，永不言败。兄弟情义，重聚在此。","本公会对各位给力玩家敞开大门，欢迎各位精灵训练师前来，共创辉煌。","公会有大量福利，希望各位活跃玩家前来，积极完成公会任务，打造第一公会。","我们都是精灵爱好者，不求第一，但求最好，欢迎各位玩家加入我们。","春夏秋冬，我们一直都会陪伴，这是属于我们暖心的家。","任他时光飞逝，也挡不住我们之间的热情，在这里，大家都是好朋友。"],EQUIPTYPE_TO_NAME=((_j={})[HeroEquipType.Weapon]="武器",_j[HeroEquipType.Armour]="铠甲",_j[HeroEquipType.Shoe]="鞋子",_j[HeroEquipType.Ornament]="饰品",_j),MODEL_ACTION_NAME={DJ:"daiji",GJ:"gongji",SJ:"shouji"},ROLE_ACTION_NAME={DJ:"daiji",PB:"paobu",GJ:"gongji",SJ:"shouji"},ROLE_ACTION_NAME_WHILE_H=((_k={})[ROLE_ACTION_NAME.DJ]="daiji_h",_k[ROLE_ACTION_NAME.PB]="daiji_h",_k[ROLE_ACTION_NAME.GJ]="gongji_h",_k[ROLE_ACTION_NAME.SJ]="daiji_h",_k),ROLE_STYLE={Fashion:1,Horse:2,Title:4,Magical:8},DETAIL_VIEW_SHOW_TYPE={ROLE:1,BACKPACK:2,OTHER:3},HEROTHING_ATTR_STYLE=[{size:21,textColor:15913814},{size:21,textColor:16775908},{size:21,textColor:16714810},{size:21,textColor:1761866},{size:21,textColor:9539985},{size:21,textColor:15913814}],TREASURE_ICON_NAME=((_l={})[TreasureJewelType.Atk]=["item_baoshi_01_png","攻击宝石"],_l[TreasureJewelType.Life]=["item_baoshi_02_png","生命宝石"],_l[TreasureJewelType.Crit]=["item_baoshi_03_png","暴击宝石"],_l[TreasureJewelType.Parry]=["item_baoshi_04_png","格挡宝石"],_l),TEAMEXPEMAP_POS={zdyz_bg_ditu_png:[[285,1003],[299,827],[489,747],[363,637],[115,667],[35,507],[215,406],[465,360],[338,245],[159,247]]},MAP_EP_TYPE_NAME={0:"空",1:"怪物",2:"副本",3:"迷宫",4:"酒馆",5:"商店",6:"宝箱",7:"答题npc",8:"矿产",9:"障碍",10:"传送门",11:"起点",12:"NPC",13:"选择奖励",14:"收集",15:"猜拳",16:"猜大小",17:"机关",20:"宝箱怪",21:"机关2",23:"矿战的矿",101:"BOSS",102:"怪物",103:"大怪物",104:"ICON",105:"大怪物2"},MAP_EP_TYPE_IMG_MNM={0:"",1:"_guaji_m_json.maoxian_icon_xiaoguai",2:"_guaji_m_json.maoxian_icon_fuben",3:"_guaji_m_json.maoxian_icon_migong",4:"_guaji_m_json.maoxian_icon_jiuguan",5:"_guaji_m_json.maoxian_icon_shangdian",6:"_guaji_m_json.maoxian_icon_baoxiang",7:"_guaji_m_json.maoxian_icon_datinpc",8:"_guaji_m_json.maoxian_icon_kuang",9:"",10:"_guaji_m_json.maoxian_icon_chuansongmen",11:"",12:"_guaji_m_json.maoxian_icon_duihuanpc",13:"_guaji_m_json.maoxian_icon_duihuanpc",14:"_guaji_m_json.maoxian_icon_duihuanpc",15:"_guaji_m_json.maoxian_icon_duihuanpc",16:"_guaji_m_json.maoxian_icon_duihuanpc",18:"_guaji_m_json.maoxian_icon_duihuanpc",19:"_guaji_m_json.maoxian_icon_xiaoguai",20:"_guaji_m_json.maoxian_icon_baoxiang",21:"_guaji_m_json.maoxian_icon_datinpc",22:"_guaji_m_json.maoxian_icon_shangdian",23:"_guaji_m_json.maoxian_icon_kuang",24:"_guaji_m_json.maoxian_icon_datinpc",101:"_guaji_m_json.maoxian_icon_guaiwu",102:"_guaji_m_json.maoxian_icon_guaiwu"},MAP_EP_GATE_IMG=((_m={})[GateType.Any]="_guaji_m_json.bd_rukou_01",_m[GateType.UpOne]="_guaji_m_json.bd_rukou_03",_m[GateType.UpTwo]="_guaji_m_json.bd_rukou_03",_m[GateType.DownOne]="_guaji_m_json.bd_rukou_03",_m[GateType.DownTwo]="_guaji_m_json.bd_rukou_03",_m[GateType.Quit]="_guaji_m_json.bd_rukou_01",_m),BASEITEM_SOURCE={BACKPACK:1,OTHER:2},PROPERTY_2_KEY=((_o={})[EPropertyType.EPropertyTypeDiamond]="diamond",_o[EPropertyType.EPropertyTypeGold]="gold",_o[EPropertyType.EPropertyTypeArena]="arena",_o[EPropertyType.EPropertyTypeDevote]="devote",_o[EPropertyType.EPropertyTypeBossHonor]="worldKingHonor",_o[EPropertyType.EPropertyTypeExpedition]="expedition",_o[EPropertyType.EPropertyTypeIntegralShop]="integralShopIntegral",_o[EPropertyType.EPropertyTypeSoul]="soul",_o[FriendGoodType.FriendPokeBall]="friendIntimacy",_o),HERO_SORT_ORDER=((_p={})[HeroProfessionType.Warrior]=1,_p[HeroProfessionType.Hunter]=2,_p[HeroProfessionType.Enchanter]=3,_p[HeroProfessionType.Pastor]=4,_p[HeroProfessionType.Assassinator]=5,_p),BTN_ICON_NOTICE_POS={percentX:.725,percentY:10/94},DB_SKIP_CACHE_FRAME={zhujiao_01:1,zhujiao_02:1,kuangren_1:1,kuangren_2:1,common_chouka:1,common_chouka_1:1,common_chouka_2:1,common_kapianfanzhuan:1,common_jiazai:1,common_sj:1,common_zhandouli:1,common_zhanbai_1:1,common_shengli_2:1,common_miwu:1,common_choukayingxiong:1,zhujiemian_bstz:1,zhujiemian_jjtz:1,zhujiemian_yxzh:1,denglu_01:1,denglu_02:1,common_dianji:1},FadeRiskEventType={Boss:101,Creep:102,BigBoss:103,ICON:104,BigBoss2:105},SHARE_RESOURCE_FILTER={},ZZQ_CONST={QIANPAI_NUM:3,SHANGZHEN_NUM:8,CARDS_NUM:5,BEIBAO_NUM:12,BEIBAO_LINE_EACH_COUNT:6,DAOJISHI_RED:5,TOUCH_AS_CLICK:200},DEEP_NEST_CONST={BEIBAO_LINE:2,SHANGZHEN_LINE:3,HERO_COUNT:6,TOUCH_TIME:150},HAS_RECHARGE_ACT_CODE=[EActivityType.FirstRecharge1,EActivityType.MonthCard,EActivityType.SecondOpenServerRecharge,EActivityType.SecondOpenServerRecharge1,EActivityType.SecondOpenServerRecharge2,EActivityType.SecondOpenServerRecharge3,EActivityType.SecondOpenServerRecharge4,EActivityType.SecondOpenServerRecharge5,EActivityType.SecondOpenServerRecharge6,EActivityType.SecondOpenServerRecharge7,EActivityType.SecondOpenServerRecharge8,EActivityType.SecondOpenServerRecharge9,EActivityType.SecondOpenServerRecharge10,EActivityType.SecondOpenServerRecharge11,EActivityType.SecondOpenServerRecharge12,EActivityType.DiscountGiftBag,EActivityType.DiscountGiftBag1,EActivityType.DiscountGiftBag2,EActivityType.DiscountGiftBag3,EActivityType.DiscountGiftBag4,EActivityType.DiscountGiftBag5,EActivityType.DiscountGiftBag6,EActivityType.DiscountGiftBag7,EActivityType.DiscountGiftBag8,EActivityType.DiscountGiftBag9,EActivityType.DiscountGiftBag10,EActivityType.DiscountGiftBag11,EActivityType.DiscountGiftBag12,EActivityType.DiscountGiftBag13,EActivityType.DiscountGiftBag14,EActivityType.DiscountGiftBag15,EActivityType.DiscountGiftBag16,EActivityType.DiscountGiftBag17,EActivityType.DiscountGiftBag18,EActivityType.DiscountGiftBag19,EActivityType.DiscountGiftBag20,EActivityType.DiscountGiftBag21,EActivityType.DiscountGiftBag22,EActivityType.DiscountGiftBag23,EActivityType.DiscountGiftBag24,EActivityType.DiscountGiftBag25,EActivityType.DiscountGiftBag26,EActivityType.DiscountGiftBagDaily,EActivityType.DiscountGiftBagDaily1,EActivityType.DiscountGiftBagDaily2,EActivityType.DiscountGiftBagDaily3,EActivityType.DiscountGiftBagDaily4,EActivityType.DiscountGiftBagDaily5,EActivityType.DiscountGiftBagDaily6,EActivityType.DiscountGiftBagDaily7,EActivityType.DiscountGiftBagDaily8,EActivityType.DiscountGiftBagDaily9,EActivityType.DiscountGiftBagDaily10,EActivityType.WeekGift,EActivityType.MonthGift,EActivityType.EnjoyCard,EActivityType.EnjoyCard1,EActivityType.EnjoyCard2,EActivityType.EnjoyCard3,EActivityType.EnjoyCard4,EActivityType.TriggerGifts,EActivityType.BraveBook,EActivityType.WholeLifeCard,EActivityType.DailyLuxuryGifts,EActivityType.DailyLuxuryGifts1,EActivityType.DailyLuxuryGifts2,EActivityType.DailyLuxuryGifts3,EActivityType.DailyLuxuryGifts4,EActivityType.VipLevelGift,EActivityType.VipWelfare,EActivityType.OneYuanGifts,EActivityType.SixtyEightYuanGifts,EActivityType.OneYuanGifts2,EActivityType.NewYearWeekCrad,EActivityType.NewBraveBook,EActivityType.ThirdOpenServerRecharge,EActivityType.ThirdOpenServerRecharge1,EActivityType.ThirdOpenServerRecharge2,EActivityType.FourthOpenServerRecharge,EActivityType.FourthOpenServerRecharge1,EActivityType.FourthOpenServerRecharge2,EActivityType.FourthOpenServerRecharge3,EActivityType.RechargeRotate,EActivityType.RechargeRotate1,EActivityType.BasicHeroGifts,EActivityType.WishGifts,EActivityType.WishGifts1,EActivityType.WishGifts2,EActivityType.WishGifts3,EActivityType.WishGifts4,EActivityType.WishGifts5,EActivityType.WishGifts6,EActivityType.WishGifts7,EActivityType.WishGifts8,EActivityType.WishGifts9,EActivityType.WishGifts10,EActivityType.WishGifts11,EActivityType.EnjoyCard,EActivityType.EnjoyCard1,EActivityType.EnjoyCard2,EActivityType.EnjoyCard3,EActivityType.EnjoyCard4,EActivityType.EnjoyCard5],MULTI_TEAM_MODULE_NAME=((_q={})[MODULE.AbyssLair]="深渊巢穴",_q[MODULE.Manor]="矿战",_q),G_REWARD_NAME=["rewards","heros","heroEquips","heroArtifacts","pets","maps"],ENTITY_2_NAME=((_r={})[EEntityType.EEntityTypeHero]="英雄",_r[EEntityType.EEntityTypeHeroEquip]="装备",_r[EEntityType.EEntityTypeHeroArtifact]="圣物",_r[EEntityType.EEntityTypeTreasure]="宝物",_r),HERO_TIER_IMG_TAG=["_hero_ar_m_json.common_img_chuanshuo","_hero_ar_m_json.common_img_jingying","_hero_ar_m_json.common_img_xiyou"],PEAK_WAR_TYPE={FREE:1,HIGH:2,HIGH_WAITING:3,HIGH_END:4},BaseTab=function(t){function e(){var e=t.call(this)||this;return e._CLASS_NAME_="BaseTab",e}return __extends(e,t),e.prototype.viewType=function(){return this._CLASS_NAME_},e.prototype.getParentView=function(){return GameRootLayer.gameLayer().tabLayer},e}(BaseView);__reflect(BaseTab.prototype,"BaseTab");var SDKMgr=function(t){function e(){var e=t.call(this)||this;return e.performConfig={},e.needNodeRecrod=!1,e.gIAPRate=void 0,e.gIAPSuffix=void 0,e}return __extends(e,t),e.prototype.getPerformConfig=function(e){if(1!=e&&null!=this.performConfig[e])return this.performConfig[e];var t=!1;return Utils.agentConfig.isChecking&&(0==e?t=Utils.agentConfig.isChecking.ResChange:5==e?t=Utils.agentConfig.isChecking.ResChange_Login:1==e?(t=Utils.agentConfig.isChecking.Recharge,null!=getUrlKV().isCheckingRecharge&&(t=t&&getUrlKV().isCheckingRecharge)):2==e?t=Utils.agentConfig.isChecking.PHP:3==e?t=Utils.agentConfig.isChecking.Coupon:4==e?t=Utils.agentConfig.isChecking.ReqSDKPayTips:6==e?(t=Utils.agentConfig.isChecking.EffectYange,"test"==Utils.agentConfig.AgentCode&&(t=0==Utils.MathUtils.getRandomInt(0,1))):7==e?t=Utils.agentConfig.isChecking.DelayPopNoticePanel:8==e?t=Utils.agentConfig.isChecking.HideLoginLogo:9==e?t=Utils.agentConfig.isChecking.SwitchZzq:10==e?t=Utils.agentConfig.isChecking.SwitchAvatar:11==e?t=Utils.agentConfig.isChecking.FPS:12==e?t=Utils.agentConfig.isChecking.PopUpdateLog:13==e?t=Utils.agentConfig.isChecking.CheckTextVaildCommon:14==e?t=Utils.agentConfig.isChecking.CheckTextVaildRename:15==e?t=Utils.agentConfig.isChecking.Switch_ShouCangYouLi:16==e?(t=Utils.agentConfig.isChecking.Switch_Share,null!=getUrlKV().Switch_Share&&(t=t&&getUrlKV().Switch_Share)):17==e?t=Utils.agentConfig.isChecking.CloseGuide:18==e?t=Utils.agentConfig.isChecking.CloseAutoLoginWhenNoRole:19==e?t=Utils.agentConfig.isChecking.RechargePopGZGZH:20==e?t=Utils.agentConfig.isChecking.ForceMaintainTips:21==e?t=Utils.agentConfig.isChecking.RechargeHideRechargeAct:22==e?t=Utils.agentConfig.other.LoginBgRes:23==e?t=Utils.agentConfig.isChecking.HideSysSetting:36==e?t=Utils.agentConfig.isChecking.ForceCloseFilter:24==e?t=Utils.agentConfig.isChecking.GuildPost:25==e?t=Utils.agentConfig.isChecking.ShowLoginInfo:26==e?t=Utils.agentConfig.other.ShowLoginInfoDetail:27==e?t=Utils.agentConfig.isChecking.HideAllFenXiangWord:28==e?t=Utils.agentConfig.isChecking.HideKefuBtn:29==e?t=Utils.agentConfig.isChecking.HideSwitchLoginBtn:30==e?t=Utils.agentConfig.isChecking.RenameReplaceLegal:32==e?t=Utils.agentConfig.isChecking.HideChatSend:20001==e?t=Utils.agentConfig.isChecking.check_isqqxyx:31==e?t=Utils.agentConfig.isChecking.HideSwitchPerformanceBtn:33==e?t=Utils.agentConfig.isChecking.CloseAuthorize:10018==e?t=Utils.agentConfig.isChecking.isQQ:10021==e?t=Utils.agentConfig.isChecking.isExtra:34==e?t=Utils.agentConfig.isChecking.HideAccountBtn:1016==e?(t=Utils.agentConfig.isChecking.SwitchMicDownload,null!=getUrlKV().SwitchMicDownload&&(t=t&&getUrlKV().SwitchMicDownload)):1026==e?(t=Utils.agentConfig.isChecking.SwitchGuanzhu,null!=getUrlKV().SwitchGuanzhu&&(t=t&&getUrlKV().SwitchGuanzhu)):2016==e?t=Utils.agentConfig.isChecking.HideShareFriendConnect:35==e?t=Utils.agentConfig.other.TimeEachSendYQM:200001==e?t=Utils.agentConfig.other.ADS_IMG_ARR:200004==e?t=Utils.agentConfig.other.FIRST_GUIDE_END_IMG_ARR:37==e?t=Utils.agentConfig.isChecking.CLOSE_GUIDE_MANHUA:38==e?t=Utils.agentConfig.isChecking.SWITCH_DUNGEON:39==e?t=Utils.agentConfig.isChecking.SWITCH_CHOUKA_SHUOMING:40==e?t=Utils.agentConfig.isChecking.SWITCH_MULTI_GUAJI:200002==e?t=Utils.agentConfig.other.GZGZH_FULL_PIC:41==e?t=Utils.agentConfig.isChecking.SWITCH_FLOW_WINDOW:200003==e?t=Utils.agentConfig.other.LOGO_PIC:42==e?t=Utils.agentConfig.isChecking.SWITCH_USER_XIEYI:43==e?t=Utils.agentConfig.isChecking.SWITCH_MIC_KILL_POCESS_WHEN_RESTART:44==e?t=Utils.agentConfig.isChecking.HIDE_PINGLUN:200005==e&&(t=Utils.agentConfig.other.GZGZH_NAME)),this.performConfig[e]=t},e.prototype.extraFuncForAgent=function(e){return!1},Object.defineProperty(e.prototype,"globalIAPRate",{get:function(){return null==this.gIAPRate&&(Utils.agentConfig.other&&Utils.agentConfig.other.globalRate?this.gIAPRate=Number(Utils.agentConfig.other.globalRate):this.gIAPRate=1),this.gIAPRate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalIAPSuffix",{get:function(){return null==this.gIAPSuffix&&(Utils.agentConfig.other&&Utils.agentConfig.other.unit?this.gIAPSuffix=Utils.agentConfig.other.unit:this.gIAPSuffix="元"),this.gIAPSuffix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCloseIAPByAgent",{get:function(){return 1==getUrlKV().isCheckingRecharge},enumerable:!0,configurable:!0}),e}(BaseClass);__reflect(SDKMgr.prototype,"SDKMgr"),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.backpackProxy=o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N),t}return __extends(n,i),Object.defineProperty(n.prototype,"rootView",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.BackpackUI),this.addSubView(n.SV.DECOMPOSE,o.DecomposeUI),this.addSubView(n.SV.HEROROLLBACKVIEW,o.HeroRollBackView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.BACKPACK_UPDATE,CN.LOGIN_FINAL_DONE,CN.GENERAL_PASS_DAY,CN.BACKPACK_MULTI_TEAM_UPDATE,CN.CHANGE_PANEL]},n.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView(),this.removeFromParent(),this.rootView&&(this.rootView.visible=!1);break;case CN.GENERAL_PASS_DAY:case CN.LOGIN_FINAL_DONE:this.backpackProxy.GetPlayerItem(),this.backpackProxy.GetTeamInfo(),this.backpackProxy.GetDecomposeInfo();break;case CN.BACKPACK_UPDATE:o.AppFacade.getInstance().updateView(n.N,n.SV.MAIN);break;case CN.BACKPACK_MULTI_TEAM_UPDATE:this.backpackProxy.resetHeroUuid2ModuleTeamCache();break;case CN.CHANGE_PANEL:var i=this.getSubView(n.SV.DECOMPOSE);if(!i)return;t&&t.isRemove?i.onOtherPanelPopup(!1):i.onOtherPanelPopup(!0)}},n.prototype.handleNotice=function(){},n.N="BackpackMediator",n.SV={MAIN:1,DECOMPOSE:2,HEROROLLBACKVIEW:3},n}(BaseMediator);o.BackpackMediator=e,__reflect(e.prototype,"game.BackpackMediator")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.valid=!0,e}return __extends(e,t),e.prototype.tileXYChange=function(){t.prototype.tileXYChange.call(this),this.zorder+=1},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.onAfterWalk=function(){},e.prototype.onWalking=function(){},e.prototype.onChangingDir=function(e){},e.prototype.resetWalk=function(){this.tileX=this.lastTileX,this.tileY=this.lastTileY},e.prototype.switchDir=function(e,t){this.onChangingDir(this.calDir(e,t))},e.prototype.calDir=function(e,t){null==this.lastTileX&&(this.lastTileX=this.tileX),null==this.lastTileY&&(this.lastTileY=this.tileY);var i=3;return e>this.lastTileX?i=1:e<this.lastTileX?i=0:t>this.lastTileY?i=3:t<this.lastTileY&&(i=2),i},e.prototype.walkToTile=function(e,t){this.tileX==e&&this.tileY==t||this.isMoving||this.checkPosValid(e,t)&&(this.lastTileX||(this.lastTileX=this._tileX),this.lastTileY||(this.lastTileY=this._tileY),this.lastTileX=this.tileX,this.lastTileY=this.tileY,this.onChangingDir(this.calDir(e,t)),this.tileX=e,this.tileY=t,this.onWalking())},e}(e.MapObj);e.Npc=t,__reflect(t.prototype,"game.Npc")}(game||(game={})),function(l){var e=function(i){function c(e){void 0===e&&(e=null);var t=i.call(this,c.N,e)||this;return t.shopProxy=l.AppFacade.getInstance().retrieveProxy(l.ShopPy.N),t.initNotice(),t}return __extends(c,i),c.prototype.initNotice=function(){},c.prototype.initSubView=function(){this.addSubView(c.SV.COMMON_SHOP,l.ShopUI),this.addSubView(c.SV.SHOP_BUY_NUM,l.ShopBuyNumView),this.addSubView(c.SV.REFRESH_SHOP,l.ShopRefreshView),this.addSubView(c.SV.SHOP_SELL_NUM,l.ShopSellNumView)},c.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.SHOP_GET_ALL_DATA,CN.SHOP_OPEN_BY_TYPE,CN.SHOP_INFO_UPDATE,CN.PLAYER_LEVEL_UP,CN.LOGIN_FINAL_DONE,CN.MONEY_UPDATE]},c.prototype.handleNotification=function(e){var t=this,i=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView(),this.removeFromParent();break;case CN.SHOP_GET_ALL_DATA:var n=function(e){Utils.FlowUtils.insertCbAfterQueue(function(){t.shopProxy.GetShopInfo(ShopType[e],function(){Utils.FlowUtils.updateCbQueue(!0)})})};for(var o in ShopType)n(o);break;case CN.SHOP_OPEN_BY_TYPE:if(!i.shopType)return;this.shopProxy.curShopType=i.shopType;var a=l.Config.shopWork(this.shopProxy.curShopType);this.shopProxy.GetShopInfo(this.shopProxy.curShopType,function(){t.hideSubView(c.SV.COMMON_SHOP),t.hideSubView(c.SV.REFRESH_SHOP),i.workType=a.workType,-1!=[ShopWorkType.FreeAndBuyRefresh,ShopWorkType.NoneGridRefresh].indexOf(a.workType)?t.showSubView(c.SV.REFRESH_SHOP,i):t.showSubView(c.SV.COMMON_SHOP,i)});break;case CN.SHOP_INFO_UPDATE:var r=l.Config.shopWork(this.shopProxy.curShopType);-1!=[ShopWorkType.FreeAndBuyRefresh,ShopWorkType.NoneGridRefresh].indexOf(r.workType)?this.updateView(c.SV.REFRESH_SHOP,i):this.updateView(c.SV.COMMON_SHOP,i);break;case CN.PLAYER_LEVEL_UP:this.shopProxy.showRefreshShopNotice();case CN.LOGIN_FINAL_DONE:this.shopProxy.GetShopInfo(ShopType.ShopTypeShare);case CN.MONEY_UPDATE:var s=this.getSubView(c.SV.REFRESH_SHOP);s&&s.updateView({})}},c.prototype.onViewCreate=function(){},c.prototype.handleNotice=function(e){},c.N="ShopyMediator",c.SV={COMMON_SHOP:1,SHOP_BUY_NUM:2,REFRESH_SHOP:3,SHOP_SELL_NUM:4},c}(BaseMediator);l.ShopyMediator=e,__reflect(e.prototype,"game.ShopyMediator")}(game||(game={}));var BasePanel=function(t){function e(){var e=t.call(this)||this;return e._popActionType=1,e._CLASS_NAME_="BasePanel",e}return __extends(e,t),e.prototype.viewType=function(){return this._CLASS_NAME_},e.prototype.getParentView=function(){return GameRootLayer.gameLayer().panelLayer},e}(BaseView);__reflect(BasePanel.prototype,"BasePanel");var ModuleStyle=function(){function e(){}return e.LOADING={},e.LOGIN={},e.MAIN={mainUIStyle:65535},e.FIGHT={mainUIStyle:0},e.GUAJI={mainUIStyle:83},e.CITY={mainUIStyle:65535},e.HERO={mainUIStyle:2},e.BACKPACK={mainUIStyle:3},e.GUILD={mainUIStyle:2},e.ZZQ={mainUIStyle:0},e.DUNGEON={mainUIStyle:0},e}();__reflect(ModuleStyle.prototype,"ModuleStyle");var NT=function(){function t(){}return t.getId=function(){return++t.__id__},t.makeCommonActivityType=function(){for(var e in EActivityType)t.ALL_ACTIVITY[EActivityType[e]]=t.getId()},t.initDynamic=function(){t.makeCommonActivityType()},t.__id__=0,t.LOCAL_RES_UPDATE_SENSITIVE_EVENT=((_a={})[EEntityType.EEntityTypeMoney]={cb:function(){},mediators:[game.ShopyMediator.N]},_a[EEntityType.EEntityTypeExp]={mediators:[]},_a[EEntityType.EEntityTypeItem]={cb:function(){NoticeManager.updateNotice(t.BACKPACK_CHIP)},sub:(_b={},_b[30000018]={cb:function(){NoticeManager.updateNotice(t.ALL_ACTIVITY[EActivityType.LuckyRotate])},mediators:[]},_b[30001001]={cb:function(){NoticeManager.updateNotice(t.ALL_ACTIVITY[EActivityType.ItemGifts])},mediators:[]},_b[30001057]={cb:function(){NoticeManager.updateNotice(t.ALL_ACTIVITY[EActivityType.EatingZongZi])},mediators:[]},_b[30001058]={cb:function(){NoticeManager.updateNotice(t.ALL_ACTIVITY[EActivityType.EatingZongZi])},mediators:[]},_b[30001059]={cb:function(){NoticeManager.updateNotice(t.ALL_ACTIVITY[EActivityType.EatingZongZi])},mediators:[]},_b[30000027]={cb:function(){NoticeManager.updateNotice(t.SMITHY)},mediators:[]},_b[30000030]={cb:function(){NoticeManager.updateNotice(t.COMMON_SHOP[ShopType.ShopTypeShare])},mediators:[]},_b[30001022]={cb:function(){NoticeManager.updateNotice(t.ALL_ACTIVITY[EActivityType.NewYearChallenge])},mediators:[]},_b[30001056]={cb:function(){NoticeManager.updateNotice(t.ALL_ACTIVITY[EActivityType.DragonBoatGrade])},mediators:[]},_b[30000031]={cb:function(){NoticeManager.updateNotice(t.ALL_ACTIVITY[EActivityType.ActivityGashapon]),NoticeManager.updateNotice(t.ALL_ACTIVITY[EActivityType.ActivityGashapon1])},mediators:[]},_b[30000029]={cb:function(){NoticeManager.updateNotice(t.HERO_THING_COMPOUND)},mediators:[]},_b[30005002]={cb:function(){NoticeManager.updateNotice(t.HERO_DERMA)},mediators:[]},_b[30005001]={cb:function(){NoticeManager.updateNotice(t.HERO_DERMA)},mediators:[]},_b[30005003]={cb:function(){NoticeManager.updateNotice(t.HERO_DERMA)},mediators:[]},_b),mediators:[game.BackpackMediator.N]},_a[EEntityType.EEntityTypeHero]={mediators:[]},_a[EEntityType.EEntityTypeHeroEquip]={mediators:[]},_a[EEntityType.EEntityTypeHeroArtifact]={mediators:[]},_a[EEntityType.EEntityTypeTreasure]={mediators:[]},_a[EEntityType.EEntityTypePet]={mediators:[]},_a),t.HERO_UPSECTION=t.getId(),t.HERO_CAN_FORMATION=[t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId()],t.HERO_UPSTAIR=t.getId(),t.HERO_RESONATE=t.getId(),t.HERO_RESONATE_RESONATE=t.getId(),t.HERO_RESONATE_UNLOCK=t.getId(),t.HERO_EQUIP=[t.getId(),t.getId(),t.getId(),t.getId()],t.HERO_ARTIFACT=t.getId(),t.HERO_ARTIFACT_RESONATE=t.getId(),t.HERO_TREASURE=t.getId(),t.HERO_THING=t.getId(),t.HERO_THING_COMPOUND=t.getId(),t.HERO_DERMA=t.getId(),t.HERO_SPIRIT=t.getId(),t.HERO_SPIRIT_ACHIEVEMENT=t.getId(),t.HERO_SPIRIT_PAGE=t.getId(),t.MAGICAL=t.getId(),t.PET=t.getId(),t.PET_UPGRADE=t.getId(),t.PET_SKILL_UPGRADE=t.getId(),t.VIP_MAIN=t.getId(),t.VIP_ENTRANCE=t.getId(),t.VIP_GIFT=t.getId(),t.GASHA_ENTRANCE=t.getId(),t.STAR_DOOR_ENTRANCE=t.getId(),t.GASHA_FREE=t.getId(),t.GASHA_HIGH_TIMES=t.getId(),t.GASHA_RACE_TIMES=t.getId(),t.GOLDHAND=t.getId(),t.CITY_COPY_ENTRANCE=t.getId(),t.DAILY_COPY=t.getId(),t.EXPEDITION=t.getId(),t.EXPEDITION_REWARD=t.getId(),t.EXPEDITION_CHALLENGE=t.getId(),t.GUILD_MANAGER=t.getId(),t.GUILD_SIGNIN=t.getId(),t.GUILD_APPLY=t.getId(),t.GUILD_INSTANCE=t.getId(),t.GUILD_COLLECT=t.getId(),t.GUILD_WAR=t.getId(),t.GUILD_TRIBE_BATTLE=t.getId(),t.GUILD_TRIBE_BATTLE_CHALLENGE=t.getId(),t.GUILD_TRIBE_BATTLE_REWARD=t.getId(),t.BACKPACK_CHIP=t.getId(),t.TITLE=t.getId(),t.FRIEND=t.getId(),t.FRIEND_GIFT=t.getId(),t.FRIEND_APPLY=t.getId(),t.ACTIVITY_ENTRANCE=[void 0,t.getId(),t.getId(),t.getId(),t.getId(),t.getId()],t.ALL_ACTIVITY=[void 0],t.ACTIVITY_EnjoyCard1=t.getId(),t.ACTIVITY_MAGPIE_TASK=t.getId(),t.ACTIVITY_MAGPIE_TIME=t.getId(),t.ACTIVITY_MID_CREAT=t.getId(),t.ACTIVITY_MID_EAT=t.getId(),t.ACTIVITY_MID_GET=t.getId(),t.ACTIVITY_MID_GIFT=t.getId(),t.TASK_ENTRANCE=t.getId(),t.DAILY_TASK=t.getId(),t.ACHIEVEMENT=t.getId(),t.SECOND_ACHIEVEMENT=t.getId(),t.MAIL=t.getId(),t.CHAMPION=t.getId(),t.CHAT_MAIN=t.getId(),t.CHAT_MAIN2=t.getId(),t.CHAT_ZONE=t.getId(),t.CHAT_SAME_SERVER=t.getId(),t.CHAT_GUILD=t.getId(),t.CHAT_PRIVATE=t.getId(),t.COMMON_SHOP=[t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId()],t.BRAVABOOK=t.getId(),t.NEWBRAVABOOK=t.getId(),t.LUCKY_TABLE=t.getId(),t.CITY_PVP_ENTRANCE=t.getId(),t.ARENA=t.getId(),t.ARENA_REWARD=t.getId(),t.ARENA_REWARD_LINQU=t.getId(),t.WORLD_KING=t.getId(),t.WORLD_KING_REWARD=t.getId(),t.WORLD_KING_TIMES_OR_CHEST=t.getId(),t.TEAM_EXPE_REWARD_ENTRANCE=t.getId(),t.TEAM_EXPE_REWARD=t.getId(),t.TEAM_EXPE_APPLY_CENTER=t.getId(),t.TEAM_EXPE_APPLY_BTN=t.getId(),t.TEAM_ARENA_ENTRANCE=t.getId(),t.TEAM_ARENA_APPLY=t.getId(),t.TEAM_ARENA_APPLY_CENTER=t.getId(),t.TEAM_ARENA_ENROLL=t.getId(),t.TEAM_ARENA_VOTE=t.getId(),t.SMITHY_ENTRANCE=t.getId(),t.SMITHY=t.getId(),t.WORLD_BOSS=t.getId(),t.WORLD_BOSS_NUM=t.getId(),t.WORLD_BOSS_REWARD=t.getId(),t.GUILD_BOSS=t.getId(),t.GUILD_BOSS_NUM=t.getId(),t.FRIEND_SHARE_REWARD=[t.getId(),t.getId(),t.getId(),t.getId(),t.getId()],t.FRIEND_SHARE_DAY_FIRST_SHARE=t.getId(),t.HERO_CHALLENGE=t.getId(),t.ZZQ_ACHIEVELEVEL=t.getId(),t.DEEP_NEST=t.getId(),t.DEEP_NEST_REWARD=t.getId(),t.DUNGEON=t.getId(),t.ZONE_BOSS_ENTRANCE=t.getId(),t.ZONE_BOSS_TEAMHALL=t.getId(),t.ZONE_BOSS_SOMEAPPLY=t.getId(),t.ZONE_BOSS_FIRSTLOGIN=t.getId(),t.MANOR_ENTRANCE=t.getId(),t.CITY_EXT_ENTRANCE=t.getId(),t.STORM_WAR=t.getId(),t.STORM_WAR_ACHIEVE=t.getId(),t.GUAJI_MULTI=t.getId(),t.FASHION=t.getId(),t.FASHION_ACTIVATION=t.getId(),t.FASHION_UPGRADE=t.getId(),t.GUAJI_GZGZH=t.getId(),t.GUAJI_GZGZH2=t.getId(),t.GUAJI_GZGZH3=t.getId(),t.PEAK_WAR=t.getId(),t.PEAK_WAR_REWARD_FREE=t.getId(),t.PEAK_WAR_REWARD_FREE_TAB=t.getId(),t.PEAK_WAR_CHALLENGE=t.getId(),t.MOUNT=t.getId(),t.MOUNT_ACTIVATE=t.getId(),t.MOUNT_UPDATE=t.getId(),t.MOUNT_UPSTAR=t.getId(),t}();__reflect(NT.prototype,"NT"),function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(e){this.id=e.id,this.life=e.life,this.status=e.status,this.dt=e.dt,this.num=e.num,this.owner=e.owner,this.ownerName=e.ownerName,this.guildName=e.guildName},t}(e.BaseVO);e.BossVO=t,__reflect(t.prototype,"game.BossVO")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e._itemWidth=0,e.dataProvider=[],e.initDataProvider=!1,e.initItemrender=!1,e.inTween=!1,e.childIndexCash=[],e.lastSelectIndex=-1,e.lastSelectIndex2=-1,e.lastScrollerH=0,e.scrollerH=0,e.onClickValidInterval=.1,e.skinName="scroller2p0",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.sl_root.scrollPolicyV=eui.ScrollPolicy.OFF,this.sl_root.bounces=!1,this.sl_root.throwSpeed=.3,this.gp_paddingLeft.childIndexCash=-1,this.gp_paddingRight.childIndexCash=99999,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.inTween&&(egret.Tween.removeTweens(e.sl_root.viewport),e.inTween=!1)},this),this.sl_root.addEventListener(eui.UIEvent.CHANGE_END,this.onSHChangeEnd,this),this.sl_root.addEventListener(eui.UIEvent.CHANGE,this.onSHChange,this)},Object.defineProperty(e.prototype,"itemRenderer",{get:function(){return this._itemRenderer},set:function(e){this._itemRenderer=e,this.initItemrender=!0,this._itemWidth=e.itemWidth,this.updatePaddingGroup()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"gap",{get:function(){return this._gap},set:function(e){this._gap=e,this.updatePaddingGroup()},enumerable:!0,configurable:!0}),e.prototype.setDataProvider=function(e,t){void 0===t&&(t=!0),this.dataProvider=e,this.initDataProvider=!0,this.updateList(t)},e.prototype.setItemTapEvent=function(e,t){this.itemTapCB=e,this.itemTapCB_thisObj=t},e.prototype.updatePaddingGroup=function(){this.initItemrender&&(this.gp_paddingRight.width=this.gp_paddingLeft.width=(this.width-this._itemWidth)/2)},e.prototype.updateList=function(e){var i=this;if(void 0===e&&(e=!0),this.initDataProvider&&this.initItemrender){this.inTween&&(egret.Tween.removeTweens(this.sl_root.viewport),this.inTween=!1);for(var n=this._gap||0,o=this.gp_paddingLeft.width,a=this.dataProvider.length,t=function(e){var t;e==r.gp_list.$children.length-1?((t=new r.itemRenderer).verticalCenter=0,r.gp_list.addChildAt(t,e)):t=r.gp_list.$children[e],r.once(egret.Event.ENTER_FRAME,function(){t.x=o+(e-1)*i._itemWidth+(e-1)*n,t.dataChildIndex=e-1,t.data=i.dataProvider[e-1],t.dataChanged(),e==a&&(i.gp_paddingRight.x=t.x+i._itemWidth,i.onSHChange())},r)},r=this,s=1;s<=a;s++)t(s);this.gp_list.$children.length-2>this.dataProvider.length&&this.gp_list.$children.splice(this.dataProvider.length+1,this.dataProvider.length-this.gp_list.$children.length-2),e&&(this.sl_root.viewport.scrollH=0)}},e.prototype.callItemTapCB=function(e){this.itemTapCB&&this.itemTapCB.call(this.itemTapCB_thisObj,{itemIndex:e})},e.prototype.refresh=function(){this.updateList(!1)},e.prototype.getItemAt=function(e){return this.gp_list.$children[e+1]?this.gp_list.$children[e+1]:null},e.prototype.onSHChange=function(){this.caculateChildrenIndexList(),this.sortChildren();for(var e=this.gp_list.$children.length,t=1;t<e-1;t++)this.gp_list.$children[t].onScrollHChange()},e.prototype.onSHChangeEnd=function(){var e=this,t=this.caculateCurIndex();console.log("onSHChangeEnd",t,this.lastSelectIndex2,this.lastScrollerH,this.sl_root.viewport.scrollH),t==this.lastSelectIndex2&&(this.lastScrollerH>this.sl_root.viewport.scrollH?t--:this.lastScrollerH<this.sl_root.viewport.scrollH&&t++),this.tweenTo(t,function(){e.lastSelectIndex2=t})},e.prototype.caculateChildrenIndexList=function(){var i=this,n=this._itemWidth/2-this.sl_root.viewport.scrollH-this.width/2,e=this.gp_list.$children.length,o=2/this.width;if(2<e)for(var t=function(e){a.childIndexCash[e]=Math.abs(a.gp_list.$children[e].x+n)*o;var t=a.gp_list.$children[e].dataChildIndex;a.childIndexCash[e]<a.onClickValidInterval&&a.lastSelectIndex!=t&&(a.inTween?a.tweenDoneCB=function(){i.lastSelectIndex=t,i.callItemTapCB(t)}:(a.lastSelectIndex=t,a.callItemTapCB(t))),a.gp_list.$children[e].childIndexCash=a.childIndexCash[e]},a=this,r=1;r<e-1;r++)t(r)},e.prototype.sortChildren=function(){this.gp_list.$children.sort(function(e,t){return t.childIndexCash-e.childIndexCash})},e.prototype.tweenTo=function(e,t){var i=this;this.inTween&&(egret.Tween.removeTweens(this.sl_root.viewport),this.inTween=!1),e<0&&(e=0),e>this.dataProvider.length-1&&(e=this.dataProvider.length-1);var n=this.gp_paddingLeft.width+e*(this._itemWidth+this._gap)+this._itemWidth/2-this.width/2;this.inTween=!0,console.log("tween target",n),egret.Tween.get(this.sl_root.viewport,{onChange:this.onSHChange,onChangeObj:this}).to({scrollH:n},800,egret.Ease.cubicOut).call(function(){i.inTween=!1,i.lastScrollerH=n,i.tweenDoneCB&&(i.tweenDoneCB(),i.tweenDoneCB=void 0),t&&t()},this)},e.prototype.jumpTo=function(e,t){this.inTween&&(egret.Tween.removeTweens(this.sl_root.viewport),this.inTween=!1),e<0&&(e=0),e>this.dataProvider.length-1&&(e=this.dataProvider.length-1);var i=this.gp_paddingLeft.width+e*(this._itemWidth+this._gap)+this._itemWidth/2-this.width/2;this.sl_root.viewport.scrollH=i,this.lastScrollerH=i,this.lastSelectIndex2=e,this.onSHChange(),t&&t()},e.prototype.caculateCurIndex=function(){for(var e=9999,t=0,i=this.gp_list.$children.length,n=1;n<i-1;n++){var o=this.gp_list.$children[n].childIndexCash;o<e&&(e=o,t=this.gp_list.$children[n].dataChildIndex)}return t},e}(eui.Component);e.scroller2p0=t,__reflect(t.prototype,"customui.scroller2p0",["eui.UIComponent","egret.DisplayObject"]);var i=function(t){function e(){var e=t.call(this)||this;return e.maxScale=1,e.minScale=.8,e.childIndexCash=0,e.dataChildIndex=0,e}return __extends(e,t),e.prototype.onScrollHChange=function(){if(1.5<this.childIndexCash)this.visible=!1;else{this.visible=!0;var e=(this.maxScale-this.minScale)*(1-this.childIndexCash)+this.minScale;e<this.minScale&&(e=this.minScale),this.gp_scale.scaleX=this.scaleY=e}},e.prototype.dataChanged=function(){},e}(eui.Component);e.scroller2p0Item=i,__reflect(i.prototype,"customui.scroller2p0Item")}(customui||(customui={}));var WebMgr=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this.getChannelName()},e.prototype.callJS=function(e){if(egret.log("WebMgr",e),e){var t=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N);game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N);try{var i=JSON.parse(e);switch(i.method){case"loginCB":i.login_ext&&(t.userVO.login_ext=i.login_ext),Utils.isNeedUuidSot?t.userVO.uuid=i.game_uin+"_uuidsot"+Utils.TimerManager.getServerTime():t.userVO.uuid=i.game_uin,i.username?t.userVO.username=Utils.Http.checkStrLegal(i.username,!1,""):t.userVO.username=t.userVO.uuid,t.userVO.verify_token=i.verify_token,t.userVO.login_ext&&t.userVO.login_ext.isCheckingRecharge&&(Utils.agentConfig.isChecking.Recharge=t.userVO.login_ext.isCheckingRecharge),t.goHttpLogin();break;case"buyCB":0===i.payResult?Utils.MsgUtils.addMidMsg("购买成功，请稍后查收邮件"):i.payResultMsg&&""!=i.payResultMsg&&Utils.MsgUtils.addMidMsg(i.payResultMsg);break;case"onGoLogout":case"onGoSwitchUser":break;case"getChannelName":egret.log("getChannelName has set",Utils.agentConfig.channelName,i.channelName),Utils.agentConfig.channelName&&""!=Utils.agentConfig.channelName||(Utils.agentConfig.channelName=i.channelName||"")}}catch(e){egret.log("WebMgr exception",e)}}},e.prototype.goSwitchAccount=function(){-1===game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N).userVO.loginState?this.goLogin():Utils.SDKMgr.cmd({type:"SwitchAccount"})},e.prototype.onLoginPHPSuccess=function(){},e.prototype.showLoadingTips=function(e,t){},e.prototype.dismissLoading=function(){},e.prototype.goLogin=function(){var e=this;login({cb:function(){egret.log("html登录回调"),egret.log(getUrlKV()),e.callJS(JSON.stringify({method:"loginCB",game_uin:getUrlKV().game_uin,username:getUrlKV().username||getUrlKV().game_uin,verify_token:getUrlKV().token,login_ext:getUrlKV().login_ext}))}})},e.prototype.invokeLog=function(e){},e.prototype.goPurchase=function(e){sdkPay(e)},e.prototype.restart=function(){restart()},e.prototype.cmd=function(e,t){cmd(e,t)},e.prototype.copyToClipBoard=function(e,t){Utils.DeviceUtils.copyToClipboardByDOM(e,t)},e.prototype.nodeRecord=function(e){this.needNodeRecrod&&nodeRecord(e)},e.prototype.getChannelName=function(){},e.prototype.share=function(e,t){share(e,t),Utils.agentConfig.other&&Utils.agentConfig.other.guideToShare&&Utils.MsgUtils.addMidMsg("请点击右上角完成分享")},e.prototype.addShortcut=function(e,t){},e.prototype.enterFlow=function(e,t){var i=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N),n=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N),o=game.AppFacade.getInstance().retrieveProxy(game.GuildPy.N),a={serverId:i.serverSelect&&i.serverSelect.s_id,serverName:i.serverSelect&&i.serverSelect.s_name,severArea:i.serverSelect&&i.serverSelect.area,playerName:n.playerInfoVO.name||n.roleVo.name,roleId:n.playerInfoVO.playerId||n.roleVo.playerId,roleCreateDt:n.playerInfoVO.createDt||n.roleVo.createDt,time:Utils.TimerManager.getServerTime(),money:n.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeDiamond]||0,level:n.playerInfoVO.level||0,vipLevel:n.playerInfoVO.playerVip.vipLevel||0,fightCap:n.playerInfoVO.fightCap||0,camp:n.playerInfoVO.camp&&1==n.playerInfoVO.camp?"male":"famale",guildId:o.guildDetail?o.guildDetail.guildId:"",guildName:o.guildDetail?o.guildDetail.name:"",params:t};Utils.SDKMgr.cmd({type:"DeliverData",params:{type:e,data:a}})},e.prototype.onCustomError=function(e){},e}(SDKMgr);__reflect(WebMgr.prototype,"WebMgr",["ISDKInterface"]),function(v){var e=function(t){function e(){var e=t.call(this)||this;return e.actProxy=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e.backpackProxy=v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N),e.hasInit=!1,e._CLASS_NAME_="ActivityCommonView",e}return __extends(e,t),e.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},Object.defineProperty(e.prototype,"info",{get:function(){if(this.code)return this.actProxy.allActivityData[this.code];this.log("没有声明活动code")},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateView=function(e){this.code=e&&e.activityType||e&&e.code||this.code},e.prototype.getReward=function(e,t){var i=this;if(this.code){var n=v.ActivityConfig.Config[this.code],o=n.getRewardName;o&&""!=o&&Utils.Socket.send("activity",o,e).then(function(e){i.log(n.name+"——领取",o+"R",e),i.info.updateData(e.info),i.backpackProxy.handleClientReward(e.clientReward),t&&t(e)})}else this.log("没有声明活动code")},e.prototype.getParentView=function(){var e=v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).getSubView(v.ActivityMediator.SV.MAIN);return e&&e.gp_content},e.prototype.commonSortDataList=function(e){e.sort&&e.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id})},e.prototype.updateActivityTime=function(e,t){void 0===t&&(t=!0);var i=this.info;if(this.code==EActivityType.LevelReward)e.text="";else if(i&&e){var n=v.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();e.text=t?"剩余时间:"+Utils.TimerManager.getFormatBySecond2(n):""+Utils.TimerManager.getFormatBySecond2(n),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=n--?e.text=t?"剩余时间:"+Utils.TimerManager.getFormatBySecond2(n):""+Utils.TimerManager.getFormatBySecond2(n):v.AppFacade.getInstance().hideSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN)},this,1e3)}},e}(BaseView);v.ActivityCommonView=e,__reflect(e.prototype,"game.ActivityCommonView");var t=function(t){function e(){var e=t.call(this)||this;return e.actProxy=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e.backpackProxy=v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N),e}return __extends(e,t),Object.defineProperty(e.prototype,"info",{get:function(){if(this.code)return this.actProxy.allActivityData[this.code];this.log("没有声明活动code")},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateView=function(e){this.code=e&&e.activityType||e&&e.code||this.code},e.prototype.getReward=function(e,t){var i=this;if(this.code){var n=v.ActivityConfig.Config[this.code],o=n.getRewardName;o&&""!=o&&Utils.Socket.send("activity",o,e).then(function(e){i.log(n.name+"——领取",o+"R",e),i.info.updateData(e.info),i.backpackProxy.handleClientReward(e.clientReward),t&&t(e)})}else this.log("没有声明活动code")},e.prototype.commonSortDataList=function(e){e.sort&&e.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id})},e.prototype.updateActivityTime=function(e){var t=this,i=this.info;if(this.code==EActivityType.LevelReward)e.text="";else if(i&&e){var n=v.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();e.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(n),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=n--?e.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(n):t.hide()},this,1e3)}},e.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},e}(BasePanel);v.ActivityCommonPanel=t,__reflect(t.prototype,"game.ActivityCommonPanel");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityCommonListViewSkin",e}return __extends(e,t),e.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList()},e.prototype.initList=function(){this.list_itemList.itemRenderer=a},e.prototype.updateView=function(e){this.code=e&&e.activityType||e&&e.code||this.code,this.updateTitle();var t=this.getDataList();this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(t):this.list_itemList.dataProvider=new eui.ArrayCollection(t)},e.prototype.getDataList=function(){return[]},e.prototype.updateTitle=function(){var e=this,t=v.Config.activityConfigs()[this.code],i=this.actProxy.allActivityData[this.code];if(t&&this.img_title&&(this.img_title.source=JSON.parse(t.img_title)[0]+"_png"),this.code==EActivityType.LevelReward)this.bm_time.text="";else if(i&&this.bm_time){var n=v.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(n),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<n--?e.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(n):v.AppFacade.getInstance().hideSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN)},this,1e3)}},e}(e);v.ActivityCommonListView=i,__reflect(i.prototype,"game.ActivityCommonListView");var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.updateView=function(e){if(e&&e.activityType){this.code=e.activityType,this.updateTitle();var t=this.getDataList();this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(t):this.list_itemList.dataProvider=new eui.ArrayCollection(t)}},t.prototype.getDataList=function(){var r=this;if(!this.code)return[];var s=v.ActivityConfig.Config[this.code];if(!s)return[];var e=this.info;if(!e||!e.data)return[];var c=[],l=e.data.targeted;0==Object.keys(l).length&&(l=[]);var h=e.data.key||0,t=e.data.day,i=JSON.parse(e.content);e.data.curCycle;t&&s.cycle&&i.forEach(function(e){e[0]==t&&(i=e[1])});var n=v.Config.activityConfigs()[this.code],p=n&&n.rotation||1,o=0,a=0,d=0,u=9999999,g=i.length/p;if(1<p){for(var f=1;f<=p&&2<=p;f++){var _=f*g-1,m=i[_],y=(m[0],m[1]%1e4);if(!(y<=h)){u=y;break}if(a++,!(l.length>_)){u=y;break}o++,d=y}p<=o&&(o=p-1,d=i[i.length-g-1]&&i[i.length-g-1][1]||0,u=i[i.length-1][1])}return i.forEach(function(e){var t=e[0],i=e[1],n=e[2];if(p<=1||d<i&&i<=u){var o=REWARD_STATUS.UNAVAILABLE;l.some(function(e){return e.id==t&&0<e.num})?o=REWARD_STATUS.RECEIVED:h>=e[1]&&(o=REWARD_STATUS.AVAILABLE);var a={id:t,title:s.formatString&&s.formatString.format([i-d]),tips:h-d+"/"+(i-d),status:o,rewards:n,btnFunc:function(e){switch(e.status){case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.AVAILABLE:r.getReward({id:e.id,code:r.code});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};c.push(a)}}),c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id}),n&&1!=n.rotation&&0!=n.rotation&&(this.lb_round.visible=!0,this.lb_round.text="完成次数("+a+"/"+p+")"),c},t}(i);v.ActivityCommonTargetListView=n,__reflect(n.prototype,"game.ActivityCommonTargetListView");var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.updateView=function(e){if(e&&e.activityType){this.code=e.activityType,this.updateTitle();var t=this.getDataList();this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(t):this.list_itemList.dataProvider=new eui.ArrayCollection(t)}},t.prototype.getDataList=function(){var p=this;if(this.code){var d=v.ActivityConfig.Config[this.code];if(d){var e=this.info;if(e&&e.data){var u=e.data.targeted,g=(e.data.day,[]),t=JSON.parse(e.content),i=e.data.curCycle;if(i&&d.cycle)for(var n in t[1]){var o=t[1][n];if(o[0]==i){t=o[1];break}}var f=v.AppFacade.getInstance().retrieveProxy(v.RechargePy.N),_=f.goodList;return t.forEach(function(e){var t,i=e[0],n=e[1],o=e[2];for(var a in _){var r=_[a];if(i==r.id){t=r;break}}var s="";s=t?d.formatString.format([t.price]):"找不到商品信息";var c=0;u.forEach(function(e){e.id==i&&(c=e.num)});var l=REWARD_STATUS.CANBUY;o<=c&&(l=REWARD_STATUS.HASBUY);var h={title:s,tips:c+"/"+o,status:l,rewards:n,btnFunc:function(){t?c<o?f.purchase(t,2,"",JSON.stringify({activityType:p.code}),{activityType:p.code}):Utils.MsgUtils.addMidMsg("已购买"):Utils.MsgUtils.addMidMsg("找不到购买信息")}};g.push(h)}),g.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id}),g}}}},t}(i);v.ActivityCommonRechargeListView=o,__reflect(o.prototype,"game.ActivityCommonRechargeListView");var a=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityCommonListItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc(this.data)},this)},e.prototype.dataChanged=function(){var a=this,e=this.data;switch(this.img_bg.source=e.bg||this.img_bg.source,this.lb_title.text=e.title||"",this.lb_tips.text=e.tips||"",this.data.status){case REWARD_STATUS.UNAVAILABLE:this.btn_operate.label="领取",UIActionManager.setGrey(this.btn_operate,!0),this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.scaleX=this.btn_operate.scaleY=.8;break;case REWARD_STATUS.RECEIVED:this.btn_operate.skinName="skins.ButtonSkinSure",this.btn_operate.label="已领取",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=1;break;case REWARD_STATUS.CANBUY:this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.label="购买",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=.8;break;case REWARD_STATUS.HASBUY:this.btn_operate.skinName="skins.ButtonSkinSure",this.btn_operate.label="已购买",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=1;break;case REWARD_STATUS.GO_RECHARGE:this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.label="充值",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=.8;break;case REWARD_STATUS.UNAVAILABLE_BUY:this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.label="购买",UIActionManager.setGrey(this.btn_operate,!0),this.btn_operate.scaleX=this.btn_operate.scaleY=.8;break;case REWARD_STATUS.NEXT_REWARD:this.btn_operate.visible=!1;break;default:this.btn_operate.label="领取",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.scaleX=this.btn_operate.scaleY=.8}e.btnText&&(this.btn_operate.label=e.btnText);var t=JSON.parse(e.rewards);this.gp_rewards.removeChildren(),t.forEach(function(e,t){var i=new eui.Group;i.width=i.height=73.5;var n=customui.BaseItemFactory.create();if(i.addChild(n),a.gp_rewards.addChild(i),n.scaleX=n.scaleY=.7,e[0]==EEntityType.EEntityTypeHeroArtifact||e[0]==EEntityType.EEntityTypeHeroEquip){var o={code:e[1],entityType:e[0],exp:0,fightCap:0,level:0,level2:0,filterShow:!0};n.updateData({reward:e,vo:o})}else n.updateData({reward:e});e[3]?UIActionManager.addEffect(i,"common_jiban",{scaleX:1,scaleY:1}):UIActionManager.hideEffect(i)}),this.btnFunc=e.btnFunc,this.data.status==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn_operate,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2}):UIActionManager.hideEffect(this.btn_operate)},e}(eui.ItemRenderer);v.ActivityCommonListItem=a,__reflect(a.prototype,"game.ActivityCommonListItem")}(game||(game={})),function(o){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivitySDKCommonViewSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent()},e.prototype.updateView=function(e){var t=o.Config.operationConfig(),i=o.GameMVC.activityPy.allActivityData[this.code],n=t[JSON.parse(i.content)[0]];o.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,JSON.parse(n.reward))},e.prototype.activateComponent=function(){var e=this;Utils.ComponentUtils.registerListener(this.btn_close,egret.TouchEvent.TOUCH_TAP,function(){e.hide()}),Utils.ComponentUtils.registerListener(this.btn_ok,egret.TouchEvent.TOUCH_TAP,function(){e.okCB&&e.okCB()})},e}(BasePanel);o.ActivitySDKCommonView=e,__reflect(e.prototype,"game.ActivitySDKCommonView")}(game||(game={}));var BaseProxy=function(i){function e(e){var t=i.call(this,e)||this;return t.name=e,t}return __extends(e,i),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【"+this.name+"】："].concat(e))},e}(puremvc.Proxy);__reflect(BaseProxy.prototype,"BaseProxy",["puremvc.IProxy","puremvc.INotifier"]),function(i){var e=function(t){function e(){var e,s=t.call(this)||this;return s.initedUI=!1,s.isTouchTap=!1,s.MAX_NUM=20,s.DECOMPOSE_TYPE_CONFIG=((e={})[EEntityType.EEntityTypeHero]={name:"英雄祭坛",getAllInfo:function(){return i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N).allHeroByUuid},filterConfig:{data:[[{race:HeroRaceType.Human,icon:HeroRaceConfig[HeroRaceType.Human].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Elf,icon:HeroRaceConfig[HeroRaceType.Elf].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Orc,icon:HeroRaceConfig[HeroRaceType.Orc].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Athanasy,icon:HeroRaceConfig[HeroRaceType.Athanasy].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Demon,icon:HeroRaceConfig[HeroRaceType.Demon].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Eldar,icon:HeroRaceConfig[HeroRaceType.Eldar].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"}],[{star:1,icon:"fenjie_btn_xingtb1_png",chosenImg:"beibao_img_daxuanzhongq_png"},{star:2,icon:"fenjie_btn_xingtb2_png",chosenImg:"beibao_img_daxuanzhongq_png"},{star:3,icon:"fenjie_btn_xingtb3_png",chosenImg:"beibao_img_daxuanzhongq_png"},{star:4,icon:"fenjie_btn_xingtb4_png",chosenImg:"beibao_img_daxuanzhongq_png"},{star:5,icon:"fenjie_btn_xingtb5_png",chosenImg:"beibao_img_daxuanzhongq_png"},{star:6,icon:"fenjie_btn_xingtb6_png",chosenImg:"beibao_img_daxuanzhongq_png"}]],filterFunc:function(e,t){var i=!e.race||0==e.race.length||-1!=e.race.indexOf(t.config.race),n=!e.star||0==e.star.length||-1!=e.star.indexOf(t.starLevel);return i&&n},addFilter:function(e,t){var i=t.race?"race":"star";e[i]||(e[i]=[]);var n=e[i].indexOf(t[i]);-1==n?(e[i].splice(0),e[i].push(t[i])):e[i].splice(n,1)},autoFilterFunc:function(e,t){return e.starLevel<=4},autoFilterTipsFunc:function(e){return"无五星以下英雄"}},checkChoosabel:function(e){return!e.pos&&!e.isLocked},sortFunc:function(e,t){var i=e.info,n=t.info,o=i.pos||0,a=n.pos||0;if(o!=a)return o-a;var r=!!s.backpackPy.checkHeroInTeam(i.uuid);return r!=!!s.backpackPy.checkHeroInTeam(n.uuid)?r?1:-1:i.isLocked!=n.isLocked?i.isLocked?1:-1:i.starLevel!=n.starLevel?i.starLevel-n.starLevel:i.code!=n.code?i.code-n.code:i.level-n.level},confirmFunc:function(e,t){0<e.length?e.some(function(e){return 4==e.starLevel})?i.GameMgr.getInstance().showCommonTipsWin({commonTips:"你所要分解的英雄中含有4星英雄，4星英雄可作为升为5星英雄的材料，请确认是否分解？",needTipsToday:!0,cb:!0,source:"HERO_DECOMPOSE",clickCB:function(e){e.type&&t()}}):t():Utils.MsgUtils.addMidMsg("未放入英雄")}},e[EEntityType.EEntityTypeHeroEquip]={name:"装备分解",getAllInfo:function(){return i.AppFacade.getInstance().retrieveProxy(i.HeroThingPy.N).AllEquipInfo},filterConfig:{data:[],filterFunc:function(e,t){return!0},addFilter:function(e,t){},autoFilterFunc:function(e){return e.config.color<=3},autoFilterTipsFunc:function(e){return"无紫色品质以下装备"}},checkChoosabel:function(e){return""==e.heroUuid},sortFunc:function(e,t){var i=e.info,n=t.info,o=""!=i.heroUuid;return o!=(""!=n.heroUuid)?o?1:-1:i.config.color!=n.config.color?i.config.color-n.config.color:i.code!=n.code?i.code-n.code:i.level-n.level},confirmFunc:function(e,t){0<e.length?t():Utils.MsgUtils.addMidMsg("未放入装备")}},e),Utils.AssetsMgr.loadGroup("group_decompose"),s.skinName="DecomposeUISkin",s.heroPy=i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N),s.backpackPy=i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N),s.chosenList=[],s.curFilter={},s}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_decompose")},e.prototype.onOtherPanelPopup=function(e){t.prototype.onOtherPanelPopup.call(this,e),this.gp_content.visible=!e},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.initTabbar(),this.initTop(),this.activateComponent(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_help),Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_reborn),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cu_resBar),this.gp_content.touchChildren=!0,this.gp_content.scaleX=this.gp_content.scaleY=1,UIActionManager.playUIAction(this.gp_content,1)},e.prototype.initTop=function(){this.updatePlayerInfo()},e.prototype.initial=function(){this.targetConfig=this.DECOMPOSE_TYPE_CONFIG[this.curType],this.blb_title.text=this.targetConfig.name,this.initFilter(),this.initedUI=!0},e.prototype.initList=function(){this.list_chosenItem.itemRenderer=n,UIActionManager.hideScrollerBar(this.scl_chosenItem),this.list_chosenItem.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.chosenList_onItemTap,this),this.list_item.itemRenderer=o,UIActionManager.hideScrollerBar(this.scl_item),this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.itemList_onItemTap,this)},e.prototype.initTabbar=function(){this.tabbar.visible=!1},e.prototype.initFilter=function(){var n=this;this.gp_filters_list.removeChildren();var e=this.targetConfig.filterConfig.data;e&&0<e.length?(this.gp_filter.visible=!0,e.forEach(function(e){var t=new eui.List;t.itemRenderer=a;var i=new eui.HorizontalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER,t.layout=i,t.dataProvider=new eui.ArrayCollection(e),t.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.filterItem_onItemTap,n),n.gp_filters_list.addChild(t)}),this.gp_filters.height=42*e.length+20*(e.length-1)+40):this.gp_filter.visible=!1},e.prototype.chosenList_onItemTap=function(e){e.item.info&&this.selectItem(e.item.info,!1)},e.prototype.itemList_onItemTap=function(e){(this.targetConfig.checkChoosabel||function(){return!0})(e.item.info)?-1==this.chosenList.indexOf(e.item.info)?this.chosenList.length<this.MAX_NUM&&this.selectItem(e.item.info,!0):this.selectItem(e.item.info,!1):e.item.info.isLocked?Utils.MsgUtils.addMidMsg("该英雄已上锁"):e.item.info.pos&&Utils.MsgUtils.addMidMsg("该英雄在阵上")},e.prototype.filterItem_onItemTap=function(e){var t=e.itemRenderer;if(this.targetConfig.filterConfig.addFilter(this.curFilter,e.item),!t.chosen)for(var i=0,n=this.gp_filters_list.$children;i<n.length;i++){var o=n[i];if(-1!=o.$children.indexOf(t))for(var a=0,r=o.$children;a<r.length;a++){var s=r[a];s.chosen&&s.setChosen(!1)}}t.setChosen(!t.chosen),this.updateItemList()},e.prototype.selectItem=function(e,t){var i=this.list_item.dataProvider;for(var n in i.source){var o=i.source[n];if(o.info==e){o.chosen=t,i.itemUpdated(o);break}}t?this.chosenList.push(e):this.chosenList.splice(this.chosenList.indexOf(e),1),this.updateChosenList()},e.prototype.updateChosenList=function(){var e=[];for(var t in this.chosenList){var i=this.chosenList[t];e.push({type:this.curType,info:i})}for(;e.length<this.MAX_NUM;)e.push({});this.list_chosenItem.dataProvider=new eui.ArrayCollection(e)},e.prototype.updateItemList=function(){var e=[],t=this.targetConfig.filterConfig&&this.targetConfig.filterConfig.filterFunc||function(){return!0},i=this.targetConfig.sortFunc||function(){return-1},n=this.targetConfig.getAllInfo(),o=0;if(n)for(var a in n){o+=1;var r=n[a];t(this.curFilter,r)&&e.push({type:this.curType,info:r,chosen:-1!=this.chosenList.indexOf(r)})}e.sort(i),this.list_item.dataProvider=new eui.ArrayCollection(e),this.lb_num.text=this.targetConfig.name.slice(0,2)+"数量：",this.blb_num.text=e.length+"/"+o},e.prototype.updateView=function(e){var t=!this.curType||e&&e.type&&e.type!=this.curType;this.curType=e&&e.type||this.curType,!this.initedUI||t?(this.chosenList.splice(0),this.initial(),this.updateView()):(this.updateChosenList(),this.updateItemList(),this.updatePlayerInfo())},e.prototype.autoSelect=function(){if(!(this.chosenList.length>=this.MAX_NUM)){var e=this.list_item.dataProvider.source,t=this.targetConfig.filterConfig&&this.targetConfig.filterConfig.autoFilterFunc||function(){return!0},i=this.targetConfig.checkChoosabel||function(){return!0},n=this.curHasFilter(),o=0;if(e.length)for(var a in e){var r=e[a].info;if(t(r,n)&&i(r)&&-1==this.chosenList.indexOf(r)&&(this.chosenList.push(r),o++,this.chosenList.length>=this.MAX_NUM))break}o?(this.updateItemList(),this.updateChosenList()):Utils.MsgUtils.addMidMsg(this.targetConfig.filterConfig.autoFilterTipsFunc(n))}},e.prototype.curHasFilter=function(){var e=0;for(var t in this.curFilter){e+=this.curFilter[t].length}return 0<e},e.prototype.playEffect=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.list_chosenItem.$children[t]?[4,DragonBoneTools.playOnce({effectName:"common_yingxiongfenjie",parent:this.list_chosenItem.$children[t],x:this.list_chosenItem.$children[t].width/2,y:this.list_chosenItem.$children[t].height/2,loop:!1,cacheAsBitmap:!0})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.doneCB=function(o){return __awaiter(this,void 0,void 0,function(){var t,i,n=this;return __generator(this,function(e){switch(e.label){case 0:for(this.gp_content.touchChildren=!1,t=[],i=0;i<this.chosenList.length;i++)t.push(this.playEffect(i));return[4,Promise.all(t)];case 1:return e.sent(),this.chosenList.splice(0),this.updateItemList(),this.updateChosenList(),this.updatePlayerInfo(),this.backpackPy.handleClientReward(o.clientReward,{title:"分解奖励",btnText:"领取",onCloseCB:function(){n.gp_content.touchChildren=!0,Utils.MsgUtils.addMidMsg("领取成功")}}),[2]}})})},e.prototype.activateComponent=function(){this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.MainJumpConfig.jumpTo()},this),this.btn_auto.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.autoSelect()},this),this.btn_decompose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.targetConfig.confirmFunc(this.chosenList,function(){t.backpackPy.Decompose({chosenItem:t.chosenList,type:t.curType,cb:function(e){t.doneCB(e)},noShowReward:!0})})},this),this.btn_filter.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_filters.visible=!0;var e=this.gp_filter.globalToLocal(0,0),t=new egret.Sprite;t.touchEnabled=!0,t.graphics.beginFill(0,0),t.graphics.drawRect(e.x,e.y,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),t.graphics.endFill(),this.gp_filter.addChildAt(t,2),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.gp_filters.visible=!1,t.parent&&t.parent.removeChild(t)},this)},this),this.btn_details.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<this.chosenList.length?this.backpackPy.Decompose({chosenItem:this.chosenList,type:this.curType,preview:!0}):Utils.MsgUtils.addMidMsg("未放入"+this.targetConfig.name)},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeDecompose})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new i.HelpDialog({moduleId:MODULE.Decompose})})},this),this.btn_reborn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.AppFacade.getInstance().showSubView(i.BackpackMediator.N,i.BackpackMediator.SV.HEROROLLBACKVIEW)},this)},e.prototype.updatePlayerInfo=function(){var e=i.Config.publicBuyCostConfig(i.ShopConfig.ShopInfo[ShopType.ShopTypeDecompose].moduleId),t=[JSON.parse(e.costs)[0]];this.cu_resBar.updateBar({costs:t,width:190,needAdd:!0})},e}(BaseFull);i.DecomposeUI=e,__reflect(e.prototype,"game.DecomposeUI");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="DecomposeUI_ChosenItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseItem.addChild(this.baseItem)},e.prototype.dataChanged=function(){var e=this.data.type,t=this.data.info;if(t)switch(this.gp_baseItem.visible=!0,this.gp_empty.visible=!1,e){case EEntityType.EEntityTypeHero:this.baseItem.updateData({uuid:t.uuid,type:EEntityType.EEntityTypeHero});break;case EEntityType.EEntityTypeHeroEquip:this.baseItem.updateData({uuid:t.uuid,type:EEntityType.EEntityTypeHeroEquip})}else this.gp_baseItem.visible=!1,this.gp_empty.visible=!0},e}(eui.ItemRenderer);i.DecomposeUI_ChosenItem=n,__reflect(n.prototype,"game.DecomposeUI_ChosenItem");var o=function(t){function e(){var e=t.call(this)||this;return e.skinName="DecomposeUI_Item",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseItem.addChild(this.baseItem)},e.prototype.dataChanged=function(){switch(this.data.type){case EEntityType.EEntityTypeHero:this.baseItem.updateData({uuid:this.data.info.uuid,type:EEntityType.EEntityTypeHero}),UIActionManager.setGrey(this.baseItem,this.data.info.isLocked||this.data.info.pos||this.data.chosen),this.gp_unlock.visible=(this.data.info.isLocked||this.data.info.pos)&&!0;break;case EEntityType.EEntityTypeHeroEquip:this.baseItem.updateData({uuid:this.data.info.uuid,type:EEntityType.EEntityTypeHeroEquip}),UIActionManager.setGrey(this.baseItem,this.data.info.isLocked||""!=this.data.info.heroUuid||this.data.chosen),this.gp_unlock.visible=this.data.info.isLocked||""!=this.data.info.heroUuid;break;case EEntityType.EEntityTypeHeroArtifact:this.baseItem.updateData({uuid:this.data.info.uuid,type:EEntityType.EEntityTypeHeroArtifact}),UIActionManager.setGrey(this.baseItem,this.data.info.isLocked||""!=this.data.info.heroUuid||this.data.chosen),this.gp_unlock.visible=this.data.info.isLocked||""!=this.data.info.heroUuid}this.gp_chosen.visible=this.data.chosen},e}(eui.ItemRenderer);i.DecomposeUI_Item=o,__reflect(o.prototype,"game.DecomposeUI_Item");var a=function(t){function e(){var e=t.call(this)||this;return e.skinName="BackpackUI_FilterItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.chosen=!1,this.scaleX=this.scaleY=.7},e.prototype.dataChanged=function(){this.img_icon.source=this.data.icon,this.img_chosen.source=this.data.chosenImg,this.setChosen(this.chosen)},e.prototype.setChosen=function(e){this.chosen=e,this.img_chosen.visible=this.chosen},e}(eui.ItemRenderer);i.DecomposeUI_FilterItem=a,__reflect(a.prototype,"game.DecomposeUI_FilterItem")}(game||(game={})),function(e){var t=function(t){function i(e){return void 0===e&&(e=null),t.call(this,i.N,e)||this}return __extends(i,t),Object.defineProperty(i.prototype,"rootView",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),i.prototype.initSubView=function(){this.addSubView(i.SV.MAIN,e.StrongUI)},i.prototype.listNotificationInterests=function(){return[CN.LOGIN_FINAL_DONE,CN.HIDE_ALL_SUBVIEW,CN.STRONG_OPEN_MAIN,CN.STRONG_CLOSE_MAIN]},i.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.STRONG_OPEN_MAIN:case CN.STRONG_CLOSE_MAIN:this.hideAllSubView(),this.rootView&&(this.rootView.visible=!1);break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView(),this.removeFromParent(),this.rootView&&(this.rootView.visible=!1);break;case CN.LOGIN_FINAL_DONE:}},i.prototype.onViewCreate=function(){},i.N="StrongMediator",i.SV={MAIN:1},i}(BaseMediator);e.StrongMediator=t,__reflect(t.prototype,"game.StrongMediator")}(game||(game={})),function(a){var e=function(i){function o(e){void 0===e&&(e=null);var t=i.call(this,o.N,e)||this;return t.mainProxy=a.AppFacade.getInstance().retrieveProxy(a.MainPy.N),t}return __extends(o,i),o.prototype.initSubView=function(){this.addSubView(o.SV.CHAT,a.ChatMain)},o.prototype.listNotificationInterests=function(){return[CN.MAIN_CHAT_PRIVATEPLAYER_UPDATE,CN.MAIN_CHAT_UPDATE,CN.LOGIN_FINAL_DONE]},o.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.MAIN_CHAT_PRIVATEPLAYER_UPDATE:(i=this.getSubView(o.SV.CHAT))&&i.updatePrivateChatPlayer();break;case CN.MAIN_CHAT_UPDATE:var i=this.getSubView(o.SV.CHAT);if(t){i&&i.insertItem(t);var n=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N).playerInfoVO.playerId;t.channelType==EChatChannelType.EChatChannelTypePrivate&&t.fromPlayer&&t.fromPlayer.playerId!=n&&(i||Utils.MsgUtils.addPrivateChatPopUp(t.fromPlayer))}i&&i.updateView({}),a.AppFacade.getInstance().retrieveMediator(a.MainMediator.N).handleBanner();break;case CN.LOGIN_FINAL_DONE:this.mainProxy.getAllChatList(),this.mainProxy.getServerBlackList()}},o.N="ChatMediator",o.SV={CHAT:1},o}(BaseMediator);a.ChatMediator=e,__reflect(e.prototype,"game.ChatMediator")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.friendProxy=o.AppFacade.getInstance().retrieveProxy(o.FriendPy.N),t.initNotice(),t}return __extends(n,i),Object.defineProperty(n.prototype,"rootView",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),n.prototype.initNotice=function(){NoticeManager.setChildType(NT.FRIEND,[NT.FRIEND_APPLY,NT.FRIEND_GIFT])},n.prototype.initSubView=function(){this.addSubView(n.SV.INFO,o.FriendInfo),this.addSubView(n.SV.MAIN,o.FriendUI)},n.prototype.listNotificationInterests=function(){return[CN.LOGIN_FINAL_DONE,CN.FRIEND_OPEN_MAIN,CN.FRIEND_CLOSE_MAIN,CN.FRIEND_GIFT_UPDATE,CN.HIDE_ALL_SUBVIEW,CN.GENERAL_PASS_DAY]},n.prototype.handleNotification=function(e){var t=e.getBody(),i=this.getSubView(n.SV.MAIN);switch(e.getName()){case CN.LOGIN_FINAL_DONE:this.friendProxy.getInitListInfo(void 0,function(){i&&i.updateView(t)}),this.friendProxy.getblacklist();break;case CN.FRIEND_OPEN_MAIN:case CN.FRIEND_CLOSE_MAIN:this.hideAllSubView(),i&&(i.perClose(),i.visible=!1);break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView(),this.removeFromParent(),i&&(i.perClose(),i.visible=!1);break;case CN.FRIEND_GIFT_UPDATE:i&&i.updateGiftData();break;case CN.GENERAL_PASS_DAY:o.AppFacade.getInstance().retrieveProxy(o.FriendPy.N).getFriendList()}},n.prototype.onViewCreate=function(){},n.N="FriendMediator",n.SV={MAIN:1,INFO:2},n}(BaseMediator);o.FriendMediator=e,__reflect(e.prototype,"game.FriendMediator")}(game||(game={})),function(y){var e=function(i){function m(e){void 0===e&&(e=null);var t=i.call(this,m.N,e)||this;return t.curVaildFlow=[],t.eventWaitId2C={},t.guajiProxy=y.AppFacade.getInstance().retrieveProxy(y.GuajiPy.N),t.guidePy=y.AppFacade.getInstance().retrieveProxy(y.GuidePy.N),t.initNotice(),Utils.DebugUtils.isDebug&&(window._guaji=t),t}return __extends(m,i),Object.defineProperty(m.prototype,"guajiUI",{get:function(){return this.getSubView(m.SV.MAIN)},enumerable:!0,configurable:!0}),m.prototype.initSubView=function(){this.addSubView(m.SV.MAIN,y.GuajiView),this.addSubView(m.SV.MINES_LIST,y.GuajiMinesListPanel),this.addSubView(m.SV.MINI_MAP,y.GuajiMiniMapPanel),this.addSubView(m.SV.MAIN_TASK,y.GuajiMainTaskPanel),this.addSubView(m.SV.DEMON,y.GuajiDemonPanel),this.addSubView(m.SV.MULTI,y.GuajiMultiPanel)},m.prototype.initNotice=function(){},m.prototype.listNotificationInterests=function(){return[CN.GUAJI_HIDE_ALL_SUBVIEW,CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.GUAJI_LAYER_INFO_UPDATE,CN.GUAJI_LAYER_INFO_TIPS_UPDATE,CN.GUAJI_LAYER_EVENT_INFO_UPDATE,CN.GUAJI_PRETEND_CLICK_TILED,CN.GUAJI_FINGER_APPEAR_TO_XY,CN.GUAJI_RESET_CAMERA,CN.GUAJI_MAP_SCALE,CN.GUAJI_OPEN_CBT,CN.GUAJI_MAP_BACKPACK_UPDATE,CN.GUAJI_ON_ME_WALK_TO,CN.GUAJI_FINGER_TO_XY,CN.GUAJI_HUDONG_WITH_EP,CN.GUAJI_SHOW_ME_PATH_TO_POS,CN.GUAJI_DEMON_UPDATE,CN.GUAJI_MULTI_GUAJI_ROOM_UPDATE,CN.PLAYER_OUTLOOK_UPDATE,CN.TASK_GET_REWARDS_POP_CLOSE,CN.CHANGE_PANEL,CN.FIGHT_ALL_DONE_AND_EXIT,CN.FIGHT_ON_FIGHT_VISIBLE_SWITCH,CN.GUAJI_MAP_INIT_ALL_DONE,CN.GUAJI_UPDATE_MINE,CN.GUAJI_GOLD_REFRESH,CN.GUAJI_ENTER_LAYER,CN.GUAJI_UPDATE_RES_NOTICE,CN.GENERAL_PASS_DAY]},m.prototype.handleNotification=function(e){var u=this,t=e.getBody(),i=e.getName();switch(i){case CN.HIDE_ALL_SUBVIEW:this.guajiUI&&(this.guajiUI.perClose(),this.guajiUI.visible=!1,this.guajiUI.parent&&this.guajiUI.parent.setChildIndex(this.guajiUI,0));break;case CN.GUAJI_HIDE_ALL_SUBVIEW:this.log("GUAJI_HIDE_ALL_SUBVIEW"),this.hideAllSubView(),this.viewComponent=void 0;break;case CN.GUAJI_ON_ME_WALK_TO:if(this.handleGuideEvent(i,t),!this.guajiProxy.localType)for(var n=0,o=this.guajiProxy.curLayerCBT;n<o.length;n++){var a=o[n];if(a.position.x==t.tileX&&a.position.y==t.tileY){this.guajiUI&&this.guajiUI.map&&this.guajiUI.map.me&&this.guajiUI.map.me.forceStop(),this.sendNotification(CN.GUAJI_OPEN_CBT,{vo:a,canGet:!0});break}}break;case CN.GUAJI_LAYER_INFO_TIPS_UPDATE:this.guajiUI&&this.guajiUI.updateLayerInfoTips();break;case CN.GUAJI_LAYER_INFO_UPDATE:this.log("GuajiMediator GUAJI_LAYER_INFO_UPDATE"),this.guajiUI&&this.guajiUI.updateLayerInfo(t);break;case CN.PLAYER_OUTLOOK_UPDATE:this.guajiUI&&this.guajiUI.updateNPCOutLook();break;case CN.GUAJI_LAYER_EVENT_INFO_UPDATE:if(this.guajiUI&&(this.guajiUI.updateLayerEventInfo(t),t.event)){var r=t.event,s=y.Config.riskEvent()[r.eventId],g=JSON.parse(s.dropImg);g.length&&y.GameMVC.fightPy.addDelayCBAfterFightExit(function(){egret.setTimeout(function(){var s={availabel:!0,imgArr:[],effectArr:[]},c={1:"common_mxwupin_cheng",2:"common_mxwupin_hong",3:"common_mxwupin_jin"},l=[[0,0],[-50,25],[-50,-25],[50,25],[50,-25],[0,50],[0,-50],[-100,0],[100,0]],h=u.guajiUI.map.me,e=u.guajiUI.map.tile2Pos(r.position.x,r.position.y);u.guajiUI.map.gp_ep.localToGlobal(e.x,e.y,e),u.guajiUI.map.me.globalToLocal(e.x,e.y,e);var p=[e.x,e.y-50],d=[h.anchorOffsetX+0,h.anchorOffsetY-90];DragonBoneTools.playOnce({effectName:"common_mxdiaoluo",parent:h,x:p[0],y:p[1]}),g.forEach(function(a,e){for(var r=a[0],t=a[1],i=function(){var e=Math.round(Math.random()*(l.length-1)),i=l.splice(e,1)[0],n=new eui.Group;n.width=n.height=50,n.anchorOffsetX=n.anchorOffsetY=25,n.x=p[0],n.y=p[1],n.touchEnabled=n.touchChildren=!1;var t=new eui.Image("_guaji_m_json.yingxion_img_touying");t.scaleX=t.scaleY=.23,t.bottom=0,t.horizontalCenter=0,n.addChild(t);var o=new eui.Image(r+"_png");o.width=o.height=50,n.addChild(o),i[1]+p[1]<d[1]?h.addChildAt(n,0):h.addChild(n),s.imgArr.push(n),egret.Tween.get(n).to({y:i[1]+p[1]-50},150,egret.Ease.cubicOut).to({y:i[1]+p[1]},150,egret.Ease.cubicIn),egret.Tween.get(n).to({x:i[0]+p[0]},300).call(function(){var e=a[2];if(e){var t=c[e];DragonBoneTools.create(t,function(e){s.availabel&&(e.animation.play(t,0),e.x=i[0]+p[0],e.y=i[1]+p[1],h.addChildAt(e,h.getChildIndex(n)+1),s.effectArr.push(e))})}Utils.TouchUtils.hasGlobalTouch("RISK_REWARD_OBTAIN")||Utils.TouchUtils.addGlobalTouch(function(){Utils.TouchUtils.removeGlobalTouch("RISK_REWARD_OBTAIN"),s.availabel=!1,s.imgArr.forEach(function(e){egret.Tween.removeTweens(e),egret.Tween.get(e).to({x:d[0],y:d[1],scaleX:.4,scaleY:.4},300).call(function(){e.parent.removeChild(e)})}),s.effectArr.forEach(function(e){e.parent&&e.parent.removeChild(e)})},"RISK_REWARD_OBTAIN")})};0<t--;)i()})},u,200),y.GameMVC.fightPy.queueExceExitCB()},"riskRewardDrop")}break;case CN.GUAJI_RESET_CAMERA:this.guajiUI&&this.guajiUI.resetCamera(t);break;case CN.GUAJI_MAP_SCALE:this.guajiUI&&this.guajiUI.setMapScale(t);break;case CN.GUAJI_HUDONG_WITH_EP:this.guajiUI&&this.guajiUI.hudongWithEP(t);break;case CN.GUAJI_SHOW_ME_PATH_TO_POS:this.guajiUI&&this.guajiUI.showMePathToPos(t);break;case CN.GUAJI_OPEN_CBT:var c=!1;t&&null!=t.hideRewards&&(c=t.hideRewards),PopUpManager.addPopUp({obj:new y.GuajiCBTDetailPanel({hideRewards:c,canGet:t&&t.canGet,vo:t&&t.vo,config:t&&t.config,showAutoBtn:t&&t.showAutoBtn,customCB:function(){t&&t.vo&&t.canGet?u.guajiProxy.OpenRiskMap(t.vo.uuid):t&&t.showAutoBtn&&u.guajiUI&&u.guajiUI.handleTouchTap({tileX:t.vo.position.x,tileY:t.vo.position.y,num:t.vo.position.num})}})});break;case CN.GUAJI_PRETEND_CLICK_TILED:this.guajiUI&&this.guajiUI.handleTouchTap(t);break;case CN.GUAJI_MAP_BACKPACK_UPDATE:this.guajiUI&&egret.setTimeout(function(){u.guajiUI&&u.guajiUI.updateCBTInfo()},this,1e3);break;case CN.GUAJI_ENTER_LAYER:if(this.guajiUI){var l=y.AppFacade.getInstance().retrieveProxy(y.GuajiPy.N);this.guajiProxy.GetLayerProgress(function(){u.guajiUI.pb_layerProgress&&(u.guajiUI.pb_layerProgress.firstMdfValue=!0),u.guajiUI.updateProgress(t)}),Utils.SoundManager.playDelayBg(l.curLayerTheme.bgm)}if(t.source==MODULE.Risk){var h=y.AppFacade.getInstance().retrieveProxy(y.GuidePy.N);if(2==t.layerId)y.AppFacade.getInstance().retrieveProxy(y.LoginPy.N).loginGameVO.isCreated||y.AppFacade.getInstance().showSubView(y.PlayerMediator.N,y.PlayerMediator.SV.ROLE_NAME,{clickDarkClose:!1});else if(3!=t.layerId||h.serverGuideInfo.xinshou_img_dtjc_png){if(1001==t.layerId&&!h.serverGuideInfo.xinshou_img_fbjc_png){d=new BasePanel;(p=new eui.Image).horizontalCenter=0,p.verticalCenter=0,p.scaleX=p.scaleY=1.2,p.source="xinshou_img_fbjc_png",h.setGuideInfo("xinshou_img_fbjc_png"),d.addChild(p),PopUpManager.addPopUp({obj:d})}}else{var p,d=new BasePanel;(p=new eui.Image).horizontalCenter=0,p.verticalCenter=0,p.scaleX=p.scaleY=1.2,p.source="xinshou_img_dtjc_png",h.setGuideInfo("xinshou_img_dtjc_png"),d.addChild(p),PopUpManager.addPopUp({obj:d})}}this.handleGuideEvent(i,t);break;case CN.LOGIN_FINAL_DONE:this.guajiProxy.GetRiskMapInfo(),this.guajiProxy.GetPlayerDemonInfo(),this.guajiProxy.GetDemonList(),Utils.UnlockMgr.checkPass(MODULE.RiskMulti,!1).allow&&Utils.SDKMgr.getPerformConfig(40)&&this.guajiProxy.RiskMultiCommand("GetRoomInfo");break;case CN.FIGHT_ON_FIGHT_VISIBLE_SWITCH:if(!this.guajiUI||!this.guajiUI.map)return;t.isInFight?this.guajiUI.map.onThisMapSwitch(!1):this.guajiUI.map.onThisMapSwitch(!0);case CN.CHANGE_PANEL:t&&t.isRemove&&this.handleGuideEvent(i,t);break;case CN.FIGHT_ALL_DONE_AND_EXIT:this.handleGuideEvent(i,t);break;case CN.TASK_GET_REWARDS_POP_CLOSE:if(!this.guidePy.isInMapGuide)return;if(this.curStep)return void console.log("guajiGuide 任务变化，当前存在流程");console.log("guajiGuide 任务变化，重新找下一步"),this.setCBAfterSubViewShow(m.SV.MAIN,function(){console.log("guajiGuide 挂机界面出现"),u.makeFlow(),u.next()});break;case CN.GUAJI_FINGER_APPEAR_TO_XY:this.setCBAfterSubViewShow(m.SV.MAIN,function(){u.guajiUI.riskFingerAppearToXY(t)});break;case CN.GUAJI_FINGER_TO_XY:this.setCBAfterSubViewShow(m.SV.MAIN,function(){u.guajiUI.showFingerToXY(t)});break;case CN.GUAJI_MAP_INIT_ALL_DONE:if(!t.source||t.source!=MODULE.Risk||!this.guajiUI)return;Utils.isNeedGuide&&this.setCBAfterSubViewShow(m.SV.MAIN,function(){u.log("新手开始"),u.guidePy.setInMapGuide(!0),u.makeFlow(),u.next()}),this.guajiUI.onMapInitAllDone();break;case CN.GUAJI_UPDATE_MINE:this.guajiUI&&this.guajiProxy.GetMineInfo({cb:function(){u.guajiUI.updateMine(t)},ispush:!0});break;case CN.GUAJI_UPDATE_RES_NOTICE:this.guajiUI&&this.guajiUI.updateResFullNotice(t);break;case CN.GUAJI_GOLD_REFRESH:if(this.guajiUI){if(!this.guajiUI.img_gold.visible){var f=Utils.TimerManager.getServerTime(),_=0;this.guajiProxy.minesInfo.forEach(function(e){if(e.lastGiveDt&&f-e.lastGiveDt>_){var t=0==_?1e6:_;_=f-e.lastGiveDt,_=Math.min(t,_)}}),10<=_&&(this.guajiUI.img_gold.visible=!0,this.guajiUI.img_gold.source="mx_img_jinbidui1_png")}t.mines.forEach(function(e){var n=u.guajiUI.map&&u.guajiUI.map.getEpByEventId(e.id);if(n&&n.visible){var t=JSON.parse(e.rewards);Utils.MsgUtils.addRewardMsg({rewards:t},n,{oriY:0,offsetY1:-50,offsetY2:-50});for(var o=y.AppFacade.getInstance().retrieveProxy(y.BackpackPy.N).getInfoByTypeCodeNum(t[0].type,t[0].code).info.icon,a=Utils.ComponentUtils.getPosInView(n),i=u.guajiUI.img_gold,r=Utils.ComponentUtils.getPosInView(i).add(new egret.Point(i.width/2,i.height/2)),s=function(){if(u.guajiUI){var t=new eui.Image;RES.getResAsync(ResourceUtils.png(o),function(e){t.source=e,t.anchorOffsetX=e.textureWidth/2,t.anchorOffsetY=e.textureHeight/2},u);var e=n.width/2+a.x,i=n.height/2+a.y;t.x=e,t.y=i,t.scaleX=t.scaleY=.6,t.alpha=0,u.guajiUI.addChild(t),egret.Tween.get(t).to({alpha:1,y:i-70},150).wait(200).call(function(){egret.Tween.get(t,{loop:!0}).to({scaleX:-.6},80).to({scaleX:.6},80)}).to({x:r.x,y:r.y},1e3,egret.Ease.quadIn).to({alpha:0},150).call(function(){egret.Tween.removeTweens(t),t&&t.parent&&t.parent.removeChild(t)})}},c=5;0<c;)egret.setTimeout(s,u,150*c),c-=1}})}break;case CN.GENERAL_PASS_DAY:y.AppFacade.getInstance().retrieveProxy(y.GuajiPy.N).getQuickBattleInfo();break;case CN.GUAJI_DEMON_UPDATE:this.guajiUI&&this.guajiUI.updateDemonInfo();case CN.GUAJI_MULTI_GUAJI_ROOM_UPDATE:this.updateView(m.SV.MULTI)}},m.prototype.handleGuideEvent=function(e,t){if(this.guidePy||!this.guidePy.isInMapGuide)for(var i in this.eventWaitId2C)this.eventWaitId2C[i].event==e&&(this.eventWaitId2C[i].func(t,this.curStepDone,this),delete this.eventWaitId2C[i])},m.prototype.makeFlow=function(){this.curVaildFlow.splice(0);for(var e=0,t=s;e<t.length;e++){for(var i=t[e],n=!0,o=0,a=i.guideCondParams;o<a.length;o++){var r=a[o];if(!(n=this.guidePy.checkCondition(r[0],r[1])))break}n&&this.curVaildFlow.push(i)}},m.prototype.curStepDone=function(){this.curStep&&this.curStep.autoNext&&this.next()},m.prototype.insert=function(e){},m.prototype.handleEvent=function(){},m.prototype.next=function(){this.curStep=this.curVaildFlow.shift(),console.log("guajiGuide下一个",this.curStep),this.curStep?this.curStep.event?this.eventWaitId2C[this.curStep.id]=this.curStep:this.curStep.func(void 0,this.curStepDone,this):console.log("guajiGuide 没有下一个了")},m.N="GuajiMediator",m.SV={MAIN:1,MINES_LIST:2,MINI_MAP:3,MAIN_TASK:4,DEMON:5,MULTI:6},m}(BaseMediator);y.GuajiMediator=e,__reflect(e.prototype,"game.GuajiMediator");var s=[]}(game||(game={})),function(a){var e=function(){function e(){}return e.create=function(e){if(e.vo){var t=void 0;if(null!=e.vo.type)switch(e.vo.type){case RiskEventType.Hinder:t=new a.EPHinder(e);break;case RiskEventType.Box:t=new a.EPBox(e);break;case RiskEventType.Mine:t=new a.EPMine(e);break;case RiskEventType.Creep:t=new a.EPCreep(e);break;case RiskEventType.StormWarCreep:t=new a.EPStormWarCreep(e);break;case RiskEventType.Gate:t=new a.EPGate(e);break;case RiskEventType.Tavern:case RiskEventType.Shop:case RiskEventType.MysticalShop:t=new a.EPShop(e);break;case RiskEventType.Fortress:t=new a.EPFortress(e);break;case RiskEventType.Maze:t=new a.EPMaze(e);break;case RiskEventType.Npc:t=new a.EPNpc(e);break;case RiskEventType.Quora:t=new a.EPQuora(e);break;case RiskEventType.Select:t=new a.EPSelect(e);break;case RiskEventType.Collect:t=new a.EPCollect(e);break;case RiskEventType.FingerGame:t=new a.EPFingerGame(e);break;case RiskEventType.GuessSize:t=new a.EPGuessSize(e);break;case RiskEventType.Trigger:t=new a.EPTrigger(e);break;case RiskEventType.Recharge:t=new a.EPFirstRecharge(e);break;case RiskEventType.StoryCreep:t=new a.EPCreep(e);break;case RiskEventType.BoxCreep:t=new a.EPBoxCreep(e);break;case RiskEventType.Task:t=new a.EPTask(e);break;case RiskEventType.Trigger2:var i=e.vo&&a.Config.riskEvent()[e.vo.eventId];if(i)switch(JSON.parse(i.detail)[0]){case RiskTrigger2Type.FlipCard:t=new a.EPSameCard(e);break;case RiskTrigger2Type.Unicursal:t=new a.EPUnicursal(e);break;case RiskTrigger2Type.Puzzle:t=new a.EPPuzzle(e);break;case RiskTrigger2Type.Sieve:t=new a.EPSieve(e);break;default:t=new a.EPTips(e)}else t=new a.EPTips(e);break;case RiskEventType.Manor:t=new a.EPManor(e);break;default:t=new a.EPTips(e)}else switch(e.vo.fadeType){case FadeRiskEventType.Creep:t=new a.EPFadeCreep(e);break;case FadeRiskEventType.Boss:t=new a.EPFadeBoss(e);break;case FadeRiskEventType.BigBoss:t=new a.EPFadeBigBoss(e);break;case FadeRiskEventType.ICON:t=new a.EPFadeIcon(e);break;case FadeRiskEventType.BigBoss2:t=new a.EPFadeBigBoss2(e)}return t}egret.warn("参数不对")},e}();a.EventPointFactory=e,__reflect(e.prototype,"game.EventPointFactory");var t=function(i){function t(e){var t=i.call(this)||this;return t.aStarCost=0,t.canTrigger=!0,t.isMapMoving=!1,t.py=a.AppFacade.getInstance().retrieveProxy(a.GuajiPy.N),t.mapObjType=100,(t.params=e).vo&&(t.type=e.vo.type,t.vo=e.vo,t.tileX=t.vo.position.x,t.tileY=t.vo.position.y),t.map=e.map,t}return __extends(t,i),t.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【RiskEP】："].concat(e))},t.getSubType=function(e){var t=a.Config.riskEvent()[e];return t&&t.subType||0},Object.defineProperty(t.prototype,"visible",{get:function(){return this.$visible},set:function(e){this.$setVisible(e),this.onVisibleUpdate()},enumerable:!0,configurable:!0}),t.prototype.addEffect=function(){this.effect||MovieClipTools.create("common_ditutswp",function(e){(this.effect=e).x=this.gp_foot.width/2,e.y=0,e.animation.play("common_ditutswp",-1),this.addChild(e)},this)},t.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.img_icon=new eui.Image,this.img_icon.horizontalCenter=0,this.img_icon.bottom=0,this.addChild(this.img_icon),this.gp_effect=new eui.Group,this.gp_effect.horizontalCenter=0,this.gp_effect.bottom=0,this.addChild(this.gp_effect),this.img_tips_bg=new eui.Image,this.img_tips_bg.horizontalCenter=0,this.img_tips_bg.bottom=0,this.img_tips_bg.source="_guaji_m_json.mx_img_mingchengdi",this.addChild(this.img_tips_bg),this.lb_tips=new eui.Label,this.lb_tips.bottom=3,this.lb_tips.size=16,this.lb_tips.verticalCenter=void 0,this.lb_tips.horizontalCenter=0,this.lb_tips.bold=!0,this.addChild(this.lb_tips),this.gp_foot.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.map.handleTouchTap(this.tileX,this.tileY)},this),this.touchEnabled=!1,this.img_icon.touchEnabled=!1,this.img_tips_bg.touchEnabled=!1},t.prototype.makeDefaultIcon=function(){var e=this.vo.eventId,t=a.Config.riskEvent()[e];if(t){if(e&&t){var i=t.descId,n=a.Config.riskEventDesc()[i];if(!n||!i)return"";var o=a.GeneralConfig.getGuajiImg(n.icon);return 1==o[0]?this.img_icon.source=o[1]:2==o[0]&&(this.cu_model&&this.cu_model.parent&&this.cu_model.parent.removeChild(this.cu_model),this.cu_model=new customui.HeroDynamicModel,this.cu_model.touchEnabled=!1,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=.32,this.gp_foot.addChild(this.cu_model),this.cu_model.update({model:o[1],isStatic:!0})),o[1]}return""}},t.prototype.updateData=function(){if(this.vo.isDirty){this.log("risk脏数据"),this.vo.iAmClean(),this.vo&&(this.tileX=this.vo.position.x,this.tileY=this.vo.position.y);var e=a.Config.riskEvent()[this.vo.eventId];if(e){var t=a.Config.riskEventDesc()[e.descId];if(t){var i=t.scaleX/100||1,n=t.scaleY/100||1;this.gp_foot.scaleX=i,this.gp_foot.scaleY=n}}this.onDataChange()}},t.prototype.onDataChange=function(){egret.warn("子类需要重写该方法")},t.prototype.onTrigger=function(e,t){e&&e()},t.prototype.checkTriggerCD=function(){var e=Utils.TimerManager.getServerTime();return t.lastTriggerTime+t.TriggerCD<e?(t.lastTriggerTime=e,!0):(console.log("事件重复点击"),!1)},t.prototype.onDestroy=function(){},t.prototype.onVisibleUpdate=function(){this.isMapMoving||this.cu_model&&this.cu_model.egretArmDisplay&&this.cu_model.egretArmDisplay.armature&&DragonBoneTools.switchDBClockPause(this.cu_model.egretArmDisplay.armature,!this.visible)},t.prototype.onMapMoving=function(e){this.isMapMoving=e,this.cu_model&&this.cu_model.egretArmDisplay&&this.cu_model.egretArmDisplay.armature&&DragonBoneTools.switchDBClockPause(this.cu_model.egretArmDisplay.armature,e)},t.prototype.onMapSwitch=function(e){this.cu_model&&this.cu_model.egretArmDisplay&&this.cu_model.egretArmDisplay.armature&&(e?DragonBoneTools.switchDBClockPause(this.cu_model.egretArmDisplay.armature,!this.visible):DragonBoneTools.switchDBClockPause(this.cu_model.egretArmDisplay.armature,!0))},t.prototype.hudongWithEP=function(e){},t.prototype.checkNotice=function(){return!0},t.prototype.handleStory=function(e,t){void 0===e&&(e=0);var i=a.Config.riskEvent()[this.vo.eventId],n=void 0;i.story&&(n=JSON.parse(i.story)[e]),n&&i&&i.story?PopUpManager.addPopUp({obj:new a.StoryView2({storyId:n,position:void 0,cb:function(){t&&t()}})}):t&&t()},t.lastTriggerTime=0,t.TriggerCD=2,t}(a.MapObj);a.EventPoint=t,__reflect(t.prototype,"game.EventPoint");var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.updateData=function(){this.vo.isDirty&&this.vo.config&&(this.vo.config.scaleX&&(this.gp_foot.scaleX*=this.vo.config.scaleX/100),this.vo.config.scaleY&&(this.gp_foot.scaleY*=this.vo.config.scaleY/100)),e.prototype.updateData.call(this)},t}(t);a.FadeEventPoint=i,__reflect(i.prototype,"game.FadeEventPoint")}(game||(game={})),function(e){var t=function(){function e(){}return e.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.BaseItem",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},e}();e.BaseItemFactory=t,__reflect(t.prototype,"customui.BaseItemFactory");var i=function(n){function e(e,t){var i=n.call(this)||this;return i.guajiPy=game.AppFacade.getInstance().retrieveProxy(game.GuajiPy.N),i.backProxy=game.AppFacade.getInstance().retrieveProxy(game.BackpackPy.N),i.heroProxy=game.AppFacade.getInstance().retrieveProxy(game.HeroPy.N),i.petProxy=game.AppFacade.getInstance().retrieveProxy(game.PetPy.N),i.heroThingProxy=game.AppFacade.getInstance().retrieveProxy(game.HeroThingPy.N),i.magicalArtifactPy=game.AppFacade.getInstance().retrieveProxy(game.MagicalArtifactPy.N),i.dungeonProxy=game.AppFacade.getInstance().retrieveProxy(game.DungeonPy.N),i.skinName="BaseItemSkin",i}return __extends(e,n),e.prototype.getVOByUuid=function(){if(this.uuid)switch(this.curEntityType){case EEntityType.EEntityTypeHero:this.vo=this.heroProxy.allHeroByUuid[this.uuid];break;case EEntityType.EEntityTypePet:this.vo=this.petProxy.allPetByUuid[this.uuid];break;case EEntityType.EEntityTypeHeroEquip:this.vo=this.heroThingProxy.AllEquipInfo[this.uuid];break;case EEntityType.EEntityTypeHeroArtifact:this.vo=this.heroThingProxy.AllArtiInfo[this.uuid];break;case EEntityType.EEntityTypeTreasure:this.vo=this.heroThingProxy.AllTreasureInfo[this.uuid];break;case EEntityType.EEntityTypeMagical:this.vo=this.magicalArtifactPy.allMagicalArtifactByUuid[this.uuid];break;case EEntityType.EEntityTypeMap:this.vo=this.guajiPy.AllMapInfo[this.uuid];break;case EEntityType.EEntityTypeVestageHero:this.vo=this.dungeonProxy.heroDict[this.uuid]}else this.vo=void 0},e.prototype.resetFixedStyle=function(e){switch(this.curEntityType=e,this.code=this.config=this.vo=void 0,this.curEntityType){case EEntityType.EEntityTypeHero:case EEntityType.EEntityTypePet:this.decorateLevel(void 0),this.decorateStar(1),this.gp_star_hero.removeChildren(),this.decorateIcon(""),this.decorateColorFrame(0),this.img_bg.source="_border_m_json.common_img_jichuwupingkuang",this.img_frame.parent.getChildIndex(this.img_frame)<this.img_icon.parent.getChildIndex(this.img_icon)&&this.img_frame.parent.swapChildren(this.img_frame,this.img_icon),this.decorateRaceIcon(""),this.decorateProfessionIcon(""),this.decorateNum(void 0),this.gp_effect.removeChildren()}},e.prototype.updateData=function(e){if(this._preParams=e,this._hasInit&&(e.reward&&(e.type=e.reward[0]||e.reward.type,e.code=e.reward[1]||e.reward.code,e.num=e.reward[2]||e.reward.num),this.style=e.style,this._source=e.source||BASEITEM_SOURCE.OTHER,this.curEntityType&&this.curEntityType!=e.type&&this.reset(!0),this.curEntityType=e.type,this.uuid=e.uuid,e.vo?this.vo=e.vo:this.getVOByUuid(),this.code=e.code||e.id||this.vo&&(this.vo.code||this.vo.id),null!=this.code))switch(this.curEntityType||(this.curEntityType=Math.floor(this.code/1e7)),this.curEntityType==EEntityType.EEntityTypeHeroArtifactCode&&(this.curEntityType=EEntityType.EEntityTypeHeroArtifact),this.curEntityType){case EEntityType.EEntityTypeVestageItem:case EEntityType.EEntityTypeItem:this.decorateItem(e);break;case EEntityType.EEntityTypeVestageHero:case EEntityType.EEntityTypeHero:this.decorateHero(e);break;case EEntityType.EEntityTypePet:this.decoratePet(e);break;case EEntityType.EEntityTypeHeroEquip:case EEntityType.EEntityTypeTreasure:case EEntityType.EEntityTypeHeroArtifact:this.decorateHeroThing(e);break;case EEntityType.EEntityTypeMagical:this.decorateMagical(e);break;case EEntityType.EEntityTypeMap:this.decorateMap(e);break;default:this.decorateCommon(e)}},e.prototype.onClick=function(){if(this.touchEnabled)if(Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),this.customTapEvent&&0!=this.customTapEvent());else if(this.curEntityType||this.code)switch(this.curEntityType){case EEntityType.EEntityTypeHero:case EEntityType.EEntityTypeVestageHero:game.AppFacade.getInstance().showSubView(game.HeroMediator.N,game.HeroMediator.SV.HERO_DETAIL,{code:this.code});break;case EEntityType.EEntityTypePet:break;case EEntityType.EEntityTypeMap:game.AppFacade.getInstance().sendNotification(CN.GUAJI_OPEN_CBT,{hideRewards:!0,config:this.config,vo:this.vo});break;default:if(this.config.type===EPropType.EPropTypeSelectBox)PopUpManager.addPopUp({obj:new game.BaseItemChoseView({code:this.code,source:this._source})});else if(this._source!=BASEITEM_SOURCE.BACKPACK||this.curEntityType!=EEntityType.EEntityTypeHeroEquip&&this.curEntityType!=EEntityType.EEntityTypeHeroArtifact&&this.curEntityType!=EEntityType.EEntityTypeTreasure)if(this.curEntityType==EEntityType.EEntityTypeHeroEquip||this.curEntityType==EEntityType.EEntityTypeHeroArtifact||this.curEntityType==EEntityType.EEntityTypeTreasure){var e=void 0;switch(this.curEntityType){case EEntityType.EEntityTypeHeroEquip:var t=game.Config.getHeroEquipUpgradeConfig(this.code);game.Config.getHeroEquipEnchantConfig(this.code);e={code:this.code,entityType:this.curEntityType,exp:0,fightCap:0,level:0,level2:0};break;case EEntityType.EEntityTypeHeroArtifact:t=game.Config.getHeroArtifactUpgradeConfig(this.code),game.Config.getHeroArtifactUpstarConfig(this.code);e={code:this.code,entityType:this.curEntityType,exp:0,fightCap:0,level:0,level2:0};break;case EEntityType.EEntityTypeTreasure:(t=game.Config.getTreasureJewelUpgradeConfig(TreasureJewelType.Atk))&&t.length&&t[t.length-1].level,this.code,this.curEntityType}e&&this.vo&&this.vo.filterShow&&(e=this.vo),game.AppFacade.getInstance().showSubView(game.HeroThingMediator.N,game.HeroThingMediator.SV.MAIN,{entityType:this.curEntityType,vo:e,source:game.HeroThingMainView.VIEW_SOURCE.HANDBOOK})}else PopUpManager.addPopUp({obj:new game.BaseItemDetailView({code:this.code,type:this.curEntityType,config:this.config,source:this._source,expiredDay:this._preParams.reward&&this._preParams.reward[5],expiredDt:this._preParams.expiredDt})});else game.AppFacade.getInstance().showSubView(game.HeroThingMediator.N,game.HeroThingMediator.SV.MAIN,{entityType:this.curEntityType,vo:this.vo,source:game.HeroThingMainView.VIEW_SOURCE.BACKPACK})}},e.prototype.addTapEvent=function(e,t){this.customTapEvent=e},e.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.gp_main.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.updateStyle(),this._hasInit=!0,this._preParams&&this.updateData(this._preParams)},e.prototype.reset=function(e){e||(this.x=this.y=0,this.touchEnabled=!0,this.visible=!0,this.scaleX=this.scaleY=1,this.bottom=this.top=this.left=this.right=this.horizontalCenter=this.verticalCenter=void 0,UIActionManager.setGrey(this,!1),this.customTapEvent=void 0),this.img_type.source="",this.img_type2.source="",this.img_profession.source="",this.blb_level.text="",this.blb_num.text="",this.blb_num.visible=!0,this.img_type.visible=!0,this.gp_star_hero.visible=!0,this.img_zudui.visible=!1,this.curEntityType=0,this.code=void 0,this.img_frame.parent.setChildIndex(this.img_frame,0),this.img_frame.source="",this.img_frame.scaleX=this.img_frame.scaleY=1.08,this.img_icon.source="",this.img_icon.visible=!0,this.img_icon.width=this.img_icon.height=86,this.img_bg.source="_border_m_json.common_img_jichuwupingkuang2",this.gp_effect.removeChildren(),this.updateStyle()},e.prototype.updateStyle=function(){this.img_type.visible=!1,this.blb_level.visible=!1,this.blb_num.visible=!1,this.gp_star_item.visible=!1,this.gp_star_hero.visible=!1,this.gp_star_hero2.visible=!1,this.img_type.visible=!0,this.blb_level.visible=!0,this.blb_num.visible=!0},e.prototype.decorateIcon=function(e){this.img_icon.source=e},e.prototype.decorateColorFrame=function(e){switch(this.curEntityType){case EEntityType.EEntityTypePet:this.img_frame.source="_border_m_json.moshou_img_tesukuang";break;case EEntityType.EEntityTypeVestageHero:case EEntityType.EEntityTypeHero:var t=0,i=game.GeneralConfig.getHeroStarInfo(e,!0);1<i.stage&&(t=i.stage+5),t=8<t?8:t,this.img_frame.scaleX=this.img_frame.scaleY=1.02,this.img_frame.source="_border_m_json.common_img_pinzhikuang_"+t;break;case EEntityType.EEntityTypeVestageItem:this.img_frame.source="_border_m_json.common_img_pinzhikuang_0";case EEntityType.EEntityTypeItem:this.config.type==EPropType.EPropTypeHeroSpirit?this.img_frame.source=SPRITE_COLOR_2_FRAME[e]:this.img_frame.source=COLOR_2_FRAME[e];break;default:this.img_frame.source=COLOR_2_FRAME[e]}},e.prototype.decorateLevel=function(e){null!=e?this.curEntityType==EEntityType.EEntityTypeHero||this.curEntityType==EEntityType.EEntityTypePet||this.curEntityType==EEntityType.EEntityTypeVestageHero?this.blb_level.text=""+e:this.blb_level.text="+"+e:this.blb_level.text=""},e.prototype.decorateNum=function(e){this.blb_num.text=null!=e?"0"==e?"":Utils.MathUtils.formatNumStyle1(Number(e)):""},e.prototype.decorateStar=function(e){if(this.gp_star_hero.visible=!1,this.gp_star_item.visible=!1,this.gp_star_hero2.visible=!1,this.curEntityType==EEntityType.EEntityTypeHeroEquip){var t=5*((n=game.GeneralConfig.getHeroStarInfo(Number(e),!1)).stage-1)+n.num;this.gp_star_item.visible=0<t;var i=game.Config.getHeroEquipConfig()[this.vo.code];i&&0<i.professionSuit?(this.gp_star_item.top=void 0,this.gp_star_item.bottom=0):(this.gp_star_item.top=0,this.gp_star_item.bottom=void 0),this.lb_starnum.text=String(t)}else{var n;if((n=game.GeneralConfig.getHeroStarInfo(Number(e),!0)).stage<4){this.gp_star_hero.visible=!0,this.gp_star_hero.removeChildren(),this.gp_star_hero.layout.gap=-2*n.stage-3;for(var o=0;o<n.num;o++){var a=new eui.Image(n.src);a.scaleX=a.scaleY=.4,this.gp_star_hero.addChild(a)}}else this.gp_star_hero2.visible=!0,this.blb_star_hero2.text=n.num.toString()}},e.prototype.decorateRaceIcon=function(e){void 0===e&&(e=""),this.img_type.visible=!0,this.img_type.source=e},e.prototype.decorateProfessionIcon=function(e,t){void 0===e&&(e=""),void 0===t&&(t=!1),this.img_profession.y=t?3:30,this.img_profession.visible=!0,this.img_profession.source=e},e.prototype.decorateType2Icon=function(e){this.img_type2.visible=!0,this.img_type2.source=e},e.prototype.decorateEffect=function(e,t){var i="common_yingxiongtouxiangkuang",n=1;t&&(i=t.effectName,t.scale&&(n=t.scale)),DragonBoneTools.create(i,function(e){e.x=this.sl_effect.width/2,e.y=this.sl_effect.height/2,e.scaleX=e.scaleY=n,e.animation.play(i,0),this.gp_effect.addChild(e)},this)},e.prototype.decorateCommon=function(e){var t=e.code||e.id,i=e.type||EEntityType.EEntityTypeMoney;if(t){for(var n=0,o=game.Config.propertyConfig();n<o.length;n++){var a=o[n];if(a.type===i&&a.code===t){this.config=a;break}}this.config&&(this.decorateColorFrame(this.config.color),this.decorateIcon(ResourceUtils.png(this.config.icon)),this.decorateNum(e.num))}},e.prototype.decorateMap=function(e){this.config=game.Config.getRiskMapByCode(this.code),this.config&&(this.decorateColorFrame(this.config.color),this.decorateIcon(ResourceUtils.png(this.config.icon)),this.gp_star_hero.visible=!1,this.img_type.visible=!1,this.img_type2.visible=!1),this.decorateNum(void 0)},e.prototype.decorateItem=function(e){if(this.config=game.Config.itemConfig()[this.code]||game.Config.vestageItemConfig()[this.code],this.config)if(this.decorateColorFrame(this.config.color),this.decorateIcon(ResourceUtils.png(this.config.icon)),this.gp_star_hero.visible=!1,this.img_type.visible=!1,this.img_type2.visible=!1,this.config.type==EPropType.EPropTypeChip){this.decorateType2Icon("beibao_img_suipian_png");var t=JSON.parse(this.config.effect),i=t[0][1],n=t[0][0],o=game.GeneralConfig.getEntityConfigByCode(n,i);n==EEntityType.EEntityTypeHero&&(this.decorateStar(o.initStar),0!=this.config.race?this.decorateRaceIcon(HeroRaceConfig[this.config.race].raceIcon):0==this.config.race&&1==t.length?this.decorateRaceIcon(HeroRaceConfig[o.race].raceIcon):this.decorateRaceIcon())}else this.config.type==EPropType.EPropTypeHeroSpirit?this.decorateRaceIcon(HeroRaceConfig[this.config.race].raceIcon):(e.reward&&e.reward[5]||e.expiredDt)&&this.decorateType2Icon("_border_m_json.common_icon_zhongbiao");this.decorateNum(e.num)},e.prototype.decoratePet=function(e){this.vo?(this.code=this.vo.code,this.decorateLevel(this.vo.level)):this.decorateLevel(e.level),this.config=game.Config.allPetConfig()[this.code],e.avatar?this.decorateIcon(ResourceUtils.png(e.avatar)):this.decorateIcon(ResourceUtils.png(this.config.avatar)),this.img_bg.source="_border_m_json.common_img_jichuwupingkuang",this.img_frame.parent.getChildIndex(this.img_frame)<this.img_icon.parent.getChildIndex(this.img_icon)&&this.img_frame.parent.swapChildren(this.img_frame,this.img_icon),this.decorateNum(e.num?e.num.toString():void 0)},e.prototype.decorateHero=function(e){this.vo&&(this.code=this.vo.code,this.decorateLevel(this.vo.level)),this.config=game.Config.allHeroConfig(this.curEntityType==EEntityType.EEntityTypePet)[this.code]||game.Config.creepConfig(this.code),this.curEntityType==EEntityType.EEntityTypeVestageHero?this.decorateStar(this.vo&&this.vo.starLevel||this.config.initStar):e.isNotShowStar?this.decorateStar(0):this.decorateStar(this.config.initStar),e.avatar?this.decorateIcon(ResourceUtils.png(e.avatar)):this.decorateIcon(ResourceUtils.png(this.config.avatar)),this.decorateColorFrame(this.config.initStar),this.img_bg.source="_border_m_json.common_img_jichuwupingkuang",this.img_frame.parent.getChildIndex(this.img_frame)<this.img_icon.parent.getChildIndex(this.img_icon)&&this.img_frame.parent.swapChildren(this.img_frame,this.img_icon),e.isShowMax?this.decorateLevel(this.vo&&this.vo.config&&this.vo.config.maxLevel):e.level&&this.decorateLevel(e.level),e&&e.ignoreLevel&&(this.blb_level.visible=!1),this.config&&this.config.race?this.decorateRaceIcon(HeroRaceConfig[this.config.race].raceIcon):this.decorateRaceIcon(),this.vo&&"chess"==this.vo.voType&&this.config&&this.config.profession?this.decorateProfessionIcon(ProfessionConfig[this.config.profession].icon):this.decorateProfessionIcon(),e.isShowZhongZhu&&this.decorateProfessionIcon(ProfessionConfig[this.config.profession].icon),this.decorateNum(e.num?e.num.toString():void 0),this.gp_effect.removeChildren(),e.effect&&this.curEntityType==EEntityType.EEntityTypeHero&&10<=this.config.initStar?this.decorateEffect(this.config.initStar):e.effect&&e.effectParam?this.decorateEffect(this.config.initStar,e.effectParam):e.effect&&e.isShowEffect&&e.avatar&&this.decorateEffect(this.config.initStar),this.img_zudui.visible=this.backProxy.checkHeroInTeam(this.uuid)},e.prototype.decorateMagical=function(e){game.Config.allMagicalConfig();this.config=game.Config.allMagicalConfig()[this.code],this.vo?(this.code=this.vo.code,this.decorateLevel(this.vo.level)):this.decorateLevel(e.level),this.decorateIcon(ResourceUtils.png(this.config.model))},e.prototype.decorateHeroThing=function(e){if(this.curEntityType==EEntityType.EEntityTypeHeroEquip)this.vo&&!this.vo.filterShow&&(this.decorateLevel(this.vo.level),this.decorateStar(this.vo.level2)),this.gp_effect.removeChildren(),this.config=game.Config.getHeroEquipConfig()[this.code],this.config.professionSuit?(this.decorateProfessionIcon(ProfessionConfig[this.config.professionSuit].icon,!0),this.decorateEffect(this.config.color)):this.decorateProfessionIcon("",!0);else if(this.curEntityType==EEntityType.EEntityTypeHeroArtifact)this.vo&&!this.vo.filterShow&&this.decorateLevel(this.vo.level),this.config=game.Config.getHeroArtifactConfig()[this.code],this.decorateStar(this.config.sectionLevel);else if(this.curEntityType==EEntityType.EEntityTypeTreasure){var t=game.Config.getHeroTreasureConfig(),i=t[this.code];if(this.vo){var n=0;if(4==Object.keys(this.vo.jewelLevel).length)for(var o in n=this.vo.jewelLevel[1]||0,this.vo.jewelLevel)n=Math.min(this.vo.jewelLevel[o],n);for(var a in t){var r=t[a];n>=r.level&&(i=r)}}else i=t[0];this.config=i}this.decorateIcon(ResourceUtils.png(this.config.icon)),this.decorateColorFrame(this.config.color);var s=e&&e.num||this.vo&&this.vo.num||1;this.decorateNum(e.isNum?void 0:s.toString())},e.prototype.onOPReset=function(){this.reset()},e.prototype.onOPComeBack=function(e,t){e&&this.updateData(e)},e.prototype.onOPClean=function(){},e.prototype.onOPCheck=function(e){egret.log("alive")},e}(eui.Component);e.BaseItem=i,__reflect(i.prototype,"customui.BaseItem",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(customui||(customui={})),function(t){var e=function(n){function e(e,t){var i=n.call(this)||this;return i.key=e,i.thiz=t,i}return __extends(e,n),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【"+this.key+"】："].concat(e))},e.prototype.register=function(){t.AppFacade.getInstance().registerCommand(this.key,this.thiz)},e.prototype.checkCB=function(e,t){return void 0===t&&(t=!0),!e.err||!t||(Utils.MsgUtils.addErrMsg(e.err),!1)},e}(puremvc.SimpleCommand);t.ProcessorBase=e,__reflect(e.prototype,"game.ProcessorBase",["puremvc.ICommand","puremvc.INotifier"])}(game||(game={})),function(a){var e=function(o){function e(e,t,i){void 0===t&&(t=MODULE.Risk);var n=o.call(this)||this;return n.isMe=!1,n.map=e,n.mapSource=t,n.vo=i,n.mapObjType=2,n.playerPy=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),n.py=a.AppFacade.getInstance().retrieveProxy(a.GuajiPy.N),n.walkPaths=new Array,n.hasWalkPassPath=new Array,n}return __extends(e,o),e.prototype.childrenCreated=function(){var t=this;o.prototype.childrenCreated.call(this),this.gp_foot.touchEnabled=!1;var e=new eui.Image("_guaji_m_json.maoxian_img_biaojiquan");e.horizontalCenter=0,e.bottom=-20,this.gp_foot.addChild(e),this.isMe&&(this.mapSource==MODULE.Manor?(this.lb_name=new eui.Label,this.lb_name.bottom=120,this.lb_name.horizontalCenter=0,this.lb_name.textAlign="center",this.lb_name.textColor=10092390,this.lb_name.size=16,this.gp_foot.addChild(this.lb_name),this.lb_name.text="S"+a.GameMVC.loginPy.serverSelect.area+"."+a.GameMVC.loginPy.playerProxy.playerInfoVO.name,this.manorBi=a.ManorBaseHeadFactory.create(),this.manorBi.scaleX=this.manorBi.scaleY=.7,this.manorBi.touchEnabled=!1,this.manorBi.horizontalCenter=0,this.manorBi.bottom=40,this.gp_foot.addChild(this.manorBi),this.img_name_bg=new eui.Image("_guaji_m_json.maoxian_img_biaoji"),this.img_name_bg.horizontalCenter=0,this.img_name_bg.bottom=0,this.gp_foot.addChild(this.img_name_bg)):this.mapSource==MODULE.StormWar?(this.roleDyModel=new customui.RoleDynamicModel({vo:this.vo}),this.roleDyModel.x=this.gp_foot.width/2,this.roleDyModel.y=this.gp_foot.height,this.gp_foot.addChild(this.roleDyModel),this.img_name_bg=new eui.Image("_stormWar_m_json.fbzc_img_guanjundi"),this.img_name_bg.height=83,this.img_name_bg.horizontalCenter=0,this.gp_foot.addChild(this.img_name_bg),this.lb_name=new eui.Label,this.lb_name.horizontalCenter=0,this.lb_name.textAlign="center",this.lb_name.textColor=0,this.lb_name.size=18,this.gp_foot.addChild(this.lb_name),this.lb_name.text="S"+a.GameMVC.loginPy.serverSelect.area+"."+a.GameMVC.loginPy.playerProxy.playerInfoVO.name,this.img_state=new eui.Image("_stormWar_m_json.fbzc_img_bukexuan"),this.img_state.horizontalCenter=0,this.gp_foot.addChild(this.img_state),this.roleDyModel.onArmatureLoadCB=function(){var e=t.roleDyModel.getHeadNameBottom();t.img_name_bg.bottom=e-t.img_name_bg.height/2-7.5,t.img_state.bottom=e-t.img_state.height,t.lb_name.bottom=e-t.lb_name.height}):(this.roleDyModel=new customui.RoleDynamicModel({vo:this.vo}),this.roleDyModel.x=this.gp_foot.width/2,this.roleDyModel.y=this.gp_foot.height,this.gp_foot.addChild(this.roleDyModel))),this.switchFocus(!0)},e.prototype.updateNPCOutLook=function(e){if(e){if(this.vo.fashionCode==e.fashionCode&&this.vo.horseCode==e.horseCode&&this.vo.titleCode==e.titleCode&&this.vo.magicalCode==e.magicalCode)return void egret.log("刷新模型形象，跳过");this.vo=e}egret.log("刷新模型形象"),this.roleDyModel.update({vo:this.vo})},e.prototype.resetTileXY=function(){this.lastTileX=this.lastTileY=void 0},e.prototype.setTilePos=function(e,t,i){void 0===i&&(i=!1),i?(this._tileX=e,this._tileY=t,this.updateFixedPos()):(this.tileX=e,this.tileY=t)},e.prototype.switchFocus=function(e){this.roleDyModel&&(this.roleDyModel.curModelAct=ROLE_ACTION_NAME.DJ)},e.prototype.showName=function(e){this.img_name_bg&&(this.img_name_bg.visible=e),this.lb_name&&(this.lb_name.visible=e)},e.prototype.showState=function(e){this.img_state&&this.img_state.visible!=e&&(this.img_state.visible=e)},e.prototype.updateBaseItem=function(e){this.manorBi&&(e.code?this.manorBi.updateData(e):this.manorBi.decorateIcon(ResourceUtils.png(e.avatar)))},e.prototype.walkByPath=function(e,t){var i=this;this.walkDoneCB=t,this.walkPaths.splice(0),e.forEach(function(e){i.walkPaths.push({tileX:e.y,tileY:e.x})}),0<this.walkPaths.length&&(this.walkPaths[this.walkPaths.length-1].isLast=!0),this.isMoving||this.walkByPathNext()},e.prototype.walkPathFinish=function(){this.roleDyModel&&(this.roleDyModel.curModelAct=ROLE_ACTION_NAME.DJ),this.walkDoneCB&&this.walkDoneCB(),this.walkDoneCB=void 0,this.hasWalkPassPath.splice(0),a.AppFacade.getInstance().sendNotification(CN.ME_MOVE_FINISH)},e.prototype.forceStop=function(){this.walkPaths.splice(0)},e.prototype.walkByPathNext=function(){var e=this.walkPaths.shift();e?(a.AppFacade.getInstance().sendNotification(CN.ME_MOVE_ONE_TILE,{x:e.tileX,y:e.tileY}),this.walkToTile(e.tileX,e.tileY)):this.walkPathFinish()},e.prototype.onChangingDir=function(e){this.roleDyModel&&this.roleDyModel.onChangingDir(e)},e.prototype.onWalking=function(){this.roleDyModel&&this.roleDyModel.curModelAct!=ROLE_ACTION_NAME.PB&&(this.roleDyModel.curModelAct=ROLE_ACTION_NAME.PB),this.hasWalkPassPath.push({x:this.tileX,y:this.tileY})},e.prototype.onAfterWalk=function(){if(o.prototype.onAfterWalk.call(this),this.customAfterWalkCB){var e=this.hasWalkPassPath[this.hasWalkPassPath.length-1];this.customAfterWalkCB(e.x,e.y)}this.walkByPathNext()},e.prototype.reset=function(){o.prototype.reset.call(this),egret.Tween.removeTweens(this),this.walkPaths.splice(0),this.walkDoneCB=void 0,this.hasWalkPassPath.splice(0),this.roleDyModel&&this.roleDyModel.reset(),this.isMoving=!1,this.visible=!1},e}(a.Npc);a.PlayerNpc=e,__reflect(e.prototype,"game.PlayerNpc")}(game||(game={})),function(s){var e=function(i){function e(e){var t=i.call(this)||this;return t._data=void 0,t.callBackList=[],t.guajiPy=s.AppFacade.getInstance().retrieveProxy(s.GuajiPy.N),t.skinName="BaseEpViewSkin",t._data=e,t}return __extends(e,i),Object.defineProperty(e.prototype,"vo",{get:function(){if(this._data&&this._data.vo)return this._data.vo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){if(this._data)return this._data},set:function(e){this._data=e,this.onDataChanged()},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data=this._data,this.makeCosts(),this.makeReward(),this.makeBtns(),this.makeGpFree(),this.makeBottomReward(),this.afterAllAdd()},e.prototype.onDataChanged=function(){this._data&&this.makeThreeComponent()},e.prototype.addCallBack=function(e,t,i,n){void 0===n&&(n=-1);var o={cb:e,thiz:t,params:i};-1==n?this.callBackList.push(o):this.callBackList.splice(n,0,o)},e.prototype.callNext=function(e){var t=this.callBackList[0];this.callBackList.shift(),t&&t.cb&&t.cb.call(t.thiz,e||t.params)},e.prototype.makeThreeComponent=function(e){void 0===e&&(e=0);var t=this.data&&this.data.vo&&this.data.vo.eventId,i=s.Config.riskEvent()[t];if(t&&i||e){var n=e||i.descId,o=s.Config.riskEventDesc()[n];if(!o||!n)return;this.lb_title.text=o.title;try{var a=(new egret.HtmlTextParser).parser(o.desc);this.lb_desc.textFlow=a}catch(e){this.lb_desc.text=o.desc}var r=s.GeneralConfig.getGuajiImg(o.img);1==r[0]?this.img_icon.source=r[1]:2==r[0]&&this.HeroDynamicModel.update({model:r[1],isStatic:!0})}},e.prototype.makeCosts=function(){},e.prototype.makeGpFree=function(){},e.prototype.makeBottomReward=function(){this.gp_bottomReward&&this.gp_bottomReward.parent&&this.gp_bottomReward.parent.removeChild(this.gp_bottomReward)},e.prototype.removeBottomReward=function(){this.gp_bottomReward&&this.gp_bottomReward.parent&&this.gp_bottomReward.parent.removeChild(this.gp_bottomReward)},e.prototype.makeReward=function(){this.gp_rewardParent&&this.gp_rewardParent.parent&&this.gp_rewardParent.parent.removeChild(this.gp_rewardParent)},e.prototype.makeBtns=function(){var e=this;this.addBtn({text:this.getConfigBtnText(),cb:function(){e.opperationParams=1,e.hide()}})},e.prototype.getConfigBtnText=function(e){void 0===e&&(e=0);var t=this.data&&this.data.vo&&this.data.vo.eventId,i=s.Config.riskEvent()[t];if(t&&i){var n=e||i.descId,o=s.Config.riskEventDesc()[n];return o?o&&o.buttonDesc:""}return""},e.prototype.addCost=function(e){s.AppFacade.getInstance().retrieveProxy(s.BackpackPy.N);for(var t in e){var i=e[t],n=new r({cost:i,needHave:!0});this.gp_costs.addChild(n)}},e.prototype.addBottomReward=function(e){for(var t in e){var i=e[t],n=customui.BaseItemFactory.create();n.scaleX=n.scaleY=.8,n.updateData({reward:i}),this.gp_bottomRewardDetail.addChild(n)}},e.prototype.addReward=function(e){for(var t in e){var i=e[t],n=customui.BaseItemFactory.create();n.scaleX=n.scaleY=.8,n.updateData({reward:i}),this.gp_reward.addChild(n)}},e.prototype.addBtn=function(e){var t=new eui.Group;t.width=162,t.height=64;var i=0;if(e.costs){var n=e.costs[0],o=new r({cost:n});o.horizontalCenter=0,t.addChild(o),i=55,t.height=119}var a=new eui.Button;return a.skinName="skins.ButtonSkinLabel",a.label=e.text,e.cb&&a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.cb&&e.cb.call(e.thiz)},this),a.y=i,a.horizontalCenter=0,t.addChild(a),this.gp_btns.addChild(t),a},e.prototype.afterAllAdd=function(){},e}(BasePanel);s.BaseEpView=e,__reflect(e.prototype,"game.BaseEpView");var r=function(n){function e(e){var t=n.call(this)||this;return t.params=e,t.skinName="EPCostItem",t}return __extends(e,n),e.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this);var e=s.AppFacade.getInstance().retrieveProxy(s.BackpackPy.N),t=this.params.cost,i=e.getInfoByCode(t[1]);this.img_icon.source=i.info.icon+"_png",this.params.needHave?this.bm_cost.text=Utils.MathUtils.formatNumStyle1(i.haveNum)+"/"+t[2]:this.bm_cost.text=""+t[2]},e}(eui.ItemRenderer);__reflect(r.prototype,"costItem");var t=function(i){function e(e){var t=i.call(this)||this;return t._data=void 0,t.callBackList=[],t.guajiPy=s.AppFacade.getInstance().retrieveProxy(s.GuajiPy.N),t.skinName="BaseEpViewSkin",t._data=e,t}return __extends(e,i),Object.defineProperty(e.prototype,"vo",{get:function(){if(this._data&&this._data.vo)return this._data.vo},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){if(this._data)return this._data},set:function(e){this._data=e,this.onDataChanged()},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data=this._data,this.makeReward(),this.makeBtns(),this.gp_img.parent.removeChild(this.gp_img),this.gp_bottomReward&&this.gp_bottomReward.parent&&this.gp_bottomReward.parent.removeChild(this.gp_bottomReward)},e.prototype.onDataChanged=function(){this._data&&this.makeThreeComponent()},e.prototype.makeThreeComponent=function(){if(this.data.config){this.lb_title.text=this.data.config.titleFixed||"事件结果";try{var e=JSON.parse(this.data.config.resultDesc)[this.data.order||0],t=(new egret.HtmlTextParser).parser(e);this.lb_desc.textFlow=t}catch(e){this.lb_desc.text=""}}if(this.data.eventId){var i=s.Config.riskEvent()[this.data.eventId];if(i.type==RiskEventType.Trigger2){var n=JSON.parse(i.detail);n[0]!=RiskTrigger2Type.FlipCard&&n[0]!=RiskTrigger2Type.Unicursal&&n[0]!=RiskTrigger2Type.Puzzle||DragonBoneTools.playOnce({effectName:"common_jmcg",parent:this.gp_effect,horizontalCenter:210,verticalCenter:60})}}},e.prototype.makeReward=function(){if(this.data.rewards){var e=this.data.rewards;this.addReward(e)}else this.gp_rewardParent&&this.gp_rewardParent.parent&&this.gp_rewardParent.parent.removeChild(this.gp_rewardParent)},e.prototype.makeBtns=function(){var e=this;this.addBtn({text:this.getConfigBtnText(),cb:function(){e.hide()}})},e.prototype.getConfigBtnText=function(e){return void 0===e&&(e=0),"确定"},e.prototype.addReward=function(e){for(var t in e){var i=e[t];if(i)for(var n in i){var o=i[n],a=customui.BaseItemFactory.create();a.scaleX=a.scaleY=.8,a.updateData({code:o.code,num:o.num||1}),this.gp_reward.addChild(a)}}},e.prototype.addBtn=function(e){var t=new eui.Group;t.width=162,t.height=64;var i=0;if(e.costs){var n=e.costs[0],o=new r({cost:n});o.horizontalCenter=0,t.addChild(o),i=55,t.height=119}var a=new eui.Button;a.skinName="skins.ButtonSkinLabel",a.label=e.text,e.cb&&a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.cb&&e.cb.call(e.thiz)},this),a.y=i,a.horizontalCenter=0,t.addChild(a),this.gp_btns.addChild(t)},e}(BasePanel);s.BaseEpRewardView=t,__reflect(t.prototype,"game.BaseEpRewardView")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.playerPy=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),e.skinName="CommonJiJieCenterPanelSkin",e}return __extends(e,t),e.prototype.onViewCreated=function(){console.warn("子类需要覆盖该方法")},e.prototype.onViewRemove=function(){console.warn("子类需要覆盖该方法")},e.prototype.onShowMyTeam=function(){console.warn("子类需要覆盖该方法")},e.prototype.perShow=function(){return!this.commonPy.isInTeam()||(this.onShowMyTeam(),!1)},e.prototype.showCreatePanel=function(e){var t=this;PopUpManager.addPopUp({obj:new n({defaultName:this.playerPy.playerInfoVO.name,doneCB:function(e){t.commonPy.Create(e,function(){t.hide(),t.onShowMyTeam()})}})})},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.cu_dtc.blb_title.text="集结大厅",this.cu_dtc.onCloseCB=function(){e.hide()},this.sl_root.verticalScrollBar.visible=!1,this.sl_root.verticalScrollBar.autoVisibility=!1,this.collection=new eui.ArrayCollection,this.list=new eui.List,this.sl_root.viewport=this.list,this.list.dataProvider=this.collection,this.list.itemRenderer=i,this.btn_create.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.showCreatePanel()},this),this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.commonPy.Refresh(function(){Utils.MsgUtils.addMidMsg("刷新成功"),e.updateList()})},this),this.btn_search.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""==e.tf_input.text?e.commonPy.Refresh(function(){e.updateList()}):Utils.Http.checkStrLegal(e.tf_input.text,!0)&&e.commonPy.Search(e.tf_input.text,function(){e.updateList()})},this),this.commonPy.GetCenterTeam(function(){e.updateList()}),this.onViewCreated()},e.prototype.updateView=function(e){this.commonPy.isInTeam()&&(this.mediator.hideSubView(this),this.onShowMyTeam()),e&&e.showCreate&&this.showCreatePanel(e),this.updateList()},e.prototype.updateList=function(){var t=this;this.collection.removeAll(),this.commonPy.centerTeams.forEach(function(e){t.collection.addItem({vo:e,opprCB:function(e){t.commonPy.Apply(e.vo.id,function(){e.changeEnable(!1)})}})}),0==this.collection.length?this.gp_empty.visible=!0:(this.gp_empty.visible=!1,this.collection.refresh())},e.prototype.onDestroy=function(){this.onViewRemove()},e}(BasePanel);a.CommonJiJieCenterPanel=e,__reflect(e.prototype,"game.CommonJiJieCenterPanel");var i=function(o){function e(){var e=o.call(this)||this;return e.POS_X=[8,84,164],e.skinName="CommonJiJieCenterItemRenderSkin",e}return __extends(e,o),e.prototype.childrenCreated=function(){var i=this;o.prototype.childrenCreated.call(this),this.btn_oppr.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.data.opprCB&&i.data.opprCB(i)},this);for(var e=function(e){var t=n["cu_ph_"+e];if(!t)return"continue";t.addTapEvent(function(){i.vo.members[e-1]&&i.vo.members[e-1].baseInfo&&a.AppFacade.getInstance().showSubView(a.FriendMediator.N,a.FriendMediator.SV.INFO,{playerId:i.vo.members[e-1].baseInfo.playerId})})},n=this,t=1;t<=3;t++)e(t)},e.prototype.dataChanged=function(){var n=this;this.vo=this.data.vo,this.changeEnable(!0),a.GameMVC.loginPy.loginGameVO.singleSign?this.lb_name.text=""+this.vo.name:this.lb_name.text="S"+this.vo.serverId+"·"+this.vo.name,this.item_fightCap.update(this.vo.fightCap),this.lb_time.visible&&(this.lb_time.visible=!1),this.gp_left.$children.forEach(function(e,t){var i=n.vo.members[t];i?e.updateData({vo:i.baseInfo,showTag:i.isLeader}):e.updateData({vo:void 0})})},e.prototype.changeEnable=function(e){e?(this.btn_oppr.visible=!0,this.gp_has_oppr.visible=!1):(this.btn_oppr.visible=!1,this.gp_has_oppr.visible=!0)},e}(eui.ItemRenderer);a.CommonJiJieCenterItemRender=i,__reflect(i.prototype,"game.CommonJiJieCenterItemRender");var n=function(i){function e(e){var t=i.call(this)||this;return t.skinName="CommonJiJieTeamCreatePanelSkin",t.doneCB=e.doneCB,t.defaultName=e.defaultName,t.tips=e.tips,t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.cu_dtc.blb_title.text="创 建",this.cu_dtc.onCloseCB=function(){e.hide()},this.tf_input.text=this.defaultName,this.tips&&(this.lb_tips.text=this.tips),this.btn_create.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.tf_input.text=e.tf_input.text.substr(0,7),Utils.Http.checkStrLegal(e.tf_input.text,!0)&&(e.doneCB&&e.doneCB(e.tf_input.text),e.hide())},this)},e}(BasePanel);a.CommonJiJieTeamCreatePanel=n,__reflect(n.prototype,"game.CommonJiJieTeamCreatePanel")}(game||(game={})),function(g){var e=function(i){function e(e){var t=i.call(this)||this;return t.skinName="CommonJiJieMyTeamApplyPanelSkin",(t.params=e)&&(t.doneCB=e.doneCB),t}return __extends(e,i),e.prototype.onFetch=function(e){console.warn("子类需要覆盖该方法")},e.prototype.onViewCreated=function(){console.warn("子类需要覆盖该方法")},e.prototype.onViewRemove=function(){console.warn("子类需要覆盖该方法")},e.prototype.onDestroy=function(){this.onViewRemove(),this.doneCB&&this.doneCB()},e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.cu_dtc.blb_title.text="申请列表",this.cu_dtc.onCloseCB=function(){e.hide()},this.sl_root.verticalScrollBar.visible=!1,this.sl_root.verticalScrollBar.autoVisibility=!1,this.collection=new eui.ArrayCollection,this.list=new eui.List,this.sl_root.viewport=this.list,this.list.dataProvider=this.collection,this.list.itemRenderer=t,this.btn_dele.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.commonPy.Refuse(0,function(){e.commonPy.applyRecords.splice(0),e.updateInfo()})},this),this.onFetch(function(){e.updateInfo()}),this.onViewCreated()},e.prototype.updateInfo=function(){var h=this,p=[];if(this.commonPy.isInTeam()){this.lb_count.text="请求信息:"+this.commonPy.applyRecords.length,this.collection.removeAll();for(var d=0,e=function(e){if(u.params.moduleId==MODULE.TeamExpedition){for(var t=g.AppFacade.getInstance().retrieveProxy(g.TeamExpePy.N),i=!1,n=0,o=t.info.teamInfo.team.members;n<o.length;n++){o[n].baseInfo.playerId==e.member.baseInfo.playerId&&(i=!0)}for(var a=!1,r=0,s=t.invitePlayerIds;r<s.length;r++){var c=s[r];e.member.baseInfo.playerId==c&&(a=!0,p.push(e))}if(!a||i)return"continue"}var l;l={vo:e,opprCB:function(e){h.commonPy.Agree(e.data.vo.member.baseInfo.playerId,function(){h.commonPy.applyRecords.splice(d,1),h.lb_count.text="请求信息:"+h.commonPy.applyRecords.length;var e=h.collection.source.indexOf(l);0<=e&&h.collection.removeItemAt(e)})}},u.collection.addItem(l),++d},u=this,t=0,i=this.commonPy.applyRecords;t<i.length;t++){e(i[t])}this.params.moduleId==MODULE.TeamExpedition&&g.AppFacade.getInstance().sendNotification(CN.UPDATE_APPLYRECORDS,{records:p}),0==this.collection.length?this.gp_empty.visible=!0:(this.gp_empty.visible=!1,this.collection.refresh())}else this.lb_count.text="0",Utils.MsgUtils.addMidMsg("暂无队伍信息")},e}(BasePanel);g.CommonJiJieMyTeamApplyPanel=e,__reflect(e.prototype,"game.CommonJiJieMyTeamApplyPanel");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="CommonJiJieMyTeamApplyRenderSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_oppr.label="通 过",this.btn_oppr.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.opprCB&&e.data.opprCB(e)},this),this.cu_ph_1.addTapEvent(function(){g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N);g.AppFacade.getInstance().showSubView(g.FriendMediator.N,g.FriendMediator.SV.INFO,{playerId:e.data.vo.member.baseInfo.playerId})})},e.prototype.dataChanged=function(){this.lb_name.text="S"+this.data.vo.member.baseInfo.serverId+"·"+this.data.vo.member.baseInfo.name,this.item_fightCap.update(this.data.vo.member.baseInfo.fightCap),this.lb_time.text=Utils.TimerManager.getTimeLeftDescBySecond(Math.max(0,Utils.TimerManager.getServerTime()-this.data.vo.dt)),this.cu_ph_1.updateData({vo:this.data.vo.member.baseInfo})},e}(eui.ItemRenderer);__reflect(t.prototype,"CommonJiJieMyTeamApplyRender")}(game||(game={})),function(s){var e=function(t){function e(){var e=t.call(this)||this;return e.index2Obj={},e.POS=[0,120,240],e.skinName="CommonJiJieMyTeamPanelSkin",e}return __extends(e,t),e.prototype.onShowCenter=function(){console.warn("子类需要覆盖该方法")},e.prototype.canKick=function(){console.warn("子类需要覆盖该方法")},e.prototype.onViewCreated=function(){console.warn("子类需要覆盖该方法")},e.prototype.onViewRemove=function(){console.warn("子类需要覆盖该方法")},e.prototype.onShowApply=function(e){console.warn("子类需要覆盖该方法")},e.prototype.onFetch=function(e){console.warn("子类需要覆盖该方法")},e.prototype.inviteCallback=function(){console.warn("子类需要覆盖该方法")},e.prototype.perShow=function(){return!!this.commonPy.isInTeam()||(this.onShowCenter(),!1)},e.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),this.cu_dtc.blb_title.text="设置阵容",this.cu_dtc.img_close.horizontalCenter=310,this.cu_dtc.onCloseCB=function(){i.hide()},this.btn_switch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=[];i.commonPy.team.members.forEach(function(e){e.isLeader||t.push(e)}),PopUpManager.addPopUp({obj:new s.CommonJiJieMyTeamSwitchPanel({members:t,doneCB:function(e){i.commonPy.SwitchLeader(e.baseInfo.playerId,function(){i.updateView()})}})})},this),this.btn_apply.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.onShowApply(function(){i.updateView()})},this),this.btn_disband.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.commonPy.Quit(function(){i.hide(),i.onShowCenter()})},this),this.onViewCreated()},e.prototype.updateView=function(){this.updateInfo()},e.prototype.changeOrderAbove=function(o){var a=this;if(!this.isChanging){var r=this.index2Obj[o.index-1];r&&(this.isChanging=!0,r.gp_btns.visible=!1,o.gp_btns.visible=!1,egret.Tween.get(o).to({y:r.y},250,egret.Ease.sineInOut),egret.Tween.get(r).to({y:o.y},250,egret.Ease.sineInOut).call(function(){r.gp_btns.visible=!0,o.gp_btns.visible=!0;var e=r.index;r.changeOrder(o.index),o.changeOrder(e),a.index2Obj[o.index]=o,a.index2Obj[r.index]=r,a.isChanging=!1;var t=[];for(var i in a.index2Obj)t.push(a.index2Obj[i]);t.sort(function(e,t){return e.y-t.y});var n=[];t.forEach(function(e){e.vo&&n.push(e.vo.baseInfo.playerId)}),a.commonPy.SaveFormation(n,function(){a.updateView()})}))}},e.prototype.updateBtnStyle=function(){var e=this.commonPy.amILeader(),t=this.commonPy.team.members;UIActionManager.setAbsGrey(this.btn_switch,!e),UIActionManager.setAbsGrey(this.btn_apply,!e||e&&3==t.length),this.btn_apply.touchEnabled=this.btn_switch.touchEnabled=e},e.prototype.updateInfo=function(){var i=this;if(this.commonPy.isInTeam()){this.blb_cap.text=Utils.MathUtils.formatNumStyle2(this.commonPy.team.fightCap),this.lb_id.text="队伍ID:"+this.commonPy.team.id;var n=this.commonPy.amILeader();if(this.updateBtnStyle(),0==this.gp_team.numChildren)for(var e=0;e<3;e++){var t=this.commonPy.team.members[e],o=new c({index:e,vo:t,amILeader:n,canKick:this.canKick(),opprCB:function(e){i.changeOrderAbove(e)},opprCB2:function(t){var e=[];e.push({text:"是否将",style:{textColor:11041365,size:24}}),e.push({text:" "+t.vo.baseInfo.name+" ",style:{textColor:4557956,size:24}}),e.push({text:"逐出队伍？",style:{textColor:11041365,size:24}}),s.GameMgr.getInstance().showCommonTipsWin({commonTips:e,cb:!1,clickCB:function(e){0===e.type||1===e.type&&i.commonPy.Kick(t.vo.baseInfo.playerId,function(){i.updateView()})}})},inviteCallback:this.inviteCallback});o.y=this.POS[e],this.gp_team.addChild(o),this.index2Obj[e]=o}var a=[];for(var r in this.commonPy.team.members.forEach(function(e,t){a.push(t),i.index2Obj[t].update(e,n,i.canKick())}),this.index2Obj)-1==a.indexOf(Number(r))&&this.index2Obj[r].update()}else this.blb_cap.text="0",this.mediator.hideSubView(this)},e.prototype.onDestroy=function(){this.onViewRemove()},e}(BasePanel);s.CommonJiJieMyTeamPanel=e,__reflect(e.prototype,"game.CommonJiJieMyTeamPanel");var c=function(n){function e(e){var t=n.call(this)||this;return t.playerProxy=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N),t.heroPy=s.AppFacade.getInstance().retrieveProxy(s.HeroPy.N),t.params=e,t.index=e.index,t.skinName="CommonJiJieMyTeamPanelRenderSkin",t}return __extends(e,n),e.prototype.childrenCreated=function(){var e=this;n.prototype.childrenCreated.call(this),this.btn_oppr.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.params.opprCB&&e.params.opprCB(e)},this),this.btn_kick.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.params.opprCB2&&e.params.opprCB2(e)},this),this.btn_invite.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.params.inviteCallback&&e.params.inviteCallback()},this),this.gp_formation.removeChildren();for(var t=0;t<6;t++){var i=customui.BaseItemFactory.create();i.scaleX=i.scaleY=.55,this.gp_formation.addChild(i)}},e.prototype.update=function(e,t,i){var n=this;this.vo=e,null!=t&&(this.params.amILeader=t),null!=i&&(this.params.canKick=i),this.lb_index.text=(Number(this.index)+1).toString(),this.gp_formation.$children.forEach(function(e){e.visible=!1}),this.vo?(this.playerProxy.GetPublicPlayerInfo([this.vo.baseInfo.playerId],function(e,t){t[n.vo.baseInfo.playerId].publicPlayer.heroList.forEach(function(e,t){var i=n.gp_formation.getChildAt(t);i&&(i.visible=!0,i.updateData({vo:e,type:EEntityType.EEntityTypeHero,code:e.code}))})}),this.btn_oppr.visible=!!this.params.amILeader&&0!=this.index,this.btn_kick.visible=!!this.params.amILeader&&(this.vo.baseInfo.playerId!=this.playerProxy.playerInfoVO.playerId&&this.params.canKick),this.img_tag.visible=e.isLeader,this.lb_name.y=3,s.GameMVC.loginPy.loginGameVO.singleSign?this.lb_name.text=""+this.vo.baseInfo.name:this.lb_name.text="S"+this.vo.baseInfo.serverId+"·"+this.vo.baseInfo.name,this.blb_cap.text=Utils.MathUtils.formatNumStyle2(this.vo.baseInfo.fightCap),this.btn_invite.visible=!1,this.gp_fightCap.visible=!0,this.img_nameBg.visible=!0,this.lb_name.textColor=16777215):(this.btn_kick.visible=this.btn_oppr.visible=!1,this.img_tag.visible=!1,this.lb_name.y=34.35,this.lb_name.text="等待玩家加入",this.blb_cap.text="0",this.btn_invite.visible=!0,this.gp_fightCap.visible=!1,this.img_nameBg.visible=!1,this.lb_name.textColor=5841675)},e.prototype.changeOrder=function(e){this.index=e,this.lb_index.text=(Number(this.index)+1).toString(),this.btn_oppr.visible=!!this.params.amILeader&&0!=this.index,this.btn_kick.visible=!!this.params.amILeader&&(this.vo.baseInfo.playerId!=this.playerProxy.playerInfoVO.playerId&&this.params.canKick)},e}(eui.Component);__reflect(c.prototype,"CommonJiJieMyTeamPanelRender")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.mailProxy=o.AppFacade.getInstance().retrieveProxy(o.MailPy.N),t.initNotice(),t}return __extends(n,i),Object.defineProperty(n.prototype,"rootView",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),n.prototype.initNotice=function(){},n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.MailUI),this.addSubView(n.SV.INFO,o.MailInfo)},n.prototype.listNotificationInterests=function(){return[CN.LOGIN_FINAL_DONE,CN.MAIL_OPEN_MAIN,CN.MAIL_CLOSE_MAIN,CN.HIDE_ALL_SUBVIEW]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.MAIL_OPEN_MAIN:case CN.MAIL_CLOSE_MAIN:this.hideAllSubView(),this.rootView&&(this.rootView.visible=!1);break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView(),this.removeFromParent(),this.rootView&&(this.rootView.visible=!1);break;case CN.LOGIN_FINAL_DONE:this.mailProxy.getMailList()}},n.prototype.onViewCreate=function(){},n.N="MailMediator",n.SV={MAIN:1,INFO:2},n}(BaseMediator);o.MailMediator=e,__reflect(e.prototype,"game.MailMediator")}(game||(game={})),function(c){var e=function(t){function n(){var e=t.call(this)||this;return e.tabIndex=0,e.rankProxy=c.AppFacade.getInstance().retrieveProxy(c.RankPy.N),e.rankMed=c.AppFacade.getInstance().retrieveMediator(c.RankMediator.N),e.skinName="CommonRankAndRewardPanelSkin",e}return __extends(n,t),n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.rankMed.hideAllSubView()},this),this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin"},n.prototype.initUI=function(){this.configs.length&&1<this.configs.length?(this.tabbar.visible=!0,this.initTabbar(),this.onTabbarItemTap()):(this.tabbar.visible=!1,this.showPanel(this.configs[0]||this.configs)),this.initialized=!0},n.prototype.initTabbar=function(){var i=[];this.configs.forEach(function(e){var t={source:{},config:e};e.tabbarSource?t.source=e.tabbarSource:(t.source.up=e.type==n.VIEW_TYPE.RANK?"_btn_yq_m_json.jjc_yeqian_paiming_0":"_btn_yq_m_json.beibao_yeqian_baoxiang_0",t.source.down=e.type==n.VIEW_TYPE.RANK?"_btn_yq_m_json.jjc_yeqian_paiming_1":"_btn_yq_m_json.beibao_yeqian_baoxiang_1"),i.push(t)}),this.tabbar.dataProvider=new eui.ArrayCollection(i),this.tabbar.selectedIndex=this.index,this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabbarItemTap,this)},n.prototype.onTabbarItemTap=function(e){e&&null!=e.itemIndex&&e.itemIndex!=this.tabIndex&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.tabIndex=e.itemIndex);var t=this.tabbar.selectedItem.config;this.rankMed.hideAllContentPanel(),this.showPanel(t)},n.prototype.updateView=function(e){this.module=e&&e.module||this.module,this.index=e.index||0,this.module?this.configs=c.RankConfig.Config[this.module]:this.configs=e,this.configs&&(this.initialized||this.initUI())},n.prototype.showPanel=function(e){if(e.clickFunc)e.clickFunc();else{switch(e.type||n.VIEW_TYPE.RANK){case n.VIEW_TYPE.RANK:this.blb_title.text=e.mainTitle||"排行榜",this.rankMed.showSubView(c.RankMediator.SV.COMMON_RANK,e);break;case n.VIEW_TYPE.REWARD:this.blb_title.text=e.mainTitle||"奖励",this.rankMed.showSubView(c.RankMediator.SV.COMMON_REWARD,e)}e&&e.bottomLabel?this.lb_bottom.text=e.bottomLabel:this.lb_bottom.text=""}},n.prototype.perClose=function(){this.rankMed.hideAllContentPanel()},n.VIEW_TYPE={RANK:1,REWARD:2},n}(BasePanel);c.CommonRankAndRewardPanel=e,__reflect(e.prototype,"game.CommonRankAndRewardPanel");var t=function(t){function e(){var e=t.call(this)||this;return e.rankProxy=c.AppFacade.getInstance().retrieveProxy(c.RankPy.N),e.skinName="CommonRankPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scaleX=this.scaleY=1,UIActionManager.hideScrollerBar(this.scl_list),this.list_item.itemRenderer=n,this.gp_tab1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onTabTap(1)},this),this.gp_tab2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onTabTap(2)},this)},e.prototype.updateView=function(e){this.config=e&&e.configs?e.configs:e,this.initialize?this.updateList(this.targetConfig):this.initial()},e.prototype.initial=function(){this.config.length&&1<this.config.length?(this.gp_tab1.visible=!0,this.gp_tab2.visible=!0,this.bm_tabTitle1.text=this.config[0].title||"",this.bm_tabTitle2.text=this.config[1].title||"",this.gp_topTitle.visible=!1,this.gp_topTitle2.visible=!0,this.gp_content.height=530,this.img_bg.height=664,this.onTabTap(1)):(this.gp_topTitle.visible=!0,this.gp_topTitle2.visible=!1,this.gp_tab1.visible=!1,this.gp_tab2.visible=!1,this.bm_tabTitle1.visible=!1,this.bm_tabTitle2.visible=!1,this.gp_content.height=593,this.img_bg.height=735,this.onTabTap()),this.initialize=!0},e.prototype.onTabTap=function(e){e?(this.gp_root.setChildIndex(this.gp_tab1,1==e?2:0),this.gp_root.setChildIndex(this.gp_tab2,1==e?0:2),this.img_bg.source=1==e?"common_img_shuzhidi_04_png":"common_img_shuzhidi_05_png",this.targetConfig=this.config[e-1],this.lb_name_desc2.text=(this.targetConfig.isGuild?"公会名称":this.targetConfig.isTeam&&"队伍")||"玩家姓名",this.lb_keyWord2.text=this.targetConfig.keyWord||"战力"):this.targetConfig=this.config[0]||this.config,n.targetTab=e,this.updateList(this.targetConfig)},e.prototype.updateSelfRank=function(e,t){var n=this;this.gp_playerHead.removeChildren();var i=e&&e.rank;if(i){var o=this.rankProxy.rankIcon(i);""!=o?(this.blb_rank.visible=!1,this.img_icon.visible=!0,this.img_icon.source=o):(this.blb_rank.visible=!0,this.img_icon.visible=!1,this.blb_rank.text=i.toString())}else this.img_icon.visible=!1,this.blb_rank.visible=!0,this.blb_rank.text="未上榜";if(this.lb_name.visible=!0,e.team)e.team.members.forEach(function(e,t){var i=customui.PlayerHeadFactory.create();i.blb_level.visible=!1,i.updateData({vo:e.baseInfo}),n.gp_playerHead.addChild(i)}),this.lb_name.visible=!1;else if(t)if(this.lb_name.x=220,e.guildBaseInfo){this.lb_name.text=e.guildBaseInfo.name;var a=customui.GuildHeadFactory.create();a.updateData({vo:e.guildBaseInfo}),this.gp_playerHead.addChild(a)}else this.lb_name.text=e.playerBaseInfo.name;else{var r=customui.PlayerHeadFactory.create();r.blb_level.visible=!1,r.updateData({vo:e.playerBaseInfo}),this.gp_playerHead.addChild(r),this.lb_name.x=220,this.lb_name.text=e.playerBaseInfo.name}if(this.gp_extra.visible=!1,this.gp_fightCap.visible=!1,this.lb_keyValue.visible=!1,this.targetConfig.getExtraItem)if(this.gp_extra.visible=!0,this.gp_extra.numChildren){if(this.targetConfig.updateExtraItem){var s=this.gp_extra.$children[0];this.targetConfig.updateExtraItem(s,e)}}else(s=this.targetConfig.getExtraItem(e)).horizontalCenter=s.verticalCenter=0,this.gp_extra.addChild(s);else this.targetConfig.keyWord?(this.lb_keyValue.visible=!0,this.lb_keyValue.text=e.key&&e.key.toString()||"0"):(this.gp_fightCap.visible=!0,this.item_fightCap.update(e.playerBaseInfo.fightCap))},e.prototype.updateList=function(r){var s=this;if(r.rankType==RankingType.RankingTypeGuildTranscript){var e=[];for(var t in r.getRankList()){var i={info:r.getRankList()[t],config:r};e.push(i)}0<e.length?this.gp_empty.visible=!1:this.gp_empty.visible=!0,this.list_item.dataProvider=new eui.ArrayCollection(e),this.updateSelfRank(r.getRank()[0])}else this.rankProxy.GetRankList(r,function(e){var t=e.ranks;if(0<t.length){s.scl_list.visible=!0,s.gp_empty.visible=!1;var i=[];for(var n in t){var o={info:t[n],config:r};i.push(o)}s.list_item.dataProvider=new eui.ArrayCollection(i)}else s.scl_list.visible=!1,s.gp_empty.visible=!0;var a=e.selfRank||{};a.playerBaseInfo=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N).playerInfoVO,a.guildBaseInfo=c.AppFacade.getInstance().retrieveProxy(c.GuildPy.N).guildDetail,s.updateSelfRank(a,r.isGuild)});this.lb_name_desc.text=(r.isGuild?"公会名称":r.isTeam&&"队伍")||"玩家姓名",this.lb_keyWord.text=r.keyWord||"战力",this.lb_bottom.text=""},e.prototype.getParentView=function(){return c.AppFacade.getInstance().retrieveMediator(c.RankMediator.N).getSubView(c.RankMediator.SV.COMMON).gp_content},e}(BaseView);c.CommonRankPanel=t,__reflect(t.prototype,"game.CommonRankPanel");var i=function(t){function r(){var e=t.call(this)||this;return e.initialize=!1,e.skinName="CommonRewardPanelSkin",e}return __extends(r,t),r.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.scaleX=this.scaleY=1,this.activateComponent()},r.prototype.initial=function(){this.configs.length&&1<this.configs.length?(this.gp_tab1.visible=!0,this.gp_tab2.visible=!0,this.bm_tabTitle1.text=this.configs[0].title||"",this.bm_tabTitle2.text=this.configs[1].title||"",this.gp_topTitle.visible=!1,this.gp_content.height=585,this.img_bg.height=664,this.onTabTap(1)):(this.gp_tab1.visible=!1,this.gp_tab2.visible=!1,this.bm_tabTitle1.visible=!1,this.bm_tabTitle2.visible=!1,this.lb_topLeft.text=this.configs[0].topTitle?"成就":"排名",this.img_bg.source=this.configs[0].topTitle?"common_img_shuzhidi_05_png":"common_img_shuzhidi_04_png",this.lb_topRight.x=this.configs[0].topTitle?272:326,this.gp_content.height=650,this.img_bg.height=735,this.onTabTap()),this.initialize=!0},r.prototype.updateView=function(e){this.configs=e&&e.configs||this.configs,this.initialize?this.updateList(this.targetConfig):this.initial(),this.notice=this.configs.notice,this.addNotice()},r.prototype.onTabTap=function(e){e?(this.gp_tab.setChildIndex(this.gp_tab1,1==e?2:0),this.gp_tab.setChildIndex(this.gp_tab2,1==e?0:2),this.img_bg.source=1==e?"common_img_shuzhidi_04_png":"common_img_shuzhidi_05_png",this.targetConfig=this.configs[e-1],this.targetConfig.desc?(this.gp_topTitle2.visible=!0,this.lb_topLeft2.text=this.targetConfig.desc[0]||"",this.lb_topRight2.text=this.targetConfig.desc[1]||""):this.gp_topTitle2.visible=!1):(this.gp_topTitle2.visible=!1,this.targetConfig=this.configs[0]||this.configs),s.targetTab=e,this.updateList(this.targetConfig),this.targetConfig.img_bestRank?this.img_bestRank.source=this.targetConfig.img_bestRank:this.img_bestRank.source="paiweisai_txt_ndlszgpm_png"},r.prototype.updateList=function(e){var i=this;if(e.getTopRankInfo){this.gp_topTitle.visible=!1,this.gp_rank_reward.visible=!0,this.scl_list.top=120;var t=e.getTopRankInfo();this.blb_rank.text=(t.topRank||0).toString(),this.lb_desc.text=t.desc,this.gp_rewards.removeChildren(),t.targetRewards.forEach(function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.65,t.updateData({reward:e}),i.gp_rewards.addChild(t)})}else this.gp_rank_reward.visible=!1,this.scl_list.top=0;switch(e.type){case r.VIEW_TYPE.RANK_REWARD:this.list_item.itemRenderer=s;break;case r.VIEW_TYPE.SCORE_REWARD:this.list_item.itemRenderer=l;break;case r.VIEW_TYPE.SCORE_REWARD2:this.list_item.itemRenderer=h}this.scl_list.stopAnimation(),this.scl_list.viewport.scrollV=0;var n=e.getRewardList();this.list_item.dataProvider=new eui.ArrayCollection(n);var o=!1;for(var a in n){if(n[a].status==REWARD_STATUS.AVAILABLE){o=!0;break}}e&&e.bottomBtn?(this.btn_bottom.label=e.bottomBtn.label,this.bottomBtnCb=function(){e.bottomBtn.callback&&e.bottomBtn.callback()},this.btn_bottom.visible=!0,UIActionManager.setAbsGrey(this.btn_bottom,!o),this.btn_bottom.touchEnabled=o):this.btn_bottom.visible=!1,this.lb_bottom.text=e.getBottomLabel&&e.getBottomLabel()||"",this.lb_bottomLeft.text=e.getBottomLeftLabel&&e.getBottomLeftLabel()||""},r.prototype.activateComponent=function(){var e=this;this.gp_tab1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onTabTap(1)},this),this.gp_tab2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onTabTap(2)},this),this.btn_bottom.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.bottomBtnCb&&e.bottomBtnCb()},this)},r.prototype.getParentView=function(){return c.AppFacade.getInstance().retrieveMediator(c.RankMediator.N).getSubView(c.RankMediator.SV.COMMON).gp_content},r.prototype.addNotice=function(){this.configs[1]&&this.configs[1].notice&&this.configs[1].notice!=this.notice&&(this.notice=this.configs[1].notice,NoticeManager.addNoticeListener(this.notice,this.gp_notice,this))},r.VIEW_TYPE={RANK_REWARD:1,SCORE_REWARD:2,SCORE_REWARD2:3},r}(BaseView);c.CommonRewardPanel=i,__reflect(i.prototype,"game.CommonRewardPanel");var n=function(t){function r(){var e=t.call(this)||this;return e.rankProxy=c.AppFacade.getInstance().retrieveProxy(c.RankPy.N),e.skinName="CommonRankPanel_RankItem",e.playerHeads=[],e}return __extends(r,t),r.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},r.prototype.updateItem=function(e){this.data=e,this.dataChanged()},r.prototype.dataChanged=function(){var i=this;if(this.img_bg.source=r.targetTab?1==r.targetTab?"jjc_img_paihangbang02_png":"zudui_img_liebiaotiao_png":"jjc_img_paihangbang02_png",this.gp_guildHead.visible=!1,this.gp_avatar.visible=!1,this.lb_name.visible=!0,this.data.info&&this.data.info.rank)if(this.gp_rank.visible=!0,this.data.info.team){this.gp_avatar.visible=!0;for(var e=function(t){var e=customui.PlayerHeadFactory.create();e.addTapEvent(function(){var e=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N);i.data.info.team.members&&i.data.info.team.members[t].baseInfo.playerId!=e.playerInfoVO.playerId&&c.AppFacade.getInstance().showSubView(c.FriendMediator.N,c.FriendMediator.SV.INFO,{playerId:i.data.info.team.members[t].baseInfo.playerId,source:"rankingType"+i.data.config.rankType}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)}),e.blb_level.visible=!1,n.playerHeads.push(e),n.gp_avatar.addChild(e)},n=this,t=this.playerHeads.length;t<3;t++)e(t);this.updateForTeam()}else{if(this.gp_avatar.numChildren<=0){var o=customui.PlayerHeadFactory.create();o.blb_level.visible=!1,this.data.config.blockTouch||(o.touchEnabled=!0,o.addTapEvent(function(){var e=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N);i.data.info.playerBaseInfo&&i.data.info.playerBaseInfo.playerId!=e.playerInfoVO.playerId&&c.AppFacade.getInstance().showSubView(c.FriendMediator.N,c.FriendMediator.SV.INFO,{playerId:i.data.info.playerBaseInfo.playerId,source:"rankingType"+i.data.config.rankType}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)})),this.playerHeads.push(o),this.gp_avatar.addChild(o)}if(this.data.config.isGuild){if(this.gp_guildHead.visible=!0,0==this.gp_guildHead.$children.length){var a=customui.GuildHeadFactory.create();this.gp_guildHead.addChild(a)}this.updateForGuild()}else this.gp_avatar.visible=!0,this.updateForPlayer()}else this.gp_rank.visible=!1},r.prototype.updateForPlayer=function(){var e=this.data.info;this.data.config;this.playerHeads[0].updateData({vo:e.playerBaseInfo}),this.lb_name.text=e.playerBaseInfo.name,this.lb_name.x=215,this.updateCommonPart()},r.prototype.updateForGuild=function(){var e=this.data.info;this.lb_name.text=e.guildBaseInfo.name,this.lb_name.x=215,this.gp_guildHead.$children[0].updateData({vo:e.guildBaseInfo}),this.updateCommonPart()},r.prototype.updateForTeam=function(){var i=this,e=this.data.info;this.data.config;e.team.members.forEach(function(e,t){i.playerHeads[t].updateData({vo:e.baseInfo})}),this.lb_name.visible=!1,this.updateCommonPart()},r.prototype.updateCommonPart=function(){var e=this.data.info,t=this.data.config,i=e.rank;if(i){var n=this.rankProxy.rankIcon(i);""!=n?(this.blb_rank.visible=!1,this.img_icon.visible=!0,this.img_icon.source=n):(this.blb_rank.visible=!0,this.img_icon.visible=!1,this.blb_rank.text=i.toString())}if(this.gp_extra.visible=!1,this.gp_fightCap.visible=!1,this.lb_keyValue.visible=!1,t.getExtraItem)if(this.gp_extra.visible=!0,this.gp_extra.numChildren){if(t.updateExtraItem){var o=this.gp_extra.$children[0];t.updateExtraItem(o,e)}}else(o=t.getExtraItem(e))&&(o.horizontalCenter=o.verticalCenter=0,this.gp_extra.addChild(o));else t.keyWord?(this.lb_keyValue.visible=!0,this.lb_keyValue.text=e.key.toString()):(this.gp_fightCap.visible=!0,e.playerBaseInfo?this.item_fightCap.update(e.playerBaseInfo.fightCap):this.gp_fightCap.visible=!1)},r.targetTab=1,r}(eui.ItemRenderer);c.CommonRankPanel_RankItem=n,__reflect(n.prototype,"game.CommonRankPanel_RankItem");var s=function(t){function o(){var e=t.call(this)||this;return e.rankProxy=c.AppFacade.getInstance().retrieveProxy(c.RankPy.N),e.skinName="CommonRewardPanel_RewardItem",e}return __extends(o,t),o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},o.prototype.dataChanged=function(){var t=this;this.img_bg.source=1==o.targetTab?"jjc_img_paihangbang02_png":"zudui_img_liebiaotiao_png",this.img_bg.source=this.data.backColor?"jjc_img_paihangbang02_png":this.img_bg.source;var e=this.data.rank;if(e){var i=this.rankProxy.rankIcon(e);""!=i?(this.blb_rank.visible=!1,this.img_icon.visible=!0,this.img_icon.source=i):(this.blb_rank.visible=!0,this.img_icon.visible=!1,this.blb_rank.text=e.toString())}else this.blb_rank.visible=!1,this.img_icon.visible=!0,this.img_icon.source=this.data.icon||"";var n=JSON.parse(this.data.rewards);this.gp_rewards.removeChildren(),n.forEach(function(e){t.gp_rewards.addChild(new customui.CommonIconWithNum({style:CommonIconStyle.RIGHT,showEnough:!1,code:e[1],num:e[2],showDetail:!0}))})},o.targetTab=1,o}(eui.ItemRenderer);c.CommonRewardPanel_RewardItem=s,__reflect(s.prototype,"game.CommonRewardPanel_RewardItem");var l=function(t){function e(){var e=t.call(this)||this;return e.skinName="CommonRewardPanel_RewardItem2",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc()},this),this.pb.slideDuration=0},e.prototype.dataChanged=function(){var i=this;this.lb_desc.text=this.data.desc,this.pb.maximum=this.data.pbMax,this.pb.value=this.data.pbValue,this.btnFunc=this.data.btnFunc,this.data.status==REWARD_STATUS.RECEIVED?(this.btn_get.visible=!1,this.gp_got.visible=!0):(this.btn_get.visible=!0,this.gp_got.visible=!1,this.data.status==REWARD_STATUS.AVAILABLE?(this.btn_get.enabled=!0,UIActionManager.setAbsGrey(this.btn_get,!1)):(this.btn_get.enabled=!1,UIActionManager.setAbsGrey(this.btn_get,!0)));var e=JSON.parse(this.data.rewards);this.gp_rewards.removeChildren(),e.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),t.scaleX=t.scaleY=.7,i.gp_rewards.addChild(t)})},e}(eui.ItemRenderer);c.CommonRewardPanel_RewardItem2=l,__reflect(l.prototype,"game.CommonRewardPanel_RewardItem2");var h=function(t){function e(){var e=t.call(this)||this;return e.skinName="CommonRewardPanel_RewardItem2",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc()},this)},e.prototype.dataChanged=function(){var i=this;this.lb_desc.text=this.data.desc,this.lb_desc.verticalCenter=10,this.pb.visible=!1,this.btnFunc=this.data.btnFunc,this.img_bg.source=this.data.backColor?"jjc_img_paihangbang02_png":this.img_bg.source,this.data.status==REWARD_STATUS.RECEIVED?(this.btn_get.visible=!1,this.gp_got.visible=!0):(this.btn_get.visible=!0,this.gp_got.visible=!1,this.data.status==REWARD_STATUS.AVAILABLE?(this.btn_get.enabled=!0,UIActionManager.setAbsGrey(this.btn_get,!1),UIActionManager.addEffect(this.btn_get,"common_lingquanniu",{scaleX:.9,scaleY:.9,offectY:-3.5})):(this.btn_get.enabled=!1,UIActionManager.setAbsGrey(this.btn_get,!0),UIActionManager.hideEffect(this.btn_get)));var e=JSON.parse(this.data.rewards);this.gp_rewards.removeChildren(),e.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),t.scaleX=t.scaleY=.7,i.gp_rewards.addChild(t)})},e}(eui.ItemRenderer);c.CommonRewardPanel_RewardItem3=h,__reflect(h.prototype,"game.CommonRewardPanel_RewardItem3")}(game||(game={}));var ByteArrayMsg=function(){function e(){this._msgBuffer=new egret.ByteArray,this.callBackMap={},this.backpackProxy=game.AppFacade.getInstance().retrieveProxy(game.BackpackPy.N)}return e.prototype.receive=function(e){var t;this._msgBuffer.clear(),e.readBytes(this._msgBuffer);try{t=this.decode(this._msgBuffer)}catch(e){return void egret.log("协议解析失败",e)}if(t){var i=t.obj.toString(),n=t.ssid;if(i)if(0===new String(i).indexOf(".test."))t.obj.key=i.substr(1),game.AppFacade.getInstance().sendNotification("test.CommonR",t.obj),this.callBackMap[n]&&(this.callBackMap[n].call(this,t.obj),this.callBackMap[n]=void 0);else try{if(t&&t.obj&&t.obj.clientReward&&this.backpackProxy.handleClientRewardCore(t.obj.clientReward),t&&t.obj&&t.obj.clientCost&&this.backpackProxy.handleClientCostCore(t.obj.clientCost),0==n){var o=i.substr(1);game.AppFacade.getInstance().sendNotification(o,t.obj),game.AppFacade.getInstance().sendNotification(CN.GUIDE_NET_RESP,o)}else this.callBackMap[n]&&(this.callBackMap[n].call(this,t.obj),this.callBackMap[n]=void 0)}catch(e){egret.log("回调代码执行出错",e)}return t=void 0,0==this._msgBuffer.bytesAvailable&&this._msgBuffer.clear(),n}},e.prototype.send=function(r,s,c){return __awaiter(this,void 0,void 0,function(){var o,a=this;return __generator(this,function(e){switch(e.label){case 0:return(o=this.encode(s))?(void 0,[4,new Promise(function(t,i){var n=s.ssid;a.callBackMap[n]=function(e){game.AppFacade.getInstance().sendNotification(CN.GUIDE_NET_RESP,s.id1+"."+s.id2+"R"),e?e.err?(c||Utils.MsgUtils.addErrMsg(e.err),i(e)):t(e):egret.log("当前cb没有返回",n)},o.position=0,r.writeBytes(o,0,o.bytesAvailable),o.clear(),o=void 0})]):[3,2];case 1:return[2,e.sent()];case 2:return[2]}})})},e.prototype.decode=function(e){return egret.log("decode需要子类重写，根据项目的协议结构解析"),null},e.prototype.encode=function(e){return egret.log("encode需要子类重写，根据项目的协议结构解析"),null},e}();__reflect(ByteArrayMsg.prototype,"ByteArrayMsg",["BaseMsg"]),function(I){var e=function(t){function i(){var e=t.call(this)||this;return e.moneyType=[],e.pageNumber=0,e.skinName="ShopSkin",e.shopProxy=I.AppFacade.getInstance().retrieveProxy(I.ShopPy.N),e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cur_resource),this.curShopType=this.shopProxy.curShopType,this.bm_title.text="商店",this.initUI();var e=new egret.Shape;e.graphics.beginFill(0,.6),e.graphics.drawRect(0,0,this.gp_empty.width,this.gp_empty.height),e.graphics.endFill(),this.gp_empty.addChildAt(e,0)},i.prototype.initUI=function(){var e=this;UIActionManager.hideScrollerBar(this.pageScroller),this.btn_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.pageScroller.scrollToNext(function(){e.updatePageBtnStatus()})},this),this.btn_last.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.pageScroller.scrollToLast(function(){e.updatePageBtnStatus()})},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.pageScroller.curPage=0,this.heroModel.update(i.HERODATA),this.initRefreshUI(),this.initList()},i.prototype.initList=function(){this.list_item.itemRenderer=n,this.collection_list=new eui.ArrayCollection,this.list_item.dataProvider=this.collection_list},i.prototype.updateResourceBar=function(){this.cur_resource.updateBar({costs:this.moneyType,width:190,needAdd:!0})},i.prototype.updateView=function(e){var t=this;if(e&&e.shopType){var o=this.shopProxy.getShopList(e.shopType),i=this.shopProxy.curShopInfo,n=I.Config.shopWork(this.curShopType);if(n.workType==ShopWorkType.FreeAndBuyRefresh&&i.lRCD){var a=i.lRCD;this.timer_lb_refresh=egret.setInterval(function(){var e=Utils.TimerManager.getServerTime();t.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(a-e)},this,1e3)}else if(n.workType==ShopWorkType.BuyRefresh){var r=i.buyCount,s=I.Config.publicBuyCostConfig(I.ShopConfig.ShopInfo[this.curShopType].moduleId,r);if(s)if(i.count<=0){var c=JSON.parse(s.costs);this.btn_refresh.updateData({cost:c[0],text:"刷新"})}else this.btn_refresh.updateData({text:"刷新"});var l=i.buyRecords,h=[];l.forEach(function(e){for(var t=0;t<o.length;++t)if(e.id==o[t].id){var i=o[t];i.grid=e.grid,h.push(i);break}}),o=h}else if(n.workType==ShopWorkType.Drop){this.lb_target_tips.text="每5关胜利后，将新增商品哦！";I.Config.shop();var p=this.shopProxy.curShopInfo.buyRecords,d=[];p.forEach(function(e){var t=e.id;for(var i in o){var n=o[i];n.id==t&&(n.grid=e.grid,d.push(n))}}),o=d}else if(n.workType==ShopWorkType.Common){I.Config.shop();for(var u=I.AppFacade.getInstance().retrieveProxy(I.ActivityPy.N),g=EActivityType.CommonShopSpecialItem,f=[EActivityType.CommonShopSpecialItem,EActivityType.CommonShopSpecialItem1,EActivityType.CommonShopSpecialItem2],_=I.AppFacade.getInstance().retrieveProxy(I.ActivityPy.N),m=0;m<f.length;m++)if(_.isOpen(f[m])){g=f[m];break}if(u.isOpen(g)){var y=u.allActivityData[g];if(y&&y.data){var v=y.content,T=[];for(var C in v){(b=v[C])[0]==e.shopType&&(T=b[1]||[])}var E=I.Config.shop();for(var C in E){var b=E[C];0<=T.indexOf(b.id)&&(b.endDt=y.endDt,b.customCB=function(e){I.AppFacade.getInstance().retrieveProxy(I.ActivityPy.N).DoCommonOperation(g,e.num,e.id,function(){t.updateView({shopType:t.curShopType})})},o.push(b))}}}}this.updateList({list:o}),this.pageScroller.curPage>this.collection_list.source.length-1?this.pageScroller.scrollToLast(function(){t.updatePageBtnStatus()}):this.updatePageBtnStatus(),this.updateResourceBar()}},i.prototype.updatePageBtnStatus=function(){this.btn_last.visible=0!=this.pageScroller.curPage,this.btn_next.visible=this.pageScroller.curPage!=this.pageNumber-1},i.prototype.initRefreshUI=function(){var e=I.Config.shopWork(this.curShopType),t=I.Config.publicBuyCostConfig(I.ShopConfig.ShopInfo[this.curShopType].moduleId,this.shopProxy.curShopInfo.buyCount);e.workType==ShopWorkType.FreeAndBuyRefresh?(this.gp_time.visible=!0,this.btn_refresh.visible=!1):e.workType==ShopWorkType.BuyRefresh&&t?(this.gp_time.visible=!1,this.btn_refresh.visible=!0):(this.gp_time.visible=!1,this.btn_refresh.visible=!1),this.btn_refresh.btn_oppr.skinName="skins.ButtonSkinBlue",this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<this.shopProxy.curShopInfo.count?this.shopProxy.RefeshShop(this.curShopType,function(){Utils.MsgUtils.addMidMsg("刷新成功")}):this.buyCount()},this)},i.prototype.updateList=function(e){var o=this;void 0===e&&(e={list:[]}),e.list.length||(this.gp_empty.visible=!0),this.pageNumber=Math.ceil(e.list.length/9)||1;var t=[],a=new Array;e.list.forEach(function(e){var t={isFull:o.shopProxy.getPurchasedNum(e.id)<o.shopProxy.getMaxNum(e.id),data:e,shopType:o.curShopType,grid:e.grid,type:2};a.push(t);var i=JSON.parse(e.costs);if(i&&i.length){var n=!0;o.moneyType.forEach(function(e){e[0]==i[0][0]&&e[1]==i[0][1]&&(n=!1)}),n&&o.moneyType.push([i[0][0],i[0][1]])}}),a.sort(function(e,t){return e.isFull==t.isFull?e.data.displayPriority===t.data.displayPriority?e.data.id-t.data.id:e.data.displayPriority-t.data.displayPriority:e.isFull?-1:1});for(var i=1,n=[],r=0,s=a;r<s.length;r++){var c=s[r];n.push(c),i%9==0?(t.push({list_items:n}),n=[]):i>=a.length&&t.push({list_items:n}),++i}this.collection_list.replaceAll(t)},i.prototype.buyCount=function(){var t=I.AppFacade.getInstance().retrieveProxy(I.ShopPy.N),e=t.curShopInfo.buyCount,i=I.ShopConfig.ShopInfo[t.curShopType].moduleId,n=I.Config.publicBuyCostConfig(i,e);if(!n)return egret.warn("t_public_buy_cost里当前购买次数"+e+"的"+i+"找不到配置"),void Utils.MsgUtils.addMidMsg("暂时无法购买");var o=JSON.parse(n.costs);I.AppFacade.getInstance().retrieveProxy(I.BackpackPy.N).checkEnough(o,!0)&&I.GameMgr.getInstance().showCommonTipsWin({costTips:"，刷新一次商店吗",source:"shop",cost:n.costs,cb:!0,clickCB:function(e){1===e.type&&t.BuyRefreshCount(t.curShopType,function(){Utils.MsgUtils.addMidMsg("刷新成功")})}})},i.prototype.perClose=function(){if(this.moneyType&&this.moneyType.length)switch(this.moneyType[0][1]){case EPropertyType.EPropertyTypeSoul:I.AppFacade.getInstance().updateView(I.BackpackMediator.N,I.BackpackMediator.SV.DECOMPOSE,{type:EEntityType.EEntityTypeHero});break;case EPropertyType.EPropertyTypeDevote:I.AppFacade.getInstance().updateView(I.GuildMediator.N,I.GuildMediator.SV.MAIN_MAP)}this.timer_lb_refresh&&egret.clearInterval(this.timer_lb_refresh)},i.HERODATA={code:41100065,modell:"hero_065_03",isStatic:!0},i}(BasePanel);I.ShopUI=e,__reflect(e.prototype,"game.ShopUI");var i=function(i){function e(e){var t=i.call(this)||this;return t.shopProxy=I.AppFacade.getInstance().retrieveProxy(I.ShopPy.N),t.backpackProxy=I.AppFacade.getInstance().retrieveProxy(I.BackpackPy.N),t.unlock=!0,t.skinName="ShopUIItemSkin",t.cacheData=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){this.baseItem=customui.BaseItemFactory.create(),this.gp_baseitem.addChildAt(this.baseItem,0),this.baseItem.touchEnabled=!1,this.activateComponent(),this.img_onlyOne.visible=!1,this.cacheData&&(this.data=this.cacheData)},e.prototype.activateComponent=function(){this.btn_purchase.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.buyFunc?this.data.buyFunc():this.leftNum<=0?Utils.MsgUtils.addMidMsg("该商品已无购买次数"):this.unlock?this.backpackProxy.checkEnough([[this.cost[0],this.cost[1],this.price]],!0)&&I.AppFacade.getInstance().showSubView(I.ShopyMediator.N,I.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:this.data.data,type:this.data.shopType,grid:this.data.grid,doneCB:this.data.customCB||this.data.data&&this.data.data.customCB,leftNum:this.leftNum}):Utils.MsgUtils.addMidMsg(SHOP_NOT_ALLOW_TIPS[this.unlockType])},this),this.gp_baseitem.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=JSON.parse(this.data.data.reward);if(e[0][0]==EEntityType.EEntityTypeHero||e[0][0]==EEntityType.EEntityTypeVestageHero)I.AppFacade.getInstance().showSubView(I.HeroMediator.N,I.HeroMediator.SV.HERO_DETAIL,{code:e[0][1]});else if(e[0][0]==EEntityType.EEntityTypeHeroArtifact||e[0][0]==EEntityType.EEntityTypeHeroEquip){var t=e[0],i={code:t[1],entityType:t[0],exp:0,fightCap:0,level:0,level2:0,filterShow:!0};I.AppFacade.getInstance().showSubView(I.HeroThingMediator.N,I.HeroThingMediator.SV.MAIN,{entityType:e[0][0],vo:i,source:I.HeroThingMainView.VIEW_SOURCE.BACKPACK})}else PopUpManager.addPopUp({obj:new I.BaseItemDetailView({code:e[0][1],type:e[0][0]})})},this)},e.prototype.dataChanged=function(){var t=this,e=this.data.data,i=JSON.parse(e.reward)[0];this.baseItem.updateData({type:i[0],code:i[1],num:i[2]});var n=null!=this.data.buyNum?this.data.buyNum:this.shopProxy.getPurchasedNum(e.id,this.data.grid);this.config=I.GeneralConfig.getEntityConfigByCode(i[0],i[1]);var o=this.shopProxy.getMaxNum(e.id);this.leftNum=o-n,this.leftNum<=0?(UIActionManager.setGrey(this.btn_purchase),UIActionManager.setGrey(this.gp_baseitem),this.img_buyok.visible=!0):(UIActionManager.setGrey(this.btn_purchase,!1),UIActionManager.setGrey(this.gp_baseitem,!1),this.img_buyok.visible=!1);var a=100,r=this.data.hasWholeLifeCard&&e.wholeLifeDiscountDisplay;r?0<e.wholeLifeDiscountReview&&(a=e.wholeLifeDiscountReview):e.discountDisplay&&0<e.discountReview&&(a=e.discountReview),this.data.hideDiscount||100==a?this.gp_discount.visible=!1:(this.gp_discount.visible=!0,this.blb_discount.text=""+a/10),this.cost=r?JSON.parse(e.wholeLifeCosts)[0]:JSON.parse(e.costs)[0],this.price=this.cost[2],this.btn_purchase.label=""+Utils.MathUtils.formatNumStyle1(this.price);var s=this.backpackProxy.getInfoByTypeCodeNum(this.cost[0],this.cost[1],this.cost[2]);s&&s.info&&(this.btn_purchase.iconDisplay.source=ResourceUtils.png(s.info.icon)),2==this.data.type&&(this.gp_discount.y=50,this.gp_discount.x=105,this.gp_discount.scaleX=this.gp_discount.scaleY=.8,this.gp_baseitem.y=65,this.gp_baseitem.scaleX=this.gp_baseitem.scaleY=.85,this.gp_btn.scaleX=this.gp_btn.scaleY=.85);var c=JSON.parse(e.unlock);switch(this.unlockType=c[0],this.unlockType){case ShopItemUnlockType.None:}if(this.timer&&egret.clearInterval(this.timer),e.endDt){this.gp_time.visible=!0;var l=e.endDt,h=function(){var e=Utils.TimerManager.getServerTime();t.lb_time.text=e<l?Utils.TimerManager.getFormatBySecond1(l-e):"已结束"};h(),this.timer=egret.setInterval(function(){h()},this,1e3)}else this.gp_time.visible=!1;this.data.effect?this.gp_effect.numChildren||DragonBoneTools.playOnce({effectName:"common_choukagaojiekuang",parent:this.gp_effect,loop:!0}):this.gp_effect.numChildren&&this.gp_effect.removeChildren()},e}(eui.ItemRenderer);I.ShopUIItem=i,__reflect(i.prototype,"game.ShopUIItem");var t=function(t){function e(){var e=t.call(this)||this;return e.shopProxy=I.AppFacade.getInstance().retrieveProxy(I.ShopPy.N),e.backpackProxy=I.AppFacade.getInstance().retrieveProxy(I.BackpackPy.N),e.unlock=!0,e.skinName="ShopUIItemSkin2",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.baseItem=customui.BaseItemFactory.create(),this.gp_baseitem.addChildAt(this.baseItem,0),this.baseItem.touchEnabled=!1,this.activateComponent()},e.prototype.activateComponent=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.leftNum<=0?Utils.MsgUtils.addMidMsg("该商品已无购买次数"):this.unlock?this.backpackProxy.checkEnough([[this.cost[0],this.cost[1],this.price]],!0)&&I.AppFacade.getInstance().showSubView(I.ShopyMediator.N,I.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:this.data.data,type:this.data.shopType,grid:this.data.grid,doneCB:this.data.customCB||this.data.data&&this.data.data.customCB,leftNum:this.leftNum}):Utils.MsgUtils.addMidMsg(SHOP_NOT_ALLOW_TIPS[this.unlockType])},this)},e.prototype.dataChanged=function(){var e=this.data.data,t=JSON.parse(e.reward)[0];this.baseItem.updateData({type:t[0],code:t[1],num:t[2]});for(var i=null!=this.data.buyNum?this.data.buyNum:this.shopProxy.getPurchasedNum(e.id,this.data.grid),n=100,o=JSON.parse(e.discount),a=0;a<o.length;a++){if(i>=o[a][0]-1&&i<o[a][1]){n=o[a][2];break}if(i>=o[a][0]-1&&0==o[a][1]){n=o[a][2];break}}var r=this.shopProxy.getMaxNum(e.id);this.leftNum=r-i,this.leftNum<=0?UIActionManager.setGrey(this):UIActionManager.setGrey(this,!1),1==e.discountDisplay?100==n?this.gp_discount.visible=!1:(this.gp_discount.visible=!0,this.blb_discount.text=""+n/10):this.gp_discount.visible=!1,this.cost=JSON.parse(e.costs)[0];var s=this.cost[2];this.price=s*n/100;I.AppFacade.getInstance().retrieveProxy(I.BackpackPy.N);this.costIconAndNum.updateItem({style:CommonIconStyle.RIGHT,cost:this.cost,showEnough:!1}),this.costIconAndNum.blb_num.x-=5,this.costIconAndNum.blb_num.scaleX=this.costIconAndNum.blb_num.scaleY=.8,this.costIconAndNum.img_icon.scaleX=this.costIconAndNum.img_icon.scaleY=.8,this.costIconAndNum.img_icon.x=5;var c=JSON.parse(e.unlock);switch(this.unlockType=c[0],this.unlockType){case ShopItemUnlockType.None:}},e}(eui.ItemRenderer);I.ShopUIItem2=t,__reflect(t.prototype,"game.ShopUIItem2");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShopPageItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);var e=new eui.TileLayout;e.horizontalGap=60,e.verticalGap=-34,e.requestedRowCount=3,e.paddingLeft=65,e.paddingTop=6,e.requestedColumnCount=3,this.list_item.layout=e,this.list_item.itemRenderer=i,this.collect=new eui.ArrayCollection,this.list_item.dataProvider=this.collect},e.prototype.update=function(e){this.list_item=e.list_items},e.prototype.dataChanged=function(){this.collect.removeAll();for(var e=0,t=this.data.list_items;e<t.length;e++){var i=t[e];this.collect.addItem(i)}},e}(eui.ItemRenderer);I.ShopPageItem=n,__reflect(n.prototype,"game.ShopPageItem")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.proxy=o.AppFacade.getInstance().retrieveProxy(o.TaskPy.N),t}return __extends(n,i),Object.defineProperty(n.prototype,"rootView",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.TaskView),this.addSubView(n.SV.UNLOCK,o.UnlockTaskPanel),this.addSubView(n.SV.SECOND_ACHIEVEMENT,o.SecondAchievementPanel)},n.prototype.listNotificationInterests=function(){return[CN.TASK_OPEN_MAIN,CN.HIDE_ALL_SUBVIEW,CN.TASK_GET_REWARDS_POP_CLOSE,CN.LOGIN_FINAL_DONE,CN.GENERAL_PASS_DAY,CN.UNLOCK_TASK_GET_DATA,CN.UNLOCK_TASK_UPDATE]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.TASK_OPEN_MAIN:o.AppFacade.getInstance().showSubView(n.N,n.SV.MAIN);break;case CN.HIDE_ALL_SUBVIEW:this.rootView&&(this.hideAllSubView(),this.removeFromParent());break;case CN.TASK_GET_REWARDS_POP_CLOSE:var t=this.getSubView(n.SV.MAIN);t&&t.updateView();break;case CN.GENERAL_PASS_DAY:case CN.LOGIN_FINAL_DONE:this.proxy.fetch(TaskType.Daily),this.proxy.fetch(TaskType.Achievement),this.proxy.fetch(TaskType.Guide),this.proxy.fetch(TaskType.BraveBook),this.proxy.fetch(TaskType.NewBraveBook),this.proxy.fetch(TaskType.NewNewBraveBook),this.proxy.fetch(TaskType.HideAchievement),this.proxy.fetch(TaskType.DifficultyGuide),this.proxy.fetch(TaskType.SecondAchievement),this.proxy.GetTaskDone(1),this.proxy.GetTaskDone(10),this.proxy.GetSecondAchievementTask()}},n.prototype.onViewCreate=function(){},n.N="TaskMediator",n.SV={MAIN:1,UNLOCK:2,SECOND_ACHIEVEMENT:3},n}(BaseMediator);o.TaskMediator=e,__reflect(e.prototype,"game.TaskMediator")}(game||(game={})),function(i){var e=function(e){function t(){return e.call(this,t.N,t)||this}return __extends(t,e),t.prototype.initSubView=function(){this.addSubView(t.SV.MAIN,i.TouchGoldHand)},t.prototype.listNotificationInterests=function(){return[CN.LOGIN_FINAL_DONE,CN.GENERAL_PASS_DAY]},t.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.GENERAL_PASS_DAY:case CN.LOGIN_FINAL_DONE:i.AppFacade.getInstance().retrieveProxy(i.TouchGoldHandPy.N).getTouchGoldHandInfo()}},t.N="TouchGoldHandMediator",t.SV={MAIN:1},t}(BaseMediator);i.TouchGoldHandMediator=e,__reflect(e.prototype,"game.TouchGoldHandMediator")}(game||(game={})),function(l){var e=function(){function e(){}return e.create=function(e){if(e.vo){var t=void 0;if(null!=e.vo.eventType)switch(e.vo.eventType){case VestageEventType.Creep:t=new l.DEPCreep(e);break;case VestageEventType.Box:t=new l.DEPBox(e);break;case VestageEventType.Unknown:t=new l.DEPUnknown(e);break;case VestageEventType.Shop:t=new l.DEPShop(e);break;case VestageEventType.Campsite:t=new l.DEPCampsite(e);break;case VestageEventType.Empty:}return t}egret.warn("参数不对")},e}();l.DungeonEventFactory=e,__reflect(e.prototype,"game.DungeonEventFactory");var t=function(i){function e(e){var t=i.call(this)||this;return t.hasInit=!1,t.data=e,t.height=t.width=0,t}return __extends(e,i),Object.defineProperty(e.prototype,"vo",{get:function(){return this.data.vo},enumerable:!0,configurable:!0}),e.prototype.initComp=function(){this.gp_root=new eui.Group,this.gp_root.width=this.gp_root.height=0,this.addChild(this.gp_root),this.btn_icon=new eui.Button,this.btn_icon.horizontalCenter=this.btn_icon.verticalCenter=0,this.btn_icon.skinName="skins.ButtonSkinIcon",this.gp_root.addChild(this.btn_icon),this.hasInit=!0,this.btn_icon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.preEnter,this)},e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initComp(),this.data&&this.updateData(this.data)},e.prototype.updateData=function(e){this.data=e;var t=this.data.vo;switch(egret.Tween.removeTweens(this.gp_root),UIActionManager.setAbsGrey(this.btn_icon,!1),this.gp_root.scaleX=this.gp_root.scaleY=1,this.btn_icon.enabled=!1,t.status){case VestagePointStatus.UnPassed:var i=this.data.allDatas,n=this.data.from,o=l.GameMVC.dungeonPy.mapInfo.curPointId,a=!1;if(o){if(n.length&&0<=n.indexOf(o)){var r=i[o].vo;if(!(a=r.status===VestagePointStatus.Success))switch(r.eventType){case VestageEventType.Shop:a=!0;break;case VestageEventType.Unknown:var s=r.fadeType;s&&(a=s===VestageEventType.Shop||s===VestageEventType.UpHeroStar)}}}else a=!n.length;a?this.btnEnabledEffect():UIActionManager.setAbsGrey(this.btn_icon,!0);break;case VestagePointStatus.Passed:if(!this.gp_root.getChildByName("passImg"))(c=new eui.Image("shzyj_img_yiwancheng_png")).name="passImg",c.horizontalCenter=0,c.verticalCenter=-15,this.gp_root.addChild(c);break;case VestagePointStatus.Just:this.btnEnabledEffect();break;case VestagePointStatus.Success:var c;if(!this.gp_root.getChildByName("passImg"))(c=new eui.Image("shzyj_img_yiwancheng_png")).name="passImg",c.horizontalCenter=0,c.verticalCenter=-15,this.gp_root.addChild(c);break;case VestagePointStatus.Fail:this.btnEnabledEffect()}},e.prototype.btnEnabledEffect=function(){this.btn_icon.enabled=!0,egret.Tween.get(this.gp_root,{loop:!0}).to({scaleX:1.2,scaleY:1.2},1e3).to({scaleX:1,scaleY:1},1e3)},e.prototype.preEnter=function(){var e=this;if(this.data){var t=this.data.vo;t.status==VestagePointStatus.Just||t.status==VestagePointStatus.Fail?this.onEnter():l.GameMVC.dungeonPy.EnterPoint({pointId:t.id,cb:function(){e.onEnter()}})}else egret.error("preEnter 事件data为空")},e.prototype.onEnter=function(){egret.warn("onEnter 子类需重写该方法实现节点进入逻辑")},e.prototype.commonTriggerEvent=function(e,t,i){if(void 0===i&&(i=!1),this.data){var n=this.data.vo;l.GameMVC.dungeonPy.TriggerEvent({pointId:n.id,key:e,cb:t,dontPopReward:i})}else egret.error("事件data为空")},e.prototype.endEvent=function(e){if(this.data){var t=this.data.vo;l.GameMVC.dungeonPy.EndEvent({pointId:t.id,cb:e})}else egret.error("事件data为空")},e}(eui.Component);l.DungeonEventPoint=t,__reflect(t.prototype,"game.DungeonEventPoint")}(game||(game={})),function(t){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.initNotice(),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,t.ArenaView)},n.prototype.initNotice=function(){},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.ARENA_UPDATE_INFO,CN.ARENA_UPDATE_OPPONENT,CN.PLAYER_LEVEL_UP,CN.LOGIN_FINAL_DONE]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.ARENA_UPDATE_INFO:case CN.ARENA_UPDATE_OPPONENT:this.updateView(n.SV.MAIN);break;case CN.PLAYER_LEVEL_UP:t.AppFacade.getInstance().retrieveProxy(t.ArenaPy.N).handleDotInfo(!0);break;case CN.LOGIN_FINAL_DONE:t.AppFacade.getInstance().retrieveProxy(t.ArenaPy.N).GetArenaInfo()}},n.prototype.onViewCreate=function(){},n.N="ArenaMediator",n.SV={MAIN:1},n}(BaseMediator);t.ArenaMediator=e,__reflect(e.prototype,"game.ArenaMediator")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ArenaPlayerItemSkin",e.cu_playerHead=i.PlayerHeadFactory.create(),e.proxy=game.AppFacade.getInstance().retrieveProxy(game.ArenaPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.fightCB&&e.fightCB(e.vo)},this),this.btn_mopUp.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.mopUpCB&&e.mopUpCB()},this),this.addChild(this.cu_playerHead),this.cu_playerHead.scaleX=this.cu_playerHead.scaleY=.7,this.cu_playerHead.x=137,this.cu_playerHead.y=14,this.cu_playerHead.addTapEvent(function(){e.vo&&game.AppFacade.getInstance().showSubView(game.FriendMediator.N,game.FriendMediator.SV.INFO,{playerId:e.vo.playerId})})},e.prototype.update=function(e){var t=this;if(e){this.vo=e.vo,this.fightCB=e.fightCB,this.mopUpCB=e.mopUpCB;var i=e.canFight,n=e.canMopUp;this.vo?(this.lb_name.text=this.vo.name,3<this.vo.rank?(this.blb_rank.visible=!0,this.img_rank.visible=!1,this.blb_rank.text=this.vo.rank.toString()):(this.blb_rank.visible=!1,this.img_rank.visible=!0,RES.getResAsync("jjc_icon_pm_"+this.vo.rank+"_png",function(e){t.img_rank.source=e},this)),this.cu_playerHead.updateData({vo:this.vo}),this.item_fightCap.update(this.vo.fightCap),this.btn_fight.visible=i,this.btn_mopUp.visible=n,this.vo.rank==this.proxy.arenaInfo.rank&&(this.btn_fight.visible=!1)):this.btn_fight.visible=!1}},e}(eui.Component);i.ArenaPlayerItem=e,__reflect(e.prototype,"customui.ArenaPlayerItem",["eui.UIComponent","egret.DisplayObject"])}(customui||(customui={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.initNotice(),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.BattleZoneArenaView),this.addSubView(n.SV.JIJIE_CENTER,o.BattleZoneArenaJiJieCenterPanel),this.addSubView(n.SV.JIJIE_MY_TEAM,o.BattleZoneArenaJiJieMyTeamPanel),this.addSubView(n.SV.TEAM_BATTLE_RECORD,o.BattleZoneArenaTeamRecordPanel),this.addSubView(n.SV.VOTE,o.BattleZoneArenaVotePanel),this.addSubView(n.SV.TEAM_INFO,o.BattleZoneArenaTeamInfoPanel)},n.prototype.initNotice=function(){},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.PLAYER_LEVEL_UP,CN.FIGHT_ALL_DONE_AND_EXIT,CN.LOGIN_FINAL_DONE,CN.GENERAL_PASS_DAY,CN.TEAM_ARENA_UPDATE_INFO,CN.TEAM_ARENA_UPDATE_TEAM_INFO,CN.TEAM_ARENA_UPDATE_GROUP_INFO]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.TEAM_ARENA_UPDATE_INFO:this.updateView(n.SV.MAIN);break;case CN.TEAM_ARENA_UPDATE_TEAM_INFO:this.updateView(n.SV.JIJIE_CENTER),this.updateView(n.SV.JIJIE_MY_TEAM);break;case CN.TEAM_ARENA_UPDATE_GROUP_INFO:this.updateView(n.SV.MAIN);break;case CN.PLAYER_LEVEL_UP:o.GameMVC.battleZoneArenaPy.updateNotice(!0);break;case CN.FIGHT_ALL_DONE_AND_EXIT:o.AppFacade.getInstance().retrieveProxy(o.FriendPy.N).clearInviteHistory(MODULE.TeamArena);break;case CN.LOGIN_FINAL_DONE:if(Utils.UnlockMgr.checkPass(MODULE.TeamArena,!1).allow){var t=o.GameMVC.battleZoneArenaPy;t.GetBattleZoneArenaInfo(function(){var e=t.getOpenInfo();e.status!=TeamArenaStatus.Enroll||t.isEnrolled()||PopUpManager.addPopUp({obj:new o.BattleZoneEnrollPanel(e.remainingTime)}),o.GameMVC.battleZoneArenaPy.initSchedule()}),t.GetApplyRecord()}break;case CN.GENERAL_PASS_DAY:var i=o.GameMVC.battleZoneArenaPy;i.recordController&&i.recordController.reset(),i.groupInfos.splice(0),this.updateView(n.SV.MAIN),i.initSchedule()}},n.prototype.onViewCreate=function(){},n.N="BattleZoneArenaMediator",n.SV={MAIN:1,JIJIE_CENTER:3,JIJIE_MY_TEAM:4,TEAM_BATTLE_RECORD:5,VOTE:6,TEAM_INFO:7},n}(BaseMediator);o.BattleZoneArenaMediator=e,__reflect(e.prototype,"game.BattleZoneArenaMediator")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.championProxy=o.AppFacade.getInstance().retrieveProxy(o.ChampionPy.N),t.initNotice(),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.ChampionView),this.addSubView(n.SV.PREVIEW,o.ChampionBossPreview),this.addSubView(n.SV.ACHIEVEMENT,o.ChampionAchievement)},n.prototype.initNotice=function(){},n.prototype.listNotificationInterests=function(){return[CN.CHAMPION_UPDATE_INFO,CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE]},n.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:o.AppFacade.getInstance().retrieveProxy(o.ChampionPy.N).Champion();break;case CN.CHAMPION_UPDATE_INFO:this.updateView(n.SV.MAIN,t),this.updateView(n.SV.ACHIEVEMENT)}},n.prototype.onViewCreate=function(){this.sendNotification(CN.CITY_SWITCH_DBCLOCKPAUSE,!0)},n.N="ChampionMediator",n.SV={MAIN:1,PREVIEW:2,ACHIEVEMENT:3},n}(BaseMediator);o.ChampionMediator=e,__reflect(e.prototype,"game.ChampionMediator")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.proxy=o.AppFacade.getInstance().retrieveProxy(o.CopyEntrancePy.N),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.ENTRANCE,o.CopyEntranceView),this.addSubView(n.SV.DAILY_COPY,o.DailyCopyEntrance),this.addSubView(n.SV.DAILY_COPY_LIST,o.DailyCopyListPanel),this.addSubView(n.SV.EXPEDITION,o.ExpeditionView),this.addSubView(n.SV.EXPEDITION_CHALLENGE,o.ExpeditionehCallengeView),this.addSubView(n.SV.ACHIEVE_REWARD,o.ExpeditionAchievementRewardPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.PLAYER_LEVEL_UP]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.DailyFortress,!1).allow&&this.proxy.GetDailyFortress(),Utils.UnlockMgr.checkPass(MODULE.Expedition,!1).allow&&this.proxy.GetExpeditionInfo();break;case CN.PLAYER_LEVEL_UP:NoticeManager.updateNotice(NT.DAILY_COPY),Utils.UnlockMgr.checkPass(MODULE.Expedition,!1).allow&&this.proxy.GetExpeditionInfo();case CN.GENERAL_PASS_DAY:Utils.UnlockMgr.checkPass(MODULE.Expedition,!1).allow&&this.proxy.GetExpeditionInfo()}},n.N="CopyEntranceMediator",n.SV={ENTRANCE:1,DAILY_COPY:2,DAILY_COPY_LIST:3,EXPEDITION:4,EXPEDITION_CHALLENGE:5,ACHIEVE_REWARD:6},n}(BaseMediator);o.CopyEntranceMediator=e,__reflect(e.prototype,"game.CopyEntranceMediator")}(game||(game={})),function(i){var e=function(n){function o(e){void 0===e&&(e=null);var t=n.call(this,o.N,e)||this;return t.heroPy=i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N),t}return __extends(o,n),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,i.HeroMainView),this.addSubView(o.SV.GACHA,i.HeroGachaView),this.addSubView(o.SV.SELECT,i.HeroSelectPanel),this.addSubView(o.SV.SELECT_UPSTAR,i.HeroUpstarSelectPanel),this.addSubView(o.SV.GACHA_RESULT,i.HeroGachaResultView),this.addSubView(o.SV.SECTION,i.HeroUpsectionPanel),this.addSubView(o.SV.HERO_QUICK_TRAIN,i.HeroQuickTrainView),this.addSubView(o.SV.FORMATION,i.HeroFormationPanel),this.addSubView(o.SV.HERO_DETAIL,i.HeroDetailView),this.addSubView(o.SV.ATTR_DETAIL,i.HeroAttrDetailsPanel),this.addSubView(o.SV.HERO_COMMENT,i.HeroCommentView),this.addSubView(o.SV.STARDOOR,i.StarDoorView),this.addSubView(o.SV.HERO_REPLACEMENT,i.HeroReplacementView),this.addSubView(o.SV.HERO_HALO,i.HeroHaloPanel),this.addSubView(o.SV.COMMON_GACHA_RESULT,i.CommonGachaResultView),this.addSubView(o.SV.ARTIFACT_RESONATE,i.HeroArtifactResonatePanel),this.addSubView(o.SV.HERO_DERMA,i.HeroDermaPanel),this.addSubView(o.SV.RESONATE_ATTR,i.HeroResonateAttrPanel),this.addSubView(o.SV.RESONATE_UNLOCK,i.HeroResonateUnlockPanel),this.addSubView(o.SV.HERO_PRACTICE,i.HeroPracticePanel),this.addSubView(o.SV.MASTER,i.HeroThingMasterView),this.addSubView(o.SV.COMMON_LEVEL_MASTER,i.CommonLevelMasterPanel)},o.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.HERO_EQUIP_UPDATE,CN.HERO_ARTIFACT_UPDATE,CN.HEROCOMMENT_UPDATE,CN.HERO_GACHA_UPDATE,CN.HERO_DERMA_UPDATE,CN.MONEY_UPDATE]},o.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:this.heroPy.GetHeroInfo(),this.heroPy.GetUserGashaponInfos(),this.heroPy.getReplaceInfo();break;case CN.HERO_EQUIP_UPDATE:case CN.HERO_ARTIFACT_UPDATE:this.updateView(o.SV.MAIN);break;case CN.HERO_DERMA_UPDATE:this.updateView(o.SV.MAIN),this.updateView(o.SV.HERO_DERMA);break;case CN.HERO_GACHA_UPDATE:this.updateView(o.SV.GACHA);break;case CN.HEROCOMMENT_UPDATE:(i=this.getSubView(o.SV.HERO_COMMENT))&&i.getPlayerTuphero(t);break;case CN.MONEY_UPDATE:var i;(i=this.getSubView(o.SV.STARDOOR))&&i.updateResourceBar();var n=this.getSubView(o.SV.GACHA);n&&n.resourceBarComponent()}},o.prototype.updateView=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];n.prototype.updateView.apply(this,[e].concat(t)),e===o.SV.MAIN&&n.prototype.updateView.apply(this,[o.SV.HERO_QUICK_TRAIN].concat(t))},o.N="HeroMediator",o.SV={MAIN:1,GACHA:2,SELECT:3,SELECT_UPSTAR:4,GACHA_RESULT:5,SECTION:6,RESONATE:7,HERO_QUICK_TRAIN:8,FORMATION:9,HERO_DETAIL:10,ATTR_DETAIL:11,HERO_COMMENT:12,STARDOOR:13,HERO_REPLACEMENT:14,HERO_HALO:15,COMMON_GACHA_RESULT:16,ARTIFACT_RESONATE:17,HERO_DERMA:18,RESONATE_ATTR:20,RESONATE_UNLOCK:21,HERO_PRACTICE:22,MASTER:23,COMMON_LEVEL_MASTER:24},o}(BaseMediator);i.HeroMediator=e,__reflect(e.prototype,"game.HeroMediator")}(game||(game={})),function(o){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.tupMap={},e.origin_arr=[],e.newArr=[],e.commonArr=[],e.popTimes=0,e.stopMap={0:!1,1:!1,2:!1},e.isFirst=!0,e.array=[],e}return __extends(e,t),e.prototype.commentsFloatingEffect=function(e){var t,i=this,n=this.isFirst?0:1700;if(this.isFirst=!1,e&&e.priority)for(var o=0,a=this.array;o<a.length;o++){if((d=a[o]).id==e.id){t=d;break}}else{this.origin_arr.length,this.array.length;var r=0;if(0<this.newArr.length){for(;r<this.newArr.length;){if(!this.tupMap[this.newArr[r].id]){t=this.newArr[r],this.newArr.splice(r,1);break}++r}r>=this.newArr.length&&(this.newArr=[],egret.setTimeout(function(){i.commentsFloatingEffect()},this,n))}else if(0<this.commonArr.length){var s=this.commonArr.length;r=Math.floor(Math.random()*s);var c=this.tupMap[this.commonArr[r].id];if(c)for(var l=0;c&&l<this.commonArr.length;)this.commonArr.splice(r,1),r=Math.floor(Math.random()*s),t=this.origin_arr[r],c=this.tupMap[this.origin_arr[r].id],++l>=this.origin_arr.length&&(t=void 0);else t=this.commonArr[r],this.commonArr.splice(r,1)}else if(10<=this.array.length){this.tupMap={};for(var h=0,p=this.array;h<p.length;h++){var d=p[h];this.origin_arr.push(d),this.commonArr.push(d)}egret.setTimeout(function(){i.commentsFloatingEffect()},this,n)}}var u=0;for(l=0;l<3;++l)u+=this["gp_msg_"+l].$children.length;if(u<=20&&t){t.content;this.tupMap[t.id]=t.content_id,++this.popTimes;var g=this.popTimes%3;egret.setTimeout(function(){var e=i["gp_msg_"+g].y;i.msgOnTop(t,{x:730,y:e},g,5e3),i.commentsFloatingEffect()},this,n)}else console.log("skip, skip")},e.prototype.msgOnTop=function(t,e,i,n,o){var a=this;void 0===n&&(n=0);var r=t.content,s=this["gp_msg_"+i],c=new eui.Group;c.x=Utils.DeviceUtils.curWidth()+100,c.y=0,s.addChild(c);var l=new eui.Label;l.touchEnabled=!1,l.textColor=16777215,l.size=26,l.text=r,l.x=0,l.y=0;var h=new eui.Button;h.skinName="skins.ButtonIconWithNumSkin",h.icon="yingxion_icon_dianzan_png",h.label=t.num.toString(),h.x=l.width+20,h.y=0,h.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){a.commentPlayerTup(t,function(){h.label=(t.num+1).toString()})},this),c.addChild(l),c.addChild(h),c.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){a.floatingMsgPauseEvents(i)},this),c.addEventListener(egret.TouchEvent.TOUCH_END,function(){a.floatingMsgResumeEvents(i)},this),this.stopMap[i]||egret.Tween.get(c).to({x:-l.textWidth},n).call(function(){s.removeChild(c),o&&o()})},e.prototype.floatingMsgPauseEvents=function(e){this.stopMap[e]=!0;for(var t=this["gp_msg_"+e],i=t.$children.length,n=0;n<i;++n)egret.Tween.pauseTweens(t.getChildAt(n))},e.prototype.floatingMsgResumeEvents=function(e){this.stopMap[e]=!1;for(var t=this["gp_msg_"+e],i=t.$children.length,n=0;n<i;++n)egret.Tween.resumeTweens(t.getChildAt(n))},e.prototype.commentPlayerTup=function(t,i){var e=o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N),n=o.AppFacade.getInstance().retrieveProxy(o.LoginPy.N);t.tup_player?Utils.MsgUtils.addMidMsg("只能对该条评论点赞一次！"):Utils.Http.toGet({action:"set_PlayerTup_hero",code:t.code,player_id:t.id,name:t.name,content:t.content,head:t.head,type:o.HeroCommentView.commentType.DIANZAN,tup_player:e.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,project:Utils.agentConfig.ProjectName,subPlatform:Utils.agentConfig.channelName||"",server_id:n.serverSelect.s_id,area:t.serverId,from_server_id:n.serverSelect.area}).then(function(e){i&&i(),o.AppFacade.getInstance().sendNotification(CN.HEROCOMMENT_UPDATE,{info:t,type:o.HeroCommentView.commentType.DIANZAN})}).catch(function(e){console.log("set_PlayerTup_hero"+e)})},e.prototype.compareFunc=function(e,t,i){return++i<=3?0<e.num-t.num?-1:e.num-t.num<0?1:(--i,0<e.strTime-t.strTime?-1:e.strTime-t.strTime<0?1:0):e.strTime-t.strTime<0?1:0<e.strTime-t.strTime?-1:0},e.prototype.sortByTime=function(e,t){return e.strTime-t.strTime<0?1:0<e.strTime-t.strTime?-1:0},e.prototype.sortByLike=function(){for(var e=[],t=0;t<3;++t){for(var i=0,n=0,o=0;n<this.array.length;){var a=this.array[n];o=i<a.num?n:o,i=Math.max(a.num,i),++n}if(this.array.length<=0)break;e.push(this.array[o]),this.array.splice(o,1)}this.array=e.concat(this.array)},e.prototype.perClose=function(){},e.prototype.onDestroy=function(){this.array=[],this.origin_arr=[],this.tupMap={},this.commonArr=[]},e}(BasePanel);o.CommonComment=e,__reflect(e.prototype,"game.CommonComment")}(game||(game={})),function(S){var o=function(i){function o(){var e=i.call(this)||this;return e.index=0,e.initialized=!1,e.upstarData={},e.heroInfoTabbarData=[],e.resFullImg=new eui.Image("_main_m_json.maoxian_icon_man"),e.heroThingPos=[[-67,131],[67,7],[253,7],[382,131],[253,261],[67,261]],e.conditionMap={1:"oneSlotCosts",2:"twoSlotCosts",3:"threeSlotCosts",4:"fourSlotCosts"},e.skinName="HeroMainViewSkin",e.heroProxy=S.AppFacade.getInstance().retrieveProxy(S.HeroPy.N),e.heroThingProxy=S.AppFacade.getInstance().retrieveProxy(S.HeroThingPy.N),e.heroThingItems=new Array,e.guideEffectWait=!0,e}return __extends(o,i),o.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_hero_list),Utils.DeviceUtils.setLiuHaiPingAdapter(this.resource_bar),this.initGPRightBtn(),this.initGPLeftBtn(),this.initTabbar(),this.initThing(),this.activateComponent(),this.list_resonate.itemRenderer=a,this.gp_heroInfo.visible=this.gp_right_btn.visible=this.gp_left_btn.visible=this.gp_hero_list.visible=!1,this.once(egret.Event.ENTER_FRAME,function(){t.gp_heroInfo.visible=t.gp_right_btn.visible=t.gp_left_btn.visible=t.gp_hero_list.visible=!0;var e=t.gp_hero_list.y;UIActionManager.playUIAction(t.gp_right_btn,4),UIActionManager.playUIAction(t.gp_left_btn,3),UIActionManager.playUIAction(t.gp_hero_list,5),UIActionManager.playUIAction(t.gp_heroInfo,6,function(){t.setGuideAvailable()},t),t.btn_lock.y+t.gp_hero.y+t.btn_lock.width/3<t.gp_hero_list.height+e&&(t.img_race_icon.parent.y+=350,t.btn_lock.y+=350)},this),this.addNotice(),NoticeManager.updateNotice(NT.GUAJI_GZGZH3)},o.prototype.initGPRightBtn=function(){for(var e in o.BTN_TYPE){var t=o.BTN_TYPE[e],i=new eui.Button;i.skinName="skins.ButtonSkinIcon2",i.width=80,i.height=94,i.icon=t.icon,i.label=t.text,this[t.id]=i,this.gp_right_btn.addChild(this[t.id])}},o.prototype.initGPLeftBtn=function(){for(var e in o.BTN_LEFT_TYPE){var t=o.BTN_LEFT_TYPE[e],i=new eui.Button;i.skinName="skins.ButtonSkinIcon2",i.width=80,i.height=94,i.icon=t.icon,i.label=t.text,this[t.id]=i,this.gp_left_btn.addChild(this[t.id])}},o.prototype.initTabbar=function(e){var t=this;void 0===e&&(e=!0),this.heroInfo_tabbar.itemRendererSkinName="HeroMainView_HeroInfoTabItem",this.heroInfo_tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.heroFoster_onItemTap,this),this.heroInfo_tabbar.addEventListener(egret.Event.CHANGE,function(e){egret.setTimeout(function(){S.AppFacade.getInstance().sendNotification(CN.GUIDE_CHECK_CUR_STEP)},t,100)},this),this.heroInfo_tabbar.selectedIndex=0},o.prototype.initThing=function(){var a=this,e=0;for(var t in HeroEquipType){var i=new r(HeroEquipType[t]);this.heroThingItems.push(i);var n=this.heroThingPos[e++];i.x=n[0],i.y=n[1],NoticeManager.addNoticeListener(NT.HERO_EQUIP[HeroEquipType[t]-1],i.bi_root,this,{percentX:74/105,percentY:0}),this.gp_thingBox.addChild(i)}i=new c;this.heroThingItems.push(i);n=this.heroThingPos[e++];i.x=n[0],i.y=n[1],NoticeManager.addNoticeListener(NT.HERO_TREASURE,i.bi_root,this,{percentX:74/105,percentY:0}),this.gp_thingBox.addChild(i);i=new s;this.heroThingItems.push(i);n=this.heroThingPos[e++];i.x=n[0],i.y=n[1],NoticeManager.addNoticeListener(NT.HERO_ARTIFACT,i.bi_root,this,{percentX:74/105,percentY:0}),this.gp_thingBox.addChild(i),this.btn_putOn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.heroProxy.HeroOneKeyPutOn(a.curUuid,function(){var e=S.GameMVC.heroThingPy.getHeroEquips(a.curUuid),t=S.Config.getHeroEquipConfig(),i=!0;for(var n in e.length<4&&(i=!1),e){var o=e[n];t[o.code]&&t[o.code].color<7&&(i=!1)}i&&DragonBoneTools.playOnce({effectName:"common_zbdsjh",parent:GameRootLayer.gameLayer().mainLayer,x:GameRootLayer.gameLayer().mainLayer.width/2,y:GameRootLayer.gameLayer().mainLayer.height/2-100})})},this),this.btn_putOff.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.heroProxy.HeroOneKeyPutDown(a.curUuid)},this)},o.prototype.updateView=function(e){var t=e&&e.uuid,i=!t&&!this.curUuid||t&&this.curUuid!=t;if(this.curUuid=t||this.curUuid,this.upstarData=e&&e.upstarData||this.upstarData,!this.curUuid)for(var n=1;n<=5;n++)if(this.heroProxy.heroUuid22Pos[n]){this.curUuid=this.heroProxy.heroUuid22Pos[n];break}this.updateHeroList(),this.curUuid?(this.gp_hero.visible=!0,this.isPet=!1,this.curInfo=this.heroProxy.allHeroByUuid[this.curUuid],i&&(this.updateTabbar(),egret.setTimeout(function(){S.AppFacade.getInstance().sendNotification(CN.GUIDE_CHECK_CUR_STEP)},this,100)),this.updateHeroInfo(),this.heroFoster_onItemTap()):this.gp_hero.visible=!1,NoticeManager.updateNotice([NT.HERO_ARTIFACT,NT.HERO_RESONATE_RESONATE,NT.HERO_RESONATE_UNLOCK,NT.HERO_TREASURE,NT.HERO_UPSECTION,NT.HERO_UPSTAIR],this.heroProxy.allHeroByUuid[this.curUuid],!0),NoticeManager.updateNotice([NT.HERO_ARTIFACT_RESONATE],{heroInfo:this.curInfo},!0);for(n=1;n<7;n++)NoticeManager.updateNotice(NT.HERO_CAN_FORMATION[n-1],n,!0);for(var o in HeroEquipType){var a=HeroEquipType[o];NoticeManager.updateNotice(NT.HERO_EQUIP[a-1],{info:this.heroProxy.allHeroByUuid[this.curUuid],type:a},!0)}NoticeManager.updateNotice(NT.HERO_DERMA,{info:this.curInfo})},o.prototype.heroFoster_onItemTap=function(e){e&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex);var t=e&&e.item.type||this.heroInfo_tabbar.selectedItem&&this.heroInfo_tabbar.selectedItem.type||0;this.curType=t,this.img_btmPattern.visible=!1,this.gp_heroThing.visible=!1,this.gp_up.visible=!1,this.gp_upstar.visible=!1,this.gp_upgrade.visible=!1,this.gp_resonate.visible=!1,this.btn_up.visible=!1,this.btn_upstar.visible=!1;var i=this.isPet?"魔兽":"英雄";switch(this.img_bg.source=HeroRaceConfig[this.curInfo.config.race].bgSrc,this.img_base.source=HeroRaceConfig[this.curInfo.config.race].baseSrc,t){case o.HERO_INFO_TABBAR_TYPE.EQUIPMENT:this.img_btmPattern.visible=!0,this.blb_title.text=i+"装备",this.updateHeroThing();break;case o.HERO_INFO_TABBAR_TYPE.UPGRADE:this.btn_up.visible=!0,this.blb_title.text=i+"信息",this.updateHeroUpgrade();break;case o.HERO_INFO_TABBAR_TYPE.UPSTAR:this.btn_upstar.visible=!0,this.blb_title.text=i+"升星",this.updateHeroUpstar();break;case o.HERO_INFO_TABBAR_TYPE.RESONATE:this.blb_title.text=i+"羁绊",this.updateHeroResonate()}},o.prototype.updateTabbar=function(){this.heroInfoTabbarData=[{up:"_btn_yq_m_json.common_yeqian_shengji_0",down:"_btn_yq_m_json.common_yeqian_shengji_1",type:o.HERO_INFO_TABBAR_TYPE.UPGRADE}],this.isPet||this.heroInfoTabbarData.push({up:"_btn_yq_m_json.common_yeqian_zhuangbei_0",down:"_btn_yq_m_json.common_yeqian_zhuangbei_1",type:o.HERO_INFO_TABBAR_TYPE.EQUIPMENT}),this.curInfo.config.isStar?this.heroInfoTabbarData.push({up:"_btn_yq_m_json.common_yeqian_shengxing_0",down:"_btn_yq_m_json.common_yeqian_shengxing_1",type:o.HERO_INFO_TABBAR_TYPE.UPSTAR}):2==this.heroInfo_tabbar.selectedIndex&&(this.heroInfo_tabbar.selectedIndex=0),!this.isPet&&0<S.Config.heroResonateConfig(this.curInfo.config.subType).length?this.heroInfoTabbarData.push({up:"_btn_yq_m_json.common_yeqian_jiban_0",down:"_btn_yq_m_json.common_yeqian_jiban_1",type:o.HERO_INFO_TABBAR_TYPE.RESONATE}):3==this.heroInfo_tabbar.selectedIndex&&(this.heroInfo_tabbar.selectedIndex=0),this.heroInfo_tabbar.dataProvider=new eui.ArrayCollection(this.heroInfoTabbarData),this.removeNotice(),this.addNotice()},o.prototype.updateHeroThing=function(){var d=this;this.gp_heroThing.visible=!0;var u=this.heroThingProxy.getHeroEquips(this.curUuid),g=this.heroThingProxy.getHeroArtifactByHeroUuid(this.curUuid),f=this.heroThingProxy.getHeroTreasuresByUuid(this.curUuid),_=[];if(this.heroThingItems.forEach(function(e,t){for(var i=!1,n=0,o=u;n<o.length;n++){var a=o[n];if(e.entityType==EEntityType.EEntityTypeHeroEquip&&a.type==e.type){_.push(t),e.update({hero:d.heroProxy.allHeroByUuid[d.curUuid],vo:a}),i=!0;break}}if(!i)for(var r=0,s=g;r<s.length;r++){var c=s[r];if(e.entityType==EEntityType.EEntityTypeHeroArtifact&&c.type==e.type){i=!0,_.push(t),e.update({hero:d.heroProxy.allHeroByUuid[d.curUuid],vo:c});break}}if(!i)for(var l=0,h=f;l<h.length;l++){var p=h[l];if(e.entityType==EEntityType.EEntityTypeTreasure&&p.type==e.type){i=!0,_.push(t),e.update({hero:d.heroProxy.allHeroByUuid[d.curUuid],vo:p});break}}}),this.heroThingItems.forEach(function(e,t){_.indexOf(t)<0&&e.update({hero:d.heroProxy.allHeroByUuid[d.curUuid]})}),Utils.UnlockMgr.checkPass(MODULE.HeroArtifactResoante,!1).allow){var e=S.Config.heroArtifactResonate(this.curInfo.config.subType);this.btn_artifactResonate.visible=0<Object.keys(e).length}else this.btn_artifactResonate.visible=!1;var t=this.heroThingProxy.getHeroEquips(this.curUuid);if(UIActionManager.setGrey(this.btn_master,!1),4==t.length){var i=S.Config.getHeroEquipConfig(),n=0;for(var o in t){var a=i[t[o].code];a&&a.color<7&&(n=1)}n?UIActionManager.setGrey(this.btn_master,!0):UIActionManager.setGrey(this.btn_master,!1)}else UIActionManager.setGrey(this.btn_master,!0)},o.prototype.updateHeroUpgrade=function(){var t=this;this.gp_up.visible=!0,this.gp_upgrade.visible=!0;var s=this.curInfo,c=s.config;this.item_fightCap.update(s.fightCap),this.img_profession.source=ProfessionConfig[c.profession].icon,this.img_race.source=HeroRaceConfig[c.race].raceIconBig,this.lb_profession.text=c.name,this.lb_desc.text=c.desc,this.baseItem_avatar||(this.baseItem_avatar=customui.BaseItemFactory.create(),this.baseItem_avatar.scaleX=this.baseItem_avatar.scaleY=.7,this.baseItem_avatar.touchEnabled=!1,this.gp_heroAvatar.addChild(this.baseItem_avatar)),this.baseItem_avatar.updateData({code:s.code,effect:!0}),this.baseItem_avatar.gp_star_hero.visible=this.baseItem_avatar.img_type.visible=this.baseItem_avatar.gp_star_hero2.visible=!1,this.gp_upgrade_attr.removeChildren();for(var e=JSON.parse(s.attr),i=1;i<=4;i++)this.gp_upgrade_attr.addChild(new f({type:i,num:e[i]}));this.gp_skills.visible=!0;var l=JSON.parse(c.skillUnlock),h=!1,n=function(e){var t=p["skill_"+e];if(h)t.reset();else{var i=SKILL_CODE[e],n=c[i];if(n){var o=s.skillList.some(function(e){return e.code===n}),a="";o||(a=l[e]+"阶解锁");var r={code:n,unlock:o,unlockTips:a};p["skill_"+e].updateItem(r)}else p["skill_"+e].updateItem(),h=!0}},p=this;for(i=1;i<=5;i++)n(i);var o=S.Config.heroAndPetSectionConfig(this.isPet)[s.sectionLevel+1],a=o&&o.level||9999999,r=c.maxLevel,d=Math.min(a,r);this.lb_level.text=s.level+"/"+d;var u=S.Config.heroAndPetUpgradeConfig(this.isPet)[s.level]||{},g=JSON.parse(u.costs);(this.gp_cost.visible=!0,s.level==d)?(this.gp_costs_icon.visible=!1,this.btn_maxLevel.visible=!0,this.btn_maxLevel.y=200,this.btn_up.visible=!0,s.level==a?(this.btn_up.label="升阶",this.btn_up.skinName="skins.ButtonSkinYellow"):S.Config.heroAndPetUpstarConfig()[s.code]?(this.btn_up.label="升级",this.btn_up.skinName="skins.ButtonSkinGreen"):(this.btn_maxLevel.y=235,this.btn_up.visible=!1)):(this.gp_costs_icon.visible=!0,this.btn_maxLevel.visible=!1,this.gp_costs_icon.removeChildren(),g.forEach(function(e){t.gp_costs_icon.addChild(new customui.CommonIconWithNum({code:e[1],num:e[2],style:CommonIconStyle.RIGHT,showEnough:!0}))}),this.btn_up.visible=!0,this.btn_up.label="升级",this.btn_up.skinName="skins.ButtonSkinGreen");this.resource_bar.updateBar({costs:g,width:170,gap:70})},o.prototype.updateHeroUpstar=function(){var t=this;this.gp_up.visible=!0,this.gp_upstar.visible=!0;var e=S.Config.heroAndPetUpstarConfig(this.isPet),i=this.curInfo,n=i.config,o=i.starLevel,a=e[i.code];this.heroProxy.checkUpstarNotice(i)?(UIActionManager.setAbsGrey(this.btn_upstar,!1),this.btn_upstar.enabled=!0):(UIActionManager.setAbsGrey(this.btn_upstar,!0),this.btn_upstar.enabled=!1),this.gp_upstar_stars.removeChildren();var r=S.GeneralConfig.getHeroStarInfo(o);if(r.stage<4)for(var s=0;s<r.num;s++){var c=new eui.Image(r.src);this.gp_upstar_stars.addChild(c),c.scaleX=c.scaleY=.5}else this.gp_upstar_stars.addChild(new customui.HighStarLevelIcon({num:r.num,scale:.5}));if(a){this.gp_upstar_stars.addChild(new eui.Image("yingxion_img_xiaojiantou_png"));var l=S.GeneralConfig.getHeroStarInfo(o+1);if(l.stage<4)for(s=0;s<l.num;s++){c=new eui.Image(l.src);this.gp_upstar_stars.addChild(c),c.scaleX=c.scaleY=.5}else this.gp_upstar_stars.addChild(new customui.HighStarLevelIcon({num:l.num,scale:.5}))}this.gp_skills.visible=!1,this.gp_skills_2.visible=!1;var h=S.Config.allHeroConfig(this.isPet);if(o<10){var p=h[a.nextCode];this.gp_skills_2.visible=!0,this.gp_skills_2.removeChildren();var d=n[SKILL_CODE[a.upSkill]],u=p[SKILL_CODE[a.upSkill]],g=new customui.SkillItem({code:d});this.bindSkillPanelClick({target:g,x:34,bottom:170}),this.gp_skills_2.addChild(g);var f=new eui.Image("yingxion_img_xiaojiantou_png");f.scaleX=f.scaleY=1.8,this.gp_skills_2.addChild(f);var _=new customui.SkillItem({code:u});this.bindSkillPanelClick({target:_,x:34,bottom:170}),this.gp_skills_2.addChild(_),g.scaleX=g.scaleY=_.scaleX=_.scaleY=.8}else{this.gp_skills.visible=!0;var m=void 0;if(a){for(var y=a;e[y.nextCode];)y=e[y.nextCode];m=h[y.nextCode]}else m=h[this.curInfo.code];for(s=1;s<=5;s++){var v=this["skill_"+s],T=m["talent"+s],C=void 0;T&&(C={code:T,unlock:9+s<o,light:o==9+s}),v.updateItem(C)}}if(a?(this.gp_upstar_attrInfo.scaleY=1,this.blb_upstar_desc.text=a.attrShow+"%",this.lb_upstar_level_1.text="等级上限提升至：",this.blb_upstar_level.text=""+h[a.nextCode].maxLevel):(this.gp_upstar_attrInfo.scaleY=0,this.lb_upstar_level_1.text="等级上限：",this.blb_upstar_level.text=""+h[i.code].maxLevel),a){if(this.lb_upstar_max.visible=!1,this.gp_upstar_notMax.visible=!0,this.gp_cost.visible=!0,this.lb_upstar_limitation.visible=!1,this.gp_costs_icon.visible=!1,S.AppFacade.getInstance().retrieveProxy(S.PlayerPy.N).playerInfoVO.level<a.level)this.lb_upstar_limitation.visible=!0,this.lb_upstar_limitation.text="需求队伍等级："+a.level;else if(""!=a.fiveSlotCosts){var E=JSON.parse(a.fiveSlotCosts);this.gp_costs_icon.visible=!0,this.gp_costs_icon.removeChildren(),E[1].forEach(function(e){t.gp_costs_icon.addChild(new customui.CommonIconWithNum({code:e[1],num:e[2],style:CommonIconStyle.RIGHT,showEnough:!0}))})}this.gp_chosenHero.removeChildren();for(s=1;s<=4;s++)if(""!=a[this.conditionMap[s]]){this.upstarData[s]||(this.upstarData[s]={condition:a[this.conditionMap[s]],full:!1,uuids:[]});C=this.upstarData[s];var b=new N({data:this.upstarData,slot:s,targetUuid:this.curUuid});this.gp_chosenHero.addChild(b)}var I=!0;for(var A in this.upstarData)if(!this.upstarData[A].full){I=!1;break}4!=n.initStar||I?this.btn_upstar.label="升星":this.btn_upstar.label="一键放入"}else this.lb_upstar_max.visible=!0,this.gp_upstar_notMax.visible=!1,this.gp_cost.visible=!1;var P=[30000002,EPropertyType.EPropertyTypeGold];this.resource_bar.updateBar({costs:P,width:170,gap:70})},o.prototype.updateHeroResonate=function(){var i=this;this.gp_resonate.visible=!0;var e=this.curInfo.config.subType,t=this.curInfo.resonateLevelList[this.curInfo.resonateLevelList.length-1]||0,n=S.Config.heroResonateConfig(this.curInfo.config.subType,t),o=this.heroProxy.getHeroResonateOrders(this.curInfo),a=[];n.forEach(function(e){var t={uuid:i.curInfo.uuid,config:e,activated:!1};t.activated=0<=o.indexOf(e.order),a.push(t)}),a.sort(function(e,t){return e.config.order-t.config.order}),this.list_resonate.dataProvider=new eui.ArrayCollection(a),Utils.UnlockMgr.checkPass(MODULE.HeroAwaken,!1).allow&&10<=this.curInfo.config.initStar?(this.gp_resonate_unlock.visible=!0,this.list_resonate.layout.verticalGap=15,this.list_resonate.y=0,this.img_resonate_unlock.source=0===t?"jiban_img_weijuexing_png":"jiban_img_juexing"+t+"_png",this.blb_resonate_unlock.text=0<t?"羁绊"+NUM_TO_ROMAN_NUM[t]:"",this.btn_resonate_unlock.visible=this.curInfo.config.initStar>=S.Config.heroResonateLevelConfig(e,1).starLevel):(this.gp_resonate_unlock.visible=!1,this.list_resonate.layout.verticalGap=40,this.list_resonate.y=15)},o.prototype.updateHeroList=function(){if(!this.gp_heroitems.$children.length)for(var e=1;e<=6;e++){(t=new n).name=e.toString(),t.x=12.5+115*(e-1),this.gp_heroitems.addChildAt(t,0)}for(e=1;e<=6;e++){var t=this.gp_heroitems.getChildByName(e.toString()),i=Utils.UnlockMgr.checkPass(e,!1);t.updateItem({uuid:this.heroProxy.heroUuid22Pos[e],unlock:i,info:this.heroProxy.allHeroByUuid[this.heroProxy.heroUuid22Pos[e]]})}},o.prototype.updateOneHeroInfo=function(e,t){var i=this.heroThingProxy.AllDermaInfo[t],n=void 0;if(""==t)this.hero_model.update({code:e.code,isPet:!1}),this.lb_name.text=e.config.name,n=e.config.avatar;else{this.lb_name.text=S.Config.getHeroDermaConfig()[i.code].name;var o=S.Config.getHeroDermaConfig()[i.code];this.hero_model.update({code:e.code,isPet:!1,derma:o}),n=S.Config.getHeroDermaConfig()[i.code].avatar}var a=S.GeneralConfig.getHeroStarInfo(e.starLevel);if(this.gp_star.removeChildren(),a.stage<4)for(var r=0;r<a.num;r++)this.gp_star.addChild(new eui.Image(a.src));else this.gp_star.addChild(new customui.HighStarLevelIcon(a.num));var s=this.heroProxy.heroUuid22Pos[e.uuid],c=this.gp_heroitems.getChildByName(s.toString()),l=Utils.UnlockMgr.checkPass(s,!1);c.updateItem({uuid:this.heroProxy.heroUuid22Pos[s],unlock:l,info:e,oneAvatar:n})},o.prototype.updateHeroInfo=function(){if(this.lb_name.text=this.curInfo.config.name,this.img_race_icon.source=HeroRaceConfig[this.curInfo.config.race].raceIconBig,this.img_tier_icon.source=S.GeneralConfig.getHeroJingyingTag(this.curInfo.config.code),0!=this.curInfo.dermaCode){this.lb_name.text=S.Config.getHeroDermaConfig()[this.curInfo.dermaCode].name;var e=S.Config.getHeroDermaConfig()[this.curInfo.dermaCode];this.hero_model.update({code:this.curInfo.code,isPet:!1,derma:e})}else this.hero_model.update({code:this.curInfo.code,isPet:this.isPet});var t=S.GeneralConfig.getHeroStarInfo(this.curInfo.starLevel);if(this.gp_star.removeChildren(),t.stage<4)for(var i=0;i<t.num;i++)this.gp_star.addChild(new eui.Image(t.src));else this.gp_star.addChild(new customui.HighStarLevelIcon(t.num));this.btn_lock.icon=this.curInfo.isLocked?"common_btn_suoguan_png":"common_btn_suokai_png"},o.prototype.bindSkillPanelClick=function(t){var i=this,n=t.target;n.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){if(n.data&&n.data.code)for(var e in i.skill_panel.visible=!0,i.skill_panel.updateItem({code:n.data.code,tips:n.data.unlockTips}),t)"target"!=e&&(i.skill_panel[e]=t[e])},this),n.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skill_panel.visible=!1},this),n.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skill_panel.visible=!1},this),n.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skill_panel.visible=!1},this)},o.prototype.upgradeLogic=function(){var r=this,e=this.heroProxy.allHeroByUuid[this.curUuid],t=S.AppFacade.getInstance().retrieveProxy(S.BackpackPy.N),i=S.Config.heroAndPetUpgradeConfig(this.isPet)[e.level],n=i&&JSON.parse(i.costs),o=e.config,a=S.Config.heroAndPetSectionConfig(this.isPet)[e.sectionLevel+1];a&&e.level==a.level?(this.timer&&egret.clearInterval(this.timer),S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.SECTION,{data:e,isPet:this.isPet})):e.level==o.maxLevel?Utils.MsgUtils.addMidMsg("已达到该星级最大等级"):this.heroProxy.waitingServOper.upgrade||(this.heroProxy.waitingServOper.upgrade=!0,this.isPet||(t.getInfoByCode(n[0][1]).haveNum<Number(n[0][2])&&t.getInfoByCode(n[1][1]).haveNum>Number(n[1][2])?(Utils.MsgUtils.addMidMsg("所需经验水晶不足"),this.heroProxy.waitingServOper.upgrade=!1,this.timer&&egret.clearInterval(this.timer)):t.getInfoByCode(n[1][1]).haveNum<Number(n[1][2])&&t.getInfoByCode(n[0][1]).haveNum>Number(n[0][2])?(Utils.MsgUtils.addMidMsg("所需金币不足"),this.heroProxy.waitingServOper.upgrade=!1,this.timer&&egret.clearInterval(this.timer)):t.getInfoByCode(n[1][1]).haveNum<Number(n[1][2])&&t.getInfoByCode(n[0][1]).haveNum<Number(n[0][2])?(Utils.MsgUtils.addMidMsg("所需资源不足"),this.heroProxy.waitingServOper.upgrade=!1,this.timer&&egret.clearInterval(this.timer)):this.heroProxy.HeroUpGrade({uuid:this.curUuid,num:1,cb:function(e,t){Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shengji),DragonBoneTools.playUniqueEffect({effectName:"common_shengji",parent:r.hero_model,y:r.hero_model.height}),DragonBoneTools.playUniqueEffect({effectName:"common_ty_dj",parent:r.gp_root,x:r.gp_root.width/2,y:r.gp_root.height/2});var i=new eui.Group,n=new eui.VerticalLayout;n.gap=3,i.layout=n;for(var o=1;o<=4;o++){var a=new eui.Label(AttrConfig[o].name+"+"+Math.floor(Number(S.GeneralConfig.getAttrValue(t[o]-e[o]))));a.textColor=12405786,a.size=24,i.addChild(a)}i.horizontalCenter=0,i.y=r.hero_model.height/2,r.hero_model.addChild(i),egret.Tween.get(i).wait(300).to({y:i.y-50,alpha:0},400).call(function(){i&&i.parent&&i.parent.removeChild(i)})}})))},o.prototype.activateComponent=function(){var r=this;this.btn_up.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){Utils.UnlockMgr.checkPass(MODULE.HeroUpGradeAuto,!1).allow&&(this.timer=egret.setInterval(this.upgradeLogic,this,500)),this.upgradeLogic()},this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_END,function(){this.timer&&egret.clearInterval(this.timer)},this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){this.timer&&egret.clearInterval(this.timer)},this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){r.timer&&egret.clearInterval(r.timer)},this),this.btn_upstar.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var s=this,e=!0;for(var t in this.upstarData)if(!this.upstarData[t].full){e=!1;break}if(4!=this.curInfo.config.initStar||e){var i=this.curInfo,n=S.Config.heroAndPetUpstarConfig(this.isPet)[i.code];if(S.AppFacade.getInstance().retrieveProxy(S.PlayerPy.N).playerInfoVO.level<n.level)return void Utils.MsgUtils.addMidMsg("队伍等级不足");if(""!=n.fiveSlotCosts){var o=JSON.parse(n.fiveSlotCosts)[1];if(!S.AppFacade.getInstance().retrieveProxy(S.BackpackPy.N).checkEnough(o))return void Utils.MsgUtils.addMidMsg("道具不足")}if(e){var a=[];for(var t in this.upstarData)for(var r=0,c=this.upstarData[t].uuids;r<c.length;r++){var l=c[r];a.push({slotNum:Number(t),uuid:l})}this.isPet||(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shengxing),this.heroProxy.HeroUpStar({uuid:this.curUuid,uuidInfos:a,cb:function(e,t){s.touchEnabled=!1,s.touchChildren=!1,DragonBoneTools.playOnce({effectName:"common_zhihuanchenggong",parent:s.hero_model,y:s.hero_model.height,doneCB:function(){s.touchEnabled=!0,s.touchChildren=!0}});for(var i=s.gp_chosenHero.$children.length,n=0;n<i;++n){s.gp_chosenHero.getChildAt(n).updateItem({effect:!0})}var o=new eui.Group,a=new eui.VerticalLayout;a.gap=3,o.layout=a;for(n=1;n<=4;n++){var r=new eui.Label(AttrConfig[n].name+"+"+Math.floor(Number(S.GeneralConfig.getAttrValue(t[n]-e[n]))));r.textColor=12405786,r.size=24,o.addChild(r)}o.horizontalCenter=0,o.y=s.hero_model.height/2,s.hero_model.addChild(o),egret.Tween.get(o).wait(300).to({y:o.y-50,alpha:0},400).call(function(){o&&o.parent&&o.parent.removeChild(o)})}}))}else Utils.MsgUtils.addMidMsg("条件不满足")}else this.heroProxy.checkUpstarNotice(this.curInfo,this.upstarData),this.updateView()},this);for(var e=1;e<=5;e++){var t=this["skill_"+e];this.bindSkillPanelClick({target:t,x:34,bottom:e<4?200:132})}this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.FORMATION)},this),this.btn_master.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.UnlockMgr.checkPass(MODULE.HeroEquipMaster).allow){var e=this.heroThingProxy.getHeroEquips(this.curUuid);if(4==e.length){var t=S.Config.getHeroEquipConfig(),i=0;for(var n in e){var o=t[e[n].code];o&&o.color<7&&(i=1)}i?Utils.MsgUtils.addMidMsg("当穿齐4件金色及以上品质装备时可激活"):S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.MASTER,{vo:e,heroUuid:this.curUuid})}else Utils.MsgUtils.addMidMsg("当穿齐4件金色及以上品质装备时可激活")}},this),this.btn_change.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.SELECT,{pos:this.heroProxy.heroUuid22Pos[this.curUuid],isPet:this.isPet})},this),this.btn_comment.visible=!Utils.SDKMgr.getPerformConfig(44),this.btn_comment.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.curInfo?S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.HERO_COMMENT,{info:r.curInfo}):Utils.MsgUtils.addMidMsg("还没有英雄")},this),this.hero_model.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hero_model.changeAction(customui.HeroDynamicModel.TOUCH_ACTION_LIST)},this),this.btn_details.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.ATTR_DETAIL,{info:this.curInfo})},this),Utils.SDKMgr.getPerformConfig(200002)?(this.btn_gzgzh.visible=!0,this.btn_gzgzh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){S.GameMVC.activityMed.showViewByCode(EActivityType.GuanZhuGongZhongHao)},this)):(this.btn_gzgzh.visible=!1,this.btn_gzgzh.height=0),this.btn_derma.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.UnlockMgr.checkPass(MODULE.HeroDerma,!0).allow){var e=r.heroThingProxy.AllDermaInfo;if(0!=r.curInfo.dermaCode)S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.HERO_DERMA,{info:r.curInfo.config,uuid:r.curInfo.uuid,dermaCode:r.curInfo.dermaCode,isCanPutOn:!1,isCanPutDown:!0,isCanActivate:!1,isShowAllBtn:!0,putCB:r.updateOneHeroInfo.bind(r),putData:r.curInfo});else{var t=S.Config.getHeroDermaConfig(),i=!1;for(var n in t)t[n].subType==r.curInfo.config.subType&&(i=!0);if(i){var o=!1;for(var n in e)e[n].config.subType==r.curInfo.config.subType&&(o=!0);o?S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.HERO_DERMA,{info:r.curInfo.config,uuid:r.curInfo.uuid,dermaCode:r.curInfo.dermaCode,isCanPutOn:!0,isCanPutDown:!1,isCanActivate:!1,isShowAllBtn:!0,putCB:r.updateOneHeroInfo.bind(r),putData:r.curInfo}):S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.HERO_DERMA,{info:r.curInfo.config,uuid:r.curInfo.uuid,dermaCode:r.curInfo.dermaCode,isCanPutOn:!1,isCanPutDown:!1,isCanActivate:!0,isShowAllBtn:!0,putCB:r.updateOneHeroInfo.bind(r),putData:r.curInfo})}else{Utils.MsgUtils.addMidMsg("该英雄暂未拥有皮肤");var a=S.GameMVC.heroThingPy;S.AppFacade.getInstance().showSubView(S.FashionMediator.N,S.FashionMediator.SV.ALL_INFO,{module:MODULE.HeroDerma,allUuid:a.AllDermaInfo,bookConfig:S.Config.getHeroDermaHandbookConfig(),modelConfig:S.Config.getHeroDermaConfig()})}}}},this),Utils.TouchUtils.addTouchListener(this.btn_halo,function(){r.heroProxy.showCurHeroHalo()}),Utils.ComponentUtils.registerListener(this.btn_artifactResonate,egret.TouchEvent.TOUCH_TAP,function(){S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.ARTIFACT_RESONATE,{vo:r.curInfo})},this),Utils.ComponentUtils.registerListener(this.btn_resonate_attr,egret.TouchEvent.TOUCH_TAP,function(){S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.RESONATE_ATTR,{vo:r.curInfo})},this),Utils.ComponentUtils.registerListener(this.btn_resonate_unlock,egret.TouchEvent.TOUCH_TAP,function(){S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.HERO_PRACTICE,{vo:r.curInfo})},this),Utils.ComponentUtils.registerListener(this.btn_lock,egret.TouchEvent.TOUCH_TAP,function(){S.GameMVC.backpackPy.switchLock({lock:!r.curInfo.isLocked,type:EEntityType.EEntityTypeHero,uuid:r.curInfo.uuid,cb:function(){r.updateView()}})},this)},o.prototype.addNotice=function(){var e=[200,285],t=0;for(var i in NoticeManager.addNoticeListener(NT.HERO_UPSECTION,this.heroInfo_tabbar,this,{percentX:695/720,percentY:40/404}),NoticeManager.addNoticeListener(NT.HERO_THING,this.heroInfo_tabbar,this,{percentX:695/720,percentY:120/404}),this.heroInfoTabbarData.some(function(e){return e.type==o.HERO_INFO_TABBAR_TYPE.UPSTAR})&&NoticeManager.addNoticeListener(NT.HERO_UPSTAIR,this.heroInfo_tabbar,this,{percentX:695/720,percentY:e[t++]/404}),this.heroInfoTabbarData.some(function(e){return e.type==o.HERO_INFO_TABBAR_TYPE.RESONATE})&&(NoticeManager.addNoticeListener(NT.HERO_RESONATE,this.heroInfo_tabbar,this,{percentX:695/720,percentY:e[t++]/404}),NoticeManager.addNoticeListener(NT.HERO_RESONATE_UNLOCK,this.btn_resonate_unlock.iconDisplay,this,BTN_ICON_NOTICE_POS)),NT.HERO_CAN_FORMATION){var n=NT.HERO_CAN_FORMATION[i];NoticeManager.addNoticeListener(n,this.gp_heroitems,this,{percentX:(115*parseInt(i)+97)/705,percentY:14/132})}this.resFullImg.right=-10,this.resFullImg.visible=!1,this.btn_derma&&this.btn_derma.addChild(this.resFullImg),NoticeManager.addNoticeListener(NT.HERO_DERMA,this.btn_derma.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.GUAJI_GZGZH3,this.btn_gzgzh.getChildAt(0),this,BTN_ICON_NOTICE_POS)},o.HERO_INFO_TABBAR_TYPE={UPGRADE:0,EQUIPMENT:1,UPSTAR:2,RESONATE:3},o.BTN_TYPE={pinglun:{icon:"_btn_lb_m_json.common_icon_liaotian",text:"评论",id:"btn_comment"},buzhen:{icon:"_btn_lb_m_json.common_icon_buzhen",text:"布阵",id:"btn_formation"},derma:{icon:"_btn_lb_m_json.common_icon_pifu",text:"皮肤",id:"btn_derma"},halo:{icon:"_btn_lb_m_json.common_icon_guanghuan",text:"光环",id:"btn_halo"},huanzhen:{icon:"_btn_lb_m_json.common_icon_huanzhen",text:"换阵",id:"btn_change"}},o.BTN_LEFT_TYPE={pinglun:{icon:"_btn_lb_m_json.common_icon_guanzhuweixin",text:"关注微信",id:"btn_gzgzh"}},o}(BaseTab);S.HeroMainView=o,__reflect(o.prototype,"game.HeroMainView");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroMainView_HeroListItem",e.heroThingProxy=S.AppFacade.getInstance().retrieveProxy(S.HeroThingPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem),this.gp_baseitem.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){S.AppFacade.getInstance().updateView(S.HeroMediator.N,S.HeroMediator.SV.MAIN,{upstarData:{},uuid:this.data.uuid})},this),this.gp_empty.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.unlock.allow?S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.SELECT):Utils.MsgUtils.addMidMsg(this.data.unlock.ext.tips)},this)},e.prototype.updateItem=function(e){if(this.data=e,this.data.uuid)if(this.gp_baseitem.visible=!0,this.gp_empty.visible=!1,e.oneAvatar)this.baseItem.updateData({uuid:this.data.uuid,type:EEntityType.EEntityTypeHero,effect:!0,isShowZhongZhu:!0,avatar:e.oneAvatar,isShowEffect:!0});else if(0!=e.info.dermaCode){var t=S.Config.getHeroDermaConfig()[e.info.dermaCode].avatar;this.baseItem.updateData({uuid:this.data.uuid,type:EEntityType.EEntityTypeHero,effect:!0,isShowZhongZhu:!0,avatar:t,isShowEffect:!0})}else this.baseItem.updateData({uuid:this.data.uuid,type:EEntityType.EEntityTypeHero,effect:!0,isShowZhongZhu:!0});else this.gp_baseitem.visible=!1,this.gp_empty.visible=!0,this.data.unlock.allow?(this.img_add.visible=!0,this.img_lock.visible=!1,this.lb_unlock.visible=!1):(this.img_add.visible=!1,this.img_lock.visible=!0,this.lb_unlock.visible=!0,this.lb_unlock.text="LV "+this.data.unlock.ext.requestLevel)},e}(eui.Component);S.HeroMainView_HeroListItem=n,__reflect(n.prototype,"game.HeroMainView_HeroListItem");var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroMainView_PetItem",e.heroThingProxy=S.AppFacade.getInstance().retrieveProxy(S.HeroThingPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChildAt(this.baseItem,0),this.gp_baseitem.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){S.AppFacade.getInstance().updateView(S.HeroMediator.N,S.HeroMediator.SV.MAIN,{upstarData:{},uuid:this.data.uuid})},this),this.gp_empty.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.unlock.allow?S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.SELECT,{isPet:!0}):Utils.MsgUtils.addMidMsg(this.data.unlock.ext.tips)},this)},e.prototype.updateItem=function(e){if(this.data=e,this.data.uuid){this.gp_baseitem.visible=!0,this.gp_empty.visible=!1;var t=this.heroThingProxy.AllDermaInfo,i=void 0;for(var n in t)if(t[n].heroUuid==this.data.uuid){i=t[n].config.avatar;break}i?this.baseItem.updateData({uuid:this.data.uuid,type:EEntityType.EEntityTypePet,avatar:i,isShowEffect:!0}):this.baseItem.updateData({uuid:this.data.uuid,type:EEntityType.EEntityTypePet})}else this.gp_baseitem.visible=!1,this.gp_empty.visible=!0,this.data.unlock.allow?(this.img_add.visible=!0,this.img_lock.visible=!1):(this.img_add.visible=!1,this.img_lock.visible=!0)},e}(eui.Component);__reflect(e.prototype,"HeroMainView_PetItem");var f=function(i){function e(e){var t=i.call(this)||this;return t.data=e,t.skinName="HeroMainView_AttrItem",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data&&this.updateItem()},e.prototype.updateItem=function(e){e&&(this.data=e),this.img_icon.source=AttrConfig[this.data.type].icon;var t=S.GeneralConfig.getAttrValue(this.data.num);0<=t.indexOf("%")?this.blb_num.text=t:this.blb_num.text=Math.floor(Number(t)).toString()},e}(eui.Component);S.HeroMainView_AttrItem=f,__reflect(f.prototype,"game.HeroMainView_AttrItem");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroMainView_HeroThingItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.bi_root.touchEnabled=!1,this.scaleX=this.scaleY=1.1,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.clickFunction&&e.clickFunction()},this),UIActionManager.fadeBlink(this.img_canPuton,!0,!1,1e3)},e.prototype.update=function(e){var t=this;if(this.vo=e.vo,this.hero=e.hero,this.vo)this.img_zhanwei.visible=!1,this.img_canPuton.visible=!1,this.bi_root.visible=!0,this.bi_root.updateData({uuid:this.vo.uuid,code:this.vo.code,type:this.entityType,isNum:!0}),this.clickFunction=function(){S.AppFacade.getInstance().showSubView(S.HeroThingMediator.N,S.HeroThingMediator.SV.MAIN,{entityType:t.entityType,vo:t.vo,hero:t.hero,source:S.HeroThingMainView.VIEW_SOURCE.HERO})};else{this.bi_root.visible=!1,this.img_zhanwei.visible=!0;var i=this.unlockLevel(),n=S.AppFacade.getInstance().retrieveProxy(S.HeroThingPy.N),o=S.AppFacade.getInstance().retrieveProxy(S.PlayerPy.N).playerInfoVO.level;if(this.entityType==EEntityType.EEntityTypeTreasure?Utils.UnlockMgr.checkPass(MODULE.Treasure,!1).allow:i<=o){this.lb_unlock.visible=!1;var a="",r=n.AllArtiInfo;this.entityType==EEntityType.EEntityTypeHeroEquip?r=n.AllEquipInfo:this.entityType==EEntityType.EEntityTypeHeroArtifact?r=n.AllArtiInfo:this.entityType==EEntityType.EEntityTypeTreasure&&(r=n.AllTreasureInfo);var s=!1,c=S.Config.getHeroArtifactConfig();for(var l in r){var h=r[l];if(""==h.heroUuid&&this.type==h.type&&(this.entityType!=EEntityType.EEntityTypeHeroArtifact||c&&c[h.code]&&c[h.code].type==HeroArtifactType.Normal)){s=!0;break}}switch(this.entityType){case EEntityType.EEntityTypeHeroEquip:switch(this.type){case HeroEquipType.Ornament:a="baowu_img_xianglian";break;case HeroEquipType.Armour:a="baowu_img_kuijia";break;case HeroEquipType.Shoe:a="baowu_img_xiezi";break;case HeroEquipType.Weapon:a="baowu_img_wuqi"}break;case EEntityType.EEntityTypeHeroArtifact:a="baowu_img_fuwen"}this.img_canPuton.visible=s,this.img_zhanwei.source=a?a+"_png":a,this.img_zhanwei.verticalCenter=0}else this.img_zhanwei.source="common_img_suo_png",this.img_zhanwei.verticalCenter=-10,this.img_canPuton.visible=!1,this.lb_unlock.visible=!0,this.entityType==EEntityType.EEntityTypeTreasure?(Utils.UnlockMgr.checkPass(MODULE.Treasure,!1).ext.needOpen?this.lb_unlock.text="开服"+(Utils.UnlockMgr.checkPass(MODULE.Treasure,!1).ext.needOpen+1)+"天解锁":Utils.UnlockMgr.checkPass(MODULE.Treasure,!1).ext.requestLevel&&(this.lb_unlock.text=Utils.UnlockMgr.checkPass(MODULE.Treasure,!1).ext.requestLevel+"级解锁"),this.lb_unlock.size=17):(this.lb_unlock.text="LV "+i,this.lb_unlock.size=20),this.clickFunction=function(){if(t.entityType==EEntityType.EEntityTypeTreasure){var e=t.lb_unlock.text;Utils.MsgUtils.addMidMsg(e)}else Utils.MsgUtils.addMidMsg("队伍等级不足")}}},e}(eui.Component);S.HeroThingBox=t,__reflect(t.prototype,"game.HeroThingBox");var r=function(n){function e(e){var t=n.call(this)||this;return t.type=e,t.entityType=EEntityType.EEntityTypeHeroEquip,t.unlockLevel=function(){return S.Config.getHeroEquipUnlockLevel(t.type)},t}return __extends(e,n),e.prototype.update=function(e){var t=this;if(e){n.prototype.update.call(this,e);var i=S.AppFacade.getInstance().retrieveProxy(S.PlayerPy.N).playerInfoVO.level;!this.vo&&i>=this.unlockLevel()&&(this.clickFunction=function(){S.AppFacade.getInstance().showSubView(S.HeroThingMediator.N,S.HeroThingMediator.SV.SELECT,{entityType:t.entityType,heroUuid:t.hero.uuid,type:t.type,doneCB:function(e){S.AppFacade.getInstance().retrieveProxy(S.HeroThingPy.N).HeroEquipPutOn(e.uuid,t.hero.uuid,e.type)}})})}},e}(t);__reflect(r.prototype,"HeroEquipBox");var s=function(n){function e(e){var t=n.call(this)||this;return t.type=e,t.entityType=EEntityType.EEntityTypeHeroArtifact,t.unlockLevel=function(){return S.Config.getHeroArtifactUnlockLevel()},t}return __extends(e,n),e.prototype.update=function(e){var t=this;if(e){n.prototype.update.call(this,e);var i=S.AppFacade.getInstance().retrieveProxy(S.PlayerPy.N).playerInfoVO.level;!this.vo&&i>=this.unlockLevel()&&(this.clickFunction=function(){S.AppFacade.getInstance().showSubView(S.HeroThingMediator.N,S.HeroThingMediator.SV.SELECT,{entityType:t.entityType,heroUuid:t.hero.uuid,type:t.type,doneCB:function(e){S.AppFacade.getInstance().retrieveProxy(S.HeroThingPy.N).HeroArtifactPutOn(e.uuid,t.hero.uuid,e.type)}})})}},e}(t);__reflect(s.prototype,"HeroArtifactBox");var c=function(n){function e(e){var t=n.call(this)||this;return t.type=e,t.entityType=EEntityType.EEntityTypeTreasure,t.unlockLevel=function(){return S.Config.getHeroTreasureUnlockLevel()},t}return __extends(e,n),e.prototype.update=function(e){var t=this;if(e)if(n.prototype.update.call(this,e),this.vo)this.canActivateImg&&(this.canActivateImg.visible=!1);else{var i=Utils.UnlockMgr.checkPass(MODULE.Treasure,!1).allow;S.AppFacade.getInstance().retrieveProxy(S.PlayerPy.N).playerInfoVO.level;i&&(this.canActivateImg||(this.canActivateImg=new eui.Image("_border_m_json.common_img_jihuobaowu"),this.canActivateImg.left=this.canActivateImg.right=this.canActivateImg.top=this.canActivateImg.bottom=0,this.addChildAt(this.canActivateImg,this.numChildren-1)),this.canActivateImg.visible=!0,this.clickFunction=function(){S.AppFacade.getInstance().showSubView(S.HeroThingMediator.N,S.HeroThingMediator.SV.SPECIAL_TREASURE,{hero:t.hero})})}},e}(t);__reflect(c.prototype,"HeroTreasureBox");var N=function(i){function e(e){var t=i.call(this)||this;return t.heroProxy=S.AppFacade.getInstance().retrieveProxy(S.HeroPy.N),t.data=e,t.skinName="HeroMainView_UpstarItem",t.heroThingProxy=S.AppFacade.getInstance().retrieveProxy(S.HeroThingPy.N),t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_avatar.addChild(this.baseItem),this.updateItem(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.SELECT_UPSTAR,{data:this.data.data,targetUuid:this.data.targetUuid,slot:this.data.slot})},this)},e.prototype.updateItem=function(e){var t=this.data.data[this.data.slot],i=JSON.parse(t.condition),n=t.uuids.length,o=0,a=this.heroProxy.allHeroByUuid,r=S.Config.allHeroConfig(),s=0,c=0,l=[],h=this.heroThingProxy.AllDermaInfo,p=void 0;for(var d in h)if(h[d].heroUuid==this.data.uuid){p=h[d].config.avatar;break}if(1==i[0])this.baseItem.img_icon.visible=!0,p?this.baseItem.updateData({code:i[1][0][1],avatar:p,isShowEffect:!0}):this.baseItem.updateData({code:i[1][0][1]}),o=i[1][0][2];else if(2==i[0]){var u=this.findRandomHero(i[1]);p?this.baseItem.updateData({code:u,avatar:p,isShowEffect:!0}):this.baseItem.updateData({code:u}),i[1][0]?this.baseItem.img_type.visible=!0:this.baseItem.img_type.visible=!1;var g=S.Config.allHeroConfig()[u].initStar,f=1;[[0,3],[4,4],[5,5],[6,8],[9,9],[10,15]].forEach(function(e,t){g>=e[0]&&g<=e[1]&&(f=t+1)}),this.baseItem.img_icon.source="beibao_img_sptb_"+f+"_png",o=i[1][3]}for(var _ in this.blb_num.text=n+"/"+o,this.data.data)l=l.concat(this.data.data[_].uuids);for(var m in a){var y=a[m],v=r[y.code];m==this.data.targetUuid||-1!=l.indexOf(m)||this.heroProxy.heroUuid22Pos[m]||(1==i[0]?y.code==i[1][0][1]&&s++:2==i[0]&&(0!=i[1][0]&&v.race!=i[1][0]||0!=i[1][1]&&y.starLevel!=i[1][1]||0!=i[1][2]&&v.profession!=i[1][2]||c++))}UIActionManager.setAbsGrey(this.gp_avatar,n!=o),this.img_add.visible=n!=o?o<=s||o<=c:n!=o,UIActionManager.setGrey(this.baseItem,this.img_add.visible),this.gp_effect.removeChildren(),this.img_add.visible?egret.Tween.get(this.img_add,{loop:!0}).to({alpha:0},700,egret.Ease.cubicIn).wait(250).to({alpha:1},700,egret.Ease.cubicOut):e&&e.effect&&DragonBoneTools.playOnce({effectName:"common_yingxiongshengxing",parent:this.gp_effect,y:this.gp_effect.height/2,x:this.gp_effect.width/2})},e.prototype.findRandomHero=function(e){var t=S.Config.allHeroConfig();for(var i in t){var n=t[i];if(!(0!=e[0]&&n.race!=e[0]||0!=e[1]&&n.initStar!=e[1]||0!=e[2]&&n.profession!=e[2]))return Number(i)}},e}(eui.Component);__reflect(N.prototype,"HeroMainView_UpstarItem");var a=function(t){function r(){var e=t.call(this)||this;return e.skinName="HeroResonatePanel_ListItem",e.proxy=S.AppFacade.getInstance().retrieveProxy(S.HeroPy.N),e}return __extends(r,t),r.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_activate.labelDisplay.size=24,this.btn_activate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.activatable?this.proxy.HeroResonate({uuid:this.data.uuid,order:this.data.config.order,cb:function(){r.delay=500;var e=t.parent.parent.parent;DragonBoneTools.playOnce({effectName:"common_ty_jihuo",parent:e,x:e.width/2,y:-200})}}):Utils.MsgUtils.addMidMsg("条件不满足")},this)},r.prototype.dataChanged=function(){var i=this;this.gp_activated.visible=this.data.activated;var e=this.data.config;this.lb_title.text=e.desc;var t=JSON.parse(e.attrAdd1);this.lb_title.text=AttrConfig[t[0][0]].name+"加成："+S.GeneralConfig.getAttrValue(t[0][1]),this.gp_hero.removeChildren(),this.gp_effect.removeChildren(),this.gp_effect.touchEnabled=!1,this.gp_effect.touchChildren=!1,this.gp_effect.touchThrough=!0;var n=this.proxy.allHeroByUuid[this.data.uuid],o=customui.BaseItemFactory.create();o.scaleX=o.scaleY=.6,o.updateData({code:n.code,type:EEntityType.EEntityTypeHero}),this.gp_hero.addChild(o),this.jibanEffect(o);var a=JSON.parse(e.heroId);this.activatable=!0,a.forEach(function(e){i.gp_hero.addChild(new eui.Image("common_img_jia_png"));var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.6,t.updateData({code:e,type:EEntityType.EEntityTypeHero}),i.proxy.heroHistoryInfo[e]||(UIActionManager.setAbsGrey(t),i.activatable=!1),i.jibanEffect(t),i.gp_hero.addChild(t)}),r.delay=0,this.btn_activate.visible=this.activatable&&!this.data.activated},r.prototype.jibanEffect=function(t){var e=this;this.data.activated&&egret.setTimeout(function(){DragonBoneTools.create("common_jiban",function(e){e.x=t.x+t.width/2*.6,e.y=t.y+t.height/2*.6,e.scaleX=e.scaleY=.8,e.animation.play(),this.gp_effect.addChild(e)},e)},this,r.delay)},r.delay=0,r}(eui.ItemRenderer);__reflect(a.prototype,"HeroResonatePanel_ListItem");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroAttrDetailsPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_left,egret.TouchEvent.TOUCH_TAP,function(){e.updateView({type:1})},this),Utils.ComponentUtils.registerListener(this.btn_right,egret.TouchEvent.TOUCH_TAP,function(){e.updateView({type:2})},this)},e.prototype.updateView=function(e,t){var s=this;if(void 0===t&&(t=!1),this.info=e&&e.info||this.info,t){var i=S.Config.attrDescConfig(),n=[];for(var o in i){var a=i[o];a.isShow&&n.push(a)}n.sort(function(e,t){return e.priority-t.priority});var c=e.fromHeroChallenge;c?this.btn_left.visible=this.btn_right.visible=!1:(this.btn_left.visible=!1,this.btn_right.visible=!0);var l=JSON.parse(this.info.attr);n.forEach(function(e){var t=l[e.type]||0;if(!c||0!=t){var i=new eui.Group;i.width=300,i.height=27;var n=e.shortDesc,o=new eui.Label(n);o.size=24,i.addChild(o);var a=S.GeneralConfig.getAttrValue(t);c||(e.type<=4?a=Math.floor(Number(a)).toString():0==t&&(a+="%"));var r=new eui.Label(""+a);r.size=24,r.right=3,i.addChild(r),r.verticalCenter=o.verticalCenter=0,s.gp_listAttr.addChild(i)}}),this.gp_listAttr.$children.length?this.gp_empty.visible=!1:this.gp_empty.visible=!0,n.forEach(function(e){var t=new eui.Group;t.width=320;var i=new eui.Label(e.shortDesc+"：");i.y=2,i.textColor=764145,i.size=20,i.right=222,t.addChild(i);var n=new eui.Label(e.desc);n.y=2,n.size=20,n.width=230,n.left=100,n.lineSpacing=6,t.addChild(n),s.gp_listDesc.addChild(t)})}switch(e&&e.type||1){case 1:this.gp_attr.visible=!0,this.gp_desc.visible=!1,this.btn_left.visible=!1,this.btn_right.visible=!0;break;case 2:this.gp_attr.visible=!1,this.gp_desc.visible=!0,this.btn_left.visible=!0,this.btn_right.visible=!1}},e}(BasePanel);S.HeroAttrDetailsPanel=i,__reflect(i.prototype,"game.HeroAttrDetailsPanel");var l=function(t){function n(){var e=t.call(this)||this;return e.initialized=!1,e.upstarData={},e.index=0,e.resFullImg=new eui.Image("_main_m_json.maoxian_icon_man"),e.heroThingPos=[[-52,131],[67,7],[253,7],[367,131],[253,261],[67,261]],e.conditionMap={1:"oneSlotCosts",2:"twoSlotCosts",3:"threeSlotCosts",4:"fourSlotCosts"},e.skinName="HeroQuickTrainViewSkin",e.heroProxy=S.AppFacade.getInstance().retrieveProxy(S.HeroPy.N),e.heroThingProxy=S.AppFacade.getInstance().retrieveProxy(S.HeroThingPy.N),e.heroThingItems=new Array,e}return __extends(n,t),n.prototype.adaptForQuickTrain=function(){this.gp_hero_list.visible=!1,this.btn_back.visible=!0,this.gp_fightCap.visible=!0,this.initGPRightBtn()},n.prototype.initGPRightBtn=function(){for(var e in n.BTN_TYPEQUICK){var t=n.BTN_TYPEQUICK[e],i=new eui.Button;i.skinName="skins.ButtonSkinIcon2",i.width=80,i.height=94,i.icon=t.icon,i.label=t.text,this[t.id]=i,this.gp_right_btn.addChild(this[t.id]),!Utils.SDKMgr.getPerformConfig(2)||"fenxiang"!=e&&"pinglun"!=e||(i.visible=!1,i.enabled=!1)}},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initTabbar(),this.initThing(),this.adaptForQuickTrain(),this.activateComponent(),this.list_resonate.itemRenderer=a},n.prototype.initTabbar=function(e){void 0===e&&(e=!0),this.heroInfo_tabbar.itemRendererSkinName="HeroMainView_HeroInfoTabItem",this.heroInfo_tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.heroFoster_onItemTap,this),this.heroInfo_tabbar.selectedIndex=0},n.prototype.initThing=function(){var e=this,t=0;for(var i in HeroEquipType){var n=new r(HeroEquipType[i]);this.heroThingItems.push(n);var o=this.heroThingPos[t++];n.x=o[0],n.y=o[1],this.gp_thingBox.addChild(n)}n=new c;this.heroThingItems.push(n);o=this.heroThingPos[t++];n.x=o[0],n.y=o[1],this.gp_thingBox.addChild(n);n=new s;this.heroThingItems.push(n);o=this.heroThingPos[t++];n.x=o[0],n.y=o[1],this.gp_thingBox.addChild(n),this.btn_putOn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.heroProxy.HeroOneKeyPutOn(e.curUuid)},this),this.btn_putOff.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.heroProxy.HeroOneKeyPutDown(e.curUuid)},this)},n.prototype.updateView=function(e){var t=e&&e.uuid,i=!t&&!this.curUuid||t&&this.curUuid!=t;if(this.curUuid=t||this.curUuid,this.upstarData=e&&e.upstarData||this.upstarData,!this.curUuid)for(var n=1;n<=5;n++)if(this.heroProxy.heroUuid22Pos[n]){this.curUuid=this.heroProxy.heroUuid22Pos[n];break}this.curUuid?(this.gp_heroInfo.visible=!0,this.gp_hero.visible=!0,this.isPet=!1,this.curInfo=this.heroProxy.allHeroByUuid[this.curUuid],i&&this.updateTabbar(),this.updateHeroInfo(),this.heroFoster_onItemTap(),NoticeManager.updateNotice([NT.HERO_RESONATE_RESONATE,NT.HERO_RESONATE_UNLOCK],this.curInfo,!0),NoticeManager.updateNotice(NT.HERO_DERMA,{info:this.curInfo})):(this.gp_hero.visible=!1,this.gp_heroInfo.visible=!1)},n.prototype.heroFoster_onItemTap=function(e){e&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex);var t=e&&e.item.type||this.heroInfo_tabbar.selectedItem&&this.heroInfo_tabbar.selectedItem.type||0;this.curType=t,this.img_btmPattern.visible=!1,this.gp_heroThing.visible=!1,this.gp_up.visible=!1,this.gp_upstar.visible=!1,this.gp_upgrade.visible=!1,this.gp_resonate.visible=!1,this.btn_up.visible=!1,this.btn_upstar.visible=!1;var i=this.isPet?"魔兽":"英雄";switch(this.img_bg.source=HeroRaceConfig[this.curInfo.config.race].bgSrc,this.img_base.source=HeroRaceConfig[this.curInfo.config.race].baseSrc,t){case o.HERO_INFO_TABBAR_TYPE.EQUIPMENT:this.img_btmPattern.visible=!0,this.blb_title.text=i+"装备",this.updateHeroThing();break;case o.HERO_INFO_TABBAR_TYPE.UPGRADE:this.btn_up.visible=!0,this.blb_title.text=i+"信息",this.updateHeroUpgrade();break;case o.HERO_INFO_TABBAR_TYPE.UPSTAR:this.btn_upstar.visible=!0,this.blb_title.text=i+"升星",this.updateHeroUpstar();break;case o.HERO_INFO_TABBAR_TYPE.RESONATE:this.blb_title.text=i+"羁绊",this.updateHeroResonate()}},n.prototype.updateTabbar=function(){var e=[{up:"_btn_yq_m_json.common_yeqian_shengji_0",down:"_btn_yq_m_json.common_yeqian_shengji_1",type:o.HERO_INFO_TABBAR_TYPE.UPGRADE}];e.push({up:"_btn_yq_m_json.common_yeqian_zhuangbei_0",down:"_btn_yq_m_json.common_yeqian_zhuangbei_1",type:o.HERO_INFO_TABBAR_TYPE.EQUIPMENT}),this.curInfo.config.isStar&&e.push({up:"_btn_yq_m_json.common_yeqian_shengxing_0",down:"_btn_yq_m_json.common_yeqian_shengxing_1",type:o.HERO_INFO_TABBAR_TYPE.UPSTAR}),!this.isPet&&0<S.Config.heroResonateConfig(this.curInfo.config.subType).length&&e.push({up:"_btn_yq_m_json.common_yeqian_jiban_0",down:"_btn_yq_m_json.common_yeqian_jiban_1",type:o.HERO_INFO_TABBAR_TYPE.RESONATE}),this.heroInfo_tabbar.dataProvider=new eui.ArrayCollection(e),this.addNotice()},n.prototype.updateHeroUpgrade=function(){var t=this;this.gp_up.visible=!0,this.gp_upgrade.visible=!0;var s=this.curInfo,c=s.config;this.item_fightCap.update(s.fightCap),this.img_profession.source=ProfessionConfig[c.profession].icon,this.img_race.source=HeroRaceConfig[c.race].raceIconBig,this.lb_profession.text=c.name,this.lb_desc.text=c.desc,this.baseItem_avatar||(this.baseItem_avatar=customui.BaseItemFactory.create(),this.baseItem_avatar.scaleX=this.baseItem_avatar.scaleY=.7,this.baseItem_avatar.touchEnabled=!1,this.gp_heroAvatar.addChild(this.baseItem_avatar)),this.baseItem_avatar.updateData({code:s.code,effect:!0}),this.baseItem_avatar.gp_star_hero.visible=this.baseItem_avatar.img_type.visible=this.baseItem_avatar.gp_star_hero2.visible=!1,this.gp_upgrade_attr.removeChildren();for(var e=JSON.parse(s.attr),i=1;i<=4;i++)this.gp_upgrade_attr.addChild(new f({type:i,num:e[i]}));this.gp_skills.visible=!0;var l=JSON.parse(c.skillUnlock),h=!1,n=function(e){var t=p["skill_"+e];if(h)t.reset();else{var i=SKILL_CODE[e],n=c[i];if(n){var o=s.skillList.some(function(e){return e.code===n}),a="";o||(a=l[e]+"阶解锁");var r={code:n,unlock:o,unlockTips:a};p["skill_"+e].updateItem(r)}else p["skill_"+e].updateItem(),h=!0}},p=this;for(i=1;i<=5;i++)n(i);var o=S.Config.heroAndPetSectionConfig(this.isPet)[s.sectionLevel+1],a=o&&o.level||9999999,r=c.maxLevel,d=Math.min(a,r);this.lb_level.text=s.level+"/"+d;var u=S.Config.heroAndPetUpgradeConfig(this.isPet)[s.level]||{},g=JSON.parse(u.costs);(this.gp_cost.visible=!0,s.level==d)?(this.gp_costs_icon.visible=!1,this.btn_maxLevel.visible=!0,this.btn_maxLevel.y=200,this.btn_up.visible=!0,s.level==a?(this.btn_up.label="升阶",this.btn_up.skinName="skins.ButtonSkinYellow"):S.Config.heroAndPetUpstarConfig()[s.code]?(this.btn_up.label="升级",this.btn_up.skinName="skins.ButtonSkinGreen"):(this.btn_maxLevel.y=235,this.btn_up.visible=!1)):(this.gp_costs_icon.visible=!0,this.btn_maxLevel.visible=!1,this.gp_costs_icon.removeChildren(),g.forEach(function(e){t.gp_costs_icon.addChild(new customui.CommonIconWithNum({code:e[1],num:e[2],style:CommonIconStyle.RIGHT,showEnough:!0}))}),this.btn_up.visible=!0,this.btn_up.label="升级",this.btn_up.skinName="skins.ButtonSkinGreen");this.resource_bar.updateBar({costs:g,width:170,gap:70})},n.prototype.updateHeroThing=function(){var d=this;this.gp_heroThing.visible=!0;var u=this.heroThingProxy.getHeroEquips(this.curUuid),g=this.heroThingProxy.getHeroArtifactByHeroUuid(this.curUuid),f=this.heroThingProxy.getHeroTreasuresByUuid(this.curUuid),_=[];this.heroThingItems.forEach(function(e,t){for(var i=!1,n=0,o=u;n<o.length;n++){var a=o[n];if(e.entityType==EEntityType.EEntityTypeHeroEquip&&a.type==e.type){_.push(t),e.update({hero:d.heroProxy.allHeroByUuid[d.curUuid],vo:a}),i=!0;break}}if(!i)for(var r=0,s=g;r<s.length;r++){var c=s[r];if(e.entityType==EEntityType.EEntityTypeHeroArtifact&&c.type==e.type){i=!0,_.push(t),e.update({hero:d.heroProxy.allHeroByUuid[d.curUuid],vo:c});break}}if(!i)for(var l=0,h=f;l<h.length;l++){var p=h[l];if(e.entityType==EEntityType.EEntityTypeTreasure&&p.type==e.type){i=!0,_.push(t),e.update({hero:d.heroProxy.allHeroByUuid[d.curUuid],vo:p});break}}}),this.heroThingItems.forEach(function(e,t){_.indexOf(t)<0&&e.update({hero:d.heroProxy.allHeroByUuid[d.curUuid]})});var e=this.heroThingProxy.getHeroEquips(this.curUuid);if(UIActionManager.setGrey(this.btn_master,!1),4==e.length){var t=S.Config.getHeroEquipConfig(),i=0;for(var n in e){var o=t[e[n].code];o&&o.color<7&&(i=1)}i&&UIActionManager.setGrey(this.btn_master,!0)}else UIActionManager.setGrey(this.btn_master,!0)},n.prototype.updateHeroUpstar=function(){var t=this;this.gp_up.visible=!0,this.gp_upstar.visible=!0;var e=S.Config.heroAndPetUpstarConfig(this.isPet),i=this.curInfo,n=i.config,o=i.starLevel,a=e[i.code];this.heroProxy.checkUpstarNotice(i)?(UIActionManager.setAbsGrey(this.btn_upstar,!1),this.btn_upstar.enabled=!0):(UIActionManager.setAbsGrey(this.btn_upstar,!0),this.btn_upstar.enabled=!1),this.gp_upstar_stars.removeChildren();var r=S.GeneralConfig.getHeroStarInfo(o);if(r.stage<4)for(var s=0;s<r.num;s++){var c=new eui.Image(r.src);this.gp_upstar_stars.addChild(c),c.scaleX=c.scaleY=.5}else this.gp_upstar_stars.addChild(new customui.HighStarLevelIcon({num:r.num,scale:.5}));if(a){this.gp_upstar_stars.addChild(new eui.Image("yingxion_img_xiaojiantou_png"));var l=S.GeneralConfig.getHeroStarInfo(o+1);if(l.stage<4)for(s=0;s<l.num;s++){c=new eui.Image(l.src);this.gp_upstar_stars.addChild(c),c.scaleX=c.scaleY=.5}else this.gp_upstar_stars.addChild(new customui.HighStarLevelIcon({num:l.num,scale:.5}))}this.gp_skills.visible=!1,this.gp_skills_2.visible=!1;var h=S.Config.allHeroConfig(this.isPet);if(o<10){var p=h[a.nextCode];this.gp_skills_2.visible=!0,this.gp_skills_2.removeChildren();var d=n[SKILL_CODE[a.upSkill]],u=p[SKILL_CODE[a.upSkill]],g=new customui.SkillItem({code:d});this.bindSkillPanelClick({target:g,x:34,bottom:170}),this.gp_skills_2.addChild(g);var f=new eui.Image("yingxion_img_xiaojiantou_png");f.scaleX=f.scaleY=1.8,this.gp_skills_2.addChild(f);var _=new customui.SkillItem({code:u});this.bindSkillPanelClick({target:_,x:34,bottom:170}),this.gp_skills_2.addChild(_),g.scaleX=g.scaleY=_.scaleX=_.scaleY=.8}else{this.gp_skills.visible=!0;var m=void 0;if(a){for(var y=a;e[y.nextCode];)y=e[y.nextCode];m=h[y.nextCode]}else m=h[this.curInfo.code];for(s=1;s<=5;s++){var v=this["skill_"+s],T=m["talent"+s],C=void 0;T&&(C={code:T,unlock:9+s<o,light:o==9+s}),v.updateItem(C)}}if(a?(this.gp_upstar_attrInfo.scaleY=1,this.blb_upstar_desc.text=a.attrShow+"%",this.lb_upstar_level_1.text="等级上限提升至：",this.blb_upstar_level.text=""+h[a.nextCode].maxLevel):(this.gp_upstar_attrInfo.scaleY=0,this.lb_upstar_level_1.text="等级上限：",this.blb_upstar_level.text=""+h[i.code].maxLevel),a){if(this.lb_upstar_max.visible=!1,this.gp_upstar_notMax.visible=!0,this.gp_cost.visible=!0,this.lb_upstar_limitation.visible=!1,this.gp_costs_icon.visible=!1,S.AppFacade.getInstance().retrieveProxy(S.PlayerPy.N).playerInfoVO.level<a.level)this.lb_upstar_limitation.visible=!0,this.lb_upstar_limitation.text="需求队伍等级："+a.level;else if(""!=a.fiveSlotCosts){var E=JSON.parse(a.fiveSlotCosts);this.gp_costs_icon.visible=!0,this.gp_costs_icon.removeChildren(),E[1].forEach(function(e){t.gp_costs_icon.addChild(new customui.CommonIconWithNum({code:e[1],num:e[2],style:CommonIconStyle.RIGHT,showEnough:!0}))})}this.gp_chosenHero.removeChildren();for(s=1;s<=4;s++)if(""!=a[this.conditionMap[s]]){this.upstarData[s]||(this.upstarData[s]={condition:a[this.conditionMap[s]],full:!1,uuids:[]});C=this.upstarData[s];var b=new N({data:this.upstarData,slot:s,targetUuid:this.curUuid});this.gp_chosenHero.addChild(b)}var I=!0;for(var A in this.upstarData)if(!this.upstarData[A].full){I=!1;break}4!=n.initStar||I?this.btn_upstar.label="升星":this.btn_upstar.label="一键放入"}else this.lb_upstar_max.visible=!0,this.gp_upstar_notMax.visible=!1,this.gp_cost.visible=!1;var P=[30000002,EPropertyType.EPropertyTypeGold];this.resource_bar.updateBar({costs:P,width:170,gap:70})},n.prototype.updateHeroResonate=function(){var i=this;this.gp_resonate.visible=!0;var e=this.curInfo.config.subType,t=this.curInfo.resonateLevelList[this.curInfo.resonateLevelList.length-1]||0,n=S.Config.heroResonateConfig(this.curInfo.config.subType,t),o=this.heroProxy.getHeroResonateOrders(this.curInfo),a=[];n.forEach(function(e){var t={uuid:i.curInfo.uuid,config:e,activated:!1};t.activated=0<=o.indexOf(e.order),a.push(t)}),a.sort(function(e,t){return e.config.order-t.config.order}),this.list_resonate.dataProvider=new eui.ArrayCollection(a),Utils.UnlockMgr.checkPass(MODULE.HeroAwaken,!1).allow&&10<=this.curInfo.config.initStar?(this.gp_resonate_unlock.visible=!0,this.list_resonate.layout.verticalGap=15,this.list_resonate.y=0,this.img_resonate_unlock.source=0===t?"jiban_img_weijuexing_png":"jiban_img_juexing"+t+"_png",this.blb_resonate_unlock.text=0<t?"羁绊"+NUM_TO_ROMAN_NUM[t]:"",this.btn_resonate_unlock.visible=this.curInfo.config.initStar>=S.Config.heroResonateLevelConfig(e,1).starLevel):(this.gp_resonate_unlock.visible=!1,this.list_resonate.layout.verticalGap=40,this.list_resonate.y=15)},n.prototype.updateHeroInfo=function(){if(this.lb_name.text=this.curInfo.config.name,this.img_race_icon.source=HeroRaceConfig[this.curInfo.config.race].raceIconBig,this.img_tier_icon.source=S.GeneralConfig.getHeroJingyingTag(this.curInfo.config.code),0!=this.curInfo.dermaCode){S.Config.getHeroDermaConfig()[this.curInfo.dermaCode].model;this.lb_name.text=S.Config.getHeroDermaConfig()[this.curInfo.dermaCode].name;var e=S.Config.getHeroDermaConfig()[this.curInfo.dermaCode];this.hero_model.update({code:this.curInfo.code,isPet:!1,derma:e})}else this.hero_model.update({code:this.curInfo.code,isPet:this.isPet});var t=S.GeneralConfig.getHeroStarInfo(this.curInfo.starLevel);if(this.gp_star.removeChildren(),t.stage<4)for(var i=0;i<t.num;i++)this.gp_star.addChild(new eui.Image(t.src));else this.gp_star.addChild(new customui.HighStarLevelIcon(t.num));this.btn_lock.icon=this.curInfo.isLocked?"common_btn_suoguan_png":"common_btn_suokai_png"},n.prototype.bindSkillPanelClick=function(t){var i=this,n=t.target;n.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){if(n.data&&n.data.code)for(var e in i.skill_panel.visible=!0,i.skill_panel.updateItem({code:n.data.code,tips:n.data.unlockTips}),t)"target"!=e&&(i.skill_panel[e]=t[e])},this),n.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skill_panel.visible=!1},this),n.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skill_panel.visible=!1},this),n.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skill_panel.visible=!1},this)},n.prototype.upgradeLogic=function(){var r=this,e=this.heroProxy.allHeroByUuid[this.curUuid],t=S.AppFacade.getInstance().retrieveProxy(S.BackpackPy.N),i=S.Config.heroAndPetUpgradeConfig(this.isPet)[e.level],n=i&&JSON.parse(i.costs),o=e.config,a=S.Config.heroAndPetSectionConfig(this.isPet)[e.sectionLevel+1];a&&e.level==a.level?(this.timer&&egret.clearInterval(this.timer),S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.SECTION,{data:e,isPet:this.isPet})):e.level==o.maxLevel?Utils.MsgUtils.addMidMsg("已达到该星级最大等级"):this.heroProxy.waitingServOper.upgrade||(this.heroProxy.waitingServOper.upgrade=!0,this.isPet||(t.getInfoByCode(n[0][1]).haveNum<Number(n[0][2])&&t.getInfoByCode(n[1][1]).haveNum>Number(n[1][2])?(Utils.MsgUtils.addMidMsg("所需经验水晶不足"),this.heroProxy.waitingServOper.upgrade=!1,this.timer&&egret.clearInterval(this.timer)):t.getInfoByCode(n[1][1]).haveNum<Number(n[1][2])&&t.getInfoByCode(n[0][1]).haveNum>Number(n[0][2])?(Utils.MsgUtils.addMidMsg("所需金币不足"),this.heroProxy.waitingServOper.upgrade=!1,this.timer&&egret.clearInterval(this.timer)):t.getInfoByCode(n[1][1]).haveNum<Number(n[1][2])&&t.getInfoByCode(n[0][1]).haveNum<Number(n[0][2])?(Utils.MsgUtils.addMidMsg("所需资源不足"),this.heroProxy.waitingServOper.upgrade=!1,this.timer&&egret.clearInterval(this.timer)):this.heroProxy.HeroUpGrade({uuid:this.curUuid,num:1,cb:function(e,t){Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shengji),DragonBoneTools.playUniqueEffect({effectName:"common_shengji",parent:r.hero_model,y:r.hero_model.height}),DragonBoneTools.playUniqueEffect({effectName:"common_ty_dj",parent:r.gp_root,x:r.gp_root.width/2,y:r.gp_root.height/2});var i=new eui.Group,n=new eui.VerticalLayout;n.gap=3,i.layout=n;for(var o=1;o<=4;o++){var a=new eui.Label(AttrConfig[o].name+"+"+Math.floor(Number(S.GeneralConfig.getAttrValue(t[o]-e[o]))));a.textColor=12405786,a.size=24,i.addChild(a)}i.horizontalCenter=0,i.y=r.hero_model.height/2,r.hero_model.addChild(i),egret.Tween.get(i).wait(300).to({y:i.y-50,alpha:0},400).call(function(){i&&i.parent&&i.parent.removeChild(i)})}})))},n.prototype.addNotice=function(){this.heroInfo_tabbar.dataProvider.source.some(function(e){return e.type==o.HERO_INFO_TABBAR_TYPE.RESONATE})&&(NoticeManager.addNoticeListener(NT.HERO_RESONATE,this.heroInfo_tabbar,this,{percentX:695/720,percentY:285/404}),NoticeManager.addNoticeListener(NT.HERO_RESONATE_UNLOCK,this.btn_resonate_unlock.iconDisplay,this,BTN_ICON_NOTICE_POS)),this.resFullImg.right=-10,this.resFullImg.visible=!1,this.btn_derma&&this.btn_derma.addChild(this.resFullImg),NoticeManager.addNoticeListener(NT.HERO_DERMA,this.btn_derma.getChildAt(0),this,BTN_ICON_NOTICE_POS)},n.prototype.activateComponent=function(){var s=this;this.btn_up.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){Utils.UnlockMgr.checkPass(MODULE.HeroUpGradeAuto,!1).allow&&(this.timer=egret.setInterval(this.upgradeLogic,this,500)),this.upgradeLogic()},this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_END,function(){this.timer&&egret.clearInterval(this.timer)},this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){this.timer&&egret.clearInterval(this.timer)},this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){s.timer&&egret.clearInterval(s.timer)},this),this.btn_master.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.UnlockMgr.checkPass(MODULE.HeroEquipMaster).allow){var e=this.heroThingProxy.getHeroEquips(this.curUuid);if(4==e.length){var t=S.Config.getHeroEquipConfig(),i=0;for(var n in e){var o=t[e[n].code];o&&o.color<7&&(i=1)}i?Utils.MsgUtils.addMidMsg("当穿齐4件红色以上装备时激活"):S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.MASTER,{vo:e,heroUuid:this.curUuid})}else Utils.MsgUtils.addMidMsg("当穿齐4件红色以上装备时激活")}},this),this.btn_upstar.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var r=this,e=!0;for(var t in this.upstarData)if(!this.upstarData[t].full){e=!1;break}if(4!=this.curInfo.config.initStar||e){var i=this.curInfo,n=S.Config.heroAndPetUpstarConfig(this.isPet)[i.code];if(S.AppFacade.getInstance().retrieveProxy(S.PlayerPy.N).playerInfoVO.level<n.level)return void Utils.MsgUtils.addMidMsg("队伍等级不足");if(""!=n.fiveSlotCosts){var o=JSON.parse(n.fiveSlotCosts)[1];if(!S.AppFacade.getInstance().retrieveProxy(S.BackpackPy.N).checkEnough(o))return void Utils.MsgUtils.addMidMsg("道具不足")}if(e){var a=[];for(var t in this.upstarData)for(var s=0,c=this.upstarData[t].uuids;s<c.length;s++){var l=c[s];a.push({slotNum:Number(t),uuid:l})}this.isPet||(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shengxing),this.heroProxy.HeroUpStar({uuid:this.curUuid,uuidInfos:a,cb:function(e,t){DragonBoneTools.playOnce({effectName:"common_zhihuanchenggong",parent:r.hero_model,y:r.hero_model.height});var i=new eui.Group,n=new eui.VerticalLayout;n.gap=3,i.layout=n;for(var o=1;o<=4;o++){var a=new eui.Label(AttrConfig[o].name+"+"+Math.floor(Number(S.GeneralConfig.getAttrValue(t[o]-e[o]))));a.textColor=12405786,a.size=24,i.addChild(a)}i.horizontalCenter=0,i.y=r.hero_model.height/2,r.hero_model.addChild(i),egret.Tween.get(i).wait(300).to({y:i.y-50,alpha:0},400).call(function(){i&&i.parent&&i.parent.removeChild(i)})}}))}else Utils.MsgUtils.addMidMsg("条件不满足")}else this.heroProxy.checkUpstarNotice(this.curInfo,this.upstarData),this.updateView()},this);for(var e=1;e<=5;e++){var t=this["skill_"+e];this.bindSkillPanelClick({target:t,x:34,bottom:e<4?200:132})}this.btn_comment.visible=!Utils.SDKMgr.getPerformConfig(44),this.btn_comment.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.curInfo?S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.HERO_COMMENT,{info:s.curInfo}):Utils.MsgUtils.addMidMsg("还没有英雄")},this),this.btn_derma.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.UnlockMgr.checkPass(MODULE.HeroDerma,!0).allow){var e=s.heroThingProxy.AllDermaInfo,t=s.heroProxy.allHeroByUuid[s.curUuid];if(0!=t.dermaCode)S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.HERO_DERMA,{info:t.config,uuid:t.uuid,dermaCode:t.dermaCode,isCanPutOn:!1,isCanPutDown:!0,isCanActivate:!1,isShowAllBtn:!0,putCB:s.updateOneHeroInfo.bind(s),putData:t});else{var i=S.Config.getHeroDermaConfig(),n=!1;for(var o in i)i[o].subType==t.config.subType&&(n=!0);if(n){var a=!1;for(var o in e)e[o].config.subType==t.config.subType&&(a=!0);a?S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.HERO_DERMA,{info:t.config,uuid:t.uuid,dermaCode:t.dermaCode,isCanPutOn:!0,isCanPutDown:!1,isCanActivate:!1,isShowAllBtn:!0,putCB:s.updateOneHeroInfo.bind(s),putData:t}):S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.HERO_DERMA,{info:t.config,uuid:t.uuid,dermaCode:t.dermaCode,isCanPutOn:!1,isCanPutDown:!1,isCanActivate:!0,isShowAllBtn:!0,putCB:s.updateOneHeroInfo.bind(s),putData:t})}else{Utils.MsgUtils.addMidMsg("该英雄暂未拥有皮肤");var r=S.GameMVC.heroThingPy;S.AppFacade.getInstance().showSubView(S.FashionMediator.N,S.FashionMediator.SV.ALL_INFO,{module:MODULE.HeroDerma,allUuid:r.AllDermaInfo,bookConfig:S.Config.getHeroDermaHandbookConfig(),modelConfig:S.Config.getHeroDermaConfig()})}}}},this),this.hero_model.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hero_model.changeAction(customui.HeroDynamicModel.TOUCH_ACTION_LIST)},this),this.btn_details.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.ATTR_DETAIL,{info:this.curInfo})},this),this.btn_fenxiang.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=[[2,0,s.curInfo.config.code,EEntityType.EEntityTypeHero]];S.AppFacade.getInstance().retrieveProxy(S.MainPy.N).SendMessage(EChatChannelType.SameServer,"",0,function(){Utils.MsgUtils.addMidMsg("分享成功")},EChatSendCheckType.None,JSON.stringify(e))},this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){S.AppFacade.getInstance().hideSubView(S.HeroMediator.N,S.HeroMediator.SV.HERO_QUICK_TRAIN)},this),Utils.TouchUtils.addTouchListener(this.btn_halo,function(){s.heroProxy.showCurHeroHalo()}),Utils.ComponentUtils.registerListener(this.btn_resonate_attr,egret.TouchEvent.TOUCH_TAP,function(){S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.RESONATE_ATTR,{vo:s.curInfo})},this),Utils.ComponentUtils.registerListener(this.btn_resonate_unlock,egret.TouchEvent.TOUCH_TAP,function(){S.AppFacade.getInstance().showSubView(S.HeroMediator.N,S.HeroMediator.SV.HERO_PRACTICE,{vo:s.curInfo})},this),Utils.ComponentUtils.registerListener(this.btn_lock,egret.TouchEvent.TOUCH_TAP,function(){S.GameMVC.backpackPy.switchLock({lock:!s.curInfo.isLocked,type:EEntityType.EEntityTypeHero,uuid:s.curInfo.uuid,cb:function(){s.updateView()}})},this)},n.prototype.updateOneHeroInfo=function(e,t){var i=this.heroThingProxy.AllDermaInfo[t];if(""==t)this.hero_model.update({code:this.curInfo.code,isPet:!1}),this.lb_name.text=this.curInfo.config.name,this.curInfo.config.avatar;else{S.Config.getHeroDermaConfig()[i.code].model;this.lb_name.text=S.Config.getHeroDermaConfig()[i.code].name;var n=S.Config.getHeroDermaConfig()[i.code];this.hero_model.update({code:this.curInfo.code,isPet:!1,derma:n}),S.Config.getHeroDermaConfig()[i.code].avatar}var o=S.GeneralConfig.getHeroStarInfo(this.curInfo.starLevel);if(this.gp_star.removeChildren(),o.stage<4)for(var a=0;a<o.num;a++)this.gp_star.addChild(new eui.Image(o.src));else this.gp_star.addChild(new customui.HighStarLevelIcon(o.num))},n.BTN_TYPEQUICK={pinglun:{icon:"_btn_lb_m_json.common_icon_liaotian",text:"评论",id:"btn_comment"},fenxiang:{icon:"_btn_lb_m_json.common_icon_fenxiang",text:"分享",id:"btn_fenxiang"},derma:{icon:"_btn_lb_m_json.common_icon_pifu",text:"皮肤",id:"btn_derma"},halo:{icon:"_btn_lb_m_json.common_icon_guanghuan",text:"光环",id:"btn_halo"}},n}(BaseFull);S.HeroQuickTrainView=l,__reflect(l.prototype,"game.HeroQuickTrainView");var h=function(E){function e(e){var t=E.call(this)||this;return t.skinName="HeroUpResultPanelSkin",Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_jinjie),t.params=e,t}return __extends(e,E),e.prototype.childrenCreated=function(){E.prototype.childrenCreated.call(this);var e=S.AppFacade.getInstance().retrieveProxy(S.HeroPy.N);if(this.params){var t=this.params.oldData,i=this.params.newData,n=!1,o=S.Config.allHeroConfig()[t.code],a=S.Config.allHeroConfig()[i.code];if("HeroUpSection"==this.params.type){this.img_title.source="yingxion_txt_yxsj_png";var r=0,s=0,c=0,l={};for(var h in t.skillList){l[t.skillList[h].code]=-1}for(var h in i.skillList){var p=i.skillList[h];-1==l[p.code]?l[p.code]=0:l[p.code]=1}for(var d in l){var u=l[d];-1==u&&(r++,d),1==u&&(s++,c=Number(d))}!r&&s&&c&&(this.bm_skill.text="解锁新技能",this.SkillItem.updateItem({code:c}),this.gp_skill.scaleX=this.gp_skill.scaleY=0,GameRootLayer.gameLayer().switchTouchEnable(!1),egret.Tween.get(this.gp_skill).wait(200).to({scaleX:1,scaleY:1},500).call(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this),n=!0)}else if("HeroUpStar"==this.params.type){this.img_title.source="yingxion_txt_yxsx_png",this.bm_skill.text="技能升级";var g=S.Config.heroAndPetUpstarConfig(),f=o.initStar,_=g[t.code];if(f<10){var m=o[SKILL_CODE[_.upSkill]],y=a[SKILL_CODE[_.upSkill]];m!=y&&(this.gp_skill.scaleX=this.gp_skill.scaleY=0,GameRootLayer.gameLayer().switchTouchEnable(!1),egret.Tween.get(this.gp_skill).wait(200).to({scaleX:1,scaleY:1},500).call(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this),this.SkillItem.updateItem({code:y}),n=!0)}}var v=e.getMaxLevelByCodeAndSection(t.code,t.sectionLevel),T=e.getMaxLevelByCodeAndSection(i.code,i.sectionLevel);this.gp0.getChildAt(1).text=v,this.gp0.getChildAt(3).text=T;for(var C=1;C<4;C++)this["gp"+C].getChildAt(1).text=Math.floor(parseInt(S.GeneralConfig.getAttrValue(t.attr[C])))+"",this["gp"+C].getChildAt(3).text=Math.floor(parseInt(S.GeneralConfig.getAttrValue(i.attr[C])))+"";this.gp_skill.visible=n}},e.prototype.onDestroy=function(){E.prototype.onDestroy.call(this),S.AppFacade.getInstance().sendNotification(CN.ACTIVITY_SHOW_TRIGGER),S.AppFacade.getInstance().sendNotification(CN.SHOW_WECHAT_SHARE),egret.Tween.removeTweens(this.gp_skill)},e}(BasePanel);S.HeroUpResultPanel=h,__reflect(h.prototype,"game.HeroUpResultPanel")}(game||(game={})),function(l){var e=function(i){function c(e){void 0===e&&(e=null);var t=i.call(this,c.N,e)||this;return t.proxy=l.AppFacade.getInstance().retrieveProxy(l.MagicalArtifactPy.N),t}return __extends(c,i),c.prototype.initSubView=function(){this.addSubView(c.SV.MAIN,l.MagicalArtifactView),this.addSubView(c.SV.UP_SECTION_PANEL,l.MagicUpsectionPanel),this.addSubView(c.SV.MAGIC_COMMENT,l.MagicCommentView)},c.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.MAGICCOMMENT_UPDATE,CN.CONFIG_ALL_LOADED]},c.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.Magical,!1).allow&&this.proxy.GetMagicalInfo();break;case CN.MAGICCOMMENT_UPDATE:var i=this.getSubView(c.SV.MAGIC_COMMENT);i&&i.getPlayerTupMagic({params:t});break;case CN.CONFIG_ALL_LOADED:var n=l.Config.allMagicalConfig();for(var o in n){var a=n[o].code,r=l.Config.magicalSectionConfig(a),s=l.Config.magicalUpgradeConfig(a);s[0]&&NoticeManager.addCareCost(s[0].costs,function(){NoticeManager.updateNotice(NT.MAGICAL)}),s[1]&&NoticeManager.addCareCost(s[1].costs,function(){NoticeManager.updateNotice(NT.MAGICAL)}),r[1]&&NoticeManager.addCareCost(r[1].costs,function(){NoticeManager.updateNotice(NT.MAGICAL)})}}},c.N="MagicalArtifactMediator",c.SV={MAIN:1,UP_SECTION_PANEL:2,MAGIC_COMMENT:3},c}(BaseMediator);l.MagicalArtifactMediator=e,__reflect(e.prototype,"game.MagicalArtifactMediator")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.proxy=o.AppFacade.getInstance().retrieveProxy(o.SmithyPy.N),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.SmithyMainView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.Smithy,!1).allow&&this.proxy.GetSmithyInfo()}},n.N="SmithyMediator",n.SV={MAIN:1},n}(BaseMediator);o.SmithyMediator=e,__reflect(e.prototype,"game.SmithyMediator")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.initNotice(),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.TeamExpeView),this.addSubView(n.SV.DETAIL,o.TeamExpeditionChallengeView),this.addSubView(n.SV.JIJIE_CENTER,o.TeamExpeJiJieCenterPanel),this.addSubView(n.SV.JIJIE_MY_TEAM,o.TeamExpeJiJieMyTeamPanel)},n.prototype.initNotice=function(){NoticeManager.setChildType(NT.TEAM_EXPE_REWARD_ENTRANCE,[NT.TEAM_EXPE_REWARD,NT.TEAM_EXPE_APPLY_CENTER]),NoticeManager.setChildType(NT.TEAM_EXPE_APPLY_CENTER,[NT.TEAM_EXPE_APPLY_BTN])},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.TEAMEXPE_UPDATE_INFO,CN.TEAMEXPE_UPDATE_TEAM_INFO,CN.PLAYER_LEVEL_UP,CN.MAIN_COORDINATEINFO_UPDATE,CN.FIGHT_ALL_DONE_AND_EXIT,CN.TEAMEXPE_JUMP_TO_CHAPTER,CN.TEAMEXPE_UPDATE_MAP,CN.TEAMEXPE_OPEN_GATE,CN.UPDATE_APPLYRECORDS]},n.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:if(Utils.UnlockMgr.checkPass(MODULE.TeamExpedition,!1).allow){var i=o.AppFacade.getInstance().retrieveProxy(o.TeamExpePy.N);i.GetTeamExpeditionInfo(function(){i.amILeader()&&i.GetApplyRecord()})}break;case CN.TEAMEXPE_UPDATE_INFO:this.updateView(n.SV.MAIN);break;case CN.TEAMEXPE_UPDATE_TEAM_INFO:this.updateView(n.SV.JIJIE_CENTER),this.updateView(n.SV.JIJIE_MY_TEAM),this.getSubView(n.SV.MAIN)&&this.getSubView(n.SV.MAIN).updateTeamInfo(),o.AppFacade.getInstance().retrieveProxy(o.FriendPy.N).clearInviteHistory(MODULE.TeamExpedition);break;case CN.FIGHT_ALL_DONE_AND_EXIT:break;case CN.MAIN_COORDINATEINFO_UPDATE:if(!t||t.type!=MODULE.TeamExpedition)return;this.getSubView(n.SV.MAIN)&&this.getSubView(n.SV.MAIN).updateCoordInfo();break;case CN.TEAMEXPE_JUMP_TO_CHAPTER:this.getSubView(n.SV.MAIN)&&this.getSubView(n.SV.MAIN).jumpToChatper(t.chapter,t.isInit);break;case CN.TEAMEXPE_UPDATE_MAP:this.getSubView(n.SV.MAIN)&&this.getSubView(n.SV.MAIN).updateMap();break;case CN.TEAMEXPE_OPEN_GATE:this.getSubView(n.SV.MAIN)&&this.getSubView(n.SV.MAIN).openGate();break;case CN.UPDATE_APPLYRECORDS:if(Utils.UnlockMgr.checkPass(MODULE.TeamExpedition,!1).allow)o.AppFacade.getInstance().retrieveProxy(o.TeamExpePy.N).updateApplyList(t.list)}},n.prototype.onViewCreate=function(){this.sendNotification(CN.CITY_SWITCH_DBCLOCKPAUSE,!0),this.sendNotification(CN.GUAJI_HIDE_ALL_SUBVIEW)},n.N="TeamExpeMediator",n.SV={MAIN:1,DETAIL:2,JIJIE_CENTER:3,JIJIE_MY_TEAM:4},n}(BaseMediator);o.TeamExpeMediator=e,__reflect(e.prototype,"game.TeamExpeMediator")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.proxy=o.AppFacade.getInstance().retrieveProxy(o.WorldBossPy.N),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.WorldBossMainView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.WORLD_BOSS_UPDATE_MAP]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:var t=Utils.UnlockMgr.getOpenInfo(MODULE.ServerBoss);t.isOpen&&t.allow&&this.proxy.GetServerBossInfo();break;case CN.WORLD_BOSS_UPDATE_MAP:this.getSubView(n.SV.MAIN)&&this.getSubView(n.SV.MAIN).updateCoordInfo()}},n.prototype.onViewCreate=function(){this.sendNotification(CN.CITY_SWITCH_DBCLOCKPAUSE,!0),this.sendNotification(CN.GUAJI_HIDE_ALL_SUBVIEW)},n.N="WorldBossMediator",n.SV={MAIN:1},n}(BaseMediator);o.WorldBossMediator=e,__reflect(e.prototype,"game.WorldBossMediator")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.proxy=o.AppFacade.getInstance().retrieveProxy(o.WorldKingPy.N),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.WorldKingMainView),this.addSubView(n.SV.REWARD,o.WorldKingRewardPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.GENERAL_PASS_DAY]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GENERAL_PASS_DAY:case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.WorldKing,!1).allow&&this.proxy.GetWorldKingInfo()}},n.N="WorldKingMediator",n.SV={MAIN:1,REWARD:2},n}(BaseMediator);o.WorldKingMediator=e,__reflect(e.prototype,"game.WorldKingMediator")}(game||(game={}));var UTFMsg=function(){function e(){}return e.prototype.receive=function(e){var t=e.readUTF(),i=this.decode(t);return i&&game.AppFacade.getInstance().sendNotification(i.key,i.body),0},e.prototype.send=function(e,t){var i=this.encode(t);i&&(e.type=egret.WebSocket.TYPE_STRING,e.writeUTF(i))},e.prototype.decode=function(e){return egret.log("decode需要子类重写，根据项目的协议结构解析"),null},e.prototype.encode=function(e){return egret.log("encode需要子类重写，根据项目的协议结构解析"),null},e}();__reflect(UTFMsg.prototype,"UTFMsg",["BaseMsg"]),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.proxy=o.AppFacade.getInstance().retrieveProxy(o.GuildBossPy.N),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.GuildBossMainView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.GUILD_INFO_UPDATE,CN.GUILD_BOSS_UPDATE_MAP]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GUILD_INFO_UPDATE:o.AppFacade.getInstance().retrieveProxy(o.GuildPy.N).isInGuild()&&this.proxy.getOpenInfo().isOpen&&this.proxy.GetBossInfo();break;case CN.GUILD_BOSS_UPDATE_MAP:this.getSubView(n.SV.MAIN)&&this.getSubView(n.SV.MAIN).updateCoordInfo()}},n.prototype.onViewCreate=function(){this.sendNotification(CN.CITY_SWITCH_DBCLOCKPAUSE,!0),this.sendNotification(CN.GUAJI_HIDE_ALL_SUBVIEW)},n.N="GuildBossMediator",n.SV={MAIN:1},n}(BaseMediator);o.GuildBossMediator=e,__reflect(e.prototype,"game.GuildBossMediator")}(game||(game={}));var AssetAdapter=function(){function r(){}return r.getSrcChangeConfig=function(){if(!this._srcChangeCfg&&this._checkAvailable){var e=game.Config&&game.Config.getResChangeConfig();if(e){if(this._checkAvailable=!1,this._srcChangeCfg={},!Utils.SDKMgr.getPerformConfig(0))return;for(var t in e){var i=e[t];this._srcChangeCfg[i.src]=i.tar,this._srcChangeCfg[ResourceUtils.png(i.src)]=ResourceUtils.png(i.tar),this._srcChangeCfg[i.src+"_jpg"]=i.tar+"_jpg"}}}return this._srcChangeCfg},r.prototype.getAsset=function(t,i,n){function e(e){i.call(n,e,t)}var o=r.getSrcChangeConfig();if(o&&(t=o[t]||t),RES.hasRes(t)){var a=RES.getRes(t);a?e(a):RES.getResAsync(t,e,this)}else RES.getResByUrl(t,e,this,RES.ResourceItem.TYPE_IMAGE)},r._checkAvailable=!0,r}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var AssetsMgr=function(t){function e(){var e=t.call(this)||this;return e.assetObjDict={},e.unityKey2KeyDict={},e.key2UnityKey={},e.destoryResQueue=new Array,e}return __extends(e,t),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log("AssetsMgr",e)},e.prototype.getResAsync=function(i,n,o,e){if(this.checkNeed(i)){e&&(this.unityKey2KeyDict[e]||(this.unityKey2KeyDict[e]={}),this.unityKey2KeyDict[e][i]=!0,this.key2UnityKey[i]=e);var a=this.assetObjDict[i];a||(a=customui.AssetsObjFactory.create({key:i}),this.assetObjDict[a.key]=a),a.raiseRes(),RES.getResAsync(i,function(e,t){a.addDataName(i),n.call(o,e,t)},this)}else this.log("该资源不支持:"+i),RES.getResAsync(i,n,o)},e.prototype.raiseRes=function(e,t){if(void 0===t&&(t=!1),!t&&this.unityKey2KeyDict[e])for(var i in this.unityKey2KeyDict[e])this.raiseRes(i,!0);else{var n=this.assetObjDict[e];if(!n)return;n.raiseRes()}},e.prototype.reduceRes=function(e,t){if(void 0===t&&(t=!1),!t&&this.unityKey2KeyDict[e]){var i=!0;for(var n in this.unityKey2KeyDict[e])i=this.reduceRes(n,!0)&&i;return i}var o=this.assetObjDict[e];return!!o&&o.reduceRes()},e.prototype.destoryRes=function(e,t){if(void 0===t&&(t=!1),!t&&this.unityKey2KeyDict[e])for(var i in this.unityKey2KeyDict[e])this.destoryRes(i,!0);else{var n=this.assetObjDict[e];if(!n)return!1;n.dispose(),delete this.assetObjDict[e],Utils.ObjectPoolMgr.push(n);var o=this.key2UnityKey[e];if(o){var a=this.unityKey2KeyDict[o];delete this.key2UnityKey[e],delete a[e],0==Object.keys(a).length&&delete this.unityKey2KeyDict[o]}}return!0},e.prototype.checkNeed=function(e){return RES.hasRes(e)},e.prototype.loadGroup=function(e){RES.loadGroup(e)},e.prototype.destroyGroup=function(e){RES.destroyRes(e)},e}(BaseClass);__reflect(AssetsMgr.prototype,"AssetsMgr"),function(e){var t=function(){function e(){}return e.create=function(e){return Utils.ObjectPoolMgr.pop("customui.AssetsObj",e)},e}();e.AssetsObjFactory=t,__reflect(t.prototype,"customui.AssetsObjFactory");var i=function(){function e(){this.refCount=0}return e.prototype.raiseRes=function(){this.refCount++},e.prototype.reduceRes=function(){return this.refCount--,this.refCount<=0&&(Utils.AssetsMgr.destoryRes(this.key),!0)},e.prototype.isAlive=function(){return 0<this.refCount},e.prototype.addDataName=function(e){this.dataName=e},e.prototype.dispose=function(){this.dataName&&RES.destroyRes(this.dataName)},e.prototype.onOPReset=function(){this.dataName=void 0,this.refCount=0},e.prototype.onOPComeBack=function(e,t){this.key=e.key},e.prototype.onOPClean=function(){this.onOPReset()},e.prototype.onOPCheck=function(e){egret.log("alive")},e}();e.AssetsObj=i,__reflect(i.prototype,"customui.AssetsObj",["IObjectPoolInterface"])}(customui||(customui={}));var CacheMgr=function(t){function e(){var e=t.call(this)||this;return e.key2CacheObj={},e.cacheGP=new eui.Group,e.cacheGP.visible=!1,e.cacheGP.touchEnabled=!1,GameRootLayer.gameLayer().addChild(e.cacheGP),e}return __extends(e,t),e.prototype.setCacheComponent=function(e,t){this.cacheGP.contains(t)||(t.parent&&t.parent.contains(t)&&t.parent.removeChild(t),t.getChildByName("_effectOnObj")?t.getChildByName("_effectOnObj").animation.stop():"_effectOnObj"==t.name&&t.animation.stop(),this.key2CacheObj[e]=t,this.cacheGP.addChild(t))},e.prototype.getCacheComponent=function(e,t){var i=this.key2CacheObj[e];if(i&&this.cacheGP.contains(i))return this.cacheGP.removeChild(i),this.key2CacheObj[e]=void 0,t.addChild(i),i.getChildByName("_effectOnObj")?i.getChildByName("_effectOnObj").animation.play():"_effectOnObj"==i.name&&i.animation.play(),i;this.key2CacheObj[e]=void 0},e.prototype.checkInCacheComponent=function(e){return this.key2CacheObj[e]},e}(BaseClass);__reflect(CacheMgr.prototype,"CacheMgr"),function(o){var e=function(){function c(){}return c.helpConfig=function(t){if(c.pack.g_help)return t(c.pack.g_help);RES.getResAsync("g_help_json",function(e){c.pack.g_help=e,t(c.pack.g_help)},this)},c.skillConfig=function(){return c.pack.g_skill},c.chessHero=function(){return c.pack.t_chess_hero},c.chessLevelHero=function(e){return c.pack.t_chess_level[e]},c.chessLevelHeroOther=function(e){return 0==c.pack.t_chess_level[e].exp&&(e-=1),c.pack.t_chess_level[e]},c.chessLevelHeroLength=function(){var e=[];for(var t in c.pack.t_chess_level)e.push(c.pack.t_chess_level[t]);return e.length},c.chessExpShop=function(e){return c.pack.t_chess_exp_shop[e||1]},c.chessStarLevel=function(){return c.pack.t_chess_star_level},c.chessRecommend=function(){return c.pack.t_chess_recommend},c.chessGrasp=function(){return c.pack.t_chess_card_pool_grasp},c.chessAchieveLevel=function(){return c.pack.t_chess_achieve_level},c.chessAchieveTask=function(){return c.pack.t_chess_achieve_task},c.chessAchieveLevelList=function(){var e=[];for(var t in c.pack.t_chess_achieve_level)e.push(c.pack.t_chess_achieve_level[t]);return e},c.chessAchieveTaskList=function(){var e=[];for(var t in c.pack.t_chess_achieve_task)e.push(c.pack.t_chess_achieve_task[t]);return e},c.manorLayer=function(){return c.pack.t_manor_layer},c.manor=function(){return c.pack.t_manor},c.stormWarLayer=function(){return c.pack.t_storm_war_layer},c.stormWarDoubleHit=function(){return c.pack.t_storm_war_double_hit},c.stormWarCreep=function(){return c.pack.t_storm_war_creep},c.stormWarRewards=function(){return c.pack.t_storm_war_rewards},c.buffResConfig=function(){return c.pack.t_buff_res},c.getRandNameList=function(){return c.pack.t_rand_name_list},c.getPerNameList=function(){return c.pack.t_perfix_name_list},c.getNextNameList=function(){return c.pack.t_next_name_list},c.guideFlowConfig=function(){return c.pack.t_guide_flow},c.guideStepConfig=function(){return c.pack.t_guide_step},c.guideHeroShow=function(){return c.pack.t_guide_hero_show},c.constConfig=function(){return c.pack.t_const||(c.pack.t_const=RES.getRes("t_const_json")),c.pack.t_const},c.mailConfig=function(){return c.pack.t_mail},c.getRechargeConfig=function(){return c.pack.t_recharge_level},c.getResChangeConfig=function(){return c.pack.t_res_change},c.targetReward=function(e){if(null!=e){for(var t=[],i=0,n=c.pack.t_target_rewards;i<n.length;i++){var o=n[i];o.type==e&&t.push(o)}return t}return c.pack.t_target_rewards},c.attributeRestraintConfig=function(){return c.pack.t_attribute_restraint},c.attrDescConfig=function(){return c.pack.t_attribute_desc},c.petMasterConfig=function(){return c.pack.t_pet_master},c.magicalMasterConfig=function(){return c.pack.t_magical_master},c.VIPUpgradeConfig=function(){return c.pack.t_vip_upgrade},c.VIPConfig=function(e){if(void 0===e&&(e=!1),e)return c.pack.t_vip;var t=o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N);return c.pack.t_vip[t.playerInfoVO.playerVip.vipLevel]},c.errConfig=function(){return c.pack.t_error_code||(c.pack.t_error_code=RES.getRes("t_error_code_json")),c.pack.t_error_code},c.getModuleConfig=function(){return c.pack.t_module_open},c.unlockConfig=function(e){if(null!=e){if(Utils.SDKMgr.getPerformConfig(10018)&&100100==e)return;return c.pack.t_unlock[e]}return c.pack.t_unlock},c.publicBuyCostConfig=function(e,t){if(void 0===t&&(t=0),e){for(var i=void 0,n=0,o=c.pack.t_public_buy_cost;n<o.length;n++){var a=o[n];if(a.type===e&&(i=a).num===t+1)return i}return i}return c.pack.t_public_buy_cost},c.propertyConfig=function(){return c.pack.t_property_color},c.getPropertyByTypeCode=function(e,t){var i=c.propertyConfig();for(var n in i)if(i[n].type===e&&i[n].code===t)return i[n]},c.wayConfig=function(){return c.pack.t_way},c.getMainWayConfigByIdAndEntityType=function(e,t){for(var i=[],n=0,o=c.pack.t_main_way;n<o.length;n++){var a=o[n];if(a.code===e&&a.entityType===t){""!=a.way&&(i=JSON.parse(a.way));break}}return i},c.playerAvatarChangeConfig=function(){return c.pack.t_player_change_avatar},c.playerLevelUpgrade=function(){return c.pack.t_player_level_upgrade},c.dailyTaskExpConfig=function(){return c.pack.t_dailyTaskExp},c.risk=function(){return c.pack.t_risk},c.riskFortress=function(){return c.pack.t_risk_fortress},c.riskLayer=function(){return c.pack.t_risk_layer},c.riskLayerTheme=function(){return c.pack.t_risk_layer_theme},c.riskMaze=function(){return c.pack.t_risk_maze},c.riskMine=function(){return c.pack.t_risk_mine},c.strongConfig=function(){return c.pack.t_how_to_strong},c.riskCreep=function(){return c.pack.t_risk_creep},c.riskQuora=function(){return c.pack.t_risk_quora},c.riskEvent=function(){return c.pack.t_risk_event},c.riskEventDesc=function(){return c.pack.t_risk_event_desc},c.riskEventUnicursal=function(){return c.pack.t_risk_unicursal},c.riskEventTask=function(){return c.pack.t_risk_task},c.quoraConfig=function(){return c.pack.t_quora},c.zoneQuoraConfig=function(){return c.pack.t_zone_quora},c.demonConfig=function(){return c.pack.t_demon},c.demonCreepConfig=function(){return c.pack.t_demon_creep},c.creepConfig=function(e){if(e){var t=c.pack.t_creep[e];if(t)return c.pack.t_hero[t.heroId]}return c.pack.t_creep},c.heroConfigBySubType=function(e){var t=[];if(e)for(var i in c.pack.t_hero)c.pack.t_hero[i].subType==e&&t.push(c.pack.t_hero[i]);return t},c.rankingRewardByTypeConfig=function(e,t){var i=[],n=Utils.TimerManager.getServerTime(),o=new Date;o.setTime(1e3*n);var a=o.getDay();if(t)for(var r in c.pack.t_ranking_reward){if(c.pack.t_ranking_reward[r].type===e)if((s=c.pack.t_ranking_reward[r]).rankLower>=t&&t>=s.rankUpper&&(0==s.wDay||s.wDay==a))return i.push(s),i}else for(var r in c.pack.t_ranking_reward){var s;(s=c.pack.t_ranking_reward[r]).type!==e||0!=s.wDay&&s.wDay!=a||i.push(c.pack.t_ranking_reward[r])}return i},c.taskConfig=function(){return c.pack.t_task},c.zoneBossBossConfig=function(){return c.pack.t_zone_boss_boss},c.zoneBossTaskConfig=function(e){var t={};for(var i in c.pack.t_zone_boss_task){var n=c.pack.t_zone_boss_task[i];n.round==e&&(t[n.type]=n)}return t},c.taskConfigByTypeSperBySubtype=function(e){var t={};for(var i in c.pack.t_task){(n=c.pack.t_task[i]).type==e&&(t[n.subType]?t[n.subType].push(n):t[n.subType]=[n])}for(var i in t){var n;(n=t[i]).sort(function(e,t){return e.code-t.code})}return t},c.braveBook=function(){return c.pack.t_braveBook_task},c.HeroEquipCompound=function(){return c.pack.t_hero_equip_compound},c.arena_hRankReward=function(){return c.pack.t_arena_hRankReward},c.shop=function(){return c.pack.t_shop},c.refreshShop=function(){return c.pack.t_refresh_shop},c.shopWork=function(e){for(var t in c.pack.t_shop_work){var i=c.pack.t_shop_work[t];if(i.shopType==e)return i}return c.pack.t_shop_work},c.itemConfig=function(){return c.pack.t_item},c.getStoryConfigByIds=function(e){return new Array},c.activityConfigs=function(){return c.pack.t_activity_img},c.relationRewardConfigs=function(){return c.pack.t_relation_reward},c.magpieConfigs=function(){return c.pack.t_magpie_talk},c.magpieEventConfigsByCode=function(e){if(e){var t=c.pack.t_magpie_event;for(var i in t)if(t[i].code==e)return t[i]}},c.magpieEventConfigs=function(e){if(!e)return c.pack.t_magpie_event;var t=c.pack.t_magpie_event;for(var i in t)if(t[i].type==e)return t[i]},c.magpieAchieveConfigs=function(){return c.pack.t_magpie_achieve},c.braveBookLevelConfigs=function(){return c.pack.t_braveBook_level},c.braveBookstarRewardConfigs=function(){return c.pack.t_braveBook_starReward},c.newBraveBookTasksConfig=function(){return c.pack.t_newBraveBook_task},c.newBraveBookLevelConfig=function(){return c.pack.t_newBraveBook_level},c.newBraveBookRewardConfig=function(){return c.pack.t_newBraveBook_starReward},c.broadcastConfig=function(){return c.pack.t_broadcast},c.broadcastLinkConfig=function(){return c.pack.t_broadcast_link},c.broadcastSentencesConfig=function(){return c.pack.t_broadcast_sentences},c.getTimeBroadcast=function(){var e=[];for(var t in c.pack.t_broadcast){var i=c.pack.t_broadcast[t];i.isRanomd==SystemMessageTrigger.time&&e.push(i)}return e},c.luckyMoneyConfig=function(){return c.pack.t_lucky_money},c.getGuildtranscriptConfig=function(){return c.pack.t_guild_transcript},c.getGuildtranscriptRewardConfig=function(){return c.pack.t_guild_transcript_ranking},c.guilddevoteConfig=function(){return c.pack.t_devote},c.guildLevelUpgradeConfig=function(){return c.pack.t_guild_level_upgrade},c.guildSkillConfig=function(){return c.pack.t_guild_skill},c.getGuildCollect=function(){return c.pack.t_guild_collect},c.guildBossConfig=function(){return c.pack.t_guild_boss},c.guild_skill_reset=function(){return c.pack.t_guild_skill_reset},c.progressBar_node=function(e){var t=[];for(var i in c.pack.t_progressBar_node){var n=c.pack.t_progressBar_node[i];n.type==e&&t.push(n)}return t.sort(function(e,t){return e.key-t.key}),t},c.unzipStep=function(){for(var e=0;e<3;e++){var t=this._fileToUnzip.shift(),i=this._zip.file("config/"+t+".json");i&&(i=JSON.parse(i.asText()),c.pack[t]=i)}this._itemsLoaded+=3,this._processCB&&this._processCB.call(this._context,{itemsLoaded:this._itemsLoaded,itemsTotal:this._itemsTotal},this._context),this._itemsLoaded>=this._itemsTotal&&(GameRootLayer.gameLayer().loadLayer.removeEventListener(egret.Event.ENTER_FRAME,this.unzipStep,this),this._allDoneCB&&this._allDoneCB.call(this._context),this._zip=void 0,this._fileToUnzip=[],this._processCB=void 0,this._allDoneCB=void 0,this._context=void 0,this.unzipFinish=!0,RES.destroyRes("config_all_zip"))},c.unzipSync=function(e,t,i){for(var n in this._itemsTotal=Object.keys(c.pack).length,this._itemsLoaded=0,this._processCB=e,this._allDoneCB=t,this._context=i,this._zip=new JSZip(RES.getRes("config_all_zip")),c.pack)this._fileToUnzip.push(n);GameRootLayer.gameLayer().loadLayer.addEventListener(egret.Event.ENTER_FRAME,this.unzipStep,this)},c.allHeroConfig=function(e){return c.pack.t_hero},c.heroModelOffsetConfig=function(e){return c.pack.t_hero_model_offset[e]},c.heroExpConfig=function(){return c.pack.t_hero_exp},c.heroAndPetUpgradeConfig=function(e){return c.pack.t_hero_upgrade_costs},c.heroAndPetUpstarConfig=function(e){return c.pack.t_hero_upstar_costs},c.heroAndPetSectionConfig=function(e){return c.pack.t_hero_section},c.heroResonateConfig=function(e,t){if(e){var i=[];for(var n in c.pack.t_hero_resonate){var o=c.pack.t_hero_resonate[n];o.subType!=e||null!=t&&o.level!=t||i.push(o)}return i}return c.pack.t_hero_resonate},c.heroResonateLevelConfig=function(e,t){if(!e)return c.pack.t_hero_resonate_level;for(var i in c.pack.t_hero_resonate_level){var n=c.pack.t_hero_resonate_level[i];if(e===n.subType&&t===n.level)return n}},c.heroHaloConfig=function(){return c.pack.t_hero_halo},c.heroPracticeConfig=function(e,t){if(e){var i=[];for(var n in c.pack.t_hero_practice){var o=c.pack.t_hero_practice[n];o.subType!==e||void 0!==t&&o.level!==t||i.push(o)}return i}return c.pack.t_hero_practice},c.heroReplacementConfig=function(){return c.pack.t_replacement},c.allPetConfig=function(){return c.pack.t_pet},c.petUpgradeConfig=function(e){var t=[];for(var i in c.pack.t_pet_upgrade_costs){var n=c.pack.t_pet_upgrade_costs[i];t.push(n)}return t},c.petSectionConfig=function(e){var t=[];for(var i in c.pack.t_pet_section){var n=c.pack.t_pet_section[i];n.subType==e&&t.push(n)}return t},c.petSkillConfig=function(e,t){if(!e)return c.pack.t_pet_skill_costs;var i=[];for(var n in c.pack.t_pet_skill_costs){var o=c.pack.t_pet_skill_costs[n];o.subType==e&&o.skillCode==t&&i.push(o)}return i.sort(function(e,t){return e.level-t.level}),i},c.allMagicalConfig=function(){return c.pack.t_magical},c.magicalUpgradeConfig=function(e){var t=[];for(var i in c.pack.t_magical_upgrade_costs){var n=c.pack.t_magical_upgrade_costs[i];n.code==e&&t.push(n)}return t},c.magicalSectionConfig=function(e){var t=[];for(var i in c.pack.t_magical_upsection_costs){var n=c.pack.t_magical_upsection_costs[i];n.code==e&&t.push(n)}return t},c.getHeroEquipConfig=function(){return c.pack.t_hero_equip},c.getHeroEquipMasterConfig=function(e){var t=[];for(var i in c.pack.t_hero_equip_master){var n=c.pack.t_hero_equip_master[i];n.type==e&&t.push(n)}return t.sort(o.GeneralConfig.simpleSort("level")),t},c.getHeroEquipSuitConfig=function(e){var t=[];for(var i in c.pack.t_hero_equip_suit){var n=c.pack.t_hero_equip_suit[i];n.type==e&&t.push(n)}return t.sort(function(e,t){return e.num-t.num}),t},c.getHeroEquipUpgradeCostConfigByCode=function(e,t){var i=[];for(var n in c.pack.t_hero_equip_upgrade_costs){var o=c.pack.t_hero_equip_upgrade_costs[n];o.code!=e||o.level!=t&&t||i.push(o)}return i.sort(function(e,t){return e.level-t.level}),i},c.getHeroEquipUnlockLevel=function(e){for(var t in c.pack.t_hero_equip_unlock){var i=c.pack.t_hero_equip_unlock[t];if(i.type==e)return i.unlockLevel}return-1},c.getHeroEquipUpgradeConfig=function(e,t){if(null==t){var i=[];for(var n in c.pack.t_hero_equip_upgrade_costs){(o=c.pack.t_hero_equip_upgrade_costs[n]).code==e&&i.push(o)}return i.sort(function(e,t){return e.level-t.level}),i}for(var n in c.pack.t_hero_equip_upgrade_costs){var o;if((o=c.pack.t_hero_equip_upgrade_costs[n]).code==e&&o.level==t)return o}},c.getHeroEquipEnchantConfig=function(e,t){if(null==t){var i=[];for(var n in c.pack.t_hero_equip_enchant_costs){(o=c.pack.t_hero_equip_enchant_costs[n]).code==e&&i.push(o)}return i.sort(function(e,t){return e.level-t.level}),i}for(var n in c.pack.t_hero_equip_enchant_costs){var o;if((o=c.pack.t_hero_equip_enchant_costs[n]).code==e&&o.level==t)return o}},c.getHeroEquipQuenchceConfig=function(e,t){if(null==t){var i=[];for(var n in c.pack.t_hero_equip_quenchce_costs){(o=c.pack.t_hero_equip_quenchce_costs[n]).code==e&&i.push(o)}return i.sort(function(e,t){return e.level-t.level}),i}for(var n in c.pack.t_hero_equip_quenchce_costs){var o;if((o=c.pack.t_hero_equip_quenchce_costs[n]).code==e&&o.level==t)return o}},c.getHeroArtifactConfig=function(e){if(e){var t=[];for(var i in c.pack.t_hero_artifact){var n=c.pack.t_hero_artifact[i];n.subType==e&&t.push(n)}return t.sort(function(e,t){return e.sectionLevel-t.sectionLevel}),t}return c.pack.t_hero_artifact},c.getHeroArtifactBaptizeConfig=function(){return c.pack.t_hero_artifact_baptize},c.getCanShowHeroArtifactBaptizeColor=function(){if(!o.Config._canShowHeroArtifactBaptizeColor){o.Config._canShowHeroArtifactBaptizeColor=99999;var e=c.getHeroArtifactBaptizeConfig();for(var t in e){var i=e[t];o.Config._canShowHeroArtifactBaptizeColor=Math.min(o.Config._canShowHeroArtifactBaptizeColor,i.color)}}return o.Config._canShowHeroArtifactBaptizeColor},c.getHeroArtifactUnlockLevel=function(){var e=o.Config.unlockConfig(MODULE.HeroArtifact);return e?JSON.parse(e.condition)[1]:0},c.getHeroArtifactUpgradeConfig=function(e,t){if(e=c.getHeroArtifactConfig()[e].subType,null==t){var i=[];for(var n in c.pack.t_hero_artifact_upgrade_costs){(o=c.pack.t_hero_artifact_upgrade_costs[n]).code==e&&i.push(o)}return i.sort(function(e,t){return e.level-t.level}),i}for(var n in c.pack.t_hero_artifact_upgrade_costs){var o;if((o=c.pack.t_hero_artifact_upgrade_costs[n]).code==e&&o.level==t)return o}},c.getHeroArtifactUpstarConfig=function(e,t){if(null==t){var i=[];for(var n in c.pack.t_hero_artifact_upstar_costs){(o=c.pack.t_hero_artifact_upstar_costs[n]).code==e&&i.push(o)}return i.sort(function(e,t){return e.level-t.level}),i}for(var n in c.pack.t_hero_artifact_upstar_costs){var o;if((o=c.pack.t_hero_artifact_upstar_costs[n]).code==e&&o.level==t)return o}},c.getHeroArtifactUpSectionConfig=function(){return c.pack.t_hero_artifact_upsection_costs},c.heroArtifactResonate=function(e){if(e){var t={};for(var i in c.pack.t_hero_artifact_resonate){var n=c.pack.t_hero_artifact_resonate[i];n.subType==e&&(t[i]=n)}return t}return c.pack.t_hero_artifact_resonate},c.heroArtifactCompound=function(){return c.pack.t_hero_artifact_compound},c.heroArtifactRollbackConfig=function(e,t){if(null==e||null==t)return c.pack.t_hero_artifact_rollback;for(var i in c.pack.t_hero_artifact_rollback){var n=c.pack.t_hero_artifact_rollback[i];if(n.color==e&&n.section==t)return n}},c.getRiskMapByCode=function(e){return c.pack.t_risk_map[e]},c.getRiskMapItemsByCode=function(e){return c.pack.t_risk_map_items[e]},c.getHeroTreasureConfig=function(){return c.pack.t_treasure},c.getHeroDermaConfig=function(e){return e?c.pack.t_hero_derma[e]:c.pack.t_hero_derma},c.getHeroDermaHandbookConfig=function(){return c.pack.t_hero_derma_handbook},c.getHeroDermaUpCostsConfig=function(e){var t=[];for(var i in c.pack.t_hero_derma_upgrade_costs)c.pack.t_hero_derma_upgrade_costs[i].code==e&&t.push(c.pack.t_hero_derma_upgrade_costs[i]);return t},c.heroDermaActivateConfig=function(e){var t=[];for(var i in c.pack.t_hero_derma){var n=c.pack.t_hero_derma[i];n.code==e&&t.push(n)}return t},c.getHeroTreasureUnlockLevel=function(){var e=JSON.parse(c.pack.t_unlock[MODULE.Treasure].condition)[1],t=c.pack.t_treasure[0].putOnLevel;return t<e?e:t},c.getTreasureLockInfo=function(e,t){var i=c.pack.t_treasure_jewel_unlock[e];if(i)return t>=i.unlockLevel?void 0:i.unlockLevel},c.getTreasureJewelUpgradeConfig=function(t){var i=[];return c.pack.t_treasure_jewel_upgrade.forEach(function(e){e.type==t&&i.push(e)}),i.sort(function(e,t){return e.level-t.level}),i},c.getTreasureResonate=function(e){return c.pack.t_treasure_jewel_resonate[e]},c.gashaponEntry=function(){return c.pack.t_gashapon_entry},c.gashaponItems=function(){return c.pack.t_gashapon_items},c.gashaponTimes=function(){return c.pack.t_gashapon_times},c.skillBaseConfig=function(){return c.pack.t_skill_base},c.skillEffectConfig=function(){return c.pack.t_skill_effect},c.champion=function(){return c.pack.t_champion},c.championMaxLayer=function(){return c.custom.championMaxLayer||(c.custom.championMaxLayer=Object.keys(c.pack.t_champion).length),c.custom.championMaxLayer},c.championAchievement=function(){return c.pack.t_champion_achievement},c.dailyFortress=function(){return c.pack.t_daily_fortress},c.dailyFortressStage=function(){return c.pack.t_daily_stage},c.expedition=function(){return c.pack.t_expedition},c.expeditionAchievement=function(){return c.pack.t_expedition_achievement},c.teamExpedition=function(){return c.pack.t_team_expedition},c.getTeamExpeditionDetailByChapter=function(e){e=Number(e);var t=[];for(var i in c.pack.t_team_expedition){var n=c.pack.t_team_expedition[i];n.chapterId==e&&t.push(n)}return t.sort(function(e,t){return e.id-t.id}),t},c.teamExpeditionChatper=function(){return c.pack.t_team_chapter},c.teamRewardConfig=function(){return c.pack.t_team_rewards},c.worldKingLevelConfig=function(){return c.pack.t_world_king_levels},c.worldKingRewardConfig=function(e){if(e){var t={},i=1;for(var n in c.pack.t_world_king_rewards){var o=c.pack.t_world_king_rewards[n];o.type==e&&(t[i++]=o)}return t}return c.pack.t_world_king_rewards},c.serverBoss=function(){return c.pack.t_server_boss},c.serverBossReward=function(e){if(e){var t=[];for(var i in c.pack.t_server_boss_reward){var n=c.pack.t_server_boss_reward[i];if(n.type==e){var o=JSON.parse(n.key);t.push({id:n.id,type:n.type,rankUpper:o[0],rankLower:o[1],rewards:n.rewards})}}return t}return c.pack.t_server_boss_reward},c.heroSpriteAchievementReward=function(){return c.pack.t_hero_spirit_achievement},c.getHeroChallengeBoss=function(){return c.pack.t_challenge_boss},c.getHeroChallengeMap=function(){return c.pack.t_challenge_map},c.getHeroChallengeEvent=function(e){if(!e)return c.pack.t_challenge_event;var t=c.pack.t_challenge_event;for(var i in t){var n=t[i];if(n.code==e)return n}},c.questionConfig=function(){return c.pack.t_question},c.storyConfig=function(){return c.pack.t_story},c.storySubConfig=function(){return c.pack.t_story_sub},c.touchGoldHandRewards=function(){return c.pack.t_touchGoldHand_rewards},c.tribeBattleRewards=function(){return c.pack.t_tribeBattle_achieveRewards},c.heroChallengeStage=function(e){if(!e)return c.pack.t_hero_challenge_stage;for(var t in c.pack.t_hero_challenge_stage){var i=c.pack.t_hero_challenge_stage[t];if(i.code==e)return i}},c.heroChallengeCreep=function(){return c.pack.t_hero_challenge_creep},c.heroChallengeBuff=function(){return c.pack.t_hero_challenge_buff},c.heroRollBackConfig=function(){return c.pack.t_hero_rollback},c.operationConfig=function(){return c.pack.t_operation},c.luckyTablePoolConfig=function(){return c.pack.t_lucky_turntable_pool},c.luckyTableConfig=function(){return c.pack.t_lucky_turntable},c.deepNestConfig=function(e){var t=[];for(var i in c.pack.t_abyssLair)if(c.pack.t_abyssLair[i].chapter==e&&(t.push(c.pack.t_abyssLair[i]),5==t.length))break;return t.sort(function(e,t){return e.code-t.code}),t},c.deepNestRewardConfig=function(e){var t=[];for(var i in c.pack.t_abyssLair_box)if(c.pack.t_abyssLair_box[i].chapter==e&&(t.push(c.pack.t_abyssLair_box[i]),3==t.length))break;return t.sort(function(e,t){return e.star-t.star}),t},c.deepNestWayConfig=function(e){return c.pack.t_abyssLair_chapter[e]},c.giftConfig=function(){return c.pack.t_gift},c.vestageItemConfig=function(){return c.pack.t_vestage_item},c.vestageMapConfig=function(){return c.pack.t_vestage_map},c.vestageEventConfig=function(){return c.pack.t_vestage_event},c.vestageResultConfig=function(){return c.pack.t_vestage_result},c.vestageQuestionConfig=function(){return c.pack.t_vestage_question},c.vestageEventDescConfig=function(){return c.pack.t_vestage_event_desc},c.vestageEventDescConfigByCreep=function(){var e=[];for(var t in c.pack.t_vestage_event_desc)c.pack.t_vestage_event_desc[t].eventType==VestageEventType.Creep&&e.push(c.pack.t_vestage_event_desc[t]);return e},c.fashionConfig=function(){return c.pack.t_fashion},c.fashionConfigList=function(){var e=[];for(var t in c.pack.t_fashion)e.push(c.pack.t_fashion[t]);return e},c.fashionBookConfig=function(){return c.pack.t_fashion_handbook},c.fashionUpConfigByCode=function(e){var t=[];for(var i in c.pack.t_fashion_upgrade_costs)c.pack.t_fashion_upgrade_costs[i].code==e&&t.push(c.pack.t_fashion_upgrade_costs[i]);return t},c.fashionMasterConfig=function(){return c.pack.t_fashion_master},c.titleConfig=function(){return c.pack.t_title},c.entranceTimeConfig=function(){return c.pack.t_entrance_time},c.heroSpiritConfigByChapterId=function(e){var t=[];for(var i in c.pack.t_hero_spirit)c.pack.t_hero_spirit[i].chapterId==e&&t.push(c.pack.t_hero_spirit[i]);return t},c.heroSpiritConfigByCode=function(e){for(var t in c.pack.t_hero_spirit)if(c.pack.t_hero_spirit[t].code==e)return c.pack.t_hero_spirit[t]},c.heroSpiritConfigByFirst=function(e){for(var t in c.pack.t_hero_spirit)if(c.pack.t_hero_spirit[t].chapterId==e&&1==c.pack.t_hero_spirit[t].firstCode)return c.pack.t_hero_spirit[t]},c.heroSpiritConfig=function(e){var t=[];for(var i in c.pack.t_hero_spirit)c.pack.t_hero_spirit[i].chapterId==e&&t.push(c.pack.t_hero_spirit[i]);return t},c.heroSpiritChapterConfig=function(){var e=[];for(var t in c.pack.t_hero_spirit_chapter)e.push(c.pack.t_hero_spirit_chapter[t]);return e},c.heroSpiritUpstarConfig=function(e){var t=[];for(var i in c.pack.t_hero_spirit_upstar_costs)c.pack.t_hero_spirit_upstar_costs[i].code==e&&t.push(c.pack.t_hero_spirit_upstar_costs[i]);return t},c.peakWarBaseConfig=function(){return c.pack.t_peakWar_base},c.peakWarFreeReward=function(){return c.pack.t_peakWar_daily_rewards},c.peakWarHighReward=function(){return c.pack.t_peakWar_highLadder_achieve},c.roleSkillTree=function(){var e=[];for(var t in c.pack.t_role_skill_tree)e.push(c.pack.t_role_skill_tree[t]);return e},c.roleSkill=function(){var e=[];for(var t in c.pack.t_role_skill)e.push(c.pack.t_role_skill[t]);return e},c.roleSkillById=function(e){var t=[];for(var i in c.pack.t_role_skill)e==c.pack.t_role_skill[i].treeId&&t.push(c.pack.t_role_skill[i]);return t},c.roleSkillByCode=function(){return c.pack.t_role_skill},c.roleSkillUpByCode=function(e){var t=[];for(var i in c.pack.t_role_skill_upgrade_costs)e==c.pack.t_role_skill_upgrade_costs[i].code&&t.push(c.pack.t_role_skill_upgrade_costs[i]);return t},c.getSecAchievementConfig=function(){return c.pack.t_secondAchievement_task},c.getSecAchievementLevelConfig=function(){return c.pack.t_secondAchievement_level},c.horseConfig=function(){var e=[];for(var t in c.pack.t_horse)e.push(c.pack.t_horse[t]);return e},c.horseConfigList=function(){return c.pack.t_horse},c.horseBookConfig=function(){return c.pack.t_horse_handbook},c.horseGradeConfigByCode=function(e){var t=[];for(var i in c.pack.t_horse_upgrade_costs)e==c.pack.t_horse_upgrade_costs[i].code&&t.push(c.pack.t_horse_upgrade_costs[i]);return t},c.horseStarConfigByCode=function(e){var t=[];for(var i in c.pack.t_horse_upstar_costs)e==c.pack.t_horse_upstar_costs[i].code&&t.push(c.pack.t_horse_upstar_costs[i]);return t},c.custom={championMaxLayer:void 0},c.pack={t_error_code:void 0,t_const:void 0,t_mail:void 0,t_operation:void 0,t_property_color:void 0,t_public_buy_cost:void 0,t_unlock:void 0,t_module_open:void 0,t_vip:void 0,t_vip_upgrade:void 0,t_way:void 0,t_main_way:void 0,t_target_rewards:void 0,t_random_reward:void 0,t_attribute_restraint:void 0,t_attribute_desc:void 0,t_player_level_upgrade:void 0,t_player_change_avatar:void 0,t_guide_flow:void 0,t_guide_step:void 0,t_guide_hero_show:void 0,t_risk:void 0,t_risk_fortress:void 0,t_risk_layer:void 0,t_risk_layer_theme:void 0,t_risk_maze:void 0,t_risk_mine:void 0,t_risk_creep:void 0,t_risk_quora:void 0,t_risk_event:void 0,t_risk_event_desc:void 0,t_risk_unicursal:void 0,t_risk_task:void 0,t_demon:void 0,t_demon_creep:void 0,t_creep:void 0,t_item:void 0,t_shop:void 0,t_shop_game:void 0,t_shop_work:void 0,t_refresh_shop:void 0,t_task:void 0,t_braveBook_task:void 0,t_progressBar_node:void 0,t_ranking_reward:void 0,t_dailyTaskExp:void 0,t_secondAchievement_level:void 0,t_secondAchievement_task:void 0,t_rand_name_list:void 0,t_perfix_name_list:void 0,t_next_name_list:void 0,t_activity_img:void 0,t_relation_reward:void 0,t_magpie_talk:void 0,t_magpie_event:void 0,t_magpie_achieve:void 0,t_broadcast:void 0,t_broadcast_link:void 0,t_broadcast_sentences:void 0,t_lucky_money:void 0,t_devote:void 0,t_guild_level_upgrade:void 0,t_guild_skill:void 0,t_guild_collect:void 0,t_guild_boss:void 0,t_guild_skill_reset:void 0,t_guild_transcript:void 0,t_guild_transcript_ranking:void 0,t_zone_boss_boss:void 0,t_zone_boss_task:void 0,g_help:void 0,g_skill:void 0,t_buff_res:void 0,t_recharge_level:void 0,t_res_change:void 0,t_chess_hero:void 0,t_chess_level:void 0,t_chess_exp_shop:void 0,t_chess_star_level:void 0,t_chess_recommend:void 0,t_chess_card_pool_grasp:void 0,t_chess_achieve_level:void 0,t_chess_achieve_task:void 0,t_manor_layer:void 0,t_manor:void 0,t_storm_war_layer:void 0,t_storm_war_double_hit:void 0,t_storm_war_creep:void 0,t_storm_war_rewards:void 0,t_abyssLair:void 0,t_abyssLair_box:void 0,t_abyssLair_chapter:void 0,t_hero_spirit:void 0,t_hero_spirit_chapter:void 0,t_hero_spirit_upstar_costs:void 0,t_hero_spirit_achievement:void 0,t_hero:void 0,t_hero_model_offset:void 0,t_hero_exp:void 0,t_hero_upstar_costs:void 0,t_hero_upgrade_costs:void 0,t_hero_section:void 0,t_hero_resonate:void 0,t_hero_resonate_level:void 0,t_replacement:void 0,t_hero_halo:void 0,t_hero_practice:void 0,t_pet:void 0,t_pet_upgrade_costs:void 0,t_pet_section:void 0,t_pet_skill_costs:void 0,t_pet_master:void 0,t_magical:void 0,t_magical_upgrade_costs:void 0,t_magical_upsection_costs:void 0,t_magical_master:void 0,t_hero_equip:void 0,t_hero_equip_unlock:void 0,t_hero_equip_upgrade_costs:void 0,t_hero_equip_enchant_costs:void 0,t_hero_equip_suit:void 0,t_hero_equip_compound:void 0,t_hero_equip_quenchce_costs:void 0,t_hero_equip_master:void 0,t_hero_artifact:void 0,t_hero_artifact_level_exp:void 0,t_hero_artifact_upstar_costs:void 0,t_hero_artifact_upgrade_costs:void 0,t_hero_artifact_upsection_costs:void 0,t_hero_artifact_rollback:void 0,t_hero_artifact_baptize:void 0,t_hero_artifact_compound:void 0,t_hero_artifact_resonate:void 0,t_treasure:void 0,t_treasure_jewel_unlock:void 0,t_treasure_jewel_upgrade:void 0,t_treasure_jewel_resonate:void 0,t_hero_derma:void 0,t_hero_derma_handbook:void 0,t_hero_derma_upgrade_costs:void 0,t_risk_map:void 0,t_risk_map_items:void 0,t_gashapon_entry:void 0,t_gashapon_items:void 0,t_gashapon_times:void 0,t_skill_base:void 0,t_skill_effect:void 0,t_champion:void 0,t_champion_achievement:void 0,t_daily_fortress:void 0,t_daily_stage:void 0,t_expedition:void 0,t_expedition_achievement:void 0,t_team_expedition:void 0,t_team_chapter:void 0,t_team_rewards:void 0,t_world_king_levels:void 0,t_world_king_rewards:void 0,t_server_boss:void 0,t_server_boss_reward:void 0,t_challenge_boss:void 0,t_challenge_map:void 0,t_challenge_event:void 0,t_question:void 0,t_story:void 0,t_story_sub:void 0,t_touchGoldHand_rewards:void 0,t_how_to_strong:void 0,t_arena_hRankReward:void 0,t_braveBook_level:void 0,t_braveBook_starReward:void 0,t_newBraveBook_task:void 0,t_newBraveBook_level:void 0,t_newBraveBook_starReward:void 0,t_hero_challenge_stage:void 0,t_hero_challenge_creep:void 0,t_hero_challenge_buff:void 0,t_hero_rollback:void 0,t_lucky_turntable_pool:void 0,t_lucky_turntable:void 0,t_gift:void 0,t_vestage_item:void 0,t_vestage_map:void 0,t_vestage_event:void 0,t_vestage_result:void 0,t_vestage_question:void 0,t_vestage_event_desc:void 0,t_fashion:void 0,t_fashion_handbook:void 0,t_fashion_upgrade_costs:void 0,t_fashion_master:void 0,t_title:void 0,t_role_skill:void 0,t_role_skill_tree:void 0,t_role_skill_upgrade_costs:void 0,t_entrance_time:void 0,t_tribeBattle_achieveRewards:void 0,t_peakWar_base:void 0,t_peakWar_daily_rewards:void 0,t_peakWar_highLadder_achieve:void 0,t_horse:void 0,t_horse_handbook:void 0,t_horse_upgrade_costs:void 0,t_horse_upstar_costs:void 0,t_quora:void 0,t_zone_quora:void 0},c._fileToUnzip=[],c.unzipFinish=!1,c._canShowHeroArtifactBaptizeColor=void 0,c}();o.Config=e,__reflect(e.prototype,"game.Config")}(game||(game={}));var FrameUpdateItem=function(){};__reflect(FrameUpdateItem.prototype,"FrameUpdateItem");var FrameUpdateMgr=function(t){function e(){var e=t.call(this)||this;return e.hasInit=!1,e.frameUpateQueue=new Array,e}return __extends(e,t),e.prototype.frameUpdate=function(e){if(0!=this.frameUpateQueue.length){this.frameUpateQueue=this.frameUpateQueue.filter(function(e){return 0<e.waitFrame});for(var t=0,i=this.frameUpateQueue;t<i.length;t++){var n=i[t];n.waitFrame--,n.waitFrame<=0&&n.cb(n.params)}}},e.prototype.insert=function(e){e.cb&&(null==e.delayFrame&&(e.delayFrame=1),e.waitFrame=e.delayFrame,this.frameUpateQueue.push(e),this.hasInit||(this.hasInit=!0,GameRootLayer.gameLayer().addEventListener(egret.Event.ENTER_FRAME,this.frameUpdate,this)))},e}(BaseClass);__reflect(FrameUpdateMgr.prototype,"FrameUpdateMgr"),function(n){var e=function(i){function e(){var e=i.call(this)||this;return e.timeDvalue=0,e.timeZoneOffset=0,e.totalTime=0,e.pingScheTime=10,e.curDay=void 0,window.showCommonTipsWin=e.showCommonTipsWin,e}return __extends(e,i),e.getInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.getInstance.apply(this,e)},e.prototype.connectLoginSev=function(t,i){egret.log("connectLoginSev"),egret.log(t),egret.log(i);var e=0;Utils.Socket.isConnecting()&&(Utils.Socket.close(),e=200),egret.setTimeout(function(){var e="ws://";Utils.agentConfig.isHttps&&(e="wss://"),Utils.agentConfig.jsPb?Utils.Socket.initServer(t,i,"/ws",e,new ByteArrayMsgByJSProtobuf):Utils.Socket.initServer(t,i,"/ws",e,new ByteArrayMsgByProtobuf),Utils.Socket.connect()},this,e)},e.prototype.connectGameSev=function(t){egret.log("connectGameSev"),egret.log(t);var e=0;Utils.Socket.isConnecting()&&(Utils.Socket.close(),e=200),egret.setTimeout(function(){var e="ws://";Utils.agentConfig.isHttps&&(e="wss://"),Utils.agentConfig.jsPb?Utils.Socket.initServer(t,"","/ws",e,new ByteArrayMsgByJSProtobuf):Utils.Socket.initServer(t,"","/ws",e,new ByteArrayMsgByProtobuf),Utils.Socket.connect()},this,e)},e.prototype.updateTimeDValue=function(e){var t=new Date,i=Math.ceil(t.getTime()/1e3);this.timeDvalue=e-i;var n=t.getTimezoneOffset();this.timeZoneOffset=-480!=n?60*(480+n):0,this.pingSche||this.startPingSche(),this.checkPassDay()},e.prototype.checkPassDay=function(){var e=new Date(1e3*this.serverTime());void 0===this.curDay?this.curDay=e.getHours():this.curDay!=e.getHours()&&(egret.log("触发跨天检查"),egret.log("this.curDay ",this.curDay),egret.log("data.getHours() ",e.getHours()),this.curDay=e.getHours(),Utils.TimerManager.checkEntranceTime())},e.prototype.stopPingSche=function(){this.pingSche&&(egret.clearInterval(this.pingSche),this.pingSche=void 0),this.pingTimeOutSche&&(egret.clearInterval(this.pingTimeOutSche),this.pingTimeOutSche=void 0)},e.prototype.pingTimeoutFunc=function(){Utils.Socket.intervalUpdate(1e3),NoticeManager.intervalUpdate(1e3),Utils.TimerManager.checkEntranceTime()},e.prototype.startPingSche=function(){var t=this;this.pingSche||(this.pingSche=egret.setInterval(function(){Utils.Socket.send("loginGame","Ping",{}).then(function(e){t.updateTimeDValue(e.sysDt)}).catch(function(){}),t.totalTime+=15e3,n.AppFacade.getInstance().sendNotification(CN.GAME_HEARTBEAT,{totalTime:t.totalTime})},this,15e3)),this.pingTimeOutSche||(Utils.TimerManager.updateEntranceTimeList(),this.pingTimeOutSche=egret.setInterval(this.pingTimeoutFunc,this,1e3))},e.prototype.restart=function(){Utils.SDKMgr.restart()},e.prototype.GetServerInfo=function(){Utils.Socket.send("loginGame","GetServerInfo",{}).then(function(e){n.GameMVC.loginPy.loginGameVO.updateInGame(e)})},e.prototype.switchNetChecking=function(e){this.netCheckingPanel&&this.netCheckingPanel.isForceStop||(e?this.netCheckingPanel?(this.netCheckingPanel.visible=!0,this.netCheckingPanel.onResume()):(this.netCheckingPanel=new n.NetCheckingPanel,GameRootLayer.gameLayer().maskLayer.addChild(this.netCheckingPanel)):this.netCheckingPanel&&(this.netCheckingPanel.onPause(),this.netCheckingPanel.visible=!1))},e.prototype.serverTime=function(e){void 0===e&&(e=!0);var t=Math.ceil(Date.now()/1e3);return e?t+this.timeDvalue:t+this.timeDvalue+this.timeZoneOffset},e.prototype.getOnLineTime=function(){var e=n.AppFacade.getInstance().retrieveProxy(n.LoginPy.N).loginGameVO.sysDt;return this.serverTime()-e},e.prototype.showCommonTipsWin=function(e){n.AppFacade.getInstance().showSubView(n.CommonMediator.N,n.CommonMediator.SV.TIPS_DIALOG,e)},e.prototype.showActionBuyCostWin=function(e){PopUpManager.addPopUp({obj:new n.CommonActionBuyTipsDialog(e)})},e.prototype.CommonGpAddReward=function(i,n,o){if(void 0===o&&(o=.8),i&&n)if("string"==typeof n)n=JSON.parse(n),this.CommonGpAddReward(i,n,o);else if(Array.isArray(n))n.forEach(function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=o,Array.isArray(e)?t.updateData({reward:e}):t.updateData(e),i.addChild(t)});else{var a=[],e=function(t){var e=n[t];Array.isArray(e)&&e.forEach(function(e){switch(t){case"rewards":a.push(e);break;case"heros":a.push({uuid:e.uuid,type:EEntityType.EEntityTypeHero});break;case"vestageHeros":a.push({uuid:e.uuid,type:EEntityType.EEntityTypeVestageHero});break;case"heroEquips":a.push({code:e.code,type:EEntityType.EEntityTypeHeroEquip,num:e.num});break;case"heroArtifacts":a.push({code:e.code,type:EEntityType.EEntityTypeHeroArtifact,num:e.num});break;case"maps":a.push({uuid:e.uuid,type:EEntityType.EEntityTypeMap})}})};for(var t in n)e(t);this.CommonGpAddReward(i,a,o)}},e.prototype.resetPerformance=function(){dragonBones.EgretFactory.skipFrame=0,Utils.LocalStorageUtil.removeItem("SETTING_PERFORMANCE_MODEL_SKIP_FRAME",!0),GameRootLayer.gameLayer().stage.frameRate=Utils.MathUtils.isNumber(Utils.SDKMgr.getPerformConfig(11))?Number(Utils.SDKMgr.getPerformConfig(11)):30,Utils.LocalStorageUtil.removeItem("SETTING_PERFORMANCE_FPS",!0)},e.prototype.loadPerformance=function(){var e=Utils.LocalStorageUtil.getItem("SETTING_PERFORMANCE_MODEL_SKIP_FRAME",!0);Number(e)&&(dragonBones.EgretFactory.skipFrame=Number(e));var t=Utils.LocalStorageUtil.getItem("SETTING_PERFORMANCE_FPS",!0);Number(t)&&(GameRootLayer.gameLayer().stage.frameRate=Number(t))},e}(BaseClass);n.GameMgr=e,__reflect(e.prototype,"game.GameMgr")}(game||(game={})),function(s){var e=function(){function r(){}return r.getFrameByColor=function(e){return COLOR_2_FRAME[e]},r.getColorByColor=function(e){return COLOR_2_FONT_COLOR[e]},r.getNameByColor=function(e){switch(e){case EColorType.EColorTypeWhite:return"白色";case EColorType.EColorTypeGreen:return"绿色";case EColorType.EColorTypeBlue:return"蓝色";case EColorType.EColorTypePurple:return"紫色";case EColorType.EColorTypeOrange:return"橙色";case EColorType.EColorTypeRed:return"红色";default:return e.toString()}},r.getAttrName=function(e){return 2e3<e&&(e%=2e3),AttrConfig[e]&&AttrConfig[e].name||"key error"},r.getAttrIcon=function(e){return 2e3<e&&(e%=2e3),AttrConfig[e]&&AttrConfig[e].icon||""},r.getAttrValueWithData=function(e,t,i){if(void 0===t&&(t=1),void 0===i&&(i=0),e<=0)return[0,0];if(1e5<=e){var n=0,o=Math.floor(e%1e5);return n=o<=5e4?o/1e3:-(o-5e4)/1e3,[Math.floor(e/1e5)*(n+1)*t+i,0]}if(e<=5e4){var a=e*t/10+i;return[a=Math.floor(100*a)/100,1]}return[-(e-5e4)*t/10+i,1]},r.getAttrValue=function(e,t,i,n){if(void 0===t&&(t=1),void 0===i&&(i=0),void 0===n&&(n=!1),!e||e<=0)return"0";if(1e5<=e){var o=0,a=Math.floor(e%1e5);return o=a<=5e4?a/1e3:-(a-5e4)/1e3,n?(Math.floor(e/1e5)/10+i).toString():(Math.floor(e/1e5)/10*(o+1)*t+i).toString()}return e<=5e4?(e*t/10+i).toString()+"%":"-"+((e-5e4)*t/10+i).toString()+"%"},r.getImageByTypeCode=function(e,t){for(var i=0,n=s.Config.propertyConfig();i<n.length;i++){var o=n[i];if(o.type==e&&o.code==t)return o.icon+"_png"}return egret.log("Invalid type and code."),null},r.getHeroStarInfo=function(e,t){void 0===t&&(t=!0);var i={src:"",num:0,stage:0};return t?e<6?(i.src="_border_m_json.common_icon_xingji",i.stage=1,i.num=e):e<10?(i.src="_border_m_json.common_icon_xingji2",i.stage=2,i.num=e-5):e<11?(i.src="_border_m_json.common_icon_xingji3",i.stage=3,i.num=e-9):(i.src="_border_m_json.common_icon_xingji4",i.stage=4,i.num=e-10):(i.stage=Math.ceil(e/5),i.num=(e-1)%5+1,i.src="_border_m_json.common_icon_xingji"+(1==i.stage?"":i.stage.toString())),i},r.getEntityConfigByCode=function(e,t){if(t){null==e&&(e=Math.floor(Number(t)/1e7)),e||(e=EEntityType.EEntityTypeMoney);var i=void 0;if(Number(t))switch(e){case EEntityType.EEntityTypeItem:i=s.Config.itemConfig()[t];break;case EEntityType.EEntityTypeVestageItem:i=s.Config.vestageItemConfig()[t];break;case EEntityType.EEntityTypeVestageHero:case EEntityType.EEntityTypeHero:i=s.Config.allHeroConfig()[t];break;case EEntityType.EEntityTypeHeroEquip:i=s.Config.getHeroEquipConfig()[t];break;case EEntityType.EEntityTypeTreasure:i=s.Config.getHeroTreasureConfig()[t];break;case EEntityType.EEntityTypeHeroArtifact:i=s.Config.getHeroArtifactConfig()[t];break;case EEntityType.EEntityTypeMap:i=s.Config.getRiskMapByCode(t);break;case EEntityType.EEntityTypeExp:case EEntityType.EEntityTypeMoney:for(var n=0,o=s.Config.propertyConfig();n<o.length;n++){var a=o[n];if(a.type===e&&a.code===t)return a}return egret.log("error 配置不存在 t_property_color",t),{color:6,icon:"role_img_buzhengwenhao",name:" 配置不存在 t_property_color code:"+t,shortDesc:"",desc:""};default:return egret.log("error 配置不存在 t_property_color",t),{color:6,icon:"role_img_buzhengwenhao",name:" 配置不存在 t_property_color code:"+t,shortDesc:"",desc:""}}return i}},r.ObjAttr2Arr=function(e){"string"==typeof e&&(e=JSON.parse(e));var t=[];for(var i in e){var n=e[i];t.push([i,n])}return t},r.ArrAttr2Obj=function(e){var t={};for(var i in e){var n=e[i];t[n[0]]=n[1]}return t},r.superAttrAddAttr=function(e,t){return function(e,t){var i=[],n=[];for(var o in e)0==(a=r.getAttrValueWithData(e[o][1]))[1]?a[0]=1e5*Math.floor(a[0]):a[0]=e[o][1],i.push([e[o][0],a[0]]);for(var o in t){var a;0==(a=r.getAttrValueWithData(t[o][1]))[1]?a[0]=1e5*Math.floor(a[0]):a[0]=t[o][1],n.push([t[o][0],a[0]])}return r.AttrAddAttr(i,n)}(e,t)},r.AttrAddAttr=function(e,t){var i={};for(var n in e){i[(a=e[n])[0]]=parseInt(a[1])}for(var n in t){i[(a=t[n])[0]]?i[a[0]]+=parseInt(a[1]):i[a[0]]=parseInt(a[1])}var o=[];for(var n in i){var a=i[n];o.push([parseInt(n),a])}return o},r.AttrMutilAttr=function(e,o){var a=[];return"number"==typeof o?e.forEach(function(e,t){1e5<=e[1]?a.push([e[0],1e5*Math.floor(e[1]*o/1e5)]):a.push([e[0],Math.floor(e[1]*o)])}):"object"==typeof o&&e.forEach(function(i){var n=!1;o.forEach(function(e,t){i[0]==e[0]&&(a.push([i[0],Math.floor(i[1]*(e[1]/1e3+1))]),n=!0)}),n||a.push(i)}),a},r.getHeroJingyingTag=function(e){var t=void 0;if(e instanceof s.HeroVO)0==e.config.tier?t=0:e.config.tier<3?t=1:e.config.tier<5&&(t=2);else{var i=s.Config.allHeroConfig()[e].tier;0==i?t=0:i<3?t=1:i<5&&(t=2)}if(null!=t&&HERO_TIER_IMG_TAG[t])return HERO_TIER_IMG_TAG[t]},r.getGuajiImg=function(e){if(r.guajiImgConfig[e])return r.guajiImgConfig[e];try{var t="";RES.hasRes(e+"_png")&&(t=e+"_png"),!t&&RES.hasRes("_event_m_json."+e)&&(t="_event_m_json."+e);for(var i=1;i<=6&&!t;i++)RES.hasRes("_dk_0"+i+"_m_json."+e)&&(t="_dk_0"+i+"_m_json."+e);return!t&&RES.hasRes("_guaji_m_json."+e)&&(t="_guaji_m_json."+e),!t&&RES.hasRes("_main_m_json."+e)&&(t="_main_m_json."+e),t?(r.guajiImgConfig[e]=[1,t],[1,t]):(r.guajiImgConfig[t=e]=[2,t],[2,t])}catch(e){console.log(e)}},r.numToChinesNum=function(e){for(var t=["零","一","二","三","四","五","六","七","八","九"],i=["","十","百","千"],n="",o="",a=0,r=!0,s=e;0<e;){var c=e%10;0==c?r||(r=!0,o=t[c]+o):(r=!1,n=t[c],o=(n+=i[a])+o),a++,e=Math.floor(e/10)}return 9<s&&s<20&&(o=o.replace("一","")),o},r.simpleSort=function(){for(var o=[],e=0;e<arguments.length;e++)o[e]=arguments[e];return function(e,t){for(var i=o.length,n=0;n<i;n++)if(e[o[n]]!=t[o[n]])return e[o[n]]-t[o[n]];return 0}},r.showItemDetail=function(e){var t=e[0],i=e[1],n=r.getEntityConfigByCode(t,i);switch(t){case EEntityType.EEntityTypeHero:s.AppFacade.getInstance().showSubView(s.HeroMediator.N,s.HeroMediator.SV.HERO_DETAIL,{code:i});break;default:if(t==EEntityType.EEntityTypeHeroEquip||t==EEntityType.EEntityTypeHeroArtifact||t==EEntityType.EEntityTypeTreasure){var o=void 0;switch(t){case EEntityType.EEntityTypeHeroEquip:var a=s.Config.getHeroEquipUpgradeConfig(i);s.Config.getHeroEquipEnchantConfig(i);o={code:i,entityType:t,exp:0,fightCap:0,level:0,level2:0};break;case EEntityType.EEntityTypeHeroArtifact:a=s.Config.getHeroArtifactUpgradeConfig(i),s.Config.getHeroArtifactUpstarConfig(i);o={code:i,entityType:t,exp:0,fightCap:0,level:0,level2:0};break;case EEntityType.EEntityTypeTreasure:(a=s.Config.getTreasureJewelUpgradeConfig(TreasureJewelType.Atk))&&a.length&&a[a.length-1].level}s.AppFacade.getInstance().showSubView(s.HeroThingMediator.N,s.HeroThingMediator.SV.MAIN,{entityType:t,vo:o,config:n,source:s.HeroThingMainView.VIEW_SOURCE.HANDBOOK})}else PopUpManager.addPopUp({obj:new s.BaseItemDetailView({code:i,type:t,config:n})})}},r.fixedSizeWH=50,r.guajiImgConfig={},r}();s.GeneralConfig=e,__reflect(e.prototype,"game.GeneralConfig")}(game||(game={}));var NoticeManager,MicMgr=function(t){function n(){var e=t.call(this)||this;return e.init(),egret.ExternalInterface.addCallback("callJS",e.callJS),e}return __extends(n,t),n.prototype.init=function(){this.getChannelName()},n.prototype.callJS=function(e){if(egret.log("MicMgr",e),e){var t=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N);game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N);try{var i=JSON.parse(e);switch(i.method){case"loginCB":if("FromSwitch"==i.type&&500<=game.GameMVC.playerPy.loginStatusVO.state)return void this.restart();i.login_ext&&(t.userVO.login_ext=i.login_ext),Utils.isNeedUuidSot?t.userVO.uuid=i.game_uin+"_uuidsot"+Utils.TimerManager.getServerTime():t.userVO.uuid=i.game_uin,i.username?t.userVO.username=Utils.Http.checkStrLegal(i.username,!1,""):t.userVO.username=t.userVO.uuid,t.userVO.verify_token=i.verify_token,t.userVO.login_ext&&t.userVO.login_ext.isCheckingRecharge&&(Utils.agentConfig.isChecking.Recharge=t.userVO.login_ext.isCheckingRecharge),n._platform_nodeTable={action:"record_login_info",platform:Utils.agentConfig.AgentCode,sub_platform:"",username:t.userVO.uuid,os_code:Utils.DeviceUtils.getPlatform(),user_agent:window.navigator.userAgent,browser_id:Utils.DeviceUtils.getBrowser()},t.goHttpLogin();break;case"buyCB":0===i.payResult?Utils.MsgUtils.addMidMsg("购买成功，请稍后查收邮件"):i.payResultMsg&&""!=i.payResultMsg&&Utils.MsgUtils.addMidMsg(i.payResultMsg);break;case"onGoLogout":case"onGoSwitchUser":egret.setTimeout(function(){window.location.reload()},this,2e3);break;case"getChannelName":egret.log("getChannelName has set",Utils.agentConfig.channelName,i.channelName),Utils.agentConfig.channelName&&""!=Utils.agentConfig.channelName||(Utils.agentConfig.channelName=i.channelName||"");break;case"setStatusBar":getUrlKV().statusBarHeight=Number(i.statusBarHeight),egret.log("getUrlKV()['statusBarHeight'] ",getUrlKV().statusBarHeight)}}catch(e){egret.log("MicMgr exception",e)}}},n.prototype.goSwitchAccount=function(){var e=this,t=JSON.stringify({method:"goSwitchUser"});egret.setTimeout(function(){egret.ExternalInterface.call("callNative",t),e.restart()},this,750)},n.prototype.onLoginPHPSuccess=function(){},n.prototype.showLoadingTips=function(e,t){},n.prototype.dismissLoading=function(){},n.prototype.goLogin=function(){if(1<=game.GameMVC.playerPy.loginStatusVO.state)this.goSwitchAccount();else{var e=JSON.stringify({method:"goLogin"});egret.setTimeout(function(){egret.ExternalInterface.call("callNative",e)},this,750)}},n.prototype.invokeLog=function(e){e.method="invokeLog",egret.ExternalInterface.call("callNative",JSON.stringify(e))},n.prototype.goPurchase=function(e){var t=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N),i=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N),n=(game.AppFacade.getInstance().retrieveProxy(game.GuildPy.N),JSON.stringify({method:"goPurchase",itemId:e.itemId,itemSDKId:e.itemSDKId,itemPrice:e.money,count:e.count||1,orderId:e.serialNumber,itemOriginPrice:e.originMoney||e.money,itemName:e.goodsName,itemDesc:e.goodsDesc||e.goodsName,reserved:e.ext,playerId:i.playerInfoVO.playerId,name:i.playerInfoVO.name,serverId:t.serverSelect.s_id,serverName:t.serverSelect.s_name,rate:10,thirdApplePay:"guoer",uuid:t.userVO.uuid,level:i.playerInfoVO.level}));egret.setTimeout(function(){egret.ExternalInterface.call("callNative",n)},this,500)},n.prototype.restart=function(){egret.log("restart enter"),Utils.Socket.close(),Utils.SoundManager.stopAll(),egret.setTimeout(function(){if(egret.log("restarting"),Utils.SDKMgr.getPerformConfig(43)){var e=JSON.stringify({method:"restart"});egret.ExternalInterface.call("callNative",e)}else window.location.reload()},this,500)},n.prototype.cmd=function(e,t){},n.prototype.copyToClipBoard=function(e,t){egret.log("copyToClipBoard enter");var i=JSON.stringify({method:"copyToClipBoard",str:e});egret.setTimeout(function(){egret.log("copyToClipBoarding"),egret.ExternalInterface.call("callNative",i)},this,500),t&&egret.setTimeout(function(){t()},this,1e3)},n.prototype.nodeRecord=function(e){if(this.needNodeRecrod)if(egret.log("======nodeRecord",e),-1==e||n._platform_nodeTable){if(!n._platform_nodeTable){var t=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N);n._platform_nodeTable={action:"record_login_info",platform:Utils.agentConfig.AgentCode,sub_platform:Utils.agentConfig.channelName,username:t.userVO.uuid,node:e,os_code:Utils.DeviceUtils.getPlatform(),user_agent:window.navigator.userAgent,browser_id:Utils.DeviceUtils.getBrowser()}}if(!n._platform_nodeTable.username){t=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N);n._platform_nodeTable.username=t.userVO.uuid}n._platform_nodeTable.sub_platform=Utils.agentConfig.channelName,n._platform_nodeTable.node=e,Utils.Http.toGet(n._platform_nodeTable)}else egret.log("还没初始化")},n.prototype.getChannelName=function(){egret.log("getChannelName");var e=JSON.stringify({method:"getChannelName"});egret.ExternalInterface.call("callNative",e)},n.prototype.share=function(e,t){},n.prototype.addShortcut=function(e,t){},n.prototype.enterFlow=function(e,t){var i=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N),n=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N),o=game.AppFacade.getInstance().retrieveProxy(game.GuildPy.N),a={serverId:i.serverSelect&&i.serverSelect.s_id,serverName:i.serverSelect&&i.serverSelect.s_name,severArea:i.serverSelect&&i.serverSelect.area,playerName:n.playerInfoVO.name||n.roleVo.name,roleId:n.playerInfoVO.playerId||n.roleVo.playerId,roleCreateDt:n.playerInfoVO.createDt||n.roleVo.createDt,time:Utils.TimerManager.getServerTime(),money:n.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeDiamond]||0,level:n.playerInfoVO.level||0,vipLevel:n.playerInfoVO.playerVip.vipLevel||0,fightCap:n.playerInfoVO.fightCap||0,camp:n.playerInfoVO.camp&&1==n.playerInfoVO.camp?"male":"famale",guildId:o.guildDetail?o.guildDetail.guildId:"",guildName:o.guildDetail?o.guildDetail.name:"",params:t,type:""};a.type=e,this.invokeLog(a)},n.prototype.onCustomError=function(e){},n}(SDKMgr);__reflect(MicMgr.prototype,"MicMgr",["ISDKInterface"]),function(n){var s={},o=1e3,a=[],c={};function l(e,t){if(void 0===t&&(t=!1),null!=s[e]){if(t)for(var i in t=!1,s[e].childType)if(n.isNoticeShow(s[e].childType[i])){t=!0;break}if(!t)for(var i in s[e].show=!1,s[e].notic&&s[e].notic.parent&&(s[e].notic.visible=h(e)),s[e].parentType)l(s[e].parentType[i],!0)}}function h(e){return null!=s[e]&&(s[e].show&&(null==s[e].unlockId||Utils.UnlockMgr.checkPass(s[e].unlockId).allow))}n.intervalUpdate=function(e){if(0!=a.length&&(o-=e)<=0){for(var t=function(t){for(var e=Object.keys(t),n={},i=function(i){Array.isArray(t[i])&&t[i].forEach(function(e){var t=NT.LOCAL_RES_UPDATE_SENSITIVE_EVENT[i].sub[e];t&&(t.mediators.forEach(function(e){n[e]=!0}),t.cb&&t.cb())});var e=NT.LOCAL_RES_UPDATE_SENSITIVE_EVENT[i];e&&e.mediators&&e.mediators.forEach(function(e){n[e]=!0}),e&&e.cb&&e.cb()},o=0,a=e;o<a.length;o++)i(r=a[o]);for(var r in game.AppFacade.getInstance(),n)game.AppFacade.getInstance().retrieveMediator(r).handleNotice(t)},i=0,n=a;i<n.length;i++)t(n[i]);a.splice(0)}},n.addCareCost=function(e,t){try{for(var i in"string"==typeof e&&(e=JSON.parse(e)),e){var n=e[i];n[0]==EEntityType.EEntityTypeItem&&(NT.LOCAL_RES_UPDATE_SENSITIVE_EVENT[EEntityType.EEntityTypeItem].sub[n[1]]||(NT.LOCAL_RES_UPDATE_SENSITIVE_EVENT[EEntityType.EEntityTypeItem].sub[n[1]]={cb:t,mediators:[]}))}}catch(e){console.log(e)}},n.localResUpdate=function(e){a.push(e),o=1e3},n.redp=function(e,t,i){if(void 0===t&&(t=!1),e&&e.parent){var n="NoticeManager_RED_POINT_NAME"+e.hashCode,o=e.parent.getChildByName(n);if(t){if(!o){var a=new eui.Image;a.touchEnabled=!1,a.source="_main_m_json.common_img_hongdian",a.scaleX=a.scaleY=.8,a.name=n,i?(a.x=i.x?i.x+e.x:e.x,a.y=i.y?i.y+e.y:e.y):(a.x=e.x,a.y=e.y),e.parent.addChild(a)}}else o&&e.parent.removeChild(o)}},n.addNoticeListener=function(e,t,i,n){if(t&&e&&t.parent)if(s[e]&&s[e].notic&&s[e].notic.parent&&s[e].notic.parent==t.parent)egret.log("noticeType has registered,can not register again ",e);else{if(null==s[e]&&(s[e]={notic:void 0,parentType:[],childType:{},show:!1}),null==s[e].notic){var o=new eui.Image;o.touchEnabled=!1,RES.getResAsync("_main_m_json.common_img_hongdian",function(e){o.source=e,o.scaleX=o.scaleY=.8},this),s[e].notic=o}else s[e].notic.parent&&s[e].notic.parent.removeChild(s[e].notic);var a=s[e].notic;s[e].show,n?(void 0===n.percentX?a.x=t.x:a.x=t.parent.width*n.percentX,void 0===n.percentY?a.y=t.y:a.y=t.parent.height*n.percentY,n.unlockId&&(s[e].unlockId=n.unlockId)):(a.x=t.x,a.y=t.y),a.visible=h(e),t.parent.addChild(a),n&&!n.noCleanAfterRemove&&t.parent.once(egret.Event.REMOVED_FROM_STAGE,function(){t&&t.parent&&t.parent.contains(a)&&t.parent.removeChild(a)}),(s[e].view=i).registerNotices.indexOf(e)<0&&i.registerNotices.push(e)}else egret.log("obj||noticeType||obj.parent is undefined")},n.setChildType=function(n,e){null==s[n]&&(s[n]={notic:void 0,parentType:[],childType:{},show:!1}),Array.isArray(e)||(e=[e]),e.forEach(function(e,t,i){null!=e&&(s[n].childType[e]=e,null==s[e]&&(s[e]={notic:void 0,parentType:[],childType:{},show:!1}),s[e].parentType.push(n))})},n.isNoticeShow=h,n.removeNoticeListener=function(e){s[e]&&s[e].notic&&(s[e].notic.parent&&s[e].notic.parent.removeChild(s[e].notic),s[e].notic=void 0,s[e].view=void 0)},n.registerCB=function(e,t,i,n){var o;for(var a in o="number"==typeof e?[e]:e){var r=o[a];c[r]={cb:t,thisObj:i,unlockModule:n}}},n.removeCB=function(e){c[e]=void 0},n.updateNotice=function a(e,r,t){if(void 0===t&&(t=!1),e){var i=e;"number"==typeof e&&(i=[e]),Utils.agentConfig.isChecking&&Utils.agentConfig.isChecking.closeNotice?i.forEach(function(e){l(e)}):i.forEach(function(e){var t;if((!c[t=e]||!c[t].unlockModule||Utils.UnlockMgr.checkPass(c[t].unlockModule,!1).allow||(console.log("红点未解锁 模块：",c[t].unlockModule),0))&&c[e]&&(c[e].cb.call(c[e].thisObj,r)?function e(t){for(var i in null==s[t]?s[t]={notic:void 0,parentType:[],childType:{},show:!0}:(s[t].show=!0,s[t].notic&&s[t].notic.parent&&(s[t].notic.visible=h(t))),s[t].parentType)e(s[t].parentType[i])}(e):l(e)),s[e]){var i=[];for(var n in s[e].childType){var o=s[e].childType[n];i.push(o)}0<i.length&&a(i,r,!0)}})}}}(NoticeManager||(NoticeManager={}));var PopUpManager,ObjectPoolMgr=function(t){function e(){var e=t.call(this)||this;return window._content||(window._content=e),e._content={},e._objs=new Array,e}return __extends(e,t),e.prototype.clearAll=function(){for(var e in this._content)this.clearClass(e);this._content={}},e.prototype.pop=function(e,t){var i;this._content[e]||(this._content[e]=[]);var n=this._content[e];return n.length?(i=n.pop()).onOPComeBack(t,!1):((i=new(egret.getDefinitionByName(e))).ObjectPoolKey=e,i.onOPComeBack(t,!0)),i},e.prototype.push=function(e){if(!e)return!1;var t=e.ObjectPoolKey;return!!t&&(!!this._content[t]&&(e.onOPReset(),this._content[t].push(e),!0))},e.prototype.clearClass=function(e,t){void 0===t&&(t=null);for(var i=this._content[e];i&&i.length;){var n=i.pop();n.onOPClean(),n=null}this._content[e]=null,delete this._content[e]},e.prototype.dealFunc=function(e,t){var i=this._content[e];if(null!=i)for(var n=0,o=i.length;n<o;n++)i[n][t]()},e.prototype.check=function(e){this.dealFunc(e,"onOPCheck")},e}(BaseClass);__reflect(ObjectPoolMgr.prototype,"ObjectPoolMgr"),function(h){var p,d;function u(e){e?(p.touchEnabled=!0,p.visible=!0,GameRootLayer.gameLayer().panelLayer.setChildIndex(p,-1),egret.Tween.removeTweens(p),0==p.alpha&&egret.Tween.get(p).to({alpha:1},UIActionManager.POP_ACTION_SPEED/4)):(p.alpha=1,egret.Tween.removeTweens(p),egret.Tween.get(p).to({alpha:0},UIActionManager.POP_ACTION_SPEED/4).call(function(){p.touchEnabled=!1,p.visible=!1}))}function o(){var e=GameRootLayer.gameLayer().panelLayer.$children.length;if(0<e){var t=GameRootLayer.gameLayer().panelLayer.$children[e-1];for(var i in h.popUpViewQueue)for(var n=0,o=h.popUpViewQueue[i];n<o.length;n++){var a=o[n];if(a.obj===t){a.onDarkClick&&a.onDarkClick()||r(t);break}}}}function r(l,e,t){void 0===e&&(e=0),!l.hasEventListener(egret.Event.REMOVED_FROM_STAGE)&&l.onDestroy&&l.onDestroy();!e&&l.removeActionType&&(e=l.removeActionType()),l.enabled=!1,UIActionManager.playUIAction(l,e,function(){GameRootLayer.gameLayer().panelLayer.contains(l)&&(GameRootLayer.gameLayer().panelLayer.removeChild(l),GameRootLayer.gameLayer().onPopStatusUpdate(l.name,!0)),function(){for(var e in h.popUpViewQueue)for(var t=0,i=0,n=h.popUpViewQueue[e];i<n.length;i++){if((c=n[i]).obj===l){h.popUpViewQueue[e].splice(t,1),c.closeCB&&c.closeCB(l.opperationParams);break}t++}game.AppFacade.getInstance().sendNotification(CN.CHANGE_PANEL,{isRemove:!0}),l.checkForGuide&&game.AppFacade.getInstance().sendNotification(CN.GUIDE_VIEW_STACK_CHANGE);var o=GameRootLayer.gameLayer().panelLayer.$children.length;if(o<=1&&p.visible)u(!1);else if(2<=o){GameRootLayer.gameLayer().panelLayer.setChildIndex(p,GameRootLayer.gameLayer().panelLayer.$children.length-2);var a=GameRootLayer.gameLayer().panelLayer.getChildAt(GameRootLayer.gameLayer().panelLayer.$children.length-1);for(var e in h.popUpViewQueue)for(var r=0,s=h.popUpViewQueue[e];r<s.length;r++){var c;if((c=s[r]).obj===a){p.visible!=c.dark&&u(c.dark),c.dark&&(d=c.clickDarkClose);break}}}}()},this,!0)}h.popUpViewQueue={default:new Array},h.addPopUp=function(e){var t=e.obj,i=!0;null!=e.dark&&(i=e.dark);var n=1;null!=e.effectType&&(n=e.effectType),GameRootLayer.gameLayer().panelLayer.contains(t)||(p||((p=new eui.Image).source="common_bg_toumingdi_png",p.width=Utils.DeviceUtils.curWidth(),p.height=Utils.DeviceUtils.curHeight(),p.alpha=0,GameRootLayer.gameLayer().panelLayer.contains(p)||GameRootLayer.gameLayer().panelLayer.addChild(p),p.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0!=d&&o()},this)),u(i),GameRootLayer.gameLayer().panelLayer.addChild(t),GameRootLayer.gameLayer().onPopStatusUpdate(t.name),t.parent&&t.parent.validateNow(),t.alpha=1,h.popUpViewQueue.default.push({exml:t.skinName,obj:t,dark:i,clickDarkClose:e.clickDarkClose,onDarkClick:e.onDarkClick,closeCB:e.closeCB,context:e.context}),d=!1,t.enabled=!1,game.AppFacade.getInstance().sendNotification(CN.CHANGE_PANEL),UIActionManager.playUIAction(t,n,function(){t.enabled=!0,d=e.clickDarkClose,t.checkForGuide&&game.AppFacade.getInstance().sendNotification(CN.GUIDE_VIEW_STACK_CHANGE,{})}))},h.onDarkClick=o,h.removePopUp=r,h.clearViewQueue=function(e,t){void 0===e&&(e=void 0),void 0===t&&(t="default");var i=h.popUpViewQueue[t];if(e)for(var n=i.length-1;0<=n&&i[n]!=e&&!i[n];n--)GameRootLayer.gameLayer().panelLayer.contains(i[n].obj)&&GameRootLayer.gameLayer().panelLayer.removeChild(i[n].obj);else for(n=i.length-1;0<=n;n--)GameRootLayer.gameLayer().panelLayer.contains(i[n].obj)&&h.removePopUp(i[n].obj)}}(PopUpManager||(PopUpManager={})),function(s){var e=function(i){function e(e){var t=i.call(this)||this;return t.needTipsToday=!1,t.skinName="CommonActionBuyTipsDialogSkin",t.params=e,t.clickCB=e.clickCB,t}return __extends(e,i),e.prototype.onClick=function(e,t){var i=s.AppFacade.getInstance().retrieveProxy(s.BackpackPy.N),n=!1;1===e?i.getInfoByTypeCodeNum(this.leftCost[0],this.leftCost[1]).haveNum>=this.leftCost[2]&&(n=!0):i.getInfoByTypeCodeNum(this.rightCost[0],this.rightCost[1]).haveNum>=this.rightCost[2]&&(n=!0),n?this.clickCB&&(this.clickCB({type:e,num:t}),this.params.dontCloseAfterClick?(this.params.canBuyCount-=t,this.params.curBuyCount+=t,this.update()):this.hide()):Utils.MsgUtils.addErrMsg(10024)},e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initForCommonTips(),this.update()},e.prototype.initForCommonTips=function(){var e=this;this.img_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onClick(1,1)},this),this.img_right.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onClick(0,e.rightCount)},this)},e.prototype.update=function(){var t=this,e="行动力",i=this.params.curBuyCount,n=this.params.canBuyCount;this.rightCount=Math.min(5,n);var o=0;this.leftCost=JSON.parse(s.Config.publicBuyCostConfig(this.params.type,i).costs)[0];for(var a=0;a<this.rightCount;a++){o+=JSON.parse(s.Config.publicBuyCostConfig(this.params.type,i+a).costs)[0][2]}this.rightCost=[this.leftCost[0],this.leftCost[1],o];var r=s.GeneralConfig.getEntityConfigByCode(this.leftCost[0],this.leftCost[1]);RES.getResAsync(ResourceUtils.png(r.icon),function(e){t.img_left_icon.source=e},this),this.lb_left.text=e+"x1",this.lb_left_num.text="x"+this.leftCost[2];r=s.GeneralConfig.getEntityConfigByCode(this.rightCost[0],this.rightCost[1]);RES.getResAsync(ResourceUtils.png(r.icon),function(e){t.img_right_icon.source=e},this),this.lb_right.text=e+"x"+this.rightCount,this.lb_right_num.text="x"+this.rightCost[2],this.decorateVip()},e.prototype.decorateVip=function(){if(this.params.canBuyCount){var e=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N);this.lb_tips.text="（您当前是VIP"+e.playerInfoVO.playerVip.vipLevel+"，今日剩余购买次数"+this.params.canBuyCount+"次）"}},e.STORAGE_PREFIX="CommonActionBuyTipsDialog",e}(BasePanel);s.CommonActionBuyTipsDialog=e,__reflect(e.prototype,"game.CommonActionBuyTipsDialog")}(game||(game={}));var SoundManager=function(t){function e(){var e=t.call(this)||this;return e._nowBg="",e._nowDelayBg="",e._enableBG=!1,e._enableEff=!1,e._durTDic={},e._soundDic={},e.isPreloadEffect=!1,e}return __extends(e,t),e.prototype.init=function(){"1"==Utils.LocalStorageUtil.getItem("SOUND_INIT",!0)?(this._enableBG="1"==Utils.LocalStorageUtil.getItem("SOUND_BG_ENABLE",!0),this._enableEff="1"==Utils.LocalStorageUtil.getItem("SOUND_EFF_ENABLE",!0)):(Utils.LocalStorageUtil.setItem("SOUND_INIT","1",!0),Utils.LocalStorageUtil.setItem("SOUND_BG_ENABLE","1",!0),Utils.LocalStorageUtil.setItem("SOUND_EFF_ENABLE","1",!0),this._enableBG=!0,this._enableEff=!0)},e.prototype.preloadEffect=function(){var e=new Array,t=0;for(var i in SOUND_EFF_TYPE)e[t]=SOUND_EFF_TYPE[i],t++;RES.createGroup("preloadEffect",e,!0),RES.loadGroup("preloadEffect"),this.isPreloadEffect=!0},Object.defineProperty(e.prototype,"enableBG",{get:function(){return this._enableBG},set:function(e){this._enableBG!=e&&(this._enableBG=e,this._enableBG?this.resumeBg():this.stopBg(),Utils.LocalStorageUtil.setItem("SOUND_BG_ENABLE",e?"1":"0",!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableEff",{get:function(){return this._enableEff},set:function(e){this._enableEff!=e&&(this._enableEff=e,Utils.LocalStorageUtil.setItem("SOUND_EFF_ENABLE",e?"1":"0",!0))},enumerable:!0,configurable:!0}),e.prototype.activateHandler=function(){this._enableBG&&this.switchBGMVolume(.5)},e.prototype.deactivateHandler=function(){this._enableBG&&this.switchBGMVolume(0)},e.prototype.bindStage=function(){GameRootLayer.gameLayer().stage&&(GameRootLayer.gameLayer().stage.addEventListener(egret.Event.ACTIVATE,this.activateHandler,this),GameRootLayer.gameLayer().stage.addEventListener(egret.Event.DEACTIVATE,this.deactivateHandler,this),this.isBindEvent=!0)},e.prototype.switchBGMVolume=function(e,t){this._bgC&&(egret.Tween.removeTweens(this._bgC),0==e?(this._bgC.volume=e,t&&t()):egret.Tween.get(this._bgC).to({volume:e},3e3).call(function(){t&&t()},this)),this._bgDelayC&&(0==e?this._bgDelayC.stop():this.playDelayBg(),t&&t())},e.prototype.resumeDelayBg=function(){if(this._enableBG){if(!this._bgDelayC){var e=RES.getRes(this._nowDelayBg);if(!e)return void this.playDelayBg();if(e.type=egret.Sound.MUSIC,this._bgDelayC=e.play(0,1),null==this._bgDelayC)return}egret.clearTimeout(this.downTime),this._bgDelayC.volume=.5,this._bgDelayC.addEventListener(egret.Event.SOUND_COMPLETE,function(e){this.downTime=egret.setTimeout(function(){var e=this._nowDelayBg;this._nowDelayBg="",this.playDelayBg(e)},this,2e4)},this)}},e.prototype.resumeBg=function(){if(this._enableBG){if(!this._bgC){var e=RES.getRes(this._nowBg);if(!e)return void this.playDelayBg();if(e.type=egret.Sound.MUSIC,this._bgC=e.play(),null==this._bgC)return}this._bgC.volume=0,this.switchBGMVolume(.5)}},e.prototype.stopBg=function(e){var t=this;void 0===e&&(e=!0),this._bgC&&(this.curPos=e?0:this._bgC.position,this.switchBGMVolume(0,function(){try{t._bgC.stop()}catch(e){egret.log("SoundManager exception",e)}t._bgC=void 0})),this._bgDelayC&&this.switchBGMVolume(0,function(){try{t._bgDelayC.stop()}catch(e){egret.log("SoundManager exception",e)}t._bgDelayC=void 0}),this._nowDelayBg="",this._nowBg=""},e.prototype.stopAll=function(){for(var e in this._bgC&&(this._bgC.stop(),this._bgC=void 0),this._bgDelayC&&(this._bgDelayC.stop(),this._bgDelayC=void 0),this._soundDic){this._soundDic[e].stop()}for(var e in this._soundDic={},this._durTDic){this._durTDic[e].stop()}this._durTDic={}},e.prototype.playBg=function(e,t){var i=this;void 0===t&&(t=0),this._nowDelayBg="",this.isBindEvent||this.bindStage(),this._enableBG&&this._nowBg!=e&&(this.stopBg(),e&&(this._nowBg=e),RES.getResAsync(this._nowBg,function(e){e&&i.resumeBg()},this))},e.prototype.playDelayBg=function(e){var t=this;this._nowBg="",this.isBindEvent||this.bindStage(),this._enableBG&&this._nowDelayBg!=e&&(this.stopBg(),e&&(this._nowDelayBg=e),egret.clearTimeout(this.upTime),RES.getResAsync(this._nowDelayBg,function(e){e&&(t.upTime=egret.setTimeout(function(){this.resumeDelayBg()},t,5e3))},this))},e.prototype.playSoundLoop=function(e,t){if(void 0===t&&(t=1),this.isPreloadEffect&&(this.isBindEvent||this.bindStage(),this._enableEff&&null==this._soundDic.get(e))){var i=RES.getRes(e);if(i){var n=i.play(0,0);null!=n&&(n.volume=t,this._soundDic.set(e,n))}}},e.prototype.stopSoundLoop=function(e){null!=this._soundDic.get(e)&&(this._soundDic.get(e).stop(),this._soundDic.delete(e))},e.prototype.playSound2=function(e,t,i){void 0===t&&(t=1),void 0===i&&(i=0)},e.prototype.playSound=function(e,t,i){if(void 0===t&&(t=1),void 0===i&&(i=0),this.enableEff&&this.isPreloadEffect){if(0<i){null==this._durTDic.get(e)&&this._durTDic.set(e,0);var n=Date.now();if(n-this._durTDic.get(e)<i)return;this._durTDic.set(e,n)}var o=RES.getRes(e);if(o){var a=o.play(0,1);if(null!=a)return a.volume=t,a}}},e}(BaseClass);__reflect(SoundManager.prototype,"SoundManager");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(i,n,o,a){var r=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){n.call(a,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResAsync("gameEui_json",function(e,t){window.JSONParseClass.setData(e),egret.callLater(function(){n.call(a,generateEUI2)},r)},this);else if("undefined"!=typeof generateJSON)if(-1<i.indexOf(".exml")){var e=i.split("/");e.pop();var t=e.join("/")+"_EUI.json";generateJSON.paths[i]?egret.callLater(function(){n.call(a,generateJSON.paths[i])},this):RES.getResByUrl(t,function(e){window.JSONParseClass.setData(e),egret.callLater(function(){n.call(a,generateJSON.paths[i])},r)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){n.call(a,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,function e(t){t.resItem.url==i&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,e,null),o.call(a))},null),RES.getResByUrl(i,function(e){n.call(a,e)},this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var TimerManager=function(t){function e(){var e=t.call(this)||this;return e.num2week={0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六",7:"周日"},e.ENTRANCE_CONFIG={},e._handlers=new Array,e._delHandlers=new Array,e._currTime=egret.getTimer(),e._currFrame=0,e._count=0,e._timeScale=1,e._timeScaleExtra=1,e._entranceTimeList=new Array,egret.Ticker.getInstance().register(e.onEnterFrame,e),e}return __extends(e,t),e.prototype.setTimeScale=function(e){this._timeScale=e},e.prototype.setTimeScaleExtra=function(e){this._timeScaleExtra=e},e.prototype.getTimeScale=function(){return this._timeScale*this._timeScaleExtra},e.prototype.updateEntranceTimeList=function(){this._entranceTimeList=[],this._serverTimeForEntrance=game.GameMgr.getInstance().serverTime()-1;var e=function(e){var t=p.ENTRANCE_CONFIG[e].constTime(),i=game.GameMgr.getInstance().serverTime();if(t){if(p.ENTRANCE_CONFIG[e].needServerDay){var n=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N).loginGameVO.serverOpenDt;if(!n)return"continue";if(Math.floor((i-n)/86400)<p.ENTRANCE_CONFIG[e].needServerDay())return"continue"}var o=t[0],a=t[1],r=t[2];r||(r=[0,1,2,3,4,5,6]),r.forEach(function(e,t){7==e&&(r[t]=0)});var s=new Date;if(s.setTime(1e3*i),o&&a&&-1!=r.indexOf(s.getDay())&&(s.setHours(a[0]||0,a[1]||0,a[2]||0),s.getTime()/1e3>i)){var c=s.getTime()/1e3,l=new Date(1e3*i);l.setHours(o[0]||0,o[1]||0,o[2]||0);var h=l.getTime()/1e3;p._entranceTimeList.push({beginTime:h,endTime:c,module:e,OpenFunction:p.ENTRANCE_CONFIG[e].OpenFunction,CloseFunction:p.ENTRANCE_CONFIG[e].CloseFunction,hasOpen:!1})}}},p=this;for(var t in this.ENTRANCE_CONFIG)e(t);this._entranceTimeList.sort(function(e,t){return e.beginTime-t.beginTime})},e.prototype.checkEntranceTime=function(){this._serverTimeForEntrance++,this._entranceTimeList[0]&&!this._entranceTimeList[0].hasOpen&&this._serverTimeForEntrance>=this._entranceTimeList[0].beginTime&&this._serverTimeForEntrance<=this._entranceTimeList[0].endTime?(this._entranceTimeList[0].OpenFunction&&this._entranceTimeList[0].OpenFunction(),this._entranceTimeList[0].hasOpen=!0):this._entranceTimeList[0]&&this._serverTimeForEntrance>=this._entranceTimeList[0].endTime&&(this._entranceTimeList[0].CloseFunction&&this._entranceTimeList[0].CloseFunction(),this._entranceTimeList.shift()),this._serverTimeForEntrance%10==0&&(this._serverTimeForEntrance=game.GameMgr.getInstance().serverTime()-1)},e.prototype.onEnterFrame=function(){this._currFrame++,this._currTime=egret.getTimer();for(var e=0;e<this._count;e++){((t=this._handlers[e]).userFrame?this._currFrame:this._currTime)>=t.exeTime&&(t.method.call(t.methodObj,(this._currTime-t.dealTime)*this._timeScale),t.dealTime=this._currTime,t.exeTime+=t.delay,t.repeat||(1<t.repeatCount?t.repeatCount--:(t.complateMethod&&t.complateMethod.apply(t.complateMethodObj),this._delHandlers.push(t))))}for(;this._delHandlers.length;){var t=this._delHandlers.pop();this.remove(t.method,t.methodObj)}},e.prototype.create=function(e,t,i,n,o,a,r){if(!(t<0||i<0||null==n)){this.remove(n,o);var s=Utils.ObjectPoolMgr.pop("TimerHandler");s.userFrame=e,s.repeat=0==i,s.repeatCount=i,s.delay=t,s.method=n,s.methodObj=o,s.complateMethod=a,s.complateMethodObj=r,s.exeTime=t+(e?this._currFrame:this._currTime),s.dealTime=this._currTime,this._handlers.push(s),this._count++}},e.prototype.doTimer=function(e,t,i,n,o,a){void 0===o&&(o=null),void 0===a&&(a=null),this.create(!1,e,t,i,n,o,a)},e.prototype.doFrame=function(e,t,i,n,o,a){void 0===o&&(o=null),void 0===a&&(a=null),this.create(!0,e,t,i,n,o,a)},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),e.prototype.remove=function(e,t){for(var i=0;i<this._count;i++){var n=this._handlers[i];if(n.method==e&&n.methodObj==t){this._handlers.splice(i,1),Utils.ObjectPoolMgr.push(n),this._count--;break}}},e.prototype.removeAll=function(e){for(var t=0;t<this._count;t++){var i=this._handlers[t];i.methodObj==e&&(this._handlers.splice(t,1),Utils.ObjectPoolMgr.push(i),this._count--,t--)}},e.prototype.isExists=function(e,t){for(var i=0;i<this._count;i++){var n=this._handlers[i];if(n.method==e&&n.methodObj==t)return!0}return!1},e.prototype.getFormatBySecond1=function(e,t){void 0===e&&(e=0),void 0===t&&(t=":");var i=Math.floor(e/3600),n=Math.floor((e-3600*i)/60),o=Math.floor((e-3600*i)%60);return""+(0==i?"00":i<10?"0"+i:""+i)+t+(0==n?"00":n<10?"0"+n:""+n)+t+(0==o?"00":o<10?"0"+o:""+o)},e.prototype.getFormatBySecond2=function(e){if(void 0===e&&(e=0),0<e){var t=Math.floor(e/86400);e-=86400*t;var i=Math.floor(e/3600);e-=3600*i;var n=Math.floor(e/60);return e-=60*n,0<t?t+"天"+i+"小时":0<i?i+"小时"+n+"分":0<n?n+"分":"小于1分钟"}return"0天0小时"},e.prototype.getFormatBySecond3=function(e){if(void 0===e&&(e=0),0<e){var t=Math.floor(e/86400);e-=86400*t;var i=Math.floor(e/3600);e-=3600*i;var n=Math.floor(e/60);return e-=60*n,0<t?t+"天"+i+"小时":0<i?i+"小时"+n+"分":0<n?n+"分":e+"秒"}return""},e.prototype.getOfflineDescBySecond=function(e){void 0===e&&(e=0);var t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60),n=Math.floor((e-3600*t)%60);return 720<t?"离线："+Math.floor(t/24/30).toString()+"月":24<t?"离线："+Math.floor(t/24).toString()+"天":1<t?"离线："+t+"小时":1<i?"离线："+i+"分钟":1<n?"离线：1分钟":"在线"},e.prototype.getTimeLeftDescBySecond=function(e){void 0===e&&(e=0);var t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60),n=Math.floor((e-3600*t)%60);return 720<t?Math.floor(t/24/30).toString()+"个月前":24<t?Math.floor(t/24).toString()+"天前":1<t?t+"小时前":1<i?i+"分钟前":1<n?"1分钟前":"刚刚"},e.prototype.getServerTime=function(e){return void 0===e&&(e=!0),game.GameMgr.getInstance().serverTime(e)},e.prototype.getOpenServerTime=function(){if(!this._openServerTime){var e=game.GameMVC.loginPy.loginGameVO.serverOpenDt,t=new Date(1e3*e);t.setHours(0,0,0,0),this._openServerTime=t.getTime()/1e3}return this._openServerTime},e.prototype.getTimeInDaysAfterServerOpen=function(e){return this.getOpenServerTime()+86400*e},e.prototype.getServerOpenDays=function(){return Math.ceil((this.getServerTime()-this.getOpenServerTime())/86400)},e.prototype.checkIsOpen_FormatA=function(e){var t=e;"string"==typeof e&&(t=JSON.parse(e));var i=t[0],n=t[1],o=t[2]||[1,2,3,4,5,6,7],a={isOpen:!0,isWillOpenToday:!0,openTime:i,endTime:n,endTimeDt:0,openTimeDt:0,openDay:o,openDayTip:""},r=Utils.TimerManager.getServerTime(!1),s=new Date;s.setTime(1e3*r);var c,l=s.getDay();if(0==l&&(l=7),(c=new Date(1e3*r)).setHours(i[0]||0,i[1]||0,i[2]||0),r<c.getTime()/1e3&&(a.isOpen=!1),(c=new Date(1e3*r)).setHours(n[0]||0,n[1]||0,n[2]||0),r>c.getTime()/1e3&&(a.isOpen=!1),a.isOpen&&o&&-1==o.indexOf(l)&&(a.isOpen=!1),o&&-1==o.indexOf(l)&&(a.isWillOpenToday=!1),o&&7!=o.length){for(var h in o){0==(f=o[h])&&(f=7)}o.sort(function(e,t){return e-t});var p=[],d=o[0],u=o[0];o.push(o[o.length-1]);for(var g=1;g<o.length&&o[g];g++)o[g]==u+1?u=o[g]:(d==u?p.push(""+this.num2week[d]):p.push(this.num2week[d]+"到"+this.num2week[u]),d=u=o[g]);for(var h in a.openDayTip="每",p){var f=p[h];a.openDayTip+=f+"、"}a.openDayTip=a.openDayTip.slice(0,a.openDayTip.length-1)}else a.openDayTip="每天";var _=0;if(a.isWillOpenToday);else{for(var m=l,y=!1,v=0,T=o;v<T.length;v++){var C=T[v];if(m<C){y=!0,m=C;break}}_=y?24*(m-l):7-l+24*o[0]}return s.setTime(1e3*r),s.setHours(n[0]+_,n[1]||0,n[2]||0),a.endTimeDt=s.getTime()/1e3,s.setTime(1e3*r),s.setHours(i[0]+_,i[1]||0,i[2]||0),a.openTimeDt=s.getTime()/1e3,a},e.prototype.checkIsOpen_FormatB=function(e){var t,i="string"==typeof e&&JSON.parse(e)||e,n=i[0],o=i[1],a=i[2][0],r=i[2][1];null!=i[3]&&(t=Utils.TimerManager.isOddWeek());var s=Utils.TimerManager.getServerTime(!1),c={isOpen:!1,latestOpenDt:0,latestEndDt:0};if(null!=t){var l=t==(0!=i[3]),h=function(e,t){return s>=e.getTime()/1e3&&s<t.getTime()/1e3},p=new Date(1e3*s),d=new Date(1e3*s),u=p.getDay()||7;p.setDate(p.getDate()-(u-n)),p.setHours(a[0],a[1],0,0),d.setTime(p.getTime()),d.setDate(p.getDate()+o-1),d.setHours(r[0],r[1],0,0),l||(p.setDate(p.getDate()-7),d.setDate(d.getDate()-7)),h(p,d)||s>=d.getTime()/1e3&&(p.setDate(p.getDate()+14),d.setDate(d.getDate()+14)),c.latestOpenDt=p.getTime()/1e3,c.latestEndDt=d.getTime()/1e3,c.isOpen=h(p,d)}else{var g=new Date(1e3*s),f=0==g.getDay()?7:g.getDay();g.setDate(n<=f&&f<=n+o-1?g.getDate()+o-1-f+n:g.getDate()),g.setHours(r[0],r[1],0,0),c.latestEndDt=n<=f&&f<=n+o-1?g.getTime()/1e3:0,g.setTime(1e3*s),g.setDate(n<f&&f<n+o-1?0<c.latestEndDt-s?g.getDate():0<f-n?g.getDate()+n+7-g.getDay():g.getDate()+n-g.getDay():0<f-n?g.getDate()+n+7-f:g.getDate()+n-f),g.setHours(a[0],a[1],0,0),c.latestOpenDt=n<f&&f<n+o-1?0:0<c.latestEndDt-s?0:g.getTime()/1e3,c.isOpen=s>=c.latestOpenDt&&s<c.latestEndDt}return c},e.prototype.checkIsOpenForSingleServer=function(e){var t=JSON.parse(e),i=t[0],n=t[1],o=t[2][0],a=t[2][1],r=Utils.TimerManager.getServerTime(!1),s={isOpen:!1,latestOpenDt:0,latestEndDt:0},c=new Date(1e3*r),l=this.getServerOpenDays();return n<=l&&(l=(l-(i=1))%n+1),c.setHours(o[0],o[1],0,0),c.setDate(c.getDate()+(i-l)),s.latestOpenDt=c.getTime()/1e3,c.setHours(a[0],a[1],0,0),c.setDate(c.getDate()+n-1),s.latestEndDt=c.getTime()/1e3,r>s.latestEndDt&&(c.setHours(o[0],o[1],0,0),c.setDate(c.getDate()+1),s.latestOpenDt=c.getTime()/1e3,c.setHours(a[0],a[1],0,0),c.setDate(c.getDate()+n-1),s.latestEndDt=c.getTime()/1e3),s.isOpen=s.latestOpenDt<=r&&s.latestEndDt>r,s},e.prototype.getLeftTime=function(e){var t=new Date,i=Utils.TimerManager.getServerTime(!1);return t.setTime(1e3*i),t.setHours(e[0]),t.setMinutes(e[1]),t.setSeconds(e[2]),t.getTime()/1e3-i},e.prototype.createWeeklySchedule=function(){return new WeeklySchedule},e.prototype.getNextDayTime=function(e){var t=new Date(1e3*e);return t.setDate(t.getDate()),t.setHours(24,0,0),t.getTime()/1e3},e.prototype.isOddWeek=function(e){var t=new Date(1e3*(e||Utils.TimerManager.getServerTime(!1))),i=t.getDay()||7;t.setDate(t.getDate()-i+1);var n=Math.floor(t.getTime()/1e3/7/86400)%2==1;return egret.log("【TIME】：目前是"+(n?"单":"双")+"周"),n},e}(BaseClass);__reflect(TimerManager.prototype,"TimerManager");var TimerHandler=function(){function e(){this.delay=0,this.repeatCount=0,this.exeTime=0,this.dealTime=0}return e.prototype.clear=function(){this.method=null,this.methodObj=null,this.complateMethod=null,this.complateMethodObj=null},e}();__reflect(TimerHandler.prototype,"TimerHandler");var UIActionManager,WeeklySchedule=function(){function e(){this._schedule={}}return e.prototype.addSchedule=function(e,t,i,n){Array.isArray(t)||(t=[t]),this._schedule[e]||(this._schedule[e]=[]),this._schedule[e].push({status:e,days:t,interval:i,isOddWeek:n})},e.prototype.checkCurrentStatus=function(e){var a=[],t=new Date(1e3*(e||Utils.TimerManager.getServerTime(!1))),r=t.getDay()||7,s=t.getHours(),c=t.getMinutes(),l=Utils.TimerManager.isOddWeek();for(var i in this._schedule){this._schedule[i].forEach(function(e){var t=e.status,i=e.days,n=e.interval,o=e.isOddWeek;-1==a.indexOf(t)&&-1!=i.indexOf(r)&&(null!=o&&o!=l||(s>n[0][0]||s==n[0][0]&&c>=n[0][1])&&(s<n[1][0]||s==n[1][0]&&c<n[1][1])&&a.push(t))})}return a},e.prototype.getCurrentTimeInterval=function(e){var t={beginDt:0,endDt:0},i=e||this.checkCurrentStatus()[0];if(null!=i){var n=this._schedule[i],o=[],a=Utils.TimerManager.isOddWeek();n.forEach(function(t){var i=t.isOddWeek;t.days.forEach(function(e){void 0===i?o.push([[e,t.interval[0][0],t.interval[0][1]],[e,t.interval[1][0],t.interval[1][1]]]):i===a?(o.push([[e-14,t.interval[0][0],t.interval[0][1]],[e,t.interval[1][0],t.interval[1][1]]]),o.push([[e,t.interval[0][0],t.interval[0][1]],[e,t.interval[1][0],t.interval[1][1]]]),o.push([[e+14,t.interval[0][0],t.interval[0][1]],[e,t.interval[1][0],t.interval[1][1]]])):(o.push([[e-7,t.interval[0][0],t.interval[0][1]],[e-7,t.interval[1][0],t.interval[1][1]]]),o.push([[e+7,t.interval[0][0],t.interval[0][1]],[e+7,t.interval[1][0],t.interval[1][1]]]))})});var r=[],s=Utils.TimerManager.getServerTime(!1),c=new Date(1e3*s),l=c.getDate(),h=c.getDay()||7;o.forEach(function(e){var t=e[0],i=e[1];c.setTime(1e3*s),c.setDate(l+t[0]-h);var n=c.setHours(t[1],t[2],0,0)/1e3;c.setTime(1e3*s),c.setDate(l+i[0]-h);var o=c.setHours(i[1],i[2],0,0)/1e3;r.push([n,o])}),r.sort(function(e,t){return e[0]-t[0]});for(var p=0;p!=r.length-1;){var d=r[p],u=r[p+1];if(d[1]>=u[0]){var g=[Math.min(d[0],u[0]),Math.max(d[1],u[1])];r.splice(p,2,g)}else p+=1}r.forEach(function(e){e[0]<=s&&e[1]>s&&(t.beginDt=e[0],t.endDt=e[1])})}return t},e.prototype.resetSchedule=function(){for(var e in this._schedule)delete this._schedule[e]},e}();__reflect(WeeklySchedule.prototype,"WeeklySchedule"),function(_){_.POP_ACTION_SPEED=500,_.BTN_TOUCH_START_SCALE_SPEED=100,_.playUIAction=function(e,t,i,n,o){void 0===o&&(o=!1),e.onActionComplete&&(e.onActionComplete(),egret.Tween.removeTweens(e));var a=e.width,r=e.height,s=e.y,c=e.x,l=void 0,h=void 0,p=void 0,d=void 0,u=void 0,g=void 0;3==t||4==t?(l=e.left,h=e.right,p=e.horizontalCenter,e.left=void 0,e.right=void 0,e.horizontalCenter=void 0):6!=t&&5!=t||(d=e.top,u=e.bottom,g=e.verticalCenter,e.top=void 0,e.bottom=void 0,e.verticalCenter=void 0);var f=e.onActionComplete=function(){delete e.onActionComplete,3==t||4==t?(e.left=l,e.right=h,e.horizontalCenter=p):6!=t&&5!=t||(e.top=d,e.bottom=u,e.verticalCenter=g),i&&i.call(n)};if(o)switch(t){case 0:f();break;case 1:egret.Tween.get(e).to({alpha:0,scaleX:.5,scaleY:.5},_.POP_ACTION_SPEED,egret.Ease.backIn).call(f,n,void 0,!0);break;case 2:break;case 3:egret.Tween.get(e).to({x:Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale()+e.width},_.POP_ACTION_SPEED,egret.Ease.backInOut).call(f,n,void 0,!0);break;case 4:egret.Tween.get(e).to({x:-e.width},_.POP_ACTION_SPEED,egret.Ease.backInOut).call(f,n,void 0,!0);break;case 5:egret.Tween.get(e).to({y:e.height},_.POP_ACTION_SPEED,egret.Ease.backInOut).call(f,n,void 0,!0);break;case 6:egret.Tween.get(e).to({y:-e.height},_.POP_ACTION_SPEED,egret.Ease.backInOut).call(f,n,void 0,!0)}else switch(t){case 0:f();break;case 1:e.alpha=0,e.scaleX=.8*e.originScaleX,e.scaleY=.8*e.originScaleY,egret.Tween.get(e).to({alpha:1,scaleX:e.originScaleX,scaleY:e.originScaleY},_.POP_ACTION_SPEED,egret.Ease.backOut).call(f,n,void 0,!0);break;case 2:e.alpha=0,e.scaleX=.5*e.originScaleX,e.scaleY=.5*e.originScaleY,egret.Tween.get(e).to({alpha:1,scaleX:e.originScaleX,scaleY:e.originScaleY},_.POP_ACTION_SPEED,egret.Ease.elasticOut).call(f,n,void 0,!0);break;case 3:e.x=-a,egret.Tween.get(e).to({x:c},_.POP_ACTION_SPEED,egret.Ease.backInOut).call(f,n,void 0,!0);break;case 4:e.x=Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale()+a,egret.Tween.get(e).to({x:c},_.POP_ACTION_SPEED,egret.Ease.backInOut).call(f,n,void 0,!0);break;case 5:e.y=-r,egret.Tween.get(e).to({y:s},_.POP_ACTION_SPEED,egret.Ease.backInOut).call(f,n,void 0,!0);break;case 6:e.y=Utils.DeviceUtils.curHeight()+r,egret.Tween.get(e).to({y:s},_.POP_ACTION_SPEED,egret.Ease.backInOut).call(f,n,void 0,!0)}},_.UIActionEffect=function(e,t,i,n){void 0===i&&(i=!1),e.width,e.height;var o=i?1:-1,a=Utils.DeviceUtils.curWidth()*o,r=(Utils.DeviceUtils.curHeight(),e.x);e.x=e.x-a;var s=e.y;e.visible=!0,egret.Tween.get(e).to({x:r,y:s},t,egret.Ease.backOut).wait(100).call(function(){n&&n()})},_.playClickSound=function(e){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)},_.bindClickAction=function(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=!0)},_.hideScrollerBar=function(e){},_.setGrey=function(e,t){if(void 0===t&&(t=!0),!Utils.needToBlockSetGrey())if(t){var i=new egret.ColorMatrixFilter([1,0,0,0,-75,0,1,0,0,-75,0,0,1,0,-75,0,0,0,1,0]);e.filters=[i]}else e.filters=[]},_.setAbsGrey=function(e,t){if(void 0===t&&(t=!0),!Utils.needToBlockSetGrey())if(t){var i=new egret.ColorMatrixFilter([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0]);e.filters=[i]}else e.filters=[]},_.setOutLineEffect=function(e,t){if(void 0===t&&(t=!0),e)if(t){var i=new egret.GlowFilter(3394815,.8,10,10,2,1,!1,!1);e.filters=e.filters?e.filters.concat([i]):[i]}else e.filters=[]},_.blink=function(e,t){void 0===t&&(t=!1),egret.Tween.get(e,{loop:t}).call(function(){_.setOutLineEffect(e)}).wait(100).call(function(){_.setOutLineEffect(e,!1)}).wait(100).call(function(){_.setOutLineEffect(e)}).wait(100).call(function(){_.setOutLineEffect(e,!1)})},_.fadeBlink=function(e,t,i,n){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===n&&(n=250),i?egret.Tween.get(e,{loop:t}).to({alpha:1},n).to({alpha:0},n):egret.Tween.get(e,{loop:t}).to({alpha:0},n).to({alpha:1},n)},_.shake=function(e){};var c=0;_.breathe=function(e,t){if(e&&e.parent){var i=t&&t.needRandomDelay||!1,n=(t&&t.reset,t&&t.changeAP||!1),o=t&&t.breathTime||800,a=t&&t.scaleX||.01,r=t&&t.scaleY||.06;if(egret.Tween.removeTweens(e),e.scaleX=e.originScaleX||1,e.scaleY=e.originScaleY||1,n&&(e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height),e.hasEventListener(egret.Event.REMOVED_FROM_STAGE)||e.once(egret.Event.REMOVED_FROM_STAGE,function(){egret.Tween.removeTweens(e)},this),i){var s=++c%10*100;egret.setTimeout(function(){egret.Tween.get(e,{loop:!0}).to({scaleX:e.originScaleX+a,scaleY:e.originScaleY+r},o).to({scaleX:e.originScaleX,scaleY:e.originScaleY},o)},this,s)}else egret.Tween.get(e,{loop:!0}).to({scaleX:e.originScaleX+a,scaleY:e.originScaleY+r},o).to({scaleX:e.originScaleX,scaleY:e.originScaleY},o)}},_.drop=function(e,t,i,n){egret.Tween.get(e).to({y:e.y+t},i,egret.Ease.bounceOut).call(function(){n&&n()})},_.flyIn=function(e,t,i,n,o){if(void 0===n&&(n=function(){}),void 0===o&&(o=!1),!e.uia_flyIning){i||(i=2.5*_.POP_ACTION_SPEED),egret.Tween.removeTweens(e),e.originX||(e.originX=e.x),e.originY||(e.originY=e.y);var a=e.originX,r=e.originY,s=Utils.DeviceUtils.curWidth(),c=e.width,l=e.height;e.uia_flyIning=!0,o?1===t?egret.Tween.get(e).to({x:-c-a},i,egret.Ease.circOut).call(function(){e.x=a,e.uia_flyIning=!1,n()}):2===t?egret.Tween.get(e).to({x:s+c},i,egret.Ease.circOut).call(function(){e.x=a,e.uia_flyIning=!1,n()}):egret.Tween.get(e).to({y:r+l},i,egret.Ease.backIn).call(function(){e.y=r,e.uia_flyIning=!1,n()}):1===t?(e.x=-c-a,egret.Tween.get(e).to({x:a},i,egret.Ease.circIn).call(function(){e.uia_flyIning=!1,n()})):2===t?(e.x=s+c,egret.Tween.get(e).to({x:a},i,egret.Ease.circIn).call(function(){e.uia_flyIning=!1,n()})):(e.y=r+l,egret.Tween.get(e).to({y:r},i,egret.Ease.backOut).call(function(){e.uia_flyIning=!1,n()}))}},_.fadeIn=function(e,t,i,n){void 0===n&&(n=!1),egret.Tween.removeTweens(e),n?(e.alpha=1,egret.Tween.get(e).to({alpha:0},t,egret.Ease.circOut).call(function(){i&&i()})):(e.alpha=0,egret.Tween.get(e).to({alpha:1},t,egret.Ease.circOut).call(function(){i&&i()}))},_.shineIn=function(t,i,e,n){if(e){var o=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],a=new egret.ColorMatrixFilter(o);t.filters=[a];var r=void 0;r=egret.setInterval(function(){var e=a.matrix;255<e[4]+50?(t.filters=[],egret.clearInterval(r),i&&i()):(e[4]+=50,e[9]+=50,e[14]+=50),a.matrix=e},this,n||100)}else{o=[1,0,0,0,255,0,1,0,0,255,0,0,1,0,255,0,0,0,1,0];var s=new egret.ColorMatrixFilter(o);t.filters=[s];var c=void 0;c=egret.setInterval(function(){var e=s.matrix;e[4]-50<0?(t.filters=[],egret.clearInterval(c),i&&i()):(e[4]-=50,e[9]-=50,e[14]-=50),s.matrix=e},this,n||100)}},_.douDong=function(e){egret.Tween.removeTweens(e);var t=e.anchorOffsetX,i=e.anchorOffsetY;e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=e.x+(e.anchorOffsetX-t),e.y=e.y+(e.anchorOffsetY-i),e.once(egret.Event.REMOVED_FROM_STAGE,function(){egret.Tween.removeTweens(e)},this),egret.Tween.get(e,{loop:!0}).to({rotation:7},100).to({rotation:-14},200).to({rotation:0},100).to({rotation:7},100).to({rotation:-14},200).to({rotation:0},100).wait(700)},_.jumping=function(e){e&&e.parent&&(egret.Tween.removeTweens(e),e.scaleX=e.originScaleX||1,e.scaleY=e.originScaleY||1,e.hasEventListener(egret.Event.REMOVED_FROM_STAGE)||e.once(egret.Event.REMOVED_FROM_STAGE,function(){egret.Tween.removeTweens(e)},this),egret.Tween.get(e,{loop:!0}).to({y:e.y-5},400).wait(100).to({y:e.y},400))},_.addEffect=function(t,e,i,n){t&&e&&(!t.armature123||i&&i.multi?DragonBoneTools.create(e,function(e){(!t.armature123||i&&i.multi)&&((t.armature123=e).x=t.width/2+(i&&i.offectX||0),e.y=t.height/2+(i&&i.offectY||0),i?(i.scaleX&&(e.scaleX=i.scaleX),i.scaleY&&(e.scaleY=i.scaleY),i.childIndex||0==i.childIndex?t.addChildAt&&t.addChildAt(e,i.childIndex):t.addChild&&t.addChild(e)):t.addChild&&t.addChild(e),e.animation.play(),n&&n(e))},this):t.armature123.visible=!0)},_.hideEffect=function(e,t){if(e&&e.armature123)return e.armature123.visible=!1,void(t&&t())},_.removeEffect=function(e,t){if(e&&e.armature123)return e.removeChild(e.armature123),void(t&&t())}}(UIActionManager||(UIActionManager={}));var UnlockMgr=function(i){function e(){var e=i.call(this)||this;for(var t in e.lockByServer={},e.__unlockCache={},e.__forceUnlockModule={},e.test=!1,e.playerProxy=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N),e.guildProxy=game.AppFacade.getInstance().retrieveProxy(game.GuildPy.N),e.taskProxy=game.AppFacade.getInstance().retrieveProxy(game.TaskPy.N),e.championPy=game.AppFacade.getInstance().retrieveProxy(game.ChampionPy.N),UnlockType)e.__unlockCache[UnlockType[t]]={};return e}return __extends(e,i),e.prototype.forceChangeUnlockInfo=function(e,t){this.__forceUnlockModule[e]=t},e.prototype.checkPass=function(e,t){var i,n=this;if(void 0===t&&(t=!0),i={condition:void 0,id:e,allow:!0,ext:{tips:void 0,requestLevel:void 0}},this.skipAllCheckForDebug||!game.Config.unlockConfig())return i;if(1==this.__forceUnlockModule[e])return i;var o=void 0,a=game.Config.unlockConfig(e);return a&&(this.lockByServer[e]?(i.allow=!1,i.ext.tips="未开启",i.ext.lockType="server"):(o=JSON.parse(a.condition),this.__unlockCache[o[0]][e]?i=this.__unlockCache[o[0]][e]:(!function(e){switch(i.condition=e[0],e[0]){case UnlockType.Level:n.playerProxy.playerInfoVO.level<e[1]&&(i.allow=!1),i.ext.requestLevel=e[1],i.ext.tips="角色等级"+e[1]+"级解锁";break;case UnlockType.GuildLevel:(!n.guildProxy.isInGuild()||n.guildProxy.guildDetail.level<e[1])&&(i.allow=!1),i.ext.requestLevel=e[1],i.ext.tips="公会"+e[1]+"级解锁";break;case UnlockType.VipLevel:n.playerProxy.playerInfoVO.playerVip.vipLevel<e[1]&&(i.allow=!1),i.ext.viplevel=e[1],i.ext.tips="VIP"+i.viplevel+"解锁";break;case UnlockType.LevelOrVipLevel:n.playerProxy.playerInfoVO.level<e[1]&&n.playerProxy.playerInfoVO.playerVip.vipLevel<e[2]?i.allow=!1:n.playerProxy.playerInfoVO.level==e[1]&&(i.isCurLevelUnlock=!0),i.ext.requestLevel=e[1],i.ext.viplevel=e[2],i.ext.tips=e[1]+"级或VIP"+e[2]+"解锁";break;case UnlockType.LevelAndVipLevel:n.playerProxy.playerInfoVO.level<e[1]||n.playerProxy.playerInfoVO.playerVip.vipLevel<e[2]?i.allow=!1:n.playerProxy.playerInfoVO.level==e[1]&&(i.isCurLevelUnlock=!0),i.ext.requestLevel=e[1],i.ext.viplevel=e[2],i.ext.tips=e[1]+"级及VIP"+e[2]+"解锁";break;case UnlockType.ChampionNum:n.championPy.championInfo.id-1<e[1]&&(i.allow=!1),i.ext.requestLevel=e[1],i.ext.tips="爬塔通关至"+e[1]+"关解锁";break;case UnlockType.Task:case UnlockType.VipLevelTask:break;case UnlockType.ServerOpenDay:i.allow=Utils.TimerManager.getServerOpenDays()>e[1],i.ext.tips="开服第"+(e[1]+1)+"天解锁",i.ext.needOpen=e[1],i.ext.openDt=Utils.TimerManager.getTimeInDaysAfterServerOpen(e[1]);break;case UnlockType.LevelAndServerOpenDay:i.allow=Utils.TimerManager.getServerOpenDays()>e[1]&&n.playerProxy.playerInfoVO.level>=e[2],i.ext.tips="开服第"+(e[1]+1)+"天且角色等级"+e[2]+"级解锁",i.ext.needOpen=e[1],i.ext.requestLevel=e[2],i.ext.openDt=Utils.TimerManager.getTimeInDaysAfterServerOpen(e[1]);break;case UnlockType.Enable:i.allow=!1,i.ext.tips="敬请期待"}}(o),this.__unlockCache[o[0]][e]=i))),t&&!i.allow&&Utils.MsgUtils.addMidMsg(i.ext.tips),i},e.prototype.getOpenInfo=function(e){var t=Utils.UnlockMgr.checkPass(e,!1),i=game.Config.entranceTimeConfig()[e],n=Utils.TimerManager.checkIsOpen_FormatA(JSON.parse(i.timeConfig)[0]);for(var o in t)n[o]=t[o];return n},e.prototype.addReleaseEvent=function(e,t,i,n){var o=this;e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.checkPass(t).allow&&i(n)},n)},e.prototype.clearCacheByType=function(e){var t=this;e.forEach(function(e){t.__unlockCache[e]={}})},e.prototype.clearLockedInfoByType=function(e){var n=this;e.forEach(function(e){var t=n.__unlockCache[e];for(var i in t)t[i].allow||delete t[i]})},e}(BaseClass);__reflect(UnlockMgr.prototype,"UnlockMgr"),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e._originalLength=9999999999,e.initDataProvider=!1,e.initItemrender=!1,e._itemWidth=0,e._needAutoScroll=!1,e._needCycle=!1,e.curSelectIndex=0,e.choseImgId="choseImg26465146813",e.choseImgSource="",e.delayChange=!1,e.skinName="CommonArrayListSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;this.sl_root.horizontalScrollBar.visible=!1,this.sl_root.horizontalScrollBar.autoVisibility=!1,this.img_lastOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.changeSelectIndex(-1,!0)},this),this.img_nextOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.changeSelectIndex(1,!0)},this),UIActionManager.bindClickAction(this.img_lastOne),UIActionManager.bindClickAction(this.img_nextOne),this.needAutoScroll=!1,this.changeSelectIndex(0,!1)},Object.defineProperty(e.prototype,"dataProvider",{get:function(){return this.list_root.dataProvider},set:function(e){var t=this;this._needCycle&&(this._originalLength=e.length||this._originalLength,e.addEventListener(eui.CollectionEvent.COLLECTION_CHANGE,function(){t._originalLength=e.length/3},this)),this.list_root.dataProvider=e,this.initDataProvider=!0,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"itemRenderer",{get:function(){return this.list_root.itemRenderer},set:function(e){this.list_root.itemRenderer=e,this.initItemrender=!0,this._itemWidth=e.itemWidth,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layout",{get:function(){return this.list_root.layout},set:function(e){e&&e!=this.list_root.layout&&(this.list_root.layout=e,this.updateView())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needAutoScroll",{get:function(){return this._needAutoScroll},set:function(e){this._needAutoScroll=!!e,this._needAutoScroll?this.sl_root.addEventListener(eui.UIEvent.CHANGE_END,this.autoScroll,this):this.sl_root.hasEventListener(eui.UIEvent.CHANGE_END)&&this.sl_root.removeEventListener(eui.UIEvent.CHANGE_END,this.autoScroll,this)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needCycle",{get:function(){return this._needCycle},set:function(e){this._needCycle=e,this._needCycle?this.sl_root.addEventListener(eui.UIEvent.CHANGE_END,this.cycleChange,this):this.sl_root.hasEventListener(eui.UIEvent.CHANGE_END)&&this.sl_root.removeEventListener(eui.UIEvent.CHANGE_END,this.cycleChange,this)},enumerable:!0,configurable:!0}),e.prototype.updateView=function(){return!(!this.initItemrender||!this.initDataProvider)&&(!(this.list_root.dataProvider.length<=0)&&(this.validateNow(),void this.changeSelectIndex(0)))},e.prototype.changeSelectIndex=function(e,t){if(void 0===t&&(t=!1),!this.initItemrender||!this.initDataProvider)return!1;if(this.list_root.dataProvider.length<=0)return!1;var i=this.curSelectIndex+e;i<0&&(i=0),i>this.list_root.dataProvider.length-1&&(i=this.list_root.dataProvider.length-1);var n=this.list_root.getVirtualElementAt(this.curSelectIndex);n&&((a=n.gp_forChoseFrame?n.gp_forChoseFrame:n)&&a[this.choseImgId]&&(a[this.choseImgId].visible=!1));var o=this.list_root.getVirtualElementAt(i);if(o){var a;if((a=o.gp_forChoseFrame?o.gp_forChoseFrame:o)[this.choseImgId])a[this.choseImgId].visible=!0;else{var r=this.makeChoseFrame();a.addChild(r),a[this.choseImgId]=r}var s=(this.list_root.layout.gap+this._itemWidth)*i;this.sl_root.viewport.scrollH=s-(this.sl_root.width-this._itemWidth)/2,this.sl_root.viewport.scrollH<0&&(this.sl_root.viewport.scrollH=0),this.sl_root.viewport.scrollH>this.list_root.width-this.sl_root.width&&(this.sl_root.viewport.scrollH=this.list_root.width-this.sl_root.width),this.curSelectIndex=i,t&&this.itemTapCB&&this.callItemTapCB(this.curSelectIndex)}var c=this.sl_root.viewport.contentWidth<=this.sl_root.width;this.img_lastOne.visible=0!=i&&!c,i==this.dataProvider.length-1||c?this.img_nextOne.visible=!1:this.img_nextOne.visible=!0,this.sl_root.scrollPolicyH=c?eui.ScrollPolicy.OFF:eui.ScrollPolicy.AUTO},e.prototype.changeTo=function(e){e.itemIndex<0&&(e.itemIndex=0),e.itemIndex>this.list_root.dataProvider.length-1&&(e.itemIndex=this.list_root.dataProvider.length-1),this.callItemTapCB(e.itemIndex),this.changeSelectIndex(e.itemIndex-this.curSelectIndex,!0)},e.prototype.addItemTapEvent=function(e,t){var i=this;this.list_root.hasEventListener(eui.ItemTapEvent.ITEM_TAP)||(this.itemTapCB=e,this.itemTapCB_thisObj=t,this.list_root.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){i.callItemTapCB(e.itemIndex),i.changeSelectIndex(e.itemIndex-i.curSelectIndex,!0)},this))},e.prototype.setChoseFrame=function(e){this.choseImgSource=e},e.prototype.makeChoseFrame=function(){var e=new eui.Image(this.choseImgSource);return e.pixelHitTest=!0,e.touchEnabled=!1,e.top=e.bottom=e.left=e.right=0,e.id=this.choseImgId,e},e.prototype.autoScroll=function(){var e=this.list_root.layout.gap,t=this.list_root.layout.paddingLeft,i=this._itemWidth,n=this.sl_root.viewport.scrollH-t+this.sl_root.width/2,o=Math.floor(n/(i+e));this.changeSelectIndex(o-this.curSelectIndex,!0)},e.prototype.cycleChange=function(){var e=this.sl_root.viewport.scrollH,t=this.list_root.width+this.list_root.layout.gap;t/3/2+t/3*2<e?this.sl_root.viewport.scrollH=e-t/3:e<t/3/2&&(this.sl_root.viewport.scrollH=e+t/3)},e.prototype.callItemTapCB=function(e){this._needCycle?this.itemTapCB.call(this.itemTapCB_thisObj,{itemIndex:e%this._originalLength}):this.itemTapCB.call(this.itemTapCB_thisObj,{itemIndex:e})},e.prototype.initChangeTo=function(e,t){var i=this;void 0===t&&(t=!1),this.delayChange&&!t||(this.delayChange=!0,this.once(egret.Event.ENTER_FRAME,function(){i.changeTo({itemIndex:e})},this))},e}(eui.Component);e.CommonArrayList=t,__reflect(t.prototype,"customui.CommonArrayList",["eui.UIComponent","egret.DisplayObject"])}(customui||(customui={}));var WebMgrQQZone=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.prototype.init=function(){var t=this;n.prototype.init.call(this),egret.log("QQ玩吧"),window.__paySuccess=function(){e.invoke("ui","showDialog",{text:"充值成功",needOkBtn:!0,needCancelBtn:!1,okBtnText:"关闭"},function(e){})},window.__payError=function(){"PC"==getUrlKV().qua.app||"WX"==getUrlKV().channel||"xinYueClub"==getUrlKV().channel||"QQLive"==getUrlKV().channel?Utils.MsgUtils.addMidMsg("支付失败了！"):e.invoke("ui","showDialog",{text:"支付失败",needOkBtn:!0,needCancelBtn:!1,okBtnText:"关闭"},function(e){})},window.__payClose=function(){"PC"==getUrlKV().qua.app||"WX"==getUrlKV().channel||"xinYueClub"==getUrlKV().channel||"QQLive"==getUrlKV().channel?Utils.MsgUtils.addMidMsg("支付取消了！"):e.invoke("ui","showDialog",{text:"支付取消",needOkBtn:!0,needCancelBtn:!1,okBtnText:"关闭"},function(e){})};var e=window.mqq;e&&(window.mqq.invoke("ui","setOnShareHandler",function(e){0==e&&"SQ"==getUrlKV().qua.app?window.mqq.ui.shareArkMessage({title:Utils.agentConfig.htmlName||"",desc:CHAT_RANDOM_CONTENT[Utils.MathUtils.getRandomInt(0,CHAT_RANDOM_CONTENT.length-1)],share_url:getUrlKV().shareurl,image_url:getUrlKV().appicon,back:!0},function(e){e&&0==e.retCode&&0==e.retCode&&game.GameMVC.activityPy.getOperationReward(OperationType.Act_Share)}):window.mqq.invoke("ui","shareMessage",{title:Utils.agentConfig.htmlName||"",desc:CHAT_RANDOM_CONTENT[Utils.MathUtils.getRandomInt(0,CHAT_RANDOM_CONTENT.length-1)],share_type:e,share_url:getUrlKV().shareurl,image_url:getUrlKV().appicon,back:!0},function(e){egret.log("分享结果",e),0==e.retCode&&game.GameMVC.activityPy.getOperationReward(OperationType.Act_Share)})}),window.mqq.invoke("ui","setOnAddShortcutHandler",{callback:window.mqq.callback(function(){window.mqq.ui.addShortcut({action:"web",title:Utils.agentConfig.htmlName||"",icon:getUrlKV().appicon,url:getUrlKV().jumpurl,callback:function(e){if(egret.log("生成桌面入口结果",e),0==e.result){game.AppFacade.getInstance().retrieveProxy(game.ActivityPy.N);game.GameMVC.activityPy.getOperationReward(OperationType.Act_ShouCangYouLi)}}})},!1,!0)})),window.getOpenKey(function(e){getUrlKV().openkey=e.data.openkey,t.getVIPInfo()}),getUrlKV().switchRechargeType=2==window.OPEN_DATA.platform;var i=window.innerHeight/window.innerWidth;if(2.08<i&&(getUrlKV().statusBarHeight=64),"xinYueClub"==getUrlKV().channel&&(getUrlKV().statusBarHeight=45),2==window.OPEN_DATA.platform){Utils.agentConfig.AgentCode=Utils.agentConfig.AgentCodeSwitch;window.innerHeight,window.innerWidth;2.08<i&&(getUrlKV().statusBottomHeight=28)}Utils.agentConfig.isChecking.isExtra&&(getUrlKV().sdk_custom1_config={enter_icon:"common_icon_diaochawenjuan_png",canShow:!0,cb:function(){t.extraFuncForAgent({type:"openUrl",params:{url:"https://www.wenjuan.com/s/VNFrYj/"}}),game.GameMVC.activityPy.getOperationReward(7)}})},e.prototype.goSwitchAccount=function(){-1===game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N).userVO.loginState?this.goLogin():Utils.SDKMgr.cmd({type:"SwitchAccount"})},e.prototype.goLogin=function(){var e=this;login({cb:function(){egret.log("html登录回调"),egret.log(getUrlKV()),e.callJS(JSON.stringify({method:"loginCB",game_uin:getUrlKV().game_uin,username:getUrlKV().username||getUrlKV().game_uin,verify_token:getUrlKV().token,login_ext:getUrlKV().login_ext}))}})},e.prototype.enterFlow=function(e,t){var i=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N),n=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N),o=game.AppFacade.getInstance().retrieveProxy(game.GuildPy.N),a={serverId:i.serverSelect&&i.serverSelect.area,serverName:i.serverSelect&&i.serverSelect.s_name,severFlag:i.serverSelect&&i.serverSelect.s_id,playerName:n.roleVo.name,roleId:n.roleVo.playerId,roleCreateDt:n.roleVo.createDt,time:Utils.TimerManager.getServerTime(),money:n.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeDiamond],level:n.playerInfoVO.level,vipLevel:n.playerInfoVO.playerVip.vipLevel,fightCap:n.playerInfoVO.fightCap,camp:n.playerInfoVO.camp&&1==n.playerInfoVO.camp?"male":"famale",guildId:o.guildDetail?o.guildDetail.guildId:"",guildName:o.guildDetail?o.guildDetail.name:"",params:t,type:""};Utils.SDKMgr.cmd({type:"DeliverData",params:{type:e,data:a}}),a.type=e,Utils.agentConfig.other.isReport&&this.invokeLog(a)},e.prototype.invokeLog=function(e){var i=this,t=e.type,n=getUrlKV(),o="https://report.8zy.com/report/",a=function(e){o+=e;var t=new egret.HttpRequest;t.responseType=egret.HttpResponseType.TEXT;t.addEventListener(egret.Event.COMPLETE,function(e){console.log(o),console.log(e)},i),t.open(o,"get"),egret.log("toGet",o),t.send()};switch(t){case"CreateRole":a("regchar/"+n.appid+"/"+n.pf+"/"+n.openid+"/"+n.via),egret.setTimeout(function(){window.reportRegister&&window.reportRegister()},this,2e3);break;case"EnterMain":window.reportLogin&&window.reportLogin(),a("login/"+n.appid+"/"+n.pf+"/"+n.openid+"/"+n.via);break;case"Purchased":var r=e.data.params.money;a("pay/"+n.appid+"/"+n.pf+"/"+n.openid+"/"+r+"/0/"+n.via)}},e.prototype.goPurchase=function(e){Utils.SDKMgr.getPerformConfig(1)?Utils.MsgUtils.addMidMsg("暂未开放"):sdkPay(e)},e.prototype.restart=function(){restart()},e.prototype.cmd=function(e,t){cmd(e,t)},e.prototype.copyToClipBoard=function(e,t){Utils.DeviceUtils.copyToClipboardByDOM(e,t)},e.prototype.nodeRecord=function(e){nodeRecord(e)},e.prototype.getChannelName=function(){},e.prototype.share=function(e,t){var i=getUrlKV(),n=window.mqq;"SQ"==i.qua.app?n.ui.shareArkMessage({title:e&&e.title||Utils.agentConfig.htmlName||"",desc:e&&e.desc||CHAT_RANDOM_CONTENT[Utils.MathUtils.getRandomInt(0,CHAT_RANDOM_CONTENT.length-1)],share_url:i.shareurl,image_url:i.appicon,back:!0},function(e){egret.log("分享结果",e),t&&t(e.retCode)}):"PC"==i.qua.app||"WX"==i.qua.app?window.mqq.ui.shareMessage({title:e&&e.title||Utils.agentConfig.htmlName||"",desc:e&&e.desc||CHAT_RANDOM_CONTENT[Utils.MathUtils.getRandomInt(0,CHAT_RANDOM_CONTENT.length-1)],share_type:0,share_url:i.shareurl,image_url:i.appicon,back:!0},function(e){egret.log("分享结果",e),t&&t(e.retCode)}):n.ui.showShareMenu({title:e&&e.title||Utils.agentConfig.htmlName||"",desc:e&&e.desc||CHAT_RANDOM_CONTENT[Utils.MathUtils.getRandomInt(0,CHAT_RANDOM_CONTENT.length-1)],share_url:i.shareurl,image_url:i.appicon},function(e){egret.log("分享结果",e),t&&t(e.retCode)})},e.prototype.addShortcut=function(e,t){window.mqq.ui.addShortcut({action:"web",title:e&&e.title||Utils.agentConfig.htmlName,icon:e.icon||getUrlKV().appicon,url:e.url||getUrlKV().jumpurl,callback:function(e){egret.log("生成桌面入口结果",e),0==e.result&&t&&t(e.result)}}),2==getUrlKV().platform&&t&&t(0)},e.prototype.getVIPInfo=function(){Utils.Http.toGet({action:"get_vipLev",appid:getUrlKV().appid,openid:getUrlKV().openid,openkey:getUrlKV().openkey,pf:getUrlKV().pf,gift_id:getUrlKV().GIFT}).then(function(e){console.log("error vip code  = ",e.vip.ret),console.log("error gift code  = ",e.gift.ret),getUrlKV().giftRet=e.gift,0==e.vip.ret&&(getUrlKV().QQVipLevel=e.vip.level)}).catch(function(){})},e.prototype.extraFuncForAgent=function(t){var e=t&&t.type,i=t.params,n=!1,o=Utils.agentConfig.other.packName||"";switch(e){case"PChutong":break;case"appDownload":window.mqq.app.isAppInstalled(o,function(e){console.log("is install: "+e),1==(n=e)&&t&&t.cb&&t.cb&&t.cb(n)});break;case"isGameApp":n=window.mqq.isGameApp;break;case"followAccount":getUrlKV().isFollowingAccount;break;case"canShow":n=window.mqq.data.canIShow(i&&i.type);break;case"openUrl":window.mqq.invoke("ui","openUrl",{url:i&&i.url,target:1,style:1}),n=!0}return n},e}(WebMgr);__reflect(WebMgrQQZone.prototype,"WebMgrQQZone");var WebMgrXYX=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(){e.prototype.init.call(this),egret.log("微信小游戏"),window.xyxPlatform.init(),window.xyxPlatform&&window.urlKV&&(4==Utils.DeviceUtils.getPlatform()&&"qqzone"==Utils.agentConfig.AgentCode&&(Utils.agentConfig.AgentCode="qqzone_ios"),window.urlKV.os_code=Utils.DeviceUtils.getPlatform(),window.urlKV.platform=Utils.agentConfig.AgentCode)},t.prototype.goSwitchAccount=function(){-1===game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N).userVO.loginState?this.goLogin():Utils.SDKMgr.cmd({type:"SwitchAccount"})},t.prototype.onLoginPHPSuccess=function(){window.xyxPlatform.onLoginPHPSuccess()},t.prototype.showLoadingTips=function(e,t){window.xyxPlatform.showLoadingTips(e,t)},t.prototype.dismissLoading=function(){window.xyxPlatform.dismissLoading()},t.prototype.goLogin=function(){var e=this;window.xyxPlatform.login(function(){egret.log("html登录回调"),egret.log(getUrlKV()),e.callJS(JSON.stringify({method:"loginCB",game_uin:getUrlKV().game_uin,username:getUrlKV().username||getUrlKV().game_uin,verify_token:getUrlKV().token,login_ext:getUrlKV().login_ext}))})},t.prototype.invokeLog=function(e){},t.prototype.goPurchase=function(e){e.ext=e.serialNumber,window.xyxPlatform.goPurchase(e)},t.prototype.restart=function(){window.xyxPlatform.restart()},t.prototype.cmd=function(e,t){window.xyxPlatform.cmd(e,t)},t.prototype.copyToClipBoard=function(e,t){window.xyxPlatform.setClipboardData&&window.xyxPlatform.setClipboardData(e,t)},t.prototype.nodeRecord=function(e){window.xyxPlatform.nodeRecord(e)},t.prototype.getChannelName=function(){},t.prototype.share=function(e,t){window.xyxPlatform.share(e,t)},t.prototype.addShortcut=function(e,t){},t}(WebMgr);__reflect(WebMgrXYX.prototype,"WebMgrXYX"),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.labelPool=[],e.duration=5e3,e.curIndex=0,e.skinName="CommonBarrage",e}return __extends(e,t),e.prototype.defaultStart=function(e){void 0===e&&(e=[])},e.prototype.addOneMsg=function(e){var t=this;if(e&&e.text){var i=e.startX||this.gp_msg.width,n=e.startY||Math.random()*this.gp_msg.height,o=this.getLabel(e.text);o.x=i,o.y=n,this.gp_msg.addChild(o),egret.Tween.get(o).to({x:-o.textWidth},e.duration||this.duration).call(function(){t.gp_msg.removeChild(o),t.labelPool.push(o),e.doneCB&&e.doneCB()})}},e.prototype.addOneMsgAutoFormat=function(e){var t=this;if(e&&e.text){var i=this.getLabel(e.text),n=this.gp_msg.$children[this.gp_msg.numChildren-1];n?(i.x=Math.max(n.x+n.textWidth/4,this.gp_msg.width),i.y=this.curIndex%(this.height/(e.textHeight||45))*(e.textHeight||45)):(i.x=this.width,i.y=0),console.log(i.x+":"+i.y,n&&n.textWidth),this.gp_msg.addChild(i),this.duration=(i.x+i.textWidth)/(e.speed||200)*1e3,egret.Tween.get(i).to({x:-i.textWidth},this.duration).call(function(){t.gp_msg.removeChild(i),0==t.gp_msg.numChildren&&(t.curIndex=0),t.labelPool.push(i),e.doneCB&&e.doneCB()}),this.curIndex++}},e.prototype.getLabel=function(e){var t;return t=0<this.labelPool.length?this.labelPool.shift():new eui.Label,"string"==typeof e?t.text=e:"object"==typeof e?t.textFlow=e:console.log("弹幕数据类型错误"),t},e}(eui.Component);e.CommonBarrage=t,__reflect(t.prototype,"customui.CommonBarrage",["eui.UIComponent","egret.DisplayObject"])}(customui||(customui={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.data=e,t.skinName="CommonBtnWithNumSkin",t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.cui_freshCost.scaleX=e.cui_freshCost.scaleY=.63,e.cui_freshCost.left=40},this),this.addEventListener(egret.TouchEvent.TOUCH_END,function(){e.cui_freshCost.scaleX=e.cui_freshCost.scaleY=.9,e.cui_freshCost.left=23},this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){e.cui_freshCost.scaleX=e.cui_freshCost.scaleY=.9,e.cui_freshCost.left=23},this),this.updateData()},e.prototype.updateData=function(e){if(this.data=e,this.data){var t=this.data.cost;t?(this.cui_freshCost.visible=!0,this.cui_freshCost.updateItem({cost:t}),this.data.text&&(this.btn_oppr.label="    "+this.data.text)):(this.cui_freshCost.visible=!1,this.data.text&&(this.btn_oppr.label=""+this.data.text))}},e}(eui.Component);e.CommonBtnWithNum=t,__reflect(t.prototype,"customui.CommonBtnWithNum")}(customui||(customui={}));var DynamicChange=function(){function e(){this._dataCache=[],this._pUpdate=new ProxyUpdate(this._dataCache)}return Object.defineProperty(e.prototype,"pUpdate",{get:function(){return this._pUpdate},enumerable:!0,configurable:!0}),e.prototype.getCacheData=function(e){return this._dataCache[e]?this._dataCache[e]:null},e.prototype.clearCache=function(){for(var e=Object.keys(this._dataCache),t=0,i=e.length;t<i;t++){var n=e[t];this._dataCache[n]=null,delete this._dataCache[n]}},e.prototype.getCacheKeyInfos=function(){for(var e=[],t=Object.keys(this._dataCache),i=0,n=t.length;i<n;i++){var o=t[i],a=this._dataCache[o];e.push(a)}return e},e.prototype.isCache=function(e){return this._dataCache[e]},e}();__reflect(DynamicChange.prototype,"DynamicChange");var ProxyUpdate=function(){function e(e){this._cache=e}return e.prototype.isArray=function(e){return e instanceof Array},e.prototype.isObject=function(e){return-1<e.indexOf("object")},e.prototype.isNormal=function(e){var t=-1<e.indexOf("@"),i=-1<e.indexOf("."),n=-1<e.indexOf("_");return!t&&!i&&!n},e.prototype.isAddToArray=function(e){return"@a"==e},e.prototype.isRemoveToArray=function(e){var t=e.split("_");return t.length<=3&&"@d"==t[0]},e.prototype.isFilter=function(e){return"@f"==e.split("_")[0]},e.prototype.isNumeric=function(e){return parseFloat(e).toString()==e.toString()},e.prototype._updateObject=function(e,t,i){var n=e.split(".");"@a"==n[0]||"@s"==n[0]?i[n[1]]=t:"@d"==n[0]&&delete i[n[1]]},e.prototype._getFilterObject=function(e,t){if(t){var i=e.split("_");if(3==i.length&&"@f"==i[0]&&this.isArray(t))for(var n=i[1],o=i[2],a=0;a<t.length;a++){var r=t[a];if(3==i.length&&this.isObject(r.toString())){var s=r[n];if(s&&("@"==o[0]&&(o=o.replace("@","")),o==s))return r}}}return null},e.prototype._addObjectToArray=function(e,t){if(this.isArray(t))for(var i=0;i<t.length;i++)e.push(t[i]);else e.push(t)},e.prototype._removeObjectFromArray=function(e,t,i){var n=t.split("_");if(n.length<=3&&"@d"==n[0]&&this.isArray(e))for(var o=e.length-1;0<=o;o--){var a=e[o];if(3==n.length){if(a.hasOwnProperty(n[1])){var r=n[2];"@"==r[0]&&(r=r.replace("@","")),r==a[n[1]]&&e.splice(o,1)}}else 2==n.length&&a.hasOwnProperty(n[1])?i==a[n[1]]&&e.splice(o,1):1==n.length&&i==a&&e.splice(o,1)}},e.prototype.update=function(e,t){if((this._cache[e]=t).hasOwnProperty("c"))for(var i=t.c,n=Object.keys(i),o=0,a=n.length;o<a;o++){var r=n[o];this._cache[r]&&(this._update(this._cache[r],i[r]),game.AppFacade.getInstance().sendNotification(r+"_HttpUpdate"))}},e.prototype._update=function(e,t){if(e&&t&&this.isObject(t.toString()))for(var i=Object.keys(t),n=0,o=i.length;n<o;n++){var a=i[n],r=t[a];if(this.isNormal(a)&&this.isObject(r.toString()))e.hasOwnProperty(a)&&this._update(e[a],r);else if(this.isNormal(a)&&this.isNumeric(r)){var s=e[a];e[a]=s+r}else if(this.isNormal(a))e[a]=r;else if(this.isAddToArray(a))this._addObjectToArray(e,r);else if(this.isRemoveToArray(a))this._removeObjectFromArray(e,a,r);else if(this.isFilter(a)){var c=this._getFilterObject(a,e);c&&this._update(c,r)}else this._updateObject(a,r,e)}},e}();__reflect(ProxyUpdate.prototype,"ProxyUpdate");var Http=function(t){function i(){var e=t.call(this)||this;return e.loginKey="507310f58a0ac8e3d8ad8f60c8b85b46"+Utils.agentConfig.ProjectName,e.reg=/[^\u4e00-\u9fa5a-zA-Z0-9]/gi,e}return __extends(i,t),i.prototype.dump=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log(""+i.LOG_TAG,e)},i.prototype.initServer=function(e){this._serverUrl=e},i.prototype.decorateParams=function(e,t,i){var n="",o=1;t&&this.decorateCommonParams(e);var a=Object.keys(e).sort();for(var r in a)n=1==o?i==egret.HttpMethod.GET?n+"?"+a[r]+"="+e[a[r]]:n+(a[r]+"=")+e[a[r]]:n+"&"+a[r]+"="+e[a[r]],o++;var s="";return s="?"==n.charAt(0)?n.substring(1)+this.loginKey:n+this.loginKey,egret.log("strMd5",s),n+"&sign="+(new md5).hex_md5(s).toLowerCase()},i.prototype.decorateUrl=function(e,t,i){return void 0===i&&(i=egret.HttpMethod.GET),Utils.agentConfig.HttpSerever+this.decorateParams(e,t,i)},i.prototype.toGet=function(i,n){return void 0===n&&(n=!0),__awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=this.decorateUrl(i,n),[2,this.getByUrl(t)]})})},i.prototype.getByUrl=function(a){return __awaiter(this,void 0,void 0,function(){var n,o=this;return __generator(this,function(e){switch(e.label){case 0:return a=encodeURI(a),(n=new egret.HttpRequest).responseType=egret.HttpResponseType.TEXT,[4,new Promise(function(i,t){n.addEventListener(egret.Event.COMPLETE,function(e){var t=n.data?n.data:n.response;try{i(t&&""!=t&&JSON.parse(t))}catch(e){i(t)}},o),n.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){t(e)},o),n.open(a,"get"),egret.log("toGet",a),n.send()}).catch(function(e){o.dump("exception",e.message)})];case 1:return[2,e.sent()]}})})},i.prototype.decorateCommonParams=function(e){e.serVer=Utils.agentConfig.CodeVersion,e.os_code=Utils.DeviceUtils.getPlatform(),e.platform=Utils.agentConfig.AgentCode,e.project=Utils.agentConfig.ProjectName,e.subPlatform=Utils.agentConfig.channelName,e.time=Date.now()},i.prototype.toPost=function(t,r){return __awaiter(this,void 0,void 0,function(){var o,a=this;return __generator(this,function(e){return o=this.decorateParams(t,!1,egret.HttpMethod.POST),r=encodeURI(r),egret.log("toPost",r,o),[2,new Promise(function(i,t){var n=new egret.HttpRequest;n.responseType=egret.HttpResponseType.TEXT,n.withCredentials=!1,n.open(r,egret.HttpMethod.POST),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),n.send(o);n.addEventListener(egret.Event.COMPLETE,function(e){egret.log("onSuccess ret",e);var t=n.data?n.data:n.response;egret.log("data",t);try{i(t&&""!=t&&JSON.parse(t))}catch(e){i(t)}},a),n.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){t(e)},a)})]})})},i.prototype.checkStrLegal=function(e,t,i){return null!=i?e.replace(this.reg,i):!e.match(this.reg)||!t||(Utils.MsgUtils.addMidMsg("不能包含特殊字符"),!1)},i.LOG_TAG="<--\x3eHttp<--\x3e:",i}(BaseClass);__reflect(Http.prototype,"Http"),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.data=e,t.skinName="CommonCostBtnSkin",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.updateData()},e.prototype.updateData=function(e){if(this.data=e||this.data,this.data){var t=this.data.cost;t&&(this.CommonIconWithNum.visible=!0,this.CommonIconWithNum.updateItem({cost:t,style:CommonIconStyle.RIGHT}))}},e}(eui.Component);e.CommonCostBtn=t,__reflect(t.prototype,"customui.CommonCostBtn")}(customui||(customui={}));var ByteArrayMsgByJSProtobuf=function(t){function e(){var e=t.call(this)||this;return e.pbObjs=null,e.ids=null,e.pbObjs=protobuf.roots.default,e.ids=RES.getRes("package_json"),e}return __extends(e,t),e.prototype.resolvePBNSByID=function(e){return{name:"N"+e,pretty_name:this.ids[e]}},e.prototype.resolvePBClassByID=function(e,t){var i=this.resolvePBNSByID(e);return{name:"C"+t,pretty_name:this.ids[i.pretty_name].id2s[t]}},e.prototype.resolvePBNSByName=function(e){var t=this.ids[e].id;return{id:t,name:"N"+t}},e.prototype.resolvePBClassByName=function(e,t){var i=this.ids[e].id2s[t];return{id:i,name:"C"+i}},e.prototype.receive=function(e){var t;this._msgBuffer.clear(),e.readBytes(this._msgBuffer);try{t=this.decode(this._msgBuffer)}catch(e){return void console.log("协议解析失败",e)}if(t){var i=t.id1Str+"."+t.id2Str,n=t.ssid;if(i)if(0==i.indexOf("test."))t.obj.key=i,game.AppFacade.getInstance().sendNotification("test.CommonR",t.obj);else try{t&&t.obj&&t.obj.clientReward&&this.backpackProxy.handleClientRewardCore(t.obj.clientReward),t&&t.obj&&t.obj.clientCost&&this.backpackProxy.handleClientCostCore(t.obj.clientCost),0==n?(game.AppFacade.getInstance().sendNotification(i,t.obj),game.AppFacade.getInstance().sendNotification(CN.GUIDE_NET_RESP,i)):this.callBackMap[n]&&(this.callBackMap[n].call(this,t.obj),this.callBackMap[n]=void 0)}catch(e){console.log("回调代码执行出错",e)}return t=void 0,0==this._msgBuffer.bytesAvailable&&this._msgBuffer.clear(),n}},e.prototype.decode=function(e){var t=e.length,i=e.readUnsignedShort(),n=e.readUnsignedByte(),o=e.readUnsignedShort(),a=e.readUnsignedByte();if(0===i)return e.position=0,Utils.MsgUtils.addErrMsg(void 0,"解析协议失败"),void console.log("解析协议失败，强行输出",e.readUTF());var r=new egret.ByteArray;e.readBytes(r);var s=this.resolvePBNSByID(n),c=this.resolvePBClassByID(n,o);console.log("正在解析：["+s.pretty_name+" "+c.pretty_name+"] 大小 "+r.length);var l=this.pbObjs[s.name]&&this.pbObjs[s.name][c.name];if(l){var h=l.decode(r.bytes,r.length);if(console.log("解析返回：ssid:"+a+" 总长"+t+" ["+s.pretty_name+" "+c.pretty_name+"]",h),r.clear(),r=void 0,!s.pretty_name||!c.pretty_name)throw new Error("pretty翻译失败");return{obj:h,ssid:a,id1Str:s.pretty_name,id2Str:c.pretty_name}}},e.prototype.encode=function(e){var t=this.resolvePBNSByName(e.id1),i=this.resolvePBClassByName(e.id1,e.id2),n=this.pbObjs[t.name][i.name],o=new n(e.body),a=new egret.ByteArray(n.encode(o).finish()),r=new egret.ByteArray;return r.writeShort(a.length+4),r.writeByte(t.id),r.writeShort(i.id),r.writeByte(e.ssid),r.writeBytes(a),a.clear(),a=void 0,r},e}(ByteArrayMsg);__reflect(ByteArrayMsgByJSProtobuf.prototype,"ByteArrayMsgByJSProtobuf");var ByteArrayMsgByProtobuf=function(t){function e(){var e=t.call(this)||this;return e.pbObjs=null,e.ids=null,e.pbObjs={game:window.dcodeIO.ProtoBuf.loadProto(RES.getRes("game_proto"))},e.ids=RES.getRes("package_json"),e}return __extends(e,t),e.prototype.getPbObj=function(e){return this.pbObjs.game},e.prototype.getId1=function(e){return"number"==typeof e?this.ids[e]:this.ids[e].id},e.prototype.getId2=function(e,t){var i=e;return"number"==typeof e&&(i=this.ids[e]),this.ids[i].id2s[t]},e.prototype.decode=function(e){var t=e.length,i=e.readUnsignedShort(),n=e.readUnsignedByte(),o=e.readUnsignedShort(),a=e.readUnsignedByte();if(0===i)return e.position=0,Utils.MsgUtils.addErrMsg(void 0,"解析协议失败"),void egret.log("解析协议失败，强行输出",e.readUTF());var r=new egret.ByteArray;e.readBytes(r);var s=this.getId1(n),c=this.getId2(n,o),l=this.getPbObj(s).build(s+"."+c).decode(r.buffer);return egret.log("解析返回：ssid:"+a+" 总长"+t+" ["+s+" "+c+"]",l),r.clear(),r=void 0,{obj:l,ssid:a}},e.prototype.encode=function(e){var t=this.getId1([e.id1]),i=this.getId2([e.id1],[e.id2]),n=new(this.getPbObj(e.id1).build(e.id1+"."+e.id2))(e.body),o=new egret.ByteArray(n.toArrayBuffer()),a=new egret.ByteArray;return a.writeShort(o.length+4),a.writeByte(t),a.writeShort(i),a.writeByte(e.ssid),a.writeBytes(o),o.clear(),o=void 0,a},e}(ByteArrayMsg);__reflect(ByteArrayMsgByProtobuf.prototype,"ByteArrayMsgByProtobuf");var Socket=function(t){function i(){var e=t.call(this)||this;return e._needReconnect=!0,e._TIME_OUT_TO_RECONNECT=5,e._TIME_OUT_TO_SHOW_LOADING=99,e._timeInvokeGuard=300,e._time_out_count=30,e._time_out_to_reconnect=e._TIME_OUT_TO_RECONNECT,e._sessionMax=128,e._sessionIdSet={},e._sessionIndex=0,e._timeoutLog=new Array,e._show_juhua_loading_effect_guard_dict={},e._timeInvokeLog={},e}return __extends(i,t),Object.defineProperty(i.prototype,"needReconnect",{set:function(e){this._needReconnect=e},enumerable:!0,configurable:!0}),i.prototype.dump=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log(i.LOG_TAG,e)},i.prototype.addEvents=function(){this._socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this._socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this._socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},i.prototype.removeEvents=function(){this._socket&&(this._socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this._socket.removeEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this._socket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this))},i.prototype.onSocketOpen=function(){this.dump("onSocketOpen"),this._time_out_to_reconnect=this._TIME_OUT_TO_RECONNECT,this._timeoutLog.splice(0),this._isConnecting=!0,this._reconnecting?game.AppFacade.getInstance().sendNotification(SocketConst.SOCKET_RECONNECT):game.AppFacade.getInstance().sendNotification(SocketConst.SOCKET_CONNECT),this._reconnecting=!1,game.GameMgr.getInstance().switchNetChecking(!1)},i.prototype.onSocketClose=function(){this.dump("onSocketClose"),this._isConnecting=!1,this._needReconnect?(Utils.MsgUtils.addMidMsg("连接已断开，重新连接中"),game.AppFacade.getInstance().sendNotification(SocketConst.SOCKET_START_RECONNECT),game.GameMgr.getInstance().switchNetChecking(!0)):(Utils.MsgUtils.addMidMsg("连接已断开"),game.AppFacade.getInstance().sendNotification(SocketConst.SOCKET_CLOSE))},i.prototype.onSocketError=function(){this.dump("onSocketError"),this._needReconnect&&!this._reconnecting?this.reconnect():game.AppFacade.getInstance().sendNotification(SocketConst.SOCKET_NOCONNECT),this._isConnecting=!1},i.prototype.initServer=function(e,t,i,n,o){this._host=e,this._port=t,this._suffix=i,this._msg=o,this._type=n},i.prototype.connect=function(){!Utils.DeviceUtils.IsHtml5||window.WebSocket?(this._socket=new egret.WebSocket,this._msg instanceof ByteArrayMsg&&(this._socket.type=egret.WebSocket.TYPE_BINARY),this.addEvents(),""!=this._port?(this.dump("WebSocket: "+this._host+":"+this._port+this._suffix,this._msg instanceof ByteArrayMsg),this._socket.connectByUrl(this._type+this._host+":"+this._port+this._suffix)):(this.dump("WebSocket: "+this._host+this._suffix,this._msg instanceof ByteArrayMsg),this._socket.connectByUrl(this._type+this._host+this._suffix))):this.dump("不支持WebSocket")},i.prototype.reconnect=function(e){e&&(this._reconnecting=!1),this._reconnecting?this.dump("已在重连中，不处理"):(this.dump("reconnect"),this._reconnecting=!0,this.loading&&this.loading.switch(!1),this.close(),game.GameMgr.getInstance().switchNetChecking(!0),this.connect())},i.prototype.close=function(){this._socket&&(this.dump("close"),game.GameMgr.getInstance().stopPingSche(),this.removeEvents(),this._socket.close(),this._socket=null,this._isConnecting=!1)},i.prototype.isConnecting=function(){return this._isConnecting},i.prototype.debugInfo=function(e){game.AppFacade.getInstance().sendNotification(SocketConst.SOCKET_DEBUG_INFO,e)},i.prototype.onReceiveMessage=function(e){var t=this._msg.receive(this._socket);0!=t&&this.cleanSessionId(t)},i.prototype.send=function(c,l,h,p,d){return void 0===p&&(p=!1),void 0===d&&(d=!1),__awaiter(this,void 0,void 0,function(){var t,i,n,o,a,r,s;return __generator(this,function(e){if(Utils.agentConfig.OffLineTest)return[2,new Promise(function(e,t){t()})];if(this._isConnecting){if(d=d||UNIQUE_REQ[l]){if(t=Date.now(),i=this._timeInvokeLog[c+l]||0,t-i<this._timeInvokeGuard)return egret.log("调用频率限制",c,l),[2,new Promise(function(e,t){t()})];for(n=0,o=this._timeoutLog;n<o.length;n++)if((a=o[n])[2]===c&&a[3]===l)return egret.log("重复请求",c,l),[2,new Promise(function(e,t){t()})];this._timeInvokeLog[c+l]=t}return r=this.getSessionId(),(s={}).id1=c,s.id2=l,s.ssid=r,s.body=h,egret.log("send",c,l,h),this._timeoutLog.push([r,this._time_out_count,c,l]),[2,this._msg.send(this._socket,s,p)]}return this._needReconnect&&game.GameMgr.getInstance().switchNetChecking(!0),[2]})})},i.prototype.getSessionId=function(){return this._sessionIndex++,this._sessionIndex>this._sessionMax?(this._sessionIndex=0,this.getSessionId()):this._sessionIdSet[this._sessionIndex]?this.getSessionId():(this._sessionIdSet[this._sessionIndex]=!0,this._sessionIndex)},i.prototype.cleanSessionId=function(e){if(this._sessionIdSet[e]){this._sessionIdSet[e]=void 0;for(var t=0,i=0,n=this._timeoutLog;i<n.length;i++){if(n[i][0]===e){this._timeoutLog.splice(t,1);break}t++}}else Utils.MsgUtils.addErrMsg(void 0,"，无效的请求")},i.prototype.handleTimeOut=function(){0===this._time_out_to_reconnect?this.reconnect():this._time_out_to_reconnect--},i.prototype.intervalUpdate=function(e){var i=this,n=void 0,o=!1;this._timeoutLog.forEach(function(e,t){i._show_juhua_loading_effect_guard_dict[e[0]]>=i._TIME_OUT_TO_SHOW_LOADING&&(o=!0),i._show_juhua_loading_effect_guard_dict[e[0]]?i._show_juhua_loading_effect_guard_dict[e[0]]+=1:i._show_juhua_loading_effect_guard_dict[e[0]]=1,e[1]<=0?(n||(n=[]),n.push(t),Utils.MsgUtils.addMidMsg("请求超时："+e[2]+":"+e[3]),i.handleTimeOut()):e[1]-=1}),n&&n.forEach(function(e){i._show_juhua_loading_effect_guard_dict[i._timeoutLog.splice(e,1)[0]]=void 0}),o?this.loading?!this._reconnecting&&this.loading.switch(!0):(this.loading=new game.LoadingEffect,GameRootLayer.gameLayer().loadLayer.addChild(this.loading)):this.loading&&this.loading.switch(!1)},i.LOG_TAG="<--\x3eSocket<--\x3e:",i}(BaseClass);__reflect(Socket.prototype,"Socket");var SocketConst=function(){function e(){}return e.SOCKET_CONNECT="SOCKET_CONNECT",e.SOCKET_RECONNECT="SOCKET_RECONNECT",e.SOCKET_START_RECONNECT="SOCKET_START_RECONNECT",e.SOCKET_CLOSE="SOCKET_CLOSE",e.SOCKET_DATA="SOCKET_DATA",e.SOCKET_NOCONNECT="SOCKET_NOCONNECT",e.SOCKET_DEBUG_INFO="SOCKET_DEBUG_INFO",e}();__reflect(SocketConst.prototype,"SocketConst"),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="CommonDaTanChuKuangSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.parent.touchEnabled=!1,this.img_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onCloseCB&&e.onCloseCB()},this)},e}(eui.Component);e.CommonDaTanChuKuang=t,__reflect(t.prototype,"customui.CommonDaTanChuKuang",["eui.UIComponent","egret.DisplayObject"])}(customui||(customui={}));var UTFMsgByJson=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.decode=function(e){return JSON.parse(e)},t.prototype.encode=function(e){return JSON.stringify(e)},t}(UTFMsg);__reflect(UTFMsgByJson.prototype,"UTFMsgByJson");var AnchorUtil=function(){function i(){}return i.init=function(){i._propertyChange=Object.create(null),i._anchorChange=Object.create(null),i.injectAnchor()},i.setAnchorX=function(e,t){e.anchorX=t},i.setAnchorY=function(e,t){e.anchorY=t},i.setAnchor=function(e,t){e.anchorX=e.anchorY=t},i.getAnchor=function(e){return e.anchorX!=e.anchorY&&egret.log("target's anchorX != anchorY"),e.anchorX||0},i.getAnchorY=function(e){return e.anchorY||0},i.getAnchorX=function(e){return e.anchorX||0},i.injectAnchor=function(){Object.defineProperty(egret.DisplayObject.prototype,"width",{get:function(){return this.$getWidth()},set:function(e){var t=this;this.$setWidth(e),i._propertyChange[this.hashCode]=!0,egret.callLater(function(){i.changeAnchor(t)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"height",{get:function(){return this.$getHeight()},set:function(e){var t=this;this.$setHeight(e),i._propertyChange[this.hashCode]=!0,egret.callLater(function(){i.changeAnchor(t)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorX",{get:function(){return this._anchorX},set:function(e){var t=this;this._anchorX=e,i._propertyChange[this.hashCode]=!0,i._anchorChange[this.hashCode]=!0,egret.callLater(function(){i.changeAnchor(t)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorY",{get:function(){return this._anchorY},set:function(e){var t=this;this._anchorY=e,i._propertyChange[this.hashCode]=!0,i._anchorChange[this.hashCode]=!0,egret.callLater(function(){i.changeAnchor(t)},this)},enumerable:!0,configurable:!0})},i.changeAnchor=function(e){i._propertyChange[e.hashCode]&&i._anchorChange[e.hashCode]&&(e.anchorOffsetX=e._anchorX*e.width,e.anchorOffsetY=e._anchorY*e.height,delete i._propertyChange[e.hashCode])},i.calculateAndSetAr=function(e){e.anchorOffsetX=e.width*e.scaleX/2,e.anchorOffsetY=e.height*e.scaleY/2},i}();__reflect(AnchorUtil.prototype,"AnchorUtil");var ArrayUtil=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.cloneObj=function(e){var t=e.constructor===Array?[]:{};if("object"==typeof e){for(var i in e)e[i]&&(t[i]="object"==typeof e[i]?this.cloneObj(e[i]):e[i]);return t}},t}(BaseClass);__reflect(ArrayUtil.prototype,"ArrayUtil");var Base64Util=function(){function s(){}return Object.defineProperty(s,"nativeBase64",{get:function(){return"function"==typeof window.atob},enumerable:!0,configurable:!0}),s.decode=function(e){if(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),this.nativeBase64)return window.atob(e);for(var t,i,n,o,a,r,s=[],c=0;c<e.length;)t=this._keyStr.indexOf(e.charAt(c++))<<2|(o=this._keyStr.indexOf(e.charAt(c++)))>>4,i=(15&o)<<4|(a=this._keyStr.indexOf(e.charAt(c++)))>>2,n=(3&a)<<6|(r=this._keyStr.indexOf(e.charAt(c++))),s.push(String.fromCharCode(t)),64!==a&&s.push(String.fromCharCode(i)),64!==r&&s.push(String.fromCharCode(n));return s=s.join("")},s.encode=function(e){if(e=e.replace(/\r\n/g,"\n"),this.nativeBase64)return window.btoa(e);for(var t,i,n,o,a,r,s,c=[],l=0;l<e.length;)o=(t=e.charCodeAt(l++))>>2,a=(3&t)<<4|(i=e.charCodeAt(l++))>>4,r=(15&i)<<2|(n=e.charCodeAt(l++))>>6,s=63&n,isNaN(i)?r=s=64:isNaN(n)&&(s=64),c.push(this._keyStr.charAt(o)),c.push(this._keyStr.charAt(a)),c.push(this._keyStr.charAt(r)),c.push(this._keyStr.charAt(s));return c=c.join("")},s.decodeBase64AsArray=function(e,t){t=t||1;var i,n,o,a=s.decode(e),r=new Uint32Array(a.length/t);for(i=0,o=a.length/t;i<o;i++)for(r[i]=0,n=t-1;0<=n;--n)r[i]+=a.charCodeAt(i*t+n)<<(n<<3);return r},s.decompress=function(e,t,i){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")},s.decodeCSV=function(e){for(var t=e.replace("\n","").trim().split(","),i=[],n=0;n<t.length;n++)i.push(+t[n]);return i},s._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s}();__reflect(Base64Util.prototype,"Base64Util");var ComponentUtils=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.registerListener=function(e,t,i,n){switch(t){case egret.TouchEvent.TOUCH_TAP:Utils.TouchUtils.addTouchListener(e,i,n);break;default:if(!n)return void egret.log("【ComponentUtils】：注册非TOUCH_TAP类型事件时没有提供context，注册失败");e.addEventListener(t,i,n),e.once(egret.Event.REMOVED_FROM_STAGE,function(){e.removeEventListener(t,i,n)},this)}},e.prototype.unregisterListener=function(e,t,i,n){switch(t){case egret.TouchEvent.TOUCH_TAP:Utils.TouchUtils.removeTouchListener(e,i,n);break;default:if(!n||!i)return void egret.log("【ComponentUtils】：移除非TOUCH_TAP类型事件时没有提供context或cb，注册失败");e.removeEventListener(t,i,n)}},e.prototype.getNameOfComponent=function(e){var t="",i=this.getBaseView(e);if(i){for(var n="",o=e,a=i,r=[],s=[],c=this.getIdInParent(a,o),l=0,h="",p=0;a!=o;)""==h&&""!=(h=this.getIdInParent(o,e))&&(p=l),""==c?(s[l++]||s.push(this.getIndexInParent(o)),o=o.parent):(l=0,a=o,o=e,r.push(c)),c=this.getIdInParent(a,o);if(s=s.slice(p,l).reverse(),r.forEach(function(e){n+="#"+e}),0<s.length&&(s.forEach(function(e){n+="#"+e}),""!=h&&(n+="#"+h)),""!=(n=n.substring(1)))t=i.skinName+"#"+n}return t},e.prototype.getComponentByName=function(e){var t=e.split("#"),i=t[0],n=GameRootLayer.gameLayer().getViewBySkinName(i);if(n){for(var o=n,a=1;a<t.length;a++){var r=t[a];if(!(o=0<=Number(r)?o.$children[r]:o[r]))break}return o}},e.prototype.getBaseView=function(e){for(var t=e;t&&!(t instanceof BaseView);)t=t.parent;return t},e.prototype.getPosInView=function(e,t,i,n){var o=i||this.getBaseView(e),a=t&&t.x||0,r=t&&t.y||0,s=e.localToGlobal(a,r,n);return o.globalToLocal(s.x,s.y,n)},e.prototype.getIdInParent=function(e,t){var i="";for(var n in e)if("downTarget"!=n&&e[n]==t){i=n;break}return i},e.prototype.getIndexInParent=function(e){var t=-1;return e.parent&&(t=e.parent.$children.indexOf(e)),t},e}();__reflect(ComponentUtils.prototype,"ComponentUtils");var DebugUtils=function(t){function e(){var e=t.call(this)||this;return e._threshold=3,e._startTimes={},e}return __extends(e,t),e.prototype.setNeedDebugTools=function(e){this._isNeedDebugTools=e},Object.defineProperty(e.prototype,"isNeedDebugTools",{get:function(){return this._isNeedDebugTools},enumerable:!0,configurable:!0}),e.prototype.setDebug=function(e){this._isOpen=e},Object.defineProperty(e.prototype,"isDebug",{get:function(){return this._isOpen},enumerable:!0,configurable:!0}),e.prototype.start=function(e){this._isOpen&&(this._startTimes[e]=egret.getTimer())},e.prototype.stop=function(e){if(!this._isOpen)return 0;if(!this._startTimes[e])return 0;var t=egret.getTimer()-this._startTimes[e];return t>this._threshold&&egret.log(e+": "+t),t},e.prototype.setThreshold=function(e){this._threshold=e},e.prototype.dumpWalkInside=function(e,t){if(void 0===t&&(t=1),e&&e.toRaw){for(var i=e.toRaw(),n="\t",o=1;o<t;o++)n+="\t";if(i)for(var a in i)egret.log(""+n+a+":"+e[a]),this.dumpWalkInside(e[a],t++)}},e.prototype.dumpPbMsg=function(e){this._isOpen&&(egret.log(e.toString()),this.dumpWalkInside(e))},e.prototype.showBoundaryForComp=function(e,t){var i=t&&t.lineColor||16711680,n=t&&t.thickness||5,o=new egret.Shape;o.graphics.lineStyle(n,i),o.graphics.beginFill(0,0),o.graphics.drawRect(0,0,e.width,e.height),o.graphics.endFill(),e.addChild(o),e.addEventListener(eui.UIEvent.RESIZE,function(){o.graphics.clear(),o.graphics.lineStyle(n,i),o.graphics.beginFill(0,0),o.graphics.drawRect(0,0,e.width,e.height),o.graphics.endFill()},this)},e.prototype.resetA=function(){Utils.DebugUtils.isDebug&&(window._a=GameRootLayer.gameLayer().getViewBySkinName(GameRootLayer.gameLayer().getCurViewSkinName()))},e.prototype.getFakeName=function(){return game.GameMVC.playerPy.getRandomName()},e.prototype.getFakePlayerId=function(){return Utils.MathUtils.getRandomInt(1e5,2e5)},e.prototype.getFakeServerId=function(){return Utils.MathUtils.getRandomInt(1e5,2e5)},e.prototype.getFakeFightCap=function(){return Utils.MathUtils.getRandomInt(0,7777777)},e.prototype.getFakeAvatar=function(){return"head_1_"+Utils.MathUtils.getRandomInt(10,100)+"_png"},e.prototype.getFakeLevel=function(){return Utils.MathUtils.getRandomInt(1,200)},e.prototype.getFakeVipLevel=function(){return Utils.MathUtils.getRandomInt(1,18)},e.prototype.getFakeGuildName=function(){return""},e.prototype.getFakeServerName=function(){return"???"},e.prototype.getFakeOfflineTime=function(){return 0},e.prototype.getFakeRank=function(){return 0},e}(BaseClass);__reflect(DebugUtils.prototype,"DebugUtils");var DeviceUtils=function(t){function e(){var e=t.call(this)||this;return e.os2Id={iOS:4,Android:5,"Windows Phone":1,"Windows PC":1,"Mac OS":2,Unknown:6},e}return __extends(e,t),Object.defineProperty(e.prototype,"IsHtml5",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsNative",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE||egret.Capabilities.runtimeType==egret.RuntimeType.RUNTIME2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsMobile",{get:function(){return egret.Capabilities.isMobile},enumerable:!0,configurable:!0}),e.prototype.needDownMic=function(){return!(4!==Utils.DeviceUtils.getPlatform()&&5!==Utils.DeviceUtils.getPlatform()||this.IsNative||egret.getOption("egretnative"))},Object.defineProperty(e.prototype,"IsPC",{get:function(){return!egret.Capabilities.isMobile},enumerable:!0,configurable:!0}),e.prototype.getPlatform=function(){return getUrlKV().os_code?getUrlKV().os_code:window.$platform_id?window.$platform_id:this.os2Id[egret.Capabilities.os]},e.prototype.getBrowser=function(){return window.$browser_id||""},e.prototype.curWidth=function(){return egret.MainContext.instance.stage.stageWidth},e.prototype.curHeight=function(){return egret.MainContext.instance.stage.stageHeight},e.prototype.additionWidth=function(){return egret.MainContext.instance.stage.stageWidth*(1-this.additionScale())},Object.defineProperty(e.prototype,"statusBarHeight",{get:function(){return getUrlKV().statusBarHeight||0},enumerable:!0,configurable:!0}),e.prototype.additionScale=function(){return this.curHeight()<1280?this.curHeight()/1280:1},Object.defineProperty(e.prototype,"statusBottomHeight",{get:function(){return getUrlKV().statusBottomHeight||0},enumerable:!0,configurable:!0}),e.prototype.deviceId=function(){return"not_unique"},e.prototype.setBottomAdapter=function(e){e&&0!=this.statusBottomHeight&&(isNaN(e.bottom)||null==e.bottom||(e.bottom+=this.statusBottomHeight),isNaN(e.verticalCenter)||null==e.verticalCenter||(e.verticalCenter-=this.statusBottomHeight/2),e.y-=this.statusBottomHeight)},e.prototype.setLiuHaiPingAdapter=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];e.forEach(function(e){e&&0!=t.statusBarHeight&&(isNaN(e.top)||null==e.top||(e.top+=t.statusBarHeight),isNaN(e.verticalCenter)||null==e.verticalCenter||(e.verticalCenter+=t.statusBarHeight/2),e.y+=t.statusBarHeight)})},e.prototype.copyToClipboardByDOM=function(e,t){try{var i=document.createElement("input");i.readOnly=!0,i.value=e,document.body.appendChild(i),i.select(),i.setSelectionRange(0,i.value.length),document.execCommand("Copy"),document.body.removeChild(i),t&&t(0)}catch(e){console.warn(e),t&&t(-1)}},e}(BaseClass);__reflect(DeviceUtils.prototype,"DeviceUtils");var DragonBoneTools=function(){function g(){}return g.manualClean=function(){for(var e in g.manualCleanDBADs){for(var t=g.manualCleanDBADs[e],i=0,n=t;i<n.length;i++){var o=n[i];o.armature&&(dragonBones.EgretFactory.factory.clock.remove(o.armature),o.dispose())}for(var a=0;a<t.length;a++)Utils.AssetsMgr.reduceRes(e)&&(dragonBones.EgretFactory.factory.removeDragonBonesData(e,!0),dragonBones.EgretFactory.factory.removeTextureAtlasData(e,!0))}g.manualCleanDBADs={}},g.createForHero=function(e,t,i,n){return n?n.cacheAsBitmap=!1:n={cacheAsBitmap:!1},g.create(e,t,i,n)},g.create=function(t,i,n,o){var a="";o||(o={});var e=AssetAdapter.getSrcChangeConfig();t=e&&e[t]||t;var r,s,c,l=dragonBones.EgretFactory.factory;function h(e){e?(r=e,RES.hasRes(t+"_texture_json")?Utils.AssetsMgr.getResAsync(t+"_texture_json",p,this,t):Utils.AssetsMgr.getResAsync(t+"_tex_json",p,this,t)):Utils.MsgUtils.addMidMsg("404(skeleton):"+t)}function p(e){e?(s=e,a=RES.hasRes(t+"_texture_png")?t+"_texture_png":t+"_tex_png",Utils.AssetsMgr.getResAsync(a,d,this,t)):Utils.MsgUtils.addMidMsg("404(json):"+t)}function d(e){e?((c=e)._textureName=a,l.parseDragonBonesData(r,t),l.parseTextureAtlasData(s,c),u()):Utils.MsgUtils.addMidMsg("404(texture):"+t)}function u(){var e=l.buildArmatureDisplay(t,t,void 0,void 0,"Default");e?(g.needCacheAsBitmap&&(o.cacheAsBitmap||o.cacheFrameRate?e.armature.cacheFrameRate=o.cacheFrameRate||12:0==o.cacheAsBitmap||(Utils.isXYX()&&!DB_SKIP_CACHE_FRAME[t]?e.armature.cacheFrameRate=12:c&&g.checkNeeddCacheFrame(c._textureName,c.textureWidth,c.textureHeight)&&(e.armature.cacheFrameRate=12))),o.cleanByManualAfterRemove?e.once(egret.Event.REMOVED_FROM_STAGE,function(){e.animation.stop(),g.manualCleanDBADs[t]||(g.manualCleanDBADs[t]=[]),g.manualCleanDBADs[t].push(e)},this):o.noCleanAfterRemove||e.once(egret.Event.REMOVED_FROM_STAGE,function(){e.animation.stop(),e.dispose(),Utils.AssetsMgr.reduceRes(t)&&(l.removeDragonBonesData(t,!0),l.removeTextureAtlasData(t,!0))},this),e.name="_effectOnObj",i&&i.call(n,e)):Utils.MsgUtils.addMidMsg("读取特效失败(buildArmatureDisplay):"+t)}null==g.needCacheAsBitmap&&(g.needCacheAsBitmap=Utils.DeviceUtils.IsMobile),l.getDragonBonesData(t)&&l.getTextureAtlasData(t)?(Utils.AssetsMgr.raiseRes(t),u()):RES.hasRes(t+"_skeleton_dbbin")?Utils.AssetsMgr.getResAsync(t+"_skeleton_dbbin",h,this,t):RES.hasRes(t+"_ske_dbbin")?Utils.AssetsMgr.getResAsync(t+"_ske_dbbin",h,this,t):Utils.AssetsMgr.getResAsync(t+"_ske_json",h,this,t)},g.playOnce=function(n){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(e){return[2,new Promise(function(t,e){""!==n.effectName?g.create(n.effectName,function(e){n.frameCB&&e.addEventListener(dragonBones.EventObject.FRAME_EVENT,function(e){e&&e.eventObject&&n.frameCB(e.eventObject)},this),e.addEventListener(dragonBones.EventObject.COMPLETE,function(){n.loop||(!n.keep&&n.parent&&n.parent.contains(e)&&n.parent.removeChild(e),n.doneCB&&n.doneCB(),n.notWait||t())},this),null!=n.horizontalCenter?e.x=(n.parent.width-e.width)/2+n.horizontalCenter:e.x=null!=n.x?n.x:n.parent.width/2,null!=n.verticalCenter?e.y=(n.parent.height-e.height)/2+n.verticalCenter:e.y=null!=n.y?n.y:n.parent.height/2,e.scaleX=n.scaleX?n.scaleX:1,e.scaleY=n.scaleY?n.scaleY:1,null!=n.z?n.parent.addChildAt(e,n.z):n.parent.addChild(e),n.timeScale&&(e.animation.timeScale=Number(n.timeScale)),e.name=n.name||"_effectOnObj",e.animation.hasAnimation(n.actionName||n.effectName)||t(),n.static?e.animation.stop():e.animation.play(n.actionName||n.effectName,n.loop?0:1),e.visible=!1,e.once(egret.Event.ENTER_FRAME,function(){e.visible=!0},this),n.notWait&&t(),n.loadFinishCB&&n.loadFinishCB(e)},i,{cacheAsBitmap:n.cacheAsBitmap,cacheFrameRate:n.cacheFrameRate,noCleanAfterRemove:n.noCleanAfterRemove,cleanByManualAfterRemove:n.cleanByManualAfterRemove}):t()})]})})},g.playUniqueEffect=function(t){var i=this,n=t.effectName;if(""!==n){var o=function(e){if(!e.armature||!e.animation.hasAnimation(t.actionName||n))return egret.warn("该特效无指定animation"),void(i.armatureCache[n]&&delete i.armatureCache[n]);e.name="_effectOnObj",null!=t.horizontalCenter?e.x=(t.parent.width-e.width)/2+t.horizontalCenter:e.x=null!=t.x?t.x:t.parent.width/2,null!=t.verticalCenter?e.y=(t.parent.height-e.height)/2+t.verticalCenter:e.y=null!=t.y?t.y:t.parent.height/2,e.scaleX=t.scaleX?t.scaleX:1,e.scaleY=t.scaleY?t.scaleY:1,null!=t.z?t.parent.addChildAt(e,t.z):t.parent.addChild(e),t.timeScale&&(e.animation.timeScale=Number(t.timeScale)),e.animation.play(t.actionName||t.effectName,t.loop?0:1)};this.armatureCache[n]?o(this.armatureCache[n]):g.create(n,function(e){(i.armatureCache[n]=e).addEventListener(dragonBones.EventObject.COMPLETE,function(){t.parent&&t.parent.contains(e)&&t.parent.removeChild(e),i.armatureCache[n]&&delete i.armatureCache[n],t.doneCB&&t.doneCB()},i),e.visible=!1,e.once(egret.Event.ENTER_FRAME,function(){e.visible=!0},i),o(e)},this)}},g.preload=function(c){return __awaiter(this,void 0,void 0,function(){function t(e){e&&(a=e,RES.hasRes(c+"_texture_json")?Utils.AssetsMgr.getResAsync(c+"_texture_json",i,this,c):Utils.AssetsMgr.getResAsync(c+"_tex_json",i,this,c))}function i(e){e&&(r=e,RES.hasRes(c+"_texture_png")?Utils.AssetsMgr.getResAsync(c+"_texture_png",n,this,c):Utils.AssetsMgr.getResAsync(c+"_tex_png",n,this,c))}function n(e){e?(s=e,o.parseDragonBonesData(a,c),o.parseTextureAtlasData(r,s),g.manualCleanDBADs[c]||(g.manualCleanDBADs[c]=[]),g.manualCleanDBADs[c].push(1),console.log("模型预解析完成",c)):Utils.MsgUtils.addMidMsg("404(texture):"+c)}var o,a,r,s;return __generator(this,function(e){return(o=dragonBones.EgretFactory.factory).getDragonBonesData(c)&&o.getTextureAtlasData(c)?console.log("模型数据已在内存，不需要重新下载写入",c):RES.hasRes(c+"_skeleton_dbbin")?Utils.AssetsMgr.getResAsync(c+"_skeleton_dbbin",t,this,c):RES.hasRes(c+"_ske_dbbin")?Utils.AssetsMgr.getResAsync(c+"_ske_dbbin",t,this,c):Utils.AssetsMgr.getResAsync(c+"_ske_json",t,this,c),[2]})})},g.dbStatus=function(){for(var e=0,t=[],i=0,n=[],o=dragonBones.EgretFactory.factory.clock,a=0,r=o._animatebles;a<r.length;a++){var s=r[a];s.display&&!s.display.stage&&(e++,t.push(s.name)),s.lockUpdate&&(i++,n.push(s.name))}return egret.log("\ndbStatus:\n    total:"+o._animatebles.length+"\n    noStage:"+e+", "+t+"\n    lockUpdate:"+i+", "+n+"\n        "),e},g.switchDBClockPause=function(e,t,i){void 0===i&&(i=!1),e&&(e.lockUpdate=t)},g.removeAllNotStageDB=function(){for(var e=0,t=dragonBones.EgretFactory.factory.clock._animatebles;e<t.length;e++){var i=t[e];i&&i.display&&!i.display.stage&&dragonBones.EgretFactory.factory.clock.remove(i)}},g.checkNeeddCacheFrame=function(e,t,i){var n=!0;65536<=t*i&&(n=!1);var o=RES.getResourceInfo(e);return o&&0<=o.url.indexOf("/model/")&&(n=!1),egret.log("特效纹理自动转帧",e,t,i,n),n},g.manualCleanDBADs={},g.needCacheAsBitmap=!0,g.armatureCache={},g}();__reflect(DragonBoneTools.prototype,"DragonBoneTools");var EgretExpandUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.init=function(){AnchorUtil.init()},t}(BaseClass);__reflect(EgretExpandUtils.prototype,"EgretExpandUtils");var FlowUtils=function(t){function e(){var e=t.call(this)||this;return e._isCbQueueWorking=!1,e._cbQueue=[],e}return __extends(e,t),e.prototype.insertCbAfterQueue=function(e){this._cbQueue.push(e),this.updateCbQueue()},e.prototype.updateCbQueue=function(e){(e&&(this._isCbQueueWorking=!1),this._isCbQueueWorking)||(this._isCbQueueWorking=!0,this._cbQueue.shift()())},e.prototype.enterFlow=function(e){game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N).loginStatusVO.state=500,"EnterMain"==e&&game.GameMVC.activityPy.checkAllSDKReward(),Utils.SDKMgr.enterFlow(e),Utils.SDKMgr.getPerformConfig(31)&&game.GameMgr.getInstance().resetPerformance()},e}(BaseClass);__reflect(FlowUtils.prototype,"FlowUtils");var GlobalEventManager=function(){function e(){this._eventReactor={}}return e.getIntance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.addGlobalEventListener=function(e,t,i){void 0===i&&(i=!1),this._eventReactor[e]||(this._eventReactor[e]=[]),this._eventReactor[e].push({cb:t,once:i})},e.prototype.removeGlocbalEventListener=function(){},e}();__reflect(GlobalEventManager.prototype,"GlobalEventManager");var LocalStorageUtil=function(a){function e(){var e,t=a.call(this)||this,i=Utils.agentConfig.HttpSerever,n=0;0===i.indexOf("http://")&&(n=7);var o=i.indexOf("/",n);return e=i.substring(n,o),t.PREFIX=e+"_"+Utils.agentConfig.AgentCode,t}return __extends(e,a),e.prototype.getItem=function(e,t){if(void 0===t&&(t=!1),t)return egret.localStorage.getItem(this.PREFIX+"_"+e);var i=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N);return egret.localStorage.getItem(this.PREFIX+"_"+i.playerInfoVO.playerId+"_"+e)},e.prototype.setItem=function(e,t,i){if(void 0===i&&(i=!1),i)return egret.localStorage.setItem(this.PREFIX+"_"+e,t);var n=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N);return egret.localStorage.setItem(this.PREFIX+"_"+n.playerInfoVO.playerId+"_"+e,t)},e.prototype.removeItem=function(e,t){if(void 0===t&&(t=!1),t)return egret.localStorage.removeItem(this.PREFIX+"_"+e);var i=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N);return egret.localStorage.removeItem(this.PREFIX+"_"+i.playerInfoVO.playerId+"_"+e)},e.prototype.getTodayVaild=function(e){var t=!1,i=Number(this.getItem(e)),n=(new Date).getDate();return i&&i===n&&(t=!0),t},e.prototype.setTodayVaild=function(e){this.setItem(e,(new Date).getDate().toString())},e}(BaseClass);__reflect(LocalStorageUtil.prototype,"LocalStorageUtil");var MathUtils=function(t){function e(){var e=t.call(this)||this;return e.thresholds=[{guard:1e9,dividend:1e8,name:"Y"},{guard:1e5,dividend:1e4,name:"W"}],e}return __extends(e,t),e.prototype.getDegByAB=function(e,t){return 180*Math.atan2(e,t)/Math.PI},e.prototype.isNumber=function(e){return!isNaN(Number(e))},e.prototype.getRandomInt=function(e,t,i){e=Math.ceil(e),t=Math.floor(t);var n=null!=i?this.getRandomBySeed(i):Math.random();return Math.floor(n*(t-e+1))+e},e.prototype.getRandomBySeed=function(e){return Number("0."+Math.sin(e).toString().substr(7))},e.prototype.toDecimal=function(e,t){var i=parseFloat(e);if(isNaN(i))return"0";var n=i.toString();if(-1!=n.indexOf(".")&&n.length-n.indexOf(".")>t){var o=(i=Math.round(100*e)/100).toString(),a=o.indexOf(".");for(a<0&&(a=o.length,o+=".");o.length<=a+t;)o+="0";return o}return n},e.prototype.formatNumStyle1=function(e){var t=e.toString();return 1e4<=e&&e<1e7?t=Math.floor(e/1e3)+"K":1e7<=e&&e<1e10?t=Math.floor(e/1e6)+"M":1e10<=e&&(t=Math.floor(e/1e9)+"B"),t},e.prototype.formatNumToCharacter=function(e){var t={0:"十",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七",8:"八",9:"九"},i="";return e<100&&(20<e&&(i+=t[Math.floor(e/10)],i+=t[0]),10<e&&e<20&&(i+=t[0]),i+=t[e%10]),i},e.prototype.formatNumStyle2=function(e){return e||(e=0),e.toString()},e}(BaseClass);__reflect(MathUtils.prototype,"MathUtils");var Vector2D=function(){function t(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this._x=e,this._y=t}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.setZero=function(){this._x=0,this._y=0},t.prototype.isZero=function(){return 0==this._x&&0==this._y},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.lengthSQ)},set:function(e){var t=this.angle;this._x=Math.cos(t)*e,this._y=Math.sin(t)*e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lengthSQ",{get:function(){return this._x*this._x+this._y*this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return Math.atan2(this._y,this._x)},set:function(e){var t=this.length;this._x=Math.cos(e)*t,this._y=Math.sin(e)*t},enumerable:!0,configurable:!0}),t.prototype.normalize=function(){if(0==this.length)return this._x=1,this;var e=this.length;return this._x/=e,this._y/=e,this},t.prototype.truncate=function(e){return this.length=Math.min(e,this.length),this},t.prototype.reverse=function(){return this._x=-this._x,this._y=-this._y,this},t.prototype.isNormalized=function(){return 1==this.length},t.prototype.dotProd=function(e){return this._x*e.x+this._y*e.y},t.prototype.crossProd=function(e){return this._x*e.y-this._y*e.x},t.angleBetween=function(e,t){return e.isNormalized()||(e=e.clone().normalize()),t.isNormalized()||(t=t.clone().normalize()),Math.acos(e.dotProd(t))},t.prototype.dist=function(e){return Math.sqrt(this.distSQ(e))},t.prototype.distSQ=function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},t.prototype.add=function(e){return new t(this._x+e.x,this._y+e.y)},t.prototype.subtract=function(e){return new t(this._x-e.x,this._y-e.y)},t.prototype.multiply=function(e){return new t(this._x*e,this._y*e)},t.prototype.divide=function(e){return new t(this._x/e,this._y/e)},t.prototype.equals=function(e){return this._x==e.x&&this._y==e.y},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e},enumerable:!0,configurable:!0}),t}();__reflect(Vector2D.prototype,"Vector2D");var MCAnimation=function(){function e(e){this.aniExistDict={},this.root=e}return e.prototype.hasAnimation=function(e){if(null!=this.aniExistDict[e])return this.aniExistDict[e];if(null==this.aniExistDict[e]){for(var t=!1,i=0,n=this.root.frameLabels;i<n.length;i++){if(n[i].name==e){t=!0;break}}this.aniExistDict[e]=t}return this.aniExistDict[e]},e.prototype.gotoAndStop=function(e){this.root.gotoAndStop(e)},e.prototype.play=function(e,t){this.root.gotoAndPlay(e,0==t?-1:t)},e.prototype.stop=function(){this.root.stop()},e}();__reflect(MCAnimation.prototype,"MCAnimation");var BaseMC=function(t){function e(){var e=t.call(this)||this;return e.animation=new MCAnimation(e),e}return __extends(e,t),e.prototype.hide=function(){this.parent&&this.parent.removeChild(this)},e.prototype.destoryMe=function(){this.stop(),this.hide()},e}(egret.MovieClip);__reflect(BaseMC.prototype,"BaseMC");var MovieClipTools=function(){function a(){}return a.create=function(n,o,a){var r;function t(e){if(e){var t=new egret.MovieClipDataFactory(e,r),i=new BaseMC;i.movieClipData=t.generateMovieClipData(n),o.call(a,i)}else Utils.MsgUtils.addMidMsg("404(mc):"+n)}RES.hasRes(n+"_tex_png")?RES.getResAsync(n+"_tex_png",function(e){e?(r=e,RES.getResAsync(n+"_mc_json",t,this)):Utils.MsgUtils.addMidMsg("404(json):"+n)},this):(egret.log("找不到帧动画文件",n),o.call(a,void 0))},a.play=function(o){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(e){return[2,new Promise(function(t,i){""!==o.effectName?a.create(o.effectName,function(e){e?(e.addEventListener(egret.MovieClipEvent.FRAME_LABEL,function(e){egret.log(e.type,e.frameLabel,this.mc1.currentFrame)},this),e.addEventListener(egret.Event.COMPLETE,function(){o.loop||(!o.keep&&o.parent&&o.parent.contains(e)&&o.parent.removeChild(e),o.doneCB&&o.doneCB(),o.notWait||t())},this),e.x=o.x?o.x:o.parent.width/2,e.y=o.y?o.y:o.parent.height/2,e.scaleX=o.scaleX?o.scaleX:1,e.scaleY=o.scaleY?o.scaleY:1,e.frameRate=o.frameRate||e.frameRate,null!=o.z?o.parent.addChildAt(e,o.z):o.parent.addChild(e),e.name="_effectOnObj",e.gotoAndPlay(o.actionName||o.effectName,o.loop?-1:1),o.notWait&&t()):i()},n):t()})]})})},a}();__reflect(MovieClipTools.prototype,"MovieClipTools");var GuideChatItem=function(t){function e(){var e=t.call(this)||this;return e.width=720,e.skinName='\n\t\t\t<?xml version="1.0" encoding="utf-8"?>\n\t\t\t<e:Skin class="GuajiMapInfoNode" xmlns:e="http://ns.egret.com/eui"\n\t\t\t\t\txmlns:w="http://ns.egret.com/wing" width="720" height="173">\n\t\t\t\t<e:Image id="img_npc" x="79" y="-351" scaleX="0.82" scaleY="0.82" source=""/>\n\t\t\t\t<e:Image id="img_tips_bg" source="_guide_map_m_json.common_img_jqdh_qipao" horizontalCenter="0" y="0"/>\n\t\t\t\t<e:Label id="lb_tips" text="" x="132" y="55" anchorOffsetX="0" width="469" anchorOffsetY="0" height="100" lineSpacing="5" verticalAlign="middle" size="32" textColor="0x000000"/>\n\t\t\t\t<e:Label id="lb_name" text="" x="81" y="11" size="32" width="221" textAlign="center"/>\n\t\t\t\t<e:Image id="img_say_done" source="_common_m_json.common_img_jqdh_jiantou" x="600" y="119" visible="false"/>\n\t\t\t</e:Skin>\n\t\t\t',e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dismiss=function(e){this.lb_name.visible=!1,this.lb_tips.visible=!1,this.img_say_done.visible=!1,this.img_npc.visible=!1,UIActionManager.fadeIn(this.img_tips_bg,FIGHT_CONST.TIPS_BG_FLY_IN,function(){e&&e()},!0)},e.prototype.show=function(){var e=this;this.img_tips_bg.visible=!0,this.lb_name.visible=!1,this.lb_tips.visible=!1,this.img_npc.visible=!1,UIActionManager.fadeIn(this.img_tips_bg,FIGHT_CONST.TIPS_BG_FLY_IN,function(){e.lb_name.visible=!0,e.lb_tips.visible=!0,e.img_npc.visible=!0})},e.prototype.updateNPCImg=function(e){var t=this;e&&(e.scaleX&&(this.img_npc.scaleX=e.scaleX),e.scaleY&&(this.img_npc.scaleY=e.scaleY),e.offsetX&&(this.img_npc.x+=e.offsetX),e.offsetY&&(this.img_npc.y+=e.offsetY),RES.getResAsync(ResourceUtils.png(e.url),function(e){t.img_npc.source=e},this))},e}(eui.Component);__reflect(GuideChatItem.prototype,"GuideChatItem");var MsgUtils=function(t){function e(){var e=t.call(this)||this;return e.privateChatHeadTimer=void 0,e.privateChatHeadShowTime=1e4,e.privateChatHeadPlayerId=0,e._queue=new Array,e.bannerScroll=new eui.Scroller,e.bannerScroll.touchEnabled=!1,e.bannerScroll.top=170,e.bannerScroll.horizontalCenter=0,e.bannerScroll.width=600,e.bannerScroll.height=36,e.bannerScroll.scrollPolicyH=eui.ScrollPolicy.OFF,e.bannerScroll.scrollPolicyV=eui.ScrollPolicy.OFF,e.bannerScrollViewPort=new eui.Group,e.bannerScrollViewPort.touchEnabled=!1,e.bannerScrollViewPort.width=600,e.bannerScrollViewPort.height=36,e.bannerScroll.viewport=e.bannerScrollViewPort,e.bannerImgBg=new eui.Image,e.bannerImgBg.touchEnabled=!1,e.bannerImgBg.top=170,e.bannerImgBg.horizontalCenter=0,e.bannerImgBg.scaleX=0,GameRootLayer.gameLayer().popMsgLayer.addChild(e.bannerImgBg),GameRootLayer.gameLayer().popMsgLayer.addChild(e.bannerScroll),Utils.DeviceUtils.setLiuHaiPingAdapter(e.bannerScroll),Utils.DeviceUtils.setLiuHaiPingAdapter(e.bannerImgBg),e}return __extends(e,t),e.prototype.switchMidChatMsgDoneImg=function(e){this.guideChatItem&&(e?(this.guideChatItem.img_say_done.visible=!0,UIActionManager.fadeBlink(this.guideChatItem.img_say_done,!0)):(this.guideChatItem.img_say_done.visible=!1,this.guideChatItem.img_say_done.alpha=1,egret.Tween.removeTweens(this.guideChatItem.img_say_done)))},e.prototype.addMidChatMsg=function(c,t,l,h){return void 0===t&&(t=""),void 0===h&&(h=!0),__awaiter(this,void 0,void 0,function(){var i,n,o,a,r,s=this;return __generator(this,function(e){switch(e.label){case 0:return c&&""!==c?(this.guideChatItem||(this.isTipsImgDissing=!0,this.guideChatItem=new GuideChatItem,this.guideChatItem.x=0,this.guideChatItem.y=497,GameRootLayer.gameLayer().popMsgLayer.addChild(this.guideChatItem)),i=0,this.isTipsImgDissing&&(i=FIGHT_CONST.TIPS_BG_FLY_IN,this.guideChatItem.show(),this.isTipsImgDissing=!1),this.guideChatItem.lb_tips.text="",n=0,4,o=c.length+4,a=0,r=Utils.TimerManager.getTimeScale(),this.guideChatItem.lb_name.text=t,this.guideChatItem.updateNPCImg(l),[4,new Promise(function(e,t){s.tipsScheId=egret.setInterval(function(){i<=(a+=20)&&(o<=n?(egret.clearInterval(s.tipsScheId),s.tipsScheId=null,h||(s.guideChatItem.lb_tips.text="",s.isTipsImgDissing=!0,UIActionManager.flyIn(s.guideChatItem.img_tips_bg,3,FIGHT_CONST.TIPS_BG_FLY_IN,function(){s.guideChatItem.parent.removeChild(s.guideChatItem),s.guideChatItem=void 0},!0)),e()):c[n]&&s.guideChatItem.lb_tips.appendText(c[n]),n++)},s,20/r)})]):(this.guideChatItem&&(this.isTipsImgDissing=!0,this.guideChatItem.dismiss(function(){s.guideChatItem.parent.removeChild(s.guideChatItem),s.guideChatItem=void 0})),[2]);case 1:return[2,e.sent()]}})})},e.prototype.addMidMsg=function(r){RES.getResAsync("fenjie_img_tishitiao_png",function(e){if(!(20<this._queue.length)){var t=new eui.Group;t.touchEnabled=!1;var i=new eui.Image;i.touchEnabled=!1,i.source=e;var n=void 0;if(r&&"string"==typeof r?((n=new eui.Label).text=r,n.touchEnabled=!1):r&&"object"==typeof r?n=r:null!=r&&"number"==typeof r&&((n=new eui.Label).text=r.toString(),n.touchEnabled=!1),n){t.width=624,t.height=80,t.addChild(i),t.addChild(n),AnchorUtil.calculateAndSetAr(n),AnchorUtil.calculateAndSetAr(t),i.scale9Grid=new egret.Rectangle(297,10,17,12),i.height=80,n.textColor=16769711,n.size=24,n.horizontalCenter=0,n.verticalCenter=0,t.alpha=0,t.scaleX=.5*Utils.DeviceUtils.additionScale(),t.scaleY=.5*Utils.DeviceUtils.additionScale(),t.x=Utils.DeviceUtils.curWidth()/2,t.y=Utils.DeviceUtils.curHeight()/3;var o=this;this._queue.forEach(function(e,t,i){egret.Tween.removeTweens(e),0===e.alpha&&(e.y=e.y-75),a(e)}),a(t),this._queue.push(t),GameRootLayer.gameLayer().popMsgLayer.addChild(t)}}function a(e){egret.Tween.get(e).to({alpha:1,scaleX:1*Utils.DeviceUtils.additionScale(),scaleY:1*Utils.DeviceUtils.additionScale(),y:e.y-75},300,egret.Ease.backOut).wait(1500).to({alpha:0,y:e.y-150},300,egret.Ease.backIn).call(function(){var e=o._queue.shift();e&&e.parent&&e.parent.removeChild(e)},o)}},this)},e.prototype.addErrMsg=function(e,t){void 0===e&&(e=1e4);var i=game.Config.errConfig();if(i){var n=i[e.toString()];n&&1===n.showServerMsg&&this.addMidMsg(n.errorStr+(t||""))}},e.prototype.addCapChangeEffect=function(e,t){var i=e,n=t,o=0<n-i,a=Math.abs(n-i),r=[],s=new eui.Group,c=new eui.Group,l=new eui.Group,h=new eui.Group;for(s.touchEnabled=!1,c.touchEnabled=!1,l.touchEnabled=!1,h.touchEnabled=!1,s.width=Utils.DeviceUtils.curWidth(),s.height=300,AnchorUtil.calculateAndSetAr(s),DragonBoneTools.create("common_zhandouli",function(e){e.x=s.width/2,e.y=s.height/2,s.addChildAt(e,0),e.animation.play()},this,{groupName:"GuajiFixed"});10<=n;){var p=Math.floor(n/10);r.push((n-10*p).toString()),n=p}r.push(n);!function(){var e=new eui.HorizontalLayout;e.gap=0,e.horizontalAlign=egret.HorizontalAlign.LEFT,e.verticalAlign=egret.VerticalAlign.MIDDLE,l.layout=e,l.x=s.width/2-17,l.y=s.height/2-18;for(var t=r.length;0<t;t--){var i=new eui.BitmapLabel;i.text=r[t-1],i.font="activity_trigger_fnt",i.scaleX=i.scaleY=.55,i.alpha=0,l.addChild(i),egret.Tween.get(i).wait(150*(r.length-t+1)).to({alpha:1})}s.addChildAt(l,1)}(),function(){var e=new eui.HorizontalLayout;e.gap=0,e.horizontalAlign=egret.HorizontalAlign.LEFT,e.verticalAlign=egret.VerticalAlign.MIDDLE,c.layout=e,c.x=s.width/2-17,c.y=s.height/2;r.length;for(var t=function(t){DragonBoneTools.create("common_zhanli_2",function(e){e.x=20*t,e.scaleX=1.5,c.addChild(e),e.animation.play("common_zhanli_2"),egret.Tween.get(e).wait(150*(t+1)).to({alpha:0}).call(function(){c.removeChild(e)},this)},i,{groupName:"GuajiFixed"})},i=this,n=0;n<r.length;n++)t(n);s.addChildAt(c,2)}(),function(){var e=new eui.BitmapLabel;e.font=o?"green_num_fnt":"RedBlackStrocke_fnt",e.text=o?"+"+a:"-"+a,e.x=s.width/2+30+15*r.length,e.y=s.height/2-25,e.alpha=1,egret.Tween.get(e).to({alpha:1,y:s.height/2-40},300).wait(1150).to({alpha:0,y:s.height/2-53},300).call(function(){s.removeChild(e)},this),s.addChildAt(e,3)}(),s.x=Utils.DeviceUtils.curWidth()/2,s.y=Utils.DeviceUtils.curHeight()/2-150,egret.Tween.get(s).wait(1500).to({scaleX:0,scaleY:0},250).call(function(){GameRootLayer.gameLayer().maskLayer.removeChild(s)},this),GameRootLayer.gameLayer().maskLayer.addChild(s)},e.prototype.addRewardMsg=function(e,r,s){r||(r=void 0);var t=e.rewards,i=(e.pokemons,e.equips),c=(e.totes,[]);if(t)for(var n=0,o=t;n<o.length;n++){var a=(u=o[n]).type||u[0],l=u.code||u[1],h=u.num||u[2];c.push(_(a,l,h))}if(i)for(var p=0,d=i;p<d.length;p++){var u;(a=(u=d[p]).type||u[0])||(a=EEntityType.EEntityTypeHeroEquip);l=u.code||u[1],h=u.num||u[2];c.push(_(a,l,h))}game.AppFacade.getInstance().retrieveProxy(game.GuidePy.N);for(var g=function(e){var t=c[e],i=void 0;i=null==r?GameRootLayer.gameLayer().popMsgLayer:r,t.horizontalCenter=0,t.alpha=0;var n=i.height/2;s&&null!=s.oriY&&(n=s.oriY),t.y=n;var o=s&&s.offsetY1||-i.height/4,a=s&&s.offsetY2||-i.height/4;egret.Tween.get(t).to({alpha:1,y:n+o},300,egret.Ease.backOut).wait(700).to({alpha:0,y:n+o+a},300,egret.Ease.backIn).call(function(){t&&t.parent&&t.parent.removeChild(t),s&&s.cb&&s.cb()}),i.addChild(t)},f=0;f<c.length;f++)g(f);function _(e,t,i){var n,o=new eui.Group,a=new eui.Image,r=new eui.BitmapLabel;switch(r.font="yellow_attr_fnt",e){case EEntityType.EEntityTypeItem:if(n=game.Config.itemConfig()[t]){var s=.9;a.source=ResourceUtils.png(n.icon),a.scaleX=s,a.scaleY=s,r.text="+"+i}break;case EEntityType.EEntityTypeHeroEquip:if(n=game.Config.getHeroEquipConfig()[t]){s=.9;a.source=ResourceUtils.png(n.icon),a.scaleX=s,a.scaleY=s,r.text="+"+i}break;case EEntityType.EEntityTypeHeroArtifact:if(n=game.Config.getHeroArtifactConfig()[t]){s=.9;a.source=ResourceUtils.png(n.icon),a.scaleX=s,a.scaleY=s,r.text="+"+i}break;default:for(var c=0,l=game.Config.propertyConfig();c<l.length;c++){var h=l[c];if(h.code==t&&h.type==e){n=h;break}}if(n){s=.9;a.source=ResourceUtils.png(n.icon),a.scaleX=s,a.scaleY=s,r.text="+"+i}}return o.height=50,a.verticalCenter=0,a.left=0,a.width=a.height=50,r.verticalCenter=0,r.left=40,o.addChild(a),o.addChild(r),AnchorUtil.calculateAndSetAr(o),o}},e.prototype.addNumberEffect=function(e,t,i,n,o){void 0===o&&(o=1);var a=new eui.Group,r=new eui.BitmapLabel(e);r.font="yellow_attr_fnt",a.addChild(r),a.x=i,a.y=n+t.height/2*t.scaleY*o,egret.Tween.get(a).to({x:i,y:n,alpha:0},1e3).call(function(){GameRootLayer.gameLayer().popMsgLayer.removeChild(a)}),GameRootLayer.gameLayer().popMsgLayer.addChild(a)},e.prototype.addBannerMsg=function(e,t){this.bannerScrollViewPort.removeChildren();var i=game.AppFacade.getInstance().retrieveProxy(game.MainPy.N),n=new eui.Label;n.size=26,n.touchEnabled=!1,n.addEventListener(egret.TextEvent.LINK,i.bindChatLinkJump,i),n.textFlow=e.textFlow,this.bannerScrollViewPort.addChild(n),n.x=this.bannerScrollViewPort.width,n.verticalCenter=5,egret.Tween.get(n).to({x:-n.textWidth},t)},e.prototype.switchBannerBg=function(t){var i=this;return new Promise(function(e){""!==i.bannerImgBg.source&&i.bannerImgBg.source||(i.bannerImgBg.source="liaotian_img_piaozidi_png",i.bannerImgBg.touchEnabled=!1),(i.bannerScroll.visible=t)?egret.Tween.get(i.bannerImgBg).to({scaleX:1},300).call(function(){e()}):egret.Tween.get(i.bannerImgBg).to({scaleX:0},300).call(function(){e()})})},e.prototype.addJumpPopUp=function(e){var t=Utils.DeviceUtils.curHeight()/9*8-100,i=new eui.Component;i.skinName="JumpPopUpSkin",i.horizontalCenter=0,i.y=t+50,i.alpha=0,i.lb_desc.text=e.desc,e.jumpId&&i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){game.MainJumpConfig.jumpTo(e.jumpId),egret.Tween.removeTweens(i),egret.Tween.get(i).to({alpha:0,y:t-50},250).call(function(){i&&i.parent&&i.parent.removeChild(i)})},this),GameRootLayer.gameLayer().popMsgLayer.addChild(i),egret.Tween.get(i).to({alpha:1,y:t},250).wait(5e3).to({alpha:0,y:t-50},250).call(function(){i&&i.parent&&i.parent.removeChild(i)})},e.prototype.switchBannerVisible=function(e){this.bannerImgBg&&(this.bannerScroll.visible=e,this.bannerImgBg.visible=e,this.bannerScrollViewPort.visible=e)},e.prototype.addPrivateChatPopUp=function(e){var t=this;if(!this.privateChatHead){this.privateChatHead=new customui.PlayerHead,this.privateChatHead.right=18,this.privateChatHead.bottom=270,this.privateChatHead.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){game.AppFacade.getInstance().showSubView(game.ChatMediator.N,game.ChatMediator.SV.CHAT,{NextChannelType:EChatChannelType.EChatChannelTypePrivate,playerID:t.privateChatHeadPlayerId}),t.privateChatHeadTimer&&egret.clearTimeout(t.privateChatHeadTimer),t.privateChatHead.visible=!1,UIActionManager.fadeBlink(t.privateChatHead,!1)},this),GameRootLayer.gameLayer().popMsgLayer.contains(this.privateChatHead)||GameRootLayer.gameLayer().popMsgLayer.addChild(this.privateChatHead);var i=new eui.Image("_chat_m_json.liaotian_img_new");i.right=i.top=0,this.privateChatHead.addChild(i)}this.privateChatHead.updateData({vo:e}),this.privateChatHead.visible=!0,this.privateChatHeadPlayerId=e.playerId,UIActionManager.fadeBlink(this.privateChatHead,!0,!1,500),this.privateChatHeadTimer&&egret.clearTimeout(this.privateChatHeadTimer),this.privateChatHeadTimer=egret.setTimeout(function(){this.privateChatHead.visible=!1,UIActionManager.fadeBlink(this.privateChatHead,!1)},this,this.privateChatHeadShowTime)},e.prototype.shengjiEffect=function(){var t=GameRootLayer.gameLayer().popMsgLayer;Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shengji),DragonBoneTools.create("common_sj",function(e){e.x=t.width/2||0,e.y=t.height/4||0,e.animation.play(),t.addChild(e)},this,{groupName:"GuajiFixed"})},e.prototype.braveBookShengjiEffect=function(){var t=GameRootLayer.gameLayer().popMsgLayer;Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shengji),DragonBoneTools.create("common_ysdjts",function(e){e.x=t.width/2||0,e.y=t.height/4||0,e.animation.play("common_ysdjts",1),t.addChild(e)},this,{groupName:"GuajiFixed"})},e.prototype.NewBraveBookShenjiEffect=function(e,t){var i=e,n=t,o=(Math.abs(n-i),[]),a=new eui.Group,r=new eui.Group,s=new eui.Group,c=new eui.Group;for(a.touchEnabled=!1,r.touchEnabled=!1,s.touchEnabled=!1,c.touchEnabled=!1,a.width=Utils.DeviceUtils.curWidth(),a.height=300,AnchorUtil.calculateAndSetAr(a),DragonBoneTools.create("common_yslzshengji_1",function(e){e.x=a.width/2,e.y=a.height/2,a.addChildAt(e,0),e.animation.play("common_yslzshengji_1",0)},this,{groupName:"GuajiFixed"});10<=n;){var l=Math.floor(n/10);o.push((n-10*l).toString()),n=l}o.push(n);!function(){var e=new eui.HorizontalLayout;e.gap=0,e.horizontalAlign=egret.HorizontalAlign.LEFT,e.verticalAlign=egret.VerticalAlign.MIDDLE,s.layout=e,s.x=a.width/2+89,s.y=a.height/2+10;for(var t=o.length;0<t;t--){var i=new eui.BitmapLabel;i.text=o[t-1],i.font="activity_trigger_fnt",i.scaleX=i.scaleY=.6,i.alpha=0,s.addChild(i),egret.Tween.get(i).wait(150*(o.length-t+1)).to({alpha:1})}a.addChildAt(s,1)}(),function(){var e=new eui.HorizontalLayout;e.gap=0,e.horizontalAlign=egret.HorizontalAlign.LEFT,e.verticalAlign=egret.VerticalAlign.MIDDLE,r.layout=e,r.x=a.width/2+89,r.y=a.height/2+30;o.length;for(var t=function(t){DragonBoneTools.create("common_yslzshengji_2",function(e){e.x=25*t,e.scaleX=e.scaleY=.6,r.addChild(e),e.animation.play("common_yslzshengji_2"),egret.Tween.get(e).wait(150*(t+1)).to({alpha:0}).call(function(){r.removeChild(e)},this)},i,{groupName:"GuajiFixed"})},i=this,n=0;n<o.length;n++)t(n);a.addChildAt(r,2)}(),a.x=Utils.DeviceUtils.curWidth()/2,a.y=Utils.DeviceUtils.curHeight()/2,egret.Tween.get(a).wait(1500).to({scaleX:0,scaleY:0},250).call(function(){GameRootLayer.gameLayer().maskLayer.removeChild(a)},this),GameRootLayer.gameLayer().maskLayer.addChild(a)},e}(BaseClass);__reflect(MsgUtils.prototype,"MsgUtils");var ResourceUtils=function(t){function i(){var e=t.call(this)||this;return e.behaviourWeakConfig={CITY_MAIN:1,GUAJI_MAIN:1,GUAJI_MAIN_BTN_EFF:0},e}return __extends(i,t),i.png=function(e){return!i.defaultAvatar&&game.Config.constConfig()&&(i.defaultAvatar=JSON.parse(game.Config.constConfig().DefaultAvatar.constValue)[0]),e&&RES.hasRes(e+"_png")?e+"_png":i.defaultAvatar+"_png"},i}(BaseClass);__reflect(ResourceUtils.prototype,"ResourceUtils");var ResVersionManager=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.init=function(){},t.prototype.loadConfig=function(i){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,RES.getResAsync(i)];case 1:return t=e.sent(),this.loadResVersionComplate(t),[2]}})})},t.prototype.loadResVersionComplate=function(e){e?Utils.agentConfig=e:window.fundebug.notifyError("获取resVer失败")},t}(BaseClass);__reflect(ResVersionManager.prototype,"ResVersionManager");var ShakeUtils=function(){function e(){this.count=0,this.timer=new egret.Timer(1e3)}return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.shakeObj=function(e,t,i,n){this.target=e,this.initX=e.x,this.initY=e.y,this.maxDis=n,this.count=t*i,this.rate=i,this.timer.delay=1e3/i,this.timer.repeatCount=this.count,this.timer.addEventListener(egret.TimerEvent.TIMER,this.shaking,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.shakeComplete,this),this.timer.reset(),this.timer.start()},e.prototype.shaking=function(){egret.Tween.removeTweens(this.target),this.target.x=this.initX-this.maxDis+Math.random()*this.maxDis*2,this.target.y=this.initY-this.maxDis+Math.random()*this.maxDis*2,egret.Tween.get(this.target).to({x:this.initX,y:this.initY},999/this.rate)},e.prototype.shakeComplete=function(){this.target&&(egret.Tween.removeTweens(this.target),this.target.x=this.initX,this.target.y=this.initY),this.timer.removeEventListener(egret.TimerEvent.TIMER,this.shaking,this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.shakeComplete,this)},e.prototype.stop=function(){this.shakeComplete()},e}();__reflect(ShakeUtils.prototype,"ShakeUtils");var TouchUtils=function(){function e(){this._globalFuncMap={},this._compFuncMap={}}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.log=function(e){egret.log("【ComponentUtils】:",e)},e.prototype.activateGlobalTouch=function(e){this.log("激活全局点击事件监听"),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this._globalTouch,this)},e.prototype._globalTouch=function(e){this.handleGlobalFunc(e),this.handleCompFunc(e)},e.prototype.addGlobalTouch=function(e,t){this._globalFuncMap[t]=e},e.prototype.removeGlobalTouch=function(e){this._globalFuncMap[e]&&delete this._globalFuncMap[e]},e.prototype.hasGlobalTouch=function(e){return!!this._globalFuncMap[e]},e.prototype.addTouchListener=function(e,t,i,n){var o=this;this._compFuncMap[e.hashCode]||(this._compFuncMap[e.hashCode]={component:e,cbList:[]}),this._compFuncMap[e.hashCode].cbList.every(function(e){return e.cb!=t||e.context!=i})&&(this._compFuncMap[e.hashCode].cbList.push({cb:t,context:i,params:n}),e.once(egret.Event.REMOVED_FROM_STAGE,function(){o.removeTouchListener(e)},this))},e.prototype.hasTouchListener=function(e){return!!this._compFuncMap[e.hashCode]},e.prototype.removeTouchListener=function(e,t,i){if(t){if(this._compFuncMap[e.hashCode]){var n=this._compFuncMap[e.hashCode].cbList;for(var o in n){var a=n[o];if(a.cb==t&&(!i||a.context==i)){n.splice(Number(o),1);break}}n.length||delete this._compFuncMap[e.hashCode]}}else this._compFuncMap[e.hashCode]&&delete this._compFuncMap[e.hashCode]},e.prototype.handleGlobalFunc=function(e){for(var t in this._globalFuncMap){var i=this._globalFuncMap[t];i&&i(e)}},e.prototype.handleCompFunc=function(e){for(var t=e.target;t;)this.onComponentTouch(t,e),t=t.parent},e.prototype.onComponentTouch=function(e,t){var i=this._compFuncMap[e.hashCode];if(i&&i.cbList.length)for(var n in i.cbList){var o=i.cbList[n];this.checkTouchCondition(o.params)&&(o.context?o.cb.call(o.context,t):o.cb(t))}},e.prototype.checkTouchCondition=function(e){return!0},e}();__reflect(TouchUtils.prototype,"TouchUtils");var Utils=function(){function i(){}return Object.defineProperty(i,"Http",{get:function(){return Http.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"SDKMgr",{get:function(){return i.sdkInstance||(i.sdkInstance=i.agentConfig.isRuntime&&(i.DeviceUtils.IsNative||egret.getOption("egretnative"))?MicMgr.getInstance():"qqzone"==i.agentConfig.AgentCode&&"qq_xyx"==i.agentConfig.channelName?WebMgrXYX.getInstance():"qqzone"==i.agentConfig.AgentCode?WebMgrQQZone.getInstance():!i.agentConfig.isHunFu&&i.isXYX()?WebMgrXYX.getInstance():WebMgr.getInstance()),i.sdkInstance},enumerable:!0,configurable:!0}),i.isXYX=function(){return i.XYX_REMOTE_RES_HOST},Object.defineProperty(i,"MapUtils",{get:function(){return game.MapUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"Socket",{get:function(){return Socket.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"UnlockMgr",{get:function(){return UnlockMgr.getInstance()},enumerable:!0,configurable:!0}),i.needToBlockSetGrey=function(){return null==i.forceCloseFilter&&(i.forceCloseFilter=!!i.SDKMgr.getPerformConfig(36)),i.forceCloseFilter},Object.defineProperty(i,"DebugUtils",{get:function(){return DebugUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"TimerManager",{get:function(){return TimerManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"AssetsMgr",{get:function(){return AssetsMgr.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"MathUtils",{get:function(){return MathUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ComponentUtils",{get:function(){return ComponentUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"TouchUtils",{get:function(){return TouchUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ShakeUtils",{get:function(){return ShakeUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"DeviceUtils",{get:function(){return DeviceUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"EgretExpandUtils",{get:function(){return EgretExpandUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ResourceUtils",{get:function(){return ResourceUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"MsgUtils",{get:function(){return MsgUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ArrayUtil",{get:function(){return ArrayUtil.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FlowUtils",{get:function(){return FlowUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"LocalStorageUtil",{get:function(){return LocalStorageUtil.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"SoundManager",{get:function(){return SoundManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ObjectPoolMgr",{get:function(){return ObjectPoolMgr.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"CacheMgr",{get:function(){return CacheMgr.getInstance()},enumerable:!0,configurable:!0}),i.init=function(){i.DebugUtils.setDebug(i.agentConfig.IsDebug),egret.log("===========Utils init info=========="),egret.log("getPlatform:",i.DeviceUtils.getPlatform()),egret.log("getBrowser:",i.DeviceUtils.getBrowser()),egret.log("runtimeType:",egret.Capabilities.runtimeType),egret.log("egretnative:",egret.getOption("egretnative")),egret.log("href:",window.location.href),egret.log("getUrlKV:",getUrlKV()),RES.setMaxLoadingThread(5),window.fundebug&&(window.fundebug.appversion=i.agentConfig.CodeVersion,window.fundebug.releasestage=i.agentConfig.AgentCode,window.fundebug.silentResource=!0,window.fundebug.silent=i.agentConfig.IsDebug,window.fundebug.silentConsole=!i.agentConfig.IsDebug,window.fundebug.sampleRate=.3),i.isBanShu="banshu"===i.agentConfig.AgentCode,i.agentConfig.channelName||(i.agentConfig.channelName=""),i.SDKMgr.getPerformConfig(44)||(GUILD_POST_INFO.push("英雄评论是一个辨识英雄强弱的好地方哦"),LOADING_TIPS.push("英雄评论是一个辨识英雄强弱的好地方哦")),i.Http.initServer(i.agentConfig.HttpSerever),eui.Scroller.scrollThreshold=15,i.SoundManager.init(),NT.initDynamic(),GameRootLayer.gameLayer().stage.frameRate=i.MathUtils.isNumber(i.SDKMgr.getPerformConfig(11))?Number(i.SDKMgr.getPerformConfig(11)):30,game.GameMgr.getInstance().loadPerformance(),i.overRideJsonParse(),i.isInit=!0},i.overRideJsonParse=function(){var n=JSON.parse;JSON.parse=function(t,e){if(Array.isArray(t))return t;if(null==t)return egret.log("Json解析undefined"),[];if(""==t)return egret.log("Json解析空字符串"),[];var i=void 0;try{i=n(t.trim&&t.trim()||t,e)}catch(e){throw"Json解析失败："+t}return i}},i.enterMainOffLine=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,RES.loadGroup("preload_pack")];case 1:return e.sent(),[2,new Promise(function(e,t){i.UnlockMgr.skipAllCheckForDebug=!0,game.Config.unzipSync(void 0,function(){e()})})]}})})},i.renderTextureByRoot=function(e){if(e)try{var t=new egret.RenderTexture;t.drawToTexture(e);t.toDataURL("image/png");var i=Date.now()+"/down.png";t.saveToFile("image/png",i)}catch(e){console.log(e)}},i.ProxyUserFlag="",i.agentConfig=null,i.isBanShu=!1,i.isGuideEditor=!1,i.isNeedGuide=!1,i.isNeedUuidSot=!1,i.isSkipMapGuide=!1,i.sdkInstance=void 0,i.XYX_REMOTE_RES_HOST="__XYX_REMOTE_RES_HOST__",i.isInit=!1,i.forceCloseFilter=void 0,i}();__reflect(Utils.prototype,"Utils"),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.skinName="CommonFightCapSkin",t.fightCap=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.fightCap&&this.update()},e.prototype.update=function(e,t){void 0===t&&(t=!1),t?(this.img_icon.left=this.blb_fightCap.right=void 0,this.img_icon.right=-8,this.blb_fightCap.left=17):(this.img_icon.right=this.blb_fightCap.left=void 0,this.img_icon.left=-8,this.blb_fightCap.right=17),this.fightCap=null==e?this.fightCap:e,this.blb_fightCap.text=Utils.MathUtils.formatNumStyle2(this.fightCap)},e}(eui.Component);e.CommonFightCapItem=t,__reflect(t.prototype,"customui.CommonFightCapItem")}(customui||(customui={})),function(t){var e=function(i){function e(e){var t=i.call(this)||this;return t.data=e,t.skinName="CommonIconWithNumSkin",t.bpProxy=game.AppFacade.getInstance().retrieveProxy(game.BackpackPy.N),t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data&&this.updateItem(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},e.prototype.updateItem=function(e){if(this.data=e||this.data,this.data){switch(this.img_bg.visible=!1,this.showDetail=this.data.showDetail,this.data.style||CommonIconStyle.BOTTOM){case CommonIconStyle.BOTTOM:this.width=game.GeneralConfig.fixedSizeWH,this.height=game.GeneralConfig.fixedSizeWH,this.blb_num.horizontalCenter=0,this.blb_num.bottom=0,this.blb_num.scaleX=this.blb_num.scaleY=.8;break;case CommonIconStyle.RIGHT:this.height=game.GeneralConfig.fixedSizeWH,this.blb_num.verticalCenter=0,this.blb_num.x=50,this.blb_num.scaleX=this.blb_num.scaleY=.9,this.data.needBg&&(this.img_bg.visible=!0)}this.code=this.data.code||this.data.cost[1];var t=this.data.num||this.data.cost[2],i=this.bpProxy.getInfoByCode(this.code);if(this.img_icon.source=ResourceUtils.png(i.info.icon),this.data.needShowHave){var n=game.AppFacade.getInstance().retrieveProxy(game.BackpackPy.N).getInfoByCode(this.code);this.blb_num.text=Utils.MathUtils.formatNumStyle1(n.haveNum)+"/"+t}else this.blb_num.text=Utils.MathUtils.formatNumStyle1(t);null==this.data.showEnough||this.data.showEnough;!1,this.blb_num.font="white_num_fnt"}},e.prototype.onClick=function(){if(this.showDetail){var e=t.BaseItemFactory.create();e.updateData({code:this.code}),e.onClick(),this.addChild(e),this.removeChild(e)}},e}(eui.Component);t.CommonIconWithNum=e,__reflect(e.prototype,"customui.CommonIconWithNum")}(customui||(customui={})),function(r){var e=function(t){function e(){var e=t.call(this)||this;return e.guajiPy=r.AppFacade.getInstance().retrieveProxy(r.GuajiPy.N),e.needTipsToday=!1,e.skinName="CommonQuickBattleTipsSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateView=function(e){this.params=e,this.clickCB=e.clickCB,this.params.commonTips?this.initForCommonTips():this.initForCost(),this.params.noOKBtn&&(this.btn_confirm.visible=!1,this.btn_cancle.horizontalCenter=0)},e.prototype.initForCommonTips=function(){Array.isArray(this.params.commonTips)?this.lb_content.textFlow=this.params.commonTips:this.lb_content.text=this.params.commonTips,this.decorateBtn()},e.prototype.initForCost=function(){var e,t=this,i="string"==typeof this.params.cost?JSON.parse(this.params.cost)[0]:this.params.cost[0],n=JSON.parse(r.Config.constConfig().QuickBattleGainTime.constValue);if(n&&(e=""+this.params.costTips+(n[0]+this.guajiPy.quickBattleInfo.hCount*n[1])/3600+this.params.costTips2),egret.log(i),i){var o=r.GeneralConfig.getEntityConfigByCode(i[0],i[1]);this.lb_content.text=e?this.params.reset?"是否花费        x"+i[2]+e:"确定消耗        x"+i[2]+e:"确定消耗        x"+i[2]+"，购买一次挑战次数？",egret.log(o);var a=void 0;o.icon&&""!=o.icon?((a=new eui.Image).visible=!1,this.lb_content.parent.addChild(a),RES.getResAsync(ResourceUtils.png(o.icon),function(e){a.source=e,a.width=r.GeneralConfig.fixedSizeWH,a.height=r.GeneralConfig.fixedSizeWH,a.scaleX=a.scaleY=.8,-1!=t.lb_content.text.indexOf("(")||t.lb_content.text.indexOf("（"),a.left=102,a.top=-11},this)):((a=new eui.Label).text=o.name,this.lb_content.parent.addChild(a)),egret.setTimeout(function(){a.visible=!0},this,100)}else egret.log("没有填写消耗信息"),this.lb_content.text=this.params.reset?e:"确定"+e;this.lb_num.text="今日剩余次数："+this.params.num,this.decorateBtn()},e.prototype.decorateBtn=function(){var e=this;this.btn_cancle.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onClick(0)},this),this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),e.params&&0<e.params.num?e.onClick(1):Utils.MsgUtils.addMidMsg("今日快速开采次数已达上限，请提升vip等级！")},this)},e.prototype.onClick=function(e){this.hide(),this.clickCB&&this.clickCB({type:e})},e.BTN_STYLE={CONFIRM:{text:"确定",skin:"skins.ButtonSkinGreen"},CANCEL:{text:"取消",skin:"skins.ButtonSkinRed"},GOTO:{text:"前往",skin:"skins.ButtonSkinYellow"}},e}(BasePanel);r.CommonQuickBattleTips=e,__reflect(e.prototype,"game.CommonQuickBattleTips")}(game||(game={})),function(e){var t=function(i){function r(e){var t=i.call(this)||this;return t.costInfo=e,t.skinName="CommonResourceBarSkin",t.bpProxy=game.AppFacade.getInstance().retrieveProxy(game.BackpackPy.N),t}return __extends(r,i),r.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.costInfo&&this.updateBar(this.costInfo)},r.prototype.updateBar=function(i){var n=this;this.costInfo=this.decodeData(i);var o="string"!=typeof i&&!Array.isArray(i)&&i.width||r.WIDTH_FOR_NUM[this.costInfo.length]||r.WIDTH_FOR_NUM[2],e=i.gap||15;this.gp_root.removeChildren();var t=this.costInfo;this.gp_root.layout.gap=e,Array.isArray(this.costInfo[0])&&(t=[],this.costInfo.forEach(function(e){t.push(e[1])}));var a=!0;Utils.SDKMgr.getPerformConfig(1)&&(Utils.SDKMgr.getPerformConfig(19)||(a=!1)),t.forEach(function(e){var t=n.bpProxy.getInfoByCode(e);t.info&&n.gp_root.addChild(new s({icon:t.info.icon,num:t.haveNum,width:o,addClickWayFunc:a&&i.needAdd&&(r.WAY_CONFIG[e]||i.wayFunc)}))})},r.prototype.decodeData=function(e){return"string"==typeof e?JSON.parse(e):Array.isArray(e)?e:e.costs?this.decodeData(e.costs):[]},r.WAY_CONFIG=((n={})[EPropertyType.EPropertyTypeDiamond]=function(){game.MainJumpConfig.jumpTo(MODULE.Recharge)},n[EPropertyType.EPropertyTypeGold]=function(){game.AppFacade.getInstance().showSubView(game.TouchGoldHandMediator.N,game.TouchGoldHandMediator.SV.MAIN)},n.ActivityZoneDevoteGoods=function(){},n),r.WIDTH_FOR_NUM={2:215,3:185},r}(eui.Component);e.CommonResourceBar=t,__reflect(t.prototype,"customui.CommonResourceBar");var n,s=function(i){function e(e){var t=i.call(this)||this;return t.data=e,t.skinName="CommonResourceBarSkin_ResourceItem",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.updateItem()},e.prototype.updateItem=function(){this.width=this.data.width,this.img_icon.source=ResourceUtils.png(this.data.icon),this.blb_num.text=Utils.MathUtils.formatNumStyle1(this.data.num),this.data.addClickWayFunc&&(this.btn_add.visible=!0,this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.data.addClickWayFunc()},this))},e}(eui.Component);e.ResourceItem=s,__reflect(s.prototype,"customui.ResourceItem")}(customui||(customui={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="CommonSourceJumpLabelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.parent.touchEnabled=!1},e.prototype.makeItem=function(e){var t=this,i=new eui.Component;return i.skinName="CommonSourceJumpLabelSkin_1",i.once(eui.UIEvent.CREATION_COMPLETE,function(){0==e.moduleId?i.lb_tips.textFlow=[{text:e.desc,style:{underline:!1}}]:(i.lb_tips.textFlow=[{text:e.desc,style:{underline:!0}}],i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){game.AppFacade.getInstance().retrieveProxy(game.ActivityPy.N)},t))},this),i},e.prototype.setNeedCode=function(e){var i=this;this.gp_list.removeChildren();var t=void 0,n=void 0;Array.isArray(e)?(t=e[1],n=e[0]):(t=e,n=Math.floor(Number(t)/1e7));var o=void 0;o=n==EEntityType.EEntityTypeHero?game.Config.allHeroConfig()[t]:game.Config.itemConfig()[t],this.code=t;do{if(!o||!o.jumpCode||""==o.jumpCode)break;return void JSON.parse(o.jumpCode).forEach(function(e){var t=game.Config.wayConfig()[e];t&&i.gp_list.addChild(i.makeItem(t))})}while(0);this.visible=!1},e.prototype.addWayCode=function(e){var t=game.Config.wayConfig()[e];t&&this.gp_list.addChild(this.makeItem(t))},e}(eui.Component);e.CommonSourceJumpLabel=t,__reflect(t.prototype,"customui.CommonSourceJumpLabel",["eui.UIComponent","egret.DisplayObject"])}(customui||(customui={}));var EasyLoadingUI=function(t){function e(){var e=t.call(this)||this;return e.curPbNextProgressValue=1,e.pbNextProgressStep=0,e.resInitDone=!1,e.isMenShow=!1,e.percentHeight=100,e.percentWidth=100,e.scaleX=Utils.DeviceUtils.additionScale(),e.scaleY=Utils.DeviceUtils.additionScale(),e.once(egret.Event.REMOVED_FROM_STAGE,function(){e.sche&&egret.clearInterval(e.sche),e.scheFade&&(egret.clearTimeout(e.scheFade),e.scheFade=void 0)},e),e}return __extends(e,t),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【EasyLoadingUI】:"].concat(e))},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tf_helpTips=new eui.Label,this.addChild(this.tf_helpTips),this.tf_helpTips.textAlign="center",this.tf_helpTips.width=615,this.tf_helpTips.horizontalCenter=0,this.tf_helpTips.bottom=120,this.tf_helpTips.bold=!0,this.tf_helpTips.italic=!0,this.tf_helpTips.lineSpacing=5,this.tf_helpTips.size=23,this.tf_helpTips.textColor=16777215},e.prototype.initDbAct=function(){var e,t=new eui.Group;for(var i in t.width=200,t.height=200,t.horizontalCenter=t.verticalCenter=0,this.addChildAt(t,1),e={lx:{name:"dljm_wyw",x:140,y:560}})DragonBoneTools.playOnce({cacheAsBitmap:!1,loop:!0,x:e[i].x,y:e[i].y,scaleX:e[i].scale||1,scaleY:e[i].scale||1,effectName:e[i].name,parent:t,timeScale:e[i].timeScale||1})},e.prototype.pbFadeUpdate=function(){var e=this;if(this.resInitDone&&!this.scheFade){var t=this.getRandomInt(50,1e3);this.scheFade=egret.setTimeout(function(){e.log("scheFade: ",t),egret.clearTimeout(e.scheFade),e.scheFade=void 0,e.pbFadeUpdate()},this,t),this.pb_layerProgress_fade.value=0,this.pb_layerProgress_fade.slideDuration=0,this.once(egret.Event.ENTER_FRAME,function(){e.scheFade&&(e.pb_layerProgress_fade.slideDuration=t,e.pb_layerProgress_fade.value=100)},this)}},e.prototype.switchTips=function(){var e=LOADING_TIPS[this.getRandomInt(0,LOADING_TIPS.length-1)];this.tf_helpTips.textFlow=[{text:"提示：",style:{textColor:1895742}},{text:e,style:{textColor:16777215}}]},e.prototype.getRandomInt=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e},e.prototype.defaultResDone=function(){var t=new eui.Image;t.horizontalCenter=0,t.verticalCenter=0;var e="bg_dengluditu_ditu_jpg";Utils.SDKMgr.getPerformConfig(22)?e=Utils.SDKMgr.getPerformConfig(22):Utils.SDKMgr.getPerformConfig(6)&&(e="bg_dengluditu_jpg"),RES.getResAsync(e,function(e){t.source=e,showGame()},this),this.addChildAt(t,0),this.pb_layerProgress=new eui.ProgressBar,this.pb_layerProgress_fade=new eui.ProgressBar,this.pb_layerProgress.slideDuration=this.pb_layerProgress_fade.slideDuration=500,this.pb_layerProgress.width=this.pb_layerProgress_fade.width=500,this.pb_layerProgress.horizontalCenter=this.pb_layerProgress_fade.horizontalCenter=0,this.pb_layerProgress.bottom=231,this.pb_layerProgress_fade.bottom=182;var i=new eui.Image;i.right=i.left=i.top=i.bottom=0,i.scale9Grid=new egret.Rectangle(26,10,1,1),RES.getResAsync("jiazai_img_jindudi_png",function(e){i.source=e},this),this.pb_layerProgress.addChild(i);var n=new eui.Image;n.right=6,n.left=6,n.top=4,n.bottom=9,n.scale9Grid=new egret.Rectangle(34,15,1,1),RES.getResAsync("jiazai_img_jindulan_png",function(e){n.source=e},this),this.pb_layerProgress.addChild(n),this.pb_layerProgress.thumb=n;var o=new eui.Image;o.right=o.left=o.top=o.bottom=0,o.scale9Grid=new egret.Rectangle(26,10,1,1),RES.getResAsync("jiazai_img_jindudi_png",function(e){o.source=e},this),this.pb_layerProgress_fade.addChild(o);var a=new eui.Image;a.right=6,a.left=6,a.top=4,a.bottom=9,a.scale9Grid=new egret.Rectangle(34,15,1,1),RES.getResAsync("jiazai_img_jindulan_png",function(e){a.source=e},this),this.pb_layerProgress_fade.addChild(a),this.pb_layerProgress_fade.thumb=a;var r=new eui.Image;r.horizontalCenter=0,r.bottom=281,RES.getResAsync("jiazai_img_lipin_png",function(e){r.source=e},this),this.addChild(r),this.addChild(this.pb_layerProgress),this.addChild(this.pb_layerProgress_fade),this.resInitDone=!0,this.pbFadeUpdate()},e.prototype.setProgress=function(e,t){var i=this;if(!("LOGIN_INTO_MAP"==this.forceForName&&(t<50?t=50:t+=20,e<this.pb_layerProgress.value))){if(this.log("Loading progress: "+e+"/"+t),1==e){if(this.switchTips(),this.pbNextProgressStep=Math.floor(100/t),!this.sche){var n=0,o=0;this.sche=egret.setInterval(function(){o+=250,3e3<=(n+=250)&&(n=0,i.switchTips()),1e3<=o&&i.pb_layerProgress&&(o=0,i.pb_layerProgress.value<i.curPbNextProgressValue&&(i.pb_layerProgress.value+=1))},this,250)}}else this.curPbNextProgressValue=Math.min(100,(e+1)*this.pbNextProgressStep);this.pb_layerProgress&&(this.pb_layerProgress.value=Math.floor(e/t*100),this.pb_layerProgress.maximum=100)}},e.prototype.onProgress=function(e,t){this.setProgress(e,t)},e.prototype.switchMenLoading=function(e,t,i){if(e){if(i&&(this.forceForName=i),this.isMenShow)return void(t&&t());this.visible=!0,this.pbFadeUpdate(),this.isMenShow=!0,t&&t()}else{if(this.forceForName&&this.forceForName!=i)return void(t&&t());if(this.forceForName=void 0,!this.isMenShow)return void(t&&t());this.pbFadeFullDoneAndHideMen(t)}},e.prototype.pbFadeFullDoneAndHideMen=function(e){var t=this;this.sche&&(egret.clearInterval(this.sche),this.sche=void 0),this.scheFade&&(egret.clearTimeout(this.scheFade),this.scheFade=void 0),this.pb_layerProgress_fade.slideDuration=this.pb_layerProgress.slideDuration=0,this.pb_layerProgress_fade.value=this.pb_layerProgress.value=100,e&&e(),egret.setTimeout(function(){t.pb_layerProgress_fade.slideDuration=t.pb_layerProgress.slideDuration=500,t.pb_layerProgress_fade.value=t.pb_layerProgress.value=0,t.isMenShow=!1,t.visible=!1},this,300)},e}(eui.UILayer);__reflect(EasyLoadingUI.prototype,"EasyLoadingUI",["RES.PromiseTaskReporter"]),function(T){var e,t,i=function(){function _(){}return _.getActivityConfigByType=function(e){var t=T.Config.activityConfigs(),i=T.AppFacade.getInstance().retrieveProxy(T.ActivityPy.N),n=[];for(var o in t){var a=t[o],r=_.Config[o];if(r&&a.entrance==e&&a.inList&&Utils.UnlockMgr.checkPass(MODULE.Activity+a.id,!1).allow){var s=i.allActivityData[a.id];r.isOpen?r.isOpen(s)&&n.push(a):s&&n.push(a)}}return n.sort(function(e,t){return e.priority-t.priority}),n},_.commonTargetNoticeCheck=function(e,t){try{var i=_.Config[t];if(!i)return!1;if(!e||!e.data)return!1;var n=e.data.targeted;0==Object.keys(n).length&&(n=[]);var o=e.data.key||0,a=(e.data.day,JSON.parse(e.content)),r=e.data.curCycle;if(r&&i.cycle)for(var s in a[1]){var c=a[1][s];if(c[0]==r){a=c[1];break}}var l=!1;return a.forEach(function(e){var t=e[0];e[1],e[2],REWARD_STATUS.UNAVAILABLE;n.some(function(e){return e.id==t&&0<e.num})?REWARD_STATUS.RECEIVED:o>=e[1]&&(REWARD_STATUS.AVAILABLE,l=!0)}),l}catch(e){console.log("判断通用列表活动红点发送错误",e)}},_.commonTaskNoticeCheck=function(e,o){if(e&&e.data)try{var t=JSON.parse(e.content),i=e.data.targeted;i[0]||(i=[]);var a=e.data.keyList,r={},n=function(e){if(o==EActivityType.MagicalUpGradeTask||o==EActivityType.PetUpGradeTask){var t=0;for(var i in a){(n=a[i]).taskType>=e&&(t+=n.key)}return r[e]=t}for(var i in a){var n;if((n=a[i]).taskType==e)return r[e]=n.key,n.key}},s=function(e){switch(parseInt(o)){case EActivityType.ConsumeDiamondTask:return e;default:return e%1e4}},c=function(e,t){var i=e;switch(parseInt(o)){case EActivityType.GuildCollectTask:case EActivityType.GuildCollectTask1:case EActivityType.MagicalUpGradeTask:case EActivityType.PetUpGradeTask:case EActivityType.HeroArtifactUpStarTask:i=t[1]-t[1]%1e4}return i};for(var l in t){var h=t[l],p=h[0],d=s(h[1]),u=(h[2],h[3]),g=(h[4],c(u,h)),f=r[g]||n(g)||0,_=REWARD_STATUS.UNAVAILABLE;if(d<=f&&(_=REWARD_STATUS.AVAILABLE),0<=i.indexOf(p)&&(_=REWARD_STATUS.RECEIVED),o==EActivityType.ZhongQiuTask&&_!=REWARD_STATUS.RECEIVED||_===REWARD_STATUS.AVAILABLE)return!0}return!1}catch(e){console.log(e)}},_.getActivityEndDt=function(e){if(_.Config[e]){var t=_.Config[e];return t.getEndDt?t.getEndDt(e):t.cycle?_.getActivityCycleEndDt(e):_.getActivityNormalEndDt(e)}return 0},_.getActivityNormalEndDt=function(e){var t=T.AppFacade.getInstance().retrieveProxy(T.ActivityPy.N).allActivityData[e];return t?t.endDt:0},_.getActivityCycleEndDt=function(e){var t=T.AppFacade.getInstance().retrieveProxy(T.ActivityPy.N).allActivityData[e];return t&&t.data?t.startDt+(t.data.curCycle||1)*JSON.parse(t.content)[0]*24*3600:0},_.getActivityOneDayEndDt=function(e){var t=T.AppFacade.getInstance().retrieveProxy(T.ActivityPy.N).allActivityData[e];if(t&&t.data){var i=new Date(1e3*Utils.TimerManager.getServerTime());return i.setHours(23,59,59),i.getTime()/1e3}return 0},_.getCurDay=function(e){if(e&&e.data){var t=e.startDt,i=Utils.TimerManager.getServerTime();return t<i?Math.ceil((i-t)/86400):0}return 0},_.addAllActivityConfig=function(){_.addActivityConfig("FlashCapsuleHigh",0,12),_.addActivityConfig("DiscountGiftBag",0,26),_.addActivityConfig("ContinueRechargeReward",0,4),_.addActivityConfig("WishGifts",0,11),_.addActivityConfig("HuntTreasure",0,5),_.addActivityConfig("ItemGifts",0,15),_.addActivityConfig("SecondOpenServerRecharge",0,20),_.addActivityConfig("ProfessionSuit",0,12),_.addActivityConfig("WishTree",0,12),_.addActivityConfig("DiamondGifts",0,12),_.addActivityConfig("WeekFund",0,12),_.addActivityConfig("DailyLoginWeal",0,12),_.addActivityConfig("DiscountGiftBagDaily",0,10,"DiscountGiftBag"),_.addActivityConfig("SeventhOpenServerRecharge",0,20,"SecondOpenServerRecharge"),_.addActivityConfig("ThirdDiamondGifts",0,20,"DiamondGifts")},_.addActivityConfig=function(e,t,i,n){void 0===t&&(t=0),void 0===i&&(i=0),void 0===n&&(n="");for(var o=t;o<=i;o++){var a=o?EActivityType[e+o]:EActivityType[e];a&&(n||(n=e),_.Config[a]=_.CommonConfig[EActivityType[n]]||_.Config[EActivityType[n]])}},_.CommonConfig=((e={})[EActivityType.DiscountGiftBag]={protoName:"GetDiscountGiftBagInfo",getRewardName:"",checkNotice:function(e){},formatString:"%s元礼包",cycle:!0},e[EActivityType.ContinueRechargeReward]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(e){if(!e||!e.data)return!1;var t=!1,i=(e.content,e.data.rechargeDays),n=JSON.parse(e.data.targeted),o=JSON.parse(e.content),a=o[2];if(!a)return!1;for(var r in a){var s=a[r],c=s[0],l=s[1],h=(s[2],REWARD_STATUS.AVAILABLE);for(var p in n){if(n[p][0]==c){h=REWARD_STATUS.RECEIVED;break}}if(i<l&&(h=REWARD_STATUS.GO_RECHARGE),h==REWARD_STATUS.AVAILABLE){t=!0;break}}var d=o[0],u=o[1][_.getCurDay(e)-1];if(u){var g=e.data.amounts,f=REWARD_STATUS.GO_RECHARGE;for(var p in d<=g&&(f=REWARD_STATUS.AVAILABLE),n){if(n[p][0]==u[0]){f=REWARD_STATUS.RECEIVED;break}}return f==REWARD_STATUS.AVAILABLE&&(t=!0),t}}},e[EActivityType.SecondOpenServerRecharge]={protoName:"GetSecondOpenServerRechargeInfo",getRewardName:"SecondOpenServerRechargeReward",checkNotice:function(e){if(e&&e.data){var t,i=e.content,n=e.data.amount,o=JSON.parse(e.data.targeted),a=e.data.curCycle||1;for(var r in i[1]){if((l=i[1][r])[0]==a){t=l[1];break}}if(!t)return!1;var s=!1;for(var c in t){var l,h=(l=t[c])[1];REWARD_STATUS.AVAILABLE;-1!=o.indexOf(l[0])?REWARD_STATUS.RECEIVED:n<h?REWARD_STATUS.UNAVAILABLE:s=!0}return s}},cycle:!0},e[EActivityType.DiamondGifts]={protoName:"GetExchangeGiftsInfo",getRewardName:"",checkNotice:function(e){},cycle:!0},e[EActivityType.HuntTreasure]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0},e[EActivityType.ItemGifts]={protoName:"GetExchangeGiftsInfo",getRewardName:"BuyExchangeGifts",checkNotice:function(e){if(!e||!e.data)return!1;var t,i=e.data.targeted,n=e.content,o=T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N),a=e.data.curCycle;for(var r in n[1]){if((c=n[1][r])[0]==a){t=c[1];break}}if(!t)return!1;for(var s=0;s<t.length;s++){var c,l=(c=t[s])[0],h=(c[1],c[2]),p=c[3],d=(REWARD_STATUS.UNAVAILABLE,0);for(var r in i){var u=i[r];if(u.id==l){d=u.num;break}}if(p<=d)REWARD_STATUS.RECEIVED;else if(h&&o.checkEnough(h,!1))return REWARD_STATUS.AVAILABLE,!0}return!1},cycle:!0},e[EActivityType.NewNewItemGifts]={protoName:"GetExchangeGiftsInfo",getRewardName:"BuyExchangeGifts",checkNotice:function(e){if(!e||!e.data)return!1;var t,i=e.data.targeted,n=e.content,o=T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N),a=e.data.curCycle;for(var r in n[1]){if((c=n[1][r])[0]==a){t=c[1];break}}if(!t)return!1;for(var s=0;s<t.length;s++){var c,l=(c=t[s])[0],h=(c[1],c[2]),p=c[3];if(!c[4]){REWARD_STATUS.UNAVAILABLE;var d=0;for(var r in i){var u=i[r];if(u.id==l){d=u.num;break}}if(p<=d)REWARD_STATUS.RECEIVED;else if(h&&o.checkEnough(h,!1))return REWARD_STATUS.AVAILABLE,!0}}return!1},cycle:!0},e[EActivityType.MysticalShopRefreshTask]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:_.commonTaskNoticeCheck},e[EActivityType.DailyLuxuryGifts]={protoName:"GetDailyLuxuryGiftsInfo",getRewardName:"BuyFreeDailyLuxuryGifts",formatString:"%s元累充礼包",checkNotice:function(e){if(e&&e.data){var t=e.data.targeted,i=e.content,n=e.data.day,o=[];for(var a in i){(c=i[a])[0]==n&&o.push(c)}if(!o.length)return!1;for(var r=e.data.key,s=0;s<o.length;s++){(c=o[s])[0];var c,l=c[1],h=c[2];c[3];if(!c[4]||!c[2]){var p=REWARD_STATUS.UNAVAILABLE;h<=r&&(p=REWARD_STATUS.AVAILABLE);var d=!1;for(var a in t){if(t[a].id==l){d=!0;break}}if(d&&(p=REWARD_STATUS.RECEIVED),p==REWARD_STATUS.AVAILABLE)return!0}}return!1}},getEndDt:function(){var e=Utils.TimerManager.getServerTime(),t=new Date(1e3*e);return t.setHours(23,59,59),t.getTime()/1e3}},e[EActivityType.EnjoyCard]={protoName:"GetEnjoyCardInfo",getRewardName:"GetEnjoyCardReward",checkNotice:function(e){if(!e||!e.data)return!1;var t=JSON.parse(e.content),i=e.data.startEffectDt,n=e.data.endEffectDt,o=e.data.targeted,a=i&&n,r=new Date(1e3*i);r.setHours(23,59,59);var s=Math.ceil((Utils.TimerManager.getServerTime()-(r.getTime()/1e3+1))/24/3600);++s<=0&&(s=1);var c=1;for(var l in o.sort(function(e,t){return e-t}),o){if((u=o[l])!=c)break;c++}for(var h=Math.ceil(c/t[0]),p=!1,d=0;d<t[1].length;d++){var u,g=(u=t[1][d])[0],f=(u[1],(h-1)*t[0]+g),_=REWARD_STATUS.AVAILABLE;if(a?0<=o.indexOf(f)?_=REWARD_STATUS.RECEIVED:s<f&&(_=REWARD_STATUS.UNAVAILABLE):_=REWARD_STATUS.UNAVAILABLE,_==REWARD_STATUS.AVAILABLE){p=!0;break}}return p}},e[EActivityType.CommonTask]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:_.commonTaskNoticeCheck,getEndDt:_.getActivityOneDayEndDt},e[EActivityType.WishGifts]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",formatString:"",checkNotice:function(e){if(!e||!e.data)return!1;var i=e.data.amounts,t=e.content,n=e.data.rechargeTargeted,o=!1;return t[1].forEach(function(e){var t=e[0];e[1],REWARD_STATUS.UNAVAILABLE;0<=n.indexOf(t)?REWARD_STATUS.RECEIVED:t<=i&&(REWARD_STATUS.AVAILABLE,o=!0)}),o}},e[EActivityType.SecondContinueRechargeReward]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",formatString:"",checkNotice:function(e){if(!e||!e.data)return!1;e.data.amount;var t=JSON.parse(e.data.targeted),i=JSON.parse(e.data.rechargeDays),n=JSON.parse(e.content);if(!n)return!1;var o=[];for(var a in n){var r=n[a];o.indexOf(r[0])<0&&o.push(r[0])}o.sort(function(e,t){return e-t});for(var s=0;s<o.length;s++){var c=o[s];for(var l in n){if((r=n[l])[0]==c){var h=r[1];for(var a in h){var p=h[a],d=p[0],u=p[1],g=(p[2],0);for(var f in i)if(i[f][0]==c){g=i[f][1];break}var _=REWARD_STATUS.GO_RECHARGE;for(var m in u<=g&&(_=REWARD_STATUS.AVAILABLE),t){if(t[m][0]==d){_=REWARD_STATUS.RECEIVED;break}}if(_==REWARD_STATUS.AVAILABLE)return!0}}}}}},e[EActivityType.FlashCapsuleHigh]={protoName:"GetFlashCapsuleHighInfo",getRewardName:"FlashCapsuleHigh",checkNotice:_.commonTargetNoticeCheck,formatString:"高级招募%s次"},e),_.Config=((t={})[EActivityType.SignIn]={protoName:"GetSignInInfo",getRewardName:"SignIn",checkNotice:function(e){if(e&&e.data)return 0==e.data.count},formatString:"",needPullWhenOpen:!1,cycle:!1,getEndDt:_.getActivityNormalEndDt},t[EActivityType.LevelReward]={protoName:"GetLevelRewardInfo",getRewardName:"LevelReward",checkNotice:function(e){if(e&&e.data){for(var n=T.AppFacade.getInstance().retrieveProxy(T.PlayerPy.N).playerInfoVO.level,o=e.data.targeted,a=e.content,r=!1,t=function(e){var t=a[e],i=t[0];t[1],REWARD_STATUS.AVAILABLE;n<i?REWARD_STATUS.UNAVAILABLE:o.some(function(e){return e.id==i&&0<e.num})?REWARD_STATUS.RECEIVED:r=!0},i=0;i<a.length;i++)t(i);return r}},formatString:"等级达到%s级"},t[EActivityType.ExchangeCode]={protoName:""},t[EActivityType.ThirdOpenServerRecharge]=_.CommonConfig[EActivityType.SecondOpenServerRecharge],t[EActivityType.ThirdOpenServerRecharge1]=_.CommonConfig[EActivityType.SecondOpenServerRecharge],t[EActivityType.ThirdOpenServerRecharge2]=_.CommonConfig[EActivityType.SecondOpenServerRecharge],t[EActivityType.FourthOpenServerRecharge]=_.CommonConfig[EActivityType.SecondOpenServerRecharge],t[EActivityType.FourthOpenServerRecharge1]=_.CommonConfig[EActivityType.SecondOpenServerRecharge],t[EActivityType.FourthOpenServerRecharge2]=_.CommonConfig[EActivityType.SecondOpenServerRecharge],t[EActivityType.FourthOpenServerRecharge3]=_.CommonConfig[EActivityType.SecondOpenServerRecharge],t[EActivityType.FifthOpenServerRecharge]=_.CommonConfig[EActivityType.SecondOpenServerRecharge],t[EActivityType.FifthOpenServerRecharge1]=_.CommonConfig[EActivityType.SecondOpenServerRecharge],t[EActivityType.FifthOpenServerRecharge2]=_.CommonConfig[EActivityType.SecondOpenServerRecharge],t[EActivityType.FifthOpenServerRecharge3]=_.CommonConfig[EActivityType.SecondOpenServerRecharge],t[EActivityType.QqzoneOpenServerRecharge]={protoName:"GetSecondOpenServerRechargeInfo",getRewardName:"SecondOpenServerRechargeReward",checkNotice:function(e){if(e&&e.data){var t,i=e.content,n=e.data.amount,o=JSON.parse(e.data.targeted),a=e.data.curCycle||1;for(var r in i[1]){if((l=i[1][r])[0]==a){t=l[1];break}}if(!t)return!1;var s=!1;for(var c in t){var l,h=(l=t[c])[1];REWARD_STATUS.AVAILABLE;-1!=o.indexOf(l[0])?REWARD_STATUS.RECEIVED:n<h?REWARD_STATUS.UNAVAILABLE:s=!0}return s}},isOpen:function(){return"QQVip"==getUrlKV().channel&&0<getUrlKV().QQVipLevel},cycle:!0},t[EActivityType.SecondContinueRechargeReward]=_.CommonConfig[EActivityType.SecondContinueRechargeReward],t[EActivityType.SecondContinueRechargeReward1]=_.CommonConfig[EActivityType.SecondContinueRechargeReward],t[EActivityType.SecondContinueRechargeReward2]=_.CommonConfig[EActivityType.SecondContinueRechargeReward],t[EActivityType.SecondContinueRechargeReward3]=_.CommonConfig[EActivityType.SecondContinueRechargeReward],t[EActivityType.SingleRecharge]={protoName:"GetSingleRechargeInfo",getRewardName:"SingleRecharge",checkNotice:function(e){if(e&&e.data){var t=e.content,i=e.data.day,n=e.data.rechargeInfo,o=e.data.targetedInfo,a=(T.Config.getRechargeConfig(),t[0]);for(var r in t){var s=t[r];if(s[0]==i){a=s[1];break}}var c=!1;return a.forEach(function(e){var t=e[0];e[1],e[2],REWARD_STATUS.UNAVAILABLE;o.some(function(e){return e.id==t})?REWARD_STATUS.RECEIVED:n.some(function(e){return e.id==t&&0<e.num})&&(REWARD_STATUS.AVAILABLE,c=!0)}),c}}},t[EActivityType.DailyLogin]={protoName:"GetDailyLoginInfo",getRewardName:"DailyLogin",checkNotice:function(e){if(e&&e.data){var t=JSON.parse(e.content),i=e.data.targeted,n=e.data.key||0,o=(e.data.day,!1),a=e.data.curCycle;for(var r in t[1]){var s=t[1][r];if(s[0]==a){t=s[1];break}}return t.forEach(function(e){var t=e[0];e[1],e[2],REWARD_STATUS.UNAVAILABLE;i.some(function(e){return e.id==t&&0<e.num})?REWARD_STATUS.RECEIVED:n>=e[1]&&(REWARD_STATUS.AVAILABLE,o=!0)}),o}},cycle:!0},t[EActivityType.ActivityShop]={protoName:"GetActivityShopInfo",getRewardName:"PurchaseCommodity",checkNotice:void 0},t[EActivityType.MonthCard]={protoName:"GetMonthCardInfo",getRewardName:"GetMonthCardReward",checkNotice:function(e){var t=!1;if(e&&e.data){var i=e.data.day,n=e.data.giftFlag;JSON.parse(e.content);i<=0||n||(t=!0);var o=T.GameMVC.activityPy.allActivityData[EActivityType.WholeLifeCard];JSON.parse(o.content);return o&&o.data&&o.data.hasPurchased&&(o.data.giftFlag||(t=!0)),t}}},t[EActivityType.DiamondReward]={protoName:"GetDiamondRewardInfo",getRewardName:"DiamondReward",checkNotice:_.commonTargetNoticeCheck,formatString:"累计消费%s钻石",cycle:!0,getEndDt:_.getActivityNormalEndDt},t[EActivityType.PushGiftBag]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0,getEndDt:_.getActivityOneDayEndDt},t[EActivityType.WishTree]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0},t[EActivityType.BlessingBox]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(e){if(!e||!e.data)return!1;for(var t=JSON.parse(e.content),i=e.data.recharged,n=e.data.targeted,o=0;o<2;o++){var a=0,r=t[0][o],s=(r[0],r[1],r[2],r[4]);for(var c in i){(p=i[c])[0]==o+1&&(a=p[1])}if(!(s<=a))return!0;var l=t[o+1],h=0==o?e.data.blessGrade:e.data.zoneGrade;for(var c in h||(h=0),l){var p,d=(p=l[c])[0],u=(p[1],p[2]),g=REWARD_STATUS.UNAVAILABLE;if(u<=h&&(g=REWARD_STATUS.AVAILABLE),0<=n.indexOf(d)&&(g=REWARD_STATUS.RECEIVED),g==REWARD_STATUS.AVAILABLE)return!0}}return!1}},t[EActivityType.AwakenGiftBag]=_.CommonConfig[EActivityType.DiscountGiftBag],t[EActivityType.ExtremeBattle]={protoName:"GetExtremeBattleInfo",getRewardName:"",checkNotice:function(e){},needPullWhenOpen:!1},t[EActivityType.FlashCapsuleRace]={protoName:"GetFlashCapsuleRaceInfo",getRewardName:"FlashCapsuleRace",checkNotice:_.commonTargetNoticeCheck,formatString:"时空召唤%s次"},t[EActivityType.FlashCapsuleRace1]={protoName:"GetFlashCapsuleRaceInfo",getRewardName:"FlashCapsuleRace",checkNotice:_.commonTargetNoticeCheck,formatString:"时空召唤%s次"},t[EActivityType.FlashCapsuleRace2]={protoName:"GetFlashCapsuleRaceInfo",getRewardName:"FlashCapsuleRace",checkNotice:_.commonTargetNoticeCheck,formatString:"时空召唤%s次"},t[EActivityType.FlashCapsuleRace3]={protoName:"GetFlashCapsuleRaceInfo",getRewardName:"FlashCapsuleRace",checkNotice:_.commonTargetNoticeCheck,formatString:"时空召唤%s次"},t[EActivityType.RiskLayer]={protoName:"GetRiskLayerInfo",getRewardName:"GetRiskLayerReward",checkNotice:_.commonTargetNoticeCheck,formatString:"通关冒险第%s章"},t[EActivityType.CollectHero]={protoName:"GetCollectHeroInfo",getRewardName:"GetCollectHeroReward",checkNotice:function(e){if(e&&e.data){var h=JSON.parse(e.content),t=e.data,p=t.targeted,d=t.specialListspecialList,u=JSON.parse(t.genericityList),g=!1,i=function(e){var t=h[e];if(1==t[1][0][0]){var i=t[1][0][1],n=t[1][0][2],o=t[1][0][3];(r=t[1][0][4])<=(s=u[a=""+(i<10?"0"+i:i)+(n<10?"0"+n:n)+(o<10?"0"+o:o)]?u[a]:0)&&!p.some(function(e){return e.id==t[0]})&&(g=!0)}if(2==t[1][0][0]){var a=t[1][0][1],r=t[1][0][2];if(T.GeneralConfig.getEntityConfigByCode(a)){var s=0;for(var c in d){var l=d[c];l.code==a&&(r=l.num)}r<=s&&!p.some(function(e){return e.id==t[0]})&&(g=!0)}}};for(var n in h)i(n);return g}}},t[EActivityType.LuckyRotate]={protoName:"GetLuckyRotateInfo",getRewardName:"",checkNotice:function(e){if(e&&e.data){var t=JSON.parse(e.content)[0][0];return!!T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N).checkEnough(t)}}},t[EActivityType.LuckyRotate1]={protoName:"GetLuckyRotateInfo",getRewardName:"",checkNotice:function(e){if(e&&e.data){var t=JSON.parse(e.content)[0][0];return!!T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N).checkEnough(t)}}},t[EActivityType.WeekGift]={protoName:"GetCycleGiftInfo",getRewardName:"",checkNotice:function(e){},formatString:"%s元礼包",getEndDt:function(){if(T.AppFacade.getInstance().retrieveProxy(T.ActivityPy.N).allActivityData[EActivityType.WeekGift]){var e=Utils.TimerManager.getServerTime(),t=new Date(1e3*e).getDay();0==t&&(t=7);var i=new Date(1e3*(e+24*(7-t)*3600));return i.setHours(23,59,59),i.getTime()/1e3}return 0}},t[EActivityType.MonthGift]={protoName:"GetCycleGiftInfo",getRewardName:"",checkNotice:function(e){},formatString:"%s元礼包",getEndDt:function(){if(T.AppFacade.getInstance().retrieveProxy(T.ActivityPy.N).allActivityData[EActivityType.MonthGift]){var e=Utils.TimerManager.getServerTime(),t=new Date(1e3*e),i=t.getMonth();return 11==i?t.setFullYear(t.getFullYear()+1,0,1):t.setMonth(i+1,1),t.setHours(0,0,0),t.getTime()/1e3}return 0}},t[EActivityType.EnjoyCard]=_.CommonConfig[EActivityType.EnjoyCard],t[EActivityType.EnjoyCard1]=_.CommonConfig[EActivityType.EnjoyCard],t[EActivityType.EnjoyCard2]=_.CommonConfig[EActivityType.EnjoyCard],t[EActivityType.EnjoyCard3]=_.CommonConfig[EActivityType.EnjoyCard],t[EActivityType.EnjoyCard4]=_.CommonConfig[EActivityType.EnjoyCard],t[EActivityType.EnjoyCard5]=_.CommonConfig[EActivityType.EnjoyCard],t[EActivityType.SecondDiamondGifts]=_.CommonConfig[EActivityType.DiamondGifts],t[EActivityType.NewItemGifts]=_.CommonConfig[EActivityType.ItemGifts],t[EActivityType.NewItemGifts1]=_.CommonConfig[EActivityType.ItemGifts],t[EActivityType.NewItemGifts2]=_.CommonConfig[EActivityType.ItemGifts],t[EActivityType.SecondNewItemGifts]=_.CommonConfig[EActivityType.ItemGifts],t[EActivityType.NewNewItemGifts]=_.CommonConfig[EActivityType.NewNewItemGifts],t[EActivityType.TriggerGifts]={protoName:"GetTriggerGiftsInfo",getRewardName:"",formatString:"%s元礼包",checkNotice:function(e){}},t[EActivityType.FirstRecharge1]={protoName:"GetFirstRechargeInfo",getRewardName:"GetFirstRechargeReward",checkNotice:function(e){if(e&&e.data){for(var t=JSON.parse(e.content),i=(JSON.parse(e.data.rechargeTargeted),e.data.rewardTargeted,e.data.key,!1),n=0;n<=3;n++){for(var o=0;o<3;o++){var a=t[3*n+o],r=a[0],s=(a[1],a[2]),c=a[4],l=e.data.key,h=e.data.rewardTargeted,p=JSON.parse(e.data.rechargeTargeted),d=REWARD_STATUS.UNAVAILABLE;s<=l&&(d=REWARD_STATUS.AVAILABLE),0<=h.indexOf(r)&&(d=REWARD_STATUS.RECEIVED);var u=0;for(var g in p){var f=p[g];f[0]==s&&(u=f[1])}if(u<c&&(d=REWARD_STATUS.UNAVAILABLE),d==REWARD_STATUS.AVAILABLE){i=!0;break}}if(i)break}return i}}},t[EActivityType.BraveBook]={protoName:"GetBraveBookInfo",getRewardName:"",checkNotice:function(e){}},t[EActivityType.NewBraveBook]={protoName:"GetCommonActivityInfo",getRewardName:"",checkNotice:function(e){}},t[EActivityType.WholeLifeCard]={protoName:"GetWholeLifeCardInfo",getRewardName:"",checkNotice:function(e){return NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.MonthCard]),!1}},t[EActivityType.DailyLuxuryGifts]=_.CommonConfig[EActivityType.DailyLuxuryGifts],t[EActivityType.DailyLuxuryGifts1]=_.CommonConfig[EActivityType.DailyLuxuryGifts],t[EActivityType.DailyLuxuryGifts2]=_.CommonConfig[EActivityType.DailyLuxuryGifts],t[EActivityType.DailyLuxuryGifts3]=_.CommonConfig[EActivityType.DailyLuxuryGifts],t[EActivityType.DailyLuxuryGifts4]=_.CommonConfig[EActivityType.DailyLuxuryGifts],t[EActivityType.VipLevelGift]={protoName:"",getRewardName:"",checkNotice:function(e){return T.AppFacade.getInstance().retrieveProxy(T.RechargePy.N).checkVipGiftNotice()},isOpen:function(){return!Utils.SDKMgr.getPerformConfig(2)}},t[EActivityType.CommentLike]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.TouchGoldHandTask]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.TouchGoldHandTask1]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.ArenaChallengeTask]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.ArenaChallengeTask1]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.SmithyTimeTask]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.SmithyTimeTask1]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.SmithyTimeTask2]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.ChallengeCircleTask]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.ChallengeCircleTask1]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.ChallengeCircleTask2]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.QuoraNumTask]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.FriendShare]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.OneYuanGifts]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.OneYuanGifts2]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.NewOneYuanGifts]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.SixtyEightYuanGifts]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.NewYearWeekCrad]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.MysticalShopRefreshTask]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.MysticalShopRefreshTask1]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.GuildCollectTask]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.GuildCollectTask1]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.ActivityGashaponTask]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.ActivityGashaponTask1]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.SecondModuleGoalReward]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.ConsumeDiamondTask]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.CommonTask]=_.CommonConfig[EActivityType.CommonTask],t[EActivityType.CommonTask1]=_.CommonConfig[EActivityType.CommonTask],t[EActivityType.CommonTask2]=_.CommonConfig[EActivityType.CommonTask],t[EActivityType.CommonTask3]=_.CommonConfig[EActivityType.CommonTask],t[EActivityType.CommonTask4]=_.CommonConfig[EActivityType.CommonTask],t[EActivityType.CommonTask5]=_.CommonConfig[EActivityType.CommonTask],t[EActivityType.CommonTask6]=_.CommonConfig[EActivityType.CommonTask],t[EActivityType.CommonTask7]=_.CommonConfig[EActivityType.CommonTask],t[EActivityType.CommonTask8]=_.CommonConfig[EActivityType.CommonTask],t[EActivityType.CommonTask9]=_.CommonConfig[EActivityType.CommonTask],t[EActivityType.ZhongQiuTask]=_.CommonConfig[EActivityType.CommonTask],t[EActivityType.MagicalUpGradeTask]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.PetUpGradeTask]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.TreasureJewelTotalLevelTask]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.QuenchceMasterMaxLevelTask]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.HeroArtifactTotalBaptizeTask]=_.CommonConfig[EActivityType.MysticalShopRefreshTask],t[EActivityType.HeroArtifactUpStarTask]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(e){if(!e||!e.data)return!1;var t=JSON.parse(e.content),r=e.data.keyList,i=e.data.targeted;i[0]||(i=[]);var n=EActivityType.HeroArtifactUpStarTask,o=function(e){var t=0,i=(e+"").split("");for(var n in r){var o=(r[n].taskType+"").split(""),a=r[n].key;0==Number(i[i.length-4])?Number(i[i.length-5])==Number(o[o.length-5])&&(t+=a):Number(i[i.length-5])==Number(o[o.length-5])&&Number(i[i.length-4])==Number(o[o.length-4])&&(t+=a)}return t};for(var a in t){var s=t[a],c=s[0],l=(s[1]+"").split(""),h=Number(l[l.length-1]),p=o(s[1]),d=REWARD_STATUS.CANBUY;if(h<=p&&(d=REWARD_STATUS.AVAILABLE),0<=i.indexOf(c)&&(d=REWARD_STATUS.RECEIVED),n==EActivityType.ConsumeDiamondTask&&d==REWARD_STATUS.CANBUY&&(d=REWARD_STATUS.UNAVAILABLE),d==REWARD_STATUS.AVAILABLE)return!0}return!1}},t[EActivityType.HeroStarSubTypeNumTask]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(e){if(!e||!e.data)return!1;var t=JSON.parse(e.content),l=e.data.keyList,i=e.data.targeted;i[0]||(i=[]);var n=function(e){var t=0;e=Number(e);var i=Math.floor(e/1e4),n=Math.floor((e-1e4*i)/100);for(var o in l){var a=l[o].taskType,r=l[o].key,s=Math.floor(a/1e4),c=Math.floor((a-1e4*s)/100);0==i?n<=c&&(t+=r):i==s&&n<=c&&(t+=r)}return t};for(var o in t){var a=t[o],r=a[0],s=(a[1]+"").split(""),c=Number(s[s.length-1]),h=n(a[1]),p=REWARD_STATUS.CANBUY;if(c<=h&&(p=REWARD_STATUS.AVAILABLE),0<=i.indexOf(r)&&(p=REWARD_STATUS.RECEIVED),p==REWARD_STATUS.AVAILABLE)return!0}return!1}},t[EActivityType.TimerLuckyMoney]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(){var e=T.AppFacade.getInstance().retrieveProxy(T.ActivityPy.N).allActivityData[EActivityType.TimerLuckyMoney];if(!e||!e.data)return!1;var t=T.GameMgr.getInstance().serverTime(),i=JSON.parse(e.content),n=e.data.targeted,o=[],a=new Date(1e3*t);for(var r in a.setHours(0,0,0),o.push(a.getTime()/1e3),i[0]){var s=i[0][r],c=s[0],l=s[1],h=new Date(1e3*t);h.setHours(c[0],c[1],c[2]||0);var p=h.getTime()/1e3,d=new Date(1e3*t);d.setHours(l[0],l[1],l[2]||0);var u=d.getTime()/1e3;o.push(p),o.push(u)}for(var g=0;g<o.length-1;g++)if(t>=o[g]&&t<=o[g+1]){if(!0,g%2==0)return!1;var f=!1;for(var r in n){var _=n[r];if(_>=o[g]&&_<=o[g+1]){f=!0;break}}return!f}return!1}},t[EActivityType.CollectWords]={protoName:"GetCommonActivityInfo",getRewardName:"BuyExchangeGifts",checkNotice:function(e){if(!e||!e.data)return!1;var t,i=e.data.targeted,n=e.content,o=T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N),a=e.data.curCycle;for(var r in n[1]){if((c=n[1][r])[0]==a){t=c[1];break}}if(!t)return!1;for(var s=0;s<t.length;s++){var c,l=(c=t[s])[0],h=(c[1],c[2]),p=c[3],d=(REWARD_STATUS.UNAVAILABLE,0);for(var r in i){var u=i[r];if(u.id==l){d=u.num;break}}if(p<=d)REWARD_STATUS.RECEIVED;else if(h&&o.checkEnough(h,!1))return REWARD_STATUS.AVAILABLE,!0}return!1},cycle:!0},t[EActivityType.NewYearChallenge]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(e){if(!e||!e.data)return!1;var t=JSON.parse(e.content),i=e.data.sectionId>t[1].length?t[1].length-1:e.data.sectionId-1,n=t[1][i],o=(n[0],n[1]),a=[t[0]],r=T.GameMgr.getInstance().serverTime(),s=[];for(var c in a){var l=a[c],h=l[0],p=l[1],d=new Date(1e3*r);d.setHours(h[0],h[1],h[2]||0);var u=d.getTime()/1e3,g=new Date(1e3*r);g.setHours(p[0],p[1],p[2]||0);var f=g.getTime()/1e3;s.push(u),s.push(f)}var _=!1;r>=s[0]&&r<=s[1]&&(_=!0);var m=T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N);return!(!_||!m.checkEnough(o))}},t[EActivityType.HeroRollback]={protoName:"",getRewardName:"",checkNotice:void 0},t[EActivityType.HeroConvert]={protoName:"GetCommonActivityInfo",getRewardName:"HeroConvert",checkNotice:void 0},t[EActivityType.DailyLoginWeal]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:_.commonTargetNoticeCheck,cycle:!0},t[EActivityType.VipPreferentialGift]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(e){if(!e||!e.data)return!1;var t=JSON.parse(e.content)[0],i=e.data[0]&&e.data[0].times||0,n=t[1],o=t[2],a=T.GameMVC.playerPy.playerInfoVO.playerVip.vipLevel,r=REWARD_STATUS.UNAVAILABLE;n<=a&&(r=REWARD_STATUS.AVAILABLE);var s=void 0;for(var c in o){var l=o[c];if(l[0]==i+1){s=l;break}}s||(r=REWARD_STATUS.RECEIVED);var h=!1;switch(r){case REWARD_STATUS.UNAVAILABLE:h=!1;break;case REWARD_STATUS.AVAILABLE:h=T.GameMVC.backpackPy.checkEnough(s[1],!1);break;case REWARD_STATUS.RECEIVED:h=!1}return h}},t[EActivityType.ActivityGashapon]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(e){if(!e||!e.data)return!1;var t=e.content[0];return T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N).checkEnough(t,!1)}},t[EActivityType.NewZoneConsumeRank1]={protoName:"",getRewardName:"",checkNotice:void 0},t[EActivityType.ActivityGashapon1]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(e){if(!e||!e.data)return!1;var t=e.content[0];return T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N).checkEnough(t,!1)}},t[EActivityType.CommonShopSpecialItem]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.CommonShopSpecialItem1]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.CommonShopSpecialItem2]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.ZoneConsumeRank]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.DrawCardRatioImprove]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.DermaJump]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.DermaJump1]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.DermaJump2]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.DiamondRebate]={needPullWhenOpen:!0,protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation"},t[EActivityType.DrawCardRatioImprove1]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.NewHeroShow]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.ZoneAuction]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.WchessShow]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.MagpieActivity]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:void 0},t[EActivityType.RechargeRotate]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(e){var t=!1;return e&&e.data&&(t=0<e.data.times),t}},t[EActivityType.RechargeRotate1]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(e){var t=!1;return e&&e.data&&(t=0<e.data.times),t}},t[EActivityType.QQZoneVipGift]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0,isOpen:function(){return Utils.agentConfig.other.isJhb}},t[EActivityType.OneChoice]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0,isOpen:function(e){if(!e||!e.data)return!1;var t=e.content[(e.data.day||1)-1],i=e.data.targeted;for(var n in i){if(i[n][0]==t[0])return!1}return!0}},t[EActivityType.DiamondLottery]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(e){if(e&&e.data)return 0<e.data.count||0==e.data.recharge},needPullWhenOpen:!0},t[EActivityType.ProfessionSuit]={protoName:"GetCommonActivityInfo",getRewardName:"ActiveProfessionSuit",checkNotice:void 0},t[EActivityType.BasicHeroGifts]={protoName:"GetCommonActivityInfo",getRewardName:"",formatString:"%s元礼包",checkNotice:function(e){}},t[EActivityType.NewTurntable]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(e){return!(!e||!e.data)&&0<e.data.total}},t[EActivityType.EverydayTurntable]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",checkNotice:function(e){return!(!e||!e.data)&&0<e.data.total}},t[EActivityType.ZoneDevoteGoods]={protoName:"GetCommonActivityInfo",getRewardName:"",formatString:"%s元礼包",checkNotice:function(e){if(!e||!e.data)return!1;var t=e.data,i=JSON.parse(e.content),n=!1,o=function(e,t,i,n){var o=[];for(var a in i){var r=i[a],s=r[0],c=r[1],l=REWARD_STATUS.UNAVAILABLE;s<=e&&(l=REWARD_STATUS.AVAILABLE),0<=t.indexOf(s)&&(l=REWARD_STATUS.RECEIVED);var h={id:s,key:e,status:l,rewards:c,btnFunc:n};o.push(h)}return o};o(t.grade,t.targeted,i[1],void 0).forEach(function(e){e.status==REWARD_STATUS.AVAILABLE&&(n=!0)}),o(t.totalGrade,t.zoneTargeted,i[2],void 0).forEach(function(e){e.status==REWARD_STATUS.AVAILABLE&&(n=!0)});var a=i[4][1];return T.GameMVC.backpackPy.checkEnough(a,!1)&&(n=!0),n}},t[EActivityType.OtherDiamondGifts]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",formatString:"",checkNotice:function(e){if(e&&e.data){var n=e.data.day,o=e.data.amounts,a=JSON.parse(e.data.giftTargeted),r=JSON.parse(e.content),s=!1;T.ActivityOtherDiamondGifts.local_notice=[];var t=function(e){var t=r[e];if(t[2]<=n){var i=0;a.forEach(function(e){e[0]==t[0]&&(i=e)}),o<t[3]&&(s=!0,T.ActivityOtherDiamondGifts.local_notice[t[2]]=!0),i<t[5]&&T.GameMVC.backpackPy.checkEnough(t[4],!1)&&(T.ActivityOtherDiamondGifts.local_notice[t[2]]=!0,s=!0)}};for(var i in r)t(i);return s}}},t[EActivityType.NewGrowFund]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",formatString:"",checkNotice:function(e){if(e&&e.data){var t=!1,i=JSON.parse(e.content),n=e.data.targeted;if(!e.data.buy)return!1;for(var o=T.GameMVC.playerPy.playerInfoVO.level,a=0;a<i[1].length;a++){var r=i[1][a],s=r[0],c=(r[1],REWARD_STATUS.AVAILABLE);0<=n.indexOf(s)?c=REWARD_STATUS.RECEIVED:o<s&&(c=REWARD_STATUS.UNAVAILABLE),c==REWARD_STATUS.AVAILABLE&&(t=!0)}return t}},isOpen:function(e){if(!e||!e.data)return!1;var t=e.content;if(!e.data.buy)return!1;for(var i=e.data.targeted,n=T.GameMVC.playerPy.playerInfoVO.level,o=!0,a=0;a<t[1].length;a++){var r=t[1][a],s=r[0],c=(r[1],REWARD_STATUS.AVAILABLE);0<=i.indexOf(s)?c=REWARD_STATUS.RECEIVED:n<s&&(c=REWARD_STATUS.UNAVAILABLE),c!=REWARD_STATUS.RECEIVED&&(o=!1)}return!o}},t[EActivityType.EatingZongZi]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",formatString:"",checkNotice:function(e){if(!e||!e.data)return!1;var t=JSON.parse(e.content),i=t[1],n=T.GameMVC.backpackPy;for(var o in i){var a=i[o][1];if(n.checkEnough(a,!1))return!0}var r=e.data.integral||0,s=e.data.targeted,c=t[0];for(var o in c){var l=c[o][0];if(l<=r&&s.indexOf(l)<0)return!0}return!1}},t[EActivityType.DragonBoatGrade]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",formatString:"",checkNotice:function(e){if(!e||!e.data)return!1;var t=!1,i=JSON.parse(e.content),n=i[3],o=e.data.grade,a=e.data.targeted;for(var r in n){var s=n[r][0];if(s<=o&&a.indexOf(s)<0){t=!0;break}}var c=i[2];return T.GameMVC.backpackPy.checkEnough(c[0][0],!1)&&(t=!0),t}},t[EActivityType.ZoneFishing]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",formatString:"",checkNotice:function(e){if(!e||!e.data)return!1;var t=!1;if(0<e.data.playerInfo.snatchTimes)t=!0;else{var i=0,n=e.data.playerInfo.curCreelCode,o=e.content[2][n-1][2],a=e.data.playerInfo.creel;for(var r in a)i+=a[r][1];t=o<=i}return t}},t[EActivityType.ProfessionSuitReplacement]={protoName:"GetCommonActivityInfo",getRewardName:"GetCommonReward",formatString:"",checkNotice:function(e){if(!e||!e.data)return!1;return!1}},t[EActivityType.NewZoneGroupPurchase]={protoName:"GetCommonActivityInfo",getRewardName:"NewZoneGroupPurchasePurchase",formatString:"",checkNotice:function(e){if(!e||!e.data)return!1;var t=!1,i=JSON.parse(e.content),n=e.data.itemList;for(var o in i){var a=i[o],r=a[0],s=(a[1],a[2]),c=a[3],l=a[4],h=0,p=0;for(var d in n){var u=n[d];u.code==r&&(h=u.num,p=u.times)}var g=100;for(var f in l){var _=l[f];h>=_[0]&&(g=_[1])}var m=[[1,1,c*g/100]];if(p<s&&T.GameMVC.backpackPy.checkEnough(m,!1)){t=!0;break}}return t}},t[EActivityType.SecondDailyGifts]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(e){return!1},getEndDt:_.getActivityOneDayEndDt},t[EActivityType.VipWelfare]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(e){if(e&&e.data){for(var t=e.data.amounts,i=JSON.parse(e.data.dailyTargeted),s=JSON.parse(e.data.weekTargeted),n=JSON.parse(e.data.dailyAmountsTargeted),o=e.data.vip,c=T.GameMVC.playerPy.playerInfoVO.playerVip.vipLevel,a=JSON.parse(e.content),r=T.GameMVC.activityPy.allActivityData[EActivityType.WholeLifeCard],l=r&&r.data&&r.data.hasPurchased&&!0,h=!1,p=0;p<2;p++){var d=a[p];for(var u in d){var g=d[u];if(g[1]>=o&&g[1]<=c||0==p&&g[1]==c+1){var f=g[0],_=0==p?0:g[2],m=(0==p?g[2]:g[3],REWARD_STATUS.GO_RECHARGE);if(_<=t&&g[1]>=o&&g[1]<=c&&(m=REWARD_STATUS.AVAILABLE),0<=(0==p?i:n).indexOf(f)&&(m=REWARD_STATUS.RECEIVED),m==REWARD_STATUS.AVAILABLE&&l){h=!0;break}}}if(h)break}if(h)return h;h=!1,d=a[2];var y=T.GameMVC.playerPy.playerInfoVO.level,v=function(e){var t=d[e];if(y>=t[1]){var i=t[0],n=s,o=REWARD_STATUS.UNAVAILABLE;c>=t[2]&&(o=REWARD_STATUS.AVAILABLE);var a=0;n.forEach(function(e){e[0]==i&&(a=e[1])}),a>=t[3]&&(o=REWARD_STATUS.RECEIVED);var r=t[4];if(o==REWARD_STATUS.AVAILABLE&&T.GameMVC.backpackPy.checkEnough(r,!1))return h=!0,"break"}};for(var u in d){if("break"===v(u))break}return h||T.GameMVC.rechargePy.checkVipGiftNotice()}}},t[EActivityType.WeekFund]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(e){if(!e||!e.data)return!1;var t=!1,i=JSON.parse(e.content),n=e.data.amounts,o=e.data.targeted,a=e.data.day;for(var r in i[1]){var s=i[1][r],c=REWARD_STATUS.UNAVAILABLE;if(n>=i[0]&&a>=s[0]&&(c=REWARD_STATUS.AVAILABLE),0<=o.indexOf(s[0])&&(c=REWARD_STATUS.RECEIVED),c==REWARD_STATUS.AVAILABLE){t=!0;break}}return t}},t[EActivityType.WorldRechargeRank]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(e){return!1}},t[EActivityType.SecondLevelReward]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(e){if(!e||!e.data)return!1;for(var t=T.GameMVC.playerPy.playerInfoVO.level,i=JSON.parse(e.content),n=Utils.TimerManager.getServerTime(),o=0;o<2;o++)for(var a=0,r=i[o],s=0==o?e.data.diamondTargeted:e.data.rechargeTargeted,c=0==o?e.data.diamondGifts:e.data.rechargeGifts,l=0;l<r.length;l++){var h=0,p=r[l],d=p[0],u=p[1];if(2==a)break;for(var g in c){if((_=c[g])[0]==d){h=_[1];break}}if(!(h<=n)){var f=REWARD_STATUS.UNAVAILABLE;for(var g in u<=t?f=REWARD_STATUS.CANBUY:a++,s){var _;if((_=s[g])[0]==d){0<_[1]&&(f=REWARD_STATUS.RECEIVED);break}}if(f==REWARD_STATUS.CANBUY)return!0}}return!1},isOpen:function(e){if(!e||!e.data)return!1;for(var t=T.GameMVC.playerPy.playerInfoVO.level,i=JSON.parse(e.content),n=Utils.TimerManager.getServerTime(),o=0;o<2;o++)for(var a=0,r=i[o],s=0==o?e.data.diamondTargeted:e.data.rechargeTargeted,c=0==o?e.data.diamondGifts:e.data.rechargeGifts,l=0;l<r.length;l++){var h=0,p=r[l],d=p[0],u=p[1];if(2==a)break;for(var g in c){if((_=c[g])[0]==d){h=_[1];break}}var f=REWARD_STATUS.UNAVAILABLE;for(var g in u<=t?f=REWARD_STATUS.CANBUY:a++,s){var _;if((_=s[g])[0]==d){0<_[1]&&(f=REWARD_STATUS.RECEIVED);break}}if(f==REWARD_STATUS.CANBUY&&n<h||f==REWARD_STATUS.UNAVAILABLE)return!0}return!1}},t[EActivityType.Quora]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(e){return!(!e||!e.data)&&!e.data.isTargeted}},t[EActivityType.NewZoneQuora]={protoName:"GetCommonActivityInfo",getRewardName:"GetZoneQuoraReward",checkNotice:function(e){if(!e||!e.data)return!1;var t=JSON.parse(e.content)[0][0];return!!Utils.TimerManager.checkIsOpen_FormatA(t).isOpen}},t[EActivityType.MidAutumn]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0},t[EActivityType.MidAutumnSun]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:function(e){return!(!e||!e.data)&&0<e.data.shootTimes}},t[EActivityType.RandomEvent]={protoName:"GetCommonActivityInfo",getRewardName:"DoCommonOperation",checkNotice:void 0},t),_}();T.ActivityConfig=i,__reflect(i.prototype,"game.ActivityConfig")}(game||(game={})),function(Y){var e=function(i){function j(e){void 0===e&&(e=null);var t=i.call(this,j.N,e)||this;return t.activityProxy=Y.AppFacade.getInstance().retrieveProxy(Y.ActivityPy.N),t._viewIdCache={},t.ActivityTriggerList=[],t}return __extends(j,i),j.prototype.initSubView=function(){this.addSubView(j.SV.MAIN,Y.ActivityRootPanel),this.addSubView(j.SV.MID_AUTUMN_IDEL_REWARD,Y.ActivityMidAutumnIdelRewardPanel),this.addSubView(j.SV.MID_ALL_GIFT,Y.ActivityMidAutumnRewardAllPanel)},j.prototype.initSubviewByCode=function(){this.addSubviewByCode(EActivityType.SignIn,Y.ActivitySignIn),this.addSubviewByCode(EActivityType.LevelReward,Y.ActivityLevelReward),this.addSubviewByCode(EActivityType.ExchangeCode,Y.ActivityExchangeCode),this.addSubviewGroup2("SecondOpenServerRecharge",Y.ActivitySecondOpenServerRecharge,0,20),this.addSubviewByCode(EActivityType.ThirdOpenServerRecharge,Y.ActivitySecondOpenServerRecharge),this.addSubviewByCode(EActivityType.ThirdOpenServerRecharge1,Y.ActivitySecondOpenServerRecharge),this.addSubviewByCode(EActivityType.ThirdOpenServerRecharge2,Y.ActivitySecondOpenServerRecharge),this.addSubviewByCode(EActivityType.FourthOpenServerRecharge,Y.ActivitySecondOpenServerRecharge),this.addSubviewByCode(EActivityType.FourthOpenServerRecharge1,Y.ActivitySecondOpenServerRecharge),this.addSubviewByCode(EActivityType.FourthOpenServerRecharge2,Y.ActivitySecondOpenServerRecharge),this.addSubviewByCode(EActivityType.FourthOpenServerRecharge3,Y.ActivitySecondOpenServerRecharge),this.addSubviewByCode(EActivityType.QqzoneOpenServerRecharge,Y.ActivitySecondOpenServerRecharge),this.addSubviewByCode(EActivityType.FifthOpenServerRecharge,Y.ActivityFifthOpenServerRecharge),this.addSubviewByCode(EActivityType.FifthOpenServerRecharge1,Y.ActivityFifthOpenServerRecharge),this.addSubviewByCode(EActivityType.FifthOpenServerRecharge2,Y.ActivityFifthOpenServerRecharge),this.addSubviewByCode(EActivityType.FifthOpenServerRecharge3,Y.ActivityFifthOpenServerRecharge),this.addSubviewByCode(EActivityType.SecondContinueRechargeReward,Y.ActivitySecondContinueRechargeReward),this.addSubviewByCode(EActivityType.SecondContinueRechargeReward1,Y.ActivitySecondContinueRechargeReward),this.addSubviewByCode(EActivityType.SecondContinueRechargeReward2,Y.ActivitySecondContinueRechargeReward),this.addSubviewByCode(EActivityType.SecondContinueRechargeReward3,Y.ActivitySecondContinueRechargeReward),this.addSubviewGroup2("SeventhOpenServerRecharge",Y.ActivitySeventhOpenServerRecharge,0,20),this.addSubviewByCode(EActivityType.SingleRecharge,Y.ActivitySingleRecharge),this.addSubviewByCode(EActivityType.ActivityShop,Y.ActivityShop),this.addSubviewByCode(EActivityType.MonthCard,Y.ActivityMonthCard),this.addSubviewByCode(EActivityType.EnjoyCard,Y.ActivityEnjoyCardView),this.addSubviewByCode(EActivityType.EnjoyCard1,Y.ActivityEnjoyCardView),this.addSubviewByCode(EActivityType.EnjoyCard2,Y.ActivityEnjoyCardView),this.addSubviewByCode(EActivityType.EnjoyCard3,Y.ActivityEnjoyCardView),this.addSubviewByCode(EActivityType.EnjoyCard4,Y.ActivityEnjoyCardView),this.addSubviewByCode(EActivityType.EnjoyCard5,Y.ActivityEnjoyCardView),this.addSubviewByCode(EActivityType.ExtremeBattle,Y.ActivityExtremeChallengeView),this.addSubviewByCode(EActivityType.LuckyRotate,Y.ActivityLuckyRotateView),this.addSubviewByCode(EActivityType.LuckyRotate1,Y.ActivityLuckyRotateView),this.addSubviewByCode(EActivityType.CollectHero,Y.ActivityCollectHeroView),this.addSubviewByCode(EActivityType.DailyLogin,Y.ActivityDailyLogin),this.addSubviewByCode(EActivityType.DiamondReward,Y.ActivityCommonTargetListView),this.addSubviewGroup2("FlashCapsuleHigh",Y.ActivityCommonTargetListView,0,12),this.addSubviewByCode(EActivityType.FlashCapsuleRace,Y.ActivityCommonTargetListView),this.addSubviewByCode(EActivityType.FlashCapsuleRace1,Y.ActivityCommonTargetListView),this.addSubviewByCode(EActivityType.FlashCapsuleRace2,Y.ActivityCommonTargetListView),this.addSubviewByCode(EActivityType.FlashCapsuleRace3,Y.ActivityCommonTargetListView),this.addSubviewByCode(EActivityType.RiskLayer,Y.ActivityCommonTargetListView),this.addSubviewGroup2("DiscountGiftBag",Y.ActivityCommonRechargeListView,0,26),this.addSubviewGroup2("DiscountGiftBagDaily",Y.ActivityCommonRechargeListView,0,10),this.addSubviewByCode(EActivityType.AwakenGiftBag,Y.ActivityAwakenGiftBag),this.addSubviewByCode(EActivityType.WeekGift,Y.ActivityCommonRechargeListView),this.addSubviewByCode(EActivityType.MonthGift,Y.ActivityCommonRechargeListView),this.addSubviewGroup2("DiamondGifts",Y.ActivityDiamondGifts,0,10),this.addSubviewByCode(EActivityType.SecondDiamondGifts,Y.ActivityDiamondGifts),this.addSubviewGroup2("ItemGifts",Y.ActivityItemGifts,0,15),this.addSubviewByCode(EActivityType.CollectWords,Y.ActivityItemGifts),this.addSubviewByCode(EActivityType.TriggerGifts,Y.ActivityTriggerGiftsView),this.addSubviewByCode(EActivityType.BasicHeroGifts,Y.ActivityTriggerGiftsView),this.addSubviewByCode(EActivityType.FirstRecharge1,Y.ActivityFirstRechargeView),this.addSubviewByCode(EActivityType.DailyLuxuryGifts,Y.ActivityDailyLuxuryGifts),this.addSubviewByCode(EActivityType.DailyLuxuryGifts1,Y.ActivityDailyLuxuryGifts),this.addSubviewByCode(EActivityType.DailyLuxuryGifts2,Y.ActivityDailyLuxuryGifts),this.addSubviewByCode(EActivityType.DailyLuxuryGifts3,Y.ActivityDailyLuxuryGifts),this.addSubviewByCode(EActivityType.DailyLuxuryGifts4,Y.ActivityDailyLuxuryGifts),this.addSubviewByCode(EActivityType.VipLevelGift,Y.ActivityVipGift),this.addSubviewByCode(EActivityType.CommentLike,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.TouchGoldHandTask,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.TouchGoldHandTask1,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.ArenaChallengeTask,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.ArenaChallengeTask1,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.SmithyTimeTask,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.SmithyTimeTask1,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.SmithyTimeTask2,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.ChallengeCircleTask,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.ChallengeCircleTask1,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.ChallengeCircleTask2,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.MysticalShopRefreshTask,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.MysticalShopRefreshTask1,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.GuildCollectTask,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.GuildCollectTask1,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.ActivityGashaponTask,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.ActivityGashaponTask1,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.SecondModuleGoalReward,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.QuoraNumTask,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.MagicalUpGradeTask,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.PetUpGradeTask,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.TreasureJewelTotalLevelTask,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.QuenchceMasterMaxLevelTask,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.HeroArtifactTotalBaptizeTask,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.HeroArtifactUpStarTask,Y.ActivityHeroArtifactUpTaskView),this.addSubviewByCode(EActivityType.ConsumeDiamondTask,Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.NewZoneConsumeRank1,Y.ActivityNewZoneConsumeRank1View),this.addSubviewGroup([EActivityType.CommonTask,EActivityType.CommonTask1,EActivityType.CommonTask2,EActivityType.CommonTask3,EActivityType.CommonTask4,EActivityType.CommonTask5,EActivityType.CommonTask6,EActivityType.CommonTask7,EActivityType.CommonTask8,EActivityType.CommonTask9],Y.ActivityCommonTaskView),this.addSubviewByCode(EActivityType.FriendShare,Y.ActivityFriendShare),this.addSubviewByCode(EActivityType.OneYuanGifts,Y.ActivityOneYuanGifts),this.addSubviewByCode(EActivityType.OneYuanGifts2,Y.ActivitySixtyEightYuanGifts),this.addSubviewByCode(EActivityType.WeChatShare,Y.ActivityWeChatShareCommonPanel),this.addSubviewByCode(EActivityType.NewYearWeekCrad,Y.ActivityNewYearWeekCrad),this.addSubviewByCode(EActivityType.NewYearChallenge,Y.ActivityNewYearChallenge),this.addSubviewGroup2("DailyLoginWeal",Y.ActivityDailyLoginWeal,0,15),this.addSubviewByCode(EActivityType.TimerLuckyMoney,Y.ActivityTimerLuckyMoney),this.addSubviewByCode(EActivityType.ActivityGashapon,Y.ActivityGashaponView),this.addSubviewByCode(EActivityType.ActivityGashapon1,Y.ActivityGashaponView),this.addSubviewByCode(EActivityType.HeroRollback,Y.ActivityHeroRollBackView),this.addSubviewByCode(EActivityType.HeroConvert,Y.ActivityHeroConvertView),this.addSubviewByCode(EActivityType.CommonShopSpecialItem,Y.ActivityCommonShopSpecialItem),this.addSubviewByCode(EActivityType.CommonShopSpecialItem1,Y.ActivityCommonShopSpecialItem),this.addSubviewByCode(EActivityType.CommonShopSpecialItem2,Y.ActivityCommonShopSpecialItem),this.addSubviewByCode(EActivityType.SixtyEightYuanGifts,Y.ActivitySixtyEightYuanGifts),this.addSubviewByCode(EActivityType.DrawCardRatioImprove,Y.ActivityDrawCardRatioImprove),this.addSubviewByCode(EActivityType.DrawCardRatioImprove1,Y.ActivityDrawCardRatioImprove),this.addSubviewByCode(EActivityType.DermaJump,Y.ActivityDrawCardRatioImprove),this.addSubviewByCode(EActivityType.DermaJump1,Y.ActivityDrawCardRatioImprove),this.addSubviewByCode(EActivityType.DermaJump2,Y.ActivityDrawCardRatioImprove),this.addSubviewByCode(EActivityType.NewBraveBook,Y.ActivityBraveBookViewNew),this.addSubviewByCode(EActivityType.ZoneAuction,Y.ActivityAuctionEntry),this.addSubviewByCode(EActivityType.ZoneAuction1,Y.ActivityAuction),this.addSubviewByCode(EActivityType.OneChoice,Y.ActivityOneChoice),this.addSubviewByCode(EActivityType.WchessShow,Y.ActivityWchessShow),this.addSubviewGroup2("HuntTreasure",Y.ActivityTreasureHunter,0,5),this.addSubviewByCode(EActivityType.RechargeRotate,Y.ActivityTreasureHunter),this.addSubviewByCode(EActivityType.RechargeRotate1,Y.ActivityTreasureHunter),this.addSubviewGroup2("ProfessionSuit",Y.ActivityProfessionSuitView,0,5),this.addSubviewByCode(EActivityType.NewItemGifts,Y.ActivityNewItemGifts),this.addSubviewByCode(EActivityType.NewItemGifts1,Y.ActivityNewItemGifts),this.addSubviewByCode(EActivityType.NewItemGifts2,Y.ActivityNewItemGifts),this.addSubviewByCode(EActivityType.NewNewItemGifts,Y.ActivityNewNewItemGifts),this.addSubviewByCode(EActivityType.ZoneDevoteGoods,Y.ActivityZoneDevoteGoods),this.addSubviewGroup2("WishGifts",Y.ActivityWishGifts,0,11),this.addSubviewByCode(EActivityType.NewHeroShow,Y.ActivityNewHeroShow),this.addSubviewByCode(EActivityType.OtherDiamondGifts,Y.ActivityOtherDiamondGifts),this.addSubviewByCode(EActivityType.NewGrowFund,Y.ActivityNewGrowFund),this.addSubviewByCode(EActivityType.QQZoneVipGift,Y.VIPPrivilegeView),this.addSubviewByCode(EActivityType.EatingZongZi,Y.ActivityEatingZongZi),this.addSubviewByCode(EActivityType.DragonBoatGrade,Y.ActivityDragonBoatGrade),this.addSubviewByCode(EActivityType.DiamondRebate,Y.ActivityDiamondRebateView),this.addSubviewByCode(EActivityType.NewZoneGroupPurchase,Y.ActivityNewZoneGroupPurchase),this.addSubviewByCode(EActivityType.InvitationCode,Y.ActivityInviteCode),this.addSubviewByCode(EActivityType.PushGiftBag,Y.ActivityPushGiftBag),this.addSubviewByCode(EActivityType.NewOneYuanGifts,Y.ActivityNewYuanGiftsByRandom),this.addSubviewGroup2("ContinueRechargeReward",Y.ActivityContinueRechargeReward,0,4),this.addSubviewGroup2("ThirdDiamondGifts",Y.ActivityThirdDiamondGifts,0,20),this.addSubviewByCode(EActivityType.VipPreferentialGift,Y.ActivityVipPreferentialGift),this.addSubviewGroup2("WishTree",Y.Activity162,0,20),this.addSubviewGroup2("DiamondLottery",Y.Activity170,0,0),this.addSubviewByCode(EActivityType.BlessingBox,Y.Activity163),this.addSubviewByCode(EActivityType.HeroStarSubTypeNumTask,Y.Activity173),this.addSubviewByCode(EActivityType.SecondDailyGifts,Y.Activity174),this.addSubviewByCode(EActivityType.VipWelfare,Y.Activity175),this.addSubviewGroup2("WeekFund",Y.Activity176,0,10),this.addSubviewByCode(EActivityType.WorldRechargeRank,Y.Activity177),this.addSubviewByCode(EActivityType.SecondLevelReward,Y.Activity179),this.addSubviewByCode(EActivityType.ProfessionSuitReplacement,Y.ActivityChangeEqui),this.addSubviewByCode(EActivityType.Quora,Y.Activity184),this.addSubviewByCode(EActivityType.NewZoneQuora,Y.Activity186),this.addSubviewByCode(EActivityType.ShiMingRenZheng,Y.ActivitySDKSMRZView),this.addSubviewByCode(EActivityType.WeiDuanXiaZai,Y.ActivitySDKWDXZView),Utils.isXYX()?(this.addSubviewByCode(EActivityType.ShouCangYouLi,Y.ActivityGZGZHView),this.addSubviewByCode(EActivityType.GuanZhuGongZhongHao,Y.ActivityGZGZHView)):(this.addSubviewByCode(EActivityType.ShouCangYouLi,Y.ActivityShouCangYouLiView),this.addSubviewByCode(EActivityType.GuanZhuGongZhongHao,Y.ActivitySDKGZHView)),this.addSubviewByCode(EActivityType.NewTurntable,Y.ActivityNewTurnTable),this.addSubviewByCode(EActivityType.EverydayTurntable,Y.ActivityEverydayTurnTable),this.addSubviewByCode(EActivityType.TodayActivity,Y.ActivityTodayShowPanel),this.addSubviewByCode(EActivityType.MidAutumn,Y.ActivityMidAutumnMainView),this.addSubviewByCode(EActivityType.MidAutumnSun,Y.ActivityMidAutumnArcheryPanel)},j.prototype.initNotice=function(){},j.prototype.listNotificationInterests=function(){return[CN.LOGIN_FINAL_DONE,CN.HIDE_ALL_SUBVIEW,CN.PLAYER_LEVEL_UP,CN.ACTIVITY_ADD_TRIGGER,CN.ACTIVITY_SHOW_TRIGGER,CN.ACTIVITY_BASIC_HERO_GIFG_UPDATE,CN.MONEY_UPDATE,CN.SHOW_WECHAT_SHARE,CN.ADD_WECHAT_SHARE_INFO,CN.GENERAL_PASS_DAY,CN.ACTIVITY_MID_ALLGIFT_UPDATE,CN.QQZONE_GIFT_VIEW,CN.PLAYER_INFO_ERROR,CN.QQZONE_PUSH_MESSAGE,CN.QQZONE_POPUP_VIEW,CN.GUIDE_FIRST_CHARPTER_END,CN.FIRST_INTO_CITY_FOR_EVERYDAY]},j.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.LOGIN_FINAL_DONE:this.initSubviewByCode(),this.activityProxy.GetActivityList(),this.activityProxy.GetRelationInfo(RelationType.Recommend),this.sendNotification(CN.QQZONE_POPUP_VIEW,{type:4}),this.sendNotification(CN.QQZONE_GIFT_VIEW);break;case CN.GENERAL_PASS_DAY:this.activityProxy.GetActivityList();break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.PLAYER_LEVEL_UP:NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.LevelReward]),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.NewGrowFund]),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.SecondLevelReward]);break;case CN.ACTIVITY_ADD_TRIGGER:this.ActivityTriggerList.push(t);break;case CN.FIRST_INTO_CITY_FOR_EVERYDAY:if(Y.GameMVC.activityPy.isOpen(EActivityType.PushGiftBag)){if(!(d=Y.GameMVC.activityPy.allActivityData[EActivityType.PushGiftBag])||!d.data)return;if(!Utils.UnlockMgr.checkPass(MODULE.Activity+EActivityType.PushGiftBag,!1).allow)return;var i=Utils.TimerManager.getServerOpenDays(),n=d.data.vipLevel,o=JSON.parse(d.content),a=[];for(var r in o){var s=o[r];if(s[0]==i)for(var c in s[1]){var l=s[1][c];l[1]==n&&(a=l[0])}}if(!a)return;if(!(P=Y.GameMVC.rechargePy.getGoodInfo(a)))return;Y.GameMVC.activityMed.showViewByCode(EActivityType.PushGiftBag)}break;case CN.ACTIVITY_SHOW_TRIGGER:if(t&&t.clear)return void(this.ActivityTriggerList=[]);if(0<this.ActivityTriggerList.length){var h=Y.AppFacade.getInstance().retrieveProxy(Y.ActivityPy.N),p=EActivityType.TriggerGifts,d=h.allActivityData[p],u=JSON.parse(d.content),g=Y.AppFacade.getInstance().retrieveProxy(Y.RechargePy.N).goodList;Utils.TimerManager.getServerTime();for(var f in this.ActivityTriggerList){var _=this.ActivityTriggerList[f],m=0;for(var r in u[0]){var y=u[0][r];y[0]==_.code&&(m=y[1])}if(m){var v=void 0;for(var T in g){if(m==(P=g[T]).id){v=P;break}}var C="\n",E=0;if(_.triggerType==TriggerGiftsTriggerType.TeamLevelUp)C="恭喜你激活了%s级等级礼包，\n是否前往购买",E=_.triggerKey;else if(_.triggerType==TriggerGiftsTriggerType.HeroUpStar){C="恭喜你激活了%s星英雄成长礼包，\n是否前往购买",(o=Y.Config.allHeroConfig()[_.triggerKey])&&o.initStar&&(E=o.initStar)}if(v){Y.GameMgr.getInstance().showCommonTipsWin({commonTips:C.format([E]),cost:"[]",btnStyle:{cancel:Y.CommonTipsDialog.BTN_STYLE.CANCEL,confirm:Y.CommonTipsDialog.BTN_STYLE.GOTO},clickCB:function(e){1==e.type&&Y.MainJumpConfig.jumpTo(MODULE.Activity+EActivityType.TriggerGifts)}});break}}}this.ActivityTriggerList=[]}break;case CN.ACTIVITY_BASIC_HERO_GIFG_UPDATE:if(d=Y.GameMVC.activityPy.allActivityData[EActivityType.BasicHeroGifts]){var b=JSON.parse(d.content),I=d.data.gifts[0];if(I){var A=b[0][I.code-1],P=void 0;g=Y.GameMVC.rechargePy.goodList;for(var E in g){var S=g[E];if(A[1]==S.id){P=S;break}}if(P){var N=I.triggerKey,M="";N&&(M=Y.Config.allHeroConfig()[N].name),Y.GameMgr.getInstance().showCommonTipsWin({commonTips:"恭喜激活了英雄礼包"+(""==M?"":"-"+M)+"，\n是否前往购买？",btnStyle:{cancel:Y.CommonTipsDialog.BTN_STYLE.CANCEL,confirm:Y.CommonTipsDialog.BTN_STYLE.GOTO},clickCB:function(e){1==e.type&&Y.MainJumpConfig.jumpTo(MODULE.Activity+EActivityType.BasicHeroGifts)}})}}else Y.GameMVC.activityMed.updateViewByCode(EActivityType.TriggerGifts)}break;case CN.ACTIVITY_MID_ALLGIFT_UPDATE:(w=this.getSubView(j.SV.MID_ALL_GIFT))&&w.updateView(),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.MidAutumn]);break;case CN.MONEY_UPDATE:var w;(w=this.getSubView(j.SV.MAIN))&&w.updateResourceBar(),Y.GameMVC.activityMed.updateViewByCode(EActivityType.TriggerGifts),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.NewZoneGroupPurchase]),Y.GameMVC.activityMed.updateViewByCode(EActivityType.MidAutumnSun);break;case CN.ADD_WECHAT_SHARE_INFO:this.shareInfo=t.type;break;case CN.SHOW_WECHAT_SHARE:p=this.shareInfo;if(t&&t.filter&&p!=WeChatTargetType.ObtainFiveStarHero)return;if(p)Y.AppFacade.getInstance().retrieveMediator(j.N).showViewByCode(EActivityType.WeChatShare,{type:this.shareInfo});this.shareInfo=void 0;break;case CN.PLAYER_INFO_ERROR:if(t&&10143==t.error){Utils.Socket.needReconnect=!1;var k={tips:"该账号已在其他地方登陆，是否刷新游戏？",clickCB:void 0};Utils.SDKMgr.cmd({type:"DingHaoTiShi"},function(e){e&&e.tips&&(k.tips=e.tips),e&&e.clickCB&&(k.clickCB=e.clickCB)}),Y.GameMgr.getInstance().showCommonTipsWin({clickDarkClose:!1,noOKBtn:!0,commonTips:k.tips,btnStyle:{cancel:Y.CommonTipsDialog.BTN_STYLE.CONFIRM},clickCB:function(e){k.clickCB?k.clickCB():Y.GameMgr.getInstance().restart()}})}break;case CN.GUIDE_FIRST_CHARPTER_END:Y.GameMVC.playerPy.checkAndPopSthWhenFirstGuideEnd();break;case CN.QQZONE_POPUP_VIEW:if(!Utils.SDKMgr.getPerformConfig(10021))return;if(1==(p=t.type))PopUpManager.addPopUp({obj:new Y.QQLiveView({cb:t&&t.cb})});else if(2==p){Y.AppFacade.getInstance().retrieveMediator(j.N).showViewByCode(EActivityType.ShouCangYouLi)}else if(3==p){var R=Utils.SDKMgr.extraFuncForAgent({type:"canShow",params:{type:"downloadGameAPP"}}),U=Utils.agentConfig.other.packName&&""!=Utils.agentConfig.other.packName;if(getUrlKV().qua&&"PC"==getUrlKV().qua.app||!R||!U)return;var x=-1!=Y.GameMVC.activityPy.giftList.indexOf(1101),O=-1!=Y.GameMVC.activityPy.giftList.indexOf(1102),L=Utils.SDKMgr.extraFuncForAgent({type:"appDownload"}),D="gameApp"!=getUrlKV().channel&&(L&&O||!L&&!O)&&!x,B="gameApp"==getUrlKV().channel&&L&&O&&!x;1==getUrlKV().platform&&(D||B)&&PopUpManager.addPopUp({obj:new Y.NativeDownloadView})}else if(4==p&&getUrlKV().channel){var V=getUrlKV().channel,G=Y.GameMVC.activityPy.giftList;"1"!=Utils.LocalStorageUtil.getItem(V)&&("huangzuan"==V&&-1==G.indexOf(2403)||"QQVip"==V&&-1==G.indexOf(2404))&&(Utils.LocalStorageUtil.setItem(V,"1"),PopUpManager.addPopUp({obj:new Y.QQCommonGiftView({type:V})}))}break;case CN.QQZONE_PUSH_MESSAGE:if(Utils.agentConfig.other.isJhb){var F=t.data;switch(t.type){case"playerLevelUp":Math.floor(F.newLevel/10)>Math.floor(F.oldLevel/10)&&Y.GameMVC.activityPy.pushMessageToFriends({content:"达到"+F.newLevel+"等级，快来一起打怪升级呀！"});break;case"areanChallenge":Y.GameMVC.activityPy.pushMessageToFriends({source:MODULE.Arena,content:"你们的竞技场排名已经被我取代了，就问你服不服？"});break;case"championAchievement":F.id%10==0&&Y.GameMVC.activityPy.pushMessageToFriends({source:MODULE.Champion,content:"永恒之塔已经挑战至"+F.targetId+"层了，抓紧时间和他交流一下经验吧。"});break;case"worldKingRank":if(F.oldLevel&&F.curLevel>F.oldLevel){var H=Y.Config.worldKingLevelConfig()[F.curLevel].name;Y.GameMVC.activityPy.pushMessageToFriends({source:MODULE.WorldKing,content:"在排位赛中达成"+H+"段位，赶紧上线挑战吧，可不能被人小瞧。"})}}}break;case CN.QQZONE_GIFT_VIEW:if(Utils.agentConfig.other.isJhb){var W=getUrlKV().GIFT;W&&Y.GameMVC.activityPy.getGiftReward({giftId:W})}}},j.prototype.addSubviewByCode=function(e,t){var i=this.encodeActCode2string(e);i&&""!=i&&this.addSubView(i,t)},j.prototype.addSubviewGroup=function(e,t){for(var i=0;i<e.length;i++)this.addSubviewByCode(e[i],t)},j.prototype.addSubviewGroup2=function(e,t,i,n){void 0===i&&(i=0),void 0===n&&(n=0);for(var o=i;o<=n;o++){var a=o?EActivityType[e+o]:EActivityType[e];a&&this.addSubviewByCode(a,t)}},j.prototype.updateViewByCode=function(e,t){t?t.activityType=e:t={activityType:e},this.updateView(this.encodeActCode2string(e),t)},j.prototype.getViewByCode=function(e){var t=this.encodeActCode2string(e);return this.getSubView(t)},j.prototype.showViewByCode=function(e,t){var i=this,n=this.encodeActCode2string(e),o=parseInt(n.split("#")[0]),a=Y.ActivityConfig.Config[e];(a&&a.needPullWhenOpen&&this.activityProxy.GetActivityInfo(e,function(){i.updateViewByCode(e)}),o)?this.getSubView(j.SV.MAIN)?(t?t.activityType=e:t={activityType:e},this.showSubView(n,t)):this.showSubView(j.SV.MAIN,{viewType:o,code:e}):this.showSubView(n,t)},j.prototype.hideViewByCode=function(e){this.hideSubView(this.encodeActCode2string(e))},j.prototype.encodeActCode2string=function(e){if(!this._viewIdCache[e]){var t=Y.Config.activityConfigs()[e],i=0;t&&t.inList?(i=t.entrance,this._viewIdCache[e]=i+"#"+e):this._viewIdCache[e]="0#"+e}return this._viewIdCache[e]},j.prototype.updateBtn=function(e,t){switch(t){case REWARD_STATUS.UNAVAILABLE:e.label="领取",UIActionManager.setGrey(e,!0),e.skinName="skins.ButtonSkinYellow",e.scaleX=e.scaleY=.8;break;case REWARD_STATUS.RECEIVED:e.skinName="skins.ButtonSkinSure",e.label="已领取",UIActionManager.setGrey(e,!1),e.scaleX=e.scaleY=1;break;case REWARD_STATUS.CANBUY:e.skinName="skins.ButtonSkinYellow",e.label="购买",UIActionManager.setGrey(e,!1),e.scaleX=e.scaleY=.8;break;case REWARD_STATUS.HASBUY:e.skinName="skins.ButtonSkinSure",e.label="已购买",UIActionManager.setGrey(e,!1),e.scaleX=e.scaleY=1;break;case REWARD_STATUS.GO_RECHARGE:e.skinName="skins.ButtonSkinYellow",e.label="充值",UIActionManager.setGrey(e,!1),e.scaleX=e.scaleY=.8;break;case REWARD_STATUS.UNAVAILABLE_BUY:e.skinName="skins.ButtonSkinYellow",e.label="购买",UIActionManager.setGrey(e,!0),e.scaleX=e.scaleY=.8;break;case REWARD_STATUS.NEXT_REWARD:e.visible=!1;break;default:e.label="领取",UIActionManager.setGrey(e,!1),e.skinName="skins.ButtonSkinYellow",e.scaleX=e.scaleY=.8}},j.prototype.showHelpDialog=function(e){var t=[];for(var i in e){var n=e[i];for(var o in n){var a=n[o];parseInt(o)%2==0?t.push({text:a}):t.push({text:a,style:{textColor:36807}})}t.push({text:"\n"})}PopUpManager.addPopUp({obj:new Y.HelpDialog({text:t})})},j.N="ActivityMediator",j.SV={MAIN:1,FISHINGSHOP:2,FISHINGCHALLGE:3,MAGPIE_GIFT:4,MAGPIE_GIFT_ALL:5,MID_AUTUMN_IDEL_REWARD:6,MID_ALL_GIFT:7},j}(BaseMediator);Y.ActivityMediator=e,__reflect(e.prototype,"game.ActivityMediator")}(game||(game={})),function(_){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new n).register(),(new h).register(),(new i).register(),(new c).register(),(new s).register(),(new l).register(),(new p).register(),(new d).register(),(new u).register(),(new g).register(),(new r).register(),(new a).register(),(new o).register(),(new f).register(),(new m).register(),(new y).register(),(new v).register(),(new T).register(),(new C).register()},e}();_.ActivityProcessor=e,__reflect(e.prototype,"game.ActivityProcessor");var t=function(e){function t(){return e.call(this,"activity.FlashCapsuleInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("FlashCapsuleInfoP",t),_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N).allActivityData[EActivityType.FlashCapsuleHigh].updateData(t.info)},t}(_.ProcessorBase);__reflect(t.prototype,"FlashCapsuleInfoP");var i=function(e){function t(){return e.call(this,"activity.SecondOpenServerRechargeInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("SecondOpenServerRechargeInfoP",t);var i=EActivityType.SecondOpenServerRecharge;(_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N).allActivityData[i].updateData(t.info),t.clientReward)&&_.AppFacade.getInstance().retrieveProxy(_.BackpackPy.N).handleClientReward(t.clientReward,2)},t}(_.ProcessorBase);__reflect(i.prototype,"SecondOpenServerRechargeInfoP");var n=function(e){function t(){return e.call(this,"activity.ActivityBaseInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("ActivityBaseInfoP",t);var i=t.code;_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N).updateData_View_Reward(i,t),i!=EActivityType.OneYuanGifts&&i!=EActivityType.SixtyEightYuanGifts&&i!=EActivityType.OneYuanGifts2||_.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN)},t}(_.ProcessorBase);__reflect(n.prototype,"ActivityBaseInfoP");var o=function(e){function t(){return e.call(this,"activity.CommonActivityInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("CommonActivityInfoP",t);var i=t.code,n=_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N),o=_.AppFacade.getInstance().retrieveProxy(_.PlayerPy.N),a=!1;if(i!=EActivityType.ZoneAuction){if(i==EActivityType.ZoneFishing){c=_.AppFacade.getInstance().retrieveMediator(_.ActivityMediator.N),l=n.allActivityData[EActivityType.ZoneFishing].data.playerInfo.creel,h=JSON.parse(t.info).playerInfo.creel;var r=0;if(l&&h)if(0<l.length)if(l.length==h.length){for(var s in h)if(l[s][0]==h[s][0]&&l[s][1]!=h[s][1]){r=h[s][0];break}}else for(s=0;s<h.length;s++)l[s]?l[s][0]!=h[s][0]&&(r=h[s][0]):r=h[s][0];else r=h[0][0];return c.updateViewByCode(EActivityType.ZoneFishing,{newFish:r}),n.updateData_View_Reward(i,t),void NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.ZoneFishing])}if(n.updateData_View_Reward(i,t),0<=[EActivityType.OneYuanGifts,EActivityType.NewYearWeekCrad,EActivityType.OneYuanGifts2,EActivityType.SecondDailyGifts].indexOf(i)&&_.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN),i==EActivityType.NewYearWeekCrad)(c=_.AppFacade.getInstance().retrieveMediator(_.ActivityMediator.N)).hideViewByCode(EActivityType.NewYearWeekCrad);i==EActivityType.BasicHeroGifts&&(_.AppFacade.getInstance().sendNotification(CN.ACTIVITY_BASIC_HERO_GIFG_UPDATE,t),_.GameMVC.mainMed.updateBtn()),i==EActivityType.RandomEvent&&_.AppFacade.getInstance().sendNotification(CN.ACTIVITY_MID_ALLGIFT_UPDATE,t)}else{var c,l=n.allActivityData[EActivityType.ZoneAuction],h=JSON.parse(t.info).info;if(l&&h){var p=l.data.items;for(var d in h.items)for(var u=h.items[d],g=u.buyerInfo,s=0;s<p.length;s++){var f=p[s];if(f.confId==u.confId)f.buyerInfo.playerId!=o.playerInfoVO.playerId||g.playerId==o.playerInfoVO.playerId||a||(a=!0,Utils.MsgUtils.addMidMsg("商品价格已刷新，请重新竞拍")),p[s]=u}}_.AppFacade.getInstance().retrieveProxy(_.BackpackPy.N).handleClientReward(t.clientReward),l&&l.data&&h&&h.record&&(l.data.record=h.record),(c=_.AppFacade.getInstance().retrieveMediator(_.ActivityMediator.N)).updateViewByCode(EActivityType.ZoneAuction1),t.type==ZoneAuctionInfoPType.Refresh&&_.AppFacade.getInstance().retrieveMediator(_.MainMediator.N).updateBtn(),t.type==ZoneAuctionInfoPType.Account&&(_.AppFacade.getInstance().retrieveMediator(_.MainMediator.N).updateBtn(),n.GetActivityInfo(EActivityType.ZoneAuction))}},t}(_.ProcessorBase);__reflect(o.prototype,"CommonActivityInfoP");var a=function(e){function t(){return e.call(this,"activity.FirstRechargeInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("FirstRechargeInfoP",t);var i=EActivityType.FirstRecharge1;_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N).updateData_View_Reward(i,t)},t}(_.ProcessorBase);__reflect(a.prototype,"FirstRechargeInfoP");var r=function(e){function t(){return e.call(this,"activity.PurchaseWholeLifeCardP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("PurchaseWholeLifeCardP",t);var i=EActivityType.WholeLifeCard;_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N).updateData_View_Reward(i,t),_.AppFacade.getInstance().retrieveMediator(_.ActivityMediator.N).updateViewByCode(EActivityType.MonthCard)},t}(_.ProcessorBase);__reflect(r.prototype,"PurchaseWholeLifeCardP");var s=function(e){function t(){return e.call(this,"activity.PurchaseDiscountGiftBagP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("PurchaseDiscountGiftBagP",t);var i=EActivityType.DiscountGiftBag;_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N).updateData_View_Reward(i,t)},t}(_.ProcessorBase);__reflect(s.prototype,"PurchaseDiscountGiftBagP");var c=function(e){function t(){return e.call(this,"activity.MonthCardRewardP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("MonthCardRewardP",t);var i=EActivityType.MonthCard;_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N).updateData_View_Reward(i,t)},t}(_.ProcessorBase);__reflect(c.prototype,"MonthCardRewardP");var l=function(e){function t(){return e.call(this,"activity.EnjoyCardRewardP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("EnjoyCardRewardP",t);var i=t.code;_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N).updateData_View_Reward(i,t)},t}(_.ProcessorBase);__reflect(l.prototype,"EnjoyCardRewardP");var h=function(e){function t(){return e.call(this,"activity.CollectHeroInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("CollectHeroInfoP",t);var i=EActivityType.CollectHero;_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N).allActivityData[i].updateData(t.info)},t}(_.ProcessorBase);__reflect(h.prototype,"CollectHeroInfoP");var p=function(e){function t(){return e.call(this,"activity.TriggerGiftNewP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("TriggerGiftNewP",t);var i=_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N),n=EActivityType.TriggerGifts,o=i.allActivityData[n],a={};o&&JSON.parse(o.data.gifts).forEach(function(e){a[e.uuid]=1});i.updateData_View_Reward(n,t);var r=i.allActivityData[n];r&&JSON.parse(r.data.gifts).forEach(function(e){a[e.uuid]||_.AppFacade.getInstance().sendNotification(CN.ACTIVITY_ADD_TRIGGER,e)})},t}(_.ProcessorBase);__reflect(p.prototype,"TriggerGiftNewP");var d=function(e){function t(){return e.call(this,"activity.TriggerGiftRewardP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("TriggerGiftRewardP",t);var i=EActivityType.TriggerGifts;_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N).updateData_View_Reward(i,t)},t}(_.ProcessorBase);__reflect(d.prototype,"TriggerGiftRewardP");var u=function(e){function t(){return e.call(this,"activity.BraveBookBuyP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("BraveBookBuyP",t);var i=EActivityType.BraveBook;_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N).updateData_View_Reward(i,t),_.AppFacade.getInstance().updateView(_.BraveBookMediator.N,_.BraveBookMediator.SV.MAIN)},t}(_.ProcessorBase);__reflect(u.prototype,"BraveBookBuyP");var g=function(e){function t(){return e.call(this,"activity.BraveBookLevelBuyP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("BraveBookLevelBuyP",t);EActivityType.BraveBook;_.AppFacade.getInstance().sendNotification(CN.ACTIVITY_BRAVEBOOKSHOP)},t}(_.ProcessorBase);__reflect(g.prototype,"BraveBookLevelBuyP");var f=function(e){function t(){return e.call(this,"activity.WeChatShareInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();if(console.log("WeChatShareInfoP",t),Utils.SDKMgr.getPerformConfig(16)){var i=t.type;_.AppFacade.getInstance().sendNotification(CN.ADD_WECHAT_SHARE_INFO,{type:t.type});var n=SHARE_RESOURCE_FILTER[i];if(!n||!0!==n.skip){var o=_.AppFacade.getInstance().retrieveMediator(_.ActivityMediator.N);o.shareInfo=void 0;var a=_.AppFacade.getInstance().retrieveProxy(_.FightPy.N);a.addDelayCBAfterFightExit(function(){o.showViewByCode(EActivityType.WeChatShare,{type:i}),a.queueExceExitCB()},"WeChatShareInfoP")}}},t}(_.ProcessorBase);__reflect(f.prototype,"WeChatShareInfoP");var m=function(e){function t(){return e.call(this,"relation.RelationInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("RelationInfoP",t),_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N).updateRelationTotalInfo(t)},t}(_.ProcessorBase);__reflect(m.prototype,"RelationInfoP");var y=function(e){function t(){return e.call(this,"relation.SyncDownRelationDataP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("SyncDownRelationDataP",t),_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N).updateRelationTotalInfo({info:t},!0)},t}(_.ProcessorBase);__reflect(y.prototype,"SyncDownRelationDataP");var v=function(e){function t(){return e.call(this,"relation.NewDownRelationP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("NewDownRelationP",t),_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N).updateRelationTotalInfo({info:t},!0)},t}(_.ProcessorBase);__reflect(v.prototype,"NewDownRelationP");var T=function(e){function t(){return e.call(this,"activity.ZoneQuoraRoundQuoraEndP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("ZoneQuoraRoundQuoraEndP",t),_.Activity186.firstName=t.firstAnswerInfo;var i=_.GameMVC.activityMed.getViewByCode(EActivityType.NewZoneQuora);i&&i.updateView()},t}(_.ProcessorBase);__reflect(T.prototype,"ZoneQuoraRoundQuoraEndP");var C=function(e){function t(){return e.call(this,"activity.NewZoneGroupPurchaseP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("NewZoneGroupPurchaseP",t);var i=JSON.parse(t.info),n=_.GameMVC.activityPy.allActivityData[EActivityType.NewZoneGroupPurchase];if(n&&n.data){for(var o in i.itemList){var a=i.itemList[o];for(var r in n.data.itemList){var s=n.data.itemList[r];a.code!=s.code||a.times||(i.itemList[o].times=s.times)}}_.GameMVC.activityPy.updateData_View_Reward(EActivityType.NewZoneGroupPurchase,{info:i})}},t}(_.ProcessorBase);__reflect(C.prototype,"NewZoneGroupPurchaseP")}(game||(game={})),function(T){var e=function(t){function o(){var e=t.call(this,o.N)||this;return e.backpackProxy=T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N),e._operationHasExec={},e.firstIn={},e.firstFetch={},e.giftList=[],e.qqFriends=[],e.isFirst=!0,e.firstIn={},e.allActivityData={},e.downRelationInfos=new Array,e.relationRedBagInfos=new Array,e.releationTargeted=new Array,T.ActivityConfig.addAllActivityConfig(),e.addNotice(),e}return __extends(o,t),o.prototype.addNotice=function(){var i=this,e=function(e){var t=T.ActivityConfig.Config[e];t&&t.checkNotice&&NoticeManager.registerCB(NT.ALL_ACTIVITY[e],function(){return t.checkNotice(i.allActivityData[e],e)},n,MODULE.Activity+parseInt(e))},n=this;for(var t in T.ActivityConfig.Config)e(t);NoticeManager.setChildType(NT.ACTIVITY_EnjoyCard1,NT.ALL_ACTIVITY[EActivityType.EnjoyCard1]),Utils.SDKMgr.getPerformConfig(10018)||(NoticeManager.setChildType(NT.ALL_ACTIVITY[EActivityType.FriendShare],NT.COMMON_SHOP[ShopType.ShopTypeShare]),NoticeManager.setChildType(NT.ALL_ACTIVITY[EActivityType.FriendShare],NT.FRIEND_SHARE_REWARD),NoticeManager.setChildType(NT.ALL_ACTIVITY[EActivityType.FriendShare],NT.FRIEND_SHARE_DAY_FIRST_SHARE)),NoticeManager.setChildType(NT.ALL_ACTIVITY[EActivityType.MagpieActivity],[NT.ACTIVITY_MAGPIE_TASK,NT.ACTIVITY_MAGPIE_TIME]),NoticeManager.registerCB(NT.FRIEND_SHARE_REWARD[0],function(){return i.checkFriendShareRewardNotice(0)},this),NoticeManager.registerCB(NT.FRIEND_SHARE_REWARD[1],function(){return i.checkFriendShareRewardNotice(1)},this),NoticeManager.registerCB(NT.FRIEND_SHARE_REWARD[2],function(){return i.checkFriendShareRewardNotice(2)},this),NoticeManager.registerCB(NT.FRIEND_SHARE_REWARD[3],function(){return i.checkFriendShareRewardNotice(3)},this),NoticeManager.registerCB(NT.FRIEND_SHARE_REWARD[4],function(){return i.checkFriendShareRewardNotice(4)},this),NoticeManager.registerCB(NT.FRIEND_SHARE_DAY_FIRST_SHARE,function(){return!Utils.LocalStorageUtil.getTodayVaild("FriendShare")},this),NoticeManager.registerCB(NT.ACTIVITY_MAGPIE_TASK,function(){return i.checkMagpieNotice(1)},this),NoticeManager.registerCB(NT.ACTIVITY_MAGPIE_TIME,function(){return i.checkMagpieNotice(2)},this),NoticeManager.setChildType(NT.ALL_ACTIVITY[EActivityType.MidAutumn],[NT.ACTIVITY_MID_CREAT,NT.ACTIVITY_MID_EAT,NT.ACTIVITY_MID_GET,NT.ACTIVITY_MID_GIFT,NT.ALL_ACTIVITY[EActivityType.MidAutumnSun],NT.ALL_ACTIVITY[EActivityType.ZhongQiuTask]]),NoticeManager.registerCB(NT.ACTIVITY_MID_CREAT,function(){return i.cheakCreatNotice()},this),NoticeManager.registerCB(NT.ACTIVITY_MID_EAT,function(){return i.cheakEatNotice()},this),NoticeManager.registerCB(NT.ACTIVITY_MID_GET,function(){return i.cheakGetNotice()},this),NoticeManager.registerCB(NT.ACTIVITY_MID_GIFT,function(){return i.cheakGiftNotice()},this)},o.prototype.GetActivityList=function(t){var i=this;if(Utils.Socket.send("activity","GetActivityList",{}).then(function(e){i.log("拉活动列表 GetActivityListR",e),i.firstFetch={},i.updateActivityList(e.activityList),i.GetAllActivityInfo(),T.AppFacade.getInstance().sendNotification(CN.ACTIVITY_LIST_UPDATED),T.AppFacade.getInstance().sendNotification(CN.NEWYEARCHALLENGE_UPDATE),t&&t()}),this.isFirst){this.isFirst=!1;var e=T.Config.activityConfigs();for(var n in e){var o=e[n];NoticeManager.setChildType(NT.ACTIVITY_ENTRANCE[o.entrance],NT.ALL_ACTIVITY[o.id])}}T.AppFacade.getInstance().sendNotification(CN.EXTREME_CHALLENGE_MODEL_UPDATE),T.AppFacade.getInstance().sendNotification(CN.HERO_CHALLENGE_MODEL_UPDATE),T.AppFacade.getInstance().sendNotification(CN.NEWYEARCHALLENGE_UPDATE)},o.prototype.updateData_View_Reward=function(e,t,i){var n=T.AppFacade.getInstance().retrieveProxy(o.N);(n.allActivityData[e]&&n.allActivityData[e].updateData(t.info),t.clientReward)&&T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N).handleClientReward(t.clientReward,{closeCB:i})},o.prototype.getActivityShowPanelCodes=function(e){return[]},o.prototype.GetCommonReward=function(t,e,i){var n=this;Utils.Socket.send("activity","GetCommonReward",{code:t,id:e}).then(function(e){n.updateData_View_Reward(t,e),i&&i()})},o.prototype.DoCommonOperation=function(t,e,i,n,o,a){var r=this;Utils.Socket.send("activity","DoCommonOperation",{code:t,num:e,id:i,info:a}).then(function(e){t==EActivityType.MoonCake?n&&n(e):t==EActivityType.MagpieActivity&&o?o!=MagpieEventType.FingerGame&&o!=MagpieEventType.Talk||n&&n(e,r.updateData_View_Reward.bind(r)):(r.updateData_View_Reward(t,e),n&&n(e))})},o.prototype.updateActivityList=function(e){var t=Utils.SDKMgr.getPerformConfig(1)&&Utils.SDKMgr.getPerformConfig(21),i={};for(var n in e){var o=e[n];if(!t||-1==HAS_RECHARGE_ACT_CODE.indexOf(Number(o.code))){var a=new T.ActivityVO;a.update(o),i[o.code]=a}}this.allActivityData=i},o.prototype.onFirstFetch=function(e){this.allActivityData[e];switch(e){case EActivityType.ZoneFishing:}},o.prototype.GetActivityInfo=function(t,i){var n=this,o=T.ActivityConfig.Config[t],a=o&&o.protoName||"",e=o&&o.params||{code:t};this.isOpen(t)&&""!=a&&Utils.Socket.send("activity",a,e).then(function(e){n.log(t,o.name,a,e),n.allActivityData[t].updateData(e.info),n.firstFetch[t]||(n.firstFetch[t]=!0,n.onFirstFetch(t)),t==EActivityType.BraveBook&&NoticeManager.updateNotice(NT.BRAVABOOK,void 0,!0),t==EActivityType.NewBraveBook&&NoticeManager.updateNotice(NT.NEWBRAVABOOK,void 0,!0),t!=EActivityType.NewBraveBook&&t!=EActivityType.BraveBook&&t!=EActivityType.FirstRecharge1&&t!=EActivityType.DailyLogin&&t!=EActivityType.DailyLuxuryGifts&&t!=EActivityType.OneYuanGifts&&t!=EActivityType.SixtyEightYuanGifts&&t!=EActivityType.OneYuanGifts2||T.AppFacade.getInstance().sendNotification(CN.ACTIVITY_LIST_UPDATED),t==EActivityType.WholeLifeCard&&T.AppFacade.getInstance().retrieveProxy(T.GuajiPy.N).updateNotice(),t==EActivityType.NewYearChallenge&&T.AppFacade.getInstance().sendNotification(CN.NEWYEARCHALLENGE_UPDATE),i&&i()})},o.prototype.GetAllActivityInfo=function(){for(var e in this.allActivityData)this.GetActivityInfo(Number(e))},o.prototype.isOpen=function(e){return!!this.allActivityData[e]},o.prototype.ChallengeExtremeChallenge=function(){var n=this,e=this.allActivityData[EActivityType.ExtremeBattle];if(e&&e.data){JSON.parse(e.content);var o=e.data.id;this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeExtremeBattle,customParams:{fightBg:"fight_scene_xstz",tips:['<b><font color="#ffffff" size="22">恭喜您挑战 </font><font color="#00fff0" size="22">第'+o+'关</font><font color="#ffffff" size="22"> 成功</font></b>','<b><font color="#ffffff" size="22">很遗憾,您挑战 </font><font color="#00fff0" size="22">第'+o+'关</font><font color="#ffffff" size="22"> 失败</font></b>']},pb1:"activity",pb2:"ChallengeExtremeBattle",params:{},doneCB:function(e){Utils.LocalStorageUtil.setItem(T.ActivityExtremeChallengeView.EXTREMECHALLENGESKIP_PREFIX+o,"true");var t=e.cbRet,i=n.allActivityData[EActivityType.ExtremeBattle];(i&&i.updateData(t.info),i.data.passed)||T.AppFacade.getInstance().retrieveMediator(T.ActivityMediator.N).showViewByCode(EActivityType.ExtremeBattle);T.AppFacade.getInstance().retrieveProxy(T.FightPy.N).queueExceExitCB(),T.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN)}})}else Utils.MsgUtils.addMidMsg("活动数据错误")},o.prototype.WeChatShare=function(t){var i=this;Utils.SDKMgr.share(t,function(e){0==e&&(t.customCB?(t.customCB(),T.AppFacade.getInstance().retrieveMediator(T.ActivityMediator.N).hideViewByCode(EActivityType.WeChatShare)):Utils.Socket.send("activity","WeChatShare",{id:t.id}).then(function(e){(console.log("微信分享 WeChatShareR",e),i.allActivityData[EActivityType.WeChatShare].updateData(e.info),e&&e.clientReward)&&T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N).handleClientReward(e.clientReward);T.AppFacade.getInstance().retrieveMediator(T.ActivityMediator.N).hideViewByCode(EActivityType.WeChatShare),Utils.MsgUtils.addMidMsg("分享成功"),t.doneCB&&t.doneCB()}).catch(function(e){}))})},o.prototype.updateRelationTotalInfo=function(e,t){var i=this;if(void 0===t&&(t=!1),e){var n=e.info;if(n.downRelationInfo){if(Array.isArray(n.downRelationInfo))this.downRelationInfos.splice(0),n.downRelationInfo.forEach(function(e){i.downRelationInfos.push(new T.RelationInfoVO(e))});else if(t){var o=!1;for(var a in this.downRelationInfos){var r=this.downRelationInfos[a];r.playerId==n.downRelationInfo.playerId&&(r.update(n.downRelationInfo),o=!0)}o||this.downRelationInfos.push(new T.RelationInfoVO(n.downRelationInfo))}this.downRelationInfos.sort(function(e,t){return e.dt!=t.dt?e.dt-t.dt:e.playerId-t.playerId})}n.redBagInfo&&(this.relationRedBagInfos.splice(0),Array.isArray(n.redBagInfo)&&n.redBagInfo.forEach(function(e){i.relationRedBagInfos.push(new T.RelationRedBagInfoVO(e))})),n.targeted&&(this.releationTargeted=n.targeted),T.AppFacade.getInstance().retrieveMediator(T.ActivityMediator.N).updateViewByCode(EActivityType.FriendShare),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.FriendShare])}},o.prototype.GetRelationInfo=function(e){var t=this;Utils.Socket.send("relation","GetRelationInfo",{relationType:e}).then(function(e){t.updateRelationTotalInfo({info:e})})},o.prototype.GetRelationRedBag=function(e,t,i){var n=this;Utils.Socket.send("relation","GetRelationRedBag",{relationType:e,uuid:t}).then(function(e){(n.updateRelationTotalInfo(e),e.clientReward)?(T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N).handleClientReward(e.clientReward,{closeCB:i}),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.FriendShare])):i&&i()})},o.prototype.GetRelationReward=function(e,t,i){var n=this;Utils.Socket.send("relation","GetRelationReward",{relationType:e,id:t}).then(function(e){e.clientReward&&T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N).handleClientReward(e.clientReward,2);n.releationTargeted.push(t),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.FriendShare]),i&&i()})},o.prototype.checkMagpieNotice=function(e){var t=!1,i=this.allActivityData[EActivityType.MagpieActivity];switch(e){case 1:var n=this.allActivityData[EActivityType.MagpieActivity],o=T.Config.magpieAchieveConfigs();for(var a in o){var r=o[a],s=!1;for(var c in n.data.targeted)if(r.code==n.data.targeted[c]){s=!0;break}if(!s){var l=JSON.parse(r.target),h=0,p=0;switch(r.type){case MagpieAchieveType.Collect:for(var d=0;d<l.length;d++){var u=T.GameMVC.backpackPy.getItemNumByCode(l[d][1]);l[d][0]<=u&&p++}h=l.length;break;case MagpieAchieveType.FinishRound:p=n.data.round,h=l[0];break;case MagpieAchieveType.ThrowDiceTimes:p=n.data.throwRecord,h=l[0];break;case MagpieAchieveType.ChatWith:var g=n.data.talkRecord,f=l[1];for(var _ in h=l[0],g)if(g[_][0]==f){p=g[_][1];break}}h<=p&&(t=!0)}}break;case 2:var m=i.content,y=m[5][0];if(0<T.GameMVC.backpackPy.getInfoByCode(y[1]).haveNum)t=!0;else{var v=m[6][0];t=0<T.GameMVC.backpackPy.getInfoByCode(v[1]).haveNum}}return t},o.prototype.checkFriendShareRewardNotice=function(e){var t=0,i=T.Config.relationRewardConfigs();switch(e){case 0:return this.checkFriendShareRewardNotice01(0);case 1:return this.checkFriendShareRewardNotice01(1);case 2:for(var n in this.downRelationInfos){30<=(s=this.downRelationInfos[n]).level&&t++}if(0<t)for(var o in i){if((s=i[o]).count<=t&&30==s.level&&-1==this.releationTargeted.indexOf(s.id))return!0}break;case 3:for(var a in this.downRelationInfos){60<=(s=this.downRelationInfos[a]).level&&t++}if(0<t)for(var r in i){var s;if((s=i[r]).count<=t&&60==s.level&&-1==this.releationTargeted.indexOf(s.id))return!0}break;case 4:if(this.relationRedBagInfos&&0<this.relationRedBagInfos.length)return!0}return!1},o.prototype.checkFriendShareRewardNotice01=function(e){var t=this.allActivityData[EActivityType.FriendShare];if(t&&t.data){var i=JSON.parse(t.content),n=t.data.keyList,o=t.data.targeted;0==e&&(n=t.data.todayKeyList,o=t.data.todayTargeted);var a={},r=function(e){for(var t in n){var i=n[t];if(i.taskType==e)return a[e]=i.key,i.key}};for(var s in i){var c=i[s],l=c[4];if(l==TaskResetType.Daily&&0==e||l==TaskResetType.None&&1==e){var h=c[0],p=c[1],d=(c[2],c[3]),u=REWARD_STATUS.UNAVAILABLE;switch(p<=(a[d]||r(d)||0)&&(u=REWARD_STATUS.AVAILABLE),0<=o.indexOf(h)&&(u=REWARD_STATUS.RECEIVED),u){case REWARD_STATUS.UNAVAILABLE:break;case REWARD_STATUS.AVAILABLE:return!0;case REWARD_STATUS.RECEIVED:}}}return!1}},o.prototype.operationHasExec=function(t){var i=this;return null==this._operationHasExec[t]?(Utils.Socket.send("operation","HasExec",{operationId:t}).then(function(e){i._operationHasExec[t]=e.ret,i.sendNotification(CN.MAIN_UPDATE_BTN)}),!0):this._operationHasExec[t]},o.prototype.getOperationReward=function(t,i){Utils.Http.toGet({action:"get_reward",playerId:T.GameMVC.playerPy.roleVo.playerId,area:T.GameMVC.loginPy.serverSelect.s_id,rewardId:t}).then(function(e){T.GameMVC.activityPy._operationHasExec[t]=1,T.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN),i&&i(e)})},o.prototype.checkAllSDKReward=function(){if(Utils.SDKMgr.getPerformConfig(15)&&getUrlKV().Act_ShouCangYouLi){T.AppFacade.getInstance().retrieveProxy(T.ActivityPy.N);T.GameMVC.activityPy.getOperationReward(OperationType.Act_ShouCangYouLi)}if(getUrlKV().Act_GuanZhuGongZhongHao){T.AppFacade.getInstance().retrieveProxy(T.ActivityPy.N);T.GameMVC.activityPy.getOperationReward(OperationType.Act_GuanZhuGongZhongHao)}if(getUrlKV().Act_ShiMingRenZheng){T.AppFacade.getInstance().retrieveProxy(T.ActivityPy.N);T.GameMVC.activityPy.getOperationReward(OperationType.Act_ShiMingRenZheng)}},o.prototype.hasWholeLifeCard=function(){return this.allActivityData[EActivityType.WholeLifeCard]&&this.allActivityData[EActivityType.WholeLifeCard].data&&this.allActivityData[EActivityType.WholeLifeCard].data.hasPurchased},o.prototype.getFetchedList=function(t){var i=this;Utils.Socket.send("gift","GetFetchedList",{}).then(function(e){i.giftList=e.idList,t&&t.cb&&t.cb(e)})},o.prototype.getGiftRewardFormServer=function(t){var i=this;Utils.Socket.send("gift","GetGiftReward",{id:Number(t.giftId)}).then(function(e){0==e.err&&T.GameMVC.backpackPy.handleClientReward(e.clientReward),i.getFetchedList(t),t&&t.cb&&t.cb()}).catch(function(e){})},o.prototype.getGiftReward=function(i){var n=this;if(Utils.agentConfig.other.isJhb){var e=Number(i.giftId),o=T.Config.giftConfig()[e],t=-1!=this.giftList.indexOf(e),a=function(t){Utils.Socket.send("gift","GetGiftReward",{id:Number(i.giftId)}).then(function(e){0==e.err&&T.GameMVC.backpackPy.handleClientReward(e.clientReward),o&&0==o.qqZoneVip&&PopUpManager.addPopUp({effectType:0,obj:new T.GiftBagsView({giftId:i.giftId,isGet:t.isGet,ret:t.ret})}),n.getFetchedList(i)}).catch(function(e){o&&0==o.qqZoneVip&&PopUpManager.addPopUp({effectType:0,obj:new T.GiftBagsView({giftId:i.giftId,isGet:t.isGet,ret:t.ret})})})};if(o)if(0!=o.vipRange){var r=getUrlKV().giftRet;t||0!=r.ret?i&&i.cb?i&&i.cb():0==o.qqZoneVip&&PopUpManager.addPopUp({effectType:0,obj:new T.GiftBagsView({giftId:e,isGet:t,ret:r})}):a({isGet:t,ret:r})}else t?0==o.qqZoneVip&&PopUpManager.addPopUp({effectType:0,obj:new T.GiftBagsView({giftId:e,isGet:t})}):a({isGet:t})}},o.prototype.getQQFriendsInfo=function(t){var i=this;Utils.Http.toGet({action:"get_appFri",appid:getUrlKV().appid,openid:getUrlKV().openid,openkey:getUrlKV().openkey,pf:getUrlKV().pf}).then(function(e){0==e.ret?(i.qqFriends=e.items,t.cb&&t.cb(e.items)):Utils.MsgUtils.addMidMsg(e.msg)}).catch(function(){})},o.prototype.pushMessageToFriends=function(a){if(Utils.agentConfig.other.isJhb){var r=Utils.LocalStorageUtil.getItem("msgTime")||"0",s=(Number(r)+1).toString();r&&Number(r)<1&&this.getQQFriendsInfo({cb:function(e){for(var t=0,i=e;t<i.length;t++){var n=i[t].openid,o=a.content;Utils.Http.toGet({action:"get_gameMsg",appid:getUrlKV().appid,openid:getUrlKV().openid,openkey:getUrlKV().openkey,pf:getUrlKV().pf,zoneid:getUrlKV().platform,frd:n,msgtype:3,content:decodeURI(o),qua:getUrlKV().qua.meybeQua}).then(function(e){0==e.ret?r&&Number(r)<1&&Utils.LocalStorageUtil.setItem("msgTime",s,!1):Utils.MsgUtils.addMidMsg(e.msg)}).catch(function(){})}}})}},o.prototype.GetInvitationCodeInfo=function(e,t){Utils.Socket.send("activity","GetInvitationCodeInfo",{code:e}).then(function(e){t&&t(e.info)})},o.prototype.UseInvitationCode=function(e,t){Utils.Socket.send("activity","UseInvitationCode",{code:e.code,invitationCode:e.invitationCode}).then(function(e){e.clientReward&&T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N).handleClientReward(e.clientReward,2);t&&t()})},o.prototype.FishingOperation=function(t,i,n){var o=this;Utils.Socket.send("activity","FishingOperation",{code:t.code,type:t.type,target:t.target,num:t.num}).then(function(e){(e.info&&o.updateData_View_Reward(t.code,e),e.clientReward)&&T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N).handleClientReward(e.clientReward,2);i&&i({info:JSON.parse(e.info),content:t.content}),n&&n()})},o.prototype.FishingGetEnemyInfo=function(e,t){Utils.Socket.send("activity","FishingGetEnemyInfo",{targetId:e}).then(function(e){t&&t(e)})},o.prototype.Challenge=function(i,n){var o=this;this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EActivityType.ZoneFishing,pb1:"activity",pb2:"FishingOperation",params:{code:i.code,type:i.type,target:i.target,num:i.num},ignoreStringWay:!0,doneCB:function(e){e.cbRet.info&&o.updateData_View_Reward(i.code,e.cbRet),T.GameMVC.activityMed.showViewByCode(EActivityType.ZoneFishing);var t=T.AppFacade.getInstance().retrieveProxy(T.FightPy.N);n&&n(),t.queueExceExitCB()}})},o.prototype.MidAutumnChallenge=function(e,i){var n=this;this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeMidAutumn,pb1:"activity",pb2:"MidAutumnChallenge",params:{pos:e.pos},ignoreStringWay:!0,doneCB:function(e){if(e.cbRet&&e.cbRet.info){var t=JSON.parse(e.cbRet.info);n.updateData_View_Reward(EActivityType.MidAutumn,{info:t})}T.GameMVC.fightPy.queueExceExitCB(),i&&i()}})},o.prototype.checkIdelAvailable=function(){var e=this.allActivityData[EActivityType.MidAutumn].content[3],t=e[0],i=e[1],n=Utils.TimerManager.getServerTime(!1),o=new Date(1e3*n),a=o.getHours(),r=o.getMinutes();return(a>t[0]||a===t[0]&&r>=t[1])&&(a<i[0]||a===i[0]&&r<i[1])},o.prototype.cheakCreatNotice=function(){var e=[],t=T.GameMVC.backpackPy.AllItemInfo;for(var i in t){t[i][0];var n=T.Config.itemConfig()[Number(i)];0==n.type&&1==n.subType&&e.push(n)}return 0<e.length},o.prototype.cheakEatNotice=function(){var e=[],t=T.GameMVC.backpackPy.AllItemInfo;for(var i in t){t[i][0];var n=T.Config.itemConfig()[Number(i)];0==n.type&&2==n.subType&&e.push(n)}return 0<e.length},o.prototype.cheakGetNotice=function(){var e=!1,t=this.allActivityData[EActivityType.RandomEvent];return t&&t.data&&(e=!!t.data.inActivity&&0<t.data.events.length),e},o.prototype.cheakGiftNotice=function(){var e=this.allActivityData[EActivityType.RandomEvent],a=e.content[2],r=[];if(e&&e.data&&e.data.gifts){var t=JSON.parse(e.data.gifts),s=T.GameMVC.rechargePy.goodList,c=Utils.TimerManager.getServerTime();t.forEach(function(e){var t={uuid:e.uuid,info:e,config:void 0,goodInfo:void 0,chosen:!1};for(var i in a){var n=a[i];if(n[0]===e.code){t.config=n;break}}for(var i in s){var o=s[i];if(Number(o.id)===t.config[1]){t.goodInfo=o;break}}0<e.triggerDt+t.config[3]-c&&r.push(t)})}return 0<r.length},o.N="ActivityProxy",o}(BaseProxy);T.ActivityPy=e,__reflect(e.prototype,"game.ActivityPy")}(game||(game={})),function(n){var e=function(t){function e(){var e=t.call(this)||this;return e.hasCreated=!1,e.hasAddEffect=!1,e.skinName="ActivityBox",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.hasCreated=!0,this.update(this.params),this.gp_top.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btnFunc&&e.btnFunc()},this)},e.prototype.setDecorateData=function(e){this.decorateData=e,this.update(this.params)},e.prototype.decodeDecorateData=function(e){return this.decorateData&&this.decorateData[e]?this.decorateData[e](this.params):void 0},e.prototype.update=function(e){var t=this;if(this.hasCreated){if(e){if(this.params=e,!this.hasAddEffect){var i=this.decodeDecorateData("getEffect");i&&UIActionManager.addEffect(this.gp_effect,i,{},function(e){(t.tdEffect=e).visible=t.params&&t.params.status==REWARD_STATUS.AVAILABLE})}switch(this.img_bottom.source=this.decodeDecorateData("get_bottomImg_source")||"",this.bm_count.text=this.decodeDecorateData("get_tipBm_text")||"",this.bm_count.font=this.decodeDecorateData("get_tipBm_font")||"white_num_fnt",this.img_box.source=this.decodeDecorateData("get_boxImg_source")||"",e.status){case REWARD_STATUS.AVAILABLE:this.gp_effect.visible=!0,this.img_box.visible=!1,this.btnFunc=function(){t.tdEffect&&(t.tdEffect.visible=!1),t.img_box.visible=!0,t.img_box.source=t.decodeDecorateData("onBtnTap_boxImg_source")||"",DragonBoneTools.playOnce({parent:t.gp_effect,effectName:"common_xunbaorijibxtx",doneCB:function(){e.btnFunc&&e.btnFunc(e)}})};break;case REWARD_STATUS.UNAVAILABLE:case REWARD_STATUS.GO_RECHARGE:this.gp_effect.visible=!1,this.img_box.visible=!0,this.btnFunc=function(){n.AppFacade.getInstance().showSubView(n.CommonMediator.N,n.CommonMediator.SV.REWARD_PANEL,{rewards:e.rewards,type:n.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})};break;case REWARD_STATUS.RECEIVED:this.gp_effect.visible=!1,this.img_box.visible=!0,this.btnFunc=function(){Utils.MsgUtils.addMidMsg("已领取")}}}}else this.params=e},e}(eui.ItemRenderer);n.ActivityBox=e,__reflect(e.prototype,"game.ActivityBox")}(game||(game={})),function(b){var t,e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.prototype.updateView=function(e){if(e&&e.activityType){this.code=e.activityType,this.updateTitle();var t=this.getDataList();switch(this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(t):this.list_itemList.dataProvider=new eui.ArrayCollection(t),this.code){case EActivityType.ConsumeDiamondTask:this.actProxy.isOpen(EActivityType.NewZoneConsumeRank)&&(this.btn_left.visible=!0,this.btn_left.icon="_btn_lb_m_json.common_icon_paihangbang",this.btn_left.label="排行榜",this.btn_left.width=72,this.btn_left.height=85,this.btn_left.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.btn_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){b.AppFacade.getInstance().showSubView(b.RankMediator.N,b.RankMediator.SV.COMMON,{module:"ActivityNewZoneConsumeRank"})},this))}}},i.prototype.getDataList=function(){var d=this,e=this.info;if(!e||!e.data)return[];var u=[],g=JSON.parse(e.content),f=e.data.targeted;f[0]||(f=[]);var o=e.data.keyList,_={},m=function(e){if(d.code==EActivityType.MagicalUpGradeTask||d.code==EActivityType.PetUpGradeTask){var t=0;for(var i in o){(n=o[i]).taskType>=e&&(t+=n.key)}return _[e]=t}for(var i in o){var n;if((n=o[i]).taskType==e)return _[e]=n.key,n.key}return 0},t=b.Config.activityConfigs()[this.code],y=t&&t.rotation||1,v=0,T=9999999,i=0,n=0;if(1!=y){for(var a=g.length/y,r=1;r<=y;r++){var s=g[E=r*a-1],c=(s[0],s[1]%1e4),l=s[3],h=this.getTypeKey(l,s);if(!(c<=(_[h]||m(h)))){T=c;break}if(i++,!(f.length>E)){T=c;break}n++,v=c}y<=n&&(n=y-1,v=g[g.length-a-1]&&g[g.length-a-1][1]||0,T=g[g.length-1][1])}var p=function(e){var t=g[e],i=t[0],n=C.getMax(t[1]);if(1!=y&&(n<=v||T<n))return"continue";var o=t[2],a=t[3],r=t[4],s=C.getTypeKey(a,t),c=_[s]||m(s),l=REWARD_STATUS.CANBUY;n<=c&&(l=REWARD_STATUS.AVAILABLE),0<=f.indexOf(i)&&(l=REWARD_STATUS.RECEIVED);var h=C.getTitle(a,t);C.code==EActivityType.ConsumeDiamondTask&&l==REWARD_STATUS.CANBUY&&(l=REWARD_STATUS.UNAVAILABLE);var p={id:i,key:n,title:h,status:l,rewards:o,tips:c-v+"/"+(n-v),btnText:l==REWARD_STATUS.CANBUY?"前往":"",btnFunc:function(e){switch(l){case REWARD_STATUS.AVAILABLE:d.getReward({code:d.code,id:i});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.CANBUY:r&&b.MainJumpConfig.jumpTo(r);break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件")}}};u.push(p)},C=this;for(var E in g)p(E);return this.commonSortDataList(u),t&&1!=t.rotation&&0!=t.rotation&&(this.lb_round.visible=!0,this.lb_round.text="完成次数("+i+"/"+y+")"),u},i.prototype.getTitle=function(e,t){switch(this.code){case EActivityType.GuildCollectTask:case EActivityType.GuildCollectTask1:case EActivityType.HeroArtifactUpStarTask:return(i.TaskType_2_Title[e]||"").format([Math.floor(t[1]/1e4),t[1]%1e4]);case EActivityType.MagicalUpGradeTask:case EActivityType.PetUpGradeTask:return(i.TaskType_2_Title[e]||"").format([t[1]%1e4,Math.floor(t[1]/1e4)]);case EActivityType.ConsumeDiamondTask:return(i.TaskType_2_Title[e]||"").format([t[1]]);default:return(i.TaskType_2_Title[e]||"").format([t[1]%1e4])}},i.prototype.getMax=function(e){switch(this.code){case EActivityType.ConsumeDiamondTask:return e;default:return e%1e4}},i.prototype.getTypeKey=function(e,t){var i=e;switch(this.code){case EActivityType.GuildCollectTask:case EActivityType.GuildCollectTask1:case EActivityType.HeroArtifactUpStarTask:case EActivityType.MagicalUpGradeTask:case EActivityType.PetUpGradeTask:i=t[1]-t[1]%1e4}return i},i.TaskType_2_Title=((t={})[TaskSubType.CommentBeLikeMax]="单条评论收获%s个赞",t[TaskSubType.CommentTimes]="发布%s条评论",t[TaskSubType.LikeTimes]="点赞%s次",t[TaskSubType.ArenaChallengeTimes]="竞技场挑战%s次",t[TaskSubType.TouchGoldHand]="矮人宝藏点金%s次",t[TaskSubType.SmithyTimes]="铁匠铺锻造%s次",t[TaskSubType.ChallengeCircle]="遗迹探险探索%s圈",t[TaskSubType.MysticalShopRefreshTime]=" 神秘商店刷新%s次",t[TaskSubType.GuildCollectTime]="完成%s星公会采集%s次",t[TaskSubType.ActivityGashapon]="神魔召唤%s次",t[TaskSubType.ActivityGashapon1]="神魔召唤%s次",t[TaskSubType.HighGashaponTimes]="高级召唤%s次",t[TaskSubType.GiveFriendPokeBall]="赠送爱心%s次",t[TaskSubType.DailyFortressTimes]="日常副本战斗%s次",t[TaskSubType.ShopBuyTimes]="黑市商店购买%s次",t[TaskSubType.ExpeditionSuccessTimes]="远征胜利%s次",t[TaskSubType.RaceGashaponTimes]="时空招募%s次",t[TaskSubType.ActivityConsumeDiamond]="消耗%s钻石可领取",t[TaskSubType.HeroArtifactUpStarNum]="通过升星获得%s星圣物%s个",t[TaskSubType.MagicalUpGrade]="将任意%s个神器升级到%s级",t[TaskSubType.PetUpGrade]="将任意%s只宠物升级到%s级",t[TaskSubType.TreasureJewelTotalLevel]="上阵英雄宝石总等级达到%s级",t[TaskSubType.QuenchceMasterMaxLevel]="任意一个英雄淬炼大师达到%s级",t[TaskSubType.HeroArtifactTotalBaptizeNum]="洗满%s条圣物洗练属性",t[TaskSubType.QuoraNum]="在火女课堂或知识闯关中答对%s道题",t[TaskSubType.ReceiveRiksMineRewards]="冒险领取%s次采集收益",t[TaskSubType.RechargeMoney]="累计充值%s元",t),i}(b.ActivityCommonListView);b.ActivityCommonTaskView=e,__reflect(e.prototype,"game.ActivityCommonTaskView")}(game||(game={})),function(o){var e=function(t){function i(){var e=t.call(this)||this;return e.needTipsToday=!1,e.skinName="CommonTipsDialogSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.lbWithImage.textColor=7491637,this.lbWithImage.size=24},i.prototype.updateView=function(e){this.params=e,this.clickCB=e.clickCB,this.params.commonTips?this.initForCommonTips():this.initForCost(),this.initBtnLabel(),this.params.noOKBtn&&(this.btn_confirm.visible=!1,this.btn_cancle.horizontalCenter=0)},i.prototype.initBtnLabel=function(){if(this.params.btnStyle){var e=function(e,t){e.label="",e.skinName=t.skin,e.label=t.text};e(this.btn_cancle,this.params.btnStyle.cancel||i.BTN_STYLE.CANCEL),e(this.btn_confirm,this.params.btnStyle.confirm||i.BTN_STYLE.CONFIRM)}},i.prototype.initForCommonTips=function(){if(Array.isArray(this.params.commonTips)){var t=[];this.params.commonTips.forEach(function(e){t.push({type:COMPONENT_ENUM.LABEL,data:{text:e.text,size:e.style&&e.style.size,textColor:e.style&&e.style.textColor}})}),this.lbWithImage.update({data:t})}else this.lbWithImage.update({data:[{type:COMPONENT_ENUM.LABEL,data:{text:this.params.commonTips}}]});this.decorateVip(),this.decorateCB(),this.decorateBtn()},i.prototype.initForCost=function(){var e="string"==typeof this.params.cost?JSON.parse(this.params.cost)[0]:this.params.cost[0],t=[];if(e){var i=o.GeneralConfig.getEntityConfigByCode(e[0],e[1]);if(i.icon&&""!=i.icon){var n={type:COMPONENT_ENUM.IMAGE,data:{source:i.icon+"_png"}};t.push({type:COMPONENT_ENUM.LABEL,data:{text:this.params.reset?"是否花费":"确定消耗"}}),t.push(n),this.params.costTips?t.push({type:COMPONENT_ENUM.LABEL,data:{text:"x"+e[2]+this.params.costTips}}):t.push({type:COMPONENT_ENUM.LABEL,data:{text:"x"+e[2]+"，购买一次挑战次数？"}})}}else this.params.reset?t.push({type:COMPONENT_ENUM.LABEL,data:{text:this.params.costTips}}):t.push({type:COMPONENT_ENUM.LABEL,data:{text:"确定"+this.params.costTips}});this.lbWithImage.update({data:t}),this.decorateVip(),this.decorateCB(),this.decorateBtn()},i.prototype.decorateVip=function(){if(this.params.vipLeftCount){var e=o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N);this.lb_vipTips.text="（您当前是VIP"+e.playerInfoVO.playerVip.vipLevel+"，今日剩余购买次数"+this.params.vipLeftCount+"次）"}else this.lb_vipTips.parent&&this.lb_vipTips.parent.removeChild(this.lb_vipTips)},i.prototype.decorateCB=function(){var t=this;this.params.cb?(this.cb_tips.addEventListener(egret.Event.CHANGE,function(e){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),t.needTipsToday=t.cb_tips.selected},this),Utils.LocalStorageUtil.getTodayVaild(""+i.STORAGE_PREFIX+this.params.source)&&(this.cb_tips.selected=!0)):this.gp_content.removeChild(this.gp_cb)},i.prototype.decorateBtn=function(){var e=this;this.btn_cancle.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onClick(0)},this),this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),e.needTipsToday?Utils.LocalStorageUtil.setTodayVaild(""+i.STORAGE_PREFIX+e.params.source):Utils.LocalStorageUtil.removeItem(""+i.STORAGE_PREFIX+e.params.source),e.onClick(1)},this)},i.prototype.onClick=function(e){this.hide(),this.clickCB&&this.clickCB({type:e})},i.prototype.perShow=function(e){var t=!0;return e.directCall&&e.directCall()?(e.clickCB&&e.clickCB({type:COMPONENT_ENUM.LABEL}),t=!1):e.source&&Utils.LocalStorageUtil.getTodayVaild(""+i.STORAGE_PREFIX+e.source)&&e.clickCB&&(e.clickCB({type:COMPONENT_ENUM.LABEL}),t=!1),t},i.STORAGE_PREFIX="CommonTipsDialog",i.BTN_STYLE={CONFIRM:{text:"确定",skin:"skins.ButtonSkinGreen"},CANCEL:{text:"取消",skin:"skins.ButtonSkinRed"},GOTO:{text:"前往",skin:"skins.ButtonSkinYellow"},RECHARGE:{text:"充值",skin:"skins.ButtonSkinYellow"}},i}(BasePanel);o.CommonTipsDialog=e,__reflect(e.prototype,"game.CommonTipsDialog")}(game||(game={})),function(o){var e=function(t){function e(){var e=t.call(this)||this;return e.curActivityCode=0,e.actList=[],e.skinName="ActivityRootPanelSkin",e}return __extends(e,t),e.prototype.onDestroy=function(){o.AppFacade.getInstance().retrieveMediator(o.ActivityMediator.N).hideAllSubView(),this.gp_content.removeChildren()},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.updateResourceBar(),this.initList()},e.prototype.initList=function(){this.list_actItem.itemRenderer=i,this.list_actItem.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this),UIActionManager.hideScrollerBar(this.scl_actItem),this.scl_actItem.scrollPolicyH=eui.ScrollPolicy.AUTO},e.prototype.onItemTap=function(e){var t=e.id||e.item.config.id,i=o.AppFacade.getInstance().retrieveMediator(o.ActivityMediator.N);this.curActivityCode&&i.hideViewByCode(this.curActivityCode),this.curActivityCode=t,i.showViewByCode(this.curActivityCode),console.log("点击活动 ： ",t),this.updateSelected(t)},e.prototype.updateSelected=function(e){var t=this.list_actItem.dataProvider,i=t.source;for(var n in i){var o=i[n];o.chosen=o.config.id==e}t.replaceAll(i)},e.prototype.updateResourceBar=function(){var e=[EPropertyType.EPropertyTypeGold,EPropertyType.EPropertyTypeDiamond];this.CommonResourceBar.updateBar({costs:e,width:190,needAdd:!0})},e.prototype.updateView=function(e){var t=this;this.vType=e&&e.viewType||this.vType,this.actList=o.ActivityConfig.getActivityConfigByType(this.vType);var i=[];this.actList.forEach(function(e){i.push({config:e,chosen:!1,view:t})}),this.list_actItem.dataProvider=new eui.ArrayCollection(i);var n=e&&e.code||this.actList[0]&&this.actList[0].id;n&&this.onItemTap({id:n})},e}(BaseFull);o.ActivityRootPanel=e,__reflect(e.prototype,"game.ActivityRootPanel");var i=function(t){function e(){var e=t.call(this)||this;return e.oldY=-5,e.oldId=0,e.activityProxy=o.AppFacade.getInstance().retrieveProxy(o.ActivityPy.N),e.skinName="ActivityRootPanel_ActivityItem",e}return __extends(e,t),e.prototype.dataChanged=function(){var e=this.activityProxy.allActivityData[this.data.config.id];Utils.SDKMgr.getPerformConfig(10018)&&!e&&this.data.config.id==EActivityType.QQZoneVipGift&&(e={skinId:0}),e&&(this.img_icon.source=ResourceUtils.png(JSON.parse(this.data.config.img_icon)[e.skinId]),this.updateSelected(),this.bm_title.text=JSON.parse(this.data.config.des_title)[0],this.lb_code.text=JSON.parse(this.data.config.des_title)[0],this.oldId&&NoticeManager.removeNoticeListener(NT.ALL_ACTIVITY[this.oldId]),this.oldId=this.data.config.id,NoticeManager.addNoticeListener(NT.ALL_ACTIVITY[this.data.config.id],this.gp_root,this.data.view,{percentX:90/113,percentY:0}))},e.prototype.updateSelected=function(){this.img_bg.source=this.data.chosen?"newactivity_img_yeqian02_png":"newactivity_img_yeqian01_png",this.data.chosen?egret.Tween.get(this.img_icon,{loop:!0}).to({y:this.oldY-15},500).to({y:this.oldY},500):(egret.Tween.removeTweens(this.img_icon),this.img_icon.y=this.oldY)},e}(eui.ItemRenderer);__reflect(i.prototype,"ActivityRootPanel_ActivityItem")}(game||(game={})),function(d){var e=function(p){function e(){var e=p.call(this)||this;return e.reward_items=[],e.pos=[[120,-60],[320,-30],[460,55],[430,200],[310,240],[80,180],[-80,150],[-50,0],[140,70],[280,100]],e.skinName="Activity162",e}return __extends(e,p),e.prototype.childrenCreated=function(){var i=this;p.prototype.childrenCreated.call(this),this.baseitem_chose.visible=!1,this.baseitem_chose.touchEnabled=!1,UIActionManager.addEffect(this.gp_main,"common_xysbeijing",{childIndex:1,offectY:100}),UIActionManager.fadeBlink(this.img_jiahao,!0,!1,1e3),this.gp_chose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.info;if(e&&e.data){var t=[];e.data.wishId&&t.push(String(e.data.wishId));var n=JSON.parse(e.content);PopUpManager.addPopUp({obj:new d.CommonChosePanel({getInfos:function(){var e={};for(var t in n[0]){var i=n[0][t];i[5]&&(e[i[0]]={uuid:i[0],type:i[1][0][0],code:i[1][0][1],num:i[1][0][2],isLocked:!1})}return e},type:EEntityType.EEntityTypeItem,isOnlyCode:!0,checkFull:function(e){return 1<=e.length},sortFunc:function(e,t){return e.info.uuid-t.info.uuid},selectUuids:t,singleChoose:!0,fullTip:"",title:"请选择你的心愿物品"}),closeCB:function(e){e&&i.getReward({code:i.code,id:WishTreeOper.SetWishId,num:e[0]?parseInt(e[0]):0})}})}},this),this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.info.data.wishId?i.getReward({code:i.code,id:WishTreeOper.Wish,num:1}):Utils.MsgUtils.addMidMsg("请先选择心愿物品")},this),this.btn_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.info.data.wishId?i.getReward({code:i.code,id:WishTreeOper.Wish,num:10}):Utils.MsgUtils.addMidMsg("请先选择心愿物品")},this);for(var e=0;e<10;e++){var t=new n;t.x=this.pos[e][0],t.y=this.pos[e][1],t.visible=!1,this.gp_rewards.addChild(t),this.reward_items.push(t)}},e.prototype.updateView=function(e){var o=this;p.prototype.updateView.call(this,e);var t=this.info;if(t&&t.data){var i=JSON.parse(t.content),n=t.data.wishId,a=t.data.wishGrade;this.img_chose.source=n?"xyzs_txt_dangqian_png":"xyzs_txt_xuanze_png";var r=i[0];for(var s in this.hasInit||(this.hasInit=!0,this.pb_lucky.maximum=i[4],this.cost_1.updateItem({cost:i[1][0],style:CommonIconStyle.RIGHT}),this.cost_10.updateItem({cost:i[2][0],style:CommonIconStyle.RIGHT}),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=o.info.content[5],t=[];for(var i in e){var n=e[i];n[0]&&t.push({text:n[0]}),n[1]&&t.push({text:n[1],style:{textColor:36807}}),t.push({text:"\n"})}PopUpManager.addPopUp({obj:new d.HelpDialog({text:t})})},this)),this.pb_lucky.value=a,this.bm_cur.text=a+"/",this.bm_max.text=this.pb_lucky.maximum+"",a>=this.pb_lucky.maximum?(this.bm_cur.font="green_num_fnt",this.img_tip.source="xyzs_txt_xuyuanzhi_png"):(this.bm_cur.font="white_num_fnt",this.img_tip.source="xyzs_txt_xingyunzhi_png"),this.baseitem_chose.visible=!1,r){var c=r[s];c[0]==n&&(this.baseitem_chose.updateData({reward:c[1][0]}),this.baseitem_chose.visible=!0);var l=!!c[5],h=c[6]-1;this.reward_items[h]&&!l&&this.reward_items[h].update({isRare:l,rewards:c[1],id:c[0]})}this.updateTitle()}},e.prototype.updateTitle=function(){var e=this,t=d.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(t),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=t--?e.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(t):d.AppFacade.getInstance().hideSubView(d.ActivityMediator.N,d.ActivityMediator.SV.MAIN)},this,1e3)},e}(d.ActivityCommonView);d.Activity162=e,__reflect(e.prototype,"game.Activity162");var n=function(i){function e(){var e=i.call(this)||this;return e.skinName="Activity162Item",e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),UIActionManager.addEffect(this.gp_main,"common_xysqiuzhao",{childIndex:1,offectY:-10},function(e){(t.effectObj=e).visible=!(!t.data||!t.data.isRare)}),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data&&d.GeneralConfig.showItemDetail(t.data.rewards[0])},this),this.img_bg.source="xyzs_img_waikuang1_png"},e.prototype.update=function(e){this.data=e,this.visible=!0,this.img_bg.visible=!(this.data&&this.data.isRare),this.img_rare.visible=!(!this.data||!this.data.isRare),this.effectObj&&(this.effectObj.visible=!(!this.data||!this.data.isRare));var t=d.GameMVC.backpackPy.getInfoByCode(this.data.rewards[0][1]);this.img_icon.source=t.info.icon+"_png",this.lb_name.text=t.info.name,this.bm_num.text=this.data.rewards[0][2]},e}(eui.ItemRenderer);__reflect(n.prototype,"Activity162Item")}(game||(game={})),function(S){var e=function(P){function e(){var e=P.call(this)||this;return e.boxs0=[],e.boxs1=[],e.skinName="Activity163",e}return __extends(e,P),e.prototype.childrenCreated=function(){var o=this;P.prototype.childrenCreated.call(this),this.btn_buy0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.buyBtnFunc0&&o.buyBtnFunc0()},this),this.btn_buy1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.buyBtnFunc1&&o.buyBtnFunc1()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=o.info.content[4],t=[];for(var i in e){var n=e[i];n[0]&&t.push({text:n[0]}),n[1]&&t.push({text:n[1],style:{textColor:36807}}),t.push({text:"\n"})}PopUpManager.addPopUp({obj:new S.HelpDialog({text:t})})},this)},e.prototype.updateView=function(e){var p=this;P.prototype.updateView.call(this,e);var t=this.info;if(t&&t.data){var d=JSON.parse(t.content);if(!this.hasInit){this.hasInit=!0;for(var s=0;s<2;s++){var i=d[0][s],n=(i[0],i[1]),o=i[2],a=i[4],r=this["gp_rewards"+s];S.GameMgr.getInstance().CommonGpAddReward(r,o,.95);var c=this["bm_max"+s];c&&(c.text=a);var l=S.GameMVC.rechargePy.getGoodInfo(n);if(l){var h=this["btn_buy"+s];h&&(h.label=l.price+"元")}}for(s=0;s<2;s++){var u=d[s+1],g=0;for(var f in u){(m=u[f])[2]>g&&(g=m[2])}var _=this["pb_"+s];if(_&&(_.maximum=g),r=this["gp_pb"+s])for(var f in u){var m=u[f],y=new S.ActivityBox;y.setDecorateData({getEffect:function(e){return"common_jxbaoxiang_1"},get_tipBm_font:function(e){return e.key>=e.target?"green_num_fnt":"white_num_fnt"},get_tipBm_text:function(e){return e.target},get_boxImg_source:function(e){return e.status==REWARD_STATUS.RECEIVED?"jjqy_img_baoxiang2_png":"jjqy_img_baoxiang1_png"},onBtnTap_boxImg_source:function(e){return"jjqy_img_baoxiang2_png"}}),y.horizontalCenter=r.width*m[2]/g-r.width/2,y.bm_count.top=90,this["boxs"+s].push(y),r.addChild(y)}}}var v=t.data.targeted;for(s=0;s<2;s++){u=d[s+1];var T=0==s?t.data.blessGrade:t.data.zoneGrade;this["bm_curWish"+s].text=T,(this["pb_"+s].value=T)||(T=0);var C=function(e){var t=u[e],i=t[0],n=t[1],o=t[2],a=REWARD_STATUS.UNAVAILABLE;o<=T&&(a=REWARD_STATUS.AVAILABLE),0<=v.indexOf(i)&&(a=REWARD_STATUS.RECEIVED);var r=E["boxs"+s][e];r&&r.update({status:a,rewards:n,key:T,target:o,btnFunc:function(e){p.getReward({code:p.code,id:i,num:1})}})},E=this;for(var f in u)C(f)}var b=t.data.recharged,I=function(e){var t=0,i=d[0][e],n=i[0],o=i[1],a=(i[2],i[4]);for(var r in b){var s=b[r];s[0]==e+1&&(t=s[1])}var c=A["bm_cur"+e];c&&(c.text=t+"/"),c.font=a<=t?"green_num_fnt":"white_num_fnt";var l=S.GameMVC.rechargePy.getGoodInfo(o);if(a<=t){A["buyBtnFunc"+e]=function(){Utils.MsgUtils.addMidMsg("已购买")};var h=A["btn_buy"+e];h&&(h.skinName="skins.ButtonSkinSure",h.label="已购买")}else A["buyBtnFunc"+e]=function(){l?S.GameMVC.rechargePy.purchase(l,2,n,JSON.stringify({uuid:n,activityType:p.code}),{activityType:p.code}):Utils.MsgUtils.addMidMsg("找不到商品信息")}},A=this;for(s=0;s<2;s++)I(s);this.updateTitle()}},e.prototype.updateTitle=function(){var e=this,t=S.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(t),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=t--?e.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(t):S.AppFacade.getInstance().hideSubView(S.ActivityMediator.N,S.ActivityMediator.SV.MAIN)},this,1e3)},e}(S.ActivityCommonView);S.Activity163=e,__reflect(e.prototype,"game.Activity163")}(game||(game={})),function(s){var e=function(i){function e(){var e=i.call(this)||this;return e.FIXED_LAP=5,e.itemAngle=45,e.rotating=!1,e.curIndex=0,e.tableInit=!1,e.skinName="Activity170",e}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),DragonBoneTools.playOnce({effectName:"common_zhuanpandeng_1",parent:this.gp_effect,loop:!0}),this.activateComponent()},e.prototype.updateView=function(e){var a=this;i.prototype.updateView.call(this,e);var r=this.info;if(r&&r.data){var t=r.content[0];this.tableInit||(t.forEach(function(i,e){var t=a["gp_Reward"+e],n=customui.BaseItemFactory.create();if(n.scaleX=n.scaleY=70/105,n.horizontalCenter=n.verticalCenter=0,n.updateData({reward:i[1][0]}),t.addChild(n),i[3]||i[4]){var o=new eui.Image;o.source="zsle_txt_xiyou_png",o.right=0,o.top=0,o.scaleX=o.scaleY=70/105,t.addChild(o),UIActionManager.addEffect(t,"common_fangkuang",{scaleX:.8,scaleY:.8,offectX:-2,offectY:-2},function(e){var t=0;t=i[3]?Math.ceil(r.data.zoneDiamond*i[3]):Math.ceil(r.data.diamond*i[4]),e.visible=!!t}),n.touchEnabled=!1,i[3]?((a.zoneDiamondBaseitem=n).img_icon.source="zsle_icon_zhan_png",a.zoneRate=i[3],t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(a.info.data.zoneDiamond){var e=Math.ceil(a.info.data.zoneDiamond*i[3]);s.AppFacade.getInstance().showSubView(s.CommonMediator.N,s.CommonMediator.SV.REWARD_PANEL,{rewards:[[1,1,e]],type:s.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})}else Utils.MsgUtils.addMidMsg("当前无战区奖池钻石")},a)):((a.selfDiamondBaseitem=n).img_icon.source="zsle_icon_ge_png",a.selfRate=i[4],t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(a.info.data.diamond){var e=Math.ceil(a.info.data.diamond*i[4]);s.AppFacade.getInstance().showSubView(s.CommonMediator.N,s.CommonMediator.SV.REWARD_PANEL,{rewards:[[1,1,e]],type:s.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})}else Utils.MsgUtils.addMidMsg("当前无个人奖池钻石")},a))}}),this.tableInit=!0),this.bm_selfRewardPool.text=r.data.diamond,Math.ceil(r.data.diamond*this.selfRate)?UIActionManager.setGrey(this.selfDiamondBaseitem.parent,!1):(UIActionManager.hideEffect(this.selfDiamondBaseitem.parent),UIActionManager.setGrey(this.selfDiamondBaseitem.parent,!0)),this.bm_zoneRewardPool.text=r.data.zoneDiamond,Math.ceil(r.data.zoneDiamond*this.zoneRate)?UIActionManager.setGrey(this.zoneDiamondBaseitem.parent,!1):(UIActionManager.hideEffect(this.zoneDiamondBaseitem.parent),UIActionManager.setGrey(this.zoneDiamondBaseitem.parent,!0)),this.bm_times.text=r.data.count,0<r.data.count?(this.bm_tips.text="",this.bm_tips.font="green_num_fnt",this.bm_tips.text="(每日重置)"):0<r.data.recharge?(this.bm_tips.text="",this.bm_tips.font="white_num_fnt",this.bm_tips.text="(当天抽奖完毕)"):(this.bm_tips.text="",this.bm_tips.font="white_num_fnt",this.bm_tips.text="(当天任意充值一次获得)"),this.updateRecord(),this.updateActivityTime(this.bm_time)}},e.prototype.rotateToIndex=function(e,t){if(!this.rotating){var i=e*this.itemAngle+this.itemAngle/2+360*this.FIXED_LAP;this.rotateToAngle(i,t)}},e.prototype.rotateToAngle=function(e,t,i){var n=this;void 0===i&&(i=5e3);for(var o=[],a=0;a<8;a++){var r=this["gp_Reward"+a];r&&o.push(r)}this.rotating=!0,GameRootLayer.gameLayer().switchTouchEnable(!1);this.gp_roll.rotation=this.gp_roll.rotation%360,egret.Tween.get(this.gp_roll,{onChange:function(){var t=360*(n.FIXED_LAP+1)-n.gp_roll.rotation;o.forEach(function(e){e.rotation=t})},onChangeObj:this}).to({rotation:e},i,function(e){return 1-Math.pow(1-e,3)}).call(function(){n.rotating=!1,GameRootLayer.gameLayer().switchTouchEnable(!0),t&&t()})},e.prototype.updateRecord=function(){var e=this.info;if(e&&e.data){var a=e.content[0];this.gp_record.removeChildren(),e.data.record&&0!=Object.keys(e.data.record).length||(e.data.record=[]);var r=e.data.record;for(var t in r.sort(function(e,t){return t.dt-e.dt}),r.forEach(function(e,t){var i=1;for(var n in a){var o=a[n];o[0]==e.id&&o[4]&&(i=2)}r[t].textFlow=[{text:"祝贺",style:{textColor:16777215}},{text:e.name+"",style:{textColor:6531583}},{text:"喜中",style:{textColor:16777215}},{text:1==i?"战区钻石大奖":"个人钻石大奖",style:{textColor:1==i?16751149:12805375}},{text:"，获得钻石",style:{textColor:16777215}},{text:Utils.MathUtils.formatNumStyle1(e.num)+"",style:{textColor:6618944}}]}),r){var i=r[t],n=new eui.Label;n.size=22,n.textFlow=i.textFlow,this.gp_record.addChild(n)}}},e.prototype.activateComponent=function(){var o=this;Utils.ComponentUtils.registerListener(this.btn_roll,egret.TouchEvent.TOUCH_TAP,function(){0<o.info.data.count?Utils.Socket.send("activity","DoCommonOperation",{code:o.code,num:1,id:1}).then(function(e){o.gp_effect.$children[0].visible=!1,DragonBoneTools.playOnce({effectName:"common_zhuanpandeng_2",parent:o.gp_effect,loop:!0});var t=JSON.parse(e.info);o.rotateToIndex(t.rewardCode-1,function(){o.info.updateData(t),s.GameMVC.backpackPy.handleClientReward(e.clientReward),o.gp_effect.removeChildAt(1),o.gp_effect.$children[0].visible=!0})}):Utils.MsgUtils.addMidMsg("无剩余抽奖次数")},this),Utils.ComponentUtils.registerListener(this.btn_guide,egret.TouchEvent.TOUCH_TAP,function(){var e=o.info.content[1],t=[];for(var i in e){var n=e[i];n[0]&&t.push({text:n[0]}),n[1]&&t.push({text:n[1],style:{textColor:36807}}),t.push({text:"\n"})}PopUpManager.addPopUp({obj:new s.HelpDialog({text:t})})},this),Utils.ComponentUtils.registerListener(this.btn_record,egret.TouchEvent.TOUCH_TAP,function(){var e=o.info;if(e&&e.data){e.data.record&&0!=Object.keys(e.data.record).length||(e.data.record=[]);var i=e.data.record;i.sort(function(e,t){return t.dt-e.dt}),i.forEach(function(e,t){i[t].textFlow=[{text:"恭喜",style:{textColor:16777215}},{text:e.name+"",style:{textColor:16777215}},{text:"抽中",style:{textColor:16777215}},{text:Utils.MathUtils.formatNumStyle1(e.num)+"",style:{textColor:16777215}},{text:"钻石。",style:{textColor:16777215}}]}),PopUpManager.addPopUp({obj:new s.RecordPanel({records:i,title:"中奖记录"})})}},this)},e}(s.ActivityCommonView);s.Activity170=e,__reflect(e.prototype,"game.Activity170")}(game||(game={})),function(I){var t,e=function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return __extends(r,e),r.prototype.updateView=function(e){if(e&&e.activityType){this.code=e.activityType,this.updateTitle();var t=this.getDataList();switch(this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(t):this.list_itemList.dataProvider=new eui.ArrayCollection(t),this.code){case EActivityType.ConsumeDiamondTask:this.actProxy.isOpen(EActivityType.NewZoneConsumeRank)&&(this.btn_left.visible=!0,this.btn_left.icon="_btn_lb_m_json.common_icon_paihangbang",this.btn_left.label="排行榜",this.btn_left.width=72,this.btn_left.height=85,this.btn_left.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.btn_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){I.AppFacade.getInstance().showSubView(I.RankMediator.N,I.RankMediator.SV.COMMON,{module:"ActivityNewZoneConsumeRank"})},this))}}},r.prototype.getDataList=function(){var u=this,e=this.info;if(!e||!e.data)return[];var g=[],f=JSON.parse(e.content),_=e.data.targeted;_[0]||(_=[]);var l=e.data.keyList,m={},y=function(e){var t=0;e=Number(e);var i=Math.floor(e/1e4),n=Math.floor((e-1e4*i)/100);for(var o in l){var a=l[o].taskType,r=l[o].key,s=Math.floor(a/1e4),c=Math.floor((a-1e4*s)/100);0==i?n<=c&&(t+=r):i==s&&n<=c&&(t+=r)}return t},t=I.Config.activityConfigs()[this.code],v=t&&t.rotation||1,T=0,C=9999999,i=0,n=0;if(1!=v){for(var o=f.length/v,a=1;a<=v;a++){var r=f[b=a*o-1],s=(r[0],(r[1]+"").split("")),c=Number(s[s.length-1]),h=r[3],p=this.getTypeKey(h,r);if(!(c<=(m[p]||y(r[1])))){C=c;break}if(i++,!(_.length>b)){C=c;break}n++,T=c}v<=n&&(n=v-1,T=f[f.length-o-1]&&f[f.length-o-1][1]||0,C=f[f.length-1][1])}var d=function(e){var t=f[e],i=t[0],n=(t[1]+"").split(""),o=Number(n[n.length-1]);if(1!=v&&(o<=T||C<o))return"continue";var a=t[2],r=t[3],s=t[4],c=E.getTypeKey(r,t),l=m[c]||y(t[1]),h=REWARD_STATUS.CANBUY;o<=l&&(h=REWARD_STATUS.AVAILABLE),0<=_.indexOf(i)&&(h=REWARD_STATUS.RECEIVED);var p=E.getTitle(r,t);E.code==EActivityType.ConsumeDiamondTask&&h==REWARD_STATUS.CANBUY&&(h=REWARD_STATUS.UNAVAILABLE);var d={id:i,key:o,title:p,status:h,rewards:a,tips:l-T+"/"+(o-T),btnText:h==REWARD_STATUS.CANBUY?"前往":"",btnFunc:function(e){switch(h){case REWARD_STATUS.AVAILABLE:u.getReward({code:u.code,id:i});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.CANBUY:s&&I.MainJumpConfig.jumpTo(s);break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件")}}};g.push(d)},E=this;for(var b in f)d(b);return this.commonSortDataList(g),t&&1!=t.rotation&&0!=t.rotation&&(this.lb_round.visible=!0,this.lb_round.text="完成次数("+i+"/"+v+")"),g},r.prototype.getTitle=function(e,t){switch(this.code){case EActivityType.HeroStarSubTypeNumTask:var i=Math.floor(t[1]/1e4),n=Math.floor((t[1]-1e4*i)/100),o=t[1]%100,a=I.Config.heroConfigBySubType(i)[0];return(r.TaskType_2_Title[e]||"").format([o,a&&a.name||"无配置",n]);default:return(I.ActivityCommonTaskView.TaskType_2_Title[e]||"").format([t[1]%1e4])}},r.prototype.getTypeKey=function(e,t){var i=e;switch(this.code){case EActivityType.HeroStarSubTypeNumTask:i=t[1]-t[1]%100}return i},r.TaskType_2_Title=((t={})[TaskSubType.HeroStarSubTypeNum]="将%s个%s升级到%s星",t),r}(I.ActivityCommonListView);I.Activity173=e,__reflect(e.prototype,"game.Activity173")}(game||(game={})),function(y){var e=function(m){function e(){var e=m.call(this)||this;return e.lastIndex=0,e.isPlaying=!1,e.skinName="Activity174",e}return __extends(e,m),e.prototype.childrenCreated=function(){var e=this;m.prototype.childrenCreated.call(this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btnFunc&&e.btnFunc()},this),this.btn_playVideo.visible=!1,this.btn_playVideo.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this),UIActionManager.addEffect(this.gp_effect,"common_shenqizs")},e.prototype.updateView=function(e){var t=this;m.prototype.updateView.call(this,e);var i=this.info;if(i&&i.data){var n=JSON.parse(i.content);n.sort(function(e,t){return e[0]-t[0]});for(var o=i.data.day,a=i.data.targeted,r=1;r<=n.length;){var s=!1;for(var c in a)if(a[c].id==r){s=!0;break}if(!s)break;r++}var l=n[r-1];if(l){var h=l[2],p=y.GameMVC.rechargePy.getGoodInfo(h);this.btn_buy.label=p?p.price+"元":"商品错误";var d=REWARD_STATUS.UNAVAILABLE;if(!(r<=o))return d=REWARD_STATUS.HASBUY,void this.hide();d=REWARD_STATUS.AVAILABLE;var u=l[1];if(this.btnFunc=function(){switch(d){case REWARD_STATUS.AVAILABLE:p?y.GameMVC.rechargePy.purchase(p,2,u,JSON.stringify({uuid:u,activityType:t.code}),{activityType:t.code,uuid:u}):Utils.MsgUtils.addMidMsg("找不到商品信息");break;case REWARD_STATUS.HASBUY:Utils.MsgUtils.addMidMsg("已购买");break;default:Utils.MsgUtils.addMidMsg("状态错误")}},this.lastIndex!=r){this.lastIndex=r,this.gp_rewards.removeChildren();var g=l[3];y.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,g,.8),this.lb_name.text=l[4],this.HeroDynamicModel.update({model:l[5],isStatic:!0}),this.gp_preview.removeChildren();var f=l[6];MovieClipTools.create(f,function(e){e&&(e.x=this.gp_preview.width/2,e.y=this.gp_preview.height/2,e.scaleX=this.gp_preview.width/e.width,e.scaleY=this.gp_preview.height/e.height,this.effectObj=e,this.effectObj&&this.effectObj.animation.play(1),e.addEventListener(egret.Event.COMPLETE,function(){this.effectObj.animation.play(1)},this),this.gp_preview.addChild(e))},this)}var _=y.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(_),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=_--?t.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(_):t.hide()},this,1e3)}else this.hide()}else this.hide()},e}(y.ActivityCommonPanel);y.Activity174=e,__reflect(e.prototype,"game.Activity174")}(game||(game={})),function(I){var e=function(i){function e(){var e=null!==i&&i.apply(this,arguments)||this;return e.img_wholeLifeCard=new eui.Image,e.selectIndex=0,e.hasInitTabbar=!1,e.rechargegGradient=[],e.unlockLevel=50,e}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.tabbar=new eui.TabBar,this.tabbar.itemRendererSkinName="TabBarItemSkin3",this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabbarTap,this),this.tabbar.left=20,this.tabbar.bottom=0;var e=new eui.HorizontalLayout;e.gap=5,this.tabbar.layout=e,this.gp_title.addChild(this.tabbar);var t=new eui.Image;t.source="vipfl_img_hengtiao_png",t.bottom=0,t.horizontalCenter=0,this.gp_title.addChild(t),this.img_wholeLifeCard.left=165,this.img_wholeLifeCard.bottom=55,this.gp_title.addChild(this.img_wholeLifeCard),this.bm_time.right=-60,this.bm_time.y-=30},e.prototype.initList=function(){this.list_itemList.itemRenderer=t},e.prototype.onTabbarTap=function(e){if(2==e.itemIndex&&I.GameMVC.playerPy.playerInfoVO.level<this.unlockLevel)return Utils.MsgUtils.addMidMsg(this.unlockLevel+"级解锁"),void(this.tabbar.selectedIndex=this.selectIndex);this.selectIndex=e.itemIndex,this.updateView()},e.prototype.updateView=function(e){var t=this;this.code=e&&e.activityType||e&&e.code||this.code;var i=this.info;if(i&&i.data){if(this.updateTitle(),!this.hasInitTabbar){var n=[];n.push({up:"vipfl_yeqian_meirifuli2_png",down:"vipfl_yeqian_meirifuli1_png",text:""}),n.push({up:"vipfl_yeqian_viplibao2_png",down:"vipfl_yeqian_viplibao1_png",text:""}),n.push({up:"vipfl_yeqian_meizhoulibao2_png",down:"vipfl_yeqian_meizhoulibao1_png",text:""}),this.tabbar.dataProvider=new eui.ArrayCollection(n),this.tabbar.once(eui.UIEvent.ENTER_FRAME,function(){t.updateNotice()},this)}var o=this.getDataList();if(this.list_itemList.dataProvider=new eui.ArrayCollection(o),0==this.selectIndex){var a=I.GameMVC.activityPy.allActivityData[EActivityType.WholeLifeCard],r=a&&a.data&&a.data.hasPurchased&&!0;this.img_wholeLifeCard.source=r?"vipfl_img_yijihuo_png":"vipfl_img_weijihuo_png"}else this.img_wholeLifeCard.source="";this.updateTitle(),this.updateNotice()}},e.prototype.getNextLevelExp=function(){var e=I.GameMVC.playerPy.playerInfoVO.playerVip.vipLevel,t=I.Config.VIPUpgradeConfig()[e+1];return t?Math.ceil(t.exp-I.GameMVC.playerPy.playerInfoVO.playerVip.exp)/10:0},e.prototype.getDataList=function(){var l=this,e=this.info;if(!e||!e.data)return[];if(1==this.selectIndex)return this.getDataList2();var h=e.data.amounts,p=JSON.parse(e.data.dailyTargeted),c=JSON.parse(e.data.weekTargeted),d=JSON.parse(e.data.dailyAmountsTargeted),u=e.data.vip,g=I.GameMVC.playerPy.playerInfoVO.playerVip.vipLevel,i=JSON.parse(e.content);if(!i)return[];var f=[],_=this.getNextLevelExp();if(0==this.selectIndex)for(var t=function(s){var c=i[s],e=function(e){var t=c[e];if(t[1]>=u&&t[1]<=g||0==s&&t[1]==g+1||1==s){var i=t[0],n=0==s?0:t[2],o=0==s?t[2]:t[3],a=REWARD_STATUS.UNAVAILABLE;n<=h&&(t[1]>=u&&t[1]<=g||1==s&&g>=t[1])&&(a=REWARD_STATUS.AVAILABLE),0<=(0==s?p:d).indexOf(i)&&(a=REWARD_STATUS.RECEIVED);var r=0==s?"vip"+t[1]+"专属每日福利":"当日累充"+t[2]+"元福利";_&&t[1]==g+1&&(r+="（再充值"+_+"元可领取）"),a==REWARD_STATUS.RECEIVED&&0==s&&t[1]!=g||f.push({id:i,title:r,rewards:o,status:a,btnFunc:function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:l.getReward({id:i,code:l.code,num:s+1});break;case REWARD_STATUS.GO_RECHARGE:I.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("VIP等级不足")}}})}};for(var t in c)e(t)},n=0;n<2;n++)t(n);else{var m=i[2],y=I.GameMVC.playerPy.playerInfoVO.level,o=function(e){var t=m[e];if(y>=t[1]){var i=t[0],n=c,o=REWARD_STATUS.UNAVAILABLE;g>=t[2]&&(o=REWARD_STATUS.AVAILABLE);var a=0;n.forEach(function(e){e[0]==i&&(a=e[1])}),a>=t[3]&&(o=REWARD_STATUS.RECEIVED);var r=t[5],s=t[4];f.push({id:i,title:"       "+t[7],costs:s[0],discount:t[6],tips:g>=t[2]?"可购买"+(t[3]-a)+"次":"vip"+t[2]+"解锁",rewards:r,status:o,btnFunc:function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:l.getReward({id:i,code:l.code,num:3});break;case REWARD_STATUS.GO_RECHARGE:I.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("VIP等级不足")}}})}};for(var a in m)o(a)}return f.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id}),f},e.prototype.getDataList2=function(){var a=this,r=[],s=I.AppFacade.getInstance().retrieveProxy(I.RechargePy.N),c=I.Config.VIPUpgradeConfig(),e=I.AppFacade.getInstance().retrieveProxy(I.PlayerPy.N).playerInfoVO.playerVip,l=e.vipLevel||0,h=e.vipGiftGot,t=function(e){var t=c[e];if(!t.level||t.level>l+3)return"continue";var i=REWARD_STATUS.CANBUY;h[t.level]&&(i=REWARD_STATUS.HASBUY),t.level>l&&(i=REWARD_STATUS.UNAVAILABLE_BUY);var n=JSON.parse(t.costs),o={id:t.level,title:"       VIP"+t.level+"礼包",status:i,rewards:t.gifts,discount:t.discount,costs:n[0],isVip:!0,btnFunc:function(){switch(o.status){case REWARD_STATUS.AVAILABLE:case REWARD_STATUS.CANBUY:s.GetVipLevelGift(t.level,function(){a.updateView(void 0)});break;case REWARD_STATUS.UNAVAILABLE:case REWARD_STATUS.UNAVAILABLE_BUY:Utils.MsgUtils.addMidMsg("VIP等级不足");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.HASBUY:Utils.MsgUtils.addMidMsg("已购买")}}};r.push(o)};for(var i in c)t(i);return r.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id}),r},e.prototype.updateNotice=function(){var e=this.info;if(e&&e.data){for(var t=e.data.amounts,i=JSON.parse(e.data.dailyTargeted),s=JSON.parse(e.data.weekTargeted),n=JSON.parse(e.data.dailyAmountsTargeted),o=e.data.vip,c=I.GameMVC.playerPy.playerInfoVO.playerVip.vipLevel,a=I.GameMVC.activityPy.allActivityData[EActivityType.WholeLifeCard],r=a&&a.data&&a.data.hasPurchased&&!0,l=JSON.parse(e.content),h=!1,p=0;p<2;p++){var d=l[p];for(var u in d){var g=d[u];if(g[1]>=o&&g[1]<=c||0==p&&g[1]==c+1){var f=g[0],_=0==p?0:g[2],m=(0==p?g[2]:g[3],REWARD_STATUS.GO_RECHARGE);if(_<=t&&g[1]>=o&&g[1]<=c&&(m=REWARD_STATUS.AVAILABLE),0<=(0==p?i:n).indexOf(f)&&(m=REWARD_STATUS.RECEIVED),m==REWARD_STATUS.AVAILABLE&&r){h=!0;break}}}if(h)break}(C=this.tabbar.$children[0])&&(E=C.img_notice)&&(E.right=-5,E.visible=h);h=!1,d=l[2];var y=I.GameMVC.playerPy.playerInfoVO.level,v=function(e){var t=d[e];if(T.unlockLevel=T.unlockLevel<t[1]?T.unlockLevel:t[1],y>=t[1]){var i=t[0],n=s,o=REWARD_STATUS.UNAVAILABLE;c>=t[2]&&(o=REWARD_STATUS.AVAILABLE);var a=0;n.forEach(function(e){e[0]==i&&(a=e[1])}),a>=t[3]&&(o=REWARD_STATUS.RECEIVED);var r=t[4];if(o==REWARD_STATUS.AVAILABLE&&I.GameMVC.backpackPy.checkEnough(r,!1))return h=!0,"break"}},T=this;for(var u in d){if("break"===v(u))break}(C=this.tabbar.$children[2])&&(E=C.img_notice)&&(E.right=-5,E.visible=h);var C,E,b=I.AppFacade.getInstance().retrieveProxy(I.RechargePy.N);(C=this.tabbar.$children[1])&&(E=C.img_notice)&&(E.right=-5,E.visible=b.checkVipGiftNotice())}},e.prototype.updateTitle=function(){var e=I.Config.activityConfigs()[this.code];e&&(this.img_title.source=JSON.parse(e.img_title)[this.selectIndex]+"_png"),this.bm_time.text=""},e}(I.ActivityCommonListView);I.Activity175=e,__reflect(e.prototype,"game.Activity175");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="Activity175ItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_costs.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc(this.data)},this),this.btn_costs.cui_freshCost.left=void 0,this.btn_costs.cui_freshCost.horizontalCenter=0,this.btn_costs.btn_oppr.skinName="skins.ButtonSkinYellow"},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.gp_oldPrice.visible=!!this.data.isVip,this.data.costs?(this.gp_discount.visible=!0,this.bm_discount.text=this.data.discount/10+"",this.data.status!=REWARD_STATUS.RECEIVED&&this.data.status!=REWARD_STATUS.HASBUY?(this.btn_operate.visible=!1,this.btn_costs.visible=!0,this.btn_costs.cui_freshCost.updateItem({cost:this.data.costs,style:CommonIconStyle.RIGHT})):(this.btn_operate.visible=!0,this.btn_costs.visible=!1),this.data.isVip&&this.CommonIconWithNum.updateItem({type:this.data.costs[0],code:this.data.costs[1],num:this.data.costs[2]/this.data.discount*100,style:CommonIconStyle.RIGHT})):(this.btn_operate.visible=!0,this.btn_costs.visible=!1,this.gp_discount.visible=!1)},e}(I.ActivityCommonListItem);__reflect(t.prototype,"Activity175Item")}(game||(game={})),function(r){var e=function(a){function e(){var e=a.call(this)||this;return e.skinName="Activity176",e}return __extends(e,a),e.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.list_root.itemRenderer=t,this.list_root.img_nextOne.source=this.list_root.img_lastOne.source=""},e.prototype.updateView=function(e){var l=this;a.prototype.updateView.call(this,e);var t=this.info;if(t&&t.data){var h=JSON.parse(t.content);this.hasInit||(this.bm_minRecharge.text=h[0],this.bm_scaleTimes.text=h[2]);var p=t.data.amounts,d=t.data.targeted,u=t.data.day;p>=h[0]?this.img_hasbuy.source="zxjj_img_yidacheng_png":this.img_hasbuy.source="zxjj_img_weidacheng_png",this.hasInit||this.gp_rewards.removeChildren();var g=[],f=[],i=function(e){var t=h[1][e],i=REWARD_STATUS.UNAVAILABLE;p>=h[0]&&u>=t[0]&&(i=REWARD_STATUS.AVAILABLE),0<=d.indexOf(t[0])&&(i=REWARD_STATUS.RECEIVED),g.push({id:t[0],rewards:t[1],status:i,btnFunc:function(e){switch(e.status){case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("单笔充值额度不足");break;case REWARD_STATUS.AVAILABLE:l.getReward({id:t[0],code:l.code,num:t[0]});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}});var n=t[1];for(var o in n){var a=n[o],r=!1;for(var s in f){var c=f[s];c[0]==a[0]&&c[1]==a[1]&&(r=!0,c[2]+=a[2])}r||f.push([a[0],a[1],a[2]])}};for(var n in h[1])i(n);this.hasInit||r.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,f),a.prototype.commonSortDataList.call(this,g),this.list_root.dataProvider=new eui.ArrayCollection(g);var o=r.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.timer&&egret.clearInterval(this.timer),this.bm_time.text=Utils.TimerManager.getFormatBySecond1(o),this.timer=egret.setInterval(function(){0<o--&&(l.bm_time.text=Utils.TimerManager.getFormatBySecond1(o))},this,1e3),this.hasInit=!0}},e}(r.ActivityCommonView);r.Activity176=e,__reflect(e.prototype,"game.Activity176");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="Activity176Item",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.effectObj=this.gp_effect,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.btnFunc&&e.data.btnFunc(e.data)},this),UIActionManager.addEffect(this.gp_effect,"common_kelingqu2",{multi:1}),UIActionManager.addEffect(this.gp_effect,"common_kelingqu2k",{multi:1,scaleY:1.43})},e.prototype.dataChanged=function(){switch(this.lb_title.text="第"+r.GeneralConfig.numToChinesNum(this.data.id)+"天",this.gp_rewards.removeChildren(),r.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,this.data.rewards,.6),this.data.status){case REWARD_STATUS.UNAVAILABLE:this.img_status.visible=!1,UIActionManager.setGrey(this,!0);break;case REWARD_STATUS.AVAILABLE:this.img_status.visible=!0,this.img_status.source="",this.img_status.scaleX=this.img_status.scaleY=1.8,UIActionManager.setGrey(this,!1);break;case REWARD_STATUS.RECEIVED:this.img_status.visible=!0,this.img_status.source="xyzp_img_yilingqu_png",this.img_status.scaleX=this.img_status.scaleY=1.2,UIActionManager.setGrey(this,!0)}this.effectObj&&(this.effectObj.visible=this.data.status==REWARD_STATUS.AVAILABLE),this.img_notice.visible=!1},e.itemWidth=238,e}(eui.ItemRenderer);__reflect(t.prototype,"Activity176Item")}(game||(game={})),function(s){var e=function(i){function e(){var e=i.call(this)||this;return e.rankPy=s.AppFacade.getInstance().retrieveProxy(s.RankPy.N),e.skinName="Activity177",e}return __extends(e,i),e.prototype.childrenCreated=function(){var o=this;i.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_help,egret.TouchEvent.TOUCH_TAP,function(){var e=o.info.content[2],t=[];for(var i in e){var n=e[i];n[0]&&t.push({text:n[0]}),n[1]&&t.push({text:n[1],style:{textColor:36807}}),t.push({text:"\n"})}PopUpManager.addPopUp({obj:new s.HelpDialog({text:t})})},this),this.list_itemList.itemRenderer=t,this.CommonDaTanChuKuang.blb_title.text="充值排行榜",this.CommonDaTanChuKuang.onCloseCB=function(){o.hide()},UIActionManager.addEffect(this.gp_firstRank,"common_paihangbang_1",{childIndex:1,offectX:0,offectY:0,scaleX:.8,scaleY:.8})},e.prototype.updateView=function(e){var r=this;i.prototype.updateView.call(this,e),this.rankPy.GetRankList({rankType:RankingType.RankingTypeActivityRechargeRank,refreshInterval:0},function(e){var o=[],a=s.Config.rankingRewardByTypeConfig(RankingType.RankingTypeActivityRechargeRank);0==e.ranks.length?r.gp_empty.visible=!0:(r.gp_empty.visible=!1,e.ranks.forEach(function(e,t){for(var i in 1==e.rank?(r.lb_topName.text=e.playerBaseInfo.name,r.cu_firstRank.updateData({vo:e.playerBaseInfo})):o.push({info:e,config:{keyWord:" "}}),a){var n=a[i];e.rank>=n.rankUpper&&e.rank<=n.rankLower&&(e.rewardsDesc=n.rewardsDesc)}}),r.list_itemList.dataProvider?r.list_itemList.dataProvider.replaceAll(o):r.list_itemList.dataProvider=new eui.ArrayCollection(o));var t=r.rankPy.getSelfRank(RankingType.RankingTypeActivityRechargeRank);if(t)for(var i in r.img_iconSelf.source=r.rankPy.rankIcon(t.rank),r.img_iconSelf.source?r.blb_rankSelf.text="":r.blb_rankSelf.text=t.rank.toString(),r.bm_selfRecharge.text="充值:"+t.key+"元",r.lb_selfReward.text="请继续加油",a){var n=a[i];t.rank>=n.rankUpper&&t.rank<=n.rankLower&&(r.lb_selfReward.text=n.rewardsDesc)}else r.lb_selfReward.text="请继续加油",r.blb_rankSelf.text="",r.img_iconSelf.source="",r.bm_selfRecharge.text="";r.cu_self.updateData({vo:s.GameMVC.playerPy.playerInfoVO}),r.lb_nameSelf.text=""+s.GameMVC.playerPy.playerInfoVO.name});var t=s.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.timer&&egret.clearInterval(this.timer),this.bm_time.text=Utils.TimerManager.getFormatBySecond1(t),this.timer=egret.setInterval(function(){0<t--&&(r.bm_time.text=Utils.TimerManager.getFormatBySecond1(t))},this,1e3)},e}(s.ActivityCommonPanel);s.Activity177=e,__reflect(e.prototype,"game.Activity177");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="Activity177Item",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.lb_keyValue.text=this.data.info.rewardsDesc||"请继续加油",this.bm_recharge.text="充值"+this.data.info.key+"元",this.lb_name.textFlow=[{text:this.data.info.playerBaseInfo.name,style:{textColor:16777215}},{text:"("+this.data.info.playerBaseInfo.serverId+"服)",style:{textColor:196437}}]},e}(s.CommonRankPanel_RankItem);__reflect(t.prototype,"Activity177Item")}(game||(game={})),function(R){var e=function(k){function e(){var e=k.call(this)||this;return e.topListSelectIndex=1,e.tabbarSelectIndex=0,e.lastLevel=0,e.skinName="Activity179",e}return __extends(e,k),e.prototype.childrenCreated=function(){var t=this;k.prototype.childrenCreated.call(this);this.tabbar.itemRendererSkinName="TabBarItemSkin3",this.tabbar.dataProvider=new eui.ArrayCollection([{up:"djlb_yeqian_lbgm2_png",down:"djlb_yeqian_lbgm1_png",text:""},{up:"djlb_yeqian_thcz2_png",down:"djlb_yeqian_thcz1_png",text:""}]),this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){t.tabbarSelectIndex=e.itemIndex,t.updateDetailList()},this),this.CommonArrayList.itemRenderer=i,this.CommonArrayList.setItemTapEvent(this.onItemTap,this),this.CommonArrayList.gap=-100,this.list_root.itemRenderer=R.ActivityCommonListItem,this.btn_jump1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){R.MainJumpConfig.jumpTo(MODULE.Champion)},this),this.btn_jump2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){R.MainJumpConfig.jumpTo(MODULE.Risk)},this)},e.prototype.updateView=function(e){var i=this;k.prototype.updateView.call(this,e);var t=this.info;if(t&&t.data){for(var n=R.GameMVC.playerPy.playerInfoVO.level,o=-1,a=[],r=JSON.parse(t.content),s=0;s<2;s++)for(var c=0,l=r[s],h=0==s?t.data.diamondTargeted:t.data.rechargeTargeted,p=0==s?t.data.diamondGifts:t.data.rechargeGifts,d=0;d<l.length;d++){var u=0,g=l[d],f=g[0],_=g[1];if(2==c)break;for(var m in p){if((N=p[m])[0]==f){u=N[1];break}}var y=REWARD_STATUS.UNAVAILABLE;for(var m in _<=n?y=REWARD_STATUS.CANBUY:c++,h){if((N=h[m])[0]==f){0<N[1]&&(y=REWARD_STATUS.RECEIVED);break}}var v="";if(0==s)v=g[2][0][2]+"钻礼包";else{var T=R.GameMVC.rechargePy.getGoodInfo(g[2]);v=T?T.price+"元礼包":"找不到商品配置"}for(var C={id:f,type:s,title:v,tips:"",status:y,rewards:g[3],costs:g[2],goodId:g[2],btnFunc:function(e){if(e)switch(e.status){case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("等级不足");break;case REWARD_STATUS.CANBUY:if(0==e.type)R.GameMVC.backpackPy.checkEnough(e.costs,!1)?i.getReward({code:i.code,id:e.type+1,num:e.id}):Utils.MsgUtils.addMidMsg("钻石不足");else{var t=R.GameMVC.rechargePy.getGoodInfo(e.goodId);t?R.GameMVC.rechargePy.purchase(t,2,e.id,JSON.stringify({uuid:e.id,activityType:i.code}),{activityType:i.code,uuid:e.id}):Utils.MsgUtils.addMidMsg("找不到商品配置")}break;case REWARD_STATUS.CANBUY:Utils.MsgUtils.addMidMsg("已购买")}else Utils.MsgUtils.addMidMsg("没传data")}},E=!1,b="data"+s,I=0;I<a.length;I++){var A=a[I];if(A.level==_){A[b]?A[b].push(C):A[b]=[C],A.level<=n&&C.status==REWARD_STATUS.CANBUY&&(A.notice=!0),E=!0;break}}E||a.push(((P={level:_})[b]=[C],P.icon=g[4],P.desc=g[5],P.jumpModule=g[6],P.chosen=!1,P.status=y,P.endTime=u,P.notice=C.status==REWARD_STATUS.CANBUY,P))}var P,S=Utils.TimerManager.getServerTime();for(s=0;s<a.length;s++){var N,M=!1,w=(C=(N=a[s]).data0,N.data1);if(C){if(N.status==REWARD_STATUS.UNAVAILABLE)M=!0;else if(N.endTime<=S)M=!1;else{for(var m in C)if(C[m].status!=REWARD_STATUS.RECEIVED){M=!0;break}for(var m in w)if(w[m].status!=REWARD_STATUS.RECEIVED){M=!0;break}}M||(a.splice(s,1),s--)}else a.splice(s,1),s--}if(0==a.length)return this.hide(),void R.AppFacade.getInstance().hideSubView(R.ActivityMediator.N,R.ActivityMediator.SV.MAIN);this.hasInit?this.lastLevel&&(a[0]&&a[0].level!=this.lastLevel?this.once(egret.Event.ENTER_FRAME,function(){i.CommonArrayList.jumpTo(0)},this):this.once(egret.Event.ENTER_FRAME,function(){i.CommonArrayList.jumpTo(i.topListSelectIndex)},this)):(this.hasInit=!0,o<0&&(o=0),o>a.length-1&&(o=a.length-1),a[o]&&(a[o].chosen=!0),this.once(egret.Event.ENTER_FRAME,function(){i.CommonArrayList.jumpTo(o)},this),this.lastLevel=a[o].level),this.CommonArrayList.setDataProvider(a,!1),this.updateDetailList()}},e.prototype.onItemTap=function(e){var t=this.CommonArrayList.dataProvider[e.itemIndex];t&&!t.fade&&(this.CommonArrayList.dataProvider[this.topListSelectIndex].chosen=!1,this.topListSelectIndex=e.itemIndex,this.CommonArrayList.dataProvider[this.topListSelectIndex].chosen=!0,this.CommonArrayList.refresh(),t.status==REWARD_STATUS.UNAVAILABLE?(this.gp_empty.visible=!0,this.sl_root.visible=!1,this.tabbar.visible=!1,this.updateDetailEmpty()):(this.gp_empty.visible=!1,this.sl_root.visible=!0,this.tabbar.visible=!0,this.updateDetailList()),0!=t.endTime?this.updateTime(t.endTime-Utils.TimerManager.getServerTime()):(this.timer&&egret.clearInterval(this.timer),this.bm_time.text="",this.bm_timeTip.text=""))},e.prototype.updateDetailList=function(){var e=this.CommonArrayList.dataProvider[this.topListSelectIndex];if(e&&!e.fade){var t=e["data"+this.tabbarSelectIndex];this.list_root.dataProvider=new eui.ArrayCollection(t)}},e.prototype.updateDetailEmpty=function(){var e=this.CommonArrayList.dataProvider[this.topListSelectIndex];if(e&&!e.fade){var t=e.level,i=R.GameMVC.playerPy.playerInfoVO.level;this.lb_noEnought.textFlow=[{text:"    可惜，还差",style:{textColor:16770787}},{text:""+(t-i),style:{textColor:8774140}},{text:"级就可以激活",style:{textColor:16770787}},{text:""+e.desc,style:{textColor:8774140}},{text:"，请前往",style:{textColor:16770787}},{text:"永恒之塔",style:{textColor:8774140}},{text:"和冒险的",style:{textColor:16770787}},{text:"快速开采",style:{textColor:8774140}},{text:"获取大量经验",style:{textColor:16770787}}]}},e.prototype.updateTime=function(e){var t=this;this.timer&&egret.clearInterval(this.timer),this.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(e--),this.timer=egret.setInterval(function(){t.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(e--),e<=0&&t.updateView()},this,1e3)},e}(R.ActivityCommonView);R.Activity179=e,__reflect(e.prototype,"game.Activity179");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="Activity179Item",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data&&e.data.jumpModule?R.MainJumpConfig.jumpTo(e.data.jumpModule):Utils.MsgUtils.addMidMsg("没有跳转模块")},this),this.minScale=.6},e.prototype.dataChanged=function(){this.data.fade?this.visible=!1:(this.visible=!0,this.data.chosen?(UIActionManager.setGrey(this,!1),this.btn_go.touchEnabled=!0):this.btn_go.touchEnabled=!1,this.img_icon.source=this.data.icon+"_png",this.lb_desc.text=this.data.desc,this.lb_level.text=this.data.level+"级",this.img_notice.visible=!!this.data.notice)},e.itemWidth=276,e}(customui.scroller2p0Item);__reflect(i.prototype,"Activity179Item")}(game||(game={})),function(c){var e=function(l){function e(){var e=l.call(this)||this;return e.lastQuestionId=0,e.lastChoseId=-1,e.num2letter=["A","B","C","D","E"],e.safeData=void 0,e.answerGp=[],e.skinName="Activity184",e}return __extends(e,l),e.prototype.childrenCreated=function(){var a=this;l.prototype.childrenCreated.call(this),UIActionManager.addEffect(this.gp_effect,"hero_activity_018_01");for(var e=function(o){var e=t["gp_answer"+o];t.answerGp.push(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=c.ActivityConfig.Config[a.code];t.getRewardName;a.lastChoseId=o;var e=a.info.data.quora;if(e){a.gp_answerParent.touchChildren=!1;var i=egret.setTimeout(function(){a.gp_answerParent.touchChildren=!0},a,3e3),n={order:e.order,quoraCode:e.quoraCode,optionNum:o+1};Utils.Socket.send("activity","DoCommonOperation",{code:a.code,num:1,info:JSON.stringify(n)}).then(function(e){a.log(t.name+"——领取","DoCommonOperationR",e),i&&egret.clearTimeout(i),a.timer&&egret.clearTimeout(a.timer),a.timer=egret.setTimeout(function(){a.gp_answerParent.touchChildren=!0,a.lastChoseId=-1,a.timer=0,a.info.updateData(e.info),a.safeData=void 0},a,3e6),a.safeData=e.info,a.updateView()})}},t)},t=this,i=0;i<4;i++)e(i);this.btn_getReward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.getReward({code:a.code,num:2,id:1,info:JSON.stringify({code:a.code})})},this),this.btn_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.timer&&egret.clearTimeout(a.timer),a.gp_answerParent.touchChildren=!0,a.lastChoseId=-1,a.timer=0,a.safeData&&(a.info.updateData(a.safeData),a.safeData=void 0)},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=a.info,t=JSON.parse(e.content);c.GameMVC.activityMed.showHelpDialog(t[2])},this)},e.prototype.updateView=function(e){l.prototype.updateView.call(this,e);var t=this.info;if(t&&t.data){var i=JSON.parse(t.content),n=i[0],o=t.data.quora,a=o&&o.quoraCode||0,r=o?o.order-1:n,s=t.data.correctNum;if(this.lb_correctNum.text=s,this.timer)this.updateRewardVisible(!1),this.updateQuestion(a),this.lb_questionId.text="第"+(r+1)+"题("+(r+1)+"/"+n+")",this.updateAnswers(a,!0,this.lastChoseId),this.btn_next.label=r==n-1?"交卷":"下一题",this.btn_next.visible=!0,this.img_everyDayReset.visible=!1;else if(0==r)this.updateRewardVisible(!1),this.lastQuestionId=0,this.updateQuestion(a),this.updateAnswers(a,!1),this.lb_questionId.text="第1题(1/"+n+")",this.lb_answerResult.text="开始答题吧",this.btn_next.visible=!1,this.img_everyDayReset.visible=!0;else{var c=i[0];i[1];r<c?(this.updateRewardVisible(!1),this.updateQuestion(a),this.updateAnswers(a,!1),this.lb_questionId.text="第"+(r+1)+"题("+(r+1)+"/"+n+")"):(this.updateRewardVisible(!0),this.updateRewards()),this.btn_next.visible=!1,this.img_everyDayReset.visible=!0}}},e.prototype.updateRewardVisible=function(e){this.lb_answerDone.visible=e,this.lb_question.visible=!e,this.lb_questionId.visible=!e,this.gp_rewardGp.visible=e,this.gp_answers.visible=!e},e.prototype.updateQuestion=function(e){var t=c.Config.quoraConfig()[e];t?this.lb_question.textFlow=(new egret.HtmlTextParser).parse(t.question):this.lb_question.text="找不到题目配置"},e.prototype.updateAnswers=function(e,t,i){void 0===i&&(i=-1);var n=c.Config.quoraConfig()[e];if(n){for(var o=JSON.parse(n.answer),a=0;a<4;a++){var r=o[a],s=!!r;t?this.updateAnswer(a,a+1==n.correct,r,s,i==a):this.updateAnswer(a,void 0,r,s,i==a)}t?this.lastChoseId+1==n.correct?this.lb_answerResult.text="非常棒，回答正确！":this.lb_answerResult.text="遗憾，回答错误！":this.lb_answerResult.text="请回答下列题目"}else for(a=0;a<4;a++)this.updateAnswer(a,void 0,"",!1)},e.prototype.updateAnswer=function(e,t,i,n,o){void 0===i&&(i=""),void 0===n&&(n=!0),void 0===o&&(o=!1);var a=this.answerGp[e];if(a){var r=a.$children[1],s=a.$children[2],c=a.$children[3];s&&(s.text=this.num2letter[e]+". "+i),c.visible=o,0==n?(a.parent.removeChild(a),a.visible=!1):null==t?(a.visible=!0,r.visible=!1):(a.visible=!0,r.visible=!0,r.source=t?"jsjhd_img_gou_png":"jsjhd_img_cha_png")}},e.prototype.updateRewards=function(){var e=this.info;if(e&&e.data){var t=JSON.parse(e.content);e.data.isTargeted?c.GameMVC.activityMed.updateBtn(this.btn_getReward,REWARD_STATUS.RECEIVED):c.GameMVC.activityMed.updateBtn(this.btn_getReward,REWARD_STATUS.AVAILABLE),this.gp_rewards.removeChildren(),c.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,e.data.rewards);var i=t[1],n=e.data.correctNum;for(var o in i){var a=i[o];a[1]==n&&(this.lb_answerResult.text="成绩为"+a[2])}}},e.prototype.onDestroy=function(){this.timer&&egret.clearTimeout(this.timer),this.safeData&&this.info.updateData(this.safeData)},e}(c.ActivityCommonView);c.Activity184=e,__reflect(e.prototype,"game.Activity184")}(game||(game={})),function(C){var e=function(v){function T(){var e=v.call(this)||this;return e.lastChoseId=-1,e.num2letter=["A","B","C","D","E"],e.canAnswerTimer=0,e.openTimeDt=0,e.showCorrectAnswerTime=2,e.curOrder=-1,e.canAnswerTime=0,e.curStatus=0,e.curQuora=void 0,e.answerGp=[],e.skinName="Activity186",e}return __extends(T,v),T.prototype.childrenCreated=function(){var n=this;v.prototype.childrenCreated.call(this),UIActionManager.addEffect(this.gp_effect,"hero_activity_018_01"),this.list_rank.itemRenderer=o;for(var e=function(e){var t=i["gp_answer"+e];i.answerGp.push(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=C.ActivityConfig.Config[n.code];if(n.curQuora){n.gp_answerParent.touchChildren=!1;var i=egret.setTimeout(function(){n.gp_answerParent.touchChildren=!0},n,3e3);Utils.Socket.send("activity","ZoneQuoraAnswer",{code:n.code,order:n.curQuora.order,quoraCode:n.curQuora.quoraCode,optionNum:e+1}).then(function(e){n.log(t.name+"——领取","ZoneQuoraAnswer",e),n.gp_answerParent.touchChildren=!0,e.info.sysdt&&C.GameMgr.getInstance().updateTimeDValue(e.info.sysdt),n.updateStatus(),T.oldGrade=n.info.data.selfPlayer&&n.info.data.selfPlayer.score||0,n.info.updateData(e.info),egret.clearTimeout(i)})}},i)},i=this,t=0;t<4;t++)e(t);this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=n.info,t=JSON.parse(e.content);C.GameMVC.activityMed.showHelpDialog(t[4])},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){C.AppFacade.getInstance().showSubView(C.RankMediator.N,C.RankMediator.SV.COMMON,{module:"ACTIVITY_QUORA"})},this),this.btn_getReward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.getReward({code:n.code})},this)},T.prototype.updateView=function(e){var t=this;v.prototype.updateView.call(this,e);var i=this.info;if(i&&i.data){var n=JSON.parse(i.content);this.timeConfig=n[0][0];var o=n[1],a=C.Config.zoneQuoraConfig(),r=this.info.data.selfPlayer&&this.info.data.selfPlayer.records||[];if(!this.canAnswerTime)return this.showCorrectAnswerTime=n[3],this.canAnswerTime=n[2].length,this.updateStatus(),this.timer=egret.setInterval(function(){t.updateStatus()},this,1e3),this.bm_beginTime.text=this.timeConfig[0][0]+":"+(this.timeConfig[0][1]||"00"),this.bm_endTime.text=this.timeConfig[1][0]+":"+(this.timeConfig[1][1]||"00"),void this.updateRank();switch(this.curStatus){case 1:this.updateVisible(REWARD_STATUS.UNAVAILABLE),this.lb_rankTitle.text="上期排名",this.lb_firstOne.text="";break;case 2:case 3:this.lb_rankTitle.text="当前排名";var s=i.data.quoras,c=i.data.selfPlayer,l=(c.selfRank,c.score,c.records);this.updateVisible(REWARD_STATUS.AVAILABLE);var h=0;for(var p in s){(m=s[p]).order==this.curOrder&&(h=m.quoraCode)}if(!h)return;for(var p in this.curQuora={order:this.curOrder,quoraCode:h},this.updateQuestion(h),this.lb_questionId.text="第"+this.curOrder+"题("+this.curOrder+"/"+o+")",this.lastChoseId=-999,l){(m=l[p]).order==this.curOrder&&(this.lastChoseId=m.optionNum)}if(this.updateAnswers(h,3==this.curStatus,this.lastChoseId),3==this.curStatus)if(T.firstName){var d=JSON.parse(T.firstName);this.lb_firstOne.text="最快答对此题玩家："+d.name+"("+d.serverId+"服)"}else this.lb_firstOne.text="无人答对此题";else this.lb_firstOne.text="";break;case 4:this.lb_rankTitle.text="上期排名",this.updateVisible(REWARD_STATUS.RECEIVED),this.updateRewards(),this.lb_firstOne.text=""}if(2!=this.curStatus){this.lb_grade.text=this.info.data.selfPlayer&&this.info.data.selfPlayer.score||0;var u=0;for(var p in r){var g=(m=r[p]).quoraCode,f=m.optionNum;(y=a[g])&&f==y.correct&&u++}this.lb_correctNum.text=u+""}else{u=0;var _=!1;for(var p in r){var m,y;g=(m=r[p]).quoraCode,f=m.optionNum;(y=a[g])&&f==y.correct&&g!=this.curQuora.quoraCode&&u++,g==this.curQuora.quoraCode&&(_=!0)}this.lb_correctNum.text=u+"",_?this.lb_grade.text=T.oldGrade||"0":this.info.data.selfPlayer&&this.info.data.selfPlayer.score?this.lb_grade.text=this.info.data.selfPlayer.score:this.lb_grade.text="0"}}},T.prototype.updateStatus=function(){var e=Utils.TimerManager.checkIsOpen_FormatA(this.timeConfig);this.openTimeDt=e.openTimeDt;var t=Utils.TimerManager.getServerTime(!1),i=0,n=this.curOrder;if(t>e.openTimeDt&&t<=e.endTimeDt){var o=t-e.openTimeDt;(n=Math.ceil(o/(this.canAnswerTime+this.showCorrectAnswerTime)))<=0&&(n=1);var a=o%(this.canAnswerTime+this.showCorrectAnswerTime);if(0==a&&n++,a<=this.canAnswerTime){i=2;var r=this.canAnswerTime-a;this.bm_leftCanAnswerTime.text=Utils.TimerManager.getFormatBySecond1(r)}else i=3}else if(t<e.openTimeDt)i=1;else if(this.info.data.selfPlayer&&this.info.data.selfPlayer.isTargeted)i=1;else{var s=this.info.data.selfPlayer&&this.info.data.selfPlayer.rewards;i=s&&0<Object.keys(s).length?4:1}this.curStatus==i&&n==this.curOrder||(this.curStatus=i,this.curOrder=n,this.updateView())},T.prototype.updateVisible=function(e){switch(this.lb_answerDone.visible=!1,this.lb_question.visible=!1,this.lb_questionId.visible=!1,this.lb_answerCanGetReward.visible=!1,this.gp_rewardGp.visible=!1,this.gp_answers.visible=!1,this.gp_openTime.visible=!1,this.gp_curTime.visible=!1,this.curStatus){case 1:this.lb_answerDone.visible=!0,this.lb_answerDone.text="未开始",this.lb_answerCanGetReward.visible=!0,this.lb_answerResult.visible=!0,this.lb_answerResult.text="欢迎各位同学",this.gp_openTime.visible=!0;break;case 2:case 3:this.gp_answers.visible=!0,this.lb_question.visible=!0,this.lb_questionId.visible=!0,this.gp_curTime.visible=!0;break;case 4:this.lb_answerDone.visible=!0,this.lb_answerDone.text="交卷完成",this.lb_answerResult.visible=!0,this.lb_answerResult.text="领取奖励吧",this.gp_rewardGp.visible=!0}},T.prototype.updateQuestion=function(e){var t=C.Config.zoneQuoraConfig()[e];t?this.lb_question.textFlow=(new egret.HtmlTextParser).parse(t.question):this.lb_question.text="找不到题目配置"},T.prototype.updateAnswers=function(e,t,i){void 0===i&&(i=-1);var n=C.Config.zoneQuoraConfig()[e];if(n){for(var o=JSON.parse(n.answer),a=0;a<4;a++){var r=o[a],s=!!r;t?this.updateAnswer(a,a+1==n.correct,r,s,i==a+1):this.updateAnswer(a,void 0,r,s,i==a+1)}t?this.lastChoseId==n.correct?this.lb_answerResult.text="非常棒，回答正确！":this.lb_answerResult.text="遗憾，回答错误！":this.lb_answerResult.text="请回答下列题目"}else for(a=0;a<4;a++)this.updateAnswer(a,void 0,"",!1)},T.prototype.updateAnswer=function(e,t,i,n,o){void 0===i&&(i=""),void 0===n&&(n=!0),void 0===o&&(o=!1);var a=this.answerGp[e];if(a){var r=a.$children[1],s=a.$children[2],c=a.$children[3];s&&(s.text=this.num2letter[e]+". "+i),c.visible=o,0==n?(a.parent.removeChild(a),a.visible=!1):null==t?(a.visible=!0,r.visible=!1):(a.visible=!0,r.visible=!0,r.source=t?"jsjhd_img_gou_png":"jsjhd_img_cha_png")}},T.prototype.updateRewards=function(){var e=this.info;if(e&&e.data){JSON.parse(e.content);e.data.selfPlayer.isTargeted?C.GameMVC.activityMed.updateBtn(this.btn_getReward,REWARD_STATUS.RECEIVED):C.GameMVC.activityMed.updateBtn(this.btn_getReward,REWARD_STATUS.AVAILABLE),this.gp_rewards.removeChildren(),C.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,e.data.selfPlayer.rewards)}},T.prototype.updateRank=function(){var i=this;C.GameMVC.rankPy.GetRankList({rankType:RankingType.RankingTypeNewZoneActivityQuora,refreshInterval:35},function(e){var t=e.ranks;0==t.length?(i.img_noRank.visible=!0,i.list_rank.dataProvider=new eui.ArrayCollection):(t.sort(C.GeneralConfig.simpleSort("rank")),i.img_noRank.visible=!1,i.list_rank.dataProvider=new eui.ArrayCollection(t))})},T.firstName="",T.oldGrade="",T}(C.ActivityCommonView);C.Activity186=e,__reflect(e.prototype,"game.Activity186");var o=function(t){function e(){var e=t.call(this)||this;return e.params=void 0,e.skinName="Activity186Item",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this),this.data&&(this.lb_rank.textFlow=[{text:"第",style:{textColor:16777215}},{text:""+this.data.rank,style:{textColor:6531583}},{text:"名",style:{textColor:16777215}}],this.lb_name.textFlow=[{text:this.data.playerBaseInfo.name,style:{textColor:16751149}},{text:"("+this.data.playerBaseInfo.serverId+"服)",style:{textColor:16777215}}],this.lb_key.textFlow=[{text:""+this.data.key,style:{textColor:6618944}},{text:"积分",style:{textColor:16777215}}])},e}(eui.ItemRenderer);__reflect(o.prototype,"Activity186Item")}(game||(game={})),function(p){var e=function(h){function e(){var e=h.call(this)||this;return e.itemMap={},e.skinName="ActivityAuction",e.code=EActivityType.ZoneAuction,e}return __extends(e,h),e.prototype.childrenCreated=function(){var r=this;h.prototype.childrenCreated.call(this),this.sl_items.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_record.scrollPolicyH=eui.ScrollPolicy.OFF,this.list_items.dataProvider=new eui.ArrayCollection,this.list_items.itemRenderer=d;var s=this.info;if(s){for(var e in this.config=JSON.parse(s.content),this.config[1]){var t=this.config[1][e],i=t[0],n=t[2],o=t[3][0],a=t[3][2],c=t[4];this.itemMap[i]={id:i,rewards:n,beginPrice:o,onePrice:a,curPrice:o,status:0,endDt:0,bidTime:t[1],playerInfo:{},init:!1,groupId:c,rare:0<t[4]?1:0,priority:t[5],updateFunc:function(){r.updateView()},timeConfig:this.config[0][0]}}var l=this.config[0][0][0];this.bm_time.text=l[0]+"点"+(l[1]||"00")+"分",this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0==Object.keys(s.data.record.buyRecords).length&&(s.data.record.buyRecords=[]);var e=s.data.record.buyRecords;e.sort(function(e,t){return t.timestamp-e.timestamp});p.Config.itemConfig();for(var t=0;t<e.length;t++){var i=e[t],n=void 0;for(var o in r.itemMap){var a=r.itemMap[o];a.id==i.itemId&&(n=a.rewards[0])}e[t].rewards=[{type:n[0],code:n[1],num:n[2]}],e[t].name=e[t].username}PopUpManager.addPopUp({obj:new p.RecordPanel({records:e,title:"购买记录"})})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new p.HelpDialog({moduleId:MODULE.Activity+EActivityType.ZoneAuction})})},this)}},e.prototype.updateView=function(){var e=this,t=this.info;if(t&&t.data){var i=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N).playerInfoVO.playerId,n=t.content,o=t.data.items;for(var a in this.itemMap){(r=this.itemMap[a]).init=!1}if(o)for(var a in o){var r=o[a];this.itemMap[r.confId]&&(this.itemMap[r.confId].curPrice=r.diamonds,this.itemMap[r.confId].status=r.status,0==r.accountDt?this.itemMap[r.confId].endDt=0:this.itemMap[r.confId].endDt=r.accountDt,this.itemMap[r.confId].playerInfo=r.buyerInfo,0==Object.keys(r.players).length&&(r.players=[]),this.itemMap[r.confId].bought=0<=r.players.indexOf(i)&&r.status==AuctionItemStatus.Bidding,this.itemMap[r.confId].init=!0,this.itemMap[r.confId].rare&&0<=r.players.indexOf(i)&&!0)}var s=[];for(var a in this.itemMap)this.itemMap[a].init&&s.push(this.itemMap[a]);s.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.bought!=t.bought?t.bought-e.bought:e.rare!=t.rare?t.rare-e.rare:e.priority!=t.priority?e.priority-t.priority:e.id-t.id}),this.list_items.dataProvider.replaceAll(s);var c=Utils.TimerManager.checkIsOpen_FormatA(n[0][0]);if(this.timer&&egret.clearInterval(this.timer),c.isOpen){var l=c.endTimeDt-Utils.TimerManager.getServerTime(!1);this.gp_open.visible=!0,this.gp_close.visible=!1,this.timer=egret.setInterval(function(){0<--l?e.bm_leftLime.text=""+Utils.TimerManager.getFormatBySecond1(l):e.updateView()},this,1e3)}else this.gp_open.visible=!1,this.gp_close.visible=!0;this.updateRecord()}},e.prototype.updateRecord=function(){var e=this.info;if(e&&e.data){0==Object.keys(e.data.record.bidRecords).length?(e.data.record.bidRecords=[],this.img_nobody.visible=!0):this.img_nobody.visible=!1;var t=e.data.record.bidRecords;t.sort(function(e,t){return t.timestamp-e.timestamp}),this.gp_record.removeChildren();for(var i=p.Config.itemConfig(),n=0;n<t.length;n++){var o=t[n],a=void 0;for(var r in this.itemMap){var s=this.itemMap[r];s.id==o.itemId&&(a=s.rewards[0])}if(i[a[1]]){var c=new eui.Label;c.textFlow=[{text:o.username+" 竞拍了 ",style:{textColor:16777215}},{text:""+i[a[1]].name,style:{textColor:COLOR_2_FONT_COLOR[i[a[1]].color]}},{text:"*"+a[2],style:{textColor:16777215}}],c.size=20,this.gp_record.addChild(c)}}}},e}(p.ActivityCommonPanel);p.ActivityAuction=e,__reflect(e.prototype,"game.ActivityAuction");var d=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityAuctionItem",e}return __extends(e,t),e.prototype.Bid=function(e,t){var i=this;Utils.Socket.send("activity","DoCommonOperation",{code:EActivityType.ZoneAuction,id:e,num:t}).then(function(e){p.AppFacade.getInstance().retrieveProxy(p.ActivityPy.N).updateData_View_Reward(EActivityType.ZoneAuction,e),i.data.updateFunc&&i.data.updateFunc()})},e.prototype.childrenCreated=function(){var a=this;this.baseitem=customui.BaseItemFactory.create(),this.baseitem.horizontalCenter=this.baseitem.verticalCenter=0,this.gp_baseitem.addChild(this.baseitem),this.btn_bid.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N);if(a.data.playerInfo.username!=e.playerInfoVO.name)if(Utils.TimerManager.checkIsOpen_FormatA(a.data.timeConfig).isOpen){var t=[EEntityType.EEntityTypeMoney,EPropertyType.EPropertyTypeDiamond,a.data.curPrice],i=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N),n=a.data.rewards[0][1],o=i.getInfoByCode(n);if(i.checkEnough([t],!0)){i.getInfoByCode(EPropertyType.EPropertyTypeDiamond);p.GameMgr.getInstance().showCommonTipsWin({costTips:"竞拍"+o.info.name+"\n\n（竞拍失败时，钻石会直接返还）",cost:[t],cb:!1,btnLabel:{cancel:"取消",sure:"确定"},clickCB:function(e){1===e.type&&a.Bid(a.data.id,a.data.curPrice)}})}}else Utils.MsgUtils.addMidMsg("战区竞拍于12点整开始拍卖");else Utils.MsgUtils.addMidMsg("无法重复拍卖该商品")},this),this.btn_onePrice.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=p.AppFacade.getInstance().retrieveProxy(p.ActivityPy.N).allActivityData[EActivityType.ZoneAuction].content;if(Utils.TimerManager.checkIsOpen_FormatA(e[0][0]).isOpen){var t=[EEntityType.EEntityTypeMoney,EPropertyType.EPropertyTypeDiamond,a.data.onePrice],i=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N),n=a.data.rewards[0][1],o=i.getInfoByCode(n);if(i.checkEnough([t],!0)){i.getInfoByCode(EPropertyType.EPropertyTypeDiamond);p.GameMgr.getInstance().showCommonTipsWin({costTips:"竞拍"+o.info.name+"\n\n",cost:[t],cb:!1,btnLabel:{cancel:"取消",sure:"确定"},clickCB:function(e){1===e.type&&a.Bid(a.data.id,a.data.onePrice)}})}}else Utils.MsgUtils.addMidMsg("战区竞拍于12点整开始拍卖")},this)},e.prototype.dataChanged=function(){var t=this;if(this.curId!=this.data.id){this.curId=this.data.id;var e=this.data.rewards[0];p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N);this.baseitem.updateData({type:e[0],code:e[1],num:e[2]}),this.price_onePrice.updateItem({cost:[1,1,this.data.onePrice],style:CommonIconStyle.RIGHT})}switch(this.data.rare?this.img_bg.source="zqjp_img_dikuang_png":this.img_bg.source="common_img_kt_4_png",this.img_bought.visible=this.data.bought,this.gp_bidding.visible=1==this.data.status,this.gp_bidDone.visible=2==this.data.status,this.gp_bidding.visible=!1,this.gp_bidDone.visible=!1,this.gp_time.visible=!1,this.img_nobody.visible=!1,this.data.status){case AuctionItemStatus.Bidding:this.price_bid.updateItem({cost:[1,1,this.data.curPrice],style:CommonIconStyle.RIGHT}),this.gp_bidding.visible=!0;var i=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N);this.data.playerInfo.playerId==i.playerInfoVO.playerId?(this.btn_bid.label="",this.btn_bid.skinName="skins.ButtonSkinSure",this.btn_bid.scaleX=this.btn_bid.scaleY=.8,this.btn_bid.label="已拍"):(this.btn_bid.label="",this.btn_bid.skinName="skins.ButtonSkinYellow",this.btn_bid.scaleX=this.btn_bid.scaleY=.6,this.btn_bid.label="竞拍"),this.data.endDt?this.gp_time.visible=!0:this.img_nobody.visible=!0;break;case AuctionItemStatus.Bid:this.gp_bidDone.visible=!0,this.lb_name.text="("+this.data.playerInfo.serverId+"服)"+this.data.playerInfo.username}this.timer&&egret.clearInterval(this.timer);var n=Utils.TimerManager.getServerTime();this.data.endDt>n?this.bm_time.text=Utils.TimerManager.getFormatBySecond1(this.data.endDt-n):this.bm_time.text="已结束",this.timer=egret.setInterval(function(){var e=Utils.TimerManager.getServerTime();t.data.endDt>e?t.bm_time.text=Utils.TimerManager.getFormatBySecond1(t.data.endDt-e):t.bm_time.text="已结束"},this,1e3)},e}(eui.ItemRenderer);__reflect(d.prototype,"ActivityAuctionItem");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityAuctionEntry",e.code=EActivityType.ZoneAuction,e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btnFunc&&e.btnFunc()},this),this.btnFunc=function(){p.MainJumpConfig.jumpTo("CITY"),p.MainJumpConfig.jumpTo(MODULE.Activity+EActivityType.ZoneAuction1)}},e.prototype.updateView=function(){var e=this,t=this.info;if(t&&t.data){this.timer&&egret.clearInterval(this.timer);var i=p.ActivityConfig.getActivityEndDt(EActivityType.ZoneAuction)-Utils.TimerManager.getServerTime();i?this.timer=egret.setInterval(function(){0<--i?e.bm_time.text=Utils.TimerManager.getFormatBySecond1(i):e.updateView()},this,1e3):(this.bm_time.text="",egret.setTimeout(function(){e.updateView()},this,5e3))}},e}(p.ActivityCommonView);p.ActivityAuctionEntry=t,__reflect(t.prototype,"game.ActivityAuctionEntry")}(game||(game={})),function(a){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.img_arrow=new eui.Image,e}return __extends(e,t),e.prototype.initList=function(){var e=this;this.list_itemList.itemRenderer=n;var t=new eui.TileLayout;t.requestedColumnCount=2,t.horizontalAlign=egret.HorizontalAlign.CENTER,t.horizontalGap=40,t.verticalGap=40,t.paddingTop=0,t.paddingLeft=35,t.paddingRight=0,t.columnAlign=eui.ColumnAlign.LEFT,this.list_itemList.layout=t;var i=new eui.Image;i.source="newactivity_img_ditu_png",i.top=this.gp_title.height,this.addChildAt(i,0),this.img_arrow.source="sycx_img_jiantou_png",this.img_arrow.rotation=90,this.img_arrow.bottom=0,this.img_arrow.horizontalCenter=0,this.img_arrow.scaleX=this.img_arrow.scaleY=1.2,this.img_arrow.visible=!1,egret.Tween.get(this.img_arrow,{loop:!0}).to({bottom:10},500).to({bottom:0},500),this.addChild(this.img_arrow),this.sl_root.addEventListener(egret.Event.CHANGE,function(){e.img_arrow.visible=e.sl_root.viewport.scrollV<e.list_itemList.contentHeight-e.sl_root.height},this),this.sl_root.once(egret.Event.ENTER_FRAME,function(){e.img_arrow.visible=e.sl_root.viewport.scrollV<e.list_itemList.contentHeight-e.sl_root.height},this),this.sl_root.top=280,this.sl_root.height=720,this.bm_time.y-=25},e.prototype.updateView=function(e){if(e&&e.activityType){this.code=e.activityType,this.updateTitle();var t=this.getDataList();this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(t):this.list_itemList.dataProvider=new eui.ArrayCollection(t)}},e.prototype.getDataList=function(){var d=this;if(this.code){var u=a.ActivityConfig.Config[this.code];if(u){var e=this.info;if(e&&e.data){var g=e.data.targeted,f=(e.data.day,[]),t=JSON.parse(e.content),i=e.data.curCycle;if(i&&u.cycle)for(var n in t[1]){var o=t[1][n];if(o[0]==i){t=o[1];break}}var _=a.AppFacade.getInstance().retrieveProxy(a.RechargePy.N),m=_.goodList;return t.forEach(function(e){var t,i=e[0],n=e[1],o=e[2],a=e[3];for(var r in m){var s=m[r];if(i==s.id){t=s;break}}var c="";c=t?u.formatString.format([t.price]):"找不到商品信息";var l=0;g.forEach(function(e){e.id==i&&(l=e.num)});var h=REWARD_STATUS.CANBUY;o<=l&&(h=REWARD_STATUS.HASBUY);var p={id:i,title:c,tips:l+"/"+o+"次",status:h,rewards:n,GoodInfo:t,icon:a,btnFunc:function(){t?l<o?_.purchase(t,2,"",JSON.stringify({activityType:d.code}),{activityType:d.code}):Utils.MsgUtils.addMidMsg("购买次数已达上限"):Utils.MsgUtils.addMidMsg("找不到购买信息")}};f.push(p)}),f.sort(function(e,t){return e.status!=t.status?e.status-t.status:t.id-e.id}),f}}}},e}(a.ActivityCommonListView);a.ActivityAwakenGiftBag=e,__reflect(e.prototype,"game.ActivityAwakenGiftBag");var n=function(o){function e(){var e=o.call(this)||this;return e.bm_tip=new eui.BitmapLabel,e.skinName="RechargeView_RechargeItem",e}return __extends(e,o),e.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.gp_double.visible=!1,this.scaleX=this.scaleY=1.1,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data&&e.data.btnFunc&&e.data.btnFunc(e.data)},this);var t=new eui.Image;t.source="jxzl_img_cishudi_png",t.left=t.bottom=20,t.scaleX=t.scaleY=.9,this.addChild(t),this.bm_tip.rotation=30,this.bm_tip.left=18,this.bm_tip.bottom=18,this.bm_tip.scaleX=this.bm_tip.scaleY=.95,this.bm_tip.font="white_num_fnt",this.addChild(this.bm_tip)},e.prototype.dataChanged=function(){o.prototype.dataChanged.call(this),this.bm_tip.text=this.data.tips;var e=this.data.rewards;for(var t in e){var i=e[t],n=a.GeneralConfig.getEntityConfigByCode(i[0],i[1]);n&&(i[0]==EEntityType.EEntityTypeMoney&&i[1]==EPropertyType.EPropertyTypeDiamond?this.blb_extra.text=i[2]:(this.img_canGet.source=n.icon+"_png",this.blb_obtain.text=i[2]))}if(this.data.GoodInfo)switch(this.blb_price.text=this.data.GoodInfo.price+"元",this.data.GoodInfo.price){case 648:this.img_bg.source="chongzhi_img_wupinkuan01_png";break;case 328:this.img_bg.source="chongzhi_img_wupinkuan02_png";break;default:this.img_bg.source="chongzhi_img_wupinkuan03_png"}this.data.status==REWARD_STATUS.HASBUY?UIActionManager.setGrey(this,!0):UIActionManager.setGrey(this,!1),this.img_icon.source=this.data.icon+"_png"},e}(eui.ItemRenderer);__reflect(n.prototype,"ActivityAwakenGiftBagItem")}(game||(game={})),function(E){var h=function(i){function C(){var e=i.call(this)||this;return e.pageIndex=0,e.pageNumber=0,e.isFirst=!0,e.curlevel=0,e.activityPy=E.AppFacade.getInstance().retrieveProxy(E.ActivityPy.N),e.taskPy=E.AppFacade.getInstance().retrieveProxy(E.TaskPy.N),e.backPackProxy=E.AppFacade.getInstance().retrieveProxy(E.BackpackPy.N),e.allTasksArray=[],e.pageArray=[],e.scrollerArray=[],e.finishNum=0,e.remainNum=0,e.sectionId=1,e.chapterId=1,e.noRewardList=[],e.maxlevl=0,e.maxRewardCode=0,e.moveGuild=70,e.skinName="BraveBookViewSkin",e.taskPy.getBraveBookTask(),e}return __extends(C,i),C.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.braveInfo=this.activityPy.allActivityData[EActivityType.BraveBook],this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,this.braveBookBuy,this),this.btn_treasure.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.braveInfo.data;e&&!e.isBuy?Utils.MsgUtils.addMidMsg("请先购买勇士令状"):(t.gp_achivements.visible=!1,t.gp_tasks.visible=!1,E.AppFacade.getInstance().showSubView(E.BraveBookMediator.N,E.BraveBookMediator.SV.BAOXIANG,{closeCB:function(){t.gp_achivements.visible=!0,t.gp_tasks.visible=!0}}))},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){E.MainJumpConfig.jumpTo()},this),this.btn_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.pageScroller.scrollToNext(function(){t.pageBtnStatus()})},this),this.cu_model.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){E.AppFacade.getInstance().showSubView(E.HeroMediator.N,E.HeroMediator.SV.HERO_DETAIL,{code:this.maxRewardCode})},this),this.btn_last.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.pageScroller.scrollToLast(function(){t.pageBtnStatus()})},this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.taskPy.getBraveLevelReward({levels:t.noRewardList,cb:function(){t.updateView()}})},this),this.gp_achivements.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){t.isFromCurTouchBegin&&(Math.abs(t.startPosX-e.stageX)>t.moveGuild&&(t.isFromCurTouchBegin=!1,0<e.stageX-t.startPosX?t.sl_reward.scrollToLast():t.taskPy.isBraveBookMax||t.sl_reward.scrollToNext(),t.startPosX=void 0))},this),this.gp_achivements.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){t.isFromCurTouchBegin=!0,t.startPosX=e.stageX},this),this.gp_achivements.addEventListener(egret.TouchEvent.TOUCH_END,function(e){t.isFromCurTouchBegin=!1,t.startPosX=void 0},this),DragonBoneTools.create("common_zhihuanhou",function(e){e.x=this.gp_rewarddi.width/2,e.y=this.gp_rewarddi.height/2,e.scaleX=e.scaleY=.6,e.animation.play(),this.gp_rewarddi.addChild(e)},this);var e=new eui.HorizontalLayout;e.horizontalAlign=egret.HorizontalAlign.RIGHT,this.list_rewards.layout=e,this.cuIndex=0,this.taskPy.nextBraveBook=1,this.progressBar.minimum=0,this.initPageScroller(),this.initTaskList(),this.initRewardsList(),this.upateLeftTime()},C.prototype.braveBookBuy=function(){var e=this.braveInfo.data,t=E.AppFacade.getInstance().retrieveProxy(E.RechargePy.N),i=t.goodList,n=e&&!e.isBuy?this.braveInfo.content[0]:this.braveInfo.content[3];if(e&&!e.isBuy){var o=void 0;for(var a in i){var r=i[a];if(r.id==n[0]){o=r;break}}t.purchase(o)}},C.prototype.initTaskList=function(){this.list_tasks.itemRenderer=n},C.prototype.initRewardsList=function(){this.list_rewards.itemRenderer=o,UIActionManager.hideScrollerBar(this.sl_reward)},C.prototype.updateReward=function(){var e=E.Config.braveBookLevelConfigs(),t=[],i=[];this.noRewardList=[];for(var n in e){var o=e[n];""!=o.rewards&&(1,t.push({level:n,rewards:o.rewards,isSure:this.curlevel>=Number(n)}),this.curlevel>=Number(n)&&i.push(Number(n)))}for(var a in i){var r=i[a];this.taskPy.braveBookTask.levelTargeted&&-1!=this.taskPy.braveBookTask.levelTargeted.indexOf(r)||this.noRewardList.push(r)}var s=this.list_rewards.dataProvider;s?s.replaceAll(t):this.list_rewards.dataProvider=new eui.ArrayCollection(t);var c=this.btn_get.iconDisplay;c.scale9Grid=new egret.Rectangle(5,5,35,35),c.width=this.btn_get.width;var l=this.btn_get.labelDisplay,h=this.braveInfo.data;l.font="btn_fnt_yellow2_fnt",l.text=this.noRewardList.length+"件未领取奖励",this.bp_get.visible=!(h&&!h.isBuy)&&0<this.noRewardList.length,this.JumpIndexReward()},C.prototype.JumpIndexReward=function(){var e=this;0<this.taskPy.nextBraveBook&&(this.cuIndex<=0&&this.sl_reward.curPage++,this.sl_reward.scrollerToPage(0<this.cuIndex?this.sl_reward.curPage+1:0,!0,function(){e.once(egret.Event.ENTER_FRAME,function(){0<e.taskPy.nextBraveBook&&(e.cuIndex=1,e.JumpIndexReward())},e)})),this.taskPy.nextBraveBook=1},C.prototype.initPageScroller=function(){this.list_chapters.itemRenderer=e,UIActionManager.hideScrollerBar(this.pageScroller)},C.prototype.taskinfoCallback=function(){var e=this.taskPy.braveBookTask;this.curlevel=e.level,this.blb_level.text=e.level.toString(),this.progressBar.value=e.exp;var t=E.Config.braveBookLevelConfigs()[e.level];this.progressBar.maximum=t.exp;var i=E.Config.braveBookLevelConfigs(),n=0;for(var o in i)n++;this.taskPy.braveBookTask.levelTargeted.sort(function(e,t){return t-e});for(var a=this.taskPy.braveBookTask.levelTargeted[0]==n?n:(this.taskPy.braveBookTask.levelTargeted[0]?this.taskPy.braveBookTask.levelTargeted[0]:0)+1;a<=n;a++){var r=i[a];if(0<r.isShow){this.maxlevl=i[n].level,this.lb_tips.text="勇士等级达到"+r.level+"级带我回家哦！";var s=JSON.parse(r.rewards)[0];return this.maxRewardCode=s[1],void(s[0]==EEntityType.EEntityTypeHero?(this.cu_model.visible=!0,this.baseitem.visible=!1,this.cu_model.update({isStatic:!0,code:s[1]})):(this.cu_model.visible=!1,this.baseitem.visible=!0,this.baseitem.updateData({code:s[1],num:s[2]}),this.baseitem.img_bg.visible=!1,this.baseitem.img_frame.visible=!1,this.baseitem.gp_star_item.visible=!1,this.baseitem.blb_num.visible=!1,this.baseitem.blb_level.visible=!1))}}},C.prototype.updateView=function(e){this.params=e,this.effect=void 0,!C.isInit&&this.curlevel!=this.taskPy.braveBookTask.level&&this.curlevel<this.taskPy.braveBookTask.level&&DragonBoneTools.playOnce({effectName:"common_ysdjts",parent:this.gp_root,x:this.gp_root.width/2||0,y:this.gp_root.height/2||0,keep:!1,loop:!1,doneCB:function(){}}),this.taskinfoCallback(),this.updateReward(),this.braveInfo=this.activityPy.allActivityData[EActivityType.BraveBook];var t,i=this.braveInfo.data,n=this.braveInfo.content[1];UIActionManager.setGrey(this.btn_buy,!(i&&!i.isBuy)),this.btn_buy.touchEnabled=i&&!i.isBuy,this.img_notice_2.visible=this.backPackProxy.checkEnough([n[0][1][0]],!1),e&&e.sectionCode&&e.chapterCode&&(t={sectionCode:e&&e.sectionCode,chapterCode:e&&e.chapterCode}),this.updateTaskData(t),this.pageBtnStatus()},C.prototype.updateTaskData=function(e){var t=this;this.braveInfo;this.allTasksArray=[],this.pageArray=[],this.scrollerArray=[];var i=E.Config.braveBook(),n=[],o=[],a=1,r=!1;this.finishNum=0;var s=this.remainNum=0,c=this.taskPy.braveBookTask.starTargeted;for(var l in i){var h=i[l],p=JSON.parse(h.target)[0],d={code:h.code,current:0,type:h.type,subType:h.subType,sectionCode:h.sectionCode,chapterCode:h.chapterCode,total:p,desc:h.desc,finish:!1,canGet:!1,rewards:h.rewards,isTarget:!1,jumpModule:h.jumpModule,curSection:0,unlock:!1},u=this.taskPy.getBraveTask(TaskType.BraveBook,h.code),g=!1;if(g=h.subType==TaskSubType.ArenaChallengeRank?u&&0<u.key&&u.key<=p||!1:u&&u.key>=p||!1,d.canGet=g,d.isTarget=u&&u.isTarget||!1,d.finish=g&&1==d.isTarget,d.current=u&&u.key||0,u&&(d.unlock=!0,s+=1,C.isInit&&(this.sectionId=Math.max(h.sectionCode,this.sectionId),this.chapterId=Math.max(h.chapterCode,this.chapterId))),g&&!d.isTarget&&(this.remainNum+=1),d.finish&&(this.finishNum+=1),o.push(d),a%3==0){r&&(this.sectionId=Math.max(h.sectionCode,this.sectionId),this.chapterId=Math.max(h.chapterCode,this.chapterId),r=!1);var f=this.params&&this.params.unresetChapter;!C.isInit&&o[0].finish&&o[1].finish&&o[2].finish&&!f&&(r=!0),this.allTasksArray.push(o),n.push(o),o=[]}if(a%27==0){var _=!1;if(0<c.length)for(var m=0,y=c;m<y.length;m++){if(y[m]==h.chapterCode){_=!0;break}}this.pageArray.push({array:n,finishNum:this.finishNum,remainNum:this.remainNum,unLockNum:s,isStarGet:_}),this.finishNum=0,s=this.remainNum=0,n=[],++this.pageNumber}++a}C.isInit&&(C.isInit=!1),e&&(e.sectionCode&&e.chapterCode||!e.unresetChapter)&&(this.sectionId=e.sectionCode||C.sectionData.sectionId,this.chapterId=e.chapterCode||C.sectionData.chapterId),this.scrollerArray=this.allTasksArray[this.sectionId-1],C.sectionData={sectionId:this.sectionId,chapterId:this.chapterId};var v=this.list_tasks.dataProvider;v?v.replaceAll(this.scrollerArray):this.list_tasks.dataProvider=new eui.ArrayCollection(this.scrollerArray);var T=this.list_chapters.dataProvider;T?T.replaceAll(this.pageArray):this.list_chapters.dataProvider=new eui.ArrayCollection(this.pageArray),this.chapterId-1!=this.pageScroller.curPage&&egret.setTimeout(function(){t.pageScroller.scrollerToPage(t.chapterId-1,!0,function(){t.pageBtnStatus()})},this,300)},C.prototype.upateLeftTime=function(){var e=this,t=this.braveInfo.endDt-Utils.TimerManager.getServerTime();0<t&&(this.lb_time.text=""+Utils.TimerManager.getFormatBySecond2(t)),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=--t&&(e.lb_time.text=""+Utils.TimerManager.getFormatBySecond2(t))},this,1e3)},C.prototype.pageBtnStatus=function(){var r=this;this.btn_last.visible=0!=this.pageScroller.curPage;var e=0<this.pageArray.length&&27<=this.pageArray[this.pageScroller.curPage].unLockNum&&this.pageArray[this.pageScroller.curPage+1]&&0<this.pageArray[this.pageScroller.curPage+1].unLockNum,t=this.pageScroller.curPage==this.pageNumber-1;this.btn_next.visible=!(t||!e);var i=function(e,t){var i=r.pageArray.length-1;if(t<0||i<e)return!1;for(var n=!1,o=e;e<=o&&o<=t;){var a=r.pageArray[o];n=0<a.remainNum||27<=a.finishNum&&!a.isStarGet||n,++o}return n};this.img_notice_0.visible=0<this.pageScroller.curPage&&0<this.pageArray[this.pageScroller.curPage-1].remainNum&&this.btn_last.visible||i(0,this.pageScroller.curPage-1),this.img_notice_1.visible=this.pageScroller.curPage<this.pageArray.length-1&&0<this.pageArray[this.pageScroller.curPage+1].remainNum&&this.btn_next.visible||i(this.pageScroller.curPage+1,this.pageArray.length-1)},C.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer),NoticeManager.updateNotice(NT.BRAVABOOK,void 0,!0),this.params&&this.params.closeCB&&this.params.closeCB(),C.isInit=!0},C.isInit=!0,C}(BaseFull);E.ActivityBraveBookView=h,__reflect(h.prototype,"game.ActivityBraveBookView");var e=function(t){function e(){var e=t.call(this)||this;return e.starResult=!1,e.skinName="BraveBookPageSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),this.btn_box.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){E.AppFacade.getInstance().retrieveProxy(E.TaskPy.N);if(27<=i.data.finishNum&&!i.starResult){var e=E.Config.braveBookstarRewardConfigs()[i.data.array[0][0].chapterCode];E.AppFacade.getInstance().retrieveProxy(E.TaskPy.N).getBraveBookStarReward({code:e.code,cb:function(){i.btn_box.icon="_yslz_m_json.yslz_img_baoxiangdakai",i.btn_box.touchEnabled=!1}})}else{var t=E.Config.braveBookstarRewardConfigs()[i.data.array[0][0].chapterCode];E.AppFacade.getInstance().showSubView(E.CommonMediator.N,E.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(t.rewards),type:E.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})}},this)},e.prototype.dataChanged=function(){this.lb_pro.text=this.data.finishNum+"/27";E.AppFacade.getInstance().retrieveProxy(E.TaskPy.N);this.img_notice.visible=!1,this.gp_effect.removeChildren(),DragonBoneTools.create("common_buxiudebaozang_xbx",function(e){e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2,e.animation.play(),this.gp_effect.addChild(e)},this),egret.Tween.removeTweens(this.btn_box),this.btn_box.touchEnabled=!0,this.btn_box.icon="_yslz_m_json.yslz_img_baoxiang",27<=this.data.finishNum&&!this.data.isStarGet?(this.img_notice.visible=!0,UIActionManager.douDong(this.btn_box)):27<=this.data.finishNum&&this.data.isStarGet&&(this.btn_box.icon="_yslz_m_json.yslz_img_baoxiangdakai",this.btn_box.touchEnabled=!1);for(var e=0;e<this.data.array.length;++e){var t=this.data.array[e];this.data.array;this["chapter_"+e].updateData(t)}},e}(eui.ItemRenderer);E.BraveBook_page=e,__reflect(e.prototype,"game.BraveBook_page");var t=function(t){function e(){var e=t.call(this)||this;return e.taskPy=E.AppFacade.getInstance().retrieveProxy(E.TaskPy.N),e.unlock=!1,e.skinName="ChapterItemViewSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.img_notice.touchEnabled=!1,this.btn_icon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.switchChapter()},this)},e.prototype.switchChapter=function(){this.unlock?E.AppFacade.getInstance().retrieveMediator(E.BraveBookMediator.N).updateView(E.BraveBookMediator.SV.MAIN,{sectionCode:this.data[0].sectionCode,chapterCode:this.data[0].chapterCode}):Utils.MsgUtils.addMidMsg("未解锁！")},e.prototype.updateData=function(e){this.data=e;var t=h.sectionData,i=!1,n=0;this.unlock=!1;for(var o=0;o<3;++o){var a=this.data[o];a.canGet&&!a.isTarget&&(i=!0);var r=E.AppFacade.getInstance().retrieveProxy(E.PlayerPy.N),s=JSON.parse(E.Config.constConfig().DefaultAvatar.constValue)[0],c=r.playerInfoVO.avatar||s;this.img_avatar.source=ResourceUtils.png(c),this.gp_top.visible=t.sectionId==a.sectionCode&&t.chapterId==a.chapterCode,this.touchEnabled=!this.gp_top.visible,this.touchChildren=!this.gp_top.visible,this.img_model.visible=!1,this.unlock=this.unlock||a.unlock,this["img_"+o].source="yslz_img_xingxing2_png",a.finish&&++n}this.img_notice.visible=!this.gp_top.visible&&i;for(var l=0;l<n;++l){this["img_"+l].source="_border_m_json.common_icon_xingji"}this.img_suo.visible=!this.unlock,this.btn_icon.touchEnabled=this.unlock,this.gp_top.visible&&(this.gp_move.y=2,UIActionManager.jumping(this.gp_move))},e.prototype.onOPReset=function(){},e.prototype.onOPComeBack=function(e,t){},e.prototype.onOPClean=function(){},e.prototype.onOPCheck=function(e){},e}(eui.Component);E.ChapterItemView=t,__reflect(t.prototype,"game.ChapterItemView",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"]);var n=function(t){function e(){var e=t.call(this)||this;return e.taskPy=E.AppFacade.getInstance().retrieveProxy(E.TaskPy.N),e.skinName="BraveBookItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tapCallBack,this)},e.prototype.tapCallBack=function(){if(!this.data.isTarget)if(this.data.canGet){var e=E.AppFacade.getInstance().retrieveProxy(E.ActivityPy.N).allActivityData[EActivityType.BraveBook].data;if(e&&e.isBuy)E.AppFacade.getInstance().retrieveProxy(E.TaskPy.N).GetTaskReward(this.data.type,this.data.code,function(){},{unresetChapter:!0});else Utils.MsgUtils.addMidMsg("请先购买勇士令状！")}else if(this.data.jumpModule){if(!Utils.UnlockMgr.checkPass(this.data.jumpModule).allow)return;E.MainJumpConfig.jumpTo(this.data.jumpModule)}else Utils.MsgUtils.addMidMsg("无跳转途径")},e.prototype.dataChanged=function(){this.data.subType==TaskSubType.ArenaChallengeRank?(this.progressBar.maximum=1,this.data.canGet?this.progressBar.value=1:this.progressBar.value=0):(this.progressBar.maximum=this.data.total,this.data.canGet?this.progressBar.value=this.data.total:this.progressBar.value=this.data.current),this.lb_info.text=this.data.desc,this.data.isTarget?(this.btn_go.visible=!1,this.btn_gone.visible=!0):(this.btn_go.visible=!0,this.btn_gone.visible=!1,this.btn_go.label=this.data.canGet?"领取":"前往",this.data.canGet?UIActionManager.addEffect(this.btn_go,"common_lingquanniu",{scaleX:.9,scaleY:.9}):UIActionManager.hideEffect(this.btn_go));var e=JSON.parse(this.data.rewards)[0];this.baseItem.updateData({reward:e}),this.baseItem.touchEnabled=!1,this.validateNow()},e}(eui.ItemRenderer);E.BraveBookItem=n,__reflect(n.prototype,"game.BraveBookItem");var o=function(n){function e(){var e=n.call(this)||this;return e.index=0,e.taskPy=E.AppFacade.getInstance().retrieveProxy(E.TaskPy.N),e.skinName="BraveBookRewardItemSkin",e}return __extends(e,n),e.prototype.childrenCreated=function(){var e=this;n.prototype.childrenCreated.call(this);var t=E.Config.braveBookLevelConfigs();for(var i in t)this.index++;this.gp_item.cacheAsBitmap=!1,this.img_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.isSure?-1==e.taskPy.braveBookTask.levelTargeted.indexOf(Number(e.data.level))?e.taskPy.getBraveLevelReward({levels:[Number(e.data.level)],cb:function(){E.AppFacade.getInstance().retrieveMediator(E.BraveBookMediator.N).updateView(E.BraveBookMediator.SV.MAIN)}}):Utils.MsgUtils.addMidMsg("已领取该奖励"):Utils.MsgUtils.addMidMsg("未达到解锁条件")},this)},e.prototype.dataChanged=function(){this.taskPy.isBraveBookMax=this.index==this.data.level,this.img_btn.touchEnabled=this.gp_item.visible=!0;var e=JSON.parse(this.data.rewards),t=new eui.TileLayout;t.requestedColumnCount=Math.ceil(e.length/2),e.length<=2?t.verticalAlign=egret.VerticalAlign.BOTTOM:t.verticalAlign=egret.VerticalAlign.TOP,this.gp_item.layout=t,this.gp_item.removeChildren();for(var i=0,n=e;i<n.length;i++){var o=n[i],a=customui.BaseItemFactory.create(21);a.updateData({type:o[0],code:o[1],num:o[2]}),a.scaleX=.65,a.scaleY=.65,this.gp_item.addChild(a)}2<e.length?(this.img_btn.label=this.data.level+"级奖励",this.img_btn.icon="_yslz_m_json.yslz_img_sztd1"):(this.img_btn.icon="_yslz_m_json.yslz_img_sztd2",this.img_btn.label=this.data.level),this.img_btn.iconDisplay.width=this.img_btn.width=this.width=this.gp_item.width+10,this.img_get.visible=this.data.isSure,this.data.isSure&&(this.img_get.source=-1==this.taskPy.braveBookTask.levelTargeted.indexOf(Number(this.data.level))?"_yslz_m_json.yslz_txt_dacheng":"_yslz_m_json.yslz_txt_yiling"),this.taskPy.nextBraveBook=this.index==this.data.level?0:this.taskPy.nextBraveBook*(-1==this.taskPy.braveBookTask.levelTargeted.indexOf(Number(this.data.level))?0:1)},e}(eui.ItemRenderer);__reflect(o.prototype,"RewardItem")}(game||(game={})),function(b){var l=function(t){function E(){var e=t.call(this)||this;return e.curlevel=0,e.activityPy=b.AppFacade.getInstance().retrieveProxy(b.ActivityPy.N),e.taskPy=b.AppFacade.getInstance().retrieveProxy(b.TaskPy.N),e.backPackProxy=b.AppFacade.getInstance().retrieveProxy(b.BackpackPy.N),e.taskInfoArr=[],e.finishNum=0,e.remainNum=0,e.sectionId=1,e.chapterId=1,e.noRewardList=[],e.maxlevl=0,e.LevelRewards=[],e.maxChapterNum=0,e.tips_Tex={1:"激活勇士令状可获取大量高级道具、英雄奖励！！",2:"完成本章所有令状任务可解锁下一章哦！"},Utils.AssetsMgr.destroyGroup("group_brave_book"),e.skinName="BraveBookViewNewSkin",e}return __extends(E,t),E.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer),NoticeManager.updateNotice(NT.NEWBRAVABOOK,void 0,!0),this.params&&this.params.closeCB&&this.params.closeCB(),b.ActivityBraveBookView.isInit=!0,Utils.AssetsMgr.destroyGroup("group_brave_book")},E.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),DragonBoneTools.create("common_zhihuanhou",function(e){e.x=this.gp_rewarddi.width/2,e.y=this.gp_rewarddi.height/2,e.scaleX=e.scaleY=.6,e.animation.play(),this.gp_rewarddi.addChild(e)},this);var e=this.taskPy.NewBraveBooklevelParams;e&&!e.isShow&&(e.level!=e.preLevel&&Utils.MsgUtils.NewBraveBookShenjiEffect(e.preLevel,e.level),this.taskPy.NewBraveBooklevelParams=void 0),this.progressBar.labelDisplay.visible=!1,this.progressBar.minimum=0,this.progressBar.maximum=E.MAXTASKNUM,this.list_ch_items.itemRenderer=b.BravebookTaskItem,this.addListenerEvents(),this.upateLeftTime()},E.prototype.addListenerEvents=function(){var r=this;this.btn_treasure.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){b.AppFacade.getInstance().showSubView(b.BraveBookMediator.N,b.BraveBookMediator.SV.BAOXIANG)},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.hide()},this),this.cu_model.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.maxRewardCode&&b.AppFacade.getInstance().showSubView(b.HeroMediator.N,b.HeroMediator.SV.HERO_DETAIL,{code:this.maxRewardCode})},this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.oneKeyGetAllRewards()},this),this.btn_rewards.$addListener(egret.TouchEvent.TOUCH_TAP,function(){b.AppFacade.getInstance().showSubView(b.BraveBookMediator.N,b.BraveBookMediator.SV.BRAVEBOOKREWARDS,{data:r.taskInfoArr,doneCB:function(){r.optimizationView(!0)}}),r.optimizationView(!1)},this),this.btn_getExp.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){b.AppFacade.getInstance().showSubView(b.BraveBookMediator.N,b.BraveBookMediator.SV.GETWAYS,{type:EExpType.EExpTypeNewBraveBook,code:EExpType.EExpTypeVip})},this),this.btn_baoxiang.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){b.AppFacade.getInstance().retrieveProxy(b.TaskPy.N);var e,t=b.Config.newBraveBookRewardConfig();for(var i in t){var n=r.taskInfoArr[0][0].chapterCode,o=t[i];if(o.chapterCode==n&&o.type==r.taskType){e=o;break}}if(e)if(r.finishNum>=E.MAXTASKNUM){b.AppFacade.getInstance().retrieveProxy(b.TaskPy.N).getNewBraveBookStarReward({code:e.code,type:r.taskType,cb:function(){r.gp_eff.removeChildren(),r.updateView({LevelEffect:!0})}})}else{var a=JSON.parse(e.rewards);b.AppFacade.getInstance().showSubView(b.CommonMediator.N,b.CommonMediator.SV.REWARD_PANEL,{rewards:a,type:b.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN,bottom_tips_offsetY:25,bottom_tips:a&&"勇士令状等级+"+a[0][2]})}else Utils.MsgUtils.addMidMsg("没有该星级奖励配置")},this),this.btn_detial.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new b.HelpDialog({moduleId:MODULE.ActivityNewBrave})})},this);for(var e=function(t){i["chapter_"+t].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=r.taskInfoArr[t-1];E.sectionData=e[0].sectionCode,r.updateChapter()},i)},i=this,t=1;t<=5;++t)e(t)},E.prototype.viewHistoryChapter=function(e){var t=this,i=e;this.taskPy.newBraveBookTaskHistory[i]&&this.latestChapter!=i?this.updateView({history:!0,condKey:i}):this.taskPy.getTaskInfo({type:this.taskType,condKey:i},function(){t.updateView({history:!0,condKey:i})})},E.prototype.taskinfoCallback=function(){this.taskPy.newBraveBookTask.level;var e=b.Config.newBraveBookLevelConfig();if(this.LevelRewards.length<=0){for(var t in e){var i=e[t];1==i.isShow&&1==i.isRare&&this.LevelRewards.push(i)}this.LevelRewards.sort(function(e,t){return 0<e.level-t.level?-1:1})}var n,o=this.taskPy.newBraveBookTask.levelTargeted;if(o.sort(function(e,t){return 0<e-t?-1:1}),0<o.length)for(var a=0;a<this.LevelRewards.length-1;++a){var r=this.LevelRewards[a],s=this.LevelRewards[a+1];if(o[0]<r.level&&o[0]>=s.level||o[0]>=r.level&&0==a){n=r;break}if(o[0]<s.level&&a==this.LevelRewards.length-2){n=s;break}}else n=this.LevelRewards[this.LevelRewards.length-1];var c=JSON.parse(n.rewards)[0][1];this.lb_reward_tip.text="勇士等级达到"+n.level+"级带我回家哦！",this.maxRewardCode!=c&&(this.maxRewardCode=c,this.cu_model.visible=!0,this.cu_model.update({isStatic:!0,code:this.maxRewardCode}))},E.prototype.optimizationView=function(e){this.gp_task.visible=e},E.prototype.updateView=function(e){var t=this.taskPy.NewBraveBooklevelParams;t&&!t.isShow&&e&&e.LevelEffect&&(t.preLevel!=t.level&&Utils.MsgUtils.NewBraveBookShenjiEffect(t.preLevel,t.level),this.taskPy.NewBraveBooklevelParams=void 0),this.params=e;var i=this.activityPy.allActivityData[EActivityType.NewBraveBook],n=i.content[3];if(n&&n==TaskType.NewNewBraveBook?this.taskType=TaskType.NewNewBraveBook:this.taskType=TaskType.NewBraveBook,0==this.maxChapterNum){var o=b.Config.newBraveBookTasksConfig(),a=0;for(var r in o)o[r].type==this.taskType&&++a%20==0&&++this.maxChapterNum}this.braveInfo=this.taskPy.allTasks[this.taskType],this.taskinfoCallback();var s=i.data,c=i.content[1],l=b.Config.newBraveBookLevelConfig(),h=this.taskPy.newBraveBookTask&&this.taskPy.newBraveBookTask.level||0,p=0;for(var d in l){var u=l[d];u.rewards&&""!=u.rewards.rewards&&h>=u.level&&(!this.taskPy.newBraveBookTask.levelTargeted||-1==this.taskPy.newBraveBookTask.levelTargeted.indexOf(u.level))&&++p}this.gp_notice_1.visible=0<p,this.blb_level_num.text=""+p,this.lb_playerLevel.text=""+h,this.img_notice_2.visible=this.backPackProxy.checkEnough([c[0][1][0]],!1),e&&e.history||this.curChapter<this.latestChapter?(this.lb_desc.text=this.tips_Tex[2],this.btn_get.label="一键领取"):(this.lb_desc.text=s&&s.isBuy?this.tips_Tex[2]:this.tips_Tex[1],this.btn_get.label=s&&s.isBuy?"一键领取":"一元激活"),this.updateTaskData(e),this.updateChapterTasks(e)},E.prototype.oneKeyGetAllRewards=function(){var e=this,t=this.activityPy.allActivityData[EActivityType.NewBraveBook],i=b.AppFacade.getInstance().retrieveProxy(b.RechargePy.N),n=i.goodList,o=t&&t.data&&!t.data.isBuy?t.content[0]:t.content[3];if(t&&t.data&&!t.data.isBuy){var a=void 0;for(var r in n){var s=n[r];if(s.id==o[0]){a=s;break}}a?i.purchase(a):Utils.MsgUtils.addMidMsg("找不到商品信息")}else this.taskPy.GetTaskAllReward(this.taskType,function(){e.gp_eff.removeChildren(),e.updateView()})},E.prototype.updateTaskData=function(e){var t;if(e&&e.history||this.curChapter<this.latestChapter){var i=e&&e.condKey||this.curChapter;t=this.taskPy.newBraveBookTaskHistory[i]}else t=this.braveInfo;this.taskInfoArr=[];var n=b.Config.newBraveBookTasksConfig(),o=[],a=1;this.finishNum=0;var r=9999,s=!(this.remainNum=0);t.sort(function(e,t){return 0<=Number(t.code)-Number(e.code)?-1:1});var c=t.slice(t.length-20,t.length);for(var l in c){var h=n[c[l].code];if(h.type==this.taskType){var p=c[l],d=JSON.parse(h.target)[0],u={code:h.code,current:p.key,type:h.type,subType:h.subType,sectionCode:h.sectionCode,chapterCode:h.chapterCode,total:d,desc:h.desc,canGet:!1,rewards:h.rewards,isTarget:!1,jumpModule:h.jumpModule,curSection:0,unlock:!1};u.isTarget=p&&p.isTarget||!1,u.current=u.isTarget?d:p&&p.key||0;var g=!1;g=h.subType==TaskSubType.ArenaChallengeRank?0<u.current&&u.current<=d||!1:u.current>=d||!1,u.canGet=g,s=s&&g,u.canGet&&!u.isTarget&&(this.remainNum+=1),u.canGet&&u.isTarget&&(this.finishNum+=1),o.push(u),a%E.TASKNUM==0&&(this.taskInfoArr.push(o),s||(r=Math.min(r,o[0].sectionCode)),s=!0,o=[]),++a}}b.ActivityBraveBookView.isInit&&(b.ActivityBraveBookView.isInit=!1),9999==r&&(r=this.taskInfoArr[E.TASKNUM][0].sectionCode),E.sectionData=r,e&&e.sectionCode&&(E.sectionData=e.sectionCode);var f,_=b.Config.newBraveBookRewardConfig();for(var l in _){var m=this.taskInfoArr[0][0].chapterCode,y=_[l];if(y.chapterCode==m&&y.type==this.taskType){f=y;break}}var v=this.taskPy.newBraveBookTask&&this.taskPy.newBraveBookTask.starTargeted;0<v.length&&-1!=v.indexOf(f.code)?this.btn_baoxiang.icon="yslz_img_hongbaozang0_png":this.finishNum>=E.MAXTASKNUM?(this.remainNum+=1,this.btn_baoxiang.icon="yslz_img_hongbaozang_png",this.addBaoxiangEffect()):this.btn_baoxiang.icon="yslz_img_hongbaozang1_png",this.lb_taskpro.textFlow=[{text:"("},{text:""+this.finishNum,style:{textColor:3407662}},{text:"/"+E.MAXTASKNUM+")"}],this.progressBar.value=this.finishNum,this.gp_notice2.visible=0<this.remainNum,this.blb_num.visible=0<this.remainNum;var T=this.activityPy.allActivityData[EActivityType.NewBraveBook];this.btn_get.touchEnabled=0<this.remainNum||T&&T.data&&!T.data.isBuy,UIActionManager.setAbsGrey(this.bp_get,!this.btn_get.touchEnabled),0<this.remainNum&&(this.blb_num.text=""+this.remainNum),this.params&&this.params.fromModule&&b.AppFacade.getInstance().updateView(b.BraveBookMediator.N,this.params.fromModule,{}),e&&e.history||this.curChapter<this.latestChapter||(this.latestChapter=this.taskInfoArr[0][0].chapterCode),this.curChapter=this.taskInfoArr[0][0].chapterCode;var C=Utils.MathUtils.formatNumToCharacter(this.curChapter);this.lb_chapter.text="第"+C+"章",this.updateChapter()},E.prototype.updateChapter=function(){for(var e in this.taskInfoArr){var t=this["chapter_"+(Number(e)+1)],i=this.taskInfoArr[e];t.updateData({info:i})}},E.prototype.addBaoxiangEffect=function(){DragonBoneTools.create("common_buxiudebaozang_1",function(e){e.x=this.gp_eff.width/2,e.y=this.gp_eff.height/2,e.animation.play(),e.scaleY=.3,e.scaleX=.3,this.gp_eff.addChild(e)},this),DragonBoneTools.create("common_buxiudebaozang_2",function(e){e.x=this.gp_eff.width/2,e.y=this.gp_eff.height-10,e.scaleY=.3,e.scaleX=.3,e.animation.play(),this.gp_eff.addChild(e)},this)},E.prototype.upateLeftTime=function(){var e=this,t=this.activityPy.allActivityData[EActivityType.NewBraveBook].endDt-Utils.TimerManager.getServerTime();0<t&&(this.lb_time.text=""+Utils.TimerManager.getFormatBySecond2(t)),this.timer&&(egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=(t-=60)&&(e.lb_time.text=""+Utils.TimerManager.getFormatBySecond2(t))},this,6e4))},E.prototype.updateChapterTasks=function(e){var t;if(e&&e.updateTaskP&&e.data)t=e.data,e.canGetNum;else if(e&&e.updateTaskP&&e.code){e.code;0==(i=e.sectionCode%5)&&(i=5),t=this.taskInfoArr[i-1]}else{var i;0==(i=E.sectionData%5)&&(i=5),t=this.taskInfoArr[i-1]}this.list_ch_items.dataProvider=new eui.ArrayCollection(t)},E.isInit=!0,E.MAXTASKNUM=20,E.CHAPTERNUM=5,E.TASKNUM=4,E}(BaseFull);b.ActivityBraveBookViewNew=l,__reflect(l.prototype,"game.ActivityBraveBookViewNew");var e=function(t){function e(){var e=t.call(this)||this;return e.canGetNum=0,e.taskPy=b.AppFacade.getInstance().retrieveProxy(b.TaskPy.N),e.unlock=!1,e.targetNum=0,e.skinName="ChapterItemNewViewSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.gp_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){b.GameMVC.activityMed.updateViewByCode(EActivityType.NewBraveBook,{updateTaskP:!0,data:e.data,canGetNum:e.canGetNum})},this)},e.prototype.updateData=function(e){var t="yslz_img_lingzhuang0_png",i="yslz_img_lingzhuang1_png",n="yslz_img_lingzhuang2_png",o="yslz_img_lingzhuang3_png";this.data=e.info,this.canGetNum=0,this.unlock=!1;for(var a=this.targetNum=0;a<4;++a){var r=this.data[a];this["img_"+a].source="yslz_img_xingxing2_png",r.canGet&&r.isTarget&&++this.targetNum,r.canGet&&!r.isTarget&&++this.canGetNum}var s=l.sectionData==this.data[0].sectionCode;(4<=this.targetNum?this.img_top.source=s?o:t:this.img_top.source=s?n:i,this.img_bg.source=s?"yslz_img_gezi2_png":"yslz_img_gezi_png",this.effect)?this.effect.visible=s:DragonBoneTools.create("common_yslzxuanzhong",function(e){e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2+50,e.visible=!1,s&&(e.visible=!0),e.animation.play(),this.effect=e,this.gp_effect.addChild(this.effect)},this);for(var c=0;c<this.targetNum;++c){this["img_"+c].source="_border_m_json.common_icon_xingji"}this.img_notice.visible=0<this.canGetNum},e.prototype.onOPReset=function(){},e.prototype.onOPComeBack=function(e,t){},e.prototype.onOPClean=function(){},e.prototype.onOPCheck=function(e){},e}(eui.Component);b.ChapterItemViewNew=e,__reflect(e.prototype,"game.ChapterItemViewNew",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(game||(game={})),function(h){var e=function(l){function e(){var e=l.call(this)||this;return e.code=EActivityType.ProfessionSuitReplacement,e.targetId=0,e.selectedUuid_0=[],e.selectedUuid_1=[],e.selectedUuid_2=[],e.selectedUuid_3=[],e.isEnough=!1,e.numEnough=!1,e.needNum=1,e.chooseItemCode_0=0,e.chooseItemCode_1=0,e.chooseItemCode_2=0,e.chooseItemCode_3=0,e.skinName="ActivityChangeEquiSkin",e}return __extends(e,l),e.prototype.childrenCreated=function(){if(l.prototype.childrenCreated.call(this),this.activateComponent(),!this.commonConfig){var e=h.Config.HeroEquipCompound();for(var t in e){var i=e[t];if(i.type==HeroEquipCompoundType.ProfessionSuitReplacement){this.commonConfig=i;break}}}this.item_0.touchEnabled=!1,this.item_1.touchEnabled=!1,this.item_2.touchEnabled=!1,this.item_3.touchEnabled=!1},e.prototype.updateView=function(e){var i=this;l.prototype.updateView.call(this,e);var t=[];if(this.targetId){var n=h.Config.HeroEquipCompound()[this.targetId];JSON.parse(n.rewards).forEach(function(e){t.push(e[1])})}this.item_0.visible=0!=this.chooseItemCode_0,this.item_1.visible=0!=this.chooseItemCode_1,this.item_2.visible=0!=this.chooseItemCode_2,this.item_3.visible=0!=this.chooseItemCode_3,this.item_0.visible&&this.item_0.updateData({code:this.chooseItemCode_0}),this.item_1.visible&&this.item_1.updateData({code:this.chooseItemCode_1}),this.item_2.visible&&this.item_2.updateData({code:this.chooseItemCode_2}),this.item_3.visible&&this.item_3.updateData({code:this.chooseItemCode_3});var o=this.needNum;this.blb_num0.visible=this.selectedUuid_0.length<o,this.blb_num0.font="RedBlackStrocke_fnt",this.blb_num0.text=this.selectedUuid_0.length+"/"+o,this.blb_num1.visible=this.selectedUuid_1.length<o,this.blb_num1.font="RedBlackStrocke_fnt",this.blb_num1.text=this.selectedUuid_1.length+"/"+o,this.blb_num2.visible=this.selectedUuid_2.length<o,this.blb_num2.font="RedBlackStrocke_fnt",this.blb_num2.text=this.selectedUuid_2.length+"/"+o,this.blb_num3.visible=this.selectedUuid_3.length<o,this.blb_num3.font="RedBlackStrocke_fnt",this.blb_num3.text=this.selectedUuid_3.length+"/"+o;for(var a=0;a<4;a++){var r=this.gp_preview.$children[a];r||(r=new p,this.gp_preview.addChild(r),Utils.ComponentUtils.registerListener(r,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new h.ActivityProfessionSuitSelect({selectedId:i.targetId,showType:HeroEquipCompoundType.ProfessionSuitReplacement}),closeCB:function(e){i.targetId=e,i.updateView()}})},this)),r.updateItem({code:t[a]})}var s=this.info.content[0];this.numEnough=!(this.info.data.num>=s),this.blb_limitTimes.text=""+(s-this.info.data.num),this.updateTime(),this.gp_costs.removeChildren();var c=JSON.parse(this.commonConfig.costs);c.length&&(c.forEach(function(e){var t=new customui.CommonIconWithNum;t.updateItem({cost:e,style:CommonIconStyle.RIGHT,needBg:!0}),i.gp_costs.addChild(t)}),this.isEnough=h.GameMVC.backpackPy.checkEnough(c))},e.prototype.updateTime=function(){this.timer||(this.remainingDt=h.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime(),this.updateRemainingTime(),this.timer=egret.setInterval(this.updateRemainingTime,this,1e3))},e.prototype.updateRemainingTime=function(){0<this.remainingDt?this.blb_time.text=""+Utils.TimerManager.getFormatBySecond1(this.remainingDt--):h.AppFacade.getInstance().hideSubView(h.ActivityMediator.N,h.ActivityMediator.SV.MAIN)},e.prototype.activateComponent=function(){var a=this;Utils.ComponentUtils.registerListener(this.gp_equi_0,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new h.CommonChosePanel({getInfos:function(){var e={},t=h.GameMVC.heroThingPy.AllEquipInfo;for(var i in t){var n=t[i];if(n.config.color==a.commonConfig.color&&""==n.heroUuid&&0!=n.config.professionSuit&&n.config.type==HeroEquipType.Weapon)for(var o=n.num;0<o--;)e[i+"#"+o]=n}return e},type:EEntityType.EEntityTypeHeroEquip,checkFull:function(e){return e.length>=a.needNum},selectUuids:a.selectedUuid_0,title:"请选择职业武器装备。",uniNum:!0,sortFunc:function(e,t){return e.info.quenchceLevel!=t.info.quenchceLevel?e.info.quenchceLevel-t.info.quenchceLevel:e.info.level2!=t.info.level2?e.info.level2-t.info.level2:e.info.level!=t.info.level?e.info.level-t.info.level:void 0}}),closeCB:function(){var e=0;0<a.selectedUuid_0.length&&(e=h.GameMVC.heroThingPy.AllEquipInfo[a.selectedUuid_0[0].split("#")[0]].config.code);a.chooseItemCode_0=e,a.updateView()}})},this),Utils.ComponentUtils.registerListener(this.gp_equi_1,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new h.CommonChosePanel({getInfos:function(){var e={},t=h.GameMVC.heroThingPy.AllEquipInfo;for(var i in t){var n=t[i];if(n.config.color==a.commonConfig.color&&""==n.heroUuid&&0!=n.config.professionSuit&&n.config.type==HeroEquipType.Armour)for(var o=n.num;0<o--;)e[i+"#"+o]=n}return e},type:EEntityType.EEntityTypeHeroEquip,checkFull:function(e){return e.length>=a.needNum},selectUuids:a.selectedUuid_1,title:"请选择职业护甲装备。",uniNum:!0,sortFunc:function(e,t){return e.info.quenchceLevel!=t.info.quenchceLevel?e.info.quenchceLevel-t.info.quenchceLevel:e.info.level2!=t.info.level2?e.info.level2-t.info.level2:e.info.level!=t.info.level?e.info.level-t.info.level:void 0}}),closeCB:function(){var e=0;0<a.selectedUuid_1.length&&(e=h.GameMVC.heroThingPy.AllEquipInfo[a.selectedUuid_1[0].split("#")[0]].config.code);a.chooseItemCode_1=e,a.updateView()}})},this),Utils.ComponentUtils.registerListener(this.gp_equi_2,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new h.CommonChosePanel({getInfos:function(){var e={},t=h.GameMVC.heroThingPy.AllEquipInfo;for(var i in t){var n=t[i];if(n.config.color==a.commonConfig.color&&""==n.heroUuid&&0!=n.config.professionSuit&&n.config.type==HeroEquipType.Ornament)for(var o=n.num;0<o--;)e[i+"#"+o]=n}return e},type:EEntityType.EEntityTypeHeroEquip,checkFull:function(e){return e.length>=a.needNum},selectUuids:a.selectedUuid_2,title:"请选择职业头盔装备。",uniNum:!0,sortFunc:function(e,t){return e.info.quenchceLevel!=t.info.quenchceLevel?e.info.quenchceLevel-t.info.quenchceLevel:e.info.level2!=t.info.level2?e.info.level2-t.info.level2:e.info.level!=t.info.level?e.info.level-t.info.level:void 0}}),closeCB:function(){var e=0;0<a.selectedUuid_2.length&&(e=h.GameMVC.heroThingPy.AllEquipInfo[a.selectedUuid_2[0].split("#")[0]].config.code);a.chooseItemCode_2=e,a.updateView()}})},this),Utils.ComponentUtils.registerListener(this.gp_equi_3,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new h.CommonChosePanel({getInfos:function(){var e={},t=h.GameMVC.heroThingPy.AllEquipInfo;for(var i in t){var n=t[i];if(n.config.color==a.commonConfig.color&&""==n.heroUuid&&0!=n.config.professionSuit&&n.config.type==HeroEquipType.Shoe)for(var o=n.num;0<o--;)e[i+"#"+o]=n}return e},type:EEntityType.EEntityTypeHeroEquip,checkFull:function(e){return e.length>=a.needNum},selectUuids:a.selectedUuid_3,title:"请选择职业鞋子装备。",uniNum:!0,sortFunc:function(e,t){return e.info.quenchceLevel!=t.info.quenchceLevel?e.info.quenchceLevel-t.info.quenchceLevel:e.info.level2!=t.info.level2?e.info.level2-t.info.level2:e.info.level!=t.info.level?e.info.level-t.info.level:void 0}}),closeCB:function(){var e=0;0<a.selectedUuid_3.length&&(e=h.GameMVC.heroThingPy.AllEquipInfo[a.selectedUuid_3[0].split("#")[0]].config.code);a.chooseItemCode_3=e,a.updateView()}})},this),Utils.ComponentUtils.registerListener(this.btn_forge,egret.TouchEvent.TOUCH_TAP,function(){0<a.selectedUuid_0.length&&0<a.selectedUuid_1.length&&0<a.selectedUuid_2.length&&0<a.selectedUuid_3.length?a.targetId?a.judgeEquipType()?a.isEnough?a.numEnough?a.changeEquip():Utils.MsgUtils.addMidMsg("当前次数不足"):Utils.MsgUtils.addMidMsg("当前道具不足"):Utils.MsgUtils.addMidMsg("所需套装必须为同一职业套装，请重新选择"):Utils.MsgUtils.addMidMsg("当前未选择置换套装"):Utils.MsgUtils.addMidMsg("当前所需置换职业装备为空")},this),Utils.ComponentUtils.registerListener(this.btn_guide,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new h.HelpDialog({moduleId:MODULE.ActivityProfessionSuit})})},this)},e.prototype.judgeTargetId=function(e){var t=!1;if(0<this.selectedUuid_0.length&&0<this.selectedUuid_1.length&&0<this.selectedUuid_2.length&&0<this.selectedUuid_3.length){var i=h.GameMVC.heroThingPy.AllEquipInfo,n=this.selectedUuid_0[0].split("#")[0],o=this.selectedUuid_1[0].split("#")[0],a=this.selectedUuid_2[0].split("#")[0],r=this.selectedUuid_3[0].split("#")[0];if(this.judgeSameSuit(n,o,a,r)){var s=i[n].config.suitType;h.Config.HeroEquipCompound()[e].suitType==s&&(t=!0)}}return t},e.prototype.judgeSameSuit=function(e,t,i,n){var o=h.GameMVC.heroThingPy.AllEquipInfo;return o[e].config.professionSuit==o[t].config.professionSuit&&o[e].config.professionSuit==o[i].config.professionSuit&&o[e].config.professionSuit==o[n].config.professionSuit&&o[t].config.professionSuit==o[i].config.professionSuit&&o[t].config.professionSuit==o[n].config.professionSuit&&o[i].config.professionSuit==o[n].config.professionSuit},e.prototype.changeEquip=function(){var n=this,i={};this.selectedUuid_0.forEach(function(e){var t=e.split("#")[0];i[t]||(i[t]=0),i[t]+=1}),this.selectedUuid_1.forEach(function(e){var t=e.split("#")[0];i[t]||(i[t]=0),i[t]+=1}),this.selectedUuid_2.forEach(function(e){var t=e.split("#")[0];i[t]||(i[t]=0),i[t]+=1}),this.selectedUuid_3.forEach(function(e){var t=e.split("#")[0];i[t]||(i[t]=0),i[t]+=1});var e=[];for(var t in i)e.push({equipUuid:t,num:i[t]});h.GameMVC.heroThingPy.HeroEquipCompound({id:this.targetId,uuidInfos:e,type:HeroEquipCompoundType.ProfessionSuitReplacement,code:this.code,beforeCB:function(i){DragonBoneTools.playOnce({effectName:"common_tjjt",parent:n.gp_preview,y:-40,doneCB:function(){n.gp_preview.$children.forEach(function(e,t){DragonBoneTools.playOnce({effectName:"common_yingxiongfenjie",parent:e,doneCB:function(){t==n.gp_preview.numChildren-1&&i()}})})}})},cb:function(){n.selectedUuid_0=[],n.selectedUuid_1=[],n.selectedUuid_2=[],n.selectedUuid_3=[],n.targetId=0,n.chooseItemCode_0=0,n.chooseItemCode_1=0,n.chooseItemCode_2=0,n.chooseItemCode_3=0,n.updateView()}})},e.prototype.judgeEquipType=function(){if(0<this.selectedUuid_0.length&&0<this.selectedUuid_1.length&&0<this.selectedUuid_2.length&&0<this.selectedUuid_3.length){h.GameMVC.heroThingPy.AllEquipInfo;var e=this.selectedUuid_0[0].split("#")[0],t=this.selectedUuid_1[0].split("#")[0],i=this.selectedUuid_2[0].split("#")[0],n=this.selectedUuid_3[0].split("#")[0];return!!this.judgeSameSuit(e,t,i,n)}return!1},e}(h.ActivityCommonView);h.ActivityChangeEqui=e,__reflect(e.prototype,"game.ActivityChangeEqui");var p=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityProfessionSuitView_EquipItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseItem.addChild(this.baseItem),UIActionManager.fadeBlink(this.img_add,!0,!1,500)},e.prototype.updateItem=function(e){this.data=e,this.data.code?(this.gp_empty.visible=!1,this.gp_baseItem.visible=!0,this.baseItem.updateData({code:this.data.code})):(this.gp_empty.visible=!0,this.gp_baseItem.visible=!1)},e}(eui.Component);__reflect(p.prototype,"ActivityProfessionSuitView_EquipItem")}(game||(game={})),function(y){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.CollectHero,e}return __extends(e,t),e.prototype.getDataList=function(){var d=this,e=this.info;if(e&&e.data){var u=JSON.parse(e.content),t=e.data,g=[],f=t.targeted,_=t.specialListspecialList,m=JSON.parse(t.genericityList),i=function(e){var t=u[e],i={id:t[0],title:"",tips:"",rewards:[],status:REWARD_STATUS.UNAVAILABLE,btnFunc:function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:d.getReward({id:t[0]});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};if(1==t[1][0][0]){var n=t[1][0][1],o=t[1][0][2],a=t[1][0][3],r=t[1][0][4];i.title="收集%s%s%s英雄%s个".format([HeroRaceConfig[n]?HeroRaceConfig[n].name:"任意种族",ProfessionConfig[o]?ProfessionConfig[o].name:"任意职业",a?a+"星":"任意星级",r]);var s=m[c=""+(n<10?"0"+n:n)+(o<10?"0"+o:o)+(a<10?"0"+a:a)]?m[c]:0;i.tips=s+"/"+r,r<=s&&(i.status=REWARD_STATUS.AVAILABLE),f.some(function(e){return e.id==t[0]})&&(i.status=REWARD_STATUS.RECEIVED)}if(2==t[1][0][0]){var c=t[1][0][1],l=(r=t[1][0][2],y.GeneralConfig.getEntityConfigByCode(c));if(l){i.title="收集"+l.name+r+"个";s=0;for(var h in _){var p=_[h];p.code==c&&(r=p.num)}i.tips=s+"/"+r,r<=s&&(i.status=REWARD_STATUS.AVAILABLE),f.some(function(e){return e.id==t[0]})&&(i.status=REWARD_STATUS.RECEIVED)}}i.rewards=t[2],g.push(i)};for(var n in u)i(n);return g.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id}),g}},e}(y.ActivityCommonListView);y.ActivityCollectHeroView=e,__reflect(e.prototype,"game.ActivityCollectHeroView")}(game||(game={})),function(_){var e=function(f){function e(){var e=f.call(this)||this;return e.skinName="ActivityCommonShopSpecialItem",e}return __extends(e,f),e.prototype.childrenCreated=function(){var i=this;f.prototype.childrenCreated.call(this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.info;if(e&&e.data){var t=e.content;_.MainJumpConfig.jumpTo(t[0][2])}},this)},e.prototype.updateView=function(e){var t=this;f.prototype.updateView.call(this,e);var i=this.info;if(i&&i.data){var n=i.content,o=[];for(var a in n){var r=n[a];for(var s in r[1]){var c=r[1][s];o.push(c)}}var l=_.Config.shop(),h=[];for(var a in l){r=l[a];0<=o.indexOf(r.id)&&h.push(JSON.parse(r.reward)[0])}var p=_.Config.itemConfig();this.gp_reward.removeChildren();var d=function(e){var t=h[e],i=customui.BaseItemFactory.create();i.updateData({reward:t});var n=0;for(var o in p){var a=p[o];if(a.id==t[1]){var r=JSON.parse(a.effect);n=r[0][1]}}i.addTapEvent(function(){return n&&_.AppFacade.getInstance().showSubView(_.HeroMediator.N,_.HeroMediator.SV.HERO_DETAIL,{code:n}),!0}),u.gp_reward.addChild(i)},u=this;for(var a in h)d(a);this.img_bg.source=n[0][3]+"_png",this.img_tip.source=n[0][4]+"_png";var g=_.ActivityConfig.getActivityEndDt(this.code);this.bm_time.text=Utils.TimerManager.getFormatBySecond1(g-Utils.TimerManager.getServerTime()),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){t.bm_time.text=Utils.TimerManager.getFormatBySecond1(g-Utils.TimerManager.getServerTime())},this,1e3)}},e}(_.ActivityCommonView);_.ActivityCommonShopSpecialItem=e,__reflect(e.prototype,"game.ActivityCommonShopSpecialItem")}(game||(game={})),function(y){var e=function(t){function e(){var e=t.call(this)||this;return e.hasinit=!1,e.boxItems=[],e.skinName="ActivityContinueRechargeReward",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btnFunc&&e.btnFunc()},this)},e.prototype.updateView=function(e){var t=this;this.code=e&&e.activityType||e&&e.code||this.code;var i=this.info;if(i&&i.data){this.updateTitle();var n=JSON.parse(i.content);this.img_bg.source=n[3]?n[3]+"_png":"mrcz_img_mrczdt_png";var o=n[0],a=n[1],r=(n[2],JSON.parse(i.data.targeted)),s=i.data.rechargeDays,c=i.data.amounts;this.bm_rechargeDays.text=s+"天",o<=c?(this.lb_todayRecharge.text="(已达成)",this.lb_todayRecharge.textColor=3604224):this.lb_todayRecharge.text="（今日充值："+c+"/"+o+"）";var l=y.ActivityConfig.getCurDay(i);this.gp_rewards.removeChildren();var h=a[l-1];if(h){h&&h[1]&&y.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,h[1]);var p=REWARD_STATUS.GO_RECHARGE;for(var d in o<=c&&(p=REWARD_STATUS.AVAILABLE),r){if(r[d][0]==h[0]){p=REWARD_STATUS.RECEIVED;break}}switch(p){case REWARD_STATUS.AVAILABLE:this.btn_get.label="领取",UIActionManager.setGrey(this.btn_get,!1),this.btn_get.skinName="skins.ButtonSkinYellow",this.btn_get.scaleX=this.btn_get.scaleY=.8,this.btnFunc=function(){t.getReward({id:h[0],code:t.code})};break;case REWARD_STATUS.RECEIVED:this.btn_get.skinName="skins.ButtonSkinSure",this.btn_get.label="已领取",UIActionManager.setGrey(this.btn_get,!1),this.btn_get.scaleX=this.btn_get.scaleY=1,this.btnFunc=function(){Utils.MsgUtils.addMidMsg("已领取")};break;case REWARD_STATUS.GO_RECHARGE:this.btn_get.skinName="skins.ButtonSkinYellow",this.btn_get.label="充值",UIActionManager.setGrey(this.btn_get,!1),this.btn_get.scaleX=this.btn_get.scaleY=.8,this.btnFunc=function(){y.MainJumpConfig.jumpTo(MODULE.Recharge)}}p==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn_get,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2}):UIActionManager.hideEffect(this.btn_get);var u=this.getDataList();u[u.length-1].isFinal=!0,this.pb_progress.maximum=u[u.length-1].targetDays;var g=u.length,f=this.gp_boxs.width/u[u.length-1].targetDays;if(!this.hasinit){this.hasinit=!0;for(var _=0;_<g;_++){var m=new v;m.x=u[_].targetDays*f-66,this.gp_boxs.addChild(m),this.boxItems.push(m)}}for(_=0;_<g;_++)this.boxItems[_].update(u[_]);this.pb_progress.value=s}else Utils.MsgUtils.addMidMsg("找不到配置")}},e.prototype.updateTitle=function(){var e=this,t=this.actProxy.allActivityData[this.code];if(this.code==EActivityType.LevelReward)this.bm_time.text="";else if(t&&this.bm_time){var i=y.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(i),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=i--?e.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(i):y.AppFacade.getInstance().hideSubView(y.ActivityMediator.N,y.ActivityMediator.SV.MAIN)},this,1e3)}},e.prototype.getDataList=function(){var l=this,e=this.info;if(!e||!e.data)return[];e.content;var h=e.data.rechargeDays,p=JSON.parse(e.data.targeted),t=JSON.parse(e.content);if(!t)return[];var d=[],u=t[2],i=function(e){var t=u[e],i=t[0],n=t[1],o=t[2],a=REWARD_STATUS.AVAILABLE;for(var r in p){if(p[r][0]==i){a=REWARD_STATUS.RECEIVED;break}}h<n&&(a=REWARD_STATUS.GO_RECHARGE);var s="连续充值"+n+"天可领取",c={id:i,title:t[1]?s:"免费领取",tips:t[1]?h+"/"+n:"",rewards:o,targetDays:n,status:a,btnFunc:function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:l.getReward({id:t[0],code:l.code});break;case REWARD_STATUS.GO_RECHARGE:y.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};d.push(c)};for(var n in u)i(n);return d.sort(function(e,t){return e.id-t.id}),d},e}(y.ActivityCommonView);y.ActivityContinueRechargeReward=e,__reflect(e.prototype,"game.ActivityContinueRechargeReward");var v=function(t){function e(){var e=t.call(this)||this;return e.hasCreated=!1,e.hasAddEffect=!1,e.skinName="ActivityContinueRechargeRewardItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.hasCreated=!0,this.update(this.params),this.gp_top.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btnFunc&&e.btnFunc()},this)},e.prototype.update=function(e){var t=this;if(this.hasCreated){if(e){if(this.params=e,!this.hasAddEffect){var i=e.isFinal?"common_xunbaorijibxtd05":"common_xunbaorijibxtd03";UIActionManager.addEffect(this.gp_effect,i,{},function(e){t.tdEffect=e})}switch(this.bm_count.text=e.targetDays,e.status){case REWARD_STATUS.AVAILABLE:this.gp_effect.visible=!0,this.img_box.visible=!1,this.btnFunc=function(){t.tdEffect&&(t.tdEffect.visible=!1),t.img_box.visible=!0,t.img_box.source=e.isFinal?"xbrj_img_baoxiang0_4_png":"xbrj_img_baoxiang0_2_png",DragonBoneTools.playOnce({parent:t.gp_effect,effectName:"common_xunbaorijibxtx",doneCB:function(){e.btnFunc&&e.btnFunc(e)}})};break;case REWARD_STATUS.GO_RECHARGE:this.img_box.source=e.isFinal?"xbrj_img_baoxiang1_4_png":"xbrj_img_baoxiang1_2_png",this.gp_effect.visible=!1,this.img_box.visible=!0,this.btnFunc=function(){y.AppFacade.getInstance().showSubView(y.CommonMediator.N,y.CommonMediator.SV.REWARD_PANEL,{rewards:e.rewards,type:y.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})};break;case REWARD_STATUS.RECEIVED:this.gp_effect.visible=!1,this.img_box.visible=!0,this.img_box.source=e.isFinal?"xbrj_img_baoxiang0_4_png":"xbrj_img_baoxiang0_2_png",this.btnFunc=function(){Utils.MsgUtils.addMidMsg("已领取")}}}}else this.params=e},e}(eui.ItemRenderer);__reflect(v.prototype,"ActivityContinueRechargeRewardItem")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.actProxy=a.AppFacade.getInstance().retrieveProxy(a.ActivityPy.N),e.backpackProxy=a.AppFacade.getInstance().retrieveProxy(a.BackpackPy.N),e.code=EActivityType.DailyLogin,Utils.AssetsMgr.loadGroup("group_daily_login"),e.skinName="ActivityDailyLogin",e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_daily_login")},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList()},Object.defineProperty(e.prototype,"info",{get:function(){if(this.code)return this.actProxy.allActivityData[this.code];this.log("没有声明活动code")},enumerable:!0,configurable:!0}),e.prototype.initList=function(){this.list_itemList.itemRenderer=i},e.prototype.updateView=function(e){var t=this.getDataList();this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(t):this.list_itemList.dataProvider=new eui.ArrayCollection(t)},e.prototype.getDataList=function(){var r=this,e=this.info,t=JSON.parse(e.content),s=e.data.targeted,c=e.data.key||0,l=(e.data.day,[]),i=e.data.curCycle;for(var n in t[1]){var o=t[1][n];if(o[0]==i){t=o[1];break}}return t.forEach(function(e){var t=e[0],i=e[1],n=e[2],o=REWARD_STATUS.UNAVAILABLE;s.some(function(e){return e.id==t&&0<e.num})?o=REWARD_STATUS.RECEIVED:c>=e[1]&&(o=REWARD_STATUS.AVAILABLE);var a={id:i,title:"开服第"+t+"天可领取",tips:c+"/"+i,status:o,rewards:n,btnFunc:function(){r.getReward({id:t})}};l.push(a)}),l.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id}),this.img_bg.source=1==i?"lxdl_img_ditu_png":"lxdl_img_14riditu_png",l},e.prototype.getReward=function(e,t){var i=this;if(this.code){var n=a.ActivityConfig.Config[this.code],o=n.getRewardName;o&&""!=o&&Utils.Socket.send("activity",o,e).then(function(e){i.log(n.name+"——领取",o+"R",e),i.info.updateData(e.info),i.backpackProxy.handleClientReward(e.clientReward),t&&t(e)})}else this.log("没有声明活动code")},e}(BasePanel);a.ActivityDailyLogin=e,__reflect(e.prototype,"game.ActivityDailyLogin");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityDailyLoginItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.btnFunc&&e.data.btnFunc()},this)},e.prototype.dataChanged=function(){var o=this;this.lb_title.text=this.data.title||"";var e=this.data.rewards;switch(this.gp_reward.removeChildren(),e.forEach(function(e,t){var i=customui.BaseItemFactory.create();if(i.scaleX=i.scaleY=.6,e[0]==EEntityType.EEntityTypeHeroArtifact||e[0]==EEntityType.EEntityTypeHeroEquip){var n={code:e[1],entityType:e[0],exp:0,fightCap:0,level:0,level2:0,filterShow:!0};i.updateData({reward:e,vo:n})}else i.updateData({reward:e});o.gp_reward.addChild(i)}),this.data.status){case REWARD_STATUS.UNAVAILABLE:this.btn.label="领取",UIActionManager.setGrey(this.btn,!0),this.btn.skinName="skins.ButtonSkinYellow2";break;case REWARD_STATUS.RECEIVED:this.btn.skinName="skins.ButtonSkinSure",this.btn.label="已领取",UIActionManager.setGrey(this.btn,!1);break;default:this.btn.label="领取",UIActionManager.setGrey(this.btn,!1),this.btn.skinName="skins.ButtonSkinYellow2"}this.data.status==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn,"common_lingquanniu",{scaleX:.9,scaleY:.9,offectY:-2}):UIActionManager.hideEffect(this.btn)},e}(eui.ItemRenderer);__reflect(i.prototype,"ActivityDailyLoginItem")}(game||(game={})),function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getDataList=function(){var e,r=this,t=this.info,i=JSON.parse(t.content),s=t.data.targeted,c=t.data.key||1,n=t.data.curCycle;for(var o in i[1]){var a=i[1][o];if(a[0]==n){e=a[1];break}}if(!e)return Utils.MsgUtils.addMidMsg("找不到配置"),[];var l=[];return e.forEach(function(e){var t=e[0],i=e[1],n=e[2],o=REWARD_STATUS.UNAVAILABLE;s.some(function(e){return e.id==t&&0<e.num})?o=REWARD_STATUS.RECEIVED:c>=e[1]&&(o=REWARD_STATUS.AVAILABLE);var a={id:i,title:"连续登录"+i+"天",tips:c+"/"+i,status:o,rewards:n,btnFunc:function(){r.getReward({code:r.code,id:t})}};l.push(a)}),l.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id}),l},t}(e.ActivityCommonListView);e.ActivityDailyLoginWeal=t,__reflect(t.prototype,"game.ActivityDailyLoginWeal")}(game||(game={})),function(_){var e=function(i){function e(){var e=i.call(this)||this;return e.actProxy=_.AppFacade.getInstance().retrieveProxy(_.ActivityPy.N),e.code=EActivityType.DailyLuxuryGifts,Utils.AssetsMgr.loadGroup("group_daily_luxury_gifts"),e.skinName="ActivityDailyLuxuryGifts",e}return __extends(e,i),e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer),Utils.AssetsMgr.destroyGroup("group_daily_luxury_gifts")},Object.defineProperty(e.prototype,"info",{get:function(){if(this.code)return this.actProxy.allActivityData[this.code];this.log("没有声明活动code")},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btnFunc1&&e.btnFunc1()},this),this.btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btnFunc2&&e.btnFunc2()},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.updateView();var t=_.ActivityConfig.getActivityEndDt(this.code);this.lb_time.text=Utils.TimerManager.getFormatBySecond1(t-Utils.TimerManager.getServerTime()),this.timer=egret.setInterval(function(){e.lb_time.text=Utils.TimerManager.getFormatBySecond1(t-Utils.TimerManager.getServerTime())},this,1e3)},e.prototype.getReward=function(e,t){var i=this;if(this.code){var n=_.ActivityConfig.Config[this.code].getRewardName;n&&""!=n&&Utils.Socket.send("activity",n,e).then(function(e){i.actProxy.updateData_View_Reward(i.code,e),_.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN),t&&t(e)})}else this.log("没有声明活动code")},e.prototype.updateView=function(e){var l=this;this.code=e&&e.activityType||e&&e.code||this.code;var t=this.info;if(t&&t.data&&_.ActivityConfig.Config[this.code]){var h=t.data.targeted,i=t.content,p=t.data.key,n=t.data.day,d=[];for(var o in i){var a=i[o];a[0]==n&&d.push(a)}if(!d.length)return[];for(var u=_.AppFacade.getInstance().retrieveProxy(_.RechargePy.N),g=(u.goodList,0),r=function(e){var t=d[e],o=(t[0],t[1]),a=t[2],i=t[3],n=t[4],r=REWARD_STATUS.GO_RECHARGE;if(n){if(-1==g)return"continue";r=REWARD_STATUS.CANBUY,a||(r=REWARD_STATUS.AVAILABLE);c=!1;for(var s in h){if(h[s].id==o){c=!0;break}}if(c&&(r=REWARD_STATUS.RECEIVED,++g!=d.length-1))return"continue";switch(g){case 0:f.img_title.source="mrhl_txt_mianfeihaoli_png";break;case 1:f.img_title.source="mrhl_txt_6yuanhaoli_png";break;case 2:case 3:f.img_title.source=d.length<4?"mrhl_txt_6yuanhaoli_png":"mrhl_txt_30yuanhaoli_png"}g=-1,f.gp_reward1.removeChildren(),_.GameMgr.getInstance().CommonGpAddReward(f.gp_reward1,i),f.updateBtn(f.btn1,r),f.btnFunc1=function(){switch(r){case REWARD_STATUS.AVAILABLE:l.getReward({code:l.code,id:o});break;case REWARD_STATUS.CANBUY:var e=u.goodList,t=void 0;for(var i in e){var n=e[i];n.id==a&&(t=n)}t?u.purchase(t,2,String(o),JSON.stringify({uuid:o,activityType:l.code}),{activityType:l.code}):Utils.MsgUtils.addMidMsg("找不到商品信息");break;case REWARD_STATUS.GO_RECHARGE:_.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.HASBUY:Utils.MsgUtils.addMidMsg("已购买")}}}else{a<=p&&(r=REWARD_STATUS.AVAILABLE);var c=!1;for(var s in h){if(h[s].id==o){c=!0;break}}c&&(r=REWARD_STATUS.RECEIVED),f.gp_reward2.removeChildren(),_.GameMgr.getInstance().CommonGpAddReward(f.gp_reward2,i),f.bm_targeted.text=a,f.updateBtn(f.btn2,r),f.lb_todayRecharge.textFlow=[{text:"今日已充值:",style:{textColor:16777215}},{text:(p||0)+"",style:{textColor:3211008}},{text:"元",style:{textColor:16777215}}],f.btnFunc2=function(){switch(r){case REWARD_STATUS.AVAILABLE:case REWARD_STATUS.CANBUY:l.getReward({code:l.code,id:o});break;case REWARD_STATUS.GO_RECHARGE:_.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.HASBUY:Utils.MsgUtils.addMidMsg("已购买")}}}},f=this,s=0;s<d.length;s++)r(s)}},e.prototype.updateBtn=function(e,t){switch(t){case REWARD_STATUS.RECEIVED:e.skinName="skins.ButtonSkinSure",e.label="已领取",UIActionManager.setGrey(e,!1),e.scaleX=e.scaleY=.7,UIActionManager.hideEffect(e);break;case REWARD_STATUS.GO_RECHARGE:e.skinName="skins.ButtonSkinYellow",e.label="充值",UIActionManager.setGrey(e,!1),e.scaleX=e.scaleY=.8,UIActionManager.hideEffect(e);break;case REWARD_STATUS.CANBUY:e.skinName="skins.ButtonSkinYellow",e.label="购买",UIActionManager.setGrey(e,!1),e.scaleX=e.scaleY=.8,UIActionManager.hideEffect(e);break;default:e.label="领取",UIActionManager.setGrey(e,!1),e.skinName="skins.ButtonSkinYellow",e.scaleX=e.scaleY=.8,UIActionManager.addEffect(e,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2})}},e}(BasePanel);_.ActivityDailyLuxuryGifts=e,__reflect(e.prototype,"game.ActivityDailyLuxuryGifts")}(game||(game={})),function(y){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.DiamondGifts,e}return __extends(e,t),e.prototype.getDataList=function(){var i=this,e=this.info;if(e&&e.data){var t,n=e.data.targeted,o=e.content,a=e.data.curCycle||1;for(var r in o[1]){if((l=o[1][r])[0]==a){t=l[1];break}}if(!t)return[];for(var s=[],c=0;c<t.length;c++){var l,h=(l=t[c])[0],p=l[1],d=l[2],u=l[3],g=REWARD_STATUS.CANBUY,f=0;for(var r in n){var _=n[r];if(_.id==h){f=_.num;break}}u<=f&&(g=REWARD_STATUS.HASBUY);var m={id:h,title:d[0][2]+"钻礼包",tips:f+"/"+u,rewards:p,status:g,btnFunc:function(e){switch(e.status){case REWARD_STATUS.CANBUY:Utils.Socket.send("activity","BuyExchangeGifts",{code:i.code,giftCode:e.id,num:1}).then(function(e){y.AppFacade.getInstance().retrieveProxy(y.ActivityPy.N).updateData_View_Reward(i.code,e)});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.HASBUY:Utils.MsgUtils.addMidMsg("已购买")}var t=y.AppFacade.getInstance().retrieveMediator(y.ActivityMediator.N).getSubView(y.ActivityMediator.SV.MAIN);t&&t.updateResourceBar()}};s.push(m)}return s.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id}),s}},e}(y.ActivityCommonListView);y.ActivityDiamondGifts=e,__reflect(e.prototype,"game.ActivityDiamondGifts")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.DiamondRebate,e.curLevel=0,e.scheId=0,e.POS=[[0,0],[0,10],[30,20],[55,30],[85,40],[113,50],[140,65],[170,70],[195,85],[225,100]],e.skinName="ActivityDiamondRebateViewSkin",e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.scheId&&(egret.clearInterval(this.scheId),this.scheId=void 0)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.pb_pb.labelDisplay.visible=!1},e.prototype.updateView=function(e){var i=this,t=this.info;if(t){var n=t.content,o=n.length-1,a=t.data.total||0;this.curLevel=0,n.forEach(function(e,t){a>=e[0]&&a<e[1]&&(i.curLevel=t),0!=e[2]&&i.generateItem(e,t,o)}),t.data&&(this.blb_curCost.text=a,this.blb_curRebate.text=t.data.rebate||0),this.img_cur.y=this.POS[this.curLevel][0],this.pb_pb.value=this.POS[this.curLevel][1],this.scheId||(this.scheId=egret.setInterval(function(){i.blb_dt.text=Utils.TimerManager.getFormatBySecond2(t.endDt-Utils.TimerManager.getServerTime())},this,1e3))}},e.prototype.generateItem=function(e,t,i){var n=new eui.Group,o=new eui.Label,a=new eui.Label,r=new eui.Image;n.width=this.gp_tips.width,n.height=31;var s=new eui.HorizontalLayout;s.verticalAlign=egret.VerticalAlign.MIDDLE,s.gap=4,n.layout=s,r.width=r.height=31,r.source="item_icon_zuanshi_png",a.textColor=7339894,a.size=22,a.x=r.x+r.width+5,a.text="返利"+Math.floor(100*e[2])+"%";var c=void 0;c=t==i?[{text:"累积消费 ",style:{size:22,textColor:16775312}},{text:e[0]+"及以上",style:{size:22,textColor:9499647}}]:[{text:"累积消费 ",style:{size:22,textColor:16775312}},{text:e[0]+"~"+(e[1]-1),style:{size:22,textColor:9499647}}],t==this.curLevel||(UIActionManager.setAbsGrey(r,!0),c.forEach(function(e){e.style.textColor=9737364}),a.textColor=9737364),o.textFlow=c,n.addChild(o),n.addChild(r),n.addChild(a),n.x=0,n.y=this.gp_tips.height/i*(t-1),this.gp_tips.addChild(n)},e}(e.ActivityCommonView);e.ActivityDiamondRebateView=t,__reflect(t.prototype,"game.ActivityDiamondRebateView")}(game||(game={})),function(o){var e=function(m){function e(){var e=m.call(this)||this;return e.boxs=[],e.pageIndex=void 0,e.boatY=[688,480,308,116],e.boatX=[250,11,-247],e.boxPosi=[[200,520],[-50,520],[-50,320],[200,320],[450,320],[450,140],[200,140],[-50,140],[-50,-50],[200,-50]],e.effectObj=void 0,e.skinName="ActivityDragonBoatGrade",e}return __extends(e,m),e.prototype.childrenCreated=function(){var i=this;m.prototype.childrenCreated.call(this),DragonBoneTools.playOnce({effectName:"common_dwlongzhou",parent:this.gp_boat,x:this.gp_boat.width/2,y:this.gp_boat.height/2+30,loop:!0,loadFinishCB:function(e){i.effectObj=e,i.effectObj.visible=!1,egret.setTimeout(function(){i.updateView()},i,500)}});for(var e=0;e<1;e++)DragonBoneTools.playOnce({effectName:"common_dwbowen",parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/2,loop:!0});for(e=0;e<10;e++){var t=new n;t.x=this.boxPosi[e][0],t.y=this.boxPosi[e][1],this.boxs.push(t),this.gp_boxs.addChild(t)}this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new o.HelpDialog({moduleId:MODULE.Activity+EActivityType.DragonBoatGrade})})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.AppFacade.getInstance().showSubView(o.RankMediator.N,o.RankMediator.SV.COMMON,{module:"DragonBoatGradeRank"})},this),this.btn_cost0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.info;if(e&&e.data){var t=JSON.parse(e.content)[2];o.GameMgr.getInstance().showCommonTipsWin({costTips:"前进"+t[1][1]+"m",cost:JSON.stringify(t[1][0]),cb:!0,source:"ActivityDragonBoatGrade0",clickCB:function(e){1==e.type&&i.actProxy.DoCommonOperation(i.code,1,2)}})}},this),this.btn_cost2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.info;if(e&&e.data){var t=JSON.parse(e.content)[2];o.GameMgr.getInstance().showCommonTipsWin({costTips:"前进"+10*t[1][1]+"m",cost:JSON.stringify([[t[1][0][0][0],t[1][0][0][1],10*t[1][0][0][2]]]),cb:!0,source:"ActivityDragonBoatGrade2",clickCB:function(e){1==e.type&&i.actProxy.DoCommonOperation(i.code,10,2)}})}},this),this.btn_cost1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.info;e&&e.data&&o.GameMVC.activityMed.updateView(o.ActivityMediator.SV.MAIN,{code:EActivityType.EatingZongZi})},this),this.btn_lastOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1==i.pageIndex&&(i.pageIndex=0,i.updateView())},this),this.btn_nextOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0==i.pageIndex&&(i.pageIndex=1,i.updateView())},this)},e.prototype.updateView=function(e){m.prototype.updateView.call(this,e);var t=this.info;if(t&&t.data){this.hideAllLines();var i=JSON.parse(t.content),n=i[3];n.sort(function(e,t){return e[0]-t[0]});var o=t.data.grade,a=t.data.targeted;if(null==this.pageIndex)if(o>=n[9][0]){for(var r=0;r<10;r++)if(a.indexOf(n[r][0]<0)){!1,this.pageIndex=1;break}}else this.pageIndex=0;this.img_text.visible=0==this.pageIndex,this.btn_lastOne.visible=1==this.pageIndex,this.btn_nextOne.visible=0==this.pageIndex;var s=0;o>=n[9][0]&&(s=1),0==s&&1==this.pageIndex?UIActionManager.addEffect(this.btn_lastOne,"common_btn_jiantou"):UIActionManager.hideEffect(this.btn_lastOne),1==s&&0==this.pageIndex?UIActionManager.addEffect(this.btn_nextOne,"common_btn_jiantou"):UIActionManager.hideEffect(this.btn_nextOne);var c=0,l=!1,h=0==this.pageIndex?0:n[9][0];for(r=0;r<10;r++){var p=10*this.pageIndex+r,d=this.boxs[r],u=n[p][0];if(d&&d.update({max:u,cur:o,got:0<=a.indexOf(u),rewards:n[p][1],curStage:c,view:this}),u<=o)this.showLine(c),c++;else if(!l){l=!0,this.gp_boat.scaleX=3==c||4==c||9==c?-1:1,this.gp_boat.visible=!0;var g=0==c?(u-o)/(u-h):(u-o)/(u-n[p-1][0]),f=0;switch(.8<=g&&c?(this.effectObj&&(this.effectObj.visible=!1),this.img_boat.source="dwj_img_lztb_png",this.img_boat.visible=!0,f=-50,2!=c&&5!=c&&8!=c||(g=.8)):g<=.2?(this.effectObj&&(this.effectObj.visible=!1),this.img_boat.source="dwj_img_lztb_png",this.img_boat.visible=!0,f=2==c||5==c||8==c?-100:-50,2!=c&&5!=c&&8!=c||(g=.2)):(this.effectObj&&(this.effectObj.visible=!0),this.img_boat.visible=!1),c){case 0:this.gp_boat.y=this.boatY[0],this.gp_boat.horizontalCenter=this.boatX[1]-(this.boatX[1]-this.boatX[0])*g;break;case 1:this.gp_boat.y=this.boatY[0],this.gp_boat.horizontalCenter=this.boatX[2]-(this.boatX[2]-this.boatX[1])*g;break;case 2:this.gp_boat.horizontalCenter=this.boatX[2],this.gp_boat.y=this.boatY[1]-(this.boatY[1]-this.boatY[0])*g;break;case 3:this.gp_boat.y=this.boatY[1],this.gp_boat.horizontalCenter=this.boatX[1]-(this.boatX[1]-this.boatX[2])*g;break;case 4:this.gp_boat.y=this.boatY[1],this.gp_boat.horizontalCenter=this.boatX[0]-(this.boatX[0]-this.boatX[1])*g;break;case 5:this.gp_boat.horizontalCenter=this.boatX[0],this.gp_boat.y=this.boatY[2]-(this.boatY[2]-this.boatY[1])*g;break;case 6:this.gp_boat.y=this.boatY[2],this.gp_boat.horizontalCenter=this.boatX[1]-(this.boatX[1]-this.boatX[0])*g;break;case 7:this.gp_boat.y=this.boatY[2],this.gp_boat.horizontalCenter=this.boatX[2]-(this.boatX[2]-this.boatX[1])*g;break;case 8:this.gp_boat.horizontalCenter=this.boatX[2],this.gp_boat.y=this.boatY[3]-(this.boatY[3]-this.boatY[2])*g;break;case 9:this.gp_boat.y=this.boatY[3],this.gp_boat.horizontalCenter=this.boatX[1]-(this.boatX[1]-this.boatX[2])*g;break;default:this.gp_boat.visible=!1}this.gp_boat.y+=f}}this.gp_boat.visible=l;var _=i[2];this.cost_0.updateItem({cost:_[1][0][0],style:CommonIconStyle.RIGHT}),this.cost_2.updateItem({cost:[_[1][0][0][0],_[1][0][0][1],10*_[1][0][0][2]],style:CommonIconStyle.RIGHT}),this.cost_1.updateItem({cost:_[0][0][0],style:CommonIconStyle.RIGHT}),this.CommonResourceBar.updateBar(_[0][0]);i[1],i[0];this.bm_speed.text="距离:"+o+"m"}},e.prototype.showLine=function(e){var t=this.gp_lines.$children[e];t&&(t.visible=!0)},e.prototype.hideAllLines=function(){for(var e=this.gp_lines.$children.length,t=0;t<e;t++){var i=this.gp_lines.$children[t];i&&(i.visible=!1)}},e}(o.ActivityCommonView);o.ActivityDragonBoatGrade=e,__reflect(e.prototype,"game.ActivityDragonBoatGrade");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityDragonBoatGradeItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var n=this;t.prototype.childrenCreated.call(this),UIActionManager.addEffect(this,"common_dwxuanwo",{x:this.width/2,y:this.height/2,loop:!0,childIndex:0}),this.btn_box.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(n.params.cur>=n.params.max){GameRootLayer.gameLayer().switchTouchEnable(!1);var i=egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},n,1e3);Utils.Socket.send("activity","GetCommonReward",{code:EActivityType.DragonBoatGrade,id:n.params.max}).then(function(t){n.btn_box.icon="dwj_img_baoxiang0_png",DragonBoneTools.playOnce({effectName:"common_jxbaoxiangkai",parent:n,x:n.width/2,y:n.height/2,doneCB:function(){if(GameRootLayer.gameLayer().switchTouchEnable(!0),egret.clearTimeout(i),9==n.params.curStage){var e=n.params.view;e&&(e.pageIndex=void 0)}o.GameMVC.activityPy.updateData_View_Reward(EActivityType.DragonBoatGrade,t)}})})}else o.AppFacade.getInstance().showSubView(o.CommonMediator.N,o.CommonMediator.SV.REWARD_PANEL,{rewards:n.params.rewards,type:o.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this)},e.prototype.update=function(e){this.params=e,this.bm_cur.text=e.cur,this.bm_tar.text="/"+e.max,this.bm_cur.font=e.cur>=e.max?"green_num_fnt":"white_num_fnt",this.btn_box.icon=this.params.got?"dwj_img_baoxiang0_png":"dwj_img_baoxiang1_png",this.img_notice.visible=!e.got&&e.cur>=e.max,this.img_got.visible=e.got,(e.got||e.max>e.cur+1e3)&&(this.bm_cur.text="",this.bm_tar.text="")},e}(eui.ItemRenderer);__reflect(n.prototype,"ActivityDragonBoatGradeItem")}(game||(game={})),function(s){var e=function(r){function e(){var e=r.call(this)||this;return e.skinName="ActivityDrawCardRatioImprove",e}return __extends(e,r),e.prototype.childrenCreated=function(){var i=this;r.prototype.childrenCreated.call(this),this.gp_effect.visible=!1,this.gp_coverAll.visible=!1,this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.info;if(e&&e.data){var t=e.content;s.MainJumpConfig.jumpTo(),s.MainJumpConfig.jumpTo(t[1])}},this),this.btn_go1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.info;if(e&&e.data){var t=e.content;s.MainJumpConfig.jumpTo(),s.MainJumpConfig.jumpTo(t[2])}},this),this.btn_preview0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.info;if(e&&e.data){var t=e.content;i.gp_effect.$children[1]&&i.gp_effect.removeChildAt(1),t[3]&&(MovieClipTools.create(t[3],function(e){e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2,e.scaleX=this.gp_effect.width/e.width,e.scaleY=this.gp_effect.height/e.height,e.animation.play(t[3],-1),this.gp_effect.addChildAt(e,1)},i),i.gp_effect.visible=!0,i.gp_coverAll.visible=!0)}},this),this.btn_preview1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.info;if(e&&e.data){var t=e.content;i.gp_effect.$children[1]&&i.gp_effect.removeChildAt(1),t[4]&&(MovieClipTools.create(t[4],function(e){e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2,e.scaleX=this.gp_effect.width/e.width,e.scaleY=this.gp_effect.height/e.height,e.animation.play(t[4],-1),this.gp_effect.addChildAt(e,1)},i),i.gp_effect.visible=!0,i.gp_coverAll.visible=!0)}},this),this.gp_coverAll.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.gp_effect.visible=!1,i.gp_coverAll.visible=!1},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.gp_effect.visible=!1,i.gp_coverAll.visible=!1},this)},e.prototype.updateView=function(e){var t=this;r.prototype.updateView.call(this,e);var i=this.info;if(!i||!i.data)return this.bm_time.text="",void(this.bm_timeTip.text="活动已结束");var n=i.content;this.img_bg.source=n[0]+"_png",this.timer&&egret.clearInterval(this.timer);var o=s.ActivityConfig.getActivityEndDt(this.code),a=Utils.TimerManager.getServerTime();0<o-a?(this.bm_timeTip.text="活动倒计时:",this.bm_time.text=Utils.TimerManager.getFormatBySecond1(o-a)):(this.bm_timeTip.text="活动已结束",this.bm_time.text=""),this.timer=egret.setInterval(function(){var e=Utils.TimerManager.getServerTime();0<o-e?(t.bm_timeTip.text="活动倒计时:",t.bm_time.text=Utils.TimerManager.getFormatBySecond1(o-e)):(t.bm_timeTip.text="活动已结束",t.bm_time.text="")},this,1e3),n[3]?this.btn_preview0.visible=!0:this.btn_preview0.visible=!1,n[4]?this.btn_preview1.visible=!0:this.btn_preview1.visible=!1,this.img_bottomLight.visible=!!n[5],this.btn_go1.visible=!1,n[1]&&n[2]?(this.btn_go1.visible=!0,this.btn_go.horizontalCenter=84,this.btn_go1.horizontalCenter=-234,this.btn_go1.top=638,this.gp_time.visible=!1):this.gp_time.top=824},e}(s.ActivityCommonView);s.ActivityDrawCardRatioImprove=e,__reflect(e.prototype,"game.ActivityDrawCardRatioImprove")}(game||(game={})),function(p){var e=function(d){function e(){var e=d.call(this)||this;return e.ActivityEatingZongZiItemList=[],e.effectObj=void 0,e.skinName="ActivityEatingZongZi",e}return __extends(e,d),e.prototype.childrenCreated=function(){var t=this;d.prototype.childrenCreated.call(this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new p.HelpDialog({moduleId:MODULE.Activity+t.code})})},this),this.btn_achieve.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){p.AppFacade.getInstance().showSubView(p.RankMediator.N,p.RankMediator.SV.COMMON,{module:"ACTIVITY_EATINGZONGZI"})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){p.AppFacade.getInstance().showSubView(p.RankMediator.N,p.RankMediator.SV.COMMON,{module:"NewZoneZongZiGradeRank"})},this);for(var e=[[40,-120],[250,-50],[470,-120]],i=0;i<3;i++){var n=new o;n.x=e[i][0],n.y=e[i][1],this.ActivityEatingZongZiItemList.push(n),this.gp_zongzi.addChild(n)}this.gp_coverAll.visible=this.gp_detail.visible=!1,this.gp_coverAll.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.updateDetail({})},this),UIActionManager.addEffect(this.gp_effect,"chizongzi",{offectY:150},function(e){t.effectObj=e})},e.prototype.updateView=function(e){var t=this;d.prototype.updateView.call(this,e),this.updateTitle();var i=this.info;if(i&&i.data){var n=JSON.parse(i.content),o=n[1],a=function(e){o[e][7]=r.code,o[e][5]=function(){t.updateDetail(o[e])},o[e][6]=function(e){t.DoCommonOperation(e)},r.ActivityEatingZongZiItemList[e].update(o[e])},r=this;for(var s in o)a(s);var c=i.data.integral||0,l=i.data.targeted,h=n[0];for(var s in this.img_notice.visible=!1,h){var p=h[s][0];if(p<=c&&l.indexOf(p)<0){this.img_notice.visible=!0;break}}}},e.prototype.DoCommonOperation=function(t){var i=this;if(p.GameMVC.backpackPy.checkEnough(t[1],!1)){var e=p.AppFacade.getInstance().retrieveMediator(p.ShopyMediator.N),n=p.GameMVC.backpackPy.getInfoByCode(t[1][0][1]);e.showSubView(p.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:"",costs:t[1],countFun:function(e){return{unit:1,total:e}},name:n.info.name},maxCount:n.haveNum,buyNum:0,btnLabel:"享用",costTip:"享用消耗",limitTip:"享用次数",doneCB:function(e){i.effectObj&&i.effectObj.animation.play("chi",1),GameRootLayer.gameLayer().switchTouchEnable(!1),egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0),p.GameMVC.activityPy.DoCommonOperation(t[7],e.num||1,t[0]),i.effectObj.animation.play("daiji",0),Utils.MsgUtils.addMidMsg("龙舟前进了"+t[4]*e.num+"米")},i,1400)}})}else Utils.MsgUtils.addMidMsg("粽子不足")},e.prototype.updateDetail=function(e){if(1==this.gp_detail.visible)this.gp_detail.visible=!1,this.gp_coverAll.visible=!1;else{this.gp_detail.visible=!0,this.gp_coverAll.visible=!0;e[0];var t=e[1],i=e[2],n=t[0],o=p.GameMVC.backpackPy.getInfoByCode(n[1]);this.lb_name.text=o.info.name,this.lb_desc.text=o.info.desc,this.gp_rewards.removeChildren();for(var a in i){var r=i[a],s=(c=r,h=l=void 0,l=new eui.Group,(h=customui.BaseItemFactory.create()).updateData({reward:c[1][0]}),h.scaleX=h.scaleY=.8,l.addChild(h),l);this.gp_rewards.addChild(s)}}var c,l,h},e.prototype.updateTitle=function(){var e=this,t=p.Config.activityConfigs()[this.code],i=this.actProxy.allActivityData[this.code];if(t&&this.img_title&&(this.img_title.source=JSON.parse(t.img_title)[0]+"_png"),this.code==EActivityType.LevelReward)this.bm_time.text="";else if(i&&this.bm_time){var n=p.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(n),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=n--?e.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(n):p.AppFacade.getInstance().hideSubView(p.ActivityMediator.N,p.ActivityMediator.SV.MAIN)},this,1e3)}},e}(p.ActivityCommonView);p.ActivityEatingZongZi=e,__reflect(e.prototype,"game.ActivityEatingZongZi");var o=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityEatingZongZiItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;this.btn_eat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data[6]&&e.data[6](e.data)},this),this.img_icon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data[5]&&e.data[5]()},this)},e.prototype.update=function(e){this.data=e;var t=this.data[0],i=this.data[1];this.data[2];this.img_bg.source=1==t?"newactivity_img_tbk_png":"newactivity_img_tbk"+t+"_png";var n=i[0],o=p.GameMVC.backpackPy.getInfoByCode(n[1]);this.img_icon.source=o.info.icon+"_png",this.bm_num.text=o.haveNum},e}(eui.ItemRenderer);__reflect(o.prototype,"ActivityEatingZongZiItem")}(game||(game={})),function(t){var e=function(s){function e(){var e=s.call(this)||this;return e.rechargeProxy=t.AppFacade.getInstance().retrieveProxy(t.RechargePy.N),Utils.AssetsMgr.loadGroup("group_enjoy_card"),e.skinName="ActivityEnjoyCardViewSkin",e}return __extends(e,s),e.prototype.onDestroy=function(){s.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_enjoy_card")},e.prototype.childrenCreated=function(){var e=this;s.prototype.childrenCreated.call(this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.purchaseEnjoyCard(e.code)},this)},e.prototype.initList=function(){this.list_itemList.itemRenderer=t.ActivityCommonListItem,this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF},e.prototype.updateView=function(e){s.prototype.updateView.call(this,e);var t=this.info,i=t.data.startEffectDt,n=t.data.endEffectDt,o=this.rechargeProxy.getEnjoyCardInfo(this.code);if(o&&(this.btn_buy.label=o.price+"元"),i&&n){JSON.parse(t.content);this.btn_buy.skinName="skins.ButtonSkinSure",this.btn_buy.label="已购买",UIActionManager.setGrey(this.btn_buy,!1),this.btn_buy.scaleX=this.btn_buy.scaleY=1,this.btn_buy.touchEnabled=!1;var a=t.data.targeted,r=Math.floor((n-i)/24/3600);this.lb_time.text="剩余时间 : "+Utils.TimerManager.getFormatBySecond2(n-Utils.TimerManager.getServerTime()),this.bm_targetTimes.text=a.length+"/"+r}else this.btn_buy.touchEnabled=!0,this.lb_time.text="剩余时间 : "+Utils.TimerManager.getFormatBySecond2(t.endDt-Utils.TimerManager.getServerTime()),this.bm_targetTimes.text="0/0"},e.prototype.getDataList=function(){var s=this,e=this.info,c=JSON.parse(e.content),l=(e.data.startEffectDt,e.data.endEffectDt,e.data.targeted),t=new Date(1e3*e.startDt);t.setHours(23,59,59);var h=Math.ceil((Utils.TimerManager.getServerTime()-(t.getTime()/1e3+1))/24/3600);++h<=0&&(h=1);var i=1;for(var n in l.sort(function(e,t){return e-t}),l){if(l[n]!=i)break;i++}for(var p=[],o=function(e){var t=c[1][e],i=t[0],n=t[1],o=0*c[0]+i,a=REWARD_STATUS.AVAILABLE;0<=l.indexOf(o)?a=REWARD_STATUS.RECEIVED:h<o&&(a=REWARD_STATUS.UNAVAILABLE);var r={num:e,id:i,rewards:n,status:a,title:"第"+(e+1)+"天可领取",btnFunc:function(){s.getReward({day:o,code:s.code})}};p.push(r)},a=0;a<c[1].length;a++)o(a);return this.commonSortDataList(p),p},e.prototype.purchaseEnjoyCard=function(e){var t=this.rechargeProxy.getEnjoyCardInfo(e);t?(t.isMonthCard=!0,this.rechargeProxy.purchase(t,2,String(e),JSON.stringify({uuid:e,activityType:this.code}),{activityType:this.code})):(this.rechargeProxy.getGoodList(),Utils.MsgUtils.addMidMsg("尚未获取月卡信息，请稍后再试"))},e}(t.ActivityCommonListView);t.ActivityEnjoyCardView=e,__reflect(e.prototype,"game.ActivityEnjoyCardView")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.EverydayTurntable,e.FIXED_LAP=5,e.itemAngle=45,e.rotating=!1,e.curIndex=0,e.tableInit=!1,e.skinName="ActivityEverydayTurnTableSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent(),DragonBoneTools.playOnce({effectName:"common_zhuanpandeng_1",parent:this.gp_effect,loop:!0})},e.prototype.updateView=function(e){var o=this,t=this.info;this.tableInit||(t.content.forEach(function(e,t){var i=o["gp_Reward"+t],n=customui.BaseItemFactory.create();n.scaleX=n.scaleY=70/105,n.updateData({reward:e[1][0]}),i.addChild(n)}),this.tableInit=!0);this.blb_times.text=t.data.total.toString();var i=a.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.blb_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(i),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=i--?o.blb_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(i):a.AppFacade.getInstance().hideSubView(a.ActivityMediator.N,a.ActivityMediator.SV.MAIN)},this,1e3)},e.prototype.rotateToIndex=function(e,t){if(!this.rotating){var i=e*this.itemAngle+this.itemAngle/2+360*this.FIXED_LAP;this.rotateToAngle(i,t)}},e.prototype.rotateToAngle=function(e,t,i){var n=this;void 0===i&&(i=5e3);for(var o=[],a=0;a<8;a++){var r=this["gp_Reward"+a];r&&o.push(r)}this.rotating=!0,GameRootLayer.gameLayer().switchTouchEnable(!1);this.gp_roll.rotation=this.gp_roll.rotation%360,egret.Tween.get(this.gp_roll,{onChange:function(){var t=360*(n.FIXED_LAP+1)-n.gp_roll.rotation;o.forEach(function(e){e.rotation=t})},onChangeObj:this}).to({rotation:e},i,function(e){return 1-Math.pow(1-e,3)}).call(function(){n.rotating=!1,GameRootLayer.gameLayer().switchTouchEnable(!0),t&&t()})},e.prototype.activateComponent=function(){var i=this;Utils.ComponentUtils.registerListener(this.btn_roll,egret.TouchEvent.TOUCH_TAP,function(){0<i.info.data.total?Utils.Socket.send("activity","DoCommonOperation",{code:i.code,num:1,id:1}).then(function(e){i.gp_effect.$children[0].visible=!1,DragonBoneTools.playOnce({effectName:"common_zhuanpandeng_2",parent:i.gp_effect,loop:!0});var t=JSON.parse(e.info);i.rotateToIndex(t.rewardId-1,function(){i.info.updateData(t),a.GameMVC.backpackPy.handleClientReward(e.clientReward),i.gp_effect.removeChildAt(1),i.gp_effect.$children[0].visible=!0})}):Utils.MsgUtils.addMidMsg("无剩余抽奖次数")},this),Utils.ComponentUtils.registerListener(this.btn_access,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new n})},this),Utils.ComponentUtils.registerListener(this.btn_guide,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new a.HelpDialog({moduleId:MODULE.Activity+EActivityType.EverydayTurntable})})},this)},e}(a.ActivityCommonView);a.ActivityEverydayTurnTable=e,__reflect(e.prototype,"game.ActivityEverydayTurnTable");var n=function(i){function e(){var e,t=i.call(this)||this;return t.CONFIG=((e={})[1]={name:"loginTimes",max:1,text:"登录游戏（%s/1）",cb:function(){Utils.MsgUtils.addMidMsg("你能点到这个按钮证明程序出问题了")}},e[2]={name:"firstChargeTimes",max:1,text:"首次充值（%s/1）",cb:function(){t.hide(),a.MainJumpConfig.jumpTo(MODULE.Recharge)}},e),t.skinName="ActivityNewTurnTable_AccessPanel",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.updateView()},e.prototype.updateView=function(e){var n=a.GameMVC.activityPy.allActivityData[EActivityType.EverydayTurntable].data,t=function(e){var t=o.CONFIG[e],i=n[t.name];o["lb_"+e].text=t.text.format([i.toString()]),o["img_"+e].visible=i===t.max,o["btn_"+e].visible=i!=t.max,Utils.ComponentUtils.registerListener(o["btn_"+e],egret.TouchEvent.TOUCH_TAP,function(){t.cb()},o)},o=this;for(var i in this.CONFIG)t(i);this.img_3.visible=this.lb_3.visible=this.btn_3.visible=!1},e}(BasePanel);__reflect(n.prototype,"ActivityEverydayTurnTable_AccessPanel")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.ExchangeCode,e.playerProxy=i.AppFacade.getInstance().retrieveProxy(i.PlayerPy.N),e.loginProxy=i.AppFacade.getInstance().retrieveProxy(i.LoginPy.N),Utils.AssetsMgr.loadGroup("group_exchange_code"),e.skinName="ActivityExchangeCodeSkin",e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_exchange_code")},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent(),this.updateTitle()},e.prototype.updateTitle=function(){var e=i.Config.activityConfigs()[this.code];this.actProxy.allActivityData[this.code];e&&this.img_title&&(this.img_title.source=JSON.parse(e.img_title)[0]+"_png"),this.bm_time.text=""},e.prototype.activateComponent=function(){this.btn_exchange.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;""===this.edt_input.text?Utils.MsgUtils.addMidMsg("请输入内容"):0==this.edt_input.text.indexOf("T2019")?Utils.Http.getByUrl(Utils.agentConfig.HttpUnitServer+"/get_AllCode.php"+Utils.Http.decorateParams({status:0,player_id:this.playerProxy.roleVo.playerId,code_id:this.edt_input.text,platform:Utils.agentConfig.AgentCode,area:this.loginProxy.serverSelect.s_id},!0,egret.HttpMethod.GET)).then(function(e){e&&(3===e.code?Utils.Http.toGet({action:"get_code",player_id:t.playerProxy.roleVo.playerId,code_id:t.edt_input.text,platform:Utils.agentConfig.AgentCode,area:t.loginProxy.serverSelect.s_id}).then(function(e){e&&(1===e.success?Utils.Http.getByUrl(Utils.agentConfig.HttpUnitServer+"/get_AllCode.php"+Utils.Http.decorateParams({status:1,player_id:t.playerProxy.roleVo.playerId,code_id:t.edt_input.text,platform:Utils.agentConfig.AgentCode,area:t.loginProxy.serverSelect.s_id},!0,egret.HttpMethod.GET)).then(function(e){}):Utils.MsgUtils.addMidMsg(e.msg),t.edt_input.text="")}):2===e.code&&Utils.MsgUtils.addMidMsg("兑换码已经被使用"))}):Utils.Http.toGet({action:"get_code",player_id:this.playerProxy.roleVo.playerId,code_id:this.edt_input.text,platform:Utils.agentConfig.AgentCode,area:this.loginProxy.serverSelect.s_id}).then(function(e){1===e.success||Utils.MsgUtils.addMidMsg(e.msg),t.edt_input.text=""})},this)},e}(i.ActivityCommonView);i.ActivityExchangeCode=e,__reflect(e.prototype,"game.ActivityExchangeCode")}(game||(game={})),function(a){var i=function(o){function i(){var e=o.call(this)||this;return e.leveldata=[],e.scrollerIndex=0,e.seleceIndex=1,e.code=EActivityType.ExtremeBattle,e.activityProxy=a.AppFacade.getInstance().retrieveProxy(a.ActivityPy.N),Utils.AssetsMgr.loadGroup("group_extreme_challenge"),e.skinName="ActivityExtremeChallengeViewSkin",e}return __extends(i,o),i.prototype.onDestroy=function(){o.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_extreme_challenge")},i.prototype.childrenCreated=function(){var t=this;o.prototype.childrenCreated.call(this),this.width=this.parent.width,this.height=this.parent.height,this.activityVO=this.activityProxy.allActivityData[this.code];var e=JSON.parse(this.activityVO.content);if(this.activityVO&&this.activityVO.data){for(var i in e[1]){var n=e[1][i];n[0]==this.activityVO.data.curCycle&&(this.config=n[1])}this.activityVO.data.passed&&(this.activityVO.data.id=20),this.btn_challenge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),t.activityVO.data.passed)Utils.MsgUtils.addMidMsg("恭喜您已通过");else{var e=5*t.scrollerIndex+t.seleceIndex;t.activityVO.data.id<e+1?Utils.MsgUtils.addMidMsg("请先通关前面的关卡"):t.activityVO.data.id>e+1?Utils.MsgUtils.addMidMsg("已通过该关卡"):(t.CloseView(),t.activityProxy.ChallengeExtremeChallenge())}},this),this.img_nextOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.scrollerIndex++,3<t.scrollerIndex&&(t.scrollerIndex=3),t.updateView({id:t.seleceIndex}),t.updateLevel()},this),this.img_lastOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.scrollerIndex--,t.scrollerIndex<0&&(t.scrollerIndex=0),t.updateView({id:t.seleceIndex}),t.updateLevel()},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.list_level.itemRenderer=r,this.seleceIndex=(this.activityVO.data.id-1)%5,this.scrollerIndex=Math.floor((this.activityVO.data.id-1)/5),this.list_level.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),t.onItemTap(e)},this),this.initTimer(),this.updateView({id:this.seleceIndex}),this.initUIEffect(),this.updateLevel()}},i.prototype.onItemTap=function(e){this.list_level.dataProvider.getItemAt(this.seleceIndex%5).chose=!1,this.updateView({id:e.itemIndex}),this.list_level.dataProvider.getItemAt(this.seleceIndex%5).chose=!0},i.prototype.updateView=function(e){if(e){var t=this.activityProxy.allActivityData[this.code];if(t&&t.data){var i=e.id;if(null==i){i=(this.activityVO.data.id-1)%5,this.updateLevel();var n=this.list_level.dataProvider&&this.list_level.dataProvider.getItemAt(this.seleceIndex%5);n&&(n.chose=!1),this.seleceIndex=i,(n=this.list_level.dataProvider&&this.list_level.dataProvider.getItemAt(this.seleceIndex%5))&&(n.chose=!0)}else this.seleceIndex=i;if(null!=i){var o=5*this.scrollerIndex+i;this.updateCreep(o),this.updateReward(o)}}}},i.prototype.initUIEffect=function(){this.effect?this.effect.animation.play():DragonBoneTools.create("common_zhihuanqian",function(e){this.effect=e,this.effect.x=this.gp_effects.width/2,this.effect.y=this.gp_effects.height-100,this.effect.visible=!0,this.effect.animation.timeScale=1,this.effect.animation.play(),this.gp_effects.addChild(this.effect)},this)},i.prototype.initTimer=function(){var e=this,t=0;if(this.activityProxy.isOpen(this.code)){var i=this.activityProxy.allActivityData[this.code];i&&i.endDt&&(t=(i.endDt-a.GameMgr.getInstance().serverTime())%(24*i.content[0]*60*60))}0!=t&&(this.leftTime=egret.setInterval(function(){e.bitmap_time.text=Utils.TimerManager.getFormatBySecond1(t--)},this,1e3))},i.prototype.updateReward=function(e){this.gp_reward.removeChildren();var t=this.config[e][3];for(var i in t){var n=t[i],o=new customui.BaseItem(20);o.updateData({code:n[1],num:n[2]}),o.scaleX=.8,o.scaleY=.8,this.gp_reward.addChild(o)}},i.prototype.updateCreep=function(e){var t,i=(t=this.config[e][2])[0][0];t.forEach(function(e){e[1]&&(i=e[0])});var n=a.Config.creepConfig()[i];if(n){this.creep_model.update({code:n.heroId});var o=a.Config.allHeroConfig()[n.heroId];this.lb_name.text=o.name,this.img_raceIcon.source=HeroRaceConfig[o.race].raceIcon}},i.prototype.updateLevel=function(){for(var e in this.leveldata=[],this.config){var t=this.config[e];t[0]==this.activityVO.data.id?this.leveldata.push({state:i.state.current,id:t[0],reward:t[3][0],chose:!1,creep:t[2]}):t[0]>this.activityVO.data.id?this.leveldata.push({state:i.state.next,id:t[0],reward:t[3][0],chose:!1,creep:t[2]}):this.leveldata.push({state:i.state.passed,id:t[0],reward:t[3][0],chose:!1,creep:t[2]})}this.activityVO.data.passed&&(this.leveldata[this.leveldata.length-1].state=i.state.passed),this.leveldata[5*this.scrollerIndex+this.seleceIndex].chose=!0,this.leveldata=this.leveldata.slice(5*this.scrollerIndex,5*this.scrollerIndex+5),this.list_level.dataProvider=new eui.ArrayCollection(this.leveldata),0==this.scrollerIndex||2==this.scrollerIndex?(this.img_nextOne.visible=!0,this.img_lastOne.visible=!1):(this.img_nextOne.visible=!1,this.img_lastOne.visible=!0)},i.prototype.CloseView=function(){this.hide(),this.leftTime&&egret.clearInterval(this.leftTime)},i.state={passed:-1,current:0,next:1},i.EXTREMECHALLENGE_PREFIX="EXTREMECHALLENGE_PREFIX",i.EXTREMECHALLENGESKIP_PREFIX="EXTREMECHALLENGE_PREFIX",i}(BasePanel);a.ActivityExtremeChallengeView=i,__reflect(i.prototype,"game.ActivityExtremeChallengeView");var r=function(t){function e(){var e=t.call(this)||this;return e.skinName="ExtremeChallengeListItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){switch(this.data.state){case i.state.passed:UIActionManager.setAbsGrey(this.gp_main,!0),this.img_passed.visible=!0;break;case i.state.current:case i.state.next:UIActionManager.setAbsGrey(this.gp_main,!1),this.img_passed.visible=!1}this.bitmap_level.text=this.data.id,this.setChose(this.data.chose);var t=this.data.creep[0][0];this.data.creep.forEach(function(e){e[1]&&(t=e[0])});a.Config.creepConfig()[t];this.baseitem.updateData({code:this.data.reward[1],num:this.data.reward[2]})},e.prototype.childrenCreated=function(){this.baseitem.touchEnabled=!1},e.prototype.setChose=function(e){this.img_chose.visible=e},e}(eui.ItemRenderer);__reflect(r.prototype,"ListItem")}(game||(game={})),function(_){var e=function(p){function e(){var e=p.call(this)||this;return e.skinName="ActivityFifthOpenServerRecharge",e}return __extends(e,p),e.prototype.childrenCreated=function(){var i=this;p.prototype.childrenCreated.call(this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.btnFun&&i.btnFun()},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this);for(var e=function(e){var t=n["img_icon"+e];t&&t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.onclick(e)},n)},n=this,t=0;t<4;t++)e(t);UIActionManager.addEffect(this.gp_effect,"common_bujibaoxiang01")},e.prototype.onclick=function(e){var t=this.curData.rewards[e],i=t[0],n=t[1],o=_.GeneralConfig.getEntityConfigByCode(i,n);switch(i){case EEntityType.EEntityTypeHero:_.AppFacade.getInstance().showSubView(_.HeroMediator.N,_.HeroMediator.SV.HERO_DETAIL,{code:n});break;default:if(i==EEntityType.EEntityTypeHeroEquip||i==EEntityType.EEntityTypeHeroArtifact||i==EEntityType.EEntityTypeTreasure){var a=void 0;switch(i){case EEntityType.EEntityTypeHeroEquip:var r=_.Config.getHeroEquipUpgradeConfig(n);_.Config.getHeroEquipEnchantConfig(n);a={code:n,entityType:i,exp:0,fightCap:0,level:0,level2:0};break;case EEntityType.EEntityTypeHeroArtifact:r=_.Config.getHeroArtifactUpgradeConfig(n),_.Config.getHeroArtifactUpstarConfig(n);a={code:n,entityType:i,exp:0,fightCap:0,level:0,level2:0};break;case EEntityType.EEntityTypeTreasure:(r=_.Config.getTreasureJewelUpgradeConfig(TreasureJewelType.Atk))&&r.length&&r[r.length-1].level}_.AppFacade.getInstance().showSubView(_.HeroThingMediator.N,_.HeroThingMediator.SV.MAIN,{entityType:i,vo:a,config:o,source:_.HeroThingMainView.VIEW_SOURCE.HANDBOOK})}else PopUpManager.addPopUp({obj:new _.BaseItemDetailView({code:n,type:i,config:o})})}},e.prototype.updateView=function(e){p.prototype.updateView.call(this,e);var t=this.info;if(t&&t.data){var i=this.getDataList(),n=void 0;for(var o in i){var a=i[o];if(a.status==REWARD_STATUS.AVAILABLE||a.status==REWARD_STATUS.GO_RECHARGE){n=a;break}}if(n){this.curData=n;t.data.amount;this.btnFun=function(){n.btnFunc&&n.btnFunc(n)},n.status==REWARD_STATUS.AVAILABLE?(this.img_status.source="mrbj_txt_yidacheng_png",this.img_status.horizontalCenter=0,this.bm_recharge.text="",this.btn_go.label="领取"):(this.img_status.source="mrbj_txt_dqljcz_png",this.img_status.horizontalCenter=-18,this.bm_recharge.text=t.data.amount,this.btn_go.label="充值"),this.lb_desc.text="当日累计充值达到"+n.targetAmount+"元即可领取";for(var r=0;r<4&&n.rewards;r++){var s=n.rewards[r];if(s){var c=_.GeneralConfig.getEntityConfigByCode(s[0],s[1]),l=this["img_icon"+r];l&&(l.source=c.icon+"_png");var h=this["bm_num"+r];h&&(h.text=Utils.MathUtils.formatNumStyle1(s[2]))}}}else this.hide()}else this.hide()},e.prototype.getDataList=function(){var l=this,e=this.info;if(!e||!e.data)return[];var h,t=e.content,p=e.data.amount,d=JSON.parse(e.data.targeted),i=e.data.curCycle||1;for(var n in t[1]){var o=t[1][n];if(o[0]==i){h=o[1];break}}if(!h)return[];var u=[],g=1,a=function(e){var t=h[e],i=t[1],n=t[2],o=t[3]||1,a=REWARD_STATUS.AVAILABLE;-1!=d.indexOf(t[0])?a=REWARD_STATUS.RECEIVED:p<i&&(a=REWARD_STATUS.GO_RECHARGE);var r="累计充值 "+t[1]+" 元可领取";0<=[EActivityType.FourthOpenServerRecharge,EActivityType.FourthOpenServerRecharge1,EActivityType.FourthOpenServerRecharge2,EActivityType.FourthOpenServerRecharge3].indexOf(f.code)&&(r="今日充值任意金额可领取");var s={id:t[0],title:t[1]?r:"免费领取",tips:t[1]?p+"/"+i:"",rewards:n,status:a,targetAmount:i,btnFunc:function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:l.getReward({id:e.id,code:l.code},function(){_.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN)});break;case REWARD_STATUS.GO_RECHARGE:_.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};if(g<o){var c=!0;if(u.forEach(function(e){e.status!=REWARD_STATUS.RECEIVED&&(c=!1)}),!c)return"break";if(!h[parseInt(e)+1])return u.push(s),"break";g=o,u.splice(0,u.length),u.push(s)}else u.push(s)},f=this;for(var r in h){if("break"===a(r))break}return u.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id}),u},e}(_.ActivityCommonPanel);_.ActivityFifthOpenServerRecharge=e,__reflect(e.prototype,"game.ActivityFifthOpenServerRecharge")}(game||(game={})),function(T){var e=function(E){function e(){var e=E.call(this)||this;e.notice_img=[],e.actProxy=T.AppFacade.getInstance().retrieveProxy(T.ActivityPy.N),e.backpackProxy=T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N),e.code=EActivityType.FirstRecharge1,e.curSeleceIndex=void 0,e.index2benImg=["shouchon_btn_6yuan","shouchon_btn_30yuan","shouchon_btn_100yuan","shouchon_btn_200yuan"],Utils.AssetsMgr.destroyGroup("group_first_recharge"),e.skinName="ActivityFirstRechargeSkin";for(var t=0;t<4;t++)e.notice_img.push(new eui.Image);return e}return __extends(e,E),e.prototype.onDestroy=function(){E.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer),T.EventPoint.lastTriggerTime=0,Utils.AssetsMgr.destroyGroup("group_first_recharge")},Object.defineProperty(e.prototype,"info",{get:function(){if(this.code)return this.actProxy.allActivityData[this.code];this.log("没有声明活动code")},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){E.prototype.childrenCreated.call(this),this.activateComponent();for(var e=0;e<3;e++){var t=this["gp_effect"+e];t&&UIActionManager.addEffect(t,"common_kelingqu",{scaleX:.85,scaleY:.85,offectX:-2,offectY:-13})}for(var i=0;i<=3;i++){var n=this.notice_img[i];n.source="_main_m_json.common_img_hongdian";var o=this["btn_"+i];n&&o&&(n.right=20,n.top=15,o.addChild(n)),o.iconDisplay.pixelHitTest=!0}var a=this.info;if(a&&a.data){var r=JSON.parse(a.content),s=JSON.parse(a.data.rechargeTargeted),c=a.data.rewardTargeted,l=a.data.key,h=[];for(i=0;i<=3;i++){var p=REWARD_STATUS.UNAVAILABLE,d=0;for(e=0;e<3;e++){var u=r[e+3*i],g=u[0],f=(u[1],u[2]),_=u[4],m=REWARD_STATUS.UNAVAILABLE;f<=l&&(m=REWARD_STATUS.AVAILABLE),0<=c.indexOf(g)&&(m=REWARD_STATUS.RECEIVED);var y=0;for(var v in s){var T=s[v];T[0]==f&&(y=T[1])}if(y<_&&(m=REWARD_STATUS.UNAVAILABLE),m==REWARD_STATUS.AVAILABLE){p=REWARD_STATUS.AVAILABLE;break}m==REWARD_STATUS.RECEIVED&&d++}3==d&&(p=REWARD_STATUS.RECEIVED),h.push(p)}var C=void 0;for(e=0;e<h.length;e++)if(h[e]==REWARD_STATUS.AVAILABLE){C=e;break}for(e=0;e<h.length&&null==C;e++)if(h[e]==REWARD_STATUS.UNAVAILABLE){C=e;break}this.onBtnTap(C||0)}},e.prototype.updateNotice=function(){var e=this.info;if(e&&e.data)for(var t=JSON.parse(e.content),i=(JSON.parse(e.data.rechargeTargeted),e.data.rewardTargeted,e.data.key,0);i<=3;i++){for(var n=!1,o=this.notice_img[i],a=0;a<3;a++){var r=t[3*i+a],s=r[0],c=(r[1],r[2]),l=r[4],h=e.data.key,p=e.data.rewardTargeted,d=JSON.parse(e.data.rechargeTargeted),u=REWARD_STATUS.UNAVAILABLE;c<=h&&(u=REWARD_STATUS.AVAILABLE),0<=p.indexOf(s)&&(u=REWARD_STATUS.RECEIVED);var g=0;for(var f in d){var _=d[f];_[0]==c&&(g=_[1])}if(g<l&&(u=REWARD_STATUS.UNAVAILABLE),u==REWARD_STATUS.AVAILABLE){n=!0;break}}o&&(o.visible=n)}},e.prototype.updateView=function(e){var t=this.info;if(t&&t.data){var i=JSON.parse(t.content),n=JSON.parse(t.data.rechargeTargeted),o=t.data.rewardTargeted,a=t.data.key;200<=a?this.gp_has.visible=!1:this.lb_cur.text=a+"元";var r=i[3*this.curSeleceIndex];this.img_bg.source=r[5]+"_png",this.img_title.source=r[6]+"_png",this.heroModel.update({model:r[7],isStatic:!0}),r[8]?(this.heroModel1.update({model:r[8],isStatic:!0}),this.heroModel1.visible=!0):this.heroModel1.visible=!1;for(var s=0;s<3;s++){var c=i[s+3*this.curSeleceIndex],l=c[0],h=c[1],p=c[2],d=c[4],u=REWARD_STATUS.UNAVAILABLE;p<=a&&(u=REWARD_STATUS.AVAILABLE),0<=o.indexOf(l)&&(u=REWARD_STATUS.RECEIVED);var g=0;for(var f in n){var _=n[f];_[0]==p&&(g=_[1])}g<d&&(u=REWARD_STATUS.UNAVAILABLE);var m=this["gp_effect"+s],y=this["gp_reward"+s],v=this["img_hasget"+s];switch(y&&(y.removeChildren(),T.GameMgr.getInstance().CommonGpAddReward(y,h,.8)),v&&(v.visible=u==REWARD_STATUS.RECEIVED),u){case REWARD_STATUS.UNAVAILABLE:m&&(m.touchEnabled=!1,m.visible=!1,m.touchChildren=!0),y&&UIActionManager.setGrey(y,!1);break;case REWARD_STATUS.AVAILABLE:m&&(m.touchEnabled=!0,m.visible=!0,m.touchChildren=!1),y&&UIActionManager.setGrey(y,!1);break;case REWARD_STATUS.RECEIVED:m&&(m.touchEnabled=!1,m.visible=!1,m.touchChildren=!0),y&&UIActionManager.setGrey(y,!0)}this.btn_go.visible=!g}this.updateNotice()}},e.prototype.onBtnTap=function(e){var t;this.curSeleceIndex!=e&&((t=this["btn_"+this.curSeleceIndex])&&(t.icon=this.index2benImg[this.curSeleceIndex]+"1_png"),this.curSeleceIndex=e,(t=this["btn_"+this.curSeleceIndex])&&(t.icon=this.index2benImg[this.curSeleceIndex]+"2_png"),this.updateView())},e.prototype.activateComponent=function(){for(var u=this,e=function(e){var t=i["btn_"+e];t&&t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.onBtnTap(e)},i)},i=this,t=0;t<=3;t++)e(t);this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){T.MainJumpConfig.jumpTo(MODULE.Recharge)},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.hide()},this);for(var n=function(d){var e=o["gp_effect"+d];e&&e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=u.info;if(e&&e.data){var t=JSON.parse(e.content)[3*u.curSeleceIndex+d],i=t[0],n=(t[1],t[2]),o=t[4],a=e.data.key,r=e.data.rewardTargeted,s=JSON.parse(e.data.rechargeTargeted),c=REWARD_STATUS.UNAVAILABLE;n<=a&&(c=REWARD_STATUS.AVAILABLE),0<=r.indexOf(i)&&(c=REWARD_STATUS.RECEIVED);var l=0;for(var h in s){var p=s[h];p[0]==n&&(l=p[1])}switch(l<o&&(c=REWARD_STATUS.UNAVAILABLE),c){case REWARD_STATUS.UNAVAILABLE:T.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.AVAILABLE:Utils.Socket.send("activity","GetFirstRechargeReward",{id:3*u.curSeleceIndex+d+1,code:u.code}).then(function(e){T.GameMVC.activityPy.updateData_View_Reward(EActivityType.FirstRecharge1,e),T.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN)});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}},o)},o=this,a=0;a<3;a++)n(a)},e}(BasePanel);T.ActivityFirstRechargeView=e,__reflect(e.prototype,"game.ActivityFirstRechargeView")}(game||(game={})),function(e){var t=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.code=EActivityType.FlashCapsuleHigh,e}return __extends(e,t),e.prototype.getDataList=function(){var r=this,e=this.info,t=e.content,s=e.data.targeted,c=e.data.purchaseTime,i=e.data.day,l=[];for(var n in t){var o=t[n];if(o[0]==i){var h=o[1],a=function(e){var t=h[e],i=t[0],n=t[1],o=t[2],a=REWARD_STATUS.UNAVAILABLE;s.some(function(e){return e.id==t[0]&&0<e.time})?a=REWARD_STATUS.RECEIVED:n<=c&&(a=REWARD_STATUS.AVAILABLE),l.push({title:"扭蛋"+n+"次",tips:c+"/"+n,rewards:o,status:a,btnFunc:function(){r.getReward({id:i})}})};for(var p in h)a(p);break}}return l.sort(function(e,t){return e.status-t.status}),l},e}(e.ActivityCommonListView);e.ActivityFlashCapsule=t,__reflect(t.prototype,"game.ActivityFlashCapsule")}(game||(game={})),function(s){var e=function(t){function e(){var e=t.call(this)||this;return e.curSelectIndex=0,e.code=EActivityType.FriendShare,e.playerProxy=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N),e.LEVEL_GUILD=[30,60],e.skinName="ActivityFriendShare",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.dp=new eui.ArrayCollection,this.list_item.dataProvider=this.dp,this.activateComponent(),this.sl_items.scrollPolicyH=eui.ScrollPolicy.OFF,this.initTabbar(),this.updateView(),this.addNotice()},e.prototype.initList1=function(){this.list_item.itemRenderer=n;var e=new eui.VerticalLayout;this.list_item.layout=e},e.prototype.initList2=function(){this.list_item.itemRenderer=i;var e=new eui.TileLayout;e.requestedColumnCount=3,this.list_item.layout=e},e.prototype.initTabbar=function(){this.tb_bottom.itemRendererSkinName="FriendTabBarItemSkin",Utils.SDKMgr.getPerformConfig(2016)?this.tb_bottom.dataProvider=new eui.ArrayCollection([{up:"_btn_yq_m_json.common_yeqian_meirifenxiang_0",down:"_btn_yq_m_json.common_yeqian_meirifenxiang_1",text:""},{up:"_btn_yq_m_json.common_yeqian_leijifenxiang_0",down:"_btn_yq_m_json.common_yeqian_leijifenxiang_1",text:""}]):this.tb_bottom.dataProvider=new eui.ArrayCollection([{up:"_btn_yq_m_json.common_yeqian_meirifenxiang_0",down:"_btn_yq_m_json.common_yeqian_meirifenxiang_1",text:""},{up:"_btn_yq_m_json.common_yeqian_leijifenxiang_0",down:"_btn_yq_m_json.common_yeqian_leijifenxiang_1",text:""},{up:"_btn_yq_m_json.common_yeqian_yaoqinghaoyou_0",down:"_btn_yq_m_json.common_yeqian_yaoqinghaoyou_1",text:""},{up:"_btn_yq_m_json.common_yeqian_haoyouchongji_0",down:"_btn_yq_m_json.common_yeqian_haoyouchongji_1",text:""},{up:"_btn_yq_m_json.common_yeqian_fanlihongbao_0",down:"_btn_yq_m_json.common_yeqian_fanlihongbao_1",text:""}]),this.tb_bottom.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this)},e.prototype.onBarItemTap=function(e){e.itemIndex!=this.curSelectIndex&&(this.curSelectIndex=e.itemIndex,this.updateView())},e.prototype.updateView=function(e){switch(e&&null!=e.index&&(this.curSelectIndex=e.index),this.updateTitle(),this.gp_list.visible=!1,this.gp_redPocket.visible=!1,this.curSelectIndex){case 0:case 1:this.gp_list.visible=!0,this.initList1(),this.updateList01(),Utils.SDKMgr.getPerformConfig(27)?this.btn_share.label="邀请游戏":this.btn_share.label="分享游戏";break;case 2:case 3:this.gp_list.visible=!0,this.initList2(),this.updateList23(),this.btn_share.label="邀请好友";break;case 4:this.gp_redPocket.visible=!0,this.updateRedPockets(),this.btn_share.label="邀请好友"}0==this.curSelectIndex||1==this.curSelectIndex?NoticeManager.addNoticeListener(NT.FRIEND_SHARE_DAY_FIRST_SHARE,this.btn_share.$children[0],this,{percentX:130/162,percentY:0}):NoticeManager.removeNoticeListener(NT.FRIEND_SHARE_DAY_FIRST_SHARE)},e.prototype.updateTitle=function(){var a=this;this.bm_tips.text="",this.lb_todayShare.visible=!1;var e=function(){if(a.info&&a.info.data){a.lb_todayShare.visible=!0;var e=JSON.parse(a.info.content),n=a.info.data.keyList;a.info.data.targeted;0==a.curSelectIndex&&(n=a.info.data.todayKeyList,a.info.data.todayTargeted);var t=0;for(var i in e){e[i][4]==TaskResetType.Daily&&t++}var o=function(e){for(var t in n){var i=n[t];if(i.taskType==e)return i.key}return 0}(TaskSubType.FriendShare);Utils.SDKMgr.getPerformConfig(27)?a.lb_todayShare.textFlow=[{style:{textColor:16777215},text:"今日邀请次数"},{style:{textColor:3211008},text:"("+o+"/"+t+")"}]:a.lb_todayShare.textFlow=[{style:{textColor:16777215},text:"今日分享次数"},{style:{textColor:3211008},text:"("+o+"/"+t+")"}]}};switch(this.curSelectIndex){case 0:Utils.SDKMgr.getPerformConfig(27)?this.img_title.source="hyfx_img_meirifenxiang_awy_png":this.img_title.source="hyfx_img_meirifenxiang_png",e();break;case 1:Utils.SDKMgr.getPerformConfig(27)?this.img_title.source="hyfx_img_leijifenxiang_awy_png":this.img_title.source="hyfx_img_leijifenxiang_png",e();break;case 2:this.img_title.source="hyfx_img_yaoqinghaoyou_png",this.bm_tips.horizontalCenter=-25.5,this.bm_tips.y=107.44,this.bm_tips.text=this.LEVEL_GUILD[0].toString();break;case 3:this.img_title.source="hyfx_img_yaoqinghaoyou_png",this.bm_tips.horizontalCenter=-25.5,this.bm_tips.y=107.44,this.bm_tips.text=this.LEVEL_GUILD[1].toString();break;case 4:this.img_title.source="hyfx_img_fanlihongbao_png",this.bm_tips.horizontalCenter=-104.5,this.bm_tips.y=181.66,this.bm_tips.text=(Number(s.Config.constConfig().FriendRelationRedBagRatio.constValue)/100).toString()}},e.prototype.updateList01=function(){var h=this;if(this.info&&this.info.data){var p=JSON.parse(this.info.content),d=[],u=this.info.data.keyList,g=this.info.data.targeted,f="累计分享第%s次奖励";Utils.SDKMgr.getPerformConfig(27)&&(f="累计邀请第%s次奖励"),0==this.curSelectIndex&&(u=this.info.data.todayKeyList,g=this.info.data.todayTargeted,f=Utils.SDKMgr.getPerformConfig(27)?"邀请第%s次奖励":"分享第%s次奖励");var _={},e=function(e){var t=p[e],i=t[4];if(i==TaskResetType.Daily&&0==m.curSelectIndex||i==TaskResetType.None&&1==m.curSelectIndex){var n=t[0],o=t[1],a=t[2],r=t[3],s=REWARD_STATUS.UNAVAILABLE,c=_[r]||function(e){for(var t in u){var i=u[t];if(i.taskType==e)return _[e]=i.key,i.key}}(r)||0;o<=c&&(s=REWARD_STATUS.AVAILABLE),0<=g.indexOf(n)&&(s=REWARD_STATUS.RECEIVED);var l={id:n,status:s,rewards:a,tips:c+"/"+o,title:f.format([o]),btnFunc:function(){switch(s){case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.AVAILABLE:h.getReward({code:h.code,id:n},function(){h.updateView()});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};d.push(l)}},m=this;for(var t in p)e(t);this.commonSortDataList(d),this.dp.removeAll(),d.forEach(function(e){h.dp.addItem(e)})}},e.prototype.updateList23=function(){var e,t=this,i=s.Config.relationRewardConfigs(),n=99999,o=0;for(var a in this.dp.removeAll(),2==this.curSelectIndex?n=this.LEVEL_GUILD[0]:3==this.curSelectIndex&&(n=this.LEVEL_GUILD[1]),e=this.actProxy.downRelationInfos.filter(function(e){return e.level>=n}),i){var r=i[a];r.level==n&&this.dp.addItem({c:r,vo:e[o++],isGet:-1!=this.actProxy.releationTargeted.indexOf(r.id)})}this.once(egret.Event.ENTER_FRAME,function(){t.list_item.scrollV=0},this)},e.prototype.dismissRedPocketAction=function(e){UIActionManager.fadeIn(this.gp_red_pocket_item,500,function(){e&&e()},!0)},e.prototype.showRedPocketAction=function(e){UIActionManager.fadeIn(this.gp_red_pocket_item,500,function(){e&&e()})},e.prototype.updateRedPockets=function(){var i=this;if(0==this.actProxy.relationRedBagInfos.length)this.gp_empty.visible=!0,this.gp_red_pocket_item.visible=!1;else{var n=this.actProxy.relationRedBagInfos[0];this.playerProxy.GetPublicPlayerBaseInfo([n.playerId],function(e,t){i.lb_name.text=""+t[n.playerId].baseInfo.name,i.gp_empty.visible=!1,i.gp_red_pocket_item.visible=!0,i.showRedPocketAction()})}},e.prototype.doShare=function(){var t=this,e=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N),i=Utils.agentConfig.isHunFu?"":Utils.agentConfig.channelName;i&&""!=i||(i=Utils.agentConfig.AgentCode),Utils.SDKMgr.share({recommendId:e.roleVo.playerId,recommendPlatform:i,sceneId:WeChatTargetType.Share2Friend},function(e){0==e&&Utils.Socket.send("activity","DoCommonOperation",{code:t.code,num:1}).then(function(e){t.actProxy.updateData_View_Reward(t.code,e),Utils.LocalStorageUtil.setTodayVaild("FriendShare")})})},e.prototype.activateComponent=function(){var e=this;Utils.SDKMgr.getPerformConfig(27)?this.CommonDaTanChuKuang.blb_title.text="邀请好友":this.CommonDaTanChuKuang.blb_title.text="分享好友",this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.btn_share.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.doShare()},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeShare})},this),this.btn_open.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;0<this.actProxy.relationRedBagInfos.length?this.actProxy.GetRelationRedBag(RelationType.Recommend,this.actProxy.relationRedBagInfos[0].uuid,function(){e.dismissRedPocketAction(function(){e.updateRedPockets()})}):Utils.MsgUtils.addMidMsg("当前没有红包")},this)},e.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.COMMON_SHOP[ShopType.ShopTypeShare],this.btn_shop.$children[0],this,BTN_ICON_NOTICE_POS);for(var e=0;e<5;e++)NoticeManager.addNoticeListener(NT.FRIEND_SHARE_REWARD[e],this.tb_bottom,this,{percentX:(85*e+60)/506,percentY:30/84})},e}(s.ActivityCommonPanel);s.ActivityFriendShare=e,__reflect(e.prototype,"game.ActivityFriendShare");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityFriendShareItem2",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;s.AppFacade.getInstance().retrieveProxy(s.ActivityPy.N).GetRelationReward(RelationType.Recommend,this.data.c.id,function(){e.data.isGet=!0,e.updateStatus()})},this)},e.prototype.updateStatus=function(){this.data.vo&&!this.data.isGet?(this.img_wdc.visible=!1,this.btn_get.touchEnabled=!0,UIActionManager.setAbsGrey(this.btn_get,!1),this.btn_get.skinName="skins.ButtonSkinYellow2",this.btn_get.label="领 取",this.img_wdc.visible=!1):this.data.vo&&this.data.isGet?(this.img_wdc.visible=!1,this.btn_get.touchEnabled=!1,UIActionManager.setAbsGrey(this.btn_get,!0),this.btn_get.skinName="skins.ButtonSkinSure",this.btn_get.label="已领取",this.img_wdc.visible=!1):(this.btn_get.touchEnabled=!1,UIActionManager.setAbsGrey(this.btn_get,!0),this.btn_get.label="",this.img_wdc.visible=!0)},e.prototype.dataChanged=function(){var e=this;this.lb_title.text="第"+(this.itemIndex+1)+"位好友",this.data.vo?(this.playerhead.visible=!0,this.gp_empty.visible=!1,this.playerhead.updateData({vo:this.data.vo}),this.playerhead.addTapEvent(function(){s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N);e.data.vo&&s.AppFacade.getInstance().showSubView(s.FriendMediator.N,s.FriendMediator.SV.INFO,{playerId:e.data.vo.playerId})})):(this.playerhead.visible=!1,this.gp_empty.visible=!0,this.playerhead.updateData());var t=JSON.parse(this.data.c.reward)[0];this.img_reward.source=ResourceUtils.png(s.GeneralConfig.getEntityConfigByCode(t[0],t[1]).icon),this.lb_reward.text="奖励:"+t[2],this.updateStatus()},e}(eui.ItemRenderer);__reflect(i.prototype,"ActivityFriendShareItem2");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityFriendShareItem1",e}return __extends(e,t),e}(s.ActivityCommonListItem);__reflect(n.prototype,"ActivityFriendShareItem1")}(game||(game={})),function(s){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityGashaponView",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.sl_root.scrollPolicyV=eui.ScrollPolicy.OFF,this.activateComponent()},e.prototype.updateView=function(e){this.code=e&&e.activityType||e&&e.code||this.code;var t=this.info;if(t&&t.data){var i=t.content,n=i[0],o=i[2],a=i[3],r=i[4];for(var s in this.heroModel.update({model:r,isStatic:!0}),this.gp_top.removeChildren(),a){var c=a[s],l=customui.BaseItemFactory.create();l.updateData({code:c[0][1]}),l.scaleX=l.scaleY=.95,this.gp_top.addChild(l)}this.costIcon1.updateItem({cost:n[0],style:CommonIconStyle.RIGHT}),this.costIcon10.updateItem({cost:o[0],style:CommonIconStyle.RIGHT}),this.CommonResourceBar.updateBar(n),this.cost1=n[0],this.cost10=o[0]}},e.prototype.doGashapon=function(t){var o=this;GameRootLayer.gameLayer().switchTouchEnable(!1),Utils.Socket.send("activity","DoCommonOperation",{code:this.code,num:t}).then(function(e){o.actProxy.allActivityData[o.code]&&o.actProxy.allActivityData[o.code].updateData(e.info),GameRootLayer.gameLayer().switchTouchEnable(!0),s.AppFacade.getInstance().showSubView(s.HeroMediator.N,s.HeroMediator.SV.COMMON_GACHA_RESULT,{cost1:o.cost1,cost10:o.cost10,freeTimes:0,rewards:e.clientReward.heros,gacha_1_cb:function(){o.doGashapon(1)},gacha_10_cb:function(){o.doGashapon(3)},rewardLength:t,choukaEnd_cb:function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},showSpecialEffect:function(e){var t=o.info;if(!t||!t.data)return!1;var i=t.content[3];for(var n in i)if(e==i[n][0][1]&&i[n][0][3])return!0;return!1}})}).catch(function(e){GameRootLayer.gameLayer().switchTouchEnable(!0)})},e.prototype.activateComponent=function(){var i=this;this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.doGashapon(1)},this),this.btn_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.doGashapon(3)},this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.info;if(e&&e.data){var t=e.data.records;0<t.length?PopUpManager.addPopUp({obj:new n({records:t})}):Utils.MsgUtils.addMidMsg("当前无中奖记录")}},this)},e}(s.ActivityCommonView);s.ActivityGashaponView=e,__reflect(e.prototype,"game.ActivityGashaponView");var n=function(i){function e(e){var t=i.call(this)||this;return t.skinName="RecordPanel",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF,this.updateView()},e.prototype.updateView=function(){if(this.params){var e=this.params.records;e.sort(function(e,t){return t.dt-e.dt}),this.lb_title.text=this.params.title||"记录";s.Config.allHeroConfig();for(var t in this.gp_root.removeChildren(),e){var i=e[t],n=[];if(i.textFlow)n=i.textFlow;else{var o=i.rewards[0],a=s.GeneralConfig.getEntityConfigByCode(o.type,o.code);a&&(n=[{text:i.name,style:{textColor:16777215}},{text:" 获得 ",style:{textColor:16777215}},{text:a.name,style:{textColor:16777215}},{text:" ×"+o.num,style:{textColor:16777215}}])}var r=new eui.Label;r.size=22,r.textFlow=n,this.gp_root.addChild(r)}}},e}(BasePanel);s.RecordPanel=n,__reflect(n.prototype,"game.RecordPanel")}(game||(game={})),function(c){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.ShouCangYouLi,e.skinName="ActivityGZGZHViewSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent(),Utils.LocalStorageUtil.setTodayVaild("HAS_CLICK_GZGZH_BTN")},e.prototype.updateView=function(e){if(Utils.SDKMgr.getPerformConfig(20001)){var t=this.img_bg.parent;if(!t)return;t.verticalCenter=0,this.img_bg.source=Utils.SDKMgr.getPerformConfig(200002)||"scbz_img_shoucang_qqxyx_png",this.img_bg.y=110;var i=new eui.Group,n=new eui.HorizontalLayout;n.horizontalAlign="center",i.layout=n,i.width=400,i.height=111,i.horizontalCenter=-50,i.y=516;var o=c.Config.operationConfig()[6];c.GameMVC.activityPy.operationHasExec(6);c.GameMgr.getInstance().CommonGpAddReward(i,JSON.parse(o.reward)),t.addChild(i);var a=new eui.Image;a.source="xinshou_img_shouzhi_png",a.y=0,a.x=570,Utils.DeviceUtils.setLiuHaiPingAdapter(a);var r=a.y;egret.Tween.get(a,{loop:!0}).to({y:r+30},1e3).to({y:r},1e3),this.addChild(a);var s=new eui.Button;s.label="领取",s.skinName="skins.ButtonSkinYellow",s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){!getUrlKV().fromQuickEntrance?Utils.MsgUtils.addMidMsg("请大退后从快捷入口进入"):c.GameMVC.activityPy.operationHasExec(6)?Utils.MsgUtils.addMidMsg("奖励已领取"):(c.GameMVC.activityPy.getOperationReward(6),Utils.MsgUtils.addMidMsg("奖励已发送至邮箱"))},this),s.x=190,s.y=631,t.addChild(s)}else RES.hasRes(Utils.SDKMgr.getPerformConfig(200002))&&(this.img_bg.source=Utils.SDKMgr.getPerformConfig(200002))},e.prototype.activateComponent=function(){var e=this;Utils.ComponentUtils.registerListener(this.btn_close,egret.TouchEvent.TOUCH_TAP,function(){e.hide()}),Utils.SDKMgr.getPerformConfig(200005)&&(this.btn_copy.visible=!0,Utils.ComponentUtils.registerListener(this.btn_copy,egret.TouchEvent.TOUCH_TAP,function(){Utils.SDKMgr.copyToClipBoard(Utils.SDKMgr.getPerformConfig(200005))}))},e}(BasePanel);c.ActivityGZGZHView=e,__reflect(e.prototype,"game.ActivityGZGZHView")}(game||(game={})),function(I){var t,e=function(e){function a(){return e.call(this)||this}return __extends(a,e),a.prototype.updateView=function(e){if(e&&e.activityType){this.code=e.activityType,this.updateTitle();var t=this.getDataList();switch(this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(t):this.list_itemList.dataProvider=new eui.ArrayCollection(t),this.code){case EActivityType.ConsumeDiamondTask:this.actProxy.isOpen(EActivityType.NewZoneConsumeRank)&&(this.btn_left.visible=!0,this.btn_left.icon="_btn_lb_m_json.common_icon_paihangbang",this.btn_left.label="排行榜",this.btn_left.width=72,this.btn_left.height=85,this.btn_left.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.btn_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){I.AppFacade.getInstance().showSubView(I.RankMediator.N,I.RankMediator.SV.COMMON,{module:"ActivityNewZoneConsumeRank"})},this))}}},a.prototype.getDataList=function(){var u=this,e=this.info;if(!e||!e.data)return[];var g=[],f=JSON.parse(e.content),_=e.data.targeted;_[0]||(_=[]);var r=e.data.keyList,m={},y=function(e){var t=0;for(var i in r){var n=(r[i].taskType+"").split(""),o=r[i].key,a=(e+"").split("");0==Number(a[a.length-4])?Number(a[a.length-5])==Number(n[n.length-5])&&(t+=o):Number(a[a.length-5])==Number(n[n.length-5])&&Number(a[a.length-4])==Number(n[n.length-4])&&(t+=o)}return t},t=I.Config.activityConfigs()[this.code],v=t&&t.rotation||1,T=0,C=9999999,i=0,n=0;if(1!=v){for(var o=f.length/v,a=1;a<=v;a++){var s=f[b=a*o-1],c=(s[0],(s[1]+"").split("")),l=Number(c[c.length-1]),h=s[3],p=this.getTypeKey(h,s);if(!(l<=(m[p]||y(s[1])))){C=l;break}if(i++,!(_.length>b)){C=l;break}n++,T=l}v<=n&&(n=v-1,T=f[f.length-o-1]&&f[f.length-o-1][1]||0,C=f[f.length-1][1])}var d=function(e){var t=f[e],i=t[0],n=(t[1]+"").split(""),o=Number(n[n.length-1]);if(1!=v&&(o<=T||C<o))return"continue";var a=t[2],r=t[3],s=t[4],c=E.getTypeKey(r,t),l=m[c]||y(t[1]),h=REWARD_STATUS.CANBUY;o<=l&&(h=REWARD_STATUS.AVAILABLE),0<=_.indexOf(i)&&(h=REWARD_STATUS.RECEIVED);var p=E.getTitle(r,t);E.code==EActivityType.ConsumeDiamondTask&&h==REWARD_STATUS.CANBUY&&(h=REWARD_STATUS.UNAVAILABLE);var d={id:i,key:o,title:p,status:h,rewards:a,tips:l-T+"/"+(o-T),btnText:h==REWARD_STATUS.CANBUY?"前往":"",btnFunc:function(e){switch(h){case REWARD_STATUS.AVAILABLE:u.getReward({code:u.code,id:i});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.CANBUY:s&&I.MainJumpConfig.jumpTo(s);break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件")}}};g.push(d)},E=this;for(var b in f)d(b);return this.commonSortDataList(g),t&&1!=t.rotation&&0!=t.rotation&&(this.lb_round.visible=!0,this.lb_round.text="完成次数("+i+"/"+v+")"),g},a.prototype.getTitle=function(e,t){switch(this.code){case EActivityType.HeroArtifactUpStarTask:var i=(t[1]+"").split(""),n=Number(i[i.length-4]),o="";return 0!=n&&(o=COLOR_CONFIG[n].name),(a.TaskType_2_Title[e]||"").format([Number(i[i.length-1]),o,Math.floor(t[1]/1e4)]);default:return(I.ActivityCommonTaskView.TaskType_2_Title[e]||"").format([t[1]%1e4])}},a.prototype.getMax=function(e){switch(this.code){case EActivityType.ConsumeDiamondTask:return e;default:return e%1e4}},a.prototype.getTypeKey=function(e,t){var i=e;switch(this.code){case EActivityType.GuildCollectTask:case EActivityType.GuildCollectTask1:case EActivityType.HeroArtifactUpStarTask:i=t[1]-t[1]%1e4}return i},a.TaskType_2_Title=((t={})[TaskSubType.HeroArtifactUpStarNum]="任意%s个%s圣物升到%s星",t),a}(I.ActivityCommonListView);I.ActivityHeroArtifactUpTaskView=e,__reflect(e.prototype,"game.ActivityHeroArtifactUpTaskView")}(game||(game={})),function(p){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.HeroConvert,e.selectedUuids={},e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.initList=function(){this.list_itemList.itemRenderer=i},e.prototype.getDataList=function(){var s=this,n=this.info,a=JSON.parse(n.content),c=[],e=function(e){var t=a[e],r=t[0],o={id:r,slots:[],rewards:t[2],curNum:0,maxNum:t[3],view:l,btnFunc:function(){if(s.checkSatisfy(r)){var i=[],n=s.selectedUuids[r],e=function(t){n[t].forEach(function(e){i.push({slotNum:Number(t),uuid:e})})};for(var t in n)e(t);var o=[];i.forEach(function(e){o.push(e.uuid)});var a=p.GameMVC.backpackPy.checkMultiTeamTips(o);a?p.GameMgr.getInstance().showCommonTipsWin({commonTips:"选中的英雄中"+a.name+"在"+a.teamModuleName+"上阵，是否作为材料消耗？",clickCB:function(e){1==e.type&&s.getReward({id:r,code:s.code,uuidInfos:i},function(){for(var e in n){n[e].splice(0),s.updateView()}})}}):s.getReward({id:r,code:s.code,uuidInfos:i},function(){for(var e in n){n[e].splice(0),s.updateView()}})}else Utils.MsgUtils.addMidMsg("条件未满足")}};l.selectedUuids[r]||(l.selectedUuids[r]={}),t[1].forEach(function(e,t){var i=t+1;s.selectedUuids[r][i]||(s.selectedUuids[r][i]=[]);var n={require:e,selected:s.selectedUuids[r][i],slotNum:i};o.slots.push(n)}),o.slots.sort(function(e,t){var i=e.require[0],n=t.require[0];return i!=n?i-n:e.slotNum-t.slotNum});var i=0;n.data.targeted.some(function(e){if(e.id==r)return i=e.num,!0}),o.curNum=i,c.push(o)},l=this;for(var t in a)e(t);return c.sort(function(e,t){var i=e.curNum>=e.maxNum;return i!=t.curNum>=t.maxNum?i?1:-1:e.id-t.id}),c},e.prototype.checkSatisfy=function(e){var t=this.info.content,i=!0,n=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N);for(var o in t){var a=t[o];if(a[0]==e){var r=a[1];for(var s in r){var c=r[s];if(1==c[0]){if(!n.checkEnough(c[1],!1)){i=!1;break}}else if(2==c[0]&&this.selectedUuids[e][Number(s)+1].length<c[4]){i=!1;break}}break}}return i},e.prototype.updateSelectedUuid=function(e,t,i){this.selectedUuids[e]||(this.selectedUuids[e]={});var n=this.selectedUuids[e];n[t]||(n[t]=[]),n[t].splice(0,n[t].length,i)},e.prototype.isUuidChosen=function(e){var t=!1;for(var i in this.selectedUuids){var n=this.selectedUuids[i];for(var o in n){if(-1<n[o].indexOf(e)){t=!0;break}}}return t},e}(p.ActivityCommonListView);p.ActivityHeroConvertView=e,__reflect(e.prototype,"game.ActivityHeroConvertView");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityHeroConvertView_Item",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.TouchUtils.addTouchListener(this.btn_operate,function(){e.data.btnFunc&&e.data.btnFunc()})},e.prototype.dataChanged=function(){var s=this,e=this.data.slots;this.gp_slots.removeChildren(),e.forEach(function(e,t){if(0!=t){var i=new eui.Image("common_img_jia_png");s.gp_slots.addChild(i)}var n=s.data.curNum<s.data.maxNum,o=new c({info:e,available:n}),r=e.require,a=e.selected;1==r[0]||2==r[0]&&n&&Utils.TouchUtils.addTouchListener(o,function(){PopUpManager.addPopUp({obj:new p.CommonChosePanel({getInfos:function(){var e=p.AppFacade.getInstance().retrieveProxy(p.HeroPy.N),t=e.allHeroByUuid,i={};for(var n in t){var o=t[n],a=o.config;e.heroUuid22Pos[n]||0!=r[1]&&a.race!=r[1]||0!=r[2]&&a.profession!=r[2]||0!=r[3]&&a.initStar!=r[3]||(i[o.uuid]=o)}return i},type:EEntityType.EEntityTypeHero,uniNum:!0,checkFull:function(e){return e.length>=r[4]},selectUuids:a,title:"请选择英雄"}),closeCB:function(e){s.data.view.updateView()}})}),s.gp_slots.addChild(o)}),this.gp_slots.addChild(new eui.Image("newactivity_img_denghao_png"));var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,t.updateData({reward:this.data.rewards[0]}),this.gp_slots.addChild(t);var i=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N).getInfoByCode(this.data.rewards[0][1]);this.lb_title.text="兑换"+i.info.name,this.lb_tips.text=this.data.curNum+"/"+this.data.maxNum;var n=this.data.curNum>=this.data.maxNum;this.btn_operate.enabled=!n,UIActionManager.setAbsGrey(this.btn_operate,n),n?(this.btn_operate.skinName="skins.ButtonSkinSure",this.btn_operate.label="已兑换",this.btn_operate.scaleX=this.btn_operate.scaleY=1):(this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.label="兑换",this.btn_operate.scaleX=this.btn_operate.scaleY=.8)},e}(eui.ItemRenderer);__reflect(i.prototype,"ActivityHeroConvertView_Item");var c=function(i){function e(e){var t=i.call(this)||this;return t.data=e,t.skinName="ActivityHeroConvertView_HeroChooseItem",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseItem.addChild(this.baseItem),UIActionManager.fadeBlink(this.img_jia,!0,!1,1e3),this.updateItem(this.data)},e.prototype.findRandomHero=function(e){var t=p.Config.allHeroConfig();for(var i in t){var n=t[i];if(!(0!=e[1]&&n.race!=e[1]||0!=e[2]&&n.profession!=e[2]||0!=e[3]&&n.initStar!=e[3]))return n}},e.prototype.updateItem=function(e){var t=e.info.require,i=e.info.selected;if(this.img_jia.visible=!1,1==t[0])this.baseItem.updateData({reward:t[1][0]}),p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N).checkEnough(t[1],!1)?UIActionManager.setAbsGrey(this.gp_main,!1):UIActionManager.setAbsGrey(this.gp_main,!0);else if(2==t[0]){var n=this.findRandomHero(t);this.baseItem.updateData({code:n.code});var o=n.initStar,a=1;if([[0,3],[4,4],[5,5],[6,8],[9,9],[10,15]].forEach(function(e,t){o>=e[0]&&o<=e[1]&&(a=t+1)}),this.baseItem.img_icon.source="beibao_img_sptb_"+a+"_png",e.available&&(i.length>=t[4]?UIActionManager.setGrey(this.gp_main,!1):UIActionManager.setGrey(this.gp_main,!0),i.length<t[4])){var r=p.AppFacade.getInstance().retrieveProxy(p.HeroPy.N),s=r.allHeroByUuid,c=0;for(var l in s){var h=s[l].config;r.heroUuid22Pos[l]||0!=t[1]&&h.race!=t[1]||0!=t[2]&&h.profession!=t[2]||0!=t[3]&&h.initStar!=t[3]||c++}this.img_jia.visible=c>=t[4]}}},e}(eui.Component);__reflect(c.prototype,"ActivityHeroConvertView_HeroChooseItem")}(game||(game={})),function(c){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.HeroRollback,e.heroPy=c.AppFacade.getInstance().retrieveProxy(c.HeroPy.N),e.skinName="ActivityHeroRollBackSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent(),DragonBoneTools.playOnce({effectName:"common_zhihuanqian",parent:this.gp_effect,y:this.gp_effect.height,loop:!0}),egret.Tween.get(this.img_add,{loop:!0}).to({alpha:.4},1e3).to({alpha:1},1e3)},e.prototype.updateView=function(e){if(this.timer||(this.remainingDt=c.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime(),this.updateRemainingTime(),this.timer=egret.setInterval(this.updateRemainingTime,this,1e3)),this.curUuid){this.gp_name.visible=!0,this.btn_oper.enabled=!0,this.img_add.visible=!1;var t=this.heroPy.allHeroByUuid[this.curUuid];this.heroModel.update({code:t.code,isStatic:!0}),this.lb_name.text=t.config.name,this.img_raceIcon.source=HeroRaceConfig[t.config.race].raceIconBig;var i=t.starLevel,n=c.GeneralConfig.getHeroStarInfo(i);if(this.gp_stars.removeChildren(),n.stage<4)for(var o=0;o<n.num;o++){var a=new eui.Image(n.src);this.gp_stars.addChild(a),a.scaleX=a.scaleY=.5}else this.gp_stars.addChild(new customui.HighStarLevelIcon({num:n.num,scale:.5}));var r=c.Config.heroRollBackConfig(),s=JSON.parse(r[t.starLevel].costs);this.icon_cost.visible=!0,this.icon_cost.updateItem({cost:s[0],style:CommonIconStyle.RIGHT,needShowHave:!0})}else this.gp_name.visible=!1,this.icon_cost.visible=!1,this.btn_oper.enabled=!1,this.img_add.visible=!0,this.heroModel.update({})},e.prototype.updateRemainingTime=function(){0<this.remainingDt?this.blb_time.text="结束倒计时:"+Utils.TimerManager.getFormatBySecond1(this.remainingDt--):c.AppFacade.getInstance().hideSubView(c.ActivityMediator.N,c.ActivityMediator.SV.MAIN)},e.prototype.activateComponent=function(){var t=this;Utils.TouchUtils.addTouchListener(this.heroModel,function(){c.AppFacade.getInstance().showSubView(c.HeroMediator.N,c.HeroMediator.SV.SELECT,{type:c.HeroSelectPanel.SELECTFORM.HERO_ROLLBACK,btnFunc:function(e){t.curUuid=e,t.updateView(),DragonBoneTools.playOnce({effectName:"common_zhihuanfangru",parent:t.gp_effect,y:t.gp_effect.height})}})}),Utils.TouchUtils.addTouchListener(this.btn_oper,function(){c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.TIPS_DIALOG,{commonTips:"请确定是否重生该英雄，重生后可返还所有本体、培养资源以及若干9或10星通用升星材料。",clickCB:function(e){e.type&&t.heroPy.HeroRollback({uuid:t.curUuid,cb:function(e){DragonBoneTools.playOnce({effectName:"common_zhihuanchenggong",parent:t.gp_effect,y:t.gp_effect.height,doneCB:function(){t.curUuid=void 0,t.updateView(),e()}})}})}})}),Utils.TouchUtils.addTouchListener(this.btn_guide,function(){PopUpManager.addPopUp({obj:new c.HelpDialog({moduleId:MODULE.HeroRollback})})}),Utils.TouchUtils.addTouchListener(this.btn_preview,function(){t.curUuid?t.heroPy.HeroRollbackPreview({uuid:t.curUuid}):Utils.MsgUtils.addMidMsg("未选择英雄")})},e}(c.ActivityCommonView);c.ActivityHeroRollBackView=e,__reflect(e.prototype,"game.ActivityHeroRollBackView")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.InvitationCode,e.py=i.AppFacade.getInstance().retrieveProxy(i.ActivityPy.N),e.skinName="ActivityInviteCodeSkin",e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this)},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_exchange.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""!=this.edt_input.text?this.exchangeNum():Utils.MsgUtils.addMidMsg("请正确输入兑换码")},this),Utils.DeviceUtils.IsNative&&this.edt_myCode_mic?(this.btn_copy.visible=this.lb_myCode.visible=!1,this.edt_myCode_mic.visible=!0,this.edt_myCode_mic.text=this.lb_myCode.text,this.edt_myCode_mic.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){e.edt_myCode_mic.text=e.lb_myCode.text},this)):this.btn_copy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""!=this.lb_myCode.text&&(Utils.DeviceUtils.IsNative?Utils.MsgUtils.addMidMsg("复制失败，请手动输入"):Utils.SDKMgr.copyToClipBoard(this.lb_myCode.text,this.copyCb.bind(this)))},this),this.btn_send.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(""!=this.lb_myCode.text){var e=Number(Utils.SDKMgr.getPerformConfig(35))||10,t=Number(Utils.LocalStorageUtil.getItem("LAST_SEND_YAOQINGMA_DT"))||0;if(Math.floor((Utils.TimerManager.getServerTime()-t)/60)>=e)i.AppFacade.getInstance().retrieveProxy(i.MainPy.N).SendMessage(EChatChannelType.SameServer,this.lb_myCode.text,0,function(){Utils.MsgUtils.addMidMsg("发送成功"),Utils.LocalStorageUtil.setItem("LAST_SEND_YAOQINGMA_DT",Utils.TimerManager.getServerTime().toString())},EChatSendCheckType.None,"");else Utils.MsgUtils.addMidMsg("邀请码"+e+"分钟可发送一次，暂时无法发送")}},this),this.heroModel.update({model:"hero_038_03",isStatic:!0}),this.py.GetInvitationCodeInfo(EActivityType.InvitationCode,this.updateView.bind(this))},e.prototype.updateView=function(e){var t=this.info;t.content&&null!=t.content&&(this.lb_text1.text="*角色等级≤"+t.content[3]+"级可使用该邀请码。",this.lb_text2.text="*该邀请码可使用"+t.content[2][0]+"次，可分享给其他角色使用。",this.lb_text3.text="*邀请码每次被1名玩家使用后，可获得神秘奖励，以",this.lb_text4.text=" 及增加福利回馈转盘次数（邮件发放）。"),e&&(this.lb_myCode.text=e.invitationCode,this.edt_myCode_mic&&(this.edt_myCode_mic.text=this.lb_myCode.text))},e.prototype.exchangeNum=function(){this.py.UseInvitationCode({code:EActivityType.InvitationCode,invitationCode:this.edt_input.text},this.clearView.bind(this))},e.prototype.clearView=function(){this.edt_input.text="",Utils.MsgUtils.addMidMsg("兑换成功"),this.hide()},e.prototype.copyCb=function(){Utils.MsgUtils.addMidMsg("复制成功")},e}(i.ActivityCommonPanel);i.ActivityInviteCode=e,__reflect(e.prototype,"game.ActivityInviteCode")}(game||(game={})),function(T){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.ItemGifts,e}return __extends(e,t),e.prototype.initList=function(){this.list_itemList.itemRenderer=i,this.costBar=new customui.CommonResourceBar,this.costBar.x=-200,this.costBar.top=215,this.gp_title.addChild(this.costBar)},e.prototype.getDataList=function(){var g=this,e=this.info;if(!e||!e.data)return[];var l,f=e.data.targeted,t=e.content,i=e.data.curCycle||1;for(var n in t[1]){var o=t[1][n];if(o[0]==i){l=o[1];break}}if(!l)return[];for(var _=T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N),m=[],y=!1,a=function(e){var t=l[e],i=t[0],h=t[1],p=t[2],d=t[3],n=t[4],o=REWARD_STATUS.UNAVAILABLE,u=0;for(var a in f){var r=f[a];if(r.id==i){u=r.num;break}}y||(y=!0,v.costBar.updateBar(p)),d<=u?o=REWARD_STATUS.RECEIVED:_.checkEnough(p,!1)&&(o=REWARD_STATUS.AVAILABLE);var s=T.GeneralConfig.getEntityConfigByCode(h[0][0],h[0][1]),c={id:i,title:"兑换"+(s&&s.name),tips:u+"/"+d,rewards:h,costs:p,status:o,discount:n,btnFunc:function(t){switch(t.status){case REWARD_STATUS.AVAILABLE:var e=T.AppFacade.getInstance().retrieveMediator(T.ShopyMediator.N),i=[],n=9999;for(var o in p){var a=p[o],r=T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N).getInfoByCode(a[1]),s=Math.floor(r.haveNum/a[2]);s<n&&(n=s,i=a)}var c=n,l=T.GeneralConfig.getEntityConfigByCode(h[0][0],h[0][1]).name;e.showSubView(T.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:h,costs:[i],countFun:function(e){return{unit:i[2],total:i[2]*e}},name:l,limit:"[5,"+(d+1)+"]"},maxCount:d-u<c?d-u:c,buyNum:u+1,btnLabel:"兑换",costTip:"兑换消耗",limitTip:"兑换次数",doneCB:function(e){g.getReward({code:g.code,giftCode:t.id,num:e.num||0})}});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已换取")}}};m.push(c)},v=this,r=0;r<l.length;r++)a(r);return m.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id}),this.code!=EActivityType.CollectWords&&this.code!=EActivityType.ItemGifts13&&this.code!=EActivityType.ItemGifts15||(this.costBar.visible=!1),m},e}(T.ActivityCommonListView);T.ActivityItemGifts=e,__reflect(e.prototype,"game.ActivityItemGifts");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityCommonListItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc(this.data)},this);var e=new eui.HorizontalLayout;e.verticalAlign="middle",e.gap=0,this.gp_rewards.layout=e},e.prototype.dataChanged=function(){var o=this,e=this.data;switch(this.img_bg.source=e.bg||this.img_bg.source,this.lb_title.text=e.title||"",this.lb_tips.text=e.tips||"",this.data.status){case REWARD_STATUS.UNAVAILABLE:this.btn_operate.label="兑换",UIActionManager.setGrey(this.btn_operate,!0),this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.scaleX=this.btn_operate.scaleY=.8;break;case REWARD_STATUS.RECEIVED:this.btn_operate.label="已领取",this.btn_operate.skinName="skins.ButtonSkinSure",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=1;break;default:this.btn_operate.label="兑换",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.scaleX=this.btn_operate.scaleY=.8}this.gp_rewards.removeChildren();for(var t=JSON.parse(e.costs),i=T.AppFacade.getInstance().retrieveProxy(T.BackpackPy.N),n=0;n<t.length;n++){if(0<n){var a=new eui.Image("common_img_jia_png");this.gp_rewards.addChild(a)}var r=customui.BaseItemFactory.create();r.scaleX=r.scaleY=.7,r.updateData({reward:t[n]});var s=i.getInfoByCode(t[n][1],!1).haveNum;r.blb_num.text=s+"/"+t[n][2],s>=t[n][2]?UIActionManager.setAbsGrey(r,!1):UIActionManager.setAbsGrey(r,!0),this.gp_rewards.addChild(r)}var c=new eui.Image("newactivity_img_denghao_png");if(this.gp_rewards.addChild(c),JSON.parse(e.rewards).forEach(function(e,t){var i=new eui.Group;i.width=i.height=73.5;var n=customui.BaseItemFactory.create();n.scaleX=n.scaleY=.7,n.updateData({reward:e}),e[3]?UIActionManager.addEffect(i,"common_jiban",{scaleX:1,scaleY:1,childIndex:1}):UIActionManager.hideEffect(i),i.addChildAt(n,0),o.gp_rewards.addChild(i)}),this.btnFunc=e.btnFunc,this.data.status==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn_operate,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-1}):UIActionManager.hideEffect(this.btn_operate),this.data.discount){if(this.bm_discount)this.bm_discount.parent.visible=!0;else{var l=new eui.Group;l.left=432,l.top=-22,this.addChild(l);var h=new eui.Image;h.source="newactivity_img_zhekou_png",l.addChild(h),this.bm_discount=new eui.BitmapLabel,this.bm_discount.right=67,this.bm_discount.top=32,this.bm_discount.font="main_vip_fnt",this.bm_discount.rotation=-10,l.addChild(this.bm_discount)}this.bm_discount.text=this.data.discount/10+""}else this.bm_discount&&(this.bm_discount.parent.visible=!1)},e}(eui.ItemRenderer);__reflect(i.prototype,"ActivityExchangeListItem")}(game||(game={})),function(n){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.LevelReward,Utils.AssetsMgr.loadGroup("group_level_reward"),e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_level_reward")},e.prototype.getDataList=function(){for(var r=this,e=this.info,s=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N).playerInfoVO.level,c=e.data.targeted,l=e.content,h=[],t=function(e){var t=l[e],i=t[0],n=t[1],o=REWARD_STATUS.AVAILABLE;s<i?o=REWARD_STATUS.UNAVAILABLE:c.some(function(e){return e.id==i&&0<e.num})&&(o=REWARD_STATUS.RECEIVED);var a={id:e+1,title:"等级达到"+i+"级",tips:s+"/"+i,rewards:n,status:o,btnFunc:function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:r.getReward({targetLevel:i});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};h.push(a)},i=0;i<l.length;i++)t(i);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id}),h},e}(n.ActivityCommonListView);n.ActivityLevelReward=e,__reflect(e.prototype,"game.ActivityLevelReward")}(game||(game={})),function(o){var e=function(t){function e(){var e=t.call(this)||this;return e.FIXED_LAP=5,e.itemAngle=45,e.rotating=!1,e.curIndex=0,e.returnData=void 0,e.skinName="ActivityLuckyRotateViewSkin",e.code=EActivityType.LuckyRotate,e}return __extends(e,t),e.prototype.childrenCreated=function(){var n=this;t.prototype.childrenCreated.call(this),this.gp_rotate1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=n.info;if(e&&e.data){var t=JSON.parse(e.content)[0][0];o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N).checkEnough(t)?Utils.Socket.send("activity","LuckyRotateRotate",{index:1,code:n.code}).then(function(e){n.returnData=e,n.actProxy.allActivityData[n.code].updateData(e.info),n.handleReward()}):Utils.MsgUtils.addMidMsg("道具不足")}},this),this.gp_rotate10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=n.info;if(e&&e.data){var t=JSON.parse(e.content)[0][1];o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N).checkEnough(t)?Utils.Socket.send("activity","LuckyRotateRotate",{index:2,code:n.code}).then(function(e){n.returnData=e,n.actProxy.allActivityData[n.code].updateData(e.info),n.handleReward()}):Utils.MsgUtils.addMidMsg("道具不足")}},this),this.gp_rotate1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){n.gp_rotate1.scaleX=n.gp_rotate1.scaleY=.9},this),this.gp_rotate1.addEventListener(egret.TouchEvent.TOUCH_END,function(){n.gp_rotate1.scaleX=n.gp_rotate1.scaleY=1},this),this.gp_rotate1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){n.gp_rotate1.scaleX=n.gp_rotate1.scaleY=1},this),this.gp_rotate10.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){n.gp_rotate10.scaleX=n.gp_rotate10.scaleY=.9},this),this.gp_rotate10.addEventListener(egret.TouchEvent.TOUCH_END,function(){n.gp_rotate10.scaleX=n.gp_rotate10.scaleY=1},this),this.gp_rotate10.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){n.gp_rotate10.scaleX=n.gp_rotate10.scaleY=1},this),this.btn_buyRefreshTime.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=n.info;if(e&&e.data){var t=JSON.parse(e.content)[1][1],i=function(e){Utils.Socket.send("activity","LuckyRotateRefresh",{isFree:e}).then(function(e){n.actProxy.allActivityData[n.code].updateData(e.info),n.updateView()})};0<e.data.cFreeRefreshTimes?o.GameMgr.getInstance().showCommonTipsWin({costTips:"消耗免费次数进行刷新商品吗？",cost:[],clickCB:function(e){1==e.type&&i.call(n,!0)}}):o.GameMgr.getInstance().showCommonTipsWin({costTips:"购买一次刷新次数",cost:t,source:"ACTIVITY_LUCKROTATE",cb:!0,clickCB:function(e){1==e.type&&i.call(n,!1)}})}},this),this.btn_buyRefreshTime.btn_oppr.skinName="skins.ButtonSkinBlue"},e.prototype.updateView=function(e){var c=this;this.code=e&&e.activityType||e&&e.code||this.code;var t=this.info;if(t&&t.data){var l=JSON.parse(t.content),i=JSON.parse(t.data.itemList),h=t.data.targeted;if(i.forEach(function(e,t){var i,n=e[0],o=e[1],a=l[2][n-1],r=a[3][o-1][1][0],s=c["gp_Reward"+t];s&&!s.$children[0]?((i=customui.BaseItemFactory.create()).updateData({reward:r}),i.scaleX=i.scaleY=70/105,s.addChild(i)):(i=s.$children[0]).updateData({reward:r});a[1]||-1==h.indexOf(n)?UIActionManager.setGrey(s,!1):UIActionManager.setGrey(s)}),this.nextFreeTimer&&egret.clearInterval(this.nextFreeTimer),t.data.nFreeRefreshDt){var n=t.data.nFreeRefreshDt-Utils.TimerManager.getServerTime();this.bm_nextFreeTime.text=""+Utils.TimerManager.getFormatBySecond1(n--),this.nextFreeTimer=egret.setInterval(function(){n<0?(c.actProxy.GetActivityInfo(EActivityType.LuckyRotate),egret.clearInterval(c.nextFreeTimer),c.nextFreeTimer=void 0):c.bm_nextFreeTime.text=""+Utils.TimerManager.getFormatBySecond1(n--)},this,1e3),this.bm_nextFreeTime.visible=this.lb_nextFreeTime.visible=!0}else this.bm_nextFreeTime.visible=this.lb_nextFreeTime.visible=!1;if(this.rotateTimer&&egret.clearInterval(this.rotateTimer),0<t.data.cFreeRefreshTimes)this.btn_buyRefreshTime.updateData({text:"免费刷新"});else{var o=l[1][1][0];this.btn_buyRefreshTime.updateData({cost:o,text:"刷新"})}this.CommonResourceBar.updateBar({costs:l[0][0],width:165}),this.CommonIconWithNum1.updateItem({cost:l[0][0][0]}),this.CommonIconWithNum10.updateItem({cost:l[0][1][0]}),this.updateTitle()}},e.prototype.handleReward=function(){var e=this,t=this.returnData;t&&this.rotateTo(t.poolCodes[0]-1,function(){o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N).handleClientReward(t.showRewards,2),e.updateView()})},e.prototype.rotateTo=function(e,t,i){var n=this;if(!this.rotating){for(var o=[],a=0;a<8;a++){var r=this["gp_Reward"+a];r&&o.push(r)}this.gp_roll.rotation=this.gp_roll.rotation%360;var s=e*this.itemAngle+this.itemAngle/2+360*this.FIXED_LAP;this.rotating=!0;GameRootLayer.gameLayer().switchTouchEnable(!1),egret.Tween.get(this.gp_roll,{onChange:function(){o.forEach(function(e){e.rotation=360*(n.FIXED_LAP+1)-n.gp_roll.rotation})},onChangeObj:this}).to({rotation:s},5e3,function(e){return 1-Math.pow(1-e,3)}).call(function(){GameRootLayer.gameLayer().switchTouchEnable(!0),t&&t.call(i),n.rotating=!1})}},e.prototype.updateTitle=function(){var e=this,t=o.Config.activityConfigs()[this.code],i=this.actProxy.allActivityData[this.code];if(t&&(this.img_title.source=JSON.parse(t.img_title)[0]+"_png"),i){var n=i.endDt-Utils.TimerManager.getServerTime();this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(n),this.rotateTimer&&egret.clearInterval(this.rotateTimer),this.rotateTimer=egret.setInterval(function(){0<=--n&&(e.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(n))},this,1e3)}},e.prototype.onDestroy=function(){this.rotateTimer&&egret.clearInterval(this.rotateTimer),this.nextFreeTimer&&egret.clearInterval(this.nextFreeTimer)},e}(o.ActivityCommonView);o.ActivityLuckyRotateView=e,__reflect(e.prototype,"game.ActivityLuckyRotateView")}(game||(game={})),function(p){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.MonthCard,e.rechargeProxy=p.AppFacade.getInstance().retrieveProxy(p.RechargePy.N),Utils.AssetsMgr.loadGroup("group_month_card"),e.skinName="ActivityMonthCardSkin",e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_month_card")},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent()},e.prototype.purchaseMonthCard=function(){var e=this.rechargeProxy.getMonthCardInfo();e?(e.isMonthCard=!0,this.rechargeProxy.purchase(e)):(this.rechargeProxy.getGoodList(),Utils.MsgUtils.addMidMsg("尚未获取月卡信息，请稍后再试"))},e.prototype.purchaseWholelifeard=function(){var e=this.rechargeProxy.getWholeLifeCardInfo();e?(e.isMonthCard=!0,this.rechargeProxy.purchase(e)):(this.rechargeProxy.getGoodList(),Utils.MsgUtils.addMidMsg("尚未获取月卡信息，请稍后再试"))},e.prototype.updateView=function(e){this.updateMonthCard(),this.updateWholeLifeCard()},e.prototype.updateMonthCard=function(){var e=this.info,t=e.data.day,i=e.data.giftFlag,n=JSON.parse(e.content);this.bm_rewardInstant1.text=n[2][0][2],this.bm_rewardEveryday1.text=n[3][0][2];var o=!1;for(var a in UIActionManager.setGrey(this.btn_purchase1,!1),t<=0?(this.btn_purchase1.label="购买",this.btn_purchase1.enabled=!0,this.bm_time1.text="",this.btn_purchase1.visible=!0):i?(o=!0,this.bm_time1.text="剩余天数:"+t+"天",this.btn_purchase1.visible=!1,UIActionManager.setGrey(this.btn_purchase1,!0)):(this.btn_purchase1.label="领取",this.btn_purchase1.enabled=!0,UIActionManager.addEffect(this.btn_purchase1,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2})),this.gp_reward0.removeChildren(),n[2]){var r=n[2][a],s=new eui.Group,c=customui.BaseItemFactory.create();if(c.scaleX=c.scaleY=.8,s.addChild(c),o){var l=new eui.Image;l.source="xyzp_img_yilingqu_png",l.horizontalCenter=l.verticalCenter=0,s.addChild(l),UIActionManager.setGrey(c,!0)}c.updateData({reward:r}),this.gp_reward0.addChild(s)}},e.prototype.updateWholeLifeCard=function(){var e=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N).playerInfoVO.playerVip.vipLevel||1,t=p.Config.VIPUpgradeConfig()[e],i=JSON.parse(t.wholeLifeCardEmailRewards);this.bm_rewardEveryday2.text=i[0][2];var n=this.actProxy.allActivityData[EActivityType.WholeLifeCard],o=JSON.parse(n.content);this.bm_rewardInstant2.text=o[1][0][2];var a=!1;(UIActionManager.hideEffect(this.btn_purchase2),UIActionManager.setGrey(this.btn_purchase2,!1),n&&n.data&&n.data.hasPurchased)?n.data.giftFlag?(this.btn_purchase2.label="",this.btn_purchase2.skinName="skins.ButtonSkinSure",this.btn_purchase2.label="已领取",this.btn_purchase2.enabled=!1,UIActionManager.setGrey(this.btn_purchase2,!0),a=!0):(this.btn_purchase2.label="领取",this.btn_purchase2.enabled=!0,UIActionManager.addEffect(this.btn_purchase2,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2})):(this.btn_purchase2.label="",this.btn_purchase2.scaleX=this.btn_purchase2.scaleY=1,this.btn_purchase2.skinName="skins.ButtonSkinYellow",this.btn_purchase2.label="购买");for(var r in this.gp_reward1.removeChildren(),o[1]){var s=o[1][r],c=new eui.Group,l=customui.BaseItemFactory.create();if(l.scaleX=l.scaleY=.8,c.addChild(l),a){var h=new eui.Image;h.source="xyzp_img_yilingqu_png",h.horizontalCenter=h.verticalCenter=0,c.addChild(h),UIActionManager.setGrey(l,!0)}l.updateData({reward:s}),this.gp_reward1.addChild(c)}},e.prototype.activateComponent=function(){this.btn_purchase1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.info.data.day<=0?this.purchaseMonthCard():this.info.data.giftFlag?Utils.MsgUtils.addMidMsg("已领取"):this.getReward({})},this),this.btn_purchase2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this,i=this.actProxy.allActivityData[EActivityType.WholeLifeCard];i&&i.data&&i.data.hasPurchased?i.data.giftFlag?Utils.MsgUtils.addMidMsg("已领取"):Utils.Socket.send("activity","GetCommonReward",{code:EActivityType.WholeLifeCard,id:0}).then(function(e){i.updateData(e.info),t.backpackProxy.handleClientReward(e.clientReward),t.updateView()}):this.purchaseWholelifeard()},this)},e}(p.ActivityCommonView);p.ActivityMonthCard=e,__reflect(e.prototype,"game.ActivityMonthCard")}(game||(game={})),function(o){var e=function(n){function e(){var e=n.call(this)||this;return e.rechargeProxy=o.AppFacade.getInstance().retrieveProxy(o.RechargePy.N),Utils.AssetsMgr.loadGroup("group_enjoy_card"),e.skinName="ActivityNewGrowFund",e}return __extends(e,n),e.prototype.onDestroy=function(){n.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_enjoy_card")},e.prototype.childrenCreated=function(){var e=this;n.prototype.childrenCreated.call(this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.purchaseGrowFund(e.code)},this)},e.prototype.initList=function(){this.list_itemList.itemRenderer=o.ActivityCommonListItem,this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF},e.prototype.updateView=function(e){n.prototype.updateView.call(this,e);var t=this.info;if(t&&t.data)if(t.data.buy){JSON.parse(t.content);this.btn_buy.skinName="skins.ButtonSkinSure",this.btn_buy.label="已购买",UIActionManager.setGrey(this.btn_buy,!1),this.btn_buy.scaleX=this.btn_buy.scaleY=1,this.btn_buy.touchEnabled=!1}else{var i=this.rechargeProxy.getGrowFund(this.code);i&&(this.btn_buy.label=i.price+"元"),this.btn_buy.touchEnabled=!0}},e.prototype.getDataList=function(){var r=this,e=this.info;if(e&&e.data){for(var s=JSON.parse(e.content),c=e.data.targeted,l=(e.data.buy,[]),h=o.GameMVC.playerPy.playerInfoVO.level,t=function(e){var t=s[1][e],i=t[0],n=t[1],o=REWARD_STATUS.AVAILABLE;0<=c.indexOf(i)?o=REWARD_STATUS.RECEIVED:h<i&&(o=REWARD_STATUS.UNAVAILABLE);var a={num:e,id:i,rewards:n,status:o,title:"等级达到"+i+"级可领取",btnFunc:function(){r.getReward({id:i,code:r.code})}};l.push(a)},i=0;i<s[1].length;i++)t(i);return this.commonSortDataList(l),l}},e.prototype.purchaseGrowFund=function(e){var t=this.rechargeProxy.getGrowFund(e);t?this.rechargeProxy.purchase(t,2,String(e),JSON.stringify({uuid:e,activityType:this.code}),{activityType:this.code}):(this.rechargeProxy.getGoodList(),Utils.MsgUtils.addMidMsg("尚未获取成长基金信息，请稍后再试"))},e}(o.ActivityCommonListView);o.ActivityNewGrowFund=e,__reflect(e.prototype,"game.ActivityNewGrowFund")}(game||(game={})),function(p){var e=function(h){function e(){var e=h.call(this)||this;return e.skillNames=["actSkill","posSkill1","posSkill2","posSkill3","normalSkill"],e.hasInit=!1,e.chosenPosi=[[49,600],[139,600],[228,600],[316,600]],e.skinName="ActivityNewHeroShow",e}return __extends(e,h),e.prototype.updateView=function(e){var o=this;if(h.prototype.updateView.call(this,e),!this.hasInit){var t=this.info;if(t&&t.data){var i=JSON.parse(t.content),n=i[2];this.img_bg.source=i[0]+"_png";var a=p.Config.allHeroConfig()[n];if(a){for(var r=function(t){var i=a[s.skillNames[t]],e=s["skillItem"+t];if(e&&(e.updateItem({code:i}),e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=p.Config.skillBaseConfig()[i];e&&(o.lb_skillName.text=e.name,o.lb_skillDesc.text=e.desc),o.img_chosen.x=o.chosenPosi[t][0]||0,o.img_chosen.y=o.chosenPosi[t][1]||0},s)),0==t){var n=p.Config.skillBaseConfig()[i];n&&(s.lb_skillName.text=n.name,s.lb_skillDesc.text=n.desc),s.img_chosen.x=s.chosenPosi[t][0]||0,s.img_chosen.y=s.chosenPosi[t][1]||0}},s=this,c=0;c<this.skillNames.length;c++)r(c);var l=i[3];MovieClipTools.create(l,function(e){e&&(e.x=this.sl_root.width/2,e.y=this.sl_root.height/2,e.scaleX=this.sl_root.width/e.width,e.scaleY=this.sl_root.height/e.height,e.animation.play(l,-1),this.gp_effect.addChild(e))},this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){p.MainJumpConfig.jumpTo(i[1])},this),this.updateTime(),this.hasInit=!0}else Utils.MsgUtils.addMidMsg("找不到英雄配置")}}},e.prototype.updateTime=function(){var e=this;this.timer&&egret.clearInterval(this.timer);var t=p.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text="结束倒计时:"+Utils.TimerManager.getFormatBySecond2(t),this.timer=egret.setInterval(function(){--t<0?e.updateTime():e.bm_time.text="结束倒计时:"+Utils.TimerManager.getFormatBySecond2(t)},this,1e3)},e}(p.ActivityCommonView);p.ActivityNewHeroShow=e,__reflect(e.prototype,"game.ActivityNewHeroShow")}(game||(game={})),function(v){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curIndex=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.img_last=new eui.Image,this.img_last.source="common_btn_jiantou_png",this.img_last.left=0,this.img_last.scaleX=-1,this.img_last.verticalCenter=160,this.gp_main.addChild(this.img_last),this.img_last.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.curIndex--,e.updateView()},this),this.img_next=new eui.Image,this.img_next.source="common_btn_jiantou_png",this.img_next.right=0,this.img_next.scaleX=1,this.img_next.verticalCenter=160,this.gp_main.addChild(this.img_next),this.img_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.curIndex++,e.updateView()},this)},e.prototype.initList=function(){this.list_itemList.itemRenderer=i,this.costBar=new customui.CommonResourceBar,this.costBar.x=-200,this.costBar.top=215,this.gp_title.addChild(this.costBar);var e=new eui.TileLayout;e.horizontalAlign=egret.HorizontalAlign.LEFT,e.columnAlign=eui.ColumnAlign.JUSTIFY_USING_WIDTH,e.requestedColumnCount=3,e.horizontalGap=-130,e.verticalGap=35,e.paddingTop=80,e.paddingLeft=120,e.paddingRight=-120,this.list_itemList.layout=e;var t=new eui.Image;t.source="shangdian_img_guizi_png",t.horizontalCenter=0,t.y=271,t.scaleX=720/629,t.scaleY=754/628,this.gp_title.parent.addChildAt(t,1)},e.prototype.getDataList=function(){var d=this,e=this.info;if(!e||!e.data)return[];var u,g=e.data.targeted,t=e.content,i=e.data.curCycle||1;for(var n in t[1]){var o=t[1][n];if(o[0]==i){u=o[1];break}}if(!u)return[];for(var f=v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N),_=[],m=!1,a=function(e){var t=u[e],i=t[0],a=t[1],r=t[2],s=t[3],n=REWARD_STATUS.UNAVAILABLE,c=0;for(var o in g){var l=g[o];if(l.id==i){c=l.num;break}}m||(m=!0,y.costBar.updateBar(r)),s<=c?n=REWARD_STATUS.RECEIVED:f.checkEnough(r,!1)&&(n=REWARD_STATUS.AVAILABLE);var h=v.GeneralConfig.getEntityConfigByCode(a[0][0],a[0][1]),p={id:i,title:"兑换"+(h&&h.name),tips:c+"/"+s,buyTimes:s,hasBuy:c,rewards:a,costs:r,status:n,btnFunc:function(t){switch(t.status){case REWARD_STATUS.AVAILABLE:var e=v.AppFacade.getInstance().retrieveMediator(v.ShopyMediator.N),i=v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N).getInfoByCode(r[0][1]),n=Math.floor(i.haveNum/r[0][2]),o=v.GeneralConfig.getEntityConfigByCode(a[0][0],a[0][1]).name;e.showSubView(v.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:a,costs:r,countFun:function(e){return{unit:r[0][2],total:r[0][2]*e}},name:o,limit:"[5,"+(s+1)+"]"},maxCount:s-c<n?s-c:n,buyNum:c+1,btnLabel:"兑换",costTip:"兑换消耗",limitTip:"兑换次数",doneCB:function(e){d.getReward({code:d.code,giftCode:t.id,num:e.num||0})}});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已换取")}}};_.push(p)},y=this,r=0;r<u.length;r++)a(r);return _.sort(function(e,t){return e.id-t.id}),_.length>9*(this.curIndex+1)?this.img_next.visible=!0:this.img_next.visible=!1,0<this.curIndex?this.img_last.visible=!0:this.img_last.visible=!1,_=_.slice(9*this.curIndex,9*this.curIndex+9)},e}(v.ActivityCommonListView);v.ActivityNewItemGifts=e,__reflect(e.prototype,"game.ActivityNewItemGifts");var i=function(t){function e(){var e=t.call(this)||this;return e.shopProxy=v.AppFacade.getInstance().retrieveProxy(v.ShopPy.N),e.backpackProxy=v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N),e.unlock=!0,e.skinName="ShopUIItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.baseItem=customui.BaseItemFactory.create(),this.gp_baseitem.addChildAt(this.baseItem,0),this.activateComponent(),this.blb_price.visible=!0,this.img_costIcon.visible=!0,this.scaleX=.85,this.scaleY=.85;var e=new eui.Image;e.horizontalCenter=0,e.verticalCenter=-50,e.scaleX=e.scaleY=1/this.scaleX,e.source="shangdian_img_guangxiao_png",this.addChildAt(e,0)},e.prototype.activateComponent=function(){this.btn_purchase.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc(this.data)},this)},e.prototype.dataChanged=function(){var e=this.data;this.btnFunc=e.btnFunc;var t=JSON.parse(e.rewards)[0];this.backpackProxy.getInfoByTypeCodeNum(t[0],t[1],t[2]);this.baseItem.updateData({type:t[0],code:t[1],num:t[2]});var i=this.data.hasBuy,n=e.buyTimes;this.leftNum=n-i,this.leftNum<=0?(UIActionManager.setGrey(this.btn_purchase),UIActionManager.setGrey(this.gp_baseitem),this.img_buyok.visible=!0):(UIActionManager.setGrey(this.btn_purchase,!1),UIActionManager.setGrey(this.gp_baseitem,!1),this.img_buyok.visible=!1),this.img_onlyOne.visible=1==n,1==e.discountDisplay?this.gp_discount.visible=!1:this.gp_discount.visible=1==n,this.cost=JSON.parse(e.costs)[0];var o=this.cost[2];this.price=100*o/100,this.blb_price.text=""+this.price;var a=this.backpackProxy.getInfoByTypeCodeNum(this.cost[0],this.cost[1],this.cost[2]);a&&a.info&&(this.img_costIcon.source=ResourceUtils.png(a.info.icon))},e}(eui.ItemRenderer);__reflect(i.prototype,"ActiviteNewItemGiftsItem")}(game||(game={})),function(y){var e=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initList=function(){this.list_itemList.itemRenderer=i,this.gp_costs=new eui.Group;var e=new eui.HorizontalLayout;e.gap=15,this.gp_costs.layout=e,this.gp_costs.x=20,this.gp_costs.top=215,this.gp_title.addChild(this.gp_costs)},t.prototype.getDataList=function(){var g=this,e=this.info;if(!e||!e.data)return[];var c,f=e.data.targeted,t=e.content,i=e.data.curCycle||1;for(var n in t[1]){var o=t[1][n];if(o[0]==i){c=o[1];break}}if(!c)return[];for(var _=y.AppFacade.getInstance().retrieveProxy(y.BackpackPy.N),l=[],m=[],a=function(e){var t=c[e],i=t[0],h=t[1],p=t[2],d=t[3];if(t[4])return m.push(t),"continue";var n=REWARD_STATUS.UNAVAILABLE,u=0;for(var o in f){var a=f[o];if(a.id==i){u=a.num;break}}d<=u?n=REWARD_STATUS.RECEIVED:_.checkEnough(p,!1)&&(n=REWARD_STATUS.AVAILABLE);var r=y.GeneralConfig.getEntityConfigByCode(h[0][0],h[0][1]),s={id:i,title:"兑换"+(r&&r.name),tips:u+"/"+d,rewards:h,btnLabel:"制作",costs:p,status:n,btnFunc:function(t){switch(t.status){case REWARD_STATUS.AVAILABLE:var e=y.AppFacade.getInstance().retrieveMediator(y.ShopyMediator.N),i=[],n=9999;for(var o in p){var a=p[o],r=y.AppFacade.getInstance().retrieveProxy(y.BackpackPy.N).getInfoByCode(a[1]),s=Math.floor(r.haveNum/a[2]);s<n&&(n=s,i=a)}var c=n,l=y.GeneralConfig.getEntityConfigByCode(h[0][0],h[0][1]).name;e.showSubView(y.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:h,costs:[i],countFun:function(e){return{unit:i[2],total:i[2]*e}},name:l,limit:"[5,"+(d+1)+"]"},maxCount:d-u<c?d-u:c,buyNum:u+1,btnLabel:"兑换",costTip:"兑换消耗",limitTip:"兑换次数",doneCB:function(e){g.getReward({code:g.code,giftCode:t.id,num:e.num||0})}});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已换取")}}};l.push(s)},r=0;r<c.length;r++)a(r);if(l.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id}),this.gp_costs.removeChildren(),0<m.length){var s=function(e){var t=m[e],a=t[0],r=t[1],s=t[2],c=t[3],i=y.GameMVC.backpackPy.getInfoByCode(r[0][1]),l=0;for(var n in f){var o=f[n];if(o.id==a){l=o.num;break}}var h=y.GameMVC.backpackPy.getInfoByCode(s[0][1]),p=new customui.ResourceItem({icon:i.info.icon,num:i.haveNum,addClickWayFunc:function(){var e=REWARD_STATUS.UNAVAILABLE;switch(c<=l?e=REWARD_STATUS.RECEIVED:_.checkEnough(s,!1)&&(e=REWARD_STATUS.AVAILABLE),e){case REWARD_STATUS.AVAILABLE:var t=y.AppFacade.getInstance().retrieveMediator(y.ShopyMediator.N),i=y.AppFacade.getInstance().retrieveProxy(y.BackpackPy.N).getInfoByCode(s[0][1]),n=Math.floor(i.haveNum/s[0][2]),o=y.GeneralConfig.getEntityConfigByCode(r[0][0],r[0][1]).name;t.showSubView(y.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:r,costs:s,countFun:function(e){return{unit:s[0][2],total:s[0][2]*e}},name:o,limit:"[5,"+(c+1)+"]"},maxCount:c-l<n?c-l:n,buyNum:l+1,btnLabel:"兑换",costTip:"兑换消耗",limitTip:"兑换次数",doneCB:function(e){g.getReward({code:g.code,giftCode:a,num:e.num||0})}});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg(h.info.name+"不足");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已换取")}}});p.scaleX=p.scaleY=.9,d.gp_costs.addChild(p)},d=this;for(var n in m)s(n)}return l},t}(y.ActivityCommonListView);y.ActivityNewNewItemGifts=e,__reflect(e.prototype,"game.ActivityNewNewItemGifts");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityCommonListItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc(this.data)},this);var e=new eui.HorizontalLayout;e.verticalAlign="middle",e.gap=0,this.gp_rewards.layout=e},e.prototype.dataChanged=function(){var o=this,e=this.data;switch(this.img_bg.source=e.bg||this.img_bg.source,this.lb_title.text=e.title||"",this.lb_tips.text=e.tips||"",this.data.status){case REWARD_STATUS.UNAVAILABLE:this.btn_operate.label="兑换",UIActionManager.setGrey(this.btn_operate,!0),this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.scaleX=this.btn_operate.scaleY=.8;break;case REWARD_STATUS.RECEIVED:this.btn_operate.label="已领取",this.btn_operate.skinName="skins.ButtonSkinSure",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=1;break;default:this.btn_operate.label="兑换",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.scaleX=this.btn_operate.scaleY=.8}this.data.btnLabel&&(this.btn_operate.label=this.data.btnLabel),this.gp_rewards.removeChildren();for(var t=JSON.parse(e.costs),i=y.AppFacade.getInstance().retrieveProxy(y.BackpackPy.N),n=0;n<t.length-1;n++){var a=customui.BaseItemFactory.create();a.scaleX=a.scaleY=.7,a.updateData({reward:t[n]});var r=i.getInfoByCode(t[n][1]).haveNum;a.blb_num.text=r+"/"+t[n][2],r>=t[n][2]?UIActionManager.setAbsGrey(a,!1):UIActionManager.setAbsGrey(a,!0),this.gp_rewards.addChild(a);var s=new eui.Image("common_img_jia_png");this.gp_rewards.addChild(s)}var c=customui.BaseItemFactory.create();c.scaleX=c.scaleY=.7,c.updateData({reward:t[t.length-1]}),this.gp_rewards.addChild(c);var l=i.getInfoByCode(t[t.length-1][1]).haveNum;c.blb_num.text=l+"/"+t[t.length-1][2],l>=t[t.length-1][2]?UIActionManager.setAbsGrey(c,!1):UIActionManager.setAbsGrey(c,!0);var h=new eui.Image("newactivity_img_denghao_png");this.gp_rewards.addChild(h),JSON.parse(e.rewards).forEach(function(e,t){var i=new eui.Group;i.width=i.height=73.5;var n=customui.BaseItemFactory.create();n.scaleX=n.scaleY=.7,n.updateData({reward:e}),e[3]?UIActionManager.addEffect(i,"common_jiban",{scaleX:1,scaleY:1,childIndex:1}):UIActionManager.hideEffect(i),i.addChildAt(n,0),o.gp_rewards.addChild(i)}),this.btnFunc=e.btnFunc,this.data.status==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn_operate,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-1}):UIActionManager.hideEffect(this.btn_operate)},e}(eui.ItemRenderer);__reflect(i.prototype,"ActivityExchangeListItem")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.FIXED_LAP=5,e.itemAngle=45,e.rotating=!1,e.curIndex=0,e.tableInit=!1,e.code=EActivityType.NewTurntable,e.proxy=a.GameMVC.activityPy,e.skinName="ActivityNewTurnTableSkin",e}return __extends(e,t),Object.defineProperty(e.prototype,"info",{get:function(){return this.proxy.allActivityData[this.code]},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent(),DragonBoneTools.playOnce({effectName:"common_zhuanpandeng_1",parent:this.gp_effect,loop:!0}),this.list_rewards.itemRenderer=i},e.prototype.updateView=function(e){var o=this,t=this.info;if(!this.tableInit){t.content.forEach(function(e,t){var i=o["gp_Reward"+t],n=customui.BaseItemFactory.create();n.scaleX=n.scaleY=70/105,n.updateData({reward:e[1][0]}),i.addChild(n)}),this.tableInit=!0;var i=t.data.nameList.length;if(i){if(this.img_empty.visible=!1,this.list_rewards.dataProvider=new eui.ArrayCollection(t.data.nameList),4<i){this.scl_rewards.viewport=this.list_rewards;var n=140*i+20*(i-1);this.once(egret.Event.ENTER_FRAME,function(){o.scl_rewards.viewport.scrollH=n-o.scl_rewards.width},this)}}else{this.img_empty.visible=!0;this.list_rewards.dataProvider=new eui.ArrayCollection([["","sfhl_img_jp1"],["","sfhl_img_jp2"],["","sfhl_img_jp3"],["","sfhl_img_jp4"]])}}this.dt=t.endDt-Utils.TimerManager.getServerTime(),this.blb_time.text=Utils.TimerManager.getFormatBySecond1(this.dt),this.timer||(this.timer=egret.setInterval(function(){0<o.dt&&(o.blb_time.text=Utils.TimerManager.getFormatBySecond1(--o.dt))},this,1e3)),this.blb_times.text=t.data.total.toString()},e.prototype.rotateToIndex=function(e,t){if(!this.rotating){var i=e*this.itemAngle+this.itemAngle/2+360*this.FIXED_LAP;this.rotateToAngle(i,t)}},e.prototype.rotateToAngle=function(e,t,i){var n=this;void 0===i&&(i=5e3);for(var o=[],a=0;a<8;a++){var r=this["gp_Reward"+a];r&&o.push(r)}this.rotating=!0,GameRootLayer.gameLayer().switchTouchEnable(!1);this.gp_roll.rotation=this.gp_roll.rotation%360,egret.Tween.get(this.gp_roll,{onChange:function(){var t=360*(n.FIXED_LAP+1)-n.gp_roll.rotation;o.forEach(function(e){e.rotation=t})},onChangeObj:this}).to({rotation:e},i,function(e){return 1-Math.pow(1-e,3)}).call(function(){n.rotating=!1,GameRootLayer.gameLayer().switchTouchEnable(!0),t&&t()})},e.prototype.activateComponent=function(){var i=this;Utils.ComponentUtils.registerListener(this.btn_roll,egret.TouchEvent.TOUCH_TAP,function(){0<i.info.data.total?Utils.Socket.send("activity","DoCommonOperation",{code:i.code,num:1,id:1}).then(function(e){i.gp_effect.$children[0].visible=!1,DragonBoneTools.playOnce({effectName:"common_zhuanpandeng_2",parent:i.gp_effect,loop:!0});var t=JSON.parse(e.info);i.rotateToIndex(t.rewardId-1,function(){i.info.updateData(t),a.GameMVC.backpackPy.handleClientReward(e.clientReward),i.gp_effect.removeChildAt(1),i.gp_effect.$children[0].visible=!0})}):Utils.MsgUtils.addMidMsg("无剩余抽奖次数")},this),Utils.ComponentUtils.registerListener(this.btn_access,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new n})},this),Utils.ComponentUtils.registerListener(this.btn_preview,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new o})},this),Utils.ComponentUtils.registerListener(this.btn_back,egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this),Utils.ComponentUtils.registerListener(this.btn_guide,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new a.HelpDialog({moduleId:MODULE.Activity+EActivityType.NewTurntable})})},this)},e.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},e}(BasePanel);a.ActivityNewTurnTable=e,__reflect(e.prototype,"game.ActivityNewTurnTable");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityNewTurnTable_RewardItem",e}return __extends(e,t),e.prototype.dataChanged=function(){this.lb_desc.text=this.data[0],this.img_icon.source=this.data[1]+"_png",this.data[0]?(this.img_date.visible=!0,this.lb_date.visible=!0,this.lb_date.text=this.data[2]):(this.img_date.visible=!1,this.lb_date.visible=!1)},e}(eui.ItemRenderer);__reflect(i.prototype,"ActivityNewTurnTable_RewardItem");var n=function(i){function e(){var e,t=i.call(this)||this;return t.CONFIG=((e={})[1]={name:"loginTimes",max:1,text:"登录游戏（%s/1）",cb:function(){Utils.MsgUtils.addMidMsg("你能点到这个按钮证明程序出问题了")}},e[2]={name:"firstChargeTimes",max:1,text:"首次充值（%s/1）",cb:function(){t.hide(),a.MainJumpConfig.jumpTo(MODULE.Recharge)}},e[3]={name:"inviteTimes",max:3,text:"邀请好友（%s/3）",cb:function(){var e=EActivityType.InvitationCode;a.GameMVC.activityPy.isOpen(e)?(t.hide(),a.GameMVC.activityMed.showViewByCode(e)):Utils.MsgUtils.addMidMsg("邀请活动未开启")}},e),t.skinName="ActivityNewTurnTable_AccessPanel",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.updateView()},e.prototype.updateView=function(e){var n=a.GameMVC.activityPy.allActivityData[EActivityType.NewTurntable].data,t=function(e){var t=o.CONFIG[e],i=n[t.name];o["lb_"+e].text=t.text.format([i.toString()]),o["img_"+e].visible=i===t.max,o["btn_"+e].visible=i!=t.max,Utils.ComponentUtils.registerListener(o["btn_"+e],egret.TouchEvent.TOUCH_TAP,function(){t.cb()},o)},o=this;for(var i in this.CONFIG)t(i)},e}(BasePanel);__reflect(n.prototype,"ActivityNewTurnTable_AccessPanel");var o=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityNewTurnTable_PreviewPanelSkin",e}return __extends(e,t),e}(BasePanel);__reflect(o.prototype,"ActivityNewTurnTable_PreviewPanel")}(game||(game={})),function(v){var e=function(n){function e(){var e=n.call(this)||this;return e.needHongBaoYu=!1,e.need321=!1,e.boxReward=void 0,e.cbData=void 0,e.curSectionId=void 0,e.barrageTextArr=[],e.oldLength=0,e.oldRedPocketStatus=0,e.skinName="ActivityNewYearChallenge",e.code=EActivityType.NewYearChallenge,e}return __extends(e,n),e.prototype.childrenCreated=function(){var t=this;n.prototype.childrenCreated.call(this),this.btn_redPocket.visible=!1,this.HeroDynamicModel.update({isStatic:!0,model:"hero_037_03"}),this.activateComponent();var i=[0,1,2,3];this.barrageTimer=egret.setInterval(function(){if(0<t.barrageTextArr.length&&t.HeroDynamicModel.visible){var e=Math.floor(Math.random()*i.length);t.CommonBarrage.addOneMsg({text:t.barrageTextArr.pop(),startY:i[e]/4*t.CommonBarrage.height+1}),i.splice(e,1),0==i.length&&(i=[0,1,2,3]).splice(e,1)}},this,2e3),this.CommonBarrage.touchEnabled=!1},e.prototype.updateView=function(){var e=this.info;if(e&&e.data){var t=e.data.attackList,i=9999999;for(var n in t)parseInt(n)<i&&(i=parseInt(n));var o=0;if(t[i])for(var n in t[i]){(d=t[i][n]).isKilled&&(o=1)}var a=10*Object.keys(t).length+o;10!=this.oldRedPocketStatus||11!=a&&21!=a||(this.needHongBaoYu=!0),this.oldRedPocketStatus=a,this.curSectionId&&this.curSectionId!=e.data.sectionId&&(this.need321=!0,this.BossVisible(!1)),this.needHongBaoYu?this.playEffect2():this.need321&&this.playEffect3(),this.curSectionId=e.data.sectionId;var r=e.data.targeted,s=JSON.parse(e.content),c=e.data.sectionId>s[1].length?s[1].length-1:e.data.sectionId-1,l=s[1][c],h=(l[0],l[1]),p=[];for(var n in this.boxReward=l[5],l[3]){var d=l[3][n][0];for(var u in d){var g=d[u];p.push(g)}}this.gp_reward.removeChildren(),v.GameMgr.getInstance().CommonGpAddReward(this.gp_reward,p),this.CommonIconWithNum.updateItem({cost:h[0],style:CommonIconStyle.RIGHT,needShowHave:!0});var f=e.data.life;this.pb_hp.maximum=f[0];var _=Math.floor(100*f[1]/f[0]);this.pb_hp.value=_<=20?f[0]/5:f[1],this.bm_hp.text=(_<=20?"??":_)+"%",this.curSectionId>i&&r.indexOf(0)<0?this.btn_redPocket.visible=!0:this.btn_redPocket.visible=!1,this.handleRecord(t),this.updateTime()}},e.prototype.handleRecord=function(e){void 0===e&&(e=[]);var t=v.AppFacade.getInstance().retrieveProxy(v.PlayerPy.N).playerInfoVO.playerId,i=[];for(var n in e){var o=e[n],a=parseInt(n);for(var r in o)o[r].sectionId=a,i.push(o[r])}i.sort(function(e,t){return e.dt-t.dt});var s="";for(r=this.oldLength;r<i.length;r++){var c=i[r];c.isKilled?c.sectionId==this.curSectionId-1&&(s=c.name+"豪气冲天，驱除魔物，一波红包来袭！！！"):c.playerId!=t&&this.barrageTextArr.push("喜贺新春，鞭炮除岁，"+c.name+"对boss发起过攻击。")}s&&this.barrageTextArr.push(s),this.oldLength=i.length},e.prototype.activateComponent=function(){var a=this;UIActionManager.addEffect(this.btn_redPocket,"common_hongbaotiaodong"),this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.getReward(1)},this),this.btn_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.AppFacade.getInstance().retrieveMediator(v.ShopyMediator.N);var e=a.info;if(e&&e.data){var t=JSON.parse(e.content),i=t[e.data.sectionId>t.length?t.length-1:e.data.sectionId-1],n=(i[0],i[1]),o=v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N).getInfoByCode(n[0][1]);Math.floor(o.haveNum/n[0][2]);PopUpManager.addPopUp({obj:new v.SimpleUsePanel({code:n[0][1],callBack:function(e){a.getReward(e.num)},requestNum:1})})}},this),this.btn_box.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.boxReward&&v.AppFacade.getInstance().showSubView(v.CommonMediator.N,v.CommonMediator.SV.REWARD_PANEL,{rewards:a.boxReward,type:v.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new v.HelpDialog({moduleId:MODULE.Activity+EActivityType.NewYearChallenge})})},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.hide()},this),this.btn_redPocket.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.setTouchFalse(),Utils.Socket.send("activity","GetCommonReward",{code:a.code,id:0}).then(function(e){DragonBoneTools.playOnce({effectName:"common_hongbaodakai",parent:a.gp_root,x:a.gp_root.width/2||0,y:a.gp_root.height/2||0,keep:!1,loop:!1,doneCB:function(){a.actProxy.updateData_View_Reward(a.code,e),a.setTouchTrue()}})})},this)},e.prototype.setTouchFalse=function(){GameRootLayer.gameLayer().switchTouchEnable(!1),this.toleranceTimer&&egret.clearTimeout(this.toleranceTimer),this.toleranceTimer=egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this,5e3)},e.prototype.setTouchTrue=function(){GameRootLayer.gameLayer().switchTouchEnable(!0),this.toleranceTimer&&egret.clearTimeout(this.toleranceTimer)},e.prototype.getReward=function(e){var t=this,i=this.info;if(i&&i.data){var n=JSON.parse(i.content),o=i.data.sectionId>n[1].length?n[1].length-1:i.data.sectionId-1,a=n[1][o][1];this.backpackProxy.checkEnough([[a[0][0],a[0][1],e]])?(this.setTouchFalse(),Utils.Socket.send("activity","DoCommonOperation",{num:e,code:this.code}).then(function(e){t.cbData=e,t.playEffect1()}).catch(function(e){t.setTouchTrue(),Utils.MsgUtils.addErrMsg(e.err)})):Utils.MsgUtils.addMidMsg("道具不足")}},e.prototype.playEffect1=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return DragonBoneTools.playOnce({effectName:"common_bianpao",parent:this.gp_root,x:this.gp_root.width/2||0,y:this.gp_root.height/2||0,keep:!1,loop:!1,doneCB:function(){t.HeroDynamicModel.egretArmDisplay&&t.HeroDynamicModel.egretArmDisplay.addEventListener(dragonBones.EventObject.COMPLETE,t.onModelComplete,t),t.HeroDynamicModel.changeAction(["shouji"])}}),[2]})})},e.prototype.onModelComplete=function(){var e=this;this.cbData.clientReward&&(GameRootLayer.gameLayer().switchTouchEnable(!0),v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N).handleClientReward(this.cbData.clientReward,{onCloseCB:function(){e.handleRewardDone()}}));this.HeroDynamicModel.egretArmDisplay&&this.HeroDynamicModel.egretArmDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this.onModelComplete,this),this.HeroDynamicModel.changeAction(["daiji"])},e.prototype.BossVisible=function(e){this.HeroDynamicModel.visible=e,this.pb_hp.visible=e,this.bm_hp.visible=e},e.prototype.handleRewardDone=function(){this.allDone()},e.prototype.playEffect2=function(){var e=this;DragonBoneTools.playOnce({effectName:"common_hongbaoyu",parent:this.gp_root,x:this.gp_root.width/2||0,y:this.gp_root.height/2||0,keep:!1,loop:!1,doneCB:function(){e.need321&&e.playEffect3()}}),this.needHongBaoYu=!1},e.prototype.playEffect3=function(){var e=this;this.darkSprite?this.darkSprite.visible=!0:(this.darkSprite=new egret.Sprite,this.darkSprite.graphics.clear(),this.darkSprite.graphics.beginFill(0,.8),this.darkSprite.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth(),Utils.DeviceUtils.curHeight()),this.darkSprite.graphics.endFill(),this.darkSprite.width=Utils.DeviceUtils.curWidth(),this.darkSprite.height=Utils.DeviceUtils.curHeight(),this.darkSprite.x=(this.width-this.darkSprite.width)/2,this.darkSprite.y=(this.height-this.darkSprite.height)/2,this.addChild(this.darkSprite)),this.setTouchFalse(),egret.setTimeout(function(){e.setTouchTrue(),e.need321=!1,e.darkSprite.visible=!1,e.BossVisible(!0)},this,6e3),DragonBoneTools.playOnce({effectName:"common_shijiebossdjs",parent:this,doneCB:function(){}})},e.prototype.allDone=function(){GameRootLayer.gameLayer().switchTouchEnable(!0),this.cbData?(this.actProxy.allActivityData[this.code].updateData(this.cbData.info),this.cbData=void 0):this.updateView(),this.toleranceTimer&&egret.clearTimeout(this.toleranceTimer)},e.prototype.updateTime=function(){var n=this;this.timer&&egret.clearInterval(this.timer);var e=this.info;if(e&&e.data){var t=[JSON.parse(e.content)[0]],o=v.GameMgr.getInstance().serverTime(),i=new Date(1e3*o),a=[];for(var r in i.setHours(0,0,0),a.push(i.getTime()/1e3),t){var s=(p=t[r])[0],c=p[1];(d=new Date(1e3*o)).setHours(s[0],s[1],s[2]||0);var l=d.getTime()/1e3;(u=new Date(1e3*o)).setHours(c[0],c[1],c[2]||0);var h=u.getTime()/1e3;a.push(l),a.push(h)}var p,d;s=(p=t[0])[0],c=p[1];(d=new Date(1e3*o)).setHours(s[0],s[1],s[2]||0);var u;l=d.getTime()/1e3+86400;(u=new Date(1e3*o)).setHours(c[0],c[1],c[2]||0);h=u.getTime()/1e3+86400;l<e.endDt&&(a.push(l),h<=e.endDt||(u.setHours(23,59,59),h=u.getTime()/1e3),a.push(h));for(var g=!1,f=function(e){if(o>=a[e]&&o<=a[e+1]){if(g=!0,e%2==0){_.BossVisible(!1);var t=a[e+1];return _.lb_timeTip.text="距离挑战开启时间:",_.timer=egret.setInterval(function(){var e=Utils.TimerManager.getServerTime();e<=t?n.lb_time.text=Utils.TimerManager.getFormatBySecond1(t-e):n.updateView()},_,1e3),{value:void 0}}!_.need321&&_.BossVisible(!0);var i=a[e+1];_.lb_timeTip.text="距离挑战结束时间:",_.timer=egret.setInterval(function(){var e=Utils.TimerManager.getServerTime();e<=i?n.lb_time.text=Utils.TimerManager.getFormatBySecond1(i-e):n.updateView()},_,1e3)}},_=this,m=0;m<a.length-1;m++){var y=f(m);if("object"==typeof y)return y.value}g||(this.BossVisible(!1),this.lb_timeTip.text="活动已结束",this.lb_time.text="")}},e.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer),this.toleranceTimer&&egret.clearTimeout(this.toleranceTimer),this.barrageTimer&&egret.clearInterval(this.barrageTimer)},e}(v.ActivityCommonPanel);v.ActivityNewYearChallenge=e,__reflect(e.prototype,"game.ActivityNewYearChallenge")}(game||(game={})),function(p){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityNewYearWeekCrad",e.code=EActivityType.NewYearWeekCrad,e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btnFunc&&e.btnFunc()},this)},e.prototype.updateView=function(){var e=this,t=this.info;if(t&&t.data){var i=JSON.parse(t.content),n=!!t.data.day,o=(i[0],i[1]),a=i[2],r=(t.data.targeted,t.data.day%o?t.data.day%o-1:o),s=n&&a[r]||a[0];if(this.gp_reward.removeChildren(),s&&p.GameMgr.getInstance().CommonGpAddReward(this.gp_reward,s[1]),n)this.btn.visible=!1;else{var c=p.AppFacade.getInstance().retrieveProxy(p.RechargePy.N),l=c.getNewYearCardInfo();l?(this.btn.label="购买",l.isMonthCard=!0,this.btnFunc=function(){c.purchase(l)}):(this.btn.label="元",this.btnFunc=function(){Utils.MsgUtils.addMidMsg("找不到商品信息")}),this.btn.skinName="skins.ButtonSkinYellow",this.btn.scaleX=this.btn.scaleY=.8}if(!this.timer){var h=this.info.endDt;this.timer=egret.setInterval(function(){e.lb_time.text=""+Utils.TimerManager.getFormatBySecond2(h-Utils.TimerManager.getServerTime())},this,1e3)}}},e}(p.ActivityCommonPanel);p.ActivityNewYearWeekCrad=e,__reflect(e.prototype,"game.ActivityNewYearWeekCrad")}(game||(game={})),function(_){var e=function(c){function e(){var e=c.call(this)||this;return e.skinName="ActivityNewYuanGiftsByRandomSkin",e.code=EActivityType.NewOneYuanGifts,e}return __extends(e,c),e.prototype.childrenCreated=function(){var e=this;c.prototype.childrenCreated.call(this),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btnFunc&&e.btnFunc()},this)},e.prototype.updateView=function(e){var p=this;c.prototype.updateView.call(this,e);var t=this.info;if(t&&t.data&&_.ActivityConfig.Config[this.code]){var d=t.data.targeted,i=t.content,u=t.data.key,n=t.data.day;n>i.length&&(n=i.length);var g=[];for(var o in i){var a=i[o];a[0]==n&&g.push(a)}if(!g.length)return[];for(var r=function(e){var t=g[e],o=(t[0],t[1]),a=t[2],i=t[3][u-1][0],n=t[4];f.gp_reward.removeChildren(),_.GameMgr.getInstance().CommonGpAddReward(f.gp_reward,i),f.heroModel.update({model:n,isStatic:!0});var r=REWARD_STATUS.CANBUY,s=!1;for(var c in d){if(d[c].id==o){s=!0;break}}s&&(r=REWARD_STATUS.RECEIVED),f.updateBtn(f.btn,r);var l=_.AppFacade.getInstance().retrieveProxy(_.RechargePy.N).goodList;for(var c in l){var h=l[c];h.id==a&&(f.lb_price.text="售价："+h.price+"元")}f.btnFunc=function(){switch(r){case REWARD_STATUS.CANBUY:var e=_.AppFacade.getInstance().retrieveProxy(_.RechargePy.N),t=e.goodList;for(var i in t){var n=t[i];if(n.id==a)return void e.purchase(n,2,o,JSON.stringify({activityType:p.code,uuid:o}),{activityType:p.code})}Utils.MsgUtils.addMidMsg("找不到商品信息");break;case REWARD_STATUS.RECEIVED:return void Utils.MsgUtils.addMidMsg("已购买")}}},f=this,s=0;s<g.length;s++)r(s)}},e.prototype.updateBtn=function(e,t){switch(t){case REWARD_STATUS.RECEIVED:e.skinName="skins.ButtonSkinSure",e.label="已领取",UIActionManager.setGrey(e,!1),e.scaleX=e.scaleY=1,UIActionManager.hideEffect(e);break;case REWARD_STATUS.GO_RECHARGE:e.skinName="skins.ButtonSkinYellow",e.label="充值",UIActionManager.setGrey(e,!1),e.scaleX=e.scaleY=.8,UIActionManager.hideEffect(e);break;case REWARD_STATUS.CANBUY:e.skinName="skins.ButtonSkinYellow",e.label="一元购买",UIActionManager.setGrey(e,!1),e.scaleX=e.scaleY=.8,UIActionManager.hideEffect(e);break;default:e.label="领取",UIActionManager.setGrey(e,!1),e.skinName="skins.ButtonSkinYellow",e.scaleX=e.scaleY=.8,UIActionManager.addEffect(e,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2})}},e}(_.ActivityCommonPanel);_.ActivityNewYuanGiftsByRandom=e,__reflect(e.prototype,"game.ActivityNewYuanGiftsByRandom")}(game||(game={})),function(n){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.NewZoneConsumeRank1,e.rankPy=n.AppFacade.getInstance().retrieveProxy(n.RankPy.N),e.skinName="ActivityNewZoneConsumeRank1ViewSkin",e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.AppFacade.getInstance().showSubView(n.RankMediator.N,n.RankMediator.SV.COMMON,{module:"ActivityNewZoneConsumeRank1"})},this),this.updateTitle()},e.prototype.initList=function(){this.list_itemList.itemRenderer=i,this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF},e.prototype.updateView=function(e){var i=this;t.prototype.updateView.call(this,e),this.rankPy.GetRankList({rankType:RankingType.RankingTypeActivityNewZoneConsumeRank1,refreshInterval:0},function(e){0==e.ranks.length?i.gp_empty.visible=!0:(i.gp_empty.visible=!1,i.list_itemList.dataProvider?i.list_itemList.dataProvider.replaceAll(e.ranks):i.list_itemList.dataProvider=new eui.ArrayCollection(e.ranks));var t=i.rankPy.getSelfRank(RankingType.RankingTypeActivityNewZoneConsumeRank1);t?(i.lb_money.text=t.key.toString(),i.img_icon.source=i.rankPy.rankIcon(t.rank),i.img_icon.source?i.blb_rank.text="":i.blb_rank.text=t.rank.toString()):(i.blb_rank.text="",i.img_icon.source="",i.lb_money.text="未上榜"),i.cu_ph.updateData({vo:n.GameMVC.playerPy.playerInfoVO}),i.lb_name.text=""+n.GameMVC.playerPy.playerInfoVO.name})},e}(n.ActivityCommonListView);n.ActivityNewZoneConsumeRank1View=e,__reflect(e.prototype,"game.ActivityNewZoneConsumeRank1View");var i=function(t){function e(){var e=t.call(this)||this;return e.rankPy=n.AppFacade.getInstance().retrieveProxy(n.RankPy.N),e.skinName="ActivityNewZoneConsumeRank1Item",e}return __extends(e,t),e.prototype.dataChanged=function(){this.lb_name.text=this.data.playerBaseInfo.name+"("+this.data.playerBaseInfo.serverId+"服)",this.lb_money.text=this.data.key.toString(),this.cu_ph.updateData({vo:this.data.playerBaseInfo}),this.img_icon.source=this.rankPy.rankIcon(this.data.rank),this.img_icon.source?this.blb_rank.text="":this.blb_rank.text=this.data.rank.toString()},e}(eui.ItemRenderer);__reflect(i.prototype,"ActivityNewZoneConsumeRank1Item")}(game||(game={})),function(s){var e=function(C){function e(){var e=C.call(this)||this;return e.curCode=1,e.dataList=[],e.peopleCountItems=[],e.discountItems=[],e.skinName="ActivityNewZoneGroupPurchase",e}return __extends(e,C),e.prototype.childrenCreated=function(){var i=this;C.prototype.childrenCreated.call(this),this.CommonArrayList.itemRenderer=t,this.CommonArrayList.setChoseFrame("common_img_touxiangxuanzhon_png"),this.CommonArrayList.addItemTapEvent(this.onTapItem,this);var e=new eui.HorizontalLayout;e.gap=0,e.verticalAlign=egret.VerticalAlign.MIDDLE,e.horizontalAlign=egret.HorizontalAlign.CENTER,this.CommonArrayList.layout=e,this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.dataList[i.curCode-1];if(e){if(e.selfBuy>=e.canBuyTimes)return void Utils.MsgUtils.addMidMsg("当前没有可购买数量");var t=[[1,1,e.initPrice*e.curDiscount/100]];if(!s.GameMVC.backpackPy.checkEnough(t,!1))return void Utils.MsgUtils.addMidMsg("当前钻石不足");i.getReward({code:i.code,num:1,id:e.code,diamonds:e.initPrice*e.curDiscount/100})}else Utils.MsgUtils.addMidMsg("读取配置失败")},this),this.btn_help.visible=!0,this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new s.HelpDialog({moduleId:MODULE.Activity+EActivityType.NewZoneGroupPurchase})})},this)},e.prototype.updateView=function(e){C.prototype.updateView.call(this,e),this.updateTitle();var t=this.info;if(t&&t.data){var i=JSON.parse(t.content),n=t.data.itemList,o=[];for(var a in i){var r=i[a],s=r[0],c=r[1],l=r[2],h=r[3],p=r[4],d=0,u=0;for(var g in n){var f=n[g];f.code==s&&(d=f.num,u=f.times)}var _=100,m=0,y=0;for(var v in p){var T=p[v];d>=T[0]&&(_=T[1],y++),m=T[0]>m?T[0]:m}o.push({code:s,rewards:c,canBuyTimes:l,initPrice:h,discountConfig:p,peopleBuy:d,selfBuy:u,curDiscount:_,maxNeedCount:m,curStage:y})}this.dataList=o,this.CommonArrayList.dataProvider=new eui.ArrayCollection(o),this.CommonArrayList.changeTo({itemIndex:this.curCode-1})}},e.prototype.onTapItem=function(e){var t=e.itemIndex;this.curCode=t+1,this.updateTopInfo()},e.prototype.updateTopInfo=function(){var e=void 0;for(var t in this.dataList){if((a=this.dataList[t]).code==this.curCode){e=a;break}}if(e){var i=e.rewards,n=s.GeneralConfig.getEntityConfigByCode(i[0][0],i[0][1]);n&&(this.bastitem_reward.updateData({reward:i[0]}),this.lb_rewardname.text=n.name),this.bm_oldPrice.text=e.initPrice,this.lb_canBuy.text=e.canBuyTimes-e.selfBuy+"",this.blb_discount1.text=e.curDiscount/10+"",this.gp_discount0.visible=e.curDiscount<100,this.bm_curDiscount.text=e.curDiscount/10+"",this.bm_newPrice.text=e.initPrice*e.curDiscount/100+"",this.pb_progress.value=0,this.pb_progress.maximum=e.maxNeedCount;var o=0;for(var t in e.peopleBuy<1e3?o=0+(e.peopleBuy-0)/1e3*2500:e.peopleBuy<3e3?o=2500+(e.peopleBuy-1e3)/2e3*2500:e.peopleBuy<5e3?o=5e3+(e.peopleBuy-3e3)/2e3*2500:e.peopleBuy<1e4&&(o=7500+(e.peopleBuy-5e3)/5e3*2500),this.pb_progress.value=Math.floor(o),this.bm_hasSale.text=e.peopleBuy,this.recycleDiscountItem(),this.recyclePeopleItem(),e.discountConfig){var a=e.discountConfig[t],r=this.makeDiscountItem(a[1]/10);this.gp_discount.addChild(r);r=this.makePeopleItem(a[0]);this.gp_peoplCount.addChild(r)}e.selfBuy>=e.canBuyTimes?(this.btn_hasBuy.visible=!0,this.btn_buy.visible=!1):(this.btn_hasBuy.visible=!1,this.btn_buy.visible=!0)}},e.prototype.makeDiscountItem=function(e){if(0<this.discountItems.length){var t=this.discountItems[0];return t.bm_discount.text=e,this.discountItems.shift(),t.visible=e<10,t}var i=new eui.Group,n=new eui.Image,o=new eui.BitmapLabel;return n.source="newactivity_img_zhekou_png",n.horizontalCenter=n.verticalCenter=0,i.addChild(n),o.font="main_vip_fnt",o.text=e,o.rotation=-5,o.verticalCenter=5,o.right=70,i.bm_discount=o,i.addChild(o),i.visible=e<10,i},e.prototype.recycleDiscountItem=function(){for(var e in this.gp_discount.$children){var t=this.gp_discount.$children[e];this.discountItems.push(t)}this.gp_discount.removeChildren()},e.prototype.makePeopleItem=function(e){if(0<this.peopleCountItems.length){var t=this.peopleCountItems[0];return t.bm_discount.text=e,this.peopleCountItems.shift(),t.visible=!!e,t}var i=new eui.Group,n=new eui.Image,o=new eui.BitmapLabel;return n.source="newactivity_img_jindujiedian_png",n.horizontalCenter=n.verticalCenter=0,i.addChild(n),o.font="recharge_num_fnt",o.text=e,o.horizontalCenter=0,o.verticalCenter=0,o.rotation=-10,o.letterSpacing=-5,o.scaleX=o.scaleY=.7,i.bm_discount=o,i.addChild(o),i.visible=!!e,i},e.prototype.recyclePeopleItem=function(){for(var e in this.gp_peoplCount.$children){var t=this.gp_peoplCount.$children[e];this.peopleCountItems.push(t)}this.gp_peoplCount.removeChildren()},e.prototype.updateTitle=function(){var e=this,t=s.Config.activityConfigs()[this.code],i=this.actProxy.allActivityData[this.code];if(t&&this.img_title&&(this.img_title.source=JSON.parse(t.img_title)[0]+"_png"),this.code==EActivityType.LevelReward)this.bm_time.text="";else if(i&&this.bm_time){var n=s.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(n),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=n--?e.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(n):s.AppFacade.getInstance().hideSubView(s.ActivityMediator.N,s.ActivityMediator.SV.MAIN)},this,1e3)}},e}(s.ActivityCommonView);s.ActivityNewZoneGroupPurchase=e,__reflect(e.prototype,"game.ActivityNewZoneGroupPurchase");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityNewZoneGroupPurchaseItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bi_reward=customui.BaseItemFactory.create(),this.bi_reward.horizontalCenter=this.bi_reward.verticalCenter=0,this.gp_main.addChild(this.bi_reward)},e.prototype.dataChanged=function(){this.bi_reward.updateData({reward:this.data.rewards[0]}),this.blb_discount0.text=this.data.curDiscount/10+"",100<=this.data.curDiscount?this.gp_discount.visible=!1:this.gp_discount.visible=!0,this.data.selfBuy<this.data.canBuyTimes?(UIActionManager.setGrey(this.gp_all,!1),this.img_hasBuy.visible=!1):(UIActionManager.setGrey(this.gp_all,!0),this.img_hasBuy.visible=!0)},e.itemWidth=105,e}(eui.ItemRenderer);__reflect(t.prototype,"ActivityNewZoneGroupPurchaseItem")}(game||(game={})),function(o){var e=function(s){function e(){var e=s.call(this)||this;return e.initFinish=!1,e.selectIndex=0,e.items=new Array,e.skinName="ActivityOneChoice",e}return __extends(e,s),e.prototype.childrenCreated=function(){var t=this;s.prototype.childrenCreated.call(this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new o.HelpDialog({moduleId:MODULE.Activity+EActivityType.OneChoice})})},this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.selectIndex?o.GameMgr.getInstance().showCommonTipsWin({costTips:"活动期间内祈福次数仅限一次，请确认是否祈福？",cost:[],reset:!0,cb:!1,btnLabel:{cancel:"取消",sure:"确定"},clickCB:function(e){1===e.type&&t.getReward({code:t.code,num:1,id:t.selectIndex+1},function(){o.GameMVC.activityMed.updateView(o.ActivityMediator.SV.MAIN)})}}):Utils.MsgUtils.addMidMsg("未选择祈福的英雄")},this)},e.prototype.updateView=function(e){var o=this;if(s.prototype.updateView.call(this,e),!this.initFinish){this.initFinish=!0;var t=this.info;if(!t||!t.data)return[];for(var a=t.content[(t.data.day||1)-1],i=(t.data.targeted,function(i){var e=a[i],t=r["gp"+i];if(e&&t){var n=new c({heroCode:e[0][1],effect:!1});n.horizontalCenter=n.verticalCenter=0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){for(var e in o.items){var t=o.items[e];t&&t.hideEffect()}o.selectIndex=i,o.items[i-1]&&o.items[i-1].showEffect()},r),r.items.push(n),t.addChild(n)}}),r=this,n=1;n<=a.length;n++)i(n);this.updateTitle()}},e.prototype.updateTitle=function(){var e=this,t=o.Config.activityConfigs()[this.code],i=this.actProxy.allActivityData[this.code];if(t&&this.img_title&&(this.img_title.source=JSON.parse(t.img_title)[0]+"_png"),this.code==EActivityType.LevelReward)this.bm_time.text="";else if(i&&this.bm_time){var n=o.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(n),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=n--?e.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(n):o.AppFacade.getInstance().hideSubView(o.ActivityMediator.N,o.ActivityMediator.SV.MAIN)},this,1e3)}},e}(o.ActivityCommonView);o.ActivityOneChoice=e,__reflect(e.prototype,"game.ActivityOneChoice");var c=function(i){function e(e){var t=i.call(this)||this;return t.skinName="ActivityOneChoiceItem",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){UIActionManager.addEffect(this.gp_effect0,"common_buxiudebaozang_1"),UIActionManager.addEffect(this.gp_effect1,"common_buxiudebaozang_2"),this.data=this.params,this.dataChanged()},e.prototype.showEffect=function(){this.gp_effect0.visible=this.gp_effect1.visible=!0,UIActionManager.setAbsGrey(this,!1),this.HeroDynamicModel.changeAction()},e.prototype.hideEffect=function(){this.gp_effect0.visible=this.gp_effect1.visible=!1,UIActionManager.setAbsGrey(this,!0),this.HeroDynamicModel.egretArmDisplay&&this.HeroDynamicModel.egretArmDisplay.animation.stop()},e.prototype.dataChanged=function(){var e=this;this.HeroDynamicModel.update({code:this.data.heroCode,isStatic:!0},function(){e.update()});var t=o.Config.allHeroConfig()[this.data.heroCode];if(t){this.lb_name.text=t.name,this.img_raceIcon.source=HeroRaceConfig[t.race].raceIcon,this.gp_stars.removeChildren();for(var i=0;i<t.initStar;i++){var n=new eui.Image;n.source="_border_m_json.common_icon_xingji",this.gp_stars.addChild(n)}}this.update()},e.prototype.update=function(){this.data.effect?this.showEffect():this.hideEffect()},e}(eui.ItemRenderer);__reflect(c.prototype,"ActivityOneChoiceItem")}(game||(game={})),function(g){var e=function(c){function e(){var e=c.call(this)||this;return Utils.AssetsMgr.loadGroup("group_one_yuan_gifts"),e.skinName="ActivityOneYuanGifts",e}return __extends(e,c),e.prototype.onDestroy=function(){c.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_one_yuan_gifts")},e.prototype.childrenCreated=function(){var e=this;c.prototype.childrenCreated.call(this),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btnFunc&&e.btnFunc()},this)},e.prototype.updateView=function(e){var h=this;c.prototype.updateView.call(this,e);var t=this.info;if(t&&t.data&&g.ActivityConfig.Config[this.code]){var p=t.data.targeted,i=t.content,n=(t.data.key,t.data.day),d=[];for(var o in i){var a=i[o];a[0]==n&&d.push(a)}if(!d.length)return[];for(var r=function(e){var t=d[e],o=(t[0],t[1]),a=t[2],i=t[3],n=t[4];for(var r in u.gp_reward.removeChildren(),g.GameMgr.getInstance().CommonGpAddReward(u.gp_reward,i),i){var s=i[r];s[0]==EEntityType.EEntityTypeHero&&u.HeroDynamicModel.update({code:s[1],isStatic:!0})}var c=REWARD_STATUS.CANBUY,l=!1;for(var r in p){if(p[r].id==o){l=!0;break}}l&&(c=REWARD_STATUS.RECEIVED),u.updateBtn(u.btn,c),u.bm_star.text=n,u.btnFunc=function(){switch(c){case REWARD_STATUS.CANBUY:var e=g.AppFacade.getInstance().retrieveProxy(g.RechargePy.N),t=e.goodList;for(var i in t){var n=t[i];if(n.id==a)return void e.purchase(n,2,o,JSON.stringify({activityType:h.code,uuid:o}),{activityType:h.code})}Utils.MsgUtils.addMidMsg("找不到商品信息");break;case REWARD_STATUS.RECEIVED:return void Utils.MsgUtils.addMidMsg("已购买")}}},u=this,s=0;s<d.length;s++)r(s)}},e.prototype.updateBtn=function(e,t){switch(t){case REWARD_STATUS.RECEIVED:e.skinName="skins.ButtonSkinSure",e.label="已领取",UIActionManager.setGrey(e,!1),e.scaleX=e.scaleY=1,UIActionManager.hideEffect(e);break;case REWARD_STATUS.GO_RECHARGE:e.skinName="skins.ButtonSkinYellow",e.label="充值",UIActionManager.setGrey(e,!1),e.scaleX=e.scaleY=.8,UIActionManager.hideEffect(e);break;case REWARD_STATUS.CANBUY:e.skinName="skins.ButtonSkinYellow",e.label="一元购买",UIActionManager.setGrey(e,!1),e.scaleX=e.scaleY=.8,UIActionManager.hideEffect(e);break;default:e.label="领取",UIActionManager.setGrey(e,!1),e.skinName="skins.ButtonSkinYellow",e.scaleX=e.scaleY=.8,UIActionManager.addEffect(e,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2})}},e}(g.ActivityCommonPanel);g.ActivityOneYuanGifts=e,__reflect(e.prototype,"game.ActivityOneYuanGifts")}(game||(game={})),function(r){var e=function(f){function _(){var e=f.call(this)||this;return e.curDay=0,e.isFirst=!0,e.local_notice_img=[],e.rechargeProxy=r.AppFacade.getInstance().retrieveProxy(r.RechargePy.N),e.skinName="ActivityOtherDiamondGifts",e}return __extends(_,f),_.prototype.childrenCreated=function(){f.prototype.childrenCreated.call(this),this.list_root.itemRenderer=n,this.activateComponent();for(var e=0;e<7;e++){var t=this["btn_tabbarImg"+e];if(t){var i=new eui.Image;i.source="_main_m_json.common_img_hongdian",i.visible=!1,i.top=0,i.right=0,i.scaleX=i.scaleY=.7,t.addChild(i),this.local_notice_img.push(i)}}},_.prototype.updateView=function(e){f.prototype.updateView.call(this,e);var t=this.info;if(t&&t.data){var o=t.data.day,a=t.data.amounts,r=JSON.parse(t.data.giftTargeted);this.curDay||(this.curDay=o);var s=JSON.parse(t.content),c=[],i=function(e){var t=s[e],i=REWARD_STATUS.UNAVAILABLE;if(t[2]==l.curDay){var n=0;r.forEach(function(e){e[0]==t[0]&&(n=e[1])}),n>=t[5]&&(i=REWARD_STATUS.HASBUY),c.push({code:t[0],goodId:t[1],needDay:t[2],needRechared:t[3],costs:t[4],canBuyTimes:t[5],rewards:t[6],name:t[7],today:o,curBuy:n,amounts:a,activityType:l.code,status:i})}},l=this;for(var n in s)i(n);c.sort(function(e,t){return e.code-t.code}),c.forEach(function(e,t){c[t].ratity=5<t+1?5:t+1}),c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.code-t.code}),this.list_root.dataProvider=new eui.ArrayCollection(c);for(var h=0;h<7;h++){var p=this["btn_tabbarImg"+h],d=this.gp_lines.$children[h];p&&(h+1<=o?(p.icon="xbrj_img_tbd0"+(h+1)+"_png",p.width=86,p.height=87):(p.icon="xbrj_img_tbd00_png",p.width=77,p.height=62),d&&(d.visible=h<o-1))}if(this.lb_allRecharge.text=a,this.lb_today.text="寻宝天数:第"+o+"天",this.isFirst){var u=this["btn_tabbarImg"+(this.curDay-1)];if(u){var g=u.bottom;egret.Tween.get(u,{loop:!0}).to({bottom:g+15},1e3).to({bottom:g},1e3),u&&(u.scaleX=u.scaleY=1.1)}this.isFirst=!1}this.local_notice_img.forEach(function(e,t){e.visible=!!_.local_notice[t+1]})}},_.prototype.changeDay=function(e){void 0===e&&(e=1);var t=this.info;if(t&&t.data)if(t.data.day<e)Utils.MsgUtils.addMidMsg("当前行程未开启");else if(e!=this.curDay){var i=this["btn_tabbarImg"+(this.curDay-1)];i&&(i.scaleX=i.scaleY=1)&&egret.Tween.removeTweens(i),this.curDay%2==0?i.bottom=0:i.bottom=96;var n=this["btn_tabbarImg"+(e-1)];if(n){var o=n.bottom;egret.Tween.get(n,{loop:!0}).to({bottom:o+15},1e3).to({bottom:o},1e3),n&&(n.scaleX=n.scaleY=1.1)}this.curDay=e,this.updateView()}},_.prototype.activateComponent=function(){for(var i=this,e=function(e){var t=n["btn_tabbarImg"+e];t&&t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.changeDay(e+1)},n)},n=this,t=0;t<7;t++)e(t)},_.prototype.onDestroy=function(){f.prototype.onDestroy.call(this)},_.local_notice=[],_}(r.ActivityCommonView);r.ActivityOtherDiamondGifts=e,__reflect(e.prototype,"game.ActivityOtherDiamondGifts");var n=function(a){function e(){var e=a.call(this)||this;return e.oldRatity=0,e.skinName="ActivityOtherDiamondGiftsItem",e}return __extends(e,a),e.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.curBuy>=this.data.canBuyTimes?Utils.MsgUtils.addMidMsg("已购买"):this.data.amounts<this.data.needRechared?Utils.MsgUtils.addMidMsg("未满足活动累充金额条件"):r.GameMVC.backpackPy.checkEnough(this.data.costs,!1)?this.getReward({code:this.data.activityType,num:1,id:this.data.code}):Utils.MsgUtils.addMidMsg("当前钻石不足")},this);var e=this.btn_operate.cui_freshCost.img_icon;e&&(e.scaleX=e.scaleY=.9),this.btn_operate.btn_oppr.skinName="skins.ButtonSkinYellow",this.btn_operate.cui_freshCost.left=void 0,this.btn_operate.cui_freshCost.horizontalCenter=-3,this.btn_hasBuy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.MsgUtils.addMidMsg("已购买")},this)},e.prototype.dataChanged=function(){var t=this;if(a.prototype.dataChanged.call(this),this.data){this.gp_rewards.removeChildren(),r.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,this.data.rewards),this.lb_name.text=this.data.name||"第"+this.data.needDay+"天";var i=this.data.curBuy>=this.data.canBuyTimes,e=this.data.ratity,n=this.data.amounts>=this.data.needRechared,o="xbrj_img_baoxiang"+(i?"0_":"1_")+(e-1)+"_png";this.img_box.source=o,this.img_box.visible=!0,n?i?(this.sgEffect&&(this.sgEffect.visible=!1),this.tdEffect&&(this.tdEffect.visible=!1)):(this.img_box.visible=!1,this.sgEffect&&(this.sgEffect.visible=!1),this.tdEffect&&this.oldRatity==e?this.tdEffect.visible=!0:(this.gp_effect.removeChildren(),UIActionManager.addEffect(this.gp_effect,"common_xunbaorijibxtd0"+e,{childIndex:0},function(e){t.tdEffect=e,t.tdEffect.visible=n&&!i}))):(5==e?this.sgEffect?this.sgEffect.visible=!0:UIActionManager.addEffect(this.gp_effect,"common_xunbaorijibxsg",{},function(e){t.sgEffect=e}):this.sgEffect&&(this.sgEffect.visible=!1),this.tdEffect&&(this.tdEffect.visible=!1)),this.oldRatity=e,i?(this.btn_operate.visible=!1,this.btn_hasBuy.visible=!0):(this.btn_operate.visible=!0,this.btn_hasBuy.visible=!1,this.data.costs[0][2]?this.btn_operate.cui_freshCost.updateItem({cost:this.data.costs[0],style:CommonIconStyle.RIGHT}):this.btn_operate.updateData({text:"领取"})),this.lb_tip.visible=!n,UIActionManager.setGrey(this.btn_operate,!n),this.lb_tip.textFlow=[{text:"累充达到",style:{textColor:16777215}},{text:this.data.needRechared+"",style:{textColor:16772466}},{text:"元可购买",style:{textColor:16777215}}]}},e.prototype.getReward=function(e,i){var n=this;if(this.data.activityType){var o=r.ActivityConfig.Config[this.data.activityType],a=o.getRewardName;a&&""!=a&&Utils.Socket.send("activity",a,e).then(function(e){GameRootLayer.gameLayer().switchTouchEnable(!1),console.log(o.name+"——领取",a+"R",e);var t=r.GameMVC.activityPy.allActivityData[n.data.activityType];n.tdEffect&&(n.tdEffect.visible=!1),n.img_box.visible=!0,n.img_box.source="xbrj_img_baoxiang0_"+(n.data.ratity-1)+"_png",DragonBoneTools.playOnce({parent:n.gp_effect,effectName:"common_xunbaorijibxtx",doneCB:function(){GameRootLayer.gameLayer().switchTouchEnable(!0),r.GameMVC.backpackPy.handleClientReward(e.clientReward,{closeCB:function(){t&&t.updateData(e.info)}})}}),i&&i(e)})}else console.log("没有声明活动code")},e}(eui.ItemRenderer);__reflect(n.prototype,"ActivityOtherDiamondGiftsItem")}(game||(game={})),function(h){var e=function(i){function e(e){var t=i.call(this)||this;return t.showType=0,t.skinName="ActivityProfessionSuitSelectSkin",t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.updateView(this.data),Utils.ComponentUtils.registerListener(this.btn_confirm,egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},e.prototype.updateView=function(e){var t=this;this.selectedId=this.opperationParams=e.selectedId,this.gp_box.removeChildren();var i=h.Config.HeroEquipCompound(),n=h.Config.getHeroEquipConfig();for(var o in this.showType=e.showType,i){var a=i[o];if(a.type==this.showType){var r=JSON.parse(a.rewards),s=n[r[0][1]].professionSuit,c={id:Number(o),rewards:r,profession:s,selected:this.selectedId==Number(o),selectCB:function(e){t.selectId(e)}},l=new p;l.updateItem(c),this.gp_box.addChild(l)}}},e.prototype.selectId=function(e){var t=e==this.selectedId?0:e;this.selectedId=this.opperationParams=t,this.gp_box.$children.forEach(function(e){e.updateSelected(e.data.id==t)})},e}(BasePanel);h.ActivityProfessionSuitSelect=e,__reflect(e.prototype,"game.ActivityProfessionSuitSelect");var p=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityProfessionSuitSelect_SelectBox",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.checkBox,egret.Event.CHANGE,function(){e.data.selectCB(e.data.id)},this)},e.prototype.updateItem=function(e){var i=this;this.data=e;var t=this.data.rewards;this.gp_baseItems.removeChildren(),t.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({code:e[1]}),i.gp_baseItems.addChild(t)});var n=this.data.profession;this.img_icon.source=ProfessionConfig[n].icon,this.lb_title.text=ProfessionConfig[n].name+"套装",this.updateSelected(this.data.selected)},e.prototype.updateSelected=function(e){this.data.selected=e,this.checkBox.selected=e},e}(eui.Component);__reflect(p.prototype,"ActivityProfessionSuitSelect_SelectBox")}(game||(game={})),function(h){var e=function(l){function e(){var e=l.call(this)||this;return e.code=EActivityType.ProfessionSuit,e.targetId=0,e.selectedUuids=[],e.skinName="ActivityProfessionSuitSkin",e}return __extends(e,l),e.prototype.childrenCreated=function(){var i=this;if(l.prototype.childrenCreated.call(this),this.activateComponent(),!this.commonConfig){var e=h.Config.HeroEquipCompound();for(var t in e){var n=e[t];if(2==n.type){this.commonConfig=n;break}}}this.gp_costs.removeChildren();var o=JSON.parse(this.commonConfig.costs);o.length&&o.forEach(function(e){var t=new customui.CommonIconWithNum;t.updateItem({cost:e,style:CommonIconStyle.RIGHT,needBg:!0}),i.gp_costs.addChild(t)})},e.prototype.updateView=function(e){var t=this;l.prototype.updateView.call(this,e);var i=[];if(this.targetId){var n=h.Config.HeroEquipCompound()[this.targetId];JSON.parse(n.rewards).forEach(function(e){i.push(e[1])})}var o=this.selectedUuids.length,a=this.commonConfig.num;this.blb_num.visible=!0,this.blb_num.font=o<a?"RedBlackStrocke_fnt":"green_num_fnt",this.blb_num.text=this.selectedUuids.length+"/"+this.commonConfig.num;for(var r=0;r<4;r++){var s=this.gp_preview.$children[r];s||(s=new p,this.gp_preview.addChild(s),Utils.ComponentUtils.registerListener(s,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new h.ActivityProfessionSuitSelect({selectedId:t.targetId,showType:HeroEquipCompoundType.ProfessionSuit}),closeCB:function(e){t.targetId=e,t.updateView()}})},this)),s.updateItem({code:i[r]})}var c=this.info.content[0];this.blb_limitTimes.text=""+(c-this.info.data.num),this.updateTime()},e.prototype.updateTime=function(){this.timer||(this.remainingDt=h.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime(),this.updateRemainingTime(),this.timer=egret.setInterval(this.updateRemainingTime,this,1e3))},e.prototype.updateRemainingTime=function(){0<this.remainingDt?this.blb_time.text=""+Utils.TimerManager.getFormatBySecond1(this.remainingDt--):h.AppFacade.getInstance().hideSubView(h.ActivityMediator.N,h.ActivityMediator.SV.MAIN)},e.prototype.activateComponent=function(){var a=this;Utils.ComponentUtils.registerListener(this.gp_slot,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new h.CommonChosePanel({getInfos:function(){var e={},t=h.GameMVC.heroThingPy.AllEquipInfo;for(var i in t){var n=t[i];if(n.config.color==a.commonConfig.color&&""==n.heroUuid&&0==n.config.professionSuit)for(var o=n.num;0<o--;)e[i+"#"+o]=n}return e},type:EEntityType.EEntityTypeHeroEquip,checkFull:function(e){return e.length>=a.commonConfig.num},selectUuids:a.selectedUuids,title:"请选择装备",uniNum:!0}),closeCB:function(){a.updateView()}})},this),Utils.ComponentUtils.registerListener(this.btn_forge,egret.TouchEvent.TOUCH_TAP,function(){if(a.targetId)if(a.selectedUuids.length<a.commonConfig.num)Utils.MsgUtils.addMidMsg("所需装备不足");else{var i={};a.selectedUuids.forEach(function(e){var t=e.split("#")[0];i[t]||(i[t]=0),i[t]+=1});var e=[];for(var t in i)e.push({equipUuid:t,num:i[t]});h.GameMVC.heroThingPy.HeroEquipCompound({id:a.targetId,uuidInfos:e,type:2,code:a.code,beforeCB:function(i){DragonBoneTools.playOnce({effectName:"common_tjjt",parent:a.gp_preview,y:-40,doneCB:function(){a.gp_preview.$children.forEach(function(e,t){DragonBoneTools.playOnce({effectName:"common_yingxiongfenjie",parent:e,doneCB:function(){t==a.gp_preview.numChildren-1&&i()}})})}})},cb:function(){a.selectedUuids.splice(0),a.targetId=0,a.updateView()}})}else Utils.MsgUtils.addMidMsg("请选择套装")},this),Utils.ComponentUtils.registerListener(this.btn_guide,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new h.HelpDialog({moduleId:MODULE.ActivityProfessionSuit})})},this)},e}(h.ActivityCommonView);h.ActivityProfessionSuitView=e,__reflect(e.prototype,"game.ActivityProfessionSuitView");var p=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityProfessionSuitView_EquipItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseItem.addChild(this.baseItem),UIActionManager.fadeBlink(this.img_add,!0,!1,500)},e.prototype.updateItem=function(e){this.data=e,this.data.code?(this.gp_empty.visible=!1,this.gp_baseItem.visible=!0,this.baseItem.updateData({code:this.data.code})):(this.gp_empty.visible=!0,this.gp_baseItem.visible=!1)},e}(eui.Component);__reflect(p.prototype,"ActivityProfessionSuitView_EquipItem")}(game||(game={})),function(g){var e=function(d){function e(){var e=d.call(this)||this;return e.isPlaying=!1,e.skinName="ActivityPushGiftBag",e.code=EActivityType.PushGiftBag,e}return __extends(e,d),e.prototype.childrenCreated=function(){var h=this;d.prototype.childrenCreated.call(this),this.gp_effect.visible=!1,this.gp_box.visible=!1,this.gp_main.visible=!1,this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=h.info;if(e&&e.data){var t=Utils.TimerManager.getServerOpenDays(),i=e.data.vipLevel,n=JSON.parse(e.content),o=[];for(var a in n){var r=n[a];if(r[0]==t)for(var s in r[1]){var c=r[1][s];c[1]==i&&(o=c[0])}}if(o){var l=g.GameMVC.rechargePy.getGoodInfo(o);l?g.GameMVC.rechargePy.purchase(l,2,String(o),JSON.stringify({uuid:o,activityType:h.code}),{activityType:h.code}):Utils.MsgUtils.addMidMsg("找不到商品配置")}else Utils.MsgUtils.addMidMsg("找不到商品id")}},this),this.img_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){h.isPlaying||(h.gp_effect.visible=!1,Utils.LocalStorageUtil.setTodayVaild("PUSH_GIFT_BAG"),h.showBox())},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){h.hide()},this),DragonBoneTools.create("common_jingxilibao_03",function(e){e.x=this.gp_box.width/2,e.y=this.gp_box.height/2,e.animation.play(),this.gp_box.addChild(e)},this),DragonBoneTools.create("common_jingxilibao_2_01",function(e){e.x=this.gp_bottom.width/2,e.y=this.gp_bottom.height/2+90,e.animation.play(),this.gp_bottom.addChild(e)},this),DragonBoneTools.create("common_buxiudebaozang_2",function(e){e.x=this.gp_bottom.width/2,e.y=this.gp_bottom.height/2+110,e.scaleX=.84,e.animation.play(),this.gp_bottom.addChild(e)},this)},e.prototype.updateView=function(e){d.prototype.updateView.call(this,e);var t=this.info;if(t&&t.data){if(0<t.data.purchaseTime&&(g.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN),this.hide()),!Utils.LocalStorageUtil.getTodayVaild("PUSH_GIFT_BAG"))this.gp_effect.visible=!0,this.isPlaying=!0,MovieClipTools.create("common_jingxilibao_2_03",function(e){e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2-110,e.animation.play("common_jingxilibao_2_03",1),this.gp_effect.addChild(e)},this),DragonBoneTools.create("common_jingxilibao_2_02",function(e){e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2-10,e.animation.play("common_jingxilibao_2_02",0),this.gp_effect.addChild(e)},this),MovieClipTools.create("common_jingxilibao_01",function(e){e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2+90,e.animation.play("common_jingxilibao_01",1),this.gp_effect.addChild(e),e.addEventListener(egret.Event.COMPLETE,function(){this.isPlaying=!1},this)},this);else{this.gp_box.visible=!0,this.gp_main.visible=!0,this.gp_rewards.removeChildren();var i=Utils.TimerManager.getServerOpenDays(),n=t.data.vipLevel,o=JSON.parse(t.content),a=[],r=0;for(var s in o){var c=o[s];if(c[0]==i)for(var l in c[1]){var h=c[1][l];h[1]==n&&(r=h[0],a=h[2])}}g.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,a);var p=g.GameMVC.rechargePy.getGoodInfo(r);this.btn_buy.label=p?p.price+"元":"error"}this.updateTime()}},e.prototype.showBox=function(){var t=this;this.gp_box.visible=!0,DragonBoneTools.playOnce({effectName:"common_jingxilibao_02",parent:this.gp_box,x:this.gp_box.width/2,y:this.gp_box.height/2+30,doneCB:function(e){t.showRewards()}})},e.prototype.showRewards=function(){var t=this;this.gp_main.visible=!0;var e=this.info;if(e&&e.data){GameRootLayer.gameLayer().switchTouchEnable(!1);var i,n=Utils.TimerManager.getServerOpenDays(),o=e.data.vipLevel,a=JSON.parse(e.content),r=[];for(var s in a){var c=a[s];if(c[0]==n)for(var l in c[1]){var h=c[1][l];h[1]==o&&(r=h[2],i=h[0])}}var p=0,d=function(){if(r[p]){var e=t.makeRewardsItem(r[p],d);t.gp_rewards.addChild(e),p++}};GameRootLayer.gameLayer().switchTouchEnable(!0);var u=g.GameMVC.rechargePy.getGoodInfo(i);this.btn_buy.label=u?u.price+"元":"error",d(),egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this,5e3)}},e.prototype.makeRewardsItem=function(e,t,i){void 0===i&&(i=!0);var n=new eui.Group;n.width=n.height=105,n.scaleX=n.scaleY=.8;var o=customui.BaseItemFactory.create();return o.horizontalCenter=o.verticalCenter=0,o.updateData({reward:e}),o.visible=!1,n.addChild(o),i?DragonBoneTools.playOnce({effectName:"common_choukayingxiong",parent:n,doneCB:function(){o.visible=!0,t&&t()}}):t(),n},e.prototype.updateTime=function(){var e=this,t=g.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text=Utils.TimerManager.getFormatBySecond1(t),egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<--t?e.bm_time.text=Utils.TimerManager.getFormatBySecond1(t):e.hide()},this,1e3)},e}(g.ActivityCommonPanel);g.ActivityPushGiftBag=e,__reflect(e.prototype,"game.ActivityPushGiftBag")}(game||(game={})),function(l){var e=function(a){function e(e,t,i,n){var o=a.call(this)||this;return o.skinName="CommonUpgradePreviewSkin",o.config=e,o.formatString=t,o.curLevel=i,o.title=n,o}return __extends(e,a),e.prototype.childrenCreated=function(){var e=this;a.prototype.childrenCreated.call(this),this.CommonXiaoTanChuKuang.onCloseCB=function(){PopUpManager.removePopUp(e)},this.scroller_list.scrollPolicyH=eui.ScrollPolicy.OFF,this.scroller_list.verticalScrollBar.visible=!1,this.scroller_list.verticalScrollBar.autoVisibility=!1,this.CommonXiaoTanChuKuang.blb_title.text=this.title;var t=new eui.List;t.itemRenderer=o;var i=this.generateData();t.dataProvider=new eui.ArrayCollection(i);var n=new eui.TileLayout;n.verticalGap=6,t.layout=n,this.gp_list.addChild(t)},e.prototype.generateData=function(){var e=new Array;for(var t in this.config){var i=this.config[t],n=!1;i.level<=this.curLevel&&(n=!0);var o=this.formatString.format([i.level]),a="0",r=void 0;for(var s in i.attrAdd&&""!=i.attrAdd&&(r=JSON.parse(i.attrAdd)),r){var c=r[s];c[0]==EAttrType.Atk&&(a=l.GeneralConfig.getAttrValue(Number(c[1]?c[1]:"0")))}e.push({activated:n,desc:o,attrAdd:a})}return e},e}(BasePanel);l.CommonUpgradePreview=e,__reflect(e.prototype,"game.CommonUpgradePreview");var o=function(t){function e(){var e=t.call(this)||this;return e.skinName="ItemRenderSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.img_bg.source=this.data.activated?"pokemon_img_jihuotiao_01_png":"pokemon_img_jihuotiao_02_png",this.img_icon.source=this.data.activated?"pokemon_img_yijihuozhuangshi_png":"pokemon_img_weijiesuozhuangshi_png",this.img_status.source=this.data.activated?"pokemon_txt_yijihuo_png":"subsidiary_txt_weijihuo_png",this.lb_requireLevel.text=this.data.desc,this.lb_desc.text="上阵精灵全属性+"+this.data.attrAdd},e}(eui.ItemRenderer);__reflect(o.prototype,"ItemRender")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.GuanZhuGongZhongHao,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.lb_title.text="关注公众号礼包"},e.prototype.updateView=function(e){t.prototype.updateView.call(this,e),this.okCB=function(){Utils.SDKMgr.cmd({type:"GuanZhuGongZhongHao"})}},e}(e.ActivitySDKCommonView);e.ActivitySDKGZHView=t,__reflect(t.prototype,"game.ActivitySDKGZHView")}(game||(game={})),function(n){var e=function(i){function e(){var e=i.call(this)||this;return e.code=EActivityType.ShiMingRenZheng,e}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.lb_title.text="实名认证礼包"},e.prototype.updateView=function(e){var t=this;i.prototype.updateView.call(this,e),this.okCB=function(){Utils.SDKMgr.cmd({type:"ShiMingRenZheng",cb:function(){if(getUrlKV().Act_ShiMingRenZheng){n.AppFacade.getInstance().retrieveProxy(n.ActivityPy.N);n.GameMVC.activityPy.getOperationReward(OperationType.Act_ShiMingRenZheng),Utils.MsgUtils.addMidMsg("奖励已通过邮件发放，请查收")}}}),t.hide()}},e}(n.ActivitySDKCommonView);n.ActivitySDKSMRZView=e,__reflect(e.prototype,"game.ActivitySDKSMRZView")}(game||(game={})),function(t){var e=function(i){function e(){var e=i.call(this)||this;return e.code=EActivityType.WeiDuanXiaZai,e}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.lb_tips.visible=!1,this.lb_title.text="微端下载礼包"},e.prototype.check=function(){if(getUrlKV().Act_WeiDuanXiaZai){t.AppFacade.getInstance().retrieveProxy(t.ActivityPy.N);return t.GameMVC.activityPy.getOperationReward(OperationType.Act_AppDownload),Utils.MsgUtils.addMidMsg("奖励已通过邮件发放，请查收"),!0}return!1},e.prototype.updateView=function(e){var t=this;i.prototype.updateView.call(this,e),this.okCB=function(){t.check()||Utils.SDKMgr.cmd({type:"WeiDuanXiaZai",cb:function(){t.check()}}),t.hide()}},e}(t.ActivitySDKCommonView);t.ActivitySDKWDXZView=e,__reflect(e.prototype,"game.ActivitySDKWDXZView")}(game||(game={})),function(m){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectIndex=0,e.hasInitTabbar=!1,e.rechargegGradient=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tabbar=new eui.TabBar,this.tabbar.itemRendererSkinName="ActivitySecondContinueRechargeRewardTabbar",this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabbarTap,this),this.tabbar.left=this.tabbar.bottom=0,this.gp_title.addChild(this.tabbar);var e=new eui.Image;e.source="lxlc_img_yeqiandixian_png",e.bottom=0,e.horizontalCenter=0,this.gp_title.addChild(e),this.bm_time.right=-60,this.bm_time.y-=30},e.prototype.onTabbarTap=function(e){this.selectIndex=e.itemIndex,this.updateView()},e.prototype.updateView=function(e){var t=this;this.code=e&&e.activityType||e&&e.code||this.code;var i=this.info;if(i&&i.data){if(this.updateTitle(),!this.hasInitTabbar){var n=JSON.parse(i.content);for(var o in n){var a=n[o];this.rechargegGradient.indexOf(a[0])<0&&this.rechargegGradient.push(a[0])}this.rechargegGradient.sort(function(e,t){return e-t});var r=[];this.rechargegGradient.forEach(function(e){r.push({up:"lxlc_img_yeqian1_png",down:"lxlc_img_yeqian2_png",text:e+"元"})}),this.tabbar.dataProvider=new eui.ArrayCollection(r),this.tabbar.once(eui.UIEvent.ENTER_FRAME,function(){t.updateNotice()},this)}var s=this.getDataList();this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(s):this.list_itemList.dataProvider=new eui.ArrayCollection(s),this.updateTitle(),this.updateNotice()}},e.prototype.getDataList=function(){var h=this,e=this.info;if(!e||!e.data)return[];var p=e.data.amounts,d=JSON.parse(e.data.targeted),u=JSON.parse(e.data.rechargeDays),t=JSON.parse(e.content);if(!t)return[];var g=[],f=this.rechargegGradient[this.selectIndex];for(var i in t){var n=t[i];if(n[0]==f){var _=n[1],o=function(e){var t=_[e],i=t[0],n=t[1],o=t[2],a=0;for(var r in u)if(u[r][0]==f){a=u[r][1];break}var s=REWARD_STATUS.UNAVAILABLE;for(var c in s=f<=p?a<n?REWARD_STATUS.UNAVAILABLE:REWARD_STATUS.AVAILABLE:a<n-1?REWARD_STATUS.UNAVAILABLE:a==n-1?REWARD_STATUS.GO_RECHARGE:REWARD_STATUS.AVAILABLE,d){if(d[c][0]==i){s=REWARD_STATUS.RECEIVED;break}}var l={id:i,title:"连续充值"+n+"天可领取",tips:s==REWARD_STATUS.UNAVAILABLE?"未解锁":a+"/"+n,rewards:o,status:s,btnFunc:function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:h.getReward({id:i,code:h.code});break;case REWARD_STATUS.GO_RECHARGE:m.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未解锁")}}};g.push(l)};for(var a in _)o(a)}}return g.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id}),g},e.prototype.updateNotice=function(){var e=this.info;if(e&&e.data){e.data.amount;var t=JSON.parse(e.data.targeted),i=JSON.parse(e.data.rechargeDays),n=JSON.parse(e.content);if(!n)return[];for(var o=0;o<this.rechargegGradient.length;o++){var a=this.rechargegGradient[o];for(var r in n){var s=n[r];if(s[0]==a){var c=s[1];for(var l in c){var h=c[l],p=h[0],d=h[1],u=(h[2],0);for(var g in i)if(i[g][0]==a){u=i[g][1];break}var f=REWARD_STATUS.GO_RECHARGE;for(var _ in d<=u&&(f=REWARD_STATUS.AVAILABLE),t){if(t[_][0]==p){f=REWARD_STATUS.RECEIVED;break}}var m=this.tabbar.$children[o];if(m){var y=m.img_notice;if(y&&(y.visible=f==REWARD_STATUS.AVAILABLE,y.visible))break}}}}}}},e}(m.ActivityCommonListView);m.ActivitySecondContinueRechargeReward=e,__reflect(e.prototype,"game.ActivitySecondContinueRechargeReward")}(game||(game={})),function(_){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.SecondOpenServerRecharge,Utils.AssetsMgr.loadGroup("group_hero_arrives"),e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_hero_arrives")},e.prototype.getDataList=function(){var l=this,e=this.info;if(!e||!e.data)return[];var h,t=e.content,p=e.data.amount,d=JSON.parse(e.data.targeted),i=e.data.curCycle||1;for(var n in t[1]){var o=t[1][n];if(o[0]==i){h=o[1];break}}if(!h)return[];var u=[],g=1,a=function(e){var t=h[e],i=t[1],n=t[2],o=t[3]||1,a=REWARD_STATUS.AVAILABLE;-1!=d.indexOf(t[0])?a=REWARD_STATUS.RECEIVED:p<i&&(a=REWARD_STATUS.GO_RECHARGE);var r="累计充值 "+t[1]+" 元可领取";0<=[EActivityType.FourthOpenServerRecharge,EActivityType.FourthOpenServerRecharge1,EActivityType.FourthOpenServerRecharge2,EActivityType.FourthOpenServerRecharge3].indexOf(f.code)&&(r="今日充值任意金额可领取");var s={id:i,title:t[1]?r:"免费领取",tips:t[1]?p+"/"+i:"",rewards:n,status:a,btnFunc:function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:l.getReward({id:t[0],code:l.code});break;case REWARD_STATUS.GO_RECHARGE:_.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};if(g<o){var c=!0;if(u.forEach(function(e){e.status!=REWARD_STATUS.RECEIVED&&(c=!1)}),!c)return"break";if(!h[parseInt(e)+1])return u.push(s),"break";g=o,u.splice(0,u.length),u.push(s)}else u.push(s)},f=this;for(var r in h){if("break"===a(r))break}return u.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id}),u},e}(_.ActivityCommonListView);_.ActivitySecondOpenServerRecharge=e,__reflect(e.prototype,"game.ActivitySecondOpenServerRecharge")}(game||(game={})),function(m){var e=function(t){function e(){var e=t.call(this)||this;return e.hasInit=!1,e.listHeight=0,e.find=!1,e.skinName="ActivitySeventhOpenServerRecharge",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list_root.itemRenderer=i},e.prototype.updateView=function(e){var t=this;this.code=e&&e.activityType||e&&e.code||this.code;var i=this.info;if(i&&i.data){this.bm_cur.text=i.data.amount,this.updateTitle();var n=this.getDataList();this.list_root.dataProvider?this.list_root.dataProvider.replaceAll(n):this.list_root.dataProvider=new eui.ArrayCollection(n);var o=0,a=void 0;for(var r in n){var s=n[r];if(null==a&&s.status!=REWARD_STATUS.RECEIVED&&(a=parseInt(r)),s.select){(o=parseInt(r))<0&&(o=0);break}}if(this.hasInit){if(0<a){var c=132*(a-0);c>this.list_root.height-this.sl_root.height&&(c=this.list_root.height-this.sl_root.height),this.sl_root.viewport.scrollV=c}}else this.pb_progress.value=0,this.pb_progress.maximum=1e3*n.length,this.list_root.once(egret.TimerEvent.ENTER_FRAME,function(){if(t.pb_progress.width=t.list_root.height,0<a){var e=132*(a-0);e>t.list_root.height-t.sl_root.height&&(e=t.list_root.height-t.sl_root.height),t.sl_root.viewport.scrollV=e}t.find||(t.img_arrow.top=t.pb_progress.width-40)},this),this.hasInit=!0;this.find?(this.img_arrow.top=0==o?50:132*o+20,this.pb_progress.value=1e3*o+400):(this.pb_progress.value=this.pb_progress.maximum,this.img_arrow.top=this.pb_progress.width-40)}},e.prototype.updateTitle=function(){var e=this,t=this.actProxy.allActivityData[this.code];if(this.code==EActivityType.LevelReward)this.bm_time.text="";else if(t&&this.bm_time){var i=m.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(i),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=i--?e.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(i):m.AppFacade.getInstance().hideSubView(m.ActivityMediator.N,m.ActivityMediator.SV.MAIN)},this,1e3)}},e.prototype.getDataList=function(){var l=this,e=this.info;if(!e||!e.data)return[];var h,t=e.content,p=e.data.amount,d=JSON.parse(e.data.targeted),i=e.data.curCycle||1;for(var n in t[1]){if((c=t[1][n])[0]==i){h=c[1];break}}if(!h)return[];var u=[],g=1,o=function(e){var t=h[e],i=t[1],n=t[2],o=t[3]||1,a=REWARD_STATUS.AVAILABLE;-1!=d.indexOf(t[0])?a=REWARD_STATUS.RECEIVED:p<i&&(a=REWARD_STATUS.GO_RECHARGE);var r="累计充值 "+t[1]+" 元可领取";0<=[EActivityType.FourthOpenServerRecharge,EActivityType.FourthOpenServerRecharge1,EActivityType.FourthOpenServerRecharge2,EActivityType.FourthOpenServerRecharge3].indexOf(f.code)&&(r="今日充值任意金额可领取");var s={id:i,title:t[1]?r:"免费领取",tips:t[1]?p+"/"+i:"",rewards:n,isAnother:t[4],status:a,btnFunc:function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:l.getReward({id:t[0],code:l.code});break;case REWARD_STATUS.GO_RECHARGE:m.MainJumpConfig.jumpTo(MODULE.Recharge);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};if(g<o){var c=!0;if(u.forEach(function(e){e.status!=REWARD_STATUS.RECEIVED&&(c=!1)}),!c)return"break";if(!h[parseInt(e)+1])return u.push(s),"break";g=o,u.splice(0,u.length),u.push(s)}else u.push(s)},f=this;for(var a in h){if("break"===o(a))break}for(var n in u){if((c=u[n]).isAnother)for(var r in u){var s=u[r];s.isAnother||s.id!=c.id||(u[r].anotherData=c)}}for(var n in u){var c;(c=u[n]).isAnother&&u.splice(parseInt(n),1)}for(var n in u.sort(function(e,t){return e.id-t.id}),u)u[n].index=parseInt(n)+1;this.find=!1;for(var _=0;_<u.length;_++)if(p<u[_].id){0==_?u[0].select=!0:u[_-1].select=!0,this.find=!0;break}return this.find||(u[u.length-1].select=!0),u},e}(m.ActivityCommonView);m.ActivitySeventhOpenServerRecharge=e,__reflect(e.prototype,"game.ActivitySeventhOpenServerRecharge");var i=function(i){function e(){var e=i.call(this)||this;return e.skinName="ActivitySeventhOpenServerRechargeItem",e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.lb_tips.visible=!1,this.bm_max.text="",UIActionManager.addEffect(this.gp_btn,"common_baoxiang_5",{},function(e){e&&(e.scaleX=e.scaleY=.8,t.box_effect=e,t.box_effect.visible=!(!t.data||!t.data.anotherData||t.data.anotherData.status!=REWARD_STATUS.AVAILABLE))}),this.gp_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.data.anotherData;e?e.status==REWARD_STATUS.AVAILABLE?(t.box_effect&&(t.box_effect.visible=!1),t.btn_box.visible=!0,t.btn_box.icon="jiangli_icon_baoxiang05_02_png",DragonBoneTools.playOnce({parent:t.gp_btn,effectName:"common_xunbaorijibxtx",doneCB:function(){e.btnFunc&&e.btnFunc(e)}})):m.AppFacade.getInstance().showSubView(m.CommonMediator.N,m.CommonMediator.SV.REWARD_PANEL,{rewards:e.rewards,type:m.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN}):Utils.MsgUtils.addMidMsg("数据错误")},this)},e.prototype.dataChanged=function(){i.prototype.dataChanged.call(this),this.img_select.visible=!!this.data.select;var e=[{text:"累充"+this.data.id+"元",style:{textColor:16577473,size:20}}];if(this.data.status==REWARD_STATUS.GO_RECHARGE&&e.push({text:"（ 未达到 ）",style:{textColor:16771584,size:22}}),this.lb_title.textFlow=e,this.data.anotherData){this.btn_box.visible=!0,this.bm_cur.visible=!0,this.bm_max.visible=!0;var t=this.data.anotherData;t.status==REWARD_STATUS.RECEIVED?this.btn_box.icon="jiangli_icon_baoxiang05_02_png":t.status==REWARD_STATUS.AVAILABLE?(this.btn_box.icon="",this.box_effect&&(this.box_effect.visible=!0)):this.btn_box.icon="jiangli_icon_baoxiang05_01_png",this.bm_cur.text=this.data.id+"元"}else this.btn_box.visible=!1,this.bm_cur.visible=!1,this.bm_max.visible=!1},e}(m.ActivityCommonListItem);__reflect(i.prototype,"ActivitySeventhOpenServerRechargeItem")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.ActivityShop,e.skinName="ActivityCommonShopListViewSkin",e}return __extends(e,t),e.prototype.initList=function(){this.list_itemList.itemRenderer=a.ShopActiviteUI},e.prototype.purchaseList=function(e,t){for(var i=0;i<e.length;i++)if(e[i].code==t)return e[i].num;return 0},e.prototype.getDataList=function(){for(var l=this,e=this.info,h=(e.data.curCycle,e.data.purchaseList),t=e.data.curDay,p=e.content[1][0][1][t-1],d=[],i=function(e){var t=p[e],i=t[0],n=t[1],o=t[2],a=t[3],r=t[4],s=n[0][2]-u.purchaseList(h,i),c={title:"等级达到级",code:i,reward:n,costs:o,discount:a,buyNum:r,times:s,btnFunc:function(){l.getReward({code:i,num:1,time:s})}};d.push(c)},u=this,n=0;n<p.length;n++)i(n);return d},e.prototype.getReward=function(e,t){var i=this;if(this.code)if(this.code==EActivityType.ActivityShop&&e.time<=0)Utils.MsgUtils.addMidMsg("库存不足");else{var n=a.ActivityConfig.Config[this.code],o=n.getRewardName;o&&""!=o&&Utils.Socket.send("activity",o,{code:e.code,num:1}).then(function(e){i.log(n.name+"——领取",o+"R",e),i.code==EActivityType.ActivityShop&&Utils.MsgUtils.addMidMsg("购买成功"),i.info.updateData(e.info),i.backpackProxy.handleClientReward(e.clientReward),t&&t(e)})}else this.log("没有声明活动code")},e}(a.ActivityCommonListView);a.ActivityShop=e,__reflect(e.prototype,"game.ActivityShop")}(game||(game={})),function(o){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.ShouCangYouLi,e.skinName="ActivityShouCangYouLiViewSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent()},e.prototype.updateView=function(e){var t=this,i=o.Config.operationConfig()[OperationType.Act_ShouCangYouLi],n=o.GameMVC.activityPy.operationHasExec(OperationType.Act_ShouCangYouLi);o.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,JSON.parse(i.reward)),Utils.SDKMgr.getPerformConfig(10018)&&Utils.SDKMgr.getPerformConfig(15)&&(this.btn_copy.label="收藏",this.btn_copy.y=262,this.btn_copy.x=271,this.img_bg.source="scbz_img_shoucang_png",egret.setTimeout(function(){n=o.GameMVC.activityPy.operationHasExec(OperationType.Act_ShouCangYouLi),t.lb_getTips.visible=!0,t.lb_getTips.text=n?"您的收藏奖励已发送过":"收藏后可在邮件中领取",UIActionManager.setGrey(t.gp_rewards,n)},this,200))},e.prototype.activateComponent=function(){var e=this;this.lb_getTips.visible=!1,Utils.ComponentUtils.registerListener(this.btn_close,egret.TouchEvent.TOUCH_TAP,function(){e.hide()}),Utils.ComponentUtils.registerListener(this.btn_copy,egret.TouchEvent.TOUCH_TAP,function(){Utils.SDKMgr.getPerformConfig(10018)&&Utils.SDKMgr.getPerformConfig(15)?Utils.SDKMgr.addShortcut({title:Utils.agentConfig.htmlName},function(){o.AppFacade.getInstance().retrieveProxy(o.ActivityPy.N);o.GameMVC.activityPy.getOperationReward(OperationType.Act_ShouCangYouLi),Utils.MsgUtils.addMidMsg("已经添加到桌面")}):Utils.SDKMgr.copyToClipBoard(getUrlKV().gameUrl||Utils.agentConfig.gameUrl||window.location.href,function(e){0==e?Utils.MsgUtils.addMidMsg("复制成功"):Utils.MsgUtils.addMidMsg("复制失败，请点击右上角尝试其他方式")})})},e}(BasePanel);o.ActivityShouCangYouLiView=e,__reflect(e.prototype,"game.ActivityShouCangYouLiView")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.SignIn,Utils.AssetsMgr.loadGroup("group_signin"),e.skinName="ActivitySignInViewSkin",e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer),Utils.AssetsMgr.destroyGroup("group_signin")},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList()},e.prototype.initList=function(){this.list_itemList.itemRenderer=n,this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF},e.prototype.getDataList=function(){for(var e=this,t=this.info,i=t.data.count,n=t.data.dayIndex,o=t.content,a=[],r=0;r<o.length;r++){var s=o[r],c=(s[0],s[1],s[2]),l=(REWARD_STATUS.AVAILABLE,{num:r,dayIndex:n,rewards:c,count:i,status:n<r?REWARD_STATUS.UNAVAILABLE:r<n?REWARD_STATUS.RECEIVED:1==i?REWARD_STATUS.UNAVAILABLE:REWARD_STATUS.AVAILABLE,btnFunc:function(){e.getReward({})}});a.push(l)}return a.sort(function(e,t){return e.num-t.num}),a},e.prototype.updateView=function(e){this.updateTitle();var t=this.getDataList();this.list_itemList.dataProvider?this.list_itemList.dataProvider.replaceAll(t):this.list_itemList.dataProvider=new eui.ArrayCollection(t)},e.prototype.updateTitle=function(){var e=i.Config.activityConfigs()[this.code];this.actProxy.allActivityData[this.code];e&&this.img_title&&(this.img_title.source=JSON.parse(e.img_title)[0]+"_png"),this.bm_time.text=""},e}(i.ActivityCommonView);i.ActivitySignIn=e,__reflect(e.prototype,"game.ActivitySignIn");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivitySignInItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;this.baseItem=customui.BaseItemFactory.create(),this.gp_reward.addChild(this.baseItem),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){switch(e.data.status){case REWARD_STATUS.UNAVAILABLE:PopUpManager.addPopUp({obj:new i.BaseItemDetailView({code:e.data.rewards[0][1],type:e.data.rewards[0][0]})});break;case REWARD_STATUS.AVAILABLE:e.data.btnFunc&&e.data.btnFunc();break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("奖励已领取")}},this)},e.prototype.dataChanged=function(){switch(this.data.status){case REWARD_STATUS.UNAVAILABLE:this.img_signed.visible=!1,this.img_bg.source="newactivity_img_dikuan01_png";break;case REWARD_STATUS.AVAILABLE:this.img_signed.visible=!1,this.img_bg.source="newactivity_img_dikuan03_png";break;case REWARD_STATUS.RECEIVED:this.img_signed.visible=!0,this.img_bg.source="newactivity_img_dikuan02_png"}this.baseItem.reset(),this.baseItem.touchEnabled=!1,this.baseItem.scaleX=this.baseItem.scaleY=.933,this.baseItem.horizontalCenter=this.baseItem.verticalCenter=1,this.baseItem.updateData({reward:this.data.rewards[0]})},e}(eui.ItemRenderer);i.ActivitySignInItem=n,__reflect(n.prototype,"game.ActivitySignInItem")}(game||(game={})),function(p){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.code=EActivityType.SingleRecharge,e}return __extends(e,t),e.prototype.getDataList=function(){var r=this,e=this.info,t=e.content,i=e.data.day,s=e.data.rechargeInfo,c=e.data.targetedInfo,l=p.Config.getRechargeConfig(),n=t[0];for(var o in t){var a=t[o];if(a[0]==i){n=a[1];break}}var h=[];return n.forEach(function(e){var t=e[0],i=e[1],n=e[2],o=REWARD_STATUS.UNAVAILABLE;c.some(function(e){return e.id==t})?o=REWARD_STATUS.RECEIVED:s.some(function(e){return e.id==t&&0<e.num})&&(o=REWARD_STATUS.AVAILABLE);var a={id:t,title:"充值"+l[i].money+"元档次",rewards:n,status:o,btnFunc:function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:r.getReward({id:t});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取")}}};h.push(a)}),h.sort(function(e,t){return e.status!=t.status?e.status-t.REWARD_STATUS:e.id-t.id}),h},e}(p.ActivityCommonListView);p.ActivitySingleRecharge=e,__reflect(e.prototype,"game.ActivitySingleRecharge")}(game||(game={})),function(g){var e=function(c){function e(){var e=c.call(this)||this;return e.skinName="ActivitySixtyEightYuanGifts",e.code=EActivityType.SixtyEightYuanGifts,e}return __extends(e,c),e.prototype.childrenCreated=function(){var e=this;c.prototype.childrenCreated.call(this),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btnFunc&&e.btnFunc()},this)},e.prototype.updateView=function(e){var h=this;c.prototype.updateView.call(this,e);var t=this.info;if(t&&t.data&&g.ActivityConfig.Config[this.code]){var p=t.data.targeted,i=t.content,n=(t.data.key,t.data.day),d=[];for(var o in i){var a=i[o];a[0]==n&&d.push(a)}if(!d.length)return[];for(var r=function(e){var t=d[e],o=(t[0],t[1]),a=t[2],i=t[3];t[4];u.gp_reward.removeChildren(),g.GameMgr.getInstance().CommonGpAddReward(u.gp_reward,i);var r=REWARD_STATUS.CANBUY,n=!1;for(var s in p){if(p[s].id==o){n=!0;break}}n&&(r=REWARD_STATUS.RECEIVED),u.updateBtn(u.btn,r);var c=g.AppFacade.getInstance().retrieveProxy(g.RechargePy.N).goodList;for(var s in c){var l=c[s];l.id==a&&(u.lb_price.text="售价："+l.price+"元")}u.btnFunc=function(){switch(r){case REWARD_STATUS.CANBUY:var e=g.AppFacade.getInstance().retrieveProxy(g.RechargePy.N),t=e.goodList;for(var i in t){var n=t[i];if(n.id==a)return void e.purchase(n,2,o,JSON.stringify({activityType:h.code,uuid:o}),{activityType:h.code})}Utils.MsgUtils.addMidMsg("找不到商品信息");break;case REWARD_STATUS.RECEIVED:return void Utils.MsgUtils.addMidMsg("已购买")}}},u=this,s=0;s<d.length;s++)r(s)}},e.prototype.updateBtn=function(e,t){switch(t){case REWARD_STATUS.RECEIVED:e.skinName="skins.ButtonSkinSure",e.label="已领取",UIActionManager.setGrey(e,!1),e.scaleX=e.scaleY=1,UIActionManager.hideEffect(e);break;case REWARD_STATUS.GO_RECHARGE:e.skinName="skins.ButtonSkinYellow",e.label="充值",UIActionManager.setGrey(e,!1),e.scaleX=e.scaleY=.8,UIActionManager.hideEffect(e);break;case REWARD_STATUS.CANBUY:e.skinName="skins.ButtonSkinYellow",e.label="购买",UIActionManager.setGrey(e,!1),e.scaleX=e.scaleY=.8,UIActionManager.hideEffect(e);break;default:e.label="领取",UIActionManager.setGrey(e,!1),e.skinName="skins.ButtonSkinYellow",e.scaleX=e.scaleY=.8,UIActionManager.addEffect(e,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2})}},e}(g.ActivityCommonPanel);g.ActivitySixtyEightYuanGifts=e,__reflect(e.prototype,"game.ActivitySixtyEightYuanGifts")}(game||(game={})),function(C){var e=function(t){function e(){var e=t.call(this)||this;return e.img_arrow=new eui.Image,e.skinName="ActivityThirdDiamondGifts",e}return __extends(e,t),e.prototype.initList=function(){var e=this;this.list_itemList.itemRenderer=i;var t=new eui.TileLayout;t.requestedColumnCount=2,t.horizontalAlign=egret.HorizontalAlign.CENTER,t.horizontalGap=40,t.verticalGap=40,t.paddingLeft=65,t.paddingRight=65,t.columnAlign=eui.ColumnAlign.LEFT,this.list_itemList.layout=t,this.img_arrow.source="sycx_img_jiantou_png",this.img_arrow.rotation=90,this.img_arrow.bottom=0,this.img_arrow.horizontalCenter=0,this.img_arrow.visible=!1,this.img_arrow.scaleX=this.img_arrow.scaleY=1.2,egret.Tween.get(this.img_arrow,{loop:!0}).to({bottom:10},500).to({bottom:0},500),this.addChild(this.img_arrow),this.sl_root.addEventListener(egret.Event.CHANGE,function(){e.img_arrow.visible=e.sl_root.viewport.scrollV<e.list_itemList.contentHeight-e.sl_root.height},this),this.sl_root.once(egret.Event.ENTER_FRAME,function(){e.img_arrow.visible=e.sl_root.viewport.scrollV<e.list_itemList.contentHeight-e.sl_root.height},this),this.sl_root.height=610},e.prototype.getDataList=function(){var i=this,e=this.info;if(e&&e.data){var t,n=e.data.targeted,o=e.content,a=e.data.curCycle||1;for(var r in o[1]){if((l=o[1][r])[0]==a){t=l[1];break}}if(!t)return[];for(var s=[],c=0;c<t.length;c++){var l,h=(l=t[c])[0],p=l[1],d=l[2],u=l[3],g=l[4],f=l[5],_=l[6],m=REWARD_STATUS.CANBUY,y=0;for(var r in n){var v=n[r];if(v.id==h){y=v.num;break}}u<=y&&(m=REWARD_STATUS.HASBUY);var T={id:h,tips:y+"/"+u,rewards:p,status:m,costs:d,discount:g,icon:f,title:_,btnFunc:function(e){switch(e.status){case REWARD_STATUS.CANBUY:Utils.Socket.send("activity","BuyExchangeGifts",{code:i.code,giftCode:e.id,num:1}).then(function(e){C.AppFacade.getInstance().retrieveProxy(C.ActivityPy.N).updateData_View_Reward(i.code,e)});break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.HASBUY:Utils.MsgUtils.addMidMsg("已购买")}var t=C.AppFacade.getInstance().retrieveMediator(C.ActivityMediator.N).getSubView(C.ActivityMediator.SV.MAIN);t&&t.updateResourceBar()}};s.push(T)}return s.sort(function(e,t){return e.id-t.id}),s}},e}(C.ActivityCommonListView);C.ActivityThirdDiamondGifts=e,__reflect(e.prototype,"game.ActivityThirdDiamondGifts");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityThirdDiamondGiftsItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data&&e.data.btnFunc&&e.data.btnFunc(e.data)},this),this.btn_buy.cui_freshCost.left=void 0,this.btn_buy.cui_freshCost.horizontalCenter=0},e.prototype.dataChanged=function(){switch(this.lb_titile.text=this.data.title,this.data.icon&&(this.img_icon.source=this.data.icon+"_png"),this.bm_discount.text=parseInt(this.data.discount)/10+"",this.gp_rewards.removeChildren(),C.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,this.data.rewards,.6),this.data.status){case REWARD_STATUS.CANBUY:case REWARD_STATUS.UNAVAILABLE:this.btn_buy.btn_oppr.skinName="skins.ButtonSkinYellow",this.btn_buy.cui_freshCost.visible=!0,this.btn_buy.cui_freshCost.updateItem({cost:this.data.costs[0],style:CommonIconStyle.RIGHT}),this.btn_buy.btn_oppr.label="";break;case REWARD_STATUS.HASBUY:this.btn_buy.cui_freshCost.visible=!1,this.btn_buy.btn_oppr.skinName="skins.ButtonSkinSure",this.btn_buy.btn_oppr.label="已购买"}this.btn_buy.cui_freshCost.blb_num.scaleX=this.btn_buy.cui_freshCost.blb_num.scaleY=1.4},e}(eui.ItemRenderer);__reflect(i.prototype,"ActivityThirdDiamondGiftsItem")}(game||(game={})),function(C){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="RedPocketView",e.code=EActivityType.TimerLuckyMoney,e.actProxy.GetActivityInfo(e.code),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.list_root.itemRenderer=i,this.btn_open.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.params&&e.params.NoNeedWait?e.params&&e.params.cb&&e.params.cb.call(e):(e.btn_open.visible=!1,DragonBoneTools.playOnce({effectName:"common_weixinhongbao",parent:e.gp_main,x:e.gp_main.width/2||0,y:e.gp_main.height/2||0,keep:!1,loop:!1,doneCB:function(){e.params&&e.params.cb&&e.params.cb()}}))},this),this.btn_open.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.btn_open.source="chunjie_btn_kai2_png"},this),this.btn_open.addEventListener(egret.TouchEvent.TOUCH_END,function(){e.btn_open.source="chunjie_btn_kai1_png"},this),this.btn_open.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){e.btn_open.source="chunjie_btn_kai1_png"},this),this.timer=egret.setInterval(function(){e.updateRecords()},this,5e3)},e.prototype.updateRecords=function(){var e=this.info;if(!e||!e.data)return!1;var t=e.data.records,i=[],n=[];for(var o in t){var a=t[o];n.push(a)}for(var r=0;r<7;r++){var s=Math.floor(Math.random()*(n.length-1));n[s]&&(i.push(n[s]),n.splice(s,1))}i.sort(function(e,t){return e.dt-t.dt}),0<i.length?this.img_bg.visible=!0:this.img_bg.visible=!1,this.list_root.dataProvider=new eui.ArrayCollection(i)},e.prototype.updateView=function(){var t=this,e=this.info;if(!e||!e.data)return!1;var i=C.GameMgr.getInstance().serverTime(),n=JSON.parse(e.content),o=e.data.targeted,a=[],r=new Date(1e3*i);for(var s in r.setHours(0,0,0),a.push(r.getTime()/1e3),n[0]){var c=n[0][s],l=c[0],h=c[1],p=new Date(1e3*i);p.setHours(l[0],l[1],l[2]||0);var d=p.getTime()/1e3,u=new Date(1e3*i);u.setHours(h[0],h[1],h[2]||0);var g=u.getTime()/1e3;a.push(d),a.push(g)}for(var f=!1,_=void 0,m=1,y=0;y<a.length-1;y++)if(i>=a[y]&&i<=a[y+1])if(f=!0,y%2==0)m=0,_=function(){Utils.MsgUtils.addMidMsg("未到领取时间")};else{var v=!1;for(var s in o){var T=o[s];if(T>=a[y]&&T<=a[y+1]){v=!0;break}}v?(m=0,_=function(){Utils.MsgUtils.addMidMsg("未到下次领取时间")}):_=function(){Utils.Socket.send("activity","GetCommonReward",{code:EActivityType.TimerLuckyMoney}).then(function(e){t.actProxy.updateData_View_Reward(t.code,e,function(){t.hide(),C.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN)})})}}f||(m=0,_=function(){Utils.MsgUtils.addMidMsg("活动未开启")}),this.params={cb:_,NoNeedWait:!m},this.updateRecords()},e}(C.ActivityCommonPanel);C.ActivityTimerLuckyMoney=e,__reflect(e.prototype,"game.ActivityTimerLuckyMoney");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityTimerLuckyMoneyItem",e}return __extends(e,t),e.prototype.dataChanged=function(){this.lb_name.text=this.data.name;var e=this.data.rewards,t=C.AppFacade.getInstance().retrieveProxy(C.BackpackPy.N).getInfoByCode(e[0].code);this.lb_rewardName.text=t.info.name,this.lb_rewardName.textColor=COLOR_2_FONT_COLOR[t.info.color],this.lb_num.text="×"+e[0].num},e}(eui.ItemRenderer);__reflect(i.prototype,"ActivityTimerLuckyMoneyItem")}(game||(game={})),function(h){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.TodayActivity,e.py=h.AppFacade.getInstance().retrieveProxy(h.ActivityPy.N),e.skinName="ActivityTodayShowPanelSkin",e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.updateView()},e.prototype.updateView=function(){var e,t=h.Config.entranceTimeConfig(),i=[],n=[],o=[];for(var a in t){var r={config:t[a],doneCB:this.hide.bind(this),ishold:!1,isNow:!1,isLock:!1,isAbs:!1,text:""};if(t[a].moduleId==MODULE.TeamArena){var s=Utils.UnlockMgr.checkPass(t[a].moduleId,!1);r.ishold=!0;h.GameMVC.battleZoneArenaPy.getOpenInfo();r.isNow=!!Utils.TimerManager.checkIsOpen_FormatA(JSON.parse(t[a].timeGaoLiang)[0]).isOpen;var c=JSON.parse(h.Config.constConfig().EliminateTeamArenaDt.constValue)[2],l=(Utils.TimerManager.isOddWeek(),h.GameMVC.battleZoneArenaPy.getOpenInfo());r.isLock=l.isOpen,r.text=0==c?"单周周日00:00~下周周六21:00":"双周周日00:00~下周周六21:00",s.allow?r.isNow?i.push(r):r.isLock?n.push(r):(r.isAbs=!0,o.push(r)):(r.isAbs=!0,o.push(r))}else if(t[a].moduleId==MODULE.GuildWar){s=Utils.UnlockMgr.checkPass(t[a].moduleId,!1);r.ishold=!0;h.GameMVC.guildWarPy.getGuildWarStatus();r.isNow=!!Utils.TimerManager.checkIsOpen_FormatA(JSON.parse(t[a].timeGaoLiang)[0]).isOpen;c=JSON.parse(h.Config.constConfig().GuildWarDt.constValue)[2],Utils.TimerManager.isOddWeek(),l=h.GameMVC.guildWarPy.getOpenInfo();r.isLock=l.isOpen,r.text=0==c?"单周周日00:00~下周周六21:00":"双周周日00:00~下周周六21:00",s.allow?r.isNow?i.push(r):r.isLock?n.push(r):(r.isAbs=!0,o.push(r)):(r.isAbs=!0,o.push(r))}else{(s=Utils.UnlockMgr.getOpenInfo(t[a].moduleId)).allow?s.isWillOpenToday&&(s.isOpen?i.push(r):n.push(r)):s.isWillOpenToday&&(r.isAbs=!0,o.push(r))}}o.sort(function(e,t){return e.isLock?-1:1}),e=i.concat(n,o),this.list_task.itemRenderer=p,this.list_task.dataProvider=new eui.ArrayCollection(e)},e}(h.ActivityCommonPanel);h.ActivityTodayShowPanel=e,__reflect(e.prototype,"game.ActivityTodayShowPanel");var p=function(t){function e(){var e=t.call(this)||this;return e.ret=void 0,e.skinName="ActivityTodayShowItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this.gp_root.scaleX=this.gp_root.scaleY=.9},this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_END,function(){this.gp_root.scaleX=this.gp_root.scaleY=1,Utils.UnlockMgr.checkPass(this.data.config.moduleId).allow&&(this.ret&&this.ret.isOpen||this.data.isLock?(this.data.doneCB&&this.data.doneCB(),h.MainJumpConfig.jumpTo(this.data.config.moduleId)):Utils.MsgUtils.addMidMsg("不在活动期限内"))},this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){e.gp_root.scaleX=e.gp_root.scaleY=1},this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){this.gp_root.scaleX=this.gp_root.scaleY=1},this)},e.prototype.dataChanged=function(){this.img_bg.source=this.data.config.imgBg+"_png",this.gp_reward.removeChildren();var e=JSON.parse(this.data.config.rewards);for(var t in e){var i=customui.BaseItemFactory.create();i.scaleX=i.scaleY=.5,i.updateData({id:e[t][1],num:0}),this.gp_reward.addChild(i)}if(this.data.ishold)this.lb_day.text=this.data.text;else{this.ret=Utils.UnlockMgr.getOpenInfo(this.data.config.moduleId);var n=this.ret.openTime[0]+":"+this.getTimeStrShow(this.ret.openTime[1]+this.ret.openTime[2]),o=this.ret.endTime[0]+":"+this.getTimeStrShow(this.ret.endTime[1]+this.ret.endTime[2]);this.lb_day.text=this.ret.openDayTip+n+"~"+o}UIActionManager.setAbsGrey(this.gp_root,this.data.isAbs),this.ret&&this.ret.allow&&(this.ret&&this.ret.isOpen||this.data.isNow)&&DragonBoneTools.create("common_rukou",function(e){this.gp_effect.removeChildren(),e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2,e.scaleX=e.scaleY=1,e.animation.play(),this.gp_effect.addChild(e)},this)},e.prototype.getTimeStrShow=function(e){return 0==e?"00":e<10?"0"+e:""+e},e}(eui.ItemRenderer);__reflect(p.prototype,"ActivityTodayShowItem")}(game||(game={})),function(c){var e=function(i){function e(){var e=i.call(this)||this;return e.movPos=0,e.target=0,e.selectBtn=1,e.touched=!1,e.CIRCLENUM=1,e.rotaPosArr=[],e.isFirst=!0,e.welId=0,e.welcomeText={0:"欢迎各位勇士前来夺宝！",1:"祝大家好运连连，惊喜不断！",2:"嘿嘿！我这有很多宝贝！你想要吗？"},e.skinName="ActivityTreasureHunterSkin",e}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this);for(var e=0;e<12;++e){var t=this["img_"+e];this.rotaPosArr.push({x:t.x,y:t.y})}this.activateComponent()},e.prototype.updateView=function(e){i.prototype.updateView.call(this,e),this.gp_rechargeRotate.visible=!1,this.gp_treasureHunter.visible=!1,this.isRechargeRotate()?(this.gp_rechargeRotate.visible=!0,this.img_bg.source="newactivity_img_zpdt_png",this.img_title.source="newactivity_img_lczp_png",this.updateRechargeRotate()):(this.gp_treasureHunter.visible=!0,this.img_bg.source="xydb_img_ditu_png",this.img_title.source="",this.updateTreasureHunter()),this.timer||(this.remainingDt=c.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime(),this.updateRemainingTime(),this.timer=egret.setInterval(this.updateRemainingTime,this,1e3))},e.prototype.updateTreasureHunter=function(){var e=this;if(this.isFirst){this.isFirst=!1;var t=this.info.content[0],i=t[0][0],n=t[1][0];this.btn_1.updateData({source:"xydb_btn_anniushang_png",text:"1次",cost:i}),this.btn_10.updateData({source:"xydb_btn_anniuxia_png",text:"10次",cost:n}),this.sl_record.scrollPolicyH=eui.ScrollPolicy.OFF,this.list_item.itemRenderer=o,this.lb_welcome_tip.text=this.welcomeText[this.welId],this.welcomeTimer=egret.setInterval(function(){e.welId=(e.welId+1)%3,e.lb_welcome_tip.text=e.welcomeText[e.welId]},this,1e4)}this.showRecords(),this.updateMidView()},e.prototype.updateRechargeRotate=function(){this.isFirst&&(this.isFirst=!1);var e=this.info;this.blb_rr_reTime.text=e.data.times;var t=e.content[0],i=e.data.amounts,n=0;for(var o in t){var a=t[o];if(i<a[0]){n=a[0];break}}n||(n=t[t.length-1][0]),n<i&&(i=n),this.pb_rr.maximum=n,this.pb_rr.value=i,this.blb_rr_progress.text=i+"/"+n,this.updateMidView()},e.prototype.showRecords=function(){var e=this.info.data.records,t=[];if(this.gp_empty.visible=e.length<=0,0<e.length)for(var i=0,n=e;i<n.length;i++){var o=n[i],a={rewards:o.rewards,userName:o.name,dt:o.dt,activityCode:this.code};t.push(a)}0<t.length&&(t.sort(function(e,t){return 0<=e.dt-t.dt?-1:1}),this.list_item.dataProvider?this.list_item.dataProvider.replaceAll(t):this.list_item.dataProvider=new eui.ArrayCollection(t))},e.prototype.updateMidView=function(){var e=this.info.data.targeted,t=this.info.content[1];for(var i in t){var n=this["img_"+i],o=t[i];if(this.isRechargeRotate()){var a={id:o[0],reward:o[2][0],type:o[2][0][3],targeted:0<=e.indexOf(o[0])};n.updateData(a)}else{a={reward:o[1][0],type:o[3],id:o[0]};n.updateData(a)}}},e.prototype.updateRemainingTime=function(){var e=this.isRechargeRotate()?this.blb_rr_time:this.blb_time;0<this.remainingDt?e.text=""+Utils.TimerManager.getFormatBySecond2(this.remainingDt--):c.AppFacade.getInstance().hideSubView(c.ActivityMediator.N,c.ActivityMediator.SV.MAIN)},e.prototype.isRechargeRotate=function(){return 0<=[EActivityType.RechargeRotate,EActivityType.RechargeRotate1].indexOf(this.code)},e.prototype.hunter=function(c){var l=this;this.touched=!0,this.selectBtn=c||1,this.btn_1.btn_btn.touchEnabled=!1,this.btn_10.btn_btn.touchEnabled=!1,Utils.Socket.send("activity","DoCommonOperation",{code:this.code,num:c}).then(function(e){var t=JSON.parse(e.info);if(2==c){for(var i=t.rewardShow,n={1:1,4:1,7:1,10:1},o=i[i.length-1],a=0,r=i;a<r.length;a++){var s=r[a];if(n[s]){o=s;break}}l.target=o+12-l.movPos}else l.target=t.rewardShow[0]+(12-l.movPos);l.hunterRotation(e)})},e.prototype.hunterRotation=function(e){var t=this;this.rotaPosArr[this.movPos];this.moveCircle({count:0,doneCB:function(){(t.touched=!1,t.info&&t.info.updateData(e.info),e.clientReward)&&c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).handleClientReward(e.clientReward,{onCloseCB:function(){t.btn_1.btn_btn.touchEnabled=!0,t.btn_10.btn_btn.touchEnabled=!0,egret.Tween.get(t.gp_move).to({alpha:0},20)}})}})},e.prototype.moveCircle=function(e){var t=this,i=this.movPos,n=this.rotaPosArr[i].x,o=this.rotaPosArr[i].y,a=e&&e.duration||60,r=e&&e.count||0,s=e&&e.doneCB;this.gp_move.alpha=1,r>=12*this.CIRCLENUM*this.selectBtn+this.target?egret.Tween.get(this.gp_move).wait(50).to({alpha:0},50).to({alpha:1},100,egret.Ease.circOut).to({alpha:0},50).to({alpha:1},100,egret.Ease.circOut).wait(20).call(function(){s&&s()}):(egret.Tween.get(this.gp_move).to({x:n,y:o},a,egret.Ease.circOut).call(function(){++i,++r>=12*t.CIRCLENUM*t.selectBtn&&(a+=2),r<12*t.CIRCLENUM*t.selectBtn+t.target&&(t.movPos=i%12),t.moveCircle({count:r,duration:a,doneCB:s})}),this.tailMoving(i,a,r))},e.prototype.tailMoving=function(e,a,r){var s=this,t=(e-1+12)%12,i=(e-2+12)%12,n=this.rotaPosArr[t].x,o=this.rotaPosArr[t].y,c=this.rotaPosArr[i].x,l=this.rotaPosArr[i].y,h=function(e,t,i,n){var o=n||0;egret.Tween.get(e).to({x:t,y:i},a,egret.Ease.circOut).call(function(){r>=12*s.CIRCLENUM*s.selectBtn+s.target-1&&egret.Tween.get(e).to({alpha:0},50+o)})};this.gp_move0.alpha=1,h(this.gp_move0,n,o),this.gp_move1.alpha=1,h(this.gp_move1,c,l,50)},e.prototype.activateComponent=function(){var o=this;Utils.ComponentUtils.registerListener(this.btn_rr_oprt,egret.TouchEvent.TOUCH_TAP,function(){o.touched||(0<o.info.data.times?o.hunter():12==o.info.data.targeted.length?Utils.MsgUtils.addMidMsg("已获得所有奖励"):c.GameMgr.getInstance().showCommonTipsWin({commonTips:"累充达到目标可获得抽奖次数",btnStyle:{cancel:c.CommonTipsDialog.BTN_STYLE.CANCEL,confirm:c.CommonTipsDialog.BTN_STYLE.RECHARGE},clickCB:function(e){1==e.type&&c.AppFacade.getInstance().showSubView(c.RechargeMediator.N,c.RechargeMediator.SV.MAIN,{viewType:c.RechargeView.VIEW_TYPE.RECHARGE})}}))},this),this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(!o.touched){var e=o.info.content[0][0][0];if(!c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).checkEnough([e],!1))return void Utils.MsgUtils.addMidMsg("您的钻石不足！");o.hunter(1)}},this),this.btn_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(!o.touched){var e=o.info.content[0][1][0];if(!c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).checkEnough([e],!1))return void Utils.MsgUtils.addMidMsg("您的钻石不足！");o.hunter(2)}},this),this.btn_detail.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=o.info.content[2],t=[];for(var i in e){var n=e[i];n[0]&&t.push({text:n[0]}),n[1]&&t.push({text:n[1],style:{textColor:36807}}),t.push({text:"\n"})}PopUpManager.addPopUp({obj:new c.HelpDialog({text:t})})},this),Utils.ComponentUtils.registerListener(this.btn_rr_record,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new n({records:o.info.data.records})})},this)},e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.welcomeTimer&&egret.clearInterval(this.welcomeTimer)},e.isInit=!0,e}(c.ActivityCommonView);c.ActivityTreasureHunter=e,__reflect(e.prototype,"game.ActivityTreasureHunter");var t=function(t){function e(){var e=t.call(this)||this;return e.bg_map={0:"xydb_img_gezi1_png",1:"xydb_img_gezi2_png",2:"xydb_img_gezi3_png"},e.skinName="TreasureItemSkin",e}return __extends(e,t),e.prototype.updateData=function(e){var t=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N),i=e.reward,n=i[1],o=(i[2],t.getInfoByCode(n).info);this.img_bg.source=this.bg_map[e.type],this.lb_desc.text=""+o.name;var a=customui.BaseItemFactory.create(21);a.updateData({type:i[0],code:i[1],num:i[2]}),a.scaleX=.75,a.scaleY=.75,this.gp_items.addChild(a),null!=e.targeted&&UIActionManager.setAbsGrey(this,e.targeted),this.gp_effect.removeChildren(),e&&e.type&&DragonBoneTools.create("common_tswpguang",function(e){e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2-20,e.animation.play(),this.gp_effect.addChild(e)},this)},e}(eui.Component);c.TreasureItem=t,__reflect(t.prototype,"game.TreasureItem");var o=function(t){function e(){var e=t.call(this)||this;return e.colorMap={0:1083089,1:8397989},e.skinName="RecordItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){var e=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N),t=this.data.rewards&&this.data.rewards[0],i=t&&t.code,n=t&&t.num,o=e.getInfoByCode(i).info,a=this.data.userName,r=o&&o.name,s=(c.AppFacade.getInstance().retrieveProxy(c.ActivityPy.N),o&&o.color||2);a&&r?(this.lb_userName.text=a,this.lb_record.text=r+"x"+n):(this.lb_userName.text=this.data.record,this.lb_lb.text="",this.lb_record.text=""),this.lb_record.textColor=COLOR_2_FONT_COLOR[s],this.lb_userName.x=0,this.lb_lb.x=this.lb_userName.width,this.lb_record.x=this.lb_lb.x+this.lb_lb.width},e}(eui.ItemRenderer);c.LableItemRender=o,__reflect(o.prototype,"game.LableItemRender");var n=function(i){function e(e){var t=i.call(this)||this;return t.skinName="ActivityTreasureHunterRecordPanelSkin",t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.scl_list.scrollPolicyH=eui.ScrollPolicy.OFF,this.list_item.itemRenderer=o,this.data&&this.updateView()},e.prototype.updateView=function(){var e=this.data.records;if(0<e.length){this.gp_empty.visible=!1;var i=[];e.forEach(function(e){var t={rewards:e.rewards,userName:e.name,dt:e.dt};i.push(t)}),this.list_item.dataProvider=new eui.ArrayCollection(i)}else this.gp_empty.visible=!0},e}(BasePanel);__reflect(n.prototype,"ActivityTreasureHunterRecordPanel")}(game||(game={})),function(m){var e=function(t){function e(){var e=t.call(this)||this;return e.actProxy=m.AppFacade.getInstance().retrieveProxy(m.ActivityPy.N),e.backpackProxy=m.AppFacade.getInstance().retrieveProxy(m.BackpackPy.N),e.curTarget=void 0,Utils.AssetsMgr.loadGroup("group_trigger_gifts"),e.skinName="ActivityTriggerGiftsViewSkin",e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer),m.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN),Utils.AssetsMgr.destroyGroup("group_trigger_gifts")},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.CommonResourceBar),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btnFun&&e.btnFun()},this),DragonBoneTools.create("common_xianshilibao",function(e){e.anchorOffsetX=0,e.anchorOffsetY=0,e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2,e.animation.play(),this.gp_effect.addChildAt(e,0)},this),DragonBoneTools.create("common_xianshilibao",function(e){e.anchorOffsetX=0,e.anchorOffsetY=0,e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2,e.animation.play(),this.gp_effect0.addChildAt(e,0)},this),DragonBoneTools.create("common_shenqihuoyan",function(e){e.x=490,e.y=580,e.animation.play(),this.gp_effect.addChildAt(e,0)},this),DragonBoneTools.create("common_shenqihuoyan",function(e){e.x=210,e.y=580,e.animation.play(),this.gp_effect.addChildAt(e,0)},this),this.initList(),m.AppFacade.getInstance().sendNotification(CN.ACTIVITY_SHOW_TRIGGER,{clear:!0})},e.prototype.initList=function(){this.list_itemList.itemRenderer=i,this.list_actItem.itemRenderer=n,this.list_actItem.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this)},e.prototype.updateView=function(e){var t=[EPropertyType.EPropertyTypeGold,EPropertyType.EPropertyTypeDiamond];this.CommonResourceBar.updateBar({costs:t,width:190,needAdd:!0}),this.updateTopList()},e.prototype.updateTopList=function(){var n=this,e=this.actProxy.allActivityData[EActivityType.BasicHeroGifts],t=this.actProxy.allActivityData[EActivityType.TriggerGifts];if(e||t){var o=Utils.TimerManager.getServerTime(),a=[];if(t){this.triggerContent=JSON.parse(t.content);var i=JSON.parse(t.data.gifts),r=0;m.GameMgr.getInstance().getOnLineTime();i.forEach(function(e){for(var t in n.triggerContent[0]){var i=n.triggerContent[0][t];i[0]==e.code&&(r=i[3])}!e.buyDt&&o<e.triggerDt+r&&a.push(e)}),a.sort(function(e,t){return e.triggerDt-t.triggerDt})}e&&e.endDt>o&&(this.heroContent=JSON.parse(e.content),e.data.gifts.forEach(function(e){a.unshift(e)})),a.length<=0?this.hide():(this.curTarget=a[0],this.list_actItem.dataProvider=new eui.ArrayCollection(a),this.updateSelected(this.curTarget))}},e.prototype.perShow=function(){var e=this.actProxy.allActivityData[EActivityType.BasicHeroGifts],t=e&&e.data&&e.data.gifts.length||0,i=this.actProxy.allActivityData[EActivityType.TriggerGifts];return 0<t+(i&&i.data&&JSON.parse(i.data.gifts).length||0)},e.prototype.updateBottomList=function(e){this.curTarget=e,this.curTarget.triggerDt?this.updateTriggerGift():this.updateHeroGift()},e.prototype.updateTriggerGift=function(){var e=this,t=this.triggerContent,i=0,n=[],o=0,a="hero_009_01";for(var r in t[0]){var s=t[0][r];s[0]==this.curTarget.code&&(i=s[1],n=s[2],o=s[3],a=s[5]||a)}this.curTarget.triggerType==TriggerGiftsTriggerType.TeamLevelUp&&this.HeroDynamicModel.update({isStatic:!0,model:a});var c=m.AppFacade.getInstance().retrieveProxy(m.RechargePy.N),l=c.goodList,h=m.ActivityConfig.Config[EActivityType.TriggerGifts];if(h){if(i){var p;for(var d in l){var u=l[d];if(i==u.id){p=u;break}}p?h.formatString.format([p.price]):Utils.MsgUtils.addMidMsg("找不到商品信息");var g=REWARD_STATUS.CANBUY;this.curTarget.buyDt&&(g=REWARD_STATUS.HASBUY),this.gp_reward.removeChildren(),m.GameMgr.getInstance().CommonGpAddReward(this.gp_reward,n),this.btnFun=function(){p?g==REWARD_STATUS.CANBUY?c.purchase(p,2,String(e.curTarget.uuid),JSON.stringify({uuid:e.curTarget.uuid,activityType:EActivityType.TriggerGifts}),{activityType:EActivityType.TriggerGifts}):Utils.MsgUtils.addMidMsg("已购买"):Utils.MsgUtils.addMidMsg("找不到购买信息")},this.btn_buy.label=(p&&p.price)+"元"}this.timer&&egret.clearInterval(this.timer);var f=Utils.TimerManager.getServerTime(),_=this.curTarget.triggerDt+o-f;this.lb_time.text="剩余时间："+Utils.TimerManager.getFormatBySecond1(_),this.timer=egret.setInterval(function(){0<--_?e.lb_time.text="剩余时间："+Utils.TimerManager.getFormatBySecond1(_):(egret.clearInterval(e.timer),e.updateView())},this,1e3)}},e.prototype.updateHeroGift=function(){var e=this,t=this.heroContent,i=0,n=[];for(var o in t[0]){var a=t[0][o];a[0]==this.curTarget.code&&(i=a[1],n=a[2])}var r=m.Config.allHeroConfig()[this.curTarget.triggerKey||t[3]];this.HeroDynamicModel.update({isStatic:!0,model:r.model});var s=m.AppFacade.getInstance().retrieveProxy(m.RechargePy.N),c=s.goodList,l=m.ActivityConfig.Config[EActivityType.BasicHeroGifts];if(l){if(i){var h;for(var p in c){var d=c[p];if(i==d.id){h=d;break}}h?l.formatString.format([h.price]):Utils.MsgUtils.addMidMsg("找不到商品信息");var u=REWARD_STATUS.CANBUY;if(this.curTarget.buyDt&&(u=REWARD_STATUS.HASBUY),this.gp_reward.removeChildren(),this.curTarget.triggerKey){var g=customui.BaseItemFactory.create({code:this.curTarget.triggerKey});g.scaleX=g.scaleY=.8,this.gp_reward.addChild(g)}m.GameMgr.getInstance().CommonGpAddReward(this.gp_reward,n),this.btnFun=function(){h?u==REWARD_STATUS.CANBUY?s.purchase(h,2,String(e.curTarget.uuid),JSON.stringify({uuid:e.curTarget.uuid,activityType:EActivityType.BasicHeroGifts}),{activityType:EActivityType.BasicHeroGifts}):Utils.MsgUtils.addMidMsg("已购买"):Utils.MsgUtils.addMidMsg("找不到购买信息")},this.btn_buy.label=(h&&h.price)+"元"}this.timer&&egret.clearInterval(this.timer);var f=Utils.TimerManager.getServerTime(),_=m.ActivityConfig.getActivityEndDt(EActivityType.BasicHeroGifts)-f;this.lb_time.text="剩余时间："+Utils.TimerManager.getFormatBySecond1(_),this.timer=egret.setInterval(function(){0<_?e.lb_time.text="剩余时间："+Utils.TimerManager.getFormatBySecond1(--_):(egret.clearInterval(e.timer),e.updateView())},this,1e3)}},e.prototype.onItemTap=function(e){this.updateSelected(e.item)},e.prototype.updateSelected=function(e){var t=this.list_actItem.dataProvider,i=t.source;for(var n in i){var o=i[n];o.chosen=o.uuid==e.uuid}t.replaceAll(i),this.updateBottomList(e),this.updateTitle()},e.prototype.updateTitle=function(){this.curTarget?(this.gp_content.visible=!0,this.gp_level.visible=!1,this.gp_hero.visible=!1,this.gp_heroGift.visible=!1,this.curTarget.triggerType==TriggerGiftsTriggerType.HeroUpStar?(this.gp_hero.visible=!0,this.HeroDynamicModel.update({code:this.curTarget.triggerKey,isStatic:!0})):this.curTarget.triggerType==TriggerGiftsTriggerType.TeamLevelUp?(this.gp_level.visible=!0,this.bm_tip.text=this.curTarget.triggerKey):this.gp_heroGift.visible=!0):this.gp_content.visible=!1},e.prototype.perClose=function(){this.gp_effect.removeChildren(),this.gp_effect0.removeChildren()},e}(BaseFull);m.ActivityTriggerGiftsView=e,__reflect(e.prototype,"game.ActivityTriggerGiftsView");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityCommonListItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc(this.data)},this)},e.prototype.dataChanged=function(){var o=this,e=this.data;switch(this.img_bg.source=e.bg||this.img_bg.source,this.lb_title.text=e.title||"",this.lb_tips.text=e.tips||"",this.data.status){case REWARD_STATUS.CANBUY:this.btn_operate.skinName="skins.ButtonSkinYellow",this.btn_operate.label="购买",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=.8;break;case REWARD_STATUS.HASBUY:this.btn_operate.skinName="skins.ButtonSkinSure",this.btn_operate.label="已购买",UIActionManager.setGrey(this.btn_operate,!1),this.btn_operate.scaleX=this.btn_operate.scaleY=1}var t=JSON.parse(e.rewards);for(var i in this.gp_rewards.$children){var n=this.gp_rewards.$children[i];n&&(n.visible=!1)}t.forEach(function(e,t){o.gp_rewards.$children[t]||o.gp_rewards.addChild(customui.BaseItemFactory.create());var i=o.gp_rewards.$children[t];if(i.scaleX=i.scaleY=.7,i.visible=!0,e[0]==EEntityType.EEntityTypeHeroArtifact||e[0]==EEntityType.EEntityTypeHeroEquip){var n={code:e[1],entityType:e[0],exp:0,fightCap:0,level:0,level2:0,filterShow:!0};i.updateData({reward:e,vo:n})}else i.updateData({reward:e})}),this.btnFunc=e.btnFunc},e}(eui.ItemRenderer);__reflect(i.prototype,"ActivityTriggerGiftsViewItem");var n=function(t){function e(){var e=t.call(this)||this;return e.oldY=-5,e.oldId=0,e.activityProxy=m.AppFacade.getInstance().retrieveProxy(m.ActivityPy.N),e.skinName="ActivityRootPanel_ActivityItem",e}return __extends(e,t),e.prototype.dataChanged=function(){this.data.triggerType==TriggerGiftsTriggerType.TeamLevelUp?(this.img_icon.source="huodong_icon_xianshilibao_png",this.bm_title.text="限时礼包"):this.data.triggerType==TriggerGiftsTriggerType.HeroUpStar?(this.bm_title.text="成长礼包",this.img_icon.source="huodong_icon_chengzhanglibao_png"):(this.bm_title.text="英雄礼包",this.img_icon.source="huodong_icon_yxlb_png"),this.updateSelected()},e.prototype.updateSelected=function(){this.img_bg.source=this.data.chosen?"newactivity_img_yeqian02_png":"newactivity_img_yeqian01_png",this.data.chosen?egret.Tween.get(this.img_icon,{loop:!0}).to({y:this.oldY-15},500).to({y:this.oldY},500):(egret.Tween.removeTweens(this.img_icon),this.img_icon.y=this.oldY)},e}(eui.ItemRenderer);__reflect(n.prototype,"ActivityRootPanel_ActivityItem")}(game||(game={})),function(n){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.VipLevelGift,Utils.AssetsMgr.loadGroup("group_vip_gift"),e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_vip_gift")},e.prototype.initList=function(){this.list_itemList.itemRenderer=i},e.prototype.getDataList=function(){var a=this;if(!this.info)return[];var r=[],s=n.AppFacade.getInstance().retrieveProxy(n.RechargePy.N),c=n.Config.VIPUpgradeConfig(),e=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N).playerInfoVO.playerVip,l=e.vipLevel||0,h=e.vipGiftGot,t=function(e){var t=c[e];if(!t.level||t.level>l+3)return"continue";var i=REWARD_STATUS.CANBUY;h[t.level]&&(i=REWARD_STATUS.HASBUY),t.level>l&&(i=REWARD_STATUS.UNAVAILABLE_BUY);var n=JSON.parse(t.costs),o={id:t.level,title:"VIP"+t.level+"礼包",status:i,rewards:t.gifts,discount:t.discount,cost:n[0],btnFunc:function(){switch(o.status){case REWARD_STATUS.AVAILABLE:case REWARD_STATUS.CANBUY:s.GetVipLevelGift(t.level,function(){a.updateView(void 0)});break;case REWARD_STATUS.UNAVAILABLE:case REWARD_STATUS.UNAVAILABLE_BUY:Utils.MsgUtils.addMidMsg("未满足条件");break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.HASBUY:Utils.MsgUtils.addMidMsg("已购买")}}};r.push(o)};for(var i in c)t(i);return r.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id}),r},e.prototype.updateTitle=function(){var e=n.Config.activityConfigs()[this.code];this.actProxy.allActivityData[this.code];e&&this.img_title&&(this.img_title.source=JSON.parse(e.img_title)[0]+"_png"),this.bm_time.text=""},e}(n.ActivityCommonListView);n.ActivityVipGift=e,__reflect(e.prototype,"game.ActivityVipGift");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityVipGiftItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc(this.data)},this);var e=this.btn_operate.cui_freshCost.img_icon;e&&(e.scaleX=e.scaleY=.9),this.btn_operate.btn_oppr.skinName="skins.ButtonSkinYellow"},e.prototype.dataChanged=function(){var o=this,e=this.data;switch(this.img_bg.source=e.bg||this.img_bg.source,this.lb_title.text=e.title||"",this.lb_tips.text=e.tips||"",this.data.status){case REWARD_STATUS.UNAVAILABLE:case REWARD_STATUS.UNAVAILABLE_BUY:this.btn_operate.visible=!0,this.btn_buy.visible=!1,UIActionManager.setGrey(this.btn_operate,!0);break;case REWARD_STATUS.CANBUY:case REWARD_STATUS.AVAILABLE:this.btn_operate.visible=!0,this.btn_buy.visible=!1,UIActionManager.setGrey(this.btn_operate,!1);break;case REWARD_STATUS.HASBUY:case REWARD_STATUS.RECEIVED:this.btn_operate.visible=!1,this.btn_buy.visible=!0,this.btn_buy.enabled=!1,UIActionManager.setAbsGrey(this.btn_buy,!0)}var t=JSON.parse(e.rewards);this.gp_rewards.removeChildren(),t.forEach(function(e,t){var i=customui.BaseItemFactory.create();if(i.scaleX=i.scaleY=.7,e[0]==EEntityType.EEntityTypeHeroArtifact||e[0]==EEntityType.EEntityTypeHeroEquip){var n={code:e[1],entityType:e[0],exp:0,fightCap:0,level:0,level2:0,filterShow:!0};i.updateData({reward:e,vo:n})}else i.updateData({reward:e});o.gp_rewards.addChild(i)}),this.btnFunc=e.btnFunc,this.data.discount?(this.gp_discount.visible=!0,this.bm_discount.text=this.data.discount/10+"",this.data.cost?(this.CommonIconWithNum.updateItem({type:this.data.cost[0],code:this.data.cost[1],num:this.data.cost[2]/this.data.discount*100,style:CommonIconStyle.RIGHT}),this.CommonIconWithNum.visible=!0):this.CommonIconWithNum.visible=!1):(this.gp_discount.visible=!1,this.CommonIconWithNum.visible=!1),this.data.cost&&(this.btn_operate.cui_freshCost.updateItem({cost:this.data.cost,style:CommonIconStyle.RIGHT}),this.btn_operate.cui_freshCost.left=void 0,this.btn_operate.cui_freshCost.horizontalCenter=0),this.data.status==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn_operate,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2}):UIActionManager.hideEffect(this.btn_operate)},e}(eui.ItemRenderer);__reflect(i.prototype,"ActivityVipGiftItem")}(game||(game={})),function(m){var e=function(_){function e(){var e=_.call(this)||this;return e.skinName="ActivityVipPreferentialGift",e}return __extends(e,_),e.prototype.childrenCreated=function(){var e=this;_.prototype.childrenCreated.call(this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btnFunc&&e.btnFunc()},this),this.btn_buy.btn_oppr.skinName="skins.ButtonSkinYellow",this.heroModel.update({code:41150066,isStatic:!0})},e.prototype.updateView=function(e){var t=this;_.prototype.updateView.call(this,e);var i=this.info;if(i&&i.data){var n=JSON.parse(i.content)[0],o=i.data[0]&&i.data[0].times||0,a=n[0],r=n[1],s=n[2],c=n[3];this.gp_rewards.removeChildren(),m.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,c),this.updateTitle(),this.img_topVip.source="thhk"+r+"_png";var l=m.GameMVC.playerPy.playerInfoVO.playerVip.vipLevel,h=REWARD_STATUS.UNAVAILABLE;r<=l&&(h=REWARD_STATUS.AVAILABLE);for(var p=0;p<3;p++){var d=s[p];this.updateDiscount(p,parseInt(d[2]))}var u=void 0;for(var g in s){var f=s[g];if(f[0]==o+1){u=f;break}}switch(u||(h=REWARD_STATUS.RECEIVED),this.lb_vip.text="vip"+r+"及以上即可购买",h){case REWARD_STATUS.UNAVAILABLE:this.btn_buy.updateData({text:"前往充值"}),this.updateRightDiscount(s[0]),this.btnFunc=function(){Utils.MsgUtils.addMidMsg("vip等级不足，请升级vip再进行购买")},this.btn_buy.updateData({text:"购买",cost:s[0][1][0]});break;case REWARD_STATUS.AVAILABLE:this.updateRightDiscount(u),u[2]?this.btn_buy.updateData({text:"购买",cost:u[1][0]}):this.btn_buy.updateData({text:"领取"}),this.btnFunc=function(){m.GameMVC.backpackPy.checkEnough(u[1],!1)?t.getReward({id:a,num:o+1,code:t.code}):Utils.MsgUtils.addMidMsg("货币不足")};break;case REWARD_STATUS.RECEIVED:this.hide(),m.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN)}}},e.prototype.updateRightDiscount=function(e){this.gp_rightDiscount.visible=!!e,e[2]?(this.img_rightFree.visible=!1,this.img_rightDiscount.visible=!0,this.bm_curDiscount.text=e[2]+""):(this.img_rightFree.visible=!0,this.img_rightDiscount.visible=!1,this.bm_curDiscount.text="")},e.prototype.updateDiscount=function(e,t){var i=this["bm_discount"+e],n=this["img_free"+e],o=this["gp_discount"+e];t?(n&&(n.visible=!1),o&&(o.visible=!0),i&&(i.visible=!0),i&&(i.text=t)):(n&&(n.visible=!0),o&&(o.visible=!1),i&&(i.visible=!1))},e.prototype.updateTitle=function(){var e=this,t=this.actProxy.allActivityData[this.code];if(this.code==EActivityType.LevelReward)this.lb_time.text="";else if(t&&this.lb_time){var i=m.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.lb_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(i),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=i--?e.lb_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(i):m.AppFacade.getInstance().hideSubView(m.ActivityMediator.N,m.ActivityMediator.SV.MAIN)},this,1e3)}},e}(m.ActivityCommonPanel);m.ActivityVipPreferentialGift=e,__reflect(e.prototype,"game.ActivityVipPreferentialGift")}(game||(game={})),function(r){var e=function(a){function e(){var e=a.call(this)||this;return e.skinName="ActivityWchessShow",e}return __extends(e,a),e.prototype.childrenCreated=function(){var i=this;a.prototype.childrenCreated.call(this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.info;if(e&&e.data){var t=e.content;r.MainJumpConfig.jumpTo(t[1])}},this)},e.prototype.updateView=function(e){var t=this;a.prototype.updateView.call(this,e);var i=this.info;if(i&&i.data){var n=i.content;this.img_bg.source=n[0]+"_png",this.timer&&egret.clearInterval(this.timer);var o=r.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.timer=egret.setInterval(function(){0<--o?t.bm_time.text=Utils.TimerManager.getFormatBySecond1(o):r.GameMVC.activityMed.updateView(r.ActivityMediator.SV.MAIN)},this,1e3)}},e}(r.ActivityCommonView);r.ActivityWchessShow=e,__reflect(e.prototype,"game.ActivityWchessShow")}(game||(game={})),function(s){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.WeChatShare,e.skinName="ActivityWeChatShareCommonPanelSkin",e.acProxy=s.AppFacade.getInstance().retrieveProxy(s.ActivityPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._activateComponent()},e.prototype.updateView=function(e){var t=e&&e.type;this.customCB=e&&e.customCB,this.doneCB=e&&e.doneCB,this.canleCB=e&&e.canleCB;var i=Utils.SDKMgr.getPerformConfig(10018),n=(this.lb_hint.visible=i)?s.Config.operationConfig()[OperationType.Act_Share]:this.acProxy.allActivityData[this.code];if(i)return this.img_bg.source="fenxiang_img_fenxiang06_png",this.rewards=JSON.parse(n.reward),void s.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,this.rewards);if(n)for(var o=0,a=JSON.parse(n.content);o<a.length;o++){var r=a[o];if(r[1][0]==t){(this.targetInfo=r)[3]&&""!=r[3]&&(this.img_bg.source=ResourceUtils.png(r[3])),r[4]&&""!=r[4]&&(this.img_bg.source=ResourceUtils.png(r[4])),this.rewards=r[2],s.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,this.rewards);break}}},e.prototype._activateComponent=function(){this.gp_wetchat_tips.visible=!1,this.btn_share.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.SDKMgr.getPerformConfig(10018))if(Utils.SDKMgr.getPerformConfig(10021)&&"WX"==getUrlKV().channel)this.gp_wetchat_tips.visible=!0;else{var e=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N);Utils.SDKMgr.share({recommendId:e.roleVo.playerId,recommendPlatform:Utils.agentConfig.AgentCode,content:CHAT_RANDOM_CONTENT[Utils.MathUtils.getRandomInt(0,CHAT_RANDOM_CONTENT.length-1)],sceneId:this.targetInfo&&this.targetInfo[1][0]||0},function(e){0==e&&(s.GameMVC.activityPy.getOperationReward(OperationType.Act_Share),Utils.MsgUtils.addMidMsg("分享成功"))})}else this.acProxy.WeChatShare({sceneId:this.targetInfo[1][0],id:this.targetInfo[1][0],customCB:this.customCB,doneCB:this.doneCB})},this)},e.prototype.perClose=function(){this.canleCB&&this.canleCB()},e}(BasePanel);s.ActivityWeChatShareCommonPanel=e,__reflect(e.prototype,"game.ActivityWeChatShareCommonPanel")}(game||(game={})),function(u){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getDataList=function(){var l=this,e=this.info,t=(JSON.parse(e.content),e.content);if(!t)return Utils.MsgUtils.addMidMsg("找不到配置"),[];var h=[],p=u.GameMVC.rechargePy.goodList,d=e.data.giftTargeted;t[0].forEach(function(e){var t=e[0],i=e[1],n=e[2],o=e[3],a=0;d&&d.forEach(function(e){e[0]==t&&(a=e[1])});var r=REWARD_STATUS.CANBUY;o<=a&&(r=REWARD_STATUS.HASBUY);var s=void 0;p.forEach(function(e){e.id==i&&(s=e)});var c={id:t,title:(s&&s.price)+"元礼包",tips:a+"/"+o,status:r,rewards:n,type:1,btnFunc:function(){r==REWARD_STATUS.CANBUY?u.GameMVC.rechargePy.purchase(s,2,t,JSON.stringify({activityType:l.code,uuid:t}),{activityType:l.code,uuid:t}):Utils.MsgUtils.addMidMsg("已购买")}};h.push(c)});var a=e.data.amounts,r=e.data.rechargeTargeted;return t[1].forEach(function(e){var t=e[0],i=e[1],n=REWARD_STATUS.UNAVAILABLE;0<=r.indexOf(t)?n=REWARD_STATUS.RECEIVED:t<=a&&(n=REWARD_STATUS.AVAILABLE);var o={id:t,title:"累充"+t+"元",tips:a+"/"+t,status:n,rewards:i,type:2,btnFunc:function(){l.getReward({code:l.code,id:t,num:t})}};h.push(o)}),h.sort(function(e,t){return e.type!=t.type?e.type-t.type:e.status!=t.status?e.status-t.status:e.id-t.id}),h},t}(u.ActivityCommonListView);u.ActivityWishGifts=e,__reflect(e.prototype,"game.ActivityWishGifts")}(game||(game={})),function(c){var e=function(r){function e(){var e=r.call(this)||this;return e.boxs1=[],e.boxs2=[],e.boxPosi1=[[40,20],[140,100],[220,30],[290,130],[190,220],[80,200],[40,320],[160,360],[300,290]],e.boxPosi2=[[0,0],[0,92.5],[0,185],[0,277.5],[0,370]],e.hasTry2Get=!1,e.hasGetInfo=!1,e.skinName="ActivityZoneDevoteGoods",e}return __extends(e,r),e.prototype.childrenCreated=function(){var i=this;r.prototype.childrenCreated.call(this);for(var e=0;e<9;e++){var t=new n;this.boxs1.push(t),t.x=this.boxPosi1[e][0],t.y=this.boxPosi1[e][1],this.gp_box0.addChild(t)}for(e=0;e<5;e++){t=new n;this.boxs2.push(t),t.horizontalCenter=0,t.y=this.boxPosi2[e][1],this.gp_box1.addChild(t)}this.btn_devote.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.info;if(e&&e.data){var t=JSON.parse(e.content)[4];PopUpManager.addPopUp({obj:new c.UsePropPanel({code:t[1][0][1],btnText:"祈愿",btnFunc:function(e){Utils.Socket.send("activity","ZoneDevoteGoods",{id:1,num:e.num}).then(function(e){c.GameMVC.activityPy.updateData_View_Reward(i.code,e)})}})})}},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"ZoneDevoteGoods"})},this)},e.prototype.updateView=function(e){var o=this;if(r.prototype.updateView.call(this,e),this.hasGetInfo){this.hideLines();var t=this.info;if(t&&t.data){var i=t.data,n=JSON.parse(t.content);this.getDataList(i.grade,i.targeted,n[1],function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:o.getRewards(e.id,"GetZoneDevoteGooddsTargeted",1);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.UNAVAILABLE:c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.REWARD_PANEL,{rewards:e.rewards,type:c.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})}}).forEach(function(e,t){var i=o.boxs1[t];if(e.type=1,i&&i.update(e),e.status==REWARD_STATUS.RECEIVED||e.status==REWARD_STATUS.AVAILABLE){var n=o["img_line1_"+t];n&&(n.visible=!0)}}),this.getDataList(i.totalGrade,i.zoneTargeted,n[2],function(e){switch(e.status){case REWARD_STATUS.AVAILABLE:o.getRewards(e.id,"GetZoneDevoteGooddsZoneTargeted",2);break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.UNAVAILABLE:c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.REWARD_PANEL,{rewards:e.rewards,type:c.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})}}).forEach(function(e,t){var i=o.boxs2[t];if(e.type=2,i&&i.update(e),e.status==REWARD_STATUS.RECEIVED||e.status==REWARD_STATUS.AVAILABLE){var n=o["img_line2_"+t];n&&(n.visible=!0)}}),this.updateTimer();var a=n[4];this.CommonResourceBar.updateBar({costs:a[1],needAdd:!0,wayFunc:function(){var e=c.AppFacade.getInstance().retrieveMediator(c.ShopyMediator.N),t=c.GameMVC.backpackPy.getInfoByCode(a[1][0][1]);e.showSubView(c.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:a[1],costs:a[0],countFun:function(e){return{unit:a[0][0][2],total:a[0][0][2]*e}},name:t.info.name},maxCount:99999999,buyNum:0,btnLabel:"购买",costTip:"购买消耗",limitTip:"购买次数",doneCB:function(e){Utils.Socket.send("activity","ZoneDevoteGoodsBuy",{num:e.num||0}).then(function(e){o.backpackProxy.handleClientReward(e.clientReward),NoticeManager.updateNotice(NT.ALL_ACTIVITY[o.code]),o.updateView()})}})}})}}else this.hasTry2Get||(this.hasTry2Get=!0,this.actProxy.GetActivityInfo(this.code,function(){o.hasGetInfo=!0,o.updateView()}))},e.prototype.hideLines=function(){this.gp_lines1.$children.forEach(function(e){e.visible=!1}),this.gp_lines2.$children.forEach(function(e){e.visible=!1})},e.prototype.updateTimer=function(){var e=this,t=c.ActivityConfig.getActivityEndDt(this.code)-Utils.TimerManager.getServerTime();this.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(t),this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<=t--?e.bm_time.text="剩余时间:"+Utils.TimerManager.getFormatBySecond2(t):c.AppFacade.getInstance().hideSubView(c.ActivityMediator.N,c.ActivityMediator.SV.MAIN)},this,1e3)},e.prototype.getRewards=function(t,e,i,n){var o=this;GameRootLayer.gameLayer().switchTouchEnable(!1),egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this,3e3),Utils.Socket.send("activity",e,{grade:t}).then(function(e){o.handleReward(e,i,t),n&&n(e)})},e.prototype.handleReward=function(a,r,s){return __awaiter(this,void 0,void 0,function(){var t,i,n,o;return __generator(this,function(e){switch(e.label){case 0:for(n in t=this.boxs1,2==r&&(t=this.boxs2),i=[],t)(o=t[n])&&o.params&&o.params.status==REWARD_STATUS.AVAILABLE&&o.params.id==s&&i.push(o.playEffect());return[4,Promise.all(i)];case 1:return e.sent(),GameRootLayer.gameLayer().switchTouchEnable(!0),c.GameMVC.activityPy.updateData_View_Reward(this.code,a),[2]}})})},e.prototype.getDataList=function(e,t,i,n){this.info;var o=[];for(var a in i){var r=i[a],s=r[0],c=r[1],l=REWARD_STATUS.UNAVAILABLE;s<=e&&(l=REWARD_STATUS.AVAILABLE),0<=t.indexOf(s)&&(l=REWARD_STATUS.RECEIVED);var h={id:s,key:e,status:l,rewards:c,btnFunc:n};o.push(h)}return o},e}(c.ActivityCommonView);c.ActivityZoneDevoteGoods=e,__reflect(e.prototype,"game.ActivityZoneDevoteGoods");var n=function(t){function e(){var e=t.call(this)||this;return e.effectObj=[],e.skinName="ActivityZoneDevoteGoodsItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.params&&e.params.btnFunc&&e.params.btnFunc(e.params)},this)},e.prototype.playEffect=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.img_bg.source=1==this.params.type?"jjqy_img_baoxiang2_png":"jjqy_img_baoxiang4_png",this.effectObj.forEach(function(e){e.visible=!1}),[4,DragonBoneTools.playOnce({effectName:"common_jxbaoxiangkai",parent:this.gp_effect,x:this.width/2,y:this.height/2,doneCB:function(){}})];case 1:return e.sent(),[2]}})})},e.prototype.update=function(e){var t=this,i=(this.params=e).key,n=e.id;switch(this.bm_cur.text=i,this.bm_max.text="/"+n,egret.Tween.removeTweens(this.img_bg),this.effectObj.forEach(function(e){e.visible=!1}),e.status){case REWARD_STATUS.UNAVAILABLE:this.img_bg.source=1==e.type?"jjqy_img_baoxiang1_png":"jjqy_img_baoxiang3_png",this.bm_cur.visible=this.bm_max.visible=!0,this.bm_cur.font="white_num_fnt";break;case REWARD_STATUS.AVAILABLE:this.img_bg.source="",0<this.effectObj.length?this.effectObj.forEach(function(e){e.visible=!0}):(this.addEffect(this,"common_jxbaoxiangdg",{childIndex:0,offectY:-10},function(e){t.effectObj.push(e)}),this.addEffect(this.gp_effect,1==e.type?"common_jxbaoxiang_1":"common_jxbaoxiang_2",{},function(e){t.effectObj.push(e)})),this.bm_cur.visible=this.bm_max.visible=!0,this.bm_cur.font="green_num_fnt";break;case REWARD_STATUS.RECEIVED:this.img_bg.source=1==e.type?"jjqy_img_baoxiang2_png":"jjqy_img_baoxiang4_png",this.bm_cur.visible=this.bm_max.visible=!1}},e.prototype.addEffect=function(t,e,i,n){DragonBoneTools.create(e,function(e){e.x=t.width/2+(i&&i.offectX||0),e.y=t.height/2+(i&&i.offectY||0),i&&(i.scaleX&&(e.scaleX=i.scaleX),i.scaleY&&(e.scaleY=i.scaleY)),i.childIndex||0==i.childIndex?t.addChildAt&&t.addChildAt(e,i.childIndex):t.addChild&&t.addChild(e),e.animation.play(),n&&n(e)},this)},e}(eui.ItemRenderer);__reflect(n.prototype,"ActivityZoneDevoteGoodsItem")}(game||(game={})),function(u){var e=function(i){function d(){var e=null!==i&&i.apply(this,arguments)||this;return e.specialArr=[],e.commonArr=[],e.canGetList=[],e.scrollerIndex=0,e.curPID=0,e.taskPy=u.AppFacade.getInstance().retrieveProxy(u.TaskPy.N),e}return __extends(d,i),d.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.skinName="BraveBookRewardsSkin",this.tck_tck.blb_title.text="令状奖励",this.tck_tck.onCloseCB=function(){e.hide()};var t=new eui.VerticalLayout;t.horizontalAlign=egret.HorizontalAlign.CENTER,t.gap=6,t.paddingLeft=t.paddingRight=6,t.paddingTop=6,this.list=new eui.List,this.list.layout=t,this.list.itemRenderer=n,this.sl_list.viewport=this.list,this.sl_list.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_list.addEventListener(egret.Event.CHANGE,this.ScrollSpecialItem,this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.taskPy.getNewBraveLevelReward({levels:e.canGetList,cb:function(){e.updateView(),u.AppFacade.getInstance().retrieveMediator(u.ActivityMediator.N).updateViewByCode(EActivityType.NewBraveBook)}})},this)},d.prototype.buttomView=function(){var e=u.Config.newBraveBookLevelConfig(),t=0;for(var i in e)t++;var n=this.taskPy.newBraveBookTask.levelTargeted;n.sort(function(e,t){return 0<e-t?-1:1});for(var o=n[0]==t?t:(n[0]?n[0]:0)+1;o<=t;o++){var a=e[o];if(1==a.isShow&&1==a.isRare){this.lb_reward_tip.text="勇士等级达到"+a.level+"级带我回家哦！";break}}},d.prototype.ScrollSpecialItem=function(){var e=this.list.scrollV,t=(this.list.$children,e/126);this.scrollerIndex=t+5,this.scrollerIndex>=this.commonArr.length-1&&(this.scrollerIndex=this.commonArr.length-1),this.scrollerIndex<=0&&(this.scrollerIndex=0);this.commonArr[t];var i=Math.floor(this.scrollerIndex),n=this.specialArr[0],o=this.commonArr[i];for(var a in this.specialArr){var r=this.specialArr[a];if(n&&o.level>=n.level&&o.level<=r.level){this.curSpe.level!=r.level&&(this.curSpe=r,this.showSpecialItem(r));break}n=r}},d.prototype.showSpecialItem=function(e){var t=e;this.lb_spLevel.text=""+t.level;var i=JSON.parse(t.rewards);this.gp_speItems.removeChildren();for(var n=0,o=i;n<o.length;n++){var a=o[n],r=customui.BaseItemFactory.create(21);r.updateData({type:a[0],code:a[1],num:a[2]}),r.scaleX=.75,r.scaleY=.75,this.gp_speItems.addChild(r)}},d.prototype.updateView=function(e){this.params=e,this.params&&this.params.doneCB&&(this.doneCB=this.params.doneCB),this.buttomView(),this.rewardlistsView()},d.prototype.rewardlistsView=function(){var e=this.taskPy.newBraveBookTask.level,t=(this.taskPy.newBraveBookTask.levelTargeted,d.isInit?0:this.curPID),i=1e3*t+1,n=1e3*(Math.floor(e/1e3)+1),o=u.Config.newBraveBookLevelConfig(),a=(u.AppFacade.getInstance().retrieveProxy(u.ActivityPy.N),!1),r=u.GameMVC.activityPy.allActivityData[EActivityType.NewBraveBook].data;this.commonArr=[],this.canGetList=[];for(var s=i;o[s];++s){var c=o[s];if(c.rewards&&""!=c.rewards){var l=this.taskPy.newBraveBookTask.levelTargeted&&-1!=this.taskPy.newBraveBookTask.levelTargeted.indexOf(c.level),h={rewards:c.rewards,current:e,level:c.level,exp:c.exp,isTarget:l,canGet:c.level<=e,sortKey:c.level<=e&&l,isEffect:c.isRare,isGrey:!(r&&r.isBuy&&!l&&c.level<=e)};1==c.isShow2&&this.specialArr.push(h),this.commonArr.push(h),c.level<=e&&!l&&(this.canGetList.push(c.level),a=!0,this.curPID=t)}if(!a&&n<c.level&&(t+=1,this.commonArr=[],this.specialArr=[]),n<=c.level)break}this.specialArr.sort(function(e,t){return e.sortKey!=t.sortKey?e.sortKey-t.sortKey:0<t.level-e.level?-1:1}),this.curSpe=this.specialArr[0],this.showSpecialItem(this.specialArr[0]),this.commonArr.sort(function(e,t){return e.sortKey!=t.sortKey?e.sortKey-t.sortKey:0<t.level-e.level?-1:1});var p=this.list.dataProvider;p?p.replaceAll(this.commonArr):this.list.dataProvider=new eui.ArrayCollection(this.commonArr),UIActionManager.setAbsGrey(this.btn_get,!a),d.isInit&&(d.isInit=!1)},d.prototype.perClose=function(){this.doneCB&&this.doneCB()},d.isInit=!0,d}(BasePanel);u.BraveBookRewardsView=e,__reflect(e.prototype,"game.BraveBookRewardsView");var n=function(t){function e(){var e=t.call(this)||this;return e.taskPy=u.AppFacade.getInstance().retrieveProxy(u.TaskPy.N),e.skinName="BraveRewardItemNewSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.current>=e.data.level&&(!e.taskPy.newBraveBookTask.levelTargeted||-1==e.taskPy.newBraveBookTask.levelTargeted.indexOf(Number(e.data.level)))?e.taskPy.getNewBraveLevelReward({levels:[Number(e.data.level)],cb:function(){u.AppFacade.getInstance().retrieveMediator(u.ActivityMediator.N).updateViewByCode(EActivityType.NewBraveBook),u.AppFacade.getInstance().updateView(u.BraveBookMediator.N,u.BraveBookMediator.SV.BRAVEBOOKREWARDS)}}):Utils.MsgUtils.addMidMsg("已领取该奖励")},this)},e.prototype.dataChanged=function(){var e=this.data;this.lb_desc.text="勇士令状达到等级"+e.level+"可获取奖励";var t=e.current>e.level?e.level:e.current;this.lb_pro.text=t+"/"+e.level;var i=JSON.parse(e.rewards);this.gp_items.removeChildren();for(var n=0,o=i;n<o.length;n++){var a=o[n],r=customui.BaseItemFactory.create(21);r.updateData({type:a[0],code:a[1],num:a[2],effect:this.data.isEffect,effectParam:{effectName:"common_jiban",scale:1.5}}),r.scaleX=.65,r.scaleY=.65,this.gp_items.addChild(r)}this.btn_get.visible=!0,this.btn_get.touchEnabled=!0,this.btn_got.visible=!1,this.btn_got.touchEnabled=!0,UIActionManager.setGrey(this.btn_get,this.data.isGrey),e.current>=e.level&&e.canGet&&!e.isTarget?this.btn_get.label="领取":e.canGet&&e.isTarget?(this.btn_got.touchEnabled=!1,this.btn_get.touchEnabled=!1,this.btn_get.visible=!1,this.btn_got.visible=!0):(this.btn_get.touchEnabled=!1,UIActionManager.setAbsGrey(this.btn_get,!0))},e}(eui.ItemRenderer);__reflect(n.prototype,"BraveRewardItemNew")}(game||(game={})),function(h){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="BraveBookShopSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list_items.itemRenderer=i},e.prototype.updateView=function(e){e&&this.shopItems(e)},e.prototype.shopItems=function(e){var t=e.info,i=h.AppFacade.getInstance().retrieveProxy(h.RechargePy.N).goodList,n=[];if(Array.isArray(t)&&0<t.length)for(var o in t){var a=t[o],r=void 0;for(var s in i){var c=i[s];if(c.id==a[0]){r=c;break}}n.push({level:a[1],id:Number(o)+1,buyInfo:r})}var l=this.list_items.dataProvider;l?l.replaceAll(n):this.list_items.dataProvider=new eui.ArrayCollection(n)},e}(BasePanel);h.BraveBookShopView=e,__reflect(e.prototype,"game.BraveBookShopView");var i=function(t){function e(){var e=t.call(this)||this;return e.taskPy=h.AppFacade.getInstance().retrieveProxy(h.TaskPy.N),e.skinName="BraveBookShopItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.taskPy.nextBraveBook=0,h.AppFacade.getInstance().retrieveProxy(h.RechargePy.N).purchase(e.data.buyInfo)},this)},e.prototype.dataChanged=function(){this.img_item_icon.source="_yslz_m_json.yslz_img_ysdj"+this.data.id,this.lb_level.text="提升"+this.data.level+"级",this.lb_price.text=this.data.buyInfo.price+"元";var e=h.AppFacade.getInstance().retrieveProxy(h.TaskPy.N).braveBookTask.level,t=h.Config.braveBookLevelConfigs();this.touchEnabled=t[e+1],this.touchChildren=t[e+1],UIActionManager.setAbsGrey(this.gp_root,!t[1+e])},e}(eui.ItemRenderer);h.BraveBookShopItem=i,__reflect(i.prototype,"game.BraveBookShopItem")}(game||(game={})),function(l){var e=function(t){function e(){var e=t.call(this)||this;return e.canGetNum=0,e.skinName="BravebookTasksSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var n=this;t.prototype.childrenCreated.call(this),this.list_items.itemRenderer=i,this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=l.AppFacade.getInstance().retrieveProxy(l.ActivityPy.N).allActivityData[EActivityType.NewBraveBook],t=e.data,i=e.content[3];(i=i&&i==TaskType.NewNewBraveBook?TaskType.NewNewBraveBook:TaskType.NewBraveBook,t&&t.isBuy&&i==TaskType.NewNewBraveBook||i==TaskType.NewBraveBook)?l.AppFacade.getInstance().retrieveProxy(l.TaskPy.N).GetTaskAllReward(i,function(){n.updateView({all:!0})},{unresetChapter:!0,id:n.data[0].sectionCode,sectionCode:n.data[0].sectionCode}):Utils.MsgUtils.addMidMsg("请激活令状！")},this)},e.prototype.updateView=function(e){if(e){if(e.data&&(this.data=e.data,this.canGetNum=e.canGetNum),e.code)for(var t in this.data)this.data[t].code==e.code&&(this.data[t].isTarget=!0,--this.canGetNum);if(e.all)for(var t in this.data)this.data[t].canGet&&!this.data[t].isTarget&&(this.data[t].isTarget=!0,--this.canGetNum);var i=this.data,n=this.list_items.dataProvider;n?n.replaceAll(i):this.list_items.dataProvider=new eui.ArrayCollection(i)}var o=this.canGetNum<=0;this.btn_get.touchEnabled=!o,UIActionManager.setAbsGrey(this.btn_get,o)},e}(BasePanel);l.BravebookTasksView=e,__reflect(e.prototype,"game.BravebookTasksView");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="BraveBookTaskItem2Skin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,this.tapCallBack,this)},e.prototype.tapCallBack=function(){var e=this;if(!this.data.isTarget)if(this.data.canGet){var t=l.AppFacade.getInstance().retrieveProxy(l.ActivityPy.N).allActivityData[EActivityType.NewBraveBook].data,i=this.data.type;if(t&&t.isBuy&&i==TaskType.NewNewBraveBook||i==TaskType.NewBraveBook)l.AppFacade.getInstance().retrieveProxy(l.TaskPy.N).GetTaskReward(this.data.type,this.data.code,function(){l.GameMVC.activityMed.updateViewByCode(EActivityType.NewBraveBook,{updateTaskP:!0,code:e.data.code,sectionCode:e.data.sectionCode})},{unresetChapter:!0,code:this.data.code,sectionCode:this.data.sectionCode});else Utils.MsgUtils.addMidMsg("请激活令状！")}else if(this.data.jumpModule){if(!Utils.UnlockMgr.checkPass(this.data.jumpModule).allow)return;l.MainJumpConfig.jumpTo(this.data.jumpModule)}else Utils.MsgUtils.addMidMsg("无跳转途径")},e.prototype.dataChanged=function(){this.gp_items.removeChildren();for(var e=this.data,t=0,i=JSON.parse(this.data.rewards);t<i.length;t++){var n=i[t],o=customui.BaseItemFactory.create(21);o.updateData({type:n[0],code:n[1],num:n[2]}),o.scaleX=.65,o.scaleY=.65,this.gp_items.addChild(o)}var a=this.data.current>this.data.total?this.data.total:this.data.current,r=this.data.total;this.data.subType==TaskSubType.ArenaChallengeRank&&(a=this.data.canGet?1:0,r=1),this.lb_desc.textFlow=[{text:e.desc+"("},{text:""+a,style:{textColor:3407662}},{text:"/"+r+")"}];var s=l.GameMVC.activityPy.allActivityData[EActivityType.NewBraveBook].data,c=!(s&&s.isBuy&&this.data.type==TaskType.NewNewBraveBook||this.data.type==TaskType.NewBraveBook)&&e.canGet&&!e.isTarget;UIActionManager.setGrey(this.btn_get,c),this.btn_get.visible=!0,this.btn_got.visible=!1,this.btn_got.touchEnabled=!0,e.canGet&&!e.isTarget?(this.btn_get.label="领取",c||UIActionManager.addEffect(this.btn_get,"common_lingquanniu",{scaleX:.9,scaleY:.9})):(e.canGet&&e.isTarget?(this.btn_got.touchEnabled=!1,this.btn_get.touchEnabled=!1,this.btn_get.visible=!1,this.btn_got.visible=!0):this.btn_get.label="前往",UIActionManager.hideEffect(this.btn_get))},e}(eui.ItemRenderer);l.BravebookTaskItem=i,__reflect(i.prototype,"game.BravebookTaskItem")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.isOpen=!0,Utils.AssetsMgr.loadGroup("group_buxiu_baoxiang"),e.skinName="BuxiuBaoxiangViewSkin",e.backPackProxy=i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N),e.heroPy=i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N),e.actProxy=i.AppFacade.getInstance().retrieveProxy(i.ActivityPy.N),e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_buxiu_baoxiang")},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cu_resBar),this.type=EActivityType.BraveBook,this.actProxy.isOpen(EActivityType.NewBraveBook)&&(this.type=EActivityType.NewBraveBook),this.actList=this.actProxy.allActivityData[this.type].content[1],DragonBoneTools.create("common_buxiudebaozang_1",function(e){e.x=this.effect_2.width/2,e.y=this.effect_2.height/2,e.animation.play(),this.effect_2.addChild(e)},this),DragonBoneTools.create("common_buxiudebaozang_2",function(e){e.x=this.effect.width/2,e.y=this.effect.height/2,e.animation.play(),this.effect_2.addChild(e)},this),this.inintButton(),this.initConfig(),this.initView()},e.prototype.initView=function(){this.list=new eui.List,this.list.itemRenderer=o;var e=new eui.HorizontalLayout;e.horizontalAlign=egret.HorizontalAlign.CENTER,this.list.layout=e;var t=[];for(var i in this.actList[1][1]){var n=this.actList[1][1][i];t.push({type:n[0],model:n[1],num:n[2],xiyou:n[4],code:i})}this.list.dataProvider=new eui.ArrayCollection(t),this.gp_reward.addChild(this.list)},e.prototype.initConfig=function(){this.cofing={},this.cofing[1]={},this.cofing[10]={},this.cofing[1].itemCosts=this.actList[0][1][0],this.cofing[1].moneyCosts=this.actList[0][0][0],this.cofing[10].itemCosts=this.actList[0][3][0],this.cofing[10].moneyCosts=this.actList[0][2][0]},e.prototype.inintButton=function(){this.heroPy.gashaponInfo;this.btn_challenge1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;if(this.isOpen){if(this.isOpen=!1,!(this.backPackProxy.checkEnough([this.cofing[1].itemCosts],!1)||this.cofing[1].moneyCosts[0]&&this.backPackProxy.checkEnough([this.cofing[1].moneyCosts],!1)))return Utils.MsgUtils.addMidMsg("道具不足"),void(this.isOpen=!0);var e=1,i=this.cofing[1].itemCosts,n=0<this.cofing[1].moneyCosts.length?this.cofing[1].moneyCosts:void 0;!this.backPackProxy.checkEnough([i],!1)&&n||(e=2),this.img_baoxiang.visible=!1,DragonBoneTools.playOnce({effectName:"common_buxiudebaozang_bxdk",parent:this.effect,y:this.effect.height/2-100,x:this.effect.width/2,doneCB:function(){t.type==EActivityType.NewBraveBook?t.actProxy.DoCommonOperation(EActivityType.NewBraveBook,e,0,function(){t.isOpen=!0,t.img_baoxiang.visible=!0,t.handleReward()}):Utils.Socket.send("activity","BraveBookHuntTreasure",{costIndex:e}).then(function(e){t.isOpen=!0,t.returnData=e,t.img_baoxiang.visible=!0,t.handleReward()})}})}},this),this.btn_challenge10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;if(this.isOpen){if(this.isOpen=!1,!(this.backPackProxy.checkEnough([this.cofing[10].itemCosts],!1)||this.cofing[10].moneyCosts&&this.backPackProxy.checkEnough([this.cofing[10].moneyCosts],!1)))return this.isOpen=!0,void Utils.MsgUtils.addMidMsg("道具不足");var e=3,i=this.cofing[10].itemCosts,n=0<this.cofing[10].moneyCosts.length?this.cofing[10].moneyCosts:void 0;!this.backPackProxy.checkEnough([i],!1)&&n||(e=4),this.img_baoxiang.visible=!1,DragonBoneTools.playOnce({effectName:"common_buxiudebaozang_bxdk",parent:this.effect,y:this.effect.height/2-80,x:this.effect.width/2,doneCB:function(){t.type==EActivityType.NewBraveBook?t.actProxy.DoCommonOperation(EActivityType.NewBraveBook,e,0,function(){t.isOpen=!0,t.img_baoxiang.visible=!0,t.handleReward()}):Utils.Socket.send("activity","BraveBookHuntTreasure",{costIndex:e}).then(function(e){t.isOpen=!0,t.returnData=e,t.img_baoxiang.visible=!0,t.handleReward()})}})}},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){(this.hide(),this.type==EActivityType.BraveBook)?i.AppFacade.getInstance().retrieveMediator(i.BraveBookMediator.N).updateView(i.BraveBookMediator.SV.MAIN):i.AppFacade.getInstance().retrieveMediator(i.ActivityMediator.N).updateViewByCode(EActivityType.NewBraveBook)},this)},e.prototype.updateView=function(){var e=this.cofing[1].itemCosts,t=0<this.cofing[1].moneyCosts.length?this.cofing[1].moneyCosts:void 0,i=t,n=0<this.cofing[10].moneyCosts.length?this.cofing[10].moneyCosts:void 0;!this.backPackProxy.checkEnough([e],!1)&&t||(i=e),!this.backPackProxy.checkEnough([this.cofing[10].itemCosts],!1)&&n||(n=this.cofing[10].itemCosts),this.type==EActivityType.NewBraveBook&&(this.returnData=n),this.icon_resource_1.updateItem({cost:i,style:CommonIconStyle.RIGHT,showEnough:!1}),this.icon_resource_10.updateItem({cost:n,style:CommonIconStyle.RIGHT,showEnough:!1}),this.updateResourceBar()},e.prototype.handleReward=function(){var e=this.returnData;if(e){if(this.type==EActivityType.BraveBook)i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N).handleClientReward({rewards:e.rewardShow},2);this.updateView()}},e.prototype.updateResourceBar=function(){var e=[];e.push(this.cofing[1].itemCosts[1]),this.cu_resBar.updateBar({costs:e,width:190,needAdd:!0})},e}(BasePanel);i.BuxiuBaoxiangView=e,__reflect(e.prototype,"game.BuxiuBaoxiangView");var o=function(t){function e(){var e=t.call(this)||this;return e.XIYOU_CONFIG={1:"common_buxiudebaozang_lan",2:"common_buxiudebaozang_zi",3:"common_buxiudebaozang_jin"},e.skinName="BuxiuBaoxiangitemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.cu_model.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.AppFacade.getInstance().showSubView(i.HeroMediator.N,i.HeroMediator.SV.HERO_DETAIL,{code:this.data.model})},this)},e.prototype.dataChanged=function(){this.effect||DragonBoneTools.create(this.XIYOU_CONFIG[this.data.xiyou+1],function(e){e.x=this.gp_daoju.width/2,e.y=this.gp_daoju.height/2-22,e.animation.play(),this.effect=e,this.gp_daoju.addChildAt(this.effect,0)},this),this.img_xiyou.source="yslz_img_jianglidi"+(this.data.xiyou+1)+"_png",this.data.type==EEntityType.EEntityTypeHero?(this.cu_model.visible=!0,this.baseitem.visible=!1,this.cu_model.update({isStatic:!0,code:this.data.model})):(this.cu_model.visible=!1,this.baseitem.visible=!0,this.baseitem.updateData({code:this.data.model,num:this.data.num}),this.baseitem.img_bg.visible=!1,this.baseitem.img_frame.visible=!1,this.baseitem.gp_star_item.visible=!1,this.baseitem.blb_num.visible=!1,this.baseitem.blb_level.visible=!1,UIActionManager.jumping(this.baseitem)),this.gp_daoju.y=0<this.data.code%2?80:0},e}(eui.ItemRenderer);__reflect(o.prototype,"BuxiuBaoxiangItem")}(game||(game={})),function(s){var e=function(i){function e(e){var t=i.call(this)||this;return t.skinName="CommonGetWaysSkin",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this)},e.prototype.updateView=function(e){e&&(this.params=e,this.makeAccess(this.params.type,this.params.code))},e.prototype.makeAccess=function(e,t){var i=this,n=s.Config.getMainWayConfigByIdAndEntityType(e,t);if(0<n.length)for(var o=0,a=n;o<a.length;o++){var r=a[o];this.gp_ways.addChild(new s.CommonAccessItem({wayCode:r,callBack:function(){i.hide()}}))}else this.gp_ways.addChild(new s.CommonAccessItem(void 0))},e}(BasePanel);s.CommonGetWaysView=e,__reflect(e.prototype,"game.CommonGetWaysView")}(game||(game={})),function(o){var e=function(t){function e(){var e=t.call(this)||this;return e._bubbleFloating=!1,e.proxy=o.GameMVC.activityPy,e.bubbleArr=[],e.ARROW_SPEED=4500,e.ARROW_INIT_ANGLE=-90,e.ARROW_AIM_OFFSET=30,e.BOW_RADIUS=250,e.BUBBLE_RADIUS=90,e.BUBBLE_POS_ARR=[[[133,86],[226,199],[281,66],[381,174],[463,66],[533,191],[601,67]],[[104,140],[226,60],[283,185],[360,66],[478,121],[602,69],[608,200]],[[112,182],[196,63],[280,181],[361,60],[435,199],[521,61],[642,103]],[[139,195],[191,77],[328,92],[400,198],[474,59],[563,197],[627,67]],[[110,73],[187,187],[288,62],[372,199],[462,94],[607,70],[633,199]]],e.skinName="ActivityMidAutumnArcherySkin",e}return __extends(e,t),e.prototype.initModel=function(){this.archerModel.armatureName="houyi",this.archerModel.play("daiji")},e.prototype.initBow=function(){this.bow=new n,this.bow.horizontalCenter=0,this.bow.verticalCenter=350,this.gp_root.addChild(this.bow),this.bow.radius=this.BOW_RADIUS,this.bow.angle=this.ARROW_INIT_ANGLE,this.bow.visible=!1},e.prototype.resetBow=function(){this.bow.angle=this.ARROW_INIT_ANGLE},e.prototype.initRewardBubble=function(){for(var e=0;e<7;e++){var t=new i;this.gp_window.addChild(t),this.bubbleArr.push(t)}this.rearangeBubblePos()},e.prototype.initCost=function(){var e=this.proxy.allActivityData[EActivityType.MidAutumnSun].content[4];this.icon_shootCost.updateItem({cost:e[0],style:CommonIconStyle.RIGHT}),this.resBar.updateBar({costs:e,needAdd:!0})},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initModel(),this.initBow(),this.initRewardBubble(),this.initCost(),this.activateComponent(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_title,this.gp_window,this.resBar)},e.prototype.updateView=function(e,t){var i=this.proxy.allActivityData[EActivityType.MidAutumnSun],n=i.data,o=n.rewards,a={};o.forEach(function(e){a[e[0]-1]=e});for(var r=0;r<7;r++){var s=a[r],c=this.bubbleArr[r];s?(c.visible=!0,c.update(s)):c.visible=!1}if(n.shootTimes?(this.blb_freeTimes.visible=!0,this.blb_freeTimes.text="免费"+n.shootTimes+"次",this.icon_shootCost.visible=!1):(this.blb_freeTimes.visible=!1,this.icon_shootCost.visible=!0),n.refreshTimes)this.blb_refreshTimes.visible=!0,this.blb_refreshTimes.text="免费"+n.refreshTimes+"次",this.btn_refresh.updateData({text:"刷新"});else{this.blb_refreshTimes.visible=!1;var l=i.content[3];this.btn_refresh.updateData({cost:l[0],text:"刷新"})}this.resBar.updateBar({costs:[1],needAdd:!0})},e.prototype.rearangeBubblePos=function(){this.allBubbleStop();var e=this.proxy.allActivityData[EActivityType.MidAutumnSun].data.lGenRewardDt,i=this.BUBBLE_POS_ARR[e%this.BUBBLE_POS_ARR.length];this.bubbleArr.forEach(function(e,t){e.x=i[t][0],e.y=e.originY=i[t][1]}),this.allBubbleFloat()},e.prototype.startShooting=function(){this.btn_return.visible=!1,this.btn_begin.visible=!1,this.icon_shootCost.visible=!1,this.blb_freeTimes.visible=!1,this.btn_refresh.visible=!1,this.blb_refreshTimes.visible=!1,this.btn_shoot.visible=!0,this.bow.visible=this.bow.img_arrow.visible=!0,this.resetBow(),this.begingAiming()},e.prototype.endShooting=function(){this.btn_return.visible=!0,this.btn_begin.visible=!0,this.btn_refresh.visible=!0,this.btn_shoot.visible=!1,this.bow.visible=!1},e.prototype.begingAiming=function(){egret.Tween.get(this.bow,{loop:!0}).to({angle:this.ARROW_INIT_ANGLE+this.ARROW_AIM_OFFSET},500).to({angle:this.ARROW_INIT_ANGLE},500).to({angle:this.ARROW_INIT_ANGLE-this.ARROW_AIM_OFFSET},500).to({angle:this.ARROW_INIT_ANGLE},500)},e.prototype.stopAiming=function(){egret.Tween.removeTweens(this.bow)},e.prototype.checkArrowHit=function(){var l=this,h={index:0,dis:2e3},p=[this.bow.img_arrow.x,this.bow.img_arrow.y];return this.bubbleArr.forEach(function(e,t){if(e.visible){var i=[-(l.bow.x-l.gp_window.x-e.x),-(l.bow.y-l.gp_window.y-e.y)],n=(i[0]*p[0]+i[1]*p[1])/(p[0]*p[0]+p[1]*p[1]),o=[n*p[0],n*p[1]],a=[i[0]-o[0],i[1]-o[1]],r=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(r<=l.BUBBLE_RADIUS){var s=Math.sqrt(l.BUBBLE_RADIUS*l.BUBBLE_RADIUS-r*r),c=Math.sqrt(o[0]*o[0]+o[1]*o[1]);c-s<h.dis&&(h.dis=c-s,h.index=t+1)}}}),h},e.prototype.handleOnHit=function(e){var t=this;this.bow.arrowStop(),this.bow.img_arrow.visible=!1;var i=function(){t.proxy.DoCommonOperation(EActivityType.MidAutumnSun,e,2,function(){GameRootLayer.gameLayer().switchTouchEnable(!0),t.endShooting(),t.allBubbleFloat()})};if(e){var n=this.bubbleArr[e-1];n.bubbleBreak(function(){n.visible=!1,n.endFloating(),i()})}else i()},e.prototype.allBubbleFloat=function(){this.bubbleArr.forEach(function(e){e.visible&&e.startFloating()})},e.prototype.allBubbleStop=function(){this.bubbleArr.forEach(function(e){e.endFloating()})},e.prototype.activateComponent=function(){var n=this;this.btn_begin.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=n.proxy.allActivityData[EActivityType.MidAutumnSun],t=e.data;if(t.rewards.length){var i=e.content[4];0<t.shootTimes||o.GameMVC.backpackPy.checkEnough(i,!1)?n.startShooting():Utils.MsgUtils.addMidMsg("货币不足")}else Utils.MsgUtils.addMidMsg("暂无射击目标，请进行刷新")},this),this.btn_shoot.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){GameRootLayer.gameLayer().switchTouchEnable(!1),n.stopAiming(),n.allBubbleStop(),n.archerModel.play("gongji",!1,1,function(){n.archerModel.play("gongji2",!1,1,function(){n.archerModel.play("daiji")});var e=n.checkArrowHit();n.bow.arrowShoot(e.dis,n.ARROW_SPEED,function(){n.handleOnHit(e.index)})})},this),this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.proxy.DoCommonOperation(EActivityType.MidAutumnSun,0,1,function(){n.rearangeBubblePos(),Utils.MsgUtils.addMidMsg("刷新成功")})},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.hide()},this)},e}(BaseFull);o.ActivityMidAutumnArcheryPanel=e,__reflect(e.prototype,"game.ActivityMidAutumnArcheryPanel");var i=function(i){function e(e){var t=i.call(this)||this;return t.width=t.height=0,t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.img_icon=new eui.Image,this.img_icon.horizontalCenter=this.img_icon.verticalCenter=0,this.addChild(this.img_icon),this.img_bg=new eui.Image,this.img_bg.horizontalCenter=this.img_bg.verticalCenter=0,this.addChild(this.img_bg),this.data&&this.update(this.data)},e.prototype.update=function(e){this.data=e;var t=this.data[1],i=o.Config.itemConfig()[t[0][1]];this.itemColor=i.color,this.itemColor===EColorType.EColorTypeRed?this.img_bg.source="zq_img_qipao2_png":this.itemColor===EColorType.EColorTypeOrange?this.img_bg.source="zq_img_qipao3_png":this.img_bg.source="zq_img_qipao1_png",this.img_icon.source=i.icon+"_png"},e.prototype.startFloating=function(){var e=Utils.MathUtils.getRandomInt(10,20),t=e/30*1e3;this.y=this.originY,egret.Tween.get(this,{loop:!0}).to({y:this.originY+e},t).to({y:this.originY-e},2*t).to({y:this.originY},t)},e.prototype.endFloating=function(){egret.Tween.removeTweens(this)},e.prototype.bubbleBreak=function(e){var t=this,i="";i=this.itemColor===EColorType.EColorTypeRed?"common_zqqshong":this.itemColor===EColorType.EColorTypeOrange?"common_zqqshuang":"common_zqqszi",this.img_bg.visible=!1,egret.Tween.get(this.img_icon).to({alpha:0},300),DragonBoneTools.playOnce({effectName:i,parent:this,doneCB:function(){t.img_bg.visible=!0,t.img_icon.alpha=1,e&&e()}})},e}(eui.Component);__reflect(i.prototype,"ActivityMidAutumnArcheryPanel_RewardBubble");var n=function(t){function e(){var e=t.call(this)||this;return e._arrowDir=new Vector2D,e._bowDir=new Vector2D,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.width=this.height=0,this.img_bow=new eui.Image("zq_img_gong_png"),this.img_bow.anchorOffsetX=162,this.addChild(this.img_bow),this.img_arrow=new eui.Image("zq_img_jian_png"),this.img_arrow.anchorOffsetX=22,this.addChild(this.img_arrow)},Object.defineProperty(e.prototype,"angle",{get:function(){return this._arrowDir.angle/Math.PI*180},set:function(e){this._arrowDir.angle=this._bowDir.angle=e/180*Math.PI,this.updateArrow(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{set:function(e){this._arrowDir.length=e,this._bowDir.length=e-60},enumerable:!0,configurable:!0}),e.prototype.updateArrow=function(e){this.img_arrow.x=this._arrowDir.x,this.img_arrow.y=this._arrowDir.y,this.img_arrow.rotation=this.angle+90,this.img_bow.x=this._bowDir.x,this.img_bow.y=this._bowDir.y,this.img_bow.rotation=this.angle+90},e.prototype.arrowShoot=function(e,t,i){var n=this;void 0===t&&(t=2e3);var o=this.angle;egret.Tween.get(this.img_arrow).call(function(){egret.Tween.get(n.img_bow).to({scaleY:1.3},100)}).to({x:this.img_arrow.x+-100*Math.cos(o*Math.PI/180),y:this.img_arrow.y+-100*Math.sin(o*Math.PI/180)},100).call(function(){egret.Tween.get(n.img_bow).to({scaleX:1.7,scaleY:.7,alpha:3},70).to({scaleX:1,scaleY:1,alpha:1},70)}).to({x:this.img_arrow.x+e*Math.cos(o*Math.PI/180),y:this.img_arrow.y+e*Math.sin(o*Math.PI/180)},e/t*1e3).call(function(){i&&i()})},e.prototype.arrowStop=function(){egret.Tween.removeTweens(this.img_arrow)},e}(eui.Component);__reflect(n.prototype,"ActivityMidAutumnArcheryPanel_Bow")}(game||(game={})),function(h){var e=function(t){function e(){var e=t.call(this)||this;return e.chooseList=[{code:0,num:0}],e.selectedUuid=[],e.py=h.AppFacade.getInstance().retrieveProxy(h.ActivityPy.N),e.skinName="ActivityMidAutumnEatSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var l=this;t.prototype.childrenCreated.call(this),Utils.TouchUtils.addTouchListener(this.btn_ok,function(){if(0!=l.chooseList[0].code){var e=l.chooseList[0].num;0<e&&l.py.DoCommonOperation(EActivityType.MoonCake,e,2,function(e){h.GameMVC.activityPy.allActivityData[EActivityType.MoonCake].updateData(e.info);var t,i=l.py.allActivityData[EActivityType.MoonCake],n=l.chooseList[0].code,o=i.content[0],a=i.content[3],r=0;for(var s in o)if(o[s][0]==n){r=o[s][2]-1;break}var c=Utils.MathUtils.getRandomInt(0,a.length-1);t=a[r][c],e.clientReward&&h.GameMVC.backpackPy.handleClientReward(e.clientReward,{lb_top_text:t}),l.selectedUuid=[],l.updateChoose(),l.updateItem(),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.MidAutumn])},void 0,JSON.stringify(l.chooseList[0].code))}else Utils.MsgUtils.addMidMsg("请先选择兑换的月饼")}),this.updateChoose(),this.updateItem(),UIActionManager.fadeBlink(this.gp_text,!0,!1,5e3),this.heroModel_0.update({model:"hero_skin_091_01",isStatic:!0}),this.heroModel_1.update({model:"hero_skin_091_01_tz",isStatic:!0})},e.prototype.updateChoose=function(){for(var e in this.chooseList)this.chooseList[e].code=0,this.chooseList[e].num=0;var t=0,i=0;if(0<this.selectedUuid.length)for(var e in this.selectedUuid){var n=h.GameMVC.backpackPy.AllItemInfo,o=this.selectedUuid[e],a=h.Config.itemConfig()[Number(o)];t=Number(a.id),i=n[o][0].num,this.chooseList[e].code=t,this.chooseList[e].num=i}},e.prototype.updateItem=function(){var t=this,e=this.gp_choose.$children[0];e||(e=new i,this.gp_choose.addChild(e),Utils.ComponentUtils.registerListener(e,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new h.ActivityMidAutumnMakeChoosePanel({getInfos:function(){var e={},t=h.GameMVC.backpackPy.AllItemInfo;for(var i in t){var n=t[i][0],o=h.Config.itemConfig()[Number(i)];0==o.type&&2==o.subType&&(o.num=n.num,e[""+i]=o)}return e},checkFull:function(e){return 1<=e.length},selectUuids:t.selectedUuid,uniNum:!1,type:EEntityType.EEntityTypeItem,isOnlyCode:!0,title:"请选择月饼",text:"",isShowDi:!1,posY:-50}),closeCB:function(e){t.updateChoose(),t.updateItem()}})},this)),e.updateItem({code:this.chooseList[0].code,num:this.chooseList[0].num})},e}(BasePanel);h.ActivityMidAutumnEatPanel=e,__reflect(e.prototype,"game.ActivityMidAutumnEatPanel");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityMidAutumnMake_ItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem),UIActionManager.fadeBlink(this.img_add,!0,!1,500)},e.prototype.updateItem=function(e){this.data=e,this.data.code?(this.gp_empty.visible=!1,this.gp_baseitem.visible=!0,this.baseItem.updateData({code:this.data.code})):(this.gp_empty.visible=!0,this.gp_baseitem.visible=!1),this.data.num?(this.lb_unlock.visible=!0,this.lb_unlock.text=this.data.num+""):this.lb_unlock.visible=!1},e}(eui.Component);__reflect(i.prototype,"ActivityMidAutumnMake_Item")}(game||(game={})),function(n){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=n.GameMVC.activityPy,e.skinName="ActivityMidAutumnIdelRewardSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},e.prototype.updateView=function(e){var t=this.proxy.allActivityData[EActivityType.MidAutumn].data.playerInfo;this.gp_rewards.removeChildren();var i=t.treeRewards;n.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,i)},e.prototype.perClose=function(){this.proxy.DoCommonOperation(EActivityType.MidAutumn,1,3)},e}(BasePanel);n.ActivityMidAutumnIdelRewardPanel=e,__reflect(e.prototype,"game.ActivityMidAutumnIdelRewardPanel")}(game||(game={})),function(l){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=l.GameMVC.activityPy,e.treeObjArr=[],e.posList=[[189,25],[440,151],[105,149],[593,133],[23,24],[515,23],[269,135],[363,35]],e.selfPos=void 0,e.skinName="ActivityMidAutumnMainSkin",e}return __extends(e,t),e.prototype.perClose=function(){t.prototype.perClose.call(this),this.timeOutTimer&&egret.clearTimeout(this.timeOutTimer),this.timer&&egret.clearInterval(this.timer)},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.initModel(),this.initTreeObjective(),this.activateComponent(),this.addNotice(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_guide),Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_gift),this.timer=egret.setInterval(function(){e.showDialog(),e.treeArmature.visible=!1,e.treeArmature2.visible=!0,e.treeArmature2.play("common_zqhs_2",!0,1,function(){e.treeArmature.visible=!0,e.treeArmature2.visible=!1})},this,1e4)},e.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.ACTIVITY_MID_GIFT,this.btn_gift.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.ACTIVITY_MID_EAT,this.btn_eat.getChildAt(0),this,{percentX:.8125,percentY:-10/49}),NoticeManager.addNoticeListener(NT.ACTIVITY_MID_CREAT,this.btn_creat.getChildAt(0),this,{percentX:.8125,percentY:-10/49}),NoticeManager.addNoticeListener(NT.ALL_ACTIVITY[EActivityType.MidAutumnSun],this.btn_archery.getChildAt(0),this,{percentX:.8125,percentY:-10/49}),NoticeManager.addNoticeListener(NT.ALL_ACTIVITY[EActivityType.ZhongQiuTask],this.btn_task.getChildAt(0),this,{percentX:.8125,percentY:-10/49})},e.prototype.initModel=function(){this.moonFairy.armatureName="hero_skin_091_01",this.moonFairy.play("daiji"),this.archer.armatureName="houyi",this.archer.play("daiji"),this.wugang.armatureName="wugang",this.wugang.play("gongji"),this.treeArmature.armatureName="common_zqhs_1",this.treeArmature2.armatureName="common_zqhs_2",this.treeArmature2.visible=!1},e.prototype.initTreeObjective=function(){for(var e=0;e<5;e++){var t=new i;this["gp_idelPos"+e].addChild(t),this.treeObjArr.push(t)}},e.prototype.updateView=function(e){var t=this,i=this.proxy.allActivityData[EActivityType.MidAutumn];if(i.data.playerInfo){i.data.playerInfo;var n=i.data.keng,o=l.GameMVC.playerPy.playerInfoVO.playerId;this.selfPos=void 0;var a={};n.forEach&&n.forEach(function(e){e[1].playerId===o&&(t.selfPos=e[0]-1),a[e[0]-1]=e[1]});for(var r=0;r<5;r++){this.treeObjArr[r].updateData({pos:r,isSelf:this.selfPos===r,info:{vo:a[r]}})}}else this.proxy.DoCommonOperation(EActivityType.MidAutumn,0,1);var s=this.proxy.checkIdelAvailable();this.wugang.play(s?"gongji":"daiji"),this.updateReward(),this.updateGiftBtn()},e.prototype.captureObjective=function(e){var t=this;if(this.proxy.checkIdelAvailable()){var i=e.data.pos;if(void 0===this.selfPos)if(e.data.info&&e.data.info.vo){var n=e.data.info.vo;l.GameMVC.playerPy.GetPublicPlayerInfo([n.playerId],function(e,t){PopUpManager.addPopUp({obj:new a({pos:i,info:e[0].publicPlayer})})})}else DragonBoneTools.playOnce({effectName:"common_zqq",parent:e,y:87,doneCB:function(){t.proxy.DoCommonOperation(EActivityType.MidAutumn,i+1,2,function(){Utils.MsgUtils.addMidMsg("占领成功")})}});else Utils.MsgUtils.addMidMsg("无法重复占领")}else{var o=this.proxy.allActivityData[EActivityType.MidAutumn].content[3];Utils.MsgUtils.addMidMsg("每日"+o[0][0]+":"+(0===o[0][1]?"00":o[0][1].toString())+"-"+o[1][0]+":"+(0===o[1][1]?"00":o[0][1].toString())+"可协助吴刚砍树")}},e.prototype.showDialog=function(){var e=this;this.gp_dialog.visible=!0,this.timeOutTimer=egret.setTimeout(function(){e.gp_dialog.visible=!1},this,3e3)},e.prototype.activateComponent=function(){var t=this;this.treeObjArr.forEach(function(e){e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.captureObjective(e)},t)}),this.gp_mcConvert.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new l.ActivityMidAutumnEatPanel})},this),this.gp_mcProduce.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new l.ActivityMidAutumnMakePanel})},this),this.gp_archery.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.GameMVC.activityMed.showViewByCode(EActivityType.MidAutumnSun)},this),this.gp_task.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new l.ActivityMidAutumnTaskPanel})},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.MainJumpConfig.jumpTo()},this),this.btn_guide.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.proxy.allActivityData[EActivityType.MidAutumn];l.GameMVC.activityMed.showHelpDialog(e.content[4])},this),this.btn_gift.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.AppFacade.getInstance().showSubView(l.ActivityMediator.N,l.ActivityMediator.SV.MID_ALL_GIFT,{cb:t.updateView.bind(t)})},this)},e.prototype.updateReward=function(){this.gp_rewardBubbles.touchEnabled=!0;var e=this.proxy.allActivityData[EActivityType.RandomEvent];if(this.gp_rewardBubbles.removeChildren(),e&&e.data&&e.data.gifts)if(e.data.inActivity)for(var t=8<e.data.events.length?8:e.data.events.length,i=0;i<t;i++){var n=new o({info:e.data.events[i],cb:this.updateView.bind(this),touch:this.gp_rewardBubbles});n.x=this.posList[e.data.events[i][0]-1][0],n.y=this.posList[e.data.events[i][0]-1][1],this.gp_rewardBubbles.addChild(n)}else this.proxy.DoCommonOperation(EActivityType.RandomEvent,0,1);else this.proxy.DoCommonOperation(EActivityType.RandomEvent,0,1)},e.prototype.updateGiftBtn=function(){var e=this.proxy.allActivityData[EActivityType.RandomEvent],a=e.content[2],t=JSON.parse(e.data.gifts),r=l.GameMVC.rechargePy.goodList,s=[],c=Utils.TimerManager.getServerTime();t.forEach(function(e){var t={uuid:e.uuid,info:e,config:void 0,goodInfo:void 0,chosen:!1};for(var i in a){var n=a[i];if(n[0]===e.code){t.config=n;break}}for(var i in r){var o=r[i];if(Number(o.id)===t.config[1]){t.goodInfo=o;break}}0<e.triggerDt+t.config[3]-c&&s.push(t)}),this.btn_gift.visible=0<s.length},e}(BaseFull);l.ActivityMidAutumnMainView=e,__reflect(e.prototype,"game.ActivityMidAutumnMainView");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityMidAutumnMainView_TreeObjective",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.avatar=customui.PlayerHeadFactory.create(),this.gp_avatar.addChild(this.avatar),this.emptyArmature.armatureName="common_zqkxjz",egret.Tween.get(this.gp_avatar,{loop:!0}).to({y:-15},700).to({y:0},700),egret.Tween.get(this.img_arrow,{loop:!0}).to({y:52},700).to({y:67},700)},e.prototype.updateData=function(e){if((this.data=e).info&&e.info.vo){this.gp_notEmpty.visible=!0,this.emptyArmature.visible=!1;var t=e.info.vo;this.avatar.updateData({vo:t}),this.lb_name.text="S"+t.serverId+"·"+t.name,this.lb_name.textColor=e.isSelf?3473395:16777215}else this.gp_notEmpty.visible=!1,this.emptyArmature.visible=!0},e}(eui.Component);__reflect(i.prototype,"ActivityMidAutumnMainView_TreeObjective");var a=function(i){function e(e){var t=i.call(this)||this;return t.skinName="ActivityMidAutumnChallengeSkin",t.data=e,t}return __extends(e,i),e.prototype.activateComponent=function(){var e=this;this.avatar=customui.PlayerHeadFactory.create(),this.gp_avatar.addChild(this.avatar),this.btn_challenge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide(),l.GameMVC.activityPy.MidAutumnChallenge({pos:e.data.pos+1})},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.AppFacade.getInstance().showSubView(l.HeroMediator.N,l.HeroMediator.SV.FORMATION)},this)},e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.activateComponent(),this.data&&this.updateView()},e.prototype.updateView=function(e){var i=this,t=this.data.info.baseInfo;this.avatar.updateData({vo:t}),this.lb_name.text=t.name,this.lb_serverId.text="S"+t.serverId,this.fightCapItem.update(t.fightCap),this.data.info.heroList.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e.code,level:e.level}),i.gp_enemy.addChild(t)})},e}(BasePanel);__reflect(a.prototype,"ActivityMidAutumnMainView_ChallengePanel");var o=function(i){function e(e){var t=i.call(this)||this;return t.proxy=l.GameMVC.activityPy,t.originY=0,t.isCanTouch=!1,t.skinName="ActivityMidAutumnEvent_ItemSkin",t.params=e.info,t.cb=e.cb,t.touch=e.touch,t}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.isCanTouch){t.touch.touchEnabled=!1,t.isCanTouch=!1,t.gp_root.visible=!1;var e="";"zq_img_qipao1_png"==t.img_qipao.source?e="common_zqqszi":"zq_img_qipao2_png"==t.img_qipao.source?e="common_zqqshong":"zq_img_qipao3_png"==t.img_qipao.source&&(e="common_zqqshuang"),DragonBoneTools.playOnce({effectName:e,parent:t.gp_effect,x:t.gp_effect.width/2||0,y:t.gp_effect.height/2||0,keep:!1,loop:!1,doneCB:function(){t.proxy.DoCommonOperation(EActivityType.RandomEvent,t.params[0],2,function(e){0==t.params[1]||1==t.params[1]&&PopUpManager.addPopUp({obj:new l.ActivityMidAutumnRewardPanel({code:t.params[2],cb:t.cb})}),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.MidAutumn]),t.cb&&t.cb()})}})}},this),this.updateData(),egret.Tween.removeTweens(this),this.startFloating()},e.prototype.startFloating=function(){this.originY=this.y;var e=Utils.MathUtils.getRandomInt(10,20),t=e/30*1e3;egret.Tween.get(this,{loop:!0}).to({y:this.originY+e},t).to({y:this.originY-e},2*t).to({y:this.originY},t)},e.prototype.updateData=function(){this.gp_root.visible=!0,this.isCanTouch=!0;var e=this.proxy.allActivityData[EActivityType.RandomEvent],t=void 0,i="",n="";if(0==this.params[1])for(var o in t=e.content[1])t[o][0]==this.params[2]&&(i=t[o][4]+"_png",n=t[o][3]+"_png");else if(1==this.params[1])for(var o in t=e.content[2])t[o][0]==this.params[2]&&(i=t[o][7]+"_png",n=t[o][6]+"_png");this.img_qipao.source=i,this.img_gift.source=n},e}(eui.Component);__reflect(o.prototype,"ActivityMidAutumnEvent_Item")}(game||(game={})),function(n){var e=function(i){function e(e){var t=i.call(this)||this;return t.backpackPy=n.AppFacade.getInstance().retrieveProxy(n.BackpackPy.N),t.selectUuids=[],t.skinName="ActivityMidAutumnMakeChooseSkin",t.params=e,t.selectUuids=e.selectUuids||[],t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initList(),this.activateComponent(),this.updateView(this.params)},e.prototype.initList=function(){this.ac_list=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_list,this.list_item.itemRenderer=t,this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListItemTap,this)},e.prototype.onListItemTap=function(e){var t=e.item;if(t.info.isLocked)Utils.MsgUtils.addMidMsg("该"+ENTITY_2_NAME[t.info.entityType]+"已经被锁住");else if(this.params.singleChoose){for(var i in this.ac_list.source){var n=this.ac_list.source[i];n.chosen=n.uuid==t.uuid}this.ac_list.replaceAll(this.ac_list.source),this.selectUuids[0]=t.uuid}else{e.itemRenderer;if(0<=this.selectUuids.indexOf(t.uuid))t.chosen=!t.chosen,this.selectUuids.splice(this.selectUuids.indexOf(t.uuid),1),this.ac_list.replaceAll(this.ac_list.source);else this.params.checkFull&&this.params.checkFull(this.selectUuids)||!1?Utils.MsgUtils.addMidMsg(this.params.fullTip||"当前已选满"):(t.chosen=!0,this.selectUuids.push(t.uuid),this.ac_list.replaceAll(this.ac_list.source))}},e.prototype.updateView=function(e){var o=this,t=[],i=this.params.getInfos&&this.params.getInfos();this.lb_title.text=this.params.title,this.lb_text.text=this.params.text,this.scroller.y=this.scroller.y+this.params.posY,i||(i=[]);var n=this.params.excludeUuids||[];for(var a in i){var r=i[a];if(!(0<=n.indexOf(a))){var s=0<=this.selectUuids.indexOf(a);t.push({uuid:a,chosen:s,isOnlyCode:this.params.isOnlyCode||!1,info:r,type:this.params.type||EEntityType.EEntityTypeItem,uniNum:this.params.uniNum})}}t.length?(this.img_di.visible=!!e.isShowDi,this.gp_empty.visible=!1,this.btn_confirm.visible=!0,this.params.sortFunc||(this.params.sortFunc=function(e,t){var i=e.info,n=t.info;return i.isLocked!=n.isLocked?i.isLocked?1:-1:o.backpackPy.checkHeroInTeam(i.uuid)&&!o.backpackPy.checkHeroInTeam(n.uuid)?1:!o.backpackPy.checkHeroInTeam(i.uuid)&&o.backpackPy.checkHeroInTeam(n.uuid)?-1:i.code!=n.code?i.code-n.code:i.level-n.level}),t.sort(function(e,t){return o.params.sortFunc(e,t)}),this.ac_list.replaceAll(t)):(this.gp_empty.visible=!0,this.btn_confirm.visible=!1,this.img_di.visible=!1)},e.prototype.activateComponent=function(){this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.opperationParams=this.selectUuids,this.hide()},this)},e.prototype.onDestroy=function(){this.params.noCloseAsConfirm||(this.opperationParams=this.selectUuids),i.prototype.onDestroy.call(this)},e}(BasePanel);n.ActivityMidAutumnMakeChoosePanel=e,__reflect(e.prototype,"game.ActivityMidAutumnMakeChoosePanel");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="CommonChosePanelItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_bi.addChild(this.baseItem)},e.prototype.dataChanged=function(){this.data.isOnlyCode?this.baseItem.updateData({code:this.data.info.id,type:this.data.info.type,num:this.data.info.num}):this.baseItem.updateData({uuid:this.data.info.uuid,type:this.data.type}),this.data.uniNum&&(this.baseItem.blb_num.text="1"),this.data.info.isLocked?this.gp_lock.visible=!0:this.gp_lock.visible=!1,this.updateChosen(this.data.chosen),UIActionManager.setGrey(this.gp_bi,this.data.chosen)},e.prototype.updateChosen=function(e){this.data.chosen=e,this.gp_chosen.visible=e},e}(eui.ItemRenderer);__reflect(t.prototype,"CommonChosePanelItem")}(game||(game={})),function(r){var e=function(t){function e(){var e=t.call(this)||this;return e.chooseList=[{code:0,num:0},{code:0,num:0}],e.maxBuyNum=0,e.selectedUuid=[],e.py=r.AppFacade.getInstance().retrieveProxy(r.ActivityPy.N),e.skinName="ActivityMidAutumnMakeSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var n=this;t.prototype.childrenCreated.call(this),this.commonDaTanKuang.blb_title.text="月饼制作",this.commonDaTanKuang.onCloseCB=function(){n.hide()},this.lb_num.addEventListener(egret.Event.CHANGE,function(){Number(n.lb_num.text)>n.maxBuyNum&&(n.lb_num.text=n.maxBuyNum.toString())},this),Utils.TouchUtils.addTouchListener(this.btn_min,function(){n.setValueTo(Number(n.lb_num.text)-10)}),Utils.TouchUtils.addTouchListener(this.btn_sub,function(){n.setValueTo(Number(n.lb_num.text)-1)}),Utils.TouchUtils.addTouchListener(this.btn_add,function(){n.setValueTo(Number(n.lb_num.text)+1)}),Utils.TouchUtils.addTouchListener(this.btn_max,function(){n.setValueTo(Number(n.lb_num.text)+10)}),Utils.TouchUtils.addTouchListener(this.btn_creat,function(){if(0!=n.chooseList[0].code||0!=n.chooseList[1].code){var i=Number(n.lb_num.text);0<i?(n.btn_creat.touchEnabled=!1,DragonBoneTools.playOnce({effectName:"common_zqkszz",parent:n.gp_effect,x:n.gp_effect.width/2||0,y:n.gp_effect.height/2||0,keep:!1,loop:!1,doneCB:function(){var e=[];for(var t in n.chooseList)0!=n.chooseList[t].code&&e.push(n.chooseList[t].code);n.py.DoCommonOperation(EActivityType.MoonCake,i,1,function(e){n.btn_creat.touchEnabled=!0,n.updateChoose(),n.updateView(),PopUpManager.addPopUp({obj:new r.ActivityMidAutumnMakeResultPanel(e)}),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.MidAutumn])},void 0,JSON.stringify(e))}})):Utils.MsgUtils.addMidMsg("请选择制作个数")}else Utils.MsgUtils.addMidMsg("请先选择材料")}),this.updateView()},e.prototype.setValueTo=function(e){e>this.maxBuyNum&&(e=this.maxBuyNum),e<1&&(e=0),this.lb_num.text=e.toString()},e.prototype.updateView=function(){this.updateItem(),0!=this.chooseList[0].num&&0!=this.chooseList[1].num?this.maxBuyNum=this.chooseList[0].num>this.chooseList[1].num?this.chooseList[1].num:this.chooseList[0].num:0==this.chooseList[0].num&&0==this.chooseList[1].num?this.maxBuyNum=0:0!=this.chooseList[0].num&&0==this.chooseList[1].num?this.maxBuyNum=this.chooseList[0].num:0==this.chooseList[0].num&&0!=this.chooseList[1].num&&(this.maxBuyNum=this.chooseList[1].num),this.maxBuyNum=10<this.maxBuyNum?10:this.maxBuyNum;var e=0<this.maxBuyNum?1:0;this.lb_num.text=e+"",0!=this.chooseList[0].code||0!=this.chooseList[1].code?this.img_yuebin.visible=!0:this.img_yuebin.visible=!1},e.prototype.updateChoose=function(){for(var e in this.chooseList)this.chooseList[e].code=0,this.chooseList[e].num=0;var t=0,i=0;if(0<this.selectedUuid.length)for(var e in this.selectedUuid){var n=r.GameMVC.backpackPy.AllItemInfo,o=this.selectedUuid[e],a=r.Config.itemConfig()[Number(o)];t=Number(a.id),n[o]?(i=n[o][0].num,this.chooseList[e].code=t,this.chooseList[e].num=i):this.selectedUuid.splice(Number(e))}},e.prototype.updateItem=function(){var t=this,e=this.gp_choose_0.$children[0];e||(e=new n,this.gp_choose_0.addChild(e),Utils.ComponentUtils.registerListener(e,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new r.ActivityMidAutumnMakeChoosePanel({getInfos:function(){var e={},t=r.GameMVC.backpackPy.AllItemInfo;for(var i in t){var n=t[i][0],o=r.Config.itemConfig()[Number(i)];0==o.type&&1==o.subType&&(o.num=n.num,e[""+i]=o)}return e},checkFull:function(e){return 2<=e.length},selectUuids:t.selectedUuid,uniNum:!1,type:EEntityType.EEntityTypeItem,isOnlyCode:!0,title:"请选择材料",text:"月饼材料（可选1-2种）",isShowDi:!0,posY:0}),closeCB:function(e){t.updateChoose(),t.updateView()}})},this)),e.updateItem({code:this.chooseList[0].code,num:this.chooseList[0].num});var i=this.gp_choose_1.$children[0];i||(i=new n,this.gp_choose_1.addChild(i),Utils.ComponentUtils.registerListener(i,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new r.ActivityMidAutumnMakeChoosePanel({getInfos:function(){var e={},t=r.GameMVC.backpackPy.AllItemInfo;for(var i in t){var n=t[i][0],o=r.Config.itemConfig()[Number(i)];0==o.type&&1==o.subType&&(o.num=n.num,e[""+i]=o)}return e},checkFull:function(e){return 2<=e.length},selectUuids:t.selectedUuid,uniNum:!1,type:EEntityType.EEntityTypeItem,isOnlyCode:!0,title:"请选择材料",text:"月饼材料（可选1-2种）",isShowDi:!0,posY:0}),closeCB:function(e){t.updateChoose(),t.updateView()}})},this)),i.updateItem({code:this.chooseList[1].code,num:this.chooseList[1].num})},e}(BasePanel);r.ActivityMidAutumnMakePanel=e,__reflect(e.prototype,"game.ActivityMidAutumnMakePanel");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityMidAutumnMake_ItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem),UIActionManager.fadeBlink(this.img_add,!0,!1,500)},e.prototype.updateItem=function(e){this.data=e,this.data.code?(this.gp_empty.visible=!1,this.gp_baseitem.visible=!0,this.baseItem.updateData({code:this.data.code})):(this.gp_empty.visible=!0,this.gp_baseitem.visible=!1),this.data.num?(this.lb_unlock.visible=!0,this.lb_unlock.text=this.data.num+""):this.lb_unlock.visible=!1},e}(eui.Component);__reflect(n.prototype,"ActivityMidAutumnMake_Item")}(game||(game={})),function(i){var e=function(s){function e(e){var t=s.call(this)||this;return t.py=i.AppFacade.getInstance().retrieveProxy(i.ActivityPy.N),t.params=void 0,t.skinName="ActivityMidAutumnMakeResultSkin",t.params=e,t}return __extends(e,s),e.prototype.childrenCreated=function(){var t=this;if(s.prototype.childrenCreated.call(this),Utils.TouchUtils.addTouchListener(this.btn_ok,function(){t.hide()}),this.img_result.visible=!1,this.params&&this.params.info){var e=JSON.parse(this.params.info),i=e.result?"common_zqzzcg_1":"common_zqzzsb_1",n=e.result?"common_zqzzcg_2":"common_zqzzsb_2";DragonBoneTools.create(n,function(e){(t.ead_model1=e).x=t.gp_effect.width/2,e.y=480,t.gp_effect.addChild(t.ead_model1),t.ead_model1.visible=!1,t.ead_model1.animation.play(),DragonBoneTools.create(i,function(e){(t.ead_model2=e).x=t.gp_effect.width/2,e.y=480,t.gp_effect.addChild(t.ead_model2),t.ead_model2.visible=!0,t.ead_model2.animation.play(),e.addEventListener(dragonBones.EventObject.COMPLETE,function(){t.ead_model1.visible=!0},t)},t,{cacheFrameRate:t.cacheFrameRate})},this,{cacheFrameRate:this.cacheFrameRate})}if(this.params&&this.params.clientReward&&this.params.clientReward.rewards){var o=this.params.clientReward.rewards;for(var a in o){var r=customui.BaseItemFactory.create();r.scaleX=r.scaleY=.7,r.updateData({code:o[a].code,type:o[a].type,num:o[a].num}),this.gp_reward.addChild(r)}}},e}(BasePanel);i.ActivityMidAutumnMakeResultPanel=e,__reflect(e.prototype,"game.ActivityMidAutumnMakeResultPanel")}(game||(game={})),function(l){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityMidAutumnRewardAllPanelSkin",e}return __extends(e,t),Object.defineProperty(e.prototype,"info",{get:function(){return l.GameMVC.activityPy.allActivityData[EActivityType.RandomEvent]},enumerable:!0,configurable:!0}),e.prototype.initList=function(){this.ac_item=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_item,this.list_item.itemRenderer=i,this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.activateComponent(),this.heroModel_0.update({model:"hero_skin_091_01",isStatic:!0}),this.heroModel_1.update({model:"hero_skin_091_01_tz",isStatic:!0})},e.prototype.updateView=function(e){e&&e.cb&&(this.cb=e.cb);var a=this.info.content[2],t=JSON.parse(this.info.data.gifts),r=l.GameMVC.rechargePy.goodList,s=[],c=Utils.TimerManager.getServerTime();t.forEach(function(e){var t={uuid:e.uuid,info:e,config:void 0,goodInfo:void 0,chosen:!1};for(var i in a){var n=a[i];if(n[0]===e.code){t.config=n;break}}for(var i in r){var o=r[i];if(Number(o.id)===t.config[1]){t.goodInfo=o;break}}0<e.triggerDt+t.config[3]-c&&s.push(t)}),0<s.length?(this.ac_item.source=s,this.ac_item.refresh(),this.onItemTap(),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.MidAutumn]),this.cb&&this.cb()):(this.cb&&this.cb(),this.hide())},e.prototype.onItemTap=function(e){this.curData=e&&e.item||this.ac_item.source[0],this.updateSelected(this.curData.uuid),this.updateContent(this.curData)},e.prototype.updateSelected=function(t){this.ac_item.source.forEach(function(e){e.chosen=e.uuid===t}),this.ac_item.replaceAll(this.ac_item.source)},e.prototype.updateContent=function(e){var t=this,i=e.config;this.gp_reward.removeChildren(),l.GameMgr.getInstance().CommonGpAddReward(this.gp_reward,i[2],1);var n=e.info;this.timer&&egret.clearInterval(this.timer);var o=Utils.TimerManager.getServerTime(),a=n.triggerDt+i[3]-o;this.lb_time.text=Utils.TimerManager.getFormatBySecond1(a),this.timer=egret.setInterval(function(){0<a?t.lb_time.text=Utils.TimerManager.getFormatBySecond1(--a):(egret.clearInterval(t.timer),t.updateView())},this,1e3);var r=e.goodInfo;r?(this.icon_cost.visible=!1,this.btn_purchase.label=r.price+"元"):(this.icon_cost.visible=!0,this.icon_cost.updateItem({cost:i[4][0],style:CommonIconStyle.RIGHT}),this.btn_purchase.label="")},e.prototype.activateComponent=function(){var i=this;this.CommonDaTanChuKuang.blb_title.text="礼包",this.CommonDaTanChuKuang.onCloseCB=function(){i.hide()},this.btn_purchase.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=EActivityType.RandomEvent,e=i.curData.uuid;i.curData.config[1]?l.GameMVC.rechargePy.purchase(i.curData.goodInfo,2,e,JSON.stringify({uuid:e,activityType:t}),{code:e,activityType:t},function(){}):Utils.Socket.send("activity","DoCommonOperation",{code:t,id:3,info:e}).then(function(e){l.GameMVC.activityPy.updateData_View_Reward(t,e),i.cb&&i.cb(),i.updateView(),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.MidAutumn])})},this)},e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer)},e}(BasePanel);l.ActivityMidAutumnRewardAllPanel=e,__reflect(e.prototype,"game.ActivityMidAutumnRewardAllPanel");var i=function(t){function e(){var e=t.call(this)||this;return e.oldY=-5,e.oldId=0,e.activityProxy=l.AppFacade.getInstance().retrieveProxy(l.ActivityPy.N),e.skinName="ActivityRootPanel_ActivityItem",e}return __extends(e,t),e.prototype.dataChanged=function(){var e=this.data.config;this.img_icon.source=e[9]+"_png",this.bm_title.text=e[10],this.updateSelected()},e.prototype.updateSelected=function(){this.img_bg.source=this.data.chosen?"newactivity_img_yeqian02_png":"newactivity_img_yeqian01_png",this.data.chosen?egret.Tween.get(this.img_icon,{loop:!0}).to({y:this.oldY-15},500).to({y:this.oldY},500):(egret.Tween.removeTweens(this.img_icon),this.img_icon.y=this.oldY)},e}(eui.ItemRenderer);__reflect(i.prototype,"ActivityRootPanel_ActivityItem")}(game||(game={})),function(p){var e=function(n){function e(e){var t=n.call(this)||this;return t.skinName="ActivityMidAutumnRewardPanelSkin",t.code=e.code,t.cb=e.cb,t}return __extends(e,n),e.prototype.childrenCreated=function(){var i=this;n.prototype.childrenCreated.call(this),this.rootPanel.gp_title.visible=!1,this.rootPanel.onCloseCB=function(){i.hide()},this.btn_purchase.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=EActivityType.RandomEvent,e=i.giftInfo.uuid;i.config[1]?p.GameMVC.rechargePy.purchase(i.goodInfo,2,e,JSON.stringify({uuid:e,activityType:t}),{code:e,activityType:t},function(){NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.MidAutumn]),i.cb&&i.cb(),i.hide()}):Utils.Socket.send("activity","DoCommonOperation",{code:t,id:3,info:e}).then(function(e){p.GameMVC.activityPy.updateData_View_Reward(t,e),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.MidAutumn]),i.cb&&i.cb(),i.hide()})},this),this.updateView()},e.prototype.updateView=function(e){var t=this,i=p.GameMVC.activityPy.allActivityData[EActivityType.RandomEvent],n=JSON.parse(i.data.gifts);if(this.giftInfo)n.every(function(e){return e.uuid!=t.giftInfo.uuid})&&this.hide();else{this.code;n.forEach(function(e){(!t.giftInfo||e.triggerDt>t.giftInfo.triggerDt)&&(t.giftInfo=e)});var o=i.content[2];for(var a in o){var r=o[a];if(r[0]===this.giftInfo.code){this.config=r;break}}if(this.lb_desc.text=this.config[8],this.gp_rewards.removeChildren(),p.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,this.config[2],1),this.config[1]){var s=p.GameMVC.rechargePy.goodList;for(var a in s){var c=s[a];if(Number(c.id)===this.config[1]){this.goodInfo=c;break}}this.icon_cost.visible=!1,this.btn_purchase.label=this.goodInfo.price+"元"}else this.btn_purchase.label="",this.icon_cost.visible=!0,this.icon_cost.updateItem({cost:this.config[4][0],style:CommonIconStyle.RIGHT});this.timer&&egret.clearInterval(this.timer);var l=Utils.TimerManager.getServerTime(),h=this.giftInfo.triggerDt+this.config[3]-l;this.lb_time.text=Utils.TimerManager.getFormatBySecond1(h),this.timer=egret.setInterval(function(){0<h?t.lb_time.text=Utils.TimerManager.getFormatBySecond1(--h):(egret.clearInterval(t.timer),t.hide())},this,1e3)}},e.prototype.onDestroy=function(){n.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer)},e}(BasePanel);p.ActivityMidAutumnRewardPanel=e,__reflect(e.prototype,"game.ActivityMidAutumnRewardPanel")}(game||(game={})),function(E){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.ZhongQiuTask,e.proxy=E.GameMVC.activityPy,e.skinName="ActivityMidAutumnTaskSkin",e}return __extends(e,t),Object.defineProperty(e.prototype,"info",{get:function(){return this.proxy.allActivityData[this.code]},enumerable:!0,configurable:!0}),e.prototype.initTabbar=function(){var e=this.info.content,i={};e.forEach(function(e){var t=e[7];i[t]||(i[t]={up:e[5]+"_png",down:e[6]+"_png"})});var t=[];for(var n in i){var o=i[n];t.push({type:Number(n),source:{up:o.up,down:o.down}})}this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar.dataProvider=new eui.ArrayCollection(t),this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this),this.tabbar.selectedIndex=0},e.prototype.initList=function(){this.ac_items=new eui.ArrayCollection,this.list_items.dataProvider=this.ac_items,this.list_items.itemRenderer=i},e.prototype.onItemTap=function(e){this.scl_list.stopAnimation(),this.scl_list.viewport.scrollV=0,this.updateView()},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.rootPanel.onCloseCB=function(){e.hide()},this.rootPanel.blb_title.text="任务",this.initTabbar(),this.initList(),this.updateView()},e.prototype.updateView=function(e){var o=this,t=this.tabbar.selectedItem.type,i=this.getDataList(),n=[],a={};i.forEach(function(e){e.type===t&&n.push(e),a[e.type]=a[e.type]||e.status!=REWARD_STATUS.RECEIVED}),this.ac_items.replaceAll(n),this.once(egret.Event.ENTER_FRAME,function(){o.tabbar.dataProvider.source.forEach(function(e,t){var i=e.type,n=o.tabbar.getChildAt(t);NoticeManager.redp(n,a[i],{x:70,y:-10})})},this)},e.prototype.getDataList=function(){var d=this,e=this.info;if(!e||!e.data)return[];var u=[],g=this.info.content,f=e.data.targeted;f[0]||(f=[]);var o=e.data.keyList,_={},m=function(e){if(d.code==EActivityType.MagicalUpGradeTask||d.code==EActivityType.PetUpGradeTask){var t=0;for(var i in o){(n=o[i]).taskType>=e&&(t+=n.key)}return _[e]=t}for(var i in o){var n;if((n=o[i]).taskType==e)return _[e]=n.key,n.key}return 0},t=E.Config.activityConfigs()[this.code],y=t&&t.rotation||1,v=0,T=9999999,i=0;if(1!=y){for(var n=g.length/y,a=1;a<=y;a++){var r=g[p=a*n-1],s=(r[0],r[1]%1e4),c=r[3],l=this.getTypeKey(c,r);if(!(s<=(_[l]||m(l)))){T=s;break}if(0,!(f.length>p)){T=s;break}i++,v=s}y<=i&&(i=y-1,v=g[g.length-n-1]&&g[g.length-n-1][1]||0,T=g[g.length-1][1])}var h=function(e){var t=g[e],i=t[0],n=C.getMax(t[1]);if(1!=y&&(n<=v||T<n))return"continue";var o=t[2],a=t[3],r=t[4],s=C.getTypeKey(a,t),c=_[s]||m(s),l=REWARD_STATUS.CANBUY;n<=c&&(l=REWARD_STATUS.AVAILABLE),0<=f.indexOf(i)&&(l=REWARD_STATUS.RECEIVED);var h=C.getTitle(a,t);C.code==EActivityType.ConsumeDiamondTask&&l==REWARD_STATUS.CANBUY&&(l=REWARD_STATUS.UNAVAILABLE);var p={id:i,key:n,title:h,status:l,rewards:o,tips:c-v+"/"+(n-v),btnText:l==REWARD_STATUS.CANBUY?"前往":"",btnFunc:function(e){switch(l){case REWARD_STATUS.AVAILABLE:d.getReward(i,function(){d.updateView()});break;case REWARD_STATUS.RECEIVED:Utils.MsgUtils.addMidMsg("已领取");break;case REWARD_STATUS.CANBUY:r&&E.MainJumpConfig.jumpTo(r)&&d.hide();break;case REWARD_STATUS.UNAVAILABLE:Utils.MsgUtils.addMidMsg("未满足条件")}},type:t[7]};u.push(p)},C=this;for(var p in g)h(p);return u.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.id-t.id}),u},e.prototype.getTitle=function(e,t){switch(this.code){case EActivityType.GuildCollectTask:case EActivityType.GuildCollectTask1:case EActivityType.HeroArtifactUpStarTask:return(E.ActivityCommonTaskView.TaskType_2_Title[e]||"").format([Math.floor(t[1]/1e4),t[1]%1e4]);case EActivityType.MagicalUpGradeTask:case EActivityType.PetUpGradeTask:return(E.ActivityCommonTaskView.TaskType_2_Title[e]||"").format([t[1]%1e4,Math.floor(t[1]/1e4)]);case EActivityType.ConsumeDiamondTask:return(E.ActivityCommonTaskView.TaskType_2_Title[e]||"").format([t[1]]);default:return(E.ActivityCommonTaskView.TaskType_2_Title[e]||"").format([t[1]%1e4])}},e.prototype.getMax=function(e){switch(this.code){case EActivityType.ConsumeDiamondTask:return e;default:return e%1e4}},e.prototype.getTypeKey=function(e,t){var i=e;switch(this.code){case EActivityType.GuildCollectTask:case EActivityType.GuildCollectTask1:case EActivityType.HeroArtifactUpStarTask:case EActivityType.MagicalUpGradeTask:case EActivityType.PetUpGradeTask:i=t[1]-t[1]%1e4}return i},e.prototype.getReward=function(e,t){var i=this;Utils.Socket.send("activity","GetCommonReward",{code:this.code,id:e}).then(function(e){i.info.updateData(e.info),E.GameMVC.backpackPy.handleClientReward(e.clientReward),t&&t(e)})},e}(BasePanel);E.ActivityMidAutumnTaskPanel=e,__reflect(e.prototype,"game.ActivityMidAutumnTaskPanel");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ActivityMidAutumnTaskPanel_TaskItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_receive.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.btnFunc&&e.data.btnFunc()},this)},e.prototype.dataChanged=function(){var e=this.data;this.lb_title.text=e.title,this.lb_progress.text=e.tips,this.gp_rewards.removeChildren(),E.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,e.rewards,1),this.data.status===REWARD_STATUS.RECEIVED?(this.btn_got.visible=!0,this.btn_receive.visible=!1):(this.btn_got.visible=!1,this.btn_receive.visible=!0,this.btn_receive.label=this.data.btnText||"领取"),this.data.status==REWARD_STATUS.AVAILABLE?UIActionManager.addEffect(this.btn_receive,"common_lingquanniu",{scaleX:1.2,scaleY:1.2,offectY:-2}):UIActionManager.hideEffect(this.btn_receive)},e}(eui.ItemRenderer);__reflect(i.prototype,"ActivityMidAutumnTaskPanel_TaskItem")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.skinName="CommonVipItemSkin",t.vipLevel=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.vipLevel&&this.update(this.vipLevel)},e.prototype.update=function(e){this.vipLevel=e,this.blb_vipLevel.text=this.vipLevel.toString()},e}(eui.Component);e.CommonVipItem=t,__reflect(t.prototype,"customui.CommonVipItem")}(customui||(customui={})),function(i){var e=function(){function e(){}return e.registerAll=function(){(new l).register()},e}();i.BackpackProcessor=e,__reflect(e.prototype,"game.BackpackProcessor");var t=function(e){function t(){return e.call(this,"bag.GetPlayerItemR",t)||this}return __extends(t,e),t.prototype.execute=function(e){this.checkCB(e.getBody())&&(Utils.DebugUtils.dumpPbMsg(e.getBody()),i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N).updateItemInfo(e.getBody().items))},t}(i.ProcessorBase);i.GetPlayerItemR=t,__reflect(t.prototype,"game.GetPlayerItemR");var n=function(e){function t(){return e.call(this,"bag.ExpandEquipBagR",t)||this}return __extends(t,e),t.prototype.execute=function(e){this.checkCB(e.getBody())},t}(i.ProcessorBase);i.ExpandEquipBagR=n,__reflect(n.prototype,"game.ExpandEquipBagR");var o=function(e){function t(){return e.call(this,"bag.UsePropR",t)||this}return __extends(t,e),t.prototype.execute=function(e){this.checkCB(e.getBody())},t}(i.ProcessorBase);i.UsePropR=o,__reflect(o.prototype,"game.UsePropR");var a=function(e){function t(){return e.call(this,"bag.SellEquipR",t)||this}return __extends(t,e),t.prototype.execute=function(e){this.checkCB(e.getBody())},t}(i.ProcessorBase);i.SellEquipR=a,__reflect(a.prototype,"game.SellEquipR");var r=function(e){function t(){return e.call(this,"bag.SellAllEquipR",t)||this}return __extends(t,e),t.prototype.execute=function(e){this.checkCB(e.getBody())},t}(i.ProcessorBase);i.SellAllEquipR=r,__reflect(r.prototype,"game.SellAllEquipR");var s=function(e){function t(){return e.call(this,"bag.SetEquipAutoSellR",t)||this}return __extends(t,e),t.prototype.execute=function(e){this.checkCB(e.getBody())},t}(i.ProcessorBase);i.SetEquipAutoSellR=s,__reflect(s.prototype,"game.SetEquipAutoSellR");var c=function(e){function t(){return e.call(this,"bag.SellEquipsR",t)||this}return __extends(t,e),t.prototype.execute=function(e){this.checkCB(e.getBody())},t}(i.ProcessorBase);i.SellEquipsR=c,__reflect(c.prototype,"game.SellEquipsR");var l=function(e){function t(){return e.call(this,"team.TeamInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N).updateModuleTeam(t.moduleTeam)},t}(i.ProcessorBase);i.TeamInfoP=l,__reflect(l.prototype,"game.TeamInfoP")}(game||(game={})),function(m){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e._moduleTeam={},e.heroUuid2ModuleTeamCache={},e.maxSizes=0,e.AllItemInfo={},e.playerInfo=m.AppFacade.getInstance().retrieveProxy(m.PlayerPy.N),e.heroPy=m.AppFacade.getInstance().retrieveProxy(m.HeroPy.N),e.heroThingPy=m.AppFacade.getInstance().retrieveProxy(m.HeroThingPy.N),e.MagicalPy=m.AppFacade.getInstance().retrieveProxy(m.MagicalArtifactPy.N),e.petPy=m.AppFacade.getInstance().retrieveProxy(m.PetPy.N),e.guajiPy=m.AppFacade.getInstance().retrieveProxy(m.GuajiPy.N),NoticeManager.registerCB(NT.BACKPACK_CHIP,e.checkChipNotice,e),NoticeManager.registerCB(NT.SMITHY,e.checkSmithyNotice,e,MODULE.Smithy),NoticeManager.setChildType(NT.SMITHY_ENTRANCE,NT.SMITHY),e}return __extends(i,t),i.prototype.checkChipNotice=function(e){for(var t in this.AllItemInfo){this.AllItemInfo[t];var i=m.Config.itemConfig()[t];if(i&&i.type==EPropType.EPropTypeChip&&(!e||e==Number(t))&&this.getItemNumByCode(t)>=i.effectEx)return!0}return!1},i.prototype.checkSmithyNotice=function(){var e=JSON.parse(m.Config.constConfig().SmithyForgeIronCosts.constValue);return!!this.checkEnough(e,!1)},i.prototype.Decompose=function(t,e){var i=this;void 0===e&&(e=!0);var n={heroUuids:[],equipUuids:[],artifactUuids:[],type:t.type};if(t.chosenItem.forEach(function(e){switch(t.type){case EEntityType.EEntityTypeHero:n.heroUuids.push({heroUuid:e.uuid,num:1});break;case EEntityType.EEntityTypeHeroArtifact:n.artifactUuids.push({artifactUuid:e.uuid,num:e.num||1});break;case EEntityType.EEntityTypeHeroEquip:n.equipUuids.push({equipUuid:e.uuid,num:e.num||1})}}),e){var o=[];n.heroUuids.forEach(function(e){o.push(e.heroUuid)});var a=m.GameMVC.backpackPy.checkMultiTeamTips(o);a?m.GameMgr.getInstance().showCommonTipsWin({commonTips:"选中的英雄中"+a.name+"在"+a.teamModuleName+"上阵，是否作为材料消耗？",clickCB:function(e){1==e.type&&i.Decompose(t,!1)}}):this.Decompose(t,!1)}else t.preview?Utils.Socket.send("decompose","DecomposePreview",n).then(function(e){i.log("分解预览 DecomposePreviewR",e),t.cb&&t.cb(),m.AppFacade.getInstance().showSubView(m.CommonMediator.N,m.CommonMediator.SV.REWARD_PANEL,{title:"奖励",rewards:e.rewardPreview,btnText:"确定",type:m.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})}):Utils.Socket.send("decompose","Decompose",n).then(function(e){i.log("分解 DecomposeR",e),i.DecomposeInfo=e.info,t.cb&&t.cb(e),t.noShowReward||i.handleClientReward(e.clientReward,{title:"分解奖励",btnText:"领取",onCloseCB:function(){Utils.MsgUtils.addMidMsg("领取成功")}})})},i.prototype.GetDecomposeInfo=function(){var t=this;Utils.Socket.send("decompose","GetDecomposeInfo",{}).then(function(e){t.DecomposeInfo=e.info})},i.prototype.GetDecomposeRewards=function(e,t){var i=this;Utils.Socket.send("decompose","GetDecomposeRewards",{type:e}).then(function(e){i.DecomposeInfo=e.info,i.handleClientReward(e.clientReward),t&&t()})},i.prototype.getDecomposeProcess=function(e){if(!this.DecomposeInfo||!this.DecomposeInfo.coreInfo)return 0;for(var t in this.DecomposeInfo.coreInfo){var i=this.DecomposeInfo.coreInfo[t];if(i.type==e)return i.num}return 0},i.prototype.switchLock=function(t){Utils.Socket.send("lock",t.lock?"Lock":"Unlock",{type:t.type,uuid:t.uuid}).then(function(e){Utils.MsgUtils.addMidMsg(t.lock?"上锁成功":"解锁成功"),e.hero&&m.GameMVC.heroPy.updateHeroDict(e.hero),e.heroEquip&&m.GameMVC.heroThingPy.updateEquipInfo([e.heroEquip],!1),e.heroArtifact&&m.GameMVC.heroThingPy.updateArtifactInfo([e.heroArtifact]),t.cb&&t.cb(e)})},i.prototype.updateItemInfo=function(e){this.AllItemInfo={};for(var t=0,i=e;t<i.length;t++){var n=i[t];this.AllItemInfo[n.code]||(this.AllItemInfo[n.code]={}),this.AllItemInfo[n.code][n.expiredDt||0]={num:n.num,dt:n.dt}}m.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE)},i.prototype.getItemByType=function(e){var t=[];for(var i in this.AllItemInfo){var n=m.Config.itemConfig()[i];n&&n.type==e&&t.push({c:n,num:this.getItemNumByCode(i)})}return t.sort(function(e,t){return e.c.color!=t.c.color?t.c.color-e.c.color:e.c.code-t.c.code}),t},i.prototype.getHeroAritfactInfoByCode=function(e,t){var i=m.GameMVC.heroThingPy.AllArtiInfo,n=0,o=this.heroThingPy;for(var a in i){var r=i[a];r.code!=e||!o.isArtifactNewOne(r.uuid)||r.heroUuid||void 0!==t&&r.isLocked!==t||(n+=r.num)}return n},i.prototype.checkEnough=function(e,t){void 0===t&&(t=!1);var i=!1;0==e.length&&(i=!0);for(var n=0,o=e;n<o.length;n++){var a=o[n],r=a.type||a[0],s=a.code||a[1],c=a.num||a[2],l=void 0;switch(null!=r?l=r:(l=Math.floor(Number(s)/1e7))||(l=EEntityType.EEntityTypeMoney),l){case EEntityType.EEntityTypeMoney:i=c<=this.updateMoneyNum(s);break;case EEntityType.EEntityTypeExp:i=c<=this.updateExpNum(s);break;case EEntityType.EEntityTypeItem:i=c<=this.getItemNumByCode(s);break;case EEntityType.EEntityTypeHero:for(var h in this.heroPy.allHeroByUuid){if(this.heroPy.allHeroByUuid[h].config.code==s){i=!0;break}}break;case EEntityType.EEntityTypeHeroEquip:break;case EEntityType.EEntityTypeHeroArtifactCode:case EEntityType.EEntityTypeHeroArtifact:i=c<=this.getHeroAritfactInfoByCode(s,!1);break;case EEntityType.EEntityTypePet:break;case EEntityType.EEntityTypeVestageItem:i=c<=(m.GameMVC.dungeonPy.itemInfo[s]||0)}if(!i){if(t)if(r==EEntityType.EEntityTypeMoney&&s==EPropertyType.EPropertyTypeDiamond)Utils.MsgUtils.addMidMsg("钻石不足"),m.GameMgr.getInstance().showCommonTipsWin({commonTips:"很遗憾，您的钻石不足，购买失败",cb:!1,btnLabel:{cancel:"取消",sure:"前往充值"},clickCB:function(e){0===e.type||1===e.type&&m.MainJumpConfig.jumpTo(MODULE.VIP)}});else{var p=m.GeneralConfig.getEntityConfigByCode(r,s);Utils.MsgUtils.addMidMsg(p.name+"不足"),PopUpManager.addPopUp({obj:new m.BaseItemDetailView({code:s,config:{type:r},showAccessNow:!1})})}break}}return i},i.prototype.updateMoneyNum=function(e,t){void 0===t&&(t=0);var i,n=m.AppFacade.getInstance().retrieveProxy(m.PlayerPy.N);return i=this.playerInfo.playerInfoVO.playerMoney[e]+t,n.playerInfoVO.playerMoney[e]=i,0!=t&&m.AppFacade.getInstance().sendNotification(CN.MONEY_UPDATE),i},i.prototype.updateExpNum=function(e,t){void 0===t&&(t=0);var i=0;if(e==EExpType.EExpTypePlayer)i=(n=m.AppFacade.getInstance().retrieveProxy(m.PlayerPy.N)).playerInfoVO.exp+t,n.playerInfoVO.exp=i;else if(e==EExpType.EExpTypeVip){var n;i=(n=m.AppFacade.getInstance().retrieveProxy(m.PlayerPy.N)).playerInfoVO.playerVip.exp+t,n.playerInfoVO.playerVip.exp=i}else EExpType.EExpTypeGuild;return i},i.prototype.getItemNumByCode=function(e){var t=0;if(this.AllItemInfo[e])for(var i in this.AllItemInfo[e]){t+=this.AllItemInfo[e][i].num}return t},i.prototype.getInfoByCode=function(e,t){var i=Math.floor(Number(e)/1e7);return i||(i=EEntityType.EEntityTypeMoney),this.getInfoByTypeCodeNum(i,e,t)},i.prototype.getInfoByTypeCodeNum=function(e,t,i){var n={};switch(e==EEntityType.EEntityTypeHeroArtifactCode&&(e=EEntityType.EEntityTypeHeroArtifact),n.info=m.GeneralConfig.getEntityConfigByCode(e,t),n.haveNum=0,n.voData=void 0,e){case EEntityType.EEntityTypeMoney:n.haveNum=this.updateMoneyNum(t);break;case EEntityType.EEntityTypeExp:n.haveNum=this.updateExpNum(t);break;case EEntityType.EEntityTypeItem:n.haveNum=this.getItemNumByCode(t);break;case EEntityType.EEntityTypeHeroArtifact:n.haveNum=this.getHeroAritfactInfoByCode(t,i);break;case EEntityType.EEntityTypeVestageItem:n.haveNum=m.GameMVC.dungeonPy.itemInfo[t]||0}return n},i.prototype.handleClientReward=function(e,t){if(e){for(var i=e,n=[],o=0,a=i.rewards;o<a.length;o++){var r=a[o];2==r.type&&5==r.code||n.push(r)}i.rewards=n;var s=!1;for(var c in i){var l=i[c];if(l&&"object"==typeof l&&0<l.length){s=!0;break}}if(s){var h={rewards:i};for(var p in t)h[p]=t[p];if(m.AppFacade.getInstance().showSubView(m.CommonMediator.N,m.CommonMediator.SV.REWARD_PANEL,h),e&&e.rewards)for(var p in e.rewards){switch(e.rewards[p].type){case EEntityType.EEntityTypeMoney:case EEntityType.EEntityTypeItem:this.sendNotification(CN.MONEY_UPDATE),this.sendNotification(CN.PLAYER_INFO_UPDATE)}}}}},i.prototype.handleClientRewardCore=function(e,t,i){if(e){m.AppFacade.getInstance().retrieveProxy(m.PlayerPy.N);var n={};for(var o in e.rewards){var a=e.rewards[o];switch(n[a.type]||(n[a.type]=!0),a.type){case EEntityType.EEntityTypeMoney:this.updateMoneyNum(a.code,a.num),this.sendNotification(CN.PLAYER_INFO_UPDATE);break;case EEntityType.EEntityTypeExp:this.updateExpNum(a.code,a.num),this.sendNotification(CN.PLAYER_INFO_UPDATE);break;case EEntityType.EEntityTypeItem:Array.isArray(n[a.type])||(n[a.type]=[]),n[a.type].push(a.code),this.AllItemInfo[a.code]?(this.AllItemInfo[a.code][a.expiredDt||0]||(this.AllItemInfo[a.code][a.expiredDt||0]={num:0,dt:a.dt}),this.AllItemInfo[a.code][a.expiredDt||0].num+=a.num):this.AllItemInfo[a.code]=((f={})[a.expiredDt||0]={num:a.num,dt:a.dt},f);break;case EEntityType.EEntityTypeVestageItem:var r=m.GameMVC.dungeonPy.itemInfo;r[a.code]?r[a.code]+=a.num:r[a.code]=a.num}}var s=e.heros;s&&0<s.length&&(n[EEntityType.EEntityTypeHero]=!0,this.heroPy.updateHeroDict(s));var c=e.heroEquips;if(c&&0<c.length){n[EEntityType.EEntityTypeHeroEquip]=!0;var l=this.heroThingPy.getEquipDifference(c);this.heroThingPy.updateEquipInfo(c,!1),e.heroEquips=l}var h=e.heroArtifacts;if(h&&0<h.length){n[EEntityType.EEntityTypeHeroArtifact]=!0;l=this.heroThingPy.getArtiDifference(h);this.heroThingPy.updateArtifactInfo(h,!1),e.heroArtifacts=l}var p=e.magicals;p&&0<p.length&&(n[EEntityType.EEntityTypeMagical]=!0,this.MagicalPy.updateMagicalDict(p));var d=e.pets;d&&0<d.length&&(n[EEntityType.EEntityTypePet]=!0,this.petPy.updatePetDict(d));var u=e.treasures;u&&0<u.length&&(n[EEntityType.EEntityTypeTreasure]=!0,this.heroThingPy.updateTreasureInfo(u,!1));var g=e.maps;g&&0<g.length&&(n[EEntityType.EEntityTypeMap]=!0,this.guajiPy.updateMapInfo(g));var f,_=e.vestageHeros;_&&0<_.length&&(n[EEntityType.EEntityTypeVestageHero]=!0,m.GameMVC.dungeonPy.updateHeroListInfo(_)),NoticeManager.localResUpdate(n),m.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE)}},i.prototype.handleClientCost=function(e){},i.prototype.handleClientCostCore=function(e){if(e){var t={};for(var i in e.costs){var n=e.costs[i];switch(t[n.type]||(t[n.type]=!0),n.type){case EEntityType.EEntityTypeMoney:this.updateMoneyNum(n.code,-n.num),this.sendNotification(CN.PLAYER_INFO_UPDATE);break;case EEntityType.EEntityTypeExp:this.updateExpNum(n.code,-n.num),this.sendNotification(CN.PLAYER_INFO_UPDATE);break;case EEntityType.EEntityTypeItem:Array.isArray(t[n.type])||(t[n.type]=[]),t[n.type].push(n.code),this.AllItemInfo[n.code][n.expiredDt||0].num-=n.num,this.getItemNumByCode(n.code)?this.AllItemInfo[n.code][n.expiredDt||0].num<=0&&delete this.AllItemInfo[n.code][n.expiredDt||0]:delete this.AllItemInfo[n.code];break;case EEntityType.EEntityTypeVestageItem:var o=m.GameMVC.dungeonPy.itemInfo;o[n.code]&&(o[n.code]-=n.num)}}var a=e.heroUuids;a&&0<a.length&&(t[EEntityType.EEntityTypeHero]=!0,this.heroPy.deteleByUuids(a));var r=e.heroEquips;r&&0<r.length&&(t[EEntityType.EEntityTypeHeroEquip]=!0,this.heroThingPy.deleteEquipInfo(r));var s=e.heroArtifacts;s&&0<s.length&&(t[EEntityType.EEntityTypeHeroArtifact]=!0,this.heroThingPy.deleteArtifactInfo(s));var c=e.magicals;c&&0<c.length&&(t[EEntityType.EEntityTypeMagical]=!0,this.MagicalPy.updateMagicalDict(c));var l=e.treasures;l&&0<l.length&&(t[EEntityType.EEntityTypeTreasure]=!0,this.heroThingPy.updateTreasureInfo(l));var h=e.vestageHeroUuids;h&&0<h.length&&(t[EEntityType.EEntityTypeVestageHero]=!0,m.GameMVC.dungeonPy.deleteHeroByUuids(h)),NoticeManager.localResUpdate(t),m.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE)}},i.prototype.getInfoByUuidAndType=function(e,t){switch(t){case EEntityType.EEntityTypeHero:return this.heroPy.allHeroByUuid[e];case EEntityType.EEntityTypeHeroEquip:return this.heroThingPy.AllEquipInfo[e];case EEntityType.EEntityTypeHeroArtifact:return this.heroThingPy.AllArtiInfo[e];case EEntityType.EEntityTypeTreasure:return this.heroThingPy.AllTreasureInfo[e];default:return}},i.prototype.UseProp=function(e,t,i,n,o,a){var r=this;void 0===n&&(n=!0),void 0===o&&(o=""),Utils.Socket.send("bag","UseProp",{code:e,num:t,id:i,ext:o}).then(function(e){n&&r.handleClientReward(e.clientReward),a&&a()})},i.prototype.GetPlayerItem=function(){var t=this;Utils.Socket.send("bag","GetPlayerItem",{}).then(function(e){t.updateItemInfo(e.items)})},i.prototype.compound=function(t){var i=this;Utils.Socket.send("bag","Compound",{code:t.code,num:t.num}).then(function(e){i.log("合成 CompoundR",e),t.cb&&t.cb(),m.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE),i.handleClientReward(e.clientReward,{type:m.CommonRewardPreviewPanel.REWARD_TYPE.REWARD,action:"Compound"})})},i.prototype.SellProp=function(e,t){Utils.Socket.send("bag","SellProp",{code:e.code,num:e.num}).then(function(e){(t&&t(),e.clientReward)&&m.AppFacade.getInstance().retrieveProxy(i.N).handleClientReward(e.clientReward,2)})},i.prototype.resetHeroUuid2ModuleTeamCache=function(){this.heroUuid2ModuleTeamCache={}},i.prototype.checkMultiTeamTips=function(e){var t=void 0;if(Array.isArray(e))for(var i=0,n=e;i<n.length;i++){var o,a=n[i];if(o=this.checkHeroInTeam(a)){t={name:this.heroPy.allHeroByUuid[a].config.name,teamModuleName:MULTI_TEAM_MODULE_NAME[o]||"玩法"};break}}else(o=this.checkHeroInTeam(e))&&(t={name:this.heroPy.allHeroByUuid[e].config.name,teamModuleName:MULTI_TEAM_MODULE_NAME[o]||"玩法"});return t},i.prototype.checkHeroInTeam=function(e,t){if(null!=this.heroUuid2ModuleTeamCache[e])return this.heroUuid2ModuleTeamCache[e];var i=void 0;if(!this.heroPy.heroUuid22Pos[e]){if(t&&this.getModuleTeam(t))e:for(var n=0,o=this.getModuleTeam(t).teams;n<o.length;n++)for(var a=0,r=o[n].heros;a<r.length;a++){if(e==r[a].uuid){i=t;break e}}else e:for(var s in this._moduleTeam)for(var c=0,l=this._moduleTeam[s].teams;c<l.length;c++)for(var h=0,p=l[c].heros;h<p.length;h++){if(e==p[h].uuid){i=s;break e}}return this.heroUuid2ModuleTeamCache[e]=i}},i.prototype.getModuleTeam=function(e){return this._moduleTeam[e]?this._moduleTeam[e]:void 0},i.prototype.updateModuleTeam=function(e){var t=this;Array.isArray(e)?(this._moduleTeam={},e.forEach(function(e){t._moduleTeam[e.type]=e})):this._moduleTeam[e.type]=e,this.sendNotification(CN.BACKPACK_MULTI_TEAM_UPDATE)},i.prototype.GetTeamInfo=function(e,t){var i=this;e||(e=0),Utils.Socket.send("team","GetTeamInfo",{type:e}).then(function(e){i.updateModuleTeam(e.moduleTeams),t&&t()})},i.prototype.ChangeFormation=function(e,t){var i=this;Utils.Socket.send("team","ChangeFormation",{moduleTeams:e}).then(function(e){i.updateModuleTeam(e.moduleTeams),t&&t()})},i.N="BackpackProxy",i}(BaseProxy);m.BackpackPy=e,__reflect(e.prototype,"game.BackpackPy")}(game||(game={})),function(c){var e=function(i){function e(e){var t,s=i.call(this)||this;return s.backpackProxy=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N),s.heroPy=c.AppFacade.getInstance().retrieveProxy(c.HeroPy.N),s.ITEM_TYPE_CONFIG=((t={})[c.BackpackUI.ITEM_TYPE.HERO_SPRITE]={desc:"英魂",barSource:{up:"_btn_yq_m_json.beibao_yeqian_suipian_0",down:"_btn_yq_m_json.beibao_yeqian_suipian_1"},getAllInfo:function(){var e=[],t=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).AllItemInfo,i=c.Config.itemConfig(),n=[EPropType.EPropTypeHeroSpirit];for(var o in t){var a=i[o];if(a&&-1!=n.indexOf(a.type))for(var r=s.backpackProxy.getItemNumByCode(o);r--;)e.push({code:Number(o),num:1,race:a.race,color:a.color})}return e},sortConfig:{defaultSortFunc:function(e,t){var i=e.info,n=t.info;return i.color!=n.color?n.color-i.color:i.race!=n.race?n.race-i.race:i.code!=n.code?n.code-i.code:void 0}},filterConfig:{data:[{race:HeroRaceType.Human,icon:"_hero_ar_m_json.common_icon_zhongzu_1",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Orc,icon:"_hero_ar_m_json.common_icon_zhongzu_2",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Elf,icon:"_hero_ar_m_json.common_icon_zhongzu_4",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Athanasy,icon:"_hero_ar_m_json.common_icon_zhongzu_3",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Demon,icon:"_hero_ar_m_json.common_icon_zhongzu_5",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Eldar,icon:"_hero_ar_m_json.common_icon_zhongzu_6",chosenImg:"common_icon_xuanzhongyuan_png"}],filterFunc:function(e,t){return!e||e.race==t.race}}},t),s.skinName="BackpackPanelSkin",s.params=e,s}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initTabbar(),this.initList(),this.activateComponent(),this.initialized=!1,this.tabbar_type.visible=!1,this.gp_content.scaleX=this.gp_content.scaleY=1,this.updateView({type:this.params.type})},e.prototype.initList=function(){this.list_item.itemRenderer=c.BackpackUI_Item,this.ac_item=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_item,this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListItemTap,this),this.list_filter.itemRenderer=c.BackpackUI_FilterItem,this.list_filter.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onFilterListItemTap,this)},e.prototype.initTabbar=function(){var e=[];for(var t in this.ITEM_TYPE_CONFIG){var i=this.ITEM_TYPE_CONFIG[t];e.push({source:i.barSource})}this.tabbar_type.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar_type.dataProvider=new eui.ArrayCollection(e),this.tabbar_type.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this),this.tabbar_sort_item.itemRendererSkinName="BackPackUI_SortItem",this.tabbar_sort_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSorterItemTap,this)},e.prototype.onBarItemTap=function(e){e.itemIndex!=this.curType&&(this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0,Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.updateView({type:e.itemIndex}))},e.prototype.onFilterListItemTap=function(e){this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0,this.curFilter&&this.curFilter==e.item.data?this.curFilter=void 0:this.curFilter=e.item.data;var t=this.list_filter.dataProvider;for(var i in t.source){var n=t.source[i];n==e.item?n.chosen=!n.chosen:n.chosen=!1}t.refresh(),this.updateList(!1)},e.prototype.onSorterItemTap=function(e){this.updateList(!0)},e.prototype.onListItemTap=function(e){var t=e.item.type,i=e.item.info;switch(t){case c.BackpackUI.ITEM_TYPE.HERO:c.AppFacade.getInstance().showSubView(c.HeroMediator.N,c.HeroMediator.SV.HERO_QUICK_TRAIN,{uuid:i.uuid});break;case c.BackpackUI.ITEM_TYPE.ITEM:case c.BackpackUI.ITEM_TYPE.EQUIP:case c.BackpackUI.ITEM_TYPE.CHIP:case c.BackpackUI.ITEM_TYPE.ARTIFACT:case c.BackpackUI.ITEM_TYPE.TREASURE:}},e.prototype.updateView=function(e){var t=e&&null!=e.type&&e.type!=this.curType;e&&null!=e.type&&(this.curType=e.type),this.targetConfig=this.ITEM_TYPE_CONFIG[this.curType],!t&&this.initialized||(this.initialized=!0,this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0,this.resetFilterAndSorter()),this.updateList(!0),this.updateNotice()},e.prototype.updateList=function(e){var t=[],i=this.targetConfig.filterConfig&&this.targetConfig.filterConfig.filterFunc||function(){return!0},n=this.targetConfig.sortConfig&&(this.targetConfig.sortConfig.defaultSortFunc||this.targetConfig.sortConfig.getSortFunc(this.tabbar_sort_item.selectedIndex)),o=this.targetConfig.getAllInfo();if(o)for(var a in o){var r=o[a];i(this.curFilter,r)&&t.push({type:this.curType,info:r,view:this})}0<t.length?(this.gp_empty.visible=!1,n&&t.sort(n)):(this.gp_empty.visible=!0,this.lb_empty_tips.text="还没有"+this.targetConfig.desc),this._listChildrenNum=0,this.list_item.$children.forEach(function(e){e.eventDispatched=!1}),this.ac_item.replaceAll(t),this.list_item.layout.verticalGap=this.curType===c.BackpackUI.ITEM_TYPE.CHIP?5:-15;var s=c.Config.constConfig().HeroBagMaxSize.constValue;e&&(this.bm_capacity.text="容量 "+o.length+"/"+s)},e.prototype.resetFilterAndSorter=function(){if(this.targetConfig.filterConfig){this.list_filter.visible=!0,this.curFilter=void 0;var e,t=[];if("英魂"==this.targetConfig.desc)(e=new eui.HorizontalLayout).horizontalAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE,e.gap=17,this.list_filter.layout=e,this.targetConfig.filterConfig.data.forEach(function(e){t.push({data:e,chosen:!1,isHero:!0})}),this.list_filter.horizontalCenter=0;else(e=new eui.HorizontalLayout).horizontalAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE,e.gap=15,this.list_filter.layout=e,this.targetConfig.filterConfig.data.forEach(function(e){t.push({data:e,chosen:!1,isHero:!1})}),this.list_filter.horizontalCenter=0;this.list_filter.dataProvider=new eui.ArrayCollection(t)}else this.list_filter.visible=!1;this.targetConfig.hasHankBook?(this.btn_handbook.visible=!0,this.btn_handbook.width=67):(this.btn_handbook.width=0,this.btn_handbook.visible=!1),this.gp_sort.visible=!1,this.blb_title.text=this.targetConfig.desc},e.prototype.activateComponent=function(){var e=this;this.btn_showSort.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_sort_pop.visible=!this.gp_sort_pop.visible},this),this.addEventListener(c.BackpackUI.EVENT_ITEM_CREATED,function(){e._listChildrenNum+=1,e._listChildrenNum==e.list_item.dataProvider.length&&e.dispatchEventWith(c.BackpackUI.EVENT_ALL_ITEM_CREATED)},this),this.addEventListener(c.BackpackUI.EVENT_ALL_ITEM_CREATED,function(){c.AppFacade.getInstance().sendNotification(CN.GUIDE_CHECK_CUR_STEP)},this)},e}(BaseTab);c.BackpackPanel=e,__reflect(e.prototype,"game.BackpackPanel")}(game||(game={})),function(p){var o=function(t){function l(){var e,c=t.call(this)||this;return c.backpackProxy=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N),c.heroPy=p.AppFacade.getInstance().retrieveProxy(p.HeroPy.N),c.ITEM_TYPE_CONFIG=((e={})[l.ITEM_TYPE.HERO]={desc:"英雄",hasHankBook:!0,barSource:{up:"_btn_yq_m_json.beibao_yeqian_yingxiong_0",down:"_btn_yq_m_json.beibao_yeqian_yingxiong_1"},getAllInfo:function(){var e=[],t=p.AppFacade.getInstance().retrieveProxy(p.HeroPy.N);for(var i in t.allHeroByUuid){var n=t.allHeroByUuid[i];n.pos||e.push(n)}return e},filterConfig:{data:[{race:HeroRaceType.Human,icon:"_hero_ar_m_json.common_icon_zhongzu_1",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Orc,icon:"_hero_ar_m_json.common_icon_zhongzu_2",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Elf,icon:"_hero_ar_m_json.common_icon_zhongzu_4",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Athanasy,icon:"_hero_ar_m_json.common_icon_zhongzu_3",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Demon,icon:"_hero_ar_m_json.common_icon_zhongzu_5",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Eldar,icon:"_hero_ar_m_json.common_icon_zhongzu_6",chosenImg:"common_icon_xuanzhongyuan_png"}],filterFunc:function(e,t){return!e||e.race==t.config.race}},sortConfig:{data:[{desc:"等级"},{desc:"星级"}],getSortFunc:function(e){switch(e){case 0:return function(e,t){return t.info.level-e.info.level};case 1:return function(e,t){return t.info.starLevel-e.info.starLevel};default:return function(){return-1}}},defaultSortFunc:function(e,t){var i=e.info,n=t.info;if(i.starLevel!=n.starLevel)return n.starLevel-i.starLevel;if(i.level!=n.level)return n.level-i.level;var o=p.Config.allHeroConfig()[i.code],a=p.Config.allHeroConfig()[n.code];return o.race!=a.race?o.race-a.race:o.profession!=a.profession?HERO_SORT_ORDER[a.profession]-HERO_SORT_ORDER[o.profession]:i.code-n.code}}},e[l.ITEM_TYPE.ITEM]={desc:"物品",barSource:{up:"_btn_yq_m_json.beibao_yeqian_daoju_0",down:"_btn_yq_m_json.beibao_yeqian_daoju_1"},getAllInfo:function(){var e=[],t=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N),i=p.AppFacade.getInstance().retrieveProxy(p.GuajiPy.N),n=t.AllItemInfo,o=p.Config.itemConfig(),a=[EPropType.EPropTypeChip,EPropType.EPropTypeHeroSpirit];for(var r in n)if(o[r]&&0!=o[r].showInPropWarehouse&&-1==a.indexOf(o[r].type)){var s=n[r];for(var c in s){var l=s[c];e.push({code:Number(r),num:l.num,expiredDt:Number(c)})}}for(var h in i.AllMapInfo)e.push({entityType:EEntityType.EEntityTypeMap,vo:i.AllMapInfo[h]});return e},filterConfig:{data:[{color:EColorType.EColorTypeWhite,icon:"beibao_btn_pinzhi_1_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeGreen,icon:"beibao_btn_pinzhi_2_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeBlue,icon:"beibao_btn_pinzhi_3_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypePurple,icon:"beibao_btn_pinzhi_4_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeOrange,icon:"beibao_btn_pinzhi_5_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeRed,icon:"beibao_btn_pinzhi_6_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"}],filterFunc:function(e,t){if(e){var i=p.Config.itemConfig()[t.code];return i&&e.color==i.color}return!0}},sortConfig:{defaultSortFunc:function(e,t){var i=e.info,n=t.info;if(!(i.entityType!=EEntityType.EEntityTypeMap||n.entityType&&n.entityType==EEntityType.EEntityTypeMap))return-1;if(!(i.entityType&&i.entityType==EEntityType.EEntityTypeMap||n.entityType!=EEntityType.EEntityTypeMap))return 1;if(i.entityType==EEntityType.EEntityTypeMap&&n.entityType==EEntityType.EEntityTypeMap)return i.vo.code-n.vo.code;var o=p.Config.itemConfig()[i.code],a=p.Config.itemConfig()[n.code];return o.type==EPropType.EPropTypeGem&&a.type!=EPropType.EPropTypeGem?-1:o.type!=EPropType.EPropTypeGem&&a.type==EPropType.EPropTypeGem?1:o.type==EPropType.EPropTypeGem&&a.type==EPropType.EPropTypeGem?n.num-i.num:a.color!=o.color?a.color-o.color:n.num-i.num}}},e[l.ITEM_TYPE.EQUIP]={desc:"装备",barSource:{up:"_btn_yq_m_json.beibao_yeqian_zhuangbei_0",down:"_btn_yq_m_json.beibao_yeqian_zhuangbei_1"},getAllInfo:function(){var e=[],t=p.AppFacade.getInstance().retrieveProxy(p.HeroThingPy.N);for(var i in t.AllEquipInfo){var n=t.AllEquipInfo[i];""==n.heroUuid&&e.push(n)}return e},filterConfig:{data:[{color:EColorType.EColorTypeGreen,icon:"beibao_btn_pinzhi_2_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeBlue,icon:"beibao_btn_pinzhi_3_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypePurple,icon:"beibao_btn_pinzhi_4_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeOrange,icon:"beibao_btn_pinzhi_5_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeRed,icon:"beibao_btn_pinzhi_6_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeLegend,icon:"beibao_btn_pinzhi_7_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"}],filterFunc:function(e,t){return!e||e.color==t.config.color}},sortConfig:{defaultSortFunc:function(e,t){var i=e.info,n=t.info,o=i.config.color,a=n.config.color;return o-a?a-o:n.level2!=i.level2?n.level2-i.level2:n.level!=i.level?n.level-i.level:n.num!=i.num?n.num-i.num:n.code!=i.code?n.code-i.code:void 0}}},e[l.ITEM_TYPE.CHIP]={desc:"碎片",barSource:{up:"_btn_yq_m_json.beibao_yeqian_suipian_0",down:"_btn_yq_m_json.beibao_yeqian_suipian_1"},getAllInfo:function(){var e=[],t=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N).AllItemInfo,i=p.Config.itemConfig(),n=[EPropType.EPropTypeChip];for(var o in t){var a=i[o];if(a&&-1!=n.indexOf(a.type)){var r=JSON.parse(a.effect)[0][1],s=p.Config.allHeroConfig()[r];e.push({code:Number(o),num:c.backpackProxy.getItemNumByCode(o),requestNum:a.effectEx,initStar:s&&s.initStar||0})}}return e},sortConfig:{defaultSortFunc:function(e,t){var i=e.info,n=t.info,o=i.num>=i.requestNum,a=n.num>=n.requestNum;return o!=a?a?1:-1:i.initStar!=n.initStar?n.initStar-i.initStar:i.num!=n.num?n.num-i.num:void 0}},filterConfig:{data:[{color:EColorType.EColorTypeWhite,icon:"beibao_btn_pinzhi_1_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeGreen,icon:"beibao_btn_pinzhi_2_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeBlue,icon:"beibao_btn_pinzhi_3_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypePurple,icon:"beibao_btn_pinzhi_4_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeOrange,icon:"beibao_btn_pinzhi_5_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeRed,icon:"beibao_btn_pinzhi_6_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"}],filterFunc:function(e,t){if(e){var i=p.Config.itemConfig()[t.code];return e.color==i.color}return!0}}},e[l.ITEM_TYPE.ARTIFACT]={desc:"圣物",hasHankBook:!0,barSource:{up:"_btn_yq_m_json.beibao_yeqian_shenqi_0",down:"_btn_yq_m_json.beibao_yeqian_shenqi_1"},getAllInfo:function(){var e=[],t=p.AppFacade.getInstance().retrieveProxy(p.HeroThingPy.N);for(var i in t.AllArtiInfo){var n=t.AllArtiInfo[i];""==n.heroUuid&&e.push(n)}return e},filterConfig:{data:[{color:EColorType.EColorTypeWhite,icon:"beibao_btn_pinzhi_1_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeGreen,icon:"beibao_btn_pinzhi_2_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeBlue,icon:"beibao_btn_pinzhi_3_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypePurple,icon:"beibao_btn_pinzhi_4_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeOrange,icon:"beibao_btn_pinzhi_5_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeRed,icon:"beibao_btn_pinzhi_6_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeLegend,icon:"beibao_btn_pinzhi_7_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"}],filterFunc:function(e,t){return!e||e.color==t.config.color}},sortConfig:{defaultSortFunc:function(e,t){var i=e.info,n=t.info;return i.config.color-n.config.color?n.config.color-i.config.color:i.config.sectionLevel-n.config.sectionLevel?n.config.sectionLevel-i.config.sectionLevel:n.level2!=i.level2?n.level2-i.level2:n.level!=i.level?n.level-i.level:n.num!=i.num?n.num-i.num:n.code!=i.code?n.code-i.code:void 0}}},e),c.skinName="BackpackUISkin",c.guideEffectWait=!0,c}return __extends(l,t),l.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.initTabbar(),this.initList(),this.activateComponent(),this.curType=l.ITEM_TYPE.HERO,this.initialized=!1,this.gp_content.scaleX=this.gp_content.scaleY=1,UIActionManager.playUIAction(this.gp_content,1,function(){e.setGuideAvailable()}),this.initNotice()},l.prototype.initNotice=function(){NoticeManager.addNoticeListener(NT.BACKPACK_CHIP,this.tabbar_type,this,{percentX:365/521.21,percentY:43/73})},l.prototype.initList=function(){this.list_item.itemRenderer=e,this.ac_item=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_item,this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListItemTap,this),this.list_filter.itemRenderer=i,this.list_filter.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onFilterListItemTap,this)},l.prototype.initTabbar=function(){var e=[];for(var t in this.ITEM_TYPE_CONFIG){var i=this.ITEM_TYPE_CONFIG[t];e.push({source:i.barSource})}this.tabbar_type.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar_type.dataProvider=new eui.ArrayCollection(e),this.tabbar_type.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this),this.tabbar_sort_item.itemRendererSkinName="BackPackUI_SortItem",this.tabbar_sort_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSorterItemTap,this)},l.prototype.onBarItemTap=function(e){e.itemIndex!=this.curType&&(this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0,Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.updateView({type:e.itemIndex}))},l.prototype.onFilterListItemTap=function(e){this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0,this.curFilter&&this.curFilter==e.item.data?this.curFilter=void 0:this.curFilter=e.item.data;var t=this.list_filter.dataProvider;for(var i in t.source){var n=t.source[i];n==e.item?n.chosen=!n.chosen:n.chosen=!1}t.refresh(),this.updateList(!1)},l.prototype.onSorterItemTap=function(e){this.updateList(!0)},l.prototype.onListItemTap=function(e){var t=e.item.type,i=e.item.info;switch(t){case l.ITEM_TYPE.HERO:p.AppFacade.getInstance().showSubView(p.HeroMediator.N,p.HeroMediator.SV.HERO_QUICK_TRAIN,{uuid:i.uuid});break;case l.ITEM_TYPE.ITEM:case l.ITEM_TYPE.EQUIP:case l.ITEM_TYPE.CHIP:case l.ITEM_TYPE.ARTIFACT:case l.ITEM_TYPE.TREASURE:}},l.prototype.updateView=function(e){var t=e&&null!=e.type&&e.type!=this.curType;e&&null!=e.type&&(this.curType=e.type),this.targetConfig=this.ITEM_TYPE_CONFIG[this.curType],!t&&this.initialized||(this.initialized=!0,this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0,this.resetFilterAndSorter()),this.updateList(!0),this.updateNotice()},l.prototype.updateList=function(e){var t=[],i=this.targetConfig.filterConfig&&this.targetConfig.filterConfig.filterFunc||function(){return!0},n=this.targetConfig.sortConfig&&(this.targetConfig.sortConfig.defaultSortFunc||this.targetConfig.sortConfig.getSortFunc(this.tabbar_sort_item.selectedIndex)),o=this.targetConfig.getAllInfo();if(o)for(var a in o){var r=o[a];i(this.curFilter,r)&&t.push({type:this.curType,info:r,view:this})}0<t.length?(this.gp_empty.visible=!1,n&&t.sort(n)):(this.gp_empty.visible=!0,this.lb_empty_tips.text="还没有"+this.targetConfig.desc),this._listChildrenNum=0,this.list_item.$children.forEach(function(e){e.eventDispatched=!1}),this.ac_item.replaceAll(t),this.list_item.layout.verticalGap=this.curType===l.ITEM_TYPE.CHIP?5:-15;var s=p.Config.constConfig().HeroBagMaxSize.constValue;e&&(this.bm_capacity.text="容量 "+o.length+"/"+s)},l.prototype.resetFilterAndSorter=function(){if(this.targetConfig.filterConfig){this.list_filter.visible=!0,this.curFilter=void 0;var t=[];if("英雄"==this.targetConfig.desc)(e=new eui.HorizontalLayout).horizontalAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE,e.gap=7,this.list_filter.layout=e,this.targetConfig.filterConfig.data.forEach(function(e){t.push({data:e,chosen:!1,isHero:!0})}),this.list_filter.horizontalCenter=-20;else if("圣物"==this.targetConfig.desc){(e=new eui.HorizontalLayout).horizontalAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE,e.gap=7,this.list_filter.layout=e,this.targetConfig.filterConfig.data.forEach(function(e){t.push({data:e,chosen:!1,isHero:!1})}),this.list_filter.horizontalCenter=-20}else{var e;(e=new eui.HorizontalLayout).horizontalAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE,e.gap=15,this.list_filter.layout=e,this.targetConfig.filterConfig.data.forEach(function(e){t.push({data:e,chosen:!1,isHero:!1})}),this.list_filter.horizontalCenter=0}this.list_filter.dataProvider=new eui.ArrayCollection(t)}else this.list_filter.visible=!1;this.targetConfig.hasHankBook?(this.btn_handbook.visible=!0,this.btn_handbook.width=67):(this.btn_handbook.width=0,this.btn_handbook.visible=!1),this.gp_sort.visible=!1,this.blb_title.text=this.targetConfig.desc},l.prototype.activateComponent=function(){var e=this;this.btn_showSort.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_sort_pop.visible=!this.gp_sort_pop.visible},this),this.btn_handbook.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.scroller.visible=!1,p.AppFacade.getInstance().showSubView(p.HandBookMediator.N,p.HandBookMediator.SV.MAIN,{type:e.curType,closeCB:function(){e.scroller.visible=!0}})},this),this.addEventListener(l.EVENT_ITEM_CREATED,function(){e._listChildrenNum+=1,e._listChildrenNum==e.list_item.dataProvider.length&&e.dispatchEventWith(l.EVENT_ALL_ITEM_CREATED)},this),this.addEventListener(l.EVENT_ALL_ITEM_CREATED,function(){p.AppFacade.getInstance().sendNotification(CN.GUIDE_CHECK_CUR_STEP)},this)},l.EVENT_ITEM_CREATED="EVENT_ITEM_CREATED",l.EVENT_ALL_ITEM_CREATED="EVENT_ALL_ITEM_CREATED",l.ITEM_TYPE={HERO:0,ITEM:1,EQUIP:2,CHIP:3,ARTIFACT:4,HERO_SPRITE:15,TREASURE:6},l}(BaseTab);p.BackpackUI=o,__reflect(o.prototype,"game.BackpackUI");var e=function(t){function e(){var e=t.call(this)||this;return e.eventDispatched=!1,e.backpackProxy=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N),e.skinName="BackpackUI_Item",e}return __extends(e,t),e.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.gp_bi.addChild(this.baseItem),this.pBar.slideDuration=0,this.pBar.labelFunction=function(e,t){return i.value+"/"+t}},e.prototype.dataChanged=function(e){(e&&(this.data=e),this.data.view&&!this.eventDispatched)&&(this.eventDispatched=!0,this.data.view.dispatchEventWith(o.EVENT_ITEM_CREATED));var t=this.data.info;switch(this.pBar.visible=!1,this.baseItem.blb_num.visible=!0,this.baseItem.touchEnabled=!0,this.data.type){case o.ITEM_TYPE.HERO:var i=void 0,n=!1;0==t.dermaCode?i=t.config.avatar:(i=p.Config.getHeroDermaConfig()[t.dermaCode].avatar,n=!0),this.baseItem.updateData({uuid:t.uuid,type:EEntityType.EEntityTypeHero,source:BASEITEM_SOURCE.BACKPACK,effect:!0,isShowZhongZhu:!0,avatar:i,isShowEffect:n}),this.baseItem.touchEnabled=!1;break;case o.ITEM_TYPE.CHIP:this.pBar.visible=!0,this.pBar.maximum=t.requestNum,this.pBar.value=this.value=t.num,this.pBar.labelDisplay.text=t.num+"/"+t.requestNum,this.baseItem.updateData({code:t.code,num:t.num,source:BASEITEM_SOURCE.BACKPACK}),this.baseItem.blb_num.visible=!1;break;case o.ITEM_TYPE.HERO_SPRITE:case o.ITEM_TYPE.ITEM:t.vo?this.baseItem.updateData({uuid:t.vo.uuid,vo:t.vo,type:t.vo.entityType,source:BASEITEM_SOURCE.BACKPACK}):this.baseItem.updateData({code:t.code,num:t.num,expiredDt:t.expiredDt,source:BASEITEM_SOURCE.BACKPACK});break;case o.ITEM_TYPE.ARTIFACT:case o.ITEM_TYPE.TREASURE:case o.ITEM_TYPE.EQUIP:this.baseItem.updateData({uuid:t.uuid,type:t.entityType,source:BASEITEM_SOURCE.BACKPACK})}},e}(eui.ItemRenderer);p.BackpackUI_Item=e,__reflect(e.prototype,"game.BackpackUI_Item");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="BackpackUI_FilterItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.data.isHero&&(this.width=80,this.scaleX=.9,this.scaleY=.9),this.chosen=this.data.chosen||!1,this.img_icon.source=this.data.data.icon,this.img_chosen.source=this.data.data.chosenImg,this.setChosen(this.chosen)},e.prototype.setChosen=function(e){this.chosen=e,this.img_chosen.visible=this.chosen},e}(eui.ItemRenderer);p.BackpackUI_FilterItem=i,__reflect(i.prototype,"game.BackpackUI_FilterItem")}(game||(game={})),function(n){var e=function(i){function e(e){var t=i.call(this)||this;return t.selectUuids=[],t.backpackPy=n.AppFacade.getInstance().retrieveProxy(n.BackpackPy.N),t.skinName="HeroUpstarSelectSkin",t.params=e,t.selectUuids=e.selectUuids||[],t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initList(),this.activateComponent(),this.updateView(this.params)},e.prototype.initList=function(){this.ac_list=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_list,this.list_item.itemRenderer=t,this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListItemTap,this)},e.prototype.onListItemTap=function(e){var t=e.item;if(t.info.isLocked)Utils.MsgUtils.addMidMsg("该"+ENTITY_2_NAME[t.info.entityType]+"已经被锁住");else if(this.params.singleChoose){for(var i in this.ac_list.source){var n=this.ac_list.source[i];n.chosen=n.uuid==t.uuid}this.ac_list.replaceAll(this.ac_list.source),this.selectUuids[0]=t.uuid}else{e.itemRenderer;if(0<=this.selectUuids.indexOf(t.uuid))t.chosen=!t.chosen,this.selectUuids.splice(this.selectUuids.indexOf(t.uuid),1),this.ac_list.replaceAll(this.ac_list.source);else this.params.checkFull&&this.params.checkFull(this.selectUuids)||!1?Utils.MsgUtils.addMidMsg(this.params.fullTip||"当前已选满"):(t.chosen=!0,this.selectUuids.push(t.uuid),this.ac_list.replaceAll(this.ac_list.source))}},e.prototype.updateView=function(e){var o=this,t=[],i=this.params.getInfos&&this.params.getInfos();this.lb_title.text=this.params.title,i||(i=[]);var n=this.params.excludeUuids||[];for(var a in i){var r=i[a];if(!(0<=n.indexOf(a))){var s=0<=this.selectUuids.indexOf(a);t.push({uuid:a,chosen:s,isOnlyCode:this.params.isOnlyCode||!1,info:r,type:this.params.type||EEntityType.EEntityTypeItem,uniNum:this.params.uniNum})}}t.length?(this.gp_empty.visible=!1,this.btn_confirm.visible=!0,this.params.sortFunc||(this.params.sortFunc=function(e,t){var i=e.info,n=t.info;return i.isLocked!=n.isLocked?i.isLocked?1:-1:o.backpackPy.checkHeroInTeam(i.uuid)&&!o.backpackPy.checkHeroInTeam(n.uuid)?1:!o.backpackPy.checkHeroInTeam(i.uuid)&&o.backpackPy.checkHeroInTeam(n.uuid)?-1:i.code!=n.code?i.code-n.code:i.level-n.level}),t.sort(function(e,t){return o.params.sortFunc(e,t)}),this.ac_list.replaceAll(t)):(this.gp_empty.visible=!0,this.btn_confirm.visible=!1)},e.prototype.activateComponent=function(){this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.opperationParams=this.selectUuids,this.hide()},this)},e.prototype.onDestroy=function(){this.params.noCloseAsConfirm||(this.opperationParams=this.selectUuids),i.prototype.onDestroy.call(this)},e}(BasePanel);n.CommonChosePanel=e,__reflect(e.prototype,"game.CommonChosePanel");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="CommonChosePanelItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_bi.addChild(this.baseItem)},e.prototype.dataChanged=function(){this.data.isOnlyCode?this.baseItem.updateData({code:this.data.info.code,type:this.data.info.type,num:this.data.info.num}):this.baseItem.updateData({uuid:this.data.info.uuid,type:this.data.type}),this.data.uniNum&&(this.baseItem.blb_num.text="1"),this.data.info.isLocked?this.gp_lock.visible=!0:this.gp_lock.visible=!1,this.updateChosen(this.data.chosen),UIActionManager.setGrey(this.gp_bi,this.data.chosen||this.data.info.isLocked)},e.prototype.updateChosen=function(e){this.data.chosen=e,this.gp_chosen.visible=e},e}(eui.ItemRenderer);__reflect(t.prototype,"CommonChosePanelItem")}(game||(game={})),function(n){var e=function(i){function e(e){var t=i.call(this)||this;return t.proxy=n.AppFacade.getInstance().retrieveProxy(n.BackpackPy.N),t.code=e.code,t.skinName="CompoundPanelSkin",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.item=new n.BackpackUI_Item,this.item.touchEnabled=!1,this.gp_item.addChild(this.item),this.targetNum=1,this.lb_num.visible=!1,this.edt_input.visible=!0,this.activateComponent(),this.updateView()},e.prototype.updateView=function(){var e=n.Config.itemConfig()[this.code];this.lb_name.text=e.name,this.requestNum=e.effectEx,this.num=this.proxy.getItemNumByCode(this.code),this.setTargetNum(Math.floor(this.num/this.requestNum)),this.item.baseItem.touchEnabled=!1},e.prototype.setTargetNum=function(e){e=e||1,this.targetNum=e,this.edt_input.text=e.toString();var t={type:n.BackpackUI.ITEM_TYPE.CHIP,info:{code:this.code,requestNum:this.num,num:this.targetNum*this.requestNum}};this.item.dataChanged(t)},e.prototype.activateComponent=function(){var t=this;this.btn_min.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setTargetNum(1)},this),this.btn_max.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=Math.floor(this.num/this.requestNum);this.setTargetNum(e)},this),this.btn_des.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setTargetNum(this.targetNum-1)},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){(this.targetNum+1)*this.requestNum<=this.num&&this.setTargetNum(this.targetNum+1)},this),this.btn_compound.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;this.num>=this.requestNum*this.targetNum?n.AppFacade.getInstance().retrieveProxy(n.BackpackPy.N).compound({code:this.code,num:this.targetNum,cb:function(){PopUpManager.removePopUp(e)}}):Utils.MsgUtils.addMidMsg("碎片不足")},this),this.edt_input.addEventListener(egret.Event.CHANGE,function(){var e=Math.floor(t.num/t.requestNum);t.targetNum=Number(t.edt_input.text),t.targetNum>e&&(t.targetNum=e,t.edt_input.text=e.toString(),Utils.MsgUtils.addMidMsg("超过最大合成数量！"))},this),this.edt_input.addEventListener(egret.Event.FOCUS_OUT,function(){if(!t.edt_input.text.match(/[1-9][0-9]*/gi)){Utils.MsgUtils.addMidMsg("请输入有效数值！");var e=Math.floor(t.num/t.requestNum);t.targetNum=e,t.edt_input.text=e.toString()}},this)},e}(BasePanel);n.CompoundPanel=e,__reflect(e.prototype,"game.CompoundPanel")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="CommonXiaoTanChuKuangSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onCloseCB&&e.onCloseCB()},this)},e}(eui.Component);e.CommonXiaoTanChuKuang=t,__reflect(t.prototype,"customui.CommonXiaoTanChuKuang",["eui.UIComponent","egret.DisplayObject"])}(customui||(customui={})),function(c){var e=function(t){function e(){var e=t.call(this)||this;return e.code=EActivityType.HeroRollback,e.heroPy=c.AppFacade.getInstance().retrieveProxy(c.HeroPy.N),e.skinName="HeroRollBackViewSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent(),DragonBoneTools.playOnce({effectName:"common_zhihuanqian",parent:this.gp_effect,y:this.gp_effect.height,loop:!0}),egret.Tween.get(this.img_add,{loop:!0}).to({alpha:.4},1e3).to({alpha:1},1e3)},e.prototype.updateView=function(e){if(this.curUuid){this.gp_name.visible=!0,this.btn_oper.enabled=!0,this.img_add.visible=!1;var t=this.heroPy.allHeroByUuid[this.curUuid];this.heroModel.update({code:t.code,isStatic:!0}),this.lb_name.text=t.config.name,this.img_raceIcon.source=HeroRaceConfig[t.config.race].raceIconBig;var i=t.starLevel,n=c.GeneralConfig.getHeroStarInfo(i);if(this.gp_stars.removeChildren(),n.stage<4)for(var o=0;o<n.num;o++){var a=new eui.Image(n.src);this.gp_stars.addChild(a),a.scaleX=a.scaleY=.5}else this.gp_stars.addChild(new customui.HighStarLevelIcon({num:n.num,scale:.5}));var r=c.Config.heroRollBackConfig(),s=JSON.parse(r[t.starLevel].costs);this.icon_cost.visible=!0,this.icon_cost.updateItem({cost:s[0],style:CommonIconStyle.RIGHT,needShowHave:!0})}else this.gp_name.visible=!1,this.icon_cost.visible=!1,this.btn_oper.enabled=!1,this.img_add.visible=!0,this.heroModel.update({})},e.prototype.activateComponent=function(){var t=this;this.cu_dtc.blb_title.text="英雄重生",this.cu_dtc.onCloseCB=function(){t.hide()},Utils.TouchUtils.addTouchListener(this.heroModel,function(){c.AppFacade.getInstance().showSubView(c.HeroMediator.N,c.HeroMediator.SV.SELECT,{type:c.HeroSelectPanel.SELECTFORM.HERO_ROLLBACK,btnFunc:function(e){t.curUuid=e,t.updateView(),DragonBoneTools.playOnce({effectName:"common_zhihuanfangru",parent:t.gp_effect,y:t.gp_effect.height})}})}),Utils.TouchUtils.addTouchListener(this.btn_oper,function(){c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.TIPS_DIALOG,{commonTips:"请确定是否重生该英雄，重生后可返还所有本体、培养资源以及若干9或10星通用升星材料。",clickCB:function(e){e.type&&t.heroPy.HeroRollback({uuid:t.curUuid,cb:function(e){DragonBoneTools.playOnce({effectName:"common_zhihuanchenggong",parent:t.gp_effect,y:t.gp_effect.height,doneCB:function(){t.curUuid=void 0,t.updateView(),e()}})}})}})}),Utils.TouchUtils.addTouchListener(this.btn_guide,function(){PopUpManager.addPopUp({obj:new c.HelpDialog({moduleId:MODULE.HeroRollback})})}),Utils.TouchUtils.addTouchListener(this.btn_preview,function(){t.curUuid?t.heroPy.HeroRollbackPreview({uuid:t.curUuid}):Utils.MsgUtils.addMidMsg("未选择英雄")})},e}(BasePanel);c.HeroRollBackView=e,__reflect(e.prototype,"game.HeroRollBackView")}(game||(game={})),function(n){var e=function(i){function e(e){var t=i.call(this)||this;return t.proxy=n.AppFacade.getInstance().retrieveProxy(n.BackpackPy.N),t.code=e.code,t.params=e,t.skinName="CompoundPanelSkin",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.item=new n.BackpackUI_Item,this.gp_item.addChild(this.item),this.targetNum=1,this.activateComponent(),this.updateView()},e.prototype.updateView=function(){var e=n.Config.itemConfig()[this.code];this.lb_name.text=e.name,this.requestNum=1,this.num=this.proxy.getItemNumByCode(this.code);var t={type:n.BackpackUI.ITEM_TYPE.ITEM,info:{code:this.code}};this.item.dataChanged(t),this.btn_compound.label=this.params&&this.params.btnText||"合成",this.setTargetNum(Math.floor(this.num/this.requestNum))},e.prototype.setTargetNum=function(e){e=e||1,this.targetNum=e,this.lb_num.text=e.toString()},e.prototype.activateComponent=function(){this.btn_min.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setTargetNum(1)},this),this.btn_max.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=Math.floor(this.num/this.requestNum);this.setTargetNum(e)},this),this.btn_des.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setTargetNum(this.targetNum-1)},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){(this.targetNum+1)*this.requestNum<=this.num&&this.setTargetNum(this.targetNum+1)},this),this.btn_compound.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(this.params.btnFunc)if(this.num>=this.requestNum*this.targetNum){n.AppFacade.getInstance().retrieveProxy(n.BackpackPy.N);this.params.btnFunc({num:this.targetNum}),this.hide()}else Utils.MsgUtils.addMidMsg("道具不足");else this.num>=this.requestNum*this.targetNum?(n.AppFacade.getInstance().retrieveProxy(n.BackpackPy.N).UseProp(this.code,this.targetNum),this.hide()):Utils.MsgUtils.addMidMsg("道具不足")},this)},e}(BasePanel);n.UsePropPanel=e,__reflect(e.prototype,"game.UsePropPanel")}(game||(game={})),function(s){var e=function(t){function r(e){return void 0===e&&(e=null),t.call(this,r.N,e)||this}return __extends(r,t),Object.defineProperty(r.prototype,"rootView",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),r.prototype.initSubView=function(){this.addSubView(r.SV.MAIN,s.ActivityBraveBookView),this.addSubView(r.SV.BAOXIANG,s.BuxiuBaoxiangView),this.addSubView(r.SV.BRAVEBOOKSHOP,s.BraveBookShopView),this.addSubView(r.SV.BRAVEBOOKREWARDS,s.BraveBookRewardsView),this.addSubView(r.SV.BRAVEBOOKTASKS,s.BravebookTasksView),this.addSubView(r.SV.GETWAYS,s.CommonGetWaysView)},r.prototype.listNotificationInterests=function(){return[CN.ACTIVITY_BRAVEBOOKSHOP,CN.HIDE_ALL_SUBVIEW,CN.BRAVEBOOK_LEVEL_UPDATE,CN.NEWBRAVEBOOK_LEVEL_UPDATE]},r.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.ACTIVITY_BRAVEBOOKSHOP:this.getSubView(r.SV.BRAVEBOOKSHOP)&&s.AppFacade.getInstance().hideSubView(r.N,r.SV.BRAVEBOOKSHOP,{unresetChapter:!0});break;case CN.HIDE_ALL_SUBVIEW:this.rootView&&s.AppFacade.getInstance().hideSubView(r.N,r.SV.MAIN);break;case CN.BRAVEBOOK_LEVEL_UPDATE:var i=s.AppFacade.getInstance().retrieveProxy(s.TaskPy.N);(n=t.data.level)!=t.preLevel&&Utils.MsgUtils.braveBookShengjiEffect();break;case CN.NEWBRAVEBOOK_LEVEL_UPDATE:if((i=s.AppFacade.getInstance().retrieveProxy(s.TaskPy.N)).NewBraveBooklevelParams){var n=i.NewBraveBooklevelParams.level,o=i.NewBraveBooklevelParams.preLevel,a=i.NewBraveBooklevelParams&&i.NewBraveBooklevelParams.isShow||!1;if(n!=o&&!a){Utils.MsgUtils.NewBraveBookShenjiEffect(o,n);GameRootLayer.gameLayer().getCurViewStack().mainLayer;i.NewBraveBooklevelParams.isShow=!0}}}},r.N="BraveBookMediator",r.SV={MAIN:1,BAOXIANG:2,BRAVEBOOKSHOP:3,BRAVEBOOKREWARDS:4,BRAVEBOOKTASKS:5,GETWAYS:6},r}(BaseMediator);s.BraveBookMediator=e,__reflect(e.prototype,"game.BraveBookMediator")}(game||(game={})),function(e){var t=function(){function e(){}return e.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.GuildHead",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},e}();e.GuildHeadFactory=t,__reflect(t.prototype,"customui.GuildHeadFactory");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildHeadSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.tapEvent?e.tapEvent():game.AppFacade.getInstance().showSubView(game.GuildMediator.N,game.GuildMediator.SV.INFO,e.vo)},this)},e.prototype.updateData=function(e){this.vo=e&&e.vo,this.vo?(this.img_icon.source=this.vo.avatar,this.lb_level.text=this.vo.level.toString()):(this.img_icon.source=e.icon,this.gp_level.visible=!0),this.tapEvent=e&&e.tapEvent},e.prototype.reset=function(){this.tapEvent=void 0,this.scaleX=this.scaleY=1,this.gp_level.visible=!0,this.img_icon.source="",this.horizontalCenter=this.verticalCenter=void 0},e.prototype.onOPReset=function(){this.reset()},e.prototype.onOPComeBack=function(e,t){e&&this.updateData(e)},e.prototype.onOPClean=function(){},e.prototype.onOPCheck=function(e){egret.log("alive")},e}(eui.Component);e.GuildHead=i,__reflect(i.prototype,"customui.GuildHead",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(customui||(customui={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.skinName="StrongUISkin",e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI(),this.initTabbar(),this.initList(),this.onBarItemTap({itemIndex:e.TAB_VIEW.GOLD})},e.prototype.initUI=function(){var e=this;UIActionManager.hideScrollerBar(this.scroller_item),this.commonDaTanKuang.blb_title.text="变强秘籍",this.commonDaTanKuang.onCloseCB=function(){e.hide()}},e.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar.dataProvider=new eui.ArrayCollection([{source:{up:"_btn_yq_m_json.common_yeqian_jinbi_0",down:"_btn_yq_m_json.common_yeqian_jinbi_1",text:"金币"}},{source:{up:"_btn_yq_m_json.common_yeqian_zuanshi_0",down:"_btn_yq_m_json.common_yeqian_zuanshi_1",text:"钻石"}},{source:{up:"_btn_yq_m_json.common_yeqian_ziyuan_0",down:"_btn_yq_m_json.common_yeqian_ziyuan_1",text:"资源"}},{source:{up:"_btn_yq_m_json.common_yeqian_zhanli_0",down:"_btn_yq_m_json.common_yeqian_zhanli_1",text:"战力"}}]),this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this)},e.prototype.initList=function(){this.list_item=new eui.List;var e=new eui.VerticalLayout;e.verticalAlign=egret.VerticalAlign.TOP,e.horizontalAlign=egret.HorizontalAlign.CENTER,e.gap=10,e.paddingTop=15,this.list_item.layout=e,this.gp_slItem.addChild(this.list_item),this.list_item.horizontalCenter=0,this.scroller_item.scrollPolicyH=eui.ScrollPolicy.OFF,this.list_item.itemRenderer=i},e.prototype.onBarItemTap=function(e){e&&null!=e.itemIndex&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex),this.scroller_item.viewport.scrollV=0;var t=a.Config.strongConfig(),i=[];for(var n in t){var o=t[n];o.subType==e.itemIndex+1&&i.push({bg:o.icon,lb_info:o.title,lb_content:o.desc,moduleId:o.moduleId,source:o.source})}this.list_item.dataProvider=new eui.ArrayCollection(i)},e.prototype.perClose=function(){},e.TAB_VIEW={GOLD:0,DIAMOND:1,RESOURCES:2,CMOBAT:3},e}(BasePanel);a.StrongUI=e,__reflect(e.prototype,"game.StrongUI");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="CommonItemRenderLongSkin",e.giftState=new Array,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.inintButton(),this.adapterComponent()},e.prototype.adapterComponent=function(){this.lb_content.visible=!0,this.gp_level.visible=!1,this.gp_content.visible=!1,this.img_icon.scaleX=this.img_icon.scaleY=1.2,this.btn_go.y=(this.gp_root.height-this.btn_go.height)/2},e.prototype.dataChanged=function(){this.img_icon.source=this.data.bg+"_png",this.lb_info.text=this.data.lb_info,this.lb_content.text=this.data.lb_content,this.updateItem(this.data.itemIndex)},e.prototype.inintButton=function(){this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(this.data.source){var e=JSON.parse(this.data.source);PopUpManager.addPopUp({obj:new a.BaseItemDetailView({code:e[1],type:e[0],showAccessNow:!0}),closeCB:function(e){e&&a.AppFacade.getInstance().hideSubView(a.StrongMediator.N,a.StrongMediator.SV.MAIN)}})}else a.MainJumpConfig.jumpTo(this.data.moduleId),a.AppFacade.getInstance().hideSubView(a.StrongMediator.N,a.StrongMediator.SV.MAIN)},this)},e.prototype.updateItem=function(e){this.data.serverData,Utils.TimerManager.getServerTime()},e}(eui.ItemRenderer);__reflect(i.prototype,"StrongItem")}(game||(game={})),function(a){var e=function(o){function e(){var e,t=o.call(this)||this;return t.newTipCount=0,t.curPrivateId=0,t.curSelectPrivateIndex=0,t.Channel_2_Index=((e={})[EChatChannelType.EChatChannelTypeZone]=0,e[EChatChannelType.SameServer]=1,e[EChatChannelType.EChatChannelTypeGuild]=2,e[EChatChannelType.EChatChannelTypePrivate]=3,e),t.isFirst=!0,t.mainProxy=a.AppFacade.getInstance().retrieveProxy(a.MainPy.N),Utils.AssetsMgr.loadGroup("group_chat"),t.skinName="ChatMainSkin",t.curChannelType=EChatChannelType.EChatChannelTypeZone,t.lastChannelType=EChatChannelType.EChatChannelTypeZone,t}return __extends(e,o),e.prototype.onDestroy=function(){o.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_chat")},e.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.addNotices(),this.list_root.useVirtualLayout=!1,this.list_root.itemRenderer=r,this.sl_root.verticalScrollBar.visible=!1,this.sl_root.verticalScrollBar.autoVisibility=!1,this.sl_emoji.verticalScrollBar.visible=!1,this.sl_emoji.verticalScrollBar.autoVisibility=!1,this.sl_privateChat.verticalScrollBar.visible=!1,this.sl_privateChat.verticalScrollBar.autoVisibility=!1,this.initEventListener(),this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.CommonDaTanChuKuang.blb_title.text="聊天";var t=[{up:"_chat_m_json.liaotian_img_yeqian_2",down:"_chat_m_json.liaotian_img_yeqian_1",type:EChatChannelType.EChatChannelTypeZone,text:"世界"},{up:"_chat_m_json.liaotian_img_yeqian_2",down:"_chat_m_json.liaotian_img_yeqian_1",type:EChatChannelType.SameServer,text:"本服"},{up:"_chat_m_json.liaotian_img_yeqian_2",down:"_chat_m_json.liaotian_img_yeqian_1",type:EChatChannelType.EChatChannelTypeGuild,text:"公会"},{up:"_chat_m_json.liaotian_img_yeqian_2",down:"_chat_m_json.liaotian_img_yeqian_1",type:EChatChannelType.EChatChannelTypePrivate,text:"私聊"}];this.tarbar_channel.itemRendererSkinName="TabBarItemSkin2",this.tarbar_channel.selectedIndex=1;a.GameMVC.loginPy;Utils.UnlockMgr.checkPass(MODULE.ChatPrivate,!1).allow||(t.pop(),this.tarbar_channel.selectedIndex=0),this.tarbar_channel.dataProvider=new eui.ArrayCollection(t),this.et_input.maxChars=parseInt(a.Config.constConfig().contentLengthLimit.constValue),this.et_input.multiline=!1,this.once(egret.Event.ENTER_FRAME,function(){e.initEmojiList()},this);for(var i=0;i<this.mainProxy.maxPrivatePlayerNum;i++){var n=new s;n.visible=!1,this.gp_privateChatPlayer.addChild(n)}NoticeManager.updateNotice(this.mainProxy.channel_2_notice[EChatChannelType.EChatChannelTypeGuild],EChatChannelType.EChatChannelTypeGuild,!0),NoticeManager.updateNotice(this.mainProxy.channel_2_notice[EChatChannelType.EChatChannelTypePrivate],EChatChannelType.EChatChannelTypePrivate,!0),NoticeManager.updateNotice(this.mainProxy.channel_2_notice[EChatChannelType.EChatChannelTypeZone],EChatChannelType.EChatChannelTypeZone,!0),NoticeManager.updateNotice(this.mainProxy.channel_2_notice[EChatChannelType.SameServer],EChatChannelType.SameServer,!0)},e.prototype.initEventListener=function(){var n=this;this.btn_send.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.UnlockMgr.checkPass(MODULE.Chat).allow){if(n.mainProxy.scheId)return void Utils.MsgUtils.addMidMsg("口干舌燥，请休息一会");if(""===n.et_input.text)return void Utils.MsgUtils.addMidMsg("请先输入内容");var e=parseInt(a.Config.constConfig().contentLengthLimit.constValue);if(n.et_input.text.length>e)return void Utils.MsgUtils.addMidMsg("最多输入"+e+"个字");var t=EChatChannelType.EChatChannelTypeZone,i=void 0;if(n.curChannelType==EChatChannelType.EChatChannelTypePrivate){if(i=n.mainProxy.curPrivateChoseId,t=EChatChannelType.EChatChannelTypePrivate,!i)return void Utils.MsgUtils.addMidMsg("找不到聊天对象")}else(t=n.curChannelType)&&t!==EChatChannelType.EChatChannelTypeSystem||(t=EChatChannelType.SameServer);n.mainProxy.SendMessage(t,n.et_input.text,i,function(){n.et_input.text=""})}},this),this.btn_emoji.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.gp_emoji.visible=!n.gp_emoji.visible,0==n.gp_emoji.visible&&n.et_input.setFocus()},this),this.gp_emoji_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.gp_emoji.visible=!1},this),this.sl_root.addEventListener(egret.Event.CHANGE,function(e){n.newTips&&n.newTips.visible&&(n.newTipCount=0,n.newTips.visible=!1)},this),this.et_input.addEventListener(egret.Event.FOCUS_IN,function(){n.et_input.textAlign="left"},this),this.et_input.addEventListener(egret.Event.FOCUS_OUT,function(){""==n.et_input.text&&(n.et_input.textAlign="center")},this),Utils.SDKMgr.getPerformConfig(32)?(this.et_input.touchEnabled=!1,this.gp_skip.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.MsgUtils.addMidMsg("聊天系统正在维护升级")},this)):this.gp_skip.parent.removeChild(this.gp_skip),this.tarbar_channel.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){var t=e.item.type;if(t==EChatChannelType.EChatChannelTypeGuild){if(!a.AppFacade.getInstance().retrieveProxy(a.GuildPy.N).isInGuild())return Utils.MsgUtils.addMidMsg("未加入公会"),void(n.tarbar_channel.selectedIndex=n.Channel_2_Index[n.curChannelType]);n.sl_privateChat.visible=!1,n.img_privateChatBg.visible=!1}else if(t==EChatChannelType.EChatChannelTypePrivate){var i=n.mainProxy.getPrivateChatPlayerList();if(!i||0==i.length)return Utils.MsgUtils.addMidMsg("暂无私聊消息"),void(n.tarbar_channel.selectedIndex=n.Channel_2_Index[n.curChannelType]);n.sl_privateChat.visible=!0,n.img_privateChatBg.visible=!0}else n.sl_privateChat.visible=!1,n.img_privateChatBg.visible=!1;n.updateView({NextChannelType:t})},this),this.btn_removePrivateTalk.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.mainProxy.removePrivateChatPlayer(n.mainProxy.curPrivateChoseId)},this)},e.prototype.updateInterval=function(e){e<=0?(egret.clearInterval(this.mainProxy.scheId),this.mainProxy.scheId=void 0,this.btn_send.label="发 送",UIActionManager.setGrey(this.btn_send,!1),this.btn_send.touchEnabled=!0,this.lb_time.text=""):(this.btn_send.label="",this.lb_time.text=e/1e3+"s")},e.prototype.updatePrivateChatPlayer=function(){var i=this;if(this.curChannelType==EChatChannelType.EChatChannelTypePrivate){for(var n=this.mainProxy.getPrivateChatPlayerList(),e=function(e){var t=o.gp_privateChatPlayer.getChildAt(e);t&&n[e]?(t.update(n[e].baseInfo,function(){i.mainProxy.curPrivateChoseId=n[e].baseInfo.playerId,i.mainProxy.curPrivateChoseName=n[e].baseInfo.name,i.updateView({NextChannelType:EChatChannelType.EChatChannelTypePrivate,playerId:n[e].baseInfo.playerId}),i.changeSelectIndex(e)},o),t.visible=!0):t&&(t.visible=!1)},o=this,t=0;t<this.mainProxy.maxPrivatePlayerNum;t++)e(t);this.curChannelType==EChatChannelType.EChatChannelTypePrivate&&n.length?this.gp_withWhoTalk.visible=!0:this.gp_withWhoTalk.visible=!1,this.lb_withWhoTalk.text="与 "+this.mainProxy.curPrivateChoseName+" 对话"}},e.prototype.changeSelectIndex=function(e){var t;this.curChannelType==EChatChannelType.EChatChannelTypePrivate&&((t=this.gp_privateChatPlayer.getChildAt(this.curSelectPrivateIndex))&&t.setChosen(!1),(t=this.gp_privateChatPlayer.getChildAt(e))&&t.setChosen(!0),this.curSelectPrivateIndex=e)},e.prototype.updateView=function(e){if(e){if(e.NextChannelType||(e.NextChannelType=this.curChannelType),this.isFirst)this.isFirst=!1;else if(e.NextChannelType==this.curChannelType&&this.curChannelType!=EChatChannelType.EChatChannelTypePrivate)return;this.lastChannelType=this.curChannelType,this.curChannelType=e.NextChannelType,this.mainProxy.curChannel=this.curChannelType,e.NextChannelType==EChatChannelType.EChatChannelTypePrivate?(this.sl_root.height=577,this.gp_withWhoTalk.visible=!0,this.changeDataProvider(e.playerId||this.mainProxy.setLastPrivateTalk()),this.updatePrivateChatPlayer(),this.sl_privateChat.visible=!0,this.img_privateChatBg.visible=!0):(this.sl_root.height=624,this.changeDataProvider(void 0),this.sl_privateChat.visible=!1,this.img_privateChatBg.visible=!1,this.gp_withWhoTalk.visible=!1),this.tarbar_channel.selectedIndex=this.Channel_2_Index[this.curChannelType],this.changeSelectIndex(0),this.mainProxy.noticesTag[this.curChannelType]=!1,NoticeManager.updateNotice(this.mainProxy.channel_2_notice[this.curChannelType],this.curChannelType,!0)}},e.prototype.changeDataProvider=function(e){var t=this.mainProxy.getDataProvider(this.curChannelType,e);this.list_root.dataProvider=new eui.ArrayCollection(t),this.jumpToBottom()},e.prototype.insertItem=function(e){var t=this;e.channelType;if(this.checkCanInsert(e)){this.list_root.dataProvider.addItem(e),this.list_root.dataProvider.length>this.mainProxy.maxMsgShow&&this.list_root.dataProvider.removeItemAt(0),this.sl_root.viewport.scrollV<this.list_root.contentHeight-this.sl_root.height&&this.newTipCount++;var i=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N).playerInfoVO.playerId;e.fromPlayer&&e.fromPlayer.playerId===i||!this.newTipCount?(this.newTipCount=0,this.jumpToBottom()):0<this.newTipCount&&3<this.list_root.dataProvider.length&&(this.newTips||(this.newTips=new eui.Label,this.newTips.horizontalCenter=0,this.newTips.bottom=70,this.newTips.stroke=2,this.newTips.strokeColor=0,this.et_input.parent.parent.addChild(this.newTips),UIActionManager.fadeBlink(this.newTips,!0),this.newTips.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.jumpToBottom()},this)),this.newTips.visible=!0,this.newTips.text=this.newTipCount+"条新的消息")}},e.prototype.jumpToBottom=function(){var e=this;this.newTips&&this.newTips.visible&&(this.newTipCount=0,this.newTips.visible=!1),this.sl_root.stopAnimation(),this.once(egret.Event.ENTER_FRAME,function(){e.sl_root.viewport.scrollV=0<e.list_root.contentHeight-e.sl_root.height?e.list_root.contentHeight-e.sl_root.height:0},this)},e.prototype.checkCanInsert=function(e){var t=e.channelType,i=!1,n=e.broadcastId,o=a.Config.broadcastConfig();if(this.curChannelType==EChatChannelType.SameServer){if(t==EChatChannelType.SameServer)i=!0;else if(t==EChatChannelType.EChatChannelTypeSystem){if(n&&o[n])0<=JSON.parse(o[n].channel).indexOf(EChatChannelType.EChatChannelTypeSystem)&&(i=!0);else i=!0}}else if(t==EChatChannelType.EChatChannelTypePrivate&&(e.fromPlayer&&e.fromPlayer.playerId==this.curPrivateId||e.toPlayer&&e.toPlayer.playerId==this.curPrivateId))i=!0;else if(this.curChannelType==EChatChannelType.EChatChannelTypeZone&&t==EChatChannelType.EChatChannelNewZone)i=!0;else if(t==this.curChannelType){if(n&&o[n])0<=JSON.parse(o[n].channel).indexOf(t)&&(i=!0);else i=!0}return i},e.prototype.initEmojiList=function(){var t=this,e=new eui.TileLayout;e.horizontalGap=8,e.requestedColumnCount=10,this.list_emoji.layout=e,this.list_emoji.itemRendererSkinName="ChatEmojiItemSkin";for(var i=[],n=1;n<=100;n++){var o="",a="_chat_m_json.static_"+(o=0<=n&&n<10?"00"+n:10<=n&&n<100?"0"+n:""+n);i.push({source:a,code:"#"+o+"#"})}this.list_emoji.dataProvider=new eui.ArrayCollection(i),this.list_emoji.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),t.et_input.text+=e.item.code,t.gp_emoji.visible=!1},this),this.sl_emoji.bounces=!1},e.prototype.addNotices=function(){a.GameMVC.loginPy;NoticeManager.addNoticeListener(this.mainProxy.channel_2_notice[EChatChannelType.EChatChannelTypeZone],this.tarbar_channel,this,{percentX:100/518}),NoticeManager.addNoticeListener(this.mainProxy.channel_2_notice[EChatChannelType.SameServer],this.tarbar_channel,this,{percentX:230/518}),NoticeManager.addNoticeListener(this.mainProxy.channel_2_notice[EChatChannelType.EChatChannelTypeGuild],this.tarbar_channel,this,{percentX:360/518}),NoticeManager.addNoticeListener(this.mainProxy.channel_2_notice[EChatChannelType.EChatChannelTypePrivate],this.tarbar_channel,this,{percentX:490/518})},e}(BasePanel);a.ChatMain=e,__reflect(e.prototype,"game.ChatMain");var r=function(t){function e(){var e=t.call(this)||this;return e.playerProxy=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),e.mainProxy=a.AppFacade.getInstance().retrieveProxy(a.MainPy.N),e.lineCount=1,e.isSelf=!1,e.isSystem=!1,e.skinName="ChatItemSkin",e}return __extends(e,t),e.prototype.dataChanged=function(){this.params=this.data.params,this.data.fromPlayer&&this.data.fromPlayer.playerId==this.playerProxy.playerInfoVO.playerId&&(this.isSelf=!0),(this.data.channelType===EChatChannelType.EChatChannelTypeSystem||this.data.channelType===EChatChannelType.EChatChannelTypeGuild&&this.data.sourceType==ChatMsgSourceType.System)&&(this.isSystem=!0),this.mainProxy.curChannel==EChatChannelType.EChatChannelTypePrivate?this.gp_main.width=500:this.gp_main.width=598,this.decorateTitle(),this.decoratePosition(),this.decorateTitleAvatar(),this.decorateContent()},e.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),this.playerhead.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),t=a.GameMVC.loginPy;t.loginGameVO.singleSign&&i.data.fromPlayer&&i.data.fromPlayer.serverId!=t.serverSelect.area?Utils.MsgUtils.addMidMsg("无法查看跨服玩家信息"):(i.data.fromPlayer&&i.data.fromPlayer.playerId!=e.playerInfoVO.playerId&&a.AppFacade.getInstance().showSubView(a.FriendMediator.N,a.FriendMediator.SV.INFO,{playerId:i.data.fromPlayer.playerId}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap))},this),this.decorateLink()},e.prototype.decorateContent=function(){var e=this;this.isSelf?(this.content_bg.source="_chat_m_json.liaotian_img_qipao_2",this.lb_content.textColor=8867361):this.isSystem?(this.content_bg.source="_chat_m_json.liaotian_img_qipao_3",this.lb_content.textColor=6960910):(this.content_bg.source="_chat_m_json.liaotian_img_qipao_1",this.lb_content.textColor=10449482),this.lb_content.width=void 0,this.data.channelType==EChatChannelType.EChatChannelTypePrivate?this.lb_content.maxWidth=400:this.data.channelType==EChatChannelType.EChatChannelTypeSystem?this.lb_content.maxWidth=510:this.lb_content.maxWidth=490,this.getFacialExpression(this.data.textFlow),this.lb_content.textFlow=this.data.textFlow,this.isSystem?1==this.lineCount?this.height=46:2==this.lineCount?this.height=62:3==this.lineCount&&(this.height=88):1==this.lineCount?this.height=69:2==this.lineCount&&(this.height=95),this.once(egret.Event.ENTER_FRAME,function(){e.isSystem?(e.content_bg.width=e.lb_content.width+15,e.content_bg.left=63,e.lb_content.left=71,1==e.lb_content.numLines?(e.content_bg.y=0,e.lb_content.y=10,e.height=46,e.content_bg.height=44):2==e.lb_content.numLines?(e.content_bg.y=0,e.lb_content.y=8,e.height=62,e.content_bg.height=64):3==e.lb_content.numLines&&(e.content_bg.y=0,e.lb_content.y=8,e.height=88,e.content_bg.height=90)):(e.content_bg.y=26.5,e.content_bg.left=85,e.lb_content.y=35,e.lb_content.left=97,e.content_bg.width=e.lb_content.width+17,1==e.lb_content.numLines?(e.content_bg.height=38,e.height=69):2==e.lb_content.numLines&&(e.content_bg.height=64,e.height=95))},this)},e.prototype.getFacialExpression=function(e){var o=this,a=new eui.Label;if(a.size=this.lb_content.size,!this.data.Facial){this.data.Facial={},this.data.Facial.expressionPosi=[],this.data.Facial.text="",this.data.Facial.allLength=0,e.forEach(function(e){o.data.Facial.text+=e.text});for(var t=new RegExp(/#(00[1-9]|0[1-9][0-9]|100)#/g),i=t.exec(this.data.Facial.text);i;)this.data.Facial.expressionPosi.push(i),i=t.exec(this.data.Facial.text);e.forEach(function(e){e.text=e.text.replace(t,"     ")}),this.data.Facial.text=this.data.Facial.text.replace(t,"     "),a.text=this.data.Facial.text,this.data.Facial.allLength=a.textWidth}this.lineCount=Math.ceil(this.data.Facial.allLength/this.lb_content.maxWidth),this.gp_emoji.width=this.data.Facial.allLength,this.data.Facial.expressionPosi.forEach(function(e){var t=new eui.Image,i=e[0].substring(1,e[0].length-1);t.source="_chat_m_json.static_"+i;var n=o.data.Facial.text.slice(0,e.index);a.text=n,a.textWidth-1>o.lb_content.maxWidth?t.left=a.textWidth-1-o.lb_content.maxWidth:t.left=a.textWidth-1,t.y=1,t.right=void 0,t.scaleX=.63,t.scaleY=.63,o.gp_emoji.addChild(t)})},e.prototype.decorateTitle=function(){var e="";this.data.channelType!==EChatChannelType.EChatChannelTypeZone&&this.data.channelType!==EChatChannelType.EChatChannelNewZone&&this.data.channelType!==EChatChannelType.EChatChannelTypePrivate||!this.data.fromPlayer||(e+=this.data.fromPlayer.serverId+"服  "),this.data.fromPlayer&&this.data.fromPlayer.name&&(e+=this.data.fromPlayer.name),this.lb_name.text=e,this.lb_name.width=this.lb_name.textWidth},e.prototype.decorateTitleAvatar=function(){this.data.fromPlayer?(this.playerhead.updateData({vo:this.data.fromPlayer}),this.head_system.visible=!1,this.playerhead.visible=!0):this.data.channelType===EChatChannelType.EChatChannelTypeSystem?(this.playerhead.visible=!1,this.head_system.visible=!0):this.data.channelType===EChatChannelType.EChatChannelTypeGuild&&this.data.sourceType==ChatMsgSourceType.System&&(this.playerhead.visible=!1,this.head_system.visible=!0)},e.prototype.decoratePosition=function(){this.isSelf&&(this.gp_main.scaleX=-this.gp_main.scaleX,this.lb_name.scaleX=-this.lb_name.scaleX,this.lb_content.scaleX=-this.lb_content.scaleX,this.gp_emoji.scaleX=-this.gp_emoji.scaleX,this.playerhead.scaleX=-this.playerhead.scaleX)},e.prototype.decorateLink=function(){var t=this;this.lb_content.touchEnabled=!0,this.lb_content.addEventListener(egret.TextEvent.LINK,function(e){t.mainProxy.bindChatLinkJump(e,{channelType:t.data.channelType})},this)},e.CHANNEL_CONFIG={1:{name:"世界",type:EChatChannelType.EChatChannelTypeWorld},2:{name:"公会",type:EChatChannelType.EChatChannelTypeGuild},3:{name:"系统",type:EChatChannelType.EChatChannelTypeSystem},4:{name:"私聊",type:EChatChannelType.EChatChannelTypePrivate},5:{name:"同服",type:EChatChannelType.SameServer},6:{name:"战区",type:EChatChannelType.EChatChannelTypeZone}},e}(eui.ItemRenderer);__reflect(r.prototype,"ChatItem");var s=function(t){function e(){var e=t.call(this)||this;return e.skinName="chatPlayerHeadSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.callBack&&e.callBack.call(e.thisObj)},this),this.playerhead.touchEnabled=!1,this.img_chosen.visible=!1},e.prototype.update=function(e,t,i){this.playerhead.updateData({vo:e}),this.playerhead.blb_level.visible=!1,this.blb_level.text=e.level,this.callBack=t,this.thisObj=i},e.prototype.setChosen=function(e){this.img_chosen.visible=e},e}(eui.ItemRenderer);__reflect(s.prototype,"chatPlayerHead")}(game||(game={})),function(d){var e=function(i){function e(e){var t=i.call(this)||this;return t.skinName="HelpDialogSkin",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.initList(),this.cu_dtc.blb_title.text="玩法说明",this.cu_dtc.onCloseCB=function(){e.hide()},this.updateView(this.params)},e.prototype.initList=function(){this.list_item=new eui.List;var e=new eui.VerticalLayout;e.verticalAlign=egret.VerticalAlign.TOP,e.horizontalAlign=egret.HorizontalAlign.CENTER,e.paddingTop=5,e.gap=-5,this.list_item.layout=e,this.gp_desc.addChild(this.list_item),this.list_item.horizontalCenter=0,this.list_item.itemRenderer=t},e.prototype.updateView=function(e){var t=this;if(this.params){this.cu_dtc.onCloseCB=function(){t.hide()},this.scroller.verticalScrollBar.visible=!1,this.scroller.verticalScrollBar.autoVisibility=!1;var i=this.params&&this.params.moduleId&&d.Config.unlockConfig()[this.params.moduleId],n=e.text||HELP_CONST[this.params.moduleId].content,o=n;if(!e.text){var a=[];if(null!=i)for(var r=i.condition,s=0,c=JSON.parse(r);s<c.length;s++){var l=c[s];a.push(r[l])}n=n.format(a),o=(new egret.HtmlTextParser).parse(String(n))}Array.isArray(o)||(o=(new egret.HtmlTextParser).parse(String(o)));var h=[],p=0;o.forEach(function(e){null==h[p]&&(h[p]=[]),h[p].push(e),"\n"==e.text&&p++}),this.list_item.dataProvider=new eui.ArrayCollection(h)}},e}(BasePanel);d.HelpDialog=e,__reflect(e.prototype,"game.HelpDialog");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="CommonItemHelp",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.lb_desc.bold=!0,this.lb_desc.size=22,this.lb_desc.textColor=7877150,this.lb_desc.lineSpacing=10},e.prototype.dataChanged=function(){this.lb_desc.textFlow=this.data,this.height=this.lb_desc.height-5},e}(eui.ItemRenderer);__reflect(t.prototype,"HelpItem")}(game||(game={})),function(t){var e=function(){function e(){}return e.CENTER_BTN_CONFIG=[{btnId:"btn_2_1",module:MODULE.Decompose,eff:"zhujiemian_yxjt",effPos:[139,219],effNamePic:"zhujiemian_txt_yxjt_png",staticPic:"zhujiemian_img_yxjt_png",effNamePos:[50,230],noticeType:void 0,noticePos:void 0,clickFunc:function(){t.MainJumpConfig.jumpTo(MODULE.Decompose)}},{btnId:"btn_3_11",module:MODULE.Activity+EActivityType.ExtremeBattle,eff:"",effPos:[76.5,93],effNamePic:"zhujiemian_txt_sq_png",staticPic:"",effNamePos:[0,110],noticeType:void 0,noticePos:{percentX:128/153,percentY:100/146},clickFunc:function(){t.AppFacade.getInstance().retrieveMediator(t.ActivityMediator.N).showViewByCode(EActivityType.ExtremeBattle)}},{btnId:"btn_3_10",module:MODULE.Activity+EActivityType.NewYearChallenge,eff:"",effPos:[76.5,93],effNamePic:"zhujiemian_txt_xctz_png",staticPic:"",effNamePos:[0,110],noticeType:function(){return NT.ALL_ACTIVITY[EActivityType.NewYearChallenge]},noticePos:{percentX:138/153,percentY:130/146},clickFunc:function(){t.AppFacade.getInstance().retrieveMediator(t.ActivityMediator.N).showViewByCode(EActivityType.NewYearChallenge)}},{btnId:"btn_3_9",module:MODULE.HeroChallenge,eff:"",effPos:[76.5,93],effNamePic:"zhujiemian_txt_sq_png",staticPic:"",effNamePos:[0,110],noticeType:NT.HERO_CHALLENGE,noticePos:{percentX:160/153,percentY:130/146},clickFunc:function(){t.MainJumpConfig.jumpTo(MODULE.HeroChallenge)}},{btnId:"btn_4_1",module:MODULE.StarDoor,eff:"zhujiemian_skzm",effPos:[97,167.5],effNamePic:"zhujiemian_txt_skzm_png",staticPic:"",effNamePos:[15,160],noticeType:NT.STAR_DOOR_ENTRANCE,noticePos:{percentX:155/194,percentY:157/195},clickFunc:function(){t.MainJumpConfig.jumpTo(MODULE.StarDoor)}},{btnId:"btn_4_5",module:void 0,eff:"",effPos:[97,167.5],effNamePic:"",staticPic:"",effNamePos:[15,160],noticeType:void 0,noticePos:{percentX:155/194,percentY:157/195},clickFunc:function(){t.AppFacade.getInstance().showSubView(t.ExtEntranceMediator.N,t.ExtEntranceMediator.SV.ENTRANCE2)}},{btnId:"btn_5_2",module:MODULE.ServerBoss,eff:"zhujiemian_bstz",effPos:[57,306],effNamePic:"zhujiemian_txt_bstz_png",staticPic:"zhujiemian_img_bstz_png",effNamePos:[0,270],noticeType:NT.WORLD_BOSS,noticePos:{percentX:280/301,percentY:.8125},clickFunc:function(){t.MainJumpConfig.jumpTo(MODULE.ServerBoss)}},{btnId:"btn_3_2",module:MODULE.Arena,eff:"zhujiemian_jjtz",effPos:[151,165],effNamePic:"zhujiemian_txt_jjtz_png",staticPic:"",effNamePos:[65,158],noticeType:NT.CITY_PVP_ENTRANCE,noticePos:{percentX:195/301,percentY:.78125},clickFunc:function(){Utils.UnlockMgr.checkPass(MODULE.Arena).allow&&t.AppFacade.getInstance().showSubView(t.PvpEntranceMediator.N,t.PvpEntranceMediator.SV.ENTRANCE)}},{btnId:"btn_3_3",module:MODULE.HeroGaCha,eff:"zhujiemian_yxzh",effPos:[146,244],effNamePic:"zhujiemian_txt_yxzh_png",staticPic:"",effNamePos:[65,250],noticeType:NT.GASHA_ENTRANCE,noticePos:{percentX:200/292,percentY:240/308},clickFunc:function(){t.MainJumpConfig.jumpTo(MODULE.HeroGaCha)}},{btnId:"btn_4_2",eff:"",module:void 0,effPos:[0,0],effNamePic:"",staticPic:"",effNamePos:[0,0],noticeType:NT.CITY_EXT_ENTRANCE,noticePos:{percentX:80/153,percentY:293/361},clickFunc:function(){t.AppFacade.getInstance().showSubView(t.ExtEntranceMediator.N,t.ExtEntranceMediator.SV.ENTRANCE)}},{btnId:"btn_4_3",module:MODULE.Champion,eff:"zhujiemian_yhzt",effPos:[96.5,340],effNamePic:"zhujiemian_txt_yhzt_png",staticPic:"zhujiemian_img_yhzt_png",effNamePos:[15,325],noticeType:NT.CHAMPION,noticePos:{percentX:135/153,percentY:320/361},clickFunc:function(){t.MainJumpConfig.jumpTo(MODULE.Champion)}},{btnId:"btn_3_1",module:MODULE.DailyFortress,eff:"zhujiemian_fbtz",effPos:[110,130],effNamePic:"zhujiemian_txt_fbtz_png",staticPic:"zhujiemian_img_fbtz_png",effNamePos:[15,140],noticeType:NT.CITY_COPY_ENTRANCE,noticePos:{percentX:150/184,percentY:130/173},clickFunc:function(){Utils.UnlockMgr.checkPass(MODULE.DailyFortress).allow&&t.AppFacade.getInstance().showSubView(t.CopyEntranceMediator.N,t.CopyEntranceMediator.SV.ENTRANCE)}},{btnId:"btn_3_4",module:MODULE.ShopMystical,eff:"zhujiemian_hssr",effPos:[88,199],effNamePic:"zhujiemian_txt_hssr_png",staticPic:"",effNamePos:[-10,195],noticeType:void 0,noticePos:void 0,clickFunc:function(){t.MainJumpConfig.jumpTo(MODULE.ShopMystical)}},{btnId:"btn_4_4",module:MODULE.Magical,eff:"zhujiemian_sq",effPos:[76.5,93],effNamePic:"zhujiemian_txt_sq_png",staticPic:"zhujiemian_img_sq_png",effNamePos:[0,110],noticeType:NT.MAGICAL,noticePos:{percentX:128/153,percentY:100/146},clickFunc:function(){Utils.UnlockMgr.checkPass(MODULE.Magical).allow&&t.AppFacade.getInstance().showSubView(t.MagicalArtifactMediator.N,t.MagicalArtifactMediator.SV.MAIN)}},{btnId:"btn_3_5",module:MODULE.Smithy,eff:"zhujiemian_tjp",effPos:[210,305],staticPic:"",effNamePic:"",effNamePos:[100,330],clickFunc:function(){t.MainJumpConfig.jumpTo(MODULE.Smithy)}},{btnId:"btn_3_5_2",module:MODULE.Smithy,eff:"zhujiemian_ar",effPos:[220,355],effNamePic:"zhujiemian_txt_tjp_png",staticPic:"",effNamePos:[100,330,-.9,.9],noticeType:NT.SMITHY_ENTRANCE,noticePos:{percentX:228/453,percentY:330/443},clickFunc:function(){t.MainJumpConfig.jumpTo(MODULE.Smithy)}},{btnId:"btn_3_6",module:void 0,eff:"",effPos:[88,199],effNamePic:"_yslz_m_json.yslz_img_baoxiang",staticPic:"",effNamePos:[-10,195],noticeType:void 0,noticePos:void 0,clickFunc:function(){t.AppFacade.getInstance().retrieveProxy(t.TaskPy.N).GetTaskReward(TaskType.HideAchievement,500008)}},{btnId:"btn_3_7",module:void 0,eff:"",effPos:[88,199],effNamePic:"_yslz_m_json.yslz_img_baoxiang",staticPic:"",effNamePos:[-10,195],noticeType:void 0,noticePos:void 0,clickFunc:function(){t.AppFacade.getInstance().retrieveProxy(t.TaskPy.N).GetTaskReward(TaskType.HideAchievement,500010)}},{btnId:"btn_3_8",module:MODULE.Challenge,eff:"zhujiemian_yj",effPos:[240,280],effNamePic:"zhujiemian_txt_yjtx_png",staticPic:"zhujiemian_img_yj_png",effNamePos:[160,280],noticeType:void 0,noticePos:void 0,clickFunc:function(){t.MainJumpConfig.jumpTo(MODULE.Challenge)}}],e}();t.CityBtnConfig=e,__reflect(e.prototype,"game.CityBtnConfig")}(game||(game={})),function(f){var e=function(i){function g(e){void 0===e&&(e=null);var t=i.call(this,g.N,e)||this;return t.cityProxy=f.AppFacade.getInstance().retrieveProxy(f.CityPy.N),t.initNotice(),t}return __extends(g,i),g.prototype.initNotice=function(){NoticeManager.setChildType(NT.CITY_COPY_ENTRANCE,[NT.DAILY_COPY,NT.EXPEDITION,NT.TEAM_EXPE_REWARD,NT.ZONE_BOSS_ENTRANCE,NT.DEEP_NEST])},g.prototype.initSubView=function(){this.addSubView(g.SV.MAIN,f.CityUI)},g.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.EXTREME_CHALLENGE_MODEL_UPDATE,CN.HERO_CHALLENGE_MODEL_UPDATE,CN.EGGS_UPDATE,CN.NEWYEARCHALLENGE_UPDATE,CN.PLAYER_LEVEL_UP,CN.CITY_SWITCH_DBCLOCKPAUSE]},g.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.log("HIDE_ALL_SUBVIEW");var i=this.getSubView(g.SV.MAIN);i&&(i.visible=!1,i.parent&&i.parent.setChildIndex(i,0),i.perClose());break;case CN.CITY_SWITCH_DBCLOCKPAUSE:(u=this.getSubView(g.SV.MAIN))&&u.switchDBClockPause(t);break;case CN.EGGS_UPDATE:(u=this.getSubView(g.SV.MAIN))&&u.updateEggsBtn();break;case CN.PLAYER_LEVEL_UP:(u=this.getSubView(g.SV.MAIN))&&u.updateBtns();break;case CN.EXTREME_CHALLENGE_MODEL_UPDATE:if(!(p=this.getSubView(g.SV.MAIN)))return;if((d=f.AppFacade.getInstance().retrieveProxy(f.ActivityPy.N).allActivityData[EActivityType.ExtremeBattle])&&d.data){var n=JSON.parse(d.content),o=void 0;for(var a in n[1]){var r=n[1][a];r[0]==d.data.curCycle&&(o=r[1])}if(!o||d.data.passed)return void p.updateExChallengeModel();var s=void 0,c=(s=o[d.data.id-1][2])[0][0];s.forEach(function(e){e[1]&&(c=e[0])});var l=f.Config.creepConfig()[c];if(l){var h=(d.endDt-f.GameMgr.getInstance().serverTime())%(24*n[0]*60*60);p.updateExChallengeModel({code:l.heroId,isStatic:!0,dt:h})}else p.updateExChallengeModel()}else p.updateExChallengeModel();break;case CN.HERO_CHALLENGE_MODEL_UPDATE:var p;if(!(p=this.getSubView(g.SV.MAIN)))return;(d=f.AppFacade.getInstance().retrieveProxy(f.HeroChallenge2Py.N).challengeInfo)&&d.code?p.updateHeroChallengeModel({code:d.creeps[0],isStatic:!0}):p.updateHeroChallengeModel();break;case CN.NEWYEARCHALLENGE_UPDATE:var d=f.AppFacade.getInstance().retrieveProxy(f.ActivityPy.N).allActivityData[EActivityType.NewYearChallenge],u=this.getSubView(g.SV.MAIN);if(!d||!d.data)return void(u&&u.updateNewYearChallenge({visible:!1}));u&&u.updateNewYearChallenge({visible:!0,model:"hero_037_03",endDt:f.ActivityConfig.getActivityEndDt(EActivityType.NewYearChallenge)})}},g.prototype.onViewCreate=function(){},g.N="CityMediator",g.SV={MAIN:1},g}(BaseMediator);f.CityMediator=e,__reflect(e.prototype,"game.CityMediator")}(game||(game={})),function(e){var t=function(e){function t(){return e.call(this,t.N)||this}return __extends(t,e),t.N="CityProxy",t}(BaseProxy);e.CityPy=t,__reflect(t.prototype,"game.CityPy")}(game||(game={})),function(s){var e=function(i){function e(){var e=i.call(this)||this;return e.localOpenDay=0,e.EFF={},e.skinName="CitySkin",e.btns=new Array,e.winWidth=Utils.DeviceUtils.curWidth(),Utils.DebugUtils.isDebug&&(window._city=e),e}return __extends(e,i),e.prototype.fetch=function(){},e.prototype.touchBegin=function(e){for(var t=0,i=this.btns;t<i.length;t++){var n=i[t];if(n.hitTestPoint(e.stageX,e.stageY)){this.curTouchBeginBtn=n,this.curTouchBeginBtn.currentState="down";break}}},e.prototype.touchEnd=function(e){for(var t=0,i=this.btns;t<i.length;t++){var n=i[t];if(n.hitTestPoint(e.stageX,e.stageY)){this.curTouchBeginBtn&&(this.curTouchBeginBtn.currentState="up"),n.touchEnabled&&egret.TouchEvent.dispatchTouchEvent(n,egret.TouchEvent.TOUCH_TAP);break}}},e.prototype.scrollChange=function(){var e=this.cenSH-this.sl_root.viewport.scrollH;this.curTouchBeginBtn&&(this.curTouchBeginBtn.currentState="up"),this.curTouchBeginBtn=void 0,this.gp_img_1.x=1.15*e-1252.2,this.gp_2.x=.7*e*1.15-782.07,this.gp_3.x=.4*e*1.15-492.7,this.gp_4.x=.3*e*1.15-534.71,this.gp_5.x=.1*e*1.15-395.62},e.prototype.addNoticType=function(e,t){if(t&&t.noticeType){var i=t.noticeType;"function"==typeof t.noticeType&&(i=t.noticeType()),NoticeManager.removeNoticeListener(i),NoticeManager.addNoticeListener(i,e.getChildAt(0),this,t.noticePos)}},e.prototype.removeNotice=function(){},e.prototype.updateBtns=function(){for(var e in s.CityBtnConfig.CENTER_BTN_CONFIG){var t=s.CityBtnConfig.CENTER_BTN_CONFIG[e];if(t){var i=this[t.btnId];this.updateBtn(i,t)}}},e.prototype.updateBtn=function(e,t){if(e){var i=!t.module||Utils.UnlockMgr.checkPass(t.module,!1).allow;UIActionManager.setAbsGrey(e,!i);var n=e.$children;for(var o in n){var a=n[o];"_effectOnObj"==a.name&&(i?a.animation&&a.animation.play&&a.animation.play(t.eff):a.animation.hasAnimation(t.eff+"_daiji")?a.animation&&a.animation.play&&a.animation.play(t.eff+"_daiji",0):a.animation&&a.animation.gotoAndStopByFrame&&a.animation.gotoAndStopByFrame(t.eff,0))}}},e.prototype.childrenCreated=function(){var o=this;i.prototype.childrenCreated.call(this),this.sl_root.validateNow(),this.cenSH=this.sl_root.viewport.scrollH,this.sl_root.addEventListener(egret.Event.CHANGE,this.scrollChange,this),this.sl_root.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.sl_root.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this);var a=Utils.SDKMgr.getPerformConfig(6),e=function(e){var t=s.CityBtnConfig.CENTER_BTN_CONFIG[e];if(!t)return"break";if(r.btns.push(r[t.btnId]),a&&t.staticPic)r[t.btnId].icon=t.staticPic,r.updateBtn(r[t.btnId],t);else if(t.eff){var i=!t.module||Utils.UnlockMgr.checkPass(t.module,!1).allow;DragonBoneTools.playOnce({x:t.effPos[0],y:t.effPos[1],loop:!0,scaleX:t.effNamePos[2]||1,scaleY:t.effNamePos[3]||1,z:0,effectName:t.eff,parent:r[t.btnId],static:!i,loadFinishCB:function(){o.updateBtn(o[t.btnId],t)}});var n=new eui.Image;n.source=t.effNamePic,n.x=t.effNamePos[0],n.y=t.effNamePos[1],r[t.btnId].addChild(n)}else r.updateBtn(r[t.btnId],t);r.bindBtn(r[t.btnId],t),r.addNoticType(r[t.btnId],t)},r=this;for(var t in s.CityBtnConfig.CENTER_BTN_CONFIG){if("break"===e(t))break}this.fetch(),s.AppFacade.getInstance().sendNotification(CN.EXTREME_CHALLENGE_MODEL_UPDATE),s.AppFacade.getInstance().sendNotification(CN.HERO_CHALLENGE_MODEL_UPDATE),s.AppFacade.getInstance().sendNotification(CN.NEWYEARCHALLENGE_UPDATE),this.updateNotice(),this.updateEggsBtn(),s.GameMVC.manorPy.startTimer(3e6),this.sl_root.viewport.scrollH=1356,this.scrollChange()},e.prototype.updateView=function(){var e=this;egret.setTimeout(function(){e.setGuideAvailable()},this,200);var t=Utils.TimerManager.getServerOpenDays();this.localOpenDay!=t&&(Utils.LocalStorageUtil.getTodayVaild("FIRST_INTO_CITY_FOR_EVERYDAY")||(s.AppFacade.getInstance().sendNotification(CN.FIRST_INTO_CITY_FOR_EVERYDAY),Utils.LocalStorageUtil.setTodayVaild("FIRST_INTO_CITY_FOR_EVERYDAY")),this.localOpenDay=t)},e.prototype.bindBtn=function(e,t){e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),t&&null!=t.clickFunc?t.clickFunc():Utils.MsgUtils.addMidMsg("功能开发中")},this)},e.prototype.makeBtn=function(e){var t=new eui.Image;return t.width=t.height=110,RES.getResAsync(e.img,function(e){t.source=e},this),t.x=e.posX,t.y=e.posY,t},e.prototype.perShow=function(){return this.isCreateComplete&&(this.sl_root.stopAnimation(),this.sl_root.viewport.scrollH=1356,this.scrollChange(),this.switchDBClockPause(!1)),this.sl_root.scrollPolicyH=this.sl_root.scrollPolicyV=eui.ScrollPolicy.ON,i.prototype.perShow.call(this)},e.prototype.switchDBClockPause=function(e){for(var t=0,i=this.btns;t<i.length;t++){var n=i[t].getChildByName("_effectOnObj");n&&n.armature&&DragonBoneTools.switchDBClockPause(n.armature,e)}},e.prototype.perClose=function(){this.switchDBClockPause(!0),this.removeNotice()},e.prototype.updateExChallengeModel=function(e){var t=this;e&&e.code?(this.btn_3_11.visible=!0,this.btn_3_11.touchEnabled=!0,this.heroModel_ec.update(e),this.timerDt=e&&e.dt||this.timerDt,this.timer||(this.timer=egret.setInterval(function(){t.bm_3_11_time.text=Utils.TimerManager.getFormatBySecond2(--t.timerDt)},this,1e3))):(this.btn_3_11.visible=!1,this.btn_3_11.touchEnabled=!1)},e.prototype.updateHeroChallengeModel=function(e){var t=this;if(e&&e.code){this.btn_3_9.visible=!0,this.btn_3_9.touchEnabled=!0,this.heroModel_hc.update(e);var i=Utils.TimerManager.getServerTime(!1),n=new Date(1e3*i),o=n.getDay()||7;n.setDate(n.getDate()+7-o),n.setHours(24,0,0,0),this.timerDt=n.getTime()/1e3-i,this.timer||(this.timer=egret.setInterval(function(){t.blb_3_9_time.text=Utils.TimerManager.getFormatBySecond2(--t.timerDt)},this,1e3))}else this.btn_3_9.visible=!1,this.btn_3_9.touchEnabled=!1},e.prototype.updateEggsBtn=function(){var e=s.AppFacade.getInstance().retrieveProxy(s.TaskPy.N).allTasks[TaskType.HideAchievement];for(var t in e){var i=e[t];500008==i.code&&i.isTarget&&(this.btn_3_6.touchEnabled=!1,this.btn_3_6.icon=""),500010==i.code&&i.isTarget&&(this.btn_3_7.touchEnabled=!1,this.btn_3_7.icon="")}},e.prototype.updateNewYearChallenge=function(e){var t=this;if(e.visible){this.btn_3_10.visible=!0,this.btn_3_10.touchEnabled=!0,this.heroModel3_10.update({model:e.model,isStatic:!0});var i=e.endDt;if(!this.timerNewYearChallenge){var n=Utils.TimerManager.getServerTime();this.bm_3_10_time.text=Utils.TimerManager.getFormatBySecond2(0<i-n?i-n:0),this.timerNewYearChallenge=egret.setInterval(function(){var e=Utils.TimerManager.getServerTime();t.bm_3_10_time.text=Utils.TimerManager.getFormatBySecond2(0<i-e?i-e:0)},this,1e3)}}else this.btn_3_10.visible=!1,this.btn_3_10.touchEnabled=!1,this.timerNewYearChallenge&&egret.clearInterval(this.timerNewYearChallenge)},e.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},e}(BaseTab);s.CityUI=e,__reflect(e.prototype,"game.CityUI")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.battleResultCache=[],t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.REWARD_PANEL,o.CommonRewardPreviewPanel),this.addSubView(n.SV.TIPS_DIALOG,o.CommonTipsDialog),this.addSubView(n.SV.HELP,o.HelpDialog),this.addSubView(n.SV.QUICK_BATTLE_DIALOG,o.CommonQuickBattleTips),this.addSubView(n.SV.SIMPLE_USE_PANEL,o.SimpleUsePanel),this.addSubView(n.SV.BUY_TIMES,o.CommonBuyTimesPanel),this.addSubView(n.SV.MOP_UP,o.CommonMopUpPanel),this.addSubView(n.SV.CONTINUOUS_BATTLE,o.CommonContinuousBattlePanel),this.addSubView(n.SV.TEAM_CHOOSE,o.CommonTeamChoosePanel),this.addSubView(n.SV.TEAM_PET_ART,o.CommonTeamPetAndArtPanel)},n.prototype.listNotificationInterests=function(){return[CN.REWARD_CLOSE,CN.BACKPACK_MULTI_TEAM_UPDATE]},n.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.REWARD_CLOSE:try{n.RewardCloseCallBack&&n.RewardCloseCallBack(t),n.RewardCloseCallBack=void 0}catch(e){console.log(e)}break;case CN.BACKPACK_MULTI_TEAM_UPDATE:var i=this.getSubView(n.SV.TEAM_CHOOSE);i&&i.updatePetAndArtList()}},n.prototype.showContinuousBattleView=function(t){var i=this;Utils.Socket.send(t.pb1,t.pb2,t.params).then(function(e){i.showSubView(n.SV.CONTINUOUS_BATTLE,{tipsFunc:t.tipsFunc,closeCB:t.closeCB})})},n.prototype.pushBattleRecord=function(e){this.battleResultCache.push(e),o.AppFacade.getInstance().updateView(n.N,n.SV.CONTINUOUS_BATTLE)},n.prototype.commonRollDice=function(e,t){PopUpManager.addPopUp({obj:new o.CommonRollDicePanel({num:e}),closeCB:function(){t&&t()}})},n.prototype.showCommonBuyNum=function(e){o.AppFacade.getInstance().showSubView(n.N,n.SV.BUY_TIMES,e)},n.N="CommonMediator",n.SV={REWARD_PANEL:1,TIPS_DIALOG:2,HELP:3,QUICK_BATTLE_DIALOG:4,SIMPLE_USE_PANEL:5,BUY_TIMES:6,MOP_UP:7,CONTINUOUS_BATTLE:8,TEAM_CHOOSE:9,TEAM_PET_ART:10},n}(BaseMediator);o.CommonMediator=e,__reflect(e.prototype,"game.CommonMediator")}(game||(game={})),function(u){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="CommonBuyTimesSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent()},e.prototype.perShow=function(e){var t=e.moduleId;this.curNum=e.curNum,this.maxNum=e.maxNum,this.hasBuyNum=e.hasBuyNum,this.maxBuyNum=e.maxBuyNum,this.buyCB=e.buyCB;var i=e.numLimit;if(i&&this.curNum>=this.maxNum)return Utils.MsgUtils.addMidMsg("次数已达上限"),!1;if(!this.maxBuyNum||this.hasBuyNum<this.maxBuyNum){this.targetConfig=[];var n=u.Config.publicBuyCostConfig();for(var o in n){var a=n[o];a.costs=JSON.parse(a.costs),a.type==t&&(this.targetConfig[a.num]=a)}if(!this.targetConfig.length)return Utils.MsgUtils.addMidMsg("无配置"),!1;var r=u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N);this.resourceInfo=r.getInfoByCode(JSON.parse(this.targetConfig[1].costs)[0][1]);for(var s=0,c=this.resourceInfo.haveNum;;){var l=!1,h=this.targetConfig[this.hasBuyNum+s+1];h||(h=this.targetConfig[this.targetConfig.length-1],l=!0);var p=h.costs[0][2];if(c<p)break;var d=!1;if(l?(s+=Math.floor(c/p),d=!0):(s+=1,c-=p),this.maxBuyNum&&this.hasBuyNum+s>=this.maxBuyNum&&(s=Math.min(this.maxBuyNum-this.hasBuyNum,s),d=!0),i&&this.maxNum&&this.curNum+s==this.maxNum&&(s=Math.min(this.maxNum-this.curNum,s),d=!0),d)break}return this.maxBuyNum=s,!0}return Utils.MsgUtils.addMidMsg("无购买次数"),!1},e.prototype.updateView=function(e){this.setValueTo(1)},e.prototype.setValueTo=function(e){e>this.maxBuyNum&&(e=this.maxBuyNum),e<1&&(e=1),this.lb_num.text=e.toString(),this.updateTips()},e.prototype.updateTips=function(){if(!this.gp_tips.$children.length){var e=new eui.Label,t=new eui.Label;e.size=t.size=24,e.textColor=t.textColor=7491637,e.text="确定消耗";var i=new eui.Image(ResourceUtils.png(this.resourceInfo.info.icon));i.width=i.height=u.GeneralConfig.fixedSizeWH,this.gp_tips.addChild(e),this.gp_tips.addChild(i),this.gp_tips.addChild(t)}var n=this.gp_tips.$children[2],o=this.calPrice(Number(this.lb_num.text));n.text="x"+o+"，购买一次挑战次数？"},e.prototype.calPrice=function(e){for(var t=0,i=0;i<e;){var n=!1,o=this.targetConfig[this.hasBuyNum+i+1];o||(o=this.targetConfig[this.targetConfig.length-1],n=!0);var a=o.costs[0][2];if(n){t+=(e-i)*a;break}t+=a,i+=1}return t},e.prototype.activateComponent=function(){var e=this;this.lb_num.addEventListener(egret.Event.CHANGE,function(){Number(e.lb_num.text)>e.maxBuyNum&&(e.lb_num.text=e.maxBuyNum.toString()),e.updateTips()},this),this.lb_num.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){""!=e.lb_num.text&&Number(e.lb_num.text)||e.setValueTo(1)},this),Utils.TouchUtils.addTouchListener(this.btn_min,function(){e.setValueTo(Number(e.lb_num.text)-10)}),Utils.TouchUtils.addTouchListener(this.btn_sub,function(){e.setValueTo(Number(e.lb_num.text)-1)}),Utils.TouchUtils.addTouchListener(this.btn_add,function(){e.setValueTo(Number(e.lb_num.text)+1)}),Utils.TouchUtils.addTouchListener(this.btn_max,function(){e.setValueTo(Number(e.lb_num.text)+10)}),Utils.TouchUtils.addTouchListener(this.btn_cancle,function(){e.hide()}),Utils.TouchUtils.addTouchListener(this.btn_confirm,function(){e.hide(),e.buyCB(Number(e.lb_num.text))})},e}(BasePanel);u.CommonBuyTimesPanel=e,__reflect(e.prototype,"game.CommonBuyTimesPanel")}(game||(game={})),function(o){var e=function(t){function e(){var e=t.call(this)||this;return e.viewClosed=!1,e.skinName="CommonMopUpSkin",e.recordsQueue=[],e.showedRecords=[],e.curTimes=0,e}return __extends(e,t),e.prototype.updateView=function(e){this.pb1=e.pb1,this.pb2=e.pb2,this.params=e.params||{},this.mopUpTimes=e.mopUpTimes,this.cb=e.cb,this.tipsFunc=e.tipsFunc,this.pullMopUpResult()},e.prototype.pullMopUpResult=function(){var i=this;this.data=void 0,Utils.Socket.send(this.pb1,this.pb2,this.params).then(function(e){i.mopUpTimes&&(i.mopUpTimes-=1),i.data=e;var t=i.data.records;i.recordsQueue=i.recordsQueue.concat(t),i.startRolling(function(){if((null==i.mopUpTimes||0<i.mopUpTimes)&&1==i.showedRecords[i.showedRecords.length-1].result){var e=!i.cb;e||(e=i.cb(i.data),i.data=void 0),e&&i.pullMopUpResult()}})})},e.prototype.startRolling=function(t){var i=this;if(this.recordsQueue.length){this.curTimes+=1;var e=this.recordsQueue.shift();this.showedRecords.push(e);var n=new a(e);n.lb_tips.text=this.tipsFunc(this.curTimes),this.gp_records.addChild(n),egret.Tween.get(this.scl.viewport).wait(100).call(function(){if(!i.viewClosed){i.scl.validateNow();var e=i.scl.viewport.contentHeight-i.scl.height;e<0&&(e=0),egret.Tween.get(i.scl.viewport).to({scrollV:e},250).wait(250).call(function(){i.startRolling(t)})}})}else t()},e.prototype.perClose=function(){this.viewClosed=!0,egret.Tween.removeTweens(this.scl.viewport),this.data&&this.cb&&this.cb(this.data)},e}(BasePanel);o.CommonMopUpPanel=e,__reflect(e.prototype,"game.CommonMopUpPanel");var t=function(t){function e(){var e=t.call(this)||this;return e.firstIn=!0,e.rolling=!1,e.battleOver=!1,e.skinName="CommonContinuousBattleSkin",e.showedRecords=[],e.curTimes=0,e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.gp_touchFeild,egret.TouchEvent.TOUCH_TAP,function(){e.battleOver?e.hide():Utils.MsgUtils.addMidMsg("请等待战斗结束")},this)},e.prototype.updateView=function(e){e&&e.tipsFunc&&(this.tipsFunc=e.tipsFunc),this.startRolling()},e.prototype.startRolling=function(){var t=this;if(!this.rolling){var e=o.GameMVC.commonMed.battleResultCache;if(e.length){this.rolling=!0,this.curTimes+=1;var i=e.shift();this.showedRecords.push(i);var n=new r(i);n.lb_tips.text=this.tipsFunc(this.curTimes),this.gp_records.addChild(n),egret.Tween.get(this.scl.viewport).wait(100).call(function(){t.scl.validateNow();var e=t.scl.viewport.contentHeight-t.scl.height;e<0&&(e=0),egret.Tween.get(t.scl.viewport).to({scrollV:e},250).wait(250).call(function(){t.rolling=!1,0==i.attackEntity.blood||0==i.defenceEntity.blood?(t.battleOver=!0,Utils.MsgUtils.addMidMsg("战斗结束")):t.startRolling()})})}}},e.prototype.perClose=function(){egret.Tween.removeTweens(this.scl.viewport)},e}(BasePanel);o.CommonContinuousBattlePanel=t,__reflect(t.prototype,"game.CommonContinuousBattlePanel");var a=function(i){function e(e){var t=i.call(this)||this;return t.skinName="CommonMopUpPanel_MopUpItem",t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.update()},e.prototype.update=function(){var i=this;this.img_result.source=1==this.data.result?"yxdyz_img_shengli_png":"yxdyz_img_zhanban_png";var e=o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N).playerInfoVO;this.gp_self.addChild(this.makeInfoGroup(e,!0)),this.gp_enemy.addChild(this.makeInfoGroup(this.data.baseInfo,!1)),this.data.rewardShow.length?this.data.rewardShow.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData(e),i.gp_rewardsItem.addChild(t)}):this.gp_content.removeChild(this.gp_rewards)},e.prototype.makeInfoGroup=function(e,t){var i=new eui.Group;i.width=240,i.height=82;var n=customui.PlayerHeadFactory.create();n.scaleX=n.scaleY=.7,n.updateData({vo:e}),i.addChild(n);var o=new eui.Label;o.textColor=15913814,o.size=20,o.text=e.name,i.addChild(o);var a=new customui.CommonFightCapItem;return a.scaleX=a.scaleY=.7,a.update(e.fightCap),i.addChild(a),t?(n.x=n.y=6,o.x=87,o.y=13,a.x=90,a.y=50):(n.x=166,n.y=6,o.right=84,o.y=13,a.x=31,a.y=51),i},e}(eui.Component);__reflect(a.prototype,"CommonMopUpPanel_MopUpItem");var r=function(i){function e(e){var t=i.call(this)||this;return t.skinName="CommonContinuousBattlePanel_BattleItem",t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.playerHead_self=customui.PlayerHeadFactory.create(),this.gp_avatar_self.addChild(this.playerHead_self),this.playerHead_oppo=customui.PlayerHeadFactory.create(),this.gp_avatar_oppo.addChild(this.playerHead_oppo),Utils.ComponentUtils.registerListener(this.btn_review,egret.TouchEvent.TOUCH_TAP,function(){o.GameMVC.fightPy.BattlePlayBack(e.data.uuid)},this),this.update()},e.prototype.update=function(){this.img_result.source=this.data.win==EBattleResult.EBattleResultWin?"yxdyz_img_shengli_png":"yxdyz_img_zhanban_png";var e=this.data.attackEntity,t=this.data.defenceEntity;if(this.playerHead_self.updateData({vo:e.baseInfo}),this.playerHead_oppo.updateData({vo:t.baseInfo}),this.lb_name_self.text=e.baseInfo.name,this.lb_name_oppo.text=t.baseInfo.name,this.fightCap_self.update(e.baseInfo.fightCap),this.fightCap_oppo.update(t.baseInfo.fightCap,!0),this.blb_lost_self.text="-"+e.decreaseBlood+"(剩余"+e.blood+")",this.blb_lost_oppo.text="-"+t.decreaseBlood+"(剩余"+t.blood+")",this.data&&this.data.battleRecord){var i=JSON.parse(this.data.battleRecord.keyStr),n=JSON.parse(this.data.battleRecord.tKeyStr);this.blb_score_l.text="+"+(i.newIntegral-i.oldIntegral)+"("+i.newIntegral+")",this.blb_score_r.text="+"+(n.newIntegral-n.oldIntegral)+"("+n.newIntegral+")"}else this.blb_score_l.text="",this.blb_score_r.text=""},e}(eui.Component);__reflect(r.prototype,"CommonContinuousBattlePanel_BattleItem")}(game||(game={})),function(y){var e=function(t){function a(){var e=t.call(this)||this;return e.rewardArr=[],e.REWARD_NAME=["rewards","heros","heroEquips","heroArtifacts","pets","maps","vestageHeros"],e.skinName="CommonRewardPreviewPanelSkin",e}return __extends(a,t),a.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.autoClose=egret.setTimeout(function(){e.hide()},this,3e3),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),DragonBoneTools.create("common_huodewupin",function(e){e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2+45,e.animation.play(),this.gp_effect.addChild(e)},this)},a.prototype.updateView=function(g){var f=this,e=g&&g.type&&g.type.type||a.REWARD_TYPE.REWARD.type;1==e&&Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_dianjin);var t=g&&g.type&&g.type.title||a.REWARD_TYPE.REWARD.title;RES.getResAsync(t,function(e){f.img_tilte.source=e},this),g.top_tips?(this.lb_top_tips.text=g.top_tips,this.lb_top_tips.visible=!0):this.lb_top_tips.visible=!1,g.bottom_tips?(this.lb_bottom_tips.text=g.bottom_tips,this.lb_bottom_tips.visible=!0):this.lb_bottom_tips.visible=!1,g.lb_top_text?(this.lb_top_text.text=g.lb_top_text,this.lb_top_text.visible=!0):this.lb_top_text.visible=!1,g.bottom_tips_offsetY&&(this.lb_bottom_tips.bottom+=g.bottom_tips_offsetY),this.onCloseCB=g.onCloseCB;var _=g.rewards;Array.isArray(_)&&(_={rewards:_}),this.reward_0.removeChildren(),this.rewardNum=0;var m=[];switch(e){case a.REWARD_TYPE.REWARD.type:this.REWARD_NAME.forEach(function(e){var t=_[e]||[];for(var i in t){var n=t[i],o=0,a=0,r=0,s="";switch(e){case"rewards":a=n.type||n[0],o=n.code||n[1],r=n.num||n[2];break;case"heros":s=n.uuid,a=EEntityType.EEntityTypeHero;break;case"vestageHeros":s=n.uuid,a=EEntityType.EEntityTypeVestageHero,y.GameMVC.dungeonPy.hasNewHeroGet=!0;break;case"heroEquips":o=n.code||n[1],a=EEntityType.EEntityTypeHeroEquip,r=n.num;break;case"heroArtifacts":o=n.code||n[1],a=EEntityType.EEntityTypeHeroArtifact,r=n.num;break;case"maps":s=n.uuid,a=EEntityType.EEntityTypeMap}if(g&&"Compound"==g.action){if(!n.code)return;for(var c={num:1,vo:n},l=!0,h=0,p=m;h<p.length;h++){var d=p[h];if(d.vo.code==c.vo.code){l=!1,++d.num;break}}l&&(m.push(c),++f.rewardNum)}else{var u=""!=s?{uuid:s,type:a}:{type:a,code:o,num:r};"heroEquips"!=e&&"heroArtifacts"!=e||(u={type:a,code:o,num:r}),m.push(u),++f.rewardNum}}});break;case a.REWARD_TYPE.OBTAIN.type:if(this.REWARD_NAME.forEach(function(e){var t=_[e]||[];0<t.length&&t.forEach(function(e){var t={type:e.type||e[0],code:e.code||e[1],num:e.num||e[2]||1};m.push(t),++f.rewardNum})}),_.isArray&&0==this.rewardNum&&0<_.length)(_||[]).forEach(function(e){var t={type:e.type||e[0],code:e.code||e[1],num:e.num||e[2]||1};m.push(t),++f.rewardNum})}var i=5<this.rewardNum?5:this.rewardNum,n=4<Math.ceil(this.rewardNum/5)?4:Math.ceil(this.rewardNum/5);5<this.rewardNum&&(this.gp_root.height=this.gp_root.height+84*(n-1));var o=new eui.ArrayCollection(m);this.reward_1.itemRenderer=r,this.reward_1.dataProvider=o,this.sl_reward.width=84*i+10*(i-1),this.sl_reward.height=84*n+10*(n-1),this.sl_reward.x=(this.gp_root.width-this.sl_reward.width)/2,this.sl_reward.y=(this.gp_root.height-this.sl_reward.height)/2+50},a.prototype.perShow=function(e){var i=e.rewards;Array.isArray(i)&&(i={rewards:i});var n=0;return this.REWARD_NAME.forEach(function(e){var t=i[e]||[];n+=t.length}),0!=n},a.prototype.perClose=function(){egret.clearTimeout(this.autoClose),this.onCloseCB&&this.onCloseCB(this.opperationParams),y.AppFacade.getInstance().sendNotification(CN.ACTIVITY_SHOW_TRIGGER),y.AppFacade.getInstance().sendNotification(CN.REWARD_CLOSE),y.AppFacade.getInstance().sendNotification(CN.SHOW_WECHAT_SHARE,{filter:!0}),y.AppFacade.getInstance().sendNotification(CN.NEWBRAVEBOOK_LEVEL_UPDATE,{LevelEffect:!0})},a.REWARD_TYPE={REWARD:{type:1,title:"hdwp_txt_huodewupin_png"},OBTAIN:{type:2,title:"hdwp_txt_wupinyulan_png"}},a}(BasePanel);y.CommonRewardPreviewPanel=e,__reflect(e.prototype,"game.CommonRewardPreviewPanel");var t=function(i){function e(e){var t=i.call(this)||this;return t.skinName="BaseItemWithNumSkin",t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.blb_num.visible=!1,this.gp_baseItem.addChild(this.baseItem),this.data&&this.update(this.data)},e.prototype.update=function(e){this.data=e,this.baseItem.updateData(this.data),this.blb_num.text="x"+(this.data.num||1)},e}(eui.Component);__reflect(t.prototype,"BaseItemWithNum");var r=function(t){function e(){var e=t.call(this)||this;return e.skinName="BaseItemRenderSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.baseItem_1.updateData(this.data)},e}(eui.ItemRenderer);__reflect(r.prototype,"BaseItemRender")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.gp_root=new eui.Group,this.gp_root.width=Utils.DeviceUtils.curWidth(),this.gp_root.height=Utils.DeviceUtils.curHeight(),this.addChild(this.gp_root),this.rollDice()},e.prototype.rollDice=function(){var t=this,i=this.data.num;DragonBoneTools.playOnce({effectName:"common_toushaizi",parent:this.gp_root,y:this.gp_root.height/2+80,doneCB:function(){var e=new eui.Image("touzi_"+i+"_png");e.horizontalCenter=e.verticalCenter=0,t.gp_root.addChild(e),egret.setTimeout(function(){t.hide()},t,1e3)}})},e}(BasePanel);e.CommonRollDicePanel=t,__reflect(t.prototype,"game.CommonRollDicePanel")}(game||(game={})),function(l){var e=function(o){function e(){var e,t=o.call(this)||this;return t.backProxy=l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N),t.dpProxy=l.AppFacade.getInstance().retrieveProxy(l.DeepNestPy.N),t.playerProxy=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),t.heroProxy=l.AppFacade.getInstance().retrieveProxy(l.HeroPy.N),t.petProxy=l.AppFacade.getInstance().retrieveProxy(l.PetPy.N),t.artProxy=l.AppFacade.getInstance().retrieveProxy(l.MagicalArtifactPy.N),t.allHeroInfo=[],t.chooseHeroPage=0,t.maxHeroPage=0,t.heroList1=[],t.heroList2=[],t.heroList3=[],t.isChanging=!1,t.dataprovider=new eui.ArrayCollection,t.petList=[],t.artList=[],t.ITEM_TYPE_CONFIG=((e={})[l.BackpackUI.ITEM_TYPE.HERO]={desc:"英雄",hasHankBook:!0,barSource:{up:"_btn_yq_m_json.beibao_yeqian_yingxiong_0",down:"_btn_yq_m_json.beibao_yeqian_yingxiong_1"},getAllInfo:function(){var e=[],t=l.AppFacade.getInstance().retrieveProxy(l.HeroPy.N);for(var i in t.allHeroByUuid){var n=t.allHeroByUuid[i];0==n.config.race&&0==n.config.profession||e.push(n)}return e},filterConfig:{data:[[{race:HeroRaceType.Human,icon:HeroRaceConfig[HeroRaceType.Human].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Elf,icon:HeroRaceConfig[HeroRaceType.Elf].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Orc,icon:HeroRaceConfig[HeroRaceType.Orc].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Athanasy,icon:HeroRaceConfig[HeroRaceType.Athanasy].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Demon,icon:HeroRaceConfig[HeroRaceType.Demon].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Eldar,icon:HeroRaceConfig[HeroRaceType.Eldar].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"}]],filterFunc:function(e,t){var i=!e.race||0==e.race.length||-1!=e.race.indexOf(t.config.race),n=!e.star||0==e.star.length||-1!=e.star.indexOf(t.starLevel);return i&&n},addFilter:function(e,t){var i=t.race?"race":"star";e[i]||(e[i]=[]);var n=e[i].indexOf(t[i]);-1==n?(e[i].splice(0),e[i].push(t[i])):e[i].splice(n,1)},autoFilterFunc:function(e,t){return e.starLevel<=4},autoFilterTipsFunc:function(e){return"无五星以下英雄"}},sortConfig:{data:[{desc:"等级"},{desc:"星级"}],getSortFunc:function(e){switch(e){case 0:return function(e,t){return t.info.level-e.info.level};case 1:return function(e,t){return t.info.starLevel-e.info.starLevel};default:return function(){return-1}}},defaultSortFunc:function(e,t){var i=e.info,n=t.info;if(i.starLevel!=n.starLevel)return n.starLevel-i.starLevel;if(i.level!=n.level)return n.level-i.level;var o=l.Config.allHeroConfig()[i.code],a=l.Config.allHeroConfig()[n.code];return o.race!=a.race?o.race-a.race:o.profession!=a.profession?HERO_SORT_ORDER[a.profession]-HERO_SORT_ORDER[o.profession]:i.code-n.code}}},e),t.skinName="CommonTeamChoosePanelSkin",t.pos2HeroBI={},t.curFilter={},t}return __extends(e,o),e.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.initFilter(),this.initBtnListener(),this.addListener(),this.chooseHeroPage=0,this.heroList1=[],this.heroList2=[],this.heroList3=[];for(var e=DEEP_NEST_CONST.SHANGZHEN_LINE*DEEP_NEST_CONST.HERO_COUNT,t=1;t<=e;t++){var i=customui.BaseItemFactory.create();this.pos2HeroBI[t]=i,this.pos2HeroBI[t].indexNum=t,this.pos2HeroBI[t].resetFixedStyle(EEntityType.EEntityTypeHero);var n=this.pos2XY(t);i.x=n[0],i.y=n[1],i.scaleX=18<t?.9:.7,i.scaleY=18<t?.9:.7,this.gp_heroList.addChild(i),0<t&&t<7?this.heroList1.push(i):7<=t&&t<13?this.heroList2.push(i):13<=t&&t<19&&this.heroList3.push(i)}this.petList=["","",""],this.artList=["","",""]},e.prototype.initBtnListener=function(){var t=this;this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.getUpHeroList();if(this.params.touchHoldCB){var t=this.params.touchHoldCB(e);t&&this.backProxy.ChangeFormation({type:this.params.module,teams:t},this.hide.bind(this))}else this.backProxy.ChangeFormation({type:this.params.module,teams:e},this.hide.bind(this))},this),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.getUpHeroList();if(this.params.touchHoldCB){var t=this.params.touchHoldCB(e);t&&this.backProxy.ChangeFormation({type:this.params.module,teams:t},this.hide.bind(this))}else this.backProxy.ChangeFormation({type:this.params.module,teams:e},this.hide.bind(this))},this),this.gp_up_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.changeOrderAbove(0)},this),this.gp_up_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.changeOrderAbove(1)},this),this.gp_choosePet_0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){l.AppFacade.getInstance().showSubView(l.CommonMediator.N,l.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypePet,team:1,list:t.petList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.gp_choosePet_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){l.AppFacade.getInstance().showSubView(l.CommonMediator.N,l.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypePet,team:2,list:t.petList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.gp_choosePet_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){l.AppFacade.getInstance().showSubView(l.CommonMediator.N,l.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypePet,team:3,list:t.petList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.gp_chooseArt_0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){l.AppFacade.getInstance().showSubView(l.CommonMediator.N,l.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypeMagical,team:1,list:t.artList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.gp_chooseArt_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){l.AppFacade.getInstance().showSubView(l.CommonMediator.N,l.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypeMagical,team:2,list:t.artList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.gp_chooseArt_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){l.AppFacade.getInstance().showSubView(l.CommonMediator.N,l.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypeMagical,team:3,list:t.artList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.btn_helo.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){},this),this.btn_pet.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){l.AppFacade.getInstance().showSubView(l.CommonMediator.N,l.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypePet,team:0,list:t.petList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.btn_art.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){l.AppFacade.getInstance().showSubView(l.CommonMediator.N,l.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypeMagical,team:0,list:t.artList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.btn_filter.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_filters.visible=!0;var e=this.gp_filter.globalToLocal(0,0),t=new egret.Sprite;t.touchEnabled=!0,t.graphics.beginFill(0,0),t.graphics.drawRect(e.x,e.y,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),t.graphics.endFill(),this.gp_filter.addChildAt(t,2),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.gp_filters.visible=!1,t.parent&&t.parent.removeChild(t)},this)},this)},e.prototype.initFilter=function(){var n=this;this.gp_filters_list.removeChildren();var e=this.ITEM_TYPE_CONFIG[l.BackpackUI.ITEM_TYPE.HERO].filterConfig.data;e&&0<e.length?(this.gp_filter.visible=!0,e.forEach(function(e){var t=new eui.List;t.itemRenderer=l.DecomposeUI_FilterItem;var i=new eui.HorizontalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER,t.layout=i,t.dataProvider=new eui.ArrayCollection(e),t.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.filterItem_onItemTap,n),n.gp_filters_list.addChild(t)}),this.gp_filters.height=42*e.length+20*(e.length-1)+40):this.gp_filter.visible=!1},e.prototype.filterItem_onItemTap=function(e){var t=e.itemRenderer;if(this.ITEM_TYPE_CONFIG[l.BackpackUI.ITEM_TYPE.HERO].filterConfig.addFilter(this.curFilter,e.item),!t.chosen)for(var i=0,n=this.gp_filters_list.$children;i<n.length;i++){var o=n[i];if(-1!=o.$children.indexOf(t))for(var a=0,r=o.$children;a<r.length;a++){var s=r[a];s.chosen&&s.setChosen(!1)}}t.setChosen(!t.chosen),this.updateAllHero()},e.prototype.addListener=function(){this.gp_touchField.touchChildren=!0,this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},e.prototype.removeListener=function(){this.gp_touchField.touchChildren=!1,this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},e.prototype.updateView=function(e){this.params=e,this.updateAllHeroList(),this.updateUpHero(),this.updateAllHero(),this.updatePetAndArtList(),this.lb_tips.visible=this.params.tips,this.params.tips&&(this.lb_tips.text=this.params.tips)},e.prototype.updateUpHero=function(){var e=this.backProxy.getModuleTeam(this.params.module);if(e&&e.teams){for(var t=e.teams,i=1;i<=18;i++)this.pos2HeroBI[i].resetFixedStyle(EEntityType.EEntityTypeHero);for(var n in t)for(var i in t[n].heros){var o=t[n].heros[i].battlePos,a=t[n].heros[i].uuid,r=o+6*(t[n].teamNo-1),s=this.heroProxy.allHeroByUuid[a];if(s){var c=0==s.dermaCode?void 0:l.Config.getHeroDermaConfig()[s.dermaCode].avatar;this.pos2HeroBI[r].updateData({vo:s,type:EEntityType.EEntityTypeHero,avatar:c})}}}},e.prototype.updateAllHeroList=function(){this.allHeroInfo=[];var e=this.ITEM_TYPE_CONFIG[l.BackpackUI.ITEM_TYPE.HERO].getAllInfo();if(e)for(var t in e){var i=e[t];this.allHeroInfo.push({type:l.BackpackUI.ITEM_TYPE.HERO,info:i,teamNum:this.judgeUpTeam(i.uuid),touchCB:this.touchHeroEvent.bind(this)})}},e.prototype.updateAllHero=function(){this.scroller_hero.stopAnimation();var e=[],t=this.ITEM_TYPE_CONFIG[l.BackpackUI.ITEM_TYPE.HERO],i=t.filterConfig&&t.filterConfig.filterFunc||function(){return!0},n=t.sortConfig&&t.sortConfig.defaultSortFunc,o=t.getAllInfo();if(o)for(var a in o){var r=o[a];i(this.curFilter,r)&&e.push({type:l.BackpackUI.ITEM_TYPE.HERO,info:r,teamNum:this.judgeUpTeam(r.uuid),touchCB:this.touchHeroEvent.bind(this)})}0<e.length&&n&&e.sort(n),this.dataprovider=new eui.ArrayCollection(e),this.list_hero.itemRenderer=s,this.list_hero.dataProvider=this.dataprovider},e.prototype.updatePetAndArtList=function(){var e=this.backProxy.getModuleTeam(this.params.module);if(e&&e.teams){for(var t=e.teams,i=0;i<t.length;i++){this.petList[i]=t[i].petUuid?t[i].petUuid:"",this.artList[i]=t[i].magicalUuid?t[i].magicalUuid:""}this.updatePetAndArtInfo()}},e.prototype.updatePetAndArtInfo=function(){this.img_usePet_0.visible=!1,this.img_usePet_1.visible=!1,this.img_usePet_2.visible=!1,this.img_useArt_0.visible=!1,this.img_useArt_1.visible=!1,this.img_useArt_2.visible=!1,this.img_addpet_0.visible=!0,this.img_addpet_1.visible=!0,this.img_addpet_2.visible=!0,this.img_addart_0.visible=!0,this.img_addart_1.visible=!0,this.img_addart_2.visible=!0;for(var e=0;e<3;e++){var t=void 0,i=void 0,n=this.petList[e],o=this.artList[e];""!=n&&(t=this.petProxy.allPetByUuid[n]),""!=o&&(i=this.artProxy.allMagicalArtifactByUuid[o]),0==e?(t&&(this.img_addpet_0.visible=!1,this.img_usePet_0.visible=!0,this.img_usePet_0.source=t.config.avatar+"_png"),i&&(this.img_addart_0.visible=!1,this.img_useArt_0.visible=!0,this.img_useArt_0.source=i.config.model+"_png")):1==e?(t&&(this.img_addpet_1.visible=!1,this.img_usePet_1.visible=!0,this.img_usePet_1.source=t.config.avatar+"_png"),i&&(this.img_addart_1.visible=!1,this.img_useArt_1.visible=!0,this.img_useArt_1.source=i.config.model+"_png")):2==e&&(t&&(this.img_addpet_2.visible=!1,this.img_usePet_2.visible=!0,this.img_usePet_2.source=t.config.avatar+"_png"),i&&(this.img_addart_2.visible=!1,this.img_useArt_2.visible=!0,this.img_useArt_2.source=i.config.model+"_png"))}},e.prototype.updatePetOrArtUuidByChoose=function(e,t){e==EEntityType.EEntityTypeMagical?this.artList=t:e==EEntityType.EEntityTypePet&&(this.petList=t),this.updatePetAndArtInfo()},e.prototype.judgeUpTeam=function(e){for(var t=0,i=1;i<19;i++)this.pos2HeroBI[i].vo&&this.pos2HeroBI[i].vo.uuid&&this.pos2HeroBI[i].vo.uuid==e&&(1<=i&&i<=6?t=1:7<=i&&i<=12?t=2:12<=i&&i<=18&&(t=3));return t},e.prototype.pos2XY=function(e){var t,i;t=Math.ceil((e-6)/DEEP_NEST_CONST.HERO_COUNT),i=(e-1)%DEEP_NEST_CONST.HERO_COUNT;var n=0,o=0,a=0;return t<3?(o=2<i?45:15,n=75):(n=100,o=25),0==t?a=48:1==t?a=67:2==t&&(a=82),[i*n+o,100*t+(2<t?120:a)]},e.prototype.getUpHeroList=function(){for(var e=[],t={heros:[],petUuid:this.petList[0],magicalUuid:this.artList[0],teamNo:1},i={heros:[],petUuid:this.petList[1],magicalUuid:this.artList[1],teamNo:2},n={heros:[],petUuid:this.petList[2],magicalUuid:this.artList[2],teamNo:3},o=1;o<=6;o++)if(this.pos2HeroBI[o].vo&&this.pos2HeroBI[o].vo.uuid){var a={uuid:this.pos2HeroBI[o].vo.uuid,battlePos:(o-1)%DEEP_NEST_CONST.HERO_COUNT+1};t.heros.push(a)}for(o=7;o<=12;o++)if(this.pos2HeroBI[o].vo&&this.pos2HeroBI[o].vo.uuid){a={uuid:this.pos2HeroBI[o].vo.uuid,battlePos:(o-1)%DEEP_NEST_CONST.HERO_COUNT+1};i.heros.push(a)}for(o=13;o<=18;o++)if(this.pos2HeroBI[o].vo&&this.pos2HeroBI[o].vo.uuid){a={uuid:this.pos2HeroBI[o].vo.uuid,battlePos:(o-1)%DEEP_NEST_CONST.HERO_COUNT+1};n.heros.push(a)}return e.push(t),e.push(i),e.push(n),e},e.prototype.getTouchedGroupPos=function(e){for(var t in this.pos2HeroBI){var i=this.pos2HeroBI[t];if(i!=this.targetItem){var n=i.localToGlobal();if(this.rect?this.rect.setTo(n.x,n.y,i.width,i.height):this.rect=new egret.Rectangle(n.x,n.y,i.width,i.height),this.rect.contains(e.stageX,e.stageY))return t}}},e.prototype.onTouchBegin=function(e){var t=this.getTouchedGroupPos(e);if(t&&this.pos2HeroBI[t]){if(this.targetItem=this.pos2HeroBI[t],!this.targetItem.vo)return void(this.targetItem=void 0);this.targetItemTouchTM=Date.now(),this.gp_heroList.setChildIndex(this.targetItem,-1),this.startingPos=t,this.gp_touchField.width=Utils.DeviceUtils.curWidth(),this.gp_touchField.height=Utils.DeviceUtils.curHeight()}},e.prototype.onTouchMove=function(e){this.targetItem&&this.setModelToXY(this.targetItem,e.stageX,e.stageY)},e.prototype.onTouchEnd=function(e){if(this.targetItem){var t=this.getTouchedGroupPos(e);Date.now()-this.targetItemTouchTM<DEEP_NEST_CONST.TOUCH_TIME?this.heroDownByteam(this.targetItem,this.startingPos):t?this.setHeroToPos(this.targetItem,t):this.heroDownByteam(this.targetItem,this.startingPos),this.targetItem=void 0,this.startingPos=void 0,this.gp_touchField.width=this.gp_heroList.width,this.gp_touchField.height=this.gp_heroList.height}},e.prototype.setHeroToPos=function(e,t,i){if(void 0===i&&(i=!1),e){this.pos2HeroBI[this.startingPos]=void 0,this.startingPos&&this.startingPos!=t&&this.pos2HeroBI[t]&&this.setHeroToPos(this.pos2HeroBI[t],this.startingPos,!0),this.pos2HeroBI[t]=e;var n=this.pos2XY(t);e.x=n[0],e.y=n[1],e.scaleX=18<Number(t)?.9:.7,e.scaleY=18<Number(t)?.9:.7,i||this.updateAllHero()}},e.prototype.setModelToXY=function(e,t,i){var n=-e.width*e.scaleX/2,o=-e.height*e.scaleY/2;e.x=(t-e.parent.x-this.gp_root.x+n)/Utils.DeviceUtils.additionScale(),e.y=(i-e.parent.y-this.gp_root.y+o)/Utils.DeviceUtils.additionScale()},e.prototype.heroDownByteam=function(e,t){for(var i in this.allHeroInfo)if(e.vo.uuid==this.allHeroInfo[i].info.uuid){for(var n in this.dataprovider.source){var o=this.list_hero.getVirtualElementAt(Number(n)),a=this.dataprovider.getItemAt(Number(n));if(a.info.uuid==e.vo.uuid&&o&&o.img_bg&&o.img_bg.visible){o.img_bg.visible=!1,a.isUp=!1,a.teamNum=0,UIActionManager.setGrey(o.gp_bi,!1);break}}var r=this.pos2XY(t);e.x=r[0],e.y=r[1],e.resetFixedStyle(EEntityType.EEntityTypeHero);break}},e.prototype.changeOrderAbove=function(e){var t=this;if(!this.isChanging){this.isChanging=!0;var i=6*e+1,n=i+6;this.btn_up_1.touchEnabled=!0,this.btn_up_2.touchEnabled=!0;for(var o=i;o<n;o++){var a=o+6;this.startingPos=a+"";var r=o+"";this.setHeroToPos(this.pos2HeroBI[a],r)}this.changePetAndArt(e,e+1),this.updateAllHero(),egret.Tween.get(this.gp_root).wait(250).call(function(){t.isChanging=!1,t.startingPos=void 0,t.btn_up_1.touchEnabled=!1,t.btn_up_2.touchEnabled=!1})}},e.prototype.changePetAndArt=function(e,t){var i=this.petList[e];this.petList[e]=this.petList[t],this.petList[t]=i;var n=this.artList[e];this.artList[e]=this.artList[t],this.artList[t]=n,this.updatePetAndArtInfo()},e.prototype.touchHeroEvent=function(e,t,i){if(e){for(var n=0,o=1;o<=18;o++)if(!this.pos2HeroBI[o].vo){n=o;break}if(0==n)Utils.MsgUtils.addMidMsg("当前阵容已上满");else{var a=0;1<=n&&n<=6?a=1:7<=n&&n<=12?a=2:12<=n&&n<=18&&(a=3);var r=0==t.info.dermaCode?void 0:l.Config.getHeroDermaConfig()[t.info.dermaCode].avatar;this.pos2HeroBI[n].updateData({vo:t.info,type:EEntityType.EEntityTypeHero,avatar:r}),t.teamNum=a,i&&i()}}else{var s=0;for(o=1;o<=18;o++)if(this.pos2HeroBI[o].vo&&this.pos2HeroBI[o].vo.uuid==t.info.uuid){s=o;break}0!=s&&(this.pos2HeroBI[s].resetFixedStyle(EEntityType.EEntityTypeHero),t.teamNum=0,i&&i())}},e.prototype.perClose=function(){this.params.doneCB&&this.params.doneCB()},e}(BasePanel);l.CommonTeamChoosePanel=e,__reflect(e.prototype,"game.CommonTeamChoosePanel");var s=function(t){function e(){var e=t.call(this)||this;return e.CHOOSE_NUM=["sycx_txt_yi1_png","sycx_txt_er1_png","sycx_txt_sani1_png"],e.skinName="CommonTeamHeroItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.scaleX=this.baseItem.scaleY=.85,this.img_bg.scaleX=this.img_bg.scaleY=.6,this.gp_bi.addChild(this.baseItem),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.touchCB&&this.data.touchCB(!this.img_bg.visible,this.data,this.changeIsUp.bind(this))},this)},e.prototype.dataChanged=function(){var e=this.data,t=0==e.info.dermaCode?void 0:l.Config.getHeroDermaConfig()[e.info.dermaCode].avatar;this.baseItem.updateData({uuid:this.data.info.uuid,type:EEntityType.EEntityTypeHero,effect:!1,isShowZhongZhu:!0,avatar:t}),this.img_bg.visible=0!=this.data.teamNum,this.img_bg.visible&&(this.img_bg.source=this.CHOOSE_NUM[this.data.teamNum-1]),UIActionManager.setGrey(this.gp_bi,this.img_bg.visible)},e.prototype.changeIsUp=function(){this.img_bg.visible=!this.img_bg.visible,this.data.isUp=!this.data.isUp,UIActionManager.setGrey(this.gp_bi,this.img_bg.visible),this.img_bg.visible&&(this.img_bg.source=this.CHOOSE_NUM[this.data.teamNum-1])},e}(eui.ItemRenderer);__reflect(s.prototype,"CommonTeamHeroItem")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=i.AppFacade.getInstance().retrieveProxy(i.DeepNestPy.N),e.artProxy=i.AppFacade.getInstance().retrieveProxy(i.MagicalArtifactPy.N),e.petProxy=i.AppFacade.getInstance().retrieveProxy(i.PetPy.N),e.dataprovider=new eui.ArrayCollection,e.chooseNum=0,e.CHOOSE_NUM=["sycx_txt_yi1_png","sycx_txt_er1_png","sycx_txt_sani1_png"],e.skinName="CommonTeamPetAndArtPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.challge_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.params.doneCB&&e.params.doneCB(e.params.type,e.getUpList()),e.hide()},this)},e.prototype.getUpList=function(){var e=["","",""];for(var t in this.dataprovider.source)for(var i=this.list.getVirtualElementAt(Number(t)),n=this.dataprovider.getItemAt(Number(t)),o=0;o<this.CHOOSE_NUM.length;o++)i.img_choose.visible&&i.img_choose.source==this.CHOOSE_NUM[o]&&(e[o]=n.info.uuid);return e},e.prototype.updateView=function(e){var t,i={};(this.params=e).type==EEntityType.EEntityTypePet?(this.lb_text.text="请选择将要出战的宠物",i=this.petProxy.allPetByUuid):e.type==EEntityType.EEntityTypeMagical&&(this.lb_text.text="请选择将要出战的神器",i=this.artProxy.allMagicalArtifactByUuid),t=this.params.list;var n=[],o=0;for(var a in i){for(var r=i[a],s=0,c=0;c<t.length;c++)if(t[c]==a){s=c+1;break}var l={type:e.type,info:r,cb:this.updateChoose.bind(this),index:o,chooseNum:s};n.push(l),o++}0<n.length?(this.dataprovider=new eui.ArrayCollection(n),this.list.itemRenderer=h,this.list.dataProvider=this.dataprovider,this.gp_no.visible=!1):this.gp_no.visible=!0},e.prototype.updateChoose=function(e){if(0==this.params.team){var t=[{num:0,isChoose:!1},{num:0,isChoose:!1},{num:0,isChoose:!1}];for(var i in this.dataprovider.source){if((s=this.list.getVirtualElementAt(Number(i)))&&s.img_choose&&s.img_choose.visible)for(var n in this.CHOOSE_NUM)s.img_choose.source==this.CHOOSE_NUM[n]&&(t[n].num=Number(i),t[n].isChoose=!0);s&&s.img_choose&&s.img_bg&&(UIActionManager.setGrey(s.img_bg,!1),s.img_choose.visible=!1,s.img_choose.source="")}var o=0,a=!1;for(var i in t)if(t[i].isChoose){if(e==t[i].num){t[i].num=0,a=!(t[i].isChoose=!1);continue}o++}if(2<o)1==this.params.type?Utils.MsgUtils.addMidMsg("所有阵容均已上阵宠物"):Utils.MsgUtils.addMidMsg("所有阵容均已上阵神器");else{for(n=0;n<t.length;n++)if(!t[n].isChoose){o=n;break}t[o].isChoose=!a,t[o].num=a?0:e}for(var i in t){var r=this.list.getVirtualElementAt(t[i].num);r&&r.img_choose&&r.img_bg&&t[i].isChoose&&(UIActionManager.setGrey(r.img_bg,!0),r.img_choose.visible=!0,r.img_choose.source=this.CHOOSE_NUM[i])}}else{o=this.params.team-1;var s,c=!1;for(var i in this.dataprovider.source){var l=this.list.getVirtualElementAt(Number(i));if(l&&l.img_choose&&l.img_choose.visible&&l.img_choose.source==this.CHOOSE_NUM[o]){Number(i)==e&&(c=!0),UIActionManager.setGrey(l.img_bg,!1),l.img_choose.visible=!1,l.img_choose.source="";break}}(s=this.list.getVirtualElementAt(Number(e))).img_choose.visible?s.img_choose.source==this.CHOOSE_NUM[o]?(UIActionManager.setGrey(s.img_bg,!1),s.img_choose.visible=!1,s.img_choose.source=""):(UIActionManager.setGrey(s.img_bg,!0),s.img_choose.visible=!0,s.img_choose.source=this.CHOOSE_NUM[o]):c?(UIActionManager.setGrey(s.img_bg,!1),s.img_choose.visible=!1,s.img_choose.source=""):(UIActionManager.setGrey(s.img_bg,!0),s.img_choose.visible=!0,s.img_choose.source=this.CHOOSE_NUM[o])}},e}(BasePanel);i.CommonTeamPetAndArtPanel=e,__reflect(e.prototype,"game.CommonTeamPetAndArtPanel");var h=function(i){function e(){var e=i.call(this)||this;return e.CHOOSE_NUM=["sycx_txt_yi1_png","sycx_txt_er1_png","sycx_txt_sani1_png"],e.skinName="CommonTeamItemSkin",e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.data.cb&&t.data.cb(t.data.index)},this)},e.prototype.dataChanged=function(){var e=this.data;this.img_bg.source=e.type==EEntityType.EEntityTypePet?e.info.config.avatar+"_png":e.info.config.model+"_png",this.img_choose.visible=0!=e.chooseNum,this.img_choose.visible?(this.img_choose.source=this.CHOOSE_NUM[e.chooseNum-1],UIActionManager.setGrey(this.img_bg,!0)):(this.img_choose.source="",UIActionManager.setGrey(this.img_bg,!1))},e}(eui.ItemRenderer);i.CommonTeamItem=h,__reflect(h.prototype,"game.CommonTeamItem")}(game||(game={})),function(n){var e=function(i){function e(e){var t=i.call(this)||this;return t.proxy=n.AppFacade.getInstance().retrieveProxy(n.BackpackPy.N),t.data=e,t.code=e.code,t.skinName="CompoundPanelSkin",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.item=new n.BackpackUI_Item,this.item.touchEnabled=!1,this.gp_item.addChild(this.item),this.targetNum=1,this.btn_compound.label=this.data.btnText||"使用",this.lb_num.visible=!1,this.edt_input.visible=!0,this.activateComponent(),this.updateView()},e.prototype.updateView=function(){var e=n.Config.itemConfig()[this.code];this.lb_name.text=e.name,this.requestNum=e.effectEx||this.data.requestNum,this.num=this.proxy.getItemNumByCode(this.code);var t={type:n.BackpackUI.ITEM_TYPE.ITEM,info:{code:this.code,num:this.num}};this.item.dataChanged(t),this.item.baseItem.touchEnabled=!1,this.setTargetNum(Math.floor(this.num/this.requestNum))},e.prototype.setTargetNum=function(e){e=e||1,this.targetNum=e,this.edt_input.text=e.toString()},e.prototype.activateComponent=function(){var t=this;this.btn_min.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setTargetNum(1)},this),this.btn_max.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=Math.floor(this.num/this.requestNum);this.setTargetNum(e)},this),this.btn_des.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setTargetNum(this.targetNum-1)},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){(this.targetNum+1)*this.requestNum<=this.num&&this.setTargetNum(this.targetNum+1)},this),this.btn_compound.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.num>=this.requestNum*this.targetNum?(this.data.callBack&&this.data.callBack({num:this.targetNum}),this.hide()):Utils.MsgUtils.addMidMsg("资源不足")},this),this.edt_input.addEventListener(egret.Event.CHANGE,function(){var e=Math.floor(t.num/t.requestNum);t.targetNum=Number(t.edt_input.text),t.targetNum>e&&(t.targetNum=e,t.edt_input.text=e.toString(),Utils.MsgUtils.addMidMsg("超过最大数量！"))},this),this.edt_input.addEventListener(egret.Event.FOCUS_OUT,function(){if(!t.edt_input.text.match(/[1-9][0-9]*/gi)){Utils.MsgUtils.addMidMsg("请输入有效数值！");var e=Math.floor(t.num/t.requestNum);t.targetNum=e,t.edt_input.text=e.toString()}},this)},e}(BasePanel);n.SimpleUsePanel=e,__reflect(e.prototype,"game.SimpleUsePanel")}(game||(game={})),function(e){var t=function(){function e(){}return e.FIGHT_FSM_INIT="FIGHT_FSM_INIT",e.FIGHT_WAIT_INIT_PUSH="FIGHT_WAIT_INIT_PUSH",e.FIGHT_START="FIGHT_START",e.FIGHT_END="FIGHT_END",e.ROUND_START="ROUND_START",e.ROUND_END="ROUND_END",e.SEQ_START="SEQ_START",e.SEQ_END="SEQ_END",e.ATTACK_BEFORE="ATTACK_BEFORE",e.ATTACK_ING="ATTACK_ING",e.ATTACK_AFTER="ATTACK_AFTER",e}();e.FightState=t,__reflect(t.prototype,"game.FightState");var i=function(){function e(){}return e.NEXT="NEXT",e.SKIP="SKIP",e.INIT_DONE="INIT_DONE",e.BATTLE_BROADCAST_ARRIVE="BATTLE_BROADCAST_ARRIVE",e.ROUND_ALL_DONE="ROUND_ALL_DONE",e.SEQ_ALL_DONE="SEQ_ALL_DONE",e.FIGHT_ERROR="FIGHT_ERROR",e.RESET_FSM="RESET_FSM",e}();e.FightAction=i,__reflect(i.prototype,"game.FightAction");var n=function(){function e(){}return e.prototype.createFsm=function(){return{"@initial":t.FIGHT_FSM_INIT,state:[{"@name":t.FIGHT_FSM_INIT,transition:[{"@action":i.INIT_DONE,"@target":t.FIGHT_WAIT_INIT_PUSH},{"@action":i.SKIP,"@target":t.FIGHT_END},{"@action":i.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.FIGHT_WAIT_INIT_PUSH,transition:[{"@action":i.BATTLE_BROADCAST_ARRIVE,"@target":t.FIGHT_START},{"@action":i.SKIP,"@target":t.FIGHT_END},{"@action":i.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.FIGHT_START,transition:[{"@action":i.NEXT,"@target":t.ROUND_START},{"@action":i.SKIP,"@target":t.FIGHT_END},{"@action":i.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.FIGHT_END,transition:[{"@action":i.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.ROUND_START,transition:[{"@action":i.NEXT,"@target":t.SEQ_START},{"@action":i.SKIP,"@target":t.FIGHT_END},{"@action":i.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.ROUND_END,transition:[{"@action":i.NEXT,"@target":t.ROUND_START},{"@action":i.ROUND_ALL_DONE,"@target":t.FIGHT_END},{"@action":i.SKIP,"@target":t.FIGHT_END},{"@action":i.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.SEQ_START,transition:[{"@action":i.NEXT,"@target":t.ATTACK_BEFORE},{"@action":i.SKIP,"@target":t.FIGHT_END},{"@action":i.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.SEQ_END,transition:[{"@action":i.NEXT,"@target":t.SEQ_START},{"@action":i.SEQ_ALL_DONE,"@target":t.ROUND_END},{"@action":i.SKIP,"@target":t.FIGHT_END},{"@action":i.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.ATTACK_BEFORE,transition:[{"@action":i.NEXT,"@target":t.ATTACK_ING},{"@action":i.SKIP,"@target":t.FIGHT_END},{"@action":i.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.ATTACK_ING,transition:[{"@action":i.NEXT,"@target":t.ATTACK_AFTER},{"@action":i.SKIP,"@target":t.FIGHT_END},{"@action":i.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]},{"@name":t.ATTACK_AFTER,transition:[{"@action":i.NEXT,"@target":t.SEQ_END},{"@action":i.SKIP,"@target":t.FIGHT_END},{"@action":i.RESET_FSM,"@target":t.FIGHT_FSM_INIT}]}]}},e}();e.FightFSM=n,__reflect(n.prototype,"game.FightFSM")}(game||(game={})),function(L){var e=function(i){function E(e){void 0===e&&(e=null);var t=i.call(this,E.N,e)||this;return t.fightPy=L.AppFacade.getInstance().retrieveProxy(L.FightPy.N),t.playerProxy=L.AppFacade.getInstance().retrieveProxy(L.PlayerPy.N),t.camp2PlayerId={},t.queueFightModelInit=[],t.preloadResDict={},t.proxy=L.AppFacade.getInstance().retrieveProxy(L.ZzqPy.N),t.stormWarProxy=L.AppFacade.getInstance().retrieveProxy(L.StormWarProxy.N),t.fu_mgr=FrameUpdateMgr.getInstance(),FIGHT_CONST.DEBUG_GLOBAL_MEDIATOR&&(window._c=t),t.reset(),t.fightTools=L.FightTools.getInstance(),t.initFSM(),t}return __extends(E,i),E.prototype.initSubView=function(){this.addSubView(E.SV.RESULT,L.FightResultPanel),this.addSubView(E.SV.RECORD,L.FightRecordPanel),this.addSubView(E.SV.STATISTICS,L.FightStatistics),this.addSubView(E.SV.ATTRIBUTE_CONTROL,L.AttributeControl),this.addSubView(E.SV.DEEPNEST_RESULT,L.DeepNestResultPanel),this.addSubView(E.SV.DUNGEON_RESULT,L.DungeonResultPanel),this.addSubView(E.SV.STORMWAR_RESULT,L.StormWarResultPanel)},Object.defineProperty(E.prototype,"rootView",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),E.prototype.listNotificationInterests=function(){return[puremvc.statemachine.StateMachine.CHANGED,CN.FIGHT_REQ_ANY_FIGHT,CN.FIGHT_OPEN_FIGHT,CN.FIGHT_CLOSE_FIGHT,CN.FIGHT_SPEED_UPDATE,CN.FIGHT_SKIP_FIGHT,CN.HIDE_ALL_SUBVIEW,CN.FIGHT_PZ,CN.FIGHT_FIGHT_UPDATE_UI,CN.FIGHT_MODEL_CREATED,CN.FIGHT_PAUSE,CN.FIGHT_OPEN_OR_CLOSE_FIGHT_TEST,CN.FIGHT_LET_OBJ_RELEASE_SKILL,CN.FIGHT_CHANGE_ALL_MODEL,CN.FIGHT_SHOW_RESULT,CN.FIGHT_TEAM_RECORD_PLAYBACK,CN.ZZQ_STATUS_FIGHT_DAOJISHI,SocketConst.SOCKET_CONNECT,SocketConst.SOCKET_RECONNECT]},E.prototype.handleNotification=function(e){var i=this;switch(e.getName()){case puremvc.statemachine.StateMachine.CHANGED:var t=e.getBody().name;this.curFSMState=t,this.onFSMUpdate(t);break;case CN.FIGHT_REQ_ANY_FIGHT:if(this.fightPy.isInFight&&!this.fightPy.dailyFakeFight)return void this.log("其他战斗正在进行，暂时无法开始新的战斗");this.hideSubView(E.SV.RESULT);var n=e.getBody();this.fightPy.fightType=n.type,this.fightPy.reqFightParams=n,this.fightPy.fightType==EBattleType.EBattleTypeWchess?L.GameMVC.zzqPy.debug_slowFight?Utils.TimerManager.setTimeScaleExtra(1):Utils.TimerManager.setTimeScaleExtra(3):Utils.TimerManager.setTimeScaleExtra(1),this.fightPy.curLayerTheme={bg:this.fightPy.reqFightParams.bg,bgm:this.fightPy.reqFightParams.bgm},this.fightPy.reqFight(),this.fightPy.reqFightParams.isPassive&&this.fightPy.reqFightParams.preloadCB&&this.fightPy.reqFightParams.preloadCB();break;case CN.FIGHT_OPEN_FIGHT:GameRootLayer.gameLayer().switchMenLoading(!0,function(){i.openFight()},"UNTIL_FIGHT_LOADED"),Utils.TimerManager.setTimeScale(this.fightPy.timeScale);break;case CN.FIGHT_CLOSE_FIGHT:this.closeFight();break;case CN.FIGHT_MODEL_CREATED:this.queueFightModelInit.splice(this.queueFightModelInit.indexOf(e.getBody()),1),0==this.queueFightModelInit.length&&this.curFSMState==L.FightState.FIGHT_START&&(this.fightPy.reqFightParams.testSkill?Utils.MsgUtils.addMidMsg("技能测试模式"):(this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.NEXT),this.fightTools.resortZOrder()));break;case CN.HIDE_ALL_SUBVIEW:break;case CN.FIGHT_SPEED_UPDATE:for(var o in Utils.TimerManager.setTimeScale(this.fightPy.timeScale),this.fightTools.updateTimeScale(),this.id2FightModel)this.id2FightModel[o].updataSpeed();break;case CN.FIGHT_FIGHT_UPDATE_UI:this.updateUI(e.getBody());break;case CN.FIGHT_SKIP_FIGHT:var a=e.getBody();this.ignoreResult=a&&a.ignoreResult,this.curFSMState==L.FightState.FIGHT_END?this.closeFight():this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.SKIP);break;case CN.FIGHT_PZ:var r=e.getBody();this.updateUI({pz:r&&r.pz});break;case CN.FIGHT_PAUSE:this.isPause=!this.isPause,this.isPause||this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.NEXT);break;case CN.FIGHT_OPEN_OR_CLOSE_FIGHT_TEST:this.testInputPanel?(PopUpManager.removePopUp(this.testInputPanel,0),this.testInputPanel=null):(this.testInputPanel=new L.FightTestInput(e.getBody()),PopUpManager.addPopUp({obj:this.testInputPanel,clickDarkClose:!1,effectType:0}));break;case CN.FIGHT_LET_OBJ_RELEASE_SKILL:var s=e.getBody();if(!s)return;for(var c=this.id2FightModel[s.id],l=[],h={},p={},d=0,u=s.tIds;d<u.length;d++){p[o=u[d]]?p[o]++:p[o]=1,h[o]||(l.push(this.id2FightModel[o]),h[o]=!0),this.id2FightModel[o].pushCurOnAttackFrame(new L.FightVO.SBattleRes({value:-1,state:[1,2,4][Utils.MathUtils.getRandomInt(0,2)],buffAdd:[],buffRemove:[]}))}c.releaseSkill(s.skill,l,s.cb,function(){},void 0,p);break;case CN.FIGHT_SHOW_RESULT:this.showResult();break;case SocketConst.SOCKET_RECONNECT:this.fightPy.isInFight&&L.AppFacade.getInstance().sendNotification(CN.FIGHT_SKIP_FIGHT);break;case CN.ZZQ_STATUS_FIGHT_DAOJISHI:if(this.fightPy.isInFight&&this.fightPy.fightType==EBattleType.EBattleTypeWchess){var g=e.getBody();Utils.MsgUtils.addMidMsg("下回合战斗于"+g+"后开始")}break;case CN.FIGHT_CHANGE_ALL_MODEL:var f=e.getBody();if(!f)return;for(var o in this.id2FightModel){(c=this.id2FightModel[o])&&c.parent&&c.parent.removeChild(c)}this.id2FightModel={};var _=void 0,m=void 0,y=!1,v=L.Config.skillBaseConfig(),T=L.Config.allHeroConfig();if(f.modelFixed)m=f.modelFixed,y=!0;else do{for(var o in v)if(v[o].modelId==f.model)for(var C in _=o,T)if(T[C].actSkill==_||T[C].normalSkill==_){m=Number(C);break}if(!_){Utils.MsgUtils.addMidMsg("找不到skillId");break}if(!m){Utils.MsgUtils.addMidMsg("找不到tarCode");break}y=!0}while(0);y||(m=41010040,Utils.MsgUtils.addMidMsg("使用临时模型")),this.fightPy.sBattleResultVO.teams.forEach(function(t,e){t.entities.forEach(function(e){e.code=m,e.dermaCode=void 0,i.queueFightModelInit.push(e.entityId),i.id2FightModel[e.entityId]=i.fightTools.createFightObj({entity:e,camp:t.camp}),i.rootView.gp_battle.addChild(i.id2FightModel[e.entityId])})}),this.fightTools.resortZOrder();break;case CN.FIGHT_TEAM_RECORD_PLAYBACK:}},E.prototype.onFSMUpdate=function(O){return __awaiter(this,void 0,void 0,function(){var n,t,i,o,a,r,s,c,l,h,p,d,u,g,f,_,m,y,v,T,C,E,b,I,A,P,S,N,M,w,k,R,U,x=this;return __generator(this,function(e){switch(e.label){case 0:if(this.log("=onFSMUpdate====>"+O),this.isPause)return[2];switch(O){case L.FightState.FIGHT_WAIT_INIT_PUSH:return[3,1];case L.FightState.FIGHT_START:return[3,2];case L.FightState.FIGHT_END:return[3,3];case L.FightState.ROUND_START:return[3,4];case L.FightState.ROUND_END:return[3,5];case L.FightState.SEQ_START:return[3,9];case L.FightState.SEQ_END:return[3,10];case L.FightState.ATTACK_BEFORE:return[3,11];case L.FightState.ATTACK_ING:return[3,12];case L.FightState.ATTACK_AFTER:return[3,13]}return[3,14];case 1:return GameRootLayer.gameLayer().switchCloudLoading(!1),this.rootView.updateUI(void 0,!0),[3,14];case 2:for(this.rootView.updateUI({updateTeam:!0}),this.curFightUuid=this.fightPy.battleInfo.uuid,n=!1,this.fightPy.sBattleResultVO.teams.forEach(function(t,e){if(x.camp2PlayerId[t.camp]=t.playerId,x.leftCamp||t.playerId!=x.playerProxy.playerInfoVO.playerId||(x.leftCamp=t.camp),t.magical&&t.magical.entityId){var i=t.magical;x.queueFightModelInit.push(i.entityId),x.id2FightModel[i.entityId]=x.fightTools.createFightObj({entity:i,camp:t.camp,isMine:t.playerId==x.playerProxy.playerInfoVO.playerId}),x.rootView.gp_battle.addChild(x.id2FightModel[i.entityId])}t.entities.forEach(function(e){n=!0,x.queueFightModelInit.push(e.entityId),x.id2FightModel[e.entityId]=x.fightTools.createFightObj({entity:e,camp:t.camp}),x.rootView.gp_battle.addChild(x.id2FightModel[e.entityId])})}),n||this.sendNotification(CN.FIGHT_SKIP_FIGHT),this.leftCamp||(this.leftCamp=EBattleSide.EBattleSideAttack),t=0,i=this.fightPy.sBattleResultVO.teams;t<i.length;t++)if((o=i[t]).camp==this.leftCamp){this.updateUI({anger:o.magical.anger,angerMax:o.magical.angerMax});break}return[3,14];case 3:for(U in this.id2FightModel)(p=this.id2FightModel[U])&&p.parent&&p.parent.removeChild(p);return this.id2FightModel={},this.rootView.reset(),this.curDelayCallSchId&&(egret.clearTimeout(this.curDelayCallSchId),this.curDelayCallSchId=null),this.sendNotification(CN.FIGHT_SHOW_RESULT),[3,14];case 4:return this.fightPy.round?(a=function(){return __awaiter(x,void 0,void 0,function(){var t,i,n,o,a;return __generator(this,function(e){switch(e.label){case 0:for(this.updateUI({round:!0}),t=!1,i=0,n=this.fightPy.round.beforeBattleRes;i<n.length;i++)o=n[i],(a=this.id2FightModel[o.entityId])&&a.handleSeqBattleRes(o,L.FightState.ROUND_START),t=!0;return t?[4,this.holdOn(100)]:[3,2];case 1:e.sent(),e.label=2;case 2:return this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.NEXT),[2]}})})},1==this.fightPy.round.roundNum&&L.GameMVC.guajiPy.tempData&&!L.GameMVC.guajiPy.tempData.showed?(L.GameMVC.guajiPy.tempData.showed=!0,r=L.GameMVC.guajiPy.tempData.eventId,s=L.Config.riskCreep()[r],(c=s&&s.heroShowID)?PopUpManager.addPopUp({obj:new L.FightBossDescView({id:c}),closeCB:a}):a()):a(),[3,14]):(this.log("回合数为0"),this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.SKIP),[2]);case 5:return 0<this.fightPy.round.afterBattleRes.length?[4,this.holdOn(100)]:[3,8];case 6:for(e.sent(),this.log("处理afterBattleRes"),l=0,h=this.fightPy.round.afterBattleRes;l<h.length;l++)I=h[l],(p=this.id2FightModel[I.entityId])&&p.handleSeqBattleRes(I,L.FightState.ROUND_END);return[4,this.holdOn(100)];case 7:e.sent(),e.label=8;case 8:return this.fightPy.nextRound()?this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.NEXT):this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.ROUND_ALL_DONE),[3,14];case 9:return this.seqAttack=this.fightPy.seqAttack,this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.NEXT),[3,14];case 10:return this.seqAttack=this.fightPy.changeNextSeqAttack(),this.seqAttack?this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.NEXT):this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.SEQ_ALL_DONE),[3,14];case 11:return this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.NEXT),[3,14];case 12:if(!this.seqAttack)return egret.warn("战 该回合没有人出手"),this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.NEXT),[2];if(!(p=this.id2FightModel[this.seqAttack.entityId]))return egret.warn("战 施法者已经不在了",this.seqAttack.entityId,this.fightPy.round),this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.NEXT),[2];for(d=[],u={},g={},f=[],_={},v=y=m=0,T=this.seqAttack.seqBattleEffect;v<T.length;v++)for(C=T[v],m+=C.sockBlood,y-=C.antiInjury,E=0,b=C.seqBattleRes;E<b.length;E++)I=b[E],(A=this.id2FightModel[I.entityId])?(I.skillId==this.seqAttack.skillId?(u[I.entityId]=A,-1==d.indexOf(A)&&d.push(A),g[I.entityId]?g[I.entityId]++:g[I.entityId]=1):_[I.entityId]=A,A.pushCurOnAttackFrame(I)):egret.warn("当前模型已经不在了",I.entityId);for(P in _)f.push(_[P]);if(S=this.fightPy.curFightId,N=this.fightPy.nextSeqAttack,this.seqAttack.skillId&&0<d.length)!1,this.log("战 出手",p.curEntity.entityId,this.seqAttack.skillId,d.length),p.releaseSkill(this.seqAttack.skillId,d,function(){x.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.NEXT)},function(){if(!x.checkFightInvalid(S))if(x.seqAttack){for(var e=0,t=f;e<t.length;e++){t[e].onAttackFrame()}var i=x.id2FightModel[x.seqAttack.entityId];i&&(i.popSth(m),i.popSth(y),i.updateEntity({life:x.seqAttack.life,anger:x.seqAttack.anger}))}else egret.warn("出手后this.seqAttack没了")},N&&N.entityId==this.seqAttack.entityId&&N.combo,g);else{if(egret.warn("战 没有技能id或者没有受击者",this.seqAttack.skillId,d.length),(M=L.Config.skillBaseConfig()[this.seqAttack.skillId])&&M.forceAction)for(egret.log("强制播放onAttackFrame"),w=0,k=f;w<k.length;w++)k[w].onAttackFrame();(R=this.id2FightModel[this.seqAttack.entityId])&&(R.popSth(m),R.updateEntity({life:this.seqAttack.life,anger:this.seqAttack.anger})),this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.NEXT)}return[3,14];case 13:if(!this.seqAttack||!this.seqAttack.entityId)return egret.warn("战 该回合没有人出手或者神兵放技能了"),this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.NEXT),[2];for(U in this.id2FightModel)this.id2FightModel[U].handleDead(L.FightState.ATTACK_AFTER);return this.seqAttack.p||this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.NEXT),[3,14];case 14:return[2]}})})},E.prototype.initFSM=function(){var e=(new L.FightFSM).createFsm(),t=new puremvc.statemachine.FSMInjector(e);t.initializeNotifier(L.AppFacade.getInstance().multitonKey),t.inject()},E.prototype.getRes=function(e){RES.hasRes(e+"_skeleton_dbbin")?this.preloadResDict[e+"_skeleton_dbbin"]=1:this.preloadResDict[e+"_ske_dbbin"]=1,RES.hasRes(e+"_texture_json")?this.preloadResDict[e+"_texture_json"]=1:this.preloadResDict[e+"_tex_json"]=1,RES.hasRes(e+"_texture_png")?this.preloadResDict[e+"_texture_png"]=1:this.preloadResDict[e+"_tex_png"]=1},E.prototype.openFight=function(){var r=this;DragonBoneTools.removeAllNotStageDB(),this.preloadResDict={},this.fightPy.curLayerTheme.bg&&(this.preloadResDict[this.fightPy.curLayerTheme.bg]=1),this.fightPy.curLayerTheme.bgm&&(this.preloadResDict[this.fightPy.curLayerTheme.bgm]=1);var e={},t={};if(this.fightPy.fightType!=EBattleType.EBattleTypeWchess){for(var i in this.fightPy.battleEntityDetail){var n=this.fightPy.battleEntityDetail[i],o=void 0;if(n.code)if(n.type){var a=(o=this.fightPy.getConfigByFightEntity(n)).model;if(n.dermaCode){e[n.entityId]=n.dermaCode;var s=L.Config.getHeroDermaConfig(n.dermaCode);s&&(a=s.model)}this.getRes(a),t[a]=1}else o=L.Config.allMagicalConfig()[n.code],this.preloadResDict[ResourceUtils.png(o.model)]=1}for(var c=0,l=this.fightPy.battleInfo.rounds;c<l.length;c++)for(var h=0,p=l[c].seqAttack;h<p.length;h++){var d=p[h],u=L.Config.skillBaseConfig()[d.skillId];if(u&&u.modelId){var g=u.modelId;if(e[d.entityId]&&u.dermaModelId)(o=L.Config.getHeroDermaConfig(e[d.entityId]))&&(g=JSON.parse(u.dermaModelId)[o.index-1]);var f=L.Config.skillConfig()[g];if(f){if(f.effectQP)for(var _=0,m=f.effectQP;_<m.length;_++){var y=m[_];this.getRes(y.src[0]),t[y.src[0]]=1,y.piaEffect&&(this.getRes(y.piaEffect.src),t[y.piaEffect.src]=1)}if(f.effectSrc)for(var v=0,T=f.effectSrc;v<T.length;v++)for(var C=0,E=(y=T[v]).src;C<E.length;C++){var b=E[C];this.getRes(b),t[b]=1}if(f.effectsTar)for(var I=0,A=f.effectsTar;I<A.length;I++)for(var P=0,S=(y=A[I]).src;P<S.length;P++){b=S[P];this.getRes(b),t[b]=1}if(f.effectsTarPia)for(var N=0,M=f.effectsTarPia;N<M.length;N++)for(var w=0,k=(y=M[N]).src;w<k.length;w++){b=k[w];this.getRes(b),t[b]=1}}}}for(var R in this.preloadResDict)R&&!RES.getRes(R)||delete this.preloadResDict[R]}var U=Object.keys(this.preloadResDict);RES.createGroup("fight_cur",U,!0);var x=["fight_cur"];RES.isGroupLoaded("fight")||x.push("fight");var O=Object.keys(t);this.log("当前需要加载的资源",x),this.log("当前需要加载的资源",U),this.log("当前需要预处理的模型",O),this.preloadRes(x,function(){r.addRootView(L.FightUI),r.fightTools.bindView(r.rootView.gp_battle);var t=O.length;if(0<t)for(var i=0,n=1,e=function(e){t<=n?r.fu_mgr.insert({delayFrame:n,waitFrame:0,cb:function(){DragonBoneTools.preload(e),GameRootLayer.gameLayer().loadingUI&&GameRootLayer.gameLayer().loadingUI.setProgress(++i,t),GameRootLayer.gameLayer().switchMenLoading(!1,function(){Utils.SoundManager.playBg(SOUND_BGM_TYPE.zhan_dou),r.sendNotification(CN.FIGHT_ON_FIGHT_VISIBLE_SWITCH,{isInFight:!0}),r.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.INIT_DONE),r.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.BATTLE_BROADCAST_ARRIVE)},"UNTIL_FIGHT_LOADED")},params:void 0}):r.fu_mgr.insert({delayFrame:n,waitFrame:0,cb:function(){DragonBoneTools.preload(e),GameRootLayer.gameLayer().loadingUI&&GameRootLayer.gameLayer().loadingUI.setProgress(++i,t)},params:void 0}),n++},o=0,a=O;o<a.length;o++){e(a[o])}else GameRootLayer.gameLayer().switchMenLoading(!1,function(){Utils.SoundManager.playBg(SOUND_BGM_TYPE.zhan_dou),r.sendNotification(CN.FIGHT_ON_FIGHT_VISIBLE_SWITCH,{isInFight:!0}),r.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.INIT_DONE),r.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.BATTLE_BROADCAST_ARRIVE)},"UNTIL_FIGHT_LOADED")})},E.prototype.resumeFight=function(){this.sendNotification(CN.FIGHT_ON_FIGHT_VISIBLE_SWITCH,{isInFight:!0}),this.rootView.visible=!0},E.prototype.showResult=function(){var t=this;this.ignoreResult?(this.closeFight(),this.fightPy.playbackResult=void 0):this.fightPy.fightType==EBattleType.EBattleTypeWchess?this.proxy.latestFightStatis?L.AppFacade.getInstance().showSubView(L.ZzqMediator.N,L.ZzqMediator.SV.STATISTICS,{resultData:this.proxy.latestFightStatis,doneCB:function(){t.closeFight(),t.fightPy.playbackResult=void 0}}):(this.closeFight(),this.fightPy.playbackResult=void 0):this.fightPy.fightType==EBattleType.EBattleTypeAbyssLair&&0==this.fightPy.multiFightOriginPushs.length?(egret.log("深渊巢穴战斗，且当前已经是最后一场"),this.showSubView(E.SV.DEEPNEST_RESULT,{info:this.fightPy.sFinalBattleResultVO,doneCB:function(){t.closeFight(),t.fightPy.playbackResult=void 0}})):this.fightPy.fightType==EBattleType.EBattleTypeVestage&&this.fightPy.sBattleResultVO.vestageRecords?(egret.log("守护者遗迹战斗，且已经gg了"),this.showSubView(E.SV.DUNGEON_RESULT,{clickDarkClose:!1,info:this.fightPy.sBattleResultVO,doneCB:function(){t.closeFight(),t.fightPy.playbackResult=void 0}})):this.fightPy.fightType==EBattleType.EBattleTypeStormWar&&this.stormWarProxy.challengeResultInfo?(egret.log("风暴战场战斗结束"),this.showSubView(E.SV.STORMWAR_RESULT,{info:this.fightPy.sBattleResultVO,doneCB:function(){var e=t.stormWarProxy.challengeResultInfo.result;t.closeFight(),t.sendNotification(CN.STORM_WAR_BATTLE_FINISH,{result:e}),t.fightPy.playbackResult=void 0}})):this.showSubView(E.SV.RESULT,{customParams:this.fightPy.reqFightParams.customParams,result:this.fightPy.sBattleResultVO.result,resultVo:this.fightPy.sBattleResultVO,sClientReward:this.fightPy.sBattleResultVO.clientReward,normalRewards:this.fightPy.sBattleResultVO.normalRewards,extRewards:this.fightPy.sBattleResultVO.extRewards,hurt:this.fightPy.sBattleResultVO.hurt,star:this.fightPy.sBattleResultVO.star,battleType:this.fightPy.sBattleResultVO.battleType,clickDarkClose:!(this.fightPy.sBattleResultVO.battleType==EBattleType.EBattleTypeTeamArena&&3==this.fightPy.sFinalBattleResultVO.totalC),autoClose:this.fightPy.reqFightParams.autoClose,doneCB:function(){(t.fightPy.sBattleResultVO.battleType!=EBattleType.EBattleTypeDailyFortress&&t.fightPy.sBattleResultVO.battleType!=EBattleType.EBattleTypeHeroChallenge2||!t.fightPy.dailyFakeFight)&&(t.closeFight(),t.fightPy.playbackResult=void 0)}})},E.prototype.closeFight=function(){DragonBoneTools.manualClean(),this.queueFightModelInit.splice(0),this.fightPy.fightPreEnd(),this.rootView&&this.rootView.updateUI(void 0,!0),this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.RESET_FSM),this.updateUI({focusReset:!0}),this.ignoreResult=void 0,0<this.fightPy.multiFightOriginPushs.length?(this.sendNotification(puremvc.statemachine.StateMachine.ACTION,null,L.FightAction.INIT_DONE),this.fightPy.respBattleResultP(this.fightPy.multiFightOriginPushs.shift(),!0)):(this.disMissFight(),this.fightPy.fightEnd())},E.prototype.disMissFight=function(){this.removeFromParent(),"FIGHT"==L.MainJumpConfig.getCurEvent()&&L.MainJumpConfig.jumpTo(),this.sendNotification(CN.FIGHT_ON_FIGHT_VISIBLE_SWITCH,{isInFight:!1}),Utils.TimerManager.setTimeScale(1)},E.prototype.updateUI=function(e,t){this.rootView&&this.rootView.updateUI(e,t)},E.prototype.checkFightInvalid=function(e){return e!=this.fightPy.curFightId},E.prototype.holdOn=function(n,o){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(e){return[2,new Promise(function(e,t){i.curDelayCallSchId=egret.setTimeout(function(){i.fightPy.isInFight&&(o&&o(),e())},i,n/i.fightPy.timeScale)})]})})},E.prototype.reset=function(){this.seqAttack=void 0,this.id2FightModel={},this.camp2PlayerId={},this.leftCamp=void 0},E.prototype.getFightModelById=function(e){return this.id2FightModel[e]},E.N="FightMediator",E.SV={RESULT:2,RECORD:3,STATISTICS:4,ATTRIBUTE_CONTROL:5,DEEPNEST_RESULT:6,DUNGEON_RESULT:7,STORMWAR_RESULT:8},E}(BaseMediator);L.FightMediator=e,__reflect(e.prototype,"game.FightMediator")}(game||(game={})),function(l){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new i).register()},e}();l.FightProcessor=e,__reflect(e.prototype,"game.FightProcessor");var t=function(e){function t(){return e.call(this,"battle.SBattleInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){l.AppFacade.getInstance().retrieveProxy(l.FightPy.N).respBattleInfoP(e.getBody().battleInfo)},t}(l.ProcessorBase);__reflect(t.prototype,"SBattleInfoP");var i=function(e){function t(){return e.call(this,"battle.SBattleResultP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=l.AppFacade.getInstance().retrieveProxy(l.FightPy.N),i=t.getGuideFightParams();if(i&&i.fakeBroadcast){var n=JSON.parse(i.fakeBroadcast);t.respBattleResultP(n)}else{var o=e.getBody();if(t.dailyFakeFight)return void t.respBattleResultP(o);if(o.battleType==EBattleType.EBattleTypeTeamExpedition&&(Number(l.MainJumpConfig.getCurEvent())!=MODULE.TeamExpedition||GameRootLayer.gameLayer().isMiWuShow))return void egret.log("条件不允许，不需要播放战斗");if(o.battleType==EBattleType.EBattleTypeStormWar&&(Number(l.MainJumpConfig.getCurEvent())!=MODULE.StormWar||GameRootLayer.gameLayer().isMenShow))return void egret.log("条件不允许，不需要播放战斗");var a=void 0,r=void 0,s=void 0;if(o.battleType==EBattleType.EBattleTypeRisk){var c=l.GameMVC.guajiPy;a=c.curLayerTheme.bgm,r=c.curLayerTheme.bg,c.tempData&&c.tempData.config&&(s=function(e){if(c.tempData&&c.tempData.config){var t=e.result==EBattleResult.EBattleResultWin?0:1;c.tempData.order=t;var i={config:c.tempData.config,rewards:c.tempData.rewards,order:t};PopUpManager.addPopUp({obj:new l.BaseEpRewardView(i),closeCB:function(){l.AppFacade.getInstance().sendNotification(CN.SHOW_WECHAT_SHARE)}}),c.tempData=void 0}})}t.reqFightParams?(egret.log("处理主动战斗"),t.respBattleResultP(o)):(egret.log("处理被动战斗"),l.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:o.battleType,bgm:a,bg:r,customParams:{},isPassive:!0,preloadCB:function(){t.respBattleResultP(o)},doneCB:s}))}},t}(l.ProcessorBase);__reflect(i.prototype,"SBattleResultP")}(game||(game={})),function(h){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.positionTypes={},e._timeScale=FIGHT_CONST.SPEED_X1,e.timeout=5e3,e.multiFightOriginPushs=[],e.forceCanSkip=!1,e.curLayerTheme={},e.battleInfoVO=new h.FightVO.SBattleInfo,e.delayCBAfterFightExit=new Array,e.sFinalBattleResultVO=new h.FightVO.SFinalBattleResult,e.lastsFinalBattleResultVO=new h.FightVO.SFinalBattleResult,e.battleEntityDetail={},e}return __extends(i,t),Object.defineProperty(i.prototype,"timeScale",{get:function(){return this._timeScale},set:function(e){this._timeScale=e,h.AppFacade.getInstance().sendNotification(CN.FIGHT_SPEED_UPDATE)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isInFight",{get:function(){return this._isInFight},set:function(e){e!=this._isInFight&&this.onInFightChangeUpdate(e)},enumerable:!0,configurable:!0}),i.prototype.getGuideFightParams=function(){return this.reqFightParams&&this.reqFightParams.guideFightParams},i.prototype.getCustomParams=function(){return this.reqFightParams&&this.reqFightParams.customParams},i.prototype.handleException=function(e,t){e||Utils.MsgUtils.addErrMsg(void 0,t),this.battleInfoVO.uuid||h.AppFacade.getInstance().sendNotification(CN.FIGHT_CLOSE_FIGHT),this.timeoutScheId&&(egret.clearTimeout(this.timeoutScheId),this.timeoutScheId=void 0)},i.prototype.reqFight=function(){var t=this;this.isInFight=!0,this.delayCBAfterFightExit.filter(function(e){return e.beforeFightReq}),this.reqFightParams?(this.addDelayCBAfterFightExit(this.reqFightParams.doneCB,this.reqFightParams.pb1),this.curFightId=h.GameMgr.getInstance().serverTime(),this.reqFightParams.isPassive||this.reqFightParams.pb1&&this.reqFightParams.pb2?(this.timeoutScheId&&(egret.clearTimeout(this.timeoutScheId),this.timeoutScheId=void 0),this.timeoutScheId=egret.setTimeout(function(){t.handleException(void 0,"战斗请求超时")},this,this.timeout),this.reqFightParams.isPassive||Utils.Socket.send(this.reqFightParams.pb1,this.reqFightParams.pb2,this.reqFightParams.params).then(function(e){e?(t.reqFightParams.reqCB&&t.reqFightParams.reqCB(e),t.lastsFinalBattleResultVO.cbRet=e):t.handleException(void 0,"战斗callback没有内容")}).catch(function(e){t.handleException(e)})):this.fightType!=EBattleType.EBattleTypeTest&&this.handleException(void 0,"缺少pb1或pb2有误"),this.log("战斗py已就绪")):this.handleException(void 0,"输入参数有误")},i.prototype.respBattleResultP=function(e,t){if(void 0===t&&(t=!1),!t&&this.battleInfoVO.uuid)return this.log("当前还有战斗没播完，多重战斗"),0<this.multiFightOriginPushs.length&&e.battleType!=this.multiFightOriginPushs[0].battleType?void this.log("该战斗跟当前堆积的战报不是同一战斗类型，跳过处理",e.battleType,this.multiFightOriginPushs[0].battleType):(this.multiFightOriginPushs.push(e),void(this.dailyFakeFight&&(h.AppFacade.getInstance().sendNotification(CN.FIGHT_CLOSE_FIGHT),this.dailyFakeFight=!1)));this.log("respBattleInfoP=====>",e),Utils.agentConfig.IsDebug&&this.log("战报头",JSON.stringify(e)),this.reqFightParams?(this.isTestFight()&&this.reqFightParams.needCopy&&Utils.SDKMgr.copyToClipBoard(JSON.stringify(e),function(e){"success"==e?Utils.MsgUtils.addMidMsg("复制成功"):Utils.MsgUtils.addMidMsg("复制失败")}),this.timeoutScheId&&(egret.clearTimeout(this.timeoutScheId),this.timeoutScheId=void 0),this.sBattleResultVO?this.sBattleResultVO.update(e):this.sBattleResultVO=new h.FightVO.SBattleResult(e),this.sFinalBattleResultVO.sum(e),this.sBattleResultVO.escaped?this.sendNotification(CN.FIGHT_SHOW_RESULT):this.respBattleInfoP(e.battleInfo,!0,t)):this.log("reqFightParams丢失跳过播放")},i.prototype.respBattleInfoP=function(e,t,i){var n=this;if(void 0===t&&(t=!1),void 0===i&&(i=!1),t)this.battleInfoVO.update(e,i),this.sBattleResultVO.teams.forEach(function(e){n.battleEntityDetail[e.magical.entityId]=e.magical,e.entities.forEach(function(e){n.battleEntityDetail[e.entityId]=e}),n.fightType==EBattleType.EBattleTypeWchess?n.positionTypes[e.camp]=PositionType.Chess8V8:FIGHT_CONST.FIGHT_POS[e.positionType]&&e.entities.length!=FIGHT_CONST.FIGHT_POS[e.positionType][e.camp].length-1?n.positionTypes[e.camp]=PositionType.Normal:n.positionTypes[e.camp]=e.positionType||PositionType.Normal}),i?h.AppFacade.getInstance().sendNotification(CN.FIGHT_OPEN_FIGHT):h.MainJumpConfig.jumpTo("FIGHT");else if(this.battleInfo.uuid==e.uuid)Utils.agentConfig.IsDebug&&this.log("战报拼接",JSON.stringify(e)),this.battleInfo.pushRounds(e);else for(var o=0,a=this.multiFightOriginPushs;o<a.length;o++){var r=a[o];if(r.battleInfo.uuid==e.uuid){if(Array.isArray(e.rounds))for(var s=0,c=e.rounds;s<c.length;s++){var l=c[s];r.battleInfo.rounds.push(l)}break}}},Object.defineProperty(i.prototype,"seqAttack",{get:function(){return this.round.seqAttack[0]},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"nextSeqAttack",{get:function(){return this.round.seqAttack[1]},enumerable:!0,configurable:!0}),i.prototype.changeNextSeqAttack=function(){return this.round.seqAttack.shift(),this.seqAttack},Object.defineProperty(i.prototype,"round",{get:function(){return this.battleInfo.rounds[0]},enumerable:!0,configurable:!0}),i.prototype.nextRound=function(){return this.battleInfo.rounds.shift(),this.round},Object.defineProperty(i.prototype,"battleInfo",{get:function(){return this.battleInfoVO},enumerable:!0,configurable:!0}),i.prototype.isTestFight=function(){return this.fightType===EBattleType.EBattleTypeTest},i.prototype.addDelayCBAfterFightExit=function(e,t,i,n){if(void 0===i&&(i=0),void 0===n&&(n=!1),e){for(var o=0,a=this.delayCBAfterFightExit;o<a.length;o++){if(a[o].source==t)return}n||this._isInFight||0<this.delayCBAfterFightExit.length?(this.delayCBAfterFightExit.push({order:i,cb:e,source:t,beforeFightReq:n}),this.delayCBAfterFightExit.sort(function(e,t){return t.order-e.order})):e()}},i.prototype.queueExceExitCB=function(){if(0!=this.delayCBAfterFightExit.length)try{var e=this.delayCBAfterFightExit.shift();e.cb&&e.cb(this.lastsFinalBattleResultVO)}catch(e){egret.error("queueExceExitCB exception",e)}},i.prototype.reset=function(){this.sendNotification(CN.FIGHT_ALL_DONE_AND_EXIT,{type:this.reqFightParams&&this.reqFightParams.type,result:this.sBattleResultVO&&this.sBattleResultVO.result}),this.isInFight=!1,this.reqFightParams=void 0,this.battleEntityDetail={},this.sFinalBattleResultVO.reset()},i.prototype.fightPreEnd=function(){this.battleInfoVO.reset()},i.prototype.fightEnd=function(){this.isInFight=!1;try{if(this.sBattleResultVO&&(this.fightType!=EBattleType.EBattleTypeTest&&this.sBattleResultVO.result===EBattleResult.EBattleResultWin?Utils.Socket.send("battle","BattleEnd",{battleType:this.fightType}).then(function(e){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.sound_shengli)}):this.fightType==EBattleType.EBattleTypeStormWar&&this.sBattleResultVO.result===EBattleResult.EBattleResultLose?Utils.Socket.send("battle","BattleEnd",{battleType:this.fightType}).then(function(e){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.sound_shibai)}):Utils.SoundManager.playSound2(SOUND_EFF_TYPE.sound_shibai),this.getGuideFightParams()&&this.getGuideFightParams().jumpToMoudleByCode)){var e=this.getGuideFightParams().jumpToMoudleByCode;h.MainJumpConfig.jumpTo(e)}}catch(e){console.error("战斗结束后的回调报错",e)}this.lastsFinalBattleResultVO.winC=this.sFinalBattleResultVO.winC,this.lastsFinalBattleResultVO.battleType=this.sFinalBattleResultVO.battleType,this.lastsFinalBattleResultVO.hurt=this.sFinalBattleResultVO.hurt,this.lastsFinalBattleResultVO.totalC=this.sFinalBattleResultVO.totalC,this.lastsFinalBattleResultVO.star=this.sFinalBattleResultVO.star,this.reset(),this.queueExceExitCB()},i.prototype.onInFightChangeUpdate=function(e){this._isInFight=e,this.sendNotification(CN.FIGHT_FIGHT_STATUS_SWITCH,{isInFight:e})},i.prototype.BattlePlayBack=function(e,t){Array.isArray(e)||(e=[e]),t&&t.moduleId==MODULE.TeamArena&&h.AppFacade.getInstance().sendNotification(CN.FIGHT_TEAM_RECORD_PLAYBACK,t.data),t&&t.doneCB?h.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeBattleBack,pb1:"battle",pb2:"BattlePlayBack",params:{uuids:e},doneCB:function(e){t.doneCB(),h.AppFacade.getInstance().retrieveProxy(i.N).queueExceExitCB()}}):h.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeBattleBack,pb1:"battle",pb2:"BattlePlayBack",params:{uuids:e}})},i.prototype.CommonFightRecord=function(e,t,i,n){Utils.Socket.send(e,t,{}).then(function(e){n&&n(e[i])})},i.prototype.getConfigByFightEntity=function(e){var t=void 0;return(t=this.fightType!=EBattleType.EBattleTypeWchess&&e.entityId%10==7?h.Config.allPetConfig()[e.code]:h.Config.allHeroConfig()[e.code]||h.Config.creepConfig()[e.code])||(egret.warn("使用临时配置"),t=h.Config.allHeroConfig()[41010040]),t},i.N="FightPy",i}(BaseProxy);h.FightPy=e,__reflect(e.prototype,"game.FightPy")}(game||(game={})),function(u){var e=function(p){function d(e){var t,i=p.call(this)||this;return i.CONFIG=((t={})[d.FIGHT_TYPE.REGULAR]={name:"常规战斗",pb:"BattleTest",tips:'请输入{"code":XXXX, ...}',patch:{code:0},expectNum:6,paramsFormat:function(e,t){return{attacks:e,defence:t}}},t[d.FIGHT_TYPE.CHESS]={name:"自走棋战斗",pb:"WchessBattleTest",tips:"直接输入code",patch:0,expectNum:8,paramsFormat:function(e,t){return{attackTeam:e,defenceTeam:t}}},t),i.loginPy=u.AppFacade.getInstance().retrieveProxy(u.LoginPy.N),i.skinName="FightTestInputSkin",i.tfs=new Array,i.tfs2=new Array,i.fightType=e&&e.type||d.FIGHT_TYPE.REGULAR,i.targetConfig=i.CONFIG[i.fightType],i}return __extends(d,p),d.prototype.childrenCreated=function(){var n=this;p.prototype.childrenCreated.call(this),this.lb_title.text=this.targetConfig.name;var e,t=Utils.LocalStorageUtil.getItem("FightTestInput_"+this.fightType,!0);""!=t&&(e=JSON.parse(t)),this.et_all.text=Utils.LocalStorageUtil.getItem("FightTestInput_fake",!0);for(var i=this.targetConfig.expectNum,o=0;o<i;o++){var a=new eui.EditableText;a.width=250,this.tfs.push(a),this.gp_et1.addChild(a);var r=new eui.EditableText;r.width=250,this.tfs2.push(r),this.gp_et2.addChild(r)}e&&e.campA&&e.campB&&(e.campA.forEach(function(e,t){var i;try{i=JSON.stringify(e)}catch(e){i=""}n.tfs[t].text=i}),e.campB.forEach(function(e,t){var i;try{i=JSON.stringify(e)}catch(e){i=""}n.tfs2[t].text=i}));for(var s=0,c=this.tfs;s<c.length;s++){c[s].prompt=this.targetConfig.tips}for(var l=0,h=this.tfs2;l<h.length;l++){h[l].prompt=this.targetConfig.tips}this.btn_test_skill.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.AppFacade.getInstance().sendNotification(CN.FIGHT_OPEN_OR_CLOSE_FIGHT_TEST),egret.setTimeout(function(){u.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{isPassive:!0,testSkill:!0,type:EBattleType.EBattleTypeTest})},this,250),egret.setTimeout(function(){var e=FIGHT_CONST.GUIDE_INNER_FIGHT.a;u.AppFacade.getInstance().retrieveProxy(u.FightPy.N).respBattleResultP(e)},this,500)},this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this,t=this.et_all.text,i=!1;if(t&&""!=t)try{var n=FIGHT_CONST.GUIDE_INNER_FIGHT[t];n||(n=JSON.parse(t)),i=!0,Utils.LocalStorageUtil.setItem("FightTestInput_fake",t,!0),u.AppFacade.getInstance().sendNotification(CN.FIGHT_OPEN_OR_CLOSE_FIGHT_TEST),egret.setTimeout(function(){u.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{isPassive:!0,type:n.battleType})},this,200),egret.setTimeout(function(){u.AppFacade.getInstance().retrieveProxy(u.FightPy.N).respBattleResultP(n)},this,500)}catch(e){console.log(e),Utils.MsgUtils.addMidMsg("战报解析失败")}else Utils.LocalStorageUtil.setItem("FightTestInput_fake","",!0);if(!i){for(var o=new Array,a=new Array,r=0;r<this.tfs.length;r++)if(""!=this.tfs[r].text){var s=JSON.parse(this.tfs[r].text);o.push(s)}else null!=this.targetConfig.patch&&o.push(this.targetConfig.patch);for(r=0;r<this.tfs2.length;r++)if(""!=this.tfs2[r].text){s=JSON.parse(this.tfs2[r].text);a.push(s)}else null!=this.targetConfig.patch&&a.push(this.targetConfig.patch);Utils.LocalStorageUtil.setItem("FightTestInput_"+this.fightType,JSON.stringify({campA:o,campB:a}),!0),u.AppFacade.getInstance().sendNotification(CN.FIGHT_OPEN_OR_CLOSE_FIGHT_TEST),egret.setTimeout(function(){e.fightType==d.FIGHT_TYPE.CHESS&&(u.GameMVC.zzqPy.simFight=!0),u.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{needCopy:e.cb_needCopy.selected,type:EBattleType.EBattleTypeTest,pb1:"test",pb2:e.targetConfig.pb,params:e.targetConfig.paramsFormat(o,a),doneCB:function(){u.GameMVC.zzqPy.simFight=!1}})},this,250)}},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.AppFacade.getInstance().sendNotification(CN.FIGHT_OPEN_OR_CLOSE_FIGHT_TEST)},this),this.et_replay.text=Utils.LocalStorageUtil.getItem("FightTestInput_replay",!0)||"",this.btn_replay.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.LocalStorageUtil.setItem("FightTestInput_replay",this.et_replay.text,!0),u.AppFacade.getInstance().retrieveProxy(u.FightPy.N).BattlePlayBack(this.et_replay.text)},this)},d.FIGHT_TYPE={REGULAR:1,CHESS:2},d}(BasePanel);u.FightTestInput=e,__reflect(e.prototype,"game.FightTestInput")}(game||(game={})),function(r){var e=function(a){function e(e){var t=a.call(this)||this;return t.modelIndex=1,t.fightPy=r.AppFacade.getInstance().retrieveProxy(r.FightPy.N),t.KEY=["headOX","headOY","attkOX","shejiOX","shejiOY","allAttkDelay","flyBackDelay"],t.skinName="FightTestModelSkin",t.params=e,t}return __extends(e,a),e.prototype.onDestroy=function(){a.prototype.onDestroy.call(this)},e.prototype.setV=function(e){if(this.curFocusET){var t=this.curFocusET.name;this.curFocusET.text=(Number(this.curFocusET.text)+e).toString();var i=r.Config.heroModelOffsetConfig(this.curHeroModel);if(i)i[t]=Number(this.curFocusET.text);else{var n={};this.KEY.forEach(function(e){n[e]=0}),r.Config.pack.t_hero_model_offset[this.curHeroModel]=n,r.Config.pack.t_hero_model_offset[this.curHeroModel][t]=Number(this.curFocusET.text)}}else Utils.MsgUtils.addMidMsg("请选中输入框")},e.prototype.changeModel=function(e,t){if(e&&""!=e){if(t==EBattleSide.EBattleSideAttack){if(this.curHeroModel!=e)!0,this.curHeroModel=e,r.Config.allHeroConfig()[41000001].model=this.curHeroModel,this.gp_model.$children.forEach(function(e){e.text=""});this.lb_curModelName.text=this.curHeroModel}else{r.Config.allHeroConfig()[41000002].model=e}7==this.modelIndex&&(this.modelIndex=1);var i=this.fightTools.createFightObj({entity:new r.FightVO.SBattleEntity({entityId:t==EBattleSide.EBattleSideAttack?"11"+this.modelIndex++:"21"+this.modelIndex++,code:t==EBattleSide.EBattleSideAttack?41000001:41000002,life:9999,lifeMax:9999,anger:50,angerMax:100,level:99}),camp:t});return this.gp_model.addChild(i),i}},e.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.fightTools=r.FightTools.getInstance(),this.fightTools.bindView(this.gp_model),this.fightPy.positionTypes=((e={})[EBattleSide.EBattleSideAttack]=PositionType.Normal,e[EBattleSide.EBattleSideDefence]=PositionType.Normal,e);for(var e,t=function(e){var t=new eui.EditableText;t.width=600,t.prompt=e,t.name=e,i.gp_inputs.addChild(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.curFocusET=t},i),t.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){this.setV(0)},i)},i=this,n=0,o=this.KEY;n<o.length;n++){t(o[n])}this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=r.Config.skillConfig().common_skill_huikan;this.fightTools.handleSkill(this.tar,[this.tar2],e,function(){},function(){})},this),this.btn_sheji.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=r.Config.skillConfig().common_skill_gong;this.fightTools.handleSkill(this.tar,[this.tar2],e,function(){},function(){})},this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.tar2&&this.gp_model.removeChild(this.tar2),this.tar2=this.changeModel(this.et_hero1_0.text,EBattleSide.EBattleSideDefence)},this),this.btn_go0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.tar&&this.gp_model.removeChild(this.tar),this.tar=this.changeModel(this.et_hero1_1.text,EBattleSide.EBattleSideAttack)},this),this.btn_z1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setV(1)},this),this.btn_z10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setV(10)},this),this.btn_f1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setV(-1)},this),this.btn_f10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setV(-10)},this)},e}(BasePanel);r.FightTestModel=e,__reflect(e.prototype,"game.FightTestModel")}(game||(game={})),function(c){var e=function(i){function e(){var e=i.call(this)||this;e.flyTimeEffect=200,e.timeScale=1,e.fightPy=c.AppFacade.getInstance().retrieveProxy(c.FightPy.N),e.curWidth=Utils.DeviceUtils.curWidth(),e.curHeight=Utils.DeviceUtils.curHeight(),e.needSortChildrenArr=new Array;return e.fenShenColorFlilter=new egret.ColorMatrixFilter([1,0,0,0,0,0,1,0,0,0,0,0,1,0,200,0,0,0,1,0]),e}return __extends(e,i),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【FightTools】："].concat(e))},e.getInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return i.getInstance.apply(this,e)},e.prototype.bindView=function(e){this.gp_battle=e},e.prototype.createFightObj=function(e){return e.entity.entityId%10==0?customui.FightMagicalFactory.create(e):customui.FightModelFactory.create(e)},e.prototype.getBattleResStatusTips=function(e){var t="";return e&1<<EEffectStatus.Miss?t+"闪避":e&1<<EEffectStatus.Crit?t+"暴击":""},e.prototype.handleCustomAct=function(e,n){for(var t=this,i=function(i){switch(i.type){case"sky_color":var e=o.gp_battle.parent.gp_evr;e.objCMColorType=i.CMOffsetColorType||7,egret.setTimeout(function(){egret.Tween.get(e).to({CMOffsetFactor:i.CMOffsetFactor},i.dt/t.timeScale)},o,i.delay/o.timeScale);break;case"pz":egret.setTimeout(function(){c.AppFacade.getInstance().sendNotification(CN.FIGHT_PZ,{pz:i.pz})},o,i.delay/o.timeScale);break;case"obj_src":egret.setTimeout(function(){n&&egret.Tween.get(n).to({alpha:i.alpha},i.dt/t.timeScale)},o,i.delay/o.timeScale);break;case"hide_self_camp":egret.setTimeout(function(){var e=c.AppFacade.getInstance().retrieveMediator(c.FightMediator.N).id2FightModel;for(var t in e)e[t]&&e[t].parent&&(e[t].isFightMagical||e[t].camp!=n.camp||e[t]==n||(e[t].visible=!i.value))},o,i.delay/o.timeScale)}},o=this,a=0,r=e;a<r.length;a++){i(r[a])}},e.prototype.showFenShen=function(e,t,i){var n=this;void 0===i&&(i=1);var o=0;e.camp==EBattleSide.EBattleSideAttack?o-=t.modelPos[2][0]:o+=t.modelPos[2][0],DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,z:t.parent.getChildIndex(t)+1,timeScale:this.timeScale*i,scaleX:-t.display.scaleX,scaleY:t.display.scaleY,x:t.x+o,y:t.y,effectName:e.modelQueue[0],actionName:MODEL_ACTION_NAME.GJ,parent:t.parent,loadFinishCB:function(e){e.filters=[n.fenShenColorFlilter]}})},e.prototype.handleTargetEffectPia=function(i,e,n,o){var a=this;void 0===o&&(o=void 0),e?e.forEach(function(e){var t=[i.modelPos[e.posType][0],i.modelPos[e.posType][1]];DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,scaleX:n,timeScale:a.timeScale,x:t[0],y:t[1],z:e.z,effectName:e.src[0],parent:a.gp_battle,doneCB:function(){o&&o()}})}):o&&o()},e.prototype.handleTargetEffect=function(r,s,c,l,h,p,d){var u=this;void 0===l&&(l=1),void 0===h&&(h=1),void 0===p&&(p=1),void 0===d&&(d=void 0),p=1;var g=[c.modelPos[s.posType][0],c.modelPos[s.posType][1]],f=r.camp==EBattleSide.EBattleSideAttack?1:-1,e=s.src[(l-1)%s.src.length];if(0==s.type)this.log("直接目标身上播放",r.curEntity.entityId,e,l,h),DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,scaleX:f,timeScale:this.timeScale*(s.timeScale||1)*p,x:g[0],y:g[1],z:s.z,effectName:e,parent:this.gp_battle}),egret.setTimeout(function(){c.onAttackFrame(l,h),d&&d()},this,(s.piaDelay||0)/this.timeScale/p);else if(1==s.type||4==s.type||5==s.type){var _=[r.modelPos[3][0],r.modelPos[3][1]];if(s.scaleX&&(f*=s.scaleX),5==s.type){var t=FIGHT_CONST.FIGHT_POS[this.fightPy.positionTypes[c.camp]][0];g=0<=f?[this.gp_battle.width+t[0],this.gp_battle.height/2+t[1]]:[-this.gp_battle.width+t[0],this.gp_battle.height/2+t[1]]}DragonBoneTools.create(e,function(e){var t=new egret.Point(_[0],_[1]),i=new egret.Point(g[0],g[1]),n=egret.Point.distance(t,i),o=s.fixedWidth||e.width,a=void 0;o<n?(a=egret.Point.interpolate(t,i,o/n),u.log("距离修正",o/n,a.x,a.y,i.x,i.y)):a=i,s.offsetStart&&(_[0]=_[0]+f*s.offsetStart[0],_[1]=_[1]+f*s.offsetStart[1]);var r=Utils.MathUtils.getDegByAB(a.y-_[1],a.x-_[0]);e.scaleX=f,e.rotation=(f<0?180:0)+r,e.x=_[0],e.y=_[1],s.scaleY&&(e.scaleY=s.scaleY),e.animation.timeScale=u.timeScale,u.gp_battle.addChild(e),e.animation.play(s.src,0),4==s.type?(e.x=a.x,e.y=a.y,egret.Tween.get(e).to({x:_[0],y:_[1]},s.dt/u.timeScale/p).call(function(){e&&e.parent&&e.parent.removeChild(e),c.onAttackFrame(l,h),d&&d()})):egret.Tween.get(e).to({x:a.x,y:a.y},s.dt/u.timeScale/p).call(function(){e&&e.parent&&e.parent.removeChild(e),c.onAttackFrame(l,h),d&&d()}),egret.Point.release(a)},void 0,{cleanByManualAfterRemove:!0,cacheAsBitmap:!1})}else if(2==s.type){var a=[r.modelPos[3][0],r.modelPos[3][1]];DragonBoneTools.create(e,function(e){s.offsetStart&&(a[0]=a[0]+f*s.offsetStart[0],a[1]=a[1]+f*s.offsetStart[1]);var t=Utils.MathUtils.getDegByAB(g[1]-a[1],g[0]-a[0]),i=new egret.Point(a[0],a[1]),n=new egret.Point(g[0],g[1]),o=egret.Point.distance(i,n);e.scaleX=f*o/(s.fixedWidth?s.fixedWidth:e.width),e.rotation=(f<0?180:0)+t,e.x=a[0],e.y=a[1],e.animation.timeScale=u.timeScale*(s.timeScale||1),u.gp_battle.addChild(e),e.animation.play(s.src),egret.setTimeout(function(){e&&e.parent&&e.parent.removeChild(e),c.onAttackFrame(l,h),d&&d()},u,s.dt/u.timeScale/p)},void 0,{cleanByManualAfterRemove:!0,cacheAsBitmap:!1})}else if(3==s.type){var m=[r.modelPos[3][0],r.modelPos[3][1]];DragonBoneTools.create(e,function(e){s.offsetStart&&(m[0]=m[0]+f*s.offsetStart[0],m[1]=m[1]+f*s.offsetStart[1]);var t=Utils.MathUtils.getDegByAB(g[1]-m[1],g[0]-m[0]),i=new egret.Point(m[0],m[1]),n=new egret.Point(g[0],g[1]),o=egret.Point.distance(i,n),a=f*o/e.width;e.rotation=(f<0?180:0)+t,e.scaleX=0,e.x=m[0],e.y=m[1],e.animation.timeScale=u.timeScale,u.gp_battle.addChild(e),e.animation.play(s.src),egret.Tween.get(e).to({scaleX:a},s.dt/u.timeScale/p).to({scaleX:0},s.dt/u.timeScale/p).call(function(){e&&e.parent&&e.parent.removeChild(e),s.tarFlyConfig||(c.onAttackFrame(l,h),d&&d())}),s.tarFlyConfig&&2==s.tarFlyConfig[0]&&egret.Tween.get(c).wait(s.dt/u.timeScale/p).to({x:r.x,y:r.y},s.dt/u.timeScale/p).wait(s.tarFlyConfig[2]/u.timeScale/p).call(function(){c.resetAfterSeq(),e&&e.parent&&e.parent.removeChild(e),c.onAttackFrame(l,h),d&&d()},u,void 0,!0)},void 0,{cleanByManualAfterRemove:!0,cacheAsBitmap:!1})}else 6==s.type&&(DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,scaleX:f,timeScale:this.timeScale*(s.timeScale||1)*p,x:g[0],y:g[1],z:s.z,effectName:e,parent:this.gp_battle}),egret.setTimeout(function(){c.onAttackFrame(l,h),d&&d()},this,(s.piaDelay||0)/p))},e.prototype.handleSkill=function(l,h,p,d,u,e,g){var f=this;void 0===e&&(e=!1),void 0===g&&(g={});var _=l.camp==EBattleSide.EBattleSideAttack?1:-1,m=[],t=0,i=!1;if(p.delyByPia&&p.effectsTarPia&&egret.warn("不支持delyByPia和effectsTarPia共用"),p.customAct&&this.handleCustomAct(p.customAct,l),!p.noGJ)if(0==p.meFlyConfig[0])l.playAction(MODEL_ACTION_NAME.GJ,1,function(){l.playAction()});else if(1==p.meFlyConfig[0])m[0]={},m[0].x=this.gp_battle.width/2-_*p.meFlyConfig[1],m[0].y=this.gp_battle.height/2+p.meFlyConfig[2];else if(2==p.meFlyConfig[0]){var n=l.modelPos[2][0];n=l.camp==EBattleSide.EBattleSideAttack?-n:n,h.forEach(function(e,t){m[t]={},m[t].x=e.modelPos[1][0]+n,m[t].y=e.modelPos[1][1]+10})}else if(3==p.meFlyConfig[0])for(var o=0,a=h;o<a.length;o++){var r=a[o];this.showFenShen(l,r)}var s=m.shift();s&&(t=FIGHT_CONST.ACT_FACE_2_FACE_FLY_T,p.effectFly&&p.effectFly.forEach(function(e,t){DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,scaleX:_,timeScale:f.timeScale*(e.timeScale||1),x:l.modelPos[e.posType][0]+(e.offset&&e.offset[0]?e.offset[0]*_:0),y:l.modelPos[e.posType][1]+(e.offset&&e.offset[1]?e.offset[1]:0),effectName:e.src[0],parent:f.gp_battle})}),l.isComboing||p.isComboing?egret.Tween.get(l).to({x:s.x,y:s.y},FIGHT_CONST.ACT_FACE_2_FACE_FLY_T/this.timeScale).call(function(){l.setZOrder(!0),l.playAction(MODEL_ACTION_NAME.GJ,1,function(){l.playAction()})}):egret.Tween.get(l).to({x:s.x,y:s.y},FIGHT_CONST.ACT_FACE_2_FACE_FLY_T/this.timeScale).call(function(){l.setZOrder(!0),l.playAction(MODEL_ACTION_NAME.GJ,1,function(){l.playAction()})}).wait((l.flyBackDelay+(p.meFlyConfig[3]||0))/this.timeScale).to({x:l.modelPos[1][0],y:l.modelPos[1][1]},FIGHT_CONST.ACT_FACE_2_FACE_FLY_T/2/this.timeScale).call(function(){l.setZOrder(!1)})),egret.setTimeout(function(){p.effectSrc&&p.effectSrc.forEach(function(e,t){egret.setTimeout(function(){DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,scaleX:_,timeScale:f.timeScale*(e.timeScale||1),x:(s?s.x:l.modelPos[e.posType][0])+(e.offset&&e.offset[0]?e.offset[0]*_:0),y:(s?s.y:l.modelPos[e.posType][1])+(e.offset&&e.offset[1]?e.offset[1]:0),effectName:e.src[0],parent:f.gp_battle})},f,(l.allAttkDelay+(e.delay||0))/f.timeScale)}),p.effectQP&&p.effectQP.forEach(function(s,e){var t=FIGHT_CONST.FIGHT_POS[f.fightPy.positionTypes[l.camp]][0];egret.setTimeout(function(){var a=0,r=1;DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,scaleX:s.scaleX?s.scaleX*_:_,scaleY:s.scaleY,z:s.z,timeScale:f.timeScale*(s.timeScale||1),x:f.gp_battle.width/2+t[0]+_*s.offset[0],y:f.gp_battle.height/2+t[1]+s.offset[1],effectName:s.src[0],parent:f.gp_battle,frameCB:function(e){if("pz"==e.name)c.AppFacade.getInstance().sendNotification(CN.FIGHT_PZ,{pz:3});else if(p.delyByPia)if("pia"==e.name){console.log("pia! "+r+"/"+a+", "+h.length);for(var t=0,i=h;t<i.length;t++){var n=i[t];if(n.onAttackFrame(r,a),s.piaEffect){var o=[n.modelPos[s.piaEffect.posType][0],n.modelPos[s.piaEffect.posType][1]];DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,scaleX:_,timeScale:f.timeScale,x:o[0],y:o[1],z:s.piaEffect.z,effectName:s.piaEffect.src[0],parent:f.gp_battle})}}r++}else"pia_count"==e.name&&(a=e.data&&e.data.ints&&e.data.ints[0])},doneCB:function(){p.delyByPia&&(u&&u(),u=void 0,d&&d(),d=void 0)}})},f,(l.allAttkDelay+(s.delay||0))/f.timeScale)}),p.effectsTar&&0<p.effectsTar.length&&(i=!0,p.effectsTar.forEach(function(c,e){egret.setTimeout(function(){var r=0,s=h.length;h.forEach(function(i,n){if(p.delyEachTar)for(var o=1,a=g[i.curEntity.entityId],e=function(t){p.speedUpEveryHurt&&0<r&&(o=1+p.speedUpEveryHurt*r),egret.setTimeout(function(){p.delyEachTarNeedGJByFrame&&(l.updataSpeed(p.delyEachTarNeedGJByFrame[1]*o),l.gotoAndPlayByFrame(MODEL_ACTION_NAME.GJ,p.delyEachTarNeedGJByFrame[0])),egret.setTimeout(function(){f.handleTargetEffect(l,c,i,t,a,o,function(){if(p.delyEachTarNeedGJByFrame&&t==a)if(n==s-1)l.updataSpeed(),l.playAction(),l.x==l.modelPos[1][0]&&l.y==l.modelPos[1][1]||egret.Tween.get(l).to({x:l.modelPos[1][0],y:l.modelPos[1][1]},FIGHT_CONST.ACT_FACE_2_FACE_FLY_T/2/f.timeScale/o).call(function(){l.setZOrder(!1)});else if(0<m.length){var e=m.shift();egret.Tween.get(l).to({x:e.x,y:e.y},FIGHT_CONST.ACT_FACE_2_FACE_FLY_T/f.timeScale/o).call(function(){l.setZOrder(!0)})}f.handleTargetEffectPia(i,p.effectsTarPia,_,function(){s-1==n&&t==a&&(u&&u(),u=void 0,d&&d(),d=void 0)})})},f,(c.delay||0)/f.timeScale/o)},f,((p.attackFrameDelay||0)+(p.delyEachTar?p.delyEachTar*(++r-1):0))/f.timeScale/o)},t=1;t<=a;t++)e(t);else f.handleTargetEffect(l,c,i,void 0,void 0,void 0,function(){f.handleTargetEffectPia(i,p.effectsTarPia,_),p.attackFrameDelay||(u&&u(),u=void 0)})})},f,p.delyEachTar?0:(c.delay||0)/f.timeScale)},f))},this,(l.allAttkDelay+t)/this.timeScale),!p.attackFrameDelay||p.delyEachTar||p.delyByPia||i||egret.setTimeout(function(){for(var e=0,t=h;e<t.length;e++){var i=t[e];i.onAttackFrame(),f.handleTargetEffectPia(i,p.effectsTarPia,_)}u&&f.gp_battle.once(egret.Event.ENTER_FRAME,function(){u&&u(),u=void 0},f)},this,(l.allAttkDelay+p.attackFrameDelay)/this.timeScale),p.delyEachTar||p.delyByPia||egret.setTimeout(function(){d&&d(),d=void 0},this,(l.allAttkDelay+(p.attackDoneDelay||1e3))/this.timeScale)},e.prototype.shoujiActionShine=function(e){var t=e.obj;egret.Tween.removeTweens(t),t.filters=[],egret.Tween.get(t).to({alpha:0},100/this.timeScale).to({alpha:1},100/this.timeScale).to({alpha:0},60/this.timeScale).to({alpha:1},60/this.timeScale).to({alpha:0},30/this.timeScale).to({alpha:1},30/this.timeScale).call(function(){e.doneCB&&e.doneCB.call(e.context)},this)},e.prototype.updateTimeScale=function(){this.timeScale=Utils.TimerManager.getTimeScale()},e.prototype.getHeroSideInfoById=function(e){return{camp:Math.floor(e/100),teamId:Math.floor(e%100/10),posId:e%10}},e.prototype.calEntityZOrderToView=function(e){},e.prototype.calEntityPosToView=function(e){var t=e.curEntity.entityId.toString(),i=t[t.length-1],n=FIGHT_CONST.FIGHT_POS[this.fightPy.positionTypes[e.camp]][e.camp][Number(i)];if(e.x=this.gp_battle.width/2+n[0],e.y=this.gp_battle.height/5*4+n[1],n[3]&&(e.scaleX=e.scaleY=n[3]),FIGHT_CONST.DEBUG_DRAW_FIGHT_MODEL_ORIGIN_POS){var o=new egret.Sprite;o.graphics.clear(),o.graphics.beginFill(16711680,1),o.graphics.drawRect(0,0,5,5),o.graphics.endFill(),o.x=e.x,o.y=e.y,this.gp_battle.addChild(o)}},e.prototype.quickSort=function(e,t){var i,n,o,a;if(i=n=o=0,!(t<e)){for(a=this.needSortChildrenArr[e].y,i=e,n=t;i!=n;){for(;this.needSortChildrenArr[n].y>=a&&i<n;)n--;for(;this.needSortChildrenArr[i].y<=a&&i<n;)i++;i<n&&(this.gp_battle.swapChildren(this.needSortChildrenArr[i],this.needSortChildrenArr[n]),o=this.needSortChildrenArr[i],this.needSortChildrenArr[i]=this.needSortChildrenArr[n],this.needSortChildrenArr[n]=o)}this.gp_battle.swapChildren(this.needSortChildrenArr[e],this.needSortChildrenArr[i]),o=this.needSortChildrenArr[e],this.needSortChildrenArr[e]=this.needSortChildrenArr[i],this.needSortChildrenArr[i]=o,this.quickSort(e,i-1),this.quickSort(i+1,t)}},e.prototype.resortZOrder=function(){this.needSortChildrenArr.splice(0);for(var e=void 0,t=0,i=this.gp_battle.$children;t<i.length;t++){var n=i[t];n.curEntity&&(null==n.zorder?this.needSortChildrenArr.push(n):(e||(e=[]),e.push(n)))}if(this.quickSort(0,this.needSortChildrenArr.length-1),e)for(var o=0,a=e;o<a.length;o++){var r=a[o];this.gp_battle.setChildIndex(r,-1)}},e}(BaseClass);c.FightTools=e,__reflect(e.prototype,"game.FightTools")}(game||(game={})),function(y){var e=function(d){function e(){var e=d.call(this)||this;return e.fightProxy=y.AppFacade.getInstance().retrieveProxy(y.FightPy.N),e.playerProxy=y.AppFacade.getInstance().retrieveProxy(y.PlayerPy.N),e.CAN_SKIP_FIGHT_TYPE=[1,3,5,6,7,9,10,11,13,14,15,19,20,22,23,25,26,33],e.haloCodesLeft=[],e.haloCodesRight=[],e.skinName="FightUISkin",e}return __extends(e,d),e.prototype.getParentView=function(){return GameRootLayer.gameLayer().panelLayer},e.prototype.childrenCreated=function(){var o=this;d.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_head);var e=Utils.LocalStorageUtil.getItem("FightUI_speed"),t=Number(e);if(t==FIGHT_CONST.SPEED_X2?Utils.UnlockMgr.checkPass(MODULE.FightSpeed,!1).allow||FIGHT_CONST.SPEED_X1:t=FIGHT_CONST.SPEED_X1,Utils.TimerManager.setTimeScale(t),this.fightProxy.timeScale=t,this.blb_speed.text=t==FIGHT_CONST.SPEED_X1?"x1":"x2",DragonBoneTools.create("common_shenqixulizhong",function(e){o.eff_shenqiXLZ=e,o.eff_shenqiXLZ.visible=!1,o.gp_pb_fade.addChild(e),e.animation.play("common_shenqixulizhong")}),DragonBoneTools.create("common_shenqixuliwancheng",function(e){o.eff_shenqiXLWC=e,o.eff_shenqiXLWC.x=o.gp_pb_fade.width/2,o.eff_shenqiXLWC.visible=!1,o.gp_pb_fade.addChild(e),e.animation.play("common_shenqixuliwancheng")}),this.pb_anger.labelFunction=function(e,t){return t<=e?(o.eff_shenqiXLWC&&(o.eff_shenqiXLWC.visible=!0),o.eff_shenqiXLZ&&(o.eff_shenqiXLZ.visible=!1)):0==e?(o.eff_shenqiXLZ&&(o.eff_shenqiXLZ.visible=!1),o.eff_shenqiXLWC&&(o.eff_shenqiXLWC.visible=!1)):(o.eff_shenqiXLWC&&(o.eff_shenqiXLWC.visible=!1),o.eff_shenqiXLZ&&(o.eff_shenqiXLZ.visible=!0,o.eff_shenqiXLZ.x=e/t*o.gp_pb_fade.width)),""},this.gp_speed.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){(this.fightProxy.fightType==EBattleType.EBattleTypeTest||Utils.UnlockMgr.checkPass(MODULE.FightSpeed).allow)&&(Utils.TimerManager.getTimeScale()===FIGHT_CONST.SPEED_X1?(Utils.TimerManager.setTimeScale(FIGHT_CONST.SPEED_X2),this.fightProxy.timeScale=FIGHT_CONST.SPEED_X2,this.blb_speed.text="x2"):(Utils.TimerManager.setTimeScale(FIGHT_CONST.SPEED_X1),this.fightProxy.timeScale=FIGHT_CONST.SPEED_X1,this.blb_speed.text="x1"),Utils.LocalStorageUtil.setItem("FightUI_speed",this.fightProxy.timeScale.toString()))},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=Utils.UnlockMgr.checkPass(MODULE.FightSkip,!1);e.allow||this.fightProxy.round&&this.fightProxy.round.roundNum>=FIGHT_CONST.ROUND_TO_SHOW_SKIP?y.AppFacade.getInstance().sendNotification(CN.FIGHT_SKIP_FIGHT):Utils.MsgUtils.addMidMsg(e.ext.tips)},this),this.btn_debug.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this),this.btn_chat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.UnlockMgr.checkPass(MODULE.Chat).allow&&y.AppFacade.getInstance().showSubView(y.ChatMediator.N,y.ChatMediator.SV.CHAT,{NextChannelType:EChatChannelType.SameServer})},this),this.btn_pause.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"恢复"==this.btn_pause.label?this.btn_pause.label="暂停":this.btn_pause.label="恢复",y.AppFacade.getInstance().sendNotification(CN.FIGHT_PAUSE)},this),this.btn_shuxing.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<this.haloCodesLeft.length&&y.AppFacade.getInstance().showSubView(y.HeroMediator.N,y.HeroMediator.SV.HERO_HALO,{codeList:this.haloCodesLeft})},this),this.gp_halo_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(o.fightProxy.fightType!=EBattleType.EBattleTypeWchess)0<o.haloCodesLeft.length&&y.AppFacade.getInstance().showSubView(y.HeroMediator.N,y.HeroMediator.SV.HERO_HALO,{codeList:o.haloCodesLeft});else{var e=o.haloCodesLeft,t=[],i=[];for(var n in e)i.indexOf(y.Config.chessHero()[e[n]])<0&&(t.push(e[n]),i.push(y.Config.chessHero()[e[n]]));0<t.length&&y.AppFacade.getInstance().showSubView(y.ZzqMediator.N,y.ZzqMediator.SV.HEROHALO,{codeList:t})}},this),this.gp_halo_right.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(o.fightProxy.fightType!=EBattleType.EBattleTypeWchess)if(0<o.haloCodesRight.length)y.AppFacade.getInstance().showSubView(y.HeroMediator.N,y.HeroMediator.SV.HERO_HALO,{codeList:o.haloCodesRight});else{var e=o.haloCodesRight,t=[],i=[];for(var n in e)i.indexOf(y.Config.chessHero()[e[n]])<0&&(t.push(e[n]),i.push(y.Config.chessHero()[e[n]]));0<t.length&&y.AppFacade.getInstance().showSubView(y.ZzqMediator.N,y.ZzqMediator.SV.HEROHALO,{codeList:t})}},this),Utils.DebugUtils.isDebug||(this.btn_pause.visible=!1),this.initEvrCM(),this.updateUI(void 0,!0),Utils.DebugUtils.isDebug&&this.fightProxy.reqFightParams&&this.fightProxy.reqFightParams.testSkill){this.btn_go=new eui.Button,this.btn_go.label="攻击",this.btn_go.width=200;var i=new eui.Button;i.label="刷新技能对应模型",i.width=200;var n=new eui.Button;n.label="近战",n.width=200;var a=new eui.Button;a.label="远程",a.width=200;var r=void 0;try{r=JSON.parse(Utils.LocalStorageUtil.getItem("FightTestInput_skill",!0))}catch(e){}var s=new eui.EditableText;s.width=Utils.DeviceUtils.curWidth()/3,s.prompt="输入攻击者id(111、211那些，格式:111)",r&&""!=r.et_attackId&&(s.text=r.et_attackId);var c=new eui.EditableText;c.width=Utils.DeviceUtils.curWidth()/3,c.prompt="输入特效名",r&&""!=r.et_skill&&(c.text=r.et_skill);var l=new eui.EditableText;l.width=Utils.DeviceUtils.curWidth()/3,l.prompt="输入受击者id(111、211那些，格式:[211,212,...])",r&&r.et_defend&&(l.text=r.et_defend);var h=new eui.EditableText;h.width=Utils.DeviceUtils.curWidth()/3,h.prompt="输入技能对应模型",r&&r.et_modelFixed&&(h.text=r.et_modelFixed);var p=function(e){var t={et_skill:e,et_attackId:s.text,et_defend:l.text,et_modelFixed:h.text};Utils.LocalStorageUtil.setItem("FightTestInput_skill",JSON.stringify(t),!0),egret.Ticker.getInstance().register(o.onEnterFrame,o),o.dt=0,y.AppFacade.getInstance().sendNotification(CN.FIGHT_LET_OBJ_RELEASE_SKILL,{id:Number(s.text),tIds:JSON.parse(l.text),skill:e,cb:function(){egret.Ticker.getInstance().unregister(o.onEnterFrame,o),y.AppFacade.getInstance().sendNotification(CN.FIGHT_LET_OBJ_RELEASE_SKILL,{id:JSON.parse(l.text)[0],tIds:[Number(s.text)],skill:e,cb:function(){}})}})};this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""!=c.text&&""!=s.text&&""!=l.text&&p(c.text)},this),a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""!=c.text&&""!=s.text&&""!=l.text&&p("common_skill_gong")},this),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""!=c.text&&""!=s.text&&""!=l.text&&p("common_skill_huikan")},this),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""!=h.text?y.AppFacade.getInstance().sendNotification(CN.FIGHT_CHANGE_ALL_MODEL,{modelFixed:h.text}):""!=c.text&&y.AppFacade.getInstance().sendNotification(CN.FIGHT_CHANGE_ALL_MODEL,{model:c.text})},this),s.left=0,c.horizontalCenter=0,h.horizontalCenter=0,h.top=45,l.right=0,i.top=this.btn_go.top=70,n.top=a.top=130,n.horizontalCenter=this.btn_go.horizontalCenter=-125,a.horizontalCenter=i.horizontalCenter=125,this.addChild(this.btn_go),this.addChild(i),this.addChild(s),this.addChild(c),this.addChild(l),this.addChild(h),this.addChild(a),this.addChild(n),egret.setTimeout(function(){y.FightTools.getInstance().resortZOrder()},this,5e3)}},e.prototype.initEvrCM=function(){this.gp_evr.objCMColorType=7,this.gp_evr._CMOffsetFactor=0,Object.defineProperty(this.gp_evr,"CMOffsetFactor",{get:function(){return this._CMOffsetFactor},set:function(e){if(this._CMOffsetFactor=e,!this.filters||0===this.filters.length){var t=new egret.ColorMatrixFilter([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);this.filters=[t]}var i=this.filters[0].matrix;4&this.objCMColorType&&(i[4]=255*e),2&this.objCMColorType&&(i[9]=255*e),1&this.objCMColorType&&(i[14]=255*e),this.filters[0].matrix=i}})},e.prototype.updateFightDetail=function(e){},e.prototype.updateUI=function(e,t){if(t)this.reset();else if(e.round&&(this.blb_round.text="回合"+this.fightProxy.round.roundNum,this.fightProxy.round.roundNum==FIGHT_CONST.ROUND_TO_SHOW_SKIP&&(this.btn_close.visible=!0)),null!=e.anger&&(this.pb_anger.value=e.anger),null!=e.angerMax&&(this.pb_anger.maximum=e.angerMax),e.focus&&this.setCameraFocue(e.focus),e.focusReset&&this.setCameraFocue(),null!=e.pz&&this.evrShake(e.pz),e.updateTeam){for(var i=0,n=this.fightProxy.sBattleResultVO.teams;i<n.length;i++){if((s=n[i]).playerId)s.camp==EBattleSide.EBattleSideAttack?(this.cu_ph_left.updateData({vo:s,ignoreLevel:1}),this.blb_level_left.text=s.level.toString(),this.lb_name_left.text=s.name):(this.cu_ph_right.updateData({vo:s,ignoreLevel:1}),this.blb_level_right.text=s.level.toString(),this.lb_name_right.text=s.name);else{var o=y.Config.allHeroConfig()[s.entities[0].code];s.camp==EBattleSide.EBattleSideAttack?(this.cu_ph_left.updateData({fixedHead:o.avatar}),this.blb_level_left.text="",this.lb_name_left.text=o.name):(this.cu_ph_right.updateData({fixedHead:o.avatar}),this.blb_level_right.text="",this.lb_name_right.text=o.name)}}Utils.UnlockMgr.checkPass(MODULE.FightSkipForVestage,!1).allow&&-1==this.CAN_SKIP_FIGHT_TYPE.indexOf(EBattleType.EBattleTypeVestage)&&this.CAN_SKIP_FIGHT_TYPE.push(EBattleType.EBattleTypeVestage),this.fightProxy.forceCanSkip||-1!=this.CAN_SKIP_FIGHT_TYPE.indexOf(Number(this.fightProxy.fightType))?this.btn_close.visible=!0:this.btn_close.visible=!1;for(var a=0,r=this.fightProxy.sBattleResultVO.teams;a<r.length;a++){var s=r[a];if(this.fightProxy.fightType!=EBattleType.EBattleTypeWchess){var c=this.haloCodesLeft,l=this.gp_halo_left;s.camp==EBattleSide.EBattleSideDefence&&(l=this.gp_halo_right,c=this.haloCodesRight),c.splice(0,c.length);s.entities;for(var h in s.entities){var p=s.entities[h];c.push(p.code)}var d=y.AppFacade.getInstance().retrieveProxy(y.HeroPy.N).getActivatedHaloId(c),u=y.Config.heroHaloConfig();for(var h in l.removeChildren(),d){var g=u[d[h]],f=new v({icon:y.GeneralConfig.getGuajiImg(g.img)[1]});s.camp==EBattleSide.EBattleSideDefence&&(f.scaleX=-1),l.addChild(f)}}else{c=this.haloCodesLeft,l=this.gp_halo_left;s.camp==EBattleSide.EBattleSideDefence&&(l=this.gp_halo_right,c=this.haloCodesRight),c.splice(0,c.length);s.entities;for(var h in s.entities){p=s.entities[h];c.push(p.code)}var _=[],m=[];for(var h in c)m.indexOf(y.Config.chessHero()[c[h]])<0&&(_.push(c[h]),m.push(y.Config.chessHero()[c[h]]));if(0<_.length){d=y.AppFacade.getInstance().retrieveProxy(y.HeroPy.N).getActivatedHaloId(_,!0),u=y.Config.heroHaloConfig();for(var h in d){g=u[d[h]],f=new ZzqHaloItem({icon:y.GeneralConfig.getGuajiImg(g.img)[1]});s.camp==EBattleSide.EBattleSideDefence&&(f.scaleX=-1),l.addChild(f)}}}}}},e.prototype.reset=function(){this.btn_close.visible=!1;this.fightProxy.getCustomParams();this.gp_evr.objCMColorType=7,this.gp_evr.CMOffsetFactor=0,this.img_bg.source=this.fightProxy.curLayerTheme&&this.fightProxy.curLayerTheme.bg||"dk_01_bg_01_png";var e=y.AppFacade.getInstance().retrieveMediator(y.FightMediator.N);e.getSubView(y.FightMediator.SV.ATTRIBUTE_CONTROL)&&e.hideSubView(y.FightMediator.SV.ATTRIBUTE_CONTROL)},e.prototype.setCameraFocue=function(e){},e.prototype.evrShake=function(e){void 0===e&&(e=3),Utils.ShakeUtils.shakeObj(this,.1,60,e)},e.prototype.onEnterFrame=function(e){this.dt+=e,this.btn_go&&(this.btn_go.label=this.dt.toString())},e}(BaseFull);y.FightUI=e,__reflect(e.prototype,"game.FightUI");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="AttributeControlSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(BasePanel);y.AttributeControl=t,__reflect(t.prototype,"game.AttributeControl");var v=function(i){function e(e){var t=i.call(this)||this;return t.skinName="FightHaloItem",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.img_icon.source=this.params.icon},e}(eui.ItemRenderer);__reflect(v.prototype,"FightHaloItem")}(game||(game={})),function(s){var e=function(i){function e(e){var t=i.call(this)||this;return t._autoCloseTime=3e3,t.skinName="FightBossDescSkin",t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data&&this.updateView(this.data)},e.prototype.updateView=function(e){var t=this;if(this.data=e,this.id=this.data.id,this.cb=this.data.cb,this.id){var i=s.Config.guideHeroShow()[this.id];if(!i)return;var n=s.Config.allHeroConfig()[this.id];this.heroModel.update({code:this.id,isStatic:!0}),this.lb_name.text=n.name,this.img_base.source=HeroRaceConfig[n.race].baseSrc,this.img_race.source=HeroRaceConfig[n.race].raceIconBig,this.lb_race.text=HeroRaceConfig[n.race].name,this.img_prof.source=ProfessionConfig[n.profession].icon,this.lb_prof.text=ProfessionConfig[n.profession].name;var o=new Array;o.push({text:i.desc1+"    "}),o.push({text:"\n\n",style:{size:10}}),o.push({text:"    "+i.desc2}),this.lb_desc.textFlow=o;var a=n.actSkill,r=s.Config.skillBaseConfig()[a];this.skillItem.updateItem({code:a}),this.lb_skillName.text=r.name,this.lb_skillDesc.text=r.desc,this.heroModel.visible=!1,UIActionManager.playUIAction(this.gp_model,3),UIActionManager.playUIAction(this.gp_bg,4,function(){t.heroModel.visible=!0;var e=t.heroModel.localToGlobal().y;t.heroModel.y-=e+t.heroModel.height,egret.Tween.get(t.heroModel).to({y:0},150).call(function(){Utils.ShakeUtils.shakeObj(t,.2,60,30),egret.setTimeout(function(){t.heroModel.changeAction(["gongji"]),t.timer||(t.timer=egret.setTimeout(t.autoClosePanel,t,t._autoCloseTime)),Utils.TouchUtils.addTouchListener(t.gp_root,function(){t.autoClosePanel()})},t,200)})})}},e.prototype.autoClosePanel=function(){var e=this;this.timer&&(egret.clearTimeout(this.timer),this.timer=void 0),UIActionManager.playUIAction(this.gp_model,3,void 0,void 0,!0),UIActionManager.playUIAction(this.gp_bg,4,function(){e.hide()},void 0,!0)},e.prototype.perClose=function(){this.cb&&this.cb()},e.prototype.onDestroy=function(){this.timer&&(egret.clearTimeout(this.timer),this.timer=void 0)},e}(BasePanel);s.FightBossDescView=e,__reflect(e.prototype,"game.FightBossDescView")}(game||(game={})),function(e){var t=function(){function e(){}return e.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.FightBuffIcon",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},e}();e.FightBuffIconFactory=t,__reflect(t.prototype,"customui.FightBuffIconFactory");var i=function(i){function e(e){var t=i.call(this)||this;return t.count=1,t}return __extends(e,i),e.prototype.jiayi=function(){this.count++,2<=this.count&&(this.blb.text=this.count.toString(),this.blb.visible=!0)},e.prototype.jianyi=function(){if(this.count--,1==this.count)this.blb.visible=!1;else if(this.count<=0)return!0},e.prototype.reset=function(){this.count=1,this.img_icon.source="",this.blb.text="",this.blb.visible=!1},e.prototype.initUI=function(){this.img_icon=new eui.Image,this.img_icon.width=this.img_icon.height=this.width=this.height=52,this.addChild(this.img_icon),this.blb=new eui.BitmapLabel,this.blb.scaleX=this.blb.scaleY=1.5,this.blb.right=0,this.blb.y=25,this.blb.font="white_num_fnt",this.addChild(this.blb)},e.prototype.onOPReset=function(){this.reset()},e.prototype.onOPComeBack=function(e,t){t&&this.initUI(),this.params=e,this.img_icon.source="_fight_m_json."+this.params.icon},e.prototype.onOPClean=function(){},e.prototype.onOPCheck=function(e){egret.log("alive")},e}(eui.Component);e.FightBuffIcon=i,__reflect(i.prototype,"customui.FightBuffIcon",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(customui||(customui={})),function(e){var t=function(){function e(){}return e.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.FightMagical",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},e}();e.FightMagicalFactory=t,__reflect(t.prototype,"customui.FightMagicalFactory");var i=function(n){function e(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var i=n.call(this)||this;return i.isFightMagical=!0,i.fightTools=game.FightTools.getInstance(),i.isMine=!1,i.modelPos=[],i.flyBackDelay=600,i.allAttkDelay=0,i.rgbOriginValue=[],i.isComboing=!1,i.skinName="FightModelSkin",i.buffQueue={},i.fightProxy=game.AppFacade.getInstance().retrieveProxy(game.FightPy.N),i}return __extends(e,n),e.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.gp_head.visible=!1,this.img_yinying.visible=!1,this.modelQueue=new Array},e.prototype.onModelCreate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return game.AppFacade.getInstance().sendNotification(CN.FIGHT_MODEL_CREATED,this.curEntity.entityId),[2]})})},e.prototype.gotoAndPlayByFrame=function(e,t,i,n){},e.prototype.playAction=function(e,t,i){},e.prototype.updataSpeed=function(e){},e.prototype.updateBuffBeforAttack=function(e){return!0},e.prototype.updateEntity=function(e){this.curEntity.anger=this.pb_anger.value=e.anger,this.isMine&&game.AppFacade.getInstance().sendNotification(CN.FIGHT_FIGHT_UPDATE_UI,{anger:e.anger})},e.prototype.pushCurOnAttackFrame=function(e){},e.prototype.onAttackFrame=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0)},e.prototype.popSth=function(e,t){void 0===t&&(t=0)},e.prototype.handleSeqBattleRes=function(t,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.updateEntity(t),[2,this.handleBuff(t.buffAdd,t.buffRemove,i)]})})},e.prototype.handleBuff=function(e,t,i){},e.prototype.updateBuff=function(){},e.prototype.addChildAsEff=function(e){this.addChildAt(e,this.getChildIndex(this.gp_model)+1)},e.prototype.releaseSkill=function(o,a,r,s,c,e){return void 0===c&&(c=!1),void 0===e&&(e={}),__awaiter(this,void 0,void 0,function(){var t,i,n;return __generator(this,function(e){switch(e.label){case 0:return this.isComboing=c,[4,this.appear()];case 1:return e.sent(),t=game.Config.skillBaseConfig()[o],i=t&&t.modelId||"","string"==typeof o&&(i=o),""==i?[2,r()]:((n=game.Config.skillConfig()[i])||(egret.warn("该技能"+i+"还没调，使用临时技能"),n=game.Config.skillConfig().common_skill_gong_1),this.fightTools.handleSkill(this,a,n,r,s),this.dismiss(),[2])}})})},e.prototype.holdOn=function(n,o){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(e){return[2,new Promise(function(e,t){egret.setTimeout(function(){i&&i.parent&&(o&&o(),e())},i,n/Utils.TimerManager.getTimeScale())})]})})},e.prototype.appear=function(){var i=this,e=1;this.visible=!0;var t=void 0;return this.camp==EBattleSide.EBattleSideDefence?(t=this.fightTools.gp_battle.width,e=-1):t=0,DragonBoneTools.playOnce({cacheAsBitmap:!1,scaleX:e,z:-1,effectName:"common_shenqichuxian_1",parent:this.fightTools.gp_battle}),DragonBoneTools.playOnce({cacheAsBitmap:!1,scaleX:e,z:this.parent.getChildIndex(this)-1,effectName:"common_shenqichuxian_2",parent:this.fightTools.gp_battle}),this.x=t,new Promise(function(e,t){egret.Tween.get(i).to({x:i.modelPos[1][0]},700,egret.Ease.bounceOut).call(function(){game.AppFacade.getInstance().sendNotification(CN.FIGHT_PZ,{pz:5}),e()})})},e.prototype.shouji=function(){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(e){return this.playAction(MODEL_ACTION_NAME.SJ,1,function(){i.playAction()}),[2,new Promise(function(e){var t=new egret.ColorMatrixFilter([1,0,0,0,200,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);i.gp_model.filters=[t],egret.setTimeout(function(){i.gp_model.filters=[],e()},i,150)})]})})},e.prototype.handleDead=function(){},e.prototype.dismiss=function(){var i=this;return new Promise(function(e,t){UIActionManager.fadeIn(i,FIGHT_CONST.MODEL_APPEAR_FINAL/Utils.TimerManager.getTimeScale(),function(){i.alpha=1,i.visible=!1},!0)})},Object.defineProperty(e.prototype,"CMOffsetFactor",{get:function(){return this._CMOffsetFactor},set:function(e){if(0===(this._CMOffsetFactor=e))this.gp_model.filters=[],this.rgbOriginValue=[];else{if(!this.filters||0===this.filters.length){var t=new egret.ColorMatrixFilter([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);this.gp_model.filters=[t]}var i=this.gp_model.filters[0].matrix,n=0;8&this.objCMColorType?(4&this.objCMColorType&&(i[4]=255*e),2&this.objCMColorType&&(i[9]=255*e),1&this.objCMColorType&&(i[14]=255*e),null!=this.rgbOriginValue[0]&&(i[0]=this.rgbOriginValue[0]*(1-e)),null!=this.rgbOriginValue[1]&&(i[6]=this.rgbOriginValue[1]*(1-e)),null!=this.rgbOriginValue[2]&&(i[12]=this.rgbOriginValue[2]*(1-e))):(4&this.objCMColorType&&(i[4]=255*e,n|=4),2&this.objCMColorType&&(i[9]=255*e,n|=2),1&this.objCMColorType&&(i[14]=255*e,n|=1),4&~n&&(void 0===this.rgbOriginValue[0]&&(this.rgbOriginValue[0]=i[0]),i[0]=this.rgbOriginValue[0]/3*e),2&~n&&(void 0===this.rgbOriginValue[1]&&(this.rgbOriginValue[1]=i[6]),i[6]=this.rgbOriginValue[1]/3*e),1&~n&&(void 0===this.rgbOriginValue[2]&&(this.rgbOriginValue[2]=i[12]),i[12]=this.rgbOriginValue[2]/3*e)),this.gp_model.filters[0].matrix=i}},enumerable:!0,configurable:!0}),e.prototype.setZOrder=function(e){e&&this.parent.setChildIndex(this,-1)},e.prototype.resetAfterSeq=function(e){void 0===e&&(e=!1),this.isComboing=e,this.isComboing||(this.x=this.modelPos[1][0],this.y=this.modelPos[1][1])},e.prototype.onOPReset=function(){egret.Tween.removeTweens(this),this.gp_model.removeChildren()},e.prototype.onOPComeBack=function(e,t){var i=this;this.visible=!1,this.curEntity=e.entity,this.config=game.Config.allMagicalConfig()[this.curEntity.code],this.camp=e.camp,this.isMine=e.isMine,this.pb_anger.value=this.curEntity.anger,this.pb_anger.minimum=0,this.pb_anger.maximum=this.curEntity.angerMax;var n=void 0;n=""==this.config.model?"shenbing_img_wuqi01":this.config.model,RES.getResAsync(ResourceUtils.png(n),function(e){var t=new eui.Image;t.source=e,i.display=t,i.width=i.gp_model.width=Math.abs(e.textureWidth*t.scaleX),i.height=i.gp_model.height=Math.abs(e.textureHeight*t.scaleY),t.x=0,t.y=i.gp_model.height/2,i.gp_model.addChild(t),i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height,i.fightTools.calEntityPosToView(i),i.modelPos=[[i.x,i.y-i.height/2],[i.x,i.y],[i.x,i.y],[i.x,i.y]],i.onModelCreate()},this),this.zorder=1e3,this.fightTools.calEntityZOrderToView(this)},e.prototype.onOPClean=function(){},e.prototype.onOPCheck=function(e){egret.log("alive")},e}(eui.Component);e.FightMagical=i,__reflect(i.prototype,"customui.FightMagical",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(customui||(customui={})),function(y){var e=function(){function e(){}return e.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.FightModel",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},e}();y.FightModelFactory=e,__reflect(e.prototype,"customui.FightModelFactory");var t=function(n){function e(e,t){void 0===e&&(e=!1),void 0===t&&(t=!1);var i=n.call(this)||this;return i.isFightMagical=!1,i.fightTools=game.FightTools.getInstance(),i.modelPos=[],i.flyBackDelay=600,i.allAttkDelay=0,i.rgbOriginValue=[],i.curBuffStatus=0,i.isComboing=!1,i.markCurFrameNeedShouJi=!1,i.popIndex=0,i.totalCurOnAttackFrameCount=0,i.skinName="FightModelSkin",i.buffType2Obj={},i.buffType2EffDict={},i.ress=new Array,i.modelQueue=new Array,i.fightProxy=game.AppFacade.getInstance().retrieveProxy(game.FightPy.N),i}return __extends(e,n),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【FightModel】："].concat(e))},e.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.pb_hp.slideDuration=250},e.prototype.onModelCreate=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.visible=!0,this.display.animation.timeScale=Number(Utils.TimerManager.getTimeScale()),[4,this.appear()];case 1:return e.sent(),this.playAction(),game.AppFacade.getInstance().sendNotification(CN.FIGHT_MODEL_CREATED,this.curEntity.entityId),[2]}})})},e.prototype.checkCurBuffStatus=function(){this.display&&(1&this.curBuffStatus?this.display.animation.stop():this.display&&!this.display.animation.isPlaying&&this.playAction()),2&this.curBuffStatus?UIActionManager.setAbsGrey(this.gp_model):UIActionManager.setAbsGrey(this.gp_model,!1)},e.prototype.gotoAndPlayByFrame=function(e,t,i,n){this.display&&this.display.animation.gotoAndPlayByFrame(e,t,i)},e.prototype.playAction=function(e,t,i){var n=this;this.display&&(i&&(this.onModelComplete=function(){n.checkCurBuffStatus(),n.onModelComplete=void 0,i()}),this.display.animation.play(e||MODEL_ACTION_NAME.DJ,t))},e.prototype.updataSpeed=function(e){this.parent&&this.display&&(this.display.animation.timeScale=(e||1)*Number(Utils.TimerManager.getTimeScale()))},e.prototype.updateBuffBeforAttack=function(e){return!0},e.prototype.updateEntity=function(e){this.curEntity.life=this.pb_hp.value=Math.max(e.life,0),null!=e.anger&&(this.curEntity.anger=this.pb_anger.value=e.anger),this.updateAngerEff()},e.prototype.updateAngerEff=function(){this.display_nengliangtiao&&(this.display_nengliangtiao.visible=this.pb_anger.value>=this.pb_anger.maximum)},e.prototype.pushCurOnAttackFrame=function(e){this.ress.push(e),this.totalCurOnAttackFrameCount=this.ress.length},e.prototype.onAttackFrame=function(e,t){if(void 0===e&&(e=1),void 0===t&&(t=1),0!=this.ress.length)if(1<t)e==t?this.onAttackFrame():e%Math.max(1,Math.floor(t/this.totalCurOnAttackFrameCount))==0&&this.handleSeqBattleRes(this.ress.shift(),game.FightState.ATTACK_ING);else{for(var i=0,n=this.ress;i<n.length;i++){var o=n[i];this.handleSeqBattleRes(o,game.FightState.ATTACK_ING)}this.ress.splice(0)}},e.prototype.popSth=function(e,t){if(void 0===t&&(t=0),this.parent){if(e&&0!=e||t){var i=y.FightPopTipsFactory.create({camp:this.camp,timeScale:Utils.TimerManager.getTimeScale(),content:e,status:t,x:this.x,y:this.y-this.height/2-30*this.popIndex++,height:this.height});this.parent.addChildAt(i,-1)}}else egret.error("该模型已经被移除，不能飘字",e,t)},e.prototype.handleSeqBattleRes=function(e,t){var i=e.value;this.popSth(i,e.status),i<0&&this.shouji(),this.handleBuff(e.buffAdd,e.buffRemove,t),this.updateEntity(e)},e.prototype.handleBuff=function(e,t,f){var _=this;if(e)for(var i=function(i){var e=game.Config.buffResConfig()[i.type];if(!e)return"continue";if(f==game.FightState.ROUND_END)m.log("handleBuff game.FightState.ROUND_END",i.value),m.popSth(i.value),i.value<0&&m.shouji();else{var n=game.Config.skillConfig().buff[e.type],o=1,t=0,a=void 0,r=0;if(n){if(n.popValue)return m.popSth(i.value),i.value<0&&m.shouji(),"continue";if(null!=n.fixedScaleX&&(o=n.fixedScaleX),n.pz&&game.AppFacade.getInstance().sendNotification(CN.FIGHT_PZ,{pz:n.pz}),n.buffStatus&&(m.curBuffStatus|=n.buffStatus),t=2==n.posType?m.height:-20,n.campScale&&m.camp==EBattleSide.EBattleSideDefence&&(o=-1),n.fixedIcon)if(m.buffType2EffDict[i.type])m.buffType2EffDict[i.type].count++;else{var s=new eui.Image;s.source=e.icon,s.bottom=m.height-t,s.horizontalCenter=0,s.scaleX=o,m.buffType2EffDict[i.type]={objs:[s],c:n,count:1},m.addChildAt(s,m.getChildIndex(m.gp_model)+1)}var c;if(n.noIcon&&(m.buffType2EffDict[i.type]?m.buffType2EffDict[i.type].count++:m.buffType2EffDict[i.type]={c:n,count:1}),r=n.effs?1:0,a=n.modelRep,n.hideInfo&&(m.gp_head.visible=!1),n.fenShen)(c=game.GameMVC.fightMed.getFightModelById(m.fightProxy.seqAttack.entityId))&&m.fightTools.showFenShen(c,m,n.fenShenTimeScale);if(n.fuchouzhihun)if(c=game.GameMVC.fightMed.getFightModelById(i.value)){var l=void 0,h=void 0;c.curDermaIndex?l="hero_skin_091_01_tz":(l=c.modelQueue[c.modelQueue.length-1]||"hero_091_01",h=m.fightTools.fenShenColorFlilter),a={preEff:n.fuchouzhihun.preEff,model:l,filters:h}}}if(n&&n.fixedIcon)return"continue";var p=e.modelId;if(e.dermaModelId&&null!=m.curDermaIndex&&(p=JSON.parse(e.dermaModelId)[m.curDermaIndex-1]||p),p||a)if(m.buffType2EffDict[i.type])m.buffType2EffDict[i.type].count++;else if(m.buffType2EffDict[i.type]={objs:[],c:n,count:1},r)for(var d=function(t){DragonBoneTools.create(t.src,function(e){_.buffType2EffDict[i.type]&&(_.buffType2EffDict[i.type].objs.push(e),e.x=_.width/2,e.scaleX=o,2==t.posType?e.y=_.height:e.y=-20,e.animation.timeScale=Utils.TimerManager.getTimeScale(),null!=t.z?_.gp_model.addChildAt(e,t.z):_.gp_model.addChild(e),n?e.animation.play(t.src,null==n.playTimes?-1:n.playTimes):e.animation.play(t.src))},void 0,{cleanByManualAfterRemove:!0,cacheAsBitmap:!1})},u=0,g=n.effs;u<g.length;u++){d(g[u])}else a?m.modelRep(a):DragonBoneTools.create(p,function(e){_.buffType2EffDict[i.type]&&(_.buffType2EffDict[i.type].objs.push(e),e.scaleX=o,e.x=_.width/2,e.y=t,e.animation.timeScale=Utils.TimerManager.getTimeScale(),_.gp_model.addChild(e),n?e.animation.play(p,null==n.playTimes?-1:n.playTimes):e.animation.play(p))},void 0,{cleanByManualAfterRemove:!0,cacheAsBitmap:!1});else e.icon&&(m.buffType2Obj[e.type]?m.buffType2Obj[e.type].jiayi():(m.buffType2Obj[e.type]=y.FightBuffIconFactory.create({icon:e.icon}),m.gp_buffs.addChild(m.buffType2Obj[e.type])))}},m=this,n=0,o=e;n<o.length;n++){i(o[n])}t&&t.forEach(function(e,t){var i=this.buffType2EffDict[e];if(i){if(null==i.count||--i.count<=0){if(i.c){if(i.c.buffStatus&&(this.curBuffStatus^=i.c.buffStatus),!i.c.noIcon&&Array.isArray(i.objs))for(var n=0,o=i.objs;n<o.length;n++){var a=o[n];a.parent&&a.parent.removeChild(a)}if(i.c.modelRep&&this.modelRep(i.c.modelRep,!0),i.c.hideInfo&&(this.gp_head.visible=!0),i.c.buffSubEff){var r=0;r=2==i.c.buffSubEff.posType?this.height:-20,DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,z:i.c.buffSubEff.z,timeScale:this.timeScale,x:this.width/2,y:r,effectName:i.c.buffSubEff.src,parent:this.gp_model})}}delete this.buffType2EffDict[e]}}else(i=this.buffType2Obj[e])&&i.jianyi()&&(this.gp_buffs.removeChild(i),delete this.buffType2Obj[e])},this),this.checkCurBuffStatus()},e.prototype.modelRep=function(c,e,l){var h=this;void 0===e&&(e=!1),void 0===l&&(l=!1);var p,d=void 0;if(this.curEntity.dermaCode){var t=game.Config.getHeroDermaConfig(this.curEntity.dermaCode);t&&(d=t.model)}else d=this.config.model;c.modelExt?d+=c.modelExt:d=c.model,p=c.preEff,e?(this.modelQueue.splice(this.modelQueue.indexOf(d),1),d=this.modelQueue[this.modelQueue.length-1]):this.modelQueue.push(d),DragonBoneTools.createForHero(d,function(e){var t=void 0,i=h.gp_model.width,n=h.gp_model.height;h.display&&(t=h.display.parent.getChildIndex(h.display),h.display.parent.removeChild(h.display),h.display=void 0,p&&DragonBoneTools.playOnce({cleanByManualAfterRemove:!0,cacheAsBitmap:!1,timeScale:Utils.TimerManager.getTimeScale(),x:h.modelPos[1].x,y:h.modelPos[1].y,effectName:p,parent:h.gp_model})),(h.display=e).addEventListener(dragonBones.EventObject.FRAME_EVENT,function(e){h.onModelFrameEvent&&h.onModelFrameEvent(e)},h),e.addEventListener(dragonBones.EventObject.COMPLETE,function(e){h.onModelComplete&&h.onModelComplete()},h);var o=1;h.camp==EBattleSide.EBattleSideDefence&&(o=-1),e.scaleX=.5*o,e.scaleY=.5,h.width=h.gp_model.width=Math.abs(e.width*e.scaleX);var a=game.Config.heroModelOffsetConfig(d);if(a?(h.flyBackDelay=a.flyBackDelay?a.flyBackDelay:h.flyBackDelay,h.allAttkDelay=a.allAttkDelay?a.allAttkDelay:0,h.gp_head.bottom=a.headOY*e.scaleY,h.gp_head.horizontalCenter=a.headOX*e.scaleY,h.height=h.gp_model.height=a.headOY*e.scaleY):h.height=h.gp_model.height=FIGHT_CONST.DEFAULT_HEAD_OY*e.scaleY,e.x=h.gp_model.width/2,e.y=h.gp_model.height,null!=t?h.gp_model.addChildAt(e,t):h.gp_model.addChild(e),h.anchorOffsetX=h.width/2,h.anchorOffsetY=h.height,h.fightTools.calEntityPosToView(h),h.modelPos=[[h.x,h.y-h.height/2],[h.x,h.y],[a&&a.attkOX||0,0],[h.x+(a&&a.shejiOX*o||0),h.y+(a&&a.shejiOY||0)],[h.x,h.y-h.height]],(h.gp_model.width!=i||h.gp_model.height!=n)&&0<Object.keys(h.buffType2EffDict).length)for(var r in i=(h.gp_model.width-i)/2,n=(h.gp_model.height-n)/2,h.buffType2EffDict){var s=h.buffType2EffDict[r];s&&Array.isArray(s.objs)&&s.objs.forEach(function(e){e.x+=i,e.y+=n})}l?h.onModelCreate():(h.display.animation.timeScale=Number(Utils.TimerManager.getTimeScale()),h.playAction()),c.filters&&(e.filters=[c.filters])},this)},e.prototype.releaseSkill=function(e,i,n,o,t,a){void 0===t&&(t=!1),void 0===a&&(a={}),this.log("battle releaseSkill",e),this.isComboing=t;var r="",s=game.Config.skillBaseConfig()[e];if("string"==typeof e?r=e:(r=s&&s.modelId||"",null!=this.curDermaIndex&&s&&s.dermaModelId&&(r=JSON.parse(s.dermaModelId)[this.curDermaIndex-1]||r)),""==r)return egret.warn("该技能"+e+"没有配置模型"),void egret.setTimeout(function(){for(var e=0,t=i;e<t.length;e++){t[e].onAttackFrame()}o(),n()},this,1e3);var c=game.Config.skillConfig()[r];if(c||(egret.warn("该技能"+r+"还没调，使用临时技能"),c=game.Config.skillConfig().common_skill_zhanzhengnuhou),s&&s.sound&&""!=s.sound){var l=JSON.parse(s.sound)||[],h=l[0];null!=this.curDermaIndex&&l[this.curDermaIndex]&&(h=l[this.curDermaIndex]),h&&RES.hasRes(h)&&RES.getResAsync(h,function(e){Utils.SoundManager.playSound(h)},this)}this.fightTools.handleSkill(this,i,c,n,o,t,a)},e.prototype.holdOn=function(n,o){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(e){return[2,new Promise(function(e,t){egret.setTimeout(function(){i&&i.parent&&(o&&o(),e())},i,n/Utils.TimerManager.getTimeScale())})]})})},e.prototype.appear=function(){var i=this;return new Promise(function(e,t){UIActionManager.fadeIn(i,FIGHT_CONST.MODEL_APPEAR_FINAL/Utils.TimerManager.getTimeScale(),function(){e()})})},e.prototype.shouji=function(){var t=this;this.markCurFrameNeedShouJi||(this.markCurFrameNeedShouJi=!0),this.once(egret.Event.ENTER_FRAME,function(){t.playAction(MODEL_ACTION_NAME.SJ,1,function(){t.playAction()});var e=new egret.ColorMatrixFilter([1,0,0,0,200,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);t.gp_model.filters=[e],egret.setTimeout(function(){t.gp_model.filters=[],t.checkCurBuffStatus()},t,150),t.markCurFrameNeedShouJi=!1},this)},e.prototype.handleDead=function(e){var i=this;if(this.stage&&(this.popIndex=0,this.ress.splice(0),!(0<this.curEntity.life)))return this.log("死掉了",this.curEntity.entityId),new Promise(function(e,t){UIActionManager.fadeIn(i,FIGHT_CONST.MODEL_APPEAR_FINAL/Utils.TimerManager.getTimeScale(),function(){i.parent&&i.parent.contains(i)&&i.parent.removeChild(i)},!0)})},Object.defineProperty(e.prototype,"CMOffsetFactor",{get:function(){return this._CMOffsetFactor},set:function(e){if(0===(this._CMOffsetFactor=e))this.gp_model.filters=[],this.rgbOriginValue=[];else{if(!this.filters||0===this.filters.length){var t=new egret.ColorMatrixFilter([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]);this.gp_model.filters=[t]}var i=this.gp_model.filters[0].matrix,n=0;8&this.objCMColorType?(4&this.objCMColorType&&(i[4]=255*e),2&this.objCMColorType&&(i[9]=255*e),1&this.objCMColorType&&(i[14]=255*e),null!=this.rgbOriginValue[0]&&(i[0]=this.rgbOriginValue[0]*(1-e)),null!=this.rgbOriginValue[1]&&(i[6]=this.rgbOriginValue[1]*(1-e)),null!=this.rgbOriginValue[2]&&(i[12]=this.rgbOriginValue[2]*(1-e))):(4&this.objCMColorType&&(i[4]=255*e,n|=4),2&this.objCMColorType&&(i[9]=255*e,n|=2),1&this.objCMColorType&&(i[14]=255*e,n|=1),4&~n&&(void 0===this.rgbOriginValue[0]&&(this.rgbOriginValue[0]=i[0]),i[0]=this.rgbOriginValue[0]/3*e),2&~n&&(void 0===this.rgbOriginValue[1]&&(this.rgbOriginValue[1]=i[6]),i[6]=this.rgbOriginValue[1]/3*e),1&~n&&(void 0===this.rgbOriginValue[2]&&(this.rgbOriginValue[2]=i[12]),i[12]=this.rgbOriginValue[2]/3*e)),this.gp_model.filters[0].matrix=i}},enumerable:!0,configurable:!0}),e.prototype.setZOrder=function(e){this.fightTools.resortZOrder()},e.prototype.resetAfterSeq=function(e){void 0===e&&(e=!1),this.isComboing=e,this.x=this.modelPos[1][0],this.y=this.modelPos[1][1]},e.prototype.onOPReset=function(){for(var e in this.buffType2EffDict)if(Array.isArray(this.buffType2EffDict[e].objs))for(var t=0,i=this.buffType2EffDict[e].objs;t<i.length;t++){var n=i[t];n.parent&&n.parent.removeChild(n)}this.hero_soundchannel&&(this.hero_soundchannel.stop(),this.hero_soundchannel=void 0),this.curDermaIndex=void 0,this.scaleX=this.scaleY=1,this.alpha=1,this.curBuffStatus=0,this.gp_buffs.removeChildren(),this.buffType2Obj={},this.buffType2EffDict={},this.popIndex=0,this.ress.splice(0),this.modelQueue.splice(0),this.display_nengliangtiao&&this.display_nengliangtiao.parent==this.gp_head&&this.gp_head.removeChild(this.display_nengliangtiao),this.gp_head.visible=!0,this.display_nengliangtiao=void 0,this.display=void 0,egret.Tween.removeTweens(this),this.gp_model.removeChildren(),this.checkCurBuffStatus()},e.prototype.onOPComeBack=function(e,t){var i=this;this.visible=!1,this.curEntity=e.entity,this.config=this.fightProxy.getConfigByFightEntity(this.curEntity),this.camp=e.camp,this.curEntity.type==BattleEntityType.Boss?this.scaleX=this.scaleY=FIGHT_CONST.FIGHT_POS[this.fightProxy.positionTypes[this.camp]].BossScale||this.scaleX:this.scaleX=this.scaleY=1.1,this.pb_anger.value=this.curEntity.anger,this.pb_anger.minimum=0,this.pb_anger.maximum=this.curEntity.angerMax,this.pb_hp.value=this.curEntity.life,this.pb_hp.minimum=0,this.pb_hp.maximum=this.curEntity.lifeMax,this.img_type.source=HeroRaceConfig[this.config.race].raceIcon,this.lb_lv.text=this.curEntity.level&&this.curEntity.level.toString(),this.voiceGJName=this.config.voiceGJ;var n=void 0;if(""==this.config.model)n="hero_020_01";else if(n=this.config.model,this.curEntity.dermaCode){var o=game.Config.getHeroDermaConfig(this.curEntity.dermaCode);o&&(n=o.model,this.voiceGJName=o.voiceGJ,this.curDermaIndex=o.index)}DragonBoneTools.create("common_skill_nengliangtiaoman",function(e){(i.display_nengliangtiao=e).x=90,e.y=20,i.gp_head.addChild(e),e.animation.play("common_skill_nengliangtiaoman"),i.display_nengliangtiao.visible=!1,i.updateAngerEff()}),this.modelRep({model:n},void 0,!0),this.fightTools.calEntityZOrderToView(this)},e.prototype.onOPClean=function(){},e.prototype.onOPCheck=function(e){this.log("alive")},e}(eui.Component);y.FightModel=t,__reflect(t.prototype,"customui.FightModel",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(customui||(customui={})),function(e){var t=function(){function e(){}return e.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.FightPopTips",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},e}();e.FightPopTipsFactory=t,__reflect(t.prototype,"customui.FightPopTipsFactory");var i=function(i){function e(e){var t=i.call(this)||this;return t.factorO=[],t}return __extends(e,i),e.prototype.reset=function(){egret.Tween.removeTweens(this),this.width=100,this.height=50,this.scaleX=this.scaleY=1,this.alpha=1,AnchorUtil.calculateAndSetAr(this),this.blb.scaleX=this.blb.scaleY=1,this.img_status.source="",this.blb.visible=!1,this.blb.x=0,this.img_status.y=this.blb.y=this.height/2},e.prototype.runRecoverAction=function(){var e=this,t=this.params,i=t.timeScale;this.alpha=0,egret.Tween.get(this).to({alpha:1,y:this.y-50},FIGHT_CONST.POP_TIPS_FLY/i).to({alpha:0,y:this.y-100},FIGHT_CONST.POP_TIPS_FLY/i).call(function(){t.doneCB&&t.doneCB.call(e.params.context),e.parent.contains(e)&&e.parent.removeChild(e)},this)},e.prototype.runHurtAction=function(){var e=this,t=this.params,i=t.timeScale;this.params.camp==EBattleSide.EBattleSideAttack?this.factorO=[[0,0],[-15,-t.height/2],[-30,0]]:this.factorO=[[0,0],[15,-t.height/2],[30,0]],egret.Tween.get(this).to({factor:1},FIGHT_CONST.POP_TIPS_FLY/i).call(function(){e.params.camp==EBattleSide.EBattleSideAttack?e.factorO=[[-30,0],[-35,-t.height/5],[-40,0]]:e.factorO=[[30,0],[35,-t.height/5],[40,0]]},this).to({factor:0},0).to({factor:1},FIGHT_CONST.POP_TIPS_FLY/i/1.5).call(function(){e.params.camp==EBattleSide.EBattleSideAttack?e.factorO=[[-40,0],[-41.5,-t.height/8],[-42,0]]:e.factorO=[[40,0],[41.5,-t.height/8],[42,0]]},this).to({factor:0},0).to({factor:1},FIGHT_CONST.POP_TIPS_FLY/i/3).to({alpha:0},FIGHT_CONST.POP_TIPS_FLY/i).call(function(){t.doneCB&&t.doneCB.call(this.params.context),this.parent.contains(this)&&this.parent.removeChild(this)},this)},e.prototype.initUI=function(){this.root=new eui.Group,this.blb=new eui.BitmapLabel,this.root.addChild(this.blb),this.img_status=new eui.Image,this.root.addChild(this.img_status),this.root.verticalCenter=0,this.root.horizontalCenter=0,this.addChild(this.root)},e.prototype.onOPReset=function(){this.reset()},e.prototype.onOPComeBack=function(e,t){t&&this.initUI(),this.params=e,this.x=this.params.x,this.y=this.params.y-this.params.height/4,this.baseX=this.x,this.baseY=this.y;var i=Number(this.params.content),n=void 0,o=1;i&&(i<0?2&this.params.status?(this.blb.scaleX=this.blb.scaleY=1.5,n="fight_yellow_fnt"):n="fight_white_fnt":0<i&&(n="fight_green_fnt",o=2),this.blb.visible=!0,this.blb.font=n,this.blb.text=Math.abs(i).toString()),4&this.params.status&&(this.img_status.source="_fight_m_json.zhandou_txt_gedang",this.blb.x=100),2&this.params.status&&game.AppFacade.getInstance().sendNotification(CN.FIGHT_PZ,{pz:5}),1&this.params.status&&(this.img_status.source="_fight_m_json.icon_buff_sb",this.blb.x=70),1==o?this.runHurtAction():this.runRecoverAction()},e.prototype.onOPClean=function(){},e.prototype.onOPCheck=function(e){egret.log("alive")},Object.defineProperty(e.prototype,"factor",{get:function(){return 0},set:function(e){this.factorO&&(this.x=(1-e)*(1-e)*(this.baseX+this.factorO[0][0])+2*e*(1-e)*(this.baseX+this.factorO[1][0])+e*e*(this.baseX+this.factorO[2][0]),this.y=(1-e)*(1-e)*(this.baseY+this.factorO[0][1])+2*e*(1-e)*(this.baseY+this.factorO[1][1])+e*e*(this.baseY+this.factorO[2][1]))},enumerable:!0,configurable:!0}),e}(eui.Component);e.FightPopTips=i,__reflect(i.prototype,"customui.FightPopTips",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(customui||(customui={})),function(n){var d=function(t){function i(){var e=t.call(this)||this;return e.fightPy=n.AppFacade.getInstance().retrieveProxy(n.FightPy.N),e.skinName="FightRecordPanelSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.cu_xtck.blb_title.text="战斗记录",this.cu_xtck.onCloseCB=function(){e.hide()},this.sl_root.verticalScrollBar.visible=!1,this.sl_root.verticalScrollBar.autoVisibility=!1},i.prototype.updateView=function(e){var t=this;this.params=e,i.curTeamId=e.curTeamId,i.tips=e.tips||"排名",this.params.records?this.updateList(this.params.records):this.fightPy.CommonFightRecord(this.params.pb1,this.params.pb2,this.params.key,function(e){t.updateList(e)})},i.prototype.updateList=function(e){var i=this;this.sl_root.removeChildren();var t=new eui.List,n=new eui.VerticalLayout;n.gap=10,n.paddingBottom=n.paddingTop=10,n.horizontalAlign=egret.HorizontalAlign.CENTER,t.layout=n,this.sl_root.viewport=t;var o=new eui.ArrayCollection,a=0;e.forEach(function(e){var t=e;t.index=a,t.moduleId=i.params.moduleId&&i.params.moduleId,o.addItem(t),++a}),o.source.sort(function(e,t){return t.battleDt-e.battleDt}),this.gp_empty.visible=0==o.length,t.dataProvider=o,t.itemRenderer=r},i}(BasePanel);n.FightRecordPanel=d,__reflect(d.prototype,"game.FightRecordPanel");var r=function(i){function e(){var e=i.call(this)||this;return d.curTeamId?e.skinName="FightRecordPanelSkin_2":e.skinName="FightRecordPanelSkin_1",e.proxy=n.AppFacade.getInstance().retrieveProxy(n.FightPy.N),e.pPy=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N),e.cu_playerHead1=customui.PlayerHeadFactory.create(),e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.data.memberRecords;t.data.moduleId&&t.data.moduleId==MODULE.TeamArena&&0<e.length?PopUpManager.addPopUp({obj:new n.FightRecordPreviewPanel({index:t.data.index})}):t.proxy.BattlePlayBack(t.vo?t.vo.battleUuid:t.vo2.battleUuids)},this),this.lb_tips.text=d.tips,this.gp_heads.addChild(this.cu_playerHead1);var e=.7;d.curTeamId&&(e=.6),this.cu_playerHead1.scaleX=this.cu_playerHead1.scaleY=e},e.prototype.dataChanged=function(){var e,n=this;if(this.data.teamId){this.vo2=this.data,this.lb_name.text=this.vo2.team.name,e=this.vo2.challengerTeamId!=d.curTeamId?this.vo2.result===EBattleResult.EBattleResultWin?EBattleResult.EBattleResultLose:EBattleResult.EBattleResultWin:this.vo2.result;for(var t=this.vo2.team.members,i=0,o=0,a=0,r=t;a<r.length;a++){i+=r[a].baseInfo.fightCap,++o>=t.length&&(this.item_fightCap.blb_fightCap.text=""+Utils.MathUtils.formatNumStyle2(i))}if(this.gp_heads.numChildren<this.vo2.team.members.length)for(var s=this.vo2.team.members.length-this.gp_heads.numChildren;0<s;s--){var c=customui.PlayerHeadFactory.create(),l=.7;d.curTeamId&&(l=.6),c.scaleX=c.scaleY=l,this.gp_heads.addChild(c)}this.gp_heads.$children.forEach(function(e,t){var i=n.vo2.team.members[t];e.updateData({vo:i&&i.baseInfo,showTag:i&&i.isLeader})});var h=Number(this.vo2.rKey)-Number(this.vo2.pKey);0<h?(this.lb_change.textColor=4027448,this.lb_change.text=h.toString()):h<0?(this.lb_change.textColor=13107200,this.lb_change.text=h.toString()):(this.lb_change.textColor=6304792,this.lb_change.text="不变"),this.lb_time.visible=!1}else this.vo=this.data,this.lb_name.text=this.vo.baseInfo.name,e=this.vo.challengerId!=this.pPy.playerInfoVO.playerId?this.vo.result===EBattleResult.EBattleResultWin?EBattleResult.EBattleResultLose:EBattleResult.EBattleResultWin:this.vo.result,this.item_fightCap.blb_fightCap.text=""+Utils.MathUtils.formatNumStyle2(this.vo.baseInfo.fightCap),this.cu_playerHead1.updateData({vo:this.vo.baseInfo}),this.vo.rKey<this.vo.pKey?(this.lb_change.textColor=4259633,this.lb_change.text=this.vo.rKey.toString()):this.vo.rKey>this.vo.pKey?(this.lb_change.textColor=13107200,this.lb_change.text=this.vo.rKey.toString()):(this.lb_change.textColor=6304792,this.lb_change.text="不变"),this.lb_time.visible=!0;var p=this.vo||this.vo2;e===EBattleResult.EBattleResultWin?this.img_result.source="jjc_icon_sheng_png":this.img_result.source="jjc_icon_bai_png",this.lb_time.text=Utils.TimerManager.getTimeLeftDescBySecond(Utils.TimerManager.getServerTime()-p.battleDt)},e}(eui.ItemRenderer);__reflect(r.prototype,"FightRecordItemRender")}(game||(game={})),function(n){var e=function(i){function e(e){var t=i.call(this)||this;return t.proxy=n.AppFacade.getInstance().retrieveProxy(n.FightPy.N),t.battleZoneAreanPy=n.AppFacade.getInstance().retrieveProxy(n.BattleZoneArenaPy.N),t.skinName="FightRecordPreviewSkin",t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initView()},e.prototype.initView=function(){var e=this.data.record,t=e.challengerTeam.members,i=e.team.members,n=i.length;if(0==n)return Utils.MsgUtils.addMidMsg("暂无数据"),void PopUpManager.removePopUp(this);0<n&&n<2&&this.gp_all.removeChild(this.img_fenge_2);for(var o=function(e,t,i,n){for(var o=0,a=i;o<a.length;o++){var r=void 0,s=a[o].baseInfo,c=1==n?t.challengerId:t.beChallengerId,l=1==n?t.cHeroList:t.bHeroList;if(c==s.playerId){r={name:s.name,avatar:s.avatar,result:t.result,heroList:l},e.push(r);break}}},a=0,r=0,s=0,c=0,l=e.memberRecords;c<l.length;c++){var h=l[c];if(h.battleUuid){++r,h.result==EBattleResult.EBattleResultWin&&++s;var p=this["gp_items_"+a],d={team:[],uuid:h.battleUuid,index:a,resultData:{result:h.result,winC:s,loseC:r-s}};o(d.team,h,t,1),o(d.team,h,i,2);var u=new customui.RecordPreviewItem;u.updateData(d),p.addChild(u),++a}}this.gp_root.height+=40},e}(BasePanel);n.FightRecordPreviewPanel=e,__reflect(e.prototype,"game.FightRecordPreviewPanel")}(game||(game={})),function(y){var e=function(i){function e(e){var t=i.call(this)||this;return t.MILLSECOND=0,t.championProxy=y.AppFacade.getInstance().retrieveProxy(y.ChampionPy.N),t.teamExpePy=y.AppFacade.getInstance().retrieveProxy(y.TeamExpePy.N),t.fightPy=y.AppFacade.getInstance().retrieveProxy(y.FightPy.N),t.taopaoActName=["qianjin","jingxia","qianjin2"],t.taopaoActNameCurIndex=0,t.STRING_WAY=[{icon:"common_icon_yingxiongpeiyang_png",text:"英雄培养",clickFunc:function(){y.MainJumpConfig.jumpTo(MODULE.Hero)}},{icon:"common_icon_yingxiongzhaohuan_png",text:"英雄召唤",clickFunc:function(){y.MainJumpConfig.jumpTo(MODULE.HeroGaCha)}},{icon:"common_icon_jingcaihuodong_png",text:"精彩活动",clickFunc:function(){y.AppFacade.getInstance().showSubView(y.ActivityMediator.N,y.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.JINGCAI})}}],t.skinName="FightResultPanelSkin",t.touchEnabled=!1,Utils.SoundManager.stopBg(),t}return __extends(e,i),e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer),this.closeTimer&&egret.clearInterval(this.closeTimer),this.autoCloseScheId&&(egret.clearInterval(this.autoCloseScheId),this.autoCloseScheId=void 0),this.doneCB&&this.doneCB(),y.AppFacade.getInstance().sendNotification(CN.REWARD_CLOSE,{result:this.result}),y.AppFacade.getInstance().sendNotification(CN.FIGHT_RESULT_CLOSE,{result:this.result})},e.prototype.updateView=function(e,t){var i=this;void 0===t&&(t=!1),this.params=e,this.doneCB=e.doneCB,this.context=e.context,this.customParams=e.customParams,this.normalRewards=e.normalRewards,this.extRewards=e.extRewards,this.result=e.result,this.tips=e.tips||this.customParams&&this.customParams.tips,this.hurt=e.hurt,this.star=e.star,this.gp_new.y=(this.gp_main.height-this.gp_new.height)/2-100,this.gp_ret_0.visible=!0,this.gp_ret_1.visible=!1,this.btn_ok.visible=!0,this.fightPy.playbackResult&&(this.params=this.fightPy.playbackResult,this.result=this.fightPy.playbackResult.result);var n=this.params.battleType;if(0<=[EBattleType.EBattleTypePvP,EBattleType.EBattleTypeTeamArena,EBattleType.EBattleTypeTribeBattle].indexOf(n))return this.pvpResultData(),void this.displayNumbersVS();this.normalRewards&&0<this.normalRewards.length&&this.extRewards&&0<this.extRewards.length?console.log("爆机啦"):this.normalRewards&&0<this.normalRewards.length&&!(e.sClientReward&&0<e.sClientReward.length)||(this.sClientReward=e.sClientReward);var o=!1;switch(n){case EBattleType.EBattleTypeTeamExpedition:this.teamExpePy.isInTeam()&&0<this.fightPy.multiFightOriginPushs.length&&(o=!0);break;case EBattleType.EBattleTypeDailyFortress:if(this.result==EBattleResult.EBattleResultWin){var a=y.AppFacade.getInstance().retrieveProxy(y.CopyEntrancePy.N),r=a.curFortessId,s=y.Config.dailyFortressStage()[r];(c=a.dailyFortressInfo[s.fortressId])&&0<c.leftChallenge&&(o=!0)}break;case EBattleType.EBattleTypeHeroChallenge2:var c;if(this.result==EBattleResult.EBattleResultWin)if((c=this.fightPy.lastsFinalBattleResultVO.cbRet.info)&&!c.waitSelect.length){var l=y.AppFacade.getInstance().retrieveProxy(y.HeroChallenge2Py.N),h=l.challengeInfo.code,p=y.Config.heroChallengeStage(h+1);o=p&&p.model==l.curMode}break;case EBattleType.EBattleTypeChampion:this.result==EBattleResult.EBattleResultWin&&2!=this.championProxy.championInfo.id&&(o=!0);break;case EBattleType.EBattleTypeAbyssLair:o=!0}if(o?function(){if(i.gp_next.visible=!0,n==EBattleType.EBattleTypeTeamExpedition?(i.btn_ok.visible=!1,i.gp_next.x=i.gp_new.width/2):i.btn_ok.horizontalCenter=-125.5,n==EBattleType.EBattleTypeDailyFortress)i.cb_needGuide.visible=!1;else if(i.cb_needGuide.visible=!0,i.cb_needGuide.selected=n==EBattleType.EBattleTypeDailyFortress||n!=EBattleType.EBattleTypeTeamExpedition?i.championProxy.isZiDong:i.teamExpePy.isZiDong,i.cb_needGuide.selected){i.timer&&egret.clearInterval(i.timer);var e=5;i.timer=egret.setInterval(function(){0<--e?i.cb_needGuide.label="自动战斗（"+e+"s）":i.nextFight()},i,1e3)}}():(this.gp_next.visible=!1,this.btn_ok.horizontalCenter=0),e.autoClose){var d=5;this.lb_closeCd.visible=!0,this.lb_closeCd.text="等待关闭："+d+"秒",this.closeTimer=egret.setInterval(function(){0<d?i.lb_closeCd.text="等待关闭："+--d+"秒":i.hide()},this,1e3)}var u=new eui.List;this.sl_reward.viewport=u;var g=new eui.TileLayout;g.horizontalGap=15,g.horizontalAlign=egret.HorizontalAlign.CENTER,g.verticalAlign=egret.VerticalAlign.MIDDLE,g.verticalGap=10,g.requestedColumnCount=4,g.requestedRowCount=2,u.layout=g,u.itemRenderer=v,this.sl_reward.verticalScrollBar.visible=!1,this.sl_reward.verticalScrollBar.autoVisibility=!1;var f=new eui.ArrayCollection;this.sClientReward&&this.sClientReward.heros&&this.sClientReward.heros.forEach(function(e,t){f.addItem({type:EEntityType.EEntityTypeHero,code:e.code,num:1})}),this.sClientReward&&this.sClientReward.heroEquips&&0<this.sClientReward.heroEquips.length&&this.sClientReward.heroEquips.forEach(function(e,t){f.addItem({type:EEntityType.EEntityTypeHeroEquip,code:e.code,num:1})}),this.sClientReward&&this.sClientReward.heroArtifacts&&0<this.sClientReward.heroArtifacts.length&&this.sClientReward.heroArtifacts.forEach(function(e,t){f.addItem({type:EEntityType.EEntityTypeHeroArtifact,code:e.code,num:e.num||1})}),this.sClientReward&&this.sClientReward.maps&&0<this.sClientReward.maps.length&&this.sClientReward.maps.forEach(function(e,t){f.addItem({type:EEntityType.EEntityTypeMap,code:e.code,num:1})});if(this.sClientReward&&this.sClientReward.rewards&&0<this.sClientReward.rewards.length&&this.sClientReward.rewards.forEach(function(e,t){f.addItem({type:e.type,code:e.code,num:e.num})}),this.normalRewards&&0<this.normalRewards.length&&this.extRewards&&0<this.extRewards.length&&(this.normalRewards&&0<this.normalRewards.length&&this.normalRewards.forEach(function(e,t){f.addItem({type:e.type,code:e.code,num:e.num})}),this.extRewards&&0<this.extRewards.length&&this.extRewards.forEach(function(e,t){f.addItem({type:e.type,code:e.code,num:e.num})})),!(this.normalRewards&&0<this.normalRewards.length)||e.sClientReward&&0<e.sClientReward.length||this.extRewards&&0<this.extRewards.length||this.normalRewards&&0<this.normalRewards.length&&this.normalRewards.forEach(function(e,t){f.addItem({type:e.type,code:e.code,num:e.num})}),0<f.length?(this.sl_reward.width=84*(5<=f.length?4:f.length)+15*((5<=f.length?4:f.length)-1),5<=f.length&&(this.sl_reward.height=198),this.sl_reward.x=(this.gp_new.width-this.sl_reward.width)/2):0!=f.length||this.result!=EBattleResult.EBattleResultWin||this.params.battleType!=EBattleType.EBattleTypeServerBoss&&this.params.battleType!=EBattleType.EBattleTypeGuildBoss&&this.params.battleType!=EBattleType.EBattleTypeGuildTranscript||(this.gp_hurt.y=this.gp_ret_0.height/2),this.result===EBattleResult.EBattleResultLose){Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shibai),DragonBoneTools.create("common_zhanbai_2",function(e){e.x=this.gp_bg.width/2,e.y=this.gp_bg.height/2-107,e.animation.play(),this.gp_bg.addChild(e)},this),this.sl_reward.visible=!1,this.gp_result.visible=!0,this.lb_hints.visible=!1;var _=0;this.fightPy.reqFightParams.ignoreStringWay||(this.lb_hints.visible=!0,this.STRING_WAY.forEach(function(e){var t=new eui.Button;t.skinName="skins.ButtonSkinIcon",t.icon=e.icon,t.width=105,t.height=105,i["btn_"+_]=t,i.gp_result.addChild(i["btn_"+_]),++_}),this.addEvents()),this.gp_result.x=(this.gp_new.width-267)/2}else this.gp_result.visible=!1,this.sl_reward.visible=!0,this.lb_hints.visible=!1,Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shengli),DragonBoneTools.create("common_shengli_2",function(e){e.x=this.gp_bg.width/2,e.y=this.gp_bg.height/2-27,e.animation.play(),this.gp_bg.addChild(e)},this);this.hurtValueShow(),u.dataProvider=f,this.initPassWayBtns();var m=this.MILLSECOND;m&&(this.autoCloseScheId=egret.setInterval(function(){(m-=1e3)<=0&&(egret.clearInterval(i.autoCloseScheId),i.autoCloseScheId=void 0,i.hide())},this,1e3))},e.prototype.hurtValueShow=function(){if(0!=this.params.resultVo.teams.length){for(var e=this.params.resultVo.entityResults,t={},i=0,n=this.params.resultVo.teams[0].entities;i<n.length;i++){var o=n[i];t[o.entityId]=o.code}for(var a=0,r=0,s=e;r<s.length;r++){var c=s[r];t[c.entityId]&&(a+=c.totalHurt)}this.params.battleType!=EBattleType.EBattleTypeServerBoss&&this.params.battleType!=EBattleType.EBattleTypeGuildBoss&&this.params.battleType!=EBattleType.EBattleTypeGuildTranscript||(this.gp_hurt.visible=!0,this.blb_hurt.text=""+(a||0))}else this.btn_statistics.visible=!1},e.prototype.pvpResultData=function(){var r=this;this.filter=this.params&&this.params.changeSkinType,this.blb_team_0.visible=!1,this.filter?(this.btn_statistics.visible=!1,this.gp_ret_1.y=265):this.gp_ret_1.y+=20;var s,c=this.params.battleType;c==EBattleType.EBattleTypeTeamArena&&this.filter||(s=this.params.resultVo.teams);var e=function(n){var e=s[n];l["gp_team_"+n].removeChildren();var t=function(e){var t=customui.PlayerHeadFactory.create();t.scaleX=t.scaleY=.8;var i={avatar:e.avatar,frame:e.frame||"",level:e.level};t.updateData({vo:i}),r["gp_team_"+n].addChild(t)};if(c==EBattleType.EBattleTypeTeamArena&&l.filter)for(var i=0,o=s[n].members;i<o.length;i++){var a=o[i];t(a=a.baseInfo)}else t(e);l["lb_name_"+n].text=s[n].name},l=this;for(var t in s)e(t);var o=function(e,t,i){var n=r["blb_"+e+"_1"],o=r["blb_"+e+"_2"];n.text=""+i;var a=t<=0?""+t:"+"+t;o.font=0<t?"green_num_fnt":"RedBlackStrocke_fnt",o.text=a};switch(c){case EBattleType.EBattleTypePvP:this.gp_score_0.visible=this.gp_score_1.visible=!1,this.blb_t_0.visible=this.blb_t_1.visible=!1;break;case EBattleType.EBattleTypeTeamArena:var i=y.AppFacade.getInstance().retrieveProxy(y.BattleZoneArenaPy.N),n=y.AppFacade.getInstance().retrieveProxy(y.FightPy.N).sFinalBattleResultVO,a="number"==typeof this.params.winC?this.params.winC:n.winC,h="number"==typeof this.params.loseC?this.params.loseC:n.totalC-n.winC;this.blb_team_0.visible=!0,this.blb_team_0.text=this.blb_team_0.text=a+":"+h,this.gp_score_0.visible=this.gp_score_1.visible=!1,this.blb_t_0.visible=this.blb_t_1.visible=!1,this.filter&&(!function(e){if(r.filter){var t=e.latestRecord,i=t.rKey-t.pKey;o(0,i,t.rKey);var n=t.tRKey-t.tPKey;o(1,n,t.tRKey)}}(i),this.gp_score_0.visible=this.gp_score_1.visible=!0,this.blb_t_0.visible=this.blb_t_1.visible=!0,this.blb_t_0.text=this.blb_t_1.text="得分");break;case EBattleType.EBattleTypeTribeBattle:this.blb_t_0.text=this.blb_t_1.text="物资";var p=y.GameMVC.fightPy.lastsFinalBattleResultVO.cbRet.battleRecord,d=JSON.parse(p.keyStr),u=JSON.parse(p.tKeyStr);o(0,d.newGoods-d.oldGoods,d.newGoods),o(1,u.newGoods-u.oldGoods,u.newGoods)}},e.prototype.displayNumbersVS=function(){var i=this,e=this.params.battleType;this.btn_ok.visible=!(e==EBattleType.EBattleTypePvP||e==EBattleType.EBattleTypeTeamArena),this.btn_oneMore.visible=!1,this.btn_ok.visible=!1,this.btn_next.visible=!1;var t=function(){i.btn_ok0.visible=!0,i.img_vs_bg.visible=!0,i.gp_bg.visible=!1,i.gp_vs.visible=!0;var e=i.result==EBattleResult.EBattleResultWin?"_fight_m_json.jiesuan_img_shenglidi":"_fight_m_json.jiesuan_img_shibaidi";i.img_vs_bg.source=e;var t=i.result==EBattleResult.EBattleResultWin?"common_shengli_21":"common_zhanbai_21";i.gp_vs_effect.removeChildren(),DragonBoneTools.create(t,function(e){e.x=this.gp_bg.width/2,e.y=this.result==EBattleResult.EBattleResultWin?e.height/2:e.height/2+100,e.animation.play(),this.gp_vs_effect.addChild(e)},i),egret.Tween.get(i.gp_ret_1).to({alpha:1},300)};switch(e){case EBattleType.EBattleTypePvP:this.btn_ok0.visible=!0,this.gp_ret_0.visible=!1,this.gp_ret_1.visible=!0,this.btn_next.visible=this.btn_next.visible&&this.btn_ok.visible,this.btn_oneMore.visible=!0,t();break;case EBattleType.EBattleTypeTeamArena:this.btn_ok0.x=(this.gp_ret_1.width-this.btn_ok0.width)/2,this.gp_ret_1.visible=!0,this.gp_ret_1.alpha=0,e==EBattleType.EBattleTypeTeamArena?(this.gp_ret_0.visible=!1,t()):egret.Tween.get(this.gp_ret_0).wait(1e3).to({alpha:0},500).call(function(){i.gp_new.y-=100,t()});break;case EBattleType.EBattleTypeTribeBattle:this.gp_ret_0.visible=!1,this.gp_ret_1.visible=!0,this.btn_ok0.x=(this.gp_ret_1.width-this.btn_ok0.width)/2,t()}},e.prototype.nextFight=function(){if(this.params.battleType==EBattleType.EBattleTypeDailyFortress){var e=y.AppFacade.getInstance().retrieveProxy(y.CopyEntrancePy.N);this.fightPy.dailyFakeFight=!0;var t=e.curFortessId,i=y.Config.dailyFortressStage()[t];0<e.dailyFortressInfo[i.fortressId].leftChallenge?(e.ChallengeDailyFortress({id:t}),this.hide()):Utils.MsgUtils.addMidMsg("次数不足")}else if(this.params.battleType==EBattleType.EBattleTypeChampion)this.championProxy.isTwo=!0,this.hide();else if(this.params.battleType==EBattleType.EBattleTypeHeroChallenge2){var n=y.AppFacade.getInstance().retrieveProxy(y.HeroChallenge2Py.N);this.fightPy.dailyFakeFight=!0,n.Challenge(),this.hide()}else this.params.battleType==EBattleType.EBattleTypeTeamExpedition?this.hide():this.params.battleType==EBattleType.EBattleTypeAbyssLair&&this.hide()},e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.btn_next.addEventListener(egret.TouchEvent.TOUCH_TAP,this.nextFight,this),this.btn_statistics.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.fightPy.fightType==EBattleType.EBattleTypeWchess?y.AppFacade.getInstance().showSubView(y.ZzqMediator.N,y.ZzqMediator.SV.STATISTICS,t.params.resultVo):y.AppFacade.getInstance().showSubView(y.FightMediator.N,y.FightMediator.SV.STATISTICS,t.params.resultVo)},this),this.cb_needGuide.addEventListener(egret.Event.CHANGE,function(){t.championProxy.isZiDong=t.cb_needGuide.selected,t.teamExpePy.isZiDong=t.cb_needGuide.selected,t.cb_needGuide.selected?(t.championProxy.isTwo=!0,t.hide()):(t.cb_needGuide.label="自动战斗",t.timer&&egret.clearInterval(t.timer))},this),this.gp_hurt.visible=!1,this.btn_oneMore.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide();var e=y.AppFacade.getInstance().retrieveProxy(y.PlayerPy.N);e.ChallengePlayer(e.challengePlayerId)},this),this.btn_ok0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=y.AppFacade.getInstance().retrieveProxy(y.FightPy.N).sFinalBattleResultVO;t.params&&t.params.battleType==EBattleType.EBattleTypeTeamArena&&3==e.totalC&&!t.filter?t.updateView({changeSkinType:!0,result:e.result,battleType:e.battleType,winC:e.winC,loseC:e.totalC-e.winC,doneCB:t.doneCB}):t.hide()},this),this.fightPy.sBattleResultVO.escaped?(this.taopaoActNameCurIndex=0,this.goTaoPaoAct(),this.gp_new.visible=!1,GameRootLayer.gameLayer().switchTouchEnable(!1)):this.gp_new.visible=!0},e.prototype.taoPaoCurActFinish=function(){if(this.taopaoActNameCurIndex>=this.taopaoActName.length)this.displayTaopao.parent.removeChild(this.displayTaopao),this.displayTaopao=void 0,this.gp_new.visible=!0,GameRootLayer.gameLayer().switchTouchEnable(!0);else{if(1==this.taopaoActNameCurIndex){var e=new eui.Image;e.x=-30,e.y=-330,e.source="_fight_m_json.common_img_dabuguoliule",e.name="common_img_dabuguoliule",this.displayTaopao.addChild(e)}else this.displayTaopao.getChildByName("common_img_dabuguoliule")&&this.displayTaopao.removeChild(this.displayTaopao.getChildByName("common_img_dabuguoliule"));this.displayTaopao.animation.play(this.taopaoActName[this.taopaoActNameCurIndex++])}},e.prototype.goTaoPaoAct=function(){var t=this;this.displayTaopao&&this.displayTaopao.animation?(this.displayTaopao.visible=!0,egret.Tween.get(this.displayTaopao).call(this.taoPaoCurActFinish,this).to({x:GameRootLayer.gameLayer().popMsgLayer.width/2},500).call(this.taoPaoCurActFinish,this).wait(1250).call(this.taoPaoCurActFinish,this).to({x:GameRootLayer.gameLayer().popMsgLayer.width+100},300).call(this.taoPaoCurActFinish,this)):DragonBoneTools.createForHero("taopao_01",function(e){(t.displayTaopao=e).x=-100,e.y=t.gp_main.height/2+160,e.scaleX=e.scaleY=1.2,t.gp_main.addChild(t.displayTaopao),t.goTaoPaoAct()})},e.prototype.addEvents=function(){for(var t=this,e=function(e){i["btn_"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide(),t.STRING_WAY[e].clickFunc&&t.STRING_WAY[e].clickFunc()},i)},i=this,n=0;n<=2;++n)e(n)},e.prototype.initPassWayBtns=function(){this.log("test initPassWayBtns")},e.prototype.perClose=function(){},e}(BasePanel);y.FightResultPanel=e,__reflect(e.prototype,"game.FightResultPanel");var t=function(i){function e(e){var t=i.call(this)||this;return t.skinName="BaseResItemRenderSkin",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this);var e=y.GeneralConfig.getEntityConfigByCode(this.params.type,this.params.code);RES.getResAsync(ResourceUtils.png(e.icon),function(e){t.img_res.source=e},this),this.lb_num.text=this.params.num},e}(eui.Component);__reflect(t.prototype,"BaseResItemRender");var v=function(t){function e(){var e=t.call(this)||this;return e.currentState,e.width=84,e.height=84,e.item=customui.BaseItemFactory.create(21),e.item.scaleX=e.item.scaleY=.8,e}return __extends(e,t),e.prototype.dataChanged=function(){this.item.updateData({code:this.data.code,type:this.data.type,num:this.data.num}),this.addChild(this.item)},e}(eui.ItemRenderer);__reflect(v.prototype,"RewardItemRender")}(game||(game={})),function(u){var n=function(t){function i(){var e=t.call(this)||this;return e.skinName="FightStatisticsSkin",e}return __extends(i,t),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.list_my.itemRenderer=o,this.list_ennemy.itemRenderer=o,this.initBtn()},i.prototype.updateView=function(e){this.result=e,this.updateInfo(),this.ChangeContent},i.prototype.updateInfo=function(){var h=this.result.entityResults,e=void 0;e=this.result.battleType==EBattleType.EBattleTypeWchess?u.AppFacade.getInstance().retrieveProxy(u.ZzqPy.N).curPlayer.uuid:u.AppFacade.getInstance().retrieveProxy(u.PlayerPy.N).playerInfoVO.playerId;for(var t=!1,i=0,n=this.result.teams;i<n.length;i++){if((s=n[i]).playerId==e){t=!0;break}}t||(e=this.result.teams[0].playerId),this.data={},this.data.self=[],this.data.enemy=[];var p=-1,d=-1;for(var o in h){var a=h[o];p=p>a.totalHurt?p:a.totalHurt,d=d>a.totalCure?d:a.totalCure}for(var r in this.result.teams){var s,c=function(e,t,i){for(var n in e.entities){var o=e.entities[n];for(var a in t.push({isMagical:!1,code:o.code,entityId:o.entityId,isSelf:i,dermaCode:o.dermaCode}),h){(l=h[a]).entityId==t[t.length-1].entityId&&(t[t.length-1].totalHurt=l.totalHurt,t[t.length-1].totalCure=l.totalCure,p=p>l.totalHurt?p:l.totalHurt,d=d>l.totalCure?d:l.totalCure)}}if(e.magical&&e.magical.entityId){var r=e.magical.code,s=u.Config.magicalUpgradeConfig(r);if(s[0]&&s[0].costs){var c=JSON.parse(s[0].costs)[0][1];for(var a in t.push({isMagical:!0,code:c,entityId:e.magical.entityId,isSelf:i}),h){var l;(l=h[a]).entityId==t[t.length-1].entityId&&(t[t.length-1].totalHurt=l.totalHurt,t[t.length-1].totalCure=l.totalCure)}}}t.forEach(function(e){e.maxHurt=p,e.maxCure=d}),t.sort(function(e,t){return e.isMagical?1:t.isMagical?-1:e.entityId-t.entityId})};(s=this.result.teams[r]).playerId==e?c(s,this.data.self,!0):c(s,this.data.enemy,!1)}this.list_my.dataProvider=new eui.ArrayCollection(this.data.self),this.list_ennemy.dataProvider=new eui.ArrayCollection(this.data.enemy)},i.prototype.ChangeContent=function(e){var t=this.list_my.$children;for(var i in t){(n=t[i])&&n.changeState(e)}t=this.list_ennemy.$children;for(var i in t){var n;(n=t[i])&&n.changeState(e)}},i.prototype.initBtn=function(){var e=this;this.btn_hurt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.ChangeContent(i.LIST_TYPE.HURT),e.img_cure_bg.source="common_img_dikuang03_png",e.img_hurt_bg.source="common_img_dikuang01_png",e.img_lb_hurt.source="_fight_m_json.zhandou_txt_shuchu1",e.img_lb_cure.source="_fight_m_json.zhandou_txt_zhiliao2"},this),this.btn_cure.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.ChangeContent(i.LIST_TYPE.CURE),e.img_cure_bg.source="common_img_dikuang01_png",e.img_hurt_bg.source="common_img_dikuang03_png",e.img_lb_hurt.source="_fight_m_json.zhandou_txt_shuchu2",e.img_lb_cure.source="_fight_m_json.zhandou_txt_zhiliao1"},this)},i.LIST_TYPE={HURT:0,CURE:1,RESULT:2},i}(BasePanel);u.FightStatistics=n,__reflect(n.prototype,"game.FightStatistics");var o=function(i){function e(){var e=i.call(this)||this;return e.skinName="FightStatisticsItemSkin",e}return __extends(e,i),e.prototype.childrenCreated=function(){this.baseitem=customui.BaseItemFactory.create(),this.gp_head.addChild(this.baseitem),this.pb.slideDuration=0,this.pb.labelDisplay.visible=!1},e.prototype.dataChanged=function(){i.prototype.dataChanged.call(this);var e=this.data.code,t=void 0;this.data.dermaCode&&0!=this.data.dermaCode&&(t=u.Config.getHeroDermaConfig()[this.data.dermaCode].avatar),this.baseitem.updateData({code:e,avatar:t}),this.baseitem.scaleX=this.baseitem.scaleY=.6,this.baseitem.touchEnabled=this.baseitem.touchChildren=!1,this.changeState(n.LIST_TYPE.HURT),this.data.isSelf||(this.scaleX=-1,this.gp_head.scaleX=-1,this.bm_num.scaleX=-1)},e.prototype.changeState=function(e){this.pb.value=0,e==n.LIST_TYPE.HURT?(this.pb.maximum=this.data.maxHurt,this.pb.value=this.data.totalHurt,this.bm_num.text=this.data.totalHurt):(this.pb.maximum=this.data.maxCure,this.pb.value=this.data.totalCure,this.bm_num.text=this.data.totalCure)},e}(eui.ItemRenderer);__reflect(o.prototype,"FightStatisticsItem")}(game||(game={})),function(v){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=game.AppFacade.getInstance().retrieveProxy(game.FightPy.N),e.skinName="RecordPreviewItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_playback.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.proxy.BattlePlayBack(e.data.uuid,{moduleId:MODULE.TeamArena,data:e.resultData})},this)},e.prototype.updateData=function(e){this.data=e,this.resultData={resultVo:{teams:this.data.team},winC:this.data.resultData.winC,loseC:this.data.resultData.loseC,result:this.data.resultData.result,battleType:EBattleType.EBattleTypeTeamArena};this.lb_index.text="第"+{1:"一",2:"二",3:"三"}[this.data.index+1]+"场";var t=new eui.HorizontalLayout;t.gap=5,t.horizontalAlign=egret.HorizontalAlign.RIGHT,t.verticalAlign=egret.VerticalAlign.MIDDLE,this.gp_heros_2.layout=t;var i=new eui.HorizontalLayout;i.gap=5,i.horizontalAlign=egret.HorizontalAlign.LEFT,i.verticalAlign=egret.VerticalAlign.MIDDLE,this.gp_heros_1.layout=i;var n;for(var o in e.team){var a=Number(o)+1,r=e.team[o],s=this["gp_"+a],c=this["gp_heros_"+a],l=this["img_bg"+a],h=this["img_flag_"+a],p=r.result;2==a&&p==EBattleResult.EBattleResultWin?p=EBattleResult.EBattleResultLose:2==a&&p==EBattleResult.EBattleResultLose&&(p=EBattleResult.EBattleResultWin),l.source=p==EBattleResult.EBattleResultWin?"_fight_m_json.jjc_img_kuang01":"_fight_m_json.jjc_img_kuang02",h.source=p==EBattleResult.EBattleResultWin?"zdjj_txt_sheng_png":"zdjj_txt_bai_png",this["lb_name_"+a].text=r.name;var d=this["playerhead_"+a];d.updateData({vo:{avatar:r.avatar}}),d.touchEnabled=!1;for(var u=r.heroList,g=0,f=u;g<f.length;g++){var _=f[g],m=v.BaseItemFactory.create();m.scaleX=m.scaleY=.5,m.updateData({type:EEntityType.EEntityTypeHero,code:_.code,level:_.level}),c.addChild(m)}var y=u.length;5<y&&(s.width+=53*(y-5)+5)}n=Math.max(this.gp_1.width,this.gp_2.width),this.gp_1.width=this.gp_2.width=n},e}(eui.Component);v.RecordPreviewItem=e,__reflect(e.prototype,"customui.RecordPreviewItem")}(customui||(customui={})),function(s){var e=function(n){function e(){var e=n.call(this)||this;return e.isFriend=!1,e.skinName="FriendInfoSkin",e.friendProxy=s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N),e.pkmBoxs=new Array,e.publicPlayer=void 0,e}return __extends(e,n),e.prototype.childrenCreated=function(){var i=this;if(n.prototype.childrenCreated.call(this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.publicPlayer&&(i.isFriend?(i.friendProxy.delFriend({friendId:i.publicPlayer.baseInfo.playerId}),i.hide()):i.friendProxy.addFriend({friendId:i.publicPlayer.baseInfo.playerId},void 0,void 0))},this),Utils.UnlockMgr.checkPass(MODULE.ChatPrivate,!1).allow?this.btn_chat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(i.publicPlayer){var e=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N);if(!e.isInSameServer(i.publicPlayer.baseInfo.serverId)&&(i.viewSource=="rankingType"+RankingType.RankingTypeWorldWorldKing||i.viewSource=="rankingType"+RankingType.RankingTypeChessGrade))return void Utils.MsgUtils.addMidMsg("无法跨服聊天");var t=e.playerInfoVO.playerId;if(i.publicPlayer.baseInfo.playerId===t)Utils.MsgUtils.addMidMsg("不能与自己聊天");else if(i.friendProxy.isInBlacklist(i.publicPlayer.baseInfo.playerId))Utils.MsgUtils.addMidMsg("对方在黑名单中");else{s.AppFacade.getInstance().retrieveProxy(s.MainPy.N).addPrivatePlayer(i.publicPlayer.baseInfo.playerId),s.AppFacade.getInstance().showSubView(s.ChatMediator.N,s.ChatMediator.SV.CHAT,{NextChannelType:EChatChannelType.EChatChannelTypePrivate,playerId:i.publicPlayer.baseInfo.playerId}),i.hide()}}},this):this.btn_chat.parent&&this.btn_chat.parent.removeChild(this.btn_chat),this.btn_addBlackList.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.friendProxy.isInBlacklist(i.publicPlayer.baseInfo.playerId)?Utils.MsgUtils.addMidMsg("该玩家已被加入黑名单"):s.GameMgr.getInstance().showCommonTipsWin({commonTips:"是否要将"+i.publicPlayer.baseInfo.name+"拉入黑名单？\n  拉黑后，将无法接收对方信息。",clickCB:function(e){e.type&&i.friendProxy.JoinBlackList(i.publicPlayer.baseInfo.playerId)}})},this),!this.Gruop_pkm.$children.length)for(var e=1;e<=6;e++){var t;(t=new o).scaleX=t.scaleY=.8,t.touchEnabled=t.touchChildren=!1,this.Gruop_pkm.addChild(t)}(t=new o).scaleX=t.scaleY=.8,t.horizontalCenter=t.verticalCenter=0,t.touchEnabled=t.touchChildren=!1,this.gp_pet.addChild(t)},e.prototype.updateButton=function(e){var t=this.friendProxy.friendList,i=!1;for(var n in t){if(t[n].friendId==e){i=!0;break}}this.isFriend=i,this.btn_add.icon=i?"_btn_lb_m_json.common_icon_shanchuhaoyou":"_btn_lb_m_json.common_icon_tianjiahaoyou",this.publicPlayer&&(this.friendProxy.isInBlacklist(this.publicPlayer.baseInfo.playerId)?this.btn_addBlackList.visible=!1:this.btn_addBlackList.visible=!0)},e.prototype.updatePlayerInfo=function(){this.log(this.publicPlayer);var e=this.publicPlayer.baseInfo;this.publicPlayer.baseInfo.serverId;if(this.lb_name.text=e.name,this.item_fightCap.update(e.fightCap),this.lb_id.text="ID："+e.playerId,""==e.guild||null==e.guild||null==e.guild)this.lb_guild.textFlow=[{text:"公会：",style:{textColor:15913814}},{text:"暂未加入公会",style:{textColor:16777215}}];else{var t=e.guild.name;""!=t&&null!=t&&null!=t||(t="暂未加入公会"),this.lb_guild.textFlow=[{text:"公会：",style:{textColor:15913814}},{text:t,style:{textColor:16777215}}]}for(var i=1;i<=6;i++){var n=this.Gruop_pkm.getChildAt(i-1),o=s.Config.unlockConfig(i),a=!0;if(o){var r=JSON.parse(o.condition);switch(r[0]){case UnlockType.Level:e.level<r[1]&&(a=!1)}n.updateItem({vo:this.publicPlayer.heroList[i-1],unlock:a,unlockLevel:r[1]}),n.scaleX=.65,n.scaleY=.65}}n=this.gp_pet.$children[0];(a=Utils.UnlockMgr.checkPass(MODULE.Pet,!1)).allow=this.publicPlayer.baseInfo.level>=a.ext.requestLevel,n.updateItem({uuid:this.publicPlayer.petList[0]&&this.publicPlayer.petList[0].uuid,unlock:a,vo:this.publicPlayer.petList[0],isPet:!0}),n.scaleX=.65,n.scaleY=.65,this.cu_ph.updateData({vo:e})},e.prototype.displayExtraInfo=function(e){void 0===e&&(e=void 0),null!=e&&(this.checkStatus(e.playerName)&&(this.lb_name.text=e.playerName),this.checkStatus(e.playerId)&&(this.lb_id.text=e.playerId),this.checkStatus(e.fightCap)&&this.item_fightCap.update(e.fightCap),this.checkStatus(e.guildName)&&(this.lb_guild.text=e.guildName),this.checkStatus(e.name)&&(this.lb_name.text=e.name))},e.prototype.checkStatus=function(e){return null!=e},e.prototype.updateView=function(e){var t=this;this.displayExtraInfo(e.extra),this.updateButton(e.playerId);var i=e.playerId;this.viewSource=e.source;var n=e.moduleId,o=e.entityIndex;i&&n&&o?Utils.Socket.send("playerInfo","GetMultiTeamPublicPlayer",{tPlayerId:i,moduleId:n,entityIndex:o}).then(function(e){t.publicPlayer=e.publicPlayer,t.updatePlayerInfo(),t.updateButton(t.publicPlayer.baseInfo.playerId)}).catch(function(e){}):i?Utils.Socket.send("playerInfo","GetPublicPlayer",{playerId:i}).then(function(e){t.publicPlayer=e.publicPlayer,t.updatePlayerInfo(),t.updateButton(t.publicPlayer.baseInfo.playerId)}).catch(function(e){}):this.publicPlayer},e.prototype.perClose=function(){this.publicPlayer=void 0},e}(BasePanel);s.FriendInfo=e,__reflect(e.prototype,"game.FriendInfo");var o=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroMainView_HeroListItem",e.heroThingProxy=s.AppFacade.getInstance().retrieveProxy(s.HeroThingPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem),this.gp_baseitem.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.AppFacade.getInstance().updateView(s.HeroMediator.N,s.HeroMediator.SV.MAIN,{upstarData:{},uuid:this.data.uuid})},this),this.gp_empty.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.unlock.allow?s.AppFacade.getInstance().showSubView(s.HeroMediator.N,s.HeroMediator.SV.SELECT):Utils.MsgUtils.addMidMsg(this.data.unlock.ext.tips)},this)},e.prototype.updateItem=function(e){if(this.data=e,this.data.vo){this.gp_baseitem.visible=!0;var t=e.isPet?EEntityType.EEntityTypePet:EEntityType.EEntityTypeHero;if(this.gp_empty.visible=!1,t==EEntityType.EEntityTypeHero)if(e.vo.dermaCode){var i=s.Config.getHeroDermaConfig()[e.vo.dermaCode].avatar;this.baseItem.updateData({vo:e.vo,type:EEntityType.EEntityTypeHero,avatar:i,isShowEffect:!0})}else this.baseItem.updateData({vo:e.vo,type:EEntityType.EEntityTypeHero});else t==EEntityType.EEntityTypePet&&this.baseItem.updateData({vo:this.data.vo,type:t})}else this.gp_baseitem.visible=!1,this.gp_empty.visible=!0,this.data.unlock?(this.img_add.visible=!0,this.img_lock.visible=!1,this.lb_unlock.visible=!1):(this.img_add.visible=!1,this.img_lock.visible=!0,this.lb_unlock.visible=!0,this.lb_unlock.text="LV "+e.unlockLevel)},e}(eui.Component);__reflect(o.prototype,"HeroMainView_HeroListItem")}(game||(game={})),function(n){var e=function(i){function e(e){var t=i.call(this)||this;return t.skinName="HeroDetailViewSkin",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.activateComponent()},e.prototype.updateView=function(e){if(this.params=e,this.params&&this.params.code){this.params.type=this.params.type||Math.floor(this.params.code/1e7),this.baseConfig=game.Config.allHeroConfig(this.params.type==EEntityType.EEntityTypePet)[this.params.code]||game.Config.creepConfig(this.params.code),this.upstarConfig=game.Config.heroAndPetUpstarConfig(this.params.type==EEntityType.EEntityTypePet)[this.params.code],this.upgradeConfig=game.Config.heroAndPetUpgradeConfig(this.params.type==EEntityType.EEntityTypePet)[this.params.code];var t=game.Config.heroAndPetSectionConfig(this.params.type==EEntityType.EEntityTypePet),i=this.baseConfig.maxLevel;for(var n in t){var o=t[n];i>parseInt(o.level)&&(this.sectionConfig=o)}this.baseConfig&&(this.updateHeroBaseInfo(),this.updateHeroInfo(),this.updateAttr())}},e.prototype.updateHeroBaseInfo=function(){this.lb_level.text=this.baseConfig.maxLevel+"/"+this.baseConfig.maxLevel,this.lb_desc.text=this.baseConfig.desc,this.gp_skills.visible=!0;for(var e=JSON.parse(this.baseConfig.skillUnlock),t=this.sectionConfig&&this.sectionConfig.id||0,i=1;i<=5;i++){var n=SKILL_CODE[i];this["skill_"+i];if(n){var o={code:this.baseConfig[n],unlock:t>=e[i]};this["skill_"+i].updateItem(o)}else this["skill_"+i].updateItem()}},e.prototype.updateAttr=function(){var e=[],t=JSON.parse(this.baseConfig.baseAttr),i=JSON.parse(this.baseConfig.upAttr),n=this.sectionConfig&&JSON.parse(this.sectionConfig.attr)||[];if(e=game.GeneralConfig.AttrAddAttr(e,t),i=game.GeneralConfig.AttrMutilAttr(i,parseInt(this.baseConfig.maxLevel)-1),e=game.GeneralConfig.AttrAddAttr(e,i),e=game.GeneralConfig.AttrAddAttr(e,n),this.upstarConfig){var o=this.upstarConfig&&JSON.parse(this.upstarConfig.upAttr);e=game.GeneralConfig.AttrMutilAttr(e,o)}this.baseConfig.posSkill1,this.baseConfig.posSkill2,this.baseConfig.posSkill3;for(var a=game.Config.skillBaseConfig(),r=[],s=[],c=JSON.parse(this.baseConfig.skillUnlock),l=this.sectionConfig&&this.sectionConfig.id||0,h=1;h<=5;h++){var p=SKILL_CODE[h-1];if(p&&this.baseConfig[p]){var d=this.baseConfig[p];if(l>=c[h-1]){var u=a[d];if(u){var g=JSON.parse(u.attr);for(var f in g){var _=g[f];1e5<=_[1]?r=game.GeneralConfig.AttrAddAttr(r,[_]):s=game.GeneralConfig.AttrAddAttr(s,[_])}}}}}for(var f in e=game.GeneralConfig.AttrAddAttr(e,r),e=game.GeneralConfig.AttrAddAttr(e,s))e[f][1]=Math.floor(e[f][1]);e.sort(function(e,t){return e[0]-t[0]}),this.gp_upgrade_attr.removeChildren();for(h=1;h<=4;h++)this.gp_upgrade_attr.addChild(new game.HeroMainView_AttrItem({type:h,num:e[h-1][1]}))},e.prototype.updateHeroInfo=function(){this.lb_name.text=this.baseConfig.name,this.img_race_icon.source=HeroRaceConfig[this.baseConfig.race].raceIconBig,this.img_tier_icon.source=game.GeneralConfig.getHeroJingyingTag(this.baseConfig.code),this.hero_model.update({code:this.params.code,isPet:this.params.type==EEntityType.EEntityTypePet});var e=game.GeneralConfig.getHeroStarInfo(this.baseConfig.initStar);if(this.gp_star.removeChildren(),e.stage<4)for(var t=0;t<e.num;t++)this.gp_star.addChild(new eui.Image(e.src));else this.gp_star.addChild(new n.HighStarLevelIcon(e.num))},e.prototype.bindSkillPanelClick=function(t){var i=this,n=t.target;n.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){if(n.data&&n.data.code)for(var e in i.skill_panel.visible=!0,i.skill_panel.updateItem({code:n.data.code}),t)"target"!=e&&(i.skill_panel[e]=t[e])},this),n.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skill_panel.visible=!1},this),n.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skill_panel.visible=!1},this),n.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skill_panel.visible=!1},this)},e.prototype.activateComponent=function(){for(var e=1;e<=5;e++){var t=this["skill_"+e];this.bindSkillPanelClick({target:t,x:34,bottom:e<4?130:73})}this.hero_model.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hero_model.changeAction(n.HeroDynamicModel.TOUCH_ACTION_LIST)},this)},e.prototype.getParentView=function(){return GameRootLayer.gameLayer().panelLayer},e}(eui.Component);n.HeroCard=e,__reflect(e.prototype,"customui.HeroCard")}(customui||(customui={})),function(n){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new i).register(),(new o).register(),(new a).register(),(new r).register()},e}();n.FriendProcessor=e,__reflect(e.prototype,"game.FriendProcessor");var t=function(e){function t(){return e.call(this,"friend.NewRequestP",t)||this}return __extends(t,e),t.prototype.execute=function(e){if(this.checkCB(e.getBody())){this.log("NewRequestP 好友请求推送");var t=e.getBody();Utils.MsgUtils.addMidMsg(t.requestInfo.baseInfo.name+"已申请添加好友"),n.AppFacade.getInstance().retrieveProxy(n.FriendPy.N).updateFriendList([t.requestInfo],n.FriendUI.TAB_VIEW.APPLY)}},t}(n.ProcessorBase);n.NewRequestP=t,__reflect(t.prototype,"game.NewRequestP");var i=function(e){function t(){return e.call(this,"friend.AgreeRequestP",t)||this}return __extends(t,e),t.prototype.execute=function(e){if(this.checkCB(e.getBody())){this.log("AgreeRequestP 申请通过");var t=e.getBody(),i=n.AppFacade.getInstance().retrieveProxy(n.FriendPy.N);i.updateFriendList([t.friendInfo],n.FriendUI.TAB_VIEW.FRIEND),i.getRequestList()}},t}(n.ProcessorBase);n.AgreeRequestP=i,__reflect(i.prototype,"game.AgreeRequestP");var o=function(e){function t(){return e.call(this,"friend.DelFriendP",t)||this}return __extends(t,e),t.prototype.execute=function(e){if(this.checkCB(e.getBody())){this.log("DelFriendP 被好友删除");var t=e.getBody();n.AppFacade.getInstance().retrieveProxy(n.FriendPy.N).deleteFriendListByIds([t.friendId],n.FriendUI.TAB_VIEW.FRIEND)}},t}(n.ProcessorBase);n.DelFriendP=o,__reflect(o.prototype,"game.DelFriendP");var a=function(e){function t(){return e.call(this,"friend.OperateFriendGoodP",t)||this}return __extends(t,e),t.prototype.execute=function(e){this.checkCB(e.getBody())&&(this.log("OperateFriendGoodP"),n.AppFacade.getInstance().retrieveProxy(n.FriendPy.N).DealGiftPush(e.getBody()))},t}(n.ProcessorBase);n.OperateFriendGoodP=a,__reflect(a.prototype,"game.OperateFriendGoodP");var r=function(e){function t(){return e.call(this,"friend.FriendInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){if(this.checkCB(e.getBody())){var t=e.getBody(),i=n.AppFacade.getInstance().retrieveProxy(n.FriendPy.N);i.cleanFriendList(n.FriendUI.TAB_VIEW.FRIEND),i.updateFriendList(t.friendList,n.FriendUI.TAB_VIEW.FRIEND),i.cleanFriendList(n.FriendUI.TAB_VIEW.APPLY),i.updateFriendList(t.requestList,n.FriendUI.TAB_VIEW.APPLY)}},t}(n.ProcessorBase);n.FriendInfoP=r,__reflect(r.prototype,"game.FriendInfoP")}(game||(game={})),function(s){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.blackList={},e.inviteHistory={},e._giftCount=0,e.hasGiftToGet=!1,e.hasGiftToGive=!1,e.friendList={},e.requestList={},e.recommendList={},e.searchList={},e.initNotice(),e}return __extends(i,t),i.prototype.initNotice=function(){NoticeManager.registerCB([NT.FRIEND_GIFT],this.checkGiftNotice,this),NoticeManager.registerCB([NT.FRIEND_APPLY],this.checkApplyNotice,this)},i.prototype.getListByType=function(e){switch(void 0===e&&(e=s.FriendUI.TAB_VIEW.FRIEND),e){case s.FriendUI.TAB_VIEW.FRIEND:return this.friendList;case s.FriendUI.TAB_VIEW.APPLY:return this.requestList;case s.FriendUI.TAB_VIEW.RECOMMEND:return this.recommendList;case s.FriendUI.TAB_VIEW.SEARCH:return this.searchList;case s.FriendUI.TAB_VIEW.BLACKLIST:return this.blackList;default:return[]}},i.prototype.cleanFriendList=function(e){var t=this.getListByType(e);for(var i in t)delete t[i]},i.prototype.getFriendListNum=function(e){void 0===e&&(e=s.FriendUI.TAB_VIEW.FRIEND);var t=0,i=this.getListByType(e);for(var n in i)t++;return t},i.prototype.updateFriendList=function(e,t,i){void 0===t&&(t=s.FriendUI.TAB_VIEW.FRIEND),void 0===i&&(i=!0);var n=this.getListByType(t);for(var o in e){var a=e[o];if(n[a.baseInfo.playerId])n[a.baseInfo.playerId].update(a);else{var r=new c(a);n[a.baseInfo.playerId]=r}}i&&s.AppFacade.getInstance().updateView(s.FriendMediator.N,s.FriendMediator.SV.MAIN,{updateIndex:t}),NoticeManager.updateNotice(NT.FRIEND_APPLY)},i.prototype.deleteFriendListByIds=function(e,t){void 0===t&&(t=s.FriendUI.TAB_VIEW.FRIEND);var i=this.getListByType(t),n=!1;e.forEach(function(e,t){i[e]&&(delete i[e],n=!0)}),n&&s.AppFacade.getInstance().updateView(s.FriendMediator.N,s.FriendMediator.SV.MAIN,{updateIndex:t})},i.prototype.getInitListInfo=function(e,t){return void 0===e&&(e=!1),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.cleanFriendList(s.FriendUI.TAB_VIEW.FRIEND),this.cleanFriendList(s.FriendUI.TAB_VIEW.APPLY),this.cleanFriendList(s.FriendUI.TAB_VIEW.RECOMMEND),[4,Promise.all([this.getRequestList(),this.getFriendList(),this.getRecommendList()])];case 1:return e.sent(),t&&t(),[2]}})})},i.prototype.getFriendList=function(i,e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return Promise.all([Utils.Socket.send("friend","GetFriendList",{}).then(function(e){t.updateFriendList(e.friendList,s.FriendUI.TAB_VIEW.FRIEND,!1),console.log("getfriend")}).catch(function(e){t.log(e)}),Utils.Socket.send("friend","GetFriendGoodInfo",{}).then(function(e){e.err||(console.log("gift"),t.decorateGift(e))}).catch(function(e){t.log(e)})]).then(function(){i&&(console.log("callback"),i())}),[2]})})},i.prototype.selectFriend=function(i,n,o){var a=this;void 0===i&&(i={condition:""}),Utils.Socket.send("friend","SelectFriend",i).then(function(e){var t=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N);""==i.condition?(Utils.MsgUtils.addMidMsg("刷新成功"),a.cleanFriendList(s.FriendUI.TAB_VIEW.RECOMMEND),a.updateFriendList(e.friendList,s.FriendUI.TAB_VIEW.RECOMMEND,!0)):(Number(i.condition)==t.roleVo.playerId?Utils.MsgUtils.addMidMsg("不可加自己为好友"):0<e.friendList.length||Utils.MsgUtils.addMidMsg("该名玩家不存在"),a.cleanFriendList(s.FriendUI.TAB_VIEW.SEARCH),a.updateFriendList(e.friendList,s.FriendUI.TAB_VIEW.SEARCH)),n&&n(e,o)}).catch(function(e){})},i.prototype.addFriend=function(i,n,o,a){var r=this;void 0===i&&(i={friendId:null}),void 0===a&&(a=s.FriendUI.TAB_VIEW.RECOMMEND),Utils.Socket.send("friend","AddFriend",i).then(function(e){if(Utils.MsgUtils.addMidMsg("申请成功"),a==s.FriendUI.TAB_VIEW.RECOMMEND)r.deleteFriendListByIds([i.friendId],s.FriendUI.TAB_VIEW.RECOMMEND);else if(a==s.FriendUI.TAB_VIEW.SEARCH){var t=r.getListByType(s.FriendUI.TAB_VIEW.SEARCH);t[i.friendId]&&(t[i.friendId].relation=EFriendType.EFriendTypeApply),s.AppFacade.getInstance().updateView(s.FriendMediator.N,s.FriendMediator.SV.MAIN,{updateIndex:s.FriendUI.TAB_VIEW.SEARCH})}n&&n(e,o)}).catch(function(e){})},i.prototype.getRequestList=function(e,t,i){var n=this;void 0===e&&(e={}),Utils.Socket.send("friend","GetRequestList",e).then(function(e){n.updateFriendList(e.requestList,s.FriendUI.TAB_VIEW.APPLY,!1),t&&t(e,i)}).catch(function(e){})},i.prototype.agreeRequest=function(t){var i=this;void 0===t&&(t={friendId:0}),Utils.Socket.send("friend","AgreeRequest",t).then(function(e){Utils.MsgUtils.addMidMsg("同意成功"),t.friendId?(i.updateFriendList([e.friend],s.FriendUI.TAB_VIEW.FRIEND),i.deleteFriendListByIds([t.friendId],s.FriendUI.TAB_VIEW.APPLY)):i.getFriendList(),s.AppFacade.getInstance().updateView(s.FriendMediator.N,s.FriendMediator.SV.MAIN,{updateIndex:s.FriendUI.TAB_VIEW.APPLY}),i.getGiftMsg()}).catch(function(e){})},i.prototype.rejectRequest=function(t){var i=this;void 0===t&&(t={friendId:0}),Utils.Socket.send("friend","RejectRequest",t).then(function(e){Utils.MsgUtils.addMidMsg("拒绝成功"),t.friendId?i.deleteFriendListByIds([t.friendId],s.FriendUI.TAB_VIEW.APPLY):i.cleanFriendList(s.FriendUI.TAB_VIEW.APPLY),s.AppFacade.getInstance().updateView(s.FriendMediator.N,s.FriendMediator.SV.MAIN,{updateIndex:s.FriendUI.TAB_VIEW.APPLY})}).catch(function(e){})},i.prototype.delFriend=function(i,n,o){var a=this;void 0===i&&(i={friendId:null}),Utils.Socket.send("friend","DelFriend",i).then(function(e){if(Utils.MsgUtils.addMidMsg("删除成功"),a.deleteFriendListByIds([i.friendId]),a.searchList[i.friendId]){var t=a.searchList[i.friendId];t.relation=EFriendType.EFriendTypeStranger,a.updateFriendList([t],s.FriendUI.TAB_VIEW.SEARCH)}n&&n(e,o)}).catch(function(e){})},i.prototype.getRecommendList=function(e,t,i){var n=this;void 0===e&&(e={condition:""}),Utils.Socket.send("friend","SelectFriend",e).then(function(e){n.updateFriendList(e.friendList,s.FriendUI.TAB_VIEW.RECOMMEND),t&&t(e,i)}).catch(function(e){})},i.prototype.OperateFriendGift=function(e){var i=this;e.type=EEntityType.EEntityTypeMoney,e.code=11,e.num=JSON.parse(s.Config.constConfig().OnceFriendIntimacyNum.constValue),Utils.Socket.send("friend","OperateFriendGood",e).then(function(e){if(!e.err){var t=s.AppFacade.getInstance().retrieveProxy(s.BackpackPy.N);t.handleClientCost(e.clientCost),t.handleClientReward(e.clientReward,2),i.log(e),i.decorateGift(e),s.AppFacade.getInstance().sendNotification(CN.FRIEND_GIFT_UPDATE)}}).catch(function(e){i.log(e)})},i.prototype.getGiftCount=function(){return this._giftCount},i.prototype.decorateGift=function(e){if(this.friendList||this.getFriendList(),e.friendGoodInfo){for(var t in this.friendList){var i=this.friendList[t],n=void 0,o=void 0,a=void 0;for(var r in e.friendGoodInfo.giveRecord){var s=e.friendGoodInfo.giveRecord[r];if(s.friendId==i.friendId){n=s;break}}for(var c in e.friendGoodInfo.getRecord){var l=e.friendGoodInfo.getRecord[c];if(l.friendId==i.friendId){o=l;break}}for(var h in e.friendGoodInfo.bagRecord){var p=e.friendGoodInfo.bagRecord[h];if(p.friendId==i.friendId){a=p;break}}i.friendGiftVO=new d({giveRecord:n,getRecord:o,bagRecord:a})}for(var t in this._giftCount=0,this.hasGiftToGet=!1,this.hasGiftToGive=!1,e.friendGoodInfo.bagRecord)0==e.friendGoodInfo.bagRecord[t].info[0].num?this._giftCount++:this.friendList[e.friendGoodInfo.bagRecord[t].friendId]&&(this.hasGiftToGet=!0);for(var t in this.friendList){if(!(i=this.friendList[t]).friendGiftVO.giveRecord){this.hasGiftToGive=!0;break}}NoticeManager.updateNotice(NT.FRIEND_GIFT,{},!0)}},i.prototype.getGiftMsg=function(){var t=this;Utils.Socket.send("friend","GetFriendGoodInfo",{}).then(function(e){e.err||(t.decorateGift(e),s.AppFacade.getInstance().sendNotification(CN.FRIEND_GIFT_UPDATE))}).catch(function(e){t.log(e)})},i.prototype.DealGiftPush=function(e){if(this.friendList||this.getFriendList(),this.friendList[e.newRecord.friendId]){var t=this.friendList[e.newRecord.friendId];for(var i in t.friendGiftVO?t.friendGiftVO.bagRecord=e.newRecord:t.friendGiftVO=new d({giveRecord:void 0,getRecord:void 0,bagRecord:e.newRecord}),this.hasGiftToGet=!1,this.hasGiftToGive=!1,this.friendList){var n=this.friendList[i];if(!n.friendGiftVO.giveRecord){this.hasGiftToGive=!0;break}if(n.friendGiftVO.bagRecord)for(var o in n.friendGiftVO.bagRecord.info)0<n.friendGiftVO.bagRecord.info[o].num&&(this.hasGiftToGet=!0)}}s.AppFacade.getInstance().sendNotification(CN.FRIEND_GIFT_UPDATE)},i.prototype.checkApplyNotice=function(){var e=!1;for(var t in this.requestList){e=!0;break}return e},i.prototype.checkGiftNotice=function(){var e=!1,t=JSON.parse(s.Config.constConfig().OnceFriendIntimacyNum.constValue),i=JSON.parse(s.Config.constConfig().FriendPokeBallGetLimit.constValue)/t;if(this.getGiftCount()<i)for(var n in this.friendList)if(this.friendList[n].friendGiftVO){var o=this.friendList[n].friendGiftVO.bagRecord;if(o)for(var a in o.info)if(0<o.info[a].num){e=!0;break}}return e},i.prototype.getInviteHistory=function(e){return this.inviteHistory[e]||(this.inviteHistory[e]=[]),e==MODULE.Wchess?[]:this.inviteHistory[e]},i.prototype.addInviteHistory=function(e,t){this.inviteHistory[e]||(this.inviteHistory[e]=[]),this.inviteHistory[e].push(t)},i.prototype.clearInviteHistory=function(e){this.inviteHistory[e]=[]},i.prototype.isInBlacklist=function(e){return!!this.blackList[e]},i.prototype.getblacklist=function(){var i=this;Utils.Socket.send("friend","GetBlackList",{}).then(function(e){e.blackList&&e.blackList.forEach(function(e){var t=new c(e);i.blackList[t.friendId]=t})})},i.prototype.JoinBlackList=function(t){var i=this;this.isInBlacklist(t)?Utils.MsgUtils.addMidMsg("该玩家已被加入黑名单"):Utils.Socket.send("friend","JoinBlackList",{playerId:t}).then(function(e){i.updateFriendList([e.friend],s.FriendUI.TAB_VIEW.BLACKLIST),i.deleteFriendListByIds([t],s.FriendUI.TAB_VIEW.FRIEND),s.AppFacade.getInstance().updateView(s.FriendMediator.N,s.FriendMediator.SV.MAIN,{updateIndex:s.FriendUI.TAB_VIEW.BLACKLIST}),s.AppFacade.getInstance().updateView(s.FriendMediator.N,s.FriendMediator.SV.INFO,{playerId:t})})},i.prototype.TickOutBlackList=function(t){var i=this;!t||this.isInBlacklist(t)?Utils.Socket.send("friend","TickOutBlackList",{playerId:t}).then(function(e){t?i.deleteFriendListByIds([t],s.FriendUI.TAB_VIEW.BLACKLIST):i.blackList=new Array,s.AppFacade.getInstance().updateView(s.FriendMediator.N,s.FriendMediator.SV.MAIN,{updateIndex:s.FriendUI.TAB_VIEW.BLACKLIST})}):Utils.MsgUtils.addMidMsg("该玩家不在黑名单")},i.N="FriendProxy",i}(BaseProxy);s.FriendPy=e,__reflect(e.prototype,"game.FriendPy");var c=function(i){function e(e){var t=i.call(this)||this;return t.friendId=0,t.friendLevel=0,t.friendPower=0,t.lastOnlineTime=0,t.relation=0,t.vipLevel=0,t.camp=0,t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.friendId=e.baseInfo.playerId,this.friendName=e.baseInfo.name,this.friendAvatar=e.baseInfo.avatar,this.friendPower=e.baseInfo.fightCap,this.friendGuild=e.baseInfo.guild,this.lastOnlineTime=e.baseInfo.offlineTime,this.relation=e.relation,this.vipLevel=e.baseInfo.vipLevel,this.camp=e.baseInfo.camp,this.friendLevel=e.baseInfo.level,this.frame=e.baseInfo.frame},e}(s.BaseVO);s.FriendVO=c,__reflect(c.prototype,"game.FriendVO");var d=function(i){function e(e){var t=i.call(this)||this;return t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.giveRecord=e.giveRecord,this.getRecord=e.getRecord,this.bagRecord=e.bagRecord},e}(s.BaseVO);s.FriendGiftVO=d,__reflect(d.prototype,"game.FriendGiftVO")}(game||(game={})),function(s){var a=function(i){function c(){var e=i.call(this)||this;e.index=0,e.BtnNotice=!1,e.skinName="FriendUISkin",e.friendProxy=s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N),e.friendProxy.getFriendList(function(){e.updateView({updateIndex:e.selectTabIndex})});var t=s.Config.constConfig().FriendSelectTime.constValue;return e.timer_lb_refresh=new egret.Timer(1e3,t),e.timer_lb_refresh.reset(),e.selectTabIndex=void 0,e.serachList=[],e}return __extends(c,i),c.prototype.onDestroy=function(){i.prototype.onDestroy.call(this)},c.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initUI(),this.initButton(),this.initTabbar(),this.initList(),this.addNotice()},c.prototype.initUI=function(){var t=this;this.commonDaTanKuang.blb_title.text="好友",this.commonDaTanKuang.onCloseCB=function(){t.hide()},this.lb_refresh.text="",this.timer_lb_refresh.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){this.lb_refresh.text="",this.btn_refresh.label="刷新",this.btn_refresh.touchEnabled=!0},this),this.et_roleName.addEventListener(egret.Event.CHANGE,function(e){""==e.target.text&&t.updateView({})},this)},c.prototype.initButton=function(){var t=this;this.img_search.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""===this.et_roleName.text?Utils.MsgUtils.addMidMsg("请先输入关键字"):(this.onBarItemTap({itemIndex:c.TAB_VIEW.SEARCH}),this.friendProxy.selectFriend({condition:this.et_roleName.text},function(e,t){s.AppFacade.getInstance().updateView(s.FriendMediator.N,void 0,{tabbarIndex:c.TAB_VIEW.SEARCH})}))},this),this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.friendProxy.selectFriend(),this.timer_lb_refresh.reset(),this.btn_refresh.touchEnabled=!1,this.btn_refresh.label="";var e=s.Config.constConfig().FriendSelectTime.constValue;this.lb_refresh.text=e.toString(),this.timer_lb_refresh.removeEventListener(egret.TimerEvent.TIMER,function(){},this),this.timer_lb_refresh.addEventListener(egret.TimerEvent.TIMER,function(){e--,this.lb_refresh.text=e.toString()},this),this.timer_lb_refresh.start()},this),this.btn_oneKey.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(this.friendProxy.getFriendListNum()<=0)Utils.MsgUtils.addMidMsg("暂无好友");else if(this.BtnNotice){var e=JSON.parse(s.Config.constConfig().OnceFriendIntimacyNum.constValue),t=JSON.parse(s.Config.constConfig().FriendPokeBallGetLimit.constValue)/e,i=!1;if(this.friendProxy.getGiftCount()<t)for(var n in this.friendProxy.friendList)if(this.friendProxy.friendList[n].friendGiftVO){var o=this.friendProxy.friendList[n].friendGiftVO.bagRecord;if(o)for(var a in o.info)if(0<o.info[a].num){i=!0;break}}i?Utils.MsgUtils.addMidMsg("领取成功"):Utils.MsgUtils.addMidMsg("赠送成功");var r=FriendGoodType.FriendPokeBall;this.friendProxy.OperateFriendGift({friendId:0,operationType:FriendGoodOperationType.QuickGetAndGiveOperation,type:1,code:r,num:e})}},this),this.btn_acceptAll.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.friendProxy.getListByType(c.TAB_VIEW.APPLY);0<Object.keys(e).length?t.friendProxy.agreeRequest({friendId:0}):Utils.MsgUtils.addMidMsg("暂无申请信息")},this),this.btn_deleteAll.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.friendProxy.getListByType(c.TAB_VIEW.APPLY);0<Object.keys(e).length?t.friendProxy.rejectRequest({friendId:0}):Utils.MsgUtils.addMidMsg("暂无申请信息")},this),this.btn_releasrAll.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.friendProxy.TickOutBlackList(0)},this)},c.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar.dataProvider=new eui.ArrayCollection([{source:{up:"_btn_yq_m_json.common_yeqian_haoyou_0",down:"_btn_yq_m_json.common_yeqian_haoyou_1",text:"好友"}},{source:{up:"_btn_yq_m_json.common_yeqian_shenqing_0",down:"_btn_yq_m_json.common_yeqian_shenqing_1",text:"申请"}},{source:{up:"_btn_yq_m_json.common_yeqian_heimingdan_0",down:"_btn_yq_m_json.common_yeqian_heimingdan_1",text:"黑名单"}}]),this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this)},c.prototype.initList=function(){this.list_item.itemRenderer=e,this.collection_list=new eui.ArrayCollection,this.list_item.dataProvider=this.collection_list},c.prototype.onBarItemTap=function(e){var o=this;void 0===e&&(e={itemIndex:c.TAB_VIEW.FRIEND}),e&&null!=e.itemIndex&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex),this.selectTabIndex!=e.itemIndex&&(this.scroller_item.stopAnimation(),this.scroller_item.viewport.scrollV=0),this.selectTabIndex=e.itemIndex;var t=this.friendProxy.getListByType(e.itemIndex);this.btn_oneKey.visible=!1,this.btn_acceptAll.visible=!1,this.btn_deleteAll.visible=!1,this.btn_releasrAll.visible=!1,this.lb_refresh.visible=!1,this.gp_noFriend.visible=!1,this.btn_refresh.visible=!1,this.gp_friendinfo.visible=!1,this.lb_tip.text="";switch(e.itemIndex){case c.TAB_VIEW.FRIEND:this.btn_oneKey.visible=!0,function(){o.gp_friendinfo.visible=!0;var e=s.Config.constConfig().FriendNum.constValue,t=JSON.parse(s.Config.constConfig().OnceFriendIntimacyNum.constValue),i=s.Config.constConfig().FriendPokeBallGetLimit.constValue,n=o.friendProxy.getGiftCount();o.bm_friends.text=o.friendProxy.getFriendListNum(c.TAB_VIEW.FRIEND)+"/"+e,o.bm_friendgift.text=n*t+"/"+i,o.lb_tip.text=""}(),this.gp_search.visible=!1,this.scroller_item.height=641,0==this.friendProxy.getFriendListNum(c.TAB_VIEW.FRIEND)&&(this.gp_noFriend.visible=!0,this.lb_empty_tips.text="暂无好友");break;case c.TAB_VIEW.APPLY:this.btn_acceptAll.visible=!0,this.btn_deleteAll.visible=!0,this.lb_tip.text="收到请求："+this.friendProxy.getFriendListNum(c.TAB_VIEW.APPLY),this.gp_search.visible=!1,this.scroller_item.height=641,0==this.friendProxy.getFriendListNum(c.TAB_VIEW.APPLY)&&(this.gp_noFriend.visible=!0,this.lb_empty_tips.text="暂无信息");break;case c.TAB_VIEW.SEARCH:0==this.friendProxy.getFriendListNum(c.TAB_VIEW.SEARCH)&&(this.gp_noFriend.visible=!0,this.lb_empty_tips.text="搜索不到相关信息。。。"),this.lb_refresh.visible=!0,this.btn_refresh.visible=!0,this.gp_search.visible=!0,this.scroller_item.height=615;break;case c.TAB_VIEW.BLACKLIST:0==this.friendProxy.getFriendListNum(c.TAB_VIEW.BLACKLIST)&&(this.gp_noFriend.visible=!0,this.lb_empty_tips.text="暂无信息"),this.btn_releasrAll.visible=!0,this.gp_search.visible=!1,this.scroller_item.height=641}this.img_bg.height=this.scroller_item.height+10,this.updateList({friendList:t,itemIndex:e.itemIndex})},c.prototype.updateView=function(e){if(e||(e={}),null==e.updateIndex||e.updateIndex==this.selectTabIndex){var t=e.tabbarIndex;if(null==t)if(null==this.selectTabIndex){for(var i in this.friendProxy.friendList){!0;break}t=c.TAB_VIEW.FRIEND,this.tabbar.selectedIndex=t}else t=this.selectTabIndex;else t!=c.TAB_VIEW.SEARCH&&(this.tabbar.selectedIndex=t);this.onBarItemTap({itemIndex:t}),this.updateNotice()}},c.prototype.updateList=function(e){void 0===e&&(e={friendList:{},itemIndex:c.TAB_VIEW.FRIEND});var t=new Array;for(var i in e.friendList){var n={serverData:e.friendList[i],itemIndex:e.itemIndex,visible:!0};t.push(n)}for(var o in t.sort(function(e,t){return 0==e.serverData.lastOnlineTime&&0!=t.serverData.lastOnlineTime?-1:0==t.serverData.lastOnlineTime&&0!=e.serverData.lastOnlineTime?1:e.serverData.lastOnlineTime!=t.serverData.lastOnlineTime?t.serverData.lastOnlineTime-e.serverData.lastOnlineTime:e.serverData.friendPower>t.serverData.friendPower?-1:e.serverData.friendPower<t.serverData.friendPower?1:void 0}),this.collection_list.replaceAll(t),this.BtnNotice=!1,t){var a=t[o];if(a.serverData.friendGiftVO&&a.serverData.friendGiftVO.bagRecord){var r=a.serverData.friendGiftVO.bagRecord;for(var s in r.info)if(0<r.info[s].num){this.BtnNotice=!0;break}}a.serverData.friendGiftVO&&!a.serverData.friendGiftVO.giveRecord&&(this.BtnNotice=!0)}UIActionManager.setAbsGrey(this.btn_oneKey,!this.BtnNotice),this.btn_oneKey.touchEnabled=this.BtnNotice},c.prototype.updateGiftData=function(){if(this.selectTabIndex==c.TAB_VIEW.FRIEND){this.friendProxy.getListByType(this.selectTabIndex);this.updateView({tabbarIndex:c.TAB_VIEW.FRIEND,updateIndex:c.TAB_VIEW.FRIEND})}},c.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.FRIEND_GIFT,this.tabbar,this,{percentX:55/290,percentY:50/81}),NoticeManager.addNoticeListener(NT.FRIEND_APPLY,this.tabbar,this,{percentX:140/290,percentY:50/81})},c.prototype.perClose=function(){this.selectTabIndex=void 0,this.serachList=[],this.timer_lb_refresh.stop()},c.TAB_VIEW={FRIEND:0,APPLY:1,RECOMMEND:3,BLACKLIST:2,SEARCH:7},c}(BasePanel);s.FriendUI=a,__reflect(a.prototype,"game.FriendUI");var e=function(t){function e(){var e=t.call(this)||this;return e.friendProxy=s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N),e.playerProxy=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N),e.skinName="FriendItemSkin",e.inintButton(),e.giftState=new Array,e}return __extends(e,t),e.prototype.dataChanged=function(){var e=this.data.serverData;this.lb_info.text=e.friendName,this.caculateState();var t=new s.PlayerInfoVO;t.avatar=this.data.serverData.friendAvatar,t.level=this.data.serverData.friendLevel,t.name=this.data.serverData.friendName,t.playerVip=this.data.serverData.vipLevel,t.playerId=this.data.serverData.friendId,t.frame=this.data.serverData.frame,this.playerhead.updateData({vo:t}),this.visible=this.data.visible,this.updateItem(this.data.itemIndex)},e.prototype.caculateState=function(){if(this.data.itemIndex==a.TAB_VIEW.FRIEND||this.data.itemIndex==a.TAB_VIEW.SEARCH&&this.friendProxy.friendList[this.data.serverData.friendId]){this.giftState=[];var e=this.data.serverData.friendGiftVO;if(!e)return this.giftState.push(0),this.giftState.push(0),void this.giftState.push(0);if(e.giveRecord?this.giftState.push(1):this.giftState.push(0),e.getRecord?this.giftState.push(1):this.giftState.push(0),e.bagRecord){var t=0;for(var i in e.bagRecord.info){if(0<e.bagRecord.info[i].num&&e.bagRecord.friendId==this.data.serverData.friendId){t=1;break}}this.giftState.push(t)}else this.giftState.push(0)}},e.prototype.inintButton=function(){var e=this;this.playerhead.addTapEvent(function(){s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N);s.AppFacade.getInstance().showSubView(s.FriendMediator.N,s.FriendMediator.SV.INFO,{playerId:e.data.serverData.friendId})}),this.btn_accept.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data&&this.friendProxy.agreeRequest({friendId:this.data.serverData.friendId})},this),this.btn_delete.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data&&this.friendProxy.rejectRequest({friendId:this.data.serverData.friendId})},this),this.btn_apply.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data&&this.friendProxy.addFriend({friendId:this.data.serverData.friendId},void 0,void 0,this.data.itemIndex)},this),this.btn_getGift.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e="",t=!1,i=10*this.giftState[1]+this.giftState[2],n=JSON.parse(s.Config.constConfig().OnceFriendIntimacyNum.constValue);switch(s.Config.constConfig().FriendPokeBallGetLimit.constValue/n<=this.friendProxy.getGiftCount()&&Utils.MsgUtils.addMidMsg("今日已全部领取完成！"),i){case 0:return;case 10:e="已领取!";break;case 1:t=!0,e="领取成功"}if(t){var o=FriendGoodType.FriendPokeBall;this.friendProxy.OperateFriendGift({friendId:this.data.serverData.friendId,operationType:FriendGoodOperationType.GetOperation,type:1,code:o,num:JSON.parse(s.Config.constConfig().OnceFriendIntimacyNum.constValue)})}""!=e&&Utils.MsgUtils.addMidMsg(e)},this),this.btn_giveGift.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e="",t=!1;switch(this.giftState[0]){case 0:t=!0,e="赠送成功!";case 1:e="已赠送!"}if(t){var i=FriendGoodType.FriendPokeBall;this.friendProxy.OperateFriendGift({friendId:this.data.serverData.friendId,operationType:FriendGoodOperationType.GiveOperation,type:1,code:i,num:JSON.parse(s.Config.constConfig().OnceFriendIntimacyNum.constValue)})}""!=e&&Utils.MsgUtils.addMidMsg(e)},this),this.btn_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.playerProxy.ChallengePlayer(e.data.serverData.friendId)},this),this.btn_release.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.friendProxy.TickOutBlackList(e.data.serverData.friendId)},this)},e.prototype.updateItem=function(e){var i=this;this.gp_friend.visible=!1,this.gp_applyList.visible=!1,this.btn_apply.visible=!1,this.btn_getGift.visible=!1,this.btn_giveGift.visible=!1,this.btn_release.visible=!1;var t=this.data.serverData,n=Utils.TimerManager.getServerTime();switch(this.fightCapItem.update(t.friendPower),this.lb_outlineTime_rightTop.text=Utils.TimerManager.getOfflineDescBySecond(t.lastOnlineTime?n-t.lastOnlineTime:0),e){case a.TAB_VIEW.FRIEND:var o=function(){i.gp_friend.visible=!0,i.caculateState();var e=i.friendProxy.getGiftCount(),t=JSON.parse(s.Config.constConfig().OnceFriendIntimacyNum.constValue);s.Config.constConfig().FriendPokeBallGetLimit.constValue/t<=e?i.giftState[0]||(i.btn_giveGift.visible=!0):(i.giftState[0]||(i.btn_giveGift.visible=!0),!i.giftState[1]&&i.giftState[2]&&(i.btn_getGift.visible=!0)),i.btn_giveGift.visible?(i.btn_giveGift.x=67,i.btn_getGift.visible&&(i.btn_getGift.x=0)):i.btn_getGift.visible&&(i.btn_getGift.x=67)};o&&o.call(this);break;case a.TAB_VIEW.APPLY:this.gp_applyList.visible=!0;break;case a.TAB_VIEW.SEARCH:this.friendProxy.friendList[this.data.serverData.friendId]?o&&o.call(this):this.btn_apply.visible=!0;break;case a.TAB_VIEW.BLACKLIST:this.btn_release.visible=!0}},e}(eui.ItemRenderer);__reflect(e.prototype,"FriendItem")}(game||(game={})),function(l){var e=function(t){function e(e){var c=t.call(this)||this;return c.curIndex=0,c.index=0,c.invitePlayerIds=[],c.tabbarConfig=[{data:{up:"_btn_yq_m_json.common_yeqian_haoyou_0",down:"_btn_yq_m_json.common_yeqian_haoyou_1"},getList:function(){var i=l.AppFacade.getInstance().retrieveProxy(l.FriendPy.N),n=[],e=function(e){var t=i.friendList[e];t&&e==t.friendId&&n.push({playerId:t.friendId,playerName:t.friendName,avatar:t.friendAvatar,level:t.friendLevel,fightCap:t.friendPower,guildId:t.friendGuild,lastOnlineTime:t.lastOnlineTime,vipLevel:t.vipLevel})};if(c.params.moduleId==MODULE.TeamExpedition)for(var t=0,o=c.invitePlayerIds;t<o.length;t++){e(o[t])}else for(var a in i.friendList)e(a);return n},index:0,title:"好友列表"},{data:{up:"_btn_yq_m_json.common_yeqian_gonghui_0",down:"_btn_yq_m_json.common_yeqian_gonghui_1"},getList:function(){var e=l.AppFacade.getInstance().retrieveProxy(l.GuildPy.N),t=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N).playerInfoVO.playerId,i=[];if(c.params.moduleId==MODULE.TeamExpedition)for(var n=0,o=c.invitePlayerIds;n<o.length;n++){var a=o[n];for(var r in e.memberList){if((s=e.memberList[r]).baseInfo.playerId!=t&&a==s.baseInfo.playerId){i.push(s.baseInfo);break}}}else for(var r in e.memberList){var s;(s=e.memberList[r]).baseInfo.playerId!=t&&i.push(s.baseInfo)}return i},index:1,title:"公会好友"}],c.skinName="InviteFriendViewSkin",c.params=e,c}return __extends(e,t),e.prototype.childrenCreated=function(){var o=this;if(t.prototype.childrenCreated.call(this),this.params){if(this.initTabbar(),this.initList(),this.params.moduleId==MODULE.TeamExpedition){var a=l.AppFacade.getInstance().retrieveProxy(l.TeamExpePy.N);l.AppFacade.getInstance().retrieveProxy(l.FriendPy.N).getFriendList(function(){var e=l.AppFacade.getInstance().retrieveProxy(l.FriendPy.N),t=(e.friendList,[]);for(var i in e.friendList){var n=e.friendList[i];t.push(n.friendId)}a.GetInviteFriendIds({playerIds:t},function(e){o.invitePlayerIds=e,o.updateView()})})}else{l.AppFacade.getInstance().retrieveProxy(l.FriendPy.N).getFriendList(function(){o.updateView()})}var e=l.AppFacade.getInstance().retrieveProxy(l.GuildPy.N);e.isInGuild()&&e.getMemberListReq(),this.CommonDaTanChuKuang.onCloseCB=function(){o.hide()}}},e.prototype.initTabbar=function(){var t=this,e=Number(this.params.tabbarType);if(e&&e!=Number.NaN){for(var i=[],n=0;0<e;){var o=e%10;e=Math.floor(e/10),o&&i.push(this.tabbarConfig[n].data),n++}this.tabbar_type.itemRendererSkinName="FriendTabBarItemSkin",this.tabbar_type.dataProvider=new eui.ArrayCollection(i),this.tabbar_type.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){e&&null!=e.itemIndex&&e.itemIndex!=t.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),t.index=e.itemIndex),t.curIndex=e.itemIndex,t.updateView()},this)}},e.prototype.initList=function(){this.list_root.itemRenderer=i},e.prototype.updateView=function(){var t=this;this.CommonDaTanChuKuang.blb_title.text=this.tabbarConfig[this.curIndex].title;var e=this.tabbarConfig[this.curIndex].getList(),i=l.AppFacade.getInstance().retrieveProxy(l.FriendPy.N).getInviteHistory(this.params.moduleId);this.params&&this.params.filter&&(e=e.filter(this.params.filter)),e.forEach(function(e){0<=i.indexOf(e.playerId)&&(e.invited=!0),e.inviteCallback=t.params.inviteCallback}),e.sort(function(e,t){return e.lastOnlineTime-t.lastOnlineTime}),this.list_root.dataProvider=new eui.ArrayCollection(e),e&&e.length<1?this.gp_empty.visible=!0:this.gp_empty.visible=!1},e}(BasePanel);l.InviteFriendView=e,__reflect(e.prototype,"game.InviteFriendView");var i=function(i){function e(){var e=i.call(this)||this;return e.skinName="InviteFriendViewItemSkin",e}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.btn_invite.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.invited?Utils.MsgUtils.addMidMsg("已邀请"):e.data.lastOnlineTime||e.data.offlineTime?Utils.MsgUtils.addMidMsg("无法邀请离线玩家"):e.data.inviteCallback&&e.data.inviteCallback(e.data.playerId,function(){e.data.invited=!0,e.dataChanged()})},this)},e.prototype.dataChanged=function(){i.prototype.dataChanged.call(this),this.playerhead.updateData({vo:this.data}),this.fightCapItem.update(this.data.fightCap);var e=Utils.TimerManager.getServerTime(),t=this.data.lastOnlineTime||this.data.offlineTime;this.lb_outlineTime_rightTop.text=Utils.TimerManager.getOfflineDescBySecond(t?e-t:0),t?(this.lb_outlineTime_rightTop.text=this.lb_outlineTime_rightTop.text.slice(3)+"前",this.lb_outlineTime_rightTop.textColor=5841675):this.lb_outlineTime_rightTop.textColor=28730,this.lb_info.text=this.data.playerName||this.data.name,this.data.invited?(this.btn_invite.skinName="skins.ButtonSkinSure",this.btn_invite.label="已邀请"):(this.btn_invite.skinName="skins.ButtonSkinYellow2",this.btn_invite.label="邀请")},e}(eui.ItemRenderer);__reflect(i.prototype,"InviteFriendViewItem")}(game||(game={})),function(m){var e=function(i){function e(e){var t=i.call(this)||this;return t.skinName="HeroDetailViewSkin",t.heroProxy=m.AppFacade.getInstance().retrieveProxy(m.HeroPy.N),t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.activateComponent()},e.prototype.updateView=function(e){if(this.params=e,this.params&&this.params.code){this.params.type=this.params.type||Math.floor(this.params.code/1e7),this.baseConfig=m.Config.allHeroConfig(this.params.type==EEntityType.EEntityTypePet)[this.params.code]||m.Config.creepConfig(this.params.code),this.upstarConfig=m.Config.heroAndPetUpstarConfig(this.params.type==EEntityType.EEntityTypePet)[this.params.code],this.upgradeConfig=m.Config.heroAndPetUpgradeConfig(this.params.type==EEntityType.EEntityTypePet)[this.params.code];var t=m.Config.heroAndPetSectionConfig(this.params.type==EEntityType.EEntityTypePet),i=this.baseConfig.maxLevel;for(var n in t){var o=t[n];i>=parseInt(o.level)&&(this.sectionConfig=o)}this.baseConfig&&(this.updateHeroBaseInfo(),this.updateHeroInfo(),this.updateAttr())}},e.prototype.updateHeroBaseInfo=function(){this.lb_level.text=this.baseConfig.maxLevel+"/"+this.baseConfig.maxLevel,this.lb_desc.text=this.baseConfig.desc,this.gp_skills.visible=!0;for(var e=JSON.parse(this.baseConfig.skillUnlock),t=this.sectionConfig&&this.sectionConfig.id||0,i=1;i<=5;i++){var n=SKILL_CODE[i];this["skill_"+i];if(n){var o={code:this.baseConfig[n],unlock:t>=e[i]};this["skill_"+i].updateItem(o)}else this["skill_"+i].updateItem()}},e.prototype.updateAttr=function(){var e=[],t=JSON.parse(this.baseConfig.baseAttr),i=JSON.parse(this.baseConfig.upAttr),n=this.sectionConfig&&JSON.parse(this.sectionConfig.attr)||[];if(e=m.GeneralConfig.AttrAddAttr(e,t),i=m.GeneralConfig.AttrMutilAttr(i,parseInt(this.baseConfig.maxLevel)-1),e=m.GeneralConfig.AttrAddAttr(e,i),e=m.GeneralConfig.AttrAddAttr(e,n),this.upstarConfig){var o=this.upstarConfig&&JSON.parse(this.upstarConfig.upAttr);e=m.GeneralConfig.AttrMutilAttr(e,o)}this.baseConfig.posSkill1,this.baseConfig.posSkill2,this.baseConfig.posSkill3;for(var a=m.Config.skillBaseConfig(),r=[],s=[],c=JSON.parse(this.baseConfig.skillUnlock),l=this.sectionConfig&&this.sectionConfig.id||0,h=1;h<=5;h++){var p=SKILL_CODE[h-1];if(p&&this.baseConfig[p]){var d=this.baseConfig[p];if(l>=c[h-1]){var u=a[d];if(u){var g=JSON.parse(u.attr);for(var f in g){var _=g[f];1e5<=_[1]?r=m.GeneralConfig.AttrAddAttr(r,[_]):s=m.GeneralConfig.AttrAddAttr(s,[_])}}}}}for(var f in e=m.GeneralConfig.AttrAddAttr(e,r),e=m.GeneralConfig.AttrAddAttr(e,s))e[f][1]=Math.floor(e[f][1]);e.sort(function(e,t){return e[0]-t[0]}),this.gp_upgrade_attr.removeChildren();for(h=1;h<=4;h++)this.gp_upgrade_attr.addChild(new m.HeroMainView_AttrItem({type:h,num:e[h-1][1]}))},e.prototype.updateHeroInfo=function(){this.lb_name.text=this.baseConfig.name,this.img_race_icon.source=HeroRaceConfig[this.baseConfig.race].raceIconBig,this.img_profession_icon.source=ProfessionConfig[this.baseConfig.profession].icon,this.img_tier_icon.source=m.GeneralConfig.getHeroJingyingTag(this.baseConfig.code),this.hero_model.update({code:this.params.code,isPet:this.params.type==EEntityType.EEntityTypePet});var e=m.GeneralConfig.getHeroStarInfo(this.baseConfig.initStar);if(this.gp_star.removeChildren(),e.stage<4)for(var t=0;t<e.num;t++)this.gp_star.addChild(new eui.Image(e.src));else this.gp_star.addChild(new customui.HighStarLevelIcon(e.num))},e.prototype.bindSkillPanelClick=function(t){var i=this,n=t.target;n.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){if(n.data&&n.data.code)for(var e in i.skill_panel.visible=!0,i.skill_panel.updateItem({code:n.data.code}),t)"target"!=e&&(i.skill_panel[e]=t[e])},this),n.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skill_panel.visible=!1},this),n.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skill_panel.visible=!1},this),n.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skill_panel.visible=!1},this)},e.prototype.activateComponent=function(){for(var e=1;e<=5;e++){var t=this["skill_"+e];this.bindSkillPanelClick({target:t,x:34,bottom:e<4?130:73})}this.hero_model.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hero_model.changeAction(customui.HeroDynamicModel.TOUCH_ACTION_LIST)},this)},e.prototype.getParentView=function(){return GameRootLayer.gameLayer().panelLayer},e}(BasePanel);m.HeroDetailView=e,__reflect(e.prototype,"game.HeroDetailView")}(game||(game={})),function(s){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new i).register(),(new n).register(),(new a).register(),(new o).register(),(new r).register(),(new c).register(),(new l).register(),(new h).register()},e}();s.GuajiProcessor=e,__reflect(e.prototype,"game.GuajiProcessor");var t=function(e){function t(){return e.call(this,"risk.LayerInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){s.AppFacade.getInstance().retrieveProxy(s.GuajiPy.N).updateLayerInfo(e.getBody().info)},t}(s.ProcessorBase);s.LayerInfoP=t,__reflect(t.prototype,"game.LayerInfoP");var i=function(e){function t(){return e.call(this,"risk.EventInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=this,i=s.AppFacade.getInstance().retrieveProxy(s.GuajiPy.N),n=e.getBody();i.updateEventInfo(n.uuid,n.event);var o=n.event;if(o.type==RiskEventType.MysticalShop){var a=s.GameMVC.guajiMed;if(a.guajiUI&&a.guajiUI.map){var r=a.guajiUI.map.tile2EP(o.position.x,o.position.y);egret.setTimeout(function(){r.viewShowed||egret.setTimeout(function(){s.GameMVC.fightPy.addDelayCBAfterFightExit(function(){r.onTrigger(),s.GameMVC.fightPy.queueExceExitCB()},"RISK_MYSTICAL_SHOP")},t,2e3)},this,300)}}},t}(s.ProcessorBase);s.EventInfoP=i,__reflect(i.prototype,"game.EventInfoP");var n=function(e){function t(){return e.call(this,"risk.MineFullP",t)||this}return __extends(t,e),t.prototype.execute=function(e){s.AppFacade.getInstance().sendNotification(CN.GUAJI_UPDATE_MINE)},t}(s.ProcessorBase);s.MineFullP=n,__reflect(n.prototype,"game.MineFullP");var o=function(e){function t(){return e.call(this,"risk.QuickBattleInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=s.AppFacade.getInstance().retrieveProxy(s.GuajiPy.N),i=e.getBody();t.quickBattleInfo=i.info},t}(s.ProcessorBase);s.QuickBattleInfoP=o,__reflect(o.prototype,"game.QuickBattleInfoP");var a=function(e){function t(){return e.call(this,"risk.LayerProgressP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=this,i=e.getBody();s.GameMVC.guajiPy.riskProgress&&s.GameMVC.guajiPy.riskProgress.uuid==i.riskProgress.uuid&&(s.GameMVC.guajiPy.riskProgress=i.riskProgress,s.GameMVC.fightPy.addDelayCBAfterFightExit(function(){var e=s.AppFacade.getInstance().retrieveMediator(s.GuajiMediator.N);e.guajiUI&&(e.guajiUI.updateProgress({fromPush:!0}),egret.setTimeout(function(){e&&e.guajiUI&&e.guajiUI.tongGuan()},t,1e3)),s.GameMVC.fightPy.queueExceExitCB()},"layerProgress"))},t}(s.ProcessorBase);s.LayerProgressP=a,__reflect(a.prototype,"game.LayerProgressP");var r=function(e){function t(){return e.call(this,"risk.MineRewardP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody(),i=s.AppFacade.getInstance().retrieveProxy(s.GuajiPy.N);t.mines;t.mines.forEach(function(e){for(var t in i.minesInfo){if(i.minesInfo[t].uuid==e.uuid){i.minesInfo[t]=e;break}}}),s.AppFacade.getInstance().updateView(s.GuajiMediator.N,s.GuajiMediator.SV.MINES_LIST,t),s.AppFacade.getInstance().sendNotification(CN.GUAJI_GOLD_REFRESH,t)},t}(s.ProcessorBase);s.MineRewardP=r,__reflect(r.prototype,"game.MineRewardP");var c=function(e){function t(){return e.call(this,"demon.DemonInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();s.GameMVC.guajiPy.updateDemonList(t.demon,!0)},t}(s.ProcessorBase);s.DemonInfoP=c,__reflect(c.prototype,"game.DemonInfoP");var l=function(e){function t(){return e.call(this,"demon.PlayerDemonInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();s.GameMVC.guajiPy.playerDemonInfo=t.info,s.AppFacade.getInstance().updateView(s.GuajiMediator.N,s.GuajiMediator.SV.DEMON)},t}(s.ProcessorBase);s.PlayerDemonInfoP=l,__reflect(l.prototype,"game.PlayerDemonInfoP");var h=function(e){function t(){return e.call(this,"riskMulti.RoomInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){s.GameMVC.guajiPy.updateRiskMultiRoomInfo(e.getBody().info)},t}(s.ProcessorBase);s.RiskMultiRoomInfoP=h,__reflect(h.prototype,"game.RiskMultiRoomInfoP")}(game||(game={})),function(h){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.curLayerInfo=new h.LayerVO,e.lastCurLayerId=[],e.allCurLayerInfo=[],e.minesInfo=new Array,e.mineNum=0,e.curLayerCBT=new Array,e.allLayersInfo=[],e.riskMultiRoomInfo=new h.RiskMultiSRoomInfo,e.demonList={},e.curLayerTheme={},e.firstEnterMapAfterLogin=!0,e._localType=void 0,e.AllMapInfo={},NoticeManager.registerCB(NT.GUAJI_MULTI,e.checkMultiNotice,e),NoticeManager.registerCB(NT.GUAJI_GZGZH,e.checkGZGZHNotice,e),NoticeManager.registerCB(NT.GUAJI_GZGZH2,e.checkGZGZHNotice,e),NoticeManager.registerCB(NT.GUAJI_GZGZH3,e.checkGZGZHNotice,e),e}return __extends(i,t),Object.defineProperty(i.prototype,"localType",{get:function(){return this._localType},set:function(e){this._localType=e,Utils.LocalStorageUtil.setItem("guajiLayerType",this._localType+"")},enumerable:!0,configurable:!0}),i.prototype.updateMapInfo=function(e){var i=this;Array.isArray(e)||(e=[e]),e.forEach(function(e){if(i.AllMapInfo[e.uuid])i.AllMapInfo[e.uuid].update(e);else{var t=new h.MapVO(e);i.AllMapInfo[e.uuid]=t}}),h.AppFacade.getInstance().sendNotification(CN.GUAJI_MAP_BACKPACK_UPDATE)},i.prototype.deleteMapByUuids=function(e){delete this.AllMapInfo[e],h.AppFacade.getInstance().sendNotification(CN.GUAJI_MAP_BACKPACK_UPDATE)},i.prototype.updateCurPosition=function(e,t,i){if(this.curLayerInfo.curPosVO.x=e,this.curLayerInfo.curPosVO.y=t,i){this.curLayerInfo.curPosVO.layerId=i;var n=h.Config.risk()[i];n&&(this.localType=n.type,this.lastCurLayerId[this.curLayerInfo.position.difficultyType]=this.curLayerInfo.curPosVO.layerId)}h.AppFacade.getInstance().sendNotification(CN.GUAJI_LAYER_INFO_TIPS_UPDATE)},i.prototype.resetCurLayerInfo=function(){this.curLayerInfo.reset()},i.prototype.updateLayerInfo=function(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=void 0);var n=this.curLayerInfo.uuid!=e.uuid;t&&(n=!0),n&&this.curLayerCBT.splice(0),this.curLayerInfo.update(e),this.localType=this.curLayerInfo.position.difficultyType,h.Config.risk()[this.curLayerInfo.curPosVO.layerId]&&(this.lastCurLayerId[this.curLayerInfo.position.difficultyType]=this.curLayerInfo.curPosVO.layerId),this.sendNotification(CN.GUAJI_LAYER_INFO_UPDATE,{isEnterNewLayer:n})},i.prototype.updateEventInfo=function(e,t){var i,n=!1;if(e==this.curLayerInfo.uuid)for(var o=0,a=this.curLayerInfo.events;o<a.length;o++){var r=a[o];if(r.position.x==t.position.x&&r.position.y==t.position.y){console.log("risk更新事件"),r.update(t),i=r,n=!0;break}}n||(console.log("risk新增事件"),this.curLayerInfo.events.push(new h.EventVO(t))),this.sendNotification(CN.GUAJI_LAYER_EVENT_INFO_UPDATE,{event:i})},i.prototype.getShowTipsForPosition=function(e,t){void 0===t&&(t=0);var i="";return e.type==RiskNodeType.Risk?i+=h.Config.risk()[e.id].name:e.type==RiskNodeType.Fortress?i+=h.Config.riskFortress()[e.id].name+"("+e.num+"层)":e.type==RiskNodeType.Maze&&(i+=h.Config.riskMaze()[e.id].name+"("+e.num+"层)"),0==t&&(i+="("+e.x+","+e.y+")"),e.position&&e.position.type&&(i+="-"+this.getShowTipsForPosition(e.position,t)),i},i.prototype.GetLayerInfo=function(t,i){var n=this;void 0===t&&(t=!1),void 0===i&&(i=void 0),null==this._localType&&(this._localType=Number(Utils.LocalStorageUtil.getItem("guajiLayerType")),this._localType||(this._localType=0)),null==i&&(i=this.localType),Utils.Socket.send("risk","GetLayerInfo",{type:i}).then(function(e){n.updateLayerInfo(e.info,t,i)})},i.prototype.GetLayerNum=function(i,n){var o=this;null==n&&(n=this.localType),Utils.Socket.send("risk","GetRiskLayers",{type:n}).then(function(e){for(var t in o.allLayerNum=0,e.list){e.list[t].type==o.localType&&o.allLayerNum++}o.allLayersInfo[n]=e.list,i&&i()})},i.prototype.GetLayerProgress=function(t){var i=this;Utils.Socket.send("risk","GetLayerProgress",{type:this.localType}).then(function(e){i.riskProgress=e.riskProgress,t&&t()})},i.prototype.GetProgressReward=function(e,t,i){var n=this;null==i&&(i=this.localType),Utils.Socket.send("risk","GetProgressReward",{uuid:e||"",type:i}).then(function(e){n.riskProgress=e.riskProgress,h.AppFacade.getInstance().retrieveProxy(h.BackpackPy.N).handleClientReward(e.clientReward),t&&t()})},i.prototype.getPurePosition=function(e){var t=e||this.curLayerInfo.curPosVO;return{x:t.x,y:t.y}},i.prototype.Walk=function(e,t,i){Utils.Socket.send("risk","Walk",{positions:e,type:this.localType}).then(function(e){i&&i()})},i.prototype.getVoByPosition=function(e){for(var t=void 0,i=0,n=this.curLayerInfo.events;i<n.length;i++){var o=n[i];if(o.position.x==e.x&&o.position.y==e.y){t=o;break}}return t},i.prototype.MiniTriggerEvent=function(e,t){var i=0;2e4<e&&(e%=2e4,i=1),Utils.Socket.send("risk","SwitchRisk",{num:e,type:i}).then(function(e){t&&t()})},i.prototype.TriggerEvent=function(e,t,i,n,o){var a=this;void 0===o&&(o=!1),n&&this.setAfterFightAutoGoCurEPStory(n);var r=this.getVoByPosition(e);if(r){null!=t&&(t=t.toString());var s=r.eventId,c=s&&h.Config.riskEvent()[s];if(c){var l=h.Config.riskEventDesc()[c.descId];this.tempData={eventId:s},Utils.Socket.send("risk","TriggerEvent",{position:this.getPurePosition(e),key:t,type:this.localType}).then(function(e){if(n)a.goCurEPStory(function(){e.clientReward&&l&&PopUpManager.addPopUp({obj:new h.BaseEpRewardView({config:l,rewards:e.clientReward})}),i&&i(e)});else{if(l&&c.type==RiskEventType.StoryCreep)return a.tempData={eventId:s,config:l,rewards:e.clientReward},void(i&&i(e));e.clientReward&&!o&&l&&PopUpManager.addPopUp({obj:new h.BaseEpRewardView({eventId:s,config:l,rewards:e.clientReward})}),i&&i(e)}})}else Utils.MsgUtils.addMidMsg("事件不存在")}},i.prototype.ShopBuy=function(e,t,i,n){Utils.Socket.send("risk","ShopBuy",{grid:e,num:t,position:this.getPurePosition(i),type:this.localType}).then(function(e){h.AppFacade.getInstance().retrieveProxy(h.BackpackPy.N).handleClientReward(e.clientReward,{closeCB:n})})},i.prototype.Answer=function(a,e,r,s){var c=this;void 0===s&&(s=!0),Utils.Socket.send("risk","Answer",{order:a,position:this.getPurePosition(e),type:this.localType}).then(function(e){for(var t,i=0,n=c.curLayerInfo.events;i<n.length;i++){var o=n[i];if(o.position.x==c.curLayerInfo.position.x&&o.position.y==c.curLayerInfo.position.y){(t=o).info=JSON.parse(e.info);break}}e.clientReward&&s&&h.AppFacade.getInstance().retrieveProxy(h.BackpackPy.N).handleClientReward(e.clientReward);h.AppFacade.getInstance().sendNotification(CN.GUAJI_LAYER_EVENT_INFO_UPDATE,{event:t}),h.AppFacade.getInstance().sendNotification(CN.GUIDE_MAKE_FLOW),r&&r(a,e.clientReward)})},i.prototype.GetMineInfo=function(t){var i=this;Utils.Socket.send("risk","GetMineInfo",{position:t.pos,type:this.localType}).then(function(e){i.minesInfo.splice(0),Array.isArray(e.infos)&&e.infos.forEach(function(e){i.minesInfo.push(e)}),i.mineNum=Math.max(i.mineNum,i.minesInfo.length),i.updateNotice(),t.cb&&t.cb()})},i.prototype.updateNotice=function(){var i=h.Config.riskMine();if(this.minesInfo){var n=0,e=h.AppFacade.getInstance().retrieveProxy(h.ActivityPy.N).allActivityData[EActivityType.WholeLifeCard];if(e&&e.data&&e.data.hasPurchased){var t=JSON.parse(e.content);n=t[2]}var o=!1,a=Utils.TimerManager.getServerTime();this.minesInfo.forEach(function(e){var t=i[e.id];0!=e.lastGiveDt&&a-e.lastGiveDt>=(n||t.upLimit)&&(o=!0)}),o?h.AppFacade.getInstance().sendNotification(CN.GUAJI_UPDATE_RES_NOTICE,!0):h.AppFacade.getInstance().sendNotification(CN.GUAJI_UPDATE_RES_NOTICE,!1)}else h.AppFacade.getInstance().sendNotification(CN.GUAJI_UPDATE_RES_NOTICE,!1)},i.prototype.GetRiskMapInfo=function(){var t=this;Utils.Socket.send("risk","GetRiskMapInfo",{}).then(function(e){t.updateMapInfo(e.mapList)})},i.prototype.OpenRiskMap=function(i){var n=this;Utils.Socket.send("risk","OpenRiskMap",{uuid:i}).then(function(e){if(n.deleteMapByUuids(i),e.clientReward){var t={config:{titleFixed:"藏宝图",resultDesc:[h.Config.getRiskMapItemsByCode(e.rewardCode).desc]},rewards:e.clientReward};PopUpManager.addPopUp({obj:new h.BaseEpRewardView(t)})}})},i.prototype.GetMineRewards=function(n){var o=this;Utils.Socket.send("risk","GetMineRewards",{}).then(function(e){if(e.clientReward){var t=h.AppFacade.getInstance().retrieveProxy(h.BackpackPy.N),i=n&&n.delay||0;egret.setTimeout(function(){t.handleClientReward(e.clientReward)},o,i)}o.minesInfo.splice(0),Array.isArray(e.infos)&&e.infos.forEach(function(e){o.minesInfo.push(e)}),n.cb&&n.cb(),h.AppFacade.getInstance().sendNotification(CN.GUAJI_UPDATE_RES_NOTICE)})},i.prototype.checkCurLayerHasCBT=function(){for(var e in this.curLayerCBT.splice(0),this.AllMapInfo){var t=this.AllMapInfo[e];this.curLayerInfo.position.match(t.position)&&this.curLayerCBT.push(t)}return 0<this.curLayerCBT.length&&this.curLayerCBT[0]},i.prototype.setAfterFightAutoGoCurEPStory=function(e,t){var i=this;void 0===t&&(t=!1),this.doneStoryId=e;var n=h.AppFacade.getInstance().retrieveProxy(h.FightPy.N);n.addDelayCBAfterFightExit(function(){i.goCurEPStory(function(){n.queueExceExitCB()})},"setCurEPStory",0,t)},i.prototype.goCurEPStory=function(e){this.doneStoryId?PopUpManager.addPopUp({obj:new h.StoryView({storyId:this.doneStoryId,questionId:void 0,position:void 0,cb:function(){e&&e()}})}):e&&e()},i.prototype.getQuickBattleInfo=function(){var t=this;Utils.Socket.send("risk","GetQuickBattleInfo",{}).then(function(e){t.quickBattleInfo=e.info}).catch(function(e){console.log("GetQuickBattleInfo",e)})},i.prototype.quickBattle=function(){var t=this;Utils.Socket.send("risk","QuickBattle",{}).then(function(e){t.quickBattleInfo=e.info,h.AppFacade.getInstance().retrieveProxy(h.BackpackPy.N).handleClientReward(e.clientReward),h.AppFacade.getInstance().updateView(h.GuajiMediator.N,h.GuajiMediator.SV.MAIN)}).catch(function(e){console.log("QuickBattle",e)})},i.prototype.buyQuickBattleTimes=function(e){var t=this;Utils.Socket.send("risk","BuyQuickBattleTimes",{num:e.num}).then(function(e){t.quickBattleInfo=e.info,t.quickBattle(),h.AppFacade.getInstance().retrieveProxy(h.BackpackPy.N).handleClientCost(e.clientCost)}).catch(function(e){})},i.prototype.handleQuickBattle=function(){var t=this,e=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N),i=h.Config.unlockConfig(MODULE.RiskQuickBattle),n=JSON.parse(i.condition);if(e.playerInfoVO.level<n[1])Utils.MsgUtils.addMidMsg("达到"+n[1]+"级解锁");else if(this.mineNum<=0)Utils.MsgUtils.addMidMsg("还未占领矿！");else{var o=this.quickBattleInfo,a=h.Config.VIPConfig().quickBattleTimes,r=(h.Config.constConfig().QuickBattleFreeTimes,a-o.buyCount);if(o.count<=0){var s=h.Config.publicBuyCostConfig(MODULE.RiskQuickBattle,o.buyCount),c=JSON.parse(s.costs);h.AppFacade.getInstance().retrieveProxy(h.BackpackPy.N).checkEnough(c,!0)&&h.AppFacade.getInstance().showSubView(h.CommonMediator.N,h.CommonMediator.SV.QUICK_BATTLE_DIALOG,{costTips:"快速开采资源，立刻获\n得",costTips2:"小时收益?",cost:c,reset:!0,num:r+o.count,cb:!0,clickCB:function(e){1===e.type&&PopUpManager.addPopUp({obj:new h.QuickMineView({doneCB:function(){t.buyQuickBattleTimes({num:1})}}),clickDarkClose:!1})}})}else h.AppFacade.getInstance().showSubView(h.CommonMediator.N,h.CommonMediator.SV.QUICK_BATTLE_DIALOG,{costTips:"是否免费开采资源，立刻获得",costTips2:"小时收益?",cost:"",reset:!0,num:r+o.count,cb:!0,clickCB:function(e){1===e.type&&PopUpManager.addPopUp({obj:new h.QuickMineView({doneCB:function(){t.quickBattle()}}),clickDarkClose:!1})}})}},i.prototype.checkDemonAvailable=function(){var e,t=h.GameMVC.playerPy.playerInfoVO.playerId,i=Utils.TimerManager.getServerTime();for(var n in this.demonList){var o=this.demonList[n];o.excapeDt>i&&(!e||o.excapeDt<e.excapeDt)&&(0==this.playerDemonInfo.count&&o.baseInfo.playerId!=t||(e=o))}return e},i.prototype.updateDemonList=function(e,t){var i=this;if(void 0===t&&(t=!1),Array.isArray(e)||(e=[e]),t){var n=h.GameMVC.playerPy.playerInfoVO.playerId;e.some(function(e){return!i.demonList[e.uuid]&&e.baseInfo.playerId==n})&&DragonBoneTools.playOnce({effectName:"common_swlx",parent:GameRootLayer.gameLayer().popMsgLayer,y:.3*Utils.DeviceUtils.curHeight()})}if(e.length){var o=Utils.TimerManager.getServerTime();e.forEach(function(e){0==e.leftLife||e.excapeDt<=o?i.demonList[e.uuid]&&delete i.demonList[e.uuid]:(i.demonList[e.uuid]||(i.demonList[e.uuid]=new h.DemonVO),i.demonList[e.uuid].update(e))})}else for(var a in this.demonList)delete this.demonList[a];this.sendNotification(CN.GUAJI_DEMON_UPDATE),h.AppFacade.getInstance().updateView(h.GuajiMediator.N,h.GuajiMediator.SV.DEMON)},i.prototype.GetPlayerDemonInfo=function(){var t=this;Utils.Socket.send("demon","GetPlayerDemonInfo",{}).then(function(e){t.playerDemonInfo=e.info,h.AppFacade.getInstance().updateView(h.GuajiMediator.N,h.GuajiMediator.SV.DEMON)}).catch(function(e){})},i.prototype.GetDemonList=function(){var t=this;Utils.Socket.send("demon","GetDemonList",{}).then(function(e){t.demonList={},t.updateDemonList(e.list)}).catch(function(e){})},i.prototype.ChallengeDemon=function(e){var i=this;this.playerDemonInfo?0!=this.playerDemonInfo.count?this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeDemon,pb1:"demon",pb2:"Challenge",params:{uuid:e},doneCB:function(e){var t=e.cbRet;t&&(i.playerDemonInfo=t.info),h.GameMVC.fightPy.queueExceExitCB()}}):Utils.MsgUtils.addMidMsg("挑战次数不足"):Utils.MsgUtils.addMidMsg("找不到信息")},i.prototype.checkMultiNotice=function(){if(this.riskMultiConstV||(this.riskMultiConstV=JSON.parse(h.Config.constConfig().riskMultiConfig.constValue)),this.riskMultiRoomInfo.amIOwner()&&this.riskMultiRoomInfo.members.length<=this.riskMultiConstV[2]-1)return!0},i.prototype.updateRiskMultiRoomInfo=function(e){this.riskMultiRoomInfo.update(e),NoticeManager.updateNotice(NT.GUAJI_MULTI),h.AppFacade.getInstance().sendNotification(CN.GUAJI_MULTI_GUAJI_ROOM_UPDATE)},i.prototype.RiskMultiCommand=function(e,t,i){var n=this;Utils.Socket.send("riskMulti",e,t||{}).then(function(e){e.info&&n.updateRiskMultiRoomInfo(e.info),i&&i()})},i.prototype.checkGZGZHNotice=function(){if(!Utils.LocalStorageUtil.getTodayVaild("HAS_CLICK_GZGZH_BTN"))return!0},i.N="GuajiProxy",i}(BaseProxy);h.GuajiPy=e,__reflect(e.prototype,"game.GuajiPy")}(game||(game={})),function(d){var e=function(t){function e(){var e=t.call(this)||this;return e.RIGHT_BOTTOM_BTN_HEIGHT=110,e.hasUpdateLiuhai=!1,e.skinName="GuajiViewSkin",e.py=d.AppFacade.getInstance().retrieveProxy(d.GuajiPy.N),e.guideProxy=d.AppFacade.getInstance().retrieveProxy(d.GuidePy.N),e.taskPy=d.AppFacade.getInstance().retrieveProxy(d.TaskPy.N),e.guideEffectWait=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){var n=this;t.prototype.childrenCreated.call(this),Utils.SDKMgr.nodeRecord(999999999),Utils.SDKMgr.getPerformConfig(6)||Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow?(this.hasUpdateLiuhai=!0,this.gp_mini_map_root.visible=!1,this.btn_ditu.visible=!0,this.btn_ditu1.visible=Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow,this.gp_mainTask.y=157.7,Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_ditu),Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_ditu1)):(this.btn_ditu.visible=!1,this.btn_ditu1.visible=!1,Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_mini_map_root)),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_mainTask),this.py.GetMineInfo({ispush:!0,cb:function(){n.updateMine()}}),this.sl_root.scrollPolicyV=this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF,this.gp_mini_map_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){d.AppFacade.getInstance().showSubView(d.GuajiMediator.N,d.GuajiMediator.SV.MINI_MAP,{mwArr:n.map.mwArr,tileX:n.map.me.tileX,tileY:n.map.me.tileY})},this),this.btn_ditu.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){d.AppFacade.getInstance().showSubView(d.GuajiMediator.N,d.GuajiMediator.SV.MINI_MAP,{mwArr:n.map.mwArr,tileX:n.map.me.tileX,tileY:n.map.me.tileY})},this),this.btn_ditu1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){n.py.GetLayerNum(function(){PopUpManager.addPopUp({obj:new d.GuajiGateListPanel({type:1-n.py.localType}),closeCB:function(e){var t=d.AppFacade.getInstance().retrieveProxy(d.GuajiPy.N);e&&t.MiniTriggerEvent(Number(e))}})},1-n.py.localType)},this),this.btn_cbt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=n.py.checkCurLayerHasCBT();if(t){var i=!1;t.position.x==n.py.curLayerInfo.position.x&&t.position.y==n.py.curLayerInfo.position.y&&(i=!0),d.AppFacade.getInstance().sendNotification(CN.GUAJI_OPEN_CBT,{hideRewards:!0,vo:t,showAutoBtn:!0,canGet:i})}},this),Utils.ComponentUtils.registerListener(this.btn_demon,egret.TouchEvent.TOUCH_TAP,function(){d.AppFacade.getInstance().showSubView(d.GuajiMediator.N,d.GuajiMediator.SV.DEMON)},this),this.gp_mainTask_show.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_mainTask.right=11,this.gp_mainTask_show.visible=!1},this),this.img_mainTask_hide.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_mainTask.right=-this.gp_mainTask.width,this.gp_mainTask_show.visible=!0},this),this.gp_content.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.AppFacade.getInstance().showSubView(d.GuajiMediator.N,d.GuajiMediator.SV.MAIN_TASK)},this),this.img_gold.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;this.shouJinbiEffect(),this.py.GetMineRewards({cb:function(){e.updateMine()},delay:500})},this),this.gp_jinkuang.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.AppFacade.getInstance().showSubView(d.GuajiMediator.N,d.GuajiMediator.SV.MINES_LIST)},this),this.btn_quick.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.py.handleQuickBattle()},this),this.gp_mask.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_mask.visible=this.gp_progress_details.visible=!1},this),this.gp_exit.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.Socket.send("risk","Quit",{type:n.py.localType}).then(function(){})},this),Utils.agentConfig.OffLineTest?egret.setTimeout(function(){n.py.updateLayerInfo({layerId:4,num:1,uuid:"12312312dfa",position:{x:10,y:11,layerId:4}})},this,500):this.once(egret.Event.ENTER_FRAME,function(){n.py.resetCurLayerInfo(),n.py.GetLayerInfo(!0,n.py.localType)},this),this.gp_eEffect.touchEnabled=!1,this.gp_eEffect.touchChildren=!1,DragonBoneTools.create("common_maoxianztk",function(e){e.x=this.gp_eEffect.width/2,e.y=250,Utils.DeviceUtils.setBottomAdapter(e),e.scaleX=2,e.rotation=0,e.touchEnabled=!1,e.animation.play(),this.gp_eEffect.addChild(e)},this),DragonBoneTools.create("common_maoxianztk",function(e){e.x=0,e.y=-500,e.scaleX=2,e.rotation=90,e.animation.play(),e.touchEnabled=!1,this.gp_eEffect.addChild(e)},this),DragonBoneTools.create("common_maoxianztk",function(e){var t=this;this.once(egret.Event.ENTER_FRAME,function(){e.x=t.gp_eEffect.width},this),e.y=-500,e.scaleX=2,e.rotation=-90,e.animation.play(),e.touchEnabled=!1,this.gp_eEffect.addChild(e)},this)},e.prototype.addNotice=function(){},e.prototype.removeNotice=function(){},e.prototype.updateView=function(e,t){var i=this;if(this.py.GetLayerNum(),this.updateMainTask(),e.fromGuide);else if(e&&e.isFromJump){(Utils.SDKMgr.getPerformConfig(6)||Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow)&&(this.gp_mini_map_root.visible=!1),this.gp_right_bottom.visible=!1;var n=this.gp_mainTask.visible;this.gp_mainTask.visible=!1,this.gp_mask.visible=!1,this.once(egret.Event.ENTER_FRAME,function(){Utils.SDKMgr.getPerformConfig(6)||Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow?i.setGuideAvailable():(i.gp_mini_map_root.visible=!0,UIActionManager.playUIAction(i.gp_mini_map_root,4,function(){i.setGuideAvailable()},i)),i.gp_right_bottom.visible=!0,UIActionManager.playUIAction(i.gp_right_bottom,4),n&&(i.gp_mainTask.visible=!0,UIActionManager.playUIAction(i.gp_mainTask,4))},this)}if(this.py.quickBattleInfo){var o=d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N),a=d.Config.unlockConfig(MODULE.RiskQuickBattle),r=JSON.parse(a.condition);this.img_notice.visible=0<this.py.quickBattleInfo.count&&0<this.py.minesInfo.length&&o.playerInfoVO.level>=r[1]}this.hasUpdateLiuhai?0==this.btn_ditu1.visible&&Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow&&(this.gp_mini_map_root.visible=!1,this.btn_ditu.visible=!0,this.btn_ditu1.visible=Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow,this.gp_mainTask.y=157.7,Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_ditu),Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_ditu1)):(this.hasUpdateLiuhai=!0,Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow&&(this.gp_mini_map_root.visible=!1,this.btn_ditu.visible=!0,this.btn_ditu1.visible=Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow,this.gp_mainTask.y=157.7,Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_ditu),Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_ditu1)))},e.prototype.updateCBTInfo=function(){var e=this.py.checkCurLayerHasCBT();0==this.py.localType&&e?(this.gp_cbt.visible=!0,this.gp_cbt.height=this.RIGHT_BOTTOM_BTN_HEIGHT,this.blb_cbt_pos.text=e.position.x+":"+e.position.y):(this.gp_cbt.visible=!1,this.gp_cbt.height=0)},e.prototype.updateDemonInfo=function(){var e=this,t=this.py.checkDemonAvailable();t?(this.gp_demon.visible=!0,this.gp_demon.height=this.RIGHT_BOTTOM_BTN_HEIGHT,this.demonDt=t.excapeDt-Utils.TimerManager.getServerTime(),this.demonTimer&&(egret.clearInterval(this.demonTimer),this.demonTimer=void 0),this.demonTimer=egret.setInterval(this.updateDemonTime,this,1e3)):(this.gp_demon.visible=!1,this.gp_demon.height=0,this.demonTimer&&(egret.clearInterval(this.demonTimer),this.demonTimer=void 0),this.demonTimer=egret.setInterval(function(){e.py.GetDemonList()},this,15e3))},e.prototype.updateDemonTime=function(){0<this.demonDt?this.blb_demon_dt.text=Utils.TimerManager.getFormatBySecond1(--this.demonDt):(this.demonTimer&&(egret.clearInterval(this.demonTimer),this.demonTimer=void 0),this.py.GetDemonList())},e.prototype.tongGuan=function(){},e.prototype.updateLayerInfoTips=function(){this.lb_info.text=""+this.py.getShowTipsForPosition(this.py.curLayerInfo.position,1),this.lb_info2.text="X:"+this.py.curLayerInfo.curPosVO.x+" Y:"+this.py.curLayerInfo.curPosVO.y},e.prototype.updateMine=function(e){var t=this;if(this.mineTimer&&(egret.clearTimeout(this.mineTimer),this.mineTimer=void 0),0<this.py.minesInfo.length){var i=0,n=Utils.TimerManager.getServerTime();this.py.minesInfo.forEach(function(e){if(e.lastGiveDt&&n-e.lastGiveDt>i){var t=0==i?1e6:i;i=n-e.lastGiveDt,i=Math.min(t,i)}});var o=[10,600,1800,3600,7200,10800],a=o[0],r=!1;if(o[0]<=i){this.img_gold.visible=!0;for(var s=1;s<o.length;s++){if(o[s-1]<=i&&i<o[s]){a=o[s],this.img_gold.source="mx_img_jinbidui"+s+"_png",this.jibiduiEffect(s);break}r=o.length-1==s}r?(this.jibiduiEffect(o.length-1),this.img_gold.source="mx_img_jinbidui5_png"):this.mineTimer=egret.setTimeout(function(){t.py.GetMineInfo({ispush:!0,cb:function(){t.updateMine()}})},this,1e3*(a-i))}else this.img_gold.visible=!1,this.mineTimer=egret.setTimeout(function(){t.py.GetMineInfo({ispush:!0,cb:function(){t.updateMine()}})},this,1e4);this.gp_jinkuang.visible=!0,this.wangkuangEffect(),this.mineUpdateTimer||(this.mineUpdateTimer=egret.setTimeout(function(){t.goldMineEffect()},this,1e4))}else this.gp_jinkuang.visible=!1,this.img_gold.visible=!1},e.prototype.updateResFullNotice=function(e){this.img_resFull.visible=!!e},e.prototype.wangkuangEffect=function(){var e=this,n={1:{x:this.gp_effect.width/2-60,y:this.gp_effect.height-20,scaleX:-1},2:{x:this.gp_effect.width-20,y:this.gp_effect.height-70,scaleX:1},3:{x:this.gp_effect.width-60,y:this.gp_effect.height-4,scaleX:1}};this.gp_effect.removeChildren();for(var t=function(t){var i="kuangren_"+(t%2+1);egret.setTimeout(function(){MovieClipTools.create(i,function(e){e.x=n[t+1].x,e.y=n[t+1].y,e.scaleX=1.8*n[t+1].scaleX,e.scaleY=1.8,e.animation.play(i,-1),this.gp_effect.addChild(e)},e)},o,160*t)},o=this,i=0;i<3;++i)t(i)},e.prototype.updateLayerInfo=function(e){var t=this;this.log("层信息变化");var i=e&&e.isEnterNewLayer;if(this.updateLayerInfoTips(),!this.map){var n=new d.Camera;n.horizontalCenter=0,n.verticalCenter=0,n.visible=!1,this.Group_main.addChildAt(n,this.cu_mls.parent.getChildIndex(this.cu_mls)+1),this.map=Utils.MapUtils.generateCommon({source:MODULE.Risk,multiLayerScroller:this.cu_mls,loadingParent:this.getParentView(),miniMapParent:Utils.SDKMgr.getPerformConfig(6)?void 0:this.gp_mini_map,camera:n}),this.gp_map.addChildAt(this.map,0)}var o=d.Config.riskLayer()[this.py.curLayerInfo.curPosVO.layerId];this.map.update({isInit:i,layerId:this.py.curLayerInfo.curPosVO.layerId,w:o.long,h:o.wide,tiled:o.tiled,theme:o.theme,meStartTileX:this.py.curLayerInfo.position.x,meStartTileY:this.py.curLayerInfo.position.y}),this.updateLayerEventInfo(e),this.updateMainTask(),this.updateCBTInfo(),this.py.localType?(this.btn_ditu1.icon="maoxian_icon_putong_png",this.gp_eEffect.visible=!0):(this.btn_ditu1.icon="maoxian_icon_emeng_png",this.gp_eEffect.visible=!1),this.py.GetLayerProgress(function(){t.pb_layerProgress&&(t.pb_layerProgress.firstMdfValue=!0),t.updateProgress(t.py.riskProgress)})},e.prototype.updateLayerEventInfo=function(e){this.map.updateLayerEvent({events:this.py.curLayerInfo.events}),this.map.updateNPC({curPosVO:this.py.curLayerInfo.curPosVO}),this.map.updateMWInfo({grids:this.py.curLayerInfo.grids})},e.prototype.updateNPCOutLook=function(e){this.map&&this.map.me.updateNPCOutLook()},e.prototype.resetCamera=function(e){this.map.resetCamera()},e.prototype.setMapScale=function(e){this.map.setMapScale(e)},e.prototype.handleTouchTap=function(e){this.py.curLayerInfo.curPosVO.type==RiskNodeType.Risk&&this.py.curLayerInfo.curPosVO.num==e.num?this.map.handleTouchTap(e.tileX,e.tileY):this.log("不在指定冒险地图")},e.prototype.riskFingerAppearToXY=function(e){!e||this.py.curLayerInfo.curPosVO.type==RiskNodeType.Risk&&this.py.curLayerInfo.curPosVO.num==e.num?this.map.riskFingerAppearToXY(e&&e.tileX,e&&e.tileY,e&&e.time):this.log("不在指定冒险地图")},e.prototype.showFingerToXY=function(e){this.py.curLayerInfo&&this.map?!e||this.py.curLayerInfo.curPosVO.type==RiskNodeType.Risk&&this.py.curLayerInfo.curPosVO.num==e.num?this.map.showFingerToXY(e&&e.tileX,e&&e.tileY):Utils.MsgUtils.addMidMsg("不在指定冒险地图"):this.delayShowFingerToXYP=e},e.prototype.hudongWithEP=function(e){this.map.hudongWithEP(e)},e.prototype.showMePathToPos=function(e){this.map.showMePathToPos(e)},e.prototype.onMapInitAllDone=function(){this.delayShowFingerToXYP&&(this.showFingerToXY(this.delayShowFingerToXYP),this.delayShowFingerToXYP=void 0)},e.prototype.onDestroy=function(){this.removeNotice(),this.mineUpdateTimer&&egret.clearTimeout(this.mineUpdateTimer)},e.prototype.updateMainTask=function(){var e=this.taskPy.getCurGuideTask(this.py.localType?TaskType.DifficultyGuide:TaskType.Guide);if(e){this.gp_mainTask.visible=!0;var t=e.config,i=this.taskPy.getTaskStatus(e);JSON.parse(t.target);i==TaskStatus.DONE?this.img_complete.visible=!0:this.img_complete.visible=!1,1==t.progress?i==TaskStatus.DONE?this.lb_progress.text="(1/1)":this.lb_progress.text="(0/1)":this.lb_progress.text=e.key.toString()+"/"+t.progress,this.lb_desc.text=t.name}else this.gp_mainTask.visible=!1},e.prototype.updateProgress=function(e){var r=this;this.pb_layerProgress||(this.pb_layerProgress=new customui.RoundProgressBar,this.pb_layerProgress.antiClockwise=!0,this.pb_layerProgress.needStep=!0,this.pb_layerProgress.skinName="skins.GuajiView_ProgressBarSkin",this.gp_layer_progress.addChildAt(this.pb_layerProgress,0),this.pb_layerProgress.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;this.py.riskProgress.isGot||this.pb_layerProgress.maximum!=this.pb_layerProgress.value?(this.pb_layerProgress.touchChildren=this.pb_layerProgress.touchEnabled=!1,this.gp_progress_details.scaleY=0,this.gp_progress_details.visible=!0,egret.Tween.get(this.gp_progress_details).to({scaleY:1},300).call(function(){e.gp_mask.visible=!0,e.pb_layerProgress.touchChildren=e.pb_layerProgress.touchEnabled=!0})):this.py.GetProgressReward("",function(){e.updateProgress()})},this),this.pb_layerProgress.labelFunction=function(e,t){return Math.floor(100*e/t)+"%"});var t=e&&e.layerId;if(t){this.gp_progress_rewards.removeChildren();var i=d.Config.riskLayer()[t],n=JSON.parse(i.rewards);if(!n.length)return this.gp_layer_progress.visible=!1,this.gp_layer_progress.height=0,this.gp_layer_progress.available=!1,this.gp_exit.visible=!0,void(this.gp_exit.height=this.RIGHT_BOTTOM_BTN_HEIGHT);this.gp_layer_progress.visible=!0,this.gp_layer_progress.height=this.RIGHT_BOTTOM_BTN_HEIGHT,this.gp_layer_progress.available=!0,this.gp_exit.visible=!1,this.gp_exit.height=0,n.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({type:e[0],code:e[1],num:e[2]}),r.gp_progress_rewards.addChild(t)})}if(this.gp_layer_progress.available){var o=this.py.riskProgress,s=((h={})[RiskDataType.Main]="主线任务",h[RiskDataType.Creep]="怪物",h[RiskDataType.Maze]="迷宫",h[RiskDataType.Box]="宝箱",h[RiskDataType.Fortress]="副本",h[RiskDataType.Mine]="矿产",h[RiskDataType.Npc]="特殊事件",h),a=[RiskDataType.Main,RiskDataType.Creep,RiskDataType.Maze,RiskDataType.Box,RiskDataType.Fortress,RiskDataType.Mine];o.datas.sort(function(e,t){return a.indexOf(e.type)-a.indexOf(t.type)});var c=0,l=0;this.gp_progress_items.removeChildren(),o.datas.forEach(function(e){var t=e.progress,i=e.total;i<t&&(t=i);var n=new eui.Group;n.width=225;var o=new eui.Label("·"+s[e.type]);o.textColor=8872248,o.size=20,n.addChild(o);var a=new eui.Label(t+"/"+i);a.textColor=t==i?3769856:8872248,a.size=20,a.right=0,n.addChild(a),r.gp_progress_items.addChild(n),c+=t,l+=i}),this.gp_progress_details.height=this.gp_progress_items.height+186,l||(l=c=1);var h,p=function(e){r.pb_layerProgress.maximum=l,r.pb_layerProgress.value=c,r.pb_layerProgress.step=l/100*2,r.lb_progress_title.textFlow=[{text:"地图探索统计",style:{textColor:8872248}},{text:"（"+Math.floor(100*c/l)+"%）",style:{textColor:c==l?3769856:10878976}}],o.isGot||l!=c?NoticeManager.redp(r.pb_layerProgress,!1):NoticeManager.redp(r.pb_layerProgress,!0,{x:75,y:15})};e&&e.fromPush?DragonBoneTools.create("common_xing",function(t){t.animation.play("common_xing",0);var e=r.map.me,i=Utils.ComponentUtils.getPosInView(e);t.x=i.x+e.width/2,t.y=i.y,r.addChild(t),egret.Tween.get(t).to({y:i.y-120},700,egret.Ease.quadOut).wait(300).call(function(){var e=Utils.ComponentUtils.getPosInView(r.pb_layerProgress);egret.Tween.get(t).to({x:e.x+r.pb_layerProgress.width/2},300,egret.Ease.quadOut),egret.Tween.get(t).to({y:e.y+r.pb_layerProgress.height/2},300,egret.Ease.quadIn).call(function(){t.parent&&t.parent.removeChild(t),p(),DragonBoneTools.playOnce({effectName:"common_tansuodu",parent:r.pb_layerProgress,y:r.pb_layerProgress.height/2-10,z:2})})})}):p()}},e.prototype.goldMineEffect=function(){var s=d.Config.riskMine();if(0<this.py.minesInfo.length){var c=[];this.py.minesInfo.forEach(function(e){for(var t=s[e.id],i=JSON.parse(t.rewards)[0],n=!0,o=0,a=c;o<a.length;o++){var r=a[o];if(r[0]==i[0]){r[2]+=i[2],n=!1;break}}n&&c.push(i)}),this.displayMineEffect(c,0)}},e.prototype.displayMineEffect=function(e,t){var i=this;if(t>=e.length)this.mineUpdateTimer&&(egret.clearTimeout(this.mineUpdateTimer),this.mineUpdateTimer=egret.setTimeout(function(){i.goldMineEffect()},this,1e4));else{var n=e[t];Utils.MsgUtils.addRewardMsg({rewards:[n]},this.gp_jinkuang,{oriY:100,offsetY1:-100,cb:function(){egret.setTimeout(function(){i.displayMineEffect(e,t+1)},i,100)}})}},e.prototype.perShow=function(){return this.map&&this.map.onThisMapSwitch(!0),t.prototype.perShow.call(this)},e.prototype.perClose=function(){return this.map&&this.map.onThisMapSwitch(!1),DragonBoneTools.removeAllNotStageDB(),t.prototype.perClose.call(this)},e.prototype.shouJinbiEffect=function(){for(var e=0;e<3;++e){var t=this["effect_"+e];t&&(t.visible=!1)}DragonBoneTools.playOnce({effectName:"common_airenbaozangkcz_1",parent:this.gp_jinbi_effect,x:this.gp_jinbi_effect.width/2,y:this.gp_jinbi_effect.height/2-30})},e.prototype.jibiduiEffect=function(e){for(var t=3<e?0:10,i={0:{x:120,y:this.gp_jinbi_effect.height/2+t,visible:2<e},1:{x:this.gp_jinbi_effect.width/2,y:this.gp_jinbi_effect.height/2-20,visible:e<=2||4<=e},2:{x:this.gp_jinbi_effect.width-120,y:this.gp_jinbi_effect.height/2+t,visible:2<e}},n=function(t){o["effect_"+t]||MovieClipTools.create("common_jinbishan",function(e){e.x=i[t].x,e.y=i[t].y,e.animation.play("common_jinbishan",-1),this["effect_"+t]=e,this["effect_"+t].visible=i[t].visible,this.gp_jinbi_effect.addChild(this["effect_"+t])},o),o["effect_"+t]&&(o["effect_"+t].visible=i[t].visible)},o=this,a=0;a<3;++a)n(a)},e}(BaseTab);d.GuajiView=e,__reflect(e.prototype,"game.GuajiView")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.skinName="QuickMineEffectSkin",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.displayEffects()},e.prototype.updateView=function(){},e.prototype.displayEffects=function(){var e,t=this;e=function(){egret.setTimeout(function(){DragonBoneTools.playOnce({effectName:"common_airenbaozangkcz_1",parent:t.gp_bling_effect,x:t.gp_bling_effect.width/2,y:t.gp_bling_effect.height/2,doneCB:function(){egret.setTimeout(function(){PopUpManager.removePopUp(t),t.params.doneCB&&t.params.doneCB()},t,200)}}),egret.setTimeout(function(){t.img_title.visible=!1,t.img_bg.visible=!1},t,400)},t,500)},DragonBoneTools.playOnce({effectName:"common_airenbaozangkcz_2",parent:this.gp_airen_effect,x:this.gp_airen_effect.width/2,y:this.gp_airen_effect.height/2,doneCB:e()})},e}(BasePanel);e.QuickMineView=t,__reflect(t.prototype,"game.QuickMineView")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=e.touchChildren=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.width=this.height=0,this.initScan()},e.prototype.showTargetDir=function(e){null!=e?(this.img_targetDir||(this.img_targetDir=new eui.Image,this.img_targetDir.source="_main_m_json.mx_img_jiantou",this.img_targetDir.y=-50,this.img_targetDir.name="targetDir",this.addChild(this.img_targetDir),egret.Tween.get(this.img_targetDir,{loop:!0}).to({alpha:0},1e3).to({alpha:1},1e3)),this.img_targetDir.visible=!0,1==e?this.img_targetDir.scaleX=this.img_targetDir.scaleY=1:0==e?this.img_targetDir.scaleX=this.img_targetDir.scaleY=-1:3==e?(this.img_targetDir.scaleX=-1,this.img_targetDir.scaleY=1):(this.img_targetDir.scaleX=1,this.img_targetDir.scaleY=-1)):this.img_targetDir&&(this.img_targetDir.visible=!1)},e.prototype.initScan=function(){var e=new eui.Image("xinshou_img_zhedang_png");e.touchEnabled=!1,e.scaleX=e.scaleY=10,e.anchorOffsetX=e.anchorOffsetY=500,this.addChild(e)},e.prototype.onMove=function(){this.img_targetDir&&(this.img_targetDir.visible=!1)},e}(eui.Component);e.Camera=t,__reflect(t.prototype,"game.Camera")}(game||(game={})),function(e){var t=function(i){function n(e){var t=i.call(this)||this;return t.ACTION_CHANGE_INTERVAL=7e3,t.creatList=[],t.data=e,t.skinName="HeroDynamicModelSkin",t}return __extends(n,i),Object.defineProperty(n.prototype,"onArmatureLoadCB",{set:function(e){this.creatingArmature?this._onArmatureLoadCB=e:e(this.egretArmDisplay)},enumerable:!0,configurable:!0}),n.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data&&this.update(this.data),this.once(egret.Event.REMOVED_FROM_STAGE,function(){null!=this.actionChangeTimer&&egret.clearTimeout(this.actionChangeTimer),this.hero_soundchannel&&(this.hero_soundchannel.stop(),this.hero_soundchannel=void 0)},this)},n.prototype.update=function(e,i){var n=this;if(this.data==e||this.data&&this.data.code&&this.data.code==e.code){if(e.derma&&this.data.derma==e.derma)return;if(!e.derma&&!this.data.derma)return}if(this.creatingArmature){var t={arrData:e,arrCreateDoneCb:i};this.creatList.push(t)}else{this.creatingArmature=!0,this.data=e,this.isStatic=this.data.isStatic||!1,this.egretArmDisplay&&this.egretArmDisplay.parent&&this.egretArmDisplay.parent.removeChild(this.egretArmDisplay);var o=this.data.model?this.data.model:this.data.derma?this.data.derma.model:void 0;if(!o){var a=this.data.code;if(a)o=(game.Config.allHeroConfig()[a]||game.Config.creepConfig(a)).model}""==o&&(o="hero_018_02"),null!=this.actionChangeTimer&&egret.clearTimeout(this.actionChangeTimer),this.actionChangeTimer=void 0,o?DragonBoneTools.createForHero(o,function(e){if(n.creatingArmature=!1,0<n.creatList.length){var t=n.creatList.shift();n.update(t.arrData,t.arrCreateDoneCb)}else e.animation.play("daiji"),e.x=n.gp_root.width/2,e.y=n.gp_root.height,n.gp_root.addChild(e),n.egretArmDisplay=e,n.isStatic||(n.actionChangeTimer=egret.setTimeout(function(){this.changeAction()},n,n.ACTION_CHANGE_INTERVAL)),i&&i(),n._onArmatureLoadCB&&n.once(egret.Event.ENTER_FRAME,function(){n._onArmatureLoadCB&&n._onArmatureLoadCB(n.egretArmDisplay),n._onArmatureLoadCB=void 0},n)},this,{}):this.creatingArmature=!1,this.isStatic?this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.playVoice,this):this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.playVoice,this)}},n.prototype.changeAction=function(e){try{if(this.egretArmDisplay&&this.egretArmDisplay.animation){var t=e||n.RANDOM_ACTION_LIST,i=t[Math.round(Math.random()*(t.length-1))];this.egretArmDisplay.animation.play(i,1),this.actionChangeTimer&&(egret.clearTimeout(this.actionChangeTimer),this.actionChangeTimer=void 0),this.egretArmDisplay.hasEventListener(dragonBones.EventObject.COMPLETE)||this.egretArmDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this.onActionComplete,this)}}catch(e){egret.warn(e)}},n.prototype.playVoice=function(){var t=this;if(this.hero_soundchannel&&this.hero_soundchannel.stop(),!this.isStatic&&this.data.code){var e=game.Config.allHeroConfig()[this.data.code];if(!e)return;var i=e.voice;if(!i)return;RES.getResAsync(i,function(e){t.hero_soundchannel=Utils.SoundManager.playSound(i)},this)}},n.prototype.onActionComplete=function(){this.egretArmDisplay.hasEventListener(dragonBones.EventObject.COMPLETE)&&this.egretArmDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this.onActionComplete,this),this.egretArmDisplay.animation.play("daiji"),this.isStatic||(this.actionChangeTimer=egret.setTimeout(function(){this.changeAction()},this,this.ACTION_CHANGE_INTERVAL))},n.RANDOM_ACTION_LIST=["gongji","shouji"],n.TOUCH_ACTION_LIST=["gongji"],n}(eui.Component);e.HeroDynamicModel=t,__reflect(t.prototype,"customui.HeroDynamicModel")}(customui||(customui={})),function(e){var t=function(i){function e(){var e=i.call(this)||this;return e.mapObjType=3,e.visible=!1,e}return __extends(e,i),e.prototype.switchVisible=function(e){this.img_finger.x=this.img_finger.y=0,e?(this.visible=!0,egret.Tween.get(this.img_finger,{loop:!0}).to({y:20},500).to({y:0},500)):(this.visible=!1,egret.Tween.removeTweens(this.img_finger))},e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.img_finger=new eui.Image,RES.getResAsync("xinshou_img_shouzhi_png",function(e){t.img_finger.source=e,t.img_finger.anchorOffsetX=20,t.img_finger.anchorOffsetY=39},this),this.gp_foot.addChild(this.img_finger)},e.prototype.tileXYChange=function(){i.prototype.tileXYChange.call(this),this.zorder=1e11},e}(e.Npc);e.Finger=t,__reflect(t.prototype,"game.Finger")}(game||(game={})),function(n){var e=function(i){function e(e){var t=i.call(this)||this;return t.skinName="GuajiCBTDetailPanelSkin",t.params=e,t.py=n.AppFacade.getInstance().retrieveProxy(n.GuajiPy.N),t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.inButton(),this.updateView()},e.prototype.inButton=function(){var e=this;this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.opperationParams=1,e.hide(),e.params.customCB&&e.params.customCB(e.opperationParams)},this)},e.prototype.updateView=function(){var e=void 0;if(this.params.vo){e=n.Config.getRiskMapByCode(this.params.vo.code);var t=this.py.getShowTipsForPosition(this.params.vo.position);this.lb_tips.text=e.desc.format([t]),this.params.vo.entityType==EEntityType.EEntityTypeMap&&(this.params.canGet?this.btn_ok.icon="mx_btn_wabao_png":this.params.showAutoBtn?this.btn_ok.icon="mx_btn_zidongxunlu_png":this.btn_ok.icon="common_btn_queding_png")}else e=this.params.config,this.lb_tips.text=e.desc.format(["？？"]),this.btn_ok.icon="common_btn_queding_png";this.img_icon.source=ResourceUtils.png(e.icon),this.lb_reward_tips.visible=!1},e}(BasePanel);n.GuajiCBTDetailPanel=e,__reflect(e.prototype,"game.GuajiCBTDetailPanel")}(game||(game={})),function(l){var e=function(t){function e(){var e=t.call(this)||this;return e.firstIn=!0,e.skinName="GuajiDemonSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.initList(),this.rootPanel.blb_title.text="宝藏守卫",this.rootPanel.onCloseCB=function(){e.hide()},Utils.ComponentUtils.registerListener(this.btn_guide,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new l.HelpDialog({moduleId:MODULE.Demon})})},this)},e.prototype.initList=function(){this.list_item.itemRenderer=i},e.prototype.updateView=function(e){if(this.firstIn)this.firstIn=!1,l.GameMVC.guajiPy.GetDemonList();else{var t=l.GameMVC.guajiPy.playerDemonInfo.count;this.blb_times.text=t.toString();var i=l.GameMVC.guajiPy.demonList,n=[],o=l.GameMVC.playerPy.playerInfoVO.playerId;for(var a in i){var r=i[a],s=r.baseInfo.playerId==o;if(0!=t||s){var c={info:r,self:s};n.push(c)}}if(n.length){if(n.sort(function(e,t){return e.info.excapeDt-t.info.excapeDt}),this.list_item.dataProvider)this.list_item.dataProvider.replaceAll(n);else this.list_item.dataProvider=new eui.ArrayCollection(n);this.dtRefreshTimer||(this.dtRefreshTimer=egret.setInterval(this.refreshDt,this,1e3))}else this.hide()}},e.prototype.refreshDt=function(){var i=Utils.TimerManager.getServerTime();this.list_item.numChildren&&this.list_item.$children.forEach(function(e){var t=e.data.info.excapeDt-i;0<=t&&(e.blb_time.text=Utils.TimerManager.getFormatBySecond1(t))})},e.prototype.perClose=function(){this.dtRefreshTimer&&(egret.clearInterval(this.dtRefreshTimer),this.dtRefreshTimer=void 0)},e}(BasePanel);l.GuajiDemonPanel=e,__reflect(e.prototype,"game.GuajiDemonPanel");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuajiDemonPanel_DemonItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseItem.addChild(this.baseItem),Utils.ComponentUtils.registerListener(this.btn_challenge,egret.TouchEvent.TOUCH_TAP,function(){l.GameMVC.guajiPy.ChallengeDemon(e.data.info.uuid)},this),this.pb_hp.labelFunction=function(e,t){return(e/t*100).toFixed(0)+"%"}},e.prototype.dataChanged=function(){var i=this,e=this.data.info;this.lb_name.text="发现者："+e.baseInfo.name;var t=e.creeps[0];this.baseItem.updateData({code:t});var n=this.data.self&&e.foundRewards||JSON.parse(e.config.killRewards);this.gp_rewards.removeChildren(),n.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),i.gp_rewards.addChild(t)}),this.pb_hp.maximum=e.totalLife,this.pb_hp.value=e.leftLife,this.blb_time.text=Utils.TimerManager.getFormatBySecond1(e.excapeDt-Utils.TimerManager.getServerTime())},e}(eui.ItemRenderer);__reflect(i.prototype,"GuajiDemonPanel_DemonItem")}(game||(game={})),function(h){var e=function(t){function e(){var e=t.call(this)||this;return e.taskPy=h.AppFacade.getInstance().retrieveProxy(h.TaskPy.N),e.skinName="GuajiMainTaskSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this,t=this.taskPy.getCurGuideTask(0==h.GameMVC.guajiPy.localType?TaskType.Guide:TaskType.DifficultyGuide);this.taskPy.getTaskStatus(t)==TaskStatus.DONE?this.taskPy.GetTaskReward(t.config.type,t.config.code,function(){e.hide()}):this.hide()},this)},e.prototype.updateView=function(e){var i=this,t=this.taskPy.getCurGuideTask(0==h.GameMVC.guajiPy.localType?TaskType.Guide:TaskType.DifficultyGuide),n=t.config,o=this.taskPy.getTaskStatus(t),a=(JSON.parse(n.target),"");a=1==n.progress?o==TaskStatus.DONE?"(1/1)":"(0/1)":t.key.toString()+"/"+n.progress,this.btn_confirm.label=o==TaskStatus.DONE?"领取":"我知道了";var r=new eui.Label;r.size=22,r.width=448,r.textFlow=[{text:"[任务目标]：",style:{textColor:11222333}},{text:n.name,style:{textColor:7096888}},{text:a,style:{textColor:7096888}}],this.gp_desc.addChild(r);var s=new eui.Label;s.size=22,s.width=448,s.textFlow=[{text:"[任务地点]：",style:{textColor:11222333}},{text:n.map,style:{textColor:7096888}}],this.gp_desc.addChild(s);var c=new eui.Label;c.size=22,c.width=448,c.textFlow=[{text:"[任务内容]：",style:{textColor:11222333}},{text:n.desc,style:{textColor:7096888}}],this.gp_desc.addChild(c);var l=JSON.parse(n.rewards);this.gp_reward.removeChildren(),l.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),i.gp_reward.addChild(t)})},e}(BasePanel);h.GuajiMainTaskPanel=e,__reflect(e.prototype,"game.GuajiMainTaskPanel")}(game||(game={})),function(s){var e=function(i){function e(e){var t=i.call(this)||this;return t.isGotReward=!1,t.skinName="GuajiMinesListPanelSkin",t.params=e,t.guajiPy=s.AppFacade.getInstance().retrieveProxy(s.GuajiPy.N),t}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="资产管理",this.CommonDaTanChuKuang.onCloseCB=function(){t.hide()},this.btn_oneKey.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.guajiPy.GetMineRewards({cb:function(){t.updateView(),t.isGotReward=!0}})},this),this.list_root.itemRenderer=n,this.collection=new eui.ArrayCollection,this.list_root.dataProvider=this.collection,this.mineInfo(),this.updateTimer=egret.setInterval(function(){t.mineInfo()},this,3e4)},e.prototype.mineInfo=function(){var e=this;this.guajiPy.GetMineInfo({cb:function(){e.updateView()},ispush:!0})},e.prototype.updateView=function(e){var o=this;if(e&&e.mines)e.mines.forEach(function(e){var t=o.list_root.$children;for(var i in t){var n=t[i];if(n.data.id==e.id){n.updateReward(e);break}}});else{var n=s.Config.riskMine();this.collection.removeAll();var a=0,r={};for(var t in this.guajiPy.minesInfo.forEach(function(e){var t=n[e.id],i=JSON.parse(t.rewards)[0];r[t.type]||(r[t.type]={id:e.id,totalRewards:0,name:t.name,icon:s.GeneralConfig.getGuajiImg(t.icon)[1],type:t.type,interval:1*t.interval,resC:s.GeneralConfig.getEntityConfigByCode(i[0],i[1]),speedRewards:0,count:0,upLimit:t.upLimit,reward:[i]}),r[t.type].count+=1,r[t.type].speedRewards+=i[2],e.rewards[0]&&(a+=e.rewards[0].num,r[t.type].totalRewards+=e.rewards[0].num)}),r)this.collection.addItem(r[t]);this.gp_empty.visible=0==this.collection.length;var i=0!=this.collection.length&&0==a;this.isGotReward=i,this.btn_oneKey.touchEnabled=!i,UIActionManager.setGrey(this.btn_oneKey,i),this.collection.refresh()}},e.prototype.perClose=function(){this.isGotReward&&s.AppFacade.getInstance().sendNotification(CN.GUAJI_UPDATE_MINE,{isGot:this.isGotReward}),this.updateTimer&&egret.clearInterval(this.updateTimer)},e}(BasePanel);s.GuajiMinesListPanel=e,__reflect(e.prototype,"game.GuajiMinesListPanel");var n=function(t){function e(){var e=t.call(this)||this;return e.actProxy=s.AppFacade.getInstance().retrieveProxy(s.ActivityPy.N),e.skinName="GuajiMinesListItemRenderSkin",e.guajiPy=s.AppFacade.getInstance().retrieveProxy(s.GuajiPy.N),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){e.timer&&egret.clearInterval(e.timer)},e),e}return __extends(e,t),e.prototype.childrenCreated=function(){},e.prototype.dataChanged=function(){this.img_icon.source=this.data.icon,this.lb_name.text=this.data.name,this.lb_count.text="拥有:"+this.data.count;this.img_res.source=this.img_res2.source=ResourceUtils.png(this.data.resC.icon),-1!=[RiskMineType.Artifact,RiskMineType.Equip].indexOf(this.data.type)?this.lb_speed.text="概率产出":this.lb_speed.text="+"+this.data.speedRewards+"/"+this.data.interval+"秒";var e,t=this.actProxy.allActivityData[EActivityType.WholeLifeCard];e=t&&t.data&&t.data.hasPurchased?Utils.MathUtils.formatNumStyle1(this.data.upLimit/this.data.interval*this.data.speedRewards*1.5):Utils.MathUtils.formatNumStyle1(this.data.upLimit/this.data.interval*this.data.speedRewards),this.lb_total.text=Utils.MathUtils.formatNumStyle1(this.data.totalRewards+0)+"/"+e},e.prototype.updateReward=function(e){var t,i=this.actProxy.allActivityData[EActivityType.WholeLifeCard];t=i&&i.data&&i.data.hasPurchased?Utils.MathUtils.formatNumStyle1(this.data.upLimit/this.data.interval*this.data.speedRewards*1.5):Utils.MathUtils.formatNumStyle1(this.data.upLimit/this.data.interval*this.data.speedRewards),Utils.MsgUtils.addRewardMsg({rewards:e.rewards},this,{oriY:200,offsetY1:-100,offsetY2:-100}),this.data.totalRewards+=e.rewards[0].num,this.lb_total.text=Utils.MathUtils.formatNumStyle1(this.data.totalRewards)+"/"+t},e}(eui.ItemRenderer);__reflect(n.prototype,"GuajiMinesListItemRender")}(game||(game={})),function(o){var e=function(i){function e(e){var t=i.call(this)||this;return t.guajiPy=o.AppFacade.getInstance().retrieveProxy(o.GuajiPy.N),t.tileIndex2MNM={},t.tileIndex2MNMEP={},t.skinName="GuajiMiniMapPanelSkin",t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.lb_mapName.text="地 图",this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_map.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide();var t=o.AppFacade.getInstance().retrieveProxy(o.GuajiPy.N);t.GetLayerNum(function(){PopUpManager.addPopUp({obj:new o.GuajiGateListPanel({type:t.localType}),closeCB:function(e){e&&t.MiniTriggerEvent(Number(e))}})})},this),this.gp_tile=new eui.Group,this.gp_tile.horizontalCenter=this.gp_tile.verticalCenter=0,this.gp_tile.scaleX=this.gp_tile.scaleY=1.2,this.gp_adapter=new eui.Group,this.gp_adapter.addChild(this.gp_tile),this.gp_viewport.addChild(this.gp_adapter)},e.prototype.updateView=function(e){var n=this;e&&(this.mwArr=e.mwArr,this.tileX=e.tileX,this.tileY=e.tileY);var t=o.Config.riskLayer()[this.guajiPy.curLayerInfo.curPosVO.layerId];this.lb_mapName.text=o.Config.risk()[this.guajiPy.curLayerInfo.curPosVO.layerId]&&o.Config.risk()[this.guajiPy.curLayerInfo.curPosVO.layerId].name,this.w=t.long,this.h=t.wide,RES.getResAsync(t.tiled,function(e){try{e.layers.forEach(function(e){"tiled"==e.name?n.tmxTiledArr=e.data:"hinder"==e.name&&(n.tmxHinderArr=e.data)}),n.tilesets={},e.tilesets.forEach(function(i){i.tiles.forEach(function(t){t.properties.forEach(function(e){n.tilesets[t.id+i.firstgid]||(n.tilesets[t.id+i.firstgid]={}),n.tilesets[t.id+i.firstgid][e.name]=e.value})})})}catch(e){return void egret.warn("地形解析失败",e)}n.initAll()},this)},e.prototype.getTileIndex=function(e,t){return e+t*this.w},e.prototype.tile2MNMPos=function(e,t){return this.jiZhunMNMP||(this.jiZhunMNMP=egret.Point.create(0,this.scl_map.height/2)),egret.Point.create(this.jiZhunMNMP.x+67*(e+(this.h-1)-t)/2,this.jiZhunMNMP.y+37*(e+t-(this.h-1))/2)},e.prototype.initAll=function(){var c=this;this.gp_tile.removeChildren();var l=void 0,h=void 0,p=void 0,d=void 0,u=new egret.Shape;u.graphics.lineStyle(3,0);for(var e=function(s){for(var e=function(a){var e=g.getTileIndex(s,a),t=g.tmxTiledArr[e];if(null==t)return egret.warn("地图尺寸"+g.w+"x"+g.h+"超过地形尺寸，请检查配置"),"break";if(0!=t&&0!=g.mwArr[e]){var i=g.tmxHinderArr[e],n=new eui.Image("_guaji_m_json.mx_img_sekuai"+(0==i?2:1)),o=g.tile2MNMPos(s,a);n.x=o.x,n.y=o.y,(null==l||o.x<l)&&(l=o.x),(null==h||o.x>h)&&(h=o.x),(null==p||o.y<p)&&(p=o.y),(null==d||o.y>d)&&(d=o.y),g.tileIndex2MNM[e]=n,g.gp_tile.addChild(n),egret.Point.release(o);var r=[[[32.5,0],[0,-1]],[[65,17.5],[1,0]],[[32.5,35],[0,1]],[[0,17.5],[-1,0]]];r.forEach(function(e){e[0][0]+=o.x,e[0][1]+=o.y}),r.forEach(function(e,t){var i=[s+e[1][0],a+e[1][1]];if(i[0]<0||i[1]<0||i[0]>c.w-1||i[1]>c.h-1||!c.tmxTiledArr[c.getTileIndex(i[0],i[1])]){var n=e[0],o=(r[t+1]||r[0])[0];u.graphics.moveTo(n[0],n[1]),u.graphics.lineTo(o[0],o[1])}})}},t=0;t<g.h;t++){if("break"===e(t))break}},g=this,t=0;t<this.w;t++)e(t);for(var i in u.graphics.endFill(),this.tileIndex2MNM){var n=this.tileIndex2MNM[i];n.x-=l,n.y-=p}u.x-=l,u.y-=p,this.gp_tile.addChild(u),this.guajiPy.curLayerInfo.events.forEach(function(e){var t=c.getTileIndex(e.position.x,e.position.y);if(c.tileIndex2MNM[t]){var i=new eui.Image;i.scaleX=i.scaleY=1.4,RES.getResAsync(MAP_EP_TYPE_IMG_MNM[e.type],function(e){i.source=e,i.anchorOffsetX=e.textureWidth/2,i.anchorOffsetY=e.textureHeight},c),i.x=c.tileIndex2MNM[t].x+32.5,i.y=c.tileIndex2MNM[t].y+17.5,c.tileIndex2MNMEP[t]=i,c.gp_tile.addChild(i)}}),this.updateMW(),this.img_meRedPointInMNM=new eui.Image,this.img_meRedPointInMNM.scaleX=this.img_meRedPointInMNM.scaleY=1.4,RES.getResAsync("_guaji_m_json.maoxian_icon_ziji",function(e){c.img_meRedPointInMNM.source=e,c.img_meRedPointInMNM.anchorOffsetX=e.textureWidth/2,c.img_meRedPointInMNM.anchorOffsetY=e.textureHeight},this),this.gp_tile.addChildAt(this.img_meRedPointInMNM,-1);var o=this.getTileIndex(this.tileX,this.tileY);this.tileIndex2MNM[o]&&(this.img_meRedPointInMNM.x=this.tileIndex2MNM[o].x+32.5,this.img_meRedPointInMNM.y=this.tileIndex2MNM[o].y+17.5),this.scl_map.alpha=0,egret.setTimeout(function(){c.resizeAdapter(),c.resetMNM(0),egret.Tween.get(c.scl_map).to({alpha:1},200)},this,100)},e.prototype.resizeAdapter=function(){this.gp_tile.height*this.gp_tile.scaleY<this.scl_map.height&&(this.gp_adapter.height=this.scl_map.height+1),this.gp_tile.width*this.gp_tile.scaleX<this.scl_map.width&&(this.gp_adapter.width=this.scl_map.width+1),this.gp_adapter.validateNow()},e.prototype.resetMNM=function(e){if(void 0===e&&(e=250),this.img_meRedPointInMNM){var t=this.img_meRedPointInMNM.localToGlobal(this.img_meRedPointInMNM.anchorOffsetX,this.img_meRedPointInMNM.anchorOffsetY),i=this.scl_map.viewport.globalToLocal(t.x,t.y);egret.Tween.get(this.scl_map.viewport).to({scrollH:i.x-this.scl_map.viewport.width/2,scrollV:i.y-this.scl_map.viewport.height/2},e)}},e.prototype.updateMW=function(){},e}(BasePanel);o.GuajiMiniMapPanel=e,__reflect(e.prototype,"game.GuajiMiniMapPanel")}(game||(game={})),function(o){var e=function(t){function e(){var e=t.call(this)||this;return e.pos2Item={},e.skinName="GuajiMultiPanelSkin",e.py=o.GameMVC.guajiPy,e}return __extends(e,t),e.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),this.pos2Item[1]=this.cu_item1,this.pos2Item[2]=this.cu_item2,this.pos2Item[3]=this.cu_item3,this.pos2Item[4]=this.cu_item4,this.pos2Item[5]=this.cu_item5,this.py.riskMultiConstV||(this.py.riskMultiConstV=JSON.parse(o.Config.constConfig().riskMultiConfig.constValue)),this.rootPanel.blb_title.text="组队挂机",this.rootPanel.onCloseCB=function(){i.hide()},Utils.ComponentUtils.registerListener(this.btn_guide,egret.TouchEvent.TOUCH_TAP,function(){var e=HELP_CONST[MODULE.RiskMulti].content,t=o.Config.unlockConfig()[MODULE.RiskMulti];e=t?e.format([JSON.parse(t.condition)[1],Math.floor(i.py.riskMultiConstV[1]/60/60)]):e.format(["1",Math.floor(i.py.riskMultiConstV[1]/60/60)]),PopUpManager.addPopUp({obj:new o.HelpDialog({text:e})})},this),this.dtRefreshTimer||(this.dtRefreshTimer=egret.setInterval(this.refreshDt,this,1e3)),this.py.RiskMultiCommand("GetRoomInfo")},e.prototype.updateView=function(e){this.updateRoomInfo(),this.updatePlayers()},e.prototype.updatePlayers=function(){var t=this,i={},n=!1;for(var e in this.py.riskMultiRoomInfo.members.forEach(function(e){i[e.pos]=!0,t.pos2Item[e.pos].updateForPlayer(e),e.baseInfo.playerId==o.GameMVC.playerPy.playerInfoVO.playerId&&(n=!0)}),this.pos2Item)i[e]||this.pos2Item[e].reset();0<this.py.riskMultiRoomInfo.members.length&&!n&&(Utils.MsgUtils.addMidMsg("你已不在房间了"),this.hide())},e.prototype.updateRoomInfo=function(){1<this.py.riskMultiRoomInfo.members.length?this.blb_total.text=Math.floor(this.py.riskMultiRoomInfo.gain/10)+"%":this.blb_total.text="0%"},e.prototype.refreshDt=function(){for(var e in this.pos2Item)this.pos2Item[e].updateTime()},e.prototype.perClose=function(){this.dtRefreshTimer&&(egret.clearInterval(this.dtRefreshTimer),this.dtRefreshTimer=void 0)},e}(BasePanel);o.GuajiMultiPanel=e,__reflect(e.prototype,"game.GuajiMultiPanel")}(game||(game={})),function(e){var t=function(i){function e(){var e=i.call(this)||this;return e.py=game.GameMVC.guajiPy,e.skinName="GuajiMultiPanel_Item",e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_yaoqing,egret.TouchEvent.TOUCH_TAP,function(){if(t.py.riskMultiRoomInfo.amIOwner()){var n=game.AppFacade.getInstance().retrieveProxy(game.FriendPy.N),o=game.Config.broadcastConfig()[49].content,e=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N),a=[[2,e.playerInfoVO.name,e.playerInfoVO.playerId,EEntityType.EEntityTypePlayer],[1,"<<点击加入",t.py.riskMultiRoomInfo.id,MODULE.RiskMulti]];n.getFriendList(function(){var t=game.GameMVC.playerPy.playerInfoVO.level;PopUpManager.addPopUp({obj:new game.InviteFriendView({moduleId:MODULE.RiskMulti,filter:function(e){if(e.level<t)return!0},tabbarType:11,inviteCallback:function(e,t){var i=game.AppFacade.getInstance().retrieveProxy(game.MainPy.N);i.addPrivatePlayer(e),i.SendMessage(EChatChannelType.EChatChannelTypePrivate,o,e,function(){n.addInviteHistory(MODULE.RiskMulti,e),t&&t()},EChatSendCheckType.None,JSON.stringify(a),!0)}})})})}else Utils.MsgUtils.addMidMsg("房主才能发起邀请")},this),Utils.ComponentUtils.registerListener(this.btn_tuichu,egret.TouchEvent.TOUCH_TAP,function(){game.GameMVC.guajiPy.RiskMultiCommand("QuitRoom",void 0,function(){game.AppFacade.getInstance().hideSubView(game.GuajiMediator.N,game.GuajiMediator.SV.MULTI)})},this),this.cu_ph.updateData()},e.prototype.updateTime=function(){if(this.player&&this.player.baseInfo.playerId!=this.py.riskMultiRoomInfo.ownerId){var e=this.py.riskMultiConstV[1]+this.player.dt-Utils.TimerManager.getServerTime();this.blb_countDown.text=0<e?Utils.TimerManager.getFormatBySecond1(e):""}},e.prototype.updateForPlayer=function(e){this.player=e,this.lb_name.text=e.baseInfo.name,this.cu_ph.updateData({vo:e.baseInfo}),this.btn_yaoqing.visible=!1,this.btn_tuichu.visible=!1;var t=this.py.riskMultiRoomInfo.ownerId==this.player.baseInfo.playerId,i=this.player.baseInfo.playerId==game.GameMVC.playerPy.playerInfoVO.playerId;t?this.gp_bottom.visible=!1:(this.gp_bottom.visible=!0,i&&(this.btn_tuichu.visible=!0))},e.prototype.reset=function(){this.cu_ph.updateData(),this.lb_name.text="",this.gp_bottom.visible=!1,this.btn_yaoqing.visible=!0,this.btn_tuichu.visible=!1},e}(eui.Component);e.GuajiMultiPanel_Item=t,__reflect(t.prototype,"customui.GuajiMultiPanel_Item")}(customui||(customui={})),function(e){var t=function(i){function e(){var e=i.call(this)||this;return e.mapObjType=3,e.visible=!1,e}return __extends(e,i),e.prototype.switchVisible=function(e){this.img.x=this.img.y=0,e?(this.visible=!0,egret.Tween.get(this.img,{loop:!0}).to({y:20},500).to({y:0},500)):(this.visible=!1,egret.Tween.removeTweens(this.img))},e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.img=new eui.Image,RES.getResAsync("xinshou_img_shouzhi_png",function(e){t.img.source=e,t.img.anchorOffsetX=20,t.img.anchorOffsetY=39},this),this.gp_foot.addChild(this.img)},e.prototype.tileXYChange=function(){i.prototype.tileXYChange.call(this),this.zorder=1e11},e}(e.Npc);e.Guide=t,__reflect(t.prototype,"game.Guide")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="LackExpView",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn1.labelDisplay.size=23,this.btn2.labelDisplay.size=23,this.btn3.labelDisplay.size=23,this.btn1.labelDisplay.horizontalCenter=10,this.btn2.labelDisplay.horizontalCenter=10,this.btn3.labelDisplay.horizontalCenter=10,this.btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.MainJumpConfig.jumpTo(MODULE.Champion)&&(e.opperationParams=1,e.hide())},this),this.btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.MainJumpConfig.jumpTo("GUAJI"),e.opperationParams=1,e.hide(),i.AppFacade.getInstance().retrieveProxy(i.GuajiPy.N).handleQuickBattle()},this),this.btn3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.MainJumpConfig.jumpTo("GUAJI"),e.opperationParams=1,e.hide()},this),this.heroModel.update({isStatic:!0,code:41050009})},e}(BasePanel);i.LackExpView=e,__reflect(e.prototype,"game.LackExpView")}(game||(game={})),function(t){var e=function(n){function e(e,t){var i=n.call(this,e,MODULE.Manor)||this;return i.baseInfo=t,i.entityIndex=void 0,i.isOccupyManor=!1,i}return __extends(e,n),e.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.gp_foot.touchEnabled=!1,this.manorBi=t.ManorBaseHeadFactory.create(),this.manorBi.scaleX=this.manorBi.scaleY=.7,this.manorBi.touchEnabled=!1,this.manorBi.horizontalCenter=0,this.manorBi.bottom=40,this.gp_foot.addChild(this.manorBi),this.img_arrow=new eui.Image("_guaji_m_json.maoxian_img_biaoji"),this.img_arrow.horizontalCenter=0,this.img_arrow.bottom=0,this.gp_foot.addChild(this.img_arrow),this.lb_name=new eui.Label,this.lb_name.bottom=120,this.lb_name.horizontalCenter=0,this.lb_name.textAlign="center",this.lb_name.textColor=16777215,this.lb_name.size=16,this.gp_foot.addChild(this.lb_name),this.lb_name.text="S"+this.baseInfo.serverId+"."+this.baseInfo.name,this.switchFocus()},e.prototype.updateBaseItem=function(e){this.manorBi&&(e.code?this.manorBi.updateData(e):this.manorBi.decorateIcon(ResourceUtils.png(e.avatar)))},e.prototype.onWalking=function(){var e=this;n.prototype.onWalking.call(this),this.isMoving=!0;var t=this.map.tile2Pos(this.tileX,this.tileY);egret.Tween.get(this).to({x:t.x,y:t.y},this.map.npcMovingDura).call(function(){e.isMoving=!1,e.onAfterWalk()}),this.updateVisible(this.tileX,this.tileY)},e.prototype.updateVisible=function(e,t){void 0===e&&(e=this.tileX),void 0===t&&(t=this.tileY);var i=this.map.getTileIndex(this.tileX,this.tileY),n=this.map.mwArr[i];n&&(0==n||4==n?this.visible&&(this.visible=!1):2!=n&&3!=n||!this.visible&&!this.isOccupyManor&&(this.visible=!0))},e}(t.PlayerNpc);t.ManorPlayer=e,__reflect(e.prototype,"game.ManorPlayer")}(game||(game={})),function(_){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.generateCommon=function(e){var t=new i;return t.source=e.source,t.bindAndAddChild(e.me||new _.Me(t,!1,e.source),e.multiLayerScroller,e.miniMapParent,e.camera),t.onTouchTap=e.onTouchTap,t.onRequestToMove=e.onRequestToMove,t.npcMovingDura=e.npcMovingDura||250,t},t}(BaseClass);_.MapUtils=e,__reflect(e.prototype,"game.MapUtils");var i=function(t){function e(){var e=t.call(this)||this;return e.radiusScanOutside=10,e.tileIndex2EP={},e.tileIndex2MBN={},e.tileIndex2MNM={},e.tileIndex2MNMEP={},e.playerOrTeamId2NPC={},e.otherPlayers={},e.stormWarPlayers={},e.walkStep=0,e.curValidTouchPosXY=[],e.mwArr=new Array,e.needSortChildrenArr=new Array,e.fu_mgr=FrameUpdateMgr.getInstance(),e.once(egret.Event.REMOVED_FROM_STAGE,function(){GameRootLayer.gameLayer().switchCloudLoading(!1),e.removeEventListener(egret.Event.ENTER_FRAME,e.enterFrame,e)},e),e.addEventListener(egret.Event.ENTER_FRAME,e.enterFrame,e),e}return __extends(e,t),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.winWidth=Utils.DeviceUtils.curWidth(),this.winHeight=Utils.DeviceUtils.curHeight(),this.scaleX=this.scaleY=1,Utils.DebugUtils.isDebug&&((window._map=this).name="_map"),this.gp_tile=new eui.Group,this.gp_ep=new eui.Group,this.gp_ep.touchEnabled=!1,this.gp_ep.touchChildren=!0,this.gp_touchTile=new eui.Group,this.addChild(this.gp_tile),this.addChild(this.gp_touchTile),this.addChild(this.gp_ep),this.img_youBiao=new eui.Image,this.img_youBiao.source="_guaji_m_json.maoxian_img_biaoji",this.img_youBiao.anchorOffsetX=17.5,this.img_youBiao.anchorOffsetY=38,this.img_youBiao.touchEnabled=!1,this.img_youBiao.alpha=0,this.addChild(this.img_youBiao)},e.prototype.bindAndAddChild=function(e,t,i,n){var o=this;this.gp_ep?(this.me=e,this.me.mapObjType=1,this.cu_mls=t,this.gp_miniMap=i,this.gp_miniMap&&(this.gp_miniMap.scaleX=this.gp_miniMap.scaleY=.8),this.cu_mls.scrollPolicyV=this.cu_mls.scrollPolicyH=eui.ScrollPolicy.OFF,this.camera=n,this.gp_ep.addChild(this.me),this.finger=new _.Finger,this.guide=new _.Guide,this.gp_ep.addChild(this.finger),this.gp_ep.addChild(this.guide),this.reset()):this.once(eui.UIEvent.CREATION_COMPLETE,function(){o.bindAndAddChild(e,t,i,n)},this)},e.prototype.scrollByOffset=function(e,t){egret.Tween.get(this.cu_mls.viewport).to({scrollH:this.cu_mls.viewport.scrollH+e,scrollV:this.cu_mls.viewport.scrollV+t},this.npcMovingDura)},e.prototype.getTileIndex=function(e,t){return e+t*this.w||1},e.prototype.onMeWalkTo=function(e,t){if(this.walkStep+=1,2<=this.walkStep&&(this.walkStep=0,Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_jiaobu)),!Utils.SDKMgr.getPerformConfig(6)){var i=this.tileIndex2MBN[this.getTileIndex(e,t)];if(i){var n=this.tile2Pos(e,t,!0);i.y=n.y,egret.Tween.get(i).to({y:n.y+30},this.npcMovingDura).to({y:n.y},this.npcMovingDura,egret.Ease.backOut),egret.Point.release(n)}}this.curMeOnTargetPos&&this.curMeOnTargetPos.tileX==e&&this.curMeOnTargetPos.tileY==t&&(console.log("已经走到了目标点"),this.curMeOnTargetPos=void 0,this.checkCurMeTarget()),this.newEnterTile(e,t),this.updateMNMMePos(),this.source==MODULE.Risk&&_.AppFacade.getInstance().sendNotification(CN.GUAJI_ON_ME_WALK_TO,{tileX:e,tileY:t})},e.prototype.quickSort=function(e,t){var i,n,o,a;if(i=n=o=0,!(t<e)){for(a=this.needSortChildrenArr[e].zorder||1,i=e,n=t;i!=n;){for(;this.needSortChildrenArr[n].zorder>=a&&i<n;)n--;for(;this.needSortChildrenArr[i].zorder<=a&&i<n;)i++;i<n&&(this.gp_ep.swapChildren(this.needSortChildrenArr[i],this.needSortChildrenArr[n]),o=this.needSortChildrenArr[i],this.needSortChildrenArr[i]=this.needSortChildrenArr[n],this.needSortChildrenArr[n]=o)}this.gp_ep.swapChildren(this.needSortChildrenArr[e],this.needSortChildrenArr[i]),o=this.needSortChildrenArr[e],this.needSortChildrenArr[e]=this.needSortChildrenArr[i],this.needSortChildrenArr[i]=o,this.quickSort(e,i-1),this.quickSort(i+1,t)}},e.prototype.enterFrame=function(){this.isZOrderDirty&&(this.isZOrderDirty=!1,this.calAllZOrder())},e.prototype.reqCalAllZOrder=function(){this.isZOrderDirty=!0},e.prototype.calAllZOrder=function(){this.needSortChildrenArr.splice(0);for(var e=0,t=this.gp_ep.$children;e<t.length;e++){var i=t[e];this.needSortChildrenArr.push(i)}this.quickSort(0,this.needSortChildrenArr.length-1)},e.prototype.reset=function(){this.gp_touchTile&&(this.gp_touchTile.touchChildren=!1),this.isInitedGraph=!1,this.mwArr.splice(0),this.isInited=!1,this.me&&(this.me.reset(),this.switchVisible(this.me,!1)),this.switchVisible(this.camera,!1)},e.prototype.update=function(e,t){var n=this;if(void 0===t&&(t=!1),this.log("Map update"),e.w&&e.h||egret.warn("需提供宽高"),e.isInit){if(this.reset(),!t&&!GameRootLayer.gameLayer().isMenShow&&!_.GameMVC.guajiPy.firstEnterMapAfterLogin)return void GameRootLayer.gameLayer().switchCloudLoading(!0,function(){n.update(e,!0)});this.source==MODULE.Risk&&(_.GameMVC.guajiPy.firstEnterMapAfterLogin=!1),this.w=e.w,this.h=e.h,this.source==MODULE.Risk&&(this.layerId=e.layerId),this.tileW=e.tileW||139,this.tileH=e.tileH||70,this.radius=e.radius||5,this.me.resetTileXY(),this.me.setTilePos(e.meStartTileX||0,e.meStartTileY||0),this.source==MODULE.StormWar&&this.delatupdateNPCP&&this.delatupdateNPCP.curPosVO&&e&&e.meStartTileX&&e.meStartTileY&&(this.delatupdateNPCP.curPosVO.x=e.meStartTileX,this.delatupdateNPCP.curPosVO.y=e.meStartTileY);for(var i=0;i<this.w*this.h;i++)this.mwArr.push(void 0);if(this.tiled=e.tiled,this.theme=_.Config.riskLayerTheme()[e.theme],this.theme.deep=JSON.parse(this.theme.deep),this.theme.hinder=JSON.parse(this.theme.hinder),this.source==MODULE.Risk){var o=_.AppFacade.getInstance().retrieveProxy(_.GuajiPy.N);o.curLayerTheme.bg=ResourceUtils.png(this.theme.battleBg),o.curLayerTheme.bgm=this.theme.bgm}RES.getResAsync(e.tiled,function(e){try{e.layers.forEach(function(e){"tiled"==e.name?n.tmxTiledArr=e.data:"hinder"==e.name&&(n.tmxHinderArr=e.data)}),n.tilesets={},e.tilesets.forEach(function(i){i.tiles.forEach(function(t){t.properties.forEach(function(e){n.tilesets[t.id+i.firstgid]||(n.tilesets[t.id+i.firstgid]={}),n.tilesets[t.id+i.firstgid][e.name]=e.value})})}),n.isInited=!0}catch(e){return void egret.warn("地形解析失败",e)}n.initAll()},this)}},e.prototype.resetMNM=function(e,t){if(this.img_meRedPointInMNM&&this.gp_miniMap){var i=this.gp_miniMap.parent,n=(t&&t.x||this.img_meRedPointInMNM.x)-i.viewport.width/2,o=(t&&t.y||this.img_meRedPointInMNM.y)-i.viewport.height/2;egret.Tween.get(i.viewport).to({scrollH:n,scrollV:o},e||this.npcMovingDura)}},e.prototype.updateNPCOutLook=function(e){this.me&&this.me.updateNPCOutLook()},e.prototype.resetCamera=function(e){this.me.switchFocus(!0),this.cu_mls.stopAnimation(),egret.Tween.removeTweens(this);var t=this.me.parent.localToGlobal(this.me.x,this.me.y-35),i=this.cu_mls.viewport.globalToLocal(t.x,t.y);egret.Tween.get(this.cu_mls.viewport).to({scrollH:i.x-this.cu_mls.viewport.width/2,scrollV:i.y-this.cu_mls.viewport.height/2},50,egret.Ease.sineOut).call(function(){e&&e()}),this.resetMNM(50)},e.prototype.setMapScale=function(e){1.8<=this.scaleX+e&&(e=1.8-this.scaleX),this.scaleX+e<=.2&&(e=.2-this.scaleX),this.scaleX+=e,this.scaleY+=e},e.prototype.checkPosValid=function(e,t){if(this.isInited&&this.tmxTiledArr[this.getTileIndex(e,t)])return!0},e.prototype.getRandomValidPoint=function(e){if(void 0===e&&(e=!1),this.isInited){if(10<=this.randomCount)return egret.warn("当前地形找不到有效的随机点"),[];e?this.randomCount++:this.randomCount=0;var t=this.gp_tile.$children[Utils.MathUtils.getRandomInt(0,this.gp_tile.$children.length-1)],i=this.getTileIndex(t.tileX,t.tileY),n=this.tmxTiledArr[i],o=this.tmxHinderArr[i];return n&&!o?[t.tileX,t.tileY]:this.getRandomValidPoint(!0)}return[]},e.prototype.tile2Pos=function(e,t,i){return void 0===i&&(i=!1),this.jiZhunP||(this.jiZhunP=egret.Point.create(139,70*(this.w+this.h)/2/2+this.cu_mls.height/4)),i?egret.Point.create(this.jiZhunP.x+139*(e+(this.h-1)-t)/2,this.jiZhunP.y+70*(e+t-(this.h-1))/2):egret.Point.create(this.jiZhunP.x+139*(e+(this.h-1)-t)/2,this.jiZhunP.y+70*(e+t-(this.h-1))/2+this.getOffsetYForDeep(this.tile2Deep(e,t)))},e.prototype.pos2Tile=function(e,t){return{tileX:(e-this.cu_mls.width-278)/139*2,tileY:0}},e.prototype.tile2MNMPos=function(e,t){return this.jiZhunMNMP||(this.jiZhunMNMP=egret.Point.create(0,37*(this.w+this.h)/2/2)),egret.Point.create(this.jiZhunMNMP.x+67*(e+(this.h-1)-t)/2,this.jiZhunMNMP.y+37*(e+t-(this.h-1))/2)},e.prototype.tile2Deep=function(e,t){if(this.isInited){var i=this.tmxTiledArr[this.getTileIndex(e,t)];return i?this.tilesets[i].deep:(egret.warn("当前地形不含这个点("+e+","+t+")，请检查配置"),0)}return 0},e.prototype.tile2DeepTheme=function(e,t){if(this.isInited){var i=this.tmxTiledArr[this.getTileIndex(e,t)];return i?this.tilesets[i].theme||0:(egret.warn("当前地形不含这个点("+e+","+t+")，请检查配置"),0)}return 0},e.prototype.tile2EP=function(e,t){return this.tileIndex2EP[this.getTileIndex(e,t)]},e.prototype.getEpByEventId=function(e){for(var t in this.tileIndex2EP){var i=this.tileIndex2EP[t];if(i.vo.eventId==e)return i}},e.prototype.getEpByType=function(e){for(var t in this.tileIndex2EP){var i=this.tileIndex2EP[t];if(i.vo.type==e)return i}},e.prototype.getOffsetYForDeep=function(e){return-8*e},e.prototype.dumpMWData=function(){var i=this,n="";this.mwArr.forEach(function(e,t){null==e?n+="· ":n=n+e+" ",(t+1)%i.w==0&&(console.log(n.substring(0,n.length-1)),n="")})},e.prototype.updateNPC=function(e){var t=this;this.isInited?(e.curPosVO&&(e.curPosVO.hide?this.me.hasEnterMap||this.fu_mgr.insert({delayFrame:30,waitFrame:0,cb:function(){t.stage&&(t.me.hasEnterMap=!0,t.me.visible=!1,t.resetCamera(function(){t.checkAllLoadDone(),GameRootLayer.gameLayer().switchCloudLoading(!1,function(){t.switchVisible(t.camera,!0)})}))},params:void 0}):(this.checkPosValid(e.curPosVO.x,e.curPosVO.y)&&this.me.setTilePos(e.curPosVO.x,e.curPosVO.y,e.curPosVO.isFixed),this.updateMNMMePos(),this.me.hasEnterMap||this.fu_mgr.insert({delayFrame:30,waitFrame:0,cb:function(){t.stage&&(t.me.hasEnterMap=!0,t.me.isOccpuyManor||(t.me.visible=!0),t.resetCamera(function(){t.checkAllLoadDone(),GameRootLayer.gameLayer().isMenShow?t.switchVisible(t.camera,!0):GameRootLayer.gameLayer().switchCloudLoading(!1,function(){t.switchVisible(t.camera,!0),null!=t.preTileX&&null!=t.preTileY&&(t.handleTouchTap(t.preTileX,t.preTileY),t.preTileX=t.preTileY=void 0)})}))},params:void 0}))),null!=e.followers&&this.fu_mgr.insert({delayFrame:60,waitFrame:0,cb:function(){t.stage&&t.me.setFollowers(e.followers)},params:void 0}),null!=e.otherCoordInfos&&this.fu_mgr.insert({delayFrame:60,waitFrame:0,cb:function(){t.stage&&t.handleOtherNpc(e.otherCoordInfos)},params:void 0})):this.delatupdateNPCP=e},e.prototype.updateLayerEvent=function(e){var c=this;if(this.isInited){if(Array.isArray(e.events)){for(var t in this.log("risk当前层有效事件数："+e.events.length),this.tileIndex2EP)this.tileIndex2EP[t].vo.type!=RiskEventType.Hinder&&(this.tileIndex2EP[t].vo.isExpire=!0);var l=0,h=0;e.events.forEach(function(e){var t=c.getTileIndex(e.position.x,e.position.y);if(c.log("risk当前事件位置 "+e.position.x+":"+e.position.y+"，类型:"+(e.type||e.fadeType)+MAP_EP_TYPE_NAME[e.type||e.fadeType]),e.position.x>c.w-1||e.position.y>c.h-1)egret.warn("risk当前事件位置超过地图范围，丢弃");else if(e.type==RiskEventType.None)c.tileIndex2EP[t]&&c.gp_ep.contains(c.tileIndex2EP[t])&&(c.log("risk对象清理"),c.gp_ep.removeChild(c.tileIndex2EP[t]),delete c.tileIndex2EP[t]),c.gp_miniMap&&c.tileIndex2MNMEP[t]&&c.gp_miniMap.contains(c.tileIndex2MNMEP[t])&&(c.gp_miniMap.removeChild(c.tileIndex2MNMEP[t]),delete c.tileIndex2MNMEP[t]);else{if(c.tileIndex2EP[t]&&c.tileIndex2EP[t].type!=e.type&&c.gp_ep.contains(c.tileIndex2EP[t])&&(c.log("risk对象被替换了，删除"),c.gp_ep.removeChild(c.tileIndex2EP[t]),delete c.tileIndex2EP[t]),c.tileIndex2EP[t])c.log("risk对象复用"+ ++h);else{c.log("risk对象新建"+ ++l);var i=_.EventPointFactory.create({vo:e,map:c});c.tileIndex2EP[t]=i,c.gp_ep.addChild(i)}if(c.tileIndex2EP[t].updateData(),c.tileIndex2EP[t].vo.isExpire=!1,c.gp_miniMap){var n=1.2,o=MAP_EP_TYPE_IMG_MNM[e.type||e.fadeType];if(e.type==RiskEventType.Manor){var a=_.Config.manor()[e.info.id];a&&a.model&&(o=_.GeneralConfig.getGuajiImg(a.model)[1],n=.4)}if(c.tileIndex2MNMEP[t])RES.getResAsync(o,function(e){c.tileIndex2MNMEP[t].source=e,c.tileIndex2MNMEP[t].anchorOffsetX=e.textureWidth/2,c.tileIndex2MNMEP[t].anchorOffsetY=e.textureHeight/2},c);else{var r=new eui.Image;RES.getResAsync(o,function(e){r.source=e,r.anchorOffsetX=e.textureWidth/2,r.anchorOffsetY=e.textureHeight/2},c),r.scaleX=r.scaleY=n;var s=c.tile2MNMPos(e.position.x,e.position.y);r.x=s.x+32.5,r.y=s.y+17.5-5,c.tileIndex2MNMEP[t]=r,c.gp_miniMap.addChild(r)}}}});var i=0;for(var t in this.tileIndex2EP)this.tileIndex2EP[t].vo.isExpire&&(this.tileIndex2EP[t].type==RiskEventType.StormWarCreep?(this.gp_ep.contains(this.tileIndex2EP[t])&&this.gp_ep.removeChild(this.tileIndex2EP[t]),delete this.tileIndex2EP[t]):this.gp_ep.removeChild(this.tileIndex2EP[t]),i++);this.log("risk对象删除"+i),this.reqCalAllZOrder(),this.initGraph(),this.isInitedGraph||(this.isInitedGraph=!0)}}else this.delatUpdateLayerEventP=e},e.prototype.handleOtherNpc=function(e){for(var t in this.playerOrTeamId2NPC)this.playerOrTeamId2NPC[t].valid=!1;for(var i=0,n=e;i<n.length;i++){var o=n[i];t=void 0;if(o.playerBaseInfo?t=o.playerBaseInfo.playerId:o.team&&o.team.id&&(t=o.team.id),null==o.coordinate.x||null==o.coordinate.y||!this.checkPosValid(o.coordinate.x,o.coordinate.y)){var a=this.getRandomValidPoint();o.coordinate.x=a[0]||this.me.tileX,o.coordinate.y=a[1]||this.me.tileY}if(t){var r=this.playerOrTeamId2NPC[t];r?(r.setTilePos(o.coordinate.x,o.coordinate.y),r.valid=!0):((r=new _.PlayerNpc(this,this.source,o.playerBaseInfo)).setTilePos(o.coordinate.x,o.coordinate.y),this.gp_ep.addChild(r),this.playerOrTeamId2NPC[t]=r)}else this.log("handleOtherNpc 没有id")}for(var t in this.playerOrTeamId2NPC)this.playerOrTeamId2NPC[t].valid||(this.gp_ep.removeChild(this.playerOrTeamId2NPC[t]),delete this.playerOrTeamId2NPC[t])},e.prototype.checkAllLoadDone=function(){var t=this,i=function(){_.AppFacade.getInstance().sendNotification(CN.GUAJI_MAP_INIT_ALL_DONE,{source:t.source}),_.AppFacade.getInstance().sendNotification(CN.GUAJI_ENTER_LAYER,{layerId:t.layerId,source:t.source})};if(this.source==MODULE.Risk){var n=_.Config.riskLayer()[this.layerId],o=_.AppFacade.getInstance().retrieveProxy(_.GuidePy.N),e=function(){var e=1e7+t.layerId;o.serverGuideInfo[e]?i():PopUpManager.addPopUp({obj:new _.StoryView({storyId:n.storyId,questionId:void 0,position:void 0,cb:function(){o.setGuideInfo(e),i()}})})},a=!0;if(n.bigStoryId){var r=2e7+this.layerId;if(!o.serverGuideInfo[r]){a=!1;PopUpManager.addPopUp({effectType:0,obj:new _.BigStoryView({content:n.bigStoryId,cb:function(){o.setGuideInfo(r),n.storyId?e():i()}})})}}else n.storyId&&(a=!1,e());a&&i()}else i()},e.prototype.initGraph=function(){for(var e=[],t=0;t<this.h;t++){e[t]||(e[t]=[]);for(var i=0;i<this.w;i++){e[t][i]=0;var n=this.getTileIndex(i,t);if(this.tileIndex2MBN[n]){var o=1;this.tileIndex2EP[n]&&(o=this.tileIndex2EP[n].aStarCost),e[t][i]=o}}}this.curGraph=new astar.Graph(e),this.gp_touchTile.touchChildren=!0},e.prototype.handleMW=function(){for(var e=-1,t=this.me.tileX,i=this.me.tileY,n=this.source!=MODULE.Risk,o=0,a=this.mwArr;o<a.length;o++){var r=a[o];if(e++,null!=r)if(0==r||4==r)this.tileIndex2EP[e]&&(this.tileIndex2EP[e].visible=!1),this.tileIndex2MBN[e].visible=!1,this.tileIndex2MNMEP[e]&&(this.tileIndex2MNMEP[e].visible=!1),this.tileIndex2MNM[e]&&(this.tileIndex2MNM[e].visible=!1);else if(2==r||3==r){var s=this.tileIndex2EP[e];if(s)if(n)this.switchScanVisible(s,!0);else if(s.vo.type!=RiskEventType.Hinder){Math.pow(s.tileX-t,2)+Math.pow(s.tileY-i,2)<=Math.pow(5,2)?s.visible?s.alpha=1:this.switchScanVisible(s,!0):s.visible&&this.switchScanVisible(s,!1)}3==r?(this.switchVisible(this.tileIndex2MBN[e],!0),s&&s.vo.type==RiskEventType.Hinder&&this.switchVisible(s,!0),this.mwArr[e]=2):(s&&(s.visible=!0),this.tileIndex2MBN[e].visible=!0),this.tileIndex2MNMEP[e]&&(this.tileIndex2MNMEP[e].visible=!0),this.tileIndex2MNM[e]&&(this.tileIndex2MNM[e].visible=!0)}}if(this.otherPlayers)for(var c in this.otherPlayers)for(var l in this.otherPlayers[c])this.otherPlayers[c][l].updateVisible();if(this.stormWarPlayers)for(var c in this.stormWarPlayers)this.stormWarPlayers[c].updateVisible()},e.prototype.switchVisible=function(e,t,i){if(e)if(t){e.alpha=0,e.visible=!0;var n=e.y;e.y+=50,egret.Tween.get(e).to({y:n,alpha:1},2*this.npcMovingDura,egret.Ease.backOut).call(function(){i&&i()})}else e.alpha=1,e.visible=!1,i&&i()},e.prototype.switchScanVisible=function(e,t){e&&(egret.Tween.removeTweens(e),t?(e.visible||(e.alpha=0,e.visible=!0),egret.Tween.get(e).to({alpha:1},2*this.npcMovingDura,egret.Ease.backOut)):egret.Tween.get(e).to({alpha:0},2*this.npcMovingDura,egret.Ease.backOut).call(function(){e.visible=!1}))},e.prototype.initAll=function(){var d=this;for(var e in this.log("Map initAll"),this.tileIndex2EP)this.gp_ep.removeChild(this.tileIndex2EP[e]);this.gp_ep.getChildByName("fade_rightP")&&this.gp_ep.removeChild(this.gp_ep.getChildByName("fade_rightP")),this.gp_ep.getChildByName("fade_bottomP")&&this.gp_ep.removeChild(this.gp_ep.getChildByName("fade_bottomP")),this.tileIndex2EP={},this.tileIndex2MBN={},this.tileIndex2MNM={},this.tileIndex2MNMEP={},this.gp_tile.removeChildren(),this.gp_miniMap&&this.gp_miniMap.removeChildren(),this.gp_touchTile.removeChildren();var t=this.tile2Pos(this.w-1,0,!0);(i=new _.MapObj).visible=!1,i.name="fade_rightP",i.x=t.x+this.cu_mls.width/4,i.y=t.y,this.gp_ep.addChild(i);var i,n=this.tile2Pos(this.w-1,this.h-1,!0);(i=new _.MapObj).visible=!1,i.x=n.x,i.y=n.y+this.cu_mls.height/4,i.name="fade_bottomP",this.gp_ep.addChild(i);for(var o=function(p){for(var e=function(t){var e=u.tmxTiledArr[u.getTileIndex(p,t)];if(null==e)return egret.warn("地图尺寸"+u.w+"x"+u.h+"超过地形尺寸，请检查配置"),"break";if(0!=e){var i=u.getTileIndex(p,t),n=u.tile2Pos(p,t,!0),o=u.tile2Deep(p,t),a=u.tmxHinderArr[i];if(0!=a){var r=_.EventPointFactory.create({vo:new _.EventVO({type:RiskEventType.Hinder,position:{x:p,y:t}}),hinderImg:u.theme.hinder[u.tilesets[a].hinderIndex],map:u});u.tileIndex2EP[i]=r,u.gp_ep.addChild(r)}else{var s=new eui.Image("maoxian_img_zhishi_png");s.anchorOffsetX=70,s.anchorOffsetY=70,s.alpha=0,s.x=n.x,s.pixelHitTest=!0,s.y=n.y+u.getOffsetYForDeep(o),Utils.TouchUtils.addTouchListener(s,function(){d.curGraph&&(!d.curValidTouchPosXY.length||d.curValidTouchPosXY.some(function(e){return e.tileX==p&&e.tileY==t})?(d.img_youBiao.x=s.x,d.img_youBiao.y=s.y-120,d.setChildIndex(d.img_youBiao,-1),egret.Tween.removeTweens(d.img_youBiao),egret.Tween.get(d.img_youBiao).to({alpha:1,y:s.y-40},1e3,egret.Ease.elasticOut).call(function(){d.img_youBiao.alpha=0}),s.scaleX=s.scaleY=.1,egret.Tween.get(s).wait(120).to({alpha:1,scaleX:1,scaleY:1},880,egret.Ease.elasticOut).call(function(){s.alpha=0}),d.handleTouchTap(p,t)):d.log("当前点击位置不允许响应"))}),u.gp_touchTile.addChild(s)}var c=new g({x:p,y:t,tiledP:{deep:o,deepImg:u.theme.deep[o+4]?u.theme.deep[o+4][u.tile2DeepTheme(p,t)]:u.theme.deep[4][u.tile2DeepTheme(p,t)]},map:u});if(c.x=n.x,c.y=n.y,u.gp_tile.addChild(c),u.tileIndex2MBN[i]=c,egret.Point.release(n),u.source!=MODULE.Risk||Utils.agentConfig.OffLineTest?u.mwArr[i]=2:u.mwArr[i]=0,u.gp_miniMap){var l=new eui.Image("_guaji_m_json.mx_img_sekuai"+(0==a?2:1)),h=u.tile2MNMPos(p,t);l.x=h.x,l.y=h.y,u.tileIndex2MNM[i]=l,u.gp_miniMap.addChild(l),egret.Point.release(h)}}},t=0;t<u.h;t++){if("break"===e(t))break}},u=this,a=0;a<this.w;a++)o(a);this.initGraph(),this.gp_tile.$children.sort(function(e,t){return e.tileY+e.tileX-t.tileY-t.tileX}),this.delatupdateNPCP&&this.fu_mgr.insert({delayFrame:3,waitFrame:0,cb:function(){d.stage&&d.updateNPC(d.delatupdateNPCP)},params:void 0}),this.delatUpdateLayerEventP&&this.fu_mgr.insert({delayFrame:5,waitFrame:0,cb:function(){d.stage&&d.updateLayerEvent(d.delatUpdateLayerEventP)},params:void 0}),this.delatupdateMWP&&this.fu_mgr.insert({delayFrame:7,waitFrame:0,cb:function(){d.stage&&d.updateMWInfo(d.delatupdateMWP)},params:void 0}),this.delatupdateMapPlayerInfo&&this.fu_mgr.insert({delayFrame:30,waitFrame:0,cb:function(){d.stage&&d.delatupdateMapPlayerInfo&&d.updateMapPlayerInfo(d.delatupdateMapPlayerInfo.player,d.delatupdateMapPlayerInfo.isInit)},params:void 0}),this.fu_mgr.insert({delayFrame:1,waitFrame:0,cb:function(){d.stage&&d.cu_mls.updateBg(d.theme.bg)},params:void 0})},e.prototype.updateMWInfo=function(e){var l=this;if(this.isInited){this.delatupdateMWP=void 0;var t=e&&e.grids;Array.isArray(t)&&t.forEach(function(e){for(var t=0;t<e.long;t++)for(var i=0;i<e.wide;i++){var n=e.x+t,o=e.y+i,a=l.getTileIndex(n,o);l.tmxTiledArr[a]?l.mwArr[a]=2:egret.warn("该点不在当前地图的可行地形",e.x,e.y,e.x+t,e.y+i);for(var r=n-l.radius;r<n+l.radius;r++)if(!(r<0||r>=l.w))for(var s=o-l.radius;s<o+l.radius;s++)if(!(s<0||s>=l.h)){var c=l.getTileIndex(r,s);l.tmxTiledArr[c]&&(l.mwArr[c]=2)}}}),this.newEnterTile(this.me.tileX,this.me.tileY)}else this.delatupdateMWP=e},e.prototype.newEnterTile=function(e,t){for(var i=0;i<this.w;i++)for(var n=0;n<this.h;n++){var o=this.getTileIndex(i,n),a=this.mwArr[o];if(null!=a){var r=Math.pow(i-e,2)+Math.pow(n-t,2);r>Math.pow(this.radiusScanOutside,2)?0!=a&&(a=4):r>Math.pow(this.radius,2)?4==a&&(a=2):0==a?a=3:2!=a&&(a=2),this.mwArr[o]=a}}this.once(egret.Event.ENTER_FRAME,this.handleMW,this)},e.prototype.hudongWithEP=function(e){e&&e.tileX&&e.tileY&&this.tile2EP(e.tileX,e.tileY).hudongWithEP(e.action)},e.prototype.showMePathToPos=function(e){e&&e.tileX&&e.tileY&&(this.curMeOnTargetPos={tileX:e.tileX,tileY:e.tileY},this.checkCurMeTarget())},e.prototype.showFingerToXY=function(e,t){null==e&&null==t?this.finger.switchVisible(!1):(this.finger.switchVisible(!0),this.finger.tileX=e,this.finger.tileY=t)},e.prototype.riskFingerAppearToXY=function(e,t,i){var n=this;null==e&&null==t?this.guide.switchVisible(!1):(this.guide.switchVisible(!0),this.guide.tileX=e,this.guide.tileY=t,egret.setTimeout(function(){n.guide.switchVisible(!1)},this,i))},e.prototype.cleanAllEP=function(){for(var e in this.tileIndex2EP)this.tileIndex2EP[e].type!=RiskEventType.Hinder&&(this.gp_ep.removeChild(this.tileIndex2EP[e]),delete this.tileIndex2EP[e])},e.prototype.onThisMapSwitch=function(e){for(var t in this.tileIndex2EP){var i=this.tileIndex2EP[t];i&&i.onMapSwitch(e)}},e.prototype.handleTouchTap=function(t,i,e,n){var o=this;if(void 0===e&&(e=!1),void 0===n&&(n=!1),this.source!=MODULE.Manor||!this.me.isMoving||n){if(!this.isInitedGraph)return this.preTileX=t,void(this.preTileY=i);if(!this.curValidTouchPosXY.length||this.curValidTouchPosXY.some(function(e){return e.tileX==t&&e.tileY==i})){var a=this.tile2EP(t,i);if(!this.onRequestToMove||!this.onRequestToMove(t,i,n,a)||n){if(_.AppFacade.getInstance().sendNotification(CN.GUAJI_MAP_ON_TOUCH_TILE_POS,{tileX:t,tileY:i,source:this.source}),this.finger.tileX==t&&this.finger.tileY==i&&this.showFingerToXY(),a&&a.vo.type!=RiskEventType.Start){this.me.switchDir(t,i),this.me.calDir(t,i);var r=Math.abs(t-this.me.tileX),s=Math.abs(i-this.me.tileY);if(1==r&&0==s||0==r&&1==s||0==r&&0==s&&!e){if(n)return;return this.log("risk当前触发 "+t+":"+i+"，触发事件："+(a.vo.type||a.vo.fadeType)+MAP_EP_TYPE_NAME[a.vo.type|a.vo.fadeType]),this.onEventTrigger(a),a.onTrigger(),void _.AppFacade.getInstance().sendNotification(CN.GUAJI_ON_ME_STOP_ON,{tileX:this.me.tileX,tileY:this.me.tileY})}}if(t!=this.me.tileX||i!=this.me.tileY){var c=this.me.gp_foot.parent.localToGlobal(this.me.gp_foot.x,this.me.gp_foot.y);c.x<this.me.width||c.x>this.winWidth-this.me.width||c.y<this.me.height||c.y>this.winHeight-120-this.me.height?this.resetCamera(function(){o.searchPathAndMove(t,i,a,e)}):this.searchPathAndMove(t,i,a,e)}else if(this.source==MODULE.StormWar){var l=this.getStormWarPlayerByTilePos(t,i);l&&0<l.length&&_.AppFacade.getInstance().showSubView(_.StormWarMediator.N,_.StormWarMediator.SV.DIALOG,{data:l[0].player,isCreep:!1})}}}else this.log("当前点击位置不允许响应")}else egret.log("角色移动中 不响应点击")},e.prototype.getAStarPath=function(e,t,i,n){return astar.astar.search(this.curGraph,this.curGraph.grid[t][e],this.curGraph.grid[n][i],{closest:!0})},e.prototype.searchPathAndMove=function(e,t,i,n){var o=this;if(void 0===n&&(n=!1),this.curGraph.grid&&this.curGraph.grid[t]){var a=this.getAStarPath(this.me.tileX,this.me.tileY,e,t);if(0!=a.length){var r=void 0;if(!n){for(var s=0,c=0,l=a;c<l.length;c++){var h=l[c],p=this.tile2EP(h.y,h.x);if(this.finger.tileX==h.y&&this.finger.tileY==h.x&&this.showFingerToXY(),p&&p.vo.type!=RiskEventType.Start&&p.canTrigger){r=p,a.splice(s);break}s++}r||(r=i)}for(var s in this.tileIndex2EP){var d=this.tileIndex2EP[s];d&&d.onMapMoving(!0)}this.camera&&this.camera.onMove(),this.me.walkByPath(a,function(){if(r&&(o.onEventTrigger(r),r.onTrigger()),!r&&o.source==MODULE.StormWar){var e=o.getStormWarPlayerByTilePos(o.me.tileX,o.me.tileY);e&&0<e.length&&_.AppFacade.getInstance().showSubView(_.StormWarMediator.N,_.StormWarMediator.SV.DIALOG,{data:e[0].player,isCreep:!1})}for(var t in _.AppFacade.getInstance().sendNotification(CN.GUAJI_ON_ME_STOP_ON,{tileX:o.me.tileX,tileY:o.me.tileY}),o.checkCurMeTarget(),o.tileIndex2EP){var i=o.tileIndex2EP[t];i&&i.onMapMoving(!1)}}),0<a.length&&this.onTouchTap&&this.onTouchTap(a[a.length-1].y,a[a.length-1].x)}}},e.prototype.onEventTrigger=function(e){this.curMeOnTargetPos&&this.curMeOnTargetPos.tileX==e.tileX&&this.curMeOnTargetPos.tileY==e.tileY&&(console.log("已经触发了目标点"),this.curMeOnTargetPos=void 0,this.checkCurMeTarget()),_.AppFacade.getInstance().sendNotification(CN.GUAJI_ENTER_EP,{type:e.vo.type,fadeType:e.vo.fadeType})},e.prototype.checkCurMeTarget=function(){if(this.curMeOnTargetPos&&(this.curMeOnTargetPos.tileX!=this.me.tileX||this.curMeOnTargetPos.tileY!=this.me.tileY)&&this.curGraph){var e=astar.astar.search(this.curGraph,this.curGraph.grid[this.me.tileY][this.me.tileX],this.curGraph.grid[this.curMeOnTargetPos.tileY][this.curMeOnTargetPos.tileX],{closest:!0});if(0==e.length)return;var t=e.shift();this.camera&&this.camera.showTargetDir(this.me.calDir(t.y,t.x))}this.curMeOnTargetPos||this.camera&&this.camera.showTargetDir(void 0)},e.prototype.updateMNMMePos=function(){var t=this;if(this.gp_miniMap){this.img_meRedPointInMNM||(this.img_meRedPointInMNM=new eui.Image,RES.getResAsync("_guaji_m_json.maoxian_icon_ziji",function(e){t.img_meRedPointInMNM.source=e,t.img_meRedPointInMNM.anchorOffsetX=e.textureWidth/2,t.img_meRedPointInMNM.anchorOffsetY=e.textureHeight},this),this.img_meRedPointInMNM.scaleX=this.img_meRedPointInMNM.scaleY=1.4);var e=this.getTileIndex(this.me.tileX,this.me.tileY);if(this.tileIndex2MNM[e]){var i=this.tileIndex2MNM[e].x+32.5,n=this.tileIndex2MNM[e].y+17.5;this.img_meRedPointInMNM.parent?(this.img_meRedPointInMNM.x=i,this.img_meRedPointInMNM.y=n):(this.img_meRedPointInMNM.x=i,this.img_meRedPointInMNM.y=n,this.gp_miniMap.addChildAt(this.img_meRedPointInMNM,-1)),this.resetMNM(this.npcMovingDura,{x:i,y:n})}}},e.prototype.updatePlayerEntityInfo=function(o,e,t){var a=this;if(void 0===e&&(e=!1),o.isSelf){if(o.entityIndex==_.GameMVC.manorPy.lastEntityIndex){if(this.me.serverTileX=o.coordinateInfo.x,this.me.serverTileY=o.coordinateInfo.y,e){this.updateNPC({curPosVO:{x:o.coordinateInfo&&o.coordinateInfo.x||0,y:o.coordinateInfo&&o.coordinateInfo.y||0,isFixed:!0}}),_.GameMVC.guajiPy.updateCurPosition(o.coordinateInfo.x,o.coordinateInfo.y);var i=void 0;if(o.coordinateStatus==ManorPlayerCoordinateChangeType.Battle?i="由于体力归0，你已传送回安全区":o.coordinateStatus==ManorPlayerCoordinateChangeType.ManorDisapper?i="矿已消失，你已传送回安全区":o.coordinateStatus==ManorPlayerCoordinateChangeType.NoHero&&(i="由于队伍状态改变，你已被传送回安全区"),i){var n=new egret.Timer(3e3,1);n.addEventListener(egret.TimerEvent.TIMER,function(){Utils.MsgUtils.addMidMsg(i),n.stop()},this),n.start()}}else if(this.me.forceStop(),this.me.tileX!=o.coordinateInfo.x||this.me.tileY!=o.coordinateInfo.y)if(o.coordinateStatus==ManorPlayerCoordinateChangeType.Battle||o.coordinateStatus==ManorPlayerCoordinateChangeType.ManorDisapper||o.coordinateStatus==ManorPlayerCoordinateChangeType.NoHero)this.me.setTilePos(o.coordinateInfo.x,o.coordinateInfo.y,!0),this.resetCamera(),this.onMeWalkTo(o.coordinateInfo.x,o.coordinateInfo.y),_.GameMVC.guajiPy.updateCurPosition(o.coordinateInfo.x,o.coordinateInfo.y),_.GameMVC.manorMed.hideSubView(_.ManorMediator.SV.DETAIL),o.coordinateStatus==ManorPlayerCoordinateChangeType.Battle&&Utils.MsgUtils.addMidMsg("由于体力归0，你已传送回安全区"),o.coordinateStatus==ManorPlayerCoordinateChangeType.ManorDisapper&&Utils.MsgUtils.addMidMsg("矿已消失，你已传送回安全区"),o.coordinateStatus==ManorPlayerCoordinateChangeType.NoHero&&Utils.MsgUtils.addMidMsg("由于队伍状态改变，你已被传送回安全区");else{var r=o.coordinateInfo.x,s=o.coordinateInfo.y;t&&(r=t._tileX,s=t._tileY),this.handleTouchTap(r,s,!1,!0)}if(this.me.isOccpuyManor=0!=o.manorId,this.me.visible=0==o.manorId,o.teamInfo&&o.teamInfo.heroBaseInfoList&&o.teamInfo.heroBaseInfoList[0]){var c=void 0;0!=(g=o.teamInfo.heroBaseInfoList[0]).dermaCode&&(c=_.Config.getHeroDermaConfig()[g.dermaCode].avatar),this.me.updateBaseItem({code:g.code,avatar:c})}else{var l=JSON.parse(_.Config.constConfig().DefaultAvatar.constValue)[0];this.me.updateBaseItem({avatar:l})}}}else{var h=o.baseInfo.playerId,p=o.entityIndex,d=!1;if(this.otherPlayers[h]&&this.otherPlayers[h][p]||(d=!0),d)this.fu_mgr.insert({delayFrame:30,waitFrame:0,cb:function(){if(a.stage&&!(a.caleOtherPlayerCount()>=Number(_.Config.constConfig().ManorMaxPlayerEntityShowNum.constValue)||a.otherPlayers[h]&&a.otherPlayers[h][p])){var e=new _.ManorPlayer(a,o.baseInfo);if(e.isOccupyManor=0!=o.manorId,e.visible=0==o.manorId,e.entityIndex=p,e.setTilePos(o.coordinateInfo.x,o.coordinateInfo.y),e.updateVisible(),a.gp_ep.addChild(e),a.otherPlayers[h]||(a.otherPlayers[h]={}),a.otherPlayers[h][p]=e,o.teamInfo&&o.teamInfo.heroBaseInfoList&&o.teamInfo.heroBaseInfoList[0]){var t=o.teamInfo.heroBaseInfoList[0],i=void 0;0!=t.dermaCode&&(i=_.Config.getHeroDermaConfig()[t.dermaCode].avatar),e.updateBaseItem({code:t.code,avatar:i})}else{var n=JSON.parse(_.Config.constConfig().DefaultAvatar.constValue)[0];e.updateBaseItem({avatar:n})}}},params:void 0});else{var u=this.otherPlayers[h][p];if(u.isOccupyManor=0!=o.manorId,u.visible=0==o.manorId,o.teamInfo&&o.teamInfo.heroBaseInfoList&&o.teamInfo.heroBaseInfoList[0]){var g;c=void 0;0!=(g=o.teamInfo.heroBaseInfoList[0]).dermaCode&&(c=_.Config.getHeroDermaConfig()[g.dermaCode].avatar),u.updateBaseItem({code:g.code,avatar:c})}else{l=JSON.parse(_.Config.constConfig().DefaultAvatar.constValue)[0];u.updateBaseItem({avatar:l})}if(o.coordinateStatus==ManorPlayerCoordinateChangeType.Battle||o.coordinateStatus==ManorPlayerCoordinateChangeType.ManorDisapper||o.coordinateStatus==ManorPlayerCoordinateChangeType.NoHero)u.setTilePos(o.coordinateInfo.x,o.coordinateInfo.y);else{var f=this.getAStarPath(u.tileX,u.tileY,o.coordinateInfo.x,o.coordinateInfo.y);u.walkByPath(f,function(){})}}}},e.prototype.caleOtherPlayerCount=function(){var e=0;for(var t in this.otherPlayers)for(var i in this.otherPlayers[t])e+=1;return e},e.prototype.removeOtherPlayer=function(e,t){this.otherPlayers[e]&&this.otherPlayers[e][t]&&(this.otherPlayers[e][t].reset(),this.gp_ep.removeChild(this.otherPlayers[e][t]),delete this.otherPlayers[e][t])},e.prototype.removeAllOtherPlayer=function(){for(var e in this.otherPlayers)for(var t in this.otherPlayers[e])this.removeOtherPlayer(e,t)},e.prototype.removeManorEntity=function(e){if(e){var t=!1;for(var i in this.tileIndex2EP)if(this.tileIndex2EP[i].vo.info.manorId==e.manorId){console.log("移除矿"+e.manorId),this.gp_ep.removeChild(this.tileIndex2EP[i]),delete this.tileIndex2EP[i],t=!0;break}t&&(this.reqCalAllZOrder(),this.initGraph())}},e.prototype.removePlayerEntity=function(e){e&&this.removeOtherPlayer(e.baseInfo.playerId,e.entityIndex)},e.prototype.updateManorEPCollect=function(){for(var e in this.tileIndex2EP)this.tileIndex2EP[e]&&this.tileIndex2EP[e].updateCollect&&this.tileIndex2EP[e].updateCollect()},e.prototype.updateMapPlayerInfo=function(t,e){var i=this;if(void 0===e&&(e=!1),t.isSelf)e&&(this.updateNPC({curPosVO:{x:t.pos&&t.pos.x||0,y:t.pos&&t.pos.y||0,isFixed:!0}}),_.GameMVC.guajiPy.updateCurPosition(t.pos.x,t.pos.y));else{if(!this.isInited)return void(this.delatupdateMapPlayerInfo={player:t,isInit:e});this.delatupdateMapPlayerInfo=void 0;var n=t.playerId;if(this.stormWarPlayers[n]){var o=this.stormWarPlayers[n],a=this.getAStarPath(o.tileX,o.tileY,t.pos.x,t.pos.y);o.walkByPath(a,function(){})}else this.fu_mgr.insert({delayFrame:30,waitFrame:0,cb:function(){if(i.stage&&!i.stormWarPlayers[n]){var e=_.StormWarPlayerFactory.create({map:i,player:t});e.setTilePos(t.pos.x,t.pos.y,!0),e.updateVisible(),i.gp_ep.addChild(e),i.stormWarPlayers[n]=e}},params:void 0})}},e.prototype.removeStormWarPlayer=function(e){this.stormWarPlayers[e]?(this.stormWarPlayers[e].reset(),this.gp_ep.removeChild(this.stormWarPlayers[e]),delete this.stormWarPlayers[e]):egret.log("===== storm ===== 移除风暴战场玩家 "+e+" 失败")},e.prototype.removeAllStormWarPlayer=function(){for(var e in this.stormWarPlayers)this.removeStormWarPlayer(e)},e.prototype.updateStormChampion=function(e){for(var t in this.stormWarPlayers)this.stormWarPlayers[t].updateChampion(e)},e.prototype.getStormWarPlayerByTilePos=function(e,t){var i=new Array;for(var n in this.stormWarPlayers){var o=this.stormWarPlayers[n];o&&o.tileX==e&&o.tileY==t&&i.push(o)}return i},e.prototype.getStormWarPlayerByPlayerId=function(e){var t=this.stormWarPlayers[e];return t||null},e}(eui.Component);_.Map=i,__reflect(i.prototype,"game.Map");var g=function(i){function e(e){var t=i.call(this)||this;return t.value=0,t.tileX=e.x,t.tileY=e.y,t.deep=e.tiledP.deep,t.deepImg=e.tiledP.deepImg,t.width=139,t.height=182,t.anchorOffsetX=70,t.anchorOffsetY=97,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.img_bg=new eui.Image,this.addChild(this.img_bg),this.img_bg.source=this.deepImg,this.img_bg.touchEnabled=this.touchEnabled=!1},e}(eui.Group);__reflect(g.prototype,"MapBgNode")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.skinName="HighStarLevelIconSkin",t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data&&this.update(this.data)},e.prototype.update=function(e){this.data=e;var t=this.data.num||this.data;this.blb_num.text=t.toString(),this.data.scale&&(this.scaleX=this.scaleY=this.data.scale)},e}(eui.Component);e.HighStarLevelIcon=t,__reflect(t.prototype,"customui.HighStarLevelIcon")}(customui||(customui={})),function(c){var e=function(o){function e(e,t,i){void 0===t&&(t=!1),void 0===i&&(i=MODULE.Risk);var n=o.call(this,e,i)||this;return n.isFollower=!1,n.isFollower=t,n.mapObjType=1,n.vo=c.GameMVC.playerPy.playerInfoVO,n.isMe=!0,n}return __extends(e,o),e.prototype.setFollowers=function(e){var s=this;e||(e=[]),this.followers||(this.followers=new Array);for(var t=0,i=this.followers;t<i.length;t++){(a=i[t]).valid=!1}e.forEach(function(e,t){if(e.isLeader)s.updateNPCOutLook(e.baseInfo);else{for(var i=!1,n=0,o=s.followers;n<o.length;n++){var a=o[n];if(a.vo.playerId==e.baseInfo.playerId){i=!0,a.valid=!0,a.updateNPCOutLook(e.baseInfo);break}}if(!i){var r=new c.PlayerNpc(s.map,void 0,e.baseInfo);r.hasEnterMap=!0,r.setTilePos(s.tileX,s.tileY,!0),s.parent.addChild(r),s.followers.push(r)}}});for(var n=0,o=this.followers;n<o.length;n++){var a;(a=o[n]).valid||(a.reset(),this.parent.removeChild(a))}this.followers=this.followers.filter(function(e){return e.valid})},e.prototype.onWalking=function(){o.prototype.onWalking.call(this),this.map.onMeWalkTo(this.tileX,this.tileY),this.py.updateCurPosition(this.tileX,this.tileY),this.followers&&(this.followers[0]&&this.followers[0].walkToTile(this.lastTileX,this.lastTileY),this.followers[1]&&this.followers[1].walkToTile(this.followers[0].lastTileX,this.followers[0].lastTileY))},e.prototype.walkPathFinish=function(){0<this.hasWalkPassPath.length&&this.map.source==MODULE.Risk&&this.py.Walk(this.hasWalkPassPath),o.prototype.walkPathFinish.call(this)},e.prototype.reset=function(){if(o.prototype.reset.call(this),this.followers){for(var e=0,t=this.followers;e<t.length;e++){t[e].reset()}this.followers.splice(0)}},e}(c.PlayerNpc);c.Me=e,__reflect(e.prototype,"game.Me")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.size=20,t.textColor=0,t.iconWidth=game.GeneralConfig.fixedSizeWH,t.iconHeight=game.GeneralConfig.fixedSizeWH,t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.init(),this.data&&this.update(this.data)},e.prototype.init=function(){var e=this;this.gp=new eui.Group,this.gp.percentHeight=this.gp.percentWidth=100,this.addChild(this.gp);var t=new eui.VerticalLayout;t.gap=3,t.verticalAlign=egret.VerticalAlign.MIDDLE,t.horizontalAlign=egret.HorizontalAlign.CENTER,this.gp.layout=t,this.addEventListener(eui.UIEvent.RESIZE,this.update,this),this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.removeEventListener(eui.UIEvent.RESIZE,e.update,e)},this)},e.prototype.update=function(e){var c=this;if(this.data=e||this.data,this.gp&&this.data&&this.data.data){this.gp.removeChildren();var t=this.data.data,l=this.width,h=this.width,i=[],p=function(){return i.push([]),i[i.length-1]},d=p(),n=[["0".charCodeAt(0),"9".charCodeAt(0)],["a".charCodeAt(0),"z".charCodeAt(0)],["A".charCodeAt(0),"Z".charCodeAt(0)]],u=function(e){var t=!1,i=e.charCodeAt(0);return n.forEach(function(e){i>=e[0]&&i<=e[1]&&(t=!0)}),t};t.forEach(function(e){switch(e.type){case COMPONENT_ENUM.LABEL:for(var t=e.data.text,i=e.data.size||c.size,n={type:COMPONENT_ENUM.LABEL,data:{text:"",size:i,textColor:e.data.textColor}};t.length;){var o=t[0],a=u(o)?i/2:i,r="\n"==o;r&&(t=t.slice(1)),!r&&(null==h||a<=h)?(n.data.text+=o,t=t.slice(1),h-=a):(n.data.text.length&&d.push(n),d=p(),n={type:COMPONENT_ENUM.LABEL,data:{text:"",size:i,textColor:e.data.textColor}},h=l)}n.data.text.length&&d.push(n);break;case COMPONENT_ENUM.IMAGE:var s=e.data.width||c.iconWidth;h<s&&(d=p(),h=l),d.push({type:COMPONENT_ENUM.IMAGE,data:{source:e.data.source}}),h-=s}}),i.forEach(function(e){var t=c.makeRowContainer();e.forEach(function(e){t.addChild(c.makeComponent(e))}),c.gp.addChild(t)})}},e.prototype.makeRowContainer=function(){var e=new eui.Group,t=new eui.HorizontalLayout;return t.gap=0,t.verticalAlign=egret.VerticalAlign.MIDDLE,t.horizontalAlign=egret.HorizontalAlign.CENTER,e.layout=t,e},e.prototype.makeComponent=function(e){var t;switch(e.type){case COMPONENT_ENUM.LABEL:(t=new eui.Label).text=e.data.text,t.size=e.data.size||this.size,t.textColor=e.data.textColor||this.textColor;break;case COMPONENT_ENUM.IMAGE:(t=new eui.Image(e.data.source)).width=e.data.width||this.iconWidth,t.height=e.data.height||this.iconHeight}return t},e}(eui.Component);e.LabelWithImage=t,__reflect(t.prototype,"customui.LabelWithImage")}(customui||(customui={})),function(e){var t=function(){function e(){}return e.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.PlayerHead",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},e}();e.PlayerHeadFactory=t,__reflect(t.prototype,"customui.PlayerHeadFactory");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="PlayerHeadSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.addTapEvent=function(e){Utils.TouchUtils.removeTouchListener(this),Utils.TouchUtils.addTouchListener(this,e)},e.prototype.updateData=function(e){var i=this,t=e&&e.vo;if(this.gp_effect.removeChildren(),this.gp_effect1.removeChildren(),t){if(t.frame)this.img_frame.source=t.frame&&game.GeneralConfig.getGuajiImg(t.frame)[1],this.addFrameEffect(t.frame);else{var n=JSON.parse(game.Config.constConfig().DefaultFrame.constValue)[0];this.img_frame.source=game.GeneralConfig.getGuajiImg(n)[1]}if(t.level?(this.blb_level.visible=!0,this.blb_level.text=""+t.level):this.blb_level.visible=!1,3==t.subType)this.img_icon.source="";else if(t.avatar)0==t.avatar.indexOf("http")?RES.getResByUrl(t.avatar,function(e){if(e)i.img_icon.visible=!0,i.img_icon.source=e,i.img_icon.width=i.img_icon.height=86;else{var t=JSON.parse(game.Config.constConfig().DefaultAvatar.constValue)[0];i.img_icon.source=t+"_png"}},this,RES.ResourceItem.TYPE_IMAGE):RES.getResAsync(game.GeneralConfig.getGuajiImg(t.avatar)[1],function(e){i.img_icon.visible=!0,i.img_icon.source=e},this);else{var o=JSON.parse(game.Config.constConfig().DefaultAvatar.constValue)[0];this.img_icon.visible=!0,this.img_icon.source=o+"_png"}}else e&&e.fixedHead?(this.img_icon.visible=!0,this.img_icon.source=ResourceUtils.png(e.fixedHead)):(this.img_bg.source="_border_m_json.common_img_jichuwupingkuang",this.blb_level.visible=this.img_icon.visible=!1);e&&e.ignoreLevel&&(this.blb_level.visible=!1),this.img_tag.visible=e&&e.showTag,this.tapEvent=e&&e.tapEvent,e&&e.tapEvent&&this.addTapEvent(e&&e.tapEvent),e&&e.effect&&(this.effectData=t,this.headEffect())},e.prototype.reset=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.tapEvent,this),this.tapEvent=void 0,this.scaleX=this.scaleY=1,this.x=this.y=0,this.img_tag.visible=this.blb_level.visible=this.img_icon.visible=!1,this.visible=!0,this.blb_level.text="",this.img_icon.source="",this.img_frame.source="",this.img_icon.width=this.img_icon.height=void 0,this.horizontalCenter=this.verticalCenter=void 0},e.prototype.onOPReset=function(){this.reset()},e.prototype.onOPComeBack=function(e,t){e&&this.updateData(e)},e.prototype.onOPClean=function(){},e.prototype.onOPCheck=function(e){egret.log("alive")},e.prototype.headEffect=function(){game.AppFacade.getInstance().retrieveProxy(game.HeroPy.N);var e=this.effectData&&this.effectData.initStar||0,t=!1,i=!1;if(0==e){var n=game.Config.allHeroConfig();for(var o in n){var a=n[o];if(a.avatar==this.effectData.avatar){e=a.initStar;break}}var r=game.Config.getHeroDermaConfig();for(var o in r){if(r[o].avatar==this.effectData.avatar){t=!0;break}}var s=game.Config.itemConfig();for(var o in s){var c=s[o];if(c.icon==this.effectData.avatar&&c.effectEx&&c.type==EPropType.EPropTypeAvatar){i=!0;break}}}(10<=e||t||i)&&DragonBoneTools.create("common_yingxiongtouxiangkuang",function(e){e.anchorOffsetX=0,e.anchorOffsetY=0,e.x=this.img_bg.width/2,e.y=this.img_bg.height/2,e.animation.play("common_yingxiongtouxiangkuang",0),this.gp_effect.addChild(e)},this)},e.prototype.addFrameEffect=function(e){RES.hasRes(e+"_texture_json")&&DragonBoneTools.create(e,function(e){e.scaleX=e.scaleY=1,e.anchorOffsetX=0,e.anchorOffsetY=0,e.x=0,e.y=0,e.animation.play(),this.gp_effect1.addChild(e)},this)},e}(eui.Component);e.PlayerHead=i,__reflect(i.prototype,"customui.PlayerHead",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(customui||(customui={})),function(o){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},e.prototype.onDataChange=function(){var e;(this.c=o.GeneralConfig.getEntityConfigByCode(this.vo.info.rewards[0].type,this.vo.info.rewards[0].code),this.c)&&((e=t.prototype.makeDefaultIcon.call(this))||(e=this.c.icon+"_png"),this.img_icon.source=e,t.prototype.addEffect.call(this))},e.prototype.onTrigger=function(t,i){var n=this;this.c&&(this.checkTriggerCD()?PopUpManager.addPopUp({closeCB:function(e){1==e?(n.py.TriggerEvent(n.vo.position,void 0,void 0,n.doneStoryId),t&&t()):i&&i(),o.EventPoint.lastTriggerTime=0},obj:new o.EpBoxView({config:this.c,canGet:!0,vo:this.vo})}):i&&i())},e}(o.EventPoint);o.EPBox=e,__reflect(e.prototype,"game.EPBox")}(game||(game={})),function(o){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},t.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},t.prototype.onTrigger=function(t,i){var n=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new o.EpBoxCreepView({vo:n.vo}),closeCB:function(e){e?(n.py.TriggerEvent(n.vo.position),t&&t()):i&&i(),o.EventPoint.lastTriggerTime=0}})}):i&&i()},t}(o.EventPoint);o.EPBoxCreep=e,__reflect(e.prototype,"game.EPBoxCreep")}(game||(game={})),function(o){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},t.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},t.prototype.onTrigger=function(t,i){var n=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new o.EpCollectView({vo:n.vo}),closeCB:function(e){e?(n.py.TriggerEvent(n.vo.position,String(e)),t&&t()):i&&i(),o.EventPoint.lastTriggerTime=0}})}):i&&i()},t}(o.EventPoint);o.EPCollect=e,__reflect(e.prototype,"game.EPCollect")}(game||(game={})),function(a){var e=function(o){function e(){var e=null!==o&&o.apply(this,arguments)||this;return e.guidePy=a.AppFacade.getInstance().retrieveProxy(a.GuidePy.N),e}return __extends(e,o),e.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.aStarCost=1e5,this.img_shadow=new eui.Image,this.img_shadow.bottom=-20,this.img_shadow.horizontalCenter=0,this.img_shadow.scaleX=this.img_shadow.scaleY=.6,this.gp_foot.addChild(this.img_shadow)},e.prototype.onDataChange=function(){if(this.vo.type==RiskEventType.StoryCreep){var e=this.vo&&this.vo.eventId,t=a.Config.riskEvent()[e],i=JSON.parse(t.detail)[0];this.c=a.Config.riskCreep()[i]}else this.c=a.Config.riskCreep()[this.vo.info.id];if(this.c&&(o.prototype.makeDefaultIcon.call(this)?this.img_icon.visible=!0:(this.cu_model=new customui.HeroDynamicModel,this.cu_model.touchEnabled=!1,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=.32,this.gp_foot.addChild(this.cu_model),this.cu_model.update({isStatic:!0,model:this.c.model})),0==this.c.difficulty||1==this.c.difficulty?this.img_shadow.source="_guaji_m_json.yingxion_img_touying":2==this.c.difficulty?this.img_shadow.source="_guaji_m_json.yingxion_img_touyinglan":3==this.c.difficulty&&(this.img_shadow.source="_guaji_m_json.yingxion_img_touyinghong"),this.c.difficulty&&!this.gp_foot.getChildByName("difficultySign")&&!this.gp_foot.getChildByName("showSign"))){var n=new eui.Image;n.source="_guaji_m_json.mx_img_jian"+this.c.difficulty,n.y=-70,n.scaleX=n.scaleY=.8,n.horizontalCenter=0,n.name="difficultySign",this.gp_foot.addChild(n)}},e.prototype.hudongWithEP=function(e){var t=this.gp_foot.getChildByName("showSign");if(e.showSign)if(t)t.visible=!0;else{var i=new eui.Image;i.source="_guaji_m_json.mx_img_gth",i.y=-60,i.name="showSign",this.gp_foot.addChild(i),UIActionManager.douDong(i)}else 0==e.showSign&&t&&this.gp_foot.removeChild(this.gp_foot.getChildByName("showSign"))},e.prototype.onTrigger=function(i,n){var o=this;this.checkTriggerCD()?this.handleStory(void 0,function(){var e=o.vo&&o.vo.eventId,t=a.Config.riskEvent()[e];e&&t&&t.descId?PopUpManager.addPopUp({closeCB:function(e){1==e?(o.py.setAfterFightAutoGoCurEPStory(o.doneStoryId,!0),o.py.TriggerEvent(o.vo.position),i&&i()):n&&n(),a.EventPoint.lastTriggerTime=0},obj:new a.EpCreepView({config:o.c,vo:o.vo})}):PopUpManager.addPopUp({closeCB:function(e){1==e?(o.py.setAfterFightAutoGoCurEPStory(o.doneStoryId,!0),o.py.TriggerEvent(o.vo.position),i&&i()):n&&n(),a.EventPoint.lastTriggerTime=0},obj:new r({config:o.c})})}):n&&n()},e}(a.EventPoint);a.EPCreep=e,__reflect(e.prototype,"game.EPCreep");var r=function(i){function e(e){var t=i.call(this)||this;return t.skinName="GuajiCreepDetaiPanellSkin",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.commonTanKuang.img_title_bg.visible=!1,this.inButton(),this.updateView()},e.prototype.inButton=function(){var e=this;this.challge_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.opperationParams=1,e.hide()},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().showSubView(a.HeroMediator.N,a.HeroMediator.SV.FORMATION)},this),Utils.TouchUtils.addTouchListener(this.btn_halo,function(){a.AppFacade.getInstance().retrieveProxy(a.HeroPy.N).showCurHeroHalo()}),this.commonTanKuang.onCloseCB=function(){e.hide()}},e.prototype.updateView=function(){for(var i=this,e=this.params.config,t=0,n=JSON.parse(e.rewards);t<n.length;t++){var o=n[t],a=customui.BaseItemFactory.create(21);a.updateData({type:o[0],code:o[1],num:o[2]}),a.scaleX=.7,a.scaleY=.7,this.gp_reward_show.addChild(a)}var r=JSON.parse(e.creeps);Array.isArray(r)&&r.forEach(function(e){if(e[0]){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e[0]}),t.scaleX=t.scaleY=.7,i.gp_enermy.addChild(t),t.touchEnabled=!1}})},e}(BasePanel);__reflect(r.prototype,"GuajiCreepDetailPanel")}(game||(game={})),function(n){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},t.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},t.prototype.onTrigger=function(e,t){var i=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new n.EpFingerGameView({vo:i.vo}),closeCB:function(e){n.EventPoint.lastTriggerTime=0}})}):t&&t()},t}(n.EventPoint);n.EPFingerGame=e,__reflect(e.prototype,"game.EPFingerGame")}(game||(game={})),function(i){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1},t.prototype.onDataChange=function(){var e=i.AppFacade.getInstance().retrieveProxy(i.ActivityPy.N).allActivityData[EActivityType.FirstRecharge1];if(e&&e.data){this.cu_model=new customui.HeroDynamicModel,this.cu_model.touchEnabled=!1,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=.4,this.gp_foot.addChild(this.cu_model),this.cu_model.update({isStatic:!0,code:41050009})}},t.prototype.onTrigger=function(e,t){this.checkTriggerCD()?i.AppFacade.getInstance().retrieveProxy(i.ActivityPy.N).isOpen(EActivityType.FirstRecharge1)?PopUpManager.addPopUp({obj:new i.EpRechargeView}):Utils.MsgUtils.addMidMsg("活动未开启"):t&&t()},t}(i.EventPoint);i.EPFirstRecharge=e,__reflect(e.prototype,"game.EPFirstRecharge")}(game||(game={})),function(o){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.img_icon&&egret.Tween.removeTweens(e.img_icon)},this)},e.prototype.onDataChange=function(){this.c=o.Config.riskFortress()[this.vo.info.id],this.c?(t.prototype.makeDefaultIcon.call(this),t.prototype.addEffect.call(this),this.lb_tips.text=this.c.name,this.vo.info.clear?(this.img_passed=new eui.Image("maoxian_txt_ytg_png"),this.img_passed.bottom=100,this.img_passed.horizontalCenter=0,this.addChild(this.img_passed)):this.img_passed&&this.img_passed.parent&&this.img_passed.parent.removeChild(this.img_passed)):egret.warn("找不到配置",this.vo.info.id)},e.prototype.onTrigger=function(t,i){var n=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({closeCB:function(e){1==e?(n.py.TriggerEvent(n.vo.position,void 0,void 0,n.doneStoryId),t&&t()):i&&i(),o.EventPoint.lastTriggerTime=0},obj:new o.EPFortressView({config:n.c,vo:n.vo})})}):i&&i()},e}(o.EventPoint);o.EPFortress=e,__reflect(e.prototype,"game.EPFortress")}(game||(game={})),function(b){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.img_icon&&egret.Tween.removeTweens(e.img_icon)},this)},e.prototype.onDataChange=function(){var t=this;RES.getResAsync(MAP_EP_GATE_IMG[this.vo.info.type],function(e){t.img_icon.source=e,t.img_icon.anchorOffsetX=e.textureWidth/2,t.img_icon.anchorOffsetY=e.textureHeight/2},this),this.lb_tips.text="传送门"},e.prototype.onTrigger=function(t,i){var n=this;if(this.log("risk当前传送门类型"+this.vo.info.type),this.checkTriggerCD())if(this.vo.info.type==GateType.Any){var e=b.AppFacade.getInstance().retrieveProxy(b.GuajiPy.N);e.GetLayerNum(function(){PopUpManager.addPopUp({obj:new o({type:e.localType}),closeCB:function(e){e?(n.py.TriggerEvent(n.vo.position,parseInt(e)%2e4+"",void 0,n.doneStoryId),t&&t(e)):i&&i(),b.EventPoint.lastTriggerTime=0}})})}else this.py.TriggerEvent(this.vo.position,void 0,void 0,this.doneStoryId),t&&t();else i&&i()},e}(b.EventPoint);b.EPGate=e,__reflect(e.prototype,"game.EPGate");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuajiGateListItemRenderSkin",e.py=b.AppFacade.getInstance().retrieveProxy(b.PlayerPy.N),e.guajiPy=b.AppFacade.getInstance().retrieveProxy(b.GuajiPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){this.btn_apply.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.cb&&this.data.cb()},this)},e.prototype.dataChanged=function(){var e=this.data.c;this.guajiPy.curLayerInfo.position.layerId==e.id?this.lb_name.text=(e.name||e.id)+"号地图  大小"+e.wide+"x"+e.long+" （当前在这层）":this.lb_name.text=(e.name||e.id)+"号地图  大小"+e.wide+"x"+e.long,this.py.playerInfoVO.level<e.unlockLevel?(this.lb_unlock.text=e.unlockLevel+"级解锁",this.lb_unlock.visible=!0):this.lb_unlock.visible=!1,""!=e.clearCondition?(this.lb_unlock_cost.visible=this.cu_numIcon.visible=!0,this.cu_numIcon.updateItem({cost:JSON.parse(e.clearCondition)[0]})):this.lb_unlock_cost.visible=this.cu_numIcon.visible=!1,this.btn_apply.enabled=this.guajiPy.curLayerInfo.position.layerId!=e.id},e}(eui.ItemRenderer);__reflect(t.prototype,"GuajiGateListItemRender");var o=function(l){function e(e){var t=l.call(this)||this;t.allLayerNum=0,t.GATE_LAB=((i={})[1]={up:"maoxian_txt_telaizesi00_png",down:"maoxian_txt_telaizesi01_png",enable:!1},i[2]={up:"maoxian_txt_huimieshenyuan00_png",down:"maoxian_txt_huimieshenyuan01_png",enable:!1},i[3]={up:"maoxian_txt_yijierukou00_png",down:"maoxian_txt_yijierukou01_png",enable:!1},i[4]={up:"maoxian_txt_mojiedalu00_png",down:"maoxian_txt_mojiedalu01_png",enable:!1},i[5]={up:"maoxian_txt_shenzhishijie00_png",down:"maoxian_txt_shenzhishijie01_png",enable:!1},i),t.skinName="GuajiGateListPanelSkin",t.params=e,t.py=b.AppFacade.getInstance().retrieveProxy(b.PlayerPy.N),t.guajiPy=b.AppFacade.getInstance().retrieveProxy(b.GuajiPy.N),t.taskPy=b.AppFacade.getInstance().retrieveProxy(b.TaskPy.N),e||(e={type:0}),t.allLayerNum=0;var i,n=t.guajiPy.allLayersInfo[e.type];return n&&(t.allLayerNum=n.length),t.allLayerNum||(t.allLayerNum=1),t}return __extends(e,l),e.prototype.childrenCreated=function(){var i=this;l.prototype.childrenCreated.call(this);var e=b.Config.risk();this.params.type==this.guajiPy.localType?this.updateMap(e[this.guajiPy.curLayerInfo.position.layerId].chapterId):this.updateMap(e[this.guajiPy.lastCurLayerId[this.params.type]||1].chapterId),this.img_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this);for(var t=function(t){n["gate_"+t].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=b.Config.risk();e[i.allLayerNum+1]?t<=e[i.allLayerNum+1].chapterId?i.nowLay!=t&&i.updateMap(t):Utils.MsgUtils.addMidMsg("当前章节尚未解锁"):t<=e[i.allLayerNum].chapterId?i.nowLay!=t&&i.updateMap(t):Utils.MsgUtils.addMidMsg("敬请期待")},n)},n=this,o=1;o<6;o++)t(o);var a=new eui.Image;a.source="common_img_guangboditiao_png",this.gp_map.addChild(a),a.x=this.img_close.x-550,a.y=40,a.width=270;var r=new eui.Label;r.size=20,r.textColor=16777215,this.gp_map.addChild(r),r.text="标记有",r.x=this.img_close.x-550,r.y=50;var s=new eui.Image;s.source="_border_m_json.common_icon_xingji",this.gp_map.addChild(s),s.scaleX=.5,s.scaleY=.5,s.x=this.img_close.x-490,s.y=45;var c=new eui.Label;c.size=20,c.textColor=16777215,this.gp_map.addChild(c),c.text="的地图已100%探索",c.x=this.img_close.x-465,c.y=50},e.prototype.updateMap=function(g){var f=this;this.nowLay=g;var _=b.Config.risk(),m=b.Config.riskLayer(),y=new eui.Image,v=!0;y.source="mx_img_dizuo_png",this.layerList=[],this.gp_gate.visible=!_[this.allLayerNum+1]||1<_[this.allLayerNum+1].chapterId;for(var T=this.params&&this.params.type||0,e=1;e<6;e++)this["gate_"+e].source=1<e&&e<5?e==g?"maoxian_btn_yeqianl02_png":"maoxian_btn_yeqiana02_png":e==g?"maoxian_btn_yeqianl01_png":"maoxian_btn_yeqiana01_png",this["gate_lab_"+e].source=e==g?this.GATE_LAB[e].down:this.GATE_LAB[e].up;this.gp_unlock.removeChildren();var C=this.guajiPy.allLayersInfo[this.params.type];for(var t in C){var i=C[t],n=i.layerId,o=i.clear;if(i.isGot&&o){var a=(Number(n)-20*(this.nowLay-1))%2e4;if(this["lb_"+a]){var r=new eui.Image;r.source="_border_m_json.common_icon_xingji",r.x=this["lb_"+a].x-40,r.y=this["lb_"+a].y-15,this.gp_unlock.addChild(r),r.scaleX=.85,r.scaleY=.85}}}var s=function(e){if(_[e].type!=T)return"continue";if(_[e].chapterId==g){var i=Number(e)%2e4-20*(g-1);E["gp_line_"+i]&&(E["gp_line_"+i].visible=!1),E["map_"+i].pixelHitTest=!0,E["map_"+i].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0==m[_[e].layerId].isOpen?(Utils.MsgUtils.addMidMsg("暂未开放，敬请期待"),f["map_"+i].scaleX=f["map_"+i].scaleY=1):(-1!=f.layerList.indexOf(String(i+2e4*T+20*(f.nowLay-1)))?f.opperationParams=i+2e4*T+20*(f.nowLay-1):f.py.playerInfoVO.level<m[_[e].layerId].unlockLevel?PopUpManager.addPopUp({obj:new b.LackExpView,closeCB:function(e){e&&f.hide()}}):Utils.MsgUtils.addMidMsg("当前关卡尚未解锁"),f.hide())},E),E["map_"+i].addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){f["map_"+i].scaleX=f["map_"+i].scaleY=1.1},E),E["map_"+i].addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){f["map_"+i].scaleX=f["map_"+i].scaleY=1},E),E["gp_effect_"+i].removeChildren(),E["gp_effect_"+i].x=0,E["gp_effect_"+i].y=0,E["gp_effect_"+i].visible=!1;E.taskPy.getCurGuideTask(0==E.params.type?TaskType.Guide:TaskType.DifficultyGuide);var t=Number(m[_[e].layerId].taskUnlock);E.isSure=!t;var n=0==E.params.type?E.taskPy.TaskDone[TaskType.Guide]:E.taskPy.TaskDone[TaskType.DifficultyGuide]||[];for(var o in n){n[o].code==t&&(E.isSure=!0)}E["map_"+i].touchEnabled=E.guajiPy.curLayerInfo.position.layerId!=m[_[e].layerId].id,UIActionManager.setAbsGrey(E["map_"+i],!1);var a=b.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.Risk,{id:e});if(v)if(E.py.playerInfoVO.level<m[_[e].layerId].unlockLevel||m[_[e].layerId].id%2e4>E.allLayerNum+1||!E.isSure||a.isBelonged&&!a.unlock||0==m[_[e].layerId].isOpen){E["lb_"+i].text=_[e].name;var r=new eui.Image,s=new eui.Image,c=new eui.Label;s.source="_guaji_m_json.mx_img_mingchengdi",r.source="maoxian_img_suo_png",UIActionManager.setAbsGrey(E["map_"+i]),r.scaleX=r.scaleX=.9,r.x=E["lb_"+i].x-31,r.y=E["lb_"+i].y-10,s.x=E["lb_"+i].x-28,s.y=E["lb_"+i].y+22,c.size=17,c.textColor=16187392,E.gp_unlock.addChild(r),E.gp_unlock.addChild(s);var l=function(){0==m[_[e].layerId].isOpen?(c.text="(暂未开放，敬请期待)",c.x=s.x-20,c.y=s.y+5,s.width=c.width+50,s.x=s.x-43):f.py.playerInfoVO.level<m[_[e].layerId].unlockLevel?(c.text="("+m[_[e].layerId].unlockLevel+"级后解锁)",c.x=s.x+23,c.y=s.y+5,s.width=c.width+50):m[_[e].layerId].id%2e4>f.allLayerNum+1?(c.text="(通过前一关解锁)",c.x=s.x,c.y=s.y+5,s.width=c.width+50,s.x=s.x-23):f.isSure||(c.text="(完成当前地图任务解锁)",c.x=s.x-20,c.y=s.y+5,s.width=c.width+50,s.x=s.x-43)};a.isBelonged?a.unlock?l():(c.text="(封印之地解锁)",c.x=s.x,c.y=s.y+5,s.width=c.width+50,s.x=s.x-23):l(),E.gp_unlock.addChild(c),v=!1}else{1<Number(i)&&(E["gp_line_"+_[Number(i)-1].layerId].visible=!0),E["lb_"+i].text=_[e].name,E.layerList.push(e);var h=C[Number(e)%2e4-1];if(h)if(100!=h.progress){var p=new eui.Image,d=new eui.Label;p.source="_guaji_m_json.mx_img_mingchengdi",p.x=E["lb_"+i].x-28,p.y=E["lb_"+i].y+22,d.size=20,d.textColor=16777215,d.text="探索度"+h.progress+"%",d.x=E["lb_"+i].x+2,d.y=E["lb_"+i].y+25,p.width=d.width+50,E.gp_unlock.addChild(p),E.gp_unlock.addChild(d)}else h.isGot||(E["gp_effect_"+i].visible=!0,E["gp_effect_"+i].touchEnabled=!0,E["gp_effect_"+i].x=50+E["lb_"+i].x+E["lb_"+i].width/2,E["gp_effect_"+i].y=E["lb_"+i].y-5,E["gp_effect_"+i].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){DragonBoneTools.playOnce({effectName:"common_baoxiangkai",parent:f["gp_effect_"+i],x:f["gp_effect_"+i].width/2,y:f["gp_effect_"+i].height/2,scaleX:.7,scaleY:.7,doneCB:function(){f.guajiPy.GetProgressReward(h.uuid,function(){h.isGot=!0,f["gp_effect_"+i].removeChildren(),f["gp_effect_"+i].visible=!1;var e=new eui.Image;e.source="_border_m_json.common_icon_xingji",e.x=f["lb_"+i].x-40,e.y=f["lb_"+i].y-15,f.gp_unlock.addChild(e),e.scaleX=.85,e.scaleY=.85;var t=b.GameMVC.guajiMed.getSubView(b.GuajiMediator.SV.MAIN);t&&h.layerId==b.GameMVC.guajiPy.curLayerInfo.position.layerId&&t.updateProgress(b.GameMVC.guajiPy.riskProgress)},f.params.type)}})},E),DragonBoneTools.create("common_baoxiang_5",function(e){e.x=this["gp_effect_"+i].width/2,e.y=this["gp_effect_"+i].height/2,e.scaleX=e.scaleY=.7,e.animation.play(),this["gp_effect_"+i].addChild(e)},E))}else E["lb_"+i].text="",UIActionManager.setAbsGrey(E["map_"+i]);if(E.guajiPy.curLayerInfo.position.layerId==m[_[e].layerId].id){var u=new customui.RoleDynamicModel;u.scaleX=u.scaleY=.7,u.update({reqStyle:ROLE_STYLE.Fashion}),u.x=E["lb_"+i].x+42,u.y=E["lb_"+i].y-16,y.x=E["lb_"+i].x+25,y.y=E["lb_"+i].y-28,E.gp_unlock.addChild(y),E.gp_unlock.addChild(u)}}},E=this;for(var c in _)s(c);this.checkNeedExp()},e.prototype.select=function(){},e.prototype.checkNeedExp=function(){var t=this,e=b.AppFacade.getInstance().retrieveProxy(b.PlayerPy.N).playerInfoVO.level,i=!1;if(e<parseInt(b.Config.constConfig().ExpHintMaxLevel.constValue)){var n=this.taskPy.getCurGuideTask(0==this.params.type?TaskType.Guide:TaskType.DifficultyGuide);if(n){var o=parseInt(this.layerList[this.layerList.length-1]),a=b.Config.riskLayer(),r=0;for(var s in a){if((d=a[s]).taskUnlock==n.code){r=d.id;break}}if(0<=this.layerList.indexOf(r.toString));else{var c=b.Config.riskLayer()[o+1],l=c.taskUnlock,h=!1,p=0==this.params.type?this.taskPy.TaskDone[TaskType.Guide]:this.taskPy.TaskDone[TaskType.DifficultyGuide];if(p)for(var s in p){var d;(d=p[s]).code==l&&(h=!0)}h&&c&&e<c.unlockLevel&&1==c.isOpen&&(i=!0)}}}i&&PopUpManager.addPopUp({obj:new b.LackExpView,closeCB:function(e){e&&t.hide()}})},e}(BasePanel);b.GuajiGateListPanel=o,__reflect(o.prototype,"game.GuajiGateListPanel")}(game||(game={})),function(n){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},t.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},t.prototype.onTrigger=function(e,t){var i=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new n.EpGuessSizeView({vo:i.vo}),closeCB:function(e){n.EventPoint.lastTriggerTime=0}})}):t&&t()},t}(n.EventPoint);n.EPGuessSize=e,__reflect(e.prototype,"game.EPGuessSize")}(game||(game={})),function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.gp_foot.touchEnabled=!1,this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.source=this.params.hinderImg},t.prototype.onDataChange=function(){},t.prototype.onTrigger=function(e,t){t&&t()},t}(e.EventPoint);e.EPHinder=t,__reflect(t.prototype,"game.EPHinder")}(game||(game={})),function(i){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.manorId=0,this.gp_effect.touchEnabled=!1,this.gp_effect.bottom=40,this.img_icon.visible=!1,this.img_player=new eui.Image,this.img_player.horizontalCenter=-40,this.img_player.bottom=-5,this.img_player.source="item_icon_renshu_png",this.img_player.scaleX=.4,this.img_player.scaleY=.4,this.addChild(this.img_player),this.img_special=new eui.Image,this.img_special.horizontalCenter=60,this.img_special.bottom=65,this.img_special.source="mxkc_img_chaoji_png",this.img_special.scaleX=.8,this.img_special.scaleY=.8,this.addChild(this.img_special),this.img_special.visible=!1,this.ep_collect=new eui.Group,this.ep_collect.horizontalCenter=20,this.ep_collect.bottom=120,this.addChild(this.ep_collect),MovieClipTools.create("common_caijizhong",function(e){e.visible=!0,e.scaleX=e.scaleY=.9,e.x=this.ep_collect.width/2,e.y=this.ep_collect.height/2,e.animation.play("common_caijizhong",0),this.ep_collect.addChild(e)},this),this.ep_collect.visible=!1,this.ep_box=new eui.Group,this.ep_box.horizontalCenter=0,this.ep_box.bottom=160,this.ep_box.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("点击 收取  manorID:"+this.vo.info.manorId+" "),this.manorPy.AccountRewards()},this),this.addChild(this.ep_box),MovieClipTools.create("common_baoxiang_5",function(e){e.visible=!0,e.scaleX=e.scaleY=.9,e.x=this.ep_box.width/2,e.y=this.ep_box.height/2,e.animation.play("common_baoxiang_5",0),this.ep_box.addChild(e)},this),this.ep_box.visible=!1,this.ep_guild=new eui.Group,this.ep_guild.touchEnabled=!1,this.ep_guild.width=63,this.ep_guild.height=78,this.ep_guild.horizontalCenter=-40,this.ep_guild.bottom=20,this.addChild(this.ep_guild),this.img_guild_qizi=new eui.Image,this.img_guild_qizi.horizontalCenter=0,this.img_guild_qizi.source="mxkc_img_qi1_png",this.ep_guild.addChild(this.img_guild_qizi),this.lb_guild_name=new eui.Label,this.lb_guild_name.top=26,this.lb_guild_name.horizontalCenter=0,this.lb_guild_name.height=20,this.lb_guild_name.width=36,this.lb_guild_name.textAlign="center",this.lb_guild_name.textColor=16774314,this.lb_guild_name.size=16,this.lb_guild_name.text="",this.lb_guild_name.bold=!0,this.ep_guild.addChild(this.lb_guild_name),this.manorPy=i.AppFacade.getInstance().retrieveProxy(i.ManorProxy.N)},t.prototype.updateData=function(){this.onDataChange()},t.prototype.onDataChange=function(){if(this.c=i.Config.manor()[this.vo.info.id],this.c){0,this.manorEntity=this.manorPy.queryManoeEntityByManorId(this.vo.info.manorId),this.setGuildQiZi(this.manorEntity.isSameGuild,this.manorEntity.guildName),this.lb_tips.text=this.manorEntity.num+"/"+this.c.num;var e=!1;if(0==this.manorId?e=!0:0!=this.vo.info.manorId&&this.manorId!=this.vo.info.manorId&&(e=!0),e&&(this.gp_effect.removeChildren(),this.c.model&&(MovieClipTools.create(this.c.model,function(e){e.visible=!0,e.scaleX=e.scaleY=1,e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2,e.animation.play(this.c.model,0),this.gp_effect.addChild(e,3)},this),this.manorEntity.isSpecial))){var t="risk_event_kuangshits";MovieClipTools.create(t,function(e){e.visible=!0,e.scaleX=e.scaleY=1,e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2,e.animation.play(t,0),this.gp_effect.addChildAt(e,5)},this)}this.manorId=this.vo.info.manorId,this.img_special.visible=this.manorEntity.isSpecial,this.updateCollect()}else egret.warn("找不到配置",this.vo.info.id)},t.prototype.setGuildQiZi=function(e,t){""!=t?(this.lb_guild_name.text=t,this.img_guild_qizi.source=e?"mxkc_img_qi1_png":"mxkc_img_qi2_png",this.lb_guild_name.visible=!0,this.img_guild_qizi.visible=!0):(this.lb_guild_name.visible=!1,this.img_guild_qizi.visible=!1)},t.prototype.checkNotice=function(){return!this.vo.info.captured},t.prototype.onTrigger=function(e,t){this.checkTriggerCD()?i.AppFacade.getInstance().showSubView(i.ManorMediator.N,i.ManorMediator.SV.DETAIL,{vo:this.vo}):t&&t()},t.prototype.onDestroy=function(){e.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer)},t.prototype.updateCollect=function(){this.manorPy.selfEntity&&this.manorPy.selfEntity.manorId&&this.manorPy.selfEntity.manorId==this.vo.info.manorId?(this.manorPy.selfEntity.rewards&&this.manorPy.selfEntity.rewards[0]?this.ep_box.visible=!0:this.ep_box.visible=!1,this.ep_collect.visible=!0):(this.ep_collect.visible=!1,this.ep_box.visible=!1)},t}(i.EventPoint);i.EPManor=e,__reflect(e.prototype,"game.EPManor")}(game||(game={})),function(o){var e=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.img_icon&&egret.Tween.removeTweens(e.img_icon)},this)},e.prototype.onDataChange=function(){var t=this;this.c=o.Config.riskMaze()[this.vo.info.id],this.c?(this.lb_tips.text=this.c.name,RES.getResAsync("_guaji_m_json.bd_rukou_02",function(e){t.img_icon.source=e,t.img_icon.anchorOffsetX=e.textureWidth/2,t.img_icon.anchorOffsetY=e.textureHeight/2,i.prototype.addEffect.call(t)},this),this.vo.info.clear?(this.img_passed=new eui.Image("maoxian_txt_ytg_png"),this.img_passed.bottom=100,this.img_passed.horizontalCenter=0,this.addChild(this.img_passed)):this.img_passed&&this.img_passed.parent&&this.img_passed.parent.removeChild(this.img_passed),i.prototype.addEffect.call(this)):egret.warn("找不到配置",this.vo.info.id)},e.prototype.onTrigger=function(t,i){var n=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({closeCB:function(e){1==e?(n.py.TriggerEvent(n.vo.position,void 0,void 0,n.doneStoryId),t&&t()):i&&i(),o.EventPoint.lastTriggerTime=0},obj:new o.EPFortressView({config:n.c,vo:n.vo})})}):i&&i()},e}(o.EventPoint);o.EPMaze=e,__reflect(e.prototype,"game.EPMaze")}(game||(game={})),function(r){var e=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this)},e.prototype.onDataChange=function(){var e=this;if(this.c=r.Config.riskMine()[this.vo.info.id],this.c){this.lb_tips.text=this.c.name,i.prototype.makeDefaultIcon.call(this)||(this.img_icon.source=r.GeneralConfig.getGuajiImg(this.c.icon)[1]);var t=this.c.type;this.vo.info.captured&&!this.effect1&&(MovieClipTools.create("kuangren_2",function(e){this.effect1=e,this.effect1.visible=!0,2==t||4==t?(this.effect1.y=this.img_icon.height/2-40,this.effect1.x=this.img_icon.width-10):(this.effect1.x=this.img_icon.width,this.effect1.y=this.img_icon.height/2-30),this.effect1.animation.timeScale=.6,this.effect1.animation.play("kuangren_2",-1),this.addChild(this.effect1)},this),this.effect2||egret.setTimeout(function(){MovieClipTools.create("kuangren_1",function(e){this.effect2=e,this.effect2.visible=!0,this.effect2.x=25,this.effect2.y=this.img_icon.height/2-30,this.effect2.scaleX=-1,this.effect2.animation.timeScale=.6,this.effect2.animation.play("kuangren_1",-1),this.addChild(this.effect2)},e)},this,380),this.timer&&egret.clearInterval(this.timer))}else egret.warn("找不到配置",this.vo.info.id)},e.prototype.checkNotice=function(){return!this.vo.info.captured},e.prototype.onTrigger=function(t,i){var n=this;this.checkTriggerCD()?PopUpManager.addPopUp({closeCB:function(e){1==e?(n.vo.info.captured||(n.py.setAfterFightAutoGoCurEPStory(n.doneStoryId,!0),r.CommonMediator.RewardCloseCallBack=function(e){e.result==EBattleResult.EBattleResultWin&&n.onTrigger()}),n.py.TriggerEvent(n.vo.position),t&&t()):i&&i(),r.EventPoint.lastTriggerTime=0},obj:new r.EpMineView({config:this.c,vo:this.vo})}):i&&i()},e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer)},e}(r.EventPoint);r.EPMine=e,__reflect(e.prototype,"game.EPMine");var t=function(i){function e(e){var t=i.call(this)||this;return t.guajiPy=r.AppFacade.getInstance().retrieveProxy(r.GuajiPy.N),t.skinName="GuajiMineDetaiPanellSkin",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.inButton(),this.updateView()},e.prototype.inButton=function(){var e=this;this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.opperationParams=1,e.hide(),r.AppFacade.getInstance().sendNotification(CN.GUAJI_UPDATE_MINE)},this),this.commonTanKuang.blb_title.text="资源矿洞",this.commonTanKuang.onCloseCB=function(){e.hide()}},e.prototype.updateView=function(){var i=this,n=this.params.config,o=this.params.vo;this.lb_desc.text=n.desc,this.img_icon.source=n.icon;var a=JSON.parse(n.rewards)[0],e=r.GeneralConfig.getEntityConfigByCode(a[0],a[1]);e&&(this.img_speed.source=ResourceUtils.png(e.icon),this.img_speed_right.source=ResourceUtils.png(e.icon)),this.lb_speed.text="+"+a[2]+"/"+n.interval+"秒";var t=this.params.vo.position;this.guajiPy.GetMineInfo({pos:{x:t.x,y:t.y},cb:function(){var e=i.guajiPy.minesInfo[0];if(e){var t=0<e.rewards.length?e.rewards[0].num.toString():"0";i.lb_speed_right.text=t+"/"+n.upLimit/n.interval*a[2],o.mineInfo.captured?(i.btn_ok.visible=0<e.rewards.length,i.btn_got.visible=e.rewards.length<=0,i.btn_ok.skinName="skins.ButtonSkinGreen",i.btn_ok.label="领 取",i.btn_status.visible=!1):(i.btn_ok.skinName="skins.ButtonSkinRed",i.btn_ok.label="战 斗",i.btn_status.label="未占领",i.btn_status.visible=!0)}else i.lb_speed_right.text="0"},ispush:!1})},e}(BasePanel);__reflect(t.prototype,"GuajiMineDetaiPanell")}(game||(game={})),function(n){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.aStarCost=1e5,this.img_shadow=new eui.Image,this.img_shadow.source="_guaji_m_json.yingxion_img_touying",this.img_shadow.bottom=-20,this.img_shadow.horizontalCenter=0,this.img_shadow.scaleX=this.img_shadow.scaleY=.6,this.gp_foot.addChild(this.img_shadow)},e.prototype.onDataChange=function(){var e=n.Config.riskEvent()[this.vo.eventId];t.prototype.makeDefaultIcon.call(this)||(this.cu_model=new customui.HeroDynamicModel,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=.32,this.gp_foot.addChild(this.cu_model),this.cu_model.update({isStatic:!0,model:JSON.parse(e.detail)[2]}),t.prototype.addEffect.call(this))},e.prototype.onTrigger=function(e,t){var i=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new n.StoryView({storyId:i.vo.info.storyId,questionId:void 0,position:void 0,cb:function(){i.py.TriggerEvent(i.vo.position,void 0,void 0,i.doneStoryId),e&&e()}}),closeCB:function(e){n.EventPoint.lastTriggerTime=0}})}):t&&t()},e}(n.EventPoint);n.EPNpc=e,__reflect(e.prototype,"game.EPNpc")}(game||(game={})),function(o){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},t.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},t.prototype.onTrigger=function(t,i){var n=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new o.EpPuzzleView({vo:n.vo}),closeCB:function(e){e?(n.py.TriggerEvent(n.vo.position,"1"),t&&t()):i&&i(),o.EventPoint.lastTriggerTime=0}})}):i&&i()},t}(o.EventPoint);o.EPPuzzle=e,__reflect(e.prototype,"game.EPPuzzle")}(game||(game={})),function(o){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.aStarCost=1e5,this.img_shadow=new eui.Image,this.img_shadow.source="_guaji_m_json.yingxion_img_touying",this.img_shadow.bottom=-20,this.img_shadow.horizontalCenter=0,this.img_shadow.scaleX=this.img_shadow.scaleY=.6,this.gp_foot.addChild(this.img_shadow)},e.prototype.onDataChange=function(){if(this.c=o.Config.riskQuora()[this.vo.info.id],this.c){var e=t.prototype.makeDefaultIcon.call(this);e||(1==(e=o.GeneralConfig.getGuajiImg(this.c.model))[0]?(this.img_icon.source=e[1],this.img_icon.visible=!0):2==e[0]&&(this.cu_model=new customui.HeroDynamicModel,this.cu_model.update({model:e[1],isStatic:!0}),this.cu_model.touchEnabled=!1,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=.32,this.gp_foot.addChild(this.cu_model))),t.prototype.addEffect.call(this)}},e.prototype.onTrigger=function(t,e){if(this.checkTriggerCD())if(this.c){var i=o.Config.riskEvent()[this.vo.eventId],n=(JSON.parse(this.c.questions)[this.vo.info.count],i.story?JSON.parse(i.story)[0]:void 0);n&&JSON.parse(o.Config.storyConfig()[n].subs);PopUpManager.addPopUp({obj:new o.EpQuoraView({vo:this.vo,cb:function(e){t&&t()}}),closeCB:function(e){o.EventPoint.lastTriggerTime=0}})}else Utils.MsgUtils.addMidMsg("找不到答题配置");else e&&e()},e}(o.EventPoint);o.EPQuora=e,__reflect(e.prototype,"game.EPQuora")}(game||(game={})),function(o){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},t.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},t.prototype.onTrigger=function(t,i){var n=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new o.EpSameCardView({vo:n.vo}),closeCB:function(e){e?(n.py.TriggerEvent(n.vo.position,"1"),t&&t()):i&&i(),o.EventPoint.lastTriggerTime=0}})}):i&&i()},t}(o.EventPoint);o.EPSameCard=e,__reflect(e.prototype,"game.EPSameCard")}(game||(game={})),function(o){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},t.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},t.prototype.onTrigger=function(t,i){var n=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new o.EpSelectView({vo:n.vo}),closeCB:function(e){e?(n.py.TriggerEvent(n.vo.position,String(e)),t&&t()):i&&i(),o.EventPoint.lastTriggerTime=0}})}):i&&i()},t}(o.EventPoint);o.EPSelect=e,__reflect(e.prototype,"game.EPSelect")}(game||(game={})),function(u){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this)},t.prototype.onDataChange=function(){var t=this,e=void 0;this.vo.type==RiskEventType.Shop||this.vo.type==RiskEventType.MysticalShop?(e="_guaji_m_json.bd_shangdian_01",this.vo.info.type==RiskShopType.Normal?this.lb_tips.text="神秘商店":this.lb_tips.text="刷新商店"):(e="_guaji_m_json.bd_jiuguan_01",this.vo.info.type==RiskShopType.Normal?this.lb_tips.text="酒馆":this.lb_tips.text="刷新酒馆"),RES.getResAsync(e,function(e){t.img_icon.source=e,t.img_icon.anchorOffsetX=e.textureWidth/2,t.img_icon.anchorOffsetY=e.textureHeight/2},this),this.popView&&this.popView.updateView(this.vo)},t.prototype.onTrigger=function(t,e){var i=this;this.log("risk当前商店类型"+this.vo.type+"，"+this.vo.info.type),this.checkTriggerCD()?this.handleStory(void 0,function(){i.vo.info.type==RiskShopType.Refresh?i.popView=new r({eventVO:i.vo}):i.vo.type==RiskEventType.Shop?i.popView=new n({eventVO:i.vo}):i.vo.type==RiskEventType.MysticalShop?i.popView=new o({eventVO:i.vo}):i.popView=new a({eventVO:i.vo}),i.py.TriggerEvent(i.vo.position,void 0,function(){u.AppFacade.getInstance().retrieveProxy(u.GuajiPy.N).doneStoryId=i.doneStoryId,i.viewShowed=!0,PopUpManager.addPopUp({obj:i.popView,closeCB:function(e){i.viewShowed=!1,t&&t(),u.EventPoint.lastTriggerTime=0}})})}):e&&e()},t.prototype.onDestroy=function(){this.popView&&this.popView.hide()},t}(u.EventPoint);u.EPShop=e,__reflect(e.prototype,"game.EPShop");var n=function(i){function e(e){var t=i.call(this)||this;return t.heroData={code:41100018,model:"hero_018_03",isStatic:!0},t.skinName="GuajiShangdianViewSkin",t.py=u.AppFacade.getInstance().retrieveProxy(u.GuajiPy.N),t.eventVO=e.eventVO,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.hero_model.update(this.heroData)},e.prototype.adapterShopItems=function(){var e=new eui.HorizontalLayout;e.gap=50,1<this.eventVO.info.items.length?(e.horizontalAlign=egret.HorizontalAlign.LEFT,e.paddingLeft=25,e.paddingRight=25):e.horizontalAlign=egret.HorizontalAlign.CENTER,this.gp_items.layout=e},e.prototype.updateView=function(e){var p=this;e&&(this.eventVO=e),this.gp_items.removeChildren(),this.adapterShopItems();var d=u.Config.shop();this.eventVO.info.items.forEach(function(t){var e=d[t.id],i=JSON.parse(e.reward)[0],n=new eui.Group;n.width=112,n.height=185;var o=new eui.Image("mx_img_heiying_png");o.x=-14,o.y=0;var a=customui.BaseItemFactory.create(21);a.updateData({type:i[0],code:i[1],num:i[2]}),a.y=10,a.x=(n.width-a.width)/2;var r=new eui.Button;r.skinName="skins.ButtonSkinYellow2";var s=JSON.parse(e.costs)[0];r.label="  "+Utils.MathUtils.formatNumStyle1(s[2]);var c=u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N).getInfoByCode(s[1]);r.icon=ResourceUtils.png(c.info.icon),r.iconDisplay.scaleX=r.iconDisplay.scaleY=.35,r.x=-1,r.y=n.height-r.height;var l=new eui.Image;l.source="common_img_biaoqian_yigoumai_png",l.x=12,l.y=(n.height-l.height)/2-40,l.visible=!1;var h=u.AppFacade.getInstance().retrieveProxy(u.ShopPy.N).getMaxNum(t.id);t.num>=h&&(l.visible=!0,r.touchEnabled=!1,UIActionManager.setGrey(r),UIActionManager.setGrey(a)),r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=u.AppFacade.getInstance().retrieveProxy(u.GuajiPy.N);p.py.ShopBuy(t.grid,1,p.eventVO.position,function(){e.goCurEPStory(function(){p.parent&&p.updateView(p.eventVO)})})},p),n.addChild(o),n.addChild(a),n.addChild(r),n.addChild(l),p.gp_items.addChild(n)})},e}(BasePanel);__reflect(n.prototype,"GuajiShangdianView");var o=function(i){function e(e){var t=i.call(this)||this;return t.heroData={code:41100018,isStatic:!0},t.skinName="GuajiMysticalShopViewSkin",t.py=u.AppFacade.getInstance().retrieveProxy(u.GuajiPy.N),t.eventVO=e.eventVO,t}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_discount,egret.TouchEvent.TOUCH_TAP,function(){u.GameMgr.getInstance().showCommonTipsWin({commonTips:"购买终生卡可享受神秘商店额外3折优惠",btnStyle:{cancel:u.CommonTipsDialog.BTN_STYLE.CANCEL,confirm:u.CommonTipsDialog.BTN_STYLE.GOTO},clickCB:function(e){1==e.type&&(t.hide(),u.GameMVC.activityMed.showViewByCode(EActivityType.MonthCard))}})},this)},e.prototype.updateView=function(e){var r=this;e&&(this.eventVO=e);var s=u.GameMVC.activityPy.hasWholeLifeCard();UIActionManager.setAbsGrey(this.btn_discount,!s),this.btn_discount.enabled=!s;var t=Utils.SDKMgr.getPerformConfig(1)&&Utils.SDKMgr.getPerformConfig(21);this.btn_discount.visible=!t,this.lb_discount.visible=!t&&!s;var c=u.Config.shop(),l=u.Config.itemConfig();this.gp_items.removeChildren();var h=0;this.eventVO.info.items.forEach(function(e){var t=c[e.id],i={data:t,buyNum:e.num,grid:e.grid,hasWholeLifeCard:u.GameMVC.activityPy.hasWholeLifeCard(),hideDiscount:!0,buyFunc:function(){var t=function(){r.py.ShopBuy(e.grid,1,r.eventVO.position,function(){u.GameMVC.guajiPy.goCurEPStory(function(){r.parent&&r.updateView(r.eventVO)})})};s?t():u.GameMgr.getInstance().showCommonTipsWin({commonTips:"购买终生卡可享受3折优惠，\n是否前往购买？",btnStyle:{confirm:{text:"前往开卡",skin:"skins.ButtonSkinYellow"},cancel:{text:"我意已决",skin:"skins.ButtonSkinGreen"}},clickCB:function(e){e.type?(r.hide(),u.GameMVC.activityMed.showViewByCode(EActivityType.MonthCard)):t()}})}},n=new u.ShopUIItem(i);r.gp_items.addChild(n);var o=JSON.parse(t.reward)[0][1],a=JSON.parse(l[o].effect);h=a.length&&a[0][0]===EEntityType.EEntityTypeHero&&a[0][1]||0}),h&&(this.heroData.code=h),this.hero_model.update(this.heroData),this.timer||(this.timerDt=this.eventVO.dt-Utils.TimerManager.getServerTime(),this.blb_time.text=Utils.TimerManager.getFormatBySecond1(this.timerDt),this.timer=egret.setInterval(function(){0<r.timerDt?r.blb_time.text=Utils.TimerManager.getFormatBySecond1(--r.timerDt):r.hide()},this,1e3))},e.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},e}(BasePanel);__reflect(o.prototype,"GuajiMysticalView");var a=function(i){function e(e){var t=i.call(this)||this;return t.curIndex=0,t.skinName="GuajiJiuGuanViewSkin",t.py=u.AppFacade.getInstance().retrieveProxy(u.GuajiPy.N),t.eventVO=e.eventVO,t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.btn_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.curIndex-1<0&&(e.curIndex=e.eventVO.info.items.length),e.curIndex--,e.updateSelected()},this),this.btn_right.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.curIndex+1>=e.eventVO.info.items.length&&(e.curIndex=-1),e.curIndex++,e.updateSelected()},this),this.btn_detail.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.curHeroCode&&u.AppFacade.getInstance().showSubView(u.HeroMediator.N,u.HeroMediator.SV.HERO_DETAIL,{code:e.curHeroCode})},this),this.btn_oppr.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.AppFacade.getInstance().retrieveProxy(u.GuajiPy.N).goCurEPStory(function(){e.py.ShopBuy(e.items[e.curIndex].grid,1,e.eventVO.position,function(){})})},this),this.cu_tk.img_title_bg.visible=this.cu_tk.btn_close.visible=!1},e.prototype.updateSelected=function(){if(this.items[this.curIndex]){var e=u.Config.shop()[this.items[this.curIndex].id];if(e){var t=JSON.parse(e.reward)[0],i=u.GeneralConfig.getEntityConfigByCode(t[0],t[1]);i&&(this.curHeroCode=i.code,this.lb_name.text=i.name,this.lb_desc.text=i.desc,this.img_type.source=ProfessionConfig[i.profession].icon,this.cu_hdm.update({isStatic:!0,model:i.model}),this.cu_iwn.updateItem({cost:JSON.parse(e.costs)[0],style:CommonIconStyle.RIGHT}))}}},e.prototype.updateView=function(e){e&&(this.eventVO=e),this.items=this.eventVO.info.items,this.btn_right.visible=this.btn_left.visible=1<this.items.length,this.updateSelected()},e}(BasePanel);__reflect(a.prototype,"GuajiJiuGuanView");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="EPShopItemRenderSkin",e}return __extends(e,t),e}(u.ShopUIItem2);__reflect(t.prototype,"EPShopItemRender");var r=function(i){function e(e){var t=i.call(this)||this;return t.skinName="Guaji9PatchShopViewSkin",t.py=u.AppFacade.getInstance().retrieveProxy(u.GuajiPy.N),t.eventVO=e.eventVO,t}return __extends(e,i),e.prototype.onDestroy=function(){this.scheCountLeft&&(egret.clearInterval(this.scheCountLeft),this.scheCountLeft=void 0)},e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.eventVO.type==RiskEventType.Shop?this.cu_tk.blb_title.text="商店":this.cu_tk.blb_title.text="酒馆",this.cu_tk.onCloseCB=function(){e.hide()},this.initUI(),this.updateView()},e.prototype.initUI=function(){this.list_items.itemRenderer=t,this.collect=new eui.ArrayCollection,this.list_items.dataProvider=this.collect},e.prototype.updateSche=function(){var t=this;this.eventVO.info.type==RiskShopType.Refresh?(this.refreshShopRefreshDt=this.eventVO.info.interval,this.scheCountLeft||(this.scheCountLeft=egret.setInterval(function(){t.lb_time.visible||(t.lb_time.visible=!0);var e=t.refreshShopRefreshDt-(Utils.TimerManager.getServerTime()-t.eventVO.info.lastUpdateDt);0<e?t.lb_time.text=Utils.TimerManager.getFormatBySecond1(e):(t.lb_time.visible=!1,egret.clearInterval(t.scheCountLeft),t.scheCountLeft=void 0,t.py.GetLayerInfo())},this,1e3))):this.lb_time.visible=!1},e.prototype.updateList=function(){var o=this,e=u.Config.shop(),t=this.eventVO.info.items;this.collect.removeAll();for(var i=0,n=t;i<n.length;i++){var a=n[i],r=e[a.id];r?this.collect.addItem({data:r,vo:a,grid:a.grid,isPopup:r.isPopup,buyNum:a.num,customCB:function(e,t,i,n){u.AppFacade.getInstance().retrieveProxy(u.GuajiPy.N).goCurEPStory(function(){o.py.ShopBuy(n,i,o.eventVO.position,function(){})})}}):egret.warn("找不到配置",a.id)}},e.prototype.updateView=function(e){var t=this;e&&(this.eventVO=e),this.updateSche(),this.once(egret.Event.ENTER_FRAME,function(){t.updateList()},this)},e}(BasePanel);__reflect(r.prototype,"Guaji9PatchShopView")}(game||(game={})),function(o){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},t.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},t.prototype.onTrigger=function(t,i){var n=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new o.EpSieveView({vo:n.vo}),closeCB:function(e){e?(n.py.TriggerEvent(n.vo.position,String(e)),t&&t()):i&&i(),o.EventPoint.lastTriggerTime=0}})}):i&&i()},t}(o.EventPoint);o.EPSieve=e,__reflect(e.prototype,"game.EPSieve")}(game||(game={})),function(i){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.aStarCost=1e5,this.img_shadow=new eui.Image,this.img_shadow.bottom=-20,this.img_shadow.horizontalCenter=0,this.img_shadow.scaleX=this.img_shadow.scaleY=.6,this.gp_foot.addChild(this.img_shadow),DragonBoneTools.playOnce({effectName:"common_fbzcguaichuxian",parent:this.gp_foot})},e.prototype.onDataChange=function(){if((this.c=i.Config.stormWarCreep()[this.vo.info.creepCode],this.c)&&(t.prototype.makeDefaultIcon.call(this)?this.img_icon.visible=!0:(this.cu_model=new customui.HeroDynamicModel,this.cu_model.touchEnabled=!1,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=.32,this.gp_foot.addChild(this.cu_model),this.cu_model.update({isStatic:!0,model:this.c.model})),0==this.c.difficulty||1==this.c.difficulty?this.img_shadow.source="_guaji_m_json.yingxion_img_touying":2==this.c.difficulty?this.img_shadow.source="_guaji_m_json.yingxion_img_touyinglan":3==this.c.difficulty&&(this.img_shadow.source="_guaji_m_json.yingxion_img_touyinghong"),this.c.difficulty&&!this.gp_foot.getChildByName("difficultySign")&&!this.gp_foot.getChildByName("showSign"))){var e=new eui.Image;e.source="_guaji_m_json.mx_img_jian"+this.c.difficulty,e.y=-70,e.scaleX=e.scaleY=.8,e.horizontalCenter=0,e.name="difficultySign",this.gp_foot.addChild(e)}},e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this)},e.prototype.hudongWithEP=function(e){var t=this.gp_foot.getChildByName("showSign");if(e.showSign)if(t)t.visible=!0;else{var i=new eui.Image;i.source="_guaji_m_json.mx_img_gth",i.y=-60,i.name="showSign",this.gp_foot.addChild(i),UIActionManager.douDong(i)}else 0==e.showSign&&t&&this.gp_foot.removeChild(this.gp_foot.getChildByName("showSign"))},e.prototype.onTrigger=function(e,t){this.checkTriggerCD()?i.AppFacade.getInstance().showSubView(i.StormWarMediator.N,i.StormWarMediator.SV.DIALOG,{data:this.vo.info,isCreep:!0}):t&&t()},e}(i.EventPoint);i.EPStormWarCreep=e,__reflect(e.prototype,"game.EPStormWarCreep")}(game||(game={})),function(a){var e=function(o){function e(){return null!==o&&o.apply(this,arguments)||this}return __extends(e,o),e.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5,this.img_finish=new eui.Image,this.img_finish.source="_guaji_m_json.mx_img_gth",this.img_finish.visible=!1,this.img_finish.horizontalCenter=0,this.img_finish.y=-100,this.gp_foot.addChild(this.img_finish)},e.prototype.onDataChange=function(){o.prototype.makeDefaultIcon.call(this),o.prototype.addEffect.call(this);var e=this.vo&&this.vo.eventId;if(e){var t=a.Config.riskEvent()[e];if(t){var i=JSON.parse(t.detail)[0],n=a.Config.riskEventTask()[i];if(n)n.progress>this.vo.info.key?this.img_finish.visible=!1:(this.img_finish.visible=!0,UIActionManager.douDong(this.img_finish));else Utils.MsgUtils.addMidMsg("找不到任务配置")}}},e.prototype.onTrigger=function(t,i){var n=this;if(this.checkTriggerCD())switch(this.vo.info.status){case RiskTaskStatus.UnGot:this.py.TriggerEvent(this.vo.position,"1",function(){n.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new a.EpTaskView({vo:n.vo}),closeCB:function(e){e?(n.py.TriggerEvent(n.vo.position,String(e)),t&&t()):i&&i(),a.EventPoint.lastTriggerTime=0}})})});break;case RiskTaskStatus.Got:this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new a.EpTaskView({vo:n.vo}),closeCB:function(e){e?(n.py.TriggerEvent(n.vo.position,String(e)),t&&t()):i&&i(),a.EventPoint.lastTriggerTime=0}})});break;case RiskTaskStatus.Finish:Utils.MsgUtils.addMidMsg("任务已完成")}else i&&i()},e}(a.EventPoint);a.EPTask=e,__reflect(e.prototype,"game.EPTask")}(game||(game={})),function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.gp_foot.touchEnabled=!1,this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.canTrigger=!1,this.aStarCost=100},t.prototype.onDataChange=function(){this.lb_tips.text=""+MAP_EP_TYPE_NAME[this.vo.type],this.img_icon.source=""},t}(e.EventPoint);e.EPTips=t,__reflect(t.prototype,"game.EPTips")}(game||(game={})),function(o){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},t.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},t.prototype.onTrigger=function(t,i){var n=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new o.EpTriggerView({vo:n.vo}),closeCB:function(e){e?(n.py.TriggerEvent(n.vo.position),t&&t()):i&&i(),o.EventPoint.lastTriggerTime=0}})}):i&&i()},t}(o.EventPoint);o.EPTrigger=e,__reflect(e.prototype,"game.EPTrigger")}(game||(game={})),function(o){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.aStarCost=1e5},t.prototype.onDataChange=function(){e.prototype.makeDefaultIcon.call(this),e.prototype.addEffect.call(this)},t.prototype.onTrigger=function(t,i){var n=this;this.checkTriggerCD()?this.handleStory(void 0,function(){PopUpManager.addPopUp({obj:new o.EpUnicursalView({vo:n.vo}),closeCB:function(e){e?(n.py.TriggerEvent(n.vo.position,"1"),t&&t()):i&&i(),o.EventPoint.lastTriggerTime=0}})}):i&&i()},t}(o.EventPoint);o.EPUnicursal=e,__reflect(e.prototype,"game.EPUnicursal")}(game||(game={})),function(e){var t=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.canTrigger2=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.aStarCost=1e5,this.img_shadow=new eui.Image,this.img_shadow.horizontalCenter=0,this.img_shadow.scaleX=this.img_shadow.scaleY=1.5,this.img_shadow.bottom=-20*this.img_shadow.scaleX/.6,this.img_shadow.source="_guaji_m_json.yingxion_img_touyinghong",this.gp_foot.addChild(this.img_shadow),this.cu_model=new customui.HeroDynamicModel,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=1,this.gp_foot.addChild(this.cu_model),this.bossInfo=new i,this.bossInfo.horizontalCenter=0,this.gp_foot.addChild(this.bossInfo)},e.prototype.hudongWithEP=function(e){var t=this;e.playDeadAction&&(this.bossInfo.fadeDead(),this.cu_model.egretArmDisplay.animation.timeScale=.25,this.cu_model.changeAction(["shouji"]),egret.setTimeout(function(){t.cu_model.egretArmDisplay?UIActionManager.fadeIn(t.cu_model,500,function(){t.img_shadow.visible=t.bossInfo.visible=t.cu_model.visible=!1,t.cu_model.egretArmDisplay.armature&&(t.cu_model.egretArmDisplay.animation.timeScale=1),e.cb&&e.cb()},!0):e.cb&&e.cb()},this,2e3)),e.appear&&(this.cu_model.egretArmDisplay.animation.timeScale=1,this.img_shadow.visible=this.bossInfo.visible=this.cu_model.visible=!0,UIActionManager.fadeIn(this.cu_model,500))},e.prototype.onDataChange=function(){var e=this;this.c=this.vo.config,this.c&&(this.cu_model&&(this.cu_model.update({isStatic:!0,model:this.c.heroC.model||"hero_001_01"}),this.vo.hudongAction&&(this.cu_model.onArmatureLoadCB=function(){e.hudongWithEP(e.vo.hudongAction)})),this.once(egret.Event.ENTER_FRAME,function(){e.bossInfo.top=e.cu_model&&-e.cu_model.height*e.cu_model.scaleY-100||-400},this),this.c.hideBossInfo?this.bossInfo.visible=!1:this.bossInfo.updateView(this.c))},e.prototype.onTrigger=function(e,t){this.vo.customTrigger&&this.vo.customTrigger(this.canTrigger2)},e}(e.FadeEventPoint);e.EPFadeBigBoss=t,__reflect(t.prototype,"game.EPFadeBigBoss");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="WorldBossMain_BossInfoSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.bi_bossAvatar=customui.BaseItemFactory.create(),this.gp_bossAvatar.addChild(this.bi_bossAvatar),this.pb_bossHpYellow.slideDuration=0,this.pb_bossHpRed.slideDuration=1e3,this.pb_bossHpYellow.labelFunction=function(e,t){var i=(100*(e/t)).toFixed(2);return Number(i)<5&&0!=Number(i)&&(i="??"),i+"%"}},e.prototype.updateView=function(e){this.params=e,this.bi_bossAvatar.updateData({type:EEntityType.EEntityTypeHero,code:this.params.heroC.code}),this.lb_boss_name.text=this.params.heroC.name,this.pb_bossHpRed.maximum=this.pb_bossHpYellow.maximum=this.params.initHp,this.pb_bossHpRed.value=this.pb_bossHpYellow.value=this.params.hp},e.prototype.fadeDead=function(){this.pb_bossHpRed.value=this.pb_bossHpYellow.value=0},e}(eui.Component);__reflect(i.prototype,"BossInfo")}(game||(game={})),function(e){var t=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.canTrigger2=!0,e.effects=[],e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.aStarCost=1e5,this.img_shadow=new eui.Image,this.img_shadow.horizontalCenter=0,this.img_shadow.scaleX=this.img_shadow.scaleY=1.5,this.img_shadow.bottom=-20*this.img_shadow.scaleX/.6,this.img_shadow.source="_guaji_m_json.yingxion_img_touyinghong",this.gp_foot.addChild(this.img_shadow),this.cu_model=new customui.HeroDynamicModel,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=1,this.gp_foot.addChild(this.cu_model)},e.prototype.onDataChange=function(){var i=this;this.c=this.vo.config,this.c&&(this.cu_model&&!this.c.hideBoss?(this.cu_model.visible=!0,this.cu_model.update({isStatic:!0,model:this.c.heroC.model||"hero_001_01"})):this.cu_model&&(this.cu_model.visible=!1),this.c.effects?(this.effects.forEach(function(e){i.gp_foot.removeChild(e.effect)}),this.c.effects.forEach(function(e){var t=e.name;t&&i.addEffect3(i.gp_foot,t,e.params,function(e){i.effects.push({name:t,effect:e,dirty:1})})})):this.effects.forEach(function(e){i.gp_foot.removeChild(e.effect)}))},e.prototype.addEffect3=function(t,e,i,n){DragonBoneTools.create(e,function(e){e.x=t.width/2+(i&&i.offectX||0),e.y=t.height/2+(i&&i.offectY||0),i&&(i.scaleX&&(e.scaleX=i.scaleX),i.scaleY&&(e.scaleY=i.scaleY)),i.rotation&&(e.rotation=i.rotation),i.childIndex||0==i.childIndex?t.addChildAt&&t.addChildAt(e,i.childIndex):t.addChild&&t.addChild(e),e.animation.play(),n&&n(e)},this)},e.prototype.onTrigger=function(e,t){this.vo.customTrigger&&this.vo.customTrigger(this.canTrigger2)},e}(e.FadeEventPoint);e.EPFadeBigBoss2=t,__reflect(t.prototype,"game.EPFadeBigBoss2")}(game||(game={})),function(e){var t=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.canTrigger2=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.aStarCost=1e5,this.img_shadow=new eui.Image,this.img_shadow.bottom=-20,this.img_shadow.horizontalCenter=0,this.img_shadow.scaleX=this.img_shadow.scaleY=.6,this.img_shadow.source="_guaji_m_json.yingxion_img_touyinghong",this.gp_foot.addChild(this.img_shadow),this.cu_model=new customui.HeroDynamicModel,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=.32,this.gp_foot.addChild(this.cu_model)},e.prototype.hudongWithEP=function(e){var t=this;if(e){var i=this.gp_foot.getChildByName("showSign");if(e.showSign)if(i)i.visible=!0;else{var n=new eui.Image;n.source=e.showSign,n.scaleX=n.scaleY=1,n.horizontalCenter=0,n.y=this.cu_model&&-this.cu_model.height*this.cu_model.scaleY||-100,n.name="showSign",this.gp_foot.addChild(n)}else 0==e.showSign&&i&&this.gp_foot.removeChild(this.gp_foot.getChildByName("showSign"));UIActionManager.setAbsGrey(this,e.needGray),e.needGray?(this.canTrigger2=!1,this.cu_model.onArmatureLoadCB=function(e){egret.setTimeout(function(){try{e&&e.armature&&e.animation&&e.animation.stop()}catch(e){}},t,150)}):(this.canTrigger2=!0,this.cu_model.egretArmDisplay&&this.cu_model.egretArmDisplay.armature&&this.cu_model.egretArmDisplay.animation&&!this.cu_model.egretArmDisplay.animation.isPlaying&&(this.cu_model.onArmatureLoadCB=function(e){try{e&&e.animation&&e.animation.play("daiji")}catch(e){}}))}},e.prototype.onDataChange=function(){var e=this;this.c=this.vo.config,this.c&&(this.cu_model.update({isStatic:!0,model:this.c.model||"hero_001_01"}),this.vo.hudongAction&&(this.cu_model.onArmatureLoadCB=function(){e.hudongWithEP(e.vo.hudongAction)}))},e.prototype.onTrigger=function(e,t){this.vo.customTrigger&&this.vo.customTrigger(this.canTrigger2)},e}(e.FadeEventPoint);e.EPFadeBoss=t,__reflect(t.prototype,"game.EPFadeBoss")}(game||(game={})),function(e){var t=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.canTrigger2=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!1,this.aStarCost=1e5,this.img_shadow=new eui.Image,this.img_shadow.bottom=-20,this.img_shadow.horizontalCenter=0,this.img_shadow.scaleX=this.img_shadow.scaleY=.6,this.img_shadow.source="_guaji_m_json.yingxion_img_touying",this.gp_foot.addChild(this.img_shadow),this.cu_model=new customui.HeroDynamicModel,this.cu_model.horizontalCenter=0,this.cu_model.bottom=0,this.cu_model.scaleX=this.cu_model.scaleY=.32,this.gp_foot.addChild(this.cu_model)},e.prototype.hudongWithEP=function(e){var t=this;if(e){var i=this.gp_foot.getChildByName("showSign");if(e.showSign)if(i)i.visible=!0;else{var n=new eui.Image;n.source=e.showSign,n.horizontalCenter=0,n.y=this.cu_model&&-this.cu_model.height*this.cu_model.scaleY||-100,n.name="showSign",this.gp_foot.addChild(n)}else 0==e.showSign&&i&&this.gp_foot.removeChild(this.gp_foot.getChildByName("showSign"));UIActionManager.setAbsGrey(this,e.needGray),e.needGray?(this.canTrigger2=!1,this.cu_model.onArmatureLoadCB=function(e){egret.setTimeout(function(){try{e&&e.armature&&e.animation&&e.animation.stop()}catch(e){}},t,150)}):(this.canTrigger2=!0,this.cu_model.egretArmDisplay&&this.cu_model.egretArmDisplay.armature&&this.cu_model.egretArmDisplay.animation&&!this.cu_model.egretArmDisplay.animation.isPlaying&&(this.cu_model.onArmatureLoadCB=function(e){try{e&&e.animation&&e.animation.play("daiji")}catch(e){}}))}},e.prototype.onDataChange=function(){var e=this;this.c=this.vo.config,this.c&&(this.cu_model.update({isStatic:!0,model:this.c.model||"hero_001_01"}),this.vo.hudongAction&&(this.cu_model.onArmatureLoadCB=function(){e.hudongWithEP(e.vo.hudongAction)}))},e.prototype.onTrigger=function(e,t){this.vo.customTrigger&&this.vo.customTrigger(this.canTrigger2)},e}(e.FadeEventPoint);e.EPFadeCreep=t,__reflect(t.prototype,"game.EPFadeCreep")}(game||(game={})),function(e){var t=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.effects=[],e.effectObj=[],e.canTrigger2=!0,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.img_tips_bg.visible=!1,this.lb_tips.visible=!1,this.img_icon.visible=!0,this.aStarCost=1e5,this.touchChildren=!1},e.prototype.onDataChange=function(){var i=this;this.c=this.vo.config,this.c&&(this.img_icon.source=this.c.source,this.img_icon.scaleX=this.c.iconScaleX||1,this.img_icon.scaleY=this.c.iconScaleY||1,this.c.touchChildren&&(this.touchChildren=!0),this.c.effects?(this.effects.forEach(function(e){i.gp_foot.removeChild(e.effect)}),this.c.effects.forEach(function(e){var t=e.name;t&&i.addEffect3(i,t,e.params,function(e){i.effects.push({name:t,effect:e,dirty:1})})})):this.effects.forEach(function(e){i.gp_foot.removeChild(e.effect)}),this.c.addictImg&&this.c.addictImg.forEach(function(e){var t=new eui.Image;t.source=e.source,t.x=e.x||0,t.y=e.y||0,i.addChild(t),e.cb&&e.cb(t)}))},e.prototype.addEffect3=function(t,e,i,n){DragonBoneTools.create(e,function(e){e.x=t.width/2+(i&&i.offectX||0),e.y=t.height/2+(i&&i.offectY||0),i&&(i.scaleX&&(e.scaleX=i.scaleX),i.scaleY&&(e.scaleY=i.scaleY)),i.rotation&&(e.rotation=i.rotation),i.childIndex||0==i.childIndex?t.addChildAt&&t.addChildAt(e,i.childIndex):t.addChild&&t.addChild(e),e.animation.play(),n&&n(e)},this)},e.prototype.onTrigger=function(e,t){this.vo.customTrigger&&this.vo.customTrigger(this.canTrigger2)},e}(e.FadeEventPoint);e.EPFadeIcon=t,__reflect(t.prototype,"game.EPFadeIcon")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="src/component/RewardItemRender.exml",e.touchChildren=!0,e}return __extends(e,t),e.prototype.dataChanged=function(){this.img_icon.source=this.data.img,this.lb_name.text=this.data.name},e}(eui.ItemRenderer);e.RewardItemRender=t,__reflect(t.prototype,"game.RewardItemRender")}(game||(game={})),function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.makeBtns=function(){var t=this;this.addBtn({text:this.getConfigBtnText(),cb:function(){egret.setTimeout(function(){t.opperationParams||(t.opperationParams=1,t.hide())},t,3e3),DragonBoneTools.playOnce({horizontalCenter:200,verticalCenter:-100,effectName:"common_bxglx",parent:t.gp_effect}),DragonBoneTools.playOnce({horizontalCenter:200,verticalCenter:210,effectName:"maoxian_bxg",actionName:"dakai",parent:t.gp_all,doneCB:function(){DragonBoneTools.playOnce({horizontalCenter:200,verticalCenter:210,effectName:"maoxian_bxg",actionName:"daiji2",parent:t.gp_effect,doneCB:function(){},loadFinishCB:function(e){e&&e.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,function(){e&&e.animation&&e.animation.stop(),t.opperationParams||(t.opperationParams=1,t.hide())},t)}})}})}})},t}(e.BaseEpView);e.EpBoxCreepView=t,__reflect(t.prototype,"game.EpBoxCreepView")}(game||(game={})),function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.makeBtns=function(){var e=this;this.addBtn({text:this.getConfigBtnText(),cb:function(){e.opperationParams=1,e.hide(),e.data.canGet&&e.data.customCB&&e.data.customCB(e.opperationParams)}})},t.prototype.afterAllAdd=function(){this.data.config.type==EPropType.EPropTypeMap&&this.makeThreeComponent(18)},t}(e.BaseEpView);e.EpBoxView=t,__reflect(t.prototype,"game.EpBoxView")}(game||(game={})),function(n){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.makeCosts=function(){var e=this.data&&this.data.vo&&this.data.vo.eventId;if(e){var t=n.Config.riskEvent()[e];if(t){var i=JSON.parse(t.detail)[0];this.addCost(i)}}},t.prototype.makeBtns=function(){var e=this,t=this.data&&this.data.vo&&this.data.vo.eventId;if(t){var i=n.Config.riskEvent()[t];if(i){JSON.parse(i.detail);this.addBtn({text:this.getConfigBtnText(),cb:function(){e.opperationParams=1,e.hide()}})}}},t.prototype.makeBottomReward=function(){var e=this.data.vo;if(e&&e.eventId){var t=n.Config.riskEvent()[e.eventId];if(t&&1==t.isShow){var i=JSON.parse(t.detail)[1];i&&0<i.length&&this.addBottomReward(i)}else this.removeBottomReward()}},t}(n.BaseEpView);n.EpCollectView=e,__reflect(e.prototype,"game.EpCollectView")}(game||(game={})),function(o){var e=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.prototype.makeReward=function(){var e=this.data.vo;if(e&&e.eventId){var t=o.Config.riskEvent()[e.eventId];if(t){var i=JSON.parse(t.detail)[1];i?(this.addReward(i),this.lb_desc2.textFlow=[{text:"奖励",style:{textColor:7096888}}]):n.prototype.makeReward.call(this)}else n.prototype.makeReward.call(this)}},e.prototype.makeBottomReward=function(){var e=this.data.vo;if(e&&e.eventId){var t=o.Config.riskEvent()[e.eventId];if(t&&t.isShow){var i=JSON.parse(t.detail)[0],n=o.Config.riskCreep()[i];if(n&&n.rewards)return void this.addBottomReward(JSON.parse(n.rewards))}}this.gp_bottomReward.parent&&this.gp_bottomReward.parent.removeChild(this.gp_bottomReward)},e}(o.BaseEpView);o.EpCreepView=e,__reflect(e.prototype,"game.EpCreepView")}(game||(game={})),function(a){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectIndex=0,e}return __extends(e,t),e.prototype.makeBtns=function(){for(var i=this,e=function(e){var t="";switch(e){case FingerGameType.Rock:t="拳";break;case FingerGameType.Scissors:t="剪";break;case FingerGameType.Paper:t="布";break;case 4:t="不玩了"}n.addBtn({text:t,cb:function(){4==e?i.hide():i.onBtnTap(e)}})},n=this,t=1;t<=4;t++)e(t)},e.prototype.onBtnTap=function(e){var n=this;this.selectIndex=e;var t=a.AppFacade.getInstance().retrieveProxy(a.GuajiPy.N);this.visible=!1;var o=this.vo.eventId;t.TriggerEvent(this.data.vo.position,e+"",function(i){PopUpManager.addPopUp({obj:new r({x:0,y:0,key:i.key,selfKey:e,cb:function(){if(i.key==n.selectIndex)n.visible=!0;else{n.hide();var e=a.Config.riskEvent()[o],t=a.Config.riskEventDesc()[e.descId];PopUpManager.addPopUp({obj:new a.BaseEpRewardView({config:t,rewards:i.clientReward,order:i.clientReward?0:1})})}}})})},void 0,!0)},e.prototype.makeBottomReward=function(){var e=this.data.vo;if(e&&e.eventId){var t=a.Config.riskEvent()[e.eventId];if(t&&1==t.isShow){var i=JSON.parse(t.detail)[0];i&&0<i.length&&this.addBottomReward(i)}else this.removeBottomReward()}},e}(a.BaseEpView);a.EpFingerGameView=e,__reflect(e.prototype,"game.EpFingerGameView");var r=function(i){function e(e){var t=i.call(this)||this;return t.skinName="EPEffectView",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){var i=this;this.gp_effect.width=this.gp_effect.parent.width,this.gp_effect.height=this.gp_effect.parent.height,DragonBoneTools.playOnce({effectName:"common_caiquan",parent:this.gp_effect,x:this.params.x||this.gp_effect.width/2,y:this.params.y||this.gp_effect.height/2,doneCB:function(){var e,t="";switch(i.params.selfKey){case FingerGameType.Rock:t="maoxian_icon_shitou_png";break;case FingerGameType.Paper:t="maoxian_icon_bu_png";break;case FingerGameType.Scissors:t="maoxian_icon_jiandao_png"}switch((e=new eui.Image(t)).verticalCenter=-100,e.left=0,i.gp_content.addChild(e),parseInt(i.params.key)){case FingerGameType.Rock:t="maoxian_icon_shitou_png";break;case FingerGameType.Paper:t="maoxian_icon_bu_png";break;case FingerGameType.Scissors:t="maoxian_icon_jiandao_png"}(e=new eui.Image(t)).verticalCenter=-100,e.right=0,e.scaleX=-1,i.gp_content.addChild(e),egret.setTimeout(function(){i.hide(),i.params.cb&&i.params.cb()},i,1500)}})},e}(BasePanel);__reflect(r.prototype,"EffectView")}(game||(game={})),function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.makeBtns=function(){var t=this;this.addBtn({text:this.getConfigBtnText(),cb:function(){PopUpManager.addPopUp({obj:new i,closeCB:function(e){t.opperationParams=e,t.hide()}})}})},t}(e.BaseEpView);e.EpFlipCardView=t,__reflect(t.prototype,"game.EpFlipCardView");var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.gp_img.removeChildren()},t.prototype.makeGpFree=function(){},t}(e.BaseEpView);e.EpFlipCardView2=i,__reflect(i.prototype,"game.EpFlipCardView2")}(game||(game={})),function(e){var t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.childrenCreated=function(){if(t.prototype.childrenCreated.call(this),this.data&&this.data.vo&&this.data.vo.info&&this.data.vo.info.clear){var e=new eui.Image("zd_img_yitongguan_png");e.scaleX=e.scaleY=1.5,e.left=e.top=-70,e.rotation=-30,this.gp_main.addChild(e)}},e}(e.BaseEpView);e.EPFortressView=t,__reflect(t.prototype,"game.EPFortressView")}(game||(game={})),function(c){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.makeBtns=function(){var t=this,e=this.vo.eventId,i=c.Config.riskEvent()[e],n=void 0;if(e&&i){var o=JSON.parse(i.detail);n=o[2]}for(var a=function(e){r.addBtn({text:e==GuessSizeType.Big?"大":"小",cb:function(){t.btnCallBack(e)},costs:n})},r=this,s=1;s<=2;s++)a(s)},t.prototype.makeCosts=function(){},t.prototype.makeBottomReward=function(){var e=this.data.vo;if(e&&e.eventId){var t=c.Config.riskEvent()[e.eventId];if(t&&1==t.isShow){var i=JSON.parse(t.detail)[0];i&&0<i.length&&this.addBottomReward(i)}else this.removeBottomReward()}},t.prototype.btnCallBack=function(e){var t=this,i=c.AppFacade.getInstance().retrieveProxy(c.GuajiPy.N),n=this.vo.eventId;i.TriggerEvent(this.data.vo.position,e.toString(),function(i){t.hide();i.key;PopUpManager.addPopUp({obj:new o({x:0,y:0,key:i.key,cb:function(){var e=c.Config.riskEvent()[n],t=c.Config.riskEventDesc()[e.descId];PopUpManager.addPopUp({obj:new c.BaseEpRewardView({config:t,rewards:i.clientReward,order:i.clientReward?0:1})})}})})},void 0,!0)},t}(c.BaseEpView);c.EpGuessSizeView=e,__reflect(e.prototype,"game.EpGuessSizeView");var o=function(i){function e(e){var t=i.call(this)||this;return t.skinName="EPEffectView",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;DragonBoneTools.playOnce({effectName:"common_105100",parent:this.gp_effect,x:this.params.x||this.gp_effect.width/2,y:this.params.y||this.gp_effect.height/2,doneCB:function(){var e=new eui.Image("maoxian_icon_shaizi"+t.params.key+"_png");e.horizontalCenter=e.verticalCenter=0,t.gp_content.addChild(e),egret.setTimeout(function(){t.hide(),t.params.cb&&t.params.cb()},t,1500)}})},e}(BasePanel);__reflect(o.prototype,"EffectView")}(game||(game={})),function(l){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.makeCosts=function(){var e=this.data.vo;if(e.info&&e.info.captured){var t=this.data.config,i=JSON.parse(t.rewards)[0],n=l.GeneralConfig.getEntityConfigByCode(i[0],i[1]);if(n){var o=new eui.Group,a=new eui.HorizontalLayout;a.verticalAlign=egret.VerticalAlign.MIDDLE,a.horizontalAlign=egret.HorizontalAlign.CENTER,o.layout=a;var r=new eui.Image(ResourceUtils.png(n.icon));r.scaleX=r.scaleY=.5;var s=new eui.Label;s.text="效率：",s.size=20,s.textColor=7096888;var c=new eui.BitmapLabel;-1!=[RiskMineType.Artifact,RiskMineType.Equip].indexOf(t.type)?c.text="概率产出":c.text="+"+i[2]+"/"+t.interval+"s",c.font="white_num_fnt",o.addChild(s),o.addChild(r),o.addChild(c),this.gp_costs.addChild(o)}}else this.gp_costs.removeChildren()},t.prototype.makeBtns=function(){var e=this,t=this.data.vo,i=this.getConfigBtnText();t.info&&t.info.captured&&(i=this.getConfigBtnText(this.getForceId())),this.addBtn({text:i,cb:function(){t.info&&t.info.captured||(e.opperationParams=1,egret.setTimeout(function(){l.AppFacade.getInstance().sendNotification(CN.GUAJI_UPDATE_MINE)},e,300)),e.hide()}})},t.prototype.getForceId=function(){var e=this.data.vo.eventId,t=l.Config.riskEvent()[e],i=JSON.parse(t.detail),n=l.Config.riskMine()[i],o=16;if(n)switch(n.type){case 1:o=16;break;case 2:o=14;break;case 3:o=17;break;case 4:o=15;break;case 5:o=41;break;case 6:o=40}return o},t.prototype.afterAllAdd=function(){var e=this.data.vo;e.info&&e.info.captured&&this.makeThreeComponent(this.getForceId())},t}(l.BaseEpView);l.EpMineView=e,__reflect(e.prototype,"game.EpMineView")}(game||(game={})),function(c){var e=function(s){function o(){var e=null!==s&&s.apply(this,arguments)||this;return e.rowCount=1,e.colCount=1,e.emptyItem=[3,3,0],e.imgRoot="",e.gap=10,e.inOrigin=!1,e.moveCount=0,e}return __extends(o,s),o.prototype.childrenCreated=function(){var e=this,t=this.data&&this.data.vo&&this.data.vo.eventId;if(t){var i=c.Config.riskEvent()[t];if(i){var n=JSON.parse(i.detail),o=(n[0],n[1]),a=c.Config.riskEventUnicursal()[o],r=JSON.parse(a.detail);this.colCount=r[0],this.rowCount=r[1],this.imgRoot="_guaji_pt_m_json."+r[2],this.curConfig=r[3],this.emptyItem=[this.rowCount,this.colCount,0],s.prototype.childrenCreated.call(this),this.gp_img.removeChildren(),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){e.perClose()},this)}}},o.prototype.makeGpFree=function(){var e=new eui.Image;e.source="common_img_jichukuang_12_png",e.top=-10,e.bottom=-10,e.left=-10,e.right=-10,e.scale9Grid=new egret.Rectangle(20,17,15,17),this.gp_free.addChild(e),this.loadConfig()},o.prototype.loadConfig=function(){var c=this,l=JSON.parse(Utils.LocalStorageUtil.getItem("guaji_pt_"+this.data.vo.eventId));l&&0!=l.length||(l=this.curConfig);var e=function(e){var t=parseInt(e)+1,i=l[e],n=new eui.Image,o=t%h.colCount?t%h.colCount:h.colCount,a=Math.floor((t-1)/h.colCount)+1;0==i&&(h.emptyItem=[a,o,0]),n.data=[a,o,i,a,o];var r=h.imgRoot+"_"+(i<=9?"0"+i:i);if(0==i){var s=h.colCount*h.rowCount;r=h.imgRoot+"_"+(s<=9?"0"+s:s),n.alpha=0}RES.getResAsync(r,function(e){if(e){var t=(n.source=e).textureWidth,i=e.textureHeight;n.x=(o-1)*t+(o-1)*c.gap,n.y=(a-1)*i+(a-1)*c.gap}},h),h.gp_free.addChild(n),n.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){c.touchItem||(c.touchPoint=[e.stageX,e.stageY],c.touchItem=e.target.data)},h),n.addEventListener(egret.TouchEvent.TOUCH_END,function(e){var t=e.target.data;c.touchItem&&c.touchItem[0]==t[0]&&c.touchItem[1]==t[1]&&c.oneMove([e.stageX,e.stageY])},h),n.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(e){var t=e.target.data;c.touchItem&&c.touchItem[0]==t[0]&&c.touchItem[1]==t[1]&&c.oneMove([e.stageX,e.stageY])},h)},h=this;for(var t in l)e(t)},o.prototype.oneMove=function(e){var t=[];(e[0]-this.touchPoint[0])*(e[0]-this.touchPoint[0])+(e[1]-this.touchPoint[1])*(e[1]-this.touchPoint[1])<=2025?t=[o.DIR.DOWN,o.DIR.UP,o.DIR.LEFT,o.DIR.RIGHT]:(e[0]>this.touchPoint[0]?t.push(o.DIR.RIGHT):t.push(o.DIR.LEFT),e[1]>this.touchPoint[1]?t.push(o.DIR.DOWN):t.push(o.DIR.UP)),0<t.length?(this.switchItemByDir(this.touchItem,t),this.moveCount++,3<=this.moveCount&&(this.saveCash(),this.moveCount=0)):this.touchItem=void 0},o.prototype.switchItemByDir=function(e,t){void 0===t&&(t=[]);var i=o.DIR.NOTHING;if(e[0]==this.emptyItem[0]&&(0<e[1]-1&&e[1]-1==this.emptyItem[1]&&(i=o.DIR.LEFT),e[1]+1<=this.colCount&&e[1]+1==this.emptyItem[1]&&(i=o.DIR.RIGHT)),e[1]==this.emptyItem[1]&&(0<e[0]-1&&e[0]-1==this.emptyItem[0]&&(i=o.DIR.UP),e[0]+1<=this.rowCount&&e[0]+1==this.emptyItem[0]&&(i=o.DIR.DOWN)),i!=o.DIR.NOTHING&&0<=t.indexOf(i)){var n=[e[0],e[1],0];this.switchTwoItem(e,this.emptyItem),this.emptyItem=n}this.touchItem=void 0},o.prototype.makeBtns=function(){var t=this;this.addBtn({text:"重置",cb:function(){c.GameMgr.getInstance().showCommonTipsWin({commonTips:"确定重置",clickCB:function(e){1==e.type&&t.superReset()}})}});var e=this.addBtn({text:"预览"});e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.showOrigin()},this),e.addEventListener(egret.TouchEvent.TOUCH_END,function(){t._reset()},this),e.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t._reset()},this)},o.prototype._reset=function(){for(var e=this.gp_free.$children,t=1;t<e.length;t++){var i=e[t],n=i.data,o=n[0],a=n[1];i.x=(a-1)*i.width+(a-1)*this.gap,i.y=(o-1)*i.height+(o-1)*this.gap}this.inOrigin=!1},o.prototype.superReset=function(){for(var e=this.curConfig,t=this.gp_free.$children,i=1;i<t.length;i++){var n=t[i],o=n.data,a=o[2],r=o[3],s=o[4];for(var c in e){var l=parseInt(c)+1;if(e[c]==a){s=l%this.colCount?l%this.colCount:this.colCount,r=Math.floor((l-1)/this.colCount)+1;break}}0==a&&(this.emptyItem=[r,s,0]),n.data[0]=r,n.data[1]=s,n.x=(s-1)*n.width+(s-1)*this.gap,n.y=(r-1)*n.height+(r-1)*this.gap}this.inOrigin=!1},o.prototype.showOrigin=function(){for(var e=this.gp_free.$children,t=1;t<e.length;t++){var i=e[t],n=i.data[2]||this.colCount*this.rowCount,o=n%this.colCount?n%this.colCount:this.colCount,a=Math.floor((n-1)/this.colCount)+1;i.x=(o-1)*i.width+(o-1)*this.gap,i.y=(a-1)*i.height+(a-1)*this.gap}this.inOrigin=!0},o.prototype.switchTwoItem=function(e,t){var i=this,n=this.getGpChild(e),o=this.getGpChild(t);if(n&&o){var a=n.x,r=o.x,s=n.y,c=o.y;GameRootLayer.gameLayer().switchTouchEnable(!1),egret.Tween.get(n).to({x:r,y:c},300).call(function(){i.checkSucceed(function(e){GameRootLayer.gameLayer().switchTouchEnable(!0),e&&(i.opperationParams=1,i.hide())})},this),egret.Tween.get(o).to({x:a,y:s},300);var l=[e[0],e[1]];n.data[0]=t[0],n.data[1]=t[1],o.data[0]=l[0],o.data[1]=l[1]}},o.prototype.getGpChild=function(e){for(var t=this.gp_free.$children,i=1;i<t.length;i++){var n=t[i],o=n.data;if(o[0]==e[0]&&o[1]==e[1])return n}},o.prototype.checkSucceed=function(e){if(this.inOrigin)return!1;for(var t=!0,i=this.gp_free.$children,n=1;n<i.length;n++){var o=i[n].data;(o[0]-1)*this.colCount+o[1]!=(o[2]||this.colCount*this.rowCount)&&(t=!1)}if(t){var a=this.getGpChild(this.emptyItem);a&&egret.Tween.get(a).to({alpha:1},500).wait(500).call(function(){e&&e(1)})}else e&&e(0)},o.prototype.saveCash=function(){for(var e=[],t=this.gp_free.$children,i=1;i<t.length;i++){var n=t[i].data;e.push(n)}e.sort(function(e,t){return e[0]!=t[0]?e[0]-t[0]:e[1]!=t[1]?e[1]-t[1]:0});var o=[];e.forEach(function(e){o.push(e[2])}),Utils.LocalStorageUtil.setItem("guaji_pt_"+this.data.vo.eventId,JSON.stringify(o))},o.prototype.perClose=function(){this.saveCash()},o.prototype.makeBottomReward=function(){var e=this.data&&this.data.vo&&this.data.vo.eventId;if(e){var t=c.Config.riskEvent()[e];if(t){var i=JSON.parse(t.detail)[2];this.addBottomReward(i[0])}}},o.DIR={NOTHING:0,AUTO:1,UP:2,DOWN:3,LEFT:4,RIGHT:5},o}(c.BaseEpView);c.EpPuzzleView=e,__reflect(e.prototype,"game.EpPuzzleView")}(game||(game={})),function(c){var e=function(r){function e(){return null!==r&&r.apply(this,arguments)||this}return __extends(e,r),e.prototype.childrenCreated=function(){r.prototype.childrenCreated.call(this),this.updateView()},e.prototype.makeBtns=function(){var o=this,e=this.data.vo.info.id,t=c.Config.riskQuora()[e],i=JSON.parse(t.questions)[this.data.vo.info.count||0],a=i&&c.Config.questionConfig()[i],n=JSON.parse(a.answer),r=void 0;a.backIsAnswer&&(n.push(a.backIsAnswer),r=n.length-1),n.forEach(function(e,t){var i=r==t,n={index:t,answer:e,isFade:i,position:o.data.vo.position,question:a};o.addBtn({text:e,cb:function(){if(n.isFade)o.callNext({order:parseInt(n.index)+1,isFade:i});else{var e=[];if(n.question.costs&&(e=JSON.parse(n.question.costs)[parseInt(n.index)]),e)if(!c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).checkEnough(e,!0))return;o.callNext({order:parseInt(n.index)+1,isFade:i})}}})})},e.prototype.afterAllAdd=function(){var e=this;if(this.data&&this.data.vo&&this.data.vo.info&&this.data.vo.info.id){var t=this.data.vo.info.id,i=c.Config.riskQuora()[t],n=c.Config.riskEvent()[this.vo.eventId],o=JSON.parse(i.questions)[this.data.vo.info.count],a=o&&c.Config.questionConfig()[o],r=n.story?JSON.parse(n.story)[0]:void 0,s=r&&JSON.parse(c.Config.storyConfig()[r].subs);s&&s[0]&&this.addCallBack(this.handleStory,this,{storyId:r}),this.addCallBack(function(){e.visible=!0},this),a.story&&this.addCallBack(this.handleStory,this),this.addCallBack(this.callServer,this),this.callNext()}else this.hide()},e.prototype.handleStory=function(e){var t=this;this.visible=!1;var i=this.data.vo.info.id,n=c.Config.riskQuora()[i],o=JSON.parse(n.questions)[this.data.vo.info.count],a=o&&c.Config.questionConfig()[o],r=JSON.parse(a.story);PopUpManager.addPopUp({obj:new c.StoryView({storyId:e.storyId||r[e.order-1],questionId:void 0,position:void 0,cb:function(){t.callNext(e)}})})},e.prototype.callServer=function(e){var i=this;if(e.isFade)this.hide();else{this.vo.eventId;c.AppFacade.getInstance().retrieveProxy(c.GuajiPy.N).Answer(e.order,this.data.vo.position,function(e,t){PopUpManager.addPopUp({obj:new c.BaseEpRewardView({config:i.questionConfig,rewards:t,order:e-1})}),i.hide()},!1)}},e.prototype.makeThreeComponent=function(){if(this.data&&this.data.vo&&this.data.vo.info){r.prototype.makeThreeComponent.call(this);var e=this.data.vo.info.id,t=c.Config.riskQuora()[e],i=JSON.parse(t.questions)[this.data.vo.info.count],n=i&&c.Config.questionConfig()[i];if(this.questionConfig=n){this.lb_title.text=n.title;try{var o=(new egret.HtmlTextParser).parser(n.question);this.lb_desc.textFlow=o}catch(e){this.lb_desc.text=n.question}try{var a=c.GeneralConfig.getGuajiImg(n.img);1==a[0]?this.img_icon.source=a[1]:2==a[0]&&this.HeroDynamicModel.update({model:a[1]})}catch(e){console.log(e)}}}},e.prototype.makeBottomReward=function(){var e=this.data.vo;if(e&&e.eventId){var t=this.data.vo.info.id,i=c.Config.riskQuora()[t],n=c.Config.riskEvent()[e.eventId],o=JSON.parse(i.questions)[this.data.vo.info.count],a=o&&c.Config.questionConfig()[o];if(a&&1==n.isShow){var r=JSON.parse(a.rewards);for(var s in r)r[s]&&0<r[s].length&&this.addBottomReward(r[s])}else this.removeBottomReward()}},e}(c.BaseEpView);c.EpQuoraView=e,__reflect(e.prototype,"game.EpQuoraView")}(game||(game={})),function(y){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="EpRechargeView",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.makeThreeComponent()},e.prototype.makeThreeComponent=function(){if(this.isCreateComplete){this.lb_title.text="英雄招募";var e=y.AppFacade.getInstance().retrieveProxy(y.ActivityPy.N).allActivityData[EActivityType.FirstRecharge1];if(e&&e.data){this.HeroDynamicModel.update({isStatic:!0,code:41050009});var t=y.Config.heroAndPetUpstarConfig()[41050009],i=t&&t.nextCode;this.makeSkills(i)}}},e.prototype.makeSkills=function(e){var r=this,s=y.Config.allHeroConfig()[e];if(s){s.posSkill1,s.posSkill2,s.posSkill3;for(var t=function(e){var t=SKILL_CODE[e],i=c["skill_"+e],n=s[t];if(t){var o={code:n,unlock:!0,notNeedLevel:!0};c["skill_"+e].updateItem(o)}else c["skill_"+e].updateItem();var a=i;a.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){n&&(r.skill_panel.visible=!0,r.skill_panel.updateItem({code:n}))},c),a.addEventListener(egret.TouchEvent.TOUCH_END,function(){r.skill_panel.visible=!1},c),a.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){r.skill_panel.visible=!1},c),a.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){r.skill_panel.visible=!1},c)},c=this,i=1;i<=4;i++)t(i)}},e.prototype.makeBtns=function(){var t=this,i=y.AppFacade.getInstance().retrieveProxy(y.ActivityPy.N),e=i.allActivityData[EActivityType.FirstRecharge1];if(e&&e.data){for(var n=JSON.parse(e.content),o=JSON.parse(e.data.rechargeTargeted),a=e.data.rewardTargeted,r=e.data.key,s=!1,c=0,l=0;l<3;l++){var h=n[l+0],p=h[0],d=(h[1],h[2]),u=(h[3],h[4]),g=REWARD_STATUS.UNAVAILABLE;d<=r&&(g=REWARD_STATUS.AVAILABLE),0<=a.indexOf(p)&&(g=REWARD_STATUS.RECEIVED);var f=0;for(var _ in o){var m=o[_];m[0]==d&&(f=m[1])}switch(f<u&&(g=REWARD_STATUS.UNAVAILABLE),g){case REWARD_STATUS.UNAVAILABLE:break;case REWARD_STATUS.AVAILABLE:case REWARD_STATUS.RECEIVED:c=p,s=!0}if(c)break}this.gp_btns.removeChildren(),s?this.addBtn({text:"领取",cb:function(){Utils.Socket.send("activity","GetFirstRechargeReward",{id:c,code:EActivityType.FirstRecharge1}).then(function(e){i.updateData_View_Reward(EActivityType.FirstRecharge1,e),y.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN),t.hide()})}}):(this.addBtn({text:"考虑一下",cb:function(){t.hide()}}),this.addBtn({text:"花点小钱",cb:function(){y.MainJumpConfig.jumpTo(MODULE.Recharge),t.hide()}}))}},e}(y.BaseEpView);y.EpRechargeView=e,__reflect(e.prototype,"game.EpRechargeView")}(game||(game={})),function(d){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.selectIndex=0,e.cardList=[],e.isCanTouch=!0,e.showCardList=[],e.successNum=0,e}return __extends(e,t),e.prototype.makeBtns=function(){var i=this;this.gp_free.removeChildren(),this.gp_img.visible=!1;var e=this.data&&this.data.vo&&this.data.vo.eventId;if(e){var t=d.Config.riskEvent()[e];if(t){var n=JSON.parse(t.detail),o=(n[0],n[1]),a=JSON.parse(d.Config.riskEventUnicursal()[o].detail);a[2].sort(function(e,t){return.5<Math.random()?-1:1}),this.gp_img&&this.gp_img.parent&&this.gp_img.parent.removeChild(this.gp_img);var r=new eui.Group;r.width=120*a[1],r.height=160*a[0],r.horizontalCenter=0,r.verticalCenter=0,this.gp_free.addChild(r),this.cardList=[],this.showCardList=[],this.isCanTouch=!0;for(var s=this.successNum=0,c=0;c<a[1];c++)for(var l=function(e){var t=new u(a[2][s]);t.x=t.width*c+80-r.width/2,t.y=t.height*e+80-r.height/2,t.name=a[2][s],t.cardID=s,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.isCanTouch&&!t.isShow&&(i.isCanTouch=!1,i.updateCardListInfo(t))},h),r.addChild(t),h.cardList.push(t),s++},h=this,p=0;p<a[0];p++)l(p)}}},e.prototype.updateCardListInfo=function(e){var t=this;e.runCardAction();var i=!1;if(0==this.showCardList.length)return this.showCardList.push(e),void(this.isCanTouch=!0);for(var n in this.showCardList)this.showCardList[n].name==e.name&&this.showCardList[n].cardID!=e.cardID&&(i=!0,this.showCardList=[],this.successNum++);egret.setTimeout(function(){if(!i){for(var e in t.cardList)t.cardList[e].initCard();t.showCardList=[],t.successNum=0}t.isCanTouch=!0},this,500),6==this.successNum&&this.cardSuccess()},e.prototype.cardSuccess=function(){var e=this;egret.setTimeout(function(){e.opperationParams=1,e.hide()},this,500)},e.prototype.makeBottomReward=function(){var e=this.data.vo;if(e&&e.eventId){var t=d.Config.riskEvent()[e.eventId];t.isShow;if(t&&1==t.isShow){var i=JSON.parse(t.detail)[2][0];i&&0<i.length&&this.addBottomReward(i)}else this.removeBottomReward()}},e}(d.BaseEpView);d.EpSameCardView=e,__reflect(e.prototype,"game.EpSameCardView");var u=function(i){function e(e){var t=i.call(this)||this;return t.isShow=!1,t.skinName="EPSameCardView",t.cardID=e,t.config=d.Config.riskEventUnicursal()[1001],t.img_Item.source=e+"_png",t.img_normal.scaleX=1,t.img_normal.scaleY=1,t.img_normal.visible=!0,t.gp_result.scaleX=0,t.gp_result.scaleY=1,t.gp_result.visible=!1,t}return __extends(e,i),e.prototype.childrenCreated=function(){},e.prototype.runCardAction=function(){this.isShow=!0,egret.Tween.get(this.img_normal).to({scaleX:0},150).call(function(){this.img_normal.visible=!1},this),egret.Tween.get(this.gp_result).to({scaleX:1},150).call(function(){this.gp_result.visible=!0},this).wait(200)},e.prototype.initCard=function(){this.isShow=!1,egret.Tween.get(this.gp_result).to({scaleX:0},150).call(function(){this.gp_result.visible=!1},this),egret.Tween.get(this.img_normal).to({scaleX:1},150).call(function(){this.img_normal.visible=!0},this).wait(200)},e}(BasePanel);__reflect(u.prototype,"SameCardView")}(game||(game={})),function(c){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.imgList=[],e.seleceIndex=0,e}return __extends(e,t),e.prototype.makeReward=function(){var a=this,e=this.data&&this.data.vo&&this.data.vo.eventId;if(e){var t=c.Config.riskEvent()[e];if(t){var r=JSON.parse(t.detail),i=function(e){var t=r[e],i=new eui.Group;i.width=i.height=118,t.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),t.touchEnabled=!1,t.horizontalCenter=t.verticalCenter=0,i.addChild(t)});var n=c.GeneralConfig.getEntityConfigByCode(t[0][0],t[0][1]);"0"==e&&s.updateLabel(n.name+"×"+Utils.MathUtils.formatNumStyle1(t[0][2])),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.imgList[a.seleceIndex]&&(a.imgList[a.seleceIndex].visible=!1),a.seleceIndex=parseInt(e),a.imgList[a.seleceIndex]&&(a.imgList[a.seleceIndex].visible=!0),a.updateLabel(n.name+"×"+Utils.MathUtils.formatNumStyle1(t[0][2]))},s);var o=new eui.Image("common_img_touxiangxuanzhon_png");o.horizontalCenter=o.verticalCenter=0,o.visible=!1,o.scaleX=o.scaleY=1.05,i.addChild(o),s.imgList.push(o),i.scaleX=i.scaleY=.8,s.gp_reward.addChild(i)},s=this;for(var n in r)i(n);this.imgList[this.seleceIndex]&&(this.imgList[this.seleceIndex].visible=!0)}}},e.prototype.makeBtns=function(){var e=this;this.addBtn({text:this.getConfigBtnText(),cb:function(){e.opperationParams=e.seleceIndex+1,e.hide()},thiz:this})},e.prototype.updateLabel=function(e){this.lb_desc2.textFlow=[{text:"你选择了  ",style:{textColor:7096888}},{text:e,style:{textColor:1865435}}]},e}(c.BaseEpView);c.EpSelectView=e,__reflect(e.prototype,"game.EpSelectView")}(game||(game={})),function(l){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.seleceIndex=0,e.POS=[[35,200],[300,200],[165,40]],e.SWAP_SPEED=[500,500,500,500,500,400,400,400,400,300,300,300,300,300],e.SWAP_SPEED_SCALE=1.5,e.POOLS=[[0,1],[0,2],[1,0],[1,2],[2,0],[2,1]],e.canChose=!1,e}return __extends(e,t),e.prototype.rand=function(){return this.POOLS[Utils.MathUtils.getRandomInt(0,this.POOLS.length-1)]},e.prototype.afterAllAdd=function(){var e=this.data&&this.data.vo&&this.data.vo.eventId;if(e){var t=l.Config.riskEvent()[e];if(t){var i=JSON.parse(t.detail)[2];this.gp_cups=new Array,this.gp_img.parent.removeChild(this.gp_img);var n=this.gp_free;n.width=460,n.height=360;for(var o=0;o<3;o++){var a=new eui.Group;a.width=131,a.height=165;var r=customui.BaseItemFactory.create();r.updateData({reward:i[o][0]});var s=new eui.Image("maoxian_img_touzhong_png"),c=new eui.Image("maoxian_img_touzhongdi_png");r.x=29,r.y=55,r.scaleX=r.scaleY=.7,s.x=7,s.y=0,c.x=0,c.y=76,s.userdata_index=o,a.userdata_img=s,a.addChild(c),a.addChild(r),a.addChild(s),a.x=this.POS[o][0],a.y=this.POS[o][1],Utils.ComponentUtils.registerListener(s,egret.TouchEvent.TOUCH_TAP,this.click,this),n.addChild(a),this.gp_cups.push(a)}}}},e.prototype.taiQiOrHeShang=function(e,t,i){if(void 0===t&&(t=!1),null!=e)egret.Tween.get(this.gp_cups[e].userdata_img).to({y:t?0:-100},500,egret.Ease.sineInOut).call(function(){i&&i()});else for(var n=0,o=this.gp_cups;n<o.length;n++){var a=o[n];egret.Tween.get(a.userdata_img).to({y:t?0:-100},500,egret.Ease.sineInOut)}},e.prototype.click=function(e){var t=this;if(this.canChose){var i=e.target.userdata_index;this.canChose=!1,this.taiQiOrHeShang(i,void 0,function(){t.opperationParams=i+1,t.hide()})}},e.prototype.swap=function(e,t,i){var n=this;i/=this.SWAP_SPEED_SCALE,egret.Tween.get(e).to({x:t.x,y:t.y},i,egret.Ease.sineInOut),0<this.SWAP_SPEED.length?egret.Tween.get(t).to({x:e.x,y:e.y},i,egret.Ease.sineInOut).call(function(){var e=n.rand();n.swap(n.gp_cups[e[0]],n.gp_cups[e[1]],n.SWAP_SPEED.shift())}):(egret.Tween.get(t).to({x:e.x,y:e.y},i,egret.Ease.sineInOut),this.canChose=!0)},e.prototype.makeBtns=function(){var t=this;this.addBtn({text:"开 始",cb:function(){t.gp_btns.visible=!1,t.taiQiOrHeShang(),t.scheId=egret.setTimeout(function(){t.taiQiOrHeShang(void 0,!0),t.scheId=egret.setTimeout(function(){var e=t.rand();t.swap(t.gp_cups[e[0]],t.gp_cups[e[1]],t.SWAP_SPEED.shift())},t,1e3)},t,1500)}})},e.prototype.onDestroy=function(){if(this.scheId){egret.clearTimeout(this.scheId);for(var e=0,t=this.gp_cups;e<t.length;e++){var i=t[e];egret.Tween.removeTweens(i)}}},e}(l.BaseEpView);l.EpSieveView=e,__reflect(e.prototype,"game.EpSieveView")}(game||(game={})),function(c){var e=function(s){function e(){return null!==s&&s.apply(this,arguments)||this}return __extends(e,s),e.prototype.childrenCreated=function(){var e=this.data&&this.data.vo&&this.data.vo.eventId;if(e){var t=c.Config.riskEvent()[e];if(t){var i=JSON.parse(t.detail)[0],n=c.Config.riskEventTask()[i];if(n){s.prototype.childrenCreated.call(this),this.gp_img.removeChildren(),this.lb_desc2.text="奖励",this.lb_desc2.textColor=7096888;var o=n.progress,a="("+this.data.vo.info.key+"/"+o+")";this.lb_desc.textFlow=[{text:"[任务目标]：",style:{textColor:11222333}},{text:n.name,style:{textColor:7096888}},{text:a,style:{textColor:7096888}},{text:"\n",style:{textColor:7096888}},{text:"\n",style:{textColor:7096888}},{text:"[任务内容]：",style:{textColor:11222333}},{text:n.desc,style:{textColor:7096888}}],this.lb_desc.textAlign=egret.HorizontalAlign.LEFT;var r=JSON.parse(n.rewards);this.addReward(r),this.gp_height.height=10,this.updateBtn()}else Utils.MsgUtils.addMidMsg("找不到任务配置")}}},e.prototype.makeReward=function(){},e.prototype.updateBtn=function(){var e=this;this.gp_btns.removeChildren();var t="",i=void 0,n=this.data&&this.data.vo&&this.data.vo.eventId;if(n){var o=c.Config.riskEvent()[n];if(o){var a=JSON.parse(o.detail)[0],r=c.Config.riskEventTask()[a];if(r){var s=r.progress;switch(this.vo.info.status){case RiskTaskStatus.UnGot:t="领取任务",i=function(){c.GameMVC.guajiPy.TriggerEvent(e.data.vo.position,"1",function(){e.updateBtn()})};break;case RiskTaskStatus.Got:s&&(s<=this.data.vo.info.key?(t="领取",i=function(){e.opperationParams=1,e.hide()}):(t="前往",i=function(){e.opperationParams=0,e.hide(),c.MainJumpConfig.jumpTo(r.jumpModule)}));break;case RiskTaskStatus.Finish:this.hide(),Utils.MsgUtils.addMidMsg("任务已完成")}this.addBtn({text:t,cb:i})}else Utils.MsgUtils.addMidMsg("找不到任务配置")}}},e}(c.BaseEpView);c.EpTaskView=e,__reflect(e.prototype,"game.EpTaskView")}(game||(game={})),function(h){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.curSequenceIndex=0,e}return __extends(e,t),e.prototype.makeBtns=function(){var o=this,e=this.data&&this.data.vo&&this.data.vo.eventId,t=h.Config.riskEvent()[e];if(t){var i=h.Config.riskEventDesc()[t.descId],n=JSON.parse(t.detail),a=n[1],r=(n[0],JSON.parse(i.buttonDesc)),s=function(i){var e=r[i],n=new eui.Button;n.skinName="skins.ButtonSkinLabel",n.label=e,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(parseInt(i)+1==a[o.curSequenceIndex])o.curSequenceIndex++,n.currentState="down",n.touchEnabled=!1,o.curSequenceIndex==a.length&&(o.opperationParams=1,o.hide());else for(var e in o.curSequenceIndex=0,o.gp_btns.$children){var t=o.gp_btns.$children[e];t&&(t.currentState="up"),t&&(t.touchEnabled=!0)}},c),c.gp_btns.addChild(n)},c=this;for(var l in r)s(l)}},e.prototype.makeBottomReward=function(){var e=this.data.vo;if(e&&e.eventId){var t=h.Config.riskEvent()[e.eventId];if(t&&1==t.isShow){var i=JSON.parse(t.detail)[0];i&&0<i.length&&this.addBottomReward(i)}else this.removeBottomReward()}},e}(h.BaseEpView);h.EpTriggerView=e,__reflect(e.prototype,"game.EpTriggerView")}(game||(game={})),function(s){var i=function(r){function c(){var e=null!==r&&r.apply(this,arguments)||this;return e.selectList=[],e.beginItem=[],e.rowCount=1,e.colCount=1,e.targetLength=0,e.touchBegin=!1,e}return __extends(c,r),c.prototype.childrenCreated=function(){var e=this.data&&this.data.vo&&this.data.vo.eventId;if(e){var t=s.Config.riskEvent()[e];if(t){var i=JSON.parse(t.detail),n=(i[0],i[1]),o=s.Config.riskEventUnicursal()[n],a=JSON.parse(o.detail);this.colCount=a[0],this.rowCount=a[1],this.curConfig=a[2],r.prototype.childrenCreated.call(this)}}},c.prototype.makeGpFree=function(){var s=this,e=new eui.TileLayout;e.requestedColumnCount=this.colCount,e.horizontalAlign="center",e.verticalAlign="middle",e.verticalGap=e.horizontalGap=18,this.gp_free.layout=e,this.gp_img.parent.removeChild(this.gp_img);var t=function(e){var t=n.curConfig[e],i=new o;0==(i.data=t)[2]&&(n.beginItem=t),i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){s.onTouchItem(t)},n),n.gp_free.addChild(i),t[2]!=c.BLOCK_STATUS.CANT_PASS&&n.targetLength++},n=this;for(var i in this.curConfig)t(i);this.reset(),this.gp_free.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){s.touchBegin=!0},this),this.gp_free.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){var t=s.gp_free.$children,i=s.gp_free.globalToLocal(e.stageX,e.stageY),n=i.x,o=i.y;for(var a in t){var r=t[a];if(n>=r.x&&n<=r.x+r.width&&o>=r.y&&o<=r.y+r.height)return void r.dispatchEvent(new egret.TouchEvent(egret.TouchEvent.TOUCH_BEGIN))}},this),this.gp_free.addEventListener(egret.TouchEvent.TOUCH_END,function(){s.touchBegin=!1,s.checkSucceed()},this),this.gp_free.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){s.touchBegin=!1,s.checkSucceed()},this)},c.prototype.onTouchItem=function(e){if(0==this.selectList.length&&this.equal(e,this.beginItem))return e[3]=c.DIR.PASS,this.selectList.push(e),void this.updateItem(e);if(2<=this.selectList.length&&this.equal(this.selectList[this.selectList.length-2],e)){var t=this.selectList.pop();return t[3]=c.DIR.UNTOUCH,t[4]=0,t[5]=0,this.updateItem(t),e[3]=c.DIR.PASS,e[4]=1,void this.updateItem(e)}var i=this.checkVaild(e);if(i){var n=this.selectList[this.selectList.length-1];return n[3]=i,n[4]=0,e[3]=c.DIR.PASS,e[4]=1,e[5]=i%2==0?i+1:i-1,this.selectList.push(e),this.updateItem(n),void this.updateItem(e)}},c.prototype.checkVaild=function(e){if(2==e[2])return 0;if(this.selectList.length<=0)return 0;for(var t in this.selectList){var i=this.selectList[t];if(this.equal(i,e))return 0}var n=this.selectList[this.selectList.length-1],o=n[0],a=n[1];if(e[1]==a){if(0<o-1&&e[0]==o-1)return c.DIR.UP;if(o+1<=this.rowCount&&e[0]==o+1)return c.DIR.DOWN}if(e[0]==o){if(0<a-1&&e[1]==a-1)return c.DIR.LEFT;if(a+1<=this.colCount&&e[1]==a+1)return c.DIR.RIGHT}return 0},c.prototype.updateItem=function(e){var t=(e[0]-1)*this.colCount+e[1]-1,i=this.gp_free.$children[t];i&&i.update(e)},c.prototype.checkSucceed=function(){var e=this;GameRootLayer.gameLayer().switchTouchEnable(!1),this.selectList.length!=this.targetLength||this.opperationParams?GameRootLayer.gameLayer().switchTouchEnable(!0):(this.opperationParams=1,egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0),e.hide()},this,1e3))},c.prototype.equal=function(e,t){return e[0]==t[0]&&e[1]==t[1]},c.prototype.reset=function(){for(var e in this.selectList.splice(0,this.selectList.length),this.curConfig){var t=this.curConfig[e];t[3]=c.DIR.UNTOUCH,t[4]=0,t[5]=0,this.updateItem(t)}},c.prototype.makeBtns=function(){var e=this;this.addBtn({text:"重置",cb:function(){e.reset()}}),this.addBtn({text:"放弃",cb:function(){e.opperationParams=0,e.hide()}})},c.prototype.makeBottomReward=function(){var e=this.data&&this.data.vo&&this.data.vo.eventId;if(e){var t=s.Config.riskEvent()[e];if(t){var i=JSON.parse(t.detail)[2];this.addBottomReward(i[0])}}},c.BLOCK_STATUS={BRGIN:0,CAN_PASS:1,CANT_PASS:2},c.DIR={UNTOUCH:0,PASS:1,UP:2,DOWN:3,LEFT:4,RIGHT:5},c}(s.BaseEpView);s.EpUnicursalView=i,__reflect(i.prototype,"game.EpUnicursalView");var o=function(t){function e(){var e=t.call(this)||this;return e.skinName="EPOneStrokeViewItem",e}return __extends(e,t),e.prototype.update=function(e){switch(this.img_begin.visible=!1,this.bm_begin.visible=!1,this.gp_arrow.visible=!1,this.gp_arrow2.visible=!1,this.img_arrow.visible=!1,e[2]){case i.BLOCK_STATUS.BRGIN:this.bm_begin.visible=!0;break;case i.BLOCK_STATUS.CAN_PASS:break;case i.BLOCK_STATUS.CANT_PASS:return void(this.img_bg.source="_event_m_json.mx_img_zgz_01")}switch(e[3]){case i.DIR.UNTOUCH:this.img_bg.source="_event_m_json.mx_img_zgz_02";break;case i.DIR.PASS:this.img_bg.source="_event_m_json.mx_img_zgz_03";break;case i.DIR.UP:this.img_bg.source="_event_m_json.mx_img_zgz_03",this.gp_arrow.visible=!0,this.gp_arrow.rotation=0;break;case i.DIR.DOWN:this.img_bg.source="_event_m_json.mx_img_zgz_03",this.gp_arrow.visible=!0,this.gp_arrow.rotation=180;break;case i.DIR.LEFT:this.img_bg.source="_event_m_json.mx_img_zgz_03",this.gp_arrow.visible=!0,this.gp_arrow.rotation=270;break;case i.DIR.RIGHT:this.img_bg.source="_event_m_json.mx_img_zgz_03",this.gp_arrow.visible=!0,this.gp_arrow.rotation=90}switch(this.img_arrow.visible=!!e[4]&&e[2]!=i.BLOCK_STATUS.BRGIN,e[5]){case i.DIR.UP:this.gp_arrow2.visible=!0,this.gp_arrow2.rotation=0,this.img_arrow.rotation=180;break;case i.DIR.DOWN:this.gp_arrow2.visible=!0,this.gp_arrow2.rotation=180,this.img_arrow.rotation=0;break;case i.DIR.LEFT:this.gp_arrow2.visible=!0,this.gp_arrow2.rotation=270,this.img_arrow.rotation=90;break;case i.DIR.RIGHT:this.gp_arrow2.visible=!0,this.gp_arrow2.rotation=90,this.img_arrow.rotation=270}},e}(eui.ItemRenderer);__reflect(o.prototype,"EPOneStrokeViewItem")}(game||(game={})),function(p){var e=function(){function e(){this.guideEffectCache={}}return e.prototype.clearCurEffect=function(e,t){for(var i in void 0===t&&(t=!1),this.guideEffectCache){var n=this.guideEffectCache[i];n.forEach(function(e){e&&e.parent&&(egret.Tween.removeTweens(e),e.parent.removeChild(e))}),n.splice(0),delete this.guideEffectCache[i]}var o=p.AppFacade.getInstance().retrieveMediator(p.GuajiMediator.N);o.guajiUI&&o.guajiUI.map&&o.guajiUI.map.curValidTouchPosXY.splice(0),!t&&e.length&&e.some(function(e){return e.isForce})||GameRootLayer.gameLayer().switchDarkMaskForGuide(!1)},e.prototype.showGuideMask=function(e){var t=egret.Point.create(0,0);e.x&&e.y?(t.x=e.x,t.y=e.y):t=e.component.localToGlobal(e.component.width/2,e.component.height/2,t);var i=e.r||(e.component.width+e.component.height)/4;i*=1.2,GameRootLayer.gameLayer().switchDarkMaskForGuide(!0,{x:t.x,y:t.y,r:i,maskCB:e.maskCB}),egret.Point.release(t)},e.prototype.addGuideEffect=function(t){var i=this,e=t.type,n=t.addOnView||!1,o=t.parent,a=t.component;if(!o)if(n)o=GameRootLayer.gameLayer().maskLayer;else if(a instanceof p.EventPoint){var r=p.AppFacade.getInstance().retrieveMediator(p.GuajiMediator.N);o=r.guajiUI.map}else o=a.addChild?a:a.parent;var s=egret.Point.create(0,0);switch(t.x&&t.y?(s.x=t.x,s.y=t.y):s=Utils.ComponentUtils.getPosInView(a,{x:a.width/2,y:a.height/2},o,s),e){case 1:var c=new eui.Image("xinshou_img_shouzhi_png");c.touchEnabled=!1,c.x=s.x,c.y=s.y,c.scaleX=1/o.scaleX,c.scaleY=1/o.scaleY,o.addChild(c);var l=t.dir||1;c.rotation=90*-(l-1);var h=c.y;egret.Tween.get(c,{loop:!0}).to({y:h-15},500).to({y:h},500),this.guideEffectCache[t.id].push(c),t.cb&&t.cb(),egret.Point.release(s);break;case 2:DragonBoneTools.create("common_dianji",function(e){i.guideEffectCache[t.id]&&(e.animation.play("common_dianji",0),e.scaleX=e.scaleY=1.5,e.x=s.x,e.y=s.y,e.scaleX=1/o.scaleX,e.scaleY=1/o.scaleY,o.addChild(e),i.guideEffectCache[t.id].push(e),t.cb&&t.cb()),egret.Point.release(s)},this,{groupName:"GuajiFixed"})}},e.prototype.addTips=function(e){var t=e.addOnView||e.isForce||!1;9<e.tipsDir[0]&&(t=!0);var i=e.component,n=e.parent;n||(n=t?GameRootLayer.gameLayer().maskLayer:i instanceof p.EventPoint?p.AppFacade.getInstance().retrieveMediator(p.GuajiMediator.N).guajiUI.map:i.addChild?i:i.parent);var o=0,a=0,r=e.tipsDir[0];9<r&&(r/=10);var s=i&&i.width||60,c=i&&i.height||60;r<3?a=3*-c/10:o=3*c/10,o=1==r||4==r?3*-s/10:3*s/10,i&&i instanceof p.EventPoint&&(a=-i.height),e.tipsDir[2]&&(o+=e.tipsDir[2][0],a+=e.tipsDir[2][1]);var l=egret.Point.create(0,0);e.x?(l.x=e.x+o,l.y=e.y+a):l=Utils.ComponentUtils.getPosInView(i,{x:i.width/2+o,y:i.height/2+a},n,l);var h=new p.TipsComponent([r,e.tipsDir[1]]);h.touchChildren=h.touchEnabled=!1,h.x=l.x,h.y=l.y,h.scaleX=1/n.scaleX,h.scaleY=1/n.scaleY,n.addChild(h),egret.Point.release(l),this.guideEffectCache[e.id].push(h)},e.prototype.addTips2=function(e){var t=new p.StoryViewForGuide({text:e.text});t.bottom=0,GameRootLayer.gameLayer().maskLayer.addChild(t),UIActionManager.playUIAction(t,3),this.guideEffectCache[e.id].push(t)},e}();p.GuideEffectManager=e,__reflect(e.prototype,"game.GuideEffectManager")}(game||(game={})),function(p){var e,t=function(i){function h(e){void 0===e&&(e=null);var t=i.call(this,h.N,e)||this;return t.proxy=p.AppFacade.getInstance().retrieveProxy(p.GuidePy.N),t.playerProxy=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N),t.curDoneStepInCurViewStack={},t}return __extends(h,i),Object.defineProperty(h.prototype,"guideUI",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),h.prototype.listNotificationInterests=function(){return[CN.LOGIN_FINAL_DONE,CN.GUIDE_MAKE_FLOW,CN.GUIDE_CHECK_CUR_STEP,CN.GUIDE_NET_RESP,CN.GUIDE_VIEW_STACK_CHANGE,CN.GUAJI_ENTER_EP,CN.GUAJI_ENTER_LAYER,CN.PLAYER_LEVEL_UP,CN.GUAJI_MAP_ON_TOUCH_TILE_POS,CN.GUAJI_ON_ME_STOP_ON,CN.TASK_UPDATE]},h.prototype.handleNotification=function(e){var r=this,t=e.getBody();if(Utils.isNeedGuide)switch(e.getName()){case CN.GUAJI_ON_ME_STOP_ON:p.AppFacade.getInstance().retrieveMediator(p.GuajiMediator.N);this.proxy.curTodoStep.some(function(e){return e.operation[0]==GuideOperationType.EVENT_INTERACT&&e.isForce})&&GameRootLayer.gameLayer().switchTouchEnable(!0);var i=function(e){var t=n.proxy.waitingServerSteps[e];if(t.operation[0]==GuideOperationType.MAP_GUIDE){var i=0;t.target.some(function(e){return e[0]==GuideConditionSubType.GUIDE_RECODRD&&(i=e[1][0],!0)})&&n.proxy.setGuideInfo(i)}},n=this;for(var o in this.proxy.waitingServerSteps)i(o);break;case CN.GUAJI_MAP_ON_TOUCH_TILE_POS:if(t.source&&t.source==MODULE.Risk)0<p.AppFacade.getInstance().retrieveMediator(p.GuajiMediator.N).guajiUI.map.curValidTouchPosXY.length&&(this.proxy.clearCurEffect(!0),GameRootLayer.gameLayer().switchTouchEnable(!1));break;case CN.TASK_UPDATE:(t.type==TaskType.Guide&&t.newTask||t.type==TaskType.HideAchievement)&&this.proxy.makeTodoFlow();break;case CN.GUAJI_ENTER_LAYER:case CN.PLAYER_LEVEL_UP:case CN.BACKPACK_UPDATE:case CN.GUIDE_MAKE_FLOW:this.proxy.makeTodoFlow();break;case CN.GUIDE_VIEW_STACK_CHANGE:case CN.GUIDE_CHECK_CUR_STEP:this.proxy.checkCurStep();break;case CN.GUIDE_NET_RESP:var s=t.split(".")[0],c=this.proxy.waitingServerSteps,a=function(i){var n=c[i],o=n.target,a=[];if(o.forEach(function(e){var t=h.GUIDE_WAIT_EVENT_MAP[e[0]]||h.GUIDE_WAIT_EVENT_MAP[Math.floor(e[0]/10)];t&&(a=a.concat(t))}),a.length&&-1!=a.indexOf(s)){var e=function(e){if(c[i]&&r.proxy.checkAllTarget(o)){delete c[i],r.log("stepId:"+n.id+"|flowId:"+n.belongFlow.id+"条件已完成，移除等待队列"),r.autoPopupView(n);var t=function(){n.stepsCache&&(r.proxy.uselessSteps=r.proxy.uselessSteps.concat(n.stepsCache)),r.proxy.makeTodoFlow(),e&&e()};0<n.tipsAfter.length?r.proxy.showStoryViewWithoutCheck({storyConfig:n.tipsAfter,cb:t}):t()}};n.operation[0]==GuideOperationType.MAP_GUIDE&&n.isForce?egret.setTimeout(function(){e(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)})},l,100):egret.setTimeout(e,l,100)}},l=this;for(var o in c)a(o)}},h.prototype.autoPopupView=function(e){Utils.SDKMgr.getPerformConfig(10021)&&(260==e.id&&(p.GameMVC.activityPy.operationHasExec(OperationType.Act_ShouCangYouLi),egret.setTimeout(function(){getUrlKV().channel&&!p.GameMVC.activityPy.operationHasExec(OperationType.Act_ShouCangYouLi)&&p.AppFacade.getInstance().sendNotification(CN.QQZONE_POPUP_VIEW,{type:2})},this,600)),111==e.id&&egret.setTimeout(function(){"QQLive"==getUrlKV().channel&&p.AppFacade.getInstance().sendNotification(CN.QQZONE_POPUP_VIEW,{type:1})},this,600),1142==e.id&&egret.setTimeout(function(){p.AppFacade.getInstance().sendNotification(CN.QQZONE_POPUP_VIEW,{type:3}),p.AppFacade.getInstance().sendNotification(CN.GUIDE_FIRST_CHARPTER_END)},this,600))},h.N="GuideMediator",h.GUIDE_WAIT_EVENT_MAP=((e={})[GuideConditionType.TASK]=["task"],e[GuideConditionType.HERO]=["hero"],e[GuideConditionType.GACHA]=["gashapon"],e[GuideConditionType.RISK]=["risk"],e[GuideConditionType.BAG]=["bag"],e[GuideConditionSubType.GUIDE_RECODRD]=["loginGame"],e),h}(BaseMediator);p.GuideMediator=t,__reflect(t.prototype,"game.GuideMediator")}(game||(game={})),function(U){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.guajiProxy=U.AppFacade.getInstance().retrieveProxy(U.GuajiPy.N),e.taskProxy=U.AppFacade.getInstance().retrieveProxy(U.TaskPy.N),e.playerProxy=U.AppFacade.getInstance().retrieveProxy(U.PlayerPy.N),e.backpackProxy=U.AppFacade.getInstance().retrieveProxy(U.BackpackPy.N),e.championProxy=U.AppFacade.getInstance().retrieveProxy(U.ChampionPy.N),e.loginProxy=U.AppFacade.getInstance().retrieveProxy(U.LoginPy.N),e.heroPy=U.AppFacade.getInstance().retrieveProxy(U.HeroPy.N),e.heroThingPy=U.AppFacade.getInstance().retrieveProxy(U.HeroThingPy.N),e.BASE_TYPE={BUTTON:{className:eui.Button,sensitiveParent:[]},IMAGE:{className:eui.Image,sensitiveParent:[eui.ItemRenderer,U.HeroMainView_HeroListItem]}},e.serverGuideInfo={},e.curTodoFlow=new Array,e.curTodoStep=new Array,e.uselessSteps=new Array,e.waitingServerSteps={},e.effectManager=new U.GuideEffectManager,window._p=e}return __extends(i,t),Object.defineProperty(i.prototype,"isInMapGuide",{get:function(){return this._isInMapGuide},enumerable:!0,configurable:!0}),i.prototype.setInMapGuide=function(e){this._isInMapGuide=e},i.prototype.makeTodoFlow=function(){this.curTodoFlow.splice(0);var e=U.Config.guideFlowConfig(),t=U.GameMVC.playerPy.playerInfoVO.level;for(var i in this.log("--------------------MAKE FLOW(BEGIN)----------------------"),e){var n=e[i],o=!1,a=!1;if((0==n.levelLimit||n.levelLimit>t)&&n.enable){var r=JSON.parse(n.cond),s=JSON.parse(n.target);if(o=!this.checkAllTarget(s),n.targetDone){a=!0;continue}o?o=this.checkAllCondition(r):s.every(function(e){var t=e[0];return Math.floor(t/10)!=GuideConditionType.RISK})&&(n.targetDone=!0)}if(o){var c=new U.GuideFlow(n);this.curTodoFlow.push(c)}this.log("id:"+i+"\t描述："+n.remarks+"\t\t有效："+o+"\t\t跳过："+(a?"是":"否"))}this.log("--------------------MAKE FLOW(END)----------------------"),this.checkCurStep(!0)},i.prototype.checkCurStep=function(e){var i=this;if(void 0===e&&(e=!1),this.curTodoStep.splice(0),this.curTodoFlow.forEach(function(e,t){e.steps.forEach(function(e){var t=i.checkAllCondition(e.cond);t&&(t=!i.checkAllTarget(e.target)),t&&i.curTodoStep.push(e)})}),0<this.curTodoStep.length?this.uselessSteps.splice(0):0<this.uselessSteps.length&&this.uselessSteps.forEach(function(e){e.showTimes=0;var t=i.checkAllCondition(e.cond);t&&(t=!i.checkAllTarget(e.target)),t&&i.curTodoStep.push(e)}),this.curTodoStep.some(function(e){return e.isForce}))for(var t=this.curTodoStep.length;t--;)this.curTodoStep[t].isForce||this.curTodoStep.splice(t,1);this.clearCurEffect(e),this.handleTodoSteps()},i.prototype.clearCurEffect=function(e){void 0===e&&(e=!1),this.effectManager.clearCurEffect(this.curTodoStep,e)},i.prototype.handleTodoSteps=function(){var t=this;if(0<this.curTodoStep.length)if(this.curTodoStep.some(function(e){if(e.isForce&&0<e.showTimes&&t.checkAllTarget(e.belongFlow.target))return!0}))this.makeTodoFlow();else{var e=1==this.curTodoStep[0].operation[0]?this.curTodoStep[0].operation[1][0].split("#")[0]:GameRootLayer.gameLayer().getCurViewSkinName(),i=GameRootLayer.gameLayer().getViewBySkinName(e);i.adaptForGuide(this.curTodoStep.some(function(e){return e.isForce}));GameRootLayer.gameLayer().switchTouchEnable(!1),i.setGuideCB(function(){t.curTodoStep.forEach(function(e){!e.tipsShowed&&0<e.tips.length?(t.showStoryViewWithoutCheck({storyConfig:e.tips,cb:function(){t.registerEffectForStep(e)}}),e.tipsShowed=!0):t.registerEffectForStep(e)}),GameRootLayer.gameLayer().switchTouchEnable(!0)})}},i.prototype.registerEffectForStep=function(i){var n=this;if(0<i.operation.length){i.showTimes+=1;var e=i.operation,t=e[0],o=e[1],a=this.effectManager.guideEffectCache;switch(a[i.id]?a[i.id].length&&(a[i.id].forEach(function(e){e&&e.parent&&(egret.Tween.removeTweens(e),e.parent.removeChild(e))}),a[i.id].splice(0)):a[i.id]=[],t){case GuideOperationType.BUTTON_TAP:var r=Utils.ComponentUtils.getComponentByName(o[0]);if(r&&r.parent){Utils.ComponentUtils.getBaseView(r);i.isForce&&this.effectManager.showGuideMask({component:r}),this.registGuideEffectForComp(r,i),i.isKeyOppr&&r.once(egret.TouchEvent.TOUCH_TAP,function(){n.onKeyOperateStep(i)},this)}break;case GuideOperationType.DRAG:var s=Utils.ComponentUtils.getComponentByName(o[0]),c=Utils.ComponentUtils.getComponentByName(o[1]);if(s&&c){var l=new eui.Image("xinshou_img_shouzhi_png");l.touchEnabled=!1;var h=s.x,p=s.y;l.x=s.width/2+h,l.y=s.height/2+p,s.parent.addChild(l);var d=[c.x-s.x+c.width/2+h,c.y-s.y+c.height/2+p];egret.Tween.get(l,{loop:!0}).to({x:d[0],y:d[1]},700),egret.setTimeout(function(){l.parent&&l.parent.removeChild(l)},this,2100),this.effectManager.guideEffectCache[i.id].push(l)}break;case GuideOperationType.MAP_GUIDE:var u=(y=U.AppFacade.getInstance().retrieveMediator(U.GuajiMediator.N)).guajiUI&&y.guajiUI.map,g=o[0],f=o[1],_=u.tile2Pos(g,f,!0),m=u.localToGlobal(_.x,_.y-38*u.scaleY);i.isForce?(u.curValidTouchPosXY.push({tileX:g,tileY:f}),this.effectManager.showGuideMask({x:m.x,y:m.y,r:35,maskCB:function(){u.handleTouchTap(g,f)}}),this.effectManager.addGuideEffect({type:1,parent:GameRootLayer.gameLayer().maskLayer,x:m.x,y:m.y,isForce:!0,id:i.id})):(this.effectManager.addGuideEffect({type:1,parent:u,x:_.x,y:_.y,id:i.id}),U.GameMVC.fightPy.addDelayCBAfterFightExit(function(){egret.setTimeout(function(){var t=0;if(i.target.some(function(e){return e[0]==GuideConditionSubType.GUIDE_RECODRD&&(t=e[1][0],!0)}),t){var e="MapGuide_"+t;Utils.TouchUtils.hasGlobalTouch(e)||Utils.TouchUtils.addGlobalTouch(function(){Utils.TouchUtils.removeGlobalTouch(e),n.setGuideInfo(t)},e)}U.GameMVC.fightPy.queueExceExitCB()},n,100)},"MAP_GUIDE")),0<i.tipsDir.length&&this.effectManager.addTips({parent:i.isForce?GameRootLayer.gameLayer().maskLayer:u,x:i.isForce?m.x:_.x,y:i.isForce?m.y:_.y,id:i.id,tipsDir:i.tipsDir}),0<i.tipsDir2.length&&this.effectManager.addTips2({text:i.tipsDir2[1],id:i.id}),this.waitingServerSteps[i.id]||(this.waitingServerSteps[i.id]=i);break;case GuideOperationType.EVENT_INTERACT:var y,v=(y=U.AppFacade.getInstance().retrieveMediator(U.GuajiMediator.N)).guajiUI&&y.guajiUI.map;if(v){var T=v.getEpByEventId(o[0]);if(T){if(i.isForce)this.effectManager.showGuideMask({component:T}),U.AppFacade.getInstance().retrieveMediator(U.GuajiMediator.N).guajiUI.map.curValidTouchPosXY.push({tileX:T.vo.position.x,tileY:T.vo.position.y});this.registGuideEffectForComp(T,i)}}}}},i.prototype.registGuideEffectForComp=function(e,t){var i=this,n=t.figType,o=t.isForce;10<=t.figType&&(n=Math.floor(n/10),o=!0);var a=Number(t.figDir);3==n?this.effectManager.addGuideEffect({type:2,component:e,addOnView:o,dir:a,id:t.id,cb:function(){i.effectManager.addGuideEffect({type:1,component:e,addOnView:o,id:t.id,dir:a})}}):this.effectManager.addGuideEffect({type:n,component:e,addOnView:o,id:t.id,dir:a}),0<t.tipsDir.length&&this.effectManager.addTips({component:e,tipsDir:t.tipsDir,id:t.id,isForce:t.isForce}),0<t.tipsDir2.length&&this.effectManager.addTips2({text:t.tipsDir2[1],id:t.id})},i.prototype.checkAllCondition=function(e){var t=this,i=!0;return e.forEach(function(e){t.checkCondition(e[0],e[1])||(i=!1)}),i},i.prototype.checkAllTarget=function(e){var t=!0;if(e.length)for(var i=0,n=e;i<n.length;i++){var o=n[i];if(o[0]==GuideConditionSubType.GUIDE_RECODRD){t=this.checkCondition(o[0],o[1]);break}t=this.checkCondition(o[0],o[1])&&t}else t=!1;return t},i.prototype.checkCondition=function(e,t){var i=!1;try{switch(e){case GuideConditionSubType.PLAYER_LEVEL_MATCH:1===t[0]?i=this.playerProxy.playerInfoVO.level===t[1]:2===t[0]?i=this.playerProxy.playerInfoVO.level<t[1]:3===t[0]?i=this.playerProxy.playerInfoVO.level>=t[1]:4===t[0]&&(i=this.playerProxy.playerInfoVO.level>=t[1]&&this.playerProxy.playerInfoVO.level<=t[2]);break;case GuideConditionSubType.VIEW_STACK:var n=GameRootLayer.gameLayer().getCurViewSkinName();i=t[0]==n;break;case GuideConditionSubType.VIEW_STACK_NOT:var o=GameRootLayer.gameLayer().getCurViewStack();if(0<o.panelLayer.length||1<o.mainLayer.length)i=!1;else{n=GameRootLayer.gameLayer().getCurViewSkinName();i=t[0]!=n}break;case GuideConditionSubType.VIEW_CUR_RISK_TYPE:0==t[0]?i=this.guajiProxy.curLayerInfo.position.type!=t[0]:1==t[0]&&(i=this.guajiProxy.curLayerInfo.position.type==t[0]);break;case GuideConditionSubType.GUIDE_RECODRD:this.serverGuideInfo[t[0]]&&(i=!0);break;case GuideConditionSubType.GUIDE_FLOW_TARGET:var a=U.Config.guideFlowConfig()[t[0]],r=JSON.parse(a.target);0!=a.levelLimit&&(i=U.GameMVC.playerPy.playerInfoVO.level>=a.levelLimit),i||(i=this.checkAllTarget(r));break;case GuideConditionSubType.GUIDE_FLOW_COND:a=U.Config.guideFlowConfig()[t[0]];var s=JSON.parse(a.cond);i=this.checkAllTarget(s);break;case GuideConditionSubType.GACHA_HTIMES:this.heroPy.gashaponInfo[t[0]]&&(i=this.heroPy.gashaponInfo[t[0]].hTimes>=t[1]);break;case GuideConditionSubType.TASK_GUIDE_TASK_CUR_CODE:i=(f=this.taskProxy.getCurGuideTask())&&f.code==t[0];break;case GuideConditionSubType.TASK_GUIDE_TASK_STATUS:var c=t[0],l=t[1],h=TaskStatus.UNDONE,p=!1;for(var d in this.taskProxy.allTasks){var u=this.taskProxy.allTasks[d];for(var g in u){var f;if((f=u[g]).code==c){p=!0,h=this.taskProxy.getTaskStatus(f);break}}}if(!p&&U.Config.taskConfig()[c].type==TaskType.Guide){var _=this.taskProxy.getCurGuideTask();(!_||_.code>c)&&(h=TaskStatus.RECEIVE)}i=l==h;break;case GuideConditionSubType.HERO_HAS_HERO_LEVEL_GREATER:for(var m in this.heroPy.allHeroByUuid){if(this.heroPy.allHeroByUuid[m].level>=t[0]){i=!0;break}}break;case GuideConditionSubType.HERO_HAS_HERO_SECTION_GREATER:for(var m in this.heroPy.allHeroByUuid){if(this.heroPy.allHeroByUuid[m].sectionLevel>=t[0]){i=!0;break}}break;case GuideConditionSubType.HERO_POS_OCCUPY:i=(this.heroPy.heroUuid22Pos[t[0]]?1:0)==t[1];break;case GuideConditionSubType.HERO_CUR_SELECTED:if("HeroMainViewSkin"==GameRootLayer.gameLayer().getCurViewSkinName())if(C=U.AppFacade.getInstance().retrieveMediator(U.HeroMediator.N).getSubView(U.HeroMediator.SV.MAIN))i=1==t[0]==(this.heroPy.heroUuid22Pos[C.curUuid]==t[1]);break;case GuideConditionSubType.HERO_VIEW_CUR_INDEX:if("HeroMainViewSkin"==GameRootLayer.gameLayer().getCurViewSkinName())if(C=U.AppFacade.getInstance().retrieveMediator(U.HeroMediator.N).getSubView(U.HeroMediator.SV.MAIN))i=1==t[0]==(C.curType==t[1]);break;case GuideConditionSubType.HERO_HAS_FREE:var y=0,v=this.heroPy.allHeroByUuid;for(var m in v)if(!v[m].pos&&++y>=t[0]){i=!0;break}break;case GuideConditionSubType.HERO_NO_SUBTYPE_ON_FORM:i=!0;for(var T=1;T<7;T++){if(this.heroPy.heroUuid22Pos[T])if(this.heroPy.allHeroByUuid[this.heroPy.heroUuid22Pos[T]].config.subType==t[0]){i=!1;break}}break;case GuideConditionSubType.BAG_HAS_ENOUGH:i=this.backpackProxy.checkEnough([[t[0],t[1],t[2]]]);break;case GuideConditionSubType.BAG_VIEW_CUR_INDEX:var C;if("BackpackUISkin"==GameRootLayer.gameLayer().getCurViewSkinName())if(C=U.AppFacade.getInstance().retrieveMediator(U.BackpackMediator.N).getSubView(U.BackpackMediator.SV.MAIN))i=1==t[0]==(C.tabbar_type.selectedIndex==t[1]);break;case GuideConditionSubType.BAG_CHIP_AVAILABLE:c=t[0];i=this.backpackProxy.checkChipNotice(c);break;case GuideConditionSubType.BAG_EQUIP_AVAILABLE:c=t[0];var E=this.heroThingPy.AllEquipInfo;for(var m in E){var b=E[m];if((0==c||b.config.code==c)&&""==b.heroUuid){i=!0;break}}break;case GuideConditionSubType.BAG_ARTIFACT_AVAILABLE:c=t[0];var I=this.heroThingPy.AllArtiInfo;for(var m in I){var A=I[m];if((0==c||A.config.code==c)&&""==A.heroUuid){i=!0;break}}break;case GuideConditionSubType.TOWER_LEVEL_PASS:this.championProxy&&this.championProxy.championInfo&&(i=this.championProxy.championInfo.id>t[0]);break;case GuideConditionSubType.FIRST_RECHARGE_OPEN:var P=U.AppFacade.getInstance().retrieveProxy(U.RechargePy.N);i=P.isFirstRechargeOpen()&&1==t[0]||!P.isFirstRechargeOpen()&&0==t[0];break;case GuideConditionSubType.RISK_EVENT_EXIST:var S=(N=U.AppFacade.getInstance().retrieveMediator(U.GuajiMediator.N)).guajiUI&&N.guajiUI.map;S&&(i=!!S.getEpByEventId(t[0]));break;case GuideConditionSubType.RISK_EVENT_COMPLETE:var N=U.AppFacade.getInstance().retrieveMediator(U.GuajiMediator.N),M=(a=U.Config.riskEvent()[t[0]],N.guajiUI&&N.guajiUI.map&&N.guajiUI.map.getEpByEventId(t[0]));switch(a.type){case RiskEventType.Mine:i=M&&!M.checkNotice();break;case RiskEventType.Fortress:i=M&&M.vo.info.hasEnter;break;case RiskEventType.Tavern:case RiskEventType.Box:case RiskEventType.Quora:case RiskEventType.Creep:i=!M}break;case GuideConditionSubType.RISK_CUR_POS:var w=(N=U.AppFacade.getInstance().retrieveMediator(U.GuajiMediator.N)).guajiUI&&N.guajiUI.map&&N.guajiUI.map.me;w&&(i=w.tileX==t[0]&&w.tileY==t[1]);break;case GuideConditionSubType.ACTIVITY_OPEN:U.GameMVC.activityPy.allActivityData[t[0]]&&(i=!0);break;case GuideConditionSubType.UNLOCK_ID_UNLOCK:var k=t[0],R=1===t[1];if((i=R===Utils.UnlockMgr.checkPass(k,!1).allow)&&!0===R)switch(k){case MODULE.WorldKing:i=U.GameMVC.worldKingPy.getOpenInfo().isOpen;break;case MODULE.TeamArena:i=U.GameMVC.battleZoneArenaPy.getOpenInfo().isOpen;break;case MODULE.ServerBoss:i=U.GameMVC.worldBossPy.getOpenInfo().isOpen}}}catch(e){egret.error("checkCondition exception",e)}return i},i.prototype.showStoryViewWithoutCheck=function(e){var t=new U.StoryView(e);t.checkForGuide=!1,PopUpManager.addPopUp({obj:t})},i.prototype.onKeyOperateStep=function(e){if(!this.waitingServerSteps[e.id]){this.waitingServerSteps[e.id]=e,this.log("id"+e.id+"加入等待队列");var t=0;e.target.some(function(e){return e[0]==GuideConditionSubType.GUIDE_RECODRD&&(t=e[1][0],!0)})&&this.setGuideInfo(t)}},i.prototype.setGuideInfo=function(t){Utils.Socket.send("loginGame","SetGuideInfo",{guide:t.toString()}).then(function(e){U.AppFacade.getInstance().retrieveProxy(i.N).serverGuideInfo[t]=1})},i.prototype.checkComponentName=function(e){var t=this.getValidCompForGuide(e);return this.log("有效控件：",t),Utils.ComponentUtils.getBaseView(t)?Utils.ComponentUtils.getNameOfComponent(t):"无可用BaseView"},i.prototype.getValidCompForGuide=function(e){var t=e;for(var i in this.BASE_TYPE){var n=this.BASE_TYPE[i];if(e instanceof n.className){if(!(0<n.sensitiveParent.length))break;for(var o in n.sensitiveParent){for(var a=n.sensitiveParent[o],r=e;r&&!(r instanceof a);)r=r.parent;if(r){t=r;break}}break}}return t},i.N="GuideProxy",i}(BaseProxy);U.GuidePy=e,__reflect(e.prototype,"game.GuidePy")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="Guajiview",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(BaseView);e.GuideView=t,__reflect(t.prototype,"game.GuideView")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.curIndex=-1,t.talkSpeed=2e3,t.timeout=2e3,t.labelShowDt=1e3,t.labelDismissDt=1e3,t.labelPopDt=15e3,t.cb=e.cb,t.content=JSON.parse(e.content),t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this);var e=new egret.Sprite;this.addChild(e),e.touchEnabled=!1,e.graphics.clear(),e.graphics.beginFill(0,.8),e.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),e.graphics.endFill(),this.gp_content=new eui.Group,this.gp_content.width=this.gp_content.height=700,this.gp_content.horizontalCenter=0,this.gp_content.verticalCenter=0,this.addChild(this.gp_content);var t=new eui.Label;t.textColor=12829635,t.size=26,t.bold=!0,t.touchEnabled=!1,t.text="点击屏幕跳过",t.horizontalCenter=0,t.bottom=100,this.addChild(t),UIActionManager.fadeBlink(t,!0,void 0,1e3),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showAll,this),this.TimeoutTimer=new egret.Timer(this.timeout,1),this.goPlay()},e.prototype.finish=function(){this.hide(),this.cb&&this.cb()},e.prototype.goPlay=function(){var t=this;this.TimeoutTimer.stop();var e=this.content.length;this.ContentTimer=new egret.Timer(this.talkSpeed,e);var i=function(){if(t.ContentTimer){var e=new eui.Label(t.content[++t.curIndex]);e.bold=!0,e.horizontalCenter=0,e.touchEnabled=!1,e.alpha=0,e.y=600,t.gp_content.addChild(e),egret.Tween.get(e).to({alpha:1},t.labelShowDt).wait(t.labelPopDt-t.labelShowDt-t.labelDismissDt).to({alpha:0},t.labelDismissDt),egret.Tween.get(e).to({y:0},t.labelPopDt).call(function(){e.parent==t.gp_content&&t.gp_content.removeChild(e),0==t.gp_content.numChildren&&t.finish()})}};this.ContentTimer.addEventListener(egret.TimerEvent.TIMER,i,this),i(),this.ContentTimer.start()},e.prototype.showAll=function(){if(this.ContentTimer){this.ContentTimer.stop(),this.ContentTimer=void 0,this.gp_content.removeChildren();var e=new eui.Label;e.horizontalCenter=0,e.verticalCenter=0,e.bold=!0,e.lineSpacing=50,e.textAlign=egret.HorizontalAlign.CENTER;for(var t=0,i=this.content;t<i.length;t++){var n=i[t];e.appendText(n+"\n")}this.gp_content.addChild(e)}else this.finish()},e.STORAGE_PREFIX="BigStoryView",e}(BasePanel);e.BigStoryView=t,__reflect(t.prototype,"game.BigStoryView")}(game||(game={})),function(o){var e=function(i){function n(e){var t=i.call(this)||this;return t.curIndex=-1,t.talkSpeed=20,t.timeout=2e3,t.onclose=!1,t.skinName="StoryViewSkin",t.cb=e.cb,t.storyConfig=e.storyId&&JSON.parse(o.Config.storyConfig()[e.storyId].subs)||e.storyConfig,t.quoraConfig=e.quoraId&&o.Config.riskQuora()[e.quoraId],t.questionConfig=e.questionId&&o.Config.questionConfig()[e.questionId],t.position=e.position,t._popActionType=3,t._removeActionType=4,t}return __extends(n,i),n.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.list_selection.itemRenderer=a,this.scl_heroModel.scrollPolicyH=this.scl_heroModel.scrollPolicyV=eui.ScrollPolicy.OFF,this.TimeoutTimer=new egret.Timer(this.timeout,1),this.TimeoutTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){e.nextStep()},this),this.gp_text.alpha=0,this.gp_text.rotation=-90,this.heroModel.update({model:"hero_009_01",isStatic:!0}),egret.setTimeout(function(){egret.Tween.get(e.gp_text).to({rotation:0,alpha:1},200).call(function(){e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onViewTouch,e),e.btn_fanhui.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},e),e.nextStep()})},this,500)},n.prototype.onViewTouch=function(){var e=this;this.targetConfig&&20001==this.targetConfig.id?(this.visible=!1,o.AppFacade.getInstance().showSubView(o.PlayerMediator.N,o.PlayerMediator.SV.ROLE_NAME,{clickDarkClose:!1,closeCB:function(){e.visible=!0,e.nextStep()}})):this.nextStep()},n.prototype.nextStep=function(){var e=this;if(this.list_selection.visible=!1,this.TimeoutTimer.stop(),this.ContentTimer&&this.ContentTimer.running)this.showAll();else if(this.curIndex++,this.targetConfig=void 0,this.storyConfig&&this.storyConfig[this.curIndex]?(this.curType=n.TYPE.DIALOG,this.targetConfig=o.Config.storySubConfig()[this.storyConfig[this.curIndex]]):(this.curType=n.TYPE.QUESTION,this.curIndex=-1,this.targetConfig=this.questionConfig),this.lb_content.text="",this.lb_others.text="",this.targetConfig)if(0==this.curIndex&&null==this.isOtherSpeaking){var t=!!this.targetConfig.others;this.gp_content.visible=!t,this.lb_others.visible=t,this.isOtherSpeaking=t,this.curIndex=-1,this.nextStep()}else{if(this.targetContent=this.targetConfig.content||this.targetConfig.question,-1!=this.targetContent.indexOf("%s")&&(this.targetContent=this.targetContent.format([o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N).playerInfoVO.name])),!this.targetContent)return;var i=this.targetContent.length;if(this.targetLabel=1==this.targetConfig.others?this.lb_others:this.lb_content,1==this.targetConfig.others)this.isOtherSpeaking||(this.gp_content.visible=!1,this.lb_others.visible=!0),this.isOtherSpeaking=!0;else{this.isOtherSpeaking&&(this.lb_others.visible=!1,this.gp_content.visible=!0);this.curType==n.TYPE.DIALOG?(this.targetConfig.npcUrl,this.targetConfig.npcName,2==this.targetConfig.flipX?(this.gp_content.scaleX=-1,this.lb_npcName.scaleX=-1,this.lb_content.scaleX=-1,this.list_selection.scaleX=-1):(this.gp_content.scaleX=1,this.lb_npcName.scaleX=1,this.lb_content.scaleX=1,this.list_selection.scaleX=1)):(this.quoraConfig.model,this.questionConfig.title),this.isOtherSpeaking=!1}this.ContentTimer=new egret.Timer(this.talkSpeed,i),this.ContentTimer.addEventListener(egret.TimerEvent.TIMER,function(){e.ContentTimer&&(e.targetLabel.text=e.targetContent.slice(0,e.ContentTimer.currentCount))},this),this.ContentTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){e.showAll()},this),this.ContentTimer.start()}else this.onclose||(this.onclose=!0,this.onClose())},n.prototype.showAll=function(){this.ContentTimer.stop(),this.ContentTimer=void 0,this.targetLabel.text=this.targetContent,this.onAllContentShow()},n.prototype.onAllContentShow=function(){switch(this.curType){case n.TYPE.DIALOG:this.TimeoutTimer.reset();break;case n.TYPE.QUESTION:this.btn_fanhui.visible=!0,this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onViewTouch,this),this.hide()}},n.prototype.onClose=function(e){this.gp_content.visible=!1,this.hide(),this.cb&&this.cb(e)},n.TYPE={DIALOG:1,QUESTION:2},n.STORAGE_PREFIX="StoryView",n}(BasePanel);o.StoryView=e,__reflect(e.prototype,"game.StoryView");var t=function(i){function e(e){var t=i.call(this)||this;return t.curIndex=-1,t.talkSpeed=20,t.timeout=2e3,t.onclose=!1,t.skinName="StoryViewSkin2",t.cb=e.cb,t.storyConfig=e.storyId&&JSON.parse(o.Config.storyConfig()[e.storyId].subs)||e.storyConfig,t.quoraConfig=e.quoraId&&o.Config.riskQuora()[e.quoraId],t.questionConfig=e.questionId&&o.Config.questionConfig()[e.questionId],t.position=e.position,t._popActionType=3,t._removeActionType=4,t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.TimeoutTimer=new egret.Timer(this.timeout,1),this.TimeoutTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){e.nextStep()},this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onViewTouch,this),this.nextStep()},e.prototype.onViewTouch=function(){this.nextStep()},e.prototype.nextStep=function(){var e=this;if(this.TimeoutTimer.stop(),this.ContentTimer&&this.ContentTimer.running)this.showAll();else if(this.curIndex++,this.targetConfig=o.Config.storySubConfig()[this.storyConfig[this.curIndex]],this.lb_content.text="",this.targetConfig){if(this.targetContent=this.targetConfig.content||this.targetConfig.question,-1!=this.targetContent.indexOf("%s")&&(this.targetContent=this.targetContent.format([o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N).playerInfoVO.name])),!this.targetContent)return;var t=this.targetContent.length;2==this.targetConfig.flipX?this.img_bg.source="xinshou_img_juese_png":this.img_bg.source="xinshou_img_fuwan_png",this.ContentTimer=new egret.Timer(this.talkSpeed,t),this.ContentTimer.addEventListener(egret.TimerEvent.TIMER,function(){e.ContentTimer&&(e.lb_content.text=e.targetContent.slice(0,e.ContentTimer.currentCount))},this),this.ContentTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){e.showAll()},this),this.ContentTimer.start()}else this.onclose||(this.onclose=!0,this.onClose())},e.prototype.showAll=function(){this.ContentTimer.stop(),this.ContentTimer=void 0,this.lb_content.text=this.targetContent,this.onAllContentShow()},e.prototype.onAllContentShow=function(){this.TimeoutTimer.reset()},e.prototype.onClose=function(e){this.gp_content.visible=!1,this.hide(),this.cb&&this.cb(e)},e.TYPE={DIALOG:1,QUESTION:2},e.STORAGE_PREFIX="StoryView",e}(BasePanel);o.StoryView2=t,__reflect(t.prototype,"game.StoryView2");var i=function(i){function e(e){var t=i.call(this)||this;return t.skinName="StoryViewForGuideSkin",t.data=e,t.storyConfig=e.storyId&&JSON.parse(o.Config.storyConfig()[e.storyId].subs)||e.storyConfig,t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.gp_text.alpha=0,this.gp_text.rotation=-90,this.heroModel.update({model:"hero_009_01",isStatic:!0}),egret.setTimeout(function(){egret.Tween.get(e.gp_text).to({rotation:0,alpha:1},200).call(function(){e.update()})},this,500)},e.prototype.update=function(){this.lb_content.text=this.data.text},e}(BasePanel);o.StoryViewForGuide=i,__reflect(i.prototype,"game.StoryViewForGuide");var a=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuajiQuoraAnswerItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var i=this;this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(i.data.isFade)i.data.cb(parseInt(i.data.index)+1);else{var e=[];if(i.data.question.costs&&(e=JSON.parse(i.data.question.costs)[parseInt(i.data.index)]),e)if(!o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N).checkEnough(e,!0))return void(i.currentState="up");if(i.data.cb&&i.data.cb(parseInt(i.data.index)+1),i.data.question.story){var t=JSON.parse(i.data.question.story);PopUpManager.addPopUp({obj:new o.StoryView({storyId:t[parseInt(i.data.index)+1-1],questionId:void 0,position:void 0,cb:function(){o.AppFacade.getInstance().retrieveProxy(o.GuajiPy.N).Answer(parseInt(i.data.index)+1,i.data.position)}})})}else{o.AppFacade.getInstance().retrieveProxy(o.GuajiPy.N).Answer(parseInt(i.data.index)+1,i.data.position)}}},this)},e.prototype.dataChanged=function(){this.lb_answer.text=this.data.answer},e}(eui.ItemRenderer);__reflect(a.prototype,"AnswerItem");var n=function(i){function e(e){var t=i.call(this)||this;return t.skinName="TipsComponentSkin",t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.direction=this.data[0],this.lb_tips.text=this.data[1]},Object.defineProperty(e.prototype,"direction",{set:function(e){e<3&&(this.img_root.scaleY=-1,this.lb_tips.scaleY=-1),1!=e&&4!=e||(this.img_root.scaleX=-1,this.lb_tips.scaleX=-1)},enumerable:!0,configurable:!0}),e}(eui.Component);o.TipsComponent=n,__reflect(n.prototype,"game.TipsComponent")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.proxy=o.AppFacade.getInstance().retrieveProxy(o.GuildPy.N),NoticeManager.setChildType(NT.GUILD_MANAGER,[NT.GUILD_SIGNIN,NT.GUILD_APPLY]),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN_MAP,o.GuildMapView),this.addSubView(n.SV.CREATE_OR_APPLY,o.GuildCreateOrApplyView),this.addSubView(n.SV.MANAGER_VIEW,o.GuildManagerView),this.addSubView(n.SV.HAS_APPLY_VIEW,o.GuildSelfApplyListView),this.addSubView(n.SV.GUILD_APPLY_VIEW,o.GuildApplyListView),this.addSubView(n.SV.INFO,o.GuildInfoPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.GUILD_GUILD_RANKED_LIST_UPDATE,CN.GUILD_GUILD_MEMBER_LIST_UPDATE,CN.GUILD_GUILD_APPLY_LIST_UPDATE,CN.GUILD_INFO_UPDATE,CN.LOGIN_FINAL_DONE]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.LOGIN_FINAL_DONE:break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GUILD_GUILD_RANKED_LIST_UPDATE:this.updateView(n.SV.CREATE_OR_APPLY);break;case CN.GUILD_GUILD_APPLY_LIST_UPDATE:o.AppFacade.getInstance().updateView(n.N,n.SV.GUILD_APPLY_VIEW,this.proxy.applyList);break;case CN.GUILD_GUILD_MEMBER_LIST_UPDATE:o.AppFacade.getInstance().updateView(n.N,n.SV.MANAGER_VIEW);break;case CN.GUILD_INFO_UPDATE:500<=o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N).loginStatusVO.state&&this.getSubView(n.SV.CREATE_OR_APPLY)&&this.proxy.isInGuild()&&(this.hideSubView(n.SV.CREATE_OR_APPLY),this.showSubView(n.SV.MAIN_MAP)),this.getSubView(n.SV.MAIN_MAP)?this.proxy.isInGuild()?(this.updateView(n.SV.MANAGER_VIEW),this.updateView(n.SV.MAIN_MAP)):(Utils.MsgUtils.addMidMsg("你已经不在公会了"),this.hideAllSubView(),this.showSubView(n.SV.CREATE_OR_APPLY)):this.log("GUILD_INFO_UPDATE 还没进入主界面，不处理")}},n.prototype.onViewCreate=function(){},n.N="GuildMediator",n.SV={MAIN_MAP:1,CREATE_OR_APPLY:2,MANAGER_VIEW:3,HAS_APPLY_VIEW:5,GUILD_APPLY_VIEW:6,SHOP_VIEW:8,INFO:12},n}(BaseMediator);o.GuildMediator=e,__reflect(e.prototype,"game.GuildMediator")}(game||(game={})),function(n){var e=function(){function e(){}return e.registerAll=function(){(new t).register()},e}();n.GuildProcessor=e,__reflect(e.prototype,"game.GuildProcessor");var t=function(e){function t(){return e.call(this,"guild.GuildUpdateP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody(),i=n.AppFacade.getInstance().retrieveProxy(n.GuildPy.N);t.updateType===EGuildUpdateType.Base?i.getPlayerGuildReq():t.updateType===EGuildUpdateType.Member?i.getMemberListReq():t.updateType===EGuildUpdateType.Apply&&i.getApplyListReq()},t}(n.ProcessorBase);n.GuildUpdateP=t,__reflect(t.prototype,"game.GuildUpdateP")}(game||(game={})),function(l){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.subwayNotice=!0,e.skillArr=[],e.skillNotice=!1,e.bountyProNotice=!1,e.bountyNotice=!1,e.devoteRedNotice=!1,e.allGuildRankedList=new Array,e.memberList=new Array,e.applyList=new Array,e.playerProxy=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),e.addNotice(),e}return __extends(i,t),i.prototype.addNotice=function(){NoticeManager.registerCB(NT.GUILD_SIGNIN,this.checkSignInNotice,this),NoticeManager.registerCB(NT.GUILD_APPLY,this.checkApplyListNotice,this)},i.prototype.decorateGuildRankedList=function(e){var t=this;this.allGuildRankedList.splice(0),e.forEach(function(e){t.allGuildRankedList.push(new l.GuildVO(e))}),this.sendNotification(CN.GUILD_GUILD_RANKED_LIST_UPDATE)},i.prototype.decorateInfo=function(e,t){e&&(this.playerProxy.playerGuildVO?this.playerProxy.playerGuildVO.update(e):this.playerProxy.playerGuildVO=new l.PlayerGuildVO(e)),t&&(this.guildDetail?this.guildDetail.update(t):this.guildDetail=new l.GuildDetailVO(t)),this.sendNotification(CN.GUILD_INFO_UPDATE),NoticeManager.updateNotice(NT.GUILD_SIGNIN),NoticeManager.updateNotice(NT.GUILD_APPLY)},i.prototype.fetchGuildList=function(e,t){var i=this;void 0===t&&(t=!1),t?Utils.Socket.send("guild","GetApplyGuild",{}).then(function(e){i.decorateGuildRankedList(e.guildList)}):e?Utils.Socket.send("guild","SearchGuild",{key:e}).then(function(e){i.decorateGuildRankedList(e.guildList),0==e.guildList.length&&Utils.MsgUtils.addMidMsg("找不到对应公会")}):Utils.Socket.send("guild","GetGuildList",{}).then(function(e){i.decorateGuildRankedList(e.guildList)})},i.prototype.getSelfApplyGuild=function(e){Utils.Socket.send("guild","GetApplyGuild",{}).then(function(e){l.AppFacade.getInstance().updateView(l.GuildMediator.N,l.GuildMediator.SV.HAS_APPLY_VIEW,e.guildList)})},i.prototype.GuildDevote=function(t){Utils.Socket.send("guild","GuildDevote",{}).then(function(e){t&&t(e)})},i.prototype.createGuildReq=function(e,t,i,n){var o=this;void 0===i&&(i="");var a=JSON.parse(l.Config.constConfig().CreateGuildCosts.constValue),r=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),s=(l.Config.VIPUpgradeConfig(),Number(a[0][2]));r.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeDiamond]<s?l.GameMgr.getInstance().showCommonTipsWin({commonTips:"很遗憾，您的钻石不足，购买失败",cb:!1,btnLabel:{cancel:"取消",sure:"前往充值"},clickCB:function(e){0===e.type||1===e.type&&l.MainJumpConfig.jumpTo(MODULE.VIP)}}):Utils.Socket.send("guild","CreateGuild",{name:e,avatar:t}).then(function(e){o.playerProxy.playerGuildVO?o.playerProxy.playerGuildVO.update(e.playerGuild):o.playerProxy.playerGuildVO=new l.PlayerGuildVO(e.playerGuild),e.guildDetail&&(o.guildDetail?o.guildDetail.update(e.guildDetail):o.guildDetail=new l.GuildDetailVO(e.guildDetail)),l.MainJumpConfig.jumpTo("GUILD"),""!=i&&o.SetNotice(i),NoticeManager.updateNotice(NT.GUILD_SIGNIN),n&&n()})},i.prototype.getPlayerGuildReq=function(t){var i=this;Utils.Socket.send("guild","GetPlayerGuild",{}).then(function(e){i.decorateInfo(e.playerGuild,e.guildDetail),!e.guildDetail&&i.guildDetail&&(i.guildDetail=void 0),i.isInGuild()?i.getMemberListReq():i.sendNotification(CN.GUILD_INFO_UPDATE),t&&t()})},i.prototype.getMemberListReq=function(n,o){var a=this;void 0===n&&(n=!0),Utils.Socket.send("guild","GetMemberList",{}).then(function(e){a.memberList.splice(0),e.memberList.forEach(function(e){a.memberList.push(new l.GuildMemberVO(e))}),a.memberList.sort(function(e,t){return 0==e.baseInfo.offlineTime&&0!=t.baseInfo.offlineTime?-1:0==t.baseInfo.offlineTime&&0!=e.baseInfo.offlineTime?1:e.position!=t.position?t.position-e.position:e.baseInfo.fightCap-t.baseInfo.fightCap});var t=0;for(var i in a.memberList){t+=a.memberList[i].baseInfo.fightCap}a.guildDetail.fightCap=t,n&&a.sendNotification(CN.GUILD_GUILD_MEMBER_LIST_UPDATE),o&&o()})},i.prototype.getApplyListReq=function(){var t=this;Utils.Socket.send("guild","GetApplyList",{}).then(function(e){t.applyList.splice(0),e.applyList.forEach(function(e){t.applyList.push(new l.ApplyVO(e))}),NoticeManager.updateNotice(NT.GUILD_APPLY),t.sendNotification(CN.GUILD_GUILD_APPLY_LIST_UPDATE)})},i.prototype.SetNotice=function(e){var t=this;l.GameMVC.mainPy.checkTextVaild(e,function(){Utils.Socket.send("guild","SetNotice",{notice:e}).then(function(e){t.decorateInfo(void 0,e.guildDetail),l.AppFacade.getInstance().updateView(l.GuildMediator.N,l.GuildMediator.SV.MANAGER_VIEW)})})},i.prototype.ChangeAvatar=function(e){var t=this;Utils.Socket.send("guild","ChangeAvatar",{avatar:e}).then(function(e){t.decorateInfo(void 0,e.guildDetail),l.AppFacade.getInstance().updateView(l.GuildMediator.N,l.GuildMediator.SV.MAIN_MAP)})},i.prototype.operationReq=function(a,r,s){var c=this;Utils.Socket.send("guild","GuildOperation",{operationType:a,id:r}).then(function(e){if(a===EGuildOperationType.AgreeJoin||a===EGuildOperationType.RejectJoin)for(var t=0,i=0,n=c.applyList;i<n.length;i++){if(n[i].baseInfo.playerId===r){c.applyList.splice(t,1);break}t++}if(a!==EGuildOperationType.AgreeAll&&a!==EGuildOperationType.RejectAll||c.applyList.splice(0),a!=EGuildOperationType.Join&&a!=EGuildOperationType.CancelJoin&&a!=EGuildOperationType.Quit&&a!=EGuildOperationType.CancelAll&&c.getMemberListReq(),c.decorateInfo(e.playerGuild,e.guildDetail),a==EGuildOperationType.Quit){var o=l.GameMVC.mainPy;o.noticesTag[EChatChannelType.EChatChannelTypeGuild]=!1,NoticeManager.updateNotice(o.channel_2_notice[EChatChannelType.EChatChannelTypeGuild],EChatChannelType.EChatChannelTypeGuild),l.GameMVC.playerPy.playerGuildVO.guildId=0,c.guildDetail=void 0}s&&s()})},i.prototype.getMemberById=function(e){for(var t=0,i=this.memberList;t<i.length;t++){var n=i[t];if(n.baseInfo.playerId===e)return n}},i.prototype.isInGuild=function(){return this.playerProxy.playerGuildVO&&this.playerProxy.playerGuildVO.guildId&&0!=this.playerProxy.playerGuildVO.guildId||!1},i.prototype.checkSignInNotice=function(){var e=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N);return this.isInGuild()&&e.playerGuildVO.devoteNum<1},i.prototype.checkApplyListNotice=function(){if(!this.isInGuild())return!1;var e=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N).playerGuildVO;return(e.position==EGuildPositionType.EGuildPositionTypePresident||e.position==EGuildPositionType.EGuildPositionTypeVicePresident)&&0<this.applyList.length},i.prototype.GetGuildBaseInfo=function(e,t){Utils.Socket.send("guild","GetGuildBaseInfo",{guildId:e}).then(function(e){t&&t(e.info)})},i.prototype.changeName=function(e,t){var i=this;Utils.Socket.send("guild","ChangeName",{name:e.name}).then(function(e){i.guildDetail.update(e.guildDetail),i.sendNotification(CN.GUILD_INFO_UPDATE),t&&t()}).catch(function(e){})},i.N="GuildProxy",i}(BaseProxy);l.GuildPy=e,__reflect(e.prototype,"game.GuildPy")}(game||(game={})),function(n){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildCreateOrApplySkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="推荐公会",this.proxy=n.AppFacade.getInstance().retrieveProxy(n.GuildPy.N),this.CommonDaTanChuKuang.img_close.visible=!1,this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_root.verticalScrollBar.visible=!1,this.sl_root.verticalScrollBar.autoVisibility=!1,this.btn_search.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),""===e.et_guildname.text?Utils.MsgUtils.addMidMsg("请输入公会名字"):e.proxy.fetchGuildList(e.et_guildname.text)},this),this.btn_build.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new n.GuildCreatePanel({})})},this),this.CommonDaTanChuKuang.onCloseCB=function(){n.MainJumpConfig.jumpTo()},this.btn_applyList.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.AppFacade.getInstance().showSubView(n.GuildMediator.N,n.GuildMediator.SV.HAS_APPLY_VIEW)},this),this.sl_root.verticalScrollBar.visible=!1,this.sl_root.verticalScrollBar.autoVisibility=!1,this.initList(),this.proxy.fetchGuildList(),this.gp_detail.scaleX=this.gp_detail.scaleY=1,UIActionManager.playUIAction(this.gp_detail,1)},e.prototype.initList=function(){this.lv_root=new eui.List;var e=new eui.VerticalLayout;e.horizontalAlign=egret.HorizontalAlign.CENTER,this.lv_root.layout=e,this.sl_root.viewport=this.lv_root,this.lv_root.itemRenderer=o,this.dataSource=new eui.ArrayCollection,this.lv_root.dataProvider=this.dataSource},e.prototype.updateView=function(){this.dataSource=new eui.ArrayCollection;var e=this.proxy.allGuildRankedList;this.lv_root.dataProvider=new eui.ArrayCollection(e)},e}(BaseTab);n.GuildCreateOrApplyView=e,__reflect(e.prototype,"game.GuildCreateOrApplyView");var o=function(t){function e(){var e=t.call(this)||this;return e.skinName="CommonItemRenderLongSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;this.adapterComponent(),this.btn_go.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap);var e=n.AppFacade.getInstance().retrieveProxy(n.GuildPy.N);this.data.isApply?e.operationReq(EGuildOperationType.CancelJoin,this.data.id||this.data.guildId,function(){Utils.MsgUtils.addMidMsg("取消成功"),e.getSelfApplyGuild()}):e.operationReq(EGuildOperationType.Join,this.data.id||this.data.guildId,function(){Utils.MsgUtils.addMidMsg("申请成功"),e.fetchGuildList()}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)},this),this.img_icon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.AppFacade.getInstance().showSubView(n.GuildMediator.N,n.GuildMediator.SV.INFO,e.data)},this)},e.prototype.adapterComponent=function(){this.lb_content.visible=!1,this.gp_content.visible=!0},e.prototype.dataChanged=function(){this.lb_info.text=this.data.guildName||this.data.name,this.lb_guildLv.text=""+this.data.level;var e=n.Config.guildLevelUpgradeConfig()[this.data.level];this.lb_memberCount.text=this.data.num+"/"+e.mLimit,this.img_icon.source=this.data.avatar,this.data.isApply?this.btn_go.labelDisplay.text="取消":this.btn_go.labelDisplay.text="申 请"},e}(eui.ItemRenderer);__reflect(o.prototype,"GuildItemRender");var t=function(i){function e(e){var t=i.call(this)||this;return t.updateCount=0,t.skinName="GuildApplyListViewSkin",t.proxy=n.AppFacade.getInstance().retrieveProxy(n.GuildPy.N),t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="申请列表",this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.proxy.getSelfApplyGuild(),this.list_root.itemRenderer=o,this.btn_cancelAll.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.proxy.operationReq(EGuildOperationType.CancelAll,void 0,function(){e.updateView([])})},this)},e.prototype.updateView=function(e){if(e){for(var t in e){e[t].isApply=!0}this.lb_hasApply.text="申请信息 ： "+e.length,this.list_root.dataProvider=new eui.ArrayCollection(e),0==e.length?this.gp_information.visible=!0:this.gp_information.visible=!1,this.updateCount++}},e.prototype.onDestroy=function(){1<this.updateCount&&this.proxy.fetchGuildList()},e}(BasePanel);n.GuildSelfApplyListView=t,__reflect(t.prototype,"game.GuildSelfApplyListView")}(game||(game={})),function(n){var e=function(i){function e(e){var t=i.call(this)||this;return t.skinName="GuildCreatePanelSkin",t.proxy=n.AppFacade.getInstance().retrieveProxy(n.GuildPy.N),t.clickCB=e.clickCB,t}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;this.CommonXiaoTanChuKuang.blb_title.text="建立公会";var e=JSON.parse(n.Config.constConfig().CreateGuildCosts.constValue)[0];this.CommonIconWithNum_cost.updateItem({cost:e,style:CommonIconStyle.RIGHT}),this.btn_build.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(""!=t.et_guildName.text){var e=JSON.parse(n.Config.constConfig().CreateGuildCosts.constValue);n.AppFacade.getInstance().retrieveProxy(n.BackpackPy.N).checkEnough(e,!0)?t.proxy.createGuildReq(t.et_guildName.text,t.img_avatar.source,t.et_announcement.text,function(){t.hide(),n.AppFacade.getInstance().hideSubView(n.GuildMediator.N,n.GuildMediator.SV.CREATE_OR_APPLY)}):Utils.MsgUtils.addMidMsg("钻石不足")}else Utils.MsgUtils.addMidMsg("请输入公会名称")},this),this.btn_choseAvatar.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new o({clickCB:function(e){t.img_avatar.source=e}})})},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this)},e}(BasePanel);n.GuildCreatePanel=e,__reflect(e.prototype,"game.GuildCreatePanel");var o=function(i){function e(e){var t=i.call(this)||this;return t.skinName="GuildAvatarChoseViewSkin",t.proxy=n.AppFacade.getInstance().retrieveProxy(n.GuildPy.N),t.clickCB=e.clickCB,t}return __extends(e,i),e.prototype.childrenCreated=function(){var i=this;UIActionManager.hideScrollerBar(this.sl_root),GUILD_AVATAR_RES.forEach(function(e){var t=new eui.Image(e);t.scaleX=t.scaleY=.8,t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.clickCB&&i.clickCB(e),i.hide()},i),i.gp_content.addChild(t)})},e}(BasePanel);n.GuildAvatarChoseView=o,__reflect(o.prototype,"game.GuildAvatarChoseView")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildInfoPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateView=function(e){var t=e;this.lb_name.text=t.name,this.fightItem.update(t.fightCap);var i=customui.GuildHeadFactory.create();i.updateData({vo:t}),this.gp_guildHead.addChild(i),this.lb_presidentName.text=t.presidentName,this.lb_num.text=t.num.toString(),this.lb_oath.text=t.notice},e}(BasePanel);e.GuildInfoPanel=t,__reflect(t.prototype,"game.GuildInfoPanel")}(game||(game={})),function(d){var e=function(t){function e(){var e=t.call(this)||this;return e.playProxy=d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N),e.skinName="GuildManagerSkin",e.proxy=d.AppFacade.getInstance().retrieveProxy(d.GuildPy.N),e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this)},e.prototype.childrenCreated=function(){var a=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_head),this.CommonDaTanChuKuang.blb_title.text="公会大厅",this.CommonDaTanChuKuang.onCloseCB=function(){a.hide()},this.sl_member.verticalScrollBar.visible=!1,this.sl_member.verticalScrollBar.autoVisibility=!1,this.img_quit.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=new Array;e.push({text:"（退会不影响个人贡献值）",style:{size:24}}),e.push({text:"\n1.退会将清空您在本公会的历史贡献",style:{size:24}}),e.push({text:"\n2.退会后1小时内无法加入",style:{size:24}}),e.push({text:"\n3.退会后若公会无剩余成员将会解散",style:{size:24}}),d.GameMgr.getInstance().showCommonTipsWin({commonTips:e,clickCB:function(e){1===e.type&&a.proxy.operationReq(EGuildOperationType.Quit,void 0,function(){d.MainJumpConfig.jumpTo("GUAJI")})}})},this),this.playProxy.playerGuildVO.position===EGuildPositionType.EGuildPositionTypeVicePresident||this.playProxy.playerGuildVO.position===EGuildPositionType.EGuildPositionTypePresident?(this.btn_modify.visible=!0,this.btn_name.visible=!0,this.img_applyList.visible=!0,this.img_invite.visible=!0,this.btn_modify.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),Utils.SDKMgr.getPerformConfig(24)?PopUpManager.addPopUp({obj:new d.GuildModifyChooseView}):PopUpManager.addPopUp({obj:new d.GuildModifyView})},this),this.btn_name.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),PopUpManager.addPopUp({obj:new d.GuildModifyName})},this),this.img_applyList.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.proxy.getApplyListReq(),d.AppFacade.getInstance().showSubView(d.GuildMediator.N,d.GuildMediator.SV.GUILD_APPLY_VIEW,a.proxy.applyList)},this)):(this.btn_modify.visible=!1,this.btn_name.visible=!1,this.img_applyList.visible=!1,this.img_invite.visible=!1),this.img_devote.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1<=d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N).playerGuildVO.devoteNum?Utils.MsgUtils.addMidMsg("已签到"):a.proxy.GuildDevote(function(t){a.proxy.decorateInfo(t.playerGuild,t.guildDetail),d.AppFacade.getInstance().updateView(d.GuildMediator.N,d.GuildMediator.SV.MANAGER_VIEW);try{DragonBoneTools.playOnce({effectName:"common_gonghuiqiandao_1",parent:a.img_devote,x:a.img_devote.width/2,y:a.img_devote.height/2,scaleX:1.25,scaleY:1.25,doneCB:function(){DragonBoneTools.playOnce({effectName:"common_gonghuiqiandao_2",x:55,y:a.gp_head.height/2,parent:a.gp_head,doneCB:function(){d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N).handleClientReward(t.clientReward,1)}})}})}catch(e){t.err||(a.proxy.decorateInfo(t.playerGuild,t.guildDetail),d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N).handleClientReward(t.clientReward,1),d.AppFacade.getInstance().updateView(d.GuildMediator.N,d.GuildMediator.SV.MANAGER_VIEW))}})},this),this.img_invite.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=Utils.LocalStorageUtil.getItem("GuildInviteTime"),t=0;e&&(t=parseInt(e));var i=Utils.TimerManager.getServerTime(),n=parseInt(d.Config.constConfig().GuildInviteCD.constValue);if(t+n<=i){var o=[[2,a.proxy.guildDetail.name,a.proxy.guildDetail.guildId,EEntityType.EEntityTypeGuild],[1,">>申请加入",a.proxy.guildDetail.guildId,MODULE.GuildHall]];d.AppFacade.getInstance().retrieveProxy(d.MainPy.N).SendMessage(EChatChannelType.SameServer,"%s公会诚意邀请你的加入!%s",0,function(){Utils.MsgUtils.addMidMsg("发送成功"),Utils.LocalStorageUtil.setItem("GuildInviteTime",i.toString()),a.updateView()},EChatSendCheckType.None,JSON.stringify(o))}else Utils.MsgUtils.addMidMsg("邀请信息每"+n/60+"分钟可发送一次，暂时无法发送")},this),this.initList(),this.updateView(),this.addNotice()},e.prototype.initList=function(){this.list_member.itemRenderer=i},e.prototype.updateView=function(){var t=this;if(this.updateMemberView(),this.playProxy.playerGuildVO.position===EGuildPositionType.EGuildPositionTypeVicePresident||this.playProxy.playerGuildVO.position===EGuildPositionType.EGuildPositionTypePresident?(this.btn_modify.visible=!0,this.img_applyList.visible=!0,this.img_invite.visible=!0):(this.btn_modify.visible=!1,this.img_applyList.visible=!1,this.img_invite.visible=!1),this.lb_notice.text=this.proxy.guildDetail.notice&&""!=this.proxy.guildDetail.notice?this.proxy.guildDetail.notice:"这个人很懒，什么都没留下。",1<=this.playProxy.playerGuildVO.devoteNum){if(UIActionManager.setAbsGrey(this.img_devote,!0),!this.timerDevote){var e=Utils.TimerManager.getServerTime(),i=new Date(1e3*e);i.setHours(23,59,59);var n=i.getTime()/1e3;this.lb_nextDevote.text=Utils.TimerManager.getFormatBySecond1(n-e),this.timerDevote=egret.setInterval(function(){var e=Utils.TimerManager.getServerTime();t.lb_nextDevote.text=Utils.TimerManager.getFormatBySecond1(n-e)},this,1e3)}}else this.lb_nextDevote.text="",UIActionManager.setAbsGrey(this.img_devote,!1);var o=Utils.LocalStorageUtil.getItem("GuildInviteTime"),a=0;o&&(a=parseInt(o));var r=Utils.TimerManager.getServerTime(),s=parseInt(d.Config.constConfig().GuildInviteCD.constValue);if(a+s<=r)this.lb_nextInvite.text="",UIActionManager.setAbsGrey(this.img_invite,!1);else{UIActionManager.setAbsGrey(this.img_invite,!0),egret.clearInterval(this.timerInvite);var c=a+s-r;this.lb_nextInvite.text=Utils.TimerManager.getFormatBySecond1(c),this.timerInvite=egret.setInterval(function(){--c<0?t.updateView():t.lb_nextInvite.text=Utils.TimerManager.getFormatBySecond1(c)},this,1e3)}var l=this.proxy.memberList.length,h=this.proxy.guildDetail,p=d.Config.guildLevelUpgradeConfig()[h.level];this.bm_online.text=l+"/"+p.mLimit,this.updateInfoView()},e.prototype.updateInfoView=function(){var t=this;if(this.proxy.isInGuild()){var e=this.proxy.guildDetail,i=d.Config.guildLevelUpgradeConfig()[e.level];this.lb_name.text=e.name,this.lb_num.text=e.num+"/"+i.mLimit,this.lb_lv.text=""+(e.level&&e.level.toString()),this.pb_exp.minimum=0,this.pb_exp.maximum=i.exp,this.pb_exp.value=e.exp,RES.getResAsync(e.avatar,function(e){t.img_avatar.texture=e},this);var n=[1,4,0],o=d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N).getInfoByTypeCodeNum(n[0],n[1]);this.lb_ghb.text=Utils.MathUtils.formatNumStyle1(o.haveNum),this.bitmap_power.text=Utils.MathUtils.formatNumStyle2(this.proxy.guildDetail.fightCap)}},e.prototype.updateMemberView=function(){this.proxy.memberList&&(this.list_member.dataProvider=new eui.ArrayCollection(this.proxy.memberList))},e.prototype.perClose=function(){this.removeNotice()},e.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.GUILD_APPLY,this.img_applyList.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.GUILD_SIGNIN,this.img_devote.getChildAt(0),this,BTN_ICON_NOTICE_POS)},e.prototype.removeNotice=function(){NoticeManager.removeNoticeListener(NT.GUILD_APPLY),NoticeManager.removeNoticeListener(NT.GUILD_SIGNIN)},e}(BasePanel);d.GuildManagerView=e,__reflect(e.prototype,"game.GuildManagerView");var i=function(t){function e(){var e=t.call(this)||this;return e.playProxy=d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N),e.skinName="MemberItemRenderSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var i=this;this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.data.baseInfo.playerId!=i.playProxy.playerInfoVO.playerId&&d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N).GetPublicPlayerInfo([i.data.baseInfo.playerId],function(e,t){e[0].position=i.data.position,PopUpManager.addPopUp({obj:new d.GuildPlayerInfoPanel(e[0])})})},this)},e.prototype.dataChanged=function(){this.lb_name.text=this.data.baseInfo.name,this.data.baseInfo.offlineTime?this.lb_offlineTime.text=Utils.TimerManager.getTimeLeftDescBySecond(Utils.TimerManager.getServerTime()-this.data.baseInfo.offlineTime):0==this.data.baseInfo.offlineTime&&(this.lb_offlineTime.text="在线"),this.cu_ph.updateData({vo:this.data.baseInfo}),this.data.position===EGuildPositionType.EGuildPositionTypeVicePresident?this.lb_position.text="副会长":this.data.position===EGuildPositionType.EGuildPositionTypePresident?this.lb_position.text="会长":this.lb_position.text="成员"},e}(eui.ItemRenderer);__reflect(i.prototype,"MemberItemRender");var t=function(i){function e(e){var t=i.call(this)||this;return t.updateCount=0,t.skinName="GuildApplyListViewSkin",t.proxy=d.AppFacade.getInstance().retrieveProxy(d.GuildPy.N),t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="申请列表",this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.btn_cancelAll.label="删除所有",this.list_root.itemRenderer=n,this.btn_cancelAll.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.proxy.operationReq(EGuildOperationType.RejectAll,void 0,function(){d.AppFacade.getInstance().updateView(d.GuildMediator.N,d.GuildMediator.SV.GUILD_APPLY_VIEW,e.proxy.applyList)})},this)},e.prototype.updateView=function(e){for(var t in e||(e=this.proxy.applyList),e){e[t].isApply=!0}this.lb_hasApply.text="收到的请求 ： "+(e.length||0),this.list_root.dataProvider=new eui.ArrayCollection(e),e.length?this.gp_information.visible=!1:this.gp_information.visible=!0,this.updateCount++},e.prototype.onDestroy=function(){1<this.updateCount&&d.AppFacade.getInstance().updateView(d.GuildMediator.N,d.GuildMediator.SV.MANAGER_VIEW)},e}(BasePanel);d.GuildApplyListView=t,__reflect(t.prototype,"game.GuildApplyListView");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildApplyItemRenderSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var t=this;this.btn_apply.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=d.AppFacade.getInstance().retrieveProxy(d.GuildPy.N);e.operationReq(EGuildOperationType.AgreeJoin,t.data.baseInfo.playerId,function(){d.AppFacade.getInstance().updateView(d.GuildMediator.N,d.GuildMediator.SV.GUILD_APPLY_VIEW,e.applyList)})},this),this.cu_ph.addTapEvent(function(){d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N);d.AppFacade.getInstance().showSubView(d.FriendMediator.N,d.FriendMediator.SV.INFO,{playerId:t.data.baseInfo.playerId})})},e.prototype.dataChanged=function(){this.lb_name.text=this.data.baseInfo.name,this.CommonFightCap.update(this.data.baseInfo.fightCap),0===this.data.baseInfo.offlineTime?this.lb_offlineTime.text=Utils.TimerManager.getTimeLeftDescBySecond(0):this.data.baseInfo.offlineTime?this.lb_offlineTime.text=Utils.TimerManager.getTimeLeftDescBySecond(Utils.TimerManager.getServerTime()-this.data.baseInfo.offlineTime):this.lb_offlineTime.text="在线",this.cu_ph.updateData({vo:this.data.baseInfo})},e}(eui.ItemRenderer);__reflect(n.prototype,"ApplyItemRender")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildMapSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_head),this.ShopPy=a.AppFacade.getInstance().retrieveProxy(a.ShopPy.N),this.proxy=a.AppFacade.getInstance().retrieveProxy(a.GuildPy.N),this.proxy.getApplyListReq(),this.proxy.getMemberListReq(!0,function(){e.initView(),e.updateInfoView()}),this.gp_head.visible=!1,this.once(egret.Event.ENTER_FRAME,function(){e.gp_head.visible=!0,UIActionManager.playUIAction(e.gp_head,5)},this),this.img_avatar.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N);e.playerGuildVO.position!=EGuildPositionType.EGuildPositionTypePresident&&e.playerGuildVO.position!=EGuildPositionType.EGuildPositionTypeVicePresident||PopUpManager.addPopUp({obj:new a.GuildAvatarChoseView({clickCB:function(e){a.AppFacade.getInstance().retrieveProxy(a.GuildPy.N).ChangeAvatar(e)}})})},this)},e.prototype.updateView=function(){this.updateInfoView(),this.updateNotice()},e.prototype.updateDragonBone=function(){},e.prototype.updateInfoView=function(){var t=this;if(this.proxy.isInGuild()){var e=this.proxy.guildDetail,i=a.Config.guildLevelUpgradeConfig()[e.level];this.lb_name.text=e.name,this.lb_num.text=e.num+"/"+i.mLimit,this.lb_lv.text=""+(e.level&&e.level.toString()),this.pb_exp.minimum=0,this.pb_exp.maximum=i.exp,this.pb_exp.value=e.exp,RES.getResAsync(e.avatar,function(e){t.img_avatar.texture=e},this);var n=[1,4,0],o=a.AppFacade.getInstance().retrieveProxy(a.BackpackPy.N).getInfoByTypeCodeNum(n[0],n[1]);this.lb_ghb.text=Utils.MathUtils.formatNumStyle1(o.haveNum),this.bitmap_power.text=Utils.MathUtils.formatNumStyle2(this.proxy.guildDetail.fightCap)}},e.prototype.initView=function(){this.initConfig(),this.initButton(),this.pb_exp.slideDuration=0},e.prototype.initConfig=function(){this.config=[{item:this.gp_guild_hall,name:"公会大厅",noticeType:NT.GUILD_MANAGER,noticePos:{percentX:240/347,percentY:170/248},cb:function(){Utils.UnlockMgr.checkPass(MODULE.GuildHall).allow&&a.AppFacade.getInstance().showSubView(a.GuildMediator.N,a.GuildMediator.SV.MANAGER_VIEW)},effect:"gonghui_bg_ghdt",effectPos:{offectX:0,offectY:30}},{item:this.gp_skill,name:"科技中心",module:MODULE.GuildSkill,noticePos:{percentX:240/217,percentY:170/281},cb:function(){a.MainJumpConfig.jumpTo(MODULE.GuildSkill)},effect:"gonghui_bg_kjzx",effectPos:{offectX:0,offectY:95}},{item:this.gp_collect,gp_effect:this.gp_collect0,name:"公会采集",noticeType:NT.GUILD_COLLECT,module:MODULE.GuildCollect,noticePos:{percentX:.8,percentY:250/300},cb:function(){a.MainJumpConfig.jumpTo(MODULE.GuildCollect)},effect:"gonghui_bg_ghcj",effectPos:{offectX:0,offectY:70}},{item:this.gp_store,noticeType:NT.COMMON_SHOP[ShopType.ShopTypeGuild],noticePos:{percentX:200/307,percentY:190/252},module:MODULE.GuildShop,name:"商店",cb:function(){a.MainJumpConfig.jumpTo(MODULE.GuildShop)},effect:"gonghui_bg_ghsd",effectPos:{offectX:0,offectY:45}},{item:this.gp_challenge,name:"公会boss",noticeType:NT.GUILD_BOSS,cb:function(){a.MainJumpConfig.jumpTo(MODULE.GuildBoss)},module:MODULE.GuildBoss,noticePos:{percentX:200/303,percentY:180/277},effect:"gonghui_bg_ghbs",effectPos:{offectX:0,offectY:40}},{item:this.gp_copy,name:"公会副本",cb:function(){Utils.UnlockMgr.checkPass(MODULE.GuildTranscript).allow&&(a.AppFacade.getInstance().retrieveProxy(a.GuildInstancePy.N).GetGuildFortressInfo(),a.MainJumpConfig.jumpTo(MODULE.GuildTranscript))},noticeType:NT.GUILD_INSTANCE,module:MODULE.GuildTranscript,noticePos:{percentX:185/226,percentY:145/191},effect:"gonghui_bg_ghfb",effectPos:{offectX:0,offectY:30}},{item:this.gp_war,name:"公会战",cb:function(){a.MainJumpConfig.jumpTo(MODULE.GuildWar)},module:MODULE.GuildWar,noticeType:NT.GUILD_WAR,noticePos:{percentX:155/202,percentY:115/192},effect:"gonghui_bg_ghz",effectPos:{offectX:0,offectY:0}},{item:this.gp_tribeBattle,name:"部落争霸",cb:function(){a.MainJumpConfig.jumpTo(MODULE.TribeBattle)},module:MODULE.TribeBattle,noticeType:NT.GUILD_TRIBE_BATTLE,noticePos:{percentX:150/172,percentY:.8},effect:void 0,effectPos:{offectX:0,offectY:0}}]},e.prototype.initButton=function(){var e=this;this.config.forEach(function(t){t.item.addEventListener(egret.TouchEvent.TOUCH_TAP,t.cb,e),t.effect&&DragonBoneTools.create(t.effect,function(e){t.gp_effect?(e.x=t.gp_effect.width/2+(t.effectPos&&t.effectPos.offectX||0),e.y=t.gp_effect.height/2+(t.effectPos&&t.effectPos.offectY||0),t.gp_effect.addChild&&t.gp_effect.addChildAt(e,0)):(e.x=t.item.width/2+(t.effectPos&&t.effectPos.offectX||0),e.y=t.item.height/2+(t.effectPos&&t.effectPos.offectY||0),t.item.addChild&&t.item.addChildAt(e,0)),e.animation.play()},e),null!=t.noticeType&&(t.module?Utils.UnlockMgr.checkPass(t.module,!1).allow&&(NoticeManager.removeNoticeListener(t.noticeType),NoticeManager.addNoticeListener(t.noticeType,t.item.getChildAt(0),e,t.noticePos)):(NoticeManager.removeNoticeListener(t.noticeType),t.item&&NoticeManager.addNoticeListener(t.noticeType,t.item.getChildAt(0),e,t.noticePos)))})},e}(BaseView);a.GuildMapView=e,__reflect(e.prototype,"game.GuildMapView")}(game||(game={})),function(o){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildModifyViewSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.proxy=o.AppFacade.getInstance().retrieveProxy(o.GuildPy.N),this.et_notice.text=this.proxy.guildDetail.notice,this.CommonXiaoTanChuKuang.blb_title.text="修改公告",this.btn_save.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),50<e.et_notice.text.length?Utils.MsgUtils.addMidMsg("公告最多50字"):(e.proxy.SetNotice(e.et_notice.text),e.hide())},this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},e.prototype.initLimitNotice=function(){},e}(BasePanel);o.GuildModifyView=e,__reflect(e.prototype,"game.GuildModifyView");var t=function(i){function e(){var e=i.call(this)||this;return e.py=o.AppFacade.getInstance().retrieveProxy(o.GuildPy.N),e.skinName="GuildModifyNameSkin",e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.cu_ctc.blb_title.text="公会改名",this.btn_comform.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=o.Config.constConfig();Number(e.GuildModifyNameDt.constValue),t.py.guildDetail.lModifyDt,Utils.TimerManager.getServerTime();t.ed_input.text&&""!=t.ed_input.text?o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N).checkEnough([t.costInfo.costs],!1)?t.py.changeName({name:t.ed_input.text},function(){PopUpManager.removePopUp(t),Utils.MsgUtils.addMidMsg("名字修改成功！")}):Utils.MsgUtils.addMidMsg("你的"+t.costInfo.info.name+"不足"):Utils.MsgUtils.addMidMsg("请输入名字")},this),this.initView()},e.prototype.initView=function(){var e=o.Config.constConfig().ModiyGuildNameCosts,t=JSON.parse(e.constValue)[0],i=o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N).getInfoByCode(t[1]);this.costInfo={costs:t,info:i.info};var n=i.info.icon;this.img_diamonds.source=n+"_png",this.lb_cost.text="x"+t[2]},e}(BasePanel);o.GuildModifyName=t,__reflect(t.prototype,"game.GuildModifyName");var i=function(o){function e(){var e=o.call(this)||this;return e.skinName="GuildModifyChooseViewSkin",e}return __extends(e,o),e.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="修改公告",this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()};var t=[];for(var i in GUILD_POST_INFO){var n={info:GUILD_POST_INFO[i],hideCB:this.hide.bind(this)};t.push(n)}this.list_info.itemRenderer=a,this.list_info.dataProvider=new eui.ArrayCollection(t)},e}(BasePanel);o.GuildModifyChooseView=i,__reflect(i.prototype,"game.GuildModifyChooseView");var a=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildModifyChooseOneSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.proxy=o.AppFacade.getInstance().retrieveProxy(o.GuildPy.N),this.gp_choose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),50<e.lb_info.text.length?Utils.MsgUtils.addMidMsg("公告最多50字"):(e.proxy.SetNotice(e.lb_info.text),e.data&&e.data.hideCB&&e.data.hideCB())},this)},e.prototype.dataChanged=function(){var e=this.data;this.lb_info.text=e.info},e}(eui.ItemRenderer);__reflect(a.prototype,"GuildModifyChooseOne")}(game||(game={})),function(o){var e=function(i){function e(e){var t=i.call(this)||this;return t.skinName="GuildOperPanelSkin",t.proxy=o.AppFacade.getInstance().retrieveProxy(o.GuildPy.N),t.clickCB=e.clickCB,t.playerId=e.playerId,t.playerName=e.playerName,t}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;if(i.prototype.childrenCreated.call(this),this.playerInfo=this.proxy.getMemberById(this.playerId),!this.playerInfo)return Utils.MsgUtils.addMidMsg("找不到该玩家信息"),void this.hide();this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.lb_name.text=this.playerInfo.baseInfo.name,this.blb_level.text=""+this.playerInfo.baseInfo.level,this.lb_wDevote.text="周贡献："+this.playerInfo.wDevote,this.lb_dDevote.text="日贡献："+this.playerInfo.dDevote,this.lb_id.text="ID:"+this.playerInfo.baseInfo.playerId,RES.getResAsync(ResourceUtils.png(this.playerInfo.baseInfo.avatar),function(e){t.img_avatar.source=e},this),this.initBtn()},e.prototype.initBtn=function(){var i=this,e=o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N).playerGuildVO.position,t=this.playerInfo.position,n=[{name:"踢出",img:"_common2_m_json.guild_btn_tichu",cb:function(){var e=new Array;e.push({text:"确定将",style:{textColor:16777215,size:29}}),e.push({text:" "+i.playerName+" ",style:{textColor:16711680,size:29}}),e.push({text:"踢出公会吗？",style:{textColor:16777215,size:29}}),e.push({text:"\n\n（被踢出公会玩家保留贡献）",style:{textColor:16777215,size:29}}),o.GameMgr.getInstance().showCommonTipsWin({commonTips:e,clickCB:function(e){1===e.type&&(i.proxy.operationReq(EGuildOperationType.TickOut,i.playerId),i.hide())}})}}];e===EGuildPositionType.EGuildPositionTypePresident&&(n.unshift({name:"转让公会",img:"guild_btn_zhuanranggonghui_png",cb:function(){var e=new Array;e.push({text:"确定将公会转让给",style:{textColor:16777215,size:29}}),e.push({text:" "+i.playerName+" ",style:{textColor:16711680,size:29}}),e.push({text:"吗？",style:{textColor:16777215,size:29}}),e.push({text:"\n\n（转让后会长自动降职为会员）",style:{textColor:16777215,size:29}}),o.GameMgr.getInstance().showCommonTipsWin({commonTips:e,clickCB:function(e){1===e.type&&(i.proxy.operationReq(EGuildOperationType.Transfer,i.playerId),i.hide())}})}}),t===EGuildPositionType.EGuildPositionTypeVicePresident?n.unshift({name:"解除副会长",img:"_common2_m_json.guild_btn_jiechufuhui",cb:function(){i.proxy.operationReq(EGuildOperationType.RelieveVice,i.playerId),i.hide()}}):n.unshift({name:"任命副会长",img:"_common2_m_json.guild_btn_renmingfuhui",cb:function(){i.proxy.operationReq(EGuildOperationType.AppointVice,i.playerId),i.hide()}})),n.forEach(function(e){var t=new eui.Image;RES.getResAsync(e.img,function(e){t.source=e},i),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),e.cb()},i),i.gp_btns.addChild(t)})},e}(BasePanel);o.GuildOperPanel=e,__reflect(e.prototype,"game.GuildOperPanel")}(game||(game={})),function(c){var e=function(n){function e(e,t){void 0===t&&(t=!0);var i=n.call(this)||this;return i.params=e,i.show_bnt=t,i.skinName="GuildPlayerInfoPanelSkin",i}return __extends(e,n),e.prototype.childrenCreated=function(){var t=this,i=this.params.publicPlayer;this.lb_name.text=i.baseInfo.name,this.lb_id.text="ID "+i.baseInfo.playerId,this.CommonFightCap.update(i.baseInfo.fightCap),this.gp_btn.visible=this.show_bnt,this.cu_ph.updateData({vo:i.baseInfo}),this.lb_guild.textFlow=[{text:"公会：",style:{textColor:15913814}},{text:""+(i.baseInfo.guild&&i.baseInfo.guild.name||"无"),style:{textColor:16775908}}];var e=0;for(var n in i.heroList){var o,a=i.heroList[n];(o=new customui.BaseItem).x=80*e,o.scaleY=o.scaleX=.65,e++,o.updateData(a),this.gp_hero.addChild(o)}i.petList&&0<i.petList.length&&((o=new customui.BaseItem).x=80*e+15,o.scaleY=o.scaleX=.65,e++,i.petList[0].type=EEntityType.EEntityTypePet,o.updateData(i.petList[0]),this.gp_hero.addChild(o));var r=c.AppFacade.getInstance().retrieveProxy(c.GuildPy.N);this.btn_kick.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.GameMgr.getInstance().showCommonTipsWin({commonTips:[{text:"确认将 ",style:{textColor:11041365}},{text:""+t.params.publicPlayer.baseInfo.name,style:{textColor:4557956}},{text:" 踢出公会吗\n（被踢出公会玩家保留贡献）",style:{textColor:11041365}}],cb:!1,btnLabel:{cancel:"取消",sure:"确定"},clickCB:function(e){0===e.type||1===e.type&&(r.operationReq(EGuildOperationType.TickOut,i.baseInfo.playerId,function(){c.AppFacade.getInstance().updateView(c.GuildMediator.N,c.GuildMediator.SV.MANAGER_VIEW)}),t.hide())}})},this),this.btn_appoint.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.params.position==EGuildPositionType.EGuildPositionTypeVicePresident?r.operationReq(EGuildOperationType.RelieveVice,i.baseInfo.playerId,function(){c.AppFacade.getInstance().updateView(c.GuildMediator.N,c.GuildMediator.SV.MANAGER_VIEW)}):r.operationReq(EGuildOperationType.AppointVice,i.baseInfo.playerId,function(){c.AppFacade.getInstance().updateView(c.GuildMediator.N,c.GuildMediator.SV.MANAGER_VIEW)}),t.hide()},this),this.btn_transfer.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.GameMgr.getInstance().showCommonTipsWin({commonTips:[{text:"确认将公会转让给 ",style:{textColor:11041365}},{text:""+t.params.publicPlayer.baseInfo.name,style:{textColor:4557956}},{text:" 吗\n（转让后会长自动降职为副会长）",style:{textColor:11041365}}],cb:!1,btnLabel:{cancel:"取消",sure:"确定"},clickCB:function(e){0===e.type||1===e.type&&(r.operationReq(EGuildOperationType.Transfer,i.baseInfo.playerId,function(){c.AppFacade.getInstance().updateView(c.GuildMediator.N,c.GuildMediator.SV.MANAGER_VIEW)}),t.hide())}})},this);var s=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N).playerGuildVO.position;s==EGuildPositionType.EGuildPositionTypePresident?this.img_bg.height=400:s==EGuildPositionType.EGuildPositionTypeVicePresident?(this.btn_appoint.parent.removeChild(this.btn_appoint),this.btn_transfer.parent.removeChild(this.btn_transfer),this.img_bg.height=400):(this.btn_appoint.parent.removeChild(this.btn_appoint),this.btn_transfer.parent.removeChild(this.btn_transfer),this.btn_kick.parent.removeChild(this.btn_kick),this.img_bg.height=336),this.params.position==EGuildPositionType.EGuildPositionTypeVicePresident?this.btn_appoint.label="解除副会":this.btn_appoint.label="任命副会",this.img_addFriend.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().retrieveProxy(c.FriendPy.N).addFriend({friendId:t.params.publicPlayer.baseInfo.playerId})},this)},e}(BasePanel);c.GuildPlayerInfoPanel=e,__reflect(e.prototype,"game.GuildPlayerInfoPanel")}(game||(game={}));var Main=function(n){function e(){var e=null!==n&&n.apply(this,arguments)||this;return e.test=!1,e}return __extends(e,n),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【Main】:"].concat(e))},e.prototype.createChildren=function(){var i=this;n.prototype.createChildren.call(this),this.log("__CUR_JS_NAME__:",window.__CUR_JS_NAME__);var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.addChild(GameRootLayer.gameLayer()),this.loadingView=new EasyLoadingUI,GameRootLayer.gameLayer().loadingUIEasy=this.loadingView,GameRootLayer.gameLayer().loadLayer.addChild(this.loadingView),ResVersionManager.getInstance().init();var t=new egret.HttpRequest;t.responseType=egret.HttpResponseType.TEXT,t.once(egret.Event.COMPLETE,function(e){var t=e.currentTarget;try{i.agentConfig=JSON.parse(t.response)}catch(e){egret.warn(e)}i.runGame()},this),t.open("https://cfgdat.binghu.fmggames.cn/binghu_web/agent/wechat3/agent_1_31_2.json",egret.HttpMethod.GET),t.send()},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),Utils.init(),this.startUp(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,i,n,o;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,14,,15]),t=8,i=0,GameRootLayer.gameLayer().switchMenLoading(!0),egret.ImageLoader.crossOrigin="anonymous",this.agentConfig&&this.agentConfig.RemoteResHost?this.agentConfig.isChecking&&this.agentConfig.isChecking.PHP?Utils.XYX_REMOTE_RES_HOST=this.agentConfig.RemoteResHost+"_shenhe":Utils.XYX_REMOTE_RES_HOST=this.agentConfig.RemoteResHost:2==Utils.XYX_REMOTE_RES_HOST.indexOf("XYX_REMOTE_RES_HOST")&&(Utils.XYX_REMOTE_RES_HOST=void 0),n=void 0,this.agentConfig&&"test"!=this.agentConfig.AgentCode?(this.log("使用动态配置"),n="default.res.json?v="+this.agentConfig.JSVer):(this.log("使用时间戳"),n="default.res.json?v="+Date.now()),this.loadingView.setProgress(++i,t),Utils.XYX_REMOTE_RES_HOST?[4,RES.loadConfig(n,Utils.XYX_REMOTE_RES_HOST+"/resource/")]:[3,2];case 1:return e.sent(),[3,4];case 2:return[4,RES.loadConfig(n,"resource/")];case 3:e.sent(),e.label=4;case 4:return this.loadingView.setProgress(++i,t),this.agentConfig?(ResVersionManager.getInstance().loadResVersionComplate(this.agentConfig),this.loadingView.defaultResDone(),[3,7]):[3,5];case 5:return[4,ResVersionManager.getInstance().loadConfig("agent_json")];case 6:e.sent(),this.loadingView.defaultResDone(),e.label=7;case 7:return this.loadingView.setProgress(++i,t),[4,this.loadTheme()];case 8:return e.sent(),this.loadingView.setProgress(++i,t),[4,RES.getResAsync("t_error_code_json")];case 9:return e.sent(),this.loadingView.setProgress(++i,t),[4,RES.getResAsync("t_const_json")];case 10:return e.sent(),this.loadingView.setProgress(++i,t),[4,RES.getResAsync("package_json")];case 11:return e.sent(),Utils.agentConfig.jsPb?[3,13]:(this.loadingView.setProgress(++i,t),[4,RES.getResAsync("game_proto")]);case 12:e.sent(),e.label=13;case 13:return GameRootLayer.gameLayer().switchMenLoading(!1),[3,15];case 14:return o=e.sent(),console.error(o),[3,15];case 15:return[2]}})})},e.prototype.loadTheme=function(){var i=this;return new Promise(function(e,t){new eui.Theme("resource/default.thm.json",i.stage).addEventListener(eui.UIEvent.COMPLETE,function(){e()},i)})},e.prototype.startUp=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.log("startUp"),game.AppFacade.getInstance().startUp(GameRootLayer.gameLayer()),this.test?[3,4]:Utils.agentConfig.OffLineTest?[3,1]:(game.MainJumpConfig.jumpTo("LOGIN"),[3,3]);case 1:return[4,Utils.enterMainOffLine()];case 2:e.sent(),game.MainJumpConfig.jumpTo("GUAJI"),e.label=3;case 3:case 4:return[2]}})})},e}(eui.UILayer);__reflect(Main.prototype,"Main");var TestScreenAdapter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.calculateStageSize=function(e,t,i,n,o){var a=t,r=i,s=n=720,c=o=1280,l=t/s||0,h=i/c||0,p=t/i;return 20/3<p?(s=n=Math.round(20/3*1280),a=Math.round(n*h)):p<9/16?(c=o=Math.round(1280),r=Math.round(o*l)):s=Math.round(t/h),a%2!=0&&(a+=1),r%2!=0&&(r+=1),{stageWidth:s,stageHeight:c,displayWidth:a,displayHeight:r}},t}(egret.HashObject);__reflect(TestScreenAdapter.prototype,"TestScreenAdapter",["egret.sys.IScreenAdapter"]);var lastScriptURI=void 0;window.onerror=function(e,t,i,n,o){if(Utils.isInit&&lastScriptURI!=t){console.log("错误信息：",e),console.log("出错文件：",t),console.log("出错行号：",i),console.log("出错列号：",n),console.log("错误详情：",o);var a={errorMessage:e,scriptURI:lastScriptURI=t,lineNumber:i,columnNumber:n,errorObj:o&&o.stack&&o.stack.toString()||""},r=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N),s=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N);Utils.Http.toGet({action:"get_error",platform:Utils.agentConfig&&Utils.agentConfig.AgentCode||"",username:r&&r.userVO&&r.userVO.uuid||"空",os_code:Utils.DeviceUtils.getPlatform(),user_agent:window.navigator.userAgent,browser_id:Utils.DeviceUtils.getBrowser(),version_time:(window.__CUR_JS_NAME__?window.__CUR_JS_NAME__.substring(0,6):"")+"_"+(Utils.agentConfig&&Utils.agentConfig.VersionTime),agent_name:Utils.agentConfig&&Utils.agentConfig.AgentName||"",last_events:game.MainJumpConfig.lastEvents.toString(),name:s.playerInfoVO.name,detail:JSON.stringify(a)}).then(function(e){console.log("上报结果",e&&e.msg)}),Utils.SDKMgr.onCustomError(a)}},function(o){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new i).register(),(new n).register()},e}();o.GuildBossProcessor=e,__reflect(e.prototype,"game.GuildBossProcessor");var t=function(e){function t(){return e.call(this,"guildBoss.PushBossInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("PushBossInfoP",t),o.AppFacade.getInstance().retrieveProxy(o.GuildBossPy.N).bossInfo.update(t.bossInfo),o.AppFacade.getInstance().retrieveMediator(o.GuildBossMediator.N).updateView(o.GuildBossMediator.SV.MAIN)},t}(o.ProcessorBase);__reflect(t.prototype,"PushBossInfoP");var i=function(e){function t(){return e.call(this,"guildBoss.PushFinishBattleInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("PushFinishBattleInfoP",t);var i=o.AppFacade.getInstance().retrieveProxy(o.GuildBossPy.N);i.bossInfo.update(t.bossInfo),i.playerInfo.update(t.playerBossInfo);var n=o.AppFacade.getInstance().retrieveProxy(o.FightPy.N);n.addDelayCBAfterFightExit(function(){var e=o.AppFacade.getInstance().retrieveMediator(o.GuildBossMediator.N);e.updateView(o.GuildBossMediator.SV.MAIN,{type:o.GuildBossMainView.UPDATE_TYPE.CHALLENGE_INFO}),e.updateView(o.GuildBossMediator.SV.MAIN,{type:o.GuildBossMainView.UPDATE_TYPE.BOSS_INFO}),n.queueExceExitCB()},"GUILD_BOSS")},t}(o.ProcessorBase);__reflect(i.prototype,"PushFinishBattleInfoP");var n=function(e){function t(){return e.call(this,"guildBoss.PushPlayerBossInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();o.AppFacade.getInstance().retrieveProxy(o.GuildBossPy.N).playerInfo.update(t.playerBossInfo)},t}(o.ProcessorBase);__reflect(n.prototype,"PushPlayerBossInfoP")}(game||(game={})),function(r){var n=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){e&&(this.hurt=e.hurt,this.hasBuyTimes=e.hasBuyTimes,this.challengeTimes=e.challengeTimes,NoticeManager.updateNotice(NT.GUILD_BOSS_NUM,void 0,!0))},e}(r.BaseVO);__reflect(n.prototype,"PlayerBossInfoVO");var o=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){e&&(null!=this.lives&&(this.isDeadAndReBoth=e.lives>this.lives),this.day=e.day,this.lives=e.lives,this.count=e.count,this.bossId=e.bossId,this.totalLife=e.totalLife)},e}(r.BaseVO);__reflect(o.prototype,"BossInfoVO");var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.addNotice(),e}return __extends(i,t),i.prototype.addNotice=function(){var e=this;NoticeManager.registerCB(NT.GUILD_BOSS_NUM,function(){return!!(e.playerInfo&&0<e.playerInfo.challengeTimes)},this),NoticeManager.setChildType(NT.GUILD_BOSS,[NT.GUILD_BOSS_NUM])},i.prototype.GetBossInfo=function(){var t=this;Utils.UnlockMgr.checkPass(MODULE.GuildBoss,!1).allow&&Utils.Socket.send("guildBoss","GetBossInfo",{}).then(function(e){console.log("公会boss数据获取 GetBossInfoR",e),t.playerInfo||(t.playerInfo=new n),t.bossInfo||(t.bossInfo=new o),t.playerInfo.update(e.playerBossInfo),t.bossInfo.update(e.bossInfo),t.checkNotice(),r.AppFacade.getInstance().updateView(r.GuildBossMediator.N,r.GuildBossMediator.SV.MAIN)})},i.prototype.BuyChallengeTimes=function(e,t){var i=this;Utils.Socket.send("guildBoss","BuyChallengeTimes",{num:e}).then(function(e){console.log("购买公会boss挑战次数 BuyChallengeTimesR",e),i.playerInfo.challengeTimes=e.playerBossInfo.challengeTimes,i.playerInfo.hasBuyTimes=e.playerBossInfo.hasBuyTimes,i.checkNotice(),r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N).handleClientCost(e.clientCost),r.AppFacade.getInstance().retrieveMediator(r.GuildBossMediator.N).updateView(r.GuildBossMediator.SV.MAIN,{type:r.GuildBossMainView.UPDATE_TYPE.CHALLENGE_INFO}),NoticeManager.updateNotice(NT.GUILD_BOSS_NUM,void 0,!0),t&&t()})},i.prototype.Challenge=function(e){var t=this;e.name,e.level;this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeServerBoss,pb1:"guildBoss",pb2:"Challenge",params:{},doneCB:function(e){console.log("战斗结束",e),t.checkNotice(),r.AppFacade.getInstance().retrieveProxy(r.FightPy.N).queueExceExitCB()}})},i.prototype.checkNotice=function(){},i.prototype.getOpenInfo=function(){if(!this.openInfo){this.openInfo={isOpen:!1,openTime:void 0,endTime:void 0,leastOpenDt:void 0,requestLevel:void 0,openDt:void 0,endDt:void 0};var e=r.AppFacade.getInstance().retrieveProxy(r.LoginPy.N),t=Number(r.Config.constConfig().GuildBossUnlockServerOpenDt.constValue),i=new Date(1e3*e.loginGameVO.serverOpenDt);i.setDate(i.getDate()+t),this.openInfo.leastOpenDt=i.getTime()/1e3,this.openInfo.openTime=JSON.parse(r.Config.constConfig().GuildBossStartDt.constValue),this.openInfo.endTime=JSON.parse(r.Config.constConfig().GuildBossEndDt.constValue),this.openInfo.requestLevel=JSON.parse(r.Config.constConfig().GuildBossUnlockLevel.constValue)}var n=r.AppFacade.getInstance().retrieveProxy(r.GuildPy.N).guildDetail.level,o=Utils.TimerManager.getServerTime(),a=new Date;return a.setTime(1e3*o),a.setHours(this.openInfo.openTime[0],this.openInfo.openTime[1],0,0),this.openInfo.openDt=a.getTime()/1e3,a.setHours(this.openInfo.endTime[0],this.openInfo.endTime[1],0,0),this.openInfo.endDt=a.getTime()/1e3,this.openInfo.isOpen=n>=this.openInfo.requestLevel&&o>=this.openInfo.leastOpenDt&&o>=this.openInfo.openDt&&o<this.openInfo.endDt,this.openInfo},i.N="GuildBossPy",i}(BaseProxy);r.GuildBossPy=e,__reflect(e.prototype,"game.GuildBossPy")}(game||(game={})),function(l){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildBossFightRewardPanel",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;this.daTanChuKuang0.blb_title.text="奖励",this.daTanChuKuang0.onCloseCB=function(){e.hide()};var t=l.Config.guildBossConfig(),i=l.AppFacade.getInstance().retrieveProxy(l.GuildBossPy.N),n=i.bossInfo&&i.bossInfo.day;if(n){var o=t[1];for(var a in t){var r=t[a];r.day==n&&(o=r)}if(o){var s=JSON.parse(o.hurtReward);this.addReward(s,this.gp_fight);var c=JSON.parse(o.guildReward);this.addReward(c[0],this.gp_first),this.addReward(c[1],this.gp_noFirst)}}},e.prototype.addReward=function(e,t){for(var i in e){var n=e[i],o=customui.BaseItemFactory.create();o.scaleX=o.scaleY=.7,o.updateData({reward:n}),t.addChild(o)}},e}(BasePanel);l.GuildBossFightRewardPanel=e,__reflect(e.prototype,"game.GuildBossFightRewardPanel")}(game||(game={})),function(r){var e=function(t){function a(){var e=t.call(this)||this;return e.proxy=r.AppFacade.getInstance().retrieveProxy(r.GuildBossPy.N),e.mainPy=r.AppFacade.getInstance().retrieveProxy(r.MainPy.N),e.skinName="GuildBossMainSkin",e}return __extends(a,t),a.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),this._activateComponent(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btn),this.map=Utils.MapUtils.generateCommon({source:MODULE.GuildBoss,multiLayerScroller:this.cu_mls,loadingParent:this.getParentView(),miniMapParent:Utils.SDKMgr.getPerformConfig(6)?void 0:this.gp_mini_map,onTouchTap:function(e,t){i.mainPy.SyncCoordinateInfo(e,t,"1",MODULE.GuildBoss)}}),this.gp_map.addChildAt(this.map,0)},a.prototype.updateView=function(e,t){var i=this;if(console.log("【chl】updateView1"),!r.AppFacade.getInstance().retrieveProxy(r.FightPy.N).isInFight){var n=this.mainPy.getMyCoordinateInfo(MODULE.GuildBoss);if(!t&&n)if(this.btn_challenge.visible=!0,this.proxy.playerInfo){var o=e&&e.type||a.UPDATE_TYPE.INIT;switch(console.log("【chl】updateView1",o),o){case a.UPDATE_TYPE.INIT:this.updateBossInfo(),this.updateChallengeInfo();break;case a.UPDATE_TYPE.BOSS_INFO:this.updateBossInfo();break;case a.UPDATE_TYPE.CHALLENGE_INFO:this.updateChallengeInfo()}}else this.proxy.GetBossInfo();else this.mainPy.GetCoordinateInfo(MODULE.GuildBoss,function(){i.updateView(e)})}},a.prototype.jumpToChatper=function(e){if(this.curBossday!=e){this.curBossday=e;var t=this.mainPy.getMyCoordinateInfo(MODULE.GuildBoss),i=this.mainPy.getOtherCoordinateInfo(MODULE.GuildBoss),n=r.Config.guildBossConfig()[e],o=JSON.parse(n.initLocation);this.map.tiled!=n.tiled&&this.map.update({isInit:!0,tiled:n.tiled,theme:n.theme,w:n.w,h:n.h,meStartTileX:o[0],meStartTileY:o[1]}),this.proxy.getOpenInfo().isOpen&&(this.map.touchEnabled=!1,this.map.updateNPC({curPosVO:{x:t.coordinate&&t.coordinate.x||o[0],y:t.coordinate&&t.coordinate.y||o[1],isFixed:!0},otherCoordInfos:i}))}},a.prototype.updateBossInfo=function(e){var t=this;if(void 0===e&&(e=!1),console.log("【chl】updateBossInfo",this.isBossDeading),!this.isBossDeading){var i=this.proxy.bossInfo;if(console.log("【chl】updateBossInfo",i&&i.isDeadAndReBoth),i&&i.isDeadAndReBoth){if(r.AppFacade.getInstance().retrieveProxy(r.FightPy.N).isInFight)return;return i.isDeadAndReBoth=void 0,this.isBossDeading=!0,void this.bossDeadAction(function(){t.switchScreenLayer(!0),DragonBoneTools.playOnce({effectName:"common_shijiebossdjs",parent:t,doneCB:function(){t.switchScreenLayer(!1),t.isBossDeading=!1,t.updateBossInfo(!0)}})})}this.bossConfig=r.Config.guildBossConfig()[i.day],this.bossCreepInfo=r.Config.creepConfig(i.bossId),this.jumpToChatper(i.day),this.map.cleanAllEP();var n=r.Config.guildBossConfig()[i.day],o=JSON.parse(n.bossLocation),a=[];a.push(new r.EventVO({fadeType:FadeRiskEventType.BigBoss,position:{x:o[0],y:o[1]},config:{heroC:this.bossCreepInfo,hp:i.lives,initHp:this.proxy.bossInfo.totalLife},isDirty:!0,customTrigger:function(e){e&&t.reqFightBoss()},hudongAction:{appear:e}})),this.map.updateLayerEvent({events:a}),this.map.showMePathToPos({tileX:o[0],tileY:o[1]})}},a.prototype.updateChallengeInfo=function(){this.blb_count.text=this.proxy.playerInfo.challengeTimes.toString()},a.prototype.switchScreenLayer=function(e){this.darkSprite||(this.darkSprite=new egret.Sprite,this.darkSprite.touchEnabled=!0,this.gp_main.addChildAt(this.darkSprite,this.gp_main.getChildIndex(this.btn_back)),this.darkSprite.graphics.clear(),this.darkSprite.graphics.beginFill(0,.6),this.darkSprite.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),this.darkSprite.graphics.endFill()),this.darkSprite.visible=e},a.prototype.updateCoordInfo=function(){var e=this.mainPy.getMyCoordinateInfo(MODULE.GuildBoss),t=this.mainPy.getOtherCoordinateInfo(MODULE.GuildBoss);e&&this.map.isInited&&(this.map.updateNPC({curPosVO:{x:e.coordinate&&e.coordinate.x,y:e.coordinate&&e.coordinate.y,isFixed:!0},otherCoordInfos:t}),this.map.resetCamera()),e.coordinate.iAmClean()},a.prototype.bossDeadAction=function(e){if(this.map.isInited){var t=JSON.parse(this.bossConfig.bossLocation),i=this.map.tile2EP(t[0],t[1]);i&&i.hudongWithEP?i.hudongWithEP({playDeadAction:!0,cb:e}):egret.warn("该boss已经不存在，或者该位置上的ep已经不是big boss ep",i)}},a.prototype._activateComponent=function(){this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"GUILD_BOSS"})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new r.HelpDialog({moduleId:MODULE.GuildBoss})})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new r.GuildBossFightRewardPanel})},this),this.btn_challenge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.proxy.playerInfo.challengeTimes<=0?this.showBuyPanel():this.findBoss()},this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.MainJumpConfig.jumpTo()},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.showBuyPanel()},this)},a.prototype.perClose=function(){this.map.reset()},a.prototype.findBoss=function(){if(!this.isBossDeading&&this.map&&this.bossConfig){var e=JSON.parse(this.bossConfig.bossLocation);this.map.handleTouchTap(e[0],e[1])}},a.prototype.showBuyPanel=function(){var t=this;r.AppFacade.getInstance().showSubView(r.CommonMediator.N,r.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.GuildBoss,hasBuyNum:this.proxy.playerInfo.hasBuyTimes,maxBuyNum:r.Config.VIPConfig().guildBossBuyTimes,buyCB:function(e){t.proxy.BuyChallengeTimes(e,function(){Utils.MsgUtils.addMidMsg("成功购买"+e+"次")})}})},a.prototype.reqFightBoss=function(){var e=this.proxy.getOpenInfo();if(e.isOpen)0==this.proxy.bossInfo.lives?Utils.MsgUtils.addMidMsg("BOSS已被击败"):this.proxy.playerInfo.challengeTimes<=0?this.showBuyPanel():this.bossCreepInfo&&this.bossConfig&&this.proxy.Challenge({name:this.bossCreepInfo.name,level:this.bossConfig.level,day:this.curBossday});else{var t=e.openTime,i=e.endTime,n=9<t[0]?t[0].toString():"0"+t[0].toString(),o=9<t[1]?t[1].toString():"0"+t[1].toString(),a=9<i[0]?i[0].toString():"0"+i[0].toString(),r=9<i[1]?i[1].toString():"0"+i[1].toString();Utils.MsgUtils.addMidMsg(n+":"+o+" ~ "+a+":"+r+"开启挑战")}},a.UPDATE_TYPE={INIT:1,BOSS_INFO:2,CHALLENGE_INFO:3},a}(BaseFull);r.GuildBossMainView=e,__reflect(e.prototype,"game.GuildBossMainView")}(game||(game={})),function(p){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=p.AppFacade.getInstance().retrieveProxy(p.GuildBossPy.N),e.skinName="GuildBossRewardSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.initList(),this.daTanChuKuang.onCloseCB=function(){e.hide()}},e.prototype.initList=function(){this.item_list=new eui.List;var e=new eui.VerticalLayout;this.item_list.layout=e,this.item_list.itemRenderer=i,this.scroller.viewport=this.item_list,this.scroller.verticalScrollBar.autoVisibility=!1,this.scroller.verticalScrollBar.visible=!1},e.prototype.updateView=function(e){var i=this;this.lb_desc.text="BOSS被击杀后，你可获得以下奖励：";var t=this.proxy.bossInfo,n=p.Config.guildBossConfig()[t.day],o=JSON.parse(n.guildReward),a=o[t.count]||o[o.length-1];this.gp_rewards.removeChildren(),a.forEach(function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,t.updateData({type:e[0],code:e[1],num:e[2]}),i.gp_rewards.addChild(t)});var r=p.Config.rankingRewardByTypeConfig(RankingType.RankingTypeWorldWorldKing),s=[];for(var c in s.push({rewards:n.killReward}),r)for(var l=r[c],h=l.rankUpper;h<=l.rankLower;h++)s.push({rank:h,rewards:l.rewards});s.sort(function(e,t){return(e.rank||0)-(t.rank||0)}),this.item_list.dataProvider=new eui.ArrayCollection(s)},e}(BasePanel);p.GuildBossRewardPanel=e,__reflect(e.prototype,"game.GuildBossRewardPanel");var i=function(i){function e(){var e=i.call(this)||this;return e.skinName="GuildBossReward_RewardItem",e}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this);for(var e=1;e<=3;e++){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,this.gp_rewards.addChild(t)}},e.prototype.dataChanged=function(){var e=this.data.rank;e?e<=3?(this.img_icon.visible=!0,this.lb_rank.visible=!1,this.img_icon.source="jjc_icon_pm_"+e+"_png"):(this.img_icon.visible=!1,this.lb_rank.visible=!0,this.lb_rank.text=e.toString()):(this.img_icon.visible=!0,this.lb_rank.visible=!1,this.img_icon.source="");for(var t=JSON.parse(this.data.rewards),i=0;i<3;i++){var n=this.gp_rewards.getChildAt(i),o=t[i];o?(n.visible=!0,n.updateData({type:o[0],code:o[1],num:o[2]})):n.visible=!1}},e}(eui.ItemRenderer);__reflect(i.prototype,"GuildBossReward_RewardItem")}(game||(game={})),function(n){var e=function(t){function i(e){return void 0===e&&(e=null),t.call(this,i.N,e)||this}return __extends(i,t),i.prototype.initSubView=function(){this.addSubView(i.SV.MAIN,n.GuildCollectView),this.addSubView(i.SV.REWARD,n.GuildCollectRewardPanel)},i.prototype.listNotificationInterests=function(){return[CN.GUILD_FIRST_INFO_UPDATE,CN.GUILD_COLLECT_INFO_UPDATE,CN.GENERAL_PASS_DAY,CN.GUILD_INFO_UPDATE]},i.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GUILD_INFO_UPDATE:case CN.GENERAL_PASS_DAY:case CN.GUILD_FIRST_INFO_UPDATE:n.AppFacade.getInstance().retrieveProxy(n.GuildCollectPy.N).GetGuildCollectInfo();break;case CN.GUILD_COLLECT_INFO_UPDATE:this.updateView(i.SV.MAIN,{isResh:!0})}},i.prototype.onViewCreate=function(){},i.N="GuildCollectMediator",i.SV={MAIN:1,REWARD:2},i}(BaseMediator);n.GuildCollectMediator=e,__reflect(e.prototype,"game.GuildCollectMediator")}(game||(game={})),function(i){var e=function(){function e(){}return e.registerAll=function(){(new t).register()},e}();i.GuildCollectProcessor=e,__reflect(e.prototype,"game.GuildCollectProcessor");var t=function(e){function t(){return e.call(this,"guildCollect.GuildCollectInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody().info;i.AppFacade.getInstance().retrieveProxy(i.GuildCollectPy.N).collectInfoVO.update(t)},t}(i.ProcessorBase);i.GuildCollectInfoP=t,__reflect(t.prototype,"game.GuildCollectInfoP")}(game||(game={})),function(n){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.collectInfoVO=new n.GuildCollectInfoVO,e.initNotice(),e}return __extends(i,t),i.prototype.initNotice=function(){NoticeManager.registerCB(NT.GUILD_COLLECT,this.checkCollectNotice,this)},i.prototype.checkCollectNotice=function(){return!!(this.collectInfoVO&&this.collectInfoVO.num<this.collectInfoVO.taskList.length)},i.prototype.checkCollectReward=function(){this.collectInfoVO.rewardList.length&&n.GameMVC.fightPy.addDelayCBAfterFightExit(function(){n.AppFacade.getInstance().showSubView(n.GuildCollectMediator.N,n.GuildCollectMediator.SV.REWARD)},"guildCollect")},i.prototype.GetGuildCollectInfo=function(t){var i=this;n.AppFacade.getInstance().retrieveProxy(n.GuildPy.N).isInGuild()&&Utils.Socket.send("guildCollect","GetGuildCollectInfo",{}).then(function(e){i.collectInfoVO.update(e.info),t&&t()})},i.prototype.AcceptGuildCollectTask=function(e,t){var i=this;Utils.Socket.send("guildCollect","AcceptGuildCollectTask",{id:e}).then(function(e){i.collectInfoVO.update(e.info),t&&t()})},i.prototype.FinishGuildCollect=function(e,t){var i=this;Utils.Socket.send("guildCollect","FinishGuildCollect",{id:e}).then(function(e){i.collectInfoVO.update(e.info),n.AppFacade.getInstance().retrieveProxy(n.BackpackPy.N).handleClientReward(e.clientReward),t&&t()})},i.prototype.CancelGuildCollect=function(e,t){var i=this;Utils.Socket.send("guildCollect","CancelGuildCollect",{id:e}).then(function(e){i.collectInfoVO.update(e.info),t&&t()})},i.prototype.RefreshGuildCollect=function(t){var i=this;Utils.Socket.send("guildCollect","RefreshGuildCollect",{}).then(function(e){i.collectInfoVO.update(e.info),t&&t()})},i.prototype.GetCollectReward=function(t){var i=this;Utils.Socket.send("guildCollect","GetCollectReward",{uuid:""}).then(function(e){i.collectInfoVO.update(e.info),n.GameMVC.backpackPy.handleClientReward(e.clientReward),t&&t()})},i.N="GuildCollectProxy",i}(BaseProxy);n.GuildCollectPy=e,__reflect(e.prototype,"game.GuildCollectPy")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.LABEL_STYLE={1:[24919,20],2:[9767986,20],3:[5770864,20],4:[944654,20],5:[4003586,20],6:[1584232,20],7:[13123589,20]},e.skinName="GuildCollectRewardSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.actComp()},e.prototype.updateView=function(){var o=this,e=i.GameMVC.guildCollectPy.collectInfoVO,n=[],a=[],r=i.Config.getGuildCollect();e.rewardList.forEach(function(e){var t=e.id,i=r[t];n=n.concat(JSON.parse(i.rewards)),null==a[i.star]&&(a[i.star]=0),a[i.star]+=1}),this.gp_rewards.removeChildren(),n.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),o.gp_rewards.addChild(t)}),this.gp_desc.removeChildren(),a.forEach(function(e,t){if(e){var i=o.LABEL_STYLE[t],n=new eui.Label;n.width=n.height=void 0,n.textColor=i[0],n.size=i[1],n.text=t+"星任务       x"+e,o.gp_desc.addChild(n)}})},e.prototype.perClose=function(){i.GameMVC.guildCollectPy.GetCollectReward()},e.prototype.actComp=function(){var e=this;Utils.TouchUtils.addTouchListener(this.btn_confirm,function(){e.hide()})},e}(BasePanel);i.GuildCollectRewardPanel=e,__reflect(e.prototype,"game.GuildCollectRewardPanel")}(game||(game={})),function(a){var o=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildCollectViewSkin",e.py=a.AppFacade.getInstance().retrieveProxy(a.GuildCollectPy.N),e.playerProxy=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.initUI(),this.initButton(),this.py.GetGuildCollectInfo(function(){e.updateView(void 0),e.initTimer()})},e.prototype.initTimer=function(){this.scheId||(this.guildCollectRefreshCycle=Number(a.Config.constConfig().GuildCollectRefreshCycle.constValue),this.scheId=egret.setInterval(this.updateTm,this,1e3))},e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.scheId&&egret.clearInterval(this.scheId)},e.prototype.initButton=function(){var i=this;a.Config.getGuildCollect();this.cu_dtc.blb_title.text="采集任务",this.cu_dtc.onCloseCB=function(){i.hide()},this.cu_cbwn_refresh.btn_oppr.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=0,e=JSON.parse(a.Config.constConfig().GuildCollectRefreshCosts.constValue)[0];i.py.collectInfoVO.taskList.forEach(function(e){e.dt<=0&&t++}),0<t?a.GameMgr.getInstance().showCommonTipsWin({costTips:"进行刷新任务吗？\n（已接受的任务，不会被刷新）",cost:[[e[0],e[1],t*e[2]]],source:"GUILD_COLLECT_REFREASH",cb:!0,clickCB:function(e){1==e.type&&i.py.RefreshGuildCollect(function(){i.updateList()})}}):Utils.MsgUtils.addMidMsg("无可刷新任务，请先完成")},this),this.cu_cbwn_refresh.updateData({text:"刷新"}),this.cu_cbwn_refresh.btn_oppr.skinName="skins.ButtonSkinBlue"},e.prototype.initUI=function(){this.lv_main=new eui.List;var e=new eui.VerticalLayout;e.gap=10,this.lv_main.layout=e,this.sl_root.viewport=this.lv_main,this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_root.scrollPolicyV=eui.ScrollPolicy.AUTO,this.lv_main.itemRenderer=i,this.dataProvider=new eui.ArrayCollection,this.lv_main.dataProvider=this.dataProvider},e.prototype.updateView=function(e){if(this.isCreateComplete){a.GameMgr.getInstance().serverTime(),a.Config.getGuildCollect();var t=this.py.collectInfoVO.num<Number(this.py.collectInfoVO.taskList.length);UIActionManager.setAbsGrey(this.cu_cbwn_refresh,!t),this.cu_cbwn_refresh.enabled=t,this.lb_tips.textFlow=[{text:"任务",style:{textColor:7748625}},{text:"("+this.py.collectInfoVO.num+"/"+this.py.collectInfoVO.taskList.length+")",style:{textColor:10158080}},{text:"将在",style:{textColor:7748625}}]}e&&e.isResh&&this.updateList()},e.prototype.updateList=function(){var i=this,n=a.Config.getGuildCollect();this.dataProvider.removeAll(),this.lv_main.scrollV=0;var o=a.GameMgr.getInstance().serverTime();this.py.collectInfoVO.taskList.forEach(function(e,t){e.flag||i.dataProvider.addItem({id:e.id,c:n[e.id],cb:i.onItemClick,thiz:i,isWorking:0<e.dt,isCanGet:0<e.dt&&o-e.dt>=n[e.id].cycle})}),this.dataProvider.source.sort(function(e,t){return e.isCanGet&&!t.isCanGet?-1:!e.isCanGet&&t.isCanGet?1:e.isWorking&&!t.isWorking?1:!e.isWorking&&t.isWorking?-1:e.c.star!=t.c.star?t.c.star-e.c.star:e.id-t.id}),this.gp_empty.visible=this.dataProvider.length<=0},e.prototype.updateTm=function(){var o=this;if(!this.refreshing){var e=Utils.TimerManager.getNextDayTime(Utils.TimerManager.getServerTime())-Utils.TimerManager.getServerTime();if(!(0<e))return this.refreshing=!0,void this.py.GetGuildCollectInfo(function(){o.refreshing=!1});this.blb_sche.text=Utils.TimerManager.getFormatBySecond1(e)}this.py.collectInfoVO.taskList.forEach(function(e){if(0<e.dt){e.cur+=1;for(var t=0,i=o.dataProvider.source;t<i.length;t++){var n=i[t];if(n.id==e.id){o.dataProvider.itemUpdated(n);break}}}})},e.prototype.onItemClick=function(e,t){for(var i=this,n=void 0,o=0,a=this.dataProvider.source;o<a.length;o++){var r=a[o];if(r.id==e.data.c.id){n=r;break}0}2==t?(this.log("开始"),this.py.AcceptGuildCollectTask(e.data.c.id,function(){i.dataProvider.itemUpdated(n)})):1==t?(this.log("done"),this.py.FinishGuildCollect(e.data.c.id,function(){i.updateList(),i.gp_empty.visible=i.dataProvider.length<=0})):3==t?(this.log("加速"),this.py.FinishGuildCollect(e.data.c.id,function(){i.updateList(),i.gp_empty.visible=i.dataProvider.length<=0})):-1==t&&(this.log("取消"),this.py.CancelGuildCollect(e.data.c.id,function(){i.dataProvider.itemUpdated(n)}))},e.prototype.perClose=function(){a.AppFacade.getInstance().updateView(a.GuildMediator.N,a.GuildMediator.SV.MAIN_MAP)},e.TASK_STATUS={READY:0,WORKING:1,GET:2,DONE:3},e}(BasePanel);a.GuildCollectView=o,__reflect(o.prototype,"game.GuildCollectView");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildCollectViewSkin_1",e.py=a.AppFacade.getInstance().retrieveProxy(a.GuildCollectPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){var i=this;this.pb_1.slideDuration=0,this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.GameMgr.getInstance().showCommonTipsWin({source:"guild_collect_cancel",commonTips:"关闭该任务将重置当前采集进度。",cb:!1,clickCB:function(e){1===e.type&&i.data.cb&&i.data.cb.call(i.data.thiz,i,-1)}})},this),this.btn_oppr.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.status==o.TASK_STATUS.GET?i.data.cb&&i.data.cb.call(i.data.thiz,i,1):i.data.cb&&i.data.cb.call(i.data.thiz,i,2)},this),this.btn_speed.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.GameMgr.getInstance().showCommonTipsWin({costTips:"钻石，立即完成采集",source:"guild_collect_time",cost:i.data.c.costs,cb:!0,clickCB:function(e){1===e.type&&i.data.cb&&i.data.cb.call(i.data.thiz,i,3)}})},this),this.pb_1.labelFunction=function(e,t){return i.status==o.TASK_STATUS.DONE||i.status==o.TASK_STATUS.GET?"完成":Utils.TimerManager.getFormatBySecond1(t-e)}},e.prototype.lockChange=function(){this.btn_lock.icon="_guild_m_json.gonghui_icon_cjrw"+this.data.c.star},e.prototype.dataChanged=function(){var i=this,e=this.data.c,t=!1;(e.id!=this.lastId&&(this.lastId=e.id,t=!0),this.vo=this.py.collectInfoVO.id2TaskVO[e.id],t)&&(this.lb_name.text=e.desc,this.blb_star.text="x"+e.star,this.gp_rewards.removeChildren(),JSON.parse(e.rewards).forEach(function(e){var t=customui.BaseItemFactory.create({reward:e});t.scaleX=t.scaleY=.9,i.gp_rewards.addChild(t)}),this.pb_1.maximum=e.cycle);var n=0;this.vo?(this.vo.isLock=!1,0==this.vo.dt?(this.vo.isLock=!0,n=o.TASK_STATUS.READY,this.pb_1.value=0,this.lb_time.text=Utils.TimerManager.getFormatBySecond2(e.cycle)):this.vo.cur>=e.cycle?(n=this.vo.flag?o.TASK_STATUS.DONE:o.TASK_STATUS.GET,this.pb_1.value=e.cycle):(n=o.TASK_STATUS.WORKING,this.pb_1.value=this.vo.cur)):egret.warn("找不到对应id:"+e.id),this.lockChange(),this.switchStatus(n,t)},e.prototype.switchStatus=function(e,t){if(this.status!=e)switch(this.img_bg.source="common_img_kt_4_png",this.status=e){case o.TASK_STATUS.READY:this.btn_oppr.label="接受",this.pb_1.visible=this.btn_speed.visible=this.btn_cancel.visible=!1,this.gp_time.visible=this.btn_oppr.enabled=this.btn_oppr.visible=!0;break;case o.TASK_STATUS.WORKING:this.pb_1.visible=this.btn_speed.visible=this.btn_cancel.visible=!0,this.btn_oppr.label="",this.gp_time.visible=this.btn_oppr.enabled=this.btn_oppr.visible=!1;break;case o.TASK_STATUS.GET:this.gp_time.visible=this.btn_speed.visible=this.btn_cancel.visible=!1,this.img_bg.source="common_img_kt_5_png",this.btn_oppr.label="完成",this.pb_1.visible=this.btn_oppr.enabled=this.btn_oppr.visible=!0;break;case o.TASK_STATUS.DONE:this.gp_time.visible=this.btn_speed.visible=this.btn_cancel.visible=!1,this.btn_oppr.label="已完成",this.btn_oppr.enabled=!1,this.pb_1.visible=this.btn_oppr.visible=!0}},e}(eui.ItemRenderer);__reflect(i.prototype,"TaskItemRender")}(game||(game={})),function(o){var e=function(t){function e(){var e=t.call(this)||this;return e.index=1,e.skinName="GuildSkillEscSkin",e.GuildSkillPy=o.AppFacade.getInstance().retrieveProxy(o.GuildSkillPy.N),e.daTanChuKuang.blb_title.text="重置",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.daTanChuKuang.onCloseCB=function(){o.AppFacade.getInstance().hideSubView(o.GuildSkillMediator.N,o.GuildSkillMediator.SV.ESC)},this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.GuildSkillPy.ResetGuildSkill(e.index)},this)},e.prototype.updateView=function(e){this.index=e;var t=1;t=this.GuildSkillPy.restNum<=0?1:7<=this.GuildSkillPy.restNum?6:this.GuildSkillPy.restNum+1;var i=o.Config.guild_skill_reset()[t],n=JSON.parse(i.costs);this.btn.updateData({cost:n[0],text:n[0]?"重置":"免费"})},e}(BasePanel);o.GuildSkillEscView=e,__reflect(e.prototype,"game.GuildSkillEscView")}(game||(game={})),function(v){var e=function(i){function e(){var e,t=i.call(this)||this;return t.index=0,t.select=0,t.skillConfig=[],t.playerProxy=v.AppFacade.getInstance().retrieveProxy(v.PlayerPy.N),t.ITEM_TYPE_CONFIG=((e={})[HeroProfessionType.Warrior-1]={desc:"战士",barSource:{up:"_btn_yq_m_json.common_yeqian_zhanshi_0",down:"_btn_yq_m_json.common_yeqian_zhanshi_1"},icon:"_guild_skill_m_json.gonghui_img_jineng1"},e[HeroProfessionType.Enchanter-1]={desc:"法师",barSource:{up:"_btn_yq_m_json.common_yeqian_fashi_0",down:"_btn_yq_m_json.common_yeqian_fashi_1"},icon:"_guild_skill_m_json.gonghui_img_jineng2"},e[HeroProfessionType.Pastor-1]={desc:"牧师",barSource:{up:"_btn_yq_m_json.common_yeqian_mushi_0",down:"_btn_yq_m_json.common_yeqian_mushi_1"},icon:"_guild_skill_m_json.gonghui_img_jineng5"},e[HeroProfessionType.Hunter-1]={desc:"游侠",barSource:{up:"_btn_yq_m_json.common_yeqian_youxia_0",down:"_btn_yq_m_json.common_yeqian_youxia_1"},icon:"_guild_skill_m_json.gonghui_img_jineng3"},e),Utils.AssetsMgr.loadGroup("group_guild_skill"),t.skinName="GuildSkillSkin",t.GuildSkillPy=v.AppFacade.getInstance().retrieveProxy(v.GuildSkillPy.N),t.EntrancePy=v.AppFacade.getInstance().retrieveProxy(v.CopyEntrancePy.N),t}return __extends(e,i),e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_guild_skill")},e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cu_resBar),this.commonDaTanKuang.blb_title.text=this.ITEM_TYPE_CONFIG[0].desc,this.btn_maxLevel.visible=!1,this.initList()},e.prototype.initTabbar=function(){var e=[];for(var t in this.ITEM_TYPE_CONFIG){var i=this.ITEM_TYPE_CONFIG[t];i&&e.push({source:i.barSource})}this.tabbar_type.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar_type.dataProvider=new eui.ArrayCollection(e),this.tabbar_type.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this)},e.prototype.initUI=function(){var e=[EPropertyType.EPropertyTypeDevote,EPropertyType.EPropertyTypeGold];this.cu_resBar.updateBar({costs:e,width:190,needAdd:!0})},e.prototype.initButton=function(){var n=this;this.commonDaTanKuang.onCloseCB=function(){v.AppFacade.getInstance().sendNotification(CN.MAIL_CLOSE_MAIN),v.AppFacade.getInstance().hideSubView(v.GuildSkillMediator.N,v.GuildSkillMediator.SV.MAIN)},this.uplevel_bnt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=n.getConfig(n.index,n.select,1);n.GuildSkillPy.LearnGuildSkill(n.index+1,e.type,function(e){DragonBoneTools.playUniqueEffect({effectName:"common_ty_dj",parent:n,x:n.width/2,y:n.height/4,timeScale:1}),DragonBoneTools.playUniqueEffect({effectName:"common_kejizhongxin",parent:n.gp_effect}),n.GuildSkillPy.updateGuildSkillInfo(e.info),v.AppFacade.getInstance().updateView(v.GuildSkillMediator.N,v.GuildSkillMediator.SV.MAIN)})},this),this.rest.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=Object.keys(v.Config.guild_skill_reset()).length,t=1;t=n.GuildSkillPy.restNum<=0?1:n.GuildSkillPy.restNum>=e?e:n.GuildSkillPy.restNum+1;var i=v.Config.guild_skill_reset()[t];i.costs?v.GameMgr.getInstance().showCommonTipsWin({costTips:"钻石重置当前职业\n的公会科技,并返回之前消耗的公会\n币和金币。",source:"guild_skill_time",cost:i.costs,cb:!0,clickCB:function(e){1===e.type&&n.GuildSkillPy.ResetGuildSkill(n.index)}}):v.GameMgr.getInstance().showCommonTipsWin({commonTips:"重置当前职业的公会科技将花费一\n定数额钻石,并返回之前消耗的公会\n币和金币，第一次重置免费。",cb:!1,btnLabel:{cancel:"取消",sure:"重置"},clickCB:function(e){0===e.type||1===e.type&&n.GuildSkillPy.ResetGuildSkill(n.index)}})},this);for(var e=function(e){t.skillView["skill"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.updateSkillSelect(e)})},t=this,i=0;i<8;i++)e(i)},e.prototype.initList=function(){this.initTabbar(),this.initButton()},e.prototype.onBarItemTap=function(e){(3==e.itemIndex?4:e.itemIndex)!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.commonDaTanKuang.blb_title.text=this.ITEM_TYPE_CONFIG[3==e.itemIndex?4:e.itemIndex].desc,this.index=3==e.itemIndex?4:e.itemIndex,this.updateSkillView())},e.prototype.addNotice=function(){},e.prototype.updateView=function(e){this.updateSkillView()},e.prototype.chageSelect=function(e){this.skillView["skill"+this.select].select.visible=!1,this.skillView["skill"+e].select.visible=!0},e.prototype.updateSkillSelect=function(e){var t=this;this.chageSelect(e),this.select=e;var i=this.getConfig(this.index,this.select,1),n=this.GuildSkillPy.GetProSkillInfo(this.index+1,i.type)||0,o=this.getConfig(this.index,this.select,n),a=this.getConfig(this.index,this.select,n+1);this.gp_cost.visible=this.com0.addAttr.visible=this.com0.jiantou.visible=o;var r=!1;if(o){var s=JSON.parse(o.attrAdd),c=a&&JSON.parse(a.attrAdd);this.gp_com.removeChildren();for(var l=0;l<s.length;++l){var h=0<n?this.ITEM_TYPE_CONFIG[this.index].desc+v.GeneralConfig.getAttrName(s[l][0])+"+"+v.GeneralConfig.getAttrValue(s[l][1]):this.ITEM_TYPE_CONFIG[this.index].desc+v.GeneralConfig.getAttrName(s[l][0])+"+0",p="+"+(c&&v.GeneralConfig.getAttrValue(c[l][1])||"0"),d=new T;d.updateData({nameTip:h,addAttr:p,isMaxLevel:!a&&0<n}),this.gp_com.addChild(d)}this.uplevel_bnt.visible=c||!1,this.gp_cost.visible=c||!1,this.btn_maxLevel.visible=!c,this.btn_maxLevel.y=this.gp_com.y+this.gp_com.height+10,this.gp_cost.removeChildren();var u=JSON.parse(a?a.costs:o.costs);for(var g in u){var f=u[g];this.gp_cost.addChild(new customui.CommonIconWithNum({cost:f,style:CommonIconStyle.RIGHT,needBg:!0}))}var _=function(){var e=JSON.parse(o.condition);0!=e.length&&t.GuildSkillPy.GetProSkillInfo(t.index+1,e[0][0])<e[0][1]?t.redTip.text="需要上一个技能达到"+e[0][1]+"级":t.redTip.text=""};this.gp_cost.visible=!0,UIActionManager.setAbsGrey(this.uplevel_bnt,!1),this.uplevel_bnt.touchEnabled=!0;var m=v.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.GuildSkill,{id:n+1});m.isBelonged?m.unlock?_():(this.redTip.text="封印之地玩法解锁",UIActionManager.setAbsGrey(this.uplevel_bnt,!0),this.uplevel_bnt.touchEnabled=!1,r=!(this.gp_cost.visible=!1)):_()}else if(a){c=JSON.parse(a.attrAdd);this.com0.nameTip.text=this.ITEM_TYPE_CONFIG[this.index].desc+v.GeneralConfig.getAttrName(c[0][0])+"+"+v.GeneralConfig.getAttrValue(c[0][1]),this.redTip.text="",this.uplevel_bnt.visible=!1}var y=this.btn_maxLevel.visible?this.btn_maxLevel:this.gp_com;this.redTip.y=y.height+y.y+10,this.fulllevel.visible=!r&&!this.uplevel_bnt.visible,this.zy.text=this.getConfig(this.index,this.select,n).name,0==n&&(this.zy.text=this.zy.text.slice(0,this.zy.text.length-1)+"0")},e.prototype.updateSkill=function(e){var t=new egret.ColorMatrixFilter(this.EntrancePy.ColorMatrix()),i=this.getConfig(this.index,e,1),n=this.GuildSkillPy.GetProSkillInfo(this.index+1,i.type),o=this.getConfig(this.index,e,n+1),a=this.getConfig(this.index,e,n),r=this.skillView["skill"+e];if(r.jh.visible=!1,r.icon.filters=[],o){JSON.parse(o.attrAdd),JSON.parse(a.attrAdd);var s=JSON.parse(o.condition);0!=s.length&&this.GuildSkillPy.GetProSkillInfo(this.index+1,s[0][0])<s[0][1]?0==n&&(r.icon.filters=[t]):0==n&&(r.jh.visible=!0)}},e.prototype.updateSkillView=function(){this.skillView.occupationIcon.source=this.ITEM_TYPE_CONFIG[this.index].icon;for(var e=0;e<8;e++){var t=this.getConfig(this.index,e,1),i=this.skillView["skill"+e];i.icon.source=ResourceUtils.png(t.icon);var n=this.GuildSkillPy.GetProSkillInfo(this.index+1,t.type);i.text.text=n+"/"+this.GuildSkillPy.getMaxLevelOfType(t.type),this.updateSkill(e)}this.updateSkillSelect(this.select),this.initUI()},e.prototype.getConfig=function(e,t,i){var n=e+1+"0"+(t+1)+this.callBackLevel(i||1);return v.Config.guildSkillConfig()[Number(n)]},e.prototype.callBackLevel=function(e){return e<=9?"00"+e:e<=99?"0"+e:100<=e?e:"001"},e.prototype.perClose=function(){v.AppFacade.getInstance().updateView(v.GuildMediator.N,v.GuildMediator.SV.MAIN_MAP)},e}(BasePanel);v.GuildSkillMainView=e,__reflect(e.prototype,"game.GuildSkillMainView");var T=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildSkillSayItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateData=function(e){this.nameTip.text=e.nameTip,this.addAttr.text=e.addAttr,e.isMaxLevel&&e.addAttr&&(this.nameTip.parent.removeChild(this.addAttr),this.nameTip.parent.removeChild(this.jiantou))},e}(eui.Component);v.GuildSkillSayItem=T,__reflect(T.prototype,"game.GuildSkillSayItem")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.guildxy=o.AppFacade.getInstance().retrieveProxy(o.GuildPy.N),t.proxy=o.AppFacade.getInstance().retrieveProxy(o.GuildSkillPy.N),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.GuildSkillMainView),this.addSubView(n.SV.ESC,o.GuildSkillEscView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.MONEY_UPDATE]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:this.guildxy.isInGuild()&&this.proxy.GetGuildSkillInfo();break;case CN.MONEY_UPDATE:var t=this.getSubView(n.SV.MAIN);t&&t.initUI()}},n.N="GuildSkillMediator",n.SV={MAIN:1,ESC:2},n}(BaseMediator);o.GuildSkillMediator=e,__reflect(e.prototype,"game.GuildSkillMediator")}(game||(game={})),function(i){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new n).register()},e}();i.GuildSkillProcessor=e,__reflect(e.prototype,"game.GuildSkillProcessor");var t=function(e){function t(){return e.call(this,"guildSkill.GetGuildSkillInfoR",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();t.type;i.AppFacade.getInstance().retrieveProxy(i.GuildSkillPy.N).updateGuildSkillInfo(t.info)},t}(i.ProcessorBase);i.GetGuildSkillInfoR=t,__reflect(t.prototype,"game.GetGuildSkillInfoR");var n=function(e){function t(){return e.call(this,"guildSkill.LearnGuildSkillR",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("LearnGuildSkillR",t),i.AppFacade.getInstance().retrieveProxy(i.GuildSkillPy.N).updateGuildSkillInfo(t.info)},t}(i.ProcessorBase);i.LearnGuildSkillR=n,__reflect(n.prototype,"game.LearnGuildSkillR")}(game||(game={})),function(a){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.skillMaxLevelCache={},e.skillInfo={},e.restNum=1,e}return __extends(i,t),i.prototype.updateGuildSkillInfo=function(e){this.skillInfo=e.skillList,this.restNum=e.resetNum,a.AppFacade.getInstance().updateView(a.GuildSkillMediator.N,a.GuildSkillMediator.SV.MAIN)},i.prototype.GetGuildSkillInfo=function(){var t=this;Utils.Socket.send("guildSkill","GetGuildSkillInfo",{}).then(function(e){t.log("工会技能信息   GetGuildSkillInfoR",e),t.updateGuildSkillInfo(e.info),a.AppFacade.getInstance().updateView(a.GuildSkillMediator.N,a.GuildSkillMediator.SV.MAIN)})},i.prototype.GetProSkillInfo=function(e,t){for(var i=0;i<this.skillInfo.length;i++)if(this.skillInfo[i].professionType==e){var n=JSON.parse(this.skillInfo[i].skill);for(var o in n)if(Number(o)==t)return n[o]}return 0},i.prototype.LearnGuildSkill=function(e,t,i){var n=this;Utils.Socket.send("guildSkill","LearnGuildSkill",{professionType:e,type:t}).then(function(e){e.err||(n.log("技能学习   LearnGuildSkillR",e),i&&i(e))}).catch(function(e){n.log(e)})},i.prototype.ResetGuildSkill=function(e){var t=this;Utils.Socket.send("guildSkill","ResetGuildSkill",{professionType:e+1}).then(function(e){Utils.MsgUtils.addMidMsg("重置成功"),t.log("重置   ResetGuildSkillR",e),t.updateGuildSkillInfo(e.info),a.AppFacade.getInstance().hideSubView(a.GuildSkillMediator.N,a.GuildSkillMediator.SV.ESC),a.AppFacade.getInstance().updateView(a.GuildSkillMediator.N,a.GuildSkillMediator.SV.MAIN)})},i.prototype.getMaxLevelOfType=function(e){var t=0;if(this.skillMaxLevelCache[e])t=this.skillMaxLevelCache[e];else{var i=a.Config.guildSkillConfig();for(var n in i){var o=i[n];o.type==e&&o.level>t&&(t=o.level)}this.skillMaxLevelCache[e]=t}return t},i.N="GuildSkillPy",i}(BaseProxy);a.GuildSkillPy=e,__reflect(e.prototype,"game.GuildSkillPy")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.guildPy=o.AppFacade.getInstance().retrieveProxy(o.GuildPy.N),t.gwProxy=o.AppFacade.getInstance().retrieveProxy(o.GuildWarPy.N),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.GuildWarMainView),this.addSubView(n.SV.FORMATION,o.GuildWarFormationPanel),this.addSubView(n.SV.SEQ,o.GuildWarSelectSeqPanel),this.addSubView(n.SV.RECORD,o.GuildWarBattleRecordPanel),this.addSubView(n.SV.ENROLL,o.GuildWarEnrollPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.GUILD_INFO_UPDATE,CN.GENERAL_PASS_DAY]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GUILD_INFO_UPDATE:this.gwProxy.initSchedule(),o.GameMVC.guildWarPy.getGuildWarStatus()!=GuildWarStatus.Close&&this.guildPy.isInGuild()&&this.gwProxy.GetGuildWarInfo();break;case CN.GENERAL_PASS_DAY:this.gwProxy.initSchedule()}},n.N="GuildWarMediator",n.SV={MAIN:1,FORMATION:2,SEQ:3,RECORD:4,ENROLL:5},n}(BaseMediator);o.GuildWarMediator=e,__reflect(e.prototype,"game.GuildWarMediator")}(game||(game={})),function(n){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new i).register()},e}();n.GuildWarProcessor=e,__reflect(e.prototype,"game.GuildWarProcessor");var t=function(e){function t(){return e.call(this,"guildWar.WarGuildInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("WarGuildInfoP",t);var i=n.AppFacade.getInstance().retrieveProxy(n.GuildWarPy.N);i.updateInfo(t),n.AppFacade.getInstance().updateView(n.GuildWarMediator.N,n.GuildWarMediator.SV.MAIN),n.AppFacade.getInstance().updateView(n.GuildWarMediator.N,n.GuildWarMediator.SV.FORMATION),i.curStatus!=GuildWarStatus.Battle&&i.curStatus!=GuildWarStatus.Close&&(i.recordController=void 0)},t}(n.ProcessorBase);__reflect(t.prototype,"WarGuildInfoP");var i=function(e){function t(){return e.call(this,"guildWar.BattleRecordP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("BattleRecordP",t),n.AppFacade.getInstance().retrieveProxy(n.GuildWarPy.N).updateBattleRecord(t.records)},t}(n.ProcessorBase);__reflect(i.prototype,"BattleRecordP")}(game||(game={})),function(r){var t=function(t){function i(){var e=t.call(this,i.N)||this;return e.constValue={GuildWarDailyRewards:void 0,GuildWarDt:void 0,GuildWarEnrollLimit:void 0,GuildWarRouteLimit:void 0},e._schedule=Utils.TimerManager.createWeeklySchedule(),e.memberMap={self:{},opponent:{}},e.firstRecord={enrollRemind:!1,battleStart:!1,battleResult:!1,matchSuccess:!1},e.playerPy=r.AppFacade.getInstance().retrieveProxy(r.PlayerPy.N),e.selfInfo=new r.GuildWarGuildEntityVO,e.addNotice(),e}return __extends(i,t),i.prototype.addNotice=function(){var e=this;NoticeManager.registerCB(NT.GUILD_WAR,function(){return e.curStatus!=GuildWarStatus.Close&&e.nowEnrollable()&&!e.selfInfo.selfEnrolled},this,MODULE.GuildWar)},i.prototype.initSchedule=function(){this._schedule.resetSchedule();if(this.constValue.GuildWarDailyRewards=JSON.parse(r.Config.constConfig().GuildWarDailyRewards.constValue),this.constValue.GuildWarEnrollLimit=Number(r.Config.constConfig().GuildWarEnrollLimit.constValue),this.constValue.GuildWarRouteLimit=Number(r.Config.constConfig().GuildWarRouteLimit.constValue),r.GameMVC.loginPy.loginGameVO.singleSign)this._schedule.addSchedule(GuildWarStatus.Close,[1,2,3,4,5,6,7],[[0,0],[24,0]]);else{var e=this.constValue.GuildWarDt=JSON.parse(r.Config.constConfig().GuildWarDt.constValue),t=0!=e[2],i=[e[0][0]];this._schedule.addSchedule(GuildWarStatus.Enroll,i,[e[0][1],e[0][2]],!t),this._schedule.addSchedule(GuildWarStatus.Wait,i,[e[0][2],[24,0]],!t),this._schedule.addSchedule(GuildWarStatus.Close,[1,2,3,4,5,6],[[0,0],[24,0]],!t);for(var n=[],o=e[0][0]+1;o<=e[0][0]+e[1][0];o++){var a=(o-1)%7+1;n.push(a)}this._schedule.addSchedule(GuildWarStatus.Adjust,n,[e[1][1],e[1][2]],t),this._schedule.addSchedule(GuildWarStatus.WaitBattle,n,[e[1][2],e[1][3]],t),this._schedule.addSchedule(GuildWarStatus.Battle,n,[e[1][3],e[1][4]],t),this._schedule.addSchedule(GuildWarStatus.BattleEnd,n,[e[1][4],[24,0]],t),this._schedule.addSchedule(GuildWarStatus.Close,7,[[0,0],[24,0]],t)}},i.prototype.getOpenInfo=function(){var e={isOpen:!1,status:0,remainingTime:0};return e.status=this.getGuildWarStatus(),e.isOpen=e.status!=GuildWarStatus.NotOpen&&e.status!=GuildWarStatus.Close,e.remainingTime=this._schedule.getCurrentTimeInterval().endDt-Utils.TimerManager.getServerTime(!1),e},i.prototype.getGuildWarStatus=function(){var e;if(Utils.UnlockMgr.checkPass(MODULE.GuildWar,!1).allow)if(e=this._schedule.checkCurrentStatus()[0]){if(-1!=[GuildWarStatus.Adjust,GuildWarStatus.Battle,GuildWarStatus.Wait,GuildWarStatus.WaitBattle,GuildWarStatus.BattleEnd].indexOf(e)){var t=this.nowEnrollable();this.selfInfo.enrolled||(e=t?GuildWarStatus.Enroll:GuildWarStatus.UnEnroll)}}else e=GuildWarStatus.Close;else e=GuildWarStatus.Close;return e},i.prototype.getTimeInterval=function(e){return this._schedule.getCurrentTimeInterval(e)},i.prototype.getMyRoute=function(){var i=0,n=r.AppFacade.getInstance().retrieveProxy(r.PlayerPy.N).playerInfoVO.playerId;return this.selfInfo.routes.forEach(function(t){t.entities.forEach(function(e){e.baseInfo.playerId==n&&(i=t.index)})}),i},i.prototype.nowEnrollable=function(){var e=!1;if(this.constValue.GuildWarDt){var t=Utils.TimerManager.getServerTime(),i=new Date(1e3*t);i.getHours(),i.getMinutes();i.setDate(i.getDate()+1),i.setHours(12,0,0,0);var n=this._schedule.checkCurrentStatus()[0],o=this._schedule.checkCurrentStatus(i.getTime()/1e3)[0];if(n!=GuildWarStatus.Close&&o!=GuildWarStatus.Close){i.setTime(1e3*t);var a=this.constValue.GuildWarDt[0];t>=i.setHours(0,0,0,0)/1e3&&t<i.setHours(a[2][0],a[2][1],0,0)/1e3&&(e=!0)}}return e},i.prototype.updateInfo=function(e){var t=this;if(e.opponent&&e.opponent.guild?(this.opponentInfo||(this.opponentInfo=new r.GuildWarGuildEntityVO),this.opponentInfo.update(e.opponent),this.opponentInfo.routes.forEach(function(e){e.entities.forEach(function(e){t.memberMap.opponent[e.baseInfo.playerId]=e})})):this.opponentInfo=void 0,e.self&&(this.selfInfo.update(e.self),this.selfInfo.routes.forEach(function(e){e.entities.forEach(function(e){t.memberMap.self[e.baseInfo.playerId]=e})})),this.curStatus=this.getGuildWarStatus(),this.checkEnroll(),this.curStatus==GuildWarStatus.BattleEnd)for(var i in this.firstRecord)this.firstRecord[i]=!1},i.prototype.checkEnroll=function(){if(NoticeManager.updateNotice(NT.GUILD_WAR),!this.firstRecord.enrollRemind&&this.nowEnrollable()&&this.curStatus!=GuildWarStatus.Close&&!this.selfInfo.selfEnrolled){if(!r.AppFacade.getInstance().retrieveMediator(r.GuajiMediator.N).guajiUI)return;if(this.firstRecord.enrollRemind=!0,!r.AppFacade.getInstance().retrieveMediator(r.GuildWarMediator.N).getSubView(r.GuildWarMediator.SV.MAIN)){var e=new r.GuildWarEnrollPanel;PopUpManager.addPopUp({obj:e,onDarkClick:function(){e.perClose()}})}}},i.prototype.updateBattleRecord=function(e){e.length&&(this.recordController=new n(e),r.AppFacade.getInstance().updateView(r.GuildWarMediator.N,r.GuildWarMediator.SV.MAIN))},i.prototype.GetGuildWarInfo=function(){var t=this;Utils.Socket.send("guildWar","GetGuildWarInfo",{}).then(function(e){t.updateInfo(e),r.AppFacade.getInstance().updateView(r.GuildWarMediator.N,r.GuildWarMediator.SV.MAIN),!t.recordController&&(t.opponentInfo&&t.curStatus==GuildWarStatus.Battle||t.curStatus==GuildWarStatus.BattleEnd)&&t.GetBattleRecord()})},i.prototype.Enroll=function(){var t=this;Utils.Socket.send("guildWar","Enroll",{}).then(function(e){t.updateInfo(e),r.AppFacade.getInstance().updateView(r.GuildWarMediator.N,r.GuildWarMediator.SV.MAIN)})},i.prototype.ChangeRoute=function(e){var t=this,i=e.index;this.selfInfo.routes[i-1].entities.length!=this.constValue.GuildWarRouteLimit?Utils.Socket.send("guildWar","ChangeRoute",e).then(function(e){t.updateInfo(e),r.AppFacade.getInstance().updateView(r.GuildWarMediator.N,r.GuildWarMediator.SV.FORMATION),r.AppFacade.getInstance().updateView(r.GuildWarMediator.N,r.GuildWarMediator.SV.MAIN)}):Utils.MsgUtils.addMidMsg("该线路人数已达上限")},i.prototype.ChangePosition=function(e){var t=this;Utils.Socket.send("guildWar","ChangePosition",e).then(function(e){t.updateInfo(e),r.AppFacade.getInstance().updateView(r.GuildWarMediator.N,r.GuildWarMediator.SV.FORMATION)})},i.prototype.GetBattleRecord=function(){var t=this;Utils.Socket.send("guildWar","GetBattleRecord",{}).then(function(e){t.updateBattleRecord(e.records)})},i.N="GuildWarPy",i}(BaseProxy);r.GuildWarPy=t,__reflect(t.prototype,"game.GuildWarPy");var n=function(){function e(e){this.SEC_PER_ROUND=4,this.routeTimer=[0,0,0],this.allOver=!1,this.proxy=r.AppFacade.getInstance().retrieveProxy(t.N),this.allBattleRecords=e,this.curBattleRecords={1:{slay:[0,0],records:[]},2:{slay:[0,0],records:[]},3:{slay:[0,0],records:[]}},this.allBattleRecords&&this.allBattleRecords[0]&&this.allBattleRecords[0].records&&this.allBattleRecords[0].records[0]?this.active=!!this.proxy.memberMap.self[this.allBattleRecords[0].records[0].challenger]:this.active=!1,this.initCurRecords()}return e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【GuildWar_BattleRecordController】："].concat(e))},e.prototype.initCurRecords=function(){var e=this.proxy.constValue.GuildWarDt[1][3],t=Utils.TimerManager.getServerTime(),i=new Date(1e3*t);i.setHours(e[0],e[1],0,0),this.openDt=i.getTime()/1e3;for(var n=t-this.openDt,o=1;o<=3;o++){for(var a=n,r=this.allBattleRecords[o-1].records[this.curBattleRecords[o].records.length];r&&a>=r.round*this.SEC_PER_ROUND;)this.battlePush(o),a-=r.round*this.SEC_PER_ROUND,r=this.allBattleRecords[o-1].records[this.curBattleRecords[o].records.length];this.setTimerForRoute(o,a)}},e.prototype.setTimerForRoute=function(e,t){var i=this;void 0===t&&(t=0);this.routeTimer[e-1];var n=this.allBattleRecords[e-1].records[this.curBattleRecords[e].records.length];if(n){var o=n.round*this.SEC_PER_ROUND-t;egret.setTimeout(function(){i.onRoundAdded(e),i.setTimerForRoute(e)},this,1e3*o)}},e.prototype.onRoundAdded=function(e){if(this.isRouteBattleOver(e))this.log("##debug## GuildWar_002");else{this.battlePush(e);var t=this.curBattleRecords[e].records[this.curBattleRecords[e].records.length-1],i=this.active?t.challenger:t.beChallenger,n=this.active?t.beChallenger:t.challenger,o=this.active==(t.result==EBattleResult.EBattleResultWin),a={index:e,self:this.proxy.memberMap.self[i].baseInfo.name,opp:this.proxy.memberMap.opponent[n].baseInfo.name,result:o};r.AppFacade.getInstance().updateView(r.GuildWarMediator.N,r.GuildWarMediator.SV.MAIN,{fromCon:!0,record:a})}},e.prototype.battlePush=function(e){if(this.isRouteBattleOver(e))this.log("##debug## GuildWar_001");else{var t=this.allBattleRecords[e-1].records,i=this.curBattleRecords[e],n=t[i.records.length];this.active==(n.result==EBattleResult.EBattleResultWin)?i.slay[0]++:i.slay[1]++,i.records.push(n),this.isRouteBattleOver(e)&&this.log("##debug## GuildWar_第"+e+"路已经打完"),this.log("##debug## GuildWar_"+e+"路第"+i.records.length+"回合完成"),this.allOver=this.isRouteBattleOver(1)&&this.isRouteBattleOver(2)&&this.isRouteBattleOver(3)}},e.prototype.isRouteBattleOver=function(e){return this.allBattleRecords[e-1].records.length==this.curBattleRecords[e].records.length},e}();__reflect(n.prototype,"BattleRecordController")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=i.AppFacade.getInstance().retrieveProxy(i.GuildWarPy.N),e.index=0,e.skinName="GuildWarBattleRecordSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.rootPanel.blb_title.text="战斗记录",this.rootPanel.onCloseCB=function(){e.hide()},this.initTabbar(),this.initList()},e.prototype.initList=function(){UIActionManager.hideScrollerBar(this.scl_list),this.list_item.itemRenderer=n},e.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="CommonTabWithTextSkin",this.tabbar.dataProvider=new eui.ArrayCollection([{text:"左路"},{text:"中路"},{text:"右路"}]),this.tabbar.selectedIndex=0,this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.updateView,this)},e.prototype.updateView=function(e){e&&null!=e.itemIndex&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex);var t=this.tabbar.selectedIndex+1,i=this.proxy.recordController,n=i.curBattleRecords[t].records,o=i.active?1:2,a=[];for(var r in n){var s=n[r],c=1==o?s.challenger:s.beChallenger,l=1==o?s.beChallenger:s.challenger;a.push({self:this.proxy.memberMap.self[c],opp:this.proxy.memberMap.opponent[l],result:s.result==o,battleUuid:s.battleUuid})}this.list_item.dataProvider=new eui.ArrayCollection(a)},e}(BasePanel);i.GuildWarBattleRecordPanel=e,__reflect(e.prototype,"game.GuildWarBattleRecordPanel");var n=function(t){function e(){var e=t.call(this)||this;return e.fightPy=i.AppFacade.getInstance().retrieveProxy(i.FightPy.N),e.skinName="GuildWarBattleRecordPanel_RecordItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_review.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.fightPy.BattlePlayBack(this.data.battleUuid)},this),this.playerHead_self=customui.PlayerHeadFactory.create(),this.gp_playerHead_self.addChild(this.playerHead_self),this.playerHead_opp=customui.PlayerHeadFactory.create(),this.gp_playerHead_opp.addChild(this.playerHead_opp)},e.prototype.dataChanged=function(){this.lb_self.text=this.data.self.baseInfo.name,this.lb_opp.text=this.data.opp.baseInfo.name,this.playerHead_self.updateData({vo:this.data.self.baseInfo}),this.playerHead_opp.updateData({vo:this.data.opp.baseInfo}),this.img_bg.source=this.data.result==EBattleResult.EBattleResultWin?"gonghui_img_shengfudi_png":"gonghui_img_shengfudi2_png"},e}(eui.ItemRenderer);__reflect(n.prototype,"GuildWarBattleRecordPanel_RecordItem")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.dt=0,e.proxy=i.AppFacade.getInstance().retrieveProxy(i.GuildWarPy.N),e.skinName="GuildWarEnrollPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.TouchUtils.addTouchListener(this.btn_close,function(){e.hide()}),Utils.TouchUtils.addTouchListener(this.btn_enroll,function(){e.hide(),i.MainJumpConfig.jumpTo(MODULE.GuildWar),i.GameMVC.guildWarPy.Enroll()}),this.updateView()},e.prototype.updateView=function(){var e=this,t=Utils.TimerManager.getServerTime(),i=new Date(1e3*t),n=this.proxy.constValue.GuildWarDt;i.setHours(n[0][2][0],n[0][2][1],0,0);var o=i.getTime()/1e3;this.dt=o-t,this.timer=egret.setInterval(function(){0<=e.dt?(e.blb_time.text=Utils.TimerManager.getFormatBySecond1(e.dt),e.dt--):e.hide()},this,1e3)},e.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},e}(BasePanel);i.GuildWarEnrollPanel=e,__reflect(e.prototype,"game.GuildWarEnrollPanel")}(game||(game={})),function(h){var e=function(t){function e(){var e=t.call(this)||this;return e.firstIn=!0,e.index=0,e.proxy=h.AppFacade.getInstance().retrieveProxy(h.GuildWarPy.N),e.playerProxy=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N),e.skinName="GuildWarFormationSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.TouchUtils.addTouchListener(this.btn_close,function(){e.hide()}),this.initTabbar(),this.initList()},e.prototype.initList=function(){UIActionManager.hideScrollerBar(this.scl_list),this.list_item.itemRenderer=i},e.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="CommonTabWithTextSkin",this.tabbar.dataProvider=new eui.ArrayCollection([{text:"左路"},{text:"中路"},{text:"右路"}]),this.tabbar.selectedIndex=0,this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.updateView,this)},e.prototype.updateView=function(e){if(this.firstIn){var t=this.proxy.getMyRoute();this.tabbar.selectedIndex=t-1,this.firstIn=!1}e&&null!=e.itemIndex&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex);var n=[],o=this.tabbar.selectedIndex,a=this.proxy.selfInfo.routes;this.blb_title.text=["左路","中路","右路"][this.tabbar.selectedIndex]+"信息";var r=this.playerProxy.playerInfoVO.playerId,s=this.playerProxy.playerGuildVO.position>=EGuildPositionType.EGuildPositionTypeVicePresident,c=0,i=function(e){var i=a[e];i.index==o+1&&i.entities.forEach(function(e,t){c=i.entities.length,n.push({index:i.index,pos:t+1,maxPos:c,info:e,self:e.baseInfo.playerId==r,authority:s})})};for(var l in a)i(l);this.blb_num.text=c+"/"+h.Config.constConfig().GuildWarRouteLimit.constValue,this.list_item.dataProvider=new eui.ArrayCollection(n)},e}(BasePanel);h.GuildWarFormationPanel=e,__reflect(e.prototype,"game.GuildWarFormationPanel");var i=function(i){function e(){var e=i.call(this)||this;e.skinName="GuildWarFormationPanel_MemberItem";for(var t=0;t<6;t++)e.gp_heros.addChild(customui.BaseItemFactory.create());return e.btn_lane.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1<this.data.maxPos?h.AppFacade.getInstance().showSubView(h.GuildWarMediator.N,h.GuildWarMediator.SV.SEQ,{type:1,playerId:this.data.info.baseInfo.playerId,curPos:this.data.index}):Utils.MsgUtils.addMidMsg("不能少于1支队伍")},e),e.btn_seq.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1<this.data.maxPos?h.AppFacade.getInstance().showSubView(h.GuildWarMediator.N,h.GuildWarMediator.SV.SEQ,{type:2,playerId:this.data.info.baseInfo.playerId,curPos:this.data.pos,maxPos:this.data.maxPos}):Utils.MsgUtils.addMidMsg("该路无其他队伍可更换")},e),e}return __extends(e,i),e.prototype.dataChanged=function(){var e=this.data.pos,t=this.data.info;this.blb_seq.text=e.toString(),this.playerHead.updateData({vo:t.baseInfo}),this.lb_name.text=t.baseInfo.name,this.blb_fightCap.text=t.baseInfo.fightCap.toString();var i=t.heroList;this.gp_heros.$children.forEach(function(e,t){i[t]?(e.visible=!0,e.updateData({code:i[t].code})):e.visible=!1}),this.btn_seq.visible=this.data.authority,this.btn_lane.visible=this.data.self||this.data.authority,this.btn_lane.y=this.data.authority?53:31},e}(eui.ItemRenderer);__reflect(i.prototype,"GuildWarFormationPanel_MemberItem")}(game||(game={})),function(i){var e=function(n){function e(){var e,t=n.call(this)||this;return t.buildingsHp=!1,t.firstIn=!0,t.proxy=i.AppFacade.getInstance().retrieveProxy(i.GuildWarPy.N),t.STATUS_MAP=((e={})[GuildWarStatus.NotOpen]="未开启",e[GuildWarStatus.BattleEnd]="等待开启",e[GuildWarStatus.Enroll]="报名",e[GuildWarStatus.Adjust]="调整",e[GuildWarStatus.Battle]="战斗",e[GuildWarStatus.Wait]="等待",e[GuildWarStatus.WaitBattle]="等待",e[GuildWarStatus.UnEnroll]="未报名",e),t.ROUTE_LENGTH={1:230,2:310,3:230},t.BATTLE_OFFSET=20,t.EFFECT_SPEED=60,t.MOVE_SPEED=150,t.RESULT_DURATION=3e3,t.RESULT_POS={1:[-93,605],2:[114,701],3:[320,605]},t.BUILDING_POS={1:[20,-71],2:[223,19],3:[430,-68],4:[23,41],5:[222,-65],6:[433,33]},t.FLAG_POS={1:[58,431],2:[266,514],3:[473,431],4:[64,250],5:[271,160],6:[480,250]},t.skinName="GuildWarMainSkin",t}return __extends(e,n),e.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.activateComponent(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_time);for(var e=1;e<=3;e++){var t=new o;t.bottom=0,this["battleItem_"+e]=t,this["gp_battle_"+e].addChild(t)}var i=new egret.Sprite;i.touchEnabled=!1,i.graphics.beginFill(0,.6),i.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),i.graphics.endFill(),i.name="mask",i.alpha=0,this.gp_msg.addChildAt(i,0),this.guildHead_self=customui.GuildHeadFactory.create(),this.gp_guildHead_self.addChild(this.guildHead_self),this.guildHead_opp=customui.GuildHeadFactory.create(),this.gp_guildHead_opp.addChild(this.guildHead_opp),this.initBuilding()},e.prototype.initBuilding=function(){this.buildings=[void 0];for(var e=1;e<=6;e++){var t=this.BUILDING_POS[e],i=new a;i.initItem({index:3<e?e-3:e,isSelf:e<=3}),i.x=t[0],i.y=t[1],e<=3?this.gp_building_self.addChild(i):this.gp_building_enemy.addChild(i),this.buildings.push(i)}},e.prototype.updateBuilding=function(e,t){void 0===e&&(e=!1);for(var i=1;i<=3;i++){var n=this.buildings[i],o=this.buildings[i+3];if(e){if(this.buildingsHp||this.updateBuilding(),i==t||null==t)if(this.proxy.recordController){var a=this.proxy.recordController.curBattleRecords,r=a[i].slay[0],s=a[i].slay[1],c=n.maxHp;n.updateCurHp(c-s);var l=o.maxHp;o.updateCurHp(l-r)}else o.updateCurHp(0)}else 0<this.proxy.selfInfo.routes[i-1].entities.length?n.updateMaxHp(this.proxy.selfInfo.routes[i-1].entities.length):n.pb_hp.visible=!1,this.proxy.opponentInfo&&0<this.proxy.opponentInfo.routes.length?o.updateMaxHp(this.proxy.opponentInfo.routes[i-1].entities.length):o.pb_hp.visible=!1,this.buildingsHp=!0}},e.prototype.updateView=function(e){var t=this;if(this.firstIn)this.firstIn=!1,this.proxy.GetGuildWarInfo();else{switch(this.gp_enroll.visible=!1,this.gp_formation.visible=!1,this.gp_flag.visible=!1,this.gp_battle.visible=!1,this.proxy.curStatus){case GuildWarStatus.Enroll:this.gp_enroll.visible=!0;var i=this.proxy.selfInfo.selfEnrolled;this.btn_enroll.enabled=!i,this.btn_enroll.label=i?"已报名":"报名",this.blb_enrollNum.text=this.proxy.selfInfo.enrolledMemberNum+"/"+this.proxy.constValue.GuildWarEnrollLimit,this.updateScoreBoard(),this.updateBuilding();break;case GuildWarStatus.Wait:this.gp_flag.visible=!0,this.updateFlag(!1),this.updateScoreBoard(),this.updateBuilding();break;case GuildWarStatus.Adjust:this.gp_formation.visible=!0,this.gp_flag.visible=!0,this.updateFlag(!0),this.updateScoreBoard(),this.updateBuilding();break;case GuildWarStatus.WaitBattle:this.gp_flag.visible=!0,this.updateFlag(!0),this.updateScoreBoard(),this.updateBuilding();break;case GuildWarStatus.Battle:case GuildWarStatus.BattleEnd:this.gp_battle.visible=!0,this.updateBattle(e),this.updateScoreBoard(!0)}if(this.proxy.nowEnrollable()&&!this.proxy.selfInfo.selfEnrolled&&(this.gp_enroll.visible=!0,this.gp_formation.visible=!1,this.blb_enrollNum.text=this.proxy.selfInfo.enrolledMemberNum+"/"+this.proxy.constValue.GuildWarEnrollLimit),this.updateTimer(),(this.proxy.curStatus==GuildWarStatus.Adjust||this.proxy.curStatus==GuildWarStatus.WaitBattle)&&!this.proxy.firstRecord.matchSuccess&&this.proxy.opponentInfo){this.proxy.firstRecord.matchSuccess=!0,this.lb_msg_ms_oppo.text=this.proxy.opponentInfo.guild.name,this.lb_msg_ms_self.text=this.proxy.selfInfo.guild.name;var n=this.gp_msg.getChildByName("mask");egret.Tween.get(n).to({alpha:1},300),this.gp_msg_ms.visible=!0,this.gp_msg_ms.alpha=0;var o=[],a=function(e){e.visible&&(e.alpha=0,o.push(e))};a(this.gp_flag),a(this.gp_self),a(this.gp_opp),egret.Tween.get(this.gp_msg_ms).to({alpha:1},300).call(function(){t.gp_msg_ms_oppo.horizontalCenter=-606,t.gp_msg_ms_oppo.verticalCenter=-300,t.gp_msg_ms_oppo.alpha=0,egret.Tween.get(t.gp_msg_ms_oppo).to({horizontalCenter:0,alpha:1},300,egret.Ease.backOut).wait(1e3).to({verticalCenter:-600,alpha:0},300,egret.Ease.backIn).call(function(){egret.Tween.get(t.gp_msg_ms).to({alpha:0},300).call(function(){t.gp_msg_ms.visible=!1}),egret.Tween.get(n).to({alpha:0},300),o.forEach(function(e){egret.Tween.get(e).to({alpha:1},300)})}),t.gp_msg_ms_self.horizontalCenter=606,t.gp_msg_ms_self.verticalCenter=300,t.gp_msg_ms_self.alpha=0,egret.Tween.get(t.gp_msg_ms_self).to({horizontalCenter:0,alpha:1},300,egret.Ease.backOut).wait(1e3).to({verticalCenter:600,alpha:0},300,egret.Ease.backIn)})}}},e.prototype.updateTimer=function(){if(this.timerStatus!=this.proxy.curStatus){var e=Utils.TimerManager.getServerTime(),t=new Date(1e3*e),i=this.proxy.constValue.GuildWarDt;switch(this.proxy.curStatus){case GuildWarStatus.Enroll:t.setHours(i[0][2][0],i[0][2][1],0,0);break;case GuildWarStatus.Adjust:t.setHours(i[1][2][0],i[1][2][1],0,0);break;case GuildWarStatus.Battle:t.setHours(i[1][4][0],i[1][4][1],0,0);break;case GuildWarStatus.Wait:t.setDate(t.getDate()+1),t.setHours(0,0,0,0);break;case GuildWarStatus.WaitBattle:t.setHours(i[1][3][0],i[1][4][1],0,0);break;case GuildWarStatus.BattleEnd:t.setDate(t.getDate()+1),t.setHours(0,0,0,0)}this.timerTargetDt=t.getTime()/1e3-e,this.lb_time_desc.text=this.STATUS_MAP[this.proxy.curStatus]+"时间：",0<this.timerTargetDt&&!this.timer&&(this.timerFunc(),this.timer=egret.setInterval(this.timerFunc,this,1e3)),this.timerStatus=this.proxy.curStatus}},e.prototype.timerFunc=function(){0<this.timerTargetDt?this.lb_time.text=Utils.TimerManager.getFormatBySecond1(--this.timerTargetDt):(egret.clearInterval(this.timer),this.timer=void 0)},e.prototype.updateBattle=function(e){var t=this.proxy.recordController;if(e.fromCon){var i=e.record.index;this.updateBattlePosition(i,!0),this.showBattleResult(e.record)}else{this.updateBuilding(!0);for(var n=1;n<=3;n++){if(this.proxy.curStatus==GuildWarStatus.Battle&&this.proxy.opponentInfo&&this.proxy.opponentInfo.guild)t&&this.updateBattlePosition(n);else this["battleItem_"+n].visible=!1,this.updateScoreBoard(!0)}this.proxy.recordController?this.img_winwin.visible=!1:this.img_winwin.visible=!0}if(!this.proxy.firstRecord.battleStart){this.proxy.firstRecord.battleStart=!0;var o=Utils.TimerManager.getServerTime(),a=new Date(1e3*o),r=this.proxy.constValue.GuildWarDt[1][3];a.setHours(r[0],r[1],0,0),Math.abs(o-a.getTime()/1e3)<5&&DragonBoneTools.playOnce({effectName:"common_gonghuizhanzdks",parent:this.gp_msg})}},e.prototype.updateFlag=function(e){var n=this;if(e){if(!this.gp_flag.numChildren)for(var t=function(t){var i=o.FLAG_POS[t];t<=3?DragonBoneTools.create("common_gonghuizhanqzl",function(e){e.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){e&&e.parent&&e.parent.removeChild(e)},n),e.animation.play("common_gonghuizhanqzl"),e.x=i[0],e.y=i[1],e.scaleX=e.scaleY=2==t?.9:.8,n.gp_flag.addChildAt(e,0)}):DragonBoneTools.create("common_gonghuizhanqzh",function(e){e.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){e&&e.parent&&e.parent.removeChild(e)},n),e.animation.play("common_gonghuizhanqzh"),e.x=i[0],e.y=i[1],e.scaleX=e.scaleY=5==t?.9:.8,n.gp_flag.addChildAt(e,0)})},o=this,i=1;i<=6;i++)t(i)}else this.gp_flag.$children.forEach(function(e){e&&e.parent&&e.parent.removeChild(e)})},e.prototype.updateBattlePosition=function(e,t){void 0===t&&(t=!1);var i=this["battleItem_"+e],n=this.proxy.recordController.curBattleRecords,o=n[e].slay[0],a=n[e].slay[1],r=this.buildings[e].maxHp-a,s=this.buildings[e+3].maxHp-o;i.visible=!0,i.updateHP({self:r,opp:s});var c=this.ROUTE_LENGTH[e],l=-r/(r+s)*2*c+c;this.moveBattleFog(e,l,t)},e.prototype.updateScoreBoard=function(e){var n=this;if(void 0===e&&(e=!1),this.proxy.opponentInfo?(this.gp_opp.visible=!0,this.guildHead_opp.updateData({vo:this.proxy.opponentInfo.guild})):this.gp_opp.visible=!1,this.guildHead_self.updateData({vo:this.proxy.selfInfo.guild}),this.selfScore=0,this.oppoScore=0,e)if(this.proxy.opponentInfo)for(var t=1;t<=3;t++)0==this.buildings[t].curHp&&this.oppoScore++,0==this.buildings[t+3].curHp&&this.selfScore++;else this.selfScore=3;for(t=0;t<3;t++){this.gp_score_self.$children[t].source=t<this.selfScore?"gonghui_img_huangguan_png":"gonghui_img_huangguandi01_png",this.gp_score_opp.$children[t].source=t<this.oppoScore?"gonghui_img_huangguan_png":"gonghui_img_huangguandi02_png"}egret.setTimeout(function(){if(n){var e=n.proxy.recordController;if(e&&e.allOver&&!n.proxy.firstRecord.battleResult){n.proxy.firstRecord.battleResult=!0,n.lb_msg_result_oppo.text=n.proxy.opponentInfo.guild.name,n.lb_msg_result_self.text=n.proxy.selfInfo.guild.name,n.img_msg_result_oppo.source=n.proxy.opponentInfo.guild.avatar,n.img_msg_result_self.source=n.proxy.selfInfo.guild.avatar;var t=n.gp_msg.getChildByName("mask");egret.Tween.get(t).to({alpha:1},300),Utils.TouchUtils.hasTouchListener(n.gp_msg_result)||Utils.TouchUtils.addTouchListener(n.gp_msg_result,function(){n.gp_msg_result.visible=!1,n.gp_msg.getChildByName("mask").visible=!1}),n.selfScore>n.oppoScore&&DragonBoneTools.playOnce({effectName:"common_gonghuizhanqplh",parent:n.gp_msg_result,y:0,loop:!0}),n.lb_msg_result_score.text=n.proxy.selfInfo.score.toString(),n.gp_msg_result.visible=!0,n.gp_msg_result.alpha=0,egret.Tween.get(n.gp_msg_result).to({alpha:1},300).call(function(){var e=n.oppoScore>n.selfScore?n.gp_msg_result_oppo_effect:n.gp_msg_result_self_effect;DragonBoneTools.playOnce({effectName:"common_gonghuizhansllh_2",parent:e,x:e.width/2,y:e.height/2-70,z:0,loop:!0}),DragonBoneTools.playOnce({effectName:"common_gonghuizhanVS",parent:n.gp_msg_result,y:n.gp_msg_result.height/2-70,loop:!0});var t=new eui.Image("gonghui_img_huoshengzhe_png");t.horizontalCenter=0,t.top=-80,e.addChild(t);for(var i=0;i<3;i++)DragonBoneTools.playOnce({effectName:i<n.oppoScore?"common_gonghuizhanhsl":"common_gonghuizhanhsb",parent:n.gp_msg_result_oppo_effect,x:120*(i-1)+n.gp_msg_result_oppo_effect.width/2,y:2*n.gp_msg_result_oppo_effect.height/3,keep:!0}),DragonBoneTools.playOnce({effectName:i<n.selfScore?"common_gonghuizhanlsl":"common_gonghuizhanlsb",parent:n.gp_msg_result_self_effect,x:120*(i-1)+n.gp_msg_result_self_effect.width/2,y:2*n.gp_msg_result_self_effect.height/3,keep:!0})})}}},this,2e3)},e.prototype.showScoreEffect=function(e){var t=e?this.gp_msg_score_self:this.gp_msg_score_oppo,i=e?this.gp_msg_score_self_stars:this.gp_msg_score_oppo_stars,n=e?"gonghui_img_wofanghuangguan":"gonghui_img_difanghuangguan";i.removeChildren();for(var o=e?this.selfScore:this.oppoScore,a=0;a<3;a++)if(a<o){var r=new eui.Image(n+"02_png");r.scaleX=r.scaleY=.7,i.addChild(r)}else i.addChild(new eui.Image(n+"01_png"));t.visible=!0,t.alpha=0,egret.Tween.removeTweens(t),egret.Tween.get(t).to({alpha:1},300).wait(1500).to({alpha:0},300).call(function(){t.visible=!1})},e.prototype.showBattleResult=function(e){var t=e.index,i=e.result,n=new eui.Group;n.alpha=0,n.x=this.RESULT_POS[t][0],n.y=this.RESULT_POS[t][1],this.gp_battle.addChild(n);var o=new eui.Image(i==EBattleResult.EBattleResultWin?"gonghui_img_shengfudi_png":"gonghui_img_shengfudi2_png");n.addChild(o);var a=new eui.Label(e.self),r=new eui.Label(e.opp);a.y=r.y=9,a.size=r.size=18,a.horizontalCenter=-83.5,r.horizontalCenter=83.5,n.addChild(a),n.addChild(r),egret.Tween.get(n).to({alpha:1},this.RESULT_DURATION/4).wait(this.RESULT_DURATION).to({alpha:0},this.RESULT_DURATION/4).call(function(){n.parent&&n.parent.removeChild(n)})},e.prototype.moveBattleFog=function(e,t,i){var n=this;void 0===i&&(i=!0);var o=this["gp_battle_"+e];if(i){var a=Math.abs(o.verticalCenter-t)/this.MOVE_SPEED*1e3;egret.Tween.removeTweens(o),egret.Tween.get(o).to({verticalCenter:t},a).call(function(){n.onMoveEnd(e)})}else this.proxy.recordController.isRouteBattleOver(e)?o.visible=!1:(o.verticalCenter=t,this.activateFogEffect(o))},e.prototype.onMoveEnd=function(e){var t=this["gp_battle_"+e];this.updateBuilding(!0,e),this.updateScoreBoard(!0),this.proxy.recordController.isRouteBattleOver(e)?(this.showScoreEffect(e<4),t.visible=!1):this.activateFogEffect(t)},e.prototype.activateFogEffect=function(e){var t=e.verticalCenter,i=e.verticalCenter-this.BATTLE_OFFSET,n=e.verticalCenter+this.BATTLE_OFFSET,o=this.BATTLE_OFFSET/this.EFFECT_SPEED*1e3;egret.Tween.get(e,{loop:!0}).to({verticalCenter:n},o).to({verticalCenter:i},2*o).to({verticalCenter:t},o)},e.prototype.activateComponent=function(){this.btn_enroll.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.proxy.Enroll()},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.AppFacade.getInstance().showSubView(i.GuildWarMediator.N,i.GuildWarMediator.SV.FORMATION)},this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.MainJumpConfig.jumpTo()},this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.proxy.recordController?i.AppFacade.getInstance().showSubView(i.GuildWarMediator.N,i.GuildWarMediator.SV.RECORD):Utils.MsgUtils.addMidMsg("暂无记录")},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.GameMVC.loginPy.loginGameVO.singleSign?i.AppFacade.getInstance().showSubView(i.RankMediator.N,i.RankMediator.SV.COMMON,{module:"GUILD_WAR_SINGLE"}):i.AppFacade.getInstance().showSubView(i.RankMediator.N,i.RankMediator.SV.COMMON,{module:"GUILD_WAR"})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.GameMVC.loginPy.loginGameVO.singleSign?i.AppFacade.getInstance().showSubView(i.RankMediator.N,i.RankMediator.SV.COMMON,{module:"GUILD_WAR_SINGLE",index:1}):i.AppFacade.getInstance().showSubView(i.RankMediator.N,i.RankMediator.SV.COMMON,{module:"GUILD_WAR",index:1})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new i.HelpDialog({moduleId:MODULE.GuildWar})})},this)},e.prototype.perClose=function(){this.timer&&egret.clearInterval(this.timer)},e}(BaseFull);i.GuildWarMainView=e,__reflect(e.prototype,"game.GuildWarMainView");var o=function(i){function e(){var e=i.call(this)||this;return e.skinName="GuildWarMainView_Battle",e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),DragonBoneTools.create("common_gonghuizhanzdz",function(e){e.animation.play("common_gonghuizhanzdz"),e.x=73,e.y=126,t.addChild(e)})},e.prototype.updateHP=function(e){this.blb_self.text=e.self.toString(),this.blb_opp.text=e.opp.toString()},e}(eui.Component);__reflect(o.prototype,"GuildWarMainView_Battle");var a=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildWarMainView_Building",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.pb_hp.labelFunction=function(e,t){return""+e},this.pb_hp.slideDuration=0},e.prototype.initItem=function(e){this.index=e.index,this.isSelf=e.self,this.setBulidingRuin(!1),this.pb_hp.skinName=this.isSelf?"skins.GuildWarHpBarSkinBlue":"skins.GuildWarHpBarSkinRed"},e.prototype.updateMaxHp=function(e){this.maxHp=e,this.pb_hp.maximum=e,this.updateCurHp(e)},e.prototype.updateCurHp=function(e){this.pb_hp.visible=!0,0==e?(0!=this.curHp&&this.showRuinEffect(),this.pb_hp.visible=!1,this.setBulidingRuin(!0)):this.setBulidingRuin(!1),this.curHp=e,this.pb_hp.value=e},e.prototype.showRuinEffect=function(){DragonBoneTools.playOnce({effectName:"common_gonghuizhanjzhh",parent:this})},e.prototype.setBulidingRuin=function(e){if(e)this.img_building.source=2==this.index?"common_guild_chengbaosun_png":"common_guild_jiantasun_png";else{var t=this.isSelf?"lan":"hong",i=2==this.index?"01":"02";this.img_building.source="common_guild_"+t+"_"+i+"_png"}},e}(eui.Component);__reflect(a.prototype,"GuildWarMainView_Building")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=i.AppFacade.getInstance().retrieveProxy(i.GuildWarPy.N),e.route2string={1:"选择左路",2:"选择中路",3:"选择右路"},e.skinName="GuildWarSelectSeqSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateView=function(n){this.curType=n.type,this.playerId=n.playerId;var o=n.curPos;if(1==this.curType){this.gp_tips.visible=!1,this.gp_root.width=170,this.gp_root.height=190,this.gp_btn.top=20,this.gp_btn.left=this.gp_btn.right=20,(a=new eui.VerticalLayout).horizontalAlign=egret.HorizontalAlign.CENTER,a.verticalAlign=egret.VerticalAlign.MIDDLE,this.gp_btn.layout=a;for(var e=function(e){if(e!=o){var t=new eui.Button;t.skinName="skins.ButtonSkinYellow2",t.label=i.route2string[e],t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnClick(e)},i),i.gp_btn.addChild(t)}},i=this,t=1;t<=3;t++)e(t)}else{var a;this.gp_tips.visible=!0,this.gp_root.width=395,this.gp_root.height=275,this.gp_btn.top=65,this.gp_btn.left=this.gp_btn.right=38,(a=new eui.TileLayout).requestedColumnCount=5,a.horizontalGap=15,this.gp_btn.layout=a;var r=function(e){if(!(e<=n.maxPos))return"break";var t=e==o,i=new c({num:e,self:t});i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t||this.btnClick(e)},s),s.gp_btn.addChild(i)},s=this;for(t=1;t<=15;t++){if("break"===r(t))break}}},e.prototype.btnClick=function(e){1==this.curType?this.proxy.ChangeRoute({playerId:this.playerId,index:e}):this.proxy.ChangePosition({playerId:this.playerId,position:e}),this.hide()},e}(BasePanel);i.GuildWarSelectSeqPanel=e,__reflect(e.prototype,"game.GuildWarSelectSeqPanel");var c=function(i){function e(e){var t=i.call(this)||this;return t.skinName="GuildWarSelectSeqPanel_Item",t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data&&this.update(this.data)},e.prototype.update=function(e){this.data=e,this.blb_num.text=this.data.num.toString(),this.img_bg.source=this.data.self?"_btn_lb_m_json.common_icon_lvkong":"_btn_lb_m_json.common_icon_kong"},e}(eui.Component);__reflect(c.prototype,"GuildWarSelectSeqPanel_Item")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.proxy=o.AppFacade.getInstance().retrieveProxy(o.GuildInstancePy.N),t}return __extends(n,i),Object.defineProperty(n.prototype,"rootView",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.GuildInstanceView),this.addSubView(n.SV.CHAPTERVIEW,o.GuildInstanceChapterView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.GUILD_INSTANCE_OPEN,CN.GUILD_INSTANCE_UPDATE,CN.GUILD_INFO_UPDATE]},n.prototype.handleNotification=function(e){e.getBody();var t=this.getSubView(o.FriendMediator.SV.MAIN);switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GUILD_INSTANCE_OPEN:this.showSubView(n.SV.MAIN);break;case CN.GUILD_INFO_UPDATE:o.AppFacade.getInstance().retrieveProxy(o.GuildPy.N).isInGuild()&&this.proxy.GetGuildFortressInfo();case CN.GUILD_INSTANCE_UPDATE:t&&t.updateView()}},n.prototype.onViewCreate=function(){},n.N="GuildInstanceMediator",n.SV={MAIN:1,CHAPTERVIEW:2},n}(BaseMediator);o.GuildInstanceMediator=e,__reflect(e.prototype,"game.GuildInstanceMediator")}(game||(game={})),function(o){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new i).register()},e}();o.GuildInstanceProcessor=e,__reflect(e.prototype,"game.GuildInstanceProcessor");var t=function(e){function t(){return e.call(this,"guild.GuildFortressUpdateP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();o.AppFacade.getInstance().retrieveProxy(o.GuildInstancePy.N).updateFortressInfo(t)},t}(o.ProcessorBase);o.GuildFortressUpdateP=t,__reflect(t.prototype,"game.GuildFortressUpdateP");var i=function(e){function t(){return e.call(this,"guildTranscript.GuildTranscriptInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody(),i=o.AppFacade.getInstance().retrieveProxy(o.GuildInstancePy.N);i.guildTranscriptInfo.update(t.info),i.guildTranscriptBossInfo.update(t.bossInfo),o.AppFacade.getInstance().sendNotification(CN.GUILD_INSTANCE_UPDATE);var n=o.AppFacade.getInstance().retrieveProxy(o.FightPy.N);n.addDelayCBAfterFightExit(function(){o.AppFacade.getInstance().retrieveMediator(o.GuildInstanceMediator.N).updateView(o.GuildInstanceMediator.SV.MAIN),n.queueExceExitCB()},"GUILD_COPY")},t}(o.ProcessorBase);__reflect(i.prototype,"GuildTranscriptInfoP")}(game||(game={})),function(o){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.guildTranscriptInfo=new n,e.guildTranscriptBossInfo=new a,e.upGuildTranscriptBossInfo=new a,e.addNotice(),e}return __extends(i,t),i.prototype.addNotice=function(){var i=this;NoticeManager.registerCB(NT.GUILD_INSTANCE,function(){var e=o.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.GuildTranscript,{id:i.guildTranscriptInfo.killedId});if(e.isBelonged&&!e.unlock)return!1;var t=o.Config.getGuildtranscriptConfig()[i.guildTranscriptInfo.killedId];return!(!t||0!=t.zoneBossUnlock)&&0<i.guildTranscriptInfo.count},this)},i.prototype.GetGuildFortressInfo=function(t){var i=this;Utils.Socket.send("guildTranscript","GetGuildTranscriptInfo",{},!0).then(function(e){e.err||(i.clearChapterId=e.info.killedId+1,i.guildTranscriptInfo.update(e.info),i.GetGuildBossInfo(e.info.killedId+1),NoticeManager.updateNotice(NT.GUILD_INSTANCE),t&&t())}).catch(function(e){i.log(e)})},i.prototype.BuyGuildFortressCount=function(){var t=this,e=this.guildTranscriptInfo.buyCount,i=o.Config.VIPConfig().guildTranscriptBuyTimes;e<i?o.AppFacade.getInstance().showSubView(o.CommonMediator.N,o.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.GuildCopy,curNum:this.guildTranscriptInfo.count,maxNum:Number(o.Config.constConfig().MaxGuildTranscriptChallengeNum.constValue),hasBuyNum:e,maxBuyNum:i,buyCB:function(e){t.BuyChallengeTimes(e)}}):Utils.MsgUtils.addMidMsg("您今日可购买次数已达到上限")},i.prototype.GetGuildFortressReward=function(e){var t=this;Utils.Socket.send("guild","GetGuildFortressReward",{id:e}).then(function(e){e.err||(t.guildCapyReward=e.clientReward)}).catch(function(e){t.log(e)})},i.prototype.ChallengeGuildFortress=function(e){var t=this;o.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeGuildTranscript,customParams:{tips:['<b><font color="#ffffff" size="22">恭喜挑战</font><font color="#ffffff" size="22">成功</font></b>','<b><font color="#ffffff" size="22">挑战</font><font color="#ffffff" size="22"> 失败</font></b>','<b><font color="#ffffff" size="22">造成伤害：</font><font color="#00fff0" size="22"> %d</font></b>']},pb1:"guildTranscript",pb2:"ChallengeGuildTranscript",params:{id:e.id},doneCB:function(e){t.log("战斗结束",e),t.GetGuildFortressInfo(),o.AppFacade.getInstance().retrieveProxy(o.FightPy.N).queueExceExitCB()}})},i.prototype.SetFortressResetType=function(e){},i.prototype.SelectRank=function(e){this.rankId=e},i.prototype.GetGuildBossInfo=function(e){var t=this;Utils.Socket.send("guildTranscript","GetGuildTranscriptDetailInfo",{id:e}).then(function(e){e.err||(t.guildTranscriptBossInfo.update(e.bossInfo),o.AppFacade.getInstance().sendNotification(CN.GUILD_INSTANCE_UPDATE),NoticeManager.updateNotice(NT.GUILD_INSTANCE))}).catch(function(e){t.log(e)})},i.prototype.upGetGuildBossInfo=function(e,t){var i=this;Utils.Socket.send("guildTranscript","GetGuildTranscriptDetailInfo",{id:e}).then(function(e){e.err||(i.upGuildTranscriptBossInfo.update(e.bossInfo),t&&t())}).catch(function(e){i.log(e)})},i.prototype.updateFortressInfo=function(e){e.fortressInfo&&(this.guildTranscriptInfo.update(e.fortressInfo),o.AppFacade.getInstance().sendNotification(CN.GUILD_INSTANCE_UPDATE))},i.prototype.BuyChallengeTimes=function(t,i){var n=this;Utils.Socket.send("guildTranscript","PurchaseChallengeTime",{num:t}).then(function(e){Utils.MsgUtils.addMidMsg("成功购买"+t+"次"),n.guildTranscriptInfo.update(e.info),o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N).handleClientCost(e.clientCost),o.AppFacade.getInstance().retrieveMediator(o.GuildInstanceMediator.N).updateView(o.GuildInstanceMediator.SV.MAIN),o.AppFacade.getInstance().sendNotification(CN.GUILD_INSTANCE_UPDATE),i&&i()})},i.prototype.ColorMatrix=function(){return[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]},i.N="GuildInstanceProxy",i}(BaseProxy);o.GuildInstancePy=e,__reflect(e.prototype,"game.GuildInstancePy");var n=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.killedId=e.killedId+1,this.count=e.num,this.buyCount=e.purchasedNum,this.dt=e.lastRefreshDt},e}(o.BaseVO);__reflect(n.prototype,"GuildTranscriptInfo");var a=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.killInfo=e.killInfo,this.bossLifeInfo=e.bossLifeInfo,this.sectionId=e.sectionId},e}(o.BaseVO);__reflect(a.prototype,"GuildTranscriptBossInfo");var t=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.num=e.num,this.baseInfo=e.baseInfo},e}(o.BaseVO);__reflect(t.prototype,"GuildTranscriptKillInfo");var i=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.code=e.code,this.maxLife=e.maxLife,this.curLife=e.curLife},e}(o.BaseVO);__reflect(i.prototype,"GuildTranscriptBossLifeInfo")}(game||(game={})),function(c){var e=function(t){function e(){var e=t.call(this)||this;return e.chapterList=[],Utils.AssetsMgr.loadGroup("group_guild_instance"),e.isTabbar=!0,e.skinName="GuildInstanceViewSkin",e.cu_common_datanchu.blb_title.text="公会副本",e.cu_common_datanchu.onCloseCB=function(){e.hide()},e.proxy=c.AppFacade.getInstance().retrieveProxy(c.GuildInstancePy.N),e.config=c.Config.getGuildtranscriptConfig(),e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_guild_instance")},e.prototype.childrenCreated=function(){var e=this;this.list_copy.itemRenderer=i,UIActionManager.hideScrollerBar(this.cu_pageScroller),this.btn_page_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.cu_pageScroller.scrollToNext(function(){e.tabbar.selectedIndex++,e.btnVisible()})},this),this.btn_page_last.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.cu_pageScroller.scrollToLast(function(){e.tabbar.selectedIndex--,e.btnVisible()})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new c.HelpDialog({moduleId:MODULE.GuildCopy})})},this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.proxy.BuyGuildFortressCount()},this)},e.prototype.initTabbar=function(){var e=this;this.tabbar.itemRendererSkinName="GuildCopy_TabbarSkin";for(var t={up:"_guild_instance_m_json.gonghui_img_yuandiandi",down:"_guild_instance_m_json.gonghui_img_yuandian"},i=[],n=1;n<=this.num;n++)i.push(t);this.tabbar.dataProvider=new eui.ArrayCollection(i);var o=new eui.HorizontalLayout;o.horizontalAlign=egret.HorizontalAlign.CENTER,this.tabbar.layout=o,this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this),this.once(egret.Event.ENTER_FRAME,function(){e.tabbar.selectedIndex=Math.floor(Math.abs(e.proxy.guildTranscriptInfo.killedId-1)/9),e.onBarItemTap({itemIndex:e.tabbar.selectedIndex})},this),this.btnVisible(),this.isTabbar=!1},e.prototype.onBarItemTap=function(e){this.cu_pageScroller.scrollerToPage(e.itemIndex),this.btnVisible()},e.prototype.updateView=function(){var e=this,t=c.Config.getGuildtranscriptConfig(),i=1;this.num=0;var n=[];for(var o in this.chapterList=[],t){var a=t[o];0==a.zoneBossUnlock&&n.push({sectionId:this.proxy.guildTranscriptInfo.killedId,name:a.id}),i%9!=0&&0!=a.nextId||(this.chapterList.push({list_items:n}),this.num++,n=[]),i++}var r=this.list_copy.dataProvider;r?r.replaceAll(this.chapterList):this.list_copy.dataProvider=new eui.ArrayCollection(this.chapterList),this.list_copy.validateNow(),this.blb_remaining_times.text=String(this.proxy.guildTranscriptInfo.count),this.isTabbar?this.initTabbar():this.tabbar.selectedIndex!=Math.floor(Math.abs(this.proxy.guildTranscriptInfo.killedId-1)/9)&&this.once(egret.Event.ENTER_FRAME,function(){e.tabbar.selectedIndex=Math.floor(Math.abs(e.proxy.guildTranscriptInfo.killedId-1)/9),e.onBarItemTap({itemIndex:e.tabbar.selectedIndex})},this);var s=c.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.GuildTranscript,{id:this.proxy.guildTranscriptInfo.killedId});s.isBelonged&&!s.unlock?this.lb_newChapter.visible=!0:this.lb_newChapter.visible=!1},e.prototype.btnVisible=function(){this.tabbar.selectedIndex<=0?this.btn_page_last.visible=!1:this.btn_page_last.visible=!0,this.tabbar.selectedIndex>=this.num-1?this.btn_page_next.visible=!1:this.btn_page_next.visible=!0},e}(BasePanel);c.GuildInstanceView=e,__reflect(e.prototype,"game.GuildInstanceView");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="GuildCopySkin_CapyPage",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI()},e.prototype.update=function(e){this.list_items=e.list_items},e.prototype.dataChanged=function(){this.collect.removeAll();for(var e=0,t=this.data.list_items;e<t.length;e++){var i=t[e];this.collect.addItem({id:i.name,chapterId:i.sectionId})}},e.prototype.initUI=function(){var e=new eui.TileLayout;e.horizontalGap=10,e.verticalGap=15,e.requestedRowCount=0,e.paddingLeft=20,e.paddingTop=30,e.requestedColumnCount=3,e.columnAlign=eui.ColumnAlign.LEFT,this.list_items.layout=e,this.list_items.itemRenderer=n,this.collect=new eui.ArrayCollection,this.list_items.dataProvider=this.collect},e}(eui.ItemRenderer);__reflect(i.prototype,"GuildCopySkin_CapyPage");var n=function(i){function e(){var e=i.call(this)||this;return e.skinName="GuildCopyUIItemSkin",e.proxy=c.AppFacade.getInstance().retrieveProxy(c.GuildInstancePy.N),e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.gp_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),t.touchCallBack()},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.proxy.upGetGuildBossInfo(this.data.id,function(){return c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"GUILD_COPY"})})},this),this.pb_bossHpYellow.slideDuration=0,this.pb_bossHpRed.slideDuration=1e3,this.pb_bossHpYellow.labelFunction=function(e,t){var i=Number((100*(e/t)).toFixed(2)).toString();return Number(i)<10&&0!=Number(i)&&(i="??"),i+"%"}},e.prototype.updateHp=function(){var t=0,i=0;this.proxy.guildTranscriptBossInfo.bossLifeInfo.forEach(function(e){t+=e.maxLife,i+=e.curLife}),this.pb_bossHpRed.maximum=t,this.pb_bossHpYellow.maximum=t,this.pb_bossHpRed.value=i,this.pb_bossHpYellow.value=i},e.prototype.dataChanged=function(){for(var e=this,t=this.data,i=c.Config.getGuildtranscriptConfig()[t.id],n=1;n<=6;n++){var o=JSON.parse(i["creep"+n]);o&&""!=o&&(1==n&&(this.bossId=o[0]),0<o[1]&&(this.bossId=o[0]))}this.bossCreepInfo=c.Config.creepConfig(this.bossId),this.bossCreepInfo||(this.bossCreepInfo=c.Config.creepConfig(this.bossId));var a=function(){t.id==t.chapterId?(e.img_bg.source="_guild_instance_m_json.gonghui_img_beijingtu0"+e.bossCreepInfo.race,e.img_kuang.source="_guild_instance_m_json.gonghui_img_fuben03",e.gp_hp.visible=!0,e.btn_rank.visible=!0,e.model.visible=!0,e.model.isStatic||e.model.update({model:e.bossCreepInfo.model,isStatic:!0}),e.updateHp()):t.id>t.chapterId?(e.img_kuang.source="_guild_instance_m_json.gonghui_img_fuben01",e.gp_hp.visible=!1,e.model.visible=!1,e.btn_rank.visible=!1):(e.img_bg.source="_guild_instance_m_json.gonghui_img_beijingtu0"+e.bossCreepInfo.race,e.img_kuang.source="_guild_instance_m_json.gonghui_img_fuben02",e.img_pass.visible=!0,e.gp_hp.visible=!1,e.btn_rank.visible=!1,e.model.visible=!1,e.img_bg.filters=[new egret.ColorMatrixFilter(e.proxy.ColorMatrix())])},r=c.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.GuildCopy,{id:this.data.id});r.isBelonged?r.unlock?a.call(this):(this.img_kuang.source="_guild_instance_m_json.gonghui_img_fuben01",this.gp_hp.visible=!1,this.model.visible=!1,this.btn_rank.visible=!1):a.call(this),this.lab_name.text=t.id},e.prototype.touchCallBack=function(){var e=this,t=c.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.GuildCopy,{id:this.data.id}),i=function(){e.data.id==e.proxy.guildTranscriptInfo.killedId?e.proxy.upGetGuildBossInfo(e.data.chapterId,function(){return c.AppFacade.getInstance().showSubView(c.GuildInstanceMediator.N,c.GuildInstanceMediator.SV.CHAPTERVIEW,{id:e.data.chapterId})}):e.data.id>e.proxy.guildTranscriptInfo.killedId?Utils.MsgUtils.addMidMsg("通关上一章节解锁"):e.proxy.upGetGuildBossInfo(e.data.id,function(){return c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"GUILD_COPY"})})};t.isBelonged?t.unlock?i():Utils.MsgUtils.addMidMsg("封印BOSS解锁"):i()},e}(eui.ItemRenderer);c.GuildCopyUIItem=n,__reflect(n.prototype,"game.GuildCopyUIItem")}(game||(game={})),function(f){var e=function(t){function e(){var e=t.call(this)||this;return e.EntrancePy=f.AppFacade.getInstance().retrieveProxy(f.GuildInstancePy.N),e.skinName="GuildCopyChallengeSkin",e.xtck_tck.img_title_bg.visible=!1,e.proxy=f.AppFacade.getInstance().retrieveProxy(f.GuildInstancePy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward_items=new Array,this.inButton()},e.prototype.inButton=function(){var e=this;this.challge_bnt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<e.proxy.guildTranscriptInfo.count?(e.EntrancePy.ChallengeGuildFortress({id:e.num}),e.hide()):e.proxy.BuyGuildFortressCount()},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().showSubView(f.RankMediator.N,f.RankMediator.SV.COMMON,{module:"GUILD_COPY"})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().showSubView(f.RankMediator.N,f.RankMediator.SV.COMMON,{module:"GUILD_COPY",index:1})},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().showSubView(f.HeroMediator.N,f.HeroMediator.SV.FORMATION)},this)},e.prototype.updateView=function(e){var i=this;this.num=e.id,this.colorFlilter=new egret.ColorMatrixFilter(this.EntrancePy.ColorMatrix()),this.gp_enermy.filters=this.colorFlilter;for(var t=f.Config.getGuildtranscriptConfig()[e.id],n=0,o=this.reward_items;n<o.length;n++){var a=o[n];a&&a.parent&&a.parent.removeChild(a)}for(var r=0,s=0,c=JSON.parse(t.challengeRewards);s<c.length;s++){var l=c[s],h=customui.BaseItemFactory.create(21);h.updateData({type:l[0],code:l[1],num:l[2]}),h.y=0,h.x=0+r++*(h.width+30)*.7,h.scaleX=.7,h.scaleY=.7,this.reward_items.push(h),this.gp_reward_show.addChild(h)}var p=[];try{for(var d=1;d<=6;d++){var u=t["creep"+d];u&&""!=u&&p.push(JSON.parse(t["creep"+d])[0])}}catch(e){this.log(e)}p.forEach(function(e){if(null!=e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e}),t.scaleX=t.scaleY=.7,i.gp_enermy.addChild(t)}});var g=new eui.HorizontalLayout;g.horizontalAlign=egret.HorizontalAlign.CENTER,this.gp_enermy.layout=g},e.prototype.updateSche=function(){var t=this,e=!1;this.proxy.guildTranscriptInfo.count<=0?0<Number(f.Config.constConfig().GuildFortressCountRecoveryCD.constValue)-(Utils.TimerManager.getServerTime()-this.proxy.guildTranscriptInfo.dt)?this.scheCountLeft||(this.scheCountLeft=egret.setInterval(function(){var e=Number(f.Config.constConfig().GuildFortressCountRecoveryCD.constValue)-(Utils.TimerManager.getServerTime()-t.proxy.guildTranscriptInfo.dt);0<e?(t.lb_time.text=Utils.TimerManager.getFormatBySecond1(e),t.gp_time.visible=!0):(t.gp_time.visible=!1,egret.clearInterval(t.scheCountLeft),t.scheCountLeft=void 0)},this,1e3)):e=!0:e=!0;e&&this.scheCountLeft&&(this.gp_time.visible=!1,egret.clearInterval(this.scheCountLeft),this.scheCountLeft=void 0)},e}(BasePanel);f.GuildInstanceChapterView=e,__reflect(e.prototype,"game.GuildInstanceChapterView")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.isCreating=!1,t.creatingDict={},t.data=e,t}return __extends(e,i),Object.defineProperty(e.prototype,"onArmatureLoadCB",{set:function(e){this.isCreating?this._onArmatureLoadCB=e:e()},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.width=this.height=0,this.data&&this.update(this.data)},e.prototype.update=function(l,e){return __awaiter(this,void 0,void 0,function(){var t,i,n,o,a,r,s,c;return __generator(this,function(e){switch(e.label){case 0:if(l||(l={vo:game.GameMVC.playerPy.playerInfoVO}),this.data=l,this.cacheFrameRate=!1,this.curStyle=ROLE_STYLE.Fashion,this.loadingStyle=0,t=this.data.reqStyle||65535,a=o=n=i=void 0,this.data){if(this.cacheFrameRate=this.data.cacheFrameRate||!1,this.data.vo?(this.data.fashionCode=this.data.vo.fashionCode,this.data.horseCode=this.data.vo.horseCode,this.data.titleCode=this.data.vo.titleCode,this.data.magicalCode=this.data.vo.magicalCode):(r=game.GameMVC.playerPy.playerInfoVO,this.data.fashionCode=this.data.fashionCode?this.data.fashionCode:r.fashionCode,this.data.horseCode=this.data.horseCode?this.data.horseCode:r.horseCode,this.data.titleCode=this.data.titleCode?this.data.titleCode:r.titleCode,this.data.magicalCode=this.data.magicalCode?this.data.magicalCode:r.magicalCode),t&ROLE_STYLE.Fashion||(this.data.fashionCode=0),t&ROLE_STYLE.Horse||(this.data.horseCode=0),t&ROLE_STYLE.Title||(this.data.titleCode=0),t&ROLE_STYLE.Magical||(this.data.magicalCode=0),this.data.fashionModel){for(s in i=[this.data.fashionModel+"_z",this.data.fashionModel+"_b"],c=game.Config.fashionConfig())if(c[s].model==this.data.fashionModel){this.fashionHeight=c[s].ol_height;break}}else if(this.data.fashionCode){if(!(c=game.Config.fashionConfig()[this.data.fashionCode]))return[2];this.fashionHeight=c.ol_height,i=[c.model+"_z",c.model+"_b"]}if(i||(i=["zhujiao_01_z","zhujiao_01_b"]),this.data.horseModel)n=[this.data.horseModel+"_z_t",this.data.horseModel+"_z_s",this.data.horseModel+"_b_t",this.data.horseModel+"_b_s"],this.curStyle|=ROLE_STYLE.Horse;else if(this.data.horseCode){if(!(c=game.Config.horseConfigList()[this.data.horseCode]))return[2];n=[c.modelId+"_z_t",c.modelId+"_z_s",c.modelId+"_b_t",c.modelId+"_b_s"],this.curStyle|=ROLE_STYLE.Horse}if(this.data.titleModel)o=this.data.titleModel+"_png",this.curStyle|=ROLE_STYLE.Title;else if(this.data.titleCode){if(!(c=game.Config.titleConfig()[this.data.titleCode]))return[2];o=c.icon,this.curStyle|=ROLE_STYLE.Title}if(this.data.magicalModel){for(s in a=this.data.magicalModel+"_z_png",c=game.Config.allMagicalConfig())if(c[s].ol_model==this.data.magicalModel){this.curMagicalConfig=c[s];break}this.curStyle|=ROLE_STYLE.Magical}else if(this.data.magicalCode){if(!(c=game.Config.allMagicalConfig()[this.data.magicalCode])||!c.ol_model)return[2];RES.hasRes(c.ol_model+"_z_png")&&(this.curMagicalConfig=c,a=c.ol_model+"_z_png",this.curStyle|=ROLE_STYLE.Magical)}}return egret.log("当前模型配置",this.isCreating,i,n,o,a),this.isCreating=!0,[4,this.makeFashion(i)];case 1:return e.sent(),this.makeHorse(n),this.makeTitle(o),this.makeMagical(a),[2]}})})},e.prototype.updateSelf=function(){egret.log("自身形象变化，刷新模型"),this.update()},e.prototype.makeFashion=function(i){var n=this;return new Promise(function(t){(n.creatingDict[ROLE_STYLE.Fashion]=i)?DragonBoneTools.create(i[0],function(e){n.creatingDict[ROLE_STYLE.Fashion]&&n.creatingDict[ROLE_STYLE.Fashion][0]!=i[0]||(n.cleanChild(n.ead_model1),n.ead_model1=e,n.ead_model1.scaleX=n.ead_model1.scaleY=.55,n.addChild(n.ead_model1),DragonBoneTools.create(i[1],function(e){n.creatingDict[ROLE_STYLE.Fashion]&&n.creatingDict[ROLE_STYLE.Fashion][1]!=i[1]||(n.cleanChild(n.ead_model2),n.ead_model2=e,n.ead_model2.scaleX=n.ead_model2.scaleY=.55,n.ead_model2.visible=!1,n.addChild(n.ead_model2),n.markLoadDone(ROLE_STYLE.Fashion),t())},n,{cacheFrameRate:n.cacheFrameRate}))},n,{cacheFrameRate:n.cacheFrameRate}):(n.cleanChild(n.ead_model1),n.ead_model1=void 0,n.cleanChild(n.ead_model2),n.ead_model2=void 0,n.markLoadDone(ROLE_STYLE.Fashion),t())})},e.prototype.makeHorse=function(t){var i=this;(this.creatingDict[ROLE_STYLE.Horse]=t)?DragonBoneTools.create(t[0],function(e){i.creatingDict[ROLE_STYLE.Horse]&&i.creatingDict[ROLE_STYLE.Horse][0]!=t[0]||(i.cleanChild(i.ead_horse_z_t),i.ead_horse_z_t=e,i.ead_horse_z_t.scaleX=i.ead_horse_z_t.scaleY=.55,i.addChild(i.ead_horse_z_t),DragonBoneTools.create(t[1],function(e){i.creatingDict[ROLE_STYLE.Horse]&&i.creatingDict[ROLE_STYLE.Horse][1]!=t[1]||(i.cleanChild(i.ead_horse_z_s),i.ead_horse_z_s=e,i.ead_horse_z_s.scaleX=i.ead_horse_z_s.scaleY=.55,i.addChild(i.ead_horse_z_s),DragonBoneTools.create(t[2],function(e){i.creatingDict[ROLE_STYLE.Horse]&&i.creatingDict[ROLE_STYLE.Horse][2]!=t[2]||(i.cleanChild(i.ead_horse_b_t),i.ead_horse_b_t=e,i.ead_horse_b_t.scaleX=i.ead_horse_b_t.scaleY=.55,i.ead_horse_b_t.visible=!1,i.addChild(i.ead_horse_b_t),DragonBoneTools.create(t[3],function(e){i.creatingDict[ROLE_STYLE.Horse]&&i.creatingDict[ROLE_STYLE.Horse][3]!=t[3]||(i.cleanChild(i.ead_horse_b_s),i.ead_horse_b_s=e,i.ead_horse_b_s.scaleX=i.ead_horse_b_s.scaleY=.55,i.ead_horse_b_s.visible=!1,i.addChild(i.ead_horse_b_s),i.markLoadDone(ROLE_STYLE.Horse))},i,{cacheFrameRate:i.cacheFrameRate}))},i,{cacheFrameRate:i.cacheFrameRate}))},i,{cacheFrameRate:i.cacheFrameRate}))},this,{cacheFrameRate:this.cacheFrameRate}):(this.cleanChild(this.ead_horse_z_t),this.ead_horse_z_t=void 0,this.cleanChild(this.ead_horse_z_s),this.ead_horse_z_s=void 0,this.cleanChild(this.ead_horse_b_s),this.ead_horse_b_s=void 0,this.cleanChild(this.ead_horse_b_t),this.ead_horse_b_t=void 0,this.markLoadDone(ROLE_STYLE.Horse))},e.prototype.makeTitle=function(t){var i=this;(this.creatingDict[ROLE_STYLE.Title]=t)?(this.img_title||(this.img_title=new eui.Image,this.img_title.scaleX=this.img_title.scaleY=.5,this.img_title.horizontalCenter=0,this.img_title.visible=!1,this.addChild(this.img_title)),RES.getResAsync(t,function(e){i.creatingDict[ROLE_STYLE.Title]==t&&(i.img_title.source=e,i.markLoadDone(ROLE_STYLE.Title))},this)):(this.cleanChild(this.img_title),this.img_title=void 0)},e.prototype.replaceMagicalWithTex=function(e,t,i,n){try{var o=this.curMagicalConfig||{},a=(o["ol_scaleXY"+n]||1e6)/1e6,r=o["ol_slotKey"+n]||"wuqi_01",s=new eui.Image;s.source=t,s.width=t.textureWidth*a,s.height=t.textureHeight*a,s.anchorOffsetX=(o["ol_acOffsetX"+n]||0)/1e4*a,s.anchorOffsetY=(o["ol_acOffsetY"+n]||0)/1e4*a,i.armature.getSlot(r)&&(i.armature.getSlot(r).display=s),i.armature.getBone(r)&&(i.armature.getBone(r).offset.rotation=(o["ol_rotation"+n]||0)/1e4)}catch(e){egret.warn("模型武器绑定失败",e)}},e.prototype.makeMagical=function(t){var i=this;(this.creatingDict[ROLE_STYLE.Magical]=t)?RES.getResAsync(t,function(e){i.replaceMagicalWithTex(t,e,i.ead_model1,"_z"),i.replaceMagicalWithTex(t,e,i.ead_model2,"_b"),i.markLoadDone(ROLE_STYLE.Magical)},this):this.curMagicalConfig&&(this.curMagicalConfig=void 0,RES.getResAsync("wuqi_01_z_png",function(e){i.replaceMagicalWithTex(t,e,i.ead_model1,"_z"),i.replaceMagicalWithTex(t,e,i.ead_model2,"_b"),i.markLoadDone(ROLE_STYLE.Magical)},this))},e.prototype.cleanChild=function(e){e&&e.parent&&e.parent.removeChild(e)},e.prototype.markLoadDone=function(e){var t=this;if(this.curStyle&e&&(this.loadingStyle|=e),this.loadingStyle==this.curStyle){if(this.isCreating=!1,null!=this.curDir?this.onChangingDir(this.curDir):this.onChangingDir(3),this._curModelAct?this.curModelAct=this._curModelAct:this.curModelAct=ROLE_ACTION_NAME.DJ,this.curStyle&ROLE_STYLE.Horse){if(this.ead_horse_z_s.armature&&this.ead_horse_z_s.armature.getBone("an")){var i=this.ead_horse_z_s.armature.getBone("an").global;this.ead_model1.x=i.x*this.ead_model1.scaleX,this.ead_model1.y=i.y*this.ead_model1.scaleY,this.ead_model2.x=i.x*this.ead_model2.scaleX,this.ead_model2.y=i.y*this.ead_model2.scaleY}}else this.ead_model1.y=this.ead_model2.y=0;this.titleOffsetY(),this._onArmatureLoadCB&&this.once(egret.Event.ENTER_FRAME,function(){t._onArmatureLoadCB&&t._onArmatureLoadCB(),t._onArmatureLoadCB=void 0},this)}},e.prototype.titleOffsetY=function(e){void 0===e&&(e=0),this.img_title&&(this.curStyle&ROLE_STYLE.Title?(this.img_title.visible=!0,this.curStyle&ROLE_STYLE.Horse?this.img_title.y=this.ead_model1.y-(this.fashionHeight||220)/4*3*this.ead_model1.scaleY-this.img_title.height*this.img_title.scaleY+e:this.img_title.y=-(this.fashionHeight||220)*this.ead_model1.scaleY-this.img_title.height*this.img_title.scaleY+e):this.img_title.visible=!1)},e.prototype.getHeadNameBottom=function(){return this.curStyle&ROLE_STYLE.Horse?Math.abs(this.ead_model1.y-(this.fashionHeight||220)/4*3*this.ead_model1.scaleY):Math.abs(-(this.fashionHeight||220)*this.ead_model1.scaleY)},e.prototype.changeAction=function(e){},e.prototype.onActionComplete=function(){},e.prototype.playEach=function(e,t){e&&e.animation&&(e.animation.hasAnimation(t)?e.animation.play(t):e.animation.play(ROLE_ACTION_NAME.DJ))},e.prototype.setOrder=function(e,t){e&&e.parent.setChildIndex(e,t)},Object.defineProperty(e.prototype,"curModelAct",{get:function(){return this._curModelAct},set:function(e){this._curModelAct=e,this.curStyle&ROLE_STYLE.Horse?(this.playEach(this.ead_model1,ROLE_ACTION_NAME_WHILE_H[e]),this.playEach(this.ead_model2,ROLE_ACTION_NAME_WHILE_H[e]),this.playEach(this.ead_horse_z_t,e),this.playEach(this.ead_horse_z_s,e),this.playEach(this.ead_horse_b_t,e),this.playEach(this.ead_horse_b_s,e)):(this.playEach(this.ead_model1,e),this.playEach(this.ead_model2,e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flipX",{set:function(e){e<0?(this.scaleX=-Math.abs(this.scaleX),this.img_title&&(this.img_title.scaleX=-Math.abs(this.img_title.scaleX))):(this.scaleX=Math.abs(this.scaleX),this.img_title&&(this.img_title.scaleX=Math.abs(this.img_title.scaleX)))},enumerable:!0,configurable:!0}),e.prototype.calZOrder=function(){var e=0;this.setOrder(this.ead_horse_b_s,e++),this.setOrder(this.ead_horse_z_s,e++),this.setOrder(this.ead_model1,e++),this.setOrder(this.ead_model2,e++),this.setOrder(this.ead_horse_b_t,e++),this.setOrder(this.ead_horse_z_t,e++)},e.prototype.onChangingDir=function(e){null!=e&&(this.curDir=e),this.isCreating||(3==e||1==e?(this.ead_model1&&(this.ead_model1.visible=!0),this.ead_model2&&(this.ead_model2.visible=!1),this.ead_horse_z_t&&(this.ead_horse_z_t.visible=!0),this.ead_horse_z_s&&(this.ead_horse_z_s.visible=!0),this.ead_horse_b_t&&(this.ead_horse_b_t.visible=!1),this.ead_horse_b_s&&(this.ead_horse_b_s.visible=!1),this.flipX=1==e?-1:1):(this.ead_model1&&(this.ead_model1.visible=!1),this.ead_model2&&(this.ead_model2.visible=!0),this.ead_horse_z_t&&(this.ead_horse_z_t.visible=!1),this.ead_horse_z_s&&(this.ead_horse_z_s.visible=!1),this.ead_horse_b_t&&(this.ead_horse_b_t.visible=!0),this.ead_horse_b_s&&(this.ead_horse_b_s.visible=!0),this.flipX=0==e?1:-1),this.calZOrder())},e.prototype.reset=function(){this._curModelAct=ROLE_ACTION_NAME.DJ,this.curDir=3,this.flipX=1},e}(eui.Component);e.RoleDynamicModel=t,__reflect(t.prototype,"customui.RoleDynamicModel")}(customui||(customui={})),function(e){var t=function(n){function e(e,t){var i=n.call(this)||this;return i.skinName="BaseItemExpeditionSkin",i}return __extends(e,n),e.prototype.updateData=function(e){n.prototype.updateData.call(this,e),this.bloodMax=e.bloodMax,this.bloodNum=e.bloodNum,this.bloodSpr()},e.prototype.bloodSpr=function(){this.blood.maximum=this.bloodMax,this.blood.value=this.bloodNum},e}(e.BaseItem);e.BaseExpeditionItem=t,__reflect(t.prototype,"customui.BaseExpeditionItem")}(customui||(customui={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.data=e,t.skinName="SkillItemSkin",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data&&this.updateItem(this.data)},e.prototype.updateItem=function(e){this.data=e;var t=this.data&&this.data.code;if(t){this.gp_item.visible=!0,this.gp_non.visible=!1;var i=game.Config.skillBaseConfig()[t];this.img_icon.source=ResourceUtils.png(i.iconName),i.level&&!e.notNeedLevel?(this.gp_level.visible=!0,this.lb_level.text=i.level.toString()):this.gp_level.visible=!1,null!=this.data.unlock?UIActionManager.setAbsGrey(this.img_icon,!this.data.unlock):UIActionManager.setAbsGrey(this.img_icon,!1),this.data.light?this.gp_effect.numChildren||DragonBoneTools.playOnce({effectName:"common_kejihuo",parent:this.gp_effect,loop:!0}):this.gp_effect.removeChildren()}else this.gp_effect.removeChildren(),this.gp_item.visible=!1,this.gp_non.visible=!0},e.prototype.reset=function(){this.data=void 0,this.gp_item.visible=!0,this.gp_non.visible=!1,this.gp_level.visible=!1,this.img_icon.source="skill_icon_kong_png"},e.prototype.onClick=function(){},e}(eui.Component);e.SkillItem=t,__reflect(t.prototype,"customui.SkillItem");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="SkillDetailsPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateItem=function(e){var t=e.code;this.skill_item.updateItem({code:t});var i=game.Config.skillBaseConfig()[t];this.lb_name.text=i.name,this.lb_tips.text=e.tips&&""!=e.tips?"("+e.tips+")":"",this.lb_desc.text=i.desc;var n=Math.ceil(this.lb_desc.text.length/Math.floor(this.lb_desc.width/this.lb_desc.size));this.height=n*this.lb_desc.size+(n-1)*this.lb_desc.lineSpacing+140},e}(eui.Component);e.SkillDetailsPanel=i,__reflect(i.prototype,"customui.SkillDetailsPanel")}(customui||(customui={})),function(o){var e=function(i){function e(e){var t=i.call(this)||this;return t.skinName="CommonJiJieMyTeamSwitchPanelSkin",(t.params=e)&&(t.doneCB=e.doneCB),t}return __extends(e,i),e.prototype.onViewCreated=function(){console.warn("子类需要覆盖该方法")},e.prototype.onViewRemove=function(){console.warn("子类需要覆盖该方法")},e.prototype.onDestroy=function(){this.onViewRemove()},e.prototype.childrenCreated=function(){var n=this;i.prototype.childrenCreated.call(this),this.params.members.forEach(function(t){var e=customui.PlayerHeadFactory.create({vo:t.baseInfo,tapEvent:function(){var e=[];e.push({text:"是否将队长转让给",style:{textColor:11041365,size:24}}),e.push({text:" "+t.baseInfo.name+" ",style:{textColor:4557956,size:24}}),e.push({text:"？",style:{textColor:11041365,size:24}}),o.GameMgr.getInstance().showCommonTipsWin({commonTips:e,cb:!1,clickCB:function(e){0===e.type||1===e.type&&(n.hide(),n.doneCB&&n.doneCB(t))}})}});n.gp_heads.addChild(e);var i=new eui.Label(t.baseInfo.name);i.size=20,n.gp_names.addChild(i)}),this.onViewCreated()},e}(BasePanel);o.CommonJiJieMyTeamSwitchPanel=e,__reflect(e.prototype,"game.CommonJiJieMyTeamSwitchPanel")}(game||(game={})),function(e){var t=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.width=Utils.DeviceUtils.curWidth(),this.height=Utils.DeviceUtils.curHeight(),this.init();var e=new egret.Sprite;e.graphics.clear(),e.graphics.beginFill(0,.3),e.graphics.drawRect(0,0,this.width,this.height),e.graphics.endFill(),this.addChild(e)},e.prototype.init=function(){DragonBoneTools.create("common_jiazai",function(e){this.loading=e,this.loading.x=this.width/2,this.loading.y=this.height/2,this.addChild(this.loading),this.loading.visible=!0,this.loading.animation.timeScale=1,this.loading.animation.play()},this)},e.prototype.switch=function(e){this.loading||!e?e?(this.visible=e,this.loading.animation.play()):(this.visible=e,this.loading&&this.loading.animation.stop()):this.init()},e}(eui.Group);e.LoadingEffect=t,__reflect(t.prototype,"game.LoadingEffect")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.onViewCreaeted=!1,t.CUSTOM_CONFIG={preload_pack:function(e,t,i){o.Config.unzipFinish?t():o.Config.unzipSync(e,t,i)}},t.groupNames=new Array,Utils.DebugUtils.isDebug&&(window._clm=t),t}return __extends(n,i),Object.defineProperty(n.prototype,"rootUI",{get:function(){return GameRootLayer.gameLayer().loadingUIEasy||GameRootLayer.gameLayer().loadingUI},enumerable:!0,configurable:!0}),n.prototype.listNotificationInterests=function(){return[CN.SHOW_LOADING]},n.prototype.handleNotification=function(e){var t=this;switch(e.getName()){case CN.SHOW_LOADING:var i=e.getBody(),n=i.groupNames;this.resDoneCB=i.resDoneCB,n.forEach(function(e){t.groupNames.push(e)}),this.rootUI?this.onViewCreaeted?this.loadNext():this.onViewCreate():this.addRootView(o.LoadingUI,void 0,GameRootLayer.gameLayer().loadLayer)}},n.prototype.loadNext=function(){RES.loadGroup(this.groupNames[0])},n.prototype.onViewCreate=function(){this.onViewCreaeted=!0,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.loadNext()},n.prototype.onResLoadComplete=function(t){for(var i=this,n=0,o=!1,e=function(e){if(e===t.groupName)return a.CUSTOM_CONFIG[e]?(o=!0,a.CUSTOM_CONFIG[e](a.onResProgress,function(){i.groupNames.splice(n,1),i.onResLoadComplete(new RES.ResourceEvent(e))},a)):a.groupNames.splice(n,1),"break";n++},a=this,r=0,s=this.groupNames;r<s.length;r++){if("break"===e(s[r]))break}0===this.groupNames.length?(this.resDoneCB&&this.resDoneCB(),this.resDoneCB=void 0):o||this.loadNext()},n.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},n.prototype.onResLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResLoadComplete(e)},n.prototype.onResProgress=function(e){this.rootUI.setProgress(e.itemsLoaded,e.itemsTotal)},n.N="LoadingMediator",n}(BaseMediator);o.LoadingMediator=e,__reflect(e.prototype,"game.LoadingMediator")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.isMenShow=!1,e.curPbNextProgressValue=0,e.skinName="LoadingSkin",e.once(egret.Event.REMOVED_FROM_STAGE,function(){e.sche&&(egret.clearInterval(e.sche),e.sche=void 0),e.scheFade&&(egret.clearTimeout(e.scheFade),e.scheFade=void 0)},e),e}return __extends(e,t),e.prototype.pbFadeFullDoneAndHideMen=function(e){var t=this;this.pb_layerProgress_fade.value=this.pb_layerProgress.value=100,this.pb_layerProgress_fade.slideDuration=this.pb_layerProgress.slideDuration=0,this.sche&&(egret.clearInterval(this.sche),this.sche=void 0),this.scheFade&&(egret.clearTimeout(this.scheFade),this.scheFade=void 0),egret.setTimeout(function(){t.img_halo.visible=t.pb_layerProgress_fade.visible=t.pb_layerProgress.visible=!1,t.pb_layerProgress_fade.value=t.pb_layerProgress.value=0,egret.Tween.get(t.img_shang).to({y:0},500,egret.Ease.backInOut),egret.Tween.get(t.img_xia).to({y:1280},500,egret.Ease.backInOut).call(function(){t.isMenShow=!1,t.visible=!1,e&&e()})},this,100)},e.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),this.visible=!1,this.pb_layerProgress_fade.maximum=100,this.pb_layerProgress.labelFunction=function(e,t){return i.labelFunction(e,t)},this.lb_tips.visible=!1,this.img_halo.visible=this.pb_layerProgress_fade.visible=this.pb_layerProgress.visible=!1},e.prototype.labelFunction=function(e,t){return this.curPbNextProgressValue=e/t*this.pb_layerProgress_fade.maximum,Math.floor(e)+"/"+t},e.prototype.showPbAndTips=function(){var e=this;this.pb_layerProgress_fade.value=this.pb_layerProgress.value=0,this.img_halo.visible=this.pb_layerProgress_fade.visible=this.pb_layerProgress.visible=!0,this.lb_tips.visible=!0;var t=0,i=0;this.sche||(this.sche=egret.setInterval(function(){2e3<=(t+=250)&&(e.switchTips(),t=0),1e3<=i&&(e.pb_layerProgress.value<e.curPbNextProgressValue&&(e.pb_layerProgress.value+=.25),i=0)},this,250)),this.switchTips(),this.pbFadeUpdate()},e.prototype.hidePbAndTips=function(){this.lb_tips.visible=!1,this.sche&&(egret.clearInterval(this.sche),this.sche=void 0)},e.prototype.pbFadeUpdate=function(){var e=this;if(!this.scheFade){var t=Utils.MathUtils.getRandomInt(50,1e3);this.scheFade=egret.setTimeout(function(){egret.log("scheFade",t),egret.clearTimeout(e.scheFade),e.scheFade=void 0,e.pbFadeUpdate()},this,t),this.pb_layerProgress_fade.value=0,this.pb_layerProgress_fade.slideDuration=0,this.once(egret.Event.ENTER_FRAME,function(){e.pb_layerProgress_fade.slideDuration=t,e.pb_layerProgress_fade.value=100},this)}},e.prototype.switchTips=function(){var e=LOADING_TIPS[Utils.MathUtils.getRandomInt(0,LOADING_TIPS.length-1)];this.lb_tips.textFlow=[{text:"提示：",style:{textColor:1895742}},{text:e,style:{textColor:16777215}}]},e.prototype.switchMenLoading=function(e,t,i){var n=this;if(e){if(i&&(this.forceForName=i),this.isMenShow)return void(t&&t());this.visible=!0,egret.Tween.get(this.img_shang).to({y:645},500,egret.Ease.backInOut),egret.Tween.get(this.img_xia).to({y:439.12},500,egret.Ease.backInOut).call(function(){n.showPbAndTips(),n.isMenShow=!0,t&&t()})}else{if(this.forceForName&&this.forceForName!=i)return void(t&&t());if(this.forceForName=void 0,!this.isMenShow)return void(t&&t());this.hidePbAndTips(),this.pbFadeFullDoneAndHideMen(t)}},e.prototype.setProgress=function(e,t){"UNTIL_FIGHT_LOADED"==this.forceForName&&(t<50&&(t=50),e<this.pb_layerProgress.value)||(this.pb_layerProgress.value=e,this.pb_layerProgress.maximum=t)},e}(BaseView);e.LoadingUI=t,__reflect(t.prototype,"game.LoadingUI")}(game||(game={})),function(e){var t=function(n){function e(e){var t=n.call(this)||this;return t.skinName="UpdateLogPanelSkin",t.params=e,t}return __extends(e,n),e.prototype.onDestroy=function(){n.prototype.onDestroy.call(this)},e.prototype.childrenCreated=function(){var i=this;n.prototype.childrenCreated.call(this),this.sl_content.horizontalScrollBar.autoVisibility=!1,this.sl_content.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_content.scrollPolicyV=eui.ScrollPolicy.AUTO,this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this);var e=this.params&&this.params.arrs;e?e.forEach(function(e){if(RES.hasRes(e)){var t=new eui.Image;t.source=e,i.gp_content.addChild(t)}}):this.hide()},e}(BasePanel);e.AdsPanel=t,__reflect(t.prototype,"game.AdsPanel")}(game||(game={})),function(c){var e=function(i){function o(){var e=i.call(this)||this;return e.loginPy=c.AppFacade.getInstance().retrieveProxy(c.LoginPy.N),e.playerPy=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N),e.canPopNotice=!0,e.isChoose=!0,e.skinName="BeforeLoginUISkin",e.caidanCommandQueue=new Array,e}return __extends(o,i),o.prototype.showInfo=function(){PopUpManager.addPopUp({obj:new c.NoticeBoardPanel({content:JSON.stringify(Utils.agentConfig)})})},o.prototype.showDebugTools=function(){Utils.MsgUtils.addMidMsg("调试模式开启"),Utils.agentConfig.IsDebug=!0,Utils.DebugUtils.setDebug(!0),Utils.SDKMgr.cmd({type:"setDebugModel",value:!0})},o.prototype.caidanCommand=function(e){if(this.lb_version.visible&&(this.caidanCommandQueue.push(e),!(this.caidanCommandQueue.length<3))){var t=this.caidanCommandQueue.join(""),i=t.substring(t.length-3);switch(console.log("finalCommand",i),i){case"000":UIActionManager.blink(this.lb_version),this.caidanCommandQueue.splice(0,this.caidanCommandQueue.length);break;case"012":this.showInfo();break;case"102":this.showDebugTools()}}},o.prototype.onDestroy=function(){this.lb_start&&egret.Tween.removeTweens(this.lb_start)},o.prototype.goTestFight=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,Utils.enterMainOffLine()];case 1:return e.sent(),Utils.agentConfig.OffLineTest=!0,c.MainJumpConfig.jumpTo("FIGHT_TEST"),[2]}})})},o.prototype.goTestOL=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,Utils.enterMainOffLine()];case 1:return e.sent(),Utils.agentConfig.OffLineTest=!0,c.AppFacade.getInstance().sendNotification(CN.HIDE_ALL_SUBVIEW),c.AppFacade.getInstance().showSubView(c.LoginMediator.N,c.LoginMediator.SV.OL_TEST),[2]}})})},o.prototype.goTestModel=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,Utils.enterMainOffLine()];case 1:return e.sent(),Utils.agentConfig.OffLineTest=!0,PopUpManager.addPopUp({obj:new c.FightTestModel}),[2]}})})},o.prototype.childrenCreated=function(){var n=this;if(i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.img_logo),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btn),Utils.DeviceUtils.setLiuHaiPingAdapter(this.lb_version),this.btn_FloatingWindow.parent.removeChild(this.btn_FloatingWindow),GameRootLayer.gameLayer().loadLayer.addChild(this.btn_FloatingWindow),this.lb_connact.visible=!!Utils.agentConfig.other.topConnact,this.lb_connact.text="客服QQ："+Utils.agentConfig.other.topConnact,this.btn_account.visible=!Utils.SDKMgr.getPerformConfig(34),Utils.SDKMgr.cmd({type:"setDebugModel",value:!!Utils.agentConfig.IsDebug}),!Utils.SDKMgr.getPerformConfig(8)){var e=Utils.SDKMgr.getPerformConfig(200003);this.img_logo.source=e||"chuanghao_img_logo_png"}Utils.SDKMgr.getPerformConfig(41)?(this.btn_FloatingWindow.visible=!0,this.btn_FloatingWindow.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){o.flowWindowPos={stageX:e.stageX,stageY:e.stageY,beginX:e.stageX,beginY:e.stageY}},this),this.btn_FloatingWindow.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){if(o.flowWindowPos){var t=o.flowWindowPos.stageX-e.stageX,i=o.flowWindowPos.stageY-e.stageY;n.btn_FloatingWindow.x-=t,n.btn_FloatingWindow.y-=i}o.flowWindowPos={stageX:e.stageX,stageY:e.stageY,beginX:o.flowWindowPos.beginX,beginY:o.flowWindowPos.beginY}},this),this.btn_FloatingWindow.addEventListener(egret.TouchEvent.TOUCH_END,function(e){if(o.flowWindowPos){var t=o.flowWindowPos.beginX-e.stageX,i=o.flowWindowPos.beginY-e.stageY;t*t+i*i<=50&&Utils.SDKMgr.cmd({type:"PopKeFu"})}n.btn_FloatingWindow.x<Utils.DeviceUtils.curWidth()/2?n.btn_FloatingWindow.x=0:n.btn_FloatingWindow.x=Utils.DeviceUtils.curWidth()-n.btn_FloatingWindow.width,o.flowWindowPos=void 0},this),this.btn_FloatingWindow.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(e){n.btn_FloatingWindow.x<Utils.DeviceUtils.curWidth()/2?n.btn_FloatingWindow.x=0:n.btn_FloatingWindow.x=Utils.DeviceUtils.curWidth()-n.btn_FloatingWindow.width,o.flowWindowPos=void 0},this)):this.btn_FloatingWindow.visible=!1;var t=Utils.SDKMgr.getPerformConfig(26);t&&(t.lb_1&&(this.lb_1.text=t.lb_1),t.lb_2&&(this.lb_2.text=t.lb_2),t.lb_3&&(this.lb_3.text=t.lb_3),t.lb_4&&(this.lb_4.text=t.lb_4),t.lb_5&&(this.lb_5.text=t.lb_5),t.lb_6&&(this.lb_6.text=t.lb_6),t.lb_7&&(this.lb_7.text=t.lb_7),t.lb_8&&(this.lb_8.text=t.lb_8)),Utils.SDKMgr.nodeRecord(1),this.loghttpLogin(),this.cb_checkBox.selected=!0,this.addEvents(),UIActionManager.fadeBlink(this.lb_start,!0,void 0,1e3),Utils.DebugUtils.isDebug&&!getUrlKV().banshu?(this.btn_test0.visible=!0,this.btn_test1.visible=!0,this.btn_test2.visible=!0,this.btn_test3.visible=!0,this.cb_needGuide.visible=!0,this.btn_test0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.goTestModel()},this),this.btn_test1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.goTestFight()},this),this.btn_test2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().sendNotification(CN.HIDE_ALL_SUBVIEW),c.AppFacade.getInstance().showSubView(c.LoginMediator.N,c.LoginMediator.SV.EFFECT_TEST)},this),this.btn_test3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.goTestOL()},this),this.cb_needGuide.addEventListener(egret.Event.CHANGE,function(){Utils.isNeedGuide=n.cb_needGuide.selected},this)):(this.btn_test0.visible=!1,this.btn_test1.visible=!1,this.btn_test2.visible=!1,this.btn_test3.visible=!1,this.cb_needGuide.visible=!1,this.cb_needGuide.selected=!0),Utils.SDKMgr.getPerformConfig(17)&&(this.cb_needGuide.selected=!1),Utils.isNeedGuide=this.cb_needGuide.selected,egret.setTimeout(function(){var e;for(var t in Utils.SDKMgr.getPerformConfig(22)?(e={},n.img_startGame.source=Utils.SDKMgr.getPerformConfig(22)):Utils.SDKMgr.getPerformConfig(6)?(e={},n.img_startGame.source="bg_dengluditu_jpg"):(n.img_startGame.source="bg_dengluditu_ditu_jpg",n.img_startGame2.source="bg_dengluditu_ditu2_png",e={lx:{name:"dljm_wyw",x:140,y:560}},GameRootLayer.gameLayer().loadingUIEasy.initDbAct()),e){var i=n.gp_eff;"hc1"==t&&(i=n.gp_eff0),DragonBoneTools.playOnce({cacheAsBitmap:!1,loop:!0,x:e[t].x,y:e[t].y,scaleX:e[t].scale||1,scaleY:e[t].scale||1,effectName:e[t].name,parent:i,timeScale:e[t].timeScale||1})}},this,500),Utils.SDKMgr.getPerformConfig(20)&&PopUpManager.addPopUp({obj:new c.ServerMaintainView({tips:Utils.SDKMgr.getPerformConfig(20)}),clickDarkClose:!1}),this.gp_info2.visible=!Utils.SDKMgr.getPerformConfig(25),Utils.SDKMgr.getPerformConfig(42)&&(this.gp_choose.visible=!0),this.cb_tips.addEventListener(egret.Event.CHANGE,function(e){n.isChoose=n.cb_tips.selected},this),this.cb_tips.selected=!0,this.gp_show1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.Config.helpConfig(function(e){PopUpManager.addPopUp({obj:new c.NoticeBoardPanel({fixedcontent:e.text1})})})},this),this.gp_show2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.Config.helpConfig(function(e){PopUpManager.addPopUp({obj:new c.NoticeBoardPanel({fixedcontent:e.text2})})})},this)},o.prototype.updateView=function(e){var i=this;switch(e.type){case CN.LOGIN_GO_LOGIN_LOGIN_SUCESS:Utils.SDKMgr.nodeRecord(300204);var t=["preload_pack"];GameRootLayer.gameLayer().switchMenLoading(!0,function(){Utils.SDKMgr.nodeRecord(300206),i.loginPy.isNewPlayer&&t.push("start_anim"),i.mediator.preloadRes(t,function(){GameRootLayer.gameLayer().preloadRes(),Utils.SDKMgr.nodeRecord(300207),c.AppFacade.getInstance().sendNotification(CN.CONFIG_ALL_LOADED),c.GameMgr.getInstance().connectGameSev(Utils.agentConfig.isHttps?i.playerPy.roleVo.sGameUrl:i.playerPy.roleVo.gameUrl)})},"LOGIN_INTO_MAP");break;case CN.LOGIN_HTTP_LOGIN_SUCESS:0===e.data.success&&this.loginPy.getPlayerServer();break;case CN.LOGIN_MAKE_ROLE_SUCCESS:this.delayScreenEnterGame();break;case CN.LOGIN_UPDATE_SERVER:0<this.loginPy.serverList.length&&(this.lb_start.visible=!0);var n=this.loginPy.serverList[0];n?(this.timer&&(egret.clearTimeout(this.timer),this.timer=void 0),this.img_status.source=c.ServerItem.SERVER_STATUS[n.s_healthStatus],this.lb_serverName.text=""+n.list_name+((n.area-1)%48+1)+"服","4"==n.s_healthStatus.toString()?(this.canPopNotice=!1,PopUpManager.addPopUp({obj:new c.ServerMaintainView})):Utils.SDKMgr.getPerformConfig(18)||c.GameMVC.loginPy.getAllPlayerServer(function(e,t){egret.log("是否有账号信息",t),t||i.onEnterBtnClick()})):(this.timer&&egret.clearTimeout(this.timer),this.timer=egret.setTimeout(function(){i.loginPy.getPlayerServer()},this,5e3),this.lb_serverName.text="正在拉取"),this.canPopNotice&&(Utils.SDKMgr.getPerformConfig(7)||(this.canPopNotice=!1,this.loginPy.getGameNotice()));break;case SocketConst.SOCKET_NOCONNECT:this.lb_tips.text=""}},o.prototype.addEvents=function(){var t=this;this.btn_notice.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showNoticeBoard,this),this.btn_account.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showUserPanel,this),this.lb_protocol.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showProtocal,this),this.img_startGame.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this);var i=0;this.gp_0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(10<=++i){t.lb_version.visible||(t.lb_version.visible=!0,Utils.DeviceUtils.setLiuHaiPingAdapter(t.lb_version));var e=RES.getResourceInfo("config_all_zip").url.split(".")[0];Utils.agentConfig.AgentKey!=Utils.agentConfig.AgentCode?t.lb_version.text="当前渠道标签："+Utils.agentConfig.AgentName+"\n当前渠道号："+Utils.agentConfig.AgentKey+" 所在专服渠道号："+Utils.agentConfig.AgentCode+" \n推更时间："+Utils.agentConfig.VersionTime+" 配置版本："+e.substring(e.length-6):t.lb_version.text="当前渠道标签："+Utils.agentConfig.AgentName+"\n当前渠道号："+Utils.agentConfig.AgentKey+"\n推更时间："+Utils.agentConfig.VersionTime+" 配置版本："+e.substring(e.length-6)}},this),this.gp_0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.caidanCommand(0)},this),Utils.TouchUtils.addTouchListener(this.gp_server,function(){t.showArea()})},o.prototype.showArea=function(){c.AppFacade.getInstance().showSubView(c.PlayerMediator.N,c.PlayerMediator.SV.SERVER_LIST)},o.prototype.showNoticeBoard=function(){this.caidanCommand(1),PopUpManager.addPopUp({obj:new c.NoticeBoardPanel})},o.prototype.showUserPanel=function(){this.caidanCommand(2),Utils.agentConfig.thirdUserSystem?Utils.SDKMgr.goLogin():c.AppFacade.getInstance().showSubView(c.LoginMediator.N,c.LoginMediator.SV.LOGIN_PANEL)},o.prototype.showProtocal=function(){PopUpManager.addPopUp({obj:new c.NoticeBoardPanel})},o.prototype.startGame=function(){this.playerPy.loginStatusVO.state<1?this.loghttpLogin():this.loginPy.serverList.length<=0||this.onEnterBtnClick()},o.prototype.loghttpLogin=function(){var e=!1;if(Utils.agentConfig.clientPasswd)this.loginPy.clientPasswd=Utils.agentConfig.clientPasswd,this.loginPy.clientPasswd&&""!=this.loginPy.clientPasswd&&(e=!1,Utils.agentConfig.thirdUserSystem=!1,this.loginPy.userVO.uuid=Utils.agentConfig.uuid,getUrlKV().uuid?this.loginPy.userVO.uuid=getUrlKV().uuid:getUrlKV().fadeUuid&&(this.loginPy.userVO.uuid=Base64Util.decode(Base64Util.decode(Base64Util.decode(getUrlKV().fadeUuid)))),Utils.agentConfig.AgentCode=getUrlKV().fadeAgentCode||Utils.agentConfig.AgentCode,Utils.agentConfig.ProjectName=getUrlKV().fadeProjectName||Utils.agentConfig.ProjectName,Utils.agentConfig.HttpSerever=getUrlKV().fadeHttpSerever||Utils.agentConfig.HttpSerever,Utils.Http.loginKey="507310f58a0ac8e3d8ad8f60c8b85b46"+Utils.agentConfig.ProjectName,""!=this.loginPy.userVO.uuid&&this.loginPy.userVO.uuid&&""!=Utils.agentConfig.AgentCode&&Utils.agentConfig.AgentCode?(this.loginPy.userVO.username=this.loginPy.playerProxy.playerInfoVO.name,this.loginPy.getPlayerServer()):Utils.MsgUtils.addMidMsg("请在链接末尾拼接?uuid=XXX&fadeAgentCode=YYY"),this.playerPy.loginStatusVO.state=1);else if(Utils.agentConfig.thirdUserSystem)Utils.SDKMgr.goLogin();else{var t=Utils.LocalStorageUtil.getItem("LoginHistory",!0);if(t){e=!0;var i=JSON.parse(t),n=i[i.length-1];this.loginPy.userVO.username=n.acc,this.loginPy.userVO.uuid=n.acc,this.loginPy.userVO.password=n.pwd}this.loginPy.userVO.username||(e=!1,PopUpManager.addPopUp({obj:new c.NewLoginInput}))}e&&this.loginPy.goHttpLogin()},o.prototype.onEnterBtnClick=function(){if(this.isChoose)if(Utils.SDKMgr.nodeRecord(300100),this.loginPy.userVO.uuid){this.loginPy.serverSelect=this.loginPy.serverList[0];var e=this.loginPy.serverSelect;if(e){if("4"==e.s_healthStatus.toString())return void PopUpManager.addPopUp({obj:new c.ServerMaintainView})}else Utils.SDKMgr.nodeRecord(300103),Utils.MsgUtils.addMidMsg("找不到服务器，请重试"),this.loginPy.getPlayerServer();if(this.img_startGame.touchEnabled){if(this.delayScreenEnterGame(),Utils.Socket.isConnecting())if(Utils.SDKMgr.nodeRecord(300104),this.log("已连接，先断开再重新连接websocket"),Utils.Socket.close(),150<=this.playerPy.loginStatusVO.state)Utils.SDKMgr.nodeRecord(300105),c.GameMgr.getInstance().connectGameSev(Utils.agentConfig.isHttps?this.playerPy.roleVo.sGameUrl:this.playerPy.roleVo.gameUrl),this.lb_tips.text="正在匹配最佳服务器...";else{Utils.SDKMgr.nodeRecord(300106),this.loginPy.serverSelect=this.loginPy.serverList[0];var t=this.loginPy.serverSelect;c.GameMgr.getInstance().connectLoginSev(t.s_ip,Utils.agentConfig.isHttps?t.sPort:t.port),this.lb_tips.text="正在匹配最佳服务器.."}else this.log("没有连接，先连接websocket"),Utils.SDKMgr.nodeRecord(300102),c.GameMgr.getInstance().connectLoginSev(e.s_ip,Utils.agentConfig.isHttps?e.sPort:e.port),this.lb_tips.text="正在匹配最佳服务器..";var i=Utils.LocalStorageUtil.getItem("ServersList"),n=[],o=[];i&&(n=JSON.parse(i));for(var a=0,r=n;a<r.length;a++){var s=r[a];s.s_id!=this.loginPy.serverSelect.s_id&&o.push(s)}o.push(this.loginPy.serverSelect),Utils.LocalStorageUtil.setItem("ServersList",JSON.stringify(o))}}else egret.warn("还没拿到登录uuid");else Utils.MsgUtils.addMidMsg("请先阅读用户协议")},o.prototype.delayScreenEnterGame=function(){var e=this;this.img_startGame.touchEnabled=!1,this.gp_info.visible=!1,egret.setTimeout(function(){e.gp_info&&(e.gp_info.visible=!0,e.img_startGame.touchEnabled=!0,e.lb_tips.text="")},this,3e4)},o}(BaseFull);c.BeforeLoginUI=e,__reflect(e.prototype,"game.BeforeLoginUI")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.playing=!1,e.onceNum=1,e.loop=!1,e.random=!1,e.effectName="",e.effects=["common_skill_ansha_1","common_skill_ansha_2","common_skill_anyinglian_1","common_skill_anyinglian_2","common_skill_anyinglian_3","common_skill_anyinglian_4","common_skill_baonuyiji_1","common_skill_baonuyiji_2","common_skill_baonuyiji_3","common_skill_bing","common_skill_bingdong","common_skill_bingqiu_1","common_skill_bingqiu_2","common_skill_changqiongzhenji_1","common_skill_changqiongzhenji_2","common_skill_changqiongzhenji_3","common_skill_changqiongzhenji_4","common_skill_chaoshengbogongji","common_skill_chenshuizhige_1","common_skill_chenshuizhige_2","common_skill_chongjibo","common_skill_dadaodan_1","common_skill_dadaodan_2","common_skill_dun","common_skill_duqiu_1","common_skill_duqiu_2","common_skill_fengbaozhiquan_1","common_skill_fengbaozhiquan_2","common_skill_fengkuangshengzhang_1","common_skill_fengkuangshengzhang_2","common_skill_gong_1","common_skill_gong_2","common_skill_guangqiu_1","common_skill_guangqiu_2","common_skill_haiguzhongji_1","common_skill_haiguzhongji_2","common_skill_hanshuangbaofa_1","common_skill_hanshuangbaofa_2","common_skill_hanshuangbaofa_3","common_skill_hanshuangxinxing_1","common_skill_hanshuangxinxing_2","common_skill_huikan_1","common_skill_huikan_2","common_skill_huimiefengbao","common_skill_huiyinji","common_skill_huiyinji_1","common_skill_huiyinji_2","common_skill_huoqiu_1","common_skill_huoqiu_2","common_skill_huoyanqiang","common_skill_jiqiang_1","common_skill_jiqiang_2","common_skill_juduxinxing","common_skill_jushichongji_1","common_skill_jushichongji_2","common_skill_leitingzhiji","common_skill_leiyunzhinu_1","common_skill_leiyunzhinu_2","common_skill_lierenbiaoji_1","common_skill_lierenbiaoji_2","common_skill_linghunchongji_1","common_skill_linghunchongji_2","common_skill_linghunchongji_3","common_skill_linghunchongji_4","common_skill_longpozhan","common_skill_maichongxinxing_1","common_skill_maichongxinxing_2","common_skill_nengliangtiaoman","common_skill_rougou_1","common_skill_rougou_2","common_skill_senglue","common_skill_shanbeng_1","common_skill_shanbeng_2","common_skill_shangdizhishou_1","common_skill_shangdizhishou_2","common_skill_shengliaoshu","common_skill_shenglingguanghui_1","common_skill_shenglingguanghui_2","common_skill_shenmizhiyao","common_skill_shenqi","common_skill_sishenliandao","common_skill_siwangdiaoling_1","common_skill_siwangdiaoling_2","common_skill_siwangyizhi_1","common_skill_siwangyizhi_2","common_skill_sizhezhiwo_1","common_skill_sizhezhiwo_2","common_skill_toushiche_1","common_skill_toushiche_2","common_skill_touzhifeibiao_1","common_skill_touzhifeibiao_2","common_skill_wudizhan","common_skill_xiaodaodan_1","common_skill_xiaodaodan_2","common_skill_xindagousazhixi_1","common_skill_xindagousazhixi_2","common_skill_xuanyun","common_skill_yuanshipaoxiao_1","common_skill_yuanshipaoxiao_2","common_skill_yueshi_1","common_skill_yueshi_2","common_skill_yunshishu","common_skill_zhanzhengnuhou_1","common_skill_zhanzhengnuhou_2","common_skill_ziranzhinu_1","common_skill_ziranzhinu_2","common_skill_ziranzhinu_3","common_105100","common_VIPhuizhang","common_VIPhuizhang2","common_ZJMicon","common_ZJMicon_2","common_airenbaozang_1","common_airenbaozang_2","common_airenbaozang_3","common_airenbaozangkcz_1","common_airenbaozangkcz_2","common_baoxiang_1","common_baoxiang_2","common_baoxiang_3","common_baoxiang_4","common_baoxiang_5","common_baoxiangkai","common_bianpao","common_buxiudebaozang_1","common_buxiudebaozang_2","common_buxiudebaozang_bxdk","common_buxiudebaozang_jin","common_buxiudebaozang_lan","common_buxiudebaozang_xbx","common_buxiudebaozang_zi","common_caiquan","common_chouka","common_chouka_1","common_chouka_2","common_choukagaojiekuang","common_choukayingxiong","common_dianji","common_ditutswp","common_duanweitisheng","common_gonghuizhan","common_gonghuizhanVS","common_gonghuizhanhsb","common_gonghuizhanhsl","common_gonghuizhanjzhh","common_gonghuizhanlsb","common_gonghuizhanlsl","common_gonghuizhanqplh","common_gonghuizhanqzh","common_gonghuizhanqzl","common_gonghuizhansllh_1","common_gonghuizhansllh_2","common_gonghuizhanzdks","common_gonghuizhanzdz","common_guanmiwu","common_gxsj","common_hongbaodakai","common_hongbaotiaodong","common_hongbaoyu","common_huaguang","common_huodewupin","common_jiazai","common_jiban","common_jinbishan","common_jingdutiao_1","common_jingdutiao_1lg","common_jingdutiao_2","common_jingdutiaotk","common_kaimiwu","common_kapiandiguang","common_kapianfanzhuan","common_kejihuo","common_kejizhongxin","common_kelingqu","common_lingquanniu","common_maoxianjinbi","common_miwu","common_paihangbang_1","common_paihangbang_2","common_paihangbang_3","common_patabaoxiang","common_patachuansongmen","common_qiriicon","common_shengji","common_shengli_1","common_shengli_2","common_shengli_21","common_shengli_22","common_shenqichuxian","common_shenqichuxian_1","common_shenqichuxian_2","common_shenqihuoyan","common_shenqixuliwancheng","common_shenqixulizhong","common_shenqizs","common_shijiebossdjs","common_shikongzhimen_d","common_shikongzhimen_hong","common_shikongzhimen_lan","common_shikongzhimen_lv","common_shikongzhimen_zi","common_shouchongkuang","common_sj","common_skill_kulouwang_1","common_skill_kulouwang_2","common_skill_longhunqishi","common_skill_shenqi","common_tansuodu","common_tongguan","common_toushaizi","common_ty_bs","common_ty_czcg","common_ty_dj","common_ty_fm","common_ty_jihuo","common_ty_jinjie","common_ty_qh","common_ty_rlian","common_ty_shengjie","common_ty_xilian","common_weixinhongbao","common_xianshilibao","common_xing","common_yingxiongfenjie","common_yingxiongshengxing","common_yingxiongtouxiangkuang","common_ysdjts","common_zbdz","common_zdjindutiaolg","common_zhanbai_1","common_zhanbai_2","common_zhanbai_21","common_zhanbai_22","common_zhandouli","common_zhanli_2","common_zhihuanchenggong","common_zhihuanfangru","common_zhihuanhou","common_zhihuanqian","common_zoumadeng_1","common_zoumadeng_2","common_zoumadeng_3","denglu_05","denglu_06","denglu_07","gonghui_bg_ghbs","gonghui_bg_ghcj","gonghui_bg_ghdt","gonghui_bg_ghfb","gonghui_bg_ghsd","gonghui_bg_ghz","gonghui_bg_kjzx","richangfb_bg_jbbz","richangfb_bg_jysk","richangfb_bg_sjsx","richangfb_bg_sqfz","richangfb_bg_yxbl","yuanzheng_bg_chengbao","yuanzheng_bg_ditu_1","yuanzheng_bg_ditu_2"],e.skinName="EffectTestViewSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent()},e.prototype.playEffect=function(t,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return t&&this.playing?RES.hasRes(t+"_skeleton_dbbin")||RES.hasRes(t+"_ske_dbbin")?[4,DragonBoneTools.playOnce({effectName:t,parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/(this.onceNum+1)*i+300})]:[3,2]:[2];case 1:return e.sent(),[3,3];case 2:MovieClipTools.play({effectName:t,parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/(this.onceNum+1)*i+300}),e.label=3;case 3:return[2]}})})},e.prototype.beginPlay=function(){this.playing=!0;var e=parseInt(this.et_num.text);e&&e!=Number.NaN?this.onceNum=e:this.onceNum=1,this.effectName=this.et_name.text,this.loop=this.checkBox.selected,this.random=this.checkBox0.selected},e.prototype.reset=function(){this.loop=!1,this.playing=!1,this.onceNum=1,this.gp_effect.removeChildren()},e.prototype.PlayAll=function(){return __awaiter(this,void 0,void 0,function(){var t,i,n,o,a,r,s=this;return __generator(this,function(e){switch(e.label){case 0:if(!this.effectName)return[3,7];if(!this.loop)return[3,4];e.label=1;case 1:return this.playing?[4,this.playEffect(this.effectName,1)]:[3,3];case 2:return e.sent(),[3,1];case 3:return[3,6];case 4:return[4,this.playEffect(this.effectName,1)];case 5:e.sent(),e.label=6;case 6:return[2];case 7:if(t=1,!this.random)return[3,10];for(o=[],a=0;a<this.onceNum;a++)i=function(i){return __awaiter(s,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.playing?(t=Utils.MathUtils.getRandomInt(0,this.effects.length),[4,this.playEffect(this.effects[t],i)]):[3,2];case 1:return e.sent(),[3,0];case 2:return[2]}})})},o.push(i(a));return this.playing?[4,Promise.all(o)]:[3,9];case 8:e.sent(),e.label=9;case 9:return[3,15];case 10:if(!t--)return[3,15];this.loop&&(t=99999),n=0,e.label=11;case 11:if(!(n<this.effects.length-this.onceNum+1))return[3,14];for(o=[],a=0;a<this.onceNum;a++)r=a+n,o.push(this.playEffect(this.effects[r],a));return this.playing?[4,Promise.all(o)]:[3,13];case 12:e.sent(),e.label=13;case 13:return n+=this.onceNum,[3,11];case 14:return this.loop&&this.playing?[3,10]:[3,15];case 15:return[2]}})})},e.prototype.activateComponent=function(){var e=this;this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide(),i.AppFacade.getInstance().showSubView(i.LoginMediator.N,i.LoginMediator.SV.BEFORE_LOGIN)},this),this.btn_begin.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.playing||(e.beginPlay(),e.PlayAll())},this),this.btn_reset.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.reset()},this)},e}(BaseView);i.EffectTestView=e,__reflect(e.prototype,"game.EffectTestView")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="LoginHistoryListSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initListView()},e.prototype.initListView=function(){this.list=new eui.List;var e=new eui.TileLayout;e.requestedColumnCount=1,e.horizontalAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE,this.list.layout=e,this.sl_list.viewport=this.list,this.list.itemRenderer=r,this.sl_list.horizontalScrollBar.visible=!1,this.sl_list.horizontalScrollBar.autoVisibility=!1,this.sl_list.scrollPolicyH=eui.ScrollPolicy.OFF;for(var t=[],i=JSON.parse(Utils.LocalStorageUtil.getItem("LoginHistory",!0)),n=i.length-1;0<=n;--n)t.push(i[n]);var o=new eui.ArrayCollection(t);this.list.dataProvider=o},e.prototype.updateData=function(){for(var e=[],t=0,i=JSON.parse(Utils.LocalStorageUtil.getItem("LoginHistory",!0));t<i.length;t++){var n=i[t];e.push(n)}var o=a.AppFacade.getInstance().retrieveProxy(a.LoginPy.N).userVO.username;e.sort(function(e,t){if(e.acc==o)return-1}),this.list.dataProvider.replaceAll(e)},e.prototype.getLoginHistoryList=function(){for(var e=[],t=0,i=a.AppFacade.getInstance().retrieveProxy(a.LoginPy.N).userVO.username;t<i.length;t++){var n=i[t];e.push(n)}},e.prototype.preClose=function(){},e}(BasePanel);a.LoginHistoryPanel=e,__reflect(e.prototype,"game.LoginHistoryPanel");var r=function(t){function e(){var e=t.call(this)||this;return e.isDelete=!1,e.skinName="UserItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var o=this;this.btn_delete.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.isDelete=!0;for(var e=[],t=0,i=JSON.parse(Utils.LocalStorageUtil.getItem("LoginHistory",!0));t<i.length;t++){var n=i[t];n.acc!=o.data.acc&&e.push(n)}Utils.LocalStorageUtil.setItem("LoginHistory",JSON.stringify(e),!0),a.AppFacade.getInstance().retrieveMediator(a.LoginMediator.N).getSubView(a.LoginMediator.SV.LOGIN_PANEL).lhl_history.updateData()},this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(!o.isDelete){var e=a.AppFacade.getInstance().retrieveProxy(a.LoginPy.N);e.userVO.username=o.data.acc,e.userVO.password=o.data.pwd;var t=a.AppFacade.getInstance().retrieveMediator(a.LoginMediator.N).getSubView(a.LoginMediator.SV.LOGIN_PANEL);t.lhl_history.visible=!1,t.updateView(),e.saveUserHistory(e.userVO.username,e.userVO.password)}o.isDelete=!1},this)},e.prototype.dataChanged=function(){this.lb_user.text=this.data.acc},e}(eui.ItemRenderer);a.userItemRenderer=r,__reflect(r.prototype,"game.userItemRenderer")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.loginProxy=o.AppFacade.getInstance().retrieveProxy(o.LoginPy.N),t.playerProxy=o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N),t.activityProxy=o.AppFacade.getInstance().retrieveProxy(o.ActivityPy.N),t.guildPy=o.AppFacade.getInstance().retrieveProxy(o.GuildPy.N),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.BEFORE_LOGIN,o.BeforeLoginUI),this.addSubView(n.SV.MAKE_ROLE,o.MakeRolePanel),this.addSubView(n.SV.LOGIN_PANEL,o.NewLoginUI),this.addSubView(n.SV.LOGIN_INPUT_PANEL,o.NewLoginInput),this.addSubView(n.SV.LOGIN_HISTORY,o.LoginHistoryPanel),this.addSubView(n.SV.EFFECT_TEST,o.EffectTestView),this.addSubView(n.SV.OL_TEST,o.RoleTestView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_HTTP_LOGIN_SUCESS,CN.LOGIN_SERVER_SELECT,CN.LOGIN_UPDATE_SERVER,CN.LOGIN_GO_LOGINGAME_LOGIN_SUCESS,CN.LOGIN_GO_LOGIN_LOGIN_NO_ROLE,CN.LOGIN_MAKE_ROLE_SUCCESS,CN.LOGIN_GO_LOGIN_LOGIN_SUCESS,SocketConst.SOCKET_RECONNECT,SocketConst.SOCKET_CONNECT,SocketConst.SOCKET_NOCONNECT]},n.prototype.handleNotification=function(e){var t=this,i=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case SocketConst.SOCKET_RECONNECT:case SocketConst.SOCKET_CONNECT:150<=this.playerProxy.loginStatusVO.state?(Utils.SDKMgr.nodeRecord(300301),this.loginProxy.goLoginGameLoginGame()):(Utils.SDKMgr.nodeRecord(300201),this.loginProxy.goLoginLogin());break;case CN.LOGIN_GO_LOGIN_LOGIN_SUCESS:case CN.LOGIN_GO_LOGIN_LOGIN_NO_ROLE:case CN.LOGIN_HTTP_LOGIN_SUCESS:case CN.LOGIN_SERVER_SELECT:case CN.LOGIN_UPDATE_SERVER:case CN.LOGIN_GO_LOGIN_LOGIN_FAIL:this.updateView(n.SV.BEFORE_LOGIN,{type:e.getName(),data:i});break;case SocketConst.SOCKET_NOCONNECT:Utils.MsgUtils.addMidMsg("网络连接失败"),this.updateView(n.SV.BEFORE_LOGIN,{type:e.getName(),data:i});break;case CN.LOGIN_GO_LOGINGAME_LOGIN_SUCESS:this.hideAllSubView(),this.playerProxy.GetPlayerInfo(function(){Utils.SDKMgr.nodeRecord(300401),Utils.SDKMgr.enterFlow("LoginGameR"),o.MainJumpConfig.jumpTo("MAIN"),o.MainJumpConfig.jumpTo("GUAJI"),t.guildPy.getPlayerGuildReq(function(){Utils.SDKMgr.nodeRecord(300402),t.sendNotification(CN.LOGIN_FINAL_DONE)})}),Utils.SDKMgr.getPerformConfig(10018)&&Utils.agentConfig.other.isJhb&&this.activityProxy.getFetchedList();break;case CN.LOGIN_MAKE_ROLE_SUCCESS:this.hideSubView(n.SV.MAKE_ROLE),this.updateView(n.SV.MAIN,{type:e.getName(),data:i}),this.loginProxy.goLoginLogin()}},n.N="LoginMediator",n.SV={MAIN:1,BEFORE_LOGIN:2,ACC_INPUT:3,MAKE_ROLE:5,LOGIN_PANEL:6,LOGIN_INPUT_PANEL:7,LOGIN_HISTORY:8,EFFECT_TEST:9,OL_TEST:10},n}(BaseMediator);o.LoginMediator=e,__reflect(e.prototype,"game.LoginMediator")}(game||(game={})),function(o){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.clientPasswd="",e.playerProxy=o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N),e.isPopupNotice=!1,e.isNewPlayer=!1,e._userVO=new o.UserVO,e.loginGameVO=new o.LoginGameVO,e.updateServerList({},""),e}return __extends(i,t),Object.defineProperty(i.prototype,"serverList",{get:function(){return this._serverList},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"recentServerList",{get:function(){return this._recentServerList},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"userVO",{get:function(){return this._userVO},enumerable:!0,configurable:!0}),i.prototype.updateServerList=function(e,t){for(var i in this._serverList?this._serverList.splice(0):this._serverList=new Array,e){var n=new o.ServerVO;n.update(e[i]),this._serverList.push(n)}if(""!=t)try{this._recentServerList=t.split(",")}catch(e){this._recentServerList=[]}else this._recentServerList=[]},i.prototype.goLoginLogin=function(){var e,t=this;(e={}).userAgent=window.navigator.userAgent,e.userAgentSDK=getUrlKV().userAgentSDK||"",this.playerProxy.loginStatusVO.state=100,this.log("goLoginLogin",Utils.agentConfig.channelName);var i=getUrlKV().recommendId||void 0,n=getUrlKV().recommendPlatform||void 0;i&&n&&this.log("来自玩家id推荐的用户",i,n),Utils.Socket.send("login","Login",{username:this.userVO.uuid,token:this.userVO.t_token,clientPasswd:this.clientPasswd,platform:Utils.agentConfig.AgentCode,osCode:Utils.DeviceUtils.getPlatform(),codeVersion:Utils.agentConfig.CodeVersion,serverId:this.serverSelect.area,unitServerId:this.serverSelect.s_id,userAgent:JSON.stringify(e),subPlatform:Utils.agentConfig.isHunFu?"":Utils.agentConfig.channelName,recommendId:Number(i),recommendPlatform:n,ext:JSON.stringify(this.userVO.login_loign_ext)}).then(function(e){Utils.SDKMgr.nodeRecord(300202),t.playerProxy.loginStatusVO.state=150,t.playerProxy.roleVo=e.role,t.log("create time",e.role.createDt),t.log("create time",t.playerProxy.roleVo.createDt),e.newRole&&(t.isNewPlayer=!0,Utils.SDKMgr.enterFlow("CreateRole")),t.sendNotification(CN.LOGIN_GO_LOGIN_LOGIN_SUCESS)}).catch(function(e){Utils.SDKMgr.nodeRecord(300203),t.sendNotification(CN.LOGIN_GO_LOGIN_LOGIN_FAIL),e&&10003!=e.err?(t.log("login login 失败",e.err,e),egret.setTimeout(function(){o.GameMgr.getInstance().restart()},t,3e3)):!e.role||e.role.playerId})},i.prototype.goLoginGameLoginGame=function(){var i=this;this.playerProxy.loginStatusVO.state=200,Utils.Socket.send("loginGame","LoginGame",{playerId:this.playerProxy.roleVo.playerId,username:this.userVO.uuid,name:this.playerProxy.playerInfoVO.name,sessionkey:this.playerProxy.roleVo.sessionkey,deviceId:Utils.DeviceUtils.deviceId(),codeVersion:Utils.agentConfig.CodeVersion}).then(function(e){e.isCreated,i.playerProxy.loginStatusVO.state=201,i.loginGameVO.update(e),i.log("进入游戏服成功"+e.initPm),Utils.SDKMgr.nodeRecord(300302),window.fundebug?(i.log("fundebug存在，设置用户名"),window.fundebug.metaData={name:i.userVO.username,uuid:i.userVO.uuid,playerId:i.playerProxy.roleVo.playerId}):i.log("fundebug注册失败"),Utils.Socket.send("loginGame","GetGuideInfo",{}).then(function(e){Utils.SDKMgr.nodeRecord(300304);var t=o.AppFacade.getInstance().retrieveProxy(o.GuidePy.N);try{t.serverGuideInfo=JSON.parse(e.guide)}catch(e){t.serverGuideInfo={}}i.sendNotification(CN.LOGIN_GO_LOGINGAME_LOGIN_SUCESS)})}).catch(function(e){e&&e.err&&Utils.MsgUtils.addErrMsg(e.err),i.log("loginGame失败",e),Utils.SDKMgr.nodeRecord(300303),egret.setTimeout(function(){o.GameMgr.getInstance().restart()},i,1500)})},i.prototype.CreateFirstRole=function(e){},i.prototype.getGameNotice=function(t){var i=this;Utils.Http.toGet({action:"game_notice",game_notice:0}).then(function(e){e&&e.status&&""!=e.notice&&!i.isPopupNotice?(PopUpManager.addPopUp({obj:new o.NoticeBoardPanel({content:e.notice}),closeCB:function(){t&&t()}}),i.isPopupNotice=!0):t&&t()})},i.prototype.getPlayerServer=function(){var t=this;Utils.SDKMgr.nodeRecord(2001);var e="get_player_server";Utils.SDKMgr.getPerformConfig(2)&&(e="get_server_shenhe"),Utils.Http.toGet({action:e,username:this.userVO.uuid}).then(function(e){Utils.SDKMgr.nodeRecord(2002),t.updateServerList(e.svrListT,e.playerList),o.AppFacade.getInstance().sendNotification(CN.LOGIN_UPDATE_SERVER,e)})},i.prototype.getAllPlayerServer=function(c){var e="get_AllServerList";Utils.SDKMgr.getPerformConfig(2)&&(e="get_AllServerList_shenhe"),Utils.Http.toGet({action:e,os_code:Utils.DeviceUtils.getPlatform(),username:o.GameMVC.loginPy.userVO.uuid}).then(function(e){var t=[],i={},n=!1,o=0,a={index:o++,list:[]};for(var r in i["我的区服"]=a,Array.isArray(e)&&e.forEach(function(e){i[e.list_name]||(i[e.list_name]={index:o++,list:[],allNum:Number(e.s_Allnum)}),e.area=Number(e.area),i[e.list_name].list.push(e),e.playerList&&(n||(n=!0),a.list.push(e))}),i){var s=i[r];t.push({name:r,index:s.index,list:s.list,allNum:s.allNum})}t.sort(function(e,t){return 0==e.index||0==t.index?0==e.index?-1:1:t.index-e.index}),Utils.SDKMgr.needNodeRecrod=!n,c(t,n)})},i.prototype.switchServer=function(t,i){var n=this;Utils.Http.toGet({action:"set_switchServer",username:this.userVO.uuid,unitServer:t,platform:Utils.agentConfig.AgentCode}).then(function(e){n.serverSelect||(n.serverSelect=new o.ServerVO),n.serverSelect.s_id=t,Utils.SDKMgr.enterFlow("SelectServer"),n.serverSelect=void 0,Utils.MsgUtils.addMidMsg("选服成功，点击登录"),i&&i(),500<=n.playerProxy.loginStatusVO.state?Utils.SDKMgr.restart():n.getPlayerServer()})},i.prototype.goHttpLogin=function(i){var n=this;150!=this.playerProxy.loginStatusVO.state?(Utils.SDKMgr.showLoadingTips({msg:"登录中"}),Utils.Http.toGet({action:"login",username:this.userVO.uuid,nickname:this.userVO.username,password:this.userVO.password,game_uin:this.userVO.uuid,token:this.userVO.verify_token,ext:JSON.stringify(this.userVO.login_ext)}).then(function(e){if(e&&0===e.success)Utils.SDKMgr.onLoginPHPSuccess(),Utils.SDKMgr.dismissLoading(),n.userVO.loginState=0,n.userVO.sign=e.sign,n.userVO.time=e.time,n.userVO.t_token=e.t_token,e.p_uid&&(n.userVO.login_loign_ext={p_uid:e.p_uid}),n.userVO.username&&""!=n.userVO.username||(n.userVO.username=e.game_uin),n.userVO.uuid&&""!=n.userVO.uuid||(n.userVO.uuid=e.game_uin),window.getUrlKV&&!window.getUrlKV().game_uin&&(window.getUrlKV().game_uin=e.game_uin),n.playerProxy.loginStatusVO.state=1,Utils.SDKMgr.nodeRecord(1001),Utils.LocalStorageUtil.setItem("login_et",JSON.stringify({acc:n.userVO.username,pwd:n.userVO.password}),!0),o.AppFacade.getInstance().sendNotification(CN.LOGIN_HTTP_LOGIN_SUCESS,e),i&&i();else{var t=e&&e.msg||"未知错误";Utils.MsgUtils.addMidMsg("登录失败："+t)}})):egret.log("已经通过了登录服了，跳过goHttpLogin")},i.prototype.goHttpRegister=function(t,i,n){var o=this;Utils.Http.toGet({action:"register",username:t,password:i}).then(function(e){0===e.success?(o.userVO.uuid=t,o.userVO.username=t,o.userVO.password=i,o.userVO.loginState=-1,o.goHttpLogin(),o.saveUserHistory(t,i),n&&n()):Utils.MsgUtils.addMidMsg("注册失败："+e.msg)})},i.prototype.saveUserHistory=function(e,t){for(var i=[],n=0,o=JSON.parse(Utils.LocalStorageUtil.getItem("LoginHistory",!0));n<o.length;n++){var a=o[n];a.acc!=e&&i.push(a)}8<=i.length&&i.shift(),i.push({acc:e,pwd:t}),Utils.LocalStorageUtil.setItem("LoginHistory",JSON.stringify(i),!0)},i.prototype.isSelf=function(e){return this.playerProxy.playerInfoVO.playerId==e},i.N="LoginProxy",i}(BaseProxy);o.LoginPy=e,__reflect(e.prototype,"game.LoginPy")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.playerProxy=i.AppFacade.getInstance().retrieveProxy(i.PlayerPy.N),e.loginProxy=i.AppFacade.getInstance().retrieveProxy(i.LoginPy.N),e.RECENT_PLAYER_SEX={1:"_login_create_role_m_json.pokemon_nanbiaozhi",2:"_login_create_role_m_json.pokemon_nvbiaozhi"},e.skinName="MakeRole",e}return __extends(e,t),e.prototype.insertRecentPlayer=function(e){void 0===e&&(e=!0);var t=new eui.Group,i=new eui.HorizontalLayout;i.verticalAlign=egret.VerticalAlign.MIDDLE,t.layout=i;var n=new eui.Image(this.RECENT_PLAYER_SEX[Utils.MathUtils.getRandomInt(1,2)]);n.scaleX=.5,n.scaleY=.5;var o=new eui.Label;o.size=18,o.textFlow=[{text:"玩家 ",style:{textColor:16777215}},{text:""+this.playerProxy.getFadeName(),style:{textColor:65514}},{text:" 进入游戏",style:{textColor:16777215}}],t.addChild(n),t.addChild(o),this.gp_enter.addChild(t),e&&(this.sl_enter.stopAnimation(),this.gp_enter.validateNow(),this.gp_enter.scrollV=this.gp_enter.contentHeight-this.sl_enter.height)},e.prototype.showMakeRole=function(){var e=this;this.recentPlayerSche||(this.recentPlayerSche=egret.setInterval(function(){e.insertRecentPlayer()},this,1500),this.insertRecentPlayer(!1),this.insertRecentPlayer(!1),this.insertRecentPlayer(!1),this.insertRecentPlayer(!1),this.insertRecentPlayer(!0)),this.sl_enter.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_enter.scrollPolicyV=eui.ScrollPolicy.OFF,this.gp_name.visible=!0,this.onCampChange(Utils.MathUtils.getRandomInt(1,2)),this.makeRandomName()},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.sl_enter.verticalScrollBar.visible=!1,this.sl_enter.verticalScrollBar.autoVisibility=!1,this.showMakeRole(),this.img_random.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.makeRandomName()},this),this.gp_boy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onCampChange(ESexType.ESexTypeMale)},this),this.img_small_nan.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onCampChange(ESexType.ESexTypeMale)},this),this.gp_girl.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onCampChange(ESexType.ESexTypeFemale)},this),this.img_small_nv.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onCampChange(ESexType.ESexTypeFemale)},this),this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""===this.et_roleName.text?Utils.MsgUtils.addMidMsg("请输入角色名"):Utils.Http.checkStrLegal(this.et_roleName.text,!0)&&this.loginProxy.CreateFirstRole(this.et_roleName.text)},this),UIActionManager.breathe(this.img_role)},e.prototype.makeRandomName=function(){this.et_roleName.text=this.playerProxy.getRandomName()},e.prototype.onCampChange=function(e){switch(this.playerProxy.roleVo.camp=e){case ESexType.ESexTypeMale:UIActionManager.setOutLineEffect(this.img_zhenrong1),UIActionManager.setOutLineEffect(this.img_small_nan),UIActionManager.setOutLineEffect(this.img_zhenrong2,!1),UIActionManager.setOutLineEffect(this.img_small_nv,!1),this.playerProxy.roleVo.initCode=1,this.img_role.source="_login_create_role_m_json.login_img_nan",this.img_mask1.visible=!1,this.img_mask2.visible=!0,UIActionManager.setGrey(this.img_small_nan,!1),UIActionManager.setGrey(this.img_small_nv,!0);break;case ESexType.ESexTypeFemale:UIActionManager.setOutLineEffect(this.img_zhenrong2),UIActionManager.setOutLineEffect(this.img_small_nv),UIActionManager.setOutLineEffect(this.img_zhenrong1,!1),UIActionManager.setOutLineEffect(this.img_small_nan,!1),this.playerProxy.roleVo.initCode=2,this.img_role.source="_login_create_role_m_json.login_img_nv",this.img_mask1.visible=!0,this.img_mask2.visible=!1,UIActionManager.setGrey(this.img_small_nan,!0),UIActionManager.setGrey(this.img_small_nv,!1)}this.updateName()},e.prototype.updateName=function(){switch(this.playerProxy.roleVo.camp){case ESexType.ESexTypeMale:"男";break;case ESexType.ESexTypeFemale:"女"}},e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.recentPlayerSche&&egret.clearInterval(this.recentPlayerSche)},e}(BaseFull);i.MakeRolePanel=e,__reflect(e.prototype,"game.MakeRolePanel")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.loginProxy=i.AppFacade.getInstance().retrieveProxy(i.LoginPy.N),e.playerProxy=i.AppFacade.getInstance().retrieveProxy(i.PlayerPy.N),e.focusOut=!1,e.skinName="NewLoginUISkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.ed_account.promptDisplay.size=this.ed_password.promptDisplay.size=24,this.ed_account.textDisplay.size=this.ed_password.textDisplay.size=24,this.lhl_history.visible=!1,this.btn_clear.visible=!1,this.addEvents()},e.prototype.updateView=function(){this.loginProxy.userVO&&(this.ed_account.text=this.loginProxy.userVO.username,this.ed_password.text=this.loginProxy.userVO.password)},e.prototype.addEvents=function(){this.ed_account.textDisplay.addEventListener(egret.Event.FOCUS_IN,this.onChange,this),this.ed_account.textDisplay.addEventListener(egret.Event.CHANGE,this.onChange,this),this.ed_account.textDisplay.addEventListener(egret.Event.FOCUS_OUT,this.onComplete,this),this.btn_list.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showRecentList,this),this.btn_clear.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClear,this),this.btn_logup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.logup,this),this.btn_conform.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this)},e.prototype.onChange=function(){this.lhl_history.visible&&(this.lhl_history.visible=!1),this.ed_account.text&&""!=this.ed_account.text?(this.btn_clear.visible=!0,this.btn_list.visible=!1):(this.btn_clear.visible=!1,this.btn_list.visible=!0)},e.prototype.onComplete=function(){var e=this;egret.setTimeout(function(){e.btn_clear.visible=!1,e.btn_list.visible=!0},this,500)},e.prototype.onClear=function(){this.ed_password.text=void 0,this.ed_account.text=void 0,this.btn_clear.visible=!1,this.btn_list.visible=!0},e.prototype.showRecentList=function(){this.lhl_history.visible=!this.lhl_history.visible},e.prototype.logup=function(){i.AppFacade.getInstance().hideSubView(i.LoginMediator.N,i.LoginMediator.SV.LOGIN_PANEL),PopUpManager.addPopUp({obj:new n})},e.prototype.startGame=function(){var e=this;this.ed_account.text&&""!=this.ed_account.text&&this.ed_password.text&&""!=this.ed_password.text?(this.loginProxy.userVO.uuid=this.ed_account.text,this.loginProxy.userVO.username=this.ed_account.text,this.loginProxy.userVO.password=this.ed_password.text,this.loginProxy.userVO.loginState=-1,this.loginProxy.saveUserHistory(this.ed_account.text,this.ed_password.text),this.loginProxy.goHttpLogin(function(){console.log("登录成功"),e.hide()})):Utils.MsgUtils.addMidMsg("请输入帐号和密码")},e}(BasePanel);i.NewLoginUI=e,__reflect(e.prototype,"game.NewLoginUI");var n=function(t){function e(){var e=t.call(this)||this;return e.isFinish=!1,e.skinName="NewLoginInputSKin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.ed_account.promptDisplay.size=this.ed_password.promptDisplay.size=24,this.ed_account.textDisplay.size=this.ed_password.textDisplay.size=24,this.ed_account.text=Utils.TimerManager.getServerTime().toString(),this.ed_password.text=Utils.TimerManager.getServerTime().toString(),this.addEvents()},e.prototype.addEvents=function(){var e=this;this.btn_conform.addEventListener(egret.TouchEvent.TOUCH_TAP,this.logup,this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.AppFacade.getInstance().showSubView(i.LoginMediator.N,i.LoginMediator.SV.LOGIN_PANEL),e.hide()},this),this.ed_account.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this),this.ed_password.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this)},e.prototype.logup=function(){var e=this;""!==this.ed_account.text&&""!==this.ed_password.text?Utils.Http.checkStrLegal(this.ed_account.text,!0)&&i.AppFacade.getInstance().retrieveProxy(i.LoginPy.N).goHttpRegister(this.ed_account.text,this.ed_password.text,function(){Utils.MsgUtils.addMidMsg("注册成功，自动登录中"),e.hide()}):Utils.MsgUtils.addMidMsg("请输入内容")},e.prototype.preClose=function(){},e}(BasePanel);i.NewLoginInput=n,__reflect(n.prototype,"game.NewLoginInput")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.skinName="NoticeBoardSkin",t.params=e,t}return __extends(e,i),e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this)},e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.params&&this.params.content?this.update(this.params.content):this.params&&this.params.fixedcontent?(this.lb_content.size=12,this.lb_content.text=this.params.fixedcontent):Utils.Http.toGet({action:"game_notice",game_notice:0}).then(function(e){e&&e.status&&t.update(e.notice)}),this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.sl_content.horizontalScrollBar.autoVisibility=!1,this.sl_content.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_content.scrollPolicyV=eui.ScrollPolicy.AUTO},e.prototype.update=function(e){var t=(new egret.HtmlTextParser).parser(e),i=[],n=0;t.forEach(function(t){var e=t.text.split("\\n");1<e.length?e.forEach(function(e){i.push({text:e,style:t.style}),i.push({text:"\n",style:{size:10}})}):i.push(t),n+=10}),0==i.length?this.lb_content.textFlow=[{text:"暂无公告"}]:this.lb_content.textFlow=i,588<this.lb_content.height&&(this.lb_content.height=this.lb_content.height-n)},e}(BasePanel);e.NoticeBoardPanel=t,__reflect(t.prototype,"game.NoticeBoardPanel")}(game||(game={})),function(s){var e=function(o){function e(){var e=o.call(this)||this;return e.playing=!1,e.curActIndex=0,e.dirArr=[3,1,0,2],e.actArr=[ROLE_ACTION_NAME.DJ,ROLE_ACTION_NAME.GJ,ROLE_ACTION_NAME.PB,ROLE_ACTION_NAME.SJ],e.KEY=["ol_scaleXY_z","ol_scaleXY_b","ol_rotation_z","ol_rotation_b","ol_acOffsetX_z","ol_acOffsetX_b","ol_acOffsetY_z","ol_acOffsetY_b","ol_slotKey_z","ol_slotKey_b"],e.skinName="RoleTestViewSkin",e.arr_rdm=new Array,e}return __extends(e,o),e.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.arr_rdm.push(this.cu_model0),this.arr_rdm.push(this.cu_model1),this.arr_rdm.push(this.cu_model2),this.arr_rdm.push(this.cu_model3),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide(),s.AppFacade.getInstance().showSubView(s.LoginMediator.N,s.LoginMediator.SV.BEFORE_LOGIN)},this),this.btn_change.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.changeAct()},this),this.btn_begin.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.begin()},this);for(var e=function(e){var t=new eui.EditableText;t.size=14,t.width=140,t.prompt=e,t.name=e,i.gp_input.addChild(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.curFocusET=t},i),t.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){this.setV(0)},i)},i=this,t=0,n=this.KEY;t<n.length;t++){e(n[t])}},e.prototype.setV=function(e){this.curFocusET?this.curMagicalId?s.Config.pack.t_magical[this.curMagicalId][this.curFocusET.name]=Number(this.curFocusET.text):Utils.MsgUtils.addMidMsg("当前模型没有指定神器"):Utils.MsgUtils.addMidMsg("请选中输入框")},e.prototype.reset=function(){},e.prototype.checkValid=function(){return!0},e.prototype.changeAct=function(){var i=this.actArr[++this.curActIndex%this.actArr.length];this.arr_rdm.forEach(function(e,t){e.curModelAct=i})},e.prototype.begin=function(){var i=this;if(this.checkValid()){if(this.et_shenqi.text){var e=s.Config.pack.t_magical;for(var t in e)if(e[t].ol_model==this.et_shenqi.text){this.curMagicalId=t;break}if(this.curMagicalId)for(var n=0,o=this.KEY;n<o.length;n++){var a=o[n],r=this.gp_input.getChildByName(a);r&&(s.Config.pack.t_magical[this.curMagicalId][a]&&(r.text=s.Config.pack.t_magical[this.curMagicalId][a]))}}this.arr_rdm.forEach(function(e,t){e.name=t.toString(),e.visible=!0,e.update({fashionModel:i.et_pf.text,titleModel:i.et_chenghao.text,magicalModel:i.et_shenqi.text,horseModel:i.et_zuoqi.text}),e.onChangingDir(i.dirArr[t])})}},e}(BaseView);s.RoleTestView=e,__reflect(e.prototype,"game.RoleTestView")}(game||(game={})),function(e){var t=function(a){function e(e){var t=a.call(this)||this;return t.clickTime=0,t.endCount=0,t.clock=0,t.commonT=350,t.disT=500,t.moveT=500,t.DrMT=200,t.invT=50,t.curMoveId=1,t.tweenArr=[],t.skinName="StartAnimationSkin",t.params=e,t}return __extends(e,a),e.prototype.childrenCreated=function(){var e=this;a.prototype.childrenCreated.call(this),this.lb_hint.visible=!1,this.initView(0,!1),this.timer&&(this.timer=void 0);var t=this.commonT+(this.moveT-this.DrMT),i=2*(this.moveT-this.DrMT)+4*this.disT+600,n=this.moveT+this.commonT,o=2*(this.moveT-this.DrMT)+this.moveT;this.timer=egret.setInterval(function(){if(++e.clock,(0<e.clickTime||(t+i+n+o+3400+4e3)/e.invT<=e.clock)&&++e.endCount,e.endCount<=0)switch(e.clock){case 10:e.curMoveId=1,e.gp1Animation();break;case(t+1e3)/e.invT:e.curMoveId=2,e.gp2Animation();break;case(t+i+2e3)/e.invT:e.curMoveId=3,e.gp3Animation();break;case(t+i+n+3e3)/e.invT:e.curMoveId=4,e.gp4Animation();break;case(t+i+n+o+4e3)/e.invT:e.curMoveId=5,e.gp5Animation()}else 80==e.endCount&&e.startGame(),10==e.endCount&&(e.lb_hint.visible=!0)},this,this.invT),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){2e3<=e.clock*e.invT&&(++e.clickTime,1==e.clickTime?(e.resetTweenAct(e.curMoveId),e.initView(1,!0),egret.Tween.get(e.lb_hint).to({visible:!0},500)):1<e.clickTime&&e.startGame())},this)},e.prototype.initView=function(e,t){for(var i=1;i<8;++i){var n=this["img_"+i];4!=i?n.visible=t:(n.scaleX=n.scaleY=1,n.alpha=e)}for(var o=0;o<13;++o){var a=this["img_fade_"+o];o<=3&&!t?a.visible=t:a.alpha=e}this.img_move_1.visible=t;for(var r=1;r<9;++r){var s=this["img_lb_"+r];s.scaleX=s.scaleY=1,s.alpha=e}},e.prototype.updateView=function(e){},e.prototype.resetTweenAct=function(e){if(2==this.curMoveId){var t=[536.21,380.36,289.11];for(var i in this.tweenArr){var n=this.tweenArr[i];egret.Tween.removeTweens(n)}for(var o=1;o<4;++o){var a=this["img_fade_"+o];a.alpha=1,a.visible=!0,a.x=t[o-1],UIActionManager.breathe(a)}}},e.prototype.gp1Animation=function(){var e=this;this.moveBySide(1,this.img_1,function(){e.showTips(e.img_lb_1,e.commonT)})},e.prototype.gp2Animation=function(){var o=this;this.moveBySide(-1,this.img_2,function(){o.moveBySide(-1,o.img_3,function(){var e=o.img_move_1.y;o.img_move_1.visible=!0,o.img_move_1.y=o.img_move_1.y+250,egret.Tween.get(o.img_move_1).to({y:e},o.disT).call(function(){o.shaking(o.img_move_1)}),o.showTips(o.img_lb_2,o.commonT,function(){egret.setTimeout(function(){var n=function(e,t,i){0<o.clickTime||o.moveBySide(1,e,function(){if(i&&i(),++t<=3){var e=o["img_fade_"+t];n(e,t,function(){UIActionManager.breathe(e)})}},!0)},e=o.img_fade_1;n(e,1,function(){o.tweenArr.push(e),o.showTips(o.img_lb_3,2*o.disT),UIActionManager.breathe(e)})},o,600)})})})},e.prototype.gp3Animation=function(){var e=this,t=this.img_4;t.alpha=0,t.scaleY=.5,t.scaleX=.5,egret.Tween.get(t).to({scaleY:1,scaleX:1,alpha:1},this.moveT).call(function(){e.showTips(e.img_lb_4,e.commonT,function(){})})},e.prototype.gp4Animation=function(){var i=this;this.moveBySide(-1,this.img_5,function(){i.moveBySide(-1,i.img_6,function(){i.showTips(i.img_lb_6,i.commonT);var e=i.img_fade_0;e.visible=!0,e.x=e.x-400;var t=e.x+400;egret.Tween.get(i.img_fade_0).to({x:t},800)})})},e.prototype.gp5Animation=function(e,i,n){var o=this;void 0===e&&(e=1500),void 0===i&&(i=500),void 0===n&&(n=200);var t=e,a=this.img_7;a.visible=!0;var r=a.y,s=this.img_fade_4.y;a.y+=400,this.img_fade_4.y+=400,this.img_fade_4.alpha=1,egret.Tween.get(this.img_lb_7).wait(this.moveT).call(function(){o.showTips(o.img_lb_7,o.commonT)}),egret.Tween.get(this.img_fade_4).to({y:s},t),egret.Tween.get(a).to({y:r},t).call(function(){var e=n,t=i;egret.Tween.get(o.img_fade_5).wait(t).to({alpha:1},o.commonT),egret.Tween.get(o.img_fade_6).wait(t+2*e).to({alpha:1},o.commonT),egret.Tween.get(o.img_fade_7).wait(t+3*e).to({alpha:1},o.commonT),egret.Tween.get(o.img_fade_8).wait(t+4*e).to({alpha:1},o.commonT).call(function(){o.showTips(o.img_lb_8,o.commonT+3*e),egret.Tween.get(o.img_fade_9).to({alpha:1},o.commonT),egret.Tween.get(o.img_fade_10).wait(e).to({alpha:1},o.commonT),egret.Tween.get(o.img_fade_11).wait(2*e).to({alpha:1},o.commonT),egret.Tween.get(o.img_fade_12).wait(3*e).to({alpha:1},o.commonT)})})},e.prototype.moveBySide=function(e,t,i,n,o){var a=t;a.visible=!0;var r=720*e;a.x=a.x+r;var s=a.x-r,c=this.moveT;n?egret.Tween.get(a).to({x:s},c).call(function(){i&&i()}):egret.Tween.get(a).to({x:s-100},c-this.DrMT).call(function(){i&&i()}).to({x:s},this.DrMT,egret.Ease.backOut)},e.prototype.myFadeInOrOut=function(e,t,i,n){var o=e;o.alpha=1-t,egret.Tween.get(o).to({alpha:t},i,egret.Ease.backOut).call(function(){n&&n()})},e.prototype.showTips=function(e,t,i){e.alpha=0,e.scaleY=.5,e.scaleX=.5,egret.Tween.get(e).to({scaleY:1,scaleX:1,alpha:1},t).call(function(){i&&i()})},e.prototype.shaking=function(e){var t=this,i=e.y;egret.Tween.get(e).to({y:i+5},700).to({y:i},700).call(function(){t.shaking(e)})},e.prototype.startGame=function(){this.hide(),this.params&&this.params.cb&&this.params.cb()},e.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},e}(BasePanel);e.StartAnimation=t,__reflect(t.prototype,"game.StartAnimation")}(game||(game={})),function(e){var t=function(n){function e(e){var t=n.call(this)||this;return t.skinName="UpdateLogPanelSkin",t.params=e,t}return __extends(e,n),e.prototype.onDestroy=function(){n.prototype.onDestroy.call(this)},e.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.sl_content.horizontalScrollBar.autoVisibility=!1,this.sl_content.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_content.scrollPolicyV=eui.ScrollPolicy.AUTO,this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this);for(var e=1;e<=9;e++){var t="common_gg_0"+e+"_png";if(RES.hasRes(t)){var i=new eui.Image;i.source=t,this.gp_content.addChild(i)}}},e}(BasePanel);e.UpdateLogPanel=t,__reflect(t.prototype,"game.UpdateLogPanel")}(game||(game={})),function(C){var e=function(t){function e(){var e=t.call(this)||this;return e.btnPressed=!1,e.skinName="MailInfoSkin",e.mailProxy=C.AppFacade.getInstance().retrieveProxy(C.MailPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.reward_items=new Array,this.commonXiaoTanChuKuang.onCloseCB=function(){C.AppFacade.getInstance().hideSubView(C.MailMediator.N,C.MailMediator.SV.INFO)},this.img_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btnPressed=!0,Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),e.uuid&&e.mailProxy.readMail({uuid:e.uuid}),C.AppFacade.getInstance().hideSubView(C.MailMediator.N,C.MailMediator.SV.INFO)},this),this.img_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),e.uuid&&e.mailProxy.readMail({uuid:e.uuid},function(){e.img_get.visible=!1,e.img_yilingqu.visible=!0})},this)},e.prototype.updateView=function(e){var t=e.uuid;if(null!=t){this.uuid=t;var i,n,o=this.mailProxy.mailList[t],a=new Date(1e3*o.sendTime),r=C.Config.mailConfig()[o.key],s=o.getContentTextFlow(),c=a.getMonth()+1,l=a.getDate();if(i=c<10?"0"+c:""+c,n=l<10?"0"+l:""+l,this.lb_time.textFlow=new Array({text:"系统管理员\n",style:{textColor:7295027,size:18,bold:!0}},{text:"\n"},{text:i+"月"+n+"日  剩余"+Math.floor((o.expireTime-Utils.TimerManager.getServerTime())/86400)+"天",style:{textColor:7295027,size:18,bold:!0}}),35==r.key){s.push({text:"\n"});var h="        vip客服QQ: "+Utils.agentConfig.other.vipQQ;s.push({text:h,style:{}})}if(this.lb_tip.text=r.theme,this.lb_title.textFlow=s,"{}"==o.attachs)this.img_get.visible=!1,this.img_ok.visible=!0,this.img_yilingqu.visible=!1,this.sl_reward.visible=!1;else{this.gp_rewards=new eui.Group;var p=new eui.HorizontalLayout;p.verticalAlign=egret.VerticalAlign.MIDDLE,p.horizontalAlign=egret.HorizontalAlign.CENTER,this.gp_rewards.layout=p,this.sl_reward.viewport=this.gp_rewards,this.sl_reward.scrollPolicyV=eui.ScrollPolicy.OFF,this.sl_reward.visible=!0,this.img_get.visible=!0,this.img_yilingqu.visible=!1,this.img_ok.visible=!1}for(var d=0,u=this.reward_items;d<u.length;d++){var g=u[d];g&&g.parent&&g.parent.removeChild(g)}for(var f=JSON.parse(o.attachs),_=0,m=f;_<m.length;_++){var y=m[_],v=customui.BaseItemFactory.create(21);v.updateData({type:y[0],code:y[1],num:y[2]}),v.scaleX=v.scaleY=.85,this.reward_items.push(v),this.gp_rewards.addChild(v)}var T=f.length;o.status==EMailStatus.EMailStatusRead?(this.img_yilingqu.visible=!("{}"==o.attachs),this.img_get.visible=!1,this.img_ok.visible=!1):T&&(this.img_get.visible=!0,this.img_yilingqu.visible=!1,this.img_ok.visible=!1)}else this.log("uuid == undefined")},e.prototype.perClose=function(){if(!this.btnPressed&&this.uuid&&this.reward_items.length<=0){var e=this.mailProxy.mailList[this.uuid];e&&e.status==EMailStatus.EMailStatusUnread&&this.mailProxy.readMail({uuid:e.uuid})}},e}(BasePanel);C.MailInfo=e,__reflect(e.prototype,"game.MailInfo")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.FIXED_SLIDE_DURATION=200,e.FIXED_PAUSE_TIME=20,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.slideDuration=0},e.prototype.setAddTimes=function(t,i,n){var o=this;return new Promise(function(e){o.addTimes(t,n,function(){null!=i&&i!=o.maximum?o.setBarValue(i,function(){e()}):e()})})},e.prototype.setAddValueWithInterval=function(t,i,n){var o=this;return new Promise(function(e){o.addValueWithInterval(t,i,n,function(){e()})})},e.prototype.setDuration=function(e){this.FIXED_SLIDE_DURATION=e},e.prototype.setPauseTime=function(e){this.FIXED_PAUSE_TIME=e},e.prototype.addTimes=function(e,t,i){var n=this;0!=e?this.setBarValue(this.maximum,function(){n.addTimes(e-1,t,i),t&&t()}):i&&i()},e.prototype.addValueWithInterval=function(e,t,i,n){var o=this;e<t&&(t=e),0<e?this.setBarValue(this.value+t,function(){o.addValueWithInterval(e-t,t,i,n),i&&i(t)}):n&&n()},e.prototype.setBarValue=function(e,t){var i=this;this.value==this.maximum&&this.resetProgress(),e>this.maximum?egret.Tween.get(this).to({value:this.maximum},this.getDuration(this.maximum-this.value)).call(function(){i.setBarValue(e-i.maximum,t)}):egret.Tween.get(this).to({value:e},this.getDuration(e-this.value)).wait(this.FIXED_PAUSE_TIME).call(function(){t&&t()})},e.prototype.getDuration=function(e){return e/this.maximum*this.FIXED_SLIDE_DURATION},e.prototype.resetProgress=function(){this.value=0},e}(eui.ProgressBar);e.SpecialProgressBar=t,__reflect(t.prototype,"customui.SpecialProgressBar")}(customui||(customui={})),function(i){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new n).register()},e}();i.MailProcessor=e,__reflect(e.prototype,"game.MailProcessor");var t=function(e){function t(){return e.call(this,"mail.NewMailP",t)||this}return __extends(t,e),t.prototype.execute=function(e){if(this.checkCB(e.getBody())){this.log("NewMailP 下推新邮件");var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.MailPy.N).updateMailList([t.newMail])}},t}(i.ProcessorBase);i.NewMailP=t,__reflect(t.prototype,"game.NewMailP");var n=function(e){function t(){return e.call(this,"mail.AutoDelMailP",t)||this}return __extends(t,e),t.prototype.execute=function(e){if(this.checkCB(e.getBody())){this.log("AutoDelMailP 下推自动删除邮件");var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.MailPy.N).deleteMail(t.delList)}},t}(i.ProcessorBase);i.AutoDelMailP=n,__reflect(n.prototype,"game.AutoDelMailP")}(game||(game={})),function(o){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.mailList={},e.addNotice(),e}return __extends(i,t),i.prototype.addNotice=function(){NoticeManager.registerCB(NT.MAIL,this.checkMailNotice,this)},i.prototype.updateMailList=function(e){for(var t in e){var i=e[t];if(this.mailList[i.uuid])this.mailList[i.uuid].update(i);else{var n=new o.MailVO(i);this.mailList[i.uuid]=n}}o.AppFacade.getInstance().updateView(o.MailMediator.N,o.MailMediator.SV.MAIN),NoticeManager.updateNotice(NT.MAIL)},i.prototype.deleteMail=function(e){var i=this;e.forEach(function(e,t){i.mailList[e]&&delete i.mailList[e]}),o.AppFacade.getInstance().updateView(o.MailMediator.N,o.MailMediator.SV.MAIN)},i.prototype.getMailList=function(t,i){var n=this;Utils.Socket.send("mail","GetMailList",{}).then(function(e){n.updateMailList(e.mailList),t&&t(e,i)}).catch(function(e){})},i.prototype.readMail=function(e,t,i){var n=this;void 0===e&&(e={uuid:""}),Utils.Socket.send("mail","ReadMail",e).then(function(e){o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N).handleClientReward(e.clientReward,2),n.updateMailList(e.mailList),t&&t()}).catch(function(e){})},i.prototype.delMail=function(e,t,i){var n=this;void 0===e&&(e={uuid:""}),Utils.Socket.send("mail","DelMail",e).then(function(e){n.deleteMail(e.delList),t&&t(e,i)}).catch(function(e){})},i.prototype.checkMailNotice=function(){for(var e in this.mailList)if(0==this.mailList[e].status)return!0;return!1},i.N="MailProxy",i}(BaseProxy);o.MailPy=e,__reflect(e.prototype,"game.MailPy")}(game||(game={})),function(_){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="MailUISkin",e.mailProxy=_.AppFacade.getInstance().retrieveProxy(_.MailPy.N),e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.commonDaTanKuang.blb_title.font="common_title_fnt",this.initUI(),this.initButton(),this.initList(),this.addNotice()},e.prototype.initUI=function(){this.commonDaTanKuang.blb_title.text="邮件"},e.prototype.initButton=function(){var e=this;this.commonDaTanKuang.onCloseCB=function(){e.hide()},this.img_get_auto.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),this.mailProxy.readMail()},this),this.img_delete_auto.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),this.mailProxy.delMail()},this)},e.prototype.initList=function(){var e=new eui.VerticalLayout;e.verticalAlign=egret.VerticalAlign.MIDDLE,e.horizontalAlign=egret.HorizontalAlign.CENTER,e.gap=15,e.paddingTop=10,this.list_item.layout=e,this.list_item.itemRenderer=i},e.prototype.addNotice=function(){},e.prototype.updateView=function(e){var t=new Array,i=this.mailProxy.mailList,n=!1;for(var o in this.getNum=0,i){var a=i[o];t.push(i[o]),n||a.status!=EMailStatus.EMailStatusUnread||(n=!0,this.getNum++)}t.sort(function(e,t){var i=JSON.parse(e.attachs).length,n=JSON.parse(t.attachs).length;return e.status==EMailStatus.EMailStatusUnread&&t.status==EMailStatus.EMailStatusRead?-1:t.status==EMailStatus.EMailStatusUnread&&e.status==EMailStatus.EMailStatusRead?1:e.sendTime<t.sendTime?1:t.sendTime<e.sendTime?-1:0<i&&0==n?-1:0==i&&0<n?1:void 0});for(var r=0;r<t.length;r++)t[r].index=r;this.list_item.dataProvider=new eui.ArrayCollection(t);var s=!1;for(var o in i)if(i[o]){s=!0;break}s&&0<this.getNum?(this.img_get_auto.enabled=!0,UIActionManager.setAbsGrey(this.img_get_auto,!1)):(this.img_get_auto.enabled=!1,UIActionManager.setAbsGrey(this.img_get_auto)),this.gp_empty.visible=!s;var c=_.Config.constConfig().maxMailNum.constValue;this.lb_tip.text="邮箱可容纳"+c+"封邮件，请注\n意收取哦("+t.length+"/"+c+")",this.lb_tip.textFlow=new Array({text:t.length+"/"+c,style:{textColor:5385490,size:18}},{text:"   ",style:{textColor:16777215,size:18}},{text:"邮箱可容纳"+c+"封邮件，请注意查收",style:{textColor:5385490,size:18}})},e}(BasePanel);_.MailUI=e,__reflect(e.prototype,"game.MailUI");var i=function(t){function e(){var e=t.call(this)||this;return e.mailProxy=_.AppFacade.getInstance().retrieveProxy(_.MailPy.N),e.backpackProxy=_.AppFacade.getInstance().retrieveProxy(_.BackpackPy.N),e.reward_items=new Array,e.skinName="CommonItemRenderMailSkin",e.initList(),e.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),this.data&&this.mailProxy.readMail({uuid:this.data.uuid})},e),e.gp_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),this.data&&_.AppFacade.getInstance().showSubView(_.MailMediator.N,_.MailMediator.SV.INFO,{uuid:this.data.uuid})},e),e}return __extends(e,t),e.prototype.initList=function(){},e.prototype.dataChanged=function(){var e=_.Config.mailConfig()[this.data.key];if(e){this.scaleX=this.scaleY=.98;var t=new Date(1e3*this.data.sendTime),i=this.data;this.btn_go.visible=!1,i.status==EMailStatus.EMailStatusUnread&&"{}"==i.attachs&&(this.btn_go.visible=!0),this.lb_info.text=t.getMonth()+1+"月 "+t.getDate()+"日   "+e.theme;var n=new Array;n=i.getContentTextFlow();var o=new Array;for(var a in n)o.push(n[a].text);var r=o.join("");this.lb_content.text=r,this.lb_hint.text="剩余"+Math.floor((this.data.expireTime-Utils.TimerManager.getServerTime())/86400)+"天",30<this.lb_content.text.length&&(this.lb_content.text=this.lb_content.text.substr(0,30)+"...");for(var s=0,c=this.reward_items;s<c.length;s++){(a=c[s])&&a.parent&&a.parent.removeChild(a)}for(var l=JSON.parse(this.data.attachs),h=0,p=0,d=l;p<d.length;p++){var u=d[p],g=customui.BaseItemFactory.create(11);g.updateData({type:u[0],code:u[1],num:u[2]}),g.y=8,g.x=0+h++*(g.width+30)*.4,g.scaleX=.4,g.scaleY=.4,this.reward_items.push(g),this.gp_reward.addChild(g)}var f=l.length;this.img_flag.visible=0<f,this.btn_go.visible=0<f&&this.data.status==EMailStatus.EMailStatusUnread,this.btn_lingqu.visible=0<f&&this.data.status==EMailStatus.EMailStatusRead,this.data.status==EMailStatus.EMailStatusRead?(UIActionManager.setAbsGrey(this.gp_root),this.img_head_bg.source="common_icon_youjian_002_png"):(UIActionManager.setAbsGrey(this.gp_root,!1),this.img_head_bg.source="common_icon_youjian_001_png"),this.gp_reward.visible=!1}},e}(eui.ItemRenderer);_.MailItem=i,__reflect(i.prototype,"game.MailItem")}(game||(game={})),function(v){var e=function(){function e(){}return e.VIEW_GROUP_ORDER={CITY:{TOP:["common_icon_yaoqingyouli_png","common_icon_jingcaihuodong_png","common_icon_xianshihuodong_png","common_icon_denglulibao_png","common_icon_hefuhuodon_png","common_icon_qingminghuodong_png","common_icon_liuyihuodong_png","common_icon_kaixuehuodong_png","common_icon_shuqihuodong_png","common_icon_queqiaoqiyuan_png","common_icon_zhongqiu_png"],RIGHT:["common_icon_xuyuanzhuanpan_png","common_icon_meirihaoli_png","common_icon_chaozhilibao_png","common_icon_shouchonglibao_png","common_icon_guanzhu_png","common_icon_shoucangyouli_png","common_icon_viptequan_png","huodong_icon_xingqubuluo_png","common_icon_shimingrenzheng_png","common_icon_weiduanxiazai_png","sdk_custom1_cb","common_icon_yiyuanlingqu_png","common_icon_xinchunhesui_png","common_icon_zunxianglibao_png","common_icon_zhanqujingpai_png","common_icon_jingxibaoxiang_png","_main_m_json.maoxian_icon_msrq02","common_icon_tehuijinka_png","common_icon_fulihuikui_png","common_icon_yiyuanlingquNew_png","common_icon_meiribuji_png","common_icon_tehuihuikui_png","common_icon_zhuanshutouxiang_png","common_icon_pifulibao_png","wanba_icon_chongzhipaihang_png"],RIGHT2:["common_icon_jinrihuodong_png","common_icon_hongbao_png","huodong_icon_qqhuangzuantequan_png"],LEFT:["_btn_lb_m_json.common_icon_fenxiang"],LEFT_BOTTOM:["common_icon_chongwu_png","common_icon_yinghunwangshi_png","common_icon_zhujue_png","common_icon_zuoqi_png"]},GUAJI:{TOP:[],RIGHT:[],RIGHT2:[],LEFT:[],LEFT_BOTTOM:[]}},e.TOP_BTN_CONFIG=[{img:"common_icon_yaoqingyouli_png",noticeType:void 0,unlockModule:MODULE.Activity+EActivityType.InvitationCode,isOpenCheck:function(){return v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).isOpen(EActivityType.InvitationCode)},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.InvitationCode)}},{img:"common_icon_jingcaihuodong_png",noticeType:NT.ACTIVITY_ENTRANCE[ACTIVITY_ENTRANCE.JINGCAI],unlockModule:void 0,isOpenCheck:function(){var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.JINGCAI),i=!1;return e.forEach(function(e){t.isOpen(e.id)&&(i=!0)}),i},clickFunc:function(){v.AppFacade.getInstance().showSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.JINGCAI})}},{img:"common_icon_xianshihuodong_png",noticeType:NT.ACTIVITY_ENTRANCE[ACTIVITY_ENTRANCE.ACTIVITY],unlockModule:void 0,isOpenCheck:function(){var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.ACTIVITY),i=!1;return e.forEach(function(e){t.isOpen(e.id)&&(i=!0)}),i},clickFunc:function(){v.AppFacade.getInstance().showSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.ACTIVITY})},updateId:["bm_time"],updateFunc:function(e){var o=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"bm_time":var t=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.ACTIVITY),i=0;if(t.forEach(function(e){if(o.isOpen(e.id)){var t=v.ActivityConfig.getActivityEndDt(e.id);i<t&&(i=t)}}),i&&0!=i){var n=i-v.GameMgr.getInstance().serverTime();e.text=Utils.TimerManager.getFormatBySecond2(n)}else e.text=""}})}},{img:"common_icon_denglulibao_png",noticeType:NT.ALL_ACTIVITY[EActivityType.DailyLogin],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.DailyLogin]},unlockModule:void 0,isOpenCheck:function(){var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.DailyLogin];if(!e||!e.data)return!1;var t=JSON.parse(e.content),n=e.data.targeted,o=e.data.key||0,a=(e.data.day,!0);return t.forEach(function(e){var t=e[0],i=REWARD_STATUS.UNAVAILABLE;n.some(function(e){return e.id==t&&0<e.num})?i=REWARD_STATUS.RECEIVED:o>=e[1]&&(i=REWARD_STATUS.AVAILABLE),i!=REWARD_STATUS.AVAILABLE&&i!=REWARD_STATUS.UNAVAILABLE||(a=!1)}),!a},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.DailyLogin)},updateId:["bm_time"],updateFunc:function(e){v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"bm_time":var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.DailyLogin];if(!t||!t.data)return!1;var i=v.ActivityConfig.getActivityEndDt(EActivityType.DailyLogin);if(i&&0!=i){var n=i-v.GameMgr.getInstance().serverTime();e.text=Utils.TimerManager.getFormatBySecond2(n)}}})}},{img:"common_icon_hefuhuodon_png",noticeType:NT.ACTIVITY_ENTRANCE[ACTIVITY_ENTRANCE.HEFU],unlockModule:void 0,isOpenCheck:function(){var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HEFU),i=!1;return e.forEach(function(e){t.isOpen(e.id)&&(i=!0)}),i},clickFunc:function(){v.AppFacade.getInstance().showSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.HEFU})},updateId:["btn","bm_time"],updateFunc:function(e){var o=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"btn":break;case"bm_time":var t=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HEFU),i=0;if(t.forEach(function(e){if(o.isOpen(e.id)){var t=v.ActivityConfig.getActivityEndDt(e.id);i<t&&(i=t)}}),i&&0!=i){var n=i-v.GameMgr.getInstance().serverTime();e.text=Utils.TimerManager.getFormatBySecond2(n)}else e.text=""}})}},{img:"common_icon_qingminghuodong_png",noticeType:NT.ACTIVITY_ENTRANCE[ACTIVITY_ENTRANCE.HOLIDAY],unlockModule:void 0,isOpenCheck:function(){var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HOLIDAY),i=!1;return e.forEach(function(e){t.isOpen(e.id)&&(i=!0)}),i},clickFunc:function(){v.AppFacade.getInstance().showSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.HOLIDAY})},updateId:["btn","bm_time"],updateFunc:function(e){var c=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"btn":var t=v.Config.activityConfigs(),i="";for(var n in t){var o=t[n];0==o.id&&(i=JSON.parse(o.img_icon)[0])}i=v.GeneralConfig.getGuajiImg(i)[1],e.icon!=i&&(e.icon=i);break;case"bm_time":var a=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HOLIDAY),r=0;if(a.forEach(function(e){if(c.isOpen(e.id)){var t=v.ActivityConfig.getActivityEndDt(e.id);r<t&&(r=t)}}),r&&0!=r){var s=r-v.GameMgr.getInstance().serverTime();e.text=Utils.TimerManager.getFormatBySecond2(s)}else e.text=""}})}},{img:"common_icon_liuyihuodong_png",noticeType:NT.ACTIVITY_ENTRANCE[ACTIVITY_ENTRANCE.HOLIDAY2],unlockModule:void 0,isOpenCheck:function(){var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HOLIDAY2),i=!1;return e.forEach(function(e){t.isOpen(e.id)&&(i=!0)}),i},clickFunc:function(){v.AppFacade.getInstance().showSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.HOLIDAY2})},updateId:["btn","bm_time"],updateFunc:function(e){var c=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"btn":var t=v.Config.activityConfigs(),i="";for(var n in t){var o=t[n];0==o.id&&(i=JSON.parse(o.img_icon)[1])}i=v.GeneralConfig.getGuajiImg(i)[1],e.icon!=i&&(e.icon=i);break;case"bm_time":var a=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HOLIDAY2),r=0;if(a.forEach(function(e){if(c.isOpen(e.id)){var t=v.ActivityConfig.getActivityEndDt(e.id);r<t&&(r=t)}}),r&&0!=r){var s=r-v.GameMgr.getInstance().serverTime();e.text=Utils.TimerManager.getFormatBySecond2(s)}else e.text=""}})}},{img:"common_icon_kaixuehuodong_png",noticeType:NT.ACTIVITY_ENTRANCE[ACTIVITY_ENTRANCE.HOLIDAY3],unlockModule:void 0,isOpenCheck:function(){var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HOLIDAY3),i=!1;return e.forEach(function(e){t.isOpen(e.id)&&(i=!0)}),i},clickFunc:function(){v.AppFacade.getInstance().showSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.HOLIDAY3})},updateId:["btn","bm_time"],updateFunc:function(e){var c=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"btn":var t=v.Config.activityConfigs(),i="";for(var n in t){var o=t[n];0==o.id&&(i=JSON.parse(o.img_icon)[2]||"")}i=v.GeneralConfig.getGuajiImg(i)[1],e.icon!=i&&(e.icon=i);break;case"bm_time":var a=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HOLIDAY3),r=0;if(a.forEach(function(e){if(c.isOpen(e.id)){var t=v.ActivityConfig.getActivityEndDt(e.id);r<t&&(r=t)}}),r&&0!=r){var s=r-v.GameMgr.getInstance().serverTime();e.text=Utils.TimerManager.getFormatBySecond2(s)}else e.text=""}})}},{img:"common_icon_shuqihuodong_png",noticeType:NT.ACTIVITY_ENTRANCE[ACTIVITY_ENTRANCE.HOLIDAY4],unlockModule:void 0,isOpenCheck:function(){var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HOLIDAY4),i=!1;return e.forEach(function(e){t.isOpen(e.id)&&(i=!0)}),i},clickFunc:function(){v.AppFacade.getInstance().showSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.HOLIDAY4})},updateId:["btn","bm_time"],updateFunc:function(e){var c=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"btn":var t=v.Config.activityConfigs(),i="";for(var n in t){var o=t[n];0==o.id&&(i=JSON.parse(o.img_icon)[3]||"")}i=v.GeneralConfig.getGuajiImg(i)[1],e.icon!=i&&(e.icon=i);break;case"bm_time":var a=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HOLIDAY4),r=0;if(a.forEach(function(e){if(c.isOpen(e.id)){var t=v.ActivityConfig.getActivityEndDt(e.id);r<t&&(r=t)}}),r&&0!=r){var s=r-v.GameMgr.getInstance().serverTime();e.text=Utils.TimerManager.getFormatBySecond2(s)}else e.text=""}})}},{img:"common_icon_queqiaoqiyuan_png",noticeType:NT.ALL_ACTIVITY[EActivityType.MagpieActivity],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.MagpieActivity]},unlockModule:void 0,isOpenCheck:function(){return v.GameMVC.activityPy.isOpen(EActivityType.MagpieActivity)},clickFunc:function(){},updateId:["bm_time"],updateFunc:function(e){v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"bm_time":var t=v.ActivityConfig.getActivityEndDt(EActivityType.MagpieActivity)-Utils.TimerManager.getServerTime();e.text=""+Utils.TimerManager.getFormatBySecond2(t)}})}},{img:"common_icon_zhongqiu_png",noticeType:NT.ALL_ACTIVITY[EActivityType.MidAutumn],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.MidAutumn]},unlockModule:void 0,isOpenCheck:function(){return v.GameMVC.activityPy.isOpen(EActivityType.MidAutumn)},clickFunc:function(){v.MainJumpConfig.jumpTo(MODULE.Activity+EActivityType.MidAutumn)},updateId:["bm_time"],updateFunc:function(e){v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"bm_time":var t=v.ActivityConfig.getActivityEndDt(EActivityType.MidAutumn)-Utils.TimerManager.getServerTime();e.text=""+Utils.TimerManager.getFormatBySecond2(t)}})}}],e.TOP_RIGHT_BTN_CONFIG=[{img:"common_icon_xuyuanzhuanpan_png",noticeType:NT.LUCKY_TABLE,unlockModule:MODULE.LuckyTurntable,isOpenCheck:function(){return!(Utils.SDKMgr.getPerformConfig(1)&&Utils.SDKMgr.getPerformConfig(21))},clickFunc:function(){v.MainJumpConfig.jumpTo(MODULE.LuckyTurntable)}},{img:"common_icon_tehuijinka_png",noticeType:NT.ACTIVITY_EnjoyCard1,isOpenCheck:function(){return v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).isOpen(EActivityType.EnjoyCard1)},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.EnjoyCard1)}},{img:"common_icon_meirihaoli_png",noticeType:void 0,unlockModule:void 0,trueNoticeType:function(){for(var e=EActivityType.DailyLuxuryGifts,t=[EActivityType.DailyLuxuryGifts,EActivityType.DailyLuxuryGifts1,EActivityType.DailyLuxuryGifts2,EActivityType.DailyLuxuryGifts3,EActivityType.DailyLuxuryGifts4],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),n=0;n<t.length;n++)if(i.isOpen(t[n])){e=t[n];break}return NT.ALL_ACTIVITY[e]},scale:1,isOpenCheck:function(){for(var e=EActivityType.DailyLuxuryGifts,t=[EActivityType.DailyLuxuryGifts,EActivityType.DailyLuxuryGifts1,EActivityType.DailyLuxuryGifts2,EActivityType.DailyLuxuryGifts3,EActivityType.DailyLuxuryGifts4],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),n=0;n<t.length;n++)if(i.isOpen(t[n])){e=t[n];break}var o=i.allActivityData[e];if(o&&o.data&&v.ActivityConfig.Config[e]){var a=o.data.targeted,r=o.content,s=o.data.key,c=o.data.day,l=[];for(var h in r){(p=r[h])[0]==c&&l.push(p)}if(!l.length)return[];for(v.AppFacade.getInstance().retrieveProxy(v.RechargePy.N).goodList,n=0;n<l.length;n++){(p=l[n])[0];var p,d=p[1],u=p[2],g=(p[3],REWARD_STATUS.GO_RECHARGE);u<=s&&(g=REWARD_STATUS.AVAILABLE);var f=!1;for(var h in a){if(a[h].id==d){f=!0;break}}if(f&&(g=REWARD_STATUS.RECEIVED),g==REWARD_STATUS.AVAILABLE||g==REWARD_STATUS.GO_RECHARGE)return!0}return!1}},clickFunc:function(){for(var e=EActivityType.DailyLuxuryGifts,t=[EActivityType.DailyLuxuryGifts,EActivityType.DailyLuxuryGifts1,EActivityType.DailyLuxuryGifts2,EActivityType.DailyLuxuryGifts3,EActivityType.DailyLuxuryGifts4],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),n=0;n<t.length;n++)if(i.isOpen(t[n])){e=t[n];break}v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(e,{code:e})}},{img:"common_icon_chaozhilibao_png",noticeType:void 0,unlockModule:void 0,scale:1,isOpenCheck:function(){var n=!1,e=v.GameMVC.activityPy.allActivityData[EActivityType.BasicHeroGifts],o=Utils.TimerManager.getServerTime();if(e&&e.endDt>o&&e.data&&e.data.gifts&&0<e.data.gifts.length)n=!0;else{if(!(e=v.GameMVC.activityPy.allActivityData[EActivityType.TriggerGifts])||!e.data)return!1;var t=JSON.parse(e.data.gifts),a=JSON.parse(e.content),r=0;t.forEach(function(e){for(var t in a[0]){var i=a[0][t];i[0]==e.code&&(r=i[3])}!e.buyDt&&o<e.triggerDt+r&&(n=!0)})}return n},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.TriggerGifts)}},{img:"common_icon_zhuanshutouxiang_png",noticeType:NT.ALL_ACTIVITY[EActivityType.QqzoneOpenServerRecharge],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.QqzoneOpenServerRecharge]},unlockModule:void 0,scale:1,isOpenCheck:function(){return v.GameMVC.activityPy.isOpen(EActivityType.QqzoneOpenServerRecharge)&&"QQVip"==getUrlKV().channel&&0<getUrlKV().QQVipLevel},clickFunc:function(){v.MainJumpConfig.jumpTo(MODULE.Activity+EActivityType.QqzoneOpenServerRecharge)}},{img:"common_icon_shouchonglibao_png",noticeType:NT.ALL_ACTIVITY[EActivityType.FirstRecharge1],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.FirstRecharge1]},unlockModule:void 0,effect:"common_qiriicon",isOpenCheck:function(){var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.FirstRecharge1];if(e&&e.data){for(var t=JSON.parse(e.content),i=(JSON.parse(e.data.rechargeTargeted),e.data.rewardTargeted,e.data.key,!1),n=0;n<=3;n++)for(var o=0;o<3;o++){var a=t[3*n+o],r=a[0],s=(a[1],a[2]),c=a[4],l=e.data.key,h=e.data.rewardTargeted,p=JSON.parse(e.data.rechargeTargeted),d=REWARD_STATUS.UNAVAILABLE;s<=l&&(d=REWARD_STATUS.AVAILABLE),0<=h.indexOf(r)&&(d=REWARD_STATUS.RECEIVED);var u=0;for(var g in p){var f=p[g];f[0]==s&&(u=f[1])}if(u<c&&(d=REWARD_STATUS.UNAVAILABLE),d!=REWARD_STATUS.RECEIVED){i=!0;break}}return i}},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.FirstRecharge1)}},{img:"common_icon_yiyuanlingqu_png",noticeType:NT.ALL_ACTIVITY[EActivityType.OneYuanGifts],trueNoticeType:function(){for(var e=EActivityType.OneYuanGifts,t=[EActivityType.OneYuanGifts],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),n=0;n<t.length;n++)if(i.isOpen(t[n])){e=t[n];break}return NT.ALL_ACTIVITY[e]},unlockModule:MODULE.Activity+EActivityType.OneYuanGifts,effect:"common_qiriicon",isOpenCheck:function(){for(var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),t=EActivityType.OneYuanGifts,i=[EActivityType.OneYuanGifts],n=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),o=0;o<i.length;o++)if(n.isOpen(i[o])){t=i[o];break}var a=e.allActivityData[t];if(a&&a.data){var r=a.data.targeted,s=a.content,c=(a.data.key,a.data.day),l=[];for(var h in s){(p=s[h])[0]==c&&l.push(p)}if(!l.length)return[];for(o=0;o<l.length;o++){(p=l[o])[0];var p,d=p[1],u=(p[2],p[3],p[4],!1);for(var h in r){if(r[h].id==d){u=!0;break}}if(u)return!1}return!0}},clickFunc:function(){for(var e=EActivityType.OneYuanGifts2,t=[EActivityType.OneYuanGifts],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),n=0;n<t.length;n++)if(i.isOpen(t[n])){e=t[n];break}v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(e,{code:e})}},{img:"common_icon_yiyuanlingquNew_png",noticeType:NT.ALL_ACTIVITY[EActivityType.NewOneYuanGifts],trueNoticeType:function(){for(var e=EActivityType.NewOneYuanGifts,t=[EActivityType.NewOneYuanGifts],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),n=0;n<t.length;n++)if(i.isOpen(t[n])){e=t[n];break}return NT.ALL_ACTIVITY[e]},unlockModule:MODULE.Activity+EActivityType.NewOneYuanGifts,effect:"common_qiriicon",isOpenCheck:function(){for(var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),t=EActivityType.NewOneYuanGifts,i=[EActivityType.NewOneYuanGifts],n=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),o=0;o<i.length;o++)if(n.isOpen(i[o])){t=i[o];break}var a=e.allActivityData[t];if(a&&a.data){var r=a.data.targeted,s=a.content,c=(a.data.key,a.data.day);c>s.length&&(c=s.length);var l=[];for(var h in s){(p=s[h])[0]==c&&l.push(p)}if(!l.length)return[];for(o=0;o<l.length;o++){(p=l[o])[0];var p,d=p[1],u=(p[2],p[3],p[4],!1);for(var h in r){if(r[h].id==d){u=!0;break}}if(u)return!1}return!0}},clickFunc:function(){for(var e=EActivityType.NewOneYuanGifts,t=[EActivityType.NewOneYuanGifts],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),n=0;n<t.length;n++)if(i.isOpen(t[n])){e=t[n];break}v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(e,{code:e})}},{img:"common_icon_meiribuji_png",noticeType:NT.ALL_ACTIVITY[EActivityType.FifthOpenServerRecharge],trueNoticeType:function(){for(var e=EActivityType.FifthOpenServerRecharge,t=[EActivityType.FifthOpenServerRecharge,EActivityType.FifthOpenServerRecharge1,EActivityType.FifthOpenServerRecharge2,EActivityType.FifthOpenServerRecharge3],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),n=0;n<t.length;n++)if(i.isOpen(t[n])){e=t[n];break}return NT.ALL_ACTIVITY[e]},unlockModule:MODULE.Activity+EActivityType.FifthOpenServerRecharge,isOpenCheck:function(){for(var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),t=EActivityType.FifthOpenServerRecharge,i=[EActivityType.FifthOpenServerRecharge,EActivityType.FifthOpenServerRecharge1,EActivityType.FifthOpenServerRecharge2,EActivityType.FifthOpenServerRecharge3],n=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),o=0;o<i.length;o++)if(n.isOpen(i[o])){t=i[o];break}var a=e.allActivityData[t];if(a&&a.data){var c,r=a.content,l=a.data.amount,h=JSON.parse(a.data.targeted),s=a.data.curCycle||1;for(var p in r[1]){var d=r[1][p];if(d[0]==s){c=d[1];break}}if(!c)return[];var u=[],g=1,f=function(e){var t=c[e],i=t[1],n=t[2],o=t[3]||1,a=REWARD_STATUS.AVAILABLE;-1!=h.indexOf(t[0])?a=REWARD_STATUS.RECEIVED:l<i&&(a=REWARD_STATUS.GO_RECHARGE);EActivityType.FourthOpenServerRecharge,EActivityType.FourthOpenServerRecharge1,EActivityType.FourthOpenServerRecharge2,EActivityType.FourthOpenServerRecharge3;var r={id:i,rewards:n,status:a,targetAmount:i};if(g<o){var s=!0;if(u.forEach(function(e){e.status!=REWARD_STATUS.RECEIVED&&(s=!1)}),!s)return"break";if(!c[parseInt(e)+1])return u.push(r),"break";g=o,u.splice(0,u.length),u.push(r)}else u.push(r)};for(var _ in c){if("break"===f(_))break}var m=!1;return u.forEach(function(e){e.status!=REWARD_STATUS.AVAILABLE&&e.status!=REWARD_STATUS.GO_RECHARGE||(m=!0)}),m}},clickFunc:function(){for(var e=EActivityType.FifthOpenServerRecharge,t=[EActivityType.FifthOpenServerRecharge,EActivityType.FifthOpenServerRecharge1,EActivityType.FifthOpenServerRecharge2,EActivityType.FifthOpenServerRecharge3],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),n=0;n<t.length;n++)if(i.isOpen(t[n])){e=t[n];break}v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(e,{code:e})}},{img:"common_icon_tehuihuikui_png",noticeType:NT.ALL_ACTIVITY[EActivityType.VipPreferentialGift],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.VipPreferentialGift]},unlockModule:MODULE.Activity+EActivityType.VipPreferentialGift,isOpenCheck:function(){var e=v.GameMVC.activityPy.allActivityData[EActivityType.VipPreferentialGift];if(e&&e.data){var t=JSON.parse(e.content)[0],i=e.data[0]&&e.data[0].times||0,n=t[1],o=t[2],a=v.GameMVC.playerPy.playerInfoVO.playerVip.vipLevel,r=REWARD_STATUS.UNAVAILABLE;n<=a&&(r=REWARD_STATUS.AVAILABLE);var s=void 0;for(var c in o){var l=o[c];if(l[0]==i+1){s=l;break}}s||(r=REWARD_STATUS.RECEIVED);var h=!1;switch(r){case REWARD_STATUS.UNAVAILABLE:case REWARD_STATUS.AVAILABLE:h=!0;break;case REWARD_STATUS.RECEIVED:}return h}},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.VipPreferentialGift,{code:EActivityType.VipPreferentialGift})}},{img:"common_icon_pifulibao_png",noticeType:NT.ALL_ACTIVITY[EActivityType.SecondDailyGifts],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.SecondDailyGifts]},unlockModule:MODULE.Activity+EActivityType.SecondDailyGifts,isOpenCheck:function(){var e=v.GameMVC.activityPy.allActivityData[EActivityType.SecondDailyGifts];if(!e||!e.data)return!1;var t=JSON.parse(e.content);t.sort(function(e,t){return e[0]-t[0]});for(var i=e.data.day,n=e.data.targeted,o=1;o<=t.length;){var a=!1;for(var r in n)if(n[r].id==o){a=!0;break}if(!a)break;o++}if(!t[o-1])return!1;REWARD_STATUS.UNAVAILABLE;return(o<=i?REWARD_STATUS.AVAILABLE:REWARD_STATUS.HASBUY)==REWARD_STATUS.AVAILABLE},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.SecondDailyGifts,{code:EActivityType.SecondDailyGifts})}},{img:"wanba_icon_chongzhipaihang_png",noticeType:NT.ALL_ACTIVITY[EActivityType.WorldRechargeRank],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.WorldRechargeRank]},unlockModule:MODULE.Activity+EActivityType.WorldRechargeRank,isOpenCheck:function(){return v.GameMVC.activityPy.isOpen(EActivityType.WorldRechargeRank)},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.WorldRechargeRank,{code:EActivityType.WorldRechargeRank})}},{img:"common_icon_zunxianglibao_png",noticeType:NT.ALL_ACTIVITY[EActivityType.SixtyEightYuanGifts],trueNoticeType:function(){for(var e=EActivityType.SixtyEightYuanGifts,t=[EActivityType.SixtyEightYuanGifts,EActivityType.OneYuanGifts2],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),n=0;n<t.length;n++)if(i.isOpen(t[n])){e=t[n];break}return NT.ALL_ACTIVITY[e]},unlockModule:MODULE.Activity+EActivityType.SixtyEightYuanGifts,effect:"common_qiriicon",isOpenCheck:function(){for(var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),t=EActivityType.SixtyEightYuanGifts,i=[EActivityType.SixtyEightYuanGifts,EActivityType.OneYuanGifts2],n=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),o=0;o<i.length;o++)if(n.isOpen(i[o])){t=i[o];break}var a=e.allActivityData[t];if(a&&a.data){var r=a.data.targeted,s=a.content,c=(a.data.key,a.data.day),l=[];for(var h in s){(p=s[h])[0]==c&&l.push(p)}if(!l.length)return[];for(o=0;o<l.length;o++){(p=l[o])[0];var p,d=p[1],u=(p[2],p[3],p[4],!1);for(var h in r){if(r[h].id==d){u=!0;break}}if(u)return!1}return!0}},clickFunc:function(){for(var e=EActivityType.SixtyEightYuanGifts,t=[EActivityType.SixtyEightYuanGifts,EActivityType.OneYuanGifts2],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),n=0;n<t.length;n++)if(i.isOpen(t[n])){e=t[n];break}v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(e,{code:e})}},{img:"common_icon_xinchunhesui_png",noticeType:void 0,unlockModule:void 0,scale:1,isOpenCheck:function(){var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.NewYearWeekCrad];return!(!e||!e.data)&&!!!e.data.day},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.NewYearWeekCrad)}},{img:"common_icon_zhanqujingpai_png",noticeType:NT.ALL_ACTIVITY[EActivityType.ZoneAuction],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.ZoneAuction]},unlockModule:MODULE.Activity+EActivityType.ZoneAuction,isOpenCheck:function(){var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.ZoneAuction];if(e&&e.data)return!!Utils.UnlockMgr.checkPass(MODULE.Activity+EActivityType.ZoneAuction,!1).allow||void 0},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.ZoneAuction1)}},{img:"common_icon_jingxibaoxiang_png",unlockModule:void 0,scale:1,isOpenCheck:function(){var e=v.GameMVC.activityPy.allActivityData[EActivityType.PushGiftBag];if(!e||!e.data)return!1;if(0<e.data.purchaseTime)return!1;if(!Utils.UnlockMgr.checkPass(MODULE.Activity+EActivityType.PushGiftBag,!1).allow)return!1;var t=Utils.TimerManager.getServerOpenDays(),i=e.data.vipLevel,n=JSON.parse(e.content),o=0;for(var a in n){var r=n[a];if(r[0]==t)for(var s in r[1]){var c=r[1][s];c[1]==i&&(o=c[0])}}return!!o},updateId:["bm_time"],updateFunc:function(e){v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"bm_time":var t=v.ActivityConfig.getActivityEndDt(EActivityType.PushGiftBag)-Utils.TimerManager.getServerTime();e.text=0<t?Utils.TimerManager.getFormatBySecond2(t):""}})},clickFunc:function(){v.GameMVC.activityMed.showViewByCode(EActivityType.PushGiftBag)}},{img:"common_icon_guanzhu_png",noticeType:void 0,trueNoticeType:void 0,unlockModule:MODULE.Activity+EActivityType.GuanZhuGongZhongHao,isOpenCheck:function(){return!!Utils.SDKMgr.getPerformConfig(1026)&&(!!v.GameMVC.activityPy.allActivityData[EActivityType.GuanZhuGongZhongHao]&&(!v.GameMVC.activityPy.operationHasExec(OperationType.Act_GuanZhuGongZhongHao)||getUrlKV().SwitchGuanzhuAlthoughGet))},clickFunc:function(){v.GameMVC.activityMed.showViewByCode(EActivityType.GuanZhuGongZhongHao)}},{img:"common_icon_shimingrenzheng_png",noticeType:void 0,trueNoticeType:void 0,unlockModule:MODULE.Activity+EActivityType.ShiMingRenZheng,isOpenCheck:function(){return!!v.GameMVC.activityPy.allActivityData[EActivityType.ShiMingRenZheng]&&!v.GameMVC.activityPy.operationHasExec(OperationType.Act_ShiMingRenZheng)},clickFunc:function(){v.GameMVC.activityMed.showViewByCode(EActivityType.ShiMingRenZheng)}},{img:"common_icon_weiduanxiazai_png",noticeType:void 0,trueNoticeType:void 0,unlockModule:MODULE.Activity+EActivityType.WeiDuanXiaZai,isOpenCheck:function(){return!!Utils.SDKMgr.getPerformConfig(1016)&&(!!v.GameMVC.activityPy.allActivityData[EActivityType.WeiDuanXiaZai]&&(!v.GameMVC.activityPy.operationHasExec(OperationType.Act_AppDownload)||getUrlKV().SwitchMicDownloadAlthoughGet))},clickFunc:function(){v.GameMVC.activityMed.showViewByCode(EActivityType.WeiDuanXiaZai)}},{img:"common_icon_shoucangyouli_png",noticeType:void 0,trueNoticeType:void 0,unlockModule:MODULE.Activity+EActivityType.ShouCangYouLi,updateId:["btn","gp_bottom"],updateFunc:function(e){e&&e.forEach(function(e){switch(e.name){case"btn":Utils.SDKMgr.getPerformConfig(10021)&&"QQLive"==getUrlKV().channel?e.icon="huodong_icon_shoucangyouxi_png":e.icon="common_icon_shoucangyouli_png";break;case"gp_bottom":e.visible=!1}})},isOpenCheck:function(){if(Utils.SDKMgr.getPerformConfig(10018)&&Utils.SDKMgr.getPerformConfig(15))return!Utils.SDKMgr.getPerformConfig(10021)||Utils.SDKMgr.extraFuncForAgent({type:"canShow",params:{type:"favoritesToDesktop"}})&&"xinYueClub"!=getUrlKV().channel;return!!v.GameMVC.activityPy.allActivityData[EActivityType.ShouCangYouLi]&&(Utils.SDKMgr.getPerformConfig(20001)&&Utils.SDKMgr.getPerformConfig(15)?!v.GameMVC.activityPy.operationHasExec(6):!(!Utils.SDKMgr.getPerformConfig(15)||4!=Utils.DeviceUtils.getPlatform())&&!v.GameMVC.activityPy.operationHasExec(OperationType.Act_ShouCangYouLi))},clickFunc:function(){v.GameMVC.activityMed.showViewByCode(EActivityType.ShouCangYouLi)}},{img:"common_icon_viptequan_png",noticeType:void 0,unlockModule:void 0,isOpenCheck:function(){return Utils.SDKMgr.getPerformConfig(10021)?Utils.SDKMgr.extraFuncForAgent({type:"canShow",params:{type:"miniGameVIP"}}):Utils.agentConfig.other.isJhb},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.QQZoneVipGift)}},{img:"huodong_icon_xingqubuluo_png",noticeType:void 0,unlockModule:void 0,isOpenCheck:function(){return Utils.SDKMgr.getPerformConfig(10021)?Utils.SDKMgr.extraFuncForAgent({type:"canShow",params:{type:"buluo"}}):Utils.agentConfig.other.isJhb},clickFunc:function(){var e=Utils.agentConfig.other.buluoUrl||"https://buluo.qq.com/p/barindex.html?bid=409851";Utils.SDKMgr.extraFuncForAgent({type:"openUrl",params:{url:e}})}},{img:"sdk_custom1_cb",noticeType:void 0,trueNoticeType:void 0,unlockModule:void 0,updateId:["btn","gp_bottom"],updateFunc:function(e){e&&e.forEach(function(e){switch(e.name){case"btn":getUrlKV().sdk_custom1_config?e.icon=getUrlKV().sdk_custom1_config.enter_icon||"common_icon_shoucangyouli_png":e.icon="common_icon_shoucangyouli_png";break;case"gp_bottom":e.visible=!1}})},isOpenCheck:function(){return!!getUrlKV().sdk_custom1_config&&getUrlKV().sdk_custom1_config.canShow},clickFunc:function(){getUrlKV().sdk_custom1_config&&getUrlKV().sdk_custom1_config.cb&&getUrlKV().sdk_custom1_config.cb()}},{img:"common_icon_fulihuikui_png",noticeType:NT.ALL_ACTIVITY[EActivityType.NewTurntable],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.NewTurntable]},unlockModule:void 0,isOpenCheck:function(){return v.GameMVC.activityPy.isOpen(EActivityType.NewTurntable)},clickFunc:function(){v.GameMVC.activityMed.showViewByCode(EActivityType.NewTurntable)}}],e.TOP_RIGHT2_BTN_CONFIG=[{img:"common_icon_jinrihuodong_png",noticeType:void 0,unlockModule:MODULE.Activity+EActivityType.TodayActivity,isOpenCheck:function(){return!Utils.SDKMgr.getPerformConfig(2)},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.TodayActivity)}},{img:"common_icon_hongbao_png",noticeType:NT.ALL_ACTIVITY[EActivityType.TimerLuckyMoney],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.TimerLuckyMoney]},unlockModule:MODULE.Activity+EActivityType.TimerLuckyMoney,scale:1,isOpenCheck:function(){var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.TimerLuckyMoney];if(!e||!e.data)return!1;var t=v.GameMgr.getInstance().serverTime(),i=JSON.parse(e.content),n=e.data.targeted,o=[],a=new Date(1e3*t);for(var r in a.setHours(0,0,0),o.push(a.getTime()/1e3),i[0]){var s=i[0][r],c=s[0],l=s[1],h=new Date(1e3*t);h.setHours(c[0],c[1],c[2]||0);var p=h.getTime()/1e3,d=new Date(1e3*t);d.setHours(l[0],l[1],l[2]||0);var u=d.getTime()/1e3;o.push(p),o.push(u)}for(var g=!1,f=0;f<o.length-1;f++)t>=o[f]&&t<=o[f+1]&&(g=!0);var _=!1,m=o.length;for(var r in n){var y=n[r];if(y>=o[m-2]&&y<=o[m-1]){_=!0;break}}return g&&!_},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.TimerLuckyMoney)},updateId:["bm_time","gp_bottom"],updateFunc:function(e){v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);var y=function(t){e&&e.forEach(function(e){switch(e.name){case"gp_bottom":e.visible=!t}})};e&&e.forEach(function(e){switch(e.name){case"bm_time":var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.TimerLuckyMoney];if(!t||!t.data)return!1;var i=v.GameMgr.getInstance().serverTime(),n=JSON.parse(t.content),o=t.data.targeted,a=[],r=new Date(1e3*i);for(var s in r.setHours(0,0,0),a.push(r.getTime()/1e3),n[0]){var c=n[0][s],l=c[0],h=c[1],p=new Date(1e3*i);p.setHours(l[0],l[1],l[2]||0);var d=p.getTime()/1e3,u=new Date(1e3*i);u.setHours(h[0],h[1],h[2]||0);var g=u.getTime()/1e3;a.push(d),a.push(g)}y(!1);for(var f=0;f<a.length-1;f++)if(i>=a[f]&&i<=a[f+1]){if(!0,f%2==0)return void(e.text=Utils.TimerManager.getFormatBySecond1(a[f+1]-i));var _=!1;for(var s in o){var m=o[s];if(m>=a[f]&&m<=a[f+1]){_=!0;break}}if(_)return void(a[f+2]?e.text=Utils.TimerManager.getFormatBySecond1(a[f+2]-i):y(!1));y(!0)}}})}},{img:"huodong_icon_qqhuangzuantequan_png",noticeType:void 0,unlockModule:void 0,updateId:["btn","gp_bottom"],updateFunc:function(e){v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"btn":var t=void 0;"xinYueClub"==getUrlKV().channel?t="huodong_icon_xinyuetequan_png":getUrlKV().qua&&"PC"==getUrlKV().qua.app?t="huodong_icon_dengluyouli_png":"QQVip"==getUrlKV().channel?t="huodong_icon_qqhuiyuantequan_png":"huangzuan"==getUrlKV().channel?t="huodong_icon_qqhuangzuantequan_png":"gameApp"==getUrlKV().channel?t="huodong_icon_weiduanyouli_png":"QQLive"==getUrlKV().channel&&(t=1==getUrlKV().platform?"huodong_icon_aiwanfuli_png":"huodong_icon_gengduojingcai_png"),e.icon!=t&&(e.icon=t);break;case"gp_bottom":e.visible=!1}})},isOpenCheck:function(){if(!Utils.SDKMgr.getPerformConfig(10021))return!1;var e=v.GameMVC.activityPy.giftList,t=getUrlKV(),i="QQLive"==t.channel,n="gameApp"==t.channel&&1==t.platform&&t.qua&&"SQ"==t.qua.app;return"QQVip"==t.channel&&-1==e.indexOf(2404)||"huangzuan"==t.channel&&-1==e.indexOf(2403)||"xinYueClub"==t.channel||t.qua&&"PC"==t.qua.app||n||i},clickFunc:function(){var e=getUrlKV().channel;getUrlKV().qua&&"PC"==getUrlKV().qua.app&&(e="PC"),"xinYueClub"==e?PopUpManager.addPopUp({obj:new v.XinyueCLubView}):"gameApp"==getUrlKV().channel?PopUpManager.addPopUp({obj:new v.NativeDownloadView}):"QQLive"==getUrlKV().channel?PopUpManager.addPopUp({obj:new v.QQLiveView}):PopUpManager.addPopUp({obj:new v.QQCommonGiftView({type:e})})}}],e.TOP_LEFT_BTN_CONFIG=[{img:"_btn_lb_m_json.common_icon_fenxiang",noticeType:NT.ALL_ACTIVITY[EActivityType.FriendShare],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.FriendShare]},unlockModule:MODULE.Activity+EActivityType.FriendShare,name:"分享",isOpenCheck:function(){if(Utils.SDKMgr.getPerformConfig(16)){if(Utils.SDKMgr.getPerformConfig(10018))return!Utils.SDKMgr.getPerformConfig(10021)||(Utils.SDKMgr.extraFuncForAgent({type:"canShow",params:{type:"share"}})||"WX"==getUrlKV().channel)&&"xinYueClub"!=getUrlKV().channel;var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.FriendShare];if(!e||!e.data)return;if(Utils.UnlockMgr.checkPass(MODULE.Activity+EActivityType.FriendShare,!1).allow)return!0}},clickFunc:function(){var e=v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N);Utils.SDKMgr.getPerformConfig(10018)?e.showViewByCode(EActivityType.WeChatShare):e.showViewByCode(EActivityType.FriendShare)}}],e.BOTTOM_LEFT_BTN_CONFIG=[{img:"common_icon_chongwu_png",noticeType:NT.PET,scale:1,unlockModule:MODULE.Pet,name:"",isOpenCheck:function(){return!0},clickFunc:function(){v.MainJumpConfig.jumpTo(MODULE.Pet)}},{img:"common_icon_yinghunwangshi_png",noticeType:NT.HERO_SPIRIT,scale:1,unlockModule:MODULE.HeroSpirit,name:"",isOpenCheck:function(){return!0},clickFunc:function(){v.GameMVC.heroSpiritPy.GetHeroSpiritInfo(function(){v.AppFacade.getInstance().showSubView(v.HeroSpiritMediator.N,v.HeroSpiritMediator.SV.MAIN,{})})}},{img:"common_icon_zhujue_png",noticeType:NT.FASHION,scale:1,unlockModule:MODULE.Fashion,name:"",isOpenCheck:function(){return!0},clickFunc:function(){v.GameMVC.fashionPy.GetFashionInfo(function(){v.AppFacade.getInstance().showSubView(v.FashionMediator.N,v.FashionMediator.SV.MAIN,{chooseIndex:2})})}},{img:"common_icon_zuoqi_png",noticeType:NT.MOUNT,scale:1,unlockModule:MODULE.Horse,name:"",isOpenCheck:function(){return!0},clickFunc:function(){v.GameMVC.mountPy.GetHorseInfo(function(){var e=0,t=v.GameMVC.mountPy.allMountByUuid,i=v.Config.horseConfig();for(var n in t)for(var o in i)if(t[n].code==i[o].code&&1==t[n].pos){e=Number(o);break}v.AppFacade.getInstance().showSubView(v.MountMediator.N,v.MountMediator.SV.MAIN,{chooseIndex:e})})}}],e.BOTTOM_RIGHT_BTN_CONFIG=[{img:"common_icon_yongshilingzhuang2_png",noticeType:NT.NEWBRAVABOOK,unlockModule:void 0,isOpenCheck:function(){var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.NewBraveBook];if(!e)return!1;var t=!1,i=Utils.TimerManager.getServerTime(),n=e.endDt;return e.startDt<=i&&i<n?t=!0:v.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN),t},clickFunc:function(){v.GameMVC.taskPy.getNewBraveBookTask({cb:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.NewBraveBook)}})},updateId:["btn","gp_bottom"],updateFunc:function(e){var t=v.AppFacade.getInstance().retrieveProxy(v.TaskPy.N).newBraveBookTask,i=t&&t.level||0;e&&e.forEach(function(e){switch(e.name){case"btn":var t=i<1e3&&0<=i?"common_icon_yongshilingzhuang2_png":"common_icon_yongshilingzhuang1_png";e.icon=t,e.labelDisplay.verticalCenter=i<1e3&&0<=i?11:3,e.labelDisplay.size=18,e.labelDisplay.text=""+i;break;case"gp_bottom":e.visible=!1}})}}],e.BOTTOM_RIGHT_BANNER_CONFIG=[{img:"blzb_img_fbzc_png",isOpenCheck:function(){var e=Utils.UnlockMgr.getOpenInfo(MODULE.StormWar);return e.allow&&e.isOpen},clickFunc:function(){v.MainJumpConfig.jumpTo(MODULE.StormWar)}},{img:"jsjhd_img_tnwz_png",isOpenCheck:function(){var e=v.GameMVC.activityPy.allActivityData[EActivityType.NewZoneQuora];if(!e||!e.data)return!1;var t=JSON.parse(e.content)[0][0];return!!Utils.TimerManager.checkIsOpen_FormatA(t).isOpen},clickFunc:function(){v.MainJumpConfig.jumpTo(MODULE.Activity+EActivityType.NewZoneQuora)}},{img:"blzb_img_kmzdz_png",isOpenCheck:function(){var e=Utils.UnlockMgr.getOpenInfo(MODULE.Manor);return e.allow&&e.isOpen},clickFunc:function(){v.MainJumpConfig.jumpTo(MODULE.Manor)}},{img:"zq_img_qmzq_png",isOpenCheck:function(){return v.GameMVC.activityPy.isOpen(EActivityType.MidAutumn)&&v.GameMVC.activityPy.checkIdelAvailable()},clickFunc:function(){v.MainJumpConfig.jumpTo(MODULE.Activity+EActivityType.MidAutumn)}}],e.BOTTOM_BTN_CONFIG=[{jumpModule:"CITY",unlockModule:MODULE.CityMain},{jumpModule:"HERO",unlockModule:void 0},{jumpModule:"GUAJI",unlockModule:void 0},{jumpModule:"BACKPACK",unlockModule:void 0},{jumpModule:"GUILD",unlockModule:MODULE.Guild}],e}();v.MainBtnConfig=e,__reflect(e.prototype,"game.MainBtnConfig")}(game||(game={})),function(p){var e,d=((e={LOGIN:{clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.LoginMediator.N,p.LoginMediator.SV.BEFORE_LOGIN)}},MAIN:{moduleStyle:ModuleStyle.MAIN,clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.MainMediator.N,p.MainMediator.SV.MAIN)}},CITY:{moduleStyle:ModuleStyle.CITY,clickFunc:function(e){var t=p.AppFacade.getInstance().retrieveMediator(p.CityMediator.N).getSubView(p.CityMediator.SV.MAIN);t&&(t.curGuideAvailable=!1,t.perShow()),p.AppFacade.getInstance().showSubView(p.CityMediator.N,p.CityMediator.SV.MAIN),p.AppFacade.getInstance().sendNotification(CN.MAIN_CHANGE_BTN,"CITY")}},HERO:{moduleStyle:ModuleStyle.HERO,clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.HeroMediator.N,p.HeroMediator.SV.MAIN),p.AppFacade.getInstance().sendNotification(CN.MAIN_CHANGE_BTN,"HERO")}},GUAJI:{moduleStyle:ModuleStyle.GUAJI,clickFunc:function(e){var t=p.AppFacade.getInstance().retrieveMediator(p.GuajiMediator.N).guajiUI;t&&(t.curGuideAvailable=!1,t.perShow()),p.AppFacade.getInstance().showSubView(p.GuajiMediator.N,p.GuajiMediator.SV.MAIN,{isFromJump:!0}),p.AppFacade.getInstance().sendNotification(CN.MAIN_CHANGE_BTN,"GUAJI")}},FIGHT:{clickFunc:function(e){p.AppFacade.getInstance().sendNotification(CN.FIGHT_OPEN_FIGHT,e)}},FIGHT_TEST:{config:ModuleStyle.FIGHT,clickFunc:function(e){p.AppFacade.getInstance().sendNotification(CN.FIGHT_OPEN_OR_CLOSE_FIGHT_TEST,e)}},BACKPACK:{moduleStyle:ModuleStyle.BACKPACK,clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.BackpackMediator.N,p.BackpackMediator.SV.MAIN),p.AppFacade.getInstance().sendNotification(CN.MAIN_CHANGE_BTN,"BACKPACK")}},GUILD_CREATE:{moduleStyle:ModuleStyle.BACKPACK,clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.GuildMediator.N,p.GuildMediator.SV.CREATE_OR_APPLY)}},GUILD:{moduleStyle:ModuleStyle.GUILD,clickFunc:function(e){p.AppFacade.getInstance().retrieveProxy(p.GuildPy.N).isInGuild()?p.AppFacade.getInstance().showSubView(p.GuildMediator.N,p.GuildMediator.SV.MAIN_MAP):r.jumpTo("GUILD_CREATE"),p.AppFacade.getInstance().sendNotification(CN.MAIN_CHANGE_BTN,"GUILD")},isOpen:function(){if(Utils.UnlockMgr.checkPass(MODULE.Guild,!0).allow)return!0;for(var e=["CITY","HERO","GUAJI","BACKPACK"],t=r.lastEvents.length;0<t;t--)if(0<=e.indexOf(r.lastEvents[t]))return p.AppFacade.getInstance().sendNotification(CN.MAIN_CHANGE_BTN,r.lastEvents[t]),!1;return!1}},ZZQ_MATCH:{moduleStyle:ModuleStyle.ZZQ,clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.ZzqMediator.N,p.ZzqMediator.SV.MATCHING,e)}},ZZQ:{moduleStyle:ModuleStyle.ZZQ,clickFunc:function(e){if(Utils.SDKMgr.getPerformConfig(9)){if(Utils.UnlockMgr.checkPass(MODULE.Wchess,!0).allow){var t=p.AppFacade.getInstance().retrieveProxy(p.ZzqPy.N);t.GetWchessRoomInfo(function(){t.curRoomInfo.status>=EWchessRoomStatus.Matched?p.AppFacade.getInstance().showSubView(p.ZzqMediator.N,p.ZzqMediator.SV.CHESS_MAIN):r.jumpTo("ZZQ_MATCH",void 0,e)})}}else Utils.MsgUtils.addMidMsg("敬请期待")}},XYX_USERINFO:{ignoreStack:!0,clickFunc:function(t){Utils.SDKMgr.cmd({type:"AuthSetting",scope:"scope.userInfo"},function(e){e?Utils.SDKMgr.cmd({type:"GetOpenData"},function(e){t.cb&&t.cb(e)}):p.AppFacade.getInstance().showSubView(p.PlayerMediator.N,p.PlayerMediator.SV.XYX_USERINFO,{cb:function(e){t.cb&&t.cb(e)}})})}}})[MODULE.Manor]={clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.ManorMediator.N,p.ManorMediator.SV.MAIN)}},e[MODULE.StormWar]={clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.StormWarMediator.N,p.StormWarMediator.SV.MAIN)},isOpen:function(){var e=Utils.UnlockMgr.getOpenInfo(MODULE.StormWar);return e.allow?!!e.isOpen||(Utils.MsgUtils.addMidMsg("开放时间："+e.openDayTip),!1):(e.ext&&Utils.MsgUtils.addMidMsg(e.ext.tips),!1)}},e[MODULE.Pet]={clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.PetMediator.N,p.PetMediator.SV.MAIN)}},e[MODULE.VIP]={clickFunc:function(e){p.MainJumpConfig.jumpTo(MODULE.Recharge,!1,{viewType:p.RechargeView.VIEW_TYPE.PRIVILEGE})}},e[MODULE.Recharge]={clickFunc:function(e){if(Utils.SDKMgr.getPerformConfig(1)){var t=Utils.SDKMgr.getPerformConfig(4);Utils.SDKMgr.getPerformConfig(19)?p.GameMVC.activityMed.showViewByCode(EActivityType.ShouCangYouLi):Utils.MsgUtils.addMidMsg(t||"暂未开启")}else p.GameMVC.rechargeMed.showSubView(p.RechargeMediator.SV.MAIN,e)}},e[MODULE.Bag]={clickFunc:function(e){p.MainJumpConfig.jumpTo("BACKPACK")}},e[MODULE.Hero]={clickFunc:function(e){p.MainJumpConfig.jumpTo("HERO")}},e[MODULE.Wchess]={clickFunc:function(e){p.MainJumpConfig.jumpTo("ZZQ")}},e[MODULE.Risk]={clickFunc:function(e){p.MainJumpConfig.jumpTo("GUAJI")}},e[MODULE.ShopMystical]={clickFunc:function(e){p.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeRefresh})}},e[MODULE.ShopExpedition]={clickFunc:function(e){p.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeExpedition})}},e[MODULE.ShopTeamExpedition]={clickFunc:function(e){p.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeTeamExpedition})}},e[MODULE.ShopArean]={clickFunc:function(e){p.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeArena})}},e[MODULE.ShopDecompose]={clickFunc:function(e){p.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeDecompose})}},e[MODULE.ShopRaceGashapon]={clickFunc:function(e){p.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeRaceGashapon})}},e[MODULE.HeroEquip]={clickFunc:function(e){r.jumpTo("HERO")}},e[MODULE.HeroArtifact]={clickFunc:function(e){r.jumpTo("HERO")}},e[MODULE.AbyssLair]={clickFunc:function(e){if(Utils.UnlockMgr.checkPass(MODULE.AbyssLair).allow){p.GameMVC.DeepNestPy;p.GameMVC.DeepNestPy.GetAbyssLairInfo(function(e){GameRootLayer.gameLayer().switchCloudLoading(!0),p.AppFacade.getInstance().showSubView(p.DeepNestMediator.N,p.DeepNestMediator.SV.MAIN,{chalCount:e.chalCount,chapterInfos:e.chapterInfos,isOpen:!0})})}}},e[MODULE.Vestage]={clickFunc:function(e){var t=p.GameMVC.dungeonPy;t.GetVestageMapInfo(function(){t.baseInfo.processStatus===VestageProcessType.EnterMap?p.AppFacade.getInstance().showSubView(p.DungeonMed.N,p.DungeonMed.SV.MAP,e):p.GameMVC.dungeonMed.switchMenLoading(["group_dungeon_main"],function(){p.AppFacade.getInstance().showSubView(p.DungeonMed.N,p.DungeonMed.SV.MAIN,e)})})}},e[MODULE.TeamArena]={clickFunc:function(e){p.GameMVC.battleZoneArenaPy.GetBattleZoneArenaInfo(function(){p.AppFacade.getInstance().showSubView(p.BattleZoneArenaMediator.N,p.BattleZoneArenaMediator.SV.MAIN)})},isOpen:function(){return!!p.GameMVC.battleZoneArenaPy.getOpenInfo().isOpen||(Utils.MsgUtils.addMidMsg("未开启"),!1)}},e[MODULE.RiskMulti]={clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.GuajiMediator.N,p.GuajiMediator.SV.MULTI)},isOpen:function(){return Utils.SDKMgr.getPerformConfig(40)}},e[MODULE.WorldKing]={clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.WorldKingMediator.N,p.WorldKingMediator.SV.MAIN)},isOpen:function(){var e=p.AppFacade.getInstance().retrieveProxy(p.WorldKingPy.N).getOpenInfo();return e.isOpen||Utils.MsgUtils.addMidMsg("暂未开启"),e.isOpen}},e[MODULE.ServerBoss]={clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.WorldBossMediator.N,p.WorldBossMediator.SV.MAIN)},isOpen:function(){var e=Utils.UnlockMgr.getOpenInfo(MODULE.ServerBoss);return e.allow?!!e.isOpen||(Utils.MsgUtils.addMidMsg("开放时间："+e.openDayTip),!1):(e.ext&&Utils.MsgUtils.addMidMsg(e.ext.tips),!1)}},e[MODULE.Guild]={clickFunc:function(e){r.jumpTo("GUILD")}},e[MODULE.GuildBoss]={clickFunc:function(e){Utils.UnlockMgr.checkPass(MODULE.GuildBoss).allow&&p.AppFacade.getInstance().showSubView(p.GuildBossMediator.N,p.GuildBossMediator.SV.MAIN)},isOpen:function(){var e=p.AppFacade.getInstance().retrieveProxy(p.GuildBossPy.N).getOpenInfo();return e.isOpen||Utils.MsgUtils.addMidMsg("暂未开启"),e.isOpen}},e[MODULE.GuildShop]={clickFunc:function(e){var t=p.AppFacade.getInstance().retrieveProxy(p.GuildPy.N);r.jumpTo("GUILD"),Utils.UnlockMgr.checkPass(MODULE.GuildShop).allow&&t.isInGuild()&&p.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeGuild})}},e[MODULE.LuckyTurntable]={clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.LuckyTableMed.N,p.LuckyTableMed.SV.MAIN)}},e[MODULE.GuildWar]={noCheck:!0,isOpen:function(){var e=p.AppFacade.getInstance().retrieveProxy(p.GuildWarPy.N).getGuildWarStatus();if(e!=GuildWarStatus.Close)return e!=GuildWarStatus.UnEnroll||(Utils.MsgUtils.addMidMsg("当前阶段不可报名"),!1);Utils.UnlockMgr.checkPass(MODULE.GuildWar).allow&&Utils.MsgUtils.addMidMsg("当前阶段不可进入")},clickFunc:function(e){var t=p.AppFacade.getInstance().retrieveProxy(p.GuildPy.N);r.jumpTo("GUILD"),Utils.UnlockMgr.checkPass(MODULE.GuildWar).allow&&(t.isInGuild()?p.AppFacade.getInstance().showSubView(p.GuildWarMediator.N,p.GuildWarMediator.SV.MAIN):Utils.MsgUtils.addMidMsg("还没加入公会"))}},e[MODULE.GuildTranscript]={clickFunc:function(e){var t=p.AppFacade.getInstance().retrieveProxy(p.GuildPy.N);r.jumpTo("GUILD"),Utils.UnlockMgr.checkPass(MODULE.GuildTranscript).allow&&t.isInGuild()&&p.AppFacade.getInstance().showSubView(p.GuildInstanceMediator.N,p.GuildInstanceMediator.SV.MAIN)}},e[MODULE.Challenge]={clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.HeroChallengeMediator.N,p.HeroChallengeMediator.SV.MAIN)}},e[MODULE.HeroChallenge]={clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.HeroChallenge2Mediator.N,p.HeroChallenge2Mediator.SV.MAIN)}},e[MODULE.GuildCollect]={clickFunc:function(e){var t=p.AppFacade.getInstance().retrieveProxy(p.GuildPy.N);r.jumpTo("GUILD"),Utils.UnlockMgr.checkPass(MODULE.GuildCollect).allow&&t.isInGuild()&&p.AppFacade.getInstance().showSubView(p.GuildCollectMediator.N,p.GuildCollectMediator.SV.MAIN)}},e[MODULE.GuildSkill]={clickFunc:function(e){var t=p.AppFacade.getInstance().retrieveProxy(p.GuildPy.N),i=p.AppFacade.getInstance().retrieveProxy(p.GuildSkillPy.N);r.jumpTo("GUILD"),Utils.UnlockMgr.checkPass(MODULE.GuildSkill).allow&&t.isInGuild()&&(null==i.skillInfo.length&&i.GetGuildSkillInfo(),p.AppFacade.getInstance().showSubView(p.GuildSkillMediator.N,p.GuildSkillMediator.SV.MAIN))}},e[MODULE.Ranking]={clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.RankMediator.N,p.RankMediator.SV.MAIN)}},e[MODULE.Decompose]={clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.BackpackMediator.N,p.BackpackMediator.SV.DECOMPOSE,{type:EEntityType.EEntityTypeHero})}},e[MODULE.DecomposeEquip]={clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.BackpackMediator.N,p.BackpackMediator.SV.DECOMPOSE,{type:EEntityType.EEntityTypeHeroEquip})}},e[MODULE.RiskFingerToXY]={ignoreStack:!0,clickFunc:function(e){e?(Array.isArray(e)||(e=JSON.parse(e)),p.AppFacade.getInstance().sendNotification(CN.GUAJI_FINGER_TO_XY,{tileX:e[0],tileY:e[1],num:e[2]})):p.AppFacade.getInstance().sendNotification(CN.GUAJI_FINGER_TO_XY)}},e[MODULE.RiskMeToXY]={ignoreStack:!0,clickFunc:function(e){e&&(Array.isArray(e)||(e=JSON.parse(e)),p.AppFacade.getInstance().sendNotification(CN.GUAJI_PRETEND_CLICK_TILED,{tileX:e[0],tileY:e[1],num:e[2]}))}},e[MODULE.RiskFingerAppearToXY]={ignoreStack:!0,clickFunc:function(e){e&&(Array.isArray(e)||(e=JSON.parse(e)),p.AppFacade.getInstance().sendNotification(CN.GUAJI_FINGER_APPEAR_TO_XY,{tileX:e[0],tileY:e[1],num:e[2],time:1e3}))}},e[MODULE.Activity]={clickFunc:function(e){if(!(e&&e%MODULE.Activity)){var t=p.AppFacade.getInstance().retrieveProxy(p.ActivityPy.N),i=p.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.JINGCAI),n=!1;return i.forEach(function(e){t.isOpen(e.id)&&(n=!0)}),void(n?(r.jumpTo("CITY"),p.AppFacade.getInstance().showSubView(p.ActivityMediator.N,p.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.ACTIVITY})):Utils.MsgUtils.addMidMsg("活动未开启"))}var o=p.AppFacade.getInstance().retrieveMediator(p.ActivityMediator.N),a=e%MODULE.Activity;p.AppFacade.getInstance().retrieveProxy(p.ActivityPy.N).isOpen(a)?(o.hideAllSubView(),p.AppFacade.getInstance().retrieveMediator(p.ActivityMediator.N).showViewByCode(a)):Utils.MsgUtils.addMidMsg("活动未开启")}},e[MODULE.Activity+EActivityType.ZoneAuction1]={clickFunc:function(e){var t=p.AppFacade.getInstance().retrieveProxy(p.ActivityPy.N),i=p.AppFacade.getInstance().retrieveMediator(p.ActivityMediator.N);t.isOpen(EActivityType.ZoneAuction)?(i.hideAllSubView(),p.AppFacade.getInstance().retrieveMediator(p.ActivityMediator.N).showViewByCode(EActivityType.ZoneAuction1)):Utils.MsgUtils.addMidMsg("活动未开启")}},e[MODULE.Activity+EActivityType.MidAutumn]={clickFunc:function(e){var t=p.GameMVC.activityPy,i=p.GameMVC.activityMed;t.isOpen(EActivityType.MidAutumn)?(i.hideAllSubView(),t.GetActivityInfo(EActivityType.MidAutumn,function(){i.showViewByCode(EActivityType.MidAutumn)})):Utils.MsgUtils.addMidMsg("活动未开启")}},e[MODULE.ActivityBrave]={clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.BraveBookMediator.N,p.BraveBookMediator.SV.MAIN)}},e[MODULE.ActivityNewBrave]={clickFunc:function(e){p.AppFacade.getInstance().retrieveMediator(p.ActivityMediator.N).showViewByCode(EActivityType.NewBraveBook)}},e[MODULE.ActivityBraveBaoZang]={clickFunc:function(e){p.AppFacade.getInstance().showSubView(p.BraveBookMediator.N,p.BraveBookMediator.SV.BAOXIANG)}},e[MODULE.TribeBattle]={isOpen:function(){var e=Utils.UnlockMgr.getOpenInfo(MODULE.TribeBattle);return!(!e.isOpen||!e.allow)||(Utils.MsgUtils.addMidMsg("暂未开启"),!1)},clickFunc:function(){p.GameMVC.tribeBattlePy.GetTribeBattleInfo(function(){p.AppFacade.getInstance().showSubView(p.TribeBattleMed.N,p.TribeBattleMed.SV.MAIN)})}},e[MODULE.PeakWar]={isOpen:function(){return p.GameMVC.peakWarPy.updateCurType()!==PEAK_WAR_TYPE.HIGH_END||(Utils.MsgUtils.addMidMsg("当前已结束"),!1)},clickFunc:function(){p.GameMVC.peakWarPy.curType===PEAK_WAR_TYPE.FREE?p.AppFacade.getInstance().showSubView(p.PeakWarMed.N,p.PeakWarMed.SV.FREE):p.AppFacade.getInstance().showSubView(p.PeakWarMed.N,p.PeakWarMed.SV.HIGH)}},e),r=function(){function h(){}return h.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【MainJumpConfig】："].concat(e))},h.getConfig=function(e){return d[e]},h.confirmPush=function(){if(""!=h.lastEvent){var e=h.lastEvent;return h.lastEvent="",h.lastEvents.push(e),8<h.lastEvents.length&&h.lastEvents.splice(0,1),e}},h.getCurEvent=function(){return h.lastEvents[h.lastEvents.length-1]},h.confirmSpliceIfTop=function(e){h.lastEvents[h.lastEvents.length-1]==e&&h.lastEvents.pop()},h.jumpTo=function(e,t,i){if(void 0===t&&(t=!1),!e){h.lastEvents.pop();var n=h.lastEvents.pop();return h.jumpTo(n||"GUAJI",!0),!0}var o=i,a=void 0,r=void 0;if(Number(e))a=e;else{if("object"==typeof e)return void egret.warn("暂不支持对象跳转");"string"==typeof e&&(a=e)}if(r=d[a],!a&&r&&(a=r.moduleId),!(r&&r.noCheck||Utils.UnlockMgr.checkPass(a,!0).allow))return!1;if(r&&r.isOpen&&!r.isOpen())return!1;if(e==h.getCurEvent())return this.log("重复点击"),!1;if((!r||r&&!r.ignoreStack)&&(h.lastEvent=e),r&&r.moduleStyle&&(r.moduleStyle.mainUIStyle&&p.AppFacade.getInstance().sendNotification(CN.CHANGE_STYLE,r.moduleStyle.mainUIStyle),p.AppFacade.getInstance().sendNotification(CN.HIDE_ALL_SUBVIEW)),r)return"function"==typeof r?(r(o),!0):"function"==typeof r.clickFunc?(r.clickFunc(o),!0):(this.log("暂不支持当前跳转模式"),!1);if(!Number(e))return this.log("暂不支持当前跳转模式"),!1;var s=e%100,c=Math.floor(e/100);if(!(100<=c)){var l=h.id_2_mediator[c];return l&&l.SV?(p.AppFacade.getInstance().showSubView(l.N,s),!0):(this.log("mediator或mediator.SV不存在"),!1)}h.jumpTo(MODULE.Activity,!1,e)},h.lastEvent="",h.lastEvents=new Array,h.id_2_mediator={3:p.TaskMediator,7:p.ChatMediator,8:p.FriendMediator,10:p.BackpackMediator,11:p.StrongMediator,13:p.ChampionMediator,17:p.HeroMediator,19:p.ArenaMediator,20:p.BattleZoneArenaMediator,21:p.CopyEntranceMediator,22:p.MailMediator,23:p.TeamExpeMediator,24:p.WorldKingMediator,25:p.WorldBossMediator,26:p.MagicalArtifactMediator,27:p.GuajiMediator,28:p.TouchGoldHandMediator,29:p.SmithyMediator},h}();p.MainJumpConfig=r,__reflect(r.prototype,"game.MainJumpConfig")}(game||(game={})),function(x){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t._all_top_btns_img2BtnGP={},t.curModuleName="GUAJI",t.lastEvent="",t.playerProxy=x.AppFacade.getInstance().retrieveProxy(x.PlayerPy.N),t.taskProxy=x.AppFacade.getInstance().retrieveProxy(x.TaskPy.N),t.mainProxy=x.AppFacade.getInstance().retrieveProxy(x.MainPy.N),t.guideProxy=x.AppFacade.getInstance().retrieveProxy(x.GuidePy.N),t}return __extends(n,i),Object.defineProperty(n.prototype,"mainUI",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,x.MainUI)},n.prototype.listNotificationInterests=function(){return[CN.MAIN_DEBUG_INFO_UPDATE,CN.LOGIN_FINAL_DONE,CN.CHANGE_STYLE,CN.GAME_HEARTBEAT,CN.UPDATE_BG,CN.PLAYER_INFO_UPDATE,CN.PLAYER_LEVEL_UP,CN.MAIN_CHAT_UPDATE,CN.MAIN_CHAT_PRIVATEPLAYER_UPDATE,CN.MAIN_CHAT_TASK_STEP,CN.TASK_GET_REWARDS_POP_CLOSE,CN.ACTIVITY_LIST_UPDATED,CN.GENERAL_PASS_DAY,CN.MAIN_CHANGE_BTN,CN.MAIN_UPDATE_BTN,CN.CONFIG_ALL_LOADED,CN.FIGHT_ON_FIGHT_VISIBLE_SWITCH,CN.GUAJI_UPDATE_RES_NOTICE,CN.MAIN_FORCE_UPDATE_BANNER]},n.prototype.handleNotification=function(e){var t=this,i=e.getBody();switch(e.getName()){case CN.GENERAL_PASS_DAY:x.GameMgr.getInstance().GetServerInfo(),Utils.SDKMgr.getPerformConfig(10018)&&Utils.agentConfig.other.isJhb&&(Utils.LocalStorageUtil.setItem("msgTime","0",!1),Utils.LocalStorageUtil.setItem("huangzuan","0",!1),Utils.LocalStorageUtil.setItem("QQVip","0",!1));break;case CN.LOGIN_FINAL_DONE:egret.setTimeout(function(){Utils.SoundManager.preloadEffect()},this,2e4),x.AppFacade.getInstance().retrieveProxy(x.GuajiPy.N).getQuickBattleInfo();break;case CN.CHANGE_STYLE:this.mainUI&&(this.mainUI.curGuideAvailable=!1),this.changeStyle(i);break;case CN.CONFIG_ALL_LOADED:break;case CN.FIGHT_ON_FIGHT_VISIBLE_SWITCH:egret.clearTimeout(this.bannerScheId),this.bannerScheId=0,egret.setTimeout(function(){t.handleBanner()},this,500);break;case CN.MAIN_FORCE_UPDATE_BANNER:this.handleBanner();break;case CN.PLAYER_INFO_UPDATE:this.mainUI&&this.mainUI.updatePlayerInfo();break;case CN.MAIN_DEBUG_INFO_UPDATE:null!=i.serverTime&&(this.mainUI.initServerTimeSche(),this.mainUI.lb_serTime.visible=i.serverTime);break;case CN.PLAYER_LEVEL_UP:Utils.SDKMgr.isCloseIAPByAgent?Utils.SDKMgr.cmd({type:"CheckRecharge",level:this.playerProxy.playerInfoVO.level},function(){t.mainUI&&t.mainUI.updatePlayerInfo()}):this.mainUI&&this.mainUI.updatePlayerInfo(),Utils.SDKMgr.enterFlow("PlayerLevelUp"),this.updateBtn();break;case CN.PLAYER_VIP_LEVEL_UP:this.mainUI&&this.mainUI.updatePlayerInfo(),this.updateBtn();break;case CN.ACTIVITY_LIST_UPDATED:case CN.MAIN_UPDATE_BTN:this.updateBtn();break;case CN.GAME_HEARTBEAT:i.totalTime%60==0&&this.updateBtn();break;case CN.GUAJI_UPDATE_RES_NOTICE:this.mainUI&&this.mainUI.updateGuajiNotice(i);break;case CN.MAIN_CHANGE_BTN:if(!this.mainUI)return;for(var n=this.mainUI.getBtnByModule("ALL"),o=1;o<=5;o++){var a=n[o];a.scaleX=a.scaleY=1,a&&egret.Tween.removeTweens(a),a&&(a.touchEnabled=!0)}var r=this.mainUI.getBtnByModule(i),s=x.AppFacade.getInstance().retrieveProxy(x.GuajiPy.N);"CITY"==i?Utils.SoundManager.playDelayBg(SOUND_BGM_TYPE.zhu_cheng):"GUAJI"==i&&Utils.SoundManager.playDelayBg(s.curLayerTheme.bgm),r&&r.touchEnabled&&(r.touchEnabled=!1,Utils.SDKMgr.getPerformConfig(6)||r&&egret.Tween.get(r,{loop:!0}).to({scaleX:.95,scaleY:.95},600).to({scaleX:1,scaleY:1},600)),x.AppFacade.getInstance().retrieveProxy(x.GuajiPy.N).updateNotice()}},n.prototype.onViewCreate=function(){if(Utils.SDKMgr.getPerformConfig(27))for(var e=0,t=x.MainBtnConfig.TOP_LEFT_BTN_CONFIG;e<t.length;e++){var i=t[e];"分享"==i.name&&(i.name="邀请")}x.AppFacade.getInstance().retrieveProxy(x.GuidePy.N);this.updateBtn(),egret.clearInterval(this.updateBtnTimer),this.updateBtnTimer=egret.setInterval(this.updateBtnAccessory,this,5e3);for(var n=0,o=0,a=x.MainBtnConfig.BOTTOM_BTN_CONFIG;o<a.length;o++){var r=a[o],s=this.bindBottomFiveBtn(r,n++);this.bindBtn(s,r,!0)}Utils.agentConfig.OffLineTest?(this.playerProxy.makeFadePlayerInfo(),this.sendNotification(CN.PLAYER_INFO_UPDATE)):this.playerProxy.GetPlayerInfo()},n.prototype.updateBtn=function(){if(this.mainUI){var e=void 0;e=[];var t=this.curModuleName||"GUAJI";if(x.MainBtnConfig.VIEW_GROUP_ORDER[t]){for(var i=0,n=x.MainBtnConfig.TOP_BTN_CONFIG;i<n.length;i++){(C=n[i])._dismiss=!0;for(var o=0,a=x.MainBtnConfig.VIEW_GROUP_ORDER[t].TOP;o<a.length;o++){var r=a[o];if(C.img==r){C._dismiss=!1;break}}}for(var s=0,c=x.MainBtnConfig.TOP_RIGHT_BTN_CONFIG;s<c.length;s++){(C=c[s])._dismiss=!0;for(var l=0,h=x.MainBtnConfig.VIEW_GROUP_ORDER[t].RIGHT;l<h.length;l++){r=h[l];if(C.img==r){C._dismiss=!1;break}}}for(var p=0,d=x.MainBtnConfig.TOP_RIGHT2_BTN_CONFIG;p<d.length;p++){(C=d[p])._dismiss=!0;for(var u=0,g=x.MainBtnConfig.VIEW_GROUP_ORDER[t].RIGHT2;u<g.length;u++){r=g[u];if(C.img==r){C._dismiss=!1;break}}}for(var f=0,_=x.MainBtnConfig.TOP_LEFT_BTN_CONFIG;f<_.length;f++){(C=_[f])._dismiss=!0;for(var m=0,y=x.MainBtnConfig.VIEW_GROUP_ORDER[t].LEFT;m<y.length;m++){r=y[m];if(C.img==r){C._dismiss=!1;break}}}for(var v=0,T=x.MainBtnConfig.BOTTOM_LEFT_BTN_CONFIG;v<T.length;v++){var C;(C=T[v])._dismiss=!0;for(var E=0,b=x.MainBtnConfig.VIEW_GROUP_ORDER[t].LEFT_BOTTOM;E<b.length;E++){r=b[E];if(C.img==r){C._dismiss=!1;break}}}}e.push({obj:this.mainUI.gp_top,c:x.MainBtnConfig.TOP_BTN_CONFIG,commonSize:[86,86]}),e.push({obj:this.mainUI.gp_top_right,c:x.MainBtnConfig.TOP_RIGHT_BTN_CONFIG,commonSize:[86,86]}),e.push({obj:this.mainUI.gp_top_right2,c:x.MainBtnConfig.TOP_RIGHT2_BTN_CONFIG,commonSize:[86,86]}),e.push({obj:this.mainUI.gp_top_left2,c:x.MainBtnConfig.TOP_LEFT_BTN_CONFIG,commonSize:[86,86]}),e.push({obj:this.mainUI.gp_bottom_left,c:x.MainBtnConfig.BOTTOM_LEFT_BTN_CONFIG,commonSize:[86,86]}),e.push({obj:this.mainUI.gp_bottom_right,c:x.MainBtnConfig.BOTTOM_RIGHT_BTN_CONFIG,commonSize:[86,86]}),e.push({obj:this.mainUI.gp_bottom_banner,c:x.MainBtnConfig.BOTTOM_RIGHT_BANNER_CONFIG,commonSize:[245,94]}),window._aaa=this.mainUI;for(var I=0,A=e;I<A.length;I++)for(var P=A[I],S=0,N=0,M=P.c;N<M.length;N++){var w=M[N];if(S++,w._dismiss||w.isOpenCheck&&(!w.isOpenCheck()||w.unlockModule&&!Utils.UnlockMgr.checkPass(w.unlockModule,!1).allow)){if(this._all_top_btns_img2BtnGP[w.img]){U=this._all_top_btns_img2BtnGP[w.img];Utils.CacheMgr.setCacheComponent(w.img,U)}}else{if(!this._all_top_btns_img2BtnGP[w.img]){var k=this.makeTopXXBtnGP(w,P.commonSize),R=k.getChildByName("btn");this.bindBtn(R,w,!1),P.obj.addChildAt(k,S),w.trueNoticeType&&(w.noticeType=w.trueNoticeType()),w.noticeType&&NoticeManager.addNoticeListener(w.noticeType,R,this.mainUI,{percentX:60/86,percentY:8/86,noCleanAfterRemove:!0}),this._all_top_btns_img2BtnGP[w.img]=k}var U=this._all_top_btns_img2BtnGP[w.img];P.obj.contains(U)||Utils.CacheMgr.getCacheComponent(w.img,P.obj),P.obj.setChildIndex(U,S),U.getChildByName("btn")&&U.getChildByName("btn").updateFunc&&U.getChildByName("btn").updateFunc()}}this.updateBtnAccessory(),this.recalSizeGpTop()}},n.prototype.updateBtnAccessory=function(){if(this.mainUI)for(var e in this._all_top_btns_img2BtnGP)if(this._all_top_btns_img2BtnGP[e]){var t=this._all_top_btns_img2BtnGP[e].getChildByName("btn");t&&t.updateFunc&&t.updateFunc()}},n.prototype.topBtnNum=function(e){var t=0;if(this.mainUI)switch(e){case"TOP":t=this.mainUI.gp_top.numChildren;break;case"TOP_LEFT":t=this.mainUI.gp_top_left.numChildren;break;case"TOP_RIGHT":t=this.mainUI.gp_top_right.numChildren}return t},n.prototype.switchViewGroup=function(e){this.mainUI&&(this.curModuleName=e,this.updateBtn(),"CITY"==e?(this.mainUI.vs_top_left.selectedIndex=0,this.sendNotification(CN.SWITCH_TO_CITY)):this.mainUI.vs_top_left.selectedIndex=1)},n.prototype.bindBtn=function(i,e,t){if(void 0===t&&(t=!1),e.isOpenCheck&&(i.isOpenCheck=e.isOpenCheck),e.updateFunc){var n;if(Array.isArray(e.updateId))n=[],e.updateId.forEach(function(e){var t=i[e]||i.parent&&i.parent[e];t&&(t.name=e,n.push(t))});else{var o=i[e.updateId];o.name=e.updateId,n=o}i.updateFunc=function(){e.updateFunc(n)},i.parent.gp_bottom&&(i.parent.gp_bottom.visible=!0)}i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t&&(i.touchEnabled=!1,e.jumpModule!=this.lastEvent&&this.lastbtn&&(this.lastbtn.touchEnabled=!0),this.lastEvent=e.jumpModule,this.lastbtn=i),null!=e.clickFunc?e.clickFunc():x.MainJumpConfig.jumpTo(e.jumpModule)},this)},n.prototype.makeTopXXBtnGP=function(t,e){var i=new eui.Group;i.touchEnabled=!1;var n=new eui.Button;t.name?(n.skinName="skins.ButtonSkinIcon2",n.label=t.name):n.skinName="skins.ButtonSkinIcon",RES.hasRes(t.img)?n.icon=t.img:n.icon="",n.x=t.posX||0,n.y=t.posY||0,n.name="btn",i.addChild(n);var o=new eui.Group,a=new eui.Image("common_img_heiditiao_08_png");o.width=a.width=81,o.height=a.height=22,a.x=a.y=0;var r=new eui.BitmapLabel;if(r.horizontalCenter=0,r.verticalCenter=0,r.scaleX=r.scaleY=.6,r.name="bm_time",r.font="white_num_fnt",o.addChild(a),o.addChild(r),o.bottom=-20,o.horizontalCenter=0,i.addChild(o),i.bm_time=r,i.gp_bottom=o,i.btn=n,o.visible=!1,n.width=i.width=t.width||e[0],n.height=i.height=t.height||e[1],t.scale&&(i.scaleX=i.scaleY=t.scale),t.effect&&!Utils.ResourceUtils.behaviourWeakConfig.GUAJI_MAIN_BTN_EFF&&MovieClipTools.create(t.effect,function(e){n.addChild(e),e.scaleX=e.scaleY=t.effectOffset&&t.effectOffset[2]||.95,e.x=.5*n.width+(t.effectOffset&&t.effectOffset[0]||0),e.y=.5*n.height+(t.effectOffset&&t.effectOffset[1]||0),e.animation&&e.animation.play&&e.animation.play(t.effect,-1)},this),t.effectBg){var s=i.effectBg;s||((s=new customui.SteadyArmature).x=i.width/2,s.y=i.height/2,i.addChild(s),i.effectBg=s),s.armatureName=t.effectBg}return i},n.prototype.bindBottomFiveBtn=function(e,t){var i=this.mainUI.gp_bottom.getChildAt(t+1);if(e.scale&&(i.scaleX=i.scaleY=e.scale),e.noticeType);return i},n.prototype.changeStyle=function(e){this.mainUI&&(this.mainUI.changeStyle(e),this.switchViewGroup(x.MainJumpConfig.lastEvent))},n.prototype.recalSizeGpTop=function(){},n.prototype.handleBanner=function(){return __awaiter(this,void 0,void 0,function(){var t,i,n=this;return __generator(this,function(e){switch(e.label){case 0:return this.bannerScheId?[2]:(t=0)===this.mainProxy.broadcastChatList.length||"FIGHT"==x.MainJumpConfig.getCurEvent()||"ZZQ"==x.MainJumpConfig.getCurEvent()?(Utils.MsgUtils.switchBannerBg(!1),[2]):(t=7e3,[4,Utils.MsgUtils.switchBannerBg(!0)]);case 1:return e.sent(),this.bannerScheId||(this.bannerScheId=egret.setTimeout(function(){n.bannerScheId=void 0,n.handleBanner()},this,t),i=this.mainProxy.broadcastChatList.shift(),Utils.MsgUtils.addBannerMsg(i,t-500)),[2]}})})},n.N="MainMediator",n.SV={MAIN:1},n}(BaseMediator);x.MainMediator=e,__reflect(e.prototype,"game.MainMediator")}(game||(game={})),function(r){var e=function(){function e(){}return e.registerAll=function(){(new o).register(),(new a).register(),(new s).register(),(new n).register(),(new i).register(),(new t).register(),(new l).register(),(new c).register()},e}();r.MainProcessor=e,__reflect(e.prototype,"game.MainProcessor");var t=function(e){function t(){return e.call(this,"coordinate.CoordinateInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){if(this.checkCB(e.getBody())){var t=e.getBody();if(!t)return;r.AppFacade.getInstance().retrieveProxy(r.MainPy.N).updateCoordinate(t.type,t.infos)}},t}(r.ProcessorBase);r.CoordinateInfoP=t,__reflect(t.prototype,"game.CoordinateInfoP");var i=function(e){function t(){return e.call(this,"unlock.UnlockRewardInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){if(this.checkCB(e.getBody())){var t=r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N),i=e.getBody();if(i&&i.info)for(var n=0,o=i.info;n<o.length;n++){var a=o[n];t.handleClientRewardCore(a.clientReward)}}},t}(r.ProcessorBase);r.UnlockRewardInfoP=i,__reflect(i.prototype,"game.UnlockRewardInfoP");var n=function(e){function t(){return e.call(this,"playerInfo.PushRewardP",t)||this}return __extends(t,e),t.prototype.execute=function(e){if(this.checkCB(e.getBody())){var t=e.getBody(),i=r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N);switch(t.rewardSource){case PushRewardSource.Redeem:case PushRewardSource.RiskEvent:i.handleClientReward(t.clientReward)}}},t}(r.ProcessorBase);r.PushRewardP=n,__reflect(n.prototype,"game.PushRewardP");var o=function(e){function t(){return e.call(this,"test.CommonR",t)||this}return __extends(t,e),t.prototype.execute=function(e){Utils.MsgUtils.addMidMsg("修改成功");var t=e.getBody(),i=r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N),n=r.AppFacade.getInstance().retrieveProxy(r.PlayerPy.N);switch(t.key){case"test.addItemR":t.num&&i.handleClientRewardCore({rewards:{1:{type:EEntityType.EEntityTypeItem,code:t.code,num:t.num}}});break;case"test.AddVestageItemR":t.clientReward&&(i.handleClientRewardCore(t.clientReward),r.AppFacade.getInstance().updateView(r.DungeonMed.N,r.DungeonMed.SV.MAP));break;case"test.addMoneyR":t.playerMoney&&(n.playerInfoVO.updateMoney(t.playerMoney),this.sendNotification(CN.PLAYER_INFO_UPDATE));break;default:t.clientReward&&i.handleClientRewardCore(t.clientReward),r.AppFacade.getInstance().retrieveProxy(r.PlayerPy.N).GetPlayerInfo(),r.AppFacade.getInstance().retrieveProxy(r.GuildPy.N).getPlayerGuildReq()}},t}(r.ProcessorBase);r.TestCommonR=o,__reflect(o.prototype,"game.TestCommonR");var a=function(e){function t(){return e.call(this,"chat.NewMessageP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();if(t){var i=r.AppFacade.getInstance().retrieveProxy(r.FriendPy.N);if((!t.message.fromPlayer||!i.isInBlacklist(t.message.fromPlayer.playerId))&&(t.message.channelType!=EChatChannelType.EChatChannelTypePrivate||Utils.UnlockMgr.checkPass(MODULE.ChatPrivate,!1).allow))try{var n=r.AppFacade.getInstance().retrieveProxy(r.MainPy.N),o=n.preTreatMsg(t.message);if(o){if(48==o.broadcastId)return void egret.setTimeout(function(){n.onReceiveMsg(o)},this,1e4);n.onReceiveMsg(o)}}catch(e){this.log("广播处理失败",t)}}},t}(r.ProcessorBase);r.NewMessageP=a,__reflect(a.prototype,"game.NewMessageP");var s=function(e){function t(){return e.call(this,"chat.BroadcastP",t)||this}return __extends(t,e),t.prototype.execute=function(e){e.getBody()},t}(r.ProcessorBase);r.BroadcastP=s,__reflect(s.prototype,"game.BroadcastP");var c=function(e){function t(){return e.call(this,"chat.ServerBlackListP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();r.GameMVC.mainPy.serverBlackList=t.playerIdList},t}(r.ProcessorBase);r.ServerBlackListP=c,__reflect(c.prototype,"game.ServerBlackListP");var l=function(e){function t(){return e.call(this,"chat.DeleteChatMsgP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();r.AppFacade.getInstance().retrieveProxy(r.MainPy.N).deleteChatList(t)},t}(r.ProcessorBase);r.DeleteChatMsgP=l,__reflect(l.prototype,"game.DeleteChatMsgP")}(game||(game={})),function(d){var e=function(n){function o(){var e,t=n.call(this,o.N)||this;for(var i in t.scheId=void 0,t.maxMsgShow=15,t.curChannel=EChatChannelType.SameServer,t.serverBlackList=[],t.maxPrivatePlayerNum=5,t.addedPrivatePlayerList=[],t.playerProxy=d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N),t.fightPy=d.AppFacade.getInstance().retrieveProxy(d.FightPy.N),t.noticesTag={},t.channel_2_notice=((e={})[EChatChannelType.SameServer]=NT.CHAT_SAME_SERVER,e[EChatChannelType.EChatChannelTypeGuild]=NT.CHAT_GUILD,e[EChatChannelType.EChatChannelTypeZone]=NT.CHAT_ZONE,e[EChatChannelType.EChatChannelTypePrivate]=NT.CHAT_PRIVATE,e),t.ChatList=new Array,t.ChatList.push(new Array),EChatChannelType)t.ChatList.push(new Array);return t.broadcastChatList=new Array,t.coordinateBases={},NoticeManager.setChildType(NT.CHAT_MAIN,[NT.CHAT_GUILD,NT.CHAT_PRIVATE,NT.CHAT_SAME_SERVER,NT.CHAT_ZONE]),NoticeManager.setChildType(NT.CHAT_MAIN2,[NT.CHAT_GUILD,NT.CHAT_PRIVATE,NT.CHAT_SAME_SERVER,NT.CHAT_ZONE]),NoticeManager.registerCB([NT.CHAT_GUILD],function(){return d.GameMVC.guildPy.isInGuild()&&t.checkNotice(EChatChannelType.EChatChannelTypeGuild)},t,MODULE.Chat),NoticeManager.registerCB([NT.CHAT_PRIVATE],function(){return t.checkNotice(EChatChannelType.EChatChannelTypePrivate)},t,MODULE.Chat),NoticeManager.registerCB([NT.CHAT_SAME_SERVER],function(){return t.checkNotice(EChatChannelType.SameServer)},t,MODULE.Chat),NoticeManager.registerCB([NT.CHAT_ZONE],function(){return t.checkNotice(EChatChannelType.EChatChannelTypeZone)},t,MODULE.Chat),t}return __extends(o,n),o.prototype.checkNotice=function(e){return Utils.UnlockMgr.checkPass(MODULE.Chat,!1)&&!!this.noticesTag[e]},o.prototype.getAllChatList=function(){for(var e in EChatChannelType)EChatChannelType[e]!=EChatChannelType.EChatChannelTypeWorld&&this.getChatList(EChatChannelType[e]);this.maxMsgShow=parseInt(d.Config.constConfig().SystemMessageShowMax.constValue)},o.prototype.getServerBlackList=function(){var t=this;Utils.Socket.send("chat","GetServerBlackList",{}).then(function(e){t.serverBlackList=e.playerIdList})},o.prototype.makeTextStyle=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t=void 0),void 0===i&&(i=[]);var n=i&&0<i.length;return{text:e,style:{textColor:t,href:n?"event:"+JSON.stringify(i):void 0,underline:n}}},o.prototype.getTrueParams=function(e,t,i,n){var o=[];if(t&&i){for(var a=0;a<i.length;a++)o.push(i[a]);for(a=0;a<e.length;a++)o[a+1]||(o[a+1]=e[a])}else for(a=0;a<e.length;a++)o.push(e[a]);var r=void 0;if(o[1]&&""!=o[1])o[0]==EChatJumpType.JumpModule?r=n==EChatChannelType.EChatChannelTypePrivate?3115552:1244928:o[0]==EChatJumpType.ShowInfo&&(o[3]!=EEntityType.EEntityTypePlayer&&o[3]!=EEntityType.EEntityTypeGuild||(r=n==EChatChannelType.EChatChannelTypePrivate?2263677:1048560));else{var s=o[2],c=Math.floor(Number(s)/1e7),l=d.GeneralConfig.getEntityConfigByCode(void 0,s);if(l)if(o[1]=l.name,c!=EEntityType.EEntityTypeHero)r=COLOR_2_FONT_COLOR[l.color||l.initStar];else{var h=l.initStar;[[1,2],[3,3],[4,5],[6,9],[10,13],[14,15]].forEach(function(e,t){h>=e[0]&&h<=e[1]&&(r=0==t?COLOR_2_FONT_COLOR[t+2]:COLOR_2_FONT_COLOR[t+1])})}}return o[2]||o[3]?{text:o[1]+"",params:[o[0]].concat(o.slice(2)),color:r}:{text:o[1]+"",params:[],color:n==EChatChannelType.EChatChannelTypePrivate?12603493:16773120}},o.prototype.preTreatMsg=function(n){var a=this,o=[],r=[];if(n.broadcastId){var e=d.Config.broadcastConfig()[n.broadcastId];if(!e)return n;1!=n.broadcastId&&(n.content=e.content),o=JSON.parse(e.param),n.ShowType=e.show,r=JSON.parse(e.colorOffect)}else n.ShowType=SystemMessageShow.ChatChannel;var s=JSON.parse(n.params);25==n.broadcastId&&(s[2][0]=s[2][0]%5==0?5:s[2][0]%5);var t=n.content.split("%s"),c=[],l=0;t.forEach(function(e,t){if(c.push({text:e}),s[t]){var i=a.getTrueParams(s[t],n.broadcastId,o[t],n.channelType);c.push({text:i.text,color:i.color,params:i.params,colorOffect:r[l++]})}}),c.forEach(function(e,t){e.colorOffect&&(e.colorOffect[0]||e.colorOffect[1])&&(e.colorOffect[0]&&c[t-1]&&(c[t-1].selfOffect2={offect:e.colorOffect[0],color:e.color}),e.colorOffect[1]&&c[t+1]&&(c[t+1].selfOffect1={offect:e.colorOffect[1],color:e.color}))});var h=[];if(c.forEach(function(e,t){if(e.selfOffect1||e.selfOffect2){var i=e.text;if(e.selfOffect1){var n=i.slice(0,e.selfOffect1.offect);i=i.slice(e.selfOffect1.offect,i.length),h.push(a.makeTextStyle(n,e.selfOffect1.color,e.params))}if(e.selfOffect2){var o=e.text.slice(e.text.length-e.selfOffect2.offect,e.text.length);i=i.slice(0,i.length-e.selfOffect2.offect),h.push(a.makeTextStyle(i,e.color,e.params)),h.push(a.makeTextStyle(o,e.selfOffect2.color,e.params))}else h.push(a.makeTextStyle(i,e.color,e.params))}else h.push(a.makeTextStyle(e.text,e.color,e.params))}),h=h.filter(function(e){return!!e.text},this),29==n.broadcastId)for(var i=0;i<2;i++)for(var p in h){if("、"==h[p].text&&"0"==h[parseInt(p)+1].text){h.splice(parseInt(p),2);break}}return n.textFlow=h,n},o.prototype.SendMessage=function(e,t,i,n,o,a,r){var s=this;void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=""),void 0===r&&(r=!1),r||!this.scheId?(e==EChatChannelType.EChatChannelTypeZone&&(e=EChatChannelType.EChatChannelNewZone),this.checkTextVaild(t,function(){Utils.Socket.send("chat","SendMessage",{channelType:e,content:t,playerId:i,checkType:o,params:a}).then(function(){n&&n(),s.setInterval()})})):Utils.MsgUtils.addMidMsg("口干舌燥，请休息一会")},o.prototype.checkTextVaild=function(e,t,i,n){void 0===i&&(i=13),void 0===n&&(n="输入内容不合法"),Utils.SDKMgr.getPerformConfig(i)?Utils.SDKMgr.cmd({type:"CheckTextVaild",text:e},function(e){e.vaild?t&&t():Utils.MsgUtils.addMidMsg(n)}):t&&t()},o.prototype.setInterval=function(){var e=this,t=d.Config.constConfig().chatSendDuration.constValue,i=d.AppFacade.getInstance().retrieveMediator(d.ChatMediator.N).getSubView(d.ChatMediator.SV.CHAT);i&&i.updateInterval(t),this.scheId||(this.scheId=egret.setInterval(function(){(t-=1e3)<=0&&(egret.clearInterval(e.scheId),e.scheId=void 0),i&&i.updateInterval(t)},this,1e3))},o.prototype.bindChatLinkJump=function(e,t){try{var i=JSON.parse(e.text);switch(i[0]){case EChatJumpType.JumpModule:this.jumpModule(i,t);break;case EChatJumpType.ShowInfo:this.showInfo(i)}}catch(e){this.log(e)}},o.prototype.showInfo=function(e){if(this.fightPy.isInFight)this.log("战斗中无法跳转");else{var t=e[1];switch(e[2]){case EEntityType.EEntityTypePlayer:d.AppFacade.getInstance().showSubView(d.FriendMediator.N,d.FriendMediator.SV.INFO,{playerId:t});break;case EEntityType.EEntityTypeHero:d.AppFacade.getInstance().showSubView(d.HeroMediator.N,d.HeroMediator.SV.HERO_DETAIL,{code:t});break;case EEntityType.EEntityTypeGuild:d.AppFacade.getInstance().retrieveProxy(d.GuildPy.N).GetGuildBaseInfo(t,function(e){d.AppFacade.getInstance().showSubView(d.GuildMediator.N,d.GuildMediator.SV.INFO,e)});break;case EEntityType.EEntityTypeMoney:case EEntityType.EEntityTypeItem:PopUpManager.addPopUp({obj:new d.BaseItemDetailView({code:t})});break;default:return}}},o.prototype.jumpModule=function(e,t){if(this.fightPy.isInFight)this.log("战斗中无法跳转");else{var i=e[1],n=e[2];if(n==MODULE.GuildHall){if(!Utils.UnlockMgr.checkPass(MODULE.Guild,!0).allow)return}else if(!Utils.UnlockMgr.checkPass(n,!0).allow)return;switch(d.GameMVC.DeepNestPy.isFirst=!0,n){case MODULE.TeamExpedition:var o=d.AppFacade.getInstance().retrieveProxy(d.TeamExpePy.N),a=function(){var e=t&&t.channelType==EChatChannelType.EChatChannelTypePrivate;o.Apply(i,function(){e&&(d.MainJumpConfig.jumpTo(MODULE.TeamExpedition),d.AppFacade.getInstance().showSubView(d.TeamExpeMediator.N,d.TeamExpeMediator.SV.JIJIE_MY_TEAM))},e)};o.info?o.isInTeam()?o.info.teamInfo.team.id!=i?d.GameMgr.getInstance().showCommonTipsWin({commonTips:"你现在已经在其他队伍中\n是否退出并加入该队伍？",clickCB:function(e){1==e.type&&o.Quit(function(){a()},!0)}}):Utils.MsgUtils.addMidMsg("你已经在该队伍了"):a():o.GetTeamExpeditionInfo(a);break;case MODULE.TeamArena:var r=d.AppFacade.getInstance().retrieveProxy(d.BattleZoneArenaPy.N),s=function(){d.MainJumpConfig.jumpTo(MODULE.TeamArena),r.Apply(i,function(){d.AppFacade.getInstance().showSubView(d.BattleZoneArenaMediator.N,d.BattleZoneArenaMediator.SV.JIJIE_MY_TEAM)},t&&t.channelType==EChatChannelType.EChatChannelTypePrivate)};r.arenaInfo?s():r.GetBattleZoneArenaInfo(s);break;case MODULE.GuildHall:return(c=d.AppFacade.getInstance().retrieveProxy(d.GuildPy.N)).isInGuild()?void Utils.MsgUtils.addMidMsg("已在公会中"):void c.operationReq(EGuildOperationType.Join,i,function(){Utils.MsgUtils.addMidMsg("申请成功")});case MODULE.Wchess:(c=d.AppFacade.getInstance().retrieveProxy(d.ZzqPy.N)).isIdle()?d.MainJumpConfig.jumpTo("ZZQ",void 0,{id:e[1]}):c.isCanJoinTeam()?c.JoinRoom(e[1]):Utils.MsgUtils.addMidMsg("当前已在房间，无法加入");break;case MODULE.RiskMulti:(c=d.AppFacade.getInstance().retrieveProxy(d.GuajiPy.N)).riskMultiRoomInfo.id&&1!=c.riskMultiRoomInfo.members.length?Utils.MsgUtils.addMidMsg("当前已在房间，无法加入"):c.RiskMultiCommand("ApplyRoom",{id:e[1],isInvite:!0},function(){d.MainJumpConfig.jumpTo(MODULE.RiskMulti)});break;case MODULE.ChampionHelp:var c;(c=d.AppFacade.getInstance().retrieveProxy(d.ChampionPy.N)).HelpChallenge(i);break;case MODULE.Manor:d.MainJumpConfig.jumpTo(MODULE.Manor);break;default:d.MainJumpConfig.jumpTo(n)}d.AppFacade.getInstance().hideSubView(d.ChatMediator.N,d.ChatMediator.SV.CHAT)}},o.prototype.BroadcastMsgProcess=function(e){var t=new d.SChatMsg(e);return t.content=t.content.replace(/#324450/g,"#ffffff"),t.content=t.content.replace(/#007fba/g,"#00d8ff"),t.content=t.content.replace(/#00984b/g,"#ffde00"),t},o.prototype.onReceiveMsg=function(e){if(e){this.log("收到新消息",e);var t=!1;if(e.ShowType!=SystemMessageShow.Broadcast&&e.ShowType!=SystemMessageShow.BroadChatChannel||(e.channelType===EChatChannelType.EChatChannelTypeSystem&&(this.broadcastChatList.push(this.preTreatMsg(e)),this.broadcastChatList.sort(function(e,t){if(e.sendDt-t.sendDt!=0)return t.sendDt-e.sendDt})),this.ChatList[e.channelType].push(e),t=!0),e.channelType==EChatChannelType.EChatChannelTypePrivate){var i=d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N),n=e.fromPlayer.playerId;n==i.playerInfoVO.playerId&&(n=e.toPlayer.playerId),this.setLastPrivateTalk(n,e.sendDt)}e.ShowType!=SystemMessageShow.ChatChannel&&e.ShowType!=SystemMessageShow.BroadChatChannel||t||this.ChatList[e.channelType].push(e),e.channelType!=EChatChannelType.EChatChannelTypePrivate&&this.ChatList[e.channelType].length>this.maxMsgShow&&this.ChatList[e.channelType].splice(0,this.ChatList[e.channelType].length-this.maxMsgShow),this.facade.sendNotification(CN.MAIN_CHAT_UPDATE,e);var o=e.channelType;if(!this.noticesTag[o]&&o!=EChatChannelType.EChatChannelTypeSystem){var a=d.AppFacade.getInstance().retrieveMediator(d.ChatMediator.N).getSubView(d.ChatMediator.SV.CHAT);o==EChatChannelType.EChatChannelNewZone&&(o=EChatChannelType.EChatChannelTypeZone),a&&o==this.curChannel||(this.noticesTag[o]=!0,NoticeManager.updateNotice(this.channel_2_notice[o],o))}}},o.prototype.setLastPrivateTalk=function(e,t){if(e&&t){var i=!1;for(var n in this.addedPrivatePlayerList){var o=this.addedPrivatePlayerList[n];if(o.baseInfo.playerId==e){o.dt=t,i=!0,this.addedPrivatePlayerList.sort(function(e,t){return t.dt-e.dt}),d.AppFacade.getInstance().sendNotification(CN.MAIN_CHAT_PRIVATEPLAYER_UPDATE);break}}i||this.addPrivatePlayer(e)}else 0<this.addedPrivatePlayerList.length?(this.curPrivateChoseId=this.addedPrivatePlayerList[0].baseInfo.playerId,this.curPrivateChoseName=this.addedPrivatePlayerList[0].baseInfo.name):(this.curPrivateChoseId=void 0,this.curPrivateChoseName=void 0);return this.curPrivateChoseId},o.prototype.addPrivatePlayer=function(e){var t=this;e&&Utils.Socket.send("chat","AddChatList",{tPlayerId:e}).then(function(e){t.updateResentPrivatePlayer(e.chatList)})},o.prototype.removePrivateChatPlayer=function(e){var t=this;e&&Utils.Socket.send("chat","RemoveChatList",{tPlayerId:e}).then(function(e){t.updateResentPrivatePlayer(e.chatList)})},o.prototype.updateResentPrivatePlayer=function(n,e){var o=this;this.addedPrivatePlayerList=[];var t=[],i=d.AppFacade.getInstance().retrieveProxy(d.FriendPy.N);for(var a in n.sort(function(e,t){return e.dt-t.dt}),n.length>this.maxPrivatePlayerNum&&n.splice(0,n.length-this.maxPrivatePlayerNum),n){var r=n[a];i.isInBlacklist(r.playerId)||t.push(r.playerId)}d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N).GetPublicPlayerBaseInfo(t,function(e,t){for(var i in e)e[i].dt=n[i].dt,o.addedPrivatePlayerList.push(e[i]);o.addedPrivatePlayerList.sort(function(e,t){return t.dt-e.dt}),o.setLastPrivateTalk(),d.AppFacade.getInstance().sendNotification(CN.MAIN_CHAT_UPDATE),d.AppFacade.getInstance().sendNotification(CN.MAIN_CHAT_PRIVATEPLAYER_UPDATE)})},o.prototype.getPrivateChatPlayerList=function(){var e=[],t=d.AppFacade.getInstance().retrieveProxy(d.FriendPy.N);for(var i in this.addedPrivatePlayerList){var n=this.addedPrivatePlayerList[i];t.isInBlacklist(n.baseInfo.playerId)||e.push(n)}return e},o.prototype.getDataProvider=function(t,i,e){var n=new Array,o=d.AppFacade.getInstance().retrieveProxy(d.FriendPy.N),a=d.Config.broadcastConfig();if(t==EChatChannelType.SameServer){d.GameMVC.loginPy;this.ChatList[EChatChannelType.EChatChannelTypeSystem].forEach(function(e){e.broadcastId&&a[e.broadcastId]?0<=JSON.parse(a[e.broadcastId].channel).indexOf(EChatChannelType.EChatChannelTypeSystem)&&n.push(e):n.push(e)}),this.ChatList[t].forEach(function(e){n.push(e)})}else t==EChatChannelType.EChatChannelTypePrivate?this.ChatList[EChatChannelType.EChatChannelTypePrivate].forEach(function(e){(e.fromPlayer&&e.fromPlayer.playerId==i||e.toPlayer&&e.toPlayer.playerId==i)&&n.push(e)}):t==EChatChannelType.EChatChannelTypeZone?(this.ChatList[EChatChannelType.EChatChannelTypeZone].forEach(function(e){n.push(e)}),this.ChatList[EChatChannelType.EChatChannelNewZone].forEach(function(e){n.push(e)}),this.ChatList[EChatChannelType.EChatChannelTypeSystem].forEach(function(e){e.broadcastId&&a[e.broadcastId]&&(0<=JSON.parse(a[e.broadcastId].channel).indexOf(t)&&n.push(e))})):(this.ChatList[EChatChannelType.EChatChannelTypeSystem].forEach(function(e){e.broadcastId&&a[e.broadcastId]&&(0<=JSON.parse(a[e.broadcastId].channel).indexOf(t)&&n.push(e))}),this.ChatList[t].forEach(function(e){n.push(e)}));var r=new Array;for(var s in n){var c=n[s];c.fromPlayer&&(o.isInBlacklist(c.fromPlayer.playerId)||0<=this.serverBlackList.indexOf(c.fromPlayer.playerId))||r.push(c)}r.sort(function(e,t){return e.sendDt-t.sendDt});var l=parseInt(d.Config.constConfig().SystemMessageShowMax.constValue);return r.length>l&&(r=r.slice(r.length-l)),r},o.prototype.getChatList=function(o,a){var r=this,e=0;for(var t in this.ChatList[o]){var i=this.ChatList[o][t].msgId;e=i<e?e:i}Utils.Socket.send("chat","GetChatList",{msgId:e,channelType:o}).then(function(e){r.ChatList[o].splice(0,r.ChatList[o].length);for(var t=0,i=e.messageList;t<i.length;t++){var n=i[t];r.ChatList[o].push(r.preTreatMsg(n))}r.ChatList[o].sort(function(e,t){return e.sendDt-t.sendDt}),o==EChatChannelType.EChatChannelTypePrivate&&r.updateResentPrivatePlayer(e.chatList),a&&a(e)}).catch(function(e){})},o.prototype.deleteChatList=function(e){for(var t in this.ChatList){var i=this.ChatList[t],n=!1;for(var o in i){var a=i[o];for(var r in e){var s=e[r];if(a.msgId==s){i.splice(parseInt(o),1),n=!0;break}}if(n)break}}},o.prototype.getMyCoordinateInfo=function(e){if(this.coordinateBases[e])return this.coordinateBases[e].me},o.prototype.getOtherCoordinateInfo=function(e){if(this.coordinateBases[e])return this.coordinateBases[e].others},o.prototype.updateCoordinate=function(e,t){if(Array.isArray(t)){this.coordinateBases[e]||(this.coordinateBases[e]={me:void 0,others:new Array});for(var i=this.coordinateBases[e].others,n=0,o=0,a=t;o<a.length;o++){var r=a[o];if(r.playerBaseInfo&&r.playerBaseInfo.playerId){if(r.playerBaseInfo.playerId==this.playerProxy.playerInfoVO.playerId){this.coordinateBases[e].me||(this.coordinateBases[e].me=new d.SCoordianteBase),this.coordinateBases[e].me.update(r),this.coordinateBases[e].me.amILeader=!0;continue}}else{var s=!1;r.team.leader==this.playerProxy.playerInfoVO.playerId&&(s=!0);for(var c=0,l=r.team.members;c<l.length;c++){l[c].baseInfo.playerId!=this.playerProxy.playerInfoVO.playerId||(this.coordinateBases[e].me||(this.coordinateBases[e].me=new d.SCoordianteBase),this.coordinateBases[e].me.update(r),this.coordinateBases[e].me.amILeader=s)}}i[n]?i[n].update(r):i.push(new d.SCoordianteBase(r)),n++}i.splice(n),d.AppFacade.getInstance().sendNotification(CN.MAIN_COORDINATEINFO_UPDATE,{type:e})}},o.prototype.GetCoordinateInfo=function(t,i){var n=this;Utils.Socket.send("coordinate","GetCoordinateInfo",{type:t}).then(function(e){n.updateCoordinate(t,e.infos),i&&i()})},o.prototype.SyncCoordinateInfo=function(e,t,i,n,o){var a=this,r=this.getMyCoordinateInfo(n);if(r&&r.amILeader){var s={x:null==e?r.coordinate.x:Number(e),y:null==t?r.coordinate.y:Number(t),z:null==i?r.coordinate.z:Number(i)};Utils.Socket.send("coordinate","SyncCoordinateInfo",{type:n,coordinate:s}).then(function(e){var t=a.getMyCoordinateInfo(n);t.coordinate.x=s.x,t.coordinate.y=s.y,t.coordinate.z=s.z,d.AppFacade.getInstance().sendNotification(CN.MAIN_COORDINATEINFO_UPDATE,{type:n}),o&&o()})}else console.log("C2S同步坐标失败!")},o.N="MainProxy",o}(BaseProxy);d.MainPy=e,__reflect(e.prototype,"game.MainPy")}(game||(game={})),function(l){var e=function(t){function e(){var o=t.call(this)||this;return o.resFullImg=new eui.Image("_main_m_json.maoxian_icon_man"),o.lastRecordTime=0,o.isHasClosePet=!1,o.playerProxy=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),o.loginPy=l.AppFacade.getInstance().retrieveProxy(l.LoginPy.N),o.VIP_CONFIG={1:"common_VIPhuizhang",2:"common_VIPhuizhang2"},o.PLUG_CONFIG=[{pb:"【测试】手动进入天梯赛",cb:function(){Utils.Socket.send("test","EnterHighLadder",{}).then(function(e){})}},{pb:"【测试】天梯赛加机器人",cb:function(){Utils.Socket.send("test","PeakWarAddRobot",{}).then(function(e){})}},{pb:"【测试入口】矿战",cb:function(){l.MainJumpConfig.jumpTo(MODULE.Manor)}},{pb:"显示服务器时间",cb:function(){l.AppFacade.getInstance().sendNotification(CN.MAIN_DEBUG_INFO_UPDATE,{serverTime:!0})}},{pb:"风暴战场添加机器人外挂",cb:function(){Utils.Socket.send("test","AddStormWarRobot",{}).then(function(e){})}},{pb:"上报性能信息",cb:function(){o.changePlugFloatView(!o.gp_plug.visible);if(egret.Tween._tweens&&Array.isArray(egret.Tween._tweens)){"缓动数量:"+egret.Tween._tweens.length;for(var e=0,t=0,i=egret.Tween._tweens;t<i.length;t++){var n=i[t];n._target.stage||(e++,egret.Tween.removeTweens(n._target))}"_清空数量:"+e}DragonBoneTools.dbStatus()}},{pb:"_d",inputs:[["name","string"]],cb:function(e){var t=e.name,i=Utils.ComponentUtils.getComponentByName(t);i?(Utils.MsgUtils.addMidMsg("Done."),window._d=i):Utils.MsgUtils.addMidMsg("无效控件名")}},{pb:"战斗测试",cb:function(){o.changePlugFloatView(!o.gp_plug.visible),l.MainJumpConfig.jumpTo("FIGHT_TEST",!1,{type:l.FightTestInput.FIGHT_TYPE.REGULAR})}},{pb:"开场动画测试",cb:function(){o.gp_plug.visible=!1,PopUpManager.addPopUp({effectType:0,obj:new l.StartAnimation})}},{pb:"自走棋战斗测试",cb:function(){o.changePlugFloatView(!o.gp_plug.visible),l.MainJumpConfig.jumpTo("FIGHT_TEST",!1,{type:l.FightTestInput.FIGHT_TYPE.CHESS})}},{pb:"打开战斗跳过",cb:function(){l.AppFacade.getInstance().retrieveProxy(l.FightPy.N).forceCanSkip=!0}},{pb:"【快捷操作】一堆经验",inputs:[],cb:function(e){for(var t in EExpType){var i=EExpType[t];Utils.Socket.send("test","addExp",{code:i,num:99999999999}).then(function(e){})}}},{pb:"【快捷操作】一堆钱",inputs:[],cb:function(e){for(var t in EPropertyType){var i=EPropertyType[t];Utils.Socket.send("test","addMoney",{code:i,num:999999999}).then(function(e){})}}},{pb:"【快捷操作】\n1:全套神器\n2:全套装备\n3:全套宝物+宝石\n9:王+一堆培养材料+经验",inputs:[["type","string"]],cb:function(e){if(1==e.type){var t=l.Config.getHeroArtifactConfig();for(var i in t)Utils.Socket.send("test","addHeroArtifact",{code:Number(i),num:2==t[i].type?100:1})}else if(2==e.type){t=l.Config.getHeroEquipConfig();for(var i in t)Utils.Socket.send("test","addHeroEquip",{code:Number(i),num:1})}else if(3==e.type){t=l.Config.getHeroTreasureConfig();for(var i in t)Utils.Socket.send("test","addTreasure",{code:Number(i),num:1});Utils.Socket.send("test","addItem",{code:Number(30000009),num:100}),Utils.Socket.send("test","addItem",{code:Number(30000010),num:100}),Utils.Socket.send("test","addItem",{code:Number(30000011),num:100}),Utils.Socket.send("test","addItem",{code:Number(30000012),num:100})}else 9==e.type&&(Utils.Socket.send("test","addHeroNew",{code:41000001,num:1}),Utils.Socket.send("test","addItem",{code:30000001,num:1e6}),Utils.Socket.send("test","addItem",{code:30000002,num:1e6}),Utils.Socket.send("test","addItem",{code:30000003,num:1e6}),Utils.Socket.send("test","addItem",{code:30000004,num:1e6}),Utils.Socket.send("test","addItem",{code:30000005,num:1e6}),Utils.Socket.send("test","addMoney",{code:1,num:1e6}),Utils.Socket.send("test","addMoney",{code:2,num:1e6}))}},{pb:"【快捷操作】直接上王",inputs:[],cb:function(e){Utils.Socket.send("test","addHeroNew",{code:41000001,num:1}).then(function(e){for(var t=l.AppFacade.getInstance().retrieveProxy(l.HeroPy.N),i=0,n=1;n<=6;n++)if(!t.heroUuid22Pos[n]){i=n;break}i&&t.HeroPutOn({uuid:e.clientReward.heros[0].uuid,pos:i})})}},{pb:"【快捷操作】全套N星英雄",inputs:[["N","number"]],cb:function(e){var t=l.Config.allHeroConfig();for(var i in t){var n=t[i];n.initStar==e.N&&Utils.Socket.send("test","addHeroNew",{code:n.code,num:1}).then(function(e){})}}},{pb:"【快捷操作】一键英雄999",inputs:[],cb:function(e){Utils.Socket.send("test","UpHeroMax",{})}},{pb:"【快捷操作】冒险进入下一层",inputs:[],cb:function(e){Utils.Socket.send("test","EnterNextLayer",{})}},{pb:"【快捷操作】冒险进入上一层",inputs:[],cb:function(e){Utils.Socket.send("test","EnterPreLayer",{})}},{pb:"【快捷操作】完成冒险主线任务",inputs:[],cb:function(e){Utils.Socket.send("test","RiskTaskUnlock",{})}},{pb:"【快捷操作】英雄挑战模式切换",inputs:[],cb:function(e){Utils.Socket.send("test","HeroChallengeNextModel",{})}},{pb:"【快捷操作】英雄挑战跳关",inputs:[["level","number"]],cb:function(e){Utils.Socket.send("test","HeroChallengeJump",{num:e.level})}},{pb:"【快捷操作】组队副本跳关",inputs:[["level","number"]],cb:function(e){Utils.Socket.send("test","SetTeamExpeditionNum",{num:e.level})}},{pb:"【快捷操作】爬塔跳关",inputs:[["level","number"]],cb:function(e){Utils.Socket.send("test","setChampionNum",{num:e.level})}},{pb:"【快捷操作】勇士令状切章节",inputs:[],cb:function(e){Utils.Socket.send("test","DoneAllNewBraveBookTasks",{})}},{pb:"【快捷操作】触发魔神",inputs:[],cb:function(e){Utils.Socket.send("test","TriggerDemon",{}).then(function(){l.GameMVC.guajiPy.GetDemonList()})}},{pb:"【快捷操作】成就加进度",inputs:[["taskSubType","number"],["taskKey","number"]],cb:function(e){Utils.Socket.send("test","HandleUpdateProgress",{taskSubType:e.taskSubType,taskKey:e.taskKey}).then(function(){})}},{pb:"【快捷操作】自走棋提前结束",inputs:[],cb:function(e){Utils.Socket.send("test","FinishWchess",{})}},{pb:"【组队竞技】time",inputs:[],cb:function(e){Utils.Socket.send("test","TeamArenaChangeDt",{})}},{pb:"【组队竞技】生成队伍",inputs:[],cb:function(e){Utils.Socket.send("test","EnrollTeamArena",{})}},{pb:"【组队竞技】拉人",inputs:[],cb:function(e){Utils.Socket.send("test","TeamArenaRandomMember",{})}},{pb:"模块解锁",inputs:[["moduleId","number"]],cb:function(e){Utils.UnlockMgr.forceChangeUnlockInfo(e.moduleId,!0),Utils.Socket.send("test","UnlockModule",{moduleId:e.moduleId})}},{pb:"深渊巢穴开启地图配置模式",inputs:[["mapID","number"]],cb:function(e){l.AppFacade.getInstance().sendNotification(CN.DEEP_NEST_SETPOSBYWAIGUA,{mapId:e.mapID})}},{pb:"自走棋战斗恢复正常速度",inputs:[],cb:function(e){l.GameMVC.zzqPy.debug_slowFight=!0}},{pb:"自走棋加钱",inputs:[["num","number"]],cb:function(e){Utils.Socket.send("test","AddWchessMoney",{num:e.num})}},{pb:"自走棋加英雄",inputs:[["code","number"],["num","number"]],cb:function(e){Utils.Socket.send("test","AddWchessHero",{code:e.code,num:e.num})}},{pb:"自走棋增加段位积分",inputs:[["grade","number"]],cb:function(e){Utils.Socket.send("test","AddWchessGrade",{num:e.grade})}},{pb:"自走棋成就奖杯",inputs:[["code","number"],["tp","number"],["key","number"]],cb:function(e){Utils.Socket.send("test","DoneWchessAchieve",{code:e.code,tp:e.tp,key:e.key})}},{pb:"矿战增加行动力",inputs:[["num","number"]],cb:function(e){Utils.Socket.send("test","AddManorWalkNum",{num:e.num})}},{pb:"矿战刷新矿",inputs:[],cb:function(e){Utils.Socket.send("test","RefreshManor",{})}},{pb:"矿战增加机器人",inputs:[["guildId","number"],["num","number"]],cb:function(e){Utils.Socket.send("test","AddManorRobot",{guildId:e.guildId,num:e.num})}},{pb:"【测试】部落争霸开启",inputs:[],cb:function(e){Utils.Socket.send("test","OpenTribeBattle",{}).then(function(){Utils.MsgUtils.addMidMsg("已开启")})}},{pb:"【测试】部落争霸关闭",inputs:[],cb:function(e){Utils.Socket.send("test","CloseTribeBattle",{}).then(function(){Utils.MsgUtils.addMidMsg("已关闭")})}},{pb:"公会副本挑战次数",inputs:[["num","number"]],cb:function(e){Utils.Socket.send("test","AddGuildTranscriptChallengeNum",{num:e.num})}},{pb:"遗迹探险指定步数",inputs:[["stepNum","number"]],cb:function(e){Utils.Socket.send("challenge","ThrowDice",{stepNum:e.stepNum}).then(function(e){l.AppFacade.getInstance().updateView(l.HeroChallengeMediator.N,l.HeroChallengeMediator.SV.MAIN,e)})}},{pb:"提取当前窗口条件配置",inputs:[],cb:function(e){o.changePlugFloatView(!o.gp_plug.visible);var t="["+GuideConditionSubType.VIEW_STACK+", ["+GameRootLayer.gameLayer().getViewStackJsonStr()+"]";o.log("提取当前窗口条件配置",t)}},{pb:"addExp",inputs:[["code","number"],["num","number"]]},{pb:"addMoney",inputs:[["code","number"],["num","number"]]},{pb:"addItem",inputs:[["code","number"],["num","number"]]},{pb:"AddVestageItem",inputs:[["code","number"],["num","number"]]},{pb:"测试跳转",inputs:[["jumpModule","number"]],cb:function(e){o.changePlugFloatView(!o.gp_plug.visible),l.MainJumpConfig.jumpTo(e.jumpModule,void 0,e.jumpModuleParams)}},{pb:"封印BOOS完成任务",cb:function(e){Utils.Socket.send("test","AutoAccountTaskPro",{}).then(function(e){})}},{pb:"UpdateZoneBossPro",inputs:[["type","number"],["value","number"]]},{pb:"ZoneBossAutoNextRound",inputs:[]},{pb:"SetVipLevel",inputs:[["code","string"]]},{pb:"SendSystemMail",inputs:[["key","string","1"],["propertys","string","[]"],["attachs","string","[]"]]},{pb:"addHeroNew",inputs:[["code","number"],["num","number"]]},{pb:"addHeroEquip",inputs:[["code","number"],["num","number"]]},{pb:"addHeroArtifact",inputs:[["code","number"],["num","number"]]},{pb:"AddRiskMap",inputs:[["code","number"],["num","number"]]},{pb:"riskUnlock",inputs:[]},{pb:"协议测试",inputs:[["pb1Str","string"],["pb2Str","string"],["jsonParams","string"]]},{pb:"铁匠铺",inputs:[["num","number"]]},{pb:"特效测试",inputs:[["fileName","string"],["actionName","string"]],cb:function(e){o.changePlugFloatView(!o.gp_plug.visible),DragonBoneTools.playOnce({effectName:e.fileName,actionName:e.actionName,parent:GameRootLayer.gameLayer().maskLayer,x:Utils.DeviceUtils.curWidth()/2,y:Utils.DeviceUtils.curHeight()/2})}},{pb:"对话框测试",inputs:[["storyId","number"],["questionId","number"]],cb:function(e){PopUpManager.addPopUp({obj:new l.StoryView({storyId:e.storyId,questionId:e.questionId,cb:function(){}})})}},{pb:"新手.获取控件名",inputs:[],cb:function(e){var t="GUIDE_COMP_GET";Utils.TouchUtils.hasGlobalTouch(t)?Utils.TouchUtils.removeGlobalTouch(t):Utils.TouchUtils.addGlobalTouch(function(e){o.log("当前点击target：",e.target);var t=l.AppFacade.getInstance().retrieveProxy(l.GuidePy.N).checkComponentName(e.target);-1!=t.indexOf("#")?o.log("      【GUIDE】view：",t.split("#")[0],"控件名：",t):o.log("      【GUIDE】",t)},t)}},{pb:"设置排行榜数据拉取延迟",inputs:[["sec","number"]],cb:function(e){l.AppFacade.getInstance().retrieveProxy(l.RankPy.N).REFRESH_INTERVAL=e.sec}},{pb:"微信分享测试",inputs:[["type","number"]],cb:function(e){l.AppFacade.getInstance().retrieveMediator(l.ActivityMediator.N).showViewByCode(EActivityType.WeChatShare,{type:e.type})}},{pb:"模拟超时",cb:function(){Utils.Socket.send("risk","LayerInfoP",{})}},{pb:"【快捷操作】钻石乐透加次数",inputs:[["num","number"]],cb:function(e){Utils.Socket.send("test","AddDiamondLotteryCount",{num:e.num})}},{pb:"显示开服天数",cb:function(){Utils.MsgUtils.addMidMsg(Utils.TimerManager.getServerOpenDays()+"天")}},{pb:"空阵位上阵英雄",cb:function(){var i=l.AppFacade.getInstance().retrieveProxy(l.HeroPy.N),e=[void 0,void 0,void 0,void 0,void 0],n=[];for(var t in i.allHeroByUuid){var o=i.allHeroByUuid[t];o.pos?e[o.pos-1]=t:n.length<5&&n.push(o.uuid)}e.forEach(function(e,t){!e&&0<n.length&&i.HeroPutOn({uuid:n.pop(),pos:t+1})})}},{pb:"模拟报错",cb:function(){(void 0).asdlfjlk=12323}},{pb:"重启游戏",cb:function(){l.GameMgr.getInstance().restart()}},{pb:"清空英雄",cb:function(){Utils.Socket.send("test","ClearHeroBag",{})}}],o.skinName="MainUISkin",o.touchEnabled=!1,o.curUIStyle=65535,Utils.DebugUtils.isDebug&&(window._mainUI=o),o.guideEffectWait=!0,o}return __extends(e,t),e.prototype.getBtnByModule=function(e){switch(e){case"CITY":return this.gp_bottom.$children[1];case"HERO":return this.gp_bottom.$children[2];case"GUAJI":return this.gp_bottom.$children[3];case"BACKPACK":return this.gp_bottom.$children[4];case"GUILD":return this.gp_bottom.$children[5];case"ALL":return this.gp_bottom.$children;default:return}},e.prototype.getParentView=function(){return GameRootLayer.gameLayer().mainLayer},e.prototype.addNotice=function(){var e=this.getBtnByModule("GUAJI");this.resFullImg.right=-10,this.resFullImg.visible=!1,e&&e.addChild(this.resFullImg),NoticeManager.addNoticeListener(NT.FRIEND,this.btn_haoyou.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.TASK_ENTRANCE,this.btn_task.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.MAIL,this.bnt_mail.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.SECOND_ACHIEVEMENT,this.btn_achieve.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.CHAT_MAIN,this.btn_chat.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.CHAT_MAIN2,this.btn_chat2.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.GUAJI_MULTI,this.btn_multi_guaji.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.GUAJI_GZGZH,this.btn_gzgzh.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.GUAJI_GZGZH2,this.btn_gzgzh2.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.GOLDHAND,this.cu_resBar,this,{percentX:175/406,percentY:-.06}),NoticeManager.addNoticeListener(NT.VIP_ENTRANCE,this.cu_resBar,this,{percentX:379/406,percentY:-.06})},e.prototype.updateGuajiNotice=function(e){if(e){var t=l.AppFacade.getInstance().retrieveMediator(l.GuajiMediator.N).getSubView(l.GuajiMediator.SV.MAIN);t&&t.visible?this.resFullImg.visible=!1:this.resFullImg.visible=!0}else this.resFullImg.visible=!1},e.prototype.vipEffect=function(e){var t;5<e&&e<12?t=this.VIP_CONFIG[1]:12<=e&&(t=this.VIP_CONFIG[2]);5<e&&(!this.effect||this.vip&&this.vip!=t?(this.gp_effect.removeChildren(),MovieClipTools.create(t,function(e){this.effect=e,this.effect.x=this.gp_effect.width/2,this.effect.y=this.gp_effect.height/2,this.effect.visible=!0,this.effect.animation.play(t,0),this.effect.animation.timeScale=1,this.gp_effect.addChild(this.effect)},this)):this.effect.animation.play(t,0)),this.vip=t},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_head),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top_right),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top_right2),Utils.DeviceUtils.setLiuHaiPingAdapter(this.vs_top_left),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top_left2),this.gp_plug.parent.removeChild(this.gp_plug),GameRootLayer.gameLayer().popMsgLayer.addChild(this.gp_plug),this.btn_plug.parent.removeChild(this.btn_plug),GameRootLayer.gameLayer().loadLayer.addChild(this.btn_plug),this.lb_serTime.parent.removeChild(this.lb_serTime),GameRootLayer.gameLayer().loadLayer.addChild(this.lb_serTime),this.btn_record.parent.removeChild(this.btn_record),GameRootLayer.gameLayer().loadLayer.addChild(this.btn_record),this.sl_inputs.verticalScrollBar.visible=!1,this.sl_inputs.verticalScrollBar.autoVisibility=!1,Utils.DebugUtils.isDebug&&!getUrlKV().banshu?this.btn_plug.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.changePlugFloatView(!this.gp_plug.visible)},this):this.btn_plug.visible=!1,Utils.agentConfig.isChecking&&Utils.agentConfig.isChecking.needRecord?this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,this.record,this):this.btn_record.visible=!1,this.btn_vip.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.MainJumpConfig.jumpTo(MODULE.VIP)},this),this.gp_avatar.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.AppFacade.getInstance().showSubView(l.PlayerMediator.N,l.PlayerMediator.SV.MAIN)},this),this.bnt_mail.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.AppFacade.getInstance().showSubView(l.MailMediator.N,l.MailMediator.SV.MAIN)},this),this.btn_achieve.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.AppFacade.getInstance().showSubView(l.TaskMediator.N,l.TaskMediator.SV.SECOND_ACHIEVEMENT)},this),this.btn_chat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.UnlockMgr.checkPass(MODULE.Chat).allow&&l.AppFacade.getInstance().showSubView(l.ChatMediator.N,l.ChatMediator.SV.CHAT,{NextChannelType:EChatChannelType.SameServer})},this),this.btn_chat2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.UnlockMgr.checkPass(MODULE.Chat).allow&&l.AppFacade.getInstance().showSubView(l.ChatMediator.N,l.ChatMediator.SV.CHAT,{NextChannelType:EChatChannelType.SameServer})},this),Utils.SDKMgr.getPerformConfig(200002)?(this.btn_gzgzh.visible=this.btn_gzgzh2.visible=!0,this.btn_gzgzh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.GameMVC.activityMed.showViewByCode(EActivityType.GuanZhuGongZhongHao)},this),this.btn_gzgzh2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.GameMVC.activityMed.showViewByCode(EActivityType.GuanZhuGongZhongHao)},this)):(this.btn_gzgzh.height=this.btn_gzgzh2.height=0,this.btn_gzgzh.visible=this.btn_gzgzh2.visible=!1),Utils.SDKMgr.getPerformConfig(40)?(this.btn_multi_guaji.visible=!0,this.btn_multi_guaji.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.UnlockMgr.checkPass(MODULE.RiskMulti).allow&&l.AppFacade.getInstance().showSubView(l.GuajiMediator.N,l.GuajiMediator.SV.MULTI)},this)):(this.btn_multi_guaji.height=0,this.btn_multi_guaji.visible=!1),this.btn_haoyou.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.AppFacade.getInstance().showSubView(l.FriendMediator.N,l.FriendMediator.SV.MAIN)},this),this.btn_paihangbang.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.MainJumpConfig.jumpTo(MODULE.Ranking)},this),this.btn_strong.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.AppFacade.getInstance().showSubView(l.StrongMediator.N,l.StrongMediator.SV.MAIN)},this),this.btn_task.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.AppFacade.getInstance().showSubView(l.TaskMediator.N,l.TaskMediator.SV.MAIN)},this),Utils.SDKMgr.getPerformConfig(6)?this.gp_bottom.getChildAt(3).icon="_main_m_json.common_icon_zhutubiao_maoxian2":this.effectChuanSongMen?this.effectChuanSongMen.animation.play("common_patachuansongmen",0):DragonBoneTools.create("common_patachuansongmen",function(e){this.effectChuanSongMen=e,this.effectChuanSongMen.x=360,this.effectChuanSongMen.y=35,this.effectChuanSongMen.visible=!0,this.effectChuanSongMen.animation.timeScale=1,this.effectChuanSongMen.animation.play("common_patachuansongmen",0),this.gp_bottom.addChildAt(this.effectChuanSongMen,-1)},this,{groupName:"GuajiFixed"}),Utils.DebugUtils.setNeedDebugTools(this.btn_plug.visible),Utils.DeviceUtils.setBottomAdapter(this.gp_bottom),this.validateNow(),this.addNotice(),Utils.SDKMgr.getPerformConfig(2)&&(this.btn_chat.visible=this.btn_chat2.visible=!1),egret.setTimeout(function(){GameRootLayer.gameLayer().onEnterMain()},this,500),Utils.SDKMgr.cmd({type:"CheckRecharge",level:this.playerProxy.playerInfoVO.level},function(){e.updatePlayerInfo()})},e.prototype.changeStyle=function(e){var t=this;this.curUIStyle=e,egret.Tween.removeTweens(this.gp_head),egret.Tween.removeTweens(this.vs_top_left),egret.Tween.removeTweens(this.gp_top_left2),egret.Tween.removeTweens(this.gp_bottom_left),egret.Tween.removeTweens(this.gp_bottom_right),egret.Tween.removeTweens(this.gp_top_right),egret.Tween.removeTweens(this.gp_top_right2),egret.Tween.removeTweens(this.gp_top),null==this.gp_head.originY&&(this.gp_head.originY=this.gp_head.y),this.gp_head.y=this.gp_head.originY,this.vs_top_left.x=0,1&e?this.gp_head.visible||(this.gp_head.visible=!0,UIActionManager.playUIAction(this.gp_head,5)):this.gp_head.visible=!1,this.gp_bottom.visible=!!(2&e),8&e?this.gp_top.visible||(this.gp_top.visible=!0,this.gp_top_right.visible=!0,this.gp_top_right2.visible=!0,UIActionManager.playUIAction(this.gp_top,4),UIActionManager.playUIAction(this.gp_top_right,4),UIActionManager.playUIAction(this.gp_top_right2,4)):this.gp_top.visible&&(this.gp_top.visible=!1,this.gp_top_right.visible=!1,this.gp_top_right2.visible=!1),32&e?this.gp_bottom_right.visible||(this.gp_bottom_right.visible=!0,UIActionManager.playUIAction(this.gp_bottom_right,4)):this.gp_bottom_right.visible&&(this.gp_bottom_right.visible=!1),16&e?(this.vs_top_left.visible||(this.vs_top_left.visible=!0,UIActionManager.playUIAction(this.vs_top_left,3)),this.gp_top_left2.visible||(this.gp_top_left2.visible=!0,UIActionManager.playUIAction(this.gp_top_left2,3)),this.gp_bottom_left.visible||(this.gp_bottom_left.visible=!0,UIActionManager.playUIAction(this.gp_bottom_left,3))):(this.vs_top_left.visible=!1,this.gp_top_left2.visible=!1,this.gp_bottom_left.visible=!1,this.gp_bottom_right.visible=!1),64&e?("GUAJI"===l.MainJumpConfig.lastEvent?(this.gp_bottom_banner.bottom=void 0,this.gp_bottom_banner.top=(Utils.SDKMgr.getPerformConfig(6)?280:400)+Utils.DeviceUtils.statusBarHeight):(this.gp_bottom_banner.top=void 0,this.gp_bottom_banner.bottom=270),this.gp_bottom_banner.visible||(this.gp_bottom_banner.visible=!0,UIActionManager.playUIAction(this.gp_bottom_banner,4))):this.gp_bottom_banner.visible&&(this.gp_bottom_banner.visible=!1),this.gp_top.visible&&this.gp_top_right.visible&&this.updateNotice(),egret.setTimeout(function(){t.setGuideAvailable()},this,UIActionManager.POP_ACTION_SPEED)},e.prototype.updatePlayerInfo=function(){var e=this.playerProxy.playerInfoVO;if(e){this.btn_vip.labelDisplay.text=String(e.playerVip.vipLevel),this.vipEffect(e.playerVip.vipLevel),this.lb_name.text=e.name,this.blb_level.text=""+e.level.toString(),this.blb_fightCap.text=e.fightCap.toString(),this.gp_avatar.removeChildren(),this.cu_ph.updateData({vo:this.playerProxy.playerInfoVO,ignoreLevel:1,effect:!0});var t=l.Config.playerLevelUpgrade(),i=t[e.level],n=Number(l.Config.constConfig().maxLevel.constValue);t[e.level+1],this.pb_exp.minimum=0,e.exp<i.exp?(this.pb_exp.maximum=i.exp,this.pb_exp.value=e.exp):e.level>=n&&(this.pb_exp.maximum=100,this.pb_exp.value=100);var o=[EPropertyType.EPropertyTypeGold,EPropertyType.EPropertyTypeDiamond];this.cu_resBar.updateBar({costs:o,width:190,needAdd:!0})}},e.prototype.record=function(){var t=this,e="begin",i=Utils.TimerManager.getServerTime();i-this.lastRecordTime<1||(this.lastRecordTime=i,l.SystemSettingPanel.isRecording&&(e="end"),"begin"==e?(this.btn_record.label="录制中",Utils.SDKMgr.cmd({type:"VideoRecord",recordType:"begin",thisObj:this},function(e){t.btn_record.label="录制",l.SystemSettingPanel.isRecording=!1,e?Utils.MsgUtils.addMidMsg(e):Utils.MsgUtils.addMidMsg("录屏失败")}),l.SystemSettingPanel.isRecording=!0):(this.btn_record.label="录制",Utils.SDKMgr.cmd({type:"VideoRecord",recordType:e,thisObj:this},function(e){e?Utils.MsgUtils.addMidMsg(e):Utils.MsgUtils.addMidMsg("录屏失败")}),l.SystemSettingPanel.isRecording=!1))},e.prototype.changePlugFloatView=function(e){if(this.gp_plug.visible=e){var c=new eui.Group,t=new eui.VerticalLayout;t.paddingTop=10,t.paddingBottom=10,t.paddingLeft=20,t.paddingTop=20,c.layout=t,this.sl_inputs.viewport=c,this.sl_inputs.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_inputs.scrollPolicyV=eui.ScrollPolicy.ON,this.PLUG_CONFIG.forEach(function(o,e){var a=new eui.Group,t=new eui.HorizontalLayout;t.verticalAlign=egret.VerticalAlign.MIDDLE,t.gap=5,a.layout=t;var r=new eui.Label;if(r.stroke=2,r.size=24,r.text=o.pb,a.addChild(r),o.inputs)for(var i in o.inputs){var n=new eui.EditableText;n.prompt=o.inputs[i][0],n.size=24,n.width=150,n.name=o.inputs[i][0],n.text=o.inputs[i][2]?o.inputs[i][2]:"",a.addChild(n)}var s=new eui.Button;s.width=60,s.height=44,s.label="ok",s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),o.inputs){var e={},t=!0;for(var i in o.inputs){var n=a.getChildByName(o.inputs[i][0]).text;if("协议测试"!=o.pb&&(a.getChildByName(o.inputs[i][0]).text=""),""===n){UIActionManager.blink(a.getChildByName(o.inputs[i][0])),Utils.MsgUtils.addMidMsg("请输入内容"),t=!1;break}"number"==o.inputs[i][1]?e[o.inputs[i][0]]=Number(n):e[o.inputs[i][0]]=n}t&&(o.cb?o.cb(e,r):"协议测试"===o.pb?Utils.Socket.send(e.pb1Str,e.pb2Str,JSON.parse(e.jsonParams)):"铁匠铺"===o.pb?Utils.Socket.send("smithy","SmithyForgeIron",e).then(function(e){l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N).handleClientReward(e.rewardPreview)}):Utils.Socket.send("test",o.pb,e))}else o.cb&&o.cb.call()},this),a.addChild(s),c.addChild(a)})}else this.sl_inputs.removeChildren()},e.prototype.initServerTimeSche=function(){var e=this;if(!this.serverTimeSche){var t=new Date;this.serverTimeSche=egret.setInterval(function(){e.lb_serTime.visible&&(t.setTime(1e3*Utils.TimerManager.getServerTime(!1)),e.lb_serTime.text=t.format("yyyy/M/d hh:mm:ss"),e.lb_serTime.text+="\n星期"+(t.getDay()||7))},this,1e3)}},e}(BaseView);l.MainUI=e,__reflect(e.prototype,"game.MainUI")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.skinName="EnterGuajiPanelSkin",t.cb=e&&e.cb,t}return __extends(e,i),e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.cb&&this.cb()},e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),PopUpManager.removePopUp(this,0)},this),RES.getRes("_login_create_role_m_json.login_img_kaishimaoxian")?this.img_root.source=RES.getRes("_login_create_role_m_json.login_img_kaishimaoxian"):RES.getResAsync("_login_create_role_m_json.login_img_kaishimaoxian",function(e){t.img_root.source=e},this),DragonBoneTools.create("common_zhiyin",function(e){e.x=320,e.y=330,this.gp_root.addChild(e),e.armature.getSlot("shouzhi").getDisplay().visible=!1,e.animation.play("common_zhiyin",-1)},this),GameRootLayer.gameLayer().makeTouchLayer(function(){PopUpManager.removePopUp(t,0)},this,7e3)},e}(BasePanel);e.EnterGuajiPanel=t,__reflect(t.prototype,"game.EnterGuajiPanel")}(game||(game={})),function(t){var e=function(i){function e(e){var t=i.call(this)||this;return t.skinName="LevelUpPanelSkin",t.cb=e&&e.cb,t._popActionType=1,t}return __extends(e,i),e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.cb&&this.cb()},e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this);var e=t.AppFacade.getInstance().retrieveProxy(t.PlayerPy.N);this.lb_tips.text="恭喜你升到"+e.playerInfoVO.level+"级"},e}(BasePanel);t.LevelUpPanel=e,__reflect(e.prototype,"game.LevelUpPanel")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.RERUN_WAIT_TIME=5,e.isForceStop=!1,e.skinName="NetCheckingPanelSkin",e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.sche&&(egret.clearInterval(this.sche),this.sche=void 0),this.rerunSche&&(egret.clearTimeout(this.rerunSche),this.rerunSche=void 0)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.lb_tips.stroke=2,this.lb_tips.strokeColor=0,this.btn_exit.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.lb_tips.visible=!0,this.gp_btns.visible=!1,this.onResume(!0)},this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.GameMgr.getInstance().restart()},this),this.onResume(),this.HeroDynamicModel.update({model:"hero_040_01"})},e.prototype.onResume=function(e){var t=this;if(!this.sche){var i=0;this.sche=egret.setInterval(function(){var e=++i%3;t.lb_tips.text=0===e?"网络重连中.":1===e?"网络重连中..":"网络重连中..."},this,1e3),this.lb_tips.text="网络重连中...",this.checking(e)}this.rerunSche||(this.rerunSche=egret.setTimeout(function(){egret.clearTimeout(t.rerunSche),t.rerunSche=void 0,egret.clearInterval(t.sche),t.sche=void 0,t.lb_tips.text="失去网络连接...",t.gp_btns.visible=!0},this,1e3*this.RERUN_WAIT_TIME))},e.prototype.onPause=function(){this.sche&&(egret.clearInterval(this.sche),this.sche=void 0),this.rerunSche&&(egret.clearTimeout(this.rerunSche),this.rerunSche=void 0)},e.prototype.checking=function(e){var t=i.AppFacade.getInstance().retrieveProxy(i.PlayerPy.N);i.AppFacade.getInstance().retrieveProxy(i.LoginPy.N);201<=t.loginStatusVO.state?Utils.Socket.reconnect(e):i.GameMgr.getInstance().restart()},e.prototype.forceStop=function(){this.visible=!1,this.isForceStop=!0},e}(BasePanel);i.NetCheckingPanel=e,__reflect(e.prototype,"game.NetCheckingPanel")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.RERUN_WAIT_TIME=5,t.skinName="NetCheckingPanelSkin",t.params=e,t}return __extends(e,i),e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.sche&&(egret.clearInterval(this.sche),this.sche=void 0)},e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.lb_tips.stroke=2,this.lb_tips.strokeColor=0,this.btn_exit.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_exit.label="确 定",this.btn_exit.x=70,this.btn_go.parent.removeChild(this.btn_go),this.gp_btns.visible=!0,this.HeroDynamicModel.update({model:"hero_040_01"});var e=!0;this.params&&this.params.tips&&(this.btn_exit.visible=!1,this.lb_tips.text=this.params.tips,e=!1),e&&this.onResume()},e.prototype.onResume=function(e){var t=this;if(!this.sche){var i=0;this.sche=egret.setInterval(function(){var e=++i%3;t.lb_tips.text=0===e?"抱歉\n \n服务器正在维护中.":1===e?"抱歉\n \n服务器正在维护中..":"抱歉\n \n服务器正在维护中..."},this,1e3),this.lb_tips.text="抱歉\n \n服务器正在维护中...",this.checking(e)}},e.prototype.checking=function(e){},e}(BasePanel);e.ServerMaintainView=t,__reflect(t.prototype,"game.ServerMaintainView")}(game||(game={})),function(p){var e=function(n){function h(e){void 0===e&&(e=null);var t,i=n.call(this,h.N,e)||this;return i.CAN_POP_TYPE=((t={})[UnlockType.Level]=1,t[UnlockType.VipLevel]=1,t[UnlockType.LevelOrVipLevel]=1,t[UnlockType.LevelAndVipLevel]=1,t[UnlockType.ServerOpenDay]=1,t[UnlockType.LevelAndServerOpenDay]=1,t),i.playerPy=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N),i}return __extends(h,n),h.prototype.initSubView=function(){this.addSubView(h.SV.MAIN,p.ModuleOpenView)},h.prototype.listNotificationInterests=function(){return[CN.PLAYER_LEVEL_UP,CN.PLAYER_VIP_LEVEL_UP,CN.GENERAL_PASS_DAY,CN.SWITCH_TO_CITY,CN.PLAYER_INFO_UPDATE]},h.prototype.handleNotification=function(e){var t=this;switch(e.getName()){case CN.PLAYER_LEVEL_UP:case CN.PLAYER_VIP_LEVEL_UP:case CN.GENERAL_PASS_DAY:case CN.SWITCH_TO_CITY:if(this.playerPy.playerInfoVO){var i=p.Config.getModuleConfig(),n=[];for(var o in i){var a=i[o];(s=Utils.UnlockMgr.checkPass(a.moduleId,!1)).allow&&-1==this.hasUnlockWhenLogin.indexOf(Number(a.moduleId))&&(s.condition==UnlockType.ServerOpenDay||s.condition==UnlockType.LevelAndServerOpenDay?p.GameMVC.guidePy.serverGuideInfo["MODULE_OPEN_"+a.moduleId]||(p.GameMVC.guidePy.setGuideInfo("MODULE_OPEN_"+a.moduleId),n.push(a)):n.push(a),this.hasUnlockWhenLogin.push(a.moduleId))}0<n.length&&egret.setTimeout(function(){t.showSubView(h.SV.MAIN,{popModule:n})},this,500)}break;case CN.PLAYER_INFO_UPDATE:if(null==this.hasUnlockWhenLogin){this.hasUnlockWhenLogin=[];i=p.Config.getModuleConfig();var r=p.Config.unlockConfig();for(var o in i){var s,c=r[(a=i[o]).moduleId],l=JSON.parse(c.condition)[0];if(this.CAN_POP_TYPE[l])(s=Utils.UnlockMgr.checkPass(a.moduleId,!1)).allow?s.condition==UnlockType.ServerOpenDay||s.condition==UnlockType.LevelAndServerOpenDay?p.GameMVC.guidePy.serverGuideInfo["MODULE_OPEN_"+a.moduleId]&&this.hasUnlockWhenLogin.push(a.moduleId):this.hasUnlockWhenLogin.push(a.moduleId):egret.log("【ModuleOpenMediator】模块"+a.name+"，"+s.ext.tips)}}}},h.N="ModuleOpenMediator",h.SV={MAIN:1},h}(BaseMediator);p.ModuleOpenMediator=e,__reflect(e.prototype,"game.ModuleOpenMediator")}(game||(game={})),function(o){var e=function(n){function e(e){var t=n.call(this)||this;return t.popModule=[],t.skinName="ModuleOpenSkin",t}return __extends(e,n),e.prototype.childrenCreated=function(e){var t=this;n.prototype.childrenCreated.call(this);var i=new egret.Sprite;i.graphics.clear(),i.graphics.beginFill(0,.8),i.width=Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),i.height=Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale(),i.graphics.drawRect(0,0,i.width,i.height),i.graphics.endFill(),i.alpha=.5,this.gp_bg.addChild(i),Utils.DebugUtils.isDebug&&Utils.ComponentUtils.registerListener(this.gp_root,egret.TouchEvent.TOUCH_TAP,function(){t.gp_root.$children.forEach(function(e){egret.Tween.removeTweens(e)}),t.closeView()},this)},e.prototype.updateView=function(e){if(e){if(this.popModule=e.popModule,0<this.popModule.length){this.gp_root.removeChildren();for(var t=0;t<this.popModule.length;){var i=this.popModule[t],n=new a;n.scaleX=.8,n.scaleY=.8;this.popModule.length;var o=this.gp_root.width/2-n.width*n.scaleX*(this.popModule.length/2-t);n.x=o,n.y=(this.gp_root.height-n.height*n.scaleY)/2,n.updateData({config:i}),this.gp_root.addChild(n),++t}}this.iconFly()}else this.closeView()},e.prototype.iconFly=function(){for(var h=this,p=0,d=(o.AppFacade.getInstance().retrieveMediator(o.MainMediator.N),this.getCurTabView()),u=[],g=[],e=function(e){u=JSON.parse(e.flyView),g=JSON.parse(e.flyPos);for(var t=0,i=void 0,n=!1,o=0,a=u;o<a.length;o++){a[o];if(d==u[t]){n=!0;var r;g[t];(r=Utils.ComponentUtils.getComponentByName(g[t]))&&"NULL"!=r&&(i=Utils.ComponentUtils.getPosInView(r));break}++t}n||"Default"!=u[0]||(r=Utils.ComponentUtils.getComponentByName(g[0]))&&"NULL"!=r&&(i=Utils.ComponentUtils.getPosInView(r));if(i){1==f.gp_root.$children.length&&egret.Tween.get(f.gp_bg).wait(1500).to({alpha:0},100);var s=f.gp_root.getChildAt(p);s.alpha=0;f.popModule.length;var c=f.gp_root.width/2-s.width*(f.popModule.length/2-p),l=(f.gp_root.height-s.height)/2;egret.Tween.get(s).wait(400*p).to({alpha:1,scaleX:1,scaleY:1,x:c,y:l},400,egret.Ease.backOut),egret.Tween.get(s).wait(1500*(p+1)-700*p).to({x:i.x+30,y:i.y+30,scaleX:.3,scaleY:.3},700,egret.Ease.quartIn).call(function(){h.gp_root.removeChild(s),h.gp_root.$children.length<=0&&h.closeView()})}else f.closeView();++p},f=this,t=0,i=this.popModule;t<i.length;t++){e(i[t])}this.popModule.length<=0&&this.closeView()},e.prototype.getCurTabView=function(){var e=GameRootLayer.gameLayer().getCurViewStack();return 1<e.mainLayer.length?e.mainLayer[e.mainLayer.length-1]:e.tabLayer[e.tabLayer.length-1]},e.prototype.getParentView=function(){return GameRootLayer.gameLayer().popMsgLayer},e.prototype.closeView=function(){this.hide(),o.AppFacade.getInstance().sendNotification(CN.ACTIVITY_SHOW_TRIGGER)},e.prototype.perClose=function(){},e}(BaseFull);o.ModuleOpenView=e,__reflect(e.prototype,"game.ModuleOpenView");var a=function(t){function e(){var e=t.call(this)||this;return e.skinName="ModuleOpenItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateData=function(e){var t=this;if(e){var i=e.config;RES.getResAsync(ResourceUtils.png(i.pic),function(e){t.img_icon.source=e},this),this.blb_activity.text=i.name,this.createEffect()}},e.prototype.createEffect=function(){DragonBoneTools.create("common_patabaoxiang",function(e){e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2+20,e.scaleX=e.scaleY=2.5,e.animation.play(),this.gp_effect.addChild(e)},this)},e.prototype.onOPReset=function(){},e.prototype.onOPComeBack=function(e,t){},e.prototype.onOPClean=function(){},e.prototype.onOPCheck=function(e){},e}(eui.Component);o.ModuleOpenItem=a,__reflect(a.prototype,"game.ModuleOpenItem",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.configs=[{title:"客服",btnName:"",btnIcon:"_btn_lb_m_json.chuanghao_btn_kefu",initFunc:function(e){},onClickFunc:function(e){Utils.MsgUtils.addMidMsg("点击按钮"+e.lb_title.text)}}],e.skinName="FlowWindowPanel",e}return __extends(e,t),e.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),this.configs.forEach(function(e){var t=new n(e);i.gp_btns.addChild(t)})},e}(BasePanel);e.FlowWindowPanel=t,__reflect(t.prototype,"game.FlowWindowPanel");var n=function(i){function e(e){var t=i.call(this)||this;return t.skinName="FlowWindowPanelBtn",t.config=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.config&&(this.lb_title.text=this.config.title||"",this.btn.label=this.config.btnName||"",this.btn.icon=this.config.btnIcon||"",this.config.initFunc&&this.config.initFunc(this),this.config.onClickFunc&&this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.config.onClickFunc(e)},this))},e}(eui.ItemRenderer);__reflect(n.prototype,"FlowWindowPanelBtn")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.VIP_CONFIG={1:"common_VIPhuizhang",2:"common_VIPhuizhang2"},e.skinName="PlayerInfoSkin",e.playerPy=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),e.loginPy=a.AppFacade.getInstance().retrieveProxy(a.LoginPy.N),e.heroProxy=a.AppFacade.getInstance().retrieveProxy(a.HeroPy.N),e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initView(),this.addBtnEvents()},e.prototype.initView=function(){var e=this;this.initHeroList(),this.playerPy.GetPlayerInfo(function(){e.initProgressBar()});var t=0<a.AppFacade.getInstance().retrieveProxy(a.HeroPy.N).HeroHistoryListlength;this.btn_modifyIcon.touchEnabled=t,UIActionManager.setGrey(this.btn_modifyIcon,!t)},e.prototype.vipEffect=function(e){var t;5<e&&e<12?t=this.VIP_CONFIG[1]:12<=e&&(t=this.VIP_CONFIG[2]);5<e&&(!this.effect||this.vip&&this.vip!=t?(this.gp_effect.removeChildren(),MovieClipTools.create(t,function(e){this.effect=e,this.effect.x=this.gp_effect.width/2,this.effect.y=this.gp_effect.height/2,this.effect.visible=!0,this.effect.animation.play(t,0),this.effect.animation.timeScale=1,this.gp_effect.addChild(this.effect)},this)):this.effect.animation.play(t,0)),this.vip=t},e.prototype.updateView=function(){var e=a.AppFacade.getInstance().retrieveProxy(a.GuildPy.N);this.lb_guldText.text="未加入公会",e.isInGuild()&&e.guildDetail&&e.guildDetail.name&&(this.lb_guldText.text=e.guildDetail.name),this.btn_vip.labelDisplay.text=String(this.playerPy.playerInfoVO.playerVip.vipLevel),this.vipEffect(this.playerPy.playerInfoVO.playerVip.vipLevel),this.lb_name.text=this.loginPy.playerProxy.playerInfoVO.name,this.lb_IDtext.text=String(this.playerPy.playerInfoVO.playerId),this.blb_fightCapText.text=Utils.MathUtils.formatNumStyle2(this.playerPy.playerInfoVO.fightCap),this.lb_levelText.text=this.loginPy.playerProxy.playerInfoVO.level.toString(),this.player_heah.updateData({vo:this.playerPy.playerInfoVO,effect:!0}),this.player_heah.blb_level.visible=!1,this.blb_level.text=this.playerPy.playerInfoVO.level.toString()},e.prototype.initProgressBar=function(){for(var e=0,t=a.Config.playerLevelUpgrade(),i=1,n=t[i];n;){if(n.level==this.playerPy.playerInfoVO.level){e=n.exp;break}n=t[++i]}var o=this.playerPy.playerInfoVO.exp;this.pro_exp.slideDuration=0,this.pro_exp.labelDisplay.scaleX=.68,this.pro_exp.labelDisplay.scaleY=1,this.pro_exp.maximum=e,this.pro_exp.minimum=0,this.pro_exp.value=o},e.prototype.initHeroList=function(){var a=this;Utils.Socket.send("playerInfo","GetPublicPlayer",{playerId:this.playerPy.playerInfoVO.playerId}).then(function(e){if(!a.gp_formation.$children.length)for(var t=1;t<=6;t++){(i=new r).name=t.toString(),i.scaleX=.85,i.scaleY=.85,a.gp_formation.addChild(i)}(i=new r).scaleX=.85,i.scaleY=.85,i.horizontalCenter=i.verticalCenter=0,a.gp_pet.addChild(i);for(t=1;t<=6;t++){var i=a.gp_formation.getChildByName(t.toString()),n=Utils.UnlockMgr.checkPass(t,!1);i.updateItem({uuid:a.heroProxy.heroUuid22Pos[t],unlock:n,info:a.heroProxy.allHeroByUuid[a.heroProxy.heroUuid22Pos[t]]}),i.scaleX=.85,i.scaleY=.85}i=a.gp_pet.$children[0];(n=Utils.UnlockMgr.checkPass(MODULE.Pet,!1)).unlock=e.publicPlayer.baseInfo.level>=n.ext.requestLevel,i.updateItem({uuid:e.publicPlayer.petList[0]&&e.publicPlayer.petList[0].uuid,unlock:n,vo:e.publicPlayer.petList[0],isPet:!0}),i.scaleX=.85,i.scaleY=.85;var o=new eui.HorizontalLayout;o.horizontalAlign=egret.HorizontalAlign.CENTER,a.gp_formation.layout=o}).catch(function(e){console.log("获取英雄失败")})},e.prototype.addBtnEvents=function(){if(this.btn_modifyIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showAvatarSetting,this),Utils.SDKMgr.getPerformConfig(23)){var e=this.btn_sysSetting;e&&e.parent&&e.parent.removeChild(e)}else this.btn_sysSetting.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showSystemSetting,this);this.btn_servers.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showServers,this),this.btn_imput.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showRoleNameSetting,this),this.btn_vip.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.MainJumpConfig.jumpTo(MODULE.VIP)},this),a.GameMVC.playerPy.getCanShowUpdateLog()?this.btn_updateLog.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new a.UpdateLogPanel})},this):this.btn_updateLog.parent.removeChild(this.btn_updateLog)},e.prototype.showServers=function(){a.AppFacade.getInstance().showSubView(a.PlayerMediator.N,a.PlayerMediator.SV.SERVER_LIST)},e.prototype.showAvatarSetting=function(){a.AppFacade.getInstance().showSubView(a.PlayerMediator.N,a.PlayerMediator.SV.MODIFY_AVATAR)},e.prototype.showSystemSetting=function(){a.AppFacade.getInstance().showSubView(a.PlayerMediator.N,a.PlayerMediator.SV.SYSTEM_SETTING)},e.prototype.showRoleNameSetting=function(){a.AppFacade.getInstance().showSubView(a.PlayerMediator.N,a.PlayerMediator.SV.ROLE_NAME)},e.prototype.perClose=function(){},e}(BasePanel);a.PlayerInfoPanel=e,__reflect(e.prototype,"game.PlayerInfoPanel");var r=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroMainView_HeroListItem",e.heroThingProxy=a.AppFacade.getInstance().retrieveProxy(a.HeroThingPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem),this.gp_baseitem.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().updateView(a.HeroMediator.N,a.HeroMediator.SV.MAIN,{upstarData:{},uuid:this.data.uuid})},this),this.gp_empty.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.unlock.allow?a.AppFacade.getInstance().showSubView(a.HeroMediator.N,a.HeroMediator.SV.SELECT):Utils.MsgUtils.addMidMsg(this.data.unlock.ext.tips)},this)},e.prototype.updateItem=function(e){if(this.data=e,this.data.uuid){var t=e.isPet?EEntityType.EEntityTypePet:EEntityType.EEntityTypeHero;if(this.gp_baseitem.visible=!0,this.gp_empty.visible=!1,t==EEntityType.EEntityTypeHero)if(0!=e.info.dermaCode){var i=a.Config.getHeroDermaConfig()[e.info.dermaCode].avatar;this.baseItem.updateData({uuid:this.data.uuid,type:t,effect:!0,avatar:i,isShowEffect:!0})}else this.baseItem.updateData({uuid:this.data.uuid,type:t,effect:!0});else t==EEntityType.EEntityTypePet&&this.baseItem.updateData({vo:this.data.vo,type:t})}else this.gp_baseitem.visible=!1,this.gp_empty.visible=!0,this.data.unlock.allow?(this.img_add.visible=!0,this.img_lock.visible=!1,this.lb_unlock.visible=!1):(this.img_add.visible=!1,this.img_lock.visible=!0,this.lb_unlock.visible=!0,this.lb_unlock.text="LV "+this.data.unlock.ext.requestLevel)},e}(eui.Component);__reflect(r.prototype,"HeroMainView_HeroListItem")}(game||(game={})),function(p){var e=function(o){function a(){var e=o.call(this)||this;return e.skinName="SysytemSettingSkin",e}return __extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.addEvents();var e=1==Utils.SoundManager.enableEff?"":"2",t=a.img_res.effect+e;this.btn_effect.icon=t;var i=1==Utils.SoundManager.enableBG?"":"2",n=a.img_res.music+i;this.btn_music.icon=n,Utils.SDKMgr.getPerformConfig(28)&&this.gp_3.parent.removeChild(this.gp_3),Utils.SDKMgr.getPerformConfig(29)&&this.gp_4.parent.removeChild(this.gp_4),Utils.SDKMgr.getPerformConfig(31)&&this.gp_5.parent.removeChild(this.gp_5)},a.prototype.preClose=function(){this.removeEvents()},a.prototype.addEvents=function(){this.btn_effect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.soundEffectSetting,this),this.btn_music.addEventListener(egret.TouchEvent.TOUCH_TAP,this.musicSetting,this),this.btn_contact.addEventListener(egret.TouchEvent.TOUCH_TAP,this.contactServices,this),this.btn_switch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SDKMgr.goSwitchAccount()},this),this.btn_performance.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new t})},this)},a.prototype.removeEvents=function(){this.btn_effect.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.soundEffectSetting,this),this.btn_music.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.musicSetting,this),this.btn_contact.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.contactServices,this)},a.prototype.soundEffectSetting=function(){Utils.SoundManager.enableEff=!Utils.SoundManager.enableEff;var e=1==Utils.SoundManager.enableEff?"":"2",t=a.img_res.effect+e;this.btn_effect.icon=t},a.prototype.musicSetting=function(){Utils.SoundManager.enableBG=!Utils.SoundManager.enableBG;var e=1==Utils.SoundManager.enableBG?"":"2",t=a.img_res.music+e;this.btn_music.icon=t},a.prototype.contactServices=function(){PopUpManager.addPopUp({obj:new r})},a.isRecording=!1,a.img_res={music:"_btn_lb_m_json.chuanghao_btn_yinyue",effect:"_btn_lb_m_json.chuanghao_btn_yinxiao"},a}(BasePanel);p.SystemSettingPanel=e,__reflect(e.prototype,"game.SystemSettingPanel");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="SysytemPerformanceSettingSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rb_1_0.groupName="rb_1",this.rb_1_1.groupName="rb_1",this.rb_2_0.groupName="rb_2",this.rb_2_1.groupName="rb_2",this.rb_1_0.addEventListener(eui.UIEvent.CHANGE,this.radioChangeHandler,this),this.rb_1_1.addEventListener(eui.UIEvent.CHANGE,this.radioChangeHandler,this),this.rb_2_0.addEventListener(eui.UIEvent.CHANGE,this.radioChangeHandler,this),this.rb_2_1.addEventListener(eui.UIEvent.CHANGE,this.radioChangeHandler,this),60==GameRootLayer.gameLayer().stage.frameRate?this.rb_1_1.selected=!0:this.rb_1_0.selected=!0,dragonBones.EgretFactory.skipFrame?this.rb_2_0.selected=!0:this.rb_2_1.selected=!0},e.prototype.radioChangeHandler=function(e){},e.prototype.onDestroy=function(){this.rb_1_1.selected?(egret.log("高帧率"),GameRootLayer.gameLayer().stage.frameRate=60,Utils.LocalStorageUtil.setItem("SETTING_PERFORMANCE_FPS",GameRootLayer.gameLayer().stage.frameRate.toString(),!0)):(egret.log("默认帧率"),GameRootLayer.gameLayer().stage.frameRate=Utils.MathUtils.isNumber(Utils.SDKMgr.getPerformConfig(11))?Number(Utils.SDKMgr.getPerformConfig(11)):30,Utils.LocalStorageUtil.removeItem("SETTING_PERFORMANCE_FPS",!0)),this.rb_2_0.selected?(egret.log("简洁模型"),dragonBones.EgretFactory.skipFrame=Utils.agentConfig.other&&Utils.agentConfig.other.performance&&Utils.agentConfig.other.performance.skipFrame||1,Utils.LocalStorageUtil.setItem("SETTING_PERFORMANCE_MODEL_SKIP_FRAME",dragonBones.EgretFactory.skipFrame.toString(),!0)):(egret.log("标准模型"),dragonBones.EgretFactory.skipFrame=0,Utils.LocalStorageUtil.removeItem("SETTING_PERFORMANCE_MODEL_SKIP_FRAME",!0))},e}(BasePanel);p.SysytemPerformanceSettingPanel=t,__reflect(t.prototype,"game.SysytemPerformanceSettingPanel");var i=function(i){function e(){var e=i.call(this)||this;return e.array=[],e.playerProxy=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N),e.heroPy=p.AppFacade.getInstance().retrieveProxy(p.HeroPy.N),e.heroThingProxy=p.AppFacade.getInstance().retrieveProxy(p.HeroThingPy.N),e.skinName="ModifyAvatarSkin",e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.btn_hero.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.onScorllerData(1)},this),this.btn_special.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SDKMgr.getPerformConfig(10)&&Utils.isXYX()&&p.MainJumpConfig.jumpTo("XYX_USERINFO",void 0,{cb:function(e){e&&(t.xyxHeadLink=e.avatarUrl),2==t.selectType&&t.onScorllerData(2)}}),t.onScorllerData(2)},this),this.btn_frame.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.onScorllerData(3)},this),this.list=new eui.List;var e=new eui.TileLayout;e.verticalGap=10,e.horizontalGap=10,e.requestedColumnCount=5,this.list.layout=e,this.scr_avavarList.viewport=this.list,this.list.itemRenderer=n,this.onScorllerData()},e.prototype.onScorllerData=function(e){var i=this;switch(this.array=[],this.selectType=e||1,this.selectType){case 1:var t=this.heroPy.heroHistoryInfo;for(var n in t){var o={code:n,avatar:(s=p.Config.allHeroConfig()[n]).avatar,type:EEntityType.EEntityTypeHero,dt:t[n].dt,initStar:s.initStar,subType:1};this.array.push(o)}var a=this.heroThingProxy.dermaiHostory;for(var r in a){var s=p.Config.getHeroDermaConfig()[a[r].code];o={code:a[r].code,avatar:s.avatar,type:EEntityType.EEntityTypeHero,dt:a[r].dt,subType:1};this.array.push(o)}for(var r in this.array){(o=this.array[r]).avatar==this.playerProxy.playerInfoVO.avatar&&(o.chosen=!0)}break;case 2:var c=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N).AllItemInfo,l=p.Config.itemConfig();for(var n in c)l[n]&&l[n].type==EPropType.EPropTypeAvatar&&this.array.push({code:n,avatar:l[n].icon,type:EEntityType.EEntityTypeItem,dt:c[n][0].dt,subType:2});for(var r in this.array){(o=this.array[r]).avatar==this.playerProxy.playerInfoVO.avatar&&(o.chosen=!0)}this.xyxHeadLink&&this.array.push({code:0,avatar:this.xyxHeadLink,type:0,dt:0,subType:2});break;case 3:c=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N).AllItemInfo,l=p.Config.itemConfig();for(var n in c)l[n]&&l[n].type==EPropType.EPropTypeFrame&&this.array.push({code:n,avatar:l[n].icon,frame:l[n].icon,type:this.selectType,dt:c[n][0].dt,subType:3});for(var r in this.array.push({code:0,avatar:"",frame:JSON.parse(p.Config.constConfig().DefaultFrame.constValue)[0],type:this.selectType,dt:1e16,subType:3}),this.array){((o=this.array[r]).frame==this.playerProxy.playerInfoVO.frame||!this.playerProxy.playerInfoVO.frame&&0==o.code)&&(o.chosen=!0)}}this.array.sort(function(e,t){return i.compareFunc(e,t)}),this.removeDuplicateAvatar();var h=new eui.ArrayCollection(this.array);this.list.dataProvider=h,this.gp_empty.visible=0==this.array.length},e.prototype.updateView=function(){},e.prototype.perClose=function(){},e.prototype.removeDuplicateAvatar=function(){var t=[],i={};this.array.forEach(function(e){i[e.avatar]||(i[e.avatar]={dt:e.dt},t.push(e))}),this.array=[],this.array=t.reverse()},e.prototype.compareFunc=function(e,t){return e.dt<t.dt?-1:e.dt>t.dt?1:e.code-t.code},e}(BasePanel);p.ModifyAvatar=i,__reflect(i.prototype,"game.ModifyAvatar");var n=function(i){function e(e){var t=i.call(this)||this;return t.skinName="AvatarItemSkin",e&&(t.data=e),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("更换头像");var e=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N);3==t.data.subType?e.changeFrame({type:t.data.type,code:t.data.code}):e.changeAvatar({type:t.data.type,code:t.data.code,avatar:t.data.avatar}),p.AppFacade.getInstance().hideSubView(p.PlayerMediator.N,p.PlayerMediator.SV.MODIFY_AVATAR)},t),t}return __extends(e,i),e.prototype.dataChanged=function(){this.player_head.updateData({vo:this.data,effect:!0});var e=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N);this.data.level&&this.data.level>e.playerInfoVO.level&&UIActionManager.setGrey(this.player_head),this.img_chose.visible=!!this.data.chosen},e}(eui.ItemRenderer);p.AvatarItem=n,__reflect(n.prototype,"game.AvatarItem");var o=function(n){function e(){var e=n.call(this)||this;return e.loginProxy=p.AppFacade.getInstance().retrieveProxy(p.LoginPy.N),e.playerPy=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N),e.skinName="ModifyRoleNameSkin",e}return __extends(e,n),e.prototype.childrenCreated=function(){var t=this;if(n.prototype.childrenCreated.call(this),this.addEvents(),this.cu_ctc.blb_title.text="改名",this.loginProxy.loginGameVO.isCreated){this.gp_created.visible=!0,this.gp_noCreate.visible=!1,this.gp_cost.visible=!0;var e=JSON.parse(p.Config.constConfig().ChangeNameExpense.constValue),i=p.GeneralConfig.getEntityConfigByCode(e[0][0],e[0][0]);RES.getResAsync(ResourceUtils.png(i.icon),function(e){t.img_diamonds.source=e},this),this.lb_cost.text="x"+e[0][2]}else this.gp_created.visible=!1,this.gp_noCreate.visible=!0,this.gp_cost.visible=!1,this.ed_input.y+=30,this.btn_random.y+=30;this.randomName(),Utils.isXYX()&&!Utils.SDKMgr.getPerformConfig(33)&&(this.btn_wechat.visible=!0)},e.prototype.addEvents=function(){var t=this;this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.cancelFunc,this),this.btn_conform.addEventListener(egret.TouchEvent.TOUCH_TAP,this.conformFunc,this),this.btn_random.addEventListener(egret.TouchEvent.TOUCH_TAP,this.randomName,this),this.btn_conform2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.conformFunc,this),this.btn_wechat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){p.MainJumpConfig.jumpTo("XYX_USERINFO",void 0,{cb:function(e){e&&(t.ed_input.text=Utils.Http.checkStrLegal(e.nickName,!1,""))}})},this)},e.prototype.removeEvents=function(){this.btn_cancel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.cancelFunc,this),this.btn_conform.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.conformFunc,this),this.btn_random.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.randomName,this),this.btn_conform2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.conformFunc,this)},e.prototype.cancelFunc=function(){p.AppFacade.getInstance().hideSubView(p.PlayerMediator.N,p.PlayerMediator.SV.ROLE_NAME)},e.prototype.conformFunc=function(){if(""==this.ed_input.text)Utils.MsgUtils.addMidMsg("请输入角色名字");else if(Utils.SDKMgr.getPerformConfig(30)){if(Utils.Http.checkStrLegal(this.ed_input.text,!1,"")){var e=Utils.Http.checkStrLegal(this.ed_input.text,!1,"");e!=this.playerPy.playerInfoVO.name?this.playerPy.changeName(e):Utils.MsgUtils.addMidMsg("该名称已存在")}}else Utils.Http.checkStrLegal(this.ed_input.text,!0)&&(this.ed_input.text!=this.playerPy.playerInfoVO.name?this.playerPy.changeName(this.ed_input.text):Utils.MsgUtils.addMidMsg("该名称已存在"))},e.prototype.randomName=function(){this.ed_input.text=this.playerPy.getRandomName()},e.prototype.preClose=function(){this.removeEvents()},e}(BasePanel);p.ChangeRoleNamePanel=o,__reflect(o.prototype,"game.ChangeRoleNamePanel");var r=function(t){function e(){var e=t.call(this)||this;return e.skinName="ContactServicesSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEvents(),this.edt_input.textColor=9991254,this.lb_qq.text=getUrlKV().qq||Utils.agentConfig.other.qq||"",this.lb_email.text=getUrlKV().email||Utils.agentConfig.other.email||"",this.lb_qqTtile.text=getUrlKV().qqTitle||Utils.agentConfig.other.qqTitle||"官方QQ群:",this.lb_emallTitle.text=getUrlKV().emailTitle||Utils.agentConfig.other.emailTitle||"客服邮箱:",Utils.agentConfig.other&&Utils.agentConfig.other.dismissContact&&(this.gp_contact.visible=!1)},e.prototype.addEvents=function(){this.btn_comform.addEventListener(egret.TouchEvent.TOUCH_TAP,this.conform,this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.cancel,this)},e.prototype.removeEvents=function(){this.btn_comform.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.conform,this),this.btn_cancel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.cancel,this)},e.prototype.conform=function(){var t=this;if(100<this.edt_input.text.length)Utils.MsgUtils.addMidMsg("长度过长！");else if(0==this.edt_input.text.length)Utils.MsgUtils.addMidMsg("内容不得为空！");else{var e=p.AppFacade.getInstance().retrieveProxy(p.LoginPy.N),i=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N);(new Http).toGet({action:"player_feedback",content:this.edt_input.text,player_id:i.playerInfoVO.playerId,username:e.userVO.username,name:i.playerInfoVO.name,server_id:e.serverSelect.s_id}).then(function(e){"success"==e.msg?(Utils.MsgUtils.addMidMsg("发送成功"),PopUpManager.removePopUp(t)):Utils.MsgUtils.addMidMsg("发送失败，请重试！")})}},e.prototype.cancel=function(){PopUpManager.removePopUp(this)},e.prototype.preClose=function(){this.removeEvents()},e}(BasePanel);p.ContactServices=r,__reflect(r.prototype,"game.ContactServices")}(game||(game={})),function(n){var e=function(t){function i(e){return void 0===e&&(e=null),t.call(this,i.N,e)||this}return __extends(i,t),i.prototype.initSubView=function(){this.addSubView(i.SV.MAIN,n.PlayerInfoPanel),this.addSubView(i.SV.SERVER_LIST,n.ServersPanel),this.addSubView(i.SV.MODIFY_AVATAR,n.ModifyAvatar),this.addSubView(i.SV.SYSTEM_SETTING,n.SystemSettingPanel),this.addSubView(i.SV.ROLE_NAME,n.ChangeRoleNamePanel),this.addSubView(i.SV.XYX_USERINFO,n.XYXUserInfoView)},i.prototype.listNotificationInterests=function(){return[CN.PLAYERINFO_MAIN_UPDATE,CN.PLAYER_LEVEL_UP]},i.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.PLAYERINFO_MAIN_UPDATE:this.getSubView(i.SV.MAIN)&&this.getSubView(i.SV.MAIN).updateView();break;case CN.PLAYER_LEVEL_UP:Utils.MsgUtils.shengjiEffect(),n.AppFacade.getInstance().sendNotification(CN.QQZONE_PUSH_MESSAGE,{data:t,type:"playerLevelUp"})}},i.N="PlayerMediator",i.SV={MAIN:1,SERVER_LIST:2,MODIFY_AVATAR:3,SYSTEM_SETTING:4,ROLE_NAME:5,XYX_USERINFO:6},i}(BaseMediator);n.PlayerMediator=e,__reflect(e.prototype,"game.PlayerMediator")}(game||(game={})),function(n){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new i).register(),(new o).register(),(new a).register(),(new r).register(),(new s).register(),(new c).register(),(new l).register()},e}();n.PlayerProcessor=e,__reflect(e.prototype,"game.PlayerProcessor");var t=function(t){function i(){var e=t.call(this,"playerInfo.PlayerInfoP",i)||this;return e.playerProxy=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N),e}return __extends(i,t),i.prototype.execute=function(e){var t=e.getBody();if(this.checkCB(t)){Utils.DebugUtils.dumpPbMsg(t);var i=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N);i.playerInfoVO.fightCap-t.fightCap!=0&&this.playerProxy.checkFight(i.playerInfoVO.fightCap,t.fightCap,t.source),t.level!=i.playerInfoVO.level?egret.setTimeout(function(){i.playerInfoVO.update(t)},this,500):i.playerInfoVO.update(t),this.sendNotification(CN.PLAYER_INFO_UPDATE)}},i}(n.ProcessorBase);n.PlayerInfoP=t,__reflect(t.prototype,"game.PlayerInfoP");var i=function(e){function t(){return e.call(this,"playerInfo.PushRechargeP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();this.checkCB(t)&&(n.AppFacade.getInstance().retrieveProxy(n.BackpackPy.N).handleClientReward(t.clientReward),n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N).playerInfoVO.playerVip.update(t.playerVipInfo),this.sendNotification(CN.PLAYER_INFO_UPDATE),n.AppFacade.getInstance().sendNotification(CN.MONEY_UPDATE),n.AppFacade.getInstance().sendNotification(CN.RECHARGE_GET_DATA),Utils.MsgUtils.addMidMsg("充值成功"),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.VipGift]),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.VipWelfare]),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.VipPreferentialGift]),NoticeManager.updateNotice(NT.VIP_GIFT),n.GameMVC.activityMed.updateViewByCode(EActivityType.VipWelfare),n.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN),n.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_PET))},t}(n.ProcessorBase);n.PushRechargeP=i,__reflect(i.prototype,"game.PushRechargeP");var o=function(e){function t(){return e.call(this,"playerInfo.PushPlayerVipP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();this.checkCB(t)&&(n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N).playerInfoVO.playerVip.update(t.playerVipInfo),this.sendNotification(CN.PLAYER_INFO_UPDATE),n.AppFacade.getInstance().sendNotification(CN.MONEY_UPDATE),n.AppFacade.getInstance().sendNotification(CN.RECHARGE_GET_DATA),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.VipWelfare]),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.VipGift]),NoticeManager.updateNotice(NT.VIP_GIFT),n.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_PET))},t}(n.ProcessorBase);n.PushPlayerVipP=o,__reflect(o.prototype,"game.PushPlayerVipP");var a=function(e){function t(){return e.call(this,"playerInfo.PushMonthCardP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();this.log("PushMonthCardP",t),n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N).playerInfoVO.playerVip.update(t.playerVipInfo),this.sendNotification(CN.PLAYER_INFO_UPDATE)},t}(n.ProcessorBase);n.PushMonthCardP=a,__reflect(a.prototype,"game.PushMonthCardP");var r=function(e){function t(){return e.call(this,"playerInfo.redeemRewardP",t)||this}return __extends(t,e),t.prototype.execute=function(e){if(this.checkCB(e.getBody()))e.getBody(),n.AppFacade.getInstance().retrieveProxy(n.BackpackPy.N)},t}(n.ProcessorBase);n.RedeemRewardP=r,__reflect(r.prototype,"game.RedeemRewardP");var s=function(e){function t(){return e.call(this,"playerInfo.OnNewDayP",t)||this}return __extends(t,e),t.prototype.execute=function(e){Utils.UnlockMgr.clearLockedInfoByType([UnlockType.ServerOpenDay,UnlockType.LevelAndServerOpenDay]),n.AppFacade.getInstance().sendNotification(CN.GENERAL_PASS_DAY)},t}(n.ProcessorBase);n.OnNewDayP=s,__reflect(s.prototype,"game.OnNewDayP");var c=function(e){function t(){return e.call(this,"playerInfo.FrameInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();n.GameMVC.playerPy.playerInfoVO.frame=t.frame,n.AppFacade.getInstance().sendNotification(CN.PLAYER_INFO_UPDATE)},t}(n.ProcessorBase);n.FrameInfoP=c,__reflect(c.prototype,"game.FrameInfoP");var l=function(e){function t(){return e.call(this,"playerInfo.PushErrorP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();n.AppFacade.getInstance().sendNotification(CN.PLAYER_INFO_ERROR,{error:t.err})},t}(n.ProcessorBase);n.PushErrorP=l,__reflect(l.prototype,"game.PushErrorP")}(game||(game={})),function(o){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.fightObj={beforeFight:0,afterFight:0,isFirst:!0},e.publicPlayerBaseInfoCash={},e.publicPlayerBaseInfoCashTime=0,e.publicPlayerInfoCash={},e.publicPlayerInfoCashTime=0,e.roleVo=new o.RoleVO,e.loginStatusVO=new o.LoginStatusVO,e.playerInfoVO=new o.PlayerInfoVO,e.fightCapRanks=new Array,e.levelRanks=new Array,e.playerGuildVO=new o.PlayerGuildVO({}),e.fightObj.beforeFight=0,e.fightObj.afterFight=0,e.canShow=!0,e}return __extends(i,t),i.prototype.getCanShowUpdateLog=function(){return 14<=Utils.TimerManager.getServerOpenDays()},i.prototype.checkNeedPopUpdateLog=function(){if(this.getCanShowUpdateLog()&&30<=this.playerInfoVO.level&&Utils.SDKMgr.getPerformConfig(12)){var e=Utils.LocalStorageUtil.getItem("POP_UPDATE_LOG_URL",!0),t=RES.getResourceInfo("common_gg_01_png");if(t&&e!=t.url)return Utils.LocalStorageUtil.setItem("POP_UPDATE_LOG_URL",t.url,!0),!0}},i.prototype.checkAndPopAds=function(){if(30<=this.playerInfoVO.level&&Array.isArray(Utils.SDKMgr.getPerformConfig(200001))&&0<Utils.SDKMgr.getPerformConfig(200001).length){var e=Utils.LocalStorageUtil.getItem("POP_ADS_URL",!1),t=RES.getResourceInfo(Utils.SDKMgr.getPerformConfig(200001)[0]);t&&e!=t.url&&(Utils.LocalStorageUtil.setItem("POP_ADS_URL",t.url,!1),PopUpManager.addPopUp({obj:new o.AdsPanel({arrs:Utils.SDKMgr.getPerformConfig(200001)})}))}},i.prototype.checkAndPopSthWhenFirstGuideEnd=function(){if(Array.isArray(Utils.SDKMgr.getPerformConfig(200004))&&0<Utils.SDKMgr.getPerformConfig(200004).length){var e=Utils.LocalStorageUtil.getItem("POP_FIRST_GUIDE_END_IMG_URL",!1),t=RES.getResourceInfo(Utils.SDKMgr.getPerformConfig(200004)[0]);t&&e!=t.url&&(Utils.LocalStorageUtil.setItem("POP_FIRST_GUIDE_END_IMG_URL",t.url,!1),PopUpManager.addPopUp({obj:new o.AdsPanel({arrs:Utils.SDKMgr.getPerformConfig(200004)})}))}},i.prototype.checkFight=function(e,t,i){this.canShow?(0!=e&&0!=t&&e!=t&&i!=EFightCapChangeSource.ChangeFormation&&Utils.MsgUtils.addCapChangeEffect(e,t),this.fightObj.beforeFight=0,this.fightObj.afterFight=0,this.fightObj.isFirst=!0):this.fightObj.isFirst?(this.fightObj.beforeFight=e,this.fightObj.afterFight=t,this.fightObj.isFirst=!1):this.fightObj.afterFight=t},i.prototype.getRandomName=function(){var e=o.Config.getPerNameList(),t=o.Config.getNextNameList();return e[Math.floor(1e4*Math.random())%e.length]+"的"+t[Math.floor(1e4*Math.random())%t.length]},i.prototype.getFadeName=function(){var e=o.Config.getRandNameList();return e[Utils.MathUtils.getRandomInt(0,e.length-1)]},i.prototype.makeFadePlayerInfo=function(){this.playerInfoVO.name=this.getRandomName(),this.playerInfoVO.level=Math.floor(100*Math.random())+1,this.playerInfoVO.avatar=DefaultValue.avatar,this.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeDiamond]=Math.floor(1e4*Math.random()),this.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeGold]=Math.floor(1e3*Math.random()),this.playerInfoVO.exp=Math.floor(100*Math.random()),this.playerInfoVO.playerVip.vipLevel=Math.floor(10*Math.random())%9+1,this.playerInfoVO.fightCap=Math.floor(1e6*Math.random())},i.prototype.changeName=function(i){var n=this;o.GameMVC.mainPy.checkTextVaild(i,function(){Utils.Socket.send("playerInfo","ChangeName",{name:i}).then(function(e){Utils.MsgUtils.addMidMsg("您的名字已更新"),n.GetPlayerInfo();var t=n.playerInfoVO.name;n.roleVo.name=n.playerInfoVO.name=i,Utils.SDKMgr.enterFlow("PlayerRename",{oldName:t}),o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N).handleClientCostCore(e.clientCost),o.AppFacade.getInstance().retrieveProxy(o.LoginPy.N).loginGameVO.isCreated=!0,o.AppFacade.getInstance().hideSubView(o.PlayerMediator.N,o.PlayerMediator.SV.ROLE_NAME)}).catch(function(e){})},14)},i.prototype.changeAvatar=function(e){var t=this;Utils.Socket.send("playerInfo","ChangeAvatar",{type:e.type,code:e.code,avatar:e.avatar}).then(function(e){t.GetPlayerInfo()}).catch(function(e){})},i.prototype.changeFrame=function(e){var t=this;Utils.Socket.send("playerInfo","ChangeFrame",{code:e.code}).then(function(e){t.GetPlayerInfo()}).catch(function(e){})},i.prototype.GetPlayerInfo=function(t){var i=this;Utils.Socket.send("playerInfo","GetPlayerInfo",{}).then(function(e){i.playerInfoVO.update(e),t&&t(),i.sendNotification(CN.PLAYER_INFO_UPDATE),i.sendNotification(CN.PLAYERINFO_MAIN_UPDATE),i.sendNotification(CN.PLAYER_OUTLOOK_UPDATE)})},i.prototype.isInSameServer=function(e){return e==o.GameMVC.loginPy.serverSelect.area},i.prototype.GetPublicPlayerBaseInfo=function(i,n){return __awaiter(this,void 0,void 0,function(){var t,o,a,r,s=this;return __generator(this,function(e){switch(e.label){case 0:return t=[],o={},a=[],r=Utils.TimerManager.getServerTime(),i.forEach(function(i,n){s.publicPlayerBaseInfoCash[i]&&r-s.publicPlayerBaseInfoCash[i].getDataTime<s.publicPlayerBaseInfoCashTime?(a[n]=s.publicPlayerBaseInfoCash[i],o[i]=s.publicPlayerBaseInfoCash[i]):t.push(Utils.Socket.send("playerInfo","GetBasePlayerInfo",{playerId:i}).then(function(e){var t=Utils.TimerManager.getServerTime();e.getDataTime=t,s.publicPlayerBaseInfoCash[i]=e,a[n]=e,o[i]=e}))}),[4,Promise.all(t)];case 1:return e.sent(),n(a,o),[2]}})})},i.prototype.GetPublicPlayerInfo=function(i,n){return __awaiter(this,void 0,void 0,function(){var t,o,a,r,s=this;return __generator(this,function(e){switch(e.label){case 0:return t=[],o={},a=[],r=Utils.TimerManager.getServerTime(),i.forEach(function(i,n){s.publicPlayerInfoCash[i]&&r-s.publicPlayerInfoCash[i].getDataTime<s.publicPlayerInfoCashTime?(a[n]=s.publicPlayerInfoCash[i],o[i]=s.publicPlayerInfoCash[i]):t.push(Utils.Socket.send("playerInfo","GetPublicPlayer",{playerId:i}).then(function(e){var t=Utils.TimerManager.getServerTime();e.getDataTime=t,s.publicPlayerInfoCash[i]=e,a[n]=e,o[i]=e}))}),[4,Promise.all(t)];case 1:return e.sent(),n(a,o),[2]}})})},i.prototype.ChallengePlayer=function(e){this.challengePlayerId=e,this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypePvP,pb1:"battle",pb2:"ChallengePlayer",params:{playerId:e}})},i.N="PlayerProxy",i}(BaseProxy);o.PlayerPy=e,__reflect(e.prototype,"game.PlayerPy")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.array=[],e.data=[],e.skinName="ServersSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.rootPanel.gp_title.visible=!1,this.rootPanel.onCloseCB=function(){e.hide()},this.initList()},e.prototype.initList=function(){this.list_serverList.itemRenderer=i,this.list_areaList.itemRenderer=n,this.list_areaList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onAreaItemTap,this)},e.prototype.onAreaItemTap=function(e){var i=this;e&&null!=e.itemIndex&&(this.selectAreaIndex=e&&e.itemIndex);var t=this.list_areaList.dataProvider;t.source.forEach(function(e,t){e.selected=t==i.selectAreaIndex}),t.refresh(),this.updateServerList()},e.prototype.updateAreaList=function(){var t=[];this.data.forEach(function(e){t.push({name:e.name,selected:!1})}),this.list_areaList.dataProvider=new eui.ArrayCollection(t)},e.prototype.updateServerList=function(){this.scr_serverList.stopAnimation(),this.scr_serverList.viewport.scrollV=0;var t=[],i=this.data[this.selectAreaIndex];i.list.forEach(function(e){t.push({info:e,showServer:0==i.index})}),t.sort(function(e,t){return t.info.area-e.info.area}),this.list_serverList.dataProvider=new eui.ArrayCollection(t)},e.prototype.updateView=function(e){var t=this;this.data.length?(null==this.selectAreaIndex&&(this.selectAreaIndex=0==this.data[0].list.length&&1<this.data.length?1:0),this.onAreaItemTap()):a.GameMVC.loginPy.getAllPlayerServer(function(e){t.data=e,t.updateAreaList(),t.updateView()})},e.prototype.perClose=function(){this.list_areaList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onAreaItemTap,this)},e}(BasePanel);a.ServersPanel=e,__reflect(e.prototype,"game.ServersPanel");var i=function(t){function o(){var e=t.call(this)||this;return e.skinName="ServerItemSkin",e}return __extends(o,t),o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.switchServer,this),this.playerHead=customui.PlayerHeadFactory.create(),this.playerHead.scaleX=this.playerHead.scaleY=.7,this.playerHead.x=290,this.playerHead.verticalCenter=0,this.addChild(this.playerHead)},o.prototype.switchServer=function(){var e=this.data.info;1!=e.s_healthStatus?a.GameMVC.loginPy.serverSelect&&e.s_id==a.GameMVC.loginPy.serverSelect.s_id?Utils.MsgUtils.addMidMsg("就在本服无需切换"):a.GameMVC.loginPy.switchServer(e.s_id,function(){a.AppFacade.getInstance().retrieveMediator(a.PlayerMediator.N).hideSubView(a.PlayerMediator.SV.SERVER_LIST)}):Utils.MsgUtils.addMidMsg("该服已满！")},o.prototype.dataChanged=function(){var t=this,e=this.data.info;if(this.lb_serverName.text=""+(this.data.showServer?e.list_name:"")+((e.area-1)%48+1)+"服",e.playerList){this.img_flag.visible=!1,this.lb_roleName.visible=!0,this.playerHead.visible=!0;var i=JSON.parse(a.Config.constConfig().DefaultAvatar.constValue)[0],n={level:e.playerList.lev,avatar:e.playerList.head&&""!=e.playerList.head?e.playerList.head:i,name:e.playerList.name};this.playerHead.updateData({vo:n}),this.lb_roleName.text=e.playerList.name}else this.lb_roleName.visible=!1,this.playerHead.visible=!1,this.img_flag.visible=!1,o.SERVER_FLAG[e.s_healthStatus]&&RES.getResAsync(o.SERVER_FLAG[e.s_healthStatus],function(e){t.img_flag.source=e,t.img_flag.visible=!0},this);o.SERVER_STATUS[e.s_healthStatus]&&RES.getResAsync(o.SERVER_STATUS[e.s_healthStatus],function(e){t.img_status.visible=!0,t.img_status.source=e},this),this.lb_roleName.visible=!1},o.SERVER_STATUS={1:"chuanghao_img_hongdian_png",2:"chuanghao_img_lvdian_png",3:"chuanghao_img_lvdian_png",4:"chuanghao_img_huidian_png"},o.SERVER_FLAG={1:"chuanghao_img_man_png",2:"",3:"chuanghao_img_xin_png",4:"chuanghao_img_weihu_png"},o}(eui.ItemRenderer);a.ServerItem=i,__reflect(i.prototype,"game.ServerItem");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="AreaItemSKin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.lb_name.text=this.data.name,this.img_bg.source=this.data.selected?"chuanghao_img_duandi1_png":"chuanghao_img_duandi0_png",this.icon_selected.visible=this.data.selected},e}(eui.ItemRenderer);__reflect(n.prototype,"AreaItem")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="XYXUserInfoViewSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},e.prototype.updateView=function(t,e){var i=this;void 0===e&&(e=!1),Utils.SDKMgr.cmd({type:"GetOpenData"},function(e){t&&t.cb&&t.cb(e),i.hide()})},e.prototype.onDestroy=function(){Utils.SDKMgr.cmd({type:"HideUserBtn"})},e}(BasePanel);e.XYXUserInfoView=t,__reflect(t.prototype,"game.XYXUserInfoView")}(game||(game={})),function(e){var t=function(i){function n(e){var t=i.call(this)||this;return t._armatureCreating=!1,t._uniqueCB={},t._normalCB=[],e&&(t.armatureName=e),t}return __extends(n,i),Object.defineProperty(n.prototype,"armatureName",{get:function(){return this._armature&&this._armature.armature&&this._armature.armature.name},set:function(e){null!=e?this.setArmatureName(e):this.warn("未提供有效骨骼名")},enumerable:!0,configurable:!0}),n.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.width=this.height=0},n.prototype.setOnArmatureCreated=function(e,t){this._armatureCreating?t?this._uniqueCB[t]=e:this._normalCB.push(e):e()},n.prototype.hasAnimation=function(e){return!!this._armature&&this._armature.animation.hasAnimation(e)},n.prototype.play=function(e,t,i,n){var o=this;void 0===t&&(t=!1),void 0===i&&(i=0),this._armatureCreating?this.setOnArmatureCreated(function(){o.play(e,t,i,n)},"playAnimation"):this._armature?this.hasAnimation(e)?!t&&this._armature.animation.isPlaying&&this._armature.animation.lastAnimationName==e||(this._armature.animation.play(e,i),n&&this._armature.once(dragonBones.EgretEvent.COMPLETE,n,this)):this.warn("play error:不存在指定动画    当前骨骼名："+this.armatureName+"    当前动画列表："+this._armature.animation.animationNames+"    待播放动画名："+e):this.warn("play error: 没有已创建或正在创建的骨骼")},n.prototype.stop=function(){var e=this;this._armatureCreating?this.setOnArmatureCreated(function(){e.stop()},"stopAnimation"):this._armature.animation.stop()},n.prototype.resume=function(){var e=this;this._armatureCreating?this.setOnArmatureCreated(function(){e.resume()},"resumeAnimation"):this._armature.animation.play()},n.prototype.onArmatureCreated=function(){for(var e in this._armatureCreating=!1,this.play(this.armatureName),this._normalCB.forEach(function(e){e&&e()}),this._normalCB.splice(0),this._uniqueCB){var t=this._uniqueCB[e];t&&t(),delete this._uniqueCB[e]}},n.prototype.setArmatureName=function(e){var t=this;this._armatureCreating?this.setOnArmatureCreated(function(){t.setArmatureName(e)},"setName"):this.armatureName!=e?(this._armature&&(this._armature.parent&&this._armature.parent.removeChild(this._armature),this._armature=void 0),e&&(this._armatureCreating=!0,DragonBoneTools.create(e,function(e){t.addChild(e),t._armature=e,t.onArmatureCreated()}))):this.log("已存在指定骨骼，放弃创建")},n.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];n.LOG_ENABLE&&egret.log.apply(egret,["【SteadyArmature】:"].concat(e))},n.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];n.LOG_ENABLE&&egret.warn.apply(egret,["【SteadyArmature】:"].concat(e))},n.LOG_ENABLE=!1,n}(eui.Component);e.SteadyArmature=t,__reflect(t.prototype,"customui.SteadyArmature")}(customui||(customui={})),function(h){var e=function(i){function n(){var e,t=i.call(this)||this;return t.CONFIG=((e={})[n.VIEW_TYPE.FIGHTCAP]={title:"战力榜",rankType:RankingType.RankingTypeFightCap,keyword:"战力",isGuild:!1,source:{up:"_btn_yq_m_json.common_yeqian_zhanli_0",down:"_btn_yq_m_json.common_yeqian_zhanli_1"}},e[n.VIEW_TYPE.LEVEL]={title:"等级榜",rankType:RankingType.RankingTypeLevel,keyword:"等级",isGuild:!1,source:{up:"_btn_yq_m_json.common_yeqian_dengjii_0",down:"_btn_yq_m_json.common_yeqian_dengjii_1"}},e[n.VIEW_TYPE.GUILD]={title:"公会榜",rankType:RankingType.RankingTypeGuild,keyword:"公会",isGuild:!0,source:{up:"_btn_yq_m_json.common_yeqian_gonghui_0",down:"_btn_yq_m_json.common_yeqian_gonghui_1"}},e),t.skinName="MainRankViewSkin",t.rankProxy=h.AppFacade.getInstance().retrieveProxy(h.RankPy.N),t}return __extends(n,i),n.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initScroll(),this.initTabbar(),this._activateComponent(),this.initEffect()},n.prototype.initEffect=function(){var t=this;DragonBoneTools.create("common_paihangbang_1",function(e){e.x=103,e.y=135,e.animation.play(),t.gp_rank1.addChild(e)}),DragonBoneTools.create("common_paihangbang_2",function(e){e.x=83,e.y=115,e.animation.play(),t.gp_rank2.addChild(e)}),DragonBoneTools.create("common_paihangbang_3",function(e){e.x=83,e.y=115,e.animation.play(),t.gp_rank3.addChild(e)})},n.prototype.initScroll=function(){this.list_item.itemRenderer=t,UIActionManager.hideScrollerBar(this.scl_rankList)},n.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin";var e=[];for(var t in this.CONFIG)e.push({source:this.CONFIG[t].source});this.tabbar.dataProvider=new eui.ArrayCollection(e),this.tabbar.selectedIndex=0,this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.updateView,this)},n.prototype.updateView=function(e){var c=this;e&&null!=e.itemIndex&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex);var l=this.CONFIG[this.tabbar.selectedIndex];this.scl_rankList.stopAnimation(),this.scl_rankList.viewport.scrollV=0,this.rankProxy.GetRankList(l,function(e){var t=(c.curRanks=e).ranks,i=e.selfRank;if(0!=t.length){for(var n=1;n<4;n++){var o=t[n-1];c.updateTop3Rank(n,o)}var a=[];t.forEach(function(e,t){2<t&&a.push({rankInfo:e,config:l})}),c.list_item.dataProvider=new eui.ArrayCollection(a)}var r=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N).playerInfoVO,s=h.AppFacade.getInstance().retrieveProxy(h.GuildPy.N).guildDetail;c.lb_title.text=l.title,c.lb_tips_self.visible=!1,c.item_fightCap_self.visible=!1,l.isGuild?i&&i.rank&&s?(c.playerHead_self.visible=!1,c.guildHead_self.visible=!0,c.lb_rank_self.text=i.rank,c.lb_name_self.text=s.name,c.guildHead_self.updateData({vo:s}),c.item_fightCap_self.visible=!0,c.item_fightCap_self.update(s.fightCap)):(c.lb_rank_self.text="",c.playerHead_self.visible=!0,c.guildHead_self.visible=!1,c.playerHead_self.updateData({vo:r}),c.lb_name_self.text=r.name,c.lb_tips_self.visible=!0,c.lb_tips_self.text="暂无公会"):(c.playerHead_self.visible=!0,c.guildHead_self.visible=!1,c.lb_rank_self.text=i.rank,c.playerHead_self.updateData({vo:r}),c.lb_name_self.text=r.name,c.item_fightCap_self.visible=!0,c.item_fightCap_self.update(r.fightCap))})},n.prototype.updateTop3Rank=function(e,t){var i=this.CONFIG[this.tabbar.selectedIndex],n=this["playerHead_"+e],o=this["guildHead_"+e],a=(this["gp_info_"+e],this["lb_name_"+e]),r=this["lb_fightCap_"+e];i.isGuild?(n.visible=!1,o.visible=!0,o.updateData({vo:t.guildBaseInfo}),r.text=t.guildBaseInfo.fightCap.toString(),a.text=t.guildBaseInfo.name):(n.visible=!0,o.visible=!1,n.updateData({vo:t.playerBaseInfo}),r.text=t.playerBaseInfo.fightCap.toString(),a.text=t.playerBaseInfo.name)},n.prototype._activateComponent=function(){var i=this;this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this);for(var e=function(t){n["playerHead_"+(t+1)].addTapEvent(function(){var e=i.curRanks&&i.curRanks.ranks[t];if(e){h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N);e.playerBaseInfo&&e.playerBaseInfo.playerId&&h.AppFacade.getInstance().showSubView(h.FriendMediator.N,h.FriendMediator.SV.INFO,{playerId:e.playerBaseInfo.playerId})}Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)})},n=this,t=0;t<3;++t)e(t)},n.VIEW_TYPE={FIGHTCAP:0,LEVEL:1,GUILD:2},n}(BasePanel);h.MainRankPanel=e,__reflect(e.prototype,"game.MainRankPanel");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="MainRankPanel_RankItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.playerHead.addTapEvent(function(){h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N);e.data.rankInfo.playerBaseInfo&&e.data.rankInfo.playerBaseInfo.playerId&&h.AppFacade.getInstance().showSubView(h.FriendMediator.N,h.FriendMediator.SV.INFO,{playerId:e.data.rankInfo.playerBaseInfo.playerId}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)})},e.prototype.dataChanged=function(){var e=this.data.config,t=this.data.rankInfo;if(this.lb_rank.text=t.rank.toString()||"",e.isGuild){var i=t.guildBaseInfo;this.playerHead.visible=!1,this.guildHead.visible=!0,this.guildHead.updateData({vo:i}),this.lb_name.text=i.name,this.item_fightCap.update(i.fightCap)}else{var n=t.playerBaseInfo;this.playerHead.visible=!0,this.guildHead.visible=!1,this.playerHead.updateData({vo:n}),this.lb_name.text=n.name,this.item_fightCap.update(n.fightCap)}},e}(eui.ItemRenderer);__reflect(t.prototype,"MainRankPanel_RankItem")}(game||(game={})),function(u){var e=function(){function e(){}return e.Config={TEMPLATE:{rankType:void 0,keywordIcon:void 0,getExtraItem:function(e){},updateExtraItem:function(e,t){}},WORLD_KING_RANK:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,keyWord:"段位",rankType:RankingType.RankingTypeWorldWorldKing,getExtraItem:function(e){var t=new customui.WorldKingBadge;return t.scaleX=t.scaleY=.14,t.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.WORLD_KING,grade:e.key,fromRank:!0}),t},updateExtraItem:function(e,t){e.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.WORLD_KING,grade:t.key,fromRank:!0})}}],WORLD_KING_REWARD:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){return i(RankingType.RankingTypeWorldWorldKing)},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=u.AppFacade.getInstance().retrieveProxy(u.WorldKingPy.N).worldKingInfo.cWorldRank;e.topRank=t;var i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeWorldWorldKing);for(var n in i){var o=i[n];t>=o.rankUpper&&t<=o.rankLower&&(e.targetRewards=JSON.parse(o.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}},{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,title:"成就奖励",desc:["成就","奖励"],getRewardList:function(){var s=u.AppFacade.getInstance().retrieveProxy(u.WorldKingPy.N),c=s.worldKingInfo.cWorldRank,l=s.worldKingInfo,h=JSON.parse(l.gotRewards),p=u.Config.worldKingRewardConfig(WorldKingRewardType.Level),d=[],e=function(e){var t=p[e],i=u.Config.worldKingLevelConfig()[JSON.parse(t.key)[0]],n=-1!=h.indexOf(t.code),o=!n&&l.hLevel>=JSON.parse(t.key)[0],a=t.code,r=void 0;r=n?REWARD_STATUS.RECEIVED:o?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,d.push({desc:"段位达到"+i.name,requestRank:a,pbMax:c,pbValue:a,status:r,rewards:t.rewards,btnFunc:function(){s.GetReward({type:t.type,id:t.code})}})};for(var t in p)e(t);return d.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),d},bottomBtn:{label:"一键领取",callback:function(){u.AppFacade.getInstance().retrieveProxy(u.WorldKingPy.N).GetReward({type:1,id:0})}}}]}],ACTIVITY_QUORA:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){var e=i(RankingType.RankingTypeNewZoneActivityQuora);for(var t in e){e[t].backColor=!0}return e},img_bestRank:"jsjhd_txt_nddqpm_png",getTopRankInfo:function(){var e,t={topRank:void 0,desc:"描述：",targetRewards:[]},i=u.GameMVC.rankPy.getSelfRank(RankingType.RankingTypeNewZoneActivityQuora);e=t.topRank=i&&i.rank||999,t.topRank=e;var n=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeNewZoneActivityQuora);for(var o in n){var a=n[o];e>=a.rankUpper&&e<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],ARENA:{rankType:RankingType.RankingTypeArena,type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK},ARENA2:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){return i(RankingType.RankingTypeArena)},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=u.AppFacade.getInstance().retrieveProxy(u.ArenaPy.N).arenaInfo.hRank;e.topRank=t;var i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeArena);for(var n in i){var o=i[n];t>=o.rankUpper&&t<=o.rankLower&&(e.targetRewards=JSON.parse(o.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}},{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,title:"成就奖励",desc:["成就","奖励"],notice:NT.ARENA_REWARD_LINQU,getRewardList:function(){var e=u.AppFacade.getInstance().retrieveProxy(u.ArenaPy.N),o=e.arenaInfo.hRank,a=e.arenaInfo.hRankTargeted,r=e.arenaInfo.rank,s=u.Config.arena_hRankReward(),c=[],t=function(e){var t=s[e],i=t.rank;if(!i)return"continue";var n=REWARD_STATUS.UNAVAILABLE;-1!=a.indexOf(t.rank)?n=REWARD_STATUS.RECEIVED:o<=i&&(n=REWARD_STATUS.AVAILABLE),c.push({desc:"排名达到"+i+"名",requestRank:i,pbMax:r,pbValue:i,status:n,rewards:t.rewards,btnFunc:function(){Utils.Socket.send("arena","ReceiveHRankReward",{rank:i}).then(function(e){u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N).handleClientReward(e.clientReward,2),u.AppFacade.getInstance().retrieveProxy(u.ArenaPy.N).arenaInfo.update(e.arenaInfo),u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}})};for(var i in s)t(i);return c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),c},bottomBtn:{label:"一键领取",callback:function(){Utils.Socket.send("arena","ReceiveHRankReward",{rank:0}).then(function(e){u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N).handleClientReward(e.clientReward,2),u.AppFacade.getInstance().retrieveProxy(u.ArenaPy.N).arenaInfo.update(e.arenaInfo),u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}}}]}],WORLD_BOSS_RANK:{configs:[{rankType:RankingType.RankingTypePlayerServerBossHurt,keyWord:"伤害",title:"日排行"}]},WORLD_BOSS_REWARD:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"日奖励",getRewardList:function(){return i(RankingType.RankingTypePlayerServerBossHurt,{backColor:!0})},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypePlayerServerBossHurt,function(e){i=t.topRank=e.selfRank.rank});var n=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypePlayerServerBossHurt);for(var o in n){var a=n[o];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],WORLD_BOSS_ACHIEVE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){var r=u.AppFacade.getInstance().retrieveProxy(u.WorldBossPy.N),e=r.playerInfo||r.temInfo.playerBossInfo,s=JSON.parse(e.timesReward),c=e.challengeTimes,l=u.Config.serverBossReward(2),h=[],t=function(e){var t=l[e].id,i=void 0,n=0<=s.indexOf(t),o=l[e].rankUpper,a=o<=c;i=n?REWARD_STATUS.RECEIVED:a?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,h.push({desc:"挑战BOSS"+o+"次",requestRank:o,status:i,rewards:l[e].rewards,btnFunc:function(){r.GetPlayerTimesReward(t,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}})};for(var i in l)t(i);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),h},bottomBtn:{label:"一键领取",callback:function(){u.AppFacade.getInstance().retrieveProxy(u.WorldBossPy.N).GetPlayerTimesReward(0,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}}}]}],HERO_SPRITE_RANK:{configs:[{rankType:RankingType.RankingTypeHeroSpirit,keyWord:"激活页数",title:"排行"}]},HERO_SPRITE_ACHIEVE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){var r=u.GameMVC.heroSpiritPy,s=JSON.parse(r.achieveTargeted),c=r.getAllLevelInfo(),l=u.Config.heroSpriteAchievementReward(),h=[],e=function(e){var t=l[e].id,i=void 0,n=0<=s.indexOf(t),o=l[e].num,a=o<=c;i=n?REWARD_STATUS.RECEIVED:a?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,h.push({desc:"激活"+o+"页",request:o,status:i,rewards:l[e].rewards,btnFunc:function(){r.GetHeroSpiritAchievementRewards(t,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}})};for(var t in l)e(t);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.request-t.request}),h},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.heroSpiritPy.GetHeroSpiritAchievementRewards(0,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}}}]}],GUILD_BOSS:[{rankType:RankingType.RankingTypeGuildBoss,keyWord:"伤害"}],GUILD_COPY:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeGuildTranscript,keyWord:"伤害",getRankList:function(){var e=u.AppFacade.getInstance().retrieveProxy(u.GuildInstancePy.N).upGuildTranscriptBossInfo.killInfo,t=[];for(var i in e){var n=e[i];t.push({rank:Number(i)+1,playerBaseInfo:n.baseInfo,key:n.num})}return t},getRank:function(){var e,t,i=u.AppFacade.getInstance().retrieveProxy(u.GuildInstancePy.N),n=u.AppFacade.getInstance().retrieveProxy(u.PlayerPy.N),o=n.playerInfoVO.playerId,a=1,r=i.upGuildTranscriptBossInfo.killInfo;for(var s in r){var c=r[s];c.baseInfo.playerId==o?(e=c,t=Number(s)+1):a++}var l=[];return l.push({rank:t||a,playerBaseInfo:n.playerInfoVO,key:e?e.num:0}),l}},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){var e=u.AppFacade.getInstance().retrieveProxy(u.GuildInstancePy.N).upGuildTranscriptBossInfo.sectionId,t=u.Config.getGuildtranscriptRewardConfig(),i=[];for(var n in t){var o=t[n];o.sectionId==e&&i.push({rank:0<o.rankLower-o.rankUpper?9999<=o.rankLower?o.rankUpper+"-":o.rankUpper+"-"+o.rankLower:o.rankUpper,rewards:o.rewards,index:o.rankUpper,backColor:!0})}i.sort(function(e,t){return e.index-t.index});var a=u.AppFacade.getInstance().retrieveProxy(u.GuildInstancePy.N).upGuildTranscriptBossInfo.sectionId,r=u.Config.getGuildtranscriptConfig()[a];r&&(i=[{icon:"jjc_icon_pm_jisha_png",rewards:JSON.parse(r.killRewards),backColor:!0}].concat(i));return i},getTopRankInfo:function(){var e,t={topRank:void 0,desc:"描述：",targetRewards:void 0},i=u.AppFacade.getInstance().retrieveProxy(u.GuildInstancePy.N),n=u.AppFacade.getInstance().retrieveProxy(u.PlayerPy.N).playerInfoVO.playerId,o=i.upGuildTranscriptBossInfo.killInfo;for(var a in o){o[a].baseInfo.playerId==n&&(e=Number(a)+1)}t.topRank=e||1;var r=i.upGuildTranscriptBossInfo.sectionId,s=u.Config.getGuildtranscriptConfig()[r];if(s){var c=JSON.parse(s.challengeRewards);t.targetRewards=c}return t.desc="每次挑战时，可以获得以下奖励",t}}]}],GUILD_WAR:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeGuildWarScore,keyWord:"积分",isGuild:!0},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){return i(RankingType.RankingTypeGuildWarScore,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:void 0,topRank:1,desc:"每次公会战胜利，可获得以下奖励："},t=u.AppFacade.getInstance().retrieveProxy(u.GuildWarPy.N);return e.targetRewards=t.constValue.GuildWarDailyRewards[0],e}}]}],CHAMPION:{rankType:RankingType.RankingTypeChampion,keyWord:"关卡数"},DeepNest:{rankType:RankingType.RankingTypeAbyssLair,keyWord:"总星数"},FishingRank:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeActivityZoneFishing,keyWord:"总积分"},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityZoneFishing,{backColor:!0})}}]}],ZoneDevoteGoods:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeActivityZoneDevoteGoodsRank,keyWord:"祈愿积分"},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityZoneDevoteGoodsRank,{backColor:!0})}}]}],ActivityNewZoneConsumeRank:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeActivityNewZoneConsumeRank,keyWord:"祈愿积分"},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityNewZoneConsumeRank,{backColor:!0})}}]}],ActivityNewZoneConsumeRank1:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityNewZoneConsumeRank1,{backColor:!0})}}]}],NewZoneZongZiGradeRank:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeActivityNewZoneZongZiGradeRank,keyWord:"粽子积分"},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityNewZoneZongZiGradeRank,{backColor:!0})}}]}],DragonBoatGradeRank:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeActivityNewZoneDragonBoatGradeRank,keyWord:"龙舟里程"},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityNewZoneDragonBoatGradeRank,{backColor:!0})}}]}],TEAM_COPY:{rankType:RankingType.RankingTypeTeamExpedition,keyWord:"关卡数"},TEAM_ARENA_RANK:[{rankType:RankingType.RankingTypeTeamArena,keyWord:"积分",isTeam:!0}],TEAM_ARENA_REWARD:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"本服奖励",getRewardList:function(){return i(RankingType.RankingTypeTeamArenaMatch,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=u.AppFacade.getInstance().retrieveProxy(u.BattleZoneArenaPy.N).arenaInfo.teamInfo.rank;e.topRank=t;var i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeTeamArena);for(var n in i){var o=i[n];t>=o.rankUpper&&t<=o.rankLower&&(e.targetRewards=JSON.parse(o.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}},{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"晋级奖励",getRewardList:function(){var e=i(RankingType.RankingTypeTeamArenaEliminate),t=JSON.parse(u.Config.constConfig().TeamArenaVoteConfig.constValue);return t&&(e=[{icon:"zdjj_icon_toupiao_png",rewards:t[1]}].concat(e)),e},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=u.AppFacade.getInstance().retrieveProxy(u.BattleZoneArenaPy.N).arenaInfo.teamInfo.rank;e.topRank=t;var i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeTeamArena);for(var n in i){var o=i[n];t>=o.rankUpper&&t<=o.rankLower&&(e.targetRewards=JSON.parse(o.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}}]}],TEAMCOPY:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){var e=u.AppFacade.getInstance().retrieveProxy(u.TeamExpePy.N),r=e.info.sectionId,s=e.info,c=s.targeted,l=u.Config.teamRewardConfig(),h=[],t=function(e){var t=l[e],i=-1!=c.indexOf(t.id),n=!i&&s.sectionId>=t.id,o=t.id,a=void 0;a=i?REWARD_STATUS.RECEIVED:n?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,h.push({desc:"通关第"+u.Config.teamExpedition()[o].chapterId+"章"+u.Config.teamExpedition()[o].name,requestRank:o,pbMax:r,pbValue:o,status:a,rewards:t.rewards,btnFunc:function(){Utils.Socket.send("teamExpedition","GetTeamExpeditionRewards",{sectionId:o}).then(function(e){u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N).handleClientReward(e.clientReward,2),u.AppFacade.getInstance().retrieveProxy(u.TeamExpePy.N).info.update(e.info),u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD),NoticeManager.updateNotice(NT.TEAM_EXPE_REWARD)})}})};for(var i in l)t(i);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),h},bottomBtn:{label:"一键领取",callback:function(){Utils.Socket.send("teamExpedition","GetTeamExpeditionRewards",{sectionId:0}).then(function(e){u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N).handleClientReward(e.clientReward,2),u.AppFacade.getInstance().retrieveProxy(u.TeamExpePy.N).info.update(e.info),u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD),NoticeManager.updateNotice(NT.TEAM_EXPE_REWARD)})}}}]}],HERO_CHALLENGE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeHeroChallenge,keyWord:"关卡数"}],ZZQ_RANK:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,keyWord:"段位",rankType:RankingType.RankingTypeChessGrade,getExtraItem:function(e){var t=new customui.WorldKingBadge;return t.scaleX=t.scaleY=.14,t.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.ZZQ,grade:e.key,fromRank:!0}),t},updateExtraItem:function(e,t){e.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.ZZQ,grade:t.key,fromRank:!0})},blockTouch:!0},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){return i(RankingType.RankingTypeChessGrade,{backColor:!0})},getTopRankInfo:function(){var e={topRank:u.GameMVC.zzqPy.curPlayer.maxRank,desc:"描述：",targetRewards:[]},t=u.GameMVC.rankPy.getSelfRank(RankingType.RankingTypeChessGrade).rank,i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeChessGrade);for(var n in i){var o=i[n];t>=o.rankUpper&&t<=o.rankLower&&(e.targetRewards=JSON.parse(o.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}}]}],ACTIVITY_EATINGZONGZI:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,mainTitle:"成就",configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){var e=u.GameMVC.activityPy.allActivityData[EActivityType.EatingZongZi];if(!e||!e.data)return[];var n=[],o=JSON.parse(e.content)[0],a=e.data.integral||0,t=function(e){var t=o[e][0],i=o[e][1];n.push({desc:"粽子积分达到"+t+"分",pbValue:a,status:status,rewards:i,btnFunc:function(){u.GameMVC.activityPy.GetCommonReward(EActivityType.EatingZongZi,t,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD),u.GameMVC.activityMed.updateViewByCode(EActivityType.EatingZongZi)})}})};for(var i in o)t(i);return n.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.pbMax-t.pbMax}),n},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.activityPy.GetCommonReward(EActivityType.EatingZongZi,0,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}},getBottomLeftLabel:function(){return"已完成次数："+u.GameMVC.heroPy.gashaponInfo[GashaponType.High].hTimes}}]}],GACHA_HIGH_ACHIEVMENT:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,mainTitle:"成就",configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){var r=u.GameMVC.heroPy,s=r.gashaponInfo[GashaponType.High],c=s.hTimes,l=u.Config.gashaponTimes(),h=[],e=function(e){var t=l[e];if(t.type==GashaponType.High){var i=t.times,n=-1!=s.timesTargeted.indexOf(t.code),o=!n&&i<=c,a=void 0;a=n?REWARD_STATUS.RECEIVED:o?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,h.push({desc:"高级招募"+i+"次",pbMax:i,pbValue:c,status:a,rewards:t.rewards,btnFunc:function(){r.GetTimesRewards(GashaponType.High,t.code,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}})}};for(var t in l)e(t);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.pbMax-t.pbMax}),h},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.heroPy.GetTimesRewards(GashaponType.High,0,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}},getBottomLeftLabel:function(){return"已完成次数："+u.GameMVC.heroPy.gashaponInfo[GashaponType.High].hTimes}}]}],GACHA_RACE_ACHIEVMENT:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,mainTitle:"成就",configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){var r=u.GameMVC.heroPy,s=r.gashaponInfo[GashaponType.Race],c=s.hTimes,l=u.Config.gashaponTimes(),h=[],e=function(e){var t=l[e];if(t.type==GashaponType.Race){var i=t.times,n=-1!=s.timesTargeted.indexOf(t.code),o=!n&&i<=c,a=void 0;a=n?REWARD_STATUS.RECEIVED:o?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,h.push({desc:"时空召唤"+i+"次",pbMax:i,pbValue:c,status:a,rewards:t.rewards,btnFunc:function(){r.GetTimesRewards(GashaponType.Race,t.code,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}})}};for(var t in l)e(t);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.pbMax-t.pbMax}),h},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.heroPy.GetTimesRewards(GashaponType.Race,0,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}},getBottomLeftLabel:function(){return"已完成次数："+u.GameMVC.heroPy.gashaponInfo[GashaponType.Race].hTimes}}]}],STORM_WAR_RANK:{configs:[{rankType:RankingType.RankingTypeActivityStormWarPlayer,keyWord:"积分",title:"个人排行"},{rankType:RankingType.RankingTypeActivityStormWarGuild,keyWord:"积分",title:"公会排行",isGuild:!0}]},STORM_WAR_REWARD:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"个人奖励",getRewardList:function(){var e=i(RankingType.RankingTypeActivityStormWarPlayer,{backColor:!0});return e=[{icon:"_stormWar_m_json.fbzc_icon_guanjun",rewards:JSON.parse(u.Config.constConfig().StormWarChampionAccountRewards.constValue),backColor:!0}].concat(e)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeActivityStormWarPlayer,function(e){i=t.topRank=e.selfRank&&e.selfRank.rank||0});var n=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeActivityStormWarPlayer);for(var o in n){var a=n[o];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}},{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"公会奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityStormWarGuild)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeActivityStormWarGuild,function(e){i=t.topRank=e.selfRank.rank});var n=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeActivityStormWarGuild);for(var o in n){var a=n[o];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],STORM_WAR_ACHIEVE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){var o=u.GameMVC.stormWarPy,a=o.selfPlayer.targeted,r=o.selfPlayer.score,s=u.Config.stormWarRewards(),c=[],e=function(e){var t=s[e],i=t.score,n=void 0;n=a.some(function(e){return e.rewardId===t.code})?REWARD_STATUS.RECEIVED:i<=r?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,c.push({desc:"积分达到"+i,requestRank:i,status:n,rewards:t.rewards,btnFunc:function(){o.GetRewards(1,t.code,function(e){u.GameMVC.backpackPy.handleClientReward(e.clientReward),u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}})};for(var t in s)e(t);return c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),c},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.stormWarPy.GetRewards(2,0,function(e){u.GameMVC.backpackPy.handleClientReward(e.clientReward),u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}}}]}],MANOR_RANK:{configs:[{rankType:RankingType.RankingTypeManorPlayer,keyWord:"积分",title:"个人排行"},{rankType:RankingType.RankingTypeManorGuild,keyWord:"积分",title:"公会排行",isGuild:!0}]},MANOR_REWARD:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"个人奖励",getRewardList:function(){return i(RankingType.RankingTypeManorPlayer,{backColor:!0})},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeManorPlayer,function(e){i=t.topRank=e.selfRank&&e.selfRank.rank||0});var n=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeManorPlayer);for(var o in n){var a=n[o];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}},{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"公会奖励",getRewardList:function(){return i(RankingType.RankingTypeManorGuild)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeManorGuild,function(e){i=t.topRank=e.selfRank.rank});var n=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeManorGuild);for(var o in n){var a=n[o];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],TRIBE_BATTLE_RANK:{configs:[{rankType:RankingType.RankingTypeTribeBattlePlayer,keyWord:"积分",title:"个人排行"},{rankType:RankingType.RankingTypeTribeBattleGuild,keyWord:"积分",title:"公会排行",isGuild:!0}]},TRIBE_BATTLE_REWARD:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"个人奖励",getRewardList:function(){return i(RankingType.RankingTypeTribeBattlePlayer,{backColor:!0})},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeTribeBattlePlayer,function(e){i=t.topRank=e.selfRank&&e.selfRank.rank||0});var n=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeTribeBattlePlayer);for(var o in n){var a=n[o];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}},{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"公会奖励",getRewardList:function(){return i(RankingType.RankingTypeTribeBattleGuild)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeTribeBattleGuild,function(e){i=t.topRank=e.selfRank&&e.selfRank.rank||0});var n=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeTribeBattleGuild);for(var o in n){var a=n[o];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],TRIBE_BATTLE_ACHIEVE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,title:"个人奖励",getRewardList:function(){var o=u.GameMVC.tribeBattlePy,e=o.battleInfo.playerInfo,a=e.playerMaxGoods,r=e.targeted,s=u.Config.tribeBattleRewards(),c=[],t=function(e){var t=s[e];if(t.rewardsType===TribeBattleAchieveType.SelfAchieve){var i=t.goods,n=void 0;n=r.private.some(function(e){return e.rewardId===t.code})?REWARD_STATUS.RECEIVED:i<=a?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,c.push({desc:"个人物资达到"+i,backColor:!0,requestRank:i,status:n,rewards:t.rewards,btnFunc:function(){o.GetAchieveRewards({type:TribeBattleAchieveType.SelfAchieve,code:t.code,oneKey:0,cb:function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)}})}})}};for(var i in s)t(i);return c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),c},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.tribeBattlePy.GetAchieveRewards({type:TribeBattleAchieveType.SelfAchieve,code:0,oneKey:1,cb:function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)}})}}},{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,title:"公会奖励",getRewardList:function(){var o=u.GameMVC.tribeBattlePy,e=o.battleInfo.playerInfo,a=e.guildMaxGoods,r=e.targeted,s=u.Config.tribeBattleRewards(),c=[],t=function(e){var t=s[e];if(t.rewardsType===TribeBattleAchieveType.GuildAchieve){var i=t.goods,n=void 0;n=r.guild.some(function(e){return e.rewardId===t.code})?REWARD_STATUS.RECEIVED:i<=a?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,c.push({desc:"公会物资达到"+i,requestRank:i,status:n,rewards:t.rewards,btnFunc:function(){o.GetAchieveRewards({type:TribeBattleAchieveType.GuildAchieve,code:t.code,oneKey:0,cb:function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)}})}})}};for(var i in s)t(i);return c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),c},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.tribeBattlePy.GetAchieveRewards({type:TribeBattleAchieveType.GuildAchieve,code:0,oneKey:1,cb:function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)}})}}}]}],PEAK_WAR_RANK_FREE:{configs:[{rankType:RankingType.RankingTypePeakWarFreedom,keyWord:"积分",title:"个人排行"}]},PEAK_WAR_RANK_HIGH:{configs:[{rankType:RankingType.RankingTypePeakWarHighLadder,title:"个人排行"}]},PEAK_WAR_REWARD_FREE:{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){return i(RankingType.RankingTypePeakWarFreedom,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=e.topRank=u.GameMVC.peakWarPy.freeInfo.rank,i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypePeakWarFreedom);for(var n in i){var o=i[n];t>=o.rankUpper&&t<=o.rankLower&&(e.targetRewards=JSON.parse(o.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}},{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,title:"挑战奖励",notice:NT.PEAK_WAR_REWARD_FREE_TAB,getRewardList:function(){var o=u.GameMVC.peakWarPy,e=o.freeInfo,a=e.winCount,r=e.dailyTargeted,s=u.Config.peakWarFreeReward(),c=[],t=function(e){var t=s[e],i=t.target,n=void 0;n=r.some(function(e){return e===t.code})?REWARD_STATUS.RECEIVED:i<=a?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,c.push({desc:"获胜"+i+"次",requestRank:i,status:n,rewards:t.rewards,btnFunc:function(){o.FreedomGetDailyReward({code:t.code,cb:function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)}})}})};for(var i in s)t(i);return c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),c},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.peakWarPy.FreedomGetDailyReward({code:0,cb:function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)}})}}}]},PEAK_WAR_REWARD_HIGH:{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){return i(RankingType.RankingTypePeakWarHighLadder,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=e.topRank=u.GameMVC.peakWarPy.highInfo&&u.GameMVC.peakWarPy.highInfo.hRank||0,i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypePeakWarHighLadder);for(var n in i){var o=i[n];t>=o.rankUpper&&t<=o.rankLower&&(e.targetRewards=JSON.parse(o.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}}]},WORLD_KING_RANK_SINGLE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,keyWord:"段位",rankType:RankingType.RankingTypeServerWorldKing,getExtraItem:function(e){var t=new customui.WorldKingBadge;return t.scaleX=t.scaleY=.14,t.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.WORLD_KING,grade:e.key,fromRank:!0}),t},updateExtraItem:function(e,t){e.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.WORLD_KING,grade:t.key,fromRank:!0})}}],WORLD_KING_REWARD_SINGLE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){return i(RankingType.RankingTypeServerWorldKing)},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=u.GameMVC.worldKingPy.worldKingInfo.cWorldRank;e.topRank=t;var i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeServerWorldKing);for(var n in i){var o=i[n];t>=o.rankUpper&&t<=o.rankLower&&(e.targetRewards=JSON.parse(o.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}},{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,title:"成就奖励",desc:["成就","奖励"],getRewardList:function(){var s=u.GameMVC.worldKingPy.worldKingInfo.cWorldRank,c=u.GameMVC.worldKingPy.worldKingInfo,l=JSON.parse(c.gotRewards),h=u.Config.worldKingRewardConfig(WorldKingRewardType.SingleLevel),p=[],e=function(e){var t=h[e],i=u.Config.worldKingLevelConfig()[JSON.parse(t.key)[0]],n=-1!=l.indexOf(t.code),o=!n&&c.hLevel>=JSON.parse(t.key)[0],a=t.code,r=void 0;r=n?REWARD_STATUS.RECEIVED:o?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,p.push({desc:"段位达到"+i.name,backColor:!0,requestRank:a,pbMax:s,pbValue:a,status:r,rewards:t.rewards,btnFunc:function(){u.GameMVC.worldKingPy.GetReward({type:t.type,id:t.code})}})};for(var t in h)e(t);return p.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),p},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.worldKingPy.GetReward({type:WorldKingRewardType.SingleLevel,id:0})}}}]}],TEAM_ARENA_RANK_SINGLE:[{rankType:RankingType.RankingTypeTeamArena,keyWord:"积分",isTeam:!0}],TEAM_ARENA_REWARD_SINGLE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){return i(RankingType.RankingTypeTeamArenaEliminateSingle,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=u.GameMVC.battleZoneArenaPy.arenaInfo.teamInfo.rank;e.topRank=t;var i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeSingleTeamArena);for(var n in i){var o=i[n];t>=o.rankUpper&&t<=o.rankLower&&(e.targetRewards=JSON.parse(o.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}}]}],WORLD_BOSS_RANK_SINGLE:{configs:[{rankType:RankingType.RankingTypePlayerServerBossHurt,keyWord:"伤害",title:"日排行"}]},WORLD_BOSS_REWARD_SINGLE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"日奖励",getRewardList:function(){return i(RankingType.RankingTypeSinglePlayerServerBossHurt)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypePlayerServerBossHurt,function(e){i=t.topRank=e.selfRank.rank});var n=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeSinglePlayerServerBossHurt);for(var o in n){var a=n[o];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],WORLD_BOSS_ACHIEVE_SINGLE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){var r=u.AppFacade.getInstance().retrieveProxy(u.WorldBossPy.N),e=r.playerInfo||r.temInfo.playerBossInfo,s=JSON.parse(e.timesReward),c=e.challengeTimes,l=u.Config.serverBossReward(2),h=[],t=function(e){var t=l[e].id,i=void 0,n=0<=s.indexOf(t),o=l[e].rankUpper,a=o<=c;i=n?REWARD_STATUS.RECEIVED:a?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,h.push({desc:"挑战BOSS"+o+"次",requestRank:o,status:i,rewards:l[e].rewards,btnFunc:function(){r.GetPlayerTimesReward(t,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}})};for(var i in l)t(i);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),h},bottomBtn:{label:"一键领取",callback:function(){u.AppFacade.getInstance().retrieveProxy(u.WorldBossPy.N).GetPlayerTimesReward(0,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}}}]}],GUILD_WAR_SINGLE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeGuildWarScore,keyWord:"积分",isGuild:!0},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){return i(RankingType.RankingTypeSingleGuildWarScore,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:void 0,topRank:1,desc:"每次公会战胜利，可获得以下奖励："},t=u.AppFacade.getInstance().retrieveProxy(u.GuildWarPy.N);return e.targetRewards=t.constValue.GuildWarDailyRewards[0],e}}]}]},e}();function i(e,t){var i=[],n=u.Config.rankingRewardByTypeConfig(e);for(var o in n){var a=n[o],r={rankSort:a.rankUpper,rank:0<a.rankLower-a.rankUpper?9999<=a.rankLower?a.rankUpper+"-":a.rankUpper+"-"+a.rankLower:a.rankUpper,rewards:a.rewards};if(t)for(var s in t)r[s]=t[s];i.push(r)}return i.sort(function(e,t){return e.rankSort-t.rankSort}),i}u.RankConfig=e,__reflect(e.prototype,"game.RankConfig")}(game||(game={})),function(e){var t=function(t){function i(e){return void 0===e&&(e=null),t.call(this,i.N,e)||this}return __extends(i,t),i.prototype.initSubView=function(){this.addSubView(i.SV.MAIN,e.MainRankPanel),this.addSubView(i.SV.COMMON,e.CommonRankAndRewardPanel),this.addSubView(i.SV.COMMON_RANK,e.CommonRankPanel),this.addSubView(i.SV.COMMON_REWARD,e.CommonRewardPanel)},i.prototype.hideAllContentPanel=function(){this.hideSubView(i.SV.COMMON_RANK),this.hideSubView(i.SV.COMMON_REWARD)},i.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.RANK_OPEN_MAIN]},i.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.RANK_OPEN_MAIN:this.showSubView(i.SV.MAIN);break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView()}},i.N="RankMediator",i.SV={MAIN:1,COMMON:2,COMMON_RANK:3,COMMON_REWARD:4},i}(BaseMediator);e.RankMediator=t,__reflect(t.prototype,"game.RankMediator")}(game||(game={})),function(n){var e=function(){function e(){}return e.registerAll=function(){(new t).register()},e}();n.RankProcessor=e,__reflect(e.prototype,"game.RankProcessor");var t=function(e){function t(){return e.call(this,"ranking.CommonRankP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();if(this.log("CommonRankP",t),n.AppFacade.getInstance().retrieveProxy(n.RankPy.N).updateRankData(t),t.rankType==RankingType.RankingTypeNewZoneActivityQuora){var i=n.GameMVC.activityMed.getViewByCode(EActivityType.NewZoneQuora);i&&i.updateRank()}},t}(n.ProcessorBase);n.CommonRankP=t,__reflect(t.prototype,"game.CommonRankP")}(game||(game={})),function(c){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.REFRESH_INTERVAL=15,e._rankList={},e}return __extends(i,t),i.prototype.GetRankList=function(e,t){var i=this,n="object"!=typeof e&&e||e.rankType||e.rankingType,o=null!=e.refreshInterval?e.refreshInterval:this.REFRESH_INTERVAL,a=e.isTeam,r=Utils.TimerManager.getServerTime();if(this._rankList[n]&&r-this._rankList[n].dt<o)this.log("获取旧排行榜数据  ",this._rankList[n].rankList),t&&t(this._rankList[n].rankList);else{var s=a?"GetTeamCommonRank":"GetCommonRank";n&&Utils.Socket.send("ranking",s,{rankType:n}).then(function(e){i._rankList[n]||(i._rankList[n]={}),i._rankList[n].rankList=e,i._rankList[n].dt=Utils.TimerManager.getServerTime(),t&&t(i._rankList[n].rankList)})}},i.prototype.getSelfRank=function(e){var t;return this._rankList[e]&&(t=this._rankList[e].rankList.selfRank),t},i.prototype.rankIcon=function(e){var t="";return e<=3&&(t="jjc_icon_pm_"+e+"_png"),t},i.prototype.rankBg=function(e){return 0==e?"common_img_kt_5_png":e<=3?"common_img_kt_"+e:"common_img_kt_4_png"},i.prototype.keywordBg=function(e){return 0==e?"common_img_ktsz_1_png":e<=3?"common_img_ktsz_"+e:"common_img_ktsz_4_png"},i.prototype.updateRankData=function(e){var t=e.rankType,i=e.ranks;this._rankList[t]||(this._rankList[t]={});for(var n={ranks:i,selfRank:void 0},o=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N).playerInfoVO.playerId,a=0,r=i;a<r.length;a++){var s=r[a];if(s.playerId==o||s.playerBaseInfo&&s.playerBaseInfo.playerId==o){n.selfRank=s;break}}this._rankList[t].rankList=n,this._rankList[t].dt=Utils.TimerManager.getServerTime()},i.N="RankProxy",i}(BaseProxy);c.RankPy=e,__reflect(e.prototype,"game.RankPy")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.rechargeProxy=o.AppFacade.getInstance().retrieveProxy(o.RechargePy.N),t.initNotice(),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.RechargeView)},n.prototype.initNotice=function(){},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.RECHARGE_GET_DATA,CN.LOGIN_FINAL_DONE,CN.RECHARGE_OPEN]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:case CN.RECHARGE_GET_DATA:this.rechargeProxy.getGoodList();break;case CN.RECHARGE_OPEN:this.updateView(n.SV.MAIN,{viewType:o.RechargeView.VIEW_TYPE.RECHARGE})}},n.N="RechargeMediator",n.SV={MAIN:1},n}(BaseMediator);o.RechargeMediator=e,__reflect(e.prototype,"game.RechargeMediator")}(game||(game={})),function(g){var e=function(t){function r(){var e=t.call(this,r.N)||this;return e.playerProxy=g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N),e.loginProxy=g.AppFacade.getInstance().retrieveProxy(g.LoginPy.N),e.purchaseInfo=void 0,NoticeManager.setChildType(NT.VIP_MAIN,[NT.VIP_GIFT]),NoticeManager.setChildType(NT.VIP_ENTRANCE,[NT.VIP_GIFT]),NoticeManager.registerCB(NT.VIP_GIFT,e.checkVipGiftNotice,e),e}return __extends(r,t),r.prototype.getGoodList=function(){var t=this;Utils.Http.toGet({action:"pay_goods_list",os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,area:this.loginProxy.serverSelect.s_id,server_id:this.loginProxy.serverSelect.s_id,playerId:this.playerProxy.playerInfoVO.playerId,zoneid:getUrlKV().platform}).then(function(e){t.goodList=e.recharge,t.monthCard=e.vip_month,g.AppFacade.getInstance().updateView(g.RechargeMediator.N,g.RechargeMediator.SV.MAIN)}).catch(function(e){t.log("异常",e)})},r.prototype.getRechargeInfo=function(){return this.playerProxy.playerInfoVO.playerVip.rechargeInfo},r.prototype.getGoodInfo=function(e){for(var t in this.goodList){var i=this.goodList[t];if(i.id==e)return i}},r.prototype.getOrder=function(t){var i=this,e={action:"getOrder",device_id:"",flag:"custom",gold:this.purchaseInfo.gold,goldEx:this.purchaseInfo.goldEx,level:this.playerProxy.playerInfoVO.level,money:this.purchaseInfo.itemPrice,name:this.purchaseInfo.playerName,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,player_id:this.purchaseInfo.playerId,product_id:this.purchaseInfo.itemId,month_card:this.purchaseInfo.isMonthCard,purchase_type:this.purchaseInfo.type,regist_dt:this.playerProxy.playerInfoVO.createDt,server_id:this.purchaseInfo.serverId,server_name:this.purchaseInfo.serverName,sub_platform:Utils.agentConfig.channelName,udid:"",user_id:this.purchaseInfo.userID,code:this.purchaseInfo.code,itemSDKId:this.purchaseInfo.itemSDKId,itemName:this.purchaseInfo.itemName,modulePayExt:JSON.stringify(this.purchaseInfo.modulePayExt)};Utils.agentConfig.needGetOrderBySDK&&Utils.SDKMgr.cmd({type:"GetOrderBySDK",params:e}),Utils.Http.toGet(e).then(function(e){e&&"ok"==e.status?(i.purchaseInfo.orderID=e.data.order_id,i.purchaseInfo.orderDt=e.data.order_time,Utils.agentConfig.needGetOrderBySDK&&Utils.SDKMgr.cmd({type:"SetOrderBySDK",params:e.data}),t({err:0})):t({err:1})}).catch(function(e){i.log("异常",e),t({err:1})})},r.prototype.testBuy=function(){var t=this;Utils.Http.toGet({action:"test_pay",order_id:this.purchaseInfo.orderID,product_id:this.purchaseInfo.itemId,playerID:this.purchaseInfo.playerId,server_id:this.purchaseInfo.serverId,money:this.purchaseInfo.itemPrice,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,code:this.purchaseInfo.code}).then(function(e){e&&"success"==e.msg?t.buyFinish({res:0}):t.buyFinish({res:1})}).catch(function(e){t.log("异常",e),t.buyFinish({res:1})})},r.prototype.sdkPurchase=function(){this.log("sdkPurchase");var e=getUrlKV(),t=Date.now(),i=""+this.purchaseInfo.orderID+e.guopanAppId+this.purchaseInfo.itemPrice+t+this.loginProxy.userVO.uuid+Utils.agentConfig.SERVER_KEY;this.log("strMd5",i);var n={player_id:this.playerProxy.playerInfoVO.playerId,player_level:this.playerProxy.playerInfoVO.level,area:this.purchaseInfo.serverId,areaName:this.purchaseInfo.serverName,item_id:this.purchaseInfo.itemId,platform:Utils.agentConfig.AgentCode,uuid:this.loginProxy.userVO.uuid,app_store_checking:Utils.agentConfig.other&&Utils.agentConfig.other.app_store_checking&&1==Utils.agentConfig.other.app_store_checking?1:0},o=(new md5).hex_md5(i),a={guopanAppId:e.guopanAppId,serialNumber:this.purchaseInfo.orderID,itemId:this.purchaseInfo.itemId,itemSDKId:this.purchaseInfo.itemSDKId,goodsName:this.purchaseInfo.itemName,game_uin:this.loginProxy.userVO.uuid,ext:encodeURI(JSON.stringify(n)),gameUrl:e.gameUrl,time:t,money:this.purchaseInfo.itemPrice,sign:o,name:this.playerProxy.playerInfoVO.name,playerId:this.playerProxy.playerInfoVO.playerId,level:this.playerProxy.playerInfoVO.level,doneCB:function(e){e.msg&&Utils.MsgUtils.addMidMsg(e.msg)},code:this.purchaseInfo.code};Utils.SDKMgr.goPurchase(a),this.buyFinish({res:0})},r.prototype.buy=function(){0==Utils.agentConfig.thirdUserSystem?this.testBuy():this.sdkPurchase()},r.prototype.buyFinish=function(e){delete this.purchaseInfo,this.purchaseInfo=void 0,this.purchaseCB&&this.purchaseCB(),this.purchaseCB=void 0,0==e.res||Utils.MsgUtils.addMidMsg("充值失败")},r.prototype.isFirstRechargeOpen=function(){var e=g.AppFacade.getInstance().retrieveProxy(g.ActivityPy.N),t=e.allActivityData[EActivityType.SecondGiftBag];return!!t&&(!!t.data&&(t.data.targeted.length<2&&e.isOpen(EActivityType.SecondGiftBag)))},r.prototype.isFirstRechargeOpenAndFirstGift=function(){var e=g.AppFacade.getInstance().retrieveProxy(g.ActivityPy.N),t=e.allActivityData[EActivityType.SecondGiftBag];return!!t&&(!!t.data&&(t.data.targeted.length<=0&&e.isOpen(EActivityType.SecondGiftBag)))},r.prototype.isMonthCardGot=function(){var e=g.AppFacade.getInstance().retrieveProxy(g.ActivityPy.N),t=e.isOpen(EActivityType.MonthCard),i=!1,n=e.allActivityData[EActivityType.MonthCard];return t&&n&&n.data&&1===n.data.flag&&(i=!0),i},r.prototype.getMonthCardInfo=function(){return this.monthCard[0]},r.prototype.getEnjoyCardInfo=function(e){switch(e){case EActivityType.EnjoyCard:return this.monthCard[1];case EActivityType.EnjoyCard1:return this.monthCard[4];case EActivityType.EnjoyCard2:return this.monthCard[5];case EActivityType.EnjoyCard3:return this.monthCard[6];case EActivityType.EnjoyCard4:case EActivityType.EnjoyCard5:return this.monthCard[7];default:return}},r.prototype.getGrowFund=function(e){var t=0;switch(e){case EActivityType.NewGrowFund:t=401}if(t)for(var i in this.goodList){var n=this.goodList[i];if(n.id==t)return n}},r.prototype.getWholeLifeCardInfo=function(){return this.monthCard[2]},r.prototype.getNewYearCardInfo=function(){return this.monthCard[3]},r.prototype.purchase=function(t,e,i,n,o,a){var r=this;if(void 0===i&&(i=""),void 0===n&&(n=""),this.log("purchase",t.id,t.productid),Utils.SDKMgr.getPerformConfig(3)){var s=g.Config.itemConfig(),c=void 0,l=parseInt(t.id);for(var h in s){var p=s[h];if(p.type==EPropType.EPropTypeRecharge)if(0<=JSON.parse(p.effect).indexOf(l)&&(c=p.id),c)break}if(c){var d=g.AppFacade.getInstance().retrieveProxy(g.BackpackPy.N);if(d.checkEnough([[EEntityType.EEntityTypeItem,c,1]],!1))return void g.GameMgr.getInstance().showCommonTipsWin({costTips:"进行购买",cost:JSON.stringify([[EEntityType.EEntityTypeItem,c,1]]),clickCB:function(e){1==e.type&&d.UseProp(c,1,t.id,!1,n)}})}else;}if(Utils.SDKMgr.getPerformConfig(1)){var u=Utils.SDKMgr.getPerformConfig(4);Utils.SDKMgr.getPerformConfig(19)?g.GameMVC.activityMed.showViewByCode(EActivityType.ShouCangYouLi):Utils.MsgUtils.addMidMsg(u||"暂未开启")}else this.purchaseInfo?Utils.MsgUtils.addMidMsg("有未完成的支付，请等待结果"):(this.purchaseInfo=new g.PurchaseVO,this.purchaseInfo.count=1,this.purchaseInfo.itemId=t.id,this.purchaseInfo.itemSDKId=t.productid,this.purchaseInfo.itemName=t.productname,this.purchaseInfo.itemPrice=t.price,this.purchaseInfo.gold=t.diamond,this.purchaseInfo.goldEx=0,this.purchaseInfo.orderID="",this.purchaseInfo.isMonthCard=!!t.isMonthCard&&t.isMonthCard,this.purchaseInfo.playerName=this.playerProxy.playerInfoVO.name,this.purchaseInfo.playerId=this.playerProxy.playerInfoVO.playerId,this.purchaseInfo.serverId=this.loginProxy.serverSelect.s_id,this.purchaseInfo.serverName=this.loginProxy.serverSelect.s_name,this.purchaseInfo.type=null==e?0:e,this.purchaseInfo.userID=this.loginProxy.userVO.uuid,this.purchaseInfo.code=i,this.purchaseInfo.modulePayExt=o||{},this.purchaseCB=a,this.getOrder(function(e){0==e.err?r.buy():(Utils.MsgUtils.addMidMsg("获取订单失败"),delete r.purchaseInfo,r.purchaseInfo=void 0,r.purchaseCB=void 0)}))},r.prototype.GetVipLevelGift=function(e,t){var i=this,n=g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N),o=g.Config.VIPUpgradeConfig(),a=JSON.parse(o[e].costs)[0][2];n.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeDiamond]<a?g.GameMgr.getInstance().showCommonTipsWin({commonTips:"很遗憾，您的钻石不足，购买失败",cb:!1,btnLabel:{cancel:"取消",sure:"前往充值"},clickCB:function(e){if(0===e.type);else if(1===e.type){var t=g.AppFacade.getInstance().retrieveProxy(g.ActivityPy.N).allActivityData[EActivityType.FirstRecharge1],i=g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N).playerInfoVO.playerVip,n=g.AppFacade.getInstance().retrieveProxy(r.N).goodList;t&&i.rechargeInfo.count<=0&&0<n.length&&g.MainJumpConfig.jumpTo(MODULE.VIP)}}}):Utils.Socket.send("playerInfo","GetVipLevelGift",{vipLevel:e}).then(function(e){i.log("GetVipLevelGiftR",e),g.AppFacade.getInstance().retrieveProxy(g.BackpackPy.N).handleClientReward(e.clientReward),g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N).playerInfoVO.playerVip.update(e.playerVip),g.AppFacade.getInstance().updateView(g.RechargeMediator.N,g.RechargeMediator.SV.MAIN,{isJump:!0}),t&&t()}).catch(function(e){})},r.prototype.checkVipGiftNotice=function(){for(var e=g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N),t=e.playerInfoVO.playerVip.vipLevel||0,i=1;i<=t;i++)if(!e.playerInfoVO.playerVip.vipGiftGot[i])return!0;return!1},r.N="RechargeProxy",r}(BaseProxy);g.RechargePy=e,__reflect(e.prototype,"game.RechargePy")}(game||(game={})),function(p){var e=function(t){function i(){var e=t.call(this)||this;return e.index=0,e.isJump=0,e.isFirst=!0,e.rechargeProxy=p.AppFacade.getInstance().retrieveProxy(p.RechargePy.N),e.playerProxy=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N),e.pageNode={},Utils.AssetsMgr.loadGroup("group_recharge"),e.skinName="RechargeSkin",p.AppFacade.getInstance().sendNotification(CN.RECHARGE_GET_DATA),e.curPageNum=0,e}return __extends(i,t),i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_recharge")},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._activateComponent(),this.initTabbar(),this.initial(),this.addNotice(),this.checkPageBtnStatus(),this.gp_content.scaleX=this.gp_content.scaleY=1,UIActionManager.playUIAction(this.gp_content,1)},i.prototype.initial=function(){this.vType=i.VIEW_TYPE.RECHARGE,this.list_recharge.itemRenderer=n,UIActionManager.hideScrollerBar(this.scl_recharge),this.list_vip.itemRenderer=o,UIActionManager.hideScrollerBar(this.cu_pageScroller)},i.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar.dataProvider=new eui.ArrayCollection([{source:{up:"_btn_yq_m_json.common_yeqian_zuanshi_0",down:"_btn_yq_m_json.common_yeqian_zuanshi_1"},type:i.VIEW_TYPE.RECHARGE},{source:{up:"_btn_yq_m_json.common_yeqian_tequanlibao_0",down:"_btn_yq_m_json.common_yeqian_tequanlibao_1"},type:i.VIEW_TYPE.PRIVILEGE}]),this.tabbar.selectedIndex=0,this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabbarItemTap,this)},i.prototype.onTabbarItemTap=function(e){e&&null!=e.itemIndex&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex);var t=e.item.type;this.switchView(t),this.img_DownNotice.visible=this.gp_notice.parent.visible&&this.gp_notice.parent.$children[1].visible},i.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.VIP_GIFT,this.gp_notice,this,{percentX:4/12})},i.prototype.updateView=function(e){this.rechargeProxy.goodList&&(this.vipInfo=this.playerProxy.playerInfoVO.playerVip,this.updateBaseInfo(),e&&null!=e.viewType&&(this.vType=e.viewType),this.tabbar.selectedIndex=this.vType,this.onTabbarItemTap({item:{type:this.vType}}),this.updateRedPoint()),e&&e.isJump&&this.JumpIndexReward(),NoticeManager.updateNotice(NT.VIP_GIFT)},i.prototype.JumpIndexReward=function(){var e=this;this.isJump&&this.cu_pageScroller.scrollerToPage(this.cu_pageScroller.curPage+this.isJump,!0,function(){e.once(egret.Event.ENTER_FRAME,function(){e.updateRedPoint(),e.checkPageBtnStatus(),e.vipInfo.vipGiftGot[e.cu_pageScroller.curPage+1]&&0<e.cu_pageScroller.curPage&&e.JumpIndexReward()},e)})},i.prototype.switchView=function(e){switch(this.vType=e,this.gp_recharge.visible=!1,this.gp_vip.visible=!1,this.btn_oppr.visible=!0,this.vType){case i.VIEW_TYPE.RECHARGE:this.gp_recharge.visible=!0,this.cu_common_datanchu.blb_title.text="充 值",this.btn_oppr.label="vip特权",this.gp_notice.parent.visible=!0,this.updateRecharge();break;case i.VIEW_TYPE.WELFARE:this.btn_oppr.visible=!1;break;case i.VIEW_TYPE.PRIVILEGE:this.gp_vip.visible=!0,this.cu_common_datanchu.blb_title.text="VIP特权",this.btn_oppr.label="充值",this.gp_notice.parent.visible=!1,this.updateVip();break;case i.VIEW_TYPE.DAILY_SHOP:this.btn_oppr.visible=!1}},i.prototype.updateBaseInfo=function(){var e=p.Config.VIPUpgradeConfig()[this.vipInfo.vipLevel+1];if(this.vipitem_current.update(this.vipInfo.vipLevel),e){this.gp_tips.visible=!0,this.pb_vipExp.maximum=e.exp,this.pb_vipExp.value=this.vipInfo.exp;var t=Math.ceil(e.exp-this.vipInfo.exp);this.blb_num.text=(t/10).toString(),this.vipitem_toBe.update(this.vipInfo.vipLevel+1)}else e=p.Config.VIPUpgradeConfig()[this.vipInfo.vipLevel],this.gp_tips.visible=!1,this.pb_vipExp.maximum=this.vipInfo.exp,this.pb_vipExp.value=this.vipInfo.exp},i.prototype.updateRecharge=function(){var e=this.rechargeProxy.goodList,a=0,r=0,s=[];if(e.forEach(function(e){1==e.is_show&&r++}),e.forEach(function(e){1==e.is_show&&s.push({info:e,index:a++,maxLength:r})}),p.GameMVC.activityPy.isOpen(EActivityType.RechargeItem)){var t=p.GameMVC.activityPy.allActivityData[EActivityType.RechargeItem];if(t)t.content.forEach(function(e){if(p.GameMVC.playerPy.playerInfoVO.playerVip.rechargeInfo.totalMoney>=e[2]){for(var t=void 0,i=0,n=p.GameMVC.rechargePy.goodList;i<n.length;i++){var o=n[i];if(o.id==e[1]){t=o;break}}s.push({info:t,fixedConfig:{code:e[0],activityType:EActivityType.RechargeItem,rewards:e[3],icon:e[4]},index:a++,maxLength:r})}})}s.sort(function(e,t){return Number(t.index)-Number(e.index)}),this.list_recharge.dataProvider=new eui.ArrayCollection(s)},i.prototype.updateVip=function(){var e=this,t={quickBattleTimes:["矿场每日可钻石购买快速开采","次"],dailyFortressTimes:["日常副本每日可购买","次"],serverBossBuyTimes:["世界boss可购买","次挑战次数"],peakWarFreedomChalBuy:["巅峰竞技场每日可购买","次挑战次数"],vipGiftsLevel:["可购买VIP","超值礼包"],autoChallenge:"遗迹探险批量投骰",expeditionSaoDang:"英雄远征自动战斗",autoArena:"竞技场自动扫荡",touchGoldTen:"矮人宝藏批量开10次",fightSpeed:"开启战斗2倍速"},i=[],n=p.Config.VIPConfig(!0)[999999],o=1,a=p.Config.VIPConfig(!0)[o];for(this.isJump=0;a&&o<=this.playerProxy.playerInfoVO.playerVip.vipLevel+3;){var r={vipLevel:o,info:[]};for(var s in this.vipInfo.vipGiftGot[o]||(o<=this.cu_pageScroller.curPage+1?this.isJump=-1:o<=this.playerProxy.playerInfoVO.playerVip.vipLevel&&o>this.cu_pageScroller.curPage+1&&-1!=this.isJump&&(this.isJump=1)),t){var c=a[s];if(t[s]&&1==n[s])if(Array.isArray(t[s])){var l=[{text:t[s][0],style:{}},{text:c,style:{}},{text:t[s][1],style:{}}];r.info.push(l)}else if(a[s]){l=[{text:t[s],style:{}},{text:"",style:{}},{text:"",style:{}}];r.info.push(l)}}i.push(r),a=p.Config.VIPConfig(!0)[++o],++this.curPageNum}var h=this.list_vip.dataProvider;h?h.replaceAll(i):this.list_vip.dataProvider=new eui.ArrayCollection(i),this.isFirst?(this.once(egret.Event.ENTER_FRAME,function(){e.cu_pageScroller.scrollerToPage(e.vipInfo.vipLevel-1,!1,function(){e.checkPageBtnStatus(),e.updateRedPoint()})},this),this.isFirst=!1):(this.checkPageBtnStatus(),this.updateRedPoint())},i.prototype.updateRedPoint=function(){for(var e=!1,t=!1,i=1;i<this.cu_pageScroller.curPage+1&&i<=this.vipInfo.vipLevel;i++)if(null==this.vipInfo.vipGiftGot[i]||1!=this.vipInfo.vipGiftGot[i]){e=!0;break}for(i=this.cu_pageScroller.curPage+2;i<=this.vipInfo.vipLevel;i++)if(null==this.vipInfo.vipGiftGot[i]||1!=this.vipInfo.vipGiftGot[i]){t=!0;break}this.img_LeftNotice.visible=e,this.img_RightNotice.visible=t},i.prototype._activateComponent=function(){var e=this;this.cu_common_datanchu.onCloseCB=function(){e.hide()},this.btn_oppr.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){switch(this.vType){case i.VIEW_TYPE.PRIVILEGE:this.updateView({viewType:i.VIEW_TYPE.RECHARGE});break;case i.VIEW_TYPE.RECHARGE:this.updateView({viewType:i.VIEW_TYPE.PRIVILEGE})}},this),this.btn_page_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.cu_pageScroller.scrollToNext(function(){e.updateRedPoint(),e.checkPageBtnStatus()})},this),this.btn_page_last.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.cu_pageScroller.scrollToLast(function(){e.updateRedPoint(),e.checkPageBtnStatus()})},this)},i.prototype.checkPageBtnStatus=function(){this.btn_page_last.visible=0!=this.cu_pageScroller.curPage,this.btn_page_next.visible=this.cu_pageScroller.curPage!=(14<=this.playerProxy.playerInfoVO.playerVip.vipLevel?19:this.playerProxy.playerInfoVO.playerVip.vipLevel+2)},i.prototype.perClose=function(){},i.VIEW_TYPE={RECHARGE:0,WELFARE:1,PRIVILEGE:2,DAILY_SHOP:3},i}(BasePanel);p.RechargeView=e,__reflect(e.prototype,"game.RechargeView");var n=function(i){function e(){var e=i.call(this)||this;return e.skinName="RechargeView_RechargeItem",e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=p.AppFacade.getInstance().retrieveProxy(p.RechargePy.N);t.data.fixedConfig?e.purchase(t.data.info,2,t.data.fixedConfig.code,JSON.stringify({uuid:t.data.fixedConfig.code,activityType:t.data.fixedConfig.activityType}),{activityType:t.data.fixedConfig.activityType}):e.purchase(t.data.info)},this)},e.prototype.dataChanged=function(){if(this.blb_price.text=this.data.info.price+"元",getUrlKV().switchRechargeType){var e=Utils.agentConfig.other.rate||1,t=Utils.agentConfig.other.unit||"元",i=Number(this.data.info.price)*Number(e);this.blb_price.text=""+i+t}var n=this.data.maxLength-this.data.index,o={1:{icon:"chongzhi_img_zuanshi01_png",bg:"chongzhi_img_wupinkuan01_png"},2:{icon:"chongzhi_img_zuanshi02_png",bg:"chongzhi_img_wupinkuan02_png"},3:{icon:"chongzhi_img_zuanshi03_png",bg:"chongzhi_img_wupinkuan03_png"},4:{icon:"chongzhi_img_zuanshi04_png",bg:"chongzhi_img_wupinkuan03_png"}};if(this.img_bg.source=o[n]&&o[n].bg||o[4].bg,this.img_icon.source=o[n]&&o[n].icon||o[4].icon,this.data.info.give?(this.gp_extra.visible=!0,this.blb_extra.text=""+this.data.info.give):this.gp_extra.visible=!1,this.data.info.buy_num<=0?this.gp_double.visible=!0:this.gp_double.visible=!1,this.data.fixedConfig){this.gp_double.visible=!1,this.gp_extra.visible=!1,this.img_icon.source=this.data.fixedConfig.icon,this.img_bg.source=o[1].bg;var a=p.GeneralConfig.getEntityConfigByCode(this.data.fixedConfig.rewards[0][0],this.data.fixedConfig.rewards[0][1]);a&&(this.img_canGet.source=ResourceUtils.png(a.icon)),this.blb_obtain.text=this.data.fixedConfig.rewards[0][2]}else this.blb_obtain.text=(this.data.info.diamond-this.data.info.give).toString(),this.img_canGet.source="item_icon_zuanshi_png"},e}(eui.ItemRenderer);__reflect(n.prototype,"RechargeView_RechargeItem");var o=function(t){function e(){var e=t.call(this)||this;return e.rechargeProxy=p.AppFacade.getInstance().retrieveProxy(p.RechargePy.N),e.playerProxy=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N),e.skinName="RechargeView_VipPage",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initialize(),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.vipInfo.vipGiftGot[this.data.vipLevel]?Utils.MsgUtils.addMidMsg("已购买"):this.rechargeProxy.GetVipLevelGift(this.data.vipLevel)},this)},e.prototype.initialize=function(){UIActionManager.hideScrollerBar(this.scl_desc),this.scl_desc.touchEnabled=!1},e.prototype.dataChanged=function(){var r=this;this.vipInfo=this.playerProxy.playerInfoVO.playerVip,this.gp_desc.removeChildren(),this.data.info.forEach(function(e){var t=new eui.Group,i=new eui.HorizontalLayout;i.verticalAlign=egret.VerticalAlign.MIDDLE,t.layout=i,t.addChild(new eui.Image("chongzhi_img_dian_png"));var n=new eui.Label,o=new eui.Label,a=new eui.BitmapLabel;o.size=n.size=22,o.textColor=n.textColor=10050862,a.font="btn_fnt_yellow2_fnt",a.text="可购买VIP"==e[0].text?Number(e[1].text)-1:e[1].text,n.text=e[0].text,o.text=e[2].text,t.addChild(n),t.addChild(a),t.addChild(o),r.gp_desc.addChild(t)});var e=this.data.vipLevel;this.vipItem.update(e);var t=p.Config.VIPUpgradeConfig()[e],i=JSON.parse(t.wholeLifeCardEmailRewards),n=JSON.parse(t.gifts),o=JSON.parse(t.costs)[0][2];if(this.blb_price_cur.text=o.toString(),this.lb_price_origin.text=""+o/(t.discount/100),this.gp_reward.removeChildren(),this.gp_dailyreward.removeChildren(),n.forEach(function(e){var t=customui.BaseItemFactory.create();if(4<n.length?t.scaleX=t.scaleY=.6:t.scaleX=t.scaleY=.8,e[0]==EEntityType.EEntityTypeHeroEquip||e[0]==EEntityType.EEntityTypeHeroArtifact){var i={code:e[1],entityType:e[0],exp:0,fightCap:0,level:0,level2:0,filterShow:!0};t.updateData({reward:e,vo:i})}else t.updateData({reward:e});r.gp_reward.addChild(t)}),p.GameMVC.activityPy.isOpen(EActivityType.VipWelfare)){var a=p.GameMVC.activityPy.allActivityData[EActivityType.VipWelfare];if(a&&a.data){var s=JSON.parse(a.content)[0];for(var c in s){var l=s[c];if(l[1]==e){i=l[2];break}}}}i.forEach(function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,t.updateData({reward:e}),r.gp_dailyreward.addChild(t)}),e>this.vipInfo.vipLevel?(this.btn_buy.label="购买",this.btn_buy.enabled=!1,UIActionManager.setAbsGrey(this.btn_buy,!0)):this.vipInfo.vipGiftGot[e]?(this.btn_buy.label="已购买",this.btn_buy.enabled=!1,UIActionManager.setAbsGrey(this.btn_buy,!0)):(this.btn_buy.label="购买",this.btn_buy.enabled=!0,UIActionManager.setAbsGrey(this.btn_buy,!1))},e}(eui.ItemRenderer);__reflect(o.prototype,"RechargeView_VipPage")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.shopProxy=i.AppFacade.getInstance().retrieveProxy(i.ShopPy.N),e.backpackProxy=i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N),e.unlock=!0,e.skinName="ShopUIItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.baseItem=customui.BaseItemFactory.create(),this.gp_baseitem.addChild(this.baseItem),this.activateComponent()},e.prototype.activateComponent=function(){this.btn_purchase.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc()},this)},e.prototype.dataChanged=function(){var e=this.data;this.btnFunc=e.btnFunc;var t=JSON.parse(e.reward)[0];this.backpackProxy.getInfoByTypeCodeNum(t[0],t[1],t[2]);this.baseItem.updateData({type:t[0],code:t[1],num:t[2]});for(var i=this.data.buyNum,n=100,o=JSON.parse(e.discount),a=0;a<o.length;a++){if(i>=o[a][0]-1&&i<o[a][1]){n=o[a][2];break}if(i>=o[a][0]-1&&0==o[a][1]){n=o[a][2];break}}var r=this.shopProxy.getMaxNum(e.id);this.leftNum=r-i,this.leftNum<=0?UIActionManager.setGrey(this.btn_purchase):UIActionManager.setGrey(this.btn_purchase,!1),1==e.discountDisplay?100==n?this.gp_discount.visible=!1:(this.gp_discount.visible=!0,this.blb_discount.text=""+n/10):this.gp_discount.visible=!1,this.cost=JSON.parse(e.costs)[0];var s=this.cost[2];this.price=s*n/100,this.blb_price.text=""+this.price;var c=this.backpackProxy.getInfoByTypeCodeNum(this.cost[0],this.cost[1],this.cost[2]);c&&c.info&&(this.img_costIcon.source=ResourceUtils.png(c.info.icon));var l=JSON.parse(e.unlock);switch(this.unlockType=l[0],this.unlockType){case ShopItemUnlockType.None:}},e}(eui.ItemRenderer);i.ShopActiviteUI=e,__reflect(e.prototype,"game.ShopActiviteUI")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.LIMITTYPE={1:"每天",2:"每周",3:"每月",4:"每年",5:""},e.skinName="ShopBuyNumSkin",e.shopProxy=i.AppFacade.getInstance().retrieveProxy(i.ShopPy.N),e.backpackProxy=i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N),e.type=1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.item=customui.BaseItemFactory.create(10),this.item.x=2,this.item.y=2,this.Gropu_box.addChild(this.item),this.initButton()},e.prototype.initButton=function(){var e=this;this.lb_num.addEventListener(egret.Event.CHANGE,function(){Number(e.lb_num.text)>e.maxNum&&(e.lb_num.text=e.maxNum.toString()),e.curNum=Number(e.lb_num.text),e.updatePrice()},this),this.lb_num.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){""!=e.lb_num.text&&Number(e.lb_num.text)||e.setCount(1)},this),this.img_min.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum-100)},this),this.img_m10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum-10)},this),this.img_m1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum-1)},this),this.img_a1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum+1)},this),this.img_a10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum+10)},this),UIActionManager.bindClickAction(this.img_max),this.img_max.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum+100)},this),this.img_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.AppFacade.getInstance().hideSubView(i.ShopyMediator.N,i.ShopyMediator.SV.SHOP_BUY_NUM)},this),this.img_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.AppFacade.getInstance().hideSubView(i.ShopyMediator.N,i.ShopyMediator.SV.SHOP_BUY_NUM),this.doneCB?this.doneCB.call(this.context,{type:this.data.type,id:this.data.id,num:this.curNum}):this.shopProxy.Buy(this.data.type,this.data.id,this.curNum,this.grid)},this)},e.prototype.setCount=function(e){this.curNum=e,this.curNum<=0&&(this.curNum=1),this.curNum>this.maxNum&&(this.curNum=this.maxNum),this.lb_num.text=this.curNum,this.updatePrice()},e.prototype.updatePrice=function(){if(this.data.countFun){var e=this.data.countFun(this.curNum);this.lb_sum_money.text="x"+e.total,this.lb_money.text=""+e.unit}else{var t=(e=this.shopProxy.calPriceInfoById(this.data.id,this.curNum)).unitPrice*this.curNum;this.lb_sum_money.text="x"+t,this.lb_money.text=""+e.unitPrice}},e.prototype.updateView=function(e){var t=e.shopConfig;null!=e.type&&(this.type=e.type),null!=e.grid?this.grid=e.grid:this.grid=void 0,e.doneCB&&(this.doneCB=e.doneCB),this.data=t,this.log("当前数据",t),this.lb_name.text=t.name;var i=JSON.parse(t.reward||t.rewards)[0];if(i){var n=this.backpackProxy.getInfoByTypeCodeNum(i[0],i[1],i[2]);this.lb_hasNum.text="库存："+n.haveNum,this.item.updateData({type:i[0],code:i[1]})}else this.lb_hasNum.text="",this.item.visible=!1,this.lb_name.horizontalCenter=0;var o=e.buyNum?e.buyNum:this.shopProxy.getPurchasedNum(t.id,this.grid),a=JSON.parse(t.cost||t.costs)[0],r=this.backpackProxy.getInfoByTypeCodeNum(a[0],a[1],a[2]);this.img_cost_icon.source=r.info.icon+"_png",this.img_cost_icon2.source=r.info.icon+"_png";var s=JSON.parse(this.data.limit);if(s[0]){this.gp_buyInfo.y=165,this.lb_buyCountTip.visible=!0;var c=this.LIMITTYPE[s[0]],l=s[1]-o;this.lb_buyCountTip.text=""+c+(e.limitTip||"限购次数")+l+"次"}else this.gp_buyInfo.y+=20,this.lb_buyCountTip.visible=!1;1==e.leftNum&&(this.gp_info.y=this.gp_info.y+25,this.gp_buyInfo.visible=!1);var h=100;if(1==t.discountDisplay){if(t.discount)for(var p=JSON.parse(t.discount),d=0;d<p.length;d++)if(o>=p[d][0]-1&&o<p[d][1]){h=p[d][2];break}this.lb_cut.text=h/10==10?"":h/10+"折"}else this.lb_cut.text="";this.maxNum=e.maxCount?e.maxCount:this.shopProxy.calPriceInfoById(t.id).num,this.lb_costTip.text=e.costTip||"购买花费：",this.img_2.label=e.btnLabel||"购买",this.setCount(1)},e}(BasePanel);i.ShopBuyNumView=e,__reflect(e.prototype,"game.ShopBuyNumView")}(game||(game={})),function(i){var t,e=function(){function e(){}return e.ShopInfo=((t={})[ShopType.ShopTypeArena]={name:"竞技商店",title:"竞技商店",refreshShop:!1,tabbar:function(){return[{up:"common_yeqian_shangdian_2_png",down:"common_yeqian_shangdian_1_png"},{up:"common_yeqian_jiangli_2_png",down:"common_yeqian_jiangli_1_png"}]},money:[1,3,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeArena]},t[ShopType.ShopTypeGuild]={moduleId:MODULE.GuildShop,name:"公会商店",title:"公会商店",refreshShop:!0,tabbar:function(){return[]},money:[1,4,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeGuild]},t[ShopType.ShopTypeRefresh]={moduleId:MODULE.ShopMystical,name:"神秘商店",title:"神秘商店",refreshShop:!0,tabbar:function(){return[]},money:[1,1,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeRefresh]},t[ShopType.ShopTypeWorldKing]={name:"排位商店",title:"排位商店",refreshShop:!1,tabbar:function(){return[{up:"shop_btn_shangdian_02_png",down:"shop_btn_shangdian_01_png"}]},money:[1,6,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeWorldKing]},t[ShopType.ShopTypeTeamArena]={name:"组队竞技场商店",title:"组队竞技场商店",refreshShop:!1,tabbar:function(){return[{up:"shop_btn_jiangli_02_png",down:"shop_btn_jiangli_01_png"}]},money:[1,2,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"}},t[ShopType.ShopTypeExpedition]={moduleId:MODULE.ShopExpedition,name:"英雄的远征商店",title:"英雄的远征商店",refreshShop:!1,tabbar:function(){return[{up:"shop_btn_shangdian_02_png",down:"shop_btn_shangdian_01_png"},{up:"shop_btn_jiangli_02_png",down:"shop_btn_jiangli_01_png"}]},money:[1,1,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"}},t[ShopType.ShopTypeTeamExpedition]={moduleId:MODULE.ShopTeamExpedition,name:"组队副本商店",title:"组队副本商店",refreshShop:!1,tabbar:function(){return[]},money:[1,1,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"}},t[ShopType.ShopTypeDecompose]={moduleId:MODULE.ShopDecompose,name:"分解商店",title:"分解商店",refreshShop:!1,tabbar:function(){return[]},money:[1,1,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"}},t[ShopType.ShopTypeSmithy]={moduleId:MODULE.Smithy,name:"分解商店",title:"分解商店",refreshShop:!1,tabbar:function(){return[]},money:[1,1,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"}},t[ShopType.ShopTypeRaceGashapon]={moduleId:MODULE.ShopRaceGashapon,name:"时空商店",title:"时空商店",refreshShop:!1,tabbar:function(){return[]},money:[1,1,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"}},t[ShopType.ShopTypeShare]={moduleId:void 0,name:"分享商店",title:"分享商店",refreshShop:!1,tabbar:function(){return[]},money:[1,1,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},checkRed:function(){var n=this,o=i.AppFacade.getInstance().retrieveProxy(i.ShopPy.N),e=o.getShopList(ShopType.ShopTypeShare),a=new Array,t=i.AppFacade.getInstance().retrieveProxy(i.PlayerPy.N),r=i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N),s=(t.playerInfoVO.playerVip.vipLevel,!1);return e.forEach(function(e){var t={isFull:o.getPurchasedNum(e.id)<o.getMaxNum(e.id),data:e,shopType:n.curShopType,grid:e.grid,type:2};a.push(t);var i=JSON.parse(e.costs);r.checkEnough(i,!1)&&(s=!0)}),s},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeShare]},t[ShopType.ShopTypeHeroChallenge]={moduleId:MODULE.ShopHeroChallenge,name:"英雄挑战商店",title:"英雄挑战商店",refreshShop:!0,tabbar:function(){return[]},money:[1,4,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},checkRed:function(){var e=i.GameMVC.shopPy;return!(e.curShopType!=ShopType.ShopTypeHeroChallenge||!e.curShopInfo||!e.curShopInfo.buyRecords.length)},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeHeroChallenge]},t[ShopType.ShopTypeManor]={moduleId:MODULE.Manor,name:"商店",title:"商店",refreshShop:!1,tabbar:function(){return[]},money:[1,EPropertyType.EPropertyTypeManor,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},checkRed:function(){return!1},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeManor]},t[ShopType.ShopTypePeakWar]={moduleId:MODULE.PeakWar,name:"巅峰战场商店",title:"巅峰战场商店",refreshShop:!1,tabbar:function(){return[]},money:[1,EPropertyType.EPropertyTypePeakWarMoney,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},checkRed:function(){if(i.GameMVC.peakWarPy.curType===PEAK_WAR_TYPE.HIGH_END)return!1;var e=i.GameMVC.shopPy.getShopList(ShopType.ShopTypePeakWar),o=i.GameMVC.shopPy,a=i.GameMVC.backpackPy,r=!1;return e.forEach(function(e){var t=o.getPurchasedNum(e.id),i=o.getMaxNum(e.id),n=JSON.parse(e.costs);t<i&&a.checkEnough(n,!1)&&(r=!0)}),r},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypePeakWar]},t),e}();i.ShopConfig=e,__reflect(e.prototype,"game.ShopConfig")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="VipPlayerHeadSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.tapEvent&&e.tapEvent()},this)},e.prototype.updateData=function(e){var t=this,i=e&&e.vo;if(i){if(i.level?(this.blb_level.visible=!0,this.blb_level.text=""+i.level):this.blb_level.visible=!1,""!=i.avatar)RES.getResAsync(ResourceUtils.png(i.avatar),function(e){t.img_icon.visible=!0,t.img_icon.source=e},this);else{var n=JSON.parse(game.Config.constConfig().DefaultAvatar.constValue)[0];this.img_icon.visible=!0,this.img_icon.source=n+"_png"}var o=i;this.vipLevel.text=""+(o.vipLevel||0),this.vipLevel.visible=!0,this.btn_vip.visible=!0}else this.blb_level.visible=this.img_icon.visible=!1;this.img_tag.visible=e&&e.showTag,this.tapEvent=e&&e.tapEvent},e.prototype.reset=function(){this.tapEvent=void 0,this.scaleX=this.scaleY=1,this.img_tag.visible=this.blb_level.visible=this.img_icon.visible=!1,this.blb_level.text="",this.img_icon.source="",this.horizontalCenter=this.verticalCenter=void 0},e}(eui.Component);e.VipPlayerHead=t,__reflect(t.prototype,"customui.VipPlayerHead",["eui.UIComponent","egret.DisplayObject"])}(customui||(customui={})),function(n){var e=function(){function e(){}return e.registerAll=function(){(new i).register(),(new t).register()},e}();n.ShopProcessor=e,__reflect(e.prototype,"game.ShopProcessor");var t=function(e){function t(){return e.call(this,"shop.ShopRefreshP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=n.GameMVC.shopPy;switch(e.getBody().type){case ShopType.ShopTypeHeroChallenge:var i;t.curShopInfo&&t.curShopInfo.type==ShopType.ShopTypeHeroChallenge&&(i=t.curShopInfo.buyRecords.length),t.GetShopInfo(ShopType.ShopTypeHeroChallenge,function(e){var t=e&&e.shopInfo&&e.shopInfo.buyRecords.length;t&&0<t&&(null==i||i<t)&&n.GameMVC.fightPy.addDelayCBAfterFightExit(function(){DragonBoneTools.playOnce({effectName:"common_chuxian",parent:GameRootLayer.gameLayer().popMsgLayer,y:Utils.DeviceUtils.curHeight()/3,scaleX:1.5,scaleY:1.5}),n.GameMVC.fightPy.queueExceExitCB()},"HC2ShopRefresh")})}},t}(n.ProcessorBase);n.ShopRefreshP=t,__reflect(t.prototype,"game.ShopRefreshP");var i=function(e){function t(){return e.call(this,"shop.ShopRedPointP",t)||this}return __extends(t,e),t.prototype.execute=function(e){},t}(n.ProcessorBase);n.ShopRedPointP=i,__reflect(i.prototype,"game.ShopRedPointP")}(game||(game={})),function(u){var n=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.id=e.id,this.num=e.num,this.name=e.name,this.grid=e.grid},e}(u.BaseVO);__reflect(n.prototype,"SBuyRecordVO");var o=function(i){function e(e){var t=i.call(this)||this;return t.buyRecords=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){var t=this;this.count=e.count,this.buyCount=e.buyCount,this.lRCD=e.lRCD,this.buyRecords.splice(0),Array.isArray(e.buyRecords)&&e.buyRecords.forEach(function(e){t.buyRecords.push(new n(e))})},e}(u.BaseVO);__reflect(o.prototype,"SShopInfoVO");var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.noticeShowOnceDict={},e.curShopType=0,e.curShopGoodsBuyCount=[],e.addNotice(),e}return __extends(i,t),i.prototype.addNotice=function(){var e=u.ShopConfig.ShopInfo;if(e)for(var t in ShopType){var i=ShopType[t];e[i]&&e[i].checkRed&&e[i].NoticeTypes&&NoticeManager.registerCB(e[i].NoticeTypes,e[i].checkRed,this)}},i.prototype.updateShopInfo=function(e){var t=this;this.curShopGoodsBuyCount=[];var i=e.info;i.buyRecords.forEach(function(e){t.curShopGoodsBuyCount.push(e)}),this.curShopInfo||(this.curShopInfo=new o),this.curShopInfo.type=e.type,this.curShopInfo.update(i),this.sendNotification(CN.SHOP_INFO_UPDATE,{shopType:e.type}),NoticeManager.updateNotice(NT.COMMON_SHOP[e.type])},i.prototype.RefeshShop=function(t,i){var n=this;Utils.Socket.send("shop","RefreshShop",{type:t}).then(function(e){n.updateShopInfo({info:e.shopInfo,type:t}),i&&i()})},i.prototype.BuyRefreshCount=function(t,i){var n=this;Utils.Socket.send("shop","BuyRefreshCount",{type:t,num:1}).then(function(e){n.updateShopInfo({info:e.shopInfo,type:t}),i&&i()})},i.prototype.GetShopInfo=function(t,i){var n=this;Utils.Socket.send("shop","GetShopInfo",{type:t}).then(function(e){n.curShopType==t&&n.updateShopInfo({info:e.shopInfo,type:t}),i&&i(e)})},i.prototype.Buy=function(t,e,i,n){var o=this;Utils.Socket.send("shop","Buy",{type:t,id:e,num:i,grid:n}).then(function(e){o.updateShopInfo({info:e.shopInfo,type:t}),Utils.MsgUtils.addMidMsg("购买成功")})},i.prototype.getPurchasedNum=function(e,t){for(var i=0,n=0,o=this.curShopGoodsBuyCount;n<o.length;n++){if((d=o[n]).id==e&&(d.grid&&d.grid==t||!d.grid&&!t)){i=d.num;break}}for(var a=EActivityType.CommonShopSpecialItem,r=[EActivityType.CommonShopSpecialItem,EActivityType.CommonShopSpecialItem1,EActivityType.CommonShopSpecialItem2],s=u.AppFacade.getInstance().retrieveProxy(u.ActivityPy.N),c=0;c<r.length;c++)if(s.isOpen(r[c])){a=r[c];break}if(!i&&s.isOpen(a)){var l=s.allActivityData[a];if(l&&l.data){var h=JSON.parse(l.data.buyRecords);for(var p in h){var d;(d=h[p]).id==e&&(i=d.num)}}}return i},i.prototype.getMaxNum=function(e){var t=u.Config.shop()[e],i=0;if(t){var n=u.AppFacade.getInstance().retrieveProxy(u.PlayerPy.N),o=n.playerInfoVO.playerVip.vipLevel,a=n.playerInfoVO.level,r=JSON.parse(t.unlock);if(0==r[0]||1==r[0]&&a>=r[1]||2==r[0]&&o>=r[1]){var s=JSON.parse(t.limit);i=0==s[0]?99999999:s[1]}}return i},i.prototype.getShopList=function(e,t){var i=u.Config.shop(),n=new Array;for(var o in i){var a=i[o];a.type!=e||t&&a.subType!=t||n.push(a)}return n},i.prototype.calPriceInfoById=function(e,t){var i=this.getPurchasedNum(e),n=u.Config.shop()[e],o=this.getMaxNum(e),a={unitPrice:0,totalPrice:0,num:0};if(n){var r=void 0;r=u.GameMVC.activityPy.hasWholeLifeCard()?JSON.parse(n.wholeLifeCosts)[0]:JSON.parse(n.costs)[0],a.unitPrice=r[2];var s=u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N).getInfoByTypeCodeNum(r[0],r[1],r[2]).haveNum;o=Math.min(o-i,Math.floor(s/a.unitPrice)),a.num=null==t?o:Math.min(t,o),a.totalPrice=a.num*a.unitPrice}return a},i.prototype.showRefreshShopNotice=function(e){},i.N="ShopProxy",i}(BaseProxy);u.ShopPy=e,__reflect(e.prototype,"game.ShopPy")}(game||(game={})),function(c){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShopRefreshViewSkin",e.shopProxy=c.AppFacade.getInstance().retrieveProxy(c.ShopPy.N),e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.scheCountLeft&&(egret.clearInterval(this.scheCountLeft),this.scheCountLeft=void 0)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.resource_bar),this.curShopType=this.shopProxy.curShopType;var e=c.Config.shopWork(this.curShopType);this.refreshShopRefreshDt=Number(e.reFreeRefreshTimesCD),this.refreshLimit=Number(e.maxFreeRefreshTimes),this.heroModel.update(c.ShopUI.HERODATA),this.initButton(),this.initUI()},e.prototype.initButton=function(){var s=this;this.img_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().hideSubView(c.ShopyMediator.N,c.ShopyMediator.SV.REFRESH_SHOP)},this),this.btn_refresh.btn_oppr.skinName="skins.ButtonSkinBlue",this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<this.shopProxy.curShopInfo.count?this.shopProxy.RefeshShop(this.curShopType,function(){Utils.MsgUtils.addMidMsg("刷新成功")}):this.buyCount()},this),Utils.ComponentUtils.registerListener(this.btn_discount,egret.TouchEvent.TOUCH_TAP,function(){c.GameMgr.getInstance().showCommonTipsWin({commonTips:"购买终生卡可享受黑市商人额外8折优惠",btnStyle:{cancel:c.CommonTipsDialog.BTN_STYLE.CANCEL,confirm:c.CommonTipsDialog.BTN_STYLE.GOTO},clickCB:function(e){1==e.type&&(s.hide(),c.GameMVC.activityMed.showViewByCode(EActivityType.MonthCard))}})},this),this.curShopType==ShopType.ShopTypeRefresh&&(this.btn_help.visible=!0,Utils.ComponentUtils.registerListener(this.btn_help,egret.TouchEvent.TOUCH_TAP,function(){var e=[];e.push({text:"1、黑市商人可以购买到多种优惠道具，并且每天第一次可以免费刷新商店道具。\n2、每次自动刷新间隔时间为"}),e.push({text:s.refreshShopRefreshDt/60+"分钟",style:{textColor:36807}}),e.push({text:"，同时也可以手动使用钻石刷新。\n3、某些道具拥有每日购买上限数量和等级限制，当日达到购买上限数量"}),e.push({text:"（每日重置）",style:{textColor:36807}}),e.push({text:"或未达到该等级条件，将不会刷新获得："});for(var t={},i=0,n=c.Config.refreshShop();i<n.length;i++){if((r=n[i]).shopType==ShopType.ShopTypeRefresh){var o=c.Config.shop()[r.id];"时空契约"!=o.name&&"觉醒石"!=o.name||(t[o.name]?t[o.name].num+=JSON.parse(o.reward)[0][2]*r.timesLimit:t[o.name]={num:JSON.parse(o.reward)[0][2]*r.timesLimit,level:r.level})}}for(var a in t){var r;(r=t[a]).level&&r.num?(e.push({text:"\n"+a+"("+r.level+"级解锁)：每日可购买"}),e.push({text:""+(r.num?r.num:"无限制"),style:{textColor:36807}}),e.push({text:"个"})):r.level?e.push({text:"\n"+a+"("+r.level+"级解锁)"}):r.num&&(e.push({text:"\n"+a+"：每日可购买"}),e.push({text:""+(r.num?r.num:"无限制"),style:{textColor:36807}}),e.push({text:"个"}))}PopUpManager.addPopUp({obj:new c.HelpDialog({text:e})})},this))},e.prototype.initUI=function(){var e=new eui.TileLayout;e.horizontalGap=95,e.verticalGap=25,e.requestedRowCount=0,e.paddingLeft=25,e.paddingTop=5,e.requestedColumnCount=3,e.columnAlign=eui.ColumnAlign.LEFT,this.list_items.layout=e,this.list_items.itemRenderer=c.ShopUIItem,this.collect=new eui.ArrayCollection,this.list_items.dataProvider=this.collect},e.prototype.updateSche=function(){var t=this,e=!1;this.shopProxy.curShopInfo.count<=0?0<this.refreshShopRefreshDt-(Utils.TimerManager.getServerTime()-this.shopProxy.curShopInfo.lRCD)?this.scheCountLeft||(this.lb_time.visible=!0,this.scheCountLeft=egret.setInterval(function(){var e=t.refreshShopRefreshDt-(Utils.TimerManager.getServerTime()-t.shopProxy.curShopInfo.lRCD);0<e?t.lb_time.text=Utils.TimerManager.getFormatBySecond1(e):(t.lb_time.visible=!1,egret.clearInterval(t.scheCountLeft),t.scheCountLeft=void 0)},this,1e3)):e=!0:e=!0;e&&this.scheCountLeft&&(this.lb_time.visible=!1,egret.clearInterval(this.scheCountLeft),this.scheCountLeft=void 0)},e.prototype.buyCount=function(){var t=this,e=this.shopProxy.curShopInfo.buyCount,i=c.ShopConfig.ShopInfo[this.shopProxy.curShopType].moduleId,n=c.Config.publicBuyCostConfig(i,e);if(!n)return egret.warn("t_public_buy_cost里当前购买次数"+e+"的"+i+"找不到配置"),void Utils.MsgUtils.addMidMsg("暂时无法购买");var o=JSON.parse(n.costs);c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).checkEnough(o)?c.GameMgr.getInstance().showCommonTipsWin({costTips:"钻石，刷新一次商店吗",source:"heishishop",cost:n.costs,cb:!0,clickCB:function(e){1===e.type&&t.shopProxy.BuyRefreshCount(t.curShopType,function(){Utils.MsgUtils.addMidMsg("刷新成功")})}}):Utils.MsgUtils.addMidMsg("刷新所需钻石不足")},e.prototype.updateList=function(){var e=c.Config.shop(),t=this.shopProxy.curShopInfo.buyRecords;this.collect.removeAll();for(var i=c.GameMVC.activityPy.hasWholeLifeCard(),n=0,o=t;n<o.length;n++){var a=o[n],r=e[a.id];this.collect.addItem({data:r,shopType:this.curShopType,vo:a,grid:a.grid,isPopup:r.isPopup,buyNum:a.num,hasWholeLifeCard:i,effect:r.isSpecial})}},e.prototype.updateView=function(e){var t=this,i=c.GameMVC.activityPy.hasWholeLifeCard();UIActionManager.setAbsGrey(this.btn_discount,!i),this.btn_discount.enabled=!i;var n=Utils.SDKMgr.getPerformConfig(1)&&Utils.SDKMgr.getPerformConfig(21);if(this.btn_discount.visible=!n,this.lb_discount.visible=!n&&!i,this.shopProxy.curShopInfo){this.workType=e&&e.workType||this.workType,this.onCloseCB=e&&e.onCloseCB||this.onCloseCB;var o=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N),a=c.ShopConfig.ShopInfo[this.curShopType].money,r=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).getInfoByTypeCodeNum(a[0],a[1],a[2]),s=[[o.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeGold],2],[r.haveNum,r.info.code]];this.resource_bar.updateBar({costs:s,width:190,needAdd:!0}),this.refreshBtnUpdate(),this.updateSche(),this.once(egret.Event.ENTER_FRAME,function(){t.updateList()},this)}},e.prototype.refreshBtnUpdate=function(){var e=this.shopProxy.curShopInfo;if(e.count<=0){var t=e.buyCount,i=c.Config.publicBuyCostConfig(MODULE.ShopMystical,t),n=JSON.parse(i.costs);this.btn_refresh.updateData({cost:n[0],text:"刷新"})}else this.btn_refresh.updateData({text:"刷新"});this.lb_refresh_left.text="今日剩余刷新次数:"+(this.refreshLimit-e.buyCount)+"次"},e.prototype.perClose=function(){this.onCloseCB&&this.onCloseCB()},e}(BaseFull);c.ShopRefreshView=e,__reflect(e.prototype,"game.ShopRefreshView")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ShopSellNumSkin",e.shopProxy=i.AppFacade.getInstance().retrieveProxy(i.ShopPy.N),e.backpackProxy=i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N),e.type=1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.item=customui.BaseItemFactory.create(10),this.item.x=2,this.item.y=2,this.Gropu_box.addChild(this.item),this.initButton()},e.prototype.initButton=function(){var e=this;this.lb_num.addEventListener(egret.Event.CHANGE,function(){Number(e.lb_num.text)>e.maxNum&&(e.lb_num.text=e.maxNum.toString()),e.curNum=Number(e.lb_num.text),e.updatePrice()},this),this.lb_num.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){""!=e.lb_num.text&&Number(e.lb_num.text)||e.setCount(1)},this),this.img_min.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum-100)},this),this.img_m10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum-10)},this),this.img_m1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum-1)},this),this.img_a1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum+1)},this),this.img_a10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum+10)},this),UIActionManager.bindClickAction(this.img_max),this.img_max.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum+100)},this),this.img_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.img_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.backpackProxy.SellProp({code:this.data.info.id,num:this.curNum},this.hide.bind(this))},this)},e.prototype.setCount=function(e){this.curNum=e,this.curNum<=0&&(this.curNum=1),this.curNum>this.maxNum&&(this.curNum=this.maxNum),this.lb_num.text=this.curNum,this.updatePrice()},e.prototype.updatePrice=function(){if(this.data.countFun){var e=this.data.countFun(this.curNum);this.lb_sum_money.text="x"+e.total,this.lb_money.text=""+e.unit}else{e=this.shopProxy.calPriceInfoById(this.data.id,this.curNum);var t=this.nowOne*this.curNum;this.lb_sum_money.text="x"+t,this.lb_money.text=""+e.unitPrice}},e.prototype.updateView=function(e){var t=e.shopConfig;null!=e.type&&(this.type=e.type),null!=e.grid?this.grid=e.grid:this.grid=void 0,e.doneCB&&(this.doneCB=e.doneCB),this.data=t,this.log("当前数据",t),this.lb_name.text=t.name,this.data.info&&this.data.info.uuid?this.item.updateData({uuid:this.data.info.uuid,type:this.data.type}):this.item.updateData(this.data.info),this.lb_hasNum.text="拥有："+e.maxCount;var i=JSON.parse(this.data.info.sellRewards)[0],n=this.backpackProxy.getInfoByTypeCodeNum(i[0],i[1],i[2]);this.img_cost_icon2.source=n.info.icon+"_png",this.nowOne=i[2],this.maxNum=e.maxCount?e.maxCount:this.shopProxy.calPriceInfoById(t.id).num,this.lb_costTip.text=e.costTip||"出售获得：",this.img_2.label=e.btnLabel||"出售",this.setCount(1)},e}(BasePanel);i.ShopSellNumView=e,__reflect(e.prototype,"game.ShopSellNumView")}(game||(game={})),function(e){var t=function(){function e(){this._fontSize=18;var e=document.getElementById("gameDiv");this.p=document.createElement("p"),e.appendChild(this.p),this.p.style.border="0px",this.p.style.backgroundColor="transparent",this.p.style.position="absolute",this.p.style.fontSize=this.fontSize+"px",this.p.style.display="none",this.p.style.color="#000000",this.p.style.textAlign="center"}return Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){this._fontSize=e,this.p.style.fontSize=this._fontSize+"px"},enumerable:!0,configurable:!0}),e.prototype.setValue=function(e){this.p.style.display="inline",this.p.innerHTML=e},e.prototype.setPosition=function(e,t,i,n){var o=document.body.clientWidth/Utils.DeviceUtils.curWidth(),a=document.body.clientHeight/Utils.DeviceUtils.curHeight();this.p.style.left=e*o+"px",this.p.style.top=t*a-this.fontSize+"px",this.p.style.width=i*o+"px",this.p.style.height=n*a+"px",this.p.style.display="inline"},e.prototype.show=function(){this.p&&(this.p.style.display="inline")},e.prototype.hide=function(){this.p&&(this.p.style.display="none")},e.prototype.remove=function(){var e=document.getElementById("gameDiv");this.p.parentNode==e&&e.removeChild(this.p)},e}();e.HTMLText=t,__reflect(t.prototype,"customui.HTMLText")}(customui||(customui={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="TaskItemOnMainSkin",e}return __extends(e,t),e}(eui.Component);e.TaskItemOnMain=t,__reflect(t.prototype,"customui.TaskItemOnMain",["eui.UIComponent","egret.DisplayObject"])}(customui||(customui={})),function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.removeChild(this.verticalScrollBar),this.removeChild(this.horizontalScrollBar),this.winWidth=Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),this.winHeight=Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale(),this.img_bg=new eui.Image,this.addChildAt(this.img_bg,0)},t.prototype.updateBg=function(e){var i=this;RES.getResAsync(ResourceUtils.png(e),function(e){if(i.img_bg.source=e,i.viewport.contentWidth<=i.winWidth){var t=i.winWidth/i.img_bg.width;i.img_bg.width=i.winWidth,i.img_bg.height*=t}else{t=i.winHeight/i.img_bg.height;i.img_bg.height=i.winHeight,i.img_bg.width*=t}i.img_bg.anchorOffsetX=i.img_bg.width/2,i.img_bg.anchorOffsetY=i.img_bg.height/2,i.img_bg.y=i.winHeight/2},this)},t}(eui.Scroller);e.MultiLayerScroller=t,__reflect(t.prototype,"customui.MultiLayerScroller")}(customui||(customui={})),function(a){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new n).register(),(new o).register(),(new i).register()},e}();a.TaskAllProcessor=e,__reflect(e.prototype,"game.TaskAllProcessor");var t=function(e){function t(){return e.call(this,"task.TaskP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();a.AppFacade.getInstance().retrieveProxy(a.TaskPy.N).update(t.tasks)},t}(a.ProcessorBase);a.TaskP=t,__reflect(t.prototype,"game.TaskP");var i=function(e){function t(){return e.call(this,"task.DoneTaskP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody(),i=a.AppFacade.getInstance().retrieveProxy(a.TaskPy.N);if(t.tasks&&t.tasks[0]){var n=t.tasks[0].code,o=a.Config.taskConfig()[n];i.updateTaskDone(o.type,t.tasks)}},t}(a.ProcessorBase);a.DoneTaskP=i,__reflect(i.prototype,"game.DoneTaskP");var n=function(e){function t(){return e.call(this,"task.BraveBookTaskP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody(),i=a.AppFacade.getInstance().retrieveProxy(a.TaskPy.N);a.AppFacade.getInstance().sendNotification(CN.BRAVEBOOK_LEVEL_UPDATE,{data:t.braveBookTask,preLevel:i.braveBookTask.level}),i.braveBookTask=t.braveBookTask,a.AppFacade.getInstance().retrieveMediator(a.BraveBookMediator.N).updateView(a.BraveBookMediator.SV.MAIN)},t}(a.ProcessorBase);__reflect(n.prototype,"BraveBookTaskP");var o=function(e){function t(){return e.call(this,"task.NewBraveBookTaskP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody(),i=a.AppFacade.getInstance().retrieveProxy(a.TaskPy.N);i.NewBraveBooklevelParams={level:t.braveBookTask.level,preLevel:i.newBraveBookTask.level},i.newBraveBookTask=t.braveBookTask,a.AppFacade.getInstance().retrieveMediator(a.ActivityMediator.N).updateViewByCode(EActivityType.NewBraveBook)},t}(a.ProcessorBase);__reflect(o.prototype,"NewBraveBookTaskP")}(game||(game={})),function(j){var e=function(t){function W(){var e=t.call(this,W.N)||this;return e.newBraveBookTaskHistory={},e.lastUnlockTaskStatus=!1,e.TaskDone={},e.proInterval=0,e.proMax=0,e.guildProInterval=0,e.guildProMax=0,e.allTasks=new Array,e.allProgresss=new Array,e.secAchInfo=new j.SecondAchievementInfoVO,e.initNotice(),e}return __extends(W,t),W.prototype.initNotice=function(){var e=this;NoticeManager.setChildType(NT.TASK_ENTRANCE,[NT.DAILY_TASK]),NoticeManager.registerCB(NT.DAILY_TASK,function(){return e.checkTaskNotice(TaskType.Daily)},this),NoticeManager.registerCB(NT.BRAVABOOK,function(){return e.checkTaskNotice(TaskType.BraveBook)},this),NoticeManager.registerCB(NT.NEWBRAVABOOK,function(){return e.checkTaskNotice(TaskType.NewBraveBook)},this),NoticeManager.registerCB(NT.NEWBRAVABOOK,function(){return e.checkTaskNotice(TaskType.NewNewBraveBook)},this),NoticeManager.registerCB(NT.SECOND_ACHIEVEMENT,this.checkSecondAchievementNotice,this)},W.prototype.checkTaskNotice=function(e){var t,i,n,o,a,r=j.Config.taskConfigByTypeSperBySubtype(e),s=j.AppFacade.getInstance().retrieveProxy(j.ActivityPy.N),c=j.AppFacade.getInstance().retrieveProxy(j.BackpackPy.N),l=[];if(e==TaskType.BraveBook)t=s.allActivityData[EActivityType.BraveBook],i=j.Config.braveBook(),n=j.Config.braveBookLevelConfigs(),a=j.Config.braveBookstarRewardConfigs(),o=this.braveBookTask;else if(e==TaskType.NewBraveBook||e==TaskType.NewNewBraveBook){t=s.allActivityData[EActivityType.NewBraveBook];var h=j.Config.newBraveBookTasksConfig();i=[];var p=this.allTasks&&this.allTasks[e].length;if(0<p){l=[];for(var d=p-1;p-21<d;--d){var u=this.allTasks[e][d];for(var g in h){var f=h[g];if(u.code==f.code){i.push(f),l.push(u);break}}}}a=j.Config.newBraveBookRewardConfig(),n=j.Config.newBraveBookLevelConfig(),o=this.newBraveBookTask}var _={},m=[];for(var y in this.allTasks[e]){(k=this.allTasks[e][y])&&(_[k.code]=k)}for(var v in r){var T=r[v],C=parseInt(v);for(var y in T){var E=T[y],b=JSON.parse(E.target)[0],I=this.getTaskKey(e,E.code);if(C==TaskSubType.ArenaChallengeRank||C==TaskSubType.TeamArenaChallengeRank){if(I&&I<=b&&(!_[E.code]||!_[E.code].isTarget))return!0}else if(b<=I&&(!_[E.code]||!_[E.code].isTarget))return!0}}if((e==TaskType.BraveBook||e==TaskType.NewBraveBook||e==TaskType.NewNewBraveBook)&&t&&t.data){var A=!0;if(e==TaskType.BraveBook&&(A=t.data.isBuy),A){var P=j.AppFacade.getInstance().retrieveProxy(W.N),S=t.content[1],N=e==TaskType.BraveBook?P.braveBookTask.starTargeted:P.newBraveBookTask.starTargeted,M=[];if(c.checkEnough([S[0][1][0]],!1))return!0;for(var w in n){var k;if(""!=(k=n[w]).rewards&&o&&o.level>=Number(w)&&-1==o.levelTargeted.indexOf(Number(w)))return!0}for(var v in i){C=(T=i[v]).subType;var R=(I=P.getBraveTask(e,T.code))&&I.isTarget||!1;b=JSON.parse(T.target)[0];if(0<N.length)for(var U=0,x=N;U<x.length;U++){(D=x[U])==T.chapterCode&&(M[T.chapterCode]=!0)}if((C==TaskSubType.ArenaChallengeRank?I&&0<I.key&&I.key<=b||!1:I&&I.key>=b||!1)&&1==R&&(null==m[T.chapterCode]?m[T.chapterCode]=1:m[T.chapterCode]++),27<=m[T.chapterCode]&&!M[T.chapterCode])return!0;for(var y in T){E=T;var O=this.getTaskKey(e,E.code);if(C==TaskSubType.ArenaChallengeRank||C==TaskSubType.TeamArenaChallengeRank){if(O&&O<=b&&(!_[E.code]||!_[E.code].isTarget))return!0}else if(b<=O&&(!_[E.code]||!_[E.code].isTarget))return!0}}for(var L in a){var D,B=1;for(var g in i){B=i[g].chapterCode;break}if((D=a[L]).chapterCode==B&&D.type==e){var V=this.newBraveBookTask&&this.newBraveBookTask.starTargeted;if(0<V.length&&-1==V.indexOf(D.code)){for(var G=0,F=0,H=l;F<H.length;F++){if(0==H[F].isTarget)break;++G}if(G>=j.ActivityBraveBookViewNew.MAXTASKNUM)return!0}}}}}return!1},W.prototype.update=function(e,t,i){var n=!1;if(!t){var o=e[0].code;t=(j.Config.taskConfig()[o]||j.Config.braveBook()[o]||j.Config.newBraveBookTasksConfig()[o]||j.Config.getSecAchievementConfig()[o]).type}var a=this.allTasks[t];for(var r in e){for(var s=e[r],c=!1,l=0,h=a;l<h.length;l++){var p=h[l];p.code===s.code&&(p.update(s),c=!0)}if(!c){var d=new j.TaskVO(s);d.type=t,a.push(d),n=!0}}var u={type:t};switch(t){case TaskType.Daily:j.AppFacade.getInstance().updateView(j.TaskMediator.N,j.TaskMediator.SV.MAIN),NoticeManager.updateNotice(NT.DAILY_TASK);break;case TaskType.Achievement:break;case TaskType.Guide:case TaskType.DifficultyGuide:j.AppFacade.getInstance().updateView(j.GuajiMediator.N,j.GuajiMediator.SV.MAIN,{fromGuide:!0}),u.newTask=n;break;case TaskType.HideAchievement:break;case TaskType.BraveBook:var g=j.AppFacade.getInstance().retrieveMediator(j.BraveBookMediator.N);this.braveBookTask||this.getBraveBookTask(),g.updateView(j.BraveBookMediator.SV.MAIN,i),NoticeManager.updateNotice(NT.BRAVABOOK,void 0,!0);break;case TaskType.NewNewBraveBook:case TaskType.NewBraveBook:this.braveBookTask||this.getNewBraveBookTask(),(g=j.AppFacade.getInstance().retrieveMediator(j.ActivityMediator.N)).updateViewByCode(EActivityType.NewBraveBook,i),NoticeManager.updateNotice(NT.NEWBRAVABOOK,void 0,!0);break;case TaskType.SecondAchievement:NoticeManager.updateNotice(NT.SECOND_ACHIEVEMENT),j.AppFacade.getInstance().updateView(j.TaskMediator.N,j.TaskMediator.SV.SECOND_ACHIEVEMENT)}j.AppFacade.getInstance().sendNotification(CN.TASK_UPDATE,u)},W.prototype.fetch=function(t,i){var n=this;this.allTasks[t]||(this.allTasks[t]=new Array),Utils.Socket.send("task","GetTaskInfo",{type:t}).then(function(e){e&&(n.update(e.tasks,t),i&&i(),t==TaskType.HideAchievement&&j.AppFacade.getInstance().sendNotification(CN.EGGS_UPDATE))})},W.prototype.getTaskInfo=function(i,n){var o=this;Utils.Socket.send("task","GetTaskInfo",{type:i.type,condKey:i.condKey}).then(function(e){if(e&&(i.type==TaskType.NewBraveBook||i.type==TaskType.NewNewBraveBook)){var t=e.tasks;i.condKey;o.newBraveBookTaskHistory[i.condKey]=t,n&&n()}})},W.prototype.getTaskKey=function(e,t){j.Config.taskConfig();for(var i in this.allTasks[e]){var n=this.allTasks[e][i];if(n.code==t)return n.key}return 0},W.prototype.getCurGuideTask=function(e){null==e&&(e=TaskType.Guide);var t=this.allTasks[e];for(var i in t){var n=t[i];if(!n.isTarget)return n}},W.prototype.getTaskStatus=function(e){var t;if(e.isTarget)t=TaskStatus.RECEIVE;else{var i=JSON.parse(e.config.target);t=e.config.subType==TaskSubType.ArenaChallengeRank||e.config.subType==TaskSubType.TeamArenaChallengeRank?e.key<=i[0]?TaskStatus.DONE:TaskStatus.UNDONE:e.key>=i[0]?TaskStatus.DONE:TaskStatus.UNDONE}return t},W.prototype.GetTaskAllReward=function(i,n,o){var a=this;Utils.Socket.send("task","GetTaskAllReward",{type:i,id:o&&o.id}).then(function(e){if(j.AppFacade.getInstance().retrieveProxy(j.BackpackPy.N).handleClientReward(e.clientReward,{closeCB:function(){a.sendNotification(CN.TASK_GET_REWARDS_POP_CLOSE),n&&n()}}),a.update(e.tasks,i,o),i==TaskType.NewBraveBook||i==TaskType.NewNewBraveBook){var t=e.tasks[0].chapterCode;a.newBraveBookTaskHistory[t]=e.tasks}})},W.prototype.GetTaskReward=function(o,a,r,s){var c=this;Utils.Socket.send("task","GetTaskReward",{code:a,type:o}).then(function(e){var t=j.AppFacade.getInstance().retrieveProxy(j.BackpackPy.N);for(var i in t.handleClientReward(e.clientReward,{closeCB:function(){c.sendNotification(CN.TASK_GET_REWARDS_POP_CLOSE),r&&r()}}),e.secondAchievementTask&&c.secAchInfo.update(e.secondAchievementTask),c.allTasks[o]){var n=c.allTasks[o][i];n.code==a&&(n.isTarget=!0)}c.update(e.tasks,o,s),500008!=a&&500010!=a||j.AppFacade.getInstance().sendNotification(CN.EGGS_UPDATE)})},W.prototype.getBraveBookTask=function(t){var i=this;Utils.Socket.send("task","GetBraveBookTask",{}).then(function(e){i.braveBookTask=e.braveBookTask,NoticeManager.updateNotice(NT.BRAVABOOK,void 0,!0),t&&t.cb&&t.cb()}).catch(function(e){})},W.prototype.getBraveLevelReward=function(t){var i=this;Utils.Socket.send("task","GetBraveBookLevelReward",{levels:t.levels}).then(function(e){i.braveBookTask=e.braveBookTask,j.AppFacade.getInstance().retrieveProxy(j.BackpackPy.N).handleClientReward(e.clientReward,2),t&&t.cb&&t.cb()}).catch(function(e){})},W.prototype.getBraveBookStarReward=function(t){var i=this;Utils.Socket.send("task","GetBraveBookStarReward",{code:t.code}).then(function(e){i.braveBookTask=e.braveBookTask,j.AppFacade.getInstance().retrieveProxy(j.BackpackPy.N).handleClientReward(e.clientReward),t&&t.cb&&t.cb()}).catch(function(e){})},W.prototype.getNewBraveBookTask=function(t){var i=this;Utils.Socket.send("task","GetNewBraveBookTask",{}).then(function(e){i.newBraveBookTask=e.braveBookTask,NoticeManager.updateNotice(NT.NEWBRAVABOOK,void 0,!0),t&&t.cb&&t.cb()}).catch(function(e){})},W.prototype.getNewBraveLevelReward=function(t){var i=this;Utils.Socket.send("task","GetNewBraveBookLevelReward",{levels:t.levels}).then(function(e){i.newBraveBookTask=e.braveBookTask,j.AppFacade.getInstance().retrieveProxy(j.BackpackPy.N).handleClientReward(e.clientReward,2),t&&t.cb&&t.cb()}).catch(function(e){})},W.prototype.getNewBraveBookStarReward=function(t){var i=this;Utils.Socket.send("task","GetNewBraveBookStarReward",{code:t.code}).then(function(e){i.newBraveBookTask=e.braveBookTask,i.update(e.tasks,t.type),j.AppFacade.getInstance().retrieveProxy(j.BackpackPy.N).handleClientReward(e.clientReward),t&&t.cb&&t.cb()}).catch(function(e){})},W.prototype.getBraveTask=function(e,t){for(var i in this.allTasks[e]){var n=this.allTasks[e][i];if(n.code==t)return n}},W.prototype.GetTaskDone=function(t){var i=this;void 0===t&&(t=TaskType.Guide),Utils.Socket.send("task","GetTaskDone",{type:t}).then(function(e){i.TaskDone[t]=e.tasks})},W.prototype.updateTaskDone=function(e,t){this.TaskDone[e]||(this.TaskDone[e]=[]),this.TaskDone[e]=this.TaskDone[e].concat(t)},W.prototype.GetSecondAchievementTask=function(){var t=this;Utils.Socket.send("task","GetSecondAchievementTask",{}).then(function(e){t.secAchInfo.update(e.secondAchievementTask)})},W.prototype.GetSecondAchievementLevelReward=function(e,t){var i=this;Utils.Socket.send("task","GetSecondAchievementLevelReward",{level:e}).then(function(e){j.GameMVC.backpackPy.handleClientReward(e.clientReward),i.secAchInfo.update(e.secondAchievementTask),NoticeManager.updateNotice(NT.SECOND_ACHIEVEMENT),t&&t()})},W.prototype.GetSecondAchievementReward=function(e,t){var i=this;Utils.Socket.send("task","GetTaskReward",{code:e,type:TaskType.SecondAchievement}).then(function(e){j.GameMVC.backpackPy.handleClientReward(e.clientReward,{closeCB:function(){i.sendNotification(CN.TASK_GET_REWARDS_POP_CLOSE),t&&t()}}),i.secAchInfo.update(e.secondAchievementTask),i.allTasks[TaskType.SecondAchievement].splice(0),i.update(e.tasks,TaskType.SecondAchievement)})},W.prototype.checkSecondAchievementNotice=function(){var e=this.allTasks[TaskType.SecondAchievement];for(var t in e){var i=e[t];if(!i.isTarget){var n=JSON.parse(i.config.target)[0];if(i.key>=n)return!0}}var o=this.secAchInfo.level,a=j.Config.getSecAchievementLevelConfig();for(var r in a){var s=a[r];if(s.isShow&&o>=s.level&&this.secAchInfo.levelTargeted.indexOf(s.level)<0)return!0}return!1},W.N="TaskProxy",W}(BaseProxy);j.TaskPy=e,__reflect(e.prototype,"game.TaskPy")}(game||(game={})),function(o){var e=function(n){function e(){var e,t=n.call(this)||this;return t.curSelectIndex=0,t.taskType_2_tabbarIndex=((e={})[TaskType.Daily]=0,e[TaskType.Achievement]=1,e),t.skinName="TaskViewSkin",t.proxy=o.AppFacade.getInstance().retrieveProxy(o.TaskPy.N),t.backpackProxy=o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N),t.DailyConfig=o.Config.taskConfigByTypeSperBySubtype(TaskType.Daily),t.AchieveConfig=o.Config.taskConfigByTypeSperBySubtype(TaskType.Achievement),t}return __extends(e,n),e.prototype.onDestroy=function(){n.prototype.onDestroy.call(this)},e.prototype.childrenCreated=function(){var e=this;if(n.prototype.childrenCreated.call(this),UIActionManager.hideScrollerBar(this.sl_root),this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.topProgress||(this.topProgress=new a,this.topProgress.horizontalCenter=0,this.topProgress.img_bg.source="common_img_kt_7_png",this.topProgress.img_title_bg.visible=!1,this.gp_progress.addChild(this.topProgress)),this.initTabbar(),this.addNotice(),this.list_root.dataProvider=new eui.ArrayCollection,this.list_root.itemRenderer=a,!this.timer){var t=Utils.TimerManager.getServerTime(),i=new Date(1e3*t);i.setHours(23,59,59),this.leftTime=i.getTime()/1e3-t,this.lb_time.text=Utils.TimerManager.getFormatBySecond1(this.leftTime),this.timer=egret.setInterval(function(){e.leftTime--,(!e.leftTime||e.leftTime<0)&&(e.leftTime=86400,e.updateView({})),e.lb_time.text=Utils.TimerManager.getFormatBySecond1(e.leftTime)},this,1e3)}this.btn_onekey.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.proxy.GetTaskAllReward(TaskType.Daily)},this),this.onTabbarTap({itemIndex:this.curSelectIndex})},e.prototype.updateView=function(e){if(e&&e.taskType){if(!this.taskType_2_tabbarIndex[e.taskType])return;this.onTabbarTap({itemIndex:this.taskType_2_tabbarIndex[e.taskType]})}else this.updateList()},e.prototype.onTabbarTap=function(e){this.curSelectIndex=e.itemIndex;var t=new eui.VerticalLayout;t.horizontalAlign=egret.HorizontalAlign.CENTER,t.gap=10,this.list_root.layout=t,0==this.curSelectIndex?(this.CommonDaTanChuKuang.blb_title.text="任务",this.sl_root.height=522,this.sl_root.y=226,t.paddingTop=0,this.gp_progress.visible=!0,this.gp_refreshTime.visible=!0):(this.CommonDaTanChuKuang.blb_title.text="成就",this.sl_root.height=740,this.sl_root.y=70,t.paddingTop=15,this.gp_progress.visible=!1,this.gp_refreshTime.visible=!1),this.updateList()},e.prototype.updateTopProgress=function(e){this.topProgress.data=e,this.topProgress.dataChanged()},e.prototype.updateList=function(){var e=[],t=0==this.curSelectIndex?TaskType.Daily:TaskType.Achievement,i=0==this.curSelectIndex?this.DailyConfig:this.AchieveConfig,n={};for(var o in this.proxy.allTasks[t]){var a=this.proxy.allTasks[t][o];a&&(n[a.code]=a)}var r=!1;for(var s in i){var c=i[s],l=parseInt(s),h={code:0,current:0,type:t,subType:l,total:99999999,desc:"",finish:!1,rewards:[],isTarget:!1,jumpModule:void 0};for(var o in l!=TaskSubType.ArenaChallengeRank&&l!=TaskSubType.TeamArenaChallengeRank||(h.total=-1),c){var p=c[o],d=JSON.parse(p.target)[0];l==TaskSubType.ArenaChallengeRank||l==TaskSubType.TeamArenaChallengeRank?n[p.code]&&!n[p.code].isTarget&&d>h.total&&(h.code=p.code,h.current=this.proxy.getTaskKey(t,h.code),h.desc=p.desc,h.rewards=p.rewards,h.jumpModule=p.jumpModule,h.finish=h.current&&h.current<=d,h.total=d):n[p.code]&&!n[p.code].isTarget&&d<h.total&&(h.code=p.code,h.current=this.proxy.getTaskKey(t,h.code),h.total=d,h.desc=p.desc,h.finish=h.current>=h.total,h.rewards=p.rewards,h.jumpModule=p.jumpModule)}if(!h.code){var u=c[c.length-1].code;if(n[u]&&n[u].isTarget){d=JSON.parse(c[c.length-1].target)[0];h.code=u,h.current=h.total=d,h.rewards=c[c.length-1].rewards,h.finish=!0,h.isTarget=!0,h.desc=c[c.length-1].desc}}if(l==TaskSubType.ArenaChallengeRank||l==TaskSubType.TeamArenaChallengeRank){var g=h.total;h.total=h.current,h.current=g}0==h.total&&(h.total=1,h.current=1),h.subType!=TaskSubType.DoneAllDailyTask?e.push(h):this.updateTopProgress(h),h.finish&&!h.isTarget&&(r=!0)}e.sort(function(e,t){return e.isTarget!=t.isTarget?e.isTarget?1:-1:e.finish!=t.finish?e.finish?-1:1:e.code-t.code}),this.list_root.dataProvider.replaceAll(e),this.sl_root.stopAnimation(),this.list_root.validateNow(),this.sl_root.viewport.scrollV>this.list_root.height-this.sl_root.height&&(this.sl_root.viewport.scrollV=this.list_root.height-this.sl_root.height),UIActionManager.setAbsGrey(this.btn_onekey,!r),this.btn_onekey.touchEnabled=r},e.prototype.initTabbar=function(){var t=this;this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar.dataProvider=new eui.ArrayCollection([{source:{up:"_btn_yq_m_json.common_yeqian_renwu_0",down:"_btn_yq_m_json.common_yeqian_renwu_1",text:"任务"}},{source:{up:"_btn_yq_m_json.common_yeqian_chengjiu_0",down:"_btn_yq_m_json.common_yeqian_chengjiu_1",text:"成就"}}]),this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){t.sl_root.viewport.scrollV=0,t.onTabbarTap(e)},this)},e.prototype.addNotice=function(){},e.prototype.perClose=function(){n.prototype.perClose.call(this),this.timer&&egret.clearInterval(this.timer)},e}(BasePanel);o.TaskView=e,__reflect(e.prototype,"game.TaskView");var a=function(t){function e(){var e=t.call(this)||this;return e.skinName="CommonItemRenderTaskSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.data.isTarget||(i.data.finish?o.AppFacade.getInstance().retrieveProxy(o.TaskPy.N).GetTaskReward(i.data.type,i.data.code):i.data.jumpModule?(o.MainJumpConfig.jumpTo(i.data.jumpModule),o.AppFacade.getInstance().hideSubView(o.TaskMediator.N,o.TaskMediator.SV.MAIN)):Utils.MsgUtils.addMidMsg("无跳转途径"))},this),this.progressBar.slideDuration=0,this.progressBar.labelDisplay.scaleX=1/this.progressBar.scaleX,this.progressBar.labelDisplay.scaleY=1/this.progressBar.scaleY,this.progressBar.labelFunction=function(e,t){return i.data&&i.data.current+"/"+i.data.total}},e.prototype.dataChanged=function(){if(this.progressBar.maximum!=this.data.total&&(this.progressBar.maximum=this.data.total),this.progressBar.value=this.data.current,this.lb_info.text=this.data.desc,this.data.isTarget?(this.btn_go.visible=!1,this.btn_gone.visible=!0):(this.btn_go.visible=!0,this.btn_gone.visible=!1,this.data.finish||this.data.subType==TaskSubType.DoneAllDailyTask?(this.data.subType!=TaskSubType.DoneAllDailyTask||this.data.finish?this.data.subType==TaskSubType.DoneAllDailyTask&&this.data.finish&&(this.btn_go.touchEnabled=!0,UIActionManager.setGrey(this.btn_go,!1)):(this.btn_go.touchEnabled=!1,UIActionManager.setGrey(this.btn_go,!0)),this.btn_go.label="领取"):this.btn_go.label="前往"),this.gp_reward.removeChildren(),this.data.rewards){var e=JSON.parse(this.data.rewards);for(var t in e){var i=e[t],n=customui.BaseItemFactory.create();n.updateData({reward:i}),n.scaleX=n.scaleY=.8,n.x=5,n.y=3,this.gp_reward.addChild(n)}}},e}(eui.ItemRenderer);__reflect(a.prototype,"taskItem")}(game||(game={})),function(c){var e=function(t){function e(){var e=t.call(this)||this;return e.taskPy=c.GameMVC.taskPy,e.skinName="SecondAchievementPanelSkin",e}return __extends(e,t),e.prototype.initList=function(){this.list_items.itemRenderer=i,this.ac_items=new eui.ArrayCollection,this.list_items.dataProvider=this.ac_items},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.activateComponent()},e.prototype.updateView=function(e){var t=this.taskPy.secAchInfo;this.targetLevelConfig=void 0;var i=c.Config.getSecAchievementLevelConfig();for(var n in i){var o=i[n];if(o.isShow){if(t.level>=o.level&&t.levelTargeted.indexOf(o.level)<0){this.targetLevelConfig=o;break}if(o.level>t.level){this.targetLevelConfig=o;break}}}this.gp_rewards.removeChildren(),this.targetLevelConfig?(this.gp_level.visible=!0,this.blb_progress.visible=!0,this.gp_rewards.visible=!0,this.blb_maxLevel.visible=!1,this.btn_obtain.visible=t.level>=this.targetLevelConfig.level,this.blb_level.text=t.level.toString(),this.blb_progress.text="("+t.level+"/"+this.targetLevelConfig.level+")",t.level>=this.targetLevelConfig.level?(this.img_bg.source="cj_img_tu01_png",this.blb_progress.font="green_num_fnt",this.blb_progress.y=75,this.gp_rewards.y=118):(this.img_bg.source="cj_img_tu02_png",this.blb_progress.font="white_num_fnt",this.blb_progress.y=91,this.gp_rewards.y=141),c.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,JSON.parse(this.targetLevelConfig.rewards),1)):(this.gp_level.visible=!1,this.blb_progress.visible=!1,this.gp_rewards.visible=!1,this.btn_obtain.visible=!1,this.blb_maxLevel.visible=!0,this.blb_maxLevel.text=t.level.toString(),this.img_bg.source="cj_img_tu03_png",this.btn_obtain.visible=!1);var a=this.taskPy.allTasks[TaskType.SecondAchievement],r=[],s=c.Config.getSecAchievementConfig();a.forEach(function(e){var t=s[e.code],i=JSON.parse(t.target)[0],n=REWARD_STATUS.UNAVAILABLE;e.isTarget?n=REWARD_STATUS.RECEIVED:e.key>=i&&(n=REWARD_STATUS.AVAILABLE);var o={info:e,config:t,target:i,status:n};r.push(o)}),r.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.config.code-t.config.code}),this.ac_items.replaceAll(r)},e.prototype.activateComponent=function(){var e=this;this.rootPanel.blb_title.text="成长成就",this.rootPanel.onCloseCB=function(){e.hide()},this.btn_obtain.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.taskPy.GetSecondAchievementLevelReward(e.targetLevelConfig.level,function(){e.updateView()})},this)},e}(BasePanel);c.SecondAchievementPanel=e,__reflect(e.prototype,"game.SecondAchievementPanel");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="SecondAchievementPanel_Item",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_obtain.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.GameMVC.taskPy.GetSecondAchievementReward(e.data.config.code)},this)},e.prototype.dataChanged=function(){var e=this.data.info,t=this.data.config;this.img_icon.source=t.icon+"_png",this.lb_desc.text=t.desc,1==t.progress?this.lb_progress.text=(Number(e.key)<this.data.target?0:t.progress)+"/"+t.progress:this.lb_progress.text=e.key+"/"+this.data.target;var i=JSON.parse(t.rewards);this.gp_rewards.removeChildren(),c.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,i,1);var n=this.data.status;n===REWARD_STATUS.RECEIVED?(this.btn_obtain.label="已完成",this.btn_obtain.skinName="skins.ButtonSkinSure",UIActionManager.setAbsGrey(this.btn_obtain,!1),this.btn_obtain.enabled=!1,this.lb_progress.visible=!1,this.btn_obtain.verticalCenter=0):(this.btn_obtain.label="领取",this.btn_obtain.skinName="skins.ButtonSkinYellow",n===REWARD_STATUS.AVAILABLE?(UIActionManager.setAbsGrey(this.btn_obtain,!1),this.btn_obtain.enabled=!0,this.lb_progress.textColor=2460433):(UIActionManager.setAbsGrey(this.btn_obtain,!0),this.btn_obtain.enabled=!1,this.lb_progress.textColor=4536106),this.lb_progress.visible=!0,this.btn_obtain.verticalCenter=20)},e}(eui.ItemRenderer);__reflect(i.prototype,"SecondAchievementPanel_Item")}(game||(game={})),function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(BasePanel);e.UnlockTaskPanel=t,__reflect(t.prototype,"game.UnlockTaskPanel")}(game||(game={})),function(h){var e=function(o){function e(){var e=o.call(this)||this;return e.playing=!1,e.isLockTen=!1,e.touchGoldHandPy=h.AppFacade.getInstance().retrieveProxy(h.TouchGoldHandPy.N),e.playerpy=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N),Utils.AssetsMgr.loadGroup("group_touch_gold_hand"),e.skinName="TouchGoldHandSkin",e}return __extends(e,o),e.prototype.onDestroy=function(){o.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_touch_gold_hand")},e.prototype.childrenCreated=function(){var t=this;o.prototype.childrenCreated.call(this);var e=h.Config.VIPConfig(!0),i=0;for(var n in e)if(1==e[n].touchGoldTen){i=Number(n);break}this.btn_click_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.clickFunc(1)},this),this.btn_click_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.isLockTen)t.clickFunc(10);else{var e="vip"+i+"开启十连宝藏功能";Utils.MsgUtils.addMidMsg(e)}},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.initView(),this.initEffect()},e.prototype.initEffect=function(){var t=this;DragonBoneTools.playOnce({effectName:"common_airenbaozang_1",parent:this.gp_effect,x:100,y:115,loop:!0}),DragonBoneTools.create("common_airenbaozang_3",function(e){t.effect=e,t.effect.x=100,t.effect.y=128,t.effect.visible=!1,t.effect.animation.stop(),t.gp_effect.addChild(t.effect)})},e.prototype.initView=function(){for(var e=h.Config.touchGoldHandRewards(),t=this.playerpy.playerInfoVO.level,i=1;e[i];){var n=e[i],o=JSON.parse(n.levelLimit);if(o[0]<=t&&o[1]>=t){var a=JSON.parse(n.rewards),r=h.GeneralConfig.getEntityConfigByCode(a[0][0],a[0][1]);this.img_rewardIcon.source=ResourceUtils.png(r.icon),this.lb_reward.text=""+Utils.MathUtils.formatNumStyle1(a[0][2]);break}++i}},e.prototype.updateView=function(){var e=h.Config.VIPConfig();if(this.touchGoldHandPy.touchGoldHandInfo&&0<this.touchGoldHandPy.touchGoldHandInfo.freeTimes&&e.touchGoldTen<=0){this.btn_click_1.label="免费",this.common_1.visible=!1,UIActionManager.setGrey(this.btn_click_10,!0);var t=this.touchGoldHandPy.touchGoldHandInfo.hBuyTimes,i=h.Config.publicBuyCostConfig(MODULE.TouchGoldHand,t),n=[(a=JSON.parse(i.costs))[0][0],a[0][1],10*a[0][2]];this.common_10.updateItem({cost:n,style:CommonIconStyle.RIGHT,showEnough:!1})}else if(this.touchGoldHandPy.touchGoldHandInfo){this.playerpy.playerInfoVO.level,t=this.touchGoldHandPy.touchGoldHandInfo.hBuyTimes;var o=this.touchGoldHandPy.touchGoldHandInfo.freeTimes,a=(i=h.Config.publicBuyCostConfig(MODULE.TouchGoldHand,t),JSON.parse(i.costs));h.GeneralConfig.getEntityConfigByCode(a[0][0],a[0][1]);if(0<e.touchGoldTen){var r=0<o;this.btn_click_1.label=1==r?"免费":"1次宝藏",this.isLockTen=!0;for(var s=1;s<3;++s){var c=this["common_"+(1==s?1:10)];c.visible=1!=s||!r;var l=1==s?a[0][2]:10*a[0][2];n=[a[0][0],a[0][1],l];c.updateItem({cost:n,style:CommonIconStyle.RIGHT,showEnough:!1})}}else this.common_1.visible=!0,this.isLockTen=!1,this.btn_click_1.label="1次宝藏",this.common_1.updateItem({cost:a[0],style:CommonIconStyle.RIGHT,showEnough:!1});UIActionManager.setGrey(this.btn_click_10,!this.isLockTen)}},e.prototype.playEffect=function(i){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return this.btn_click_1.touchEnabled=!1,this.playing=!0,this.img_box.source="arbz_img_baoxiangkai_png",this.effect&&(this.effect.animation.play(),this.effect.visible=!0),[4,DragonBoneTools.playOnce({effectName:"common_airenbaozang_2",parent:this.gp_effect,x:100,y:115,loop:!1,doneCB:function(){egret.setTimeout(function(){t.effect&&t.effect.armature&&(h.AppFacade.getInstance().retrieveProxy(h.BackpackPy.N).handleClientReward(i.clientReward),t.img_box&&(t.img_box.source="arbz_img_baoxiangguan_png"),t.effect&&t.effect.armature&&t.effect.animation.stop(),t.effect&&(t.effect.visible=!1),t.btn_click_1.touchEnabled=!0,t.playing=!1)},t,500)}})];case 1:return e.sent(),[2]}})})},e.prototype.clickFunc=function(e){var t=this;Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_dianjin),this.touchGoldHandPy.touchGold({times:e,doneCB:function(e){t.playEffect(e)}})},e}(BasePanel);h.TouchGoldHand=e,__reflect(e.prototype,"game.TouchGoldHand")}(game||(game={})),function(e){var t=function(t){function r(){var e=t.call(this)||this;return e.curPage=0,e.scrollDuration=250,e.isHScroller=!0,e.bScrolling=!1,e}return __extends(r,t),r.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initialize()},r.prototype.initialize=function(){UIActionManager.hideScrollerBar(this),this.scrollPolicyH=eui.ScrollPolicy.OFF,this.scrollPolicyV=eui.ScrollPolicy.OFF,this.throwSpeed=0,this.bounces=!1},r.prototype.getItemNum=function(){var e=this.viewport;return e instanceof eui.List?e.dataProvider.source.length:e.numChildren},r.prototype.scrollerToPage=function(e,t,i){var n=this;if(void 0===t&&(t=!1),this.curPage!=e){var o=this.getItemNum();if(o<=e)this.scrollerToPage(o-1,t,i);else if(e<0)this.scrollerToPage(0,t,i);else{this.bScrolling=!0;var a=t?0:this.scrollDuration;(this.isHScroller?egret.Tween.get(this.viewport).to({scrollH:e*(this.pageSize||this.width)},a):egret.Tween.get(this.viewport).to({scrollV:e*(this.pageSize||this.height)},a)).call(function(){n.bScrolling=!1,n.curPage=e,i&&i(),n.dispatchEventWith(r.EVENT_SCROLL_COMPLETE,!1,n.curPage)})}}else i&&i()},r.prototype.scrollToNext=function(e){this.bScrolling||this.scrollerToPage(this.curPage+1,!1,e)},r.prototype.scrollToLast=function(e){this.bScrolling||this.scrollerToPage(this.curPage-1,!1,e)},r.EVENT_SCROLL_COMPLETE="EVENT_SCROLL_COMPLETE",r}(eui.Scroller);e.PageScroller=t,__reflect(t.prototype,"customui.PageScroller")}(customui||(customui={})),function(n){var e=function(t){function i(){var e=t.call(this,i.N)||this;return NoticeManager.registerCB(NT.GOLDHAND,e.checkNotice,e),e}return __extends(i,t),i.prototype.checkNotice=function(){return this.touchGoldHandInfo&&0<this.touchGoldHandInfo.freeTimes},i.prototype.touchGold=function(t){var i=this;Utils.Socket.send("touchGoldHand","TouchGold",{times:t.times}).then(function(e){t.doneCB&&t.doneCB(e),i.getTouchGoldHandInfo()}).catch(function(e){console.log("TouchGold error --"+e)})},i.prototype.getTouchGoldHandInfo=function(){var t=this;Utils.Socket.send("touchGoldHand","GetTouchGoldHandInfo",{}).then(function(e){t.touchGoldHandInfo=e.info,n.AppFacade.getInstance().retrieveMediator(n.TouchGoldHandMediator.N).updateView(n.TouchGoldHandMediator.SV.MAIN),NoticeManager.updateNotice(NT.GOLDHAND)}).catch(function(e){console.log(e)})},i.N="TouchGoldHandPy",i}(BaseProxy);n.TouchGoldHandPy=e,__reflect(e.prototype,"game.TouchGoldHandPy")}(game||(game={}));var DUNGEON_CONST={NODE_GAP_H:150,NODE_OFFSET_H:45,NODE_GAP_V:300,NODE_OFFSET_V:70,PATH_DOT_GAP:6,PATH_DOT_OFFSET_H:5,PATH_DOT_OFFSET_V:3};!function(s){var e=function(t){function o(e){return void 0===e&&(e=null),t.call(this,o.N,e)||this}return __extends(o,t),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,s.DungeonMainView),this.addSubView(o.SV.MAP,s.DungeonMapView),this.addSubView(o.SV.CHOOSE,s.DungeonChoosePanel),this.addSubView(o.SV.CAMP,s.DungeonCampPanel),this.addSubView(o.SV.HERO_UP,s.DungeonHeroUpPanel),this.addSubView(o.SV.ROLL_DICE,s.DungeonRollDicePanel),this.addSubView(o.SV.RANDOM_EVENT,s.DungeonRandomEventPanel),this.addSubView(o.SV.BOX_EVENT,s.DungeonBoxPanel),this.addSubView(o.SV.GAME_END_RESULT,s.DungeonResultPanel),this.addSubView(o.SV.RANDOM_RESULT,s.DungeonRandomResultPanel)},o.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.GENERAL_PASS_DAY,CN.DUNGEON_UPDATE_HEROLIST,CN.DUNGEON_UPDATE_HEROLIST_EFFECT,CN.REWARD_CLOSE,CN.DUNGEON_RANDOM_EVENT_ADDLIFE,CN.DUNGEON_RANDOM_EVENT_MINUSLIFE,CN.DUNGEON_RANDOM_EVENT_MINUSGOLD,CN.DUNGEON_RANDOM_EVENT_GETHERO,CN.DUNGEON_RANDOM_EVENT_ADDGOLD,CN.DUNGEON_UPDATE_HEROLIST_EFFECT,CN.DUNGEON_UPDATE_ONE_HERO,CN.DUNGEON_RANDOM_EVENT_MINUSLIFE_TEXT,CN.DUNGEON_USE_ITEM,CN.DUNGEON_BOSS_CLEAR,CN.DUNGEON_NEW_CHAPTER]},o.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.SDKMgr.getPerformConfig(38)&&Utils.UnlockMgr.checkPass(MODULE.Vestage,!1).allow&&(s.GameMVC.dungeonPy.GetVestageMapInfo(),s.GameMVC.dungeonPy.GetVestageHeroInfo());break;case CN.DUNGEON_UPDATE_HEROLIST:(i=this.getSubView(o.SV.MAP))&&i.updateHeroList();break;case CN.DUNGEON_UPDATE_HEROLIST_EFFECT:(i=this.getSubView(o.SV.MAP))&&(i.updateHeroList(),i.updateHeroEffect());break;case CN.DUNGEON_RANDOM_EVENT_ADDLIFE:(i=this.getSubView(o.SV.MAP))&&(i.updateHeroList(),i.updateHeroEffect(t));break;case CN.DUNGEON_RANDOM_EVENT_MINUSLIFE:(i=this.getSubView(o.SV.MAP))&&(i.updateHeroList(),i.updateHpEffect(t));break;case CN.DUNGEON_RANDOM_EVENT_MINUSGOLD:(i=this.getSubView(o.SV.MAP))&&i.minusMoneyEffect(t);break;case CN.DUNGEON_RANDOM_EVENT_ADDGOLD:(i=this.getSubView(o.SV.MAP))&&i.addMoneyEffect(t);break;case CN.DUNGEON_NEW_CHAPTER:this.updateView(o.SV.MAP,{newChapter:!0});break;case CN.GENERAL_PASS_DAY:s.GameMVC.dungeonPy.baseInfo.records&&Number(s.MainJumpConfig.getCurEvent())==MODULE.Vestage&&s.MainJumpConfig.jumpTo();break;case CN.REWARD_CLOSE:s.GameMVC.dungeonPy.hasNewHeroGet&&(s.GameMVC.dungeonPy.hasNewHeroGet=!1,this.flyHero());break;case CN.DUNGEON_USE_ITEM:var i=this.getSubView(o.SV.MAP),n=s.Config.vestageItemConfig()[t].type;n==VestagePropType.LifePotion?i&&i.updateAddHpEffect():n==VestagePropType.ResuscitatedPotion&&i&&i.updateRebornEffect();break;case CN.DUNGEON_UPDATE_ONE_HERO:(i=this.getSubView(o.SV.MAP))&&i.updateOneHeroEffect(t);break;case CN.DUNGEON_RANDOM_EVENT_MINUSLIFE_TEXT:(i=this.getSubView(o.SV.MAP))&&i.updateHpCost(t)}},o.prototype.flyBuff=function(r){var t=this;return new Promise(function(a,e){DragonBoneTools.create("common_zengyi02",function(e){e.x=375,e.y=575+Utils.DeviceUtils.statusBarHeight;var t=e.armature.getSlot("common_zengyi02-15"),i=new eui.Image,n=s.Config.vestageItemConfig()[r.code];RES.getResAsync(ResourceUtils.png(n.icon),function(e){i.source=e,i.anchorOffsetX=.5*e.textureWidth,i.anchorOffsetY=.5*e.textureHeight},this),t.display=i,GameRootLayer.gameLayer().popMsgLayer.addChild(e);var o=new eui.Label;o.textAlign=egret.HorizontalAlign.CENTER,o.width=400,o.size=25,o.stroke=2,o.text=n.desc,o.horizontalCenter=15,o.y=e.y+120,GameRootLayer.gameLayer().popMsgLayer.addChild(o),e.animation.play("common_zengyi02"),egret.setTimeout(function(){o&&o.parent&&o.parent.contains(o)&&o.parent.removeChild(o)},this,1e3),e.addEventListener(dragonBones.EventObject.COMPLETE,function(){e&&e.parent&&e.parent.contains(e)&&e.parent.removeChild(e),o&&o.parent&&o.parent.contains(o)&&o.parent.removeChild(o),a()},this)},t)})},o.prototype.flyHero=function(){var l=this;return new Promise(function(e,t){var s=[GameRootLayer.gameLayer().popMsgLayer.width/2,GameRootLayer.gameLayer().popMsgLayer.height/2],c=[GameRootLayer.gameLayer().popMsgLayer.width-20,GameRootLayer.gameLayer().popMsgLayer.height-120];DragonBoneTools.create("common_equip_02",function(e){var t=new egret.Point(s[0],s[1]),i=new egret.Point(c[0],c[1]),n=egret.Point.distance(t,i),o=e.height,a=void 0;o<n?(a=egret.Point.interpolate(t,i,o/n),l.log("距离修正",o/n,a.x,a.y,i.x,i.y)):a=i;var r=Utils.MathUtils.getDegByAB(a.y-s[1],a.x-s[0]);e.rotation=90+r,e.x=s[0],e.y=s[1],GameRootLayer.gameLayer().popMsgLayer.addChild(e),e.animation.play("common_equip_02",0),egret.Tween.get(e).to({x:a.x,y:a.y},500).call(function(){DragonBoneTools.playOnce({x:c[0]-105,y:c[1]-140,effectName:"common_gonghuiqiandao_2",parent:GameRootLayer.gameLayer().popMsgLayer}),e&&e.parent&&e.parent.removeChild(e)}),egret.Point.release(a)})})},o.N="DungeonMed",o.SV={MAIN:1,MAP:2,CHOOSE:3,CAMP:4,HERO_UP:5,ROLL_DICE:6,RANDOM_EVENT:7,BOX_EVENT:8,GAME_END_RESULT:9,RANDOM_RESULT:10},o}(BaseMediator);s.DungeonMed=e,__reflect(e.prototype,"game.DungeonMed")}(game||(game={})),function(n){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new i).register(),(new o).register(),(new a).register(),(new r).register()},e}();n.DungeonProcessor=e,__reflect(e.prototype,"game.DungeonProcessor");var t=function(e){function t(){return e.call(this,"vestageHero.SingleVestageHeroP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody(),i=n.AppFacade.getInstance().retrieveProxy(n.DungeonPy.N);i.heroDict&&i.heroDict[t.hero.uuid]&&i.heroDict[t.hero.uuid].life<=0&&0<t.hero.life&&0!=t.hero.pos&&n.AppFacade.getInstance().sendNotification(CN.DUNGEON_UPDATE_ONE_HERO,t.hero.pos),i.updateHeroListInfo([t.hero])},t}(n.ProcessorBase);n.SingleVestageHeroP=t,__reflect(t.prototype,"game.SingleVestageHeroP");var i=function(e){function t(){return e.call(this,"vestage.VestageBaseInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();n.GameMVC.dungeonPy.updateBaseInfo(t.base)},t}(n.ProcessorBase);n.VestageBaseInfoP=i,__reflect(i.prototype,"game.VestageBaseInfoP");var o=function(e){function t(){return e.call(this,"vestageHero.VestageHeroInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();n.GameMVC.dungeonPy.updateHeroListInfo(t.heroList)},t}(n.ProcessorBase);n.VestageHeroInfoP=o,__reflect(o.prototype,"game.VestageHeroInfoP");var a=function(e){function t(){return e.call(this,"vestageHero.VestagePutOnHeroP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();n.GameMVC.dungeonPy.updateHeroListInfo(t.heroList)},t}(n.ProcessorBase);n.VestagePutOnHeroP=a,__reflect(a.prototype,"game.VestagePutOnHeroP");var r=function(e){function t(){return e.call(this,"vestageHero.VestageHeroStatusModifyP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();if(!t.isAdd){var i=JSON.parse(t.modifyAttr)[VestageResultSubType.MinusLife];n.AppFacade.getInstance().sendNotification(CN.DUNGEON_RANDOM_EVENT_MINUSLIFE_TEXT,i)}},t}(n.ProcessorBase);n.VestageHeroStatusModifyP=r,__reflect(r.prototype,"game.VestageHeroStatusModifyP")}(game||(game={})),function(s){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.hasNewHeroGet=!1,e.reset(),e}return __extends(i,t),i.prototype.reset=function(){this.mapInfo=new s.DungeonMapVO,this.baseInfo=new s.DungeonBaseInfoVO,this.heroDict={},this.itemInfo={},this.buffInfo=new Array},i.prototype.updateMapInfo=function(e){this.mapInfo.update(e),s.AppFacade.getInstance().updateView(s.DungeonMed.N,s.DungeonMed.SV.MAP)},i.prototype.updateItem=function(e){var t=this;this.itemInfo={},e.forEach(function(e){t.itemInfo[e.code]=e.num})},i.prototype.getPotionNum=function(){var e=0,t=s.GameMVC.dungeonPy.itemInfo,i=s.Config.vestageItemConfig();for(var n in t){var o=t[n];i[n].useType===VestageItemUseType.Direct&&(e+=o)}return e},i.prototype.updateBaseInfo=function(e,t){void 0===t&&(t=!0),this.baseInfo.update(e),t&&s.AppFacade.getInstance().updateView(s.DungeonMed.N,s.DungeonMed.SV.MAIN)},i.prototype.updateBuffInfo=function(e,t){var r=this;void 0===t&&(t=!1),this.buffInfo.forEach(function(e){e.isExpire=!0}),e.forEach(function(e,t){for(var i=!1,n=0,o=r.buffInfo;n<o.length;n++){var a=o[n];a.code==e.code&&a.dt==e.dt&&(i=!0,a.update(e))}i||r.buffInfo.push(new s.DungeonSBuffVO(e))}),this.buffInfo=this.buffInfo.filter(function(e){return!e.isExpire}),this.buffInfo.sort(function(e,t){return e.dt==t.dt?e.code-t.code:e.dt-t.dt}),t&&this.buffInfo.forEach(function(e){e.iAmClean()})},i.prototype.GetVestageMapInfo=function(t){var i=this;Utils.Socket.send("vestage","GetVestageMapInfo",{}).then(function(e){i.updateBuffInfo(e.buffs,!0),i.updateMapInfo(e.info),i.updateBaseInfo(e.base),i.updateItem(e.items),t&&t()})},i.prototype.EnterPoint=function(t){var i=this;Utils.Socket.send("vestage","EnterPoint",{mapCode:t.mapCode?t.mapCode:this.mapInfo.code,pointId:t.pointId}).then(function(e){i.updateMapInfo(e.map),t.cb&&t.cb(e)})},i.prototype.TriggerEvent=function(t){var i=this;Utils.Socket.send("vestage","TriggerEvent",{mapCode:t.mapCode?t.mapCode:this.mapInfo.code,pointId:t.pointId,key:t.key}).then(function(e){!t.dontPopReward&&e.clientReward?s.GameMVC.backpackPy.handleClientReward(e.clientReward,{closeCB:function(){i.updateBuffInfo(e.buffs),i.updateMapInfo(e.map),i.updateBaseInfo(e.base),t.cb&&t.cb(e)}}):(i.updateBuffInfo(e.buffs),i.updateMapInfo(e.map),i.updateBaseInfo(e.base),t.cb&&t.cb(e))})},i.prototype.EndEvent=function(t){var i=this;Utils.Socket.send("vestage","EndEvent",{mapCode:t.mapCode?t.mapCode:this.mapInfo.code,pointId:t.pointId}).then(function(e){i.updateBuffInfo(e.buffs),i.updateMapInfo(e.map),t.cb&&t.cb(e)})},i.prototype.Restart=function(e,t){var i=this;Utils.Socket.send("vestage","Restart",{isBroken:e}).then(function(e){i.reset(),i.updateMapInfo(e.info),t&&t()})},i.prototype.UseItem=function(t){var i=this,e={};for(var n in t){var o=t[n];"code"!=n&&"num"!=n&&(e[n]=o)}var a={code:t.code,num:t.num||1,key:JSON.stringify(e)};Utils.Socket.send("vestage","UseItem",a).then(function(e){i.updateBuffInfo(e.buffs),s.AppFacade.getInstance().sendNotification(CN.DUNGEON_USE_ITEM,t.code),s.AppFacade.getInstance().updateView(s.DungeonMed.N,s.DungeonMed.SV.MAP),t.cb&&t.cb(e)})},i.prototype.DiscardItem=function(t){Utils.Socket.send("vestage","DiscardItem",{code:t.code,num:t.num||1}).then(function(e){s.AppFacade.getInstance().updateView(s.DungeonMed.N,s.DungeonMed.SV.MAP),t.cb&&t.cb(e)})},i.prototype.GetStartedBuff=function(t){var i=this;Utils.Socket.send("vestage","GetStartedBuff",{}).then(function(e){i.updateBuffInfo(e.buffs),i.updateBaseInfo(e.base,!1),t&&t(e)})},i.prototype.updateHeroListInfo=function(e){var t=this;e.forEach(function(e){t.heroDict[e.uuid]?t.heroDict[e.uuid].update(e):t.heroDict[e.uuid]=new s.DungeonHeroVO(e)}),s.AppFacade.getInstance().sendNotification(CN.DUNGEON_UPDATE_HEROLIST)},i.prototype.deleteHeroByUuids=function(e){var t=this;e.forEach(function(e){delete t.heroDict[e]})},i.prototype.GetVestageHeroInfo=function(){var t=this;Utils.Socket.send("vestageHero","GetVestageHeroInfo",{}).then(function(e){t.updateHeroListInfo(e.heroList)})},i.prototype.SelectInitHero=function(e,t){var i=this;Utils.Socket.send("vestageHero","SelectInitHero",{heroUuids:e.uuid}).then(function(e){i.updateHeroListInfo(e.heroList),t&&t()})},i.prototype.SelectPutOnHero=function(e,t){var i=this;Utils.Socket.send("vestageHero","SelectPutOnHero",{heroUuids:e.uuid}).then(function(e){i.updateHeroListInfo(e.heroList),t&&t()})},i.prototype.PutHeroOn=function(e,t){var i=this;Utils.Socket.send("vestageHero","PutHeroOn",{uuid:e.uuid,pos:e.pos}).then(function(e){i.updateHeroListInfo(e.heroList),t&&t()})},i.prototype.PutHeroDown=function(e,t){var i=this;Utils.Socket.send("vestageHero","PutHeroDown",{uuid:e.uuid}).then(function(e){i.updateHeroListInfo(e.heroList),t&&t()})},i.prototype.ImproveHeroStar=function(e,t){Utils.Socket.send("vestageHero","ImproveHeroStar",{uuid:e.uuid}).then(function(e){t&&t()})},i.N="DungeonPy",i}(BaseProxy);s.DungeonPy=e,__reflect(e.prototype,"game.DungeonPy")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="DungeonBoxPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateView=function(e){var t=this;this.params=e,this.dungeonEventPointObj=e.dungeonEventPointObj,DragonBoneTools.playOnce({effectName:"common_dabaoxiang",parent:this.gp_effect,doneCB:function(){t.dungeonEventPointObj.commonTriggerEvent(JSON.stringify({}),function(e){t.hide()})}})},e}(BasePanel);e.DungeonBoxPanel=t,__reflect(t.prototype,"game.DungeonBoxPanel")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="SkillDetailsPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateItem=function(e){var t=game.Config.vestageItemConfig()[e.code];t&&(this.skill_item.img_icon.source=ResourceUtils.png(t.icon),this.skill_item.scaleX=this.skill_item.scaleY=.8,this.lb_name.text=t.name,this.lb_desc.text=t.desc,this.lb_tips.text="")},e}(eui.Component);e.DungeonBuffShowPanel=t,__reflect(t.prototype,"customui.DungeonBuffShowPanel")}(customui||(customui={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="DungeonCampPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),DragonBoneTools.create("zhujiemian_lt_01",function(e){(e=e).x=this.gp_laotou.width/2,e.y=this.gp_laotou.height,e.animation.play("daiji2"),this.gp_laotou.addChild(e)},this),DragonBoneTools.create("zhujiao_01_z",function(e){(e=this.playerModel=e).x=this.gp_lead.width/2,e.y=this.gp_lead.height,e.scaleX=-1.5,e.scaleY=1.5,e.animation.play(),this.gp_lead.addChild(e)},this),this.img_rest.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(i.isCanTouch){var e=a.Config.vestageEventConfig()[i.dungeonEventPointObj.vo.eventId],t=JSON.parse(e.detail);GameRootLayer.gameLayer().switchCloudLoading(!0),GameRootLayer.gameLayer().switchTouchEnable(!1),i.dungeonEventPointObj.commonTriggerEvent(JSON.stringify({eventId:t[0]}),function(){i.isCanTouch=!1,i.restEffect()})}},this),this.img_up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide(),a.AppFacade.getInstance().showSubView(a.DungeonMed.N,a.DungeonMed.SV.HERO_UP,{dungeonEventPointObj:i.dungeonEventPointObj})},this)},e.prototype.restEffect=function(){var e=this;GameRootLayer.gameLayer().switchCloudLoading(!1,function(){DragonBoneTools.playOnce({effectName:"common_ty_shengmingyihuifu",parent:e.gp_effect,x:e.gp_effect.width/2,y:e.gp_effect.height/2,scaleX:1,scaleY:1,keep:!1,loop:!1,doneCB:function(){e.hide(),GameRootLayer.gameLayer().switchTouchEnable(!0),a.AppFacade.getInstance().sendNotification(CN.DUNGEON_UPDATE_HEROLIST_EFFECT)}})})},e.prototype.updateView=function(e){this.isCanTouch=!0,this.params=e,this.dungeonEventPointObj=e.dungeonEventPointObj;var t=a.Config.vestageEventConfig()[this.dungeonEventPointObj.vo.eventId],i=JSON.parse(t.detail),n=a.Config.vestageEventConfig()[i[0]],o=JSON.parse(n.detail);this.lb_rest.text="回复出战英雄最大生命的"+o+"%"},e}(BasePanel);a.DungeonCampPanel=e,__reflect(e.prototype,"game.DungeonCampPanel")}(game||(game={})),function(c){var e=function(n){function e(){var e,t=n.call(this)||this;return t.dungeonProxy=c.AppFacade.getInstance().retrieveProxy(c.DungeonPy.N),t.playerProxy=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N),t.heroProxy=c.AppFacade.getInstance().retrieveProxy(c.HeroPy.N),t.allHeroInfo=[],t.chooseHeroPage=0,t.maxHeroPage=0,t.heroList=[],t.isChanging=!1,t.dataprovider=new eui.ArrayCollection,t.ITEM_TYPE_CONFIG=((e={})[c.BackpackUI.ITEM_TYPE.HERO]={desc:"英雄",hasHankBook:!0,barSource:{up:"_btn_yq_m_json.beibao_yeqian_yingxiong_0",down:"_btn_yq_m_json.beibao_yeqian_yingxiong_1"},getAllInfo:function(){var e=[],t=c.AppFacade.getInstance().retrieveProxy(c.HeroPy.N);for(var i in t.allHeroByUuid){var n=t.allHeroByUuid[i];0==n.config.race&&0==n.config.profession||e.push(n)}return e},filterConfig:{data:[[{race:HeroRaceType.Human,icon:HeroRaceConfig[HeroRaceType.Human].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Elf,icon:HeroRaceConfig[HeroRaceType.Elf].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Orc,icon:HeroRaceConfig[HeroRaceType.Orc].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Athanasy,icon:HeroRaceConfig[HeroRaceType.Athanasy].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Demon,icon:HeroRaceConfig[HeroRaceType.Demon].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Eldar,icon:HeroRaceConfig[HeroRaceType.Eldar].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"}]],filterFunc:function(e,t){var i=!e.race||0==e.race.length||-1!=e.race.indexOf(t.config.race),n=!e.star||0==e.star.length||-1!=e.star.indexOf(t.starLevel);return i&&n},addFilter:function(e,t){var i=t.race?"race":"star";e[i]||(e[i]=[]);var n=e[i].indexOf(t[i]);-1==n?(e[i].splice(0),e[i].push(t[i])):e[i].splice(n,1)},autoFilterFunc:function(e,t){return e.starLevel<=4},autoFilterTipsFunc:function(e){return"无五星以下英雄"}},sortConfig:{data:[{desc:"等级"},{desc:"星级"}],getSortFunc:function(e){switch(e){case 0:return function(e,t){return t.info.level-e.info.level};case 1:return function(e,t){return t.info.starLevel-e.info.starLevel};default:return function(){return-1}}},defaultSortFunc:function(e,t){var i=e.info,n=t.info;if(i.starLevel!=n.starLevel)return n.starLevel-i.starLevel;if(i.level!=n.level)return n.level-i.level;var o=c.Config.allHeroConfig()[i.code],a=c.Config.allHeroConfig()[n.code];return o.race!=a.race?o.race-a.race:o.profession!=a.profession?HERO_SORT_ORDER[a.profession]-HERO_SORT_ORDER[o.profession]:i.code-n.code}}},e),t.skinName="DungeonChoosePanelSkin",t.pos2HeroBI={},t.curFilter={},t}return __extends(e,n),e.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.initFilter(),this.initBtnListener(),this.addListener(),this.chooseHeroPage=0,this.heroList=[];for(var e=1;e<=6;e++){var t=customui.BaseItemFactory.create();this.pos2HeroBI[e]=t,this.pos2HeroBI[e].indexNum=e,this.pos2HeroBI[e].resetFixedStyle(EEntityType.EEntityTypeHero);var i=this.pos2XY(e);t.x=i[0],t.y=i[1],t.scaleX=.8,t.scaleY=.8,this.gp_heroList.addChild(t),0<e&&e<7&&this.heroList.push(t)}},e.prototype.getUpHeroList=function(){for(var e=[],t=1;t<=6;t++)this.pos2HeroBI[t].vo&&this.pos2HeroBI[t].vo.uuid?e.push(this.pos2HeroBI[t].vo.uuid):e.push("");return e},e.prototype.initBtnListener=function(){this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(!this.params.isInit){var e=this.getUpHeroList();this.dungeonProxy.SelectPutOnHero({uuid:e},this.hide.bind(this))}},this),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.getUpHeroList(),t=0;for(var i in e)if(""!=e[i]){t++;break}this.params.isInit?0==t?Utils.MsgUtils.addMidMsg("请点击英雄头像选择阵容"):this.dungeonProxy.SelectInitHero({uuid:e},this.hide.bind(this)):0==t?Utils.MsgUtils.addMidMsg("请点击英雄头像上阵阵容"):this.dungeonProxy.SelectPutOnHero({uuid:e},this.hide.bind(this))},this),this.btn_filter.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_filters.visible=!0;var e=this.gp_filter.globalToLocal(0,0),t=new egret.Sprite;t.touchEnabled=!0,t.graphics.beginFill(0,0),t.graphics.drawRect(e.x,e.y,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),t.graphics.endFill(),this.gp_filter.addChildAt(t,2),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.gp_filters.visible=!1,t.parent&&t.parent.removeChild(t)},this)},this)},e.prototype.initFilter=function(){var n=this;this.gp_filters_list.removeChildren();var e=this.ITEM_TYPE_CONFIG[c.BackpackUI.ITEM_TYPE.HERO].filterConfig.data;e&&0<e.length?(this.gp_filter.visible=!0,e.forEach(function(e){var t=new eui.List;t.itemRenderer=c.DecomposeUI_FilterItem;var i=new eui.HorizontalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER,t.layout=i,t.dataProvider=new eui.ArrayCollection(e),t.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.filterItem_onItemTap,n),n.gp_filters_list.addChild(t)}),this.gp_filters.height=42*e.length+20*(e.length-1)+40):this.gp_filter.visible=!1},e.prototype.filterItem_onItemTap=function(e){var t=e.itemRenderer;if(this.ITEM_TYPE_CONFIG[c.BackpackUI.ITEM_TYPE.HERO].filterConfig.addFilter(this.curFilter,e.item),!t.chosen)for(var i=0,n=this.gp_filters_list.$children;i<n.length;i++){var o=n[i];if(-1!=o.$children.indexOf(t))for(var a=0,r=o.$children;a<r.length;a++){var s=r[a];s.chosen&&s.setChosen(!1)}}t.setChosen(!t.chosen),this.updateAllHero()},e.prototype.addListener=function(){this.gp_touchField.touchChildren=!0,this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},e.prototype.removeListener=function(){this.gp_touchField.touchChildren=!1,this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},e.prototype.updateView=function(e){this.params=e,this.updateAllHeroList(),e.isInit||this.updateUpHero(),this.updateAllHero(),this.btn_back.visible=!e.isInit,this.lb_tips.visible=!!e.isInit},e.prototype.updateUpHero=function(){var e=this.dungeonProxy.heroDict;for(var t in e)if(0!=e[t].pos){e[t].uuid;var i=e[t];if(i){var n=0==i.dermaCode?void 0:c.Config.getHeroDermaConfig()[i.dermaCode].avatar;this.pos2HeroBI[e[t].pos].updateData({vo:i,type:EEntityType.EEntityTypeVestageHero,avatar:n})}}},e.prototype.updateAllHeroList=function(){this.allHeroInfo=[];var e=this.ITEM_TYPE_CONFIG[c.BackpackUI.ITEM_TYPE.HERO],t=[],i=void 0;if(this.params.isInit?(t=e.getAllInfo(),i=EEntityType.EEntityTypeHero):(t=this.dungeonProxy.heroDict,i=EEntityType.EEntityTypeVestageHero),t)for(var n in t){var o=t[n];this.allHeroInfo.push({type:i,info:o,isChoose:this.judgeChoose(this.params.isInit,o),touchCB:this.touchHeroEvent.bind(this)})}},e.prototype.judgeChoose=function(e,t){var i=!1,n=this.getUpHeroList();if(e){for(var o in n)if(n[o]==t.uuid){i=!0;break}}else i=0!=t.pos;return i},e.prototype.updateAllHero=function(){this.scroller_hero.stopAnimation();var e=[],t=this.ITEM_TYPE_CONFIG[c.BackpackUI.ITEM_TYPE.HERO],i=t.filterConfig&&t.filterConfig.filterFunc||function(){return!0},n=t.sortConfig&&t.sortConfig.defaultSortFunc,o=void 0,a=void 0;if(this.params.isInit?(o=t.getAllInfo(),a=EEntityType.EEntityTypeHero):(o=this.dungeonProxy.heroDict,a=EEntityType.EEntityTypeVestageHero),o)for(var r in o){var s=o[r];i(this.curFilter,s)&&e.push({type:a,info:s,isChoose:this.judgeChoose(this.params.isInit,s),touchCB:this.touchHeroEvent.bind(this)})}0<e.length&&n&&e.sort(n),this.dataprovider=new eui.ArrayCollection(e),this.list_hero.itemRenderer=l,this.list_hero.dataProvider=this.dataprovider},e.prototype.pos2XY=function(e){var t;Math.ceil((e-6)/6);return[95*(t=(e-1)%6)+(2<t?130:95)-70,45]},e.prototype.getTouchedGroupPos=function(e){for(var t in this.pos2HeroBI){var i=this.pos2HeroBI[t];if(i!=this.targetItem){var n=i.localToGlobal();if(this.rect?this.rect.setTo(n.x,n.y,i.width,i.height):this.rect=new egret.Rectangle(n.x,n.y,i.width,i.height),this.rect.contains(e.stageX,e.stageY))return t}}},e.prototype.onTouchBegin=function(e){var t=this.getTouchedGroupPos(e);if(t&&this.pos2HeroBI[t]){if(this.targetItem=this.pos2HeroBI[t],!this.targetItem.vo)return void(this.targetItem=void 0);this.targetItemTouchTM=Date.now(),this.gp_heroList.setChildIndex(this.targetItem,-1),this.startingPos=t,this.gp_touchField.width=Utils.DeviceUtils.curWidth(),this.gp_touchField.height=Utils.DeviceUtils.curHeight()}},e.prototype.onTouchMove=function(e){this.targetItem&&this.setModelToXY(this.targetItem,e.stageX,e.stageY)},e.prototype.onTouchEnd=function(e){if(this.targetItem){var t=this.getTouchedGroupPos(e);Date.now()-this.targetItemTouchTM<DEEP_NEST_CONST.TOUCH_TIME?this.heroDownByteam(this.targetItem,this.startingPos):t?this.setHeroToPos(this.targetItem,t):this.heroDownByteam(this.targetItem,this.startingPos),this.targetItem=void 0,this.startingPos=void 0,this.gp_touchField.width=this.gp_heroList.width,this.gp_touchField.height=this.gp_heroList.height}},e.prototype.setHeroToPos=function(e,t,i){if(void 0===i&&(i=!1),e){this.pos2HeroBI[this.startingPos]=void 0,this.startingPos&&this.startingPos!=t&&this.pos2HeroBI[t]&&this.setHeroToPos(this.pos2HeroBI[t],this.startingPos,!0),this.pos2HeroBI[t]=e;var n=this.pos2XY(t);e.x=n[0],e.y=n[1],e.scaleX=.8,e.scaleY=.8}},e.prototype.setModelToXY=function(e,t,i){var n=-e.width*e.scaleX/2,o=-e.height*e.scaleY/2;e.x=(t-e.parent.x-this.gp_root.x+n)/Utils.DeviceUtils.additionScale(),e.y=(i-e.parent.y-this.gp_root.y+o)/Utils.DeviceUtils.additionScale()},e.prototype.heroDownByteam=function(e,t){for(var i in this.allHeroInfo)if(e.vo.uuid==this.allHeroInfo[i].info.uuid){for(var n in this.dataprovider.source){var o=this.list_hero.getVirtualElementAt(Number(n)),a=this.dataprovider.getItemAt(Number(n));if(a.info.uuid==e.vo.uuid&&o&&o.img_bg&&o.img_bg.visible){o.img_bg.visible=!1;a.isChoose=!1;a.type!=EEntityType.EEntityTypeVestageHero||0<a.info.life?UIActionManager.setGrey(o.gp_bi,!1):UIActionManager.setAbsGrey(o.gp_bi,!0);break}}var r=this.pos2XY(t);e.x=r[0],e.y=r[1],e.resetFixedStyle(EEntityType.EEntityTypeHero);break}},e.prototype.touchHeroEvent=function(e,t,i){if(e){for(var n=0,o=1;o<=6;o++)if(!this.pos2HeroBI[o].vo){n=o;break}if(0==n)Utils.MsgUtils.addMidMsg("当前阵容已上满");else{var a=0==t.info.dermaCode?void 0:c.Config.getHeroDermaConfig()[t.info.dermaCode].avatar;this.pos2HeroBI[n].updateData({vo:t.info,type:t.type,avatar:a,isShowMax:t.type!=EEntityType.EEntityTypeVestageHero}),i&&i()}}else{var r=0;for(o=1;o<=6;o++)if(this.pos2HeroBI[o].vo&&this.pos2HeroBI[o].vo.uuid==t.info.uuid){r=o;break}0!=r&&(this.pos2HeroBI[r].resetFixedStyle(EEntityType.EEntityTypeHero),i&&i())}},e.prototype.perClose=function(){this.params.doneCB&&this.params.doneCB()},e}(BasePanel);c.DungeonChoosePanel=e,__reflect(e.prototype,"game.DungeonChoosePanel");var l=function(t){function e(){var e=t.call(this)||this;return e.isLive=!0,e.skinName="CommonTeamHeroItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.scaleX=this.baseItem.scaleY=.8,this.img_bg.scaleX=this.img_bg.scaleY=.6,this.gp_bi.addChild(this.baseItem),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.isLive?this.data.touchCB&&this.data.touchCB(!this.img_bg.visible,this.data,this.changeIsUp.bind(this)):this.data.isChoose?this.data.touchCB&&this.data.touchCB(!this.img_bg.visible,this.data,this.changeIsUp.bind(this)):Utils.MsgUtils.addMidMsg("该英雄已阵亡，无法上阵")},this)},e.prototype.dataChanged=function(){var e=this.data,t=0==e.info.dermaCode?void 0:c.Config.getHeroDermaConfig()[e.info.dermaCode].avatar;this.baseItem.updateData({uuid:this.data.info.uuid,type:this.data.type,effect:!1,isShowZhongZhu:!0,avatar:t,isShowMax:this.data.type!=EEntityType.EEntityTypeVestageHero}),this.data.type==EEntityType.EEntityTypeVestageHero?this.isLive=0<e.info.life:this.isLive=!0,this.isLive?(this.img_bg.visible=this.data.isChoose,this.img_bg.visible&&(this.img_bg.source="common_img_gouxuan_png"),UIActionManager.setGrey(this.gp_bi,this.img_bg.visible)):(this.img_bg.visible=this.data.isChoose,this.img_bg.visible&&(this.img_bg.source="common_img_gouxuan_png"),UIActionManager.setAbsGrey(this.gp_bi,!0))},e.prototype.changeIsUp=function(){this.img_bg.visible=!this.img_bg.visible,this.data.isChoose=!this.data.isChoose,this.isLive?(UIActionManager.setGrey(this.gp_bi,this.img_bg.visible),this.img_bg.visible&&(this.img_bg.source="common_img_gouxuan_png")):(this.img_bg.visible&&(this.img_bg.source="common_img_gouxuan_png"),UIActionManager.setAbsGrey(this.gp_bi,!0))},e}(eui.ItemRenderer);__reflect(l.prototype,"CommonTeamHeroItem")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.index2Name={},e.R=86,e.nameLbOffset=46,e.C={x:156,y:122},e.POSS=[{x:-.5,y:-.865},{x:.5,y:-.865},{x:1,y:0},{x:.5,y:.865},{x:-.5,y:.865},{x:-1,y:0}],e.skinName="RadarChartSkin",e.nameGPRoot=new Array,e.lbs=new Array,e.dots=new Array,e}return __extends(e,t),e.prototype.initView=function(e){var a=this;this.config=e,this.keyMap=e.keyMap,this.maxs=e.max,this.curs=e.cur?e.cur:[0,0,0,0,0,0],this.shape?this.shape.graphics.clear():(this.shape=new egret.Shape,this.shape.width=this.width,this.shape.height=this.height,this.addChild(this.shape)),this.nameGPRoot.forEach(function(e){a.removeChild(e)}),this.lbs.splice(0),this.nameGPRoot.splice(0),this.dots.forEach(function(e){a.removeChild(e)}),this.dots.splice(0),this.config.name.forEach(function(e,t){var i=new eui.Label;i.bold=!0,i.size=23,i.textColor=16777215,i.strokeColor=0,i.stroke=2;var n=0,o=15;0===t?(n=-25,o=25):1===t?(n=-3,o=25):2===t?n=-20:3===t?(n=-3,o=-6):4===t?(n=-20,o=-6):5===t&&(n=-20),i.x=a.POSS[t].x*(a.R+a.nameLbOffset)+a.C.x+n,i.y=a.POSS[t].y*(a.R+a.nameLbOffset)+a.C.y+o,a.addChild(i),a.lbs.push(i),a.nameGPRoot.push(i)})},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateCurs=function(e){for(var t in e){var i=0;(i=this.keyMap?this.keyMap[t]:Number(t))<=this.curs.length-1&&(this.curs[i]=e[t])}this.update()},e.prototype.getCurValue=function(){return this.curs},e.prototype.getMaxValue=function(){return this.maxs},e.prototype.cal=function(e){var t=this.curs[e]/this.maxs[e];return{x:this.POSS[e].x*this.R*t+this.C.x,y:this.POSS[e].y*this.R*t+this.C.y}},e.prototype.update=function(){var o=this;this.shape.graphics.clear(),this.shape.graphics.beginFill(16769138,1),this.shape.graphics.lineStyle(1,16769138,1);var a=void 0;this.curs.forEach(function(e,t){var i=o.cal(t);0===t?(a=i,o.shape.graphics.moveTo(i.x,i.y)):o.shape.graphics.lineTo(i.x,i.y);var n=o.lbs[t];n&&(n.text=""+Utils.MathUtils.toDecimal(o.curs[t]/o.maxs[t]*100,1))}),this.shape.graphics.lineTo(a.x,a.y),this.shape.graphics.endFill()},e.prototype.setPkmCode=function(e){var t=game.Config.allHeroConfig()[e],i=JSON.parse(t.talentScore),n=[4,0,1,5,2,3],o={name:[],max:[]},a={},r=0;for(var s in n)o.name.push(""),o.max.push("100"),a[r++]=i[Number(s)];n.forEach(function(e,t){o.max.push("100"),a[t]=i[e]}),this.initView(o),this.updateCurs(a)},e}(eui.Component);e.RadarChart=t,__reflect(t.prototype,"customui.RadarChart",["eui.UIComponent","egret.DisplayObject"])}(customui||(customui={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.picList=["shzyj_icon_buming_png","shzyj_icon_shangren_png","shzyj_icon_baoxiang_png","shzyj_icon_yingdi_png","shzyj_icon_diren_png","shzyj_icon_jingying_png","shzyj_icon_toumu_png"],e.textList=["不明","商人","宝箱","营地","敌人","精英","头目"],e.skinName="DungeonEventShowPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateItem=function(e){this.lb_name.text=this.textList[e],this.img_event.source=this.picList[e],this.updateText(e)},e.prototype.updateText=function(e){var t=void 0,i=void 0,n=void 0,o=0;switch(e){case 0:n=VestageEventType.Unknown;break;case 1:n=VestageEventType.Shop;break;case 2:n=VestageEventType.Box;break;case 3:n=VestageEventType.Campsite;break;case 4:n=VestageEventType.Creep,o=VestageCreepType.Normal;break;case 5:n=VestageEventType.Creep,o=VestageCreepType.Elite;break;case 6:n=VestageEventType.Creep,o=VestageCreepType.Boss}if(n==VestageEventType.Creep){for(var a in i=game.Config.vestageEventDescConfigByCreep())if(i[a].eventSubType==o){t=i[a];break}}else for(var a in i=game.Config.vestageEventDescConfig())if(i[a].eventType==n){t=i[a];break}this.lb_desc.text=t.eventDesc},e}(eui.Component);e.DungeonEventShowPanel=t,__reflect(t.prototype,"customui.DungeonEventShowPanel")}(customui||(customui={})),function(l){var e=function(t){function e(){var e=t.call(this)||this;return e.dungeonProxy=l.AppFacade.getInstance().retrieveProxy(l.DungeonPy.N),e.dataprovider=new eui.ArrayCollection,e.chooseInfo=void 0,e.skinName="DungeonHeroUpPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(i.gp_name_0.visible){if(i.chooseInfo){var e=l.Config.vestageEventConfig()[i.dungeonEventPointObj.vo.eventId],t=JSON.parse(e.detail);i.dungeonEventPointObj.commonTriggerEvent(JSON.stringify({heroUuid:i.chooseInfo.uuid,eventId:t[1]}),function(e){DragonBoneTools.playOnce({effectName:"common_sxcg",parent:i.gp_effect,x:i.gp_effect.width/2,y:i.gp_effect.height/2,scaleX:1,scaleY:1,keep:!1,loop:!1,doneCB:function(){i.hide()}})})}}else Utils.MsgUtils.addMidMsg("请先选择需要升星的英雄")},this)},e.prototype.updateView=function(e){this.params=e,this.dungeonEventPointObj=e.dungeonEventPointObj;this.dungeonEventPointObj.vo;this.updateHeroInfo()},e.prototype.updateHeroInfo=function(){this.initModel(!1),this.updateAllHero()},e.prototype.updateAllHero=function(){this.scroller_hero.stopAnimation();var e=[],t=this.dungeonProxy.heroDict;if(t)for(var i in t){var n=t[i];e.push({type:EEntityType.EEntityTypeVestageHero,info:n,isChoose:!1,isLock:0==n.config.nextVestageCode,touchCB:this.touchHeroEvent.bind(this)})}0<e.length&&e.sort(function(e,t){var i=e.info,n=t.info,o=e.isLock;if(o!=t.isLock)return o?1:-1;if(i.starLevel!=n.starLevel)return n.starLevel-i.starLevel;if(i.level!=n.level)return n.level-i.level;var a=l.Config.allHeroConfig()[i.code],r=l.Config.allHeroConfig()[n.code];return a.race!=r.race?a.race-r.race:a.profession!=r.profession?HERO_SORT_ORDER[r.profession]-HERO_SORT_ORDER[a.profession]:i.code-n.code}),this.dataprovider=new eui.ArrayCollection(e),this.list_hero.itemRenderer=o,this.list_hero.dataProvider=this.dataprovider},e.prototype.touchHeroEvent=function(e,t){if(e.isChoose)this.initModel(!1);else for(var i in this.updateModel(e.info),this.dataprovider.source){var n=this.list_hero.getVirtualElementAt(Number(i)),o=this.dataprovider.getItemAt(Number(i));if(n&&n.img_bg&&n.img_bg.visible){n.img_bg.visible=!1;o.isChoose=!1;o.type!=EEntityType.EEntityTypeVestageHero||0<o.info.life?(o.isLock?(n.img_bg.visible=!0,n.img_bg.source="common_img_xiaosuo_png"):(n.img_bg.visible=o.isChoose,n.img_bg.visible&&(n.img_bg.source="common_img_gouxuan_png")),UIActionManager.setGrey(n.gp_bi,n.img_bg.visible)):UIActionManager.setAbsGrey(n.gp_bi,!0)}}t&&t()},e.prototype.updateModel=function(e){this.initModel(!0);var t=(this.chooseInfo=e).config;t.subType;this.lb_name_0.text=t.name,this.heroModel_0.update({model:t.model,isStatic:!0});var i=e.starLevel,n=l.GeneralConfig.getHeroStarInfo(i);if(this.gp_stars_0.removeChildren(),n.stage<4)for(var o=0;o<n.num;o++){var a=new eui.Image(n.src);this.gp_stars_0.addChild(a),a.scaleX=a.scaleY=.5}else this.gp_stars_0.addChild(new customui.HighStarLevelIcon({num:n.num,scale:.5}));var r=t.nextVestageCode,s=l.Config.allHeroConfig(!1)[r];this.lb_name_1.text=s.name,this.heroModel_1.update({model:s.model,isStatic:!0});var c=l.GeneralConfig.getHeroStarInfo(s.initStar);if(this.gp_stars_1.removeChildren(),c.stage<4)for(o=0;o<c.num;o++){a=new eui.Image(c.src);this.gp_stars_1.addChild(a),a.scaleX=a.scaleY=.5}else this.gp_stars_1.addChild(new customui.HighStarLevelIcon({num:c.num,scale:.5}))},e.prototype.initModel=function(e){this.gp_name_0.visible=e,this.gp_name_1.visible=e,this.heroModel_0.visible=e,this.heroModel_1.visible=e,this.img_add_0.visible=!e,this.img_add_1.visible=!e,this.gp_stars_0.removeChildren(),this.gp_stars_1.removeChildren(),e||(this.chooseInfo=void 0)},e}(BasePanel);l.DungeonHeroUpPanel=e,__reflect(e.prototype,"game.DungeonHeroUpPanel");var o=function(t){function e(){var e=t.call(this)||this;return e.isLive=!0,e.skinName="CommonTeamHeroItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.scaleX=this.baseItem.scaleY=.8,this.img_bg.scaleX=this.img_bg.scaleY=.6,this.gp_bi.addChild(this.baseItem),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.isLock?Utils.MsgUtils.addMidMsg("该英雄无法升星"):this.data.touchCB&&this.data.touchCB(this.data,this.changeIsUp.bind(this))},this)},e.prototype.dataChanged=function(){var e=this.data,t=0==e.info.dermaCode?void 0:l.Config.getHeroDermaConfig()[e.info.dermaCode].avatar;this.baseItem.updateData({uuid:this.data.info.uuid,type:this.data.type,effect:!1,isShowZhongZhu:!0,avatar:t}),this.isLive=0<e.info.life,this.isLive?(this.data.isLock?(this.img_bg.visible=!0,this.img_bg.source="common_img_xiaosuo_png"):(this.img_bg.visible=this.data.isChoose,this.img_bg.visible&&(this.img_bg.source="common_img_gouxuan_png")),UIActionManager.setGrey(this.gp_bi,this.img_bg.visible)):UIActionManager.setAbsGrey(this.gp_bi,!0)},e.prototype.changeIsUp=function(){this.img_bg.visible=!this.img_bg.visible,this.data.isChoose=!this.data.isChoose,this.isLive?(UIActionManager.setGrey(this.gp_bi,this.img_bg.visible),this.img_bg.visible&&(this.img_bg.source="common_img_gouxuan_png")):UIActionManager.setAbsGrey(this.gp_bi,!0)},e}(eui.ItemRenderer);__reflect(o.prototype,"CommonTeamHeroItem")}(game||(game={})),function(o){var e=function(t){function e(){var e=t.call(this)||this;return e.bookTimer=0,e.BOOK_CONTENT="传说远古时期大陆上一片混乱，\n正邪之间的斗争绵延整个大陆，\n一位人族老者曾留下一份手札。\n记录着大陆那黑暗时代的一切",e.proxy=o.GameMVC.dungeonPy,Utils.AssetsMgr.loadGroup("group_dungeon_main"),e.skinName="DungeonMainSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initEffect(),this.activateComponent()},e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_dungeon_main")},e.prototype.updateView=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.proxy.baseInfo.processStatus!==VestageProcessType.GetStartedBuff?[3,1]:(PopUpManager.addPopUp({obj:new o.DungeonRollDicePanel,clickDarkClose:!1}),[3,3]);case 1:return this.proxy.baseInfo.processStatus!==VestageProcessType.EnterMap?[3,3]:(this.proxy.buffInfo[0].iAmClean(),[4,this.mediator.flyBuff(this.proxy.buffInfo[0])]);case 2:e.sent(),this.playEnterEffect(function(){}),e.label=3;case 3:return this.lb_times.text=this.proxy.baseInfo.challengeTimes.toString(),[2]}})})},e.prototype.playEnterEffect=function(e){var t=this,i=this.gp_effect_elder.getChildAt(0);i.animation.play("shifa"),i.once(dragonBones.EgretEvent.LOOP_COMPLETE,function(){i.animation.play("daiji",0)},this);var n=this.gp_effect_book.getChildAt(0);n.animation.play("dakai",1),this.gp_root.horizontalCenter=this.gp_root.verticalCenter=void 0,egret.Tween.get(this.gp_root).to({scaleX:3.5,scaleY:3.5},1e3).wait(100).call(function(){t.bookContentWritten(function(){n.animation.play("daiji2",1),egret.Tween.get(t.lb_book).to({alpha:0},500),n.once(dragonBones.EgretEvent.LOOP_COMPLETE,function(){n.animation.play("daiji3",1),DragonBoneTools.playOnce({effectName:"common_shuzswb",parent:t.gp_effect_book,y:-620,doneCB:function(){o.MainJumpConfig.jumpTo(),o.MainJumpConfig.jumpTo(MODULE.Vestage,!1,{newChapter:!0})}})},t)})})},e.prototype.bookContentWritten=function(t){var i=this;this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.lb_book.text=i.BOOK_CONTENT},this),this.bookTimer=egret.setInterval(function(){var e=i.lb_book.text.length;i.BOOK_CONTENT[e]?i.lb_book.text+=i.BOOK_CONTENT[e]:(egret.clearInterval(i.bookTimer),egret.setTimeout(function(){t()},i,700))},this,100)},e.prototype.initEffect=function(){DragonBoneTools.playOnce({effectName:"common_shzyj_changtai",parent:this.gp_effect_enter,loop:!0}),DragonBoneTools.playOnce({effectName:"zhujiemian_lt_01",actionName:"daiji",parent:this.gp_effect_elder,loop:!0}),DragonBoneTools.playOnce({effectName:"zhujiemian_lt_02",actionName:"daiji",parent:this.gp_effect_book,loop:!0}),DragonBoneTools.playOnce({effectName:"zhujiemian_lt_03",actionName:"daiji",parent:this.gp_effect_table,loop:!0})},e.prototype.activateComponent=function(){var i=this;this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.MainJumpConfig.jumpTo()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new o.HelpDialog({moduleId:MODULE.Vestage})})},this),this.gp_effect_enter.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(0<i.proxy.baseInfo.challengeTimes){i.gp_effect_enter.touchEnabled=!1,i.btn_back.visible=!1,i.gp_challenge.visible=!1;var t=i.gp_effect_enter.getChildAt(0);DragonBoneTools.playOnce({effectName:"common_shzyj_dianji",parent:i.gp_effect_enter,loadFinishCB:function(){t.visible=!1},doneCB:function(){i.gp_effect_enter.visible=!1;var e=new o.DungeonChoosePanel;e.setUpdateParamsAfterCreated({isInit:!0}),PopUpManager.addPopUp({obj:e,clickDarkClose:!1}),t.visible=!0}})}else Utils.MsgUtils.addMidMsg("挑战次数不足")},this)},e}(BaseFull);o.DungeonMainView=e,__reflect(e.prototype,"game.DungeonMainView")}(game||(game={})),function(s){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=s.GameMVC.dungeonPy,e.RANDOM_SEED=0,e.needInit=!0,e.roomNum={},e.isOpen=!1,e.isCanOpen=!0,e.heroList=[],e.taopaoActName=["jinlai","daiji","taopao"],e.taopaoActNameCurIndex=0,e.minusMoneyEffectObj=void 0,e.dict2DungeonSBuffItem={},e.curItemShowed=[],e.skinName="DungeonMapSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top),Utils.DeviceUtils.setLiuHaiPingAdapter(this.scl_map),this.initHeroList(),this.proxy.baseInfo.records&&s.GameMVC.fightMed.showSubView(s.FightMediator.SV.DUNGEON_RESULT,{clickDarkClose:!1,info:{vestageRecords:this.proxy.baseInfo.records},doneCB:function(){}})},e.prototype.updateView=function(o){var a=this;(o&&o.newChapter||this.needInit)&&(this.resetMap(),this.initMapData(),this.once(egret.Event.ENTER_FRAME,function(){for(var e=Math.ceil(a.scl_map.viewport.contentHeight/1624);a.gp_bg.numChildren!=e;)a.gp_bg.addChild(new eui.Image("shzyj_img_zhiditu_png"));if(o&&o.newChapter)a.showChapterInfo();else{var t=a.scl_map.viewport.contentHeight-a.scl_map.height,i=a.proxy.mapInfo.curPointId;if(i){var n=a.mapNodeDatas[i].node;t=Math.min(Math.max(n.y-a.scl_map.height/2,0),a.scl_map.viewport.contentHeight-a.scl_map.height)}a.scl_map.viewport.scrollV=t,a.gp_bg.y=-a.scl_map.viewport.scrollV,a.arrangeVisible()}},this)),this.updateMap(),this.updateTopInfo(),this.updateBottom(),this.updateCamera()},e.prototype.initHeroList=function(){for(var e=0;e<6;e++){var t=new i;t.scaleX=t.scaleY=.75,this.gp_formation.addChild(t),this.heroList.push(t)}},e.prototype.updateTopInfo=function(){var n=this,e=this.proxy.mapInfo,t=s.Config.vestageMapConfig()[e.code];for(var i in this.lb_name.text=t.name,this.lb_money.text=this.proxy.itemInfo[160000001]||0,this.dict2DungeonSBuffItem)this.dict2DungeonSBuffItem[i].isExpire=!0;var o=void 0;for(var i in this.proxy.buffInfo.forEach(function(e){var t=e.code+"_"+e.dt,i=n.dict2DungeonSBuffItem[t];i?i.updateItem(e):(i=new a(e,n.skin_buffShow),n.gp_buff.addChild(i),n.dict2DungeonSBuffItem[t]=i),i.isExpire=!1,e.isDirty&&(o||(o=[]),o.push(e),e.iAmClean(),i.visible=!1)}),this.dict2DungeonSBuffItem)this.dict2DungeonSBuffItem[i].isExpire&&(this.dict2DungeonSBuffItem[i].parent.removeChild(this.dict2DungeonSBuffItem[i]),delete this.dict2DungeonSBuffItem[i]);o&&this.asyncflyBuff(o)},e.prototype.updateBottom=function(){this.updateHeroList();var e=s.Config.vestageItemConfig(),t=[];e:for(var i in this.proxy.itemInfo){var n=this.proxy.itemInfo[i];if(e[i].useType===VestageItemUseType.Direct)for(var o=0;o<n;o++)if(t.push(Number(i)),3===t.length)break e}t.sort(function(e,t){return e-t});for(o=0;o<3;o++){var a=this.gp_items.numChildren>o&&this.gp_items.getChildAt(o),r=t[o]&&{code:t[o]}||void 0;a?a.updateData(r):(a=new c(r),this.gp_items.addChild(a))}},e.prototype.updateMap=function(){var a=this;function r(e,t){e.numChildren&&(e.getChildAt(0).source!=t&&e.$children.forEach(function(e){e.source=t}))}var e=function(e){var n=t.mapNodeDatas[e],o=n.vo;n.node.updateData(n),n.to.forEach(function(e){var t=n.pathGp[e],i=a.mapNodeDatas[e];o.status!=VestagePointStatus.UnPassed&&i.vo.status!=VestagePointStatus.UnPassed?r(t,"shzyj_img_luxian1_png"):r(t,"shzyj_img_luxian2_png")})},t=this;for(var i in this.mapNodeDatas)e(i)},e.prototype.updateHeroList=function(){for(var e in this.heroList)this.heroList[e].initItem();var t=this.proxy.heroDict;for(var e in t)0!=t[e].pos&&this.heroList[t[e].pos-1].updateItem(t[e])},e.prototype.updateOneHeroEffect=function(e){this.heroList[e-1].rebornEffect()},e.prototype.updateRebornEffect=function(){DragonBoneTools.playOnce({effectName:"common_ty_fuhuochenggong",parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/2,scaleX:1,scaleY:1,keep:!1,loop:!1,doneCB:function(){}})},e.prototype.updateAddHpEffect=function(){DragonBoneTools.playOnce({effectName:"common_ty_shengmingyihuifu",parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/2,scaleX:1,scaleY:1,keep:!1,loop:!1,doneCB:function(){}}),this.updateHeroEffect()},e.prototype.updateHeroEffect=function(e){for(var t in this.heroList)this.heroList[t].img_add.visible||this.heroList[t].restEffect();e&&e.cb&&e.cb()},e.prototype.updateHpCost=function(e){this.lb_costHP.visible=!0,this.lb_costHP.text="生命 -"+e+"%",egret.Tween.get(this.lb_costHP).to({y:0},1e3).call(function(){this.lb_costHP.visible=!1,this.lb_costHP.y=150},this)},e.prototype.updateHpEffect=function(e){Utils.ShakeUtils.shakeObj(this.gp_root,.2,60,3);for(var t in this.heroList)this.heroList[t].img_add.visible||this.heroList[t].minusEffect();e&&e.cb&&e.cb()},e.prototype.addMoneyEffect=function(e){this.gp_effect.x=260,this.lb_money.scaleX=this.lb_money.scaleY=2,egret.Tween.get(this.lb_money).to({scaleX:1,scaleY:1},1e3).call(function(){},this),DragonBoneTools.playOnce({effectName:"common_jinbi",parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/2,scaleX:1,scaleY:1,keep:!1,loop:!1,doneCB:function(){e&&e.cb&&e.cb()}})},e.prototype.taoPaoCurActFinish=function(e,t){this.taopaoActNameCurIndex>=this.taopaoActName.length?(this.displayTaopao.parent.removeChild(this.displayTaopao),this.displayTaopao=void 0,GameRootLayer.gameLayer().switchTouchEnable(!0),this.minusMoneyEffectObj&&this.minusMoneyEffectObj.cb&&this.minusMoneyEffectObj.cb()):this.displayTaopao.animation.play(this.taopaoActName[this.taopaoActNameCurIndex++])},e.prototype.minusMoneyEffect=function(t){var i=this;this.displayTaopao&&this.displayTaopao.animation?(this.displayTaopao.visible=!0,egret.Tween.get(this.displayTaopao).call(this.taoPaoCurActFinish,this).to({x:GameRootLayer.gameLayer().popMsgLayer.width/2},500).call(this.taoPaoCurActFinish,this).wait(1250).call(this.taoPaoCurActFinish,this).to({x:GameRootLayer.gameLayer().popMsgLayer.width+100},300).call(this.taoPaoCurActFinish,this)):(GameRootLayer.gameLayer().switchTouchEnable(!1),this.taopaoActNameCurIndex=0,this.minusMoneyEffectObj=void 0,DragonBoneTools.createForHero("toujinbi_01",function(e){(i.displayTaopao=e).x=-100,e.y=i.gp_root.height/2+160,e.scaleX=e.scaleY=1.2,i.gp_root.addChild(i.displayTaopao),i.minusMoneyEffectObj=t,i.minusMoneyEffect()}))},e.prototype.updateCamera=function(){var e=this.proxy.mapInfo.curPointId;if(e){this.scl_map.validateNow();var t=this.mapNodeDatas[e].node,i=Math.min(Math.max(t.y-this.scl_map.height/2,0),this.scl_map.viewport.contentHeight-this.scl_map.height);i<this.scl_map.viewport.scrollV&&egret.Tween.get(this.scl_map.viewport,{onChange:this.syncBgPos,onChangeObj:this}).to({scrollV:i},300)}},e.prototype.initMapData=function(){var n=this,e=this.proxy.mapInfo;for(var t in e.points){var i=e.points[t],o={vo:i,allDatas:this.mapNodeDatas,x:i.id-100*i.depth,y:i.depth,node:void 0,from:[],to:[],pathGp:{}};(!this.roomNum[o.y]||this.roomNum[o.y]<o.x)&&(this.roomNum[o.y]=o.x),this.mapNodeDatas[i.id]=o}e.edges.forEach(function(e){var t=e.from,i=e.to;n.mapNodeDatas[t].to.push(i),n.mapNodeDatas[i].from.push(t)}),this.RANDOM_SEED=e.genDt,this.initNode(),this.initPath(),this.needInit=!1},e.prototype.initNode=function(){for(var e in this.mapNodeDatas){var t=this.mapNodeDatas[e],i=s.DungeonEventFactory.create(t);this.gp_node.addChild(i),t.node=i,this.setNodePos(t)}},e.prototype.initPath=function(){var c=this,l=new Vector2D,e=function(e){var r=t.mapNodeDatas[e],s=r.node;r.to.forEach(function(e){var t=c.mapNodeDatas[e].node;l.x=t.x-s.x,l.y=t.y-s.y;var i=l.length,n=new eui.Group;n.x=s.x,n.y=s.y,n.width=0,n.rotation=180*l.angle/Math.PI-90,n.touchEnabled=n.touchChildren=!1,n.cacheAsBitmap=!1;for(var o=50;o<i-35;){var a=new eui.Image("shzyj_img_luxian2_png");a.anchorOffsetX=10,a.anchorOffsetY=10,a.x=Utils.MathUtils.getRandomInt(-DUNGEON_CONST.PATH_DOT_OFFSET_H,DUNGEON_CONST.PATH_DOT_OFFSET_H,c.RANDOM_SEED+r.vo.id+o),a.y=o,o+=20+DUNGEON_CONST.PATH_DOT_GAP+Utils.MathUtils.getRandomInt(-DUNGEON_CONST.PATH_DOT_OFFSET_V,DUNGEON_CONST.PATH_DOT_OFFSET_V,c.RANDOM_SEED+o),n.addChild(a)}r.pathGp[e]=n,c.gp_route.addChild(n)})},t=this;for(var i in this.mapNodeDatas)e(i)},e.prototype.setNodePos=function(e){var t=e.node,i=e.y,n=e.x;1===i?(t.x=360,t.y=0):(t.x=n*(600/this.roomNum[i])+Utils.MathUtils.getRandomInt(-DUNGEON_CONST.NODE_OFFSET_H,DUNGEON_CONST.NODE_OFFSET_H,i+n+this.RANDOM_SEED),t.y=(i-1)*DUNGEON_CONST.NODE_GAP_V+Utils.MathUtils.getRandomInt(-DUNGEON_CONST.NODE_OFFSET_V,DUNGEON_CONST.NODE_OFFSET_V,i-n+this.RANDOM_SEED))},e.prototype.arrangeVisible=function(){},e.prototype.showChapterInfo=function(){var e=this;GameRootLayer.gameLayer().switchTouchEnable(!1);var t=this.proxy.mapInfo,i=new eui.Group,n=new eui.VerticalLayout;n.horizontalAlign=egret.HorizontalAlign.CENTER,i.layout=n;var o=new eui.BitmapLabel;o.font="deep_nest_fnt",o.text="第"+Utils.MathUtils.formatNumToCharacter(t.code)+"章",i.addChild(o);var a=new eui.BitmapLabel;a.font="dungeon_name_fnt",a.text=s.Config.vestageMapConfig()[t.code].name,i.addChild(a),i.horizontalCenter=0,i.y=250,this.gp_root.addChild(i),i.alpha=0,egret.Tween.get(i).to({alpha:1},300).wait(1500).call(function(){egret.Tween.get(e.scl_map.viewport,{onChange:e.syncBgPos,onChangeObj:e}).to({scrollV:e.scl_map.viewport.contentHeight-e.scl_map.height},2e3).call(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)})}).to({alpha:0},300).call(function(){i.parent&&i.parent.removeChild(i)})},e.prototype.resetMap=function(){this.gp_node.removeChildren(),this.gp_route.removeChildren(),this.mapNodeDatas={}},e.prototype.syncBgPos=function(){this.gp_bg.y=-this.scl_map.viewport.scrollV},e.prototype.activateComponent=function(){var t=this;this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.MainJumpConfig.jumpTo()},this),this.scl_map.addEventListener(egret.Event.CHANGE,function(e){t.syncBgPos(),t.arrangeVisible()},this),this.btn_edit.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.AppFacade.getInstance().showSubView(s.DungeonMed.N,s.DungeonMed.SV.CHOOSE,{isInit:!1})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new s.HelpDialog({moduleId:MODULE.Vestage})})},this),this.btn_afresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=new Array;e.push({text:"确定进行重置本次幻境挑战吗？",style:{size:24}}),e.push({text:"\n（进行重置时，将把本次挑战所获得的遗物、金币、药，以及英雄全部重置。）",style:{size:24}}),s.GameMgr.getInstance().showCommonTipsWin({commonTips:e,source:"dungeon_restart",cb:!0,clickCB:function(e){1==e.type&&t.proxy.Restart(!0,function(){t.hide(),Number(s.MainJumpConfig.getCurEvent())==MODULE.Vestage?s.GameMVC.dungeonPy.GetVestageMapInfo(function(){s.GameMVC.dungeonMed.showSubView(s.DungeonMed.SV.MAIN)}):s.MainJumpConfig.jumpTo(MODULE.Vestage)})}})},this),this.gp_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.AppFacade.getInstance().showSubView(s.DungeonMed.N,s.DungeonMed.SV.CHOOSE,{isInit:!1})},this),this.gp_open.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.isCanOpen){t.isCanOpen=!1;var e=t.isOpen?-150:0;egret.Tween.get(t.gp_legend).to({x:e},300).call(function(){this.isCanOpen=!0,this.isOpen=!this.isOpen,this.img_open.scaleX=this.isOpen?.5:-.5},t)}},this);for(var e=function(e){i["gp_"+e].addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.skin_eventShow.visible=!0,t.skin_eventShow.updateItem(e)},i),i["gp_"+e].addEventListener(egret.TouchEvent.TOUCH_END,function(){t.skin_eventShow.visible=!1},i),i["gp_"+e].addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){t.skin_eventShow.visible=!1},i),i["gp_"+e].addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.skin_eventShow.visible=!1},i)},i=this,n=0;n<7;n++)e(n)},e.prototype.asyncflyBuff=function(a){return __awaiter(this,void 0,void 0,function(){var t,i,n,o;return __generator(this,function(e){switch(e.label){case 0:t=0,i=a,e.label=1;case 1:return t<i.length?(n=i[t],[4,this.mediator.flyBuff(n)]):[3,4];case 2:e.sent(),o=n.code+"_"+n.dt,this.dict2DungeonSBuffItem[o]&&this.dict2DungeonSBuffItem[o].appear(),e.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},e}(BaseFull);s.DungeonMapView=e,__reflect(e.prototype,"game.DungeonMapView");var i=function(t){function e(){var e=t.call(this)||this;return e.data=void 0,e.skinName="DungeonHeroItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.baseItem.scaleX=this.baseItem.scaleY=1,this.gp_base.addChild(this.baseItem)},e.prototype.initItem=function(){this.baseItem.resetFixedStyle(EEntityType.EEntityTypeHero),this.img_hp.width=0,this.gp_hp.visible=!1,this.img_add.visible=!0,UIActionManager.setAbsGrey(this.gp_root,!1)},e.prototype.updateItem=function(e){this.data=e,this.img_add.visible=!1;var t=0==e.dermaCode?void 0:s.Config.getHeroDermaConfig()[e.dermaCode].avatar;this.baseItem.updateData({uuid:e.uuid,type:EEntityType.EEntityTypeVestageHero,effect:!1,isShowZhongZhu:!0,avatar:t}),this.gp_hp.visible=!0,this.img_hp.width=Math.ceil(e.life/e.maxLife*120),this.img_anger.width=Math.ceil(e.anger/e.maxAnger*120),UIActionManager.setAbsGrey(this.gp_root,e.life<=0)},e.prototype.rebornEffect=function(){DragonBoneTools.playOnce({effectName:"common_huijushengji_1",parent:this.gp_base,x:this.gp_base.width/2,y:this.gp_base.height/2,scaleX:1.2,scaleY:1.2,keep:!1,loop:!1,doneCB:function(){}})},e.prototype.restEffect=function(){0<this.data.life&&DragonBoneTools.playOnce({effectName:"common_huijushengji_1",parent:this.gp_base,x:this.gp_base.width/2,y:this.gp_base.height/2,scaleX:1.2,scaleY:1.2,keep:!1,loop:!1,doneCB:function(){}})},e.prototype.minusEffect=function(){0<this.data.life&&DragonBoneTools.playOnce({effectName:"skill_dk_100001",parent:this.gp_base,x:10+this.gp_base.width/2,y:30+this.gp_base.height/2,scaleX:.8,scaleY:.8,keep:!1,loop:!1,doneCB:function(){}})},e}(eui.Component);s.DungeonHeroItem=i,__reflect(i.prototype,"game.DungeonHeroItem");var c=function(i){function e(e){var t=i.call(this)||this;return t.data=e,t}return __extends(e,i),e.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.gp_root=new eui.Group,this.gp_root.width=this.gp_root.height=0,this.img_bg=new eui.Image("_main_m_json.maoxian_img_quandi2"),this.img_bg.horizontalCenter=this.img_bg.verticalCenter=0,this.gp_root.addChild(this.img_bg),this.img_icon=new eui.Image("shzyj_icon_yaoshui0_png"),this.img_icon.horizontalCenter=this.img_icon.verticalCenter=0,this.gp_root.addChild(this.img_icon),this.blb_name=new eui.BitmapLabel,this.blb_name.font="white_num_fnt",this.blb_name.horizontalCenter=0,this.blb_name.verticalCenter=30,this.gp_root.addChild(this.blb_name),this.addChild(this.gp_root)},e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.data&&this.updateData(this.data),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data&&PopUpManager.addPopUp({obj:new s.BaseItemDetailView({code:e.data.code,type:EEntityType.EEntityTypeVestageItem,source:BASEITEM_SOURCE.BACKPACK})})},this)},e.prototype.updateData=function(e){var t=!(this.data||!e);if(this.data=e,this.data){var i=this.data.code,n=s.Config.vestageItemConfig()[i];this.img_icon.source=n.icon+"_png",this.blb_name.text=n.name,t&&this.playObtainEffect()}else this.img_icon.source="shzyj_icon_yaoshui0_png",this.blb_name.text=""},e.prototype.playObtainEffect=function(){this.img_icon.alpha=10,this.img_icon.scaleX=this.img_icon.scaleY=2,egret.Tween.get(this.img_icon).to({scaleX:1,scaleY:1,alpha:1},250)},e}(eui.Component);__reflect(c.prototype,"DungeonItem");var a=function(n){function e(e,t){var i=n.call(this)||this;return i.data=e,i.skin_buffShow=t,i}return __extends(e,n),e.prototype.childrenCreated=function(){var i=this;n.prototype.childrenCreated.call(this),this.img_icon=new eui.Image,this.img_icon.scaleX=this.img_icon.scaleY=.7,this.blb_count=new eui.BitmapLabel,this.blb_count.horizontalCenter=0,this.blb_count.bottom=0,this.blb_count.font="white_num_fnt",this.addChild(this.img_icon),this.addChild(this.blb_count),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){if(i.data){var e=i.parent.localToGlobal(i.x,i.y),t=i.skin_buffShow.parent.globalToLocal(e.x,e.y);i.skin_buffShow.x=Math.min(t.x,Utils.DeviceUtils.curWidth()-i.skin_buffShow.width-10),i.skin_buffShow.y=t.y+10+i.height,i.skin_buffShow.visible=!0,i.skin_buffShow.updateItem(i.data)}},this),this.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skin_buffShow.visible=!1},this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skin_buffShow.visible=!1},this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skin_buffShow.visible=!1},this),this.updateItem()},e.prototype.updateItem=function(e){e&&(this.data=e),0<this.data.count?(this.blb_count.text=this.data.count.toString(),this.blb_count.visible=!0):this.blb_count.visible=!1;var t=s.Config.vestageItemConfig()[this.data.code];t&&(this.img_icon.source=ResourceUtils.png(t.icon))},e.prototype.appear=function(){this.visible=!0},e}(eui.Component);__reflect(a.prototype,"DungeonSBuffItem")}(game||(game={})),function(h){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=h.GameMVC.dungeonPy,e.skinName="DungeonRandomEventPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.commonDaTanKuang.blb_title.text="不明事件",this.commonDaTanKuang.img_close.visible=!1},e.prototype.updateView=function(e){this.proxy.mapInfo;this.params=e,this.dungeonEventPointObj=e.dungeonEventPointObj;var t=this.dungeonEventPointObj.vo,i=h.Config.vestageEventConfig()[t.eventId],n=JSON.parse(i.detail),o=h.Config.vestageQuestionConfig()[n[0]];this.lb_desc.text=o.question,this.img_di.source=o.img+"_png";JSON.parse(o.choices);for(var a=JSON.parse(o.desc),r=JSON.parse(o.costs),s=t.eventInfo.result,c=0;c<a.length;c++){var l=new p;l.updateEvent({dungeonEventPointObj:this.dungeonEventPointObj,chooseNum:c+1,text:a[c],cost:r[c],result:s[c],cb:this.hide.bind(this)}),this.gp_event.addChild(l)}},e}(BasePanel);h.DungeonRandomEventPanel=e,__reflect(e.prototype,"game.DungeonRandomEventPanel");var p=function(t){function e(){var e=t.call(this)||this;return e.info=void 0,e.isEnough=!0,e.skinName="DungeonRandomEventItemSkin",e.gp_root.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.gp_root.scaleX=e.gp_root.scaleY=.9},e),e.gp_root.addEventListener(egret.TouchEvent.TOUCH_END,function(){e.gp_root.scaleX=e.gp_root.scaleY=1,e.isEnough?e.touchEvent():Utils.MsgUtils.addMidMsg("货币不足")},e),e.gp_root.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){e.gp_root.scaleX=e.gp_root.scaleY=1},e),e.gp_root.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){e.gp_root.scaleX=e.gp_root.scaleY=1},e),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateEvent=function(e){this.info=e,this.dungeonEventPointObj=e.dungeonEventPointObj,this.lb_text.text=e.text,e.cost&&e.cost[0]&&0<e.cost[0].length?this.isEnough=h.GameMVC.backpackPy.checkEnough(e.cost,!1):this.isEnough=!0,UIActionManager.setAbsGrey(this.gp_root,!this.isEnough)},e.prototype.touchEvent=function(){var i=this;this.info.cb&&this.info.cb(),this.dungeonEventPointObj.commonTriggerEvent(JSON.stringify({optionNum:this.info.chooseNum}),function(e){var t=h.Config.vestageResultConfig()[i.info.result];i.showEventEffect(t.subType,e)},!0)},e.prototype.showEventEffect=function(e,t){var i=this,n={cb:function(){h.AppFacade.getInstance().showSubView(h.DungeonMed.N,h.DungeonMed.SV.RANDOM_RESULT,{dungeonEventPointObj:i.dungeonEventPointObj,result:i.info.result,ret:t})}};switch(e){case VestageResultSubType.None:n.cb();break;case VestageResultSubType.AddLife:h.AppFacade.getInstance().sendNotification(CN.DUNGEON_RANDOM_EVENT_ADDLIFE,n);break;case VestageResultSubType.MinusLife:h.AppFacade.getInstance().sendNotification(CN.DUNGEON_RANDOM_EVENT_MINUSLIFE,n);break;case VestageResultSubType.MinusGold:h.AppFacade.getInstance().sendNotification(CN.DUNGEON_RANDOM_EVENT_MINUSGOLD,n);break;case VestageResultSubType.GetHero:case VestageResultSubType.GetBuff:case VestageResultSubType.GetPotion:n.cb();break;case VestageResultSubType.GetGold:h.AppFacade.getInstance().sendNotification(CN.DUNGEON_RANDOM_EVENT_ADDGOLD,n)}},e}(eui.Component);h.DungeonRandomEventItem=p,__reflect(p.prototype,"game.DungeonRandomEventItem")}(game||(game={})),function(r){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=r.GameMVC.dungeonPy,e.resultConfig=void 0,e.skinName="DungeonRandomResultPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.eventByType()},this)},e.prototype.updateView=function(e){this.proxy.mapInfo;this.params=e,this.dungeonEventPointObj=e.dungeonEventPointObj;this.dungeonEventPointObj.vo;this.resultConfig=r.Config.vestageResultConfig()[e.result],this.lb_desc.text=this.resultConfig.desc;var t=[],i=void 0;for(var n in e&&e.ret&&e.ret.clientReward&&(i=e.ret.clientReward),i)for(var o in i[n])i[n][o]&&t.push(i[n][o]);switch(this.resultConfig.type){case VestageChoiceType.Empty:this.gp_reward.removeChildren();break;case VestageChoiceType.Cost:break;case VestageChoiceType.Reward:for(var n in this.gp_reward.removeChildren(),t){var a=customui.BaseItemFactory.create();a.scaleX=a.scaleY=.75,a.updateData({id:t[n].code,num:t[n].num,type:t[n].type}),this.gp_reward.addChild(a)}break;case VestageChoiceType.Event:}},e.prototype.eventByType=function(){switch(this.resultConfig.type){case VestageChoiceType.Empty:case VestageChoiceType.Cost:case VestageChoiceType.Reward:break;case VestageChoiceType.Event:this.showRandonPanel(this.dungeonEventPointObj.vo.fadeType)}this.hide()},e.prototype.showRandonPanel=function(e){switch(e){case VestageEventType.Creep:var t=this.dungeonEventPointObj.vo;r.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeVestage,pb1:"vestage",pb2:"TriggerEvent",params:{mapCode:r.GameMVC.dungeonPy.mapInfo.code,pointId:t.id},doneCB:function(e){e.cbRet&&(r.GameMVC.dungeonPy.updateMapInfo(e.cbRet.map),r.GameMVC.dungeonPy.updateBaseInfo(e.cbRet.base)),r.AppFacade.getInstance().retrieveProxy(r.FightPy.N).queueExceExitCB()}});break;case VestageEventType.Shop:PopUpManager.addPopUp({obj:new r.DEPShopUI({dungeonEventPointObj:this.dungeonEventPointObj}),closeCB:function(e){}});break;case VestageEventType.Box:r.AppFacade.getInstance().showSubView(r.DungeonMed.N,r.DungeonMed.SV.BOX_EVENT,{dungeonEventPointObj:this.dungeonEventPointObj,clickDarkClose:!1});break;case VestageEventType.Campsite:r.AppFacade.getInstance().showSubView(r.DungeonMed.N,r.DungeonMed.SV.CAMP,{dungeonEventPointObj:this.dungeonEventPointObj,clickDarkClose:!1});break;case VestageEventType.CureLife:break;case VestageEventType.UpHeroStar:r.AppFacade.getInstance().showSubView(r.DungeonMed.N,r.DungeonMed.SV.HERO_UP,{dungeonEventPointObj:this.dungeonEventPointObj,clickDarkClose:!1})}},e}(BasePanel);r.DungeonRandomResultPanel=e,__reflect(e.prototype,"game.DungeonRandomResultPanel")}(game||(game={})),function(o){var e=function(i){function e(e){var t=i.call(this)||this;return t.TIPS=[{name:"完成不明事件",type:VestageEventType.Unknown,subType:void 0},{name:"击杀普通怪物",type:VestageEventType.Creep,subType:VestageCreepType.Normal},{name:"击杀精英怪物",type:VestageEventType.Creep,subType:VestageCreepType.Elite},{name:"进入营地",type:VestageEventType.Campsite,subType:void 0},{name:"遇见商人",type:VestageEventType.Shop,subType:void 0},{name:"打败Boss",type:VestageEventType.Creep,subType:VestageCreepType.Boss},{name:"分数",type:void 0,subType:void 0}],t.skinName="DungeonResultPanelSkin",t.touchEnabled=!1,t}return __extends(e,i),e.prototype.perClose=function(){this.params&&this.params.doneCB&&this.params.doneCB()},e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_ok,egret.TouchEvent.TOUCH_TAP,function(){o.GameMVC.dungeonPy.Restart(!1,function(){e.hide(),Number(o.MainJumpConfig.getCurEvent())==MODULE.Vestage?o.GameMVC.dungeonPy.GetVestageMapInfo(function(){o.GameMVC.dungeonMed.showSubView(o.DungeonMed.SV.MAIN)}):o.MainJumpConfig.jumpTo(MODULE.Vestage)})},this)},e.prototype.updateView=function(e,t){var l=this;void 0===t&&(t=!1),this.params=e;var i=this.params.info,n="common_zhanbai_21";i.result==EBattleResult.EBattleResultWin||o.GameMVC.dungeonPy.baseInfo.isCompleted?(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shengli),n="common_shengli_21",i.clientReward&&(this.btn_ok.bottom=-149,o.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,i.clientReward))):Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shibai),DragonBoneTools.create(n,function(e){e.x=this.gp_bg.width/2,e.y=this.gp_bg.height/2-107,e.animation.play(),this.gp_bg.addChild(e)},this);var h=JSON.parse(i.vestageRecords),p=0;this.TIPS.forEach(function(e,t){var i=new eui.Group;i.percentWidth=100;var n=new eui.Label;n.size=24,n.bold=!0,n.stroke=2,n.text=e.name,n.verticalCenter=0;var o=new eui.BitmapLabel;if(o.font="green_num_fnt",o.text="0",o.right=0,o.verticalCenter=0,i.addChild(n),i.addChild(o),i.y+=40*t,l.gp_tips.addChild(i),i.alpha=0,egret.setTimeout(function(){UIActionManager.fadeIn(i,100)},l,250*t),t==l.TIPS.length-1){var a=new eui.Image;a.source="shzyj_img_fengexian_png",a.horizontalCenter=0,a.y=i.y,l.gp_tips.addChild(a),i.y+=20,n.size=26,n.bold=!0,n.text="总分数",o.scaleX=o.scaleY=1.05,o.text=p.toString()}else for(var r=0,s=h;r<s.length;r++){var c=s[r];c.eventType==e.type&&(c.eventSubType&&c.eventSubType!=e.subType||(o.text=c.times,p+=Number(c.times)))}})},e}(BasePanel);o.DungeonResultPanel=e,__reflect(e.prototype,"game.DungeonResultPanel")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=i.GameMVC.dungeonPy,e.skinName="DungeonRollDiceSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),DragonBoneTools.playOnce({effectName:"zhujiemian_lt_01",parent:this.gp_laotou,actionName:"daiji",loop:!0,x:this.gp_laotou.width/2,y:this.gp_laotou.height});var e=new customui.RoleDynamicModel({vo:i.GameMVC.playerPy.playerInfoVO});e.scaleX=e.scaleY=1/.55,e.onArmatureLoadCB=function(){e.onChangingDir(1)},this.gp_role.addChild(e),DragonBoneTools.playOnce({effectName:"common_shyjg",parent:this.gp_diceEffect,loop:!0}),egret.Tween.get(this.img_dice,{loop:!0}).to({y:270},1e3).to({y:310},1e3),egret.Tween.get(this.img_shadow,{loop:!0}).to({scaleX:.8,scaleY:.8},1e3).to({scaleX:1,scaleY:1},1e3),this.activateComponent()},e.prototype.updateView=function(e){},e.prototype.activateComponent=function(){var t=this;this.img_dice.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.proxy.GetStartedBuff(function(e){t.hide(),i.GameMVC.commonMed.commonRollDice(JSON.parse(e.key).diceNum,function(){i.AppFacade.getInstance().updateView(i.DungeonMed.N,i.DungeonMed.SV.MAIN)})})},this)},e}(BasePanel);i.DungeonRollDicePanel=e,__reflect(e.prototype,"game.DungeonRollDicePanel")}(game||(game={})),function(i){var e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.updateData=function(e){t.prototype.updateData.call(this,e);this.data.vo;this.btn_icon.icon="shzyj_icon_baoxiang_png"},e.prototype.onEnter=function(){3<=i.GameMVC.dungeonPy.getPotionNum()?Utils.MsgUtils.addMidMsg("药水栏已满，无法领取奖励"):i.AppFacade.getInstance().showSubView(i.DungeonMed.N,i.DungeonMed.SV.BOX_EVENT,{dungeonEventPointObj:this})},e}(i.DungeonEventPoint);i.DEPBox=e,__reflect(e.prototype,"game.DEPBox")}(game||(game={})),function(i){var e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.updateData=function(e){t.prototype.updateData.call(this,e);this.data.vo;this.btn_icon.icon="shzyj_icon_yingdi_png"},e.prototype.onEnter=function(){i.AppFacade.getInstance().showSubView(i.DungeonMed.N,i.DungeonMed.SV.CAMP,{dungeonEventPointObj:this})},e}(i.DungeonEventPoint);i.DEPCampsite=e,__reflect(e.prototype,"game.DEPCampsite")}(game||(game={})),function(o){var e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.updateData=function(e){switch(t.prototype.updateData.call(this,e),this.data.vo.eventSubType){case VestageCreepType.Normal:this.btn_icon.icon="shzyj_icon_diren_png";break;case VestageCreepType.Elite:this.btn_icon.icon="shzyj_icon_jingying_png";break;case VestageCreepType.Boss:this.btn_icon.icon="shzyj_icon_toumu_png"}},e.prototype.onEnter=function(){if(this.data){var n=this.data.vo;o.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeVestage,pb1:"vestage",pb2:"TriggerEvent",params:{mapCode:o.GameMVC.dungeonPy.mapInfo.code,pointId:n.id},doneCB:function(e){if(e.cbRet){var t=o.GameMVC.dungeonPy.mapInfo.code,i=e.cbRet.map.code;o.GameMVC.dungeonPy.updateMapInfo(e.cbRet.map),o.GameMVC.dungeonPy.updateBaseInfo(e.cbRet.base),n.eventSubType===VestageCreepType.Boss&&e.result===EBattleResult.EBattleResultWin&&o.AppFacade.getInstance().sendNotification(CN.DUNGEON_BOSS_CLEAR),t!=i&&o.AppFacade.getInstance().sendNotification(CN.DUNGEON_NEW_CHAPTER)}o.AppFacade.getInstance().retrieveProxy(o.FightPy.N).queueExceExitCB()}})}else egret.error("onEnter 事件data为空")},e}(o.DungeonEventPoint);o.DEPCreep=e,__reflect(e.prototype,"game.DEPCreep")}(game||(game={})),function(f){var e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.updateData=function(e){t.prototype.updateData.call(this,e);this.data.vo;this.btn_icon.icon="shzyj_icon_shangren_png"},e.prototype.onEnter=function(){PopUpManager.addPopUp({obj:new i({dungeonEventPointObj:this}),closeCB:function(e){}})},e}(f.DungeonEventPoint);f.DEPShop=e,__reflect(e.prototype,"game.DEPShop");var i=function(i){function e(e){var t=i.call(this)||this;return t.moneyType=[],t.pageNumber=0,t.skinName="ShopSkin",t.shopProxy=f.AppFacade.getInstance().retrieveProxy(f.ShopPy.N),t.dungeonEventPointObj=e.dungeonEventPointObj,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cur_resource),this.bm_title.text="商店",this.initUI(),this.gp_time.visible=!1,this.btn_refresh.visible=!1,this.updateView()},e.prototype.initUI=function(){var e=this;UIActionManager.hideScrollerBar(this.pageScroller),this.btn_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.pageScroller.scrollToNext(function(){e.updatePageBtnStatus()})},this),this.btn_last.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.pageScroller.scrollToLast(function(){e.updatePageBtnStatus()})},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.pageScroller.curPage=0,this.heroModel.update(f.ShopUI.HERODATA),this.initList()},e.prototype.initList=function(){this.list_item.itemRenderer=f.ShopPageItem,this.collection_list=new eui.ArrayCollection,this.list_item.dataProvider=this.collection_list},e.prototype.updateResourceBar=function(){this.cur_resource.updateBar({costs:this.moneyType,width:190,needAdd:!0})},e.prototype.updateView=function(){var e=this;this.updateList(),this.pageScroller.curPage>this.collection_list.source.length-1?this.pageScroller.scrollToLast(function(){e.updatePageBtnStatus()}):this.updatePageBtnStatus(),this.updateResourceBar()},e.prototype.updatePageBtnStatus=function(){this.btn_last.visible=0!=this.pageScroller.curPage,this.btn_next.visible=this.pageScroller.curPage!=this.pageNumber-1},e.prototype.updateList=function(){var c=this,e=this.dungeonEventPointObj.vo.eventInfo.buyRecords,t=[];e.forEach(function(e){t.push({c:f.Config.shop()[e[0]],buyNum:e[1]})}),t.length||(this.gp_empty.visible=!0),this.pageNumber=Math.ceil(t.length/9)||1;for(var l=void 0,i=0,n=f.GameMVC.dungeonPy.buffInfo;i<n.length;i++){var o=n[i],a=f.Config.vestageItemConfig()[o.code];if(a&&a.type==VestagePropType.StoreBuff){l=JSON.parse(a.effect)[0];break}}var r=[],h=new Array;t.forEach(function(o){var t=JSON.parse(o.c.costs)[0];l?(o.c.wholeLifeDiscountReview=l,o.c.wholeLifeDiscountDisplay=1,o.c.wholeLifeCosts=JSON.stringify([[t[0],t[1],t[2]*l/100]]),o.c.countFun=function(e){return{unit:1,total:e*t[2]*l/100}}):(o.c.wholeLifeDiscountReview=0,o.c.wholeLifeDiscountDisplay=0,o.c.wholeLifeCosts=JSON.stringify([[t[0],t[1],t[2]]]),o.c.countFun=void 0);var e=o.buyNum,i=c.shopProxy.getMaxNum(o.c.id),a=i-e,n={hasWholeLifeCard:!!l,isFull:e<i,data:o.c,buyNum:o.buyNum,grid:o.c.grid,type:2,buyFunc:function(){if(a<=0)Utils.MsgUtils.addMidMsg("该商品已无购买次数");else{var e=f.GameMVC.dungeonPy.getPotionNum(),t=JSON.parse(o.c.reward)[0][1],i=f.Config.vestageItemConfig()[t];if(i&&i.useType===VestageItemUseType.Direct&&3<=e)Utils.MsgUtils.addMidMsg("药水栏已满，无法领取奖励");else{var n=JSON.parse(o.c.costs)[0];f.GameMVC.backpackPy.checkEnough([[n[0],n[1],n[2]*(l||100)/100]],!0)&&c.dungeonEventPointObj.commonTriggerEvent(JSON.stringify({shopId:o.c.id,num:1}),function(){c.updateView()})}}}};h.push(n);var r=JSON.parse(o.c.costs);if(r&&r.length){var s=!0;c.moneyType.forEach(function(e){e[0]==r[0][0]&&e[1]==r[0][1]&&(s=!1)}),s&&c.moneyType.push([r[0][0],r[0][1]])}}),h.sort(function(e,t){return e.isFull==t.isFull?e.data.displayPriority===t.data.displayPriority?e.data.id-t.data.id:e.data.displayPriority-t.data.displayPriority:e.isFull?-1:1});for(var s=1,p=[],d=0,u=h;d<u.length;d++){var g=u[d];p.push(g),s%9==0?(r.push({list_items:p}),p=[]):s>=h.length&&r.push({list_items:p}),++s}this.collection_list.replaceAll(r)},e.prototype.perClose=function(){},e.HERODATA={code:41100065,modell:"hero_065_03",isStatic:!0},e}(BasePanel);f.DEPShopUI=i,__reflect(i.prototype,"game.DEPShopUI")}(game||(game={})),function(a){var e=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.updateData=function(e){t.prototype.updateData.call(this,e);this.data.vo;this.btn_icon.icon="shzyj_icon_buming_png"},e.prototype.onEnter=function(){var e=this.vo.eventInfo;if(e.actualEventId){var t=void 0,i=this.vo.eventInfo.result;for(var n in i){var o=a.Config.vestageResultConfig()[i[n]];if(JSON.parse(o.detail)[0]==e.actualEventId){t=i[n];break}}null!=t&&a.AppFacade.getInstance().showSubView(a.DungeonMed.N,a.DungeonMed.SV.RANDOM_RESULT,{dungeonEventPointObj:this,result:t})}else a.AppFacade.getInstance().showSubView(a.DungeonMed.N,a.DungeonMed.SV.RANDOM_EVENT,{dungeonEventPointObj:this})},e}(a.DungeonEventPoint);a.DEPUnknown=e,__reflect(e.prototype,"game.DEPUnknown")}(game||(game={})),function(c){var e=function(t){function i(){var e=t.call(this)||this;return e.skinName="ZzqAchievementSkin",e.proxy=c.AppFacade.getInstance().retrieveProxy(c.ZzqPy.N),e.playerProxy=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N),e}return __extends(i,t),i.prototype.updateView=function(e){e&&(this.playerInfo=e.info),this.lb_level.text=this.playerInfo.level;var t=0==this.playerInfo.level?1:this.playerInfo.level,i=c.Config.chessAchieveLevelList().length-1,n=this.playerInfo.exp,o=c.Config.chessAchieveLevel()[t].exp;t==i&&o<n&&(n=o),this.img_jindu.width=Math.floor(n/o*205),this.lb_jindu.text=n+"/"+o,this.updateRewardInfo(),this.updateNowCup()},i.prototype.updateNowCup=function(){var e=c.Config.chessAchieveTask(),t=c.Config.chessAchieveTaskList().length;0==this.playerInfo.taskCode?(UIActionManager.setAbsGrey(this.img_jiangbei,!0),this.lb_taskName.text="无"):(this.lb_taskName.text=e[this.playerInfo.taskCode].name,this.img_jiangbei.source=e[this.playerInfo.taskCode].img+"_png");var i=(100*this.playerInfo.completeNum/t).toFixed(0)+"%";this.lb_taskPro.text="您已经解锁了"+this.playerInfo.completeNum+"/"+t+"项成就("+i+")",this.img_taskJindu.width=Math.floor(this.playerInfo.completeNum/t*205),this.lb_taskJindu.text=this.playerInfo.completeNum+"/"+t},i.prototype.updateRewardInfo=function(){var e=[],t=this.playerInfo.level+1;t>c.Config.chessAchieveLevelList().length-1&&(t=c.Config.chessAchieveLevelList().length-1);for(var i=1;i<t+1;i++){var n={level:i,isGet:!1};e.push(n)}for(var o in this.lb_needLevel.visible=!1,e.length==this.proxy.rewardGetList.length&&1<this.playerInfo.level?(this.showLevel=t,this.btn_isGet.visible=!0,this.btn_get.visible=!1):(this.showLevel=1,this.btn_isGet.visible=!1,this.btn_get.visible=!0),e){for(var i in this.proxy.rewardGetList)e[o].level==this.proxy.rewardGetList[i]&&(e[o].isGet=!0);if(0==e[o].isGet){this.showLevel=e[o].level;break}}this.lb_textLevel.text="成就"+this.showLevel+"级奖励",this.needLevel=c.Config.chessAchieveLevel()[this.showLevel].playerLevel,this.playerProxy.playerInfoVO.level<this.needLevel&&(this.btn_isGet.visible=!1,this.btn_get.visible=!1,this.lb_needLevel.visible=!0,this.lb_needLevel.text="人物达到"+this.needLevel+"级");var a=JSON.parse(c.Config.chessAchieveLevel()[this.showLevel].rewards);for(var o in this.gp_reward.removeChildren(),a){var r=customui.BaseItemFactory.create();r.scaleX=r.scaleY=.7,r.updateData({id:a[o][1],num:a[o][2]}),this.gp_reward.addChild(r)}var s=this.showLevel>this.playerInfo.level;UIActionManager.setGrey(this.btn_get,s)},i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.btn_modifyIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().showSubView(c.PlayerMediator.N,c.PlayerMediator.SV.MODIFY_AVATAR)},this),this.btn_show.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.mediator.showSubView(c.ZzqMediator.SV.ACHIEVEMENTREWARD,{info:e.playerInfo})},this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.showLevel<=e.playerInfo.level?e.proxy.GetAchieveRewards(e.showLevel,function(){c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(c.Config.chessAchieveLevel()[e.showLevel].rewards),type:c.CommonRewardPreviewPanel.REWARD_TYPE.REWARD})}):Utils.MsgUtils.addMidMsg("未满足条件")},this),UIActionManager.setAbsGrey(this.btn_isGet,!0),this.btn_isGet.enabled=!1,this.initList=!1,this.cu_ph.updateData({vo:this.proxy.curPlayer}),this.initTabbar()},i.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar.dataProvider=new eui.ArrayCollection([{source:{up:"_btn_yq_m_json.common_yeqian_chengjiudengji_0",down:"_btn_yq_m_json.common_yeqian_chengjiudengji_1",text:"成就等级"}},{source:{up:"_btn_yq_m_json.common_yeqian_chengjiujiangbei_0",down:"_btn_yq_m_json.common_yeqian_chengjiujiangbei_1",text:"成就奖杯"}}]),this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this),this.onBarItemTap()},i.prototype.onBarItemTap=function(e){var t=this;switch(void 0===e&&(e={itemIndex:i.TAB_VIEW.INFO}),this.gp_myinfo.visible=!1,this.gp_cup.visible=!1,e.itemIndex){case i.TAB_VIEW.INFO:this.blb_title0.text="成就等级",this.gp_myinfo.visible=!0;break;case i.TAB_VIEW.CUP:this.blb_title0.text="成就奖杯",this.initList?(this.scroller_cup.viewport.scrollV=0,this.scroller_cup.viewport.validateNow(),this.scroller_cup.stopAnimation(),this.gp_cup.visible=!0):this.proxy.GetAchieveTaskProgress(function(e){t.updateCupList({info:e.task})})}},i.prototype.updateCupList=function(e){var i=this,t=JSON.parse(e.info),n=[],o=[],a=[],r=[],s=[];for(var c in t)t[c].isTarget?n.push(t[c]):0!=t[c].key?o.push(t[c]):a.push(t[c]);o.sort(function(e,t){return i.getTaskProGress(e.code,e.key)>i.getTaskProGress(t.code,t.key)?-1:1});var l=n.concat(o.concat(a)),h=0;for(var c in l)r.push(l[c]),h++,2<r.length?(s.push(r),r=[]):h==l.length&&(s.push(r),r=[]);this.initList=!0,this.gp_cup.visible=!0,this.list_cup.itemRenderer=p,this.list_cup.dataProvider=new eui.ArrayCollection(s)},i.prototype.getTaskProGress=function(e,t){var i=c.Config.chessAchieveTask()[e];return t/JSON.parse(i.target)[0]},i.TAB_VIEW={INFO:0,CUP:1},i}(BasePanel);c.ZzqAchievement=e,__reflect(e.prototype,"game.ZzqAchievement");var p=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZzqAchievementOneSkin",e.proxy=c.AppFacade.getInstance().retrieveProxy(c.ZzqPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var e=this.data;this.gp_di.removeChildren();for(var t=0;t<e.length;t++){var i=new n;i.updateInfo(e[t]),this.gp_di.addChild(i)}},e}(eui.ItemRenderer);__reflect(p.prototype,"ZzqAchievementOne");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZzqAchievementCupSkin",e.proxy=c.AppFacade.getInstance().retrieveProxy(c.ZzqPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().showSubView(c.ZzqMediator.N,c.ZzqMediator.SV.ACHIEVEMENTREWARDSHOW,{info:e.params})},this)},e.prototype.updateInfo=function(e){this.params=e;var t=c.Config.chessAchieveTask()[e.code];this.img_jiangbei.source=""==t.img?"zzq_img_jiangbei01_png":t.img+"_png",this.lb_name.text=t.name;var i=JSON.parse(t.target);1==i[0]?(this.img_jindu.visible=!1,this.img_di.visible=!1,this.lb_jindu.visible=!1):(this.img_jindu.visible=!0,this.img_di.visible=!0,this.lb_jindu.visible=!0,this.lb_jindu.text=e.key+"/"+i[0],this.img_jindu.width=Math.floor(e.key/i[0]*115)),UIActionManager.setAbsGrey(this.img_jiangbei,!e.isTarget)},e}(eui.ItemRenderer);__reflect(n.prototype,"ZzqAchievementCup")}(game||(game={})),function(n){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZzqAchievementGetSkin",e.proxy=n.AppFacade.getInstance().retrieveProxy(n.ZzqPy.N),e}return __extends(e,t),e.prototype.updateView=function(e){this.gp_reward0.removeChildren();e.info.allTask;for(var t=[],i=0;i<e.info.allTask.length;i++)e.info.allTask[i].isTarget&&t.push(e.info.allTask[i]);var n=5<t.length?5:t.length;for(i=0;i<n;i++){(o=new a).updateInfo(t[i]),this.gp_reward0.addChild(o)}if(5<t.length)for(i=5;i<t.length;i++){var o;(o=new a).updateInfo(t[i]),this.gp_reward1.addChild(o)}else this.gp_reward1&&this.gp_reward1.parent&&this.gp_reward1.parent.removeChild(this.gp_reward1)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(BasePanel);n.ZzqAchievementGet=e,__reflect(e.prototype,"game.ZzqAchievementGet");var a=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZzqAchievementGetCupSkin",e.proxy=n.AppFacade.getInstance().retrieveProxy(n.ZzqPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateInfo=function(e){this.params=e;var t=n.Config.chessAchieveTask()[e.code];this.img_jiangbei.source=""==t.img?"zzq_img_jiangbei01_png":t.img+"_png",this.lb_name.text=t.name;var i=JSON.parse(t.target);1==i[0]?(this.img_jindu.visible=!1,this.img_di.visible=!1,this.lb_jindu.visible=!1):(this.img_jindu.visible=!0,this.img_di.visible=!0,this.lb_jindu.visible=!0,this.lb_jindu.text=e.key+"/"+i[0],this.img_jindu.width=Math.floor(e.key/i[0]*100))},e}(eui.Component);__reflect(a.prototype,"ZzqAchievementGetCup")}(game||(game={})),function(o){var e=function(i){function e(e){var t=i.call(this)||this;return t.skinName="ZzqAchievementRewardSkin",t.proxy=o.AppFacade.getInstance().retrieveProxy(o.ZzqPy.N),t.playerProxy=o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N),t.playerInfo=e,t}return __extends(e,i),e.prototype.updateView=function(e){e&&(this.playerInfo=e.info),this.updateCupList()},e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this)},e.prototype.updateCupList=function(){var e=o.Config.chessAchieveLevel(),t=[];for(var i in e)if(0!=e[i].level){for(var n in e[i].isShow=!(this.playerProxy.playerInfoVO.level>=e[i].playerLevel),e[i].isGet=!1,e[i].isCanGet=e[i].level<=this.playerInfo.level,e[i].needLevel=e[i].playerLevel,this.proxy.rewardGetList)this.proxy.rewardGetList[n]==e[i].level&&(e[i].isGet=!0);t.push(e[i])}this.list_cup.itemRenderer=a,this.list_cup.dataProvider=new eui.ArrayCollection(t)},e}(BasePanel);o.ZzqAchievementReward=e,__reflect(e.prototype,"game.ZzqAchievementReward");var a=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZzqAchievementRewardOneSkin",e.proxy=o.AppFacade.getInstance().retrieveProxy(o.ZzqPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.TouchUtils.addTouchListener(this.btn_get,function(){e.data.isCanGet?e.proxy.GetAchieveRewards(e.data.level,function(){o.AppFacade.getInstance().showSubView(o.CommonMediator.N,o.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(e.data.rewards),type:o.CommonRewardPreviewPanel.REWARD_TYPE.REWARD})}):Utils.MsgUtils.addMidMsg("未满足条件")})},e.prototype.dataChanged=function(){var e=this.data;this.gp_reward.removeChildren(),e.isShow?(this.btn_get.visible=!1,this.gp_isGet.visible=!1,this.lb_needLevel.visible=!0):(this.lb_needLevel.visible=!1,e.isCanGet?e.isGet?(this.btn_get.visible=!1,this.gp_isGet.visible=!0):(this.btn_get.visible=!0,this.gp_isGet.visible=!1,UIActionManager.setGrey(this.btn_get,!1)):(this.btn_get.visible=!0,this.gp_isGet.visible=!1,UIActionManager.setGrey(this.btn_get,!0))),this.lb_needLevel.text="人物达到"+e.needLevel+"级",this.lb_num.text="成就"+e.level+"级";var t=JSON.parse(e.rewards);for(var i in t){var n=customui.BaseItemFactory.create();n.scaleX=n.scaleY=.6,n.updateData({id:t[i][1],num:t[i][2]}),this.gp_reward.addChild(n)}},e}(eui.ItemRenderer);__reflect(a.prototype,"ZzqAchievementRewardOne")}(game||(game={})),function(o){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZzqAchievementRewardShowSkin",e.proxy=o.AppFacade.getInstance().retrieveProxy(o.ZzqPy.N),e}return __extends(e,t),e.prototype.updateView=function(e){var t=e.info,i=o.Config.chessAchieveTask()[t.code];this.img_jiangbei.source=""==i.img?"zzq_img_jiangbei01_png":i.img+"_png",this.lb_name.text=i.name,this.lb_num.text=i.desc,this.lb_numP.text="x"+i.expRewards,this.gp_get.visible=t.isTarget,this.gp_no.visible=!t.isTarget;var n=JSON.parse(i.target);1==n[0]?this.gp_pross&&this.gp_pross.parent&&this.gp_pross.parent.removeChild(this.gp_pross):(this.img_jindu.visible=!0,this.img_di.visible=!0,this.lb_jindu.visible=!0,this.lb_jindu.text=t.key+"/"+n[0],this.img_jindu.width=Math.floor(t.key/n[0]*205)),this.gp_get.visible&&this.formatData(t.isTargetDt),this.gp_btn&&this.gp_btn.parent&&this.gp_btn.parent.removeChild(this.gp_btn)},e.prototype.formatData=function(e){var t=[],i=new Date(1e3*e),n=i.getFullYear(),o=i.getMonth()+1,a=i.getDate();t.push({text:n+"."+o+"."+a,style:{textColor:1761866}}),t.push({text:" 获得",style:{textColor:16777215}}),this.lb_getTime.textFlow=t},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e}(BasePanel);o.ZzqAchievementRewardShow=e,__reflect(e.prototype,"game.ZzqAchievementRewardShow")}(game||(game={})),function(m){var e=function(i){function e(){var e=i.call(this)||this;return e.lockStationList=[0,0,0,0,0,0,0,0],e.skinName="ZzqChessSkin",e.proxy=m.AppFacade.getInstance().retrieveProxy(m.ZzqPy.N),e.playerHeads=new Array,e.winEffectList=new Array,e.playerHead2Obj={},e.pos2HeroBI={},window._zzq=e}return __extends(e,i),e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.removeListener(),this.countDownScheId&&(egret.clearInterval(this.countDownScheId),this.countDownScheId=void 0)},e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btns),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_players),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_info_1),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_info_2),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_tips),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_head_tips),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_pick),this.CommonBarrage.touchEnabled=!1,this.CommonBarrage.touchChildren=!1,this.btn_fanhui.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<t.proxy.curPlayer.life?(t.mediator.sendNotification(CN.ZZQ_STATUS_QUIT),m.MainJumpConfig.jumpTo(),t.mediator.sendNotification(CN.MAIN_FORCE_UPDATE_BANNER)):m.GameMgr.getInstance().showCommonTipsWin({commonTips:"确定退出本局游戏吗？退出游戏不会影响本局排名。",source:"zzq_exit_btn",cb:!0,clickCB:function(e){1==e.type&&t.proxy.ExitChess(function(){t.mediator.sendNotification(CN.ZZQ_STATUS_QUIT),m.MainJumpConfig.jumpTo(),t.mediator.sendNotification(CN.MAIN_FORCE_UPDATE_BANNER)})}})},this),this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.showHaloPanel()},this),this.btn_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.mediator.showSubView(m.ZzqMediator.SV.HEROBOOK)},this),this.btn_3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.mediator.showSubView(m.ZzqMediator.SV.RECORD)},this),this.btn_4.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.mediator.chessPickRootView.show()},this),this.btn_5.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.mediator.showSubView(m.ZzqMediator.SV.LEVELDATA)},this),this.gp_halo.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.showHaloPanel()},this);var e=JSON.parse(m.Config.constConfig().WchessExpShop.constValue);this.btn_6.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){m.GameMgr.getInstance().showCommonTipsWin({commonTips:"确定花费"+e[1]+"个金币，购买"+e[0]+"点经验吗？",source:"zzq_buy_exp",cb:!0,clickCB:function(e){1==e.type&&t.proxy.BuyExp(1,function(){t.showUp()})}})},this),this.addListener(),this.updateTipsTextInfo(),this.bindTipsPanelClick({target:this.gp_info_2,cb:function(){t.gp_tips.visible=!0,t.lb_desc.textFlow=[{text:"英雄上限\n",style:{size:22,textColor:16711571}},{text:"你出战的英雄上限数量不能超过主角等级上限\n\n英雄出战上限等于你的主角等级，提升你的主角经验可提升主角等级\n每回合自动获取1点经验\n花费金币进行升级时，可立即获得"+e[0]+"点经验",style:{size:20,textColor:16777215}}]}})},e.prototype.updateTipsTextInfo=function(){var d=this,u=JSON.parse(m.Config.constConfig().ChessWinStreakRewards.constValue),g=JSON.parse(m.Config.constConfig().ChessLoseStreakRewards.constValue),f=JSON.parse(m.Config.constConfig().WchessGoldInterest.constValue),_=m.Config.constConfig().WchessWinRewards.constValue;this.bindTipsPanelClick({target:this.gp_info_1,cb:function(){var e=d.proxy.curPlayer.winNum+d.proxy.curPlayer.loseNum,t=JSON.parse(m.Config.constConfig().ChessAutoIncreaseMoneyNum.constValue),i=0;for(var n in t)if(e==t[n][0]-1)i=t[n][1];else if(e>=t.length){i=t[t.length-1][1];break}var o=void 0,a=d.proxy.curPlayer.winLoseStreak%1e4,r=0;if(d.gp_tips.visible=!0,Math.floor(d.proxy.curPlayer.winLoseStreak/1e4)==EBattleResult.EBattleResultWin){o="连胜奖励";for(var s=0,c=u;s<c.length;s++){if(!(a>=(p=c[s])[0]))break;r=p[1]}}else{o="连败补偿";for(var l=0,h=g;l<h.length;l++){var p;if(!(a>=(p=h[l])[0]))break;r=p[1]}}d.lb_desc.textFlow=[{text:"金币\n",style:{size:22,textColor:16711571}},{text:"金币是你在该玩法中进行购买物品使用的唯一资源，每回合自动获取金币，出售英雄也可回收一定数量的金币\n金币可用于升级人物等级，招募英雄，刷新招募列表\n \n",style:{size:20,textColor:16777215}},{text:"当前金币："+d.proxy.curPlayer.gold+"\n",style:{size:20,textColor:16768287}},{text:"下回合基础收入：",style:{size:20,textColor:16777215}},{text:"+"+i+"\n",style:{size:20,textColor:1900321}},{text:"下回合利息收入：",style:{size:20,textColor:16777215}},{text:"+"+Math.min(Math.floor(d.proxy.curPlayer.gold/f[0])*f[1],f[2])+"\n",style:{size:20,textColor:1900321}},{text:"下回合胜利奖励：",style:{size:20,textColor:16777215}},{text:"+"+_,style:{size:20,textColor:1900321}}],r&&d.lb_desc.textFlow.push({text:"\n下回合"+o+"：",style:{size:20,textColor:16777215}},{text:"+"+r,style:{size:20,textColor:1900321}})}})},e.prototype.showUp=function(){DragonBoneTools.playOnce({effectName:"common_zzqdjts",parent:this.gp_up,x:this.gp_up.width/2,y:this.gp_up.height/2,scaleX:1,scaleY:1,keep:!1,loop:!1,doneCB:function(){}})},e.prototype.xy2Pos=function(e,t){},e.prototype.pos2XY=function(e){var t=0,i=0;return e-1<ZZQ_CONST.SHANGZHEN_NUM?(t=Math.ceil(e/ZZQ_CONST.SHANGZHEN_NUM)-1,i=(e-1)%ZZQ_CONST.SHANGZHEN_NUM):(t=Math.ceil((e-8)/ZZQ_CONST.BEIBAO_LINE_EACH_COUNT)-1,i=(e-9)%ZZQ_CONST.BEIBAO_LINE_EACH_COUNT),0==t&&e-1<8?i<ZZQ_CONST.QIANPAI_NUM?[105*i+105,105*t+20]:[105*i-210,105*t+130]:[107*i+5,100*t+295]},e.prototype.headClick=function(e){this.proxy.curPlayer.uuid!=e.vo.uuid&&m.AppFacade.getInstance().showSubView(m.ZzqMediator.N,m.ZzqMediator.SV.PLAYERINFO,{vo:e.vo})},e.prototype.init=function(){var n=this;this.proxy.curRoomInfo.players.forEach(function(e,t){var i=new customui.ZzqChessPlayerHead({vo:e,myUuid:n.proxy.curRoomInfo.uuid});i.addTapEvent(function(e){n.headClick(e)}),(n.playerHead2Obj[e.uuid]=i).y=t*i.height,n.gp_players.addChild(i),n.playerHeads.push(i)}),this.countDownScheId=egret.setInterval(this.countDownUpdate,this,1e3);for(var e=1;e<=ZZQ_CONST.SHANGZHEN_NUM+ZZQ_CONST.BEIBAO_NUM;e++){var t=customui.BaseItemForChessFactory.create();this.pos2HeroBI[e]=t;var i=this.pos2XY(e);t.x=i[0],t.y=i[1],t.scaleX=.9,t.scaleY=.9,this.gp_heroList.addChild(t)}for(e=0;e<6;e++){var o=new customui.ZzqWinEffect;this.winEffectList.push(o),this.gp_effect.addChild(o)}this.updateCurPlayerInfo(),this.proxy.GetHeroList(),this.proxy.GetWchessRoomInfo(),this.updatePlayerHeads(),this.updateNextUuid()},e.prototype.countDownUpdate=function(){if(this.countDownSecond){var e=this.countDownSecond-(Utils.TimerManager.getServerTime()-this.proxy.countDownSDT);e--<=0||(e<=ZZQ_CONST.DAOJISHI_RED&&this.proxy.curRoomInfo.status==EWchessRoomStatus.Handle?(this.blb_tips.text="即将战斗\n"+e,this.mediator.sendNotification(CN.ZZQ_STATUS_FIGHT_DAOJISHI,e)):this.blb_tips.text=this.tips+"\n"+e)}},e.prototype.countDown=function(e,t){this.tips=e,this.countDownSecond=t||0,this.proxy.countDownSDT=Utils.TimerManager.getServerTime()-(this.proxy.curRoomInfo.sysDt-this.proxy.curRoomInfo.dt),this.updateNextUuid()},e.prototype.updateNextUuid=function(){for(var e in this.proxy.curRoomInfo.opponentList)if(this.proxy.curRoomInfo.uuid==this.proxy.curRoomInfo.opponentList[e].attackUuid){var t=this.proxy.getPlayerInfoByUuid(this.proxy.curRoomInfo.opponentList[e].defenceUuid);this.lb_next.text=t.name;break}},e.prototype.updateIsStreak=function(){var r=this,s=0;this.proxy.curRoomInfo.players.forEach(function(e,t){var i=e.winLoseStreak,n=parseInt((i/1e4).toFixed(0)),o=parseInt((i%1e4).toFixed(0));if(1==n&&(5==o||8==o||10==o)){var a={winNum:o,number:s,name:e.name};r.winEffectList[s].updateEffectInfo(a),s++}});this.proxy.getPlayerInfoByUuid(this.proxy.curRoomInfo.uuid)},e.prototype.updateCurPlayerInfo=function(){this.levelC=m.Config.chessLevelHero(this.proxy.curPlayer.level);var e=m.Config.chessLevelHeroOther(this.proxy.curPlayer.level);this.pb_exp.maximum=e.exp,this.lockStationList=JSON.parse(this.levelC.stationList),this.lb_jinbi.text=this.proxy.curPlayer.gold.toString(),this.blb_level.text=this.proxy.curPlayer.level.toString(),this.pb_exp.value=this.proxy.curPlayer.exp;var t=m.Config.chessLevelHeroLength();this.proxy.curPlayer.level>=t&&(this.pb_exp.value=this.pb_exp.maximum);var i=Math.ceil(this.proxy.curPlayer.exp/e.exp*this.pb_exp.width);i>this.pb_exp.width&&(i=this.pb_exp.width),this.updateLock(),this.proxy.curPlayer.life<=0&&this.handleDead()},e.prototype.handleDead=function(){this.isDead=!0},e.prototype.updateLock=function(){for(var e=1;e<=ZZQ_CONST.SHANGZHEN_NUM;e++)this.lockStationList[e-1]?this.pos2HeroBI[e].vo||(this.pos2HeroBI[e].img_icon.source=""):this.pos2HeroBI[e].img_icon.source="common_img_xiaosuo_png"},e.prototype.updateEffectList=function(){for(var e in this.pos2HeroBI)if(!this.pos2HeroBI[e].isHave&&8<Number(e)){var t={pos:e,race:this.proxy.effectList1[0].race};this.proxy.effectList1.push(t);break}this.proxy.effectList1.sort(function(e,t){return e.pos>t.pos?1:-1})},e.prototype.updateEffect=function(){if(0<this.proxy.effectList1.length){var e=5==this.proxy.effectList1[0].race?1:2;if(this.updateEffectList(),this.proxy.effectList1.length>e)for(var t=0;t<this.proxy.effectList1.length;t++){var i=0==t?"common_huijushengji_1":"common_kapaixiaoshi";this.pos2HeroBI[this.proxy.effectList1[t].pos].playEffect(i)}}if(0<this.proxy.effectList2.length&&0<this.proxy.effectList1.length){var n=5==this.proxy.effectList1[0].race?1:2,o=5==this.proxy.effectList2[0].race?0:1;if(this.proxy.effectList2.sort(function(e,t){return e.pos>t.pos?1:-1}),this.proxy.effectList2.length>o&&this.proxy.effectList1.length>n)for(t=0;t<this.proxy.effectList2.length;t++){var a=0==t?"common_huijushengji_1":"common_kapaixiaoshi";this.pos2HeroBI[this.proxy.effectList2[t].pos].playEffect(a)}}},e.prototype.updateHeroList=function(){var t=this,i={};for(var e in this.proxy.curHeroList.forEach(function(e){i[e.pos]=1,t.pos2HeroBI[e.pos].updateData({vo:e})}),this.pos2HeroBI)i[e]||this.pos2HeroBI[e].resetFixedStyle();var n=0,o=0;this.proxy.curHeroList.forEach(function(e){e.pos<=ZZQ_CONST.SHANGZHEN_NUM&&n++}),this.lockStationList.forEach(function(e){e&&o++}),this.lb_renshu.text=n+"/"+o,this.updateLock(),this.updateGpHero()},e.prototype.updateGpHero=function(){for(var e=[],t=[],i=0,n=this.proxy.curHeroList;i<n.length;i++){var o=n[i];o.isInFormation()&&t.indexOf(o.config.subType)<0&&(e.push(o.code),t.push(o.config.subType))}if(0<e.length){var a=this.gp_halo,r=m.AppFacade.getInstance().retrieveProxy(m.HeroPy.N).getActivatedHaloId(e,!0),s=m.Config.heroHaloConfig();for(var c in a.removeChildren(),r){var l=s[r[c]],h=new ZzqHaloItem({icon:m.GeneralConfig.getGuajiImg(l.img)[1]});a.addChild(h)}}},e.prototype.updateBarrage=function(){var e=void 0;if(this.proxy.barrageInfo){for(var t=0,i=this.proxy.barrageInfo;t<i.length;t++){var n=i[t];e||(e=m.Config.chessHero());var o=e[n.code];if(o){for(var a=" ",r=0;r<o.initStar;r++)a+="★";var s=this.proxy.getPlayerInfoByUuid(n.uuid);if(s){var c=s.name+" → ";this.CommonBarrage.addOneMsgAutoFormat({speed:100,text:[{text:c},{text:o.name,style:{textColor:m.GeneralConfig.getColorByColor(o.color)}},{text:a}]})}}}this.proxy.barrageInfo.splice(0)}if(this.proxy.battleDetailBarrageInfo){this.proxy.battleDetailBarrageInfo.sort(function(e,t){return e.round-t.round});for(var l=0,h=this.proxy.battleDetailBarrageInfo;l<h.length;l++){n=h[l];this.CommonBarrage.addOneMsgAutoFormat({speed:100,text:[{text:this.proxy.getPlayerInfoByUuid(n.attackUuid).name+" "},{text:""+n.attackNum,style:{textColor:1761866}},{text:" → "},{text:this.proxy.getPlayerInfoByUuid(n.defenceUuid).name+" "},{text:""+n.defenceNum,style:{textColor:1761866}}]})}this.proxy.battleDetailBarrageInfo.splice(0)}},e.prototype.updateView=function(e,t){t&&this.init()},e.prototype.updatePlayerHeads=function(){var a=this;this.playerHeads.sort(function(e,t){return 0<e.vo.life&&t.vo.life<=0?-1:e.vo.life<=0&&0<t.vo.life?1:e.vo.dt!=t.vo.dt?t.vo.dt-e.vo.dt:t.vo.life-e.vo.life}),this.playerHeads.forEach(function(e,t){for(var i=0,n=a.proxy.curRoomInfo.players;i<n.length;i++){var o=n[i];if(o.uuid==e.vo.uuid){e.updateData({vo:o}),e.vo.life<=0&&UIActionManager.setAbsGrey(e,!0);break}}egret.Tween.removeTweens(e),egret.Tween.get(e).to({y:t*e.height},250,egret.Ease.sineInOut)})},e.prototype.popResult=function(){var t=this;if(this.proxy.latestFightStatis){var e=void 0;e=this.proxy.latestFightStatis.result==EBattleResult.EBattleResultWin?"zzq_txt_shengli_png":"zzq_txt_zhanbai_png",RES.getResAsync(e,function(e){t.img_result.visible=!0,t.img_result.source=e,egret.Tween.removeTweens(t.img_result),egret.Tween.get(t.img_result).call(function(){t.img_result.visible=!0,t.img_result.alpha=0}).to({alpha:1},500).wait(1e3).to({alpha:0},500).call(function(){t.img_result.visible=!1})},this)}},e.prototype.bindTipsPanelClick=function(e){var t=this,i=e.target;i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.cb,this),i.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.gp_tips.visible=!1},this),i.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){t.gp_tips.visible=!1},this),i.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.gp_tips.visible=!1},this)},e.prototype.addListener=function(){this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},e.prototype.removeListener=function(){this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},e.prototype.setModelToXY=function(e,t,i){var n=-e.width*e.scaleX/2,o=-e.height*e.scaleY/2;e.x=(t-e.parent.x-this.gp_root.x+n)/Utils.DeviceUtils.additionScale(),e.y=(i-e.parent.y-this.gp_root.y+o)/Utils.DeviceUtils.additionScale()},e.prototype.getTouchedGroupPos=function(e){for(var t in this.pos2HeroBI){var i=this.pos2HeroBI[t];if(!(Number(t)<=ZZQ_CONST.SHANGZHEN_NUM&&!this.lockStationList[Number(t)-1]||i==this.targetItem)){var n=i.localToGlobal();if(this.rect?this.rect.setTo(n.x,n.y,i.width,i.height):this.rect=new egret.Rectangle(n.x,n.y,i.width,i.height),this.rect.contains(e.stageX,e.stageY))return t}}},e.prototype.setHeroToPos=function(e,t,i){if(void 0===i&&(i=!1),e){this.pos2HeroBI[this.startingPos]=void 0,this.startingPos&&this.startingPos!=t&&this.pos2HeroBI[t]&&this.setHeroToPos(this.pos2HeroBI[t],this.startingPos,!0),this.pos2HeroBI[t]=e;var n=this.pos2XY(t);e.x=n[0],e.y=n[1],i||this.proxy.ChangeFormation(this.startingPos,t)}},e.prototype.onTouchBegin=function(e){if(!this.isDead){var t=this.getTouchedGroupPos(e);if(t&&this.pos2HeroBI[t]){if(this.targetItem=this.pos2HeroBI[t],!this.targetItem.vo)return void(this.targetItem=void 0);this.targetItemTouchTM=Date.now(),this.gp_heroList.setChildIndex(this.targetItem,-1),this.startingPos=t,this.gp_touchField.width=Utils.DeviceUtils.curWidth(),this.gp_touchField.height=Utils.DeviceUtils.curHeight()}}},e.prototype.onTouchMove=function(e){this.targetItem&&this.setModelToXY(this.targetItem,e.stageX,e.stageY)},e.prototype.onTouchEnd=function(e){if(this.targetItem){var t=this.getTouchedGroupPos(e);Date.now()-this.targetItemTouchTM<ZZQ_CONST.TOUCH_AS_CLICK?(this.mediator.showSubView(m.ZzqMediator.SV.DETAIL,{vo:this.targetItem.vo}),this.setHeroToPos(this.targetItem,this.startingPos)):t?this.setHeroToPos(this.targetItem,t):this.setHeroToPos(this.targetItem,this.startingPos),this.targetItem=void 0,this.startingPos=void 0,this.gp_touchField.width=this.gp_heroList.width,this.gp_touchField.height=this.gp_heroList.height}},e.prototype.showHaloPanel=function(){for(var e=[],t=[],i=0,n=this.proxy.curHeroList;i<n.length;i++){var o=n[i];o.isInFormation()&&t.indexOf(o.config.subType)<0&&(e.push(o.code),t.push(o.config.subType))}0==e.length?Utils.MsgUtils.addMidMsg("请先上阵英雄"):this.mediator.showSubView(m.ZzqMediator.SV.HEROHALO,{codeList:e})},e}(BaseFull);m.ZzqChess=e,__reflect(e.prototype,"game.ZzqChess")}(game||(game={}));var ZzqHaloItem=function(i){function e(e){var t=i.call(this)||this;return t.skinName="FightHaloItem",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.img_icon.source=this.params.icon},e}(eui.ItemRenderer);__reflect(ZzqHaloItem.prototype,"ZzqHaloItem"),function(n){var e=function(i){function e(){var e=i.call(this)||this;return e.skinName="ZzqChessPickSkin",e.proxy=n.AppFacade.getInstance().retrieveProxy(n.ZzqPy.N),e}return __extends(e,i),e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this)},e.prototype.childrenCreated=function(){var t=this;for(var e in i.prototype.childrenCreated.call(this),this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.proxy.ChangeCard()},this),this.gp_touch1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.gp_touch2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.blb_cost.text="x"+n.Config.constConfig().ChessRefreshCardsCosts.constValue,this.zzqChessCards={1:this.cu_card1,2:this.cu_card2,3:this.cu_card3,4:this.cu_card4,5:this.cu_card5},this.zzqChessCards)this.zzqChessCards[e].addTapEvent(function(e){t.onTapEvent(e)})},e.prototype.show=function(){this.visible=!0},e.prototype.hide=function(){this.visible=!1},e.prototype.onTapEvent=function(e){this.proxy.BuyCard(e,function(){e.visible=!1})},e.prototype.updateCardColor=function(){var e=this.proxy.curPlayer.gold;for(var t in this.zzqChessCards)this.zzqChessCards[t].visible&&this.zzqChessCards[t].updateCardColor(e)},e.prototype.updateView=function(e,t){var i=this;if(this.proxy.curCards){for(var n in this.zzqChessCards)this.zzqChessCards[n].visible=!1;var o=this.proxy.curPlayer.gold;this.proxy.curCards.forEach(function(e){var t=i.zzqChessCards[e.pos];t.visible=!0,t.updateData(e,o)})}},e}(BasePanel);n.ZzqChessPick=e,__reflect(e.prototype,"game.ZzqChessPick")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZzqChessResultSkin",e.vo=new Array,e.py=i.GameMVC.zzqPy,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateView=function(e){var i=this;e?(e.vo.forEach(function(e,t){i.vo.push(e)}),this.vo.sort(function(e,t){return e.rank>t.rank?1:-1})):(this.py.curRoomInfo.players.forEach(function(e,t){i.vo.push(e)}),this.vo.sort(function(e,t){return 0<e.life&&t.life<=0?-1:e.life<=0&&0<t.life?1:e.dt!=t.dt?t.dt-e.dt:t.life-e.life})),this.gpList=[],this.gpList.push(this.gp_player1,this.gp_player2,this.gp_player3,this.gp_player4,this.gp_player5,this.gp_player6),this.vo&&this.updatePlayerInfo()},e.prototype.updatePlayerInfo=function(){var n=this;this.vo.forEach(function(e,t){var i=new customui.ZzqChessResultItem;i.updateData({vo:e,index:t}),n.gpList[t].removeChildren(),n.gpList[t].addChild(i)})},e}(BasePanel);i.ZzqChessResult=e,__reflect(e.prototype,"game.ZzqChessResult")}(game||(game={})),function(E){var e=function(t){function e(){var e=t.call(this)||this;return e.RANK_IMAGE={"青铜":"paiweisai_txt_qingtong","白银":"paiweisai_txt_baiyin","黄金":"paiweisai_txt_huangjin","铂金":"paiweisai_txt_bojin","钻石":"paiweisai_txt_zuanshi","星耀":"paiweisai_txt_xingyao","王者":"paiweisai_txt_wangzhe"},e.skinName="ZzqChessResultItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateData=function(e){this.gp_result1.visible=0==e.index,this.gp_result2.visible=1==e.index,this.gp_result3.visible=2==e.index,this.lb_resultNum.visible=2<e.index,this.lb_resultNum.text=e.index+1,this.lb_name.text=e.vo.name;var t=[],i={text:e.vo.winNum+"",style:{textColor:2555657}},n={text:"-"+e.vo.loseNum,style:{textColor:16777215}};t.push(i,n),this.lb_result1.textFlow=t;var o=JSON.parse(e.vo.stationList);e.vo.level=null==e.vo.level?0<o.length?o.length:1:e.vo.level;var a=game.Config.chessLevelHero(e.vo.level),r=JSON.parse(a.stationList);r.forEach(function(e){e&&0}),this.gp_heroInfo.removeChildren();for(var s=1;s<=ZZQ_CONST.SHANGZHEN_NUM;s++){var c=E.BaseItemForChessFactory.create();if(c.scaleX=.35,c.scaleY=.35,r[s-1]){for(var l=!1,h=0,p=o;h<p.length;h++){var d=p[h];if(d[0]==s){c.updateData({code:d[1]}),l=!0;break}}l||c.resetFixedStyle()}else c.resetFixedStyle(),c.img_icon.source="common_img_xiaosuo_png";this.gp_heroInfo.addChild(c)}var u=e.vo.grade;if(null!=u){var g=game.Config.chessStarLevel();if(g){var f,_,m=-1,y=!1;for(var v in g){var T=g[v];if(y||(u>=T.requestGrade?(T.code,f=T):y=!0),y&&!_&&(_=T),y){if(!(m<Number(T.stars)))break;m=Number(T.stars)}}for(var C in this.img_rank_0.source=ResourceUtils.png(f.icon),this.img_rank_0.width=32,this.img_rank_0.height=26,this.RANK_IMAGE)if(-1!=f.name.search(C)){this.img_rank_1.source=ResourceUtils.png(this.RANK_IMAGE[C]);break}this.img_rank_2.visible=0!=f.num,0!=f.num&&(this.img_rank_2.source="paiweisai_img_"+f.num+"_png")}}},e}(eui.Component);E.ZzqChessResultItem=e,__reflect(e.prototype,"customui.ZzqChessResultItem",["eui.UIComponent","egret.DisplayObject"])}(customui||(customui={})),function(S){var e=function(i){function l(e){var t=i.call(this)||this;return t.playerInfo=void 0,t.playerTenList=[],t.playerTenTextList=[],t.initHeroList=!1,t.initHistoryList=!1,t.initRecommendList=!1,t.heroList=void 0,t.allTimes=void 0,t.heroIsUP1=!1,t.heroIsUP2=!1,t.heroIsUP3=!1,t.skinName="ZzqDataInfoSkin",t.proxy=S.AppFacade.getInstance().retrieveProxy(S.ZzqPy.N),t.initHeroList=!1,t.initHistoryList=!1,t.initRecommendList=!1,t}return __extends(l,i),l.prototype.updateView=function(e){this.playerInfo=e.info,this.onBarItemTap()},l.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.commonDaTanKuang.blb_title.text="个人信息",this.commonDaTanKuang.onCloseCB=function(){e.hide()},this.initTabbar(),this.initMyInfoList(),this.initHeroChoose()},l.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar.dataProvider=new eui.ArrayCollection([{source:{up:"_btn_yq_m_json.common_yeqian_gerenxinxi_0",down:"_btn_yq_m_json.common_yeqian_gerenxinxi_1",text:"信息"}},{source:{up:"_btn_yq_m_json.common_yeqian_yingxiongxinxi_0",down:"_btn_yq_m_json.common_yeqian_yingxiongxinxi_1",text:"英雄"}},{source:{up:"_btn_yq_m_json.common_yeqian_lishizhanji_0",down:"_btn_yq_m_json.common_yeqian_lishizhanji_1",text:"战绩"}},{source:{up:"_btn_yq_m_json.common_yeqian_tuijianzhenrong_0",down:"_btn_yq_m_json.common_yeqian_tuijianzhenong_1",text:"阵容"}}]),this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this)},l.prototype.initMyInfoList=function(){for(var e in this.playerTenList.push(this.gp_last0),this.playerTenList.push(this.gp_last1),this.playerTenList.push(this.gp_last2),this.playerTenList.push(this.gp_last3),this.playerTenList.push(this.gp_last4),this.playerTenList.push(this.gp_last5),this.playerTenList.push(this.gp_last6),this.playerTenList.push(this.gp_last7),this.playerTenList.push(this.gp_last8),this.playerTenList.push(this.gp_last9),this.playerTenList)this.playerTenList[e].visible=!1;this.playerTenTextList.push(this.lb_last0),this.playerTenTextList.push(this.lb_last1),this.playerTenTextList.push(this.lb_last2),this.playerTenTextList.push(this.lb_last3),this.playerTenTextList.push(this.lb_last4),this.playerTenTextList.push(this.lb_last5),this.playerTenTextList.push(this.lb_last6),this.playerTenTextList.push(this.lb_last7),this.playerTenTextList.push(this.lb_last8),this.playerTenTextList.push(this.lb_last9)},l.prototype.initHeroChoose=function(){var e=this;this.gp_choose1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.updateHeroListBychoose(1)},this),this.gp_choose2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.updateHeroListBychoose(2)},this),this.gp_choose3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.updateHeroListBychoose(3)},this)},l.prototype.onBarItemTap=function(e){var t=this;switch(void 0===e&&(e={itemIndex:l.TAB_VIEW.MYINFO}),this.gp_myinfo.visible=!1,this.gp_heroList.visible=!1,this.gp_history.visible=!1,this.gp_recommend.visible=!1,e.itemIndex){case l.TAB_VIEW.MYINFO:this.commonDaTanKuang.blb_title.text="个人信息",this.gp_myinfo.visible=!0,this.updateMyInfo(this.playerInfo);break;case l.TAB_VIEW.HEROINFO:this.commonDaTanKuang.blb_title.text="英雄信息",this.initHeroList?(this.scroller_heroList.viewport.scrollV=0,this.scroller_heroList.viewport.validateNow(),this.scroller_heroList.stopAnimation(),this.gp_heroList.visible=!0):this.proxy.GetWchessHeroCount(function(e){t.updateHeroList({info:e.info,times:e.times})});break;case l.TAB_VIEW.hISTORYINFO:this.commonDaTanKuang.blb_title.text="历史战绩",this.initHistoryList?(this.scroller_history.viewport.scrollV=0,this.scroller_history.viewport.validateNow(),this.scroller_history.stopAnimation()):(this.list_historyItem.itemRenderer=o,this.updateHistoryList()),this.gp_history.visible=!0;break;case l.TAB_VIEW.TEAMINFO:this.commonDaTanKuang.blb_title.text="推荐阵容",this.initRecommendList?(this.scroller_recommend.viewport.scrollV=0,this.scroller_recommend.viewport.validateNow(),this.scroller_recommend.stopAnimation()):this.updateRecommendList(),this.gp_recommend.visible=!0}},l.prototype.updateRecommendList=function(){var e=S.Config.chessRecommend();this.list_recommend.itemRenderer=n;var t=new Array;for(var i in e)t.push(e[i]);this.list_recommend.dataProvider=new eui.ArrayCollection(t),this.gp_recommend.visible=!0},l.prototype.updateHeroListBychoose=function(e){var h=this;for(var t in this.img_choose1.visible=!1,this.img_choose2.visible=!1,this.img_choose3.visible=!1,1==e?(this.heroIsUP1=!this.heroIsUP1,this.img_choose1.rotation=this.heroIsUP1?90:-90,this.img_choose1.visible=!0,this.heroList.sort(function(e,t){return e.appearTimes>t.appearTimes?1==h.heroIsUP1?-1:1:1==h.heroIsUP1?1:-1})):2==e?(this.heroIsUP2=!this.heroIsUP2,this.img_choose2.rotation=this.heroIsUP2?90:-90,this.img_choose2.visible=!0,this.heroList.sort(function(e,t){var i=e.successTimes/e.appearTimes;return t.successTimes/t.appearTimes<i?1==h.heroIsUP2?-1:1:1==h.heroIsUP2?1:-1})):3==e&&(this.heroIsUP3=!this.heroIsUP3,this.img_choose3.rotation=this.heroIsUP3?90:-90,this.img_choose3.visible=!0,this.heroList.sort(function(e,t){var i,n=JSON.parse(e.rankTimes),o=0,a=0;for(var r in n)o+=n[r][0]*n[r][1],a+=n[r][1];i=o/a;var s=JSON.parse(t.rankTimes),c=0,l=0;for(var r in s)c+=s[r][0]*s[r][1],l+=s[r][1];return c/l<i?1==h.heroIsUP3?-1:1:1==h.heroIsUP3?1:-1})),this.heroList)this.heroList[t].indexNum=t;this.list_heroList.dataProvider=new eui.ArrayCollection(this.heroList)},l.prototype.updateHeroList=function(i){if(this.initHeroList=!0,i||i.info){for(var e in this.list_heroList.itemRenderer=t,this.heroList=i.info,this.allTimes=i.times,this.heroList.sort(function(e,t){return e.allTime=i.times,t.allTime=i.times,e.appearTimes>t.appearTimes?-1:1}),this.heroList)this.heroList[e].indexNum=e;this.heroIsUP1=!0,this.heroIsUP2=!1,this.heroIsUP3=!1,this.img_choose1.rotation=90,this.img_choose1.visible=!0,this.img_choose2.visible=!1,this.img_choose3.visible=!1,this.list_heroList.dataProvider=new eui.ArrayCollection(this.heroList),this.gp_heroList.visible=!0}else this.scroller_heroList.stopAnimation(),this.scroller_heroList.viewport.scrollV=0},l.prototype.updateHistoryList=function(){var e=this;if(this.playerInfo||this.playerInfo.records){for(var t=new Array,i=JSON.parse(this.playerInfo.records),n=0;n<i.length;n++)i[n].index=n,t.push(i[n]);t.sort(function(e,t){return e.dt>t.dt?-1:1});var o=0,a=new egret.Timer(30,t.length);this.list_historyItem.dataProvider=new eui.ArrayCollection(t),a.addEventListener(egret.TimerEvent.TIMER,function(){o<e.list_historyItem.$children.length&&(e.list_historyItem.getChildAt(o).visible=!0,o++,e.scroller_history.viewport.validateNow(),e.scroller_history.stopAnimation())},this),a.start()}else this.scroller_history.stopAnimation(),this.scroller_history.viewport.scrollV=0},l.prototype.updateMyInfo=function(e){if(this.lb_name.text=this.proxy.curPlayer.name,this.cu_playerHead=customui.ZzqPlayerHeadFactory.create(),this.cu_playerHead.x=this.cu_playerHead.y=1.34,this.cu_playerHead.width=this.cu_playerHead.height=80,this.gp_item.addChild(this.cu_playerHead),this.cu_playerHead.updateData({vo:this.proxy.curPlayer}),e&&e.grade?this.lb_now.text=this.updateGradeInfo(e.grade):this.lb_now.text="青铜",e&&e.hGrade?this.lb_old.text=this.updateGradeInfo(e.hGrade):this.lb_old.text="青铜",e&&e.rankTimes){var t=0,i=0,n=0,o=0,a=JSON.parse(e.rankTimes);for(var r in a)t+=a[r][1],a[r][0]<2&&(i+=a[r][1]),a[r][0]<4&&(n+=a[r][1]),o+=a[r][0]*a[r][1];this.lb_infonum1.text=t+"",this.lb_infonum2.text=i+"",this.lb_infonum3.text=(i/t*100).toFixed(0)+"%",this.lb_infonum4.text=n+"",this.lb_infonum5.text=(n/t*100).toFixed(0)+"%",this.lb_infonum6.text=(o/t).toFixed(1)}else this.lb_infonum1.text="0",this.lb_infonum2.text="0",this.lb_infonum3.text="0%",this.lb_infonum4.text="0",this.lb_infonum5.text="0%",this.lb_infonum6.text="0";if(e&&e.records){var s=0,c=0,l=JSON.parse(e.records);l.sort(function(e,t){return e.dt>t.dt?-1:1});for(var h=0;h<l.length&&!(9<h);h++){s++,c+=l[h].rank,this.playerTenList[h].visible=!0;var p=this.playerTenList[h].$children[1],d=this.playerTenList[h].$children[2],u=this.playerTenList[h].$children[3],g=this.playerTenList[h].$children[4];p.visible=1==l[h].rank,d.visible=2==l[h].rank,u.visible=3==l[h].rank,g.visible=3<l[h].rank,this.playerTenTextList[h].text=l[h].rank}this.lbl_rank.text=(c/s).toFixed(1)}else for(var r in this.lbl_rank.text="0",this.playerTenList)this.playerTenList[r].visible=!1},l.prototype.updateGradeInfo=function(e){if(null!=e){var t=S.Config.chessStarLevel();if(t){var i,n,o=-1,a=!1;for(var r in t){var s=t[r];if(a||(e>=s.requestGrade?(s.code,i=s):a=!0),a&&!n&&(n=s),a){if(!(o<Number(s.stars)))break;o=Number(s.stars)}}for(var c in l.RANK_IMAGE)if(-1!=i.name.search(c))return l.RANK_IMAGE[c]}}},l.RANK_IMAGE={"青铜":"青铜","白银":"白银","黄金":"黄金","铂金":"铂金","钻石":"钻石","星耀":"星耀","王者":"王者"},l.TAB_VIEW={MYINFO:0,HEROINFO:1,hISTORYINFO:2,TEAMINFO:3},l}(BasePanel);S.ZzqDataInfo=e,__reflect(e.prototype,"game.ZzqDataInfo");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZzqDataRecommendItemSkin",e.proxy=S.AppFacade.getInstance().retrieveProxy(S.ZzqPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.gp_team.removeChildren();var e=this.data;this.lb_text.text=e.content;for(var t=JSON.parse(e.stationList),i=(null==t.length||t.length,0);i<t.length;i++){var n=customui.BaseItemForChessFactory.create();n.scaleX=.5,n.scaleY=.5,n.updateData({code:t[i]}),this.gp_team.addChild(n)}if(this.gp_buff.removeChildren(),0<t.length){var o=this.gp_buff,a=S.AppFacade.getInstance().retrieveProxy(S.HeroPy.N).getActivatedHaloId(t,!0),r=S.Config.heroHaloConfig();for(var s in a){var c=r[a[s]],l=new ZzqHaloItem({icon:S.GeneralConfig.getGuajiImg(c.img)[1]});o.addChild(l)}}},e}(eui.ItemRenderer);__reflect(n.prototype,"ZzqDataRecommendItem");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZzqDataHeroItemSkin",e.proxy=S.AppFacade.getInstance().retrieveProxy(S.ZzqPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseitem=customui.BaseItemForChessFactory.create(),this.baseitem.touchEnabled=!1,this.baseitem.scaleX=.6,this.baseitem.scaleY=.6,this.gp_item.addChild(this.baseitem)},e.prototype.dataChanged=function(){var e=this.data;this.img_di.visible=this.data.indexNum%2!=0;var t,i=S.Config.chessHero();for(var n in i)if(i[n].subType==e.subType){t=i[n];break}this.baseitem.updateData(t),this.lb_rank.text=t.name,this.lb_num1.text=(100*e.appearTimes/(6*e.allTime)).toFixed(1)+"%",this.lb_num2.text=(100*e.successTimes/e.appearTimes).toFixed(1)+"%";var o=JSON.parse(e.rankTimes),a=0,r=0;for(var n in o)a+=o[n][0]*o[n][1],r+=o[n][1];this.lb_num3.text=(a/r).toFixed(1)},e}(eui.ItemRenderer);__reflect(t.prototype,"ZzqDataHeroItem");var o=function(i){function e(){var e=i.call(this)||this;return e.RANK_IMAGE={"青铜":"paiweisai_txt_qingtong","白银":"paiweisai_txt_baiyin","黄金":"paiweisai_txt_huangjin","铂金":"paiweisai_txt_bojin","钻石":"paiweisai_txt_zuanshi","星耀":"paiweisai_txt_xingyao","王者":"paiweisai_txt_wangzhe"},e.skinName="ZzqDataHistoryItemSkin",e.proxy=S.AppFacade.getInstance().retrieveProxy(S.ZzqPy.N),e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.img_all.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.proxy.GetWchessResultLog(t.data.resultUuid,function(e){t.showResult({info:e.info})})},this)},e.prototype.dataChanged=function(){var e=this.data;this.img_di.visible=this.data.index%2!=0,this.gp_team.removeChildren(),this.gp_halo.removeChildren(),this.img_rank_0.visible=1==e.rank,this.img_rank_1.visible=2==e.rank,this.img_rank_2.visible=3==e.rank,this.lb_rank.visible=3<e.rank,this.lb_rank.text=e.rank;for(var t=JSON.parse(e.stationList),i=null==t.length?1:t.length,n=S.Config.chessLevelHero(i),o=JSON.parse(n.stationList),a=1;a<=ZZQ_CONST.SHANGZHEN_NUM;a++){var r=customui.BaseItemForChessFactory.create();if(r.scaleX=.35,r.scaleY=.35,o[a-1]){for(var s=!1,c=0,l=t;c<l.length;c++){var h=l[c];if(h[0]==a){r.updateData({code:h[1]}),s=!0;break}}s||r.resetFixedStyle()}else r.resetFixedStyle(),r.img_icon.source="common_img_xiaosuo_png";this.gp_team.addChild(r)}var p=e.grade;if(null!=p){var d=S.Config.chessStarLevel();if(d){var u,g,f=-1,_=!1;for(var m in d){var y=d[m];if(_||(p>=y.requestGrade?(y.code,u=y):_=!0),_&&!g&&(g=y),_){if(!(f<Number(y.stars)))break;f=Number(y.stars)}}for(var v in this.img_rank_3.source=ResourceUtils.png(u.icon),this.img_rank_3.width=32,this.img_rank_3.height=26,this.RANK_IMAGE)if(-1!=u.name.search(v)){this.img_rank_4.source=ResourceUtils.png(this.RANK_IMAGE[v]);break}if(this.img_rank_5.visible=0!=u.num,0!=u.num&&(this.img_rank_5.source="paiweisai_img_"+u.num+"_png"),t){this.gp_halo.removeChildren();var T=[],C=[];for(var E in t)C.indexOf(S.Config.chessHero()[t[E][1]])<0&&(T.push(t[E][1]),C.push(S.Config.chessHero()[t[E][1]]));if(0<T.length){var b=this.gp_halo,I=S.AppFacade.getInstance().retrieveProxy(S.HeroPy.N).getActivatedHaloId(T,!0),A=S.Config.heroHaloConfig();for(var E in I){y=A[I[E]];var P=new ZzqHaloItem({icon:S.GeneralConfig.getGuajiImg(y.img)[1]});P.scaleX=.8,P.scaleY=.8,b.addChild(P)}}}}}},e.prototype.showResult=function(e){var t=e.info;S.AppFacade.getInstance().showSubView(S.ZzqMediator.N,S.ZzqMediator.SV.RESULT,{vo:t.players})},e}(eui.ItemRenderer);__reflect(o.prototype,"ZzqDataHistoryItem")}(game||(game={})),function(a){var e=function(i){function e(){var e=i.call(this)||this;return e.curType=EEntityType.EEntityTypeHero,e.ghDataList={},e.select=1,e.ITEM_TYPE_CONFIG={desc:"图鉴",type:"英雄",barSource:{up:"_btn_yq_m_json.beibao_yeqian_yingxiong_0",down:"_btn_yq_m_json.beibao_yeqian_yingxiong_1"},getAllInfo:function(e){var t={},i=a.Config.chessHero();for(var n in i){var o=i[n];o.isShow&&3==o.initStar&&(1==e?(t[o.race]||(t[o.race]=new Array),t[o.race].push(o)):(t[o.subProfession]||(t[o.subProfession]=new Array),t[o.subProfession].push(o)))}return t},filterConfig:{data:[{select:1,icon:"_btn_yq_m_json.zzq_btn_zz_0",chosenImg:"_btn_yq_m_json.zzq_btn_zz_1"},{select:2,icon:"_btn_yq_m_json.zzq_btn_zy_0",chosenImg:"_btn_yq_m_json.zzq_btn_zy_1"}],filterFunc:function(e,t,i){return!e||e.race==t.race}},sortConfig:{data:[{desc:"等级"},{desc:"星级"}],defaultSortFunc:function(e,t){var i=e.info,n=t.info;return i.initStar!=n.initStar?i.initStar-n.initStar:i.costNum!=n.costNum?i.costNum-n.costNum:i.race!=n.race?i.race-n.race:i.profession!=n.profession?HERO_SORT_ORDER[n.profession]-HERO_SORT_ORDER[i.profession]:i.code-n.code}}},e.mapId={1:13,2:14,3:15,4:16,5:17,6:18,101:19,102:20,201:21,202:22,203:23,301:24,302:25,501:26,502:27},e.skinName="HandBookMainViewSkin",e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.initList(),this.activateComponent(),this.initialized=!1,this.gp_content.scaleX=this.gp_content.scaleY=1,UIActionManager.playUIAction(this.gp_content,1),this.scroller.addEventListener(egret.Event.CHANGE,function(){var e=1==t.select?1220:1790;t.list_item.scrollV>=e&&(t.list_item.scrollV=e)},this)},e.prototype.guanghuanData=function(){var r=a.Config.heroHaloConfig(),s={},c=["slot1","slot2","slot3","slot4","slot5","slot6"],e=function(e){var i=r[e];if(i.haloType==HaloType.Chess){var t=i.type,n=i.subType;s[n]||(s[n]={name:i.name,type:t,subType:n,slot:[],showNum:0,img:i.img,skillDesc:{},first:!0});var o=s[n],a=o.slot;c.forEach(function(e,t){!a[t]&&i[e]&&a.push(i[e])}),o.skillDesc[a.length]=i.haloSkillDesc,o.showNum=a.length}};for(var t in r)e(t);this.ghDataList=s},e.prototype.initList=function(){this.scroller.scrollPolicyV=eui.ScrollPolicy.AUTO;var e=new eui.VerticalLayout;this.list_item.layout=e,this.list_item.itemRenderer=t,this.list_filter.itemRenderer=n,this.list_filter.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onFilterListItemTap,this)},e.prototype.onFilterListItemTap=function(e){if(this.curFilter&&this.curFilter==e.item.data?this.curFilter=void 0:this.curFilter=e.item.data,this.select!=e.item.data.select){this.select=e.item.data.select;var t=this.list_filter.dataProvider;for(var i in t.source){var n=t.source[i];n==e.item?n.chosen=!n.chosen:n.chosen=!1}t.refresh(),this.updateList()}},e.prototype.fadeFilterListItemTap=function(e){this.curFilter&&this.curFilter==e.item.data?this.curFilter=void 0:this.curFilter=e.item.data;var t=this.list_filter.dataProvider;for(var i in t.source){var n=t.source[i];n.data.select==e.item.data.select?n.chosen=!n.chosen:n.chosen=!1}t.refresh(),this.updateList()},e.prototype.onListItemTap=function(e){this.log("点击事件:",e);var t=e.item.info,i=t.code;Math.floor(i/1e7);this.mediator.showSubView(a.ZzqMediator.SV.DETAIL,{vo:t,isShowBtn:!0})},e.prototype.updateView=function(e){this.params=e,this.targetConfig=this.ITEM_TYPE_CONFIG,this.targetConfig&&(this.initialized||(this.initialized=!0,this.guanghuanData(),this.resetFilterAndSorter(),this.fadeFilterListItemTap({item:{isHero:!0,data:this.targetConfig.filterConfig.data[0],chosen:!1}})),this.updateList())},e.prototype.updateList=function(){this.targetConfig.filterConfig&&this.targetConfig.filterConfig.filterFunc;var e=this.targetConfig.sortConfig&&this.targetConfig.sortConfig.defaultSortFunc,t=this.targetConfig.getAllInfo(this.select);if(t){t[1]&&(this.gp_empty.visible=!1,this.scroller.visible=!0);var i={};if(e)for(var n in t){var o=t[n],a=[];for(var r in o){var s=o[r];a.push({info:s,get:!0})}i[n]=a,i[n].sort(e)}var c=[];for(var n in i){var l=i[n];c.push({data:l,id:n,select:this.select,ghData:this.ghDataList[this.mapId[n]]})}this.list_item.dataProvider?this.list_item.dataProvider.replaceAll(c):this.list_item.dataProvider=new eui.ArrayCollection(c),this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0}else this.gp_empty.visible=!0,this.scroller.visible=!1},e.prototype.resetFilterAndSorter=function(){if(this.targetConfig.filterConfig){this.list_filter.visible=!0,this.curFilter=void 0;var t=[];"英雄"==this.targetConfig.type||"碎片"==this.targetConfig.type?(this.targetConfig.filterConfig.data.forEach(function(e){t.push({data:e,chosen:!1,isHero:!0})}),this.list_filter.x=(this.gp_content.width-(183*t.length+15*(t.length-1)))/2+15):(this.targetConfig.filterConfig.data.forEach(function(e){t.push({data:e,chosen:!1,isHero:!1})}),this.list_filter.x=(this.gp_content.width-(183*t.length+15*(t.length-1)))/2),this.list_filter.dataProvider=new eui.ArrayCollection(t)}else this.list_filter.visible=!1;this.blb_title.text=this.targetConfig.desc},e.prototype.activateComponent=function(){var e=this;this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.params&&this.params.closeCB&&this.params.closeCB()},e}(BasePanel);a.ZzqHeroBookView=e,__reflect(e.prototype,"game.ZzqHeroBookView");var r=function(t){function e(){var e=t.call(this)||this;return e.skinName="HandBookItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.baseitem=customui.BaseItemForChessFactory.create(),this.baseitem.touchEnabled=!1,this.gp_content.addChild(this.baseitem)},e.prototype.dataChanged=function(){var e=this.data.info;switch(Math.floor(e.code/1e7)){case EEntityType.EEntityTypeHero:e.maxLevel,e.noStar=!0,this.baseitem.updateData(e),this.baseitem.blb_level.visible=!1;break;case EEntityType.EEntityTypeHeroArtifact:this.baseitem.updateData(e)}this.data.get?UIActionManager.setGrey(this.baseitem,!1):UIActionManager.setGrey(this.baseitem,!0)},e}(eui.ItemRenderer);__reflect(r.prototype,"HerobookItem");var t=function(i){function e(e){var t=i.call(this)||this;return t.isGuanghuan=!1,t.skinName="heroBookSortItemSkin",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.list_items.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListItemTap,this),this.resetGuanghuan(),this.lb_guanhuan.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.data.ghData&&(e.gp_gh.visible=!0,e.initGuanghuan())},this),this.lb_guanhuan.addEventListener(egret.TouchEvent.TOUCH_END,function(){e.resetGuanghuan()},this),this.lb_guanhuan.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){e.resetGuanghuan()},this),this.lb_guanhuan.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){e.resetGuanghuan()},this)},e.prototype.initGuanghuan=function(){var e=this,t=new a.ZzqHeroHaloPanel_HaloItem;t.initItem(function(){t.data=e.data.ghData}),this.gp_guanhuan.addChild(t),502!=this.data.id&&6!=this.data.id||(this.gp_gh.y-=50)},e.prototype.resetGuanghuan=function(){this.gp_gh.visible=!1,this.gp_guanhuan.removeChildren(),!this.data||502!=this.data.id&&6!=this.data.id||(this.gp_gh.y=52)},e.prototype.onListItemTap=function(e){egret.log("点击事件:",e);var t=e.item.info,i=t.code;Math.floor(i/1e7);a.AppFacade.getInstance().retrieveMediator(a.ZzqMediator.N).showSubView(a.ZzqMediator.SV.DETAIL,{vo:t,isShowBtn:!0})},e.prototype.dataChanged=function(){this.list_items.itemRenderer=r,this.lb_guanhuan.textFlow=[{text:"显示光环",style:{underline:!0}}];var e,t=this.data.data,i=this.data.id,n=(e=1==this.data.select?HeroRaceConfig[i]:SubProfessionConfig[i]).haoloIcon;this.img_tilte_flag.source=n;var o=e.name;201==i&&(o="元素"),202==i&&(o="魔导"),this.lb_name.text=o,this.list_items.dataProvider=new eui.ArrayCollection(t)},e}(eui.ItemRenderer);a.HeroBookSortItem=t,__reflect(t.prototype,"game.HeroBookSortItem");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroBookTapItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.data.isHero&&(this.width=183,this.scaleX=.9,this.scaleY=.9),this.chosen=this.data.chosen||!1,this.img_icon.source=this.data.data.icon,this.img_chosen.source=this.data.data.chosenImg,this.setChosen(this.chosen)},e.prototype.setChosen=function(e){this.chosen=e,this.img_chosen.visible=this.chosen},e}(eui.ItemRenderer);a.HeroBookTapItem=n,__reflect(n.prototype,"game.HeroBookTapItem")}(game||(game={})),function(p){var e=function(t){function e(){var e=t.call(this)||this;return e.heroPy=p.AppFacade.getInstance().retrieveProxy(p.HeroPy.N),e.skinName="HeroHaloSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list_item.itemRenderer=i},e.prototype.updateView=function(e){var r,t=e&&e.codeList;t&&(r=this.heroPy.getActivatedHaloId(t,!0));var s={},c=p.Config.heroHaloConfig(),l=["slot1","slot2","slot3","slot4","slot5","slot6"],i=function(e){var i=c[e];if(i.haloType==HaloType.Chess){var t=i.type,n=i.subType;s[n]||(s[n]={name:i.name,type:t,subType:n,slot:[],showNum:0,img:i.img,skillDesc:{}});var o=s[n],a=o.slot;l.forEach(function(e,t){!a[t]&&i[e]&&a.push(i[e])}),(!r||0<=r.indexOf(i.id))&&(o.showNum=a.length),o.skillDesc[a.length]=i.haloSkillDesc}};for(var n in c)i(n);var o=[];for(var a in s){var h=s[a];o.push(h)}o.sort(function(e,t){var i=0<e.showNum,n=0<t.showNum;return i!=n?n?1:-1:e.subType-t.subType}),o[0].first=!0,this.list_item.dataProvider=new eui.ArrayCollection(o)},e}(BasePanel);p.ZzqHeroHaloPanel=e,__reflect(e.prototype,"game.ZzqHeroHaloPanel");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZzqHeroHaloPanel_HaloItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);for(var e=0;e<6;e++)this.gp_condIcon.addChild(new eui.Image)},e.prototype.initItem=function(e){for(var t=0;t<6;t++)this.gp_condIcon.addChild(new eui.Image);e&&e()},e.prototype.dataChanged=function(){var o=this;UIActionManager.setAbsGrey(this.img_haloIcon,0==this.data.showNum),this.img_haloIcon.source=this.data.img+"_png",this.lb_name.text=this.data.name;for(var e=this.data.type,t=this.data.slot,i=0;i<6;i++){var n=t[i],a=this.gp_condIcon.$children[i];n?(a.visible=!0,a.source=e==HeroHaloType.Race?HeroRaceConfig[n].raceIconBig:SubProfessionConfig[n].icon,UIActionManager.setAbsGrey(a,i>=this.data.showNum)):a.visible=!1}this.gp_line.removeChildren();var r=this.data.skillDesc,s=[],c=Object.keys(r);c.forEach(function(e,t){var i=r[e];if(""!=i&&(s.push({text:"("+e+") "+i,style:{textColor:Number(e)<=o.data.showNum?8060672:8553090}}),t!=c.length-1&&s.push({text:"\n"})),t!=c.length-1){var n=new eui.Image("yingxiong_img_fengexian_png");n.x=44.2*Number(e)+26*(Number(e)-1+.5),o.gp_line.addChild(n)}}),this.lb_desc.textFlow=s,this.img_line.visible=!this.data.first},e}(eui.ItemRenderer);p.ZzqHeroHaloPanel_HaloItem=i,__reflect(i.prototype,"game.ZzqHeroHaloPanel_HaloItem")}(game||(game={})),function(s){var e=function(i){function e(){var e=i.call(this)||this;return e.skinName="ZzqLevelDataSkin",e.proxy=s.AppFacade.getInstance().retrieveProxy(s.ZzqPy.N),e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.img_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.hide()},this),this.updateData()},e.prototype.updateData=function(){this.gp_next.visible=!0;s.Config.chessGrasp();var e=this.proxy.curPlayer.level;this.lb_levelNow.text=e+"";var t=e+1,i=this.getLevelArr(e),n=0;for(var o in i)n+=i[o].weight;if(this.lbl_now_1.text=i[0].weight/n==0?"0%":(100*i[0].weight/n).toFixed(1)+"%",this.lbl_now_2.text=i[1].weight/n==0?"0%":(100*i[1].weight/n).toFixed(1)+"%",this.lbl_now_3.text=i[2].weight/n==0?"0%":(100*i[2].weight/n).toFixed(1)+"%",this.lbl_now_4.text=i[3].weight/n==0?"0%":(100*i[3].weight/n).toFixed(1)+"%",this.lbl_now_5.text=i[4].weight/n==0?"0%":(100*i[4].weight/n).toFixed(1)+"%",8<t)this.gp_next.visible=!1;else{this.lb_levelnext.text=t+"";var a=this.getLevelArr(t),r=0;for(var o in a)r+=a[o].weight;this.lbl_next_1.text=a[0].weight/r==0?"0%":(100*a[0].weight/r).toFixed(1)+"%",this.lbl_next_2.text=a[1].weight/r==0?"0%":(100*a[1].weight/r).toFixed(1)+"%",this.lbl_next_3.text=a[2].weight/r==0?"0%":(100*a[2].weight/r).toFixed(1)+"%",this.lbl_next_4.text=a[3].weight/r==0?"0%":(100*a[3].weight/r).toFixed(1)+"%",this.lbl_next_5.text=a[4].weight/r==0?"0%":(100*a[4].weight/r).toFixed(1)+"%"}},e.prototype.getLevelArr=function(e){var t=[],i=s.Config.chessGrasp();for(var n in i)i[n].level==e&&t.push(i[n]);return t.sort(function(e,t){return e.color>t.color?1:-1}),t},e}(BasePanel);s.ZzqLevelData=e,__reflect(e.prototype,"game.ZzqLevelData")}(game||(game={})),function(r){var e=function(i){function e(){var e=i.call(this)||this;return e.resFullImg=new eui.Image("_main_m_json.maoxian_icon_man"),Utils.AssetsMgr.loadGroup("group_zzq"),e.skinName="ZzqMatchingViewSkin",e.proxy=r.AppFacade.getInstance().retrieveProxy(r.ZzqPy.N),e}return __extends(e,i),e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.removeNotice(),r.AppFacade.getInstance().retrieveProxy(r.FriendPy.N).clearInviteHistory(MODULE.Wchess),this.scheId&&(egret.clearInterval(this.scheId),this.scheId=void 0),Utils.AssetsMgr.destroyGroup("group_zzq")},e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this);var e={emptyCanInvite:!0};this.playerHeads=[customui.ZzqPlayerHeadFactory.create(e),customui.ZzqPlayerHeadFactory.create(e),customui.ZzqPlayerHeadFactory.create(e),customui.ZzqPlayerHeadFactory.create(e),customui.ZzqPlayerHeadFactory.create(e),customui.ZzqPlayerHeadFactory.create(e)],this.playerHeads.forEach(function(e){t.gp_heads.addChild(e)}),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.proxy.amILeader()?t.proxy.LeaveRoom(function(){t.mediator.sendNotification(CN.ZZQ_STATUS_QUIT),r.MainJumpConfig.jumpTo()}):(t.mediator.sendNotification(CN.ZZQ_STATUS_QUIT),r.MainJumpConfig.jumpTo())},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.proxy.SPlayerCount(function(e){t.mediator.showSubView(r.ZzqMediator.SV.DATAINFO,{info:e.info})})},this),Utils.ComponentUtils.registerListener(this.btn_halo,egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().showSubView(r.ZzqMediator.N,r.ZzqMediator.SV.HEROHALO)},this),Utils.ComponentUtils.registerListener(this.btn_book,egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().showSubView(r.ZzqMediator.N,r.ZzqMediator.SV.HEROBOOK)},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"ZZQ_RANK"})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new r.HelpDialog({moduleId:MODULE.Wchess})})},this),this.btn_match.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.proxy.amILeader()?t.proxy.StartMatch():t.proxy.LeaveRoom(function(){t.mediator.sendNotification(CN.ZZQ_STATUS_QUIT),r.MainJumpConfig.jumpTo()})},this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.proxy.EndMatch(function(){})},this),Utils.TouchUtils.addTouchListener(this.btn_reward,function(){var e=r.Config.chessStarLevel()[t.rewardInfo.starLevel];t.proxy.curPlayer.hGrade>=e.requestGrade?t.proxy.GetStarLevelReward(t.rewardInfo.starLevel):r.AppFacade.getInstance().showSubView(r.CommonMediator.N,r.CommonMediator.SV.REWARD_PANEL,{rewards:t.rewardInfo.rewards,type:r.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})}),this.btn_novice.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.mediator.showSubView(r.ZzqMediator.SV.NOVICE)},this),this.btn_achievement.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.proxy.GetAchieveLevel(function(e){t.mediator.showSubView(r.ZzqMediator.SV.ACHIEVEMENT,{info:e})})},this),"TRUE"!=Utils.LocalStorageUtil.getItem("ZZQ_FIRST_GETIN",!0)&&(Utils.LocalStorageUtil.setItem("ZZQ_FIRST_GETIN","TRUE",!0),this.mediator.showSubView(r.ZzqMediator.SV.NOVICE)),this.btn_match.visible=!0,this.btn_cancel.visible=!1,this.fetch(),this.resFullImg.right=-10,this.resFullImg.visible=!1,this.btn_achievement&&this.btn_achievement.addChild(this.resFullImg),NoticeManager.addNoticeListener(NT.ZZQ_ACHIEVELEVEL,this.btn_achievement.getChildAt(0),this,BTN_ICON_NOTICE_POS)},e.prototype.fetch=function(){var e=this;this.proxy.GetWchessRoomInfo(function(){e.switchCanInvite(!0)})},e.prototype.switchCanInvite=function(i){this.playerHeads.forEach(function(e,t){e.switchCanInviteStatus(i)})},e.prototype.updateMatchStatus=function(){var e=this;if(this.proxy.curRoomInfo.status==EWchessRoomStatus.Matching){this.btn_match.visible=!1,this.btn_cancel.visible=!0,this.lb_tips.text="匹配中",this.btn_match.visible=!1;var t=this.lb_tips.text.length;this.scheId||(this.scheId=egret.setInterval(function(){e.lb_tips.text.length<t+3?e.lb_tips.text+=".":e.lb_tips.text="匹配中"},this,500)),this.switchCanInvite(!1)}else this.proxy.curRoomInfo.status==EWchessRoomStatus.ToMatch&&(this.btn_match.label="开始匹配",this.lb_tips.text="匹配对手",this.btn_match.visible=!0,this.btn_cancel.visible=!1,this.updateTime(),this.switchCanInvite(!0),this.scheId&&(egret.clearInterval(this.scheId),this.scheId=void 0));this.proxy.amILeader()?(this.btn_match.label="开始匹配",this.btn_match.skinName="skins.ButtonSkinYellow"):(this.btn_match.label="离开队伍",this.btn_match.skinName="skins.ButtonSkinRed")},e.prototype.updateTime=function(){var e=this.proxy.curRoomInfo.endDt-this.proxy.curRoomInfo.sysDt;this.gp_time.visible=!(432e3<e),this.lbl_time.text=Math.floor(e/24/3600+1)+""},e.prototype.add0=function(e){return e<10?"0"+e:e},e.prototype.updateView=function(e){var i=this;if(this.proxy.curRoomInfo){this.rankBadge.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.ZZQ,grade:this.proxy.curPlayer.grade}),this.rewardInfo={};for(var t=JSON.parse(r.Config.constConfig().ChessStarLevelReward.constValue),n=this.proxy.curPlayer.starLevelTargeted,o=0;o<t.length;o++){var a=t[o];if(n.indexOf(a[0])<0){this.rewardInfo.starLevel=a[0],this.rewardInfo.rewards=a[1];break}}this.rewardInfo.starLevel?this.gp_reward.visible=!0:this.gp_reward.visible=!1,e&&e.id&&(console.log("wchess 来自以下邀请",e.id),this.proxy.JoinRoom(e.id)),this.playerHeads.forEach(function(e,t){e.updateData({vo:i.proxy.curRoomInfo.players[t],tapEvent:i.proxy.curRoomInfo.players[t]?function(){}:void 0})}),this.updateMatchStatus(),NoticeManager.updateNotice(NT.ZZQ_ACHIEVELEVEL)}},e}(BaseFull);r.ZzqMatchingView=e,__reflect(e.prototype,"game.ZzqMatchingView")}(game||(game={})),function(a){var e=function(i){function o(e){void 0===e&&(e=null);var t=i.call(this,o.N,e)||this;return t.initAllViewDone=!1,t.proxy=a.AppFacade.getInstance().retrieveProxy(a.ZzqPy.N),t}return __extends(o,i),o.prototype.initSubView=function(){this.addSubView(o.SV.MATCHING,a.ZzqMatchingView),this.addSubView(o.SV.CHESS_MAIN,a.ZzqChess),this.addSubView(o.SV.STATISTICS,a.ZzqStatistics),this.addSubView(o.SV.DETAIL,a.ZzqChessCardDetail),this.addSubView(o.SV.RECORD,a.ZzqBattleRecordPanel),this.addSubView(o.SV.PLAYERINFO,a.ZzqPlayerInfo),this.addSubView(o.SV.HEROBOOK,a.ZzqHeroBookView),this.addSubView(o.SV.HEROHALO,a.ZzqHeroHaloPanel),this.addSubView(o.SV.RESULT,a.ZzqChessResult),this.addSubView(o.SV.DATAINFO,a.ZzqDataInfo),this.addSubView(o.SV.NOVICE,a.ZzqNovice),this.addSubView(o.SV.LEVELDATA,a.ZzqLevelData),this.addSubView(o.SV.ACHIEVEMENT,a.ZzqAchievement),this.addSubView(o.SV.ACHIEVEMENTREWARD,a.ZzqAchievementReward),this.addSubView(o.SV.ACHIEVEMENTREWARDSHOW,a.ZzqAchievementRewardShow),this.addSubView(o.SV.GETACHIEVEMENT,a.ZzqAchievementGet)},o.prototype.listNotificationInterests=function(){return[CN.ZZQ_STATUS_QUIT,CN.CONFIG_ALL_LOADED,CN.LOGIN_FINAL_DONE,CN.ZZQ_UPDATE_ROOM_INFO,CN.ZZQ_UPDATE_HERO_INFO,CN.ZZQ_UPDATE_CARD_INFO,CN.ZZQ_UPDATE_CUR_PLAYER,CN.ZZQ_UPDATE_BARRAGE,CN.ZZQ_UPDATE_REWARD_INFO,CN.ZZQ_UPDATE_REWARDCUP_INFO,CN.ZZQ_STATUS_FIGHT_END,SocketConst.SOCKET_RECONNECT]},o.prototype.handleNotification=function(e){var t=this,i=e.getBody();switch(e.getName()){case CN.CONFIG_ALL_LOADED:var n=JSON.parse(a.Config.constConfig().WchessTimeCycle.constValue);this.proxy.CONFIG.OPPERA_TM=n[0],this.proxy.CONFIG.BATTLE_TM=n[1];break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.Wchess,!1).allow&&this.proxy.GetAchieveLevel();break;case CN.ZZQ_STATUS_QUIT:this.hideAllSubView(),this.chessRootView=void 0,this.chessPickRootView=void 0,this.initAllViewDone=!1,this.resetRoomState(),customui.ZzqPlayerHeadFactory.clear();break;case CN.ZZQ_UPDATE_BARRAGE:!a.GameMVC.fightPy.isInFight&&this.chessRootView&&this.chessRootView.updateBarrage();break;case CN.ZZQ_STATUS_FIGHT_END:this.proxy.latestFightStatis&&i.uuid==this.proxy.latestFightStatis.battleInfo.uuid?egret.setTimeout(function(){t.chessRootView&&(t.chessPickRootView.updateCardColor(),t.chessRootView.updatePlayerHeads(),t.chessRootView.popResult(),t.chessRootView.updateBarrage(),t.chessRootView.updateIsStreak())},this,500):(console.log("wchess 战报uuid不符合"),this.chessRootView.updatePlayerHeads(),this.chessRootView.popResult());break;case CN.ZZQ_UPDATE_CUR_PLAYER:this.chessPickRootView.updateCardColor(),this.chessRootView.updateCurPlayerInfo();break;case CN.ZZQ_UPDATE_CARD_INFO:this.log("wchess卡牌变化"),this.chessPickRootView&&this.chessPickRootView.updateView();break;case CN.ZZQ_UPDATE_REWARD_INFO:this.log("wchess成就奖励变化"),this.updateView(o.SV.ACHIEVEMENT),this.updateView(o.SV.ACHIEVEMENTREWARD);break;case CN.ZZQ_UPDATE_REWARDCUP_INFO:this.log("wchess获得新成就"),this.showSubView(o.SV.GETACHIEVEMENT,{info:i.info});break;case CN.ZZQ_UPDATE_HERO_INFO:this.log("wchess背包变化"),this.chessRootView.updateEffect(),this.chessRootView.updateHeroList();break;case CN.ZZQ_UPDATE_ROOM_INFO:if(this.proxy.curRoomInfo.status>=EWchessRoomStatus.Matched){if(this.getSubView(o.SV.MATCHING))return this.hideSubView(o.SV.MATCHING),void a.MainJumpConfig.jumpTo("ZZQ");this.initAllViewDone&&this.chessRootView&&this.updateStatus()}else this.updateView(o.SV.MATCHING);break;case SocketConst.SOCKET_RECONNECT:(this.getSubView(o.SV.CHESS_MAIN)||this.getSubView(o.SV.MATCHING))&&this.sendNotification(CN.ZZQ_STATUS_QUIT)}},o.prototype.updateStatus=function(){return __awaiter(this,void 0,void 0,function(){var t,i,n;return __generator(this,function(e){switch(t=this.proxy.curRoomInfo.status,this.chessRootView.updateCurPlayerInfo(),this.log("=当前房间状态====>"+t),t){case EWchessRoomStatus.Handle:if(this.lastState!=t&&(this.chessRootView.countDown("准备回合",this.proxy.CONFIG.OPPERA_TM),this.chessRootView.updatePlayerHeads(),0<this.proxy.curPlayer.life))for(i in this.proxy.GetHeroList(),this.chessPickRootView.show(),this.proxy.curRoomInfo.players)this.proxy.curRoomInfo.players[i].uuid==this.proxy.curRoomInfo.uuid&&(n=this.proxy.curRoomInfo.players[i]).level&&(this.proxy.oldlevel!=n.level&&this.chessRootView.showUp(),this.proxy.oldlevel=n.level);break;case EWchessRoomStatus.Battle:this.chessRootView.countDown("战斗回合",this.proxy.CONFIG.BATTLE_TM);break;case EWchessRoomStatus.ChickenDinner:Utils.MsgUtils.addMidMsg("战斗结束"),this.chessRootView.updatePlayerHeads(),this.resetRoomState(),this.sendNotification(CN.ZZQ_STATUS_QUIT),a.MainJumpConfig.jumpTo(),this.showSubView(o.SV.RESULT)}return this.lastState=t,[2]})})},o.prototype.resetRoomState=function(){this.lastState=void 0},o.prototype.onViewCreate=function(e){e==o.SV.CHESS_MAIN&&(this.chessRootView=this.getSubView(o.SV.CHESS_MAIN),this.initAllViewDone=!0,this.chessPickRootView||(this.chessPickRootView=new a.ZzqChessPick,this.chessRootView.gp_pick.addChild(this.chessPickRootView)))},o.N="ZzqMediator",o.SV={MATCHING:1,CHESS_MAIN:2,STATISTICS:3,DETAIL:4,RECORD:5,PLAYERINFO:6,HEROBOOK:7,HEROHALO:8,RESULT:9,DATAINFO:10,NOVICE:11,LEVELDATA:12,ACHIEVEMENT:13,ACHIEVEMENTREWARD:14,ACHIEVEMENTREWARDSHOW:15,GETACHIEVEMENT:16},o}(BaseMediator);a.ZzqMediator=e,__reflect(e.prototype,"game.ZzqMediator")}(game||(game={})),function(e){var t=function(i){function e(){var e=i.call(this)||this;return e.imgList=[],e.noviceNum=1,e.skinName="ZzqNoviceSkin",e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.imgList=[],this.imgList.push(this.img_1),this.imgList.push(this.img_2),this.imgList.push(this.img_3),this.noviceNum=0,this.updateNovicePos(),this.scroller_novice.throwSpeed=0,this.scroller_novice.bounces=!1,this.scroller_novice.addEventListener(eui.UIEvent.CHANGE_START,function(e){t.startTouch=t.scroller_novice.viewport.scrollH},this),this.img_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.hide()},this),this.scroller_novice.addEventListener(eui.UIEvent.CHANGE_END,function(e){t.endTouchs=t.scroller_novice.viewport.scrollH,t.startTouch>t.endTouchs?t.noviceNum--:t.startTouch<t.endTouchs&&t.noviceNum++,t.updateNovicePos()},this),this.btn_right.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.noviceNum++,t.updateNovicePos()},this),this.btn_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.noviceNum--,t.updateNovicePos()},this)},e.prototype.updateNovicePos=function(){2<this.noviceNum?this.noviceNum=2:this.noviceNum<0&&(this.noviceNum=0),this.btn_left.visible=0!=this.noviceNum,this.btn_right.visible=2!=this.noviceNum,this.img_now.x=this.imgList[this.noviceNum].x,this.img_now.y=this.imgList[this.noviceNum].y,this.scroller_novice.viewport.scrollH=506*this.noviceNum},e}(BasePanel);e.ZzqNovice=t,__reflect(t.prototype,"game.ZzqNovice")}(game||(game={})),function(c){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new i).register(),(new n).register(),(new a).register(),(new o).register(),(new r).register(),(new s).register()},e}();c.ZzqProcessor=e,__reflect(e.prototype,"game.ZzqProcessor");var t=function(e){function t(){return e.call(this,"wchess.WchessRoomInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();c.AppFacade.getInstance().retrieveProxy(c.ZzqPy.N).updateZzqRoomInfo(t.info)},t}(c.ProcessorBase);c.WchessRoomInfoP=t,__reflect(t.prototype,"game.WchessRoomInfoP");var i=function(e){function t(){return e.call(this,"wchess.BarrageListP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();c.AppFacade.getInstance().retrieveProxy(c.ZzqPy.N).updateBarrage(t.barrageList)},t}(c.ProcessorBase);c.BarrageListP=i,__reflect(i.prototype,"game.BarrageListP");var n=function(e){function t(){return e.call(this,"wchess.BattleDetailListP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();c.AppFacade.getInstance().retrieveProxy(c.ZzqPy.N).updateBattleDetail(t.detailList)},t}(c.ProcessorBase);c.BattleDetailListP=n,__reflect(n.prototype,"game.BattleDetailListP");var o=function(e){function t(){return e.call(this,"wchess.BattleInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){c.AppFacade.getInstance().retrieveProxy(c.FightPy.N).respBattleInfoP(e.getBody().battleInfo)},t}(c.ProcessorBase);__reflect(o.prototype,"BattleInfoP");var a=function(e){function t(){return e.call(this,"wchess.BattleResultP",t)||this}return __extends(t,e),t.prototype.execute=function(e){if(c.AppFacade.getInstance().retrieveMediator(c.ZzqMediator.N).getSubView(c.ZzqMediator.SV.CHESS_MAIN)||c.GameMVC.zzqPy.simFight){var t=e.getBody();t.battleType||(t.battleType=EBattleType.EBattleTypeWchess);for(var i=c.AppFacade.getInstance().retrieveProxy(c.FightPy.N),n=c.AppFacade.getInstance().retrieveProxy(c.ZzqPy.N),o=0,a=t.teams;o<a.length;o++){var r=a[o];r.playerId||(r.playerId=r.uuid)}if(t.isSelf)i.respBattleResultP(t);else{var s=0;i.isInFight&&i.fightType==EBattleType.EBattleTypeWchess&&(c.AppFacade.getInstance().sendNotification(CN.FIGHT_SKIP_FIGHT,{ignoreResult:!0}),s=500),egret.setTimeout(function(){c.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:t.battleType,ignoreStringWay:!0,isPassive:!0,preloadCB:function(){n.latestFightStatis=t,i.respBattleResultP(t)},doneCB:function(){c.AppFacade.getInstance().sendNotification(CN.ZZQ_STATUS_FIGHT_END,{uuid:t.battleInfo.uuid})}})},this,s)}}},t}(c.ProcessorBase);__reflect(a.prototype,"BattleResultP");var r=function(e){function t(){return e.call(this,"wchess.WchessTaskP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();for(var i in t.allTask)if(t.allTask[i].isTarget){c.AppFacade.getInstance().sendNotification(CN.ZZQ_UPDATE_REWARDCUP_INFO,{info:t});break}},t}(c.ProcessorBase);c.WchessTaskP=r,__reflect(r.prototype,"game.WchessTaskP");var s=function(e){function t(){return e.call(this,"wchess.AchieveLevelP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();c.AppFacade.getInstance().retrieveProxy(c.ZzqPy.N).rewardLevel=t.level,NoticeManager.updateNotice(NT.ZZQ_ACHIEVELEVEL)},t}(c.ProcessorBase);c.AchieveLevelP=s,__reflect(s.prototype,"game.AchieveLevelP")}(game||(game={})),function(r){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.simFight=!1,e.oldlevel=1,e.debug_slowFight=!1,e.effectList1=[],e.effectList2=[],e.rewardGetList=[],e.rewardLevel=0,e.CONFIG={OPPERA_TM:0,BATTLE_TM:0},e.playerPy=r.AppFacade.getInstance().retrieveProxy(r.PlayerPy.N),e.playerProxy=r.AppFacade.getInstance().retrieveProxy(r.PlayerPy.N),e.oldlevel=1,NoticeManager.registerCB(NT.ZZQ_ACHIEVELEVEL,e.checkAchieveLevel,e),e}return __extends(i,t),i.prototype.checkAchieveLevel=function(){for(var e=this.rewardLevel,t=r.Config.chessAchieveLevel(),i=[],n=1;n<=e;n++)if(this.playerProxy.playerInfoVO.level>=t[n].playerLevel){var o={level:n,isGet:!1};i.push(o)}for(var a in i)for(var n in this.rewardGetList)i[a].level==this.rewardGetList[n]&&(i[a].isGet=!0);for(var a in i)if(!i[a].isGet)return!0;return!1},i.prototype.amILeader=function(){return!this.curRoomInfo||this.curRoomInfo.leader==this.curRoomInfo.uuid},i.prototype.isIdle=function(){return!this.curRoomInfo||!this.curRoomInfo.id},i.prototype.isCanJoinTeam=function(){return!(1<this.curRoomInfo.players.length)},i.prototype.getPlayerInfoByUuid=function(e){for(var t=0,i=this.curRoomInfo.players;t<i.length;t++){var n=i[t];if(n.uuid==e)return n}},Object.defineProperty(i.prototype,"curPlayer",{get:function(){for(var e=0,t=this.curRoomInfo.players;e<t.length;e++){var i=t[e];if(i.uuid==this.curRoomInfo.uuid)return i}},enumerable:!0,configurable:!0}),i.prototype.updateBarrage=function(e){this.barrageInfo||(this.barrageInfo=new Array),r.BaseVO.updateArr(e,this.barrageInfo,r.BarrageInfoVO),r.AppFacade.getInstance().sendNotification(CN.ZZQ_UPDATE_BARRAGE)},i.prototype.updateBattleDetail=function(e){this.battleDetailBarrageInfo||(this.battleDetailBarrageInfo=new Array),r.BaseVO.updateArr(e,this.battleDetailBarrageInfo,r.BattleDetailInfoVO),r.AppFacade.getInstance().sendNotification(CN.ZZQ_UPDATE_BARRAGE)},i.prototype.updateZzqRoomInfo=function(e,t){void 0===t&&(t=!1),this.curRoomInfo||(this.curRoomInfo=new r.SWchessRoomVO),this.curRoomInfo.update(e),t&&(this.curRoomInfo.id=void 0),r.AppFacade.getInstance().sendNotification(CN.ZZQ_UPDATE_ROOM_INFO)},i.prototype.updateCurPlayer=function(e){this.curPlayer.update(e),r.AppFacade.getInstance().sendNotification(CN.ZZQ_UPDATE_CUR_PLAYER)},i.prototype.updateHeroList=function(e,t){var o=this;void 0===t&&(t=!0),this.curHeroList||(this.curHeroList=new Array),t?r.BaseVO.updateArr(e,this.curHeroList,r.SWchessHeroVO):Array.isArray(e)&&e.forEach(function(e){for(var t=0,i=o.curHeroList;t<i.length;t++){var n=i[t];if(n.uuid==e.uuid){n.update(e);break}}}),r.AppFacade.getInstance().sendNotification(CN.ZZQ_UPDATE_HERO_INFO)},i.prototype.updateCards=function(e){if(this.curCards||(this.curCards=new Array),Array.isArray(e)){for(var t=0,i=0,n=e;i<n.length;i++){var o=n[i];this.curCards[t]?this.curCards[t].update(o):this.curCards.push(new r.SWchessHeroVO(o)),t++}this.curCards.splice(t)}r.AppFacade.getInstance().sendNotification(CN.ZZQ_UPDATE_CARD_INFO)},i.prototype.updateRewardReceivedList=function(e){for(var t=0,i=0,n=e;i<n.length;i++){var o=n[i];this.rewardGetList[t]||this.rewardGetList.push(o.level),t++}this.rewardGetList.splice(t),this.rewardGetList.sort(function(e,t){return t<e?1:-1}),r.AppFacade.getInstance().sendNotification(CN.ZZQ_UPDATE_REWARD_INFO),NoticeManager.updateNotice(NT.ZZQ_ACHIEVELEVEL)},i.prototype.GetWchessRoomInfo=function(t){var i=this;Utils.Socket.send("wchess","GetWchessRoomInfo",{}).then(function(e){i.updateZzqRoomInfo(e.info),t&&t()})},i.prototype.CreateRoom=function(t){var i=this;Utils.Socket.send("wchess","CreateRoom",{}).then(function(e){i.updateZzqRoomInfo(e.info),t&&t()})},i.prototype.JoinRoom=function(e,t){var i=this;Utils.Socket.send("wchess","JoinRoom",{id:e}).then(function(e){i.updateZzqRoomInfo(e.info),t&&t()})},i.prototype.StartMatch=function(t){var i=this;Utils.Socket.send("wchess","StartMatch",{}).then(function(e){i.updateZzqRoomInfo(e.info),t&&t()})},i.prototype.CancelMatch=function(t){var i=this;Utils.Socket.send("wchess","CancelMatch",{}).then(function(e){i.updateZzqRoomInfo(e.info),t&&t()})},i.prototype.LeaveRoom=function(t){var i=this;Utils.Socket.send("wchess","LeaveRoom",{}).then(function(e){i.updateZzqRoomInfo(e.info,!0),t&&t()})},i.prototype.GetHeroList=function(t){var i=this;this.effectList1=[],this.effectList2=[],Utils.Socket.send("wchess","GetHeroList",{}).then(function(e){i.updateHeroList(e.heroList),i.updateCards(e.cards),t&&t()})},i.prototype.GetCardList=function(t){var i=this;Utils.Socket.send("wchess","GetCardList",{}).then(function(e){i.updateCards(e.cards),t&&t()})},i.prototype.ChangeCard=function(t){var i=this;Utils.Socket.send("wchess","ChangeCard",{}).then(function(e){i.updateCurPlayer(e.player),i.updateCards(e.cards),t&&t()})},i.prototype.BuyCard=function(e,t){var i=this;for(var n in this.effectList1=[],this.effectList2=[],this.curHeroList){if(this.curHeroList[n].code==e.code){var o={pos:this.curHeroList[n].pos,race:this.curHeroList[n].config.race};this.effectList1.push(o)}if(this.curHeroList[n].code==e.nextCode){var a={pos:this.curHeroList[n].pos,race:this.curHeroList[n].config.race};this.effectList2.push(a)}}Utils.Socket.send("wchess","BuyCard",{pos:e.pos}).then(function(e){i.updateCurPlayer(e.player),i.updateHeroList(e.heroList),i.updateCards(e.cards),t&&t()})},i.prototype.ChangeFormation=function(e,t,i){var n=this;e!=t&&(this.effectList1=[],this.effectList2=[],Utils.Socket.send("wchess","ChangeFormation",{oPos:Number(e),tPos:Number(t)}).then(function(e){n.updateHeroList(e.heroList,!1),i&&i()}))},i.prototype.SellCard=function(e,t,i){var n=this;this.effectList1=[],this.effectList2=[],Utils.Socket.send("wchess","SellCard",{pos:e,uuid:t}).then(function(e){n.updateHeroList(e.heroList),n.updateCurPlayer(e.player),i&&i()})},i.prototype.LockAutoRefreshCards=function(t){var i=this;Utils.Socket.send("wchess","LockAutoRefreshCards",{}).then(function(e){i.updateCurPlayer(e.player),t&&t()})},i.prototype.BuyExp=function(e,t){var i=this;void 0===e&&(e=1),Utils.Socket.send("wchess","BuyExp",{id:e}).then(function(e){i.updateCurPlayer(e.player),i.oldlevel!=e.player.level&&t&&t(e),i.oldlevel=e.player.level})},i.prototype.GetStarLevelReward=function(e){var t=this;Utils.Socket.send("wchess","GetStarLevelReward",{starLevel:e}).then(function(e){t.updateZzqRoomInfo(e.info),r.GameMVC.backpackPy.handleClientReward(e.clientReward)})},i.prototype.BattlePlayerBack=function(e,t){r.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeWchess,pb1:"wchess",pb2:"BattlePlayerBack",params:{uuid:e},ignoreStringWay:!0})},i.prototype.SPlayerCount=function(t){Utils.Socket.send("wchess","GetWchessPlayerCount",{}).then(function(e){t&&t(e)})},i.prototype.GetReservedPlayerCount=function(t){Utils.Socket.send("wchess","GetReservedPlayerCount",{}).then(function(e){t&&t(e)})},i.prototype.GetWchessHeroCount=function(t){Utils.Socket.send("wchess","GetWchessHeroCount",{}).then(function(e){t&&t(e)})},i.prototype.GetWchessResultLog=function(e,t){Utils.Socket.send("wchess","GetWchessResultLog",{resultUuid:e}).then(function(e){t&&t(e)})},i.prototype.ExitChess=function(t){Utils.Socket.send("wchess","ExitChess",{}).then(function(e){t&&t(e)})},i.prototype.EndMatch=function(t){var i=this;Utils.Socket.send("wchess","EndMatch",{}).then(function(e){i.updateZzqRoomInfo(e.info),t&&t()})},i.prototype.GetAchieveLevel=function(t){var i=this;Utils.Socket.send("wchess","GetAchieveLevel",{}).then(function(e){i.rewardLevel=e.level,i.updateRewardReceivedList(e.received),t&&t(e)})},i.prototype.GetAchieveTaskProgress=function(t){Utils.Socket.send("wchess","GetAchieveTaskProgress",{}).then(function(e){t&&t(e)})},i.prototype.GetAchieveRewards=function(e,t){var i=this;Utils.Socket.send("wchess","GetAchieveRewards",{level:e}).then(function(e){i.GetAchieveLevel(),t&&t(e)})},i.N="ZzqProxy",i}(BaseProxy);r.ZzqPy=e,__reflect(e.prototype,"game.ZzqPy")}(game||(game={})),function(u){var e=function(t){function e(){var e=t.call(this)||this;return e.doneCB=void 0,e.skinName="ZzqStatisticsSkin",e.py=u.AppFacade.getInstance().retrieveProxy(u.ZzqPy.N),e}return __extends(e,t),e.prototype.perClose=function(){this.doneCB&&this.doneCB()},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.list_my.itemRenderer=i,this.list_ennemy.itemRenderer=i,this.initBtn()},e.prototype.updateView=function(e){this.result=e.resultData,this.doneCB=e.doneCB,this.updateInfo()},e.prototype.updateInfo=function(){for(var h=this.result.entityResults,e=this.py.curPlayer.uuid,t=void 0,i=0,n=this.result.teams;i<n.length;i++){if((s=n[i]).playerId!=e){t=s;break}}this.lb_name_1.text=this.py.curPlayer.name,this.lb_name_2.text=t.name,this.cu_head_1.updateData({vo:this.py.curPlayer}),this.cu_head_2.updateData({vo:t}),this.result.result==EBattleResult.EBattleResultWin?(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shengli),DragonBoneTools.create("common_shengli_2",function(e){e.x=this.gp_root.width/2,e.y=50,e.animation.play(),this.gp_root.addChildAt(e,0)},this)):(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shibai),DragonBoneTools.create("common_zhanbai_2",function(e){e.x=this.gp_root.width/2,e.y=50,e.animation.play(),this.gp_root.addChildAt(e,0)},this)),this.data={},this.data.self=[],this.data.enemy=[];var p=-1,d=-1;for(var o in h){var a=h[o];p=p>a.totalHurt?p:a.totalHurt,d=d>a.totalCure?d:a.totalCure}for(var r in this.result.teams){var s,c=function(e,t,i){for(var n in e.entities){var o=e.entities[n];for(var a in t.push({isMagical:!1,code:o.code,entityId:o.entityId,isSelf:i,maxLife:o.life}),h){(l=h[a]).entityId==t[t.length-1].entityId&&(t[t.length-1].totalHurt=l.totalHurt,t[t.length-1].totalCure=l.totalCure,t[t.length-1].life=l.life,p=p>l.totalHurt?p:l.totalHurt,d=d>l.totalCure?d:l.totalCure)}}if(e.magical&&e.magical.entityId){var r=e.magical.code,s=u.Config.magicalUpgradeConfig(r);if(s[0]&&s[0].costs){var c=JSON.parse(s[0].costs)[0][1];for(var a in t.push({isMagical:!0,code:c,entityId:e.magical.entityId,isSelf:i,maxLife:0}),h){var l;(l=h[a]).entityId==t[t.length-1].entityId&&(t[t.length-1].totalHurt=l.totalHurt,t[t.length-1].totalCure=l.totalCure)}}}t.forEach(function(e){e.maxHurt=p,e.maxCure=d}),t.sort(function(e,t){return e.isMagical?1:t.isMagical?-1:e.entityId-t.entityId})};(s=this.result.teams[r]).playerId==e?c(s,this.data.self,!0):c(s,this.data.enemy,!1)}this.list_my.dataProvider=new eui.ArrayCollection(this.data.self),this.list_ennemy.dataProvider=new eui.ArrayCollection(this.data.enemy)},e.prototype.ChangeContent=function(e){var t=this.list_my.$children;for(var i in t){(n=t[i])&&n.changeState(e)}t=this.list_ennemy.$children;for(var i in t){var n;(n=t[i])&&n.changeState(e)}},e.prototype.initBtn=function(){var e=this;this.btn_hurt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.ChangeContent(u.FightStatistics.LIST_TYPE.HURT),e.img_cure_bg.source="common_img_dikuang03_png",e.img_hurt_bg.source="common_img_dikuang01_png",e.img_result_bg.source="common_img_dikuang03_png",e.img_lb_hurt.source="_fight_m_json.zhandou_txt_shuchu1",e.img_lb_cure.source="_fight_m_json.zhandou_txt_zhiliao2",e.img_lb_result.source="_fight_m_json.zzq_txt_jieguo2"},this),this.btn_cure.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.ChangeContent(u.FightStatistics.LIST_TYPE.CURE),e.img_cure_bg.source="common_img_dikuang01_png",e.img_hurt_bg.source="common_img_dikuang03_png",e.img_result_bg.source="common_img_dikuang03_png",e.img_lb_hurt.source="_fight_m_json.zhandou_txt_shuchu2",e.img_lb_cure.source="_fight_m_json.zhandou_txt_zhiliao1",e.img_lb_result.source="_fight_m_json.zzq_txt_jieguo2"},this),this.btn_result.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.ChangeContent(u.FightStatistics.LIST_TYPE.RESULT),e.img_cure_bg.source="common_img_dikuang03_png",e.img_hurt_bg.source="common_img_dikuang03_png",e.img_result_bg.source="common_img_dikuang01_png",e.img_lb_hurt.source="_fight_m_json.zhandou_txt_shuchu2",e.img_lb_cure.source="_fight_m_json.zhandou_txt_zhiliao2",e.img_lb_result.source="_fight_m_json.zzq_txt_jieguo1"},this)},e.LIST_TYPE={HURT:0,CURE:1},e}(BasePanel);u.ZzqStatistics=e,__reflect(e.prototype,"game.ZzqStatistics");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="FightStatisticsItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.baseitem=customui.BaseItemForChessFactory.create(),this.gp_head.addChild(this.baseitem),this.pb.slideDuration=0,this.pb.labelDisplay.visible=!1},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=this.data.code;this.baseitem.updateData({code:e}),this.baseitem.scaleX=this.baseitem.scaleY=.6,this.baseitem.touchEnabled=this.baseitem.touchChildren=!1,this.changeState(u.FightStatistics.LIST_TYPE.HURT),this.data.isSelf||(this.scaleX=-1,this.gp_head.scaleX=-1,this.bm_num.scaleX=-1)},e.prototype.changeState=function(e){this.pb.value=0,e==u.FightStatistics.LIST_TYPE.HURT?(this.pb.maximum=this.data.maxHurt,this.pb.value=this.data.totalHurt,this.bm_num.text=this.data.totalHurt):e==u.FightStatistics.LIST_TYPE.RESULT?(this.pb.maximum=this.data.maxLife,this.pb.value=this.data.life,this.bm_num.text=this.data.life):(this.pb.maximum=this.data.maxCure,this.pb.value=this.data.totalCure,this.bm_num.text=this.data.totalCure)},e}(eui.ItemRenderer);__reflect(i.prototype,"FightStatisticsItem")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZzqWinEffectSkin",e.gp_root.visible=!1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateEffectInfo=function(e){var t="common_zzqwljs";this.img_type.source="zzq_txt_wulianjuesheng_png",this.lb_name.text=e.name;var i=1580;8==e.winNum?(t="common_zzqbljs",this.img_type.source="zzq_txt_balianjueshi_png",i=1540):10==e.winNum&&(t="common_zzqslcf",this.img_type.source="zzq_txt_shilianchaofan_png",i=1540),this.gp_root.visible=!0,this.img_type.visible=!0,this.gp_root.x=350,this.gp_root.y=70*e.number,egret.Tween.get(this.gp_root).to({x:-70,y:this.gp_root.y},500).call(function(){var e=this;this.img_type.visible=!1,DragonBoneTools.playOnce({effectName:t,parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/2,scaleX:1,scaleY:1,keep:!1,loop:!1,doneCB:function(){e.img_type.visible=!0,egret.Tween.get(e.gp_root).wait(i).to({x:-700,y:e.gp_root.y},800).call(function(){this.gp_root.visible=!1},e)}})},this)},e}(eui.Component);e.ZzqWinEffect=t,__reflect(t.prototype,"customui.ZzqWinEffect",["eui.UIComponent","egret.DisplayObject"])}(customui||(customui={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=i.AppFacade.getInstance().retrieveProxy(i.ZzqPy.N),e.skinName="GuildWarBattleRecordSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.rootPanel.blb_title.text="战斗记录",this.rootPanel.onCloseCB=function(){e.hide()},this.initTabbar(),this.initList()},e.prototype.initList=function(){UIActionManager.hideScrollerBar(this.scl_list),this.list_item.itemRenderer=n},e.prototype.initTabbar=function(){this.tabbar.parent.removeChild(this.tabbar)},e.prototype.updateView=function(e){for(var t=this,i=[],n=0,o=this.proxy.curRoomInfo.players;n<o.length;n++)for(var a=o[n],r=0,s=a.battleRecordList;r<s.length;r++){var c=s[r];c.attackUuid==a.uuid&&0<a.life&&i.push({self:{baseInfo:this.proxy.getPlayerInfoByUuid(c.attackUuid)},opp:{baseInfo:this.proxy.getPlayerInfoByUuid(c.defenceUuid)},result:c.win,battleUuid:c.uuid,cb:function(){t.hide()}})}i.sort(function(e){return e.opp.baseInfo.uuid==t.proxy.curRoomInfo.uuid?-1:1}),i.sort(function(e){return e.self.baseInfo.uuid==t.proxy.curRoomInfo.uuid?-1:1}),this.list_item.dataProvider=new eui.ArrayCollection(i)},e}(BasePanel);i.ZzqBattleRecordPanel=e,__reflect(e.prototype,"game.ZzqBattleRecordPanel");var n=function(t){function e(){var e=t.call(this)||this;return e.fightPy=i.AppFacade.getInstance().retrieveProxy(i.ZzqPy.N),e.skinName="GuildWarBattleRecordPanel_RecordItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_review.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data&&this.data.cb&&this.data.cb(),this.fightPy.BattlePlayerBack(this.data.battleUuid)},this),this.playerHead_self=customui.PlayerHeadFactory.create(),this.gp_playerHead_self.addChild(this.playerHead_self),this.playerHead_opp=customui.PlayerHeadFactory.create(),this.gp_playerHead_opp.addChild(this.playerHead_opp)},e.prototype.dataChanged=function(){this.lb_self.text=this.data.self.baseInfo.name,this.lb_opp.text=this.data.opp.baseInfo.name,this.playerHead_self.x=0,this.playerHead_self.y=0,this.playerHead_self.updateData({vo:this.data.self.baseInfo}),this.playerHead_opp.x=0,this.playerHead_opp.y=0,this.playerHead_opp.updateData({vo:this.data.opp.baseInfo}),this.img_bg.source=this.data.result==EBattleResult.EBattleResultWin?"gonghui_img_shengfudi_png":"gonghui_img_shengfudi2_png"},e}(eui.ItemRenderer);__reflect(n.prototype,"ZzqBattleRecordPanel_RecordItem")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZzqChessCardSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.addTapEvent=function(e){this.tapEvent=e,this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTapEvent,this)},e.prototype.onTapEvent=function(){this.tapEvent&&this.tapEvent(this)},e.prototype.updateData=function(e,t){var i=game.Config.chessHero()[e.code];this.code=e.code,this.nextCode=i.nextCode,this.race=i.race,this.needMoney=i.costNum,this.color=i.color,this.cu_model.update({code:e.code,model:i.model,isStatic:!0}),this.pos=e.pos,this.lb_name.text=i.name,this.img_profession.source=SubProfessionConfig[i.subProfession].icon,this.img_race.source=HeroRaceConfig[i.race].raceIcon,this.lb_name.textColor=game.GeneralConfig.getColorByColor(i.color),this.blb_money.text="x"+i.costNum,this.blb_nomoney.text="x"+i.costNum,this.updateCardColor(t)},e.prototype.updateCardColor=function(e){this.blb_money.visible=e>=this.needMoney,this.blb_nomoney.visible=!this.blb_money.visible},e}(eui.Component);e.ZzqChessCard=t,__reflect(t.prototype,"customui.ZzqChessCard",["eui.UIComponent","egret.DisplayObject"])}(customui||(customui={})),function(u){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZzqChessCardDetailSkin",e.proxy=u.AppFacade.getInstance().retrieveProxy(u.ZzqPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_sell.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.vo&&e.proxy.SellCard(e.vo.pos,e.vo.uuid,function(){e.hide()})},this)},e.prototype.updateView=function(e,t){if(e&&e.vo){this.vo=e.vo;var i=u.Config.chessHero()[this.vo.code];this.lb_name.text=i.name,this.img_profession.source=SubProfessionConfig[i.subProfession].icon,this.img_race.source=HeroRaceConfig[i.race].raceIcon,this.blb_money.text="x"+i.costNum,this.blb_money_sell.text="x"+i.decomposeNum,this.gp_head.removeChildren();var n=customui.BaseItemForChessFactory.create({vo:this.vo});this.gp_head.addChild(n);var o=[],a=JSON.parse(i.baseAttr);o=u.GeneralConfig.AttrAddAttr(o,a),this.blb_attack.text=u.GeneralConfig.getAttrValue(o[0][1]),this.blb_HP.text=u.GeneralConfig.getAttrValue(o[1][1]),this.blb_defense.text=u.GeneralConfig.getAttrValue(o[2][1]),this.blb_speed.text=u.GeneralConfig.getAttrValue(o[3][1]),this.lb_heroInfo.text=i.desc;var r=[];0!=i.posSkill1&&r.push(i.posSkill1),0!=i.posSkill2&&r.push(i.posSkill2),0!=i.posSkill3&&r.push(i.posSkill3),0!=i.actSkill&&r.push(i.actSkill);var s=[this.cu_skill0,this.cu_skill1,this.cu_skill2,this.cu_skill3],c=[this.lb_skillname0,this.lb_skillname1,this.lb_skillname2,this.lb_skillname3],l=[this.lb_skillshow0,this.lb_skillshow1,this.lb_skillshow2,this.lb_skillshow3],h=[this.img_type0,this.img_type1,this.img_type2,this.img_type3],p=[this.gp_skill0,this.gp_skill1,this.gp_skill2,this.gp_skill3];for(var d in s)r[d]?(p[d].visible=!0,this.updateSkillInfo(r[d],s[d],c[d],l[d],h[d],p[d])):p[d].visible=!1;this.btn_sell.visible=!e.isShowBtn}else this.hide()},e.prototype.updateSkillInfo=function(e,t,i,n,o,a){var r=u.Config.skillBaseConfig()[e];i.text=r.name,n.text=r.desc,1==r.action?o.source="zzq_icon_pu_png":2==r.action?o.source="zzq_icon_zhu_png":3==r.action&&(o.source="zzq_icon_bei_png"),t.updateItem({code:e,notNeedLevel:!0})},e}(BasePanel);u.ZzqChessCardDetail=e,__reflect(e.prototype,"game.ZzqChessCardDetail")}(game||(game={})),function(t){var e=function(i){function e(e){var t=i.call(this)||this;return t.RANK_IMAGE={"青铜":"paiweisai_txt_qingtong","白银":"paiweisai_txt_baiyin","黄金":"paiweisai_txt_huangjin","铂金":"paiweisai_txt_bojin","钻石":"paiweisai_txt_zuanshi","星耀":"paiweisai_txt_xingyao","王者":"paiweisai_txt_wangzhe"},t.skinName="ZzqChessPlayerHeadSkin",t.vo=e,t.myUuid=e.myUuid,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.originX=this.gp_root.x,this.img_hurt.visible=!1,this.cu_playerHead=t.ZzqPlayerHeadFactory.create(),this.cu_playerHead.x=this.cu_playerHead.y=1.34,this.cu_playerHead.width=this.cu_playerHead.height=80,this.cu_playerHead,this.gp_root.addChild(this.cu_playerHead),this.vo&&(this.updateData(this.vo),this.updateRankInfo())},e.prototype.addTapEvent=function(e){this.tapEvent=e,this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTapEvent,this)},e.prototype.onTapEvent=function(){this.tapEvent&&this.tapEvent(this)},e.prototype.updateRankInfo=function(){var e,t=game.Config.chessStarLevel(),i=this.vo.grade;for(var n in t){var o=t[n];if(!(i>=o.requestGrade))break;e=o}if(e){for(var a in this.img_rank_0.source=ResourceUtils.png(e.icon),this.RANK_IMAGE)if(-1!=e.name.search(a)){this.img_rank_1.source=ResourceUtils.png(this.RANK_IMAGE[a]);break}0!=e.num?(this.img_rank_2.visible=!0,this.img_rank_2.source="paiweisai_img_"+e.num+"_png"):this.img_rank_2.visible=!1}},e.prototype.updateData=function(e){if(this.cu_playerHead){if(this.vo=e&&e.vo,this.cu_playerHead.updateData({vo:this.vo}),!this.vo)return this.lb_name.text="",void(this.img_rank_1.source=this.img_rank_2.source="");if(this.img_my.visible=this.vo.uuid===this.myUuid,this.lb_name.text=this.vo.name,this.blb_level.text=this.vo.level+"",this.vo.life<this.pb_hp.value){if(this.vo.life<=0&&this.pb_hp.value<=0)return;DragonBoneTools.playOnce({effectName:"common_zhuahen",parent:this.gp_daoguang,x:this.gp_daoguang.width/2,y:this.gp_daoguang.height/2,scaleX:1,scaleY:1,keep:!1,loop:!1,doneCB:function(){}});var t=this.pb_hp.value-this.vo.life;egret.Tween.get(this.blb_blood).call(function(){this.blb_blood.text="-"+t,this.blb_blood.visible=!0},this).wait(2e3).call(function(){this.blb_blood.visible=!1},this)}this.pb_hp.value=this.vo.life}},e}(eui.Component);t.ZzqChessPlayerHead=e,__reflect(e.prototype,"customui.ZzqChessPlayerHead",["eui.UIComponent","egret.DisplayObject"])}(customui||(customui={})),function(e){var t=function(){function e(){}return e.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.ZzqPlayerHead",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},e.clear=function(){Utils.ObjectPoolMgr.clearClass("customui.ZzqPlayerHead")},e}();e.ZzqPlayerHeadFactory=t,__reflect(t.prototype,"customui.ZzqPlayerHeadFactory");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ZzqPlayerHeadSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.addTapEvent=function(e){this.tapEvent=e},e.prototype.onTapEvent=function(){if(this.tapEvent)this.tapEvent();else if(this.img_canInvite.visible){var n=game.AppFacade.getInstance().retrieveProxy(game.FriendPy.N),e=game.AppFacade.getInstance().retrieveProxy(game.ZzqPy.N),o=game.Config.broadcastConfig()[40].content,t=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N),a=[[2,t.playerInfoVO.name,t.playerInfoVO.playerId,EEntityType.EEntityTypePlayer],[1,"<<点击加入",e.curRoomInfo.id,MODULE.Wchess]];n.getFriendList(function(){PopUpManager.addPopUp({obj:new game.InviteFriendView({moduleId:MODULE.Wchess,tabbarType:11,inviteCallback:function(e,t){var i=game.AppFacade.getInstance().retrieveProxy(game.MainPy.N);i.addPrivatePlayer(e),i.SendMessage(EChatChannelType.EChatChannelTypePrivate,o,e,function(){n.addInviteHistory(MODULE.Wchess,e),t&&t()},EChatSendCheckType.None,JSON.stringify(a),!0)}})})})}},e.prototype.updateData=function(e){if(this.vo=e&&e.vo,this.vo){if(""!=this.vo.avatar)this.img_icon.visible=!0,this.img_icon.source=ResourceUtils.png(this.vo.avatar);else{var t=JSON.parse(game.Config.constConfig().DefaultAvatar.constValue)[0];this.img_icon.visible=!0,this.img_icon.source=t+"_png"}this.img_empty.visible=!1}else this.img_icon.visible=!1,this.img_empty.visible=!0;this.img_canInvite.visible=e&&e.emptyCanInvite,e&&this.addTapEvent(e.tapEvent)},e.prototype.switchCanInviteStatus=function(e){this.vo?this.img_canInvite.visible=!1:this.img_canInvite.visible=e},e.prototype.reset=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTapEvent,this),this.tapEvent=void 0,this.scaleX=this.scaleY=1,this.width=this.height=void 0,this.x=this.y=0,this.img_icon.source="",this.horizontalCenter=this.verticalCenter=void 0,this.img_empty.visible=this.img_canInvite.visible=!1,UIActionManager.setAbsGrey(this,!1)},e.prototype.onOPReset=function(){this.reset()},e.prototype.onOPComeBack=function(e,t){e&&this.updateData(e),this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTapEvent,this)},e.prototype.onOPClean=function(){},e.prototype.onOPCheck=function(e){egret.log("alive")},e}(eui.Component);e.ZzqPlayerHead=i,__reflect(i.prototype,"customui.ZzqPlayerHead",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(customui||(customui={})),function(l){var e=function(i){function e(){var e=i.call(this)||this;return e.skinName="ZzqPlayerInfoSkin",e.py=l.AppFacade.getInstance().retrieveProxy(l.ZzqPy.N),e}return __extends(e,i),e.prototype.childrenCreated=function(){if(i.prototype.childrenCreated.call(this),!this.Gruop_pkm.$children.length)for(var e=1;e<=ZZQ_CONST.SHANGZHEN_NUM;e++){var t=customui.BaseItemForChessFactory.create();t.scaleX=t.scaleY=.6,t.touchEnabled=t.touchChildren=!1,e<4?(t.x=70*(e-1)+65,t.y=0):(t.x=70*(e-4)+65,t.y=70),this.Gruop_pkm.addChild(t)}},e.prototype.updatePlayerInfo=function(){this.lb_name.text=this.vo.name,this.lb_id.text="ID："+this.vo.uuid,this.blb_money.text="x"+this.vo.gold;for(var e=l.Config.chessLevelHero(this.vo.level),t=JSON.parse(e.stationList),i=JSON.parse(this.vo.stationList),n=1;n<=ZZQ_CONST.SHANGZHEN_NUM;n++){var o=this.Gruop_pkm.getChildAt(n-1);if(t[n-1]){for(var a=!1,r=0,s=i;r<s.length;r++){var c=s[r];if(c[0]==n){o.updateData({code:c[1]}),a=!0;break}}a||o.resetFixedStyle()}else o.resetFixedStyle(),o.img_icon.source="common_img_xiaosuo_png"}this.cu_ph.updateData({vo:this.vo})},e.prototype.updateView=function(e){this.vo=e.vo,this.vo&&this.updatePlayerInfo()},e.prototype.perClose=function(){},e}(BasePanel);l.ZzqPlayerInfo=e,__reflect(e.prototype,"game.ZzqPlayerInfo")}(game||(game={})),function(e){var t=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._maximum=100,e._value=0,e.labelFunction=function(e,t){return e+"/"+t},e._curValue=0,e.step=1,e.needStep=!1,e._startingAngle=0,e._antiClockwise=!0,e.updateAvailable=!1,e.angleOffset=-Math.PI/2,e.firstMdfValue=!0,e}return __extends(e,t),Object.defineProperty(e.prototype,"maximum",{get:function(){return this._maximum},set:function(e){this._maximum=e,this._value>this._maximum&&(this._value=this._maximum),this.updateProgress()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e>this._maximum?this._maximum:e,this.updateProgress(),this.firstMdfValue=!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startingAngle",{get:function(){return this._startingAngle},set:function(e){this._startingAngle=e,this.updateProgress()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"antiClockwise",{get:function(){return this._antiClockwise},set:function(e){this._antiClockwise=e,this.updateProgress()},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.thumb&&(this.updateAvailable=!0),this.updateProgress()},e.prototype.updateProgress=function(){if(this.updateAvailable){if(this.thumb.validateNow(),!this.thumb.mask){var e=new egret.Shape;this.thumb.mask=e,this.thumb.parent.addChild(e)}var t=this.thumb.mask,i=Utils.ComponentUtils.getPosInView(this.thumb,{x:this.thumb.width/2,y:this.thumb.height/2},this.thumb.parent),n=i.x,o=i.y,a=1.42*Math.max(this.thumb.width,this.thumb.height)/2,r=Math.PI/180*this._startingAngle+this.angleOffset,s=this._startingAngle*Math.PI/180+this._value/this._maximum*2*Math.PI*(this._antiClockwise?-1:1)+this.angleOffset;t.graphics.clear(),t.graphics.beginFill(0),t.graphics.moveTo(n,o),t.graphics.lineTo(n+a*Math.cos(r),o+a*Math.sin(r)),t.graphics.drawArc(n,o,a,r,s,this._antiClockwise),t.graphics.lineTo(n,o),t.graphics.endFill(),this.labelDisplay&&(this.firstMdfValue||!this.needStep?(this._curValue=this._value,this.labelDisplay.text=this.labelFunction(this._value,this._maximum)):this.addProgressEffect())}},e.prototype.addProgressEffect=function(){var e=this;if(this._curValue!=this._value){var t=this._curValue>this._value;this._curValue=t?this._curValue-this.step:this._curValue+this.step,t!=this._curValue>this._value&&(this._curValue=this._value),this.labelDisplay.text=this.labelFunction(this._curValue,this._maximum),this.labelDisplay.scaleX=this.labelDisplay.scaleY=.7,egret.Tween.get(this.labelDisplay).to({scaleX:1,scaleY:1},100).call(function(){e.addProgressEffect()})}},e}(eui.Component);e.RoundProgressBar=t,__reflect(t.prototype,"customui.RoundProgressBar")}(customui||(customui={}));var GameRootLayer=function(t){function r(){var e=t.call(this)||this;return e.tabLayer=new eui.UILayer,e.mainLayer=new eui.UILayer,e.panelLayer=new eui.UILayer,e.popMsgLayer=new eui.UILayer,e.maskLayer=new eui.UILayer,e.loadLayer=new eui.UILayer,e.fixedTopFrame=new egret.Sprite,e.fixedBottomFrame=new egret.Sprite,e.masks=new Array,e.GUIDE_MASK_NAME="GUIDE_MASK",e.GUIDE_MASK_RADIUS=22,e.GUIDE_MASK_SIZE=1e3,e.globalOffsetY=0,e.isSizeDirty=!1,e.init(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStageView,e),e.viewStack={tabLayer:[],mainLayer:[],panelLayer:[]},window.addEventListener("resize",function(){r.gameLayer().isSizeDirty||(r.gameLayer().isSizeDirty=!0,egret.setTimeout(function(){"portrait"==(window.innerWidth>window.innerHeight?"landscape":"portrait")?r.gameLayer().stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH:(r.gameLayer().stage.orientation=egret.OrientationMode.AUTO,r.gameLayer().stage.scaleMode=egret.StageScaleMode.SHOW_ALL),r.gameLayer().isSizeDirty=!1},e,350))},!1),e}return __extends(r,t),r.prototype.onAddToStageView=function(){egret.log("当前stage尺寸",Utils.DeviceUtils.curWidth(),Utils.DeviceUtils.curHeight(),window.innerWidth,window.innerHeight),"portrait"==(window.innerWidth>window.innerHeight?"landscape":"portrait")?this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH:(this.stage.orientation=egret.OrientationMode.AUTO,this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL),this.stage.frameRate=30,Utils.TouchUtils.activateGlobalTouch(this),Utils.TouchUtils.addGlobalTouch(function(e){e.target instanceof eui.Button&&Utils.SoundManager.playSound(SOUND_EFF_TYPE.btn_tap)},"CLICK_SOUND_EFFECT")},r.gameLayer=function(){return this._instance||(this._instance=new r),this._instance},r.prototype.init=function(){this.touchEnabled=!1,this.mainLayer.touchEnabled=!1,this.tabLayer.touchEnabled=!1,this.panelLayer.touchEnabled=!1,this.popMsgLayer.touchEnabled=!1,this.maskLayer.touchEnabled=!1,this.loadLayer.touchEnabled=!1,this.addChild(this.tabLayer),this.addChild(this.mainLayer),this.addChild(this.panelLayer),this.addChild(this.popMsgLayer),this.addChild(this.maskLayer),this.addChild(this.loadLayer)},r.prototype.preloadRes=function(){var t=this;this.loadingEffectKaiGuan||DragonBoneTools.create("common_miwu",function(e){e.x=t.maskLayer.width/2,e.y=t.maskLayer.height/2,e.visible=!1,t.loadingEffectKaiGuan=e,t.loadLayer.addChild(e)})},r.prototype.reset=function(){this.touchEnabled=!1,this.mainLayer.touchEnabled=!1,this.tabLayer.touchEnabled=!1,this.panelLayer.touchEnabled=!1,this.popMsgLayer.touchEnabled=!1,this.maskLayer.touchEnabled=!1,this.loadLayer.touchEnabled=!1,this.removeChild(this.tabLayer),this.removeChild(this.mainLayer),this.removeChild(this.panelLayer)},r.prototype.bindView=function(e,t,i,n,o){void 0===t&&(t=0),void 0===i&&(i=void 0),void 0===n&&(n=void 0),i||(i=r.gameLayer().tabLayer),i.contains(e)||(null!=n?i.addChildAt(e,n):i.addChild(e)),r.gameLayer().arrangeViewVisible(),o&&o(),UIActionManager.playUIAction(e,t,function(){})},r.prototype.switchTouchEnable=function(e){this.maskLayer.touchEnabled=!e},r.prototype.colorSignCB=function(){Utils.MsgUtils.addMidMsg("请按当前指引点击")},r.prototype.switchDarkMaskForGuide=function(e,t){var i=this.makeMaskGp();if(e){i.visible=!0;var n=1.3*(t.r&&t.r+5||70)/this.GUIDE_MASK_RADIUS;i.scaleX=i.scaleY=n,i.x=t.x,i.y=t.y,this.maskTouchCB=t&&t.maskCB,t.cb&&t.cb()}else i.visible=!1},r.prototype.makeMaskGp=function(){var e=this,t=r.gameLayer().maskLayer.getChildByName(this.GUIDE_MASK_NAME);if(!t){(t=new eui.Group).width=t.height=this.GUIDE_MASK_SIZE,t.anchorOffsetX=t.anchorOffsetY=this.GUIDE_MASK_SIZE/2,t.name=this.GUIDE_MASK_NAME,t.touchEnabled=!1,r.gameLayer().maskLayer.addChild(t);var i=new eui.Image("xinshou_img_zhedang_png");i.touchEnabled=!1,t.addChild(i);for(var n=0;n<4;n++){var o=new eui.Group;o.width=this.GUIDE_MASK_SIZE/2-.6*this.GUIDE_MASK_RADIUS,o.height=this.GUIDE_MASK_SIZE/2+.6*this.GUIDE_MASK_RADIUS,o.rotation=90*n,0<n&&n<3&&(o.x=this.GUIDE_MASK_SIZE),1<n&&n<4&&(o.y=this.GUIDE_MASK_SIZE),Utils.TouchUtils.addTouchListener(o,function(){e.maskTouchCB&&e.maskTouchCB()}),t.addChild(o);var a=new eui.Group;a.width=.2*this.GUIDE_MASK_RADIUS,a.height=.2*this.GUIDE_MASK_RADIUS,a.rotation=90*n,a.x=0<n&&n<3?o.height:o.width,a.y=1<n&&n<4?o.height:o.width,t.addChild(a)}}return t},r.prototype.makeTouchLayer=function(e,t,i){var n,o=this,a=new eui.Group;a.percentWidth=100,a.percentHeight=100,this.popMsgLayer.addChild(a);var r=new eui.Label;if(r.text="点击屏幕继续",r.horizontalCenter=0,r.bottom=250,UIActionManager.fadeBlink(r,!0),a.addChild(r),a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n&&egret.clearInterval(n),this.popMsgLayer.removeChild(a),e&&e.call(t)},this),i){var s=i;r.text="点击屏幕继续("+s/1e3+"s)",n=egret.setInterval(function(){(s-=1e3)<=0?(egret.clearInterval(n),n=void 0,o.popMsgLayer.removeChild(a),e&&e.call(t)):r.text="点击屏幕继续("+s/1e3+"s)"},this,1e3)}r.visible=!1},r.prototype.onPopStatusUpdate=function(e,t){this.setViewStackDirty()},r.prototype.arrangeViewVisible=function(){var r=function(e){var t=0;return e.$children.forEach(function(e){e.skinName&&t++}),t},e=function(e,t,i){void 0===i&&(i=!1);var n=r(e);for(var o in e.$children){var a=e.$children[o];if(!(0<n))break;if(a.skinName){if(n-=1,"FightUISkin"==a.skinName)break;a.visible=!(!i||0!=n)||t}}},t=r(this.mainLayer);r(this.tabLayer);this.panelLayer.$children.some(function(e){return"FightUISkin"==e.skinName})?(e(this.mainLayer,!1),e(this.tabLayer,!1),e(this.panelLayer,!1)):(1<t?(e(this.mainLayer,!1,!0),e(this.tabLayer,!1)):(e(this.mainLayer,!0),e(this.tabLayer,!1,!0)),e(this.panelLayer,!0))},r.prototype.showCurViewVisible=function(){var n=this,e=this.getCurViewStack(),t=function(i){e[i].forEach(function(e){var t=n.getViewBySkinName(e);t&&egret.log("【DEBUG】"+i+"#"+e+"_visible:",t.visible)})};for(var i in e)t(i);egret.log("【DEBUG】----------------------------------------------")},r.prototype.setViewStackDirty=function(){this.isViewStackDirty=!0},r.prototype.getCurViewStack=function(){if(this.isViewStackDirty){this.isViewStackDirty=!1,this.viewStack={tabLayer:[],mainLayer:[],panelLayer:[]};for(var e=0,t=this.tabLayer.$children;e<t.length;e++){var i=t[e];BaseTab.prototype.isPrototypeOf(i)&&i.skinName&&this.viewStack.tabLayer.push(i.skinName)}for(var n=0,o=this.mainLayer.$children;n<o.length;n++){i=o[n];(BasePanel.prototype.isPrototypeOf(i)||BaseView.prototype.isPrototypeOf(i))&&i.skinName&&this.viewStack.mainLayer.push(i.skinName)}for(var a=0,r=this.panelLayer.$children;a<r.length;a++){i=r[a];(BasePanel.prototype.isPrototypeOf(i)||BaseView.prototype.isPrototypeOf(i))&&i.skinName&&this.viewStack.panelLayer.push(i.skinName)}}return this.viewStack},r.prototype.getViewStackJsonStr=function(){if(this.viewStack)return this.getCurViewStack(),JSON.stringify(this.viewStack)},r.prototype.getCurViewSkinName=function(){var e=r.gameLayer().getCurViewStack();return 0<e.panelLayer.length?e.panelLayer[e.panelLayer.length-1]:1<e.mainLayer.length?e.mainLayer[e.mainLayer.length-1]:0<e.tabLayer.length?e.tabLayer[e.tabLayer.length-1]:e.mainLayer[e.mainLayer.length-1]},r.prototype.getViewBySkinName=function(i){var e=function(e){for(var t in e.$children)if(e.$children[t].skinName==i)return e.$children[t]};return e(this.panelLayer)||e(this.mainLayer)||e(this.tabLayer)},r.prototype.showSkipBtn=function(e){var t=this;this.skipBtn&&this.skipBtn.parent&&this.skipBtn.parent.removeChild(this.skipBtn),this.skipBtn=new eui.Image,RES.getResAsync("_common_m_json.common_img_tiaoguojuqing",function(e){t.skipBtn.source=e},this),this.skipBtn.right=10,this.skipBtn.top=25,this.popMsgLayer.addChild(this.skipBtn),this.skipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e(),t.hideSkipBtn()},this)},r.prototype.hideSkipBtn=function(){this.skipBtn&&this.skipBtn.parent&&this.skipBtn.parent.removeChild(this.skipBtn),this.skipBtn=void 0},r.prototype.switchCloudLoading=function(e,t){var i=this;e?this.loadingEffectKaiGuan?(this.loadingEffectKaiGuan.visible=!0,this.loadingEffectKaiGuan.animation.play("guan"),egret.setTimeout(function(){t&&t()},this,700)):t&&t():this.loadingEffectKaiGuan&&this.loadingEffectKaiGuan.visible?(this.loadingEffectKaiGuan.animation.play("kai"),egret.setTimeout(function(){i.loadingEffectKaiGuan.visible=!1,t&&t()},this,900)):t&&t()},Object.defineProperty(r.prototype,"isMenShow",{get:function(){return this.loadingUIEasy?this.loadingUIEasy.isMenShow:this.loadingUI?this.loadingUI.isMenShow:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isMiWuShow",{get:function(){return this.loadingEffectKaiGuan.visible},enumerable:!0,configurable:!0}),r.prototype.onEnterMain=function(){var e=this;this.loadingUI||(this.loadingUI=new game.LoadingUI,this.loadLayer.addChild(this.loadingUI));var t=void 0,i=game.AppFacade.getInstance().retrieveProxy(game.GuidePy.N);1!=game.GameMVC.playerPy.playerInfoVO.level||i.serverGuideInfo[3e7+1]||Utils.SDKMgr.getPerformConfig(37)||(t=function(){i.setGuideInfo(3e7+1),PopUpManager.addPopUp({effectType:0,obj:new game.StartAnimation})}),t||(Utils.SDKMgr.getPerformConfig(7)?game.GameMVC.loginPy.getGameNotice(function(){game.GameMVC.playerPy.checkNeedPopUpdateLog()?PopUpManager.addPopUp({obj:new game.UpdateLogPanel,closeCB:function(){game.GameMVC.playerPy.checkAndPopAds()}}):game.GameMVC.playerPy.checkAndPopAds()}):game.GameMVC.playerPy.checkNeedPopUpdateLog()?PopUpManager.addPopUp({obj:new game.UpdateLogPanel,closeCB:function(){game.GameMVC.playerPy.checkAndPopAds()}}):game.GameMVC.playerPy.checkAndPopAds()),r.gameLayer().switchMenLoading(!1,t,"LOGIN_INTO_MAP"),egret.setTimeout(function(){Utils.FlowUtils.enterFlow("EnterMain"),e.loadingUIEasy&&e.loadingUIEasy.parent&&e.loadingUIEasy.parent.removeChild(e.loadingUIEasy),e.loadingUIEasy=void 0},this,250)},r.prototype.switchMenLoading=function(e,t,i){this.loadingUIEasy?this.loadingUIEasy.switchMenLoading(e,t,i):this.loadingUI?this.loadingUI.switchMenLoading(e,t,i):t&&t()},r}(eui.UILayer);__reflect(GameRootLayer.prototype,"GameRootLayer"),function(i){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new n).register(),(new o).register()},e}();i.ArenaProcessor=e,__reflect(e.prototype,"game.ArenaProcessor");var t=function(e){function t(){return e.call(this,"arena.ArenaInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.ArenaPy.N).updateArenaInfo(t.arenaInfo)},t}(i.ProcessorBase);i.ArenaInfoP=t,__reflect(t.prototype,"game.ArenaInfoP");var n=function(e){function t(){return e.call(this,"arena.NewArenaRecordP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.ArenaPy.N).updateRecordInfo(t.arenaRecord,!0),i.GameMVC.arenaMed.getSubView(i.ArenaMediator.SV.MAIN)&&i.GameMVC.arenaPy.GetArenaInfo(function(){i.GameMVC.arenaPy.ChangeOpponent()})},t}(i.ProcessorBase);i.NewArenaRecordP=n,__reflect(n.prototype,"game.NewArenaRecordP");var o=function(e){function t(){return e.call(this,"arena.ArenaRankRewardP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();t.clientReward&&(i.AppFacade.getInstance().retrieveProxy(i.ArenaPy.N).highestRewardData=t)},t}(i.ProcessorBase);i.ArenaRankRewardP=o,__reflect(o.prototype,"game.ArenaRankRewardP")}(game||(game={})),function(r){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.highestRewardData=void 0,e.opponents=new Array,e.arenaRecords=new Array,NoticeManager.setChildType(NT.ARENA,NT.ARENA_REWARD),NoticeManager.setChildType(NT.ARENA_REWARD,NT.ARENA_REWARD_LINQU),NoticeManager.registerCB(NT.ARENA_REWARD_LINQU,e.checkArenaRewardNotice,e,MODULE.Arena),e}return __extends(i,t),i.prototype.checkArenaRewardNotice=function(){if(!this.arenaInfo)return!1;var e=this.arenaInfo.hRank,t=this.arenaInfo.hRankTargeted,i=(this.arenaInfo.rank,r.Config.arena_hRankReward());for(var n in i){var o=i[n],a=o.rank;if(a){REWARD_STATUS.UNAVAILABLE;if(-1!=t.indexOf(o.rank))REWARD_STATUS.RECEIVED;else if(e<=a)return REWARD_STATUS.AVAILABLE,!0}}return!1},i.prototype.handleDotInfo=function(e){if(void 0===e&&(e=!1),Utils.UnlockMgr.checkPass(MODULE.Arena,!1).allow)if(e)this.GetArenaInfo();else{parseInt(r.Config.constConfig().ArenaMaxCount.constValue);this.arenaInfo.challengeInfo.count}},i.prototype.GetArenaInfo=function(t){var i=this;Utils.Socket.send("arena","GetArenaInfo",{}).then(function(e){i.updateArenaInfo(e.arenaInfo),t&&t()})},i.prototype.ChangeOpponent=function(){var t=this;Utils.Socket.send("arena","ChangeOpponent",{}).then(function(e){t.updateOpponentInfo(e.opponents)})},i.prototype.BuyChallengeCount=function(t,i){var n=this;Utils.Socket.send("arena","BuyChallengeCount",{num:t}).then(function(e){Utils.MsgUtils.addMidMsg("成功购买"+t+"次"),n.arenaInfo.challengeInfo.count=e.challengeInfo.count,n.arenaInfo.challengeInfo.buyCount=e.challengeInfo.buyCount,r.AppFacade.getInstance().sendNotification(CN.ARENA_UPDATE_OPPONENT),i&&i()})},i.prototype.Challenge=function(e,t){var i=this,n='<b><font color="#ffffff" size="22">排名 '+this.arenaInfo.rank+' → </font><font color="#00fff0" size="22">'+e+"</font></b>",o='<b><font color="#ffffff" size="22">排名未发生变化</font></b>';r.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeArena,customParams:{fightBg:"fight_scene_jjc",tips:[this.arenaInfo.rank<=e?o:n,o]},pb1:"arena",pb2:"Challenge",params:{rank:e},doneCB:function(e){console.log("战斗结束",e),t&&t(),i.highestRewardData&&(PopUpManager.addPopUp({obj:new r.ArenaHigherRankPanel(i.highestRewardData),closeCB:function(){r.AppFacade.getInstance().sendNotification(CN.SHOW_WECHAT_SHARE)}}),r.AppFacade.getInstance().sendNotification(CN.QQZONE_PUSH_MESSAGE,{type:"areanChallenge"})),r.AppFacade.getInstance().retrieveProxy(r.FightPy.N).queueExceExitCB()}})},i.prototype.GetArenaRecord=function(t){var i=this;Utils.Socket.send("arena","GetArenaRecord",{}).then(function(e){i.updateRecordInfo(e.arenaRecords),t&&t()})},i.prototype.updateArenaInfo=function(e){this.arenaInfo||(this.arenaInfo=new r.ArenaInfo),this.arenaInfo.update(e),r.AppFacade.getInstance().sendNotification(CN.ARENA_UPDATE_INFO),this.handleDotInfo()},i.prototype.updateOpponentInfo=function(e){var t=this;this.opponents.splice(0),e&&(e.forEach(function(e){t.opponents.push(new r.ArenaPlayerInfo(e))}),this.opponents.sort(function(e,t){return e.rank-t.rank})),r.AppFacade.getInstance().sendNotification(CN.ARENA_UPDATE_OPPONENT)},i.prototype.updateRecordInfo=function(e,t){var i=this;void 0===t&&(t=!1),t?(this.latestRecord=e,this.arenaRecords.push(e)):(this.arenaRecords.splice(0),e.forEach(function(e){i.arenaRecords.push(new r.BattleRecord(e))})),this.arenaRecords.sort(function(e,t){return t.battleDt-e.battleDt})},i.N="ArenaProxy",i}(BaseProxy);r.ArenaPy=e,__reflect(e.prototype,"game.ArenaPy")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return Utils.AssetsMgr.loadGroup("group_arena"),e.skinName="ArenaViewSkin",e.proxy=a.AppFacade.getInstance().retrieveProxy(a.ArenaPy.N),e.backPy=a.AppFacade.getInstance().retrieveProxy(a.BackpackPy.N),e.playerPy=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),e.cu_myPH=customui.PlayerHeadFactory.create(),e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.removeNotice(),Utils.AssetsMgr.destroyGroup("group_arena")},e.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.ARENA_REWARD,this.btn_reward.$children[0],this,BTN_ICON_NOTICE_POS)},e.prototype.removeNotice=function(){NoticeManager.removeNoticeListener(NT.COMMON_SHOP[ShopType.ShopTypeArena])},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.arenaPlayerItems=[this.gp_1,this.gp_2,this.gp_3,this.gp_4,this.gp_5,this.gp_6],this.gp_mine.addChild(this.cu_myPH),this.cu_myPH.scaleX=this.cu_myPH.scaleY=.85,this.cu_myPH.x=40,this.cu_myPH.y=12,this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.MainJumpConfig.jumpTo()},this),this.btn_back1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.MainJumpConfig.jumpTo()},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeArena})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().showSubView(a.RankMediator.N,a.RankMediator.SV.COMMON,{module:"ARENA"})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().showSubView(a.RankMediator.N,a.RankMediator.SV.COMMON,{module:"ARENA2"})},this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().showSubView(a.FightMediator.N,a.FightMediator.SV.RECORD,{pb1:"arena",pb2:"GetArenaRecord",key:"arenaRecords"})},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.buyCount()},this),this.btn_change.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.proxy.ChangeOpponent()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new a.HelpDialog({moduleId:MODULE.Arena})})},this),this.fetch(),this.addNotice()},e.prototype.buyCount=function(){var t=this;Number(a.Config.constConfig().ArenaMaxCount.constValue)<=this.proxy.arenaInfo.challengeInfo.count?Utils.MsgUtils.addMidMsg("当前次数已满"):a.AppFacade.getInstance().showSubView(a.CommonMediator.N,a.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.Arena,hasBuyNum:this.proxy.arenaInfo.challengeInfo.buyCount,buyCB:function(e){t.proxy.BuyChallengeCount(e)},curNum:this.proxy.arenaInfo.challengeInfo.count,maxNum:Number(a.Config.constConfig().ArenaMaxCount.constValue),maxBuyNum:a.Config.VIPConfig().arenaBuyTimes})},e.prototype.fetch=function(){var e=this;this.proxy.ChangeOpponent(),egret.setTimeout(function(){e.proxy.GetArenaInfo()},this,500)},e.prototype.updateView=function(e){var n=this;if(this.proxy.arenaInfo){this.blb_count.text=""+this.proxy.arenaInfo.challengeInfo.count,this.blb_rank.text=""+this.proxy.arenaInfo.rank,this.blb_cap.text=""+Utils.MathUtils.formatNumStyle2(this.playerPy.playerInfoVO.fightCap),this.cu_myPH.updateData({vo:this.playerPy.playerInfoVO});var o=Utils.UnlockMgr.checkPass(MODULE.ArenaSaoDang,!1).allow;this.arenaPlayerItems.forEach(function(e,t){var i=n.proxy.opponents[t];i&&e.update({vo:i,fightCB:function(e){0<n.proxy.arenaInfo.challengeInfo.count?n.proxy.Challenge(e.rank,function(){n.proxy.ChangeOpponent()}):(Utils.MsgUtils.addMidMsg("挑战次数不足"),n.buyCount())},mopUpCB:function(){0<n.proxy.arenaInfo.challengeInfo.count?a.AppFacade.getInstance().showSubView(a.CommonMediator.N,a.CommonMediator.SV.MOP_UP,{pb1:"arena",pb2:"MopUp",params:{rank:i.rank},mopUpTimes:10,cb:function(e){return n.proxy.arenaInfo.challengeInfo.count=e.challengeInfo.count,n.blb_count.text=""+n.proxy.arenaInfo.challengeInfo.count,i.rank>a.GameMVC.arenaPy.arenaInfo.rank?0<n.proxy.arenaInfo.challengeInfo.count:(Utils.MsgUtils.addMidMsg("排名发生变化"),!1)},tipsFunc:function(e){return"第"+e+"次"}}):Utils.MsgUtils.addMidMsg("挑战次数不足")},canFight:1<t||n.proxy.arenaInfo.rank<=10,canMopUp:o&&i.rank>n.proxy.arenaInfo.rank})})}},e}(BaseFull);a.ArenaView=e,__reflect(e.prototype,"game.ArenaView")}(game||(game={})),function(t){var e=function(i){function e(e){var t=i.call(this)||this;return t.skinName="ArenaHigherRankPanelSkin",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;this.params&&(this.bm_cur.text=this.params.rank+"名",this.bm_highest.text=this.params.preHRank+"名",this.bm_diff.text=Number(this.params.preHRank)-Number(this.params.rank)+"",this.CommonIconWithNum.updateItem({code:this.params.clientReward.rewards[0].code,type:this.params.clientReward.rewards[0].type,num:this.params.clientReward.rewards[0].num,style:CommonIconStyle.RIGHT}),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this))},e.prototype.onDestroy=function(){t.AppFacade.getInstance().sendNotification(CN.SHOW_WECHAT_SHARE),t.AppFacade.getInstance().retrieveProxy(t.ArenaPy.N).highestRewardData=void 0},e}(BasePanel);t.ArenaHigherRankPanel=e,__reflect(e.prototype,"game.ArenaHigherRankPanel")}(game||(game={}));var CN=function(){function e(){}return e.CHANGE_PANEL="CHANGE_PANEL",e.GENERAL_PASS_DAY="GENERAL_PASS_DAY",e.HIDE_ALL_SUBVIEW="HIDE_ALL_SUBVIEW",e.LOGIN_FINAL_DONE="LOGIN_FINAL_DONE",e.CONFIG_ALL_LOADED="CONFIG_ALL_LOADED",e.SWITCH_TO_CITY="SWITCH_TO_CITY",e.GAME_HEARTBEAT="GAME_HEARTBEAT",e.SHOW_LOADING="SHOW_LOADING",e.HIDE_LOADING="HIDE_LOADING",e.LOGIN_HTTP_LOGIN_SUCESS="LOGIN_UPDATE_LOGIN",e.LOGIN_SERVER_SELECT="LOGIN_SERVER_SELECT",e.LOGIN_UPDATE_SERVER="LOGIN_UPDATE_SERVER",e.LOGIN_GO_LOGIN_LOGIN_SUCESS="LOGIN_GO_LOGIN_LOGIN_SUCESS",e.LOGIN_GO_LOGIN_LOGIN_FAIL="LOGIN_GO_LOGIN_LOGIN_FAIL",e.LOGIN_GO_LOGIN_LOGIN_NO_ROLE="LOGIN_GO_LOGIN_LOGIN_NO_ROLE",e.LOGIN_GO_LOGINGAME_LOGIN_SUCESS="LOGIN_GO_LOGINGAME_LOGIN_SUCESS",e.LOGIN_MAKE_ROLE_SUCCESS="LOGIN_MAKE_ROLE_SUCCESS",e.MAIN_COORDINATEINFO_UPDATE="MAIN_COORDINATEINFO_UPDATE",e.UPDATE_BG="UPDATE_BG",e.CHANGE_STYLE="CHANGE_STYLE",e.PRETEND_TAB_BTN_CLICK="MainNotify_SET_BTN_CLICK",e.PRETEND_TAB_BTN_CLICK_AFTER="MainNotify_SET_BTN_CLICK_AFTER",e.MAIN_CHAT_UPDATE="MAIN_CHAT_UPDATE",e.MAIN_CHAT_PRIVATEPLAYER_UPDATE="MAIN_CHAT_PRIVATEPLAYER_UPDATE",e.MAIN_CHAT_TASK_STEP="MAIN_CHAT_TASK_STEP",e.MAIN_DEBUG_INFO_UPDATE="MAIN_DEBUG_INFO_UPDATE",e.MAIN_CHANGE_BTN="MAIN_CHANGE_BTN",e.MAIN_UPDATE_BTN="MAIN_UPDATE_BTN",e.MAIN_FORCE_UPDATE_BANNER="MAIN_FORCE_UPDATE_BANNER",e.MAIN_UPDATE_PET="MAIN_UPDATE_PET",e.PLAYERINFO_MAIN_UPDATE="PLAYERINFO_MAIN_UPDATE",e.PLAYER_INFO_ERROR="PLAYER_INFO_ERROR",e.QQZONE_POPUP_VIEW="QQZONE_POPUP_VIEW",e.QQZONE_GIFT_VIEW="QQZONE_GIFT_VIEW",e.QQZONE_PUSH_MESSAGE="QQZONE_PUSH_MESSAGE",e.GOLDHAND_UPDATE="GOLDHAND_UPDATE",e.FIRST_INTO_CITY_FOR_EVERYDAY="FIRST_INTO_CITY_FOR_EVERYDAY",e.EXTREME_CHALLENGE_MODEL_UPDATE="EXTREME_CHALLENGE_MODEL_UPDATE",e.HERO_CHALLENGE_MODEL_UPDATE="HERO_CHALLENGE_MODEL_UPDATE",e.EGGS_UPDATE="EGGS_UPDATE",e.NEWYEARCHALLENGE_UPDATE="NEWYEARCHALLENGE_UPDATE",e.CITY_SWITCH_DBCLOCKPAUSE="CITY_SWITCH_DBCLOCKPAUSE",e.MAIL_OPEN_MAIN="MAIL_OPEN_MAIN",e.MAIL_CLOSE_MAIN="MAIL_CLOSE_MAIN",e.STRONG_OPEN_MAIN="STRONG_OPEN_MAIN",e.STRONG_CLOSE_MAIN="STRONG_CLOSE_MAIN",e.FRIEND_OPEN_MAIN="FRIEND_OPEN_MAIN",e.FRIEND_GIFT_UPDATE="FRIEND_GIFT_UPDATE",e.FRIEND_CLOSE_MAIN="FRIEND_CLOSE_MAIN",e.PLAYER_INFO_UPDATE="PLAYER_INFO_UPDATE",e.PLAYER_LEVEL_UP="PLAYER_LEVEL_UP",e.PLAYER_VIP_LEVEL_UP="PLAYER_VIP_LEVEL_UP",e.PLAYER_OUTLOOK_UPDATE="PLAYER_OUTLOOK_UPDATE",e.FIGHT_REQ_ANY_FIGHT="FIGHT_REQ_ANY_FIGHT",e.FIGHT_SPEED_UPDATE="FIGHT_SPEED_UPDATE",e.FIGHT_MODEL_CREATED="FIGHT_MODEL_CREATED",e.FIGHT_OPEN_FIGHT="FIGHT_OPEN_FIGHT",e.FIGHT_OPEN_OR_CLOSE_FIGHT_TEST="FIGHT_OPEN_OR_CLOSE_FIGHT_TEST",e.FIGHT_CLOSE_FIGHT="FIGHT_CLOSE_FIGHT",e.FIGHT_SKIP_FIGHT="FIGHT_SKIP_FIGHT",e.FIGHT_PZ="FIGHT_PZ",e.FIGHT_RESP_FIGHT_RESULT="FIGHT_RESP_FIGHT_RESULT",e.FIGHT_FIGHT_STATUS_SWITCH="FIGHT_FIGHT_STATUS_SWITCH",e.FIGHT_ON_FIGHT_VISIBLE_SWITCH="FIGHT_ON_FIGHT_VISIBLE_SWITCH",e.FIGHT_FIGHT_UPDATE_UI="FIGHT_FIGHT_UPDATE_UI",e.FIGHT_PAUSE="FIGHT_PAUSE",e.FIGHT_ALL_DONE_AND_EXIT="FIGHT_ALL_DONE_AND_EXIT",e.FIGHT_LET_OBJ_RELEASE_SKILL="FIGHT_LET_OBJ_RELEASE_SKILL",e.FIGHT_CHANGE_ALL_MODEL="FIGHT_CHANGE_ALL_MODEL",e.FIGHT_SHOW_RESULT="FIGHT_SHOW_RESULT",e.FIGHT_TEAM_RECORD_PLAYBACK="FIGHT_TEAM_RECORD_PLAYBACK",e.WORLD_KING_GET_DATA="WORLD_KING_GET_DATA",e.WORLD_KING_ENTER_MODULE="WORLD_KING_ENTER_MODULE",e.BACKPACK_UPDATE="BACKPACK_UPDATE",e.BACKPACK_MULTI_TEAM_UPDATE="BACKPACK_MULTI_TEAM_UPDATE",e.ACTIVITY_OPEN_BY_ENUM="ACTIVITY_OPEN_BY_ENUM",e.ACTIVITY_LIST_UPDATED="ACTIVITY_LIST_UPDATED",e.ACTIVITY_SHOW_TRIGGER="ACTIVITY_SHOW_TRIGGER",e.ACTIVITY_ADD_TRIGGER="ACTIVITY_ADD_TRIGGER",e.ACTIVITY_BASIC_HERO_GIFG_UPDATE="ACTIVITY_SHOW_BASIC_HERO_GIFG",e.ACTIVITY_MID_ALLGIFT_UPDATE="ACTIVITY_MID_ALLGIFT_UPDATE",e.ACTIVITY_BRAVEBOOKSHOP="ACTIVITY_BRAVEBOOKSHOP",e.BRAVEBOOK_LEVEL_UPDATE="BRAVEBOOK_LEVEL_UPDATE",e.NEWBRAVEBOOK_LEVEL_UPDATE="NEWBRAVEBOOK_LEVEL_UPDATE",e.RECHARGE_OPEN="RECHARGE_OPEN",e.RECHARGE_GET_DATA="RECHARGE_GET_DATA",e.SHOP_GET_ALL_DATA="SHOP_GET_ALL_DATA",e.SHOP_OPEN_BY_TYPE="SHOP_OPEN_BY_TYPE",e.SHOP_INFO_UPDATE="SHOP_INFO_UPDATE",e.GUIDE_INFO_UPDATE="GUIDE_INFO_UPDATE",e.GUIDE_KEY_BTN_CLICK="GUIDE_KEY_BTN_CLICK",e.GUIDE_KEY_BTN_CLICK_2="GUIDE_KEY_BTN_CLICK_2",e.GUIDE_MAKE_FLOW="GUIDE_INIT_FLOW",e.GUIDE_CHECK_CUR_STEP="GUIDE_CHECK_CUR",e.GUIDE_VIEW_STACK_CHANGE="GUIDE_VIEW_STACK_CHANGE",e.GUIDE_NET_RESP="GUIDE_NET_RESP",e.GUIDE_UPDATE_MASK_AND_SCREEN_CONFIG="GUIDE_UPDATE_MASK_AND_SCREEN_CONFIG",e.GUIDE_UPDATE_TIPS_CONFIG="GUIDE_UPDATE_TIPS_CONFIG",e.GUIDE_STEP_UPDATE="GUIDE_GO",e.GUIDE_SWITCH_EDITOR="GUIDE_SWITCH_EDITOR",e.GUIDE_MARK_TAKS_DONE="GUIDE_MARK_TAKS_DONE",e.GUIDE_EDIT_RESET="GUIDE_EDIT_RESET",e.GUIDE_SE_POP_JINHUA_WIN="GUIDE_SE_POP_JINHUA_WIN",e.GUIDE_SE_FAKE_EVO_MY_PKM="GUIDE_SE_FAKE_EVO_MY_PKM",e.GUIDE_SE_DRAG_FORMATION="GUIDE_SE_DRAG_FORMATION",e.GUIDE_SE_DRAG_FORMATION_2="GUIDE_SE_DRAG_FORMATION_2",e.GUIDE_SE_FIGHT_TURN_BLACK="GUIDE_SE_FIGHT_TURN_BLACK",e.GUIDE_SE_FIGHT_TURN_BLACK_REVERT="GUIDE_SE_FIGHT_TURN_BLACK_REVERT",e.GUIDE_SWITCH_SHOWING_GUIDE="GUIDE_SWITCH_SHOWING_GUIDE",e.GUIDE_FIRST_CHARPTER_END="GUIDE_FIRST_CHARPTER_END",e.TASK_GET_REWARDS_POP_CLOSE="TASK_GET_REWARDS_POP_CLOSE",e.TASK_OPEN_MAIN="TASK_OPEN_MAIN",e.TASK_DAILY_UPDATE="TASK_DAILY_UPDATE",e.TASK_UPDATE="TASK_GUIDE_UPDATE",e.UNLOCK_TASK_GET_DATA="UNLOCK_TASK_GET_DATA",e.UNLOCK_TASK_UPDATE="UNLOCK_TASK_UPDATE",e.RANK_OPEN_MAIN="RANK_OPEN_MAIN",e.GUILD_FIRST_INFO_UPDATE="GUILD_FIRST_INFO_UPDATE",e.GUILD_GUILD_RANKED_LIST_UPDATE="GUILD_GUILD_RANKED_LIST_UPDATE",e.GUILD_GUILD_MEMBER_LIST_UPDATE="GUILD_GUILD_MEMBER_LIST_UPDATE",e.GUILD_GUILD_APPLY_LIST_UPDATE="GUILD_GUILD_APPLY_LIST_UPDATE",e.GUILD_INFO_UPDATE="GUILD_INFO_UPDATE",e.GUILD_INBREAK_GET_DATA="GUILD_INBREAK_GET_DATA",e.GUILD_INSTANCE_OPEN="GUILD_INSTANCE_OPEN",e.GUILD_INSTANCE_UPDATE="GUILD_INSTANCE_UPDATE",e.GUILD_COLLECT_INFO_UPDATE="GUILD_COLLECT_INFO_UPDATE",e.GUILD_BOSS_UPDATE_MAP="GUILD_BOSS_UPDATE_MAP",e.GUAJI_HIDE_ALL_SUBVIEW="GUAJI_HIDE_ALL_SUBVIEW",e.GUAJI_ON_ME_WALK_TO="GUAJI_ON_ME_WALK_TO",e.GUAJI_ON_ME_STOP_ON="GUAJI_ON_ME_STOP_ON",e.GUAJI_LAYER_INFO_UPDATE="GUAJI_LAYER_INFO_UPDATE",e.GUAJI_LAYER_INFO_TIPS_UPDATE="GUAJI_LAYER_INFO_TIPS_UPDATE",e.GUAJI_LAYER_EVENT_INFO_UPDATE="GUAJI_LAYER_EVENT_INFO_UPDATE",e.GUAJI_PRETEND_CLICK_TILED="GUAJI_PRETEND_CLICK_TILED",e.GUAJI_RESET_CAMERA="GUAJI_RESET_CAMERA",e.GUAJI_MAP_SCALE="GUAJI_MAP_SCALE",e.GUAJI_MAP_INIT_ALL_DONE="GUAJI_MAP_INIT_ALL_DONE",e.GUAJI_GOLD_REFRESH="GUAJI_GOLD_REFRESH",e.GUAJI_OPEN_CBT="GUAJI_OPEN_CBT",e.GUAJI_FINGER_TO_XY="GUAJI_FINGER_TO_XY",e.GUAJI_ENTER_EP="GUAJI_ENTER_EP",e.GUAJI_ENTER_LAYER="GUAJI_ENTER_LAYER",e.GUAJI_FINGER_APPEAR_TO_XY="GUAJI_FINGER_APPEAR_TO_XY",e.GUAJI_UPDATE_MINE="GUAJI_UPDATE_MINE",e.GUAJI_HUDONG_WITH_EP="GUAJI_HUDONG_WITH_EP",e.GUAJI_SHOW_ME_PATH_TO_POS="GUAJI_SHOW_ME_PATH_TO_POS",e.GUAJI_MAP_ON_TOUCH_TILE_POS="GUAJI_MAP_ON_TOUCH_TILE_POS",e.GUAJI_UPDATE_RES_NOTICE="GUAJI_UPDATE_RES_NOTICE",e.GUAJI_MAP_BACKPACK_UPDATE="GUAJI_MAP_BACKPACK_UPDATE",e.GUAJI_DEMON_UPDATE="GUAJI_DEMON_UPDATE",e.GUAJI_MULTI_GUAJI_ROOM_UPDATE="GUAJI_MULTI_GUAJI_ROOM_UPDATE",e.MANOR_FORCE_EXIT="MANOR_FORCE_EXIT",e.MANOR_ALL_PLAYER_UPDATE="MANOR_ALL_PLAYER_UPDATE",e.MANOR_ALL_MANOR_UPDATE="MANOR_ALL_MANOR_UPDATE",e.MANOR_DETAIL_UPDATE="MANOR_DETAIL_UPDATE",e.MANOR_REQUIRE_DETAIL="MANOR_REQUIRE_DETAIL",e.MANOR_RECORD_UPDATE="MANOR_RECORD_UPDATE",e.MANOR_WALKNUM_UPDATE="MANOR_WALKNUM_UPDATE",e.MANOR_BLOODNUM_UPDATE="MANOR_BLOODNUM_UPDATE",e.MANOR_GET_AWARD="MANOR_GET_AWARD",e.MANOR_OPEN_MINI_MAP="MANOR_OPEN_MINI_MAP",e.MANOR_CHOICE_MINI_MAP_POINT="MANOR_CHOICE_MINI_MAP_POINT",e.MANOR_PLAYER_PROXY_INFO_UPDATE="MANOR_PLAYER_PROXY_INFO_UPDATE",e.MANOR_AUTO_CAPTURE_UPDATE="MANOR_AUTO_CAPTURE_UPDATE",e.MANOR_COLLECT_REWARD_SHOW="MANOR_COLLECT_REWARD_SHOW",e.MANOR_COLLECT_SETTING_UPDATE="MANOR_COLLECT_SETTING_UPDATE",e.MANOR_REMOVE_ONE_MANOR="MANOR_REMOVE_ONE_MANOR",e.MANOR_REMOVE_ONE_PLAYER="MANOR_REMOVE_ONE_PLAYER",e.MANOR_CAPTURE_SUCCESS="MANOR_CAPTURE_SUCCESS",e.MANOR_UPDATE_RANKS="MANOR_UPDATE_RANKS",e.ME_MOVE_FINISH="ME_MOVE_FINISH",e.ME_MOVE_ONE_TILE="ME_MOVE_ONE_TILE",e.DEEP_NEST_UPDATEMAIN="DEEP_NEST_UPDATEMAIN",e.DEEP_NEST_UPDATEHERO="DEEP_NEST_UPDATEHERO",e.DEEP_NEST_UPDATEPETANDART="DEEP_NEST_UPDATEPETANDART",e.DEEP_NEST_UPDATEREWARD="DEEP_NEST_UPDATEREWARD",e.DEEP_NEST_UPDATECOUNT="DEEP_NEST_UPDATECOUNT",e.DEEP_NEST_SETPOSBYWAIGUA="DEEP_NEST_SETPOSBYWAIGUA",e.HERO_SPIRIT_UPDATEMAIN="HERO_SPIRIT_UPDATEMAIN",e.FASHION_UPDATEMAIN="FASHION_UPDATEMAIN",e.SKILL_UPDATE="SKILL_UPDATE",e.SKILL_CHOOSE_CLEAN="SKILL_CHOOSE_CLEAN",e.MOUNT_UPDATEMAIN="MOUNT_UPDATEMAIN",e.MOUNT_UPDATESTAR="MOUNT_UPDATESTAR",e.HERO_EQUIP_UPDATE="HERO_EQUIP_UPDATE",e.HERO_ARTIFACT_UPDATE="HERO_ARTIFACT_UPDATE",e.HERO_DERMA_UPDATE="HERO_DERMA_UPDATE",e.HERO_GACHA_UPDATE="HERO_GACHA_UPDATE",e.ARENA_UPDATE_INFO="ARENA_UPDATE_INFO",e.ARENA_UPDATE_OPPONENT="ARENA_UPDATE_OPPONENT",e.TEAM_ARENA_UPDATE_INFO="TEAM_ARENA_UPDATE_INFO",e.TEAM_ARENA_UPDATE_TEAM_INFO="TEAM_ARENA_UPDATE_TEAM_INFO",e.TEAM_ARENA_UPDATE_GROUP_INFO="TEAM_ARENA_UPDATE_GROUP_INFO",e.TEAMEXPE_UPDATE_INFO="TEAMEXPE_UPDATE_INFO",e.TEAMEXPE_UPDATE_MAP="TEAMEXPE_UPDATE_MAP",e.TEAMEXPE_UPDATE_TEAM_INFO="TEAMEXPE_UPDATE_TEAM_INFO",e.TEAMEXPE_JUMP_TO_CHAPTER="TEAMEXPE_JUMP_TO_CHAPTER",e.TEAMEXPE_OPEN_GATE="TEAMEXPE_OPEN_GATE",e.UPDATE_APPLYRECORDS="UPDATE_APPLYRECORDS,",e.CHAMPION_UPDATE_INFO="CHAMPION_UPDATE_INFO",e.HEROCOMMENT_UPDATE="HEROCOMMENT_UPDATE",e.MAGICCOMMENT_UPDATE="MAGICCOMMENT_UPDATE",e.WORLD_BOSS_UPDATE_MAP="WORLD_BOSS_UPDATE_MAP",e.MONEY_UPDATE="MONEY_UPDATE",e.REWARD_CLOSE="REWARD_CLOSE",e.FIGHT_RESULT_CLOSE="FIGHT_RESULT_CLOSE",e.SHOW_WECHAT_SHARE="WECHAT_SHARE",e.ADD_WECHAT_SHARE_INFO="ADD_WECHAT_SHARE_INFO",e.ZZQ_UPDATE_ROOM_INFO="ZZQ_UPDATE_ROOM_INFO",e.ZZQ_UPDATE_HERO_INFO="ZZQ_UPDATE_HERO_INFO",e.ZZQ_UPDATE_CARD_INFO="ZZQ_UPDATE_CARD_INFO",e.ZZQ_UPDATE_CUR_PLAYER="ZZQ_UPDATE_CUR_PLAYER",e.ZZQ_UPDATE_BARRAGE="ZZQ_UPDATE_BARRAGE",e.ZZQ_UPDATE_REWARD_INFO="ZZQ_UPDATE_REWARD_INFO",e.ZZQ_UPDATE_REWARDCUP_INFO="ZZQ_UPDATE_REWARDCUP_INFO",e.ZZQ_STATUS_FIGHT_DAOJISHI="ZZQ_STATUS_FIGHT_DAOJISHI",e.ZZQ_STATUS_FIGHT_END="ZZQ_STATUS_FIGHT_END",e.ZZQ_STATUS_QUIT="ZZQ_STATUS_QUIT",e.DUNGEON_UPDATE_HEROLIST="DUNGEON_UPDATE_HEROLIST",e.DUNGEON_UPDATE_HEROLIST_EFFECT="DUNGEON_UPDATE_HEROLIST_EFFECT",e.DUNGEON_RANDOM_EVENT_ADDLIFE="DUNGEON_RANDOM_EVENT_ADDLIFE",e.DUNGEON_RANDOM_EVENT_MINUSLIFE="DUNGEON_RANDOM_EVENT_MINUSLIFE",e.DUNGEON_RANDOM_EVENT_MINUSLIFE_TEXT="DUNGEON_RANDOM_EVENT_MINUSLIFE_TEXT",e.DUNGEON_RANDOM_EVENT_MINUSGOLD="DUNGEON_RANDOM_EVENT_MINUSGOLD",e.DUNGEON_RANDOM_EVENT_ADDGOLD="DUNGEON_RANDOM_EVENT_ADDGOLD",e.DUNGEON_RANDOM_EVENT_GETHERO="DUNGEON_RANDOM_EVENT_GETHERO",e.DUNGEON_UPDATE_ONE_HERO="DUNGEON_UPDATE_ONE_HERO",e.DUNGEON_USE_ITEM="DUNGEON_USE_ITEM",e.DUNGEON_BOSS_CLEAR="DUNGEON_BOSS_CLEAR",e.DUNGEON_NEW_CHAPTER="DUNGEON_NEW_CHAPTER",e.STORM_WAR_UPDATE_LAYER="STORM_WAR_UPDATE_LAYER",e.STORM_WAR_UPDATE_CREEPS="STORM_WAR_UPDATE_CREEPS",e.STORM_WAR_UPDATE_PLAYERS="STORM_WAR_UPDATE_PLAYERS",e.STORM_WAR_UPDATE_SELF_PLAYER="STORM_WAR_UPDATE_SELF_PLAYER",e.STORM_WAR_UPDATE_WAR="STORM_WAR_UPDATE_WAR",e.STORM_WAR_REMOVE_PLAYER="STORM_WAR_REMOVE_PLAYER",e.STORM_WAR_REMOVE_CREEP="STORM_WAR_REMOVE_CREEP",e.STORM_WAR_FORCE_EXIT="STORM_WAR_FORCE_EXIT",e.STORM_WAR_UPDATE_RANKS="STORM_WAR_UPDATE_RANK",e.STORM_WAR_BATTLE_FINISH="STORM_WAR_BATTLE_FINISH",e.TRIBE_BATTLE_INFO_UPDATED="TRIBE_BATTLE_INFO_UPDATED",e.TRIBE_BATTLE_REVENGE_UPDATED="TRIBE_BATTLE_REVENGE_UPDATED",e.PEAK_WAR_FREE_INFO_UPDATED="PEAK_WAR_FREE_INFO_UPDATED",e.PEAK_WAR_HIGH_INFO_UPDATED="PEAK_WAR_HIGH_INFO_UPDATED",e.TITLE_UPDATE="TITLE_UPDATE",e}();__reflect(CN.prototype,"CN"),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.POS_X=[79,163,243],e.skinName="BattleZoneArenaPlayerItemSkin",e.proxy=game.AppFacade.getInstance().retrieveProxy(game.BattleZoneArenaPy.N),e.cu_playerHead1=i.PlayerHeadFactory.create(),e.cu_playerHead2=i.PlayerHeadFactory.create(),e.cu_playerHead3=i.PlayerHeadFactory.create(),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.clickCB&&e.clickCB(e.vo)},this),this.gp_heads.addChild(this.cu_playerHead1),this.cu_playerHead1.scaleX=this.cu_playerHead1.scaleY=.6,this.cu_playerHead1.addTapEvent(function(){e.vo.team.members[0]&&e.vo.team.members[0].baseInfo&&game.AppFacade.getInstance().showSubView(game.FriendMediator.N,game.FriendMediator.SV.INFO,{playerId:e.vo.team.members[0].baseInfo.playerId})}),this.gp_heads.addChild(this.cu_playerHead2),this.cu_playerHead2.scaleX=this.cu_playerHead2.scaleY=.6,this.cu_playerHead2.addTapEvent(function(){e.vo.team.members[1]&&e.vo.team.members[1].baseInfo&&game.AppFacade.getInstance().showSubView(game.FriendMediator.N,game.FriendMediator.SV.INFO,{playerId:e.vo.team.members[1].baseInfo.playerId})}),this.gp_heads.addChild(this.cu_playerHead3),this.cu_playerHead3.scaleX=this.cu_playerHead3.scaleY=.6,this.cu_playerHead3.addTapEvent(function(){e.vo.team.members[2]&&e.vo.team.members[2].baseInfo&&game.AppFacade.getInstance().showSubView(game.FriendMediator.N,game.FriendMediator.SV.INFO,{playerId:e.vo.team.members[2].baseInfo.playerId})})},e.prototype.update=function(e){var n=this;if(e){this.vo=e.vo,this.clickCB=e.clickCB,this.amILeader=e.amILeader;var t=e.canFight;this.vo?(this.btn_fight.visible=this.amILeader,this.vo.team.serverId?this.lb_name.text="S"+this.vo.team.serverId+"·"+this.vo.team.name:this.lb_name.text=""+this.vo.team.name,3<this.vo.rank?(this.blb_rank.visible=!0,this.img_rank.visible=!1,this.blb_rank.text=this.vo.rank.toString()):(this.blb_rank.visible=!1,this.img_rank.visible=!0,RES.getResAsync("jjc_icon_pm_"+this.vo.rank+"_png",function(e){n.img_rank.source=e},this)),this.gp_heads.$children.forEach(function(e,t){var i=n.vo.team.members[t];e.updateData({vo:i&&i.baseInfo,showTag:!1})}),this.blb_cap.text=""+Utils.MathUtils.formatNumStyle2(this.vo.score),this.btn_fight.visible=this.amILeader&&t,this.vo.team.id==this.proxy.team.id&&(this.btn_fight.visible=!1)):this.btn_fight.visible=!1}},e}(eui.Component);i.BattleZoneArenaPlayerItem=e,__reflect(e.prototype,"customui.BattleZoneArenaPlayerItem",["eui.UIComponent","egret.DisplayObject"])}(customui||(customui={})),function(n){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new i).register()},e}();n.BattleZoneArenaProcessor=e,__reflect(e.prototype,"game.BattleZoneArenaProcessor");var t=function(e){function t(){return e.call(this,"teamArena.TeamArenaInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();n.AppFacade.getInstance().retrieveProxy(n.BattleZoneArenaPy.N).updateArenaInfo(t.info)},t}(n.ProcessorBase);__reflect(t.prototype,"BattleZoneArenaInfoP");var i=function(e){function t(){return e.call(this,"teamArena.ApplyRecordP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody(),i=n.AppFacade.getInstance().retrieveProxy(n.BattleZoneArenaPy.N);i.amILeader()&&(Utils.MsgUtils.addMidMsg("组队竞技场有人申请加入队伍"),i.updateApplyRecord({records:[t.record]}))},t}(n.ProcessorBase);__reflect(i.prototype,"ApplyRecordP");var o=function(e){function t(){return e.call(this,"teamArena.GroupInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();n.GameMVC.battleZoneArenaPy.updateGroupInfo(t.groups)},t}(n.ProcessorBase);__reflect(o.prototype,"GroupInfoP")}(game||(game={})),function(s){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.playerProxy=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N),e._schedule=Utils.TimerManager.createWeeklySchedule(),e.arenaInfo=new s.TeamArenaInfoVO,e.groupInfos=new Array,e.centerTeams=new Array,e.applyRecords=new Array,NoticeManager.setChildType(NT.CITY_PVP_ENTRANCE,NT.TEAM_ARENA_ENTRANCE),NoticeManager.setChildType(NT.TEAM_ARENA_ENTRANCE,[NT.TEAM_ARENA_APPLY_CENTER,NT.TEAM_ARENA_ENROLL,NT.TEAM_ARENA_VOTE]),NoticeManager.setChildType(NT.TEAM_ARENA_APPLY_CENTER,[NT.TEAM_ARENA_APPLY]),NoticeManager.registerCB(NT.TEAM_ARENA_APPLY,e.checkApplyNotice,e,MODULE.TeamArena),NoticeManager.registerCB(NT.TEAM_ARENA_ENROLL,e.checkEnrollNotice,e,MODULE.TeamArena),NoticeManager.registerCB(NT.TEAM_ARENA_VOTE,e.checkVoteNotice,e,MODULE.TeamArena),e}return __extends(i,t),i.prototype.checkApplyNotice=function(e){return this.amILeader()&&this.applyRecords&&0<this.applyRecords.length&&this.getOpenInfo().status==TeamArenaStatus.Enroll},i.prototype.checkEnrollNotice=function(){return!this.arenaInfo.teamInfo.enrolled&&this.getOpenInfo().status==TeamArenaStatus.Enroll},i.prototype.checkVoteNotice=function(){return this.checkVotable()},i.prototype.updateNotice=function(e){void 0===e&&(e=!1)},i.prototype.GetBattleZoneArenaInfo=function(t){var i=this;Utils.Socket.send("teamArena","GetTeamArenaInfo",{}).then(function(e){i.updateArenaInfo(e.info),t&&t()})},i.prototype.GetGroupInfo=function(t){var i=this;Utils.Socket.send("teamArena","GetGroupInfo",{}).then(function(e){i.updateGroupInfo(e.groups),t&&t()})},i.prototype.Enroll=function(t){var i=this;Utils.Socket.send("teamArena","Enroll",{}).then(function(e){i.updateArenaInfo(e.info),NoticeManager.updateNotice(NT.TEAM_ARENA_ENROLL),Utils.MsgUtils.addMidMsg("报名成功"),t&&t()})},i.prototype.Vote=function(e,t){var i=this;Utils.Socket.send("teamArena","Vote",{teamId:e}).then(function(e){i.updateArenaInfo(e.info),NoticeManager.updateNotice(NT.TEAM_ARENA_VOTE),Utils.MsgUtils.addMidMsg("投票成功"),t&&t()})},i.prototype.GetBattleRecord=function(i,n,o){var a=this;Utils.Socket.send("teamArena","GetBattleRecord",{teamId:i}).then(function(e){if(n==TeamArenaStatus.MatchBattle){var t=a.recordController&&a.recordController.curTeamBattleNum[i]||0;e.records=e.records.slice(0,t)}o(e)})},i.prototype.fetchAllRecord=function(t){var i=this;this.recordController||(this.recordController=new n),this.recordController.recordFetched?t():this.GetAllBattleRecord(0,function(e){i.recordController.total=e.total,i.recordController.recordFetched=!0,t()})},i.prototype.GetAllBattleRecord=function(t,i){var n=this;Utils.Socket.send("teamArena","GetAllBattleRecord",{index:t}).then(function(e){i&&i(e),0!=e.total&&(n.recordController.pushRecordToQueue(e.records),e.records.length==Number(s.Config.constConfig().TeamArenaBattleRecordOffset.constValue)&&n.GetAllBattleRecord(t+1))})},i.prototype.updateArenaInfo=function(e){this.arenaInfo.update(e),s.AppFacade.getInstance().sendNotification(CN.TEAM_ARENA_UPDATE_INFO),s.AppFacade.getInstance().sendNotification(CN.TEAM_ARENA_UPDATE_TEAM_INFO),this.updateNotice()},i.prototype.updateGroupInfo=function(e){var i=this;this.groupInfos.splice(0);var n=this.arenaInfo.teamInfo.team.id;e.forEach(function(e){var t=new s.TeamArenaGroupVO(e);t.isMyGroup=t.teams.some(function(e){return e.team.id==n}),i.groupInfos.push(t)})},i.prototype.updateTeam=function(e){this.arenaInfo.teamInfo.team.update(e),s.AppFacade.getInstance().sendNotification(CN.TEAM_ARENA_UPDATE_INFO),s.AppFacade.getInstance().sendNotification(CN.TEAM_ARENA_UPDATE_TEAM_INFO)},i.prototype.isInTeam=function(){return this.arenaInfo.teamInfo.team.id&&!0},i.prototype.isEnrolled=function(){return this.arenaInfo.teamInfo.enrolled&&!0},i.prototype.checkVotable=function(){var e=!s.GameMVC.loginPy.loginGameVO.singleSign&&!this.arenaInfo.voteTeamId&&1!=this.groupInfos.length;if(e){var t=(JSON.parse(s.Config.constConfig().EliminateTeamArenaDt.constValue)[0][0]+3-1-1)%7+1;e=(new Date(1e3*Utils.TimerManager.getServerTime()).getDay()||7)===t}return e},Object.defineProperty(i.prototype,"team",{get:function(){return this.arenaInfo.teamInfo.team},enumerable:!0,configurable:!0}),i.prototype.amILeader=function(){return this.isInTeam()&&this.arenaInfo.teamInfo.team.leader==this.playerProxy.playerInfoVO.playerId},i.prototype.GetCenterTeam=function(t){var i=this;this.centerTeams.splice(0),Utils.Socket.send("teamArena","GetTeamList",{}).then(function(e){Array.isArray(e.teams)&&e.teams.forEach(function(e){i.centerTeams.push(new s.TeamVO(e))}),t&&t()})},i.prototype.GetApplyRecord=function(t){var i=this;Utils.Socket.send("teamArena","GetApplyRecord",{}).then(function(e){i.updateApplyRecord(e),t&&t()})},i.prototype.updateApplyRecord=function(e){var t=this;this.applyRecords.splice(0),e&&Array.isArray(e.records)&&e.records.forEach(function(e){t.applyRecords.push(new s.ApplyRecordVO(e))}),NoticeManager.updateNotice(NT.TEAM_ARENA_APPLY)},i.prototype.Quit=function(t){var i=this;Utils.Socket.send("teamArena","QuitTeam",{}).then(function(e){i.updateTeam(e.teams),t&&t(),s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N).clearInviteHistory(MODULE.TeamArena)})},i.prototype.Create=function(e,t){var i=this;Utils.Socket.send("teamArena","CreateTeam",{name:e}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.Refresh=function(e){return this.GetCenterTeam(e)},i.prototype.Search=function(e,t){var i=this;Utils.MathUtils.isNumber(e)?Utils.Socket.send("teamArena","SearchTeam",{id:Number(e)}).then(function(e){i.centerTeams.splice(0),Array.isArray(e.teams)&&e.teams.forEach(function(e){i.centerTeams.push(new s.TeamVO(e))}),t&&t()}):Utils.MsgUtils.addMidMsg("请输入正确的队伍ID")},i.prototype.Apply=function(e,t,i){var n=this;void 0===i&&(i=!1),Utils.Socket.send("teamArena","ApplyTeam",{id:e,isInvite:i}).then(function(e){Utils.MsgUtils.addMidMsg("已申请"),e.team&&n.updateTeam(e.team),t&&t()})},i.prototype.Kick=function(e,t){var i=this;Utils.Socket.send("teamArena","TickMember",{playerId:e}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.Agree=function(e,t){var i=this;Utils.Socket.send("teamArena","AgreeMember",{playerId:e}).then(function(e){i.updateTeam(e.team),i.updateApplyRecord(e),t&&t()})},i.prototype.Refuse=function(e,t){var i=this;Utils.Socket.send("teamArena","RefuseMember",{playerId:e}).then(function(e){i.updateTeam(e.team),i.updateApplyRecord(e),t&&t()})},i.prototype.SwitchLeader=function(e,t){var i=this;Utils.Socket.send("teamArena","TransferLeader",{playerId:e}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.SaveFormation=function(e,t){var i=this;Utils.Socket.send("teamArena","ChangeFormation",{playerIds:e}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.Archive=function(t){var i=this;Utils.Socket.send("teamArena","Archive",{}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.Invite=function(t){var i=this;Utils.Socket.send("teamArena","Invite",{}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.initSchedule=function(){this._schedule.resetSchedule();if(s.GameMVC.loginPy.loginGameVO.singleSign)this._schedule.addSchedule(TeamArenaStatus.Close,[1,2,3,4,5,6,7],[[0,0],[24,0]]);else{var e=JSON.parse(s.Config.constConfig().EliminateTeamArenaDt.constValue),t=0!=e[2],i=[e[0][0]];this._schedule.addSchedule(TeamArenaStatus.Enroll,i,[e[0][1],e[0][2]],!t),this._schedule.addSchedule(TeamArenaStatus.Wait,i,[e[0][2],[24,0]],!t),this._schedule.addSchedule(TeamArenaStatus.Close,[1,2,3,4,5,6],[[0,0],[24,0]],!t);for(var n=[],o=e[0][0]+1;o<=e[0][0]+e[1][0];o++){var a=(o-1)%7+1;n.push(a)}var r=n.shift();this._schedule.addSchedule(TeamArenaStatus.MatchAdjust,r,[e[1][1],e[1][2]],t),this._schedule.addSchedule(TeamArenaStatus.MatchWaitBattle,r,[e[1][2],e[1][3]],t),this._schedule.addSchedule(TeamArenaStatus.MatchBattle,r,[e[1][3],[24,0]],t),this._schedule.addSchedule(TeamArenaStatus.Adjust,n,[e[1][1],e[1][2]],t),this._schedule.addSchedule(TeamArenaStatus.WaitBattle,n,[e[1][2],e[1][3]],t),this._schedule.addSchedule(TeamArenaStatus.Battle,n,[e[1][3],[24,0]],t),this._schedule.addSchedule(TeamArenaStatus.Close,7,[[0,0],[24,0]],t)}},i.prototype.getTeamArenaStatus=function(){var e;return Utils.UnlockMgr.checkPass(MODULE.TeamArena,!1).allow&&(e=this._schedule.checkCurrentStatus()[0])||(e=TeamArenaStatus.Close),e},i.prototype.getOpenInfo=function(){var e={isOpen:!1,status:0,remainingTime:0};return e.status=this.getTeamArenaStatus(),e.isOpen=e.status!=TeamArenaStatus.NotOpen&&e.status!=TeamArenaStatus.Close,e.remainingTime=this._schedule.getCurrentTimeInterval().endDt-Utils.TimerManager.getServerTime(!1),e},i.N="BattleZoneArenaProxy",i}(BaseProxy);s.BattleZoneArenaPy=e,__reflect(e.prototype,"game.BattleZoneArenaPy",["ICommonJiJieInterface"]);var n=function(){function e(){this.recordQueue=[],this.showedRecord=[],this.curTeamBattleNum={},this.allOver=!1,this.recordFetched=!1,this._tick=1;var e=JSON.parse(s.Config.constConfig().EliminateTeamArenaDt.constValue)[1][3];this.openDt=new Date(1e3*Utils.TimerManager.getServerTime()).setHours(e[0],e[1],0,0)/1e3}return e.prototype.pushRecordToQueue=function(e){this.recordQueue=this.recordQueue.concat(e);for(var t=Utils.TimerManager.getServerTime()-this.openDt,i=Math.floor(t/this._tick);this.showedRecord.length<i&&this.recordQueue[this.showedRecord.length];)this.pushRecordToShow(this.recordQueue[this.showedRecord.length]);this.showedRecord.length!=this.total?this.timer||(this.timer=egret.setInterval(this.onTicking,this,1e3*this._tick)):(this.allOver=!0,this.timer&&egret.clearInterval(this.timer)),this.onRecordChanged&&this.onRecordChanged.call(this.context)},e.prototype.onTicking=function(){if(this.showedRecord.length!=this.total){var e=this.recordQueue[this.showedRecord.length];e&&(this.pushRecordToShow(e),this.onRecordChanged&&this.onRecordChanged.call(this.context,e))}else this.allOver=!0,this.timer&&egret.clearInterval(this.timer)},e.prototype.pushRecordToShow=function(e){this.showedRecord.push(e),this.curTeamBattleNum[e.challengerTeamId]||(this.curTeamBattleNum[e.challengerTeamId]=0),this.curTeamBattleNum[e.teamId]||(this.curTeamBattleNum[e.teamId]=0),this.curTeamBattleNum[e.challengerTeamId]+=1,this.curTeamBattleNum[e.teamId]+=1},e.prototype.addRecordListener=function(e,t){this.onRecordChanged=e,this.context=t},e.prototype.removeListener=function(){this.onRecordChanged=void 0},e.prototype.reset=function(){this.recordQueue.splice(0),this.showedRecord.splice(0),this.allOver=!1,this.recordFetched=!1,this.curTeamBattleNum={}},e}();__reflect(n.prototype,"BattleRecordController")}(game||(game={})),function(r){var e=function(t){function e(){var e=t.call(this)||this;return e.battleZonePy=r.GameMVC.battleZoneArenaPy,e.backpackPy=r.GameMVC.backpackPy,e.playerPy=r.GameMVC.playerPy,e.curTeamData=[],e.skinName="BattleZoneArenaViewSkin",e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.removeNotice(),this.battleZonePy.recordController&&this.battleZonePy.recordController.removeListener()},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list_rank.itemRenderer=i,this.tabbar_group.itemRendererSkinName="BattleZoneArenaView_GroupTab",this.addNotice(),this.activateComponent()},e.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.TEAM_ARENA_APPLY_CENTER,this.btn_zudui,this,{percentX:110/123,percentY:10/107})},e.prototype.updateView=function(e){var t=this.battleZonePy.getOpenInfo();switch(this.curStatus=t.status,this.gp_signUp.visible=!1,this.gp_battle_match.visible=!1,this.gp_battle_prmpt.visible=!1,this.curStatus){case TeamArenaStatus.Wait:case TeamArenaStatus.Enroll:this.gp_signUp.visible=!0,this.updateSingUpGroup();break;case TeamArenaStatus.MatchAdjust:case TeamArenaStatus.MatchWaitBattle:case TeamArenaStatus.MatchBattle:this.gp_battle_match.visible=!0,this.updateMatchGroup();break;case TeamArenaStatus.Adjust:case TeamArenaStatus.WaitBattle:case TeamArenaStatus.Battle:this.gp_battle_prmpt.visible=!0,this.updatePromotionGroup();break;case TeamArenaStatus.Close:r.MainJumpConfig.jumpTo()}this.updateTime(t.remainingTime)},e.prototype.updateTopGroup=function(){var e,t=((e={})[TeamArenaStatus.Enroll]="邀请队员、调整队伍",e[TeamArenaStatus.Wait]="调整队伍",e[TeamArenaStatus.Adjust]="调整队伍",e[TeamArenaStatus.WaitBattle]="等待战斗",e[TeamArenaStatus.Battle]="战斗结束，耐心等待",e[TeamArenaStatus.MatchAdjust]="调整队伍",e[TeamArenaStatus.MatchWaitBattle]="等待战斗",e[TeamArenaStatus.MatchBattle]="战斗结束，耐心等待",e[TeamArenaStatus.Close]="冠军展示周",e),i=this.battleZonePy.isEnrolled(),n="",o=(this.battleZonePy.arenaInfo.teamInfo.team.id,this.battleZonePy.groupInfos.some(function(e){return e.isMyGroup}));n=this.curStatus==TeamArenaStatus.Enroll||i?i&&0<=[TeamArenaStatus.Adjust,TeamArenaStatus.WaitBattle,TeamArenaStatus.Battle].indexOf(this.curStatus)&&!o?"已被淘汰":t[this.curStatus]:"未报名",this.lb_curStatus.textFlow=[{text:"当前阶段：",style:{textColor:16510880}},{text:n,style:{textColor:16777215}}],i&&(this.curStatus==TeamArenaStatus.MatchBattle||this.curStatus==TeamArenaStatus.Battle&&o)?this.btn_myRecord.visible=!0:this.btn_myRecord.visible=!1,this.updateMyTeamInfo()},e.prototype.updateMyTeamInfo=function(){var e=this.curStatus!=TeamArenaStatus.MatchWaitBattle&&this.curStatus!=TeamArenaStatus.MatchAdjust,t=this.battleZonePy.arenaInfo.teamInfo;this.blb_win.text=(e?t.winNum:0)+"胜",this.blb_fail.text=(e?t.loseNum:0)+"负",this.blb_score.text="队伍积分:"+(e?t.score:0)},e.prototype.updateSingUpGroup=function(){this.heroModel.data||this.heroModel.update({model:"hero_009_01",isStatic:!0});var e=this.battleZonePy.isEnrolled();this.img_signUped.visible=e,this.btn_signUp.visible=!e,this.updateTopGroup()},e.prototype.updateMatchGroup=function(){var o=this;r.GameMVC.rankPy.GetRankList({rankType:RankingType.RankingTypeTeamArena,isTeam:!0,refreshInterval:0},function(e){var t=e.ranks;if(t.length){o.gp_battle_match_empty.visible=!1,o.gp_battle_match_list.visible=!0;var n=[];t.forEach(function(e,t){var i={info:e,index:t};n.push(i)}),o.list_rank.dataProvider=new eui.ArrayCollection(n),o.curStatus==TeamArenaStatus.MatchBattle?o.battleZonePy.fetchAllRecord(function(){if(o.gp_match_record.visible=!0,o.gp_empty.visible=!1,0!=o.battleZonePy.recordController.total)if(o.battleZonePy.recordController.allOver){if(o.gp_match_record.numChildren<5)for(var e=o.gp_match_record.numChildren;e<5;e++){var t=o.battleZonePy.recordController.showedRecord[e];if(t){var i=new g({result:t.result,team1:t.challengerTeam.name,team2:t.team.name});o.gp_match_record.addChild(i)}}}else o.updateMatchRecordList(),o.battleZonePy.recordController.addRecordListener(o.updateMatchRecordList,o)}):(o.gp_match_record.visible=!1,o.gp_empty.visible=!0)}else o.gp_battle_match_empty.visible=!0,o.gp_battle_match_list.visible=!1;o.updateTopGroup()})},e.prototype.updateMatchRecordList=function(e){var t=this.battleZonePy.recordController,i=this.list_rank.dataProvider,o=i.source;if(e){var n=e.result==EBattleResult.EBattleResultWin?e.challengerTeamId:e.teamId;for(var a in o){var r=o[a];if(r.info.team.id==n){r.info.key+=1;break}}var s=new g({result:e.result,team1:e.challengerTeam.name,team2:e.team.name});5==this.gp_match_record.numChildren&&this.gp_match_record.removeChildAt(0),this.gp_match_record.addChild(s);var c=this.battleZonePy.arenaInfo.teamInfo.team.id;e.challengerTeamId!=c&&e.teamId!=c||(n==c?this.battleZonePy.arenaInfo.teamInfo.winNum+=1:this.battleZonePy.arenaInfo.teamInfo.loseNum+=1,this.updateMyTeamInfo())}else{var l=this.battleZonePy.arenaInfo.teamInfo.team.id;o.forEach(function(e){e.info.key=0});var h=0,p=0;t.showedRecord.forEach(function(e){var t=e.result==EBattleResult.EBattleResultWin?e.challengerTeamId:e.teamId;for(var i in o){var n=o[i];if(n.info.team.id==t){n.info.key+=1;break}}e.challengerTeamId!=l&&e.teamId!=l||(t==l?h+=1:p+=1)}),this.battleZonePy.arenaInfo.teamInfo.winNum=h,this.battleZonePy.arenaInfo.teamInfo.loseNum=p,this.updateMyTeamInfo()}if(o.sort(function(e,t){return t.info.key-e.info.key}),o.forEach(function(e,t){e.index=t,e.info.rank=t+1}),i.replaceAll(o),t.allOver&&this.gp_match_record.numChildren<5)for(var d=this.gp_match_record.numChildren;d<5;d++){var u=this.battleZonePy.recordController.showedRecord[d];if(u){s=new g({result:u.result,team1:u.challengerTeam.name,team2:u.team.name});this.gp_match_record.addChild(s)}}},e.prototype.updatePromotionGroup=function(){var n=this;this.battleZonePy.GetGroupInfo(function(){if(n.battleZonePy.groupInfos.length){if(!n.tabbar_group.numChildren){for(var e=[],t=-1,i=0;i<n.battleZonePy.groupInfos.length;i++)e.push({text:""+(i+1),index:i}),n.battleZonePy.groupInfos[i].isMyGroup&&(t=i);n.tabbar_group.dataProvider=new eui.ArrayCollection(e),1==e.length&&(n.tabbar_group.visible=!1),n.tabbar_group.selectedIndex=0<=t?t:0}n.onTabbarItemTap()}else{for(i=0;i<7;i++)n.updatePmptGroup(i);n.updateVoteBtn(),Utils.MsgUtils.addMidMsg("没有小组信息")}n.updateTopGroup()})},e.prototype.onTabbarItemTap=function(e){var t=this;this.curTeamData.splice(0);var i=this.tabbar_group.selectedItem.index;this.battleZonePy.groupInfos[i].teams.forEach(function(e){t.curTeamData.push({team:e,win:void 0})}),this.arrangeTeamData();for(var n=0;n<7;n++)this.updatePmptGroup(n);this.updateVoteBtn()},e.prototype.arrangeTeamData=function(){this.curTeamData[0].team.rank!=this.curTeamData[1].team.rank&&(this.curTeamData[0].win=this.curTeamData[0].team.rank<this.curTeamData[1].team.rank,this.curTeamData[1].win=this.curTeamData[0].team.rank>this.curTeamData[1].team.rank,this.curTeamData.push(this.curTeamData[0].team.rank<this.curTeamData[1].team.rank?{team:this.curTeamData[0].team,win:void 0,left:!0}:{team:this.curTeamData[1].team,win:void 0,left:!1})),this.curTeamData[2].team.rank!=this.curTeamData[3].team.rank&&(this.curTeamData[2].win=this.curTeamData[2].team.rank<this.curTeamData[3].team.rank,this.curTeamData[3].win=this.curTeamData[2].team.rank>this.curTeamData[3].team.rank,this.curTeamData.push(this.curTeamData[2].team.rank<this.curTeamData[3].team.rank?{team:this.curTeamData[2].team,win:void 0,left:!0}:{team:this.curTeamData[3].team,win:void 0,left:!1})),this.curTeamData[4]&&this.curTeamData[5]&&this.curTeamData[4].team.rank!=this.curTeamData[5].team.rank&&(this.curTeamData[4].win=this.curTeamData[4].team.rank<this.curTeamData[5].team.rank,this.curTeamData[5].win=this.curTeamData[4].team.rank>this.curTeamData[5].team.rank,this.curTeamData.push(this.curTeamData[4].team.rank<this.curTeamData[5].team.rank?{team:this.curTeamData[4].team,win:void 0,left:!0}:{team:this.curTeamData[5].team,win:void 0,left:!1}))},e.prototype.updatePmptGroup=function(e){var t=this.curTeamData[e];if(3<e&&(t?(this["gp_line_"+e].visible=!0,this["img_line_"+e].scaleX=t.left?1:-1):this["gp_line_"+e].visible=!1),t){this["img_pmpt_bg_"+e].source=6==e?"zdjj_img_leitaik3_png":"zdjj_img_leitaik2_png",this["gp_pmpt_content_"+e].visible=!0,null!=t.win?this["img_pmpt_result_"+e].source=t.win?"zdjj_txt_sheng_png":"zdjj_txt_bai_png":this["img_pmpt_result_"+e].source="";for(var i=this["gp_pmpt_heads_"+e],n=0;n<3;n++){var o=i.$children[n];if(t.team.team.members[n]){o||(o=i.addChild(customui.PlayerHeadFactory.create()));var a=t.team.team.members[n].baseInfo;o.updateData({vo:a})}else o&&o.parent.removeChild(o)}return this["lb_pmpt_name_"+e].text=t.team.team.name,this["blb_pmpt_fightCap_"+e].text=t.team.team.fightCap.toString(),this["img_voted_"+e].visible=t.team.team.id==this.battleZonePy.arenaInfo.voteTeamId,!0}return this["img_pmpt_bg_"+e].source="zdjj_img_leitaik1_png",this["gp_pmpt_content_"+e].visible=!1},e.prototype.updateVoteBtn=function(){for(var e=this.battleZonePy.checkVotable(),t=1;t<5;t++){var i=this["btn_vote_"+t],n=this["lb_vote_"+t],o=this.curTeamData[t-1];o&&e?(i.visible=!0,n.visible=!0,n.text="票数："+o.team.ballot,this.battleZonePy.arenaInfo.voteTeamId==o.team.team.id?(UIActionManager.setAbsGrey(i,!0),i.label="已押注"):(UIActionManager.setAbsGrey(i,!1),i.label="押注")):(i.visible=!1,n.visible=!1)}},e.prototype.voteTeam=function(e){r.AppFacade.getInstance().showSubView(r.BattleZoneArenaMediator.N,r.BattleZoneArenaMediator.SV.VOTE,{team:this.curTeamData[e-1].team})},e.prototype.showBattleRecord=function(e){var i=[[1,0],[2,0],[4,1]][e];this.battleZonePy.GetBattleRecord(this.curTeamData[i[0]].team.team.id,this.curStatus,function(e){var t=e.records[i[1]];t?PopUpManager.addPopUp({obj:new r.FightRecordPreviewPanel({record:t})}):Utils.MsgUtils.addMidMsg("暂无记录")})},e.prototype.updateTime=function(e){this.timer||(this.timer=egret.setInterval(this.timerFunc,this,1e3)),this.timerDt=e,this.blb_timeDesc.text=this.curStatus==TeamArenaStatus.Close?"开启时间:":"剩余时间:"},e.prototype.timerFunc=function(){0<=this.timerDt?this.blb_time.text=Utils.TimerManager.getFormatBySecond1(this.timerDt--):this.battleZonePy.GetBattleZoneArenaInfo()},e.prototype.activateComponent=function(){var i=this;Utils.ComponentUtils.registerListener(this.tabbar_group,eui.ItemTapEvent.ITEM_TAP,this.onTabbarItemTap,this),Utils.ComponentUtils.registerListener(this.btn_rank,egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.loginPy.loginGameVO.singleSign?r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"TEAM_ARENA_RANK_SINGLE"}):r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"TEAM_ARENA_RANK"})},this),Utils.ComponentUtils.registerListener(this.btn_reward,egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.loginPy.loginGameVO.singleSign?r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"TEAM_ARENA_REWARD_SINGLE"}):r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"TEAM_ARENA_REWARD"})},this),Utils.ComponentUtils.registerListener(this.btn_shop,egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeArena})},this),Utils.ComponentUtils.registerListener(this.btn_zudui,egret.TouchEvent.TOUCH_TAP,function(){i.battleZonePy.isInTeam()?r.AppFacade.getInstance().showSubView(r.BattleZoneArenaMediator.N,r.BattleZoneArenaMediator.SV.JIJIE_MY_TEAM,{status:i.curStatus}):i.curStatus==TeamArenaStatus.Enroll?r.AppFacade.getInstance().showSubView(r.BattleZoneArenaMediator.N,r.BattleZoneArenaMediator.SV.JIJIE_CENTER):Utils.MsgUtils.addMidMsg("当前无法进行组队")},this),Utils.ComponentUtils.registerListener(this.btn_help,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new r.HelpDialog({moduleId:MODULE.TeamArena})})},this),Utils.ComponentUtils.registerListener(this.btn_back,egret.TouchEvent.TOUCH_TAP,function(){r.MainJumpConfig.jumpTo()},this),Utils.ComponentUtils.registerListener(this.btn_signUp,egret.TouchEvent.TOUCH_TAP,function(){i.battleZonePy.isInTeam()?i.battleZonePy.amILeader()?1<i.battleZonePy.arenaInfo.teamInfo.memberNum?i.battleZonePy.Enroll():Utils.MsgUtils.addMidMsg("队伍人数不足"):Utils.MsgUtils.addMidMsg("只有队长可以报名"):Utils.MsgUtils.addMidMsg("请先组队")},this);for(var e=function(e){Utils.ComponentUtils.registerListener(t["btn_vote_"+e],egret.TouchEvent.TOUCH_TAP,function(){i.voteTeam(e)},t),t["btn_review_"+(e+3)]&&Utils.ComponentUtils.registerListener(t["btn_review_"+(e+3)],egret.TouchEvent.TOUCH_TAP,function(){i.showBattleRecord(e-1)},t)},t=this,n=1;n<5;n++)e(n);Utils.ComponentUtils.registerListener(this.btn_myRecord,egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.battleZoneArenaPy.GetBattleRecord(i.battleZonePy.arenaInfo.teamInfo.team.id,i.curStatus,function(e){var t=e.records;t.length?r.AppFacade.getInstance().showSubView(r.BattleZoneArenaMediator.N,r.BattleZoneArenaMediator.SV.TEAM_BATTLE_RECORD,{records:t,id:i.battleZonePy.arenaInfo.teamInfo.team.id}):Utils.MsgUtils.addMidMsg("暂无战斗记录")})},this);var o=function(e){Utils.ComponentUtils.registerListener(a["gp_pmpt_"+e],egret.TouchEvent.TOUCH_TAP,function(){i.curTeamData[e]&&r.AppFacade.getInstance().showSubView(r.BattleZoneArenaMediator.N,r.BattleZoneArenaMediator.SV.TEAM_INFO,{team:i.curTeamData[e].team.team})},a)},a=this;for(n=0;n<7;n++)o(n)},e.prototype.perClose=function(){this.timer&&egret.clearInterval(this.timer)},e}(BaseFull);r.BattleZoneArenaView=e,__reflect(e.prototype,"game.BattleZoneArenaView");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="BattleZoneArenaView_MatchRankItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_review,egret.TouchEvent.TOUCH_TAP,function(){var e=r.GameMVC.battleZoneArenaPy.getOpenInfo().status;e==TeamArenaStatus.MatchBattle?r.GameMVC.battleZoneArenaPy.GetBattleRecord(i.data.info.team.id,e,function(e){var t=e.records;t.length?r.AppFacade.getInstance().showSubView(r.BattleZoneArenaMediator.N,r.BattleZoneArenaMediator.SV.TEAM_BATTLE_RECORD,{records:t,id:i.data.info.team.id}):Utils.MsgUtils.addMidMsg("暂无战斗记录")}):r.AppFacade.getInstance().showSubView(r.BattleZoneArenaMediator.N,r.BattleZoneArenaMediator.SV.TEAM_INFO,{team:i.data.info.team})},this)},e.prototype.dataChanged=function(){var e=this.data.info;this.lb_name.text=e.team.name,this.lb_score.text=e.key.toString(),3<e.rank?(this.blb_rank.visible=!0,this.icon_rank.visible=!1,this.blb_rank.text=e.rank.toString()):(this.blb_rank.visible=!1,this.icon_rank.visible=!0,this.icon_rank.source=r.GameMVC.rankPy.rankIcon(e.rank)),this.data.index%2==0?this.img_bg.source="zdjj_img_zitiao2_png":this.img_bg.source="zdjj_img_zitiao1_png"},e}(eui.ItemRenderer);__reflect(i.prototype,"BattleZoneArenaView_MatchRankItem");var g=function(i){function e(e){var t=i.call(this)||this;return t.skinName="BattleZoneArenaView_MatchRecordItem",t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.img_icon_1.source=this.data.result==EBattleResult.EBattleResultWin?"zdjj_txt_sheng_png":"zdjj_txt_bai_png",this.img_icon_2.source=this.data.result==EBattleResult.EBattleResultWin?"zdjj_txt_bai_png":"zdjj_txt_sheng_png",this.lb_team_1.text=this.data.team1,this.lb_team_2.text=this.data.team2},e}(eui.Component);__reflect(g.prototype,"BattleZoneArenaView_MatchRecordItem")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.commonPy=i.AppFacade.getInstance().retrieveProxy(i.BattleZoneArenaPy.N),e}return __extends(e,t),e.prototype.onViewCreated=function(){},e.prototype.onViewRemove=function(){},e.prototype.onShowMyTeam=function(){i.AppFacade.getInstance().showSubView(i.BattleZoneArenaMediator.N,i.BattleZoneArenaMediator.SV.JIJIE_MY_TEAM)},e}(i.CommonJiJieCenterPanel);i.BattleZoneArenaJiJieCenterPanel=e,__reflect(e.prototype,"game.BattleZoneArenaJiJieCenterPanel")}(game||(game={})),function(n){var e=function(i){function e(e){var t=i.call(this,e)||this;return t.commonPy=n.AppFacade.getInstance().retrieveProxy(n.BattleZoneArenaPy.N),t}return __extends(e,i),e.prototype.onViewCreated=function(){},e.prototype.onViewRemove=function(){NoticeManager.updateNotice(NT.TEAM_ARENA_APPLY)},e.prototype.onShowMyTeam=function(){n.AppFacade.getInstance().showSubView(n.BattleZoneArenaMediator.N,n.BattleZoneArenaMediator.SV.JIJIE_MY_TEAM)},e.prototype.onFetch=function(e){this.commonPy.GetApplyRecord(function(){e()})},e}(n.CommonJiJieMyTeamApplyPanel);n.BattleZoneArenaJiJieMyTeamApplyPanel=e,__reflect(e.prototype,"game.BattleZoneArenaJiJieMyTeamApplyPanel")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.commonPy=a.AppFacade.getInstance().retrieveProxy(a.BattleZoneArenaPy.N),e}return __extends(e,t),Object.defineProperty(e.prototype,"py",{get:function(){return this.commonPy},enumerable:!0,configurable:!0}),e.prototype.canKick=function(){return 3!=this.py.team.members.length},e.prototype.onViewCreated=function(){NoticeManager.addNoticeListener(NT.TEAM_ARENA_APPLY,this.btn_apply.$children[0],this,{percentX:.8,percentY:.02}),NoticeManager.addNoticeListener},e.prototype.onViewRemove=function(){NoticeManager.removeNoticeListener(NT.TEAM_ARENA_APPLY)},e.prototype.inviteCallback=function(){var e=a.AppFacade.getInstance().retrieveProxy(a.BattleZoneArenaPy.N),n=a.Config.broadcastConfig()[28].content,t=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),o=[[2,t.playerInfoVO.name,t.playerInfoVO.playerId,EEntityType.EEntityTypePlayer],[1,"<<点击入队",e.arenaInfo.teamInfo.team.id,MODULE.TeamArena]];a.AppFacade.getInstance().retrieveProxy(a.FriendPy.N).getFriendList(function(){PopUpManager.addPopUp({obj:new a.InviteFriendView({moduleId:MODULE.TeamArena,tabbarType:11,inviteCallback:function(e,t){var i=a.AppFacade.getInstance().retrieveProxy(a.MainPy.N);i.addPrivatePlayer(e),i.SendMessage(EChatChannelType.EChatChannelTypePrivate,n,e,void 0,EChatSendCheckType.None,JSON.stringify(o),!0),a.AppFacade.getInstance().retrieveProxy(a.FriendPy.N).addInviteHistory(MODULE.TeamExpedition,e),t&&t()}})})})},e.prototype.changeOrderAbove=function(e){0<=[TeamArenaStatus.Adjust,TeamArenaStatus.MatchAdjust,TeamArenaStatus.Enroll,TeamArenaStatus.Wait].indexOf(this.curStatus)?t.prototype.changeOrderAbove.call(this,e):Utils.MsgUtils.addMidMsg("锁定时间不可调整")},e.prototype.updateView=function(e){t.prototype.updateView.call(this),this.btn_apply.enabled=this.btn_switch.enabled=this.commonPy.amILeader(),this.curStatus=e&&e.status||this.curStatus,this.curStatus&&this.curStatus!=TeamArenaStatus.Enroll?(this.btn_apply.enabled=this.btn_disband.enabled=this.btn_switch.enabled=!1,UIActionManager.setAbsGrey(this.btn_apply,!0),UIActionManager.setAbsGrey(this.btn_disband,!0),UIActionManager.setAbsGrey(this.btn_switch,!0)):3==this.py.team.members.length?(this.btn_apply.enabled=!1,this.btn_disband.enabled=!1,UIActionManager.setAbsGrey(this.btn_disband,!0),NoticeManager.removeNoticeListener(NT.TEAM_ARENA_APPLY)):(this.btn_disband.enabled=!0,UIActionManager.setAbsGrey(this.btn_disband,!1),NoticeManager.addNoticeListener(NT.TEAM_ARENA_APPLY,this.btn_apply.$children[0],this,{percentX:.8,percentY:.02}),1==this.py.team.members.length&&(this.btn_switch.enabled=!1)),NoticeManager.updateNotice(NT.TEAM_ARENA_APPLY)},e.prototype.onShowCenter=function(){a.AppFacade.getInstance().showSubView(a.BattleZoneArenaMediator.N,a.BattleZoneArenaMediator.SV.JIJIE_CENTER)},e.prototype.onShowApply=function(e){PopUpManager.addPopUp({obj:new a.BattleZoneArenaJiJieMyTeamApplyPanel({doneCB:function(){e&&e()}})})},e.prototype.onFetch=function(e){this.py.GetBattleZoneArenaInfo(function(){e()})},e}(a.CommonJiJieMyTeamPanel);a.BattleZoneArenaJiJieMyTeamPanel=e,__reflect(e.prototype,"game.BattleZoneArenaJiJieMyTeamPanel")}(game||(game={})),function(s){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="BattleZoneArenaTeamInfoSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateView=function(e){for(var o=this,t=e.team,a=0,i=function(i){if(t.members[i]){var e=t.members[i].baseInfo;r["lb_name_"+i].text=e.name,r["gp_head_"+i].addChild(customui.PlayerHeadFactory.create({vo:e}));var n=e.playerId;s.GameMVC.playerPy.GetPublicPlayerInfo([n],function(e,t){t[n].publicPlayer.heroList.forEach(function(e,t){o["gp_formation_"+i].addChild(customui.BaseItemFactory.create({vo:e,type:EEntityType.EEntityTypeHero,code:e.code}))})}),a+=e.fightCap}else r.gp_root.removeChild(r["gp_"+i]),r.gp_root.height-=120},r=this,n=0;n<3;n++)i(n);this.lb_teamName.text=t.name,this.lb_fightCap.text=a.toString()},e}(BasePanel);s.BattleZoneArenaTeamInfoPanel=e,__reflect(e.prototype,"game.BattleZoneArenaTeamInfoPanel")}(game||(game={})),function(c){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="BattleZoneArenaTeamRecordSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.list_record.itemRenderer=i,Utils.ComponentUtils.registerListener(this.btn_back,egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},e.prototype.updateView=function(e){var t=e.records,o=[],a=e.id;t.forEach(function(e,t){var i=e.challengerTeamId==a,n={record:e,team1:i?e.challengerTeam:e.team,team2:i?e.team:e.challengerTeam,result:e.result==EBattleResult.EBattleResultDraw?EBattleResult.EBattleResultDraw:i?e.result:3-e.result,index:t+1};o.push(n)}),this.list_record.dataProvider=new eui.ArrayCollection(o)},e}(BasePanel);c.BattleZoneArenaTeamRecordPanel=e,__reflect(e.prototype,"game.BattleZoneArenaTeamRecordPanel");var i=function(i){function e(){var e=i.call(this)||this;return e.skinName="BattleZoneArenaTeamRecordPanel_RecordItem",e}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this);for(var t=0;t<3;t++)this.gp_heads_1.addChild(customui.PlayerHeadFactory.create()),this.gp_heads_2.addChild(customui.PlayerHeadFactory.create());Utils.ComponentUtils.registerListener(this.btn_review,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new c.FightRecordPreviewPanel({record:e.data.record})})},this)},e.prototype.dataChanged=function(){this.blb_index.text="第"+this.data.index+"场";var i=this.data.team1,n=this.data.team2;this.lb_name_1.text=i.name,this.lb_name_2.text=n.name;for(var e=function(e){var t;i.members[e]?(o.gp_heads_1.$children[e].visible=!0,(t=o.gp_heads_1.$children[e]).updateData({vo:i.members[e].baseInfo}),t.addTapEvent(function(){i.members[e].baseInfo.playerId!=c.GameMVC.playerPy.playerInfoVO.playerId&&c.AppFacade.getInstance().showSubView(c.FriendMediator.N,c.FriendMediator.SV.INFO,{playerId:i.members[e].baseInfo.playerId})})):o.gp_heads_1.$children[e].visible=!1;n.members[e]?(o.gp_heads_2.$children[e].visible=!0,(t=o.gp_heads_2.$children[e]).updateData({vo:n.members[e].baseInfo}),t.addTapEvent(function(){n.members[e].baseInfo.playerId!=c.GameMVC.playerPy.playerInfoVO.playerId&&c.AppFacade.getInstance().showSubView(c.FriendMediator.N,c.FriendMediator.SV.INFO,{playerId:n.members[e].baseInfo.playerId})})):o.gp_heads_2.$children[e].visible=!1},o=this,t=0;t<3;t++)e(t);if(!i.fightCap){var a=0;i.members.forEach(function(e){a+=e.baseInfo.fightCap}),i.fightCap=a}if(this.blb_fightCap_1.text=i.fightCap.toString(),!n.fightCap){var r=0;n.members.forEach(function(e){r+=e.baseInfo.fightCap}),n.fightCap=r}this.blb_fightCap_2.text=n.fightCap.toString();var s=this.data.result==EBattleResult.EBattleResultWin;this.img_result_1.source=s?"zdjj_txt_sheng_png":"zdjj_txt_bai_png",this.img_result_2.source=s?"zdjj_txt_bai_png":"zdjj_txt_sheng_png",this.img_bg.scaleX=s?1:-1},e}(eui.ItemRenderer);__reflect(i.prototype,"BattleZoneArenaTeamRecordPanel_RecordItem")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="BattleZoneArenaVoteSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_cancle,egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),Utils.ComponentUtils.registerListener(this.btn_confirm,egret.TouchEvent.TOUCH_TAP,function(){i.GameMVC.battleZoneArenaPy.Vote(e.team.team.id,function(){e.hide()})},this)},e.prototype.updateView=function(e){this.team=e.team,this.lb_content.textFlow=[{text:"确定押注 "},{text:""+this.team.team.name,style:{textColor:3192305}},{text:" 为本轮组队竞技冠军吗？"}]},e}(BasePanel);i.BattleZoneArenaVotePanel=e,__reflect(e.prototype,"game.BattleZoneArenaVotePanel")}(game||(game={})),function(n){var e=function(i){function e(e){var t=i.call(this)||this;return t.dt=0,t.proxy=n.AppFacade.getInstance().retrieveProxy(n.GuildWarPy.N),t.skinName="BattleZoneEnrollSkin",t.dt=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),Utils.TouchUtils.addTouchListener(this.btn_close,function(){e.hide()}),Utils.TouchUtils.addTouchListener(this.btn_enroll,function(){n.MainJumpConfig.jumpTo(MODULE.TeamArena),e.hide()}),this.blb_time.text=Utils.TimerManager.getFormatBySecond1(this.dt),this.timer=egret.setInterval(function(){0<e.dt?e.blb_time.text=Utils.TimerManager.getFormatBySecond1(--e.dt):e.hide()},this,1e3)},e.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},e}(BasePanel);n.BattleZoneEnrollPanel=e,__reflect(e.prototype,"game.BattleZoneEnrollPanel")}(game||(game={})),function(s){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChampionAchievementSkin",e.proxy=s.AppFacade.getInstance().retrieveProxy(s.ChampionPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.sl_list.verticalScrollBar.visible=!1,this.sl_list.verticalScrollBar.autoVisibility=!1,this.cu_dtc.onCloseCB=function(){s.AppFacade.getInstance().hideSubView(s.ChampionMediator.N,s.ChampionMediator.SV.ACHIEVEMENT)},this.cu_dtc.blb_title.text="成就奖励"},e.prototype.updateView=function(){var e=this.proxy.championInfo.targeted,t=s.Config.championAchievement();this.sl_list.removeChildren();var i=new eui.List,n=new eui.VerticalLayout;n.horizontalAlign=egret.HorizontalAlign.CENTER,i.layout=n,this.sl_list.viewport=i;var o=new eui.ArrayCollection,a=new Array;for(var r in t)a.push({hasGot:e[r],obj:t[r]});a.sort(function(e,t){return e.hasGot&&!t.hasGot?1:!e.hasGot&&t.hasGot?-1:e.obj.id-t.obj.id}),a.forEach(function(e){o.addItem(e)}),i.dataProvider=o,i.itemRenderer=c},e}(BasePanel);s.ChampionAchievement=e,__reflect(e.prototype,"game.ChampionAchievement");var c=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChampionAchievementItemSkin",e.proxy=s.AppFacade.getInstance().retrieveProxy(s.ChampionPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_oppr.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.proxy.ChampionAchievement(e.data.obj.id)},this)},e.prototype.dataChanged=function(){var i=this,e=this.proxy.championInfo.id-1,t=this.data.obj.id;this.lb_name.textFlow=[{text:"通关第"},{text:t,style:{textColor:13584896}},{text:"关，可领取"}],this.lb_sche.textFlow=[{text:"进度："},{text:""+e,style:{textColor:e<t?15400960:55839}},{text:"/"+t}],this.gp_rewards.removeChildren(),JSON.parse(this.data.obj.reachReward).forEach(function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,t.updateData({id:e[1],num:e[2]}),i.gp_rewards.addChild(t)}),e<t?(this.btn_oppr.enabled=!1,this.btn_oppr.visible=!0):this.data.hasGot?(this.btn_oppr.visible=!1,this.lb_tips.visible=!0):(this.btn_oppr.visible=this.btn_oppr.enabled=!0,this.lb_tips.visible=!1)},e}(eui.ItemRenderer);__reflect(c.prototype,"ChampionAchievementItem")}(game||(game={})),function(s){var e=function(i){function e(e){var t=i.call(this)||this;return t.skinName="ChampionBossPreviewSkin",t._popActionType=5,t._removeActionType=6,t.guideEffectWait=!0,t}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),egret.setTimeout(function(){t.setGuideAvailable()},this,500),this.btn_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide();var e=s.AppFacade.getInstance().retrieveProxy(s.ChampionPy.N);0<e.championInfo.challengeInfo.count?e.ChampionBattle():s.AppFacade.getInstance().retrieveMediator(s.ChampionMediator.N).getSubView(s.ChampionMediator.SV.MAIN).buyCount()},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.AppFacade.getInstance().showSubView(s.HeroMediator.N,s.HeroMediator.SV.FORMATION)},this),this.btn_seekHelp.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=s.GameMVC.championPy,t=s.GameMVC.mainPy,i=parseInt(s.Config.constConfig().ChampionHelpNumLimit.constValue);e.championInfo.id>=i?0==e.championInfo.challengeInfo.requestCount?t.scheId?Utils.MsgUtils.addMidMsg("口干舌燥，请休息一会"):(t.setInterval(),e.RequestHelp(),Utils.MsgUtils.addMidMsg("求助成功")):Utils.MsgUtils.addMidMsg("求助冷却中"):Utils.MsgUtils.addMidMsg(i+"关后可求助")},this)},e.prototype.updateView=function(e){var i=this,t=s.Config.champion()[e.id];this.lb_title.text=""+t.name,this.blb_cap.text=Utils.MathUtils.formatNumStyle2(t.fightCapacity),JSON.parse(t.passReward).forEach(function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,t.updateData({type:e[0],id:e[1],num:e[2]}),i.gp_rewards.addChild(t)});var n=[];try{for(var o=1;o<=6;o++){var a=t["creep"+o];a&&""!=a&&n.push(JSON.parse(t["creep"+o])[0])}}catch(e){this.log(e)}if(n.forEach(function(e){if(null!=e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e}),t.scaleX=t.scaleY=.7,t.touchEnabled=!1,i.gp_enermy.addChild(t)}}),0<s.GameMVC.championPy.championInfo.challengeInfo.requestCount){UIActionManager.setAbsGrey(this.btn_seekHelp,!0),this.btn_seekHelp.touchEnabled=!1;var r=Utils.TimerManager.getLeftTime([23,59,59]);this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<--r&&(i.bm_seekHelpTime.text=Utils.TimerManager.getFormatBySecond1(r))},this,1e3)}else this.btn_seekHelp.touchEnabled=!0,UIActionManager.setAbsGrey(this.btn_seekHelp,!1),this.timer&&egret.clearInterval(this.timer),this.bm_seekHelpTime.text=""},e}(BasePanel);s.ChampionBossPreview=e,__reflect(e.prototype,"game.ChampionBossPreview")}(game||(game={})),function(r){var e=function(i){function e(e){var t=i.call(this)||this;return t.bpProxy=r.GameMVC.backpackPy,t.skinName="BaseItemChoseViewSkin",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initList(),this.activateComponent(),this.params&&this.updateView(this.params)},e.prototype.initList=function(){this.ac_list=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_list,this.list_item.itemRenderer=t},e.prototype.updateView=function(e){var n=this;this.params=e||this.params;var o=this.params.source===BASEITEM_SOURCE.BACKPACK;o||(this.btn_cancel.visible=!1,this.btn_confirm.visible=!0,this.btn_confirm.horizontalCenter=0,this.scl.y=this.list_item.y=100);var t=r.Config.itemConfig()[this.params.code],a=[];JSON.parse(t.effect).forEach(function(e,t){var i={id:e[1],reward:e,selected:!o&&void 0,chooseCb:function(){n.updateSelected(e[1])}};a.push(i)}),this.ac_list.replaceAll(a),3<a.length&&(this.scl.viewport=this.list_item)},e.prototype.updateSelected=function(e){var t=this;this.selectedId===e?this.selectedId=void 0:this.selectedId=e,this.ac_list.source.forEach(function(e){e.selected=e.id===t.selectedId}),this.ac_list.replaceAll(this.ac_list.source)},e.prototype.activateComponent=function(){var e=this;Utils.ComponentUtils.registerListener(this.btn_cancel,egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),Utils.ComponentUtils.registerListener(this.btn_confirm,egret.TouchEvent.TOUCH_TAP,function(){e.params.source===BASEITEM_SOURCE.BACKPACK?e.selectedId?e.bpProxy.UseProp(e.params.code,1,e.selectedId,!0,"",function(){e.hide()}):Utils.MsgUtils.addMidMsg("请选择一份奖励"):e.hide()},this)},e}(BasePanel);r.BaseItemChoseView=e,__reflect(e.prototype,"game.BaseItemChoseView");var t=function(t){function e(){var e=t.call(this)||this;return e.playerProxy=r.GameMVC.playerPy,e.skinName="BaseItemChoseView_ChoseItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(11),this.gp_baseitem.addChild(this.baseItem),Utils.ComponentUtils.registerListener(this.checkBox,egret.TouchEvent.TOUCH_TAP,function(){e.data.chooseCb&&e.data.chooseCb()},this)},e.prototype.dataChanged=function(){this.baseItem.updateData({reward:this.data.reward}),null!=this.data.selected?(this.checkBox.visible=!0,this.checkBox.selected=this.data.selected):this.checkBox.visible=!1},e}(eui.ItemRenderer);r.BaseItemChoseView_ChoseItem=t,__reflect(t.prototype,"game.BaseItemChoseView_ChoseItem")}(game||(game={})),function(i){var e=function(){function e(){}return e.registerAll=function(){(new t).register()},e}();i.ChampionProcessor=e,__reflect(e.prototype,"game.ChampionProcessor");var t=function(e){function t(){return e.call(this,"champion.PushChampionInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.ChampionPy.N).updateInfo(t.info)},t}(i.ProcessorBase);i.PushChampionInfoP=t,__reflect(t.prototype,"game.PushChampionInfoP")}(game||(game={})),function(r){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.isZiDong=!0,e.isFist=!0,e.championInfo=new r.ChampionInfoVO,NoticeManager.registerCB(NT.CHAMPION,e.checkCurLayerCanGet,e),e}return __extends(i,t),i.prototype.updateInfo=function(e){this.championInfo.update(e),this.sendNotification(CN.CHAMPION_UPDATE_INFO)},i.prototype.checkCurLayerCanGet=function(){var e=this.championInfo.id;this.championInfo.allPassed||(e-=1);var t=r.Config.champion()[e],i=!1;if(t&&""!=t.achievementReward&&(i=!0,this.championInfo.targeted))for(var n=0,o=this.championInfo.targeted;n<o.length;n++){var a=o[n];if(a.id==t.id){1<=a.num&&(i=!1);break}}return i},i.prototype.ChampionBattle=function(){var t=this,e=r.Config.champion()[this.championInfo.id];this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeChampion,pb1:"champion",pb2:"ChampionBattle",customParams:{fightBg:"fight_scene_gjzl",tips:['<b><font color="#ffffff" size="22">恭喜挑战 </font><font color="#00fff0" size="22">'+e.name+'</font><font color="#ffffff" size="22"> 成功</font></b>','<b><font color="#ffffff" size="22">很遗憾挑战 </font><font color="#00fff0" size="22">'+e.name+'</font><font color="#ffffff" size="22"> 失败</font></b>']},params:{},doneCB:function(e){console.log("战斗结束",e),e.result==EBattleResult.EBattleResultWin?t.sendNotification(CN.CHAMPION_UPDATE_INFO,{playWinActionBeforUpdate:!0,isNext:!1,isMove:!0}):t.sendNotification(CN.CHAMPION_UPDATE_INFO),r.AppFacade.getInstance().retrieveProxy(r.FightPy.N).queueExceExitCB()}})},i.prototype.Champion=function(){var t=this;Utils.Socket.send("champion","Champion",{}).then(function(e){t.updateInfo(e.info)})},i.prototype.ChampionMopUp=function(){var t=this;Utils.Socket.send("champion","ChampionMopUp",{}).then(function(e){t.updateInfo(e.info);r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N)})},i.prototype.ChampionClearCd=function(){var t=this;Utils.Socket.send("champion","ChampionClearCd",{}).then(function(e){t.updateInfo(e.info);r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N)})},i.prototype.BuyChallengeCount=function(t,i){var n=this;Utils.Socket.send("champion","BuyChallengeCount",{num:t}).then(function(e){Utils.MsgUtils.addMidMsg("成功购买"+t+"次"),n.championInfo.challengeInfo.update(e.challengeInfo),n.sendNotification(CN.CHAMPION_UPDATE_INFO),i&&i()})},i.prototype.ChampionAchievement=function(t,i){var n=this;Utils.Socket.send("champion","ChampionAchievement",{id:t}).then(function(e){n.championInfo.update(e.info),r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N).handleClientReward(e.clientReward,{onCloseCB:i}),r.AppFacade.getInstance().sendNotification(CN.QQZONE_PUSH_MESSAGE,{type:"championAchievement",data:{id:t,targetId:e.info.id}})})},i.prototype.RequestHelp=function(){Utils.Socket.send("champion","RequestHelp",{}).then(function(e){})},i.prototype.HelpChallenge=function(e,t){Utils.Socket.send("champion","HelpChallenge",{uuid:e}).then(function(e){})},i.N="ChampionProxy",i}(BaseProxy);r.ChampionPy=e,__reflect(e.prototype,"game.ChampionPy")}(game||(game={})),function(g){var e=function(t){function e(){var e=t.call(this)||this;return Utils.AssetsMgr.loadGroup("group_champion"),e.skinName="ChampionSkin",e.championProxy=g.AppFacade.getInstance().retrieveProxy(g.ChampionPy.N),e.playerPy=g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N),e.fightPy=g.AppFacade.getInstance().retrieveProxy(g.FightPy.N),e.guideEffectWait=!0,e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.scheCountLeft&&(egret.clearInterval(this.scheCountLeft),this.scheCountLeft=void 0),this.removeNotice(),Utils.AssetsMgr.destroyGroup("group_champion")},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gp_main.touchChildren=!0,this._activateComponent(),this.addNotice(),this.initView(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btn),Utils.DeviceUtils.setLiuHaiPingAdapter(this.img_top)},e.prototype.initView=function(){this.sl_root.verticalScrollBar.visible=!1,this.sl_root.verticalScrollBar.autoVisibility=!1,this.collection=new eui.ArrayCollection,this.list=new eui.List,this.list.itemRenderer=i,this.list.dataProvider=this.collection,this.sl_root.viewport=this.list,this.cu_head=customui.PlayerHeadFactory.create(),this.cu_head.x=108,this.cu_head.y=27,this.cu_head.scaleX=this.cu_head.scaleY=.7,this.gp_bottom.addChild(this.cu_head)},e.prototype.addNotice=function(){},e.prototype.removeNotice=function(){},e.prototype.playWinActionBeforUpdate=function(r){return __awaiter(this,void 0,void 0,function(){var i,t,n,o,a=this;return __generator(this,function(e){for(i=!0,t=function(e){var t=n.list.getElementAt(e);if(t&&t.img_cloud_l.visible&&r)n.sl_root.stopAnimation(),n.gp_main.touchChildren=!1,egret.Tween.get(n.list).to({scrollV:n.list.contentHeight-n.sl_root.height-t.height},1e3).call(function(){a.gp_main.touchChildren=!0,t.hideCloud(function(){i&&(a.championProxy.isFist=!1,a.updateView({isStay:!0}),i=!1)})});else if(t&&!r)return n.sl_root.stopAnimation(),n.list.scrollV=n.list.contentHeight-n.sl_root.height,n.gp_main.touchChildren=!1,egret.Tween.get(n.list).to({scrollV:n.list.contentHeight-n.sl_root.height-t.height},1e3).call(function(){if(a.gp_main.touchChildren=!0,a.championProxy.isFist=!1,a.updateView(),a.championProxy.isTwo){var e=g.AppFacade.getInstance().retrieveProxy(g.ChampionPy.N);if(0<a.championProxy.championInfo.challengeInfo.count)a.championProxy.isTwo=!1,e.ChampionBattle();else g.AppFacade.getInstance().retrieveMediator(g.ChampionMediator.N).getSubView(g.ChampionMediator.SV.MAIN).buyCount()}}),"break"},o=(n=this).list.numElements;0<o&&"break"!==t(o);o--);return[2]})})},e.prototype.updateView=function(e){var t=this;if(void 0===e&&(e=void 0),!this.fightPy.isInFight){var i=this.championProxy.championInfo;if(i.id){var n=this.championProxy.checkCurLayerCanGet();if(e&&e.playWinActionBeforUpdate&&!n&&e.id)this.playWinActionBeforUpdate(e&&e.id);else{this.collection.removeAll();var o=i.id,a=o;n&&o!=g.Config.championMaxLayer()?a=o-=1:e&&e.isMove&&!i.allPassed&&(a-=1),i.allPassed&&!n&&(a++,o++),this.collection.addItemAt({fade:!0,config:{id:a-1,achievementReward:""}},0);for(var r=o+10,s=a;s<r;s++){var c=g.Config.champion()[s],l=g.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.Champion,{id:c&&c.id||1});c?this.collection.addItem({config:c,lock:o+1<s||l.isBelonged&&!l.unlock||!!c.forceLock,isCur:(!e||!e.isMove)&&(!n&&s==o),canGet:n&&s==o,id:o,isStay:!!e&&(!!e.isStay&&e.isStay)}):(c={id:s,achievementReward:"",names:" "},this.collection.addItem({config:c,lock:!0,isCur:!1,canGet:!1,id:o,isStay:!!e&&(!!e.isStay&&e.isStay),forceClound:!0}))}if(this.collection.length<4&&this.collection.addItemAt({fade:!0},0),this.collection.source.reverse(),this.collection.refresh(),this.list.validateNow(),!e||!e.playWinActionBeforUpdate||n||e.id){this.sl_root.stopAnimation(),this.list.scrollV=this.list.contentHeight-this.sl_root.height;var h=Number(g.Config.constConfig().ChampionRecoveryCD.constValue);this.blb_count.text=""+this.championProxy.championInfo.challengeInfo.count,this.scheCountLeft||(this.lb_recover.visible=!0,this.img_left_suffix.visible=!0,this.scheCountLeft=egret.setInterval(function(){var e=h-(Utils.TimerManager.getServerTime()-t.championProxy.championInfo.challengeInfo.lRCD);t.championProxy.championInfo.challengeInfo.count<g.Config.constConfig().ChampionMaxCount.constValue?0<e?t.lb_recover.text=Utils.TimerManager.getFormatBySecond1(e):t.championProxy.Champion():t.scheCountLeft&&(egret.clearInterval(t.scheCountLeft),t.scheCountLeft=void 0,t.lb_recover.visible=!1,t.img_left_suffix.visible=!1)},this,1e3));var p=h-(Utils.TimerManager.getServerTime()-this.championProxy.championInfo.challengeInfo.lRCD);0<p&&this.championProxy.championInfo.challengeInfo.count<g.Config.constConfig().ChampionMaxCount.constValue?this.lb_recover.text=Utils.TimerManager.getFormatBySecond1(p):(this.lb_recover.visible=!1,this.img_left_suffix.visible=!1),this.championProxy.isFist?(this.list.scrollV=0,this.once(egret.Event.ENTER_FRAME,function(){egret.Tween.get(t.list).to({scrollV:t.list.contentHeight-t.sl_root.height-80},1e3,egret.Ease.backOut).call(function(){t.setGuideAvailable()}),t.championProxy.isFist=!1},this)):this.setGuideAvailable();var d=g.Config.constConfig().ChampionHelpCount.constValue,u=this.championProxy.championInfo.challengeInfo.helpCount;this.bm_helpTimes.text=(u<d?d-u:0)+"/"+d}else this.playWinActionBeforUpdate(e&&e.id)}}}},e.prototype.buyCount=function(){var t=this;Number(g.Config.constConfig().ChampionMaxCount.constValue)!==this.championProxy.championInfo.challengeInfo.count?g.AppFacade.getInstance().showSubView(g.CommonMediator.N,g.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.Champion,curNum:this.championProxy.championInfo.challengeInfo.count,maxNum:Number(g.Config.constConfig().ChampionMaxCount.constValue),hasBuyNum:this.championProxy.championInfo.challengeInfo.buyCount,numLimit:!0,buyCB:function(e){t.championProxy.BuyChallengeCount(e)}}):Utils.MsgUtils.addMidMsg("当前次数已满")},e.prototype.adaptForGuide=function(e){t.prototype.adaptForGuide.call(this,e),e&&(this.list.useVirtualLayout=!1)},e.prototype._activateComponent=function(){var e=this;this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.championProxy.isFist=!0,g.MainJumpConfig.jumpTo()},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){g.AppFacade.getInstance().showSubView(g.RankMediator.N,g.RankMediator.SV.COMMON,{module:"CHAMPION"})},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.buyCount()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new g.HelpDialog({moduleId:MODULE.Champion})})},this)},e}(BaseFull);g.ChampionView=e,__reflect(e.prototype,"game.ChampionView");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ChampionFloorItemSkin",e.championProxy=g.AppFacade.getInstance().retrieveProxy(g.ChampionPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.touchChildren=!0,this.gp_baoxiang.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.canGet?(e.touchChildren=!1,e.gp_effectGuang.visible=e.gp_effect.visible=e.gp_lingqu.visible=!1,e.championProxy.ChampionAchievement(e.data.config.id,function(){DragonBoneTools.playOnce({effectName:"common_baoxiangkai",parent:e.gp_baoxiang,x:e.gp_baoxiang.width/2,y:e.gp_baoxiang.height/2,z:2,doneCB:function(){e.data.config.names?Utils.MsgUtils.addMidMsg("已通关最后一层，敬请期待"):e.championProxy.isTwo=!1,e.touchChildren=!0,g.AppFacade.getInstance().sendNotification(CN.CHAMPION_UPDATE_INFO,{playWinActionBeforUpdate:!0,id:e.id})}})})):g.AppFacade.getInstance().showSubView(g.CommonMediator.N,g.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(e.data.config&&e.data.config.achievementReward),type:g.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this),this.gp_light.alpha=0,this.gp_light.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){!e.data.fade&&e.data.config&&e.data.config.id==e.championProxy.championInfo.id&&g.AppFacade.getInstance().showSubView(g.ChampionMediator.N,g.ChampionMediator.SV.PREVIEW,{id:e.data.config.id})},this)},e.prototype.switchChuanSongMen=function(t){t&&!this.effectChuanSongMen?DragonBoneTools.create("common_patachuansongmen",function(e){this.effectChuanSongMen=e,this.effectChuanSongMen.y=this.gp_light.y/2-30,this.effectChuanSongMen.x=50,this.effectChuanSongMen.visible=t,this.effectChuanSongMen.animation.timeScale=1,this.effectChuanSongMen.animation.play("common_patachuansongmen",0),this.gp_light.addChild(this.effectChuanSongMen)},this):this.effectChuanSongMen&&(this.effectChuanSongMen.visible=t)},e.prototype.effectBaoXiang=function(e){e?(this.gp_baoxiang.visible=e,this.gp_effect.visible=e,this.gp_effectGuang.visible=e,this.effect||(this.gp_effectGuang.removeChildren(),DragonBoneTools.create("common_patabaoxiang",function(e){this.effect=e,this.effect.x=this.gp_baoxiang.width/2,this.effect.y=this.gp_baoxiang.height/2,this.effect.scaleX=this.effect.scaleY=1.2,this.effect.visible=!0,this.effect.animation.play(),this.effect.animation.timeScale=1,this.gp_effectGuang.addChild(this.effect)},this)),e&&!this.effect_baoxiang&&(this.gp_effect.removeChildren(),DragonBoneTools.create("common_baoxiang_5",function(e){this.effect_baoxiang=e,this.effect_baoxiang.x=this.gp_baoxiang.width/2,this.effect_baoxiang.y=this.gp_baoxiang.height/2+15,this.effect_baoxiang.visible=!0,this.effect_baoxiang.animation.timeScale=1,this.gp_effect.addChild(this.effect_baoxiang)},this))):this.gp_baoxiang.visible=e},e.prototype.dataChanged=function(){var e=this;this.gp_lock.visible=!1;var t;if(this.data.fade?(this.img_cloud_l.visible=this.img_cloud_r.visible=!1,this.img_kongmen.visible=!1,this.cu_model.visible=!1,this.gp_light.visible=!1,this.blb_floor.visible=!1,this.switchChuanSongMen(!1)):(this.img_kongmen.visible=!1,this.blb_floor.visible=!0,this.id=this.data.config.id,this.blb_floor.text=this.data.config.names||""+this.id,this.data.lock?(this.id-this.data.id>5-(this.data.id%5==0?5:this.data.id%5)||this.data.forceClound?(this.cu_model.visible=!1,this.img_cloud_l.visible=this.img_cloud_r.visible=!0):(0==this.cu_model.visible&&(this.data.isStay?egret.Tween.get(this.cu_model).to({alpha:0,visible:!0},100,egret.Ease.cubicIn).wait(250).to({alpha:1},100,egret.Ease.cubicOut):this.cu_model.visible=!0),this.img_cloud_l.visible=this.img_cloud_r.visible=!1),this.switchChuanSongMen(!1),this.gp_light.visible=!1):(this.data.isCur?(this.img_kongmen.visible=!0,egret.Tween.get(this.gp_light).to({alpha:0,visible:!0},100,egret.Ease.cubicIn).wait(250).to({alpha:1},100,egret.Ease.cubicOut),this.switchChuanSongMen(!0)):(this.switchChuanSongMen(!1),this.gp_light.visible=!1,this.img_kongmen.visible=!1),this.id-this.data.id>5-(this.data.id%5==0?5:this.data.id%5)?(this.cu_model.visible=!1,this.img_cloud_l.visible=this.img_cloud_r.visible=!0):(this.cu_model.visible||this.data.canGet||(this.data.isStay?egret.Tween.get(this.cu_model).to({alpha:0,visible:!0},100,egret.Ease.cubicIn).wait(250).to({alpha:1},100,egret.Ease.cubicOut):this.cu_model.visible=!0),this.img_cloud_l.visible=this.img_cloud_r.visible=!1)),(t=g.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.Champion,{id:e.data.config.id})).isBelonged&&(t.unlock||(e.cu_model.visible=!1,e.gp_lock.visible=!0,e.img_cloud_l.visible=e.img_cloud_r.visible=!0))),(this.cu_model.visible||this.data.isStay)&&this.cu_model.update({isStatic:!0,code:JSON.parse(this.data.config.creep1)[0]}),this.data.config&&this.data.config.id%2?this.currentState="you":this.currentState="zuo",this.effectBaoXiang(this.data.config&&""!=this.data.config.achievementReward&&!0),this.effect_baoxiang&&this.effect_baoxiang.animation.stop(),this.data.canGet){this.cu_model.visible=!1,this.gp_lingqu.visible=!0,this.effect_baoxiang&&this.effect_baoxiang.animation.play();egret.Tween.get(this.gp_lingqu,{loop:!0}).to({y:-22},500).to({y:-37},500)}else this.gp_lingqu.visible=!1},e.prototype.hideCloud=function(e){var t=this;if(this.data.forceClound)e();else{var i=this.img_cloud_l.x,n=this.img_cloud_r.x;egret.Tween.get(this.img_cloud_l).to({x:this.img_cloud_l.x-150,alpha:0},900,egret.Ease.sineOut),egret.Tween.get(this.img_cloud_r).to({x:this.img_cloud_r.x+150,alpha:0},1e3,egret.Ease.sineOut).call(function(){t.img_cloud_l.x=i,t.img_cloud_r.x=n,t.img_cloud_l.alpha=1,t.img_cloud_r.alpha=1,e()})}},e}(eui.ItemRenderer);__reflect(i.prototype,"ChampionFloorItem")}(game||(game={}));var _b,_c,_d,_e,_f,_g,FIGHT_CONST={DEBUG_DRAW_FIGHT_MODEL_ORIGIN_POS:!1,DEBUG_GLOBAL_MEDIATOR:!0,SKILL_EFFECT_SCALE:1,SPEED_X1:1.2,SPEED_X2:1.7,ROUND_TO_SHOW_SKIP:7,CAMERA_FOCUS_SCALE:1.3,CAMERA_FOCUS_DURATION:300,CAMERA_FOCUS_EASE:egret.Ease.circOut,MODEL_APPEAR_FINAL:250,MODEL_DEAD_FINAL:250,POP_TIPS_FLY:250,TIPS_BG_FLY_IN:250,DEFAULT_ATTK_OX:100,DEFAULT_HEAD_OY:350,DEFAULT_HEAD_OX:0,ACT_FACE_2_FACE_FLY_T:120,ACT_SKILL_TYPE:{JINZHAN:1,FASHU:2,ZHIXIANG:3,LASHEN:4,QUANPING:5},FIGHT_POS:(_a={},_a[PositionType.Normal]=(_b={},_b[0]=[0,0,100],_b[EBattleSide.EBattleSideAttack]=[[0,-205,100],[-120,-350,1],[-120,-155,1],[-120,30,1],[-280,-70,1],[-280,-250,1],[-235,-425,1],[-235,140,1]],_b[EBattleSide.EBattleSideDefence]=[[0,-205,100],[120,-350,1],[120,-155,1],[120,30,1],[280,-70,1],[280,-250,1],[235,-425,1],[235,140,1]],_b),_a[PositionType.OneTwo]=(_c={},_c[0]=[0,0,100],_c[EBattleSide.EBattleSideAttack]=[[0,-205,100],[-120,-350,1],[-120,-155,1],[-120,30,1],[-280,-70,1],[-280,-250,1],[-235,-425,1],[-235,140,1]],_c[EBattleSide.EBattleSideDefence]=[[0,-205,100],[120,-205,1],[280,-25,5],[280,-285,2]],_c.BossScale=1.32,_c),_a[PositionType.TwoOne]=(_d={},_d[0]=[0,0,100],_d[EBattleSide.EBattleSideAttack]=[[0,-205,100],[-120,-350,1],[-120,-155,1],[-120,30,1],[-280,-70,1],[-280,-250,1],[-235,-425,1],[-235,140,1]],_d[EBattleSide.EBattleSideDefence]=[[0,-205,100],[120,-335,1],[120,-75,3],[280,-205,2]],_d.BossScale=1.32,_d),_a[PositionType.ZeroOne]=(_e={},_e[0]=[0,0,100],_e[EBattleSide.EBattleSideAttack]=[[0,-205,100],[-120,-350,1],[-120,-155,1],[-120,30,1],[-280,-70,1],[-280,-250,1],[-235,-425,1],[-235,140,1]],_e[EBattleSide.EBattleSideDefence]=[[0,-205,100],[200,-205,5]],_e.BossScale=1.32,_e),_a[PositionType.ZeroOneBig]=(_f={},_f[0]=[0,0,100],_f[EBattleSide.EBattleSideAttack]=[[0,-205,100],[-120,-350,1],[-120,-155,1],[-120,30,1],[-280,-70,1],[-280,-250,1],[-235,-425,1],[-235,140,1]],_f[EBattleSide.EBattleSideDefence]=[[0,-205,100],[200,-205,5]],_f.BossScale=1.43,_f),_a[PositionType.Chess8V8]=(_g={},_g[0]=[0,0,100],_g[EBattleSide.EBattleSideAttack]=[[0,-205,100],[-120,-345,1],[-120,-225,1],[-120,-65,3],[-225,90,6],[-280,-25,5],[-280,-165,2],[-280,-305,2],[-225,-400,0]],_g[EBattleSide.EBattleSideDefence]=[[0,-205,100],[120,-345,1],[120,-225,1],[120,-65,3],[225,90,6],[280,-25,5],[280,-165,2],[280,-305,2],[225,-400,0]],_g),_a),GUIDE_INNER_FIGHT:{a:{result:1,battleType:18,clientReward:{rewards:[{type:2,code:1,num:1600,expiredDt:null}],heros:[],heroEquips:[],heroArtifacts:[],pets:[],treasures:[],magicals:[],maps:[],heroDermas:[],vestageHeros:[],fashions:[]},battleInfo:{uuid:"5d5d07501a975a588f1ba4bb",rounds:[{roundNum:1,seqAttack:[{entityId:111,skillId:901040,buffStatus:[],seqBattleEffect:[{effectId:901040,seqBattleRes:[{entityId:211,status:0,value:-15836160694,beSockedBlood:null,buffAdd:[{type:10,value:1}],buffRemove:[],life:0,anger:60,skillId:901040}],sockBlood:0,antiInjury:null}],buffRemove:[],life:110073258,anger:0,combo:!1}],afterBattleRes:[],beforeBattleRes:[]}],battleDt:1571821148},teams:[{playerId:101415,name:"保守的坦纳",camp:1,entities:[{entityId:111,code:41000001,type:1,life:110073258,lifeMax:110073258,anger:100,angerMax:100,level:1e3,dermaCode:0},{entityId:112,code:41020003,type:1,life:70210,lifeMax:70210,anger:50,angerMax:100,level:40,dermaCode:0}],positionType:null,magical:{entityId:110,code:120000003,anger:0,angerMax:100},avatar:null,level:299,frame:null},{playerId:null,name:null,camp:2,entities:[{entityId:211,code:41020041,type:2,life:200,lifeMax:200,anger:50,angerMax:100,level:1,dermaCode:null}],positionType:null,magical:null,avatar:null,level:null,frame:null}],hurt:null,star:null,entityResults:[{entityId:112,totalHurt:0,totalCure:0,life:70210},{entityId:211,totalHurt:0,totalCure:0,life:0},{entityId:110,totalHurt:0,totalCure:0,life:0},{entityId:111,totalHurt:200,totalCure:0,life:110073258}],normalRewards:[],extRewards:[],escaped:null,vestageRecords:null}}};!function(i){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new n).register()},e}();i.CopyEntranceProcessor=e,__reflect(e.prototype,"game.CopyEntranceProcessor");var t=function(e){function t(){return e.call(this,"fortress.DailyFortressP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("DailyFortressP",t),i.AppFacade.getInstance().retrieveProxy(i.CopyEntrancePy.N).updateDailyFortressInfo(t.dailyFortress)},t}(i.ProcessorBase);i.DailyFortressP=t,__reflect(t.prototype,"game.DailyFortressP");var n=function(e){function t(){return e.call(this,"expedition.ExpeditionInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("ExpeditionInfoP",t),i.AppFacade.getInstance().retrieveProxy(i.CopyEntrancePy.N).updateExpeditionInfo(t.info)},t}(i.ProcessorBase);i.ExpeditionInfoP=n,__reflect(n.prototype,"game.ExpeditionInfoP")}(game||(game={})),function(s){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.openAnm=!1,e.dailyFortressInfo={},e.expeditionInfo=new s.ExpeditionVO,e.addNotice(),e}return __extends(i,t),i.prototype.addNotice=function(){var e=this;NoticeManager.registerCB(NT.EXPEDITION_CHALLENGE,function(){return Utils.UnlockMgr.checkPass(MODULE.Expedition,!1).allow&&!Utils.LocalStorageUtil.getTodayVaild("expedtionNotice")&&e.expeditionInfo&&0==e.expeditionInfo.sectionId},this),NoticeManager.registerCB(NT.DAILY_COPY,this.checkDailyNotice,this),NoticeManager.registerCB(NT.EXPEDITION_REWARD,this.checkExpedRewardNotice,this),NoticeManager.setChildType(NT.EXPEDITION,[NT.EXPEDITION_REWARD,NT.EXPEDITION_CHALLENGE])},i.prototype.updateDailyFortressInfo=function(e){var t=this;Array.isArray(e)||(e=[e]),e.forEach(function(e){t.dailyFortressInfo[e.fortressId]?t.dailyFortressInfo[e.fortressId].update(e):t.dailyFortressInfo[e.fortressId]=new s.DailyFortressVO(e)}),NoticeManager.updateNotice(NT.DAILY_COPY,void 0,!0)},i.prototype.GetDailyFortress=function(){var t=this;Utils.Socket.send("fortress","GetDailyFortress",{}).then(function(e){t.log("获取日常副本信息   GetDailyFortressR",e),t.updateDailyFortressInfo(e.dailyFortresses),s.AppFacade.getInstance().updateView(s.CopyEntranceMediator.N,s.CopyEntranceMediator.SV.DAILY_COPY)})},i.prototype.BuyDailyChallenge=function(e){var t=this;Utils.Socket.send("fortress","BuyDailyChallenge",{fortressId:e.fortressId,num:e.num}).then(function(e){t.log("购买次数   BuyDailyChallengeR",e),Utils.MsgUtils.addMidMsg("购买成功"),t.updateDailyFortressInfo(e.dailyFortress),s.AppFacade.getInstance().updateView(s.CopyEntranceMediator.N,s.CopyEntranceMediator.SV.DAILY_COPY_LIST),s.AppFacade.getInstance().updateView(s.CopyEntranceMediator.N,s.CopyEntranceMediator.SV.DAILY_COPY)})},i.prototype.makePlayerInfo=function(e,t,i,n){var o=new s.PlayerInfoVO;return o.name=e,o.level=t,o.playerVip.vipLevel=i,o.fightCap=n,o},i.prototype.ChallengeDailyFortress=function(e){this.curFortessId=e&&e.id,s.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeDailyFortress,customParams:{fightBg:"fight_scene_jjc",tips:['<b><font color="#ffffff" size="22">挑战成功</font>','<b><font color="#ffffff" size="22">挑战失败</font></b>']},pb1:"fortress",pb2:"ChallengeDailyFortress",params:{stageId:e.id},doneCB:function(e){console.log("战斗结束",e),s.AppFacade.getInstance().updateView(s.CopyEntranceMediator.N,s.CopyEntranceMediator.SV.DAILY_COPY_LIST);var t=s.AppFacade.getInstance().retrieveProxy(s.FightPy.N);t.queueExceExitCB(),t.dailyFakeFight=!1}})},i.prototype.GetExpeditionInfo=function(){var t=this;Utils.Socket.send("expedition","GetExpeditionInfo",{}).then(function(e){t.log("远征信息   GetExpeditionInfoR",e),t.updateExpeditionInfo(e.info)})},i.prototype.GetExpeditionRewards=function(e,t){var i=this;Utils.Socket.send("expedition","GetExpeditionRewards",{id:e}).then(function(e){i.log("获取远征奖励   GetExpeditionRewardsR",e),t||egret.setTimeout(function(){s.AppFacade.getInstance().retrieveProxy(s.BackpackPy.N).handleClientReward(e.clientReward)},i,600),i.updateExpeditionInfo(e.info),s.AppFacade.getInstance().updateView(s.CopyEntranceMediator.N,s.CopyEntranceMediator.SV.ACHIEVE_REWARD)})},i.prototype.ChallengeExpedtion=function(){s.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeBattleExpedition,customParams:{fightBg:"fight_scene_jjc",tips:['<b><font color="#ffffff" size="22">挑战成功</font>','<b><font color="#ffffff" size="22">挑战失败</font></b>']},pb1:"expedition",pb2:"ChallengeExpedition",params:{},doneCB:function(e){console.log("战斗结束",e),s.AppFacade.getInstance().updateView(s.CopyEntranceMediator.N,s.CopyEntranceMediator.SV.EXPEDITION),Utils.LocalStorageUtil.setTodayVaild("expedtionNotice"),NoticeManager.updateNotice(NT.EXPEDITION_CHALLENGE),s.AppFacade.getInstance().retrieveProxy(s.FightPy.N).queueExceExitCB()}})},i.prototype.getrewardInfo=function(e){var t=this.expeditionInfo.opponentList;if(0!=t.length)for(var i=0;i<t.length;i++)if(e==t[i].sectionId)return t[i]},i.prototype.checkExpedRewardNotice=function(){var e=this.expeditionInfo.sectionId,t=this.expeditionInfo.targeted,i=s.Config.expeditionAchievement();for(var n in i){var o=i[n],a=t&&-1!=t.indexOf(o.id),r=!a&&o.id<=e;if(!a&&r)return!0}return!1},i.prototype.updateExpeditionInfo=function(e){this.expeditionInfo.sectionId<e.sectionId&&(this.openAnm=!0),this.expeditionInfo.update(e),NoticeManager.updateNotice(NT.EXPEDITION_REWARD,{},!0),s.AppFacade.getInstance().updateView(s.CopyEntranceMediator.N,s.CopyEntranceMediator.SV.EXPEDITION)},i.prototype.closeAnm=function(){this.openAnm=!1},i.prototype.ColorMatrix=function(){return[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]},i.prototype.checkDailyNotice=function(){var e=s.Config.dailyFortress(),t=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N).playerInfoVO.level;for(var i in e){if(!(t<e[i].levelLimit))for(var n in this.dailyFortressInfo){var o=this.dailyFortressInfo[n];if(o.fortressId==parseInt(i)&&0<o.leftChallenge)return!0}}return!1},i.N="CopyEntrancePy",i}(BaseProxy);s.CopyEntrancePy=e,__reflect(e.prototype,"game.CopyEntrancePy")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.ENTRANCE_CONFIG={DAILY:{desc:"日常副本",rankingType:void 0,moduleId:MODULE.DailyFortress,bg:"wfrk_img_rukou_rcfb_png",notice:NT.DAILY_COPY,descDown:"每日可获取大量培养道具"},EXPED:{desc:"英雄远征",rankingType:void 0,moduleId:MODULE.Expedition,bg:"wfrk_img_rukou_yxyz_png",notice:NT.EXPEDITION,descDown:"可获取远征币，兑换英雄和碎片"},TEAM_COPY:{desc:"组队副本",rankingType:void 0,notice:NT.TEAM_EXPE_REWARD_ENTRANCE,moduleId:MODULE.TeamExpedition,bg:"wfrk_img_rukou_zdfb_png",descDown:"可获取各种稀有道具和英雄"},DEEP_NEST:{desc:"深渊巢穴",rankingType:void 0,notice:NT.DEEP_NEST,moduleId:MODULE.AbyssLair,bg:"wfrk_img_shenyuanchaoxue_png",descDown:"可获取淬炼石和其他道具"}},Utils.AssetsMgr.loadGroup("group_copy_entrance"),e.skinName="PvpEntranceViewSkin",e._popActionType=5,e._removeActionType=6,e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_copy_entrance")},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.img_title.source="wfrk_txt_fbtz_png"},e.prototype.initList=function(){this.item_list=new eui.List;var e=new eui.VerticalLayout;(this.item_list.layout=e).gap=10,e.horizontalAlign=egret.HorizontalAlign.CENTER,this.item_list.itemRenderer=i,this.scroller.viewport=this.item_list},e.prototype.updateView=function(){var e=[];for(var t in this.ENTRANCE_CONFIG)this.ENTRANCE_CONFIG[t].view=this,e.push(this.ENTRANCE_CONFIG[t]);this.item_list.dataProvider=new eui.ArrayCollection(e),this.gp_root.height=179*e.length+10*(e.length-1)},e}(BasePanel);a.CopyEntranceView=e,__reflect(e.prototype,"game.CopyEntranceView");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="EntranceView_ListItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.gp_black.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.jumpFunc?this.data.jumpFunc()?a.AppFacade.getInstance().hideSubView(a.CopyEntranceMediator.N,a.CopyEntranceMediator.SV.ENTRANCE):this.parent.selectedIndex=void 0:a.MainJumpConfig.jumpTo(this.data.moduleId)?a.AppFacade.getInstance().hideSubView(a.CopyEntranceMediator.N,a.CopyEntranceMediator.SV.ENTRANCE):this.parent.selectedIndex=void 0},this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){e.skin.currentState=""},this)},e.prototype.dataChanged=function(){this.img_bg.source=this.data.bg,this.data.notice&&NoticeManager.addNoticeListener(this.data.notice,this.gp_bg,this.data.view,{percentX:554/578,percentY:0});var e=Utils.UnlockMgr.checkPass(this.data.moduleId,!1);if(this.lb_unlock.text=this.data.descDown||"",e.allow)switch(this.data.moduleId){case MODULE.ZoneBoss:this.countdownForZoneBoss()}else UIActionManager.setAbsGrey(this,!0),this.lb_unlock.text=e.ext.requestLevel?e.ext.requestLevel+"级可开启":e.ext.tips},e.prototype.countdownForZoneBoss=function(){var e=this,t=a.AppFacade.getInstance().retrieveProxy(a.ZoneBossPy.N).getOpenInfo();if(this.gp_time.visible=!0,this.lb_unlock.text="",this.lb_miaoshu.text="",t.isOpen)this.lb_unlock.text=this.data.descDown;else{var i=parseInt(a.Config.constConfig().ZoneBossServerOpenDt.constValue),n=Utils.TimerManager.getServerTime(),o=Utils.TimerManager.getTimeInDaysAfterServerOpen(i);n<o?(this.lb_unlock.text="",this.lb_miaoshu.text="开启倒计时：",this.timerDt=o-n,this.lb_day.visible=!0,this.lb_day.text=Utils.TimerManager.getFormatBySecond2(this.timerDt),this.endingTimer||(this.endingTimer=egret.setInterval(function(){0<=e.timerDt?e.lb_day.text=Utils.TimerManager.getFormatBySecond2(e.timerDt):(e.countdownForZoneBoss(),e.endingTimer&&egret.clearTimeout(e.endingTimer))},this,1e3))):this.lb_miaoshu.text="已结束",UIActionManager.setAbsGrey(this.gp_bg,!0)}},e}(eui.ItemRenderer);__reflect(i.prototype,"EntranceView_ListItem")}(game||(game={})),function(r){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=r.AppFacade.getInstance().retrieveProxy(r.CopyEntrancePy.N),e.firstIn=!0,e.effectNameMap={1:"richangfb_bg_jysk",2:"richangfb_bg_jbbz",3:"richangfb_bg_sjsx",4:"richangfb_bg_yxbl",5:"",6:"richangfb_bg_sqfz"},e.skinName="DailyCopyEntranceSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.resource_bar),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_help),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.MainJumpConfig.jumpTo()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new r.HelpDialog({moduleId:MODULE.DailyFortress})})},this)},e.prototype.updateView=function(){if(this.firstIn)this.firstIn=!1,this.proxy.GetDailyFortress();else{var n=r.Config.dailyFortress(),o=r.AppFacade.getInstance().retrieveProxy(r.PlayerPy.N).playerInfoVO.level;this.resource_bar.updateBar({costs:[EPropertyType.EPropertyTypeDiamond],width:190,needAdd:!0});var e=function(e){var t=n[e],i=a["gp_"+e];o<t.levelLimit?UIActionManager.setGrey(i,!0):UIActionManager.setGrey(i,!1),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o<t.levelLimit?Utils.MsgUtils.addMidMsg(t.levelLimit+"级开启"):r.AppFacade.getInstance().showSubView(r.CopyEntranceMediator.N,r.CopyEntranceMediator.SV.DAILY_COPY_LIST,{id:t.id})},a),a.effectNameMap[e]&&""!=a.effectNameMap[e]&&DragonBoneTools.playOnce({effectName:a.effectNameMap[e],parent:i,loop:!0,y:2*i.height/3,z:0,static:o<t.levelLimit})},a=this;for(var t in n)e(t)}},e}(BaseFull);r.DailyCopyEntrance=e,__reflect(e.prototype,"game.DailyCopyEntrance")}(game||(game={})),function(h){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=h.AppFacade.getInstance().retrieveProxy(h.CopyEntrancePy.N),e.playerProxy=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N),e.skinName="DailyCopyListSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.daTanChuKuang.onCloseCB=function(){h.AppFacade.getInstance().hideSubView(h.CopyEntranceMediator.N,h.CopyEntranceMediator.SV.DAILY_COPY_LIST)},this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this,e=this.proxy.dailyFortressInfo[this.id].leftChallenge,i=h.Config.dailyFortress()[this.id].initTimes,n=h.Config.VIPConfig().dailyFortressTimes,o=this.proxy.dailyFortressInfo[this.id];h.AppFacade.getInstance().showSubView(h.CommonMediator.N,h.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.DailyFortress,curNum:e,maxNum:i,hasBuyNum:o.buyChallenge,maxBuyNum:n,buyCB:function(e){t.proxy.BuyDailyChallenge({fortressId:t.id,num:e})}})},this),this.list_item.useVirtualLayout=!1},e.prototype.initList=function(){this.list_item.itemRenderer=i,UIActionManager.hideScrollerBar(this.scroller)},e.prototype.updateView=function(e){var t=this;this.id=e&&e.id||this.id;var i=h.Config.dailyFortress()[this.id],n=this.proxy.dailyFortressInfo[this.id];this.daTanChuKuang.blb_title.text=i.name;var o=h.Config.dailyFortressStage(),a=[],r=JSON.parse(i.stages),s=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N).playerInfoVO.level,c=0;r.forEach(function(e,t){s>=o[e].levelLimit&&c++,a.push({config:o[e],info:n})}),this.list_item.dataProvider=new eui.ArrayCollection(a);var l=108*c+6*(c-1)-this.scroller.height;l<0&&(l=0),egret.setTimeout(function(){t.scroller.viewport.scrollV=l},this,100),this.blb_remaining_times.text=n.leftChallenge+"/"+i.initTimes},e}(BasePanel);h.DailyCopyListPanel=e,__reflect(e.prototype,"game.DailyCopyListPanel");var i=function(t){function e(){var e=t.call(this)||this;return e.playerPy=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N),e.EntrPy=h.AppFacade.getInstance().retrieveProxy(h.CopyEntrancePy.N),e.skinName="DailyCopyListPanel_ItemList",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_enter.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<this.data.info.leftChallenge?this.EntrPy.ChallengeDailyFortress({id:this.data.config.id}):Utils.MsgUtils.addMidMsg("次数不足")},this)},e.prototype.dataChanged=function(){var i=this;this.img_icon.source=DAILY_COPY_DIFFICULT_ICON[Number(this.data.config.name)];var e=JSON.parse(this.data.config.rewards);this.gp_rewards.removeChildren(),e.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),t.scaleX=t.scaleY=.65,i.gp_rewards.addChild(t)});var t=this.playerPy.playerInfoVO.level,n=(h.GameMVC.zoneBossProxy,h.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.DailyFortress,{id:this.data.config.id})),o=function(){t<i.data.config.levelLimit?(i.gp_fightCap.visible=!1,i.lb_lock.visible=!0,i.lb_lock.text=i.data.config.levelLimit+"级开启",i.btn_enter.enabled=!1,UIActionManager.setAbsGrey(i.btn_enter)):(i.gp_fightCap.visible=!0,i.lb_lock.visible=!1,i.blb_fightCap.text=i.data.config.fightCap.toString(),i.btn_enter.enabled=!0,UIActionManager.setAbsGrey(i.btn_enter,!1))};n.isBelonged?n.unlock?o():(this.gp_fightCap.visible=!1,this.lb_lock.visible=!0,this.lb_lock.text="封印之地解锁",this.btn_enter.enabled=!1,UIActionManager.setAbsGrey(this.btn_enter)):o()},e}(eui.ItemRenderer);__reflect(i.prototype,"DailyCopyListPanel_ItemList")}(game||(game={})),function(h){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=h.AppFacade.getInstance().retrieveProxy(h.CopyEntrancePy.N),e.skinName="ExpeditionAchievementRewardSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initProgressBar(),this.initRewardPreviewGroup(),this.xiaotanchuang.blb_title.text="奖励"},e.prototype.initProgressBar=function(){this.progressBar.maximum=this.progressBar.width-24,this.progressBar.minimum=0;for(var e=1;e<6;e++){this.progressBar["lb_"+e].text=(3*e).toString()}},e.prototype.initRewardPreviewGroup=function(){var e=new egret.Sprite;e.graphics.beginFill(0,0),e.graphics.drawRect(0,0,this.gp_root.width,this.gp_root.height),e.graphics.endFill(),this.gp_preview.addChildAt(e,0),e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_preview.visible=!1},this)},e.prototype.updateView=function(){var r=this.proxy.expeditionInfo.sectionId,s=this.proxy.expeditionInfo.targeted,c=h.Config.expeditionAchievement(),e=function(e){var t=c[e],i=-1!=s.indexOf(t.id),n=!i&&t.id<=r;if(l.gp_items.getChildByName(e)){var o=l.gp_items.getChildByName(e);o.updateReceived(i),o.updateAvailable(n)}else{var a=new p({config:t,received:i,available:n});a.name=e,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.rewardItemTap(a,t)},l),l.gp_items.addChild(a)}},l=this;for(var t in c)e(t);this.setProgressBarValue(r),this.allRewardsOpen()},e.prototype.allRewardsOpen=function(){var l=this;this.once(egret.Event.ENTER_FRAME,function(){egret.setTimeout(function(){var e=h.Config.expeditionAchievement(),t=l.proxy.expeditionInfo.targeted,i=l.proxy.expeditionInfo.sectionId,n=[];for(var o in e){var a=e[o],r=!(-1!=t.indexOf(a.id))&&a.id<=i,s=JSON.parse(e[o].rewards);if(r){for(var c=0;c<s.length;++c)n[c]?n[c][2]+=s[c][2]:n.push(s[c]);l.proxy.GetExpeditionRewards(a.id,!0)}}0<n.length&&egret.setTimeout(function(){h.AppFacade.getInstance().showSubView(h.CommonMediator.N,h.CommonMediator.SV.REWARD_PANEL,{rewards:n,type:h.CommonRewardPreviewPanel.REWARD_TYPE.REWARD})},l,600)},l,500)},this)},e.prototype.rewardItemTap=function(e,t){e.available?this.proxy.GetExpeditionRewards(t.id):h.AppFacade.getInstance().showSubView(h.CommonMediator.N,h.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(e.data.config.rewards),type:h.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},e.prototype.setProgressBarValue=function(e){var t=(this.progressBar.lb_pro.text=e)-this.progressBar.value;if(0<e){var i=this.progressBar.maximum*this.progressBar.scaleX*e/15+20-e/15*4;this.progressBar.value=this.progressBar.maximum*this.progressBar.scaleX*e/15+10-e/15*4,egret.Tween.get(this.progressBar.gp_section).to({x:i},this.progressBar.slideDuration*Math.abs(t)/this.progressBar.maximum)}},e.prototype.updateRewardPreviewGroup=function(e){var i=this,t=JSON.parse(e.rewards);this.gp_preview_rewards.removeChildren();t.forEach(function(e){0;var t=customui.BaseItemFactory.create();t.updateData({code:e[1],num:e[2]}),i.gp_preview_rewards.addChild(t)})},e}(BasePanel);h.ExpeditionAchievementRewardPanel=e,__reflect(e.prototype,"game.ExpeditionAchievementRewardPanel");var p=function(i){function e(e){var t=i.call(this)||this;return t.data=e,t.skinName="AchievementRewardPanel_RewardItem",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data&&this.updateItem(this.data)},e.prototype.updateItem=function(e){this.data=e,this.updateReceived(this.data.received),this.updateAvailable(this.data.available)},e.prototype.updateReceived=function(e){this.received=e},e.prototype.updateAvailable=function(e){var t,i=this;this.available=e;var n=this.data.config.id/3;if(this.received||this.available?this.received&&!this.available&&(t="jiangli_icon_baoxiang0"+n+"_02_png"):t="jiangli_icon_baoxiang0"+n+"_01_png",t&&RES.getResAsync(t,function(e){i.img_bg.source=e,i.img_bg.visible=!0},this),this.available&&!this.received){this.img_bg.visible=!1;var o="common_baoxiang_"+n;this.box_effect||DragonBoneTools.create(o,function(e){var t=this;this.box_effect=e,this.box_effect.x=this.gp_effect.width/2-5,this.box_effect.y=65,this.box_effect.scaleX=this.box_effect.scaleY=.85,this.box_effect.animation.play(),this.gp_effect.addChild(this.box_effect),egret.setTimeout(function(){t.gp_effect.removeChildren()},this,500)},this)}else!this.available&&this.received&&!this.box_effect_kai&&this.box_effect&&DragonBoneTools.playOnce({effectName:"common_baoxiangkai",parent:this,x:this.gp_root.width/2-5,y:this.img_bg.height-25,scaleX:.85,scaleY:.85})},e}(eui.Component);__reflect(p.prototype,"AchievementRewardPanel_RewardItem")}(game||(game={})),function(g){var e=function(t){function e(){var e=t.call(this)||this;return e.EntrancePy=g.AppFacade.getInstance().retrieveProxy(g.CopyEntrancePy.N),e.skinName="HearExpeditionChallengeSkin",e.proxy=g.AppFacade.getInstance().retrieveProxy(g.ArenaPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward_items=new Array,this.inButton()},e.prototype.inButton=function(){var e=this;this.challge_bnt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide(),e.EntrancePy.ChallengeExpedtion()},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){g.AppFacade.getInstance().showSubView(g.HeroMediator.N,g.HeroMediator.SV.FORMATION)},this);var t=new eui.HorizontalLayout;t.horizontalAlign=egret.HorizontalAlign.CENTER,this.gp_enermy.layout=t},e.prototype.updateView=function(e){var i=this;this.num=e.id;var t=this.EntrancePy.expeditionInfo,n=t.opponentInfo;e.cu||(n=t=this.EntrancePy.getrewardInfo(e.id)),this.currentState=e.cu?"can":"no";var o=this.EntrancePy.makePlayerInfo(n.baseInfo.name,n.baseInfo.level,n.baseInfo.vlevel,n.baseInfo.fightCap);this.headName.text=n.baseInfo.name,this.severId.text="S"+(n.baseInfo.serverId||0),this.cu_playerHead.updateData({vo:o}),this.cfc_fightcap.update(n.baseInfo.fightCap),this.colorFlilter=new egret.ColorMatrixFilter(this.EntrancePy.ColorMatrix()),this.gp_enermy.filters=e.cu?[]:[this.colorFlilter];for(var a=g.Config.expedition()[e.id],r=0,s=this.reward_items;r<s.length;r++){var c=s[r];c&&c.parent&&c.parent.removeChild(c)}for(var l=0,h=0,p=JSON.parse(a.rewards);h<p.length;h++){var d=p[h],u=customui.BaseItemFactory.create(21);u.updateData({type:d[0],code:d[1],num:d[2]}),u.y=0,u.x=0+l++*(u.width+30)*.7,u.scaleX=.7,u.scaleY=.7,this.reward_items.push(u),this.gp_reward_show.addChild(u)}n.heroList.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e.code,level:e.level}),t.scaleX=t.scaleY=.7,i.gp_enermy.addChild(t)})},e}(BasePanel);g.ExpeditionehCallengeView=e,__reflect(e.prototype,"game.ExpeditionehCallengeView")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.init=!0,e.stepping=!1,e.curSectionId=0,e.isLock=!1,e.LEVEL_NUM=15,e.AinImg=["x_","y_","z_","img_tip_"],e.skinName="HearExpeditionSkin",e.proxy=a.AppFacade.getInstance().retrieveProxy(a.CopyEntrancePy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent(),this.addSceneEffect(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btn),NoticeManager.addNoticeListener(NT.EXPEDITION_REWARD,this.btn_reward.$children[0],this,BTN_ICON_NOTICE_POS)},e.prototype.addSceneEffect=function(){this.gp_effs.removeChildren();var e={yuanzheng_bg_chengbao:{x:335,y:244},yuanzheng_bg_ditu_1:{x:338,y:525},yuanzheng_bg_ditu_2:{x:151,y:1e3}},t=function(t){var i=e[t];DragonBoneTools.create(t,function(e){e.x=i.x,e.y=i.y,e.animation.play(),this.gp_effs.addChild(e),"yuanzheng_bg_chengbao"==t&&(this.tip_14_eff=e,this.tip_14_eff.visible=15!=this.proxy.expeditionInfo.sectionId)},n)},n=this;for(var i in e)t(i)},e.prototype.isPass=function(e){var t=this.proxy.expeditionInfo.sectionId;e==t?a.AppFacade.getInstance().showSubView(a.CopyEntranceMediator.N,a.CopyEntranceMediator.SV.EXPEDITION_CHALLENGE,{id:e+1,cu:!0}):(t<e&&Utils.MsgUtils.addMidMsg("未开启"),e<t&&a.AppFacade.getInstance().showSubView(a.CopyEntranceMediator.N,a.CopyEntranceMediator.SV.EXPEDITION_CHALLENGE,{id:e+1,cu:!1}))},e.prototype.updateView=function(){if(this.init){this.curSectionId=this.proxy.expeditionInfo.sectionId,this.init=!1,this.showCurPosBtn();for(var e=0;e<this.LEVEL_NUM;e++){if(this.curSectionId<e)for(var t=0;t<this.AinImg.length;t++)this[this.AinImg[t]+e].visible=!1;if(this.curSectionId>e)if(14==e){var i=this["tip_"+e];15==this.curSectionId?(this.tip_14_eff&&(this.tip_14_eff.visible=!1),i.source="yuanzheng_bg_chengbao1_png",i.visible=!0,i.touchEnabled=!1,this.img_tip_14.visible=!1):UIActionManager.setAbsGrey(i,!0)}else this["img_tip_"+e].alpha=1,this["img_tip_"+e].touchEnabled=!1,this["img_tip_"+e].visible=!0,this["img_tip_cur_"+e].visible=!1}}else this.stepping||this.startStepping();var n=Utils.UnlockMgr.checkPass(MODULE.ExpeditionSaoDang,!1).allow;if(this.isLock=n){var o=15==this.proxy.expeditionInfo.sectionId;this.btn_mopUp.enabled=!o,UIActionManager.setGrey(this.btn_mopUp,o)}else UIActionManager.setGrey(this.btn_mopUp,!0)},e.prototype.showCurPosBtn=function(){for(var e=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),t=JSON.parse(a.Config.constConfig().DefaultAvatar.constValue)[0],i=e.playerInfoVO.avatar||t,n=0;n<this.LEVEL_NUM;n++)this["img_tip_cur_"+n]&&(this["img_tip_cur_"+n].visible=!1,n<this.curSectionId&&(this["img_tip_"+n].visible=!0));if(15!=this.curSectionId){var o=this["img_tip_cur_"+this.curSectionId];o.visible=!0,this["img_tip_"+this.curSectionId].visible=!1,this.curSectionId<14&&(o.iconDisplay.source=ResourceUtils.png(i),UIActionManager.jumping(o.gp_head))}},e.prototype.startStepping=function(){var e=this;if(this.stepping=!0,this.curSectionId<this.proxy.expeditionInfo.sectionId){this.curSectionId+=1,this.showCurPosBtn();var t=this["img_tip_cur_"+this.curSectionId];if(t&&(t.alpha=0),15!=this.curSectionId){for(var i=0;i<this.AinImg.length-1;i++)this[this.AinImg[i]+this.curSectionId].visible=!0,this[this.AinImg[i]+this.curSectionId].alpha=0;egret.Tween.get(this["x_"+this.curSectionId]).wait(0).to({alpha:1},500,egret.Ease.backOut),egret.Tween.get(this["y_"+this.curSectionId]).wait(500).to({alpha:1},500,egret.Ease.backOut),egret.Tween.get(this["z_"+this.curSectionId]).wait(1e3).to({alpha:1},500,egret.Ease.backOut),egret.Tween.get(t).wait(1e3).to({alpha:1},500,egret.Ease.backOut).call(function(){e.curSectionId<e.proxy.expeditionInfo.sectionId?e.startStepping():egret.Tween.get(t).to({alpha:1},500,egret.Ease.backOut).call(function(){e.startStepping()})})}else 15==this.curSectionId&&(this.img_tip_14.touchEnabled=!1,this.img_tip_14.visible=!1,this.tip_14_eff&&(this.tip_14_eff.visible=!1),this.tip_14.visible=!0)}else this.stepping=!1},e.prototype.activateComponent=function(){var t=this;this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().showSubView(a.CopyEntranceMediator.N,a.CopyEntranceMediator.SV.ACHIEVE_REWARD)},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeExpedition})},this);for(var e=function(e){i["img_tip_cur_"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.isPass(e)},i)},i=this,n=0;n<this.LEVEL_NUM;n++)e(n);this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.MainJumpConfig.jumpTo()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new a.HelpDialog({moduleId:MODULE.Expedition})})},this),Utils.TouchUtils.addTouchListener(this.btn_mopUp,function(){Utils.UnlockMgr.checkPass(MODULE.ExpeditionSaoDang,!0).allow&&(15!=t.proxy.expeditionInfo.sectionId?a.AppFacade.getInstance().showSubView(a.CommonMediator.N,a.CommonMediator.SV.MOP_UP,{pb1:"expedition",pb2:"MopUpExpedition",cb:function(e){return Utils.LocalStorageUtil.setTodayVaild("expedtionNotice"),NoticeManager.updateNotice(NT.EXPEDITION_CHALLENGE),t.proxy.updateExpeditionInfo(e.info),a.AppFacade.getInstance().updateView(a.CopyEntranceMediator.N,a.CopyEntranceMediator.SV.EXPEDITION),15!=t.proxy.expeditionInfo.sectionId},tipsFunc:function(e){return"第"+(t.proxy.expeditionInfo.sectionId+1)+"关"}}):Utils.MsgUtils.addMidMsg("已通关"))})},e}(BaseFull);a.ExpeditionView=e,__reflect(e.prototype,"game.ExpeditionView")}(game||(game={})),function(n){var e=function(i){function o(e){void 0===e&&(e=null);var t=i.call(this,o.N,e)||this;return t.proxy=n.AppFacade.getInstance().retrieveProxy(n.DeepNestPy.N),t}return __extends(o,i),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,n.DeepNestMainView),this.addSubView(o.SV.CHALLENGE,n.DeepNestChallengePanel)},o.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.DEEP_NEST_UPDATEMAIN,CN.DEEP_NEST_UPDATEHERO,CN.DEEP_NEST_UPDATEPETANDART,CN.DEEP_NEST_UPDATEREWARD,CN.DEEP_NEST_UPDATECOUNT,CN.DEEP_NEST_SETPOSBYWAIGUA,CN.BACKPACK_MULTI_TEAM_UPDATE]},o.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.AbyssLair,!1).allow&&(this.proxy.isFirst=!0,this.proxy.GetAbyssLairInfo());break;case CN.DEEP_NEST_UPDATEMAIN:var i=this.getSubView(o.SV.MAIN);i&&i.updateView(t);break;case CN.BACKPACK_MULTI_TEAM_UPDATE:(n=this.getSubView(o.SV.MAIN))&&(n.updateNowPetAndArt(),n.updateNowHeroList());case CN.DEEP_NEST_UPDATEPETANDART:break;case CN.DEEP_NEST_UPDATEREWARD:(n=this.getSubView(o.SV.MAIN))&&n.updateNowReward();break;case CN.DEEP_NEST_UPDATECOUNT:(n=this.getSubView(o.SV.MAIN))&&n.updateChalCount();break;case CN.DEEP_NEST_SETPOSBYWAIGUA:var n;(n=this.getSubView(o.SV.MAIN))&&n.setLevelPosByWaigua(t)}},o.N="DeepNestMediator",o.SV={MAIN:1,CHALLENGE:2},o}(BaseMediator);n.DeepNestMediator=e,__reflect(e.prototype,"game.DeepNestMediator")}(game||(game={})),function(e){var t=function(){function e(){}return e.registerAll=function(){},e}();e.DeepNestProcessor=t,__reflect(t.prototype,"game.DeepNestProcessor")}(game||(game={})),function(c){var n=function(i){function e(e){var t=i.call(this)||this;return e&&t.updateInfo(e),t}return __extends(e,i),e.prototype.updateInfo=function(e){this.chapterInfos=e},e}(c.BaseVO);__reflect(n.prototype,"DeepNestInfoVO");var o=function(i){function e(e){var t=i.call(this)||this;return t.chalCount=0,e&&t.updateInfo(e),t}return __extends(e,i),e.prototype.updateInfo=function(e){this.chalCount=e},e}(c.BaseVO);__reflect(o.prototype,"DeepNestCountVO");var a=function(i){function e(e){var t=i.call(this)||this;return t.heroList=[],e&&t.updateInfo(e),t}return __extends(e,i),e.prototype.updateInfo=function(e){e&&(this.heroList=e)},e}(c.BaseVO);__reflect(a.prototype,"HeroListInfoVO");var r=function(i){function e(e){var t=i.call(this)||this;return t.petList=[],e&&t.updateInfo(e),t}return __extends(e,i),e.prototype.updateInfo=function(e){e&&(this.petList=e)},e}(c.BaseVO);__reflect(r.prototype,"PetListInfoVO");var s=function(i){function e(e){var t=i.call(this)||this;return t.artList=[],e&&t.updateInfo(e),t}return __extends(e,i),e.prototype.updateInfo=function(e){e&&(this.artList=e)},e}(c.BaseVO);__reflect(s.prototype,"ArtListInfoVO");var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.isFirst=!0,e.initNotice(),e.isFirst=!0,e}return __extends(i,t),i.prototype.initNotice=function(){NoticeManager.registerCB(NT.DEEP_NEST,this.checkCountNotice,this),NoticeManager.registerCB(NT.DEEP_NEST_REWARD,this.checkRewardNotice,this)},i.prototype.checkCountNotice=function(){if(Utils.UnlockMgr.checkPass(MODULE.AbyssLair,!1).allow){if(this.deepNestCountVO){if(0<this.deepNestCountVO.chalCount)return!0;var e=this.checkRewardNotice();for(var t in e)if(e[t])return!0;return!1}return!0}return!1},i.prototype.checkRewardNotice=function(){for(var e=[],t=0;t<this.deepNestInfoVO.chapterInfos.length;t++){e.push(!1);for(var i=this.deepNestInfoVO.chapterInfos[t].fetched,n=this.deepNestInfoVO.chapterInfos[t].stars,o=[!1,!1,!1],a=c.Config.deepNestRewardConfig(t+1),r=0;r<a.length;r++)if(5*(r+1)<=n)for(var s in o[r]=!1,i)i[s]==a[r].code&&(o[r]=!0);else o[r]=!0;for(var s in o)o[s]||(e[t]=!0)}return e},i.prototype.updateHeroList=function(e){this.heroListInfoVO?this.heroListInfoVO.updateInfo(e):this.heroListInfoVO=new a(e)},i.prototype.updatePetList=function(e){this.petListInfoVO?this.petListInfoVO.updateInfo(e):this.petListInfoVO=new r(e)},i.prototype.updateArtList=function(e){this.artListInfoVO?this.artListInfoVO.updateInfo(e):this.artListInfoVO=new s(e)},i.prototype.updateChapterInfo=function(e){this.deepNestInfoVO?this.deepNestInfoVO.updateInfo(e):this.deepNestInfoVO=new n(e)},i.prototype.updateCountInfo=function(e){this.deepNestCountVO?this.deepNestCountVO.updateInfo(e):this.deepNestCountVO=new o(e),NoticeManager.updateNotice(NT.DEEP_NEST)},i.prototype.GetAbyssLairInfo=function(t){var i=this;Utils.Socket.send("abyssLair","GetAbyssLairInfo",{}).then(function(e){i.updateChapterInfo(e.chapterInfos),i.updateCountInfo(e.chalCount),i.updateHeroList(e.heroTeams),i.updatePetList(e.pets),i.updateArtList(e.magicals),i.buyCount=e.buyCount,i.isFirst&&t&&(t&&t(e),i.isFirst=!1)})},i.prototype.HeroChangeFormation=function(e,t){var i=this;Utils.Socket.send("abyssLair","HeroChangeFormation",{heroTeams:e}).then(function(e){i.updateHeroList(e.heroTeams),c.AppFacade.getInstance().sendNotification(CN.DEEP_NEST_UPDATEHERO),t&&t()})},i.prototype.ChangePets=function(e,t){var i=this;Utils.Socket.send("abyssLair","ChangePets",{pets:e}).then(function(e){i.updatePetList(e.pets),c.AppFacade.getInstance().sendNotification(CN.DEEP_NEST_UPDATEPETANDART),t&&t()})},i.prototype.ChangeMagicals=function(e,t){var i=this;Utils.Socket.send("abyssLair","ChangeMagicals",{magicals:e}).then(function(e){i.updateArtList(e.magicals),c.AppFacade.getInstance().sendNotification(CN.DEEP_NEST_UPDATEPETANDART),t&&t()})},i.prototype.Challenge=function(o,a,e){var r=this;this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeAbyssLair,pb1:"abyssLair",pb2:"Challenge",params:{code:o},ignoreStringWay:!0,doneCB:function(e){console.log("战斗结束",e);var t=!1,i=void 0,n=void 0;((t=e.cbRet.chapterInfos.length!=r.deepNestInfoVO.chapterInfos.length&&!!e.cbRet.chapterInfos[e.cbRet.chapterInfos.length-1].isOpen)?(GameRootLayer.gameLayer().switchCloudLoading(!0),i=1+Math.floor(o/5),0!=(n=o-5*Math.floor(o/5))&&(n-=1)):(i=1+Math.floor((o-1)/5),n=1+(o-1)%5),r.updateChapterInfo(e.cbRet.chapterInfos),r.updateCountInfo(e.cbRet.chalCount),r.isFirst)||(a?t?r.deepNestInfoVO.chapterInfos[r.deepNestInfoVO.chapterInfos.length-1].isOpen?c.AppFacade.getInstance().showSubView(c.DeepNestMediator.N,c.DeepNestMediator.SV.MAIN,{chalCount:r.deepNestCountVO.chalCount,chapterInfos:r.deepNestInfoVO.chapterInfos,isOpen:t}):c.AppFacade.getInstance().showSubView(c.DeepNestMediator.N,c.DeepNestMediator.SV.MAIN,{chalCount:r.deepNestCountVO.chalCount,chapterInfos:r.deepNestInfoVO.chapterInfos,isOpen:t,nowIndex:i,nowLevel:n}):c.AppFacade.getInstance().showSubView(c.DeepNestMediator.N,c.DeepNestMediator.SV.MAIN,{chalCount:r.deepNestCountVO.chalCount,chapterInfos:r.deepNestInfoVO.chapterInfos,isOpen:t}):c.AppFacade.getInstance().showSubView(c.DeepNestMediator.N,c.DeepNestMediator.SV.MAIN,{chalCount:r.deepNestCountVO.chalCount,chapterInfos:r.deepNestInfoVO.chapterInfos,isOpen:t,nowIndex:i,nowLevel:n}));c.AppFacade.getInstance().retrieveProxy(c.FightPy.N).queueExceExitCB()}})},i.prototype.BuyAbyssLairChal=function(t,i){var n=this;Utils.Socket.send("abyssLair","BuyAbyssLairChal",{num:t}).then(function(e){Utils.MsgUtils.addMidMsg("成功购买"+t+"次"),n.updateCountInfo(e.chalCount),n.buyCount=e.buyCount,c.AppFacade.getInstance().sendNotification(CN.DEEP_NEST_UPDATECOUNT),i&&i()})},i.prototype.GetBoxReward=function(e,t){var i=this;Utils.Socket.send("abyssLair","GetBoxReward",{boxCode:e}).then(function(e){(i.updateChapterInfo(e.chapterInfos),NoticeManager.updateNotice(NT.DEEP_NEST),c.AppFacade.getInstance().sendNotification(CN.DEEP_NEST_UPDATEREWARD),e.clientReward)&&c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).handleClientReward(e.clientReward,2);t&&t()})},i.N="DeepNestPy",i}(BaseProxy);c.DeepNestPy=e,__reflect(e.prototype,"game.DeepNestPy")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=i.AppFacade.getInstance().retrieveProxy(i.DeepNestPy.N),e.backProxy=i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N),e.skinName="DeepNestChallengePanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.challge_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.isCanFight()?e.proxy.Challenge(e.params.code,e.isNew):(Utils.MsgUtils.addMidMsg("请先上阵英雄"),i.AppFacade.getInstance().showSubView(i.CommonMediator.N,i.CommonMediator.SV.TEAM_CHOOSE,{module:MODULE.AbyssLair,touchHoldCB:void 0,doneCB:void 0})),e.mediator.hideSubView(e)},this),this.commonDaTanKuang.onCloseCB=function(){e.hide()}},e.prototype.isCanFight=function(){var e=this.backProxy.getModuleTeam(MODULE.AbyssLair),t=0;if(e&&e.teams&&0!=e.teams.length){for(var i in e.teams)0==e.teams[i].heros.length&&t++;return 3!=t}return!1},e.prototype.updateView=function(e){var i=this;if(e&&e.info&&e.nowChoose){this.params=e.info,this.commonDaTanKuang.blb_title.text=this.params.name,this.cfc_fightcap.update(this.params.fightCap);var t=JSON.parse(this.params.rewards);for(var n in t){var o=customui.BaseItemFactory.create();o.scaleX=o.scaleY=.7,o.updateData({id:t[n][1],num:t[n][2]}),this.gp_reward_show.addChild(o)}var a=e.nowChoose.stages;for(var n in this.isNew=!0,a)if(e.info.code==a[n].code){this.isNew=!1;break}this.img_get.visible=!this.isNew;var r=[],s=[],c=[];try{for(var l=1;l<=6;l++){var h=this.params["creep1"+l];h&&""!=h&&r.push(JSON.parse(this.params["creep1"+l])[0]);var p=this.params["creep2"+l];p&&""!=p&&s.push(JSON.parse(this.params["creep2"+l])[0]);var d=this.params["creep3"+l];d&&""!=d&&c.push(JSON.parse(this.params["creep3"+l])[0])}}catch(e){this.log(e)}r.forEach(function(e){if(null!=e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e}),t.scaleX=t.scaleY=.6,t.touchEnabled=!1,i.gp_list_0.addChild(t)}}),s.forEach(function(e){if(null!=e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e}),t.scaleX=t.scaleY=.6,t.touchEnabled=!1,i.gp_list_1.addChild(t)}}),c.forEach(function(e){if(null!=e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e}),t.scaleX=t.scaleY=.6,t.touchEnabled=!1,i.gp_list_2.addChild(t)}})}},e}(BasePanel);i.DeepNestChallengePanel=e,__reflect(e.prototype,"game.DeepNestChallengePanel")}(game||(game={})),function(d){var e=function(i){function e(){var e=i.call(this)||this;return e.backProxy=d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N),e.dpProxy=d.AppFacade.getInstance().retrieveProxy(d.DeepNestPy.N),e.playerProxy=d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N),e.heroProxy=d.AppFacade.getInstance().retrieveProxy(d.HeroPy.N),e.dataprovider=new eui.ArrayCollection,e.curSelectIndex=0,e.maxIndex=5,e.nowLevel=0,e.nowStarNum=0,e.heroList1=[],e.heroList2=[],e.heroList3=[],e.petList1=[],e.petList2=[],e.petList3=[],e.LEVEL_TITLE=["sycx_txt_diyizhang_png","sycx_txt_dierzhang_png","sycx_txt_disanzhang_png","sycx_txt_disizhang_png","sycx_txt_diwuzhang_png","sycx_txt_diliuzhang_png","sycx_txt_diqizhang_png","sycx_txt_dibazhang_png","sycx_txt_dijiuzhang_png","sycx_txt_dishizhang_png"],e.skinName="DeepNestMainViewSkin",e.chestInterval=[],e.pos2HeroBI={},e}return __extends(e,i),e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this)},e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_title),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_start),this.heroModel=new customui.RoleDynamicModel({reqStyle:ROLE_STYLE.Fashion}),this.heroModel.x=50,this.heroModel.y=60,this.gp_player.addChild(this.heroModel),this.initBtnListener(),this.heroList1=[],this.heroList2=[],this.heroList3=[],this.petList1=[],this.petList2=[],this.petList3=[];for(var e=0;e<6;e++){(t=new n).updateItem({uuid:void 0,type:EEntityType.EEntityTypeHero}),t.scaleX=.6,t.scaleY=.6,this.gp_heroList_0.addChild(t),this.heroList1.push(t)}for(e=0;e<6;e++){(t=new n).updateItem({uuid:void 0,type:EEntityType.EEntityTypeHero}),t.scaleX=.6,t.scaleY=.6,this.gp_heroList_1.addChild(t),this.heroList2.push(t)}for(e=0;e<6;e++){(t=new n).updateItem({uuid:void 0,type:EEntityType.EEntityTypeHero}),t.scaleX=.6,t.scaleY=.6,this.gp_heroList_2.addChild(t),this.heroList3.push(t)}for(e=0;e<2;e++){(t=new n).updateItem({uuid:void 0,type:0==e?EEntityType.EEntityTypePet:EEntityType.EEntityTypeMagical}),t.scaleX=.3,t.scaleY=.3,this.gp_petList_0.addChild(t),this.petList1.push(t)}for(e=0;e<2;e++){(t=new n).updateItem({uuid:void 0,type:0==e?EEntityType.EEntityTypePet:EEntityType.EEntityTypeMagical}),t.scaleX=.3,t.scaleY=.3,this.gp_petList_1.addChild(t),this.petList2.push(t)}for(e=0;e<2;e++){var t;(t=new n).updateItem({uuid:void 0,type:0==e?EEntityType.EEntityTypePet:EEntityType.EEntityTypeMagical}),t.scaleX=.3,t.scaleY=.3,this.gp_petList_2.addChild(t),this.petList3.push(t)}},e.prototype.chooseNewList=function(e){return e},e.prototype.initBtnListener=function(){var o=this;this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.dpProxy.isFirst=!0,d.MainJumpConfig.jumpTo()},this),this.gp_heroList.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.AppFacade.getInstance().showSubView(d.CommonMediator.N,d.CommonMediator.SV.TEAM_CHOOSE,{module:MODULE.AbyssLair,touchHoldCB:this.chooseNewList.bind(this),doneCB:void 0})},this),this.btn_choose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.AppFacade.getInstance().showSubView(d.CommonMediator.N,d.CommonMediator.SV.TEAM_CHOOSE,{module:MODULE.AbyssLair,touchHoldCB:this.chooseNewList.bind(this),doneCB:void 0})},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.buyCount()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new d.HelpDialog({moduleId:MODULE.AbyssLair})})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.AppFacade.getInstance().showSubView(d.RankMediator.N,d.RankMediator.SV.COMMON,{module:"DeepNest"})},this),this.btn_right.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=o.curSelectIndex+1,i=o.dpProxy.deepNestInfoVO.chapterInfos[t];if(i.isOpen)o.curSelectIndex++,o.updateNovicePos(o.curSelectIndex);else{var n="总星数达到"+d.Config.deepNestWayConfig(i.chapter).unlock+"后解锁该章节";Utils.MsgUtils.addMidMsg(n)}},this),this.btn_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){o.curSelectIndex--,o.updateNovicePos(o.curSelectIndex)},this),this.gp_choose1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){o.showChallengePanel(0)},this),this.gp_choose2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){o.showChallengePanel(1)},this),this.gp_choose3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){o.showChallengePanel(2)},this),this.gp_choose4.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){o.showChallengePanel(3)},this),this.gp_choose5.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){o.showChallengePanel(4)},this),this.gp_0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=d.Config.deepNestRewardConfig(o.curSelectIndex+1),i=o.judgeIsGet(o.curSelectIndex);5<=o.nowStarNum&&!i[0]?DragonBoneTools.playOnce({effectName:"common_baoxiangkai",parent:o.gp_effect_0,x:o.gp_effect_0.width/2-5,y:50,scaleX:.85,scaleY:.85,doneCB:function(){o.dpProxy.GetBoxReward(t[0].code)}}):d.AppFacade.getInstance().showSubView(d.CommonMediator.N,d.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(t[0].rewards),type:d.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this),this.gp_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=d.Config.deepNestRewardConfig(o.curSelectIndex+1),i=o.judgeIsGet(o.curSelectIndex);10<=o.nowStarNum&&!i[1]?DragonBoneTools.playOnce({effectName:"common_baoxiangkai",parent:o.gp_effect_1,x:o.gp_effect_1.width/2-5,y:50,scaleX:.85,scaleY:.85,doneCB:function(){o.dpProxy.GetBoxReward(t[1].code)}}):d.AppFacade.getInstance().showSubView(d.CommonMediator.N,d.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(t[1].rewards),type:d.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this),this.gp_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=d.Config.deepNestRewardConfig(o.curSelectIndex+1),i=o.judgeIsGet(o.curSelectIndex);15<=o.nowStarNum&&!i[2]?DragonBoneTools.playOnce({effectName:"common_baoxiangkai",parent:o.gp_effect_2,x:o.gp_effect_2.width/2-5,y:50,scaleX:.85,scaleY:.85,doneCB:function(){o.dpProxy.GetBoxReward(t[2].code)}}):d.AppFacade.getInstance().showSubView(d.CommonMediator.N,d.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(t[2].rewards),type:d.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this)},e.prototype.buyCount=function(){var t=this,e=JSON.parse(d.Config.publicBuyCostConfig(MODULE.AbyssLair).costs);d.GameMVC.backpackPy.checkEnough(e,!1)?d.AppFacade.getInstance().showSubView(d.CommonMediator.N,d.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.AbyssLair,hasBuyNum:this.dpProxy.buyCount,buyCB:function(e){t.dpProxy.BuyAbyssLairChal(e)},curNum:this.dpProxy.deepNestCountVO.chalCount,maxNum:20}):Utils.MsgUtils.addMidMsg("您的货币不足")},e.prototype.updateAllStartNum=function(){var e=0;for(var t in this.dpProxy.deepNestInfoVO.chapterInfos){e+=this.dpProxy.deepNestInfoVO.chapterInfos[t].stars}this.lbl_allStart.text=e+""},e.prototype.updateView=function(e,t){var i=this;e&&e.nowIndex?(this.curSelectIndex=e.nowIndex-1,this.updateChapter(!1)):this.updateChapter(!0),this.updateNowHeroList(),this.updateNowPetAndArt(),this.updateChalCount(),this.updateAllStartNum();var n=this.scroller_chapter.viewport.$children.length<=6;this.scroller_chapter.scrollPolicyH=n?eui.ScrollPolicy.OFF:eui.ScrollPolicy.AUTO,egret.setTimeout(function(){e&&e.nowLevel&&i.updatePlayerPos(e.nowLevel-1),i.updateListDataInfo(i.curSelectIndex),i.scroller_chapter.viewport.scrollH=150*i.curSelectIndex-60},this,200),egret.setTimeout(function(){e&&e.isOpen&&GameRootLayer.gameLayer().switchCloudLoading(!1)},this,500)},e.prototype.updateChalCount=function(){this.blb_count.text=this.dpProxy.deepNestCountVO.chalCount+""},e.prototype.updateChapter=function(e){if(this.maxIndex=this.dpProxy.deepNestInfoVO.chapterInfos.length,e){this.curSelectIndex=this.dpProxy.deepNestInfoVO.chapterInfos[this.dpProxy.deepNestInfoVO.chapterInfos.length-1].chapter-1;for(var t=0;t<this.dpProxy.deepNestInfoVO.chapterInfos.length;t++)if(!this.dpProxy.deepNestInfoVO.chapterInfos[t].isOpen){this.curSelectIndex=0<t-1?t-1:0;break}}var i=[];for(t=0;t<this.maxIndex;t++){var n={level:t+1,touchCB:this.updateNovicePos.bind(this),info:this.dpProxy.deepNestInfoVO.chapterInfos[t],title:"第"+this.toChinesNum(t+1)+"章",icon:d.Config.deepNestWayConfig(t+1).icon+"_png",scale:.7};i.push(n)}var o={level:0};i.unshift(o),i.unshift(o),i.push(o),i.push(o),this.dataprovider=new eui.ArrayCollection(i),this.list_chapter.itemRenderer=a,this.list_chapter.dataProvider=this.dataprovider,this.updateNovicePos(this.curSelectIndex)},e.prototype.updateNovicePos=function(e){e>this.maxIndex?e=this.maxIndex:e<0&&(e=0),this.curSelectIndex=e,this.btn_left.visible=0!=this.curSelectIndex,this.btn_right.visible=this.curSelectIndex!=this.maxIndex-1,this.lbl_text.text="第"+this.toChinesNum(this.curSelectIndex+1)+"章",this.updateListDataInfo(this.curSelectIndex),this.updateLineInfo(this.curSelectIndex),this.updateNowReward(),this.scroller_chapter.viewport.scrollH=150*this.curSelectIndex-60,this.nowChapterInfo=d.Config.deepNestConfig(this.curSelectIndex+1),this.nowBoxInfo=d.Config.deepNestRewardConfig(this.curSelectIndex+1)},e.prototype.updateListDataInfo=function(e){var t=e+2;for(var i in this.dataprovider.source){this.dataprovider.source[i].choose=Number(i)==t;var n=this.list_chapter.getVirtualElementAt(Number(i)),o=this.dataprovider.getItemAt(Number(i));n&&n.gp_root&&(n.gp_root.scaleX=Number(i)==t?.85:.7,n.gp_root.scaleY=Number(i)==t?.85:.7,o.scale=Number(i)==t?.85:.7)}},e.prototype.showChallengePanel=function(e){0<this.dpProxy.deepNestCountVO.chalCount?this.nowLevel>=e?(this.mediator.showSubView(d.DeepNestMediator.SV.CHALLENGE,{info:this.nowChapterInfo[e],nowChoose:this.dpProxy.deepNestInfoVO.chapterInfos[this.curSelectIndex]}),this.updatePlayerPos(e)):Utils.MsgUtils.addMidMsg("请先解锁前置关卡"):(Utils.MsgUtils.addMidMsg("挑战次数不足"),this.buyCount())},e.prototype.updateLineInfo=function(e){var t=d.Config.deepNestWayConfig(e+1),i=JSON.parse(t.points);this.img_map.source=t.img+"_png";var n=[this.gp_start_0,this.gp_start_1,this.gp_start_2,this.gp_start_3,this.gp_start_4],o=[this.gp_level_0,this.gp_level_1,this.gp_level_2,this.gp_level_3,this.gp_level_4],a=[this.gp_choose1,this.gp_choose2,this.gp_choose3,this.gp_choose4,this.gp_choose5],r=this.dpProxy.deepNestInfoVO.chapterInfos[e];this.nowStarNum=r.stars,this.lbl_startNum.text=this.nowStarNum+"/15",this.nowLevel=r.stages.length;for(var s=0;s<o.length;s++)o[s].x=i[s][0],o[s].y=i[s][1],o[s].visible=!1,a[s].x=i[s][0],a[s].y=i[s][1],a[s].visible=!1;for(var c in this.gp_start_0.$children)UIActionManager.setAbsGrey(this.gp_start_0.$children[c],!0),UIActionManager.setAbsGrey(this.gp_start_1.$children[c],!0),UIActionManager.setAbsGrey(this.gp_start_2.$children[c],!0),UIActionManager.setAbsGrey(this.gp_start_3.$children[c],!0),UIActionManager.setAbsGrey(this.gp_start_4.$children[c],!0);for(s=0;s<=r.stages.length;s++)s<5&&(o[s].visible=!0,a[s].visible=!0);for(var c in r.stages){var l=(r.stages[c].code-1)%5,h=r.stages[c].star;for(s=0;s<h;s++)UIActionManager.setAbsGrey(n[l].$children[s],!1)}var p=this.nowLevel;4<p&&(p=4),this.updatePlayerPos(p)},e.prototype.updatePlayerPos=function(e){var t=d.Config.deepNestWayConfig(this.curSelectIndex+1),i=JSON.parse(t.points);this.gp_player.x=i[e][0],this.gp_player.y=i[e][1]},e.prototype.updateNowHeroList=function(){for(var e=0;e<this.heroList1.length;e++)this.heroList1[e].updateItem({uuid:void 0,type:EEntityType.EEntityTypeHero}),this.heroList2[e].updateItem({uuid:void 0,type:EEntityType.EEntityTypeHero}),this.heroList3[e].updateItem({uuid:void 0,type:EEntityType.EEntityTypeHero});var t=this.backProxy.getModuleTeam(MODULE.AbyssLair);if(t&&t.teams){var i=t.teams;for(var n in i)for(var e in i[n].heros){var o=i[n].heros[e].battlePos-1,a=i[n].heros[e].uuid;1==i[n].teamNo?this.heroList1[o].updateItem({uuid:a,type:EEntityType.EEntityTypeHero}):2==i[n].teamNo?this.heroList2[o].updateItem({uuid:a,type:EEntityType.EEntityTypeHero}):3==i[n].teamNo&&this.heroList3[o].updateItem({uuid:a,type:EEntityType.EEntityTypeHero})}}},e.prototype.updateNowPetAndArt=function(){for(var e=0;e<this.petList1.length;e++)this.petList1[e].updateItem({uuid:void 0,type:0==e?EEntityType.EEntityTypePet:EEntityType.EEntityTypeMagical}),this.petList2[e].updateItem({uuid:void 0,type:0==e?EEntityType.EEntityTypePet:EEntityType.EEntityTypeMagical}),this.petList3[e].updateItem({uuid:void 0,type:0==e?EEntityType.EEntityTypePet:EEntityType.EEntityTypeMagical});var t=this.backProxy.getModuleTeam(MODULE.AbyssLair);if(t&&t.teams){var i=t.teams;for(var n in i){var o=i[n].petUuid,a=i[n].magicalUuid,r=i[n].teamNo;1==r?(o&&this.petList1[0].updateItem({uuid:o,type:EEntityType.EEntityTypePet}),a&&this.petList1[1].updateItem({uuid:a,type:EEntityType.EEntityTypeMagical})):2==r?(o&&this.petList2[0].updateItem({uuid:o,type:EEntityType.EEntityTypePet}),a&&this.petList2[1].updateItem({uuid:a,type:EEntityType.EEntityTypeMagical})):3==r&&(o&&this.petList3[0].updateItem({uuid:o,type:EEntityType.EEntityTypePet}),a&&this.petList3[1].updateItem({uuid:a,type:EEntityType.EEntityTypeMagical}))}}},e.prototype.updateNowReward=function(){var e=this;this.gp_effect_0.removeChildren(),this.gp_effect_1.removeChildren(),this.gp_effect_2.removeChildren(),this.img_di.width=Math.floor(320*this.nowStarNum/15);var t=this.judgeIsGet(this.curSelectIndex);this.img_reward_0.visible=!0,this.img_reward_0.source=5<=this.nowStarNum&&t[0]?"jiangli_icon_baoxiang03_02_png":"jiangli_icon_baoxiang03_01_png",this.img_get_0.visible=5<=this.nowStarNum&&!!t[0],this.img_reward_1.visible=!0,this.img_reward_1.source=10<=this.nowStarNum&&t[1]?"jiangli_icon_baoxiang04_02_png":"jiangli_icon_baoxiang04_01_png",this.img_get_1.visible=10<=this.nowStarNum&&!!t[1],this.img_reward_2.visible=!0,this.img_reward_2.source=10<=this.nowStarNum&&t[2]?"jiangli_icon_baoxiang05_02_png":"jiangli_icon_baoxiang05_01_png",this.img_get_2.visible=10<=this.nowStarNum&&!!t[2],!this.img_get_0.visible&&5<=this.nowStarNum&&!t[0]&&DragonBoneTools.create("common_baoxiang_3",function(e){this.gp_effect_0.removeChildren(),e.x=this.gp_effect_0.width/2-5,e.y=50,e.scaleX=e.scaleY=.85,e.animation.play(),this.gp_effect_0.visible=!0,this.gp_effect_0.addChild(e),this.img_reward_0.visible=!1},this),!this.img_get_1.visible&&10<=this.nowStarNum&&!t[1]&&DragonBoneTools.create("common_baoxiang_4",function(e){this.gp_effect_1.removeChildren(),e.x=this.gp_effect_1.width/2-5,e.y=50,e.scaleX=e.scaleY=.85,e.animation.play(),this.gp_effect_1.visible=!0,this.gp_effect_1.addChild(e),this.img_reward_1.visible=!1},this),!this.img_get_2.visible&&15<=this.nowStarNum&&!t[2]&&DragonBoneTools.create("common_baoxiang_5",function(e){this.gp_effect_2.removeChildren(),e.x=this.gp_effect_2.width/2-5,e.y=50,e.scaleX=e.scaleY=.85,e.animation.play(),this.gp_effect_2.visible=!0,this.gp_effect_2.addChild(e),this.img_reward_2.visible=!1},this),egret.setTimeout(function(){e.updateChaterRed()},this,100)},e.prototype.updateChaterRed=function(){var e=this.dpProxy.checkRewardNotice();for(var t in this.dataprovider.source){var i=this.list_chapter.getVirtualElementAt(Number(t)),n=this.dataprovider.getItemAt(Number(t));i&&i.img_red&&0!=n.level&&(i.img_red.visible=e[n.level-1])}},e.prototype.judgeIsGet=function(e){for(var t=d.Config.deepNestRewardConfig(e+1),i=[!1,!1,!1],n=this.dpProxy.deepNestInfoVO.chapterInfos[e].fetched,o=0;o<t.length;o++)for(var a in n)n[a]==t[o].code&&(i[o]=!0);return i},e.prototype.toChinesNum=function(e){for(var t=["零","一","二","三","四","五","六","七","八","九"],i=["","十","百","千"],n="",o="",a=0,r=!0,s=e;0<e;){var c=e%10;0==c?r||(r=!0,o=t[c]+o):(r=!1,n=t[c],o=(n+=i[a])+o),a++,e=Math.floor(e/10)}return 9<s&&s<20&&(o=o.replace("一","")),o},e.prototype.perClose=function(){},e.prototype.setLevelPosByWaigua=function(e){this.gp_touchPos2.visible=!0,this.gp_root.visible=!1;this.img_map1.source=["sycx_img_ditu1_png","sycx_img_ditu2_png","sycx_img_ditu3_png"][e.mapId],this.gp_touchPos.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.gp_touchPos.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setPosByWaiGua,this)},e.prototype.setPosByWaiGua=function(e){var t=Number(this.text_num.text),i=[this.gp_pos_0,this.gp_pos_1,this.gp_pos_2,this.gp_pos_3,this.gp_pos_4];0<t&&t<6&&(i[t-1].x=e.stageX,i[t-1].y=e.stageY);for(var n=0;n<5;n++){0==n&&console.log("当前地图：",this.img_map1.source);var o=n+1;console.log("第"+o+"个坐标：",i[n].x,i[n].y)}},e}(BaseFull);d.DeepNestMainView=e,__reflect(e.prototype,"game.DeepNestMainView");var a=function(t){function e(){var e=t.call(this)||this;return e.skinName="DeepNestChapterSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(this.data.info.isOpen)this.data&&this.data.touchCB&&this.data.level&&this.data.touchCB(this.data.level-1);else{var e="总星数达到"+d.Config.deepNestWayConfig(this.data.info.chapter).unlock+"后解锁该章节";Utils.MsgUtils.addMidMsg(e)}},this)},e.prototype.dataChanged=function(){var e=this.data;if(0==e.level)this.gp_root.visible=!1;else{if(this.gp_root.visible=!0,this.gp_root.scaleX=e.scale,this.gp_root.scaleY=e.scale,this.img_pic.source=e.icon,this.img_perfect.visible=e.choose,e.info.isOpen)this.lb_jindu.text=Math.floor(100*e.info.stars/15)+"%";else{var t=d.Config.deepNestWayConfig(this.data.info.chapter).unlock;this.lb_jindu.text=t+"可解锁"}this.img_perfect.visible=15==e.info.stars,this.lbl_text.text=e.title,UIActionManager.setAbsGrey(this.gp_root,!e.info.isOpen)}},e}(eui.ItemRenderer);__reflect(a.prototype,"DeepNestChapterItem");var n=function(t){function e(){var e=t.call(this)||this;return e.heroProxy=d.AppFacade.getInstance().retrieveProxy(d.HeroPy.N),e.skinName="HeroMainView_HeroListItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem)},e.prototype.updateItem=function(e){if(this.data=e,this.data.uuid){this.gp_baseitem.visible=!0,this.gp_empty.visible=!1;var t=void 0;if(this.data.type==EEntityType.EEntityTypeHero){var i=this.heroProxy.allHeroByUuid[this.data.uuid];t=0==i.dermaCode?void 0:d.Config.getHeroDermaConfig()[i.dermaCode].avatar}this.baseItem.updateData({uuid:this.data.uuid,type:this.data.type,effect:!1,isShowZhongZhu:!0,avatar:t})}else this.gp_baseitem.visible=!1,this.gp_empty.visible=!0,this.img_add.visible=!0;this.img_lock.visible=!1,this.lb_unlock.visible=!1},e}(eui.Component);d.DeepNest_HeroItem=n,__reflect(n.prototype,"game.DeepNest_HeroItem")}(game||(game={})),function(n){var e=function(t){function e(){var e=t.call(this)||this;return e.params=void 0,e.doneCB=void 0,e.skinName="DeepNestResultPanelSkin",e}return __extends(e,t),e.prototype.perClose=function(){this.doneCB&&this.doneCB()},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},e.prototype.updateView=function(e){this.params=e.info,this.doneCB=e.doneCB;var t=0<this.params.winC,i=t?"common_shengli_22":"common_zhanbai_22";this.gp_win.visible=t,this.gp_lose.visible=!t,DragonBoneTools.create(i,function(e){e.x=this.gp_effect.width/2,e.y=this.gp_effect.height,e.animation.play(),this.gp_effect.addChild(e)},this),UIActionManager.setAbsGrey(this.img_star0,!(0<this.params.winC)),UIActionManager.setAbsGrey(this.img_star1,!(1<this.params.winC)),UIActionManager.setAbsGrey(this.img_star2,!(2<this.params.winC));var n=this.params.clientReward.rewards;for(var o in n){var a=customui.BaseItemFactory.create();a.scaleX=a.scaleY=.7,a.updateData({code:n[o].code,type:n[o].type,num:n[o].num}),this.gp_reward.addChild(a)}for(var r=[],s=0;s<this.params.battleResultEach.length;s++){var c={info:this.params.battleResultEach[s],index:s+1};r.push(c)}this.list.dataProvider=new eui.ArrayCollection(r),this.list.itemRenderer=l},e}(BasePanel);n.DeepNestResultPanel=e,__reflect(e.prototype,"game.DeepNestResultPanel");var l=function(t){function e(){var e=t.call(this)||this;return e.skinName="DeepNestResultItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.gp_myTeam.removeChildren(),this.gp_otherTeam.removeChildren(),this.gp_myPetList.removeChildren(),this.gp_otherPetList.removeChildren();var e=this.data,t=e.info;for(var i in this.lb_team.text="第 "+e.index+" 队",this.img_my.source=1==t.result?"zdjj_txt_sheng_png":"zdjj_txt_bai_png",this.img_other.source=2==t.result?"zdjj_txt_sheng_png":"zdjj_txt_bai_png",t.teams){var n=t.teams[i].name?this.gp_myTeam:this.gp_otherTeam,o=t.teams[i].name?this.gp_myPetList:this.gp_otherPetList;for(var a in t.teams[i].entities){var r=new p;r.scaleX=r.scaleY=.5;var s=EEntityType.EEntityTypeHero;t.teams[i].entities[a].type==BattleEntityType.Magical?s=EEntityType.EEntityTypeMagical:t.teams[i].entities[a].type==BattleEntityType.Pet&&(s=EEntityType.EEntityTypePet);var c={isMagical:!1,code:t.teams[i].entities[a].code,entityId:t.teams[i].entities[a].entityId,dermaCode:t.teams[i].entities[a].dermaCode,type:s};t.teams[i].entities[a].type==BattleEntityType.Pet?(r.scaleX=r.scaleY=.3,o.addChild(r)):n.addChild(r),r.updateData(c)}if(t.teams[i].magical){var l={code:t.teams[i].magical.code,type:EEntityType.EEntityTypeMagical,entityId:t.teams[i].magical.entityId},h=new p;h.scaleX=h.scaleY=.3,o.addChild(h),h.updateData(l)}}this.img_petdi.visible=0<this.gp_myPetList.$children.length},e}(eui.ItemRenderer);__reflect(l.prototype,"DeepNestResultItem");var p=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroMainView_HeroListItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gp_baseitem.removeChildren(),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem)},e.prototype.updateData=function(e){var t=e.code,i=void 0;e.dermaCode&&0!=e.dermaCode&&(i=n.Config.getHeroDermaConfig()[e.dermaCode].avatar),this.baseItem.updateData({code:t,type:e.type,avatar:i,isShowZhongZhu:!0})},e}(eui.Component);__reflect(p.prototype,"DeepNestResult_Item")}(game||(game={})),function(e){var t=function(t){function i(e){return void 0===e&&(e=null),t.call(this,i.N,e)||this}return __extends(i,t),i.prototype.initSubView=function(){this.addSubView(i.SV.ENTRANCE,e.ExtEntranceView),this.addSubView(i.SV.ENTRANCE2,e.Ext2EntranceView)},i.prototype.listNotificationInterests=function(){return[CN.HIDE_LOADING]},i.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_LOADING:this.hideAllSubView()}},i.N="ExtEntranceMediator",i.SV={ENTRANCE:1,ENTRANCE2:2},i}(BaseMediator);e.ExtEntranceMediator=t,__reflect(t.prototype,"game.ExtEntranceMediator")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.ENTRANCE_CONFIG={GUILD_WAR:{desc:"可获取命运之骰、圣物碎片等资源",rankingType:void 0,moduleId:MODULE.TribeBattle,bg:"wfrk_img_rukou_blzb_png",descDown:"可获取命运之骰、圣物碎片等资源",notice:void 0,shopType:void 0},STORMWAR:{desc:"可获取宠物口粮和圣物洗练石",rankingType:void 0,moduleId:MODULE.StormWar,bg:"wfrk_img_rukou_fbzc_png",descDown:"可获取宠物口粮和圣物洗练石",notice:NT.STORM_WAR},MANOR:{desc:"挖矿",rankingType:void 0,moduleId:MODULE.Manor,bg:"wfrk_img_rukou_kmzdz_png",descDown:"占领高级矿脉，赢取丰富资源",notice:NT.MANOR_ENTRANCE,shopType:ShopType.ShopTypeManor}},e.skinName="PvpEntranceViewSkin",Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_view_close),e._popActionType=5,e._removeActionType=6,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.img_title.source="wfrk_txt_ysjhs_png"},e.prototype.initList=function(){this.item_list=new eui.List;var e=new eui.VerticalLayout;(this.item_list.layout=e).gap=10,e.horizontalAlign=egret.HorizontalAlign.CENTER,this.item_list.itemRenderer=n,this.scroller.viewport=this.item_list},e.prototype.updateView=function(){var e=[];for(var t in this.ENTRANCE_CONFIG)this.ENTRANCE_CONFIG[t].view=this,e.push(this.ENTRANCE_CONFIG[t]);this.item_list.dataProvider=new eui.ArrayCollection(e),this.gp_root.height=179*e.length+10*(e.length-1)},e}(BasePanel);i.Ext2EntranceView=e,__reflect(e.prototype,"game.Ext2EntranceView");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="EntranceView_ListItem",e.once(egret.Event.REMOVED_FROM_STAGE,e.onDestroy,e),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.MainJumpConfig.jumpTo(this.data.moduleId)?i.AppFacade.getInstance().hideSubView(i.ExtEntranceMediator.N,i.ExtEntranceMediator.SV.ENTRANCE2):(this.gp_bg.scaleX=1,this.gp_bg.scaleY=1)},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.currentState="up"},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.shopType&&i.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:e.shopType})},this)},e.prototype.dataChanged=function(){this.img_bg.source=this.data.bg,this.data.notice&&NoticeManager.addNoticeListener(this.data.notice,this.gp_bg,this.data.view,{percentX:554/578,percentY:0});var e=Utils.UnlockMgr.checkPass(this.data.moduleId,!1);if(e.allow)switch(this.lb_unlock.text=this.data.desc||"",this.data.moduleId){case MODULE.StormWar:this.countdownForStorm();break;case MODULE.Manor:this.countdownForManor()}else this.lb_unlock.text=this.data.descDown||"",this.data.moduleId==MODULE.StormWar&&(this.lb_unlock.text=e.ext.tips),UIActionManager.setAbsGrey(this,!0),e.ext&&"server"!=e.ext.lockType&&(this.lb_unlock.text=e.ext.tips.replace("解锁","开启"));this.data.shopType?(this.shopType=this.data.shopType,this.btn_shop.visible=!0):this.btn_shop.visible=!1,this.data.notice&&NoticeManager.addNoticeListener(this.data.notice,this.gp_bg,this.data.view,{percentX:554/578,percentY:0})},e.prototype.getRemainingTime=function(e){return Utils.TimerManager.getFormatBySecond1(e)},e.prototype.countdownForStorm=function(){var e=this,t=Utils.UnlockMgr.getOpenInfo(MODULE.StormWar),i=t.isOpen;if(i)this.endingTimer&&egret.clearInterval(this.endingTimer),this.lb_unlock.text=this.data.descDown||"",this.lb_unlock.visible=!0;else{if(0==t.endTimeDt||Utils.TimerManager.getServerTime(!1)>=t.endTimeDt)return this.lb_unlock.visible=!0,this.lb_unlock.text="今日已结束",UIActionManager.setAbsGrey(this.gp_bg,!i),void(this.gp_bg.touchEnabled=i);this.timerDt=t.openTimeDt-Utils.TimerManager.getServerTime(!1),this.lb_unlock.visible=!1,this.gp_time.visible=!0,this.lb_miaoshu.text=i?"":"开启倒计时：",this.blb_time.text=this.getRemainingTime(this.timerDt),UIActionManager.setAbsGrey(this.gp_bg,!i),this.gp_bg.touchEnabled=i,this.endingTimer||(this.endingTimer=egret.setInterval(function(){0<=e.timerDt?e.blb_time.text=e.getRemainingTime(--e.timerDt):(egret.clearInterval(e.endingTimer),e.dataChanged())},this,1e3))}},e.prototype.countdownForManor=function(){var e=this;this.gp_time.visible=!0,this.lb_unlock.text="",this.lb_miaoshu.text="";var t=Utils.UnlockMgr.getOpenInfo(MODULE.Manor);if(!t.allow)return this.lb_unlock.text="未开启",void UIActionManager.setAbsGrey(this.gp_bg,!0);if(t.isOpen)this.lb_unlock.text=this.data.descDown;else{if(!t.isWillOpenToday)return this.lb_unlock.text="今日不开放",void UIActionManager.setAbsGrey(this.gp_bg,!0);var i=Utils.TimerManager.getServerTime(!1),n=t.openTimeDt,o=t.endTimeDt;if(0==o||o<=i)return this.lb_unlock.text="今日已结束",void UIActionManager.setAbsGrey(this.gp_bg,!0);this.lb_unlock.text="",this.lb_miaoshu.text="开启倒计时：",this.timerDt=n-i,this.blb_time.visible=!0,this.blb_time.text=this.getRemainingTime(this.timerDt--),this.endingTimer1||(this.endingTimer1=egret.setInterval(function(){0<=e.timerDt?e.blb_time.text=e.getRemainingTime(e.timerDt--):(e.countdownForManor(),e.endingTimer1&&egret.clearTimeout(e.endingTimer1))},this,1e3)),UIActionManager.setAbsGrey(this.gp_bg,!0)}},e.prototype.onDestroy=function(){egret.clearInterval(this.endingTimer),egret.clearInterval(this.endingTimer1),egret.clearInterval(this.startTimer)},e}(eui.ItemRenderer);__reflect(n.prototype,"EntranceView_ListItem")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.ENTRANCE_CONFIG={WCHESS:{desc:"提高战旗段位，获取丰厚奖励",rankingType:void 0,moduleId:MODULE.Wchess,bg:"wfrk_img_rukou_myzq_png",descDown:"提高战棋段位，获取丰厚奖励",notice:void 0},VESTAGE:{desc:"挑战副本，赢取海量稀有道具",rankingType:void 0,moduleId:MODULE.Vestage,bg:"wfrk_img_rukou_shzyj_png",descDown:"挑战副本，赢取海量稀有道具",notice:void 0}},Utils.SDKMgr.getPerformConfig(38)||delete e.ENTRANCE_CONFIG.VESTAGE,e.skinName="PvpEntranceViewSkin",Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_view_close),e._popActionType=5,e._removeActionType=6,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.img_title.source="wfrk_txt_myzc_png"},e.prototype.initList=function(){this.item_list=new eui.List;var e=new eui.VerticalLayout;(this.item_list.layout=e).gap=10,e.horizontalAlign=egret.HorizontalAlign.CENTER,this.item_list.itemRenderer=n,this.scroller.viewport=this.item_list},e.prototype.updateView=function(){var e=[];for(var t in this.ENTRANCE_CONFIG)this.ENTRANCE_CONFIG[t].view=this,e.push(this.ENTRANCE_CONFIG[t]);this.item_list.dataProvider=new eui.ArrayCollection(e),this.gp_root.height=179*e.length+10*(e.length-1)},e}(BasePanel);i.ExtEntranceView=e,__reflect(e.prototype,"game.ExtEntranceView");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="EntranceView_ListItem",e.once(egret.Event.REMOVED_FROM_STAGE,e.onDestroy,e),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gp_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_bg.scaleX=1,this.gp_bg.scaleY=1,i.MainJumpConfig.jumpTo(this.data.moduleId)&&i.AppFacade.getInstance().hideSubView(i.ExtEntranceMediator.N,i.ExtEntranceMediator.SV.ENTRANCE)},this)},e.prototype.dataChanged=function(){this.img_bg.source=this.data.bg,this.data.notice&&NoticeManager.addNoticeListener(this.data.notice,this.gp_bg,this.data.view,{percentX:554/578,percentY:0});var e=Utils.UnlockMgr.checkPass(this.data.moduleId,!1);e.allow?(this.lb_unlock.text=this.data.desc||"",this.data.moduleId):(this.lb_unlock.text=this.data.descDown||"",this.data.moduleId==MODULE.StormWar&&(this.lb_unlock.text=e.ext.tips),UIActionManager.setAbsGrey(this,!0),e.ext&&"server"!=e.ext.lockType&&(this.lb_unlock.text=e.ext.tips.replace("解锁","开启"))),this.data.notice&&NoticeManager.addNoticeListener(this.data.notice,this.gp_bg,this.data.view,{percentX:554/578,percentY:0})},e.prototype.getRemainingTime=function(e){return Utils.TimerManager.getFormatBySecond1(e)},e.prototype.onDestroy=function(){egret.clearInterval(this.endingTimer),egret.clearInterval(this.endingTimer1),egret.clearInterval(this.startTimer)},e}(eui.ItemRenderer);__reflect(n.prototype,"EntranceView_ListItem")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.proxy=o.AppFacade.getInstance().retrieveProxy(o.FashionPy.N),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.FashionMainView),this.addSubView(n.SV.SKILL_UP,o.FashionUpsectionPanel),this.addSubView(n.SV.ALL_INFO,o.FashionAllInfoPanel),this.addSubView(n.SV.SKILL_INFO_1,o.FashionSkillInfo1),this.addSubView(n.SV.SKILL_INFO_2,o.FashionSkillInfo2),this.addSubView(n.SV.SKILL_INFO_3,o.FashionSkillInfo3)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.TITLE_UPDATE,CN.FASHION_UPDATEMAIN,CN.SKILL_UPDATE,CN.SKILL_CHOOSE_CLEAN]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.Fashion,!1).allow&&this.proxy.GetFashionInfo(),Utils.UnlockMgr.checkPass(MODULE.RoleSkill,!1).allow&&this.proxy.GetRoleSkillInfo();break;case CN.FASHION_UPDATEMAIN:(t=this.getSubView(n.SV.MAIN))&&t.onBarItemTap();break;case CN.TITLE_UPDATE:(t=this.getSubView(n.SV.MAIN))&&t.updateModel();break;case CN.SKILL_UPDATE:(t=this.getSubView(n.SV.MAIN))&&t.updateSkillInfo();break;case CN.SKILL_CHOOSE_CLEAN:var t;(t=this.getSubView(n.SV.MAIN))&&t.cleanSkillChoose()}},n.N="FashionMediator",n.SV={MAIN:1,SKILL_UP:2,ALL_INFO:3,SKILL_INFO_1:4,SKILL_INFO_2:5,SKILL_INFO_3:6},n}(BaseMediator);o.FashionMediator=e,__reflect(e.prototype,"game.FashionMediator")}(game||(game={})),function(e){var t=function(){function e(){}return e.registerAll=function(){},e}();e.FashionProcessor=t,__reflect(t.prototype,"game.FashionProcessor")}(game||(game={})),function(d){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.fashCoreInfo=void 0,e.handbookList=[],e.playerPy=d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N),e.allSkillList=void 0,e.skillTreeList=[],e.allFashionByUuid={},e.onFormationUuid="",e.addFashionNotice(),e.allSkillList=void 0,e.skillTreeList=[],e}return __extends(i,t),i.prototype.addFashionNotice=function(){NoticeManager.registerCB(NT.FASHION_ACTIVATION,this.checkNoticeInfo,this),NoticeManager.registerCB(NT.FASHION_UPGRADE,this.checkNoticeSkillUpgrade,this),NoticeManager.setChildType(NT.FASHION,[NT.FASHION_ACTIVATION,NT.FASHION_UPGRADE,NT.TITLE])},i.prototype.checkNoticeInfoByOne=function(e){var t=void 0,i=0;for(var n in this.allFashionByUuid)if(this.allFashionByUuid[n].code==e.code){var o=d.Config.fashionUpConfigByCode(e.code);if(this.allFashionByUuid[n].level+1>=o.length)return!1;for(var a in o)if(o[a].level==this.allFashionByUuid[n].level+1)return t=JSON.parse(o[a].costs),i=o[a].playerLevel,this.isInfoNotice(t,i)}return t=JSON.parse(e.costs),this.isInfoNotice(t,i)},i.prototype.checkNoticeInfo=function(){var e=!1,t=d.Config.fashionConfigList();for(var i in t){var n=t[i],o=void 0,a=0,r=!1;for(var s in this.allFashionByUuid)if(this.allFashionByUuid[s].code==n.code){r=!0;var c=d.Config.fashionUpConfigByCode(n.code);for(var l in c)if(c[l].level==this.allFashionByUuid[s].level+1){o=JSON.parse(c[l].costs),a=c[l].playerLevel;break}if(e=this.isInfoNotice(o,a))return e}if(r);else if(o=JSON.parse(n.costs),e=this.isInfoNotice(o,a))return e}return e},i.prototype.isInfoNotice=function(e,t){var i=0;if(e&&e.length){for(var n=0;n<e.length;n++){d.GameMVC.backpackPy.getItemNumByCode(e[n][1])>=e[n][2]&&i++}return i>=e.length&&this.playerPy.playerInfoVO.level>=t}return!1},i.prototype.updateFashionDict=function(e,t){var i=this;void 0===t&&(t=!1),Array.isArray(e)||(e=[e]),e.forEach(function(e){if(i.allFashionByUuid[e.uuid])i.allFashionByUuid[e.uuid].update(e);else{var t=new d.FashionVO(e);i.allFashionByUuid[e.uuid]=t}e.pos&&(i.onFormationUuid=e.uuid)})},i.prototype.getInfoByCode=function(e){for(var t in this.allFashionByUuid){var i=this.allFashionByUuid[t];if(i.code==e)return i}},i.prototype.deteleByUuids=function(e){var t=this;e.forEach(function(e){delete t.allFashionByUuid[e]})},i.prototype.GetFashionInfo=function(t){var i=this;Utils.Socket.send("fashion","GetFashionInfo",{}).then(function(e){i.updateFashionDict(e.fashionList),i.fashCoreInfo=e.info.coreInfo,i.handbookList=e.info.handbookList,NoticeManager.updateNotice(NT.FASHION),t&&t()})},i.prototype.ActivateFashion=function(e,i){var n=this;Utils.Socket.send("fashion","ActivateFashion",{code:e}).then(function(e){if(e.clientReward&&e.clientReward.fashions)for(var t in e.clientReward.fashions)n.updateFashionDict(e.clientReward.fashions[t]);n.fashCoreInfo=e.info.coreInfo,n.handbookList=e.info.handbookList,d.AppFacade.getInstance().sendNotification(CN.FASHION_UPDATEMAIN),NoticeManager.updateNotice(NT.FASHION),i&&i()})},i.prototype.UpFashionGrade=function(e,t){var i=this;Utils.Socket.send("fashion","UpFashionGrade",{uuid:e}).then(function(e){i.updateFashionDict(e.fashion),i.fashCoreInfo=e.coreInfo,d.AppFacade.getInstance().sendNotification(CN.FASHION_UPDATEMAIN),NoticeManager.updateNotice(NT.FASHION),t&&t()})},i.prototype.PutFashionOn=function(e,t){var i=this;Utils.Socket.send("fashion","PutFashionOn",{uuid:e}).then(function(e){i.updateFashionDict(e.fashion),i.updateFashionDict(e.oldFashion),d.AppFacade.getInstance().sendNotification(CN.FASHION_UPDATEMAIN),t&&t()})},i.prototype.PutFashionDown=function(e,t){var i=this;Utils.Socket.send("fashion","PutFashionDown",{uuid:e}).then(function(e){i.updateFashionDict(e.fashion),d.AppFacade.getInstance().sendNotification(CN.FASHION_UPDATEMAIN),t&&t()})},i.prototype.checkNoticeSkillUpgrade=function(){var e=!1,t=d.Config.roleSkill();for(var i in t){var n=1,o=d.Config.roleSkillUpByCode(t[i].code);for(var a in this.allSkillList)if(this.allSkillList[a][0]==t[i].code){n=this.allSkillList[a][1];break}if(n<o.length){var r=void 0,s=void 0,c=void 0,l=0;for(var h in o)if(o[h].level==n){r=o[h],s=JSON.parse(r.costs),c=JSON.parse(r.condition);break}if(this.checkSkillIsLock(c))if(s&&s.length){for(var p=0;p<s.length;p++){d.GameMVC.backpackPy.getItemNumByCode(s[p][1])>=s[p][2]&&l++}if(e=l>=s.length)return e}else e=!1}}return e},i.prototype.checkSkillIsLock=function(e){var t=!1,i=!1,n=[],o=this.allSkillList;if(e&&0<e.length&&(i=0!=e[0],n=e[1]),!(0<n.length))return t=!0;for(var a in n)for(var r in o)if(o[r][0]==n[a][0]){if(i){0;break}if(t=o[r][1]>=n[a][1])return t}return t},i.prototype.updateSkillDict=function(e){var t=JSON.parse(e),i=[];for(var n in t){var o=[Number(n),t[n]];i.push(o)}return i},i.prototype.GetRoleSkillInfo=function(t){var i=this;Utils.Socket.send("roleSkill","GetRoleSkillInfo",{}).then(function(e){i.allSkillList=i.updateSkillDict(e.info.skill),i.skillTreeList=e.info.skillTreeList,NoticeManager.updateNotice(NT.FASHION),t&&t()})},i.prototype.LearnRoleSkill=function(e,t){var i=this;Utils.Socket.send("roleSkill","LearnRoleSkill",{code:e}).then(function(e){i.allSkillList=i.updateSkillDict(e.info.skill),i.skillTreeList=e.info.skillTreeList,d.AppFacade.getInstance().sendNotification(CN.SKILL_UPDATE),NoticeManager.updateNotice(NT.FASHION),t&&t()})},i.prototype.ResetRoleSkill=function(t){var i=this;Utils.Socket.send("roleSkill","ResetRoleSkill",{}).then(function(e){(i.allSkillList=i.updateSkillDict(e.info.skill),i.skillTreeList=e.info.skillTreeList,d.AppFacade.getInstance().sendNotification(CN.SKILL_UPDATE),NoticeManager.updateNotice(NT.FASHION),e.clientReward)&&d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N).handleClientReward(e.clientReward,2);t&&t()})},i.N="FashionPy",i}(BaseProxy);d.FashionPy=e,__reflect(e.prototype,"game.FashionPy")}(game||(game={})),function(_){var e=function(t){function e(){var e=t.call(this)||this;return e.py=_.AppFacade.getInstance().retrieveProxy(_.FashionPy.N),e.skinName="HeroDermaAllInfoSkin",e}return __extends(e,t),e.prototype.perClose=function(){},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},e.prototype.updateView=function(e){if(e){var t=e.bookConfig,i=[];for(var n in t){var o={module:e.module,config:t[n],allUuid:e.allUuid,modelConfig:e.modelConfig};i.push(o)}this.list_derma.itemRenderer=a,this.list_derma.dataProvider=new eui.ArrayCollection(i)}},e}(BasePanel);_.FashionAllInfoPanel=e,__reflect(e.prototype,"game.FashionAllInfoPanel");var a=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroDermaOneInfoSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var e=this.data,t=JSON.parse(e.config.dermaIds),i=e.allUuid,n=0;for(var o in i)for(var a in t)i[o].code==t[a]&&n++;var r=n+"/"+t.length;this.lb_name.text=e.config.desc+r,this.img_isHave.visible=n==t.length,this.gp_list.removeChildren();for(a=0;a<t.length;a++){var s=t[a],c=!1,l=i;for(var o in l)l[o].code==s&&(c=!0);var h=e.modelConfig[s],p=new m({info:h,isHave:c,module:e.module});p.scaleX=.8,p.scaleY=.8,p.x=140*a+10,p.y=0,this.gp_list.addChild(p)}var d=JSON.parse(e.config.attr),u=[];for(var o in d){var g={text:"+"+_.GeneralConfig.getAttrValue(d[o][1]),style:{textColor:8060686}},f={text:AttrConfig[d[o][0]].name+"   ",style:{textColor:16777215}};u.push(g,f)}this.lb_attr.textFlow=u},e}(eui.ItemRenderer);__reflect(a.prototype,"HeroDermaOneInfo");var m=function(i){function e(e){var t=i.call(this)||this;return t.skinName="HeroDermaItemSkin",e&&e.info&&(t.params=e.info,t.isHave=e.isHave,t.module=e.module),t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.updateData()},e.prototype.updateData=function(){var n=this,o=this.params;this.img_choose.visible=!1,this.img_isLock.visible=!1,this.lb_name.text=o.name;var e=new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]);this.isHave||(this.img_dermaType.filters=[e]),this.img_dermaType.source=o.dermaPic?o.dermaPic+"_png":"pf_img_hspz03_png",this.img_dermaType.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(n.module==MODULE.HeroDerma){var e=_.Config.allHeroConfig(),t=void 0;for(var i in e)if(e[i].subType==o.subType){t=e[i];break}_.AppFacade.getInstance().hideSubView(_.FashionMediator.N,_.FashionMediator.SV.ALL_INFO),_.AppFacade.getInstance().hideSubView(_.HeroMediator.N,_.HeroMediator.SV.HERO_DERMA),_.AppFacade.getInstance().showSubView(_.HeroMediator.N,_.HeroMediator.SV.HERO_DERMA,{info:t,uuid:void 0,isCanPutOn:!1,isCanPutDown:!1,isCanActivate:!1,isShowAllBtn:!1,putCB:void 0,putData:void 0})}},this)},e}(eui.Component);__reflect(m.prototype,"HeroDermaItemBy")}(game||(game={})),function(N){var e=function(t){function i(){var e=t.call(this)||this;return e.moneyType=[],e.isFirst=!1,e.params=void 0,e.backpackproxy=N.AppFacade.getInstance().retrieveProxy(N.BackpackPy.N),e.py=N.AppFacade.getInstance().retrieveProxy(N.FashionPy.N),e.playerPy=N.AppFacade.getInstance().retrieveProxy(N.PlayerPy.N),e.curSelectIndex=0,e.dataprovider=new eui.ArrayCollection,e.lastH=12,e.code=void 0,e.uuid=void 0,e.isEnough=!1,e.needLevel=0,e.dataConfig=void 0,e.chooseNum=0,e.skillDataprovider=new eui.ArrayCollection,e.skinName="FashionMainViewSkin",e}return __extends(i,t),i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),N.GameMVC.playerPy.GetPlayerInfo()},i.prototype.childrenCreated=function(){var o=this;t.prototype.childrenCreated.call(this),this.initTabbar(),this.img_red1.visible=!1,this.img_red2.visible=!1,this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.hide()},this),this.cu_model.scaleX=this.cu_model.scaleY=1/.55,this.list_skill.itemRenderer=a,this.list_skill.dataProvider=this.skillDataprovider,this.scroller_skill.scrollPolicyV=eui.ScrollPolicy.OFF,this.root_list.img_lastOne.source="",this.root_list.img_nextOne.source="",this.root_list.needAutoScroll=!0,this.root_list.itemRenderer=n,this.root_list.dataProvider=this.dataprovider,this.root_list.sl_root.addEventListener(eui.UIEvent.CHANGE,this.changeItemY,this),this.root_list.addItemTapEvent(function(e){o.curSelectIndex=e.itemIndex,console.log("当前选择index",o.curSelectIndex),o.updatePos(),o.dataprovider.refresh(),o.updateFashion(),o.gp_skill.visible?o.onBarItemTap({itemIndex:i.TAB_VIEW.SKILL_TREE}):o.onBarItemTap();var t=.1*(o.root_list.sl_root.viewport.scrollH-o.lastH);0<t?o.gp_circle.rotation+=t:o.gp_circle.rotation-=-t,o.lastH=o.root_list.sl_root.viewport.scrollH},this),this.btn_book.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){N.AppFacade.getInstance().showSubView(N.FashionMediator.N,N.FashionMediator.SV.ALL_INFO,{module:MODULE.Fashion,allUuid:o.py.allFashionByUuid,bookConfig:N.Config.fashionBookConfig(),modelConfig:N.Config.fashionConfig()})},this),this.btn_all.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new N.CommonAttrDetailsPanel({attr:o.py.fashCoreInfo.attr})})},this),NoticeManager.addNoticeListener(NT.TITLE,this.btn_title.$children[0],this,BTN_ICON_NOTICE_POS),this.btn_title.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){N.GameMVC.titleMed.showSubView(N.TitleMediator.SV.MAIN)},this),this.btn_master.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=0;for(var t in o.py.allFashionByUuid)e+=o.py.allFashionByUuid[t].level;N.AppFacade.getInstance().showSubView(N.HeroMediator.N,N.HeroMediator.SV.COMMON_LEVEL_MASTER,{title:"时尚达人",config:N.Config.fashionMasterConfig(),totalLevel:e})},this),this.btn_puton.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.uuid&&o.py.PutFashionOn(o.uuid,function(){Utils.MsgUtils.addMidMsg("佩戴成功")})},this),this.btn_putDown.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.uuid&&o.py.PutFashionDown(o.uuid,function(){Utils.MsgUtils.addMidMsg("卸下成功")})},this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"升级"==o.btn_up.label?o.uuid&&(o.isEnough?o.py.UpFashionGrade(o.uuid,function(){o.gp_effect.removeChildren(),DragonBoneTools.playOnce({effectName:"common_ty_dj",parent:o.gp_effect,y:o.gp_effect.height/2,x:o.gp_effect.width/2})}):o.playerPy.playerInfoVO.level>=o.needLevel?Utils.MsgUtils.addMidMsg("道具不足,无法升级"):Utils.MsgUtils.addMidMsg("角色等级不足,无法升级")):"激活"==o.btn_up.label&&o.code&&(o.isEnough?o.py.ActivateFashion(o.code,function(){o.gp_effect.removeChildren(),DragonBoneTools.playOnce({effectName:"common_ty_jihuo",parent:o.gp_effect,x:o.gp_effect.width/2,y:o.gp_effect.height/2}),o.dataprovider.getItemAt(o.curSelectIndex).isCan=!1;var e=o.root_list.list_root.getVirtualElementAt(o.curSelectIndex);e&&e.gp_effect&&(e.gp_effect.removeChildren(),e.gp_effect.visible=!1)}):Utils.MsgUtils.addMidMsg("道具不足,无法激活"))},this),this.btn_reset.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=0,t=o.py.skillTreeList;for(var i in t)e+=t[i].num;if(0<e){var n=N.Config.constConfig().RoleSkillResetCosts;N.GameMgr.getInstance().showCommonTipsWin({costTips:"，重置主角天赋吗",source:"skill_reset",cost:n.constValue,cb:!0,clickCB:function(e){1===e.type&&o.py.ResetRoleSkill(function(){Utils.MsgUtils.addMidMsg("重置成功")})}})}else Utils.MsgUtils.addMidMsg("当前未激活任何天赋")},this),DragonBoneTools.create("common_shizhuangtxk",function(e){this.gp_effect1.removeChildren(),e.x=this.gp_effect1.width/2,e.y=this.gp_effect1.height/2,e.scaleX=e.scaleY=1,e.animation.play(),this.gp_effect1.addChild(e)},this),DragonBoneTools.create("common_shizhuangdq",function(e){this.gp_effect2.removeChildren(),e.x=this.gp_effect2.width/2,e.y=-240,e.scaleX=e.scaleY=1,e.animation.play(),this.gp_effect2.addChild(e)},this)},i.prototype.initTabbar=function(){this.heroInfo_tabbar.itemRendererSkinName="HeroMainView_HeroInfoTabItem",this.heroInfo_tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this),this.heroInfo_tabbar.selectedIndex=0,this.heroInfo_tabbar.dataProvider=new eui.ArrayCollection([{up:"_btn_yq_m_json.common_yeqian_shizhuang_0",down:"_btn_yq_m_json.common_yeqian_shizhuang_1",itemIndex:i.TAB_VIEW.FASHION_INFO},{up:"_btn_yq_m_json.common_yeqian_jinengshu_0",down:"_btn_yq_m_json.common_yeqian_jinengshu_1",itemIndex:i.TAB_VIEW.SKILL_TREE}])},i.prototype.onBarItemTap=function(e){var t=this;switch(void 0===e&&(e={itemIndex:i.TAB_VIEW.FASHION_INFO}),this.gp_up.visible=!1,this.gp_skill.visible=!1,e.itemIndex){case i.TAB_VIEW.FASHION_INFO:this.blb_title.text="时装信息",this.updateFashion(),this.gp_up.visible=!0;break;case i.TAB_VIEW.SKILL_TREE:Utils.UnlockMgr.checkPass(MODULE.RoleSkill,!0).allow?(this.blb_title.text="主角天赋",this.py.allSkillList?(this.updateSkillInfo({config:N.Config.roleSkillTree()[0],indexNum:0}),this.gp_skill.visible=!0):this.py.GetRoleSkillInfo(function(){t.updateSkillInfo({config:N.Config.roleSkillTree()[0],indexNum:0}),t.gp_skill.visible=!0})):(this.heroInfo_tabbar.selectedIndex=0,this.onBarItemTap())}},i.prototype.updatePos=function(){for(var e in this.dataprovider.source){var t=this.root_list.list_root.getVirtualElementAt(Number(e));if(this.dataprovider.getItemAt(Number(e)).isShow){var i=this.root_list.itemRenderer.itemWidth,n=(this.root_list.list_root.layout.gap+i)*Number(e),o=this.root_list.sl_root.viewport.scrollH+this.root_list.width/2,a=80-200*(Math.abs(o-(n+120))/720);65<a&&(a=65),t.gp_main.y=a}}},i.prototype.changeItemY=function(){this.root_list.layout.gap;var e=this.root_list.layout.paddingLeft,t=this.root_list.itemRenderer.itemWidth;this.root_list.sl_root.viewport.scrollH,this.root_list.width;for(var i in this.dataprovider.source){var n=this.root_list.list_root.getVirtualElementAt(Number(i));if(this.dataprovider.getItemAt(Number(i)).isShow){var o=this.root_list.sl_root.viewport.scrollH+this.root_list.width/2,a=(this.root_list.list_root.layout.gap+t)*Number(i),r=80-200*(Math.abs(o-(a+120))/720);65<r&&(r=65),n.gp_main.y=r}}var s=.1*(this.root_list.sl_root.viewport.scrollH-this.lastH);0<s?this.gp_circle.rotation+=s:this.gp_circle.rotation-=-s,this.lastH=this.root_list.sl_root.viewport.scrollH},i.prototype.updateView=function(e){e&&(this.isFirst=!0,this.params=e,this.curSelectIndex=this.params.chooseIndex,this.updateList(),this.updateFashion()),NoticeManager.updateNotice(NT.FASHION)},i.prototype.judgeListIndex=function(e){var t=this.py.allFashionByUuid;for(var i in t)if(t[i].code==e.code)return 1==t[i].pos?1:3;for(var n=0,o=JSON.parse(e.costs),a=0;a<o.length;a++){N.GameMVC.backpackPy.getItemNumByCode(o[a][1])>=o[a][2]&&n++}return n>=o.length?2:4},i.prototype.judgeIsCan=function(e){var t=this.py.allFashionByUuid;for(var i in t)if(t[i].code==e.code)return!1;for(var n=0,o=JSON.parse(e.costs),a=0;a<o.length;a++){N.GameMVC.backpackPy.getItemNumByCode(o[a][1])>=o[a][2]&&n++}return n>=o.length},i.prototype.updateList=function(){for(var e=this,t=[],i=N.Config.fashionConfigList(),n=0;n<i.length;n++){var o={indexNum:this.judgeListIndex(i[n]),isShow:!0,config:i[n],isCan:this.judgeIsCan(i[n])};t.push(o)}t.sort(function(e,t){return e.indexNum>=t.indexNum?1:-1});var a={isShow:!1};t.unshift(a),t.unshift(a),t.push(a),t.push(a);var r=t;this.dataprovider.replaceAll(r),this.isFirst&&(this.root_list.visible=!1,egret.setTimeout(function(){e.isFirst=!1,e.root_list.visible=!0,e.root_list.changeTo({itemIndex:e.curSelectIndex}),UIActionManager.playUIAction(e.root_list,5,function(){})},this,500))},i.prototype.updateModel=function(e){var t=this;if(e){if(e==this.code)return;this.code=e,this.cu_model.visible=!1,this.cu_model.update({fashionCode:this.code}),this.cu_model.onArmatureLoadCB=function(){t.cu_model.visible=!0,t.cu_model.onChangingDir(1)}}else this.cu_model.visible=!1,this.cu_model.update({fashionCode:this.code}),this.cu_model.onArmatureLoadCB=function(){t.cu_model.visible=!0,t.cu_model.onChangingDir(1)}},i.prototype.updateModelForce=function(){var e=this;this.cu_model.update({fashionCode:this.code}),this.cu_model.onArmatureLoadCB=function(){e.cu_model.visible=!0,e.cu_model.onChangingDir(1)}},i.prototype.updateFashion=function(){var i=this,e=this.py.allFashionByUuid,t=this.dataprovider.getItemAt(this.curSelectIndex).config;this.lb_name.text=t.name,this.lb_profession.text=t.name;var n=N.Config.fashionUpConfigByCode(t.code);this.lb_desc.text=t.desc,this.updateModel(t.code),this.gp_heroAvatar.removeChildren();var o=customui.PlayerHeadFactory.create();o.scaleX=o.scaleY=.7,o.touchEnabled=!1;var a=t.avatar;o.updateData({vo:{avatar:a}}),this.gp_heroAvatar.addChild(o);var r=!1;this.gp_upgrade_attr.removeChildren();var s=void 0,c=!1;this.gp_costs_icon.removeChildren();var l=void 0,h=0,p=n.length-1;this.item_fightCap.update(0),this.uuid=void 0;var d=!1,u=!1;for(var g in e)if(e[g].code==this.code){c=r=!0,s=JSON.parse(e[g].attr),h=e[g].level,this.uuid=e[g].uuid,0==e[g].pos?d=!0:1==e[g].pos&&(u=!0),this.item_fightCap.update(e[g].fightCap);break}if(this.lb_level.text=h+"/"+p,this.btn_maxLevel.visible=h==p,this.btn_up.visible=!(p<=h),this.btn_puton.visible=d,this.btn_putDown.visible=u,r)for(var g in s){(_=new N.HeroMainView_AttrItem(void 0)).updateItem({type:g,num:s[g]||0}),this.gp_upgrade_attr.addChild(_)}else{s=JSON.parse(t.attr);for(var f=0;f<s.length;f++){var _;(_=new N.HeroMainView_AttrItem(void 0)).updateItem({type:s[f][0],num:s[f][1]||0}),this.gp_upgrade_attr.addChild(_)}}if(c){for(var g in n)if(n[g].level==h+1){l=JSON.parse(n[g].costs),this.needLevel=n[g].playerLevel;break}}else l=JSON.parse(t.costs),this.needLevel=0;var m=0;if(l&&l.length){for(f=0;f<l.length;f++){var y=new customui.CommonIconWithNum({code:l[f][1],num:l[f][2],style:CommonIconStyle.RIGHT,showEnough:!0});y.scaleX=y.scaleY=.8,this.gp_costs_icon.addChild(y);var v=N.GameMVC.backpackPy.getItemNumByCode(l[f][1])>=l[f][2];UIActionManager.setAbsGrey(y,!v),v&&m++}this.isEnough=m>=l.length&&this.playerPy.playerInfoVO.level>=this.needLevel}else this.gp_costs_icon.removeChildren();if(this.btn_up.label=r?"升级":"激活",UIActionManager.setAbsGrey(this.btn_up,!this.isEnough),this.moneyType=[],l&&l.length){var T=!0;this.moneyType.forEach(function(e){e[0]==l[0][0]&&e[1]==l[0][1]&&(T=!1)}),T&&this.moneyType.push([l[0][0],l[0][1]])}else{var C=JSON.parse(n[1].costs),E=!0;this.moneyType.forEach(function(e){e[0]==C[0][0]&&e[1]==C[0][1]&&(E=!1)}),E&&this.moneyType.push([C[0][0],C[0][1]])}this.resource_bar.updateBar({costs:this.moneyType,width:170,gap:70,needAdd:!0});var b=[this.skill_1,this.skill_2,this.skill_3,this.skill_4,this.skill_5],I=JSON.parse(t.skills),A=JSON.parse(t.skillUnlock),P=function(t){if(I[t]){b[t].updateItem({code:I[t][2]}),b[t].addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){var e="";h<A[t]&&(e=A[t]+"级解锁"),i.skill_panel.visible=!0,i.skill_panel.updateItem({code:I[t][2],tips:e})},S),b[t].addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skill_panel.visible=!1},S),b[t].addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skill_panel.visible=!1},S),b[t].addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skill_panel.visible=!1},S);var e=h<A[t];UIActionManager.setAbsGrey(b[t],e)}else b[t].reset()},S=this;for(f=0;f<b.length;f++)P(f);this.img_red1.visible=this.py.checkNoticeInfoByOne(t),Utils.UnlockMgr.checkPass(MODULE.RoleSkill,!1).allow&&(this.img_red2.visible=this.py.checkNoticeSkillUpgrade())},i.prototype.judgeIsLock=function(e){var t=!0,i=JSON.parse(e.condition),n=this.py.skillTreeList,o=0;if(i&&0<i.length){for(var a in i)for(var r in n)n[r].treeId==i[a][0]&&n[r].num>=i[a][1]&&o++;t=!(o>=i.length)}else t=!1;return t},i.prototype.updateSkillInfo=function(e){for(var t=[],i=N.Config.roleSkillTree(),n=0;n<i.length;n++){var o={indexNum:n,isChoose:0==n,isLock:this.judgeIsLock(i[n]),config:i[n],chooseCb:this.updateSkillInfo.bind(this)};t.push(o)}this.skillDataprovider.replaceAll(t);var a=void 0,r=0;for(var s in e?(a=e.config,r=e.indexNum):(a=this.dataConfig,r=this.chooseNum),this.dataConfig=a,this.chooseNum=r,this.skill_type_1.visible=!1,this.skill_type_2.visible=!1,this.skill_type_3.visible=!1,this.skillDataprovider.source){var c=this.list_skill.getVirtualElementAt(Number(s)),l=this.skillDataprovider.getItemAt(Number(s));r==Number(s)?(l.isChoose=!0,c&&c.gp_choose&&(c.gp_choose.visible=!0)):(l.isChoose=!1,c&&c.gp_choose&&(c.gp_choose.visible=!1))}switch(a.treeType){case 1:this.skill_type_1.visible=!0,this.skill_type_1.updateData(a.id);break;case 2:this.skill_type_2.visible=!0,this.skill_type_2.updateData(a.id);break;case 3:this.skill_type_3.visible=!0,this.skill_type_3.updateData(a.id)}var h=N.Config.roleSkillTree()[0],p=N.Config.roleSkillById(h.treeType)[0],d=N.Config.roleSkillUpByCode(p.code),u=JSON.parse(d[0].costs);if(this.moneyType=[],u&&u.length){var g=!0;this.moneyType.forEach(function(e){e[0]==u[0][0]&&e[1]==u[0][1]&&(g=!1)}),g&&this.moneyType.push([u[0][0],u[0][1]])}this.resource_bar.updateBar({costs:this.moneyType,width:170,gap:70,needAdd:!0});var f=0;for(var s in this.py.skillTreeList)a.id==this.py.skillTreeList[s].treeId&&(f=this.py.skillTreeList[s].num);var _=[];_.push({text:"该天赋树已投入",style:{textColor:6112045}}),_.push({text:f+"",style:{textColor:11012104}}),_.push({text:"点，重置返还全部资源",style:{textColor:6112045}}),this.lb_skillNum.textFlow=_,Utils.UnlockMgr.checkPass(MODULE.RoleSkill,!1).allow&&(this.img_red2.visible=this.py.checkNoticeSkillUpgrade())},i.prototype.cleanSkillChoose=function(){this.skill_type_1.cleanSkillChoose(),this.skill_type_2.cleanSkillChoose(),this.skill_type_3.cleanSkillChoose()},i.TAB_VIEW={FASHION_INFO:0,SKILL_TREE:1},i}(BaseFull);N.FashionMainView=e,__reflect(e.prototype,"game.FashionMainView");var n=function(t){function e(){var e=t.call(this)||this;return e.backpackproxy=N.AppFacade.getInstance().retrieveProxy(N.BackpackPy.N),e.playerproxy=N.AppFacade.getInstance().retrieveProxy(N.PlayerPy.N),e.py=N.AppFacade.getInstance().retrieveProxy(N.HeroSpiritPy.N),e.isLock=!1,e.skinName="FashionAvatarItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.data.isShow?(this.gp_main.visible=!0,this.img_vs.source=this.data.config.avatar+"_png",this.gp_effect.removeChildren(),this.gp_effect.visible=!1,this.data.isCan&&DragonBoneTools.create("common_shizhuangkjh",function(e){this.gp_effect.removeChildren(),e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2,e.scaleX=e.scaleY=1,e.animation.play(),this.gp_effect.addChild(e),this.gp_effect.visible=!0},this)):(this.gp_main.visible=!1,this.gp_effect.visible=!1)},e.itemWidth=130,e}(eui.ItemRenderer);__reflect(n.prototype,"FashionAvatarItem");var a=function(t){function e(){var e=t.call(this)||this;return e.backpackproxy=N.AppFacade.getInstance().retrieveProxy(N.BackpackPy.N),e.playerproxy=N.AppFacade.getInstance().retrieveProxy(N.PlayerPy.N),e.py=N.AppFacade.getInstance().retrieveProxy(N.HeroSpiritPy.N),e.isLock=!1,e.skinName="FashionSkillItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.isLock?e.updateText():e.data.isChoose||e.data.chooseCb&&e.data.chooseCb(e.data)},this),this.gp_root.scaleX=this.gp_root.scaleY=.75,this.gp_choose.scaleX=this.gp_choose.scaleY=.75,this.lb_text.scaleX=this.lb_text.scaleY=.75,this.lb_text.y=80},e.prototype.dataChanged=function(){var e=this.data;this.gp_activate.visible=!1,this.gp_choose.visible=e.isChoose,this.gp_non.visible=e.isLock,this.lb_text.text=e.config.name,this.img_icon.source=e.config.pic+"_png",UIActionManager.setAbsGrey(this.gp_root,e.isLock)},e.prototype.updateText=function(){var e=JSON.parse(this.data.config.condition);if(e&&0<e.length){var t=e[0][1],i=e[0][0],n=N.Config.roleSkillTree();for(var o in n)if(n[o].id==i){var a=n[o].name;Utils.MsgUtils.addMidMsg(a+"天赋投入"+t+"点后可解锁");break}}},e}(eui.ItemRenderer);__reflect(a.prototype,"FashionSkillItem")}(game||(game={})),function(p){var e=function(t){function e(){var e=t.call(this)||this;return e.backpackproxy=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N),e.py=p.AppFacade.getInstance().retrieveProxy(p.FashionPy.N),e.playerPy=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N),e.config=void 0,e.skinName="FashionSkillSkin1",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.cleanSkillChoose=function(){var e=[this.skill_0,this.skill_1,this.skill_2,this.skill_3,this.skill_4,this.skill_5,this.skill_6,this.skill_7,this.skill_8,this.skill_9];for(var t in e)e[t].gp_choose.visible=!1},e.prototype.updateData=function(e){this.config=p.Config.roleSkillById(e),this.updateSkillInfo()},e.prototype.updateSkillInfo=function(){for(var e in this.config)this.judgeSkillPos(this.config[e])},e.prototype.judgeSkillPos=function(e){var t=JSON.parse(e.pos);1==t[0]?this.updateOneSkillInfo(this.skill_0,e):2==t[0]?1==t[1]?this.updateOneSkillInfo(this.skill_1,e,this.img_21):2==t[1]?this.updateOneSkillInfo(this.skill_2,e,this.img_22):3==t[1]&&this.updateOneSkillInfo(this.skill_3,e,this.img_23):3==t[0]?1==t[1]?this.updateOneSkillInfo(this.skill_4,e,this.img_31):2==t[1]?this.updateOneSkillInfo(this.skill_5,e,this.img_32):3==t[1]&&this.updateOneSkillInfo(this.skill_6,e,this.img_33):4==t[0]&&(1==t[1]?this.updateOneSkillInfo(this.skill_7,e,this.img_41):2==t[1]?this.updateOneSkillInfo(this.skill_8,e,this.img_42):3==t[1]&&this.updateOneSkillInfo(this.skill_9,e,this.img_43))},e.prototype.updateOneSkillInfo=function(e,t,i){var n={config:t,isLock:!1,isActivate:!1,isEnough:!1,isShowLevel:!0,isCanTouch:!0};n.isLock=this.judgeLock(t),n.isActivate=this.judgeActivate(n.isLock,t),n.isEnough=this.judgeEnough(t),i&&(i.visible=n.isLock),e.updateData(n)},e.prototype.judgeLock=function(e){var t=!1,i=p.Config.roleSkillUpByCode(e.code),n=void 0;for(var o in i)if(1==i[o].level){n=i[o];break}var a=0,r=JSON.parse(n.condition),s=!1,c=[],l=this.py.allSkillList;if(0<r.length&&(s=0!=r[0],c=r[1]),!(0<c.length))return t=!0;for(var o in c)for(var h in l)if(l[h][0]==c[o][0]){if(s){a++;break}if(t=l[h][1]>=c[o][1])return t}return t=a>=c.length},e.prototype.judgeActivate=function(e,t){var i=!1,n=this.py.allSkillList;if(e){for(var o in i=!0,n)if(n[o][0]==t.code){i=!1;break}}else i=!1;return i},e.prototype.judgeEnough=function(e){var t=!1,i=p.Config.roleSkillUpByCode(e.code),n=void 0,o=0,a=this.py.allSkillList;for(var r in a)if(a[r][0]==e.code){o=a[r][1];break}if(o>=i.length)return!0;for(var s in i)if(i[s].level==o+1){n=i[s];break}var c=JSON.parse(n.costs),l=0;if(c&&c.length){for(r=0;r<c.length;r++){p.GameMVC.backpackPy.getItemNumByCode(c[r][1])>=c[r][2]&&l++}t=l>=c.length}return t},e}(eui.Component);p.FashionSkillInfo1=e,__reflect(e.prototype,"game.FashionSkillInfo1",["eui.UIComponent","egret.DisplayObject"])}(game||(game={})),function(p){var e=function(t){function e(){var e=t.call(this)||this;return e.backpackproxy=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N),e.py=p.AppFacade.getInstance().retrieveProxy(p.FashionPy.N),e.playerPy=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N),e.config=void 0,e.skinName="FashionSkillSkin2",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.cleanSkillChoose=function(){var e=[this.skill_0,this.skill_1,this.skill_2,this.skill_3,this.skill_4,this.skill_5,this.skill_6,this.skill_7];for(var t in e)e[t].gp_choose.visible=!1},e.prototype.updateData=function(e){this.config=p.Config.roleSkillById(e),this.updateSkillInfo()},e.prototype.updateSkillInfo=function(){for(var e in this.config)this.judgeSkillPos(this.config[e])},e.prototype.judgeSkillPos=function(e){var t=JSON.parse(e.pos);1==t[0]?this.updateOneSkillInfo(this.skill_0,e):2==t[0]?1==t[1]?this.updateOneSkillInfo(this.skill_1,e,this.img_21):3==t[1]&&this.updateOneSkillInfo(this.skill_2,e,this.img_23):3==t[0]?1==t[1]?this.updateOneSkillInfo(this.skill_3,e,this.img_31):3==t[1]&&this.updateOneSkillInfo(this.skill_4,e,this.img_33):4==t[0]&&(1==t[1]?this.updateOneSkillInfo(this.skill_5,e,this.img_41):2==t[1]?this.updateOneSkillInfo(this.skill_6,e,void 0,[this.img_42_1,this.img_42_3]):3==t[1]&&this.updateOneSkillInfo(this.skill_7,e,this.img_43))},e.prototype.updateOneSkillInfo=function(e,t,i,n){var o={config:t,isLock:!1,isActivate:!1,isEnough:!1,isShowLevel:!0,isCanTouch:!0};if(o.isLock=this.judgeLock(t),o.isActivate=this.judgeActivate(o.isLock,t),o.isEnough=this.judgeEnough(t),i&&(i.visible=o.isLock),n)for(var a=0;a<n.length;a++)n[a].visible=this.judgeImgLock(a,t);e.updateData(o)},e.prototype.judgeImgLock=function(e,t){var i=!1,n=p.Config.roleSkillUpByCode(t.code),o=void 0;for(var a in n)if(1==n[a].level){o=n[a];break}var r=JSON.parse(o.condition),s=!1,c=[],l=this.py.allSkillList;if(r&&0<r.length&&(s=0!=r[0],c=r[1]),!(0<c.length))return i=!0;for(var h in l)if(l[h][0]==c[e][0]){if(s)break;return i=l[h][1]>=c[e][1]}return i},e.prototype.judgeLock=function(e){var t=!1,i=p.Config.roleSkillUpByCode(e.code),n=void 0;for(var o in i)if(1==i[o].level){n=i[o];break}var a=0,r=JSON.parse(n.condition),s=!1,c=[],l=this.py.allSkillList;if(r&&0<r.length&&(s=0!=r[0],c=r[1]),!(0<c.length))return t=!0;for(var o in c)for(var h in l)if(l[h][0]==c[o][0]){if(s){a++;break}if(t=l[h][1]>=c[o][1])return t}return t=a>=c.length},e.prototype.judgeActivate=function(e,t){var i=!1,n=this.py.allSkillList;if(e){for(var o in i=!0,n)if(n[o][0]==t.code){i=!1;break}}else i=!1;return i},e.prototype.judgeEnough=function(e){var t=!1,i=p.Config.roleSkillUpByCode(e.code),n=void 0,o=0,a=this.py.allSkillList;for(var r in a)if(a[r][0]==e.code){o=a[r][1];break}if(o>=i.length)return!0;for(var s in i)if(i[s].level==o+1){n=i[s];break}var c=JSON.parse(n.costs),l=0;if(c&&c.length){for(r=0;r<c.length;r++){p.GameMVC.backpackPy.getItemNumByCode(c[r][1])>=c[r][2]&&l++}t=l>=c.length}return t},e}(eui.Component);p.FashionSkillInfo2=e,__reflect(e.prototype,"game.FashionSkillInfo2",["eui.UIComponent","egret.DisplayObject"])}(game||(game={})),function(p){var e=function(t){function e(){var e=t.call(this)||this;return e.backpackproxy=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N),e.py=p.AppFacade.getInstance().retrieveProxy(p.FashionPy.N),e.playerPy=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N),e.config=void 0,e.skinName="FashionSkillSkin3",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.cleanSkillChoose=function(){var e=[this.skill_0,this.skill_1,this.skill_2,this.skill_3,this.skill_4,this.skill_5,this.skill_6,this.skill_7,this.skill_8];for(var t in e)e[t].gp_choose.visible=!1},e.prototype.updateData=function(e){this.config=p.Config.roleSkillById(e),this.updateSkillInfo()},e.prototype.updateSkillInfo=function(){for(var e in this.config)this.judgeSkillPos(this.config[e])},e.prototype.judgeSkillPos=function(e){var t=JSON.parse(e.pos);1==t[0]?this.updateOneSkillInfo(this.skill_0,e):2==t[0]?1==t[1]?this.updateOneSkillInfo(this.skill_1,e,this.img_1):2==t[1]?this.updateOneSkillInfo(this.skill_2,e,this.img_1):3==t[1]?this.updateOneSkillInfo(this.skill_3,e,this.img_1):4==t[1]&&this.updateOneSkillInfo(this.skill_4,e,this.img_1):3==t[0]&&(1==t[1]?this.updateOneSkillInfo(this.skill_5,e,this.img_31):2==t[1]?this.updateOneSkillInfo(this.skill_6,e,this.img_32):3==t[1]?this.updateOneSkillInfo(this.skill_7,e,this.img_33):4==t[1]&&this.updateOneSkillInfo(this.skill_8,e,this.img_34))},e.prototype.updateOneSkillInfo=function(e,t,i){var n={config:t,isLock:!1,isActivate:!1,isEnough:!1,isShowLevel:!0,isCanTouch:!0};n.isLock=this.judgeLock(t),n.isActivate=this.judgeActivate(n.isLock,t),n.isEnough=this.judgeEnough(t),i&&(i.visible=n.isLock),e.updateData(n)},e.prototype.judgeLock=function(e){var t=!1,i=p.Config.roleSkillUpByCode(e.code),n=void 0;for(var o in i)if(1==i[o].level){n=i[o];break}var a=0,r=JSON.parse(n.condition),s=!1,c=[],l=this.py.allSkillList;if(0<r.length&&(s=0!=r[0],c=r[1]),!(0<c.length))return t=!0;for(var o in c)for(var h in l)if(l[h][0]==c[o][0]){if(s){a++;break}if(t=l[h][1]>=c[o][1])return t}return t=a>=c.length},e.prototype.judgeActivate=function(e,t){var i=!1,n=this.py.allSkillList;if(e){for(var o in i=!0,n)if(n[o][0]==t.code){i=!1;break}}else i=!1;return i},e.prototype.judgeEnough=function(e){var t=!1,i=p.Config.roleSkillUpByCode(e.code),n=void 0,o=0,a=this.py.allSkillList;for(var r in a)if(a[r][0]==e.code){o=a[r][1];break}if(o>=i.length)return!0;for(var s in i)if(i[s].level==o+1){n=i[s];break}var c=JSON.parse(n.costs),l=0;if(c&&c.length){for(r=0;r<c.length;r++){p.GameMVC.backpackPy.getItemNumByCode(c[r][1])>=c[r][2]&&l++}t=l>=c.length}return t},e}(eui.Component);p.FashionSkillInfo3=e,__reflect(e.prototype,"game.FashionSkillInfo3",["eui.UIComponent","egret.DisplayObject"])}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.params=void 0,e.backpackproxy=a.AppFacade.getInstance().retrieveProxy(a.BackpackPy.N),e.py=a.AppFacade.getInstance().retrieveProxy(a.FashionPy.N),e.playerPy=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),e.skinName="FashionSkillItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.params.isCanTouch&&(a.AppFacade.getInstance().sendNotification(CN.SKILL_CHOOSE_CLEAN),e.gp_choose.visible=!0,a.AppFacade.getInstance().showSubView(a.FashionMediator.N,a.FashionMediator.SV.SKILL_UP,{config:e.params.config,isLock:e.params.isLock}))},this)},e.prototype.updateData=function(e){this.params=e,this.gp_non.visible=!1,this.gp_choose.visible=!1,this.gp_activate.visible=e.isActivate&&e.isEnough,this.img_icon.source=e.config.iconName+"_png";var t=a.Config.roleSkillUpByCode(e.config.code),i=0,n=this.py.allSkillList;for(var o in n)if(n[o][0]==e.config.code){i=n[o][1];break}this.lb_text.visible=e.isShowLevel,this.lb_text.text=i+"/"+t.length,e&&e.isNotSetAbsGrey?UIActionManager.setAbsGrey(this.gp_root,!1):this.gp_activate.visible?UIActionManager.setAbsGrey(this.gp_root,!1):UIActionManager.setAbsGrey(this.gp_root,0==i)},e}(eui.Component);a.FashionSkillItem=e,__reflect(e.prototype,"game.FashionSkillItem",["eui.UIComponent","egret.DisplayObject"])}(game||(game={})),function(m){var e=function(t){function e(){var e=t.call(this)||this;return e.isLock=!1,e.moneyType=[],e.backpackproxy=m.AppFacade.getInstance().retrieveProxy(m.BackpackPy.N),e.py=m.AppFacade.getInstance().retrieveProxy(m.FashionPy.N),e.playerPy=m.AppFacade.getInstance().retrieveProxy(m.PlayerPy.N),e.isEnough=!1,e.skinName="FashionSkillUpSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;this.isLock?this.isEnough?this.py.LearnRoleSkill(this.data.code,function(){e.updateEffect(),e.updateData()}):Utils.MsgUtils.addMidMsg("道具不足"):Utils.MsgUtils.addMidMsg("该技能暂未解锁")},this),this.resource_bar.visible=!0},e.prototype.updateEffect=function(){this.gp_effect.removeChildren(),"激活"==this.btn_up.label?DragonBoneTools.playOnce({effectName:"common_ty_jihuo",parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/2}):DragonBoneTools.playOnce({effectName:"common_ty_dj",parent:this.gp_effect,y:this.gp_effect.height/2,x:this.gp_effect.width/2})},e.prototype.updateView=function(e){this.params=e,this.data=e.config,this.isLock=e.isLock,this.updateData()},e.prototype.updateData=function(){var e={config:this.params.config,isLock:!0,isActivate:!1,isEnough:!0,isShowLevel:!1,isCanTouch:!1,isNotSetAbsGrey:!0};this.skill_0.updateData(e),this.lb_name.text=this.params.config.name;var t=0,i=0,n=this.py.allSkillList,o=m.Config.roleSkillUpByCode(this.params.config.code);for(var a in n)if(n[a][0]==this.params.config.code){t=n[a][1];break}var r=!1;t>=o.length?(i=t,this.btn_up.visible=!1,this.img_max.visible=!0,r=this.img_max1.visible=!0):(i=t+1,this.btn_up.visible=!0,this.img_max.visible=!1,r=this.img_max1.visible=!1),this.lb_level.text=t+"/"+o.length;var s=JSON.parse(this.params.config.attr),c=void 0,l=void 0,h=0;for(var p in o)o[p].level==i?(l=JSON.parse(o[p].costs),c=JSON.parse(o[p].attr)):o[p].level==t&&(s=JSON.parse(o[p].attr));if(this.gp_cost.removeChildren(),l&&l.length&&!r){for(a=0;a<l.length;a++){var d=new customui.CommonIconWithNum({code:l[a][1],num:l[a][2],style:CommonIconStyle.RIGHT,showEnough:!0});d.scaleX=d.scaleY=.8,this.gp_cost.addChild(d);var u=m.GameMVC.backpackPy.getItemNumByCode(l[a][1])>=l[a][2];UIActionManager.setAbsGrey(d,!u),u&&h++}this.isEnough=h>=l.length}else this.gp_cost.removeChildren();if(UIActionManager.setAbsGrey(this.btn_up,!this.params.isLock||!this.isEnough),this.moneyType=[],l&&l.length){var g=!0;this.moneyType.forEach(function(e){e[0]==l[0][0]&&e[1]==l[0][1]&&(g=!1)}),g&&this.moneyType.push([l[0][0],l[0][1]])}else{var f=JSON.parse(o[0].costs),_=!0;this.moneyType.forEach(function(e){e[0]==f[0][0]&&e[1]==f[0][1]&&(_=!1)}),_&&this.moneyType.push([f[0][0],f[0][1]])}if(this.resource_bar.updateBar({costs:this.moneyType,width:170,gap:70,needAdd:!0}),this.gp_text_1.removeChildren(),this.gp_text_2.removeChildren(),r){if(c&&c.length)for(var p in c)this.updateText(this.gp_text_1,c[p],this.params.config)}else{if(s&&s.length)for(var p in s)this.updateText(this.gp_text_1,s[p],this.params.config);if(c&&c.length)for(var p in c)this.updateText(this.gp_text_2,c[p],this.params.config)}r?(this.btn_up.visible=!1,this.lb_lockText.visible=!1):(this.btn_up.visible=this.isLock,this.lb_lockText.visible=!this.btn_up.visible,this.btn_up.label=0==t?"激活":"升级"),this.lb_lockText.visible&&(this.gp_cost.removeChildren(),this.updateLockText())},e.prototype.updateLockText=function(){var e="",t=m.Config.roleSkillUpByCode(this.params.config.code),i=void 0;for(var n in t)if(1==t[n].level){i=t[n];break}var o=JSON.parse(i.condition),a=!1,r=[];this.py.allSkillList;if(0<o.length&&(a=0!=o[0],r=o[1]),0<r.length)if(1==r.length)e=(c=m.Config.roleSkillByCode()[r[0][0]]).name+"达到"+r[0][1]+"级解锁";else for(var s=0;s<r.length;s++){var c=m.Config.roleSkillByCode()[r[s][0]],l=a?"且":"或";s==r.length-1?e+=c.name+"达到"+r[s][1]+"级解锁":e+=c.name+"达到"+r[s][1]+"级"+l}this.lb_lockText.text=e},e.prototype.updateText=function(e,t,i){var n=new eui.Label;n.size=20,n.textAlign="left",n.bold=!0;var o=[];o.push({text:i.desc,style:{textColor:16775395}}),o.push({text:AttrConfig[t[0]].name+"+",style:{textColor:16775395}}),o.push({text:m.GeneralConfig.getAttrValue(t[1]),style:{textColor:36871}}),n.textFlow=o,e.addChild(n)},e}(BasePanel);m.FashionUpsectionPanel=e,__reflect(e.prototype,"game.FashionUpsectionPanel")}(game||(game={})),function(s){var e=function(i){function e(){var e,t=i.call(this)||this;return t.curType=EEntityType.EEntityTypeHero,t.ITEM_TYPE_CONFIG=((e={})[s.BackpackUI.ITEM_TYPE.HERO]={desc:"图鉴",type:"英雄",needHelp:!0,barSource:{up:"_btn_yq_m_json.beibao_yeqian_yingxiong_0",down:"_btn_yq_m_json.beibao_yeqian_yingxiong_1"},getAllInfo:function(){var e=[],t=s.Config.allHeroConfig();for(var i in t){var n=t[i];n.isShow&&e.push(n)}return e},historyInfo:function(){return s.AppFacade.getInstance().retrieveProxy(s.HeroPy.N).heroHistoryInfo},filterConfig:{data:[{race:HeroRaceType.Human,icon:"_hero_ar_m_json.common_icon_zhongzu_1",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Orc,icon:"_hero_ar_m_json.common_icon_zhongzu_2",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Elf,icon:"_hero_ar_m_json.common_icon_zhongzu_4",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Athanasy,icon:"_hero_ar_m_json.common_icon_zhongzu_3",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Demon,icon:"_hero_ar_m_json.common_icon_zhongzu_5",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Eldar,icon:"_hero_ar_m_json.common_icon_zhongzu_6",chosenImg:"common_icon_xuanzhongyuan_png"}],filterFunc:function(e,t){return!e||e.race==t.race}},sortConfig:{data:[{desc:"等级"},{desc:"星级"}],defaultSortFunc:function(e,t){var i=e.info,n=t.info;return i.initStar!=n.initStar?i.initStar-n.initStar:i.tier!=n.tier?n.tier-i.tier:i.race!=n.race?i.race-n.race:i.profession!=n.profession?HERO_SORT_ORDER[n.profession]-HERO_SORT_ORDER[i.profession]:i.subType!=n.subType?i.subType-n.subType:i.code-n.code}}},e[s.BackpackUI.ITEM_TYPE.ARTIFACT]={desc:"图鉴",type:"圣物",needHelp:!1,barSource:{up:"_btn_yq_m_json.beibao_yeqian_shenqi_0",down:"_btn_yq_m_json.beibao_yeqian_shenqi_1"},getAllInfo:function(){var e=[],t=s.Config.getHeroArtifactConfig();for(var i in t){var n=t[i];if(""!=n.handbookShow){var o=s.Config.getHeroArtifactUpgradeConfig(n.code),a=s.Config.getHeroArtifactUpstarConfig(n.code),r={code:n.code,entityType:EEntityType.EEntityTypeHeroArtifact,exp:0,fightCap:0,level:o&&o.length?o[o.length-1].level:0,level2:a&&a.length?a[a.length-1].level:0};e.push({code:n.code,vo:r,type:EEntityType.EEntityTypeHeroArtifact,isNum:!0,color:n.color,source:0})}}return e},filterConfig:{data:[{color:EColorType.EColorTypeWhite,icon:"beibao_btn_pinzhi_1_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeGreen,icon:"beibao_btn_pinzhi_2_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeBlue,icon:"beibao_btn_pinzhi_3_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypePurple,icon:"beibao_btn_pinzhi_4_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeOrange,icon:"beibao_btn_pinzhi_5_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeRed,icon:"beibao_btn_pinzhi_6_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeLegend,icon:"beibao_btn_pinzhi_7_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"}],filterFunc:function(e,t){return!e||e.color==t.color}},sortConfig:{defaultSortFunc:function(e,t){var i=e.info,n=t.info,o=i.color,a=n.color;return o!=a?o-a:i.code-n.code}},historyInfo:function(){return s.AppFacade.getInstance().retrieveProxy(s.HeroThingPy.N).artiHostory}},e),t.skinName="HandBookMainViewSkin",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initList(),this.activateComponent(),this.initialized=!1,this.gp_content.scaleX=this.gp_content.scaleY=1,UIActionManager.playUIAction(this.gp_content,1),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new n})},this)},e.prototype.initList=function(){this.list_item.itemRenderer=t,UIActionManager.hideScrollerBar(this.scroller),this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListItemTap,this),this.list_filter.itemRenderer=s.BackpackUI_FilterItem,this.list_filter.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onFilterListItemTap,this)},e.prototype.onFilterListItemTap=function(e){this.curFilter&&this.curFilter==e.item.data?this.curFilter=void 0:this.curFilter=e.item.data;var t=this.list_filter.dataProvider;for(var i in t.source){var n=t.source[i];n==e.item?n.chosen=!n.chosen:n.chosen=!1}t.refresh(),this.updateList()},e.prototype.fadeFilterListItemTap=function(e){this.curFilter&&this.curFilter==e.item.data?this.curFilter=void 0:this.curFilter=e.item.data;var t=this.list_filter.dataProvider;for(var i in t.source){var n=t.source[i];n.data.race==e.item.data.race?n.chosen=!n.chosen:n.chosen=!1}t.refresh(),this.updateList()},e.prototype.onListItemTap=function(e){var t=e.item.info,i=t.code;switch(Math.floor(i/1e7)){case EEntityType.EEntityTypeHero:s.AppFacade.getInstance().showSubView(s.HeroMediator.N,s.HeroMediator.SV.HERO_DETAIL,{code:i});break;case EEntityType.EEntityTypeHeroArtifact:var n=s.Config.getHeroArtifactUpgradeConfig(t.code),o=s.Config.getHeroArtifactUpstarConfig(t.code);s.AppFacade.getInstance().showSubView(s.HeroThingMediator.N,s.HeroThingMediator.SV.MAIN,{entityType:EEntityType.EEntityTypeHeroArtifact,vo:{code:t.code,entityType:EEntityType.EEntityTypeHeroArtifact,exp:0,fightCap:12e3,level:n.length?n[n.length-1].level:0,level2:o.length?o[o.length-1].level:0},source:s.HeroThingMainView.VIEW_SOURCE.HANDBOOK})}},e.prototype.updateView=function(e){this.params=e,this.curType=e.type,this.targetConfig=this.ITEM_TYPE_CONFIG[this.curType],this.targetConfig&&(this.initialized||(this.initialized=!0,this.resetFilterAndSorter(),this.curType==s.BackpackUI.ITEM_TYPE.HERO&&this.fadeFilterListItemTap({item:{isHero:!0,data:this.targetConfig.filterConfig.data[0],chosen:!1}})),this.btn_help.visible=!!this.targetConfig.needHelp,this.updateList())},e.prototype.updateList=function(){var e=[],t=this.targetConfig.filterConfig&&this.targetConfig.filterConfig.filterFunc||function(){return!0},i=this.targetConfig.sortConfig&&this.targetConfig.sortConfig.defaultSortFunc,n=this.targetConfig.getAllInfo();if(n){var o=this.targetConfig.historyInfo();for(var a in n){var r=n[a];t(this.curFilter,r)&&e.push({info:r,get:o[r.code]&&!!o[r.code].num})}}0<e.length?(this.gp_empty.visible=!1,this.scroller.visible=!0,i&&e.sort(i),this.list_item.dataProvider=new eui.ArrayCollection(e),this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0):(this.gp_empty.visible=!0,this.scroller.visible=!1)},e.prototype.resetFilterAndSorter=function(){if(this.targetConfig.filterConfig){this.list_filter.visible=!0,this.curFilter=void 0;var t=[];"英雄"==this.targetConfig.type||"碎片"==this.targetConfig.type?(this.targetConfig.filterConfig.data.forEach(function(e){t.push({data:e,chosen:!1,isHero:!0})}),this.list_filter.x=(this.gp_content.width-(80*t.length+15*(t.length-1)))/2+15):(this.targetConfig.filterConfig.data.forEach(function(e){t.push({data:e,chosen:!1,isHero:!1})}),this.list_filter.x=(this.gp_content.width-(60*t.length+15*(t.length-1)))/2),this.list_filter.dataProvider=new eui.ArrayCollection(t)}else this.list_filter.visible=!1;this.blb_title.text=this.targetConfig.desc},e.prototype.activateComponent=function(){var e=this;this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.params&&this.params.closeCB&&this.params.closeCB()},e}(BasePanel);s.HandBookMainView=e,__reflect(e.prototype,"game.HandBookMainView");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="HandBookItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){this.baseitem=customui.BaseItemFactory.create(),this.baseitem.touchEnabled=!1,this.gp_content.addChild(this.baseitem)},e.prototype.dataChanged=function(){var e=this.data.info;e.isShowZhongZhu=!0;var t=0;switch(Math.floor(e.code/1e7)){case EEntityType.EEntityTypeHero:t=e.maxLevel,this.baseitem.updateData(e),t?(this.baseitem.blb_level.visible=!0,this.baseitem.blb_level.text=t+""):this.baseitem.blb_level.visible=!1;break;case EEntityType.EEntityTypeHeroArtifact:this.baseitem.updateData(e)}this.data.get?UIActionManager.setGrey(this.baseitem,!1):UIActionManager.setGrey(this.baseitem,!0)},e}(eui.ItemRenderer);__reflect(t.prototype,"handbookItem");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="HandBookHeroHelp",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="说明",this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.updateLabel(0,"人类是勤劳的化身，创造了璀璨的文明。"),this.updateLabel(1,"拥有野兽的力量，是追求自由的强大族群。"),this.updateLabel(2,"侵入世界的恐怖力量，强大的存在。"),this.updateLabel(3,"居住在森林，具有神秘的力量。"),this.updateLabel(4,"神秘的族群，有着统治一切的魔力。"),this.updateLabel(5,"和魔族抗衡的正义力量，光明的使者。"),this.updateLabel(6,"作为团队的肉盾，具有超强的生存能力。"),this.updateLabel(7,"拥有爆炸的技能伤害，瞬间秒杀一切。"),this.updateLabel(8,"团队的守护神，是不容忽视的职业。"),this.updateLabel(9,"持续强大的核心输出，保证团队战无不胜。")},e.prototype.updateLabel=function(e,t){var i=this["lb_"+e];i&&(i.text=t)},e}(BasePanel);__reflect(n.prototype,"HandBookHeroHelp")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.proxy=o.AppFacade.getInstance().retrieveProxy(o.HandBookPy.N),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.HandBookMainView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:}},n.N="HandBookMediator",n.SV={MAIN:1},n}(BaseMediator);o.HandBookMediator=e,__reflect(e.prototype,"game.HandBookMediator")}(game||(game={})),function(i){var e=function(e){function t(){return e.call(this,i.CopyEntrancePy.N)||this}return __extends(t,e),t.N="HandBookPy",t}(BaseProxy);i.HandBookPy=e,__reflect(e.prototype,"game.HandBookPy")}(game||(game={}));var _a,TIP_COLOR=36807,HELP_CONST=((_a={})[MODULE.GuildCollect]={content:"<font>1.公会等级达到%s级可解锁战斗地铁玩法。</font>\n<font>2.玩家每通关一关可获得<font color= "+TIP_COLOR+">首破奖励</font>（有且只能获取一次），以及<font color= "+TIP_COLOR+">关卡奖励</font></font>。\n<font>3.关卡首次通关的玩家，会给其他通关的玩家增加BUFF，降低本关难度。\n</font>\n<font>4.当首通玩家退出公会时，以公会通关关卡最高的玩家作为首通玩家，显示在对应关卡上。</font>\n<font>5.每日上线可通过<font color = "+TIP_COLOR+">扫荡</font>直接获得已通关的关卡奖励。"},_a[MODULE.Champion]={content:"<font>1.永恒之塔战败会消耗一点<font color= "+TIP_COLOR+" >永恒之力</font>，胜利则不会消耗（当永恒之力为零时无法战斗）。</font>\n<font>2.<font color= "+TIP_COLOR+" >永恒之力</font>每<font color= "+TIP_COLOR+" >60</font>分钟自动恢复1点，上限为<font color= "+TIP_COLOR+" >10</font>点。</font>\n<font>3.永恒之塔的难度逐步递增，各个关卡有<font color= "+TIP_COLOR+" >丰厚的奖励</font>。</font>\n<font>4.永恒之塔排行榜会根据玩家的层数进行排名。"},_a[MODULE.DailyFortress]={content:"<font>1.日常副本分为<font color= "+TIP_COLOR+" >经验树窟</font>，<font color= "+TIP_COLOR+" >金币宝藏</font>，<font color= "+TIP_COLOR+" >升阶神像</font>，<font color= "+TIP_COLOR+" >英雄堡垒</font>，<font color= "+TIP_COLOR+" >强化古迹</font>，<font color= "+TIP_COLOR+" >神器法阵</font>六个系统，每个系统有相应的资源产出。</font>\n<font>2.每个系统每日有2点初始挑战次数，次数可通过<font color= "+TIP_COLOR+" >钻石购买</font>不同vip可购买次数不同）。</font>\n<font>3.玩家等级越高，可挑战更高难度的挑战，获得的奖励<font color= "+TIP_COLOR+" >越丰厚</font>。</font>\n<font>4.玩家<font color= "+TIP_COLOR+" >有概率</font>获得更多的奖励。"},_a[MODULE.Expedition]={content:"<font>1.玩家达到<font color= "+TIP_COLOR+" >30级</font>开启英雄远征的玩法。</font>\n<font>2.远征每日<font color= "+TIP_COLOR+" >0</font>点重置。</font>\n<font>3.英雄阵亡无法继续进行战斗。</font>\n<font>4.关卡数量为15关，关卡数量越高，所获奖励越丰厚。</font>\n<font>5.战斗胜利获得的远征币可在远征商店兑换所需的商品。"},_a[MODULE.TeamExpedition]={content:"<font>1、该玩法在开服<font color="+TIP_COLOR+">第15天</font>进入战区玩法系统。</font>\n<font>2、组队副本为多人玩法，玩家可以自己<font color= "+TIP_COLOR+" >组建队伍</font>或者<font color= "+TIP_COLOR+" >加入他人队伍。</font></font>\n<font>3、通关方式：单人通关或者组队通关，队伍只能挑战已解锁的关卡，以队伍所有成员<font color= "+TIP_COLOR+" >最低的解锁关卡</font>为准。</font>\n<font>4、队长的权限包括踢出队员，转移队长，操作队伍，选择队伍出战顺序。队员<font color= "+TIP_COLOR+" >只允许观看</font>。</font>\n<font>5、玩家拥有<font color= "+TIP_COLOR+" >两次</font>协助挑战次数，在该挑战次数内，队内通关章节数高于其他队员的玩家可获得<font color= "+TIP_COLOR+" >协助奖励</font>。</font>"},_a[MODULE.Arena]={content:"<font size= 24>1.奖励分为两种奖励：<font color= "+TIP_COLOR+">排名奖励</font>和<font color= "+TIP_COLOR+">成就奖励</font>。排名奖励根据玩家排名，结算时发放对应的排名奖励。成就奖励根据历史最高排名，达成相应的排名条件发放对应的成就奖励（每种奖励<font color= "+TIP_COLOR+">仅发放一次</font>）。</font>\n<font size= 24 >2.单次竞技挑战消耗一次挑战次数，次数可通过<font color= "+TIP_COLOR+">钻石购买</font>。</font>\n<font size= 24 >3.竞技场战斗限定15回合，战斗超过15回合，进攻方判定为负。</font>\n<font size= 24 >4.战斗胜利获得积分，战斗失败扣除积分，所有玩家<font color= "+TIP_COLOR+">按照积分</font>进行<font color= "+TIP_COLOR+">排名</font>。</font>\n<font size= 24 >5.战斗记录中可以观看最近的<font color= "+TIP_COLOR+" >战斗录像</font>，查看战斗记录。"},_a[MODULE.TeamArena]={content:"<font>一、该玩法在开服<font color="+TIP_COLOR+">第15天</font>开启，并直接进入战区玩法。</font>\n<font>二、组队竞技：分为<font color="+TIP_COLOR+">单服组队竞技</font>和<font color="+TIP_COLOR+">战区组队竞技。</font></font>\n<font>三、报名规则：所在队伍报名满<font color="+TIP_COLOR+">2人及以上</font>，由队长进行报名参加。</font>\n<font>四、战斗方式</font>\n<font>1.单服组队竞技采用匹配赛，各队伍不重复进行对战，按照胜场排名，排名相同由所有对战的小分决定先后。</font>\n<font>2.战区组队竞技采用单服组队竞技决出<font color="+TIP_COLOR+">单服最强的两支队伍</font>进行晋级赛，并随机分成最多8个小组，每个小组内为4个队伍，进行匹配参加本小组赛事，决出前16支队伍参加后续赛事，以此类推直到决出冠军为止。若所参加的队伍数不足，或者尚未匹配到对应的对手时，为轮空，轮空者为胜方。</font>\n<font>五、战斗流程</font>\n<font>每周<font color="+TIP_COLOR+">单周日00：00~23：30</font>报名，赛事进行时间为6日，<font color="+TIP_COLOR+">每日0：00~20：30</font>调整阵容，<font color="+TIP_COLOR+">周一至周六晚20：30至21：00</font>进行战斗，周六<font color="+TIP_COLOR+">晚21：00</font>进行周结算，发放对应奖励。</font>\n<font>六、赛事投票</font>\n<font>在晋级赛事中，玩家在战区组队竞技中可消耗一定资源，对小组赛中的队伍进行投票，若所投票竞猜的对象在本轮竞技中夺冠，可获得高额投票奖励。</font>"},_a[MODULE.ServerBoss]={content:"<font>1、世界boss于<font color="+TIP_COLOR+">开服第3天</font>开启，在<font color="+TIP_COLOR+">开服第15天</font>进入战区玩法系统，敬请各位玩家共同挑战boss。</font>\n<font>2、活动开启为<font color="+TIP_COLOR+">周二、周四、周六的正午12：00-晚20：00整</font>，每日奖励根据该日的<font color="+TIP_COLOR+">伤害排名</font>系统自动发放，周奖励同理。</font>\n<font>3、每名玩家每日拥有<font color="+TIP_COLOR+">5次</font>免费挑战boss的次数，挑战次数会在一定时间回复一次或者玩家可通过<font color="+TIP_COLOR+">钻石购买</font>该次数。若玩家在单次挑战中击杀某一boss，则可获得该boss的<font color="+TIP_COLOR+">击杀奖励</font>。</font>\n<font>4、等级越高的boss能力越强，boss为每日重置。</font>"},_a[MODULE.StarDoor]={content:"<font>1、消耗<font color="+TIP_COLOR+">1张时空契约</font>，可进行一次指定阵营的召唤。</font>\n<font>2、时空之门有几率获得对应阵营的<font color="+TIP_COLOR+">4星以及5星英雄</font>，<font color="+TIP_COLOR+">4星以及5星随机碎片</font>。</font>\n<font>3、每次时空之门的契约召唤将额外产生一定数量的<font color="+TIP_COLOR+">时空粉尘</font>和<font color="+TIP_COLOR+">时空币</font>，时空粉尘可用于<font color="+TIP_COLOR+">英雄置换</font>，时空币可在时空商店里<font color="+TIP_COLOR+">兑换商品</font>。</font>\n<font>4、时空置换<font color="+TIP_COLOR+">只能</font>置换4星和5星英雄，且只能置换获得同阵营同星级英雄，<font color="+TIP_COLOR+">神魔种族英雄不可置换</font>。</font>\n<font>5、时空之门普通种族各星级英雄召唤概率：<font color="+TIP_COLOR+">4星英雄60%、5星碎片26.7%、5星英雄13.3%</font>。神魔种族：<font color="+TIP_COLOR+">4星碎片50%，4星16%，5星碎片25%，5星9%</font>。</font>"},_a[MODULE.GuildBoss]={content:"<font>1.公会boss为全公会会员可参与的boss挑战。</font>\n<font>2.公会boss的等级随着天数的增加逐渐递增，当前天数的boss击杀后，公会boss会重生且后续的boss击杀奖励会逐渐递减。</font>\n<font>3.每次战斗将给予各位所在公会的会员一定的奖励，并且当boss首次被击败后，发放全公会所在会员的首杀奖励，后续为非首杀奖励。"},_a[MODULE.GuildCopy]={content:"<font>1.在公会副本内，每位所在公会的会员在一定时间内拥有挑战次数，挑战次数用完，则无法<font color= "+TIP_COLOR+">继续挑战</font>。</font>\n<font>2.在boss被击杀过后，根据玩家对该boss的总伤害发放<font color= "+TIP_COLOR+">伤害排名</font>所对应的奖励。</font>\n<font>3.公会副本的次数<font color= "+TIP_COLOR+">零点重置</font>，重置后的可用次数为<font color= "+TIP_COLOR+">2</font>次。</font>\n<font>4.已击杀的boss<font color= "+TIP_COLOR+">不再</font>领取该boss的奖励。"},_a[MODULE.GuildWar]={content:"<font>1、该玩法在开服<font color="+TIP_COLOR+">第15天</font>开启并直接进入战区玩法系统。</font>\n<font>2、公会达到<font color= "+TIP_COLOR+">4级</font>后，该公会可参加公会战，并于<font color="+TIP_COLOR+">每双周</font>开启该玩法。</font>\n<font>3、玩家于<font color= "+TIP_COLOR+">周日00：00~23:30</font>报名，持续进行<font color= "+TIP_COLOR+">六天</font>均可报名参战，满足三人即可进入匹配阶段。</font>\n<font>4、每日<font color= "+TIP_COLOR+">晚00：00~20：30</font>调整，<font color= "+TIP_COLOR+">晚20：30至21：00</font>进行战斗，周六<font color= "+TIP_COLOR+">晚21：00</font>进行周结算，发放奖励。</font>"},_a[MODULE.Replacement]={content:"<font>1.消耗一张<font color= "+TIP_COLOR+">时光契约</font>，可进行一次指定阵营的召唤。</font>\n<font>2.时空之门有几率获得对应阵营的<font color= "+TIP_COLOR+">4星</font>以及<font color= "+TIP_COLOR+">5星英雄</font>，<font color= "+TIP_COLOR+">4星</font>以及<font color= "+TIP_COLOR+">5星随机碎片</font>。</font>\n<font>3.每次时空之门的契约召唤将额外产生一定数量的<font color= "+TIP_COLOR+">时空粉尘</font>和<font color= "+TIP_COLOR+">时空币</font<font color= "+TIP_COLOR+">时空粉尘</font>可用于<font color= "+TIP_COLOR+">英雄置换</font>，<font color= "+TIP_COLOR+">时空币</font>可在时空商店兑换商品。</font>\n<font>4.时空置换只能置换<font color= "+TIP_COLOR+">4星</font>和<font color= "+TIP_COLOR+">5星</font>英雄，且只能置换获得<font color= "+TIP_COLOR+">同阵营同星级英雄</font>。"},_a[MODULE.Decompose]={content:"<font>1.英雄祭坛可以可以获得<font color= "+TIP_COLOR+">经验水晶，升阶石，灵魂碎片</font>。</font>\n<font>2.<font color= "+TIP_COLOR+">经验水晶</font>：英雄的升级资源之一。</font>\n<font>3.<font color= "+TIP_COLOR+">升阶石</font>：英雄升阶资源之一。</font>\n<font>4.<font color= "+TIP_COLOR+">灵魂碎片</font>：英雄祭坛商店中的兑换货币，可兑换获得相应的英雄碎片。"},_a[MODULE.HeroGaCha]={content:"1、<font>普通召唤：消耗普通招募券，一定时间后，获得单次免费召唤。普通召唤各星级英雄召唤概率：1星<font color="+TIP_COLOR+">55%</font>、*2星<font color="+TIP_COLOR+">25%</font>、3星<font color="+TIP_COLOR+">17%</font>、4星<font color="+TIP_COLOR+">2.5%</font>、5星<font color="+TIP_COLOR+">0.5%</font>。</font>\n2、<font>高级召唤：玩家可通过钻石购买对应数量的金币，同时，系统将赠送玩家高级召唤的次数，或者凭借高级召唤券招募英雄。另外，在一定时间内，玩家可免费获得召唤次数。高级召唤各星级英雄召唤概率：3星<font color="+TIP_COLOR+">69.4%</font>、4星<font color="+TIP_COLOR+">25%</font>、5星<font color="+TIP_COLOR+">5.6%</font>。</font>\n3、<font>友情召唤：消耗友情点，友情点可在好友赠送里获得。友情召唤各星级英雄召唤概率：2星<font color="+TIP_COLOR+">50%</font>、3星<font color="+TIP_COLOR+">27.5%</font>、4星<font color="+TIP_COLOR+">20%</font>、5星<font color="+TIP_COLOR+">2.5%</font>。</font>"},_a[MODULE.Smithy]={content:"<font>1、铁匠铺打造装备的道具为<font color="+TIP_COLOR+">秘银</font>，有概率获得<font color="+TIP_COLOR+">稀有装备</font>以及其它的<font color="+TIP_COLOR+">普通道具</font>。</font>\n<font>2、熔炼值满时，可获得<font color="+TIP_COLOR+">秘银</font>，越高级的装备熔炼<font color="+TIP_COLOR+">所获得熔炼值越高</font>。</font>\n<font>3、玩家可通过<font color="+TIP_COLOR+">圣物还原石</font>将<font color="+TIP_COLOR+">橙色、红色，金色圣物</font>进行还原，还原将返还培养过程中<font color="+TIP_COLOR+">所有消耗的材料</font>。</font>\n<font>4、圣物还原返还形式：圣物经验直接返还<font color="+TIP_COLOR+">升级石</font>；洗练石根据该圣物<font color="+TIP_COLOR+">所有消耗的洗练石原数返还（非重铸消耗部分）</font>；红色圣物还原返还消耗的所有<font color="+TIP_COLOR+">同品质圣物</font>，其余低品质圣物以圣物形式返还；橙色圣物还原时，除了返还本体外，其余消耗的圣物会<font color="+TIP_COLOR+">按碎片的形式</font>返还。</font>"},_a[MODULE.Challenge]={content:"<font>1、玩家可通过<font color="+TIP_COLOR+">命运之骰</font>进行游戏。</font>\n<font>2、遗迹探险分为普通地块，可产出<font color="+TIP_COLOR+">绿、蓝、紫圣物</font>；橙色宝箱，可产出<font color="+TIP_COLOR+">橙色圣物</font>；红色宝箱，可产出<font color="+TIP_COLOR+">红色圣物</font>。</font>\n<font>3、当再次回到起点后，可获得<font color="+TIP_COLOR+">英雄碎片*50</font>和<font color="+TIP_COLOR+">红色圣物碎片*10</font>。</font>"},_a[MODULE.HeroChallenge]={content:"<font>1.限时挑战结束后的<font color= "+TIP_COLOR+">一个星期</font>开启英雄挑战。</font>\n<font>2.英雄挑战分为3种模式，分别为<font color= "+TIP_COLOR+">1v1、3v3，以及6v6的模式</font>。</font>\n<font>3.开启英雄挑战后，随机从对应的模式中<font color= "+TIP_COLOR+">抽取一种</font>作为本周挑战的模式。</font>\n<font>4.模式确定后，只能选择对应的上阵数量的英雄进行挑战。</font>\n<font>5.英雄挑战全部通关后，等待下一周重新开始，进度重置。</font>\n<font>6.兑换商店<font color= "+TIP_COLOR+">每挑战5层</font>胜利后，可触发进行购买商品。"},_a[MODULE.WorldKing]={content:"<font>1、排位赛在<font color="+TIP_COLOR+">开服第三天</font>且玩家自身达到<font color="+TIP_COLOR+">70级</font>后开启，该玩法在开服<font color="+TIP_COLOR+">第15天</font>进入战区玩法系统。</font>\n<font>2、奖励分为三种奖励：<font color="+TIP_COLOR+">周排行奖励</font>、<font color="+TIP_COLOR+">日挑战宝箱奖励</font>、<font color="+TIP_COLOR+">周成就奖励</font>。根据最终的排名，发放周排行奖励；每日挑战达到指定次数，可领取对应的挑战次数宝箱奖励；在赛季内达到某段位，可领取周成就奖励。</font> \n<font>3、每天拥有<font color="+TIP_COLOR+">5次</font>初始挑战次数，额外的次数可用钻石购买，上限为<font color="+TIP_COLOR+">20次</font>。</font> \n<font>4、系统自动优先匹配段位相近的玩家，获胜增加积分，失败扣除积分，积分满足条件则<font color="+TIP_COLOR+">增加一星</font>，反之<font color="+TIP_COLOR+">减去一星</font> 。</font> \n<font>5、战斗记录中可查看最近的战斗录像，查看战斗记录。</font>"},_a[MODULE.Activity+EActivityType.NewYearChallenge]={content:"<font>1.新春挑战每日12:00~13:00开启</font>\n<font>2.每次放鞭炮可对BOSS造成固定伤害并获得随机奖励</font>\n<font>3.击杀BOSS的玩家可以额外获得击杀奖励</font>\n<font>4.每天本服首个BOSS被击杀后，全服可获得红包奖励</font>\n<font>5.新春挑战开启期间，BOSS被击杀后会重新刷新</font>"},_a[MODULE.HeroRollback]={content:"<font>1、英雄到达<font color= "+TIP_COLOR+">11星及11星以上</font>时，可进行重生。</font>\n<font>2、重生需要消耗<font color= "+TIP_COLOR+">魂石</font>，每次进行重生消耗的魂石<font color= "+TIP_COLOR+">数量相同</font>，均为<font color= "+TIP_COLOR+">1个</font>。</font>\n<font>3、重生后，不仅返还该英雄所消耗的<font color= "+TIP_COLOR+">所有本体</font>（包含英雄自己），还包括所有的<font color= "+TIP_COLOR+">培养道具</font>，诸如经验水晶、升阶石，觉醒石、宝石等道具；<font color= "+TIP_COLOR+">所有穿戴的装备、圣物</font>；<font color= "+TIP_COLOR+">所有升星过程中消耗的狗粮材料</font>。</font>\n<font>4、返还升星材料英雄（狗粮）形式：通过<font color= "+TIP_COLOR+">9星和10星通用狗粮</font>的形式进行返还，该通用狗粮不能作为上阵英雄，初次获得<font color= "+TIP_COLOR+">可激活该狗粮的头像</font>。</font>"},_a[MODULE.AbyssLair]={content:"<font>1、玩家可挑战不同章节的怪物，根据<font color="+TIP_COLOR+">胜利队伍数量</font>，决定当前关卡的星级，并获得该<font color="+TIP_COLOR+">星级奖励</font>。</font>\n<font>2、玩家通过设置三队阵容进行挑战，可<font color="+TIP_COLOR+">自由选择英雄上阵</font>和<font color="+TIP_COLOR+">决定各队出战顺序</font>。</font>\n<font>3、当通过某章节后，玩家可获得该章节的<font color="+TIP_COLOR+">通关奖励</font>。</font>"},_a[MODULE.ActivityNewBrave]={content:"<font>1.<font color= "+TIP_COLOR+">勇士令状</font>。</font>\n"},_a[MODULE.Activity+EActivityType.ZoneAuction]={content:"<font>1、活动期间，战区竞拍<font color= "+TIP_COLOR+">每日重置</font>。所有道具，于正午12点整开启。</font>\n<font>2、拍卖分为<font color= "+TIP_COLOR+">一口价</font>和<font color= "+TIP_COLOR+">竞拍</font>。竞拍后，若倒计时内无他人出价，则道具归属该竞拍者，一口价则直接购买该道具。</font>\n<font>3、每名玩家于每日仅限购买一次<font color= "+TIP_COLOR+">同种稀有道具</font>（红色栏内道具）。</font>\n"},_a[MODULE.Activity+EActivityType.OneChoice]={content:"<font>1、活动期间玩家可以向三位女性英雄祈福，并获得该英雄。</font>\n<font>2、活动期间，祈福<font color= "+TIP_COLOR+">仅限一次</font>。</font>\n"},_a[MODULE.Wchess]={content:"<font>1、命运战棋为<font color= "+TIP_COLOR+">六名</font>玩家共同参与。</font>\n<font>2、每名英雄的星级为<font color= "+TIP_COLOR+">一星、二星、三星</font>，3位同名同星级英雄可合成更高星级英雄（魔族只需要两名英雄）。</font>\n<font>3、每回合金币收入：胜利金币收入+回合基础金币收入+利息金币（每10金币收获1金币，上限为8金币）+连胜/连败收入（1、3、5金币）。</font>\n<font>4、游戏内，每<font color= "+TIP_COLOR+">10金币</font>增加升级经验，经验满时，则扩充一上阵英雄格（英雄格数上限为8格），越高的等级更容易获得<font color= "+TIP_COLOR+">高费英雄</font>。</font>\n<font>5、各英雄可组合成各类光环，光环对相应的英雄有<font color= "+TIP_COLOR+">属性加成</font>。</font>\n<font>6、每名玩家上限为100血，血量为零则结束游戏，根据不同的排名增加/扣除相应的积分，随之段位升级/降级，好友组队不计算排名积分以及相应的成就点数。</font>\n<font>7、赛季时间为<font color= "+TIP_COLOR+">一个月</font>，赛季结束后结算奖励。<font>"},_a[MODULE.ActivityProfessionSuit]={content:"<font>1、活动期间，玩家可在上方装备栏放入<font color= "+TIP_COLOR+">金装</font>，可升级成为<font color= "+TIP_COLOR+">金装职业套装装备</font>。</font>\n<font>2、金装职业套装分为<font color= "+TIP_COLOR+">4套装备</font>，对应：战士套装，游侠套装，法师套装，牧师套装。</font>\n<font>3、职业套装不仅有<font color= "+TIP_COLOR+">基础属性</font>的提升，同时对于穿戴该套装相应职业的英雄，有特别的<font color= "+TIP_COLOR+">属性获得</font>。</font>"},_a[MODULE.Activity+EActivityType.HuntTreasure]={content:"<font>1、活动期间，玩家可通过钻石抽取幸运夺宝奖池中的道具。</font>\n<font>2、道具获得概率：</font>\n<font>英魂币x30  <font color= "+TIP_COLOR+">1.5%</font>\n<font>五星精英碎片x50  <font color= "+TIP_COLOR+">2%</font>\n<font>金色圣物碎片x10  <font color= "+TIP_COLOR+">3%</font>\n<font>命运之骰x1  <font color= "+TIP_COLOR+">8%</font>\n<font>秘银x1  <font color= "+TIP_COLOR+">8%</font>\n<font>宝石x20  <font color= "+TIP_COLOR+">8.5%</font>\n<font>高级招募券x3  <font color= "+TIP_COLOR+">8.5%</font>\n<font>时空契约x1  <font color= "+TIP_COLOR+">8.5%</font>\n<font>圣物升级石x100  <font color= "+TIP_COLOR+">13%</font>\n<font>强化石x200  <font color= "+TIP_COLOR+">13%</font>\n<font>附魔石x5  <font color= "+TIP_COLOR+">13%</font>\n<font>神器原石x200  <font color= "+TIP_COLOR+">13%</font>"},_a[MODULE.Demon]={content:"<font>1、玩家可通过挖宝，概率搜到宝藏守卫，宝藏守卫出现后，玩家和好友<font color="+TIP_COLOR+">均可以挑战</font>。</font>\n<font>2、宝藏守卫出现后，在一定时间后会逃跑，所以玩家需要在<font color="+TIP_COLOR+">规定时间</font>内击杀该宝藏守卫获得丰厚奖励。</font>\n<font>3、每天玩家拥有<font color="+TIP_COLOR+">一定挑战次数体力</font>，每次挑战均有<font color="+TIP_COLOR+">挑战奖励</font>，当宝藏守卫被击杀后，发现者获得<font color="+TIP_COLOR+">归属奖励</font>（邮件发送），击杀者获得<font color="+TIP_COLOR+">击杀奖励</font>。</font>"},_a[MODULE.Vestage]={content:"<font>1.命运幻境每天拥有<font color="+TIP_COLOR+">2次</font>挑战次数；开始前，玩家需要从己方拥有的英雄中挑选<font color="+TIP_COLOR+">6名</font>英雄挑战幻境。</font>\n<font>2.幻境一共为<font color="+TIP_COLOR+">3章</font>，通过每章的最终BOSS，可进入下一章幻境。</font>\n<font>3.命运幻境中存在各种奇遇事件，主要包含 不明、商人、宝箱、营地、敌人、精英、头目等（详细查看图例）。</font>\n<font>4.每次战斗或者事件中英雄所剩余的血量都会<font color="+TIP_COLOR+">保存</font>，已阵亡的英雄<font color="+TIP_COLOR+">无法再参与战斗</font>，玩家可以在游戏过程中获得复活药和生命药，进行<font color="+TIP_COLOR+">复活</font>已阵亡的英雄/<font color="+TIP_COLOR+">恢复</font>英雄的血量。</font>\n<font>5.游戏过程中获得的英雄、遗物（buff），只在<font color="+TIP_COLOR+">本系统中生效</font>。</font>\n<font>6.玩家在本系统中所获得英雄<font color="+TIP_COLOR+">全部阵亡</font>后，本轮幻境结束，需要重新开始挑战。</font>\n<font>7.挑战每章最终BOSS后，打败头目，即可获得<font color="+TIP_COLOR+">丰厚的奖励</font>哦。</font>\n<font>8.达到<font color="+TIP_COLOR+">vip4</font>后，玩家可开启战斗跳过。</font>"},_a[MODULE.Manor]={content:"<font>矿脉争夺战于<font color="+TIP_COLOR+">开服第八天</font>开启，在<font color="+TIP_COLOR+">开服15天</font>时，进入战区玩法系统</font>\n<font>开启时间：<font color="+TIP_COLOR+">每周一、周三、周五的晚20：05至20：25</font>开启。</font>\n<font>基础规则</font>\n<font>1、玩家可以在矿区地图<font color="+TIP_COLOR+">寻找矿点占领</font>，每个玩家可以控制3个队伍分别占领矿点，在占领矿点会获得不同的积分和矿场货币，3个队伍<font color="+TIP_COLOR+">各自独立行动。</font>。矿点<font color="+TIP_COLOR+">品级越高产量就越高</font>，可以容纳的队伍就越多。</font>\n<font>2、当矿点采集队伍已满时，需要<font color="+TIP_COLOR+">挑战矿点中的其他玩家的队伍</font>腾出空位迁入矿中，玩家每次挑战<font color="+TIP_COLOR+">会根据玩家战斗力差距强制扣除一定体力</font>，另外在挑战中每阵亡一个英雄会额外扣除6点体力。</font>\n<font>3、玩家只有在安全区才能编辑队伍的阵容，不在安全区的队伍编辑的内容不会保存，更换前后排除外。</font>\n<font>占领矿点</font>\n<font>1、挑战其他的玩家会获得积分，占领矿点也会获得积分和矿场货币</font>\n<font>2、<font color="+TIP_COLOR+">第一个</font>进入矿中的公会视为<font color="+TIP_COLOR+">占领了矿点</font>，一旦一个公会占领了矿其余公会玩家进入<font color="+TIP_COLOR+">不影响占领权</font>。其他公会想要占领这个矿，需要把当前占领公会成员的队伍<font color="+TIP_COLOR+">全部打回安全区</font>。当占领公会成员被清除出矿点后，归属权会转移到矿点中<font color="+TIP_COLOR+">队伍数量最多的公会</font>，队伍数量相同时会随机转移。</font>\n<font>3、占领了矿点的公会，其<font color="+TIP_COLOR+">公会成员</font>在矿中会获得<font color="+TIP_COLOR+">25%的产量加成</font>，若矿中没有其他公会成员，则还会获得<font color="+TIP_COLOR+">25%额外的独占产量加成</font>。</font>"},_a[MODULE.LuckyTurntable]={content:"<font>1、每转1次可获得奖池中的随机一次奖励，<font color="+TIP_COLOR+">已获得的奖励</font>从奖池中消失</font>\n<font>2、玩家可以手动刷新奖池，在刷新后<font color="+TIP_COLOR+">24小时</font>将自动刷新</font>\n<font>3、免费刷新使用后，<font color="+TIP_COLOR+">3小时</font>将重新获得一次免费刷新次数</font>\n<font>4、道具获得概率:</font>\n<font>指定英雄碎片:<font color="+TIP_COLOR+">1%</font></font>\n<font>圣物/圣物碎片:<font color="+TIP_COLOR+">2%</font></font>\n<font>五星英雄碎片/五星精英碎片:<font color="+TIP_COLOR+">3%</font></font>\n<font>高级招募券/时空契约/命运之骰/秘银:<font color="+TIP_COLOR+">14%</font></font>\n<font>高级招募券/时空契约/命运之骰/秘银:<font color="+TIP_COLOR+">14%</font></font>\n<font>附魔石/宝石/强化石/经验水晶/金币/进阶石:<font color="+TIP_COLOR+">22%</font></font>\n<font>附魔石/宝石/强化石/经验水晶/金币/进阶石:<font color="+TIP_COLOR+">22%</font></font>\n<font>附魔石/宝石/强化石/经验水晶/金币/进阶石:<font color="+TIP_COLOR+">22%</font></font>\n"},_a[MODULE.Activity+EActivityType.EatingZongZi]={content:"<font>1、玩家可以通过<font color="+TIP_COLOR+">制粽活动</font>获得粽子。</font>\n<font>2、不同种类的粽子可以获得不同种类的道具。</font>\n<font>3、享用粽子可以获得<font color="+TIP_COLOR+">积分</font>，根据积分可以获得<font color="+TIP_COLOR+">成就奖励</font>和<font color="+TIP_COLOR+">排行奖励</font>。</font>"},_a[MODULE.Activity+EActivityType.DragonBoatGrade]={content:"<font>1、龙舟的初始速度为<font color="+TIP_COLOR+">每小时10米</font>，满足时间后自动前行。</font>\n<font>2、当龙舟完成了某一宝箱的距离要求后，玩家可领取该宝箱奖励。</font>\n<font>3、根据前行的距离，可获得<font color="+TIP_COLOR+">排名奖励</font>。</font>\n<font>4、鼓舞区分为<font color="+TIP_COLOR+">钻石助力</font>和<font color="+TIP_COLOR+">粽子助力</font>，均可使龙舟前行一定距离：</font>\n<font>鱼翅粽：单只粽子前行<font color="+TIP_COLOR+">100米</font>。</font>\n<font>肉粽：单只粽子前行<font color="+TIP_COLOR+">30米</font>。</font>\n<font>甜粽：单只粽子前行<font color="+TIP_COLOR+">10米</font>。</font>"},_a[MODULE.Activity+EActivityType.NewZoneGroupPurchase]={content:"<font>1、团购玩法为<font color="+TIP_COLOR+">跨服玩法</font>，团购中提供多种优惠道具。</font>\n<font>2、道具售出价格为当前折扣乘以道具原价格，当购买人数越多，则<font color="+TIP_COLOR+">优惠力度越大</font>，在活动结束后，按最终折扣价计算已买道具价格，并按<font color="+TIP_COLOR+">差额钻石数量以邮件方式返还给玩家</font>，无需担心先买吃亏的问题。</font>\n<font>3、每种道具有<font color="+TIP_COLOR+">一定的次数限制</font>，当购买次数使用尽后，无法再购买该类道具。</font>"},_a[MODULE.Activity+EActivityType.NewTurntable]={content:"<font>1、活动期间，玩家可通过登陆，邀请好友、首次充值等获取途径方式获得该转盘次数，抽取以下道具：</font>\n<font>橙色圣物碎片*50：<font color="+TIP_COLOR+">7%</font></font>\n<font>300钻石：<font color="+TIP_COLOR+">15%</font></font>\n<font>500钻石：<font color="+TIP_COLOR+">10%</font></font>\n<font>五星英雄碎片*50：<font color="+TIP_COLOR+">8%</font></font>\n<font>高级召唤券*5：<font color="+TIP_COLOR+">15%</font></font>\n<font>时空契约*2：<font color="+TIP_COLOR+">15%</font></font>\n<font>秘银*2：<font color="+TIP_COLOR+">15%</font></font>\n<font>命运之骰：<font color="+TIP_COLOR+">15%</font></font>\n<font>2、参与了该转盘活动的玩家，即可获得参与抽取实物奖品的机会，每天会在凌晨零点公布获奖名单，奖品包括了精美的<font color="+TIP_COLOR+">耳机</font>、<font color="+TIP_COLOR+">游戏机</font>、<font color="+TIP_COLOR+">智能手环</font>等奖品，请中奖的幸运玩家注意查收系统邮件，等待客服联系您提供相关的个人信息，我们会在活动结束后对实物奖励进行发放。\n</font>"},_a[MODULE.Activity+EActivityType.WishTree]={content:""},_a[MODULE.Activity+EActivityType.EverydayTurntable]={content:"<font>1、每日一赚可通过<font color="+TIP_COLOR+">当日登录</font>和<font color="+TIP_COLOR+">每日充值任意金额</font>获得转盘机会。</font>\n<font>2、转动转盘，每次获得奖励后，奖池不变。</font>\n<font>3、转盘每日更新，更新后转盘次数<font color="+TIP_COLOR+">不重置</font>，可累加。</font>\n<font>各个道具概率如下：</font>\n<font>时空契约*1：<font color="+TIP_COLOR+">15%</font></font>\n<font>高级召唤券*3：<font color="+TIP_COLOR+">15%</font></font>\n<font>经验水晶*3M：<font color="+TIP_COLOR+">15%</font></font>\n<font>金币*3M：<font color="+TIP_COLOR+">15%</font></font>\n<font>五星英雄碎片*50：<font color="+TIP_COLOR+">10%</font></font>\n<font>橙色圣物碎片*50：<font color="+TIP_COLOR+">10%</font></font>\n<font>洗练石*20：<font color="+TIP_COLOR+">10%</font></font>\n<font>钻石*500：<font color="+TIP_COLOR+">10%</font></font>"},_a[MODULE.Activity+EActivityType.ZoneFishing]={content:"<font>1、秘境垂钓共有三类道具：</font>\n<font><font color="+TIP_COLOR+">鱼竿</font>：分为三种品质，每种品质的鱼竿影响鱼的获得速度。</font>\n<font><font color="+TIP_COLOR+">鱼料</font>：分为三种品质，每种品质的鱼料影响所钓鱼的整体品质。</font>\n<font><font color="+TIP_COLOR+">鱼桶</font>：分为三种品质，每种品质的鱼桶装取鱼的容量不同（鱼桶收获的鱼满时将不再捕鱼，在收获之后，才可重新开始捕鱼），且越高品质的鱼桶越不容易被抢夺。</font>\n<font>2、钓鱼分为两种玩法：</font>\n<font><font color="+TIP_COLOR+">钓鱼模式</font>：所钓的鱼可进入捕鱼达人进行换取道具，同时，根据所收获鱼的积分进行排名，获得排名奖励。</font>\n<font><font color="+TIP_COLOR+">抢夺模式</font>：玩家可抢夺他人的鱼，概率性获得他人鱼桶里的各类鱼，并获得积分，另外，在记录里玩家可对他人进行复仇，进行抢夺。</font>"},_a[MODULE.Activity+EActivityType.MagpieActivity]={content:"<font>1.玩家可以通过<font color="+TIP_COLOR+">投骰/遥控骰</font>进行游戏。</font>\n<font>2.投骰：随机获得<font color="+TIP_COLOR+">1~6</font>的点数中的一个数字，作为遇到步数。</font>\n<font>3.遥控骰：玩家可进行<font color="+TIP_COLOR+">选择</font>对应的点数，本次投骰必为该点数。</font>\n<font>4.玩家通过投骰点数进行移动到对应的格子，从而获得该格子的<font color="+TIP_COLOR+">奖励</font>。</font>\n<font>5.格子：主要分为 NPC对话、猜拳、开宝箱，以及道具奖励。</font>\n<font>6.NPC对话：当走到NPC的格子时，会触发和该NPC相关的事情，完成NPC的任务时，可获得<font color="+TIP_COLOR+">丰厚的奖励</font>哦！</font>\n<font>7.猜拳：通过划拳小游戏，胜利则可获得<font color="+TIP_COLOR+">奖励</font>。</font>"},_a[MODULE.StormWar]={content:"<font>1.风暴战场于<font color="+TIP_COLOR+">开服第八天</font>开启，15天进入战区玩法系统。</font>\n<font>2.活动开启后，每周二、周四、周六的<font color="+TIP_COLOR+">晚20:05~20:25</font>可进入风暴战场。</font>\n<font>3.风暴战场分为<font color="+TIP_COLOR+">8层</font>，层数越高，<font color="+TIP_COLOR+">每60秒</font>挂机产出的奖励越好。</font>\n<font>4.击败对手/怪物时，可晋级下一层；挑战失败（攻守）时，则掉落一层。</font>\n<font>5.击败对手/怪物时，可获得积分，层数越高积分越多，连胜场次越高，挑战获得的积分越多。</font>\n<font>6.连胜机制只针对玩家，和怪物无关，即怪物<font color="+TIP_COLOR+">不影响</font>连胜或中断连胜，以及连胜的积分产出。</font>\n<font>7.积分达到对应的目标时，可在成就中领取对应的奖励。</font>\n<font>8.<font color="+TIP_COLOR+">第一个</font>达到第8层的玩家为本轮风暴战场的冠军，每过<font color="+TIP_COLOR+">60秒</font>时，冠军可获得额外的挂机产出收益；冠军被击败时，胜利一方可成为新的冠军。</font>"},_a[MODULE.RiskMulti]={content:"<font>1.每名到达<font color="+TIP_COLOR+">%s级</font>的玩家可邀请其它满足条件的玩家或者进入他人组队进行组队挂机。</font>\n<font>2.当且仅当两人及以上时，该组队挂机加成方可生效（人数越多，整体挂机收益越大），组队挂机期间，个人挂机产出受到增益。</font></font>\n<font>3.玩家仅能邀请比自己低于XX级的玩家进行组队挂机，且根据等级进行挂机排序，在组队中，级数越大的玩家，所获得的挂机加成收益越大。</font>\n<font>4.在其他组队的玩家，在<font color="+TIP_COLOR+">%s小时后</font>，将自动退出该组队。</font>"},_a[MODULE.TribeBattle]={content:"<font>1.角色等级达到<font color="+TIP_COLOR+">60级</font>，开服<font color="+TIP_COLOR+">第3天</font>可开启部落争霸玩法。</font>\n<font>2.开启时间为<font color="+TIP_COLOR+"> 周一、三、五的12：00~20：00。</font></font>\n<font>3.<font color="+TIP_COLOR+">开服第14天</font>后，部落争霸玩法加入战区。</font>\n<font>4.活动开启后，玩家会在所在公会累计积累积分，积分用于个人排行和公会排行，最后根据积分进行发放奖励。</font>\n<font>5.活动开启期间，玩家可通过消耗挑战次数进行挑战其他公会的成员抢夺积分。</font>\n<font>6.玩家可根据复仇中查看仇人，从而进行复仇，消耗复仇次数。</font>\n<font>7.活动期间退出公会后，旧公会的总积分不变，个人积分不变；新加入公会后，自身拥有的积分不累计新公会上，新累计和抢夺部分方可累计到新公会。</font>\n<font>8.活动结束后，根据<font color="+TIP_COLOR+">个人积分</font>和<font color="+TIP_COLOR+">公会积分排名</font>，进行发放奖励（邮件方式发放）。</font>"},_a[MODULE.HeroSpirit]={content:"<font>1、英魂往事分为多个章节，到达相应的<font color="+TIP_COLOR+">等级</font>和满足<font color="+TIP_COLOR+">前一章的激活页数</font>，则可以开启新的章节。</font>\n<font>2、英魂往事中各个章节激活的能力属性将作用于<font color="+TIP_COLOR+">上阵英雄</font>，提升上阵英雄的属性能力。</font>\n<font>3、英魂单独于英雄，所获得的英魂将收录在<font color="+TIP_COLOR+">英魂往事的背包</font>中，不在其它地方显示。</font>\n<font>4、英魂可在<font color="+TIP_COLOR+">矿脉争夺战</font>的商店购买获取，满足条件后可<font color="+TIP_COLOR+">激活</font>英魂往事的属性加成。</font>"},_a[MODULE.PeakWar]={content:"<font>1、巅峰竞技场在开服15天且玩家达到70级时开启，该玩法分为<font color="+TIP_COLOR+">挑战赛</font>和<font color="+TIP_COLOR+">天梯赛</font>。</font>\n<font>2、挑战赛：<font color="+TIP_COLOR+">周一</font>至<font color="+TIP_COLOR+">周六</font>全天开启，可挑战玩家获取相应积分，并可领取当前挑战赛期间的<font color="+TIP_COLOR+">挑战胜利次数奖励</font>。结算时<font color="+TIP_COLOR+">根据积分</font>排名获取奖励，并且<font color="+TIP_COLOR+">前100名</font>的玩家将<font color="+TIP_COLOR+">进入天梯赛</font>。</font>\n<font>3、天梯赛：周日<font color="+TIP_COLOR+">晚20：05-晚20：25</font>开启，挑战赛结算时前100名为天梯赛初始排名。获得资格的选手可挑战其它玩家，挑战胜利则与该挑战玩家<font color="+TIP_COLOR+">互换排名</font>，若失败则排名不变。天梯赛结束后，将发放排名奖励。</font>"},_a);!function(i){var e=function(){function e(){}return e.registerAll=function(){(new n).register(),(new o).register(),(new a).register(),(new r).register(),(new t).register(),(new s).register()},e}();i.HeroProcessor=e,__reflect(e.prototype,"game.HeroProcessor");var t=function(e){function t(){return e.call(this,"hero.HeroResonateInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N).updateResonateList(t.resonateList)},t}(i.ProcessorBase);i.HeroResonateInfoP=t,__reflect(t.prototype,"game.HeroResonateInfoP");var n=function(e){function t(){return e.call(this,"gashapon.ReFreeTimesP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N).gashaponInfo[t.info.type]=t.info},t}(i.ProcessorBase);i.ReFreeTimesP=n,__reflect(n.prototype,"game.ReFreeTimesP");var o=function(e){function t(){return e.call(this,"hero.HeroInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N).updateHeroDict(t.heroList),i.AppFacade.getInstance().updateView(i.HeroMediator.N,i.HeroMediator.SV.MAIN)},t}(i.ProcessorBase);i.HeroInfoP=o,__reflect(o.prototype,"game.HeroInfoP");var a=function(e){function t(){return e.call(this,"hero.HeroPutOnInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N).updateHeroDict(t.heroList)},t}(i.ProcessorBase);i.HeroPutOnInfoP=a,__reflect(a.prototype,"game.HeroPutOnInfoP");var r=function(e){function t(){return e.call(this,"hero.HeroHistoryListP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N).updateHeroHistoryInfo(t.historyList)},t}(i.ProcessorBase);i.HeroHistoryListP=r,__reflect(r.prototype,"game.HeroHistoryListP");var s=function(e){function t(){return e.call(this,"hero.SingleHeroInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();i.GameMVC.heroPy.updateHeroDict(t.hero)},t}(i.ProcessorBase);i.SingleHeroInfoP=s,__reflect(s.prototype,"game.SingleHeroInfoP")}(game||(game={})),function(y){var e=function(t){function m(){var e=t.call(this,m.N)||this;return e.allHeroNum=0,e.canMakeGasha=!0,e.gashaponInfo={},e.allHeroByUuid={},e.heroUuid22Pos={},e.heroHistoryInfo={},e.resonateList={},e.replaceHeroInfo={uuid:void 0,code:void 0},e.waitingServOper={},e.addNotice(),e}return __extends(m,t),m.prototype.addNotice=function(){var e=this;NoticeManager.registerCB([NT.HERO_ARTIFACT],this.checkHeroArtifactNotice,this),NoticeManager.registerCB([NT.HERO_ARTIFACT_RESONATE],this.checkHeroArtifactResonateNotice,this,MODULE.HeroArtifactResoante),NoticeManager.registerCB([NT.HERO_TREASURE],this.checkTreasureNotice,this),NoticeManager.registerCB([NT.HERO_UPSTAIR],this.checkUpstarNotice,this),NoticeManager.registerCB(NT.HERO_RESONATE_RESONATE,this.checkResonateNotice,this),NoticeManager.registerCB(NT.HERO_RESONATE_UNLOCK,this.checkResonateUnlockNotice,this,MODULE.HeroAwaken),NoticeManager.registerCB([NT.HERO_UPSECTION],this.checkUpSectionNotice,this),NoticeManager.registerCB(NT.HERO_EQUIP,this.checkHeroEquipNotice,this),NoticeManager.registerCB(NT.HERO_CAN_FORMATION,this.checkFormationNotice,this),NoticeManager.setChildType(NT.HERO_THING,[NT.HERO_ARTIFACT,NT.HERO_TREASURE]),NoticeManager.setChildType(NT.HERO_THING,NT.HERO_EQUIP),NoticeManager.setChildType(NT.HERO_THING,NT.HERO_ARTIFACT_RESONATE),NoticeManager.setChildType(NT.HERO_RESONATE,[NT.HERO_RESONATE_RESONATE,NT.HERO_RESONATE_UNLOCK]),NoticeManager.setChildType(NT.STAR_DOOR_ENTRANCE,[NT.GASHA_RACE_TIMES]),NoticeManager.setChildType(NT.GASHA_ENTRANCE,[NT.GASHA_FREE,NT.GASHA_HIGH_TIMES]),NoticeManager.registerCB(NT.GASHA_FREE,this.checkGashaNotice,this),NoticeManager.registerCB(NT.GASHA_HIGH_TIMES,function(){return e.checkGashaTimeRewardNotice(GashaponType.High)},this),NoticeManager.registerCB(NT.GASHA_RACE_TIMES,function(){return e.checkGashaTimeRewardNotice(GashaponType.Race)},this)},m.prototype.updateGashaInfo=function(e){(this.gashaponInfo[e.type]=e).type===GashaponType.High?NoticeManager.updateNotice(NT.GASHA_HIGH_TIMES):e.type===GashaponType.Race&&NoticeManager.updateNotice(NT.GASHA_RACE_TIMES)},m.prototype.GetUserGashaponInfos=function(){var t=this;Utils.Socket.send("gashapon","GetUserGashaponInfos",{}).then(function(e){e.infos.forEach(function(e){t.updateGashaInfo(e)})})},m.prototype.MakeProgressGashapon=function(){var t=this;Utils.Socket.send("gashapon","MakeProgressGashapon",{entryCode:3}).then(function(e){e.err||(t.updateGashaInfo(e.info),y.AppFacade.getInstance().updateView(y.HeroMediator.N,y.HeroMediator.SV.GACHA),y.AppFacade.getInstance().showSubView(y.HeroMediator.N,y.HeroMediator.SV.GACHA_RESULT,{type:2,subType:0,result:e.clientReward,rewards:e.clientReward.heros,isGacha:!0}))}).catch(function(e){t.log(e)})},m.prototype.GetTimesRewards=function(e,t,i){var n=this;Utils.Socket.send("gashapon","GetTimesRewards",{type:e,code:t}).then(function(e){y.GameMVC.backpackPy.handleClientReward(e.clientReward),n.updateGashaInfo(e.info),i&&i()})},m.prototype.MakeGashapon=function(t){var i=this;if(this.canMakeGasha){this.canMakeGasha=!1;var e=y.Config.gashaponEntry(),n=0;for(var o in e){var a=e[o];if(a.type==t.type&&a.subType==t.subType&&a.times==t.times){n=a.code;break}}n?Utils.Socket.send("gashapon","MakeGashapon",{entryCode:n}).then(function(e){i.updateGashaInfo(e.info),t.type!=GashaponType.Race?y.AppFacade.getInstance().updateView(y.HeroMediator.N,y.HeroMediator.SV.GACHA):y.AppFacade.getInstance().updateView(y.HeroMediator.N,y.HeroMediator.SV.STARDOOR),y.AppFacade.getInstance().showSubView(y.HeroMediator.N,y.HeroMediator.SV.GACHA_RESULT,{type:t.type,subType:t.subType,result:e.clientReward,rewards:e.rewardShow,entryCode:n,isGacha:!1}),NoticeManager.updateNotice(NT.GASHA_FREE,void 0,!0),t.type===GashaponType.High?NoticeManager.updateNotice(NT.GASHA_HIGH_TIMES,GashaponType.High):t.type===GashaponType.Race&&NoticeManager.updateNotice(NT.GASHA_RACE_TIMES,GashaponType.Race)}).catch(function(e){i.canMakeGasha=!0}):Utils.MsgUtils.addMidMsg("没有code")}},m.prototype.checkGashaNotice=function(){return!(!this.gashaponInfo[GashaponType.Lower]||!this.gashaponInfo[GashaponType.Lower].freeTimes)||!(!this.gashaponInfo[GashaponType.High]||!this.gashaponInfo[GashaponType.Lower].freeTimes)},m.prototype.checkGashaTimeRewardNotice=function(e){var t=this.gashaponInfo[e];if(!t)return!1;var i=y.Config.gashaponTimes();for(var n in i){var o=i[n];if(o.type==e&&t.hTimes>=o.times&&t.timesTargeted.indexOf(o.code)<0)return!0}return!1},m.prototype.updateHeroDict=function(e){var i=this;Array.isArray(e)||(e=[e]),e.forEach(function(e){if(i.allHeroByUuid[e.uuid])i.allHeroByUuid[e.uuid].update(e);else{var t=new y.HeroVO(e);i.allHeroByUuid[e.uuid]=t}i.heroUuid22Pos[e.uuid]?e.pos?e.pos!=i.heroUuid22Pos[e.uuid]&&(i.heroUuid22Pos[i.heroUuid22Pos[e.uuid]]==e.uuid&&delete i.heroUuid22Pos[i.heroUuid22Pos[e.uuid]],i.heroUuid22Pos[e.uuid]=e.pos,i.heroUuid22Pos[e.pos]=e.uuid):(i.heroUuid22Pos[i.heroUuid22Pos[e.uuid]]==e.uuid&&delete i.heroUuid22Pos[i.heroUuid22Pos[e.uuid]],delete i.heroUuid22Pos[e.uuid]):0!=e.pos&&(i.heroUuid22Pos[e.uuid]=e.pos,i.heroUuid22Pos[e.pos]=e.uuid)}),this.allHeroNum=Object.keys(this.allHeroByUuid).length,y.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE)},m.prototype.updateHeroHistoryInfo=function(e){var t=this;e.forEach(function(e){t.heroHistoryInfo[e.code]=e})},m.prototype.deteleByUuids=function(e){var t=this;e.forEach(function(e){delete t.allHeroByUuid[e]}),this.allHeroNum-=e.length},m.prototype.updateResonateList=function(e){var n=this;this.resonateList={},e.forEach(function(e){var t=e.subType,i=e.order;n.resonateList[t]||(n.resonateList[t]=[]),n.resonateList[t].push(i)})},m.prototype.getActivatedHaloId=function(e,n){void 0===n&&(n=!1);var h,o=["slot1","slot2","slot3","slot4","slot5","slot6"];h=n?y.Config.chessHero():y.Config.allHeroConfig();var a=y.Config.heroHaloConfig(),p=[],t=function(e){var t=a[e];if(n==(t.haloType==HaloType.Chess)){var i=[];o.forEach(function(e){t[e]&&i.push(t[e])}),p.push({id:t.id,type:t.type,codes:i})}};for(var i in a)t(i);var d=[];return e.forEach(function(e){for(var t=h[e]||y.Config.allPetConfig()[e],i=t.race,n=t.subProfession||t.profession,o=p.length;o--;){var a=p[o],r=a.id,s=a.type,c=a.codes,l=-1;s==HeroHaloType.Profession?l=c.indexOf(n):s==HeroHaloType.Race&&(l=c.indexOf(i)),-1<l&&c.splice(l,1),c.length||(d.push(r),p.splice(o,1))}}),d.sort(function(e,t){return e-t}),d},m.prototype.getHeroResonateOrders=function(e){var t=[];t=t.concat(e.resonate);var i=e.config.subType;return this.resonateList[i]&&(t=t.concat(this.resonateList[i])),t},m.prototype.checkJingYing=function(e){return e instanceof y.HeroVO?e.config.tier<3:y.Config.allHeroConfig()[e].tier<3},m.prototype.showCurHeroHalo=function(){for(var e=[],t=1;t<=6;t++){var i=this.heroUuid22Pos[t];i&&e.push(this.allHeroByUuid[i].config.code)}y.AppFacade.getInstance().showSubView(y.HeroMediator.N,y.HeroMediator.SV.HERO_HALO,{codeList:e})},m.prototype.GetHeroInfo=function(){var t=this;Utils.Socket.send("hero","GetHeroInfo",{}).then(function(e){t.updateHeroDict(e.heroList),t.HeroHistoryListlength=e.historyList.length,t.updateHeroHistoryInfo(e.historyList),t.updateResonateList(e.resonateList),y.AppFacade.getInstance().updateView(y.HeroMediator.N,y.HeroMediator.SV.MAIN)})},m.prototype.HeroPutOn=function(t){var i=this;Utils.Socket.send("hero","HeroPutOn",{uuid:t.uuid,pos:t.pos}).then(function(e){i.updateHeroDict(e.heroList),y.AppFacade.getInstance().updateView(y.HeroMediator.N,y.HeroMediator.SV.MAIN,{uuid:t.uuid,upstarData:{}}),i.GetHeroInfo()})},m.prototype.HeroChangeFormation=function(e){var t=this;Utils.Socket.send("hero","HeroChangeFormation",{formation:JSON.stringify(e)}).then(function(e){t.updateHeroDict(e.heroList)})},m.prototype.HeroUpGrade=function(n){var o=this;Utils.Socket.send("hero","HeroUpGrade",{uuid:n.uuid,num:n.num}).then(function(e){o.waitingServOper.upgrade=!1;var t=function(e){for(var t=JSON.parse(e.attr),i={},n=1;n<=4;n++)i[n]=t[n];return i},i=t(o.allHeroByUuid[n.uuid]);o.updateHeroDict(e.hero),y.AppFacade.getInstance().updateView(y.HeroMediator.N,y.HeroMediator.SV.MAIN),n.cb&&n.cb(i,t(o.allHeroByUuid[n.uuid]))}).catch(function(e){o.waitingServOper.upgrade=!1})},m.prototype.HeroUpStar=function(o,e){var a=this;if(void 0===e&&(e=!0),e){var t=[];o.uuidInfos.forEach(function(e){t.push(e.uuid)});var i=y.GameMVC.backpackPy.checkMultiTeamTips(t);i?y.GameMgr.getInstance().showCommonTipsWin({commonTips:"选中的英雄中"+i.name+"在"+i.teamModuleName+"上阵，是否作为材料消耗？",clickCB:function(e){1==e.type&&a.HeroUpStar(o,!1)}}):this.HeroUpStar(o,!1)}else Utils.Socket.send("hero","HeroUpStar",{uuid:o.uuid,uuidInfos:o.uuidInfos}).then(function(e){var t=a.allHeroByUuid[o.uuid],i={code:t.code,sectionLevel:t.sectionLevel,attr:JSON.parse(t.attr),skillList:t.skillList},n={code:e.hero.code,sectionLevel:e.hero.sectionLevel,attr:JSON.parse(e.hero.attr),skillList:e.hero.skillList};o.cb&&o.cb(i,n),a.updateHeroDict(e.hero),egret.setTimeout(function(){y.AppFacade.getInstance().updateView(y.HeroMediator.N,y.HeroMediator.SV.MAIN,{upstarData:{}}),PopUpManager.addPopUp({obj:new y.HeroUpResultPanel({oldData:i,newData:n,type:"HeroUpStar"})})},a,1e3)})},m.prototype.HeroUpSection=function(o){var a=this;Utils.Socket.send("hero","HeroUpSection",{uuid:o.uuid}).then(function(e){var t=a.allHeroByUuid[o.uuid],i={code:t.code,sectionLevel:t.sectionLevel,attr:JSON.parse(t.attr),skillList:t.skillList},n={code:e.hero.code,sectionLevel:e.hero.sectionLevel,attr:JSON.parse(e.hero.attr),skillList:e.hero.skillList};a.updateHeroDict(e.hero),y.AppFacade.getInstance().updateView(y.HeroMediator.N,y.HeroMediator.SV.MAIN),y.AppFacade.getInstance().hideSubView(y.HeroMediator.N,y.HeroMediator.SV.SECTION),PopUpManager.addPopUp({obj:new y.HeroUpResultPanel({oldData:i,newData:n,type:"HeroUpSection"})})})},m.prototype.HeroResonate=function(t){var i=this;Utils.Socket.send("hero","HeroResonate",{uuid:t.uuid,order:t.order}).then(function(e){i.updateHeroDict(e.hero),i.updateResonateList(e.resonateList),y.AppFacade.getInstance().updateView(y.HeroMediator.N,y.HeroMediator.SV.MAIN),t.cb&&t.cb()})},m.prototype.UnlockHeroResonate=function(t,e){var i=this;if(void 0===e&&(e=!0),e){var n=y.GameMVC.backpackPy.checkMultiTeamTips(t.uuids);n?y.GameMgr.getInstance().showCommonTipsWin({commonTips:"选中的英雄中"+n.name+"在"+n.teamModuleName+"上阵，是否作为材料消耗？",clickCB:function(e){1==e.type&&i.UnlockHeroResonate(t,!1)}}):this.UnlockHeroResonate(t,!1)}else Utils.Socket.send("hero","UnlockHeroResonate",{uuid:t.uuid,level:t.level,uuids:t.uuids}).then(function(e){i.updateHeroDict(e.hero),y.AppFacade.getInstance().updateView(y.HeroMediator.N,y.HeroMediator.SV.MAIN),DragonBoneTools.playOnce({effectName:"common_jxcg",parent:GameRootLayer.gameLayer().popMsgLayer}),t.cb&&t.cb(e)})},m.prototype.HeroPractice=function(t,e){var i=this;if(void 0===e&&(e=!0),e){var n=y.GameMVC.backpackPy.checkMultiTeamTips(t.uuids);n?y.GameMgr.getInstance().showCommonTipsWin({commonTips:"选中的英雄中"+n.name+"在"+n.teamModuleName+"上阵，是否作为材料消耗？",clickCB:function(e){1==e.type&&i.HeroPractice(t,!1)}}):this.HeroPractice(t,!1)}else Utils.Socket.send("hero","HeroPractice",{uuid:t.uuid}).then(function(e){i.updateHeroDict(e.hero),y.AppFacade.getInstance().updateView(y.HeroMediator.N,y.HeroMediator.SV.MAIN),DragonBoneTools.playOnce({effectName:"common_xlcg",parent:GameRootLayer.gameLayer().popMsgLayer}),t.cb&&t.cb(e)})},m.prototype.HeroOneKeyPutOn=function(e,i){var n=this;Utils.Socket.send("hero","HeroOneKeyPutOn",{uuid:e}).then(function(e){n.updateHeroDict(e.hero);var t=y.AppFacade.getInstance().retrieveProxy(y.HeroThingPy.N);t.updateEquipInfo(e.heroEquipList),t.updateArtifactInfo(e.heroArtifactList),t.updateTreasureInfo(e.treasureList),y.AppFacade.getInstance().updateView(y.HeroMediator.N,y.HeroMediator.SV.MAIN),i&&i()})},m.prototype.HeroOneKeyPutDown=function(e){var i=this;Utils.Socket.send("hero","HeroOneKeyPutDown",{uuid:e}).then(function(e){i.updateHeroDict(e.hero);var t=y.AppFacade.getInstance().retrieveProxy(y.HeroThingPy.N);t.updateEquipInfo(e.heroEquipList),t.updateArtifactInfo(e.heroArtifactList),t.updateTreasureInfo(e.treasureList),y.AppFacade.getInstance().updateView(y.HeroMediator.N,y.HeroMediator.SV.MAIN)})},m.prototype.getReplaceInfo=function(){var t=this;Utils.Socket.send("replacement","GetReplaceInfo",{}).then(function(e){e.info&&e.info.uuid&&t.affirmReplaceHero({uuid:e.info.uuid,isReplace:!0,isInit:!0})}).catch(function(e){})},m.prototype.replaceHero=function(e){var t=this;Utils.Socket.send("replacement","ReplaceHero",{uuid:e.uuid}).then(function(e){t.replaceHeroInfo={uuid:e.info.uuid,code:e.info.code},y.AppFacade.getInstance().updateView(y.HeroMediator.N,y.HeroMediator.SV.HERO_REPLACEMENT,{costs:e.clientCost,isReplace:!0,effect:y.HeroReplacementView.EFFECT_TYPE.CHENGGONG}),t.affirmReplaceHero({uuid:e.info.uuid,isReplace:!0})}).catch(function(e){})},m.prototype.affirmReplaceHero=function(a){var r=this;Utils.Socket.send("replacement","AffirmReplaceHero",{uuid:a.uuid,isReplace:a.isReplace}).then(function(e){if(!a.isInit){var t=e.info&&e.info.uuid,i=e.info&&e.info.code;r.replaceHeroInfo={uuid:t,code:i};var n=!0===a.isReplace?e.clientReward.heros[0]:{uuid:a.uuid},o=!0===a.isReplace?y.HeroReplacementView.EFFECT_TYPE.QIAN:y.HeroReplacementView.EFFECT_TYPE.CHENGGONG;egret.setTimeout(function(){y.AppFacade.getInstance().updateView(y.HeroMediator.N,y.HeroMediator.SV.HERO_REPLACEMENT,{hero:n,effect:o}),y.AppFacade.getInstance().updateView(y.HeroMediator.N,y.HeroMediator.SV.STARDOOR)},r,750),Utils.MsgUtils.addMidMsg("英雄置换成功")}}).catch(function(e){})},m.prototype.HeroRollback=function(t){Utils.Socket.send("hero","HeroRollback",{uuid:t.uuid}).then(function(e){t.cb(function(){y.AppFacade.getInstance().retrieveProxy(y.BackpackPy.N).handleClientReward(e.clientReward)})}).catch(function(e){})},m.prototype.HeroRollbackPreview=function(t){Utils.Socket.send("hero","HeroRollbackPreview",{uuid:t.uuid}).then(function(e){y.AppFacade.getInstance().showSubView(y.CommonMediator.N,y.CommonMediator.SV.REWARD_PANEL,{title:"奖励",rewards:e.rewardPreview,btnText:"确定",type:y.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN}),t.cb&&t.cb()}).catch(function(e){})},m.prototype.ActiveArtifactResonate=function(t){var i=this;Utils.Socket.send("hero","ActiveArtifactResonate",{uuid:t.uuid,color:t.color}).then(function(e){i.updateHeroDict(e.hero),t.cb&&t.cb()}).catch(function(e){})},m.prototype.checkFormationNotice=function(e){if(this.heroUuid22Pos[e]||!Utils.UnlockMgr.checkPass(e,!1).allow)return!1;for(var t in this.allHeroByUuid){if(!this.allHeroByUuid[t].pos)return!0}},m.prototype.checkUpSectionNotice=function(e){if(!e)return!1;var t=e.config,i=y.Config.heroAndPetSectionConfig()[e.sectionLevel+1];if(e.level==t.maxLevel)return!1;var n=e.config;if(e.level==Math.min(n.maxLevel,i&&i.level||9999999)){var o=JSON.parse(i.costs);return!!y.AppFacade.getInstance().retrieveProxy(y.BackpackPy.N).checkEnough(o,!1)}return!1},m.prototype.checkResonateNotice=function(e){var o=this;if(!e)return!1;var t=e.resonateLevelList[e.resonateLevelList.length-1]||0,i=y.Config.heroResonateConfig(e.config.subType,t),a=this.getHeroResonateOrders(e),r=!1;return i.forEach(function(e){var t=0<=a.indexOf(e.order),i=JSON.parse(e.heroId),n=!0;i.forEach(function(e){o.heroHistoryInfo[e]||(n=!1)}),r=r||!t&&n}),r},m.prototype.checkResonateUnlockNotice=function(t){if(!t)return!1;var e=t.resonateLevelList[t.resonateLevelList.length-1]||0;if(this.getHeroResonateOrders(t).length<4*(e+1))return!1;var i=t.config.subType,n=y.Config.heroPracticeConfig(t.config.subType,e),o=void 0;if(!n.length)return!1;if(n.some(function(e){if(e.order===t.practiceLevel+1)return o=e,!0})){if(t.config.initStar<o.starLevel)return!1;if(!y.GameMVC.backpackPy.checkEnough(JSON.parse(o.costs)))return!1}else{var a=y.Config.heroResonateLevelConfig(i,e+1);if(t.config.initStar<a.starLevel)return!1;var r=a.selfNum,s=0;for(var c in this.allHeroByUuid){var l=this.allHeroByUuid[c];if(!l.pos&&l.uuid!=t.uuid&&l.config.subType===i&&5===l.config.initStar&&!l.isLocked&&(s+=1)===r)break}if(s<r)return!1;if(!y.GameMVC.backpackPy.checkEnough(JSON.parse(a.costs)))return!1}return!0},m.prototype.checkHeroEquipNotice=function(e){if(!e||!e.info)return!1;var t=e.info.uuid,i=y.AppFacade.getInstance().retrieveProxy(y.HeroThingPy.N).AllEquipInfo,n=y.Config.getHeroEquipConfig();if(!Utils.UnlockMgr.checkPass(MODULE.HeroEquip,!1).allow)return!1;var o=e.type,a=0,r=-1;for(var s in i){var c,l=i[s];if(l.type==o&&l.heroUuid==t)r=(c=n[l.code])&&c.color;if(l.type==o&&!l.heroUuid)(c=n[l.code])&&(a=c.color>a?c.color:a)}return 0<a&&r<a},m.prototype.checkHeroArtifactNotice=function(e){if(!e)return!1;y.Config.getHeroArtifactUnlockLevel();if(!Utils.UnlockMgr.checkPass(MODULE.HeroArtifact,!1).allow)return!1;var t=e.uuid,i=y.AppFacade.getInstance().retrieveProxy(y.HeroThingPy.N).AllArtiInfo,n=y.Config.getHeroArtifactConfig(),o=0,a=-1;for(var r in i){var s,c=i[r];if(c.heroUuid==t)a=(s=n[c.code])&&s.color;if(!c.heroUuid)(s=n[c.code])&&s.type==HeroArtifactType.Normal&&e.level>=s.putOnLevel&&(o=s.color>o?s.color:o)}return 0<o&&a<o},m.prototype.checkHeroArtifactResonateNotice=function(e){var t=e.heroInfo,i=!1;if(!e.inTab){var n=y.GameMVC.heroThingPy.getHeroArtifactByHeroUuid(t.uuid);if(n.length){var o=n[0].config.color,a=y.Config.heroArtifactResonate(t.config.subType);for(var r in a){var s=a[r];if(s.color<=o&&t.artifactResonate.indexOf(s.color)<0){i=!0;break}}}}return i},m.prototype.checkTreasureNotice=function(e){if(!e)return!1;if(!Utils.UnlockMgr.checkPass(MODULE.Treasure,!1).allow)return!1;var t,i=e.uuid,n=y.AppFacade.getInstance().retrieveProxy(y.HeroThingPy.N).AllTreasureInfo;for(var o in n){var a=n[o];a.heroUuid==i&&(t=a)}if(t){var r=!1;for(var o in TreasureJewelType){var s=TreasureJewelType[o];if(!(d=y.Config.getTreasureLockInfo(s,e.level))){var c=t.jewelLevel&&t.jewelLevel[s]||0,l=y.Config.getTreasureJewelUpgradeConfig(s);if(!l[0<=c?c:0])return!1;var h=l[c+1];if(h){var p=JSON.parse(h.costs);r=r||y.AppFacade.getInstance().retrieveProxy(y.BackpackPy.N).checkEnough(p)}}}return r}var d=y.Config.getHeroTreasureUnlockLevel();return e.level>=d},m.prototype.checkUpstarNotice=function(a,l){if(void 0===l&&(l={}),!a)return!1;var r=y.Config.allHeroConfig();if(!r[a.code])return!1;if(r[a.code].initStar<=3)return!1;var s=y.AppFacade.getInstance().retrieveProxy(m.N),h=s.allHeroByUuid,e=y.Config.heroAndPetUpstarConfig()[a.code];if(!e)return!1;var t=e.level;if(y.AppFacade.getInstance().retrieveProxy(y.PlayerPy.N).playerInfoVO.level<t)return!1;var i=JSON.parse(e.fiveSlotCosts);if(0<i.length&&!y.AppFacade.getInstance().retrieveProxy(y.BackpackPy.N).checkEnough(i[1],!1))return!1;var p=[],d=[],n=["oneSlotCosts","twoSlotCosts","threeSlotCosts","fourSlotCosts"];for(var o in n){var c=n[o];l[parseInt(o)+1]={condition:e[c],uuids:[],full:!1},p.push(JSON.parse(e[c])),d.push(0)}var u=0;p.forEach(function(e){1==e[0]&&(u=e[1][0],e[1]=e[1][0])}),p.forEach(function(e,t){if(0<e.length)for(var i in h){var n=h[i];if(i!=a.uuid&&!s.heroUuid22Pos[i]&&!n.isLocked)if(1==e[0])n.code==e[1][1]&&(d[t]++,l[t+1]&&l[t+1].uuids||(l[t+1]={},l[t+1].uuids=[]),l[t+1].uuids.push(n.uuid));else if(2==e[0]){var o=r[n.code];0!=e[1][0]&&o.race!=e[1][0]||0!=e[1][1]&&n.starLevel!=e[1][1]||0!=e[1][2]&&o.profession!=e[1][2]||(d[t]++,l[t+1]&&l[t+1].uuids||(l[t+1]={},l[t+1].uuids=[]),n.code!=u[1]?l[t+1].uuids.push(n.uuid):l[t+1].uuids.unshift(n.uuid))}}});var g=!0,f=u&&r[u[1]].initStar,_=function(e){var i=parseInt(e)+1,t=p[e];if(0==t.length)return"continue";if(f&&2==t[0]&&t[1][1]==f){if(d[e]<t[1][3]+u[2])return g=!1,"break";var n=[],o=function(e){var t=l[i].uuids[e];l[1].uuids.some(function(e){return e==t})||n.push(t)};for(var a in l[i].uuids)o(a);var r={};for(var s in h){var c=h[s];r[c.code]||(r[c.code]=0),r[c.code]++}r[u[1]]&&(r[u[1]]-=u[2]),n.sort(function(e,t){return r[h[e].code]-r[h[t].code]}),n=n.slice(0,t[1][3]),l[i].uuids=n}else if(1==t[0]){if(d[e]<t[1][2])return g=!1,"break";l[i].uuids&&(l[i].uuids=l[i].uuids.slice(0,t[1][2]))}else{if(d[e]<t[1][3])return g=!1,"break";l[i].uuids&&(l[i].uuids=l[i].uuids.slice(0,t[1][3]))}};for(var o in p){if("break"===_(o))break}if(g)for(var o in l){(c=l[o]).full=!0}return g},m.prototype.getMaxLevelByCodeAndSection=function(e,t){var i=y.Config.allHeroConfig()[e];y.Config.heroAndPetSectionConfig()[t+1];return i?i.maxLevel:0},m.N="HeroPy",m}(BaseProxy);y.HeroPy=e,__reflect(e.prototype,"game.HeroPy")}(game||(game={})),function(a){var e=function(i){function e(e){var t=i.call(this)||this;return t.skinName="BaseItemDetailViewSkin",t.params=e,t.backpackProxy=a.AppFacade.getInstance().retrieveProxy(a.BackpackPy.N),t.config=a.GeneralConfig.getEntityConfigByCode(t.params.type,t.params.code),t.params&&t.params.uuid&&(t.params.info=t.backpackProxy.getInfoByUuidAndType(t.params.uuid,t.params.type)),t}return __extends(e,i),e.prototype.onDestroy=function(){this.params.doneCB&&this.params.doneCB()},e.prototype.childrenCreated=function(){var e=this;if(i.prototype.childrenCreated.call(this),this.params&&this.config){switch(this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem),this.decorateCommonInfo(),this.params.type){case EEntityType.EEntityTypeVestageItem:this.decorateVestageItem();break;default:this.decorateItem()}this.btn_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.callBackLeft&&e.callBackLeft()},this),this.btn_right.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.callBackRight&&e.callBackRight()},this),this.gp_baseitem.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.callBackBaseitem&&e.callBackBaseitem()},this),this.makeAccess(),this.params.showAccessNow&&this.switchGpAccessVisible(),this.updateHeight()}},e.prototype.decorateCommonInfo=function(){this.lb_name.text=this.config.name,this.lb_desc.text=this.config.desc,"令状等级"==this.config.name&&(this.lb_num.visible=!1),this.params.info&&this.params.info.uuid?this.baseItem.updateData({uuid:this.params.info.uuid,type:this.params.type}):this.baseItem.updateData(this.params);var e=this.backpackProxy.getInfoByCode(this.params.code);this.lb_num.text="数量 "+e.haveNum,this.lb_name.textColor=COLOR_2_FONT_COLOR[this.config.color]||16777215,this.updateHeight(),this.updateExpireTime()},e.prototype.updateExpireTime=function(){if(this.params.expiredDay)this.lb_dt.visible=!0,this.lb_dt.text="有效期："+this.params.expiredDay+"天";else if(this.params.source==BASEITEM_SOURCE.BACKPACK&&this.params.expiredDt){this.lb_dt.visible=!0;var e=this.params.expiredDt-Utils.TimerManager.getServerTime(),t=Math.ceil(e/86400);this.lb_dt.text="有效期："+(1<t?t:"今")+"天"}else this.lb_dt.visible=!1},e.prototype.updateHeight=function(){this.validateNow(),this.gp_access.visible?this.gp_main.height=this.gp_detail.height+this.gp_access.height:this.gp_main.height=this.gp_detail.height},e.prototype.decorateVestageItem=function(){var e=this;this.params.source==BASEITEM_SOURCE.BACKPACK?(this.btn_left.label="丢弃",this.btn_right.label="使用",this.callBackRight=function(){e.config.type,a.GameMVC.dungeonPy.UseItem({code:e.params.code,cb:function(){e.hide()}})},this.callBackLeft=function(){a.GameMVC.dungeonPy.DiscardItem({code:e.params.code,cb:function(){e.hide()}})}):this.gp_btn.parent.removeChild(this.gp_btn),this.gp_limit.height=0,this.gp_limit.visible=!1},e.prototype.decorateItem=function(){var i=this;if(this.params.source==BASEITEM_SOURCE.BACKPACK)switch(this.config.useType){case 1:this.btn_right.label="使用",this.callBackRight=function(){PopUpManager.addPopUp({obj:new a.UsePropPanel({code:i.params.code})}),i.hide()};break;case 2:this.btn_right.label="合成",this.callBackRight=function(){var e=i.config.effectEx,t=i.backpackProxy.getItemNumByCode(i.params.code);t<e?Utils.MsgUtils.addMidMsg("所需碎片不足"):(i.hide(),1<Math.floor(t/e)?PopUpManager.addPopUp({obj:new a.CompoundPanel({code:i.params.code})}):a.AppFacade.getInstance().retrieveProxy(a.BackpackPy.N).compound({code:i.params.code,num:1}))};break;case 4:this.btn_right.label="使用",this.callBackRight=function(){a.MainJumpConfig.jumpTo(i.config.effectEx),i.hide()};break;default:if(0==this.config.useType&&1==this.config.isSellable)break;this.btn_right.parent.removeChild(this.btn_right),this.btn_left.horizontalCenter=0}else this.btn_right.parent.removeChild(this.btn_right),this.btn_left.horizontalCenter=0;if(this.btn_left.label="获取",this.callBackLeft=function(){i.switchGpAccessVisible()},0==this.config.useType&&1==this.config.isSellable&&(this.btn_right.label="出售",this.btn_left.label="获取",this.callBackRight=function(){a.AppFacade.getInstance().retrieveMediator(a.ShopyMediator.N).showSubView(a.ShopyMediator.SV.SHOP_SELL_NUM,{shopConfig:{name:i.config.name,info:i.config},maxCount:i.backpackProxy.getInfoByCode(i.params.code).haveNum}),i.hide()}),2==this.config.useType&&this.config.effect){var e=JSON.parse(this.config.effect);if(1==e.length){var t=e[0]&&e[0][1],n=e[0]&&e[0][0];n!=EEntityType.EEntityTypeHero&&n!=EEntityType.EEntityTypePet||(this.img_tier_icon.source=a.GeneralConfig.getHeroJingyingTag(t),this.callBackBaseitem=function(){a.AppFacade.getInstance().showSubView(a.HeroMediator.N,a.HeroMediator.SV.HERO_DETAIL,{code:t}),i.hide()})}}if(this.config.moduleId){var o=Utils.UnlockMgr.checkPass(this.config.moduleId,!1);this.lb_limit.text=(!o.allow&&o.ext.tips||"").replace("解锁","可使用")}""==this.lb_limit.text?(this.gp_limit.height=0,this.gp_limit.visible=!1):(this.gp_btn.height=0,this.gp_btn.visible=!1)},e.prototype.makeAccess=function(){var e=this,t=a.Config.getMainWayConfigByIdAndEntityType(this.config.id||this.config.code,this.params.type);if(0<t.length)for(var i=0,n=t;i<n.length;i++){var o=n[i];this.gp_ways.addChild(new r({wayCode:o,callBack:function(){e.opperationParams=1,e.hide(),PopUpManager.onDarkClick()}}))}else this.gp_ways.addChild(new r(void 0));this.gp_access.visible=!1},e.prototype.switchGpAccessVisible=function(){this.gp_access.visible=!this.gp_access.visible,""==this.lb_limit.text?(this.gp_limit.height=0,this.gp_limit.visible=!1,this.gp_btn.height=70,this.gp_btn.visible=!0):(this.gp_limit.height=70,this.gp_limit.visible=!1,this.gp_btn.height=0,this.gp_btn.visible=!1),this.updateHeight()},e}(BasePanel);a.BaseItemDetailView=e,__reflect(e.prototype,"game.BaseItemDetailView");var r=function(i){function e(e){var t=i.call(this)||this;return t.jumpMode=void 0,t.skinName="CommonAccessItemSkin",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;if(i.prototype.childrenCreated.call(this),this.params&&this.params.wayCode){var t=a.Config.wayConfig()[this.params.wayCode];this.lb_desc.text=t.desc,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.moduleId&&a.MainJumpConfig.jumpTo(t.moduleId),e.params.callBack&&e.params.callBack()},this)}else this.lb_desc.text="暂无获取途径",this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.MsgUtils.addMidMsg("暂无获取途径")},this)},e}(eui.Component);a.CommonAccessItem=r,__reflect(r.prototype,"game.CommonAccessItem",["eui.UIComponent","egret.DisplayObject"])}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="CommonLevelMasterPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.lv_desc.itemRenderer=n,this.commonTanKuang.onCloseCB=function(){e.hide()}},e.prototype.updateView=function(e,t){if(void 0===t&&(t=!1),this.info=e,this.commonTanKuang.blb_title.text=this.info.title,this.info.config){var i=[];for(var n in this.info.config){var o=this.info.config[n];i.push({c:o,totalLevel:this.info.totalLevel})}this.lv_desc.dataProvider=new eui.ArrayCollection(i)}},e}(BasePanel);i.CommonLevelMasterPanel=e,__reflect(e.prototype,"game.CommonLevelMasterPanel");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="CommonLevelMasterListItemRenderSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){t.prototype.dataChanged.call(this);var e=JSON.parse(this.data.c.attr)[0];this.lb_prefix.text="总等级"+this.data.c.level+"级",this.lb_suffix.text="上阵英雄"+i.GeneralConfig.getAttrName(e[0])+"+"+i.GeneralConfig.getAttrValue(e[1]).toString(),this.data.totalLevel<this.data.c.level?(this.lb_prefix.textColor=16777215,this.img_bg.source="shenbing_img_weijihuo_png"):(this.lb_prefix.textColor=15587767,this.img_bg.source="shenbing_img_yijihuo_png")},e}(eui.ItemRenderer);__reflect(n.prototype,"CommonLevelMasterListItemRender")}(game||(game={})),function(s){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroArtifactResonateSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.initList(),this.rootPanel.onCloseCB=function(){e.hide()},this.rootPanel.blb_title.text="圣物羁绊"},e.prototype.initList=function(){this.list_item.itemRenderer=i},e.prototype.updateView=function(e){this.heroVO=e&&e.vo||this.heroVO,this.config=s.Config.heroArtifactResonate(this.heroVO.config.subType),this.updateList()},e.prototype.updateList=function(){var n=this,o=0,e=s.GameMVC.heroThingPy.getHeroArtifactByHeroUuid(this.heroVO.uuid);e.length&&(o=e[0].config.color);var a=[],t=function(e){var t=r.config[e],i={config:t,info:r.heroVO,curColor:o,activated:0<=r.heroVO.artifactResonate.indexOf(t.color),func:function(){s.GameMVC.heroPy.ActiveArtifactResonate({uuid:n.heroVO.uuid,color:t.color,cb:function(){DragonBoneTools.playOnce({effectName:"common_ty_jihuo",parent:GameRootLayer.gameLayer().popMsgLayer}),n.updateView(),NoticeManager.updateNotice([NT.HERO_ARTIFACT_RESONATE],{heroInfo:n.heroVO},!0)}})}};a.push(i)},r=this;for(var i in this.config)t(i);this.list_item.dataProvider=new eui.ArrayCollection(a)},e}(BasePanel);s.HeroArtifactResonatePanel=e,__reflect(e.prototype,"game.HeroArtifactResonatePanel");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroArtifactResonatePanel_ListItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_activate,egret.TouchEvent.TOUCH_TAP,function(){e.data.func()},this)},e.prototype.dataChanged=function(){var e=this.data.config,t=e.color;this.img_frame.source=COLOR_2_FRAME[t],this.img_icon.source="jiban_img_huizhang0"+(t-1)+"_png",this.lb_title.text="穿戴"+COLOR_CONFIG[t].name+"品质以上的圣物";var i="";JSON.parse(e.attr).forEach(function(e){i+=AttrConfig[e[0]].name+"+"+s.GeneralConfig.getAttrValue(e[1])+"  "}),this.lb_attr.text=i,this.data.activated?(this.btn_activate.scaleX=this.btn_activate.scaleY=1,this.btn_activate.skinName="skins.ButtonSkinSure",this.btn_activate.label="已激活",this.btn_activate.enabled=!1,UIActionManager.setAbsGrey(this.btn_activate,!1)):(this.btn_activate.scaleX=this.btn_activate.scaleY=.85,this.btn_activate.skinName="skins.ButtonSkinYellow",this.btn_activate.label="激活",this.btn_activate.enabled=this.data.curColor>=t,UIActionManager.setAbsGrey(this.btn_activate,this.data.curColor<t))},e}(eui.ItemRenderer);__reflect(i.prototype,"HeroArtifactResonatePanel_ListItem")}(game||(game={})),function(T){var o=function(i){function o(e){var t=i.call(this)||this;return t.array=[],t.zanNumber=0,t.commentNum=0,t.playerPy=T.AppFacade.getInstance().retrieveProxy(T.PlayerPy.N),t.loginProxy=T.AppFacade.getInstance().retrieveProxy(T.LoginPy.N),t.skinName="HeroCommentSkin",t}return __extends(o,i),o.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_msg),this.btn_zan.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.dianZan(e)},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.skill_panel.visible=!1,this.tinput_text.textDisplay.size=24,this.initMidView(),this.initBottomView(),this.timer=egret.setInterval(function(){t.getPlayerTuphero()},this,3e4)},o.prototype.updateView=function(e){var t=e&&e.info;this.params=T.Config.allHeroConfig()[t.code],this.playerStatus(),this.getPlayerTuphero(),this.once(egret.Event.ENTER_FRAME,this.initTopView,this)},o.prototype.playerStatus=function(){var t=this,e=T.AppFacade.getInstance().retrieveProxy(T.LoginPy.N);Utils.Http.toGet({action:"get_HeroStatus",code:this.params.subType,player_id:e.playerProxy.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,project:Utils.agentConfig.ProjectName}).then(function(e){t.lb_zanCounts.text=""+e.num,t.zanNumber=e.num,t.isZan=e.status}).catch(function(e){console.log("----get_HeroStatus",e)})},o.prototype.initTopView=function(){this.lb_title.text=this.params.name,this.hero_model.update({isStatic:!0,code:this.params.code,model:this.params.model}),this.hero_model.scaleX=this.hero_model.scaleY=.75,this.lb_profession.text=ProfessionConfig[this.params.profession].name,this.img_race.source=HeroRaceConfig[this.params.race].raceIconBig,this.img_profession_icon.source=ProfessionConfig[this.params.profession].icon,this.lb_desc.text="    "+this.params.desc,this.lb_lv.text=this.params.maxLevel+"/"+this.params.maxLevel,this.lb_zanCounts.text=this.zanNumber.toString();var e=T.GeneralConfig.getHeroStarInfo(this.params.initStar);if(this.gp_stars.removeChildren(),e.stage<4)for(var t=0;t<e.num;t++){var i=new eui.Image(e.src);i.scaleX=i.scaleY=.67,this.gp_stars.addChild(i)}else this.gp_stars.addChild(new customui.HighStarLevelIcon({num:e.num,scale:.7}));for(t=1;t<=5;t++){var n=this["skill"+t];this.bindSkillPanelClick({target:n,x:34,bottom:t<4?200:132})}this.updateAttr(),this.updateHeroBaseInfo()},o.prototype.updateHeroBaseInfo=function(){this.gp_skill.visible=!0;for(var e=JSON.parse(this.params.skillUnlock),t=this.sectionConfig&&this.sectionConfig.id||0,i=1;i<=5;i++){var n=SKILL_CODE[i],o=this["skill"+i];if(n){var a={code:this.params[n],unlock:t>=e[i]};this["skill"+i].updateItem(a)}else this["skill"+i].updateItem()}for(i=1;i<=5;i++){o=this["skill"+i];this.bindSkillPanelClick({target:o,x:34,bottom:i<4?130:73})}},o.prototype.bindSkillPanelClick=function(t){var i=this,n=t.target;n.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){if(n.data&&n.data.code)for(var e in i.skill_panel.visible=!0,i.skill_panel.updateItem({code:n.data.code}),t)"target"!=e&&(i.skill_panel[e]=t[e])},this),n.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skill_panel.visible=!1},this),n.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skill_panel.visible=!1},this),n.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skill_panel.visible=!1},this)},o.prototype.dianZan=function(e){0==this.isZan?(Utils.MsgUtils.addNumberEffect("+1",this.btn_zan,e.stageX,e.stageY,1),this.thumbsUp()):Utils.MsgUtils.addMidMsg("已赞过此英雄")},o.prototype.updateAttr=function(){var e=T.Config.heroAndPetSectionConfig(this.params.type==EEntityType.EEntityTypePet),t=this.params.maxLevel;for(var i in e){var n=e[i];t>parseInt(n.level)&&(this.sectionConfig=n)}var o=T.Config.heroAndPetUpstarConfig(this.params.type==EEntityType.EEntityTypePet)[this.params.code],a=[],r=JSON.parse(this.params.baseAttr),s=JSON.parse(this.params.upAttr),c=this.sectionConfig&&JSON.parse(this.sectionConfig.attr)||[];if(a=T.GeneralConfig.AttrAddAttr(a,r),s=T.GeneralConfig.AttrMutilAttr(s,parseInt(this.params.maxLevel)-1),a=T.GeneralConfig.AttrAddAttr(a,s),a=T.GeneralConfig.AttrAddAttr(a,c),o){var l=o&&JSON.parse(o.upAttr);a=T.GeneralConfig.AttrMutilAttr(a,l)}this.params.posSkill1,this.params.posSkill2,this.params.posSkill3;for(var h=T.Config.skillBaseConfig(),p=[],d=[],u=JSON.parse(this.params.skillUnlock),g=this.sectionConfig&&this.sectionConfig.id||0,f=1;f<=5;f++){var _=SKILL_CODE[f-1];if(_&&this.params[_]){var m=this.params[_];if(g>=u[f-1]){var y=h[m];if(y){var v=JSON.parse(y.attr);for(var i in v){1e5<=(n=v[i])[1]?p=T.GeneralConfig.AttrAddAttr(p,[n]):d=T.GeneralConfig.AttrAddAttr(d,[n])}}}}}for(var i in a=T.GeneralConfig.AttrAddAttr(a,p),a=T.GeneralConfig.AttrAddAttr(a,d))a[i][1]=Math.floor(a[i][1]);a.sort(function(e,t){return e[0]-t[0]}),this.gp_upgrade_attr.removeChildren();for(f=1;f<=4;f++)this.gp_upgrade_attr.addChild(new T.HeroMainView_AttrItem({type:f,num:a[f-1][1]}))},o.prototype.thumbsUp=function(){var t=this,e=T.AppFacade.getInstance().retrieveProxy(T.PlayerPy.N);Utils.Http.toGet({action:"set_HerothumbsUp",moduleType:EEntityType.EEntityTypeHero,code:this.params.subType,player_id:e.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,project:Utils.agentConfig.ProjectName,server_id:this.loginProxy.serverSelect.s_id,area:this.loginProxy.serverSelect.area}).then(function(e){console.log("set_HerothumbsUp"+e),t.playerStatus()}).catch(function(e){console.log("set_HerothumbsUp"+e)})},o.prototype.initMidView=function(){this.list=new eui.List;var e=new eui.TileLayout;e.horizontalGap=5,e.requestedColumnCount=1,this.list.layout=e,this.list.itemRenderer=t,this.sl_center.viewport=this.list,this.sl_center.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_center.scrollPolicyV=eui.ScrollPolicy.AUTO},o.prototype.initBottomView=function(){this.btn_send.addEventListener(egret.TouchEvent.TOUCH_TAP,this.playerTupHero,this)},o.prototype.playerTupHero=function(){var t=this,e=T.Config.constConfig().HeroCommentLevelRequire,i=JSON.parse(e.constValue),n=JSON.parse(T.Config.constConfig().DefaultAvatar.constValue)[0];this.playerPy.playerInfoVO.playerVip.vipLevel>=i[0]||this.playerPy.playerInfoVO.level>=i[1]?this.tinput_text.text&&""!=this.tinput_text.text?Utils.Http.toGet({action:"set_PlayerTup_hero",moduleType:EEntityType.EEntityTypeHero,code:this.params.subType,player_id:this.playerPy.playerInfoVO.playerId,head:this.playerPy.playerInfoVO.avatar||n,name:this.playerPy.playerInfoVO.name,content:this.tinput_text.text,type:o.commentType.PINGLUN,tup_player:this.playerPy.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,subPlatform:Utils.agentConfig.channelName||"",project:Utils.agentConfig.ProjectName,server_id:this.loginProxy.serverSelect.s_id,area:this.loginProxy.serverSelect.area,from_server_id:this.loginProxy.serverSelect.area}).then(function(e){1==e.code?(t.getPlayerTuphero({type:o.commentType.PINGLUN,priority:!0,id:t.playerPy.playerInfoVO.playerId}),Utils.MsgUtils.addMidMsg("评论成功！")):2==e.code&&Utils.MsgUtils.addMidMsg("你已发表过评论！"),t.tinput_text.text=void 0}).catch(function(e){console.log("set_PlayerTup_hero"+e)}):Utils.MsgUtils.addMidMsg("请输入内容！"):Utils.MsgUtils.addMidMsg("等级达到"+i[1]+"级或VIP到达"+i[0]+"级可评论")},o.prototype.getPlayerTuphero=function(s){var c=this;if(s&&0<this.array.length&&s.type==o.commentType.DIANZAN){s.info;return this.array.sort(function(e,t){return c.sortByTime(e,t)}),this.sortByLike(),void this.list.dataProvider.replaceAll(this.array)}Utils.Http.toGet({action:"get_PlayerTup_hero",code:this.params.subType,player_id:this.playerPy.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,project:Utils.agentConfig.Project}).then(function(e){for(var t in c.commentNum=0,c.array=[],e)if(e[t].content&&e[t].player_id&&e[t].name){++c.commentNum;var i={code:c.params.subType,id:e[t].player_id,name:e[t].name,head:e[t].head,content_id:t,content:e[t].content,num:Number(e[t].num),tup_player:e[t].tup_player,time:e[t].createTime,strTime:Number(e[t].strTime),serverId:e[t].area};c.array.push(i)}if(c.array.sort(function(e,t){return c.sortByTime(e,t)}),c.origin_arr.length<=0)for(var n=0,o=c.array;n<o.length;n++){t=o[n];c.origin_arr.push(t),c.commonArr.push(t)}if(c.newArr=[],c.origin_arr.length!=c.array.length)for(var a=c.array.length-c.origin_arr.length,r=0;r<a;)c.newArr.push(c.array[r]),++r;s&&s.priority?c.commentsFloatingEffect({priority:s.priority,id:s.id}):c.commentsFloatingEffect(),c.sortByLike(),c.list.dataProvider=new eui.ArrayCollection(c.array),c.gp_null.visible=0==c.commentNum})},o.prototype.perClose=function(){egret.Tween.removeTweens(this.gp_msg),egret.clearInterval(this.timer)},o.prototype.onDestroy=function(){i.prototype.onDestroy.call(this)},o.commentType={PINGLUN:1,DIANZAN:2},o}(T.CommonComment);T.HeroCommentView=o,__reflect(o.prototype,"game.HeroCommentView");var t=function(i){function e(){var e=i.call(this)||this;return e.skinName="CommentItemSkin",e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this);var e=this.btn_love.labelDisplay;e.size=19,e.stroke=1,this.btn_love.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.playerTupHero(e)},this)},e.prototype.dataChanged=function(){this.lb_time.text="["+this.data.time+"]",this.lb_comments.text=""+this.data.content,this.lb_playerName.text=this.data.name,this.playerHead.updateData({vo:{avatar:this.data.head}}),this.btn_love.labelDisplay.text=this.data.num.toString(),this.data.tup_player?(UIActionManager.setGrey(this.btn_love,!0),this.btn_love.touchEnabled=!1):(UIActionManager.setGrey(this.btn_love,!1),this.btn_love.touchEnabled=!0)},e.prototype.playerTupHero=function(t){var i=this,n=T.AppFacade.getInstance().retrieveProxy(T.PlayerPy.N),e=T.AppFacade.getInstance().retrieveProxy(T.LoginPy.N);Utils.Http.toGet({action:"set_PlayerTup_hero",moduleType:EEntityType.EEntityTypeHero,code:this.data.code,player_id:this.data.id,name:this.data.name,content:this.data.content,head:this.data.head,type:o.commentType.DIANZAN,tup_player:n.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,subPlatform:Utils.agentConfig.channelName||"",project:Utils.agentConfig.ProjectName,server_id:e.serverSelect.s_id,area:this.data.serverId,from_server_id:e.serverSelect.area}).then(function(e){Utils.MsgUtils.addNumberEffect("+1",i.btn_love,t.stageX,t.stageY,-1),++i.data.num,i.data.tup_player=n.playerInfoVO.playerId,T.AppFacade.getInstance().sendNotification(CN.HEROCOMMENT_UPDATE,{info:i.data,type:o.commentType.DIANZAN})}).catch(function(e){console.log("set_PlayerTup_hero"+e)})},e}(eui.ItemRenderer);__reflect(t.prototype,"heroCommentItem")}(game||(game={})),function(h){var s=function(e){this.model=e.model,this.info=e.info,this.dermaInfo=e.dermaInfo};__reflect(s.prototype,"HeroFormationItem");var e=function(t){function e(){var e=t.call(this)||this;return e.pos2item={},e.changed=!1,e.addScale=Utils.DeviceUtils.additionScale(),e.FIXED_BOTTOM=20,e.MODEL_WIDTH=void 0,e.MODEL_HEIGHT=void 0,e.MODEL_SCALE=.35,e.heroPy=h.AppFacade.getInstance().retrieveProxy(h.HeroPy.N),e.HeroThingPy=h.AppFacade.getInstance().retrieveProxy(h.HeroThingPy.N),e.skinName="HeroFormationPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addListener(),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){h.AppFacade.getInstance().hideSubView(h.HeroMediator.N,h.HeroMediator.SV.FORMATION)},this)},e.prototype.showBoundary=function(e){var t=new egret.Shape;t.graphics.lineStyle(10,16711680),t.graphics.beginFill(0,0),t.graphics.drawRect(0,0,e.width,e.height),t.graphics.endFill(),e.addChild(t)},e.prototype.initForDebug=function(){for(var e=1;e<=6;e++)this.showBoundary(this["gp_f_"+e])},e.prototype.addListener=function(){this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},e.prototype.removeListener=function(){this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},e.prototype.initModel=function(e){var a=this,r=this.heroPy.allHeroByUuid;e.forEach(function(e){var t=r[e.uuid],i=new customui.HeroDynamicModel;i.scaleX=i.scaleY=a.MODEL_SCALE,a.MODEL_WIDTH||(a.MODEL_WIDTH=i.width*i.scaleX,a.MODEL_HEIGHT=i.height*i.scaleY);var n=void 0;0!=t.dermaCode?(n=h.Config.getHeroDermaConfig()[t.dermaCode],i.update({model:n.model})):i.update({code:t.code,isStatic:!0});var o=new s({model:i,info:t,dermaInfo:n});a.gp_formation.addChild(i),a.setHeroToPos(o,e.battlePos)})},e.prototype.updateView=function(e){this.cb=e&&e.cb;var t=e&&e.battlePosInfo;if(!t){t=[];var i=this.heroPy.allHeroByUuid;for(var n in i){var o=i[n];o.battlePos&&t.push({uuid:n,battlePos:o.battlePos})}}this.initModel(t)},e.prototype.setHeroToPos=function(e,t){if(e){this.pos2item[this.startingPos]=void 0,this.startingPos&&this.startingPos!=t&&(this.changed=!0,this.pos2item[t]&&this.setHeroToPos(this.pos2item[t],this.startingPos));var i=(this.pos2item[t]=e).model,n=this["gp_f_"+t];i.x=n.x+(n.width-this.MODEL_WIDTH)/2,i.y=n.y+(n.height-this.MODEL_HEIGHT-this.FIXED_BOTTOM);var o=this["gp_info_"+t],a=this.gp_formation.getChildIndex(e.model);this.gp_formation.getChildIndex(o)<a&&this.gp_formation.swapChildren(e.model,o),o.visible=!0,e.dermaInfo?this["lb_name_"+t].text=e.dermaInfo.name:this["lb_name_"+t].text=e.info.config.name,this["lb_level_"+t].text=e.info.level;var r=this["gp_stars_"+t],s=e.info.starLevel,c=h.GeneralConfig.getHeroStarInfo(s);if(r.removeChildren(),c.stage<4)for(var l=0;l<c.num;l++)r.addChild(new eui.Image(c.src));else r.addChild(new customui.HighStarLevelIcon({num:c.num,scale:.8}))}},e.prototype.setModelToXY=function(e,t,i){var n=-this.MODEL_WIDTH*e.scaleX/2,o=-this.MODEL_HEIGHT*e.scaleY/2;e.x=(t-e.parent.x-this.gp_root.x+n)/this.addScale,e.y=(i-e.parent.y-this.gp_root.y+o)/this.addScale},e.prototype.getTouchedGroupPos=function(e){for(var t=1;t<=6;t++){var i=this["gp_f_"+t],n=i.localToGlobal();if(new egret.Rectangle(n.x,n.y,i.width,i.height).contains(e.stageX,e.stageY))return t}},e.prototype.onTouchBegin=function(e){var t=this.getTouchedGroupPos(e);if(t&&this.pos2item[t]){this.targetItem=this.pos2item[t];var i=this.targetItem.model;this.gp_formation.setChildIndex(i,this.gp_formation.numChildren-1),this.startingPos=t,this.gp_touchField.width=Utils.DeviceUtils.curWidth(),this.gp_touchField.height=Utils.DeviceUtils.curHeight(),this["gp_info_"+t].visible=!1}},e.prototype.onTouchMove=function(e){if(this.targetItem){var t=this.targetItem.model;this.setModelToXY(t,e.stageX,e.stageY)}},e.prototype.onTouchEnd=function(e){if(this.targetItem){var t=this.getTouchedGroupPos(e);t?this.setHeroToPos(this.targetItem,t):this.setHeroToPos(this.targetItem,this.startingPos),this.targetItem=void 0,this.startingPos=void 0,this.gp_touchField.width=this.gp_formation.width,this.gp_touchField.height=this.gp_formation.height}},e.prototype.onPanelClose=function(){if(this.changed)if(this.cb)this.cb(this.pos2item);else{var e={};for(var t in this.pos2item){var i=this.pos2item[t];i&&(e[t]=i.info.uuid)}this.heroPy.HeroChangeFormation(e)}},e.prototype.perClose=function(){this.removeListener(),this.onPanelClose()},e}(BasePanel);h.HeroFormationPanel=e,__reflect(e.prototype,"game.HeroFormationPanel")}(game||(game={})),function(v){var e=function(n){function e(){var e=n.call(this)||this;return e.moneyType=[],Utils.AssetsMgr.loadGroup("group_hero_gacha"),e.skinName="HeroGachaSkin",e.heroPy=v.AppFacade.getInstance().retrieveProxy(v.HeroPy.N),e.backPackProxy=v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N),e.guideEffectWait=!0,e}return __extends(e,n),e.prototype.onDestroy=function(){n.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_hero_gacha")},e.prototype.childrenCreated=function(){var e=this;n.prototype.childrenCreated.call(this),Utils.SDKMgr.getPerformConfig(39)&&(this.lb_shuoming.visible=!0),this.initConfig(),this.pb_Exp.maximum=100,this.gp_content.scaleX=this.gp_content.scaleY=Utils.DeviceUtils.additionScale(),this.gachaBtnEvent(),this.contentStatus(),this.activeHeroAnim(),egret.setTimeout(function(){e.viewActionEffect()},this,100);var t=v.AppFacade.getInstance().retrieveProxy(v.TaskPy.N);if(t.allTasks[TaskType.HideAchievement].some(function(e){return 500009==e.code&&!e.isTarget})){var i=new eui.Image("_yslz_m_json.yslz_img_baoxiang");i.x=215,i.y=600,this.sl_resource_race.viewport.addChild(i),Utils.TouchUtils.addTouchListener(i,function(){t.GetTaskReward(TaskType.HideAchievement,500009),i&&i.parent&&i.parent.removeChild(i)})}egret.setTimeout(function(){this.addNotice()},this,100)},e.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.GASHA_HIGH_TIMES,this.btn_reward.iconDisplay,this,BTN_ICON_NOTICE_POS)},e.prototype.removeNotice=function(){NoticeManager.removeNoticeListener(NT.GASHA_HIGH_TIMES)},e.prototype.initConfig=function(){this.GACHA_TYPE_INFO=((e={})[GashaponType.Lower]={1:{},10:{},suffix:"low",money:"低级币",heroData:{code:41110030,model:"hero_030_03",isStatic:!0}},e[GashaponType.High]={1:{},10:{},suffix:"high",money:"钻石",heroData:{code:41110014,model:"hero_014_03",isStatic:!0}},e[GashaponType.Friend]={1:{},10:{},suffix:"race",money:"友情币",heroData:{code:41100009,model:"hero_009_03",isStatic:!0}},e);var e,t=v.Config.gashaponEntry();for(var i in t){var n=t[i];n.type!=GashaponType.Race&&(this.GACHA_TYPE_INFO[n.type][n.times].itemCosts=JSON.parse(n.itemCosts),this.GACHA_TYPE_INFO[n.type][n.times].moneyCosts=JSON.parse(n.moneyCosts))}},e.prototype.updateView=function(e){for(var t in this.GACHA_TYPE_INFO){var i=this.GACHA_TYPE_INFO[t],n=i.suffix,o=i[1].itemCosts[0],a=0<i[1].moneyCosts.length?i[1].moneyCosts[0]:void 0,r=a,s=0<i[10].moneyCosts.length?i[10].moneyCosts[0]:void 0;!this.backPackProxy.checkEnough([o],!1)&&a||(r=o),!this.backPackProxy.checkEnough([i[10].itemCosts[0]],!1)&&s||(s=i[10].itemCosts[0]),this["icon_resource_1_"+n].updateItem({cost:r,style:CommonIconStyle.RIGHT,showEnough:!1}),this["icon_resource_10_"+n].updateItem({cost:s,style:CommonIconStyle.RIGHT,showEnough:!1})}this.updateTimes(),this.resourceBarComponent()},e.prototype.addEffect=function(e,t,i){t&&!e?t.visible=i:e&&(t.visible=i,t.numChildren<=0&&(t.removeChildren(),DragonBoneTools.create(e,function(e){e.x=t.width/2,e.y=t.height/2,e.animation.play(),t.addChild(e)},this)))},e.prototype.updateTimes=function(){var e=this.heroPy.gashaponInfo,t=Utils.TimerManager.getServerTime();for(var i in this.GACHA_TYPE_INFO){var n=this.GACHA_TYPE_INFO[i].suffix,o=this["lb_time_"+n],a=this["btn_gacha_1_"+n],r=this["icon_resource_1_"+n];0<e[i].freeTimes?(a.label="免费",a.labelDisplay.horizontalCenter=0,o.visible=!1,r.visible=!1):(a.label="召唤",r.visible=!0,o.visible=0!=e[i].nextFreeDt,o.text=Utils.TimerManager.getFormatBySecond1(e[i].nextFreeDt-t)+" 后免费",this.freeTimeTimer||(this.freeTimeTimer=egret.setInterval(this.updateTimes,this,1e3)))}},e.prototype.resourceBarComponent=function(){for(var e in this.GACHA_TYPE_INFO){var t=this.GACHA_TYPE_INFO[e].suffix,i=[this.GACHA_TYPE_INFO[e][1].itemCosts[0]];Number(e)==GashaponType.High&&(i=[this.GACHA_TYPE_INFO[e][1].itemCosts[0],this.GACHA_TYPE_INFO[e][1].moneyCosts[0]]),this["cu_resBar_"+t].updateBar({costs:i,width:190,needAdd:!0})}},e.prototype.gachaBtnEvent=function(){var e=function(e){var t=o.GACHA_TYPE_INFO[e],i=o.GACHA_TYPE_INFO[e].suffix,n=o.heroPy.gashaponInfo;o["btn_gacha_1_"+i].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.backPackProxy.checkEnough([t[1].itemCosts[0]],!1)||t[1].moneyCosts[0]&&this.backPackProxy.checkEnough([t[1].moneyCosts[0]],!1)||!(n[e].freeTimes<=0)?this.heroPy.MakeGashapon({type:Number(e),subType:0,times:1}):Utils.MsgUtils.addMidMsg("您的"+this.GACHA_TYPE_INFO[e].money+"不足")},o),o["btn_gacha_10_"+i].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.backPackProxy.checkEnough([t[10].itemCosts[0]],!1)||t[10].moneyCosts[0]&&this.backPackProxy.checkEnough([t[10].moneyCosts[0]],!1)||!(n[e].freeTimes<=0)?this.heroPy.MakeGashapon({type:Number(e),subType:0,times:10}):Utils.MsgUtils.addMidMsg("您的"+this.GACHA_TYPE_INFO[e].money+"不足")},o)},o=this;for(var t in this.GACHA_TYPE_INFO)e(t);this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.MainJumpConfig.jumpTo()},this),this.gp_jindu.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=v.Config.constConfig().HeroBagMaxSize.constValue;100<=this.value?this.heroPy.allHeroNum>=e?Utils.MsgUtils.addMidMsg("英雄背包已满，无法领取"):this.heroPy.MakeProgressGashapon():Utils.MsgUtils.addMidMsg("进度值不足")},this),this.btn_info.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new v.HelpDialog({moduleId:MODULE.HeroGaCha})})},this),Utils.ComponentUtils.registerListener(this.btn_reward,egret.TouchEvent.TOUCH_TAP,function(){v.AppFacade.getInstance().showSubView(v.RankMediator.N,v.RankMediator.SV.COMMON,{module:"GACHA_HIGH_ACHIEVMENT"})},this)},e.prototype.activeHeroAnim=function(){for(var e in this.GACHA_TYPE_INFO){var t=this.GACHA_TYPE_INFO[e].heroData;this["hero_model_"+this.GACHA_TYPE_INFO[e].suffix].update(t)}},e.prototype.viewActionEffect=function(){var n=this,e=function(e){var t=o.GACHA_TYPE_INFO[e].suffix,i=Number(e)%2!=1;UIActionManager.UIActionEffect(o["img_bg_"+t],500,i,function(){n.setGuideAvailable()}),UIActionManager.UIActionEffect(o["cu_resBar_"+t],500,i),UIActionManager.UIActionEffect(o["sl_resource_"+t],500,!i,function(){UIActionManager.fadeIn(n["gp_dt_"+t],1e3)})},o=this;for(var t in this.GACHA_TYPE_INFO)e(t)},e.prototype.contentStatus=function(){for(var e in this.GACHA_TYPE_INFO){var t=this.GACHA_TYPE_INFO[e].suffix;this["gp_dt_"+t].alpha=0,this["img_bg_"+t].visible=!1,this["cu_resBar_"+t].visible=!1,this["sl_resource_"+t].visible=!1}},e.prototype.perClose=function(){egret.clearInterval(this.freeTimeTimer)},e}(BaseFull);v.HeroGachaView=e,__reflect(e.prototype,"game.HeroGachaView");var t=function(i){function o(){var e=i.call(this)||this;return e.costs=[],e.isGacha=!1,e.curIndex=0,e.skinName="HeroGachaResultSkin",e.heroPy=v.AppFacade.getInstance().retrieveProxy(v.HeroPy.N),e.backPackProxy=v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N),e.isJump=!1,e.guideEffectWait=!0,e}return __extends(o,i),o.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cus_resourceBar),DragonBoneTools.create("common_shenqixulizhong",function(e){t.eff_jindutiao=e,t.eff_jindutiao.visible=!1,t.gp_pb_fade.addChild(e),e.animation.play("common_shenqixulizhong")}),this.invisibleMask=new egret.Sprite,this.invisibleMask.graphics.beginFill(0,0),this.invisibleMask.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),this.invisibleMask.graphics.endFill(),this.invisibleMask.touchEnabled=!0,this.invisibleMask.visible=!1,this.gp_root.addChild(this.invisibleMask),this.darkMask=new egret.Sprite,this.darkMask.graphics.beginFill(0,.7),this.darkMask.graphics.drawRect(-100,-100,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale()+200,Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()+200),this.darkMask.graphics.endFill(),this.darkMask.touchEnabled=!0,this.gp_cardEffect.addChildAt(this.darkMask,0),this.gp_cardEffect.visible=!1,this.heroConfig=v.Config.allHeroConfig(),this.activateComponent()},o.prototype.updateView=function(e){var t=this;this.curIndex=0,this.gp_effect.removeChildren(),DragonBoneTools.create("common_chouka_1",function(e){e.animation.play("common_chouka_1"),t.gp_effect.addChild(e)}),this.chosenType=e&&e.type,this.chosenSubtype=e&&e.subType,this.isGacha=e&&e.isGacha;var i=e&&e.entryCode;this.costs=[];var n=v.Config.gashaponEntry();for(var o in n){var a=n[o];if(a.type==this.chosenType&&a.subType==this.chosenSubtype){var r=JSON.parse(a.itemCosts),s=JSON.parse(a.moneyCosts),c=0<s.length?s:void 0,l=c;!v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N).checkEnough(r,!1)&&c||(l=r),this.costs.push(l),this["icon_cost_"+a.times].updateItem({cost:l[0],style:CommonIconStyle.RIGHT}),this.cus_resourceBar.updateBar(r.concat(s))}}var h,p=n[i];if(p)if(p.fixedRewards){this.gp_top_fixed.visible=!0;var d=JSON.parse(p.fixedRewards)[0],u=v.GeneralConfig.getEntityConfigByCode(d[0],d[1]);u&&(this.img_top_fixed_icon.source=ResourceUtils.png(u.icon),this.blb_top_fixed_num.text=d[2])}else this.gp_top_fixed.visible=!1;(this.gp_jindu.visible=!1,0<this.heroPy.gashaponInfo[this.chosenType].freeTimes?(this.icon_cost_1.visible=!1,this.btn_gacha_1.label="免费"):(this.icon_cost_1.visible=!0,this.btn_gacha_1.label="召唤"),this.gp_component.visible=!1,this.btn_close.visible=!1,this.rewards=e.rewards,1<this.rewards.length)?((h=new eui.TileLayout).horizontalGap=15,h.verticalGap=10,h.requestedColumnCount=5,this.gp_result.layout=h):((h=new eui.HorizontalLayout).horizontalAlign=egret.HorizontalAlign.CENTER,h.verticalAlign=egret.VerticalAlign.MIDDLE,this.gp_result.layout=h);if(this.gp_result.removeChildren(),this.gp_fixedReward.removeChildren(),this.isJump)for(var g in Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_chouka),this.rewards){var f=this.rewards[g],_=this.heroConfig[f.code],m=new eui.Group;m.height=105,m.width=105;var y=customui.BaseItemFactory.create();y.updateData({type:f.type,code:f.code,num:f.num}),y.horizontalCenter=0,m.addChild(y),Number(g)<10?this.gp_result.addChild(m):(this.rewards.length<16?m.scaleX=m.scaleY=1:m.scaleX=m.scaleY=.8,this.gp_fixedReward.addChild(m)),_&&4<_.initStar&&DragonBoneTools.playOnce({effectName:"common_choukagaojiekuang",parent:m,loop:!0}),this.rewards[Number(g)+1]||this.chouKaEnd()}else this.showSingleResult(this.curIndex)},o.prototype.showSingleResult=function(e,t){var i=this;if(void 0===t&&(t=!1),e==this.curIndex){this.insuranceTimer&&(egret.clearTimeout(this.insuranceTimer),this.insuranceTimer=void 0);var n=this.rewards[this.curIndex++];if(n){var o=this.heroConfig[n.code];if(!t&&o&&4<o.initStar)this.showCardEffectForCode(n.code),this.curIndex-=1;else{var a=new eui.Group;a.height=105,a.width=105;var r=customui.BaseItemFactory.create();r.updateData({type:n.type,code:n.code,num:n.num}),r.alpha=0,r.scaleX=.3,r.horizontalCenter=0,a.addChild(r),this.curIndex<11?this.gp_result.addChild(a):this.gp_fixedReward.addChild(a);var s=this.curIndex;egret.Tween.get(r).wait(200).to({alpha:1,scaleX:1},170),Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_chouka),DragonBoneTools.playOnce({effectName:"common_choukayingxiong",parent:a,doneCB:function(){o&&4<o.initStar&&DragonBoneTools.playOnce({effectName:"common_choukagaojiekuang",parent:a,loop:!0}),i.showSingleResult(s)}}),this.insuranceTimer=egret.setTimeout(function(){i.showSingleResult(i.curIndex)},this,1500)}}else this.chouKaEnd()}},o.prototype.chouKaEnd=function(){var t=this;DragonBoneTools.create("common_chouka_2",function(e){e.animation.play("common_chouka_2"),t.gp_effect.addChild(e),e.addEventListener(dragonBones.EventObject.COMPLETE,function(){},t)}),egret.Tween.get(this.gp_effect).wait(800).to({alpha:0},200).call(function(){t.gp_effect.removeChildren(),t.gp_effect.alpha=1,t.gp_fixedReward.numChildren?t.gp_component.verticalCenter=195.5:t.gp_component.verticalCenter=55.5,t.gp_component.visible=!t.isGacha,DragonBoneTools.playOnce({effectName:"common_jingdutiao_1lg",parent:t.gp_jindu}),t.btn_close.visible=!0,t.heroPy.canMakeGasha=!0,t.setGuideAvailable(),v.AppFacade.getInstance().sendNotification(CN.SHOW_WECHAT_SHARE)})},o.prototype.showCardEffectForCode=function(e){var t=this;this.heroCard.alpha=0,this.heroCard.scaleX=.4,this.heroCard.updateView({code:e}),this.darkMask.alpha=0,this.gp_cardEffect.visible=!0,egret.Tween.get(this.darkMask).to({alpha:1},500).wait(200).call(function(){Utils.ShakeUtils.shakeObj(t.gp_cardEffect,1.21,60,7),egret.Tween.get(t.heroCard).wait(1210).call(function(){Utils.ShakeUtils.stop(),Utils.ShakeUtils.shakeObj(t.gp_cardEffect,.2,60,30)}).wait(540).to({alpha:1,scaleX:1},210),Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_chouka_wuxingka),DragonBoneTools.playOnce({effectName:"common_kapianfanzhuan",parent:t.gp_cardEffect,timeScale:1,doneCB:function(){t.invisibleMask.visible=!0}}),t.hideEffectTimer=egret.setTimeout(function(){t.hideCardEffect()},t,7e3)})},o.prototype.hideCardEffect=function(){var e=this;this.hideEffectTimer&&(egret.clearTimeout(this.hideEffectTimer),this.hideEffectTimer=void 0),this.invisibleMask.visible=!1,egret.Tween.get(this.gp_cardEffect).to({alpha:0},200).call(function(){e.gp_cardEffect.visible=!1,e.gp_cardEffect.alpha=1,e.showSingleResult(e.curIndex,!0)})},o.prototype.resourceCheck=function(e,t){var i=this.heroPy.gashaponInfo[e],n=1==t?this.costs[0]:this.costs[1];return!((!n||!this.backPackProxy.checkEnough(n,!1))&&i.freeTimes<=0)||(Utils.MsgUtils.addMidMsg("您的"+o.MONEY_TYPE[e]+"不足"),!1)},o.prototype.addEffect=function(e,t,i){t&&!e?t.visible=i:e&&(t.visible=i,t.numChildren<=0&&(t.removeChildren(),DragonBoneTools.create(e,function(e){e.x=t.width/2,e.y=t.height/2,e.animation.play(),t.addChild(e)},this)))},o.prototype.activateComponent=function(){var e=this;this.btn_gacha_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.resourceCheck(this.chosenType,1)&&this.heroPy.MakeGashapon({type:this.chosenType,subType:this.chosenSubtype,times:1})},this),this.btn_gacha_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.resourceCheck(this.chosenType,10)&&this.heroPy.MakeGashapon({type:this.chosenType,subType:this.chosenSubtype,times:10})},this),this.img_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.AppFacade.getInstance().sendNotification(CN.HERO_GACHA_UPDATE),this.hide()},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.invisibleMask.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hideCardEffect()},this),this.cb_needGuide.addEventListener(egret.Event.CHANGE,function(){e.isJump=e.cb_needGuide.selected},this),this.gp_jindu.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=v.Config.constConfig().HeroBagMaxSize.constValue;100<=this.value?this.heroPy.allHeroNum>=e?Utils.MsgUtils.addMidMsg("英雄背包已满，无法领取"):this.heroPy.MakeProgressGashapon():Utils.MsgUtils.addMidMsg("进度值不足")},this)},o.prototype.onDestroy=function(){v.AppFacade.getInstance().sendNotification(CN.ACTIVITY_SHOW_TRIGGER)},o.MONEY_TYPE=((n={})[GashaponType.Lower]="低级币",n[GashaponType.High]="钻石",n[GashaponType.Race]="道具",n[GashaponType.Friend]="友情币",n),o}(BaseFull);v.HeroGachaResultView=t,__reflect(t.prototype,"game.HeroGachaResultView");var n,i=function(i){function e(){var e=i.call(this)||this;return e.curIndex=0,e.skinName="HeroGachaResultSkin",e.heroPy=v.AppFacade.getInstance().retrieveProxy(v.HeroPy.N),e.backPackProxy=v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N),e.isJump=!1,e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cus_resourceBar),DragonBoneTools.create("common_shenqixulizhong",function(e){t.eff_jindutiao=e,t.eff_jindutiao.visible=!1,t.gp_pb_fade.addChild(e),e.animation.play("common_shenqixulizhong")}),this.invisibleMask=new egret.Sprite,this.invisibleMask.graphics.beginFill(0,0),this.invisibleMask.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),this.invisibleMask.graphics.endFill(),this.invisibleMask.touchEnabled=!0,this.invisibleMask.visible=!1,this.gp_root.addChild(this.invisibleMask),this.darkMask=new egret.Sprite,this.darkMask.graphics.beginFill(0,.7),this.darkMask.graphics.drawRect(-100,-100,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale()+200,Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()+200),this.darkMask.graphics.endFill(),this.darkMask.touchEnabled=!0,this.gp_cardEffect.addChildAt(this.darkMask,0),this.gp_cardEffect.visible=!1,this.heroConfig=v.Config.allHeroConfig(),this.activateComponent()},e.prototype.updateView=function(e){var t=this;if(e){var i;if(this.params=e,this.curIndex=0,this.gp_effect.removeChildren(),DragonBoneTools.create("common_chouka_1",function(e){e.animation.play("common_chouka_1"),t.gp_effect.addChild(e)}),this.params.cost1&&(this.icon_cost_1.updateItem({cost:this.params.cost1,style:CommonIconStyle.RIGHT}),this.cus_resourceBar.updateBar([this.params.cost1])),this.params.cost10&&this.icon_cost_10.updateItem({cost:this.params.cost10,style:CommonIconStyle.RIGHT}),this.gp_jindu.visible=!1,0<e.freeTimes?(this.icon_cost_1.visible=!1,this.btn_gacha_1.label="免费"):(this.icon_cost_1.visible=!0,this.btn_gacha_1.label="召唤"),this.gp_component.visible=!1,this.btn_close.visible=!1,this.rewards=e.rewards,1<this.params.rewardLength)(i=new eui.TileLayout).horizontalGap=15,i.verticalGap=10,i.requestedColumnCount=5,this.gp_result.layout=i;else(i=new eui.HorizontalLayout).horizontalAlign=egret.HorizontalAlign.CENTER,i.verticalAlign=egret.VerticalAlign.MIDDLE,this.gp_result.layout=i;if(this.gp_result.removeChildren(),this.gp_fixedReward.removeChildren(),this.isJump)for(var n in Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_chouka),this.rewards){var o=this.rewards[n],a=this.heroConfig[o.code],r=new eui.Group;r.height=105,r.width=105;var s=customui.BaseItemFactory.create();s.updateData({type:o.type,code:o.code,num:o.num}),s.horizontalCenter=0,r.addChild(s),Number(n)<10?this.gp_result.addChild(r):(this.rewards.length<16?r.scaleX=r.scaleY=1:r.scaleX=r.scaleY=.8,this.gp_fixedReward.addChild(r)),a&&4<a.initStar&&DragonBoneTools.playOnce({effectName:"common_choukagaojiekuang",parent:r,loop:!0}),this.rewards[Number(n)+1]||this.chouKaEnd()}else this.showSingleResult(this.curIndex)}},e.prototype.showSingleResult=function(e,t){var i=this;if(void 0===t&&(t=!1),e==this.curIndex){this.insuranceTimer&&(egret.clearTimeout(this.insuranceTimer),this.insuranceTimer=void 0);var n=this.rewards[this.curIndex++];if(n){var o=this.heroConfig[n.code];if(t||this.params.showSpecialEffect&&!this.params.showSpecialEffect(n.code)){var a=new eui.Group;a.height=105,a.width=105;var r=customui.BaseItemFactory.create();r.updateData({type:n.type,code:n.code,num:n.num}),r.alpha=0,r.scaleX=.3,r.horizontalCenter=0,a.addChild(r),this.curIndex<11?this.gp_result.addChild(a):this.gp_fixedReward.addChild(a);var s=this.curIndex;egret.Tween.get(r).wait(200).to({alpha:1,scaleX:1},170),Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_chouka),DragonBoneTools.playOnce({effectName:"common_choukayingxiong",parent:a,doneCB:function(){o&&4<o.initStar&&DragonBoneTools.playOnce({effectName:"common_choukagaojiekuang",parent:a,loop:!0}),i.showSingleResult(s)}}),this.insuranceTimer=egret.setTimeout(function(){i.showSingleResult(i.curIndex)},this,1500)}else this.showCardEffectForCode(n.code),this.curIndex-=1}else this.chouKaEnd()}},e.prototype.chouKaEnd=function(){var t=this;DragonBoneTools.create("common_chouka_2",function(e){e.animation.play("common_chouka_2"),t.gp_effect.addChild(e),e.addEventListener(dragonBones.EventObject.COMPLETE,function(){},t)}),egret.Tween.get(this.gp_effect).wait(800).to({alpha:0},200).call(function(){t.gp_effect.removeChildren(),t.gp_effect.alpha=1,t.gp_fixedReward.numChildren?t.gp_component.verticalCenter=195.5:t.gp_component.verticalCenter=55.5,t.gp_component.visible=!0,t.btn_close.visible=!0,t.heroPy.canMakeGasha=!0,v.AppFacade.getInstance().sendNotification(CN.SHOW_WECHAT_SHARE),t.params.choukaEnd_cb&&t.params.choukaEnd_cb()})},e.prototype.showCardEffectForCode=function(e){var t=this;this.heroCard.alpha=0,this.heroCard.scaleX=.4,this.heroCard.updateView({code:e}),this.darkMask.alpha=0,this.gp_cardEffect.visible=!0,egret.Tween.get(this.darkMask).to({alpha:1},500).wait(200).call(function(){Utils.ShakeUtils.shakeObj(t.gp_cardEffect,1.21,60,7),egret.Tween.get(t.heroCard).wait(1210).call(function(){Utils.ShakeUtils.stop(),Utils.ShakeUtils.shakeObj(t.gp_cardEffect,.2,60,30)}).wait(540).to({alpha:1,scaleX:1},210),Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_chouka_wuxingka),DragonBoneTools.playOnce({effectName:"common_kapianfanzhuan",parent:t.gp_cardEffect,timeScale:1,doneCB:function(){t.invisibleMask.visible=!0}}),t.hideEffectTimer=egret.setTimeout(function(){t.hideCardEffect()},t,7e3)})},e.prototype.hideCardEffect=function(){var e=this;this.hideEffectTimer&&(egret.clearTimeout(this.hideEffectTimer),this.hideEffectTimer=void 0),this.invisibleMask.visible=!1,egret.Tween.get(this.gp_cardEffect).to({alpha:0},200).call(function(){e.gp_cardEffect.visible=!1,e.gp_cardEffect.alpha=1,e.showSingleResult(e.curIndex,!0)})},e.prototype.perShow=function(){return i.prototype.perShow.call(this)},e.prototype.addEffect=function(e,t,i){t&&!e?t.visible=i:e&&(t.visible=i,t.numChildren<=0&&(t.removeChildren(),DragonBoneTools.create(e,function(e){e.x=t.width/2,e.y=t.height/2,e.animation.play(),t.addChild(e)},this)))},e.prototype.activateComponent=function(){var e=this;this.btn_gacha_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.params.gacha_1_cb&&this.params.gacha_1_cb()},this),this.btn_gacha_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.params.gacha_10_cb&&this.params.gacha_10_cb()},this),this.img_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.invisibleMask.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hideCardEffect()},this),this.cb_needGuide.addEventListener(egret.Event.CHANGE,function(){e.isJump=e.cb_needGuide.selected},this)},e.prototype.hide=function(e){i.prototype.hide.call(this),this.params.close_cb&&this.params.close_cb()},e.prototype.onDestroy=function(){v.AppFacade.getInstance().sendNotification(CN.ACTIVITY_SHOW_TRIGGER)},e}(BaseFull);v.CommonGachaResultView=i,__reflect(i.prototype,"game.CommonGachaResultView")}(game||(game={})),function(p){var e=function(t){function e(){var e=t.call(this)||this;return e.heroPy=p.AppFacade.getInstance().retrieveProxy(p.HeroPy.N),e.skinName="HeroHaloSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list_item.itemRenderer=i},e.prototype.updateView=function(e){var t=e.codeList,r=this.heroPy.getActivatedHaloId(t),s={},c=p.Config.heroHaloConfig(),l=["slot1","slot2","slot3","slot4","slot5","slot6"],i=function(e){var i=c[e];if(i.haloType==HaloType.Normal){var t=i.type,n=i.subType;s[n]||(s[n]={type:t,subType:n,slot:[],showNum:0,attr:{},img:i.img});var o=s[n],a=o.slot;l.forEach(function(e,t){!a[t]&&i[e]&&a.push(i[e])}),0<=r.indexOf(i.id)&&(o.showNum=a.length),o.attr[a.length]=JSON.parse(i.attr)}};for(var n in c)i(n);var o=[];for(var a in s){var h=s[a];o.push(h)}o.sort(function(e,t){var i=0<e.showNum,n=0<t.showNum;return i!=n?n?1:-1:e.subType-t.subType}),o[0].first=!0,this.list_item.dataProvider=new eui.ArrayCollection(o)},e}(BasePanel);p.HeroHaloPanel=e,__reflect(e.prototype,"game.HeroHaloPanel");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroHaloPanel_HaloItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this);for(var e=0;e<6;e++)this.gp_condIcon.addChild(new eui.Image)},e.prototype.dataChanged=function(){var a=this;UIActionManager.setAbsGrey(this.img_haloIcon,0==this.data.showNum),this.img_haloIcon.source=this.data.img+"_png";for(var e=this.data.type,t=this.data.slot,i=0;i<6;i++){var n=t[i],o=this.gp_condIcon.$children[i];n?(o.visible=!0,o.source=e==HeroHaloType.Race?HeroRaceConfig[n].raceIconBig:ProfessionConfig[n].icon,UIActionManager.setAbsGrey(o,i>=this.data.showNum)):o.visible=!1}this.gp_line.removeChildren();var r=this.data.attr,s=[],c=Object.keys(r);c.forEach(function(e,t){var i=r[e],n="";if(i.forEach(function(e){n+=AttrConfig[e[0]].name+"+"+p.GeneralConfig.getAttrValue(e[1])+"  "}),n=n.slice(0,-2),s.push({text:"("+e+")"+n+"  ",style:{textColor:Number(e)<=a.data.showNum?8060672:8553090}}),t!=c.length-1){var o=new eui.Image("yingxiong_img_fengexian_png");o.x=44.2*Number(e)+26*(Number(e)-1+.5),a.gp_line.addChild(o)}}),this.lb_desc.textFlow=s,this.img_line.visible=!this.data.first},e}(eui.ItemRenderer);__reflect(i.prototype,"HeroHaloPanel_HaloItem")}(game||(game={})),function(e){var t=function(){function e(){}return e.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.BaseItemForChess",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},e}();e.BaseItemForChessFactory=t,__reflect(t.prototype,"customui.BaseItemForChessFactory");var i=function(t){function e(){var e=t.call(this)||this;return e.isHave=!1,e.skinName="BaseItemSkin",e}return __extends(e,t),e.prototype.resetFixedStyle=function(){this.isHave=!1,this.code=this.config=this.vo=void 0,this.decorateStar(1),this.gp_star_hero.removeChildren(),this.decorateIcon(""),this.decorateColorFrame(0),this.img_bg.source="_border_m_json.common_img_jichuwupingkuang",this.img_frame.parent.getChildIndex(this.img_frame)<this.img_icon.parent.getChildIndex(this.img_icon)&&this.img_frame.parent.swapChildren(this.img_frame,this.img_icon),this.decorateTypeIcon(""),this.decorateProfessionIcon(""),this.gp_effect.removeChildren()},e.prototype.updateData=function(e){this.vo=e.vo,this.code=e.code,this.isHave=!0,this.code||(this.code=this.vo.code),this.decorateHero(e)},e.prototype.decorateIcon=function(e){this.img_icon.source=e},e.prototype.decorateTypeIcon=function(e){this.img_type.visible=!0,this.img_type.source=e},e.prototype.decorateProfessionIcon=function(e){this.img_profession.visible=!0,this.img_profession.source=e},e.prototype.decorateEffect=function(e,t){DragonBoneTools.create("common_yingxiongtouxiangkuang",function(e){e.x=this.sl_effect.width/2,e.y=this.sl_effect.height/2,e.animation.play("common_yingxiongtouxiangkuang",0),this.gp_effect.addChild(e)},this)},e.prototype.decorateColorFrame=function(e){var t="";t=0==e?"_border_m_json.common_img_pinzhikuang_0":"_border_m_json.common_img_pinzhibian_"+(e+1),this.img_frame.scaleX=this.img_frame.scaleY=1.02,this.img_frame.source=t},e.prototype.decorateStar=function(e,t){if(this.gp_star_hero.visible=!1,this.gp_star_item.visible=!1,this.gp_star_hero2.visible=!1,!t){var i={src:"_border_m_json.common_icon_xingji",stage:1,num:e};if(i.stage<4){this.gp_star_hero.visible=!0,this.gp_star_hero.removeChildren(),this.gp_star_hero.layout.gap=-2*i.stage-3;for(var n=0;n<i.num;n++){var o=new eui.Image(i.src);o.scaleX=o.scaleY=.4,this.gp_star_hero.addChild(o)}}else this.gp_star_hero2.visible=!0,this.blb_star_hero2.text=i.num.toString()}},e.prototype.decorateHero=function(e){this.config=game.Config.chessHero()[this.code];var t=e&&e.noStar;this.decorateStar(this.config.initStar,t),this.decorateIcon(ResourceUtils.png(this.config.avatar)),this.decorateColorFrame(this.config.color),this.img_bg.source="_border_m_json.common_img_jichuwupingkuang",this.img_frame.parent.getChildIndex(this.img_frame)<this.img_icon.parent.getChildIndex(this.img_icon)&&this.img_frame.parent.swapChildren(this.img_frame,this.img_icon),this.config&&this.config.race&&this.decorateTypeIcon(HeroRaceConfig[this.config.race].raceIcon),this.decorateProfessionIcon(SubProfessionConfig[this.config.subProfession].icon)},e.prototype.reset=function(){this.x=this.y=0,this.touchEnabled=!0,this.visible=!0,this.scaleX=this.scaleY=1,this.horizontalCenter=this.verticalCenter=void 0,UIActionManager.setGrey(this,!1),this.img_type.source="",this.img_type2.source="",this.img_profession.source="",this.blb_level.text="",this.blb_num.text="",this.blb_num.visible=!0,this.img_type.visible=!0,this.gp_star_hero.visible=!0,this.code=void 0,this.img_frame.parent.setChildIndex(this.img_frame,0),this.img_frame.source="",this.img_frame.scaleX=this.img_frame.scaleY=1.08,this.img_icon.source="",this.img_icon.visible=!0,this.img_icon.width=this.img_icon.height=86,this.img_bg.source="_border_m_json.common_img_jichuwupingkuang2",this.gp_effect.removeChildren()},e.prototype.playEffect=function(e){DragonBoneTools.playOnce({effectName:e,parent:this.gp_main,x:this.gp_main.width/2,y:this.gp_main.height/2,scaleX:1,scaleY:1,keep:!1,loop:!1,doneCB:function(){}})},e.prototype.onOPReset=function(){this.reset()},e.prototype.onOPComeBack=function(e,t){e&&this.updateData(e)},e.prototype.onOPClean=function(){},e.prototype.onOPCheck=function(e){egret.log("alive")},e}(eui.Component);e.BaseItemForChess=i,__reflect(i.prototype,"customui.BaseItemForChess",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(customui||(customui={})),function(h){var e=function(t){function e(){var e=t.call(this)||this;return e.maxAwake=!1,e.selectedUuids=[],e.heroPy=h.GameMVC.heroPy,e.STATUS={PRACTICE:1,AWAKE:2,MAX:3},e.skinName="HeroPracticePanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.activateComponent(),this.rootPanel.blb_title.text="强者修炼",this.rootPanel.onCloseCB=function(){e.hide()}},e.prototype.updateView=function(e){var t=this;if(this.vo=e&&e.vo||this.vo,!this.heroModel.data){var i=void 0;0!=this.vo.dermaCode&&(i=h.Config.getHeroDermaConfig()[this.vo.dermaCode]),this.heroModel.update({code:this.vo.code,derma:i})}var n=this.vo.resonateLevelList[this.vo.resonateLevelList.length-1]||0;switch(this.pracConfigs=h.Config.heroPracticeConfig(this.vo.config.subType,n),this.pracConfigs.length?this.pracConfigs.some(function(e){if(e.order===t.vo.practiceLevel+1)return t.curPracConfig=e,!0})?this.curStatus=this.STATUS.PRACTICE:this.curStatus=this.STATUS.AWAKE:this.curStatus=this.STATUS.MAX,this.updateTopPart(),this.gp_practiceAttr.visible=!1,this.gp_baseitem.visible=!1,this.lb_max.visible=!1,this.btn_operate.visible=!0,this.icon_cost.visible=!0,this.curStatus){case this.STATUS.PRACTICE:this.gp_practiceAttr.visible=!0,this.updateForPractice();break;case this.STATUS.AWAKE:this.gp_baseitem.visible=!0,this.updateForAwake();break;case this.STATUS.MAX:this.lb_max.visible=!0,this.btn_operate.visible=this.icon_cost.visible=!1,this.updateForMax()}},e.prototype.updateTopPart=function(){var c=this,e=this.vo.resonateLevelList[this.vo.resonateLevelList.length-1]||0,t=this.curStatus===this.STATUS.MAX?e:e+1,l=this.vo.practiceLevel;this.pracConfigs=h.Config.heroPracticeConfig(this.vo.config.subType,t-1),this.pracConfigs.forEach(function(e){e.order===l+1&&(c.curPracConfig=e);var t=(e.order-1)%6+1,i=c["gp_attr_"+t],n=c["img_attr_"+t],o=c["blb_attr_"+t];n.source=e.icon+"_png";var a=JSON.parse(e.attr)[0][0];o.text=AttrConfig[a].name+"修炼",UIActionManager.setAbsGrey(i,l<e.order);var r=i.getChildByName("_effectOnObj");r&&r.parent.removeChild(r),l>=e.order&&DragonBoneTools.playOnce({effectName:"common_qzxljie",parent:i,loop:!0,z:1});var s=c["img_link_"+t];s&&(l<e.order?s.source=3===t?"juexing_img_xiantiao3_png":"juexing_img_xiantiao4_png":s.source=3===t?"juexing_img_xiantiao1_png":"juexing_img_xiantiao2_png")}),2<this.gp_badge.numChildren&&this.gp_badge.removeChildAt(1),DragonBoneTools.playOnce({effectName:"common_qzxlhuizhang_"+t,parent:this.gp_badge,loop:!0,z:1}),this.img_badge.source="juexing_img_duanwei"+t+"_png",this.blb_badge.text="修炼"+NUM_TO_ROMAN_NUM[t]+"阶"},e.prototype.updateForPractice=function(){this.scl_attrs.height=115;var e=JSON.parse(this.curPracConfig.attr)[0];this.lb_nextAttrName.text=""+AttrConfig[e[0]].name,this.blb_nextAttrValue.text="+"+h.GeneralConfig.getAttrValue(e[1]),this.gp_attrs.removeChildren();var t=h.Config.heroPracticeConfig(this.vo.config.subType),i={};for(var n in this.pracConfigs){var o=this.pracConfigs[n];i[JSON.parse(o.attr)[0][0]]="0"}for(var n in t){if((o=t[n]).order>this.vo.practiceLevel)break;var a=JSON.parse(o.attr)[0],r=h.GeneralConfig.getAttrValue(a[1]);i[a[0]]||(i[a[0]]="0");var s=i[a[0]];r.indexOf("%")<0?i[a[0]]=(Number(s)+Number(r)).toString():i[a[0]]=(Number(s.split("%")[0])+Number(r.split("%")[0])).toString()+"%"}for(var c in i)this.gp_attrs.addChild(this.makeAttrGp(Number(c),"+"+i[c]));var l=JSON.parse(this.curPracConfig.costs)[0];this.icon_cost.updateItem({cost:l,style:CommonIconStyle.RIGHT,needShowHave:!0}),this.lb_desc.text="当前修炼属性加成",this.btn_operate.label="修 炼"},e.prototype.updateForAwake=function(){var n=this;this.scl_attrs.height=65;var e=this.vo.resonateLevelList[this.vo.resonateLevelList.length-1]||0;if(!this.gp_baseitem.numChildren){var t=customui.BaseItemFactory.create();t.touchEnabled=!1,t.updateData({code:this.materialCode()}),this.gp_baseitem.addChild(t);var i=new eui.Image("common_img_jia_png");i.horizontalCenter=i.verticalCenter=0,this.gp_baseitem.addChild(i)}var o=this.gp_baseitem.getChildAt(0),a=this.gp_baseitem.getChildAt(1),r=!!this.selectedUuids.length;this.availableHeroNum();UIActionManager.setAbsGrey(o,!r),egret.Tween.removeTweens(a),r?a.visible=!1:(a.visible=!0,a.alpha=1,this.availableHeroNum()&&UIActionManager.fadeBlink(a,!0,!1,1e3)),this.gp_attrs.removeChildren(),h.Config.heroResonateConfig(this.vo.config.subType,e+1).forEach(function(e,t){var i=JSON.parse(e.attrAdd1)[0];n.gp_attrs.addChild(n.makeAttrGp(i[0],"+"+h.GeneralConfig.getAttrValue(i[1])))}),this.awakeLevelConfig=h.Config.heroResonateLevelConfig(this.vo.config.subType,e+1);var s=JSON.parse(this.awakeLevelConfig.costs)[0];this.icon_cost.updateItem({cost:s,style:CommonIconStyle.RIGHT,needShowHave:!0}),this.lb_desc.text="下一羁绊属性",this.btn_operate.label="觉醒"},e.prototype.updateForMax=function(){this.scl_attrs.height=190,this.scl_attrs.verticalCenter=308,this.img_bg.height=220,this.gp_attrs.removeChildren();var e=h.Config.heroPracticeConfig(this.vo.config.subType),t={};for(var i in this.pracConfigs){var n=this.pracConfigs[i];t[(o=JSON.parse(n.attr)[0])[0]]="0"}for(var i in e){if((n=e[i]).order>this.vo.practiceLevel)break;var o=JSON.parse(n.attr)[0],a=h.GeneralConfig.getAttrValue(o[1]);t[o[0]]||(t[o[0]]="0");var r=t[o[0]];a.indexOf("%")<0?t[o[0]]=(Number(r)+Number(a)).toString():t[o[0]]=(Number(r.split("%")[0])+Number(a.split("%")[0])).toString()+"%"}for(var s in t)this.gp_attrs.addChild(this.makeAttrGp(Number(s),"+"+t[s]))},e.prototype.makeAttrGp=function(e,t){var i=new eui.Group;i.width=160;var n=new eui.HorizontalLayout;n.verticalAlign=egret.VerticalAlign.MIDDLE,n.gap=10,i.layout=n;var o=new eui.Label(AttrConfig[e].name);o.size=22,o.textColor=8866344,i.addChild(o);var a=new eui.BitmapLabel;return a.font="white_num_fnt",a.text=t,i.addChild(a),i},e.prototype.availableHeroNum=function(){var e=h.GameMVC.heroPy.allHeroByUuid,t=0;for(var i in e){var n=e[i];this.heroFilter(n)&&(t+=1)}return t},e.prototype.heroFilter=function(e){return 0==e.pos&&e.config.subType==this.vo.config.subType&&e.uuid!=this.vo.uuid&&5==e.config.initStar},e.prototype.materialCode=function(){var e=h.Config.allHeroConfig(),t=this.vo.config.subType;for(var i in e){var n=e[i];if(n.subType===t&&5==n.initStar)return n.code}},e.prototype.checkAllActivated=function(){var e=this.vo.resonateLevelList[this.vo.resonateLevelList.length-1]||0;return this.heroPy.getHeroResonateOrders(this.vo).length==4*(e+1)},e.prototype.activateComponent=function(){var o=this;Utils.ComponentUtils.registerListener(this.btn_operate,egret.TouchEvent.TOUCH_TAP,function(){switch(o.curStatus){case o.STATUS.PRACTICE:if(o.vo.config.initStar<o.curPracConfig.starLevel)return void Utils.MsgUtils.addMidMsg("当前英雄星级不足");if(!o.checkAllActivated())return void Utils.MsgUtils.addMidMsg("当前羁绊未全部激活");var e=JSON.parse(o.curPracConfig.costs);if(!h.GameMVC.backpackPy.checkEnough(e,!1)){var t=h.GameMVC.backpackPy.getInfoByCode(e[0][1]);return void Utils.MsgUtils.addMidMsg("当前"+t.info.name+"不足")}o.heroPy.HeroPractice({uuid:o.vo.uuid,cb:function(){o.curPracConfig.order;o.updateView()}});break;case o.STATUS.AWAKE:if(o.vo.config.initStar<o.awakeLevelConfig.starLevel)return void Utils.MsgUtils.addMidMsg("当前英雄星级不足");e=JSON.parse(o.awakeLevelConfig.costs);if(!h.GameMVC.backpackPy.checkEnough(e,!1)){t=h.GameMVC.backpackPy.getInfoByCode(e[0][1]);return void Utils.MsgUtils.addMidMsg("当前"+t.info.name+"不足")}var i=o.vo.resonateLevelList[o.vo.resonateLevelList.length-1]||0;o.selectedUuids.length?o.heroPy.UnlockHeroResonate({uuid:o.vo.uuid,level:i+1,uuids:o.selectedUuids,cb:function(){DragonBoneTools.playOnce({effectName:"common_qzxlbaoqi",parent:o.heroModel.gp_root,y:o.heroModel.gp_root.height,doneCB:function(){h.AppFacade.getInstance().hideSubView(h.HeroMediator.N,h.HeroMediator.SV.HERO_PRACTICE)}})}}):Utils.MsgUtils.addMidMsg("未放入英雄");break;case o.STATUS.MAX:Utils.MsgUtils.addMidMsg("你能点到这个按钮说明程序出问题了")}},this),Utils.ComponentUtils.registerListener(this.gp_baseitem,egret.TouchEvent.TOUCH_TAP,function(){if(PopUpManager.addPopUp({obj:new h.CommonChosePanel({getInfos:function(){var e={},t=h.GameMVC.heroPy.allHeroByUuid;for(var i in t){var n=t[i];o.heroFilter(n)&&(e[n.uuid]=n)}return e},type:EEntityType.EEntityTypeHero,checkFull:function(e){return 1<=e.length},selectUuids:o.selectedUuids,title:"请选择英雄"}),closeCB:function(e){o.updateView()}}),!o.availableHeroNum()){var e=o.materialCode();Utils.MsgUtils.addMidMsg("当前没有5星"+h.Config.allHeroConfig()[e].name)}},this)},e}(BasePanel);h.HeroPracticePanel=e,__reflect(e.prototype,"game.HeroPracticePanel")}(game||(game={})),function(l){var e=function(t){function n(){var e=t.call(this)||this;return e.heroPy=l.AppFacade.getInstance().retrieveProxy(l.HeroPy.N),e.isReplace=!1,e.EFFECT_CONFIG={1:"common_zhihuanqian",2:"common_zhihuanfangru",3:"common_zhihuanchenggong"},e.skinName="HeroReplacementSkin",e.heroPy.getReplaceInfo(),e}return __extends(n,t),n.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.dtck_dtck.blb_title.text="置换",this.dtck_dtck.img_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.initUIEffect(this.EFFECT_CONFIG[n.EFFECT_TYPE.QIAN],n.EFFECT_TYPE.QIAN),this.addEvents(),this.initView()},n.prototype.initView=function(){this.btn_exchange.visible=!0,this.btn_cost.visible=!1,this.gp_stars.visible=!1,this.gp_name.visible=!1},n.prototype.addEvents=function(){this.btn_select.addEventListener(egret.TouchEvent.TOUCH_TAP,this.HelpDialog,this),this.btn_exchange.addEventListener(egret.TouchEvent.TOUCH_TAP,this.readyReplcement,this),this.hero_model0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectHero,this)},n.prototype.updateView=function(e){if(this.heroPy.replaceHeroInfo&&this.heroPy.replaceHeroInfo.uuid||e.uuid||e.hero){var t=void 0;this.curHeroInfo=e&&e.hero||this.heroPy.replaceHeroInfo;var i=e&&e.uuid||this.curHeroInfo.uuid;this.isReplace=e&&e.isReplace,this.isReplace?(this.hero_model0.touchEnabled=!1,this.hero_model0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.selectHero,this),this.curHeroInfo=l.Config.allHeroConfig()[this.heroPy.replaceHeroInfo.code],t=this.curHeroInfo,this.curHeroInfo.uuid=i,this.curHeroInfo.starLevel=this.curHeroInfo.initStar):(this.hero_model0.touchEnabled=!0,this.hero_model0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectHero,this),this.curHeroInfo=this.heroPy.allHeroByUuid[i],t=this.curHeroInfo.config),this.curHeroInfo?(this.btn_cost.visible=!0,this.gp_stars.visible=!0,this.gp_name.visible=!0):(this.btn_cost.visible=!1,this.gp_stars.visible=!1,this.gp_name.visible=!1),this.lb_name.text=t.name,this.hero_model.update({code:t.code,model:t.model,isStatic:!0}),this.img_race.source=HeroRaceConfig[t.race].raceIconBig,this.img_tier.source=l.GeneralConfig.getHeroJingyingTag(t.code);var n=l.GeneralConfig.getHeroStarInfo(this.curHeroInfo.starLevel);if(this.gp_stars.removeChildren(),n.stage<4)for(var o=0;o<n.num;o++)this.gp_stars.addChild(new eui.Image(n.src));else this.gp_stars.addChild(new customui.HighStarLevelIcon(n.num));var a=l.Config.heroReplacementConfig()[this.curHeroInfo.code];if(a){var r=JSON.parse(a.costs)[0],s=l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N).getInfoByCode(r[1]).haveNum||0,c=!(r[2]-s<0);this.btn_cost.updateItem({style:CommonIconStyle.RIGHT,cost:r,showEnough:c}),this.btn_cost.blb_num.text=s+"/"+r[2]}e&&e.effect&&this.switchEffect(e.effect)}else this.initView()},n.prototype.HelpDialog=function(){PopUpManager.addPopUp({obj:new l.HelpDialog({moduleId:MODULE.Replacement})})},n.prototype.selectHero=function(){l.AppFacade.getInstance().showSubView(l.HeroMediator.N,l.HeroMediator.SV.SELECT,{type:l.HeroSelectPanel.SELECTFORM.HERO_EXCHANGE,isPet:!1})},n.prototype.ensureReplacement=function(){this.isReplace=!1,this.btn_exchange.visible=!0,this.heroPy.affirmReplaceHero({uuid:this.curHeroInfo.uuid,isReplace:!0})},n.prototype.readyReplcement=function(){var t=this;if(this.curHeroInfo||this.heroPy.replaceHeroInfo.uuid){var e=l.Config.heroReplacementConfig()[this.curHeroInfo.code],i=JSON.parse(e.costs)[0],n=l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N).getInfoByCode(i[1]).haveNum||0;i[2]>n?Utils.MsgUtils.addMidMsg("您的道具不足"):"_hero_ar_m_json.common_img_chuanshuo"==this.img_tier.source?l.GameMgr.getInstance().showCommonTipsWin({commonTips:"当前英雄已经为传说级，是否需要置换？                          ",source:"hero_exchange",cb:!0,clickCB:function(e){1==e.type&&t.exchangeHero()}}):this.exchangeHero()}else Utils.MsgUtils.addMidMsg("未放入英雄")},n.prototype.exchangeHero=function(){var e=this;this.btn_exchange.touchEnabled=!1;var t=this.curHeroInfo&&this.curHeroInfo.uuid||this.heroPy.replaceHeroInfo&&this.heroPy.replaceHeroInfo.code;this.curHeroInfo,this.isReplace=!0,this.heroPy.replaceHero({uuid:t}),l.AppFacade.getInstance().updateView(l.HeroMediator.N,l.HeroMediator.SV.STARDOOR),egret.setTimeout(function(){e.btn_exchange.touchEnabled=!0},this,1e3)},n.prototype.cancelReplacement=function(){this.btn_exchange.visible=!0,this.heroPy.affirmReplaceHero({uuid:this.curHeroInfo.uuid,isReplace:!1})},n.prototype.initUIEffect=function(e,t,i){this["effect_"+t]?(this["effect_"+t].animation.play(),i&&i()):DragonBoneTools.create(e,function(e){this["effect_"+t]=e,this["effect_"+t].x=this.gp_effects.width/2,this["effect_"+t].y=this.gp_effects.height-100,this["effect_"+t].visible=!0,this["effect_"+t].animation.timeScale=1,this["effect_"+t].animation.play(),this.gp_effects.addChild(this["effect_"+t]),i&&i()},this)},n.prototype.switchEffect=function(e){var t=this;if(this.curEffect=this.curEffect?this.curEffect:n.EFFECT_TYPE.QIAN,e){var i;e!=this.curEffect&&(i=function(){t.curEffect!=n.EFFECT_TYPE.QIAN&&(t["effect_"+t.curEffect].animation.stop(),t["effect_"+t.curEffect].visible=!1),t["effect_"+e].visible=!0,t.curEffect=e}),this.initUIEffect(this.EFFECT_CONFIG[e],e,i)}else{this.initUIEffect(this.EFFECT_CONFIG[this.curEffect],this.curEffect,function(){t.curEffect=e})}},n.prototype.perClose=function(){this.heroPy.replaceHeroInfo&&this.isReplace&&this.cancelReplacement()},n.EFFECT_TYPE={QIAN:1,FANGRU:2,CHENGGONG:3},n}(BasePanel);l.HeroReplacementView=e,__reflect(e.prototype,"game.HeroReplacementView")}(game||(game={})),function(d){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroResonateAttrSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list_item.itemRenderer=i,this.ac_item=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_item},e.prototype.updateView=function(e){var t=e.vo,i=t.config.subType,n=d.GameMVC.heroPy.getHeroResonateOrders(t),o=[{level:0,attrs:[],activated:!0}],a=d.Config.heroResonateConfig(i,0);for(var r in a){var s=a[r],c=JSON.parse(s.attrAdd1);o[0].attrs.push({attr:c,activated:0<=n.indexOf(s.order)})}for(var l=1,h=d.Config.heroResonateLevelConfig(i,l);h;){a=d.Config.heroResonateConfig(i,l);var p={level:l,starLevel:h.starLevel,attrs:[],activated:!1};for(var r in a){s=a[r];p.attrs.push({attr:JSON.parse(s.attrAdd1),activated:0<=n.indexOf(s.order)})}p.activated=0<=t.resonateLevelList.indexOf(l),o.push(p),h=d.Config.heroResonateLevelConfig(i,++l)}this.ac_item.replaceAll(o)},e}(BasePanel);d.HeroResonateAttrPanel=e,__reflect(e.prototype,"game.HeroResonateAttrPanel");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroResonateAttrPanel_ListItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var n=this,e=[];0===this.data.level?e.push({text:"初级羁绊属性"}):e.push({text:"羁绊"+NUM_TO_ROMAN_NUM[this.data.level]+"属性"});var t=this.data.attrs,o=!0;t.forEach(function(e,t){var i=e.attr;n["lb_attr"+(t+1)].text=AttrConfig[i[0][0]].name+"加成："+d.GeneralConfig.getAttrValue(i[0][1]),n["lb_attr"+(t+1)].textColor=e.activated?16775908:8878698,o=o&&e.activated}),o?this.img_status.visible=!1:(this.img_status.visible=!0,this.img_status.source=this.data.activated?"jiban_img_yijihuo_png":"jiban_img_weijihuo_png",0!=this.data.level&&e.push({text:"（"+this.data.starLevel+"星解锁）",style:{textColor:6091519}})),this.lb_title.textFlow=e},e}(eui.ItemRenderer);__reflect(i.prototype,"HeroResonateAttrPanel_ListItem")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.heroPy=a.GameMVC.heroPy,e.available=!0,e.selectedUuids=[],e.skinName="HeroResonateUnlockSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent()},e.prototype.updateView=function(e){var n=this;this.heroVO=e&&e.vo||this.heroVO;var t=this.heroVO.config.subType;this.curLevel=this.heroVO.resonateLevelList[this.heroVO.resonateLevelList.length-1]||0,this.targetConfig=a.Config.heroResonateLevelConfig(t,this.curLevel+1);var i=this.targetConfig.selfNum;if(this.gp_slots.numChildren||this.gp_slots.addChild(new r),this.gp_slots.getChildAt(0).update({uuids:this.selectedUuids,requestNum:i,vo:this.heroVO,availableHeroNum:function(){return n.availableHeroNum()},heroFilter:function(e){return n.heroFilter(e)}}),a.Config.heroResonateConfig(t,this.curLevel).forEach(function(e,t){var i=JSON.parse(e.attrAdd1)[0];n["lb_cur_"+(t+1)].text=AttrConfig[i[0]].name+"加成："+a.GeneralConfig.getAttrValue(i[1])}),a.Config.heroResonateConfig(t,this.curLevel+1).forEach(function(e,t){var i=JSON.parse(e.attrAdd1)[0];n["lb_next_"+(t+1)].text=AttrConfig[i[0]].name+"加成："+a.GeneralConfig.getAttrValue(i[1])}),this.available){this.icon_cost.visible=!0,this.lb_tips.visible=!1;var o=JSON.parse(this.targetConfig.costs)[0];this.icon_cost.updateItem({cost:o,style:CommonIconStyle.RIGHT,needShowHave:!0})}else this.icon_cost.visible=!1,this.lb_tips.visible=!0,this.lb_tips.text="到达"+this.targetConfig.starLevel+"星且当前羁绊全部激活后可觉醒"},e.prototype.availableHeroNum=function(){var e=a.GameMVC.heroPy.allHeroByUuid,t=0;for(var i in e){var n=e[i];this.heroFilter(n)&&(t+=1)}return t},e.prototype.checkAllActivated=function(){var e=this.heroVO.resonateLevelList[this.heroVO.resonateLevelList.length-1]||0;return this.heroPy.getHeroResonateOrders(this.heroVO).length==4*(e+1)},e.prototype.checkStarAvailable=function(){var e=this.heroVO.config.subType,t=this.heroVO.resonateLevelList[this.heroVO.resonateLevelList.length-1]||0,i=a.Config.heroResonateLevelConfig(e,t+1);return this.heroVO.config.initStar>=i.starLevel},e.prototype.heroFilter=function(e){return 0==e.pos&&e.config.subType==this.heroVO.config.subType&&e.uuid!=this.heroVO.uuid&&5==e.config.initStar},e.prototype.activateComponent=function(){var o=this;Utils.ComponentUtils.registerListener(this.btn_auto,egret.TouchEvent.TOUCH_TAP,function(){if(o.selectedUuids.length<o.targetConfig.selfNum)if(o.availableHeroNum()){var e=[],t=o.heroPy.allHeroByUuid;for(var i in t){var n=t[i];o.heroFilter(n)&&e.push(n)}if(e.every(function(e){return e.isLocked}))Utils.MsgUtils.addMidMsg("该英雄已经被锁住");else{for(e.sort(function(e,t){var i=a.GameMVC.backpackPy.checkHeroInTeam(e.uuid);if(i!=a.GameMVC.backpackPy.checkHeroInTeam(t.uuid))return i?1:-1});o.selectedUuids.length<o.targetConfig.selfNum&&e.length;)o.selectedUuids.push(e.shift().uuid);o.updateView()}}else Utils.MsgUtils.addMidMsg("所需英雄不足")},this),Utils.ComponentUtils.registerListener(this.btn_unlock,egret.TouchEvent.TOUCH_TAP,function(){var e=o.checkAllActivated(),t=o.checkStarAvailable();e||t?t?e?o.selectedUuids.length<o.targetConfig.selfNum?Utils.MsgUtils.addMidMsg("觉醒条件不足"):o.heroPy.UnlockHeroResonate({uuid:o.heroVO.uuid,level:o.curLevel+1,uuids:o.selectedUuids,cb:function(){o.hide()}}):Utils.MsgUtils.addMidMsg("当前羁绊未全部激活"):Utils.MsgUtils.addMidMsg("该英雄星级未满足条件"):Utils.MsgUtils.addMidMsg(o.lb_tips.text)},this)},e.prototype.perShow=function(e){if(this.heroVO=e.vo,this.checkAllActivated()){if(!this.checkStarAvailable()){var t=this.heroVO.config.subType,i=this.heroVO.resonateLevelList[this.heroVO.resonateLevelList.length-1]||0,n=a.Config.heroResonateLevelConfig(t,i+1);Utils.MsgUtils.addMidMsg("该英雄需要到达"+n.starLevel+"星方可觉醒"),this.available=!1}}else Utils.MsgUtils.addMidMsg("需要激活当前全部羁绊方可觉醒"),this.available=!1;return!0},e}(BasePanel);a.HeroResonateUnlockPanel=e,__reflect(e.prototype,"game.HeroResonateUnlockPanel");var r=function(i){function e(e){var t=i.call(this)||this;return t.skinName="HeroArtifactPeiYangView4_SlotItem",t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){var o=this;i.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this,egret.TouchEvent.TOUCH_TAP,function(){if(PopUpManager.addPopUp({obj:new a.CommonChosePanel({getInfos:function(){var e={},t=a.GameMVC.heroPy.allHeroByUuid;for(var i in t){var n=t[i];o.heroFilter(n)&&(e[n.uuid]=n)}return e},type:EEntityType.EEntityTypeHero,checkFull:function(e){return e.length>=o.data.requestNum},selectUuids:o.data.uuids,title:"请选择英雄"}),closeCB:function(e){a.AppFacade.getInstance().updateView(a.HeroMediator.N,a.HeroMediator.SV.RESONATE_UNLOCK)}}),!o.availableHeroNum()){var e=o.getSelfCode();Utils.MsgUtils.addMidMsg("当前没有5星"+a.Config.allHeroConfig()[e].name)}},this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_bi.addChild(this.baseItem),this.data&&this.update(this.data)},e.prototype.update=function(e){this.data=e,this.availableHeroNum=e.availableHeroNum,this.heroFilter=e.heroFilter;var t=this.data.uuids.length,i=this.data.requestNum;this.blb_num.text=t+"/"+i,egret.Tween.removeTweens(this.img_add),this.img_add.alpha=1,t==i?(this.img_add.visible=!1,this.blb_num.font="green_num_fnt",UIActionManager.setGrey(this.gp_bi,!1)):(this.img_add.visible=!0,this.blb_num.font="white_num_fnt",this.availableHeroNum()>=this.data.requestNum&&UIActionManager.fadeBlink(this.img_add,!0,!1,1e3),UIActionManager.setGrey(this.gp_bi,!0)),this.baseItem.updateData({code:this.getSelfCode()})},e.prototype.getSelfCode=function(){var e=a.Config.allHeroConfig(),t=this.data.vo.config.subType;for(var i in e){var n=e[i];if(n.subType===t&&5==n.initStar)return n.code}},e}(eui.Component);__reflect(r.prototype,"HeroResonateUnlockPanel_SlotItem")}(game||(game={})),function(c){var i=function(t){function s(){var e=t.call(this)||this;return e.skinName="HeroSelectSkin",e.heroProxy=c.AppFacade.getInstance().retrieveProxy(c.HeroPy.N),e}return __extends(s,t),s.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.initFilterList(),this.activateComponent()},s.prototype.perShow=function(e){return this.selectType=this.selectType=e&&e.type||s.SELECTFORM.HERO_MAIN,!0},s.prototype.initList=function(){this.list_item.itemRenderer=e,UIActionManager.hideScrollerBar(this.scl_list)},s.prototype.initFilterList=function(){var e;switch(this.selectType){case s.SELECTFORM.HERO_MAIN:case s.SELECTFORM.HERO_ROLLBACK:e=[{icon:"_hero_ar_m_json.common_icon_zhongzu_1",race:HeroRaceType.Human},{icon:"_hero_ar_m_json.common_icon_zhongzu_2",race:HeroRaceType.Orc},{icon:"_hero_ar_m_json.common_icon_zhongzu_4",race:HeroRaceType.Elf},{icon:"_hero_ar_m_json.common_icon_zhongzu_3",race:HeroRaceType.Athanasy},{icon:"_hero_ar_m_json.common_icon_zhongzu_5",race:HeroRaceType.Demon},{icon:"_hero_ar_m_json.common_icon_zhongzu_6",race:HeroRaceType.Eldar}];break;case s.SELECTFORM.HERO_EXCHANGE:e=[{icon:"_hero_ar_m_json.common_icon_zhongzu_1",race:HeroRaceType.Human},{icon:"_hero_ar_m_json.common_icon_zhongzu_2",race:HeroRaceType.Orc},{icon:"_hero_ar_m_json.common_icon_zhongzu_4",race:HeroRaceType.Elf},{icon:"_hero_ar_m_json.common_icon_zhongzu_3",race:HeroRaceType.Athanasy}]}this.list_filter.itemRenderer=n,this.list_filter.dataProvider=new eui.ArrayCollection(e),this.list_filter.x=(this.gp_content.width-(80*e.length+15*(e.length-1)))/2,this.list_filter.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this)},s.prototype.onItemTap=function(e){var t=e.item.race;for(var i in this.selectedRace=this.selectedRace==t?0:t,this.list_filter.$children){var n=this.list_filter.$children[i];n.updateSelected(n.data.race==this.selectedRace)}this.scl_list.stopAnimation(),this.scl_list.viewport.scrollV=0,this.updateView()},s.prototype.updateView=function(e){var o=this;this.rootPanel.blb_title.text="英雄",this.btnFunc=e&&e.btnFunc||this.btnFunc;var a=[],n=this.heroProxy.allHeroByUuid,t=function(e){for(var t in n){var i=n[t];o.selectedRace&&i.config.race!=o.selectedRace||i.pos||!i.config.race||e(i)}};switch(this.selectType){case s.SELECTFORM.HERO_MAIN:if(this.targetPos=e&&e.pos||this.targetPos,!this.targetPos)for(var i=1;i<=6;i++)if(!this.heroProxy.heroUuid22Pos[i]){this.targetPos=i;break}t(function(e){a.push({type:o.selectType,info:e,btnFunc:function(){o.heroProxy.HeroPutOn({uuid:e.uuid,pos:o.targetPos}),o.hide()}})});break;case s.SELECTFORM.HERO_EXCHANGE:t(function(e){var t=c.Config.constConfig().HeroReplaceRange,i=c.Config.allHeroConfig(),n=JSON.parse(t.constValue);e.starLevel>=n[0]&&e.starLevel<=n[1]&&i[e.code]&&i[e.code].race!=HeroRaceType.Demon&&i[e.code].race!=HeroRaceType.Eldar&&a.push({type:o.selectType,info:e,btnFunc:function(){e.isLocked?Utils.MsgUtils.addMidMsg("该英雄已上锁"):(c.AppFacade.getInstance().updateView(c.HeroMediator.N,c.HeroMediator.SV.HERO_REPLACEMENT,{uuid:e.uuid,effect:c.HeroReplacementView.EFFECT_TYPE.FANGRU}),o.hide())}})});break;case s.SELECTFORM.HERO_ROLLBACK:var r=c.Config.heroRollBackConfig();t(function(e){r[e.starLevel]&&e.config.race&&e.config.profession&&a.push({type:o.selectType,info:e,btnFunc:function(){e.isLocked?Utils.MsgUtils.addMidMsg("该英雄已上锁"):(o.btnFunc&&o.btnFunc(e.uuid),o.hide())}})})}a.sort(function(e,t){var i=e.info,n=t.info;return e.type!=s.SELECTFORM.HERO_MAIN&&i.isLocked!=n.isLocked?i.isLocked?1:-1:i.starLevel!=n.starLevel?n.starLevel-i.starLevel:i.level!=n.level?n.level-i.level:i.config.race!=n.config.race?i.config.race-n.config.race:i.config.profession!=n.config.profession?HERO_SORT_ORDER[n.config.profession]-HERO_SORT_ORDER[i.config.profession]:i.config.code-n.config.code}),this.list_item.dataProvider=new eui.ArrayCollection(a),0<a.length?this.gp_empty.visible=!1:this.gp_empty.visible=!0},s.prototype.activateComponent=function(){var e=this;this.rootPanel.onCloseCB=function(){e.hide()}},s.SELECTFORM={HERO_MAIN:1,HERO_EXCHANGE:2,HERO_ROLLBACK:3},s}(BasePanel);c.HeroSelectPanel=i,__reflect(i.prototype,"game.HeroSelectPanel");var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroSelectPanel_HeroItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_oper.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.btnFunc&&this.data.btnFunc()},this),this.gp_baseitem.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().showSubView(c.HeroMediator.N,c.HeroMediator.SV.HERO_DETAIL,{code:this.data.info.code})},this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem)},e.prototype.dataChanged=function(){var e=void 0,t=!1;0==this.data.info.dermaCode?(e=this.data.info.config.avatar,this.lb_name.text=this.data.info.config.name):(e=c.Config.getHeroDermaConfig()[this.data.info.dermaCode].avatar,this.lb_name.text=c.Config.getHeroDermaConfig()[this.data.info.dermaCode].name,t=!0),this.baseItem.updateData({uuid:this.data.info.uuid,type:EEntityType.EEntityTypeHero,effect:!0,isShowZhongZhu:!0,avatar:e,isShowEffect:t}),this.data.type!=i.SELECTFORM.HERO_MAIN?(this.gp_lock.visible=this.data.info.isLocked,UIActionManager.setGrey(this.gp_baseitem,this.data.info.isLocked)):this.gp_lock.visible=!1},e}(eui.ItemRenderer);__reflect(e.prototype,"HeroSelectPanel_HeroItem");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroSelectPanel_TabbarItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.selected=!1},e.prototype.dataChanged=function(){this.width=80,this.img_icon.source=this.data.icon,this.updateSelected(this.selected)},e.prototype.updateSelected=function(e){this.selected=e,this.img_selected.visible=this.selected},e}(eui.ItemRenderer);__reflect(n.prototype,"HeroSelectPanel_TabbarItem")}(game||(game={})),function(g){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroUpsectionSkin",e.heroPy=g.AppFacade.getInstance().retrieveProxy(g.HeroPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.addListener(),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.heroPy.HeroUpSection({uuid:this.data.uuid})},this)},e.prototype.addListener=function(){this.skill_item.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.showSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_END,this.hideSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.hideSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.hideSkillDetail,this)},e.prototype.initList=function(){this.attr_list.itemRendererSkinName="HeroUpsectionPanel_AttrItem"},e.prototype.updateView=function(e){var t=this;this.data=e.data,this.isPet=e.isPet;this.data.level;var i=g.Config.heroAndPetSectionConfig(this.isPet),n=i[this.data.sectionLevel+1],o=i[this.data.sectionLevel],a=i[this.data.sectionLevel+2],r=g.Config.allHeroConfig(this.isPet)[this.data.code],s=[];s.push({desc:"等级上限：",before:n.level,after:Math.min(r.maxLevel,a&&a.level||9999999)});var c=JSON.parse(n.attr),l=JSON.parse(o&&o.attr),h=JSON.parse(this.data.attr);c.forEach(function(t){var i=0;l.forEach(function(e){t[0]==e[0]&&(i=e[1])});var e={desc:AttrConfig[t[0]].name+"：",before:Math.floor(Number(g.GeneralConfig.getAttrValue(h[t[0]]))).toString()};e.after=Math.floor(Number(e.before)+Number(g.GeneralConfig.getAttrValue(t[1]))-Number(g.GeneralConfig.getAttrValue(i))).toString(),s.push(e)}),this.attr_list.dataProvider=new eui.ArrayCollection(s),this.gp_unlock.visible=!1;var p=JSON.parse(r.skillUnlock).indexOf(n.id);if(-1!=p){var d=r[SKILL_CODE[p]];d&&(this.gp_unlock.visible=!0,this.skill_item.updateItem({code:d}),this.skillDetailPanel.updateItem({code:d}))}var u=JSON.parse(n.costs);u.forEach(function(e){t.gp_cost.addChild(new customui.CommonIconWithNum({cost:e,showEnough:!0,style:CommonIconStyle.RIGHT}))}),this.resource_bar.updateBar(u)},e.prototype.showSkillDetail=function(){this.skillDetailPanel.visible=!0},e.prototype.hideSkillDetail=function(){this.skillDetailPanel.visible=!1},e}(BasePanel);g.HeroUpsectionPanel=e,__reflect(e.prototype,"game.HeroUpsectionPanel")}(game||(game={})),function(u){var e=function(t){function e(){var e=t.call(this)||this;return e.heroProxy=u.AppFacade.getInstance().retrieveProxy(u.HeroPy.N),e.backpackPy=u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N),e.skinName="HeroUpstarSelectSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.activateComponent()},e.prototype.initList=function(){this.ac_list=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_list,this.list_item.itemRenderer=i,this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListItemTap,this)},e.prototype.onListItemTap=function(e){var t=this,i=e.item,n=i.info;n.isLocked?Utils.MsgUtils.addMidMsg("该"+ENTITY_2_NAME[n.entityType]+"已经被锁住"):i.chosen?(this.upstarData[this.slot].uuids.splice(this.upstarData[this.slot].uuids.indexOf(n.uuid),1),this.full=!1,this.upstarData[this.slot].full=this.full,i.chosen=!1,this.ac_list.replaceAll(this.ac_list.source),this.updateCondition()):this.full?Utils.MsgUtils.addMidMsg("当前已选满"):u.GameMgr.getInstance().showCommonTipsWin({commonTips:"是否要将该精英英雄用于升星，升星后会被消耗",clickCB:function(e){e.type&&(t.upstarData[t.slot].uuids.push(n.uuid),t.full=t.checkFull(),t.upstarData[t.slot].full=t.full,i.chosen=!0,t.ac_list.replaceAll(t.ac_list.source),t.updateCondition())},directCall:function(){return 70<=u.GameMVC.playerPy.playerInfoVO.level||!t.heroProxy.checkJingYing(n)||1===JSON.parse(t.upstarData[t.slot].condition)[0]},source:"HERO_UPSTAR_SELECT",cb:!0})},e.prototype.checkFull=function(){var e=JSON.parse(this.upstarData[this.slot].condition);return 1==e[0]&&this.upstarData[this.slot].uuids.length==e[1][0][2]||2==e[0]&&this.upstarData[this.slot].uuids.length==e[1][3]},e.prototype.updateView=function(e){var o=this,t=[],i=u.Config.allHeroConfig();this.upstarData=e&&e.data||this.upstarData,this.slot=e&&e.slot||this.slot,this.full=this.checkFull(),this.targetHero=this.heroProxy.allHeroByUuid[e.targetUuid];var n=[];for(var a in this.upstarData)n=n.concat(this.upstarData[a].uuids);for(var r=JSON.parse(this.upstarData[this.slot].condition),s=this.heroProxy.allHeroByUuid,c=0,l=this.upstarData[this.slot].uuids;c<l.length;c++){s[h=l[c]]&&t.push({info:s[h],chosen:!0})}for(var h in s){var p=s[h],d=i[p.code];p&&h!=this.targetHero.uuid&&-1==n.indexOf(h)&&!this.heroProxy.heroUuid22Pos[h]&&(1==r[0]?p.code==r[1][0][1]&&t.push({info:p,chosen:!1}):2==r[0]&&(0!=r[1][0]&&d.race!=r[1][0]||0!=r[1][1]&&p.starLevel!=r[1][1]||0!=r[1][2]&&d.profession!=r[1][2]||t.push({info:p,chosen:!1})))}t.length?(this.gp_empty.visible=!1,this.btn_confirm.visible=!0):(this.gp_empty.visible=!0,this.btn_confirm.visible=!1),t.sort(function(e,t){var i=e.info,n=t.info;return i.isLocked!=n.isLocked?i.isLocked?1:-1:o.backpackPy.checkHeroInTeam(i.uuid)&&!o.backpackPy.checkHeroInTeam(n.uuid)?1:!o.backpackPy.checkHeroInTeam(i.uuid)&&o.backpackPy.checkHeroInTeam(n.uuid)?-1:i.code!=n.code?i.code-n.code:i.level-n.level}),this.ac_list.replaceAll(t)},e.prototype.updateCondition=function(){var e=JSON.parse(this.upstarData[this.slot].condition),t=u.Config.allHeroConfig();1==e[0]?(t[e[1][0][1]].name,e[1][0][2],this.upstarData[this.slot].uuids.length):2==e[0]&&("任意",0<e[1][1]?e[1][1]+"星":"",0<e[1][2]?""+ProfessionConfig[e[1][1]]:"",0<e[1][0]?""+HeroRaceConfig[e[1][0]]:"",e[1][3],this.upstarData[this.slot].uuids.length)},e.prototype.activateComponent=function(){this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.AppFacade.getInstance().hideSubView(u.HeroMediator.N,u.HeroMediator.SV.SELECT_UPSTAR)},this)},e.prototype.perClose=function(){u.AppFacade.getInstance().updateView(u.HeroMediator.N,u.HeroMediator.SV.MAIN),u.AppFacade.getInstance().updateView(u.HeroMediator.N,u.HeroMediator.SV.HERO_QUICK_TRAIN)},e}(BasePanel);u.HeroUpstarSelectPanel=e,__reflect(e.prototype,"game.HeroUpstarSelectPanel");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="CommonChosePanelItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_bi.addChild(this.baseItem)},e.prototype.dataChanged=function(){this.baseItem.updateData({uuid:this.data.info.uuid,type:EEntityType.EEntityTypeHero}),this.data.info.isLocked?this.gp_lock.visible=!0:this.gp_lock.visible=!1,this.updateChosen(this.data.chosen),UIActionManager.setGrey(this.gp_bi,this.data.chosen||this.data.info.isLocked)},e.prototype.updateChosen=function(e){this.gp_chosen.visible=e},e}(eui.ItemRenderer);__reflect(i.prototype,"HeroUpstarSelectPanel_HeroItem")}(game||(game={})),function(n){var e=function(i){function e(){var t=i.call(this)||this;return t.moveGuild=100,t.moneyType=[],t.XIYOU_CONFIG={1:"common_shikongzhimen_lan",2:"common_shikongzhimen_hong",3:"common_shikongzhimen_lv",4:"common_shikongzhimen_zi",5:"common_shikongzhimen_ga"},t.heroType={Human:1,Orc:2,Elf:3,Athanasy:4,DemonEldar:5},Utils.AssetsMgr.loadGroup("group_star_door"),t.skinName="StarDoorSkin",t.heroPy=n.AppFacade.getInstance().retrieveProxy(n.HeroPy.N),t.backPackProxy=n.AppFacade.getInstance().retrieveProxy(n.BackpackPy.N),t.isRote=!0,t.once(egret.Event.REMOVED_FROM_STAGE,function(){for(var e in t.heroType)t.heroType[e]},t),t}return __extends(e,i),e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_star_door")},e.prototype.childrenCreated=function(){var e,t;i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btn),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cu_resBar),this.race=1,this.dicPoint=((e={})[1]=1,e[2]=2,e[3]=3,e[4]=4,e[5]=5,e),this.POINT=((t={})[1]={position:{x:Utils.DeviceUtils.curWidth()/2-133-100+225,y:670},sacle:1.6,index:3},t[2]={position:{x:Utils.DeviceUtils.curWidth()/2-270-100+135,y:505},sacle:1,index:2},t[3]={position:{x:Utils.DeviceUtils.curWidth()/2-100+6,y:376},sacle:.7,index:0},t[4]={position:{x:Utils.DeviceUtils.curWidth()/2-100+206,y:376},sacle:.7,index:0},t[5]={position:{x:Utils.DeviceUtils.curWidth()/2+174-100+146,y:505},sacle:1,index:1},t),this.initConfig(),this.activeComponent(),this.initEffect(),this.addNotice()},e.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.GASHA_RACE_TIMES,this.btn_reward.iconDisplay,this,BTN_ICON_NOTICE_POS)},e.prototype.removeNotice=function(){NoticeManager.removeNoticeListener(NT.GASHA_RACE_TIMES)},e.prototype.initEffect=function(){var e=function(e){var t=n.heroType[e],i=n.POINT[t];n["group_race"+t]=new eui.Group,n["group_race"+t].touchEnabled=!1,n["group_race"+t].x=i.position.x,n["group_race"+t].y=i.position.y,n["group_race"+t].width=10,n["group_race"+t].height=10,n.gp_chooseRace.addChildAt(n["group_race"+t],i.index),DragonBoneTools.create(n.XIYOU_CONFIG[t],function(e){this["effect_race_"+t]=e,this["effect_race_"+t].x=0,this["effect_race_"+t].y=0,this["effect_race_"+t].scaleX=this["effect_race_"+t].scaleY=this.POINT[this.dicPoint[t]].sacle,this["effect_race_"+t].animation.timeScale=1,t==this.race&&this["effect_race_"+t].animation.play(this.XIYOU_CONFIG[t]),this["group_race"+t].addChild(this["effect_race_"+t])},n)},n=this;for(var t in this.heroType)e(t)},e.prototype.ScrollToMove=function(i){var n=this,e=function(e){var t=o.heroType[e];i<0?(egret.Tween.removeTweens(o["group_race"+t]),egret.Tween.get(o["group_race"+t]).to({x:o.POINT[o.dicPoint[t]-1<1?5:o.dicPoint[t]-1].position.x,y:o.POINT[o.dicPoint[t]-1<1?5:o.dicPoint[t]-1].position.y,scaleY:1,scaleX:1},500).call(function(){n.Xmove2(t)}),o["effect_race_"+t]&&egret.Tween.get(o["effect_race_"+t]).to({x:0,y:0,scaleY:o.POINT[o.dicPoint[t]-1<1?5:o.dicPoint[t]-1].sacle,scaleX:o.POINT[o.dicPoint[t]-1<1?5:o.dicPoint[t]-1].sacle},500).call(function(){}),o.gp_chooseRace.setChildIndex(o["group_race"+t],o.POINT[o.dicPoint[t]-1<1?5:o.dicPoint[t]-1].index),o.dicPoint[t]=o.dicPoint[t]-1<1?5:o.dicPoint[t]-1):(egret.Tween.removeTweens(o["group_race"+t]),egret.Tween.get(o["group_race"+t]).to({x:o.POINT[5<o.dicPoint[t]+1?1:o.dicPoint[t]+1].position.x,y:o.POINT[5<o.dicPoint[t]+1?1:o.dicPoint[t]+1].position.y,scaleY:1,scaleX:1},500).call(function(){n.Xmove2(t)}),o["effect_race_"+t]&&egret.Tween.get(o["effect_race_"+t]).to({x:0,y:0,scaleY:o.POINT[5<o.dicPoint[t]+1?1:o.dicPoint[t]+1].sacle,scaleX:o.POINT[5<o.dicPoint[t]+1?1:o.dicPoint[t]+1].sacle},500).call(function(){}),o.gp_chooseRace.setChildIndex(o["group_race"+t],o.POINT[5<o.dicPoint[t]+1?1:o.dicPoint[t]+1].index),o.dicPoint[t]=5<o.dicPoint[t]+1?1:o.dicPoint[t]+1),o["effect_race_"+t]&&o["effect_race_"+t].animation.stop(),1==o.dicPoint[t]&&(o.race=t,o["effect_race_"+t]&&o["effect_race_"+t].animation.play())},o=this;for(var t in this.heroType)e(t)},e.prototype.Xmove2=function(e){5==e&&(this.isRote=!0)},e.prototype.initConfig=function(){this.GACHA_TYPE_INFO={1:{money:"时空契约"},10:{money:"时空契约"}};var e=n.Config.gashaponEntry();for(var t in e){var i=e[t];i.type==GashaponType.Race&&(this.GACHA_TYPE_INFO[i.times].itemCosts=JSON.parse(i.itemCosts),this.GACHA_TYPE_INFO[i.times].moneyCosts=JSON.parse(i.moneyCosts))}},e.prototype.updateView=function(e){var t=this.GACHA_TYPE_INFO;this.icon_resource_1_race.updateItem({cost:t[1].itemCosts[0],style:CommonIconStyle.RIGHT,showEnough:!1}),this.icon_resource_10_race.updateItem({cost:t[10].itemCosts[0],style:CommonIconStyle.RIGHT,showEnough:!1}),this.updateTimes(),this.updateResourceBar()},e.prototype.updateTimes=function(){var e=this.heroPy.gashaponInfo,t=(Utils.TimerManager.getServerTime(),this.GACHA_TYPE_INFO.suffix,this.gp_dt_race,this.btn_gacha_1_race);this.icon_resource_1_race;e[3].freeTimes&&0<e[3].freeTimes?(t.label="免费"+e[3].freeTimes+"次",t.labelDisplay.horizontalCenter=0):(t.label="召唤",this.freeTimeTimer||(this.freeTimeTimer=egret.setInterval(this.updateTimes,this,1e3)))},e.prototype.updateResourceBar=function(){this.moneyType=[],this.moneyType.push(this.GACHA_TYPE_INFO[1].itemCosts[0]);var e=n.Config.heroReplacementConfig();for(var t in e){var i=JSON.parse(e[t].costs);this.moneyType.push(i[0]);break}this.cu_resBar.updateBar({costs:this.moneyType,width:190,needAdd:!0})},e.prototype.activeComponent=function(){var i=this;this.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){if(i.isFromCurTouchBegin&&i.isRote&&Math.abs(i.startPosX-e.localX)>i.moveGuild){i.isFromCurTouchBegin=!1;var t=e.localX-i.startPosX;i.ScrollToMove(0<t?-1:0),i.startPosX=void 0,i.isRote=!1}},this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){i.isFromCurTouchBegin=!0,i.startPosX=e.localX},this),this.addEventListener(egret.TouchEvent.TOUCH_END,function(e){i.isFromCurTouchBegin=!1,i.startPosX=void 0},this);var t=this.heroPy.gashaponInfo;Utils.TimerManager.getServerTime();this.btn_gacha_1_race.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.GACHA_TYPE_INFO;!(this.backPackProxy.checkEnough([e[1].itemCosts[0]],!1)||e[1].moneyCosts[0]&&this.backPackProxy.checkEnough([e[1].moneyCosts[0]],!1))&&t[3].freeTimes&&t[3].freeTimes<=0?Utils.MsgUtils.addMidMsg("您的"+this.GACHA_TYPE_INFO[1].money+"不足"):this.heroPy.MakeGashapon({type:GashaponType.Race,subType:this.race,times:1})},this),this.btn_gacha_10_race.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.GACHA_TYPE_INFO;!(this.backPackProxy.checkEnough([e[10].itemCosts[0]],!1)||e[10].moneyCosts[0]&&this.backPackProxy.checkEnough([e[10].moneyCosts[0]],!1))&&t[3].freeTimes&&t[3].freeTimes<=0?Utils.MsgUtils.addMidMsg("您的"+this.GACHA_TYPE_INFO[10].money+"不足"):this.heroPy.MakeGashapon({type:GashaponType.Race,subType:this.race,times:10})},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeRaceGashapon})},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_page_last.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.isRote&&(this.ScrollToMove(0),this.isRote=!1)},this),this.btn_page_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.isRote&&(this.ScrollToMove(-1),this.isRote=!1)},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new n.HelpDialog({moduleId:MODULE.StarDoor})})},this),this.btn_replace.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.AppFacade.getInstance().showSubView(n.HeroMediator.N,n.HeroMediator.SV.HERO_REPLACEMENT)},this),Utils.ComponentUtils.registerListener(this.btn_reward,egret.TouchEvent.TOUCH_TAP,function(){n.AppFacade.getInstance().showSubView(n.RankMediator.N,n.RankMediator.SV.COMMON,{module:"GACHA_RACE_ACHIEVMENT"})},this)},e.prototype.perClose=function(){for(var e in egret.clearInterval(this.freeTimeTimer),this.heroType){var t=this.heroType[e];this["effect_race_"+t]&&egret.Tween.removeTweens(this["effect_race_"+t])}},e}(BaseFull);n.StarDoorView=e,__reflect(e.prototype,"game.StarDoorView")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.proxy=o.AppFacade.getInstance().retrieveProxy(o.HeroChallengePy.N),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.HeroChallengeMainView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:this.proxy.GetChessInfo()}},n.prototype.onViewCreate=function(){this.sendNotification(CN.CITY_SWITCH_DBCLOCKPAUSE,!0)},n.N="HeroChallengeMediator",n.SV={MAIN:1,LIST:2},n}(BaseMediator);o.HeroChallengeMediator=e,__reflect(e.prototype,"game.HeroChallengeMediator")}(game||(game={})),function(i){var e=function(){function e(){}return e.registerAll=function(){(new t).register()},e}();i.HeroChallengeProcessor=e,__reflect(e.prototype,"game.HeroChallengeProcessor");var t=function(e){function t(){return e.call(this,"activity.ChessInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("ChessInfoP",t),i.AppFacade.getInstance().retrieveProxy(i.HeroChallengePy.N).chessInfo.update(t.chessInfo)},t}(i.ProcessorBase);i.ChessInfoP=t,__reflect(t.prototype,"game.ChessInfoP")}(game||(game={})),function(n){var t=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.eventCode=e.eventCode,this.isValid=e.isValid},e}(n.BaseVO);__reflect(t.prototype,"HCEventVO");var e=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.mapCode=e.mapCode,this.event=new t(e.event)},e}(n.BaseVO);__reflect(e.prototype,"MapInfoVO");var o=function(i){function e(e){var t=i.call(this)||this;return t.map=[],e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){var t=this;this.effects=e.effects,this.cMapCode=e.cMapCode,this.map.splice(0),e.map.forEach(function(e){t.map[e.mapCode]=e})},e}(n.BaseVO);__reflect(o.prototype,"ChessInfoVO");var i=function(t){function i(){var e=t.call(this,i.N)||this;return e.constValue={ChallengeThrowDiceCosts:void 0},e}return __extends(i,t),i.prototype.GetChessInfo=function(){var t=this;this.constValue.ChallengeThrowDiceCosts||(this.constValue.ChallengeThrowDiceCosts=JSON.parse(n.Config.constConfig().ChallengeThrowDiceCosts.constValue)),Utils.Socket.send("challenge","GetChessInfo",{}).then(function(e){t.chessInfo||(t.chessInfo=new o),t.chessInfo.update(e.chessInfo)})},i.prototype.ThrowDice=function(){Utils.Socket.send("challenge","ThrowDice",{}).then(function(e){n.AppFacade.getInstance().updateView(n.HeroChallengeMediator.N,n.HeroChallengeMediator.SV.MAIN,e)})},i.prototype.OneKeyThrowDice=function(){Utils.Socket.send("challenge","OneKeyThrowDice",{}).then(function(e){n.AppFacade.getInstance().updateView(n.HeroChallengeMediator.N,n.HeroChallengeMediator.SV.MAIN,e)})},i.N="HeroChallengePy",i}(BaseProxy);n.HeroChallengePy=i,__reflect(i.prototype,"game.HeroChallengePy")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="",e}return __extends(e,t),e}(BasePanel);e.HeroChallengeListPanel=t,__reflect(t.prototype,"game.HeroChallengeListPanel")}(game||(game={})),function(b){var e=function(i){function e(){var e=i.call(this)||this;return e.posArr=[],e.eventObjs={},e.gridNum=0,e.MOVE_TIME=300,e.PAUSE_TIME=200,e.proxy=b.AppFacade.getInstance().retrieveProxy(b.HeroChallengePy.N),Utils.AssetsMgr.loadGroup("group_hero_challenge"),e.skinName="HeroChallengeMainSkin",e}return __extends(e,i),e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_hero_challenge")},e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_produce),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_guide),Utils.DeviceUtils.setLiuHaiPingAdapter(this.resource_bar);var t=new egret.Shape;t.graphics.beginFill(0,.6),t.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),t.graphics.endFill(),this.gp_dice.addChildAt(t,0),this.gp_dice.visible=!1,DragonBoneTools.playOnce({effectName:"common_zoumadeng_1",parent:this.gp_machine,loop:!0,name:"effect"}),this.scl_map.scrollPolicyV=eui.ScrollPolicy.OFF,Utils.UnlockMgr.checkPass(MODULE.Challenge10x,!1).allow?(UIActionManager.setGrey(this.btn_oneKey,!1),Utils.TouchUtils.addTouchListener(this.btn_oneKey,function(){e.proxy.OneKeyThrowDice()})):(UIActionManager.setGrey(this.btn_oneKey,!0),Utils.TouchUtils.addTouchListener(this.btn_oneKey,function(){Utils.UnlockMgr.checkPass(MODULE.Challenge10x,!0)})),this.initMapPos(),this.activateComponent(),this.initTips()},e.prototype.initTips=function(){this.lb_produce1.textFlow=(new egret.HtmlTextParser).parse(String("<font>产出<font color= 0x50ff3e >绿</font>、<font color= 0x3febff >蓝</font>、<font color= 0xff5cf5 >紫</font>圣物</font>")),this.lb_produce2.textFlow=(new egret.HtmlTextParser).parse(String("<font>产出<font color= 0xff981f >橙色圣物</font></font>")),this.lb_produce3.textFlow=(new egret.HtmlTextParser).parse(String("<font>产出<font color= 0xff4949 >红色圣物</font></font>")),this.lb_produce4.textFlow=(new egret.HtmlTextParser).parse(String("<font>产出英雄碎片x50、</font>\n<font><font color= 0xff4949 >红色圣物</font>碎片x10</font>"))},e.prototype.initMapPos=function(){var n=this,o={1:[1,-1],2:[1,1],3:[-1,1],4:[-1,-1]},a=[this.startPoint.x,this.startPoint.y];this.startPoint.parent.removeChild(this.startPoint),this.posArr.push([a[0],a[1]]),[[1,2],[4,1],[1,4],[4,2],[3,1],[4,2],[1,3],[2,1],[1,1],[2,3],[1,1],[2,1],[1,2],[4,1],[1,2],[2,3],[3,1],[2,1],[3,4],[2,3],[3,2],[2,3],[3,2],[4,1],[3,1],[4,2],[1,1],[4,4],[3,2],[2,2],[3,1],[2,1],[3,2],[4,4]].forEach(function(e){for(var t=e[0],i=e[1];0<i--;)a[0]+=140*o[t][0]/2,a[1]+=74*o[t][1]/2,n.posArr.push([a[0],a[1]])}),this.gridNum=this.posArr.length},e.prototype.updateView=function(e){var t=this;this.proxy.chessInfo;if(e&&e.walkInfos){this.switchBtnAvailable(!1),this.walkInfos=e.walkInfos,this.curWalkRound=0;var i=e.diceNums;this.gp_dice2.removeChildren(),i.forEach(function(e){t.gp_dice2.addChild(new eui.Image("touzi_"+e+"_png"))}),this.gp_dice.visible=!0,this.gp_dice.alpha=0,this.gp_dice2.visible=!1,egret.Tween.get(this.gp_dice).to({alpha:1},300).call(function(){DragonBoneTools.playOnce({effectName:"common_toushaizi",parent:t.gp_dice,y:t.gp_dice.height/2+80,doneCB:function(){t.gp_dice2.visible=!0,egret.Tween.get(t.gp_dice).wait(700).to({alpha:0},300).call(function(){t.gp_dice.visible=!1,t.handleWalkInfo()})}})})}else e&&e.chessInfo?(this.switchBtnAvailable(!1),this.walkInfos=e,this.handleWalkInfo(!0)):this.realUpdate()},e.prototype.realUpdate=function(e){void 0===e&&(e=!0),this.me||(this.me=new n,this.me.scaleX=this.me.scaleY=1.1,this.gp_map.addChild(this.me),this.setObjToPos(this.me,this.proxy.chessInfo.cMapCode),this.me.dir=this.checkMyDir(),this.updateCamera(!0)),this.updateChessBoard();var t=this.proxy.constValue.ChallengeThrowDiceCosts[0];this.icon_cost.updateItem({cost:t,style:CommonIconStyle.RIGHT,needShowHave:!1}),this.gp_onekey.visible&&this.icon_costOnekey.updateItem({code:t[1],num:10*t[2],style:CommonIconStyle.RIGHT,needShowHave:!1}),this.icon_cost.blb_num.scaleX=this.icon_cost.blb_num.scaleY=this.icon_costOnekey.blb_num.scaleX=this.icon_costOnekey.blb_num.scaleY=1.15,this.resource_bar.updateBar({costs:this.proxy.constValue.ChallengeThrowDiceCosts}),e&&this.checkBoss()},e.prototype.checkBoss=function(){var t=this;if(0!=this.proxy.chessInfo.cMapCode){var e=this.proxy.chessInfo.cMapCode;this.proxy.chessInfo.map[e].event.isValid&&b.Config.getHeroChallengeEvent(this.proxy.chessInfo.map[e].event.eventCode).type==ChallengeEventType.AttackBoss&&b.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeHeroChallenge,pb1:"challenge",pb2:"ChallengeBoss",params:{mapCode:e},doneCB:function(e){t.proxy.chessInfo.update(e.cbRet.chessInfo),t.updateView()}})}},e.prototype.checkMyDir=function(){var e=this.me.mapCode,t=e+1==this.gridNum?0:e+1,i=this.posArr[e],n=this.posArr[t],o=n[0]-i[0],a=n[1]-i[1];return 0<o?0<a?2:1:0<a?3:4},e.prototype.handleWalkInfo=function(e){var i=this;if(void 0===e&&(e=!1),e){var n=this.me.mapCode;(s=this.walkInfos.chessInfo.cMapCode)==this.gridNum&&(s=0),this.me.switchStatus(!0);for(var o=egret.Tween.get(this.me),t=function(){var e=n+1;e>=a.gridNum&&(e-=a.gridNum),n=e;var t=a.posArr[e];o.call(function(){i.me.mapCode=e,i.updateCamera(!1,i.MOVE_TIME/3)}).to({x:t[0],y:t[1]},a.MOVE_TIME/3).call(function(){i.me.dir=i.checkMyDir()})},a=this;n!=s;)t();o.call(function(){i.me.switchStatus(!1),new Promise(function(e){b.AppFacade.getInstance().showSubView(b.CommonMediator.N,b.CommonMediator.SV.REWARD_PANEL,{rewards:i.walkInfos.clientReward,onCloseCB:e})}).then(function(){i.proxy.chessInfo.update(i.walkInfos.chessInfo),i.switchBtnAvailable(!0),i.realUpdate(!1)})})}else{var r=this.walkInfos[this.curWalkRound++];if(r){this.log("【DEBUG】: 第"+r.round+"轮移动开始");n=this.me.mapCode;var s=r.endCode,c=this.proxy.chessInfo.map[s].event.isValid&&this.proxy.chessInfo.map[s].event.eventCode||ChallengeEventType.Empty;s==this.gridNum&&(s=0),this.me.switchStatus(!0);o=egret.Tween.get(this.me);for(var l=function(){var e=n+1;e>=h.gridNum&&(e-=h.gridNum),n=e;var t=h.posArr[e];o.call(function(){i.me.mapCode=e,i.updateCamera()}).to({x:t[0],y:t[1]},h.MOVE_TIME).call(function(){i.me.dir=i.checkMyDir()})},h=this;n!=s;)l();o.call(function(){i.me.switchStatus(!1),i.log("【DEBUG】: 第"+r.round+"轮移动结束，开始处理表现"),i.log("【DEBUG】: eventType "+c+"     result "+r.result),new Promise(function(e){i.handleResule(r.result,c,e)}).then(function(){i.log("【DEBUG】: 第"+r.round+"轮移动表现处理完毕，准备下一步移动"),i.proxy.chessInfo.update(r.chessInfo),i.realUpdate(),i.handleWalkInfo()})})}else this.switchBtnAvailable(!0),this.log("【DEBUG】:所有移动完毕")}},e.prototype.handleResule=function(e,t,i){var n=this,o=JSON.parse(e);switch(t){case ChallengeEventType.Stop:Utils.MsgUtils.addMidMsg("停止"),i();break;case ChallengeEventType.Move:Utils.MsgUtils.addMidMsg("瞬移"),i();break;case ChallengeEventType.Empty:o&&o.rewardInfos?b.AppFacade.getInstance().showSubView(b.CommonMediator.N,b.CommonMediator.SV.REWARD_PANEL,{rewards:o.rewardInfos,onCloseCB:i}):i();break;case ChallengeEventType.Ahead:Utils.MsgUtils.addMidMsg("前进"),i();break;case ChallengeEventType.Backward:Utils.MsgUtils.addMidMsg("后退"),i();break;case ChallengeEventType.Ending:Utils.MsgUtils.addMidMsg("到达终点"),b.AppFacade.getInstance().showSubView(b.CommonMediator.N,b.CommonMediator.SV.REWARD_PANEL,{rewards:o.rewardInfos,onCloseCB:i});break;case ChallengeEventType.Box:this.log("宝箱事件类型"),b.AppFacade.getInstance().showSubView(b.CommonMediator.N,b.CommonMediator.SV.REWARD_PANEL,{rewards:o.rewardInfos,onCloseCB:i});break;case ChallengeEventType.Box2:this.log("宝箱事件类型2"),b.AppFacade.getInstance().showSubView(b.CommonMediator.N,b.CommonMediator.SV.REWARD_PANEL,{rewards:o.rewardInfos,onCloseCB:i});break;case ChallengeEventType.OnearmBandit:this.gp_machine.visible=!0;var a=this.gp_machine.getChildByName("effect"),r=[],s=[],c=b.Config.allHeroConfig();for(var l in c){var h=c[l];10==h.initStar&&h.isShow&&s.push(h)}for(;10!=r.length;){var p=Math.ceil(Math.random()*(s.length-1));r.push(s.splice(p,1)[0].avatar+"_png")}var d=function(){var e=Math.round(9*Math.random());return r[e]},u=function(e){for(var t=d();-1!=e.indexOf(t);)t=d();return t},g=[],f=o.playInfos[0].isWin;if(1==f){var _=d();g.push(_,_,_)}else if(2==f){_=d();g.push(_,_),g.push(u(g))}else g.push(u(g)),g.push(u(g)),g.push(u(g));for(var m=g.length-1;m;){var y=Math.round(Math.random()*m),v=g[y];g[y]=g[m],g[m]=v,m-=1}var T=[0,0,0],C=function(e,t){var i=n["img_slot_"+e];T[e-1]&&(egret.clearInterval(T[e-1]),T[e-1]=0),T[e-1]=egret.setInterval(function(){i.source=d()},n,1e3/t)},E=function(e){egret.clearInterval(T[e-1]),T[e-1]=0,n["img_slot_"+e].source=g[e-1]};egret.Tween.get(this).call(function(){C(1,10),C(2,10),C(3,10),a.animation.timeScale=1}).wait(1500).call(function(){E(1),C(2,20),C(3,20),a.animation.timeScale=1.5}).wait(1500).call(function(){E(2),C(3,30),a.animation.timeScale=2}).wait(1500).call(function(){a.animation.timeScale=0,E(3)}).wait(1e3).call(function(){b.AppFacade.getInstance().showSubView(b.CommonMediator.N,b.CommonMediator.SV.REWARD_PANEL,{rewards:o.rewardInfos,onCloseCB:function(){i(),n.gp_machine.visible=!1}})});break;case ChallengeEventType.PlayFinger:o&&o.rewardInfos.length?(this.log("猜拳赢了"),b.AppFacade.getInstance().showSubView(b.CommonMediator.N,b.CommonMediator.SV.REWARD_PANEL,{rewards:o.rewardInfos,onCloseCB:i})):(this.log("猜拳输了"),i());break;case ChallengeEventType.DoubleDice:Utils.MsgUtils.addMidMsg("双骰子"),i();break;case ChallengeEventType.AttackBoss:this.log("boss"),i()}},e.prototype.updateChessBoard=function(){var n=this,e=this.proxy.chessInfo;if(0==this.me.mapCode)for(var t in this.eventObjs){var i=this.eventObjs[t];i.parent&&i.parent.removeChild(i),delete this.eventObjs[t]}e.map.forEach(function(e){if(e){var t=e.event;if(t.isValid&&t.eventCode!=ChallengeEventType.Empty){if(!n.eventObjs[e.mapCode]){var i=n.createObj(t);n.gp_event.addChild(i),n.setObjToPos(i,e.mapCode),n.eventObjs[e.mapCode]=i}}else if(n.eventObjs[e.mapCode])(i=n.eventObjs[e.mapCode]).parent&&i.parent.removeChild(i),delete n.eventObjs[e.mapCode]}}),this.gp_event.$children.sort(function(e,t){return e.y-t.y})},e.prototype.createObj=function(e){var t;switch(e.eventCode){case ChallengeEventType.AttackBoss:t=new r(e);break;case ChallengeEventType.Ending:t=this.endingBox=new a(e);break;default:t=new o(e)}return t},e.prototype.updateCamera=function(e,t,i){var n=this;void 0===e&&(e=!1),this.scl_map.stopAnimation(),this.scl_map.validateNow();var o,a,r=(o=this.me.mapCode,(a=n.posArr[o][0]-n.scl_map.width/2)<0?a=0:a>n.scl_map.viewport.contentWidth-n.scl_map.width&&(a=n.scl_map.viewport.contentWidth-n.scl_map.width),a);e?(this.scl_map.viewport.scrollH=r,i&&i()):egret.Tween.get(this.scl_map.viewport).to({scrollH:r},t||this.MOVE_TIME).call(function(){i&&i()})},e.prototype.setObjToPos=function(e,t,i){void 0===i&&(i=!0),t==this.gridNum&&(t=0);var n=this.posArr[t];i?(e.x=n[0],e.y=n[1],e.mapCode=t):egret.Tween.get(e).to({x:n[0],y:n[1]}).call(function(){e.mapCode=t})},e.prototype.switchBtnAvailable=function(e){this.btn_roll.enabled=e,this.btn_return.enabled=e,this.btn_oneKey.enabled=e,this.scl_map.scrollPolicyH=e?eui.ScrollPolicy.ON:eui.ScrollPolicy.OFF},e.prototype.activateComponent=function(){var e=this;Utils.TouchUtils.addTouchListener(this.btn_return,function(){b.MainJumpConfig.jumpTo()}),Utils.TouchUtils.addTouchListener(this.btn_roll,function(){e.proxy.ThrowDice()}),Utils.TouchUtils.addTouchListener(this.btn_guide,function(){PopUpManager.addPopUp({obj:new b.HelpDialog({moduleId:MODULE.Challenge})})})},e}(BaseFull);b.HeroChallengeMainView=e,__reflect(e.prototype,"game.HeroChallengeMainView");var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.updateObj()},t.prototype.updateObj=function(){},t}(eui.Component);__reflect(t.prototype,"ChessObject");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroChallengeMainView_MapObject_Me",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.anchorOffsetX=50,this.anchorOffsetY=200,this.heroModel=new customui.RoleDynamicModel({reqStyle:ROLE_STYLE.Fashion}),this.heroModel.onArmatureLoadCB=function(){e.dir=e._dir},this.heroModel.x=this.gp_root.width/2,this.heroModel.y=this.gp_root.height,this.gp_root.addChild(this.heroModel)},e.prototype.updateObj=function(){},Object.defineProperty(e.prototype,"dir",{set:function(e){var t=this._dir=e;switch(this._dir){case 1:t=2;break;case 2:t=1;break;case 3:t=3;break;case 4:t=0}this.heroModel.onChangingDir(t)},enumerable:!0,configurable:!0}),e.prototype.switchStatus=function(e){this.heroModel.curModelAct=e?ROLE_ACTION_NAME.PB:ROLE_ACTION_NAME.DJ},e}(t);__reflect(n.prototype,"Me");var o=function(n){function e(e){var t=n.call(this)||this;return t.data=e,t.skinName="HeroChallengeMainView_MapObject_EventObject",t}return __extends(e,n),e.prototype.childrenCreated=function(){var i=this;n.prototype.childrenCreated.call(this),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.data.eventCode!=ChallengeEventType.Box&&this.data.eventCode!=ChallengeEventType.Box2||Utils.TouchUtils.addTouchListener(this,function(){var e=b.Config.getHeroChallengeEvent(i.data.eventCode),t=JSON.parse(e.contents);b.AppFacade.getInstance().showSubView(b.CommonMediator.N,b.CommonMediator.SV.REWARD_PANEL,{rewards:t,type:{title:"hdwp_txt_huodewupin_png"}})})},e.prototype.updateObj=function(){var e=b.Config.getHeroChallengeEvent(this.data.eventCode);this.img.source=e.img+"_png"},e}(t);__reflect(o.prototype,"EventObject");var a=function(i){function e(e){var t=i.call(this)||this;return t.data=e,t.skinName="HeroChallengeMainView_MapObject_EventObject",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height;var e=new eui.Image("yxtz_icon_qizhi_png");e.horizontalCenter=8,e.bottom=-12,this.addChild(e);var t=new eui.Image("yxtz_txt_qidian_png");t.horizontalCenter=-10,t.bottom=100,this.addChild(t),Utils.TouchUtils.addTouchListener(this,function(){var e=b.Config.getHeroChallengeEvent(ChallengeEventType.Ending),t=JSON.parse(e.contents);b.AppFacade.getInstance().showSubView(b.CommonMediator.N,b.CommonMediator.SV.REWARD_PANEL,{rewards:t,type:{title:"hdwp_txt_huodewupin_png"}})})},e}(t);__reflect(a.prototype,"EndingObject");var r=function(i){function e(e){var t=i.call(this)||this;return t.data=e,t.skinName="HeroChallengeMainView_MapObject_Me",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.anchorOffsetX=50,this.anchorOffsetY=200},e.prototype.updateObj=function(){if(!this.model){var e=new eui.Image("_guaji_m_json.yingxion_img_touying");e.horizontalCenter=0,e.bottom=-20,e.scaleX=e.scaleY=.6,this.gp_root.addChild(e),this.model=new customui.HeroDynamicModel,this.model.bottom=0,this.model.horizontalCenter=0,this.model.scaleX=this.model.scaleY=.4,this.gp_root.addChild(this.model)}var t=JSON.parse(this.data.content).bossCode,i=b.Config.getHeroChallengeBoss()[t],n=JSON.parse(i.creep1)[0];this.model.update({model:b.Config.allHeroConfig()[b.Config.creepConfig()[n].heroId].model,isStatic:!0})},e}(t);__reflect(r.prototype,"Creep")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.proxy=o.AppFacade.getInstance().retrieveProxy(o.HeroChallenge2Py.N),t.addNotice(),t}return __extends(n,i),n.prototype.addNotice=function(){NoticeManager.setChildType(NT.HERO_CHALLENGE,NT.COMMON_SHOP[ShopType.ShopTypeHeroChallenge])},n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.HeroChallenge2MainView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.GENERAL_PASS_DAY]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GENERAL_PASS_DAY:case CN.LOGIN_FINAL_DONE:this.proxy.isOpen()&&this.proxy.GetHeroChallengeInfo()}},n.N="HeroChallenge2Mediator",n.SV={MAIN:1},n}(BaseMediator);o.HeroChallenge2Mediator=e,__reflect(e.prototype,"game.HeroChallenge2Mediator")}(game||(game={})),function(i){var e=function(){function e(){}return e.registerAll=function(){(new t).register()},e}();i.HeroChallenge2Processor=e,__reflect(e.prototype,"game.HeroChallenge2Processor");var t=function(e){function t(){return e.call(this,"heroChallenge.HeroChallengeInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("HeroChallengeInfoP",t),i.AppFacade.getInstance().retrieveProxy(i.HeroChallenge2Py.N).updateInfo(t.info)},t}(i.ProcessorBase);i.HeroChallengeInfoP=t,__reflect(t.prototype,"game.HeroChallengeInfoP")}(game||(game={})),function(n){__reflect(function(){}.prototype,"HeroPositionVO");var o=function(){function e(e){this.heros=[],this.uuid22pos={},e&&this.updateData(e)}return e.prototype.updateData=function(e){var t=this;this.code=e.code,this.creeps=e.creeps,this.heros=e.heros,this.hCode=e.hCode,this.clear=e.clea,this.waitSelect=e.waitSelect,this.buffs=e.buffs,this.uuid22pos={},this.heros.forEach(function(e){t.uuid22pos[e.uuid]=e.battlePos,t.uuid22pos[e.battlePos]=e.uuid})},e.prototype.addHero=function(e){for(var t=0,i=1;i<=6;i++)if(!this.uuid22pos[i]){t=i;break}this.heros.push({uuid:e,battlePos:t}),this.uuid22pos[e]=t,this.uuid22pos[t]=e},e.prototype.removeHero=function(e){for(var t in this.heros){var i=this.heros[t];if(i.uuid==e){delete this.uuid22pos[i.uuid],delete this.uuid22pos[i.battlePos],this.heros.splice(Number(t),1);break}}},e}();__reflect(o.prototype,"HeroChallengeInfo");var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.firstGetData=!0,e.challengeInfo=new o,e}return __extends(i,t),i.prototype.updateInfo=function(e){if(this.challengeInfo.updateData(e),this.curMode=n.Config.heroChallengeStage(this.challengeInfo.code).model,n.AppFacade.getInstance().updateView(n.HeroChallenge2Mediator.N,n.HeroChallenge2Mediator.SV.MAIN),n.AppFacade.getInstance().sendNotification(CN.HERO_CHALLENGE_MODEL_UPDATE),this.firstGetData){this.firstGetData=!1;var t=n.AppFacade.getInstance().retrieveProxy(n.ShopPy.N);t.GetShopInfo(ShopType.ShopTypeHeroChallenge,function(e){t.curShopType=ShopType.ShopTypeHeroChallenge,t.updateShopInfo({info:e.shopInfo,type:ShopType.ShopTypeHeroChallenge})})}},i.prototype.GetHeroChallengeInfo=function(){var t=this;Utils.Socket.send("heroChallenge","GetHeroChallengeInfo",{}).then(function(e){t.updateInfo(e.info)})},i.prototype.HeroChangeFormation=function(t){Utils.Socket.send("heroChallenge","HeroChangeFormation",{heros:this.challengeInfo.heros}).then(function(e){t&&t()})},i.prototype.SelectBuff=function(e,t){var i=this;Utils.Socket.send("heroChallenge","SelectBuff",{index:e}).then(function(e){i.updateInfo(e.info),t&&t()})},i.prototype.isOpen=function(){if(!this.openDt){var e=n.AppFacade.getInstance().retrieveProxy(n.LoginPy.N),t=Number(n.Config.constConfig().HeroChallengeUnlockServerOpenDt.constValue),i=new Date(1e3*e.loginGameVO.serverOpenDt+24*t*3600*1e3);this.openDt=i.getTime()/1e3}return Utils.TimerManager.getServerTime()>=this.openDt},i.prototype.Challenge=function(){var i=this;n.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeHeroChallenge2,pb1:"heroChallenge",pb2:"Challenge",params:{heros:this.challengeInfo.heros},doneCB:function(e){e&&e.cbRet&&i.updateInfo(e.cbRet.info);var t=n.AppFacade.getInstance().retrieveProxy(n.FightPy.N);t.dailyFakeFight=!1,t.queueExceExitCB()}})},i.N="HeroChallenge2Py",i}(BaseProxy);n.HeroChallenge2Py=e,__reflect(e.prototype,"game.HeroChallenge2Py")}(game||(game={})),function(l){var e=function(t){function e(){var e=t.call(this)||this;return e.heroPy=l.AppFacade.getInstance().retrieveProxy(l.HeroPy.N),e.challengePy=l.AppFacade.getInstance().retrieveProxy(l.HeroChallenge2Py.N),e.skinName="HeroChallegne2MainSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initFormation(),this.addNotice(),this.activateComponent()},e.prototype.initFormation=function(){for(var o=this,a=this.challengePy.challengeInfo,e=a.heros.length-1;0<=e;){var t=a.heros[e].uuid;t&&!this.heroPy.heroUuid22Pos[t]&&a.removeHero(t),e-=1}for(var i=function(e){var t=r.heroPy.heroUuid22Pos[e];if(t){var i=new l.HeroMainView_HeroListItem;r.gp_formation.addChild(i),i.touchChildren=!1,Utils.TouchUtils.addTouchListener(i,function(){o.onItemTap(e)});var n=Utils.UnlockMgr.checkPass(e,!1);i.updateItem({uuid:t,unlock:n,info:r.heroPy.allHeroByUuid[r.heroPy.heroUuid22Pos[e]]}),a.uuid22pos[t]&&r.setItemChosenEffect(i,!0,!1)}},r=this,n=1;n<=6;n++)i(n)},e.prototype.updateView=function(e){var i=this,t=this.challengePy.challengeInfo;this.stageConfig=l.Config.heroChallengeStage(t.code),this.creepConfig=l.Config.heroChallengeCreep()[this.stageConfig.creep];var n=t.creeps[0],o=l.Config.allHeroConfig()[n];this.model.update({model:o.model,isStatic:!0}),this.lb_name.text="第"+this.stageConfig.num+"关",this.gp_boss_formation.removeChildren(),t.creeps.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({code:e}),i.gp_boss_formation.addChild(t)});var a=JSON.parse(this.stageConfig.rewards);for(var r in this.gp_rewards.removeChildren(),a){var s=a[r],c=customui.BaseItemFactory.create();c.scaleX=c.scaleY=.9,c.updateData({reward:s}),this.gp_rewards.addChild(c)}this.stageConfig.model==HeroChallengeModel.OneVsOne?this.maxNum=1:this.stageConfig.model==HeroChallengeModel.ThreeVsThree?this.maxNum=3:this.stageConfig.model==HeroChallengeModel.SixVsSix&&(this.maxNum=6),this.blb_maxNum.text=t.heros.length+"/"+this.maxNum,this.lb_clear.visible=t.clear&&!0,this.checkFull(),t.waitSelect.length&&PopUpManager.addPopUp({obj:new h({waitSelect:t.waitSelect}),clickDarkClose:!1})},e.prototype.onItemTap=function(e){var t=this.gp_formation.getChildAt(e-1);(t.chosen||this.maxNum!=this.challengePy.challengeInfo.heros.length)&&t.data.uuid&&(t.chosen?this.challengePy.challengeInfo.removeHero(t.data.uuid):this.challengePy.challengeInfo.addHero(t.data.uuid),this.setItemChosenEffect(t,!t.chosen),this.blb_maxNum.text=this.challengePy.challengeInfo.heros.length+"/"+this.maxNum)},e.prototype.setItemChosenEffect=function(e,t,i){if(void 0===i&&(i=!0),UIActionManager.setGrey(e.gp_baseitem,t),e.chosen=t){var n=new eui.Image("common_img_gouxuan_png");n.name="chosenSign",n.horizontalCenter=n.verticalCenter=0,e.addChild(n)}else{var o=e.getChildByName("chosenSign");o&&e.removeChild(o)}i&&this.checkFull()},e.prototype.checkFull=function(){var e=0<this.challengePy.challengeInfo.heros.length&&!this.challengePy.challengeInfo.clear;this.btn_battle.enabled=e,UIActionManager.setAbsGrey(this.btn_battle,!e);for(var t=1;t<=this.gp_formation.numChildren;t++){var i=this.gp_formation.getChildAt(t-1);i.chosen||UIActionManager.setAbsGrey(i,this.maxNum==this.challengePy.challengeInfo.heros.length)}},e.prototype.perClose=function(){this.challengePy.HeroChangeFormation()},e.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.COMMON_SHOP[ShopType.ShopTypeHeroChallenge],this.btn_shop,this,{percentX:.8})},e.prototype.activateComponent=function(){var o=this;this.gp_boss.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){o.gp_boss_details.visible=!0},this),this.gp_boss.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){o.gp_boss_details.visible=!1},this),this.gp_boss.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){o.gp_boss_details.visible=!1},this),this.gp_boss.addEventListener(egret.TouchEvent.TOUCH_END,function(){o.gp_boss_details.visible=!1},this),Utils.TouchUtils.addTouchListener(this.btn_battle,function(){o.challengePy.challengeInfo.heros.length?o.challengePy.Challenge():Utils.MsgUtils.addMidMsg("至少选择一名英雄出战")}),Utils.TouchUtils.addTouchListener(this.btn_rank,function(){l.AppFacade.getInstance().showSubView(l.RankMediator.N,l.RankMediator.SV.COMMON,{module:"HERO_CHALLENGE"})}),Utils.TouchUtils.addTouchListener(this.btn_formation,function(){o.challengePy.challengeInfo.heros.length?l.AppFacade.getInstance().showSubView(l.HeroMediator.N,l.HeroMediator.SV.FORMATION,{battlePosInfo:o.challengePy.challengeInfo.heros,cb:function(e){var t=[];for(var i in e){var n=e[i];n&&t.push({uuid:n.info.uuid,battlePos:Number(i)})}o.challengePy.challengeInfo.heros=t,o.challengePy.HeroChangeFormation()}}):Utils.MsgUtils.addMidMsg("未选择英雄")}),Utils.TouchUtils.addTouchListener(this.btn_buffEffect,function(){l.AppFacade.getInstance().showSubView(l.HeroMediator.N,l.HeroMediator.SV.ATTR_DETAIL,{info:{attr:o.challengePy.challengeInfo.buffs},fromHeroChallenge:!0})}),Utils.TouchUtils.addTouchListener(this.btn_shop,function(){l.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeHeroChallenge})}),Utils.TouchUtils.addTouchListener(this.btn_guide,function(){PopUpManager.addPopUp({obj:new l.HelpDialog({moduleId:MODULE.HeroChallenge})})}),Utils.TouchUtils.addTouchListener(this.btn_back,function(){l.MainJumpConfig.jumpTo()})},e}(BasePanel);l.HeroChallenge2MainView=e,__reflect(e.prototype,"game.HeroChallenge2MainView");var h=function(i){function e(e){var t=i.call(this)||this;return t.skinName="HeroChallenge2BuffSelectSkin",t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data&&this.updateView(this.data)},e.prototype.updateView=function(e){var n=this,t=e.waitSelect,o=l.Config.heroChallengeBuff();t.forEach(function(e,t){var i=new a({config:o[e]});Utils.TouchUtils.addTouchListener(i,function(){l.AppFacade.getInstance().retrieveProxy(l.HeroChallenge2Py.N).SelectBuff(t+1,function(){n.hide()})}),n.gp_root.addChild(i)})},e}(BasePanel);__reflect(h.prototype,"HeroChallenge2BuffSelectPanel");var t,a=function(i){function n(e){var t=i.call(this)||this;return t.skinName="HeroChallenge2MainView_BuffItem",t.data=e,t}return __extends(n,i),n.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.update()},n.prototype.update=function(){var e=this.data.config,t=e.attrType;this.img_icon.source=n.SRC_MAP[t].icon+"_png",this.img_attrName.source=n.SRC_MAP[t].attrName+"_png",this.blb_attr.text="+"+l.GeneralConfig.getAttrValue(e.value),this.lb_desc.text=AttrConfig[t].name+"增加"+l.GeneralConfig.getAttrValue(e.value)},n.SRC_MAP=((t={})[EAttrType.Atk]={icon:"yxtz2_img_gongji",attrName:"yxtz2_img_gonjizi"},t[EAttrType.Life]={icon:"yxtz2_img_shengming",attrName:"yxtz2_img_shengmingzi"},t[EAttrType.Defence]={icon:"yxtz2_img_fangyu",attrName:"yxtz2_img_fangyuzi"},t[EAttrType.ArmorBreak]={icon:"yxtz2_img_pojia",attrName:"yxtz2_img_pojiazi"},t[EAttrType.Crit]={icon:"yxtz2_img_baoji",attrName:"yxtz2_img_baojizi"},t[EAttrType.Parry]={icon:"yxtz2_img_gedang",attrName:"yxtz2_img_gedangzi"},t[EAttrType.FreeControl]={icon:"yxtz2_img_miankong",attrName:"yxtz2_img_miankongzi"},t[EAttrType.AntiInjury]={icon:"yxtz2_img_fanshang",attrName:"yxtz2_img_fanshangzi"},t[EAttrType.Miss]={icon:"yxtz2_img_shanbi",attrName:"yxtz2_img_shanbizi"},t[EAttrType.SockBlood]={icon:"yxtz2_img_xixue",attrName:"yxtz2_img_xixuezi"},t),n}(eui.Button);__reflect(a.prototype,"HeroChallenge2MainView_BuffItem")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroSpiritAllAttrPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateView=function(e){var t=(this.params=e).list;this.list_list.itemRenderer=n,this.list_list.dataProvider=new eui.ArrayCollection(t)},e}(BasePanel);i.HeroSpiritAllAttrPanel=e,__reflect(e.prototype,"game.HeroSpiritAllAttrPanel");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroSpiritAllAttrItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var e=this.data;this.lb_attr.text=AttrConfig[e[0]].name+"加成：",this.lb_num.text=i.GeneralConfig.getAttrValue(e[1])+""},e}(eui.ItemRenderer);__reflect(n.prototype,"HeroSpiritAllAttrItem")}(game||(game={})),function(n){var e=function(i){function o(e){void 0===e&&(e=null);var t=i.call(this,o.N,e)||this;return t.proxy=n.AppFacade.getInstance().retrieveProxy(n.HeroSpiritPy.N),t}return __extends(o,i),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,n.HeroSpiritMainView),this.addSubView(o.SV.UP_STAR_PANEL,n.HeroSpiritUpstarView),this.addSubView(o.SV.UP_INFO_PANEL,n.HeroSpiritUpInfoView),this.addSubView(o.SV.ALL_ATTR_SHOW,n.HeroSpiritAllAttrPanel)},o.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.CONFIG_ALL_LOADED,CN.HERO_SPIRIT_UPDATEMAIN]},o.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.HeroSpirit,!1).allow&&this.proxy.GetHeroSpiritInfo();break;case CN.HERO_SPIRIT_UPDATEMAIN:var t=this.getSubView(o.SV.MAIN);t&&t.updateView();var i=this.getSubView(o.SV.UP_STAR_PANEL);i&&i.updateView();var n=this.getSubView(o.SV.UP_INFO_PANEL);n&&n.updateView()}},o.N="HeroSpiritMediator",o.SV={MAIN:1,UP_STAR_PANEL:2,UP_INFO_PANEL:3,ALL_ATTR_SHOW:4},o}(BaseMediator);n.HeroSpiritMediator=e,__reflect(e.prototype,"game.HeroSpiritMediator")}(game||(game={})),function(e){var t=function(){function e(){}return e.registerAll=function(){},e}();e.HeroSpiritProcessor=t,__reflect(t.prototype,"game.HeroSpiritProcessor")}(game||(game={})),function(g){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.HeroSpiritInfo=void 0,e.playerproxy=g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N),e.addNotice(),e}return __extends(i,t),i.prototype.addNotice=function(){NoticeManager.registerCB(NT.HERO_SPIRIT_PAGE,this.checkChaterNotice,this),NoticeManager.registerCB(NT.HERO_SPIRIT_ACHIEVEMENT,this.checkAchievementNotice,this),NoticeManager.setChildType(NT.HERO_SPIRIT,[NT.HERO_SPIRIT_PAGE,NT.HERO_SPIRIT_ACHIEVEMENT])},i.prototype.checkAchievementNotice=function(){return!1},i.prototype.checkChaterNotice=function(){var e=this.getChaterList();for(var t in e)if(e[t])return!0;return!1},i.prototype.getLevelNum=function(e,t){var i=g.Config.heroSpiritConfig(e),n=0;for(var o in i)for(var a in this.HeroSpiritInfo)if(i[o].code==this.HeroSpiritInfo[a].code){n++;break}return n},i.prototype.judgeLock=function(e){var t={needLevel:0,needLevelNum:0,nowLockChapterNum:0,needLockChapterNum:0,lockNum:0},i=JSON.parse(g.Config.heroSpiritConfigByFirst(e.id).condition);if(t.needLevel=i[0],t.needLevelNum=i[1],this.playerproxy.playerInfoVO.level>=i[0]&&t.lockNum++,0!=i[1]){var n=this.getLevelNum(i[1],i[2]);t.nowLockChapterNum=n,t.needLockChapterNum=i[2],n>=i[2]&&t.lockNum++}else t.lockNum++;return t},i.prototype.getChaterList=function(){for(var e=[],t=this.HeroSpiritInfo,i=g.Config.heroSpiritChapterConfig(),n=0;n<i.length;n++){var o=2<=(s=this.judgeLock(i[n])).lockNum;if(n<2)e.push(!1);else if(e.push(!1),!o){!1;break}}for(var a=0;a<i.length;a++){var r=i[a].id,s=this.judgeLock(i[a]),c=g.Config.heroSpiritConfigByChapterId(r);for(var n in c){var l=!1;for(var h in t)if(t[h].code==c[n].code){l=!0;break}if(!l){for(var p=JSON.parse(c[n].costs),d=0,u=0;u<p.length;u++){g.GameMVC.backpackPy.getItemNumByCode(p[u][1])>=p[u][2]&&d++}if(d>=p.length&&2<=s.lockNum){e[a]=!0;break}}}}return e},i.prototype.getAllLevelInfo=function(){var e=0;for(var t in this.HeroSpiritInfo)e+=this.HeroSpiritInfo[t].level+1;return e},i.prototype.GetHeroSpiritInfo=function(t){var i=this;Utils.Socket.send("heroSpirit","GetHeroSpiritInfo",{}).then(function(e){i.HeroSpiritInfo=e.info.coreInfo,i.achieveTargeted=e.info.targeted,NoticeManager.updateNotice(NT.HERO_SPIRIT),t&&t()})},i.prototype.ActivateHeroSpirit=function(e,t){var i=this;Utils.Socket.send("heroSpirit","ActivateHeroSpirit",{code:e}).then(function(e){i.HeroSpiritInfo=e.info.coreInfo,i.achieveTargeted=e.info.targeted,g.AppFacade.getInstance().sendNotification(CN.HERO_SPIRIT_UPDATEMAIN),NoticeManager.updateNotice(NT.HERO_SPIRIT),t&&t()})},i.prototype.UpHeroSpiritStar=function(e,t){var i=this;Utils.Socket.send("heroSpirit","UpHeroSpiritStar",{code:e}).then(function(e){i.HeroSpiritInfo=e.info.coreInfo,i.achieveTargeted=e.info.targeted,g.AppFacade.getInstance().sendNotification(CN.HERO_SPIRIT_UPDATEMAIN),NoticeManager.updateNotice(NT.HERO_SPIRIT),t&&t()})},i.prototype.GetHeroSpiritAchievementRewards=function(e,t){var i=this;Utils.Socket.send("heroSpirit","GetHeroSpiritAchievementRewards",{id:e}).then(function(e){i.HeroSpiritInfo=e.info.coreInfo,i.achieveTargeted=e.info.targeted,g.GameMVC.backpackPy.handleClientReward(e.clientReward),NoticeManager.updateNotice(NT.HERO_SPIRIT),t&&t()})},i.N="HeroSpiritPy",i}(BaseProxy);g.HeroSpiritPy=e,__reflect(e.prototype,"game.HeroSpiritPy")}(game||(game={})),function(r){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroSpiritUpInfoView",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateView=function(e){e&&(this.params=e);var t=r.Config.heroSpiritUpstarConfig(this.params.code),i=[];for(var n in t)i.push(t[n]);this.list_recommend.itemRenderer=o,this.list_recommend.dataProvider=new eui.ArrayCollection(i)},e}(BasePanel);r.HeroSpiritUpInfoView=e,__reflect(e.prototype,"game.HeroSpiritUpInfoView");var o=function(t){function e(){var e=t.call(this)||this;return e.py=r.AppFacade.getInstance().retrieveProxy(r.HeroSpiritPy.N),e.skinName="HeroSpiritUpInfoViewItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.lb_attr.text=this.data.level+"星属性总加成";var e=!0;for(var t in this.py.HeroSpiritInfo)if(this.data.code==this.py.HeroSpiritInfo[t].code&&this.data.level<=this.py.HeroSpiritInfo[t].level){e=!1;break}this.img_get.visible=e,this.gp_attrs.removeChildren();var i=JSON.parse(this.data.attr);for(var n in i){var o=new eui.Label;o.textAlign="left",o.size=20,o.height=20,o.width=190;var a=[];a.push({text:AttrConfig[i[n][0]].name+"加成：",style:{textColor:e?8285791:16777215}}),a.push({text:r.GeneralConfig.getAttrValue(i[n][1]),style:{textColor:e?8285791:5177088}}),o.textFlow=a,this.gp_attrs.addChild(o)}},e}(eui.ItemRenderer);__reflect(o.prototype,"HeroSpiritUpInfoViewItem")}(game||(game={})),function(l){var e=function(t){function e(){var e=t.call(this)||this;return e.py=l.AppFacade.getInstance().retrieveProxy(l.HeroSpiritPy.N),e.skinName="HeroSpiritUpstarView",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()}},e.prototype.updateView=function(e){e&&(this.params=e),this.CommonDaTanChuKuang.blb_title.text="第"+this.params.code+"章";var t,i=l.Config.heroSpiritConfig(this.params.code),n=[],o=[],a=[];for(var r in i){var s={nameConfig:i[r],costConfig:this.judgeIsUp(i[r].code,i[r]),activateDoneCB:this.doneCB.bind(this)},c=this.judgeListNum(s);0==c?n.push(s):1==c?o.push(s):2==c&&a.push(s)}t=n.concat(o,a),this.list_root.itemRenderer=h,this.list_root.dataProvider=new eui.ArrayCollection(t)},e.prototype.judgeListNum=function(e){var t=e.nameConfig,i=t.code;for(var n in this.py.HeroSpiritInfo)if(this.py.HeroSpiritInfo[n].code==i)return 2;for(var o=JSON.parse(t.costs),a=0,r=0;r<o.length;r++){l.GameMVC.backpackPy.getItemNumByCode(o[r][1])>=o[r][2]&&a++}return a>=o.length?0:1},e.prototype.judgeIsUp=function(e,t){var i=-1,n=this.py.HeroSpiritInfo;for(var o in n)n[o].code==e&&(i=n[o].level);if(-1==i)return-1;if(0==i)return 0;var a=l.Config.heroSpiritUpstarConfig(e);for(var o in a)if(a[o].level==i)return a[o]},e.prototype.doneCB=function(){this.gp_effect.removeChildren(),DragonBoneTools.playOnce({effectName:"common_ty_jihuo",parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/2})},e}(BasePanel);l.HeroSpiritUpstarView=e,__reflect(e.prototype,"game.HeroSpiritUpstarView");var h=function(t){function e(){var e=t.call(this)||this;return e.py=l.AppFacade.getInstance().retrieveProxy(l.HeroSpiritPy.N),e.backpackproxy=l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N),e.isEnough=!1,e.isCanUp=!1,e.skinName="HeroSpiritUpstarViewItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.isEnough?e.isCanUp?e.py.UpHeroSpiritStar(e.data.nameConfig.code):e.py.ActivateHeroSpirit(e.data.nameConfig.code,function(){e.data.activateDoneCB&&e.data.activateDoneCB()}):Utils.MsgUtils.addMidMsg("所需英魂不足")},this)},e.prototype.updateCosts=function(e){var t=0;if(e&&e.level&&(t=e.level),0==t)return JSON.parse(this.data.nameConfig.costs);var i=void 0,n=l.Config.heroSpiritUpstarConfig(this.data.nameConfig.code);for(var o in n)if(n[o].level==t+1){i=n[o];break}return i?JSON.parse(i.costs):void 0},e.prototype.dataChanged=function(){this.lb_title.text=this.data.nameConfig.name;var n=void 0,e=void 0,t=!1;if(0==this.data.costConfig)n=JSON.parse(this.data.nameConfig.costs),e=JSON.parse(this.data.nameConfig.attr),t=!0,this.isCanUp=!0;else if(-1==this.data.costConfig)n=JSON.parse(this.data.nameConfig.costs),e=JSON.parse(this.data.nameConfig.attr),t=!1,this.isCanUp=!1;else{n=this.updateCosts(this.data.costConfig),t=!0,this.isCanUp=!0,this.data.costConfig.level==l.Config.heroSpiritUpstarConfig(this.data.nameConfig.code).length&&this.btn_operate&&this.btn_operate.parent&&this.btn_operate.parent.removeChild(this.btn_operate)}this.gp_costs.removeChildren();var o=0;if(n){for(var i=function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,t.updateData({id:n[e][1],num:n[e][2]}),a.gp_costs.addChild(t);var i=l.GameMVC.backpackPy.getItemNumByCode(n[e][1])>=n[e][2];0==a.data.costConfig?DragonBoneTools.create("common_jiban",function(e){e.x=t.width/2,e.y=t.height/2,e.scaleX=e.scaleY=1.8,e.animation.play(),t.addChild(e)},a):(UIActionManager.setAbsGrey(t,!i),i&&o++)},a=this,r=0;r<n.length;r++)i(r);this.isEnough=o>=n.length}else this.isEnough=!1;this.btn_isGet.visible=0==this.data.costConfig,this.btn_operate.visible=0!=this.data.costConfig,UIActionManager.setAbsGrey(this.gp_attrs,!t),this.btn_operate&&(this.isCanUp?this.btn_operate.label="升星":this.btn_operate.label="激活",UIActionManager.setAbsGrey(this.btn_operate,!this.isEnough)),-1==this.data.costConfig?(e=JSON.parse(this.data.nameConfig.attr),this.updateAttrShow(e)):0==this.data.costConfig?(e=JSON.parse(this.data.nameConfig.attr),this.updateAttrShow(e)):this.updateAttrInfo()},e.prototype.updateAttrInfo=function(){var e=this.py.HeroSpiritInfo,t=[];for(var i in e)if(this.data.nameConfig.code==e[i].code){e[i].level;var n=l.Config.heroSpiritUpstarConfig(e[i].code);for(var o in n)if(n[o].level<=this.data.costConfig.level){var a=JSON.parse(n[o].attr);t.push(a)}}var r=JSON.parse(this.data.nameConfig.attr);t.push(r);var s=[];for(var i in t)s=l.GeneralConfig.superAttrAddAttr(s,t[i]);this.updateAttrShow(s)},e.prototype.updateAttrShow=function(e){for(var t in this.gp_attrs.removeChildren(),e){var i=new eui.Label;i.height=18,i.textAlign="right",i.width=180,i.size=18,i.text=AttrConfig[e[t][0]].name+"加成："+l.GeneralConfig.getAttrValue(e[t][1]),i.textColor=16777215,this.gp_attrs.addChild(i)}},e}(eui.ItemRenderer);__reflect(h.prototype,"HeroSpiritUpstarViewItem")}(game||(game={})),function(f){var e=function(t){function e(){var e=t.call(this)||this;return e.backpackproxy=f.AppFacade.getInstance().retrieveProxy(f.BackpackPy.N),e.py=f.AppFacade.getInstance().retrieveProxy(f.HeroSpiritPy.N),e.playerproxy=f.AppFacade.getInstance().retrieveProxy(f.PlayerPy.N),e.initComplete=!1,e.allAttrList=[],e.dataprovider=new eui.ArrayCollection,e.skinName="HeroSpiritMainView",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent(),NoticeManager.addNoticeListener(NT.HERO_SPIRIT_ACHIEVEMENT,this.btn_achieve.$children[0],this,BTN_ICON_NOTICE_POS)},e.prototype.updateView=function(e){for(var t=f.Config.heroSpiritChapterConfig(),i=[],n=0,o=0;o<t.length;o++){var a={config:t[o],lockInfo:this.judgeLock(t[o]),indexNum:o},r=2<=a.lockInfo.lockNum;if(r&&n++,o<2)i.push(a);else if(i.push(a),!r){!1;break}}this.dataprovider=new eui.ArrayCollection(i),this.list_root.itemRenderer=_,this.list_root.dataProvider=this.dataprovider;var s=this.py.HeroSpiritInfo,c=[],l=[],h=void 0;for(var p in s){var d=s[p].code;s[p].level,f.Config.heroSpiritUpstarConfig(d);for(var o in h=JSON.parse(f.Config.heroSpiritConfigByCode(d).attr))1e5<h[o][1]?c.push(h[o]):l.push(h[o])}this.bm_unlockChapter.text=n+"",this.bm_allPage.text=s.length+"";var u=[];for(var p in c)u=f.GeneralConfig.superAttrAddAttr(u,[c[p]]);var g=[];for(var p in l)g=f.GeneralConfig.superAttrAddAttr(g,[l[p]]);this.gp_attrs.removeChildren(),this.updateAllAttrShow(u),this.updateAllAttrShow(g),this.allAttrList=u.concat(g),this.img_have.visible=!(0<this.allAttrList.length)},e.prototype.updateAllAttrShow=function(e){for(var t in e){var i=new eui.Label;i.size=24,i.textAlign="left",i.width=220,i.height=24;var n=[];n.push({text:AttrConfig[e[t][0]].name+"加成：",style:{textColor:16777215}}),n.push({text:f.GeneralConfig.getAttrValue(e[t][1]),style:{textColor:5177088}}),i.textFlow=n,this.gp_attrs.addChild(i)}this.img_arrow.visible=4<e.length},e.prototype.judgeLock=function(e){var t={needLevel:0,needLevelNum:0,nowLockChapterNum:0,needLockChapterNum:0,lockNum:0},i=JSON.parse(f.Config.heroSpiritConfigByFirst(e.id).condition);if(t.needLevel=i[0],t.needLevelNum=i[1],this.playerproxy.playerInfoVO.level>=i[0]&&t.lockNum++,0!=i[1]){var n=this.getLevelNum(i[1],i[2]);t.nowLockChapterNum=n,t.needLockChapterNum=i[2],n>=i[2]&&t.lockNum++}else t.lockNum++;return t},e.prototype.getLevelNum=function(e,t){var i=f.Config.heroSpiritConfig(e),n=0;for(var o in i)for(var a in this.py.HeroSpiritInfo)if(i[o].code==this.py.HeroSpiritInfo[a].code){n++;break}return n},e.prototype.activateComponent=function(){var e=this;this.img_arrow.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().showSubView(f.HeroSpiritMediator.N,f.HeroSpiritMediator.SV.ALL_ATTR_SHOW,{list:e.allAttrList})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new f.HelpDialog({moduleId:MODULE.HeroSpirit})})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().showSubView(f.RankMediator.N,f.RankMediator.SV.COMMON,{module:"HERO_SPRITE_RANK"})},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.btn_backpack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new f.BackpackPanel({type:f.BackpackUI.ITEM_TYPE.HERO_SPRITE})})},this),this.btn_achieve.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().showSubView(f.RankMediator.N,f.RankMediator.SV.COMMON,{module:"HERO_SPRITE_ACHIEVE"})},this)},e}(BasePanel);f.HeroSpiritMainView=e,__reflect(e.prototype,"game.HeroSpiritMainView");var _=function(t){function e(){var e=t.call(this)||this;return e.backpackproxy=f.AppFacade.getInstance().retrieveProxy(f.BackpackPy.N),e.playerproxy=f.AppFacade.getInstance().retrieveProxy(f.PlayerPy.N),e.py=f.AppFacade.getInstance().retrieveProxy(f.HeroSpiritPy.N),e.isLock=!1,e.skinName="HeroSpiritItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.isLock?f.AppFacade.getInstance().showSubView(f.HeroSpiritMediator.N,f.HeroSpiritMediator.SV.UP_STAR_PANEL,{code:e.data.config.id}):Utils.MsgUtils.addMidMsg("该章节未达到解锁条件")},this)},e.prototype.dataChanged=function(){this.img_bg.source=this.data.config.img+"_png",this.isLock=2<=this.data.lockInfo.lockNum,this.img_lock.visible=!this.isLock,this.lb_condition.visible=!this.isLock,this.gp_hasActivate.visible=this.isLock;var e=JSON.parse(f.Config.heroSpiritConfigByFirst(this.data.config.id).condition),t=[];0!=e[0]&&t.push({text:"等级达到"+e[0]+"级",style:{textColor:this.playerproxy.playerInfoVO.level>=e[0]?8904280:15814479}}),0!=e[1]&&(t.push({text:"\n"}),t.push({text:"第"+e[1]+"章激活"+e[2]+"页",style:{textColor:this.data.lockInfo.nowLockChapterNum>=this.data.lockInfo.needLockChapterNum?8904280:15814479}})),this.lb_condition.textFlow=t;var i=f.Config.heroSpiritConfig(this.data.config.id),n=0,o=this.py.HeroSpiritInfo;for(var a in o)for(var r in i)o[a].code==i[r].code&&n++;n==i.length?(this.bm_cur.font="green_num_fnt",this.bm_max.font="green_num_fnt"):(this.bm_cur.font="white_num_fnt",this.bm_max.font="white_num_fnt"),this.bm_ActivateiPages.text=n+"",this.bm_cur.text=n+"/",this.bm_max.text=i.length+"",this.pb_progress.value=Math.ceil(100*n/i.length);var s=this.py.getChaterList();this.img_red.visible=!1,s&&s[this.data.indexNum]&&(this.img_red.visible=s[this.data.indexNum])},e}(eui.ItemRenderer);__reflect(_.prototype,"HeroSpiritItem")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.heroThingPy=o.AppFacade.getInstance().retrieveProxy(o.HeroThingPy.N),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.HeroThingMainView),this.addSubView(n.SV.SELECT,o.HeroThingSelectPanel),this.addSubView(n.SV.TREASURE_PEIYANG,o.HeroTreasurePeiYangView),this.addSubView(n.SV.ARTIFACT_PEIYANG,o.HeroArtifactPeiYangView),this.addSubView(n.SV.ARTIFACT_PEIYANG2,o.HeroArtifactPeiYangView2),this.addSubView(n.SV.ARTIFACT_PEIYANG3,o.HeroArtifactPeiYangView3),this.addSubView(n.SV.ARTIFACT_PEIYANG4,o.HeroArtifactPeiYangView4),this.addSubView(n.SV.SPECIAL_TREASURE,o.TreasureSpecialView),this.addSubView(n.SV.ARTIFACT_INFO,o.HeroArtifactInfoPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.HERO_ARTIFACT_UPDATE,CN.HERO_EQUIP_UPDATE,CN.HERO_DERMA_UPDATE,CN.MONEY_UPDATE]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:this.heroThingPy.GetHeroArtifactInfo(),this.heroThingPy.GetHeroEquipInfo(),this.heroThingPy.GetTreasureInfo(),this.heroThingPy.GetDermaInfo();break;case CN.HERO_EQUIP_UPDATE:case CN.HERO_ARTIFACT_UPDATE:case CN.HERO_DERMA_UPDATE:this.updateView(n.SV.MAIN);break;case CN.MONEY_UPDATE:var t=this.getSubView(n.SV.MAIN);t&&t.updateView()}},n.N="HeroThingMediator",n.SV={MAIN:1,SELECT:2,TREASURE_PEIYANG:3,ARTIFACT_PEIYANG:4,ARTIFACT_PEIYANG2:5,ARTIFACT_PEIYANG3:6,ARTIFACT_PEIYANG4:8,SPECIAL_TREASURE:7,ARTIFACT_INFO:9},n}(BaseMediator);o.HeroThingMediator=e,__reflect(e.prototype,"game.HeroThingMediator")}(game||(game={})),function(i){var e=function(){function e(){}return e.registerAll=function(){(new o).register(),(new t).register(),(new a).register(),(new n).register()},e}();i.HeroThingProcessor=e,__reflect(e.prototype,"game.HeroThingProcessor");var t=function(e){function t(){return e.call(this,"heroEquip.HeroEquipInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();this.log("HeroEquipInfoP",t),i.AppFacade.getInstance().retrieveProxy(i.HeroThingPy.N).updateEquipInfo(t.heroEquipList)},t}(i.ProcessorBase);i.HeroEquipInfoP=t,__reflect(t.prototype,"game.HeroEquipInfoP");var n=function(e){function t(){return e.call(this,"treasure.TreasureInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();this.log("TreasureInfoP",t),i.AppFacade.getInstance().retrieveProxy(i.HeroThingPy.N).updateTreasureInfo(t.treasureList)},t}(i.ProcessorBase);i.TreasureInfoP=n,__reflect(n.prototype,"game.TreasureInfoP");var o=function(e){function t(){return e.call(this,"heroArtifact.HeroArtifactInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();this.log("HeroArtifactInfoP",t),i.AppFacade.getInstance().retrieveProxy(i.HeroThingPy.N).updateArtifactInfo(t.heroArtifactList)},t}(i.ProcessorBase);i.HeroArtifactInfoP=o,__reflect(o.prototype,"game.HeroArtifactInfoP");var a=function(e){function t(){return e.call(this,"heroArtifact.ArtifactHistoryListP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();this.log("ArtifactHistoryListP",t),i.AppFacade.getInstance().retrieveProxy(i.HeroThingPy.N).updateArtiHistoryInfo(t.historyList)},t}(i.ProcessorBase);i.ArtifactHistoryListP=a,__reflect(a.prototype,"game.ArtifactHistoryListP")}(game||(game={})),function(d){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.AllArtiInfo={},e.AllEquipInfo={},e.AllTreasureInfo={},e.AllDermaInfo={},e.artiHostory={},e.dermaiHostory={},NoticeManager.registerCB(NT.HERO_THING_COMPOUND,e.checkEquipCompoundNotice,e,MODULE.Smithy),NoticeManager.setChildType(NT.SMITHY_ENTRANCE,NT.HERO_THING_COMPOUND),NoticeManager.registerCB(NT.HERO_DERMA,e.checkDermaNotice,e),e}return __extends(i,t),i.prototype.isArtifactNewOne=function(e){var t=this.AllArtiInfo[e];return!!t&&!!t.isInit},i.prototype.checkDermaNotice=function(e){if(e&&e.info){var t=d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N),i=d.Config.getHeroDermaConfig();for(var n in i)if(e.info.config.subType==i[n].subType){var o=!1;for(var a in this.AllDermaInfo)this.AllDermaInfo[a].code==i[n].code&&(o=!0);if(o)return!1;var r=JSON.parse(i[n].costs);if(t.checkEnough(r,!1))return!0}return!1}},i.prototype.checkEquipCompoundNotice=function(){var e=d.Config.HeroEquipCompound(),t=d.Config.getHeroEquipConfig(),i=d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N),n={};for(var o in this.AllEquipInfo){var a=t[(r=this.AllEquipInfo[o]).code];a&&!r.heroUuid&&(n[a.color]?n[a.color]+=r.num:n[a.color]=r.num)}for(var o in e){var r,s=n[(r=e[o]).color]||0;if(1===r.type&&s>=r.num){var c=JSON.parse(r.costs);if(!(0<c.length))return!0;if(i.checkEnough(c,!1))return!0}}return!1},i.prototype.GetHeroArtifactInfo=function(){var t=this;Utils.Socket.send("heroArtifact","GetHeroArtifactInfo",{}).then(function(e){t.updateArtifactInfo(e.heroArtifactList,!0),t.updateArtiHistoryInfo(e.historyList)})},i.prototype.updateArtifactInfo=function(e,t){var i=this;void 0===t&&(t=!0);var n=!1;e.forEach(function(e){if(i.AllArtiInfo[e.uuid])i.AllArtiInfo[e.uuid].update(e);else{var t=new d.HeroArtifactVO(e);i.AllArtiInfo[e.uuid]=t}n=!0}),n&&(d.AppFacade.getInstance().sendNotification(CN.HERO_ARTIFACT_UPDATE),d.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE))},i.prototype.getArtiDifference=function(e){var i=this,n=[];return e.forEach(function(e){var t=new d.HeroArtifactVO(e);i.AllArtiInfo[e.uuid]&&(t.num>i.AllArtiInfo[e.uuid].num?t.num=t.num-i.AllArtiInfo[e.uuid].num:console.log(e,"数量对不上")),n.push(t)}),n},i.prototype.updateArtiHistoryInfo=function(e){var t=this;e.forEach(function(e){t.artiHostory[e.code]=e})},i.prototype.deleteArtifactInfo=function(e){var t=this;e.forEach(function(e){!0,t.AllArtiInfo[e.artifactUuid].reduceByNum(e.num)||delete t.AllArtiInfo[e.artifactUuid]})},i.prototype.getHeroArtifactsByUuid=function(e){var t=[];for(var i in this.AllArtiInfo){var n=this.AllArtiInfo[i];n.heroUuid==e&&t.push(n)}return t},i.prototype.HeroArtifactPutOn=function(e,t,i,n){var o=this;Utils.Socket.send("heroArtifact","HeroArtifactPutOn",{uuid:e,heroUuid:t}).then(function(e){o.updateArtifactInfo(e.heroArtifactList),n&&n()})},i.prototype.HeroArtifactPutDown=function(e,t,i){var n=this;Utils.Socket.send("heroArtifact","HeroArtifactPutDown",{uuid:e,heroUuid:t}).then(function(e){n.updateArtifactInfo(e.heroArtifactList),i&&i()})},i.prototype.HeroArtifactUpGrade=function(e,t,i){var n=this;Utils.Socket.send("heroArtifact","HeroArtifactUpGrade",{uuid:e,uuids:t}).then(function(e){n.updateArtifactInfo(e.heroArtifactList,!1),i&&i(e)})},i.prototype.HeroArtifactUpStar=function(e,t,i){var n=this;Utils.Socket.send("heroArtifact","HeroArtifactUpStar",{uuid:e,uuids:t}).then(function(e){n.updateArtifactInfo(e.heroArtifactList,!1),i&&i()})},i.prototype.getHeroArtifactByHeroUuid=function(e){var t=new Array;for(var i in this.AllArtiInfo){var n=this.AllArtiInfo[i];n.heroUuid==e&&t.push(n)}return t},i.prototype.HeroArtifactBaptize=function(e,t,i){var n=this;Utils.Socket.send("heroArtifact","HeroArtifactBaptize",{uuid:e,num:t}).then(function(e){n.updateArtifactInfo([e.heroArtifact],!1),i&&i()})},i.prototype.HeroArtifactBaptizeReset=function(e,t){var i=this;Utils.Socket.send("heroArtifact","HeroArtifactBaptizeReset",{uuid:e}).then(function(e){i.updateArtifactInfo([e.heroArtifact],!1),t&&t()})},i.prototype.HeroArtifactCompound=function(t){Utils.Socket.send("heroArtifact","HeroArtifactCompound",{id:t.id,uuidInfos:t.uuidInfos,uuid:t.uuid}).then(function(e){d.GameMVC.backpackPy.handleClientReward(e.clientReward),Utils.MsgUtils.addMidMsg("升品成功"),t.cb&&t.cb()})},i.prototype.HeroArtifactNewUpStar=function(t){var i=this;Utils.Socket.send("heroArtifact","HeroArtifactNewUpStar",{uuidInfos:t.uuidInfos,uuid:t.uuid}).then(function(e){d.GameMVC.backpackPy.handleClientReward(e.clientReward),i.updateArtifactInfo(e.heroArtifactList),DragonBoneTools.playOnce({effectName:"common_sxcg",parent:GameRootLayer.gameLayer().popMsgLayer}),t.cb&&t.cb(e)})},i.prototype.HeroArtifactRollback=function(t){var i=this;Utils.Socket.send("heroArtifact","HeroArtifactRollback",{uuid:t.uuid}).then(function(e){d.GameMVC.backpackPy.handleClientReward(e.clientReward),i.updateArtifactInfo(e.heroArtifactList),DragonBoneTools.playOnce({effectName:"common_hycg",parent:GameRootLayer.gameLayer().popMsgLayer,y:.3*Utils.DeviceUtils.curHeight()}),t.cb&&t.cb()})},i.prototype.HeroArtifactRollbackPreview=function(t){Utils.Socket.send("heroArtifact","HeroArtifactRollbackPreview",{uuid:t.uuid}).then(function(e){d.AppFacade.getInstance().showSubView(d.CommonMediator.N,d.CommonMediator.SV.REWARD_PANEL,{title:"奖励",rewards:e.rewardPreview,btnText:"确定",type:d.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN}),t.cb&&t.cb()})},i.prototype.GetHeroEquipInfo=function(){var t=this;Utils.Socket.send("heroEquip","GetHeroEquipInfo",{}).then(function(e){t.updateEquipInfo(e.heroEquipList,!0)})},i.prototype.getEquipDifference=function(e){var i=this,n=[];return e.forEach(function(e){var t=new d.HeroEquipVO(e);i.AllEquipInfo[e.uuid]&&(t.num>i.AllEquipInfo[e.uuid].num?t.num=t.num-i.AllEquipInfo[e.uuid].num:console.log(e,"数量对不上")),n.push(t)}),n},i.prototype.updateEquipInfo=function(e,t){var i=this;void 0===t&&(t=!0);var n=!1;if(t)for(var o in this.AllEquipInfo)this.AllEquipInfo[o].isExpire=!0;for(var o in e.forEach(function(e){if(i.AllEquipInfo[e.uuid])i.AllEquipInfo[e.uuid].update(e);else{var t=new d.HeroEquipVO(e);i.AllEquipInfo[e.uuid]=t}n=!0}),this.AllEquipInfo)this.AllEquipInfo[o].isExpire&&delete this.AllEquipInfo[o];n&&d.AppFacade.getInstance().sendNotification(CN.HERO_EQUIP_UPDATE),NoticeManager.updateNotice(NT.HERO_THING_COMPOUND)},i.prototype.deleteEquipInfo=function(e){var t=this;e.forEach(function(e){!0,t.AllEquipInfo[e.equipUuid].reduceByNum(e.num)||delete t.AllEquipInfo[e.equipUuid]}),NoticeManager.updateNotice(NT.HERO_THING_COMPOUND)},i.prototype.getHeroEquipsByUuid=function(e){var t=[];for(var i in this.AllEquipInfo){var n=this.AllEquipInfo[i];n.heroUuid==e&&t.push(n)}return t},i.prototype.checkHeroHasEquipByUuid=function(e){for(var t in this.AllEquipInfo)if(this.AllEquipInfo[t].heroUuid==e)return!0},i.prototype.HeroEquipPutOn=function(e,t,i,n){var o=this;Utils.Socket.send("heroEquip","HeroEquipPutOn",{uuid:e,heroUuid:t,type:i}).then(function(e){o.updateEquipInfo(e.heroEquipList),d.GameMVC.heroMed.updateView(d.HeroMediator.SV.MASTER,{}),n&&n()})},i.prototype.HeroEquipPutDown=function(e,t,i){var n=this;Utils.Socket.send("heroEquip","HeroEquipPutDown",{uuid:e,heroUuid:t}).then(function(e){n.updateEquipInfo(e.heroEquipList),d.GameMVC.heroMed.updateView(d.HeroMediator.SV.MASTER,{}),i&&i()})},i.prototype.HeroEquipUpgrade=function(e,t,i){var n=this;void 0===t&&(t=1),Utils.Socket.send("heroEquip","HeroEquipUpGrade",{uuid:e,num:t}).then(function(e){var t=[e.heroEquip];e.newHeroEquip&&t.push(e.newHeroEquip),n.updateEquipInfo(t,!1),d.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE),d.GameMVC.heroMed.updateView(d.HeroMediator.SV.MASTER,{}),i&&i(e)})},i.prototype.HeroEquipEnchant=function(e,t,i){var n=this;void 0===t&&(t=1),Utils.Socket.send("heroEquip","HeroEquipEnchant",{uuid:e,num:t}).then(function(e){var t=[e.heroEquip];e.newHeroEquip&&t.push(e.newHeroEquip),n.updateEquipInfo(t,!1),d.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE),d.GameMVC.heroMed.updateView(d.HeroMediator.SV.MASTER,{}),i&&i(e)})},i.prototype.HeroEquipQuenchce=function(e,t,i){var n=this;void 0===t&&(t=1),Utils.Socket.send("heroEquip","HeroEquipQuenchce",{uuid:e,num:t}).then(function(e){var t=[e.heroEquip];e.newHeroEquip&&t.push(e.newHeroEquip),n.updateEquipInfo(t,!1),d.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE),d.GameMVC.heroMed.updateView(d.HeroMediator.SV.MASTER,{}),i&&i(e)})},i.prototype.HeroEquipCompound=function(t){Utils.Socket.send("heroEquip","HeroEquipCompound",{id:t.id,uuidInfos:t.uuidInfos,compoundType:t.type,code:t.code||0}).then(function(e){t.beforeCB?t.beforeCB(function(){d.GameMVC.backpackPy.handleClientReward(e.clientReward),t.cb&&t.cb()}):(d.GameMVC.backpackPy.handleClientReward(e.clientReward),t.cb&&t.cb())})},i.prototype.getHeroEquips=function(e){var t=new Array;for(var i in this.AllEquipInfo){var n=this.AllEquipInfo[i];n.heroUuid==e&&t.push(n)}return t},i.prototype.getHeroSuitCount=function(e,t){var i=this.getHeroEquips(e),n=d.Config.getHeroEquipConfig(),o=0;for(var a in i){var r=i[a];if(n[r.code])t==n[r.code].suitType&&o++}return o},i.prototype.GetTreasureInfo=function(t){var i=this;Utils.Socket.send("treasure","GetTreasureInfo",{}).then(function(e){i.updateTreasureInfo(e.treasureList,!0),t&&t()})},i.prototype.updateTreasureInfo=function(e,t){var i=this;void 0===t&&(t=!0);var n=!1;if(t)for(var o in this.AllTreasureInfo)this.AllTreasureInfo[o].isExpire=!0;for(var o in e.forEach(function(e){if(i.AllTreasureInfo[e.uuid])i.AllTreasureInfo[e.uuid].update(e);else{var t=new d.HeroTreasureVO(e);i.AllTreasureInfo[e.uuid]=t}n=!0}),this.AllTreasureInfo)this.AllTreasureInfo[o].isExpire&&delete this.AllTreasureInfo[o];n&&d.AppFacade.getInstance().sendNotification(CN.HERO_ARTIFACT_UPDATE)},i.prototype.deleteTreasureInfo=function(e){var t=this;e.forEach(function(e){!0,t.AllTreasureInfo[e.artifactUuid].reduceByNum(e.num)||delete t.AllTreasureInfo[e.artifactUuid]})},i.prototype.getHeroTreasuresByUuid=function(e){var t=[];for(var i in this.AllTreasureInfo){var n=this.AllTreasureInfo[i];n.heroUuid==e&&t.push(n)}return t},i.prototype.TreasurePutOn=function(e,t,i,n){var o=this;Utils.Socket.send("treasure","TreasurePutOn",{uuid:e,heroUuid:t}).then(function(e){o.updateTreasureInfo(e.treasureList),n&&n(e)})},i.prototype.TreasurePutDown=function(e,t,i){var n=this;Utils.Socket.send("treasure","TreasurePutDown",{uuid:e,heroUuid:t}).then(function(e){n.updateTreasureInfo(e.treasureList),i&&i()})},i.prototype.TreasureInlayUpGrade=function(e,t,i){var n=this;Utils.Socket.send("treasure","TreasureInlayUpGrade",{uuid:e,type:t}).then(function(e){n.updateTreasureInfo([e.treasure],!1),i&&i()})},i.prototype.GetDermaInfo=function(t){var i=this;Utils.Socket.send("heroDerma","GetHeroDermaInfo",{}).then(function(e){i.updateDermaInfo(e.dermaList,!1),i.updateDermaHistoryInfo(e.historyList),t&&t()})},i.prototype.updateDermaHistoryInfo=function(e){var t=this;e.forEach(function(e){t.dermaiHostory[e.code]=e})},i.prototype.updateDermaInfo=function(e,t){var i=this;e.forEach(function(e){if(i.AllDermaInfo[e.uuid])i.AllDermaInfo[e.uuid].update(e);else{var t=new d.HeroDermaVO(e);i.AllDermaInfo[e.uuid]=t}}),t&&d.AppFacade.getInstance().sendNotification(CN.HERO_DERMA_UPDATE)},i.prototype.HeroDermaActivate=function(e,t,i){var n=this;Utils.Socket.send("heroDerma","HeroDermaActivate",{code:e}).then(function(e){n.GetDermaInfo(t),i&&i()})},i.prototype.HeroDermaPutOn=function(t,i,n,o){var a=this;Utils.Socket.send("heroDerma","HeroDermaPutOn",{uuid:t,heroUuid:i}).then(function(e){n&&n(),d.GameMVC.heroPy.allHeroByUuid[i].dermaCode=a.AllDermaInfo[t].code,a.updateDermaInfo(e.dermaList,!0),o&&o(e)})},i.prototype.HeroDermaPutDown=function(e,t,i,n){var o=this;Utils.Socket.send("heroDerma","HeroDermaPutDown",{uuid:e,heroUuid:t}).then(function(e){i&&i(),d.GameMVC.heroPy.allHeroByUuid[t].dermaCode=0,o.updateDermaInfo(e.dermaList,!0),n&&n()})},i.prototype.HeroDermaUpGrade=function(e,t){Utils.Socket.send("heroDerma","HeroDermaUpGrade",{uuid:e}).then(function(e){t&&t()})},i.prototype.HeroDermaUpStar=function(e,t){Utils.Socket.send("heroDerma","HeroDermaUpStar",{uuid:e}).then(function(e){t&&t()})},i.prototype.getMasterLevel=function(e,t,i){void 0===i&&(i=!1);var n=this.getHeroEquips(e);if(n.length<4)return 0;var o=0,a=d.Config.getHeroEquipMasterConfig(t),r=9999999999,s=d.Config.getHeroEquipConfig(),c=void 0;if(t==HeroEquipMasterType.Quenchce&&i)for(var l in n){if(!(s[(p=n[l]).code]&&0<s[p.code].professionSuit))return 0;if(null==c)c=s[p.code].professionSuit;else if(c!=s[p.code].professionSuit)return 0}var h="level";switch(t){case HeroEquipMasterType.Upgrade:h="level";break;case HeroEquipMasterType.Enchant:h="attachLevel";break;case HeroEquipMasterType.Quenchce:h="quenchceLevel"}for(var l in n){(p=n[l])[h]<r&&(r=p[h])}for(var l in a){var p;if(!(r>=(p=a[l]).level))break;o=p.showLevel}return o},i.N="HeroThingPy",i}(BaseProxy);d.HeroThingPy=e,__reflect(e.prototype,"game.HeroThingPy")}(game||(game={})),function(s){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroArtifactInfoSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateView=function(e){var n=this,t=e.code,o=s.Config.getHeroArtifactConfig()[t];s.Config.getHeroArtifactConfig(o.subType).forEach(function(e,t){if(e.sectionLevel){var i=new a({title:Utils.MathUtils.formatNumToCharacter(e.sectionLevel)+"星",attrs:JSON.parse(e.sectionAttr),skillCode:e.sectionSkill,activated:o.sectionLevel>=e.sectionLevel});i.width=420,n.gp_items.addChild(i)}}),this.gp_items.$children.forEach(function(e,t){if(0!=t){var i=new eui.Image("common_img_fengexian_02_png");i.width=420,i.horizontalCenter=0,i.top=-20,e.addChild(i)}})},e}(BasePanel);s.HeroArtifactInfoPanel=e,__reflect(e.prototype,"game.HeroArtifactInfoPanel");var a=function(i){function e(e){var t=i.call(this)||this;return t.skinName="HeroThingUICompoent_HeroThingArtifactUpSection",t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data&&this.update(this.data),this.btn_op.visible=!1,this.lb_activated.visible=!0},e.prototype.update=function(e){this.data=e;var t=this.data.title,i=this.data.attrs,n=[];n.push({text:t,style:HEROTHING_ATTR_STYLE[0]}),i.forEach(function(e,t){n.push({text:"\n    +"+s.GeneralConfig.getAttrValue(e[1])+AttrConfig[e[0]].name,style:HEROTHING_ATTR_STYLE[1]})}),this.lb_attr.textFlow=n;var o=this.data.skillCode;if(o){this.skillItem.updateItem({code:o});var a=s.Config.skillBaseConfig()[o];this.lb_skillName.text=a.name,this.lb_skillDesc.text=a.desc}else this.gp_main.removeChild(this.gp_skill);var r=this.data.activated;this.lb_activated.text=r?"已激活":"未激活",r||(this.lb_activated.text="未激活",this.lb_activated.textColor=HEROTHING_ATTR_STYLE[1].textColor,UIActionManager.setGrey(this.gp_main))},e}(eui.Component);__reflect(a.prototype,"HeroArtifactInfoPanel_ListItem")}(game||(game={})),function(y){var e=function(i){function e(){var e=i.call(this)||this;return e.curExp=0,e.countPerPage=10,e.curPage=0,e.curMaxPage=0,e.skinName="HeroArtifactPeiYangViewSkin",e.heroThingProxy=y.AppFacade.getInstance().retrieveProxy(y.HeroThingPy.N),e.itemObjs=new Array,e.dataList=new Array,e}return __extends(e,i),e.prototype.switchAutoBtn=function(e){this.btn_auto.label=void 0===e?"全选"==this.btn_auto.label?"取消全选":"全选":e?"全选":"取消全选"},e.prototype.jumpToPage=function(e){var i=this;this.curPage=e<0?Math.max(this.curPage+=e,0):Math.min(this.curPage+=e,this.curMaxPage),0==this.curPage?this.img_arrow_left.visible=!1:this.img_arrow_left.visible=!0,this.curPage==this.curMaxPage?this.img_arrow_right.visible=!1:this.img_arrow_right.visible=!0,this.itemObjs.forEach(function(e,t){i.dataList[t+i.curPage*i.countPerPage]?e.update(i.dataList[t+i.curPage*i.countPerPage]):e.update()})},e.prototype.autoSelect=function(e){var t=this.heroThingProxy.AllArtiInfo;if(e){var i=Number(y.Config.constConfig().ArtifactColorFilter.constValue),n=[],o=y.Config.getHeroArtifactConfig(),a=o[this.vo.code];for(var r in n=1==this.curMode?[0,Math.min(a.color,EColorType.EColorTypePurple)]:[i,10],t){var s=o[(c=t[r]).code];""==c.heroUuid&&!c.isLocked&&(1<c.num||c.uuid!=this.vo.uuid)&&n[0]<=s.color&&s.color<=n[1]&&(1==s.type||s.type==this.curMode+1)&&(c.selected=e)}}else for(var r in t){var c;(c=t[r]).selected=!1}this.selectedChange(),this.jumpToPage(0)},e.prototype.childrenCreated=function(){var l=this;i.prototype.childrenCreated.call(this),this.autoSelect(!1),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.pb_root.labelDisplay.visible=!1,this.btn_auto.label="全选",this.btn_auto.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"全选"==l.btn_auto.label?(l.autoSelect(!0),l.switchAutoBtn()):"取消全选"==l.btn_auto.label&&l.autoSelect(!1)},this),this.btn_oper.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(l.curExp<l.pb_root.maximum)return 1==l.curMode?void Utils.MsgUtils.addMidMsg("你所填入的下一级经验不足"):void Utils.MsgUtils.addMidMsg("你所填入的下一阶经验不足");var t=[],e=l.heroThingProxy.AllArtiInfo,i=y.Config.getHeroArtifactConfig(),n=i[l.vo.code].color,o=!1,a=!1;for(var r in e){var s=e[r];if(s.selected){t.push(s.uuid);s.code;(i[s.code].color>n||4<i[s.code].color)&&(o=!0),i[s.code].color==n&&4<i[s.code].color&&(a=!0)}}if(0<t.length){var c=function(e){DragonBoneTools.playOnce({effectName:"common_ty_dj",parent:l,x:l.width/2,y:l.height/2}),e.newHeroArtifact&&(l.vo=l.heroThingProxy.AllArtiInfo[e.newHeroArtifact.uuid]),l.updateView()};1==l.curMode?a?y.GameMgr.getInstance().showCommonTipsWin({commonTips:"所选圣物中含有高级的圣物，\n是否消耗该圣物？",clickCB:function(e){1==e.type&&l.heroThingProxy.HeroArtifactUpGrade(l.vo.uuid,t,c)}}):l.heroThingProxy.HeroArtifactUpGrade(l.vo.uuid,t,c):o?y.GameMgr.getInstance().showCommonTipsWin({commonTips:"所选圣物中含有高级的圣物，\n是否消耗该圣物？",clickCB:function(e){1==e.type&&l.heroThingProxy.HeroArtifactUpStar(l.vo.uuid,t,c)}}):l.heroThingProxy.HeroArtifactUpStar(l.vo.uuid,t,c)}else Utils.MsgUtils.addMidMsg("请先选择")},this),this.img_arrow_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.jumpToPage(-1)},this),this.img_arrow_right.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.jumpToPage(1)},this);for(var e=0;e<this.countPerPage;e++){var t=new n;this.gp_items.addChild(t),this.itemObjs.push(t)}},e.prototype.updateView=function(e){var i=this;e&&(this.vo=e.vo),e&&e.mode&&(this.curMode=e.mode),this.dataList.splice(0);var t=Number(y.Config.constConfig().ArtifactColorFilter.constValue),n=this.heroThingProxy.AllArtiInfo,o=[],a=y.Config.getHeroArtifactConfig(),r=a[this.vo.code];for(var s in 1==this.curMode?(o=[0,Math.min(r.color,EColorType.EColorTypePurple)],this.key="exp",this.key2="level"):(o=[t,10],this.key="advanceExp",this.key2="level2"),n){var c=n[s],l=a[c.code];""==c.heroUuid&&(c.uuid!=this.vo.uuid||1<c.num)&&o[0]<=l.color&&l.color<=o[1]&&(1==l.type||l.type==this.curMode+1)&&0==l.sectionLevel&&this.dataList.push({vo:c,c:l,self:c.uuid===this.vo.uuid,selectedChange:function(){i.selectedChange()}})}this.dataList.sort(function(e,t){if(e.vo.isLocked!=t.vo.isLocked)return e.vo.isLocked?1:-1;if(e.c.type!=t.c.type)return e.c.type==i.curMode+1?-1:t.c.type==i.curMode+1?1:e.c.type-t.c.type;if(e.c.color!=t.c.color)return e.c.color-t.c.color;if(1==i.curMode){if(e.vo.level!=t.vo.level)return e.vo.level-t.vo.level}else if(e.vo.level2!=t.vo.level2)return e.vo.level2-t.vo.level2;return e.vo.num-t.vo.num}),this.itemObjs.forEach(function(e,t){i.dataList[t]?e.update(i.dataList[t]):e.update()}),this.curMaxPage=Math.ceil(this.dataList.length/this.countPerPage)-1,0<this.curMaxPage&&(this.img_arrow_right.visible=!0),this.baseitemOriginal.updateData({uuid:this.vo.uuid,code:this.vo.code,type:this.vo.entityType}),this.lb_nameOriginal.text=r.name,this.lb_nameOriginal.textColor=y.GeneralConfig.getColorByColor(r.color),this.baseitemTarget.updateData({uuid:this.vo.uuid,code:this.vo.code,type:this.vo.entityType}),this.lb_nameTarget.text=r.name;var h=[],p=[],d=[],u=[];if(1==this.curMode){this.btn_oper.label="升级",this.lb_prefix.text="升级属性";var g=void 0,f=y.Config.getHeroArtifactUpgradeConfig(this.vo.code,this.vo.level||0);this.vo.level?(g=y.Config.getHeroArtifactUpgradeConfig(this.vo.code,this.vo.level||0))&&(h=JSON.parse(g.attr)):(g=y.Config.getHeroArtifactConfig()[this.vo.code])&&(h=JSON.parse(g.baseAttr));var _=y.Config.getHeroArtifactUpgradeConfig(this.vo.code,this.vo.level+1);f&&(this.pb_root.maximum=f.exp),_?(p=JSON.parse(_.attr),this.baseitemTarget.decorateLevel(this.vo.level+1)):(this.baseitemTarget.visible=!1,this.lb_nameTarget.visible=!1,this.img_right_max.visible=!0,this.pb_root.value=this.pb_root.maximum,this.img_arrowAttr.visible=!1)}else if(2==this.curMode){this.btn_oper.label="进阶",this.lb_prefix.text="进阶属性";var m=y.Config.getHeroArtifactUpstarConfig(this.vo.code,this.vo.level2);_=y.Config.getHeroArtifactUpstarConfig(this.vo.code,this.vo.level2+1);m&&(h=JSON.parse(m.attr),this.pb_root.maximum=m.exp),_?(p=JSON.parse(_.attr),this.baseitemTarget.decorateStar(this.vo.level2+1)):(this.baseitemTarget.visible=!1,this.lb_nameTarget.visible=!1,this.img_right_max.visible=!0,RES.getResAsync("shenqi_txt_yimanjie_png",function(e){i.img_right_max.source},this),this.img_arrowAttr.visible=!1,this.pb_root.value=this.pb_root.maximum)}h.forEach(function(e){e[2]?d.push({text:"+"+y.GeneralConfig.getAttrValue(e[1])+" 对"+ProfessionConfig[e[3]].name+y.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]}):d.push({text:"+"+y.GeneralConfig.getAttrValue(e[1])+" "+y.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]})}),this.lb_BasicAttr.textFlow=d,p.forEach(function(e){e[2]?u.push({text:"+"+y.GeneralConfig.getAttrValue(e[1])+" 对"+ProfessionConfig[e[3]].name+y.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]}):u.push({text:"+"+y.GeneralConfig.getAttrValue(e[1])+" "+y.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]})}),this.lb_NextAttr.textFlow=u,this.labelDisplay.text="0/"+this.pb_root.maximum,this.selectedChange()},e.prototype.addLeveExp=function(e,t,i){y.Config.getHeroArtifactConfig()[e];var n=0;if(0<t){for(var o=0;o<t;o++)"exp"==this.key?n+=y.Config.getHeroArtifactUpgradeConfig(e,o).exp:n+=y.Config.getHeroArtifactUpstarConfig(e,o).exp;n+=i}else this.key,n+=i;return n},e.prototype.selectedChange=function(){var t=this;this.curExp=0,this.dataList.forEach(function(e){e.vo.selected&&(t.curExp+=t.addLeveExp(e.vo.code,e.vo[t.key2],e.c[t.key])*(e.self?e.vo.num-1:e.vo.num))}),this.curExp=Math.max(0,this.curExp),this.pb_root.value=this.curExp,0==this.pb_root.value&&this.switchAutoBtn(!0),this.labelDisplay.text=this.curExp+"/"+this.pb_root.maximum},e.prototype.onDestroy=function(){},e}(BasePanel);y.HeroArtifactPeiYangView=e,__reflect(e.prototype,"game.HeroArtifactPeiYangView");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroArtifactPeiYangView_Item",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;this.scaleX=this.scaleY=.7,this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseItem.addChild(this.baseItem),Utils.ComponentUtils.registerListener(this,egret.TouchEvent.TOUCH_TAP,function(){e.vo&&(e.vo.isLocked?Utils.MsgUtils.addMidMsg("该圣物已上锁"):(e.vo.selected=!e.vo.selected,e.updateSelected(),e.selectedChange&&e.selectedChange()))},this)},e.prototype.update=function(e){this.vo=void 0,e&&(this.vo=e.vo,this.c=e.c,this.selectedChange=e.selectedChange,this.self=e.self),this.vo?(this.gp_empty.visible=!1,this.gp_notEmpty.visible=!0,this.baseItem.updateData({uuid:this.vo.uuid,code:this.vo.code,type:this.vo.entityType,num:this.self?this.vo.num-1:this.vo.num}),this.updateLocked(),this.updateSelected()):(this.gp_empty.visible=!0,this.gp_notEmpty.visible=!1)},e.prototype.updateSelected=function(){this.gp_selected.visible=this.vo.selected,UIActionManager.setGrey(this.gp_baseItem,this.vo.selected||this.vo.isLocked)},e.prototype.updateLocked=function(){this.gp_lock.visible=this.vo.isLocked},e}(eui.Component);__reflect(n.prototype,"HeroArtifactPeiYangView_Item")}(game||(game={})),function(_){var e=function(n){function e(){var e=n.call(this)||this;return e.skinName="HeroArtifactPeiYangViewSkin2",e.heroThingProxy=_.AppFacade.getInstance().retrieveProxy(_.HeroThingPy.N),e}return __extends(e,n),e.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cu_resBar),this.activateComponent();var e=JSON.parse(_.Config.constConfig().HeroArtifactBaptizeActivateCosts.constValue);this.CommonIconWithNum.updateItem({cost:e[0],style:CommonIconStyle.RIGHT,needShowHave:!1});e=JSON.parse(_.Config.constConfig().HeroArtifactBaptizeCosts.constValue);this.CommonIconWithNum1.updateItem({cost:e[0],style:CommonIconStyle.RIGHT,needShowHave:!1}),this.CommonIconWithNum1.blb_num.scaleX=this.CommonIconWithNum1.blb_num.scaleY=1.5;for(var t=0;t<5;t++){var i=this["pb_"+t];i&&(i.slideDuration=0)}},e.prototype.updateView=function(e){if(e&&(this.vo=e.vo),this.vo){this.baseitemOriginal.updateData({vo:this.vo});var t=this.vo.code,i=this.vo.config;this.lb_nameOriginal.text=i.name;var n=JSON.parse(_.Config.constConfig().HeroArtifactBaptizeCosts.constValue);if(this.cu_resBar.updateBar({costs:[n[0][1]],width:190,needAdd:!0}),i){var o=JSON.parse(this.vo.baptizeAttr),a=[];for(var r in o){var s=o[r];1e4<parseInt(r)?a.push([parseInt(r)%1e4,s]):a.push([r,s])}if(0==a.length)this.gp_empty.visible=!0,this.btn_activate.visible=!0,this.gp_1.visible=!1,this.gp_attrs.visible=!1,this.btn_reset.visible=!1,this.gp_activateCost.visible=!0;else{this.gp_empty.visible=!1,this.btn_activate.visible=!1,this.gp_1.visible=!0,this.gp_attrs.visible=!0,this.btn_reset.visible=!0,this.gp_activateCost.visible=!1;for(var c=0;c<5;c++)this["gp_shuxing"+c].visible=!1,this["lb_unlock"+c].visible=!0,this["lb_unlock"+c].text="圣物"+JSON.parse(i.baptizeUnlock)[c]+"级开启新的洗炼条目";for(var r in a){s=a[r];this.updatePbs(s[0],s[1],r,this.vo.code)}}}else Utils.MsgUtils.addMidMsg("找不到神器"+t+"配置")}},e.prototype.updatePbs=function(e,t,i,n){var o=this["lb_attrName"+i],a=this["labelDisplay"+i],r=this["pb_"+i],s=this["gp_shuxing"+i],c=this["lb_unlock"+i];if(s.visible=!0,c.visible=!1,o&&r){var l=_.Config.getHeroArtifactBaptizeConfig(),h=0;_.GeneralConfig.getAttrValue(t);for(var p in l){var d=l[p];if(d.attrType==e){var u=JSON.parse(d.attr);(1e5<=u[0][1]&&1e5<=t||u[0][1]<1e5&&t<1e5)&&(h=parseInt(_.GeneralConfig.getAttrValue(d.maxValue*u[0][1]*10)),d.color)}}a.text="+"+_.GeneralConfig.getAttrValue(t),t=parseInt(_.GeneralConfig.getAttrValue(10*t));var g=r.value;if(o.text=_.GeneralConfig.getAttrName(e),r.value=0,r.maximum=h,r.value=t,0<=g&&r.value>g){DragonBoneTools.playOnce({effectName:"common_zdjindutiaolg",scaleX:1.3,parent:r});var f=new eui.Label;f.textColor=5699335,f.size=19,f.text="+"+(r.value-g)/10,f.x=r.parent.width-46,f.y=r.parent.height/2-25,f.alpha=1,egret.Tween.get(f).to({alpha:1,y:r.parent.height/2-40},300).wait(500).to({alpha:0,y:r.parent.height/2-53},100).call(function(){r.parent.removeChild(f)},this),r.parent.addChildAt(f,3)}r.labelDisplay.visible=!1}},e.prototype.activateComponent=function(){var t=this;this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.btn_reset.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=JSON.parse(_.Config.constConfig().HeroArtifactBaptizeResetCosts.constValue);_.GameMgr.getInstance().showCommonTipsWin({costTips:"重置洗炼属性",cost:e,clickCB:function(e){e.type&&t.heroThingProxy.HeroArtifactBaptizeReset(t.vo.uuid,function(){t.playEffrctAndUpdateView("common_ty_czcg")})}})},this),this.btn_baptize1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.heroThingProxy.HeroArtifactBaptize(t.vo.uuid,1,function(){t.playEffrctAndUpdateView("common_ty_xilian")})},this),this.btn_activate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.heroThingProxy.HeroArtifactBaptize(t.vo.uuid,1,function(){t.playEffrctAndUpdateView("common_ty_jihuo")})},this)},e.prototype.playEffrctAndUpdateView=function(e){DragonBoneTools.playUniqueEffect({effectName:e,x:this.width/2,y:this.height/2-300,parent:this}),this.updateView()},e.prototype.onDestroy=function(){},e}(BasePanel);_.HeroArtifactPeiYangView2=e,__reflect(e.prototype,"game.HeroArtifactPeiYangView2")}(game||(game={})),function(l){var e=function(t){function e(){var e=t.call(this)||this;return e.selectedUuids={},e.curNum=0,e.requireNum=0,e.skinName="HeroArtifactPeiYangViewSkin3",e}return __extends(e,t),e.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_op,egret.TouchEvent.TOUCH_TAP,function(){if(i.curNum==i.requireNum){var t=[];for(var e in i.selectedUuids){i.selectedUuids[e].forEach(function(e){t.push({artifactUuid:e,num:1})})}l.GameMVC.heroThingPy.HeroArtifactCompound({id:i.config.id,uuidInfos:t,uuid:i.heroThingVO.uuid,cb:function(){i.hide(),l.AppFacade.getInstance().updateView(l.HeroMediator.N,l.HeroMediator.SV.MAIN),DragonBoneTools.playOnce({effectName:"common_ty_shengpinchenggong",parent:GameRootLayer.gameLayer().popMsgLayer})}})}else Utils.MsgUtils.addMidMsg("材料不足")},this),Utils.ComponentUtils.registerListener(this.btn_back,egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this)},e.prototype.updateView=function(e){var r=this;if(this.heroThingVO=e&&e.vo||this.heroThingVO,this.heroThingVO){this.config=l.Config.heroArtifactCompound()[this.heroThingVO.code];var t=this.config.rewards=JSON.parse(this.config.rewards),i=this.config.requireList=JSON.parse(this.config.requireList),n=this.config.costs=JSON.parse(this.config.costs),o=this.heroThingVO.code,a=t[0][1],s=l.Config.getHeroArtifactConfig()[o],c=l.Config.getHeroArtifactConfig()[a];this.img_icon1.source=s.icon+"_png",this.img_icon2.source=c.icon+"_png",this.lb_name1.text=s.name,this.lb_name2.text=c.name,this.lb_name1.textColor=COLOR_2_FONT_COLOR[s.color],this.lb_name2.textColor=COLOR_2_FONT_COLOR[c.color],this.gp_attr1.removeChildren(),JSON.parse(s.baseAttr).forEach(function(e){var t=new eui.Label;t.textColor=16775908,t.size=23,t.text="+"+l.GeneralConfig.getAttrValue(e[1])+" "+AttrConfig[e[0]].name,r.gp_attr1.addChild(t)}),this.gp_attr2.removeChildren(),JSON.parse(c.baseAttr).forEach(function(e){var t=new eui.Label;t.textColor=16714810,t.size=23,t.text="+"+l.GeneralConfig.getAttrValue(e[1])+" "+AttrConfig[e[0]].name,r.gp_attr2.addChild(t)}),this.curNum=0,this.requireNum=0,i.forEach(function(o,a){r.selectedUuids[a]||(r.selectedUuids[a]=[]);var e=r.selectedUuids[a],t=r.gp_slots.$children[a];t?t.updateNum(e.length):(t=new h({color:o[0],requireNum:o[1],curNum:e.length,clickFunc:function(){PopUpManager.addPopUp({obj:new l.CommonChosePanel({getInfos:function(){var e={},t=l.GameMVC.heroThingPy.AllArtiInfo;for(var i in t){var n=t[i];""==n.heroUuid&&n.config.color==o[0]&&r.uuidFilter(n.uuid,a)&&(e[n.uuid]=n)}return e},type:EEntityType.EEntityTypeHeroArtifact,checkFull:function(e){return e.length>=o[1]},selectUuids:e,title:"请选择圣物"}),closeCB:function(e){r.updateView()}})}}),r.gp_slots.addChild(t)),r.curNum+=e.length,r.requireNum+=o[1]}),this.icon_cost.visible=0<n.length,this.cu_resBar.visible=0<n.length,n.length&&(this.icon_cost.updateItem({cost:n[0],style:CommonIconStyle.RIGHT}),this.cu_resBar.updateBar({costs:n}))}},e.prototype.uuidFilter=function(e,t){var i=!0;for(var n in this.selectedUuids){var o=this.selectedUuids[n];if(Number(n)!=t&&0<o.indexOf(e)){i=!1;break}}return i},e}(BasePanel);l.HeroArtifactPeiYangView3=e,__reflect(e.prototype,"game.HeroArtifactPeiYangView3");var h=function(i){function e(e){var t=i.call(this)||this;return t.skinName="HeroArtifactPeiYangView3_SlotItem",t.data=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.data&&this.update(this.data),Utils.ComponentUtils.registerListener(this,egret.TouchEvent.TOUCH_TAP,function(){e.data.clickFunc&&e.data.clickFunc()},this)},e.prototype.update=function(e){this.data=e,this.img_bg.source="beibao_img_sptb_"+this.data.color+"_png",this.updateNum(this.data.curNum)},e.prototype.updateNum=function(e){this.data.curNum=e;var t=this.data.requireNum;if(this.blb_num.text=e+"/"+t,UIActionManager.setAbsGrey(this.img_bg,e<t),egret.Tween.removeTweens(this.img_add),e<t){var i=0,n=l.GameMVC.heroThingPy.AllArtiInfo;for(var o in n){var a=n[o];if(""==a.heroUuid&&a.config.color==this.data.color&&t<=(i+=1))break}this.img_add.visible=t<=i}else this.img_add.visible=!1;this.img_add.visible&&UIActionManager.fadeBlink(this.img_add,!0)},e}(eui.Component);__reflect(h.prototype,"HeroArtifactPeiYangView3_SlotItem")}(game||(game={})),function(y){var e=function(t){function e(){var e=t.call(this)||this;return e.selectedUuids=[],e.autoUuids=[],e.hasEnoughtArti=!0,e.curNum=0,e.requireNum=0,e.skinName="HeroArtifactPeiYangViewSkin4",e}return __extends(e,t),e.prototype.childrenCreated=function(){var h=this;t.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_op,egret.TouchEvent.TOUCH_TAP,function(){if("一键升星"!=h.btn_op.label){var e=0,t=0;for(var i in h.selectedUuids){e+=(l=h.selectedUuids[i]).uuids.length,t+=l.requestNum}if(e===t){var n=[];h.selectedUuids.forEach(function(t,e){t.uuids.forEach(function(e){n.push({slotNum:t.slotNum,uuid:e.split("#")[0]})})}),y.GameMVC.heroThingPy.HeroArtifactNewUpStar({uuid:h.heroThingVO.uuid,uuidInfos:n,cb:function(e){h.selectedUuids.splice(0),e.newHeroArtifact&&(h.heroThingVO=y.GameMVC.heroThingPy.AllArtiInfo[e.newHeroArtifact.uuid]),h.config=y.Config.getHeroArtifactUpSectionConfig()[h.heroThingVO.code],h.updateAutoUuid(),h.updateView(void 0,!0)}})}else 0<e?Utils.MsgUtils.addMidMsg("所需材料不足"):Utils.MsgUtils.addMidMsg("当前没有满足条件的材料")}else{for(var o=h.selectedUuids.length>h.autoUuids.length?h.selectedUuids.length:h.autoUuids.length,i=0;i<o;i++)for(var a in h.selectedUuids[i].uuids=[],h.autoUuids[i]){var r=h.autoUuids[i][a];h.selectedUuids[i].uuids.push(r)}h.updateView(void 0,!1);var s=0,c=0;for(var i in h.selectedUuids){var l;s+=(l=h.selectedUuids[i]).uuids.length,c+=l.requestNum}s===c||Utils.MsgUtils.addMidMsg("圣物不足")}},this),Utils.ComponentUtils.registerListener(this.btn_back,egret.TouchEvent.TOUCH_TAP,function(){h.hide()},this),Utils.ComponentUtils.registerListener(this.btn_info,egret.TouchEvent.TOUCH_TAP,function(){y.AppFacade.getInstance().showSubView(y.HeroThingMediator.N,y.HeroThingMediator.SV.ARTIFACT_INFO,{code:h.heroThingVO.code})},this)},e.prototype.updateView=function(e,t){var o=this;if(this.heroThingVO=e&&e.vo||this.heroThingVO,this.heroThingVO){this.config=y.Config.getHeroArtifactUpSectionConfig()[this.heroThingVO.code];var i=y.Config.getHeroArtifactConfig()[this.heroThingVO.code],n=y.Config.getHeroArtifactConfig()[this.config&&this.config.nextCode||0];if(t){if(this.gp_stars.removeChildren(),i.sectionLevel){this.lb_upStar.visible=!1;for(var a=y.GeneralConfig.getHeroStarInfo(i.sectionLevel),r=0;r<a.num;r++)this.gp_stars.addChild(new eui.Image(a.src));if(n){var s=y.GeneralConfig.getHeroStarInfo(n.sectionLevel);if(this.gp_stars.numChildren){var c=new eui.Image("yingxion_img_xiaojiantou_png");c.scaleX=c.scaleY=1.5,this.gp_stars.addChild(c)}for(r=0;r<s.num;r++)this.gp_stars.addChild(new eui.Image(s.src))}}else this.lb_upStar.visible=!0;if(this.gp_slots.removeChildren(),n){this.lb_slot.text="所需材料",this.lb_slot.height=24;["oneSlotCosts","twoSlotCosts","threeSlotCosts","fourSlotCosts"].forEach(function(e,t){var i=o.config[e];if(i&&""!=i){var n=0;1==(i=JSON.parse(i))[0]?n=i[1][0][2]:2==i[0]&&(n=i[1][2]),o.selectedUuids.push({uuids:[],condition:i,requestNum:n,slotNum:t+1}),o.gp_slots.addChild(new v)}})}else this.lb_slot.text="已满星",this.lb_slot.height=120;var l=JSON.parse(i.sectionAttr),h=n&&JSON.parse(n.sectionAttr)||[],p=[];h.forEach(function(t){var e=t[1],i=0;l.forEach(function(e){e[0]===t[0]&&(i=e[1])}),e!=i&&(e<1e5?p.push([t[0],y.GeneralConfig.getAttrValue(e-i)]):p.push([t[0],(Number(y.GeneralConfig.getAttrValue(e))-Number(y.GeneralConfig.getAttrValue(i))).toString()]))}),p.forEach(function(t){l.some(function(e){if(e[0]==t[0])return e.push(t[1]),!0})||l.push([t[0],0,t[1]])});var d=[];if(l.forEach(function(e,t){0!=t&&d.push({text:"\n"}),d.push({text:AttrConfig[e[0]].name+"："+y.GeneralConfig.getAttrValue(e[1])}),e[2]&&(0===e[1]&&"%"==e[2][e[2].length-1]&&(d[d.length-1].text+="%"),d.push({text:"（+"+e[2]+"）",style:{textColor:1507094}}))}),this.lb_attr.textFlow=d,this.gp_skills.removeChildren(),n&&n.sectionSkill===i.sectionSkill)this.gp_skills.scaleY=0,this.gp_skills.visible=!1;else{if(this.gp_skills.scaleY=.9,this.gp_skills.visible=!0,i.sectionSkill){var u=new customui.SkillItem({code:i.sectionSkill});this.bindSkillPanelClick({target:u}),this.gp_skills.addChild(u)}if(n&&n.sectionSkill){i.sectionSkill&&this.gp_skills.addChild(new eui.Image("shenqi_img_jiantou_png"));u=new customui.SkillItem({code:n.sectionSkill});this.bindSkillPanelClick({target:u}),this.gp_skills.addChild(u)}}this.updateAutoUuid()}if(n){if(this.btn_op.skinName="skins.ButtonSkinGreen",5==this.heroThingVO.config.color){var g=0,f=0;for(var _ in this.selectedUuids){var m=this.selectedUuids[_];g+=m.uuids.length,f+=m.requestNum}this.btn_op.label=g===f?"升 星":"一键升星"}else this.btn_op.label="升 星";UIActionManager.setGrey(this.btn_op,!this.hasEnoughtArti)}else UIActionManager.setGrey(this.btn_op,!1),this.btn_op.skinName="skins.ButtonSkinSure",this.btn_op.label="已满星";this.selectedUuids.forEach(function(e,t){o.gp_slots.getChildAt(t).update({targetUuid:o.heroThingVO.uuid,uuidInfo:o.selectedUuids,index:t})})}},e.prototype.bindSkillPanelClick=function(e){var t=this,i=e.target;i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.data&&i.data.code&&(t.skillDeatils.visible=!0,t.skillDeatils.updateItem({code:i.data.code}))},this),i.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.skillDeatils.visible=!1},this),i.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){t.skillDeatils.visible=!1},this),i.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.skillDeatils.visible=!1},this)},e.prototype.updateAutoUuid=function(){var r=this;if(this.config){this.autoUuids=[];var i={},e=["oneSlotCosts","twoSlotCosts","threeSlotCosts","fourSlotCosts"],s=[],t=y.GameMVC.heroThingPy.AllArtiInfo;for(var n in t){var o=t[n];o.heroUuid||o.uuid==this.heroThingVO.uuid||(s.push(o),i[o.code]?i[o.code]++:i[o.code]=1)}var a=0;e.forEach(function(e,t){var i=r.config[e];if(i&&""!=i){1==(i=JSON.parse(i))[0]&&(a=i[1][0][1])}}),s.sort(function(e,t){if(e.code!=t.code){if(e.code==a)return 1;if(t.code==a)return-1}return e.level!=t.level?e.level-t.level:i[e.code]!=i[t.code]?i[e.code]-i[t.code]:e.code-t.code}),e.forEach(function(e,t){var i=r.config[e];if(i&&""!=i){r.autoUuids[t]||r.autoUuids.push([]),i=JSON.parse(i);var n=0;for(var o in 1==i[0]?n=i[1][0][2]:2==i[0]&&(n=i[1][2]),s){var a=s[o];if(r.artifactFilter(a,i)&&(r.autoUuids[r.autoUuids.length-1].push(a.uuid+"#0"),s.splice(parseInt(o),1),n--),!n)break}n&&(r.hasEnoughtArti=!1)}})}},e.prototype.artifactFilter=function(e,t){return""==e.heroUuid&&(1===t[0]?e.code===t[1][0][1]:2===t[0]?t[1][0]===e.config.color&&t[1][1]===e.config.sectionLevel:void 0)},e}(BasePanel);y.HeroArtifactPeiYangView4=e,__reflect(e.prototype,"game.HeroArtifactPeiYangView4");var v=function(i){function e(e){var t=i.call(this)||this;return t.skinName="HeroArtifactPeiYangView4_SlotItem",t.data=e,t}return __extends(e,i),Object.defineProperty(e.prototype,"info",{get:function(){return this.data.uuidInfo[this.data.index]},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){var c=this;i.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this,egret.TouchEvent.TOUCH_TAP,function(){var s=[];if(c.data.uuidInfo.forEach(function(e,t){t!=c.data.index&&(s=s.concat(e.uuids))}),PopUpManager.addPopUp({obj:new y.CommonChosePanel({getInfos:function(){var e={},t=y.GameMVC.heroThingPy.AllArtiInfo;for(var i in t){var n=t[i];if(c.artifactFilter(n)){var o=c.data.targetUuid==n.uuid?n.num-1:n.num;if(o)for(var a=0;a<o;a++){var r=n.uuid+"#"+a;s.indexOf(r)<0&&(e[r]=n)}}}return e},type:EEntityType.EEntityTypeHeroArtifact,uniNum:!0,checkFull:function(e){return e.length>=c.info.requestNum},selectUuids:c.info.uuids,title:"请选择圣物"}),closeCB:function(e){e&&(c.info.uuids=e),y.AppFacade.getInstance().updateView(y.HeroThingMediator.N,y.HeroThingMediator.SV.ARTIFACT_PEIYANG4)}}),!c.checkAvailable()){var e=c.info.condition;if(1===e[0]){var t=e[1][0][1];Utils.MsgUtils.addMidMsg("当前没有圣物"+y.Config.getHeroArtifactConfig()[t].name)}else 2===e[0]&&Utils.MsgUtils.addMidMsg("当前没有"+COLOR_CONFIG[e[1][0]].name+e[1][1]+"星圣物")}},this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_bi.addChild(this.baseItem),this.data&&this.update(this.data)},e.prototype.update=function(e){this.data=e;var t=this.info,i=t.condition,n=t.uuids.length,o=t.requestNum;if(this.blb_num.text=n+"/"+o,egret.Tween.removeTweens(this.img_add),this.img_add.alpha=1,n==o?(this.img_add.visible=!1,this.blb_num.font="green_num_fnt",UIActionManager.setGrey(this.gp_bi,!1)):(this.img_add.visible=!0,this.blb_num.font="white_num_fnt",this.checkAvailable()&&UIActionManager.fadeBlink(this.img_add,!0,!1,1e3),UIActionManager.setGrey(this.gp_bi,!0)),1==i[0])this.baseItem.updateData({code:i[1][0][1],isNum:!0});else if(2==i[0]){var a=this.getRandomArtifactCode(i[1]);this.baseItem.updateData({code:a,isNum:!0});var r=i[1][0];r==EColorType.EColorTypeOrange?this.baseItem.img_icon.source="baowu_img_shengwucheng_png":r==EColorType.EColorTypeRed?this.baseItem.img_icon.source="baowu_img_shengwuhong_png":r==EColorType.EColorTypeLegend&&(this.baseItem.img_icon.source="baowu_img_shengwujin_png")}},e.prototype.checkAvailable=function(){var e=0,t=y.GameMVC.heroThingPy.AllArtiInfo;for(var i in t){var n=t[i];this.artifactFilter(n)&&(e+=n.num)}return e},e.prototype.artifactFilter=function(e){var t=this.info.condition;return""==e.heroUuid&&(1===t[0]?e.code===t[1][0][1]:2===t[0]?t[1][0]===e.config.color&&t[1][1]===e.config.sectionLevel:void 0)},e.prototype.getRandomArtifactCode=function(e){var t=y.Config.getHeroArtifactConfig();for(var i in t){var n=t[i];if(!(0!=e[0]&&e[0]!=n.color||0!=e[1]&&e[1]!=n.sectionLevel))return n.code}},e}(eui.Component);__reflect(v.prototype,"HeroArtifactPeiYangView4_SlotItem")}(game||(game={})),function(c){var e=function(t){function e(){var e=t.call(this)||this;return e.dataprovider=new eui.ArrayCollection,e.curSelectIndex=0,e.HeroThingPy=c.AppFacade.getInstance().retrieveProxy(c.HeroThingPy.N),e.skinName="HeroDermaPanelSkin",e}return __extends(e,t),e.prototype.perClose=function(){},e.prototype.childrenCreated=function(){var n=this;t.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.hide()},this),this.btn_activate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=c.Config.getHeroDermaConfig()[n.dermaConfig.code].costs,t=JSON.parse(e);c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).checkEnough(t)?n.HeroThingPy.HeroDermaActivate(n.dermaConfig.code,function(){n.isCanActivate=!1;var e=n.HeroThingPy.AllDermaInfo,t=void 0;for(var i in e)e[i].config.subType==n.dermaConfig.subType&&(t=e[i].uuid);n.HeroThingPy.HeroDermaPutOn(t,n.uuid,function(){n.isCanPutOn=!1,n.isCanPutDown=!0},function(){n.putCB&&n.putData&&(n.putCB(n.putData,t),n.updateListLockInfo(!0))})},function(){n.playEffect()}):Utils.MsgUtils.addMidMsg("道具不足")},this),this.btn_0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=n.HeroThingPy.AllDermaInfo,t=void 0;for(var i in e)e[i].config.subType==n.dermaConfig.subType&&(t=e[i].uuid);n.HeroThingPy.HeroDermaPutDown(t,n.uuid,function(){n.isCanPutOn=!0,n.isCanPutDown=!1},function(){n.putCB&&n.putData&&(n.putCB(n.putData,""),n.updateListLockInfo(!1))})},this),this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=n.HeroThingPy.AllDermaInfo,t=void 0;for(var i in e)e[i].config.subType==n.dermaConfig.subType&&(t=e[i].uuid);n.HeroThingPy.HeroDermaPutOn(t,n.uuid,function(){n.isCanPutOn=!1,n.isCanPutDown=!0},function(){n.putCB&&n.putData&&(n.putCB(n.putData,t),n.updateListLockInfo(!0))})},this),this.btn_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=c.GameMVC.heroThingPy;c.AppFacade.getInstance().showSubView(c.FashionMediator.N,c.FashionMediator.SV.ALL_INFO,{module:MODULE.HeroDerma,allUuid:e.AllDermaInfo,bookConfig:c.Config.getHeroDermaHandbookConfig(),modelConfig:c.Config.getHeroDermaConfig()})},this),this.hero_model0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hero_model0.changeAction(customui.HeroDynamicModel.TOUCH_ACTION_LIST)},this),this.item.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().showSubView(c.HeroMediator.N,c.HeroMediator.SV.HERO_DETAIL,{code:this.params.code})},this)},e.prototype.updateView=function(e){e&&e.info&&(this.params=e.info,this.uuid=e.uuid,this.dermaCode=e.dermaCode,this.isCanPutOn=e.isCanPutOn,this.isCanPutDown=e.isCanPutDown,this.isCanActivate=e.isCanActivate,this.isShowAllBtn=e.isShowAllBtn,this.putCB=e.putCB,this.putData=e.putData),this.updateDermaInfo(),this.initList(),this.updateBtnInfo(),this.item.updateData({code:this.params.code,type:EEntityType.EEntityTypeHero,isShowZhongZhu:!0,isNotShowStar:!0,effect:!1})},e.prototype.updateBtnInfo=function(){this.btn_0.visible=this.isCanPutDown,this.btn_1.visible=this.isCanPutOn,this.gp_activate.visible=this.isCanActivate,this.btn_2.visible=this.isShowAllBtn;var e=c.Config.getHeroDermaConfig()[this.dermaConfig.code].costs,t=JSON.parse(e),i=c.Config.itemConfig()[t[0][1]].icon+"_png";if(this.img_costType.source=i,this.blb_activateNum.text=t[0][2],!c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).checkEnough(t))return this.btn_activate.enabled=!1,void UIActionManager.setAbsGrey(this.btn_activate,!0);this.btn_activate.enabled=!0,UIActionManager.setAbsGrey(this.btn_activate,!1)},e.prototype.playEffect=function(){DragonBoneTools.playOnce({effectName:"common_ty_jihuo",y:400,parent:this.gp_hero})},e.prototype.initList=function(){var e=c.Config.getHeroDermaConfig(),t=[];for(var i in e)e[i].subType==this.params.subType&&(e[i].isLock=!1,e[i].isLast=!1,e[i].choose=1==e[i].index,e[i].updateShowCb=this.updateDermaInfo.bind(this),e[i].updateChooseCb=this.updateListDataInfo.bind(this),t.push(e[i]));for(var n in t)t[n].code==this.dermaCode&&(t[n].isLock=!0);t.push({isLast:!0}),this.dataprovider.replaceAll(t),this.list_derma.itemRenderer=o,this.list_derma.dataProvider=this.dataprovider},e.prototype.updateListLockInfo=function(e){for(var t in this.dataprovider.source)this.dataprovider.source[t].isLock=!1;e&&(this.dataprovider.getItemAt(this.curSelectIndex).isLock=!0),this.dataprovider.refresh()},e.prototype.updateListDataInfo=function(e){for(var t in this.curSelectIndex=e-1,this.dataprovider.source)this.dataprovider.source[t].choose=!1;this.dataprovider.getItemAt(this.curSelectIndex).choose=!0,this.dataprovider.refresh()},e.prototype.updateDermaInfo=function(){var e=c.Config.getHeroDermaConfig(),t=void 0;for(var i in e)e[i].subType==this.params.subType&&1==e[i].index&&(t=e[i],this.dermaConfig=e[i]);if(t){this.lb_name0.text=t.name,this.img_race_icon0.source=HeroRaceConfig[this.params.race].raceIconBig,this.hero_model0.update({code:this.params.code,model:t.model});var n=JSON.parse(t.attr),o=[this.gp_type0,this.gp_type1,this.gp_type2],a=[this.img_type0,this.img_type1,this.img_type2],r=[this.blb_typeNum0,this.blb_typeNum1,this.blb_typeNum2],s=[!1,!1,!1];for(i=0;i<n.length;i++)a[i].source=this.getAttrType(n[i][0]),r[i].text="+"+c.GeneralConfig.getAttrValue(n[i][1]),s[i]=!0;for(i=0;i<s.length;i++)s[i]||o[i]&&o[i].parent&&o[i].parent.removeChild(o[i])}},e.prototype.getAttrType=function(e){var t="";switch(e){case EAttrType.Atk:t="pf_img_gonjizi";break;case EAttrType.Life:t="pf_img_shengmingzi";break;case EAttrType.Defence:t="pf_img_fangyu";break;case EAttrType.Speed:t="pf_img_sudu";break;case EAttrType.Crit:t="pf_img_baojizi";break;case EAttrType.CritHurt:t="pf_img_baoshang";break;case EAttrType.Toughness:t="pf_img_kangbao";break;case EAttrType.Hit:t="pf_img_mingzhong";break;case EAttrType.Miss:t="pf_img_shanbizi";break;case EAttrType.HurtRate:t="pf_img_zengshang";break;case EAttrType.FreeHurtRate:t="yxtz2_img_mianshang";break;case EAttrType.Precise:break;case EAttrType.Parry:t="pf_img_gedangzi";break;case EAttrType.ParryCoff:break;case EAttrType.FreeControl:t="pf_img_miankongzi";break;case EAttrType.ArmorBreak:t="pf_img_pojiazi";break;case EAttrType.SockBlood:t="pf_img_xixuezi";break;case EAttrType.AntiInjury:t="pf_img_fanshangzi";break;case EAttrType.Crue:t="pf_img_zhiliaoliang";break;case EAttrType.BeCrue:case EAttrType.SkillHurt:case EAttrType.BeSkillHurt:case EAttrType.SkillHurtAdd:case EAttrType.SkillHurtFree:break;case EAttrType.Tenacity:t="pf_img__renxing"}return t+"_png"},e}(BasePanel);c.HeroDermaPanel=e,__reflect(e.prototype,"game.HeroDermaPanel");var o=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroDermaItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var e=this.data;this.img_choose.visible=!!e.choose,this.img_isLock.visible=e.isLock,this.lb_name.text=e.name,e.isLast?this.img_choose.visible=!1:(this.img_dermaType.source=""==e.dermaPic?"pf_img_hspz03_png":e.dermaPic+"_png",this.img_dermaType.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.choose||(e.updateShowCb&&e.updateShowCb(),e.updateChooseCb&&e.updateChooseCb(e.index))},this))},e}(eui.ItemRenderer);__reflect(o.prototype,"HeroDermaItem")}(game||(game={})),function(m){var e=function(t){function _(){var e=t.call(this)||this;return e.skinName="HeroThingMainViewSkin",e.heroTingProxy=m.AppFacade.getInstance().retrieveProxy(m.HeroThingPy.N),e.backpackPy=m.AppFacade.getInstance().retrieveProxy(m.BackpackPy.N),e.heroThingAttrs=new Array,e}return __extends(_,t),_.prototype.childrenCreated=function(){var a=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cu_resBar),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cu_resBar2),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.btn_putOff.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.hide(),a.entityType==EEntityType.EEntityTypeHeroArtifact?a.heroTingProxy.HeroArtifactPutDown(a.vo.uuid,a.hero.uuid):a.entityType==EEntityType.EEntityTypeHeroEquip?a.heroTingProxy.HeroEquipPutDown(a.vo.uuid,a.hero.uuid):a.entityType==EEntityType.EEntityTypeTreasure&&a.heroTingProxy.TreasurePutDown(a.vo.uuid,a.hero.uuid)},this),this.btn_replace.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.hide(),a.doneCB&&a.doneCB(),a.source==_.VIEW_SOURCE.HERO||a.source==_.VIEW_SOURCE.MASTER?a.mediator.showSubView(m.HeroThingMediator.SV.SELECT,{entityType:a.entityType,heroUuid:a.hero.uuid,type:a.vo.type,doneCB:function(e){a.entityType==EEntityType.EEntityTypeHeroArtifact?a.heroTingProxy.HeroArtifactPutOn(e.uuid,a.hero.uuid):a.entityType==EEntityType.EEntityTypeHeroEquip?a.heroTingProxy.HeroEquipPutOn(e.uuid,a.hero.uuid,e.type):a.entityType==EEntityType.EEntityTypeTreasure&&a.heroTingProxy.TreasurePutOn(e.uuid,a.hero.uuid,e.type)}}):a.source==_.VIEW_SOURCE.PUTON&&(a.entityType==EEntityType.EEntityTypeHeroArtifact?a.heroTingProxy.HeroArtifactPutOn(a.vo.uuid,a.hero.uuid):a.entityType==EEntityType.EEntityTypeHeroEquip?a.heroTingProxy.HeroEquipPutOn(a.vo.uuid,a.hero.uuid,a.vo.type,function(){var e=m.GameMVC.heroThingPy.getHeroEquips(a.hero.uuid),t=m.Config.getHeroEquipConfig(),i=4<=e.length;for(var n in e){var o=e[n];t[o.code]&&t[o.code].color<7&&(i=!1)}i&&DragonBoneTools.playOnce({effectName:"common_zbdsjh",parent:GameRootLayer.gameLayer().mainLayer,x:GameRootLayer.gameLayer().mainLayer.width/2,y:GameRootLayer.gameLayer().mainLayer.height/2-100})}):a.entityType==EEntityType.EEntityTypeTreasure&&a.heroTingProxy.TreasurePutOn(a.vo.uuid,a.hero.uuid,a.vo.type))},this),this.btn_upgrade.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.entityType==EEntityType.EEntityTypeTreasure&&(a.hide(),m.AppFacade.getInstance().showSubView(m.HeroThingMediator.N,m.HeroThingMediator.SV.TREASURE_PEIYANG,{vo:a.vo,hero:a.hero}))},this),Utils.ComponentUtils.registerListener(this.btn_compound,egret.TouchEvent.TOUCH_TAP,function(){a.hide(),m.AppFacade.getInstance().showSubView(m.HeroThingMediator.N,m.HeroThingMediator.SV.ARTIFACT_PEIYANG3,{vo:a.vo})},this),Utils.ComponentUtils.registerListener(this.btn_lock,egret.TouchEvent.TOUCH_TAP,function(){m.GameMVC.backpackPy.switchLock({lock:!a.vo.isLocked,type:a.vo.entityType,uuid:a.vo.uuid,cb:function(){a.updateView()}})},this),this.bi_left.touchEnabled=!1},_.prototype.updateView=function(e,t){var n=this;if(void 0===t&&(t=!1),e&&(this.vo=e.vo,this.hero=e.hero,this.source=e.source,this.entityType=e.entityType,this.doneCB=e.doneCB,this.vo.entityType=this.entityType),this.vo){var i=void 0;switch(this.entityType==EEntityType.EEntityTypeHeroArtifact?(i=m.Config.getHeroArtifactConfig()[this.vo.code],this.lb_quenchce.text=""):this.entityType==EEntityType.EEntityTypeHeroEquip?(i=m.Config.getHeroEquipConfig()[this.vo.code],this.vo.quenchceLevel?this.lb_quenchce.text="淬炼"+this.vo.quenchceLevel+"级":this.lb_quenchce.text=""):this.entityType==EEntityType.EEntityTypeTreasure&&(i=m.Config.getHeroTreasureConfig()[this.vo.code],this.btn_putOff.visible=this.btn_replace.visible=!1,this.btn_upgrade.visible=!0,this.lb_quenchce.text="",this.img_firstLine.parent&&this.img_firstLine.parent.removeChild(this.img_firstLine)),this.lb_name.text=i.name,this.bi_left.updateData({type:this.entityType,code:i.code,vo:this.vo,isNum:!0}),this.lb_name.textColor=COLOR_2_FONT_COLOR[this.bi_left.config.color],this.source){case _.VIEW_SOURCE.HANDBOOK:case _.VIEW_SOURCE.BACKPACK:this.gp_btns.parent&&this.gp_btns.parent.removeChild(this.gp_btns),this.commonSourceJumpLabel.visible=!0,this.commonSourceJumpLabel.setNeedCode(this.vo.code);break;case _.VIEW_SOURCE.MASTER:this.gp_btns.parent&&this.gp_btns.parent.removeChild(this.gp_btns),this.commonSourceJumpLabel.visible=!1,Utils.UnlockMgr.checkPass(MODULE.HeroArtifactUpQuality,!1).allow&&m.Config.heroArtifactCompound()[this.vo.code]&&(this.btn_compound.visible=!0);break;case _.VIEW_SOURCE.HERO:this.gp_btns.visible=!0,this.commonSourceJumpLabel.visible=!1,Utils.UnlockMgr.checkPass(MODULE.HeroArtifactUpQuality,!1).allow&&m.Config.heroArtifactCompound()[this.vo.code]&&(this.btn_compound.visible=!0);break;case _.VIEW_SOURCE.PUTON:this.gp_btns.visible=!0,this.commonSourceJumpLabel.visible=!1,this.btn_replace.label="穿戴",this.btn_replace.horizontalCenter=0,this.btn_putOff.visible=!1}if(this.vo.entityType===EEntityType.EEntityTypeHeroArtifact&&this.source!=_.VIEW_SOURCE.HANDBOOK&&this.vo.config.color>EColorType.EColorTypePurple?(this.btn_lock.visible=!0,this.btn_lock.icon=this.vo.isLocked?"common_btn_suoguan_png":"common_btn_suokai_png"):this.btn_lock.visible=!1,this.heroThingAttrs[0]||this.entityType!=EEntityType.EEntityTypeTreasure&&(this.heroThingAttrs[0]=new m.HeroThingAttr1({cb2:function(e){if(n.entityType==EEntityType.EEntityTypeHeroArtifact)m.AppFacade.getInstance().hideSubView(m.HeroThingMediator.N,m.HeroThingMediator.SV.MAIN),m.AppFacade.getInstance().showSubView(m.HeroThingMediator.N,m.HeroThingMediator.SV.ARTIFACT_PEIYANG,{vo:n.vo,mode:1});else if(n.entityType==EEntityType.EEntityTypeHeroEquip&&n.backpackPy.checkEnough(e,!0)){var i=n.hero&&m.GameMVC.heroThingPy.getMasterLevel(n.hero.uuid,HeroEquipMasterType.Upgrade)||0;n.heroTingProxy.HeroEquipUpgrade(n.vo.uuid,void 0,function(e){var t=n.hero&&m.GameMVC.heroThingPy.getMasterLevel(n.hero.uuid,HeroEquipMasterType.Upgrade)||0;i<t?DragonBoneTools.playOnce({effectName:"common_qhdssj",parent:n.gp_root,x:n.gp_root.width/2,y:n.gp_root.height/2-400}):DragonBoneTools.playOnce({effectName:"common_ty_qh",parent:n.gp_root,x:n.gp_root.width/2,y:n.gp_root.height/2}),e.newHeroEquip&&(n.vo=n.heroTingProxy.AllEquipInfo[e.newHeroEquip.uuid],n.updateView())})}},cb3:function(e){if(n.entityType==EEntityType.EEntityTypeHeroArtifact)m.AppFacade.getInstance().hideSubView(m.HeroThingMediator.N,m.HeroThingMediator.SV.MAIN),m.AppFacade.getInstance().showSubView(m.HeroThingMediator.N,m.HeroThingMediator.SV.ARTIFACT_PEIYANG2,{vo:n.vo});else if(n.entityType==EEntityType.EEntityTypeHeroEquip&&n.backpackPy.checkEnough(e,!0)){var i=n.hero&&m.GameMVC.heroThingPy.getMasterLevel(n.hero.uuid,HeroEquipMasterType.Enchant)||0;n.heroTingProxy.HeroEquipEnchant(n.vo.uuid,void 0,function(e){var t=n.hero&&m.GameMVC.heroThingPy.getMasterLevel(n.hero.uuid,HeroEquipMasterType.Enchant)||0;i<t?DragonBoneTools.playOnce({effectName:"common_fmdssj",parent:n.gp_root,x:n.gp_root.width/2,y:n.gp_root.height/2-400}):DragonBoneTools.playOnce({effectName:"common_ty_fm",parent:n.gp_root,x:n.gp_root.width/2,y:n.gp_root.height/2}),e.newHeroEquip&&(n.vo=n.heroTingProxy.AllEquipInfo[e.newHeroEquip.uuid],n.updateView())})}},cb4:function(e){if(n.entityType==EEntityType.EEntityTypeHeroEquip&&n.backpackPy.checkEnough(e,!0)){var i=n.hero&&m.GameMVC.heroThingPy.getMasterLevel(n.hero.uuid,HeroEquipMasterType.Quenchce)||0;n.heroTingProxy.HeroEquipQuenchce(n.vo.uuid,void 0,function(e){var t=n.hero&&m.GameMVC.heroThingPy.getMasterLevel(n.hero.uuid,HeroEquipMasterType.Quenchce)||0;i<t?DragonBoneTools.playOnce({effectName:"common_cldssj",parent:n.gp_root,x:n.gp_root.width/2,y:n.gp_root.height/2-400}):DragonBoneTools.playOnce({effectName:"common_ty_cuilianchenggong",parent:n.gp_root,x:n.gp_root.width/2,y:n.gp_root.height/2}),e.newHeroEquip&&(n.vo=n.heroTingProxy.AllEquipInfo[e.newHeroEquip.uuid],n.updateView())})}}}),this.gp_attr.addChild(this.heroThingAttrs[0])),!this.heroThingAttrs[1])if(this.entityType==EEntityType.EEntityTypeHeroArtifact)this.source!=_.VIEW_SOURCE.HANDBOOK&&i.sectionMax&&(this.gp_attr.addChild(new eui.Image("common_img_fengexian_02_png")),this.heroThingAttrs[1]=new m.HeroThingArtifactUpSection({hero:this.hero,closeFunc:function(){n.hide()},isLock:Utils.UnlockMgr.checkPass(MODULE.HeroArtifactUpStar,!1)}),this.gp_attr.addChild(this.heroThingAttrs[1]));else if(this.entityType==EEntityType.EEntityTypeHeroEquip){this.gp_attr.addChild(new eui.Image("common_img_fengexian_02_png"));var o=m.Config.getHeroEquipConfig()[this.vo.code],a=m.Config.getHeroEquipSuitConfig(o.suitType);this.heroThingAttrs[1]=new m.HeroThingSuit({hero:this.hero}),a&&0<a.length?this.gp_attr.addChild(this.heroThingAttrs[1]):this.img_secondLine.parent.removeChild(this.img_secondLine)}else this.entityType==EEntityType.EEntityTypeTreasure&&(this.gp_attr.addChild(new eui.Image("common_img_fengexian_02_png")),this.heroThingAttrs[2]=new m.HeroThingBaoshi({hero:this.hero,cb:function(){}}),this.gp_attr.addChild(this.heroThingAttrs[2]),this.gp_attr.addChild(new eui.Image("common_img_fengexian_02_png")),this.heroThingAttrs[3]=new m.HeroThingGongMing({hero:this.hero}),this.gp_attr.addChild(this.heroThingAttrs[3]));this.heroThingAttrs.forEach(function(e){e.update(n.vo,n.source)});var r=m.Config.getHeroEquipUpgradeConfig(this.vo.code,this.vo.level+1)||m.Config.getHeroEquipUpgradeConfig(this.vo.code,this.vo.level),s=m.Config.getHeroEquipEnchantConfig(this.vo.code,(this.vo.level2||0)+1)||m.Config.getHeroEquipEnchantConfig(this.vo.code,this.vo.level2||0),c=new eui.HorizontalLayout;c.horizontalAlign=egret.HorizontalAlign.CENTER,this.cu_resBar.gp_root.layout=c;var l=new eui.HorizontalLayout;if(l.horizontalAlign=egret.HorizontalAlign.CENTER,this.cu_resBar2.gp_root.layout=l,s&&s.costs&&r&&r.costs){this.cu_resBar.visible=!0;var h=JSON.parse(s.costs),p=JSON.parse(r.costs),d=[];p.forEach(function(e){d.push(e)}),d.push(h[0]),this.cu_resBar.updateBar({costs:d,width:190,needAdd:!0})}else if(s&&s.costs&&r&&!r.costs){this.cu_resBar.visible=!0;h=JSON.parse(s.costs);var u=[];h.forEach(function(e){u.push(e)}),this.cu_resBar.updateBar({costs:u,width:190,needAdd:!0})}else if(r&&r.costs&&!i.costs){this.cu_resBar.visible=!0;var g=JSON.parse(r.costs),f=[];g.forEach(function(e){f.push(e)}),this.cu_resBar.updateBar({costs:f,width:190,needAdd:!0})}if(0<i.professionSuit&&Utils.UnlockMgr.checkPass(MODULE.HeroEquipQuenchce,!1).allow){this.cu_resBar2.visible=!0;p=m.Config.getHeroEquipQuenchceConfig(this.vo.code,1).costs;this.cu_resBar2.updateBar({costs:p,width:190})}else this.cu_resBar2.visible=!1;this.source!=_.VIEW_SOURCE.MASTER&&this.source!=_.VIEW_SOURCE.HERO&&this.source!=_.VIEW_SOURCE.BACKPACK&&(this.cu_resBar.visible=!1,this.cu_resBar2.visible=!1),this.lb_desc.textFlow=[{text:"介绍\n",style:HEROTHING_ATTR_STYLE[0]},{text:"   "+(i.desc||"暂无介绍"),style:HEROTHING_ATTR_STYLE[1]}]}},_.VIEW_SOURCE={BACKPACK:0,HERO:1,PUTON:2,HANDBOOK:3,MASTER:5},_}(BasePanel);m.HeroThingMainView=e,__reflect(e.prototype,"game.HeroThingMainView")}(game||(game={})),function(N){var e=function(i){function e(){var e=i.call(this)||this;return e.equipItems=[],e.isFirst=!0,e.canBeOneSuit=!0,e.seleceIndex=0,e.skinName="HeroThingMasterView",e}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this);for(var e=0;e<4;e++){var t=new n;this.gp_equips.addChild(t),this.equipItems.push(t)}this.attrItemOld=new o,this.gp_attrLeft.addChild(this.attrItemOld),this.attrItemNew=new o,this.gp_attrRight.addChild(this.attrItemNew),this.tabbar_top.itemRendererSkinName="SimpleTabbarItemSkin",this.tabbar_top.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabbarTap,this)},e.prototype.onTabbarTap=function(e){this.seleceIndex=e.itemIndex,this.updateView({})},e.prototype.updateView=function(e){if(e&&(e.heroUuid&&(this.heroUuid=e.heroUuid),this.heroUuid)){var t=N.GameMVC.heroThingPy.getHeroEquips(this.heroUuid),i=N.Config.getHeroEquipConfig();if(this.isFirst){var n=[{source:{up:"_btn_yq_m_json.jiban_txt_qhds1",down:"_btn_yq_m_json.jiban_txt_qhds2",text:""}},{source:{up:"_btn_yq_m_json.jiban_txt_fods1",down:"_btn_yq_m_json.jiban_txt_fods2",text:""}}];if(Utils.UnlockMgr.checkPass(MODULE.HeroEquipQuenchce,!1).allow)for(var o in t){if(i[(S=t[o]).code]&&0<i[S.code].professionSuit){n.push({source:{up:"_btn_yq_m_json.jiban_txt_clds1",down:"_btn_yq_m_json.jiban_txt_clds2",text:""}});break}}this.tabbar_top.dataProvider=new eui.ArrayCollection(n),this.isFirst=!1}var a=0;for(var o in t){i[(S=t[o]).code]&&7<=i[S.code].color&&a++}this.lb_conditionName.visible=a<4;var r="level",s="";switch(this.seleceIndex){case 0:r="level",s="强化",this.lb_conditionName.text="仅限穿戴4件橙色及以上装备";break;case 1:r="attachLevel",s="附魔",this.lb_conditionName.text="仅限穿戴4件橙色及以上装备";break;case 2:r="quenchceLevel",s="淬炼",this.lb_conditionName.text="穿戴4件职业套装后可激活技能"}this.lb_masterName.text=s+"大师",this.lb_processName.text=s+"进度",this.lb_quickName.text="点击装备可直接进行"+s;var c=9999999999,l=0,h=0,p=!(this.canBeOneSuit=!0),d=N.GameMVC.heroPy.allHeroByUuid[this.heroUuid].code,u=N.Config.allHeroConfig()[d];for(var o in t){c=c<(S=t[o])[r]?c:S[r],i[S.code]&&i[S.code].professionSuit?(l&&l!=i[S.code].professionSuit&&(this.canBeOneSuit=!1),p||(l=i[S.code].professionSuit,h=i[S.code].suitType,p=u.profession==l)):this.canBeOneSuit=!1}t.sort(function(e,t){return e.type-t.type});for(var g=0;g<4;g++)this.equipItems[g]&&this.equipItems[g].update({vo:t[g]||{type:g+1},professionSuit:l,miniLevel:c,type:this.seleceIndex+1,key:r,heroUuid:this.heroUuid});var f=N.Config.getHeroEquipMasterConfig(this.seleceIndex+1),_=0,m=0,y=0,v=0,T="",C="";for(var o in f){if((S=f[o]).level<=c)_=S.showLevel,T=S.attr;else if(!m){m=S.level,C=S.attr;break}}var E=!0;for(var o in f){if((S=f[o]).showLevel==_+1){E=!1;break}}E?(this.gp_attrLeft.horizontalCenter=0,this.gp_attrRight.visible=!1,this.img_arrow.visible=!1):(this.gp_attrLeft.horizontalCenter=-167.5,this.gp_attrRight.visible=!0,this.img_arrow.visible=!0);var b=_;if(this.canBeOneSuit||2!=this.seleceIndex?(2==this.seleceIndex&&(this.canBeOneSuit?this.lb_conditionName.visible=!p:this.lb_conditionName.visible=!0),this.lb_conditionName.top=846):(_=0,this.canBeOneSuit?this.lb_conditionName.visible=!p:this.lb_conditionName.visible=!0,this.lb_conditionName.top=753),l){var I=N.Config.getHeroEquipSuitConfig(h),A=void 0;for(var o in I){if(4==(S=I[o]).num){A=S;break}}if(A){var P=JSON.parse(A.talent);for(var o in P){var S;(S=P[o])[1]==_&&(y=S[0]),S[1]==_+1&&(v=S[0])}}}this.attrItemOld.update({skillCode:y,attrs:T,type:this.seleceIndex+1,isOld:!0,nextLevel:m,curMasterLevel:_,truecurMasterLevel:b,canBeOneSuit:this.canBeOneSuit}),this.attrItemNew.update({skillCode:v,attrs:C,type:this.seleceIndex+1,isOld:!1,nextLevel:m,truecurMasterLevel:b+1,curMasterLevel:_+1,canBeOneSuit:this.canBeOneSuit})}},e}(BasePanel);N.HeroThingMasterView=e,__reflect(e.prototype,"game.HeroThingMasterView");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroThingMasterEquipItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.baseitem_equip.addTapEvent(function(){e.params&&e.params.vo.uuid&&N.AppFacade.getInstance().showSubView(N.HeroThingMediator.N,N.HeroThingMediator.SV.MAIN,{entityType:EEntityType.EEntityTypeHeroEquip,vo:e.params.vo,hero:N.GameMVC.heroPy.allHeroByUuid[e.params.heroUuid],source:N.HeroThingMainView.VIEW_SOURCE.MASTER})},this)},e.prototype.update=function(e){if(e){var t=e.vo;if(this.params=e,t){this.baseitem_equip.updateData({code:t.code,num:""});var i=N.Config.getHeroEquipConfig()[t.code];this.lb_name.text=i&&i.name;var n=N.Config.getHeroEquipMasterConfig(e.type),o=void 0;for(var a in n){var r=n[a];if(e.miniLevel<r.level){o=r;break}}var s=t[e.key]||0,c=o&&o.level||n[n.length-1].level;c<=s?(this.pb_progress.labelDisplay.visible=!1,this.bm_full.visible=!0):(this.pb_progress.labelDisplay.visible=!0,this.bm_full.visible=!1),this.pb_progress.maximum=c,this.pb_progress.value=s,this.bm_full.text=s+"/"+c}else this.lb_name.text="暂无装备",this.baseitem_equip.visible=!1,this.pb_progress.visible=!1;this.baseitem_equip.blb_num.visible=!1}},e}(eui.ItemRenderer);__reflect(n.prototype,"HeroThingMasterEquipItem");var o=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroThingMasterAttrItem",e}return __extends(e,t),e.prototype.update=function(e){if(e){var t=e.skillCode,i=JSON.parse(e.attrs),n=e.type,o=e.isOld,a=e.nextLevel,r=(e.curMasterLevel,e.truecurMasterLevel),s="",c=[];switch(n){case HeroEquipMasterType.Upgrade:c.push({text:"强化大师"+r+"级",style:{textColor:15913814,size:25}}),s="强化",this.gp_skill.visible=!1,this.lb_name.top=30,this.lb_attr.verticalCenter=55;break;case HeroEquipMasterType.Enchant:c.push({text:"附魔大师"+r+"级",style:{textColor:15913814,size:25}}),s="附魔",this.gp_skill.visible=!1,this.lb_name.top=30,this.lb_attr.verticalCenter=55;break;case HeroEquipMasterType.Quenchce:c.push({text:"淬炼大师"+r+"级",style:{textColor:15913814,size:25}}),s="淬炼",this.gp_skill.visible=e.canBeOneSuit,e.canBeOneSuit?(this.lb_name.top=0,this.lb_attr.verticalCenter=-29.5):(this.lb_name.top=30,this.lb_attr.verticalCenter=55)}var l=!0,h=N.Config.getHeroEquipMasterConfig(n);for(var p in h){if((u=h[p]).showLevel==r+1){l=!1;break}}if(l&&o&&c.push({text:"(已满级)",style:{textColor:15913814,size:25}}),o?(this.lb_attr.textColor=16775908,this.lb_skillDesc.textColor=16775908):(this.lb_attr.textColor=9539985,this.lb_skillDesc.textColor=9539985,c.push({text:"\n(全身装备"+s+"至"+a+"级)",style:{textColor:16775908,size:20}})),this.lb_name.lineSpacing=5,a||o?this.lb_name.textFlow=c:(this.lb_name.textFlow=[{text:"已满级",style:{textColor:15913814,size:25}}],this.gp_skill.visible=!1),this.lb_attr.lineSpacing=5,0<i.length){var d=[];for(var p in i){var u,g=(2e3<(u=i[p])[0]?"装备":"")+N.GeneralConfig.getAttrName(u[0]),f=N.GeneralConfig.getAttrValue(u[1]);d.push({text:g+"+"+f+"\n"})}this.lb_attr.textFlow=d}else this.lb_attr.textFlow=l&&0!=r?[{text:"满属性\n"}]:[{text:"无属性\n"}];this.skillItem.updateItem({code:t});var _=N.Config.skillBaseConfig()[t];this.lb_skillDesc.text=_&&_.desc||""}},e}(eui.ItemRenderer);__reflect(o.prototype,"HeroThingMasterAttrItem")}(game||(game={})),function(s){var e=function(i){function e(e){var t=i.call(this)||this;return t.typeStr={8:"装备",9:"圣物",11:"宝物"},t.heroThingProxy=s.AppFacade.getInstance().retrieveProxy(s.HeroThingPy.N),t.skinName="HeroThingSelectPanelSkin",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initList()},e.prototype.initList=function(){this.collection=new eui.ArrayCollection,this.list_item.itemRenderer=t,this.list_item.dataProvider=this.collection,this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){var t=this,i=s.AppFacade.getInstance().retrieveProxy(s.HeroPy.N);i.allHeroByUuid[this.params.heroUuid]&&s.AppFacade.getInstance().showSubView(s.HeroThingMediator.N,s.HeroThingMediator.SV.MAIN,{vo:e.item.vo,source:s.HeroThingMainView.VIEW_SOURCE.PUTON,entityType:this.params.entityType,hero:i.allHeroByUuid[this.params.heroUuid],doneCB:function(){t.hide()}})},this)},e.prototype.perShow=function(e){if(e.entityType==EEntityType.EEntityTypeHeroArtifact||e.entityType==EEntityType.EEntityTypeHeroEquip){var t=void 0,i=this.heroThingProxy.AllArtiInfo,n=void 0;for(var o in e.entityType==EEntityType.EEntityTypeHeroEquip?(i=this.heroThingProxy.AllEquipInfo,n=e.type):e.entityType==EEntityType.EEntityTypeHeroArtifact?(i=this.heroThingProxy.AllArtiInfo,t=s.Config.getHeroArtifactConfig()):e.entityType==EEntityType.EEntityTypeTreasure&&(i=this.heroThingProxy.AllTreasureInfo),i){var a=i[o];if(""==a.heroUuid&&(null==n||n==a.type)&&(e.entityType!=EEntityType.EEntityTypeHeroArtifact||t[a.code]&&t[a.code].type==HeroArtifactType.Normal))return!0}var r=this.typeStr[e.entityType];return Utils.MsgUtils.addMidMsg("无替换的"+r),!1}return!0},e.prototype.updateView=function(e){this.doneCB=e.doneCB,this.params=e;var i,t=this.heroThingProxy.AllArtiInfo,n=void 0;for(var o in e.entityType==EEntityType.EEntityTypeHeroEquip?(t=this.heroThingProxy.AllEquipInfo,n=e.type,this.lb_title.text="请选择英雄装备"):e.entityType==EEntityType.EEntityTypeHeroArtifact?(t=this.heroThingProxy.AllArtiInfo,this.lb_title.text="请选择英雄圣物",i=s.Config.getHeroArtifactConfig()):e.entityType==EEntityType.EEntityTypeTreasure&&(t=this.heroThingProxy.AllTreasureInfo,this.lb_title.text="请选择英雄宝物"),this.collection.removeAll(),t){var a=t[o];""!=a.heroUuid||null!=n&&n!=a.type||!(e.entityType!=EEntityType.EEntityTypeHeroArtifact||i[a.code]&&i[a.code].type==HeroArtifactType.Normal)||this.collection.addItem({vo:a,entityType:e.entityType})}if(e.entityType==EEntityType.EEntityTypeHeroArtifact?this.collection.source.sort(function(e,t){return t.vo.config.color!=e.vo.config.color?t.vo.config.color-e.vo.config.color:i[t.vo.code].sectionLevel!=i[e.vo.code].sectionLevel?i[t.vo.code].sectionLevel-i[e.vo.code].sectionLevel:t.vo.level!=e.vo.level?t.vo.level-e.vo.level:t.vo.num!=e.vo.num?e.vo.num-t.vo.num:t.vo.code!=e.vo.code?e.vo.code-t.vo.code:void 0}):this.collection.source.sort(function(e,t){return t.vo.fightCap-e.vo.fightCap}),this.collection.length<=0&&(e.entityType==EEntityType.EEntityTypeHeroArtifact||e.entityType==EEntityType.EEntityTypeHeroEquip)){var r=this.typeStr[e.entityType];Utils.MsgUtils.addMidMsg("无替换的"+r),this.hide()}this.collection.refresh()},e}(BasePanel);s.HeroThingSelectPanel=e,__reflect(e.prototype,"game.HeroThingSelectPanel");var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.childrenCreated=function(){this.width=this.height=97,this.baseitem=customui.BaseItemFactory.create(),this.baseitem.touchEnabled=!1,this.addChild(this.baseitem)},t.prototype.dataChanged=function(){this.baseitem.updateData({uuid:this.data.vo.uuid,code:this.data.vo.code,type:this.data.entityType})},t}(eui.ItemRenderer);__reflect(t.prototype,"ItemRender")}(game||(game={})),function(N){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.update=function(e,t){this.vo=e},t}(eui.Component);N.HeroThingAttrBase=e,__reflect(e.prototype,"game.HeroThingAttrBase");var t=function(S){function e(e){var t=S.call(this)||this;return t.skinName="HeroThingUICompoent_HeroThingAttr1Skin",t.cb2=e.cb2,t.cb3=e.cb3,t.cb4=e.cb4,t}return __extends(e,S),e.prototype.childrenCreated=function(){S.prototype.childrenCreated.call(this)},e.prototype.update=function(e,t){var o=this;S.prototype.update.call(this,e),this.vo.entityType==EEntityType.EEntityTypeHeroArtifact&&(this.lb_1.width=250,this.gp_costAll1.width=200,this.lb_2.width=250,this.gp_costAll2.width=200,this.lb_3.width=250,this.gp_costAll3.width=200),t!=N.HeroThingMainView.VIEW_SOURCE.MASTER&&t!=N.HeroThingMainView.VIEW_SOURCE.HERO&&t!=N.HeroThingMainView.VIEW_SOURCE.BACKPACK&&(this.gp_costAll1.visible=this.gp_costAll2.visible=this.gp_costAll3.visible=this.gp_costAll4.visible=!1);Number(N.Config.constConfig().ArtifactColorFilter.constValue);var i=[];switch(this.vo.entityType){case EEntityType.EEntityTypeHeroEquip:(l=N.Config.getHeroEquipConfig()[this.vo.code])&&(i=JSON.parse(l.baseAttr));break;case EEntityType.EEntityTypeHeroArtifact:if(this.vo.level)(l=N.Config.getHeroArtifactUpgradeConfig(this.vo.code,this.vo.level||0))&&(i=JSON.parse(l.attr));else(l=N.Config.getHeroArtifactConfig()[this.vo.code])&&(i=JSON.parse(l.baseAttr));if(this.gp_cost1.removeChildren(),Utils.UnlockMgr.checkPass(MODULE.HeroArtifactUpGrade,!1).allow){if(n=N.Config.getHeroArtifactUpgradeConfig(this.vo.code,(this.vo.level||0)+1))(I=new eui.Button).skinName="skins.ButtonSkinGreen",I.label="升 级",I.scaleX=.7,I.scaleY=.7,this.gp_cost1.addChild(I),I.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.cb2&&o.cb2()},this)}else{var n=N.Config.getHeroArtifactUpgradeConfig(this.vo.code,(this.vo.level||0)+1);(P=new eui.Label("")).text=Utils.UnlockMgr.checkPass(MODULE.HeroArtifactUpGrade,!1).ext.tips,P.size=23,P.percentWidth=100,P.height=41,P.verticalCenter=5,P.horizontalCenter=20,P.verticalAlign="middle",P.textAlign="center",this.gp_cost1.addChild(P)}}var a=[];a.push({text:"基础属性\n",style:HEROTHING_ATTR_STYLE[0]}),i.forEach(function(e){e[2]?a.push({text:"   +"+N.GeneralConfig.getAttrValue(e[1])+" 对"+ProfessionConfig[e[3]].name+N.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]}):a.push({text:"   +"+N.GeneralConfig.getAttrValue(e[1])+" "+N.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]})}),this.lb_1.textFlow=a;var r=!1,s=[],c=[];if(this.vo.entityType==EEntityType.EEntityTypeHeroEquip){if(Utils.UnlockMgr.checkPass(MODULE.HeroEquipUpGrade,!1).allow){var l=N.Config.getHeroEquipUpgradeConfig(this.vo.code,this.vo.level);n=N.Config.getHeroEquipUpgradeConfig(this.vo.code,this.vo.level+1);if(l?c=JSON.parse(l.attr):this.gp2.parent&&this.gp2.parent.removeChild(this.gp2),n){this.gp_cost2.removeChildren();var h=JSON.parse(n.costs);if(h.length<3)this.gp_cost2.layout.gap=30;h.forEach(function(e){var t=new customui.CommonIconWithNum({code:e[1],num:e[2],style:CommonIconStyle.RIGHT,showEnough:!0,showDetail:!0});t.width=100,o.gp_cost2.addChild(t)}),(I=new eui.Button).skinName="skins.ButtonSkinIcon",I.icon="common_btn_shang_png",I.width=40,I.height=37,this.gp_cost2.addChild(I),I.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.cb2&&o.cb2(h)},this)}else{this.gp_cost2.removeChildren(),(P=new eui.Label("已满级")).size=25,P.percentWidth=100,P.height=41,P.verticalCenter=5,P.horizontalCenter=20,P.verticalAlign="middle",P.textAlign="center",this.gp_cost2.addChild(P),this.img_bg2.left=100,this.img_bg2.right=80}}else{this.gp_cost2.removeChildren(),(P=new eui.Label("")).text=Utils.UnlockMgr.checkPass(MODULE.HeroEquipUpGrade,!1).ext.tips,P.size=23,P.percentWidth=100,P.height=41,P.verticalCenter=5,P.horizontalCenter=20,P.verticalAlign="middle",P.textAlign="center",this.gp_cost2.addChild(P)}s.push({text:"强化属性\n",style:HEROTHING_ATTR_STYLE[0]})}else this.vo.entityType==EEntityType.EEntityTypeHeroArtifact&&(r=!0,this.gp2.parent&&this.gp2.parent.removeChild(this.gp2));r||(0==c.length||1==c.length&&0==c[0][1]?(this.vo&&this.vo.filterShow&&this.gp2.parent&&this.gp2.parent.removeChild(this.gp2),s.push({text:"   无\n",style:HEROTHING_ATTR_STYLE[1]})):c.forEach(function(e){s.push({text:"   +",style:HEROTHING_ATTR_STYLE[1]}),s.push({text:N.GeneralConfig.getAttrValue(e[1])+" "+N.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]})}),this.gp2&&(this.lb_2.textFlow=s));var p=[],d=[];if(this.vo.entityType==EEntityType.EEntityTypeHeroEquip){if(Utils.UnlockMgr.checkPass(MODULE.HeroEquipEnchat,!1).allow){l=N.Config.getHeroEquipEnchantConfig(this.vo.code,this.vo.level2||0),n=N.Config.getHeroEquipEnchantConfig(this.vo.code,(this.vo.level2||0)+1);if(l?d=JSON.parse(l.attr):this.gp3.parent&&this.gp3.parent.removeChild(this.gp3),n){this.gp_cost3.removeChildren();var u=JSON.parse(n.costs);if(u.length<3)this.gp_cost3.layout.gap=30;u.forEach(function(e){var t=new customui.CommonIconWithNum({code:e[1],num:e[2],style:CommonIconStyle.RIGHT,showEnough:!0,showDetail:!0});t.width=100,o.gp_cost3.addChild(t)}),(I=new eui.Button).skinName="skins.ButtonSkinIcon",I.icon="common_btn_shang_png",I.width=40,I.height=37,this.gp_cost3.addChild(I),I.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.cb3&&o.cb3(u)},this)}else{this.gp_cost3.removeChildren(),(P=new eui.Label("已满级")).size=25,P.percentWidth=100,P.height=41,P.verticalCenter=5,P.horizontalCenter=20,P.verticalAlign="middle",P.textAlign="center",this.gp_cost3.addChild(P),this.img_bg3.left=100,this.img_bg3.right=80}}else{this.gp_cost3.removeChildren(),(P=new eui.Label("")).text=Utils.UnlockMgr.checkPass(MODULE.HeroEquipEnchat,!1).ext.tips,P.size=23,P.percentWidth=100,P.height=41,P.verticalCenter=5,P.horizontalCenter=20,P.verticalAlign="middle",P.textAlign="center",this.gp_cost3.addChild(P)}p.push({text:"附魔属性\n",style:HEROTHING_ATTR_STYLE[0]})}else if(this.vo.entityType==EEntityType.EEntityTypeHeroArtifact){t==N.HeroThingMainView.VIEW_SOURCE.HANDBOOK&&this.gp3.parent&&this.gp3.parent.removeChild(this.gp3);var g=JSON.parse(this.vo.baptizeAttr),f=[];for(var _ in g){var m=g[_];1e4<parseInt(_)?f.push([parseInt(_)%1e4,m]):f.push([_,m])}f.length||this.gp3.parent&&this.gp3.parent.removeChild(this.gp3),this.img_bg3.parent&&this.img_bg3.parent.removeChild(this.img_bg3);var y=JSON.parse(this.vo.baptizeAttr);for(var _ in y){m=y[_];1e4<parseInt(_)?d.push([parseInt(_)%1e4,m]):d.push([_,m])}this.gp_cost3.removeChildren();var v=new eui.Group;if(v.width=65,this.gp_cost3.addChild(v),(I=new eui.Button).skinName="skins.ButtonSkinGreen",I.label="洗 炼",I.scaleX=.7,I.scaleY=.7,this.vo.config&&this.vo.config.color>=N.Config.getCanShowHeroArtifactBaptizeColor()&&Utils.UnlockMgr.checkPass(MODULE.HeroArtifactBaptize,!1).allow)this.gp_cost3.addChild(I);else this.gp_cost3.removeChildren(),(P=new eui.Label("")).text=Utils.UnlockMgr.checkPass(MODULE.HeroArtifactBaptize,!1).ext.tips,P.size=23,P.percentWidth=100,P.height=41,P.verticalCenter=5,P.horizontalCenter=20,P.verticalAlign="middle",P.textAlign="center",this.gp_cost3.addChild(P),d=[];I.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.cb3&&o.cb3()},this),p.push({text:"洗炼属性\n",style:HEROTHING_ATTR_STYLE[0]})}0==d.length?p.push({text:"   无\n",style:HEROTHING_ATTR_STYLE[1]}):d.forEach(function(e){if(o.vo.entityType==EEntityType.EEntityTypeHeroArtifact){var t=N.Config.getHeroArtifactConfig()[o.vo.code].color;p.push({text:"   +",style:{size:26,textColor:COLOR_2_FONT_COLOR[t]}}),e[2]?p.push({text:N.GeneralConfig.getAttrValue(e[1])+" 对"+ProfessionConfig[e[3]].name+N.GeneralConfig.getAttrName(e[0])+"\n",style:{size:21,textColor:COLOR_2_FONT_COLOR[t]}}):p.push({text:N.GeneralConfig.getAttrValue(e[1])+" "+N.GeneralConfig.getAttrName(e[0])+"\n",style:{size:21,textColor:COLOR_2_FONT_COLOR[t]}})}else p.push({text:"   +",style:HEROTHING_ATTR_STYLE[3]}),p.push({text:N.GeneralConfig.getAttrValue(e[1])+" "+N.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[3]})}),this.lb_3.textFlow=p;var T,C=[],E=[];r=!1;T=this.vo;var b=N.Config.getHeroEquipConfig()[T.code];if(this.vo.entityType==EEntityType.EEntityTypeHeroEquip&&b&&0<b.professionSuit){if(Utils.UnlockMgr.checkPass(MODULE.HeroEquipQuenchce,!1).allow){l=N.Config.getHeroEquipQuenchceConfig(this.vo.code,T.quenchceLevel||0),n=N.Config.getHeroEquipQuenchceConfig(this.vo.code,(T.quenchceLevel||0)+1);if(l?E=JSON.parse(l.attr):this.gp4.parent&&this.gp4.parent.removeChild(this.gp4),n){this.gp_cost4.removeChildren();var I,A=JSON.parse(n.costs);if(A.length<3)this.gp_cost4.layout.gap=30;A.forEach(function(e,t,i){var n=new customui.CommonIconWithNum({code:e[1],num:e[2],style:CommonIconStyle.RIGHT,showEnough:!0,showDetail:!0});n.width=100,o.gp_cost4.addChild(n)}),(I=new eui.Button).skinName="skins.ButtonSkinIcon",I.icon="common_btn_shang_png",I.width=40,I.height=37,this.gp_cost4.addChild(I),I.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.cb4&&o.cb4(A)},this)}else{this.gp_cost4.removeChildren(),(P=new eui.Label("已满级")).size=25,P.percentWidth=100,P.height=41,P.verticalCenter=5,P.horizontalCenter=20,P.verticalAlign="middle",P.textAlign="center",this.gp_cost4.addChild(P),this.img_bg4.left=100,this.img_bg4.right=80}}else{var P;this.gp_cost4.removeChildren(),(P=new eui.Label("")).text=Utils.UnlockMgr.checkPass(MODULE.HeroEquipQuenchce,!1).ext.tips,P.size=23,P.percentWidth=100,P.height=41,P.verticalCenter=5,P.horizontalCenter=20,P.verticalAlign="middle",P.textAlign="center",this.gp_cost4.addChild(P)}C.push({text:"淬炼属性\n",style:HEROTHING_ATTR_STYLE[0]})}else r=!0,this.gp4.parent&&this.gp4.parent.removeChild(this.gp4);r||(0==E.length?C.push({text:"   无\n",style:HEROTHING_ATTR_STYLE[1]}):E.forEach(function(e){C.push({text:"   +",style:HEROTHING_ATTR_STYLE[3]}),C.push({text:N.GeneralConfig.getAttrValue(e[1])+" "+N.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[3]})})),this.lb_4.textFlow=C},e}(e);N.HeroThingAttr1=t,__reflect(t.prototype,"game.HeroThingAttr1");var i=function(i){function e(e){var t=i.call(this)||this;return t.hero=e.hero,t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this);var e=new eui.Group,t=new eui.VerticalLayout;e.layout=t,this.addChild(e),this.lb_1=new eui.Label,this.lb_1.lineSpacing=8,this.lb_1.width=450,e.addChild(this.lb_1)},e.prototype.update=function(g){var f=this;i.prototype.update.call(this,g);var _=[],e=N.Config.getHeroEquipConfig()[this.vo.code],t=N.Config.getHeroEquipSuitConfig(e.suitType);if(t.length){var m=this.hero&&N.GameMVC.heroThingPy.getHeroSuitCount(this.hero.uuid,e.suitType)||0,y=!0;1==t[0].professionType?_.push({text:"套装属性\n",style:HEROTHING_ATTR_STYLE[0]}):2==t[0].professionType&&(y=this.hero&&this.hero.config.profession==e.professionSuit,_.push({text:"职业套装属性（"+ProfessionConfig[e.professionSuit].name+"）\n",style:HEROTHING_ATTR_STYLE[0]})),t.forEach(function(t){var e=!1;if(t.talent){var i=JSON.parse(t.talent);f.gp_skill&&f.gp_skill.parent&&f.gp_skill.parent.removeChild(f.gp_skill);var n=g.heroUuid,o=N.GameMVC.heroThingPy.getMasterLevel(n,HeroEquipMasterType.Quenchce,!0),a=0;for(var r in i){var s=i[r];s[1]==o&&(a=s[0])}var c=N.Config.skillBaseConfig()[a];if(c){e=!0;var l=new eui.Group;l.y=80,l.width=450,l.height=110,f.gp_skill=l,f.addChild(l);var h=m>=t.num&&y,p=new customui.SkillItem;p.scaleX=p.scaleY=.8,p.x=0,p.y=17,p.updateItem({code:a}),UIActionManager.setGrey(p,!h),l.addChild(p);var d=new eui.Label;d.x=82,d.y=22,d.size=24,d.textColor=16755754,d.text=c.name||"未配置名字",l.addChild(d);var u=new eui.Label;u.left=82,u.right=2,u.y=51,u.size=20,u.textColor=h?16775908:9539985,u.text=c.desc+"（穿戴"+t.num+"件激活）\n",l.addChild(u)}}e||(JSON.parse(t.attrAdd).forEach(function(e){_.push({text:"   +"+N.GeneralConfig.getAttrValue(e[1])+" "+N.GeneralConfig.getAttrName(e[0]),style:m>=t.num&&y?HEROTHING_ATTR_STYLE[1]:HEROTHING_ATTR_STYLE[4]})}),_.push({text:m>=t.num&&y?"\n":"（穿戴"+t.num+"件激活）\n",style:HEROTHING_ATTR_STYLE[4]}))})}this.lb_1&&(this.lb_1.textFlow=_)},e}(e);N.HeroThingSuit=i,__reflect(i.prototype,"game.HeroThingSuit");var n=function(n){function e(e){var t=n.call(this)||this;return t.hero=e.hero,t}return __extends(e,n),e.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this);var e=new eui.Group,t=new eui.VerticalLayout;e.layout=t,this.addChild(e),this.lb_1=new eui.Label,this.lb_1.lineSpacing=8,e.addChild(this.lb_1)},e.prototype.update=function(e){n.prototype.update.call(this,e),this.vo=e;var t=[],i=N.Config.getHeroTreasureConfig()[this.vo.code];t.push({text:"宝物技能\n",style:HEROTHING_ATTR_STYLE[0]}),JSON.parse(i.skillAttr).forEach(function(e){t.push({text:"   +"+N.GeneralConfig.getAttrValue(e[1])+" "+N.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[3]})}),1==t.length&&t.push({text:"   无\n\n",style:HEROTHING_ATTR_STYLE[3]}),this.lb_1.textFlow=t},e}(e);N.HeroThingSkill=n,__reflect(n.prototype,"game.HeroThingSkill");var o=function(c){function e(e){var t=c.call(this)||this;return t.hero=e.hero,t.cb=e.cb,t}return __extends(e,c),e.prototype.childrenCreated=function(){c.prototype.childrenCreated.call(this),this.gp_root=new eui.Group;var e=new eui.VerticalLayout;e.gap=0,this.gp_root.layout=e,this.addChild(this.gp_root);var t=[],i=new eui.Label;t.push({text:"宝石属性\n",style:HEROTHING_ATTR_STYLE[0]}),i.height=40,i.textFlow=t,this.gp_root.addChild(i)},e.prototype.update=function(e,t){c.prototype.update.call(this,e);var i=(this.vo=e).heroUuid,n=N.AppFacade.getInstance().retrieveProxy(N.HeroPy.N).allHeroByUuid[i];for(var o in TreasureJewelType){var a=TreasureJewelType[o],r=this.makeGroup(a),s=this.makeLabel(a,n.level);r.addChild(s),this.gp_root.addChild(r)}},e.prototype.makeLabel=function(e,t){var i=new eui.Label,n=N.Config.getTreasureLockInfo(e,t),o=[],a=this.vo;if(n)o.push({text:n+"级解锁",style:HEROTHING_ATTR_STYLE[1]});else{o.push({text:(a.jewelLevel[e]||0)+"级"+TREASURE_ICON_NAME[e][1],style:HEROTHING_ATTR_STYLE[5]});var r=N.Config.getTreasureJewelUpgradeConfig(e)[a.jewelLevel[e]||0],s=JSON.parse(r.attr);s.forEach(function(e){o.push({text:"   +"+N.GeneralConfig.getAttrValue(e[1])+" "+N.GeneralConfig.getAttrName(e[0]),style:HEROTHING_ATTR_STYLE[3]})}),0==s.length&&o.push({text:"   无\n",style:HEROTHING_ATTR_STYLE[3]})}return i.textFlow=o,i},e.prototype.makeGroup=function(e){var t=new eui.Group,i=new eui.HorizontalLayout;i.verticalAlign=egret.VerticalAlign.MIDDLE,t.layout=i,this.gp_root.addChild(t);var n=new eui.Group;t.addChild(n);var o=new eui.Image("_border_m_json.common_img_jichuwupingkuang2");o.width=o.height=30,o.verticalCenter=o.horizontalCenter=0,n.addChild(o);var a=new eui.Image(TREASURE_ICON_NAME[e][0]);return a.width=a.height=26,a.verticalCenter=a.horizontalCenter=0,n.addChild(a),t},e}(e);N.HeroThingBaoshi=o,__reflect(o.prototype,"game.HeroThingBaoshi");var a=function(p){function e(e){var t=p.call(this)||this;return t.hero=e.hero,t}return __extends(e,p),e.prototype.childrenCreated=function(){p.prototype.childrenCreated.call(this);var e=new eui.Group,t=new eui.VerticalLayout;e.layout=t,this.addChild(e),this.lb_1=new eui.Label,this.lb_1.lineSpacing=8,e.addChild(this.lb_1)},e.prototype.update=function(e){p.prototype.update.call(this,e);var t=this.vo,i=N.Config.getHeroTreasureConfig(),n=0;if(4==Object.keys(t.jewelLevel).length)for(var o in n=99999,t.jewelLevel)n=Math.min(t.jewelLevel[o],n);var a=void 0,r=void 0;for(var o in i){if(!(n>=(h=i[o]).level)){r=h.level;break}a=h}var s=[];if(a.resonateLevel){var c="("+a.resonateLevel+"级)";r&&(c+="(下级共鸣于全身宝石"+r+"级解锁)"),s.push({text:"宝石共鸣"+c+"\n",style:HEROTHING_ATTR_STYLE[0]})}else s.push({text:"宝石共鸣\n",style:HEROTHING_ATTR_STYLE[0]});if(0==a.level){var l=0;for(var o in i){var h;if((h=i[o]).level){l=h.level;break}}s.push({text:" 全身宝石等级达到"+l+"级可激活\n",style:HEROTHING_ATTR_STYLE[4]})}else{JSON.parse(a.resonateAttr).forEach(function(e){s.push({text:"   +"+N.GeneralConfig.getAttrValue(e[1])+" "+N.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]})})}this.lb_1.textFlow=s},e}(e);N.HeroThingGongMing=a,__reflect(a.prototype,"game.HeroThingGongMing");var r=function(r){function e(e){var t=r.call(this)||this;return t.skinName="HeroThingUICompoent_HeroThingArtifactUpSection",t.closeFunc=e&&e.closeFunc,t.isLock=e&&e.isLock,t}return __extends(e,r),e.prototype.childrenCreated=function(){var e=this;r.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_op,egret.TouchEvent.TOUCH_TAP,function(){e.closeFunc(),N.AppFacade.getInstance().showSubView(N.HeroThingMediator.N,N.HeroThingMediator.SV.ARTIFACT_PEIYANG4,{vo:e.vo})},this),this.btn_op.visible=this.isLock.allow,this.lb_lock.visible=!this.isLock.allow,this.lb_lock.visible&&(this.lb_lock.text=this.isLock.ext.tips)},e.prototype.update=function(e,t){r.prototype.update.call(this,e);var i=N.Config.getHeroArtifactConfig()[e.code],n=[];n.push({text:"升星属性",style:HEROTHING_ATTR_STYLE[0]});var o=JSON.parse(i.sectionAttr);if(o.length?o.forEach(function(e){n.push({text:"\n    +"+N.GeneralConfig.getAttrValue(e[1])+" "+AttrConfig[e[0]].name,style:HEROTHING_ATTR_STYLE[1]})}):n.push({text:"\n    无",style:HEROTHING_ATTR_STYLE[1]}),this.lb_attr.textFlow=n,i.sectionSkill){this.gp_skill.scaleY=1,this.gp_skill.visible=!0;var a=N.Config.skillBaseConfig()[i.sectionSkill];this.skillItem.updateItem({code:i.sectionSkill}),this.lb_skillName.text=a.name,this.lb_skillDesc.text=a.desc}else this.gp_skill.scaleY=0,this.gp_skill.visible=!1;this.isLock.allow?this.btn_op.visible=t===N.HeroThingMainView.VIEW_SOURCE.MASTER||t===N.HeroThingMainView.VIEW_SOURCE.HERO||t===N.HeroThingMainView.VIEW_SOURCE.BACKPACK&&i.sectionLevel<i.sectionMax:this.btn_op.visible=!1},e}(e);N.HeroThingArtifactUpSection=r,__reflect(r.prototype,"game.HeroThingArtifactUpSection")}(game||(game={})),function(c){var e=function(n){function e(){var e=n.call(this)||this;return e.skinName="HeroTreasurePeiYangViewSkin",e.heroThingProxy=c.AppFacade.getInstance().retrieveProxy(c.HeroThingPy.N),e.curType=TreasureJewelType.Atk,e}return __extends(e,n),e.prototype.childrenCreated=function(){var i=this;for(var e in n.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this),this.btn_oper.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.heroThingProxy.TreasureInlayUpGrade(i.vo.uuid,i.curType,function(){i.updateView(),DragonBoneTools.playOnce({effectName:"common_ty_bs",parent:i.gp_root0,x:i.gp_root0.width/2,y:i.gp_root0.height/2})})},this),TreasureJewelType){var t=new o(TreasureJewelType[e],function(e){if(null!=e.vo.level)i.curType=e.type,i.updateView();else{var t=c.Config.getTreasureLockInfo(e.vo.type,e.vo.heroLevel);if(t)return void Utils.MsgUtils.addMidMsg("英雄"+t+"级解锁");i.heroThingProxy.TreasureInlayUpGrade(i.vo.uuid,e.vo.type,function(){i.updateView()})}});this.gp_root.addChild(t)}},e.prototype.updateView=function(e){var n=this;e&&(this.vo=e.vo),0!=this.gp_root.numChildren&&this.gp_root.$children.forEach(function(e,t){n.vo.jewelLevel&&n.vo.jewelLevel[t+1];var i=c.AppFacade.getInstance().retrieveProxy(c.HeroPy.N).allHeroByUuid[n.vo.heroUuid];e.update({vo:{level:n.vo.jewelLevel&&n.vo.jewelLevel[t+1],type:t+1,uuid:n.vo.uuid,heroLevel:i.level},chosen:t+1==n.curType})});var t=this.vo.jewelLevel&&this.vo.jewelLevel[this.curType]||0,i=[];this.lb_prefix.text=0<=t?"当前属性："+t+"级":"未解锁";var o=c.Config.getTreasureJewelUpgradeConfig(this.curType),a=o[0<=t?t:0];if(a){JSON.parse(a.attr).forEach(function(e){i.push({text:"+"+(0<=t?c.GeneralConfig.getAttrValue(e[1]):0)+" "+c.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]})}),this.lb_BasicAttr.textFlow=i,this.gp_costs.removeChildren();var r=o[t+1];if(r){this.lb_prefix0.y=209,this.lb_BasicAttr0.visible=!0,this.btn_oper.visible=!0,this.lb_prefix0.text="下级属性："+(t+1)+"级";var s=[];JSON.parse(r.attr).forEach(function(e){s.push({text:"+"+c.GeneralConfig.getAttrValue(e[1])+" "+c.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[2]})}),this.lb_BasicAttr0.textFlow=s,JSON.parse(r.costs).forEach(function(e){n.gp_costs.addChild(new customui.CommonIconWithNum({cost:e,style:CommonIconStyle.RIGHT,needShowHave:!0}))})}else this.lb_prefix0.y=240,this.lb_BasicAttr0.visible=!1,this.btn_oper.visible=!1,this.lb_prefix0.text="已满级"}},e}(BasePanel);c.HeroTreasurePeiYangView=e,__reflect(e.prototype,"game.HeroTreasurePeiYangView");var o=function(n){function e(e,t){var i=n.call(this)||this;return i.skinName="HeroMainView_HeroThingItem",i.type=e,i.clickFunction=t,i}return __extends(e,n),e.prototype.childrenCreated=function(){var e=this;n.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.clickFunction&&e.clickFunction(e)},this),this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.img_zhanwei&&egret.Tween.removeTweens(e.img_zhanwei)},this),this.img_jewel=new eui.Image,this.img_jewel.verticalCenter=this.img_jewel.horizontalCenter=0,this.addChildAt(this.img_jewel,1),this.img_chosen=new eui.Image("common_img_touxiangxuanzhon_png"),this.img_chosen.horizontalCenter=0,this.img_chosen.verticalCenter=-1,this.img_chosen.left=this.img_chosen.right=this.img_chosen.top=this.img_chosen.bottom=-10,this.addChild(this.img_chosen),this.img_canLevelUp=new eui.Image("_main_m_json.common_img_hongdian"),this.img_canLevelUp.right=this.img_canLevelUp.top=0,this.addChild(this.img_canLevelUp),this.img_canPuton.visible=!1},e.prototype.update=function(e){this.vo=e.vo,egret.Tween.removeTweens(this.img_zhanwei);var t=c.Config.getTreasureLockInfo(this.type,this.vo.heroLevel);if(t)this.img_jewel.visible=!1,this.img_zhanwei.visible=!0,this.img_zhanwei.source="common_img_suo_png",this.img_zhanwei.verticalCenter=-10,this.lb_unlock.visible=!0,this.lb_unlock.text="LV "+t,this.img_canLevelUp.visible=!1;else{this.img_zhanwei.visible=!1,this.lb_unlock.visible=!1,this.img_jewel.visible=!0,this.img_jewel.source=TREASURE_ICON_NAME[this.type][0];var i=c.Config.getTreasureJewelUpgradeConfig(this.vo.type)[this.vo.level+1];if(this.img_canLevelUp.visible=!1,i){var n=JSON.parse(i.costs);c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).checkEnough(n)&&(this.img_canLevelUp.visible=!0)}}this.img_chosen.visible=e.chosen},e}(eui.Component);__reflect(o.prototype,"TreasureBox")}(game||(game={})),function(a){var e=function(i){function e(e){var t=i.call(this)||this;return t.skinName="HeroThingMainViewSkin",t.vo=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){var o=this;i.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.bi_left.touchEnabled=!1,this.commonSourceJumpLabel.visible=!1,this.btn_putOff.visible=!1,this.btn_replace.horizontalCenter=0,this.btn_replace.skinName="skins.ButtonSkinYellow",this.btn_replace.label="激活",this.img_firstLine.parent.removeChild(this.img_firstLine),this.btn_replace.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().retrieveProxy(a.HeroThingPy.N).TreasurePutOn(void 0,o.vo.hero.uuid,void 0,function(e){o.hide();var t=a.AppFacade.getInstance().retrieveProxy(a.HeroThingPy.N),i=o.vo,n=t.getHeroTreasuresByUuid(o.vo.hero.uuid)[0];a.AppFacade.getInstance().showSubView(a.HeroThingMediator.N,a.HeroThingMediator.SV.MAIN,{entityType:EEntityType.EEntityTypeTreasure,vo:n,hero:i.hero,source:a.HeroThingMainView.VIEW_SOURCE.HERO})})},this)},e.prototype.updateView=function(e){this.vo=e;var t=a.Config.getHeroTreasureConfig(),i=a.Config.getHeroTreasureConfig()[0];for(var n in t){var o=t[n];0==o.level&&(i=o)}this.lb_name.text=i.name,this.lb_name.textColor=COLOR_2_FONT_COLOR[i.color],this.bi_left.updateData({type:EEntityType.EEntityTypeTreasure,code:i.code,isNum:!0}),this.lb_desc.textFlow=[{text:"介绍\n",style:HEROTHING_ATTR_STYLE[0]},{text:"   "+(i.desc||"暂无介绍"),style:HEROTHING_ATTR_STYLE[1]}]},e}(BasePanel);a.TreasureSpecialView=e,__reflect(e.prototype,"game.TreasureSpecialView")}(game||(game={})),function(n){var e=function(t){function i(e){return void 0===e&&(e=null),t.call(this,i.N,e)||this}return __extends(i,t),i.prototype.initSubView=function(){this.addSubView(i.SV.MAIN,n.LuckyTableMainView)},i.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.GENERAL_PASS_DAY]},i.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GENERAL_PASS_DAY:case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.LuckyTurntable,!1).allow&&n.GameMVC.luckyTablePy.GetLuckyTurntable()}},i.N="LuckyTableMed",i.SV={MAIN:1},i}(BaseMediator);n.LuckyTableMed=e,__reflect(e.prototype,"game.LuckyTableMed")}(game||(game={})),function(n){var e=function(){function e(){}return e.registerAll=function(){(new t).register()},e}();n.LuckyTableProcessor=e,__reflect(e.prototype,"game.LuckyTableProcessor");var t=function(e){function t(){return e.call(this,"luckyTurntable.LuckyTurntableP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody(),i=n.GameMVC.luckyTablePy.tableInfo.times==t.info.times;n.GameMVC.luckyTablePy.updateInfo(t.info,i)},t}(n.ProcessorBase);n.LuckyTurntableP=t,__reflect(t.prototype,"game.LuckyTurntableP")}(game||(game={})),function(n){var o=function(i){function e(e){var t=i.call(this)||this;return e&&t.updateData(e),t}return __extends(e,i),e.prototype.updateData=function(e){this.code=e.code,this.itemCode=e.itemCode,this.dt=e.dt},e}(n.BaseVO);__reflect(o.prototype,"LuckyTableItemVO");var a=function(i){function e(e){var t=i.call(this)||this;return t.itemList=[],e&&t.updateData(e),t}return __extends(e,i),e.prototype.updateData=function(e){var t=this;this.itemList.splice(0),e.itemList.forEach(function(e){t.itemList.push(new o(e))}),this.nAutoRefreshDt=e.nAutoRefreshDt,this.times=e.times},e}(n.BaseVO);__reflect(a.prototype,"LuckyTableVO");var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.tableInfo=new a,e.addNotice(),e}return __extends(i,t),i.prototype.addNotice=function(){NoticeManager.registerCB(NT.LUCKY_TABLE,function(){var e=JSON.parse(n.Config.constConfig().LuckyTurntableCosts.constValue);return n.GameMVC.backpackPy.checkEnough(e)},this)},i.prototype.updateInfo=function(e,t){void 0===t&&(t=!1),this.tableInfo.updateData(e),n.AppFacade.getInstance().updateView(n.LuckyTableMed.N,n.LuckyTableMed.SV.MAIN,{refresh:t}),NoticeManager.updateNotice(NT.LUCKY_TABLE)},i.prototype.GetLuckyTurntable=function(){var t=this;Utils.Socket.send("luckyTurntable","GetLuckyTurntable",{}).then(function(e){t.updateInfo(e.info)})},i.prototype.Refresh=function(t){Utils.Socket.send("luckyTurntable","Refresh",{}).then(function(e){t&&t(e)})},i.prototype.Turn=function(t){Utils.Socket.send("luckyTurntable","Turn",{}).then(function(e){t&&t(e)})},i.N="LuckyTablePy",i}(BaseProxy);n.LuckyTablePy=e,__reflect(e.prototype,"game.LuckyTablePy")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.FIXED_LAP=5,e.itemAngle=45,e.rotating=!1,e.curIndex=0,e.waitingUpdate=!1,e.proxy=a.GameMVC.luckyTablePy,e.skinName="LuckyTableMainViewSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent(),this.btn_refresh.btn_oppr.skinName="skins.ButtonSkinBlue",DragonBoneTools.playOnce({effectName:"common_zhuanpandeng_1",parent:this.gp_effect,loop:!0})},e.prototype.updateView=function(e){var s=this;if(this.rotating)this.waitingUpdate=!0;else{var t=this.proxy.tableInfo,c=a.Config.luckyTablePoolConfig();t.itemList.forEach(function(e,t){e.code;var i=e.itemCode,n=s["gp_Reward"+t];if(n&&!n.$children[0]){var o=customui.BaseItemFactory.create();n.addChild(o)}var a=n.$children[0];a.reset(),a.scaleX=a.scaleY=70/105,a.updateData({reward:JSON.parse(c[i].rewards)[0]});var r=e.dt&&!0;UIActionManager.setAbsGrey(n,r)});var i=JSON.parse(a.Config.constConfig().LuckyTurntableCosts.constValue);if(this.resorceBar.updateBar(i),this.dt=t.nAutoRefreshDt-Utils.TimerManager.getServerTime(),this.blb_time.text=Utils.TimerManager.getFormatBySecond1(this.dt),this.timer||(this.timer=egret.setInterval(function(){0<s.dt&&(s.blb_time.text=Utils.TimerManager.getFormatBySecond1(--s.dt))},this,1e3)),0==t.times?this.btn_refresh.updateData({cost:JSON.parse(a.Config.constConfig().LuckyTurntableRefreshCosts.constValue)[0],text:"刷新"}):this.btn_refresh.updateData({text:"刷新"}),e&&e.refresh){var n=-Utils.MathUtils.getRandomInt(360,720);DragonBoneTools.playOnce({effectName:"common_zhuanpanquan",parent:this.gp_effect}),this.rotateToAngle(n,function(){},1630)}}},e.prototype.rotateToIndex=function(e,t){if(!this.rotating){var i=e*this.itemAngle+this.itemAngle/2+360*this.FIXED_LAP;this.rotateToAngle(i,t)}},e.prototype.rotateToAngle=function(e,t,i){var n=this;void 0===i&&(i=5e3);for(var o=[],a=0;a<8;a++){var r=this["gp_Reward"+a];r&&o.push(r)}this.rotating=!0,GameRootLayer.gameLayer().switchTouchEnable(!1);this.gp_roll.rotation=this.gp_roll.rotation%360,egret.Tween.get(this.gp_roll,{onChange:function(){var t=360*(n.FIXED_LAP+1)-n.gp_roll.rotation;o.forEach(function(e){e.rotation=t})},onChangeObj:this}).to({rotation:e},i,function(e){return 1-Math.pow(1-e,3)}).call(function(){n.rotating=!1,GameRootLayer.gameLayer().switchTouchEnable(!0),t&&t()})},e.prototype.activateComponent=function(){var i=this;Utils.ComponentUtils.registerListener(this.btn_roll,egret.TouchEvent.TOUCH_TAP,function(){i.proxy.tableInfo.itemList.some(function(e){return 0==e.dt})?i.proxy.Turn(function(e){i.gp_effect.$children[0].visible=!1,DragonBoneTools.playOnce({effectName:"common_zhuanpandeng_2",parent:i.gp_effect,loop:!0}),i.rotateToIndex(e.info.resultCode-1,function(){i.waitingUpdate?(i.waitingUpdate=!1,i.updateView()):i.proxy.updateInfo(e.info),a.GameMVC.backpackPy.handleClientReward(e.clientReward),i.gp_effect.removeChildAt(1),i.gp_effect.$children[0].visible=!0})}):Utils.MsgUtils.addMidMsg("已获得所有奖励")},this),Utils.ComponentUtils.registerListener(this.btn_refresh,egret.TouchEvent.TOUCH_TAP,function(){var t=function(){i.proxy.Refresh(function(e){i.proxy.updateInfo(e.info);var t=-Utils.MathUtils.getRandomInt(360,720);DragonBoneTools.playOnce({effectName:"common_zhuanpanquan",parent:i.gp_effect}),i.rotateToAngle(t,function(){},1630)})};if(0==i.proxy.tableInfo.times){var e=JSON.parse(a.Config.constConfig().LuckyTurntableRefreshCosts.constValue);a.GameMgr.getInstance().showCommonTipsWin({cost:e,costTips:"刷新转盘？",needTipsToday:!0,source:"LUCKY_TABLE_REFRESH",cb:!0,clickCB:function(e){e.type&&t()}})}else t()},this),Utils.ComponentUtils.registerListener(this.btn_goto,egret.TouchEvent.TOUCH_TAP,function(){var e=JSON.parse(a.Config.constConfig().LuckyTurntableJumpCode.constValue),t=a.GameMVC.activityPy.allActivityData,i=!1;for(var n in e){var o=e[n];if(t[o]){i=!0,a.MainJumpConfig.jumpTo(),a.MainJumpConfig.jumpTo(MODULE.Activity+o);break}}i||Utils.MsgUtils.addMidMsg("暂无活动")},this),Utils.ComponentUtils.registerListener(this.btn_back,egret.TouchEvent.TOUCH_TAP,function(){a.MainJumpConfig.jumpTo()},this),Utils.ComponentUtils.registerListener(this.btn_guide,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new a.HelpDialog({moduleId:MODULE.LuckyTurntable})})},this)},e.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},e}(BasePanel);a.LuckyTableMainView=e,__reflect(e.prototype,"game.LuckyTableMainView")}(game||(game={})),function(i){var e=function(e){function t(){return e.call(this,"core")||this}return __extends(t,e),t.getInstance=function(){return null==this.instance&&(this.instance=new t),this.instance},t.prototype.initializeController=function(){e.prototype.initializeController.call(this),this.registerCommand(t.STARTUP,i.StartupCommand),this.registerCommand(t.RESTART,i.RestartCommand)},t.prototype.startUp=function(e){this.sendNotification(t.STARTUP,e),this.removeCommand(t.STARTUP)},t.prototype.showSubView=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i={}),this.retrieveMediator(e).showSubView(t,i)},t.prototype.hideSubView=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i={}),this.retrieveMediator(e).hideSubView(t,i)},t.prototype.updateView=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i={}),this.retrieveMediator(e).updateView(t,i)},t.STARTUP="startup",t.RESTART="restart",t}(puremvc.Facade);i.AppFacade=e,__reflect(e.prototype,"game.AppFacade",["puremvc.IFacade","puremvc.INotifier"])}(game||(game={})),function(g){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.localNotice=[],e.allMagicalArtifactByUuid={},e.onFormationUuid="",e.addNotice(),e}return __extends(i,t),i.prototype.addNotice=function(){NoticeManager.registerCB(NT.MAGICAL,this.checkNotice,this)},i.prototype.checkNotice=function(){var h=this,e=g.Config.allMagicalConfig(),t=[];for(var i in e){var n=e[i];t.push(n)}t.sort(function(e,t){return e.code-t.code});var p=Utils.UnlockMgr.checkPass(MODULE.MagicalUpGrade,!1).allow,d=Utils.UnlockMgr.checkPass(MODULE.MagicalUpSection,!1).allow,u=g.AppFacade.getInstance().retrieveProxy(g.BackpackPy.N);t.forEach(function(e,t){var i=e.code,n=h.getInfoByCode(i);if(n){var o=g.Config.magicalSectionConfig(i),a=(l=g.Config.magicalUpgradeConfig(i),o[n.sectionLevel+1]),r=0;if(a)r=a.magicalLevel;else r=l[l.length-1].level;var s=l[n.level+1];if(s&&d)if(n.level==r){var c=JSON.parse(a.costs);u.checkEnough(c)?h.localNotice[t]=!0:h.localNotice[t]=!1}else{c=JSON.parse(s.costs);u.checkEnough(c)?h.localNotice[t]=!0:h.localNotice[t]=!1}else h.localNotice[t]=!1}else{var l=g.Config.magicalUpgradeConfig(i)[0];u.checkEnough(JSON.parse(l.costs))&&p?h.localNotice[t]=!0:h.localNotice[t]=!1}});var o=!1;return this.localNotice.forEach(function(e){o=e||o}),o},i.prototype.updateMagicalDict=function(e,t){var i=this;void 0===t&&(t=!1),Array.isArray(e)||(e=[e]),e.forEach(function(e){if(i.allMagicalArtifactByUuid[e.uuid])i.allMagicalArtifactByUuid[e.uuid].update(e);else{var t=new g.MagicalVO(e);i.allMagicalArtifactByUuid[e.uuid]=t}e.pos&&(i.onFormationUuid=e.uuid)})},i.prototype.getInfoByCode=function(e){for(var t in this.allMagicalArtifactByUuid){var i=this.allMagicalArtifactByUuid[t];if(i.code==e)return i}},i.prototype.deteleByUuids=function(e){var t=this;e.forEach(function(e){delete t.allMagicalArtifactByUuid[e]})},i.prototype.GetMagicalInfo=function(){var t=this;Utils.Socket.send("magical","GetMagicalInfo",{}).then(function(e){t.log("获取神兵信息 GetMagicalInfoR",e),t.updateMagicalDict(e.magicalList)})},i.prototype.MagicalUpGrade=function(e){var t=this;Utils.Socket.send("magical","MagicalUpGrade",{uuid:e.uuid,num:e.num}).then(function(e){t.log("神兵升级 MagicalUpGradeR",e),t.updateMagicalDict(e.magical),g.AppFacade.getInstance().updateView(g.MagicalArtifactMediator.N,g.MagicalArtifactMediator.SV.MAIN)})},i.prototype.MagicalActivate=function(e){var t=this;Utils.Socket.send("magical","MagicalActivate",{code:e}).then(function(e){t.log("神兵激活 MagicalActivateR",e),g.AppFacade.getInstance().retrieveProxy(g.BackpackPy.N).handleClientReward(e.clientReward),g.AppFacade.getInstance().updateView(g.MagicalArtifactMediator.N,g.MagicalArtifactMediator.SV.MAIN)})},i.prototype.MagicalUpSection=function(e,t){var i=this;Utils.Socket.send("magical","MagicalUpSection",{uuid:e.uuid}).then(function(e){i.log("神兵升阶 MagicalUpSectionR",e),i.updateMagicalDict(e.magical),t&&t(),g.AppFacade.getInstance().updateView(g.MagicalArtifactMediator.N,g.MagicalArtifactMediator.SV.MAIN)})},i.prototype.MagicalPutOn=function(e){var t=this;Utils.Socket.send("magical","MagicalPutOn",{uuid:e.uuid,pos:1}).then(function(e){t.log("神兵上阵 MagicalPutOnR",e),t.updateMagicalDict(e.magicalList),g.AppFacade.getInstance().updateView(g.MagicalArtifactMediator.N,g.MagicalArtifactMediator.SV.MAIN)})},i.prototype.MagicalPutDown=function(e){var t=this;Utils.Socket.send("magical","MagicalPutDown",{uuid:e.uuid}).then(function(e){t.log("神兵下阵 MagicalPutDownR",e),t.updateMagicalDict(e.magicalList),g.AppFacade.getInstance().updateView(g.MagicalArtifactMediator.N,g.MagicalArtifactMediator.SV.MAIN)})},i.N="MagicalArtifactPy",i}(BaseProxy);g.MagicalArtifactPy=e,__reflect(e.prototype,"game.MagicalArtifactPy")}(game||(game={})),function(_){var e=function(o){function e(){var e=o.call(this)||this;e.backpackproxy=_.AppFacade.getInstance().retrieveProxy(_.BackpackPy.N),e.py=_.AppFacade.getInstance().retrieveProxy(_.MagicalArtifactPy.N),e.curSelectIndex=0,e.dataprovider=new eui.ArrayCollection,e.attrItems=new Array,e.curLevel=0,e.maxLevel=0,e.costs=[[]],e.isJiHuo=!1,Utils.AssetsMgr.loadGroup("group_magical_artifact"),e.skinName="MagicalArtifactViewSkin";var t=_.Config.allMagicalConfig();for(var i in e.config=[],t){var n=t[i];e.config.push(n)}return e.config.sort(function(e,t){return e.code-t.code}),e}return __extends(e,o),e.prototype.onDestroy=function(){o.prototype.onDestroy.call(this),egret.Tween.removeTweens(this.img_model),Utils.AssetsMgr.destroyGroup("group_magical_artifact"),_.GameMVC.playerPy.GetPlayerInfo()},e.prototype.childrenCreated=function(){var i=this;o.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this),this.list.itemRenderer=n,this.list.dataProvider=this.dataprovider,this.list.addItemTapEvent(function(e){i.dataprovider.getItemAt(i.curSelectIndex).chose=!1,i.curSelectIndex=e.itemIndex,i.dataprovider.getItemAt(i.curSelectIndex).chose=!0,i.dataprovider.refresh(),i.updateBaseInfo(),i.updateServerInfo()},this),DragonBoneTools.create("common_shenqihuoyan",function(e){e.x=this.effect.width/2-190,e.y=this.effect.height/2,e.animation.play(),this.effect.addChild(e)},this),DragonBoneTools.create("common_shenqihuoyan",function(e){e.x=this.effect.width/2+190,e.y=this.effect.height/2,e.animation.play(),this.effect.addChild(e)},this),DragonBoneTools.create("common_shenqizs",function(e){e.x=this.effect.width/2,e.y=this.effect.height/2,e.scaleX=e.scaleY=.9,e.animation.play(),this.effect.addChild(e)},this),this.btn_upgrade.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.config[i.curSelectIndex];if(e){_.Config.magicalSectionConfig(e.code),_.Config.magicalUpgradeConfig(e.code);var t=i.py.getInfoByCode(e.code);t?i.curLevel==i.maxLevel?_.AppFacade.getInstance().showSubView(_.MagicalArtifactMediator.N,_.MagicalArtifactMediator.SV.UP_SECTION_PANEL,{data:t}):i.py.MagicalUpGrade({uuid:t.uuid,num:1}):Utils.MsgUtils.addMidMsg("未拥有")}},this),this.btn_putOn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.config[i.curSelectIndex];if(e){_.Config.magicalSectionConfig(e.code),_.Config.magicalUpgradeConfig(e.code);var t=i.py.getInfoByCode(e.code);t?1==t.pos?i.py.MagicalPutDown({uuid:t.uuid}):i.py.MagicalPutOn({uuid:t.uuid}):Utils.MsgUtils.addMidMsg("未拥有")}},this),this.btn_activate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.config[i.curSelectIndex];e&&(i.backpackproxy.checkEnough(i.costs)?(i.isJiHuo=!0,DragonBoneTools.playOnce({effectName:"common_ty_jihuo",parent:i.img_model.parent,y:i.img_model.height-100}),i.py.MagicalActivate(e.code)):PopUpManager.addPopUp({obj:new _.BaseItemDetailView({type:i.costs[0][0],code:i.costs[0][1],showAccessNow:!0})}))},this),this.btn_comment.visible=!Utils.SDKMgr.getPerformConfig(44),this.btn_comment.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.config[i.curSelectIndex];_.AppFacade.getInstance().showSubView(_.MagicalArtifactMediator.N,_.MagicalArtifactMediator.SV.MAGIC_COMMENT,{info:{code:e.code}})},this),this.btn_master.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=0;for(var t in i.py.allMagicalArtifactByUuid)e+=i.py.allMagicalArtifactByUuid[t].level;_.AppFacade.getInstance().showSubView(_.HeroMediator.N,_.HeroMediator.SV.COMMON_LEVEL_MASTER,{title:"神器共鸣",config:_.Config.magicalMasterConfig(),totalLevel:e})},this),this.img_lock2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.MsgUtils.addMidMsg("敬请期待")},this),this.img_lock3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.MsgUtils.addMidMsg("敬请期待")},this),this.skillItem_1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.SkillDetailsPanel.visible=!0,i.SkillDetailsPanel.updateItem(i.skillItem_1.data)},this),this.skillItem_1.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.SkillDetailsPanel.visible=!1},this),this.skillItem_1.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.SkillDetailsPanel.visible=!1},this),this.skillItem_1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.SkillDetailsPanel.visible=!1},this),this.gp_attr.removeChildren();for(var e=1;e<=2;e++){var t=new _.HeroMainView_AttrItem(void 0);this.attrItems[e]=t,this.gp_attr.addChild(t)}this.skillItem_2.reset(),this.skillItem_3.reset();egret.Tween.get(this.img_model,{loop:!0}).to({verticalCenter:-45},600).to({verticalCenter:-60},1e3)},e.prototype.jiHuoEffect=function(){},e.prototype.updateView=function(e){NoticeManager.updateNotice(NT.MAGICAL);var t=this.config[this.curSelectIndex],i=_.Config.magicalUpgradeConfig(t.code)[1];this.top_resourceBar.updateBar(i.costs),this.resBar_has.updateBar("[[3,30000005,10]]"),this.updateBaseInfo(),this.updateServerInfo(),this.updateBottomList()},e.prototype.updateBaseInfo=function(){var e=this.config[this.curSelectIndex];e&&(this.lb_name.text=e.name,this.img_model.source=e.model+"_png",this.lb_desc.text="    "+(e.desc||"暂无简介"))},e.prototype.updateServerInfo=function(){var t=this,e=this.config[this.curSelectIndex];if(e){var i=_.Config.magicalSectionConfig(e.code),n=_.Config.magicalUpgradeConfig(e.code),o=this.py.getInfoByCode(e.code),a=!!o;this.effect.visible=a,UIActionManager.setAbsGrey(this.img_model,!a),o?(this.gp_fight.visible=!0,this.blb_fightCap.text=""+o.fightCap):(o=new _.MagicalVO({code:e.code,level:0,sectionLevel:0,attr:e.initAttr,skillList:[{code:i[0].skill}],fightCap:0}),this.gp_fight.visible=!1),this.skillItem_1.updateItem(o.skillList[0]);var r=JSON.parse(o.attr),s={};Array.isArray(r)?r.forEach(function(e){s[e[0]]=e[1]}):s=r;for(var c=1,l=1;c<=4&&l<=2;c++)s[c]&&(this.attrItems[l].updateItem({type:c,num:s[c]||0}),l++);var h=i[o.sectionLevel+1],p=0;if(h)p=h.magicalLevel;else p=n[n.length-1].level;if(this.lb_level.text=o.level+"/"+p,this.curLevel=o.level,this.maxLevel=p,a){this.btn_activate.visible=!1,this.btn_putOn.visible=!0;var d=n[o.level+1];if(d){if(this.btn_upgrade.visible=!0,this.curLevel==this.maxLevel)this.btn_maxLevel.visible=!0,this.gp_cost.visible=!1,this.btn_upgrade.skinName="skins.ButtonSkinYellow",this.btn_upgrade.label="进阶";else{this.btn_maxLevel.visible=!1,this.gp_cost.visible=!0,this.btn_upgrade.skinName="skins.ButtonSkinGreen",this.btn_upgrade.label="升级";var u=JSON.parse(d.costs);this.gp_cost.removeChildren(),u.forEach(function(e){t.gp_cost.addChild(new customui.CommonIconWithNum({cost:e,style:CommonIconStyle.RIGHT}))})}this.btn_maxLevel.bottom=77}else this.btn_upgrade.visible=!1,this.gp_cost.visible=!1,this.btn_maxLevel.visible=!0,this.btn_maxLevel.bottom=41;this.lb_way.text=""}else{this.btn_activate.visible=!0,this.btn_maxLevel.visible=!1,this.btn_upgrade.visible=!1;var g=n[0],f=(u=JSON.parse(g.costs),_.AppFacade.getInstance().retrieveProxy(_.BackpackPy.N));this.btn_activate.updateData({text:"激活"}),f.checkEnough(u)?(this.lb_way.text="",UIActionManager.setGrey(this.btn_activate,!1),this.btn_activate.touchEnabled=!0,this.btn_activate.touchChildren=!0):(this.lb_way.text=""+e.wayDesc,UIActionManager.setGrey(this.btn_activate,!0),this.btn_activate.touchEnabled=!1,this.btn_activate.touchChildren=!1),this.costs=u,this.gp_cost.visible=!1,this.btn_putOn.visible=!1}1==o.pos?(this.btn_putOn.icon="_btn_lb_m_json.common_icon_xiexia",this.btn_putOn.label="卸下"):(this.btn_putOn.label="佩戴",this.btn_putOn.icon="_btn_lb_m_json.common_icon_peidai")}},e.prototype.updateBottomList=function(){var e=[],t=_.AppFacade.getInstance().retrieveProxy(_.BackpackPy.N);for(var i in this.config){var n=this.config[i],o=n.code,a=this.py.getInfoByCode(o);if(n.chose=!1,a)n.activate=!0,1==a.pos?(n.puton=!0,this.initComplete||(this.curSelectIndex=parseInt(i))):n.puton=!1,n.canActivate=!1;else{var r=_.Config.magicalUpgradeConfig(o)[0];t.checkEnough(JSON.parse(r.costs))?n.canActivate=!0:n.canActivate=!1,n.activate=!1,n.puton=!1}n.notice=this.py.localNotice[i],e.push(n)}e[this.curSelectIndex].chose=!0,this.dataprovider.replaceAll(e),this.initComplete||(this.list.validateNow(),this.initComplete=!0,this.list.changeTo({itemIndex:this.curSelectIndex}))},e}(BasePanel);_.MagicalArtifactView=e,__reflect(e.prototype,"game.MagicalArtifactView");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="MagicalItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gp_main.scaleX=this.gp_main.scaleY=e.choseScale},e.prototype.dataChanged=function(){this.data.activate?(this.img_bg.source="shenbing_img_diyipeidai_png",this.data.puton?(this.bm_tip.text="已佩戴",this.bm_tip.verticalCenter=-79.5):this.bm_tip.text="",UIActionManager.setGrey(this.img_model,!1)):this.data.canActivate?(this.img_bg.source="shenbing_img_dikejihuo_png",this.bm_tip.text="",this.bm_tip.verticalCenter=0,UIActionManager.setGrey(this.img_model,!1)):(this.img_bg.source="shenbing_img_diweijihuo_png",this.bm_tip.verticalCenter=0,this.bm_tip.text="未激活",UIActionManager.setGrey(this.img_model,!0)),this.img_model.source=this.data.model+"_png",this.lb_name.text=this.data.name,this.gp_main.scaleX=this.gp_main.scaleY=this.data.chose?1:e.choseScale},e.itemWidth=164,e.choseScale=.85,e}(eui.ItemRenderer);__reflect(n.prototype,"MagicalItem")}(game||(game={})),function(l){var e=function(i){function e(e){var t=i.call(this)||this;return t.array=[],t.zanNumber=0,t.commentNum=0,t.playerPy=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),t.loginProxy=l.AppFacade.getInstance().retrieveProxy(l.LoginPy.N),t.skinName="MagicCommentSkin",t}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.btn_zan.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.dianZan(e)},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.skill_panel.visible=!1,this.tinput_text.textDisplay.size=24,this.initMidView(),this.initBottomView(),this.skillItem_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.MsgUtils.addMidMsg("敬请期待")},this),this.skillItem_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.MsgUtils.addMidMsg("敬请期待")},this);egret.Tween.get(this.img_model,{loop:!0}).to({verticalCenter:25},600).to({verticalCenter:10},1e3),this.timer=egret.setInterval(function(){t.getPlayerTupMagic()},this,3e4)},e.prototype.updateView=function(e){var t=e&&e.info;this.params=l.Config.allMagicalConfig()[t.code],this.playerStatus(),this.getPlayerTupMagic(),this.once(egret.Event.ENTER_FRAME,this.initTopView,this)},e.prototype.playerStatus=function(){var t=this,e=l.AppFacade.getInstance().retrieveProxy(l.LoginPy.N);Utils.Http.toGet({action:"get_HeroStatus",code:this.params.code,player_id:e.playerProxy.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,project:Utils.agentConfig.ProjectName}).then(function(e){t.lb_zanCounts.text=""+e.num,t.zanNumber=e.num,t.isZan=e.status}).catch(function(e){console.log("----get_MagicStatus",e)})},e.prototype.initTopView=function(){this.lb_title.text=this.params.name,this.img_model.source=ResourceUtils.png(this.params.model),this.lb_desc.text="    "+this.params.desc;var e=l.Config.magicalUpgradeConfig(this.params.code),t=e[e.length-1].level;this.lb_lv.text=t+"/"+t,this.lb_zanCounts.text=this.zanNumber.toString();var i=l.Config.magicalSectionConfig(this.params.code),n=i[0];for(var o in i){var a=i[o];a.level>n.level&&(n=a)}this.skillItem_0.updateItem({code:n.skill}),this.bindSkillPanelClick({target:this.skillItem_0,x:34,bottom:200}),this.updateAttr()},e.prototype.bindSkillPanelClick=function(t){var i=this,n=t.target;n.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){if(n.data&&n.data.code)for(var e in i.skill_panel.visible=!0,i.skill_panel.updateItem({code:n.data.code}),t)"target"!=e&&(i.skill_panel[e]=t[e])},this),n.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skill_panel.visible=!1},this),n.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skill_panel.visible=!1},this),n.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skill_panel.visible=!1},this)},e.prototype.dianZan=function(e){0==this.isZan?(Utils.MsgUtils.addNumberEffect("+1",this.btn_zan,e.stageX,e.stageY,1),this.thumbsUp()):Utils.MsgUtils.addMidMsg("已赞过此神器")},e.prototype.updateAttr=function(){var e=this.params,t=l.Config.magicalUpgradeConfig(this.params.code),i=l.Config.magicalSectionConfig(this.params.code),n=[],o=JSON.parse(e.initAttr),a=JSON.parse(t[t.length-1].attr),r=JSON.parse(i[i.length-1].attr);for(var s in n=l.GeneralConfig.AttrAddAttr(n,o),n=l.GeneralConfig.AttrAddAttr(n,a),n=l.GeneralConfig.AttrAddAttr(n,r))n[s][1]=Math.floor(n[s][1]);n.sort(function(e,t){return e[0]-t[0]}),this.gp_upgrade_attr.removeChildren();for(var c=1;c<=4;c++)n[c-1]&&this.gp_upgrade_attr.addChild(new l.HeroMainView_AttrItem({type:c,num:n[c-1][1]}))},e.prototype.thumbsUp=function(){var t=this,e=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N);Utils.Http.toGet({action:"set_HerothumbsUp",moduleType:EEntityType.EEntityTypeHeroArtifact,code:this.params.code,player_id:e.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,project:Utils.agentConfig.ProjectName,server_id:this.loginProxy.serverSelect.s_id,area:this.loginProxy.serverSelect.area}).then(function(e){console.log("set_HerothumbsUp"+e),t.playerStatus()}).catch(function(e){console.log("set_HerothumbsUp"+e)})},e.prototype.initMidView=function(){this.list=new eui.List;var e=new eui.TileLayout;e.horizontalGap=5,e.requestedColumnCount=1,this.list.layout=e,this.list.itemRenderer=t,this.sl_center.viewport=this.list,this.sl_center.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_center.scrollPolicyV=eui.ScrollPolicy.AUTO},e.prototype.initBottomView=function(){this.btn_send.addEventListener(egret.TouchEvent.TOUCH_TAP,this.playerTupMagic,this)},e.prototype.playerTupMagic=function(){var t=this,e=l.Config.constConfig().HeroCommentLevelRequire,i=JSON.parse(e.constValue),n=JSON.parse(l.Config.constConfig().DefaultAvatar.constValue)[0];this.playerPy.playerInfoVO.playerVip.vipLevel>=i[0]||this.playerPy.playerInfoVO.level>=i[1]?this.tinput_text.text&&""!=this.tinput_text.text?Utils.Http.toGet({action:"set_PlayerTup_hero",moduleType:EEntityType.EEntityTypeHeroArtifact,code:this.params.code,player_id:this.playerPy.playerInfoVO.playerId,head:this.playerPy.playerInfoVO.avatar||n,name:this.playerPy.playerInfoVO.name,content:this.tinput_text.text,type:l.HeroCommentView.commentType.PINGLUN,tup_player:this.playerPy.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,subPlatform:Utils.agentConfig.channelName||"",project:Utils.agentConfig.ProjectName,area:this.loginProxy.serverSelect.area,server_id:this.loginProxy.serverSelect.s_id,from_server_id:this.loginProxy.serverSelect.area}).then(function(e){1==e.code?(t.getPlayerTupMagic(),Utils.MsgUtils.addMidMsg("评论成功！")):2==e.code&&Utils.MsgUtils.addMidMsg("你已发表过评论！"),t.tinput_text.text=void 0}).catch(function(e){console.log("set_PlayerTup_magic"+e)}):Utils.MsgUtils.addMidMsg("请输入内容！"):Utils.MsgUtils.addMidMsg("等级达到"+i[1]+"级或VIP到达"+i[0]+"级可评论")},e.prototype.getPlayerTupMagic=function(s){var c=this;if(s&&0<this.array.length&&s.params.type==l.HeroCommentView.commentType.DIANZAN){s.params.info;return this.array.sort(function(e,t){return c.sortByTime(e,t)}),this.sortByLike(),void this.list.dataProvider.replaceAll(this.array)}Utils.Http.toGet({action:"get_PlayerTup_hero",code:this.params.code,player_id:this.playerPy.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,project:Utils.agentConfig.Project}).then(function(e){for(var t in c.commentNum=0,c.array=[],e)if(e[t].content&&e[t].player_id&&e[t].name){++c.commentNum;var i={code:c.params.code,id:e[t].player_id,name:e[t].name,head:e[t].head,content_id:t,content:e[t].content,num:Number(e[t].num),tup_player:e[t].tup_player,time:e[t].createTime,strTime:Number(e[t].strTime),serverId:e[t].area};c.array.push(i)}if(c.array.sort(function(e,t){return c.sortByTime(e,t)}),c.origin_arr.length<=0)for(var n=0,o=c.array;n<o.length;n++){t=o[n];c.origin_arr.push(t),c.commonArr.push(t)}if(c.newArr=[],c.origin_arr.length!=c.array.length)for(var a=c.array.length-c.origin_arr.length,r=0;r<a;)c.newArr.push(c.array[r]),++r;s&&s.priority?c.commentsFloatingEffect({priority:s.priority,id:s.id}):c.commentsFloatingEffect(),c.sortByLike(),c.list.dataProvider=new eui.ArrayCollection(c.array),c.gp_null.visible=0==c.commentNum})},e.prototype.onDestroy=function(){egret.Tween.removeTweens(this.img_model),egret.clearInterval(this.timer),i.prototype.onDestroy.call(this)},e.commentType={PINGLUN:1,DIANZAN:2},e}(l.CommonComment);l.MagicCommentView=e,__reflect(e.prototype,"game.MagicCommentView");var t=function(i){function e(){var e=i.call(this)||this;return e.skinName="CommentItemSkin",e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this);var e=this.btn_love.labelDisplay;e.size=19,e.stroke=1,this.btn_love.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.playerTupMagic(e)},this)},e.prototype.dataChanged=function(){this.lb_time.text="["+this.data.time+"]",this.lb_comments.text=""+this.data.content,this.lb_playerName.text=this.data.name,this.playerHead.updateData({vo:{level:1,avatar:this.data.head}}),this.btn_love.labelDisplay.text=this.data.num.toString(),this.data.tup_player?(UIActionManager.setGrey(this.btn_love,!0),this.btn_love.touchEnabled=!1):(UIActionManager.setGrey(this.btn_love,!1),this.btn_love.touchEnabled=!0)},e.prototype.playerTupMagic=function(t){var i=this,n=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),e=l.AppFacade.getInstance().retrieveProxy(l.LoginPy.N);Utils.Http.toGet({action:"set_PlayerTup_hero",moduleType:EEntityType.EEntityTypeHeroArtifact,code:this.data.code,player_id:this.data.id,name:this.data.name,content:this.data.content,head:this.data.head,type:l.HeroCommentView.commentType.DIANZAN,tup_player:n.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,subPlatform:Utils.agentConfig.channelName||"",project:Utils.agentConfig.ProjectName,server_id:e.serverSelect.s_id,area:this.data.serverId,from_server_id:e.serverSelect.area}).then(function(e){Utils.MsgUtils.addNumberEffect("+1",i.btn_love,t.stageX,t.stageY,-1),++i.data.num,i.data.tup_player=n.playerInfoVO.playerId,l.AppFacade.getInstance().sendNotification(CN.MAGICCOMMENT_UPDATE,{info:i.data,type:l.HeroCommentView.commentType.DIANZAN})}).catch(function(e){console.log("set_PlayerTup_magic"+e)})},e}(eui.ItemRenderer);__reflect(t.prototype,"magicCommentItem")}(game||(game={})),function(i){var e=function(){function e(){}return e.registerAll=function(){(new t).register()},e}();i.MagicalProcessor=e,__reflect(e.prototype,"game.MagicalProcessor");var t=function(e){function t(){return e.call(this,"magical.MagicalInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("MagicalInfoP",t),i.AppFacade.getInstance().retrieveProxy(i.MagicalArtifactPy.N).updateMagicalDict(t.magicalList)},t}(i.ProcessorBase);i.MagicalInfoP=t,__reflect(t.prototype,"game.MagicalInfoP")}(game||(game={})),function(_){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroUpsectionSkin",e.heroPy=_.AppFacade.getInstance().retrieveProxy(_.HeroPy.N),e.magicalArtifactPy=_.AppFacade.getInstance().retrieveProxy(_.MagicalArtifactPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.addListener(),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;this.magicalArtifactPy.MagicalUpSection({uuid:this.data.uuid},function(){e.hide()})},this),this.resource_bar.visible=!0},e.prototype.addListener=function(){this.skill_item.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.showSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_END,this.hideSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.hideSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.hideSkillDetail,this)},e.prototype.initList=function(){this.attr_list.itemRendererSkinName="HeroUpsectionPanel_AttrItem"},e.prototype.updateView=function(e){var t=this;this.data=e.data;this.data.level;var i=_.Config.magicalSectionConfig(this.data.code),n=(_.Config.allMagicalConfig()[this.data.code],_.Config.magicalUpgradeConfig(this.data.code)),o=i[this.data.sectionLevel+1],a=i[this.data.sectionLevel],r=i[this.data.sectionLevel+2],s=[],c=0;for(var l in n){var h=n[l];h.level>c&&(c=h.level)}s.push({desc:"等级上限：",before:o.magicalLevel,after:Math.min(c,r&&r.magicalLevel||9999999)});var p=JSON.parse(o.attr),d=JSON.parse(a&&a.attr),u=JSON.parse(this.data.attr);p.forEach(function(t){var i=0;d.forEach(function(e){t[0]==e[0]&&(i=e[1])});var e={desc:AttrConfig[t[0]].name+"：",before:Math.floor(Number(_.GeneralConfig.getAttrValue(u[t[0]]))).toString()};e.after=Math.floor(Number(e.before)+Number(_.GeneralConfig.getAttrValue(t[1]))-Number(_.GeneralConfig.getAttrValue(i))).toString(),s.push(e)}),this.attr_list.dataProvider=new eui.ArrayCollection(s);var g=o.skill;g?(this.gp_unlock.visible=!0,this.skill_item.updateItem({code:g}),this.skillDetailPanel.updateItem({code:g})):this.gp_unlock.visible=!1;var f=JSON.parse(o.costs);this.resource_bar.updateBar(f),f.forEach(function(e){t.gp_cost.addChild(new customui.CommonIconWithNum({cost:e,showEnough:!0,style:CommonIconStyle.RIGHT}))})},e.prototype.showSkillDetail=function(){this.skillDetailPanel.visible=!0},e.prototype.hideSkillDetail=function(){this.skillDetailPanel.visible=!1},e}(BasePanel);_.MagicUpsectionPanel=e,__reflect(e.prototype,"game.MagicUpsectionPanel")}(game||(game={})),function(i){var e=function(){function e(){}return e.create=function(e){var t=Utils.ObjectPoolMgr.pop("game.ManorBaseHead",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},e}();i.ManorBaseHeadFactory=e,__reflect(e.prototype,"game.ManorBaseHeadFactory");var t=function(t){function e(){var e=t.call(this)||this;return e.skinName="ManorBaseHead",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.updateData=function(e){this._preParams=e,this.code=e.code,this.decorateHero(e)},e.prototype.decorateHero=function(e){this.config=i.Config.allHeroConfig(!1)[this.code]||i.Config.creepConfig(this.code),e.avatar?this.decorateIcon(ResourceUtils.png(e.avatar)):this.decorateIcon(ResourceUtils.png(this.config.avatar))},e.prototype.decorateIcon=function(e){this.img_icon.source=e},e.prototype.onOPReset=function(){},e.prototype.onOPComeBack=function(e,t){e&&this.updateData(e)},e.prototype.onOPClean=function(){},e.prototype.onOPCheck=function(e){egret.log("alive")},e}(eui.Component);i.ManorBaseHead=t,__reflect(t.prototype,"game.ManorBaseHead",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(game||(game={})),function(s){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ManorBuyPanel",e.bpProxy=s.AppFacade.getInstance().retrieveProxy(s.BackpackPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent()},e.prototype.perShow=function(e){this.costValue=e.costValue,this.curNum=e.curNum,this.maxNum=e.maxNum,this.buyCB=e.buyCB,this.maxBuyNum=this.maxNum-this.curNum,this.cost=JSON.parse(this.costValue);var t=this.maxBuyNum;for(var i in this.cost){var n=this.bpProxy.getInfoByCode(this.cost[i][1]).haveNum;t=Math.min(Math.floor(n/this.cost[i][2]),t)}return this.maxBuyNum=t,!0},e.prototype.updateView=function(e){this.setValueTo(1)},e.prototype.setValueTo=function(e,t){e>this.maxBuyNum&&(e=this.maxBuyNum,t&&e<this.maxNum-this.curNum&&Utils.MsgUtils.addMidMsg("钻石不足!")),e<1&&(e=1),this.lb_num.text=e.toString(),this.updateTips()},e.prototype.updateTips=function(){this.gp_tips.removeChildren();var e=new eui.Label;for(var t in e.size=24,e.textColor=7491637,e.text="确定消耗",this.gp_tips.addChild(e),this.cost){var i=this.bpProxy.getInfoByCode(this.cost[t][1]),n=new eui.Image(ResourceUtils.png(i.info.icon));n.width=n.height=s.GeneralConfig.fixedSizeWH,this.gp_tips.addChild(n);var o=new eui.Label;o.size=24,o.textColor=7491637,this.gp_tips.addChild(o);var a=Number(this.lb_num.text)*Number(this.cost[t][2]);o.text="x"+a}var r=new eui.Label;r.size=24,r.textColor=7491637,r.text="购买?",this.gp_tips.addChild(r)},e.prototype.activateComponent=function(){var e=this;this.lb_num.addEventListener(egret.Event.CHANGE,function(){Number(e.lb_num.text)>e.maxBuyNum&&(e.lb_num.text=e.maxBuyNum.toString()),e.updateTips()},this),this.lb_num.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){""!=e.lb_num.text&&Number(e.lb_num.text)||e.setValueTo(1)},this),Utils.TouchUtils.addTouchListener(this.btn_min,function(){e.setValueTo(Number(e.lb_num.text)-10)}),Utils.TouchUtils.addTouchListener(this.btn_sub,function(){e.setValueTo(Number(e.lb_num.text)-1)}),Utils.TouchUtils.addTouchListener(this.btn_add,function(){e.setValueTo(Number(e.lb_num.text)+1,!0)}),Utils.TouchUtils.addTouchListener(this.btn_max,function(){e.setValueTo(Number(e.lb_num.text)+10,!0)}),Utils.TouchUtils.addTouchListener(this.btn_cancle,function(){e.hide()}),Utils.TouchUtils.addTouchListener(this.btn_confirm,function(){e.hide(),e.buyCB(Number(e.lb_num.text))})},e}(BasePanel);s.ManorBuyPanel=e,__reflect(e.prototype,"game.ManorBuyPanel")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ManorCollectRewardSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEvent(),this.params&&this.params.entityList&&(2<this.params.entityList.length?this.gp_main.height=495:this.gp_main.height=445)},e.prototype.perShow=function(e){var i=(this.params=e).rewards;Array.isArray(i)&&(i={rewards:i});var n=0;return G_REWARD_NAME.forEach(function(e){var t=i[e]||[];n+=t.length}),0!=n},e.prototype.perClose=function(){if(this.params&&this.params.entityList)for(var e in this.params.entityList)i.GameMVC.manorPy.AccountRewards(Number(e))},e.prototype.addEvent=function(){var e=this;Utils.TouchUtils.addTouchListener(this.btn_confirm,function(){e.hide()})},e.prototype.updateView=function(){var i=this;this.gp_desc.removeChildren();var e=new eui.Label;e.width=380,e.height=void 0,e.textFlow=this.params.textFlow,this.gp_desc.addChild(e),this.gp_rewards.removeChildren(),this.params.rewards.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),i.gp_rewards.addChild(t)})},e}(BasePanel);i.ManorCollectRewardPanel=e,__reflect(e.prototype,"game.ManorCollectRewardPanel")}(game||(game={})),function(T){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ManorDetailPanel",e.isOwn=!1,e.manorPy=T.AppFacade.getInstance().retrieveProxy(T.ManorProxy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_tips),this.initScroll(),this.addEvent(),this.once(egret.Event.ENTER_FRAME,function(){e.manorPy.GetManorDetailInfo(e.vo.info.manorId)},this),this.surplus_time=0,this.cd_start=!1,this.cur_times=0,this.startTimer(1e3)},e.prototype.bindTipsPanelClick=function(e){var t=this,i=e.target;i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,e.cb,this),i.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.gp_tips.visible=!1},this),i.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){t.gp_tips.visible=!1},this),i.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.gp_tips.visible=!1},this)},e.prototype.perShow=function(e){return this.vo=e.vo,!0},e.prototype.perClose=function(){this.stopTimer()},e.prototype.initScroll=function(){this.list_item.itemRenderer=i},e.prototype.requireDetail=function(){this.vo&&this.vo.info&&this.vo.info.manorId&&this.manorPy.GetManorDetailInfo(this.vo.info.manorId)},e.prototype.updateView=function(e){var i=this,n=T.Config.manor()[this.vo.info.id];if(n){var o=this.manorPy.queryManoeEntityByManorId(this.vo.info.manorId),t=o.playerManorList;for(var a in this.isOwn=!1,t){var r=t[a].baseInfo.playerId;if(T.GameMVC.loginPy.isSelf(r)&&t[a].entityIndex==this.manorPy.lastEntityIndex){this.isOwn=!0;break}}var s=this.manorPy.selfEntity.baseInfo,c=!1;o.guildName&&""!=o.guildName&&s.guild&&""!=s.guild&&o.guildName==s.guild.name&&o.guildId==s.guild.id&&(c=!0);var l=[];o.num<n.num&&!this.isOwn&&l.push({isEmpty:!0,manorId:this.vo.info.manorId}),t.forEach(function(e){var t=e;t.manorId=i.vo.info.manorId,t.guildName=o.guildName,t.guildId=o.guildId,l.push(t)}),l.sort(function(e,t){return e.isEmpty?-1:t.isEmpty?1:T.GameMVC.loginPy.isSelf(e.baseInfo.playerId)&&e.entityIndex==i.manorPy.lastEntityIndex?-1:T.GameMVC.loginPy.isSelf(t.baseInfo.playerId)&&t.entityIndex==i.manorPy.lastEntityIndex?1:T.GameMVC.loginPy.isSelf(e.baseInfo.playerId)?-1:T.GameMVC.loginPy.isSelf(t.baseInfo.playerId)?1:e.baseInfo.guild&&e.baseInfo.guild.name&&e.baseInfo.guild.id==o.guildId&&e.baseInfo.guild.name==o.guildName?-1:t.baseInfo.guild&&t.baseInfo.guild.name&&t.baseInfo.guild.id==o.guildId&&t.baseInfo.guild.name==o.guildName?1:0}),this.scl_list.stopAnimation(),this.scl_list.validateNow();var h=this.scl_list.viewport.scrollV;this.list_item.dataProvider?this.list_item.dataProvider.replaceAll(l):this.list_item.dataProvider=new eui.ArrayCollection(l);var p=this.scl_list.viewport.contentHeight-this.gp_scroll.contentHeight;this.scl_list.viewport.scrollV=Math.min(h,Math.max(p,0)),this.lb_title.text=n.name,this.lb_player_num.text=o.num+"/"+n.num,this.cd_start=0<o.num;var d=this.manorPy.calSurplusTime(o);this.surplus_time=Math.ceil(d/Math.max(o.num,1)),this.lb_collect_time.text=Utils.TimerManager.getFormatBySecond1(this.surplus_time);var u=this.manorPy.calCollectTotalGoods(o)+o.collectedTime,g=this.manorPy.calSurplusGoods(o);this.pb_exp.maximum=u+g,this.pb_exp.value=g,this.pb_exp.labelFunction=function(e,t){var i=100*e/t;return 99<=i&&n.maxCollectTime>d?"99%":Math.ceil(i)+"%"},""!=o.guildName&&o.guildName?(this.lb_guild_name.text="S"+o.guildServerId+"."+o.guildName,c?o.isSameGuild?(this.lb_improve_ratio1.textColor=16774656,this.lb_improve_ratio2.textColor=16774656):(this.lb_improve_ratio1.textColor=16774656,this.lb_improve_ratio2.textColor=9934743):(this.lb_improve_ratio1.textColor=9934743,this.lb_improve_ratio2.textColor=9934743)):(this.lb_guild_name.text="无",this.lb_improve_ratio1.textColor=9934743,this.lb_improve_ratio2.textColor=9934743);var f=this.lb_guild_name.width,_=this.img_name_bg.width;126<f&&(_=f+20,this.img_name_bg.width=Math.min(_,210));var m=JSON.parse(n.improveRatio),y=m[0]/10+"%",v=m[1]/10+"%";this.lb_improve_ratio1.text="公会归属加成+"+y,this.lb_improve_ratio2.text="公会独占加成+"+v,this.lb_enough_tips.visible=o.num>=n.num,this.bindTipsPanelClick({target:this.img_wenhao,cb:function(){i.gp_tips.visible=!0,i.lb_desc.textFlow=[{text:"占领该矿的公会，公会成员会增加"+y+"产量，当矿中没有其他公会成员时会额外增加"+v+"产量。",style:{size:20,textColor:16777215}}]}})}else console.log(" t_manor.json 未配置",this.vo.info.id)},e.prototype.removeManorEntity=function(e){this.vo.info.manorId==e.manorId&&this.hide()},e.prototype.addEvent=function(){this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.gp_look.touchEnabled=!0,this.gp_look.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=T.Config.manor()[this.vo.info.id];if(e){var t=JSON.parse(e.oneDayRewards),i="";if(this.manorPy.queryManoeEntityByManorId(this.vo.info.manorId).isSpecial){var n=JSON.parse(e.improveRatio);for(var o in i="超级矿产量额外增加"+n[2]/10+"%",t)t[o][2]=Math.ceil(t[o][2]*(1+n[2]/1e3))}T.AppFacade.getInstance().showSubView(T.CommonMediator.N,T.CommonMediator.SV.REWARD_PANEL,{rewards:t,top_tips:"预计每5秒可产出",bottom_tips:i,type:T.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})}else console.log(" t_manor.json 未配置",this.vo.info.id)},this),this.lb_look.textFlow=[{text:"点击查看",style:{href:"event:showTips",size:20,underline:!0}}],this.lb_look.touchEnabled=!1},e.prototype.startTimer=function(e,t){this.timer||(this.timer=new egret.Timer(1e3)),this.stopTimer(),this.timer.delay=e||1e3,this.timer.repeatCount=t||0,this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this.timer.reset(),this.timer.start()},e.prototype.stopTimer=function(){this.timer&&(this.timer.stop(),this.timerComFunc())},e.prototype.timerFunc=function(){this.cur_times+=1,3<=this.cur_times&&(this.cur_times=0),this.cd_start&&(this.surplus_time-=1,this.surplus_time<=0&&(this.surplus_time=0),this.lb_collect_time&&this.isOwn&&(this.lb_collect_time.text=Utils.TimerManager.getFormatBySecond1(this.surplus_time)))},e.prototype.timerComFunc=function(){this.timer&&(this.timer.removeEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this))},e}(BasePanel);T.ManorDetailPanel=e,__reflect(e.prototype,"game.ManorDetailPanel");var i=function(h){function e(){var e=h.call(this)||this;return e.skinName="ManorDetailPanel_Item",e.manorPy=T.AppFacade.getInstance().retrieveProxy(T.ManorProxy.N),e.manorMed=T.AppFacade.getInstance().retrieveMediator(T.ManorMediator.N),e}return __extends(e,h),e.prototype.childrenCreated=function(){h.prototype.childrenCreated.call(this),this.addEvent()},e.prototype.addEvent=function(){var e=this;this.btn_capture.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=this,i=this.data.manorId,n=this.data.baseInfo.playerId,o=this.manorPy.lastEntityIndex,a=this.data.entityIndex;T.GameMVC.loginPy.isSelf(n)?Utils.MsgUtils.addMidMsg("不能挑战自己!"):(T.GameMVC.commonMed.showContinuousBattleView({pb1:"manor",pb2:"Capture",params:{manorId:i,tPlayerId:n,entityIndex:o,tEntityIndex:a},tipsFunc:function(e){return"第"+e+"场"},closeCB:function(){t.manorPy.GetManorDetailInfo(i)}}),this.manorMed.hideSubView(T.ManorMediator.SV.DETAIL))},this),this.img_add_zi.touchEnabled=!1,this.img_plus.touchEnabled=!1,this.img_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=this.data.manorId,i=this.manorPy.lastEntityIndex;this.manorPy.Capture(t,0,i,0)},this),this.btn_leave.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=this;T.GameMgr.getInstance().showCommonTipsWin({commonTips:"确定迁出该矿点吗?",source:"manor_leave",cb:!0,clickCB:function(e){1==e.type&&(t.manorPy.LeaveManor(t.manorPy.lastEntityIndex),t.manorMed.hideSubView(T.ManorMediator.SV.DETAIL))}})},this),this.playerHead.addTapEvent(function(){e.data&&e.data.baseInfo&&e.data.baseInfo.playerId&&T.AppFacade.getInstance().showSubView(T.FriendMediator.N,T.FriendMediator.SV.INFO,{playerId:e.data.baseInfo.playerId,moduleId:MODULE.Manor,entityIndex:e.data.entityIndex}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)})},e.prototype.dataChanged=function(){h.prototype.dataChanged.call(this);var e=this.data.isEmpty;if(this.ep_add.visible=e,this.ep_member.visible=!e,e);else{var t=this.data.baseInfo;this.img_self_team.visible=!1,this.blb_self_team.visible=!1,T.GameMVC.loginPy.isSelf(t.playerId)?(this.btn_capture.visible=!1,this.data.entityIndex==this.manorPy.lastEntityIndex?this.btn_leave.visible=!0:(this.btn_leave.visible=!1,this.img_self_team.visible=!0,this.blb_self_team.visible=!0)):(this.btn_capture.visible=!0,this.btn_leave.visible=!1);var i=0,n="",o=T.GameMVC.guildPy.guildDetail;o&&(i=o.guildId,n=o.name);var a=this.data.baseInfo.serverId,r=this.data.baseInfo.guild,s=0,c="";r&&(s=r.id,c=r.name),0!=i&&0!=s&&String(i)==String(s)&&""!=c&&""!=n&&c==n&&(this.btn_capture.visible=!1),this.playerHead.updateData({vo:t,ignoreLevel:1,effect:!1}),this.lb_name.text=t.name;var l="";t.guild&&t.guild.name&&(l="S"+a+"."+c),this.lb_guild_name.text=l,this.item_fightCap.update(this.data.teamInfo.fightCap),this.pb_exp.maximum=100,this.pb_exp.value=this.data.blood,this.data.guildName&&""!=this.data.guildName&&t.guild&&t.guild.name&&this.data.guildName==t.guild.name&&this.data.guildId==t.guild.id?this.img_own.visible=!0:this.img_own.visible=!1}},e}(eui.ItemRenderer);__reflect(i.prototype,"ManorDetailPanel_Item")}(game||(game={})),function(m){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ManorDetailSimplePanel",e.manorPy=m.AppFacade.getInstance().retrieveProxy(m.ManorProxy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addEvent()},e.prototype.perShow=function(e){return this.vo=e.vo,this.choice=e.choice,!0},e.prototype.perClose=function(){},e.prototype.updateView=function(e){var i=this,n=m.Config.manor()[this.vo.info.id];if(n){var t=this.manorPy.queryManoeEntityByManorId(this.vo.info.manorId);this.lb_title.text=n.name;var o=t.isSpecial;if(o){var a=JSON.parse(n.improveRatio);this.lb_tips.text="超级矿产量额外增加"+a[2]/10+"%"}this.lb_tips.visible=o,this.lb_player_num.text=t.num+"/"+n.num;var r=this.manorPy.calCollectTotalGoods(t)+t.collectedTime,s=this.manorPy.calSurplusGoods(t);this.pb_exp.maximum=r+s,this.pb_exp.value=s;var c=this.manorPy.calSurplusTime(t);this.pb_exp.labelFunction=function(e,t){var i=100*e/t;return 99<=i&&n.maxCollectTime>c?"99%":Math.ceil(i)+"%"},""!=t.guildName&&t.guildName?this.lb_guild_name.text="S"+t.guildServerId+"."+t.guildName:this.lb_guild_name.text="无";var l=this.lb_guild_name.width,h=this.img_name_bg.width;126<l&&(h=l+20,this.img_name_bg.width=Math.min(h,210));var p=JSON.parse(n.oneDayRewards);if(o){a=JSON.parse(n.improveRatio);for(var d in p)p[d][2]=Math.ceil(p[d][2]*(1+a[2]/1e3))}var u=p;Array.isArray(u)&&(u={rewards:u}),this.rewardNum=0;var g=[];if(G_REWARD_NAME.forEach(function(e){var t=u[e]||[];0<t.length&&t.forEach(function(e){var t={type:e.type||e[0],code:e.code||e[1],num:e.num||e[2]||1};g.push(t),++i.rewardNum})}),u.isArray&&0==this.rewardNum&&0<u.length)(u||[]).forEach(function(e){var t={type:e.type||e[0],code:e.code||e[1],num:e.num||e[2]||1};g.push(t),++i.rewardNum});var f=6<this.rewardNum?6:this.rewardNum,_=new eui.ArrayCollection(g);this.reward_1.itemRenderer=y,this.reward_1.dataProvider=_,this.sl_reward.width=84*f+10*(f-1),this.sl_reward.height=84,this.sl_reward.x=(this.gp_root.width-this.sl_reward.width)/2,this.btn_confirm.visible=this.choice}else console.log(" t_manor.json 未配置",this.vo.info.id)},e.prototype.addEvent=function(){this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){m.AppFacade.getInstance().sendNotification(CN.MANOR_CHOICE_MINI_MAP_POINT,{vo:this.vo}),this.hide(),m.AppFacade.getInstance().hideSubView(m.ManorMediator.N,m.ManorMediator.SV.MINI_MAP)},this)},e}(BasePanel);m.ManorDetailSimplePanel=e,__reflect(e.prototype,"game.ManorDetailSimplePanel");var y=function(t){function e(){var e=t.call(this)||this;return e.skinName="BaseItemRenderSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){this.baseItem_1.updateData(this.data)},e}(eui.ItemRenderer);__reflect(y.prototype,"BaseItemRender")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.proxy=o.AppFacade.getInstance().retrieveProxy(o.ManorProxy.N),t}return __extends(n,i),Object.defineProperty(n.prototype,"manorView",{get:function(){return this.getSubView(n.SV.MAIN)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"manorDetailPanel",{get:function(){return this.getSubView(n.SV.DETAIL)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"manorRecordPanel",{get:function(){return this.getSubView(n.SV.RECORD)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"manorTargetPanel",{get:function(){return this.getSubView(n.SV.TARGET)},enumerable:!0,configurable:!0}),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.ManorView),this.addSubView(n.SV.MINI_MAP,o.ManorMiniMapPanel),this.addSubView(n.SV.RECORD,o.ManorRecordPanel),this.addSubView(n.SV.DETAIL,o.ManorDetailPanel),this.addSubView(n.SV.DETAIL_SIMPLE,o.ManorDetailSimplePanel),this.addSubView(n.SV.BUY,o.ManorBuyPanel),this.addSubView(n.SV.TARGET,o.ManorTargetPanel),this.addSubView(n.SV.TARGET_BUY,o.ManorTargetBuyPanel),this.addSubView(n.SV.COLLECT,o.ManorCollectRewardPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.GENERAL_PASS_DAY,CN.GUAJI_LAYER_INFO_TIPS_UPDATE,CN.PLAYER_LEVEL_UP,CN.PLAYER_VIP_LEVEL_UP,CN.PLAYER_INFO_UPDATE,CN.ME_MOVE_FINISH,CN.ME_MOVE_ONE_TILE,CN.REWARD_CLOSE,CN.MANOR_FORCE_EXIT,CN.MANOR_ALL_PLAYER_UPDATE,CN.MANOR_ALL_MANOR_UPDATE,CN.MANOR_REQUIRE_DETAIL,CN.MANOR_DETAIL_UPDATE,CN.MANOR_RECORD_UPDATE,CN.MANOR_WALKNUM_UPDATE,CN.MANOR_BLOODNUM_UPDATE,CN.MANOR_GET_AWARD,CN.MANOR_REMOVE_ONE_MANOR,CN.MANOR_REMOVE_ONE_PLAYER,CN.MANOR_CAPTURE_SUCCESS,CN.MANOR_OPEN_MINI_MAP,CN.MANOR_CHOICE_MINI_MAP_POINT,CN.MANOR_PLAYER_PROXY_INFO_UPDATE,CN.MANOR_AUTO_CAPTURE_UPDATE,CN.MANOR_COLLECT_REWARD_SHOW,CN.MANOR_COLLECT_SETTING_UPDATE,CN.MANOR_UPDATE_RANKS]},n.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.GENERAL_PASS_DAY:break;case CN.MANOR_FORCE_EXIT:this.getSubView(n.SV.MAIN)&&o.MainJumpConfig.jumpTo();break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GUAJI_LAYER_INFO_TIPS_UPDATE:break;case CN.PLAYER_LEVEL_UP:case CN.PLAYER_VIP_LEVEL_UP:case CN.PLAYER_INFO_UPDATE:e.getName(),CN.PLAYER_LEVEL_UP,this.manorTargetPanel&&this.manorTargetPanel.updatePlayerInfo();break;case CN.MANOR_ALL_MANOR_UPDATE:this.manorView&&this.manorView.updateManorEntityInfo(t.isInit);break;case CN.MANOR_ALL_PLAYER_UPDATE:this.manorView&&this.manorView.updatePlayerEntityInfo(t.isInit);break;case CN.MANOR_REQUIRE_DETAIL:this.manorDetailPanel&&this.manorDetailPanel.requireDetail();break;case CN.MANOR_DETAIL_UPDATE:this.manorDetailPanel&&this.manorDetailPanel.updateView();break;case CN.MANOR_RECORD_UPDATE:this.manorRecordPanel&&this.manorRecordPanel.updateView();break;case CN.MANOR_WALKNUM_UPDATE:break;case CN.MANOR_BLOODNUM_UPDATE:this.manorView&&this.manorView.updateBloodNum();break;case CN.MANOR_GET_AWARD:this.manorView&&this.manorView.showRewardView(t);break;case CN.MANOR_REMOVE_ONE_MANOR:this.manorView&&this.manorView.removeManorEntity(t.data),this.manorDetailPanel&&this.manorDetailPanel.removeManorEntity(t.data);break;case CN.MANOR_REMOVE_ONE_PLAYER:this.manorView&&this.manorView.removePlayerEntity(t.data);break;case CN.ME_MOVE_FINISH:this.manorView&&this.manorView.onMeMoveFinish();break;case CN.ME_MOVE_ONE_TILE:case CN.FIGHT_RESULT_CLOSE:break;case CN.MANOR_CAPTURE_SUCCESS:this.manorView&&this.manorView.playSuccessEffect();break;case CN.MANOR_OPEN_MINI_MAP:this.manorView&&this.manorView.openMiniMap(t);break;case CN.MANOR_CHOICE_MINI_MAP_POINT:break;case CN.MANOR_PLAYER_PROXY_INFO_UPDATE:this.manorView&&this.manorView.updatePlayerProxyInfo();break;case CN.MANOR_AUTO_CAPTURE_UPDATE:this.manorTargetPanel&&this.manorTargetPanel.updateAutoCapture(t.reason);break;case CN.MANOR_COLLECT_REWARD_SHOW:o.AppFacade.getInstance().showSubView(o.ManorMediator.N,o.ManorMediator.SV.COLLECT,t);break;case CN.MANOR_COLLECT_SETTING_UPDATE:this.manorTargetPanel&&(1==t.type?this.manorTargetPanel.totalWalkDiamond=t.value:2==t.type?this.manorTargetPanel.totalBloodDiamond=t.value:3==t.type&&(this.manorTargetPanel.resurgenceNum=t.value),this.manorTargetPanel.sendAutoCapture(null,null,!0),"reset"==t.action?Utils.MsgUtils.addMidMsg("重置成功"):"update"==t.action&&Utils.MsgUtils.addMidMsg("更新设定成功"));break;case CN.MANOR_UPDATE_RANKS:this.manorView&&this.manorView.updateRank()}},n.prototype.onViewCreate=function(){this.sendNotification(CN.CITY_SWITCH_DBCLOCKPAUSE,!0),this.sendNotification(CN.GUAJI_HIDE_ALL_SUBVIEW)},n.N="ManorMediator",n.SV={MAIN:1,MINI_MAP:2,RECORD:3,DETAIL:4,DETAIL_SIMPLE:5,BUY:6,TARGET:7,TARGET_BUY:8,COLLECT:9},n}(BaseMediator);o.ManorMediator=e,__reflect(e.prototype,"game.ManorMediator")}(game||(game={})),function(m){var e=function(i){function e(e){var t=i.call(this)||this;return t.guajiPy=m.AppFacade.getInstance().retrieveProxy(m.GuajiPy.N),t.manorPy=m.AppFacade.getInstance().retrieveProxy(m.ManorProxy.N),t.tileIndex2MNM={},t.tileIndex2MNMEP={},t.skinName="ManorMiniMapSkin",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.lb_mapName.text="地 图",this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.gp_tile=new eui.Group,this.gp_tile.horizontalCenter=this.gp_tile.verticalCenter=0,this.gp_tile.scaleX=this.gp_tile.scaleY=1.2,this.gp_adapter=new eui.Group,this.gp_adapter.addChild(this.gp_tile),this.gp_viewport.addChild(this.gp_adapter)},e.prototype.updateView=function(e){var n=this;e&&(this.mwArr=e.mwArr,this.tileX=e.tileX,this.tileY=e.tileY,this.choice=e.choice);var t=m.Config.manorLayer()[1];this.lb_mapName.text="矿 区",this.w=t.long,this.h=t.wide,RES.getResAsync(t.tiled,function(e){try{e.layers.forEach(function(e){"tiled"==e.name?n.tmxTiledArr=e.data:"hinder"==e.name&&(n.tmxHinderArr=e.data)}),n.tilesets={},e.tilesets.forEach(function(i){i.tiles.forEach(function(t){t.properties.forEach(function(e){n.tilesets[t.id+i.firstgid]||(n.tilesets[t.id+i.firstgid]={}),n.tilesets[t.id+i.firstgid][e.name]=e.value})})})}catch(e){return void egret.warn("地形解析失败",e)}n.initAll()},this)},e.prototype.getTileIndex=function(e,t){return e+t*this.w},e.prototype.tile2MNMPos=function(e,t){return this.jiZhunMNMP||(this.jiZhunMNMP=egret.Point.create(0,this.scl_map.height/2)),egret.Point.create(this.jiZhunMNMP.x+67*(e+(this.h-1)-t)/2,this.jiZhunMNMP.y+37*(e+t-(this.h-1))/2)},e.prototype.initAll=function(){var u=this;this.gp_tile.removeChildren();var e=void 0,t=void 0,i=void 0,n=void 0,o=new egret.Shape;o.graphics.lineStyle(3,0);for(var a=0;a<this.w;a++)for(var r=0;r<this.h;r++){var s=this.getTileIndex(a,r),c=this.tmxTiledArr[s];if(null==c){egret.warn("地图尺寸"+this.w+"x"+this.h+"超过地形尺寸，请检查配置");break}if(0!=c&&0!=this.mwArr[s]){var l=this.tmxHinderArr[s],h=new eui.Image("_guaji_m_json.mx_img_sekuai"+(0==l?2:1)),p=this.tile2MNMPos(a,r);h.x=p.x,h.y=p.y,(null==e||p.x<e)&&(e=p.x),(null==t||p.x>t)&&(t=p.x),(null==i||p.y<i)&&(i=p.y),(null==n||p.y>n)&&(n=p.y),this.tileIndex2MNM[s]=h,this.gp_tile.addChild(h),egret.Point.release(p)}}for(var d in o.graphics.endFill(),this.tileIndex2MNM){var g=this.tileIndex2MNM[d];g.x-=e,g.y-=i}o.x-=e,o.y-=i,this.gp_tile.addChild(o);var f=[];this.manorPy.manorList.forEach(function(e){f.push(new m.EventVO({config:void 0,customTrigger:void 0,eventId:void 0,fadeType:void 0,hudongAction:void 0,info:'{ "captured":false, "id":'+e.id+', "manorId":'+e.manorId+"}",isDirty:!0,isExpire:!1,isInited:!0,position:{id:null,isDirty:!0,layerId:null,num:null,type:null,x:e.coordinateInfo.x,y:e.coordinateInfo.y},type:RiskEventType.Manor}))}),f.forEach(function(e){var t=u.getTileIndex(e.position.x,e.position.y);if(u.tileIndex2MNM[t]){var i=new eui.Image;i.scaleX=i.scaleY=1.4;var n=m.Config.manor()[e.info.id],o=MAP_EP_TYPE_IMG_MNM[e.type];e.type==RiskEventType.Manor&&(o=m.GeneralConfig.getGuajiImg(n.model)[1],i.scaleX=i.scaleY=.5),RES.getResAsync(o,function(e){i.source=e,i.anchorOffsetX=e.textureWidth/2,i.anchorOffsetY=e.textureHeight},u),i.x=u.tileIndex2MNM[t].x+32.5,i.y=u.tileIndex2MNM[t].y+17.5,e.type==RiskEventType.Manor&&(i.y=u.tileIndex2MNM[t].y+35),u.tileIndex2MNMEP[t]=i,u.gp_tile.addChild(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){m.AppFacade.getInstance().showSubView(m.ManorMediator.N,m.ManorMediator.SV.DETAIL_SIMPLE,{vo:e,choice:this.choice})},u);var a=new eui.Group;a.touchEnabled=!1,a.width=40,a.height=20;var r=new eui.Image;r.source="_guaji_m_json.mx_img_mingchengdi",r.horizontalCenter=0,r.verticalCenter=0,r.scaleX=r.scaleY=.8,a.addChild(r);var s=new eui.Image;s.source="item_icon_renshu_png",s.horizontalCenter=-30,s.verticalCenter=0,s.scaleX=s.scaleY=.3,a.addChild(s);var c=new eui.Label;c.size=12,c.horizontalCenter=0,c.verticalCenter=0,a.addChild(c);var l=new eui.Image;l.source="common_img_biaotidi2_png",l.horizontalCenter=0,l.verticalCenter=-76,l.scaleX=.35,l.scaleY=.4,a.addChild(l);var h=new eui.BitmapLabel;h.font="common_title_fnt",h.horizontalCenter=0,h.verticalCenter=-75,h.scaleX=h.scaleY=.5,a.addChild(h),a.x=u.tileIndex2MNM[t].x+32.5,a.y=u.tileIndex2MNM[t].y+17.5,e.type==RiskEventType.Manor&&(a.x=u.tileIndex2MNM[t].x+32.5-a.width/2,a.y=u.tileIndex2MNM[t].y+35),u.gp_tile.addChild(a);var p=u.manorPy.queryManoeEntityByManorId(e.info.manorId);c.text=p.num+"/"+n.num,h.text=""+n.name;var d=new eui.Image;d.source="mxkc_img_chaoji_png",d.horizontalCenter=30,d.bottom=50,d.scaleX=d.scaleY=.4,a.addChild(d),d.visible=p.isSpecial}}),this.img_meRedPointInMNM=new eui.Image,this.img_meRedPointInMNM.scaleX=this.img_meRedPointInMNM.scaleY=1.4,RES.getResAsync("_guaji_m_json.maoxian_icon_ziji",function(e){u.img_meRedPointInMNM.source=e,u.img_meRedPointInMNM.anchorOffsetX=e.textureWidth/2,u.img_meRedPointInMNM.anchorOffsetY=e.textureHeight},this),this.gp_tile.addChildAt(this.img_meRedPointInMNM,-1);var _=this.getTileIndex(this.tileX,this.tileY);this.tileIndex2MNM[_]&&(this.img_meRedPointInMNM.x=this.tileIndex2MNM[_].x+32.5,this.img_meRedPointInMNM.y=this.tileIndex2MNM[_].y+17.5),this.scl_map.alpha=0,egret.setTimeout(function(){u.resizeAdapter(),u.resetMNM(0),egret.Tween.get(u.scl_map).to({alpha:1},200)},this,100)},e.prototype.resizeAdapter=function(){this.gp_tile.height*this.gp_tile.scaleY<this.scl_map.height&&(this.gp_adapter.height=this.scl_map.height+1),this.gp_tile.width*this.gp_tile.scaleX<this.scl_map.width&&(this.gp_adapter.width=this.scl_map.width+1),this.gp_adapter.validateNow()},e.prototype.resetMNM=function(e){if(void 0===e&&(e=250),this.img_meRedPointInMNM){var t=this.img_meRedPointInMNM.localToGlobal(this.img_meRedPointInMNM.anchorOffsetX,this.img_meRedPointInMNM.anchorOffsetY),i=this.scl_map.viewport.globalToLocal(t.x,t.y);egret.Tween.get(this.scl_map.viewport).to({scrollH:i.x-this.scl_map.viewport.width/2,scrollV:i.y-this.scl_map.viewport.height/2},e)}},e}(BasePanel);m.ManorMiniMapPanel=e,__reflect(e.prototype,"game.ManorMiniMapPanel")}(game||(game={})),function(n){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new i).register(),(new o).register(),(new a).register(),(new r).register(),(new s).register()},e}();n.ManorProcessor=e,__reflect(e.prototype,"game.ManorProcessor");var t=function(e){function t(){return e.call(this,"manor.ManorInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();n.AppFacade.getInstance().retrieveProxy(n.ManorProxy.N).updateAllPlayerManorEntityInfo(t.info)},t}(n.ProcessorBase);__reflect(t.prototype,"ManorInfoP");var i=function(e){function t(){return e.call(this,"manor.PlayerEntityListP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody(),i=n.AppFacade.getInstance().retrieveProxy(n.ManorProxy.N);t.entityIndex&&t.entityIndex!=i.lastEntityIndex||i.updateAllPlayerEntityInfo(t.playerEntityList)},t}(n.ProcessorBase);__reflect(i.prototype,"PlayerEntityListP");var o=function(e){function t(){return e.call(this,"manor.ManorEntityListP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();n.AppFacade.getInstance().retrieveProxy(n.ManorProxy.N).updateAllManorEntityInfo(t.manorEntityList),this.sendNotification(CN.MANOR_REQUIRE_DETAIL)},t}(n.ProcessorBase);__reflect(o.prototype,"ManorEntityListP");var a=function(e){function t(){return e.call(this,"manor.BattleRecordEntityInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();t.info.attackEntity.baseInfo.playerId==n.GameMVC.playerPy.playerInfoVO.playerId&&n.AppFacade.getInstance().retrieveMediator(n.CommonMediator.N).pushBattleRecord(t.info)},t}(n.ProcessorBase);__reflect(a.prototype,"BattleRecordEntityInfoP");var r=function(e){function t(){return e.call(this,"manor.PlayerProxyInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();n.AppFacade.getInstance().retrieveProxy(n.ManorProxy.N).updatePlayerProxyInfo(t.playerProxyInfo)},t}(n.ProcessorBase);__reflect(r.prototype,"PlayerProxyInfoP");var s=function(e){function t(){return e.call(this,"manor.AutoCaptureInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody(),i=n.AppFacade.getInstance().retrieveProxy(n.ManorProxy.N);t.playerEntityInfo&&t.playerEntityInfo.baseInfo&&i.updatePlayerInfo(t.playerEntityInfo)},t}(n.ProcessorBase);__reflect(s.prototype,"AutoCaptureInfoP")}(game||(game={})),function(L){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.lastEntityIndex=1,e.playerProxyInfo=new L.PlayerProxyInfo,e.selfEntity=new L.PlayerEntityInfo,e.playerList=new Array,e.manorList=new Array,e.recordList=new Array,e.isShowRedPoint=!1,NoticeManager.setChildType(NT.CITY_PVP_ENTRANCE,NT.MANOR_ENTRANCE),NoticeManager.registerCB(NT.MANOR_ENTRANCE,e.checkEntranceNotice,e,MODULE.Manor),e}return __extends(i,t),i.prototype.checkEntranceNotice=function(){return this.isShowRedPoint&&Utils.UnlockMgr.checkPass(MODULE.Arena,!1).allow},i.prototype.reset=function(){this.playerList.splice(0),this.manorList.splice(0)},i.prototype.updatePlayerProxyInfo=function(e){if(e){var t=this.queryPlayerProxyInfoByEntityId(e.lastEntityIndex);if(t){for(var i=void 0,n=0,o=e.playerEntityList;n<o.length;n++){var a=o[n];a.entityIndex==e.lastEntityIndex&&(i=a)}i&&0!=i.manorId&&t.manorId!=i.manorId&&L.AppFacade.getInstance().sendNotification(CN.MANOR_CAPTURE_SUCCESS,{manorId:i.manorId})}this.lastEntityIndex=e.lastEntityIndex,this.playerProxyInfo.update(e);var r=this.queryPlayerProxyInfoByEntityId(e.lastEntityIndex);this.selfEntity?this.selfEntity.update(r):this.selfEntity=new L.PlayerEntityInfo(r),this.checkRedPointState(e),this.checkCollectReward(e,null)}this.sendNotification(CN.MANOR_PLAYER_PROXY_INFO_UPDATE)},i.prototype.updateAllPlayerManorEntityInfo=function(e,t){e.manorEntityList&&this.updateAllManorEntityInfo(e.manorEntityList,t),e.playerEntityList&&this.updateAllPlayerEntityInfo(e.playerEntityList,t)},i.prototype.updateAllManorEntityInfo=function(e,t){if(e){for(var i=this.manorList.length-1;0<=i;i--){var n=!1;for(var o in e)if(e[o].manorId==this.manorList[i].manorId){n=!0;break}n||(this.manorList[i].remove=!0)}for(var o in e){for(n=!1,i=0;i<this.manorList.length;i++)if(e[o].manorId==this.manorList[i].manorId){this.manorList[i].update(e[o]),n=!0;break}n||this.manorList.push(new L.ManorEntityInfo(e[o]))}}this.sendNotification(CN.MANOR_ALL_MANOR_UPDATE,{isInit:t})},i.prototype.updateAllPlayerEntityInfo=function(e,t){for(var i in e)if(e[i].baseInfo){for(var n=!1,o=0;o<this.playerList.length;o++)if(e[i].baseInfo.playerId==this.playerList[o].baseInfo.playerId&&e[i].entityIndex==this.playerList[o].entityIndex){this.playerList[o].update(e[i]),n=!0;break}n||this.playerList.push(new L.PlayerEntityInfo(e[i])),this.selfEntity&&L.GameMVC.loginPy.isSelf(e[i].baseInfo.playerId)&&e[i].entityIndex==this.lastEntityIndex&&(this.selfEntity.rewards=e[i].rewards)}else console.log(" 服务器下推 PlayerEntityInfo 数据中 baseInfo 错误!");this.checkCollectReward(null,e),this.sendNotification(CN.MANOR_ALL_PLAYER_UPDATE,{isInit:t}),this.sendNotification(CN.MANOR_BLOODNUM_UPDATE)},i.prototype.checkCollectReward=function(e,t){var i=Array(),n=Array(),o=Array();if(e&&e.playerEntityList)for(var a in e.playerEntityList)e.playerEntityList[a].coordinateStatus==ManorPlayerCoordinateChangeType.Battle?i.push(e.playerEntityList[a]):e.playerEntityList[a].coordinateStatus==ManorPlayerCoordinateChangeType.ManorDisapper?n.push(e.playerEntityList[a]):e.playerEntityList[a].coordinateStatus==ManorPlayerCoordinateChangeType.NoHero&&o.push(e.playerEntityList[a]);if(t)for(var a in t)t[a].baseInfo&&L.GameMVC.loginPy.isSelf(t[a].baseInfo.playerId)&&t[a].coordinateStatus&&(t[a].coordinateStatus==ManorPlayerCoordinateChangeType.Battle?i.push(t[a]):t[a].coordinateStatus==ManorPlayerCoordinateChangeType.ManorDisapper?n.push(t[a]):t[a].coordinateStatus==ManorPlayerCoordinateChangeType.NoHero&&o.push(t[a]));if(0<i.length||0<n.length||0<o.length){var r=Array(),s=new Array,c=Array();for(var a in i)if(0<this.calcRewrdNum(i[a].rewards)){r[i[a].entityIndex]=!0,s.push({text:"由于",style:{textColor:4003586,size:22}}),s.push({text:"体力归0",style:{textColor:9767986,size:22}}),s.push({text:",",style:{textColor:4003586,size:22}}),s.push({text:"队伍"+i[a].entityIndex,style:{textColor:944654,size:22}}),s.push({text:"已被送回安全区，采集获得以下资源",style:{textColor:4003586,size:22}}),s.push({text:"\n",style:{textColor:4003586,size:22}});for(var l=0,h=i[a].rewards;l<h.length;l++){var p=h[l],d=!1;for(var u in c)if(p.type==c[u].type&&p.code==c[u].code){c[u].num+=p.num,d=!0;break}d||c.push(p)}}for(var a in n)if(0<this.calcRewrdNum(n[a].rewards)){r[n[a].entityIndex]=!0,s.push({text:"由于",style:{textColor:4003586,size:22}}),s.push({text:"矿被采空",style:{textColor:9767986,size:22}}),s.push({text:",",style:{textColor:4003586,size:22}}),s.push({text:"队伍"+n[a].entityIndex,style:{textColor:944654,size:22}}),s.push({text:"已被送回安全区，采集获得以下资源",style:{textColor:4003586,size:22}}),s.push({text:"\n",style:{textColor:4003586,size:22}});for(var g=0,f=n[a].rewards;g<f.length;g++){p=f[g],d=!1;for(var u in c)if(p.type==c[u].type&&p.code==c[u].code){c[u].num+=p.num,d=!0;break}d||c.push(p)}}for(var a in o)if(0<this.calcRewrdNum(o[a].rewards)){r[o[a].entityIndex]=!0,s.push({text:"由于",style:{textColor:4003586,size:22}}),s.push({text:"队伍状态改变",style:{textColor:9767986,size:22}}),s.push({text:",",style:{textColor:4003586,size:22}}),s.push({text:"队伍"+o[a].entityIndex,style:{textColor:944654,size:22}}),s.push({text:"已被送回安全区，采集获得以下资源",style:{textColor:4003586,size:22}}),s.push({text:"\n",style:{textColor:4003586,size:22}});for(var _=0,m=o[a].rewards;_<m.length;_++){p=m[_],d=!1;for(var u in c)if(p.type==c[u].type&&p.code==c[u].code){c[u].num+=p.num,d=!0;break}d||c.push(p)}}0<s.length&&this.sendNotification(CN.MANOR_COLLECT_REWARD_SHOW,{textFlow:s,rewards:c,entityList:r})}},i.prototype.calcRewrdNum=function(e){var i=e;Array.isArray(i)&&(i={rewards:i});var n=0;return G_REWARD_NAME.forEach(function(e){var t=i[e]||[];n+=t.length}),n},i.prototype.checkRedPointState=function(e){var t=this.isShowRedPoint;this.isShowRedPoint=!1;for(var i=0,n=e.playerEntityList;i<n.length;i++){var o=n[i];if(0==o.manorId){this.isShowRedPoint=!0;break}if(Utils.TimerManager.getServerTime()-o.captureDt>Number(L.Config.constConfig().ManorRedPointHintCycle.constValue)){this.isShowRedPoint=!0;break}}t!=this.isShowRedPoint&&NoticeManager.updateNotice(NT.MANOR_ENTRANCE)},i.prototype.updatePlayerInfo=function(e){var t=e.baseInfo.playerId,i=!1;for(var n in this.playerList)if(this.playerList[n].baseInfo.playerId==t&&this.playerList[n].entityIndex==e.entityIndex){this.playerList[n].update(e),i=!0;break}i||this.playerList.push(new L.PlayerEntityInfo(e)),this.selfEntity&&L.GameMVC.loginPy.isSelf(e.baseInfo.playerId)&&e.entityIndex==this.lastEntityIndex&&(this.selfEntity.rewards=e.rewards),this.sendNotification(CN.MANOR_BLOODNUM_UPDATE)},i.prototype.updateManorInfo=function(e){var t=e.manorId,i=!1;for(var n in this.manorList)if(this.manorList[n].manorId==t){this.manorList[n].update(e),i=!0;break}i||this.manorList.push(new L.ManorEntityInfo(e))},i.prototype.updateBattleRecordInfo=function(e){var t=this;e.battleRecordEntityList&&(this.recordList.splice(0),Array.isArray(e.battleRecordEntityList)&&e.battleRecordEntityList.forEach(function(e){t.recordList.push(new L.BattleRecordEntityInfo(e))})),this.sendNotification(CN.MANOR_RECORD_UPDATE)},i.prototype.queryManoeEntityByManorId=function(e){var t=void 0;for(var i in this.manorList)if(this.manorList[i].manorId==e){t=this.manorList[i];break}return t},i.prototype.queryPlayerEntityByPlayerId=function(e,t){void 0===t&&(t=this.lastEntityIndex);var i=void 0;for(var n in this.playerList)if(this.playerList[n].baseInfo.playerId==e&&this.playerList[n].entityIndex==t){i=this.playerList[n];break}return i},i.prototype.queryPlayerProxyInfoByEntityId=function(e){void 0===e&&(e=this.lastEntityIndex);for(var t=0,i=this.playerProxyInfo.playerEntityList;t<i.length;t++){var n=i[t];if(n.entityIndex==e)return n}return null},i.prototype.inSafeArea=function(e,t){var i=!1,n=JSON.parse(L.Config.constConfig().ManorBirthPlace.constValue);for(var o in n){var a=n[o];if(e>=a[0]&&e<a[0]+a[2]&&t>=a[1]&&t<a[1]+a[2]){i=!0;break}}return i},i.prototype.isMoveInSafeArea=function(e,t,i,n){var o=this.inSafeArea(e,t),a=this.inSafeArea(i,n);return!(!o||!a)},i.prototype.caleSafeAreaWalk=function(e){var t=0;for(var i in e)this.inSafeArea(e[i].y,e[i].x)&&(t+=1);return t},i.prototype.getTeamsByEntityIndex=function(e,t){for(var i in e)if(e[i].teamNo==t)return e[i];return null},i.prototype.checkFormation=function(e){var t=L.GameMVC.backpackPy.getModuleTeam(MODULE.Manor),i=new Array,n=new Array,o=this.playerProxyInfo.playerEntityList;for(var a in o){var r=o[a],s=r.entityIndex,c=r.coordinateInfo,l=!1;if(this.inSafeArea(c.x,c.y))n.push(s);else{var h=void 0;for(var p in t.teams){if((g=t.teams[p]).teamNo==s){Number(p),h=g;break}}var d=void 0,u=void 0;for(var p in e){var g;if((g=e[p]).teamNo==s){d=Number(p),u=g;break}}if(h||((h={heros:[],magicalUuid:"",petUuid:""}).teamNo=u.teamNo),h.magicalUuid!=u.magicalUuid)l=!0;else if(h.petUuid!=u.petUuid)l=!0;else if(h.heros.length!=u.heros.length)l=!0;else for(var f=0,_=h.heros;f<_.length;f++){for(var m=_[f],y=!1,v=0,T=u.heros;v<T.length;v++){var C=T[v];if(m.uuid==C.uuid){y=!0;break}}if(!y){l=!0;break}}l&&(e[d]=h,i.push(s))}}var E=new Array;if(0<i.length)for(var b=0,I=i;b<I.length;b++){var A=I[b];if(w=this.getTeamsByEntityIndex(t.teams,A))for(var P=0,S=w.heros;P<S.length;P++){C=S[P];E.push(C.uuid)}}for(var N=0,M=n;N<M.length;N++){var w;A=M[N];if(w=this.getTeamsByEntityIndex(e,A))e:for(var k=0,R=w.heros;k<R.length;k++){m=R[k];for(var U=0,x=E;U<x.length;U++){C=x[U];if(m.uuid==C){for(var a in e)if(e[a].teamNo==A){e[a]=this.getTeamsByEntityIndex(t.teams,A);break}break e}}}}if(0<i.length){var O="";for(var a in i)O=Number(a)!=i.length-1?O+"队伍"+i[a]+"、":O+"队伍"+i[a];O+="不在安全区,未保存成功!",Utils.MsgUtils.addMidMsg(O)}else 0<n.length&&Utils.MsgUtils.addMidMsg("保存成功!");return e},i.prototype.updateRank=function(e){this.ranks=e,this.sendNotification(CN.MANOR_UPDATE_RANKS)},i.prototype.calManorTotalGoods=function(e){var t=0,i=L.Config.manor()[e.id];if(i){var n=JSON.parse(i.goods)[0],o=e.num;0==o&&(o=1),t=n[2]*(i.maxCollectTime/o/i.collectCycle)}return t},i.prototype.calCollectGoods=function(e,t){var i=0;if(!t){var n=this.queryManoeEntityByManorId(e.manorId);n&&(t=n.id)}if(t){var o=L.Config.manor()[t];if(o){var a=Utils.TimerManager.getServerTime();i=Math.floor((a-e.captureDt)/o.collectCycle)}}return i},i.prototype.calCollectTotalGoods=function(e){var t=0,i=L.Config.manor()[e.id];if(i){var n=Utils.TimerManager.getServerTime();for(var o in e.playerManorList)t+=Math.floor((n-e.playerManorList[o].captureDt)/i.collectCycle)}return t},i.prototype.calSurplusGoods=function(e){var t=0,i=L.Config.manor()[e.id];return i&&(t=i.maxCollectTime-e.collectedTime-this.calCollectTotalGoods(e)),t},i.prototype.calCollectTotalTime=function(e){var t=0;if(L.Config.manor()[e.id]){var i=Utils.TimerManager.getServerTime();for(var n in e.playerManorList)t+=Math.floor(i-e.playerManorList[n].captureDt)}return t},i.prototype.calSurplusTime=function(e){var t=0,i=L.Config.manor()[e.id];return i&&(t=i.maxCollectTime-e.collectedTime-this.calCollectTotalTime(e)),t},i.prototype.GetManorInfo=function(t){var i=this;void 0===t&&(t=!1),Utils.UnlockMgr.checkPass(MODULE.Manor,!1).allow?Utils.Socket.send("manor","GetManorInfo",{},!0).then(function(e){i.EnterIntoModule(),i.updatePlayerProxyInfo(e.playerProxyInfo),i.updateAllManorEntityInfo(e.manorEntityList,!0)}).catch(function(e){e&&e.err&&(t||(10623==e.err?Utils.MsgUtils.addMidMsg("该功能紧急维护，暂时未开启"):10046==e.err?Utils.MsgUtils.addMidMsg("活动暂未开启"):Utils.MsgUtils.addMidMsg(e.err)),i.sendNotification(CN.MANOR_FORCE_EXIT))}):console.log("活动未开启, 中断请求 GetManorInfo")},i.prototype.GetPlayerManorInfo=function(t,e,i){var n=this;void 0===t&&(t=!1),void 0===e&&(e=this.lastEntityIndex),void 0===i&&(i=!1),Utils.UnlockMgr.checkPass(MODULE.Manor,!1).allow?Utils.Socket.send("manor","GetPlayerManorInfo",{isSelf:t,entityIndex:e},!0).then(function(e){t?n.updatePlayerProxyInfo(e.playerProxyInfo):n.updateAllPlayerEntityInfo(e.playerEntityList,i)}).catch(function(e){e&&e.err&&(10046==e.err||Utils.MsgUtils.addErrMsg(e.err))}):console.log("活动未开启, 中断请求 GetPlayerManorInfo")},i.prototype.Walk=function(e,t,i,n,o){var a=this;void 0===n&&(n=0),void 0===o&&(o=this.lastEntityIndex),Utils.Socket.send("manor","Walk",{originalInfo:e,info:t,walkNum:i,safeAreaWalkNum:n,entityIndex:o}).then(function(e){a.updateAllPlayerEntityInfo(e.playerEntityList),a.updatePlayerProxyInfo(e.playerProxyInfo)}).catch(function(e){})},i.prototype.Capture=function(t,e,i,n){var o=this;Utils.Socket.send("manor","Capture",{manorId:t,tPlayerId:e,entityIndex:i,tEntityIndex:n}).then(function(e){o.GetManorDetailInfo(t),o.GetPlayerManorInfo(!0,o.lastEntityIndex),o.GetPlayerManorInfo(!1)}).catch(function(e){})},i.prototype.LeaveManor=function(t){var i=this;Utils.Socket.send("manor","LeaveManor",{entityIndex:t}).then(function(e){i.updateAllPlayerEntityInfo(e.playerEntityList),i.GetPlayerManorInfo(!0,i.lastEntityIndex),i.AccountRewards(t)}).catch(function(e){})},i.prototype.GetBattleRecordInfo=function(){var t=this;Utils.Socket.send("manor","GetBattleRecordInfo",{}).then(function(e){t.updateBattleRecordInfo(e)}).catch(function(e){})},i.prototype.PurchaseBlood=function(e,t){var i=this;void 0===t&&(t=this.lastEntityIndex),Utils.Socket.send("manor","PurchaseBlood",{num:e,entityIndex:t}).then(function(e){i.updatePlayerInfo(e.playerEntityInfo),i.GetPlayerManorInfo()}).catch(function(e){})},i.prototype.AccountRewards=function(e){var t=this;void 0===e&&(e=this.lastEntityIndex),Utils.Socket.send("manor","AccountRewards",{entityIndex:e}).then(function(e){t.sendNotification(CN.MANOR_GET_AWARD,{clientReward:e.clientReward}),t.updatePlayerInfo(e.playerEntityInfo),t.sendNotification(CN.MANOR_ALL_MANOR_UPDATE,{isInit:!1})}).catch(function(e){})},i.prototype.GetManorDetailInfo=function(e){var t=this;Utils.Socket.send("manor","GetManorDetailInfo",{manorId:e}).then(function(e){t.updateManorInfo(e.info),t.sendNotification(CN.MANOR_DETAIL_UPDATE),t.sendNotification(CN.MANOR_ALL_MANOR_UPDATE,{isInit:!1})}).catch(function(e){})},i.prototype.EnterIntoModule=function(){Utils.Socket.send("manor","EnterIntoModule",{}).then(function(e){}).catch(function(e){})},i.prototype.LeaveModule=function(){Utils.Socket.send("manor","LeaveModule",{}).then(function(e){}).catch(function(e){})},i.prototype.AutoCapture=function(e,t,i){var n=this;void 0===i&&(i=""),Utils.Socket.send("manor","AutoCapture",{entityIndex:e,autoCaptureInfo:t}).then(function(e){n.updatePlayerProxyInfo(e.playerProxyInfo),n.sendNotification(CN.MANOR_GET_AWARD,{clientReward:e.clientReward}),n.sendNotification(CN.MANOR_AUTO_CAPTURE_UPDATE,{reason:i})}).catch(function(e){})},i.prototype.GetManorRank=function(){var t=this;Utils.Socket.send("ranking","GetCommonRank",{rankType:RankingType.RankingTypeManorPlayer,rankSubType:RankingSubType.Three}).then(function(e){t.updateRank(e)}).catch(function(e){})},i.prototype.startTimer=function(e,t){this.timer||(this.timer=new egret.Timer(1e3)),this.stopTimer(),this.timer.delay=e||1e3,this.timer.repeatCount=t||0,this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this.timer.reset(),this.timer.start(),this.timerFunc()},i.prototype.stopTimer=function(){this.timer&&(this.timer.stop(),this.timerComFunc())},i.prototype.timerFunc=function(){this.GetPlayerManorInfo(!0,0)},i.prototype.timerComFunc=function(){this.timer&&(this.timer.removeEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this))},i.N="ManorProxy",i}(BaseProxy);L.ManorProxy=e,__reflect(e.prototype,"game.ManorProxy")}(game||(game={})),function(h){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ManorRecordPanel",e.manorPy=h.AppFacade.getInstance().retrieveProxy(h.ManorProxy.N),e.curIdx=1,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initScroll(),this.addEvent(),this.onClickPage(this.curIdx)},e.prototype.initScroll=function(){this.list_item.itemRenderer=i,UIActionManager.hideScrollerBar(this.scl_list)},e.prototype.updateView=function(e){this.onClickPage(this.curIdx)},e.prototype.updateRecordList=function(t){this.scl_list.stopAnimation(),this.scl_list.viewport.scrollV=0;var e=this.manorPy.recordList,i=[];e.forEach(function(e){(h.GameMVC.loginPy.isSelf(e.attackEntity.baseInfo.playerId)&&e.attackEntity.entityIndex==t||h.GameMVC.loginPy.isSelf(e.defenceEntity.baseInfo.playerId)&&e.defenceEntity.entityIndex==t)&&i.push(e)}),i.sort(function(e,t){return e.dt==t.dt?e.attackEntity.blood-t.attackEntity.blood:t.dt-e.dt}),this.list_item.dataProvider=new eui.ArrayCollection(i)},e.prototype.onClickPage=function(e){this.curIdx=e,this.img_bg_normal1.visible=1!=e,this.img_zi_normal1.visible=1!=e,this.img_bg_select1.visible=1==e,this.img_zi_select1.visible=1==e,this.img_bg_normal2.visible=2!=e,this.img_zi_normal2.visible=2!=e,this.img_bg_select2.visible=2==e,this.img_zi_select2.visible=2==e,this.img_bg_normal3.visible=3!=e,this.img_zi_normal3.visible=3!=e,this.img_bg_select3.visible=3==e,this.img_zi_select3.visible=3==e,this.updateRecordList(e)},e.prototype.addEvent=function(){var t=this;this.gp_btn1.touchEnabled=!0,this.gp_btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.onClickPage(1)},this),this.gp_btn2.touchEnabled=!0,this.gp_btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.onClickPage(2)},this),this.gp_btn3.touchEnabled=!0,this.gp_btn3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.onClickPage(3)},this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this)},e}(BasePanel);h.ManorRecordPanel=e,__reflect(e.prototype,"game.ManorRecordPanel");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="ManorRecordPanel_Item",e.fightPy=h.AppFacade.getInstance().retrieveProxy(h.FightPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.fightPy.BattlePlayBack(e.data.uuid)},this),this.playerHead_l.addTapEvent(function(){e.leftData&&e.leftData.baseInfo&&e.leftData.baseInfo.playerId&&h.AppFacade.getInstance().showSubView(h.FriendMediator.N,h.FriendMediator.SV.INFO,{playerId:e.leftData.baseInfo.playerId,moduleId:MODULE.Manor,entityIndex:e.leftData.entityIndex}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)}),this.playerHead_r.addTapEvent(function(){e.rightData&&e.rightData.baseInfo&&e.rightData.baseInfo.playerId&&h.AppFacade.getInstance().showSubView(h.FriendMediator.N,h.FriendMediator.SV.INFO,{playerId:e.rightData.baseInfo.playerId,moduleId:MODULE.Manor,entityIndex:e.rightData.entityIndex}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)})},e.prototype.dataChanged=function(){var e=this.data.attackEntity,t=this.data.defenceEntity,i=this.data.dt,n=(this.data.uuid,this.data.win),o=!0;if(this.leftData=e,this.rightData=t,h.GameMVC.loginPy.isSelf(t.baseInfo.playerId)&&(this.leftData=t,this.rightData=e,o=!1),this.leftData){this.leftData.baseInfo.playerId,this.leftData.baseInfo.avatar;var a=this.leftData.baseInfo.fightCap,r=this.leftData.baseInfo.name,s=this.leftData.blood,c=this.leftData.decreaseBlood;this.lb_name_l.text=r,this.item_fightCap_l.update(a),this.lb_lost_blood_l.text="损失"+c+"点体力",this.playerHead_l.updateData({vo:this.leftData.baseInfo,ignoreLevel:1,effect:!1}),this.pb_blood_l.maximum=100,this.pb_blood_l.value=s}if(this.rightData){this.rightData.baseInfo.avatar,a=this.rightData.baseInfo.fightCap;var l=this.rightData.baseInfo.name;s=this.rightData.blood,c=this.rightData.decreaseBlood;this.lb_name_r.text=l,this.item_fightCap_r.update(a),this.lb_lost_blood_r.text="损失"+c+"点体力",this.playerHead_r.updateData({vo:this.rightData.baseInfo,ignoreLevel:1,effect:!1}),this.pb_blood_r.maximum=100,this.pb_blood_r.value=s}o?(this.lb_result.textColor=15214370,n==EBattleResult.EBattleResultWin?this.lb_result.text="进攻胜利":this.lb_result.text="进攻失败"):(this.lb_result.textColor=4818228,n==EBattleResult.EBattleResultLose?this.lb_result.text="防守胜利":this.lb_result.text="防守失败"),this.lb_time.text=Utils.TimerManager.getTimeLeftDescBySecond(Utils.TimerManager.getServerTime()-i)},e}(eui.ItemRenderer);__reflect(i.prototype,"ManorRecordPanel_Item")}(game||(game={})),function(o){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="ManorTargetBuyPanel",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.maxPurchase=0,this.defaultPurchase=0,this.purchase=0,this.manorMaxResurgencePurchase=JSON.parse(o.Config.constConfig().ManorResurgenceRound.constValue)[1],this.manorDefaultResurgencePurchase=JSON.parse(o.Config.constConfig().ManorResurgenceRound.constValue)[0],this.manorResurgencePurchase=JSON.parse(o.Config.constConfig().ManorResurgenceCosts.constValue)[0][2],this.initComponent(),this.addEvent()},e.prototype.perShow=function(e){return!0},e.prototype.updateView=function(e){this.buyType=e.type,this.totalNum=e.totalNum||0,this.gp_cost_tips.removeChildren();if(1==this.buyType);else if(2==this.buyType);else if(3==this.buyType){this.maxPurchase=this.manorMaxResurgencePurchase,this.defaultPurchase=this.manorDefaultResurgencePurchase,this.purchase=this.manorResurgencePurchase;var t=new eui.Label;t.size=23,t.textColor=7491637,t.text="购买复活次数上限:",this.gp_cost_tips.addChild(t)}this.setValueTo(this.totalNum,!1)},e.prototype.addEvent=function(){var e=this;this.btn_reset.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.setValueTo(e.defaultPurchase),o.AppFacade.getInstance().sendNotification(CN.MANOR_COLLECT_SETTING_UPDATE,{type:e.buyType,value:e.defaultPurchase,action:"reset"})},this),this.btn_update.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.AppFacade.getInstance().sendNotification(CN.MANOR_COLLECT_SETTING_UPDATE,{type:e.buyType,value:Number(e.lb_num.text),action:"update"}),e.hide()},this)},e.prototype.initComponent=function(){var e=this;this.lb_num.addEventListener(egret.Event.CHANGE,function(){Number(e.lb_num.text)>e.maxPurchase&&(e.lb_num.text=e.maxPurchase.toString()),e.updateCost()},this),this.lb_num.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){""!=e.lb_num.text&&Number(e.lb_num.text)||e.setValueTo(0)},this),Utils.TouchUtils.addTouchListener(this.btn_min,function(){e.setValueTo(Number(e.lb_num.text)-100)}),Utils.TouchUtils.addTouchListener(this.btn_sub,function(){e.setValueTo(Number(e.lb_num.text)-10)}),Utils.TouchUtils.addTouchListener(this.btn_add,function(){e.setValueTo(Number(e.lb_num.text)+10)}),Utils.TouchUtils.addTouchListener(this.btn_max,function(){e.setValueTo(Number(e.lb_num.text)+100)})},e.prototype.setValueTo=function(e,t){void 0===t&&(t=!0),e>this.maxPurchase&&(e=this.maxPurchase,t&&Utils.MsgUtils.addMidMsg("已达到最大上限!")),e<0&&(e=0),this.lb_num.text=e.toString(),this.updateCost()},e.prototype.updateCost=function(){Math.floor(Number(this.lb_num.text)/this.purchase);this.gp_buy_tips.removeChildren();var e=new eui.Label;if(e.size=23,e.textColor=7491637,e.text="对应",this.gp_buy_tips.addChild(e),1==this.buyType);else if(2==this.buyType);else if(3==this.buyType){this.maxPurchase=this.manorMaxResurgencePurchase,this.defaultPurchase=this.manorDefaultResurgencePurchase,this.purchase=this.manorResurgencePurchase;var t=Number(this.lb_num.text)*this.purchase;e.text="花费";var i=new eui.Image("item_icon_zuanshi_png");i.width=i.height=o.GeneralConfig.fixedSizeWH-10,this.gp_buy_tips.addChild(i);var n=new eui.Label;n.size=23,n.textColor=7491637,n.text="x"+t,this.gp_buy_tips.addChild(n)}},e}(BasePanel);o.ManorTargetBuyPanel=e,__reflect(e.prototype,"game.ManorTargetBuyPanel")}(game||(game={})),function(s){var e=function(i){function e(){var e=i.call(this)||this;e.skinName="ManorTargetPanel",e.manorPy=s.AppFacade.getInstance().retrieveProxy(s.ManorProxy.N),e.bpProxy=s.AppFacade.getInstance().retrieveProxy(s.BackpackPy.N),e.playerEntityInfo=new s.PlayerEntityInfo,e.autoCaptureInfo=new s.AutoCaptureInfo,e.playerEntityInfoList=new Array,e.autoCaptureInfoList=new Array;for(var t=1;t<=3;t++)e.playerEntityInfoList[t]=new s.PlayerEntityInfo,e.autoCaptureInfoList[t]=new s.AutoCaptureInfo;return e.updateAutoCaptureInfoList(),e.totalWalkDiamond=0,e.totalBloodDiamond=0,e.resurgenceNum=0,e.isOpen=!1,e}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.addEvent(),this.updatePlayerInfo(),this.onClickPage(1)},e.prototype.updateView=function(e){},e.prototype.updateAutoCaptureInfoList=function(){for(var e=1;e<=3;e++)this.playerEntityInfoList[e].update(this.manorPy.queryPlayerProxyInfoByEntityId(e)),this.autoCaptureInfoList[e].update(this.playerEntityInfoList[e].autoCaptureInfo)},e.prototype.updateCurAutoCaptureInfo=function(e,t,i,n){this.autoCaptureInfoList[this.curIdx]&&(this.autoCaptureInfoList[this.curIdx].isAutoCapture=this.cb_0.selected,this.autoCaptureInfoList[this.curIdx].isAutoChallenge=this.cb_1.selected,this.autoCaptureInfoList[this.curIdx].isChallengePowerHouse=this.cb_2.selected,this.autoCaptureInfoList[this.curIdx].isAutoPurchaseWalk=!1,this.autoCaptureInfoList[this.curIdx].isAutoPurchaseBlood=!1,this.autoCaptureInfoList[this.curIdx].isAutoResurgence=this.cb_5.selected,null!=t&&null!=t&&(this.autoCaptureInfoList[this.curIdx].totalWalkDiamond=t),null!=i&&null!=i&&(this.autoCaptureInfoList[this.curIdx].totalBloodDiamond=i),null!=n&&null!=n&&(this.autoCaptureInfoList[this.curIdx].resurgenceNum=n),null!=e&&null!=e&&(this.autoCaptureInfoList[this.curIdx].isOpen=e))},e.prototype.onClickPage=function(e){this.curIdx!=e&&(this.curIdx=e,this.img_bg_normal1.visible=1!=e,this.img_zi_normal1.visible=1!=e,this.img_bg_select1.visible=1==e,this.img_zi_select1.visible=1==e,this.img_bg_normal2.visible=2!=e,this.img_zi_normal2.visible=2!=e,this.img_bg_select2.visible=2==e,this.img_zi_select2.visible=2==e,this.img_bg_normal3.visible=3!=e,this.img_zi_normal3.visible=3!=e,this.img_bg_select3.visible=3==e,this.img_zi_select3.visible=3==e,this.updateUI(e))},e.prototype.updateUI=function(e){this.playerEntityInfo.update(this.playerEntityInfoList[e]),this.autoCaptureInfo.update(this.autoCaptureInfoList[e]);this.autoCaptureInfo.manorId;var t=this.autoCaptureInfo.isAutoCapture||!1,i=this.autoCaptureInfo.isAutoChallenge||!1,n=this.autoCaptureInfo.isChallengePowerHouse||!1,o=this.autoCaptureInfo.isAutoResurgence||!1;this.totalWalkDiamond=0,this.totalBloodDiamond=0,this.resurgenceNum=this.autoCaptureInfo.resurgenceNum||0,this.isOpen=this.autoCaptureInfo.isOpen||!1,this.cb_0.selected=t,this.cb_1.selected=i,this.cb_2.selected=n,this.cb_3.selected=!1,this.cb_4.selected=!1,this.cb_5.selected=o,this.btn_close.visible=this.isOpen,this.btn_start.visible=!this.isOpen,this.updateFightCap()},e.prototype.addEvent=function(){var t=this;this.btn_diamond_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.MainJumpConfig.jumpTo(MODULE.Recharge)},this),this.gp_btn1.touchEnabled=!0,this.gp_btn1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.onClickPage(1)},this),this.gp_btn2.touchEnabled=!0,this.gp_btn2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.onClickPage(2)},this),this.gp_btn3.touchEnabled=!0,this.gp_btn3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.onClickPage(3)},this),this.btn_revive.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.AppFacade.getInstance().showSubView(s.ManorMediator.N,s.ManorMediator.SV.TARGET_BUY,{type:3,totalNum:this.autoCaptureInfo.resurgenceNum})},this),this.btn_reset.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.cb_0.selected=!1,t.cb_1.selected=!1,t.cb_2.selected=!1,t.cb_3.selected=!1,t.cb_4.selected=!1,t.cb_5.selected=!1,t.totalWalkDiamond=0,t.totalBloodDiamond=0,t.resurgenceNum=JSON.parse(s.Config.constConfig().ManorResurgenceRound.constValue)[0];for(var e=1;e<=3;e++)t.sendAutoCapture(!1,e);Utils.MsgUtils.addMidMsg("重置成功")},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.updateSwitch(!1)},this),this.btn_start.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.updateSwitch(!0),Utils.MsgUtils.addMidMsg("开启成功")},this),this.bindTipsPanelClick({target:this.img_power_wenhao,targetBg:this.gp_tips_bg,cb:function(){t.gp_tips.visible=!t.gp_tips.visible,t.gp_tips_bg.visible=t.gp_tips.visible,t.lb_wenhao_desc.textFlow=[{text:"1、自动返回当前矿点：玩家队伍被击败送回安全区后，在行动力充足的情况下会自动返回上次占领的矿点，若矿点人数已满会自动挑战战斗力最低的队伍，默认只挑战战力比自己低的队伍。若矿点被采集空消失，辅助不会帮助玩家自动返回重新刷新的矿点。当体力值低于50时不会使用自动返回功能。\n",style:{size:20,textColor:16777215}},{text:"2、自动挑战其他公会玩家：勾选后玩家会自动挑战进入本矿点的其他公会的玩家，默认只挑战战力比自己低的队伍。\n",style:{size:20,textColor:16777215}},{text:"3、挑战大于自身战力的玩家：勾选后会挑战战斗力比自己高的玩家。\n",style:{size:20,textColor:16777215}},{text:"4、自动购买复活次数，勾选后玩家会自动购买复活次数，可在设置处设置购买复活次数所需要花费的最大钻石上限，当钻石不足时，停止自动购买功能，直到钻石足够才会继续生效。",style:{size:20,textColor:16777215}}]}}),this.cb_0.addEventListener(eui.UIEvent.CHANGE,this.checkBoxChangeHandler,this),this.cb_1.addEventListener(eui.UIEvent.CHANGE,this.checkBoxChangeHandler,this),this.cb_2.addEventListener(eui.UIEvent.CHANGE,this.checkBoxChangeHandler,this),this.cb_5.addEventListener(eui.UIEvent.CHANGE,this.checkBoxChangeHandler,this)},e.prototype.updateSwitch=function(e){for(var t=1;t<=3;t++)if(t==this.curIdx)this.sendAutoCapture(e);else if(this.autoCaptureInfoList[t]&&this.playerEntityInfoList[t]){var i=new s.AutoCaptureInfo;i.manorId=this.playerEntityInfoList[t].manorId,i.update(this.autoCaptureInfoList[t]),i.isOpen=e,this.manorPy.AutoCapture(t,i)}},e.prototype.checkBoxChangeHandler=function(e){this.isOpen&&this.sendAutoCapture(),this.updateCurAutoCaptureInfo()},e.prototype.sendAutoCapture=function(e,t,i){var n,o=t||this.curIdx,a=this.manorPy.queryPlayerProxyInfoByEntityId(o);if(i)return(n=a.autoCaptureInfo).manorId=a.manorId,n.totalWalkDiamond=0,n.totalBloodDiamond=0,n.resurgenceNum=this.resurgenceNum,this.updateCurAutoCaptureInfo(null,this.totalWalkDiamond,this.totalBloodDiamond,this.resurgenceNum),void this.manorPy.AutoCapture(o,n,"auto");(n=new s.AutoCaptureInfo).manorId=a.manorId,n.isAutoCapture=this.cb_0.selected,n.isAutoChallenge=this.cb_1.selected,n.isChallengePowerHouse=this.cb_2.selected,n.isAutoPurchaseWalk=!1,n.isAutoPurchaseBlood=!1,n.isAutoResurgence=this.cb_5.selected,n.totalWalkDiamond=0,n.totalBloodDiamond=0,n.resurgenceNum=this.resurgenceNum,n.isOpen=null!=e&&null!=e?e:this.isOpen,this.updateCurAutoCaptureInfo(n.isOpen);var r=n.isOpen?"open":"close";this.manorPy.AutoCapture(o,n,r)},e.prototype.updateAutoCapture=function(e){void 0===e&&(e=""),"auto"!=e&&this.updateAutoCaptureInfoList(),this.updateUI(this.curIdx)},e.prototype.bindTipsPanelClick=function(e){var t=e.target,i=e.targetBg;t.addEventListener(egret.TouchEvent.TOUCH_TAP,e.cb,this),i.addEventListener(egret.TouchEvent.TOUCH_TAP,e.cb,this)},e.prototype.updateFightCap=function(){this.item_fightCap.update(this.playerEntityInfo.teamInfo.fightCap||0)},e.prototype.updatePlayerInfo=function(){var e=s.GameMVC.backpackPy.getInfoByCode(EPropertyType.EPropertyTypeDiamond);this.blb_diamond.text=Utils.MathUtils.formatNumStyle1(e.haveNum)},e}(BasePanel);s.ManorTargetPanel=e,__reflect(e.prototype,"game.ManorTargetPanel")}(game||(game={}));var MANOR_UPDATE_RANK=10;!function(m){var e=function(t){function e(){var e=t.call(this)||this;return e.isFormationMoveing=!1,e.isFormationShow=!1,e.skinName="ManorSkin",e.intervalRank=STORM_WAR_UPDATE_RANK,e.ManorEnterIntoManorArenaMinBlood=Number(m.Config.constConfig().ManorEnterIntoManorArenaMinBlood.constValue),e.ManorEnterIntoManorArenaHintBlood=Number(m.Config.constConfig().ManorEnterIntoManorArenaHintBlood.constValue),e.ManorOpenDays=Number(m.Config.constConfig().ManorOpenDays.constValue),e.ManorInitBlood=Number(m.Config.constConfig().ManorInitBlood.constValue),e.ManorBloodRefreshCycle=Number(m.Config.constConfig().ManorBloodRefreshCycle.constValue),e.ManorResurgenceCosts=Number(JSON.parse(m.Config.constConfig().ManorResurgenceCosts.constValue)[0][2])||0,e.ManorResurgenceCycle=Number(m.Config.constConfig().ManorResurgenceCycle.constValue),e.manorPy=m.AppFacade.getInstance().retrieveProxy(m.ManorProxy.N),e.playerProxy=m.AppFacade.getInstance().retrieveProxy(m.PlayerPy.N),e.guajiPy=m.AppFacade.getInstance().retrieveProxy(m.GuajiPy.N),e.bloodNum=0,e.isInSafe=void 0,e.isFormationMoveing=!1,e.isFormationShow=!1,e.recoverCD=0,e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.manorPy.LeaveModule()},e.prototype.childrenCreated=function(){var h=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_left_top),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_right_top),this.initUI(),this.addEvent(),this.map=Utils.MapUtils.generateCommon({source:MODULE.Manor,multiLayerScroller:this.cu_mls,loadingParent:this.getParentView(),miniMapParent:void 0,onRequestToMove:function(e,t,i,n){if(i)return!1;var o=h.map.getAStarPath(h.map.me.tileX,h.map.me.tileY,e,t),a=!0;if(o.length<=0)return!1;if(h.map.me.tileX==e&&h.map.me.tileY==t)return!1;if(h.map.me.tileX==o[o.length-1].y&&h.map.me.tileY==o[o.length-1].x)return!1;var r=h.manorPy.queryPlayerProxyInfoByEntityId();if(r){var s=r.teamInfo;if(s&&s.heroBaseInfoList&&0==s.heroBaseInfoList.length)return Utils.MsgUtils.addMidMsg("当前队伍没有英雄上阵,不可移动"),!0}if(!h.map.me.visible)return console.log("玩家不可见,不能移动"),Utils.MsgUtils.addMidMsg("你已经占领了矿点,不可移动!"),!0;(h.map.me.isMoving||0<h.map.me.walkPaths.length)&&(console.log("当前移动未结束,不能移动"),a=!1);var c=m.GameMVC.manorPy.inSafeArea(h.map.me.tileX,h.map.me.tileY),l=m.GameMVC.manorPy.inSafeArea(o[o.length-1].y,o[o.length-1].x);if(0<h.recoverCD)return Utils.MsgUtils.addMidMsg("等待复活或者直接购买复活!"),!0;if(h.bloodNum<=0&&(!c||!l))return Utils.MsgUtils.addMidMsg("等待复活或者直接购买复活!"),!0;if(h.targetEP=void 0,n&&n.vo.type!=RiskEventType.Start&&(h.targetEP=n),(h.isInSafe=c)&&!l){if(h.bloodNum<h.ManorEnterIntoManorArenaMinBlood)return Utils.MsgUtils.addMidMsg("体力不足"+h.ManorEnterIntoManorArenaMinBlood+"不能进入矿区"),!0;if(h.bloodNum<h.ManorEnterIntoManorArenaHintBlood)return m.GameMgr.getInstance().showCommonTipsWin({commonTips:"当前体力较少,是否离开安全区?",source:"manor_blood_not_enough",cb:!0,clickCB:function(e){1==e.type&&h.requestWalk(o)}}),!0}return a&&h.requestWalk(o),!0},onTouchTap:function(e,t){}}),this.gp_map.addChildAt(this.map,0),this.manorPy.GetPlayerManorInfo(!0,0),egret.setTimeout(function(){h.loadMapResConf(),egret.setTimeout(function(){h.once(egret.Event.ENTER_FRAME,function(){h.manorPy.GetManorInfo(),h.manorPy.GetPlayerManorInfo(!1,void 0,!0)},h)},h,500)},this,100),egret.setTimeout(function(){h.manorPy.GetManorRank()},this,100),this.startTimer(),this.initFormationScroll(),this.onClickFormation(this.manorPy.lastEntityIndex,!0),this.lb_revive_cost.text=""+this.ManorResurgenceCosts},e.prototype.requestWalk=function(e){if(this.map.me.tileX!=e[e.length-1].y||this.map.me.tileY!=e[e.length-1].x){var t=this.map.me.tileX,i=this.map.me.tileY;if((this.map.me.tileX!=this.map.me.serverTileX||this.map.me.tileY!=this.map.me.serverTileY)&&(console.log(" 客户端主角当前位置 和 服务器主角当前位置不一致 "),e=this.map.getAStarPath(this.map.me.serverTileX,this.map.me.serverTileY,e[e.length-1].y,e[e.length-1].x),t=this.map.me.serverTileX,i=this.map.me.serverTileY,e.length<=0))return console.log(" 校正主角位置 移动到服务器位置 暂停请求移动 "),void this.map.handleTouchTap(t,i,!1,!0);var n=m.GameMVC.manorPy.caleSafeAreaWalk(e);console.log("请求移动到点 X:"+e[e.length-1].y+", Y:"+e[e.length-1].x+", 移动 "+e.length+" 步"),this.manorPy.Walk({x:t,y:i},{x:e[e.length-1].y,y:e[e.length-1].x},e.length,n)}else console.log(" 相同地方请求两次 ")},e.prototype.updateView=function(e,t){},e.prototype.perClose=function(){this.stopTimer(),this.manorPy.reset(),this.map.reset(),this.map.removeAllOtherPlayer()},e.prototype.initUI=function(){this.pb_time.labelFunction=function(e,t){return Utils.TimerManager.getFormatBySecond1(e)};var e=Utils.UnlockMgr.getOpenInfo(MODULE.Manor);this.startDt=e.openTimeDt,this.endDt=e.endTimeDt},e.prototype.initFormationScroll=function(){this.list_item.itemRenderer=i},e.prototype.onClickFormation=function(l,e){var h=this;void 0===e&&(e=!1),this.curIdx!=l&&(this.curIdx=l,e?this.updateFormationTips(l):this.curIdx!=this.manorPy.lastEntityIndex&&(GameRootLayer.gameLayer().switchCloudLoading(!0),egret.setTimeout(function(){GameRootLayer.gameLayer().switchCloudLoading(!1)},this,1e3),egret.setTimeout(function(){for(var e=void 0,t=0,i=h.manorPy.playerProxyInfo.playerEntityList;t<i.length;t++){var n=i[t];if(n.entityIndex==h.curIdx){e=n;break}}if(e){if(h.map.me.forceStop(),h.map.me.serverTileX=e.coordinateInfo.x,h.map.me.serverTileY=e.coordinateInfo.y,h.map.me.setTilePos(e.coordinateInfo.x,e.coordinateInfo.y,!1),h.map.resetCamera(),h.map.onMeWalkTo(e.coordinateInfo.x,e.coordinateInfo.y),m.GameMVC.guajiPy.updateCurPosition(e.coordinateInfo.x,e.coordinateInfo.y),m.GameMVC.manorMed.hideSubView(m.ManorMediator.SV.DETAIL),h.map.me.isOccpuyManor=0!=e.manorId,h.map.me.visible=0==e.manorId,e.teamInfo&&e.teamInfo.heroBaseInfoList&&e.teamInfo.heroBaseInfoList[0]){var o=e.teamInfo.heroBaseInfoList[0],a=void 0;0!=o.dermaCode&&(a=m.Config.getHeroDermaConfig()[o.dermaCode].avatar),h.map.me.updateBaseItem({code:o.code,avatar:a})}else{var r=JSON.parse(m.Config.constConfig().DefaultAvatar.constValue)[0];h.map.me.updateBaseItem({avatar:r})}h.manorPy.lastEntityIndex=h.curIdx,h.manorPy.GetPlayerManorInfo(!0,h.curIdx),h.map.removeAllOtherPlayer(),h.manorPy.GetPlayerManorInfo(!1),h.map.updateManorEPCollect(),h.updateBloodNum(),h.updateFormationTips(l);var s=void 0;if(e.coordinateStatus==ManorPlayerCoordinateChangeType.Battle?s="由于体力归0，你已传送回安全区":e.coordinateStatus==ManorPlayerCoordinateChangeType.ManorDisapper?s="矿已消失，你已传送回安全区":e.coordinateStatus==ManorPlayerCoordinateChangeType.NoHero&&(s="由于队伍状态改变，你已被传送回安全区"),s){var c=new egret.Timer(1e3,1);c.addEventListener(egret.TimerEvent.TIMER,function(){Utils.MsgUtils.addMidMsg(s),c.stop()},h),c.start()}}},this,500)),this.img_formation1.visible=1==l,this.img_formation2.visible=2==l,this.img_formation3.visible=3==l,this.img_formation_bg1.visible=1==l,this.img_formation_bg2.visible=2==l,this.img_formation_bg3.visible=3==l)},e.prototype.updatePlayerProxyInfo=function(){this.updateFormationTips(this.curIdx);var e=this.manorPy.playerProxyInfo.playerEntityList;this.scl_list.stopAnimation(),this.scl_list.validateNow(),this.list_item.dataProvider?this.list_item.dataProvider.replaceAll(e):this.list_item.dataProvider=new eui.ArrayCollection(e)},e.prototype.addEvent=function(){var t=this;this.gp_btn.touchEnabled=!0,this.gp_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;if(!this.isFormationMoveing){this.isFormationMoveing=!0;var t=0;this.isFormationShow&&(t=-this.gp_left.width),this.isFormationShow=!this.isFormationShow,egret.Tween.get(this.gp_left).to({x:t},200).call(function(){e.isFormationMoveing=!1,e.img_right.visible=0!=t,e.img_left.visible=0==t,e.gp_formation_tips.visible=0!=t})}},this),this.gp_formation1.touchEnabled=!0,this.gp_formation1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onClickFormation(1)},this),this.gp_formation2.touchEnabled=!0,this.gp_formation2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onClickFormation(2)},this),this.gp_formation3.touchEnabled=!0,this.gp_formation3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onClickFormation(3)},this),this.gp_pet.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.openFormationUI()},this),this.gp_weapon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.openFormationUI()},this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){m.MainJumpConfig.jumpTo("CITY")},this),this.btn_ditu.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.openMiniMap()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new m.HelpDialog({moduleId:MODULE.Manor})})},this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.manorPy.GetBattleRecordInfo(),m.AppFacade.getInstance().showSubView(m.ManorMediator.N,m.ManorMediator.SV.RECORD)},this),this.btn_chat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.UnlockMgr.checkPass(MODULE.Chat).allow&&m.AppFacade.getInstance().showSubView(m.ChatMediator.N,m.ChatMediator.SV.CHAT,{NextChannelType:EChatChannelType.SameServer})},this),this.btn_ranking.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){m.AppFacade.getInstance().showSubView(m.RankMediator.N,m.RankMediator.SV.COMMON,{module:"MANOR_RANK"})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){m.AppFacade.getInstance().showSubView(m.RankMediator.N,m.RankMediator.SV.COMMON,{module:"MANOR_REWARD"})},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){m.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeManor})},this),this.btn_target.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){m.AppFacade.getInstance().showSubView(m.ManorMediator.N,m.ManorMediator.SV.TARGET)},this),this.gp_recoverDt.touchEnabled=!0,this.gp_recoverDt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;m.GameMgr.getInstance().showCommonTipsWin({commonTips:"是否花费"+this.ManorResurgenceCosts+"钻石立即复活?",source:"manor_buy_revive",cb:!0,clickCB:function(e){1==e.type&&t.manorPy.PurchaseBlood(0)}})},this)},e.prototype.chooseNewList=function(e){return m.GameMVC.manorPy.checkFormation(e)},e.prototype.openFormationUI=function(){m.AppFacade.getInstance().showSubView(m.CommonMediator.N,m.CommonMediator.SV.TEAM_CHOOSE,{module:MODULE.Manor,touchHoldCB:this.chooseNewList.bind(this),doneCB:void 0,tips:"只有在安全区才能编辑队伍"})},e.prototype.loadMapResConf=function(){var e=m.Config.manorLayer()[1];this.map.tiled!=e.tiled&&this.map.update({isInit:!0,tiled:e.tiled,theme:e.theme,h:e.long,w:e.wide})},e.prototype.onMeMoveFinish=function(){if(null!=this.isInSafe){var e=m.GameMVC.manorPy.inSafeArea(this.map.me.tileX,this.map.me.tileY);this.isInSafe!=e&&(e?Utils.MsgUtils.addMidMsg("你已进入安全区"):Utils.MsgUtils.addMidMsg("你已离开安全区"),this.isInSafe=e)}},e.prototype.openMiniMap=function(e){var t=!1;e&&(t=e.choice),this.map&&m.AppFacade.getInstance().showSubView(m.ManorMediator.N,m.ManorMediator.SV.MINI_MAP,{mwArr:this.map.mwArr,tileX:this.map.me.tileX,tileY:this.map.me.tileY,choice:t})},e.prototype.updateFormationTips=function(e){void 0===e&&(e=1),this.gp_member_tips.removeChildren();for(var t=1;t<=6;t++){(h=new y).name=t.toString(),h.x=51*(t-1),h.scaleX=h.scaleY=.48,h.updateItem({},!0),this.gp_member_tips.addChildAt(h,0),h.img_add.visible=!1}var i=this.manorPy.queryPlayerProxyInfoByEntityId(this.manorPy.lastEntityIndex);if(i){var n=i.teamInfo,o=i.blood,a=i.manorId,r=0;n&&n.fightCap&&(r=n.fightCap),this.item_fightCap_tips.update(r),this.blb_blood_tips.text=""+o;var s="mxkc_img_caijizhong_png";0==a&&(s="mxkc_img_weizhanling_png"),this.img_mark_tips.source=s;for(var c=0,l=n.heroBaseInfoList;c<l.length;c++){var h,p=l[c],d=p.battlePos;(h=this.gp_member_tips.getChildByName(d.toString()))&&h.updateItem(p,!0)}if(n&&n.petList&&n.petList[0]){var u=n.petList[0],g=m.GameMVC.petPy.getInfoByCode(u);g&&(this.img_usePet.source=g.config.avatar+"_png"),this.img_usePet.visible=!0}else this.img_usePet.visible=!1;if(n&&n.magicalList&&n.magicalList[0]){var f=n.magicalList[0],_=m.GameMVC.magicalArtifactPy.getInfoByCode(f);_&&(this.img_useArt.source=_.config.model+"_png"),this.img_useArt.visible=!0}else this.img_useArt.visible=!1}},e.prototype.playSuccessEffect=function(){DragonBoneTools.playOnce({cacheAsBitmap:!1,loop:!1,x:GameRootLayer.gameLayer().popMsgLayer.width/2,y:GameRootLayer.gameLayer().popMsgLayer.height/2,scaleX:1,scaleY:1,effectName:"common_zlcg",parent:GameRootLayer.gameLayer().popMsgLayer,timeScale:1})},e.prototype.updatePlayerEntityInfo=function(o){var a=this;this.manorPy.playerList.forEach(function(e){if(e.isSelf){if(a.map.updatePlayerEntityInfo(e,o,a.targetEP),a.targetEP=void 0,e.entityIndex==a.manorPy.lastEntityIndex){var t=Utils.TimerManager.getServerTime(),i=e.revivalBeginDt||0,n=t-i;0!=i&&n<a.ManorResurgenceCycle?a.recoverCD=a.ManorResurgenceCycle-n:a.recoverCD=0}}else a.map.updatePlayerEntityInfo(e,o)}),this.map.touchChildren=!0,this.map.touchEnabled=!1},e.prototype.updateManorEntityInfo=function(e){var i=[];this.manorPy.manorList.forEach(function(e){var t=RiskEventType.Manor;e.remove&&(t=RiskEventType.None),i.push(new m.EventVO({config:void 0,customTrigger:void 0,eventId:void 0,fadeType:void 0,hudongAction:void 0,info:'{ "captured":false, "id":'+e.id+', "manorId":'+e.manorId+"}",isDirty:!0,isExpire:!1,isInited:!0,position:{id:null,isDirty:!0,layerId:null,num:null,type:null,x:e.coordinateInfo.x,y:e.coordinateInfo.y},type:t}))}),this.map.updateLayerEvent({events:i});for(var t=this.manorPy.manorList.length-1;0<=t;t--)this.manorPy.manorList[t].remove&&this.manorPy.manorList.splice(t,1);this.map.resetMNM()},e.prototype.updateBloodNum=function(){var e=this.manorPy.queryPlayerEntityByPlayerId(m.GameMVC.loginPy.playerProxy.playerInfoVO.playerId,this.manorPy.lastEntityIndex);e&&(this.bloodNum=e.blood,this.blb_blood.text=this.bloodNum+"/"+this.ManorInitBlood)},e.prototype.removeManorEntity=function(e){this.map.removeManorEntity(e)},e.prototype.removePlayerEntity=function(e){this.map.removePlayerEntity(e)},e.prototype.showRewardView=function(e){m.AppFacade.getInstance().showSubView(m.CommonMediator.N,m.CommonMediator.SV.REWARD_PANEL,{rewards:e.clientReward,type:m.CommonRewardPreviewPanel.REWARD_TYPE.REWARD})},e.prototype.updateRank=function(){this.gp_ranking.visible=!1,this.gp_empty.visible=!0,this.img_rank1.visible=!1,this.img_rank2.visible=!1,this.img_rank3.visible=!1,this.img_score1.visible=!1,this.img_score2.visible=!1,this.img_score3.visible=!1;var e=this.manorPy.ranks;if(e){var t=e.ranks;Array.isArray(t)&&0<t.length&&(this.gp_ranking.visible=!0,this.gp_empty.visible=!1,t[0]?(this.lb_name1.text="S"+t[0].playerBaseInfo.serverId+"."+t[0].playerBaseInfo.name,this.lb_score1.text=""+t[0].key,this.img_rank1.visible=!0,this.img_score1.visible=!0):(this.lb_name1.text="",this.lb_score1.text=""),t[1]?(this.lb_name2.text="S"+t[1].playerBaseInfo.serverId+"."+t[1].playerBaseInfo.name,this.lb_score2.text=""+t[1].key,this.img_rank2.visible=!0,this.img_score2.visible=!0):(this.lb_name2.text="",this.lb_score2.text=""),t[2]?(this.lb_name3.text="S"+t[2].playerBaseInfo.serverId+"."+t[2].playerBaseInfo.name,this.lb_score3.text=""+t[2].key,this.img_rank3.visible=!0,this.img_score3.visible=!0):(this.lb_name3.text="",this.lb_score3.text=""));var i=e.selfRank;this.lb_my_ranking.text=""+i.rank,this.lb_my_score.text=""+i.key}},e.prototype.startTimer=function(e,t){this.timer||(this.timer=new egret.Timer(1e3)),this.stopTimer(),this.timer.delay=e||1e3,this.timer.repeatCount=t||0,this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this.timer.reset(),this.timer.start()},e.prototype.stopTimer=function(){this.timer&&(this.timer.stop(),this.timerComFunc())},e.prototype.timerFunc=function(){if(0<this.recoverCD?(this.gp_recoverDt.visible||(this.gp_recoverDt.visible=!0),this.blb_dt_tips.text=""+Utils.TimerManager.getFormatBySecond1(this.recoverCD),this.recoverCD--):(this.gp_recoverDt.visible&&(this.gp_recoverDt.visible=!1),this.bloodNum<=0&&this.manorPy.GetPlayerManorInfo()),this.pb_time){var e=Utils.TimerManager.getServerTime(!1),t=this.endDt-e;if(this.pb_time.maximum=this.endDt-this.startDt,(this.pb_time.value=t)<=0)return Utils.MsgUtils.addMidMsg("活动已结束!"),void m.AppFacade.getInstance().sendNotification(CN.MANOR_FORCE_EXIT)}this.map&&this.map.updateManorEPCollect(),this.intervalRank<=0?(this.manorPy.GetManorRank(),this.intervalRank=MANOR_UPDATE_RANK):this.intervalRank-=1},e.prototype.timerComFunc=function(){this.timer&&(this.timer.removeEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this))},e}(BaseFull);m.ManorView=e,__reflect(e.prototype,"game.ManorView");var i=function(i){function e(){var e=i.call(this)||this;return e.skinName="ManorFormation_Item",e}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this);for(var e=1;e<=6;e++){var t=new y;t.name=e.toString(),t.x=51*(e-1),t.scaleX=t.scaleY=.48,t.updateItem({}),this.gp_member.addChildAt(t,0)}this.addEvent()},e.prototype.dataChanged=function(){var e=this.data.entityIndex||1,t=this.data.teamInfo,i=this.data.blood,n=this.data.manorId;this.lb_part.text="队伍"+e;var o=0;t&&t.fightCap&&(o=t.fightCap),this.item_fightCap_l.update(o),this.blb_blood.text=""+i;var a="mxkc_img_caijizhong_png";0==n&&(a="mxkc_img_weizhanling_png"),this.img_mark.source=a,this.lb_tips.touchEnabled=!1,0<t.heroBaseInfoList.length?this.lb_tips.visible=!1:this.lb_tips.visible=!0;for(var r=1;r<=6;r++){(l=this.gp_member.getChildByName(r.toString()))&&l.updateItem({})}for(var s=0,c=t.heroBaseInfoList;s<c.length;s++){var l,h=c[s],p=h.battlePos;(l=this.gp_member.getChildByName(p.toString()))&&l.updateItem(h)}if(t&&t.petList&&t.petList[0]){var d=t.petList[0],u=m.GameMVC.petPy.getInfoByCode(d);u&&(this.img_usePet.source=u.config.avatar+"_png"),this.img_usePet.visible=!0}else this.img_usePet.visible=!1;if(t&&t.magicalList&&t.magicalList[0]){var g=t.magicalList[0],f=m.GameMVC.magicalArtifactPy.getInfoByCode(g);f&&(this.img_useArt.source=f.config.model+"_png"),this.img_useArt.visible=!0}else this.img_useArt.visible=!1},e.prototype.chooseNewList=function(e){return m.GameMVC.manorPy.checkFormation(e)},e.prototype.openFormationUI=function(){m.AppFacade.getInstance().showSubView(m.CommonMediator.N,m.CommonMediator.SV.TEAM_CHOOSE,{module:MODULE.Manor,touchHoldCB:this.chooseNewList.bind(this),doneCB:void 0,tips:"只有在安全区才能编辑队伍"})},e.prototype.addEvent=function(){this.btn_edit.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.openFormationUI()},this),this.img_pet.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.openFormationUI()},this),this.img_weapon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.openFormationUI()},this)},e}(eui.ItemRenderer);__reflect(i.prototype,"ManorFormation_Item");var y=function(t){function e(){var e=t.call(this)||this;return e.skinName="ManorHead_Item",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){m.AppFacade.getInstance().showSubView(m.CommonMediator.N,m.CommonMediator.SV.TEAM_CHOOSE,{module:MODULE.Manor,touchHoldCB:this.chooseNewList.bind(this),doneCB:void 0,tips:"只有在安全区才能编辑队伍"})},this)},e.prototype.chooseNewList=function(e){return m.GameMVC.manorPy.checkFormation(e)},e.prototype.updateItem=function(e,t){if(void 0===t&&(t=!1),(this.data=e).code){this.gp_baseitem.visible=!0,this.gp_empty.visible=!1,this.gp_touch.visible=!1,this.img_add.visible=!1;var i=void 0;0!=e.dermaCode&&(i=m.Config.getHeroDermaConfig()[e.dermaCode].avatar),this.baseItem.updateData({code:e.code,avatar:i})}else this.gp_baseitem.visible=!1,this.gp_empty.visible=!0,this.gp_touch.visible=!0,this.img_add.visible=!0;t&&(this.gp_touch.visible=!0)},e}(eui.ItemRenderer);__reflect(y.prototype,"ManorHead_Item")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.proxy=o.AppFacade.getInstance().retrieveProxy(o.MountPy.N),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.MountMainView),this.addSubView(n.SV.UP_STAR,o.MountUpstarPanel),this.addSubView(n.SV.UP_STAR_RESULT,o.MountUpstarResultPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.MOUNT_UPDATEMAIN,CN.MOUNT_UPDATESTAR]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.Horse,!1).allow&&this.proxy.GetHorseInfo();break;case CN.MOUNT_UPDATEMAIN:(t=this.getSubView(n.SV.MAIN))&&t.updateView();break;case CN.MOUNT_UPDATESTAR:var t;(t=this.getSubView(n.SV.UP_STAR))&&t.updateInfo()}},n.N="MountMediator",n.SV={MAIN:1,UP_STAR:2,UP_STAR_RESULT:3},n}(BaseMediator);o.MountMediator=e,__reflect(e.prototype,"game.MountMediator")}(game||(game={})),function(e){var t=function(){function e(){}return e.registerAll=function(){},e}();e.MountProcessor=t,__reflect(t.prototype,"game.MountProcessor")}(game||(game={})),function(g){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.horseCoreInfo=void 0,e.handbookList=[],e.playerPy=g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N),e.allMountByUuid={},e.onMountUuid="",e.addNotice(),e}return __extends(i,t),i.prototype.addNotice=function(){NoticeManager.registerCB(NT.MOUNT_ACTIVATE,this.checkNoticeByActivate,this),NoticeManager.registerCB(NT.MOUNT_UPDATE,this.checkNoticeByLevel,this),NoticeManager.registerCB(NT.MOUNT_UPSTAR,this.checkNoticeByStar,this),NoticeManager.setChildType(NT.MOUNT,[NT.MOUNT_ACTIVATE,NT.MOUNT_UPDATE,NT.MOUNT_UPSTAR])},i.prototype.checkNoticeByActivate=function(){for(var e=!1,t=g.Config.horseConfig(),i=this.allMountByUuid,n=0;n<t.length;n++){var o=!1;for(var a in i)if(i[a].code==t[n].code){o=!0;break}if(!o){var r=JSON.parse(t[n].costs);if(e=this.judgeIsEnough(r))return e}}return e},i.prototype.checkNoticeByLevel=function(){var e=!1,t=this.allMountByUuid;for(var i in t){var n=g.Config.horseGradeConfigByCode(t[i].code);if(t[i].level<n.length-1){for(var o=t[i].level+1,a=void 0,r=0;r<n.length;r++)if(o==n[r].level){a=n[r];break}if(a&&a.costs){var s=JSON.parse(a.costs);if(e=this.judgeIsEnough(s))return e}}}return e},i.prototype.checkNoticeByStar=function(){var e=!1,t=this.allMountByUuid;for(var i in t){var n=g.Config.horseStarConfigByCode(t[i].code);if(t[i].starLevel<n.length-1){for(var o=t[i].starLevel+1,a=void 0,r=0;r<n.length;r++)if(o==n[r].level){a=n[r];break}if(a&&a.costs){var s=JSON.parse(a.costs);if(e=this.judgeIsEnough(s))return e}}}return e},i.prototype.judgeIsEnough=function(e){var t=!1,i=0;if(e&&e.length){for(var n=0;n<e.length;n++){g.GameMVC.backpackPy.getItemNumByCode(e[n][1])>=e[n][2]&&i++}t=i>=e.length}return t},i.prototype.checkNoticeStarByConfig=function(e){var t=!1,i=!1,n=this.allMountByUuid,o=g.Config.horseStarConfigByCode(e.code),a=void 0;for(var r in n)n[r].code==e.code&&(i=!0,a=n[r]);if(i&&a.starLevel<o.length-1&&a.starLevel<o.length-1){for(var s=a.starLevel+1,c=void 0,l=0;l<o.length;l++)if(s==o[l].level){c=o[l];break}if(c&&c.costs){var h=JSON.parse(c.costs);if(t=this.judgeIsEnough(h))return t}}return t},i.prototype.checkNoticeByConfig=function(e){var t=!1,i=!1,n=this.allMountByUuid,o=g.Config.horseGradeConfigByCode(e.code),a=g.Config.horseStarConfigByCode(e.code),r=JSON.parse(e.costs),s=void 0;for(var c in n)n[c].code==e.code&&(i=!0,s=n[c]);if(i){if(s.level<o.length-1){for(var l=s.level+1,h=void 0,p=0;p<o.length;p++)if(l==o[p].level){h=o[p];break}if(h&&h.costs&&(r=JSON.parse(h.costs),t=this.judgeIsEnough(r)))return t}if(s.starLevel<a.length-1&&s.starLevel<a.length-1){l=s.starLevel+1;var d=void 0;for(p=0;p<a.length;p++)if(l==a[p].level){d=a[p];break}if(d&&d.costs){var u=JSON.parse(d.costs);if(t=this.judgeIsEnough(u))return t}}}else t=this.judgeIsEnough(r);return t},i.prototype.updateMountDict=function(e,t){var i=this;void 0===t&&(t=!1),Array.isArray(e)||(e=[e]),e.forEach(function(e){if(i.allMountByUuid[e.uuid])i.allMountByUuid[e.uuid].update(e);else{var t=new g.MountVO(e);i.allMountByUuid[e.uuid]=t}e.pos&&(i.onMountUuid=e.uuid)})},i.prototype.getInfoByCode=function(e){for(var t in this.allMountByUuid){var i=this.allMountByUuid[t];if(i.code==e)return i}},i.prototype.deteleByUuids=function(e){var t=this;e.forEach(function(e){delete t.updateMountDict[e]})},i.prototype.GetHorseInfo=function(t){var i=this;Utils.Socket.send("horse","GetHorseInfo",{}).then(function(e){i.updateMountDict(e.horseList),i.horseCoreInfo=e.info.coreInfo,i.handbookList=e.info.handbookList,NoticeManager.updateNotice(NT.MOUNT),t&&t()})},i.prototype.ActivateHorse=function(e,i){var n=this;Utils.Socket.send("horse","ActivateHorse",{code:e}).then(function(e){if(e.clientReward&&e.clientReward.horses)for(var t in e.clientReward.horses)n.updateMountDict(e.clientReward.horses[t]);g.AppFacade.getInstance().sendNotification(CN.MOUNT_UPDATEMAIN),NoticeManager.updateNotice(NT.MOUNT),i&&i()})},i.prototype.UpHorseGrade=function(e,t){var i=this;Utils.Socket.send("horse","UpHorseGrade",{uuid:e}).then(function(e){i.updateMountDict(e.horse),i.horseCoreInfo=e.info.coreInfo,i.handbookList=e.info.handbookList,g.AppFacade.getInstance().sendNotification(CN.MOUNT_UPDATEMAIN),NoticeManager.updateNotice(NT.MOUNT),t&&t()})},i.prototype.UpHorseStar=function(e,t){var i=this;Utils.Socket.send("horse","UpHorseStar",{uuid:e}).then(function(e){i.updateMountDict(e.horse),i.horseCoreInfo=e.info.coreInfo,i.handbookList=e.info.handbookList,g.AppFacade.getInstance().sendNotification(CN.MOUNT_UPDATEMAIN),NoticeManager.updateNotice(NT.MOUNT),t&&t(),g.AppFacade.getInstance().sendNotification(CN.MOUNT_UPDATESTAR)})},i.prototype.PutHorseOn=function(e,t){var i=this;Utils.Socket.send("horse","PutHorseOn",{uuid:e}).then(function(e){i.updateMountDict(e.horse),i.updateMountDict(e.oldHorse),g.AppFacade.getInstance().sendNotification(CN.MOUNT_UPDATEMAIN),t&&t()})},i.prototype.PutHorseDown=function(e,t){var i=this;Utils.Socket.send("horse","PutHorseDown",{uuid:e}).then(function(e){i.updateMountDict(e.horse),g.AppFacade.getInstance().sendNotification(CN.MOUNT_UPDATEMAIN),t&&t()})},i.N="MountPy",i}(BaseProxy);g.MountPy=e,__reflect(e.prototype,"game.MountPy")}(game||(game={})),function(u){var e=function(t){function e(){var e=t.call(this)||this;return e.moneyType=[],e.isFirst=!1,e.params=void 0,e.backpackproxy=u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N),e.py=u.AppFacade.getInstance().retrieveProxy(u.MountPy.N),e.playerPy=u.AppFacade.getInstance().retrieveProxy(u.PlayerPy.N),e.config=void 0,e.dataList=[],e.curSelectIndex=0,e.dataprovider=new eui.ArrayCollection,e.code=0,e.uuid=void 0,e.isEnoughByLevel=!1,e.needLevel=0,e.resFullImg=new eui.Image("_main_m_json.common_img_hongdian"),e.skinName="MountMainViewSkin",e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),u.GameMVC.playerPy.GetPlayerInfo()},e.prototype.childrenCreated=function(){var n=this;t.prototype.childrenCreated.call(this),this.resFullImg.right=-10,this.resFullImg.visible=!1,this.btn_master&&this.btn_master.addChild(this.resFullImg),this.cu_model.scaleX=this.cu_model.scaleY=1.5,this.head.touchEnabled=!1,this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.hide()},this),this.list.img_lastOne.source=4<u.Config.horseConfig().length?"yslz_btn_jiantouyou_png":"",this.list.img_nextOne.source=4<u.Config.horseConfig().length?"yslz_btn_jiantouyou_png":"",this.list.itemRenderer=i,this.list.dataProvider=this.dataprovider,this.list.addItemTapEvent(function(e){n.dataprovider.getItemAt(n.curSelectIndex).choose=!1;var t=n.list.list_root.getVirtualElementAt(n.curSelectIndex);t&&t.img_chose&&(t.img_chose.visible=!1),n.curSelectIndex=e.itemIndex,n.dataprovider.getItemAt(n.curSelectIndex).choose=!0;var i=n.list.list_root.getVirtualElementAt(n.curSelectIndex);i&&i.img_chose&&(i.img_chose.visible=!0),n.updateInfo()},this),this.btn_putOn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.uuid&&n.py.PutHorseOn(n.uuid,function(){n.updateUseShow(),Utils.MsgUtils.addMidMsg("出战成功")})},this),this.btn_putDown.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.uuid&&n.py.PutHorseDown(n.uuid,function(){n.updateUseShow(),Utils.MsgUtils.addMidMsg("休息成功")})},this),this.btn_activate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.code&&(n.isEnoughByLevel?n.py.ActivateHorse(n.code,function(){n.updateUseShow(),n.gp_effect.removeChildren(),DragonBoneTools.playOnce({effectName:"common_ty_jihuo",parent:n.gp_effect,x:n.gp_effect.width/2,y:n.gp_effect.height/2})}):Utils.MsgUtils.addMidMsg("道具不足,无法激活"))},this),this.btn_upgrade.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.uuid&&(n.isEnoughByLevel?n.py.UpHorseGrade(n.uuid,function(){n.gp_effect.removeChildren(),DragonBoneTools.playOnce({effectName:"common_ty_dj",parent:n.gp_effect,y:n.gp_effect.height/2,x:n.gp_effect.width/2})}):Utils.MsgUtils.addMidMsg("道具不足,无法升级"))},this),this.btn_master.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.AppFacade.getInstance().showSubView(u.MountMediator.N,u.MountMediator.SV.UP_STAR,{code:n.code,uuid:n.uuid})},this),this.btn_book.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.AppFacade.getInstance().showSubView(u.FashionMediator.N,u.FashionMediator.SV.ALL_INFO,{module:MODULE.Horse,allUuid:n.py.allMountByUuid,bookConfig:u.Config.horseBookConfig(),modelConfig:u.Config.horseConfigList()})},this)},e.prototype.judgeListIndex=function(e){var t=this.py.allMountByUuid;for(var i in t)if(t[i].code==e.code)return 1==t[i].pos?2:3;for(var n=0,o=JSON.parse(e.costs),a=0;a<o.length;a++){u.GameMVC.backpackPy.getItemNumByCode(o[a][1])>=o[a][2]&&n++}return n>=o.length?1:4},e.prototype.judgeIsUse=function(e){var t=!1,i=this.py.allMountByUuid;for(var n in i)if(i[n].code==e.code&&1==i[n].pos){t=!0;break}return t},e.prototype.judgeIsEnough=function(e){var t=!1,i=this.py.allMountByUuid;for(var n in i)if(i[n].code==e.code){t=!0;break}if(t)return!0;var o=!1,a=JSON.parse(e.costs),r=0;if(a&&a.length){for(var s=0;s<a.length;s++){u.GameMVC.backpackPy.getItemNumByCode(a[s][1])>=a[s][2]&&r++}o=r>=a.length}else o=!1;return o},e.prototype.updateList=function(e){this.dataList=[];for(var t=u.Config.horseConfig(),i=0;i<t.length;i++){var n={indexNum:this.judgeListIndex(t[i]),config:t[i],isUse:this.judgeIsUse(t[i]),choose:!1,isEnough:this.judgeIsEnough(t[i]),isNotice:this.py.checkNoticeByConfig(t[i])};this.dataList.push(n)}this.dataList[this.curSelectIndex].choose=!0,this.dataprovider.replaceAll(this.dataList)},e.prototype.updateUseShow=function(){var e=this.py.allMountByUuid;for(var t in this.dataprovider.source){var i=this.dataprovider.getItemAt(Number(t)),n=this.list.list_root.getVirtualElementAt(Number(t));for(var o in i.isUse=!1,n.img_putOn.visible=!1,e)e[o].code==i.config.code&&1==e[o].pos&&(i.isUse=!0,n.img_putOn.visible=!0)}},e.prototype.updateModel=function(e){var t=this;if(e){if(this.code==e)return;this.code=e,this.cu_model.visible=!1,this.cu_model.update({reqStyle:ROLE_STYLE.Fashion|ROLE_STYLE.Horse|ROLE_STYLE.Magical,horseCode:this.code}),this.cu_model.onArmatureLoadCB=function(){t.cu_model.visible=!0,t.cu_model.onChangingDir(1)}}else this.cu_model.visible=!1,this.cu_model.update({reqStyle:ROLE_STYLE.Fashion|ROLE_STYLE.Horse|ROLE_STYLE.Magical,horseCode:this.code}),this.cu_model.onArmatureLoadCB=function(){t.cu_model.visible=!0,t.cu_model.onChangingDir(1)}},e.prototype.updateView=function(e){e&&(this.curSelectIndex=e.chooseIndex),this.updateList(),this.updateInfo(),e&&(this.list.validateNow(),this.list.changeTo({itemIndex:this.curSelectIndex}))},e.prototype.updateInfo=function(){var e=this.curSelectIndex,t=this.dataList[e].config;this.updateModel(t.code),this.config=t,this.uuid=void 0,this.lb_perfession.text=this.lb_name.text=t.name,this.lb_desc.text="    "+t.desc,this.head.updateData({vo:{avatar:t.avatar}});var i,n=0;i=u.Config.horseGradeConfigByCode(t.code).length-1;var o=0,a=JSON.parse(t.attr),r=!1,s=!1,c=!1;this.item_fightCap.update(0);var l=this.py.allMountByUuid;for(var h in l)if(l[h].code==this.code){r=!0,a=JSON.parse(l[h].attr),n=l[h].level,o=l[h].starLevel,this.uuid=l[h].uuid,0==l[h].pos?s=!0:1==l[h].pos&&(c=!0),this.item_fightCap.update(l[h].fightCap);break}this.lb_level.text=n+"/"+i,this.btn_putOn.visible=s,this.btn_putDown.visible=c;var p=u.GeneralConfig.getHeroStarInfo(o);if(this.gp_star.removeChildren(),p.stage<4)for(var d=0;d<p.num;d++)this.gp_star.addChild(new eui.Image(p.src));else this.gp_star.addChild(new customui.HighStarLevelIcon(p.num));this.updateCostBar(r,t),this.updateAttr(r,a),i<=n?(this.gp_cost.removeChildren(),this.btn_maxLevel.visible=!0,this.btn_upgrade.visible=!1,this.btn_activate.visible=!1):(this.btn_maxLevel.visible=!1,this.btn_activate.visible=!r,this.btn_upgrade.visible=r,this.updateLevelCosts(r,t,n)),this.updateSkillInfo(n,t,o),this.btn_master.visible=!!r,UIActionManager.setAbsGrey(this.btn_upgrade,!this.isEnoughByLevel),UIActionManager.setAbsGrey(this.btn_activate,!this.isEnoughByLevel),this.btn_master.getChildAt(1).visible=this.py.checkNoticeStarByConfig(t)},e.prototype.updateAttr=function(e,t){if(this.gp_attr.removeChildren(),e)for(var i in t){(n=new u.HeroMainView_AttrItem(void 0)).scaleX=n.scaleY=.9,n.updateItem({type:i,num:t[i]||0}),this.gp_attr.addChild(n)}else for(var i in t){var n;(n=new u.HeroMainView_AttrItem(void 0)).scaleX=n.scaleY=.9,n.updateItem({type:t[i][0],num:t[i][1]||0}),this.gp_attr.addChild(n)}},e.prototype.updateCostBar=function(e,t){var i=JSON.parse(t.costs);if(e){var n=u.Config.horseGradeConfigByCode(t.code);i=JSON.parse(n[1].costs)}if(this.moneyType=[],i&&i.length){var o=!0;this.moneyType.forEach(function(e){e[0]==i[0][0]&&e[1]==i[0][1]&&(o=!1)}),o&&this.moneyType.push([i[0][0],i[0][1]])}this.top_resourceBar.updateBar({costs:this.moneyType,width:170,gap:70,needAdd:!0})},e.prototype.updateLevelCosts=function(e,t,i){var n=JSON.parse(t.costs);this.gp_cost.removeChildren();var o=u.Config.horseGradeConfigByCode(t.code);if(e)for(var a in o)o[a].level==i+1&&(n=JSON.parse(o[a].costs));var r=0;if(n&&n.length){for(var s=0;s<n.length;s++){var c=new customui.CommonIconWithNum({code:n[s][1],num:n[s][2],style:CommonIconStyle.RIGHT,showEnough:!0});c.scaleX=c.scaleY=1,this.gp_cost.addChild(c);var l=u.GameMVC.backpackPy.getItemNumByCode(n[s][1])>=n[s][2];UIActionManager.setAbsGrey(c,!l),l&&r++}this.isEnoughByLevel=r>=n.length}else this.gp_cost.removeChildren()},e.prototype.updateSkillInfo=function(i,e,t){var n=this,o=u.Config.horseStarConfigByCode(e.code),a=[this.skillItem_0,this.skillItem_1,this.skillItem_2],r=JSON.parse(e.skills);if(0!=t)for(var s in o)if(t==o[s].level){r=JSON.parse(o[s].skills);break}for(var c=JSON.parse(e.skillUnlock),l=function(t){if(r[t]){a[t].updateItem({code:r[t][2]}),a[t].gp_non.visible=!1,a[t].addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){var e="";i<c[t]&&(e=c[t]+"级解锁"),n.skill_panel.visible=!0,n.skill_panel.updateItem({code:r[t][2],tips:e})},h),a[t].addEventListener(egret.TouchEvent.TOUCH_END,function(){n.skill_panel.visible=!1},h),a[t].addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){n.skill_panel.visible=!1},h),a[t].addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){n.skill_panel.visible=!1},h);var e=i<c[t];UIActionManager.setAbsGrey(a[t],e)}else a[t].reset(),a[t].gp_non.visible=!1},h=this,p=0;p<a.length;p++)l(p)},e}(BasePanel);u.MountMainView=e,__reflect(e.prototype,"game.MountMainView");var i=function(t){function e(){var e=t.call(this)||this;return e.py=u.AppFacade.getInstance().retrieveProxy(u.MountPy.N),e.dermaAvatar=void 0,e.skinName="MountItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.head.touchEnabled=!1},e.prototype.dataChanged=function(){var e=this.data;this.dermaAvatar=this.data.config.avatar,this.head.updateData({vo:{avatar:this.dermaAvatar}}),this.img_chose.visible=e.choose,this.img_putOn.visible=e.isUse,UIActionManager.setAbsGrey(this.gp_main,!e.isEnough),this.img_notice.visible=e.isNotice},e.itemWidth=95,e}(eui.ItemRenderer);__reflect(i.prototype,"MountAvatarItem")}(game||(game={})),function(I){var e=function(t){function e(){var e=t.call(this)||this;return e.backpackproxy=I.AppFacade.getInstance().retrieveProxy(I.BackpackPy.N),e.py=I.AppFacade.getInstance().retrieveProxy(I.MountPy.N),e.isEnough=!1,e.info=void 0,e.uuid=void 0,e.skinName="MountUpStarSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.addListener(),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;this.isEnough&&this.uuid?this.py.UpHorseStar(this.uuid,function(){I.AppFacade.getInstance().showSubView(I.MountMediator.N,I.MountMediator.SV.UP_STAR_RESULT,{info:e.info})}):Utils.MsgUtils.addMidMsg("道具不足")},this),this.resource_bar.visible=!0},e.prototype.addListener=function(){this.skill_item.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.showSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_END,this.hideSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.hideSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.hideSkillDetail,this)},e.prototype.initList=function(){this.attr_list.itemRendererSkinName="HeroUpsectionPanel_AttrItem"},e.prototype.updateView=function(e){this.data=e,this.uuid=e.uuid,this.updateInfo()},e.prototype.updateInfo=function(){var e=this.py.allMountByUuid,t=0,o=void 0;for(var i in e)e[i].code==this.data.code&&(t=e[i].starLevel,o=e[i].attr);var n=I.Config.horseStarConfigByCode(this.data.code),a=[],r=void 0,s=void 0;for(var i in n)n[i].level==t?r=n[i]:n[i].level==t+1&&(s=n[i]);var c=t>=n.length-1;if(this.img_max.visible=c,this.img_max0.visible=c,this.btn_up.visible=!c,c)this.showMax(t,r,o);else{var l=JSON.parse(r.attr),h=JSON.parse(s&&s.attr);o=JSON.parse(o);var p=function(e){var t=h[e],i=0;l.forEach(function(e){t[0]==e[0]&&(i=e[1])});var n={desc:AttrConfig[t[0]].name+"：  ",before:Number(o[t[0]]),after:Number(o[t[0]])};n.after=n.before+t[1]-i,n.before=Number(d.getValue(n.before)),n.after=Number(d.getValue(n.after)),a.push(n)},d=this;for(var i in h)p(i);this.attr_list.dataProvider=new eui.ArrayCollection(a);for(var u=JSON.parse(r.skills),g=JSON.parse(s.skills),f=void 0,_=0;_<u.length;_++)u[_][2]!=g[_][2]&&(f=g[_][2]);f?(this.gp_unlock.visible=!0,this.skill_item.updateItem({code:f}),this.skillDetailPanel.updateItem({code:f})):this.gp_unlock.visible=!1,this.gp_cost.removeChildren();var m=0,y=JSON.parse(s.costs);if(y&&y.length){for(_=0;_<y.length;_++){var v=new customui.CommonIconWithNum({code:y[_][1],num:y[_][2],style:CommonIconStyle.RIGHT,showEnough:!0});v.scaleX=v.scaleY=1,this.gp_cost.addChild(v);var T=I.GameMVC.backpackPy.getItemNumByCode(y[_][1])>=y[_][2];UIActionManager.setAbsGrey(v,!T),T&&m++}this.isEnough=m>=y.length}var C=I.GeneralConfig.getHeroStarInfo(t);if(this.gp_now.removeChildren(),C.stage<4)for(_=0;_<C.num;_++){(b=new eui.Image(C.src)).scaleX=b.scaleY=.4,this.gp_now.addChild(b)}else(b=new customui.HighStarLevelIcon(C.num)).scaleX=b.scaleY=.4,this.gp_now.addChild(b);var E=I.GeneralConfig.getHeroStarInfo(t+1);if(this.gp_next.removeChildren(),E.stage<4)for(_=0;_<E.num;_++){var b;(b=new eui.Image(E.src)).scaleX=b.scaleY=.4,this.gp_next.addChild(b)}else(b=new customui.HighStarLevelIcon(E.num)).scaleX=b.scaleY=.4,this.gp_next.addChild(b);UIActionManager.setAbsGrey(this.btn_up,!this.isEnough),this.resource_bar.updateBar(y),this.info={skill:f,dataList:a,starInfo1:C,starInfo2:E}}},e.prototype.showMax=function(e,t,i){this.gp_cost.removeChildren();var n=JSON.parse(i),o=[];for(var a in n){var r=n[a],s={desc:AttrConfig[Number(a)].name+"：  ",before:Number(r),after:""};s.before=Number(this.getValue(s.before)),s.after="",o.push(s)}this.attr_list.dataProvider=new eui.ArrayCollection(o);var c=I.GeneralConfig.getHeroStarInfo(e);if(this.gp_now.removeChildren(),this.gp_next.removeChildren(),c.stage<4)for(var l=0;l<c.num;l++){(r=new eui.Image(c.src)).scaleX=r.scaleY=.4,this.gp_now.addChild(r)}else(r=new customui.HighStarLevelIcon(c.num)).scaleX=r.scaleY=.4,this.gp_now.addChild(r);this.skill_item.visible=!1},e.prototype.getValue=function(e){var t=I.GeneralConfig.getAttrValue(e);return null==Number(t)||isNaN(Number(t))?t:Math.floor(Number(t)).toString()},e.prototype.showSkillDetail=function(){this.skillDetailPanel.visible=!0},e.prototype.hideSkillDetail=function(){this.skillDetailPanel.visible=!1},e}(BasePanel);I.MountUpstarPanel=e,__reflect(e.prototype,"game.MountUpstarPanel")}(game||(game={})),function(e){var t=function(t){function e(){var e=t.call(this)||this;return e.info=void 0,e.skinName="MountUpResultPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},e.prototype.updateView=function(e){var t=e.info;t&&t.skill?(this.gp_skill.visible=!0,this.SkillItem.updateItem({code:t.skill})):this.gp_skill.visible=!1,this.attr_list.itemRenderer=s;var i=t.dataList;this.attr_list.dataProvider=new eui.ArrayCollection(i);var n=t.starInfo1;if(this.gp_now.removeChildren(),n.stage<4)for(var o=0;o<n.num;o++){(r=new eui.Image(n.src)).scaleX=r.scaleY=.5,this.gp_now.addChild(r)}else(r=new customui.HighStarLevelIcon(n.num)).scaleX=r.scaleY=.5,this.gp_now.addChild(r);var a=t.starInfo2;if(this.gp_next.removeChildren(),a.stage<4)for(o=0;o<a.num;o++){var r;(r=new eui.Image(a.src)).scaleX=r.scaleY=.5,this.gp_next.addChild(r)}else(r=new customui.HighStarLevelIcon(a.num)).scaleX=r.scaleY=.5,this.gp_next.addChild(r)},e}(BasePanel);e.MountUpstarResultPanel=t,__reflect(t.prototype,"game.MountUpstarResultPanel");var s=function(t){function e(){var e=t.call(this)||this;return e.skinName="MountUpResultItemSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dataChanged=function(){var e=this.data,t=e.desc.split("：");this.lbl_name.text=t[0]+":",this.lbl_now.text=e.before,this.lbl_next.text=e.after},e}(eui.ItemRenderer);__reflect(s.prototype,"MountUpResultItem")}(game||(game={})),function(o){var e=function(t){function n(e){return void 0===e&&(e=null),t.call(this,n.N,e)||this}return __extends(n,t),n.prototype.initSubView=function(){this.addSubView(n.SV.FREE,o.PeakWarFreeWarView),this.addSubView(n.SV.HIGH,o.PeakWarHighWarView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.PEAK_WAR_FREE_INFO_UPDATED,CN.PEAK_WAR_HIGH_INFO_UPDATED]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:var t=o.GameMVC.peakWarPy;t.initSchedule();var i=t.updateCurType();Utils.UnlockMgr.checkPass(MODULE.PeakWar,!1).allow&&t.GetWarInfo(i);break;case CN.PEAK_WAR_FREE_INFO_UPDATED:NoticeManager.updateNotice(NT.PEAK_WAR),this.updateView(n.SV.FREE);break;case CN.PEAK_WAR_HIGH_INFO_UPDATED:NoticeManager.updateNotice(NT.PEAK_WAR),this.updateView(n.SV.HIGH)}},n.N="PeakWarMed",n.SV={FREE:1,HIGH:2},n}(BaseMediator);o.PeakWarMed=e,__reflect(e.prototype,"game.PeakWarMed")}(game||(game={})),function(i){var e=function(){function e(){}return e.registerAll=function(){(new n).register(),(new t).register()},e}();i.PeakWarProcessor=e,__reflect(e.prototype,"game.PeakWarProcessor");var t=function(e){function t(){return e.call(this,"peakWar.HighLadderInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();i.GameMVC.peakWarPy.updateInfo(PEAK_WAR_TYPE.HIGH,t.info)},t}(i.ProcessorBase);i.HighLadderInfoP=t,__reflect(t.prototype,"game.HighLadderInfoP");var n=function(e){function t(){return e.call(this,"peakWar.NewHighLadderRecordP",t)||this}return __extends(t,e),t.prototype.execute=function(e){e.getBody()},t}(i.ProcessorBase);i.NewHighLadderRecordP=n,__reflect(n.prototype,"game.NewHighLadderRecordP")}(game||(game={})),function(r){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.schedule=Utils.TimerManager.createWeeklySchedule(),e.freeInfo=new r.PWFreeMatchInfoVO,e.highInfo=new r.PWHighMatchInfoVO,e.initNotice(),e}return __extends(i,t),i.prototype.initSchedule=function(){var e=JSON.parse(r.Config.constConfig().PeakWarFreedomTime.constValue),t=JSON.parse(r.Config.entranceTimeConfig()[MODULE.PeakWar].timeConfig);this.schedule.addSchedule(PEAK_WAR_TYPE.FREE,e[0][2],[e[0][0],e[0][1]]),this.schedule.addSchedule(PEAK_WAR_TYPE.HIGH,t[0][2],[t[0][0],t[0][1]]),this.schedule.addSchedule(PEAK_WAR_TYPE.HIGH_WAITING,t[0][2],[[0,0],t[0][0]]),this.schedule.addSchedule(PEAK_WAR_TYPE.HIGH_END,t[0][2],[t[0][1],[24,0]])},i.prototype.initNotice=function(){NoticeManager.setChildType(NT.PEAK_WAR,[NT.PEAK_WAR_CHALLENGE,NT.PEAK_WAR_REWARD_FREE,NT.COMMON_SHOP[ShopType.ShopTypePeakWar]]),NoticeManager.setChildType(NT.PEAK_WAR_REWARD_FREE,[NT.PEAK_WAR_REWARD_FREE_TAB]),NoticeManager.registerCB(NT.PEAK_WAR_CHALLENGE,this.checkChallengeNotice,this,MODULE.PeakWar),NoticeManager.registerCB(NT.PEAK_WAR_REWARD_FREE_TAB,this.checkRewardNotice,this,MODULE.PeakWar)},i.prototype.updateCurType=function(){return this.curType=this.schedule.checkCurrentStatus()[0],this.curType},i.prototype.updateInfo=function(e,t){switch(e){case PEAK_WAR_TYPE.FREE:this.freeInfo.updateData(t),r.AppFacade.getInstance().sendNotification(CN.PEAK_WAR_FREE_INFO_UPDATED);break;case PEAK_WAR_TYPE.HIGH:this.highInfo.updateData(t),r.AppFacade.getInstance().sendNotification(CN.PEAK_WAR_HIGH_INFO_UPDATED)}},i.prototype.GetWarInfo=function(t,i){var e,n=this;switch(t){case PEAK_WAR_TYPE.FREE:e=Utils.Socket.send("peakWar","GetPeakWarFreedomInfo",{});break;case PEAK_WAR_TYPE.HIGH_END:case PEAK_WAR_TYPE.HIGH_WAITING:case PEAK_WAR_TYPE.HIGH:e=Utils.Socket.send("peakWar","GetPeakWarHighLadderInfo",{})}e.then(function(e){n.updateCurType(),n.updateInfo(t,e.info),i&&i()})},i.prototype.Challenge=function(i){var n=this,o=i.type,e=o===PEAK_WAR_TYPE.FREE?"FreedomChallenge":"HighLadderChallenge";r.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypePeakWar,pb1:"peakWar",pb2:e,params:{targetId:i.playerId,rank:i.rank},doneCB:function(e){if(e.cbRet){var t=e.cbRet;n.updateInfo(o,t.info),i.cb&&i.cb(t)}r.GameMVC.fightPy.queueExceExitCB()}})},i.prototype.RefreshChallengeList=function(t,i){var n=this;switch(t){case PEAK_WAR_TYPE.FREE:Utils.Socket.send("peakWar","FreedomRefresh",{}).then(function(e){n.updateInfo(t,e.info),i&&i()});break;case PEAK_WAR_TYPE.HIGH:Utils.Socket.send("peakWar","HighLadderRefresh",{}).then(function(e){n.highInfo.updateChallengeList(e.chalList),i&&i()})}},i.prototype.BuyChallengeTime=function(t){var e,i=this;switch(t.type){case PEAK_WAR_TYPE.FREE:e=Utils.Socket.send("peakWar","FreedomBuyChallenge",{num:t.num});break;case PEAK_WAR_TYPE.HIGH:e=Utils.Socket.send("peakWar","HighLadderBuyChallenge",{num:t.num})}e.then(function(e){i.updateInfo(t.type,e.info),t.cb&&t.cb()})},i.prototype.FreedomGetDailyReward=function(t){var i=this;Utils.Socket.send("peakWar","FreedomGetDailyReward",{code:t.code}).then(function(e){r.GameMVC.backpackPy.handleClientReward(e.clientReward),i.updateInfo(PEAK_WAR_TYPE.FREE,e.info),t.cb&&t.cb()})},i.prototype.BuyRefreshCount=function(e,t){var i=this;Utils.Socket.send("peakWar","FreedomBuyFreCount",{num:e}).then(function(e){i.updateInfo(PEAK_WAR_TYPE.FREE,e.info),t&&t()})},i.prototype.GetHighLadderRecord=function(e){Utils.Socket.send("peakWar","GetHighLadderRecord",{}).then(function(e){})},i.prototype.checkRewardNotice=function(){if(this.curType===PEAK_WAR_TYPE.FREE){var n=this.freeInfo.winCount,o=this.freeInfo.dailyTargeted,a=r.Config.peakWarFreeReward(),e=function(e){var t=a[e],i=t.target;if(o.every(function(e){return e!=t.code})&&i<=n)return{value:!0}};for(var t in a){var i=e(t);if("object"==typeof i)return i.value}return!1}return!1},i.prototype.checkChallengeNotice=function(){return this.curType===PEAK_WAR_TYPE.FREE?0<this.freeInfo.chalCount:this.curType===PEAK_WAR_TYPE.HIGH&&0<this.highInfo.chalCount},i.N="PeakWarPy",i}(BaseProxy);r.PeakWarPy=e,__reflect(e.prototype,"game.PeakWarPy")}(game||(game={})),function(g){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=g.GameMVC.peakWarPy,e.bpProxy=g.GameMVC.backpackPy,e.scoreCode=32500001,e.skinName="PeakWarFreeWarSkin",e}return __extends(e,t),Object.defineProperty(e.prototype,"info",{get:function(){return this.proxy.freeInfo},enumerable:!0,configurable:!0}),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addNotice(),this.initModel(),this.initTimer(),this.activateComponent()},e.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.PEAK_WAR_REWARD_FREE,this.btn_reward.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.COMMON_SHOP[ShopType.ShopTypePeakWar],this.btn_shop.getChildAt(0),this,BTN_ICON_NOTICE_POS)},e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer)},e.prototype.updateView=function(e,t){if(t)this.proxy.GetWarInfo(PEAK_WAR_TYPE.FREE);else{var i=this.info,n=this.bpProxy.getInfoByCode(EPropertyType.EPropertyTypePeakWarMoney);this.blb_honor.text=n.haveNum.toString(),this.blb_score.text=i.grade.toString(),this.blb_rank.text=""+(i.rank||"无排名");for(var o=g.GameMVC.loginPy.serverSelect.area,a=0;a<3;a++){var r=i.chalList[a];if(r){var s=this["gp_challenge_"+a],c=this["lb_name_"+a],l=this["lb_server_"+a],h=this["fightItem_"+a],p=this["blb_reward_"+a];c.text=r.baseInfo.name,l.text=(r.baseInfo.serverId||o)+"服",h.update(r.baseInfo.fightCap),p.text=""+this.calWinScore(r.baseInfo.fightCap);var d=this["img_isChallenged_"+a];this["model_"+a].update({reqStyle:ROLE_STYLE.Fashion,vo:r.baseInfo}),r.isChallenged?(UIActionManager.setAbsGrey(s,!0),d.visible=!0):(UIActionManager.setAbsGrey(s,!1),d.visible=!1)}}this.blb_refreshTimes.text=i.freCount.toString(),this.blb_challengeTimes.text=i.chalCount.toString();var u=g.Config.publicBuyCostConfig(MODULE.PeakWarFreedomRefresh,this.info.buyFreCount);this.btn_buy.updateData({cost:JSON.parse(u.costs)[0],text:"刷新"}),0<i.freCount?(this.btn_refresh.visible=!0,this.btn_buy.visible=!1):(this.btn_refresh.visible=!1,this.btn_buy.visible=!0)}},e.prototype.calWinScore=function(e){var t=[[5e5,1e4,50,1],[2e6,1e4,250,3],[5e6,1e4,700,6],[void 0,1e4,1500,10]],i=0;for(var n in t){var o=t[n];if(!o[0]||e<o[0]){i=Math.ceil((e/o[1]+o[2])/o[3]);break}}return Math.min(i,700)},e.prototype.initModel=function(){for(var e=0;e<3;e++){this["model_"+e].curModelAct=ROLE_ACTION_NAME.DJ}},e.prototype.initTimer=function(){var e=this,t=this.proxy.schedule.getCurrentTimeInterval().endDt;this.dt=t-Utils.TimerManager.getServerTime(),this.blb_time.text=""+Utils.TimerManager.getFormatBySecond1(this.dt),this.timer=egret.setInterval(function(){0<e.dt?e.blb_time.text=""+Utils.TimerManager.getFormatBySecond1(--e.dt):(g.MainJumpConfig.jumpTo(),g.MainJumpConfig.jumpTo(MODULE.PeakWar))},this,1e3)},e.prototype.challengeByIndex=function(e){var t=this.info.chalList[e];0<this.info.chalCount?t.isChallenged||this.proxy.Challenge({type:PEAK_WAR_TYPE.FREE,playerId:t.baseInfo.playerId,cb:function(){}}):Utils.MsgUtils.addMidMsg("挑战次数不足")},e.prototype.showPlayerDetail=function(e){var t=this.info.chalList[e];g.AppFacade.getInstance().showSubView(g.FriendMediator.N,g.FriendMediator.SV.INFO,{playerId:t.baseInfo.playerId})},e.prototype.activateComponent=function(){for(var i=this,e=function(e){t["btn_detail_"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.showPlayerDetail(e)},t),t["model_"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.challengeByIndex(e)},t)},t=this,n=0;n<3;n++)e(n);this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){g.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypePeakWar})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){g.AppFacade.getInstance().showSubView(g.RankMediator.N,g.RankMediator.SV.COMMON,{module:"PEAK_WAR_RANK_FREE"})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){g.AppFacade.getInstance().showSubView(g.RankMediator.N,g.RankMediator.SV.COMMON,{module:"PEAK_WAR_REWARD_FREE"})},this),this.btn_guide.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new g.HelpDialog({moduleId:MODULE.PeakWar})})},this),this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<i.info.freCount&&i.proxy.RefreshChallengeList(PEAK_WAR_TYPE.FREE,function(){Utils.MsgUtils.addMidMsg("刷新成功")})},this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=g.Config.publicBuyCostConfig(MODULE.PeakWarFreedomRefresh,i.info.buyFreCount);g.GameMgr.getInstance().showCommonTipsWin({cost:e.costs,costTips:"，购买一次刷新次数？",source:"PEAK_WAR_FREE_REFRESH",cb:!0,clickCB:function(e){e.type&&i.proxy.RefreshChallengeList(PEAK_WAR_TYPE.FREE,function(){Utils.MsgUtils.addMidMsg("刷新成功")})}})},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.info,t=g.Config.VIPConfig().peakWarFreedomChalBuy;g.GameMVC.commonMed.showCommonBuyNum({moduleId:MODULE.PeakWarFreedomChallenge,hasBuyNum:e.buyChalCount,buyCB:function(e){i.proxy.BuyChallengeTime({type:PEAK_WAR_TYPE.FREE,num:e,cb:function(){Utils.MsgUtils.addMidMsg("购买成功")}})},maxBuyNum:t})},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){g.AppFacade.getInstance().showSubView(g.HeroMediator.N,g.HeroMediator.SV.FORMATION)},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){g.MainJumpConfig.jumpTo()},this)},e}(BaseFull);g.PeakWarFreeWarView=e,__reflect(e.prototype,"game.PeakWarFreeWarView")}(game||(game={})),function(r){var e=function(i){function e(){var e,t=i.call(this)||this;return t.proxy=r.GameMVC.peakWarPy,t.itemArr=[],t.TYPE_TO_DESC=((e={})[PEAK_WAR_TYPE.HIGH]="剩余时间",e[PEAK_WAR_TYPE.HIGH_END]="下次开启",e[PEAK_WAR_TYPE.HIGH_WAITING]="准备开启",e),t.skinName="PeakWarHighWarSkin",t}return __extends(e,i),Object.defineProperty(e.prototype,"info",{get:function(){return this.proxy.highInfo},enumerable:!0,configurable:!0}),e.prototype.initChallengeItem=function(){for(var e=1;e<=6;e++){var t=Math.min(e,4),i=new n;i.currentState=t.toString(),e<=2?this.gp_top.addChild(i):this.gp_bottom.addChild(i),this.itemArr.push(i)}},e.prototype.initTimer=function(){var e=this,t=this.proxy.schedule.getCurrentTimeInterval().endDt;this.dt=t-Utils.TimerManager.getServerTime(),this.updateCountdown(),this.timer||(this.timer=egret.setInterval(function(){0<e.dt?(e.dt-=1,e.updateCountdown()):e.updateView(void 0,!0)},this,1e3))},e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer)},e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.avatar=customui.PlayerHeadFactory.create({vo:r.GameMVC.playerPy.playerInfoVO}),this.gp_avatar.addChild(this.avatar),this.addNotice(),this.initChallengeItem(),this.activateComponent()},e.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.COMMON_SHOP[ShopType.ShopTypePeakWar],this.btn_shop.getChildAt(0),this,BTN_ICON_NOTICE_POS)},e.prototype.updateView=function(e,t){var i=this;t?this.proxy.GetWarInfo(PEAK_WAR_TYPE.HIGH,function(){i.initTimer()}):this.proxy.curType===PEAK_WAR_TYPE.HIGH_END?(Utils.MsgUtils.addMidMsg("天梯赛已结束"),r.MainJumpConfig.jumpTo()):this.realUpdate()},e.prototype.realUpdate=function(){var e=this.info;e.inMatch?(this.blb_fightCap.text=r.GameMVC.playerPy.playerInfoVO.fightCap.toString(),this.blb_rank.text=e.rank.toString(),this.proxy.curType===PEAK_WAR_TYPE.HIGH?(this.gp_challenge.visible=!0,this.blb_challengeTimes.text=e.chalCount.toString()):this.gp_challenge.visible=!1):(this.blb_fightCap.text=r.GameMVC.playerPy.playerInfoVO.fightCap.toString(),this.blb_rank.text="未获得天梯赛参与资格",this.gp_challenge.visible=!1),this.updateChallengeItem()},e.prototype.updateChallengeItem=function(){var a=this;this.proxy.RefreshChallengeList(PEAK_WAR_TYPE.HIGH,function(){var n=r.GameMVC.playerPy.playerInfoVO.playerId,o=a.proxy.highInfo.inMatch&&a.proxy.curType===PEAK_WAR_TYPE.HIGH;a.itemArr.forEach(function(e,t){var i=a.info.chalList[t];i?e.update({info:i,fightCB:function(){0<a.info.chalCount?a.proxy.Challenge({type:PEAK_WAR_TYPE.HIGH,rank:i.rank,cb:function(){a.updateChallengeItem()}}):Utils.MsgUtils.addMidMsg("挑战次数不足")},mopUpCB:function(){},canFight:i.baseInfo.playerId!=n&&o,canMopUp:!1}):e.update()})})},e.prototype.updateCountdown=function(){this.blb_time.text=this.TYPE_TO_DESC[this.proxy.curType]+":"+Utils.TimerManager.getFormatBySecond1(this.dt)},e.prototype.activateComponent=function(){var i=this;this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypePeakWar})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"PEAK_WAR_RANK_HIGH"})},this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.info.inMatch?r.AppFacade.getInstance().showSubView(r.FightMediator.N,r.FightMediator.SV.RECORD,{pb1:"peakWar",pb2:"GetHighLadderRecord",key:"records"}):Utils.MsgUtils.addMidMsg("无战斗记录")},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"PEAK_WAR_REWARD_HIGH"})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new r.HelpDialog({moduleId:MODULE.PeakWar})})},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.info,t=r.Config.VIPConfig().peakWarHighLadderChalBuy;r.GameMVC.commonMed.showCommonBuyNum({moduleId:MODULE.PeakWarHighLadderChallenge,hasBuyNum:e.buyChalCount,buyCB:function(e){i.proxy.BuyChallengeTime({type:PEAK_WAR_TYPE.HIGH,num:e,cb:function(){Utils.MsgUtils.addMidMsg("购买成功")}})},maxBuyNum:t})},this),this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.updateChallengeItem()},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.MainJumpConfig.jumpTo()},this)},e}(BaseFull);r.PeakWarHighWarView=e,__reflect(e.prototype,"game.PeakWarHighWarView");var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.update=function(e){if(e){this.vo=e.info.baseInfo,this.fightCB=e.fightCB,this.mopUpCB=e.mopUpCB;var t=e.info.rank,i=e.canFight,n=e.canMopUp;this.lb_name.text=this.vo.name+"·S"+this.vo.serverId,3<t?(this.blb_rank.visible=!0,this.img_rank.visible=!1,this.blb_rank.text=t.toString()):(this.blb_rank.visible=!1,this.img_rank.visible=!0,this.img_rank.source="jjc_icon_pm_"+t+"_png"),this.cu_playerHead.updateData({vo:this.vo}),this.item_fightCap.update(this.vo.fightCap),this.btn_fight.visible=i,this.btn_mopUp.visible=n}else this.btn_fight.visible=!1,this.btn_mopUp.visible=!1,this.blb_rank.visible=!1,this.img_rank.visible=!1,this.cu_playerHead.img_icon.source="",this.cu_playerHead.blb_level.text="",this.lb_name.text="----",this.item_fightCap.blb_fightCap.text="----"},t}(customui.ArenaPlayerItem);__reflect(n.prototype,"PeakWarHighWarView_ChallengeItem")}(game||(game={})),function(l){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.proxy=l.AppFacade.getInstance().retrieveProxy(l.PetPy.N),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,l.PetMainView),this.addSubView(n.SV.UP_SECTION_PANEL,l.PetUpsectionPanel),this.addSubView(n.SV.ATTR_DETAIL,l.PetAttrDetailsPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.CONFIG_ALL_LOADED,CN.PLAYER_LEVEL_UP]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.PLAYER_LEVEL_UP:l.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_PET);break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.Pet,!1).allow&&this.proxy.GetPetInfo();break;case CN.CONFIG_ALL_LOADED:var t=l.Config.allPetConfig(),i=!0;for(var n in t){var o=(c=t[n]).code,a=l.Config.petSectionConfig(c.subType),r=l.Config.petUpgradeConfig(o);c&&NoticeManager.addCareCost(c.activateCosts,function(){NoticeManager.updateNotice(NT.PET_UPGRADE)}),i&&r[1]&&NoticeManager.addCareCost(r[1].costs,function(){NoticeManager.updateNotice(NT.PET_UPGRADE)}),i&&a[1]&&NoticeManager.addCareCost(a[1].costs,function(){NoticeManager.updateNotice(NT.PET_UPGRADE)}),i=!1}var s=l.Config.petSkillConfig(0,1);for(var n in s){var c=s[n];NoticeManager.addCareCost(c.costs,function(){NoticeManager.updateNotice(NT.PET_SKILL_UPGRADE)})}}},n.N="PetMediator",n.SV={MAIN:1,UP_SECTION_PANEL:2,ATTR_DETAIL:3},n}(BaseMediator);l.PetMediator=e,__reflect(e.prototype,"game.PetMediator")}(game||(game={})),function(e){var t=function(){function e(){}return e.registerAll=function(){},e}();e.PetProcessor=t,__reflect(t.prototype,"game.PetProcessor")}(game||(game={})),function(v){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.petHistory=[],e.localNotice=[],e.localSkillNotice=[],e.localUpgradeNotice=[],e.allPetByUuid={},e.onFormationUuid="",e.addNotice(),e}return __extends(i,t),i.prototype.addNotice=function(){NoticeManager.setChildType(NT.PET,[NT.PET_SKILL_UPGRADE,NT.PET_UPGRADE]),NoticeManager.registerCB(NT.PET_UPGRADE,this.checkNoticeUpgrade,this,MODULE.Pet),NoticeManager.registerCB(NT.PET_SKILL_UPGRADE,this.checkNoticeSkillUpgrade,this,MODULE.Pet)},i.prototype.checkNoticeUpgrade=function(){var h=this,e=v.Config.allPetConfig(),t=[];for(var i in e){var n=e[i];t.push(n)}t.sort(function(e,t){return e.code-t.code});var p=v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N);t.forEach(function(e,t){var i=e.code,n=h.getInfoByCode(i);if(n){var o=v.Config.petSectionConfig(e.subType),a=v.Config.petUpgradeConfig(i),r=o[n.sectionLevel+1],s=0;if(r)s=r.level;else s=a[a.length-1].level;var c=a[n.level+1];if(c)if(n.level==s){var l=JSON.parse(r.costs);p.checkEnough(l)?h.localUpgradeNotice[t]=!0:h.localUpgradeNotice[t]=!1}else{l=JSON.parse(c.costs);p.checkEnough(l)?h.localUpgradeNotice[t]=!0:h.localUpgradeNotice[t]=!1}else h.localUpgradeNotice[t]=!1}else p.checkEnough(JSON.parse(e.activateCosts))?h.localUpgradeNotice[t]=!0:h.localUpgradeNotice[t]=!1});var o=!1;return this.localUpgradeNotice.forEach(function(e){o=e||o}),this.localUpgradeNotice.forEach(function(e,t){h.localNotice[t]=!!h.localUpgradeNotice[t]||!!h.localSkillNotice[t]}),o},i.prototype.checkNoticeSkillUpgrade=function(){var i=this,e=!1;this.localSkillNotice=[];var t=v.Config.allPetConfig(),n=[];for(var o in t){var a=t[o];n.push(a)}for(var r in n.sort(function(e,t){return e.code-t.code}),n){var s=n[r].code,c=this.getInfoByCode(s);if(c){var l=v.Config.allPetConfig()[c.code];if(l)for(var h=c.skillDetailList,p=(v.Config.skillBaseConfig(),["actSkill","posSkill1","posSkill2"]),d=JSON.parse(l.skillUnlock),u=1;u<=3;u++){var g=l[p[u-1]],f=d[u-1]||0;if(g){var _=v.Config.petSkillConfig(l.subType,g),m=h[g]||1;if(c.level>=f){var y=_[m];y&&v.GameMVC.backpackPy.checkEnough(JSON.parse(y.costs),!1)&&(e=this.localSkillNotice[r]=!0)}}}}}return this.localSkillNotice.forEach(function(e,t){i.localNotice[t]=i.localUpgradeNotice[t]||i.localSkillNotice[t]}),e},i.prototype.updatePetDict=function(e,t){var i=this;void 0===t&&(t=!1),Array.isArray(e)||(e=[e]),e.forEach(function(e){if(i.allPetByUuid[e.uuid])i.allPetByUuid[e.uuid].update(e);else{var t=new v.PetVO(e);i.allPetByUuid[e.uuid]=t}e.pos&&(i.onFormationUuid=e.uuid)})},i.prototype.getInfoByCode=function(e){for(var t in this.allPetByUuid){var i=this.allPetByUuid[t];if(i.code==e)return i}},i.prototype.deteleByUuids=function(e){var t=this;e.forEach(function(e){delete t.allPetByUuid[e]})},i.prototype.GetPetInfo=function(){var t=this;Utils.Socket.send("pet","GetPetInfo",{}).then(function(e){t.log("获取宠物信息 GetPetInfoR",e),t.updatePetDict(e.petList),t.petHistory=e.historyList,NoticeManager.updateNotice(NT.PET),v.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_PET)})},i.prototype.PetUpGrade=function(e,t){var i=this;Utils.Socket.send("pet","PetUpGrade",{uuid:e.uuid,num:e.num}).then(function(e){i.log("宠物升级 PetUpGradeR",e),i.updatePetDict(e.pet),v.AppFacade.getInstance().updateView(v.PetMediator.N,v.PetMediator.SV.MAIN),t&&t()})},i.prototype.PetActivate=function(e,t){var i=this;Utils.Socket.send("pet","ActivatePet",{code:e}).then(function(e){i.log("宠物激活 ActivatePetR",e),v.AppFacade.getInstance().updateView(v.PetMediator.N,v.PetMediator.SV.MAIN),i.petHistory=e.historyList,t&&t()})},i.prototype.PetUpSection=function(e,t){var i=this;Utils.Socket.send("pet","PetUpSection",{uuid:e.uuid}).then(function(e){i.log("宠物升阶 PetUpSectionR",e),i.updatePetDict(e.pet),t&&t(),v.AppFacade.getInstance().updateView(v.PetMediator.N,v.PetMediator.SV.MAIN)})},i.prototype.PetPutOn=function(e){var t=this;Utils.Socket.send("pet","PutOnPet",{uuid:e.uuid,pos:1}).then(function(e){t.log("宠物上阵 PutOnPetR",e),t.updatePetDict(e.petList),v.AppFacade.getInstance().updateView(v.PetMediator.N,v.PetMediator.SV.MAIN)})},i.prototype.PetPutDown=function(e){var t=this;Utils.Socket.send("pet","PutDownPet",{uuid:e.uuid}).then(function(e){t.log("宠物下阵 PutDownPetR",e),t.updatePetDict(e.petList),v.AppFacade.getInstance().updateView(v.PetMediator.N,v.PetMediator.SV.MAIN)})},i.prototype.UpGradeSkill=function(e,t){var i=this;Utils.Socket.send("pet","UpGradeSkill",{uuid:e.uuid,code:e.code}).then(function(e){i.log("宠物技能升级 UpGradeSkillR",e),i.updatePetDict(e.pet),t&&t(),NoticeManager.updateNotice(NT.PET_SKILL_UPGRADE),v.AppFacade.getInstance().updateView(v.PetMediator.N,v.PetMediator.SV.MAIN)})},i.N="PetPy",i}(BaseProxy);v.PetPy=e,__reflect(e.prototype,"game.PetPy")}(game||(game={})),function(I){var e=function(o){function e(){var e=o.call(this)||this;e.backpackproxy=I.AppFacade.getInstance().retrieveProxy(I.BackpackPy.N),e.py=I.AppFacade.getInstance().retrieveProxy(I.PetPy.N),e.curSelectIndex=0,e.dataprovider=new eui.ArrayCollection,e.attrItems=new Array,e.timer=0,e.curLevel=0,e.maxLevel=0,e.costs=[[]],e.skinName="PetMainView";var t=I.Config.allPetConfig();for(var i in e.config=[],t){var n=t[i];e.config.push(n)}return e.config.sort(function(e,t){return e.code-t.code}),e}return __extends(e,o),e.prototype.onDestroy=function(){o.prototype.onDestroy.call(this)},e.prototype.childrenCreated=function(){var c=this;o.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.hide()},this),this.list.itemRenderer=a,this.list.dataProvider=this.dataprovider,this.list.addItemTapEvent(function(e){c.dataprovider.getItemAt(c.curSelectIndex).chose=!1,c.curSelectIndex=e.itemIndex,c.dataprovider.getItemAt(c.curSelectIndex).chose=!0,c.dataprovider.refresh(),c.updateBaseInfo(),c.updateServerInfo()},this),this.btn_upgrade.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){Utils.UnlockMgr.checkPass(MODULE.Pet,!1).allow&&(this.timer=egret.setInterval(this.upgradeLogic,this,500)),this.upgradeLogic()},this),this.btn_upgrade.addEventListener(egret.TouchEvent.TOUCH_END,function(){this.timer&&egret.clearInterval(this.timer)},this),this.btn_upgrade.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){this.timer&&egret.clearInterval(this.timer)},this),this.btn_upgrade.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){c.timer&&egret.clearInterval(c.timer)},this),this.btn_master.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=0;for(var t in c.py.allPetByUuid)e+=c.py.allPetByUuid[t].level;I.AppFacade.getInstance().showSubView(I.HeroMediator.N,I.HeroMediator.SV.COMMON_LEVEL_MASTER,{title:"驯兽大师",config:I.Config.petMasterConfig(),totalLevel:e})},this),this.btn_details.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=c.config[c.curSelectIndex];if(e){var t=c.py.getInfoByCode(e.code);if(t){var i=[],n=I.GameMVC.heroPy.allHeroByUuid,o=0;for(var a in n){var r=n[a];0!=r.pos&&(i=I.GeneralConfig.superAttrAddAttr(i,I.GeneralConfig.ObjAttr2Arr(r.attr)),o++)}i=I.GeneralConfig.AttrMutilAttr(i,1/o);var s=I.GeneralConfig.ObjAttr2Arr(JSON.parse(t.skillAttr));i=I.GeneralConfig.superAttrAddAttr(i,s),I.AppFacade.getInstance().showSubView(I.PetMediator.N,I.PetMediator.SV.ATTR_DETAIL,{info:{attr:JSON.stringify(I.GeneralConfig.ArrAttr2Obj(i))}})}}},this),this.btn_putOn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=c.config[c.curSelectIndex];if(e){var t=c.py.getInfoByCode(e.code);t?1==t.pos?c.py.PetPutDown({uuid:t.uuid}):c.py.PetPutOn({uuid:t.uuid}):Utils.MsgUtils.addMidMsg("未拥有")}},this),this.btn_activate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=c.config[c.curSelectIndex];e&&(c.backpackproxy.checkEnough(c.costs)?c.py.PetActivate(e.code,function(){DragonBoneTools.playOnce({effectName:"common_ty_jihuo",parent:c.gp_effect.parent,y:0})}):e.jumpcode?(c.hide(),I.MainJumpConfig.jumpTo(e.jumpcode)):Utils.MsgUtils.addMidMsg("暂无获取途径"))},this),this.btn_skillUp.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=c.config[c.curSelectIndex];if(e){var t=c.py.getInfoByCode(e.code);t?PopUpManager.addPopUp({obj:new r({uuid:t.uuid})}):Utils.MsgUtils.addMidMsg("未激活宠物")}},this);for(var e=function(e){var t=i["skillItem_"+e];t&&(t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.data&&(c.SkillDetailsPanel.visible=!0,c.SkillDetailsPanel.updateItem(t.data))},i),t.addEventListener(egret.TouchEvent.TOUCH_END,function(){c.SkillDetailsPanel.visible=!1},i),t.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){c.SkillDetailsPanel.visible=!1},i),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){c.SkillDetailsPanel.visible=!1},i))},i=this,t=1;t<=3;t++)e(t);this.gp_attr.removeChildren();for(t=1;t<=2;t++){var n=new I.HeroMainView_AttrItem(void 0);this.attrItems[t]=n,this.gp_attr.addChild(n)}},e.prototype.updateView=function(e){NoticeManager.updateNotice(NT.PET);var t=this.config[this.curSelectIndex],i=I.Config.petUpgradeConfig(t.code)[1];this.top_resourceBar.updateBar(i.costs),this.updateBaseInfo(),this.updateServerInfo(),this.updateBottomList()},e.prototype.upgradeLogic=function(){var e=this,t=this.config[this.curSelectIndex];if(t){var i=this.py.getInfoByCode(t.code);i?this.curLevel==this.maxLevel?I.AppFacade.getInstance().showSubView(I.PetMediator.N,I.PetMediator.SV.UP_SECTION_PANEL,{data:i}):this.py.PetUpGrade({uuid:i.uuid,num:1},function(){DragonBoneTools.playUniqueEffect({effectName:"common_ty_dj",parent:e.gp_effect,x:e.gp_effect.width/2,y:e.gp_effect.height/2})}):Utils.MsgUtils.addMidMsg("未拥有宠物")}},e.prototype.updateBaseInfo=function(){var e=this.config[this.curSelectIndex];e&&(this.baseitem_icon.updateData(e),this.lb_name.text=e.name,this.heroModel.update({model:e.model,isStatic:!0}),this.lb_desc.text="    "+(e.desc||"暂无简介"),this.lb_perfession.text=e.name)},e.prototype.updateServerInfo=function(){var t=this,e=this.config[this.curSelectIndex];if(e){var i=I.Config.petSectionConfig(e.subType),n=I.Config.petUpgradeConfig(e.code),o=this.py.getInfoByCode(e.code),a=!!o;UIActionManager.setAbsGrey(this.heroModel,!a),o?(this.gp_fight.visible=!0,this.blb_fightCap.text=o.fightCap.toString(),this.btn_details.visible=!0,this.btn_skillUp.visible=!0):(o=new I.PetVO({code:e.code,level:0,sectionLevel:0,attr:n[1].attr,fightCap:0}),this.gp_fight.visible=!1,this.btn_skillUp.visible=!1,this.btn_details.visible=!1);for(var r=JSON.parse(e.skillUnlock),s=o.skillDetailList,c=["actSkill","posSkill1","posSkill2"],l=1;l<=3;l++){var h=this["skillItem_"+l],p=this["img_lock"+l],d=e[c[l-1]],u=r[l-1]||0;if(h)if(d){var g=I.Config.petSkillConfig(e.subType,d);p&&(p.visible=!1);var f=g[(s[d]||1)-1];h.updateItem({code:f.skill}),UIActionManager.setAbsGrey(h,o.level<u)}else p&&(p.visible=!0),h&&h.reset()}var _=JSON.parse(o.attr),m={};Array.isArray(_)?_.forEach(function(e){m[e[0]]=e[1]}):m=_;l=1;for(var y=1;l<=4&&y<=2;l++)null!=m[l]&&(this.attrItems[y].updateItem({type:l,num:m[l]||0}),y++);var v=i[o.sectionLevel+1],T=0;if(v)T=v.level;else T=n[n.length-1].level;if(this.lb_level.text=o.level+"/"+T,this.curLevel=o.level,this.maxLevel=T,a){this.btn_activate.visible=!1,this.btn_putOn.visible=!0;var C=n[o.level+1];if(C){if(this.btn_upgrade.visible=!0,this.curLevel==this.maxLevel)this.btn_maxLevel.visible=!0,this.gp_cost.visible=!1,this.btn_upgrade.label="",this.btn_upgrade.skinName="skins.ButtonSkinYellow",this.btn_upgrade.label="进阶";else{this.btn_maxLevel.visible=!1,this.gp_cost.visible=!0,this.btn_upgrade.label="",this.btn_upgrade.skinName="skins.ButtonSkinGreen",this.btn_upgrade.label="升级";var E=JSON.parse(C.costs);this.gp_cost.removeChildren(),E.forEach(function(e){t.gp_cost.addChild(new customui.CommonIconWithNum({cost:e,style:CommonIconStyle.RIGHT}))})}this.btn_maxLevel.bottom=77}else this.btn_upgrade.visible=!1,this.gp_cost.visible=!1,this.btn_maxLevel.visible=!0,this.btn_maxLevel.bottom=41;this.lb_way.text=""}else{this.btn_activate.visible=!0,this.btn_maxLevel.visible=!1,this.btn_upgrade.visible=!1;E=JSON.parse(e.activateCosts);var b=I.AppFacade.getInstance().retrieveProxy(I.BackpackPy.N);this.btn_activate.updateData({text:"激活"}),b.checkEnough(E)?(this.lb_way.text="",UIActionManager.setGrey(this.btn_activate,!1)):this.lb_way.text=""+(e.wayDesc||"暂无获取途径"),this.costs=E,this.gp_cost.visible=!1,this.btn_putOn.visible=!1}1==o.pos?(this.btn_putOn.icon="_btn_lb_m_json.common_icon_xiuxi",this.btn_putOn.label="休息"):(this.btn_putOn.label="出战",this.btn_putOn.icon="_btn_lb_m_json.common_icon_chuzhan"),this.img_skillNotice.visible=this.py.localSkillNotice[this.curSelectIndex]}},e.prototype.updateBottomList=function(){var e=[],t=I.AppFacade.getInstance().retrieveProxy(I.BackpackPy.N);for(var i in this.config){var n=this.config[i],o=n.code,a=this.py.getInfoByCode(o),r={chose:!1,activate:!1,code:o,uuid:void 0,level:void 0,puton:!1,canActivate:!1,activateCosts:n.activateCosts,notice:!1};a?(r.activate=!0,r.uuid=a.uuid,r.level=a.level,1==a.pos?(r.puton=!0,this.initComplete||(this.curSelectIndex=parseInt(i))):r.puton=!1,r.canActivate=!1):(t.checkEnough(JSON.parse(r.activateCosts))?r.canActivate=!0:r.canActivate=!1,r.activate=!1,r.puton=!1),r.notice=this.py.localNotice[i],e.push(r)}e[this.curSelectIndex].chose=!0,this.dataprovider.replaceAll(e),this.initComplete||(this.list.validateNow(),this.initComplete=!0,this.list.changeTo({itemIndex:this.curSelectIndex}))},e}(BasePanel);I.PetMainView=e,__reflect(e.prototype,"game.PetMainView");var a=function(t){function e(){var e=t.call(this)||this;return e.skinName="PetItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseitem.touchEnabled=!1},e.prototype.dataChanged=function(){this.baseitem.updateData(this.data),this.img_putOn.visible=!1,this.data.activate?(UIActionManager.setGrey(this.gp_main,!1),this.data.puton&&(this.img_putOn.visible=!0)):this.data.canActivate?UIActionManager.setGrey(this.gp_main,!0):UIActionManager.setAbsGrey(this.gp_main,!0),this.img_notice.visible=!!this.data.notice,this.img_chose.visible=!!this.data.chose},e.itemWidth=101,e.choseScale=.85,e}(eui.ItemRenderer);__reflect(a.prototype,"PetItem");var r=function(i){function e(e){var t=i.call(this)||this;return t.py=I.AppFacade.getInstance().retrieveProxy(I.PetPy.N),t.seleceCode=1,t.skinName="PetSkillUpgradePanel",t.params=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.btn_upgrade.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.py.UpGradeSkill({uuid:e.params.uuid,code:e.seleceCode},function(){e.updateView(),DragonBoneTools.playUniqueEffect({effectName:"common_ty_dj",parent:e,x:e.width/2,y:e.height/2})})},this),this.updateView()},e.prototype.updateView=function(){var l=this;if(this.params&&this.params.uuid){var h=this.py.allPetByUuid[this.params.uuid];if(h){var p=I.Config.allPetConfig()[h.code];if(p){var d=h.skillDetailList,u=I.Config.skillBaseConfig(),g=["actSkill","posSkill1","posSkill2"];UIActionManager.setGrey(this.btn_upgrade,!1),this.btn_upgrade.touchEnabled=!0;for(var f=JSON.parse(p.skillUnlock),e=function(e){var t=_["skillItem"+(e-1)],i=p[g[e-1]],n=f[e-1]||0;if(t)if(i){var o=I.Config.petSkillConfig(p.subType,i),a=d[i]||1,r=o[a-1];if(t.updateItem({code:r.skill,notNeedLevel:!0}),h.level>=n){if(t.hasEventListener(egret.TouchEvent.TOUCH_TAP)||t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.seleceCode!=e&&(l.seleceCode=e,l.img_select.horizontalCenter=103*(e-2),l.updateView())},_),e==_.seleceCode){if(_.CommonResourceBar.updateBar(o[1].costs),u[r.skill]){var s=u[r.skill];_.lb_nameBefore.text=s.name,_.lb_descBefore.text=s.desc,_.lb_levelBefore.text=a}var c=o[a];if(c){s=u[c.skill];_.lb_nameNew.text=s.name,_.lb_descNew.text=s.desc,_.lb_levelNew.text=a+1,_.gp_right.visible=!0,_.img_full.visible=!1,_.CommonIconWithNum.visible=!0,_.CommonIconWithNum.updateItem({cost:JSON.parse(c.costs)[0],style:CommonIconStyle.RIGHT})}else _.CommonIconWithNum.visible=!1,_.gp_right.visible=!1,_.img_full.visible=!0,UIActionManager.setGrey(_.btn_upgrade,!0),_.btn_upgrade.touchEnabled=!1}}else UIActionManager.setAbsGrey(t,!0),t.hasEventListener(egret.TouchEvent.TOUCH_TAP)||t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.MsgUtils.addMidMsg(n+"级解锁")},_)}else t&&t.reset()},_=this,t=1;t<=3;t++)e(t)}}}},e}(BasePanel);__reflect(r.prototype,"PetSkillUpgradePanel");var t=function(n){function e(){return null!==n&&n.apply(this,arguments)||this}return __extends(e,n),e.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this);var e=new eui.Group;e.horizontalCenter=0,e.bottom=-80;var t=new eui.Image;t.source="maoxian_img_kaicaidi_png",t.scaleX=t.scaleY=.5,t.horizontalCenter=t.verticalCenter=0,e.addChild(t);var i=new eui.Label("注：宠物属性为出战英雄的平均属性");i.size=20,i.horizontalCenter=i.verticalCenter=0,e.addChild(i),this.gp_root.addChild(e)},e}(I.HeroAttrDetailsPanel);I.PetAttrDetailsPanel=t,__reflect(t.prototype,"game.PetAttrDetailsPanel")}(game||(game={})),function(v){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="HeroUpsectionSkin",e.petPy=v.AppFacade.getInstance().retrieveProxy(v.PetPy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.addListener(),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;this.petPy.PetUpSection({uuid:this.data.uuid},function(){e.hide()})},this),this.resource_bar.visible=!0},e.prototype.addListener=function(){this.skill_item.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.showSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_END,this.hideSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.hideSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.hideSkillDetail,this)},e.prototype.initList=function(){this.attr_list.itemRendererSkinName="HeroUpsectionPanel_AttrItem"},e.prototype.updateView=function(e){var t=this;this.data=e.data;this.data.level;var i=v.Config.allPetConfig()[this.data.code],n=v.Config.petSectionConfig(i.subType),o=v.Config.petUpgradeConfig(this.data.code),a=n[this.data.sectionLevel+1],r=n[this.data.sectionLevel],s=n[this.data.sectionLevel+2],c=[],l=0;for(var h in o){var p=o[h];p.level>l&&(l=p.level)}c.push({desc:"等级上限：",before:a.level,after:Math.min(l,s&&s.level||9999999)});var d=JSON.parse(a.attr),u=JSON.parse(r&&r.attr),g=JSON.parse(this.data.attr),f=function(e){var t=d[e],i=0;u.forEach(function(e){t[0]==e[0]&&(i=e[1])});var n={desc:AttrConfig[t[0]].name+"：",before:g[t[0]],after:g[t[0]]};n.after=n.before+t[1]-i,n.before=_.getValue(n.before),n.after=_.getValue(n.after),c.push(n)},_=this;for(var h in d)f(h);this.attr_list.dataProvider=new eui.ArrayCollection(c);var m=a.skill;m?(this.gp_unlock.visible=!0,this.skill_item.updateItem({code:m}),this.skillDetailPanel.updateItem({code:m})):this.gp_unlock.visible=!1;var y=JSON.parse(a.costs);this.resource_bar.updateBar(y),y.forEach(function(e){t.gp_cost.addChild(new customui.CommonIconWithNum({cost:e,showEnough:!0,style:CommonIconStyle.RIGHT}))})},e.prototype.getValue=function(e){var t=v.GeneralConfig.getAttrValue(e);return null==Number(t)||isNaN(Number(t))?t:Math.floor(Number(t)).toString()},e.prototype.showSkillDetail=function(){this.skillDetailPanel.visible=!0},e.prototype.hideSkillDetail=function(){this.skillDetailPanel.visible=!1},e}(BasePanel);v.PetUpsectionPanel=e,__reflect(e.prototype,"game.PetUpsectionPanel")}(game||(game={})),function(e){var t=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return NoticeManager.setChildType(NT.CITY_PVP_ENTRANCE,[NT.ARENA]),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.ENTRANCE,e.PvpEntranceView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_LOADING,CN.PLAYER_LEVEL_UP]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_LOADING:this.hideAllSubView();break;case CN.PLAYER_LEVEL_UP:NoticeManager.updateNotice(NT.CITY_PVP_ENTRANCE)}},n.N="PvpEntranceMediator",n.SV={ENTRANCE:1},n}(BaseMediator);e.PvpEntranceMediator=t,__reflect(t.prototype,"game.PvpEntranceMediator")}(game||(game={})),function(e){var t=function(){function e(){}return e.registerAll=function(){},e}();e.PvpEntranceProcessor=t,__reflect(t.prototype,"game.PvpEntranceProcessor")}(game||(game={})),function(e){var t=function(e){function t(){return e.call(this,t.N)||this}return __extends(t,e),t.N="PvpEntrancePy",t}(BaseProxy);e.PvpEntrancePy=t,__reflect(t.prototype,"game.PvpEntrancePy")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.ENTRANCE_CONFIG={ARENA:{desc:"竞技场",rankingType:void 0,moduleId:MODULE.Arena,bg:"wfrk_img_rukou_jjc_png",descDown:"可获取竞技币、兑换道具和碎片",notice:NT.ARENA},TEAM_ARENA:{desc:"组队竞技场",rankingType:void 0,moduleId:MODULE.TeamArena,bg:"wfrk_img_rukou_zdjj_png",descDown:"",notice:NT.TEAM_ARENA_ENTRANCE},PEAK_WAR:{desc:"巅峰竞技场",rankingType:void 0,moduleId:MODULE.PeakWar,bg:"wfrk_img_rukou_dfjjc_png",descDown:"可获取主角和时装培养资源",notice:NT.PEAK_WAR,shopType:ShopType.ShopTypePeakWar},WORLD_KING:{desc:"排位赛",rankingType:void 0,moduleId:MODULE.WorldKing,bg:"wfrk_img_rukou_pws_png",descDown:"",notice:NT.WORLD_KING}},e.skinName="PvpEntranceViewSkin",Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_view_close),e._popActionType=5,e._removeActionType=6,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.img_title.source="wfrk_txt_jjtz_png"},e.prototype.initList=function(){this.item_list=new eui.List;var e=new eui.VerticalLayout;(this.item_list.layout=e).gap=10,e.horizontalAlign=egret.HorizontalAlign.CENTER,this.item_list.itemRenderer=i,this.scroller.viewport=this.item_list},e.prototype.updateView=function(){var e=[];for(var t in this.ENTRANCE_CONFIG)this.ENTRANCE_CONFIG[t].view=this,e.push(this.ENTRANCE_CONFIG[t]);this.item_list.dataProvider=new eui.ArrayCollection(e),this.gp_root.height=179*e.length+10*(e.length-1)},e}(BasePanel);a.PvpEntranceView=e,__reflect(e.prototype,"game.PvpEntranceView");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="EntranceView_ListItem",e.once(egret.Event.REMOVED_FROM_STAGE,e.onDestroy,e),e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.MainJumpConfig.jumpTo(this.data.moduleId)?a.AppFacade.getInstance().hideSubView(a.PvpEntranceMediator.N,a.PvpEntranceMediator.SV.ENTRANCE):(this.gp_bg.scaleX=1,this.gp_bg.scaleY=1)},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.currentState="up"},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.shopType&&a.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:e.shopType})},this)},e.prototype.dataChanged=function(){this.img_bg.source=this.data.bg,this.lb_unlock.text=this.data.descDown||"",this.data.notice&&NoticeManager.addNoticeListener(this.data.notice,this.gp_bg,this.data.view,{percentX:554/578,percentY:0});var e=Utils.UnlockMgr.checkPass(this.data.moduleId,!1);if(e.allow)switch(this.data.moduleId){case MODULE.TeamArena:this.countdownForTeamArena();break;case MODULE.WorldKing:this.countdownForWorldKing();break;case MODULE.PeakWar:this.countdownForPeakWar()}else UIActionManager.setAbsGrey(this,!0),e.ext&&"server"!=e.ext.lockType&&(this.lb_unlock.text=e.ext.tips.replace("解锁","开启"));this.data.shopType?(this.shopType=this.data.shopType,this.btn_shop.visible=!0):this.btn_shop.visible=!1,this.data.notice&&NoticeManager.addNoticeListener(this.data.notice,this.gp_bg,this.data.view,{percentX:554/578,percentY:0})},e.prototype.getRemainingTime=function(e){return Utils.TimerManager.getFormatBySecond1(e)},e.prototype.countdownForTeamArena=function(){var e=this;this.gp_time.visible=!0;var t=a.GameMVC.battleZoneArenaPy.getOpenInfo();this.timerDt=t.remainingTime;var i=t.isOpen;this.lb_miaoshu.text=i?"结束倒计时：":"开启倒计时：",this.blb_time.text=this.getRemainingTime(this.timerDt),UIActionManager.setAbsGrey(this.gp_bg,!i),this.gp_bg.touchEnabled=i,this.endingTimer||(this.endingTimer=egret.setInterval(function(){0<=e.timerDt?e.blb_time.text=e.getRemainingTime(--e.timerDt):(egret.clearInterval(e.endingTimer),e.dataChanged())},this,1e3))},e.prototype.countdownForWorldKing=function(){var e=this,t=a.AppFacade.getInstance().retrieveProxy(a.WorldKingPy.N).getOpenInfo(),i=Utils.TimerManager.getServerTime(!1),n=t.latestEndDt-i,o=t.latestOpenDt-i;this.gp_time.visible=!0,0<o?(this.gp_bg.touchEnabled=!1,this.lb_miaoshu.text="开启倒计时：",this.timerDt=n,this.blb_time.text=this.getRemainingTime(o),UIActionManager.setAbsGrey(this.gp_bg,!0)):(this.gp_bg.touchEnabled=!0,this.lb_miaoshu.text="结束倒计时：",this.timerDt=n,this.blb_time.text=this.getRemainingTime(n),UIActionManager.setAbsGrey(this.gp_bg,!1)),this.endingTimer||(this.endingTimer=egret.setInterval(function(){0<=e.timerDt?e.blb_time.text=""+e.getRemainingTime(--e.timerDt):(e.countdownForWorldKing(),e.endingTimer&&egret.clearTimeout(e.endingTimer))},this,1e3))},e.prototype.onDestroy=function(){egret.clearInterval(this.endingTimer),egret.clearInterval(this.endingTimer1),egret.clearInterval(this.startTimer)},e.prototype.countdownForPeakWar=function(){a.GameMVC.peakWarPy.curType===PEAK_WAR_TYPE.HIGH_END?(this.lb_unlock.text="当前已结束",UIActionManager.setAbsGrey(this.gp_bg,!0)):(this.lb_unlock.text=this.data.descDown,UIActionManager.setAbsGrey(this.gp_bg,!1))},e}(eui.ItemRenderer);__reflect(i.prototype,"EntranceView_ListItem")}(game||(game={})),function(d){var e=function(o){function e(){var e=o.call(this)||this;return e.id2Uuids={},e.allEquipsNum={},e.heroThingPy=d.AppFacade.getInstance().retrieveProxy(d.HeroThingPy.N),e.skinName="EquipCompound",e}return __extends(e,o),e.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="装备合成",this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF;var t=this.heroThingPy.AllEquipInfo;for(var i in t){var n=t[i];this.allEquipsNum[i]=n.num}this.list_root.itemRenderer=a,this.updateView()},e.prototype.updateView=function(){var r=this,t=[],i=d.Config.HeroEquipCompound(),e=function(e){var a=i[e];if(1!=a.type)return"continue";a.selectUuids=n.id2Uuids[a.id]||[],a.onSelect=function(e,t){r.onSelect(e,t)},a.btnFunc=function(){var e={};for(var t in r.id2Uuids[a.id]){e[n=(n=r.id2Uuids[a.id][t]).split("#")[0]]?e[n]++:e[n]=1}var i=[];for(var n in e){var o=e[n];i.push({equipUuid:n,num:o})}r.heroThingPy.HeroEquipCompound({id:a.id,uuidInfos:i,type:1,cb:function(){r.onSelect([],0),r.updateView()}})},t.push(a)},n=this;for(var o in i)e(o);this.list_root.dataProvider?this.list_root.dataProvider.replaceAll(t):this.list_root.dataProvider=new eui.ArrayCollection(t)},e.prototype.onSelect=function(e,t){for(var i in void 0===e&&(e=[]),this.id2Uuids)this.id2Uuids[i]=[];this.id2Uuids[t]=e,this.updateView()},e}(BasePanel);d.EquipCompound=e,__reflect(e.prototype,"game.EquipCompound");var a=function(t){function e(){var e=t.call(this)||this;return e.skinName="EquipCompoundItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.data,t=!0,i=JSON.parse(e.costs);((!this.data.num||this.data.selectUuids.length<this.data.num)&&(t=!1),0<i.length)&&(d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N).checkEnough(i,!1)||(t=!1));t?this.btnFunc&&this.btnFunc(this.data):Utils.MsgUtils.addMidMsg("材料不足")},this);var e=new eui.HorizontalLayout;e.verticalAlign="middle",e.gap=0,this.gp_rewards.layout=e},e.prototype.dataChanged=function(){var r=this,e=this.data;this.gp_rewards.removeChildren();var t=JSON.parse(e.costs),i=d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N);if(this.data.color&&this.data.num){var n=new u({targetNum:this.data.num,color:this.data.color,num:this.data.selectUuids.length});n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new d.CommonChosePanel({getInfos:function(){var e=d.AppFacade.getInstance().retrieveProxy(d.HeroThingPy.N).AllEquipInfo,t=d.Config.getHeroEquipConfig(),i={};for(var n in e){var o=e[n];if(t[o.code]&&t[o.code].color==r.data.color&&!o.heroUuid)for(var a=0;a<o.num;a++)i[o.uuid+"#"+a]=o}return i},type:EEntityType.EEntityTypeHeroEquip,uniNum:!0,checkFull:function(e){return e.length>=r.data.num},selectUuids:r.data.selectUuids,title:"请选择材料装备"}),closeCB:function(e){e&&r.data.onSelect(e,r.data.id)}})},this),this.gp_rewards.addChild(n)}if(0<t.length){var o=new eui.Image("common_img_jia_png");this.gp_rewards.addChild(o);for(var a=0;a<t.length-1;a++){var s;(s=customui.BaseItemFactory.create()).scaleX=s.scaleY=.7,s.updateData({reward:t[a]});var c=i.getInfoByCode(t[a][1]).haveNum;s.blb_num.text=c+"/"+t[a][2],c>=t[a][2]?UIActionManager.setAbsGrey(s,!1):UIActionManager.setAbsGrey(s,!0),this.gp_rewards.addChild(s);var l=new eui.Image("common_img_jia_png");this.gp_rewards.addChild(l)}(s=customui.BaseItemFactory.create()).scaleX=s.scaleY=.7,s.updateData({reward:t[t.length-1]}),this.gp_rewards.addChild(s);c=i.getInfoByCode(t[t.length-1][1]).haveNum;s.blb_num.text=c+"/"+t[t.length-1][2],c>=t[t.length-1][2]?UIActionManager.setAbsGrey(s,!1):UIActionManager.setAbsGrey(s,!0)}var h=new eui.Image("newactivity_img_denghao_png");this.gp_rewards.addChild(h),JSON.parse(e.rewards).forEach(function(e,t){var i=customui.BaseItemFactory.create();i.scaleX=i.scaleY=.7,i.updateData({reward:e}),r.gp_rewards.addChild(i)}),this.btnFunc=e.btnFunc;var p=!0;((!this.data.num||this.data.selectUuids.length<this.data.num)&&(p=!1),0<t.length)&&(d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N).checkEnough(t,!1)||(p=!1));UIActionManager.setAbsGrey(this.btn_operate,!p)},e}(eui.ItemRenderer);__reflect(a.prototype,"EquipCompoundItem");var u=function(i){function e(e){var t=i.call(this)||this;return t.data=e,t.skinName="EquipCompoundCostItem",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.baseitem.touchEnabled=!1,UIActionManager.fadeBlink(this.img_jia,!0,!1,1e3),this.updateItem(this.data)},e.prototype.findRandomEquip=function(e){var t=d.Config.getHeroEquipConfig();for(var i in t){if(t[i].color==e)return Number(i)}},e.prototype.updateItem=function(e){if(e)if(e.targetNum){this.bm_num.text=e.num+"/"+e.targetNum;var t=e.color;this.baseitem.updateData({code:this.findRandomEquip(t)}),this.baseitem.img_icon.source="equip_ty_"+t+"_png",e.num>=e.targetNum?UIActionManager.setGrey(this.gp_main,!1):UIActionManager.setGrey(this.gp_main,!0);var i=d.AppFacade.getInstance().retrieveProxy(d.HeroThingPy.N),n=0,o=d.Config.getHeroEquipConfig();for(var a in i.AllEquipInfo){var r=i.AllEquipInfo[a];o[r.code]&&o[r.code].color==e.color&&!r.heroUuid&&(n+=r.num)}n>=e.targetNum&&e.num<e.targetNum?this.img_jia.visible=!0:this.img_jia.visible=!1}else{this.baseitem.updateData({reward:e.costs}),d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N).checkEnough([e.costs],!1)?UIActionManager.setGrey(this.gp_main,!1):UIActionManager.setGrey(this.gp_main,!0)}},e}(eui.Component);__reflect(u.prototype,"EquipCompoundCostItem")}(game||(game={})),function(c){var e=function(i){function e(){var e,t=i.call(this)||this;return t.proxy=c.AppFacade.getInstance().retrieveProxy(c.SmithyPy.N),t.curType=EEntityType.EEntityTypeHeroEquip,t.chosenList=new Array,t.curIndex=1,t.heroPy=c.AppFacade.getInstance().retrieveProxy(c.HeroPy.N),t.backpackPy=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N),t.MAX_NUM=20,t.DECOMPOSE_TYPE_CONFIG=((e={})[EEntityType.EEntityTypeHeroEquip]={name:"装备",getAllInfo:function(){var e=c.AppFacade.getInstance().retrieveProxy(c.HeroThingPy.N),t=[],i=c.Config.getHeroEquipConfig();for(var n in e.AllEquipInfo){var o=e.AllEquipInfo[n];i[o.code]&&!i[o.code].canDecompose&&t.push(o)}return t},filterConfig:{data:[[{color:2,icon:"beibao_btn_pinzhi_2_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:3,icon:"beibao_btn_pinzhi_3_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:4,icon:"beibao_btn_pinzhi_4_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:5,icon:"beibao_btn_pinzhi_5_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:6,icon:"beibao_btn_pinzhi_6_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"}]],filterFunc:function(e,t){return!e||!e.color||0==e.color.length||-1!=e.color.indexOf(t.config.color)},addFilter:function(e,t){var i="color";e[i]||(e[i]=[]);var n=e[i].indexOf(t[i]);-1==n?(e[i].splice(0),e[i].push(t[i])):e[i].splice(n,1)},autoFilterFunc:function(e){return e.config.color<=3},autoFilterTips:"无紫色品质以下装备"},checdkChoosabel:function(e){return""==e.heroUuid},sortFunc:function(e,t){var i=e.info,n=t.info,o=""!=i.heroUuid;return o!=(""!=n.heroUuid)?o?1:-1:i.config.color!=n.config.color?i.config.color-n.config.color:i.code!=n.code?i.code-n.code:i.level-n.level}},e[EEntityType.EEntityTypeHeroArtifact]={name:"圣物",getAllInfo:function(){var e=c.AppFacade.getInstance().retrieveProxy(c.HeroThingPy.N),t=[],i=c.Config.getHeroArtifactConfig();for(var n in e.AllArtiInfo){var o=e.AllArtiInfo[n];i[o.code]&&5<=i[o.code].color&&i[o.code].decomposeRewards&&t.push(o)}return t},filterConfig:{data:[[{color:2,icon:"beibao_btn_pinzhi_2_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:3,icon:"beibao_btn_pinzhi_3_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:4,icon:"beibao_btn_pinzhi_4_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:5,icon:"beibao_btn_pinzhi_5_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:6,icon:"beibao_btn_pinzhi_6_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"}]],filterFunc:function(e,t){return!e||!e.color||0==e.color.length||-1!=e.color.indexOf(t.config.color)},addFilter:function(e,t){var i="color";e[i]||(e[i]=[]);var n=e[i].indexOf(t[i]);-1==n?(e[i].splice(0),e[i].push(t[i])):e[i].splice(n,1)},autoFilterFunc:function(e){return e.config.color<=3},autoFilterTips:"无紫色品质以下装备"},checdkChoosabel:function(e){return""==e.heroUuid},sortFunc:function(e,t){var i=e.info,n=t.info,o=""!=i.heroUuid;return o!=(""!=n.heroUuid)?o?1:-1:i.config.color!=n.config.color?i.config.color-n.config.color:i.code!=n.code?i.code-n.code:i.level-n.level}},e),Utils.AssetsMgr.loadGroup("group_smithy"),t.skinName="SmithyMainView",t.curFilter={},t}return __extends(e,i),e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_smithy")},e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.initial(),this.initList(),this.initTabbar(),this.btn_shop.visible=!0,this.btn_preview.visible=!1,DragonBoneTools.create("common_shenqixulizhong",function(e){t.eff_jindutiao=e,t.eff_jindutiao.visible=!1,t.gp_pb_fade.addChild(e),e.animation.play("common_shenqixulizhong")}),UIActionManager.addEffect(this.gp_effect,"zhujiemian_ar",{scaleX:1.3,scaleY:1.3},function(e){e&&e.animation.play("zhujiemian_ar_daiji2")}),this.activateComponent(),NoticeManager.addNoticeListener(NT.HERO_THING_COMPOUND,this.btn_shop.$children[0],this,BTN_ICON_NOTICE_POS),this.rb_baseItem=customui.BaseItemFactory.create(),this.rb_baseItem.touchEnabled=!1,this.gp_rb_baseItem.addChildAt(this.rb_baseItem,0),UIActionManager.fadeBlink(this.img_rb_add,!0,!1,1e3)},e.prototype.initial=function(){var i=this;this.targetConfig=this.DECOMPOSE_TYPE_CONFIG[this.curType],this.chosenList.splice(0);var e=c.Config.getHeroEquipConfig(),t=[];for(var n in e){var o=e[n];o.isShow&&t.push(o)}t.sort(function(e,t){return e.isShow!=t.isShow?e.isShow-t.isShow:e.code-t.code}),t.forEach(function(e){var t=customui.BaseItemFactory.create();c.Config.getHeroEquipUpgradeConfig(e.code),c.Config.getHeroEquipEnchantConfig(e.code),e.code,EEntityType.EEntityTypeHeroEquip;t.updateData({code:e.code}),t.scaleX=t.scaleY=.7,i.gp_topEquips.addChild(t)}),this.initFilter()},e.prototype.initList=function(){this.list_item.itemRenderer=t,this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.itemList_onItemTap,this)},e.prototype.initTabbar=function(){var e=this;this.btn_2smithy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1!=e.curIndex&&(e.updateView({index:1}),e.btn_2smithy.icon="tjp_btn_dazao1_png",e.btn_2decompose.icon="tjp_btn_ronglian0_png",e.btn_2fenjie.icon="tjp_btn_huanyuan0_png",e.btn_shop.visible=!0,e.btn_preview.visible=!1,e.btn_auto.visible=!0,e.btn_decompose.horizontalCenter=125)},this),this.btn_2decompose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){2!=e.curIndex&&(e.updateView({index:2}),e.btn_2smithy.icon="tjp_btn_dazao0_png",e.btn_2decompose.icon="tjp_btn_ronglian1_png",e.btn_2fenjie.icon="tjp_btn_huanyuan0_png",e.btn_decompose.label="熔炼",e.gp_jindu.visible=!0,e.gp_filter.visible=!0,e.btn_shop.visible=!0,e.btn_preview.visible=!1,e.btn_auto.visible=!0,e.btn_decompose.horizontalCenter=125)},this),this.btn_2fenjie.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.UnlockMgr.checkPass(MODULE.HeroArtifactDecompose).allow&&3!=e.curIndex&&(e.updateView({index:3}),e.btn_2smithy.icon="tjp_btn_dazao0_png",e.btn_2decompose.icon="tjp_btn_ronglian0_png",e.btn_2fenjie.icon="tjp_btn_huanyuan1_png",e.btn_decompose.label="分解",e.gp_jindu.visible=!1,e.gp_filter.visible=!1,e.btn_shop.visible=!1,e.btn_preview.visible=!0,e.btn_auto.visible=!1,e.btn_decompose.horizontalCenter=0)},this)},e.prototype.initFilter=function(){var n=this;this.gp_filters_list.removeChildren();var e=this.targetConfig.filterConfig.data;e&&0<e.length?(this.gp_filter.visible=!0,e.forEach(function(e){var t=new eui.List;t.itemRenderer=c.DecomposeUI_FilterItem;var i=new eui.HorizontalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER,t.layout=i,t.dataProvider=new eui.ArrayCollection(e),t.addEventListener(eui.ItemTapEvent.ITEM_TAP,n.filterItem_onItemTap,n),n.gp_filters_list.addChild(t)}),this.gp_filters.height=42*e.length+20*(e.length-1)+40):this.gp_filter.visible=!1},e.prototype.chosenList_onItemTap=function(e){e.item.info&&this.selectItem(e.item.info,!1)},e.prototype.itemList_onItemTap=function(e){(this.targetConfig.checdkChoosabel||function(){return!0})(e.item.info)&&(-1==this.chosenList.indexOf(e.item.info)?this.chosenList.length<this.MAX_NUM&&this.selectItem(e.item.info,!0):this.selectItem(e.item.info,!1))},e.prototype.filterItem_onItemTap=function(e){var t=e.itemRenderer;if(this.targetConfig.filterConfig.addFilter(this.curFilter,e.item),!t.chosen)for(var i=0,n=this.gp_filters_list.$children;i<n.length;i++){var o=n[i];if(-1!=o.$children.indexOf(t))for(var a=0,r=o.$children;a<r.length;a++){var s=r[a];s.chosen&&s.setChosen(!1)}}t.setChosen(!t.chosen),this.updateItemList()},e.prototype.selectItem=function(e,t){var i=this.list_item.dataProvider;for(var n in i.source){var o=i.source[n];if(o.info==e){o.chosen=t,i.itemUpdated(o);break}}t?this.chosenList.push(e):this.chosenList.splice(this.chosenList.indexOf(e),1),this.updatePb()},e.prototype.updateView=function(e){switch(this.gp_smithy.visible=!1,this.gp_decompose.visible=!1,this.gp_rollBack.visible=!1,this.curIndex=e&&e.index||this.curIndex,this.curIndex){case 1:this.gp_smithy.visible=!0,this.updateCost();break;case 2:this.gp_decompose.visible=!0,this.curType=EEntityType.EEntityTypeHeroEquip,this.targetConfig=this.DECOMPOSE_TYPE_CONFIG[this.curType],this.updateItemList(),this.updatePlayerInfo(),this.updatePb();break;case 3:this.gp_rollBack.visible=!0,this.updateRollback()}},e.prototype.updateCost=function(){var e=JSON.parse(c.Config.constConfig().SmithyForgeIronCosts.constValue);this.CommonIconWithNum1.updateItem({cost:e[0],style:CommonIconStyle.RIGHT,needShowHave:!0}),this.CommonIconWithNum10.updateItem({cost:[e[0][0],e[0][1],10*e[0][2]],style:CommonIconStyle.RIGHT,needShowHave:!0})},e.prototype.updateRollback=function(){var e=this.rollBackUuid?this.rollBackUuid.split("#")[0]:"";if(egret.Tween.removeTweens(this.img_rb_add),this.img_rb_add.alpha=1,""!=e){this.gp_rb_empty.visible=!1,this.rb_baseItem.visible=!0,this.icon_rb_cost.visible=!0,this.rb_baseItem.updateData({uuid:e,type:EEntityType.EEntityTypeHeroArtifact,isNum:!0});var t=c.GameMVC.heroThingPy.AllArtiInfo[e],i=c.Config.heroArtifactRollbackConfig(t.config.color,t.config.sectionLevel);this.icon_rb_cost.updateItem({cost:JSON.parse(i.costs)[0],style:CommonIconStyle.RIGHT,needShowHave:!0})}else this.gp_rb_empty.visible=!0,this.rb_baseItem.visible=!1,this.icon_rb_cost.visible=!1,this.checkCanRollback()&&UIActionManager.fadeBlink(this.img_rb_add,!0,!1,1e3)},e.prototype.checkCanRollback=function(){var e=c.GameMVC.heroThingPy.AllArtiInfo;for(var t in e)if(this.checkRollbackAvailable(t))return!0;return!1},e.prototype.checkRollbackAvailable=function(e){var t=c.GameMVC.heroThingPy.AllArtiInfo[e];return""==t.heroUuid&&c.Config.heroArtifactRollbackConfig(t.config.color,t.config.sectionLevel)&&!c.GameMVC.heroThingPy.isArtifactNewOne(e)},e.prototype.activateComponent=function(){var a=this;this.btn_smithy1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.proxy.SmithyForgeIron(1,function(e){a.onSmithyFinish(e,1)})},this),this.btn_smithy10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.proxy.SmithyForgeIron(10,function(e){a.onSmithyFinish(e,10)})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new c.HelpDialog({moduleId:MODULE.Smithy})})},this),this.btn_auto.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.autoSelect()},this),this.btn_decompose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var i=this,n=[];for(var e in this.chosenList){var t=this.chosenList[e];n.push(t.uuid)}0<this.chosenList.length?(GameRootLayer.gameLayer().switchTouchEnable(!1),this.timer=egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this,4e3),this.backpackPy.Decompose({chosenItem:this.chosenList,type:this.curType,cb:function(t){if(i.gp_effect.armature123){var e=i.gp_effect.armature123;e.animation.play("zhujiemian_ar"),e.once(dragonBones.EventObject.LOOP_COMPLETE,function(){var e=this.gp_effect.armature123;e&&e.animation.play("zhujiemian_ar_daiji2"),this.doneCB(t,n)},i)}},noShowReward:!0})):Utils.MsgUtils.addMidMsg("未放入"+this.targetConfig.name)},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.MainJumpConfig.jumpTo()},this),this.btn_filter.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_filters.visible=!0;var e=this.gp_filter.globalToLocal(0,0),t=new egret.Sprite;t.touchEnabled=!0,t.graphics.beginFill(0,0),t.graphics.drawRect(e.x,e.y,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),t.graphics.endFill(),this.gp_filter.addChildAt(t,2),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.gp_filters.visible=!1,t.parent&&t.parent.removeChild(t)},this)},this),this.btn_details.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){2==this.curIndex&&(0<this.chosenList.length?this.backpackPy.Decompose({chosenItem:this.chosenList,type:this.curType,preview:!0}):Utils.MsgUtils.addMidMsg("未放入"+this.targetConfig.name))},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new c.EquipCompound,closeCB:function(){a.updateView()}})},this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=a.backpackPy.getDecomposeProcess(EEntityType.EEntityTypeHeroEquip);JSON.parse(c.Config.constConfig().HeroEquipDecomposeProcess.constValue)<=e?a.backpackPy.GetDecomposeRewards(EEntityType.EEntityTypeHeroEquip,function(){a.updateView()}):c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(c.Config.constConfig().HeroEquipDecomposeRewards.constValue),type:c.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this),this.btn_preview.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.rollBackUuid?c.GameMVC.heroThingPy.HeroArtifactRollbackPreview({uuid:a.rollBackUuid.split("#")[0]}):Utils.MsgUtils.addMidMsg("未放入圣物")},this),Utils.ComponentUtils.registerListener(this.gp_rb_baseItem,egret.TouchEvent.TOUCH_TAP,function(){a.checkCanRollback()||Utils.MsgUtils.addMidMsg("当前无已培养过的橙色、红色，金色品质圣物"),PopUpManager.addPopUp({obj:new c.CommonChosePanel({getInfos:function(){var e={},t=c.GameMVC.heroThingPy.AllArtiInfo;for(var i in t){var n=t[i];if(a.checkRollbackAvailable(i))for(var o=0;o<n.num;o++)e[n.uuid+"#"+o]=n}return e},type:EEntityType.EEntityTypeHeroArtifact,uniNum:!0,selectUuids:a.rollBackUuid&&[a.rollBackUuid]||[],title:"请选择圣物",singleChoose:!0}),closeCB:function(e){e&&(a.rollBackUuid=e[0],a.updateView())}})},this),Utils.ComponentUtils.registerListener(this.btn_rollback,egret.TouchEvent.TOUCH_TAP,function(){a.rollBackUuid?c.GameMVC.heroThingPy.HeroArtifactRollback({uuid:a.rollBackUuid.split("#")[0],cb:function(){a.rollBackUuid=void 0,a.updateView()}}):Utils.MsgUtils.addMidMsg("未放入圣物")},this)},e.prototype.updateItemList=function(){var e=[],t=this.targetConfig.filterConfig&&this.targetConfig.filterConfig.filterFunc||function(){return!0},i=this.targetConfig.sortFunc||function(){return-1},n=this.targetConfig.getAllInfo(),o=0;if(n)for(var a in n){o+=1;var r=n[a];t(this.curFilter,r)&&e.push({type:this.curType,info:r,chosen:-1!=this.chosenList.indexOf(r)})}e.sort(i),this.list_item.dataProvider=new eui.ArrayCollection(e),this.lb_num.text=this.targetConfig.name+"数量：";var s=c.Config.constConfig().HeroBagMaxSize.constValue;this.blb_num.text=o+"/"+s},e.prototype.autoSelect=function(){if(!(this.chosenList.length>=this.MAX_NUM)){var e=this.list_item.dataProvider.source,t=this.targetConfig.filterConfig&&this.targetConfig.filterConfig.autoFilterFunc||function(){return!0},i=this.targetConfig.checdkChoosabel||function(){return!0},n=0;if(e.length)for(var o in e){var a=e[o].info;if(t(a)&&i(a)&&-1==this.chosenList.indexOf(a)&&(this.chosenList.push(a),n++,this.chosenList.length>=this.MAX_NUM))break}n?this.updateItemList():Utils.MsgUtils.addMidMsg(this.targetConfig.filterConfig.autoFilterTips),this.updatePb()}},e.prototype.playEffect=function(i){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return(t=this.list_item.$children[i])?[4,DragonBoneTools.playOnce({effectName:"common_yingxiongfenjie",parent:t,x:t.width/2,y:t.height/2,loop:!1,cacheAsBitmap:!0})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},e.prototype.doneCB=function(r,s){return void 0===s&&(s=[]),__awaiter(this,void 0,void 0,function(){var t,i,n,o,a;return __generator(this,function(e){switch(e.label){case 0:for(n in t=[],i=this.list_item.dataProvider.source)o=i[n].info,0<=s.indexOf(o.uuid)&&t.push(this.playEffect(parseInt(n)));return a="common_ty_rlian",3==this.curIndex&&(a="common_fjcg"),t.push(DragonBoneTools.playOnce({effectName:a,parent:this,x:this.width/2,y:this.height/2,loop:!1})),[4,Promise.all(t)];case 1:return e.sent(),this.chosenList.splice(0),this.updateItemList(),this.updatePlayerInfo(),this.updatePb(),GameRootLayer.gameLayer().switchTouchEnable(!0),this.timer&&egret.clearTimeout(this.timer),this.backpackPy.handleClientReward(r.clientReward,{title:"分解奖励",btnText:"领取",onCloseCB:function(){Utils.MsgUtils.addMidMsg("领取成功")}}),[2]}})})},e.prototype.onSmithyFinish=function(t,e){var i=this;if(this.btn_smithy1.touchEnabled=this.btn_smithy10.touchEnabled=!1,t){var n="zhujiemian_ar";if(this.gp_effect.armature123){10==e&&(n="zhujiemian_ar_2");var o=this.gp_effect.armature123;o.animation.play(n),o.once(dragonBones.EventObject.LOOP_COMPLETE,function(){!function(){c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).handleClientReward(t.rewardPreview),i.updateView({index:1}),i.btn_smithy1.touchEnabled=i.btn_smithy10.touchEnabled=!0;var e=i.gp_effect.armature123;e&&e.animation.play("zhujiemian_ar_daiji2")}()},this)}}},e.prototype.updatePlayerInfo=function(){},e.prototype.getFadeValue=function(){var e=c.Config.getHeroEquipConfig(),t=0;for(var i in this.chosenList){var n=this.chosenList[i];e[n.code]&&(t+=e[n.code].decomposeProcesses*n.num)}return t},e.prototype.updatePb=function(){var t=this,i=this.backpackPy.getDecomposeProcess(EEntityType.EEntityTypeHeroEquip);i+=this.getFadeValue(),this.labelDisplay.text=i+"/100",100<=(this.pb_Exp.value=i)?(this.addEffect("common_jingdutiao_2",this.gp_effect_1,!0,{scaleX:1.4}),this.addEffect("common_jingdutiaotk",this.gp_effect_2,!0),this.eff_jindutiao&&(this.eff_jindutiao.visible=!1),UIActionManager.setAbsGrey(this.btn_get,!1)):(8<i?this.eff_jindutiao?(this.eff_jindutiao.visible=!0,this.eff_jindutiao.x=i/100*this.gp_pb_fade.width*.94):(this.gp_pb_fade.removeChildren(),DragonBoneTools.create("common_shenqixulizhong",function(e){t.eff_jindutiao=e,t.eff_jindutiao.x=i/100*t.gp_pb_fade.width*.94,t.gp_pb_fade.addChild(e),e.animation.play("common_shenqixulizhong")})):this.eff_jindutiao&&(this.eff_jindutiao.visible=!1),this.addEffect(void 0,this.gp_effect_1,!1),this.addEffect(void 0,this.gp_effect_2,!1),UIActionManager.setAbsGrey(this.btn_get))},e.prototype.addEffect=function(e,t,i,n){t&&!e?t.visible=i:e&&(t.visible=i,t.numChildren<=0&&(t.removeChildren(),DragonBoneTools.create(e,function(e){e.x=t.width/2,e.y=t.height/2,e.scaleX=n&&n.scaleX||1,e.animation.play(),t.addChild(e)},this)))},e.prototype.perClose=function(){},e}(BaseFull);c.SmithyMainView=e,__reflect(e.prototype,"game.SmithyMainView");var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.childrenCreated=function(){e.prototype.childrenCreated.call(this),this.scaleX=this.scaleY=.7},t}(c.DecomposeUI_Item);__reflect(t.prototype,"DecomposeUI_ItemLocal")}(game||(game={})),function(i){var e=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.execute=function(e){i.MainProcessor.registerAll(),i.BackpackProcessor.registerAll(),i.MailProcessor.registerAll(),i.FightProcessor.registerAll(),i.FriendProcessor.registerAll(),i.TaskAllProcessor.registerAll(),i.ActivityProcessor.registerAll(),i.PlayerProcessor.registerAll(),i.ShopProcessor.registerAll(),i.RankProcessor.registerAll(),i.GuajiProcessor.registerAll(),i.GuildProcessor.registerAll(),i.HeroProcessor.registerAll(),i.HeroThingProcessor.registerAll(),i.ArenaProcessor.registerAll(),i.ManorProcessor.registerAll(),i.StormWarProcessor.registerAll(),i.WorldKingProcessor.registerAll(),i.TitleProcessor.registerAll(),i.BattleZoneArenaProcessor.registerAll(),i.TeamExpeProcessor.registerAll(),i.TeamPlayEntranceProcessor.registerAll(),i.ChampionProcessor.registerAll(),i.CopyEntranceProcessor.registerAll(),i.PvpEntranceProcessor.registerAll(),i.PetProcessor.registerAll(),i.WorldBossProcessor.registerAll(),i.GuildCollectProcessor.registerAll(),i.GuildBossProcessor.registerAll(),i.HeroChallengeProcessor.registerAll(),i.HeroChallenge2Processor.registerAll(),i.GuildSkillProcessor.registerAll(),i.GuildWarProcessor.registerAll(),i.GuildInstanceProcessor.registerAll(),i.MagicalProcessor.registerAll(),i.HeroSpiritProcessor.registerAll(),i.ZzqProcessor.registerAll(),i.LuckyTableProcessor.registerAll(),i.DungeonProcessor.registerAll(),i.TribeBattleProcessor.registerAll(),i.PeakWarProcessor.registerAll()},t}(puremvc.SimpleCommand);i.ControllerPrepCommand=e,__reflect(e.prototype,"game.ControllerPrepCommand",["puremvc.ICommand","puremvc.INotifier"])}(game||(game={})),function(e){var t=function(e){function t(){return e.call(this,t.N)||this}return __extends(t,e),t.prototype.GetSmithyInfo=function(t){var i=this;Utils.Socket.send("smithy","GetSmithyInfo",{}).then(function(e){i.smithyInfo=e.info,t&&t()})},t.prototype.SmithyForgeIron=function(e,t){var i=this;void 0===e&&(e=1),Utils.Socket.send("smithy","SmithyForgeIron",{num:e}).then(function(e){i.smithyInfo=e.info,t&&t(e)})},t.N="SmithyPy",t}(BaseProxy);e.SmithyPy=t,__reflect(t.prototype,"game.SmithyPy")}(game||(game={})),function(y){var e=function(i){function e(){var e=i.call(this)||this;for(var t in e.skinName="StormWarDialogSkin",e.py=y.AppFacade.getInstance().retrieveProxy(y.StormWarProxy.N),e.stormWarDoubleHit=y.Config.stormWarDoubleHit(),e.maxDoubleHit=0,e.stormWarDoubleHit)e.maxDoubleHit=Math.max(e.maxDoubleHit,e.stormWarDoubleHit[t].num);return e}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.addEvent()},e.prototype.updateView=function(e){var o=this;this.data=e.data,this.isCreep=e.isCreep,this.gp_player_info.visible=!this.isCreep,this.lb_monster_name.visible=this.isCreep;var t=this.py.selfPlayer,i=y.Config.stormWarLayer()[t.layerCode],n=JSON.parse(i.winScore);if(!this.isCreep){var a=Math.min(t.doubleHit+1,this.maxDoubleHit),r=this.stormWarDoubleHit[a];if(r){var s=JSON.parse(r.battleScore);Array.isArray(s)&&0<s.length&&(n[0][2]+=s[0][2])}}if(this.isCreep){this.defenceId=this.data.creepCode;var c=y.Config.stormWarCreep()[this.data.creepCode];if(!c)return;var l=JSON.parse(c.creeps);Array.isArray(l)&&l.forEach(function(e){if(e[0]){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e[0]}),t.scaleX=t.scaleY=.7,o.gp_enermy.addChild(t),t.touchEnabled=!1}});for(var h=0,p=g=JSON.parse(c.rewards);h<p.length;h++){var d=p[h],u=.7;(m=customui.BaseItemFactory.create(21)).updateData({type:d[0],code:d[1],num:d[2]}),m.scaleX=u,m.scaleY=u,this.gp_reward_show.addChild(m)}}else{var g;this.defenceId=this.data.playerId,this.lb_player_name.text="S"+this.data.serverId+"."+this.data.name,Utils.Socket.send("playerInfo","GetPublicPlayer",{playerId:this.data.playerId}).then(function(e){if(o.stage){var t=e.publicPlayer;if(t){var i=t.baseInfo,n=t.heroList;o.playerHead.updateData({vo:i}),o.item_fightCap.update(i.fightCap),o.gp_enermy.removeChildren(),Array.isArray(n)&&n.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e.code,level:e.level}),t.scaleX=t.scaleY=.7,o.gp_enermy.addChild(t),t.touchEnabled=!1})}}}).catch(function(e){}),(g=new Array).push(n[0]);for(var f=0,_=g;f<_.length;f++){var m;d=_[f],u=.7;(m=customui.BaseItemFactory.create(21)).updateData({type:d[0],code:d[1],num:d[2]}),m.scaleX=u,m.scaleY=u,this.gp_reward_show.addChild(m)}}},e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this)},e.prototype.addEvent=function(){this.btn_challge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.defenceId&&this.py.Challenge(this.defenceId,this.isCreep),this.hide()},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){y.AppFacade.getInstance().showSubView(y.HeroMediator.N,y.HeroMediator.SV.FORMATION)},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this)},e.prototype.checkIsRemoveTarget=function(e,t){t==this.isCreep&&this.defenceId==e&&this.hide()},e}(BasePanel);y.StormWarDialog=e,__reflect(e.prototype,"game.StormWarDialog")}(game||(game={})),function(o){var e=function(t){function n(e){return void 0===e&&(e=null),t.call(this,n.N,e)||this}return __extends(n,t),Object.defineProperty(n.prototype,"stormWarView",{get:function(){return this.getSubView(n.SV.MAIN)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stormWarDialog",{get:function(){return this.getSubView(n.SV.DIALOG)},enumerable:!0,configurable:!0}),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.StormWarView),this.addSubView(n.SV.DIALOG,o.StormWarDialog),this.addSubView(n.SV.RECORD,o.StormWarRecordPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.CHANGE_PANEL,CN.STORM_WAR_UPDATE_LAYER,CN.STORM_WAR_UPDATE_CREEPS,CN.STORM_WAR_UPDATE_PLAYERS,CN.STORM_WAR_UPDATE_SELF_PLAYER,CN.STORM_WAR_UPDATE_WAR,CN.STORM_WAR_REMOVE_PLAYER,CN.STORM_WAR_REMOVE_CREEP,CN.STORM_WAR_FORCE_EXIT,CN.STORM_WAR_UPDATE_RANKS,CN.STORM_WAR_BATTLE_FINISH]},n.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:var i=Utils.UnlockMgr.getOpenInfo(MODULE.StormWar);i.isOpen&&i.allow&&o.GameMVC.stormWarPy.GetStormWarPlayer();break;case CN.STORM_WAR_UPDATE_LAYER:this.stormWarView&&this.stormWarView.updateLayer();break;case CN.STORM_WAR_UPDATE_CREEPS:this.stormWarView&&this.stormWarView.updateCreeps();break;case CN.STORM_WAR_UPDATE_PLAYERS:this.stormWarView&&this.stormWarView.updatePlayers(t.isInit);break;case CN.STORM_WAR_UPDATE_SELF_PLAYER:this.stormWarView&&this.stormWarView.updateSelfPlayer(),NoticeManager.updateNotice(NT.STORM_WAR_ACHIEVE);break;case CN.STORM_WAR_UPDATE_WAR:this.stormWarView&&this.stormWarView.updateWar();break;case CN.STORM_WAR_REMOVE_PLAYER:this.stormWarView&&this.stormWarView.removePlayer(t.playerId),this.stormWarDialog&&this.stormWarDialog.checkIsRemoveTarget(t.playerId,!1);break;case CN.STORM_WAR_REMOVE_CREEP:this.stormWarDialog&&this.stormWarDialog.checkIsRemoveTarget(t.creepCode,!0);break;case CN.STORM_WAR_FORCE_EXIT:this.getSubView(n.SV.MAIN)&&o.MainJumpConfig.jumpTo();break;case CN.STORM_WAR_UPDATE_RANKS:this.stormWarView&&this.stormWarView.updateRank();break;case CN.STORM_WAR_BATTLE_FINISH:console.log("===== stormWar STORM_WAR_BATTLE_FINISH ===== 战斗结束, 请求拉取层玩家怪数据"),o.GameMVC.stormWarPy.GetStormWarInfo(!1),this.stormWarView&&this.stormWarView.onBattleFinish(t.result);break;case CN.CHANGE_PANEL:t&&t.isRemove&&this.stormWarView&&(this.stormWarView.gp_map.visible=!0)}},n.prototype.onViewCreate=function(){this.sendNotification(CN.CITY_SWITCH_DBCLOCKPAUSE,!0),this.sendNotification(CN.GUAJI_HIDE_ALL_SUBVIEW)},n.N="StormWarMediator",n.SV={MAIN:1,DIALOG:2,RECORD:3},n}(BaseMediator);o.StormWarMediator=e,__reflect(e.prototype,"game.StormWarMediator")}(game||(game={})),function(n){var e=function(){function e(){}return e.create=function(e){var t=Utils.ObjectPoolMgr.pop("game.StormWarPlayer",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},e}();n.StormWarPlayerFactory=e,__reflect(e.prototype,"game.StormWarPlayerFactory");var t=function(i){function e(){var e=i.call(this)||this;return e.walkPaths=new Array,e.hasWalkPassPath=new Array,e}return __extends(e,i),e.prototype.resetTileXY=function(){this.lastTileX=this.lastTileY=void 0},e.prototype.setTilePos=function(e,t,i){void 0===i&&(i=!1),i?(this._tileX=e,this._tileY=t,this.updateFixedPos()):(this.tileX=e,this.tileY=t)},e.prototype.switchFocus=function(){this.roleDyModel.curModelAct=ROLE_ACTION_NAME.DJ},e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.gp_foot.touchEnabled=!1,this.roleDyModel=new customui.RoleDynamicModel({vo:{fashionCode:this.player.fashionCode,horseCode:this.player.horseCode,titleCode:this.player.titleCode,magicalCode:this.player.magicalCode},cacheFrameRate:6}),this.roleDyModel.x=this.gp_foot.width/2,this.roleDyModel.y=this.gp_foot.height,this.gp_foot.addChild(this.roleDyModel),this.img_name_bg=new eui.Image("mxkc_img_di_png"),this.img_name_bg.height=24,this.img_name_bg.horizontalCenter=0,this.gp_foot.addChild(this.img_name_bg),this.lb_name=new eui.Label,this.lb_name.horizontalCenter=0,this.lb_name.textAlign="center",this.lb_name.textColor=16777215,this.lb_name.size=18,this.gp_foot.addChild(this.lb_name),this.lb_name.text="S"+this.player.serverId+"."+this.player.name,this.updateChampion(n.GameMVC.stormWarPy.war.champion),this.switchFocus(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this._hasInit=!0},e.prototype.updateChampion=function(e){var t=this,i=!1;e&&e.playerId==this.player.playerId&&(i=!0),i?(this.img_name_bg.source="_stormWar_m_json.fbzc_img_guanjundi",this.img_name_bg.height=83,this.lb_name.textColor=0):(this.img_name_bg.source="mxkc_img_di_png",this.img_name_bg.height=24,this.lb_name.textColor=16777215),this.roleDyModel.onArmatureLoadCB=function(){var e=t.roleDyModel.getHeadNameBottom();t.img_name_bg.bottom=e-t.img_name_bg.height/2-7.5,t.lb_name.bottom=e-t.lb_name.height}},e.prototype.onClick=function(){var e=this.player.playerId;if(!this.map.getStormWarPlayerByPlayerId(e))return this.reset(),void(this.parent&&this.parent.removeChild(this));console.log(" 点中玩家了 ");var t=this.map.getStormWarPlayerByTilePos(this._tileX,this._tileY);t&&0<t.length?n.AppFacade.getInstance().showSubView(n.StormWarMediator.N,n.StormWarMediator.SV.DIALOG,{data:t[0].player,isCreep:!1}):this.map.handleTouchTap(this.tileX,this.tileY)},e.prototype.walkByPath=function(e,t){var i=this;this.walkDoneCB=t,this.walkPaths.splice(0),e.forEach(function(e){i.walkPaths.push({tileX:e.y,tileY:e.x})}),0<this.walkPaths.length&&(this.walkPaths[this.walkPaths.length-1].isLast=!0),this.isMoving||this.walkByPathNext()},e.prototype.onChangingDir=function(e){this.roleDyModel.onChangingDir(e)},e.prototype.walkPathFinish=function(){this.roleDyModel.curModelAct=ROLE_ACTION_NAME.DJ,this.walkDoneCB&&this.walkDoneCB(),this.walkDoneCB=void 0,this.hasWalkPassPath.splice(0)},e.prototype.forceStop=function(){this.walkPaths.splice(0)},e.prototype.walkByPathNext=function(){var e=this.walkPaths.shift();e?this.walkToTile(e.tileX,e.tileY):this.walkPathFinish()},e.prototype.onWalking=function(){var e=this;this.roleDyModel.curModelAct!=ROLE_ACTION_NAME.PB&&(this.roleDyModel.curModelAct=ROLE_ACTION_NAME.PB),this.isMoving=!0;var t=this.map.tile2Pos(this.tileX,this.tileY);egret.Tween.get(this).to({x:t.x,y:t.y},this.map.npcMovingDura).call(function(){e.isMoving=!1,e.onAfterWalk()}),this.updateVisible(this.tileX,this.tileY),this.hasWalkPassPath.push({x:this.tileX,y:this.tileY})},e.prototype.updateVisible=function(e,t){void 0===e&&(e=this.tileX),void 0===t&&(t=this.tileY);var i=this.map.getTileIndex(this.tileX,this.tileY),n=this.map.mwArr[i];n&&(0==n||4==n?this.visible&&(this.visible=!1):2!=n&&3!=n||!this.visible&&(this.visible=!0))},e.prototype.onAfterWalk=function(){if(i.prototype.onAfterWalk.call(this),this.customAfterWalkCB){var e=this.hasWalkPassPath[this.hasWalkPassPath.length-1];this.customAfterWalkCB(e.x,e.y)}this.walkByPathNext()},e.prototype.reset=function(){i.prototype.reset.call(this),egret.Tween.removeTweens(this),this.walkPaths.splice(0),this.walkDoneCB=void 0,this.hasWalkPassPath.splice(0),this.roleDyModel.reset(),this.isMoving=!1,this.visible=!1,this.zorder=0},e.prototype.onOPReset=function(){this.reset()},e.prototype.onOPComeBack=function(e,t){i.prototype.onOPComeBackCB.call(this),this.player=e.player,this.map=e.map,this._hasInit&&(this.roleDyModel.update({vo:{fashionCode:this.player.fashionCode,horseCode:this.player.horseCode,titleCode:this.player.titleCode,magicalCode:this.player.magicalCode}}),this.lb_name.text="S"+this.player.serverId+"."+this.player.name,this.updateChampion(n.GameMVC.stormWarPy.war.champion))},e.prototype.onOPClean=function(){},e.prototype.onOPCheck=function(e){egret.log("alive")},e}(n.Npc);n.StormWarPlayer=t,__reflect(t.prototype,"game.StormWarPlayer",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(game||(game={})),function(n){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new i).register(),(new o).register(),(new a).register(),(new r).register()},e}();n.StormWarProcessor=e,__reflect(e.prototype,"game.StormWarProcessor");var t=function(e){function t(){return e.call(this,"stormWar.PlayerStormWarInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();n.AppFacade.getInstance().retrieveProxy(n.StormWarProxy.N).updateSelfLayer(t.selfPlayer)},t}(n.ProcessorBase);__reflect(t.prototype,"PlayerStormWarInfoP");var i=function(e){function t(){return e.call(this,"stormWar.StormWarLayerInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody(),i=n.AppFacade.getInstance().retrieveProxy(n.StormWarProxy.N);i.isLayerCodeChange(t.layer.layerCode)?console.log("===== stormWar StormWarLayerInfoP ===== 场景发生改变 等待战斗结束"):i.updateLayer(t.layer)},t}(n.ProcessorBase);__reflect(i.prototype,"StormWarLayerInfoP");var o=function(e){function t(){return e.call(this,"stormWar.StormWarInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody(),i=n.AppFacade.getInstance().retrieveProxy(n.StormWarProxy.N);i.isLayerCodeChange(t.layer.layerCode)?console.log("===== stormWar StormWarInfoP ===== 场景发生改变 等待战斗结束"):i.updateLayer(t.layer),i.updateSelfLayer(t.selfPlayer),i.updateWar(t.war)},t}(n.ProcessorBase);__reflect(o.prototype,"StormWarInfoP");var a=function(e){function t(){return e.call(this,"stormWar.WarInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();n.AppFacade.getInstance().retrieveProxy(n.StormWarProxy.N).updateWar(t.war)},t}(n.ProcessorBase);__reflect(a.prototype,"WarInfoP");var r=function(e){function t(){return e.call(this,"stormWar.StormWarBattleRecordP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();n.AppFacade.getInstance().retrieveProxy(n.StormWarProxy.N).challengeResultInfo=t.battleRecord},t}(n.ProcessorBase);__reflect(r.prototype,"StormWarBattleRecordP")}(game||(game={})),function(s){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.MAX_SYNC_COUNT=50,e.challengeResultInfo=void 0,e.lastLayerCode=0,e.layer=new s.SLayer,e.selfPlayer=new s.SPlayer,e.war=new s.SWar,e.creeps=new Array,e.players=new Array,e.addNotice(),e}return __extends(i,t),i.prototype.reset=function(){},i.prototype.isLayerCodeChange=function(e){return 0==this.lastLayerCode?(this.lastLayerCode=e,!1):this.lastLayerCode!=e},i.prototype.updateLayer=function(e,t){void 0===t&&(t=!1),this.layer.update(e),this.sendNotification(CN.STORM_WAR_UPDATE_LAYER),this.updatePlayers(e.players,t),this.updateCreeps(e.creeps)},i.prototype.updateSelfLayer=function(e){this.selfPlayer.update(e),this.sendNotification(CN.STORM_WAR_UPDATE_SELF_PLAYER)},i.prototype.updateWar=function(e){this.war.update(e),this.sendNotification(CN.STORM_WAR_UPDATE_WAR)},i.prototype.updateCreeps=function(e){for(var t=this.creeps.length-1;0<=t;t--){var i=!1;for(var n in e)if(e[n].creepCode==this.creeps[t].creepCode){i=!0;break}i||(this.sendNotification(CN.STORM_WAR_REMOVE_CREEP,{creepCode:this.creeps[t].creepCode}),this.creeps[t].remove=!0)}for(var t in e){i=!1;for(var n in this.creeps)if(this.creeps[n].creepCode==e[t].creepCode){this.creeps[n].update(e[t]),i=!0;break}i||this.creeps.push(new s.SCreepBase(e[t]))}this.sendNotification(CN.STORM_WAR_UPDATE_CREEPS)},i.prototype.updatePlayers=function(e,t){void 0===t&&(t=!1);for(var i=0,n=this.players.length-1;0<=n;n--){var o=!1;for(var a in e)if(e[a].playerId==this.players[n].playerId){o=!0;break}o||(this.sendNotification(CN.STORM_WAR_REMOVE_PLAYER,{playerId:this.players[n].playerId}),this.players.splice(n,1),i++)}for(var n in egret.log("风暴stormWar 移除",i),i=0,e){o=!1;var r=!1;for(var a in this.players)if(this.players[a].playerId==e[n].playerId){this.players[a].update(e[n]),o=!0;break}o||this.war.champion&&this.war.champion.playerId==e[n].playerId&&(r=!0),(r||this.players.length<this.MAX_SYNC_COUNT&&!o)&&(this.players.push(new s.SPlayerBase(e[n])),i++)}egret.log("风暴stormWar 追加",i),this.sendNotification(CN.STORM_WAR_UPDATE_PLAYERS,{isInit:t})},i.prototype.getPlayerByPlayerId=function(e){var t=null;for(var i in this.players)if(this.players[i].playerId==e){t=this.players[i];break}return t},i.prototype.updateRank=function(e){this.ranks=e,this.sendNotification(CN.STORM_WAR_UPDATE_RANKS)},i.prototype.GetStormWarInfo=function(i){var n=this;void 0===i&&(i=!1),Utils.Socket.send("stormWar","GetStormWarInfo",{},!0).then(function(e){var t=s.GameMVC.playerPy.playerInfoVO.playerId;e.layer.players.some(function(e){if(e.playerId==t)return!0})||(Utils.MsgUtils.addMidMsg("找不到自己"),s.MainJumpConfig.jumpTo("CITY")),n.lastLayerCode=e.layer.layerCode,n.updateLayer(e.layer,i),n.updateSelfLayer(e.selfPlayer),n.updateWar(e.war)}).catch(function(e){e&&e.err&&(Utils.MsgUtils.addErrMsg(e.err),n.sendNotification(CN.STORM_WAR_FORCE_EXIT))})},i.prototype.Challenge=function(e,t){var i=this;s.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeStormWar,pb1:"stormWar",pb2:"Challenge",params:{defenceId:e,isCreep:t},reqCB:function(e){i.challengeResultInfo=e.battleRecord},doneCB:function(e){e.cbRet&&(i.isLayerCodeChange(e.cbRet.layer.layerCode)?console.log("===== stormWar ChallengeR ===== 场景发生改变 等待战斗结束"):i.updateLayer(e.cbRet.layer),i.updateSelfLayer(e.cbRet.selfPlayer),i.updateWar(e.cbRet.war),i.challengeResultInfo=void 0),s.AppFacade.getInstance().retrieveProxy(s.FightPy.N).queueExceExitCB()}})},i.prototype.GetRewards=function(e,t,i){var n=this;Utils.Socket.send("stormWar","GetRewards",{rewardType:e,rewardId:t}).then(function(e){n.updateSelfLayer(e.selfPlayer),i&&i(e)}).catch(function(e){})},i.prototype.GetStormWarRank=function(){var t=this;Utils.Socket.send("ranking","GetCommonRank",{rankType:RankingType.RankingTypeActivityStormWarTopThree}).then(function(e){t.updateRank(e)}).catch(function(e){})},i.prototype.GetStormWarPlayer=function(){var t=this;Utils.Socket.send("stormWar","GetStormWarPlayer",{}).then(function(e){t.selfPlayer.score=e.score,t.selfPlayer.targeted=e.targeted,NoticeManager.updateNotice(NT.STORM_WAR_ACHIEVE)}).catch(function(e){})},i.prototype.GetStormWarBattleRecordInfo=function(t){Utils.Socket.send("stormWar","GetStormWarBattleRecordInfo",{}).then(function(e){t&&t(e)}).catch(function(e){})},i.prototype.addNotice=function(){NoticeManager.setChildType(NT.CITY_EXT_ENTRANCE,NT.STORM_WAR),NoticeManager.setChildType(NT.STORM_WAR,NT.STORM_WAR_ACHIEVE),NoticeManager.registerCB(NT.STORM_WAR_ACHIEVE,this.checkAchieveNotice,this,MODULE.StormWar)},i.prototype.checkAchieveNotice=function(){var i=!1,e=Utils.UnlockMgr.getOpenInfo(MODULE.StormWar);if(!e)return i;if(!e.allow)return i;if(!e.isOpen)return i;var n=this.selfPlayer.score,o=this.selfPlayer.targeted,a=s.Config.stormWarRewards(),t=function(e){var t=a[e];if(t.score<=n&&o.every(function(e){return e.rewardId!=t.code}))return i=!0,"break"};for(var r in a){if("break"===t(r))break}return i},i.N="StormWarProxy",i}(BaseProxy);s.StormWarProxy=e,__reflect(e.prototype,"game.StormWarProxy")}(game||(game={})),function(n){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="StormWarRecordPanelSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.cu_xtck.blb_title.text="战斗记录",this.cu_xtck.onCloseCB=function(){e.hide()}},e.prototype.updateView=function(e){this.params=e,this.updateList(this.params.info.battleRecords)},e.prototype.updateList=function(e){0<e.length?(e.sort(function(e,t){return e.battleDt>t.battleDt?-1:1}),this.gp_empty.visible=!1,this.list_item.itemRenderer=i,this.list_item.dataProvider=new eui.ArrayCollection(e)):this.gp_empty.visible=!0},e}(BasePanel);n.StormWarRecordPanel=e,__reflect(e.prototype,"game.StormWarRecordPanel");var i=function(i){function e(){var e=i.call(this)||this;return e.skinName="StormWarRecordItemSkin",e.proxy=n.AppFacade.getInstance().retrieveProxy(n.FightPy.N),e.pPy=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N),e.cu_playerHead1=customui.PlayerHeadFactory.create(),e}return __extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.data.battleUuid;t.proxy.BattlePlayBack(e)},this),this.gp_heads.addChild(this.cu_playerHead1);var e=.7;n.FightRecordPanel.curTeamId&&(e=.6),this.cu_playerHead1.scaleX=this.cu_playerHead1.scaleY=e},e.prototype.dataChanged=function(){var e;this.data;this.vo=this.data,this.lb_name.text=this.vo.baseInfo.name,e=this.vo.challengerId!=this.pPy.playerInfoVO.playerId?this.vo.result===EBattleResult.EBattleResultWin?EBattleResult.EBattleResultLose:EBattleResult.EBattleResultWin:this.vo.result,this.item_fightCap.blb_fightCap.text=""+Utils.MathUtils.formatNumStyle2(this.vo.baseInfo.fightCap),this.cu_playerHead1.updateData({vo:this.vo.baseInfo});var t=JSON.parse(this.data.keyStr);this.lb_change.text=t.oldLayer+"→"+t.newLayer,this.lb_time.visible=!0;var i=this.vo||this.vo2;e===EBattleResult.EBattleResultWin?this.img_result.source="jjc_icon_sheng_png":this.img_result.source="jjc_icon_bai_png",this.lb_time.text=Utils.TimerManager.getTimeLeftDescBySecond(Utils.TimerManager.getServerTime()-i.battleDt)},e}(eui.ItemRenderer);__reflect(i.prototype,"StormWarRecordItemRender")}(game||(game={})),function(y){var e=function(t){function e(){var e=t.call(this)||this;return e.params=void 0,e.doneCB=void 0,e.playerPy=y.AppFacade.getInstance().retrieveProxy(y.PlayerPy.N),e.stormWarProxy=y.AppFacade.getInstance().retrieveProxy(y.StormWarProxy.N),e.skinName="StormWarResultPanelSkin",e}return __extends(e,t),e.prototype.perClose=function(){this.doneCB&&this.doneCB()},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},e.prototype.updateView=function(e){var i=this;this.params=e.info,this.doneCB=e.doneCB;var t=this.stormWarProxy.challengeResultInfo,n=t.result==EBattleResult.EBattleResultWin,o=n?"common_shengli_22":"common_zhanbai_22";if(this.gp_win.visible=n,this.gp_lose.visible=!n,this.gp_effect.removeChildren(),DragonBoneTools.create(o,function(e){e.x=this.gp_effect.width/2,e.y=this.gp_effect.height,e.animation.play(),this.gp_effect.addChild(e)},this),n&&(this.gp_reward.removeChildren(),this.params&&this.params.clientReward&&this.params.clientReward.rewards)){var a=this.params.clientReward.rewards;for(var r in a){var s=customui.BaseItemFactory.create();s.scaleX=s.scaleY=.7,s.updateData({code:a[r].code,type:a[r].type,num:a[r].num}),this.gp_reward.addChild(s)}}for(var r in this.params.teams){var c=this.params.teams[r];if(c.playerId&&c.playerId==this.playerPy.playerInfoVO.playerId)this.playerPy.GetPublicPlayerBaseInfo([c.playerId],function(e,t){e&&e[0]&&(i.player_my.updateData({vo:e[0].baseInfo}),i.lb_my.text=e[0].baseInfo.name)});else if(c&&c.playerId)this.player_other.visible=!0,this.gp_otherHero.visible=!1,this.lb_num_other.visible=!0,this.lbl_other.visible=!0,this.playerPy.GetPublicPlayerBaseInfo([c.playerId],function(e,t){e&&e[0]&&(i.player_other.updateData({vo:e[0].baseInfo}),i.lb_other.text=e[0].baseInfo.name)});else{this.player_other.visible=!1,this.gp_otherHero.visible=!0,this.lb_num_other.visible=!1,this.lbl_other.visible=!1,this.gp_otherHero.removeChildren();var l=customui.BaseItemFactory.create();l.touchEnabled=!1;var h=c.entities[0],p=void 0;h.dermaCode&&0!=h.dermaCode&&(p=y.Config.getHeroDermaConfig()[h.dermaCode].avatar),l.updateData({code:h.code,type:EEntityType.EEntityTypeHero,avatar:p,isShowZhongZhu:!0}),this.gp_otherHero.addChild(l),this.lb_other.text=y.Config.allHeroConfig()[h.code].name}}if(t&&t.keyStr){var d=JSON.parse(t.keyStr),u=d.newScore-d.oldScore;this.lbl_now.text="第"+this.toChinesNum(d.newLayer)+"层",this.lbl_last.text="第"+this.toChinesNum(d.oldLayer)+"层";var g=[];g.push({text:d.newScore+"(",style:{textColor:16777215}}),g.push({text:0<=u?"+"+u:u+"",style:{textColor:0<u?COLOR_2_FONT_COLOR[2]:COLOR_2_FONT_COLOR[6]}}),g.push({text:")",style:{textColor:16777215}}),this.lb_num_my.textFlow=g}if(t&&t.tKeyStr){var f=JSON.parse(t.tKeyStr),_=f.newScore-f.oldScore,m=[];m.push({text:f.newScore+"(",style:{textColor:16777215}}),m.push({text:0<=_?"+"+_:_+"",style:{textColor:0<_?COLOR_2_FONT_COLOR[2]:COLOR_2_FONT_COLOR[6]}}),m.push({text:")",style:{textColor:16777215}}),this.lb_num_other.textFlow=m}},e.prototype.toChinesNum=function(e){for(var t=["零","一","二","三","四","五","六","七","八","九"],i=["","十","百","千"],n="",o="",a=0,r=!0,s=e;0<e;){var c=e%10;0==c?r||(r=!0,o=t[c]+o):(r=!1,n=t[c],o=(n+=i[a])+o),a++,e=Math.floor(e/10)}return 9<s&&s<20&&(o=o.replace("一","")),o},e}(BasePanel);y.StormWarResultPanel=e,__reflect(e.prototype,"game.StormWarResultPanel")}(game||(game={}));var customui,game,STORM_WAR_MOVE_CD=1,STORM_WAR_UPDATE_RANK=5;!function(h){var e=function(t){function e(){var e=t.call(this)||this;return e._idelPlaying=!1,e.skinName="StormWarSkin",e.py=h.AppFacade.getInstance().retrieveProxy(h.StormWarProxy.N),e.py.lastLayerCode=0,e.StormWarAttackCD=Number(h.Config.constConfig().StormWarAttackCD.constValue),e.lastDoubleHit=void 0,e.lastLayerCode=void 0,e.intervalRank=STORM_WAR_UPDATE_RANK,e.moveCD=0,e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.ObjectPoolMgr.clearClass("game.StormWarPlayer")},e.prototype.initBottom=function(){var e=this;this.roleDyModel=new customui.RoleDynamicModel({reqStyle:ROLE_STYLE.Fashion|ROLE_STYLE.Magical}),this.gp_bottom_roleModel.addChild(this.roleDyModel),this.roleDyModel.onArmatureLoadCB=function(){e.roleDyModel.curModelAct=ROLE_ACTION_NAME.DJ,e.roleArmature=e.roleDyModel.ead_model1,e.roleArmature.animation.timeScale=1.2,e.roleArmature.scaleX=-.8,e.roleArmature.scaleY=.8}},e.prototype.perClose=function(){this.py.reset(),this.map.reset(),this.map.removeAllStormWarPlayer(),this.stopTimer(),this.gp_effect&&egret.Tween.removeTweens(this.gp_effect),this.blb_win_num&&egret.Tween.removeTweens(this.blb_win_num),this.roleArmature&&egret.Tween.removeTweens(this.roleArmature),this.creepArmature&&egret.Tween.removeTweens(this.creepArmature),this.gp_bottom_roleModel&&egret.Tween.removeTweens(this.gp_bottom_roleModel),this.gp_bottom_creepModel&&egret.Tween.removeTweens(this.gp_bottom_creepModel),this.py.lastLayerCode=0},e.prototype.childrenCreated=function(){var o=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_right_top),this.pb_time.labelFunction=function(e,t){return Utils.TimerManager.getFormatBySecond1(e)},this.initBottom(),this.initUI(),this.addEvent(),this.addNotice(),this.map=Utils.MapUtils.generateCommon({npcMovingDura:500,source:MODULE.StormWar,multiLayerScroller:this.cu_mls,loadingParent:this.getParentView(),miniMapParent:void 0,onRequestToMove:function(e,t,i,n){return 0<o.moveCD?(console.log("===== storm ===== 移动CD中 "+o.moveCD),!0):(o.moveCD=STORM_WAR_MOVE_CD,!1)},onTouchTap:function(e,t){Utils.Socket.send("coordinate","SyncCoordinateInfo",{type:MODULE.StormWar,coordinate:{x:e,y:t,z:1}}).then(function(e){})}}),this.gp_map.addChildAt(this.map,0),this.py.GetStormWarInfo(!0),egret.setTimeout(function(){o.py.GetStormWarRank()},this,100)},e.prototype.updateView=function(e){},e.prototype.updateBottom=function(){var i=this,e=this.py.selfPlayer.hangUpIncomeDuration,t=Math.min(Math.floor(e/20),5);this.img_bottom_res.source=0===t?"":"mx_img_jinbidui"+t+"_png";var n=2<t?"common_fbzcbaoxiang":"common_fbzcbaoxiang2";this.chestArmature&&this.chestArmature.armature.name==n||(this.chestArmature&&this.chestArmature.parent.removeChild(this.chestArmature),DragonBoneTools.create(n,function(e){i.chestArmature=e,i.chestArmature.x=i.gp_bottom_res.width/2,i.chestArmature.y=i.gp_bottom_res.height,i.gp_bottom_res.addChild(i.chestArmature),i.chestArmature.animation.play(n)}));var o=this.py.selfPlayer.hangUpIncome;if(this._curResCache){var a=0,r=0,s=0;for(var c in o.some(function(e){var t=i._curResCache[e.code]||0;if(t<e.num)return a=e.type,r=e.code,s=e.num-t,!0})&&Utils.MsgUtils.addRewardMsg({rewards:[[a,r,s]]},this.gp_bottom_res),this._curResCache)delete this._curResCache[c]}else this._curResCache={};o.forEach(function(e){i._curResCache[e.code]=e.num})},e.prototype.beginIdelBattle=function(o){var a=this;function r(e,t,i){e&&e.armature&&(e.animation.play(t),i&&e.once(dragonBones.EgretEvent.LOOP_COMPLETE,function(){i()},this))}function s(e,t){var i=customui.FightPopTipsFactory.create({camp:e?EBattleSide.EBattleSideAttack:EBattleSide.EBattleSideDefence,timeScale:1,content:e?-1:-Utils.MathUtils.getRandomInt(100,1e3),status:0,x:0,y:-100,height:100});t.addChild(i)}new Promise(function(t){switch(o){case 1:var e=a.py.layer;if(e&&e.creeps.length){var i=e.creeps[Utils.MathUtils.getRandomInt(0,e.creeps.length-1)].creepCode,n=h.Config.stormWarCreep()[i];DragonBoneTools.create(n.model,function(e){a.creepArmature=e,a.creepArmature.scaleX=-.5,a.creepArmature.scaleY=.5,a.creepArmature.animation.timeScale=1.2,a.gp_bottom_creepModel.addChild(a.creepArmature),r(a.creepArmature,ROLE_ACTION_NAME.DJ),DragonBoneTools.playOnce({effectName:"common_fbzcguaichuxian",parent:a.gp_bottom_creepModel}),a.creepArmature.alpha=0,egret.Tween.get(a.creepArmature).to({alpha:1},500).wait(500).call(function(){t()})})}break;case 2:case 4:case 6:a.gp_bottom.getChildIndex(a.gp_bottom_roleModel)<a.gp_bottom.getChildIndex(a.gp_bottom_creepModel)&&a.gp_bottom.swapChildren(a.gp_bottom_roleModel,a.gp_bottom_creepModel),egret.Tween.get(a.gp_bottom_roleModel).to({x:475},50).call(function(){r(a.roleArmature,ROLE_ACTION_NAME.GJ,function(){r(a.roleArmature,ROLE_ACTION_NAME.DJ),egret.Tween.get(a.gp_bottom_roleModel).to({x:330},50).call(function(){t()})}),egret.setTimeout(function(){r(a.creepArmature,ROLE_ACTION_NAME.SJ,function(){a.creepArmature.animation.play(ROLE_ACTION_NAME.DJ)}),DragonBoneTools.playOnce({effectName:"common_skill_huikan_1",parent:a.gp_bottom_roleModel,x:150}),DragonBoneTools.playOnce({effectName:"common_skill_huikan_2",parent:a.gp_bottom_creepModel}),s(!1,a.gp_bottom_creepModel)},a,375)});break;case 3:case 5:a.gp_bottom.getChildIndex(a.gp_bottom_roleModel)>a.gp_bottom.getChildIndex(a.gp_bottom_creepModel)&&a.gp_bottom.swapChildren(a.gp_bottom_roleModel,a.gp_bottom_creepModel),egret.Tween.get(a.gp_bottom_creepModel).to({x:485},50).call(function(){r(a.creepArmature,ROLE_ACTION_NAME.GJ,function(){r(a.creepArmature,ROLE_ACTION_NAME.DJ),egret.Tween.get(a.gp_bottom_creepModel).to({x:630},50).call(function(){t()})}),egret.setTimeout(function(){r(a.roleArmature,ROLE_ACTION_NAME.SJ,function(){a.roleArmature.animation.play(ROLE_ACTION_NAME.DJ)}),DragonBoneTools.playOnce({effectName:"common_skill_huikan_1",parent:a.gp_bottom_creepModel,scaleX:-1,x:-150}),DragonBoneTools.playOnce({effectName:"common_skill_huikan_2",parent:a.gp_bottom_roleModel}),s(!0,a.gp_bottom_roleModel)},a,375)});break;case 7:egret.Tween.get(a.gp_bottom_roleModel).to({x:330},50),DragonBoneTools.playOnce({effectName:"common_fbzcguaishiwang",parent:a.gp_bottom_creepModel}),egret.Tween.get(a.creepArmature).to({alpha:0},500).call(function(){a.gp_bottom_creepModel.removeChild(a.creepArmature),a.creepArmature=void 0}).wait(1500).call(function(){o=0,t()})}}).then(function(e){a.beginIdelBattle(++o)})},e.prototype.initUI=function(){this.gp_win.visible=!1;var e=Utils.UnlockMgr.getOpenInfo(MODULE.StormWar);this.startDt=e.openTimeDt,this.endDt=e.endTimeDt,this.startTimer(),DragonBoneTools.create("common_fbzcliansheng",function(e){e.anchorOffsetX=0,e.anchorOffsetY=0,e.x=this.gp_win.width/2-34,e.y=this.gp_win.height/2+14,e.animation.play(),this.gp_win.addChildAt(e,10)},this)},e.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.STORM_WAR_ACHIEVE,this.btn_achievement.getChildAt(0),this,BTN_ICON_NOTICE_POS)},e.prototype.addEvent=function(){var t=this;this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_map.visible=!1,PopUpManager.addPopUp({obj:new h.HelpDialog({moduleId:MODULE.StormWar})})},this),this.btn_ranking.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_map.visible=!1,h.AppFacade.getInstance().showSubView(h.RankMediator.N,h.RankMediator.SV.COMMON,{module:"STORM_WAR_RANK"})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.gp_map.visible=!1,h.AppFacade.getInstance().showSubView(h.RankMediator.N,h.RankMediator.SV.COMMON,{module:"STORM_WAR_REWARD"})},this),this.btn_achievement.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_map.visible=!1,h.AppFacade.getInstance().showSubView(h.RankMediator.N,h.RankMediator.SV.COMMON,{module:"STORM_WAR_ACHIEVE"})},this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.py.GetStormWarBattleRecordInfo(function(e){h.AppFacade.getInstance().showSubView(h.StormWarMediator.N,h.StormWarMediator.SV.RECORD,{info:e})})},this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){h.MainJumpConfig.jumpTo()},this),this.gp_bottom_res.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.py.selfPlayer.hangUpIncomeDuration;e&&0<e&&t.py.GetRewards(0,0,function(e){DragonBoneTools.playOnce({effectName:"common_airenbaozangkcz_1",parent:t.gp_bottom_res,doneCB:function(){h.GameMVC.backpackPy.handleClientReward(e.clientReward)}})})},this)},e.prototype.updateLayer=function(){var e=this.py.layer;this.layerCode!=e.layerCode&&(this.layerCode=e.layerCode,this.lastLayerCode||(this.lastLayerCode=this.layerCode),console.log("===== stormWar updateLayer ===== 切换场景"),this.loadMapResConf(this.layerCode,e),this.lastLayerCode=this.layerCode)},e.prototype.updateCreeps=function(){var i=[];this.py.creeps.forEach(function(e){var t=RiskEventType.StormWarCreep;e.remove&&(t=RiskEventType.None),i.push(new h.EventVO({config:void 0,customTrigger:void 0,eventId:void 0,fadeType:void 0,hudongAction:void 0,info:'{ "creepCode":'+e.creepCode+', "status":'+e.status+"}",isDirty:!0,isExpire:!1,isInited:!0,position:{id:null,isDirty:!0,layerId:null,num:null,type:null,x:e.pos.x,y:e.pos.y},type:t}))}),this.map.updateLayerEvent({events:i});for(var e=this.py.creeps.length-1;0<=e;e--)this.py.creeps[e].remove&&this.py.creeps.splice(e,1);this._idelPlaying||(this._idelPlaying=!0,this.beginIdelBattle(1))},e.prototype.updatePlayers=function(t){var i=this;void 0===t&&(t=!1),this.py.players.forEach(function(e){i.map.updateMapPlayerInfo(e,t)}),this.map.touchChildren=!0,this.map.touchEnabled=!1},e.prototype.removePlayer=function(e){this.map.removeStormWarPlayer(e)},e.prototype.updateSelfPlayer=function(){var e=this.py.selfPlayer,t=e.doubleHit;this.gp_win.visible=0<t,this.blb_win_num.text=""+t,this.lBattleDt=e.lBattleDt,this.updateBottom()},e.prototype.updateWar=function(){var e=this.py.war;e&&e.champion?this.lb_winer.text="S"+e.champion.serverId+"."+e.champion.name:this.lb_winer.text="暂无数据",e&&e.champion&&h.GameMVC.loginPy.serverSelect.area==e.champion.serverId&&h.GameMVC.loginPy.playerProxy.playerInfoVO.playerId==e.champion.playerId?this.map.me.showName(!0):this.map.me.showName(!1),this.map.updateStormChampion(e.champion)},e.prototype.loadMapResConf=function(e,t){var i=this;this.blb_layer.text=""+e,this.blb_layer0.text=""+e,this.map.removeAllStormWarPlayer();var n=void 0,o=void 0,a=t.players;for(var r in a)if(h.GameMVC.loginPy.isSelf(a[r].playerId)){n=a[r].pos.x,o=a[r].pos.y;break}var s=h.Config.stormWarLayer()[Number(e)];this.map.tiled!=s.tiled&&this.map.update({isInit:!0,tiled:s.tiled,theme:s.theme,h:s.long,w:s.wide,meStartTileX:n,meStartTileY:o});var c=this.py.selfPlayer.doubleHit;if(this.lastDoubleHit!=c&&0<c){this.lastDoubleHit=c;var l=1e3;this.lastLayerCode!=this.layerCode&&(l=2500),egret.setTimeout(function(){egret.Tween.get(i.blb_win_num).to({scaleX:1.2,scaleY:1.2},100).to({scaleX:.8,scaleY:.8},100).to({scaleX:1,scaleY:1},100)},this,l)}this.lastLayerCode!=this.layerCode&&(this.lastLayerCode=this.layerCode,egret.setTimeout(function(){egret.setTimeout(function(){i.gp_effect.visible=!0,egret.Tween.get(i.gp_effect).to({scaleX:3,scaleY:3},300).to({scaleX:1.8,scaleY:1.8},300).to({scaleX:2.2,scaleY:2.2,alpha:.4},500).call(function(){i.gp_effect.visible=!1,i.gp_effect.alpha=1})},i,500)},this,2e3))},e.prototype.updateRank=function(){this.gp_ranking.visible=!1,this.gp_empty.visible=!0,this.img_rank1.visible=!1,this.img_rank2.visible=!1,this.img_rank3.visible=!1,this.img_score1.visible=!1,this.img_score2.visible=!1,this.img_score3.visible=!1;var e=this.py.ranks;if(e){var t=e.ranks;Array.isArray(t)&&0<t.length&&(this.gp_ranking.visible=!0,this.gp_empty.visible=!1,t[0]?(this.lb_name1.text="S"+t[0].playerBaseInfo.serverId+"."+t[0].playerBaseInfo.name,this.lb_score1.text=""+t[0].key,this.img_rank1.visible=!0,this.img_score1.visible=!0):(this.lb_name1.text="",this.lb_score1.text=""),t[1]?(this.lb_name2.text="S"+t[1].playerBaseInfo.serverId+"."+t[1].playerBaseInfo.name,this.lb_score2.text=""+t[1].key,this.img_rank2.visible=!0,this.img_score2.visible=!0):(this.lb_name2.text="",this.lb_score2.text=""),t[2]?(this.lb_name3.text="S"+t[2].playerBaseInfo.serverId+"."+t[2].playerBaseInfo.name,this.lb_score3.text=""+t[2].key,this.img_rank3.visible=!0,this.img_score3.visible=!0):(this.lb_name3.text="",this.lb_score3.text=""));var i=e.selfRank;this.lb_my_ranking.text=""+i.rank,this.lb_my_score.text=""+i.key}},e.prototype.onBattleFinish=function(e){},e.prototype.startTimer=function(e,t){this.timer||(this.timer=new egret.Timer(1e3)),this.stopTimer(),this.timer.delay=e||1e3,this.timer.repeatCount=t||0,this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this),this.timer.reset(),this.timer.start()},e.prototype.stopTimer=function(){this.timer&&(this.timer.stop(),this.timerComFunc())},e.prototype.timerFunc=function(){var e=Utils.TimerManager.getServerTime(),t=!1;this.lBattleDt&&e-this.lBattleDt<this.StormWarAttackCD&&(t=!0),this.map&&this.map.me&&this.map.me.showState(t);var i=Utils.UnlockMgr.getOpenInfo(MODULE.StormWar),n=Utils.TimerManager.getServerTime(!1),o=this.endDt-n;if(this.pb_time.maximum=this.endDt-this.startDt,this.pb_time.value=o,!i.isOpen)return Utils.MsgUtils.addMidMsg("活动已结束!"),void h.AppFacade.getInstance().sendNotification(CN.STORM_WAR_FORCE_EXIT);this.intervalRank<=0?(this.py.GetStormWarRank(),this.intervalRank=STORM_WAR_UPDATE_RANK):this.intervalRank-=1,0<this.moveCD&&(this.moveCD-=1)},e.prototype.timerComFunc=function(){this.timer&&(this.timer.removeEventListener(egret.TimerEvent.TIMER,this.timerFunc,this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerComFunc,this))},e}(BaseFull);h.StormWarView=e,__reflect(e.prototype,"game.StormWarView")}(game||(game={})),function(e){var t=function(){};(game||(game={})).GameMVC=t,__reflect(t.prototype,"game.GameMVC")}(),function(n){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new o).register(),(new a).register(),(new r).register(),(new i).register()},e}();n.TeamExpeProcessor=e,__reflect(e.prototype,"game.TeamExpeProcessor");var t=function(e){function t(){return e.call(this,"teamExpedition.TeamExpeditionInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();n.AppFacade.getInstance().retrieveProxy(n.TeamExpePy.N).updateInfo(t.info,!0)},t}(n.ProcessorBase);__reflect(t.prototype,"TeamExpeInfoP");var i=function(e){function t(){return e.call(this,"teamExpedition.TeamExpeditionTeamListP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody(),i=n.AppFacade.getInstance().retrieveProxy(n.TeamExpePy.N);i.info?(Array.isArray(t.teams)&&(i.centerTeams.splice(0),t.teams.forEach(function(e){if(e.sectionId<=i.info.sectionId+1){var t=new n.TeamVO(e.team);t.otherInfo={sectionId:e.sectionId},i.centerTeams.push(t)}})),n.AppFacade.getInstance().updateView(n.TeamExpeMediator.N,n.TeamExpeMediator.SV.JIJIE_CENTER)):egret.warn("还没拉取组队副本数据，不处理队伍下推")},t}(n.ProcessorBase);__reflect(i.prototype,"TeamExpeditionTeamListP");var o=function(e){function t(){return e.call(this,"teamExpedition.TeamExpeditionAssistInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();n.AppFacade.getInstance().retrieveProxy(n.TeamExpePy.N).updateInfo(t.info)},t}(n.ProcessorBase);__reflect(o.prototype,"TeamExpeditionAssistInfoP");var a=function(e){function t(){return e.call(this,"teamExpedition.NewTeamArenaRecordP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();n.AppFacade.getInstance().retrieveProxy(n.TeamExpePy.N).updateRecordInfo(t.record)},t}(n.ProcessorBase);__reflect(a.prototype,"NewTeamExpeRecordP");var r=function(e){function t(){return e.call(this,"teamExpedition.ApplyRecordP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=n.AppFacade.getInstance().retrieveProxy(n.TeamExpePy.N);if(t.amILeader()){var i=e.getBody();t.applyRecords.push(new n.ApplyRecordVO(i.record)),NoticeManager.updateNotice(NT.TEAM_EXPE_APPLY_BTN)}},t}(n.ProcessorBase);__reflect(r.prototype,"ApplyRecordP")}(game||(game={})),function(l){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.isZiDong=!0,e.playerProxy=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),e.arenaRecords=new Array,e.centerTeams=new Array,e.applyRecords=new Array,e.addNotice(),e}return __extends(i,t),i.prototype.addNotice=function(){NoticeManager.registerCB(NT.TEAM_EXPE_REWARD,this.handleDotInfo,this,MODULE.TeamExpedition),NoticeManager.registerCB(NT.TEAM_EXPE_APPLY_BTN,this.handleApplyDotInfo,this,MODULE.TeamExpedition)},i.prototype.handleApplyDotInfo=function(){return this.amILeader()&&this.applyRecords&&0<this.applyRecords.length},i.prototype.handleDotInfo=function(){if(!this.info)return!1;this.info.sectionId;var e=this.info,t=e.targeted,i=l.Config.teamRewardConfig();for(var n in i){var o=i[n],a=-1!=t.indexOf(o.id),r=!a&&e.sectionId>=o.id;o.id;if(!a&&r)return!0}},i.prototype.updateApplyList=function(e){var t=this;this.applyRecords.splice(0),Array.isArray(e)&&e.forEach(function(e){t.applyRecords.push(new l.ApplyRecordVO(e))}),NoticeManager.updateNotice(NT.TEAM_EXPE_APPLY_BTN)},i.prototype.GetTeamExpeditionInfo=function(t){var i=this;Utils.Socket.send("teamExpedition","GetTeamExpeditionInfo",{}).then(function(e){i.updateInfo(e.info),t&&t()})},i.prototype.Challenge=function(n){l.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeTeamExpedition,customParams:{fightBg:"fight_scene_jjc"},pb1:"teamExpedition",pb2:"Challenge",params:{sectionId:n},doneCB:function(e){var t=l.Config.teamExpedition()[n],i=l.Config.teamExpedition()[n+1];i&&t.chapterId!=i.chapterId&&e&&1==e.winC&&l.Config.teamExpedition()[n+2]&&l.AppFacade.getInstance().sendNotification(CN.TEAMEXPE_OPEN_GATE),l.AppFacade.getInstance().sendNotification(CN.TEAMEXPE_UPDATE_MAP),l.AppFacade.getInstance().sendNotification(CN.TEAMEXPE_UPDATE_INFO),l.AppFacade.getInstance().sendNotification(CN.TEAMEXPE_UPDATE_TEAM_INFO)}})},i.prototype.GetTeamBattleRecord=function(t){var i=this;Utils.Socket.send("teamExpedition","GetArenaRecord",{}).then(function(e){i.updateRecordInfo(e.arenaRecords),t&&t()})},i.prototype.updateInfo=function(e,t){if(void 0===t&&(t=!1),this.info||(this.info=new l.TeamExpeInfoVO),t){var i=this.playerProxy.roleVo.playerId;if(this.isInTeam())if(e.teamInfo&&e.teamInfo.team){if(i==e.teamInfo.team.leader&&i!=this.info.teamInfo.team.leader)Utils.MsgUtils.addMidMsg('你已经成为"组队副本"队长');else if(i==e.teamInfo.team.leader&&e.teamInfo.team.members.length>this.info.teamInfo.team.members.length)for(var n=0,o=e.teamInfo.team.members;n<o.length;n++){for(var a=o[n],r=!1,s=0,c=this.info.teamInfo.team.members;s<c.length;s++){if(c[s].baseInfo.playerId==a.baseInfo.playerId){r=!0;break}}r||Utils.MsgUtils.addMidMsg(a.baseInfo.name+' 加入了你的"组队副本"队伍')}}else Utils.MsgUtils.addMidMsg('你已经被踢出"组队副本"队伍了')}this.info.update(e),this.handleDotInfo(),l.AppFacade.getInstance().retrieveProxy(l.FightPy.N).isInFight||(l.AppFacade.getInstance().sendNotification(CN.TEAMEXPE_UPDATE_INFO),l.AppFacade.getInstance().sendNotification(CN.TEAMEXPE_UPDATE_TEAM_INFO))},i.prototype.updateRecordInfo=function(e){var t=this;this.arenaRecords.splice(0),e.forEach(function(e){t.arenaRecords.push(new l.TeamBattleRecord(e))}),this.arenaRecords.sort(function(e,t){return t.battleDt-e.battleDt})},i.prototype.updateTeam=function(e){this.info.teamInfo.update(e),l.AppFacade.getInstance().sendNotification(CN.TEAMEXPE_UPDATE_TEAM_INFO)},i.prototype.isInTeam=function(){return this.info&&this.info.teamInfo&&this.info.teamInfo.team&&this.info.teamInfo.team.id&&!0},i.prototype.GetPlayerTeamExpeditionInfo=function(e,t){Utils.Socket.send("teamExpedition","GetPlayerTeamExpeditionInfo",{playerId:e}).then(function(e){t&&t(e.info)})},Object.defineProperty(i.prototype,"team",{get:function(){return this.info.teamInfo.team},enumerable:!0,configurable:!0}),i.prototype.amILeader=function(){return this.isInTeam()&&this.info.teamInfo.team.leader==this.playerProxy.playerInfoVO.playerId},i.prototype.GetCenterTeam=function(t){var i=this;Utils.Socket.send("teamExpedition","GetTeamList",{}).then(function(e){i.centerTeams.splice(0),Array.isArray(e.teams)&&e.teams.forEach(function(e){var t=new l.TeamVO(e.team);t.otherInfo={sectionId:e.sectionId},i.centerTeams.push(t)}),t&&t()})},i.prototype.GetApplyRecord=function(s){var c=this;Utils.Socket.send("teamExpedition","GetApplyRecord",{}).then(function(e){for(var t=[],a={},i=0,n=e.records;i<n.length;i++){var o=n[i];t.push(o.member.baseInfo.playerId),a[o.member.baseInfo.playerId]=o}var r=[];c.GetInviteFriendIds({playerIds:t},function(e){for(var t=0,i=e;t<i.length;t++){var n=i[t],o=a[n];o&&r.push(o)}c.updateApplyList(r),s&&s()})})},i.prototype.Quit=function(t,i){var n=this;void 0===i&&(i=!1),Utils.Socket.send("teamExpedition","QuitTeam",{}).then(function(e){i||Utils.MsgUtils.addMidMsg("你已退出了队伍"),n.updateTeam(e.teams),t&&t(),l.AppFacade.getInstance().retrieveProxy(l.FriendPy.N).clearInviteHistory(MODULE.TeamExpedition)})},i.prototype.Create=function(e,t,i){var n=this;Utils.Socket.send("teamExpedition","CreateTeam",{name:e,sectionId:i&&i.sectionId}).then(function(e){n.updateTeam(e.team),t&&t()})},i.prototype.Refresh=function(e){return this.GetCenterTeam(e)},i.prototype.Search=function(e,t){var i=this;Utils.MathUtils.isNumber(e)?Utils.Socket.send("teamExpedition","SearchTeam",{id:Number(e)}).then(function(e){i.centerTeams.splice(0),Array.isArray(e.teams)&&e.teams.forEach(function(e){i.centerTeams.push(new l.TeamVO(e.team))}),t&&t()}):Utils.MsgUtils.addMidMsg("请输入正确的队伍ID")},i.prototype.Apply=function(e,t,i){var n=this;void 0===i&&(i=!1),this.info&&this.info.teamInfo.team.id==e?t&&t():Utils.UnlockMgr.checkPass(MODULE.TeamExpedition,!1).allow&&Utils.Socket.send("teamExpedition","ApplyTeam",{id:e,isInvite:i}).then(function(e){i||Utils.MsgUtils.addMidMsg("已申请"),e.team&&n.updateTeam(e.team),t&&t()})},i.prototype.Kick=function(e,t){var i=this;Utils.Socket.send("teamExpedition","TickMember",{playerId:e}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.Agree=function(e,t){var i=this;Utils.Socket.send("teamExpedition","AgreeMember",{playerId:e}).then(function(e){i.updateTeam(e.team),i.updateApplyList(e.records),t&&t()})},i.prototype.Refuse=function(e,t){var i=this;Utils.Socket.send("teamExpedition","RefuseMember",{playerId:e}).then(function(e){i.updateTeam(e.team),i.updateApplyList(e.records),t&&t()})},i.prototype.SwitchLeader=function(e,t){var i=this;Utils.Socket.send("teamExpedition","TransferLeader",{playerId:e}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.SaveFormation=function(e,t){var i=this;Utils.Socket.send("teamExpedition","ChangeFormation",{playerIds:e}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.Archive=function(t){var i=this;Utils.Socket.send("teamExpedition","Archive",{}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.Invite=function(t){var i=this;Utils.Socket.send("teamExpedition","Invite",{}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.GetInviteFriendIds=function(e,t){var i=this;Utils.Socket.send("teamExpedition","GetInviteFriendIds",{playerIds:e.playerIds}).then(function(e){i.invitePlayerIds=e.playerIds,t&&t(e.playerIds)})},i.N="TeamExpePy",i}(BaseProxy);l.TeamExpePy=e,__reflect(e.prototype,"game.TeamExpePy",["ICommonJiJieInterface"])}(game||(game={})),function(c){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="TeamExpeViewSkin",e.proxy=c.AppFacade.getInstance().retrieveProxy(c.TeamExpePy.N),e.backPy=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N),e.playerPy=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N),e.mainPy=c.AppFacade.getInstance().retrieveProxy(c.MainPy.N),e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.removeNotice(),this.map.reset()},e.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.TEAM_EXPE_REWARD,this.btn_reward.$children[0],this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.TEAM_EXPE_APPLY_CENTER,this.btn_center.$children[0],this,{percentX:90/146,percentY:8/85})},e.prototype.removeNotice=function(){NoticeManager.removeNoticeListener(NT.TEAM_EXPE_REWARD),NoticeManager.removeNoticeListener(NT.TEAM_EXPE_APPLY_CENTER)},e.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btn),this.visible=!1,this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.MainJumpConfig.jumpTo()},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeTeamExpedition})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"TEAM_COPY"})},this),this.btn_gate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.openGate()},this),this.btn_center.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.proxy.isInTeam()?c.AppFacade.getInstance().showSubView(c.TeamExpeMediator.N,c.TeamExpeMediator.SV.JIJIE_MY_TEAM):c.AppFacade.getInstance().showSubView(c.TeamExpeMediator.N,c.TeamExpeMediator.SV.JIJIE_CENTER)},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new c.HelpDialog({moduleId:MODULE.TeamExpedition})})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"TEAMCOPY"})},this),this.gp_map.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGpMapClick,this),this.addNotice(),this.map=Utils.MapUtils.generateCommon({source:MODULE.TeamExpedition,multiLayerScroller:this.cu_mls,loadingParent:this.getParentView(),miniMapParent:Utils.SDKMgr.getPerformConfig(6)?void 0:this.gp_mini_map,onTouchTap:function(e,t){i.mainPy.SyncCoordinateInfo(e,t,i.curChapterId,MODULE.TeamExpedition)}}),this.gp_map.addChildAt(this.map,0),this.fetchExpeInfo()},e.prototype.openGate=function(){var t=this;PopUpManager.addPopUp({obj:new c.TeamGate,closeCB:function(e){e&&t.jumpToChatper(e,!1)}})},e.prototype.fetchExpeInfo=function(){var i=this;this.proxy.GetTeamExpeditionInfo(function(){i.mainPy.GetCoordinateInfo(MODULE.TeamExpedition,function(){var e=i.mainPy.getMyCoordinateInfo(MODULE.TeamExpedition);if(e.coordinate.z)i.jumpToChatper(e.coordinate.z||1);else{var t=c.Config.teamExpedition()[i.proxy.info.sectionId+1];t?i.jumpToChatper(t.chapterId):i.jumpToChatper(1)}i.updateCoordInfo()})})},e.prototype.jumpToChatper=function(e,t){var i=this;if(void 0===t&&(t=!0),e!=this.curChapterId)if(t){var n=this.mainPy.getMyCoordinateInfo(MODULE.TeamExpedition);this.curChapterId=e;var o=c.Config.teamExpeditionChatper()[e];o||(egret.error("组队副本跳转失败",e),o=c.Config.teamExpeditionChatper()[1]);var a=JSON.parse(o.initLocation);this.map.update({isInit:!0,tiled:o.tiled,theme:o.theme,w:o.w,h:o.h,meStartTileX:a[0],meStartTileY:a[1]}),this.map.updateNPC({curPosVO:{x:n.coordinate.x,y:n.coordinate.y,isFixed:!0},followers:n.team.members}),this.updateMap(),this.visible=!0}else{var r=c.Config.teamExpeditionChatper()[e],s=JSON.parse(r.initLocation);this.mainPy.SyncCoordinateInfo(s[0],s[1],e,MODULE.TeamExpedition,function(){i.jumpToChatper(e)})}},e.prototype.updateMap=function(){if(this.curChapterId){var e=c.Config.getTeamExpeditionDetailByChapter(this.curChapterId),a=[],r=this.proxy.info.sectionId,s=void 0;this.proxy.info.teamInfo&&this.proxy.info.teamInfo.sectionId&&(s=this.proxy.info.teamInfo.sectionId);for(var t=function(t){var e=!1,i=!1,n=!1;if(t.id<=r?n=e=!0:t.id==r+1&&(e=!0),null!=s&&t.id>s&&(i=!0),!e)return"continue";var o=JSON.parse(t.sectionLocation);a.push(new c.EventVO({fadeType:1==t.type?FadeRiskEventType.Creep:FadeRiskEventType.Boss,position:{x:o[0],y:o[1]},config:t,isDirty:!0,customTrigger:function(e){e&&c.AppFacade.getInstance().showSubView(c.TeamExpeMediator.N,c.TeamExpeMediator.SV.DETAIL,{config:t})},hudongAction:{showSign:!!n&&"maoxian_txt_ytg_png",needGray:i}}))},i=0,n=e;i<n.length;i++){t(n[i])}0<a.length&&r==a[a.length-1].config.id-1&&(a[a.length-1].hudongAction.showSign="_guaji_m_json.mx_img_jian3"),this.map.cleanAllEP(),this.map.updateLayerEvent({events:a})}},e.prototype.updateView=function(e){if(this.proxy.info){var t=c.Config.constConfig().MaxTeamExpeditionHelpRewardTime.constValue;this.blb_count.text=Number(t)-this.proxy.info.helpTime+"/"+t;var i=this.mainPy.getMyCoordinateInfo(MODULE.TeamExpedition);if(i&&null!=i.coordinate.z&&i.coordinate.z){var n=c.Config.teamExpeditionChatper()[i.coordinate.z];this.lb_info.text=n.name,this.lb_title.text=n.name}else{var o=c.Config.teamExpedition()[this.proxy.info.sectionId||1];n=c.Config.teamExpeditionChatper()[o.chapterId];this.lb_info.text=n.name,this.lb_title.text=n.name}}},e.prototype.onGpMapClick=function(){this.map.touchChildren||Utils.MsgUtils.addMidMsg("只有队长可以操作")},e.prototype.updateCoordInfo=function(){var e=this.mainPy.getMyCoordinateInfo(MODULE.TeamExpedition);if(e.amILeader?this.map.touchEnabled=this.map.touchChildren=!0:(this.map.touchEnabled=this.map.touchChildren=!1,e.coordinate.isDirty?this.jumpToChatper(e.coordinate.z):this.map.handleTouchTap(e.coordinate.x,e.coordinate.y)),e.coordinate.z){var t=c.Config.teamExpeditionChatper()[e.coordinate.z];this.lb_info.text=t.name,this.lb_title.text=t.name}this.lb_info2.text="X:"+e.coordinate.x+" Y:"+e.coordinate.y,this.map.isInited&&this.map.updateNPC({followers:e.team.members}),e.coordinate.iAmClean()},e.prototype.updateTeamInfo=function(){this.updateMap()},e}(BaseFull);c.TeamExpeView=e,__reflect(e.prototype,"game.TeamExpeView")}(game||(game={})),function(f){var e=function(u){function e(e){var t,i=u.call(this)||this;return i.mainpy=f.AppFacade.getInstance().retrieveProxy(f.MainPy.N),i.GATE_LAB=((t={})[1]={up:"maoxian_txt_wujinhuangyuan00_png",down:"maoxian_txt_wujinhuangyuan01_png",enable:!1},t[2]={up:"maoxian_txt_mihuanshazhou00_png",down:"maoxian_txt_mihuanshazhou01_png",enable:!1},t),i.curSelectIndex=0,i.heroModel=new customui.RoleDynamicModel,i.pk=new eui.Image,i.lock=new eui.Image,i.lockBack=new eui.Image,i.lb_content=new eui.Label,i.skinName="GuajiGateListPanelSkin2",i.params=e,i.py=f.AppFacade.getInstance().retrieveProxy(f.PlayerPy.N),i.teamExpePy=f.AppFacade.getInstance().retrieveProxy(f.TeamExpePy.N),i}return __extends(e,u),e.prototype.childrenCreated=function(){var n=this;u.prototype.childrenCreated.call(this),this.img_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.hide()},this);var e=1,t=this.mainpy.getMyCoordinateInfo(MODULE.TeamExpedition),i=f.Config.teamExpedition(),o=f.Config.teamExpeditionChatper();if(t.coordinate.z)e=t.coordinate.z;else{var a=i[this.teamExpePy.info.sectionId+1];e=a?a.chapterId:1}e%20==0&&this.teamExpePy.info.sectionId%5==0?this.curSelectIndex=Math.floor(e/20):this.curSelectIndex=Math.floor((e-1)/20);for(var r=this.gp_gate.$children.length,s=function(e){var t=c["gp_gate"+e];if(t){var i=function(e){for(var t=1;t<=r;t++){var i=n["gate_"+t];i&&(i.source=1<t&&t<r?t==e+1?"maoxian_btn_yeqianl02_png":"maoxian_btn_yeqiana02_png":t==e+1?"maoxian_btn_yeqianl01_png":"maoxian_btn_yeqiana01_png",n["gate_lab_"+t]&&(n["gate_lab_"+t].source=t==e+1?n.GATE_LAB[t].down:n.GATE_LAB[t].up))}};1==e&&i(c.curSelectIndex),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.curSelectIndex=e-1,i(n.curSelectIndex),n.updateView()},c)}},c=this,l=1;l<=r;l++)s(l);this.gp_gate.visible=!i[this.teamExpePy.info.sectionId+1]||20<i[this.teamExpePy.info.sectionId+1].chapterId;for(var h=function(e){var t=p["map_"+o[e].id];t&&(t.pixelHitTest=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.opperationParams=20*n.curSelectIndex+e,n.hide()},p),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.scaleX=t.scaleY=1.1},p),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.scaleX=t.scaleY=1},p))},p=this,d=1;d<=20;d++)h(d);this.updateView()},e.prototype.updateView=function(){var l=this,h=1,e=this.mainpy.getMyCoordinateInfo(MODULE.TeamExpedition);if(e.coordinate.z)h=e.coordinate.z;else{var t=f.Config.teamExpedition()[this.teamExpePy.info.sectionId+1];h=t?t.chapterId:1}var p=f.Config.teamExpedition(),d=f.Config.teamExpeditionChatper(),u=!0;this.pk.source="mx_img_dizuo_png",this.heroModel.visible=!1,this.lb_content.visible=!1,this.pk.visible=!1,this.lock.visible=!1,this.lockBack.visible=!1;for(var i=function(e){var t=g["map_"+d[e].id];t.touchEnabled=!1,UIActionManager.setAbsGrey(t,!1);var i=e-1&&g["gp_line_"+d[e-1].id];i&&(i.visible=!1);var n=20*g.curSelectIndex+e;if(t)if(u){var o=p[g.teamExpePy.info.sectionId+1],a=f.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.TeamExpedition,{id:n});if(d[n]&&g.py.playerInfoVO.level<d[n].unlockLv||o&&d[n]&&d[n].id>o.chapterId||a.isBelonged&&!a.unlock){g["lb_"+d[e].id].text=d[n].name,t.touchEnabled=!1,g.lock.visible=!0,g.lock.source="maoxian_img_suo_png",g.lockBack.visible=!0,g.lockBack.source="_guaji_m_json.mx_img_mingchengdi",UIActionManager.setAbsGrey(t),g.lock.scaleX=g.lock.scaleX=.9,g.lock.x=g["lb_"+d[e].id].x-31,g.lock.y=g["lb_"+d[e].id].y-10,g.lockBack.x=g["lb_"+d[e].id].x-28,g.lockBack.y=g["lb_"+d[e].id].y+22,g.lb_content.visible=!0,g.lb_content.size=17,g.lb_content.textColor=16187392,!g.lock.parent&&g.gp_lab.addChild(g.lock),!g.lockBack.parent&&g.gp_lab.addChild(g.lockBack);var r=function(){l.py.playerInfoVO.level<d[e].unlockLv?(l.lb_content.text="("+d[n].unlockLv+"级后解锁)",l.lb_content.x=l.lockBack.x+23,l.lb_content.y=l.lockBack.y+5,l.lockBack.width=l.lb_content.width+50):(l.lb_content.text="(通过前一章解锁)",l.lb_content.x=l.lockBack.x,l.lb_content.y=l.lockBack.y+5,l.lockBack.width=l.lb_content.width+50,l.lockBack.x=l.lockBack.x-23)};a.isBelonged?a.unlock?r():(g.lb_content.text="(封印之地解锁)",g.lb_content.x=g.lockBack.x,g.lb_content.y=g.lockBack.y+5,g.lockBack.width=g.lb_content.width+50):r(),!g.lb_content.parent&&g.gp_lab.addChild(g.lb_content),u=!1}else if(d[n])t.touchEnabled=!0,i&&(i.visible=!0),g["lb_"+d[e].id].text=d[n].name;else{var s=d[e];t.touchEnabled=!1,g.lockBack.visible=!0,g.lockBack.source="_guaji_m_json.mx_img_mingchengdi",g.lock.visible=!0,g.lock.source="maoxian_img_suo_png",UIActionManager.setAbsGrey(t),g.lock.scaleX=g.lock.scaleX=.9,g.lock.x=g["lb_"+s.id].x+20,g.lock.y=g["lb_"+s.id].y-15,g.lockBack.x=g["lb_"+s.id].x-28,g.lockBack.y=g["lb_"+s.id].y+22,g.lb_content.visible=!0,g.lb_content.size=17,g.lb_content.textColor=16187392,!g.lock.parent&&g.gp_lab.addChild(g.lock),!g.lockBack.parent&&g.gp_lab.addChild(g.lockBack),g.lb_content.text="(当前章节未开放)",g.lb_content.x=g.lockBack.x,g.lb_content.y=g.lockBack.y+5,g.lockBack.width=g.lb_content.width+50,g.lockBack.x=g.lockBack.x-23,!g.lb_content.parent&&g.gp_lab.addChild(g.lb_content),g["lb_"+d[e].id].text="",u=!1,g.teamExpePy.info.sectionId<5*(n-1)&&(g.lock.visible=!1,g.lockBack.visible=!1,g.lb_content.visible=!1)}}else UIActionManager.setAbsGrey(t),t.touchEnabled=!1,g["lb_"+d[e].id].text="";if(d[n]&&h==d[n].id){g.heroModel.visible=!0,g.heroModel.scaleX=g.heroModel.scaleY=.7,g.heroModel.update({reqStyle:ROLE_STYLE.Fashion});var c=g["lb_"+d[e].id];c&&(g.heroModel.x=c.x+42,g.heroModel.y=c.y-16,g.pk.visible=!0,g.pk.x=c.x+25,g.pk.y=c.y-28,g.gp_lab.addChild(g.pk),!g.heroModel.parent&&g.gp_lab.addChild(g.heroModel))}},g=this,n=1;n<=20;n++)i(n)},e}(BasePanel);f.TeamGate=e,__reflect(e.prototype,"game.TeamGate")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="TeamExpeditionChallengeSkin",e.proxy=i.AppFacade.getInstance().retrieveProxy(i.TeamExpePy.N),e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward_items=new Array,this.inButton()},e.prototype.inButton=function(){var e=this;this.challge_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.proxy.isInTeam()?e.proxy.amILeader()?e.proxy.Challenge(e.curSectionId):Utils.MsgUtils.addMidMsg("只有队长可发起挑战"):e.proxy.Challenge(e.curSectionId),e.mediator.hideSubView(e)},this),this.challge_join.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.mediator.hideSubView(e),i.AppFacade.getInstance().showSubView(i.TeamExpeMediator.N,i.TeamExpeMediator.SV.JIJIE_CENTER)},this),this.commonTanKuang.img_title_bg.visible=!1,this.commonTanKuang.onCloseCB=function(){e.mediator.hideSubView(e)}},e.prototype.updateView=function(e,t){this.proxy.isInTeam()&&(this.challge_fight.label="挑战",this.challge_join.parent&&this.challge_join.parent.removeChild(this.challge_join));var i=e.config;this.curSectionId=i.id,this.img_ylq.visible=this.img_ytg.visible=this.proxy.info.sectionId>=this.curSectionId,this.currentState="can";for(var n=0,o=this.reward_items;n<o.length;n++){var a=o[n];a&&a.parent&&a.parent.removeChild(a)}for(var r=0,s=0,c=JSON.parse(i.rewards);s<c.length;s++){var l=c[s],h=customui.BaseItemFactory.create(21);h.updateData({type:l[0],code:l[1],num:l[2]}),h.y=0,h.x=0+r++*(h.width+30)*.7,h.scaleX=.7,h.scaleY=.7,this.reward_items.push(h),this.gp_reward_show.addChild(h)}this.gp_enermy.removeChildren();for(var p=1;p<=6;p++){var d=JSON.parse(i["creep"+p]);if(d&&""!=d){var u=customui.BaseItemFactory.create();u.updateData({type:EEntityType.EEntityTypeHero,id:d[0]}),u.scaleX=u.scaleY=.7,this.gp_enermy.addChild(u),u.touchEnabled=!1}}},e}(BasePanel);i.TeamExpeditionChallengeView=e,__reflect(e.prototype,"game.TeamExpeditionChallengeView")}(game||(game={})),function(s){var e=function(t){function e(){var e=t.call(this)||this;return e.teamExpePy=s.AppFacade.getInstance().retrieveProxy(s.TeamExpePy.N),e.mainPy=s.AppFacade.getInstance().retrieveProxy(s.MainPy.N),e.commonPy=s.AppFacade.getInstance().retrieveProxy(s.TeamExpePy.N),e}return __extends(e,t),e.prototype.onViewCreated=function(){this.list.itemRenderer=i},e.prototype.onViewRemove=function(){},e.prototype.onShowMyTeam=function(){var e=s.Config.teamExpedition()[this.commonPy.info.teamInfo.sectionId];s.AppFacade.getInstance().showSubView(s.TeamExpeMediator.N,s.TeamExpeMediator.SV.JIJIE_MY_TEAM,{tips:e.name})},e.prototype.showCreatePanel=function(e){var t=this,i=Object.keys(s.Config.teamExpedition()),n=Number(i[i.length-1]),o=Math.min(this.teamExpePy.info.sectionId+1,n),a=s.Config.teamExpedition()[o],r=s.Config.teamExpeditionChatper()[a.chapterId];PopUpManager.addPopUp({obj:new s.CommonJiJieTeamCreatePanel({defaultName:this.playerPy.playerInfoVO.name,tips:"创建 "+r.name+"-"+a.name+" 的队伍，\n给你的队伍起个名字吧",doneCB:function(e){t.commonPy.Create(e,function(){t.hide(),t.onShowMyTeam()},{sectionId:o})}})})},e}(s.CommonJiJieCenterPanel);s.TeamExpeJiJieCenterPanel=e,__reflect(e.prototype,"game.TeamExpeJiJieCenterPanel");var i=function(i){function e(){return null!==i&&i.apply(this,arguments)||this}return __extends(e,i),e.prototype.dataChanged=function(){i.prototype.dataChanged.call(this);var e=s.Config.teamExpedition()[this.vo.otherInfo.sectionId];if(e){var t=s.Config.teamExpeditionChatper()[e.chapterId];t&&(this.lb_time.visible=!0,this.lb_time.text=t.name+"-"+e.name)}},e}(s.CommonJiJieCenterItemRender);__reflect(i.prototype,"TeamExpeJiJieCenterItemRender")}(game||(game={})),function(n){var e=function(i){function e(e){var t=i.call(this,e)||this;return t.commonPy=n.AppFacade.getInstance().retrieveProxy(n.TeamExpePy.N),t}return __extends(e,i),e.prototype.onViewCreated=function(){},e.prototype.onViewRemove=function(){},e.prototype.onShowMyTeam=function(){n.AppFacade.getInstance().showSubView(n.TeamExpeMediator.N,n.TeamExpeMediator.SV.JIJIE_MY_TEAM)},e.prototype.onFetch=function(e){this.commonPy.GetApplyRecord(function(){e()})},e}(n.CommonJiJieMyTeamApplyPanel);n.TeamExpeJiJieMyTeamApplyPanel=e,__reflect(e.prototype,"game.TeamExpeJiJieMyTeamApplyPanel")}(game||(game={})),function(s){var e=function(n){function e(){var e=n.call(this)||this;return e.commonPy=s.AppFacade.getInstance().retrieveProxy(s.TeamExpePy.N),e}return __extends(e,n),Object.defineProperty(e.prototype,"py",{get:function(){return this.commonPy},enumerable:!0,configurable:!0}),e.prototype.canKick=function(){return!0},e.prototype.inviteCallback=function(){var e=s.AppFacade.getInstance().retrieveProxy(s.TeamExpePy.N),a=s.Config.broadcastConfig()[26].content,t=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N),r=[[2,t.playerInfoVO.name,t.playerInfoVO.playerId,EEntityType.EEntityTypePlayer],[2,Math.ceil(e.info.teamInfo.sectionId/5)],[2,e.info.teamInfo.sectionId%5==0?5:e.info.teamInfo.sectionId%5],[1,"<<点击入队",e.info.teamInfo.team.id,MODULE.TeamExpedition]];s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N).getFriendList(function(){PopUpManager.addPopUp({obj:new s.InviteFriendView({moduleId:MODULE.TeamExpedition,tabbarType:11,inviteCallback:function(i,n){for(var e=s.AppFacade.getInstance().retrieveProxy(s.TeamExpePy.N),t=0,o=e.team.members;t<o.length;t++){if(o[t].baseInfo.playerId==i)return void Utils.MsgUtils.addMidMsg("该好友已经在队伍里面了")}e.GetPlayerTeamExpeditionInfo(i,function(e){if(null!=e.sectionId){var t=s.AppFacade.getInstance().retrieveProxy(s.MainPy.N);t.addPrivatePlayer(i),t.SendMessage(EChatChannelType.EChatChannelTypePrivate,a,i,void 0,EChatSendCheckType.None,JSON.stringify(r),!0),s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N).addInviteHistory(MODULE.TeamExpedition,i),n&&n()}else Utils.MsgUtils.addMidMsg("高通关数队长不能邀请低通关数好友玩家")})}})})})},e.prototype.onViewCreated=function(){NoticeManager.addNoticeListener(NT.TEAM_EXPE_APPLY_BTN,this.btn_apply.$children[0],this,{percentX:.8,percentY:.02}),NoticeManager.addNoticeListener},e.prototype.onViewRemove=function(){NoticeManager.removeNoticeListener(NT.TEAM_EXPE_APPLY_BTN)},e.prototype.updateView=function(e){if(n.prototype.updateView.call(this),this.btn_switch.enabled=this.btn_apply.enabled=this.btn_switch.enabled=this.commonPy.amILeader(),this.lb_tips.visible=!1,e&&this.py.isInTeam()&&this.py.info.teamInfo.sectionId){var t=s.Config.teamExpedition()[this.py.info.teamInfo.sectionId],i=s.Config.teamExpeditionChatper()[t.chapterId];this.cu_dtc.blb_title.text=i.name+"-"+t.name}NoticeManager.updateNotice(NT.TEAM_EXPE_APPLY_BTN)},e.prototype.onShowCenter=function(){s.AppFacade.getInstance().showSubView(s.TeamExpeMediator.N,s.TeamExpeMediator.SV.JIJIE_CENTER)},e.prototype.onShowApply=function(t){var i=[];this.py.applyRecords.forEach(function(e){i.push(e.member.baseInfo.playerId)}),this.py.GetInviteFriendIds({playerIds:i},function(e){PopUpManager.addPopUp({obj:new s.TeamExpeJiJieMyTeamApplyPanel({doneCB:function(){t&&t()},moduleId:MODULE.TeamExpedition})})})},e.prototype.onFetch=function(e){this.py.GetTeamExpeditionInfo()},e}(s.CommonJiJieMyTeamPanel);s.TeamExpeJiJieMyTeamPanel=e,__reflect(e.prototype,"game.TeamExpeJiJieMyTeamPanel")}(game||(game={})),function(e){var t=function(t){function i(e){return void 0===e&&(e=null),t.call(this,i.N,e)||this}return __extends(i,t),i.prototype.initSubView=function(){this.addSubView(i.SV.ENTRANCE,e.TeamPlayEntranceView)},i.prototype.listNotificationInterests=function(){return[CN.HIDE_LOADING]},i.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_LOADING:this.hideAllSubView()}},i.N="TeamPlayEntranceMediator",i.SV={ENTRANCE:1},i}(BaseMediator);e.TeamPlayEntranceMediator=t,__reflect(t.prototype,"game.TeamPlayEntranceMediator")}(game||(game={})),function(e){var t=function(){function e(){}return e.registerAll=function(){},e}();e.TeamPlayEntranceProcessor=t,__reflect(t.prototype,"game.TeamPlayEntranceProcessor")}(game||(game={})),function(e){var t=function(e){function t(){return e.call(this,t.N)||this}return __extends(t,e),t.N="TeamPlayEntrancePy",t}(BaseProxy);e.TeamPlayEntrancePy=t,__reflect(t.prototype,"game.TeamPlayEntrancePy")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.ENTRANCE_CONFIG={TEAM_ARENA:{desc:"组队竞技场",rankingType:void 0,moduleId:MODULE.TeamArena,bg:"wfrk_img_rukou_zdjj_png"},TEAM_COPY:{desc:"组队副本",rankingType:void 0,moduleId:MODULE.TeamExpedition,bg:"wfrk_img_rukou_zdfb_png"}},e.skinName="TeamEntranceViewSkin",Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_view_close),e._popActionType=5,e._removeActionType=6,e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.img_title.source="wfrk_txt_fbtz_png"},e.prototype.initList=function(){this.item_list=new eui.List;var e=new eui.VerticalLayout;(this.item_list.layout=e).gap=10,e.horizontalAlign=egret.HorizontalAlign.CENTER,this.item_list.itemRenderer=n,this.scroller.viewport=this.item_list},e.prototype.updateView=function(){var e=[];for(var t in this.ENTRANCE_CONFIG)e.push(this.ENTRANCE_CONFIG[t]);this.item_list.dataProvider=new eui.ArrayCollection(e),this.gp_root.height=179*e.length+10*(e.length-1)+73+236},e}(BasePanel);i.TeamPlayEntranceView=e,__reflect(e.prototype,"game.TeamPlayEntranceView");var n=function(t){function e(){var e=t.call(this)||this;return e.skinName="EntranceView_ListItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gp_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.MainJumpConfig.jumpTo(this.data.moduleId)&&i.AppFacade.getInstance().hideSubView(i.TeamPlayEntranceMediator.N,i.TeamPlayEntranceMediator.SV.ENTRANCE)},this)},e.prototype.dataChanged=function(){this.img_bg.source=this.data.bg},e}(eui.ItemRenderer);__reflect(n.prototype,"EntranceView_ListItem")}(game||(game={})),function(l){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=l.AppFacade.getInstance().retrieveProxy(l.TitlePy.N),e.selectIndex=0,e.attrGpsFree=[],e.data=[],e.skinName="TitleMainView",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="称 号",this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.roleModel.update({reqStyle:ROLE_STYLE.Fashion|ROLE_STYLE.Horse|ROLE_STYLE.Magical|ROLE_STYLE.Title}),this.gp_attrs.removeChildren(),this.initList(),this.activateComponent(),this.img_icon.visible=!1},e.prototype.initList=function(){this.list_root.itemRenderer=r,this.list_root.addItemTapEvent(this.onItemTap,this),this.list_root.setChoseFrame("ch_img_xuanzhong_png"),this.list_root.img_lastOne.source="sycx_img_jiantou_png",this.list_root.img_nextOne.source="sycx_img_jiantou_png";var e=new eui.HorizontalLayout;e.gap=15,this.list_root.layout=e;var t=l.Config.titleConfig();for(var i in this.data=[],t){var n=t[i],o=this.proxy.getCodeDt(n.code),a=JSON.parse(n.costs);this.data.push({code:n.code,icon:n.icon,frame:"ch_img_dikuang0"+n.color+"_png",notice:-1==o&&l.GameMVC.backpackPy.checkEnough(a,!1)?0:1,putOn:n.code==this.proxy.titleInfo.code?0:1})}this.data.sort(l.GeneralConfig.simpleSort("putOn","notice","code"))},e.prototype.onItemTap=function(e){this.selectIndex=e.itemIndex,this.updateBaseInfo()},e.prototype.updateView=function(e){var t=l.Config.titleConfig(),i=this.proxy.titleInfo;for(var n in this.updateBaseInfo(),this.data=[],t){var o=t[n],a=this.proxy.getCodeDt(o.code),r=JSON.parse(o.costs);this.data.push({code:o.code,icon:o.icon,jumpModule:o.jumpModule,frame:"ch_img_dikuang0"+o.color+"_png",notice:-1==a&&l.GameMVC.backpackPy.checkEnough(r,!1)?0:1,putOn:o.code==i.code?0:1,hasActivate:0<=a?0:1})}this.data.sort(l.GeneralConfig.simpleSort("putOn","notice","hasActivate","code")),this.list_root.dataProvider=new eui.ArrayCollection(this.data),this.list_root.initChangeTo(e&&e.index||0,!0)},e.prototype.updateBaseInfo=function(){var a=this,e=l.Config.titleConfig(),t=this.data[this.selectIndex]&&this.data[this.selectIndex].code||0,i=e[t];if(i){this.img_icon.source=i.icon,this.roleModel.update({reqStyle:ROLE_STYLE.Fashion|ROLE_STYLE.Horse|ROLE_STYLE.Magical|ROLE_STYLE.Title,titleCode:t}),this.lb_desc.text=i.desc,this.timer&&egret.clearInterval(this.timer),this.gp_time.visible=!1;var n=this.proxy.titleInfo,o=this.proxy.getCodeDt(t);if(0<o){var r=o+i.cycle-Utils.TimerManager.getServerTime();0<r&&(this.gp_time.visible=!0,this.bm_leftTime.text=Utils.TimerManager.getFormatBySecond1(r),this.timer=egret.setInterval(function(){a.bm_leftTime.text=Utils.TimerManager.getFormatBySecond1(r)},this,1e3))}if(UIActionManager.setAbsGrey(this.btn_ope,!1),t==n.code)this.btn_ope.label="",this.btn_ope.skinName="skins.ButtonSkinRed",this.btn_ope.label="卸下",this.btnFunc=function(){a.proxy.PutTitleDown(t,function(){a.updateView(),Utils.MsgUtils.addMidMsg("卸下成功")})};else if(0<=o)this.btn_ope.label="",this.btn_ope.skinName="skins.ButtonSkinGreen",this.btn_ope.label="穿戴",this.btnFunc=function(){a.proxy.PutTitleOn(t,function(){a.updateView(),Utils.MsgUtils.addMidMsg("穿戴成功")})};else{this.btn_ope.label="",this.btn_ope.skinName="skins.ButtonSkinGreen",this.btn_ope.label="激活",this.btnFunc=function(){a.proxy.ActivateTitle(t,function(){a.updateView()})};var s=l.GameMVC.backpackPy.checkEnough(JSON.parse(i.costs),!1);UIActionManager.setAbsGrey(this.btn_ope,!s)}var c=JSON.parse(i.attr);this.gp_attrs.$children.forEach(function(e){a.attrGpsFree.push(e)}),this.gp_attrs.removeChildren(),c.forEach(function(e,t){var i=a.makeAttrGp(),n=l.GeneralConfig.getAttrName(e[0]),o=l.GeneralConfig.getAttrValue(e[1]);i.$children[0].text=n,i.$children[1].text="+"+o,a.gp_attrs.addChild(i)})}else Utils.MsgUtils.addMidMsg("找不到称号配置")},e.prototype.activateComponent=function(){var t=this;this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.btnFunc&&t.btnFunc()},this),this.btn_attrs.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new i({attr:t.proxy.titleInfo.attr})})},this),this.btn_jump.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.data[t.selectIndex]){var e=t.data[t.selectIndex].jumpModule;e?(l.MainJumpConfig.jumpTo(e),t.hide()):Utils.MsgUtils.addMidMsg("暂无获取途径")}else Utils.MsgUtils.addMidMsg("数据错误")},this)},e.prototype.makeAttrGp=function(){if(0<this.attrGpsFree.length)return this.attrGpsFree.pop();var e=new eui.Group;e.width=170;var t=new eui.BitmapLabel;t.font="green_num_fnt",t.left=89;var i=new eui.Label;return i.size=22,i.textColor=8866344,e.addChild(i),e.addChild(t),e},e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this);var e=l.GameMVC.fashionMed.getSubView(l.FashionMediator.SV.MAIN);e&&e.updateModelForce()},e}(BasePanel);l.TitleMainView=e,__reflect(e.prototype,"game.TitleMainView");var r=function(t){function e(){var e=t.call(this)||this;return e.skinName="TitleItem",e}return __extends(e,t),e.prototype.dataChanged=function(){this.img_frame.source=this.data.frame,this.img_icon.source=this.data.icon,this.img_notice.visible=!this.data.notice,this.img_putOn.visible=!this.data.putOn,this.data.hasActivate&&this.data.notice?UIActionManager.setGrey(this.gp_main,!0):UIActionManager.setGrey(this.gp_main,!1)},e.itemWidth=146,e}(eui.ItemRenderer);__reflect(r.prototype,"TitleItem");var i=function(i){function e(e){var t=i.call(this)||this;return t.skinName="HeroAttrDetailsPanelSkin",t.info=e,t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_left,egret.TouchEvent.TOUCH_TAP,function(){e.updateView({type:1})},this),Utils.ComponentUtils.registerListener(this.btn_right,egret.TouchEvent.TOUCH_TAP,function(){e.updateView({type:2})},this),this.updateView(this.info,!0)},e.prototype.updateView=function(e,t){var a=this;if(void 0===t&&(t=!1),this.info=e||this.info,t){var i=l.Config.attrDescConfig(),n=[];for(var o in i){var r=i[o];r.isShow&&n.push(r)}n.sort(function(e,t){return e.priority-t.priority});var s=this.info.attr;"string"==typeof s&&(s=JSON.parse(this.info.attr)),n.forEach(function(e){var t=s[e.type]||0;if(0!=t){var i=t%1e5,n=t-i;if(0!=n){var o=a.makeGroup(e.shortDesc,n);a.gp_listAttr.addChild(o)}if(0!=i){o=a.makeGroup(e.shortDesc,i);a.gp_listAttr.addChild(o)}}}),this.gp_listAttr.$children.length?this.gp_empty.visible=!1:this.gp_empty.visible=!0,n.forEach(function(e){var t=new eui.Group;t.width=320;var i=new eui.Label(e.shortDesc+"：");i.y=2,i.textColor=764145,i.size=20,i.right=222,t.addChild(i);var n=new eui.Label(e.desc);n.y=2,n.size=20,n.width=230,n.left=100,n.lineSpacing=6,t.addChild(n),a.gp_listDesc.addChild(t)})}switch(e&&e.type||1){case 1:this.gp_attr.visible=!0,this.gp_desc.visible=!1,this.btn_left.visible=!1,this.btn_right.visible=!0;break;case 2:this.gp_attr.visible=!1,this.gp_desc.visible=!0,this.btn_left.visible=!0,this.btn_right.visible=!1}},e.prototype.makeGroup=function(e,t){var i=new eui.Group;i.width=300,i.height=27;var n=new eui.Label(e);n.size=24,i.addChild(n);var o=l.GeneralConfig.getAttrValue(t),a=new eui.Label(""+o);return a.size=24,a.right=3,i.addChild(a),a.verticalCenter=n.verticalCenter=0,i},e}(BasePanel);l.CommonAttrDetailsPanel=i,__reflect(i.prototype,"game.CommonAttrDetailsPanel")}(game||(game={})),function(o){var e=function(i){function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.proxy=o.AppFacade.getInstance().retrieveProxy(o.TitlePy.N),t}return __extends(n,i),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.TitleMainView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.CONFIG_ALL_LOADED]},n.prototype.handleNotification=function(e){e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.Title,!1).allow&&this.proxy.GetTitleInfo();break;case CN.CONFIG_ALL_LOADED:var t=o.Config.titleConfig();for(var i in t){var n=t[i];NoticeManager.addCareCost(n.costs,function(){NoticeManager.updateNotice(NT.TITLE)})}}},n.N="TitleMediator",n.SV={MAIN:1},n}(BaseMediator);o.TitleMediator=e,__reflect(e.prototype,"game.TitleMediator")}(game||(game={})),function(i){var e=function(){function e(){}return e.registerAll=function(){(new t).register()},e}();i.TitleProcessor=e,__reflect(e.prototype,"game.TitleProcessor");var t=function(e){function t(){return e.call(this,"Title.TitleInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("TitleInfoP",t),i.GameMVC.titlePy.titleInfo.update(t.info)},t}(i.ProcessorBase);i.TitleInfoP=t,__reflect(t.prototype,"game.TitleInfoP")}(game||(game={})),function(o){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.titleInfo=new n({}),NoticeManager.registerCB(NT.TITLE,e.updateNotice,e,MODULE.Title),e}return __extends(i,t),i.prototype.updateNotice=function(){var e=o.Config.titleConfig();for(var t in e){var i=e[t];if(-1==this.getCodeDt(i.code)){var n=JSON.parse(i.costs);if(o.GameMVC.backpackPy.checkEnough(n,!1))return!0}}return!1},i.prototype.GetTitleInfo=function(t){var i=this;Utils.Socket.send("title","GetTitleInfo",{}).then(function(e){i.titleInfo.update(e.info),t&&t()})},i.prototype.ActivateTitle=function(e,t){var i=this;Utils.Socket.send("title","ActivateTitle",{code:e}).then(function(e){i.titleInfo.update(e.info),o.AppFacade.getInstance().sendNotification(CN.TITLE_UPDATE),t&&t()})},i.prototype.PutTitleOn=function(e,t){var i=this;Utils.Socket.send("title","PutTitleOn",{code:e}).then(function(e){i.titleInfo.code=e.code,o.GameMVC.playerPy.playerInfoVO.titleCode=e.code,o.AppFacade.getInstance().sendNotification(CN.TITLE_UPDATE),t&&t()})},i.prototype.PutTitleDown=function(e,t){var i=this;Utils.Socket.send("title","PutTitleDown",{code:e}).then(function(e){i.titleInfo.code=e.code,o.GameMVC.playerPy.playerInfoVO.titleCode=e.code,o.AppFacade.getInstance().sendNotification(CN.TITLE_UPDATE),t&&t()})},i.prototype.getCodeDt=function(t){var i=-1;return this.titleInfo.titleList.forEach(function(e){e.code!=t||(i=e.dt)}),i},i.N="TitlePy",i}(BaseProxy);o.TitlePy=e,__reflect(e.prototype,"game.TitlePy");var n=function(i){function e(e){var t=i.call(this)||this;return t.titleList=new Array,t.attr={},t.code=0,t.fightCap=0,t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.titleList=e.titleList||this.titleList,this.attr=e.attr&&JSON.parse(e.attr)||this.attr,this.code=e.code||this.code,this.fightCap=e.fightCap||this.fightCap},e}(o.BaseVO);o.TitleInfo=n,__reflect(n.prototype,"game.TitleInfo")}(game||(game={})),function(o){var e=function(t){function n(e){return void 0===e&&(e=null),t.call(this,n.N,e)||this}return __extends(n,t),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.TribeBattleMainView),this.addSubView(n.SV.CHALLENGE,o.TribeBattleChallengePanel),this.addSubView(n.SV.REVENGE,o.TribeBattleRevengePanel)},n.prototype.listNotificationInterests=function(){return[CN.LOGIN_FINAL_DONE,CN.HIDE_ALL_SUBVIEW,CN.TRIBE_BATTLE_INFO_UPDATED,CN.TRIBE_BATTLE_REVENGE_UPDATED]},n.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.LOGIN_FINAL_DONE:if(o.GameMVC.guildPy.isInGuild()){var i=Utils.UnlockMgr.getOpenInfo(MODULE.TribeBattle);i.allow&&i.isOpen&&o.GameMVC.tribeBattlePy.GetTribeBattleInfo()}break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.TRIBE_BATTLE_INFO_UPDATED:NoticeManager.updateNotice(NT.GUILD_TRIBE_BATTLE),this.updateView(n.SV.MAIN,t);break;case CN.TRIBE_BATTLE_REVENGE_UPDATED:this.updateView(n.SV.REVENGE)}},n.N="TribeBattleMed",n.SV={MAIN:1,CHALLENGE:2,REVENGE:3},n}(BaseMediator);o.TribeBattleMed=e,__reflect(e.prototype,"game.TribeBattleMed")}(game||(game={})),function(e){var t=function(){function e(){}return e.registerAll=function(){},e}();e.TribeBattleProcessor=t,__reflect(t.prototype,"game.TribeBattleProcessor");var i=function(e){function t(){return e.call(this,"tribeBattle.BattleRecordEntityInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){e.getBody()},t}(e.ProcessorBase);e.BattleRecordEntityInfoP=i,__reflect(i.prototype,"game.BattleRecordEntityInfoP")}(game||(game={})),function(c){var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.battleInfo=new c.TBInfoVO,e.battleRecords=[],e.addNotice(),e}return __extends(i,t),i.prototype.updateInfo=function(e,t){var i=this.battleInfo.playerInfo.holdGoods+this.battleInfo.playerInfo.fixedGoods;e&&this.battleInfo.updatePlayer(e),t&&this.battleInfo.updateGuildList(t);var n=this.battleInfo.playerInfo.holdGoods+this.battleInfo.playerInfo.fixedGoods;c.AppFacade.getInstance().sendNotification(CN.TRIBE_BATTLE_INFO_UPDATED,{fGoods:i,cGoods:n})},i.prototype.updateBattleRecord=function(e){var t=this;this.battleRecords.splice(0),e.forEach(function(e){t.battleRecords.push(new c.TBBattleRecordVO(e))}),c.AppFacade.getInstance().sendNotification(CN.TRIBE_BATTLE_REVENGE_UPDATED)},i.prototype.GetTribeBattleInfo=function(t){var i=this;Utils.Socket.send("tribeBattle","GetTribeBattleInfo",{}).then(function(e){i.updateInfo(e.info.playerEntityInfo,e.info.guildEntityList),t&&t()})},i.prototype.GetTribeBattleDetailInfo=function(t){var i=this;Utils.Socket.send("tribeBattle","GetTribeBattleDetailInfo",{guildId:t.guildId}).then(function(e){i.updateInfo(void 0,e.guildEntityInfo),t.cb&&t.cb(e)})},i.prototype.GetRevengeList=function(t){var i=this;Utils.Socket.send("tribeBattle","GetRevengeList",{}).then(function(e){i.updateBattleRecord(e.battleRecords),t&&t(i.battleRecords)})},i.prototype.RefreshGuildEntityList=function(t){var i=this;Utils.Socket.send("tribeBattle","RefreshGuildEntityList",{}).then(function(e){i.updateInfo(e.playerEntityInfo,e.guildEntityList),t&&t(e)})},i.prototype.PurchaseChallengeTime=function(t){var i=this;Utils.Socket.send("tribeBattle","PurchaseChallengeTime",{num:t.num}).then(function(e){i.updateInfo(e.playerEntityInfo),t.cb&&t.cb(e)})},i.prototype.PurchaseRevengeTime=function(t){var i=this;Utils.Socket.send("tribeBattle","PurchaseRevengeTime",{num:t.num}).then(function(e){i.updateInfo(e.playerEntityInfo),t.cb&&t.cb(e)})},i.prototype.GetAchieveRewards=function(t){var i=this;Utils.Socket.send("tribeBattle","GetAchieveRewards",{rewardsType:t.type,tar:t.oneKey,rewardsId:t.code}).then(function(e){c.GameMVC.backpackPy.handleClientReward(e.clientReward),i.updateInfo(e.playerEntityInfo),t.cb&&t.cb(e)})},i.prototype.Challenge=function(i){var n=this;c.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeTribeBattle,pb1:"tribeBattle",pb2:"Challenge",params:{guildId:i.guildId,tPlayerId:i.playerId},doneCB:function(e){if(e.cbRet){var t=e.cbRet;n.updateInfo(t.playerEntityInfo,t.guildEntityInfo),i.cb&&i.cb(t)}c.GameMVC.fightPy.queueExceExitCB()}})},i.prototype.Revenge=function(i){var n=this;c.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeTribeBattle,pb1:"tribeBattle",pb2:"Revenge",params:{tPlayerId:i.playerId},doneCB:function(e){if(e.cbRet){var t=e.cbRet;n.updateInfo(t.playerEntityInfo),i.cb&&i.cb(t)}c.GameMVC.fightPy.queueExceExitCB()}})},i.prototype.addNotice=function(){NoticeManager.setChildType(NT.GUILD_TRIBE_BATTLE,[NT.GUILD_TRIBE_BATTLE_CHALLENGE,NT.GUILD_TRIBE_BATTLE_REWARD]),NoticeManager.registerCB(NT.GUILD_TRIBE_BATTLE_CHALLENGE,this.checkChallengeTimeNotice,this,MODULE.TribeBattle),NoticeManager.registerCB(NT.GUILD_TRIBE_BATTLE_REWARD,this.checkRewardAvailable,this,MODULE.TribeBattle)},i.prototype.checkChallengeTimeNotice=function(){return 0<this.battleInfo.playerInfo.challengeTimes},i.prototype.checkRewardAvailable=function(){var e=this.battleInfo.playerInfo,i=e.playerMaxGoods,n=e.guildMaxGoods,o=e.targeted,a=c.Config.tribeBattleRewards(),t=function(e){var t=a[e];if(t.rewardsType===TribeBattleAchieveType.SelfAchieve&&i>=t.goods&&o.private.every(function(e){return e.rewardId!=t.code})||t.rewardsType===TribeBattleAchieveType.GuildAchieve&&n>=t.goods&&o.guild.every(function(e){return e.rewardId!=t.code}))return{value:!0}};for(var r in a){var s=t(r);if("object"==typeof s)return s.value}return!1},i.N="TribeBattlePy",i}(BaseProxy);c.TribeBattlePy=e,__reflect(e.prototype,"game.TribeBattlePy")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.skinName="TribeBattleChallengeSkin",e}return __extends(e,t),e.prototype.initList=function(){this.ac_list=new eui.ArrayCollection,this.list_items.dataProvider=this.ac_list,this.list_items.itemRenderer=i},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList()},e.prototype.updateView=function(e){var t=this;this.guildId=e&&e.guildId||this.guildId;var i=void 0;a.GameMVC.tribeBattlePy.battleInfo.guildList.forEach(function(e){e.baseInfo.id===t.guildId&&(i=e)}),this.lb_name.text="S"+i.baseInfo.serverId+"·"+i.baseInfo.name;var n=[];i.playerList.forEach(function(e){n.push({guildInfo:i,playerInfo:e})}),n.sort(function(e,t){return t.playerInfo.lootGoods-e.playerInfo.lootGoods}),this.ac_list.replaceAll(n)},e}(BasePanel);a.TribeBattleChallengePanel=e,__reflect(e.prototype,"game.TribeBattleChallengePanel");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="TribeBattleChallengePanel_MemberItem",e}return __extends(e,t),e.prototype.childrenCreated=function(){var o=this;t.prototype.childrenCreated.call(this),this.tribeBattleColorNumPersion=Number(a.Config.constConfig().TribeBattleColorNumPersion.constValue),this.avatar=customui.PlayerHeadFactory.create(),Utils.TouchUtils.addTouchListener(this.avatar,function(){a.AppFacade.getInstance().showSubView(a.FriendMediator.N,a.FriendMediator.SV.INFO,{playerId:o.data.playerInfo.baseInfo.playerId})},this),this.gp_avatar.addChild(this.avatar),this.btn_challenge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(0<a.GameMVC.tribeBattlePy.battleInfo.playerInfo.challengeTimes){var e=o.data.guildInfo,t=o.data.playerInfo,i=Utils.TimerManager.getServerTime()-t.lastBeLootedDt,n=Number(a.Config.constConfig().TribeBattleForbidLootCycle.constValue)+5;i<n?Utils.MsgUtils.addMidMsg("该玩家刚被掠夺过，请等待"+(n-i)+"秒"):a.GameMVC.tribeBattlePy.Challenge({guildId:e.baseInfo.id,playerId:t.baseInfo.playerId,cb:function(){a.AppFacade.getInstance().updateView(a.TribeBattleMed.N,a.TribeBattleMed.SV.CHALLENGE)}})}else Utils.MsgUtils.addMidMsg("挑战次数不足")},this)},e.prototype.dataChanged=function(){var e=this.data.playerInfo;this.avatar.updateData({vo:e.baseInfo}),this.lb_name.text=e.baseInfo.name,this.lb_curRes.text=""+(e.holdGoods+e.fixedGoods),e.lootGoods>=this.tribeBattleColorNumPersion?(this.lb_lootRes.font="RedBlackStrocke_fnt",this.lb_lootRes.scaleX=this.lb_lootRes.scaleY=.8):(this.lb_lootRes.font="white_num_fnt",this.lb_lootRes.scaleX=this.lb_lootRes.scaleY=.9),this.lb_lootRes.text=""+e.lootGoods,this.fightCapItem.update(e.baseInfo.fightCap)},e}(eui.ItemRenderer);__reflect(i.prototype,"TribeBattleChallengePanel_MemberItem")}(game||(game={})),function(r){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=r.GameMVC.tribeBattlePy,e.timerDict={},e.skinName="TribeBattleMainSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tribeBattleColorNumPersion=Number(r.Config.constConfig().TribeBattleColorNumPersion.constValue),this.activateComponent(),this.activateUpdater(),this.activateCountdown(),this.addNotice(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.img_title),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_goodsInfo),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btns)},e.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.GUILD_TRIBE_BATTLE_REWARD,this.btn_achievement.getChildAt(0),this,BTN_ICON_NOTICE_POS)},e.prototype.onDestroy=function(){for(var e in t.prototype.onDestroy.call(this),this.timerDict)this.removeTimer(e);this.updaterTimer&&egret.clearInterval(this.updaterTimer)},e.prototype.updateView=function(e){var o=this,t=this.proxy.battleInfo,i=t.playerInfo;r.GameMVC.rankPy.GetRankList(RankingType.RankingTypeTribeBattlePlayer,function(e){var t=e.selfRank&&e.selfRank.rank||0;o.lb_selfGoods.textFlow=[{text:""+(i.holdGoods+i.fixedGoods)},{text:"("+(t?"第"+t+"名":"未上榜")+")",style:{textColor:2943688}}]}),r.GameMVC.rankPy.GetRankList(RankingType.RankingTypeTribeBattleGuild,function(e){var t=e.selfRank&&e.selfRank.rank||0;o.lb_guildGoods.textFlow=[{text:""+i.guildGoods},{text:"("+(t?"第"+t+"名":"未上榜")+")",style:{textColor:16766777}}]}),t.guildList.forEach(function(e,t){var i=o["lb_target_name"+t],n=o["lb_target_goods"+t];i.textFlow=[{text:"S"+e.baseInfo.serverId+"·",style:{textColor:10682351}},{text:e.baseInfo.name}],e.maxPlayerlootGoods>=o.tribeBattleColorNumPersion?(n.font="RedBlackStrocke_fnt",n.scaleX=n.scaleY=.9):(n.font="white_num_fnt",n.scaleX=n.scaleY=1),n.text=""+e.totalGoods});Number(r.Config.constConfig().TribeBattleInitRevengeTime.constValue);var n=i.challengeTimes;if(this.blb_challengeTimes.text=n.toString(),i.lastChallengeRefreshDt){this.blb_recTime.visible=!0;var a=i.lastChallengeRefreshDt+Number(r.Config.constConfig().TribeBattleChallengeTimeRefreshCycle.constValue)-Utils.TimerManager.getServerTime();this.addTimer("challengeTimeRec",a,1e3,function(e){0<e?o.blb_recTime.text=Utils.TimerManager.getFormatBySecond1(e)+"后回复一次":(o.removeTimer("challengeTimeRec"),i.hasChallengedTime-=1,i.lastChallengeRefreshDt+=60,o.updateView())})}else this.blb_recTime.visible=!1,this.removeTimer("challengeTimeRec");this.handleGoodsDiff(e)},e.prototype.addTimer=function(e,t,i,n){var o=this;this.removeTimer(e),this.timerDict[e]={timer:void 0,dt:t,cb:n};var a=egret.setInterval(function(){o.timerDict[e].dt--,o.timerDict[e].cb(o.timerDict[e].dt)},this,i);this.timerDict[e].timer=a,n(t)},e.prototype.removeTimer=function(e){this.timerDict[e]&&(this.timerDict[e].timer&&egret.clearInterval(this.timerDict[e].timer),delete this.timerDict[e])},e.prototype.handleGoodsDiff=function(e){if(e&&e.fGoods&&e.cGoods){var t=e.cGoods-e.fGoods;if(0!=t){var i=new eui.Group,n=new eui.HorizontalLayout;n.verticalAlign=egret.VerticalAlign.MIDDLE,i.layout=n;var o=new eui.Image("item_icon_wuzi_png");o.scaleX=o.scaleY=.8,i.addChild(o);var a=new eui.BitmapLabel((0<t?"+":"-")+Math.abs(t));a.font="yellow_attr_fnt",i.addChild(a),i.horizontalCenter=0,i.verticalCenter=100,i.alpha=0,this.gp_root.addChild(i),egret.Tween.get(i).to({verticalCenter:0,alpha:1},300,egret.Ease.backOut).wait(1e3).to({verticalCenter:-100,alpha:0},300,egret.Ease.backIn).call(function(){i&&i.parent&&i.parent.removeChild(i)})}}},e.prototype.activateCountdown=function(){var t=this,e=Utils.UnlockMgr.getOpenInfo(MODULE.TribeBattle);this.addTimer("endTime",e.endTimeDt-Utils.TimerManager.getServerTime(!1),1e3,function(e){0<e?t.blb_time.text="距离结束:"+Utils.TimerManager.getFormatBySecond1(e):(t.removeTimer("endTime"),r.MainJumpConfig.jumpTo(),Utils.MsgUtils.addMidMsg("部落争霸已结束"))})},e.prototype.activateUpdater=function(){var e=this;this.updaterTimer=egret.setInterval(function(){e.proxy.GetTribeBattleInfo()},this,1e4)},e.prototype.activateComponent=function(){var n=this;this.btn_guide.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new r.HelpDialog({moduleId:MODULE.TribeBattle})})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"TRIBE_BATTLE_RANK"})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"TRIBE_BATTLE_REWARD"})},this),this.btn_achievement.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"TRIBE_BATTLE_ACHIEVE"})},this),this.btn_revenge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.proxy.GetRevengeList(function(){r.AppFacade.getInstance().showSubView(r.TribeBattleMed.N,r.TribeBattleMed.SV.REVENGE)})},this),this.btn_change.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.proxy.RefreshGuildEntityList(function(){Utils.MsgUtils.addMidMsg("刷新成功"),n.btn_change.enabled=!1,n.blb_changeCd.visible=!0,UIActionManager.setAbsGrey(n.btn_change,!0),n.addTimer("change",5,1e3,function(e){0<e?n.blb_changeCd.text=""+e:(n.removeTimer("change"),n.btn_change.enabled=!0,n.blb_changeCd.visible=!1,UIActionManager.setAbsGrey(n.btn_change,!1))})})},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=n.proxy.battleInfo.playerInfo,t=r.Config.VIPConfig();if(t.tribeBattleChallengePurchaseTime<=e.hasPurchasedTime)r.GameMgr.getInstance().showCommonTipsWin({commonTips:"主人，听闻提升VIP等级可获得更多购买次数哦！",clickCB:function(e){e.type&&r.MainJumpConfig.jumpTo(MODULE.Recharge)}});else{var i=n.proxy.battleInfo.playerInfo.challengeTimes;r.AppFacade.getInstance().showSubView(r.CommonMediator.N,r.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.TribeBattleChallenge,hasBuyNum:e.hasPurchasedTime,buyCB:function(e){n.proxy.PurchaseChallengeTime({num:e})},curNum:i,maxBuyNum:t.tribeBattleChallengePurchaseTime})}},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.MainJumpConfig.jumpTo()},this);for(var e=function(t){i["gp_target"+t].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=n.proxy.battleInfo.guildList[t];n.proxy.GetTribeBattleDetailInfo({guildId:e.baseInfo.id,cb:function(){r.AppFacade.getInstance().showSubView(r.TribeBattleMed.N,r.TribeBattleMed.SV.CHALLENGE,{guildId:e.baseInfo.id})}})},i)},i=this,t=0;t<4;t++)e(t)},e}(BaseFull);r.TribeBattleMainView=e,__reflect(e.prototype,"game.TribeBattleMainView")}(game||(game={})),function(a){var e=function(t){function e(){var e=t.call(this)||this;return e.proxy=a.GameMVC.tribeBattlePy,e.skinName="TribeBattleRevengeSkin",e}return __extends(e,t),e.prototype.initList=function(){this.ac_item=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_item,this.list_item.itemRenderer=i},e.prototype.childrenCreated=function(){var o=this;t.prototype.childrenCreated.call(this),this.rootPanel.blb_title.text="记录",this.rootPanel.onCloseCB=function(){o.hide(0)},this.initList(),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=a.GameMVC.tribeBattlePy,e=t.battleInfo.playerInfo,i=a.Config.VIPConfig();if(i.tribeBattleRevengePurchaseTime<=e.hasPurchasedRevengeTime)a.GameMgr.getInstance().showCommonTipsWin({commonTips:"主人，听闻提升VIP等级可获得更多购买次数哦！",clickCB:function(e){e.type&&a.MainJumpConfig.jumpTo(MODULE.Recharge)}});else{var n=Number(a.Config.constConfig().TribeBattleInitRevengeTime.constValue)+t.battleInfo.playerInfo.hasPurchasedRevengeTime-t.battleInfo.playerInfo.hasRevengedTime;a.AppFacade.getInstance().showSubView(a.CommonMediator.N,a.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.TribeBattleRevenge,hasBuyNum:e.hasPurchasedRevengeTime,buyCB:function(e){t.PurchaseRevengeTime({num:e,cb:function(){o.updateView()}})},curNum:n,maxBuyNum:i.tribeBattleRevengePurchaseTime})}},this)},e.prototype.updateView=function(e){var t=a.GameMVC.tribeBattlePy.battleRecords,i=[];t.forEach(function(e){i.push({info:e})}),this.ac_item.replaceAll(i),this.gp_empty.visible=!i.length,this.blb_challengeTimes.text=""+this.proxy.battleInfo.playerInfo.revengeTimes},e}(BasePanel);a.TribeBattleRevengePanel=e,__reflect(e.prototype,"game.TribeBattleRevengePanel");var i=function(t){function e(){var e=t.call(this)||this;return e.skinName="TribeBattleRevengePanel_Item",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.avatar=customui.PlayerHeadFactory.create(),this.gp_avatar.addChild(this.avatar),this.btn_challenge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.GameMVC.tribeBattlePy.Revenge({playerId:e.data.info.playerInfo.baseInfo.playerId,cb:function(){a.GameMVC.tribeBattlePy.GetRevengeList()}})},this)},e.prototype.dataChanged=function(){var e=this.data.info,t=e.playerInfo.baseInfo;this.avatar.updateData({vo:t}),this.lb_name.text=t.name,this.lb_lootedRes.text=e.beLootedGoods.toString(),this.lb_revengeRes.text=""+e.playerInfo.lootGoods,this.fightCapItem.update(t.fightCap)},e}(eui.ItemRenderer);__reflect(i.prototype,"TribeBattleRevengePanel_Item")}(game||(game={})),function(i){var e=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.execute=function(e){this.registerProxyAs(i.PlayerPy,"playerPy"),this.registerProxyAs(i.LoginPy,"loginPy"),this.registerProxyAs(i.MailPy,"mailPy"),this.registerProxyAs(i.FriendPy,"friendPy"),this.registerProxyAs(i.FightPy,"fightPy"),this.registerProxyAs(i.HeroPy,"heroPy"),this.registerProxyAs(i.PetPy,"petPy"),this.registerProxyAs(i.MagicalArtifactPy,"magicalArtifactPy"),this.registerProxyAs(i.HeroSpiritPy,"heroSpiritPy"),this.registerProxyAs(i.HeroThingPy,"heroThingPy"),this.registerProxyAs(i.GuajiPy,"guajiPy"),this.registerProxyAs(i.CopyEntrancePy,"copyEntrancePy"),this.registerProxyAs(i.PvpEntrancePy,"pvpEntrancePy"),this.registerProxyAs(i.MainPy,"mainPy"),this.registerProxyAs(i.ShopPy,"shopPy"),this.registerProxyAs(i.RechargePy,"rechargePy"),this.registerProxyAs(i.RankPy,"rankPy"),this.registerProxyAs(i.TaskPy,"taskPy"),this.registerProxyAs(i.ActivityPy,"activityPy"),this.registerProxyAs(i.GuildPy,"guildPy"),this.registerProxyAs(i.BackpackPy,"backpackPy"),this.registerProxyAs(i.ArenaPy,"arenaPy"),this.registerProxyAs(i.ManorProxy,"manorPy"),this.registerProxyAs(i.StormWarProxy,"stormWarPy"),this.registerProxyAs(i.WorldKingPy,"worldKingPy"),this.registerProxyAs(i.BattleZoneArenaPy,"battleZoneArenaPy"),this.registerProxyAs(i.TeamExpePy,"teamExpePy"),this.registerProxyAs(i.TeamPlayEntrancePy,"teamEntrancePy"),this.registerProxyAs(i.ChampionPy,"championPy"),this.registerProxyAs(i.WorldBossPy,"worldBossPy"),this.registerProxyAs(i.ZoneBossPy,"zoneBossProxy"),this.registerProxyAs(i.HeroChallengePy,"heroChallengePy"),this.registerProxyAs(i.HeroChallenge2Py,"heroChallenge2Py"),this.registerProxyAs(i.GuildCollectPy,"guildCollectPy"),this.registerProxyAs(i.GuildBossPy,"guildBossPy"),this.registerProxyAs(i.GuildWarPy,"guildWarPy"),this.registerProxyAs(i.GuildInstancePy,"guildInstancePy"),this.registerProxyAs(i.TouchGoldHandPy,"touchGoldHandPy"),this.registerProxyAs(i.SmithyPy,"smithyPy"),this.registerProxyAs(i.TitlePy,"titlePy"),this.registerProxyAs(i.ZzqPy,"zzqPy"),this.registerProxyAs(i.LuckyTablePy,"luckyTablePy"),this.registerProxyAs(i.DeepNestPy,"DeepNestPy"),this.registerProxyAs(i.DungeonPy,"dungeonPy"),this.registerProxyAs(i.TribeBattlePy,"tribeBattlePy"),this.registerProxyAs(i.PeakWarPy,"peakWarPy"),this.registerProxyAs(i.FashionPy,"fashionPy"),this.registerProxyAs(i.MountPy,"mountPy"),this.registerProxyAs(i.GuidePy,"guidePy"),this.registerProxyAs(i.GuildSkillPy,"guildSkillPy")},t.prototype.registerProxyAs=function(e,t){this.facade.registerProxy(new e),i.GameMVC[t]=i.AppFacade.getInstance().retrieveProxy(e.N)},t}(puremvc.SimpleCommand);i.ModelPrepCommand=e,__reflect(e.prototype,"game.ModelPrepCommand",["puremvc.ICommand","puremvc.INotifier"]);var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.execute=function(e){var t=i.AppFacade.getInstance();t.removeProxy(i.PlayerPy.N),t.removeProxy(i.LoginPy.N),t.removeProxy(i.MailPy.N),t.removeProxy(i.FriendPy.N),t.removeProxy(i.FightPy.N),t.removeProxy(i.HeroPy.N),t.removeProxy(i.PetPy.N),t.removeProxy(i.MagicalArtifactPy.N),t.removeProxy(i.HeroSpiritPy.N),t.removeProxy(i.HeroThingPy.N),t.removeProxy(i.BackpackPy.N),t.removeProxy(i.CopyEntrancePy.N),t.removeProxy(i.PvpEntrancePy.N),t.removeProxy(i.MainPy.N),t.removeProxy(i.ShopPy.N),t.removeProxy(i.RechargePy.N),t.removeProxy(i.RankPy.N),t.removeProxy(i.TaskPy.N),t.removeProxy(i.ActivityPy.N),t.removeProxy(i.GuildPy.N),t.removeProxy(i.GuajiPy.N),t.removeProxy(i.ArenaPy.N),t.removeProxy(i.ManorProxy.N),t.removeProxy(i.StormWarProxy.N),t.removeProxy(i.WorldKingPy.N),t.removeProxy(i.BattleZoneArenaPy.N),t.removeProxy(i.TeamExpePy.N),t.removeProxy(i.TeamPlayEntrancePy.N),t.removeProxy(i.ChampionPy.N),t.removeProxy(i.ZoneBossPy.N),t.removeProxy(i.HeroChallengePy.N),t.removeProxy(i.HeroChallenge2Py.N),t.removeProxy(i.GuildCollectPy.N),t.removeProxy(i.GuildBossPy.N),t.removeProxy(i.GuildWarPy.N),t.removeProxy(i.TouchGoldHandPy.N),t.removeProxy(i.GuildInstancePy.N),t.removeProxy(i.SmithyPy.N),t.removeProxy(i.TitlePy.N),t.removeProxy(i.ZzqPy.N),t.removeProxy(i.LuckyTablePy.N),t.removeProxy(i.DeepNestPy.N),t.removeProxy(i.DungeonPy.N),t.removeProxy(i.TribeBattlePy.N),t.removeProxy(i.PeakWarPy.N),t.removeProxy(i.FashionPy.N),t.removeProxy(i.MountPy.N),t.removeProxy(i.GuidePy.N),t.removeProxy(i.GuildSkillPy.N)},t}(puremvc.SimpleCommand);i.ModelRemoveCommand=t,__reflect(t.prototype,"game.ModelRemoveCommand",["puremvc.ICommand","puremvc.INotifier"])}(game||(game={})),function(o){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new i).register(),(new n).register()},e}();o.WorldBossProcessor=e,__reflect(e.prototype,"game.WorldBossProcessor");var t=function(e){function t(){return e.call(this,"serverBoss.PushBossInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("PushBossInfoP",t);var i=o.AppFacade.getInstance().retrieveProxy(o.WorldBossPy.N);i.bossInfo&&i.bossInfo.update(t.bossInfo),o.AppFacade.getInstance().retrieveMediator(o.WorldBossMediator.N).updateView(o.WorldBossMediator.SV.MAIN)},t}(o.ProcessorBase);__reflect(t.prototype,"PushBossInfoP");var i=function(e){function t(){return e.call(this,"serverBoss.PushFinishBattleInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("PushFinishBattleInfoP",t);var i=o.AppFacade.getInstance().retrieveProxy(o.WorldBossPy.N);i.bossInfo&&i.bossInfo.update(t.bossInfo),i.playerInfo&&i.playerInfo.update(t.playerBossInfo);var n=o.AppFacade.getInstance().retrieveProxy(o.FightPy.N);n.addDelayCBAfterFightExit(function(){var e=o.AppFacade.getInstance().retrieveMediator(o.WorldBossMediator.N);e.updateView(o.WorldBossMediator.SV.MAIN,{type:o.WorldBossMainView.UPDATE_TYPE.BOSS_INFO}),e.updateView(o.WorldBossMediator.SV.MAIN,{type:o.WorldBossMainView.UPDATE_TYPE.CHALLENGE_INFO}),n.queueExceExitCB()},"WORLD_BOSS")},t}(o.ProcessorBase);__reflect(i.prototype,"PushFinishBattleInfoP");var n=function(e){function t(){return e.call(this,"serverBoss.PushPlayerBossInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();o.AppFacade.getInstance().retrieveProxy(o.WorldBossPy.N).updatePlayerInfo(t.info)},t}(o.ProcessorBase);__reflect(n.prototype,"PushPlayerBossInfoP")}(game||(game={})),function(c){var i=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.hurt=e.hurt,this.hurtReward=e.hurtReward,this.careerReward=e.careerReward,this.hasBuyTimes=e.hasBuyTimes,this.initPLevel=e.initPLevel,this.honor=e.honor,this.challengeCD=e.challengeCD,this.timesReward=e.timesReward,this.challengeTimes=e.challengeTimes,this.cTimes=e.cTimes,this.reTimesDt=e.reTimesDt,NoticeManager.updateNotice(NT.WORLD_BOSS_REWARD,void 0,!0),NoticeManager.updateNotice(NT.WORLD_BOSS_NUM,void 0,!0)},e}(c.BaseVO);__reflect(i.prototype,"PlayerBossInfoVO");var o=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){null!=this.lives&&(this.isDeadAndReBoth=e.lives>this.lives),this.configId=e.configId,this.bossId=e.bossId,this.bornDt=e.bornDt,this.lives=e.lives,this.refreshDt=e.refreshDt,this.careerRecord=e.careerRecord,this.openDt=e.openDt},e}(c.BaseVO);__reflect(o.prototype,"BossInfoVO");var e=function(t){function n(){var e=t.call(this,n.N)||this;return NoticeManager.setChildType(NT.WORLD_BOSS,[NT.WORLD_BOSS_REWARD,NT.WORLD_BOSS_NUM]),NoticeManager.registerCB(NT.WORLD_BOSS_REWARD,e.checkNotice,e),NoticeManager.registerCB(NT.WORLD_BOSS_NUM,function(){return!!(e.playerInfo&&0<e.playerInfo.cTimes)},e),e}return __extends(n,t),n.prototype.updateBossInfo=function(e){this.bossInfo||(this.bossInfo=new o),this.bossInfo.update(e)},n.prototype.updatePlayerInfo=function(e){this.playerInfo||(this.playerInfo=new i),this.playerInfo.update(e),c.GameMVC.worldBossMed.updateView(c.WorldBossMediator.SV.MAIN,{type:c.WorldBossMainView.UPDATE_TYPE.CHALLENGE_INFO})},n.prototype.GetServerBossInfo=function(){var t=this;Utils.Socket.send("serverBoss","GetServerBossInfo",{}).then(function(e){t.updatePlayerInfo(e.playerBossInfo),t.updateBossInfo(e.bossInfo),c.AppFacade.getInstance().updateView(c.WorldBossMediator.N,c.WorldBossMediator.SV.MAIN)})},n.prototype.BuyChanllengeTimes=function(t,i,n){var o=this;Utils.Socket.send("serverBoss","BuyChanllengeTimes",{times:t}).then(function(e){Utils.MsgUtils.addMidMsg("成功购买"+t+"次"),o.playerInfo.update(e.playerBossInfo),c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).handleClientCost(e.clientCost),c.AppFacade.getInstance().retrieveMediator(c.WorldBossMediator.N).updateView(c.WorldBossMediator.SV.MAIN,{type:c.WorldBossMainView.UPDATE_TYPE.CHALLENGE_INFO}),i&&(n?i.call(n):i())})},n.prototype.GetPlayerTimesReward=function(e,i){Utils.Socket.send("serverBoss","PlayerTimesReward",{id:e}).then(function(e){var t=c.AppFacade.getInstance().retrieveProxy(n.N);t.playerInfo.update(e.playerBossInfo),t.bossInfo.update(e.bossInfo),c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).handleClientReward(e.clientReward,2),i&&i()})},n.prototype.Challenge=function(e){this.bossInfo.lives,this.bossInfo.configId,e.name,e.level;this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeServerBoss,pb1:"serverBoss",pb2:"Challenge",params:{},doneCB:function(e){c.AppFacade.getInstance().retrieveProxy(c.FightPy.N).queueExceExitCB()}})},n.prototype.checkNotice=function(){var e=this.playerInfo;if(!e)return!1;var t=JSON.parse(e.timesReward),i=e.challengeTimes,n=c.Config.serverBossReward(2);for(var o in n){var a=n[o].id,r=0<=t.indexOf(a),s=n[o].rankUpper;if(!r&&s<=i)return!0}return!1},n.prototype.getOpenInfo=function(){return Utils.UnlockMgr.getOpenInfo(MODULE.ServerBoss)},n.prototype.getTemInfo=function(t){var i=this;Utils.Socket.send("serverBoss","GetPlayerServerBossInfo",{}).then(function(e){i.temInfo=e,t&&t()})},n.N="WorldBossPy",n}(BaseProxy);c.WorldBossPy=e,__reflect(e.prototype,"game.WorldBossPy")}(game||(game={})),function(c){var e=function(t){function a(){var e=t.call(this)||this;return e.proxy=c.AppFacade.getInstance().retrieveProxy(c.WorldBossPy.N),e.autoChallenge=!0,e.mainPy=c.AppFacade.getInstance().retrieveProxy(c.MainPy.N),e.skinName="WorldBossMainSkin",e}return __extends(a,t),a.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),NoticeManager.addNoticeListener(NT.WORLD_BOSS_REWARD,this.btn_achieve.$children[0],this,BTN_ICON_NOTICE_POS),this._activateComponent(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top),this.map=Utils.MapUtils.generateCommon({source:MODULE.ServerBoss,multiLayerScroller:this.cu_mls,loadingParent:this.getParentView(),miniMapParent:Utils.SDKMgr.getPerformConfig(6)?void 0:this.gp_mini_map,onTouchTap:function(e,t){i.mainPy.SyncCoordinateInfo(e,t,"1",MODULE.ServerBoss)}}),this.updateRankTimer||(this.updateRankTimer=egret.setInterval(this.updateRank,this,5e3)),this.gp_map.addChildAt(this.map,0)},a.prototype.updateView=function(e,t){var i=this,n=this.proxy.getOpenInfo();if(!n.isOpen)return this.gp_reward.visible=this.gp_challenge.visible=this.btn_challenge.visible=!1,this.blb_dt_tips1.text="每日",n.openTime[1]<10?this.blb_dt_tips2.text=n.openTime[0]+":0"+n.openTime[1]:this.blb_dt_tips2.text=n.openTime[0]+":"+n.openTime[1],this.blb_dt_tips3.text="开启世界Boss",void this.jumpToChatper(1);this.gp_endDt.visible=!0,this.endingTimer||(this.endingTimer=egret.setInterval(function(){var e=n.endTimeDt-Utils.TimerManager.getServerTime(!1),t=Utils.TimerManager.getFormatBySecond1(e);0<e?i.blb_dt_end.text=""+t:(egret.clearInterval(i.endingTimer),i.gp_endDt.visible=!1)},this,1e3));var o=this.mainPy.getMyCoordinateInfo(MODULE.ServerBoss);if(!t&&o)if(this.gp_reward.visible=this.gp_challenge.visible=this.btn_challenge.visible=!0,this.proxy.bossInfo&&this.proxy.playerInfo)switch(e&&e.type||c.GuildBossMainView.UPDATE_TYPE.INIT){case a.UPDATE_TYPE.INIT:this.updateBossInfo(),this.updateChallengeInfo();break;case a.UPDATE_TYPE.BOSS_INFO:this.updateBossInfo();break;case a.UPDATE_TYPE.CHALLENGE_INFO:this.updateChallengeInfo()}else this.proxy.GetServerBossInfo();else this.mainPy.GetCoordinateInfo(MODULE.ServerBoss,function(){i.updateView(e)})},a.prototype.updateAct=function(){},a.prototype.jumpToChatper=function(e){if(this.curBossConfigId!=e||1==e||1==this.curBossConfigId){this.curBossConfigId=e;var t=this.mainPy.getMyCoordinateInfo(MODULE.ServerBoss),i=this.mainPy.getOtherCoordinateInfo(MODULE.ServerBoss),n=c.Config.serverBoss()[e],o=JSON.parse(n.initLocation);this.map.tiled!=n.tiled&&this.map.update({isInit:!0,tiled:n.tiled,theme:n.theme,w:n.w,h:n.h,meStartTileX:o[0],meStartTileY:o[1]}),this.proxy.getOpenInfo().isOpen?(this.map.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&this.map.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchEventFunc,this),this.map.touchChildren=!0,this.map.touchEnabled=!1,this.map.updateNPC({curPosVO:{x:t.coordinate&&t.coordinate.x||o[0],y:t.coordinate&&t.coordinate.y||o[1],isFixed:!0},otherCoordInfos:i})):(this.map.touchChildren=!1,this.map.touchEnabled=!0,this.map.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.map.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchEventFunc,this),this.map.updateNPC({curPosVO:{x:o[0],y:o[1],isFixed:!0}}))}},a.prototype.touchEventFunc=function(){Utils.MsgUtils.addMidMsg("世界boss未开启")},a.prototype.updateBossInfo=function(e){var t=this;if(void 0===e&&(e=!1),!this.isBossDeading&&this.proxy.bossInfo){var i=this.proxy.bossInfo;if(i&&i.isDeadAndReBoth){if(c.AppFacade.getInstance().retrieveProxy(c.FightPy.N).isInFight)return;return i.isDeadAndReBoth=void 0,this.isBossDeading=!0,this.switchScreenLayer(!0),void this.bossDeadAction(function(){DragonBoneTools.playOnce({effectName:"common_shijiebossdjs",parent:t,doneCB:function(){t.switchScreenLayer(!1),t.isBossDeading=!1,t.updateBossInfo(!0)}})})}var n=!1;if(0==i.configId?(this.log("boss消失了"),i.configId=1,n=!0):(this.bossConfig=c.Config.serverBoss()[i.configId],this.bossCreepInfo=c.Config.creepConfig(i.bossId)),this.jumpToChatper(i.configId),this.map.cleanAllEP(),!n){var o=c.Config.serverBoss()[i.configId],a=JSON.parse(o.bossLocation),r=[];r.push(new c.EventVO({fadeType:FadeRiskEventType.BigBoss,position:{x:a[0],y:a[1]},config:{heroC:this.bossCreepInfo,hp:i.lives,initHp:this.bossConfig.lives},isDirty:!0,customTrigger:function(e){e&&t.reqFightBoss()},hudongAction:{appear:e}})),this.map.updateLayerEvent({events:r}),this.map.showMePathToPos({tileX:a[0],tileY:a[1]})}}},a.prototype.updateChallengeInfo=function(){var e=this.proxy.playerInfo;this.blb_count.text=this.proxy.playerInfo.cTimes.toString(),0<e.reTimesDt?(this.recoverCD=e.reTimesDt-Utils.TimerManager.getServerTime(),0<this.recoverCD&&(this.recoverCdTimer||(this.recoverCdTimer=egret.setInterval(this.updateRecoverCd,this,1e3)),this.gp_recoverDt.visible=!0)):this.recoverCD=0,this.updateRecoverCd()},a.prototype.updateRecoverCd=function(){0<this.recoverCD?(this.blb_dt_tips2.text=""+Utils.TimerManager.getFormatBySecond1(this.recoverCD),this.recoverCD--):(this.gp_recoverDt.visible=!1,egret.clearInterval(this.recoverCdTimer),this.recoverCdTimer=void 0)},a.prototype.switchScreenLayer=function(e){this.darkSprite||(this.darkSprite=new egret.Sprite,this.darkSprite.touchEnabled=!0,this.gp_main.addChildAt(this.darkSprite,this.gp_main.getChildIndex(this.btn_back)),this.darkSprite.graphics.clear(),this.darkSprite.graphics.beginFill(0,.6),this.darkSprite.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),this.darkSprite.graphics.endFill()),this.darkSprite.visible=e},a.prototype.updateCoordInfo=function(){var e=this.mainPy.getMyCoordinateInfo(MODULE.ServerBoss),t=this.mainPy.getOtherCoordinateInfo(MODULE.ServerBoss);e&&this.map.isInited&&(this.map.updateNPC({curPosVO:{x:e.coordinate&&e.coordinate.x,y:e.coordinate&&e.coordinate.y,isFixed:!0},otherCoordInfos:t}),this.map.resetCamera()),e.coordinate.iAmClean()},a.prototype.bossDeadAction=function(e){if(this.map.isInited){var t=JSON.parse(this.bossConfig.bossLocation),i=this.map.tile2EP(t[0],t[1]);i&&i.hudongWithEP?i.hudongWithEP({playDeadAction:!0,cb:e}):(egret.warn("该boss已经不存在，或者该位置上的ep已经不是big boss ep",i),e&&e())}else e&&e()},a.prototype._activateComponent=function(){var e=this;this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.GameMVC.loginPy.loginGameVO.singleSign?c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"WORLD_BOSS_RANK_SINGLE"}):c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"WORLD_BOSS_RANK"})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.GameMVC.rankPy.GetRankList(RankingType.RankingTypeWeekPlayerServerBossHurt,void 0),c.GameMVC.rankPy.GetRankList(RankingType.RankingTypePlayerServerBossHurt,function(){c.GameMVC.loginPy.loginGameVO.singleSign?c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"WORLD_BOSS_REWARD_SINGLE"}):c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"WORLD_BOSS_REWARD"})})},this),this.btn_achieve.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.proxy.getTemInfo(function(){c.GameMVC.loginPy.loginGameVO.singleSign?c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"WORLD_BOSS_ACHIEVE_SINGLE"}):c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"WORLD_BOSS_ACHIEVE"})})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new c.HelpDialog({moduleId:MODULE.ServerBoss})})},this),this.btn_challenge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.proxy.playerInfo.cTimes<=0?this.showBuyPanel():this.findBoss()},this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.MainJumpConfig.jumpTo()},this),this.btn_jisha.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.proxy.bossInfo,t=c.Config.serverBoss()[e.configId];c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(t.killReward),type:c.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this),this.cb_autoFight.addEventListener(egret.Event.CHANGE,function(){e.autoChallenge=e.cb_autoFight.selected,e.autoChallenge&&!e.recoverCdTimer&&e.findBoss()},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.showBuyPanel()},this)},a.prototype.perClose=function(){this.recoverCdTimer&&egret.clearInterval(this.recoverCdTimer),this.map.reset(),this.updateRankTimer&&egret.clearInterval(this.updateRankTimer),this.endingTimer&&egret.clearInterval(this.endingTimer)},a.prototype.findBoss=function(){if(!this.isBossDeading&&this.map&&this.bossConfig){var e=JSON.parse(this.bossConfig.bossLocation);this.map.handleTouchTap(e[0],e[1])}},a.prototype.showBuyPanel=function(){var t=this;c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.ServerBoss,hasBuyNum:this.proxy.playerInfo.hasBuyTimes,maxBuyNum:c.Config.VIPConfig().serverBossBuyTimes,buyCB:function(e){t.proxy.BuyChanllengeTimes(e)}})},a.prototype.reqFightBoss=function(){var e=this.proxy.getOpenInfo();if(e.isOpen)0==this.proxy.bossInfo.lives?Utils.MsgUtils.addMidMsg("BOSS已被击败"):this.proxy.playerInfo.cTimes<=0?this.showBuyPanel():this.bossCreepInfo&&this.bossConfig&&this.proxy.Challenge({name:this.bossCreepInfo.name,level:this.bossConfig.level,configId:this.curBossConfigId});else if(0==this.proxy.bossInfo.configId)Utils.MsgUtils.addMidMsg("当前没有BOSS");else{var t=e.openTime,i=e.endTime,n=9<t[0]?t[0].toString():"0"+t[0].toString(),o=9<t[1]?t[1].toString():"0"+t[1].toString(),a=9<i[0]?i[0].toString():"0"+i[0].toString(),r=9<i[1]?i[1].toString():"0"+i[1].toString();Utils.MsgUtils.addMidMsg(n+":"+o+" ~ "+a+":"+r+"开启挑战")}},a.prototype.updateRank=function(){var s=this;c.AppFacade.getInstance().retrieveProxy(c.RankPy.N).GetRankList({rankType:RankingType.RankingTypePlayerServerBossHurt,refreshInterval:0},function(e){var t=e.ranks;if(0==t.length)s.gp_rank.visible=!1,s.gp_rankBm.visible=!1,s.gp_empty.visible=!0;else{s.gp_rank.visible=!0,s.gp_rankBm.visible=!0,s.gp_empty.visible=!1;for(var i=0;i<4;i++){var n=t[i];if(!n)break;var o=s.gp_rank.$children[i],a={index:i,rank:n.rank,name:n.playerBaseInfo.name,hurt:n.key};o||(o=new l,s.gp_rank.addChild(o)),o.update(a)}}var r=e.selfRank;s.bm_selfHurt.text="我的伤害:"+Utils.MathUtils.formatNumStyle1(r.key),s.bm_selfRank.text="我的排名:"+Utils.MathUtils.formatNumStyle1(r.rank)})},a.UPDATE_TYPE={INIT:1,BOSS_INFO:2,CHALLENGE_INFO:3},a}(BaseFull);c.WorldBossMainView=e,__reflect(e.prototype,"game.WorldBossMainView");var l=function(i){function e(e){var t=i.call(this)||this;return t.skinName="WorldBossRankItem",e&&t.update(e),t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this)},e.prototype.update=function(e){this.data=e;var t=this.data.rank;t<=3?(this.img_icon.visible=!0,this.bm_rank.visible=!1,this.img_icon.source="jjc_icon_pm_"+t+"_png"):(this.img_icon.visible=!1,this.bm_rank.visible=!0,this.bm_rank.text=t.toString()),this.lb_name.text=this.data.name,this.lb_hurt.text=Utils.MathUtils.formatNumStyle1(this.data.hurt)},e}(eui.Component);c.WorldBossMainView_RankItem=l,__reflect(l.prototype,"game.WorldBossMainView_RankItem")}(game||(game={})),function(i){var e=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initializeMacroCommand=function(){this.addSubCommand(i.ControllerPrepCommand),this.addSubCommand(i.ModelPrepCommand),this.addSubCommand(i.ViewPrepCommand)},t}(puremvc.MacroCommand);i.StartupCommand=e,__reflect(e.prototype,"game.StartupCommand");var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.initializeMacroCommand=function(){this.addSubCommand(i.ModelRemoveCommand),this.addSubCommand(i.ViewRemoveCommand),this.addSubCommand(i.ModelPrepCommand),this.addSubCommand(i.ViewPrepCommand)},t}(puremvc.MacroCommand);i.RestartCommand=t,__reflect(t.prototype,"game.RestartCommand")}(game||(game={})),function(n){var e=function(){function e(){}return e.registerAll=function(){(new t).register(),(new i).register()},e}();n.WorldKingProcessor=e,__reflect(e.prototype,"game.WorldKingProcessor");var t=function(e){function t(){return e.call(this,"worldKing.PushOpponentInfoP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("PushOpponentInfoP",t);var i=n.AppFacade.getInstance().retrieveProxy(n.WorldKingPy.N);t.err?i.matchingFail():i.matchingSucceed()},t}(n.ProcessorBase);n.PushOpponentInfoP=t,__reflect(t.prototype,"game.PushOpponentInfoP");var i=function(e){function t(){return e.call(this,"worldKing.InfoUpdateP",t)||this}return __extends(t,e),t.prototype.execute=function(e){var t=e.getBody();console.log("InfoUpdateP",t),n.AppFacade.getInstance().retrieveProxy(n.WorldKingPy.N).updateInfo(t.info)},t}(n.ProcessorBase);n.InfoUpdateP=i,__reflect(i.prototype,"game.InfoUpdateP")}(game||(game={})),function(a){var n=function(i){function e(e){var t=i.call(this)||this;return t.battleRecord=[],e&&t.updateInfo(e),t}return __extends(e,i),e.prototype.updateInfo=function(e){this.grade=e.grade,this.challengeTimes=e.challengeTimes,this.gotRewards=e.gotRewards,this.opponentInfo=e.opponentInfo,this.battleRecord=e.battleRecord,this.hLevel=e.hLevel,this.hWorldRank=e.hWorldRank,this.cWorldRank=e.cWorldRank,this.hBuyTimes=e.hBuyTimes,this.times=e.times;var t=this.levelConfigId;this.levelConfigId=e.levelConfigId;var i=e.levelConfigId;if(t&&t<i){var n=a.Config.worldKingLevelConfig();if(n[i].stars<n[t].stars){var o=a.AppFacade.getInstance().retrieveProxy(a.FightPy.N);o.addDelayCBAfterFightExit(function(){DragonBoneTools.playOnce({effectName:"common_duanweitisheng",parent:GameRootLayer.gameLayer().popMsgLayer,doneCB:function(){o.queueExceExitCB()}})},"world_king_level_up")}}},e}(a.BaseVO);__reflect(n.prototype,"WorldKingInfoVO");var e=function(t){function i(){var e=t.call(this,i.N)||this;return e.isMatching=!1,e.initNotice(),e}return __extends(i,t),i.prototype.initNotice=function(){NoticeManager.setChildType(NT.CITY_PVP_ENTRANCE,NT.WORLD_KING),NoticeManager.setChildType(NT.WORLD_KING,[NT.WORLD_KING_REWARD,NT.WORLD_KING_TIMES_OR_CHEST]),NoticeManager.registerCB(NT.WORLD_KING_REWARD,this.checkRewardNotice,this),NoticeManager.registerCB(NT.WORLD_KING_TIMES_OR_CHEST,this.checkTimesNotice,this)},i.prototype.updateInfo=function(e){this.worldKingInfo.updateInfo(e),a.AppFacade.getInstance().updateView(a.WorldKingMediator.N,a.WorldKingMediator.SV.MAIN),a.AppFacade.getInstance().updateView(a.RankMediator.N,a.RankMediator.SV.COMMON_REWARD),NoticeManager.updateNotice(NT.WORLD_KING_REWARD),NoticeManager.updateNotice(NT.WORLD_KING_TIMES_OR_CHEST),a.AppFacade.getInstance().sendNotification(CN.QQZONE_PUSH_MESSAGE,{data:{curLevel:e.levelConfigId,oldLevel:this.worldKingInfo.levelConfigId},type:"worldKingRank"})},i.prototype.GetWorldKingInfo=function(){var t=this;Utils.Socket.send("worldKing","GetInfo",{}).then(function(e){t.log("获取排位赛数据   GetInfoR",e),t.worldKingInfo||(t.worldKingInfo=new n),t.updateInfo(e.info)})},i.prototype.GetReward=function(t){var i=this;Utils.Socket.send("worldKing","GetReward",{type:t.type,id:t.id}).then(function(e){i.log("领取跨服排位奖励  GetRewardR",e),t.cb&&t.cb(),a.AppFacade.getInstance().retrieveProxy(a.BackpackPy.N).handleClientReward(e.clientReward),i.GetWorldKingInfo()})},i.prototype.JoinMatching=function(){var t=this;Utils.Socket.send("worldKing","JoinMatching",{}).then(function(e){t.setMatchingStatus(!0)})},i.prototype.CancelMatch=function(){var t=this;Utils.Socket.send("worldKing","CancelMatch",{}).then(function(e){t.setMatchingStatus(!1)})},i.prototype.BuyChallengeTimes=function(t,i){var n=this;Utils.Socket.send("worldKing","BuyChallengeTimes",{num:t}).then(function(e){Utils.MsgUtils.addMidMsg("成功购买"+t+"次"),n.updateInfo(e.info),i&&i()})},i.prototype.matchingSucceed=function(){this.setMatchingStatus(!1),this.fight()},i.prototype.matchingFail=function(){this.setMatchingStatus(!1),Utils.MsgUtils.addMidMsg("匹配失败，清稍后再试")},i.prototype.setMatchingStatus=function(e){this.isMatching=e,a.AppFacade.getInstance().updateView(a.WorldKingMediator.N,a.WorldKingMediator.SV.MAIN,{matching:e})},i.prototype.checkTimesNotice=function(){if(this.getOpenInfo().latestEndDt<Utils.TimerManager.getServerTime())return!1;var e=!1;if(this.worldKingInfo)if(0<this.worldKingInfo.times)e=!0;else{var t=a.Config.worldKingRewardConfig(WorldKingRewardType.BattleTimes),i=JSON.parse(this.worldKingInfo.gotRewards);for(var n in t){var o=t[n];if(i.indexOf(o.code)<0&&this.worldKingInfo.challengeTimes>=JSON.parse(o.key)[0]){e=!0;break}}}return e},i.prototype.checkRewardNotice=function(){if(this.getOpenInfo().latestEndDt<Utils.TimerManager.getServerTime())return!1;if(this.worldKingInfo){var e=JSON.parse(this.worldKingInfo.gotRewards),t=WorldKingRewardType.Level;a.GameMVC.loginPy.loginGameVO.singleSign&&(t=WorldKingRewardType.SingleLevel);var i=a.Config.worldKingRewardConfig(t);for(var n in i){var o=i[n];a.Config.worldKingLevelConfig()[JSON.parse(o.key)[0]];if(!(-1!=e.indexOf(o.code))&&this.worldKingInfo.hLevel>=JSON.parse(o.key)[0])return!0}return!1}},i.prototype.fight=function(){var e=this;this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeWorldKing,customParams:{},isPassive:!0,doneCB:function(){e.GetWorldKingInfo(),a.AppFacade.getInstance().retrieveProxy(a.FightPy.N).queueExceExitCB()}})},i.prototype.getOpenInfo=function(){return a.GameMVC.loginPy.loginGameVO.singleSign?Utils.TimerManager.checkIsOpenForSingleServer(a.Config.constConfig().SingleWorldKingDt.constValue):Utils.TimerManager.checkIsOpen_FormatB(a.Config.constConfig().WorldKingDt.constValue)},i.N="WorldKingPy",i}(BaseProxy);a.WorldKingPy=e,__reflect(e.prototype,"game.WorldKingPy")}(game||(game={})),function(e){var t=function(i){function p(e){var t=i.call(this)||this;return t.RANK_IMAGE={"青铜":"paiweisai_txt_qingtong","白银":"paiweisai_txt_baiyin","黄金":"paiweisai_txt_huangjin","铂金":"paiweisai_txt_bojin","钻石":"paiweisai_txt_zuanshi","星耀":"paiweisai_txt_xingyao","王者":"paiweisai_txt_wangzhe"},t.rankData=e,t.skinName="WorldKingBadgeSkin",t}return __extends(p,i),p.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.rankData&&this.updateBadge(this.rankData),this.pb_score.startingAngle=-90,this.pb_score.antiClockwise=!0},p.prototype.updateBadge=function(e,t){var i=this;if(void 0===t&&(t=!1),this.noStar=t,this.rankData=e,this.curType=this.rankData.type,this.grade=this.rankData.grade,null!=this.grade){var n;switch(this.curType){case p.RANK_TYPE.WORLD_KING:n=game.Config.worldKingLevelConfig();break;case p.RANK_TYPE.ZZQ:n=game.Config.chessStarLevel()}if(n){this.levelId=0;var o,a,r=-1,s=!1;for(var c in n){var l=n[c];if(s||(this.grade>=l.requestGrade?(this.levelId=l.code,o=l,r=Number(o.stars)):s=!0),s&&!a&&(a=l),s){if(!(r<Number(l.stars)))break;r=Number(l.stars)}}for(var h in egret.setTimeout(function(){i.pb_score.labelFunction=function(e,t){return"积分:"+i.grade+"/"+(a&&a.requestGrade||o.requestGrade)},a?(i.pb_score.maximum=2*(a.requestGrade-o.requestGrade),i.pb_score.value=0<i.grade-o.requestGrade?i.grade-o.requestGrade:0):(i.pb_score.maximum=2*o.requestGrade,i.pb_score.value=i.grade)},this,300),this.adaptStars(o.stars,-1==r?o.stars:r),this.img_icon.source=ResourceUtils.png(o.icon),e.fromRank?this.gp_rank.scaleX=this.gp_rank.scaleY=2.5:this.gp_rank.scaleX=this.gp_rank.scaleY=1,this.RANK_IMAGE)-1!=o.name.search(h)&&(this.img_rank_prefix.source=ResourceUtils.png(this.RANK_IMAGE[h]));0!=o.num?(this.gp_rank.contains(this.img_rank_suffix)||this.gp_rank.addChild(this.img_rank_suffix),this.img_rank_suffix.source="paiweisai_img_"+o.num+"_png"):this.gp_rank.contains(this.img_rank_suffix)&&this.gp_rank.removeChild(this.img_rank_suffix)}}},p.prototype.adaptStars=function(e,t){if(this.gp_stars_3.visible=!1,this.gp_stars_4.visible=!1,this.gp_stars_5.visible=!1,t=0==t?3:t,5==e&&-1==t&&this.curType==p.RANK_TYPE.ZZQ&&(t=5),!this.noStar){this["gp_stars_"+t].visible=!0;for(var i=1;i<=t;i++){var n=this["star_"+t+"_"+i];n.source=i<=e?"paiweisai_icon_xing1_png":"paiweisai_icon_xing2_png"}}},p.RANK_TYPE={WORLD_KING:1,ZZQ:2},p}(eui.Component);e.WorldKingBadge=t,__reflect(t.prototype,"customui.WorldKingBadge")}(customui||(customui={})),function(n){var e=function(t){function e(){var e=t.call(this)||this;return e.wkProxy=n.AppFacade.getInstance().retrieveProxy(n.WorldKingPy.N),e.playerProxy=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N),Utils.AssetsMgr.loadGroup("group_world_king"),e.skinName="WorldKingMainSkin",e.chestInterval=[],e}return __extends(e,t),e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_world_king")},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setMatchingEffectEnable(this.wkProxy.isMatching),this.initRewardsPB(),this.initPreviewGroup(),this.activateEndingTimer(),this._activateComponent(),this.addNotice()},e.prototype.initRewardsPB=function(){this.chestInterval.push(0),this.rewardsConfig=n.Config.worldKingRewardConfig(WorldKingRewardType.BattleTimes);var e=function(e){var t=o.rewardsConfig[e],i=JSON.parse(t.key)[0];o.pb_rewards["lb_"+e].text=i.toString();var n=o["gp_"+e];o["effect_"+e]=new eui.Group,n.addChild(o["effect_"+e]),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onChestBtnTap(e)},o),o.chestInterval.push(i)},o=this;for(var t in this.rewardsConfig)e(t);this.chestInterval.sort(function(e,t){return e-t}),this.pb_rewards.maximum=100*this.chestInterval[this.chestInterval.length-1]},e.prototype.initPreviewGroup=function(){},e.prototype.updateView=function(e){if(e&&null!=e.matching)this.setMatchingEffectEnable(e.matching);else{var t=this.wkProxy.worldKingInfo;if(t){var i=t.levelConfigId;n.Config.worldKingLevelConfig()[i];this.rankBadge.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.WORLD_KING,grade:t.grade}),this.blb_fightCap.text=this.playerProxy.playerInfoVO.fightCap.toString(),this.blb_score.text=""+t.grade,this.blb_rank.text=""+t.cWorldRank,this.playerHead.updateData({vo:this.playerProxy.playerInfoVO}),this.blb_count.text=t.times.toString(),this.updateRewardsChest()}else this.wkProxy.GetWorldKingInfo()}},e.prototype.updateRewardsChest=function(){var c=this.wkProxy.worldKingInfo,l=JSON.parse(c.gotRewards),e=function(e){var t=h.rewardsConfig[e],i=h["btn_reward_"+e],n=h["img_received_"+e],o=-1!=l.indexOf(t.code),a=c.challengeTimes>=JSON.parse(t.key)[0];i.available=!o&&a,UIActionManager.setAbsGrey(i,!a),n.visible=o;var r=h["effect_"+e];if(r.removeChildren(),i.available){i.visible=!1;var s="common_baoxiang_"+e;DragonBoneTools.create(s,function(e){e.visible=!0,e.scaleX=e.scaleY=.9,e.x=i.width/2,e.y=i.height/2+20,e.animation.play(),r.addChild(e)},h)}else i.visible=!0,i.icon=o?"jiangli_icon_baoxiang0"+e+"_02_png":"jiangli_icon_baoxiang0"+e+"_01_png"},h=this;for(var t in this.rewardsConfig)e(t);for(var i=c.challengeTimes,n=this.pb_rewards.maximum/100/(this.chestInterval.length-1),o=0,a=0;a<this.chestInterval.length&&i>=this.chestInterval[a];a++)o=n*a,this.chestInterval[a+1]&&i<this.chestInterval[a+1]&&(o+=(i-this.chestInterval[a])*n/(this.chestInterval[a+1]-this.chestInterval[a]));this.pb_rewards.value=100*o},e.prototype.openRewardEffect=function(o){for(var a=0,e=function(e){var t=r["btn_reward_"+e];if(t.available){a||(a=e);var i=e;r["effect_"+e].removeChildren(),t.visible=!0,t.icon="jiangli_icon_baoxiang0"+e+"_02_png";var n=r["gp_"+e];DragonBoneTools.playOnce({effectName:"common_baoxiangkai",parent:n,y:n.height/2,doneCB:function(){i==a&&o&&o()}})}},r=this,t=1;t<6;t++)e(t)},e.prototype.onChestBtnTap=function(e){var t=this;this["btn_reward_"+e].available?this.openRewardEffect(function(){t.wkProxy.GetReward({type:WorldKingRewardType.BattleTimes,id:t.rewardsConfig[e].code})}):this.updateRewardPreviewGroup(this.rewardsConfig[e])},e.prototype.updateRewardPreviewGroup=function(e){var t=JSON.parse(e.rewards);n.AppFacade.getInstance().showSubView(n.CommonMediator.N,n.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(t),type:n.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},e.prototype.setMatchingEffectEnable=function(e){var t=this;if(e){this.btn_match.label="匹配中";var i=this.btn_match.label.length;this.matchingEffectTimer=egret.setInterval(function(){t.btn_match.label.length<i+3?t.btn_match.label+=".":t.btn_match.label="匹配中"},this,300)}else this.matchingEffectTimer&&(egret.clearInterval(this.matchingEffectTimer),this.matchingEffectTimer=void 0),this.btn_match.label="匹配"},e.prototype.getRemainingTime=function(e){return Utils.TimerManager.getFormatBySecond1(e)},e.prototype.activateEndingTimer=function(){var t=this,i=this.wkProxy.getOpenInfo();this.lb_countdown.text=this.getRemainingTime(i.latestEndDt-Utils.TimerManager.getServerTime(!1)),this.endingTimer||(this.endingTimer=egret.setInterval(function(){var e=i.latestEndDt-Utils.TimerManager.getServerTime(!1);0<e?t.lb_countdown.text=""+t.getRemainingTime(e):(Utils.MsgUtils.addMidMsg("跨服争霸赛已结束"),n.MainJumpConfig.jumpTo())},this,1e3))},e.prototype.showBuyPanel=function(){var t=this;n.AppFacade.getInstance().showSubView(n.CommonMediator.N,n.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.WorldKing,hasBuyNum:this.wkProxy.worldKingInfo.hBuyTimes,maxBuyNum:Number(n.Config.constConfig().WorldKingMaxBuyChallengeTimes.constValue),buyCB:function(e){t.wkProxy.BuyChallengeTimes(e)}})},e.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.WORLD_KING_REWARD,this.btn_reward.$children[0],this,BTN_ICON_NOTICE_POS)},e.prototype._activateComponent=function(){var e=this;this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.MainJumpConfig.jumpTo()},this),this.btn_match.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.wkProxy.worldKingInfo;this.wkProxy.isMatching?this.wkProxy.CancelMatch():0<e.times?this.wkProxy.JoinMatching():this.wkProxy.worldKingInfo.hBuyTimes<Number(n.Config.constConfig().WorldKingMaxBuyChallengeTimes.constValue)?this.showBuyPanel():Utils.MsgUtils.addMidMsg("挑战次数不足")},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.GameMVC.loginPy.loginGameVO.singleSign?n.AppFacade.getInstance().showSubView(n.RankMediator.N,n.RankMediator.SV.COMMON,{module:"WORLD_KING_RANK_SINGLE"}):n.AppFacade.getInstance().showSubView(n.RankMediator.N,n.RankMediator.SV.COMMON,{module:"WORLD_KING_RANK"})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.GameMVC.loginPy.loginGameVO.singleSign?n.AppFacade.getInstance().showSubView(n.RankMediator.N,n.RankMediator.SV.COMMON,{module:"WORLD_KING_REWARD_SINGLE"}):n.AppFacade.getInstance().showSubView(n.RankMediator.N,n.RankMediator.SV.COMMON,{module:"WORLD_KING_REWARD"})},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeWorldKing})},this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.AppFacade.getInstance().showSubView(n.FightMediator.N,n.FightMediator.SV.RECORD,{records:this.wkProxy.worldKingInfo.battleRecord})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new n.HelpDialog({moduleId:MODULE.WorldKing})})},this),Utils.TouchUtils.addTouchListener(this.btn_add,function(){e.wkProxy.worldKingInfo.hBuyTimes<Number(n.Config.constConfig().WorldKingMaxBuyChallengeTimes.constValue)?e.showBuyPanel():Utils.MsgUtils.addMidMsg("今日已达购买次数上限")})},e.prototype.perClose=function(){egret.clearInterval(this.matchingEffectTimer),egret.clearInterval(this.endingTimer)},e}(BaseFull);n.WorldKingMainView=e,__reflect(e.prototype,"game.WorldKingMainView")}(game||(game={})),function(h){var e=function(t){function e(){var e=t.call(this)||this;return e.wkProxy=h.AppFacade.getInstance().retrieveProxy(h.WorldKingPy.N),e.skinName="WorldKingRewardSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.currentState="rank",this.initial(),this.activateComponent()},e.prototype.initial=function(){this.item_list=new eui.List;var e=new eui.VerticalLayout;this.item_list.layout=e,this.scroller.viewport=this.item_list,this.scroller.verticalScrollBar.autoVisibility=!1,this.scroller.verticalScrollBar.visible=!1},e.prototype.updateView=function(){switch(this.scroller.viewport.scrollV=0,this.scroller.stopAnimation(),this.currentState){case"rank":this.updateRank();break;case"segment":this.updateSegment()}},e.prototype.updateRank=function(){var i=this;this.item_list.itemRenderer=p;var e=this.wkProxy.worldKingInfo.hWorldRank;this.blb_highest.text=e.toString();var t=this.wkProxy.worldKingInfo.cWorldRank;this.lb_desc.text="你的当前排名为"+t+"，保持排名你可以获得：";var n="",o=h.Config.rankingRewardByTypeConfig(RankingType.RankingTypeWorldWorldKing),a=[];for(var r in o){var s=o[r];t>=s.rankUpper&&t<=s.rankLower&&(n=s.rewards);for(var c=s.rankUpper;c<=s.rankLower;c++)a.push({rank:c,rewards:s.rewards})}a.sort(function(e,t){return e.rank-t.rank}),this.item_list.dataProvider=new eui.ArrayCollection(a);var l=JSON.parse(n);this.gp_rewards.removeChildren(),l.forEach(function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,t.updateData({type:e[0],code:e[1],num:e[2]}),i.gp_rewards.addChild(t)})},e.prototype.updateSegment=function(){this.item_list.itemRenderer=c;var e=this.wkProxy.worldKingInfo,t=JSON.parse(e.gotRewards),i=h.Config.worldKingRewardConfig(WorldKingRewardType.Level),n=[];for(var o in i){var a=i[o],r=-1!=t.indexOf(a.code),s=!r&&e.hLevel>=JSON.parse(a.key)[0];n.push({config:a,available:s,received:r})}n.sort(function(e,t){return e.available!=t.available?t.available?1:-1:t.config.code-e.config.code}),this.item_list.dataProvider=new eui.ArrayCollection(n)},e.prototype.activateComponent=function(){this.daTanChuKuang.blb_title.text="奖励",this.daTanChuKuang.onCloseCB=function(){h.AppFacade.getInstance().hideSubView(h.WorldKingMediator.N,h.WorldKingMediator.SV.REWARD)},this.gp_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"rank"!=this.currentState&&(this.currentState="rank",this.updateView())},this),this.gp_segment.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"segment"!=this.currentState&&(this.currentState="segment",this.updateView())},this)},e}(BasePanel);h.WorldKingRewardPanel=e,__reflect(e.prototype,"game.WorldKingRewardPanel");var p=function(i){function e(){var e=i.call(this)||this;return e.skinName="WorldKingRewardPanel_RankItem",e}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this);for(var e=1;e<=3;e++){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,this.gp_rewards.addChild(t)}},e.prototype.dataChanged=function(){var e=this.data.rank;e<=3?(this.img_icon.visible=!0,this.lb_rank.visible=!1,this.img_icon.source="jjc_icon_pm_"+e+"_png"):(this.img_icon.visible=!1,this.lb_rank.visible=!0,this.lb_rank.text=e.toString());for(var t=JSON.parse(this.data.rewards),i=0;i<3;i++){var n=this.gp_rewards.getChildAt(i),o=t[i];o?(n.visible=!0,n.updateData({type:o[0],code:o[1],num:o[2]})):n.visible=!1}},e}(eui.ItemRenderer);__reflect(p.prototype,"WorldKingRewardPanel_RankItem");var c=function(i){function e(){var e=i.call(this)||this;return e.wkProxy=h.AppFacade.getInstance().retrieveProxy(h.WorldKingPy.N),e.skinName="WorldKingRewardPanel_SegmentItem",e}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.btn_receive.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.available?this.wkProxy.GetReward({tyep:this.data.config.type,id:this.data.config.code}):Utils.MsgUtils.addMidMsg("条件未达成")},this);for(var e=1;e<=3;e++){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,this.gp_rewards.addChild(t)}},e.prototype.dataChanged=function(){var e=this.data.config,t=h.Config.worldKingLevelConfig()[JSON.parse(e.key)[0]];this.lb_desc.text="段位达到"+t.name;for(var i=JSON.parse(e.rewards),n=0;n<3;n++){var o=this.gp_rewards.getChildAt(n),a=i[n];a?(o.visible=!0,o.updateData({type:a[0],code:a[1],num:a[2]})):o.visible=!1}this.data.received?(this.lb_received.visible=!0,this.btn_receive.visible=!1):(this.lb_received.visible=!1,this.btn_receive.visible=!0,this.data.available?(this.btn_receive.enabled=!0,this.btn_receive.label="领取"):(this.btn_receive.enabled=!1,this.btn_receive.label="未达成"))},e}(eui.ItemRenderer);__reflect(c.prototype,"WorldKingRewardPanel_SegmentItem")}(game||(game={})),function(e){var t=function(t){function i(){var e=t.call(this,i.N)||this;return NoticeManager.registerCB(NT.ZONE_BOSS_SOMEAPPLY,function(){return!1},e),NoticeManager.registerCB(NT.ZONE_BOSS_FIRSTLOGIN,function(){return!1},e),e}return __extends(i,t),i.prototype.isFeaturesUnlock=function(e,t){return{isBelonged:!1,unlock:!1}},i.prototype.getOpenInfo=function(){return{isOpen:!0}},i.prototype.GetZoneBossTaskInfo=function(e){},i.prototype.GetZoneBossInfo=function(e){},i.N="ZoneBossProxy",i}(BaseProxy);e.ZoneBossPy=t,__reflect(t.prototype,"game.ZoneBossPy")}(game||(game={})),function(r){var e=function(o){function e(e){var t=o.call(this)||this;return t.skinName="GiftBagsSkin",t.params=e,t.giftId=e&&e.giftId||1,t.ret=e&&e.ret,t}return __extends(e,o),e.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.isGet=-1!=r.GameMVC.activityPy.giftList.indexOf(this.giftId);var t=r.Config.giftConfig()[this.giftId];if(0==t.qqZoneVip){if(this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.removePopUp(e)},this),0==t.vipRange&&this.isGet&&(this.gp_title.width=460),0==t.vipRange)this.blb_title.text=this.isGet?"每天只能领取一次哦":"领取成功",this.lb_tips.text=this.isGet?"你今天已经领取过":"恭喜你领取了：",this.gp_rewards.visible=!0,this.lb_gotTips.visible=!1,this.lb_hints.visible=!0,this.lb_hints.text="            记得明天继续到                    玩吧礼包中心领取新的礼包哦！~";else{var i=this.ret;if(0==i.ret){this.gp_rewards.visible=!0,this.lb_gotTips.visible=!1;var n=t.vipRange;this.blb_title.text="领取成功",this.lb_tips.text=this.isGet?"你已经领取过VIP"+n+"礼包":"恭喜你，获得VIP"+n+"礼包：",this.lb_hints.visible=!0,this.lb_tips.visible=!0,this.lb_hints.text="明天请记得再来领取喔~"}else{this.gp_rewards.visible=!1,this.lb_gotTips.visible=!0;this.blb_title.text="领取失败",this.lb_gotTips.text={2007:"VIP等级不匹配，无法领取",2008:"很遗憾，您的VIP等级已失效，点亮特权后重新领取。",2e3:"系统繁忙，请稍后重试或联系客服进行处理。"}[i.ret]||i.msg,this.lb_hints.visible=!1,this.lb_tips.visible=!1}}this.updateView()}},e.prototype.updateView=function(e){for(var t=r.Config.giftConfig()[this.giftId],i=0,n=JSON.parse(t.rewards);i<n.length;i++){var o=n[i],a=customui.BaseItemFactory.create();a.updateData({reward:o}),a.scaleX=a.scaleY=.8,this.gp_items.addChild(a)}},e}(BasePanel);r.GiftBagsView=e,__reflect(e.prototype,"game.GiftBagsView")}(game||(game={})),function(h){var e=function(t){function e(){var e=t.call(this)||this;return e.isDownload=!1,e.isDwonloadTarget=!1,e.isLoginTarget=!1,e.isTargetPlatform=!1,e.downLoadId=1101,e.loginId=1102,e.skinName="NativeDownloadSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),this.isTargetPlatform="gameApp"==getUrlKV().channel,this.isDownload=Utils.SDKMgr.extraFuncForAgent({type:"appDownload"}),this.isDwonloadTarget=-1!=h.GameMVC.activityPy.giftList.indexOf(this.downLoadId),this.isLoginTarget=-1!=h.GameMVC.activityPy.giftList.indexOf(this.loginId),this.btn_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=function(){i.updateView()};if(i.isDownload||i.isDwonloadTarget||i.isLoginTarget)if(!i.isDownload||i.isTargetPlatform||i.isDwonloadTarget||i.isLoginTarget){if(i.isDownload&&i.isTargetPlatform&&i.isDwonloadTarget&&!i.isLoginTarget)h.GameMVC.activityPy.getGiftRewardFormServer({giftId:i.loginId,cb:e})}else h.GameMVC.activityPy.getGiftRewardFormServer({giftId:i.downLoadId,cb:e});else{var t=Utils.agentConfig.other.weiduanUrl||"https://h5.qzone.qq.com/h5plus/download/1108515115?_wv=1025&via=H5.APP.YOUXINEI&autoDownload=1&hideDemo=1&newDownload=1";Utils.SDKMgr.extraFuncForAgent({type:"openUrl",params:{url:t}}),Utils.SDKMgr.extraFuncForAgent({type:"appDownload",params:{cb:function(e){i.isDownload=e,i.updateView({suc:e})}}})}},this),this.updateView()},e.prototype.updateView=function(e){var t=this.isDwonloadTarget||this.isLoginTarget||this.isDownload?this.loginId:this.downLoadId;this.isDwonloadTarget=-1!=h.GameMVC.activityPy.giftList.indexOf(this.downLoadId),this.isLoginTarget=-1!=h.GameMVC.activityPy.giftList.indexOf(this.loginId);var i=h.Config.giftConfig()[t],n=JSON.parse(i.rewards);this.gp_rewards.removeChildren();for(var o=0,a=n;o<a.length;o++){var r=a[o],s=customui.BaseItemFactory.create();s.updateData({reward:r}),s.scaleX=s.scaleY=.8,this.gp_rewards.addChild(s)}var c="下载微端";if(!this.isDownload||this.isTargetPlatform||this.isDwonloadTarget||this.isLoginTarget)if(this.isDownload&&e&&e.suc&&!this.isTargetPlatform&&!this.isDwonloadTarget&&!this.isLoginTarget){var l=e&&e.suc;c=l?"领取奖励":"领取失败",l||this.updateView()}else this.isDownload&&this.isTargetPlatform&&this.isDwonloadTarget&&!this.isLoginTarget?c="领取奖励":this.isDownload&&this.isTargetPlatform&&this.isDwonloadTarget&&this.isLoginTarget&&(c="已领取",this.btn_btn.touchEnabled=!1,UIActionManager.setAbsGrey(this.btn_btn,!0));else this.btn_btn.touchEnabled=this.isTargetPlatform,c="微端登录";this.btn_btn.label=c},e}(BasePanel);h.NativeDownloadView=e,__reflect(e.prototype,"game.NativeDownloadView")}(game||(game={})),function(d){var e=function(n){function e(e){var t=n.call(this)||this;return t.gift_type={PC:{id:2401,bg:"wanba_img_dengluyouli_png",rewards:JSON.parse(d.Config.giftConfig()[2401].rewards)},huangzuan:{id:2403,bg:"wanba_img_qqhuangzuantequan_png",rewards:JSON.parse(d.Config.giftConfig()[2403].rewards)},QQVip:{id:2404,bg:"wanba_img_qqhuiyuantequan_png",rewards:JSON.parse(d.Config.giftConfig()[2404].rewards)},xinYueClub:{id:2402,bg:"wanba_img_xinyuetequan_png",rewards:JSON.parse(d.Config.giftConfig()[2402].rewards)}},t.skinName="QQCommonGiftSKin",t.params=e,t}return __extends(e,n),e.prototype.childrenCreated=function(){var i=this;n.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=d.GameMVC.activityPy.giftList,t=i.gift_type[i.params.type].id;-1==e.indexOf(t)?d.GameMVC.activityPy.getGiftRewardFormServer({giftId:t,cb:function(){i.updateView(i.params),d.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN)}}):Utils.MsgUtils.addMidMsg("已领取过，明天再来领吧！")},this),this.updateView()},e.prototype.updateView=function(e){var t=e||this.params,i=t&&t.type,n=this.gift_type[i].bg,o=this.gift_type[i].rewards;this.img_bg.source=n,this.gp_rewards.removeChildren();for(var a=0,r=o;a<r.length;a++){var s=r[a],c=customui.BaseItemFactory.create();c.updateData({reward:s}),c.scaleX=c.scaleY=.8,this.gp_rewards.addChild(c)}var l=d.GameMVC.activityPy.giftList,h=this.gift_type[i].id,p=-1!=l.indexOf(h);this.btn_get.label=p?"已领取":"领取",this.btn_get.touchEnabled=!p,UIActionManager.setAbsGrey(this.btn_get,p)},e}(BasePanel);d.QQCommonGiftView=e,__reflect(e.prototype,"game.QQCommonGiftView")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.skinName="QQLiveSkin",t.doneCb=e&&e.cb,t}return __extends(e,i),e.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.btn_jump.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=Utils.agentConfig.other.tengxunUrl||"https://iwan.qq.com/fun/mindex?ADTAG=txsp.wd.xyx&hidetitlebar=1&autoplay=1";Utils.SDKMgr.extraFuncForAgent({type:"openUrl",params:{url:e}})},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide(),e.doneCb&&e.doneCb()},this)},e}(BasePanel);e.QQLiveView=t,__reflect(t.prototype,"game.QQLiveView")}(game||(game={})),function(f){var e=function(t){function e(){var e=t.call(this)||this;return e.actPy=f.GameMVC.activityPy,e.skinName="VIPPrivilegeSkin",e}return __extends(e,t),e.prototype.initList=function(){var e=getUrlKV().QQVipLevel||0;this.lb_vipLevel.text="VIP"+e;var t=f.Config.activityConfigs()[EActivityType.QQZoneVipGift];this.img_bg.source=ResourceUtils.png(JSON.parse(t.img_title)[0]),this.list_items.itemRenderer=f.ActivityCommonListItem,this.sl_items.scrollPolicyH=eui.ScrollPolicy.OFF},e.prototype.getDataList=function(){var p=this,d=getUrlKV().QQVipLevel||0,u=f.Config.giftConfig(),g=[],e=function(n){var o=u[n];if(0<o.qqZoneVip&&o.qqZoneVip>=d){var e=REWARD_STATUS.NEXT_REWARD,t=JSON.parse(o.rewards),i=o.qqZoneVip,a={id:n,rewards:t,status:e,title:"小游戏VIP"+i+"礼包",btnFunc:void 0};if(d<o.qqZoneVip)return a.status=REWARD_STATUS.NEXT_REWARD,a.title="下一个小游戏VIP"+i+"礼包，可领取：",g.push(a),"break";if(d==o.qqZoneVip){for(var r=f.GameMVC.activityPy.giftList,s=-1==r.indexOf(Number(n)),c=0,l=r;c<l.length;c++){var h=l[c];if(0!=u[h].qqZoneVip){s=!1;break}}a.status=s?REWARD_STATUS.AVAILABLE:REWARD_STATUS.RECEIVED,a.btnFunc=function(){p.getVIPInfo({id:n,cb:function(e){if(0==e.ret)f.GameMVC.activityPy.getGiftReward({giftId:Number(n),isVIPPri:!0,cb:function(e){p.updateView()}});else{var t=e.level,i="领取礼包失败";o.qqZoneVip>t&&(i="等级不足，需消费"+e.pay_fee_min+"星币到达等级"),o.qqZoneVip<t&&(i="当前礼包已过期"),Utils.MsgUtils.addMidMsg(i)}}})},g.push(a)}}};for(var t in u){if("break"===e(t))break}return g},e.prototype.updateView=function(e){this.getVIPInfo();var t=this.getDataList();this.list_items.dataProvider?this.list_items.dataProvider.replaceAll(t):this.list_items.dataProvider=new eui.ArrayCollection(t)},e.prototype.getVIPInfo=function(t){Utils.Http.toGet({action:"get_vipLev",appid:getUrlKV().appid,openid:getUrlKV().openid,openkey:getUrlKV().openkey,pf:getUrlKV().pf,gift_id:t&&t.id||0}).then(function(e){0==e.vip.ret&&(getUrlKV().QQVipLevel=e.vip.level),t.cb&&t.cb(e.vip)}).catch(function(){})},e}(f.ActivityCommonListView);f.VIPPrivilegeView=e,__reflect(e.prototype,"game.VIPPrivilegeView")}(game||(game={})),function(r){var e=function(t){function e(){var e=t.call(this)||this;return e.rewardId=2402,e.skinName="XinyueClubSkin",e}return __extends(e,t),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.activityPy.getGiftRewardFormServer({giftId:e.rewardId,cb:function(){e.updateView()}})},this),this.btn_btn_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=Utils.agentConfig.other.xinyueUrl||"http://xinyue.qq.com/act/a20181130xyh5game/index.html";Utils.SDKMgr.extraFuncForAgent({type:"openUrl",params:{url:e}})},this),this.updateView()},e.prototype.updateView=function(){var e=JSON.parse(r.Config.giftConfig()[this.rewardId].rewards);this.gp_rewards1.removeChildren();for(var t=0,i=e;t<i.length;t++){var n=i[t],o=customui.BaseItemFactory.create();o.updateData({reward:n}),o.scaleX=o.scaleY=.8,this.gp_rewards1.addChild(o)}var a=-1!=r.GameMVC.activityPy.giftList.indexOf(this.rewardId);this.btn_got.visible=a,this.btn_btn_1.visible=!a},e}(BasePanel);r.XinyueCLubView=e,__reflect(e.prototype,"game.XinyueCLubView")}(game||(game={})),function(t){var e=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.code=e.code,this.startDt=e.startDt,this.endDt=e.endDt,this.content=JSON.parse(e.content),this.skinId=e.skinId},e.prototype.updateData=function(e){try{"string"==typeof e&&(e=JSON.parse(e))}catch(e){}switch(this.code){case EActivityType.MidAutumn:this.data?(this.data.keng=e.keng||this.data.keng,this.data.playerInfo=e.playerInfo||this.data.playerInfo):this.data=e;break;default:this.data=e}for(var t in e){var i=e[t];i&&"object"==typeof i&&0==Object.keys(i).length&&(e[t]=[])}this.onDataUpdate()},e.prototype.onDataUpdate=function(){NoticeManager.updateNotice(NT.ALL_ACTIVITY[this.code]);var e=t.AppFacade.getInstance().retrieveMediator(t.ActivityMediator.N);switch(e.updateViewByCode(this.code),this.code){case EActivityType.WholeLifeCard:e.updateViewByCode(EActivityType.MonthCard);break;case EActivityType.MidAutumn:this.data.playerInfo&&this.data.playerInfo.treeRewards&&this.data.playerInfo.treeRewards.length&&t.GameMVC.fightPy.addDelayCBAfterFightExit(function(){t.AppFacade.getInstance().showSubView(t.ActivityMediator.N,t.ActivityMediator.SV.MID_AUTUMN_IDEL_REWARD),t.GameMVC.fightPy.queueExceExitCB()},"midAutumn");break;case EActivityType.ExtremeBattle:t.AppFacade.getInstance().sendNotification(CN.EXTREME_CHALLENGE_MODEL_UPDATE)}},e}(t.BaseVO);t.ActivityVO=e,__reflect(e.prototype,"game.ActivityVO")}(game||(game={})),function(i){var e=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.execute=function(e){this.registerMediatorAs(i.LoadingMediator,"loadingMed"),this.registerMediatorAs(i.LoginMediator,"loginMed"),this.registerMediatorAs(i.MainMediator,"mainMed"),this.registerMediatorAs(i.CityMediator,"cityMed"),this.registerMediatorAs(i.FightMediator,"fightMed"),this.registerMediatorAs(i.GuajiMediator,"guajiMed"),this.registerMediatorAs(i.MailMediator,"mailMed"),this.registerMediatorAs(i.BackpackMediator,"backpackMed"),this.registerMediatorAs(i.CopyEntranceMediator,"copyEntranceMed"),this.registerMediatorAs(i.PvpEntranceMediator,"pvpEntranceMed"),this.registerMediatorAs(i.ExtEntranceMediator,"extEntranceMed"),this.registerMediatorAs(i.FriendMediator,"friendMed"),this.registerMediatorAs(i.ShopyMediator,"shopyMed"),this.registerMediatorAs(i.RechargeMediator,"rechargeMed"),this.registerMediatorAs(i.TaskMediator,"taskMed"),this.registerMediatorAs(i.GuideMediator,"guideMed"),this.registerMediatorAs(i.ActivityMediator,"activityMed"),this.registerMediatorAs(i.RankMediator,"rankMed"),this.registerMediatorAs(i.CommonMediator,"commonMed"),this.registerMediatorAs(i.GuildMediator,"guildMed"),this.registerMediatorAs(i.HeroMediator,"heroMed"),this.registerMediatorAs(i.HeroThingMediator,"heroThingMed"),this.registerMediatorAs(i.ArenaMediator,"arenaMed"),this.registerMediatorAs(i.ManorMediator,"manorMed"),this.registerMediatorAs(i.StormWarMediator,"stormWarMed"),this.registerMediatorAs(i.WorldKingMediator,"worldKingMed"),this.registerMediatorAs(i.BattleZoneArenaMediator,"battleZoneArenaMed"),this.registerMediatorAs(i.TeamExpeMediator,"teamExpeMed"),this.registerMediatorAs(i.TeamPlayEntranceMediator,"teamPlayEntranceMed"),this.registerMediatorAs(i.ChampionMediator,"championMed"),this.registerMediatorAs(i.PetMediator,"petMed"),this.registerMediatorAs(i.MagicalArtifactMediator,"magicalArtifactMed"),this.registerMediatorAs(i.HeroSpiritMediator,"heroSpiritMed"),this.registerMediatorAs(i.GuildCollectMediator,"guildCollectMed"),this.registerMediatorAs(i.GuildBossMediator,"guildBossMed"),this.registerMediatorAs(i.GuildWarMediator,"guildWarMed"),this.registerMediatorAs(i.WorldBossMediator,"worldBossMed"),this.registerMediatorAs(i.HeroChallengeMediator,"heroChallengeMed"),this.registerMediatorAs(i.HeroChallenge2Mediator,"heroChallenge2Med"),this.registerMediatorAs(i.GuildSkillMediator,"guildSkillMed"),this.registerMediatorAs(i.GuildInstanceMediator,"guildInstanceMed"),this.registerMediatorAs(i.PlayerMediator,"playerMed"),this.registerMediatorAs(i.ChatMediator,"chatMed"),this.registerMediatorAs(i.TouchGoldHandMediator,"touchGoldHandMed"),this.registerMediatorAs(i.StrongMediator,"strongMed"),this.registerMediatorAs(i.HandBookMediator,"handBookMed"),this.registerMediatorAs(i.ModuleOpenMediator,"moduleOpenMed"),this.registerMediatorAs(i.BraveBookMediator,"braveBookMed"),this.registerMediatorAs(i.SmithyMediator,"smithyMed"),this.registerMediatorAs(i.TitleMediator,"titleMed"),this.registerMediatorAs(i.ZzqMediator,"zzqMed"),this.registerMediatorAs(i.LuckyTableMed,"luckyTableMed"),this.registerMediatorAs(i.DeepNestMediator,"DeepNestMed"),this.registerMediatorAs(i.DungeonMed,"dungeonMed"),this.registerMediatorAs(i.TribeBattleMed,"tribeBattleMed"),this.registerMediatorAs(i.PeakWarMed,"peakWarMed"),this.registerMediatorAs(i.FashionMediator,"fashionMed"),this.registerMediatorAs(i.MountMediator,"mountMediator")},t.prototype.registerMediatorAs=function(e,t){this.facade.registerMediator(new e),i.GameMVC[t]=i.AppFacade.getInstance().retrieveMediator(e.N)},t}(puremvc.SimpleCommand);i.ViewPrepCommand=e,__reflect(e.prototype,"game.ViewPrepCommand",["puremvc.ICommand","puremvc.INotifier"]);var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.execute=function(e){this.facade.removeMediator(i.LoadingMediator.N),this.facade.removeMediator(i.LoginMediator.N),this.facade.removeMediator(i.MainMediator.N),this.facade.removeMediator(i.CityMediator.N),this.facade.removeMediator(i.FightMediator.N),this.facade.removeMediator(i.GuajiMediator.N),this.facade.removeMediator(i.MailMediator.N),this.facade.removeMediator(i.BackpackMediator.N),this.facade.removeMediator(i.CopyEntranceMediator.N),this.facade.removeMediator(i.PvpEntranceMediator.N),this.facade.removeMediator(i.ExtEntranceMediator.N),this.facade.removeMediator(i.FriendMediator.N),this.facade.removeMediator(i.ShopyMediator.N),this.facade.removeMediator(i.RechargeMediator.N),this.facade.removeMediator(i.TaskMediator.N),this.facade.removeMediator(i.GuideMediator.N),this.facade.removeMediator(i.ActivityMediator.N),this.facade.removeMediator(i.RankMediator.N),this.facade.removeMediator(i.CommonMediator.N),this.facade.removeMediator(i.GuildMediator.N),this.facade.removeMediator(i.HeroMediator.N),this.facade.removeMediator(i.HeroThingMediator.N),this.facade.removeMediator(i.ArenaMediator.N),this.facade.removeMediator(i.ManorMediator.N),this.facade.removeMediator(i.StormWarMediator.N),this.facade.removeMediator(i.WorldKingMediator.N),this.facade.removeMediator(i.BattleZoneArenaMediator.N),this.facade.removeMediator(i.TeamExpeMediator.N),this.facade.removeMediator(i.TeamPlayEntranceMediator.N),this.facade.removeMediator(i.ChampionMediator.N),this.facade.removeMediator(i.PetMediator.N),this.facade.removeMediator(i.GuildCollectMediator.N),this.facade.removeMediator(i.GuildBossMediator.N),this.facade.removeMediator(i.GuildWarMediator.N),this.facade.removeMediator(i.WorldBossMediator.N),this.facade.removeMediator(i.HeroChallengeMediator.N),this.facade.removeMediator(i.HeroChallenge2Mediator.N),this.facade.removeMediator(i.GuildSkillMediator.N),this.facade.removeMediator(i.PlayerMediator.N),this.facade.removeMediator(i.ChatMediator.N),this.facade.removeMediator(i.TouchGoldHandMediator.N),this.facade.removeMediator(i.StrongMediator.N),this.facade.removeMediator(i.GuildInstanceMediator.N),this.facade.removeMediator(i.MagicalArtifactMediator.N),this.facade.removeMediator(i.HeroSpiritMediator.N),this.facade.removeMediator(i.HandBookMediator.N),this.facade.removeMediator(i.ModuleOpenMediator.N),this.facade.removeMediator(i.BraveBookMediator.N),this.facade.removeMediator(i.SmithyMediator.N),this.facade.removeMediator(i.TitleMediator.N),this.facade.removeMediator(i.ZzqMediator.N),this.facade.removeMediator(i.LuckyTableMed.N),this.facade.removeMediator(i.DungeonMed.N),this.facade.removeMediator(i.TribeBattleMed.N),this.facade.removeMediator(i.PeakWarMed.N),this.facade.removeMediator(i.FashionMediator.N),this.facade.removeMediator(i.MountMediator.N)},t}(puremvc.SimpleCommand);i.ViewRemoveCommand=t,__reflect(t.prototype,"game.ViewRemoveCommand",["puremvc.ICommand","puremvc.INotifier"])}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.data=e,t.skinName="ButtonSkinWithCost",t}return __extends(e,i),e.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.cost.img_bg.visible=!1,this.updateData()},e.prototype.updateData=function(e){if(this.data=e,this.data){this.btn_btn.icon=this.data.source,this.btn_btn.label=this.data.text;var t=this.data.cost;t?(this.cost.visible=!0,this.cost.updateItem({cost:t})):this.cost.visible=!1}},e}(eui.Component);e.ButtonSkinWithCost=t,__reflect(t.prototype,"customui.ButtonSkinWithCost")}(customui||(customui={})),function(n){var o=function(i){function e(e){var t=i.call(this)||this;return t.playerId=e.playerId,t.playerName=e.playerName,t.area=e.area,t.serverName=e.serverName,t.avatar=e.avatar,t.level=e.level,t}return __extends(e,i),e}(n.BaseVO);n.SChatEntity=o,__reflect(o.prototype,"game.SChatEntity");var e=function(i){function e(e){var t=i.call(this)||this;return t.hasInit=!1,t.level=e.level,t.priority=e.priority,t.isTextFlow=e.isTextFlow,t.msgId=e.msgId,t.channelType=e.channelType,t.sendDt=e.sendDt,t.content=e.content,t.ShowType=e.ShowType,t.ShowChannel=e.ShowChannel,t.SystemMsgType=e.SystemMsgType,t.params=e.params,e.fromPlayer&&(t.fromPlayer=new o(e.fromPlayer)),e.toPlayer&&(t.toPlayer=new o(e.toPlayer)),t}return __extends(e,i),e}(n.BaseVO);n.SChatMsg=e,__reflect(e.prototype,"game.SChatMsg");var a=function(i){function e(e){var t=i.call(this)||this;return t.id=e.id,t.type=e.type,t.effect=e.effect,t}return __extends(e,i),e}(n.BaseVO);n.VictoryCell=a,__reflect(a.prototype,"game.VictoryCell");var t=function(i){function e(e){var t=i.call(this)||this;return t.layer=e.layer,t.vit=e.vit,t.buffs=e.buffs,t.buyCount=e.buyCount,t.rewardGot=e.rewardGot,e.cells&&(t.cells=new Array,e.cells.forEach(function(e){t.cells.push(new a(e))})),t}return __extends(e,i),e}(n.BaseVO);n.VictoryInfo=t,__reflect(t.prototype,"game.VictoryInfo");var i=function(i){function e(e){var t=i.call(this)||this;return t.id=e.id,t.beginRewardTime=e.beginRewardTime,t.winTime=e.winTime,t.level=e.level,t.rLevel=e.rLevel,t}return __extends(e,i),e}(n.BaseVO);n.ExploredInfo=i,__reflect(i.prototype,"game.ExploredInfo");var r=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(e){this.count=e.count,this.buyCount=e.buyCount,this.lRCD=e.lRCD},t}(n.BaseVO);n.ChallengeInfo=r,__reflect(r.prototype,"game.ChallengeInfo");var s=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){e.rank&&(this.rank=e.rank),e.hRank&&(this.hRank=e.hRank),e.hRankTargeted&&(this.hRankTargeted=e.hRankTargeted),this.challengeInfo||(this.challengeInfo=new r),e.challengeInfo&&this.challengeInfo.update(e.challengeInfo),NoticeManager.updateNotice(NT.ARENA_REWARD_LINQU,void 0,!0)},e}(n.BaseVO);n.ArenaInfo=s,__reflect(s.prototype,"game.ArenaInfo");var c=function(i){function e(e){var t=i.call(this)||this;return t.playerId=e.playerId,t.battleDt=e.battleDt,t.result=e.result,t.pKey=e.pKey,t.rKey=e.rKey,t.tPKey=e.tPKey,t.tRKey=e.tRKey,t.battleUuid=e.battleUuid,t.challengerId=e.challengerId,t.baseInfo=new P(e.baseInfo),t}return __extends(e,i),e}(n.BaseVO);n.BattleRecord=c,__reflect(c.prototype,"game.BattleRecord");var l=function(i){function e(e){var t=i.call(this)||this;return t.challengerId=e.challengerId,t.beChallengerId=e.beChallengerId,t.battleDt=e.battleDt,t.result=e.result,t.battleUuid=e.battleUuid,t.cHeroList=e.cHeroList,t.bHeroList=e.bHeroList,t}return __extends(e,i),e}(n.BaseVO);n.BattleMemberRecord=l,__reflect(l.prototype,"game.BattleMemberRecord");var h=function(i){function e(e){var t=i.call(this)||this;return t.teamId=e.teamId,t.battleDt=e.battleDt,t.result=e.result,t.pKey=e.pKey,t.rKey=e.rKey,t.battleUuids=e.battleUuids,t.challengerTeamId=e.challengerTeamId,t.memberRecords=e.memberRecords,t.team=new n.TeamVO(e.team),t.team.members.forEach(function(e){t.fightCap+=e.baseInfo.fightCap}),t}return __extends(e,i),e}(n.BaseVO);n.TeamBattleRecord=h,__reflect(h.prototype,"game.TeamBattleRecord");var p=function(i){function e(e){var t=i.call(this)||this;return t.playerId=e.playerId,t.name=e.name,t.level=e.level,t.vLevel=e.vLevel,t.fightCap=e.fightCap,t.rank=e.rank,t.camp=e.camp,t.avatar=e.avatar,t.serverId=e.serverId,t}return __extends(e,i),e}(n.BaseVO);n.ArenaPlayerInfo=p,__reflect(p.prototype,"game.ArenaPlayerInfo");var d=function(i){function t(e){var t=i.call(this)||this;return t.team=new n.TeamVO(e),e&&t.update(e),t}return __extends(t,i),Object.defineProperty(t.prototype,"memberNum",{get:function(){return this.team.members.length},enumerable:!0,configurable:!0}),t.prototype.update=function(e){e?(this.rank=e.rank,this.score=e.score,this.enrolled=e.enrolled,this.ballot=e.ballot,this.winNum=e.winNum,this.loseNum=e.loseNum,this.team.update(e.team)):(this.rank=0,this.score=0,this.enrolled=!1,this.ballot=0,this.winNum=0,this.loseNum=0,this.team.update())},t.makeFakeData=function(){var e=new t;return e.rank=0,e.score=0,e.team=n.TeamVO.makeFakeData(),e.enrolled=!0,e.ballot=Utils.MathUtils.getRandomInt(0,100),e},t}(n.BaseVO);n.TATeamInfoVO=d,__reflect(d.prototype,"game.TATeamInfoVO");var u=function(i){function e(e){var t=i.call(this)||this;return t.teamInfo=new d,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.teamInfo.update(e.teamInfo),this.voteTeamId=e.voteTeamId},e}(n.BaseVO);n.TeamArenaInfoVO=u,__reflect(u.prototype,"game.TeamArenaInfoVO");var g=function(i){function o(e){var t=i.call(this)||this;return t.teams=[],e&&t.update(e),t}return __extends(o,i),o.prototype.update=function(e){var t=this;this.teams.splice(0),e.teams.forEach(function(e){t.teams.push(new d(e))}),this.ballot=e.ballot},o.makeFakeData=function(e){var t=new o;t.id=Utils.DebugUtils.getFakePlayerId(),e||(e=4);for(var i=0;i<e;i++){var n=d.makeFakeData();t.teams.push(n)}return t.ballot=0,t.teams.forEach(function(e){t.ballot+=e.ballot}),t},o}(n.BaseVO);n.TeamArenaGroupVO=g,__reflect(g.prototype,"game.TeamArenaGroupVO");var f=function(i){function e(e){var t=i.call(this)||this;return t.team=new n.TeamVO(e),e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){e?(this.sectionId=e.sectionId,this.team.update(e.team)):(this.sectionId=0,this.team.update())},e}(n.BaseVO);n.TETeamInfoVO=f,__reflect(f.prototype,"game.TETeamInfoVO");var _=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.sectionId=e.sectionId,this.num=e.num},e}(n.BaseVO);n.TeamExpeChallengeInfoVO=_,__reflect(_.prototype,"game.TeamExpeChallengeInfoVO");var m=function(i){function e(e){var t=i.call(this)||this;return t.teamInfo=new f,t.challengeList=new Array,t.targeted=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.sectionId=e.sectionId,this.helpTime=e.helpTime,this.targeted=e.targeted,this.teamInfo.update(e.teamInfo),NoticeManager.updateNotice(NT.TEAM_EXPE_REWARD)},e}(n.BaseVO);n.TeamExpeInfoVO=m,__reflect(m.prototype,"game.TeamExpeInfoVO");var y=function(i){function e(e){var t=i.call(this)||this;return t.playerBaseInfo=new n.PlayerInfoVO,t.guildBaseInfo=new n.GuildVO,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.rank=e.rank,this.key=e.key,this.playerBaseInfo.update(e.playerBaseInfo),this.guildBaseInfo.update(e.guildBaseInfo),this.additionInfo=e.additionInfo},e}(n.BaseVO);n.CommonRankItemVO=y,__reflect(y.prototype,"game.CommonRankItemVO");var v=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.rank=e.rank,this.key=e.key,this.team=e.team},e}(n.BaseVO);n.TeamCommonRankItemVO=v,__reflect(v.prototype,"game.TeamCommonRankItemVO");var T=function(i){function e(e){var t=i.call(this)||this;return t.rank=e.rank,t.guildLevel=e.guildLevel,t.presidentId=e.presidentId,t.presidentName=e.presidentName,t.guildFightCap=e.guildFightCap,t.guildAvatar=e.guildAvatar,t.guildName=e.guildName,t.key=e.key,t.vLevel=e.vLevel,t}return __extends(e,i),e}(n.BaseVO);n.GuildRankItem=T,__reflect(T.prototype,"game.GuildRankItem");var C=function(i){function e(e){var t=i.call(this)||this;return t.playerId=e.playerId,t.name=e.name,t.level=e.level,t.avatar=e.avatar,t.serverId=e.serverId,t.serverName=e.serverName,t.num=e.num,t.dt=e.dt,t}return __extends(e,i),e.prototype.update=function(e){this.playerId=e.playerId,this.name=e.name,this.level=e.level,this.avatar=e.avatar,this.serverId=e.serverId,this.serverName=e.serverName,this.num=e.num,this.dt=e.dt},e}(n.BaseVO);n.RelationInfoVO=C,__reflect(C.prototype,"game.RelationInfoVO");var E=function(i){function e(e){var t=i.call(this)||this;return t.playerId=e.playerId,t.num=e.num,t.uuid=e.uuid,t}return __extends(e,i),e}(n.BaseVO);n.RelationRedBagInfoVO=E,__reflect(E.prototype,"game.RelationRedBagInfoVO");var b=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(e){this.id=e.id,this.num=e.num},t}(n.BaseVO);n.ChampionAchievementInfoVO=b,__reflect(b.prototype,"game.ChampionAchievementInfoVO");var I=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(e){this.count=e.count,this.buyCount=e.buyCount,this.lRCD=e.lRCD,this.requestCount=e.requestCount,this.helpCount=e.helpCount},t}(n.BaseVO);n.ChallengeInfoVO=I,__reflect(I.prototype,"game.ChallengeInfoVO");var A=function(t){function e(){var e=t.call(this)||this;return e.challengeInfo=new I,e.targeted=[],e}return __extends(e,t),e.prototype.update=function(e){var i=this;n.Config.champion()[e.id]?(this.id=e.id,this.allPassed=!1):(this.id=e.id-1,this.allPassed=!0),Array.isArray(e.targeted)&&e.targeted.forEach(function(e,t){i.targeted[t]||(i.targeted[t]=new b),i.targeted[t].update(e)}),this.mopUpNum=e.mopUpNum,this.lastMopUpDt=e.lastMopUpDt,this.num=e.num,this.canMopUp=e.canMopUp,this.curNum=e.curNum,this.challengeInfo.update(e.challengeInfo),NoticeManager.updateNotice(NT.CHAMPION)},e}(n.BaseVO);n.ChampionInfoVO=A,__reflect(A.prototype,"game.ChampionInfoVO");var P=function(i){function t(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(t,i),t.prototype.update=function(e){this.playerId=e.playerId,this.name=e.name,this.rank=e.rank,this.fightCap=e.fightCap,this.avatar=e.avatar,this.frame=e.frame,this.guild=e.guild,this.level=e.level,this.vipLevel=e.vipLevel,this.serverId=e.serverId,this.serverName=e.serverName,this.offlineTime=e.offlineTime,this.fashionCode=e.fashionCode,this.titleCode=e.titleCode,this.horseCode=e.horseCode,this.magicalCode=e.magicalCode},t.prototype.reset=function(){this.playerId=void 0,this.name=void 0,this.rank=void 0,this.fightCap=void 0,this.avatar=void 0,this.frame=void 0,this.guild=void 0,this.level=void 0,this.vipLevel=void 0,this.serverId=void 0,this.serverName=void 0,this.offlineTime=void 0},t.makeFakeData=function(){var e=new t;return e.playerId=Utils.DebugUtils.getFakePlayerId(),e.name=Utils.DebugUtils.getFakeName(),e.rank=Utils.DebugUtils.getFakeRank(),e.fightCap=Utils.DebugUtils.getFakeFightCap(),e.avatar=Utils.DebugUtils.getFakeAvatar(),e.frame="",e.guild=Utils.DebugUtils.getFakeGuildName(),e.level=Utils.DebugUtils.getFakeLevel(),e.vipLevel=Utils.DebugUtils.getFakeVipLevel(),e.serverId=Utils.DebugUtils.getFakeServerId(),e.serverName=Utils.DebugUtils.getFakeServerName(),e.offlineTime=Utils.DebugUtils.getFakeOfflineTime(),e},t}(n.BaseVO);n.BaseInfoVO=P,__reflect(P.prototype,"game.BaseInfoVO");var S=function(){};n.SRewardVO=S,__reflect(S.prototype,"game.SRewardVO");var N=function(i){function e(e){var t=i.call(this)||this;return t.got=e.got,t.rewards=e.rewards,t}return __extends(e,i),e}(n.BaseVO);n.SRewardInfoVO=N,__reflect(N.prototype,"game.SRewardInfoVO");var M=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.x=e.x,this.y=e.y,this.z!=e.z&&(this.isDirty=!0),this.z=e.z},e}(n.DirtyValueVO);n.SCoordinate=M,__reflect(M.prototype,"game.SCoordinate");var w=function(i){function e(e){var t=i.call(this)||this;return t.coordinate=new M,t.playerBaseInfo=new P,t.team=new n.TeamVO,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.amILeader=!1,e.playerBaseInfo?this.playerBaseInfo.update(e.playerBaseInfo):this.playerBaseInfo.reset(),e.team?this.team.update(e.team):this.team.reset(),e.coordinate&&this.coordinate.update(e.coordinate)},e}(n.BaseVO);n.SCoordianteBase=w,__reflect(w.prototype,"game.SCoordianteBase")}(game||(game={})),function(t){var e=function(){function e(){}return e.prototype.update=function(e){this.from=e.from,this.to=e.to},e}();__reflect(e.prototype,"DungeonMapEdge");var n=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),Object.defineProperty(e.prototype,"fadeType",{get:function(){if(this.eventInfo&&this.eventInfo.actualEventId){var e=t.Config.vestageEventConfig()[this.eventInfo.actualEventId];if(e)return e.type;egret.warn("找不到事件id",this.eventInfo.actualEventId)}},enumerable:!0,configurable:!0}),e.prototype.update=function(e){i.prototype.update.call(this,e),this.id=e.id,this.depth=e.depth,this.status=e.status,this.eventType=e.eventType,this.eventSubType=e.eventSubType,"string"==typeof e.eventInfo?this.eventInfo=e.eventInfo&&JSON.parse(e.eventInfo)||{}:this.eventInfo=e.eventInfo,this.eventId=e.eventId},e}(t.BaseVO);t.DungeonPointVO=n,__reflect(n.prototype,"game.DungeonPointVO");var i=function(t){function e(){var e=t.call(this)||this;return e.edges=[],e.points={},e}return __extends(e,t),e.prototype.update=function(e){var t=this;for(var i in this.uuid=e.uuid,this.code=e.code,this.edges=e.edges,this.genDt=e.genDt,this.curPointId=void 0,this.points){this.points[i].isExpire=!0}for(var i in e.points.forEach(function(e){t.points[e.id]?t.points[e.id].update(e):t.points[e.id]=new n(e),e.status!=VestagePointStatus.UnPassed&&e.status!=VestagePointStatus.Passed&&(t.curPointId=e.id)}),this.points){this.points[i].isExpire&&delete this.points[i]}},e}(t.BaseVO);t.DungeonMapVO=i,__reflect(i.prototype,"game.DungeonMapVO");var o=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(e){this.challengeTimes=e.challengeTimes,this.cScore=e.cScore,this.hScore=e.hScore,this.processStatus=e.processStatus,this.isCompleted=e.isCompleted,this.records=e.records&&JSON.parse(e.records)||void 0},t}(t.BaseVO);t.DungeonBaseInfoVO=o,__reflect(o.prototype,"game.DungeonBaseInfoVO");var a=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t.isDirty=!0,t}return __extends(e,i),e.prototype.update=function(e){i.prototype.update.call(this,e),this.code=e.code,this.count=e.count,this.dt=e.dt},e}(t.DirtyValueVO);t.DungeonSBuffVO=a,__reflect(a.prototype,"game.DungeonSBuffVO");var r=function(i){function e(e){var t=i.call(this)||this;return t.skillList=[],e&&t.update(e),t}return __extends(e,i),Object.defineProperty(e.prototype,"config",{get:function(){return this._config&&!this.isExpire||(this.isExpire=!1,this._config=t.Config.allHeroConfig()[this.code]),this._config},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this.uuid=e.uuid,this.level=e.level,this.attr=e.attr,this.pos=e.pos,this.starLevel=e.starLevel,this.skillList=e.skillList,this.fightCap=e.fightCap,this.haloAttr=e.haloAttr,this.dermaCode=e.dermaCode,this.anger=e.anger,this.maxAnger=e.maxAnger,this.life=e.life,this.maxLife=e.maxLife,e.code!=this.code&&(this.isExpire=!0),this.code=e.code||this.code},e}(t.BaseVO);t.DungeonHeroVO=r,__reflect(r.prototype,"game.DungeonHeroVO")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.targeted=e.targeted,this.sectionId=e.sectionId,this.opponentInfo=e.opponentInfo,this.opponentList=e.opponentList},e}(e.BaseVO);e.ExpeditionVO=t,__reflect(t.prototype,"game.ExpeditionVO")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.skillList=[],e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.uuid=e.uuid,this.level=e.level,this.attr=e.attr,this.pos=e.pos,this.skillList=e.skillList,this.fightCap=e.fightCap,this.code=e.code},e}(e.BaseVO);e.FashionVO=t,__reflect(t.prototype,"game.FashionVO")}(game||(game={})),function(d){!function(e){var c=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.type=e.type,this.value=e.value},e}(d.BaseVO);e.Buff=c,__reflect(c.prototype,"game.FightVO.Buff");var o=function(i){function e(e){var t=i.call(this)||this;return t.entities=new Array,t.magical=new n,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.playerId=e.playerId,this.name=e.name,this.camp=e.camp,this.avatar=e.avatar,this.level=e.level,this.positionType=e.positionType,this.entities.splice(0);for(var t=0,i=e.entities;t<i.length;t++){var n=i[t];this.entities.push(new a(n))}this.magical.update(e.magical)},e}(d.BaseVO);e.SBattleTeam=o,__reflect(o.prototype,"game.FightVO.SBattleTeam");var n=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){e&&(this.entityId=e.entityId,this.code=e.code,this.anger=e.anger,this.angerMax=e.angerMax)},e}(d.BaseVO);e.SMagicalEntity=n,__reflect(n.prototype,"game.FightVO.SMagicalEntity");var a=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.entityId=e.entityId,this.code=e.code,this.type=e.type,this.life=e.life,this.lifeMax=e.lifeMax,this.anger=e.anger,this.angerMax=e.angerMax,this.level=e.level,this.dermaCode=e.dermaCode},e}(d.BaseVO);e.SBattleEntity=a,__reflect(a.prototype,"game.FightVO.SBattleEntity");var l=function(i){function e(e){var t=i.call(this)||this;return t.buffAdd=new Array,t.buffRemove=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.entityId=e.entityId,this.status=e.status,this.value=e.value,this.beSockedBlood=e.beSockedBlood,this.life=e.life,this.anger=e.anger,this.skillId=e.skillId,this.buffAdd.splice(0);for(var t=0,i=e.buffAdd;t<i.length;t++){var n=i[t];this.buffAdd.push(new c(n))}this.buffRemove.splice(0);for(var o=0,a=e.buffRemove;o<a.length;o++){n=a[o];this.buffRemove.push(n)}},e}(d.BaseVO);e.SBattleRes=l,__reflect(l.prototype,"game.FightVO.SBattleRes");var h=function(i){function e(e){var t=i.call(this)||this;return t.seqBattleRes=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.effectId=e.effectId,this.sockBlood=e.sockBlood,this.antiInjury=e.antiInjury,this.seqBattleRes.splice(0);for(var t=0,i=e.seqBattleRes;t<i.length;t++){var n=i[t];this.seqBattleRes.push(new l(n))}},e}(d.BaseVO);e.SBattleEffect=h,__reflect(h.prototype,"game.FightVO.SBattleEffect");var p=function(i){function e(e){var t=i.call(this)||this;return t.buffStatus=new Array,t.seqBattleEffect=new Array,t.buffRemove=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.entityId=e.entityId,this.skillId=e.skillId,this.life=e.life,this.anger=e.anger,this.combo=e.combo,this.p=e.p,this.buffStatus.splice(0);for(var t=0,i=e.buffStatus;t<i.length;t++){var n=i[t];this.buffStatus.push(new c(n))}this.seqBattleEffect.splice(0);for(var o=0,a=e.seqBattleEffect;o<a.length;o++){n=a[o];this.seqBattleEffect.push(new h(n))}this.buffRemove.splice(0);for(var r=0,s=e.buffRemove;r<s.length;r++){n=s[r];this.buffRemove.push(n)}},e}(d.BaseVO);e.SBattleAttack=p,__reflect(p.prototype,"game.FightVO.SBattleAttack");var r=function(i){function e(e){var t=i.call(this)||this;return t.seqAttack=new Array,t.afterBattleRes=new Array,t.beforeBattleRes=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.roundNum=e.roundNum,this.seqAttack.splice(0);for(var t=0,i=e.seqAttack;t<i.length;t++){var n=i[t];this.seqAttack.push(new p(n))}this.afterBattleRes.splice(0);for(var o=0,a=e.afterBattleRes;o<a.length;o++){n=a[o];this.afterBattleRes.push(new l(n))}this.beforeBattleRes.splice(0);for(var r=0,s=e.beforeBattleRes;r<s.length;r++){n=s[r];this.beforeBattleRes.push(new l(n))}},e}(d.BaseVO);e.SBattleRound=r,__reflect(r.prototype,"game.FightVO.SBattleRound");var t=function(i){function e(e){var t=i.call(this)||this;return t.rounds=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e,t){if(void 0===t&&(t=!1),this.rounds.splice(0),e){this.uuid=e.uuid;for(var i=0,n=e.rounds;i<n.length;i++){var o=n[i];this.rounds.push(new r(o))}t&&this.rounds.sort(function(e,t){return e.roundNum-t.roundNum})}else this.uuid=Utils.TimerManager.getServerTime().toString()},e.prototype.pushRounds=function(e){if(e)if(e.uuid==this.uuid&&Array.isArray(e.rounds)){for(var t=0,i=e.rounds;t<i.length;t++){var n=i[t];this.rounds.push(new r(n))}this.rounds.sort(function(e,t){return e.roundNum-t.roundNum})}else egret.warn("拼接战报失败",e.uuid==this.uuid)},e.prototype.reset=function(){this.uuid=void 0,this.rounds.splice(0)},e}(d.BaseVO);e.SBattleInfo=t,__reflect(t.prototype,"game.FightVO.SBattleInfo");var i=function(i){function e(e){var t=i.call(this)||this;return t.teams=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.result=e.result,this.hurt=e.hurt,this.star=e.star,this.battleType=e.battleType,this.clientReward=e.clientReward,this.normalRewards=e.normalRewards,this.extRewards=e.extRewards,this.entityResults=e.entityResults,this.escaped=e.escaped,this.vestageRecords=e.vestageRecords,this.teams.splice(0);for(var t=0,i=e.teams;t<i.length;t++){var n=i[t];this.teams.push(new o(n))}},e}(d.BaseVO);e.SBattleResult=i,__reflect(i.prototype,"game.FightVO.SBattleResult");var s=function(t){function e(){var e=t.call(this)||this;return e.clientReward={rewards:[]},e.battleResultEach=new Array,e.reset(),e}return __extends(e,t),Object.defineProperty(e.prototype,"result",{get:function(){return this.winC>this.totalC/2?EBattleResult.EBattleResultWin:EBattleResult.EBattleResultLose},enumerable:!0,configurable:!0}),e.prototype.sum=function(e){this.totalC+=1,e.result==EBattleResult.EBattleResultWin&&this.winC++,this.battleType=e.battleType,this.hurt+=e.hurt,this.star=Math.floor((this.star+e.star)/this.totalC),e.clientReward&&Array.isArray(e.clientReward.rewards)&&(this.clientReward.rewards=this.clientReward.rewards.concat(e.clientReward.rewards)),this.battleResultEach.push(e)},e.prototype.reset=function(){this.star=0,this.hurt=0,this.totalC=0,this.winC=0,this.clientReward.rewards.splice(0),this.cbRet=void 0,this.battleResultEach.splice(0)},e}(d.BaseVO);e.SFinalBattleResult=s,__reflect(s.prototype,"game.FightVO.SFinalBattleResult")}(d.FightVO||(d.FightVO={}))}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.fortressId=e.fortressId,this.leftChallenge=e.leftChallenge,this.buyChallenge=e.buyChallenge,this.stages=e.fortressId},e}(e.BaseVO);e.DailyFortressVO=t,__reflect(t.prototype,"game.DailyFortressVO")}(game||(game={})),function(t){var e=function(i){function e(e){var t=i.call(this)||this;return t.id=e.id,t.level=e.level,t.fightCap=e.fightCap,t}return __extends(e,i),e.prototype.update=function(e){this.id=e.id||this.id,this.level=e.level||this.level,this.fightCap=e.fightCap||this.fightCap},e}(t.BaseVO);t.HandbookType=e,__reflect(e.prototype,"game.HandbookType");var i=function(i){function e(e){var t=i.call(this)||this;return t.type=e.type,t.key=e.key||0,t.targeted=e.targeted||[],t}return __extends(e,i),e.prototype.update=function(e){this.type=e.type||this.type,this.key=e.key||this.key,this.targeted=e.targeted||this.targeted},e}(t.BaseVO);t.ProgressBarInfo=i,__reflect(i.prototype,"game.ProgressBarInfo");var n=function(i){function e(e){var t=i.call(this)||this;return t.update(e),t}return __extends(e,i),Object.defineProperty(e.prototype,"config",{get:function(){if(!this._config)switch(this.type){case TaskType.BraveBook:this._config=t.Config.braveBook()[this.code];break;case TaskType.NewNewBraveBook:case TaskType.NewBraveBook:this._config=t.Config.newBraveBookTasksConfig()[this.code];break;case TaskType.SecondAchievement:this._config=t.Config.getSecAchievementConfig()[this.code];break;default:this._config=t.Config.taskConfig()[this.code]}return this._config},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this.code=e.code||e.id,this.key=e.key,this.isTarget=e.isTarget},e}(t.BaseVO);t.TaskVO=n,__reflect(n.prototype,"game.TaskVO");var o=function(i){function e(e){var t=i.call(this)||this;return t.targeted={},t.update(e),t}return __extends(e,i),e.prototype.update=function(e){var t=this;this.targeted={},e?(this.currentExp=null!=e.currentExp?e.currentExp:e.progress,e.targeted.forEach(function(e){t.targeted[e]=!0})):this.currentExp=0},e}(t.BaseVO);t.DailyTaskExpVO=o,__reflect(o.prototype,"game.DailyTaskExpVO");var a=function(i){function e(e){var t=i.call(this)||this;return t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.pmId=e.pmId,this.activated=e.activated},e}(t.BaseVO);__reflect(a.prototype,"GroupItemVO");var r=function(i){function e(e){var t=i.call(this)||this;return t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.id=e.id,this.items=e.items,this.fightCaps=e.fightCaps},e}(t.BaseVO);t.GroupHandbookVO=r,__reflect(r.prototype,"game.GroupHandbookVO");var s=function(i){function e(e){var t=i.call(this)||this;return t.groups=new Array,t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.groups=e.groups,this.fightCap=e.fightCap},e}(t.BaseVO);t.GroupHandbookInfoVO=s,__reflect(s.prototype,"game.GroupHandbookInfoVO");var c=function(i){function e(e){var t=i.call(this)||this;return t.levelTargeted=[],e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.level=e.level,this.levelTargeted=e.levelTargeted},e}(t.BaseVO);t.SecondAchievementInfoVO=c,__reflect(c.prototype,"game.SecondAchievementInfoVO")}(game||(game={})),function(n){var e=function(){};n.SMineVO=e,__reflect(e.prototype,"game.SMineVO");var t=function(){};n.SShopItemVO=t,__reflect(t.prototype,"game.SShopItemVO");var i=function(){};n.SShopInfoVO=i,__reflect(i.prototype,"game.SShopInfoVO");var l=function(i){function e(e){var t=i.call(this)||this;return t.caseDirtyKeys=["type","fadeType","position","eventId","config","customTrigger","hudongAction","info"],t.position=new o,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){i.prototype.update.call(this,e),this.isDiff(e)&&(this.isDirty=!0,this.type=e.type,this.fadeType=e.fadeType,this.eventId=e.eventId||this.eventId,this.dt=e.dt,this.position.update(e.position),this.info=JSON.parse(e.info),this.config=e.config,this.customTrigger=e.customTrigger,this.hudongAction=e.hudongAction)},e}(n.DirtyValueVO);n.EventVO=l,__reflect(l.prototype,"game.EventVO");var o=function(i){function t(e){var t=i.call(this)||this;return t.difficultyType=0,t.caseDirtyKeys=["x","y","type","id","layerId","num","position"],e&&t.update(e),t}return __extends(t,i),t.prototype.reset=function(){this.num=this._layerId=this.id=this.type=this.x=this.y=void 0,this.position&&this.position.reset()},Object.defineProperty(t.prototype,"layerId",{get:function(){return this._layerId},set:function(e){(this._layerId=e)&&this.caculateDifficultyType()},enumerable:!0,configurable:!0}),t.prototype.caculateDifficultyType=function(){var e=n.Config.risk()[this.layerId];e&&(this.difficultyType=e.type)},t.prototype.update=function(e){e?this.isDiff(e)&&(this.isDirty=!0,this.x=e.x,this.y=e.y,this.type=e.type,this.num=e.num,this.layerId=e.layerId,this.id=e.id,e.position?(this.position||(this.position=new t),this.position.update(e.position)):this.position&&this.position.update()):(this.isDirty=!0,this.x=this.y=this.type=this.layerId=this.num=this.id=void 0)},t.prototype.match=function(e){if(!e)return!1;if(this.num==e.num&&this.type==e.type){if(this.position&&this.position.id)return this.position.match(e.position);if(!this.position||!this.position.num)return!0}return!1},t}(n.DirtyValueVO);n.SPositionVO=o,__reflect(o.prototype,"game.SPositionVO");var h=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){i.prototype.update.call(this,e),this.x=e.x,this.y=e.y,this.long=e.long,this.wide=e.wide},e}(n.BaseVO);n.GridVO=h,__reflect(h.prototype,"game.GridVO");var a=function(c){function e(e){var t=c.call(this)||this;return t.events=new Array,t.grids=new Array,t.position=new o,e&&t.update(e),t}return __extends(e,c),e.prototype.reset=function(){this.events.splice(0),this.grids.splice(0),this.position.reset()},e.prototype.walkIntoPos=function(e){return e.position&&e.position.type?this.walkIntoPos(e.position):e},e.prototype.update=function(e){if(c.prototype.update.call(this,e),this.uuid=e.uuid,this.clear=e.clear,this.position.update(e.position),this.curPosVO=this.walkIntoPos(this.position),Array.isArray(e.events)){for(var t=0,i=0,n=e.events;i<n.length;i++){var o=n[i];this.events[t]?this.events[t].update(o):this.events.push(new l(o)),t++}this.events.splice(t)}if(Array.isArray(e.grids)){t=0;for(var a=0,r=e.grids;a<r.length;a++){var s=r[a];this.grids[t]?this.grids[t].update(s):this.grids.push(new h(s)),t++}this.grids.splice(t)}},e}(n.BaseVO);n.LayerVO=a,__reflect(a.prototype,"game.LayerVO");var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.requestCount=0,e.helpCount=0,e}return __extends(e,t),e.prototype.update=function(e){this.requestCount=e.requestCount,this.helpCount=e.helpCount},e}(n.BaseVO);n.FortressHelpInfo=r,__reflect(r.prototype,"game.FortressHelpInfo");var s=function(i){function e(e){var t=i.call(this)||this;return t.entityType=EEntityType.EEntityTypeMap,t.position=new o,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){i.prototype.update.call(this,e),this.uuid=e.uuid,this.code=e.code,this.position.update(e.position),this.position.id=this.position.num},e}(n.BaseVO);n.MapVO=s,__reflect(s.prototype,"game.MapVO");var c=function(i){function e(e){var t=i.call(this)||this;return t.baseInfo=new n.BaseInfoVO,t.creeps=[],t.foundRewards=[],e&&t.update(e),t}return __extends(e,i),Object.defineProperty(e.prototype,"config",{get:function(){return this._config||(this._config=n.Config.demonConfig()[this.code]),this._config},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this.uuid=e.uuid,this.dt=e.dt,this.baseInfo.update(e.baseInfo),this.creeps=e.creeps,this.totalLife=e.totalLife,this.leftLife=e.leftLife,this.code=e.code,this.excapeDt=e.excapeDt,this.foundRewards=e.foundRewards},e}(n.BaseVO);n.DemonVO=c,__reflect(c.prototype,"game.DemonVO");var p=function(i){function e(e){var t=i.call(this)||this;return t.baseInfo=new n.BaseInfoVO,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.dt=e.dt,this.pos=e.pos,this.baseInfo.update(e.baseInfo)},e}(n.BaseVO);n.RiskMultiSMultiPlayer=p,__reflect(p.prototype,"game.RiskMultiSMultiPlayer");var d=function(i){function e(e){var t=i.call(this)||this;return t.members=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.amIOwner=function(){return this.ownerId==n.GameMVC.playerPy.playerInfoVO.playerId},e.prototype.update=function(e){this.id=e.id,this.ownerId=e.ownerId,this.gain=e.gain,n.BaseVO.updateArr(e.members,this.members,p)},e}(n.BaseVO);n.RiskMultiSRoomInfo=d,__reflect(d.prototype,"game.RiskMultiSRoomInfo")}(game||(game={})),function(n){var e=function(i){function e(e){var o=i.call(this)||this;o.id=e.id,o.order=e.order||0,o.cond=JSON.parse(e.cond),o.target=JSON.parse(e.target),o.steps=new Array;var a=n.Config.guideStepConfig(),t=JSON.parse(e.steps);return t.forEach(function(){o.steps.push(new r)}),t.forEach(function(e,t){var i=a[e];if(!i)throw egret.log(o.id+"新手配置错误"),o.id+"新手配置错误";var n=o.steps[t];n.belongFlow=o,n.index=t,n.update(i)}),o}return __extends(e,i),e}(n.BaseVO);n.GuideFlow=e,__reflect(e.prototype,"game.GuideFlow");var r=function(t){function e(){var e=t.call(this)||this;return e.showTimes=0,e}return __extends(e,t),e.prototype.update=function(e){this.id=e.id,this.isForce=e.isForce,this.isKeyOppr=e.isKeyOppr,this.figDir=e.figDir,this.figType=e.figType,this.tips=JSON.parse(e.tips),this.tipsAfter=JSON.parse(e.tipsAfter),this.cond=JSON.parse(e.cond),this.target=JSON.parse(e.target),this.operation=JSON.parse(e.operation),this.tipsPos=JSON.parse(e.tipsPos),this.tipsDir=JSON.parse(e.tipsDir),this.tipsDir2=JSON.parse(e.tipsDir2),this.onInitialized()},e.prototype.onInitialized=function(){if(this.tipsShowed=!1,this.isKeyOppr){var e=this.belongFlow;if(this.index<e.steps.length-1){this.stepsCache=[];for(var t=this.index+1;t<e.steps.length;t++)this.stepsCache.push(e.steps[t])}}},e}(n.BaseVO);n.GuideStep=r,__reflect(r.prototype,"game.GuideStep")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.opponentInfo=new n,t.playerManorInfo=new o,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.playerId=e.playerId,this.opponentInfo=e.opponentInfo,this.playerManorInfo=e.playerManorInfo},e}(e.BaseVO);e.ManorVO=t,__reflect(t.prototype,"game.ManorVO");var n=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(e){this.playerId=e.playerId,this.name=e.name,this.level=e.level,this.vLevel=e.vLevel,this.fightCap=e.fightCap,this.rank=e.rank,this.camp=e.camp,this.avatar=e.avatar,this.subsidiary=e.subsidiary,this.fashion=e.fashion,this.guildName=e.guildName},t}(e.BaseVO);e.ManorOpponentVO=n,__reflect(n.prototype,"game.ManorOpponentVO");var o=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(e){this.id=e.id,this.type=e.type,this.lootTime=e.lootTime,this.lootTimeRefreshDt=e.lootTimeRefreshDt,this.totalGoodsNum=e.totalGoodsNum,this.canLootGoodsNum=e.canLootGoodsNum,this.lootBeginDt=e.lootBeginDt},t}(e.BaseVO);e.PlayerManorVO=o,__reflect(o.prototype,"game.PlayerManorVO")}(game||(game={})),function(n){var e=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.id=e.id,this.name=e.name,this.avatar=e.avatar,this.fightCap=e.fightCap,this.level=e.level,this.serverId=e.serverId,this.serverName=e.serverName,this.num=e.num,this.notice=e.notice,this.presidentId=e.presidentId,this.presidentName=e.presidentName},e}(n.BaseVO);n.GuildVO=e,__reflect(e.prototype,"game.GuildVO");var t=function(i){function e(e){var t=i.call(this)||this;return t.fightCap=0,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.exp=e.exp,this.guildId=e.guild.guildId||e.guild.id,this.rank=e.guild.rank,this.name=e.guild.name,this.noticeDt=e.guild.noticeDt,this.avatar=e.guild.avatar,this.num=e.guild.num,this.devoteProgress=e.guild.devoteProgress,this.notice=e.guild.notice,this.presidentName=e.guild.presidentName,this.lModifyDt=e.lModifyDt,e.guild.level!=this.level&&Utils.UnlockMgr.clearCacheByType([UnlockType.GuildLevel]),this.level=e.guild.level},e}(n.BaseVO);n.GuildDetailVO=t,__reflect(t.prototype,"game.GuildDetailVO");var i=function(i){function e(e){var t=i.call(this)||this;return t.update(e),t}return __extends(e,i),e.prototype.update=function(e){!this.guildId&&e.guildId&&n.AppFacade.getInstance().sendNotification(CN.GUILD_FIRST_INFO_UPDATE),this.guildId=e.guildId,this.lastQuitGuildDt=e.lastQuitGuildDt,this.position=e.position,this.dDevote=e.dDevote,this.wDevote=e.wDevote,this.devoteNum=e.devoteNum||0,e.devoteInfo&&(this.devoteInfo=JSON.parse(e.devoteInfo)),e.skill&&(this.skill=JSON.parse(e.skill))},e}(n.BaseVO);n.PlayerGuildVO=i,__reflect(i.prototype,"game.PlayerGuildVO");var o=function(i){function e(e){var t=i.call(this)||this;return t.baseInfo=new n.BaseInfoVO,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.baseInfo.update(e.baseInfo),this.dDevote=e.dDevote,this.wDevote=e.wDevote,this.position=e.position},e}(n.BaseVO);n.GuildMemberVO=o,__reflect(o.prototype,"game.GuildMemberVO");var a=function(i){function e(e){var t=i.call(this)||this;return t.baseInfo=new n.BaseInfoVO,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.baseInfo.update(e.baseInfo),this.applyDt=e.applyDt},e}(n.BaseVO);n.ApplyVO=a,__reflect(a.prototype,"game.ApplyVO");var r=function(i){function e(e){var t=i.call(this)||this;return t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.index=e.index,this.id=e.id,this.excapeDt=e.excapeDt},e}(n.BaseVO);n.InbreakBossVO=r,__reflect(r.prototype,"game.InbreakBossVO");var s=function(i){function e(e){var t=i.call(this)||this;return t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.count=e.count,this.bossList=e.bossList,this.triggerDt=e.triggerDt},e}(n.BaseVO);n.InbreakBossInfoVO=s,__reflect(s.prototype,"game.InbreakBossInfoVO");var c=function(i){function e(e){var t=i.call(this)||this;return t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.name=e.name,this.level=e.level,this.buff=e.buff,this.maxPassNum=e.maxPassNum,this.currentCount=e.currentCount,this.mopUpCount=e.mopUpCount,this.canMopUp=e.canMopUp,this.playerId=e.playerId},e}(n.BaseVO);n.PlayerBattleSubwayInfo=c,__reflect(c.prototype,"game.PlayerBattleSubwayInfo");var l=function(i){function e(e){var t=i.call(this)||this;return t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.id=e.id,this.status=e.status},e}(n.BaseVO);n.BountyVO=l,__reflect(l.prototype,"game.BountyVO");var h=function(i){function e(e){var t=i.call(this)||this;return t.update(e),t}return __extends(e,i),e.prototype.update=function(e){var t=this;this.bountyList=e.bountyList,this.bountyPro=e.bountyPro,this.bountyRefresh=e.bountyRefresh,this.bountyTimes=e.bountyTimes,this.targetedPro=e.targetedPro,this.targetedPro={},e.targetedPro.forEach(function(e){t.targetedPro[e]=!0})},e}(n.BaseVO);n.BountyInfoVO=h,__reflect(h.prototype,"game.BountyInfoVO");var p=function(i){function e(e){var t=i.call(this)||this;return t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.uid=e.uid,this.configId=e.configId,this.ownerId=e.ownerId,this.status=e.status,this.bornDt=e.bornDt,this.sendDt=e.sendDt,this.giveList=e.giveList,this.leftNum=e.leftNum,this.leftAmount=e.leftAmount,this.emptyDt=e.emptyDt},e}(n.BaseVO);n.GuildLuckyMoneyVO=p,__reflect(p.prototype,"game.GuildLuckyMoneyVO");var d=function(i){function e(e){var t=i.call(this)||this;return t.id=e.id,t.dt=e.dt,t.flag=e.flag,0<t.dt&&(t.cur=n.GameMgr.getInstance().serverTime()-t.dt),t}return __extends(e,i),e}(n.BaseVO);n.GuildCollectTaskInfoVO=d,__reflect(d.prototype,"game.GuildCollectTaskInfoVO");var u=function(i){function e(e){var t=i.call(this)||this;return t.taskList=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){var i=this;this.num=e.num,this.dt=e.dt,this.yesterdayNum=e.yesterdayNum,this.rewardList=e.rewardList,this.taskList.splice(0),this.id2TaskVO={},Array.isArray(e.taskList)&&e.taskList.forEach(function(e){var t=new d(e);i.id2TaskVO[e.id]=t,i.taskList.push(t)}),n.GameMVC.guildCollectPy.checkCollectReward(),NoticeManager.updateNotice(NT.GUILD_COLLECT),n.AppFacade.getInstance().sendNotification(CN.GUILD_COLLECT_INFO_UPDATE)},e}(n.BaseVO);n.GuildCollectInfoVO=u,__reflect(u.prototype,"game.GuildCollectInfoVO");var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(n.BaseVO);__reflect(g.prototype,"GuildWarSimpleHeroVO");var f=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(n.BaseVO);__reflect(f.prototype,"GuildWarPlayerEntity");var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(n.BaseVO);__reflect(_.prototype,"GuildWarRouteInfo");var m=function(i){function e(e){var t=i.call(this)||this;return t.routes=[],e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.guild=e.guild,this.routes=e.routes,this.score=e.score,this.enrolled=e.enrolled,this.selfEnrolled=e.selfEnrolled,this.guild||(this.guild=n.AppFacade.getInstance().retrieveProxy(n.GuildPy.N).guildDetail),this.updateCustom()},e.prototype.updateCustom=function(){var t=this;this.enrolledMemberNum=0,this.routes.forEach(function(e){t.enrolledMemberNum+=e.entities.length})},e}(n.BaseVO);n.GuildWarGuildEntityVO=m,__reflect(m.prototype,"game.GuildWarGuildEntityVO")}(game||(game={})),function(e){var t=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.update=function(e){this.gymId=e.gymId,this.pointList=e.pointList,this.isClear=e.isClear},t}(e.BaseVO);e.GymInfoVO=t,__reflect(t.prototype,"game.GymInfoVO")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.beginHatchDt=e.beginHatchDt,t.endHatchDt=e.endHatchDt,t.leftSnatchCount=e.leftSnatchCount,t.uuid=e.uuid,t.configId=e.configId,t.ownerId=e.ownerId,t.costs=e.costs,t.snatchRecord=e.snatchRecord,t}return __extends(e,i),e}(e.BaseVO);e.HatchEggVO=t,__reflect(t.prototype,"game.HatchEggVO");var i=function(i){function e(e){var t=i.call(this)||this;return t.eggs=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){if(this.hatchCount=e.hatchCount,this.snatchCount=e.snatchCount,this.refreshCount=e.refreshCount,this.cacheConfigId=e.cacheConfigId,this.revengeList=e.revengeList,this.snatchRecord=e.snatchRecord,this.eggs.splice(0),e.eggs)for(var t=0,i=e.eggs;t<i.length;t++){var n=i[t];this.eggs.push(n)}},e}(e.BaseVO);e.PlayerHatchVO=i,__reflect(i.prototype,"game.PlayerHatchVO")}(game||(game={})),function(r){var e=function(i){function e(e){var t=i.call(this)||this;return t.entityType=EEntityType.EEntityTypeHero,t.skillList=[],t.resonate=[],t.artifactResonate=[],t.resonateLevelList=[],e&&t.update(e),t}return __extends(e,i),Object.defineProperty(e.prototype,"config",{get:function(){return this._config&&!this.isExpire||(this.isExpire=!1,this._config=r.Config.allHeroConfig()[this.code]),this._config},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this.uuid=e.uuid,this.level=e.level,this.attr=e.attr,this.pos=e.pos,this.starLevel=e.starLevel,this.skillList=e.skillList,this.sectionLevel=e.sectionLevel,this.fightCap=e.fightCap,this.resonate=e.resonate,this.battlePos=e.battlePos,this.haloAttr=e.haloAttr,this.isLocked=e.isLocked,this.artifactResonate=e.artifactResonate,this.dermaCode=e.dermaCode,this.resonateLevelList=e.resonateLevelList,this.practiceLevel=e.practiceLevel,e.code!=this.code&&(this.isExpire=!0),this.code=e.code||this.code},e}(r.BaseVO);r.HeroVO=e,__reflect(e.prototype,"game.HeroVO");var t=function(a){function e(e){var t=a.call(this)||this;return t.entityType=EEntityType.EEntityTypeHeroEquip,t.uuid="",t.code=0,t.level=0,t.attr=[],t.heroUuid="",t.selected=!1,e&&t.update(e),t}return __extends(e,a),Object.defineProperty(e.prototype,"config",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"level2",{get:function(){return this._level2},enumerable:!0,configurable:!0}),e.prototype.update=function(e){a.prototype.update.call(this,e),this.uuid=e.uuid,this.level=e.level,this.heroUuid=e.heroUuid,this.num=e.num,this.fightCap=e.fightCap,this.filterShow=e.filterShow||!1,this.isLocked=e.isLocked,this.code=e.code,this.attr=[];var t=JSON.parse(e.attr);for(var i in t){var n=t[i];this.attr.push([parseInt(i),n])}if(this.entityType==EEntityType.EEntityTypeHeroEquip)(o=r.Config.getHeroEquipConfig()[this.code])&&(this.type=o.type);else if(this.entityType==EEntityType.EEntityTypeTreasure){var o;(o=r.Config.getHeroTreasureConfig()[this.code])&&(this.type=o.type)}},e.prototype.reduceByNum=function(e){return this.num-=e,this.num<0&&(this.num=0),this.num},e}(r.BaseVO);r.HeroThingVO=t,__reflect(t.prototype,"game.HeroThingVO");var i=function(i){function e(e){var t=i.call(this,e)||this;return t.attachLevel=0,t.quenchceLevel=0,t.entityType=EEntityType.EEntityTypeHeroEquip,t.update(e),t}return __extends(e,i),Object.defineProperty(e.prototype,"config",{get:function(){return r.Config.getHeroEquipConfig()[this.code]},enumerable:!0,configurable:!0}),e.prototype.update=function(e){i.prototype.update.call(this,e),this.attachLevel=this._level2=e.attachLevel,this.quenchceLevel=e.quenchceLevel||0},e}(t);r.HeroEquipVO=i,__reflect(i.prototype,"game.HeroEquipVO");var n=function(i){function e(e){var t=i.call(this,e)||this;return t.exp=0,t.advanceExp=0,t.advanceLevel=0,t.entityType=EEntityType.EEntityTypeHeroArtifact,t.update(e),t}return __extends(e,i),Object.defineProperty(e.prototype,"config",{get:function(){return r.Config.getHeroArtifactConfig()[this.code]},enumerable:!0,configurable:!0}),e.prototype.update=function(e){i.prototype.update.call(this,e),this.exp=e.exp,this.advanceExp=e.advanceExp,this.advanceLevel=this._level2=e.advanceLevel,this.baptizeAttr=e.baptizeAttr,this.isInit=e.isInit},e}(t);r.HeroArtifactVO=n,__reflect(n.prototype,"game.HeroArtifactVO");var o=function(i){function e(e){var t=i.call(this,e)||this;return t.entityType=EEntityType.EEntityTypeTreasure,t.update(e),t}return __extends(e,i),Object.defineProperty(e.prototype,"config",{get:function(){return r.Config.getHeroTreasureConfig()[this.code]},enumerable:!0,configurable:!0}),e.prototype.update=function(e){i.prototype.update.call(this,e),this.jewelAttr=JSON.parse(e.jewelAttr),this.jewelLevel=JSON.parse(e.jewelLevel)},e}(t);r.HeroTreasureVO=o,__reflect(o.prototype,"game.HeroTreasureVO");var a=function(i){function e(e){var t=i.call(this,e)||this;return t.entityType=EEntityType.EEntityTypeDerma,t.update(e),t}return __extends(e,i),Object.defineProperty(e.prototype,"config",{get:function(){return r.Config.getHeroDermaConfig()[this.code]},enumerable:!0,configurable:!0}),e.prototype.update=function(e){i.prototype.update.call(this,e)},e}(t);r.HeroDermaVO=a,__reflect(a.prototype,"game.HeroDermaVO")}(game||(game={})),function(i){var e=function(t){function e(){var e=t.call(this)||this;return e.loginState=-1,e.login_ext={},e}return __extends(e,t),e.prototype.isValid=function(){return""!=this.username&&""!=this.password},e}(i.BaseVO);i.UserVO=e,__reflect(e.prototype,"game.UserVO");var t=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.s_id=e.s_id,this.s_ip=e.s_ip,this.port=e.port,this.sPort=e.sPort,this.s_name=e.s_name,this.s_healthStatus=e.s_healthStatus,this.area=e.area,this.list_name=e.list_name,this.s_Allnum=e.s_Allnum},e}(i.BaseVO);i.ServerVO=t,__reflect(t.prototype,"game.ServerVO");var n=function(t){function e(){var e=t.call(this)||this;return e.initPm=0,e}return __extends(e,t),e.prototype.update=function(e){this.sysDt=e.sysDt,this.timeZone=e.timeZone,this.serverOpenDt=e.serverOpenDt,this.initPm=e.initPm,this.offlineTime=e.offlineTime,this.isCreated=e.isCreated,this.singleSign=e.singleSign,i.GameMgr.getInstance().updateTimeDValue(this.sysDt)},e.prototype.updateInGame=function(e){this.sysDt=e.sysDt,this.timeZone=e.timeZone,this.serverOpenDt=e.serverOpenDt,this.singleSign=e.singleSign,i.GameMgr.getInstance().updateTimeDValue(this.sysDt)},e}(i.BaseVO);i.LoginGameVO=n,__reflect(n.prototype,"game.LoginGameVO")}(game||(game={})),function(t){var e=function(i){function e(e){var t=i.call(this)||this;return t.skillList=[],e&&t.update(e),t}return __extends(e,i),Object.defineProperty(e.prototype,"config",{get:function(){return this._config&&!this.isExpire||(this.isExpire=!1,this._config=t.Config.allMagicalConfig()[this.code]),this._config},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this.uuid=e.uuid,this.level=e.level,this.attr=e.attr,this.pos=e.pos,this.skillList=e.skillList,this.sectionLevel=e.sectionLevel,this.fightCap=e.fightCap,this.code!=e.code&&(this.isExpire=!0),this.code=e.code},e}(t.BaseVO);t.MagicalVO=e,__reflect(e.prototype,"game.MagicalVO")}(game||(game={})),function(y){var e=function(i){function e(e){var t=i.call(this)||this;return t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.uuid=e.uuid,this.key=e.key,this.content=e.content,this.sendTime=e.sendTime,this.expireTime=e.expireTime,this.status=e.status,this.attachs=e.attachs,this.propertys=e.propertys},e.prototype.getContentTextFlow=function(){var t=new Array,e=y.Config.mailConfig()[this.key],i=void 0;e?(i=e.content,""==this.content||e.key!=EMailType.EMailTypeReward&&e.key!=EMailType.EMailTypeSystem||(i=this.content)):(egret.log("找不到邮件配置",this.key),i="[]");var n=[];try{n=JSON.parse(i)}catch(e){return t.push({text:i,style:{}}),t}for(var o=JSON.parse(this.propertys),a=0,r=0,s=n;r<s.length;r++){for(var c=s[r],l=0,h=(new egret.HtmlTextParser).parser(c);l<h.length;l++){var p=h[l];"brbrbr"==p.text?t.push({text:"\n"}):t.push(p)}if(o[a]){var d=o[a][0];if(EMailValueType.EMailValueTypeText==d)t.push({text:" "+o[a][1],style:{}});else if(EMailValueType.EMailValueTypeCode==d)for(var u=0,g=o[a][1];u<g.length;u++){var f=g[u],_=y.GeneralConfig.getEntityConfigByCode(f[0],f[1]),m=y.GeneralConfig.getColorByColor(_.color);5==_.color&&(m=13080844),t.push({text:" "+_.name,style:{textColor:m}}),t.push({text:" x"+f[2],style:{}})}}a++}return t},e}(y.BaseVO);y.MailVO=e,__reflect(e.prototype,"game.MailVO")}(game||(game={})),function(n){var o=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.x=e.x,this.y=e.y},e}(n.BaseVO);n.CoordinateInfo=o,__reflect(o.prototype,"game.CoordinateInfo");var e=function(i){function e(e){var t=i.call(this)||this;return t.baseInfo=new n.BaseInfoVO,t.playerEntityList=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){for(var t in this.baseInfo.update(e.baseInfo),this.walkNum=e.walkNum,this.lastWalkRecoverDt=e.lastWalkRecoverDt,e.playerEntityList)e.playerEntityList[t].baseInfo=e.baseInfo;this.updatePlayerEntityList(e.playerEntityList),this.lastEntityIndex=e.lastEntityIndex,this.integral=e.integral,this.guildIntegral=e.guildIntegral},e.prototype.updatePlayerEntityList=function(e){if(this.playerEntityList.splice(0),e)for(var t=0,i=e;t<i.length;t++){var n=i[t];this.playerEntityList.push(new s(n))}},e}(n.BossVO);n.PlayerProxyInfo=e,__reflect(e.prototype,"game.PlayerProxyInfo");var a=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.code=e.code,this.dermaCode=e.dermaCode,this.battlePos=e.battlePos},e}(n.BaseVO);n.PlayerHeroBaseInfo=a,__reflect(a.prototype,"game.PlayerHeroBaseInfo");var r=function(i){function e(e){var t=i.call(this)||this;return t.heroBaseInfoList=new Array,t.petList=new Array,t.magicalList=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.updatePlayerHeroBaseInfo(e.heroBaseInfoList),this.petList=e.petList,this.magicalList=e.magicalList,this.fightCap=e.fightCap||0},e.prototype.updatePlayerHeroBaseInfo=function(e){if(this.heroBaseInfoList.splice(0),e)for(var t=0,i=e;t<i.length;t++){var n=i[t];this.heroBaseInfoList.push(new a(n))}},e}(n.BaseVO);n.TeamInfo=r,__reflect(r.prototype,"game.TeamInfo");var s=function(i){function e(e){var t=i.call(this)||this;return t.baseInfo=new n.BaseInfoVO,t.coordinateInfo=new o,t.teamInfo=new r,t.autoCaptureInfo=new h,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.baseInfo.update(e.baseInfo),this.walkNum=e.walkNum,this.blood=e.blood,this.lastWalkRecoverDt=e.lastWalkRecoverDt,this.lastBloodRecoverDt=e.lastBloodRecoverDt,this.gameNum=e.gameNum,this.purchaseNum=e.purchaseNum,this.coordinateInfo=e.coordinateInfo,this.isInSafeArea=e.isInSafeArea,this.manorId=e.manorId,this.captureDt=e.captureDt,this.coordinateStatus=e.coordinateStatus,this.rewards=e.rewards,this.entityIndex=e.entityIndex,e.teamInfo?this.teamInfo.update(e.teamInfo):console.log("服务器数据有误 params.teamInfo=null"),this.autoCaptureInfo.update(e.autoCaptureInfo),this.enterIntoSafeAreaDt=e.enterIntoSafeAreaDt,this.revivalBeginDt=e.revivalBeginDt||0,this.isSelf=n.GameMVC.loginPy.isSelf(e.baseInfo.playerId)},e}(n.BaseVO);n.PlayerEntityInfo=s,__reflect(s.prototype,"game.PlayerEntityInfo");var c=function(a){function e(e){var t=a.call(this)||this;return t.coordinateInfo=new o,t.playerManorList=new Array,t.guildServerId=0,t.guildId=0,t.remove=!1,e&&t.update(e),t}return __extends(e,a),e.prototype.update=function(e){if(a.prototype.update.call(this,e),this.manorId=e.manorId,this.coordinateInfo.update(e.coordinateInfo),this.isSpecial=e.isSpecial,this.beCapturedDt=e.beCapturedDt,this.updatePlayerEntityList(e.playerManorList),this.initDt=e.initDt,this.id=e.id,this.isSameGuild=e.isSameGuild,this.isBattleStatus=e.isBattleStatus,this.collectedTime=e.collectedTime,this.guildName=e.guildName||"",this.num=e.num||0,e.guildId)this.guildId=e.guildId;else if(e.isSameGuild||!e.isBattleStatus){for(var t=0;t<this.playerManorList.length;t++)if(this.playerManorList[t]&&this.playerManorList[t].baseInfo.guild&&this.playerManorList[t].baseInfo.guild.name&&""!=this.playerManorList[t].baseInfo.guild.name){this.guildId=this.playerManorList[t].baseInfo.guild.id;break}}else if(e.isBattleStatus){var i=new Array;for(t=0;t<this.playerManorList.length;t++)if(this.playerManorList[t]&&this.playerManorList[t].baseInfo.guild&&this.playerManorList[t].baseInfo.guild.name&&""!=this.playerManorList[t].baseInfo.guild.name){var n=this.playerManorList[t].baseInfo.guild.id;i[n]||(i[n]=0),i[n]+=1}var o=0;for(var t in i)i[t]>o&&(o=i[t],this.guildId=Number(t))}0!=this.guildId?this.guildServerId=parseInt((this.guildId/1e4).toFixed(0)):this.guildServerId=0,this.remove=e.remove||!1},e.prototype.updatePlayerEntityList=function(e){if(this.playerManorList.splice(0),e)for(var t=0,i=e;t<i.length;t++){var n=i[t];this.playerManorList.push(new s(n))}},e}(n.DirtyValueVO);n.ManorEntityInfo=c,__reflect(c.prototype,"game.ManorEntityInfo");var l=function(i){function e(e){var t=i.call(this)||this;return t.baseInfo=new n.BaseInfoVO,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.baseInfo.update(e.baseInfo),this.blood=e.blood,this.decreaseBlood=e.decreaseBlood,this.entityIndex=e.entityIndex},e}(n.BaseVO);n.PlayerRecordEntityInfo=l,__reflect(l.prototype,"game.PlayerRecordEntityInfo");var t=function(i){function e(e){var t=i.call(this)||this;return t.attackEntity=new l,t.defenceEntity=new l,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.uuid=e.uuid,this.dt=e.dt,this.attackEntity.update(e.attackEntity),this.defenceEntity.update(e.defenceEntity),this.win=e.win,this.battleRecord=e.battleRecord},e}(n.BaseVO);n.BattleRecordEntityInfo=t,__reflect(t.prototype,"game.BattleRecordEntityInfo");var i=function(i){function e(e){var t=i.call(this)||this;return t.playerEntityList=new Array,t.manorEntityList=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.updatePlayerEntityList(e.playerEntityList),this.updateManorEntityList(e.manorEntityList)},e.prototype.updatePlayerEntityList=function(e){if(this.playerEntityList.splice(0),e)for(var t=0,i=e;t<i.length;t++){var n=i[t];this.playerEntityList.push(new s(n))}},e.prototype.updateManorEntityList=function(e){if(this.manorEntityList.splice(0),e)for(var t=0,i=e;t<i.length;t++){var n=i[t];this.manorEntityList.push(new c(n))}},e}(n.BaseVO);n.ManorInfoVO=i,__reflect(i.prototype,"game.ManorInfoVO");var h=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.manorId=e.manorId||0,this.isAutoCapture=e.isAutoCapture||!1,this.isAutoChallenge=e.isAutoChallenge||!1,this.isChallengePowerHouse=e.isChallengePowerHouse||!1,this.isAutoPurchaseWalk=e.isAutoPurchaseWalk||!1,this.isAutoPurchaseBlood=e.isAutoPurchaseBlood||!1,this.totalWalkDiamond=e.totalWalkDiamond||0,this.totalBloodDiamond=e.totalBloodDiamond||0,this.isOpen=e.isOpen||!1,this.resurgenceNum=e.resurgenceNum||0,this.isAutoResurgence=e.isAutoResurgence||!1},e}(n.BaseVO);n.AutoCaptureInfo=h,__reflect(h.prototype,"game.AutoCaptureInfo")}(game||(game={})),function(e){var n=function(i){function e(e){var t=i.call(this)||this;return t.update(e),t}return __extends(e,i),e.prototype.update=function(e){e&&(this.teamId=e.teamId,this.totalGoodsNum=e.totalGoodsNum,this.lootBeginDt=e.lootBeginDt,this.isInManor=e.isInManor,this.isMining=e.isMining,this.campId=e.campId)},e}(e.BaseVO);e.SelfManorInfo=n,__reflect(n.prototype,"game.SelfManorInfo");var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(e.BaseVO);e.SinglePlayerInfo=t,__reflect(t.prototype,"game.SinglePlayerInfo");var o=function(i){function e(e){var t=i.call(this)||this;return t.teamManorInfo=new l,t.playerTeamInfo=new Array,t.update(e),t}return __extends(e,i),e.prototype.update=function(e){if(e){if(e.playerTeamInfo){this.playerTeamInfo.splice(0);for(var t=0,i=e.playerTeamInfo;t<i.length;t++){var n=i[t];this.playerTeamInfo.push(new r(n))}}this.teamManorInfo.update(e.teamManorInfo)}},e}(e.BaseVO);e.SelfTeamInfo=o,__reflect(o.prototype,"game.SelfTeamInfo");var a=function(i){function e(e){var t=i.call(this)||this;return t.teamManorInfo=new Array,t.update(e),t}return __extends(e,i),e.prototype.update=function(e){if(e&&(this.manorId=e.manorId,this.lootBeginDt=e.lootBeginDt,this.firstTeamId=e.firstTeamId,e.teamManorInfo)){this.teamManorInfo.splice(0);for(var t=0,i=e.teamManorInfo;t<i.length;t++){var n=i[t];this.teamManorInfo.push(new l(n))}}},e}(e.BaseVO);e.SingleManorInfo=a,__reflect(a.prototype,"game.SingleManorInfo");var r=function(i){function e(e){var t=i.call(this)||this;return t.update(e),t}return __extends(e,i),e.prototype.update=function(e){e&&(this.playerId=e.playerId,this.leader=e.leader,this.dt=e.lootBeginDt,this.isOnline=e.isOnline,this.serverId=e.serverId,this.name=e.name,this.avatar=e.avatar,this.fightCap=e.fightCap,this.maxTeamLife=e.maxTeamLife,this.curTeamLife=e.curTeamLife)},e}(e.BaseVO);e.PlayerTeamInfo=r,__reflect(r.prototype,"game.PlayerTeamInfo");var l=function(i){function e(e){var t=i.call(this)||this;return t.beginCoordinate=egret.Point.create(0,0),t.endCoordinate=egret.Point.create(0,0),t.teammateInfos=new Array,t.update(e),t.resetPos(),t}return __extends(e,i),e.prototype.resetPos=function(){this.campId},e.prototype.update=function(e){if(e&&(this.teamId=e.teamId,this.manorId=e.manorId,this.playerId=e.playerId,this.num=e.num,this.fightCap=e.fightCap,this.beginMoveDt=e.beginMoveDt,this.endMoveDt=e.endMoveDt,this.campId=e.campId,this.isMoving=e.isMoving,this.beginCoordinate.setTo(e.beginCoordinate.x,e.beginCoordinate.y),this.endCoordinate.setTo(e.endCoordinate.x,e.endCoordinate.y),this.teammateInfos.splice(0),e.teammateInfos))for(var t=0,i=e.teammateInfos;t<i.length;t++){var n=i[t];this.teammateInfos.push(new r(n))}},e.prototype.getDis=function(){return egret.Point.distance(this.endCoordinate,this.beginCoordinate)},e.prototype.getCurPos=function(){},e}(e.BaseVO);e.TeamManorInfo=l,__reflect(l.prototype,"game.TeamManorInfo");var s=function(i){function e(e){var t=i.call(this)||this;return t.teamList=new Array,t.selfTeamInfo=new o,t.update(e),t}return __extends(e,i),e.prototype.update=function(e){if(e){for(var t={},i=0,n=e.teamList;i<n.length;i++){for(var o=n[i],a=!(t[o.teamId]=!0),r=0,s=this.teamList;r<s.length;r++){var c=s[r];if(c.teamId==o.teamId){a=!0,c.update(o);break}}a||this.teamList.push(new l(o))}this.teamList=this.teamList.filter(function(e){return t[e.teamId]}),this.selfTeamInfo.update(e.selfTeamInfo)}else this.teamList.splice(0)},e}(e.BaseVO);__reflect(s.prototype,"TeamInfo");var c=function(i){function e(e){var t=i.call(this)||this;return t.update(e),t}return __extends(e,i),e.prototype.update=function(e){e&&(this.campId=e.campId,this.dt=e.dt,this.goods=e.goods)},e}(e.BaseVO);e.CampGoodsInfo=c,__reflect(c.prototype,"game.CampGoodsInfo");var i=function(i){function e(e){var t=i.call(this)||this;return t.selfInfo=new n,t.manorList=new Array,t.goodsInfo=new Array,t.playerList=new Array,t.teamInfo=new s,t.update(e),t}return __extends(e,i),e.prototype.update=function(e){e&&(this.updateManorList(e.manorList),this.updateCampGoodsInfo(e.goodsInfo),this.updatePlayerList(e.playerList),this.selfInfo.update(e.selfInfo),this.teamInfo.update(e.teamInfo))},e.prototype.updateManorList=function(e){if(this.manorList.splice(0),e)for(var t=0,i=e;t<i.length;t++){var n=i[t];this.manorList.push(new a(n))}},e.prototype.updateCampGoodsInfo=function(e){var i=this;e&&(e.forEach(function(e,t){i.goodsInfo[t]?i.goodsInfo[t].update(e):i.goodsInfo[t]=new c(e)}),this.goodsInfo.sort(function(e,t){return t.goods-e.goods}))},e.prototype.updatePlayerList=function(e){e&&(this.playerList=e)},e.prototype.cleanUp=function(){this.update({})},e}(e.BaseVO);e.ManorInfo=i,__reflect(i.prototype,"game.ManorInfo")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.skillList=[],e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.uuid=e.uuid,this.level=e.level,this.attr=e.attr,this.pos=e.pos,this.skillList=e.skillList,this.fightCap=e.fightCap,this.code=e.code,this.starLevel=e.starLevel},e}(e.BaseVO);e.MountVO=t,__reflect(t.prototype,"game.MountVO")}(game||(game={})),function(t){var i=function(){function e(e){this.baseInfo=new t.PlayerInfoVO,this.isChallenged=!1,e&&this.updateData(e)}return e.prototype.updateData=function(e){this.baseInfo.update(e.baseInfo),this.isChallenged=e.isChallenged,this.rank=e.rank},e}();t.PWChallengeInfoVO=i,__reflect(i.prototype,"game.PWChallengeInfoVO");var e=function(){function e(e){this.chalList=[],this.dailyTargeted=[],e&&this.updateData(e)}return e.prototype.updateData=function(e){this.grade=e.grade,this.rank=e.rank,this.chalCount=e.chalCount,this.buyChalCount=e.buyChalCount,this.freCount=e.freCount,this.buyFreCount=e.buyFreCount,this.winCount=e.winCount,this.dailyTargeted=e.dailyTargeted,this.updateChallengeList(e.chalList)},e.prototype.updateChallengeList=function(e){var t=this;this.chalList.splice(0),e.forEach(function(e){t.chalList.push(new i(e))})},e}();t.PWFreeMatchInfoVO=e,__reflect(e.prototype,"game.PWFreeMatchInfoVO");var n=function(){function e(e){this.targeted=[],this.chalList=[],e&&this.updateData(e)}return e.prototype.updateData=function(e){this.rank=e.rank,this.chalCount=e.chalCount,this.buyChalCount=e.buyChalCount,this.hRank=e.hRank,this.targeted=e.targeted,this.inMatch=e.inMatch},e.prototype.updateChallengeList=function(e){var t=this;this.chalList.splice(0),e.forEach(function(e){t.chalList.push(new i(e))}),this.chalList.sort(function(e,t){return e.rank-t.rank})},e}();t.PWHighMatchInfoVO=n,__reflect(n.prototype,"game.PWHighMatchInfoVO")}(game||(game={})),function(t){var e=function(i){function e(e){var t=i.call(this)||this;return t.skillList=[],e&&t.update(e),t}return __extends(e,i),Object.defineProperty(e.prototype,"config",{get:function(){return this._config&&!this.isExpire||(this.isExpire=!1,this._config=t.Config.allPetConfig()[this.code]),this._config},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this.uuid=e.uuid,this.level=e.level,this.exp=e.exp,this.attr=e.attr,this.pos=e.pos,this.skillList=e.skillList,this.starLevel=e.starLevel,this.sectionLevel=e.sectionLevel,this.fightCap=e.fightCap,this.skillAttr=e.skillAttr,this.skillDetailList=JSON.parse(e.skillDetailList),this.code!=e.code&&(this.isExpire=!0),this.code=e.code},e}(t.BaseVO);t.PetVO=e,__reflect(e.prototype,"game.PetVO")}(game||(game={})),function(o){var e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(o.BaseVO);o.RoleVO=e,__reflect(e.prototype,"game.RoleVO");var t=function(t){function e(){var e=t.call(this)||this;return e.state=0,e}return __extends(e,t),e}(o.BaseVO);o.LoginStatusVO=t,__reflect(t.prototype,"game.LoginStatusVO");var i=function(t){function e(){var e=t.call(this)||this;return e.fightCap=0,e.createDt=0,e.exp=0,e.avatar="",e.frame="",e.level=0,e.playerMoney=new Array,e.playerVip=new n,e}return __extends(e,t),e.prototype.update=function(e){var t=this;egret.log("玩家数据",e);this.playerId=e.playerId,this.name=e.name;var i=this.level;if(this.level=e.level,this.exp=null==e.exp?this.exp:e.exp,this.fightCap=e.fightCap,this.createDt=e.createDt,this.avatar=e.avatar||this.avatar,this.frame=e.frame,this.camp=e.camp,this.pNum=e.pNum,this.serverName=e.serverName,this.serverId=e.serverId,this.fashionCode=e.fashionCode,this.titleCode=e.titleCode,this.horseCode=e.horseCode,this.magicalCode=e.magicalCode,e.playerMoney&&this.updateMoney(e.playerMoney),e.playerVip&&this.playerVip.update(e.playerVip),i!=this.level&&(Utils.UnlockMgr.clearCacheByType([UnlockType.Level,UnlockType.VipLevel,UnlockType.LevelAndVipLevel,UnlockType.LevelOrVipLevel,UnlockType.LevelAndServerOpenDay]),0<i)){var n=o.AppFacade.getInstance().retrieveProxy(o.FightPy.N);n.addDelayCBAfterFightExit(function(){o.AppFacade.getInstance().sendNotification(CN.PLAYER_LEVEL_UP,{oldLevel:i,newLevel:t.level}),n.queueExceExitCB()},"levelUp",5)}},e.prototype.updateMoney=function(e){var i=this;e.money.forEach(function(e,t){i.playerMoney[t+1]=e})},e}(o.BaseVO);o.PlayerInfoVO=i,__reflect(i.prototype,"game.PlayerInfoVO");var n=function(n){function e(){var e=n.call(this)||this;return e.vipLevel=0,e.exp=0,e.vipGiftGot={},e.rechargeInfo=new a,e}return __extends(e,n),e.prototype.update=function(e){var t=this.isInited;n.prototype.update.call(this,e);var i=this.vipLevel;this.vipLevel=e.vipLevel,this.exp=e.exp,this.vipGiftGot=JSON.parse(e.vipGiftGot),this.rechargeInfo.update(e.rechargeInfo),t&&i!=e.vipLevel&&(Utils.UnlockMgr.clearCacheByType([UnlockType.VipLevel,UnlockType.LevelAndVipLevel,UnlockType.LevelOrVipLevel,UnlockType.VipLevelTask]),o.AppFacade.getInstance().sendNotification(CN.PLAYER_VIP_LEVEL_UP)),this.checkNotick()},e.prototype.checkNotick=function(){NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.VipWelfare]),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.VipGift]),NoticeManager.updateNotice(NT.VIP_GIFT)},e}(o.BaseVO);o.PlayerVipVO=n,__reflect(n.prototype,"game.PlayerVipVO");var a=function(t){function e(){var e=t.call(this)||this;return e.count=0,e.totalMoney=0,e.record={},e}return __extends(e,t),e.prototype.update=function(e){this.count=e.count,this.totalMoney=e.totalMoney,this.record=JSON.parse(e.record)},e}(o.BaseVO);o.RechargeInfo=a,__reflect(a.prototype,"game.RechargeInfo");var r=function(t){function e(){var e=t.call(this)||this;return e.itemId="",e.itemSDKId="",e.itemName="",e.itemPrice=0,e.count=0,e.gold=0,e.goldEx=0,e.orderID="",e.playerName="",e.playerId=0,e.serverId="",e.serverName="",e.type=0,e.userID="",e.orderDt=0,e.isMonthCard=!1,e.code="",e.modulePayExt={},e}return __extends(e,t),e}(o.BaseVO);o.PurchaseVO=r,__reflect(r.prototype,"game.PurchaseVO")}(game||(game={})),function(e){var t=function(i){function e(e){var t=i.call(this)||this;return t.code=0,t.color=0,t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.code=e.code,this.color=e.color},e}(e.BaseVO);e.CharacterInfoVO=t,__reflect(t.prototype,"game.CharacterInfoVO");var i=function(i){function e(e){var t=i.call(this)||this;return t.code=0,t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.code=e.code},e}(e.BaseVO);e.PokemonSkillVO=i,__reflect(i.prototype,"game.PokemonSkillVO");var n=function(i){function e(e){var t=i.call(this)||this;return t.type=0,t.score=0,t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.type=e.type,this.score=e.score},e}(e.BaseVO);e.PokemonScoreVO=n,__reflect(n.prototype,"game.PokemonScoreVO");var o=function(i){function e(e){var t=i.call(this)||this;return t.id=0,t.code=0,t.level=0,t.exp=0,t.pos=0,t.advanceLevel=0,t.characterInfoList=new Array,t.pokemonSkill=new Array,t.scoreInfo=new Array,t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.uuid=e.uuid,this.id=e.id,this.code=this.id,this.level=e.level,this.exp=e.exp,this.attr=e.attr,this.pos=e.pos,this.advanceLevel=e.advanceLevel,this.foster=e.foster,this.characterInfoList=e.characterInfoList,this.pokemonSkill=e.pokemonSkill,this.isInit=e.isInit,this.evolutionLevel=e.evolutionLevel,this.scoreInfo=e.scoreInfo,this.fosterLevel=e.fosterLevel,this.fosterAttr=e.fosterAttr,this.fightCap=e.fightCap,this.breakLevel=e.breakLevel,this.advanceExp=e.advanceExp,this.breakExp=e.breakExp,this.megaLevel=e.megaLevel,this.skinId=e.skinId},e}(e.BaseVO);e.PokemonVO=o,__reflect(o.prototype,"game.PokemonVO");var a=function(i){function e(e){var t=i.call(this)||this;return t.pkmUuid="",t.code=0,t.level=0,t.refine=0,t.exp=0,t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.uuid=e.uuid,this.pkmUuid=e.pkmUuid,this.code=e.code,this.level=e.level,this.refine=e.refine,this.exp=e.exp,this.attr=e.attr},e}(e.BaseVO);e.ToteVO=a,__reflect(a.prototype,"game.ToteVO")}(game||(game={})),function(t){var n=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.x=e.x,this.y=e.y},e}(t.BaseVO);t.SPos=n,__reflect(n.prototype,"game.SPos");var o=function(i){function e(e){var t=i.call(this)||this;return t.pos=new n,t.remove=!1,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.creepCode=e.creepCode,this.pos.update(e.pos),this.status=e.status,this.remove=e.remove||!1},e}(t.BaseVO);t.SCreepBase=o,__reflect(o.prototype,"game.SCreepBase");var a=function(i){function e(e){var t=i.call(this)||this;return t.pos=new n,t.isSelf=!1,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.playerId=e.playerId,this.pos.update(e.pos),this.status=e.status,this.layerCode=e.layerCode,this.name=e.name,this.serverId=e.serverId,this.fashionCode=e.fashionCode,this.horseCode=e.horseCode,this.titleCode=e.titleCode,this.magicalCode=e.magicalCode,this.isSelf=t.GameMVC.loginPy.isSelf(e.playerId)},e}(t.BaseVO);t.SPlayerBase=a,__reflect(a.prototype,"game.SPlayerBase");var e=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.rewardId=e.rewardId,this.dt=e.dt},e}(t.BaseVO);t.Targeted=e,__reflect(e.prototype,"game.Targeted");var i=function(i){function e(e){var t=i.call(this)||this;return t.pos=new n,t.hangUpIncome=new Array,t.targeted=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.playerId=e.playerId,this.pos.update(e.pos),this.status=e.status,this.hangUpIncome=e.hangUpIncome,this.layerCode=e.layerCode,this.name=e.name,this.serverId=e.serverId,this.hangUpIncomeDuration=e.hangUpIncomeDuration,this.doubleHit=e.doubleHit||0,this.targeted=e.targeted,this.score=e.score,this.lBattleDt=e.lBattleDt},e}(t.BaseVO);t.SPlayer=i,__reflect(i.prototype,"game.SPlayer");var r=function(i){function e(e){var t=i.call(this)||this;return t.creeps=new Array,t.players=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.layerCode=e.layerCode,this.updateCreeps(e.creeps),this.updatePlayers(e.players)},e.prototype.updateCreeps=function(e){if(this.creeps.splice(0),e)for(var t=0,i=e;t<i.length;t++){var n=i[t];this.creeps.push(new o(n))}},e.prototype.updatePlayers=function(e){if(this.players.splice(0),e)for(var t=0,i=e;t<i.length;t++){var n=i[t];this.players.push(new a(n))}},e}(t.BaseVO);t.SLayer=r,__reflect(r.prototype,"game.SLayer");var s=function(i){function e(e){var t=i.call(this)||this;return t.champion=new a,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.champion=e.champion},e}(t.BaseVO);t.SWar=s,__reflect(s.prototype,"game.SWar")}(game||(game={})),function(n){var a=function(i){function t(e){var t=i.call(this)||this;return t.baseInfo=new n.BaseInfoVO,e&&t.update(e),t}return __extends(t,i),t.prototype.update=function(e){this.baseInfo.update(e),this.isLeader=e.isLeader},t.makeFakeData=function(){var e=new t;return e.baseInfo=n.BaseInfoVO.makeFakeData(),e.isLeader=!1,e.index=0,e},t}(n.BaseVO);n.TeamMemberVO=a,__reflect(a.prototype,"game.TeamMemberVO");var e=function(i){function o(e){var t=i.call(this)||this;return t.otherInfo={},t.members=new Array,t.fightCap=0,e&&t.update(e),t}return __extends(o,i),o.prototype.update=function(e){var i=this;this.members.splice(0),e?(this.id=e.id,this.name=e.name,this.leader=e.leader,this.serverName=e.serverName,this.serverId=e.serverId,this.avatar=e.avatar,this.level=e.level,this.fightCap=0,Array.isArray(e.members)&&e.members.forEach(function(e,t){i.fightCap+=e.baseInfo.fightCap,e.index=t,i.leader==e.baseInfo.playerId&&(e.baseInfo.isLeader=!0,i.leaderVO=e),i.members.push(new a(e.baseInfo))})):this.id=void 0},o.prototype.reset=function(){this.id=void 0,this.members.splice(0)},o.makeFakeData=function(e){var t=new o;e||(e=3);for(var i=0;i<e;i++){var n=a.makeFakeData();n.index=i,n.isLeader=0==n.index,t.members.push(n)}return t.leaderVO=t.members[0],t.leader=t.leaderVO.baseInfo.playerId,t.serverId=Utils.DebugUtils.getFakeServerId(),t.avatar=t.leaderVO.baseInfo.avatar,t.level=t.leaderVO.baseInfo.level,t.fightCap=0,t.name=t.leaderVO.baseInfo.name,t.members.forEach(function(e){t.fightCap+=e.baseInfo.fightCap}),t},o}(n.BaseVO);n.TeamVO=e,__reflect(e.prototype,"game.TeamVO");var t=function(i){function e(e){var t=i.call(this)||this;return t.member=new a,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.dt=e.dt,this.member.update(e.member&&e.member.baseInfo)},e}(n.BaseVO);n.ApplyRecordVO=t,__reflect(t.prototype,"game.ApplyRecordVO");var o=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.uuid=e.uuid,this.battlePos=e.battlePos},e}(n.BaseVO);n.SHeroPosition=o,__reflect(o.prototype,"game.SHeroPosition");var i=function(i){function e(e){var t=i.call(this)||this;return t.heros=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){var i=this;this.teamNo=e.teamNo,this.heros.splice(0),Array.isArray(e.heros)&&e.heros.forEach(function(e,t){i.heros.push(new o(e))})},e}(n.BaseVO);n.SHeroTeam=i,__reflect(i.prototype,"game.SHeroTeam");var r=function(i){function e(e){var t=i.call(this)||this;return t.heros=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){var i=this;this.teamNo=e.teamNo,this.petUuid=e.petUuid,this.magicalUuid=e.magicalUuid,this.heros.splice(0),Array.isArray(e.heros)&&e.heros.forEach(function(e,t){i.heros.push(new o(e))})},e}(n.BaseVO);n.PlayerMultiTeamVO=r,__reflect(r.prototype,"game.PlayerMultiTeamVO");var s=function(i){function e(e){var t=i.call(this)||this;return t.teams=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){var i=this;this.type=e.type,this.teams.splice(0),Array.isArray(e.teams)&&e.teams.forEach(function(e,t){i.teams.push(new r(e))})},e}(n.BaseVO);n.SModuleTeam=s,__reflect(s.prototype,"game.SModuleTeam")}(game||(game={})),function(o){var i=function(){function e(e){this.baseInfo=new o.PlayerInfoVO,this.targeted=[],e&&this.update(e)}return Object.defineProperty(e.prototype,"challengeTimes",{get:function(){return Number(o.Config.constConfig().TribeBattleInitChallengeTime.constValue)+this.hasPurchasedTime-this.hasChallengedTime+this.refreshTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"revengeTimes",{get:function(){return Number(o.Config.constConfig().TribeBattleInitRevengeTime.constValue)+o.GameMVC.tribeBattlePy.battleInfo.playerInfo.hasPurchasedRevengeTime-o.GameMVC.tribeBattlePy.battleInfo.playerInfo.hasRevengedTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lootGoods",{get:function(){var e=Number(o.Config.constConfig().TribeBattleChallengeGoodsReduceRatio.constValue),t=Number(o.Config.constConfig().TribeBattleMaxRatioReduceTime.constValue),i=Number(o.Config.constConfig().TribeBattleChallengeFixedGoods.constValue);return Math.floor((this.holdGoods+this.fixedGoods)*Math.max(e-this.beChallengedTime,t)/100)+i},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this.baseInfo.update(e.baseInfo),this.fixedGoods=e.fixedGoods,this.holdGoods=e.holdGoods,this.hasChallengedTime=e.hasChallengedTime,this.hasPurchasedTime=e.hasPurchasedTime,this.lastChallengeRefreshDt=e.lastChallengeRefreshDt,this.hasRevengedTime=e.hasRevengedTime,this.hasPurchasedRevengeTime=e.hasPurchasedRevengeTime,this.targeted=e.targeted,this.guildGoods=e.guildGoods,this.refreshTime=e.refreshTime,this.playerMaxGoods=e.playerMaxGoods,this.guildMaxGoods=e.guildMaxGoods,this.beChallengedTime=e.beChallengedTime,this.lastBeLootedDt=e.lastBeLootedDt},e}();o.TBPlayerEntityVO=i,__reflect(i.prototype,"game.TBPlayerEntityVO");var a=function(){function e(e){this.baseInfo=new o.GuildVO,this.playerList=[],e&&this.update(e)}return Object.defineProperty(e.prototype,"maxPlayerlootGoods",{get:function(){var e=Number(o.Config.constConfig().TribeBattleChallengeGoodsReduceRatio.constValue),t=Number(o.Config.constConfig().TribeBattleMaxRatioReduceTime.constValue),i=Number(o.Config.constConfig().TribeBattleChallengeFixedGoods.constValue);return Math.floor(this.maxPlayerGoods*Math.max(e-this.maxGoodsPlayerBeChallengedTime,t)/100)+i},enumerable:!0,configurable:!0}),e.prototype.update=function(e){var t=this;this.baseInfo.update(e.baseInfo),this.totalGoods=e.totalGoods,this.maxPlayerGoods=e.maxPlayerGoods,this.maxGoodsPlayerBeChallengedTime=e.maxGoodsPlayerBeChallengedTime,this.playerList.splice(0),e.playerEntityList.forEach(function(e){t.playerList.push(new i(e))})},e}();o.TBGuildEntityVO=a,__reflect(a.prototype,"game.TBGuildEntityVO");var e=function(){function e(e){this.playerInfo=new i,e&&this.updateData(e)}return e.prototype.updateData=function(e){this.playerInfo.update(e.playerEntityInfo),this.beLootedGoods=e.beLootedGoods},e}();o.TBBattleRecordVO=e,__reflect(e.prototype,"game.TBBattleRecordVO");var t=function(){function e(){this.playerInfo=new i,this.guildInfo=new a,this.guildList=[]}return e.prototype.update=function(e){this.updatePlayer(e.playerEntityInfo),this.updateGuildList(e.guildEntityList)},e.prototype.updatePlayer=function(e){this.playerInfo.update(e)},e.prototype.updateGuildList=function(t){var i=this;if(Array.isArray(t)){this.guildList.splice(0);var n=o.GameMVC.guildPy.guildDetail.guildId;t.forEach(function(e){e.baseInfo.id===n?i.guildInfo.update(e):i.guildList.push(new a(e))})}else this.guildList.forEach(function(e){e.baseInfo.id===t.baseInfo.id&&e.update(t)})},e}();o.TBInfoVO=t,__reflect(t.prototype,"game.TBInfoVO")}(game||(game={})),function(t){var e=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.uuid=e.uuid,this.code=e.code,this.dt=e.dt},e}(t.BaseVO);t.BarrageInfoVO=e,__reflect(e.prototype,"game.BarrageInfoVO");var i=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.attackUuid=e.attackUuid,this.defenceUuid=e.defenceUuid,this.win=e.win,this.round=e.round,this.attackNum=e.attackNum,this.defenceNum=e.defenceNum},e}(t.BaseVO);t.BattleDetailInfoVO=i,__reflect(i.prototype,"game.BattleDetailInfoVO");var n=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.pos=e.pos,this.code=e.code},e}(t.BaseVO);t.SWchessCardVO=n,__reflect(n.prototype,"game.SWchessCardVO");var o=function(i){function e(e){var t=i.call(this)||this;return t.voType="chess",e&&t.update(e),t}return __extends(e,i),e.prototype.isInFormation=function(){return this.pos<=ZZQ_CONST.SHANGZHEN_NUM},Object.defineProperty(e.prototype,"config",{get:function(){return t.Config.chessHero()[this.code]},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this.uuid=e.uuid,this.code=e.code,this.attr=e.attr,this.pos=e.pos,this.starLevel=e.starLevel,this.skillList=e.skillList,this.fightCap=e.fightCap},e}(t.BaseVO);t.SWchessHeroVO=o,__reflect(o.prototype,"game.SWchessHeroVO");var a=function(i){function e(e){var t=i.call(this)||this;return e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.uuid=e.uuid,this.dt=e.dt,this.attackUuid=e.attackUuid,this.defenceUuid=e.defenceUuid,this.win=e.win},e}(t.BaseVO);t.BattleRecordInfoVO=a,__reflect(a.prototype,"game.BattleRecordInfoVO");var r=function(i){function e(e){var t=i.call(this)||this;return t.battleRecordList=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.name=e.name,this.level=e.level,this.avatar=e.avatar,this.life=e.life,this.exp=e.exp,this.gold=e.gold,this.uuid=e.uuid,this.dt=e.dt,this.isAutoRefresh=e.isAutoRefresh,this.winLoseStreak=e.winLoseStreak,this.stationList=e.stationList,this.winNum=e.winNum,this.loseNum=e.loseNum,this.killNum=e.killNum,this.grade=e.grade,this.hGrade=e.hGrade,this.starLevelTargeted=e.starLevelTargeted,this.maxRank=e.maxRank,1e3<=this.life&&(this.life=-this.life%1e3),t.BaseVO.updateArr(e.battleRecordList,this.battleRecordList,a)},e}(t.BaseVO);t.SWchessPlayerVO=r,__reflect(r.prototype,"game.SWchessPlayerVO");var s=function(i){function e(e){var t=i.call(this)||this;return t.players=new Array,e&&t.update(e),t}return __extends(e,i),e.prototype.update=function(e){this.id=e.id,this.status=e.status,this.dt=e.dt,this.leader=e.leader,this.uuid=e.uuid,this.sysDt=e.sysDt,this.opponentList=e.opponentList,this.endDt=e.endDt,t.BaseVO.updateArr(e.players,this.players,r)},e}(t.BaseVO);t.SWchessRoomVO=s,__reflect(s.prototype,"game.SWchessRoomVO")}(game||(game={})),window.Main=Main;