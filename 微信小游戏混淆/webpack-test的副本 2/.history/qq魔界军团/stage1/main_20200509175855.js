var egret=window.egret,$E=window.egret,$G=game=window.game={},$C=customui=window.customui={},__reflect=this&&this.__reflect||function(e,t,i){e.__class__=t,i?i.push(t):i=[t],e.__types__=e.__types__?i.concat(e.__types__):i},__extends=this&&this.__extends||function(e,t){function i(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);i.prototype=t.prototype,e.prototype=new i},__awaiter=this&&this.__awaiter||function(a,r,s,c){return new(s=s||Promise)(function(e,t){function i(e){try{n(c.next(e))}catch(e){t(e)}}function o(e){try{n(c.throw(e))}catch(e){t(e)}}function n(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(i,o)}n((c=c.apply(a,r||[])).next())})},__generator=this&&this.__generator||function(i,o){var n,a,r,e,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,a&&(r=a[2&t[0]?"return":t[0]?"throw":"next"])&&!(r=r.call(a,t[1])).done)return r;switch(a=0,r&&(t=[0,r.value]),t[0]){case 0:case 1:r=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,a=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(r=0<(r=s.trys).length&&r[r.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!r||t[1]>r[0]&&t[1]<r[3])){s.label=t[1];break}if(6===t[0]&&s.label<r[1]){s.label=r[1],r=t;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(t);break}r[2]&&s.ops.pop(),s.trys.pop();continue}t=o.call(i,s)}catch(e){t=[6,e],a=0}finally{n=r=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},BaseMediator=function(o){function e(e,t){void 0===e&&(e=""),void 0===t&&(t=null);var i=o.call(this,e,t)||this;return i._view={},i.afterViewShowCB={},i.resGroupNames=new Array,i._name=e,i.initSubView(),i}return __extends(e,o),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【"+this._name+"】："].concat(e))},Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),e.prototype.initSubView=function(){},e.prototype.handleNotice=function(e){},e.prototype.addRootView=function(e,t,i,o){void 0===t&&(t=0),void 0===i&&(i=void 0),void 0===o&&(o=void 0),this.viewComponent&&this.viewComponent.parent?(this.hideAllSubView(!1),this.viewComponent.visible=!0):(GameRootLayer.gameLayer().setViewStackDirty(),this.viewComponent=null,this.viewComponent=new e,this.viewComponent.mediator=this,GameRootLayer.gameLayer().bindView(this.viewComponent,t,i||this.viewComponent.getParentView(),o),this.viewComponent.checkForGuide&&game.AppFacade.getInstance().sendNotification(CN.GUIDE_VIEW_STACK_CHANGE,{}),game.MainJumpConfig.confirmPush()),this.onViewCreate()},e.prototype.addSubView=function(e,t,i,o,n){void 0===e&&(e=void 0),void 0===i&&(i=void 0),void 0===o&&(o=void 0),void 0===n&&(n=!1),this._view[e]||(this._view[e]={className:t,obj:void 0,z:i,resPack:o,jumpCode:void 0,keepAlive:n})},e.prototype._topView=function(e){this._view[e]&&this._view[e].obj&&this._view[e].obj.parent&&(this._view[e].obj.parent.setChildIndex(this._view[e].obj,-1),this._view[e].obj.visible=!0,1==e&&(this.viewComponent||(this.viewComponent=this._view[e].obj)),this.afterViewShowCB[e]&&(this.afterViewShowCB[e](),delete this.afterViewShowCB[e]),this.onViewResume(e))},e.prototype.updateView=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var o=void 0;if(e){var n=this._view[e];if(!n)return void egret.log("BaseMediator:updateView",this._name,e,"no init");o=n.obj}else o=this.viewComponent;o&&o.parent&&o.updateView&&o.isCreateComplete?o.updateView.apply(o,t):egret.log("BaseMediator:updateView",this._name,e,"no show")},e.prototype.removeFromParent=function(){this.viewComponent&&this.viewComponent.parent&&this.viewComponent.parent.removeChild(this.viewComponent)&&GameRootLayer.gameLayer().arrangeViewVisible()},e.prototype.getSubView=function(e){var t=this._view[e];if(t)return t.obj;egret.log("BaseMediator:getSubView",this._name,e,"no init")},e.prototype.showSubView=function(t,e){var i=this;void 0===e&&(e=void 0);var o=this._view[t];if(o){var n=o.obj;if(n)GameRootLayer.gameLayer().setViewStackDirty(),n.parent||GameRootLayer.gameLayer().bindView(n,void 0,n.getParentView(),o.zOrder),n.isCreateComplete?n.updateView(e):n.setUpdateParamsAfterCreated(e),this._topView(t),n.checkForGuide&&game.AppFacade.getInstance().sendNotification(CN.GUIDE_VIEW_STACK_CHANGE,{}),o.jumpCode=game.MainJumpConfig.confirmPush();else{function a(){if(!n){if(!(n=new o.className).perShow(e))return void(n=void 0);n.viewID=t.toString(),n.mediator=i}i._view[t].obj=n,i._view[t].jumpCode=game.MainJumpConfig.confirmPush(),GameRootLayer.gameLayer().setViewStackDirty(),n.setUpdateParamsAfterCreated(e,function(){i._topView(t),i.onViewCreate(t)}),"BasePanel"==n.viewType()?PopUpManager.addPopUp({effectType:n.popActionType(),obj:n,clickDarkClose:e&&e.clickDarkClose,onDarkClick:function(e){return 1==t?i.hideAllSubView(!1):i.hideSubView(t),!0},closeCB:e&&e.closeCB,context:i,interruptButNotBreakGuide:e?e.interruptButNotBreakGuide:void 0}):(GameRootLayer.gameLayer().bindView(n,void 0,n.getParentView(),o.zOrder),n.checkForGuide&&game.AppFacade.getInstance().sendNotification(CN.GUIDE_VIEW_STACK_CHANGE,{}))}null!=o.resPack?this.preloadRes(o.resPack,function(){a()}):a()}}},e.prototype.hideSubView=function(e,t,i,o){void 0===t&&(t=void 0),void 0===i&&(i=!1),void 0===o&&(o=!1);var n=void 0;if("object"==typeof e){for(var a in this._view)if(this._view[a].obj==e){e=a,n=this._view[a];break}}else n=this._view[e];if(n&&n.obj){var r=n.obj;r&&r.parent&&(r.perClose(),n.keepAlive&&!o||(GameRootLayer.gameLayer().setViewStackDirty(),"BasePanel"==r.viewType()?PopUpManager.removePopUp(r,void 0,t):(r.parent.removeChild(r),r.checkForGuide&&game.AppFacade.getInstance().sendNotification(CN.GUIDE_VIEW_STACK_CHANGE,{}),GameRootLayer.gameLayer().arrangeViewVisible()),this._view[e].obj=void 0,i||game.MainJumpConfig.confirmSpliceIfTop(this._view[e].jumpCode)))}},e.prototype.hideAllSubView=function(e,t){for(var i in void 0===e&&(e=!0),void 0===t&&(t=!1),this._view)this.hideSubView(i,void 0,e,t)},e.prototype.onViewCreate=function(e){},e.prototype.onViewResume=function(e){},e.prototype.switchMenLoading=function(e,t){var i=this;GameRootLayer.gameLayer().isMenShow?this.preloadRes(e,t):GameRootLayer.gameLayer().switchMenLoading(!0,function(){i.preloadRes(e,function(){GameRootLayer.gameLayer().switchMenLoading(!1,void 0,"BM_SWITCH_MEN_LOADING"),t&&t()})},"BM_SWITCH_MEN_LOADING")},e.prototype.preloadRes=function(e,t){var i=this;this.resGroupNames.splice(0);("string"==typeof e?[e]:e).forEach(function(e,t){RES.isGroupLoaded(e)||i.resGroupNames.push(e)}),0<this.resGroupNames.length?(egret.log("加载资源",this.resGroupNames),this.facade.sendNotification(CN.SHOW_LOADING,{groupNames:this.resGroupNames,resDoneCB:t})):t&&t()},e.prototype.setCBAfterSubViewShow=function(e,t){this.getSubView(e)&&this.getSubView(e).visible?t&&t():t&&(this.afterViewShowCB[e]=t)},e}(puremvc.Mediator);__reflect(BaseMediator.prototype,"BaseMediator",["puremvc.IMediator","puremvc.INotifier"]);var EPropertyType={EPropertyTypeDiamond:1,EPropertyTypeGold:2,EPropertyTypeArena:3,EPropertyTypeDevote:4,EPropertyTypeBossHonor:5,EpropertyTypeWorldKingHonor:6,EPropertyTypeWorldKingGrade:7,EPropertyTypeExpedition:8,EPropertyTypeIntegralShop:9,EPropertyTypeTeamExpedition:10,EPropertyTypeFriendIntimacy:11,EPropertyTypeSoul:12,EPropertyTypeSpaceTime:13,EPropertyTypeQqxyxXingBi:14,EPropertyTypeManor:15,EPropertyTypeTribeBattleGoods:16,EPropertyTypePeakWarMoney:17,EPropertyTypeTopFarmMoney:18,EPropertyTypeSF2020Coin:19,EPropertyTypeGloryArena:20},EExpType={EExpTypePlayer:1,EExpTypeVip:2,EExpTypeGuild:3,EExpTypeBraveBook:4,EExpTypeNewBraveBook:5,EExpTypeDoubleEleven:6,EExpTypeHonorOrder:7},EPropType={EPropTypeGemeral:0,EPropTypePokemonExp:1,EPropTypePokemonFoster:2,EPropTypePokemonBall:3,EPropTypeGem:4,EPropTypeVictory:5,EPropTypeSkillBook:6,EPropTypeFashion:7,EPropTypeRandomBox:8,EPropTypeSelectBox:9,EPropTypeEdenTimes:10,EPropTypeFixedBox:11,EPropTypeChip:12,EPropTypeMonthCard:13,EPropTypeRecharge:14,EPropTypeWorldBoss:15,EPropTypeRedPacket:16,EPropTypeMap:17,EPropTypeAvatar:18,EPropTypeBraveBook:19,EPropTypeFrame:20,EPropTypeNewBraveBook:21,EPropTypeStormWarScore:22,EPropTypeHeroSpirit:23,EPropTypeManorScore:24,EPropTypePeakWarScore:25,EPropTypeTopFarmCrop:26,EPropTypeTopFarmSeed:27,EPropTypeThannksGivingScore:28,EPropTypeChristmasTreeCount:29,EPropTypeSF2020Active:30,EPropTypeSF2020RegBag:31,EPropTypeIslandItem:32},EVictoryPropType={EVictoryPropTypeAddVit:1,EVictoryPropTypeKillCreep:2,EVictoryPropTypeBonus:3,EVictoryPropTypeAddRange:4},EGemType={EGemTypeLife:1,EGemTypePhysicalAtk:2,EGemTypeMagicAtk:3,EGemTypePhysicalDefense:4,EGemTypeMagicDefense:5,EGemTypeSpeed:6},EEntityType={EEntityTypeMoney:1,EEntityTypeExp:2,EEntityTypeItem:3,EEntityTypeHero:4,EEntityTypePlayer:5,EEntityTypeGuild:6,EEntityTypeHeroUuid:7,EEntityTypeHeroEquip:8,EEntityTypeHeroArtifact:9,EEntityTypePet:10,EEntityTypeTreasure:11,EEntityTypeMagical:12,EEntityTypeMap:13,EEntityTypeDerma:14,EEntityTypeHeroArtifactCode:15,EEntityTypeVestageItem:16,EEntityTypeVestageHero:17,EEntityTypeTitle:18,EEntityTypeHorse:19,EEntityTypeFashion:20,EEntityTypeImmortal:21},BattleEntityType={Hero:1,Creep:2,Boss:3,Magical:4,Pet:5},EColorType={EColorTypeWhite:1,EColorTypeGreen:2,EColorTypeBlue:3,EColorTypePurple:4,EColorTypeOrange:5,EColorTypeRed:6,EColorTypeLegend:7,EColorTypeDarkGold:8},EAttrType={Atk:1,Life:2,Defence:3,Speed:4,Anger:5,Crit:11,CritHurt:12,Toughness:13,Hit:14,Miss:15,HurtRate:16,FreeHurtRate:17,Precise:18,Parry:19,ParryCoff:20,FreeControl:21,ArmorBreak:22,SockBlood:23,AntiInjury:24,Crue:25,BeCrue:26,SkillHurt:27,BeSkillHurt:28,SkillHurtAdd:29,SkillHurtFree:30,BossHurtAdd:31,FreeHurtRate2:32,BuffControl:33,Tenacity:34,HurtRate2:35,FinalHurtAdd:36,FinalFreeHurt:37},ESAttrType={Control:1,Profession:2,Race:3},EBuffType={Invalid:0,Benumb:1,BloodResume:2,Silence:3,Disperse:4,DebuffsDisperse:5,Firing:6,SockBlood:7,Posioned:8,AppointedDisperse:9,Frozen:10,Petrified:11,Taunt:12,Sign:13,SkillChange:14,Shield:15,ConvertedLife:16,RoundAdd:17,Immune:18,ControlAttrAdd:19,CareerAttrAdd:20,RaceAttrAdd:21,ControlAttrReduce:22,CareerAttrReduce:23,RaceAttrReduce:24,ActionChange:25,Absorb:26,SockBlood2:27,FreeDead:29,FreeHurt:30,StaticEle:31,WineMist:32,Transform:33,DeathSign:34,MAttack:35,FreeCure:36,NormalFree:37,Link:38,BreakAway:39,Egg:40,TriEle:41,RandomEle:42,FireEle:43,IceEle:44,ThunderEle:45,SockBlood4:46,Soul:47,ConditionAttrAdd:48,ConditionAttrReduce:49,Farewell:50,Shield2:51,Shelter:52,TauntReverse:53,Stealth:54,Spurting:55,Shield3:56,Show:57,Doppelganger:58,Revenge:59,DeadWord:60,Detonate:61,Shield4:62,NoCumulativeAttrAdd:63,NoCumulativeAttrReduce:64,Shield5:65,LifeMaxAdd:66,DecreaseAttrAdd:67,DecreaseAttrReduce:68,SkillChange2:69,DirectDeath:70,BuffRoundAdd:71,Swear:72,ConvertedBuff:73,TransferDamage:74,BearDamage:75,Dule:76,BeDule:77,Immune2:78,MissEle:79,BlessEle:80,SingleAttackIngore:81,SkillPercentHurtAdd:82,GenMissEle:83,TurnBack:85,Mucus:86,EasilyInjured:87,Reflect:88,Concealment:89,IgnoreAttr:90,FirstAttack:91,ActionSkill:92,AttackAdd:101,LifeAdd:102,DefenceAdd:103,SpeedAdd:104,AngerAdd:105,CritAdd:111,CritHurtAdd:112,ToughAdd:113,HitAdd:114,MissAdd:115,HurtAdd:116,FreeHurtAdd:117,PreciseAdd:118,ParryAdd:119,ParryCoffAdd:120,FreeControlAdd:121,ArmorBreakAdd:122,SockBloodAdd:123,AntiInjuryAdd:124,CrueAdd:125,BeCrueAdd:126,SkillHurtAdd:127,BeSkillHurtAdd:128,SkillHurtAddAdd:129,SkillHurtFreeAdd:130,FreeHurtRate2Add:132,BuffControlAdd:133,TenacityAdd:134,HurtRate2Add:135,AttackReducce:201,LifeReducce:202,DefenceReducce:203,SpeedReducce:204,AngerReducce:205,CritReducce:211,CritHurtReducce:212,ToughReducce:213,HitReducce:214,MissReducce:215,HurtReducce:216,FreeHurtReducce:217,PreciseReducce:218,ParryReducce:219,ParryCoffReducce:220,FreeControlReducce:221,ArmorBreakReducce:222,SockBloodReducce:223,AntiInjuryReducce:224,CrueReduce:225,BeCrueReduce:226,SkillHurtReduce:227,BeSkillHurtReduce:228,SkillHurtAddReduce:229,SkillHurtFreeReduce:230,FreeHurtRate2Reduce:232,BuffControlReduce:233,TenacityReduce:234,HurtRate2Reduce:235},PropAttr={Miss:1,BeCrit:2,Parry:3,BeMiss:4,Crit:5,BeParry:6},EConditionType={Control:1,PropEffect:2,RoundNumEach:3,RoundNumUpper:4,BeginBattle:5,Forever:6,Damage:7,Death:8,NormalSkill:9,AngerSkill:10,HurtResultLowerTotalLife:11,LifeLowerTotalLife:12,LifeUpperTotalLife:13,OpponentCareer:14,OpponentRace:15,Cure:16,HurtResultUpperTotalLife:17,RoundClosing:18,BuffTrigger:19,Prop:20,SignNum:21,LiveNum:22,ControlNum:23,LifeNum:24,BeginBattleLimit:25,LifeCost:26,RevengeNum:27,ProfessionNum:28,OnAttack:29,SpeedLowSelf:30,SpeedHighSelf:31,EmptyPosNum:32,BeDuleAttack:33,NoBeDuleAndExistNoBeDule:34,OnCure:35,AngerNum:36,BeginBattlePlus:37},EBuffOverlayType={No:0,OnlyTimes:1,OnlyEffect:2,Both:3},EBuffActionType={None:0,DirectlyModify:1,Add:2,Minus:3,Plus:4,Divide:5},EEffectStatus={Miss:0,Crit:1,Parry:2,Lose:4},EBuffDispelType={EBuffDispelNone:0,EBuffDispelOk:1},EBuffGainType={EBuffGainTypeNone:0,EBuffGainTypeBuff:1,EBuffGainTypeDebuff:2},ETargetType={Self:1,Friend:2,Enemy:3,Target:4,All:5,SelfDir:6},EHurtTargetType={Position:0,Random:1,All:2,Front:3,Back:5,MinLife:8,MaxLife:9,MaxRatioLife:10,MinRatioLife:11,MaxAttack:12,MinAttack:13,MaxSpeed:14,MinSpeed:15,MaxAnger:16,MinAnger:17,Catapult:18,Multistage:19,FrontFix:20,BackFix:21,MultiAttack:22,AllNotSelf:23,MaxMiss:24,MinMiss:25,RandomFront:26,RandomBack:27,ControlNum:28,RandomNoDule:29,MaxAttackNotSelf:30},ESkillType={None:0,Damage:1,Cure:2,Action:3,Normal:4,AttackBack:5,LastEffectors:6,LastTarget:7,CopyEffect:8,ConditionEffect:9,Penetrate:10},ESkillActionType={Normal:1,Action:2,Passive:3},EBattleSide={EBattleSideAttack:1,EBattleSideDefence:2},PositionType={Normal:0,OneTwo:1,TwoOne:2,ZeroOne:3,ZeroOneBig:4,Chess8V8:5},BattleNumberSource={Atk:0,LastDamage:1,Life:2,MaxLife:3,AngerCost:4,Cure:5,Damage:6,TLife:7,TMaxLife:8},EHurtUp={Num:1,Anger:2,Sign:3,AngerCost:4,LifeDown:5,RevengeNum:6,ProfessionNum:7,LifeLeft:8},EHurtAddition={Atk:1,Life:2,TAtk:3,TLife:4,TMLife:5,Fix:6,TCLife:7,CLife:8},EFreeDeadType={Hurt:1,Life:2},EComboType={Prop:1,Kill:2},EEquipPartType={EEquipPartTypeHat:1,EEquipPartTypeJacket:2,EEquipPartTypeBottom:3,EEquipPartTypeGlove:4,EEquipPartTypeShoes:5,EEquipPartTypeOrnaments:6},EBattleResult={EBattleResultWin:1,EBattleResultLose:2,EBattleResultDraw:3},EEnergyRecovery={Attack:1,Defence:2,Kill:3,EnergyDefence:4},EBattleType={EBattleTypeTest:1,EBattleTypeFortress:2,EBattleTypeDailyFortress:3,EBattleTypeArena:5,EBattleTypeGuildBoss:6,EBattleTypeGuide:8,EBattleTypePvP:9,EBattleTypeServerBoss:10,EBattleTypeWorldKing:11,EBattleTypeChampion:12,EBattleTypeTeamArena:13,EBattleTypeBattleBack:14,EBattleTypeBattleExpedition:15,EBattleTypeTeamExpedition:16,EBattleTypeHeroChallenge:17,EBattleTypeRisk:18,EBattleTypeGuildTranscript:19,EBattleTypeGuildWar:20,EBattleTypeExtremeBattle:21,EBattleTypeHeroChallenge2:22,EBattleTypeWchess:23,EBattleTypeChampionHelp:24,EBattleTypeDemon:25,EBattleTypeZoneBoss:26,EBattleTypeManor:27,EBattleTypeAbyssLair:28,EBattleTypeFishingSnatch:29,EBattleTypeVestage:30,EBattleTypeStormWar:31,EBattleTypeTribeBattle:32,EBattleTypePeakWar:33,EBattleTypeMidAutumn:34,EBattleTypeNianShou:35,EBattleTypeTeamBoss:36,EBattleTypeAntiepidemicBoss:37,EBattleTypeCardGame:38,EBattleTypeGloryArena:39,EBattleTypeRaceTower:40,EBattleTypeIsland:41},EMailStatus={EMailStatusUnread:0,EMailStatusRead:1},EMailType={EMailTypeSystem:1,EMailTypeReward:2,EMailTypeArena:3,EMailTypeGuildDevote:4,EMailTypeGuildKillReward:5,EMailTypeGuildBossHurt:6,EMailTypeRecharge:7,EMailTypeCreateRole:8,EMailTypeServerBossPlayerHurt:9,EMailTypeWorldKingLevel:10,EMailTypeWorldKingServerRank:11,EMailTypeWorldKingWorldRank:12,EMailTypeTeamArena:13,EMailTypeTeamExpedition:14,EMailTypeNoBagCapacity:15,EMailTypeTeamExpeditionFirstPass:16,EMailTypeGuildCollectTaskFinish:17,EMailTypeChallengeBossKill:18,EMailTypeFightCapActivity:19,EMailTypeGuildTranscript:20,EMailTypeGuildWarWin:21,EMailTypeGuildWarLose:22,EMailTypeGuildWarRank:23,EMailTypeWholeLifeCardReward:24,EMailTypeBraveBookRecharge:25,EMailTypeBraveBookLevelRecharge:26,EMailTypeServerBossWeekPlayerHurt:27,EMailTypeMonthCardReward:28,EMailTypeTeamArenaTransfer:29,EMailTypeTeamExpeditionServerFirstPass:30,EMailTypeRechargeDuplicate:31,EMailTypeNewYearWeekCard:32,EMailTypeActivityZoneConsumeRank:33,EMailTypeNewBraveBookRecharge:34,EMailTypeVipLevel:35,EMailTypeZoneAuction:36,EMailTypeZoneAuctionItem:37,EMailTypeChampionClear:38,EMailTypeDemonFoundReward:39,EMailTypeChessGradeRanking:40,EMailTypeDemonKillReward:41,EMailTypeDemonFoundReward2:42,EMailTypeZoneBossTaskTarget:43,EMailTypeZoneBossTaskFirstRank:44,EMailTypeTeamArenaVoteWinReward:45,EMailTypeTeamArenaVoteLoseReward:46,EMailTypeZoneBossKillReward:47,EMailTypeZoneBossPassedReward:48,EMailTypeZoneActivityDevoteGoodsRank:49,EMailTypeItemExpiredNotice:50,EMailTypeNewZoneActivityConsumeRank:51,EMailTypeResetHeroArtifactBaptize:52,EMailTypeManorBeKilledAccount:53,EMailTypeManorLeaveAccount:54,EMailTypeZoneBossMagicalRewards:55,EMailTypeOpenServerPetRewards:56,EMailTypeV4PetReissueRewards:57,EMailType110LevelPetReissueRewards:58,EMailTypeRollback:59,EMailTypeActivityNewZoneZongZiGradeRank:60,EMailTypeActivityNewZoneDragonBoatGradeRank:61,EMailTypeFirstRechargeRewards:62,EMailTypeManorCloseAccount:63,EMailTypeDiamondRebate:64,EMailTypeNewZoneGroupPurchaseAccount:65,EMailTypeInvitationCode:66,EMailTypeNewZoneActivityConsumeRank1:67,EMailTypeActivityZoneFishing:68,EMailTypeActivityZoneFishingEnd:69,EMailTypePlatformGift:70,EMailTypeActivityStormWarPlayer:71,EMailTypeActivityStormWarGuild:72,EMailTypePetResetReturnRewards:73,EMailTypeMagicalResetReturnRewards:74,EMailTypeStormWarChampionRewards:75,EMailTypeStormWarPlayerScoreRewards:76,EMailTypeStormWarPlayerIncomeRewards:77,EMailTypeMagpieActivityRewards:78,EMailTypeTribeBattlePlayerRewards:79,EMailTypeTribeBattleGuildRewards:80,EMailTypeManorPlayerRankRewards:81,EMailTypeManorGuildRankRewards:82,EMailTypeTribeBattlePlayerAchievement:83,EMailTypeTribeBattleGuildAchievement:84,EMailTypePeakWarFreedomRankRewards:85,EMailTypePeakWarHighLadderRankRewards:86,EMailTypeQuoraFinishRewards:87,EMailTypeZoneQuoraFinishRewards:88,EMailTypeZoneQuoraRank:89,EMailTypeNewZoneNationalDayHG:90,EMailTypeNewZoneNationalDayJiu:91,EMailTypePeakWarFreedomDailyRewards:92,EMailTypeQqzoneGiftMail:93,EMailTypeNewZoneTopFarmMoneyRank:94,EMailTypeRdLoginEmail:95,EMailTypeVipMail:96,EMailTypeActivityNewZoneDoubleElevenRank:97,EMailTypeDoubleElevenLevelUpRebate:98,EMailTypeThanksGivingDailyMail:99,EMailTypeThanksGivingGradeRank:100,EMailTypeActivityNewZoneDoubleTwelveRank:101,EMailTypeServerBossTimesRewards:102,EMailTypeSignInMail:103,EMailTypeNewZoneNewYear2020Rank:104,EMailTypeNewZoneNewYear2020FansRank1:105,EMailTypeNewZoneNewYear2020FansRank2:106,EMailTypeNewZoneNewYear2020FansRank3:107,EMailTypeNewZoneRealSF2020Rank:108,EMailTypeNewZoneRealSF2020SaiMaRewards:109,EMailTypeNewZoneRealSF2020FangDengRewards:110,EMailTypeNewZoneRealSF2020NianShouRank:111,EMailTypeNewZoneRealSF2020NianShouKillReward:112,EMailTypeNewZoneRealSF2020SaiMaFail:113,EMailTypeImmortalMarketSelled:114,EMailTypeImmortalMarketOverdue:115,EMailTypeTeamBoss:116,EMailTypeTeamBossFirstPass:117,EMailTypeNewZoneAntiepidemicBossKillReward:118,EMailTypeAntiepidemicMail:119,EMailTypeNewZonePlantTreeRank:120,EMailTypeNewZonePlantTreeRebate:121,EMailTypeChampionReissue:122,EMailTypeFoolsDayRewards:123,EMailTypeRegressionRewards:124,EMailTypeGloryArenaRankRewards:125,EMailTypeGloryRankRewards:126,EMailTypeHonorOrderRewards:127,EMailTypePetFix:128,EMailTypeIslandCardRewards:129,EMailTypeIslandCardRewards2:130,EMailTypeIslandBadgeGradeRank:131},EMailValueType={EMailValueTypeText:1,EMailValueTypeCode:2},EChatStatus={EChatStatusUnread:1,EChatStatusRead:2},EChatChannelType={EChatChannelTypeWorld:1,EChatChannelTypeGuild:2,EChatChannelTypeSystem:3,EChatChannelTypePrivate:4,SameServer:5,EChatChannelTypeZone:6,EChatChannelNewZone:7},EChatSendCheckType={None:1,Level:2,Length:3,LevelAndLength:4},EChatJumpType={JumpModule:1,ShowInfo:2},EFriendType={EFriendTypeStranger:0,EFriendTypeApply:1,EFriendTypeNormal:2,EFriendTypeRelieve:3,EFriendTypeBlack:4},FriendRewardGiveType={Heart:0,PetGrain:1},EGuildPositionType={EGuildPositionTypeNone:0,EGuildPositionTypeOridinary:1,EGuildPositionTypeVicePresident:2,EGuildPositionTypePresident:3},EGuildQuitType={EGuildQuitTypeNone:0,EGuildQuitTypeTick:1,EGuildQuitTypeQuit:2},EGuildUpdateType={Base:1,Member:2,Apply:3},EGuildOperationType={AppointVice:1,RelieveVice:2,TickOut:3,Transfer:4,Quit:5,Join:6,CancelJoin:7,AgreeJoin:8,AgreeAll:9,RejectJoin:10,RejectAll:11,CancelAll:12},ESexType={ESexTypeMale:1,ESexTypeFemale:2},ShopType={ShopTypeArena:2,ShopTypeGuild:3,ShopTypeRefresh:4,ShopTypeWorldKing:5,ShopTypeTeamArena:6,ShopTypeExpedition:7,ShopTypeTeamExpedition:8,ShopTypeDecompose:9,ShopTypeRaceGashapon:10,ShopTypeSmithy:11,ShopTypeShare:12,ShopTypeHeroChallenge:13,ShopTypeManor:14,ShopTypePeakWar:15,ShopTypeHeroSpirit:16,ShopTypeNationalDay:17,ShopTypeTopFarm:18,ShopTypeThanksGiving:19,ShopTypeDoubleTwelve:20,ShopTypeSF2020:21,ShopTypeGloryArena:22},ShopWorkType={Common:1,FreeAndBuyRefresh:2,BuyRefresh:3,NoneGridRefresh:4,Drop:5,TimeOpen:6},ShopItemUnlockType={None:0,Level:1,Vip:2,ArenaRank:3,GuildLevel:4,WorldKing:5,TeamArenaRank:6},ShopBuyLimitType={Unlimit:0,Daily:1,Week:2,Month:3,Year:4,Career:5},VictoryEventType={VictoryEventTypeLock:0,VictoryEventTypeEmpty:1,VictoryEventTypeCreep:2,VictoryEventTypeItem:3,VictoryEventTypeShop:4,VictoryEventTypeBox:5,VictoryEventTypeEntry:6},VictoryBuffType={VictoryBuffTypeBonus:1,VictoryBuffTypeRange:2},MODULE={Team:1,Team2:2,Team3:3,Team4:4,Team5:5,Team6:6,Ranking:101,CityMain:201,Task:301,TaskSecAchieve:303,Reward:401,Recharge:501,VIP:601,Chat:701,ChatWorld:702,ChatPrivate:703,Friend:801,FightSkip:901,FightSpeed:902,FightSkipForVestage:903,FightSkipForChampion:904,FightSkipForRaceTower:905,Bag:1001,Decompose:1002,DecomposeEquip:1003,DecomposeHeroSpirit:1004,Stronger:1101,Champion:1301,ChampionHelp:1302,HeroArtifact:1401,HeroArtifactUpGrade:1402,HeroArtifactUpAttach:1403,HeroArtifactBaptize:1404,HeroArtifactDecompose:1405,HeroArtifactUpStar:1406,HeroArtifactRollback:1407,HeroArtifactAddition:1408,HeroEquip:1501,HeroEquipUpGrade:1502,HeroEquipEnchat:1503,HeroEquipQuenchce:1504,HeroEquipMaster:1505,HeroEquipImprovement:1506,Treasure:1601,TreasureJewelUpGrade:1602,Hero:1701,HeroGaCha:1702,HeroUpGrade:1703,HeroUpStar:1704,HeroUpSection:1705,HeroRollback:1706,HeroResonate:1707,HeroAwaken:1708,StarDoor:1713,Replacement:1714,HeroUpGradeAuto:1715,HeroArtifactUpQuality:1716,HeroArtifactResoante:1717,HeroPractice:1718,HeroSpirit:1719,HeroDefend:1720,Pet:1801,PetUpGrade:1802,PetUpStar:1803,PetUpSection:1804,PetUpSkill:1805,Arena:1901,ArenaSaoDang:1902,TeamArena:2001,DailyFortress:2102,Expedition:2104,ExpeditionSaoDang:2105,GuardianSecret:2110,GuardianSecretSweep:2111,AbyssLair:2130,Mail:2201,TeamExpedition:2301,WorldKing:2401,ServerBoss:2501,Magical:2601,MagicalUpGrade:2602,MagicalUpSection:2603,MagicalPutOn:2604,Risk:2701,RiskDifficulty:2702,RiskFingerToXY:2711,RiskMeToXY:2712,RiskQuickBattle:2713,RiskFingerAppearToXY:2714,Demon:2715,RiskMulti:2730,TouchGoldHand:2801,Smithy:2901,Shop:3e3,ShopMystical:3001,ShopExpedition:3002,ShopTeamExpedition:3003,ShopDecompose:3004,ShopRaceGashapon:3005,ShopArean:3006,ShopHeroChallenge:3007,ShopPeakWar:3008,ShopHeroSpirit:3009,ShopNationalDay:3010,ShopTypeTeamArena:3011,ShopTypeThanksGiving:3012,ShopTypeDoubleTwelve:3013,ShopTypeSF2020:3014,Guild:4001,GuildCopy:4002,GuildBoss:4003,GuildInbreak:4004,GuildTask:4005,GuildBounty:4006,GuildSubway:4007,GuildSkill:4008,GuildShop:4009,GuildHall:4010,GuildLuckyMoney:4011,GuildManor:4012,GuildCollect:4013,GuildTranscript:4002,GuildWar:4015,TopFarm:4020,TopFarmResearch:4021,Challenge:5001,Challenge10x:5002,HeroChallenge:6001,GloryArena:6500,GloryArenaDef:6501,RaceTower:6600,Wchess:7001,ZoneBoss:8001,HeroDerma:9001,HeroDermaUpGrade:9002,Manor:1e4,LuckyTurntable:10200,Vestage:10210,StormWar:10220,MagpieActivity:10230,MagpieActivityCtrl:10231,TribeBattle:10240,TribeBattleChallenge:10241,TribeBattleRevenge:10242,PeakWar:10250,PeakWarFreedomChallenge:10251,PeakWarFreedomRefresh:10252,PeakWarHighLadderRefresh:10253,PeakWarHighLadderChallenge:10254,Title:10260,Fashion:10270,RoleSkill:10280,Horse:10290,BattleFormation:10300,Immortal:10310,Stock:10320,ImmortalMarket:10330,TeamBoss:10340,Altar:10350,AltarHero:10351,AltarHeroEquip:10352,AltarHeroArtifact:10353,Cardgame:10360,Courtship:10370,PetFeed:10380,Activity:1e5,ActivityBrave:10091,ActivityNewBrave:10092,ActivityZoneAuction:10093,ChampionChallengeActivity:10322,ActivityBraveBaoZang:10323,ActivityNewBraveBaoZang:10324,ActivityProfessionSuit:10325,ActivityInvitationCode:10400},RankingType={RankingTypeArena:1,RankingTypeFightCap:2,RankingTypeLevel:3,RankingTypeGuild:4,RankingTypeGuildBoss:5,RankingTypeGuildLevel:6,RankingTypeFortress:7,RankingTypeServerWorldKing:8,RankingTypeWorldWorldKing:9,RankingTypePlayerServerBossHurt:10,RankingTypeTeamArena:11,RankingTypeZoneFightCap:12,RankingTypeZoneExpeditionRobot:13,RankingTypeChampion:14,RankingTypeTeamExpedition:15,RankingTypeFightCapActivity:16,RankingTypeGuildTranscript:17,RankingTypeGuildWarScore:18,RankingTypeWeekPlayerServerBossHurt:19,RankingTypeHeroChallenge:20,RankingTypeActivityZoneConsumeRank:21,RankingTypeSingleTeamArena:22,RankingTypeSinglePlayerServerBossHurt:23,RankingTypeSingleWeekPlayerServerBossHurt:24,RankingTypeSingleGuildWarScore:25,RankingTypeChessGrade:26,RankingTypeTeamArenaMatch:27,RankingTypeTeamArenaEliminate:28,RankingTypeTeamArenaEliminateSingle:29,RankingTypeActivityZoneDevoteGoodsRank:30,RankingTypeActivityNewZoneConsumeRank:31,RankingTypeAbyssLair:32,RankingTypeActivityNewZoneZongZiGradeRank:33,RankingTypeActivityNewZoneDragonBoatGradeRank:34,RankingTypeActivityNewZoneConsumeRank1:35,RankingTypeActivityZoneFishing:36,RankingTypeActivityStormWarPlayer:37,RankingTypeActivityStormWarGuild:38,RankingTypeActivityStormWarTopThree:39,RankingTypeTribeBattlePlayer:40,RankingTypeTribeBattleGuild:41,RankingTypeManorPlayer:42,RankingTypeManorGuild:43,RankingTypeActivityRechargeRank:44,RankingTypeHeroSpirit:45,RankingTypePeakWarFreedom:46,RankingTypePeakWarHighLadder:47,RankingTypePeakWarLevelFightCap:48,RankingTypeNewZoneActivityQuora:49,RankingTypeNewZoneActivityNationalDayHG:50,RankingTypeNewZoneActivityNationalDayJiu:51,RankingTypeNewZoneActivityTopFarmMoneyRank:52,RankingTypeActivityNewZoneDoubleElevenRank:53,RankingTypeThanksGivingGradeRank:54,RankingTypeActivityNewZoneDoubleTwelveRank:55,RankingTypeActivityNewZoneNewYear2020Rank:56,RankingTypeActivityNewZoneNewYear2020FansRank1:57,RankingTypeActivityNewZoneNewYear2020FansRank2:58,RankingTypeActivityNewZoneNewYear2020FansRank3:59,RankingTypeActivityNewZoneNewYear2020SelfFansRank:60,RankingTypeActivityNewZoneNewYear2020SelfDaKaRank:61,RankingTypeNewZoneRealSF2020Rank:62,RankingTypeNewZoneActivityQuora1:63,RankingTypeNewZoneRealSF2020NianShouRank:64,RankingTypeTeamBoss:65,RankingTypeNewZonePlantTreeRank:66,RankingTypeGloryArena:67,RankingTypeRaceTowerHuman:68,RankingTypeRaceTowerOrc:69,RankingTypeRaceTowerElf:70,RankingTypeRaceTowerAthanasy:71,RankingTypeRaceTowerDemonNEldar:72,RankingTypeGloryRank:73,RankingTypeIslandBadgeGradeRank:74},RankingSubType={Normal:1,Total:2,Three:3},RobotType={RobotTypeArena:1,RobotTypeExpedition:2,RobotTypeTeamArena:3,RobotTypeWorldKing:4,RobotTypeChat:5},TaskTarget={Target:1,Untarget:2},TaskType={Guide:1,Daily:2,Achievement:3,BraveBook:4,HideAchievement:5,Unlock:6,Apprentice:7,NewBraveBook:8,NewNewBraveBook:9,DifficultyGuide:10,SecondAchievement:11},TaskSubType={HeroUpGradeNums:101,HeroUpGradeTimes:102,HeroUpSectionNums:103,HeroUpSectionTimes:104,HeroUpStarTimes:105,HeroEquipStarNums:106,HeroEquipNums:107,HeroPutOnPos:108,HeroPutOnFront:109,MagicalActivate:110,DecomposeTimes:111,HeroStarNums:112,DecomposeHeroNums:113,HeroEquipColorNums:114,HeroArtifactColorNums:115,HeroStarOne:116,HeroMaxUpGrade:117,HeroEquipPutOnTimes:118,MagicalActivateNum:119,HeroEquipUpGradeTimes:120,HeroEquipEnchantTimes:121,TreasureInlayUpGradeTimes:122,HeroArtifactUpGradeTimes:123,MagicalUpGradeTimes:124,HeroArtifactPutOnTimes:125,FightCap:126,LowerGashaponTimes:201,HighGashaponTimes:202,ArenaChallengeTimes:203,ArenaChallengeRank:204,TeamArenaChallengeTimes:205,TeamArenaChallengeRank:206,ChampionLayer:207,TeamExpeditionSection:208,ExpeditionSection:209,DoneAllDailyTask:210,TouchGoldHand:211,GiveFriendPokeBall:212,ReceiveRiksMineRewards:213,DailyFortressTimes:214,TeamExpeditionTimes:215,ChampionTimes:216,ShopBuyTimes:217,ExpeditionSuccessTimes:218,FriendGashaponHeroStarTimes:219,RaceGashaponTimes:220,JoinGuild:221,CompoundHeroTimes:222,ChallengeTimes:223,GuildCollectFinishTimes:224,GuildTranscriptTimes:225,GuildBoss:226,DoneNewNewBraveBook:227,WorldKingTimes:228,AbyssLairStageNo:229,AbyssLairAllStars:230,VestageMaxMap:231,VipLevelChange:301,LevelUpTeam:302,RiskChatNPC:401,RiskCreeep:402,RiskCollectItem:403,RiskEventFinish:404,RiskLayerNewEnter:405,RiskMultiEventFinish:406,RiskLayerMaxClear:407,RiskMapOpenTimes:408,MixTask:501,ExtremeBattleStage:601,CommentBeLikeMax:701,CommentTimes:702,LikeTimes:703,ChallengeCircle:704,SmithyTimes:705,ActivityGashapon:706,ActivityGashapon1:707,ActivityConsumeDiamond:708,LuckyTurntableTimes:709,FriendShare:801,AddFriend:802,InviteFriend:803,MysticalShopRefreshTime:901,GuildCollectTime:902,HeroArtifactUpStarNum:903,MagicalUpGrade:904,PetUpGrade:905,TreasureJewelTotalLevel:906,QuenchceMasterMaxLevel:907,HeroArtifactTotalBaptizeNum:908,HeroStarSubTypeNum:909,QuoraNum:910,RechargeMoney:911,ShiShenTask:912,JiuShenTask:913,TopFarmCollectTime:914,TopFarmCoinRewardNum:915,GuildTopFarmCoinRewardNum:916,TopFarmBuildLevelNum:917,DoubleElevenCostTimes:918,DoubleElevenViewTime:919,DoubleElevenSignIn:920,CollectItem:940,TurnOverTimes:941,TurnOverPairs:942,TurnOverTrapTimes:943,TurnOverColorPairs:944,FinishTask:945,HeroNum:950,RaceTowerTotalNum:1e3,AltarHeroUnlock:1020,AltarEquipUnlock:1021,AltarArtifactUnlock:1022},TaskUpdateType={Add:1,cover:0},TaskResetType={None:1,Daily:2},GuideActionType={MAP_NPC_MOVE:1,MAP_NPC_EMOJI:2,MAP_NPC_TALK:3,MAP_NPC_FIXED_UPDATE:4,MAP_MAP_SWITCH:10,MAP_FADE_REWARD:20,TASK_FINISH:30,INIT_PKM:50,MAP_FIGHT:60,MAP_GUIDE_END:99},GuideDir={LEFT:0,RIGHT:1},RoleMapDir={YOU:0,ZHENG:1,ZUO:2,HOU:3},ActivityStartType={General:1,ServerOpen:2,CreateRole:3,GeneralServerOpen:4,NewGeneralServerOpen:5},ActivityOper={Add:1,Remove:2},EActivityType={SignIn:1,OnlineReward:2,FirstRecharge:3,FirstRecharge1:1003,LevelReward:4,RechargeReward:5,TargetReward:6,LoginReward:7,FlashSale:8,MonthCard:9,FlashCapsuleHigh:10,FlashCapsuleHigh1:1010,FlashCapsuleHigh2:2010,FlashCapsuleHigh3:3010,FlashCapsuleHigh4:4010,FlashCapsuleHigh5:5010,FlashCapsuleHigh6:6010,FlashCapsuleHigh7:7010,FlashCapsuleHigh8:8010,FlashCapsuleHigh9:9010,FlashCapsuleHigh10:10010,FlashCapsuleHigh11:11010,FlashCapsuleHigh12:12010,CollectHero:11,ChampionChallenge:12,HandbookRank:13,ExchangeCode:14,ShareLink:15,VipGift:16,AppDownLoad:17,DailyRecharge:18,Rotate:19,OpenServerRecharge:20,SecondLoginReward:21,PurchaseGiftBag:22,ModuleGoalReward:23,AdvancedRotate:24,DailyHundred:25,GrowFund:26,ExtremeBattle:27,GroupPurchase:28,PropRotate:29,DiamondRotate:30,GymChallenge:31,FightCapRank:32,DiamondReward:33,PokemonCatch:34,SeveralDayRecharge:35,SecondRecharge:36,ConsumeRotate:37,ConsumeRotateReward:38,GuildFightRank:39,GuildLevelTarget:40,GuildTaskReward:41,GuildTaskExpReward:42,WeChatShare:43,OnceShare:44,SecondGiftBag:45,HolidayOnlineReward:46,HolidayOpenServerRecharge:47,HolidayFlashSale:48,ShouCangYouLi:49,GuanZhuGongZhongHao:1049,ShiMingRenZheng:2049,WeiDuanXiaZai:3049,ActivityShop:50,SecondModuleGoalReward:51,SecondOpenServerRecharge:52,SecondOpenServerRecharge1:1052,SecondOpenServerRecharge2:2052,SecondOpenServerRecharge3:3052,SecondOpenServerRecharge4:4052,SecondOpenServerRecharge5:5052,SecondOpenServerRecharge6:6052,SecondOpenServerRecharge7:7052,SecondOpenServerRecharge8:8052,SecondOpenServerRecharge9:9052,SecondOpenServerRecharge10:10052,SecondOpenServerRecharge11:11052,SecondOpenServerRecharge12:12052,EggReward:53,SecondDiamondRotate:54,ZoneAuction:55,ZoneAuction1:1055,SecondCollectPokemon:56,HangUpDrop:57,ActivityGashapon:58,ActivityGashapon1:1058,ActivityGashaponRank:59,ExchangeReward:60,WonderfulActivity:61,SingleRecharge:62,IntegralShop:63,BossDoubleReward:64,TeamBuying:65,ActivityBoss:66,SecondMonthCard:67,DailyLogin:68,MythicalPokemonGift:69,DiscountGiftBag:70,DiscountGiftBag1:1070,DiscountGiftBag2:2070,DiscountGiftBag3:3070,DiscountGiftBag4:4070,DiscountGiftBag5:5070,DiscountGiftBag6:6070,DiscountGiftBag7:7070,DiscountGiftBag8:8070,DiscountGiftBag9:9070,DiscountGiftBag10:10070,DiscountGiftBag11:11070,DiscountGiftBag12:12070,DiscountGiftBag13:13070,DiscountGiftBag14:14070,DiscountGiftBag15:15070,DiscountGiftBag16:16070,DiscountGiftBag17:17070,DiscountGiftBag18:18070,DiscountGiftBag19:19070,DiscountGiftBag20:20070,DiscountGiftBag21:21070,DiscountGiftBag22:22070,DiscountGiftBag23:23070,DiscountGiftBag24:24070,DiscountGiftBag25:25070,DiscountGiftBag26:26070,BoutiqueShop:71,DiscountRechargeGiftBag:72,LuckyReward:73,ZoneConsumeRank:74,DailyFirstRecharge:75,SixFlash:76,InvestRebate:77,ZeroGiftBag:78,SingleServerAuction:79,GashaponDiscount:80,RechargeRank:81,FlashCapsuleRace:82,FlashCapsuleRace1:1082,FlashCapsuleRace2:2082,FlashCapsuleRace3:3082,RiskLayer:83,LuckyRotate:84,LuckyRotate1:1084,WeekGift:85,MonthGift:86,EnjoyCard:87,EnjoyCard1:1087,EnjoyCard2:2087,EnjoyCard3:3087,EnjoyCard4:4087,EnjoyCard5:5087,DiamondGifts:88,DiamondGifts1:1088,DiamondGifts2:2088,DiamondGifts3:3088,DiamondGifts4:4088,DiamondGifts5:5088,ItemGifts:89,ItemGifts1:1089,ItemGifts2:2089,ItemGifts3:3089,ItemGifts4:4089,ItemGifts5:5089,ItemGifts6:6089,ItemGifts7:7089,ItemGifts8:8089,ItemGifts9:9089,ItemGifts10:10089,ItemGifts11:11089,ItemGifts12:12089,ItemGifts13:13089,ItemGifts14:14089,ItemGifts15:15089,TriggerGifts:90,BraveBook:91,WholeLifeCard:92,DailyLuxuryGifts:93,DailyLuxuryGifts1:1093,DailyLuxuryGifts2:2093,DailyLuxuryGifts3:3093,DailyLuxuryGifts4:4093,DailyLuxuryGifts5:5093,VipLevelGift:94,CommentLike:95,TouchGoldHandTask:96,TouchGoldHandTask1:1096,ArenaChallengeTask:97,ArenaChallengeTask1:1097,SmithyTimeTask:98,SmithyTimeTask1:1098,SmithyTimeTask2:2098,ChallengeCircleTask:99,ChallengeCircleTask1:1099,ChallengeCircleTask2:2099,FriendShare:100,OneYuanGifts:101,SixtyEightYuanGifts:10101,OneYuanGifts2:20101,NewYearWeekCrad:102,MysticalShopRefreshTask:103,MysticalShopRefreshTask1:1103,GuildCollectTask:104,GuildCollectTask1:1104,NewYearChallenge:105,CollectWords:106,TimerLuckyMoney:107,TimerLuckyMoney1:1107,TimerLuckyMoney2:2107,TimerLuckyMoney3:3107,OnlineSpecialDrop:108,OnlineSpecialDrop1:1108,OnlineSpecialDrop2:2108,OnlineSpecialDrop3:3108,OnlineSpecialDrop4:4108,OnlineSpecialDrop5:5108,DailyLoginWeal:109,DailyLoginWeal1:1109,DailyLoginWeal2:2109,DailyLoginWeal3:3109,DailyLoginWeal4:4109,DailyLoginWeal5:5109,ActivityGashaponTask:110,ActivityGashaponTask1:1110,CommonShopSpecialItem:111,CommonShopSpecialItem1:10111,CommonShopSpecialItem2:20111,HeroRollback:112,HeroConvert:113,GashaponMustAppear:114,GashaponMustAppear1:10114,GashaponMustAppear2:1114,DrawCardRatioImprove:115,DrawCardRatioImprove1:1115,NewBraveBook:116,OneChoice:117,ThirdOpenServerRecharge:118,ThirdOpenServerRecharge1:1118,ThirdOpenServerRecharge2:2118,WchessShow:119,HuntTreasure:120,HuntTreasure1:1120,HuntTreasure2:2120,HuntTreasure3:3120,HuntTreasure4:4120,HuntTreasure5:5120,ProfessionSuit:121,ProfessionSuit1:1121,ProfessionSuit2:2121,NewItemGifts:122,NewItemGifts1:1122,NewItemGifts2:2122,CommonTask:123,CommonTask1:1123,CommonTask2:2123,CommonTask3:3123,CommonTask4:4123,CommonTask5:5123,CommonTask6:6123,CommonTask7:7123,CommonTask8:8123,CommonTask9:9123,CommonTask10:10123,DermaJump:124,DermaJump1:1124,DermaJump2:2124,DermaJump3:3124,ConsumeDiamondTask:125,ConsumeDiamondTask1:1125,ZoneDevoteGoods:126,RechargeRotate:127,RechargeRotate1:1127,RechargeRotate2:2127,BasicHeroGifts:128,NewZoneConsumeRank:129,NewZoneConsumeRank1:1129,WishGifts:130,WishGifts1:1130,WishGifts2:2130,WishGifts3:3130,WishGifts4:4130,WishGifts5:5130,WishGifts6:6130,WishGifts7:7130,WishGifts8:8130,WishGifts9:9130,WishGifts10:10130,WishGifts11:11130,QQZoneVipGift:131,NewHeroShow:132,OtherDiamondGifts:134,NewGrowFund:135,RechargeItem:136,NewZoneZongZiGradeRank:137,NewZoneDragonBoatGradeRank:138,EatingZongZi:139,DragonBoatGrade:140,NewNewItemGifts:141,DiamondRebate:142,NewZoneGroupPurchase:143,NewTurntable:144,FourthOpenServerRecharge:145,FourthOpenServerRecharge1:1145,FourthOpenServerRecharge2:2145,FourthOpenServerRecharge3:3145,InvitationCode:146,HeroArtifactUpStarTask:147,PushGiftBag:148,NewOneYuanGifts:149,ZoneFishing:150,EverydayTurntable:151,SecondDiamondGifts:152,DiscountGiftBagDaily:153,DiscountGiftBagDaily1:1153,DiscountGiftBagDaily2:2153,DiscountGiftBagDaily3:3153,DiscountGiftBagDaily4:4153,DiscountGiftBagDaily5:5153,DiscountGiftBagDaily6:6153,DiscountGiftBagDaily7:7153,DiscountGiftBagDaily8:8153,DiscountGiftBagDaily9:9153,DiscountGiftBagDaily10:10153,FifthOpenServerRecharge:154,FifthOpenServerRecharge1:1154,FifthOpenServerRecharge2:2154,FifthOpenServerRecharge3:3154,ContinueRechargeReward:155,ContinueRechargeReward1:1155,ContinueRechargeReward2:2155,ContinueRechargeReward3:3155,ContinueRechargeReward4:4155,VipPreferentialGift:156,SecondContinueRechargeReward:157,SecondContinueRechargeReward1:1157,SecondContinueRechargeReward2:2157,SecondContinueRechargeReward3:3157,SeventhOpenServerRecharge:158,SeventhOpenServerRecharge1:1158,SeventhOpenServerRecharge2:2158,SeventhOpenServerRecharge3:3158,SeventhOpenServerRecharge4:4158,SeventhOpenServerRecharge5:5158,SeventhOpenServerRecharge6:6158,SeventhOpenServerRecharge7:7158,ThirdDiamondGifts:159,ThirdDiamondGifts1:1159,ThirdDiamondGifts2:2159,ThirdDiamondGifts3:3159,ThirdDiamondGifts4:4159,AwakenGiftBag:160,StormWar:161,WishTree:162,WishTree1:1162,BlessingBox:163,MagicalUpGradeTask:164,PetUpGradeTask:165,TreasureJewelTotalLevelTask:166,QuenchceMasterMaxLevelTask:167,HeroArtifactTotalBaptizeTask:168,MagpieActivity:169,DiamondLottery:170,QqzoneOpenServerRecharge:171,SecondNewItemGifts:172,HeroStarSubTypeNumTask:173,SecondDailyGifts:174,VipWelfare:175,WeekFund:176,WeekFund1:1176,WeekFund2:2176,WeekFund3:3176,WeekFund4:4176,WorldRechargeRank:177,TodayActivity:178,SecondLevelReward:179,MidAutumn:180,RandomEvent:181,MoonCake:182,MidAutumnSun:183,Quora:184,Quora1:1184,ProfessionSuitReplacement:185,NewZoneQuora:186,NewZoneQuora1:1186,ZhongQiuTask:187,QuoraNumTask:188,QuoraNumTask1:1188,NationalDay:189,NationalRecharge:190,NationalRecharge1:1190,NationalTask:191,ShiShenTask:192,JiuShenTask:193,CertificationReward:194,TopFarmCollectTime:195,TopFarmCoinRewardNum:196,GuildTopFarmCoinRewardNum:197,TopFarmBuildLevelNum:198,TopFarmMoneyRank:199,DoubleEleven:200,ThirdLevelReward:201,ThirdLevelReward1:1201,ThirdLevelReward2:2201,LimitNumGift:202,LimitNumGift1:1202,DoubleElevenCostTimes:203,DoubleElevenCostTimes1:1203,ThanksGiving:204,ThanksGivingTask:205,ThanksGivingRecharge:206,ThanksGivingItemGifts:207,ThanksGivingItemGifts1:1207,GameHallGift:208,BlueDiamondGift:209,RedBag:210,RedBag1:1210,DoubleTwelve:211,DTRecharge:212,DTRecharge1:1212,DTRecharge2:2212,DTRechargeGift:213,SnowFight:214,ChristmasTree:215,ChristmasSock:216,Christmas:217,ChristmasRecharge:218,ChristmasTask:219,ChristmasItemGift:220,ChristmasItemGift1:1220,DailySignIn:221,BreakEggs:222,NewYear2020Rank:223,NewYear2020:224,ZoneFishingRank:225,NewYear2020Recharge:226,NewYear2020ItemGift:227,NewYear2020ItemGift1:1227,SF2020SnowyCottage:228,SF2020JuBaoPen:229,SF2020Recharge:230,SF2020Task:231,SF2020GuaJi:232,SF2020TurnTable:233,SF2020:234,LanternFestival:235,LanternFestivalSoup:236,LanternFestivalShoot:237,LanternFestivalRandomEvent:238,RealSF2020JiSiTai:239,RealSF2020DaMiaoHui:240,RealSF2020RedBag:241,RealSF2020NianShou:242,RealSF2020GuaJiangQuan:243,RealSF2020SaiMa:244,RealSF2020YingXiongXieLi:245,RealSF2020ZhaoCha:246,RealSF2020FangDeng:247,RealSF2020BuYu:248,RealSF2020:249,SecondExchangeGifts:250,RealSF2020Rank:251,RealSF2020QiangBaoShan:252,RealSF2020Recharge:253,RealSF2020ItemGift:254,PlayerRedBag:255,LanternFestivalRecharge:256,TeamBoss:257,ValentineItemGift:258,ValentineWishPool:259,ValentineTeamHook:260,ValentineTask:261,ValentineRecharge:262,ValentineHeroGift:263,ValentineGiftBox:264,Valentine:265,MaterialBox:266,MaterialDonate:267,SecondSignIn:268,AntiepidemicQuora:269,AntiepidemicBoss:270,AntiepidemicTask:271,AntiepidemicRecharge:272,Antiepidemic:273,WomenItemGift:274,WomenTurnTable:275,WomenRecharge:276,WomenLoginGift:277,WomenCard:278,WomenArtifactReach:279,DiscountGifts:280,DiscountGifts1:1280,DiscountGifts2:2280,DiscountGifts3:3280,PlantTrees:281,PlantWishTrees:282,PlantTreeRecharge:283,PlantTreeItemGift:284,PlantTreeTask:285,PlantTreesDay:286,PlantTreesReach:287,PlantTreesRank:288,HeroEquipImprovement:289,ClientTask:290,FoolsDayDaoDan:291,FoolsDayTask:292,FoolsDayItemGift:293,FoolsDayItemGift1:1293,FoolsDayRecharge:294,Regression:295,QingMingKeng:296,QingMingSoup:297,QingMingTask:298,QingMingRandomEvent:299,QingMingShoot:300,QingMingRecharge:301,QingMing:302,HonorOrder:303,GloryRank:304,RaceTowerTask:305,HonorOrderTask:306,NewHuntTreasure:307,AltarUnlockTask:308,AppstoreSubscriber:309,Island:310,IslandExplore:311,PlantFlower:312,IslandPassCard:313,IslandRecharge:314,IslandExchange:315,RelicGold:316,IslandShop:317,IslandEntrance:318},ActivityPushType={Zero:1,Add:2,Remove:3},ETargetActivityType={TGemLevel:1,TRiding:2,THandbook:3,TFashion:4,TEnchant:5,TForge:6,TWing:7,TFightCap:8,TLevel:9,TMedal:10,TPet:11,TOrnament:12,TField:13,TAura:14,TBadge:15,TFoster:16,TTote:17,TFortress:18,TGashapon:19},ModuleGoalType={ArenaRank:1,Champion:2,EdenCatch:3,Boss:4,HandbookLevel:5,Gym:6,RefreshShop:7,Fortress:8,BattleSubway:9,GuildFortress:10,ServerBossPlayerHonor:11,GuildLevelRank:12,PlayerLevel:13,PlayerFightCap:14,TeamFortress:15,WorldKingLevel:16,WildEncounter:17,ChallengeTeamCount:18,ChallengeRocketCount:19,BattleZoneArenaBattle:20},EChampionRedPointType={Achievement:1},GuildBountyStatus={Able:1,Unable:2,GotReward:3},CollectPokemonActivityCollectType={Add:1,Reduce:2},BroadcastType={System:1,HeroUpStar:2,GuildWarStart:3,GuildWarFirstRank:4,ArenaRankChangeFirst:8,ServerBossOpen:12,ServerBossKill:13,ChallengeChampion:24,TeamExpedition:25,TeamExpeditionInvite:26,TeamArena:27,TeamArenaInvite:28,TeamExpeditionFirstPass:29,JoinGuildInvitation:30,ExtremeBattle:31,ServerBossFirstRank:32,LowerGashaponFiveHero:33,FriendGashaponFiveHero:34,HighGashaponFiveHero:35,RaceGashaponFiveHero:36,OpenRiskMap:37,WorldKingFirstWorldRank:38,ActivityGashaponFiveHero:39,Wchess:40,ChampionRequestHelp:41,ChampionHelpResult:42,WorldKingFirstServerRank:43,HuntTreasureActivity:44,ZoneBossInvite:45,SpecialManor:46,StormWarChampionTransfer:47,DiamondLottery:48,PeakWarRankChangeFirst:50,PeakWarEndFirst:51,NewZoneQuoraFirstRank:52,DoubleTwelveRebatePercent:53,RealSF2020CostRedBag:54,TeamBoss:55,TeamBossInvite:56,ValentineTeamHookInvite:57,CardGameInvite:58},FriendGoodType={FriendPokeBall:11},FriendGoodOperationType={GetOperation:1,GiveOperation:2,GetAndGiveOperation:3,QuickGetAndGiveOperation:4},PlayerOnlineState={Online:1,Offline:2},RelationType={Recommend:1,Share:2,Invite:3},SyncOperationType={UpRelation:1,DownRelation:2},RelationRewardRequireType={None:0,Level:1,Recharge:2},RewardSendType={Email:1,Push:2},OperationType={Act_Share:1,Act_AppDownload:2,Act_ShouCangYouLi:3,Act_GuanZhuGongZhongHao:4,Act_ShiMingRenZheng:5,Act_EnterIntoByGongZhongHao:8,Act_XYX_AUTHORIZE_BINDING_GZH:9},DailyRechargeLevel={First:10,Second:30,Third:50,Fourth:100},ChatMsgSourceType={Player:1,System:2},ManorType={City:1,Suburb:2,Cancel:3,InitData:4},ManorCancelType={Self:1,Other:2,Init:3,End:4},ManorBattleRecordType={Attack:1,Defense:2},ManorQualityType={Normal:1,Legend:2,Epic:3},ManorMapType={Normal:1,Safe:2},ManorRewardType={personal:1,guild:2},RechargeType={Recharge:1,MonthCard:2,PurchaseGiftBag:3,WeekGift:4,MonthGift:5,EnjoyCard:6,DiscountGiftBag:7,TriggerGifts:8,BraveBook:9,BraveBookLevel:10,WholeLifeCard:11,DailyLuxuryGifts:12,OneYuanGifts:13,NewYearWeekCrad:14,NewBraveBook:15,ZoneBoss:16,BasicHeroGifts:17,WishGifts:18,NewGrowFund:19,RechargeItem:20,PushGiftBag:21,BlessingBox:22,SecondDailyGifts:23,SecondLevelReward:24,ThirdLevelReward:25,LimitNumGift:26,HonorOrder:27},LuckyMoneyStatus={WaitingSend:1,HaveSend:2,Empty:3},PushRewardSource={EggRewardActivity:1,HangUpDrop:2,Redeem:3,RiskEvent:4,ZoneAuctionCostReturn:5,ZoneAuctionBid:6,GmCost:7},AdvancedRotateRewardType={Buff:1,Loot:2,Time:3,Entity:4,Revenge:5},SystemMessageShow={Broadcast:1,ChatChannel:2,BroadChatChannel:3},SystemMessageTrigger={event:1,time:2},UnlockType={Level:0,VipLevel:1,LevelOrVipLevel:2,LevelAndVipLevel:3,GuildLevel:4,ChampionNum:5,Task:6,VipLevelTask:7,HeroLevel:8,ServerOpenDay:9,Enable:999,LevelAndServerOpenDay:10,LevelAndGuildLevelAndServerOpenDay:11},QuoraResult={QuoraResultWin:1,QuoraResultFail:2,QuoraResultOverTime:3},QuoraStatus={QuoraStatusClose:1,QuoraStatusAnswered:2,QuoraStatusAnswering:3},EFightCapChangeSource={ChangeFormation:1},UseTaskUnlockType={Module:1,Pokemon:2},WeChatTargetType={Share2Friend:-3,Regular:0,Champion:2,Arena:5,ObtainFiveStarHero:9,RiskAxe:10,RiskClear:12},HeroProfessionType={Common:0,Warrior:1,Enchanter:2,Pastor:3,Assassinator:4,Hunter:5,Pet:6},HeroProfessionSubType={Common:0,DefenseWarrior:101,MadWarrior:102,ElementEnchanter:201,RiotEnchanter:202,WizardEnchanter:203,FetePastor:301,Warlock:302,RiotHunter:501,NightHunter:502},HeroRaceType={Common:0,Human:1,Orc:2,Elf:3,Athanasy:4,Demon:5,Eldar:6,Pet:7},HeroUpStarCostType={Appoint:1,Condition:2,Color:3},HeroArtifactUpStarCostType={Appoint:1,Condition:2},HeroEquipKind={Normal:1,Suit:2},HeroEquipType={Weapon:1,Armour:2,Shoe:3,Ornament:4},HeroEquipColor={White:1,Green:2,Blue:3,Purple:4,Orange:5,Red:6,Gold:7,DarkGold:8},HeroArtifactCostType={Appoint:1,Condition:2},HeroArtifactType={Normal:1,Exp:2,AdvanceExp:3},GashaponType={Lower:1,High:2,Race:3,Friend:4},GashaponSubType={Human:1,Orc:2,Elf:3,Athanasy:4,DemonAndEldar:5},TreasureJewelType={Atk:1,Life:2,Crit:3,Parry:4},TeamExpeditionType={Master:1,Boss:2},WorldKingRewardType={Level:1,LevelAccount:2,BattleTimes:3,SingleLevel:4},ServerBossRewardType={Hurt:1,ChallengeTimes:2},ChallengeEventType={Empty:1,Box:2,DoubleDice:3,OnearmBandit:4,PlayFinger:5,Ahead:6,Backward:7,Move:8,Stop:9,Ending:10,AttackBoss:11,Box2:12},ChallengeEffectType={DoubleDice:1},RiskDifficultyType={Normal:0,Difficulty:1},RiskEventType={None:0,Creep:1,Fortress:2,Maze:3,Tavern:4,Shop:5,Box:6,Quora:7,Mine:8,Hinder:9,Gate:10,Start:11,Npc:12,Select:13,Collect:14,FingerGame:15,GuessSize:16,Trigger:17,Recharge:18,StoryCreep:19,BoxCreep:20,Trigger2:21,MysticalShop:22,Manor:23,Task:24,StormWarCreep:25},RiskTrigger2Type={FlipCard:1,Unicursal:2,Puzzle:3,Sieve:4},FingerGameType={Rock:1,Scissors:2,Paper:3},GuessSizeType={Big:1,Small:2},RiskShopType={Normal:1,Refresh:2},GateType={Any:1,UpOne:2,UpTwo:3,DownOne:4,DownTwo:5,Quit:6,start:7},RiskDataType={Creep:1,Fortress:2,Maze:3,Box:6,Npc:7,Mine:8,Main:13},RiskNodeType={Risk:1,Fortress:2,Maze:3},RiskTaskStatus={UnGot:0,Got:1,Finish:2},GuildWarStatus={NotOpen:0,Close:1,Enroll:2,Adjust:3,Battle:4,Wait:5,UnEnroll:6,WaitBattle:7,BattleEnd:8},TeamArenaStatus={NotOpen:0,Close:1,Enroll:2,Adjust:3,Battle:4,Wait:5,UnEnroll:6,WaitBattle:7,BattleEnd:8,MatchAdjust:9,MatchBattle:10,MatchWaitBattle:12,Rest:13},TeamArenaTeamStatus={UnEnroll:1,Match:2,NoInEliminate:3,UnEliminate:4,Eliminated:5},TriggerGiftsTriggerType={HeroUpStar:2,TeamLevelUp:3},RiskMineType={PlayerExp:1,HeroExp:2,Gold:3,Diamond:4,Artifact:5,Equip:6},EItemUseType={None:0,Direct:1,Compound:2,Prompt:3,Jump:4},CommentType={GiveLike:1,Comment:2,CommentGiveLike:3},HeroChallengeModel={OneVsOne:1,ThreeVsThree:2,SixVsSix:3},HeroHaloType={Race:1,Profession:2},HaloType={Normal:1,Chess:2},EWchessRoomStatus={ToMatch:1,Matching:2,Matched:3,Handle:4,Battle:5,ChickenDinner:6},HeroEquipDecomposeType={Allowable:0,Forbidden:1},EHaleAttrType={Atk:1,Life:2,Defence:3,Speed:4,Anger:5,Crit:11,CritHurt:12,Toughness:13,Hit:14,Miss:15,HurtRate:16,FreeHurtRate:17,Precise:18,Parry:19,ParryCoff:20,FreeControl:21,ArmorBreak:22,SockBlood:23,AntiInjury:24,Crue:25,BeCrue:26,SkillHurt:27,BeSkillHurt:28,SkillHurtAdd:29,SkillHurtFree:30,InitAngerFront:31,InitAngerAll:32,BloodResume:33,BloodResumeMaxLifeRatio:34},ZoneAuctionInfoPType={Refresh:1,Account:2,Bidding:3,Bid:4},AuctionItemStatus={Bidding:1,Bid:2},ZoneAuctionRewardPType={Reward:1,CostReturn:2},HeroEquipCompoundType={Normal:1,ProfessionSuit:2,ProfessionSuitReplacement:3},EZoneBossStatusType={NotUnlock:1,Unlock:2,Kill:3,RealKill:4},EZoneBossTaskType={HighGashaponTimes:101,RaceGashaponTimes:102,TouchGoldHandTimes:103,SmithyTimes:104,GuildCollectHeroExp:105,GuildCollectGold:106,ArenaChallengeTimes:107,ChallengeTimes:108,ChallengeCycleTimes:109,RefreshShopRefreshTimes:110,RefreshShopBuyTimes:111,ServerBossTimes:112,TeamExpeditionTimes:113,ServerBossLifeNum:114,GiveFriendPokeBall:115,GuildCollectFourStar:116,HeroChallengeCheckPointNum:201,WorldKingTotalGrade:202,ChampionCheckPointNum:301,RiskFortressNum:302,GuildTranscriptCheckPointNum:303,PlayerTotalLevel:304,TeamExpeditionCheckPointNum:305,HeroPutOnTotalLevel:401,GuildSkillTotalLevel:402,HeroPutOnTotalStar:403},EChessAchieveType={NumBloodCheckenDinner:1,LessNumHaloCheckenDinner:2,OuHuang:3,LessNumHeroCheckenDinner:4,PerfectBody:5,FirstWin:6,MoreNumHundredCheckenDinner:7,CostMoreNumCheckenDinner:8,MassExplosion:9,WchessRank:10,MoreNumHaloCheckenDinner:11,RecommendLineupCheckenDinner:12,AllRaceHerosNumStar:13,LessNumBloodWin:14,OneBloodWin:15,RacimolareHaloCheckenDinner:16,TurnTheTide:17,DestinyOuHuang:18,RefreshCostLessNumCheckenDinner:19,MoreSixtyThousandHurt:20,NoLessThreeCostCheckenDinner:21,WinningStreak:22,CumulativeCheckenDinner:23,TotalGameTimes:24,EightHeroNumTimesCheckenDinner:25,StabilizingTopThree:26},EGiftType={CareerGift:1,DailyGift:2,HolidayGift:3,VipGift:4},ChatFilterResult={Normal:0,Shield:1,Warning:2},ManorPlayerCoordinateChangeType={Normal:0,Battle:1,ManorDisapper:2,NoHero:3},ManorRewardShowType={Normal:0,Low:1,Middle:2,High:3},ERaceTowerType={Human:1,Orc:2,Elf:3,Athanasy:4,DemonNEldar:5},ERoleKeepType={Normal:1,Rollback:2},HeroEquipMasterType={Upgrade:1,Enchant:2,Quenchce:3},FishingActivityOper={ChangeRod:1,ChangeBait:2,ChangeCreel:3,Snatch:4,Revenge:5,StartFishing:6,BuySnatch:7,GetFish:8,RefreshSnatchList:9},VestagePointStatus={UnPassed:1,Passed:2,Just:3,Success:4,Fail:5},VestageEventType={Empty:0,Unknown:1,Creep:2,Shop:3,Box:4,Campsite:5,CureLife:6,UpHeroStar:7},VestageCreepType={Normal:2001,Elite:2002,Boss:2003},VestagePropType={Gold:1,Buff:2,LifePotion:3,AngerPotion:4,ResuscitatedPotion:5,BuffPotion:6,GoldBuff:7,StoreBuff:8,ReduceLife:9,IncreaseLife:10},VestageItemUseType={None:1,Direct:2,Prompt:3},VestageChoiceType={Empty:0,Cost:2,Reward:3,Event:4},VestageResultSubType={None:0,AddLife:1,MinusLife:2,MinusGold:3,GetHero:4,GetBuff:5,GetPotion:6,GetGold:7},VestageProcessType={SelectInitHero:1,GetStartedBuff:2,EnterMap:3},StormWarPlayerStatus={Normal:1,Battle:2},WishTreeOper={SetWishId:1,Wish:2},MagpieEventType={Empty:0,Box:1,FingerGame:2,Talk:3,Item:4,Gift:5,GuessSize:6},MagpiePointStatus={Finish:4,NotFinish:5},MagpieActivityOper={TriggerEvent:1,ThrowDice:2,BuyCount:3,GetAchievement:4,BuyGift:5},MagpieAchieveType={Collect:1,FinishRound:2,ThrowDiceTimes:3,ChatWith:4},TribeBattleAchieveType={SelfAchieve:1,GuildAchieve:2},SkillEffectType={Single:-1,Normal:0,Race:1,Profession:2},FashionMasterType={Level:1},RoleSkillUnlockType={Or:0,And:1},NationalAchieveType={Collect:1,HGrade:2,JGrade:3},SkillStealType={Steal:1,BeSteal:2},TopFarmBuild={Farm:1,Market:2,Research:3,Collect:4},TopFarmWork={Worm:1,Water:2,Fat:3},TopFarmResearchSkillUnlockType={GuildLevel:1,ResearchLevel:2},DoubleElevenPlace={Hero:1,Artifact:2,Equip:3,Horse:4,Pet:5,Role:6},ImmortalBaptizeAttrType={Fixed:1,Percent:2},ImmortalMarketSortType={Normal:1,Price:2},HeroEquipImproveType={Promotion:1,Recast:2},MemAndDbExpeditionType={DbIsMore:1,DataValid:2,MemIsMore:3},ECardGameStatus={NoStart:1,End:2,Deal:3,BeforeBattle:4},PetUpGradeType={UpGrade:0,Feed:1,FeedSlowly:2},CourtshipStatusType={None:0,Courtship:1,Apply:2,Success:3},FriendLootType={Loot:1,Drive:2,DriveSoftly:3},FlowerEvents={Worm:1,Cut:2,Soil:3},BaseClass=function(){function e(){}return e.getInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=this;return i._instance||(i._instance=new(i.bind.apply(i,[void 0].concat(e)))),i._instance},e}();__reflect(BaseClass.prototype,"BaseClass");var BaseView=function(t){function e(){var e=t.call(this)||this;return e._CLASS_NAME_="BaseView",e.isCreateComplete=!1,e._popActionType=0,e._removeActionType=0,e.checkForGuide=!0,e.guideEffectWait=!1,e.curGuideAvailable=!1,e.EVENT_GUIDE_AVAILABLE="EVENT_GUIDE_AVAILABLE",e.registerNotices=[],e.percentWidth=100,e.percentHeight=100,e.scaleX=Utils.DeviceUtils.additionScale(),e.scaleY=Utils.DeviceUtils.additionScale(),Utils.DebugUtils.isDebug&&(window._a=e),e.once(egret.Event.REMOVED_FROM_STAGE,e.onDestroy,e),e.once(egret.Event.REMOVED_FROM_STAGE,e.removeNotice,e),e}return __extends(e,t),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【"+this.skinName+"】："].concat(e))},e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.isCreateComplete=!0,this.guideEffectWait||egret.setTimeout(function(){e&&e.parent&&e.setGuideAvailable()},this,200)},e.prototype.onOtherPanelPopup=function(e){},e.prototype.setUpdateParamsAfterCreated=function(e,t){var i=this;this.once(eui.UIEvent.CREATION_COMPLETE,function(){t&&t(),i.updateView(e,!0)},this)},e.prototype.setGuideAvailable=function(){this.curGuideAvailable=!0,this.dispatchEventWith(this.EVENT_GUIDE_AVAILABLE)},e.prototype.setGuideCB=function(e){this.curGuideAvailable?e():this.once(this.EVENT_GUIDE_AVAILABLE,e,this)},e.prototype.adaptForGuide=function(e){if(e){var t=this.skin;for(var i in t){var o=t[i];o instanceof eui.Scroller&&e&&(o.scrollPolicyH=o.scrollPolicyV=eui.ScrollPolicy.OFF)}var n=game.GameMVC.mainMed.mainUI;n&&(n.vs_top_left.visible=!1)}},e.prototype.viewType=function(){return this._CLASS_NAME_},e.prototype.getParentView=function(){},e.prototype.updateView=function(e,t){void 0===t&&(t=!1),this.updateNotice()},e.prototype.perClose=function(){},e.prototype.perShow=function(e){return!0},e.prototype.getRes=function(e){var t=null;return e._source&&"string"==typeof e._source&&(t=e._source),e._icon&&"string"==typeof e._icon&&(t=e._icon),t},e.prototype.getAllRes=function(e){if(0==egret.is(e,"egret.DisplayObjectContainer"))return[];for(var t=new Array,i=0;i<e.numChildren;i++)this.getRes(e.getChildAt(i))&&t.push(this.getRes(e.getChildAt(i))),t=t.concat(this.getAllRes(e.getChildAt(i)));return t},e.prototype.destroyAllRes=function(){for(var e=this.getAllRes(this).filter(function(e,t,i){return i.indexOf(e)==t}),t=0;t<e.length;t++)RES.destroyRes(e[t])&&egret.log("RES.destroyRes res=",e[t])},e.prototype.onDestroy=function(){},e.prototype.updateNotice=function(){NoticeManager.updateNotice(this.registerNotices)},e.prototype.removeNotice=function(){this.registerNotices.forEach(function(e){NoticeManager.removeNoticeListener(e)})},e.prototype.popActionType=function(){return this._popActionType},e.prototype.removeActionType=function(){return this._removeActionType},e.prototype.hide=function(t){try{this.mediator.hideSubView(this)}catch(e){PopUpManager.removePopUp(this,void 0,t)}},e}(eui.Component);__reflect(BaseView.prototype,"BaseView");var SDKMgr=function(t){function e(){var e=t.call(this)||this;return e.performConfig={},e.needNodeRecrod=!1,e.gIAPRate=void 0,e.gIAPSuffix=void 0,e.gIAPIcon=void 0,e}return __extends(e,t),e.prototype.isSH=function(){return 0==Utils.agentConfig.AgentCode.indexOf("wechat_bh_sh")},e.prototype.getPerformConfig=function(e){if(1!=e&&null!=this.performConfig[e])return this.performConfig[e];var t=!1;return Utils.agentConfig.isChecking&&(0==e?t=Utils.agentConfig.isChecking.ResChange:5==e?t=Utils.agentConfig.isChecking.ResChange_Login:1==e?(t=Utils.agentConfig.isChecking.Recharge,null!=getUrlKV().isCheckingRecharge&&(t=t&&getUrlKV().isCheckingRecharge),Utils.agentConfig.isChecking.RECHARGE_FORCER_CLOSE_BY_OS_CODE&&null!=Utils.agentConfig.isChecking.RECHARGE_FORCER_CLOSE_BY_OS_CODE[Utils.DeviceUtils.getPlatform()]&&(t=Utils.agentConfig.isChecking.RECHARGE_FORCER_CLOSE_BY_OS_CODE[Utils.DeviceUtils.getPlatform()])):2==e?t=Utils.agentConfig.isChecking.PHP:3==e?t=Utils.agentConfig.isChecking.Coupon:4==e?t=Utils.agentConfig.isChecking.ReqSDKPayTips:6==e?(t=Utils.agentConfig.isChecking.EffectYange,"test"==Utils.agentConfig.AgentCode&&(t=0==Utils.MathUtils.getRandomInt(0,1))):7==e?t=Utils.agentConfig.isChecking.DelayPopNoticePanel:8==e?t=Utils.agentConfig.isChecking.HideLoginLogo:9==e?t=Utils.agentConfig.isChecking.SwitchZzq:10==e?t=Utils.agentConfig.isChecking.SwitchAvatar:11==e?t=Utils.agentConfig.isChecking.FPS:12==e?t=Utils.agentConfig.isChecking.PopUpdateLog:13==e?t=Utils.agentConfig.isChecking.CheckTextVaildCommon:14==e?t=Utils.agentConfig.isChecking.CheckTextVaildRename:15==e?t=Utils.agentConfig.isChecking.Switch_ShouCangYouLi:16==e?(t=Utils.agentConfig.isChecking.Switch_Share,null!=getUrlKV().Switch_Share&&(t=t&&getUrlKV().Switch_Share)):17==e?t=Utils.agentConfig.isChecking.CloseGuide:18==e?t=Utils.agentConfig.isChecking.CloseAutoLoginWhenNoRole:19==e?t=Utils.agentConfig.isChecking.RechargePopGZGZH:45==e?t=Utils.agentConfig.isChecking.HIDE_PLAYER_RENAME:47==e?t=Utils.agentConfig.isChecking.HIDE_GUILD_NOTICE_MODIFY:46==e?t=Utils.agentConfig.isChecking.HIDE_GUILD_RENAME:20==e?t=Utils.agentConfig.isChecking.ForceMaintainTips:21==e?t=Utils.agentConfig.isChecking.RechargeHideRechargeAct:51==e?t=Utils.agentConfig.isChecking.HAS_RECHARGE_ACT_CODE:22==e?t=Utils.agentConfig.other.LoginBgRes:23==e?t=Utils.agentConfig.isChecking.HideSysSetting:36==e?t=Utils.agentConfig.isChecking.ForceCloseFilter:24==e?t=Utils.agentConfig.isChecking.GuildPost:25==e?t=Utils.agentConfig.isChecking.ShowLoginInfo:26==e?t=Utils.agentConfig.other.ShowLoginInfoDetail:27==e?t=Utils.agentConfig.isChecking.HideAllFenXiangWord:28==e?t=Utils.agentConfig.isChecking.HideKefuBtn:29==e?t=Utils.agentConfig.isChecking.HideSwitchLoginBtn:30==e?t=Utils.agentConfig.isChecking.RenameReplaceLegal:32==e?t=Utils.agentConfig.isChecking.HideChatSend:20001==e?t=Utils.agentConfig.isChecking.check_isqqxyx:31==e?t=Utils.agentConfig.isChecking.HideSwitchPerformanceBtn:33==e?t=Utils.agentConfig.isChecking.CloseAuthorize:10018==e?t=Utils.agentConfig.isChecking.isQQ:10021==e?t=Utils.agentConfig.isChecking.isExtra:34==e?t=Utils.agentConfig.isChecking.HideAccountBtn:1016==e?(t=Utils.agentConfig.isChecking.SwitchMicDownload,null!=getUrlKV().SwitchMicDownload&&(t=t&&getUrlKV().SwitchMicDownload)):1026==e?(t=Utils.agentConfig.isChecking.SwitchGuanzhu,null!=getUrlKV().SwitchGuanzhu&&(t=t&&getUrlKV().SwitchGuanzhu)):200009==e?t=Utils.agentConfig.other.GZGZH_NOTICE_LBS_CONFIG:2016==e?t=Utils.agentConfig.isChecking.HideShareFriendConnect:35==e?t=Utils.agentConfig.other.TimeEachSendYQM:200001==e?t=Utils.agentConfig.other.ADS_IMG_ARR:200004==e?t=Utils.agentConfig.other.FIRST_GUIDE_END_IMG_ARR:37==e?t=!0:38==e?t=Utils.agentConfig.isChecking.SWITCH_DUNGEON:39==e?t=Utils.agentConfig.isChecking.SWITCH_CHOUKA_SHUOMING:40==e?t=Utils.agentConfig.isChecking.SWITCH_MULTI_GUAJI:200002==e?t=Utils.agentConfig.other.GZGZH_FULL_PIC:41==e?t=Utils.agentConfig.isChecking.SWITCH_FLOW_WINDOW:200003==e?t=Utils.agentConfig.other.LOGO_PIC:42==e?t=Utils.agentConfig.isChecking.SWITCH_USER_XIEYI:43==e?t=Utils.agentConfig.isChecking.SWITCH_MIC_KILL_POCESS_WHEN_RESTART:44==e?t=Utils.agentConfig.isChecking.HIDE_PINGLUN:200005==e?t=Utils.agentConfig.other.GZGZH_NAME:200007==e?t=Utils.agentConfig.other.GZGZH_VIEW_TYPE:200006==e?t=Utils.agentConfig.other.GZGZH_FULL_PIC_EXIT:200008==e?t=Utils.agentConfig.other.GZGZH_ENTRANCE_NAME:20002==e?t=Utils.agentConfig.isChecking.QQXYX_REDBAG_TIME:48==e?t=Utils.agentConfig.isChecking.SWITCH_XYX_AUTHORIZE_BINDING_GZH:49==e?t=Utils.agentConfig.isChecking.SWITCH_XYX_KEFU_GIFT:50==e&&(t=Utils.agentConfig.isChecking.SWITCH_CERTIFICATE)),this.performConfig[e]=t},e.prototype.extraFuncForAgent=function(e){return!1},Object.defineProperty(e.prototype,"globalIAPRate",{get:function(){return null==this.gIAPRate&&(Utils.agentConfig.other&&Utils.agentConfig.other.gIAPRate?this.gIAPRate=Number(Utils.agentConfig.other.gIAPRate):this.gIAPRate=1),this.gIAPRate},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalIAPSuffixLen",{get:function(){return this.gIAPSuffix.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalIAPSuffix",{get:function(){return null==this.gIAPSuffix&&(Utils.agentConfig.other&&Utils.agentConfig.other.gIAPSuffix?this.gIAPSuffix=Utils.agentConfig.other.gIAPSuffix:this.gIAPSuffix="元"),this.gIAPSuffix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalIAPIcon",{get:function(){return null==this.gIAPIcon&&(Utils.agentConfig.other&&Utils.agentConfig.other.gIAPIcon?this.gIAPIcon=Utils.agentConfig.other.gIAPIcon:this.gIAPIcon=""),this.gIAPIcon},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCloseIAPByAgent",{get:function(){return 1==getUrlKV().isCheckingRecharge},enumerable:!0,configurable:!0}),e}(BaseClass);__reflect(SDKMgr.prototype,"SDKMgr");var BaseFull=function(t){function e(){var e=t.call(this)||this;return e._CLASS_NAME_="BaseFull",e}return __extends(e,t),e.prototype.viewType=function(){return this._CLASS_NAME_},e.prototype.getParentView=function(){return GameRootLayer.gameLayer().mainLayer},e}(BaseView);__reflect(BaseFull.prototype,"BaseFull"),EPropertyType.EPropertyTypeArena;var _h,_j,_k,_l,_m,_o,_p,_q,_r,GuideConditionType={PLAYER:0,FORTRESS:1,VIEW:2,HERO:3,BAG:4,TASK:5,GACHA:6,GUIDE:7,FIGHT:8,EQUIP:9,RISK:10,TOWER:12,RECHARGE:14},GuideConditionSubType={PLAYER_LEVEL_MATCH:1,FORTRESS_ID_DONE:10,FORTRESS_ID_UNDONE:11,VIEW_STACK:20,VIEW_STACK_NOT:21,VIEW_CUR_RISK_TYPE:22,HERO_HAS_HERO_LEVEL_GREATER:30,HERO_HAS_HERO_SECTION_GREATER:31,HERO_POS_OCCUPY:32,HERO_CUR_SELECTED:33,HERO_VIEW_CUR_INDEX:34,HERO_HAS_FREE:35,HERO_NO_SUBTYPE_ON_FORM:36,BAG_HAS_ENOUGH:40,BAG_ONE_TYPE_HAS_ENOUGH:41,BAG_VIEW_CUR_INDEX:42,BAG_CHIP_AVAILABLE:43,BAG_EQUIP_AVAILABLE:44,BAG_ARTIFACT_AVAILABLE:45,TASK_GUIDE_TASK_CUR_CODE:50,TASK_GUIDE_TASK_STATUS:51,GACHA_HTIMES:60,GUIDE_RECODRD:70,GUIDE_FLOW_TARGET:71,GUIDE_FLOW_COND:72,FIGHT_RESULT:80,EQUIP_POS_HAS_STH:90,EQUIP_POS_GEM_LEVEL:91,EQUIP_ALL_MIN_LEVEL:92,RISK_EVENT_EXIST:100,RISK_EVENT_COMPLETE:101,RISK_CUR_POS:102,ACTIVITY_OPEN:110,TOWER_LEVEL_PASS:120,UNLOCK_ID_UNLOCK:130,FIRST_RECHARGE_OPEN:140},GuideOperationType={BUTTON_TAP:1,DRAG:2,MAP_GUIDE:3,EVENT_INTERACT:4},TaskStatus={UNDONE:0,DONE:1,RECEIVE:2},AttrConfig=((_a={})[EAttrType.Atk]={name:"攻击",icon:"_hero_ar_m_json.common_shuxing_gongji"},_a[EAttrType.Atk+1e3]={name:"全体攻击",icon:"_hero_ar_m_json.common_shuxing_gongji"},_a[EAttrType.Life]={name:"生命",icon:"_hero_ar_m_json.common_shuxing_shengming"},_a[EAttrType.Life+1e3]={name:"全体生命",icon:"_hero_ar_m_json.common_shuxing_shengming"},_a[EAttrType.Defence]={name:"防御",icon:"_hero_ar_m_json.common_shuxing_fangyu"},_a[EAttrType.Defence+1e3]={name:"全体防御",icon:"_hero_ar_m_json.common_shuxing_fangyu"},_a[EAttrType.Speed]={name:"速度",icon:"_hero_ar_m_json.common_shuxing_sudu"},_a[EAttrType.Speed+1e3]={name:"全体速度",icon:"_hero_ar_m_json.common_shuxing_sudu"},_a[EAttrType.Anger]={name:"怒气",icon:void 0},_a[EAttrType.Anger+1e3]={name:"全体怒气",icon:void 0},_a[EAttrType.Crit]={name:"暴击率",icon:void 0},_a[EAttrType.Crit+1e3]={name:"全体暴击率",icon:void 0},_a[EAttrType.CritHurt]={name:"暴击伤害率",icon:void 0},_a[EAttrType.CritHurt+1e3]={name:"全体暴击伤害率",icon:void 0},_a[EAttrType.Toughness]={name:"抗暴率",icon:void 0},_a[EAttrType.Toughness+1e3]={name:"全体抗暴率",icon:void 0},_a[EAttrType.Hit]={name:"命中率",icon:void 0},_a[EAttrType.Hit+1e3]={name:"全体命中率",icon:void 0},_a[EAttrType.Miss]={name:"闪避率",icon:void 0},_a[EAttrType.Miss+1e3]={name:"全体闪避率",icon:void 0},_a[EAttrType.HurtRate]={name:"增伤",icon:void 0},_a[EAttrType.HurtRate+1e3]={name:"全体增伤",icon:void 0},_a[EAttrType.FreeHurtRate]={name:"免伤",icon:void 0},_a[EAttrType.FreeHurtRate+1e3]={name:"全体免伤",icon:void 0},_a[EAttrType.Precise]={name:"精准率",icon:void 0},_a[EAttrType.Precise+1e3]={name:"全体精准率",icon:void 0},_a[EAttrType.Parry]={name:"格挡率",icon:void 0},_a[EAttrType.Parry+1e3]={name:"全体格挡率",icon:void 0},_a[EAttrType.ParryCoff]={name:"格挡强度",icon:void 0},_a[EAttrType.ParryCoff+1e3]={name:"全体格挡强度",icon:void 0},_a[EAttrType.FreeControl]={name:"免控率",icon:void 0},_a[EAttrType.FreeControl+1e3]={name:"全体免控率",icon:void 0},_a[EAttrType.ArmorBreak]={name:"破甲",icon:void 0},_a[EAttrType.ArmorBreak+1e3]={name:"全体破甲",icon:void 0},_a[EAttrType.SockBlood]={name:"吸血",icon:void 0},_a[EAttrType.SockBlood+1e3]={name:"全体吸血",icon:void 0},_a[EAttrType.AntiInjury]={name:"反伤",icon:void 0},_a[EAttrType.AntiInjury+1e3]={name:"全体反伤",icon:void 0},_a[EAttrType.Crue]={name:"治疗效果",icon:void 0},_a[EAttrType.Crue+1e3]={name:"全体治疗效果",icon:void 0},_a[EAttrType.BeCrue]={name:"被治疗效果",icon:void 0},_a[EAttrType.BeCrue+1e3]={name:"全体被治疗效果",icon:void 0},_a[EAttrType.SkillHurt]={name:"技能系数加成",icon:void 0},_a[EAttrType.SkillHurt+1e3]={name:"全体技能系数加成",icon:void 0},_a[EAttrType.BeSkillHurt]={name:"受伤技能系数",icon:void 0},_a[EAttrType.BeSkillHurt+1e3]={name:"全体受伤技能系数",icon:void 0},_a[EAttrType.SkillHurtAdd]={name:"技能增伤",icon:void 0},_a[EAttrType.SkillHurtAdd+1e3]={name:"全体技能增伤",icon:void 0},_a[EAttrType.BuffControl]={name:"控制率",icon:void 0},_a[EAttrType.FreeHurtRate2]={name:"最终免伤",icon:void 0},_a[EAttrType.Tenacity]={name:"韧性",icon:void 0},_a[EAttrType.Tenacity+1e3]={name:"全体韧性",icon:void 0},_a),ChessAttrConfig=((_b={})[EHaleAttrType.InitAngerFront]={name:"前排初始怒气",icon:void 0},_b[EHaleAttrType.InitAngerAll]={name:"全体初始怒气",icon:void 0},_b),ProfessionConfig=((_c={})[0]={name:"",icon:""},_c[HeroProfessionType.Assassinator]={name:"刺客",icon:""},_c[HeroProfessionType.Enchanter]={name:"法师",icon:"_hero_ar_m_json.common_icon_zhiye_fashi"},_c[HeroProfessionType.Warrior]={name:"战士",icon:"_hero_ar_m_json.common_icon_zhiye_zhanshi"},_c[HeroProfessionType.Hunter]={name:"游侠",icon:"_hero_ar_m_json.common_icon_zhiye_youxia"},_c[HeroProfessionType.Pastor]={name:"牧师",icon:"_hero_ar_m_json.common_icon_zhiye_mushi"},_c),SubProfessionConfig=((_d={})[0]={name:"",icon:""},_d[HeroProfessionSubType.DefenseWarrior]={name:"防战",icon:"_hero_ar_m_json.common_icon_zhiye_fangzhan",haoloIcon:"halo_11_png"},_d[HeroProfessionSubType.MadWarrior]={name:"狂战",icon:"_hero_ar_m_json.common_icon_zhiye_kuangzhan",haoloIcon:"halo_12_png"},_d[HeroProfessionSubType.ElementEnchanter]={name:"元素师",icon:"_hero_ar_m_json.common_icon_zhiye_yuansu",haoloIcon:"halo_15_png"},_d[HeroProfessionSubType.RiotEnchanter]={name:"魔导师",icon:"_hero_ar_m_json.common_icon_zhiye_modao",haoloIcon:"halo_16_png"},_d[HeroProfessionSubType.WizardEnchanter]={name:"巫师",icon:"_hero_ar_m_json.common_icon_zhiye_wushi",haoloIcon:"halo_17_png"},_d[HeroProfessionSubType.FetePastor]={name:"祭司",icon:"_hero_ar_m_json.common_icon_zhiye_jisi",haoloIcon:"halo_18_png"},_d[HeroProfessionSubType.Warlock]={name:"术士",icon:"_hero_ar_m_json.common_icon_zhiye_shushi",haoloIcon:"halo_19_png"},_d[HeroProfessionSubType.RiotHunter]={name:"猎魔",icon:"_hero_ar_m_json.common_icon_zhiye_liemo",haoloIcon:"halo_13_png"},_d[HeroProfessionSubType.NightHunter]={name:"夜行者",icon:"_hero_ar_m_json.common_icon_zhiye_yexingzhe",haoloIcon:"halo_14_png"},_d),GachaTypeInfo=((_e={})[GashaponType.Lower]={name:"低级招募"},_e[GashaponType.High]={name:"高级招募"},_e[GashaponType.Race]={name:"种族招募"},_e),HeroRaceConfig=((_f={})[0]={name:"",raceIcon:"",raceIconBig:"",bgSrc:"yingxiong_bg_3_png",baseSrc:"yingxiong_dizuo_3_png",haoloIcon:"halo_01_png"},_f[HeroRaceType.Human]={name:"人族",raceIcon:"_hero_ar_m_json.common_icon_zhiyexiaotubiao_1",raceIconBig:"_hero_ar_m_json.common_icon_zhongzu_1",bgSrc:"yingxiong_bg_3_png",baseSrc:"yingxiong_dizuo_3_png",haoloIcon:"halo_01_png"},_f[HeroRaceType.Orc]={name:"兽族",raceIcon:"_hero_ar_m_json.common_icon_zhiyexiaotubiao_2",raceIconBig:"_hero_ar_m_json.common_icon_zhongzu_2",bgSrc:"yingxiong_bg_4_png",baseSrc:"yingxiong_dizuo_4_png",haoloIcon:"halo_02_png"},_f[HeroRaceType.Athanasy]={name:"不死族",raceIcon:"_hero_ar_m_json.common_icon_zhiyexiaotubiao_3",raceIconBig:"_hero_ar_m_json.common_icon_zhongzu_3",bgSrc:"yingxiong_bg_2_png",baseSrc:"yingxiong_dizuo_2_png",haoloIcon:"halo_04_png"},_f[HeroRaceType.Elf]={name:"精灵族",raceIcon:"_hero_ar_m_json.common_icon_zhiyexiaotubiao_4",raceIconBig:"_hero_ar_m_json.common_icon_zhongzu_4",bgSrc:"yingxiong_bg_1_png",baseSrc:"yingxiong_dizuo_1_png",haoloIcon:"halo_03_png"},_f[HeroRaceType.Demon]={name:"魔族",raceIcon:"_hero_ar_m_json.common_icon_zhiyexiaotubiao_5",raceIconBig:"_hero_ar_m_json.common_icon_zhongzu_5",bgSrc:"yingxiong_bg_6_png",baseSrc:"yingxiong_dizuo_6_png",haoloIcon:"halo_06_png"},_f[HeroRaceType.Eldar]={name:"神族",raceIcon:"_hero_ar_m_json.common_icon_zhiyexiaotubiao_6",raceIconBig:"_hero_ar_m_json.common_icon_zhongzu_6",bgSrc:"yingxiong_bg_5_png",baseSrc:"yingxiong_dizuo_5_png",haoloIcon:"halo_05_png"},_f[HeroRaceType.Pet]={name:"宠物",raceIcon:"_hero_ar_m_json.common_icon_zhiyexiaotubiao_2",raceIconBig:"_hero_ar_m_json.common_icon_zhongzu_2",bgSrc:"yingxiong_bg_2_png",baseSrc:"yingxiong_dizuo_2_png",haoloIcon:"halo_02_png"},_f),COMPONENT_ENUM={LABEL:1,IMAGE:2},NUM_TO_ROMAN_NUM={1:"Ⅰ",2:"Ⅱ",3:"Ⅲ"},SKILL_CODE={0:"normalSkill",1:"actSkill",2:"posSkill1",3:"posSkill2",4:"posSkill3",5:"posSkill4"},DAILY_COPY_DIFFICULT_ICON={1:"nandu_icon_1_png",2:"nandu_icon_2_png",3:"nandu_icon_3_png",4:"nandu_icon_4_png",5:"nandu_icon_5_png",6:"nandu_icon_6_png",7:"nandu_icon_7_png",8:"nandu_icon_8_png",9:"nandu_icon_9_png",10:"nandu_icon_10_png"},CommonIconStyle={BOTTOM:1,RIGHT:2},DefaultValue={avatar:"head_016_2",pokemon:"40100100"},COLOR_2_FRAME={0:"",1:"_border_m_json.common_img_pinzhikuang_1",2:"_border_m_json.common_img_pinzhikuang_2",3:"_border_m_json.common_img_pinzhikuang_3",4:"_border_m_json.common_img_pinzhikuang_4",5:"_border_m_json.common_img_pinzhikuang_5",6:"_border_m_json.common_img_pinzhikuang_6",7:"_border_m_json.common_img_pinzhikuang_9",8:"_border_m_json.common_img_pinzhikuang_10"},SPRITE_COLOR_2_FRAME={0:"",1:"common_img_touxiangkuang15_png",2:"common_img_touxiangkuang14_png",3:"common_img_touxiangkuang13_png",4:"common_img_touxiangkuang13_png",5:"common_img_touxiangkuang13_png",6:"common_img_touxiangkuang13_png",7:"common_img_touxiangkuang13_png"},COLOR_2_FONT_COLOR={1:16777215,2:1761866,3:1416959,4:11608317,5:16688896,6:16714810,7:16775225,8:16775575},COLOR_CONFIG=((_g={})[EColorType.EColorTypeWhite]={name:"白色"},_g[EColorType.EColorTypeGreen]={name:"绿色"},_g[EColorType.EColorTypeBlue]={name:"蓝色"},_g[EColorType.EColorTypePurple]={name:"紫色"},_g[EColorType.EColorTypeOrange]={name:"橙色"},_g[EColorType.EColorTypeRed]={name:"红色"},_g[EColorType.EColorTypeLegend]={name:"金色"},_g[EColorType.EColorTypeDarkGold]={name:"暗金"},_g),MAIL_STATUS_ICON={0:"mail_img_weikaiqi_png",1:"mail_img_yikaiqi_png",2:"mail_img_weilingqulibao_png",3:"mail_img_yilingqulibao_png"},SEX_HEAD={1:"main_img_touxian_01_png",2:"main_img_touxian_02_png"},EQUIP_COLOR_NAME_IMG={1:"equip_txt_bai_png",2:"equip_txt_lv_png",3:"equip_txt_lan_png",4:"equip_txt_zi_png",5:"equip_txt_cheng_png",6:"equip_txt_hong_png"},EQUIP_PART_ICON={1:"equip_txt_mz_png",2:"equip_txt_sy_png",3:"equip_txt_kz_png",4:"equip_txt_st_png",5:"equip_txt_xz_png",6:"equip_txt_sp_png"},CHAMPION_GROUP_RES={shenlin:[["champion_beijing_1_png","champion_beijing_2_png","champion_beijing_3_png"],["champion_shui_png","champion_shui_png","champion_shui_1_png"],["champion_caodi_png","champion_caodi_png","champion_caodi_png","champion_caodi_png","champion_caodi_png","champion_caodi_png","champion_caodi_2_png","champion_caodi_1_png"],["champion_caocong_png","","","","","","champion_taijie_png"]],shamo:[["champion_shamo_beijing_2_png","champion_shamo_beijing_1_png"],["champion_shamo_5_png","champion_shamo_5_png","champion_shamo_4_png"],["champion_shamo_1_png","champion_shamo_1_png","champion_shamo_1_png","champion_shamo_1_png","champion_shamo_1_png","champion_shamo_1_png","champion_shamo_2_png","champion_shamo_3_png"],["champion_shamo_xianrenzhang_png","","","","","","champion_shamo_taijie_png"]]},EXPLORED_BUILDING_RES=["xunluo_bg_jianzhu_5_png","xunluo_bg_jianzhu_4_png","xunluo_bg_jianzhu_3_png","xunluo_bg_jianzhu_2_png","xunluo_bg_jianzhu_1_png"],EXPLORED_BACKGROUND_RES=["xunluo_bg_1_jpg","xunluo_bg_2_jpg","xunluo_bg_3_jpg","xunluo_bg_4_jpg"],GUIDE_QIANQI_END_LEVEL=10,MAP_GUIDE_START_CODE=10,MAP_GUIDE_END_CODE=10,GUIDE_WELCOME_CONTENT=[["欢迎来到\n口袋妖怪的世界！","大木博士"],["这个世界上有被称为精灵的\n不可思议的生物","大木博士"],["_EFFECT_","大木博士"],["我们和精灵一起生活\n互相帮助，完成艰难的任务","大木博士"],["听我说了这么多\n能先告诉我关于你的事情吗？","大木博士"],["_MAKE_ROLE_","大木博士"],["欢迎你，%s ！\n属于你的故事即将开始！","大木博士"],["现在就开始吧！\n向着精灵的世界出发！",""]],GUIDE_EVO_AFTER_CATCH={40101300:40105700,40100200:40102600,40102400:40107600},GUIDE_SPECIAL_DISMISS_WHEN_WAIT_STEP={},GUIDE_SPECIAL_FLOW={CATCH:2051,CATCH2:1008,WORLD_MAP:2161,TUJIAN:3021,TUJIAN_ZUIGAOPINZHI:1010,JINHUA:3001},GUIDE_ILLUSTRATE={40101300:40101300,40100200:40100200,40102400:40102400},GUILD_AVATAR_RES=["_guild_m_json.gonghui_icon_qizhi01","_guild_m_json.gonghui_icon_qizhi02","_guild_m_json.gonghui_icon_qizhi03","_guild_m_json.gonghui_icon_qizhi04","_guild_m_json.gonghui_icon_qizhi05","_guild_m_json.gonghui_icon_qizhi06","_guild_m_json.gonghui_icon_qizhi07","_guild_m_json.gonghui_icon_qizhi08","_guild_m_json.gonghui_icon_qizhi09","_guild_m_json.gonghui_icon_qizhi10","_guild_m_json.gonghui_icon_qizhi11","_guild_m_json.gonghui_icon_qizhi12","_guild_m_json.gonghui_icon_qizhi13","_guild_m_json.gonghui_icon_qizhi14","_guild_m_json.gonghui_icon_qizhi15","_guild_m_json.gonghui_icon_qizhi16","_guild_m_json.gonghui_icon_qizhi17","_guild_m_json.gonghui_icon_qizhi18"],GUILD_POSITION_NAME=["未加入公会","成员","副会长","会长"],MID_EFFECT_RES={qianghua:{text:"强化成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_ji_png"},jinjie:{text:"进阶成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_jie_png"},shengxing:{text:"升星成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_xing_png"},fumo:{text:"附魔成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_ji_png"},duanzao:{text:"锻造成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_jie_png"},shengji:{text:"升级成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_ji_png"},jihuo:{text:"激活成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_ji_png"},baoshi:{text:"宝石提升",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_ji_png"},peiyang:{text:"培养成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_ci_png"},jinhua:{text:"进化成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_ji_png"},tupo:{text:"突破成功",effect_src:"common_fumo",effect_name:"common_fumo",type_src:"common_txz_ji_png"}},MID_EFFECT_RES_SECOND={jihuo:{effect_src:"common_tujian"},tupo:{effect_src:"common_tupo"}},HARM_TIPS_RES={1:"_fight_m_json.fight_txt_xiaoguobuhao",2:"_fight_m_json.fight_txt_yiban",3:"_fight_m_json.fight_txt_youxiaoguo",4:"_fight_m_json.fight_txt_xiaoguojuejia"},HARM_TIPS_TEXT={1:"效果不好！",2:"效果一般！",3:"效果很好！",4:"效果绝佳！"},BOSS_POS_CONFIG={0:{index:0,startPoint:[4,5],standPoint:[4,6],dir:1},1:{index:1,startPoint:[6,5],standPoint:[6,6],dir:1},2:{index:2,startPoint:[9,8],standPoint:[8,8],dir:2},3:{index:3,startPoint:[9,10],standPoint:[8,10],dir:2},4:{index:4,startPoint:[4,13],standPoint:[4,12],dir:3},5:{index:5,startPoint:[6,13],standPoint:[6,12],dir:3},6:{index:6,startPoint:[1,8],standPoint:[2,8],dir:0},7:{index:7,startPoint:[1,10],standPoint:[2,10],dir:0},8:{index:8,startPoint:[9,8],standPoint:[8,8],dir:1}},CHAT_RANDOM_CONTENT=["眼前的非不是非，快来帮我聚一波欧气吧！","自从玩了这个游戏，我也是家里有矿的人了。","小小魔物算个球，快来瞻仰哥的英姿吧。","稀有英雄这么好抽，你不来试试手气？","我与BOSS的差距，就差一个你，等你！","也许你不知道，这里都是朕为你打下的江山。","千层魔塔的重点在哪，我想与你一起见证。","放置游戏也能激情四射，快来与我并肩作战吧。","一支穿云箭，千军万马来相见，速来支援！","好东西就要分享，兄弟们一起来战吧！"],ECharactorType={ECharactorQinFen:1,ECharactorKaiLang:2,ECharactorYongGan:3,ECharactorRenZhen:4,ECharactorChenZhuo:5,ECharactorHaiXiu:6},BADGE_LOCATION_ENUM={LEFT_TOP:0,RIGHT_TOP:1,LEFT_BOTTOM:2,RIGHT_BOTTOM:3,CENTER:4},GUILD_POST_INFO=["注意种族克制，战前换阵能有奇效","战斗中怒气集满可释放神器技能，一旦释放甚至可能扭转战局","公会采集可获得海量的高价值的奖励哦","冒险世界的探险，可遇见很多趣味的事情哦","英雄的星级越高，属性越强大哦","好友每天可以互赠友情点哦","神器激活后，佩戴后可以在战斗中释放超炫技能哦"],UNIQUE_REQ={},LOADING_TIPS=["注意种族克制，战前换阵能有奇效","战斗中怒气集满可释放神器技能，一旦释放甚至可能扭转战局","公会采集可获得海量的高价值的奖励哦","冒险世界的探险，可遇见很多趣味的事情哦","占领多个同样的矿产资源，提高产出效率哦","矿产资源有累计上限哦，别忘回来收菜啦","英雄的星级越高，属性越强大哦","好友每天可以互赠友情点哦","神器激活后，佩戴后可以在战斗中释放超炫技能哦","竞技场每天21点结算排名奖励","限时挑战通关就能获得神秘大礼哦","找不到目标，不知道做什么？不妨跟着红点一起走哦","多多收集英雄，激活羁绊一飞冲天","组队副本太难怎么办，让我们紧跟大神，老司机带带我","时空之门可把英雄置换成自己想要的英雄哦"],ACTIVITY_ENTRANCE={ACTIVITY:1,JINGCAI:2,HEFU:3,HOLIDAY:4,HOLIDAY2:5,HOLIDAY3:6,HOLIDAY4:7},GOAL_REWARD_DESC=((_h={})[ModuleGoalType.ArenaRank]="竞技场历史最高达到第%d名",_h[ModuleGoalType.Champion]="通关冠军之路第%d层",_h[ModuleGoalType.EdenCatch]="今日沙狐乐园捕捉%d次",_h[ModuleGoalType.Boss]="今日神兽挑战%d次",_h[ModuleGoalType.HandbookLevel]="图鉴总等级达到%d级",_h[ModuleGoalType.Gym]="通关%s",_h[ModuleGoalType.RefreshShop]="今日神秘商店刷新%d次",_h[ModuleGoalType.Fortress]="关卡挑战通关%d关",_h[ModuleGoalType.BattleSubway]="战斗地铁通关第%d关",_h[ModuleGoalType.GuildFortress]="公会副本通关%d章",_h[ModuleGoalType.ServerBossPlayerHonor]="今日世界BOSS个人荣誉达到%d",_h[ModuleGoalType.GuildLevelRank]="当前公会排名达到%d名",_h[ModuleGoalType.PlayerLevel]="玩家达到%d级",_h[ModuleGoalType.PlayerFightCap]="总战力达到%s战力",_h[ModuleGoalType.TeamFortress]="组队副本通过%d关",_h[ModuleGoalType.WorldKingLevel]="争霸赛达到%s段位",_h[ModuleGoalType.WildEncounter]="遭遇战当天挑战次数",_h[ModuleGoalType.ChallengeTeamCount]="天空塔挑战%d次",_h[ModuleGoalType.ChallengeRocketCount]="火箭军团挑战%d次",_h[ModuleGoalType.BattleZoneArenaBattle]="跨服竞技场挑战%d次",_h),REWARD_STATUS={AVAILABLE:1,CANBUY:2,GO_RECHARGE:3,UNAVAILABLE_BUY:4,UNAVAILABLE:5,RECEIVED:6,HASBUY:7,NEXT_REWARD:1008},COMMON_DIRECTION={UP:1,RIGHT:2,DOWN:3,LEFT:4},SOUND_EFF_TYPE={btn_tap:"sound_btn_tap_mp3",btn_tap_error:"sound_btn_tap_error_mp3",sound_beibao:"sound_beibao_mp3",sound_beibaohuanye:"sound_beibaohuanye_mp3",sound_chouka:"sound_chouka_mp3",sound_chouka_wuxingka:"sound_chouka_wuxingka_mp3",sound_dianjin:"sound_dianjin_mp3",sound_jiaobu:"sound_jiaobu_mp3",sound_jinjie:"sound_jinjie_mp3",sound_shengji:"sound_shengji_mp3",sound_shengli:"sound_shengli_mp3",sound_shengxing:"sound_shengxing_mp3",sound_shibai:"sound_shibai_mp3",sound_view_close:"sound_view_close_mp3"},SOUND_BGM_TYPE={zhu_cheng:"bgm_zhucheng_mp3",zhan_dou:"bgm_zhandou_mp3"},ACTIVITY_COMMON_UI_STYLE={baseItemScale:.72,img_oper:.8},BADGE_STATUS={ACTIVE:1,LEVEL_UP:2,ADVANCED:3,MAX_LEVEL:4},SHOP_NOT_ALLOW_TIPS={0:"无锁",1:"人物等级不足",2:"VIP等级不足",3:"竞技场排名不足",4:"公会等级不足",5:"未通关指定关卡",6:"未通关指定关卡",7:"探险时长不足",8:"未通关该道馆",9:"未达到该段位",10:"未满足通关层数",11:"累计挑战次数不足",12:"累计扭蛋次数不足"},ONLY_VIP=!0,HATCH_COLOR_PIC={3:"boss_icon_dan_06_png",4:"boss_icon_dan_09_png",5:"boss_icon_dan_03_png",6:"boss_icon_dan_05_png"},CHANGE_ARRAY_TYPE={HAVE:1,IS_NULL:2,LOCK:3},ACTIVITY_TO_MODULE={27:238,45:581,21:500},MULTI_CAMP_TO_COLOR={1:16722766,2:16771584,3:50943},MULTI_CAMP_TO_NAME={1:"红队",2:"黄队",3:"蓝队"},MULTI_CAMP_TO_SOURCE={1:"kuafu_img_yingdi_hong_png",2:"kuafu_img_yingdi_huang_png",3:"kuafu_img_yingdi_lan_png"},GUILD_NOTICE_LIMIT=["公会诚邀各位玩家，致敬最铁的我们。","是兄弟，就来战，一起打造属于我们最强的公会。","傲于天下，永不言败。兄弟情义，重聚在此。","本公会对各位给力玩家敞开大门，欢迎各位精灵训练师前来，共创辉煌。","公会有大量福利，希望各位活跃玩家前来，积极完成公会任务，打造第一公会。","我们都是精灵爱好者，不求第一，但求最好，欢迎各位玩家加入我们。","春夏秋冬，我们一直都会陪伴，这是属于我们暖心的家。","任他时光飞逝，也挡不住我们之间的热情，在这里，大家都是好朋友。"],EQUIPTYPE_TO_NAME=((_j={})[HeroEquipType.Weapon]="武器",_j[HeroEquipType.Armour]="铠甲",_j[HeroEquipType.Shoe]="鞋子",_j[HeroEquipType.Ornament]="饰品",_j),MODEL_ACTION_NAME={DJ:"daiji",GJ:"gongji",SJ:"shouji"},ROLE_ACTION_NAME={DJ:"daiji",PB:"paobu",GJ:"gongji",SJ:"shouji"},ROLE_ACTION_NAME_WHILE_H=((_k={})[ROLE_ACTION_NAME.DJ]="daiji_h",_k[ROLE_ACTION_NAME.PB]="daiji_h",_k[ROLE_ACTION_NAME.GJ]="gongji_h",_k[ROLE_ACTION_NAME.SJ]="shouji_h",_k),ROLE_STYLE={Fashion:1,Horse:2,Title:4,Magical:8},DETAIL_VIEW_SHOW_TYPE={ROLE:1,BACKPACK:2,OTHER:3},HEROTHING_ATTR_STYLE=[{size:21,textColor:15913814},{size:21,textColor:16775908},{size:21,textColor:16714810},{size:21,textColor:1761866},{size:21,textColor:9539985},{size:21,textColor:15913814}],TREASURE_ICON_NAME=((_l={})[TreasureJewelType.Atk]=["item_baoshi_01_png","攻击宝石"],_l[TreasureJewelType.Life]=["item_baoshi_02_png","生命宝石"],_l[TreasureJewelType.Crit]=["item_baoshi_03_png","暴击宝石"],_l[TreasureJewelType.Parry]=["item_baoshi_04_png","格挡宝石"],_l),TEAMEXPEMAP_POS={zdyz_bg_ditu_png:[[285,1003],[299,827],[489,747],[363,637],[115,667],[35,507],[215,406],[465,360],[338,245],[159,247]]},MAP_EP_TYPE_NAME={0:"空",1:"怪物",2:"副本",3:"迷宫",4:"酒馆",5:"商店",6:"宝箱",7:"答题npc",8:"矿产",9:"障碍",10:"传送门",11:"起点",12:"NPC",13:"选择奖励",14:"收集",15:"猜拳",16:"猜大小",17:"机关",20:"宝箱怪",21:"机关2",23:"矿战的矿",101:"BOSS",102:"怪物",103:"大怪物",104:"ICON",105:"大怪物2"},MAP_EP_TYPE_IMG_MNM={0:"",1:"_guaji_m_json.maoxian_icon_xiaoguai",2:"_guaji_m_json.maoxian_icon_fuben",3:"_guaji_m_json.maoxian_icon_migong",4:"_guaji_m_json.maoxian_icon_jiuguan",5:"_guaji_m_json.maoxian_icon_shangdian",6:"_guaji_m_json.maoxian_icon_baoxiang",7:"_guaji_m_json.maoxian_icon_datinpc",8:"_guaji_m_json.maoxian_icon_kuang",9:"",10:"_guaji_m_json.maoxian_icon_chuansongmen",11:"",12:"_guaji_m_json.maoxian_icon_duihuanpc",13:"_guaji_m_json.maoxian_icon_duihuanpc",14:"_guaji_m_json.maoxian_icon_duihuanpc",15:"_guaji_m_json.maoxian_icon_duihuanpc",16:"_guaji_m_json.maoxian_icon_duihuanpc",18:"_guaji_m_json.maoxian_icon_duihuanpc",19:"_guaji_m_json.maoxian_icon_xiaoguai",20:"_guaji_m_json.maoxian_icon_baoxiang",21:"_guaji_m_json.maoxian_icon_datinpc",22:"_guaji_m_json.maoxian_icon_shangdian",23:"_guaji_m_json.maoxian_icon_kuang",24:"_guaji_m_json.maoxian_icon_datinpc",101:"_guaji_m_json.maoxian_icon_guaiwu",102:"_guaji_m_json.maoxian_icon_guaiwu"},MAP_EP_GATE_IMG=((_m={})[GateType.Any]="_guaji_m_json.bd_rukou_01",_m[GateType.UpOne]="_guaji_m_json.bd_rukou_03",_m[GateType.UpTwo]="_guaji_m_json.bd_rukou_03",_m[GateType.DownOne]="_guaji_m_json.bd_rukou_03",_m[GateType.DownTwo]="_guaji_m_json.bd_rukou_03",_m[GateType.Quit]="_guaji_m_json.bd_rukou_01",_m),BASEITEM_SOURCE={BACKPACK:1,OTHER:2},PROPERTY_2_KEY=((_o={})[EPropertyType.EPropertyTypeDiamond]="diamond",_o[EPropertyType.EPropertyTypeGold]="gold",_o[EPropertyType.EPropertyTypeArena]="arena",_o[EPropertyType.EPropertyTypeDevote]="devote",_o[EPropertyType.EPropertyTypeBossHonor]="worldKingHonor",_o[EPropertyType.EPropertyTypeExpedition]="expedition",_o[EPropertyType.EPropertyTypeIntegralShop]="integralShopIntegral",_o[EPropertyType.EPropertyTypeSoul]="soul",_o[FriendGoodType.FriendPokeBall]="friendIntimacy",_o),HERO_SORT_ORDER=((_p={})[HeroProfessionType.Warrior]=1,_p[HeroProfessionType.Hunter]=2,_p[HeroProfessionType.Enchanter]=3,_p[HeroProfessionType.Pastor]=4,_p[HeroProfessionType.Assassinator]=5,_p),BTN_ICON_NOTICE_POS={percentX:.725,percentY:10/94},DB_SKIP_CACHE_FRAME={zhujiao_01:1,zhujiao_02:1,kuangren_1:1,kuangren_2:1,common_chouka:1,common_chouka_1:1,common_chouka_2:1,common_kapianfanzhuan:1,common_jiazai:1,common_sj:1,common_zhandouli:1,common_zhanbai_1:1,common_shengli_2:1,common_miwu:1,common_choukayingxiong:1,zhujiemian_bstz:1,zhujiemian_jjtz:1,zhujiemian_yxzh:1,denglu_01:1,denglu_02:1,common_dianji:1},FadeRiskEventType={Boss:101,Creep:102,BigBoss:103,ICON:104,BigBoss2:105},SHARE_RESOURCE_FILTER={},ZZQ_CONST={QIANPAI_NUM:3,SHANGZHEN_NUM:8,CARDS_NUM:5,BEIBAO_NUM:12,BEIBAO_LINE_EACH_COUNT:6,DAOJISHI_RED:5,TOUCH_AS_CLICK:200},DEEP_NEST_CONST={BEIBAO_LINE:2,SHANGZHEN_LINE:3,HERO_COUNT:6,TOUCH_TIME:150},MULTI_TEAM_MODULE_NAME=((_q={})[MODULE.AbyssLair]="深渊巢穴",_q[MODULE.Manor]="矿战",_q),G_REWARD_NAME=["rewards","heros","heroEquips","heroArtifacts","pets","maps"],ENTITY_2_NAME=((_r={})[EEntityType.EEntityTypeHero]="英雄",_r[EEntityType.EEntityTypeHeroEquip]="装备",_r[EEntityType.EEntityTypeHeroArtifact]="圣物",_r[EEntityType.EEntityTypeTreasure]="宝物",_r[EEntityType.EEntityTypePet]="宠物",_r),HERO_TIER_IMG_TAG=["_hero_ar_m_json.common_img_chuanshuo","_hero_ar_m_json.common_img_jingying","_hero_ar_m_json.common_img_xiyou"],PEAK_WAR_TYPE={FREE:1,FREE_END:5,HIGH:2,HIGH_WAITING:3,HIGH_END:4},HOLDER_CONST={COMMON_CARD_NUM:6,HAND_CARD_NUM:6,LINE_EACH_COUNT:3,SHINE_IN:50,SHINE_IN_HOLD:600,SHINE_IN_RESET:250},BasePanel=function(t){function e(){var e=t.call(this)||this;return e._popActionType=1,e._CLASS_NAME_="BasePanel",e}return __extends(e,t),e.prototype.viewType=function(){return this._CLASS_NAME_},e.prototype.getParentView=function(){return GameRootLayer.gameLayer().panelLayer},e}(BaseView);__reflect(BasePanel.prototype,"BasePanel");var BaseTab=function(t){function e(){var e=t.call(this)||this;return e._CLASS_NAME_="BaseTab",e}return __extends(e,t),e.prototype.viewType=function(){return this._CLASS_NAME_},e.prototype.getParentView=function(){return GameRootLayer.gameLayer().tabLayer},e}(BaseView);__reflect(BaseTab.prototype,"BaseTab"),function(e){var t=(i.prototype.update=function(e){this.isExpire=!1,this.isInited=!0},i.updateArr=function(e,t,i){if(Array.isArray(e)){for(var o=0,n=0,a=e;n<a.length;n++){var r=a[n];t[o]?t[o].update(r):t.push(new i(r)),o++}t.splice(o)}},i);function i(){}e.BaseVO=t,__reflect(t.prototype,"game.BaseVO");var o,n=(__extends(a,o=t),a.prototype.iAmClean=function(){this.isDirty=!1},a.prototype.isDiff=function(e){if(!e||!this.caseDirtyKeys)return!0;for(var t=!1,i=0,o=this.caseDirtyKeys;i<o.length;i++){var n=o[i];if(this[n]&&"object"==typeof this[n]){if(this[n].isDiff&&this[n].isDiff(e[n])){t=!0;break}if(!this[n].isDiff){for(var a="string"==typeof e[n]?JSON.parse(e[n]):e[n],r=0,s=Object.keys(a);r<s.length;r++){var c=s[r];if(this[n][c]!=a[c]){t=!0;break}}if(t)break}}else if(this[n]!=e[n]){t=!0;break}}return t},a);function a(){return null!==o&&o.apply(this,arguments)||this}e.DirtyValueVO=n,__reflect(n.prototype,"game.DirtyValueVO")}(game=game||{}),function(o){var i,e=(__extends(n,i=BaseMediator),Object.defineProperty(n.prototype,"rootView",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.BackpackUI),this.addSubView(n.SV.DECOMPOSE,o.DecomposeUI),this.addSubView(n.SV.HEROROLLBACKVIEW,o.HeroRollBackView),this.addSubView(n.SV.BACKPACK_PANEL,o.BackpackPanel),this.addSubView(n.SV.DECOMPOSE_PANEL,o.DecomposePanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.BACKPACK_UPDATE,CN.LOGIN_FINAL_DONE,CN.GENERAL_PASS_DAY,CN.BACKPACK_MULTI_TEAM_UPDATE,CN.CHANGE_PANEL]},n.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView(),this.removeFromParent(),this.rootView&&(this.rootView.visible=!1);break;case CN.GENERAL_PASS_DAY:case CN.LOGIN_FINAL_DONE:this.backpackProxy.GetPlayerItem(),this.backpackProxy.GetTeamInfo(),this.backpackProxy.GetDecomposeInfo();break;case CN.BACKPACK_UPDATE:o.AppFacade.getInstance().updateView(n.N,n.SV.MAIN);break;case CN.BACKPACK_MULTI_TEAM_UPDATE:this.backpackProxy.resetHeroUuid2ModuleTeamCache();break;case CN.CHANGE_PANEL:var i=this.getSubView(n.SV.DECOMPOSE);if(!i)return;t&&t.isRemove?i.onOtherPanelPopup(!1):i.onOtherPanelPopup(!0)}},n.prototype.handleNotice=function(){},n.N="BackpackMediator",n.SV={MAIN:1,DECOMPOSE:2,HEROROLLBACKVIEW:3,BACKPACK_PANEL:4,DECOMPOSE_PANEL:5},n);function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.backpackProxy=o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N),t}o.BackpackMediator=e,__reflect(e.prototype,"game.BackpackMediator")}(game=game||{}),function(c){var i,e=(__extends(l,i=BaseMediator),l.prototype.initNotice=function(){},l.prototype.initSubView=function(){this.addSubView(l.SV.COMMON_SHOP,c.ShopUI),this.addSubView(l.SV.SHOP_BUY_NUM,c.ShopBuyNumView),this.addSubView(l.SV.REFRESH_SHOP,c.ShopRefreshView),this.addSubView(l.SV.SHOP_SELL_NUM,c.ShopSellNumView),this.addSubView(l.SV.REFRESH_SHOP_PANEL,c.ShopRefreshPanel)},l.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.SHOP_GET_ALL_DATA,CN.SHOP_OPEN_BY_TYPE,CN.SHOP_INFO_UPDATE,CN.PLAYER_LEVEL_UP,CN.LOGIN_FINAL_DONE,CN.MONEY_UPDATE]},l.prototype.handleNotification=function(e){var t=this,i=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView(),this.removeFromParent();break;case CN.SHOP_GET_ALL_DATA:function o(e){Utils.FlowUtils.insertCbAfterQueue(function(){t.shopProxy.GetShopInfo(ShopType[e],function(){Utils.FlowUtils.updateCbQueue(!0)})})}for(var n in ShopType)o(n);break;case CN.SHOP_OPEN_BY_TYPE:if(!i.shopType)return;this.shopProxy.curShopType=i.shopType;var a=c.Config.shopWork(this.shopProxy.curShopType);this.shopProxy.GetShopInfo(this.shopProxy.curShopType,function(){t.hideSubView(l.SV.COMMON_SHOP),t.hideSubView(l.SV.REFRESH_SHOP),t.hideSubView(l.SV.REFRESH_SHOP_PANEL),i.workType=a.workType,-1!=[ShopWorkType.FreeAndBuyRefresh,ShopWorkType.NoneGridRefresh].indexOf(a.workType)?i.shopType==ShopType.ShopTypeDoubleTwelve||i.shopType==ShopType.ShopTypeSF2020?t.showSubView(l.SV.REFRESH_SHOP_PANEL,i):t.showSubView(l.SV.REFRESH_SHOP,i):t.showSubView(l.SV.COMMON_SHOP,i)});break;case CN.SHOP_INFO_UPDATE:var r=c.Config.shopWork(this.shopProxy.curShopType);-1!=[ShopWorkType.FreeAndBuyRefresh,ShopWorkType.NoneGridRefresh].indexOf(r.workType)?i.shopType==ShopType.ShopTypeDoubleTwelve||i.shopType==ShopType.ShopTypeSF2020?this.updateView(l.SV.REFRESH_SHOP_PANEL,i):this.updateView(l.SV.REFRESH_SHOP,i):this.updateView(l.SV.COMMON_SHOP,i);break;case CN.PLAYER_LEVEL_UP:this.shopProxy.showRefreshShopNotice();case CN.LOGIN_FINAL_DONE:this.shopProxy.GetShopInfo(ShopType.ShopTypeShare);case CN.MONEY_UPDATE:var s;(s=this.getSubView(l.SV.REFRESH_SHOP))&&s.updateView({}),(s=this.getSubView(l.SV.REFRESH_SHOP_PANEL))&&s.updateView({})}},l.prototype.onViewCreate=function(){},l.prototype.handleNotice=function(e){},l.N="ShopyMediator",l.SV={COMMON_SHOP:1,SHOP_BUY_NUM:2,REFRESH_SHOP:3,SHOP_SELL_NUM:4,REFRESH_SHOP_PANEL:5},l);function l(e){void 0===e&&(e=null);var t=i.call(this,l.N,e)||this;return t.shopProxy=c.AppFacade.getInstance().retrieveProxy(c.ShopPy.N),t.initNotice(),t}c.ShopyMediator=e,__reflect(e.prototype,"game.ShopyMediator")}(game=game||{}),function(n){var i,e=(__extends(a,i=BaseMediator),a.prototype.initSubView=function(){this.addSubView(a.SV.CHAT,n.ChatMain)},a.prototype.listNotificationInterests=function(){return[CN.MAIN_CHAT_PRIVATEPLAYER_UPDATE,CN.MAIN_CHAT_UPDATE,CN.LOGIN_FINAL_DONE]},a.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.MAIN_CHAT_PRIVATEPLAYER_UPDATE:(i=this.getSubView(a.SV.CHAT))&&i.updatePrivateChatPlayer();break;case CN.MAIN_CHAT_UPDATE:var i=this.getSubView(a.SV.CHAT);if(t){i&&i.insertItem(t);var o=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N).playerInfoVO.playerId;t.channelType==EChatChannelType.EChatChannelTypePrivate&&t.fromPlayer&&t.fromPlayer.playerId!=o&&(i||Utils.MsgUtils.addPrivateChatPopUp(t.fromPlayer))}i&&i.updateView({}),n.AppFacade.getInstance().retrieveMediator(n.MainMediator.N).handleBanner();break;case CN.LOGIN_FINAL_DONE:this.mainProxy.getAllChatList(),this.mainProxy.getServerBlackList()}},a.N="ChatMediator",a.SV={CHAT:1},a);function a(e){void 0===e&&(e=null);var t=i.call(this,a.N,e)||this;return t.mainProxy=n.AppFacade.getInstance().retrieveProxy(n.MainPy.N),t}n.ChatMediator=e,__reflect(e.prototype,"game.ChatMediator")}(game=game||{});var UTFMsg=function(){function e(){}return e.prototype.receive=function(e){var t=e.readUTF(),i=this.decode(t);return i&&game.AppFacade.getInstance().sendNotification(i.key,i.body),0},e.prototype.send=function(e,t){var i=this.encode(t);i&&(e.type=egret.WebSocket.TYPE_STRING,e.writeUTF(i))},e.prototype.decode=function(e){return egret.log("decode需要子类重写，根据项目的协议结构解析"),null},e.prototype.encode=function(e){return egret.log("encode需要子类重写，根据项目的协议结构解析"),null},e}();__reflect(UTFMsg.prototype,"UTFMsg",["BaseMsg"]);var ModuleStyle=function(){function e(){}return e.LOADING={},e.LOGIN={},e.MAIN={mainUIStyle:65535},e.FIGHT={mainUIStyle:0},e.GUAJI={mainUIStyle:91},e.CITY={mainUIStyle:65535},e.HERO={mainUIStyle:2},e.BACKPACK={mainUIStyle:3},e.GUILD={mainUIStyle:2},e.ZZQ={mainUIStyle:0},e.DUNGEON={mainUIStyle:0},e.HOLDEM={mainUIStyle:0},e}();__reflect(ModuleStyle.prototype,"ModuleStyle");var NT=function(){function t(){}return t.getId=function(){return++t.__id__},t.makeCommonActivityType=function(){for(var e in EActivityType)t.ALL_ACTIVITY[EActivityType[e]]=t.getId()},t.initDynamic=function(){t.makeCommonActivityType()},t.__id__=0,t.LOCAL_RES_UPDATE_SENSITIVE_EVENT=((_a={})[EEntityType.EEntityTypeMoney]={cb:function(){},mediators:[game.ShopyMediator.N]},_a[EEntityType.EEntityTypeExp]={mediators:[]},_a[EEntityType.EEntityTypeItem]={cb:function(){NoticeManager.updateNotice(t.BACKPACK_CHIP)},sub:(_b={},_b[30000027]={cb:function(){NoticeManager.updateNotice(t.SMITHY)},mediators:[]},_b[30000030]={cb:function(){NoticeManager.updateNotice(t.COMMON_SHOP[ShopType.ShopTypeShare])},mediators:[]},_b[30000031]={cb:function(){NoticeManager.updateNotice(t.ALL_ACTIVITY[EActivityType.ActivityGashapon]),NoticeManager.updateNotice(t.ALL_ACTIVITY[EActivityType.ActivityGashapon1])},mediators:[]},_b[30000029]={cb:function(){NoticeManager.updateNotice(t.HERO_THING_COMPOUND)},mediators:[]},_b[30005002]={cb:function(){NoticeManager.updateNotice(t.HERO_DERMA)},mediators:[]},_b[30005001]={cb:function(){NoticeManager.updateNotice(t.HERO_DERMA)},mediators:[]},_b[30005003]={cb:function(){NoticeManager.updateNotice(t.HERO_DERMA)},mediators:[]},_b),mediators:[game.BackpackMediator.N]},_a[EEntityType.EEntityTypeHero]={mediators:[]},_a[EEntityType.EEntityTypeHeroEquip]={mediators:[]},_a[EEntityType.EEntityTypeHeroArtifact]={mediators:[]},_a[EEntityType.EEntityTypeTreasure]={mediators:[]},_a[EEntityType.EEntityTypePet]={mediators:[]},_a),t.HERO_UPSECTION=t.getId(),t.HERO_CAN_FORMATION=[t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId()],t.HERO_UPSTAIR=t.getId(),t.HERO_RESONATE=t.getId(),t.HERO_RESONATE_RESONATE=t.getId(),t.HERO_RESONATE_UNLOCK=t.getId(),t.HERO_EQUIP=[t.getId(),t.getId(),t.getId(),t.getId()],t.HERO_ARTIFACT=t.getId(),t.HERO_ARTIFACT_RESONATE=t.getId(),t.HERO_TREASURE=t.getId(),t.HERO_IMMORTAL=t.getId(),t.HERO_THING=t.getId(),t.HERO_THING_COMPOUND=t.getId(),t.HERO_DERMA=t.getId(),t.HERO_SPIRIT=t.getId(),t.HERO_SPIRIT_ACHIEVEMENT=t.getId(),t.HERO_SPIRIT_PAGE=t.getId(),t.MAGICAL=t.getId(),t.PET=t.getId(),t.PET_UPGRADE=t.getId(),t.PET_SKILL_UPGRADE=t.getId(),t.PET_FEED_ENTRANCE=t.getId(),t.PET_FRIEND_ENTRANCE=t.getId(),t.PET_FRIEND_GIFT=t.getId(),t.PET_FRIEND_CAN_LEAVE=t.getId(),t.PET_BE_LOOTED=t.getId(),t.PET_FEED=t.getId(),t.PET_COURTSHIP_ENTRANCE=t.getId(),t.PET_COURTSHIP_BIRTH=t.getId(),t.VIP_MAIN=t.getId(),t.VIP_ENTRANCE=t.getId(),t.VIP_GIFT=t.getId(),t.GASHA_ENTRANCE=t.getId(),t.STAR_DOOR_ENTRANCE=t.getId(),t.GASHA_FREE=t.getId(),t.GASHA_HIGH_TIMES=t.getId(),t.GASHA_RACE_TIMES=t.getId(),t.GOLDHAND=t.getId(),t.CITY_COPY_ENTRANCE=t.getId(),t.DAILY_COPY=t.getId(),t.EXPEDITION=t.getId(),t.EXPEDITION_REWARD=t.getId(),t.EXPEDITION_CHALLENGE=t.getId(),t.GUILD_MANAGER=t.getId(),t.GUILD_SIGNIN=t.getId(),t.GUILD_APPLY=t.getId(),t.GUILD_INSTANCE=t.getId(),t.GUILD_COLLECT=t.getId(),t.GUILD_WAR=t.getId(),t.GUILD_TRIBE_BATTLE=t.getId(),t.GUILD_TRIBE_BATTLE_CHALLENGE=t.getId(),t.GUILD_TRIBE_BATTLE_REWARD=t.getId(),t.BACKPACK_CHIP=t.getId(),t.TITLE=t.getId(),t.FRIEND=t.getId(),t.FRIEND_GIFT=t.getId(),t.FRIEND_APPLY=t.getId(),t.ACTIVITY_ENTRANCE=[void 0,t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId()],t.ALL_ACTIVITY=[void 0],t.ACTIVITY_EnjoyCard1=t.getId(),t.TASK_ENTRANCE=t.getId(),t.DAILY_TASK=t.getId(),t.ACHIEVEMENT=t.getId(),t.SECOND_ACHIEVEMENT=t.getId(),t.MAIL=t.getId(),t.CHAMPION=t.getId(),t.CHAT_MAIN=t.getId(),t.CHAT_MAIN2=t.getId(),t.CHAT_ZONE=t.getId(),t.CHAT_SAME_SERVER=t.getId(),t.CHAT_GUILD=t.getId(),t.CHAT_PRIVATE=t.getId(),t.COMMON_SHOP=[t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId()],t.BRAVABOOK=t.getId(),t.NEWBRAVABOOK=t.getId(),t.LUCKY_TABLE=t.getId(),t.CITY_PVP_ENTRANCE=t.getId(),t.ARENA=t.getId(),t.ARENA_REWARD=t.getId(),t.ARENA_REWARD_LINQU=t.getId(),t.WORLD_KING=t.getId(),t.WORLD_KING_REWARD=t.getId(),t.WORLD_KING_TIMES_OR_CHEST=t.getId(),t.GLORT_ARENA=t.getId(),t.GLORT_ARENA_CAN_FIGHT=t.getId(),t.TEAM_EXPE_REWARD_ENTRANCE=t.getId(),t.TEAM_EXPE_REWARD=t.getId(),t.TEAM_EXPE_APPLY_CENTER=t.getId(),t.TEAM_EXPE_APPLY_BTN=t.getId(),t.TEAM_BOSS_APPLY_CENTER=t.getId(),t.TEAM_BOSS_APPLY_BTN=t.getId(),t.TEAM_ARENA_ENTRANCE=t.getId(),t.TEAM_ARENA_APPLY=t.getId(),t.TEAM_ARENA_APPLY_CENTER=t.getId(),t.TEAM_ARENA_ENROLL=t.getId(),t.TEAM_ARENA_VOTE=t.getId(),t.SMITHY_ENTRANCE=t.getId(),t.SMITHY=t.getId(),t.WORLD_BOSS=t.getId(),t.WORLD_BOSS_NUM=t.getId(),t.WORLD_BOSS_REWARD=t.getId(),t.GUILD_BOSS=t.getId(),t.GUILD_BOSS_NUM=t.getId(),t.FRIEND_SHARE_REWARD=[t.getId(),t.getId(),t.getId(),t.getId(),t.getId(),t.getId()],t.FRIEND_SHARE_DAY_FIRST_SHARE=t.getId(),t.HERO_CHALLENGE=t.getId(),t.ZZQ_ACHIEVELEVEL=t.getId(),t.DEEP_NEST=t.getId(),t.DEEP_NEST_REWARD=t.getId(),t.DUNGEON=t.getId(),t.MANOR_ENTRANCE=t.getId(),t.CITY_EXT_ENTRANCE=t.getId(),t.STORM_WAR=t.getId(),t.STORM_WAR_ACHIEVE=t.getId(),t.GUAJI_MULTI=t.getId(),t.FASHION=t.getId(),t.FASHION_ACTIVATION=t.getId(),t.FASHION_UPGRADE=t.getId(),t.GUAJI_GZGZH=t.getId(),t.GUAJI_GZGZH2=t.getId(),t.GUAJI_GZGZH3=t.getId(),t.PEAK_WAR=t.getId(),t.PEAK_WAR_REWARD_FREE=t.getId(),t.PEAK_WAR_REWARD_FREE_TAB=t.getId(),t.PEAK_WAR_CHALLENGE=t.getId(),t.MOUNT=t.getId(),t.MOUNT_ACTIVATE=t.getId(),t.MOUNT_UPDATE=t.getId(),t.MOUNT_UPSTAR=t.getId(),t.FARM_SELF_ENTRANCE=t.getId(),t.FARM_SELF_CANCOLLECT=t.getId(),t.SF_LEVEL_REWARD=t.getId(),t.SF_QUORA=t.getId(),t.ACTIVITY_MID_CREAT=t.getId(),t.ACTIVITY_MID_EAT=t.getId(),t.ACTIVITY_MID_GET=t.getId(),t.ACTIVITY_MID_GIFT=t.getId(),t.ACTIVITY_REGRESS_LOGIN=t.getId(),t.ACTIVITY_REGRESS_RECHARGE=t.getId(),t.ALTAR_ENTRANCE=t.getId(),t.ALTAR_ACTIVATE=t.getId(),t.RACETOWER_ENTRANCE=t.getId(),t.RACETOWER_CAN_FIGHT=t.getId(),t}();__reflect(NT.prototype,"NT"),function(e){var t,i=(t=e.BaseVO,__extends(o,t),o.prototype.update=function(e){this.id=e.id,this.life=e.life,this.status=e.status,this.dt=e.dt,this.num=e.num,this.owner=e.owner,this.ownerName=e.ownerName,this.guildName=e.guildName},o);function o(){return t.call(this)||this}e.BossVO=i,__reflect(i.prototype,"game.BossVO")}(game=game||{}),function(e){var i,t=(i=eui.Component,__extends(o,i),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data&&this.updateItem(this.data)},o.prototype.updateItem=function(e){this.data=e;var t=this.data&&this.data.code;if(t){this.gp_item.visible=!0,this.gp_non.visible=!1;var i=game.Config.skillBaseConfig()[t];this.img_icon.source=ResourceUtils.png(i.iconName),i.level&&!e.notNeedLevel?(this.gp_level.visible=!0,this.lb_level.text=i.level.toString()):this.gp_level.visible=!1,null!=this.data.unlock?UIActionManager.setAbsGrey(this.img_icon,!this.data.unlock):UIActionManager.setAbsGrey(this.img_icon,!1),this.data.light?this.gp_effect.numChildren||DragonBoneTools.playOnce({effectName:"common_kejihuo",parent:this.gp_effect,loop:!0}):this.gp_effect.removeChildren()}else this.gp_effect.removeChildren(),this.gp_item.visible=!1,this.gp_non.visible=!0},o.prototype.reset=function(){this.data=void 0,this.gp_item.visible=!0,this.gp_non.visible=!1,this.gp_level.visible=!1,this.img_icon.source="skill_icon_kong_png"},o.prototype.onClick=function(){},o);function o(e){var t=i.call(this)||this;return t.data=e,t.skinName="SkillItemSkin",t}e.SkillItem=t,__reflect(t.prototype,"customui.SkillItem");var n,a=(n=eui.Component,__extends(r,n),r.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this)},r.prototype.updateItem=function(e){var t=e.code;this.skill_item.updateItem({code:t});var i=game.Config.skillBaseConfig()[t];this.lb_name.text=i.name,this.lb_tips.text=e.tips&&""!=e.tips?"("+e.tips+")":"",this.lb_desc.text=i.desc,this.validateNow();var o=Math.ceil(this.lb_desc.text.length/Math.floor(this.lb_desc.width/this.lb_desc.size));if(this.height=o*this.lb_desc.size+(o-1)*this.lb_desc.lineSpacing+140,e.heroVo&&1==i.skillType){var n=game.GameMVC.heroPy.allHeroByUuid,a=void 0;if(n[e.heroVo.uuid])for(var r in n)1==(l=n[r]).pos&&(a=l);else{var s=!1,c=game.GameMVC.heroMutiTeamPy.battleFormationList;for(var r in c){var l=c[r];for(var h in l.heroList)if((p=l.heroList[h]).uuid==e.heroVo.uuid){s=!0;break}if(s)for(var h in l.heroList){var p;if(1==(p=l.heroList[h]).pos){a=p;break}}if(a)break}}if(a){var d=0;0<e.heroVo.defendLevel&&0<a.defendLevel&&(d=e.heroVo.defendLevel<a.defendLevel?e.heroVo.defendLevel:a.defendLevel),this.skillStealComponent?(this.skillStealComponent.visible=!0,this.skillStealComponent.params={code:t,firstOne:a.code,heroCode:e.heroVo.code,isDefend:d,moriDefend:e.heroVo.defendLevel},this.skillStealComponent.caculateSkill(),this.height+=this.skillStealComponent.temHeight+20,this.skillStealComponent.update()):(this.skillStealComponent=new u({code:t,firstOne:a.code,heroCode:e.heroVo.code,isDefend:d,moriDefend:e.heroVo.defendLevel}),this.skillStealComponent.y=170,this.skillStealComponent.horizontalCenter=0,this.gp_root.addChild(this.skillStealComponent),this.height+=this.skillStealComponent.temHeight+20)}else this.skillStealComponent&&(this.skillStealComponent.visible=!1)}else this.skillStealComponent&&(this.skillStealComponent.visible=!1)},r);function r(){var e=n.call(this)||this;return e.skinName="SkillDetailsPanelSkin",e}e.SkillDetailsPanel=a,__reflect(a.prototype,"customui.SkillDetailsPanel");var s,u=(s=eui.Component,__extends(c,s),c.prototype.childrenCreated=function(){s.prototype.childrenCreated.call(this),this.update()},c.prototype.update=function(){var o=this;if(this.gp_skill1){this.gp_skill1.visible=!1,this.gp_skill2.visible=!1;var n=game.Config.skillBaseConfig(),a=1;this.codes.forEach(function(e){if(!(2<a)){var t=n[e];if(t&&2==t.skillType){o["skill_item"+a].updateItem({code:e});var i=game.Config.skillBaseConfig()[e];o["lb_name"+a].text=i.name,o["lb_desc"+a].text=i.desc}o["gp_skill"+a].visible=!0,a++}}),this.baseitem1.updateData({code:this.params.firstOne}),this.baseitem2.updateData({code:this.params.firstOne}),0==this.codes.length?this.lb_noSkill.visible=!0:this.lb_noSkill.visible=!1}},c.prototype.caculateSkill=function(){var o=this;this.temHeight=74,this.codes=[];var e=this.params.code,n=game.Config.skillBaseConfig(),t=(n[e].level,game.Config.allHeroConfig()),i=t[this.params.heroCode].initStar,a=t[this.params.firstOne].initStar,r=this.params.heroCode,s=[];if(this.params.isDefend&&0<this.params.isDefend&&3<=this.params.moriDefend){var c=game.Config.heroDefendConfig(t[this.params.firstOne].subType);s=JSON.parse(c[this.params.isDefend-1].skills)}else{if(a<=i)r=this.params.firstOne;else{var l=t[this.params.firstOne].subType;for(var h in t){var p=t[h];p.subType==l&&p.initStar==i&&(r=p.code)}}s=[t[r].posSkill1,t[r].posSkill2,t[r].posSkill3]}s.forEach(function(e){var t=n[e];t&&2==t.skillType&&(o.codes.push(e),o.temHeight+=104)}),this.codes.forEach(function(e){var t=n[e];if(t&&2==t.skillType){var i=game.Config.skillBaseConfig()[e];o.lb_desc1.text=i.desc,2<o.lb_desc1.numLines&&(o.temHeight+=2*o.lb_desc1.size)}})},c);function c(e){var t=s.call(this)||this;return t.params=void 0,t.temHeight=74,t.codes=[],t.skinName="SkillStealComponent",t.params=e,t.caculateSkill(),t}__reflect(u.prototype,"SkillStealComponent")}(customui=customui||{});var WebMgr=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this.getChannelName()},e.prototype.callJS=function(e){if(egret.log("WebMgr",e),e){var t=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N);game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N);try{var i=JSON.parse(e);switch(i.method){case"loginCB":i.login_ext&&(t.userVO.login_ext=i.login_ext),Utils.isNeedUuidSot?t.userVO.uuid=i.game_uin+"_uuidsot"+Utils.TimerManager.getServerTime():t.userVO.uuid=i.game_uin,i.username?t.userVO.username=Utils.Http.checkStrLegal(i.username,!1,""):t.userVO.username=t.userVO.uuid,t.userVO.verify_token=i.verify_token,t.userVO.login_ext&&t.userVO.login_ext.isCheckingRecharge&&(Utils.agentConfig.isChecking.Recharge=t.userVO.login_ext.isCheckingRecharge),t.goHttpLogin();break;case"buyCB":0===i.payResult?Utils.MsgUtils.addMidMsg("购买成功，请稍后查收邮件"):i.payResultMsg&&""!=i.payResultMsg&&Utils.MsgUtils.addMidMsg(i.payResultMsg);break;case"onGoLogout":case"onGoSwitchUser":break;case"getChannelName":egret.log("getChannelName has set",Utils.agentConfig.channelName,i.channelName),Utils.agentConfig.channelName&&""!=Utils.agentConfig.channelName||(Utils.agentConfig.channelName=i.channelName||"")}}catch(e){egret.log("WebMgr exception",e)}}},e.prototype.goSwitchAccount=function(){this.restart()},e.prototype.onLoginPHPSuccess=function(){},e.prototype.showLoadingTips=function(e,t){},e.prototype.dismissLoading=function(){},e.prototype.goLogin=function(){var n=this;login({cb:function(e){egret.log("html登录回调"),egret.log(getUrlKV()),Utils.SDKMgr.getPerformConfig(50)?200==e.code?n.callJS(JSON.stringify({method:"loginCB",game_uin:getUrlKV().game_uin,username:getUrlKV().username||getUrlKV().game_uin,verify_token:getUrlKV().token,login_ext:getUrlKV().login_ext})):400==e.code&&n.cmd({type:"getCertificationMessage",cb:function(e){var t=e.data&&e.data.realName||"",i=e.data&&e.data.idNumber||"",o=new game.CertificatePanel({name:t,num:i,cb:function(e,t){console.log(e),n.cmd({type:"nameCertification",name:e.name,num:e.num,cb:function(e){e&&200==e.code?(n.goLogin(),t.hide()):Utils.MsgUtils.addMidMsg("认证失败")}})}});PopUpManager.addPopUp({clickDarkClose:!1,obj:o})}}):n.callJS(JSON.stringify({method:"loginCB",game_uin:getUrlKV().game_uin,username:getUrlKV().username||getUrlKV().game_uin,verify_token:getUrlKV().token,login_ext:getUrlKV().login_ext}))}})},e.prototype.invokeLog=function(e){},e.prototype.goPurchase=function(e){sdkPay(e)},e.prototype.restart=function(){restart()},e.prototype.cmd=function(e,t){cmd(e,t)},e.prototype.copyToClipBoard=function(e,t){Utils.DeviceUtils.copyToClipboardByDOM(e,t)},e.prototype.nodeRecord=function(e){this.needNodeRecrod&&nodeRecord(e)},e.prototype.getChannelName=function(){},e.prototype.share=function(e,t){share(e,t),Utils.agentConfig.other&&Utils.agentConfig.other.guideToShare&&Utils.MsgUtils.addMidMsg("请点击右上角完成分享")},e.prototype.addShortcut=function(e,t){},e.prototype.enterFlow=function(e,t){var i=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N),o=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N),n=game.AppFacade.getInstance().retrieveProxy(game.GuildPy.N),a={serverId:i.serverSelect&&i.serverSelect.s_id,serverName:i.serverSelect&&i.serverSelect.s_name,severArea:i.serverSelect&&i.serverSelect.area,playerName:o.playerInfoVO.name||o.roleVo.name,roleId:o.playerInfoVO.playerId||o.roleVo.playerId,roleCreateDt:o.playerInfoVO.createDt||o.roleVo.createDt,time:Utils.TimerManager.getServerTime(),money:o.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeDiamond]||0,level:o.playerInfoVO.level||0,vipLevel:o.playerInfoVO.playerVip.vipLevel||0,fightCap:o.playerInfoVO.fightCap||0,camp:o.playerInfoVO.camp&&1==o.playerInfoVO.camp?"male":"famale",guildId:n.guildDetail?n.guildDetail.guildId:"",guildName:n.guildDetail?n.guildDetail.name:"",params:t};Utils.SDKMgr.cmd({type:"DeliverData",params:{type:e,data:a}})},e.prototype.onCustomError=function(e){},e}(SDKMgr);__reflect(WebMgr.prototype,"WebMgr",["ISDKInterface"]);var BaseProxy=function(i){function e(e){var t=i.call(this,e)||this;return t.name=e,t}return __extends(e,i),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【"+this.name+"】："].concat(e))},e}(puremvc.Proxy);__reflect(BaseProxy.prototype,"BaseProxy",["puremvc.IProxy","puremvc.INotifier"]),function(i){var o,e=(__extends(t,o=BasePanel),t.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.initList(),this.activateComponent(),this.bm_longTap.visible=!!this.params.needLongTap,this.updateView(this.params)},t.prototype.initList=function(){this.ac_list=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_list,this.list_item.itemRenderer=a,this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListItemTap,this)},t.prototype.onListItemTap=function(e){var t=e.item;if(this.params.needLongTap){var i=t.lastTouchTime;if((new Date).getTime()>i+1e3)return(r=e.itemRenderer).baseItem.touchEnabled=!0,r.baseItem.onClick(),void(r.baseItem.touchEnabled=!1)}if(t.info.isLocked){var o="已经被锁住";this.params.lockedTip&&(o="function"==typeof this.params.lockedTip?this.params.lockedTip(t.info):this.params.lockedTip),Utils.MsgUtils.addMidMsg("该"+ENTITY_2_NAME[t.info.entityType]+(o||"已经被锁住"))}else if(this.params.singleChoose){for(var n in this.ac_list.source){var a=this.ac_list.source[n];a.uuid==t.uuid?(a.chosen=!a.chosen,a.chosen?this.selectUuids[0]=t.uuid:this.selectUuids=[]):a.chosen=!1}this.ac_list.replaceAll(this.ac_list.source)}else{var r=e.itemRenderer;0<=this.selectUuids.indexOf(t.uuid)?(t.chosen=!t.chosen,this.selectUuids.splice(this.selectUuids.indexOf(t.uuid),1),this.ac_list.replaceAll(this.ac_list.source)):this.params.checkFull&&this.params.checkFull(this.selectUuids)?Utils.MsgUtils.addMidMsg(this.params.fullTip||"当前已选满"):(t.chosen=!0,this.selectUuids.push(t.uuid),this.ac_list.replaceAll(this.ac_list.source))}},t.prototype.updateView=function(e){var n=this,t=[],i=this.params.getInfos&&this.params.getInfos();this.lb_title.text=this.params.title,i=i||[];var o=this.params.excludeUuids||[];for(var a in i){var r=i[a];if(!(0<=o.indexOf(a))){var s=0<=this.selectUuids.indexOf(a);t.push({uuid:a,chosen:s,isOnlyCode:this.params.isOnlyCode||!1,info:r,source:this.params.source,type:this.params.type||EEntityType.EEntityTypeItem,uniNum:this.params.uniNum})}}t.length?(this.gp_empty.visible=!1,this.btn_confirm.visible=!0,this.params.sortFunc||(this.params.sortFunc=function(e,t){var i=e.info,o=t.info;return i.isLocked!=o.isLocked?i.isLocked?1:-1:n.backpackPy.checkHeroInTeam(i.uuid)&&!n.backpackPy.checkHeroInTeam(o.uuid)?1:!n.backpackPy.checkHeroInTeam(i.uuid)&&n.backpackPy.checkHeroInTeam(o.uuid)?-1:i.code!=o.code?i.code-o.code:i.level-o.level}),t.sort(function(e,t){return n.params.sortFunc(e,t)}),this.ac_list.replaceAll(t)):(this.gp_empty.visible=!0,this.btn_confirm.visible=!1)},t.prototype.activateComponent=function(){this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.opperationParams=this.selectUuids,this.hide()},this)},t.prototype.onDestroy=function(){this.params.noCloseAsConfirm||(this.opperationParams=this.selectUuids),o.prototype.onDestroy.call(this)},t);function t(e){var t=o.call(this)||this;return t.selectUuids=[],t.backpackPy=i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N),t.skinName="HeroUpstarSelectSkin",t.params=e,t.selectUuids=e.selectUuids||[],t}i.CommonChosePanel=e,__reflect(e.prototype,"game.CommonChosePanel");var n,a=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){var e=this;n.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_bi.addChild(this.baseItem),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.data.lastTouchTime=(new Date).getTime()},this)},r.prototype.dataChanged=function(){this.data.isOnlyCode?this.baseItem.updateData({code:this.data.info.code,type:this.data.info.type,num:this.data.info.num}):this.baseItem.updateData({uuid:this.data.info.uuid,type:this.data.type,source:this.data.source}),this.data.uniNum&&(this.baseItem.blb_num.text="1"),this.data.info.isLocked?this.gp_lock.visible=!0:this.gp_lock.visible=!1,this.updateChosen(this.data.chosen),UIActionManager.setGrey(this.gp_bi,!(!this.data.chosen&&!this.data.info.isLocked))},r.prototype.updateChosen=function(e){this.data.chosen=e,this.gp_chosen.visible=e},r);function r(){var e=n.call(this)||this;return e.skinName="CommonChosePanelItem",e}i.CommonChosePanelItem=a,__reflect(a.prototype,"game.CommonChosePanelItem")}(game=game||{}),function(r){var i,e=(__extends(t,i=BasePanel),t.prototype.onOtherPanelPopup=function(e){i.prototype.onOtherPanelPopup.call(this,e),this.gp_content.visible=!e},t.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initList(),this.activateComponent(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cu_resBar),this.gp_content.touchChildren=!0,this.gp_content.scaleX=this.gp_content.scaleY=1,UIActionManager.playUIAction(this.gp_content,1)},t.prototype.initTop=function(){this.initedTOP||this.updatePlayerInfo(),this.initedTOP=!0},t.prototype.initial=function(){this.targetConfig=this.DECOMPOSE_TYPE_CONFIG[this.curType],this.blb_title.text=this.targetConfig.name,this.initFilter(),this.initedUI=!0},t.prototype.initList=function(){this.list_chosenItem.itemRenderer=r.DecomposeUI_ChosenItem,UIActionManager.hideScrollerBar(this.scl_chosenItem),this.list_chosenItem.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.chosenList_onItemTap,this),this.list_item.itemRenderer=r.DecomposeUI_Item,UIActionManager.hideScrollerBar(this.scl_item),this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.itemList_onItemTap,this)},t.prototype.initFilter=function(){var o=this;this.gp_filters_list.removeChildren();var e=this.targetConfig.filterConfig.data;e&&0<e.length?(this.gp_filter.visible=!0,e.forEach(function(e){var t=new eui.List;t.itemRenderer=r.DecomposeUI_FilterItem;var i=new eui.HorizontalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER,t.layout=i,t.dataProvider=new eui.ArrayCollection(e),t.addEventListener(eui.ItemTapEvent.ITEM_TAP,o.filterItem_onItemTap,o),o.gp_filters_list.addChild(t)}),this.gp_filters.height=42*e.length+20*(e.length-1)+40):this.gp_filter.visible=!1},t.prototype.chosenList_onItemTap=function(e){e.item.info&&this.selectItem(e.item.info,!1)},t.prototype.itemList_onItemTap=function(e){(this.targetConfig.checkChoosabel||function(){return!0})(e.item.info)?-1==this.chosenList.indexOf(e.item.info)?this.chosenList.length<this.MAX_NUM&&this.selectItem(e.item.info,!0):this.selectItem(e.item.info,!1):e.item.info.isLocked?e.item.info.getLockedTip?Utils.MsgUtils.addMidMsg(e.item.info.getLockedTip(e.item.info)):Utils.MsgUtils.addMidMsg("已上锁"):e.item.info.pos&&Utils.MsgUtils.addMidMsg("在阵上")},t.prototype.filterItem_onItemTap=function(e){var t=e.itemRenderer;if(this.targetConfig.filterConfig.addFilter(this.curFilter,e.item),!t.chosen)for(var i=0,o=this.gp_filters_list.$children;i<o.length;i++){var n=o[i];if(-1!=n.$children.indexOf(t))for(var a=0,r=n.$children;a<r.length;a++){var s=r[a];s.chosen&&s.setChosen(!1)}}t.setChosen(!t.chosen),this.updateItemList()},t.prototype.selectItem=function(e,t){var i=this.list_item.dataProvider;for(var o in i.source){var n=i.source[o];if(n.info==e){n.chosen=t,i.itemUpdated(n);break}}t?this.chosenList.push(e):this.chosenList.splice(this.chosenList.indexOf(e),1),this.updateChosenList()},t.prototype.updateChosenList=function(){var e=[];for(var t in this.chosenList){var i=this.chosenList[t];e.push({type:this.curType%1e4,info:i})}for(;e.length<this.MAX_NUM;)e.push({});this.list_chosenItem.dataProvider=new eui.ArrayCollection(e)},t.prototype.updateItemList=function(){var e=[],t=this.targetConfig.filterConfig&&this.targetConfig.filterConfig.filterFunc||function(){return!0},i=this.targetConfig.sortFunc||function(){return-1},o=this.targetConfig.getAllInfo(),n=0;if(o)for(var a in o){n+=1;var r=o[a];t(this.curFilter,r)&&e.push({type:this.curType%1e4,info:r,chosen:-1!=this.chosenList.indexOf(r)})}e.sort(i),this.list_item.dataProvider=new eui.ArrayCollection(e),this.lb_num.text=this.targetConfig.name.slice(0,2)+"数量：",this.blb_num.text=e.length+"/"+n},t.prototype.updateView=function(e){var t=!this.curType||e&&e.type&&e.type!=this.curType;this.curType=e&&e.type||this.curType,!this.initedUI||t?(this.chosenList.splice(0),this.initial(),this.initTop(),this.updateView()):(this.updateChosenList(),this.updateItemList(),this.updatePlayerInfo())},t.prototype.autoSelect=function(){if(!(this.chosenList.length>=this.MAX_NUM)){var e=this.list_item.dataProvider.source,t=this.targetConfig.filterConfig&&this.targetConfig.filterConfig.autoFilterFunc||function(){return!0},i=this.targetConfig.checkChoosabel||function(){return!0},o=this.curHasFilter(),n=0;if(e.length)for(var a in e){var r=e[a].info;if(t(r,o)&&i(r)&&-1==this.chosenList.indexOf(r)&&(this.chosenList.push(r),n++,this.chosenList.length>=this.MAX_NUM))break}n?(this.updateItemList(),this.updateChosenList()):Utils.MsgUtils.addMidMsg(this.targetConfig.filterConfig.autoFilterTipsFunc(o))}},t.prototype.curHasFilter=function(){var e=0;for(var t in this.curFilter)e+=this.curFilter[t].length;return 0<e},t.prototype.playEffect=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.list_chosenItem.$children[t]?[4,DragonBoneTools.playOnce({effectName:"common_yingxiongfenjie",parent:this.list_chosenItem.$children[t],x:this.list_chosenItem.$children[t].width/2,y:this.list_chosenItem.$children[t].height/2,loop:!1,cacheAsBitmap:!0})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.doneCB=function(n){return __awaiter(this,void 0,void 0,function(){var t,i,o=this;return __generator(this,function(e){switch(e.label){case 0:for(this.gp_content.touchChildren=!1,t=[],i=0;i<this.chosenList.length;i++)t.push(this.playEffect(i));return[4,Promise.all(t)];case 1:return e.sent(),this.chosenList.splice(0),this.updateItemList(),this.updateChosenList(),this.updatePlayerInfo(),this.backpackPy.handleClientReward(n.clientReward,{title:"分解奖励",btnText:"领取",onCloseCB:function(){o.gp_content.touchChildren=!0,Utils.MsgUtils.addMidMsg("领取成功")}}),[2]}})})},t.prototype.activateComponent=function(){this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_auto.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.autoSelect()},this),this.btn_decompose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.targetConfig.confirmFunc(this.chosenList,function(){t.backpackPy.Decompose({chosenItem:t.chosenList,type:t.curType%1e4,cb:function(e){t.doneCB(e)},noShowReward:!0})})},this),this.btn_filter.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_filters.visible=!0;var e=this.gp_filter.globalToLocal(0,0),t=new egret.Sprite;t.touchEnabled=!0,t.graphics.beginFill(0,0),t.graphics.drawRect(e.x,e.y,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),t.graphics.endFill(),this.gp_filter.addChildAt(t,2),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.gp_filters.visible=!1,t.parent&&t.parent.removeChild(t)},this)},this),this.btn_details.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<this.chosenList.length?this.backpackPy.Decompose({chosenItem:this.chosenList,type:this.curType%1e4,preview:!0}):Utils.MsgUtils.addMidMsg("未放入"+this.targetConfig.name)},this)},t.prototype.updatePlayerInfo=function(){var e=r.Config.publicBuyCostConfig(r.ShopConfig.ShopInfo[ShopType.ShopTypeDecompose].moduleId),t=[JSON.parse(e.costs)[0]];this.targetConfig.moneyInfo?this.cu_resBar.updateBar(this.targetConfig.moneyInfo):this.cu_resBar.updateBar({costs:t,width:190,needAdd:!0})},t.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.targetConfig.onCloseCB&&this.targetConfig.onCloseCB(),r.GameMVC.backpackPy.decompose_spirte_temInfo=void 0,Utils.AssetsMgr.destroyGroup("group_decompose")},t);function t(){var e,t=i.call(this)||this;return t.initedUI=!1,t.initedTOP=!1,t.isTouchTap=!1,t.MAX_NUM=20,t.DECOMPOSE_TYPE_CONFIG=((e={})[EEntityType.EEntityTypeItem+1e4*EPropType.EPropTypeHeroSpirit]={name:"英魂分解",moneyInfo:{costs:[[3,30000046,1]],width:190,needAdd:!0},getAllInfo:function(){if(r.GameMVC.backpackPy.decompose_spirte_temInfo)return r.GameMVC.backpackPy.decompose_spirte_temInfo;var e=r.GameMVC.backpackPy.AllItemInfo,t={},i=r.Config.itemConfig();for(var o in e){var n=e[o][0];if(i[o]&&i[o].type==EPropType.EPropTypeHeroSpirit)for(var a=n.num;a--;)t[o+"_"+a]={code:o,race:i[o].race,color:i[o].color,star:i[o].color,index:a}}return r.GameMVC.backpackPy.decompose_spirte_temInfo=t},filterConfig:{data:[[{race:HeroRaceType.Human,icon:HeroRaceConfig[HeroRaceType.Human].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Elf,icon:HeroRaceConfig[HeroRaceType.Elf].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Orc,icon:HeroRaceConfig[HeroRaceType.Orc].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Athanasy,icon:HeroRaceConfig[HeroRaceType.Athanasy].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Demon,icon:HeroRaceConfig[HeroRaceType.Demon].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Eldar,icon:HeroRaceConfig[HeroRaceType.Eldar].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"}]],filterFunc:function(e,t){return!e.race||0==e.race.length||-1!=e.race.indexOf(t.race)},addFilter:function(e,t){var i=t.race?"race":"color";e[i]||(e[i]=[]);var o=e[i].indexOf(t[i]);-1==o?(e[i].splice(0),e[i].push(t[i])):e[i].splice(o,1)},autoFilterFunc:function(e,t){return e.color<2},autoFilterTipsFunc:function(e){return"无蓝色品质以下英魂"}},checkChoosabel:function(e){return!0},sortFunc:function(e,t){var i=e.info,o=t.info;return i.color!=o.color?i.color-o.color:i.code!=o.code?i.code-o.code:i.level-o.level},confirmFunc:function(e,t){0<e.length?t():Utils.MsgUtils.addMidMsg("未放入英魂")},onCloseCB:function(){var e=r.GameMVC.backpackMed.getSubView(r.BackpackMediator.SV.BACKPACK_PANEL);e&&e.showList()}},e[EEntityType.EEntityTypePet]={name:"宠物商店",moneyInfo:{costs:[[3,30000046,1]],width:190,needAdd:!0},getAllInfo:function(){if(r.GameMVC.backpackPy.decompose_spirte_temInfo)return r.GameMVC.backpackPy.decompose_spirte_temInfo;function e(e){var t=o[e],i=!!r.GameMVC.petPy.getLockType(t.uuid);n[e]={uuid:e,level:t.level,code:t.code,pos:t.pos,isLocked:i,skillCount:Object.keys(t.skillDetailList).length,sortKey:t.sortKey,getLockedTip:function(e){switch(r.GameMVC.petPy.getLockType(t.uuid)){case 1:return"该宠物在主阵位上";case 2:return"该宠物喂养中";case 3:return"该宠物求偶中";case 4:return"该宠物在种族圣域上阵"}return"该宠物已被锁住"}}}var o=r.GameMVC.petPy.allPetByUuid,n={};for(var t in o)e(t);return r.GameMVC.backpackPy.decompose_spirte_temInfo=n},filterConfig:{data:[],filterFunc:function(e,t){return!0},addFilter:function(e,t){},autoFilterFunc:function(e,t){return!0},autoFilterTipsFunc:function(e){return"无宠物可出售"}},checkChoosabel:function(e){return!e.isLocked},sortFunc:function(e,t){var i=e.info,o=t.info;return i.isLocked!=o.isLocked?i.isLocked-o.isLocked:i.pos!=o.pos?i.pos-o.pos:i.level!=o.level?i.level-o.level:i.skillCount!=o.skillCount?i.skillCount-o.skillCount:i.sortKey-o.sortKey},confirmFunc:function(e,t){0<e.length?t():Utils.MsgUtils.addMidMsg("未放入宠物")},onCloseCB:function(){var e=r.GameMVC.backpackMed.getSubView(r.BackpackMediator.SV.BACKPACK_PANEL);e&&e.showList()}},e),Utils.AssetsMgr.loadGroup("group_decompose"),t.skinName="DecomposePanelSkin",t.heroPy=r.AppFacade.getInstance().retrieveProxy(r.HeroPy.N),t.backpackPy=r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N),t.chosenList=[],t.curFilter={},t}r.DecomposePanel=e,__reflect(e.prototype,"game.DecomposePanel")}(game=game||{}),function(i){var t,e=(__extends(o,t=BaseFull),o.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_decompose")},o.prototype.onOtherPanelPopup=function(e){t.prototype.onOtherPanelPopup.call(this,e),this.gp_content.visible=!e},o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.initTabbar(),this.initTop(),this.activateComponent(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_help),Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_reborn),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cu_resBar),this.gp_content.touchChildren=!0,this.gp_content.scaleX=this.gp_content.scaleY=1,UIActionManager.playUIAction(this.gp_content,1)},o.prototype.initTop=function(){this.updatePlayerInfo()},o.prototype.initial=function(){this.targetConfig=this.DECOMPOSE_TYPE_CONFIG[this.curType],this.blb_title.text=this.targetConfig.name,this.initFilter(),this.initedUI=!0},o.prototype.initList=function(){this.list_chosenItem.itemRenderer=a,UIActionManager.hideScrollerBar(this.scl_chosenItem),this.list_chosenItem.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.chosenList_onItemTap,this),this.list_item.itemRenderer=c,UIActionManager.hideScrollerBar(this.scl_item),this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.itemList_onItemTap,this)},o.prototype.initTabbar=function(){this.tabbar.visible=!1},o.prototype.initFilter=function(){var o=this;this.gp_filters_list.removeChildren();var e=this.targetConfig.filterConfig.data;e&&0<e.length?(this.gp_filter.visible=!0,e.forEach(function(e){var t=new eui.List;t.itemRenderer=p;var i=new eui.HorizontalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER,t.layout=i,t.dataProvider=new eui.ArrayCollection(e),t.addEventListener(eui.ItemTapEvent.ITEM_TAP,o.filterItem_onItemTap,o),o.gp_filters_list.addChild(t)}),this.gp_filters.height=42*e.length+20*(e.length-1)+40):this.gp_filter.visible=!1},o.prototype.chosenList_onItemTap=function(e){e.item.info&&this.selectItem(e.item.info,!1)},o.prototype.itemList_onItemTap=function(e){(this.targetConfig.checkChoosabel||function(){return!0})(e.item.info)?-1==this.chosenList.indexOf(e.item.info)?this.chosenList.length<this.MAX_NUM&&this.selectItem(e.item.info,!0):this.selectItem(e.item.info,!1):e.item.info.isLocked?Utils.MsgUtils.addMidMsg("该英雄已上锁"):e.item.info.pos&&Utils.MsgUtils.addMidMsg("该英雄在阵上")},o.prototype.filterItem_onItemTap=function(e){var t=e.itemRenderer;if(this.targetConfig.filterConfig.addFilter(this.curFilter,e.item),!t.chosen)for(var i=0,o=this.gp_filters_list.$children;i<o.length;i++){var n=o[i];if(-1!=n.$children.indexOf(t))for(var a=0,r=n.$children;a<r.length;a++){var s=r[a];s.chosen&&s.setChosen(!1)}}t.setChosen(!t.chosen),this.updateItemList()},o.prototype.selectItem=function(e,t){var i=this.list_item.dataProvider;for(var o in i.source){var n=i.source[o];if(n.info==e){n.chosen=t,i.itemUpdated(n);break}}t?this.chosenList.push(e):this.chosenList.splice(this.chosenList.indexOf(e),1),this.updateChosenList()},o.prototype.updateChosenList=function(){var e=[];for(var t in this.chosenList){var i=this.chosenList[t];e.push({type:this.curType,info:i})}for(;e.length<this.MAX_NUM;)e.push({});this.list_chosenItem.dataProvider=new eui.ArrayCollection(e)},o.prototype.updateItemList=function(){var e=[],t=this.targetConfig.filterConfig&&this.targetConfig.filterConfig.filterFunc||function(){return!0},i=this.targetConfig.sortFunc||function(){return-1},o=this.targetConfig.getAllInfo(),n=0;if(o)for(var a in o){n+=1;var r=o[a];t(this.curFilter,r)&&e.push({type:this.curType,info:r,chosen:-1!=this.chosenList.indexOf(r)})}e.sort(i),this.list_item.dataProvider=new eui.ArrayCollection(e),this.lb_num.text=this.targetConfig.name.slice(0,2)+"数量：",this.blb_num.text=e.length+"/"+n},o.prototype.updateView=function(e){var t=!this.curType||e&&e.type&&e.type!=this.curType;this.curType=e&&e.type||this.curType,!this.initedUI||t?(this.chosenList.splice(0),this.initial(),this.updateView()):(this.updateChosenList(),this.updateItemList(),this.updatePlayerInfo())},o.prototype.autoSelect=function(){if(!(this.chosenList.length>=this.MAX_NUM)){var e=this.list_item.dataProvider.source,t=this.targetConfig.filterConfig&&this.targetConfig.filterConfig.autoFilterFunc||function(){return!0},i=this.targetConfig.checkChoosabel||function(){return!0},o=this.curHasFilter(),n=0;if(e.length)for(var a in e){var r=e[a].info;if(t(r,o)&&i(r)&&-1==this.chosenList.indexOf(r)&&(this.chosenList.push(r),n++,this.chosenList.length>=this.MAX_NUM))break}n?(this.updateItemList(),this.updateChosenList()):Utils.MsgUtils.addMidMsg(this.targetConfig.filterConfig.autoFilterTipsFunc(o))}},o.prototype.curHasFilter=function(){var e=0;for(var t in this.curFilter)e+=this.curFilter[t].length;return 0<e},o.prototype.playEffect=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.list_chosenItem.$children[t]?[4,DragonBoneTools.playOnce({effectName:"common_yingxiongfenjie",parent:this.list_chosenItem.$children[t],x:this.list_chosenItem.$children[t].width/2,y:this.list_chosenItem.$children[t].height/2,loop:!1,cacheAsBitmap:!0})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},o.prototype.doneCB=function(n){return __awaiter(this,void 0,void 0,function(){var t,i,o=this;return __generator(this,function(e){switch(e.label){case 0:for(this.gp_content.touchChildren=!1,t=[],i=0;i<this.chosenList.length;i++)t.push(this.playEffect(i));return[4,Promise.all(t)];case 1:return e.sent(),this.chosenList.splice(0),this.updateItemList(),this.updateChosenList(),this.updatePlayerInfo(),this.backpackPy.handleClientReward(n.clientReward,{title:"分解奖励",btnText:"领取",onCloseCB:function(){o.gp_content.touchChildren=!0,Utils.MsgUtils.addMidMsg("领取成功")}}),[2]}})})},o.prototype.activateComponent=function(){this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.MainJumpConfig.jumpTo()},this),this.btn_auto.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.autoSelect()},this),this.btn_decompose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.targetConfig.confirmFunc(this.chosenList,function(){t.backpackPy.Decompose({chosenItem:t.chosenList,type:t.curType,cb:function(e){t.doneCB(e)},noShowReward:!0})})},this),this.btn_filter.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_filters.visible=!0;var e=this.gp_filter.globalToLocal(0,0),t=new egret.Sprite;t.touchEnabled=!0,t.graphics.beginFill(0,0),t.graphics.drawRect(e.x,e.y,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),t.graphics.endFill(),this.gp_filter.addChildAt(t,2),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.gp_filters.visible=!1,t.parent&&t.parent.removeChild(t)},this)},this),this.btn_details.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<this.chosenList.length?this.backpackPy.Decompose({chosenItem:this.chosenList,type:this.curType%1e4,preview:!0}):Utils.MsgUtils.addMidMsg("未放入"+this.targetConfig.name)},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeDecompose})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new i.HelpDialog({moduleId:MODULE.Decompose})})},this),this.btn_reborn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.AppFacade.getInstance().showSubView(i.BackpackMediator.N,i.BackpackMediator.SV.HEROROLLBACKVIEW)},this)},o.prototype.updatePlayerInfo=function(){var e=i.Config.publicBuyCostConfig(i.ShopConfig.ShopInfo[ShopType.ShopTypeDecompose].moduleId),t=[JSON.parse(e.costs)[0]];this.cu_resBar.updateBar({costs:t,width:190,needAdd:!0})},o);function o(){var e,s=t.call(this)||this;return s.initedUI=!1,s.isTouchTap=!1,s.MAX_NUM=20,s.DECOMPOSE_TYPE_CONFIG=((e={})[EEntityType.EEntityTypeHero]={name:"英雄祭坛",getAllInfo:function(){return i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N).allHeroByUuid},filterConfig:{data:[[{race:HeroRaceType.Human,icon:HeroRaceConfig[HeroRaceType.Human].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Elf,icon:HeroRaceConfig[HeroRaceType.Elf].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Orc,icon:HeroRaceConfig[HeroRaceType.Orc].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Athanasy,icon:HeroRaceConfig[HeroRaceType.Athanasy].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Demon,icon:HeroRaceConfig[HeroRaceType.Demon].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Eldar,icon:HeroRaceConfig[HeroRaceType.Eldar].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"}],[{star:1,icon:"fenjie_btn_xingtb1_png",chosenImg:"beibao_img_daxuanzhongq_png"},{star:2,icon:"fenjie_btn_xingtb2_png",chosenImg:"beibao_img_daxuanzhongq_png"},{star:3,icon:"fenjie_btn_xingtb3_png",chosenImg:"beibao_img_daxuanzhongq_png"},{star:4,icon:"fenjie_btn_xingtb4_png",chosenImg:"beibao_img_daxuanzhongq_png"},{star:5,icon:"fenjie_btn_xingtb5_png",chosenImg:"beibao_img_daxuanzhongq_png"},{star:6,icon:"fenjie_btn_xingtb6_png",chosenImg:"beibao_img_daxuanzhongq_png"}]],filterFunc:function(e,t){var i=!e.race||0==e.race.length||-1!=e.race.indexOf(t.config.race),o=!e.star||0==e.star.length||-1!=e.star.indexOf(t.starLevel);return i&&o},addFilter:function(e,t){var i=t.race?"race":"star";e[i]||(e[i]=[]);var o=e[i].indexOf(t[i]);-1==o?(e[i].splice(0),e[i].push(t[i])):e[i].splice(o,1)},autoFilterFunc:function(e,t){return e.starLevel<=4},autoFilterTipsFunc:function(e){return"无五星以下英雄"}},checkChoosabel:function(e){return!e.pos&&!e.isLocked},sortFunc:function(e,t){var i=e.info,o=t.info,n=i.pos||0,a=o.pos||0;if(n!=a)return n-a;var r=!!s.backpackPy.checkHeroInTeam(i.uuid);return r!=!!s.backpackPy.checkHeroInTeam(o.uuid)?r?1:-1:i.isLocked!=o.isLocked?i.isLocked?1:-1:i.starLevel!=o.starLevel?i.starLevel-o.starLevel:i.code!=o.code?i.code-o.code:i.level-o.level},confirmFunc:function(e,t){0<e.length?e.some(function(e){return 4==e.starLevel})?i.GameMgr.getInstance().showCommonTipsWin({commonTips:"你所要分解的英雄中含有4星英雄，4星英雄可作为升为5星英雄的材料，请确认是否分解？",needTipsToday:!0,cb:!0,source:"HERO_DECOMPOSE",clickCB:function(e){e.type&&t()}}):t():Utils.MsgUtils.addMidMsg("未放入英雄")}},e[EEntityType.EEntityTypeHeroEquip]={name:"装备分解",getAllInfo:function(){return i.AppFacade.getInstance().retrieveProxy(i.HeroThingPy.N).AllEquipInfo},filterConfig:{data:[],filterFunc:function(e,t){return!0},addFilter:function(e,t){},autoFilterFunc:function(e){return e.config.color<=3},autoFilterTipsFunc:function(e){return"无紫色品质以下装备"}},checkChoosabel:function(e){return""==e.heroUuid},sortFunc:function(e,t){var i=e.info,o=t.info,n=""!=i.heroUuid;return n!=(""!=o.heroUuid)?n?1:-1:i.config.color!=o.config.color?i.config.color-o.config.color:i.code!=o.code?i.code-o.code:i.level-o.level},confirmFunc:function(e,t){0<e.length?t():Utils.MsgUtils.addMidMsg("未放入装备")}},e),Utils.AssetsMgr.loadGroup("group_decompose"),s.skinName="DecomposeUISkin",s.heroPy=i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N),s.backpackPy=i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N),s.chosenList=[],s.curFilter={},s}i.DecomposeUI=e,__reflect(e.prototype,"game.DecomposeUI");var n,a=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseItem.addChild(this.baseItem)},r.prototype.dataChanged=function(){var e=this.data.type,t=this.data.info;if(t)switch(this.gp_baseItem.visible=!0,this.gp_empty.visible=!1,e){case EEntityType.EEntityTypeHero:this.baseItem.updateData({uuid:t.uuid,type:EEntityType.EEntityTypeHero});break;case EEntityType.EEntityTypeHeroEquip:this.baseItem.updateData({uuid:t.uuid,type:EEntityType.EEntityTypeHeroEquip});break;case EEntityType.EEntityTypeItem:this.baseItem.updateData({code:t.code,type:EEntityType.EEntityTypeItem});break;case EEntityType.EEntityTypePet:this.baseItem.updateData({uuid:t.uuid,type:EEntityType.EEntityTypePet})}else this.gp_baseItem.visible=!1,this.gp_empty.visible=!0},r);function r(){var e=n.call(this)||this;return e.skinName="DecomposeUI_ChosenItem",e}i.DecomposeUI_ChosenItem=a,__reflect(a.prototype,"game.DecomposeUI_ChosenItem");var s,c=(s=eui.ItemRenderer,__extends(l,s),l.prototype.childrenCreated=function(){var e=this;s.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseItem.addChild(this.baseItem),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.touchBeginTime=Utils.TimerManager.getServerTime()},this),this.addEventListener(egret.TouchEvent.TOUCH_END,function(){e.onTouchEnd()},this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){e.onTouchEnd()},this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){e.touchBeginTime=0},this)},l.prototype.dataChanged=function(){switch(this.data.type){case EEntityType.EEntityTypeHero:this.baseItem.updateData({uuid:this.data.info.uuid,type:EEntityType.EEntityTypeHero}),UIActionManager.setGrey(this.baseItem,this.data.info.isLocked||this.data.info.pos||this.data.chosen),this.gp_unlock.visible=(this.data.info.isLocked||this.data.info.pos)&&!0;break;case EEntityType.EEntityTypePet:this.data.info.uuid?this.baseItem.updateData({uuid:this.data.info.uuid,type:EEntityType.EEntityTypePet}):this.baseItem.updateData({code:this.data.info.code,type:EEntityType.EEntityTypePet}),UIActionManager.setGrey(this.baseItem,this.data.info.isLocked||this.data.info.pos||this.data.chosen),this.gp_unlock.visible=(this.data.info.isLocked||this.data.info.pos)&&!0;break;case EEntityType.EEntityTypeHeroEquip:this.baseItem.updateData({uuid:this.data.info.uuid,type:EEntityType.EEntityTypeHeroEquip}),UIActionManager.setGrey(this.baseItem,this.data.info.isLocked||""!=this.data.info.heroUuid||this.data.chosen),this.gp_unlock.visible=this.data.info.isLocked||""!=this.data.info.heroUuid;break;case EEntityType.EEntityTypeHeroArtifact:this.baseItem.updateData({uuid:this.data.info.uuid,type:EEntityType.EEntityTypeHeroArtifact}),UIActionManager.setGrey(this.baseItem,this.data.info.isLocked||""!=this.data.info.heroUuid||this.data.chosen),this.gp_unlock.visible=this.data.info.isLocked||""!=this.data.info.heroUuid;break;case EEntityType.EEntityTypeItem:this.baseItem.updateData({code:this.data.info.code,type:EEntityType.EEntityTypeItem,num:1}),UIActionManager.setGrey(this.baseItem,this.data.chosen),this.gp_unlock.visible=!1;break;case EEntityType.EEntityTypeImmortal:this.baseItem.updateData({uuid:this.data.info.uuid,type:EEntityType.EEntityTypeImmortal}),UIActionManager.setGrey(this.baseItem,""!=this.data.info.heroUuid||this.data.chosen),this.gp_unlock.visible=""!=this.data.info.heroUuid}this.gp_chosen.visible=this.data.chosen},l.prototype.onTouchEnd=function(){this.touchBeginTime&&this.data.type==EEntityType.EEntityTypePet&&1<Utils.TimerManager.getServerTime()-this.touchBeginTime&&i.GameMVC.petMed.showSubView(i.PetMediator.SV.SELF_PET_DETAIL,{uuid:this.data.info.uuid}),this.touchBeginTime=0},l);function l(){var e=s.call(this)||this;return e.touchBeginTime=0,e.skinName="DecomposeUI_Item",e}i.DecomposeUI_Item=c,__reflect(c.prototype,"game.DecomposeUI_Item");var h,p=(h=eui.ItemRenderer,__extends(d,h),d.prototype.childrenCreated=function(){h.prototype.childrenCreated.call(this),this.chosen=!1,this.scaleX=this.scaleY=.7},d.prototype.dataChanged=function(){this.img_icon.source=this.data.icon,this.img_chosen.source=this.data.chosenImg,this.setChosen(this.chosen)},d.prototype.setChosen=function(e){this.chosen=e,this.img_chosen.visible=this.chosen},d);function d(){var e=h.call(this)||this;return e.skinName="BackpackUI_FilterItem",e}i.DecomposeUI_FilterItem=p,__reflect(p.prototype,"game.DecomposeUI_FilterItem")}(game=game||{}),function(e){var t,i=(__extends(o,t=BaseMediator),Object.defineProperty(o.prototype,"rootView",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,e.StrongUI)},o.prototype.listNotificationInterests=function(){return[CN.LOGIN_FINAL_DONE,CN.HIDE_ALL_SUBVIEW,CN.STRONG_OPEN_MAIN,CN.STRONG_CLOSE_MAIN]},o.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.STRONG_OPEN_MAIN:case CN.STRONG_CLOSE_MAIN:this.hideAllSubView(),this.rootView&&(this.rootView.visible=!1);break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView(),this.removeFromParent(),this.rootView&&(this.rootView.visible=!1);break;case CN.LOGIN_FINAL_DONE:}},o.prototype.onViewCreate=function(){},o.N="StrongMediator",o.SV={MAIN:1},o);function o(e){return void 0===e&&(e=null),t.call(this,o.N,e)||this}e.StrongMediator=i,__reflect(i.prototype,"game.StrongMediator")}(game=game||{}),function(e){var t=(i.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.BaseItem",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},i);function i(){}e.BaseItemFactory=t,__reflect(t.prototype,"customui.BaseItemFactory");var o,n=(o=eui.Component,__extends(a,o),a.prototype.getVOByUuid=function(){if(this.uuid)switch(this.curEntityType){case EEntityType.EEntityTypeHero:this.vo=this.heroProxy.allHeroByUuid[this.uuid];break;case EEntityType.EEntityTypePet:this.vo=this.petProxy.allPetByUuid[this.uuid];break;case EEntityType.EEntityTypeHeroEquip:this.vo=this.heroThingProxy.AllEquipInfo[this.uuid];break;case EEntityType.EEntityTypeHeroArtifact:this.vo=this.heroThingProxy.AllArtiInfo[this.uuid];break;case EEntityType.EEntityTypeTreasure:this.vo=this.heroThingProxy.AllTreasureInfo[this.uuid];break;case EEntityType.EEntityTypeMagical:this.vo=this.magicalArtifactPy.allMagicalArtifactByUuid[this.uuid];break;case EEntityType.EEntityTypeMap:this.vo=this.guajiPy.AllMapInfo[this.uuid];break;case EEntityType.EEntityTypeVestageHero:this.vo=this.dungeonProxy.heroDict[this.uuid];break;case EEntityType.EEntityTypeImmortal:this.vo=this.heroThingProxy.AllImmortalInfo[this.uuid]}else this.vo=void 0},a.prototype.resetFixedStyle=function(e){switch(this.curEntityType=e,this.code=this.config=this.vo=void 0,this.img_tag.visible=!1,this.curEntityType){case EEntityType.EEntityTypeHero:case EEntityType.EEntityTypePet:this.decorateLevel(void 0),this.decorateStar(1),this.gp_star_hero.removeChildren(),this.decorateIcon(""),this.decorateColorFrame(0),this.img_bg.source="_border_m_json.common_img_jichuwupingkuang",this.img_frame.parent.getChildIndex(this.img_frame)<this.img_icon.parent.getChildIndex(this.img_icon)&&this.img_frame.parent.swapChildren(this.img_frame,this.img_icon),this.decorateRaceIcon(""),this.decorateProfessionIcon(""),this.decorateNum(void 0),this.gp_effect.removeChildren(),this.img_zudui.visible=!1}},a.prototype.updateData=function(e){if(this._preParams=e,this._hasInit&&(e.reward&&(e.type=e.reward[0]||e.reward.type,e.code=e.reward[1]||e.reward.code,e.num=e.reward[2]||e.reward.num),this.style=e.style,this._source=e.source||BASEITEM_SOURCE.OTHER,this.curEntityType&&this.curEntityType!=e.type&&this.reset(!0),this.curEntityType=e.type,this.uuid=e.uuid,e.vo?this.vo=e.vo:this.getVOByUuid(),this.code=e.code||e.id||this.vo&&(this.vo.code||this.vo.id),null!=this.code))switch(this.img_tag.visible=!1,this.curEntityType||(this.curEntityType=Math.floor(this.code/1e7)),this.curEntityType==EEntityType.EEntityTypeHeroArtifactCode&&(this.curEntityType=EEntityType.EEntityTypeHeroArtifact),this.curEntityType){case EEntityType.EEntityTypeVestageItem:case EEntityType.EEntityTypeItem:this.decorateItem(e);break;case EEntityType.EEntityTypeVestageHero:case EEntityType.EEntityTypeHero:this.decorateHero(e);break;case EEntityType.EEntityTypePet:this.decoratePet(e);break;case EEntityType.EEntityTypeHeroEquip:case EEntityType.EEntityTypeTreasure:case EEntityType.EEntityTypeHeroArtifact:this.decorateHeroThing(e);break;case EEntityType.EEntityTypeImmortal:this.decorateHeroImmortal(e);break;case EEntityType.EEntityTypeMagical:this.decorateMagical(e);break;case EEntityType.EEntityTypeMap:this.decorateMap(e);break;default:this.decorateCommon(e)}},a.prototype.onClick=function(){if(this.touchEnabled)if(Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),this.customTapEvent&&0!=this.customTapEvent());else if(this.curEntityType||this.code)switch(this.curEntityType){case EEntityType.EEntityTypeHero:case EEntityType.EEntityTypeVestageHero:game.AppFacade.getInstance().showSubView(game.HeroMediator.N,game.HeroMediator.SV.HERO_DETAIL,{code:this.code});break;case EEntityType.EEntityTypePet:this.vo&&this.vo.uuid&&game.GameMVC.petMed.showSubView(game.PetMediator.SV.SELF_PET_DETAIL,{uuid:this.vo.uuid});break;case EEntityType.EEntityTypeMap:game.AppFacade.getInstance().sendNotification(CN.GUAJI_OPEN_CBT,{forceJumpAndSearch:!0,hideRewards:!0,config:this.config,vo:this.vo});break;default:if(this.config.type===EPropType.EPropTypeSelectBox)PopUpManager.addPopUp({obj:new game.BaseItemChoseView({code:this.code,source:this._source})});else if(this._source!=BASEITEM_SOURCE.BACKPACK||this.curEntityType!=EEntityType.EEntityTypeHeroEquip&&this.curEntityType!=EEntityType.EEntityTypeHeroArtifact&&this.curEntityType!=EEntityType.EEntityTypeTreasure&&this.curEntityType!=EEntityType.EEntityTypeImmortal)if(this.curEntityType==EEntityType.EEntityTypeHeroEquip||this.curEntityType==EEntityType.EEntityTypeHeroArtifact||this.curEntityType==EEntityType.EEntityTypeTreasure||this.curEntityType==EEntityType.EEntityTypeImmortal){var e=void 0;switch(this.curEntityType){case EEntityType.EEntityTypeHeroEquip:var t=game.Config.getHeroEquipUpgradeConfig(this.code);game.Config.getHeroEquipEnchantConfig(this.code),e={code:this.code,entityType:this.curEntityType,exp:0,fightCap:0,level:0,level2:0};break;case EEntityType.EEntityTypeHeroArtifact:t=game.Config.getHeroArtifactUpgradeConfig(this.code),game.Config.getHeroArtifactUpstarConfig(this.code),e={code:this.code,entityType:this.curEntityType,exp:0,fightCap:0,level:0,level2:0};break;case EEntityType.EEntityTypeTreasure:(t=game.Config.getTreasureJewelUpgradeConfig(TreasureJewelType.Atk))&&t.length&&t[t.length-1].level,this.code,this.curEntityType;break;case EEntityType.EEntityTypeImmortal:e=this.vo||{config:game.Config.immortalConfig()[this.code],code:this.code,entityType:this.curEntityType,sectionLevel:1,slotNum:0}}e&&this.vo&&this.vo.filterShow&&(e=this.vo),game.AppFacade.getInstance().showSubView(game.HeroThingMediator.N,game.HeroThingMediator.SV.MAIN,{entityType:this.curEntityType,vo:e,source:game.HeroThingMainView.VIEW_SOURCE.HANDBOOK})}else PopUpManager.addPopUp({obj:new game.BaseItemDetailView({code:this.code,type:this.curEntityType,config:this.config,source:this._source,expiredDay:this._preParams.reward&&this._preParams.reward[5],expiredDt:this._preParams.expiredDt})});else game.AppFacade.getInstance().showSubView(game.HeroThingMediator.N,game.HeroThingMediator.SV.MAIN,{entityType:this.curEntityType,vo:this.vo,source:game.HeroThingMainView.VIEW_SOURCE.BACKPACK})}},a.prototype.addTapEvent=function(e,t){this.customTapEvent=e},a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.gp_main.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this.updateStyle(),this._hasInit=!0,this._preParams&&this.updateData(this._preParams)},a.prototype.reset=function(e){e||(this.x=this.y=0,this.touchEnabled=!0,this.visible=!0,this.scaleX=this.scaleY=1,this.bottom=this.top=this.left=this.right=this.horizontalCenter=this.verticalCenter=void 0,UIActionManager.setGrey(this,!1),this.customTapEvent=void 0),this.data=void 0,this.img_type.source="",this.img_type2.source="",this.img_profession.source="",this.blb_level.text="",this.blb_num.text="",this.blb_num.visible=!0,this.img_type.visible=!0,this.gp_star_hero.visible=!0,this.img_zudui.visible=!1,this.curEntityType=0,this.code=void 0,this.img_frame.parent.setChildIndex(this.img_frame,0),this.img_frame.source="",this.img_frame.scaleX=this.img_frame.scaleY=1.08,this.img_icon.source="",this.img_icon.visible=!0,this.img_icon.width=this.img_icon.height=86,this.img_type.scaleX=this.img_type.scaleY=.9,this.img_bg.source="_border_m_json.common_img_jichuwupingkuang2",this.blb_level.textColor=16777215,this.gp_effect.removeChildren(),this.updateStyle()},a.prototype.updateStyle=function(){this.img_type.visible=!1,this.img_awesome.visible=!1,this.blb_level.visible=!1,this.blb_num.visible=!1,this.gp_star_item.visible=!1,this.gp_star_hero.visible=!1,this.gp_star_hero2.visible=!1,this.img_type.visible=!0,this.blb_level.visible=!0,this.blb_num.visible=!0},a.prototype.decorateIcon=function(e){this.img_icon.source=e},a.prototype.decorateColorFrame=function(e){switch(this.curEntityType){case EEntityType.EEntityTypePet:this.img_frame.source="_border_m_json.moshou_img_tesukuang";break;case EEntityType.EEntityTypeVestageHero:case EEntityType.EEntityTypeHero:var t=0,i=game.GeneralConfig.getHeroStarInfo(e,!0);1<i.stage&&(t=i.stage+5),t=8<t?8:t,this.img_frame.scaleX=this.img_frame.scaleY=1.02,this.img_frame.source="_border_m_json.common_img_pinzhikuang_"+t;break;case EEntityType.EEntityTypeVestageItem:this.img_frame.source="_border_m_json.common_img_pinzhikuang_0";case EEntityType.EEntityTypeItem:this.config.type==EPropType.EPropTypeHeroSpirit?this.img_frame.source=SPRITE_COLOR_2_FRAME[e]:this.img_frame.source=COLOR_2_FRAME[e];break;default:this.img_frame.source=COLOR_2_FRAME[e]}},a.prototype.decorateLevel=function(e){null!=e?this.curEntityType==EEntityType.EEntityTypeHero||this.curEntityType==EEntityType.EEntityTypePet||this.curEntityType==EEntityType.EEntityTypeVestageHero?this.blb_level.text=""+e:this.blb_level.text="+"+e:this.blb_level.text=""},a.prototype.decorateNum=function(e){this.blb_num.text=null!=e?"0"==e?"":Utils.MathUtils.formatNumStyle1(Number(e)):""},a.prototype.decorateStar=function(e){if(this.gp_star_hero.visible=!1,this.gp_star_item.visible=!1,this.gp_star_hero2.visible=!1,this.curEntityType==EEntityType.EEntityTypeHeroEquip){var t=5*((o=game.GeneralConfig.getHeroStarInfo(Number(e),!1)).stage-1)+o.num;this.gp_star_item.visible=0<t;var i=game.Config.getHeroEquipConfig()[this.vo.code];i&&0<i.professionSuit?(this.gp_star_item.top=void 0,this.gp_star_item.bottom=0):(this.gp_star_item.top=0,this.gp_star_item.bottom=void 0),this.lb_starnum.text=String(t)}else{var o;if((o=game.GeneralConfig.getHeroStarInfo(Number(e),!0,this.vo&&this.vo.isAltar)).stage<4){this.gp_star_hero.visible=!0,this.gp_star_hero.removeChildren(),this.gp_star_hero.layout.gap=-2*o.stage-3;for(var n=0;n<o.num;n++){var a=new eui.Image(o.src);a.scaleX=a.scaleY=.4,this.gp_star_hero.addChild(a)}}else this.gp_star_hero2.visible=!0,this.blb_star_hero2.text=o.num.toString(),this.img_star_hero2.source=o.src,this.vo&&this.vo.isAltar?this.blb_star_hero2.horizontalCenter=0:this.blb_star_hero2.horizontalCenter=1}},a.prototype.decorateRaceIcon=function(e){void 0===e&&(e=""),this.img_type.visible=!0,this.img_type.source=e},a.prototype.decorateProfessionIcon=function(e,t){void 0===e&&(e=""),void 0===t&&(t=!1),this.img_profession.y=t?3:30,this.img_profession.visible=!0,this.img_profession.source=e},a.prototype.decorateType2Icon=function(e){this.img_type2.visible=!0,this.img_type2.source=e},a.prototype.decorateEffect=function(e,t){var i="common_yingxiongtouxiangkuang",o=1;t&&(i=t.effectName,t.scale&&(o=t.scale)),DragonBoneTools.create(i,function(e){e.x=this.sl_effect.width/2,e.y=this.sl_effect.height/2,e.scaleX=e.scaleY=o,e.animation.play(i,0),this.gp_effect.addChild(e)},this)},a.prototype.decorateCommon=function(e){var t=e.code||e.id,i=e.type||EEntityType.EEntityTypeMoney;if(t){for(var o=0,n=game.Config.propertyConfig();o<n.length;o++){var a=n[o];if(a.type===i&&a.code===t){this.config=a;break}}this.config&&(this.decorateColorFrame(this.config.color),this.decorateIcon(ResourceUtils.png(this.config.icon)),this.decorateNum(e.num))}},a.prototype.decorateMap=function(e){this.config=game.Config.getRiskMapByCode(this.code),this.config&&(this.decorateColorFrame(this.config.color),this.decorateIcon(ResourceUtils.png(this.config.icon)),this.gp_star_hero.visible=!1,this.img_type.visible=!1,this.img_type2.visible=!1),this.decorateNum(void 0)},a.prototype.decorateItem=function(e){if(this.config=game.Config.itemConfig()[this.code]||game.Config.vestageItemConfig()[this.code],this.config)if(this.decorateColorFrame(this.config.color),this.decorateIcon(ResourceUtils.png(this.config.icon)),this.gp_star_hero.visible=!1,this.img_type.visible=!1,this.img_type2.visible=!1,this.config.type==EPropType.EPropTypeChip){this.decorateType2Icon("beibao_img_suipian_png");var t=JSON.parse(this.config.effect),i=t[0][1],o=t[0][0],n=game.GeneralConfig.getEntityConfigByCode(o,i);o==EEntityType.EEntityTypeHero&&(this.decorateStar(n.initStar),0!=this.config.race?this.decorateRaceIcon(HeroRaceConfig[this.config.race].raceIcon):0==this.config.race&&1==t.length?this.decorateRaceIcon(HeroRaceConfig[n.race].raceIcon):this.decorateRaceIcon())}else this.config.type==EPropType.EPropTypeHeroSpirit?this.decorateRaceIcon(HeroRaceConfig[this.config.race].raceIcon):(e.reward&&e.reward[5]||e.expiredDt)&&this.decorateType2Icon("_border_m_json.common_icon_zhongbiao");this.decorateNum(e.num)},a.prototype.decoratePet=function(e){this.vo?(this.code=this.vo.code,this.decorateLevel(this.vo.level)):this.decorateLevel(e.level),this.config=game.Config.allPetConfig()[this.code],e.avatar?this.decorateIcon(ResourceUtils.png(e.avatar)):this.decorateIcon(ResourceUtils.png(this.config.avatar)),this.img_bg.source="_border_m_json.common_img_jichuwupingkuang",this.img_frame.parent.getChildIndex(this.img_frame)<this.img_icon.parent.getChildIndex(this.img_icon)&&this.img_frame.parent.swapChildren(this.img_frame,this.img_icon),this.img_frame.source="_border_m_json.common_img_pinzhikuang_0",this.vo&&this.vo.pos?(this.img_type.visible=!0,this.img_type.source=1==this.vo.pos?"chongwu_img_zhan_png":"chongwu_img_zhu_png",this.img_type.scaleX=this.img_type.scaleY=1):this.img_type.source="",this.decorateNum(e.num?e.num.toString():void 0)},a.prototype.decorateHero=function(e){this.vo&&(this.code=this.vo.code,this.decorateLevel(this.vo.level),this.vo.isAltar?this.blb_level.textColor=1436413:this.blb_level.textColor=16777215),this.config=game.Config.allHeroConfig(this.curEntityType==EEntityType.EEntityTypePet)[this.code]||game.Config.creepConfig(this.code),this.curEntityType==EEntityType.EEntityTypeVestageHero?this.decorateStar(this.vo&&this.vo.starLevel||this.config.initStar):e.isNotShowStar?this.decorateStar(0):this.decorateStar(this.config.initStar),e.avatar?this.decorateIcon(ResourceUtils.png(e.avatar)):this.decorateIcon(ResourceUtils.png(this.config.avatar)),this.decorateColorFrame(this.config.initStar),this.img_bg.source="_border_m_json.common_img_jichuwupingkuang",this.img_frame.parent.getChildIndex(this.img_frame)<this.img_icon.parent.getChildIndex(this.img_icon)&&this.img_frame.parent.swapChildren(this.img_frame,this.img_icon),e.isShowMax?this.decorateLevel(this.vo&&this.vo.config&&this.vo.config.maxLevel):e.level&&this.decorateLevel(e.level),e&&e.ignoreLevel&&(this.blb_level.visible=!1),this.config&&this.config.race?this.decorateRaceIcon(HeroRaceConfig[this.config.race].raceIcon):this.decorateRaceIcon(),this.vo&&"chess"==this.vo.voType&&this.config&&this.config.profession?this.decorateProfessionIcon(ProfessionConfig[this.config.profession].icon):this.decorateProfessionIcon(),e.isShowZhongZhu&&this.decorateProfessionIcon(ProfessionConfig[this.config.profession].icon),this.decorateNum(e.num?e.num.toString():void 0),this.gp_effect.removeChildren(),e.effect&&this.curEntityType==EEntityType.EEntityTypeHero&&10<=this.config.initStar?this.decorateEffect(this.config.initStar):e.effect&&e.effectParam?this.decorateEffect(this.config.initStar,e.effectParam):e.effect&&e.isShowEffect&&e.avatar&&this.decorateEffect(this.config.initStar),this.img_zudui.visible=this.backProxy.checkHeroInTeam(this.uuid)},a.prototype.decorateMagical=function(e){game.Config.allMagicalConfig(),this.config=game.Config.allMagicalConfig()[this.code],this.vo?(this.code=this.vo.code,this.decorateLevel(this.vo.level)):this.decorateLevel(e.level),this.decorateIcon(ResourceUtils.png(this.config.model))},a.prototype.decorateHeroThing=function(e){if(this.curEntityType==EEntityType.EEntityTypeHeroEquip)this.vo&&!this.vo.filterShow&&(this.decorateLevel(this.vo.level),this.decorateStar(this.vo.level2)),this.gp_effect.removeChildren(),this.config=game.Config.getHeroEquipConfig()[this.code],this.config.professionSuit?(this.decorateProfessionIcon(ProfessionConfig[this.config.professionSuit].icon,!0),this.decorateEffect(this.config.color)):this.decorateProfessionIcon("",!0);else if(this.curEntityType==EEntityType.EEntityTypeHeroArtifact)this.gp_effect.removeChildren(),this.vo&&!this.vo.filterShow&&this.decorateLevel(this.vo.level),this.config=game.Config.getHeroArtifactConfig()[this.code],this.decorateStar(this.config.sectionLevel);else if(this.curEntityType==EEntityType.EEntityTypeTreasure){var t=game.Config.getHeroTreasureConfig(),i=t[this.code];if(this.vo){var o=0;if(4==Object.keys(this.vo.jewelLevel).length)for(var n in o=this.vo.jewelLevel[1]||0,this.vo.jewelLevel)o=Math.min(this.vo.jewelLevel[n],o);for(var a in t){var r=t[a];o>=r.level&&(i=r)}}else i=t[0];this.config=i}if(this.curEntityType==EEntityType.EEntityTypeHeroArtifact&&this.vo&&this.vo.additionRace||this._preParams.additionRace){this.decorateIcon(ResourceUtils.png(this.config.icon2));var s=JSON.parse(game.Config.constConfig().HeroArtifactAdditionShow.constValue);this.img_frame.source=s[1],this.decorateEffect(0,{effectName:s[2]})}else this.decorateIcon(ResourceUtils.png(this.config.icon)),this.decorateColorFrame(this.config.color);var c=e&&e.num||this.vo&&this.vo.num||1;this.decorateNum(e.isNum?void 0:c.toString()),this.vo&&this.vo.isAltar?this.blb_level.textColor=1436413:this.blb_level.textColor=16777215},a.prototype.decorateHeroImmortal=function(e){this.vo&&(this.decorateLevel(this.vo.sectionLevel),this.img_awesome.visible=game.GameMVC.heroThingPy.isAwesomeImmortal(this.vo)),this.gp_effect.removeChildren(),this.config=game.Config.immortalConfig()[this.code],this.decorateIcon(ResourceUtils.png(this.config.icon));var t=e&&e.num||this.vo&&this.vo.num||1;this.decorateNum(e.isNum?void 0:t.toString())},a.prototype.onOPReset=function(){this.reset()},a.prototype.onOPComeBack=function(e,t){e&&this.updateData(e)},a.prototype.onOPClean=function(){},a.prototype.onOPCheck=function(e){egret.log("alive")},a);function a(e,t){var i=o.call(this)||this;return i.guajiPy=game.AppFacade.getInstance().retrieveProxy(game.GuajiPy.N),i.backProxy=game.AppFacade.getInstance().retrieveProxy(game.BackpackPy.N),i.heroProxy=game.AppFacade.getInstance().retrieveProxy(game.HeroPy.N),i.petProxy=game.AppFacade.getInstance().retrieveProxy(game.PetPy.N),i.heroThingProxy=game.AppFacade.getInstance().retrieveProxy(game.HeroThingPy.N),i.magicalArtifactPy=game.AppFacade.getInstance().retrieveProxy(game.MagicalArtifactPy.N),i.dungeonProxy=game.AppFacade.getInstance().retrieveProxy(game.DungeonPy.N),i.skinName="BaseItemSkin",i}e.BaseItem=n,__reflect(n.prototype,"customui.BaseItem",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(customui=customui||{}),function(o){var i,e=(__extends(n,i=BaseMediator),Object.defineProperty(n.prototype,"rootView",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),n.prototype.initNotice=function(){NoticeManager.setChildType(NT.FRIEND,[NT.FRIEND_APPLY,NT.FRIEND_GIFT])},n.prototype.initSubView=function(){this.addSubView(n.SV.INFO,o.FriendInfo),this.addSubView(n.SV.MAIN,o.FriendUI)},n.prototype.listNotificationInterests=function(){return[CN.LOGIN_FINAL_DONE,CN.FRIEND_OPEN_MAIN,CN.FRIEND_CLOSE_MAIN,CN.FRIEND_GIFT_UPDATE,CN.HIDE_ALL_SUBVIEW,CN.GENERAL_PASS_DAY,CN.CONFIG_ALL_LOADED]},n.prototype.handleNotification=function(e){var t=e.getBody(),i=this.getSubView(n.SV.MAIN);switch(e.getName()){case CN.LOGIN_FINAL_DONE:this.friendProxy.getInitListInfo(void 0,function(){i&&i.updateView(t)}),this.friendProxy.getblacklist();break;case CN.FRIEND_OPEN_MAIN:case CN.FRIEND_CLOSE_MAIN:this.hideAllSubView(),i&&(i.perClose(),i.visible=!1);break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView(),this.removeFromParent(),i&&(i.perClose(),i.visible=!1);break;case CN.FRIEND_GIFT_UPDATE:i&&i.updateGiftData();break;case CN.GENERAL_PASS_DAY:o.AppFacade.getInstance().retrieveProxy(o.FriendPy.N).getFriendList();break;case CN.CONFIG_ALL_LOADED:o.FriendPy.PetGrainConsumeCycle=o.Config.getConstValue("PetGrainConsumeCycle"),o.FriendPy.PetFeedCost=o.Config.getConstValue("PetFeedInfo")[1][1][0],o.FriendPy.FriendLootCycle=o.Config.getConstValue("FriendLootCycle"),o.FriendPy.FriendLootRewards=o.Config.getConstValue("FriendLootRewards")[0]}},n.prototype.onViewCreate=function(){},n.N="FriendMediator",n.SV={MAIN:1,INFO:2},n);function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.friendProxy=o.AppFacade.getInstance().retrieveProxy(o.FriendPy.N),t.initNotice(),t}o.FriendMediator=e,__reflect(e.prototype,"game.FriendMediator")}(game=game||{}),function(n){var t,e=(__extends(i,t=BasePanel),i.prototype.onViewCreated=function(){console.warn("子类需要覆盖该方法")},i.prototype.onViewRemove=function(){console.warn("子类需要覆盖该方法")},i.prototype.onShowMyTeam=function(){console.warn("子类需要覆盖该方法")},i.prototype.perShow=function(){return!this.commonPy.isInTeam()||(this.onShowMyTeam(),!1)},i.prototype.showCreatePanel=function(e){var t=this;PopUpManager.addPopUp({obj:new c({defaultName:this.playerPy.playerInfoVO.name,doneCB:function(e){t.commonPy.Create(e,function(){t.hide(),t.onShowMyTeam()})}})})},i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.cu_dtc.blb_title.text="集结大厅",this.cu_dtc.onCloseCB=function(){e.hide()},this.sl_root.verticalScrollBar.visible=!1,this.sl_root.verticalScrollBar.autoVisibility=!1,this.collection=new eui.ArrayCollection,this.list=new eui.List,this.sl_root.viewport=this.list,this.list.dataProvider=this.collection,this.list.itemRenderer=o,this.btn_create.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.showCreatePanel()},this),this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.commonPy.Refresh(function(){Utils.MsgUtils.addMidMsg("刷新成功"),e.updateList()})},this),this.btn_search.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""==e.tf_input.text?e.commonPy.Refresh(function(){e.updateList()}):Utils.Http.checkStrLegal(e.tf_input.text,!0)&&e.commonPy.Search(e.tf_input.text,function(){e.updateList()})},this),this.commonPy.GetCenterTeam(function(){e.updateList()}),this.onViewCreated()},i.prototype.updateView=function(e){this.commonPy.isInTeam()&&(this.mediator.hideSubView(this),this.onShowMyTeam()),e&&e.showCreate&&this.showCreatePanel(e),this.updateList()},i.prototype.updateList=function(){var t=this;this.collection.removeAll(),this.commonPy.centerTeams.forEach(function(e){t.collection.addItem({vo:e,opprCB:function(e){t.commonPy.Apply(e.vo.id,function(){e.changeEnable(!1)})}})}),0==this.collection.length?this.gp_empty.visible=!0:(this.gp_empty.visible=!1,this.collection.refresh())},i.prototype.onDestroy=function(){this.onViewRemove()},i);function i(){var e=t.call(this)||this;return e.playerPy=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N),e.skinName="CommonJiJieCenterPanelSkin",e}n.CommonJiJieCenterPanel=e,__reflect(e.prototype,"game.CommonJiJieCenterPanel");var a,o=(a=eui.ItemRenderer,__extends(r,a),r.prototype.childrenCreated=function(){var i=this;function e(e){var t=o["cu_ph_"+e];if(!t)return"continue";t.addTapEvent(function(){i.vo.members[e-1]&&i.vo.members[e-1].baseInfo&&n.AppFacade.getInstance().showSubView(n.FriendMediator.N,n.FriendMediator.SV.INFO,{playerId:i.vo.members[e-1].baseInfo.playerId})})}a.prototype.childrenCreated.call(this),this.btn_oppr.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.data.opprCB&&i.data.opprCB(i)},this);for(var o=this,t=1;t<=3;t++)e(t)},r.prototype.dataChanged=function(){var o=this;this.vo=this.data.vo,this.changeEnable(!0),n.GameMVC.loginPy.loginGameVO.singleSign?this.lb_name.text=""+this.vo.name:this.lb_name.text="S"+this.vo.serverId+"·"+this.vo.name,this.item_fightCap.update(this.vo.fightCap),this.lb_time.visible&&(this.lb_time.visible=!1),this.gp_left.$children.forEach(function(e,t){var i=o.vo.members[t];i?e.updateData({vo:i.baseInfo,showTag:i.isLeader}):e.updateData({vo:void 0})})},r.prototype.changeEnable=function(e){e?(this.btn_oppr.visible=!0,this.gp_has_oppr.visible=!1):(this.btn_oppr.visible=!1,this.gp_has_oppr.visible=!0)},r);function r(){var e=a.call(this)||this;return e.POS_X=[8,84,164],e.skinName="CommonJiJieCenterItemRenderSkin",e}n.CommonJiJieCenterItemRender=o,__reflect(o.prototype,"game.CommonJiJieCenterItemRender");var s,c=(__extends(l,s=BasePanel),l.prototype.childrenCreated=function(){var e=this;s.prototype.childrenCreated.call(this),this.cu_dtc.blb_title.text="创 建",this.cu_dtc.onCloseCB=function(){e.hide()},this.tf_input.text=this.defaultName,this.tips&&(this.lb_tips.text=this.tips),this.btn_create.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.tf_input.text=e.tf_input.text.substr(0,7),Utils.Http.checkStrLegal(e.tf_input.text,!0)&&(e.doneCB&&e.doneCB(e.tf_input.text),e.hide())},this)},l);function l(e){var t=s.call(this)||this;return t.skinName="CommonJiJieTeamCreatePanelSkin",t.doneCB=e.doneCB,t.defaultName=e.defaultName,t.tips=e.tips,t}n.CommonJiJieTeamCreatePanel=c,__reflect(c.prototype,"game.CommonJiJieTeamCreatePanel")}(game=game||{}),function(g){var i,e=(__extends(t,i=BasePanel),t.prototype.onFetch=function(e){console.warn("子类需要覆盖该方法")},t.prototype.onViewCreated=function(){console.warn("子类需要覆盖该方法")},t.prototype.onViewRemove=function(){console.warn("子类需要覆盖该方法")},t.prototype.onDestroy=function(){this.onViewRemove(),this.doneCB&&this.doneCB()},t.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.cu_dtc.blb_title.text="申请列表",this.cu_dtc.onCloseCB=function(){e.hide()},this.sl_root.verticalScrollBar.visible=!1,this.sl_root.verticalScrollBar.autoVisibility=!1,this.collection=new eui.ArrayCollection,this.list=new eui.List,this.sl_root.viewport=this.list,this.list.dataProvider=this.collection,this.list.itemRenderer=n,this.btn_dele.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.commonPy.Refuse(0,function(){e.commonPy.applyRecords.splice(0),e.updateInfo()})},this),this.onFetch(function(){e.updateInfo()}),this.onViewCreated()},t.prototype.updateInfo=function(){var h=this,p=[];if(this.commonPy.isInTeam()){function e(e){if(u.params.moduleId==MODULE.TeamExpedition||u.params.moduleId==MODULE.TeamBoss){for(var t=void 0,i=!1,o=0,n=(t=u.params.moduleId==MODULE.TeamBoss?g.AppFacade.getInstance().retrieveProxy(g.TeamBossPy.N):g.AppFacade.getInstance().retrieveProxy(g.TeamExpePy.N)).info.teamInfo.team.members;o<n.length;o++)n[o].baseInfo.playerId==e.member.baseInfo.playerId&&(i=!0);for(var a=!1,r=0,s=t.invitePlayerIds;r<s.length;r++){var c=s[r];e.member.baseInfo.playerId==c&&(a=!0,p.push(e))}if(!a||i)return"continue"}var l;l={vo:e,opprCB:function(e){h.commonPy.Agree(e.data.vo.member.baseInfo.playerId,function(){h.commonPy.applyRecords.splice(d,1),h.lb_count.text="请求信息:"+h.commonPy.applyRecords.length;var e=h.collection.source.indexOf(l);0<=e&&h.collection.removeItemAt(e)})}},u.collection.addItem(l),++d}this.lb_count.text="请求信息:"+this.commonPy.applyRecords.length,this.collection.removeAll();for(var d=0,u=this,t=0,i=this.commonPy.applyRecords;t<i.length;t++)e(i[t]);this.params.moduleId==MODULE.TeamExpedition&&g.AppFacade.getInstance().sendNotification(CN.UPDATE_APPLYRECORDS,{records:p}),0==this.collection.length?this.gp_empty.visible=!0:(this.gp_empty.visible=!1,this.collection.refresh())}else this.lb_count.text="0",Utils.MsgUtils.addMidMsg("暂无队伍信息")},t);function t(e){var t=i.call(this)||this;return t.skinName="CommonJiJieMyTeamApplyPanelSkin",(t.params=e)&&(t.doneCB=e.doneCB),t}g.CommonJiJieMyTeamApplyPanel=e,__reflect(e.prototype,"game.CommonJiJieMyTeamApplyPanel");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.btn_oppr.label="通 过",this.btn_oppr.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.opprCB&&e.data.opprCB(e)},this),this.cu_ph_1.addTapEvent(function(){g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N),g.AppFacade.getInstance().showSubView(g.FriendMediator.N,g.FriendMediator.SV.INFO,{playerId:e.data.vo.member.baseInfo.playerId})})},a.prototype.dataChanged=function(){this.lb_name.text="S"+this.data.vo.member.baseInfo.serverId+"·"+this.data.vo.member.baseInfo.name,this.item_fightCap.update(this.data.vo.member.baseInfo.fightCap),this.lb_time.text=Utils.TimerManager.getTimeLeftDescBySecond(Math.max(0,Utils.TimerManager.getServerTime()-this.data.vo.dt)),this.cu_ph_1.updateData({vo:this.data.vo.member.baseInfo})},a);function a(){var e=o.call(this)||this;return e.skinName="CommonJiJieMyTeamApplyRenderSkin",e}__reflect(n.prototype,"CommonJiJieMyTeamApplyRender")}(game=game||{}),function(s){var t,e=(__extends(i,t=BasePanel),i.prototype.onShowCenter=function(){console.warn("子类需要覆盖该方法")},i.prototype.canKick=function(){console.warn("子类需要覆盖该方法")},i.prototype.onViewCreated=function(){console.warn("子类需要覆盖该方法")},i.prototype.onViewRemove=function(){console.warn("子类需要覆盖该方法")},i.prototype.onShowApply=function(e){console.warn("子类需要覆盖该方法")},i.prototype.onFetch=function(e){console.warn("子类需要覆盖该方法")},i.prototype.inviteCallback=function(){console.warn("子类需要覆盖该方法")},i.prototype.perShow=function(){return!!this.commonPy.isInTeam()||(this.onShowCenter(),!1)},i.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),this.cu_dtc.blb_title.text="设置阵容",this.cu_dtc.img_close.horizontalCenter=310,this.cu_dtc.onCloseCB=function(){i.hide()},this.btn_switch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=[];i.commonPy.team.members.forEach(function(e){e.isLeader||t.push(e)}),PopUpManager.addPopUp({obj:new s.CommonJiJieMyTeamSwitchPanel({members:t,doneCB:function(e){i.commonPy.SwitchLeader(e.baseInfo.playerId,function(){i.updateView()})}})})},this),this.btn_apply.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.onShowApply(function(){i.updateView()})},this),this.btn_disband.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.commonPy.Quit(function(){i.hide(),i.onShowCenter()})},this),this.onViewCreated()},i.prototype.updateView=function(){this.updateInfo()},i.prototype.changeOrderAbove=function(n){var a=this;if(!this.isChanging){var r=this.index2Obj[n.index-1];r&&(this.isChanging=!0,r.gp_btns.visible=!1,n.gp_btns.visible=!1,egret.Tween.get(n).to({y:r.y},250,egret.Ease.sineInOut),egret.Tween.get(r).to({y:n.y},250,egret.Ease.sineInOut).call(function(){r.gp_btns.visible=!0,n.gp_btns.visible=!0;var e=r.index;r.changeOrder(n.index),n.changeOrder(e),a.index2Obj[n.index]=n,a.index2Obj[r.index]=r,a.isChanging=!1;var t=[];for(var i in a.index2Obj)t.push(a.index2Obj[i]);t.sort(function(e,t){return e.y-t.y});var o=[];t.forEach(function(e){e.vo&&o.push(e.vo.baseInfo.playerId)}),a.commonPy.SaveFormation(o,function(){a.updateView()})}))}},i.prototype.updateBtnStyle=function(){var e=this.commonPy.amILeader(),t=this.commonPy.team.members;UIActionManager.setAbsGrey(this.btn_switch,!e),UIActionManager.setAbsGrey(this.btn_apply,!e||e&&3==t.length),this.btn_apply.touchEnabled=this.btn_switch.touchEnabled=e},i.prototype.updateInfo=function(){var i=this;if(this.commonPy.isInTeam()){this.blb_cap.text=Utils.MathUtils.formatNumStyle2(this.commonPy.team.fightCap),this.lb_id.text="队伍ID:"+this.commonPy.team.id;var o=this.commonPy.amILeader();if(this.updateBtnStyle(),0==this.gp_team.numChildren)for(var e=0;e<3;e++){var t=this.commonPy.team.members[e],n=new c({index:e,vo:t,amILeader:o,canKick:this.canKick(),opprCB:function(e){i.changeOrderAbove(e)},opprCB2:function(t){var e=[];e.push({text:"是否将",style:{textColor:11041365,size:24}}),e.push({text:" "+t.vo.baseInfo.name+" ",style:{textColor:4557956,size:24}}),e.push({text:"逐出队伍？",style:{textColor:11041365,size:24}}),s.GameMgr.getInstance().showCommonTipsWin({commonTips:e,cb:!1,clickCB:function(e){0===e.type||1===e.type&&i.commonPy.Kick(t.vo.baseInfo.playerId,function(){i.updateView()})}})},inviteCallback:this.inviteCallback});n.y=this.POS[e],this.gp_team.addChild(n),this.index2Obj[e]=n}var a=[];for(var r in this.commonPy.team.members.forEach(function(e,t){a.push(t),i.index2Obj[t].update(e,o,i.canKick())}),this.index2Obj)-1==a.indexOf(Number(r))&&this.index2Obj[r].update()}else this.blb_cap.text="0",this.mediator.hideSubView(this)},i.prototype.onDestroy=function(){this.onViewRemove()},i);function i(){var e=t.call(this)||this;return e.index2Obj={},e.POS=[0,120,240],e.skinName="CommonJiJieMyTeamPanelSkin",e}s.CommonJiJieMyTeamPanel=e,__reflect(e.prototype,"game.CommonJiJieMyTeamPanel");var o,c=(o=eui.Component,__extends(n,o),n.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.btn_oppr.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.params.opprCB&&e.params.opprCB(e)},this),this.btn_kick.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.params.opprCB2&&e.params.opprCB2(e)},this),this.btn_invite.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.params.inviteCallback&&e.params.inviteCallback()},this),this.gp_formation.removeChildren();for(var t=0;t<6;t++){var i=customui.BaseItemFactory.create();i.scaleX=i.scaleY=.55,this.gp_formation.addChild(i)}},n.prototype.update=function(e,t,i){var o=this;this.vo=e,null!=t&&(this.params.amILeader=t),null!=i&&(this.params.canKick=i),this.lb_index.text=(Number(this.index)+1).toString(),this.gp_formation.$children.forEach(function(e){e.visible=!1}),this.vo?(this.playerProxy.GetPublicPlayerInfo([this.vo.baseInfo.playerId],function(e,t){t[o.vo.baseInfo.playerId].publicPlayer.heroList.forEach(function(e,t){var i=o.gp_formation.getChildAt(t);i&&(i.visible=!0,i.updateData({vo:e,type:EEntityType.EEntityTypeHero,code:e.code}))})}),this.btn_oppr.visible=!!this.params.amILeader&&0!=this.index,this.btn_kick.visible=!!this.params.amILeader&&this.vo.baseInfo.playerId!=this.playerProxy.playerInfoVO.playerId&&this.params.canKick,this.img_tag.visible=e.isLeader,this.lb_name.y=3,s.GameMVC.loginPy.loginGameVO.singleSign?this.lb_name.text=""+this.vo.baseInfo.name:this.lb_name.text="S"+this.vo.baseInfo.serverId+"·"+this.vo.baseInfo.name,this.blb_cap.text=Utils.MathUtils.formatNumStyle2(this.vo.baseInfo.fightCap),this.btn_invite.visible=!1,this.gp_fightCap.visible=!0,this.img_nameBg.visible=!0,this.lb_name.textColor=16777215):(this.btn_kick.visible=this.btn_oppr.visible=!1,this.img_tag.visible=!1,this.lb_name.y=34.35,this.lb_name.text="等待玩家加入",this.blb_cap.text="0",this.btn_invite.visible=!0,this.gp_fightCap.visible=!1,this.img_nameBg.visible=!1,this.lb_name.textColor=5841675)},n.prototype.changeOrder=function(e){this.index=e,this.lb_index.text=(Number(this.index)+1).toString(),this.btn_oppr.visible=!!this.params.amILeader&&0!=this.index,this.btn_kick.visible=!!this.params.amILeader&&this.vo.baseInfo.playerId!=this.playerProxy.playerInfoVO.playerId&&this.params.canKick},n);function n(e){var t=o.call(this)||this;return t.playerProxy=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N),t.heroPy=s.AppFacade.getInstance().retrieveProxy(s.HeroPy.N),t.params=e,t.index=e.index,t.skinName="CommonJiJieMyTeamPanelRenderSkin",t}__reflect(c.prototype,"CommonJiJieMyTeamPanelRender")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),Object.defineProperty(n.prototype,"rootView",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),n.prototype.initNotice=function(){},n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.MailUI),this.addSubView(n.SV.INFO,i.MailInfo)},n.prototype.listNotificationInterests=function(){return[CN.LOGIN_FINAL_DONE,CN.MAIL_OPEN_MAIN,CN.MAIL_CLOSE_MAIN,CN.HIDE_ALL_SUBVIEW]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.MAIL_OPEN_MAIN:case CN.MAIL_CLOSE_MAIN:this.hideAllSubView(),this.rootView&&(this.rootView.visible=!1);break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView(),this.removeFromParent(),this.rootView&&(this.rootView.visible=!1);break;case CN.LOGIN_FINAL_DONE:this.mailProxy.getMailList()}},n.prototype.onViewCreate=function(){},n.N="MailMediator",n.SV={MAIN:1,INFO:2},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.mailProxy=i.AppFacade.getInstance().retrieveProxy(i.MailPy.N),t.initNotice(),t}i.MailMediator=e,__reflect(e.prototype,"game.MailMediator")}(game=game||{}),function(h){var t,e=(__extends(o,t=BasePanel),o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.rankMed.hideAllSubView()},this),this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin"},o.prototype.initUI=function(){this.configs.length&&1<this.configs.length?(this.tabbar.visible=!0,this.initTabbar(),this.onTabbarItemTap()):(this.tabbar.visible=!1,this.showPanel(this.configs[0]||this.configs)),this.initialized=!0},o.prototype.initTabbar=function(){var i=[];this.configs.forEach(function(e){var t={source:{},config:e};e.tabbarSource?t.source=e.tabbarSource:(t.source.up=e.type==o.VIEW_TYPE.RANK?"_btn_yq_m_json.jjc_yeqian_paiming_0":"_btn_yq_m_json.beibao_yeqian_baoxiang_0",t.source.down=e.type==o.VIEW_TYPE.RANK?"_btn_yq_m_json.jjc_yeqian_paiming_1":"_btn_yq_m_json.beibao_yeqian_baoxiang_1"),i.push(t)}),this.tabbar.dataProvider=new eui.ArrayCollection(i),this.tabbar.selectedIndex=this.index,this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabbarItemTap,this)},o.prototype.onTabbarItemTap=function(e){e&&null!=e.itemIndex&&e.itemIndex!=this.tabIndex&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.tabIndex=e.itemIndex);var t=this.tabbar.selectedItem.config;this.rankMed.hideAllContentPanel(),this.showPanel(t)},o.prototype.updateView=function(e){this.module=e&&e.module||this.module,this.index=e.index||0,this.module?this.configs=h.RankConfig.Config[this.module]:this.configs=e,this.configs&&(this.initialized||this.initUI())},o.prototype.showPanel=function(e){if(e.clickFunc)e.clickFunc();else{switch(e.type||o.VIEW_TYPE.RANK){case o.VIEW_TYPE.RANK:this.blb_title.text=e.mainTitle||"排行榜",this.rankMed.showSubView(h.RankMediator.SV.COMMON_RANK,e);break;case o.VIEW_TYPE.REWARD:this.blb_title.text=e.mainTitle||"奖励",this.rankMed.showSubView(h.RankMediator.SV.COMMON_REWARD,e)}e&&e.bottomLabel?this.lb_bottom.text=e.bottomLabel:this.lb_bottom.text=""}},o.prototype.perClose=function(){this.rankMed.hideAllContentPanel()},o.VIEW_TYPE={RANK:1,REWARD:2},o);function o(){var e=t.call(this)||this;return e.tabIndex=0,e.rankProxy=h.AppFacade.getInstance().retrieveProxy(h.RankPy.N),e.rankMed=h.AppFacade.getInstance().retrieveMediator(h.RankMediator.N),e.skinName="CommonRankAndRewardPanelSkin",e}h.CommonRankAndRewardPanel=e,__reflect(e.prototype,"game.CommonRankAndRewardPanel");var i,n=(__extends(a,i=BaseView),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.scaleX=this.scaleY=1,UIActionManager.hideScrollerBar(this.scl_list),this.list_item.itemRenderer=p,this.gp_tab1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onTabTap(1)},this),this.gp_tab2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onTabTap(2)},this)},a.prototype.updateView=function(e){this.config=e&&e.configs?e.configs:e,this.initialize?this.updateList(this.targetConfig):this.initial()},a.prototype.initial=function(){this.config.length&&1<this.config.length?(this.gp_tab1.visible=!0,this.gp_tab2.visible=!0,this.bm_tabTitle1.text=this.config[0].title||"",this.bm_tabTitle2.text=this.config[1].title||"",this.gp_topTitle.visible=!1,this.gp_topTitle2.visible=!0,this.gp_content.height=530,this.img_bg.height=664,this.onTabTap(1)):(this.gp_topTitle.visible=!0,this.gp_topTitle2.visible=!1,this.gp_tab1.visible=!1,this.gp_tab2.visible=!1,this.bm_tabTitle1.visible=!1,this.bm_tabTitle2.visible=!1,this.gp_content.height=593,this.img_bg.height=735,this.onTabTap()),this.initialize=!0},a.prototype.onTabTap=function(e){e?(this.gp_root.setChildIndex(this.gp_tab1,1==e?2:0),this.gp_root.setChildIndex(this.gp_tab2,1==e?0:2),this.img_bg.source=1==e?"common_img_shuzhidi_04_png":"common_img_shuzhidi_05_png",this.targetConfig=this.config[e-1],this.lb_name_desc2.text=(this.targetConfig.isGuild?"公会名称":this.targetConfig.isTeam&&"队伍")||"玩家姓名",this.lb_keyWord2.text=this.targetConfig.keyWord||"战力"):this.targetConfig=this.config[0]||this.config,p.targetTab=e,this.updateList(this.targetConfig)},a.prototype.updateSelfRank=function(e,t){var o=this;this.gp_playerHead.removeChildren();var i=e&&e.rank;if(i){var n=this.rankProxy.rankIcon(i);""!=n?(this.blb_rank.visible=!1,this.img_icon.visible=!0,this.img_icon.source=n):(this.blb_rank.visible=!0,this.img_icon.visible=!1,this.blb_rank.text=i.toString())}else this.img_icon.visible=!1,this.blb_rank.visible=!0,this.blb_rank.text="未上榜";if(this.lb_name.visible=!0,e.team)e.team.members.forEach(function(e,t){var i=customui.PlayerHeadFactory.create();i.blb_level.visible=!1,i.updateData({vo:e.baseInfo}),o.gp_playerHead.addChild(i)}),this.lb_name.visible=!1;else if(t)if(this.lb_name.x=220,e.guildBaseInfo){this.lb_name.text=e.guildBaseInfo.name;var a=customui.GuildHeadFactory.create();a.updateData({vo:e.guildBaseInfo}),this.gp_playerHead.addChild(a)}else this.lb_name.text=e.playerBaseInfo.name;else{var r=customui.PlayerHeadFactory.create();r.blb_level.visible=!1,r.updateData({vo:e.playerBaseInfo}),this.gp_playerHead.addChild(r),this.lb_name.x=220,this.lb_name.text=e.playerBaseInfo.name}if(this.gp_extra.visible=!1,this.gp_fightCap.visible=!1,this.lb_keyValue.visible=!1,this.targetConfig.getExtraItem)if(this.gp_extra.visible=!0,this.gp_extra.numChildren){if(this.targetConfig.updateExtraItem){var s=this.gp_extra.$children[0];this.targetConfig.updateExtraItem(s,e)}}else(s=this.targetConfig.getExtraItem(e)).horizontalCenter=s.verticalCenter=0,this.gp_extra.addChild(s);else this.targetConfig.keyWord?(this.lb_keyValue.visible=!0,this.lb_keyValue.text=e.key&&e.key.toString()||"0"):(this.gp_fightCap.visible=!0,this.item_fightCap.update(e.playerBaseInfo.fightCap))},a.prototype.updateList=function(r){var s=this;if(r.rankType==RankingType.RankingTypeGuildTranscript){var e=[];for(var t in r.getRankList()){var i={info:r.getRankList()[t],config:r};e.push(i)}0<e.length?this.gp_empty.visible=!1:this.gp_empty.visible=!0,this.list_item.dataProvider=new eui.ArrayCollection(e),this.updateSelfRank(r.getRank()[0])}else this.rankProxy.GetRankList(r,function(e){var t=e.ranks;if(0<t.length){s.scl_list.visible=!0,s.gp_empty.visible=!1;var i=[];for(var o in t){var n={info:t[o],config:r};i.push(n)}s.list_item.dataProvider=new eui.ArrayCollection(i)}else s.scl_list.visible=!1,s.gp_empty.visible=!0;var a=e.selfRank||{};a.playerBaseInfo=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N).playerInfoVO,a.guildBaseInfo=h.AppFacade.getInstance().retrieveProxy(h.GuildPy.N).guildDetail,s.updateSelfRank(a,r.isGuild)});this.lb_name_desc.text=(r.isGuild?"公会名称":r.isTeam&&"队伍")||"玩家姓名",this.lb_keyWord.text=r.keyWord||"战力",this.lb_bottom.text="",r.hideSelf&&(this.gp_selfRank.visible=!1)},a.prototype.getParentView=function(){return h.AppFacade.getInstance().retrieveMediator(h.RankMediator.N).getSubView(h.RankMediator.SV.COMMON).gp_content},a);function a(){var e=i.call(this)||this;return e.rankProxy=h.AppFacade.getInstance().retrieveProxy(h.RankPy.N),e.skinName="CommonRankPanelSkin",e}h.CommonRankPanel=n,__reflect(n.prototype,"game.CommonRankPanel");var r,s=(__extends(c,r=BaseView),c.prototype.childrenCreated=function(){r.prototype.childrenCreated.call(this),this.scaleX=this.scaleY=1,this.activateComponent()},c.prototype.initial=function(){this.configs.length&&1<this.configs.length?(this.gp_tab1.visible=!0,this.gp_tab2.visible=!0,this.bm_tabTitle1.text=this.configs[0].title||"",this.bm_tabTitle2.text=this.configs[1].title||"",this.gp_topTitle.visible=!1,this.gp_content.height=585,this.img_bg.height=664,this.onTabTap(1)):(this.gp_tab1.visible=!1,this.gp_tab2.visible=!1,this.bm_tabTitle1.visible=!1,this.bm_tabTitle2.visible=!1,this.lb_topLeft.text=this.configs[0].topTitle?"成就":"排名",this.img_bg.source=this.configs[0].topTitle?"common_img_shuzhidi_05_png":"common_img_shuzhidi_04_png",this.lb_topRight.x=this.configs[0].topTitle?272:326,this.gp_content.height=650,this.img_bg.height=735,this.onTabTap()),this.initialize=!0},c.prototype.updateView=function(e){this.configs=e&&e.configs||this.configs,this.initialize?this.updateList(this.targetConfig):this.initial(),this.notice=this.configs.notice,this.addNotice()},c.prototype.onTabTap=function(e){e?(this.gp_tab.setChildIndex(this.gp_tab1,1==e?2:0),this.gp_tab.setChildIndex(this.gp_tab2,1==e?0:2),this.img_bg.source=1==e?"common_img_shuzhidi_04_png":"common_img_shuzhidi_05_png",this.targetConfig=this.configs[e-1],this.targetConfig.desc?this.targetConfig.type==c.VIEW_TYPE.RANK?(this.gp_topTitle2.visible=!1,this.gp_topTitle3.visible=!0,this.lb_name_desc3.text=this.targetConfig.desc[0]||"",this.lb_keyWord3.text=this.targetConfig.desc[1]||""):(this.gp_topTitle2.visible=!0,this.gp_topTitle3.visible=!1,this.lb_topLeft2.text=this.targetConfig.desc[0]||"",this.lb_topRight2.text=this.targetConfig.desc[1]||""):(this.gp_topTitle2.visible=!1,this.gp_topTitle3.visible=!1)):(this.gp_topTitle2.visible=!1,this.gp_topTitle3.visible=!1,this.targetConfig=this.configs[0]||this.configs),g.targetTab=e,this.updateList(this.targetConfig),this.targetConfig.img_bestRank?this.img_bestRank.source=this.targetConfig.img_bestRank:this.img_bestRank.source="paiweisai_txt_ndlszgpm_png"},c.prototype.updateList=function(i){var o=this;if(i.getTopRankInfo){this.gp_topTitle.visible=!1,this.gp_rank_reward.visible=!0,this.scl_list.top=120;var e=i.getTopRankInfo();this.blb_rank.text=(e.topRank||0).toString(),this.lb_desc.text=e.desc,this.gp_rewards.removeChildren(),e.targetRewards.forEach(function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.65,t.updateData({reward:e}),o.gp_rewards.addChild(t)})}else this.gp_rank_reward.visible=!1,this.scl_list.top=0;var t=i.type;switch(this.gp_selfRank.visible=!1,this.scl_list.bottom=0,t){case c.VIEW_TYPE.RANK_REWARD:this.list_item.itemRenderer=g;break;case c.VIEW_TYPE.SCORE_REWARD:this.list_item.itemRenderer=m;break;case c.VIEW_TYPE.SCORE_REWARD2:this.list_item.itemRenderer=T;break;case c.VIEW_TYPE.RANK:this.list_item.itemRenderer=p,this.gp_selfRank.visible=!0,this.scl_list.bottom=50,i.hideSelf&&(this.gp_selfRank.visible=!1),h.GameMVC.rankPy.GetRankList(i,function(e){var t=e.selfRank||{};t.playerBaseInfo=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N).playerInfoVO,t.guildBaseInfo=h.AppFacade.getInstance().retrieveProxy(h.GuildPy.N).guildDetail,o.updateSelfRank(t,i.isGuild)})}this.scl_list.stopAnimation(),this.scl_list.viewport.scrollV=0;var n=i.getRewardList();this.list_item.dataProvider=new eui.ArrayCollection(n);var a=!1;for(var r in n)if(n[r].status==REWARD_STATUS.AVAILABLE){a=!0;break}i&&i.bottomBtn?(this.btn_bottom.label=i.bottomBtn.label,this.bottomBtnCb=function(){i.bottomBtn.callback&&i.bottomBtn.callback()},this.btn_bottom.visible=!0,UIActionManager.setAbsGrey(this.btn_bottom,!a),this.btn_bottom.touchEnabled=a):this.btn_bottom.visible=!1,this.lb_bottom.text=i.getBottomLabel&&i.getBottomLabel()||"",this.lb_bottomLeft.text=i.getBottomLeftLabel&&i.getBottomLeftLabel()||""},c.prototype.activateComponent=function(){var e=this;this.gp_tab1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onTabTap(1)},this),this.gp_tab2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onTabTap(2)},this),this.btn_bottom.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.bottomBtnCb&&e.bottomBtnCb()},this)},c.prototype.getParentView=function(){return h.AppFacade.getInstance().retrieveMediator(h.RankMediator.N).getSubView(h.RankMediator.SV.COMMON).gp_content},c.prototype.updateSelfRank=function(e,t){var o=this;this.gp_playerHead.removeChildren();var i=e&&e.rank;if(i){var n=h.GameMVC.rankPy.rankIcon(i);""!=n?(this.blb_selfRank.visible=!1,this.img_icon.visible=!0,this.img_icon.source=n):(this.blb_selfRank.visible=!0,this.img_icon.visible=!1,this.blb_selfRank.text=i.toString())}else this.img_icon.visible=!1,this.blb_selfRank.visible=!0,this.blb_selfRank.text="未上榜";if(this.lb_name.visible=!0,e.team)e.team.members.forEach(function(e,t){var i=customui.PlayerHeadFactory.create();i.blb_level.visible=!1,i.updateData({vo:e.baseInfo}),o.gp_playerHead.addChild(i)}),this.lb_name.visible=!1;else if(t)if(this.lb_name.x=220,e.guildBaseInfo){this.lb_name.text=e.guildBaseInfo.name;var a=customui.GuildHeadFactory.create();a.updateData({vo:e.guildBaseInfo}),this.gp_playerHead.addChild(a)}else this.lb_name.text=e.playerBaseInfo.name;else{var r=customui.PlayerHeadFactory.create();r.blb_level.visible=!1,r.updateData({vo:e.playerBaseInfo}),this.gp_playerHead.addChild(r),this.lb_name.x=220,this.lb_name.text=e.playerBaseInfo.name}if(this.gp_extra.visible=!1,this.gp_fightCap.visible=!1,this.lb_keyValue.visible=!1,this.targetConfig.getExtraItem)if(this.gp_extra.visible=!0,this.gp_extra.numChildren){if(this.targetConfig.updateExtraItem){var s=this.gp_extra.$children[0];this.targetConfig.updateExtraItem(s,e)}}else(s=this.targetConfig.getExtraItem(e)).horizontalCenter=s.verticalCenter=0,this.gp_extra.addChild(s);else if(this.targetConfig.keyWord){if(this.lb_keyValue.visible=!0,this.lb_keyValue.text=e.key&&e.key.toString()||"0",this.targetConfig.rankType==RankingType.RankingTypeActivityNewZoneDoubleElevenRank&&(this.lb_keyValue.visible=!0,e.key&&0!=e.key)){var c=e.key%1e3,l=Math.ceil(e.key/1e3);this.lb_keyValue.text=c+"级("+l+")"}}else this.gp_fightCap.visible=!0,this.item_fightCap.update(e.playerBaseInfo.fightCap)},c.prototype.addNotice=function(){this.configs[1]&&this.configs[1].notice&&this.configs[1].notice!=this.notice&&(this.notice=this.configs[1].notice,NoticeManager.addNoticeListener(this.notice,this.gp_notice,this))},c.VIEW_TYPE={RANK_REWARD:1,SCORE_REWARD:2,SCORE_REWARD2:3,RANK:4},c);function c(){var e=r.call(this)||this;return e.initialize=!1,e.skinName="CommonRewardPanelSkin",e}h.CommonRewardPanel=s,__reflect(s.prototype,"game.CommonRewardPanel");var l,p=(l=eui.ItemRenderer,__extends(d,l),d.prototype.childrenCreated=function(){l.prototype.childrenCreated.call(this)},d.prototype.updateItem=function(e){this.data=e,this.dataChanged()},d.prototype.dataChanged=function(){var i=this;if(this.img_bg.source=d.targetTab?1==d.targetTab?"jjc_img_paihangbang02_png":"zudui_img_liebiaotiao_png":"jjc_img_paihangbang02_png",this.gp_guildHead.visible=!1,this.gp_avatar.visible=!1,this.lb_name.visible=!0,this.data.info&&this.data.info.rank)if(this.gp_rank.visible=!0,this.data.info.team){function e(t){var e=customui.PlayerHeadFactory.create();e.addTapEvent(function(){var e=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N);i.data.info.team.members&&i.data.info.team.members[t].baseInfo.playerId!=e.playerInfoVO.playerId&&h.AppFacade.getInstance().showSubView(h.FriendMediator.N,h.FriendMediator.SV.INFO,{playerId:i.data.info.team.members[t].baseInfo.playerId,source:"rankingType"+i.data.config.rankType}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)}),e.blb_level.visible=!1,o.playerHeads.push(e),o.gp_avatar.addChild(e)}this.gp_avatar.visible=!0;for(var o=this,t=this.playerHeads.length;t<3;t++)e(t);this.updateForTeam()}else{if(this.gp_avatar.numChildren<=0){var n=customui.PlayerHeadFactory.create();n.blb_level.visible=!1,this.data.config.blockTouch||(n.touchEnabled=!0,n.addTapEvent(function(){var e=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N);i.data.info.playerBaseInfo&&i.data.info.playerBaseInfo.playerId!=e.playerInfoVO.playerId&&h.AppFacade.getInstance().showSubView(h.FriendMediator.N,h.FriendMediator.SV.INFO,{playerId:i.data.info.playerBaseInfo.playerId,source:"rankingType"+i.data.config.rankType}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)})),this.playerHeads.push(n),this.gp_avatar.addChild(n)}if(this.data.config.isGuild){if(this.gp_guildHead.visible=!0,0==this.gp_guildHead.$children.length){var a=customui.GuildHeadFactory.create();this.gp_guildHead.addChild(a)}this.updateForGuild()}else this.gp_avatar.visible=!0,this.updateForPlayer()}else this.gp_rank.visible=!1},d.prototype.updateForPlayer=function(){var e=this.data.info;this.data.config,this.playerHeads[0].updateData({vo:e.playerBaseInfo}),this.lb_name.text=e.playerBaseInfo.name,this.lb_name.x=215,this.updateCommonPart()},d.prototype.updateForGuild=function(){var e=this.data.info;this.lb_name.text=e.guildBaseInfo.name,this.lb_name.x=215,this.gp_guildHead.$children[0].updateData({vo:e.guildBaseInfo}),this.updateCommonPart()},d.prototype.updateForTeam=function(){var i=this,e=this.data.info;this.data.config,e.team.members.forEach(function(e,t){i.playerHeads[t].updateData({vo:e.baseInfo})}),this.lb_name.visible=!1,this.updateCommonPart()},d.prototype.updateCommonPart=function(){var e=this.data.info,t=this.data.config,i=e.rank;if(i){var o=this.rankProxy.rankIcon(i);""!=o?(this.blb_rank.visible=!1,this.img_icon.visible=!0,this.img_icon.source=o):(this.blb_rank.visible=!0,this.img_icon.visible=!1,this.blb_rank.text=i.toString())}if(this.gp_extra.visible=!1,this.gp_fightCap.visible=!1,this.lb_keyValue.visible=!1,t.getExtraItem)if(this.gp_extra.visible=!0,this.gp_extra.numChildren){if(t.updateExtraItem){var n=this.gp_extra.$children[0];t.updateExtraItem(n,e)}}else(n=t.getExtraItem(e))&&(n.horizontalCenter=n.verticalCenter=0,this.gp_extra.addChild(n));else if(t.keyWord){if(this.lb_keyValue.visible=!0,this.lb_keyValue.text=e.key.toString(),t.rankType==RankingType.RankingTypeActivityNewZoneDoubleElevenRank&&(this.lb_keyValue.visible=!0,0!=e.key)){var a=e.key%1e3,r=Math.ceil(e.key/1e3);this.lb_keyValue.text=a+"级("+r+")"}}else this.gp_fightCap.visible=!0,e.playerBaseInfo?this.item_fightCap.update(e.playerBaseInfo.fightCap):this.gp_fightCap.visible=!1},d.targetTab=1,d);function d(){var e=l.call(this)||this;return e.rankProxy=h.AppFacade.getInstance().retrieveProxy(h.RankPy.N),e.skinName="CommonRankPanel_RankItem",e.playerHeads=[],e}h.CommonRankPanel_RankItem=p,__reflect(p.prototype,"game.CommonRankPanel_RankItem");var u,g=(u=eui.ItemRenderer,__extends(f,u),f.prototype.childrenCreated=function(){u.prototype.childrenCreated.call(this)},f.prototype.dataChanged=function(){var t=this;this.img_bg.source=1==f.targetTab?"jjc_img_paihangbang02_png":"zudui_img_liebiaotiao_png",this.img_bg.source=this.data.backColor?"jjc_img_paihangbang02_png":this.img_bg.source;var e=this.data.rank;if(e){var i=this.rankProxy.rankIcon(e);""!=i?(this.blb_rank.visible=!1,this.img_icon.visible=!0,this.img_icon.source=i):(this.blb_rank.visible=!0,this.img_icon.visible=!1,this.blb_rank.text=e.toString())}else this.blb_rank.visible=!1,this.img_icon.visible=!0,this.img_icon.source=this.data.icon||"";var o=JSON.parse(this.data.rewards);this.gp_rewards.removeChildren(),o.forEach(function(e){t.gp_rewards.addChild(new customui.CommonIconWithNum({style:CommonIconStyle.RIGHT,showEnough:!1,code:e[1],num:e[2],showDetail:!0}))})},f.targetTab=1,f);function f(){var e=u.call(this)||this;return e.rankProxy=h.AppFacade.getInstance().retrieveProxy(h.RankPy.N),e.skinName="CommonRewardPanel_RewardItem",e}h.CommonRewardPanel_RewardItem=g,__reflect(g.prototype,"game.CommonRewardPanel_RewardItem");var _,m=(_=eui.ItemRenderer,__extends(y,_),y.prototype.childrenCreated=function(){_.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc()},this),this.pb.slideDuration=0},y.prototype.dataChanged=function(){var i=this;this.lb_desc.text=this.data.desc,this.pb.maximum=this.data.pbMax,this.pb.value=this.data.pbValue,this.btnFunc=this.data.btnFunc,this.data.status==REWARD_STATUS.RECEIVED?(this.btn_get.visible=!1,this.gp_got.visible=!0):(this.btn_get.visible=!0,this.gp_got.visible=!1,this.data.status==REWARD_STATUS.AVAILABLE?(this.btn_get.enabled=!0,UIActionManager.setAbsGrey(this.btn_get,!1)):(this.btn_get.enabled=!1,UIActionManager.setAbsGrey(this.btn_get,!0)));var e=JSON.parse(this.data.rewards);this.gp_rewards.removeChildren(),e.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),t.scaleX=t.scaleY=.7,i.gp_rewards.addChild(t)})},y);function y(){var e=_.call(this)||this;return e.skinName="CommonRewardPanel_RewardItem2",e}h.CommonRewardPanel_RewardItem2=m,__reflect(m.prototype,"game.CommonRewardPanel_RewardItem2");var v,T=(v=eui.ItemRenderer,__extends(C,v),C.prototype.childrenCreated=function(){v.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc()},this)},C.prototype.dataChanged=function(){var i=this;this.lb_desc.text=this.data.desc,this.lb_desc.verticalCenter=10,this.pb.visible=!1,this.btnFunc=this.data.btnFunc,this.img_bg.source=this.data.backColor?"jjc_img_paihangbang02_png":this.img_bg.source,this.data.status==REWARD_STATUS.RECEIVED?(this.btn_get.visible=!1,this.gp_got.visible=!0):(this.btn_get.visible=!0,this.gp_got.visible=!1,this.data.status==REWARD_STATUS.AVAILABLE?(this.btn_get.enabled=!0,UIActionManager.setAbsGrey(this.btn_get,!1),UIActionManager.addEffect(this.btn_get,"common_lingquanniu",{scaleX:.9,scaleY:.9,offectY:-3.5})):(this.btn_get.enabled=!1,UIActionManager.setAbsGrey(this.btn_get,!0),UIActionManager.hideEffect(this.btn_get)));var e=JSON.parse(this.data.rewards);this.gp_rewards.removeChildren(),e.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),t.scaleX=t.scaleY=.7,i.gp_rewards.addChild(t)})},C);function C(){var e=v.call(this)||this;return e.skinName="CommonRewardPanel_RewardItem2",e}h.CommonRewardPanel_RewardItem3=T,__reflect(T.prototype,"game.CommonRewardPanel_RewardItem3");var E,I=(__extends(b,E=BaseView),b.prototype.childrenCreated=function(){E.prototype.childrenCreated.call(this),this.top=-750,this.horizontalCenter=-240,this.scaleX=this.scaleY=2},b.prototype.updateView=function(e){var t=this;e&&e.roleModel&&(this.role_model.update(e.roleModel),this.role_model.visible=!1,egret.setTimeout(function(){t.role_model.onChangingDir(1),t.role_model.visible=!0},this,1e3))},b.prototype.getParentView=function(){return h.AppFacade.getInstance().retrieveMediator(h.RankMediator.N).getSubView(h.RankMediator.SV.COMMON).gp_content},b);function b(){var e=E.call(this)||this;return e.skinName="CommonRankModel",e}h.CommonRankModel=I,__reflect(I.prototype,"game.CommonRankModel")}(game=game||{}),function(e){var o,t=(o=puremvc.SimpleCommand,__extends(i,o),i.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【"+this.key+"】："].concat(e))},i.prototype.register=function(){e.AppFacade.getInstance().registerCommand(this.key,this.thiz)},i.prototype.checkCB=function(e,t){return void 0===t&&(t=!0),!e.err||!t||(Utils.MsgUtils.addErrMsg(e.err),!1)},i);function i(e,t){var i=o.call(this)||this;return i.key=e,i.thiz=t,i}e.ProcessorBase=t,__reflect(t.prototype,"game.ProcessorBase",["puremvc.ICommand","puremvc.INotifier"])}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),Object.defineProperty(n.prototype,"rootView",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.TaskView),this.addSubView(n.SV.UNLOCK,i.UnlockTaskPanel),this.addSubView(n.SV.SECOND_ACHIEVEMENT,i.SecondAchievementPanel)},n.prototype.listNotificationInterests=function(){return[CN.TASK_OPEN_MAIN,CN.HIDE_ALL_SUBVIEW,CN.TASK_GET_REWARDS_POP_CLOSE,CN.LOGIN_FINAL_DONE,CN.GENERAL_PASS_DAY,CN.UNLOCK_TASK_GET_DATA,CN.UNLOCK_TASK_UPDATE]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.TASK_OPEN_MAIN:i.AppFacade.getInstance().showSubView(n.N,n.SV.MAIN);break;case CN.HIDE_ALL_SUBVIEW:this.rootView&&(this.hideAllSubView(),this.removeFromParent());break;case CN.TASK_GET_REWARDS_POP_CLOSE:var t=this.getSubView(n.SV.MAIN);t&&t.updateView();break;case CN.GENERAL_PASS_DAY:case CN.LOGIN_FINAL_DONE:this.proxy.fetch(TaskType.Daily),this.proxy.fetch(TaskType.Achievement),this.proxy.fetch(TaskType.Guide),this.proxy.fetch(TaskType.BraveBook),this.proxy.fetch(TaskType.NewBraveBook),this.proxy.fetch(TaskType.NewNewBraveBook),this.proxy.fetch(TaskType.HideAchievement),this.proxy.fetch(TaskType.DifficultyGuide),this.proxy.fetch(TaskType.SecondAchievement),this.proxy.GetTaskDone(1),this.proxy.GetTaskDone(10),this.proxy.GetSecondAchievementTask()}},n.prototype.onViewCreate=function(){},n.N="TaskMediator",n.SV={MAIN:1,UNLOCK:2,SECOND_ACHIEVEMENT:3},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.TaskPy.N),t}i.TaskMediator=e,__reflect(e.prototype,"game.TaskMediator")}(game=game||{}),function(t){var e,i=(__extends(o,e=BaseMediator),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,t.TouchGoldHand)},o.prototype.listNotificationInterests=function(){return[CN.LOGIN_FINAL_DONE,CN.GENERAL_PASS_DAY]},o.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.GENERAL_PASS_DAY:case CN.LOGIN_FINAL_DONE:t.AppFacade.getInstance().retrieveProxy(t.TouchGoldHandPy.N).getTouchGoldHandInfo()}},o.N="TouchGoldHandMediator",o.SV={MAIN:1},o);function o(){return e.call(this,o.N,o)||this}t.TouchGoldHandMediator=i,__reflect(i.prototype,"game.TouchGoldHandMediator")}(game=game||{}),function(t){var i,e=(__extends(o,i=BaseMediator),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,t.ArenaView)},o.prototype.initNotice=function(){},o.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.ARENA_UPDATE_INFO,CN.ARENA_UPDATE_OPPONENT,CN.PLAYER_LEVEL_UP,CN.LOGIN_FINAL_DONE]},o.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.ARENA_UPDATE_INFO:case CN.ARENA_UPDATE_OPPONENT:this.updateView(o.SV.MAIN);break;case CN.PLAYER_LEVEL_UP:t.AppFacade.getInstance().retrieveProxy(t.ArenaPy.N).handleDotInfo(!0);break;case CN.LOGIN_FINAL_DONE:t.AppFacade.getInstance().retrieveProxy(t.ArenaPy.N).GetArenaInfo()}},o.prototype.onViewCreate=function(){},o.N="ArenaMediator",o.SV={MAIN:1},o);function o(e){void 0===e&&(e=null);var t=i.call(this,o.N,e)||this;return t.initNotice(),t}t.ArenaMediator=e,__reflect(e.prototype,"game.ArenaMediator")}(game=game||{}),function(t){var i,e=(i=eui.Component,__extends(o,i),o.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.btn_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.fightCB&&e.fightCB(e.vo)},this),this.btn_mopUp.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.mopUpCB&&e.mopUpCB()},this),this.addChild(this.cu_playerHead),this.cu_playerHead.scaleX=this.cu_playerHead.scaleY=.7,this.cu_playerHead.x=137,this.cu_playerHead.y=14,this.cu_playerHead.addTapEvent(function(){e.vo&&game.AppFacade.getInstance().showSubView(game.FriendMediator.N,game.FriendMediator.SV.INFO,{playerId:e.vo.playerId})})},o.prototype.update=function(e){var t=this;if(e){this.vo=e.vo,this.fightCB=e.fightCB,this.mopUpCB=e.mopUpCB;var i=e.canFight,o=e.canMopUp;this.vo?(this.lb_name.text=this.vo.name,3<this.vo.rank?(this.blb_rank.visible=!0,this.img_rank.visible=!1,this.blb_rank.text=this.vo.rank.toString()):(this.blb_rank.visible=!1,this.img_rank.visible=!0,RES.getResAsync("jjc_icon_pm_"+this.vo.rank+"_png",function(e){t.img_rank.source=e},this)),this.cu_playerHead.updateData({vo:this.vo}),this.item_fightCap.update(this.vo.fightCap),this.btn_fight.visible=i,this.btn_mopUp.visible=o,this.vo.rank==this.proxy.arenaInfo.rank&&(this.btn_fight.visible=!1)):this.btn_fight.visible=!1}},o);function o(){var e=i.call(this)||this;return e.skinName="ArenaPlayerItemSkin",e.cu_playerHead=t.PlayerHeadFactory.create(),e.proxy=game.AppFacade.getInstance().retrieveProxy(game.ArenaPy.N),e}t.ArenaPlayerItem=e,__reflect(e.prototype,"customui.ArenaPlayerItem",["eui.UIComponent","egret.DisplayObject"])}(customui=customui||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.ChampionView),this.addSubView(n.SV.PREVIEW,i.ChampionBossPreview),this.addSubView(n.SV.ACHIEVEMENT,i.ChampionAchievement)},n.prototype.initNotice=function(){},n.prototype.listNotificationInterests=function(){return[CN.CHAMPION_UPDATE_INFO,CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE]},n.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:i.AppFacade.getInstance().retrieveProxy(i.ChampionPy.N).Champion();break;case CN.CHAMPION_UPDATE_INFO:this.updateView(n.SV.MAIN,t),this.updateView(n.SV.ACHIEVEMENT)}},n.prototype.onViewCreate=function(){this.sendNotification(CN.CITY_SWITCH_DBCLOCKPAUSE,!0)},n.N="ChampionMediator",n.SV={MAIN:1,PREVIEW:2,ACHIEVEMENT:3},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.championProxy=i.AppFacade.getInstance().retrieveProxy(i.ChampionPy.N),t.initNotice(),t}i.ChampionMediator=e,__reflect(e.prototype,"game.ChampionMediator")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.ENTRANCE,i.CopyEntranceView),this.addSubView(n.SV.DAILY_COPY,i.DailyCopyEntrance),this.addSubView(n.SV.DAILY_COPY_LIST,i.DailyCopyListPanel),this.addSubView(n.SV.EXPEDITION,i.ExpeditionView),this.addSubView(n.SV.EXPEDITION_CHALLENGE,i.ExpeditionehCallengeView),this.addSubView(n.SV.ACHIEVE_REWARD,i.ExpeditionAchievementRewardPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.PLAYER_LEVEL_UP]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.DailyFortress,!1).allow&&this.proxy.GetDailyFortress(),Utils.UnlockMgr.checkPass(MODULE.Expedition,!1).allow&&this.proxy.GetExpeditionInfo();break;case CN.PLAYER_LEVEL_UP:NoticeManager.updateNotice(NT.DAILY_COPY),Utils.UnlockMgr.checkPass(MODULE.Expedition,!1).allow&&this.proxy.GetExpeditionInfo();case CN.GENERAL_PASS_DAY:Utils.UnlockMgr.checkPass(MODULE.Expedition,!1).allow&&this.proxy.GetExpeditionInfo()}},n.N="CopyEntranceMediator",n.SV={ENTRANCE:1,DAILY_COPY:2,DAILY_COPY_LIST:3,EXPEDITION:4,EXPEDITION_CHALLENGE:5,ACHIEVE_REWARD:6},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.CopyEntrancePy.N),t}i.CopyEntranceMediator=e,__reflect(e.prototype,"game.CopyEntranceMediator")}(game=game||{}),function(c){var n,e=(__extends(t,n=BasePanel),t.prototype.childrenCreated=function(){var o=this;n.prototype.childrenCreated.call(this),this.initFilter(),this.initBtnListener(),this.dragGroup.initConfig({0:{x:22.5,y:127,w:63,h:63},1:{x:99,y:127,w:63,h:63},2:{x:176,y:127,w:63,h:63},3:{x:22.5,y:248.5,w:63,h:63},4:{x:99,y:248.5,w:63,h:63},5:{x:176,y:248.5,w:63,h:63}}),this.dragGroup.dragDoneCB=this.exchangeHero.bind(this),this.dragGroup.onTapCB=function(e,t){var i=o.heroList[o.curIndex][e];o.touchHeroEvent(!1,{info:c.GameMVC.heroPy.allHeroByUuid[i]}),o.updateAllHeroByFilter(),t&&t()};for(var e=0;e<6;e++){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.6,t.touchEnabled=!1,this.id2baseitem[e]=t,this.id2baseitem[e].resetFixedStyle(EEntityType.EEntityTypeHero),this.dragGroup.addItem2Id(t,e)}this.initHeroPetArtLocalList(),this.params&&this.params.enermy&&(this.lb_name0.text=this.params.enermy.name,this.fightCapItem0.update(this.params.enermy.fightCap),this.player0.updateData({vo:this.params.enermy})),this.player1.updateData({vo:c.GameMVC.playerPy.playerInfoVO}),this.lb_name1.text=c.GameMVC.playerPy.playerInfoVO.name,this.fightCapItem1.update(c.GameMVC.playerPy.playerInfoVO.fightCap),this.e_baseitem6.touchEnabled=!1,this.e_baseitem7.touchEnabled=!1,this.gp_myPet.touchChildren=!1,this.gp_myArt.touchChildren=!1,this.updateView()},t.prototype.initBtnListener=function(){var t=this;this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.getUpHeroList();if(this.params.touchHoldCB){var t=this.params.touchHoldCB(e);t&&(this.opperationParams=1,this.backProxy.ChangeFormation({type:this.params.module,teams:t},this.hide.bind(this)))}else this.opperationParams=1,this.backProxy.ChangeFormation({type:this.params.module,teams:e},this.hide.bind(this))},this),this.gp_myPet.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypePet,team:t.curIndex+1,list:t.petList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.gp_myArt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypeMagical,team:t.curIndex+1,list:t.artList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.btn_oneKeyDown.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){c.GameMgr.getInstance().showCommonTipsWin({commonTips:"确定清空当前队伍配置？",clickCB:function(e){e.type&&(t.heroList[t.curIndex]=["","","","","",""],t.petList[t.curIndex]="",t.artList[t.curIndex]="",t.updateView())}})},this),this.btn_switchTeam.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.backProxy.ChangeFormation({type:t.params.module,teams:t.getUpHeroList()},function(){c.GameMVC.gloryArenaPy.GetGloryDefendTeam(t.params.enermy.playerId,function(e){PopUpManager.addPopUp({obj:new c.GloryArenaFormationView2({self:{vo:c.GameMVC.playerPy.playerInfoVO,teams:c.GameMVC.backpackPy.getModuleTeam(t.params.module).teams},enemy:{vo:t.params.enermy,teams:e}}),closeCB:function(i){var e=t.getUpHeroList();e.forEach(function(e,t){e.teamNo=i[e.teamNo]}),t.backProxy.ChangeFormation({type:t.params.module,teams:e},function(){t.initHeroPetArtLocalList(),t.updateView()})}})})})},this),this.btn_filter.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_filters.visible=!0;var e=this.gp_filter.globalToLocal(0,0),t=new egret.Sprite;t.touchEnabled=!0,t.graphics.beginFill(0,0),t.graphics.drawRect(e.x,e.y,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),t.graphics.endFill(),this.gp_filter.addChildAt(t,2),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.gp_filters.visible=!1,t.parent&&t.parent.removeChild(t)},this)},this),this.btn_team0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.curIndex=0,t.updateView()},this),this.btn_team1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.curIndex=1,t.updateView()},this),this.btn_team2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.curIndex=2,t.updateView()},this)},t.prototype.initFilter=function(){var o=this;this.gp_filters_list.removeChildren();var e=this.ITEM_TYPE_CONFIG[c.BackpackUI.ITEM_TYPE.HERO].filterConfig.data;e&&0<e.length?(this.gp_filter.visible=!0,e.forEach(function(e){var t=new eui.List;t.itemRenderer=c.DecomposeUI_FilterItem;var i=new eui.HorizontalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER,t.layout=i,t.dataProvider=new eui.ArrayCollection(e),t.addEventListener(eui.ItemTapEvent.ITEM_TAP,o.filterItem_onItemTap,o),o.gp_filters_list.addChild(t)}),this.gp_filters.height=42*e.length+20*(e.length-1)+40):this.gp_filter.visible=!1},t.prototype.filterItem_onItemTap=function(e){var t=e.itemRenderer;if(this.ITEM_TYPE_CONFIG[c.BackpackUI.ITEM_TYPE.HERO].filterConfig.addFilter(this.curFilter,e.item),!t.chosen)for(var i=0,o=this.gp_filters_list.$children;i<o.length;i++){var n=o[i];if(-1!=n.$children.indexOf(t))for(var a=0,r=n.$children;a<r.length;a++){var s=r[a];s.chosen&&s.setChosen(!1)}}t.setChosen(!t.chosen),this.updateAllHeroByFilter()},t.prototype.updateView=function(e){var o=this;this.params=e||this.params||{},this.getAllHeroList(),this.updateAllHeroByFilter(),this.updateUpHeroBI(),this.updatePetAndArtInfo();for(var t=0;t<3;t++){var i=this["img_light"+t];i&&(i.visible=t==this.curIndex)}this.lb_tips.visible=this.params&&this.params.tips,this.params&&this.params.tips&&(this.lb_tips.text=this.params&&this.params.tips);var n=this.params.enermy.teams.filter(function(e){return e.teamNo==o.curIndex+1})[0];if(n){function a(t){var i=!1;n.heroList.forEach(function(e){e.pos==t&&(e.uuid="",o["e_baseitem"+(t-1)].updateData({vo:e}),o["e_baseitem"+(t-1)].touchEnabled=!0,i=!0)}),i||(r["e_baseitem"+(t-1)].resetFixedStyle(EEntityType.EEntityTypeHero),r["e_baseitem"+(t-1)].touchEnabled=!1)}var r=this;for(t=1;t<=6;t++)a(t);n.petList[0]?this.e_baseitem6.updateData({type:EEntityType.EEntityTypePet,code:n.petList[0].code}):(this.e_baseitem6.resetFixedStyle(EEntityType.EEntityTypeHero),this.e_baseitem6.img_icon.source="sycx_img_chongwu_png"),n.magicalList[0]?this.e_baseitem7.updateData({type:EEntityType.EEntityTypeMagical,code:n.magicalList[0].code}):(this.e_baseitem7.resetFixedStyle(EEntityType.EEntityTypeHero),this.e_baseitem7.img_icon.source="baowu_img_wuqi_png")}},t.prototype.updateUpHeroBI=function(){var i=this;this.heroList[this.curIndex].forEach(function(e,t){e?(i.id2baseitem[t].updateData({type:EEntityType.EEntityTypeHero,uuid:e}),i.id2baseitem[t].img_zudui.visible=!1):i.id2baseitem[t].resetFixedStyle(EEntityType.EEntityTypeHero)})},t.prototype.getAllHeroList=function(){this.allHeroInfo=[];var e=this.ITEM_TYPE_CONFIG[c.BackpackUI.ITEM_TYPE.HERO].getAllInfo();if(e)for(var t in e){var i=e[t];this.allHeroInfo.push({type:c.BackpackUI.ITEM_TYPE.HERO,info:i,teamNum:this.judgeUpTeam(i.uuid),touchCB:this.touchHeroEvent.bind(this)})}},t.prototype.updateAllHeroByFilter=function(){this.scroller_hero.stopAnimation();var e=[],t=this.ITEM_TYPE_CONFIG[c.BackpackUI.ITEM_TYPE.HERO],i=t.filterConfig&&t.filterConfig.filterFunc||function(){return!0},o=t.sortConfig&&t.sortConfig.defaultSortFunc,n=t.getAllInfo();if(n)for(var a in n){var r=n[a];i(this.curFilter,r)&&e.push({type:c.BackpackUI.ITEM_TYPE.HERO,info:r,teamNum:this.judgeUpTeam(r.uuid),touchCB:this.touchHeroEvent.bind(this)})}0<e.length&&o&&e.sort(o),this.dataprovider=new eui.ArrayCollection(e),this.list_hero.itemRenderer=s,this.list_hero.dataProvider=this.dataprovider},t.prototype.initHeroPetArtLocalList=function(){var a=this,e=this.backProxy.getModuleTeam(this.params.module);if(this.heroList=[["","","","","",""],["","","","","",""],["","","","","",""]],e&&e.teams){var r=e.teams;r.forEach(function(e,t){for(var i=0;i<6;i++)for(var o in a.heroList[t][i]="",r[t].heros){var n=r[t].heros[o];if(n.battlePos==i+1){a.heroList[t][i]=n.uuid;break}}})}if(e&&e.teams){for(var t=e.teams,i=0;i<t.length;i++)this.petList[i]=t[i].petUuid?t[i].petUuid:"",this.artList[i]=t[i].magicalUuid?t[i].magicalUuid:"";this.updatePetAndArtInfo()}},t.prototype.updatePetAndArtInfo=function(){this.img_addpet_1.visible=!0,this.img_addart_1.visible=!0;var e=this.curIndex,t=void 0,i=void 0,o=this.petList[e],n=this.artList[e];""!=o&&(t=this.petProxy.allPetByUuid[o]),""!=n&&(i=this.artProxy.allMagicalArtifactByUuid[n]),t?(this.img_addpet_1.visible=!1,this.s_baseitem6.updateData({type:EEntityType.EEntityTypePet,code:t.code}),this.s_baseitem6.visible=!0):(this.img_addpet_1.visible=!0,this.s_baseitem6.visible=!1),i?(this.img_addart_1.visible=!1,this.s_baseitem7.updateData({type:EEntityType.EEntityTypeMagical,code:i.code}),this.s_baseitem7.visible=!0):(this.img_addart_1.visible=!0,this.s_baseitem7.visible=!1)},t.prototype.updatePetOrArtUuidByChoose=function(e,t){e==EEntityType.EEntityTypeMagical?this.artList=t:e==EEntityType.EEntityTypePet&&(this.petList=t),this.updatePetAndArtInfo()},t.prototype.judgeUpTeam=function(i){var o=0;return this.heroList.forEach(function(e,t){o||e.forEach(function(e){e==i&&(o=t+1)})}),o},t.prototype.getUpHeroList=function(){for(var e=[],t={heros:[],petUuid:this.petList[0],magicalUuid:this.artList[0],teamNo:1},i={heros:[],petUuid:this.petList[1],magicalUuid:this.artList[1],teamNo:2},o={heros:[],petUuid:this.petList[2],magicalUuid:this.artList[2],teamNo:3},n=0;n<6;n++)this.heroList[0][n]&&t.heros.push({uuid:this.heroList[0][n],battlePos:n+1}),this.heroList[1][n]&&i.heros.push({uuid:this.heroList[1][n],battlePos:n+1}),this.heroList[2][n]&&o.heros.push({uuid:this.heroList[2][n],battlePos:n+1});return e.push(t),e.push(i),e.push(o),e},t.prototype.touchHeroEvent=function(e,o,t){var i=this;if(e){var n=0;if(this.heroList[this.curIndex].forEach(function(e,t){n||e||(n=t+1)}),0==n)Utils.MsgUtils.addMidMsg("当前阵容已上满");else{var a=0==o.info.dermaCode?void 0:c.Config.getHeroDermaConfig()[o.info.dermaCode].avatar;o.teamNum=this.curIndex+1,this.id2baseitem[n-1].updateData({vo:o.info,type:EEntityType.EEntityTypeHero,avatar:a}),this.heroList[this.curIndex][n-1]=o.info.uuid,t&&t()}}else{var r=0,s=0;this.heroList.forEach(function(e,i){r||e.forEach(function(e,t){r||e==o.info.uuid&&(r=i+1,s=t+1)})}),0!=r&&(r==this.curIndex+1?(this.id2baseitem[s-1].resetFixedStyle(EEntityType.EEntityTypeHero),o.teamNum=0,this.heroList[r-1][s-1]="",t&&t()):c.GameMgr.getInstance().showCommonTipsWin({commonTips:"该英雄在第"+r+"队上，确定将其下阵？",source:"Glory_TeamMember_Down",cb:!0,clickCB:function(e){e.type&&(o.teamNum=0,i.heroList[r-1][s-1]="",t&&t())}}))}},t.prototype.exchangeHero=function(e,t,i){if(e<0||t<0)i&&i();else{var o=this.heroList[this.curIndex][e];this.heroList[this.curIndex][e]=this.heroList[this.curIndex][t],this.heroList[this.curIndex][t]=o,this.updateUpHeroBI(),i&&i()}},t.prototype.perClose=function(){this.params.doneCB&&this.params.doneCB()},t);function t(e){var t,i=n.call(this)||this;return i.backProxy=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N),i.playerProxy=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N),i.heroProxy=c.AppFacade.getInstance().retrieveProxy(c.HeroPy.N),i.petProxy=c.AppFacade.getInstance().retrieveProxy(c.PetPy.N),i.artProxy=c.AppFacade.getInstance().retrieveProxy(c.MagicalArtifactPy.N),i.allHeroInfo=[],i.id2baseitem=[],i.curIndex=0,i.dataprovider=new eui.ArrayCollection,i.curFilter={},i.heroList=[[],[],[]],i.petList=[],i.artList=[],i.ITEM_TYPE_CONFIG=((t={})[c.BackpackUI.ITEM_TYPE.HERO]={desc:"英雄",hasHankBook:!0,barSource:{up:"_btn_yq_m_json.beibao_yeqian_yingxiong_0",down:"_btn_yq_m_json.beibao_yeqian_yingxiong_1"},getAllInfo:function(){var e=[],t=c.AppFacade.getInstance().retrieveProxy(c.HeroPy.N);for(var i in t.allHeroByUuid){var o=t.allHeroByUuid[i];0==o.config.race&&0==o.config.profession||e.push(o)}return e},filterConfig:{data:[[{race:HeroRaceType.Human,icon:HeroRaceConfig[HeroRaceType.Human].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Elf,icon:HeroRaceConfig[HeroRaceType.Elf].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Orc,icon:HeroRaceConfig[HeroRaceType.Orc].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Athanasy,icon:HeroRaceConfig[HeroRaceType.Athanasy].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Demon,icon:HeroRaceConfig[HeroRaceType.Demon].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Eldar,icon:HeroRaceConfig[HeroRaceType.Eldar].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"}]],filterFunc:function(e,t){var i=!e.race||0==e.race.length||-1!=e.race.indexOf(t.config.race),o=!e.star||0==e.star.length||-1!=e.star.indexOf(t.starLevel);return i&&o},addFilter:function(e,t){var i=t.race?"race":"star";e[i]||(e[i]=[]);var o=e[i].indexOf(t[i]);-1==o?(e[i].splice(0),e[i].push(t[i])):e[i].splice(o,1)},autoFilterFunc:function(e,t){return e.starLevel<=4},autoFilterTipsFunc:function(e){return"无五星以下英雄"}},sortConfig:{data:[{desc:"等级"},{desc:"星级"}],getSortFunc:function(e){switch(e){case 0:return function(e,t){return t.info.level-e.info.level};case 1:return function(e,t){return t.info.starLevel-e.info.starLevel};default:return function(){return-1}}},defaultSortFunc:function(e,t){var i=e.info,o=t.info;if(i.starLevel!=o.starLevel)return o.starLevel-i.starLevel;if(i.level!=o.level)return o.level-i.level;var n=c.Config.allHeroConfig()[i.code],a=c.Config.allHeroConfig()[o.code];return n.race!=a.race?n.race-a.race:n.profession!=a.profession?HERO_SORT_ORDER[a.profession]-HERO_SORT_ORDER[n.profession]:i.code-o.code}}},t),i.skinName="GloryArenaFormationView1Skin",i.params=e,i}c.GloryArenaFormationView1=e,__reflect(e.prototype,"game.GloryArenaFormationView1");var i,s=(i=eui.ItemRenderer,__extends(o,i),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.scaleX=this.baseItem.scaleY=.85,this.img_bg.scaleX=this.img_bg.scaleY=.6,this.gp_bi.addChild(this.baseItem),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.touchCB&&this.data.touchCB(!this.img_bg.visible,this.data,this.changeIsUp.bind(this))},this)},o.prototype.dataChanged=function(){var e=this.data,t=0==e.info.dermaCode?void 0:c.Config.getHeroDermaConfig()[e.info.dermaCode].avatar;this.baseItem.updateData({uuid:this.data.info.uuid,type:EEntityType.EEntityTypeHero,effect:!1,isShowZhongZhu:!0,avatar:t}),this.img_bg.visible=0!=this.data.teamNum,this.img_bg.visible&&(this.img_bg.source=this.CHOOSE_NUM[this.data.teamNum-1]),UIActionManager.setGrey(this.gp_bi,this.img_bg.visible)},o.prototype.changeIsUp=function(){this.img_bg.visible=!this.img_bg.visible,this.data.isUp=!this.data.isUp,UIActionManager.setGrey(this.gp_bi,this.img_bg.visible),this.img_bg.visible&&(this.img_bg.source=this.CHOOSE_NUM[this.data.teamNum-1])},o);function o(){var e=i.call(this)||this;return e.CHOOSE_NUM=["sycx_txt_yi1_png","sycx_txt_er1_png","sycx_txt_sani1_png"],e.skinName="CommonTeamHeroItemSkin",e}c.GloryArenaTeamHeroItem=s,__reflect(s.prototype,"game.GloryArenaTeamHeroItem")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.HeroMainView),this.addSubView(n.SV.GACHA,i.HeroGachaView),this.addSubView(n.SV.SELECT,i.HeroSelectPanel),this.addSubView(n.SV.SELECT_UPSTAR,i.HeroUpstarSelectPanel),this.addSubView(n.SV.GACHA_RESULT,i.HeroGachaResultView),this.addSubView(n.SV.SECTION,i.HeroUpsectionPanel),this.addSubView(n.SV.HERO_QUICK_TRAIN,i.HeroQuickTrainView),this.addSubView(n.SV.FORMATION,i.HeroFormationPanel),this.addSubView(n.SV.HERO_DETAIL,i.HeroDetailView),this.addSubView(n.SV.ATTR_DETAIL,i.HeroAttrDetailsPanel),this.addSubView(n.SV.HERO_COMMENT,i.HeroCommentView),this.addSubView(n.SV.STARDOOR,i.StarDoorView),this.addSubView(n.SV.HERO_REPLACEMENT,i.HeroReplacementView),this.addSubView(n.SV.HERO_HALO,i.HeroHaloPanel),this.addSubView(n.SV.COMMON_GACHA_RESULT,i.CommonGachaResultView),this.addSubView(n.SV.ARTIFACT_RESONATE,i.HeroArtifactResonatePanel),this.addSubView(n.SV.HERO_DERMA,i.HeroDermaPanel),this.addSubView(n.SV.RESONATE_ATTR,i.HeroResonateAttrPanel),this.addSubView(n.SV.RESONATE_UNLOCK,i.HeroResonateUnlockPanel),this.addSubView(n.SV.HERO_PRACTICE,i.HeroPracticePanel),this.addSubView(n.SV.MASTER,i.HeroThingMasterView),this.addSubView(n.SV.COMMON_LEVEL_MASTER,i.CommonLevelMasterPanel),this.addSubView(n.SV.HERO_STAR_DEFEND,i.HeroStarDefendPanel),this.addSubView(n.SV.HERO_STAR_DEFEND_ALL,i.HeroDefendAllPanel),this.addSubView(n.SV.HERO_STAR_DEFEND_ALLATTR,i.HeroDefendAllAttrPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.HERO_EQUIP_UPDATE,CN.HERO_ARTIFACT_UPDATE,CN.HERO_IMMORTAL_UPDATE,CN.HEROCOMMENT_UPDATE,CN.HERO_GACHA_UPDATE,CN.HERO_DERMA_UPDATE,CN.MONEY_UPDATE]},n.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:this.heroPy.GetHeroInfo(),this.heroPy.GetUserGashaponInfos(),this.heroPy.getReplaceInfo();break;case CN.HERO_EQUIP_UPDATE:case CN.HERO_ARTIFACT_UPDATE:case CN.HERO_IMMORTAL_UPDATE:this.updateView(n.SV.MAIN);break;case CN.HERO_DERMA_UPDATE:this.updateView(n.SV.MAIN),this.updateView(n.SV.HERO_DERMA);break;case CN.HERO_GACHA_UPDATE:this.updateView(n.SV.GACHA);break;case CN.HEROCOMMENT_UPDATE:(i=this.getSubView(n.SV.HERO_COMMENT))&&i.getPlayerTuphero(t);break;case CN.MONEY_UPDATE:var i;(i=this.getSubView(n.SV.STARDOOR))&&i.updateResourceBar();var o=this.getSubView(n.SV.GACHA);o&&o.resourceBarComponent()}},n.prototype.updateView=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];o.prototype.updateView.apply(this,[e].concat(t)),e===n.SV.MAIN&&o.prototype.updateView.apply(this,[n.SV.HERO_QUICK_TRAIN].concat(t))},n.N="HeroMediator",n.SV={MAIN:1,GACHA:2,SELECT:3,SELECT_UPSTAR:4,GACHA_RESULT:5,SECTION:6,RESONATE:7,HERO_QUICK_TRAIN:8,FORMATION:9,HERO_DETAIL:10,ATTR_DETAIL:11,HERO_COMMENT:12,STARDOOR:13,HERO_REPLACEMENT:14,HERO_HALO:15,COMMON_GACHA_RESULT:16,ARTIFACT_RESONATE:17,HERO_DERMA:18,RESONATE_ATTR:20,RESONATE_UNLOCK:21,HERO_PRACTICE:22,MASTER:23,COMMON_LEVEL_MASTER:24,HERO_STAR_DEFEND:25,HERO_STAR_DEFEND_ALL:26,HERO_STAR_DEFEND_ALLATTR:27},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.heroPy=i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N),t}i.HeroMediator=e,__reflect(e.prototype,"game.HeroMediator")}(game=game||{}),function(n){var t,e=(__extends(i,t=BasePanel),i.prototype.commentsFloatingEffect=function(e){var t,i=this,o=this.isFirst?0:1700;if(this.isFirst=!1,e&&e.priority){for(var n=0,a=this.array;n<a.length;n++)if((d=a[n]).id==e.id){t=d;break}}else{this.origin_arr.length,this.array.length;var r=0;if(0<this.newArr.length){for(;r<this.newArr.length;){if(!this.tupMap[this.newArr[r].id]){t=this.newArr[r],this.newArr.splice(r,1);break}++r}r>=this.newArr.length&&(this.newArr=[],egret.setTimeout(function(){i.commentsFloatingEffect()},this,o))}else if(0<this.commonArr.length){var s=this.commonArr.length;r=Math.floor(Math.random()*s);var c=this.tupMap[this.commonArr[r].id];if(c)for(var l=0;c&&l<this.commonArr.length;)this.commonArr.splice(r,1),r=Math.floor(Math.random()*s),t=this.origin_arr[r],c=this.tupMap[this.origin_arr[r].id],++l>=this.origin_arr.length&&(t=void 0);else t=this.commonArr[r],this.commonArr.splice(r,1)}else if(10<=this.array.length){this.tupMap={};for(var h=0,p=this.array;h<p.length;h++){var d=p[h];this.origin_arr.push(d),this.commonArr.push(d)}egret.setTimeout(function(){i.commentsFloatingEffect()},this,o)}}var u=0;for(l=0;l<3;++l)u+=this["gp_msg_"+l].$children.length;if(u<=20&&t){t.content,this.tupMap[t.id]=t.content_id,++this.popTimes;var g=this.popTimes%3;egret.setTimeout(function(){var e=i["gp_msg_"+g].y;i.msgOnTop(t,{x:730,y:e},g,5e3),i.commentsFloatingEffect()},this,o)}else console.log("skip, skip")},i.prototype.msgOnTop=function(t,e,i,o,n){var a=this;void 0===o&&(o=0);var r=t.content,s=this["gp_msg_"+i],c=new eui.Group;c.x=Utils.DeviceUtils.curWidth()+100,c.y=0,s.addChild(c);var l=new eui.Label;l.touchEnabled=!1,l.textColor=16777215,l.size=26,l.text=r,l.x=0,l.y=0;var h=new eui.Button;h.skinName="skins.ButtonIconWithNumSkin",h.icon="yingxion_icon_dianzan_png",h.label=t.num.toString(),h.x=l.width+20,h.y=0,h.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){a.commentPlayerTup(t,function(){h.label=(t.num+1).toString()})},this),c.addChild(l),c.addChild(h),c.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){a.floatingMsgPauseEvents(i)},this),c.addEventListener(egret.TouchEvent.TOUCH_END,function(){a.floatingMsgResumeEvents(i)},this),this.stopMap[i]||egret.Tween.get(c).to({x:-l.textWidth},o).call(function(){s.removeChild(c),n&&n()})},i.prototype.floatingMsgPauseEvents=function(e){this.stopMap[e]=!0;for(var t=this["gp_msg_"+e],i=t.$children.length,o=0;o<i;++o)egret.Tween.pauseTweens(t.getChildAt(o))},i.prototype.floatingMsgResumeEvents=function(e){this.stopMap[e]=!1;for(var t=this["gp_msg_"+e],i=t.$children.length,o=0;o<i;++o)egret.Tween.resumeTweens(t.getChildAt(o))},i.prototype.commentPlayerTup=function(t,i){var e=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N),o=n.AppFacade.getInstance().retrieveProxy(n.LoginPy.N);t.tup_player?Utils.MsgUtils.addMidMsg("只能对该条评论点赞一次！"):Utils.Http.toGet({action:"set_PlayerTup_hero",code:t.code,player_id:t.id,name:t.name,content:t.content,head:t.head,type:n.HeroCommentView.commentType.DIANZAN,tup_player:e.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,project:Utils.agentConfig.ProjectName,subPlatform:Utils.agentConfig.channelName||"",server_id:o.serverSelect.s_id,area:t.serverId,from_server_id:o.serverSelect.area}).then(function(e){i&&i(),n.AppFacade.getInstance().sendNotification(CN.HEROCOMMENT_UPDATE,{info:t,type:n.HeroCommentView.commentType.DIANZAN})}).catch(function(e){console.log("set_PlayerTup_hero"+e)})},i.prototype.compareFunc=function(e,t,i){return++i<=3?0<e.num-t.num?-1:e.num-t.num<0?1:(--i,0<e.strTime-t.strTime?-1:e.strTime-t.strTime<0?1:0):e.strTime-t.strTime<0?1:0<e.strTime-t.strTime?-1:0},i.prototype.sortByTime=function(e,t){return e.strTime-t.strTime<0?1:0<e.strTime-t.strTime?-1:0},i.prototype.sortByLike=function(){for(var e=[],t=0;t<3;++t){for(var i=0,o=0,n=0;o<this.array.length;){var a=this.array[o];n=i<a.num?o:n,i=Math.max(a.num,i),++o}if(this.array.length<=0)break;e.push(this.array[n]),this.array.splice(n,1)}this.array=e.concat(this.array)},i.prototype.perClose=function(){},i.prototype.onDestroy=function(){this.array=[],this.origin_arr=[],this.tupMap={},this.commonArr=[]},i);function i(){var e=null!==t&&t.apply(this,arguments)||this;return e.tupMap={},e.origin_arr=[],e.newArr=[],e.commonArr=[],e.popTimes=0,e.stopMap={0:!1,1:!1,2:!1},e.isFirst=!0,e.array=[],e}n.CommonComment=e,__reflect(e.prototype,"game.CommonComment")}(game=game||{}),function(U){var i,o=(__extends(n,i=BaseTab),n.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),Utils.SDKMgr.getPerformConfig(200008)&&(n.BTN_LEFT_TYPE.pinglun.text=Utils.SDKMgr.getPerformConfig(200008)),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_hero_list),Utils.DeviceUtils.setLiuHaiPingAdapter(this.resource_bar),this.initGPRightBtn(),this.initGPLeftBtn(),this.initTabbar(),this.initThing(),this.activateComponent(),this.list_resonate.itemRenderer=k,this.gp_heroInfo.visible=this.gp_right_btn.visible=this.gp_left_btn.visible=this.gp_hero_list.visible=!1,this.once(egret.Event.ENTER_FRAME,function(){t.gp_heroInfo.visible=t.gp_right_btn.visible=t.gp_left_btn.visible=t.gp_hero_list.visible=!0;var e=t.gp_hero_list.y;UIActionManager.playUIAction(t.gp_right_btn,4),UIActionManager.playUIAction(t.gp_left_btn,3),UIActionManager.playUIAction(t.gp_hero_list,5),UIActionManager.playUIAction(t.gp_heroInfo,6,function(){t.setGuideAvailable()},t),t.btn_lock.y+t.gp_hero.y+t.btn_lock.width/3<t.gp_hero_list.height+e&&(t.img_race_icon.parent.y+=350,t.btn_lock.y+=350)},this),this.addNotice(),NoticeManager.updateNotice(NT.GUAJI_GZGZH3)},n.prototype.initGPRightBtn=function(){for(var e in n.BTN_TYPE){var t=n.BTN_TYPE[e],i=new eui.Button;i.skinName="skins.ButtonSkinIcon2",i.width=80,i.height=94,i.icon=t.icon,i.label=t.text,this[t.id]=i,this.gp_right_btn.addChild(this[t.id])}},n.prototype.initGPLeftBtn=function(){for(var e in n.BTN_LEFT_TYPE){var t=n.BTN_LEFT_TYPE[e],i=new eui.Button;i.skinName="skins.ButtonSkinIcon2",i.width=80,i.height=94,i.icon=t.icon,i.label=t.text,this[t.id]=i,this.gp_left_btn.addChild(this[t.id])}},n.prototype.initTabbar=function(e){var t=this;void 0===e&&(e=!0),this.heroInfo_tabbar.itemRendererSkinName="HeroMainView_HeroInfoTabItem",this.heroInfo_tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.heroFoster_onItemTap,this),this.heroInfo_tabbar.addEventListener(egret.Event.CHANGE,function(e){egret.setTimeout(function(){U.AppFacade.getInstance().sendNotification(CN.GUIDE_CHECK_CUR_STEP)},t,100)},this),this.heroInfo_tabbar.selectedIndex=0},n.prototype.initThing=function(){var a=this,e=0;for(var t in HeroEquipType){var i=new f(HeroEquipType[t]);this.heroThingItems.push(i);var o=this.heroThingPos[e++];i.x=o[0],i.y=o[1],NoticeManager.addNoticeListener(NT.HERO_EQUIP[HeroEquipType[t]-1],i.bi_root,this,{percentX:74/105,percentY:0}),this.gp_thingBox.addChild(i)}i=new E,this.heroThingItems.push(i),o=this.heroThingPos[e++],i.x=o[0],i.y=o[1],NoticeManager.addNoticeListener(NT.HERO_TREASURE,i.bi_root,this,{percentX:74/105,percentY:0}),this.gp_thingBox.addChild(i),i=new v,this.heroThingItems.push(i),o=this.heroThingPos[e++],i.x=o[0],i.y=o[1],NoticeManager.addNoticeListener(NT.HERO_ARTIFACT,i.bi_root,this,{percentX:5/105,percentY:0}),this.gp_thingBox.addChild(i),i=new A,this.heroThingItems.push(i),o=this.heroThingPos[e++],i.x=o[0],i.y=o[1],this.gp_thingBox.addChild(i),this.btn_putOn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.heroProxy.HeroOneKeyPutOn(a.curUuid,function(){var e=U.GameMVC.heroThingPy.getHeroEquips(a.curUuid),t=U.Config.getHeroEquipConfig(),i=!0;for(var o in e.length<4&&(i=!1),e){var n=e[o];t[n.code]&&t[n.code].color<7&&(i=!1)}i&&DragonBoneTools.playOnce({effectName:"common_zbdsjh",parent:GameRootLayer.gameLayer().mainLayer,x:GameRootLayer.gameLayer().mainLayer.width/2,y:GameRootLayer.gameLayer().mainLayer.height/2-100})})},this),this.btn_putOff.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.heroProxy.HeroOneKeyPutDown(a.curUuid)},this)},n.prototype.updateView=function(e){var t=e&&e.uuid,i=!t&&!this.curUuid||t&&this.curUuid!=t;if(this.curUuid=t||this.curUuid,this.upstarData=e&&e.upstarData||this.upstarData,!this.curUuid)for(var o=1;o<=5;o++)if(this.heroProxy.heroUuid22Pos[o]){this.curUuid=this.heroProxy.heroUuid22Pos[o];break}for(this.updateHeroList(),this.curUuid?(this.gp_hero.visible=!0,this.isPet=!1,this.curInfo=this.heroProxy.allHeroByUuid[this.curUuid],i&&(this.updateTabbar(),egret.setTimeout(function(){U.AppFacade.getInstance().sendNotification(CN.GUIDE_CHECK_CUR_STEP)},this,100)),this.updateHeroInfo(),this.heroFoster_onItemTap()):this.gp_hero.visible=!1,NoticeManager.updateNotice([NT.HERO_ARTIFACT,NT.HERO_RESONATE_RESONATE,NT.HERO_RESONATE_UNLOCK,NT.HERO_TREASURE,NT.HERO_UPSECTION,NT.HERO_UPSTAIR],this.heroProxy.allHeroByUuid[this.curUuid],!0),NoticeManager.updateNotice([NT.HERO_ARTIFACT_RESONATE],{heroInfo:this.curInfo},!0),o=1;o<7;o++)NoticeManager.updateNotice(NT.HERO_CAN_FORMATION[o-1],o,!0);for(var n in HeroEquipType){var a=HeroEquipType[n];NoticeManager.updateNotice(NT.HERO_EQUIP[a-1],{info:this.heroProxy.allHeroByUuid[this.curUuid],type:a},!0)}NoticeManager.updateNotice(NT.HERO_DERMA,{info:this.curInfo}),this.updateMagicBtn()},n.prototype.heroFoster_onItemTap=function(e){e&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex);var t=e&&e.item.type||this.heroInfo_tabbar.selectedItem&&this.heroInfo_tabbar.selectedItem.type||0;this.curType=t,this.img_btmPattern.visible=!1,this.gp_heroThing.visible=!1,this.gp_up.visible=!1,this.gp_upstar.visible=!1,this.gp_upgrade.visible=!1,this.gp_resonate.visible=!1,this.btn_up.visible=!1,this.btn_upstar.visible=!1;var i=this.isPet?"魔兽":"英雄";switch(this.img_bg.source=HeroRaceConfig[this.curInfo.config.race].bgSrc,this.img_base.source=HeroRaceConfig[this.curInfo.config.race].baseSrc,t){case n.HERO_INFO_TABBAR_TYPE.EQUIPMENT:this.img_btmPattern.visible=!0,this.blb_title.text=i+"装备",this.updateHeroThing();break;case n.HERO_INFO_TABBAR_TYPE.UPGRADE:this.btn_up.visible=!0,this.blb_title.text=i+"信息",this.updateHeroUpgrade();break;case n.HERO_INFO_TABBAR_TYPE.UPSTAR:this.btn_upstar.visible=!0,this.blb_title.text=i+"升星",this.updateHeroUpstar();break;case n.HERO_INFO_TABBAR_TYPE.RESONATE:this.blb_title.text=i+"羁绊",this.updateHeroResonate()}},n.prototype.updateTabbar=function(){this.heroInfoTabbarData=[{up:"_btn_yq_m_json.common_yeqian_shengji_0",down:"_btn_yq_m_json.common_yeqian_shengji_1",type:n.HERO_INFO_TABBAR_TYPE.UPGRADE}],this.isPet||this.heroInfoTabbarData.push({up:"_btn_yq_m_json.common_yeqian_zhuangbei_0",down:"_btn_yq_m_json.common_yeqian_zhuangbei_1",type:n.HERO_INFO_TABBAR_TYPE.EQUIPMENT}),this.curInfo.config.isStar?this.heroInfoTabbarData.push({up:"_btn_yq_m_json.common_yeqian_shengxing_0",down:"_btn_yq_m_json.common_yeqian_shengxing_1",type:n.HERO_INFO_TABBAR_TYPE.UPSTAR}):2==this.heroInfo_tabbar.selectedIndex&&(this.heroInfo_tabbar.selectedIndex=0),!this.isPet&&0<U.Config.heroResonateConfig(this.curInfo.config.subType).length?this.heroInfoTabbarData.push({up:"_btn_yq_m_json.common_yeqian_jiban_0",down:"_btn_yq_m_json.common_yeqian_jiban_1",type:n.HERO_INFO_TABBAR_TYPE.RESONATE}):3==this.heroInfo_tabbar.selectedIndex&&(this.heroInfo_tabbar.selectedIndex=0),this.heroInfo_tabbar.dataProvider=new eui.ArrayCollection(this.heroInfoTabbarData),this.removeNoticeInTabbar(),this.addNotice()},n.prototype.updateHeroThing=function(){var f=this;this.gp_heroThing.visible=!0;var _=this.heroThingProxy.getHeroEquips(this.curUuid),m=this.heroThingProxy.getHeroArtifactByHeroUuid(this.curUuid),y=this.heroThingProxy.getHeroTreasuresByUuid(this.curUuid),v=this.heroThingProxy.getHeroImmortalByUuid(this.curUuid),T=[];if(this.heroThingItems.forEach(function(e,t){for(var i=!1,o=0,n=_;o<n.length;o++){var a=n[o];if(e.entityType==EEntityType.EEntityTypeHeroEquip&&a.type==e.type){T.push(t),e.update({hero:f.heroProxy.allHeroByUuid[f.curUuid],vo:a}),i=!0;break}}if(!i)for(var r=0,s=m;r<s.length;r++){var c=s[r];if(e.entityType==EEntityType.EEntityTypeHeroArtifact&&c.type==e.type){i=!0,T.push(t),e.update({hero:f.heroProxy.allHeroByUuid[f.curUuid],vo:c});break}}if(!i)for(var l=0,h=y;l<h.length;l++){var p=h[l];if(e.entityType==EEntityType.EEntityTypeTreasure&&p.type==e.type){i=!0,T.push(t),e.update({hero:f.heroProxy.allHeroByUuid[f.curUuid],vo:p});break}}if(!i)for(var d=0,u=v;d<u.length;d++){var g=u[d];if(e.entityType==EEntityType.EEntityTypeImmortal&&g.type==e.type){i=!0,T.push(t),e.update({hero:f.heroProxy.allHeroByUuid[f.curUuid],vo:g});break}}}),this.heroThingItems.forEach(function(e,t){T.indexOf(t)<0&&e.update({hero:f.heroProxy.allHeroByUuid[f.curUuid]})}),Utils.UnlockMgr.checkPass(MODULE.HeroArtifactResoante,!1).allow){var e=U.Config.heroArtifactResonate(this.curInfo.config.subType);this.btn_artifactResonate.visible=0<Object.keys(e).length}else this.btn_artifactResonate.visible=!1;var t=this.heroThingProxy.getHeroEquips(this.curUuid);if(UIActionManager.setGrey(this.btn_master,!1),4==t.length){var i=U.Config.getHeroEquipConfig(),o=0;for(var n in t){var a=i[t[n].code];a&&a.color<7&&(o=1)}o?UIActionManager.setGrey(this.btn_master,!0):UIActionManager.setGrey(this.btn_master,!1)}else UIActionManager.setGrey(this.btn_master,!0)},n.prototype.updateHeroUpgrade=function(){var t=this;this.gp_up.visible=!0,this.gp_upgrade.visible=!0;var c=this.curInfo,l=c.config;this.item_fightCap.update(c.fightCap),this.img_profession.source=ProfessionConfig[l.profession].icon,this.img_race.source=HeroRaceConfig[l.race].raceIconBig,this.lb_profession.text=l.name,this.lb_desc.text=l.desc,this.baseItem_avatar||(this.baseItem_avatar=customui.BaseItemFactory.create(),this.baseItem_avatar.scaleX=this.baseItem_avatar.scaleY=.7,this.baseItem_avatar.touchEnabled=!1,this.gp_heroAvatar.addChild(this.baseItem_avatar)),this.baseItem_avatar.updateData({code:c.code,effect:!0}),this.baseItem_avatar.gp_star_hero.visible=this.baseItem_avatar.img_type.visible=this.baseItem_avatar.gp_star_hero2.visible=!1,this.gp_upgrade_attr.removeChildren();for(var e=JSON.parse(c.attr),i=1;i<=4;i++)this.gp_upgrade_attr.addChild(new _({type:i,num:e[i]}));function o(e){var t=d["skill_"+e];if(p)t.reset();else{var i=SKILL_CODE[e],o=void 0;if(0<c.defendLevel){var n=U.Config.heroDefendConfig(c.config.subType);o=JSON.parse(n[c.defendLevel-1].skills)[e-1]}else o=l[i];if(o){var a=c.skillList.some(function(e){return e.code===o}),r="";a||(r=h[e]+"阶解锁");var s={code:o,unlock:a,unlockTips:r};d["skill_"+e].updateItem(s)}else d["skill_"+e].updateItem(),p=!0}}this.gp_skills.visible=!0;var h=JSON.parse(l.skillUnlock),p=!1,d=this;for(i=1;i<=5;i++)o(i);var n=U.Config.heroAndPetSectionConfig(this.isPet)[c.sectionLevel+1],a=n&&n.level||9999999,r=l.maxLevel;if(0<c.defendLevel){var s=U.Config.heroDefendConfig(c.config.subType);0<s.length&&(r=s[c.defendLevel-1].maxLevel)}var u=Math.min(a,r);this.lb_level.text=c.level+"/"+u;var g=U.Config.heroAndPetUpgradeConfig(this.isPet)[c.level]||{},f=JSON.parse(g.costs);this.gp_cost.visible=!0,c.level==u?(this.gp_costs_icon.visible=!1,this.btn_maxLevel.visible=!0,this.btn_maxLevel.y=200,this.btn_up.visible=!0,c.level==a?(this.btn_up.label="升阶",this.btn_up.skinName="skins.ButtonSkinYellow"):U.Config.heroAndPetUpstarConfig()[c.code]?(this.btn_up.label="升级",this.btn_up.skinName="skins.ButtonSkinGreen"):(this.btn_maxLevel.y=235,this.btn_up.visible=!1)):(this.gp_costs_icon.visible=!0,this.btn_maxLevel.visible=!1,this.gp_costs_icon.removeChildren(),f.forEach(function(e){t.gp_costs_icon.addChild(new customui.CommonIconWithNum({code:e[1],num:e[2],style:CommonIconStyle.RIGHT,showEnough:!0}))}),this.btn_up.visible=!0,this.btn_up.label="升级",this.btn_up.skinName="skins.ButtonSkinGreen"),this.resource_bar.updateBar({costs:f,width:170,gap:70})},n.prototype.updateHeroUpstar=function(){var t=this;this.gp_up.visible=!0,this.gp_upstar.visible=!0,this.gp_defend.visible=!1;var e=U.Config.heroAndPetUpstarConfig(this.isPet),i=this.curInfo,o=i.config,n=i.starLevel,a=e[i.code];this.heroProxy.checkUpstarNotice(i)?UIActionManager.setAbsGrey(this.btn_upstar,!1):UIActionManager.setAbsGrey(this.btn_upstar,!0),this.gp_upstar_stars.removeChildren();var r=U.GeneralConfig.getHeroStarInfo(n);if(r.stage<4)for(var s=0;s<r.num;s++){var c=new eui.Image(r.src);this.gp_upstar_stars.addChild(c),c.scaleX=c.scaleY=.5}else this.gp_upstar_stars.addChild(new customui.HighStarLevelIcon({num:r.num,scale:.5}));if(a){this.gp_upstar_stars.addChild(new eui.Image("yingxion_img_xiaojiantou_png"));var l=U.GeneralConfig.getHeroStarInfo(n+1);if(l.stage<4)for(s=0;s<l.num;s++)c=new eui.Image(l.src),this.gp_upstar_stars.addChild(c),c.scaleX=c.scaleY=.5;else this.gp_upstar_stars.addChild(new customui.HighStarLevelIcon({num:l.num,scale:.5}))}this.gp_skills.visible=!1,this.gp_skills_2.visible=!1;var h=U.Config.allHeroConfig(this.isPet);if(n<10){var p=h[a.nextCode];this.gp_skills_2.visible=!0,this.gp_skills_2.removeChildren();var d=o[SKILL_CODE[a.upSkill]],u=p[SKILL_CODE[a.upSkill]],g=new customui.SkillItem({code:d});this.bindSkillPanelClick({target:g,x:34,bottom:170}),this.gp_skills_2.addChild(g);var f=new eui.Image("yingxion_img_xiaojiantou_png");f.scaleX=f.scaleY=1.8,this.gp_skills_2.addChild(f);var _=new customui.SkillItem({code:u});this.bindSkillPanelClick({target:_,x:34,bottom:170}),this.gp_skills_2.addChild(_),g.scaleX=g.scaleY=_.scaleX=_.scaleY=.8}else{this.gp_skills.visible=!0;var m=void 0;if(a){for(var y=a;e[y.nextCode];)y=e[y.nextCode];m=h[y.nextCode]}else m=h[this.curInfo.code];for(s=1;s<=5;s++){var v=this["skill_"+s],T=m["talent"+s],C=void 0;T&&(C={code:T,unlock:9+s<n,light:n==9+s}),v.updateItem(C)}}if(a)this.gp_upstar_attrInfo.scaleY=1,this.blb_upstar_desc.text=a.attrShow+"%",this.lb_upstar_level_1.text="等级上限提升至：",this.blb_upstar_level.text=""+h[a.nextCode].maxLevel;else{this.gp_upstar_attrInfo.scaleY=0,this.lb_upstar_level_1.text="等级上限：";var E=""+h[i.code].maxLevel;0<i.defendLevel&&(E=U.Config.heroDefendConfig(i.config.subType)[i.defendLevel-1].maxLevel),this.blb_upstar_level.text=E}if(a){if(this.gp_defend_text.visible=!1,this.gp_upstar_notMax.visible=!0,this.gp_cost.visible=!0,this.lb_upstar_limitation.visible=!1,this.gp_costs_icon.visible=!1,U.AppFacade.getInstance().retrieveProxy(U.PlayerPy.N).playerInfoVO.level<a.level)this.lb_upstar_limitation.visible=!0,this.lb_upstar_limitation.text="需求队伍等级："+a.level;else if(""!=a.fiveSlotCosts){var I=JSON.parse(a.fiveSlotCosts);this.gp_costs_icon.visible=!0,this.gp_costs_icon.removeChildren(),I[1].forEach(function(e){t.gp_costs_icon.addChild(new customui.CommonIconWithNum({code:e[1],num:e[2],style:CommonIconStyle.RIGHT,showEnough:!0}))})}for(this.gp_chosenHero.removeChildren(),s=1;s<=4;s++)if(""!=a[this.conditionMap[s]]){this.upstarData[s]||(this.upstarData[s]={condition:a[this.conditionMap[s]],full:!1,uuids:[]}),C=this.upstarData[s];var b=new L({data:this.upstarData,slot:s,targetUuid:this.curUuid});this.gp_chosenHero.addChild(b)}var A=!0;for(var P in this.upstarData)if(!this.upstarData[P].full){A=!1;break}4!=o.initStar||A?this.btn_upstar.label="升星":this.btn_upstar.label="一键放入"}else this.gp_defend_text.visible=!0,this.gp_upstar_notMax.visible=!1,this.gp_cost.visible=!1;var M=[30000002,EPropertyType.EPropertyTypeGold];this.resource_bar.updateBar({costs:M,width:170,gap:70});var N=[this.gp_defend_effect_0,this.gp_defend_effect_1,this.gp_defend_effect_2,this.gp_defend_effect_3];for(var S in N)N[S].removeChildren();if(this.gp_defend_text.visible&&15==i.config.initStar){var k=U.Config.heroDefendConfig(i.config.subType);Utils.UnlockMgr.checkPass(MODULE.HeroDefend,!1).allow?0<k.length?(this.blb_title.text="神灵守护",this.gp_defend.visible=!0,this.updateDefend()):(this.blb_title.text="英雄升星",this.gp_defend.visible=!1,this.lb_upstar_max.text="已满星",this.lb_defend_level.text=""):(this.blb_title.text="英雄升星",this.gp_defend.visible=!1,0<k.length?(this.lb_upstar_max.text="神灵守护开启等级：",this.lb_defend_level.text=Utils.UnlockMgr.checkPass(MODULE.HeroDefend,!1).ext.requestLevel+"级"):(this.lb_upstar_max.text="已满星",this.lb_defend_level.text=""))}else this.blb_title.text="英雄升星",this.gp_defend.visible=!1,this.lb_upstar_max.text="已满星",this.lb_defend_level.text=""},n.prototype.updateDefend=function(){var e=[this.img_line_0,this.img_line_1,this.img_line_2],t=[this.img_defend_0,this.img_defend_1,this.img_defend_2,this.img_defend_3],i=[this.lb_defend_0,this.lb_defend_1,this.lb_defend_2,this.lb_defend_3],o=[this.gp_defend_effect_0,this.gp_defend_effect_1,this.gp_defend_effect_2,this.gp_defend_effect_3],n=["yingxion_icon_hunxing2_png","yingxion_icon_tianxing2_png","yingxion_icon_mingxing2_png","yingxion_icon_lingxing2_png"],a=["yingxion_icon_hunxing1_png","yingxion_icon_tianxing1_png","yingxion_icon_mingxing1_png","yingxion_icon_lingxing1_png"],r=this.curInfo,s=U.Config.heroDefendConfig(r.config.subType),c=r.defendLevel;this.img_defend.source=c>=s.length?"yingxion_txt_yiquanbu_png":"yingxion_txt_dianji_png";for(var l=0;l<4;l++)l<3&&(e[l].source=l<c?"yingxion_img_xiantiao1_png":"yingxion_img_xiantiao2_png"),t[l].source=l<c?a[l]:n[l],i[l].text=s[l].name;c<4&&DragonBoneTools.create("common_xingling",function(e){for(var t in o)o[t].removeChildren();e.x=o[c].width/2,e.y=o[c].height/2,e.scaleX=e.scaleY=1,e.animation.play(),o[c].addChild(e)},this)},n.prototype.updateHeroResonate=function(){var i=this;this.gp_resonate.visible=!0;var e=this.curInfo.config.subType,t=this.curInfo.resonateLevelList[this.curInfo.resonateLevelList.length-1]||0,o=U.Config.heroResonateConfig(this.curInfo.config.subType,t),n=this.heroProxy.getHeroResonateOrders(this.curInfo),a=[];o.forEach(function(e){var t={uuid:i.curInfo.uuid,config:e,activated:!1};t.activated=0<=n.indexOf(e.order),a.push(t)}),a.sort(function(e,t){return e.config.order-t.config.order}),this.list_resonate.dataProvider=new eui.ArrayCollection(a),Utils.UnlockMgr.checkPass(MODULE.HeroAwaken,!1).allow&&10<=this.curInfo.config.initStar?(this.gp_resonate_unlock.visible=!0,this.list_resonate.layout.verticalGap=15,this.list_resonate.y=0,this.img_resonate_unlock.source=0===t?"jiban_img_weijuexing_png":"jiban_img_juexing"+t+"_png",this.blb_resonate_unlock.text=0<t?"羁绊"+NUM_TO_ROMAN_NUM[t]:"",this.btn_resonate_unlock.visible=this.curInfo.config.initStar>=U.Config.heroResonateLevelConfig(e,1).starLevel):(this.gp_resonate_unlock.visible=!1,this.list_resonate.layout.verticalGap=40,this.list_resonate.y=15)},n.prototype.updateHeroList=function(){if(!this.gp_heroitems.$children.length)for(var e=1;e<=6;e++)(t=new a).name=e.toString(),t.x=12.5+115*(e-1),this.gp_heroitems.addChildAt(t,0);for(e=1;e<=6;e++){var t=this.gp_heroitems.getChildByName(e.toString()),i=Utils.UnlockMgr.checkPass(e,!1);t.updateItem({uuid:this.heroProxy.heroUuid22Pos[e],unlock:i,info:this.heroProxy.allHeroByUuid[this.heroProxy.heroUuid22Pos[e]]})}},n.prototype.updateOneHeroInfo=function(e,t){var i=this.heroThingProxy.AllDermaInfo[t],o=void 0;if(""==t)this.hero_model.update({code:e.code,isPet:!1}),this.lb_name.text=e.config.name,o=e.config.avatar;else{this.lb_name.text=U.Config.getHeroDermaConfig()[i.code].name;var n=U.Config.getHeroDermaConfig()[i.code];this.hero_model.update({code:e.code,isPet:!1,derma:n}),o=U.Config.getHeroDermaConfig()[i.code].avatar}var a=U.GeneralConfig.getHeroStarInfo(e.starLevel);if(this.gp_star.removeChildren(),a.stage<4)for(var r=0;r<a.num;r++)this.gp_star.addChild(new eui.Image(a.src));else this.gp_star.addChild(new customui.HighStarLevelIcon(a.num));var s=this.heroProxy.heroUuid22Pos[e.uuid],c=this.gp_heroitems.getChildByName(s.toString()),l=Utils.UnlockMgr.checkPass(s,!1);c.updateItem({uuid:this.heroProxy.heroUuid22Pos[s],unlock:l,info:e,oneAvatar:o})},n.prototype.updateHeroInfo=function(){if(this.lb_name.text=this.curInfo.config.name,this.img_race_icon.source=HeroRaceConfig[this.curInfo.config.race].raceIconBig,this.img_tier_icon.source=U.GeneralConfig.getHeroJingyingTag(this.curInfo.config.code),0!=this.curInfo.dermaCode){this.lb_name.text=U.Config.getHeroDermaConfig()[this.curInfo.dermaCode].name;var e=U.Config.getHeroDermaConfig()[this.curInfo.dermaCode];this.hero_model.update({code:this.curInfo.code,isPet:!1,derma:e})}else this.hero_model.update({code:this.curInfo.code,isPet:this.isPet});var t=U.GeneralConfig.getHeroStarInfo(this.curInfo.starLevel);if(this.gp_star.removeChildren(),t.stage<4)for(var i=0;i<t.num;i++)this.gp_star.addChild(new eui.Image(t.src));else this.gp_star.addChild(new customui.HighStarLevelIcon(t.num));this.btn_lock.icon=this.curInfo.isLocked?"common_btn_suoguan_png":"common_btn_suokai_png"},n.prototype.bindSkillPanelClick=function(t){var i=this,o=t.target;o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){if(o.data&&o.data.code)for(var e in i.skill_panel.visible=!0,i.skill_panel.updateItem({code:o.data.code,tips:o.data.unlockTips,heroVo:i.heroProxy.allHeroByUuid[i.curUuid]}),t)"target"!=e&&(i.skill_panel[e]=t[e])},this),o.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skill_panel.visible=!1},this),o.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skill_panel.visible=!1},this),o.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skill_panel.visible=!1},this)},n.prototype.upgradeLogic=function(){var r=this,e=this.heroProxy.allHeroByUuid[this.curUuid],t=U.AppFacade.getInstance().retrieveProxy(U.BackpackPy.N),i=U.Config.heroAndPetUpgradeConfig(this.isPet)[e.level],o=i&&JSON.parse(i.costs),n=e.config,a=U.Config.heroAndPetSectionConfig(this.isPet)[e.sectionLevel+1],s=n.maxLevel;if(0<e.defendLevel){var c=U.Config.heroDefendConfig(e.config.subType);0<c.length&&(s=c[e.defendLevel-1].maxLevel)}a&&e.level==a.level?(this.timer&&egret.clearInterval(this.timer),U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.SECTION,{data:e,isPet:this.isPet})):e.level==s?Utils.MsgUtils.addMidMsg("已达到该星级最大等级"):this.heroProxy.waitingServOper.upgrade||(this.heroProxy.waitingServOper.upgrade=!0,this.isPet||(t.getInfoByCode(o[0][1]).haveNum<Number(o[0][2])&&t.getInfoByCode(o[1][1]).haveNum>Number(o[1][2])?(Utils.MsgUtils.addMidMsg("所需经验水晶不足"),this.heroProxy.waitingServOper.upgrade=!1,this.timer&&egret.clearInterval(this.timer)):t.getInfoByCode(o[1][1]).haveNum<Number(o[1][2])&&t.getInfoByCode(o[0][1]).haveNum>Number(o[0][2])?(Utils.MsgUtils.addMidMsg("所需金币不足"),this.heroProxy.waitingServOper.upgrade=!1,this.timer&&egret.clearInterval(this.timer)):t.getInfoByCode(o[1][1]).haveNum<Number(o[1][2])&&t.getInfoByCode(o[0][1]).haveNum<Number(o[0][2])?(Utils.MsgUtils.addMidMsg("所需资源不足"),this.heroProxy.waitingServOper.upgrade=!1,this.timer&&egret.clearInterval(this.timer)):this.heroProxy.HeroUpGrade({uuid:this.curUuid,num:1,cb:function(e,t){Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shengji),DragonBoneTools.playUniqueEffect({effectName:"common_shengji",parent:r.hero_model,y:r.hero_model.height}),DragonBoneTools.playUniqueEffect({effectName:"common_ty_dj",parent:r.gp_root,x:r.gp_root.width/2,y:r.gp_root.height/2});var i=new eui.Group,o=new eui.VerticalLayout;o.gap=3,i.layout=o;for(var n=1;n<=4;n++){var a=new eui.Label(AttrConfig[n].name+"+"+Math.floor(Number(U.GeneralConfig.getAttrValue(t[n]-e[n]))));a.textColor=12405786,a.size=24,i.addChild(a)}i.horizontalCenter=0,i.y=r.hero_model.height/2,r.hero_model.addChild(i),egret.Tween.get(i).wait(300).to({y:i.y-50,alpha:0},400).call(function(){i&&i.parent&&i.parent.removeChild(i)})}})))},n.prototype.activateComponent=function(){var r=this;this.btn_up.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){Utils.UnlockMgr.checkPass(MODULE.HeroUpGradeAuto,!1).allow&&(this.timer=egret.setInterval(this.upgradeLogic,this,500)),this.upgradeLogic()},this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_END,function(){this.timer&&egret.clearInterval(this.timer)},this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){this.timer&&egret.clearInterval(this.timer)},this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){r.timer&&egret.clearInterval(r.timer)},this),this.btn_upstar.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var s=this,e=!0;for(var t in this.upstarData)if(!this.upstarData[t].full){e=!1;break}if(4!=this.curInfo.config.initStar||e){var i=this.curInfo,o=U.Config.heroAndPetUpstarConfig(this.isPet)[i.code];if(U.AppFacade.getInstance().retrieveProxy(U.PlayerPy.N).playerInfoVO.level<o.level)return void Utils.MsgUtils.addMidMsg("队伍等级不足");if(""!=o.fiveSlotCosts){var n=JSON.parse(o.fiveSlotCosts)[1];if(!U.AppFacade.getInstance().retrieveProxy(U.BackpackPy.N).checkEnough(n))return void Utils.MsgUtils.addMidMsg("道具不足")}if(e){var a=[];for(var t in this.upstarData)for(var r=0,c=this.upstarData[t].uuids;r<c.length;r++){var l=c[r];a.push({slotNum:Number(t),uuid:l})}this.isPet||(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shengxing),this.heroProxy.HeroUpStar({uuid:this.curUuid,uuidInfos:a,cb:function(e,t){s.touchEnabled=!1,s.touchChildren=!1,DragonBoneTools.playOnce({effectName:"common_zhihuanchenggong",parent:s.hero_model,y:s.hero_model.height,doneCB:function(){s.touchEnabled=!0,s.touchChildren=!0}});for(var i=s.gp_chosenHero.$children.length,o=0;o<i;++o)s.gp_chosenHero.getChildAt(o).updateItem({effect:!0});var n=new eui.Group,a=new eui.VerticalLayout;for(a.gap=3,n.layout=a,o=1;o<=4;o++){var r=new eui.Label(AttrConfig[o].name+"+"+Math.floor(Number(U.GeneralConfig.getAttrValue(t[o]-e[o]))));r.textColor=12405786,r.size=24,n.addChild(r)}n.horizontalCenter=0,n.y=s.hero_model.height/2,s.hero_model.addChild(n),egret.Tween.get(n).wait(300).to({y:n.y-50,alpha:0},400).call(function(){n&&n.parent&&n.parent.removeChild(n)})}}))}else Utils.MsgUtils.addMidMsg("条件不满足")}else this.heroProxy.checkUpstarNotice(this.curInfo,this.upstarData),Utils.MsgUtils.addMidMsg("一键放入成功"),this.updateView()},this);for(var e=1;e<=5;e++){var t=this["skill_"+e];this.bindSkillPanelClick({target:t,x:34,bottom:e<4?200:132})}function i(t){o[t].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.curInfo.defendLevel;t<e?Utils.MsgUtils.addMidMsg("已激活"):t==e?U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_STAR_DEFEND,{info:this.curInfo,cb:this.updateDefendEffect.bind(this)}):e<t&&U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_STAR_DEFEND_ALL,{info:this.curInfo,chooseLevel:t+1,isAll:!1})},n)}this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.FORMATION)},this),this.btn_master.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.UnlockMgr.checkPass(MODULE.HeroEquipMaster).allow){var e=this.heroThingProxy.getHeroEquips(this.curUuid);if(4==e.length){var t=U.Config.getHeroEquipConfig(),i=0;for(var o in e){var n=t[e[o].code];n&&n.color<7&&(i=1)}i?Utils.MsgUtils.addMidMsg("当穿齐4件金色及以上品质装备时可激活"):U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.MASTER,{vo:e,heroUuid:this.curUuid})}else Utils.MsgUtils.addMidMsg("当穿齐4件金色及以上品质装备时可激活")}},this),this.btn_change.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.SELECT,{pos:this.heroProxy.heroUuid22Pos[this.curUuid],isPet:this.isPet})},this),this.btn_comment.visible=!Utils.SDKMgr.getPerformConfig(44),this.btn_comment.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.curInfo?U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_COMMENT,{info:r.curInfo}):Utils.MsgUtils.addMidMsg("还没有英雄")},this),this.hero_model.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hero_model.changeAction(customui.HeroDynamicModel.TOUCH_ACTION_LIST)},this),this.btn_details.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.ATTR_DETAIL,{info:this.curInfo})},this),Utils.SDKMgr.getPerformConfig(200002)?(this.btn_gzgzh.visible=!0,this.btn_gzgzh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){U.GameMVC.activityMed.showViewByCode(EActivityType.GuanZhuGongZhongHao)},this)):(this.btn_gzgzh.visible=!1,this.btn_gzgzh.height=0),this.btn_magic.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new U.MagicPutOnPanel({heroUuid:r.curUuid})})},this),Utils.UnlockMgr.checkPass(MODULE.BattleFormation,!1).allow?this.btn_mutiTeam.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){U.GameMVC.heroMutiTeamPy.server_GetBattleFormationInfo(function(){U.GameMVC.heroMutiTeamMed.showSubView(U.HeroMutiTeamMediator.SV.MAIN,{type:1})})},this):this.btn_mutiTeam.visible=!1,this.btn_derma.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.UnlockMgr.checkPass(MODULE.HeroDerma,!0).allow){var e=r.heroThingProxy.AllDermaInfo;if(0!=r.curInfo.dermaCode)U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_DERMA,{info:r.curInfo.config,uuid:r.curInfo.uuid,dermaCode:r.curInfo.dermaCode,isCanPutOn:!1,isCanPutDown:!0,isCanActivate:!1,isShowAllBtn:!0,putCB:r.updateOneHeroInfo.bind(r),putData:r.curInfo});else{var t=U.Config.getHeroDermaConfig(),i=!1;for(var o in t)t[o].subType==r.curInfo.config.subType&&(i=!0);if(i){var n=!1;for(var o in e)e[o].config.subType==r.curInfo.config.subType&&(n=!0);n?U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_DERMA,{info:r.curInfo.config,uuid:r.curInfo.uuid,dermaCode:r.curInfo.dermaCode,isCanPutOn:!0,isCanPutDown:!1,isCanActivate:!1,isShowAllBtn:!0,putCB:r.updateOneHeroInfo.bind(r),putData:r.curInfo}):U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_DERMA,{info:r.curInfo.config,uuid:r.curInfo.uuid,dermaCode:r.curInfo.dermaCode,isCanPutOn:!1,isCanPutDown:!1,isCanActivate:!0,isShowAllBtn:!0,putCB:r.updateOneHeroInfo.bind(r),putData:r.curInfo})}else{Utils.MsgUtils.addMidMsg("该英雄暂未拥有皮肤");var a=U.GameMVC.heroThingPy;U.AppFacade.getInstance().showSubView(U.FashionMediator.N,U.FashionMediator.SV.ALL_INFO,{module:MODULE.HeroDerma,allUuid:a.AllDermaInfo,bookConfig:U.Config.getHeroDermaHandbookConfig(),modelConfig:U.Config.getHeroDermaConfig()})}}}},this),Utils.TouchUtils.addTouchListener(this.btn_halo,function(){r.heroProxy.showCurHeroHalo()}),Utils.ComponentUtils.registerListener(this.btn_artifactResonate,egret.TouchEvent.TOUCH_TAP,function(){U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.ARTIFACT_RESONATE,{vo:r.curInfo})},this),Utils.ComponentUtils.registerListener(this.btn_resonate_attr,egret.TouchEvent.TOUCH_TAP,function(){U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.RESONATE_ATTR,{vo:r.curInfo})},this),Utils.ComponentUtils.registerListener(this.btn_resonate_unlock,egret.TouchEvent.TOUCH_TAP,function(){U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_PRACTICE,{vo:r.curInfo})},this),Utils.ComponentUtils.registerListener(this.btn_lock,egret.TouchEvent.TOUCH_TAP,function(){U.GameMVC.backpackPy.switchLock({lock:!r.curInfo.isLocked,type:EEntityType.EEntityTypeHero,uuid:r.curInfo.uuid,cb:function(){r.updateView()}})},this),this.btn_allDefend.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<this.curInfo.defendLevel?U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_STAR_DEFEND_ALLATTR,{info:this.curInfo}):Utils.MsgUtils.addMidMsg("未激活星灵")},this);var o=[this.gp_star_defend_0,this.gp_star_defend_1,this.gp_star_defend_2,this.gp_star_defend_3],n=this;for(e=0;e<4;e++)i(e)},n.prototype.updateDefendEffect=function(){this.gp_defend_effect.removeChildren(),DragonBoneTools.playOnce({effectName:"common_shcg",parent:this.gp_defend_effect,x:this.gp_defend_effect.width/2,y:this.gp_defend_effect.height/2})},n.prototype.updateMagicBtn=function(){if(Utils.UnlockMgr.checkPass(MODULE.MagicalPutOn,!1).allow){var e=U.GameMVC.magicalArtifactPy.allMagicalArtifactByUuid;for(var t in e){var i=e[t];if(i.heroUuid==this.curUuid){var o=parseInt(i.code)%100;return void(this.btn_magic.icon="icon_shenbing_"+(o<10?"0"+o:o)+"_png")}}this.btn_magic.icon="dzr_img_dikuang2_png"}else this.btn_magic.visible=!1},n.prototype.addNotice=function(){var e=[200,285],t=0;for(var i in NoticeManager.addNoticeListener(NT.HERO_UPSECTION,this.heroInfo_tabbar,this,{percentX:695/720,percentY:40/404}),NoticeManager.addNoticeListener(NT.HERO_THING,this.heroInfo_tabbar,this,{percentX:695/720,percentY:120/404}),this.heroInfoTabbarData.some(function(e){return e.type==n.HERO_INFO_TABBAR_TYPE.UPSTAR})&&NoticeManager.addNoticeListener(NT.HERO_UPSTAIR,this.heroInfo_tabbar,this,{percentX:695/720,percentY:e[t++]/404}),this.heroInfoTabbarData.some(function(e){return e.type==n.HERO_INFO_TABBAR_TYPE.RESONATE})&&(NoticeManager.addNoticeListener(NT.HERO_RESONATE,this.heroInfo_tabbar,this,{percentX:695/720,percentY:e[t++]/404}),NoticeManager.addNoticeListener(NT.HERO_RESONATE_UNLOCK,this.btn_resonate_unlock.iconDisplay,this,BTN_ICON_NOTICE_POS)),NT.HERO_CAN_FORMATION){var o=NT.HERO_CAN_FORMATION[i];NoticeManager.addNoticeListener(o,this.gp_heroitems,this,{percentX:(115*parseInt(i)+97)/705,percentY:14/132})}this.resFullImg.right=-10,this.resFullImg.visible=!1,this.btn_derma&&this.btn_derma.addChild(this.resFullImg),NoticeManager.addNoticeListener(NT.HERO_DERMA,this.btn_derma.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.GUAJI_GZGZH3,this.btn_gzgzh.getChildAt(0),this,BTN_ICON_NOTICE_POS)},n.prototype.removeNoticeInTabbar=function(){for(var e in NoticeManager.removeNoticeListener(NT.HERO_UPSECTION),NoticeManager.removeNoticeListener(NT.HERO_THING),NoticeManager.removeNoticeListener(NT.HERO_UPSTAIR),NoticeManager.removeNoticeListener(NT.HERO_RESONATE),NoticeManager.removeNoticeListener(NT.HERO_RESONATE_UNLOCK),NT.HERO_CAN_FORMATION){var t=NT.HERO_CAN_FORMATION[e];NoticeManager.removeNoticeListener(t)}NoticeManager.removeNoticeListener(NT.HERO_DERMA),NoticeManager.removeNoticeListener(NT.GUAJI_GZGZH3)},n.HERO_INFO_TABBAR_TYPE={UPGRADE:0,EQUIPMENT:1,UPSTAR:2,RESONATE:3},n.BTN_TYPE={pinglun:{icon:"_btn_lb_m_json.common_icon_liaotian",text:"评论",id:"btn_comment"},buzhen:{icon:"_btn_lb_m_json.common_icon_buzhen",text:"布阵",id:"btn_formation"},derma:{icon:"_btn_lb_m_json.common_icon_pifu",text:"皮肤",id:"btn_derma"},halo:{icon:"_btn_lb_m_json.common_icon_guanghuan",text:"光环",id:"btn_halo"},huanzhen:{icon:"_btn_lb_m_json.common_icon_huanzhen",text:"换阵",id:"btn_change"}},n.BTN_LEFT_TYPE={pinglun:{icon:"_btn_lb_m_json.common_icon_guanzhuweixin",text:"关注微信",id:"btn_gzgzh"},magical:{icon:"dzr_img_dikuang2_png",text:"神 器",id:"btn_magic"},mutiTeam:{icon:"item_icon_zhenrongtiaozheng_png",text:"阵容调整",id:"btn_mutiTeam"}},n);function n(){var e=i.call(this)||this;return e.index=0,e.initialized=!1,e.upstarData={},e.heroInfoTabbarData=[],e.resFullImg=new eui.Image("_main_m_json.maoxian_icon_man"),e.heroThingPos=[[-67,131],[67,7],[253,7],[382,131],[253,261],[67,261],[160,135]],e.conditionMap={1:"oneSlotCosts",2:"twoSlotCosts",3:"threeSlotCosts",4:"fourSlotCosts"},e.skinName="HeroMainViewSkin",e.heroProxy=U.AppFacade.getInstance().retrieveProxy(U.HeroPy.N),e.heroThingProxy=U.AppFacade.getInstance().retrieveProxy(U.HeroThingPy.N),e.heroThingItems=new Array,e.guideEffectWait=!0,e}U.HeroMainView=o,__reflect(o.prototype,"game.HeroMainView");var t,a=(t=eui.Component,__extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem),this.gp_baseitem.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){U.AppFacade.getInstance().updateView(U.HeroMediator.N,U.HeroMediator.SV.MAIN,{upstarData:{},uuid:this.data.uuid})},this),this.gp_empty.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.unlock.allow?U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.SELECT):Utils.MsgUtils.addMidMsg(this.data.unlock.ext.tips)},this)},e.prototype.updateItem=function(e){if(this.data=e,this.data.uuid)if(this.gp_baseitem.visible=!0,this.gp_empty.visible=!1,e.oneAvatar)this.baseItem.updateData({uuid:this.data.uuid,type:EEntityType.EEntityTypeHero,effect:!0,isShowZhongZhu:!0,avatar:e.oneAvatar,isShowEffect:!0});else if(0!=e.info.dermaCode){var t=U.Config.getHeroDermaConfig()[e.info.dermaCode].avatar;this.baseItem.updateData({uuid:this.data.uuid,type:EEntityType.EEntityTypeHero,effect:!0,isShowZhongZhu:!0,avatar:t,isShowEffect:!0})}else this.baseItem.updateData({uuid:this.data.uuid,type:EEntityType.EEntityTypeHero,effect:!0,isShowZhongZhu:!0});else this.gp_baseitem.visible=!1,this.gp_empty.visible=!0,this.data.unlock.allow?(this.img_add.visible=!0,this.img_lock.visible=!1,this.lb_unlock.visible=!1):(this.img_add.visible=!1,this.img_lock.visible=!0,this.lb_unlock.visible=!0,this.lb_unlock.text="LV "+this.data.unlock.ext.requestLevel)},e);function e(){var e=t.call(this)||this;return e.skinName="HeroMainView_HeroListItem",e.heroThingProxy=U.AppFacade.getInstance().retrieveProxy(U.HeroThingPy.N),e}U.HeroMainView_HeroListItem=a,__reflect(a.prototype,"game.HeroMainView_HeroListItem");var r,s=(r=eui.Component,__extends(c,r),c.prototype.childrenCreated=function(){r.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChildAt(this.baseItem,0),this.gp_baseitem.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){U.AppFacade.getInstance().updateView(U.HeroMediator.N,U.HeroMediator.SV.MAIN,{upstarData:{},uuid:this.data.uuid})},this),this.gp_empty.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.unlock.allow?U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.SELECT,{isPet:!0}):Utils.MsgUtils.addMidMsg(this.data.unlock.ext.tips)},this)},c.prototype.updateItem=function(e){if(this.data=e,this.data.uuid){this.gp_baseitem.visible=!0,this.gp_empty.visible=!1;var t=this.heroThingProxy.AllDermaInfo,i=void 0;for(var o in t)if(t[o].heroUuid==this.data.uuid){i=t[o].config.avatar;break}i?this.baseItem.updateData({uuid:this.data.uuid,type:EEntityType.EEntityTypePet,avatar:i,isShowEffect:!0}):this.baseItem.updateData({uuid:this.data.uuid,type:EEntityType.EEntityTypePet})}else this.gp_baseitem.visible=!1,this.gp_empty.visible=!0,this.data.unlock.allow?(this.img_add.visible=!0,this.img_lock.visible=!1):(this.img_add.visible=!1,this.img_lock.visible=!0)},c);function c(){var e=r.call(this)||this;return e.skinName="HeroMainView_PetItem",e.heroThingProxy=U.AppFacade.getInstance().retrieveProxy(U.HeroThingPy.N),e}__reflect(s.prototype,"HeroMainView_PetItem");var l,_=(l=eui.Component,__extends(h,l),h.prototype.childrenCreated=function(){l.prototype.childrenCreated.call(this),this.data&&this.updateItem()},h.prototype.updateItem=function(e){e&&(this.data=e),this.img_icon.source=AttrConfig[this.data.type].icon;var t=U.GeneralConfig.getAttrValue(this.data.num);0<=t.indexOf("%")?this.blb_num.text=t:this.blb_num.text=Math.floor(Number(t)).toString()},h);function h(e){var t=l.call(this)||this;return t.data=e,t.skinName="HeroMainView_AttrItem",t}U.HeroMainView_AttrItem=_,__reflect(_.prototype,"game.HeroMainView_AttrItem");var p,d=(p=eui.Component,__extends(u,p),u.prototype.childrenCreated=function(){var e=this;p.prototype.childrenCreated.call(this),this.bi_root.touchEnabled=!1,this.scaleX=this.scaleY=1.1,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.clickFunction&&e.clickFunction()},this),UIActionManager.fadeBlink(this.img_canPuton,!0,!1,1e3)},u.prototype.update=function(e){var t=this;if(this.vo=e.vo,this.hero=e.hero,this.params=e,this.vo)this.img_zhanwei.visible=!1,this.img_canPuton.visible=!1,this.bi_root.visible=!0,this.bi_root.updateData({uuid:this.vo.uuid,code:this.vo.code,type:this.entityType,isNum:!0}),this.clickFunction=function(){U.AppFacade.getInstance().showSubView(U.HeroThingMediator.N,U.HeroThingMediator.SV.MAIN,{entityType:t.entityType,vo:t.vo,hero:t.hero,source:e&&e.source||U.HeroThingMainView.VIEW_SOURCE.HERO,teamId:e&&e.teamId})};else{this.bi_root.visible=!1,this.img_zhanwei.visible=!0;var i=this.unlockLevel(),o=U.AppFacade.getInstance().retrieveProxy(U.HeroThingPy.N),n=U.AppFacade.getInstance().retrieveProxy(U.PlayerPy.N).playerInfoVO.level;if(this.entityType==EEntityType.EEntityTypeTreasure?Utils.UnlockMgr.checkPass(MODULE.Treasure,!1).allow:i<=n){this.lb_unlock.visible=!1;var a="",r=o.AllArtiInfo;this.entityType==EEntityType.EEntityTypeHeroEquip?r=o.AllEquipInfo:this.entityType==EEntityType.EEntityTypeHeroArtifact?r=o.AllArtiInfo:this.entityType==EEntityType.EEntityTypeTreasure&&(r=o.AllTreasureInfo);var s=!1,c=U.Config.getHeroArtifactConfig();for(var l in r){var h=r[l];if(""==h.heroUuid&&this.type==h.type&&(this.entityType!=EEntityType.EEntityTypeHeroArtifact||c&&c[h.code]&&c[h.code].type==HeroArtifactType.Normal)){s=!0;break}}switch(this.entityType){case EEntityType.EEntityTypeHeroEquip:switch(this.type){case HeroEquipType.Ornament:a="baowu_img_xianglian";break;case HeroEquipType.Armour:a="baowu_img_kuijia";break;case HeroEquipType.Shoe:a="baowu_img_xiezi";break;case HeroEquipType.Weapon:a="baowu_img_wuqi"}break;case EEntityType.EEntityTypeHeroArtifact:a="baowu_img_fuwen"}this.img_canPuton.visible=s,this.img_zhanwei.source=a?a+"_png":a,this.img_zhanwei.verticalCenter=0}else this.img_zhanwei.source="common_img_suo_png",this.img_zhanwei.verticalCenter=-10,this.img_canPuton.visible=!1,this.lb_unlock.visible=!0,this.entityType==EEntityType.EEntityTypeTreasure?(Utils.UnlockMgr.checkPass(MODULE.Treasure,!1).ext.needOpen?this.lb_unlock.text="开服"+(Utils.UnlockMgr.checkPass(MODULE.Treasure,!1).ext.needOpen+1)+"天解锁":Utils.UnlockMgr.checkPass(MODULE.Treasure,!1).ext.requestLevel&&(this.lb_unlock.text=Utils.UnlockMgr.checkPass(MODULE.Treasure,!1).ext.requestLevel+"级解锁"),this.lb_unlock.size=17):(this.lb_unlock.text="LV "+i,this.lb_unlock.size=20),this.clickFunction=function(){if(t.entityType==EEntityType.EEntityTypeTreasure){var e=t.lb_unlock.text;Utils.MsgUtils.addMidMsg(e)}else Utils.MsgUtils.addMidMsg("队伍等级不足")}}},u);function u(){var e=p.call(this)||this;return e.skinName="HeroMainView_HeroThingItem",e}U.HeroThingBox=d,__reflect(d.prototype,"game.HeroThingBox");var g,f=(__extends(m,g=d),m.prototype.update=function(e){var t=this;if(e){g.prototype.update.call(this,e);var i=U.AppFacade.getInstance().retrieveProxy(U.PlayerPy.N).playerInfoVO.level;e&&e.source==U.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM&&this.bi_root.updateData({vo:this.vo,code:this.vo.code,type:this.entityType,isNum:!0}),!this.vo&&i>=this.unlockLevel()&&(e&&e.source==U.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM_PUTON?this.clickFunction=this.mutiTeamEquipPutOn:this.clickFunction=function(){U.AppFacade.getInstance().showSubView(U.HeroThingMediator.N,U.HeroThingMediator.SV.SELECT,{entityType:t.entityType,heroUuid:t.hero.uuid,type:t.type,source:e&&e.source||U.HeroThingMainView.VIEW_SOURCE.HERO,teamId:e&&e.teamId,doneCB:function(e){U.AppFacade.getInstance().retrieveProxy(U.HeroThingPy.N).HeroEquipPutOn(e.uuid,t.hero.uuid,e.type)}})})}},m.prototype.mutiTeamEquipPutOn=function(){var c=this,l=U.GameMVC.heroMutiTeamPy.getHeroEquips(this.params.teamId);PopUpManager.addPopUp({obj:new U.CommonChosePanel({getInfos:function(){function e(e){var t=s[e],i=l.filter(function(e){return e.originalUuid==t.uuid}).length;if(function(e){return e.type==c.type}(t)&&i<t.num)for(var o=t.num-i,n=0;n<o;n++){var a=t.uuid+"#"+n;r[a]={uuid:t.uuid,type:EEntityType.EEntityTypeHeroEquip,code:t.code}}}var r={},s=U.GameMVC.heroThingPy.AllEquipInfo;for(var t in s)e(t);return r},singleChoose:!0,sortFunc:function(e,t){var i=e.info,o=t.info,n=U.Config.getHeroEquipConfig();return n[i.code].color!=n[o.code].color?n[o.code].color-n[i.code].color:n[i.code].starLevel!=n[o.code].starLevel?n[o.code].starLevel-n[i.code].starLevel:i.level!=o.level?o.level-i.level:i.code!=o.code?o.code-i.code:void 0},type:EEntityType.EEntityTypeHeroEquip,uniNum:!0,checkFull:function(e){return 1<=e.length},title:"请选择装备"}),closeCB:function(e){e&&e[0]&&U.GameMVC.heroMutiTeamPy.changeEquip(c.params.teamId,c.hero.uuid,"",e[0].split("#")[0])}})},m);function m(e){var t=g.call(this)||this;return t.type=e,t.entityType=EEntityType.EEntityTypeHeroEquip,t.unlockLevel=function(){return U.Config.getHeroEquipUnlockLevel(t.type)},t}U.HeroEquipBox=f,__reflect(f.prototype,"game.HeroEquipBox");var y,v=(__extends(T,y=d),T.prototype.update=function(e){var t=this;if(e){y.prototype.update.call(this,e);var i=U.AppFacade.getInstance().retrieveProxy(U.PlayerPy.N).playerInfoVO.level;e&&e.source==U.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM&&this.bi_root.updateData({vo:this.vo,code:this.vo.code,type:this.entityType,isNum:!0}),!this.vo&&i>=this.unlockLevel()&&(e&&e.source==U.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM_PUTON?this.clickFunction=this.mutiTeamArtifactPutOn:this.clickFunction=function(){U.AppFacade.getInstance().showSubView(U.HeroThingMediator.N,U.HeroThingMediator.SV.SELECT,{entityType:t.entityType,heroUuid:t.hero.uuid,type:t.type,doneCB:function(e){U.AppFacade.getInstance().retrieveProxy(U.HeroThingPy.N).HeroArtifactPutOn(e.uuid,t.hero.uuid,e.type)}})})}},T.prototype.mutiTeamArtifactPutOn=function(){var t=this,c=U.GameMVC.heroMutiTeamPy.getHeroArtifact(this.params.teamId);PopUpManager.addPopUp({obj:new U.CommonChosePanel({getInfos:function(){function e(e){var t=s[e],i=c.filter(function(e){return e.originalUuid==t.uuid}).length;if(function(e){return 1==e.config.type}(t)&&i<t.num)for(var o=t.num-i,n=0;n<o;n++){var a=t.uuid+"#"+n;r[a]={uuid:t.uuid,type:EEntityType.EEntityTypeHeroArtifact,code:t.code}}}var r={},s=U.GameMVC.heroThingPy.AllArtiInfo;for(var t in s)e(t);return r},singleChoose:!0,sortFunc:function(e,t){var i=e.info,o=t.info,n=U.Config.getHeroArtifactConfig();return n[i.code].color!=n[o.code].color?n[o.code].color-n[i.code].color:n[i.code].sectionLevel!=n[o.code].sectionLevel?n[o.code].sectionLevel-n[i.code].sectionLevel:i.level!=o.level?o.level-i.level:i.code!=o.code?o.code-i.code:void 0},type:EEntityType.EEntityTypeHeroArtifact,uniNum:!0,checkFull:function(e){return 1<=e.length},title:"请选择圣物"}),closeCB:function(e){e&&e[0]&&U.GameMVC.heroMutiTeamPy.changeArtifact(t.params.teamId,t.hero.uuid,e[0].split("#")[0])}})},T);function T(e){var t=y.call(this)||this;return t.type=e,t.entityType=EEntityType.EEntityTypeHeroArtifact,t.unlockLevel=function(){return U.Config.getHeroArtifactUnlockLevel()},t}U.HeroArtifactBox=v,__reflect(v.prototype,"game.HeroArtifactBox");var C,E=(__extends(I,C=d),I.prototype.update=function(e){var t=this;if(e)if(C.prototype.update.call(this,e),this.vo)this.canActivateImg&&(this.canActivateImg.visible=!1);else{var i=Utils.UnlockMgr.checkPass(MODULE.Treasure,!1).allow;U.AppFacade.getInstance().retrieveProxy(U.PlayerPy.N).playerInfoVO.level,i&&(this.canActivateImg||(this.canActivateImg=new eui.Image("_border_m_json.common_img_jihuobaowu"),this.canActivateImg.left=this.canActivateImg.right=this.canActivateImg.top=this.canActivateImg.bottom=0,this.addChildAt(this.canActivateImg,this.numChildren-1)),this.canActivateImg.visible=!0,e&&e.source==U.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM_PUTON?this.clickFunction=function(){Utils.MsgUtils.addMidMsg("未激活")}:this.clickFunction=function(){U.AppFacade.getInstance().showSubView(U.HeroThingMediator.N,U.HeroThingMediator.SV.SPECIAL_TREASURE,{hero:t.hero})})}},I);function I(e){var t=C.call(this)||this;return t.type=e,t.entityType=EEntityType.EEntityTypeTreasure,t.unlockLevel=function(){return U.Config.getHeroTreasureUnlockLevel()},t}U.HeroTreasureBox=E,__reflect(E.prototype,"game.HeroTreasureBox");var b,A=(b=eui.Component,__extends(P,b),P.prototype.childrenCreated=function(){b.prototype.childrenCreated.call(this),this.scaleX=this.scaleY=1.1,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this._onSelfTap,this),UIActionManager.fadeBlink(this.img_add,!0,!1,1e3),egret.Tween.get(this.img_icon,{loop:!0}).to({verticalCenter:-15},1e3).to({verticalCenter:0},1e3)},P.prototype.update=function(e){e&&(this.params=e,this.vo=this.params.vo,this.hero=this.params.hero,this.vo?(this.img_add.visible=!1,this.img_name.visible=!1,this.img_icon.source=this.vo.config.img+"_png"):(this.img_icon.source="",this.img_name.visible=!0,this.visible=Utils.UnlockMgr.checkPass(MODULE.Immortal,!1).allow))},P.prototype._onSelfTap=function(){var t=this;this.vo?U.AppFacade.getInstance().showSubView(U.HeroThingMediator.N,U.HeroThingMediator.SV.MAIN,{entityType:this.entityType,vo:this.vo,hero:this.hero,source:this.params&&this.params.source||U.HeroThingMainView.VIEW_SOURCE.HERO,teamId:this.params&&this.params.teamId}):this.params&&this.params.source==U.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM_PUTON?this.mutiTeamImmortalPutOn():U.AppFacade.getInstance().showSubView(U.HeroThingMediator.N,U.HeroThingMediator.SV.SELECT,{entityType:this.entityType,heroUuid:this.hero.uuid,type:this.type,doneCB:function(e){U.AppFacade.getInstance().retrieveProxy(U.HeroThingPy.N).PutImmortalOn({uuid:e.uuid,heroUuid:t.hero.uuid})}})},P.prototype.mutiTeamImmortalPutOn=function(){var t=this,c=U.GameMVC.heroMutiTeamPy.getHeroImmortal(this.params.teamId);PopUpManager.addPopUp({obj:new U.CommonChosePanel({getInfos:function(){function e(e){var t=s[e],i=c.filter(function(e){return e.originalUuid==t.uuid}).length;if(i<t.num)for(var o=t.num-i,n=0;n<o;n++){var a=t.uuid+"#"+n;r[a]=t}}var r={},s=U.GameMVC.heroThingPy.AllImmortalInfo;for(var t in s)e(t);return r},singleChoose:!0,sortFunc:function(e,t){var i=e.info,o=t.info;return U.Config.immortalConfig(),i.sectionLevel!=o.sectionLevel?o.sectionLevel-i.sectionLevel:i.code!=o.code?o.code-i.code:void 0},type:EEntityType.EEntityTypeImmortal,uniNum:!0,checkFull:function(e){return 1<=e.length},title:"请选择神兵"}),closeCB:function(e){e&&e[0]&&U.GameMVC.heroMutiTeamPy.changeImmortal(t.params.teamId,t.hero.uuid,e[0].split("#")[0])}})},P);function P(e){var t=b.call(this)||this;return t.type=e,t.entityType=EEntityType.EEntityTypeImmortal,t.skinName="HeroMainView_ImmortalBoxSkin",t}U.HeroImmortalBox=A,__reflect(A.prototype,"game.HeroImmortalBox");var M,L=(M=eui.Component,__extends(N,M),N.prototype.childrenCreated=function(){M.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_avatar.addChild(this.baseItem),this.updateItem(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.SELECT_UPSTAR,{data:this.data.data,targetUuid:this.data.targetUuid,slot:this.data.slot})},this)},N.prototype.updateItem=function(e){var t=this.data.data[this.data.slot],i=JSON.parse(t.condition),o=t.uuids.length,n=0,a=this.heroProxy.allHeroByUuid,r=U.Config.allHeroConfig(),s=0,c=0,l=[],h=this.heroThingProxy.AllDermaInfo,p=void 0;for(var d in h)if(h[d].heroUuid==this.data.uuid){p=h[d].config.avatar;break}if(1==i[0])this.baseItem.img_icon.visible=!0,p?this.baseItem.updateData({code:i[1][0][1],avatar:p,isShowEffect:!0}):this.baseItem.updateData({code:i[1][0][1]}),n=i[1][0][2];else if(2==i[0]){var u=this.findRandomHero(i[1]);p?this.baseItem.updateData({code:u,avatar:p,isShowEffect:!0}):this.baseItem.updateData({code:u}),i[1][0]?this.baseItem.img_type.visible=!0:this.baseItem.img_type.visible=!1;var g=U.Config.allHeroConfig()[u].initStar,f=1;[[0,3],[4,4],[5,5],[6,8],[9,9],[10,15]].forEach(function(e,t){g>=e[0]&&g<=e[1]&&(f=t+1)}),this.baseItem.img_icon.source="beibao_img_sptb_"+f+"_png",n=i[1][3]}for(var _ in this.blb_num.text=o+"/"+n,this.data.data)l=l.concat(this.data.data[_].uuids);for(var m in a){var y=a[m],v=r[y.code];m==this.data.targetUuid||-1!=l.indexOf(m)||this.heroProxy.heroUuid22Pos[m]||(1==i[0]?y.code==i[1][0][1]&&s++:2==i[0]&&(0!=i[1][0]&&v.race!=i[1][0]||0!=i[1][1]&&y.starLevel!=i[1][1]||0!=i[1][2]&&v.profession!=i[1][2]||c++))}UIActionManager.setAbsGrey(this.gp_avatar,o!=n),this.img_add.visible=o!=n?n<=s||n<=c:o!=n,UIActionManager.setGrey(this.baseItem,this.img_add.visible),this.gp_effect.removeChildren(),this.img_add.visible?egret.Tween.get(this.img_add,{loop:!0}).to({alpha:0},700,egret.Ease.cubicIn).wait(250).to({alpha:1},700,egret.Ease.cubicOut):e&&e.effect&&DragonBoneTools.playOnce({effectName:"common_yingxiongshengxing",parent:this.gp_effect,y:this.gp_effect.height/2,x:this.gp_effect.width/2})},N.prototype.findRandomHero=function(e){var t=U.Config.allHeroConfig();for(var i in t){var o=t[i];if(!(0!=e[0]&&o.race!=e[0]||0!=e[1]&&o.initStar!=e[1]||0!=e[2]&&o.profession!=e[2]))return Number(i)}},N);function N(e){var t=M.call(this)||this;return t.heroProxy=U.AppFacade.getInstance().retrieveProxy(U.HeroPy.N),t.data=e,t.skinName="HeroMainView_UpstarItem",t.heroThingProxy=U.AppFacade.getInstance().retrieveProxy(U.HeroThingPy.N),t}__reflect(L.prototype,"HeroMainView_UpstarItem");var S,k=(S=eui.ItemRenderer,__extends(O,S),O.prototype.childrenCreated=function(){S.prototype.childrenCreated.call(this),this.btn_activate.labelDisplay.size=24,this.btn_activate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.activatable?this.proxy.HeroResonate({uuid:this.data.uuid,order:this.data.config.order,cb:function(){O.delay=500;var e=t.parent.parent.parent;DragonBoneTools.playOnce({effectName:"common_ty_jihuo",parent:e,x:e.width/2,y:-200})}}):Utils.MsgUtils.addMidMsg("条件不满足")},this)},O.prototype.dataChanged=function(){var i=this;this.gp_activated.visible=this.data.activated;var e=this.data.config;this.lb_title.text=e.desc;var t=JSON.parse(e.attrAdd1);this.lb_title.text=AttrConfig[t[0][0]].name+"加成："+U.GeneralConfig.getAttrValue(t[0][1]),this.gp_hero.removeChildren(),this.gp_effect.removeChildren(),this.gp_effect.touchEnabled=!1,this.gp_effect.touchChildren=!1,this.gp_effect.touchThrough=!0;var o=this.proxy.allHeroByUuid[this.data.uuid],n=customui.BaseItemFactory.create();n.scaleX=n.scaleY=.6,n.updateData({code:o.code,type:EEntityType.EEntityTypeHero}),this.gp_hero.addChild(n),this.jibanEffect(n);var a=JSON.parse(e.heroId);this.activatable=!0,a.forEach(function(e){i.gp_hero.addChild(new eui.Image("common_img_jia_png"));var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.6,t.updateData({code:e,type:EEntityType.EEntityTypeHero}),i.proxy.heroHistoryInfo[e]||(UIActionManager.setAbsGrey(t),i.activatable=!1),i.jibanEffect(t),i.gp_hero.addChild(t)}),O.delay=0,this.btn_activate.visible=this.activatable&&!this.data.activated},O.prototype.jibanEffect=function(t){var e=this;this.data.activated&&egret.setTimeout(function(){DragonBoneTools.create("common_jiban",function(e){e.x=t.x+t.width/2*.6,e.y=t.y+t.height/2*.6,e.scaleX=e.scaleY=.8,e.animation.play(),this.gp_effect.addChild(e)},e)},this,O.delay)},O.delay=0,O);function O(){var e=S.call(this)||this;return e.skinName="HeroResonatePanel_ListItem",e.proxy=U.AppFacade.getInstance().retrieveProxy(U.HeroPy.N),e}__reflect(k.prototype,"HeroResonatePanel_ListItem");var w,x=(__extends(R,w=BasePanel),R.prototype.childrenCreated=function(){var e=this;w.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_left,egret.TouchEvent.TOUCH_TAP,function(){e.updateView({type:1})},this),Utils.ComponentUtils.registerListener(this.btn_right,egret.TouchEvent.TOUCH_TAP,function(){e.updateView({type:2})},this)},R.prototype.updateView=function(e,t){var s=this;if(void 0===t&&(t=!1),this.info=e&&e.info||this.info,t){var i=U.Config.attrDescConfig(),o=[];for(var n in i){var a=i[n];a.isShow&&o.push(a)}o.sort(function(e,t){return e.priority-t.priority});var c=e.fromHeroChallenge;c?this.btn_left.visible=this.btn_right.visible=!1:(this.btn_left.visible=!1,this.btn_right.visible=!0);var l=JSON.parse(this.info.attr);o.forEach(function(e){var t=l[e.type]||0;if(!c||0!=t){var i=new eui.Group;i.width=300,i.height=27;var o=e.shortDesc,n=new eui.Label(o);n.size=24,i.addChild(n);var a=U.GeneralConfig.getAttrValue(t);c||(e.type<=4?a=Math.floor(Number(a)).toString():0==t&&(a+="%"));var r=new eui.Label(""+a);r.size=24,r.right=3,i.addChild(r),r.verticalCenter=n.verticalCenter=0,s.gp_listAttr.addChild(i)}}),this.gp_listAttr.$children.length?this.gp_empty.visible=!1:this.gp_empty.visible=!0,o.forEach(function(e){var t=new eui.Group;t.width=320;var i=new eui.Label(e.shortDesc+"：");i.y=2,i.textColor=764145,i.size=20,i.right=222,t.addChild(i);var o=new eui.Label(e.desc);o.y=2,o.size=20,o.width=230,o.left=100,o.lineSpacing=6,t.addChild(o),s.gp_listDesc.addChild(t)})}switch(e&&e.type||1){case 1:this.gp_attr.visible=!0,this.gp_desc.visible=!1,this.btn_left.visible=!1,this.btn_right.visible=!0;break;case 2:this.gp_attr.visible=!1,this.gp_desc.visible=!0,this.btn_left.visible=!0,this.btn_right.visible=!1}},R);function R(){var e=w.call(this)||this;return e.skinName="HeroAttrDetailsPanelSkin",e}U.HeroAttrDetailsPanel=x,__reflect(x.prototype,"game.HeroAttrDetailsPanel");var B,D=(__extends(V,B=BaseFull),V.prototype.adaptForQuickTrain=function(){this.gp_hero_list.visible=!1,this.btn_back.visible=!0,this.gp_fightCap.visible=!0,this.initGPRightBtn(),this.initGPLeftBtn()},V.prototype.initGPRightBtn=function(){for(var e in V.BTN_TYPEQUICK){var t=V.BTN_TYPEQUICK[e],i=new eui.Button;i.skinName="skins.ButtonSkinIcon2",i.width=80,i.height=94,i.icon=t.icon,i.label=t.text,this[t.id]=i,this.gp_right_btn.addChild(this[t.id]),!Utils.SDKMgr.getPerformConfig(2)||"fenxiang"!=e&&"pinglun"!=e||(i.visible=!1,i.enabled=!1)}},V.prototype.initGPLeftBtn=function(){for(var e in V.BTN_LEFT_TYPE){var t=V.BTN_LEFT_TYPE[e],i=new eui.Button;i.skinName="skins.ButtonSkinIcon2",i.width=80,i.height=94,i.icon=t.icon,i.label=t.text,this[t.id]=i,this.gp_left_btn.addChild(this[t.id])}},V.prototype.childrenCreated=function(){B.prototype.childrenCreated.call(this),this.initTabbar(),this.initThing(),this.adaptForQuickTrain(),this.activateComponent(),this.list_resonate.itemRenderer=k},V.prototype.initTabbar=function(e){void 0===e&&(e=!0),this.heroInfo_tabbar.itemRendererSkinName="HeroMainView_HeroInfoTabItem",this.heroInfo_tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.heroFoster_onItemTap,this),this.heroInfo_tabbar.selectedIndex=0},V.prototype.initThing=function(){var e=this,t=0;for(var i in HeroEquipType){var o=new f(HeroEquipType[i]);this.heroThingItems.push(o);var n=this.heroThingPos[t++];o.x=n[0],o.y=n[1],this.gp_thingBox.addChild(o)}o=new E,this.heroThingItems.push(o),n=this.heroThingPos[t++],o.x=n[0],o.y=n[1],this.gp_thingBox.addChild(o),o=new v,this.heroThingItems.push(o),n=this.heroThingPos[t++],o.x=n[0],o.y=n[1],this.gp_thingBox.addChild(o),o=new A,this.heroThingItems.push(o),n=this.heroThingPos[t++],o.x=n[0],o.y=n[1],this.gp_thingBox.addChild(o),this.btn_putOn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.heroProxy.HeroOneKeyPutOn(e.curUuid)},this),this.btn_putOff.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.heroProxy.HeroOneKeyPutDown(e.curUuid)},this)},V.prototype.updateView=function(e){var t=e&&e.uuid,i=!t&&!this.curUuid||t&&this.curUuid!=t;if(this.curUuid=t||this.curUuid,this.upstarData=e&&e.upstarData||this.upstarData,this.allUuids=e&&e.allUuids||this.allUuids,this.allUuids||(this.btn_lastOne.visible=!1,this.btn_nextOne.visible=!1),!this.curUuid)for(var o=1;o<=5;o++)if(this.heroProxy.heroUuid22Pos[o]){this.curUuid=this.heroProxy.heroUuid22Pos[o];break}this.curUuid?(this.gp_heroInfo.visible=!0,this.gp_hero.visible=!0,this.isPet=!1,this.curInfo=this.heroProxy.allHeroByUuid[this.curUuid],i&&this.updateTabbar(),this.updateHeroInfo(),this.heroFoster_onItemTap(),NoticeManager.updateNotice([NT.HERO_RESONATE_RESONATE,NT.HERO_RESONATE_UNLOCK],this.curInfo,!0),NoticeManager.updateNotice(NT.HERO_DERMA,{info:this.curInfo})):(this.gp_hero.visible=!1,this.gp_heroInfo.visible=!1),this.updateMagicBtn()},V.prototype.heroFoster_onItemTap=function(e){e&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex);var t=e&&e.item.type||this.heroInfo_tabbar.selectedItem&&this.heroInfo_tabbar.selectedItem.type||0;this.curType=t,this.img_btmPattern.visible=!1,this.gp_heroThing.visible=!1,this.gp_up.visible=!1,this.gp_upstar.visible=!1,this.gp_upgrade.visible=!1,this.gp_resonate.visible=!1,this.btn_up.visible=!1,this.btn_upstar.visible=!1;var i=this.isPet?"魔兽":"英雄";switch(this.img_bg.source=HeroRaceConfig[this.curInfo.config.race].bgSrc,this.img_base.source=HeroRaceConfig[this.curInfo.config.race].baseSrc,t){case o.HERO_INFO_TABBAR_TYPE.EQUIPMENT:this.img_btmPattern.visible=!0,this.blb_title.text=i+"装备",this.updateHeroThing();break;case o.HERO_INFO_TABBAR_TYPE.UPGRADE:this.btn_up.visible=!0,this.blb_title.text=i+"信息",this.updateHeroUpgrade();break;case o.HERO_INFO_TABBAR_TYPE.UPSTAR:this.btn_upstar.visible=!0,this.blb_title.text=i+"升星",this.updateHeroUpstar();break;case o.HERO_INFO_TABBAR_TYPE.RESONATE:this.blb_title.text=i+"羁绊",this.updateHeroResonate()}},V.prototype.updateTabbar=function(){var e=[{up:"_btn_yq_m_json.common_yeqian_shengji_0",down:"_btn_yq_m_json.common_yeqian_shengji_1",type:o.HERO_INFO_TABBAR_TYPE.UPGRADE}];e.push({up:"_btn_yq_m_json.common_yeqian_zhuangbei_0",down:"_btn_yq_m_json.common_yeqian_zhuangbei_1",type:o.HERO_INFO_TABBAR_TYPE.EQUIPMENT}),this.curInfo.config.isStar&&e.push({up:"_btn_yq_m_json.common_yeqian_shengxing_0",down:"_btn_yq_m_json.common_yeqian_shengxing_1",type:o.HERO_INFO_TABBAR_TYPE.UPSTAR}),!this.isPet&&0<U.Config.heroResonateConfig(this.curInfo.config.subType).length&&e.push({up:"_btn_yq_m_json.common_yeqian_jiban_0",down:"_btn_yq_m_json.common_yeqian_jiban_1",type:o.HERO_INFO_TABBAR_TYPE.RESONATE}),this.heroInfo_tabbar.dataProvider=new eui.ArrayCollection(e),this.addNotice()},V.prototype.updateHeroUpgrade=function(){var t=this;this.gp_up.visible=!0,this.gp_upgrade.visible=!0;var c=this.curInfo,l=c.config;this.item_fightCap.update(c.fightCap),this.img_profession.source=ProfessionConfig[l.profession].icon,this.img_race.source=HeroRaceConfig[l.race].raceIconBig,this.lb_profession.text=l.name,this.lb_desc.text=l.desc,this.baseItem_avatar||(this.baseItem_avatar=customui.BaseItemFactory.create(),this.baseItem_avatar.scaleX=this.baseItem_avatar.scaleY=.7,this.baseItem_avatar.touchEnabled=!1,this.gp_heroAvatar.addChild(this.baseItem_avatar)),this.baseItem_avatar.updateData({code:c.code,effect:!0}),this.baseItem_avatar.gp_star_hero.visible=this.baseItem_avatar.img_type.visible=this.baseItem_avatar.gp_star_hero2.visible=!1,this.gp_upgrade_attr.removeChildren();for(var e=JSON.parse(c.attr),i=1;i<=4;i++)this.gp_upgrade_attr.addChild(new _({type:i,num:e[i]}));function o(e){var t=d["skill_"+e];if(p)t.reset();else{var i=SKILL_CODE[e],o=void 0;if(0<c.defendLevel){var n=U.Config.heroDefendConfig(c.config.subType);o=JSON.parse(n[c.defendLevel-1].skills)[e-1]}else o=l[i];if(o){var a=c.skillList.some(function(e){return e.code===o}),r="";a||(r=h[e]+"阶解锁");var s={code:o,unlock:a,unlockTips:r};d["skill_"+e].updateItem(s)}else d["skill_"+e].updateItem(),p=!0}}this.gp_skills.visible=!0;var h=JSON.parse(l.skillUnlock),p=!1,d=this;for(i=1;i<=5;i++)o(i);var n=U.Config.heroAndPetSectionConfig(this.isPet)[c.sectionLevel+1],a=n&&n.level||9999999,r=l.maxLevel;if(0<c.defendLevel){var s=U.Config.heroDefendConfig(c.config.subType);0<s.length&&(r=s[c.defendLevel-1].maxLevel)}var u=Math.min(a,r);this.lb_level.text=c.level+"/"+u;var g=U.Config.heroAndPetUpgradeConfig(this.isPet)[c.level]||{},f=JSON.parse(g.costs);this.gp_cost.visible=!0,c.level==u?(this.gp_costs_icon.visible=!1,this.btn_maxLevel.visible=!0,this.btn_maxLevel.y=200,this.btn_up.visible=!0,c.level==a?(this.btn_up.label="升阶",this.btn_up.skinName="skins.ButtonSkinYellow"):U.Config.heroAndPetUpstarConfig()[c.code]?(this.btn_up.label="升级",this.btn_up.skinName="skins.ButtonSkinGreen"):(this.btn_maxLevel.y=235,this.btn_up.visible=!1)):(this.gp_costs_icon.visible=!0,this.btn_maxLevel.visible=!1,this.gp_costs_icon.removeChildren(),f.forEach(function(e){t.gp_costs_icon.addChild(new customui.CommonIconWithNum({code:e[1],num:e[2],style:CommonIconStyle.RIGHT,showEnough:!0}))}),this.btn_up.visible=!0,this.btn_up.label="升级",this.btn_up.skinName="skins.ButtonSkinGreen"),this.resource_bar.updateBar({costs:f,width:170,gap:70})},V.prototype.updateHeroThing=function(){var f=this;this.gp_heroThing.visible=!0;var _=this.heroThingProxy.getHeroEquips(this.curUuid),m=this.heroThingProxy.getHeroArtifactByHeroUuid(this.curUuid),y=this.heroThingProxy.getHeroTreasuresByUuid(this.curUuid),v=this.heroThingProxy.getHeroImmortalByUuid(this.curUuid),T=[];this.heroThingItems.forEach(function(e,t){for(var i=!1,o=0,n=_;o<n.length;o++){var a=n[o];if(e.entityType==EEntityType.EEntityTypeHeroEquip&&a.type==e.type){T.push(t),e.update({hero:f.heroProxy.allHeroByUuid[f.curUuid],vo:a}),i=!0;break}}if(!i)for(var r=0,s=m;r<s.length;r++){var c=s[r];if(e.entityType==EEntityType.EEntityTypeHeroArtifact&&c.type==e.type){i=!0,T.push(t),e.update({hero:f.heroProxy.allHeroByUuid[f.curUuid],vo:c});break}}if(!i)for(var l=0,h=y;l<h.length;l++){var p=h[l];if(e.entityType==EEntityType.EEntityTypeTreasure&&p.type==e.type){i=!0,T.push(t),e.update({hero:f.heroProxy.allHeroByUuid[f.curUuid],vo:p});break}}if(!i)for(var d=0,u=v;d<u.length;d++){var g=u[d];if(e.entityType==EEntityType.EEntityTypeImmortal&&g.type==e.type){i=!0,T.push(t),e.update({hero:f.heroProxy.allHeroByUuid[f.curUuid],vo:g});break}}}),this.heroThingItems.forEach(function(e,t){T.indexOf(t)<0&&e.update({hero:f.heroProxy.allHeroByUuid[f.curUuid]})});var e=this.heroThingProxy.getHeroEquips(this.curUuid);if(UIActionManager.setGrey(this.btn_master,!1),4==e.length){var t=U.Config.getHeroEquipConfig(),i=0;for(var o in e){var n=t[e[o].code];n&&n.color<7&&(i=1)}i&&UIActionManager.setGrey(this.btn_master,!0)}else UIActionManager.setGrey(this.btn_master,!0)},V.prototype.updateHeroUpstar=function(){var t=this;this.gp_up.visible=!0,this.gp_upstar.visible=!0;var e=U.Config.heroAndPetUpstarConfig(this.isPet),i=this.curInfo,o=i.config,n=i.starLevel,a=e[i.code];this.heroProxy.checkUpstarNotice(i)?(UIActionManager.setAbsGrey(this.btn_upstar,!1),this.btn_upstar.enabled=!0):UIActionManager.setAbsGrey(this.btn_upstar,!0),this.gp_upstar_stars.removeChildren();var r=U.GeneralConfig.getHeroStarInfo(n);if(r.stage<4)for(var s=0;s<r.num;s++){var c=new eui.Image(r.src);this.gp_upstar_stars.addChild(c),c.scaleX=c.scaleY=.5}else this.gp_upstar_stars.addChild(new customui.HighStarLevelIcon({num:r.num,scale:.5}));if(a){this.gp_upstar_stars.addChild(new eui.Image("yingxion_img_xiaojiantou_png"));var l=U.GeneralConfig.getHeroStarInfo(n+1);if(l.stage<4)for(s=0;s<l.num;s++)c=new eui.Image(l.src),this.gp_upstar_stars.addChild(c),c.scaleX=c.scaleY=.5;else this.gp_upstar_stars.addChild(new customui.HighStarLevelIcon({num:l.num,scale:.5}))}this.gp_skills.visible=!1,this.gp_skills_2.visible=!1;var h=U.Config.allHeroConfig(this.isPet);if(n<10){var p=h[a.nextCode];this.gp_skills_2.visible=!0,this.gp_skills_2.removeChildren();var d=o[SKILL_CODE[a.upSkill]],u=p[SKILL_CODE[a.upSkill]],g=new customui.SkillItem({code:d});this.bindSkillPanelClick({target:g,x:34,bottom:170}),this.gp_skills_2.addChild(g);var f=new eui.Image("yingxion_img_xiaojiantou_png");f.scaleX=f.scaleY=1.8,this.gp_skills_2.addChild(f);var _=new customui.SkillItem({code:u});this.bindSkillPanelClick({target:_,x:34,bottom:170}),this.gp_skills_2.addChild(_),g.scaleX=g.scaleY=_.scaleX=_.scaleY=.8}else{this.gp_skills.visible=!0;var m=void 0;if(a){for(var y=a;e[y.nextCode];)y=e[y.nextCode];m=h[y.nextCode]}else m=h[this.curInfo.code];for(s=1;s<=5;s++){var v=this["skill_"+s],T=m["talent"+s],C=void 0;T&&(C={code:T,unlock:9+s<n,light:n==9+s}),v.updateItem(C)}}if(a)this.gp_upstar_attrInfo.scaleY=1,this.blb_upstar_desc.text=a.attrShow+"%",this.lb_upstar_level_1.text="等级上限提升至：",this.blb_upstar_level.text=""+h[a.nextCode].maxLevel;else{this.gp_upstar_attrInfo.scaleY=0;var E=""+h[i.code].maxLevel;0<i.defendLevel&&(E=U.Config.heroDefendConfig(i.config.subType)[i.defendLevel-1].maxLevel),this.lb_upstar_level_1.text="等级上限：",this.blb_upstar_level.text=E}if(a){if(this.gp_defend_text.visible=!1,this.gp_upstar_notMax.visible=!0,this.gp_cost.visible=!0,this.lb_upstar_limitation.visible=!1,this.gp_costs_icon.visible=!1,U.AppFacade.getInstance().retrieveProxy(U.PlayerPy.N).playerInfoVO.level<a.level)this.lb_upstar_limitation.visible=!0,this.lb_upstar_limitation.text="需求队伍等级："+a.level;else if(""!=a.fiveSlotCosts){var I=JSON.parse(a.fiveSlotCosts);this.gp_costs_icon.visible=!0,this.gp_costs_icon.removeChildren(),I[1].forEach(function(e){t.gp_costs_icon.addChild(new customui.CommonIconWithNum({code:e[1],num:e[2],style:CommonIconStyle.RIGHT,showEnough:!0}))})}for(this.gp_chosenHero.removeChildren(),s=1;s<=4;s++)if(""!=a[this.conditionMap[s]]){this.upstarData[s]||(this.upstarData[s]={condition:a[this.conditionMap[s]],full:!1,uuids:[]}),C=this.upstarData[s];var b=new L({data:this.upstarData,slot:s,targetUuid:this.curUuid});this.gp_chosenHero.addChild(b)}var A=!0;for(var P in this.upstarData)if(!this.upstarData[P].full){A=!1;break}4!=o.initStar||A?this.btn_upstar.label="升星":this.btn_upstar.label="一键放入"}else this.gp_defend_text.visible=!0,this.gp_upstar_notMax.visible=!1,this.gp_cost.visible=!1;var M=[30000002,EPropertyType.EPropertyTypeGold];this.resource_bar.updateBar({costs:M,width:170,gap:70});var N=[this.gp_defend_effect_0,this.gp_defend_effect_1,this.gp_defend_effect_2,this.gp_defend_effect_3];for(var S in N)N[S].removeChildren();if(this.gp_defend_text.visible&&15==i.config.initStar){var k=U.Config.heroDefendConfig(i.config.subType);Utils.UnlockMgr.checkPass(MODULE.HeroDefend,!1).allow?0<k.length?(this.blb_title.text="神灵守护",this.gp_defend.visible=!0,this.updateDefend()):(this.blb_title.text="英雄升星",this.gp_defend.visible=!1,this.lb_upstar_max.text="已满星",this.lb_defend_level.text=""):(this.blb_title.text="英雄升星",this.gp_defend.visible=!1,0<k.length?(this.lb_upstar_max.text="神灵守护开启等级：",this.lb_defend_level.text=Utils.UnlockMgr.checkPass(MODULE.HeroDefend,!1).ext.requestLevel+"级"):(this.lb_upstar_max.text="已满星",this.lb_defend_level.text=""))}else this.blb_title.text="英雄升星",this.gp_defend.visible=!1,this.lb_upstar_max.text="已满星",this.lb_defend_level.text=""},V.prototype.updateDefend=function(){var e=[this.img_line_0,this.img_line_1,this.img_line_2],t=[this.img_defend_0,this.img_defend_1,this.img_defend_2,this.img_defend_3],i=[this.lb_defend_0,this.lb_defend_1,this.lb_defend_2,this.lb_defend_3],o=[this.gp_defend_effect_0,this.gp_defend_effect_1,this.gp_defend_effect_2,this.gp_defend_effect_3],n=["yingxion_icon_hunxing2_png","yingxion_icon_tianxing2_png","yingxion_icon_mingxing2_png","yingxion_icon_lingxing2_png"],a=["yingxion_icon_hunxing1_png","yingxion_icon_tianxing1_png","yingxion_icon_mingxing1_png","yingxion_icon_lingxing1_png"],r=this.curInfo,s=U.Config.heroDefendConfig(r.config.subType),c=r.defendLevel;for(var l in this.img_defend.source=c>=s.length?"yingxion_txt_yiquanbu_png":"yingxion_txt_dianji_png",o)o[l].removeChildren();for(var h=0;h<4;h++)h<3&&(e[h].source=h<c?"yingxion_img_xiantiao1_png":"yingxion_img_xiantiao2_png"),t[h].source=h<c?a[h]:n[h],i[h].text=s[h].name;c<4&&DragonBoneTools.create("common_xingling",function(e){for(var t in o)o[t].removeChildren();e.x=o[c].width/2,e.y=o[c].height/2,e.scaleX=e.scaleY=1,e.animation.play(),o[c].addChild(e)},this)},V.prototype.updateHeroResonate=function(){var i=this;this.gp_resonate.visible=!0;var e=this.curInfo.config.subType,t=this.curInfo.resonateLevelList[this.curInfo.resonateLevelList.length-1]||0,o=U.Config.heroResonateConfig(this.curInfo.config.subType,t),n=this.heroProxy.getHeroResonateOrders(this.curInfo),a=[];o.forEach(function(e){var t={uuid:i.curInfo.uuid,config:e,activated:!1};t.activated=0<=n.indexOf(e.order),a.push(t)}),a.sort(function(e,t){return e.config.order-t.config.order}),this.list_resonate.dataProvider=new eui.ArrayCollection(a),Utils.UnlockMgr.checkPass(MODULE.HeroAwaken,!1).allow&&10<=this.curInfo.config.initStar?(this.gp_resonate_unlock.visible=!0,this.list_resonate.layout.verticalGap=15,this.list_resonate.y=0,this.img_resonate_unlock.source=0===t?"jiban_img_weijuexing_png":"jiban_img_juexing"+t+"_png",this.blb_resonate_unlock.text=0<t?"羁绊"+NUM_TO_ROMAN_NUM[t]:"",this.btn_resonate_unlock.visible=this.curInfo.config.initStar>=U.Config.heroResonateLevelConfig(e,1).starLevel):(this.gp_resonate_unlock.visible=!1,this.list_resonate.layout.verticalGap=40,this.list_resonate.y=15)},V.prototype.updateHeroInfo=function(){if(this.lb_name.text=this.curInfo.config.name,this.img_race_icon.source=HeroRaceConfig[this.curInfo.config.race].raceIconBig,this.img_tier_icon.source=U.GeneralConfig.getHeroJingyingTag(this.curInfo.config.code),0!=this.curInfo.dermaCode){U.Config.getHeroDermaConfig()[this.curInfo.dermaCode].model,this.lb_name.text=U.Config.getHeroDermaConfig()[this.curInfo.dermaCode].name;var e=U.Config.getHeroDermaConfig()[this.curInfo.dermaCode];this.hero_model.update({code:this.curInfo.code,isPet:!1,derma:e})}else this.hero_model.update({code:this.curInfo.code,isPet:this.isPet});var t=U.GeneralConfig.getHeroStarInfo(this.curInfo.starLevel);if(this.gp_star.removeChildren(),t.stage<4)for(var i=0;i<t.num;i++)this.gp_star.addChild(new eui.Image(t.src));else this.gp_star.addChild(new customui.HighStarLevelIcon(t.num));this.btn_lock.icon=this.curInfo.isLocked?"common_btn_suoguan_png":"common_btn_suokai_png"},V.prototype.bindSkillPanelClick=function(t){var i=this,o=t.target;o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){if(o.data&&o.data.code)for(var e in i.skill_panel.visible=!0,i.skill_panel.updateItem({code:o.data.code,tips:o.data.unlockTips}),t)"target"!=e&&(i.skill_panel[e]=t[e])},this),o.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skill_panel.visible=!1},this),o.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skill_panel.visible=!1},this),o.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skill_panel.visible=!1},this)},V.prototype.upgradeLogic=function(){var r=this,e=this.heroProxy.allHeroByUuid[this.curUuid],t=U.AppFacade.getInstance().retrieveProxy(U.BackpackPy.N),i=U.Config.heroAndPetUpgradeConfig(this.isPet)[e.level],o=i&&JSON.parse(i.costs),n=e.config.maxLevel;if(0<e.defendLevel){var a=U.Config.heroDefendConfig(e.config.subType);0<a.length&&(n=a[e.defendLevel-1].maxLevel)}var s=U.Config.heroAndPetSectionConfig(this.isPet)[e.sectionLevel+1];s&&e.level==s.level?(this.timer&&egret.clearInterval(this.timer),U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.SECTION,{data:e,isPet:this.isPet})):e.level==n?Utils.MsgUtils.addMidMsg("已达到该星级最大等级"):this.heroProxy.waitingServOper.upgrade||(this.heroProxy.waitingServOper.upgrade=!0,this.isPet||(t.getInfoByCode(o[0][1]).haveNum<Number(o[0][2])&&t.getInfoByCode(o[1][1]).haveNum>Number(o[1][2])?(Utils.MsgUtils.addMidMsg("所需经验水晶不足"),this.heroProxy.waitingServOper.upgrade=!1,this.timer&&egret.clearInterval(this.timer)):t.getInfoByCode(o[1][1]).haveNum<Number(o[1][2])&&t.getInfoByCode(o[0][1]).haveNum>Number(o[0][2])?(Utils.MsgUtils.addMidMsg("所需金币不足"),this.heroProxy.waitingServOper.upgrade=!1,this.timer&&egret.clearInterval(this.timer)):t.getInfoByCode(o[1][1]).haveNum<Number(o[1][2])&&t.getInfoByCode(o[0][1]).haveNum<Number(o[0][2])?(Utils.MsgUtils.addMidMsg("所需资源不足"),this.heroProxy.waitingServOper.upgrade=!1,this.timer&&egret.clearInterval(this.timer)):this.heroProxy.HeroUpGrade({uuid:this.curUuid,num:1,cb:function(e,t){Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shengji),DragonBoneTools.playUniqueEffect({effectName:"common_shengji",parent:r.hero_model,y:r.hero_model.height}),DragonBoneTools.playUniqueEffect({effectName:"common_ty_dj",parent:r.gp_root,x:r.gp_root.width/2,y:r.gp_root.height/2});var i=new eui.Group,o=new eui.VerticalLayout;o.gap=3,i.layout=o;for(var n=1;n<=4;n++){var a=new eui.Label(AttrConfig[n].name+"+"+Math.floor(Number(U.GeneralConfig.getAttrValue(t[n]-e[n]))));a.textColor=12405786,a.size=24,i.addChild(a)}i.horizontalCenter=0,i.y=r.hero_model.height/2,r.hero_model.addChild(i),egret.Tween.get(i).wait(300).to({y:i.y-50,alpha:0},400).call(function(){i&&i.parent&&i.parent.removeChild(i)})}})))},V.prototype.addNotice=function(){this.heroInfo_tabbar.dataProvider.source.some(function(e){return e.type==o.HERO_INFO_TABBAR_TYPE.RESONATE})&&(NoticeManager.addNoticeListener(NT.HERO_RESONATE,this.heroInfo_tabbar,this,{percentX:695/720,percentY:285/404}),NoticeManager.addNoticeListener(NT.HERO_RESONATE_UNLOCK,this.btn_resonate_unlock.iconDisplay,this,BTN_ICON_NOTICE_POS)),this.resFullImg.right=-10,this.resFullImg.visible=!1,this.btn_derma&&this.btn_derma.addChild(this.resFullImg),NoticeManager.addNoticeListener(NT.HERO_DERMA,this.btn_derma.getChildAt(0),this,BTN_ICON_NOTICE_POS)},V.prototype.activateComponent=function(){var s=this;this.btn_up.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){Utils.UnlockMgr.checkPass(MODULE.HeroUpGradeAuto,!1).allow&&(this.timer=egret.setInterval(this.upgradeLogic,this,500)),this.upgradeLogic()},this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_END,function(){this.timer&&egret.clearInterval(this.timer)},this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){this.timer&&egret.clearInterval(this.timer)},this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){s.timer&&egret.clearInterval(s.timer)},this),this.btn_master.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.UnlockMgr.checkPass(MODULE.HeroEquipMaster).allow){var e=this.heroThingProxy.getHeroEquips(this.curUuid);if(4==e.length){var t=U.Config.getHeroEquipConfig(),i=0;for(var o in e){var n=t[e[o].code];n&&n.color<7&&(i=1)}i?Utils.MsgUtils.addMidMsg("当穿齐4件红色以上装备时激活"):U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.MASTER,{vo:e,heroUuid:this.curUuid})}else Utils.MsgUtils.addMidMsg("当穿齐4件红色以上装备时激活")}},this),this.btn_upstar.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var r=this,e=!0;for(var t in this.upstarData)if(!this.upstarData[t].full){e=!1;break}if(4!=this.curInfo.config.initStar||e){var i=this.curInfo,o=U.Config.heroAndPetUpstarConfig(this.isPet)[i.code];if(U.AppFacade.getInstance().retrieveProxy(U.PlayerPy.N).playerInfoVO.level<o.level)return void Utils.MsgUtils.addMidMsg("队伍等级不足");if(""!=o.fiveSlotCosts){var n=JSON.parse(o.fiveSlotCosts)[1];if(!U.AppFacade.getInstance().retrieveProxy(U.BackpackPy.N).checkEnough(n))return void Utils.MsgUtils.addMidMsg("道具不足")}if(e){var a=[];for(var t in this.upstarData)for(var s=0,c=this.upstarData[t].uuids;s<c.length;s++){var l=c[s];a.push({slotNum:Number(t),uuid:l})}this.isPet||(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shengxing),this.heroProxy.HeroUpStar({uuid:this.curUuid,uuidInfos:a,cb:function(e,t){DragonBoneTools.playOnce({effectName:"common_zhihuanchenggong",parent:r.hero_model,y:r.hero_model.height});var i=new eui.Group,o=new eui.VerticalLayout;o.gap=3,i.layout=o;for(var n=1;n<=4;n++){var a=new eui.Label(AttrConfig[n].name+"+"+Math.floor(Number(U.GeneralConfig.getAttrValue(t[n]-e[n]))));a.textColor=12405786,a.size=24,i.addChild(a)}i.horizontalCenter=0,i.y=r.hero_model.height/2,r.hero_model.addChild(i),egret.Tween.get(i).wait(300).to({y:i.y-50,alpha:0},400).call(function(){i&&i.parent&&i.parent.removeChild(i)})}}))}else Utils.MsgUtils.addMidMsg("条件不满足")}else this.heroProxy.checkUpstarNotice(this.curInfo,this.upstarData),this.updateView(),Utils.MsgUtils.addMidMsg("自动放入英雄")},this);for(var e=1;e<=5;e++){var t=this["skill_"+e];this.bindSkillPanelClick({target:t,x:34,bottom:e<4?200:132})}function i(t){o[t].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.curInfo.defendLevel;t<e?Utils.MsgUtils.addMidMsg("已激活"):t==e?U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_STAR_DEFEND,{info:this.curInfo,cb:this.updateDefendEffect.bind(this)}):e<t&&U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_STAR_DEFEND_ALL,{info:this.curInfo,chooseLevel:t+1,isAll:!1})},n)}this.btn_comment.visible=!Utils.SDKMgr.getPerformConfig(44),this.btn_comment.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.curInfo?U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_COMMENT,{info:s.curInfo}):Utils.MsgUtils.addMidMsg("还没有英雄")},this),this.btn_derma.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.UnlockMgr.checkPass(MODULE.HeroDerma,!0).allow){var e=s.heroThingProxy.AllDermaInfo,t=s.heroProxy.allHeroByUuid[s.curUuid];if(0!=t.dermaCode)U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_DERMA,{info:t.config,uuid:t.uuid,dermaCode:t.dermaCode,isCanPutOn:!1,isCanPutDown:!0,isCanActivate:!1,isShowAllBtn:!0,putCB:s.updateOneHeroInfo.bind(s),putData:t});else{var i=U.Config.getHeroDermaConfig(),o=!1;for(var n in i)i[n].subType==t.config.subType&&(o=!0);if(o){var a=!1;for(var n in e)e[n].config.subType==t.config.subType&&(a=!0);a?U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_DERMA,{info:t.config,uuid:t.uuid,dermaCode:t.dermaCode,isCanPutOn:!0,isCanPutDown:!1,isCanActivate:!1,isShowAllBtn:!0,putCB:s.updateOneHeroInfo.bind(s),putData:t}):U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_DERMA,{info:t.config,uuid:t.uuid,dermaCode:t.dermaCode,isCanPutOn:!1,isCanPutDown:!1,isCanActivate:!0,isShowAllBtn:!0,putCB:s.updateOneHeroInfo.bind(s),putData:t})}else{Utils.MsgUtils.addMidMsg("该英雄暂未拥有皮肤");var r=U.GameMVC.heroThingPy;U.AppFacade.getInstance().showSubView(U.FashionMediator.N,U.FashionMediator.SV.ALL_INFO,{module:MODULE.HeroDerma,allUuid:r.AllDermaInfo,bookConfig:U.Config.getHeroDermaHandbookConfig(),modelConfig:U.Config.getHeroDermaConfig()})}}}},this),this.hero_model.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hero_model.changeAction(customui.HeroDynamicModel.TOUCH_ACTION_LIST)},this),this.btn_details.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.ATTR_DETAIL,{info:this.curInfo})},this),this.btn_fenxiang.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=[[2,0,s.curInfo.config.code,EEntityType.EEntityTypeHero]];U.AppFacade.getInstance().retrieveProxy(U.MainPy.N).SendMessage(EChatChannelType.SameServer,"",0,function(){Utils.MsgUtils.addMidMsg("分享成功")},EChatSendCheckType.None,JSON.stringify(e))},this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){U.AppFacade.getInstance().hideSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_QUICK_TRAIN)},this),Utils.TouchUtils.addTouchListener(this.btn_halo,function(){s.heroProxy.showCurHeroHalo()}),this.btn_magic.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new U.MagicPutOnPanel({heroUuid:s.curUuid})})},this),Utils.ComponentUtils.registerListener(this.btn_resonate_attr,egret.TouchEvent.TOUCH_TAP,function(){U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.RESONATE_ATTR,{vo:s.curInfo})},this),Utils.ComponentUtils.registerListener(this.btn_resonate_unlock,egret.TouchEvent.TOUCH_TAP,function(){U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_PRACTICE,{vo:s.curInfo})},this),Utils.ComponentUtils.registerListener(this.btn_lock,egret.TouchEvent.TOUCH_TAP,function(){U.GameMVC.backpackPy.switchLock({lock:!s.curInfo.isLocked,type:EEntityType.EEntityTypeHero,uuid:s.curInfo.uuid,cb:function(){s.updateView()}})},this),this.btn_allDefend.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<this.curInfo.defendLevel?U.AppFacade.getInstance().showSubView(U.HeroMediator.N,U.HeroMediator.SV.HERO_STAR_DEFEND_ALLATTR,{info:this.curInfo}):Utils.MsgUtils.addMidMsg("未激活星灵")},this);var o=[this.gp_star_defend_0,this.gp_star_defend_1,this.gp_star_defend_2,this.gp_star_defend_3],n=this;for(e=0;e<4;e++)i(e);this.btn_lastOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(s.allUuids){var e=((s.allUuids.indexOf(s.curUuid)||s.allUuids.length)+s.allUuids.length-1)%s.allUuids.length;s.updateView({uuid:s.allUuids[e],upstarData:{}})}},this),this.btn_nextOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(s.allUuids){var e=(s.allUuids.indexOf(s.curUuid)+1)%s.allUuids.length;s.updateView({uuid:s.allUuids[e],upstarData:{}})}},this)},V.prototype.updateDefendEffect=function(){this.gp_defend_effect.removeChildren(),DragonBoneTools.playOnce({effectName:"common_shcg",parent:this.gp_defend_effect,x:this.gp_defend_effect.width/2,y:this.gp_defend_effect.height/2})},V.prototype.updateOneHeroInfo=function(e,t){var i=this.heroThingProxy.AllDermaInfo[t];if(""==t)this.hero_model.update({code:this.curInfo.code,isPet:!1}),this.lb_name.text=this.curInfo.config.name,this.curInfo.config.avatar;else{U.Config.getHeroDermaConfig()[i.code].model,this.lb_name.text=U.Config.getHeroDermaConfig()[i.code].name;var o=U.Config.getHeroDermaConfig()[i.code];this.hero_model.update({code:this.curInfo.code,isPet:!1,derma:o}),U.Config.getHeroDermaConfig()[i.code].avatar}var n=U.GeneralConfig.getHeroStarInfo(this.curInfo.starLevel);if(this.gp_star.removeChildren(),n.stage<4)for(var a=0;a<n.num;a++)this.gp_star.addChild(new eui.Image(n.src));else this.gp_star.addChild(new customui.HighStarLevelIcon(n.num))},V.prototype.updateMagicBtn=function(){if(Utils.UnlockMgr.checkPass(MODULE.MagicalPutOn,!1).allow){var e=U.GameMVC.magicalArtifactPy.allMagicalArtifactByUuid;for(var t in e){var i=e[t];if(i.heroUuid==this.curUuid){var o=parseInt(i.code)%100;return void(this.btn_magic.icon="icon_shenbing_"+(o<10?"0"+o:o)+"_png")}}this.btn_magic.icon="dzr_img_dikuang2_png"}else this.btn_magic.visible=!1},V.BTN_TYPEQUICK={pinglun:{icon:"_btn_lb_m_json.common_icon_liaotian",text:"评论",id:"btn_comment"},fenxiang:{icon:"_btn_lb_m_json.common_icon_fenxiang",text:"分享",id:"btn_fenxiang"},derma:{icon:"_btn_lb_m_json.common_icon_pifu",text:"皮肤",id:"btn_derma"},halo:{icon:"_btn_lb_m_json.common_icon_guanghuan",text:"光环",id:"btn_halo"}},V.BTN_LEFT_TYPE={magical:{icon:"dzr_img_dikuang2_png",text:"神 器",id:"btn_magic"}},V);function V(){var e=B.call(this)||this;return e.initialized=!1,e.upstarData={},e.allUuids=[],e.index=0,e.resFullImg=new eui.Image("_main_m_json.maoxian_icon_man"),e.heroThingPos=[[-67,131],[67,7],[253,7],[382,131],[253,261],[67,261],[160,135]],e.conditionMap={1:"oneSlotCosts",2:"twoSlotCosts",3:"threeSlotCosts",4:"fourSlotCosts"},e.skinName="HeroQuickTrainViewSkin",e.heroProxy=U.AppFacade.getInstance().retrieveProxy(U.HeroPy.N),e.heroThingProxy=U.AppFacade.getInstance().retrieveProxy(U.HeroThingPy.N),e.heroThingItems=new Array,e}U.HeroQuickTrainView=D,__reflect(D.prototype,"game.HeroQuickTrainView");var H,G=(__extends(F,H=BasePanel),F.prototype.childrenCreated=function(){H.prototype.childrenCreated.call(this);var e=U.AppFacade.getInstance().retrieveProxy(U.HeroPy.N);if(this.params){var t=this.params.oldData,i=this.params.newData,o=!1,n=U.Config.allHeroConfig()[t.code],a=U.Config.allHeroConfig()[i.code];if("HeroUpSection"==this.params.type){this.img_title.source="yingxion_txt_yxsj_png";var r=0,s=0,c=0,l={};for(var h in t.skillList)l[t.skillList[h].code]=-1;for(var h in i.skillList){var p=i.skillList[h];-1==l[p.code]?l[p.code]=0:l[p.code]=1}if(82==a.subType){for(var d in l)if(-1==(g=l[d])&&r++,1==g){var u=Number(d);82==Math.floor(u/1e5)&&(s++,c=Number(d))}}else for(var d in l){var g;-1==(g=l[d])&&r++,1==g&&(s++,c=Number(d))}!r&&s&&c&&(this.bm_skill.text="解锁新技能",this.SkillItem.updateItem({code:c}),this.gp_skill.scaleX=this.gp_skill.scaleY=0,GameRootLayer.gameLayer().switchTouchEnable(!1),egret.Tween.get(this.gp_skill).wait(200).to({scaleX:1,scaleY:1},500).call(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this),o=!0)}else if("HeroUpStar"==this.params.type){this.img_title.source="yingxion_txt_yxsx_png",this.bm_skill.text="技能升级";var f=U.Config.heroAndPetUpstarConfig(),_=n.initStar,m=f[t.code];if(_<10){var y=n[SKILL_CODE[m.upSkill]],v=a[SKILL_CODE[m.upSkill]];y!=v&&(this.gp_skill.scaleX=this.gp_skill.scaleY=0,GameRootLayer.gameLayer().switchTouchEnable(!1),egret.Tween.get(this.gp_skill).wait(200).to({scaleX:1,scaleY:1},500).call(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this),this.SkillItem.updateItem({code:v}),o=!0)}}var T=e.getMaxLevelByCodeAndSection(t.code,t.sectionLevel),C=e.getMaxLevelByCodeAndSection(i.code,i.sectionLevel);this.gp0.getChildAt(1).text=T,this.gp0.getChildAt(3).text=C;for(var E=1;E<=4;E++)this["gp"+E].getChildAt(1).text=Math.floor(parseInt(U.GeneralConfig.getAttrValue(t.attr[E])))+"",this["gp"+E].getChildAt(3).text=Math.floor(parseInt(U.GeneralConfig.getAttrValue(i.attr[E])))+"";this.gp_skill.visible=o}},F.prototype.onDestroy=function(){H.prototype.onDestroy.call(this),U.AppFacade.getInstance().sendNotification(CN.ACTIVITY_SHOW_TRIGGER),U.AppFacade.getInstance().sendNotification(CN.SHOW_WECHAT_SHARE),egret.Tween.removeTweens(this.gp_skill)},F);function F(e){var t=H.call(this)||this;return t.skinName="HeroUpResultPanelSkin",Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_jinjie),t.params=e,t}U.HeroUpResultPanel=G,__reflect(G.prototype,"game.HeroUpResultPanel")}(game=game||{}),function(c){var i,e=(__extends(l,i=BaseMediator),l.prototype.initSubView=function(){this.addSubView(l.SV.MAIN,c.MagicalArtifactView),this.addSubView(l.SV.UP_SECTION_PANEL,c.MagicUpsectionPanel),this.addSubView(l.SV.MAGIC_COMMENT,c.MagicCommentView)},l.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.MAGICCOMMENT_UPDATE,CN.CONFIG_ALL_LOADED]},l.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.Magical,!1).allow&&this.proxy.GetMagicalInfo();break;case CN.MAGICCOMMENT_UPDATE:var i=this.getSubView(l.SV.MAGIC_COMMENT);i&&i.getPlayerTupMagic({params:t});break;case CN.CONFIG_ALL_LOADED:var o=c.Config.allMagicalConfig();for(var n in o){var a=o[n].code,r=c.Config.magicalSectionConfig(a),s=c.Config.magicalUpgradeConfig(a);s[0]&&NoticeManager.addCareCost(s[0].costs,function(){NoticeManager.updateNotice(NT.MAGICAL)}),s[1]&&NoticeManager.addCareCost(s[1].costs,function(){NoticeManager.updateNotice(NT.MAGICAL)}),r[1]&&NoticeManager.addCareCost(r[1].costs,function(){NoticeManager.updateNotice(NT.MAGICAL)})}}},l.N="MagicalArtifactMediator",l.SV={MAIN:1,UP_SECTION_PANEL:2,MAGIC_COMMENT:3},l);function l(e){void 0===e&&(e=null);var t=i.call(this,l.N,e)||this;return t.proxy=c.AppFacade.getInstance().retrieveProxy(c.MagicalArtifactPy.N),t}c.MagicalArtifactMediator=e,__reflect(e.prototype,"game.MagicalArtifactMediator")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.SmithyMainView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.Smithy,!1).allow&&this.proxy.GetSmithyInfo()}},n.N="SmithyMediator",n.SV={MAIN:1},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.SmithyPy.N),t}i.SmithyMediator=e,__reflect(e.prototype,"game.SmithyMediator")}(game=game||{}),function(o){var i,e=(__extends(n,i=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.TeamExpeView),this.addSubView(n.SV.DETAIL,o.TeamExpeditionChallengeView),this.addSubView(n.SV.JIJIE_CENTER,o.TeamExpeJiJieCenterPanel),this.addSubView(n.SV.JIJIE_MY_TEAM,o.TeamExpeJiJieMyTeamPanel)},n.prototype.initNotice=function(){NoticeManager.setChildType(NT.TEAM_EXPE_REWARD_ENTRANCE,[NT.TEAM_EXPE_REWARD,NT.TEAM_EXPE_APPLY_CENTER]),NoticeManager.setChildType(NT.TEAM_EXPE_APPLY_CENTER,[NT.TEAM_EXPE_APPLY_BTN])},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.TEAMEXPE_UPDATE_INFO,CN.TEAMEXPE_UPDATE_TEAM_INFO,CN.PLAYER_LEVEL_UP,CN.MAIN_COORDINATEINFO_UPDATE,CN.FIGHT_ALL_DONE_AND_EXIT,CN.TEAMEXPE_JUMP_TO_CHAPTER,CN.TEAMEXPE_UPDATE_MAP,CN.TEAMEXPE_OPEN_GATE,CN.UPDATE_APPLYRECORDS]},n.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:if(Utils.UnlockMgr.checkPass(MODULE.TeamExpedition,!1).allow){var i=o.AppFacade.getInstance().retrieveProxy(o.TeamExpePy.N);i.GetTeamExpeditionInfo(function(){i.amILeader()&&i.GetApplyRecord()})}break;case CN.TEAMEXPE_UPDATE_INFO:this.updateView(n.SV.MAIN);break;case CN.TEAMEXPE_UPDATE_TEAM_INFO:this.updateView(n.SV.JIJIE_CENTER),this.updateView(n.SV.JIJIE_MY_TEAM),this.getSubView(n.SV.MAIN)&&this.getSubView(n.SV.MAIN).updateTeamInfo(),o.AppFacade.getInstance().retrieveProxy(o.FriendPy.N).clearInviteHistory(MODULE.TeamExpedition);break;case CN.FIGHT_ALL_DONE_AND_EXIT:break;case CN.MAIN_COORDINATEINFO_UPDATE:if(!t||t.type!=MODULE.TeamExpedition)return;this.getSubView(n.SV.MAIN)&&this.getSubView(n.SV.MAIN).updateCoordInfo();break;case CN.TEAMEXPE_JUMP_TO_CHAPTER:this.getSubView(n.SV.MAIN)&&this.getSubView(n.SV.MAIN).jumpToChatper(t.chapter,t.isInit);break;case CN.TEAMEXPE_UPDATE_MAP:this.getSubView(n.SV.MAIN)&&this.getSubView(n.SV.MAIN).updateMap();break;case CN.TEAMEXPE_OPEN_GATE:this.getSubView(n.SV.MAIN)&&this.getSubView(n.SV.MAIN).openGate();break;case CN.UPDATE_APPLYRECORDS:Utils.UnlockMgr.checkPass(MODULE.TeamExpedition,!1).allow&&o.AppFacade.getInstance().retrieveProxy(o.TeamExpePy.N).updateApplyList(t.list)}},n.prototype.onViewCreate=function(){this.sendNotification(CN.CITY_SWITCH_DBCLOCKPAUSE,!0),this.sendNotification(CN.GUAJI_HIDE_ALL_SUBVIEW)},n.N="TeamExpeMediator",n.SV={MAIN:1,DETAIL:2,JIJIE_CENTER:3,JIJIE_MY_TEAM:4},n);function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.initNotice(),t}o.TeamExpeMediator=e,__reflect(e.prototype,"game.TeamExpeMediator")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.WorldBossMainView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.WORLD_BOSS_UPDATE_MAP]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:var t=Utils.UnlockMgr.getOpenInfo(MODULE.ServerBoss);t.isOpen&&t.allow&&this.proxy.GetServerBossInfo();break;case CN.WORLD_BOSS_UPDATE_MAP:this.getSubView(n.SV.MAIN)&&this.getSubView(n.SV.MAIN).updateCoordInfo()}},n.prototype.onViewCreate=function(){this.sendNotification(CN.CITY_SWITCH_DBCLOCKPAUSE,!0),this.sendNotification(CN.GUAJI_HIDE_ALL_SUBVIEW)},n.N="WorldBossMediator",n.SV={MAIN:1},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.WorldBossPy.N),t}i.WorldBossMediator=e,__reflect(e.prototype,"game.WorldBossMediator")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.WorldKingMainView),this.addSubView(n.SV.REWARD,i.WorldKingRewardPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.GENERAL_PASS_DAY]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GENERAL_PASS_DAY:case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.WorldKing,!1).allow&&this.proxy.GetWorldKingInfo()}},n.N="WorldKingMediator",n.SV={MAIN:1,REWARD:2},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.WorldKingPy.N),t}i.WorldKingMediator=e,__reflect(e.prototype,"game.WorldKingMediator")}(game=game||{});var ByteArrayMsg=function(){function e(){this._msgBuffer=new egret.ByteArray,this.callBackMap={},this.backpackProxy=game.AppFacade.getInstance().retrieveProxy(game.BackpackPy.N)}return e.prototype.receive=function(e){var t;this._msgBuffer.clear(),e.readBytes(this._msgBuffer);try{t=this.decode(this._msgBuffer)}catch(e){return void egret.log("协议解析失败",e)}if(t){var i=t.obj.toString(),o=t.ssid;if(i)if(0===new String(i).indexOf(".test."))t.obj.key=i.substr(1),game.AppFacade.getInstance().sendNotification("test.CommonR",t.obj),this.callBackMap[o]&&(this.callBackMap[o].call(this,t.obj),this.callBackMap[o]=void 0);else try{if(t&&t.obj&&t.obj.clientReward&&this.backpackProxy.handleClientRewardCore(t.obj.clientReward),t&&t.obj&&t.obj.clientCost&&this.backpackProxy.handleClientCostCore(t.obj.clientCost),0==o){var n=i.substr(1);game.AppFacade.getInstance().sendNotification(n,t.obj),game.AppFacade.getInstance().sendNotification(CN.GUIDE_NET_RESP,n)}else this.callBackMap[o]&&(this.callBackMap[o].call(this,t.obj),this.callBackMap[o]=void 0)}catch(e){egret.log("回调代码执行出错",e)}return t=void 0,0==this._msgBuffer.bytesAvailable&&this._msgBuffer.clear(),o}},e.prototype.send=function(r,s,c){return __awaiter(this,void 0,void 0,function(){var n,a=this;return __generator(this,function(e){switch(e.label){case 0:return(n=this.encode(s))?(void 0,[4,new Promise(function(t,i){var o=s.ssid;a.callBackMap[o]=function(e){game.AppFacade.getInstance().sendNotification(CN.GUIDE_NET_RESP,s.id1+"."+s.id2+"R"),e?e.err?(c||Utils.MsgUtils.addErrMsg(e.err),i(e)):t(e):egret.log("当前cb没有返回",o)},n.position=0,r.writeBytes(n,0,n.bytesAvailable),n.clear(),n=void 0})]):[3,2];case 1:return[2,e.sent()];case 2:return[2]}})})},e.prototype.decode=function(e){return egret.log("decode需要子类重写，根据项目的协议结构解析"),null},e.prototype.encode=function(e){return egret.log("encode需要子类重写，根据项目的协议结构解析"),null},e}();__reflect(ByteArrayMsg.prototype,"ByteArrayMsg",["BaseMsg"]),function(e){var t,i=(__extends(o,t=BaseMediator),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,e.MainRankPanel),this.addSubView(o.SV.COMMON,e.CommonRankAndRewardPanel),this.addSubView(o.SV.COMMON_RANK,e.CommonRankPanel),this.addSubView(o.SV.COMMON_REWARD,e.CommonRewardPanel),this.addSubView(o.SV.COMMON_MODEL,e.CommonRankModel)},o.prototype.hideAllContentPanel=function(){this.hideSubView(o.SV.COMMON_RANK),this.hideSubView(o.SV.COMMON_REWARD),this.hideSubView(o.SV.COMMON_MODEL)},o.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.RANK_OPEN_MAIN]},o.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.RANK_OPEN_MAIN:this.showSubView(o.SV.MAIN);break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView()}},o.N="RankMediator",o.SV={MAIN:1,COMMON:2,COMMON_RANK:3,COMMON_REWARD:4,COMMON_MODEL:5},o);function o(e){return void 0===e&&(e=null),t.call(this,o.N,e)||this}e.RankMediator=i,__reflect(i.prototype,"game.RankMediator")}(game=game||{});var _b,_c,_d,_e,_f,_g,_a,FIGHT_CONST={DEBUG_DRAW_FIGHT_MODEL_ORIGIN_POS:!1,DEBUG_GLOBAL_MEDIATOR:!0,SKILL_EFFECT_SCALE:1,SPEED_X1:1.2,SPEED_X2:1.7,ROUND_TO_SHOW_SKIP:7,CAMERA_FOCUS_SCALE:1.3,CAMERA_FOCUS_DURATION:300,CAMERA_FOCUS_EASE:egret.Ease.circOut,MODEL_APPEAR_FINAL:250,MODEL_DEAD_FINAL:250,POP_TIPS_FLY:250,TIPS_BG_FLY_IN:250,DEFAULT_ATTK_OX:100,DEFAULT_HEAD_OY:350,DEFAULT_HEAD_OX:0,ACT_FACE_2_FACE_FLY_T:120,ACT_SKILL_TYPE:{JINZHAN:1,FASHU:2,ZHIXIANG:3,LASHEN:4,QUANPING:5},FIGHT_POS:(_a={},_a[PositionType.Normal]=(_b={},_b[0]=[0,0,100],_b[EBattleSide.EBattleSideAttack]=[[0,-205,100],[-120,-350,1],[-120,-155,1],[-120,30,1],[-280,-70,1],[-280,-250,1],[-235,-425,1],[-235,140,1]],_b[EBattleSide.EBattleSideDefence]=[[0,-205,100],[120,-350,1],[120,-155,1],[120,30,1],[280,-70,1],[280,-250,1],[235,-425,1],[235,140,1]],_b),_a[PositionType.OneTwo]=(_c={},_c[0]=[0,0,100],_c[EBattleSide.EBattleSideAttack]=[[0,-205,100],[-120,-350,1],[-120,-155,1],[-120,30,1],[-280,-70,1],[-280,-250,1],[-235,-425,1],[-235,140,1]],_c[EBattleSide.EBattleSideDefence]=[[0,-205,100],[120,-205,1],[280,-25,5],[280,-285,2]],_c.BossScale=1.32,_c),_a[PositionType.TwoOne]=(_d={},_d[0]=[0,0,100],_d[EBattleSide.EBattleSideAttack]=[[0,-205,100],[-120,-350,1],[-120,-155,1],[-120,30,1],[-280,-70,1],[-280,-250,1],[-235,-425,1],[-235,140,1]],_d[EBattleSide.EBattleSideDefence]=[[0,-205,100],[120,-335,1],[120,-75,3],[280,-205,2]],_d.BossScale=1.32,_d),_a[PositionType.ZeroOne]=(_e={},_e[0]=[0,0,100],_e[EBattleSide.EBattleSideAttack]=[[0,-205,100],[-120,-350,1],[-120,-155,1],[-120,30,1],[-280,-70,1],[-280,-250,1],[-235,-425,1],[-235,140,1]],_e[EBattleSide.EBattleSideDefence]=[[0,-205,100],[200,-205,5]],_e.BossScale=1.32,_e),_a[PositionType.ZeroOneBig]=(_f={},_f[0]=[0,0,100],_f[EBattleSide.EBattleSideAttack]=[[0,-205,100],[-120,-350,1],[-120,-155,1],[-120,30,1],[-280,-70,1],[-280,-250,1],[-235,-425,1],[-235,140,1]],_f[EBattleSide.EBattleSideDefence]=[[0,-205,100],[200,-205,5]],_f.BossScale=1.43,_f),_a[PositionType.Chess8V8]=(_g={},_g[0]=[0,0,100],_g[EBattleSide.EBattleSideAttack]=[[0,-205,100],[-120,-345,1],[-120,-225,1],[-120,-65,3],[-225,90,6],[-280,-25,5],[-280,-165,2],[-280,-305,2],[-225,-400,0]],_g[EBattleSide.EBattleSideDefence]=[[0,-205,100],[120,-345,1],[120,-225,1],[120,-65,3],[225,90,6],[280,-25,5],[280,-165,2],[280,-305,2],[225,-400,0]],_g),_a),GUIDE_INNER_FIGHT:{a:{}}},TIP_COLOR=36807,HELP_CONST=((_a={})[MODULE.GuildCollect]={content:"<font>1.公会等级达到%s级可解锁战斗地铁玩法。</font>\n<font>2.玩家每通关一关可获得<font color= "+TIP_COLOR+">首破奖励</font>（有且只能获取一次），以及<font color= "+TIP_COLOR+">关卡奖励</font></font>。\n<font>3.关卡首次通关的玩家，会给其他通关的玩家增加BUFF，降低本关难度。\n</font>\n<font>4.当首通玩家退出公会时，以公会通关关卡最高的玩家作为首通玩家，显示在对应关卡上。</font>\n<font>5.每日上线可通过<font color = "+TIP_COLOR+">扫荡</font>直接获得已通关的关卡奖励。"},_a[MODULE.Champion]={content:"<font>1.永恒之塔战败会消耗一点<font color= "+TIP_COLOR+" >永恒之力</font>，胜利则不会消耗（当永恒之力为零时无法战斗）。</font>\n<font>2.<font color= "+TIP_COLOR+" >永恒之力</font>每<font color= "+TIP_COLOR+" >60</font>分钟自动恢复1点，上限为<font color= "+TIP_COLOR+" >10</font>点。</font>\n<font>3.永恒之塔的难度逐步递增，各个关卡有<font color= "+TIP_COLOR+" >丰厚的奖励</font>。</font>\n<font>4.永恒之塔排行榜会根据玩家的层数进行排名。"},_a[MODULE.DailyFortress]={content:"<font>1.日常副本分为<font color= "+TIP_COLOR+" >经验树窟</font>，<font color= "+TIP_COLOR+" >金币宝藏</font>，<font color= "+TIP_COLOR+" >升阶神像</font>，<font color= "+TIP_COLOR+" >英雄堡垒</font>，<font color= "+TIP_COLOR+" >强化古迹</font>，<font color= "+TIP_COLOR+" >神器法阵</font>六个系统，每个系统有相应的资源产出。</font>\n<font>2.每个系统每日有2点初始挑战次数，次数可通过<font color= "+TIP_COLOR+" >钻石购买</font>不同vip可购买次数不同）。</font>\n<font>3.玩家等级越高，可挑战更高难度的挑战，获得的奖励<font color= "+TIP_COLOR+" >越丰厚</font>。</font>\n<font>4.玩家<font color= "+TIP_COLOR+" >有概率</font>获得更多的奖励。"},_a[MODULE.Expedition]={content:"<font>1.玩家达到<font color= "+TIP_COLOR+" >30级</font>开启英雄远征的玩法。</font>\n<font>2.远征每日<font color= "+TIP_COLOR+" >0</font>点重置。</font>\n<font>3.英雄阵亡无法继续进行战斗。</font>\n<font>4.关卡数量为15关，关卡数量越高，所获奖励越丰厚。</font>\n<font>5.战斗胜利获得的远征币可在远征商店兑换所需的商品。"},_a[MODULE.TeamExpedition]={content:"<font>1、该玩法在开服<font color="+TIP_COLOR+">第15天</font>进入战区玩法系统。</font>\n<font>2、组队副本为多人玩法，玩家可以<font color="+TIP_COLOR+">自己组建队伍</font>或者<font color="+TIP_COLOR+">加入他人队伍。</font></font>\n<font>3、通关方式：单人通关或者组队通关，队伍只能挑战已解锁的关卡，以队伍所有成员<font color="+TIP_COLOR+">最低的解锁关卡为准。</font></font>\n<font>4、队长的权限包括踢出队员，转移队长，操作队伍，选择队伍出战顺序。队员<font color="+TIP_COLOR+">只允许观看。</font></font>\n<font>5、玩家每天拥有<font color="+TIP_COLOR+">两次</font>协助挑战次数，在该挑战次数内，队伍通关章节数高于其他队员的玩家可获得<font color="+TIP_COLOR+">协助奖励。</font></font>\n<font>6、每个关卡都设定有<font color="+TIP_COLOR+">全服首通奖励</font>，本服任意一支队伍（队伍中不能有其他服的玩家）通关关卡后，本服所有玩家都可在邮件中领取该关卡的<font color="+TIP_COLOR+">首通奖励。</font></font>"},_a[MODULE.Arena]={content:"<font>1、奖励分为两种奖励：<font color="+TIP_COLOR+">排名奖励</font>和<font color="+TIP_COLOR+">成就奖励</font>。排名奖励根据玩家排名，结算时发放对应的排名奖励。成就奖励根据<font color="+TIP_COLOR+">历史最高排名</font>，达成相应的排名条件发放对应的成就奖励（每种奖励仅发放一次）。</font>\n<font>2、单次竞技挑战消耗一次挑战次数，次数可通过钻石购买。</font>\n<font>3、竞技场战斗限定<font color="+TIP_COLOR+">15</font>回合，战斗超过15回合，进攻方判定为负。</font>\n<font>4、战斗记录中可以观看最近的战斗录像，查看<font color="+TIP_COLOR+">战斗记录。</font></font>"},_a[MODULE.TeamArena]={content:"<font>一、该玩法在开服<font color="+TIP_COLOR+">第15天</font>开启，并直接进入战区玩法。</font>\n<font>二、组队竞技：分为<font color="+TIP_COLOR+">单服组队竞技</font>和<font color="+TIP_COLOR+">战区组队竞技。</font></font>\n<font>三、报名规则：所在队伍报名满<font color="+TIP_COLOR+">2人及以上</font>，由队长进行报名参加。</font>\n<font>四、战斗方式</font>\n<font>1.单服组队竞技采用匹配赛，各队伍不重复进行对战，按照胜场排名，排名相同由所有对战的小分决定先后。</font>\n<font>2.战区组队竞技采用单服组队竞技决出<font color="+TIP_COLOR+">单服最强的两支队伍</font>进行晋级赛，并随机分成最多8个小组，每个小组内为4个队伍，进行匹配参加本小组赛事，决出前16支队伍参加后续赛事，以此类推直到决出冠军为止。若所参加的队伍数不足，或者尚未匹配到对应的对手时，为轮空，轮空者为胜方。</font>\n<font>五、战斗流程</font>\n<font>每周<font color="+TIP_COLOR+">单周日00：00~23：30</font>报名，赛事进行时间为6日，<font color="+TIP_COLOR+">每日0：00~20：30</font>调整阵容，<font color="+TIP_COLOR+">周一至周六晚20：30至21：00</font>进行战斗，周六<font color="+TIP_COLOR+">晚21：00</font>进行周结算，发放对应奖励。</font>\n<font>六、赛事投票</font>\n<font>在晋级赛事中，玩家在战区组队竞技中可消耗一定资源，对小组赛中的队伍进行投票，若所投票竞猜的对象在本轮竞技中夺冠，可获得高额投票奖励。</font>"},_a[MODULE.ServerBoss]={content:"<font>1、世界boss于<font color="+TIP_COLOR+">开服第3天</font>开启，在<font color="+TIP_COLOR+">开服第15天</font>进入战区玩法系统，敬请各位玩家共同挑战boss。</font>\n<font>2、活动开启为<font color="+TIP_COLOR+">周二、周四、周六的正午12：00-晚20：00整</font>，每日奖励根据该日的<font color="+TIP_COLOR+">伤害排名</font>系统自动发放。</font>\n<font>3、每名玩家每日拥有<font color="+TIP_COLOR+">5次</font>免费挑战boss的次数，挑战次数会在一定时间回复一次或者玩家可通过<font color="+TIP_COLOR+">钻石购买</font>该次数。玩家在挑战时有概率获得<font color="+TIP_COLOR+">幸运一击奖励</font>。每个boss只有<font color="+TIP_COLOR+">一份</font>幸运一击奖励。</font>\n<font>4、等级越高的boss能力越强。</font>"},_a[MODULE.StarDoor]={content:"<font>1、消耗<font color="+TIP_COLOR+">1张时空契约</font>，可进行一次指定阵营的召唤。</font>\n<font>2、时空之门有几率获得对应阵营的<font color="+TIP_COLOR+">4星以及5星英雄</font>，<font color="+TIP_COLOR+">4星以及5星随机碎片</font>。</font>\n<font>3、每次时空之门的契约召唤将额外产生一定数量的<font color="+TIP_COLOR+">时空粉尘</font>和<font color="+TIP_COLOR+">时空币</font>，时空粉尘可用于<font color="+TIP_COLOR+">英雄置换</font>，时空币可在时空商店里<font color="+TIP_COLOR+">兑换商品</font>。</font>\n<font>4、时空置换<font color="+TIP_COLOR+">只能</font>置换4星和5星英雄，且只能置换获得同阵营同星级英雄，<font color="+TIP_COLOR+">神魔种族英雄不可置换</font>。</font>\n<font>5、时空之门普通种族各星级英雄召唤概率：<font color="+TIP_COLOR+">4星英雄60%、5星碎片26.7%、5星英雄13.3%</font>。神魔种族：<font color="+TIP_COLOR+">4星碎片50%，4星16%，5星碎片25%，5星9%</font>。</font>"},_a[MODULE.GuildBoss]={content:"<font>1.公会boss为全公会会员可参与的boss挑战。</font>\n<font>2.公会boss的等级随着天数的增加逐渐递增，当前天数的boss击杀后，公会boss会重生且后续的boss击杀奖励会逐渐递减。</font>\n<font>3.每次战斗将给予各位所在公会的会员一定的奖励，并且当boss首次被击败后，发放全公会所在会员的首杀奖励，后续为非首杀奖励。"},_a[MODULE.GuildCopy]={content:"<font>1.在公会副本内，每位所在公会的会员在一定时间内拥有挑战次数，挑战次数用完，则无法<font color= "+TIP_COLOR+">继续挑战</font>。</font>\n<font>2.在boss被击杀过后，根据玩家对该boss的总伤害发放<font color= "+TIP_COLOR+">伤害排名</font>所对应的奖励。</font>\n<font>3.公会副本的次数<font color= "+TIP_COLOR+">零点重置</font>，重置后的可用次数为<font color= "+TIP_COLOR+">2</font>次。</font>\n<font>4.已击杀的boss<font color= "+TIP_COLOR+">不再</font>领取该boss的奖励。"},_a[MODULE.GuildWar]={content:"<font>1、该玩法在开服<font color="+TIP_COLOR+">第15天</font>开启并直接进入战区玩法系统。</font>\n<font>2、公会达到<font color= "+TIP_COLOR+">4级</font>后，该公会可参加公会战，并于<font color="+TIP_COLOR+">每双周</font>开启该玩法。</font>\n<font>3、玩家于<font color= "+TIP_COLOR+">周日00：00~23:30</font>报名，持续进行<font color= "+TIP_COLOR+">六天</font>均可报名参战，满足三人即可进入匹配阶段。</font>\n<font>4、每日<font color= "+TIP_COLOR+">晚00：00~20：30</font>调整，<font color= "+TIP_COLOR+">晚20：30至21：00</font>进行战斗，周六<font color= "+TIP_COLOR+">晚21：00</font>进行周结算，发放奖励。</font>"},_a[MODULE.Replacement]={content:"<font>1.消耗一张<font color= "+TIP_COLOR+">时光契约</font>，可进行一次指定阵营的召唤。</font>\n<font>2.时空之门有几率获得对应阵营的<font color= "+TIP_COLOR+">4星</font>以及<font color= "+TIP_COLOR+">5星英雄</font>，<font color= "+TIP_COLOR+">4星</font>以及<font color= "+TIP_COLOR+">5星随机碎片</font>。</font>\n<font>3.每次时空之门的契约召唤将额外产生一定数量的<font color= "+TIP_COLOR+">时空粉尘</font>和<font color= "+TIP_COLOR+">时空币</font<font color= "+TIP_COLOR+">时空粉尘</font>可用于<font color= "+TIP_COLOR+">英雄置换</font>，<font color= "+TIP_COLOR+">时空币</font>可在时空商店兑换商品。</font>\n<font>4.时空置换只能置换<font color= "+TIP_COLOR+">4星</font>和<font color= "+TIP_COLOR+">5星</font>英雄，且只能置换获得<font color= "+TIP_COLOR+">同阵营同星级英雄</font>。"},_a[MODULE.Decompose]={content:"<font>1.英雄祭坛可以可以获得<font color= "+TIP_COLOR+">经验水晶，升阶石，灵魂碎片</font>。</font>\n<font>2.<font color= "+TIP_COLOR+">经验水晶</font>：英雄的升级资源之一。</font>\n<font>3.<font color= "+TIP_COLOR+">升阶石</font>：英雄升阶资源之一。</font>\n<font>4.<font color= "+TIP_COLOR+">灵魂碎片</font>：英雄祭坛商店中的兑换货币，可兑换获得相应的英雄碎片。"},_a[MODULE.HeroGaCha]={content:"1、<font>普通召唤：消耗普通招募券，一定时间后，获得单次免费召唤。普通召唤各星级英雄召唤概率：1星<font color="+TIP_COLOR+">55%</font>、*2星<font color="+TIP_COLOR+">25%</font>、3星<font color="+TIP_COLOR+">17%</font>、4星<font color="+TIP_COLOR+">2.5%</font>、5星<font color="+TIP_COLOR+">0.5%</font>。</font>\n2、<font>高级召唤：玩家可通过钻石购买对应数量的金币，同时，系统将赠送玩家高级召唤的次数，或者凭借高级召唤券招募英雄。另外，在一定时间内，玩家可免费获得召唤次数。高级召唤各星级英雄召唤概率：3星<font color="+TIP_COLOR+">69.4%</font>、4星<font color="+TIP_COLOR+">25%</font>、5星<font color="+TIP_COLOR+">5.6%</font>。</font>\n3、<font>友情召唤：消耗友情点，友情点可在好友赠送里获得。友情召唤各星级英雄召唤概率：2星<font color="+TIP_COLOR+">50%</font>、3星<font color="+TIP_COLOR+">27.5%</font>、4星<font color="+TIP_COLOR+">20%</font>、5星<font color="+TIP_COLOR+">2.5%</font>。</font>"},_a[MODULE.Smithy]={content:"<font>1、铁匠铺打造装备的道具为<font color="+TIP_COLOR+">秘银</font>，有概率获得<font color="+TIP_COLOR+">稀有装备</font>以及其它的<font color="+TIP_COLOR+">普通道具</font>。</font>\n<font>2、熔炼值满时，可获得<font color="+TIP_COLOR+">秘银</font>，越高级的装备熔炼<font color="+TIP_COLOR+">所获得熔炼值越高</font>。</font>\n<font>3、玩家可通过<font color="+TIP_COLOR+">圣物还原石</font>将<font color="+TIP_COLOR+">橙色、红色，金色圣物</font>进行还原，还原将返还培养过程中<font color="+TIP_COLOR+">所有消耗的材料</font>。</font>\n<font>4、圣物还原返还形式：圣物经验直接返还<font color="+TIP_COLOR+">升级石</font>；洗练石根据该圣物<font color="+TIP_COLOR+">所有消耗的洗练石原数返还（非重铸消耗部分）</font>；红色圣物还原返还消耗的所有<font color="+TIP_COLOR+">同品质圣物</font>，其余低品质圣物以圣物形式返还；橙色圣物还原时，除了返还本体外，其余消耗的圣物会<font color="+TIP_COLOR+">按碎片的形式</font>返还。</font>\n<font>5、至宝可进行分解，分解后将返还该至宝<font color="+TIP_COLOR+">50%</font>的升阶材料，但铸炼材料将<font color="+TIP_COLOR+">不返还</font>。</font>\n<font>6、点击<font color="+TIP_COLOR+">预览按钮</font>可查看该至宝的分解返还材料详情，点击<font color="+TIP_COLOR+">筛选按钮</font>可按条件进行至宝筛选。</font>"},_a[MODULE.Challenge]={content:"<font>1、玩家可通过<font color="+TIP_COLOR+">命运之骰</font>进行游戏。</font>\n<font>2、遗迹探险分为普通地块，可产出<font color="+TIP_COLOR+">绿、蓝、紫圣物</font>；橙色宝箱，可产出<font color="+TIP_COLOR+">橙色圣物</font>；红色宝箱，可产出<font color="+TIP_COLOR+">红色圣物</font>。</font>\n<font>3、当再次回到起点后，可获得<font color="+TIP_COLOR+">英雄碎片*50</font>和<font color="+TIP_COLOR+">红色圣物碎片*10</font>。</font>"},_a[MODULE.HeroChallenge]={content:"<font>1.限时挑战结束后的<font color= "+TIP_COLOR+">一个星期</font>开启英雄挑战。</font>\n<font>2.英雄挑战分为3种模式，分别为<font color= "+TIP_COLOR+">1v1、3v3，以及6v6的模式</font>。</font>\n<font>3.开启英雄挑战后，随机从对应的模式中<font color= "+TIP_COLOR+">抽取一种</font>作为本周挑战的模式。</font>\n<font>4.模式确定后，只能选择对应的上阵数量的英雄进行挑战。</font>\n<font>5.英雄挑战全部通关后，等待下一周重新开始，进度重置。</font>\n<font>6.兑换商店<font color= "+TIP_COLOR+">每挑战5层</font>胜利后，可触发进行购买商品。"},_a[MODULE.WorldKing]={content:"<font>1、排位赛在<font color="+TIP_COLOR+">开服第三天</font>且玩家自身达到<font color="+TIP_COLOR+">70级</font>后开启，该玩法在开服<font color="+TIP_COLOR+">第15天</font>进入战区玩法系统。</font>\n<font>2、奖励分为三种奖励：<font color="+TIP_COLOR+">周排行奖励</font>、<font color="+TIP_COLOR+">日挑战宝箱奖励</font>、<font color="+TIP_COLOR+">周成就奖励</font>。根据最终的排名，发放周排行奖励；每日挑战达到指定次数，可领取对应的挑战次数宝箱奖励；在赛季内达到某段位，可领取周成就奖励。</font> \n<font>3、每天拥有<font color="+TIP_COLOR+">5次</font>初始挑战次数，额外的次数可用钻石购买，上限为<font color="+TIP_COLOR+">20次</font>。</font> \n<font>4、系统自动优先匹配段位相近的玩家，获胜增加积分，失败扣除积分，积分满足条件则<font color="+TIP_COLOR+">增加一星</font>，反之<font color="+TIP_COLOR+">减去一星</font> 。</font> \n<font>5、战斗记录中可查看最近的战斗录像，查看战斗记录。</font>"},_a[MODULE.Activity+EActivityType.NewYearChallenge]={content:"<font>1.新春挑战每日12:00~13:00开启</font>\n<font>2.每次放鞭炮可对BOSS造成固定伤害并获得随机奖励</font>\n<font>3.击杀BOSS的玩家可以额外获得击杀奖励</font>\n<font>4.每天本服首个BOSS被击杀后，全服可获得红包奖励</font>\n<font>5.新春挑战开启期间，BOSS被击杀后会重新刷新</font>"},_a[MODULE.HeroRollback]={content:"<font>1、英雄到达<font color= "+TIP_COLOR+">11星及11星以上</font>时，可进行重生。</font>\n<font>2、重生需要消耗<font color= "+TIP_COLOR+">英雄重生石</font>，每次进行重生消耗的英雄重生石<font color= "+TIP_COLOR+">数量相同</font>，均为<font color= "+TIP_COLOR+">1个</font>。</font>\n<font>3、重生后，不仅返还该英雄所消耗的<font color= "+TIP_COLOR+">所有本体</font>（包含英雄自己），还包括所有的<font color= "+TIP_COLOR+">培养道具</font>，诸如经验水晶、升阶石，觉醒石、宝石等道具；<font color= "+TIP_COLOR+">所有穿戴的装备、圣物</font>；<font color= "+TIP_COLOR+">所有升星过程中消耗的狗粮材料</font>。</font>\n<font>4、返还升星材料英雄（狗粮）形式：通过<font color= "+TIP_COLOR+">9星和10星通用狗粮</font>的形式进行返还，该通用狗粮不能作为上阵英雄，初次获得<font color= "+TIP_COLOR+">可激活该狗粮的头像</font>。</font>"},_a[MODULE.AbyssLair]={content:"<font>1、玩家可挑战不同章节的怪物，根据<font color="+TIP_COLOR+">胜利队伍数量</font>，决定当前关卡的星级，并获得该<font color="+TIP_COLOR+">星级奖励</font>。</font>\n<font>2、玩家通过设置三队阵容进行挑战，可<font color="+TIP_COLOR+">自由选择英雄上阵</font>和<font color="+TIP_COLOR+">决定各队出战顺序</font>。</font>\n<font>3、当通过某章节后，玩家可获得该章节的<font color="+TIP_COLOR+">通关奖励</font>。</font>"},_a[MODULE.ActivityNewBrave]={content:"<font>1.<font color= "+TIP_COLOR+">勇士令状</font>。</font>\n"},_a[MODULE.Activity+EActivityType.ZoneAuction]={content:"<font>1、活动期间，战区竞拍<font color= "+TIP_COLOR+">每日重置</font>。所有道具，于正午12点整开启。</font>\n<font>2、拍卖分为<font color= "+TIP_COLOR+">一口价</font>和<font color= "+TIP_COLOR+">竞拍</font>。竞拍后，若倒计时内无他人出价，则道具归属该竞拍者，一口价则直接购买该道具。</font>\n<font>3、每名玩家于每日仅限购买一次<font color= "+TIP_COLOR+">同种稀有道具</font>（红色栏内道具）。</font>\n"},_a[MODULE.Activity+EActivityType.OneChoice]={content:"<font>1、活动期间玩家可以向三位女性英雄祈福，并获得该英雄。</font>\n<font>2、活动期间，祈福<font color= "+TIP_COLOR+">仅限一次</font>。</font>\n"},_a[MODULE.Wchess]={content:"<font>1、命运战棋为<font color= "+TIP_COLOR+">六名</font>玩家共同参与。</font>\n<font>2、每名英雄的星级为<font color= "+TIP_COLOR+">一星、二星、三星</font>，3位同名同星级英雄可合成更高星级英雄（魔族只需要两名英雄）。</font>\n<font>3、每回合金币收入：胜利金币收入+回合基础金币收入+利息金币（每10金币收获1金币，上限为8金币）+连胜/连败收入（1、3、5金币）。</font>\n<font>4、游戏内，每<font color= "+TIP_COLOR+">10金币</font>增加升级经验，经验满时，则扩充一上阵英雄格（英雄格数上限为8格），越高的等级更容易获得<font color= "+TIP_COLOR+">高费英雄</font>。</font>\n<font>5、各英雄可组合成各类光环，光环对相应的英雄有<font color= "+TIP_COLOR+">属性加成</font>。</font>\n<font>6、每名玩家上限为100血，血量为零则结束游戏，根据不同的排名增加/扣除相应的积分，随之段位升级/降级，好友组队不计算排名积分以及相应的成就点数。</font>\n<font>7、赛季时间为<font color= "+TIP_COLOR+">一个月</font>，赛季结束后结算奖励。<font>"},_a[MODULE.ActivityProfessionSuit]={content:"<font>1、活动期间，玩家可在上方装备栏放入<font color= "+TIP_COLOR+">金装</font>，可升级成为<font color= "+TIP_COLOR+">金装职业套装装备</font>。</font>\n<font>2、金装职业套装分为<font color= "+TIP_COLOR+">4套装备</font>，对应：战士套装，游侠套装，法师套装，牧师套装。</font>\n<font>3、职业套装不仅有<font color= "+TIP_COLOR+">基础属性</font>的提升，同时对于穿戴该套装相应职业的英雄，有特别的<font color= "+TIP_COLOR+">属性获得</font>。</font>"},_a[MODULE.Activity+EActivityType.HuntTreasure]={content:"<font>1、活动期间，玩家可通过钻石抽取幸运夺宝奖池中的道具。</font>\n<font>2、道具获得概率：</font>\n<font>英魂币x30  <font color= "+TIP_COLOR+">1.5%</font>\n<font>五星精英碎片x50  <font color= "+TIP_COLOR+">2%</font>\n<font>金色圣物碎片x10  <font color= "+TIP_COLOR+">3%</font>\n<font>命运之骰x1  <font color= "+TIP_COLOR+">8%</font>\n<font>秘银x1  <font color= "+TIP_COLOR+">8%</font>\n<font>宝石x20  <font color= "+TIP_COLOR+">8.5%</font>\n<font>高级招募券x3  <font color= "+TIP_COLOR+">8.5%</font>\n<font>时空契约x1  <font color= "+TIP_COLOR+">8.5%</font>\n<font>圣物升级石x100  <font color= "+TIP_COLOR+">13%</font>\n<font>强化石x200  <font color= "+TIP_COLOR+">13%</font>\n<font>附魔石x5  <font color= "+TIP_COLOR+">13%</font>\n<font>神器原石x200  <font color= "+TIP_COLOR+">13%</font>"},_a[MODULE.Demon]={content:"<font>1、玩家可通过挖宝，概率搜到宝藏守卫，宝藏守卫出现后，玩家和好友<font color="+TIP_COLOR+">均可以挑战</font>。</font>\n<font>2、宝藏守卫出现后，在一定时间后会逃跑，所以玩家需要在<font color="+TIP_COLOR+">规定时间</font>内击杀该宝藏守卫获得丰厚奖励。</font>\n<font>3、每天玩家拥有<font color="+TIP_COLOR+">一定挑战次数体力</font>，每次挑战均有<font color="+TIP_COLOR+">挑战奖励</font>，当宝藏守卫被击杀后，发现者获得<font color="+TIP_COLOR+">归属奖励</font>（邮件发送），击杀者获得<font color="+TIP_COLOR+">击杀奖励</font>。</font>"},_a[MODULE.Vestage]={content:"<font>1.命运幻境每天拥有<font color="+TIP_COLOR+">2次</font>挑战次数；开始前，玩家需要从己方拥有的英雄中挑选<font color="+TIP_COLOR+">6名</font>英雄挑战幻境。</font>\n<font>2.幻境一共为<font color="+TIP_COLOR+">3章</font>，通过每章的最终BOSS，可进入下一章幻境。</font>\n<font>3.命运幻境中存在各种奇遇事件，主要包含 不明、商人、宝箱、营地、敌人、精英、头目等（详细查看图例）。</font>\n<font>4.每次战斗或者事件中英雄所剩余的血量都会<font color="+TIP_COLOR+">保存</font>，已阵亡的英雄<font color="+TIP_COLOR+">无法再参与战斗</font>，玩家可以在游戏过程中获得复活药和生命药，进行<font color="+TIP_COLOR+">复活</font>已阵亡的英雄/<font color="+TIP_COLOR+">恢复</font>英雄的血量。</font>\n<font>5.游戏过程中获得的英雄、遗物（buff），只在<font color="+TIP_COLOR+">本系统中生效</font>。</font>\n<font>6.玩家在本系统中所获得英雄<font color="+TIP_COLOR+">全部阵亡</font>后，本轮幻境结束，需要重新开始挑战。</font>\n<font>7.挑战每章最终BOSS后，打败头目，即可获得<font color="+TIP_COLOR+">丰厚的奖励</font>哦。</font>\n<font>8.达到<font color="+TIP_COLOR+">vip4</font>后，玩家可开启战斗跳过。</font>"},_a[MODULE.Manor]={content:"<font>矿脉争夺战于<font color="+TIP_COLOR+">开服第八天</font>开启，在<font color="+TIP_COLOR+">开服15天</font>时，进入战区玩法系统</font>\n<font>开启时间：<font color="+TIP_COLOR+">每周一、周三、周五的晚20：05至20：25</font>开启。</font>\n<font>基础规则</font>\n<font>1、玩家可以在矿区地图<font color="+TIP_COLOR+">寻找矿点占领</font>，每个玩家可以控制3个队伍分别占领矿点，在占领矿点会获得不同的积分和矿场货币，3个队伍<font color="+TIP_COLOR+">各自独立行动。</font>。矿点<font color="+TIP_COLOR+">品级越高产量就越高</font>，可以容纳的队伍就越多。</font>\n<font>2、当矿点采集队伍已满时，需要<font color="+TIP_COLOR+">挑战矿点中的其他玩家的队伍</font>腾出空位迁入矿中，玩家每次挑战<font color="+TIP_COLOR+">会根据玩家战斗力差距强制扣除一定体力</font>，另外在挑战中每阵亡一个英雄会额外扣除6点体力。</font>\n<font>3、玩家只有在安全区才能编辑队伍的阵容，不在安全区的队伍编辑的内容不会保存，更换前后排除外。</font>\n<font>占领矿点</font>\n<font>1、挑战其他的玩家会获得积分，占领矿点也会获得积分和矿场货币</font>\n<font>2、<font color="+TIP_COLOR+">第一个</font>进入矿中的公会视为<font color="+TIP_COLOR+">占领了矿点</font>，一旦一个公会占领了矿其余公会玩家进入<font color="+TIP_COLOR+">不影响占领权</font>。其他公会想要占领这个矿，需要把当前占领公会成员的队伍<font color="+TIP_COLOR+">全部打回安全区</font>。当占领公会成员被清除出矿点后，归属权会转移到矿点中<font color="+TIP_COLOR+">队伍数量最多的公会</font>，队伍数量相同时会随机转移。</font>\n<font>3、占领了矿点的公会，其<font color="+TIP_COLOR+">公会成员</font>在矿中会获得<font color="+TIP_COLOR+">25%的产量加成</font>，若矿中没有其他公会成员，则还会获得<font color="+TIP_COLOR+">30%额外的独占产量加成</font>。</font>"},_a[MODULE.LuckyTurntable]={content:"<font>1、每转1次可获得奖池中的随机一次奖励，<font color="+TIP_COLOR+">已获得的奖励</font>从奖池中消失</font>\n<font>2、玩家可以手动刷新奖池，在刷新后<font color="+TIP_COLOR+">24小时</font>将自动刷新</font>\n<font>3、免费刷新使用后，<font color="+TIP_COLOR+">3小时</font>将重新获得一次免费刷新次数</font>\n<font>4、道具获得概率:</font>\n<font>指定英雄碎片:<font color="+TIP_COLOR+">1%</font></font>\n<font>圣物/圣物碎片:<font color="+TIP_COLOR+">2%</font></font>\n<font>五星英雄碎片/五星精英碎片:<font color="+TIP_COLOR+">3%</font></font>\n<font>高级招募券/时空契约/命运之骰/秘银:<font color="+TIP_COLOR+">14%</font></font>\n<font>高级招募券/时空契约/命运之骰/秘银:<font color="+TIP_COLOR+">14%</font></font>\n<font>附魔石/宝石/强化石/经验水晶/金币/进阶石:<font color="+TIP_COLOR+">22%</font></font>\n<font>附魔石/宝石/强化石/经验水晶/金币/进阶石:<font color="+TIP_COLOR+">22%</font></font>\n<font>附魔石/宝石/强化石/经验水晶/金币/进阶石:<font color="+TIP_COLOR+">22%</font></font>\n"},_a[MODULE.Activity+EActivityType.NewZoneGroupPurchase]={content:"<font>1、团购玩法为<font color="+TIP_COLOR+">跨服玩法</font>，团购中提供多种优惠道具。</font>\n<font>2、道具售出价格为当前折扣乘以道具原价格，当购买人数越多，则<font color="+TIP_COLOR+">优惠力度越大</font>，在活动结束后，按最终折扣价计算已买道具价格，并按<font color="+TIP_COLOR+">差额钻石数量以邮件方式返还给玩家</font>，无需担心先买吃亏的问题。</font>\n<font>3、每种道具有<font color="+TIP_COLOR+">一定的次数限制</font>，当购买次数使用尽后，无法再购买该类道具。</font>"},_a[MODULE.Activity+EActivityType.NewTurntable]={content:"<font>1、活动期间，玩家可通过登陆，邀请好友、首次充值等获取途径方式获得该转盘次数，抽取以下道具：</font>\n<font>橙色圣物碎片*50：<font color="+TIP_COLOR+">7%</font></font>\n<font>300钻石：<font color="+TIP_COLOR+">15%</font></font>\n<font>500钻石：<font color="+TIP_COLOR+">10%</font></font>\n<font>五星英雄碎片*50：<font color="+TIP_COLOR+">8%</font></font>\n<font>高级召唤券*5：<font color="+TIP_COLOR+">15%</font></font>\n<font>时空契约*2：<font color="+TIP_COLOR+">15%</font></font>\n<font>秘银*2：<font color="+TIP_COLOR+">15%</font></font>\n<font>命运之骰：<font color="+TIP_COLOR+">15%</font></font>\n<font>2、参与了该转盘活动的玩家，即可获得参与抽取实物奖品的机会，每天会在凌晨零点公布获奖名单，奖品包括了精美的<font color="+TIP_COLOR+">耳机</font>、<font color="+TIP_COLOR+">游戏机</font>、<font color="+TIP_COLOR+">智能手环</font>等奖品，请中奖的幸运玩家注意查收系统邮件，等待客服联系您提供相关的个人信息，我们会在活动结束后对实物奖励进行发放。\n</font>"},_a[MODULE.Activity+EActivityType.WishTree]={content:""},_a[MODULE.Activity+EActivityType.EverydayTurntable]={content:"<font>1、每日一赚可通过<font color="+TIP_COLOR+">当日登录</font>和<font color="+TIP_COLOR+">每日充值任意金额</font>获得转盘机会。</font>\n<font>2、转动转盘，每次获得奖励后，奖池不变。</font>\n<font>3、转盘每日更新，更新后转盘次数<font color="+TIP_COLOR+">不重置</font>，可累加。</font>\n<font>各个道具概率如下：</font>\n<font>时空契约*1：<font color="+TIP_COLOR+">15%</font></font>\n<font>高级召唤券*3：<font color="+TIP_COLOR+">15%</font></font>\n<font>经验水晶*3M：<font color="+TIP_COLOR+">15%</font></font>\n<font>金币*3M：<font color="+TIP_COLOR+">15%</font></font>\n<font>五星英雄碎片*50：<font color="+TIP_COLOR+">10%</font></font>\n<font>橙色圣物碎片*50：<font color="+TIP_COLOR+">10%</font></font>\n<font>洗练石*20：<font color="+TIP_COLOR+">10%</font></font>\n<font>钻石*500：<font color="+TIP_COLOR+">10%</font></font>"},_a[MODULE.Activity+EActivityType.ZoneFishing]={content:"<font>1、秘境垂钓共有三类道具：</font>\n<font><font color="+TIP_COLOR+">鱼竿</font>：分为三种品质，每种品质的鱼竿影响鱼的获得速度。</font>\n<font><font color="+TIP_COLOR+">鱼料</font>：分为三种品质，每种品质的鱼料影响所钓鱼的整体品质。</font>\n<font><font color="+TIP_COLOR+">鱼桶</font>：分为三种品质，每种品质的鱼桶装取鱼的容量不同（鱼桶收获的鱼满时将不再捕鱼，在收获之后，才可重新开始捕鱼），且越高品质的鱼桶越不容易被抢夺。</font>\n<font>2、钓鱼分为两种玩法：</font>\n<font><font color="+TIP_COLOR+">钓鱼模式</font>：所钓的鱼可进入捕鱼达人进行换取道具，同时，根据所收获鱼的积分进行排名，获得排名奖励。</font>\n<font><font color="+TIP_COLOR+">抢夺模式</font>：玩家可抢夺他人的鱼，概率性获得他人鱼桶里的各类鱼，并获得积分，另外，在记录里玩家可对他人进行复仇，进行抢夺。</font>"},_a[MODULE.StormWar]={content:"<font>1.风暴战场于<font color="+TIP_COLOR+">开服第八天</font>开启，15天进入战区玩法系统。</font>\n<font>2.活动开启后，每周二、周四、周六的<font color="+TIP_COLOR+">晚20:05~20:25</font>可进入风暴战场。</font>\n<font>3.风暴战场分为<font color="+TIP_COLOR+">8层</font>，层数越高，<font color="+TIP_COLOR+">每60秒</font>挂机产出的奖励越好。</font>\n<font>4.击败对手/怪物时，可晋级下一层；挑战失败（攻守）时，则掉落一层。</font>\n<font>5.击败对手/怪物时，可获得积分，层数越高积分越多，连胜场次越高，挑战获得的积分越多。</font>\n<font>6.连胜机制只针对玩家，和怪物无关，即怪物<font color="+TIP_COLOR+">不影响</font>连胜或中断连胜，以及连胜的积分产出。</font>\n<font>7.积分达到对应的目标时，可在成就中领取对应的奖励。</font>\n<font>8.<font color="+TIP_COLOR+">第一个</font>达到第8层的玩家为本轮风暴战场的冠军，每过<font color="+TIP_COLOR+">60秒</font>时，冠军可获得额外的挂机产出收益；冠军被击败时，胜利一方可成为新的冠军。</font>"},_a[MODULE.RiskMulti]={content:"<font>1.每名到达<font color="+TIP_COLOR+">%s级</font>的玩家可邀请其它满足条件的玩家或者进入他人组队进行组队挂机。</font>\n<font>2.当且仅当两人及以上时，该组队挂机加成方可生效（人数越多，整体挂机收益越大），组队挂机期间，个人挂机产出受到增益。</font></font>\n<font>3.玩家仅能邀请比自己低于XX级的玩家进行组队挂机，且根据等级进行挂机排序，在组队中，级数越大的玩家，所获得的挂机加成收益越大。</font>\n<font>4.在其他组队的玩家，在<font color="+TIP_COLOR+">%s小时后</font>，将自动退出该组队。</font>"},_a[MODULE.TribeBattle]={content:"<font>1.角色等级达到<font color="+TIP_COLOR+">60级</font>，开服<font color="+TIP_COLOR+">第3天</font>可开启部落争霸玩法。</font>\n<font>2.开启时间为<font color="+TIP_COLOR+"> 周一、三、五的12：00~20：00。</font></font>\n<font>3.<font color="+TIP_COLOR+">开服第14天</font>后，部落争霸玩法加入战区。</font>\n<font>4.活动开启后，玩家会在所在公会累计积累积分，积分用于个人排行和公会排行，最后根据积分进行发放奖励。</font>\n<font>5.活动开启期间，玩家可通过消耗挑战次数进行挑战其他公会的成员抢夺积分。</font>\n<font>6.玩家可根据复仇中查看仇人，从而进行复仇，消耗复仇次数。</font>\n<font>7.活动期间退出公会后，旧公会的总积分不变，个人积分不变；新加入公会后，自身拥有的积分不累计新公会上，新累计和抢夺部分方可累计到新公会。</font>\n<font>8.活动结束后，根据<font color="+TIP_COLOR+">个人积分</font>和<font color="+TIP_COLOR+">公会积分排名</font>，进行发放奖励（邮件方式发放）。</font>"},_a[MODULE.HeroSpirit]={content:"<font>1、英魂往事分为多个章节，到达相应的<font color="+TIP_COLOR+">等级</font>和满足<font color="+TIP_COLOR+">前一章的激活页数</font>，则可以开启新的章节。</font>\n<font>2、英魂往事中各个章节激活的能力属性将作用于<font color="+TIP_COLOR+">上阵英雄</font>，提升上阵英雄的属性能力。</font>\n<font>3、英魂单独于英雄，所获得的英魂将收录在<font color="+TIP_COLOR+">英魂往事的背包</font>中，不在其它地方显示。</font>\n<font>4、英魂可在<font color="+TIP_COLOR+">矿脉争夺战</font>的商店购买获取，满足条件后可<font color="+TIP_COLOR+">激活</font>英魂往事的属性加成。</font>"},_a[MODULE.PeakWar]={content:"<font>1、巅峰竞技场在开服15天且玩家达到70级时开启，该玩法分为<font color="+TIP_COLOR+">挑战赛</font>和<font color="+TIP_COLOR+">天梯赛</font>。</font>\n<font>2、挑战赛：<font color="+TIP_COLOR+">周一至周五每日全天</font>和<font color="+TIP_COLOR+">周六的凌晨0点至晚10点</font>为挑战赛开启时间段，在此期间可挑战玩家获取相应积分，并可以领取当前挑战赛期间的<font color="+TIP_COLOR+">挑战胜利次数奖励</font>。结算时<font color="+TIP_COLOR+">根据积分</font>排名获取奖励，并且<font color="+TIP_COLOR+">前100名</font>的玩家将<font color="+TIP_COLOR+">进入天梯赛</font>。</font>\n<font>3、天梯赛：周日<font color="+TIP_COLOR+">晚20：05-晚20：25</font>开启，挑战赛结算时前100名为天梯赛初始排名。获得资格的选手可挑战其它玩家，挑战胜利则与该挑战玩家<font color="+TIP_COLOR+">互换排名</font>，若失败则排名不变。天梯赛结束后，将发放排名奖励。</font>"},_a);!function(a){var i,e=(__extends(t,i=BasePanel),t.prototype.onDestroy=function(){this.params.doneCB&&this.params.doneCB()},t.prototype.childrenCreated=function(){var e=this;if(i.prototype.childrenCreated.call(this),this.params&&this.config){switch(this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem),this.decorateCommonInfo(),this.params.type){case EEntityType.EEntityTypeVestageItem:this.decorateVestageItem();break;default:this.decorateItem()}this.btn_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.callBackLeft&&e.callBackLeft()},this),this.btn_right.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.callBackRight&&e.callBackRight()},this),this.gp_baseitem.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.callBackBaseitem&&e.callBackBaseitem()},this),this.makeAccess(),this.params.showAccessNow&&this.switchGpAccessVisible(),this.updateHeight()}},t.prototype.decorateCommonInfo=function(){this.lb_name.text=this.config.name,this.lb_desc.text=this.config.desc,"令状等级"==this.config.name&&(this.lb_num.visible=!1),this.params.info&&this.params.info.uuid?this.baseItem.updateData({uuid:this.params.info.uuid,type:this.params.type}):this.baseItem.updateData(this.params);var e=this.backpackProxy.getInfoByCode(this.params.code);this.lb_num.text="数量 "+e.haveNum,this.lb_name.textColor=COLOR_2_FONT_COLOR[this.config.color]||16777215,this.updateHeight(),this.updateExpireTime()},t.prototype.updateExpireTime=function(){if(this.params.expiredDay)this.lb_dt.visible=!0,this.lb_dt.text="有效期："+this.params.expiredDay+"天";else if(this.params.source==BASEITEM_SOURCE.BACKPACK&&this.params.expiredDt){this.lb_dt.visible=!0;var e=this.params.expiredDt-Utils.TimerManager.getServerTime(),t=Math.ceil(e/86400);this.lb_dt.text="有效期："+(1<t?t:"今")+"天"}else this.lb_dt.visible=!1},t.prototype.updateHeight=function(){this.validateNow(),this.gp_access.visible?this.gp_main.height=this.gp_detail.height+this.gp_access.height:this.gp_main.height=this.gp_detail.height},t.prototype.decorateVestageItem=function(){var e=this;this.params.source==BASEITEM_SOURCE.BACKPACK?(this.btn_left.label="丢弃",this.btn_right.label="使用",this.callBackRight=function(){e.config.type,a.GameMVC.dungeonPy.UseItem({code:e.params.code,cb:function(){e.hide()}})},this.callBackLeft=function(){a.GameMVC.dungeonPy.DiscardItem({code:e.params.code,cb:function(){e.hide()}})}):this.gp_btn.parent.removeChild(this.gp_btn),this.gp_limit.height=0,this.gp_limit.visible=!1},t.prototype.decorateItem=function(){var i=this;if(this.params.source==BASEITEM_SOURCE.BACKPACK)switch(this.config.useType){case 1:this.btn_right.label="使用",this.callBackRight=function(){PopUpManager.addPopUp({obj:new a.UsePropPanel({code:i.params.code})}),i.hide()};break;case 2:this.btn_right.label="合成",this.callBackRight=function(){var e=i.config.effectEx,t=i.backpackProxy.getItemNumByCode(i.params.code);t<e?Utils.MsgUtils.addMidMsg("所需碎片不足"):(i.hide(),1<Math.floor(t/e)?PopUpManager.addPopUp({obj:new a.CompoundPanel({code:i.params.code})}):a.AppFacade.getInstance().retrieveProxy(a.BackpackPy.N).compound({code:i.params.code,num:1}))};break;case 4:this.btn_right.label="使用",this.callBackRight=function(){i.config.effectEx!=MODULE.ActivityBraveBaoZang||a.GameMVC.activityPy.isOpen(EActivityType.NewBraveBook)?a.MainJumpConfig.jumpTo(i.config.effectEx):PopUpManager.addPopUp({obj:new a.UsePropPanel({code:i.params.code})}),i.hide()};break;default:if(0==this.config.useType&&1==this.config.isSellable)break;this.btn_right.parent.removeChild(this.btn_right),this.btn_left.horizontalCenter=0}else this.btn_right.parent.removeChild(this.btn_right),this.btn_left.horizontalCenter=0;if(this.btn_left.label="获取",this.callBackLeft=function(){i.switchGpAccessVisible()},0==this.config.useType&&1==this.config.isSellable&&(this.btn_right.label="出售",this.btn_left.label="获取",this.callBackRight=function(){a.AppFacade.getInstance().retrieveMediator(a.ShopyMediator.N).showSubView(a.ShopyMediator.SV.SHOP_SELL_NUM,{shopConfig:{name:i.config.name,info:i.config},maxCount:i.backpackProxy.getInfoByCode(i.params.code).haveNum}),i.hide()}),2==this.config.useType&&this.config.effect){var e=JSON.parse(this.config.effect);if(1==e.length){var t=e[0]&&e[0][1],o=e[0]&&e[0][0];o!=EEntityType.EEntityTypeHero&&o!=EEntityType.EEntityTypePet||(this.img_tier_icon.source=a.GeneralConfig.getHeroJingyingTag(t),this.callBackBaseitem=function(){a.AppFacade.getInstance().showSubView(a.HeroMediator.N,a.HeroMediator.SV.HERO_DETAIL,{code:t}),i.hide()})}}if(this.config.moduleId){var n=Utils.UnlockMgr.checkPass(this.config.moduleId,!1);this.lb_limit.text=(!n.allow&&n.ext.tips||"").replace("解锁","可使用")}""==this.lb_limit.text?(this.gp_limit.height=0,this.gp_limit.visible=!1):(this.gp_btn.height=0,this.gp_btn.visible=!1)},t.prototype.makeAccess=function(){var e=this,t=a.Config.getMainWayConfigByIdAndEntityType(this.config.id||this.config.code,this.params.type);if(0<t.length)for(var i=0,o=t;i<o.length;i++){var n=o[i];this.gp_ways.addChild(new r({wayCode:n,callBack:function(){e.opperationParams=1,e.hide(),PopUpManager.onDarkClick()}}))}else this.gp_ways.addChild(new r(void 0));this.gp_access.visible=!1},t.prototype.switchGpAccessVisible=function(){this.gp_access.visible=!this.gp_access.visible,""==this.lb_limit.text?(this.gp_limit.height=0,this.gp_limit.visible=!1,this.gp_btn.height=70,this.gp_btn.visible=!0):(this.gp_limit.height=70,this.gp_limit.visible=!1,this.gp_btn.height=0,this.gp_btn.visible=!1),this.updateHeight()},t);function t(e){var t=i.call(this)||this;return t.skinName="BaseItemDetailViewSkin",t.params=e,t.backpackProxy=a.AppFacade.getInstance().retrieveProxy(a.BackpackPy.N),t.config=a.GeneralConfig.getEntityConfigByCode(t.params.type,t.params.code),t.params&&t.params.uuid&&(t.params.info=t.backpackProxy.getInfoByUuidAndType(t.params.uuid,t.params.type)),t}a.BaseItemDetailView=e,__reflect(e.prototype,"game.BaseItemDetailView");var o,r=(o=eui.Component,__extends(n,o),n.prototype.childrenCreated=function(){var e=this;if(o.prototype.childrenCreated.call(this),this.params&&this.params.wayCode){var t=a.Config.wayConfig()[this.params.wayCode];this.lb_desc.text=t.desc,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.moduleId&&a.MainJumpConfig.jumpTo(t.moduleId),e.params.callBack&&e.params.callBack()},this)}else this.lb_desc.text="暂无获取途径",this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.MsgUtils.addMidMsg("暂无获取途径")},this)},n);function n(e){var t=o.call(this)||this;return t.jumpMode=void 0,t.skinName="CommonAccessItemSkin",t.params=e,t}a.CommonAccessItem=r,__reflect(r.prototype,"game.CommonAccessItem",["eui.UIComponent","egret.DisplayObject"])}(game=game||{}),function(e){var t=(i.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.BaseItemForChess",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},i);function i(){}e.BaseItemForChessFactory=t,__reflect(t.prototype,"customui.BaseItemForChessFactory");var o,n=(o=eui.Component,__extends(a,o),a.prototype.resetFixedStyle=function(){this.isHave=!1,this.code=this.config=this.vo=void 0,this.decorateStar(1),this.gp_star_hero.removeChildren(),this.decorateIcon(""),this.decorateColorFrame(0),this.img_bg.source="_border_m_json.common_img_jichuwupingkuang",this.img_frame.parent.getChildIndex(this.img_frame)<this.img_icon.parent.getChildIndex(this.img_icon)&&this.img_frame.parent.swapChildren(this.img_frame,this.img_icon),this.decorateTypeIcon(""),this.decorateProfessionIcon(""),this.gp_effect.removeChildren()},a.prototype.updateData=function(e){this.vo=e.vo,this.code=e.code,this.isHave=!0,this.code||(this.code=this.vo.code),this.decorateHero(e)},a.prototype.decorateIcon=function(e){this.img_icon.source=e},a.prototype.decorateTypeIcon=function(e){this.img_type.visible=!0,this.img_type.source=e},a.prototype.decorateProfessionIcon=function(e){this.img_profession.visible=!0,this.img_profession.source=e},a.prototype.decorateEffect=function(e,t){DragonBoneTools.create("common_yingxiongtouxiangkuang",function(e){e.x=this.sl_effect.width/2,e.y=this.sl_effect.height/2,e.animation.play("common_yingxiongtouxiangkuang",0),this.gp_effect.addChild(e)},this)},a.prototype.decorateColorFrame=function(e){var t="";t=0==e?"_border_m_json.common_img_pinzhikuang_0":"_border_m_json.common_img_pinzhibian_"+(e+1),this.img_frame.scaleX=this.img_frame.scaleY=1.02,this.img_frame.source=t},a.prototype.decorateStar=function(e,t){if(this.gp_star_hero.visible=!1,this.gp_star_item.visible=!1,this.gp_star_hero2.visible=!1,!t){var i={src:"_border_m_json.common_icon_xingji",stage:1,num:e};if(i.stage<4){this.gp_star_hero.visible=!0,this.gp_star_hero.removeChildren(),this.gp_star_hero.layout.gap=-2*i.stage-3;for(var o=0;o<i.num;o++){var n=new eui.Image(i.src);n.scaleX=n.scaleY=.4,this.gp_star_hero.addChild(n)}}else this.gp_star_hero2.visible=!0,this.blb_star_hero2.text=i.num.toString()}},a.prototype.decorateHero=function(e){this.config=game.Config.chessHero()[this.code];var t=e&&e.noStar;this.decorateStar(this.config.initStar,t),this.decorateIcon(ResourceUtils.png(this.config.avatar)),this.decorateColorFrame(this.config.color),this.img_bg.source="_border_m_json.common_img_jichuwupingkuang",this.img_frame.parent.getChildIndex(this.img_frame)<this.img_icon.parent.getChildIndex(this.img_icon)&&this.img_frame.parent.swapChildren(this.img_frame,this.img_icon),this.config&&this.config.race&&this.decorateTypeIcon(HeroRaceConfig[this.config.race].raceIcon),this.decorateProfessionIcon(SubProfessionConfig[this.config.subProfession].icon)},a.prototype.reset=function(){this.x=this.y=0,this.touchEnabled=!0,this.visible=!0,this.scaleX=this.scaleY=1,this.horizontalCenter=this.verticalCenter=void 0,UIActionManager.setGrey(this,!1),this.img_type.source="",this.img_type2.source="",this.img_profession.source="",this.blb_level.text="",this.blb_num.text="",this.blb_num.visible=!0,this.img_type.visible=!0,this.gp_star_hero.visible=!0,this.code=void 0,this.img_frame.parent.setChildIndex(this.img_frame,0),this.img_frame.source="",this.img_frame.scaleX=this.img_frame.scaleY=1.08,this.img_icon.source="",this.img_icon.visible=!0,this.img_icon.width=this.img_icon.height=86,this.img_bg.source="_border_m_json.common_img_jichuwupingkuang2",this.gp_effect.removeChildren()},a.prototype.playEffect=function(e){DragonBoneTools.playOnce({effectName:e,parent:this.gp_main,x:this.gp_main.width/2,y:this.gp_main.height/2,scaleX:1,scaleY:1,keep:!1,loop:!1,doneCB:function(){}})},a.prototype.onOPReset=function(){this.reset()},a.prototype.onOPComeBack=function(e,t){e&&this.updateData(e)},a.prototype.onOPClean=function(){},a.prototype.onOPCheck=function(e){egret.log("alive")},a);function a(){var e=o.call(this)||this;return e.isHave=!1,e.skinName="BaseItemSkin",e}e.BaseItemForChess=n,__reflect(n.prototype,"customui.BaseItemForChess",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(customui=customui||{}),function(e){var t,i=(t=puremvc.Facade,__extends(o,t),o.getInstance=function(){return null==this.instance&&(this.instance=new o),this.instance},o.prototype.initializeController=function(){t.prototype.initializeController.call(this),this.registerCommand(o.STARTUP,e.StartupCommand),this.registerCommand(o.RESTART,e.RestartCommand)},o.prototype.startUp=function(e){this.sendNotification(o.STARTUP,e),this.removeCommand(o.STARTUP)},o.prototype.showSubView=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i={}),this.retrieveMediator(e).showSubView(t,i)},o.prototype.hideSubView=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i={}),this.retrieveMediator(e).hideSubView(t,i)},o.prototype.updateView=function(e,t,i){void 0===t&&(t=0),void 0===i&&(i={}),this.retrieveMediator(e).updateView(t,i)},o.STARTUP="startup",o.RESTART="restart",o);function o(){return t.call(this,"core")||this}e.AppFacade=i,__reflect(i.prototype,"game.AppFacade",["puremvc.IFacade","puremvc.INotifier"])}(game=game||{}),function(t){var e,i=(e=puremvc.SimpleCommand,__extends(o,e),o.prototype.execute=function(e){t.MainProcessor.registerAll(),t.BackpackProcessor.registerAll(),t.MailProcessor.registerAll(),t.FightProcessor.registerAll(),t.FriendProcessor.registerAll(),t.TaskAllProcessor.registerAll(),t.ActivityProcessor.registerAll(),t.PlayerProcessor.registerAll(),t.ShopProcessor.registerAll(),t.RankProcessor.registerAll(),t.GuajiProcessor.registerAll(),t.GuildProcessor.registerAll(),t.GuildFarmProcessor.registerAll(),t.HeroProcessor.registerAll(),t.HeroThingProcessor.registerAll(),t.ArenaProcessor.registerAll(),t.ManorProcessor.registerAll(),t.StormWarProcessor.registerAll(),t.WorldKingProcessor.registerAll(),t.TitleProcessor.registerAll(),t.BattleZoneArenaProcessor.registerAll(),t.TeamExpeProcessor.registerAll(),t.TeamBossProcessor.registerAll(),t.TeamPlayEntranceProcessor.registerAll(),t.ChampionProcessor.registerAll(),t.CopyEntranceProcessor.registerAll(),t.PvpEntranceProcessor.registerAll(),t.PetProcessor.registerAll(),t.WorldBossProcessor.registerAll(),t.GuildCollectProcessor.registerAll(),t.GuildBossProcessor.registerAll(),t.HeroChallengeProcessor.registerAll(),t.HeroChallenge2Processor.registerAll(),t.GuildSkillProcessor.registerAll(),t.GuildWarProcessor.registerAll(),t.GuildInstanceProcessor.registerAll(),t.MagicalProcessor.registerAll(),t.HeroSpiritProcessor.registerAll(),t.ZzqProcessor.registerAll(),t.LuckyTableProcessor.registerAll(),t.DungeonProcessor.registerAll(),t.TribeBattleProcessor.registerAll(),t.PeakWarProcessor.registerAll(),t.HeroMutiTeamProcess.registerAll(),t.StockProcessor.registerAll(),t.ImmortalProcessor.registerAll(),t.HoldemProcessor.registerAll(),t.HeroAltarProcessor.registerAll(),t.GloryArenaProcessor.registerAll(),t.RaceTowerProcessor.registerAll()},o);function o(){return e.call(this)||this}t.ControllerPrepCommand=i,__reflect(i.prototype,"game.ControllerPrepCommand",["puremvc.ICommand","puremvc.INotifier"])}(game=game||{}),function(){function e(){}(game||(game={})).GameMVC=e,__reflect(e.prototype,"game.GameMVC")}(),function(i){var e,t=(e=puremvc.SimpleCommand,__extends(o,e),o.prototype.execute=function(e){this.registerProxyAs(i.PlayerPy,"playerPy"),this.registerProxyAs(i.LoginPy,"loginPy"),this.registerProxyAs(i.MailPy,"mailPy"),this.registerProxyAs(i.FriendPy,"friendPy"),this.registerProxyAs(i.FightPy,"fightPy"),this.registerProxyAs(i.HeroPy,"heroPy"),this.registerProxyAs(i.PetPy,"petPy"),this.registerProxyAs(i.MagicalArtifactPy,"magicalArtifactPy"),this.registerProxyAs(i.HeroSpiritPy,"heroSpiritPy"),this.registerProxyAs(i.HeroThingPy,"heroThingPy"),this.registerProxyAs(i.GuajiPy,"guajiPy"),this.registerProxyAs(i.CopyEntrancePy,"copyEntrancePy"),this.registerProxyAs(i.PvpEntrancePy,"pvpEntrancePy"),this.registerProxyAs(i.MainPy,"mainPy"),this.registerProxyAs(i.ShopPy,"shopPy"),this.registerProxyAs(i.RechargePy,"rechargePy"),this.registerProxyAs(i.RankPy,"rankPy"),this.registerProxyAs(i.TaskPy,"taskPy"),this.registerProxyAs(i.ActivityPy,"activityPy"),this.registerProxyAs(i.GuildPy,"guildPy"),this.registerProxyAs(i.GuildFarmPy,"guildFarmPy"),this.registerProxyAs(i.BackpackPy,"backpackPy"),this.registerProxyAs(i.ArenaPy,"arenaPy"),this.registerProxyAs(i.ManorProxy,"manorPy"),this.registerProxyAs(i.StormWarProxy,"stormWarPy"),this.registerProxyAs(i.WorldKingPy,"worldKingPy"),this.registerProxyAs(i.BattleZoneArenaPy,"battleZoneArenaPy"),this.registerProxyAs(i.TeamExpePy,"teamExpePy"),this.registerProxyAs(i.TeamBossPy,"teamBossPy"),this.registerProxyAs(i.TeamPlayEntrancePy,"teamEntrancePy"),this.registerProxyAs(i.ChampionPy,"championPy"),this.registerProxyAs(i.WorldBossPy,"worldBossPy"),this.registerProxyAs(i.ZoneBossPy,"zoneBossProxy"),this.registerProxyAs(i.HeroChallengePy,"heroChallengePy"),this.registerProxyAs(i.HeroChallenge2Py,"heroChallenge2Py"),this.registerProxyAs(i.GuildCollectPy,"guildCollectPy"),this.registerProxyAs(i.GuildBossPy,"guildBossPy"),this.registerProxyAs(i.GuildWarPy,"guildWarPy"),this.registerProxyAs(i.GuildInstancePy,"guildInstancePy"),this.registerProxyAs(i.TouchGoldHandPy,"touchGoldHandPy"),this.registerProxyAs(i.SmithyPy,"smithyPy"),this.registerProxyAs(i.TitlePy,"titlePy"),this.registerProxyAs(i.ZzqPy,"zzqPy"),this.registerProxyAs(i.LuckyTablePy,"luckyTablePy"),this.registerProxyAs(i.DeepNestPy,"DeepNestPy"),this.registerProxyAs(i.DungeonPy,"dungeonPy"),this.registerProxyAs(i.TribeBattlePy,"tribeBattlePy"),this.registerProxyAs(i.PeakWarPy,"peakWarPy"),this.registerProxyAs(i.FashionPy,"fashionPy"),this.registerProxyAs(i.MountPy,"mountPy"),this.registerProxyAs(i.HeroMutiTeamPy,"heroMutiTeamPy"),this.registerProxyAs(i.StockPy,"stockPy"),this.registerProxyAs(i.ImmortalPy,"immortalPy"),this.registerProxyAs(i.HoldemPy,"holdemPy"),this.registerProxyAs(i.HeroAltarPy,"heroAltarPy"),this.registerProxyAs(i.GloryArenaPy,"gloryArenaPy"),this.registerProxyAs(i.RaceTowerPy,"raceTowerPy"),this.registerProxyAs(i.GuidePy,"guidePy"),this.registerProxyAs(i.GuildSkillPy,"guildSkillPy")},o.prototype.registerProxyAs=function(e,t){this.facade.registerProxy(new e),i.GameMVC[t]=i.AppFacade.getInstance().retrieveProxy(e.N)},o);function o(){return e.call(this)||this}i.ModelPrepCommand=t,__reflect(t.prototype,"game.ModelPrepCommand",["puremvc.ICommand","puremvc.INotifier"]);var n,a=(n=puremvc.SimpleCommand,__extends(r,n),r.prototype.execute=function(e){var t=i.AppFacade.getInstance();t.removeProxy(i.PlayerPy.N),t.removeProxy(i.LoginPy.N),t.removeProxy(i.MailPy.N),t.removeProxy(i.FriendPy.N),t.removeProxy(i.FightPy.N),t.removeProxy(i.HeroPy.N),t.removeProxy(i.PetPy.N),t.removeProxy(i.MagicalArtifactPy.N),t.removeProxy(i.HeroSpiritPy.N),t.removeProxy(i.HeroThingPy.N),t.removeProxy(i.BackpackPy.N),t.removeProxy(i.CopyEntrancePy.N),t.removeProxy(i.PvpEntrancePy.N),t.removeProxy(i.MainPy.N),t.removeProxy(i.ShopPy.N),t.removeProxy(i.RechargePy.N),t.removeProxy(i.RankPy.N),t.removeProxy(i.TaskPy.N),t.removeProxy(i.ActivityPy.N),t.removeProxy(i.GuildPy.N),t.removeProxy(i.GuildFarmPy.N),t.removeProxy(i.GuajiPy.N),t.removeProxy(i.ArenaPy.N),t.removeProxy(i.ManorProxy.N),t.removeProxy(i.StormWarProxy.N),t.removeProxy(i.WorldKingPy.N),t.removeProxy(i.BattleZoneArenaPy.N),t.removeProxy(i.TeamExpePy.N),t.removeProxy(i.TeamBossPy.N),t.removeProxy(i.TeamPlayEntrancePy.N),t.removeProxy(i.ChampionPy.N),t.removeProxy(i.ZoneBossPy.N),t.removeProxy(i.HeroChallengePy.N),t.removeProxy(i.HeroChallenge2Py.N),t.removeProxy(i.GuildCollectPy.N),t.removeProxy(i.GuildBossPy.N),t.removeProxy(i.GuildWarPy.N),t.removeProxy(i.TouchGoldHandPy.N),t.removeProxy(i.GuildInstancePy.N),t.removeProxy(i.SmithyPy.N),t.removeProxy(i.TitlePy.N),t.removeProxy(i.ZzqPy.N),t.removeProxy(i.LuckyTablePy.N),t.removeProxy(i.DeepNestPy.N),t.removeProxy(i.DungeonPy.N),t.removeProxy(i.TribeBattlePy.N),t.removeProxy(i.PeakWarPy.N),t.removeProxy(i.FashionPy.N),t.removeProxy(i.MountPy.N),t.removeProxy(i.HeroMutiTeamPy.N),t.removeProxy(i.StockPy.N),t.removeProxy(i.ImmortalPy.N),t.removeProxy(i.HoldemPy.N),t.removeProxy(i.HeroAltarPy.N),t.removeProxy(i.GloryArenaPy.N),t.removeProxy(i.RaceTowerPy.N),t.removeProxy(i.GuidePy.N),t.removeProxy(i.GuildSkillPy.N)},r);function r(){return n.call(this)||this}i.ModelRemoveCommand=a,__reflect(a.prototype,"game.ModelRemoveCommand",["puremvc.ICommand","puremvc.INotifier"])}(game=game||{}),function(e){var t,i=(t=puremvc.MacroCommand,__extends(o,t),o.prototype.initializeMacroCommand=function(){this.addSubCommand(e.ControllerPrepCommand),this.addSubCommand(e.ModelPrepCommand),this.addSubCommand(e.ViewPrepCommand)},o);function o(){return t.call(this)||this}e.StartupCommand=i,__reflect(i.prototype,"game.StartupCommand");var n,a=(n=puremvc.MacroCommand,__extends(r,n),r.prototype.initializeMacroCommand=function(){this.addSubCommand(e.ModelRemoveCommand),this.addSubCommand(e.ViewRemoveCommand),this.addSubCommand(e.ModelPrepCommand),this.addSubCommand(e.ViewPrepCommand)},r);function r(){return n.call(this)||this}e.RestartCommand=a,__reflect(a.prototype,"game.RestartCommand")}(game=game||{}),function(i){var e,t=(e=puremvc.SimpleCommand,__extends(o,e),o.prototype.execute=function(e){this.registerMediatorAs(i.LoadingMediator,"loadingMed"),this.registerMediatorAs(i.LoginMediator,"loginMed"),this.registerMediatorAs(i.MainMediator,"mainMed"),this.registerMediatorAs(i.CityMediator,"cityMed"),this.registerMediatorAs(i.FightMediator,"fightMed"),this.registerMediatorAs(i.GuajiMediator,"guajiMed"),this.registerMediatorAs(i.MailMediator,"mailMed"),this.registerMediatorAs(i.BackpackMediator,"backpackMed"),this.registerMediatorAs(i.CopyEntranceMediator,"copyEntranceMed"),this.registerMediatorAs(i.PvpEntranceMediator,"pvpEntranceMed"),this.registerMediatorAs(i.ExtEntranceMediator,"extEntranceMed"),this.registerMediatorAs(i.FriendMediator,"friendMed"),this.registerMediatorAs(i.ShopyMediator,"shopyMed"),this.registerMediatorAs(i.RechargeMediator,"rechargeMed"),this.registerMediatorAs(i.TaskMediator,"taskMed"),this.registerMediatorAs(i.GuideMediator,"guideMed"),this.registerMediatorAs(i.ActivityMediator,"activityMed"),this.registerMediatorAs(i.RankMediator,"rankMed"),this.registerMediatorAs(i.CommonMediator,"commonMed"),this.registerMediatorAs(i.GuildMediator,"guildMed"),this.registerMediatorAs(i.GuildFarmMediator,"guildFarmMed"),this.registerMediatorAs(i.HeroMediator,"heroMed"),this.registerMediatorAs(i.HeroThingMediator,"heroThingMed"),this.registerMediatorAs(i.ArenaMediator,"arenaMed"),this.registerMediatorAs(i.ManorMediator,"manorMed"),this.registerMediatorAs(i.StormWarMediator,"stormWarMed"),this.registerMediatorAs(i.WorldKingMediator,"worldKingMed"),this.registerMediatorAs(i.BattleZoneArenaMediator,"battleZoneArenaMed"),this.registerMediatorAs(i.TeamExpeMediator,"teamExpeMed"),this.registerMediatorAs(i.TeamBossMediator,"teamBossMed"),this.registerMediatorAs(i.TeamPlayEntranceMediator,"teamPlayEntranceMed"),this.registerMediatorAs(i.ChampionMediator,"championMed"),this.registerMediatorAs(i.PetMediator,"petMed"),this.registerMediatorAs(i.MagicalArtifactMediator,"magicalArtifactMed"),this.registerMediatorAs(i.HeroSpiritMediator,"heroSpiritMed"),this.registerMediatorAs(i.GuildCollectMediator,"guildCollectMed"),this.registerMediatorAs(i.GuildBossMediator,"guildBossMed"),this.registerMediatorAs(i.GuildWarMediator,"guildWarMed"),this.registerMediatorAs(i.WorldBossMediator,"worldBossMed"),this.registerMediatorAs(i.HeroChallengeMediator,"heroChallengeMed"),this.registerMediatorAs(i.HeroChallenge2Mediator,"heroChallenge2Med"),this.registerMediatorAs(i.GuildSkillMediator,"guildSkillMed"),this.registerMediatorAs(i.GuildInstanceMediator,"guildInstanceMed"),this.registerMediatorAs(i.PlayerMediator,"playerMed"),this.registerMediatorAs(i.ChatMediator,"chatMed"),this.registerMediatorAs(i.TouchGoldHandMediator,"touchGoldHandMed"),this.registerMediatorAs(i.StrongMediator,"strongMed"),this.registerMediatorAs(i.HandBookMediator,"handBookMed"),this.registerMediatorAs(i.ModuleOpenMediator,"moduleOpenMed"),this.registerMediatorAs(i.BraveBookMediator,"braveBookMed"),this.registerMediatorAs(i.SmithyMediator,"smithyMed"),this.registerMediatorAs(i.TitleMediator,"titleMed"),this.registerMediatorAs(i.ZzqMediator,"zzqMed"),this.registerMediatorAs(i.LuckyTableMed,"luckyTableMed"),this.registerMediatorAs(i.DeepNestMediator,"DeepNestMed"),this.registerMediatorAs(i.DungeonMed,"dungeonMed"),this.registerMediatorAs(i.TribeBattleMed,"tribeBattleMed"),this.registerMediatorAs(i.PeakWarMed,"peakWarMed"),this.registerMediatorAs(i.FashionMediator,"fashionMed"),this.registerMediatorAs(i.MountMediator,"mountMediator"),this.registerMediatorAs(i.HeroMutiTeamMediator,"heroMutiTeamMed"),this.registerMediatorAs(i.StockMed,"stockMed"),this.registerMediatorAs(i.ImmortalMed,"immortalMed"),this.registerMediatorAs(i.HoldemMed,"holdemMed"),this.registerMediatorAs(i.HeroAltarMed,"heroAltarMed"),this.registerMediatorAs(i.GloryArenaMed,"gloryArenaMed"),this.registerMediatorAs(i.RaceTowerMed,"raceTowerMed")},o.prototype.registerMediatorAs=function(e,t){this.facade.registerMediator(new e),i.GameMVC[t]=i.AppFacade.getInstance().retrieveMediator(e.N)},o);function o(){return e.call(this)||this}i.ViewPrepCommand=t,__reflect(t.prototype,"game.ViewPrepCommand",["puremvc.ICommand","puremvc.INotifier"]);var n,a=(n=puremvc.SimpleCommand,__extends(r,n),r.prototype.execute=function(e){this.facade.removeMediator(i.LoadingMediator.N),this.facade.removeMediator(i.LoginMediator.N),this.facade.removeMediator(i.MainMediator.N),this.facade.removeMediator(i.CityMediator.N),this.facade.removeMediator(i.FightMediator.N),this.facade.removeMediator(i.GuajiMediator.N),this.facade.removeMediator(i.MailMediator.N),this.facade.removeMediator(i.BackpackMediator.N),this.facade.removeMediator(i.CopyEntranceMediator.N),this.facade.removeMediator(i.PvpEntranceMediator.N),this.facade.removeMediator(i.ExtEntranceMediator.N),this.facade.removeMediator(i.FriendMediator.N),this.facade.removeMediator(i.ShopyMediator.N),this.facade.removeMediator(i.RechargeMediator.N),this.facade.removeMediator(i.TaskMediator.N),this.facade.removeMediator(i.GuideMediator.N),this.facade.removeMediator(i.ActivityMediator.N),this.facade.removeMediator(i.RankMediator.N),this.facade.removeMediator(i.CommonMediator.N),this.facade.removeMediator(i.GuildMediator.N),this.facade.removeMediator(i.GuildFarmMediator.N),this.facade.removeMediator(i.HeroMediator.N),this.facade.removeMediator(i.HeroThingMediator.N),this.facade.removeMediator(i.ArenaMediator.N),this.facade.removeMediator(i.ManorMediator.N),this.facade.removeMediator(i.StormWarMediator.N),this.facade.removeMediator(i.WorldKingMediator.N),this.facade.removeMediator(i.BattleZoneArenaMediator.N),this.facade.removeMediator(i.TeamExpeMediator.N),this.facade.removeMediator(i.TeamBossMediator.N),this.facade.removeMediator(i.TeamPlayEntranceMediator.N),this.facade.removeMediator(i.ChampionMediator.N),this.facade.removeMediator(i.PetMediator.N),this.facade.removeMediator(i.GuildCollectMediator.N),this.facade.removeMediator(i.GuildBossMediator.N),this.facade.removeMediator(i.GuildWarMediator.N),this.facade.removeMediator(i.WorldBossMediator.N),this.facade.removeMediator(i.HeroChallengeMediator.N),this.facade.removeMediator(i.HeroChallenge2Mediator.N),this.facade.removeMediator(i.GuildSkillMediator.N),this.facade.removeMediator(i.PlayerMediator.N),this.facade.removeMediator(i.ChatMediator.N),this.facade.removeMediator(i.TouchGoldHandMediator.N),this.facade.removeMediator(i.StrongMediator.N),this.facade.removeMediator(i.GuildInstanceMediator.N),this.facade.removeMediator(i.MagicalArtifactMediator.N),this.facade.removeMediator(i.HeroSpiritMediator.N),this.facade.removeMediator(i.HandBookMediator.N),this.facade.removeMediator(i.ModuleOpenMediator.N),this.facade.removeMediator(i.BraveBookMediator.N),this.facade.removeMediator(i.SmithyMediator.N),this.facade.removeMediator(i.TitleMediator.N),this.facade.removeMediator(i.ZzqMediator.N),this.facade.removeMediator(i.LuckyTableMed.N),this.facade.removeMediator(i.DungeonMed.N),this.facade.removeMediator(i.TribeBattleMed.N),this.facade.removeMediator(i.PeakWarMed.N),this.facade.removeMediator(i.FashionMediator.N),this.facade.removeMediator(i.MountMediator.N),this.facade.removeMediator(i.HeroMutiTeamMediator.N),this.facade.removeMediator(i.StockMed.N),this.facade.removeMediator(i.ImmortalMed.N),this.facade.removeMediator(i.HoldemMed.N),this.facade.removeMediator(i.HeroAltarMed.N),this.facade.removeMediator(i.GloryArenaMed.N),this.facade.removeMediator(i.RaceTowerMed.N)},r);function r(){return n.call(this)||this}i.ViewRemoveCommand=a,__reflect(a.prototype,"game.ViewRemoveCommand",["puremvc.ICommand","puremvc.INotifier"])}(game=game||{}),function(e){var i,t=(i=eui.Component,__extends(o,i),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.cost.img_bg.visible=!1,this.updateData()},o.prototype.updateData=function(e){if(this.data=e,this.data){this.btn_btn.icon=this.data.source,this.btn_btn.label=this.data.text;var t=this.data.cost;t?(this.cost.visible=!0,this.cost.updateItem({cost:t})):this.cost.visible=!1}},o);function o(e){var t=i.call(this)||this;return t.data=e,t.skinName="ButtonSkinWithCost",t}e.ButtonSkinWithCost=t,__reflect(t.prototype,"customui.ButtonSkinWithCost")}(customui=customui||{});var AssetAdapter=function(){function r(){}return r.getSrcChangeConfig=function(){if(!this._srcChangeCfg&&this._checkAvailable){var e=game.Config&&game.Config.getResChangeConfig();if(e){if(this._checkAvailable=!1,this._srcChangeCfg={},!Utils.SDKMgr.getPerformConfig(0))return;for(var t in e){var i=e[t];this._srcChangeCfg[i.src]=i.tar,this._srcChangeCfg[ResourceUtils.png(i.src)]=ResourceUtils.png(i.tar),this._srcChangeCfg[i.src+"_jpg"]=i.tar+"_jpg"}}}return this._srcChangeCfg},r.prototype.getAsset=function(t,i,o){function e(e){i.call(o,e,t)}var n=r.getSrcChangeConfig();if(n&&(t=n[t]||t),RES.hasRes(t)){var a=RES.getRes(t);a?e(a):RES.getResAsync(t,e,this)}else RES.getResByUrl(t,e,this,RES.ResourceItem.TYPE_IMAGE)},r._checkAvailable=!0,r}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var AssetsMgr=function(t){function e(){var e=t.call(this)||this;return e.assetObjDict={},e.unityKey2KeyDict={},e.key2UnityKey={},e.destoryResQueue=new Array,e}return __extends(e,t),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log("AssetsMgr",e)},e.prototype.getResAsync=function(i,o,n,e){if(this.checkNeed(i)){e&&(this.unityKey2KeyDict[e]||(this.unityKey2KeyDict[e]={}),this.unityKey2KeyDict[e][i]=!0,this.key2UnityKey[i]=e);var a=this.assetObjDict[i];a||(a=customui.AssetsObjFactory.create({key:i}),this.assetObjDict[a.key]=a),a.raiseRes(),RES.getResAsync(i,function(e,t){a.addDataName(i),o.call(n,e,t)},this)}else this.log("该资源不支持:"+i),RES.getResAsync(i,o,n)},e.prototype.raiseRes=function(e,t){if(void 0===t&&(t=!1),!t&&this.unityKey2KeyDict[e])for(var i in this.unityKey2KeyDict[e])this.raiseRes(i,!0);else{var o=this.assetObjDict[e];if(!o)return;o.raiseRes()}},e.prototype.reduceRes=function(e,t){if(void 0===t&&(t=!1),!t&&this.unityKey2KeyDict[e]){var i=!0;for(var o in this.unityKey2KeyDict[e])i=this.reduceRes(o,!0)&&i;return i}var n=this.assetObjDict[e];return!!n&&n.reduceRes()},e.prototype.destoryRes=function(e,t){if(void 0===t&&(t=!1),!t&&this.unityKey2KeyDict[e])for(var i in this.unityKey2KeyDict[e])this.destoryRes(i,!0);else{var o=this.assetObjDict[e];if(!o)return!1;o.dispose(),delete this.assetObjDict[e],Utils.ObjectPoolMgr.push(o);var n=this.key2UnityKey[e];if(n){var a=this.unityKey2KeyDict[n];delete this.key2UnityKey[e],delete a[e],0==Object.keys(a).length&&delete this.unityKey2KeyDict[n]}}return!0},e.prototype.checkNeed=function(e){return RES.hasRes(e)},e.prototype.loadGroup=function(e){RES.loadGroup(e)},e.prototype.destroyGroup=function(e){RES.destroyRes(e)},e}(BaseClass);__reflect(AssetsMgr.prototype,"AssetsMgr"),function(e){var t=(i.create=function(e){return Utils.ObjectPoolMgr.pop("customui.AssetsObj",e)},i);function i(){}e.AssetsObjFactory=t,__reflect(t.prototype,"customui.AssetsObjFactory");var o=(n.prototype.raiseRes=function(){this.refCount++},n.prototype.reduceRes=function(){return this.refCount--,this.refCount<=0&&(Utils.AssetsMgr.destoryRes(this.key),!0)},n.prototype.isAlive=function(){return 0<this.refCount},n.prototype.addDataName=function(e){this.dataName=e},n.prototype.dispose=function(){this.dataName&&RES.destroyRes(this.dataName)},n.prototype.onOPReset=function(){this.dataName=void 0,this.refCount=0},n.prototype.onOPComeBack=function(e,t){this.key=e.key},n.prototype.onOPClean=function(){this.onOPReset()},n.prototype.onOPCheck=function(e){egret.log("alive")},n);function n(){this.refCount=0}e.AssetsObj=o,__reflect(o.prototype,"customui.AssetsObj",["IObjectPoolInterface"])}(customui=customui||{});var CacheMgr=function(t){function e(){var e=t.call(this)||this;return e.key2CacheObj={},e.cacheGP=new eui.Group,e.cacheGP.visible=!1,e.cacheGP.touchEnabled=!1,GameRootLayer.gameLayer().addChild(e.cacheGP),e}return __extends(e,t),e.prototype.setCacheComponent=function(e,t){this.cacheGP.contains(t)||(t.parent&&t.parent.contains(t)&&t.parent.removeChild(t),t.getChildByName("_effectOnObj")?t.getChildByName("_effectOnObj").animation.stop():"_effectOnObj"==t.name&&t.animation.stop(),this.key2CacheObj[e]=t,this.cacheGP.addChild(t))},e.prototype.getCacheComponent=function(e,t){var i=this.key2CacheObj[e];if(i&&this.cacheGP.contains(i))return this.cacheGP.removeChild(i),this.key2CacheObj[e]=void 0,t.addChild(i),i.getChildByName("_effectOnObj")?i.getChildByName("_effectOnObj").animation.play():"_effectOnObj"==i.name&&i.animation.play(),i;this.key2CacheObj[e]=void 0},e.prototype.checkInCacheComponent=function(e){return this.key2CacheObj[e]},e}(BaseClass);__reflect(CacheMgr.prototype,"CacheMgr"),function(n){var e=(c._formatConvert=function(e,t,i,o){void 0===o&&(o=!1);var n={};for(var a in e){var r=e[a];n[r[t]]||(n[r[t]]=o?[]:{}),o?n[r[t]].push(r):n[r[t]][r[i]]=r}return n},c.getConstValue=function(e){var t=c.constConfig()[e].constValue;return JSON.parse(t)},c.helpConfig=function(t){if(c.pack.g_help)return t(c.pack.g_help);RES.getResAsync("g_help_json",function(e){c.pack.g_help=e,t(c.pack.g_help)},this)},c.skillConfig=function(){return c.pack.g_skill},c.chessHero=function(){return c.pack.t_chess_hero},c.chessLevelHero=function(e){return c.pack.t_chess_level[e]},c.chessLevelHeroOther=function(e){return 0==c.pack.t_chess_level[e].exp&&(e-=1),c.pack.t_chess_level[e]},c.chessLevelHeroLength=function(){var e=[];for(var t in c.pack.t_chess_level)e.push(c.pack.t_chess_level[t]);return e.length},c.chessExpShop=function(e){return c.pack.t_chess_exp_shop[e||1]},c.chessStarLevel=function(){return c.pack.t_chess_star_level},c.chessRecommend=function(){return c.pack.t_chess_recommend},c.chessGrasp=function(){return c.pack.t_chess_card_pool_grasp},c.chessAchieveLevel=function(){return c.pack.t_chess_achieve_level},c.chessAchieveTask=function(){return c.pack.t_chess_achieve_task},c.chessAchieveLevelList=function(){var e=[];for(var t in c.pack.t_chess_achieve_level)e.push(c.pack.t_chess_achieve_level[t]);return e},c.chessAchieveTaskList=function(){var e=[];for(var t in c.pack.t_chess_achieve_task)e.push(c.pack.t_chess_achieve_task[t]);return e},c.manorLayer=function(){return c.pack.t_manor_layer},c.manor=function(){return c.pack.t_manor},c.stormWarLayer=function(){return c.pack.t_storm_war_layer},c.stormWarDoubleHit=function(){return c.pack.t_storm_war_double_hit},c.stormWarCreep=function(){return c.pack.t_storm_war_creep},c.stormWarRewards=function(){return c.pack.t_storm_war_rewards},c.buffResConfig=function(){return c.pack.t_buff_res},c.getRandNameList=function(){return c.pack.t_rand_name_list},c.getPerNameList=function(){return c.pack.t_perfix_name_list},c.getNextNameList=function(){return c.pack.t_next_name_list},c.guideFlowConfig=function(){return c.pack.t_guide_flow},c.guideStepConfig=function(){return c.pack.t_guide_step},c.guideHeroShow=function(){return c.pack.t_guide_hero_show},c.constConfig=function(){return c.pack.t_const||(c.pack.t_const=RES.getRes("t_const_json")),c.pack.t_const},c.mailConfig=function(){return c.pack.t_mail},c.getRechargeConfig=function(){return c.pack.t_recharge_level},c.getResChangeConfig=function(){return c.pack.t_res_change},c.targetReward=function(e){if(null==e)return c.pack.t_target_rewards;for(var t=[],i=0,o=c.pack.t_target_rewards;i<o.length;i++){var n=o[i];n.type==e&&t.push(n)}return t},c.attributeRestraintConfig=function(){return c.pack.t_attribute_restraint},c.attrDescConfig=function(){return c.pack.t_attribute_desc},c.petMasterConfig=function(){return c.pack.t_pet_master},c.courtshipSkillNumConfig=function(){return c.pack.t_courtship_skill_num},c.magicalMasterConfig=function(){return c.pack.t_magical_master},c.VIPUpgradeConfig=function(){return c.pack.t_vip_upgrade},c.VIPConfig=function(e){if(void 0===e&&(e=!1),e)return c.pack.t_vip;var t=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N);return c.pack.t_vip[t.playerInfoVO.playerVip.vipLevel]},c.errConfig=function(){return c.pack.t_error_code||(c.pack.t_error_code=RES.getRes("t_error_code_json")),c.pack.t_error_code},c.getModuleConfig=function(){return c.pack.t_module_open},c.unlockConfig=function(e){return null==e?c.pack.t_unlock:Utils.SDKMgr.getPerformConfig(10018)&&100100==e?void 0:c.pack.t_unlock[e]},c.publicBuyCostConfig=function(e,t){if(void 0===t&&(t=0),e){for(var i=void 0,o=0,n=c.pack.t_public_buy_cost;o<n.length;o++){var a=n[o];if(a.type===e&&(i=a).num===t+1)return i}return i}return c.pack.t_public_buy_cost},c.propertyConfig=function(){return c.pack.t_property_color},c.getPropertyByTypeCode=function(e,t){var i=c.propertyConfig();for(var o in i)if(i[o].type===e&&i[o].code===t)return i[o]},c.wayConfig=function(){return c.pack.t_way},c.getMainWayConfigByIdAndEntityType=function(e,t){for(var i=[],o=0,n=c.pack.t_main_way;o<n.length;o++){var a=n[o];if(a.code===e&&a.entityType===t){""!=a.way&&(i=JSON.parse(a.way));break}}return i},c.playerAvatarChangeConfig=function(){return c.pack.t_player_change_avatar},c.playerLevelUpgrade=function(){return c.pack.t_player_level_upgrade},c.dailyTaskExpConfig=function(){return c.pack.t_dailyTaskExp},c.risk=function(){return c.pack.t_risk},c.riskFortress=function(){return c.pack.t_risk_fortress},c.riskLayer=function(){return c.pack.t_risk_layer},c.riskLayerTheme=function(){return c.pack.t_risk_layer_theme},c.riskMaze=function(){return c.pack.t_risk_maze},c.riskMine=function(){return c.pack.t_risk_mine},c.strongConfig=function(){return c.pack.t_how_to_strong},c.riskCreep=function(){return c.pack.t_risk_creep},c.riskQuora=function(){return c.pack.t_risk_quora},c.riskEvent=function(){return c.pack.t_risk_event},c.riskEventDesc=function(){return c.pack.t_risk_event_desc},c.riskEventUnicursal=function(){return c.pack.t_risk_unicursal},c.riskEventTask=function(){return c.pack.t_risk_task},c.quoraConfig=function(){return c.pack.t_quora},c.zoneQuoraConfig=function(){return c.pack.t_zone_quora},c.demonConfig=function(){return c.pack.t_demon},c.demonCreepConfig=function(){return c.pack.t_demon_creep},c.creepConfig=function(e){if(e){var t=c.pack.t_creep[e];if(t)return c.pack.t_hero[t.heroId]}return c.pack.t_creep},c.heroConfigBySubType=function(e){var t=[];if(e)for(var i in c.pack.t_hero)c.pack.t_hero[i].subType==e&&t.push(c.pack.t_hero[i]);return t},c.rankingRewardByTypeConfig=function(e,t){var i=[],o=Utils.TimerManager.getServerTime(),n=new Date;n.setTime(1e3*o);var a=n.getDay();if(t){for(var r in c.pack.t_ranking_reward)if(c.pack.t_ranking_reward[r].type===e&&(s=c.pack.t_ranking_reward[r]).rankLower>=t&&t>=s.rankUpper&&(0==s.wDay||s.wDay==a))return i.push(s),i}else for(var r in c.pack.t_ranking_reward){var s;(s=c.pack.t_ranking_reward[r]).type!==e||0!=s.wDay&&s.wDay!=a||i.push(c.pack.t_ranking_reward[r])}return i},c.taskConfig=function(){return c.pack.t_task},c.taskConfigByTypeSperBySubtype=function(e){var t={};for(var i in c.pack.t_task)(o=c.pack.t_task[i]).type==e&&(t[o.subType]?t[o.subType].push(o):t[o.subType]=[o]);for(var i in t){var o;(o=t[i]).sort(function(e,t){return e.code-t.code})}return t},c.braveBook=function(){return c.pack.t_braveBook_task},c.HeroEquipCompound=function(){return c.pack.t_hero_equip_compound},c.arena_hRankReward=function(){return c.pack.t_arena_hRankReward},c.shop=function(){return c.pack.t_shop},c.refreshShop=function(){return c.pack.t_refresh_shop},c.shopWork=function(e){for(var t in c.pack.t_shop_work){var i=c.pack.t_shop_work[t];if(i.shopType==e)return i}return c.pack.t_shop_work},c.itemConfig=function(){return c.pack.t_item},c.getStoryConfigByIds=function(e){return new Array},c.activityConfigs=function(){return c.pack.t_activity_img},c.newYearMonsterConfigs=function(){return c.pack.t_newYear_monster},c.activityQuestionConfigs=function(){return c.pack.t_activity_question},c.activityBossConfigs=function(){return c.pack.t_activity_boss},c.activityEventConfigs=function(e){var t={};for(var i in c.pack.t_activity_event){var o=c.pack.t_activity_event[i];o.activityType==e&&(t[o.id]=o)}return t},c.relationRewardConfigs=function(){return c.pack.t_relation_reward},c.magpieConfigs=function(){return c.pack.t_magpie_talk},c.magpieEventConfigsByCode=function(e){if(e){var t=c.pack.t_magpie_event;for(var i in t)if(t[i].code==e)return t[i]}},c.magpieEventConfigs=function(e){if(!e)return c.pack.t_magpie_event;var t=c.pack.t_magpie_event;for(var i in t)if(t[i].type==e)return t[i]},c.magpieAchieveConfigs=function(){return c.pack.t_magpie_achieve},c.nationAchieveConfigs=function(){return c.pack.t_national_achieve},c.braveBookLevelConfigs=function(){return c.pack.t_braveBook_level},c.braveBookstarRewardConfigs=function(){return c.pack.t_braveBook_starReward},c.newBraveBookTasksConfig=function(){return c.pack.t_newBraveBook_task},c.newBraveBookLevelConfig=function(){return c.pack.t_newBraveBook_level},c.newBraveBookRewardConfig=function(){return c.pack.t_newBraveBook_starReward},c.broadcastConfig=function(){return c.pack.t_broadcast},c.broadcastLinkConfig=function(){return c.pack.t_broadcast_link},c.broadcastSentencesConfig=function(){return c.pack.t_broadcast_sentences},c.getTimeBroadcast=function(){var e=[];for(var t in c.pack.t_broadcast){var i=c.pack.t_broadcast[t];i.isRanomd==SystemMessageTrigger.time&&e.push(i)}return e},c.luckyMoneyConfig=function(){return c.pack.t_lucky_money},c.getGuildtranscriptConfig=function(){return c.pack.t_guild_transcript},c.getGuildtranscriptRewardConfig=function(){return c.pack.t_guild_transcript_ranking},c.guilddevoteConfig=function(){return c.pack.t_devote},c.guildLevelUpgradeConfig=function(){return c.pack.t_guild_level_upgrade},c.guildSkillConfig=function(){return c.pack.t_guild_skill},c.getGuildCollect=function(){return c.pack.t_guild_collect},c.guildBossConfig=function(){return c.pack.t_guild_boss},c.guild_skill_reset=function(){return c.pack.t_guild_skill_reset},c.progressBar_node=function(e){var t=[];for(var i in c.pack.t_progressBar_node){var o=c.pack.t_progressBar_node[i];o.type==e&&t.push(o)}return t.sort(function(e,t){return e.key-t.key}),t},c.unzipStep=function(){for(var e=0;e<3;e++){var t=this._fileToUnzip.shift(),i=this._zip.file("config/"+t+".json");i&&(i=JSON.parse(i.asText()),c.pack[t]=i)}this._itemsLoaded+=3,this._processCB&&this._processCB.call(this._context,{itemsLoaded:this._itemsLoaded,itemsTotal:this._itemsTotal},this._context),this._itemsLoaded>=this._itemsTotal&&(GameRootLayer.gameLayer().loadLayer.removeEventListener(egret.Event.ENTER_FRAME,this.unzipStep,this),this._allDoneCB&&this._allDoneCB.call(this._context),this._zip=void 0,this._fileToUnzip=[],this._processCB=void 0,this._allDoneCB=void 0,this._context=void 0,this.unzipFinish=!0,RES.destroyRes("config_all_zip"))},c.unzipSync=function(e,t,i){for(var o in this._itemsTotal=Object.keys(c.pack).length,this._itemsLoaded=0,this._processCB=e,this._allDoneCB=t,this._context=i,this._zip=new JSZip(RES.getRes("config_all_zip")),c.pack)this._fileToUnzip.push(o);GameRootLayer.gameLayer().loadLayer.addEventListener(egret.Event.ENTER_FRAME,this.unzipStep,this)},c.allHeroConfig=function(e){return c.pack.t_hero},c.heroModelOffsetConfig=function(e){if(c.pack.t_hero_model_offset)return c.pack.t_hero_model_offset[e]},c.heroExpConfig=function(){return c.pack.t_hero_exp},c.heroAndPetUpgradeConfig=function(e){return c.pack.t_hero_upgrade_costs},c.heroAndPetUpstarConfig=function(e){return c.pack.t_hero_upstar_costs},c.heroAndPetSectionConfig=function(e){return c.pack.t_hero_section},c.heroResonateConfig=function(e,t){if(e){var i=[];for(var o in c.pack.t_hero_resonate){var n=c.pack.t_hero_resonate[o];n.subType!=e||null!=t&&n.level!=t||i.push(n)}return i}return c.pack.t_hero_resonate},c.heroResonateLevelConfig=function(e,t){if(!e)return c.pack.t_hero_resonate_level;for(var i in c.pack.t_hero_resonate_level){var o=c.pack.t_hero_resonate_level[i];if(e===o.subType&&t===o.level)return o}},c.heroHaloConfig=function(){return c.pack.t_hero_halo},c.heroAltarConfig=function(){return c.pack.t_altar_hero_upstar},c.heroAltarUnlockCostConfig=function(e){var t=[];for(var i in c.pack.t_altar_unlock_costs){var o=c.pack.t_altar_unlock_costs[i];o.type==e&&t.push(o)}return t.sort(function(e,t){return e.slotNum-t.slotNum}),t},c.heroDefendConfig=function(e){var t=[];for(var i in c.pack.t_hero_defend)c.pack.t_hero_defend[i].subType==e&&t.push(c.pack.t_hero_defend[i]);return t.sort(function(e,t){return e.level>t.level?1:-1}),t},c.heroPracticeConfig=function(e,t){if(e){var i=[];for(var o in c.pack.t_hero_practice){var n=c.pack.t_hero_practice[o];n.subType!==e||void 0!==t&&n.level!==t||i.push(n)}return i}return c.pack.t_hero_practice},c.heroReplacementConfig=function(){return c.pack.t_replacement},c.allPetConfig=function(){return c.pack.t_pet},c.petUpgradeConfig=function(e){var t=[];for(var i in c.pack.t_pet_upgrade_costs){var o=c.pack.t_pet_upgrade_costs[i];t.push(o)}return t},c.petSectionConfig=function(e){var t=[];for(var i in c.pack.t_pet_section){var o=c.pack.t_pet_section[i];o.subType==e&&t.push(o)}return t},c.petSkillConfig=function(e,t){if(!e)return c.pack.t_pet_skill_costs;var i=[];for(var o in c.pack.t_pet_skill_costs){var n=c.pack.t_pet_skill_costs[o];n.subType==e&&n.skillCode==t&&i.push(n)}return i.sort(function(e,t){return e.level-t.level}),i},c.allMagicalConfig=function(){return c.pack.t_magical},c.magicalUpgradeConfig=function(e){var t=[];for(var i in c.pack.t_magical_upgrade_costs){var o=c.pack.t_magical_upgrade_costs[i];o.code==e&&t.push(o)}return t},c.magicalSectionConfig=function(e){var t=[];for(var i in c.pack.t_magical_upsection_costs){var o=c.pack.t_magical_upsection_costs[i];o.code==e&&t.push(o)}return t},c.getHeroEquipConfig=function(){return c.pack.t_hero_equip},c.getHeroEquipMasterConfig=function(e){var t=[];for(var i in c.pack.t_hero_equip_master){var o=c.pack.t_hero_equip_master[i];o.type==e&&t.push(o)}return t.sort(n.GeneralConfig.simpleSort("level")),t},c.getHeroEquipSuitConfig=function(e){var t=[];for(var i in c.pack.t_hero_equip_suit){var o=c.pack.t_hero_equip_suit[i];o.type==e&&t.push(o)}return t.sort(function(e,t){return e.num-t.num}),t},c.getHeroEquipUpgradeCostConfigByCode=function(e,t){var i=[];for(var o in c.pack.t_hero_equip_upgrade_costs){var n=c.pack.t_hero_equip_upgrade_costs[o];n.code!=e||n.level!=t&&t||i.push(n)}return i.sort(function(e,t){return e.level-t.level}),i},c.getHeroEquipUnlockLevel=function(e){for(var t in c.pack.t_hero_equip_unlock){var i=c.pack.t_hero_equip_unlock[t];if(i.type==e)return i.unlockLevel}return-1},c.getHeroEquipUpgradeConfig=function(e,t){if(null==t){var i=[];for(var o in c.pack.t_hero_equip_upgrade_costs)(n=c.pack.t_hero_equip_upgrade_costs[o]).code==e&&i.push(n);return i.sort(function(e,t){return e.level-t.level}),i}for(var o in c.pack.t_hero_equip_upgrade_costs){var n;if((n=c.pack.t_hero_equip_upgrade_costs[o]).code==e&&n.level==t)return n}},c.getHeroEquipEnchantConfig=function(e,t){if(null==t){var i=[];for(var o in c.pack.t_hero_equip_enchant_costs)(n=c.pack.t_hero_equip_enchant_costs[o]).code==e&&i.push(n);return i.sort(function(e,t){return e.level-t.level}),i}for(var o in c.pack.t_hero_equip_enchant_costs){var n;if((n=c.pack.t_hero_equip_enchant_costs[o]).code==e&&n.level==t)return n}},c.getHeroEquipQuenchceConfig=function(e,t){if(null==t){var i=[];for(var o in c.pack.t_hero_equip_quenchce_costs)(n=c.pack.t_hero_equip_quenchce_costs[o]).code==e&&i.push(n);return i.sort(function(e,t){return e.level-t.level}),i}for(var o in c.pack.t_hero_equip_quenchce_costs){var n;if((n=c.pack.t_hero_equip_quenchce_costs[o]).code==e&&n.level==t)return n}},c.getHeroArtifactConfig=function(e){if(e){var t=[];for(var i in c.pack.t_hero_artifact){var o=c.pack.t_hero_artifact[i];o.subType==e&&t.push(o)}return t.sort(function(e,t){return e.sectionLevel-t.sectionLevel}),t}return c.pack.t_hero_artifact},c.getHeroArtifactBaptizeConfig=function(){return c.pack.t_hero_artifact_baptize},c.getCanShowHeroArtifactBaptizeColor=function(){if(!n.Config._canShowHeroArtifactBaptizeColor){n.Config._canShowHeroArtifactBaptizeColor=99999;var e=c.getHeroArtifactBaptizeConfig();for(var t in e){var i=e[t];n.Config._canShowHeroArtifactBaptizeColor=Math.min(n.Config._canShowHeroArtifactBaptizeColor,i.color)}}return n.Config._canShowHeroArtifactBaptizeColor},c.getHeroArtifactUnlockLevel=function(){var e=n.Config.unlockConfig(MODULE.HeroArtifact);return e?JSON.parse(e.condition)[1]:0},c.getHeroArtifactUpgradeConfig=function(e,t){if(e=c.getHeroArtifactConfig()[e].subType,null==t){var i=[];for(var o in c.pack.t_hero_artifact_upgrade_costs)(n=c.pack.t_hero_artifact_upgrade_costs[o]).code==e&&i.push(n);return i.sort(function(e,t){return e.level-t.level}),i}for(var o in c.pack.t_hero_artifact_upgrade_costs){var n;if((n=c.pack.t_hero_artifact_upgrade_costs[o]).code==e&&n.level==t)return n}},c.getHeroArtifactUpstarConfig=function(e,t){if(null==t){var i=[];for(var o in c.pack.t_hero_artifact_upstar_costs)(n=c.pack.t_hero_artifact_upstar_costs[o]).code==e&&i.push(n);return i.sort(function(e,t){return e.level-t.level}),i}for(var o in c.pack.t_hero_artifact_upstar_costs){var n;if((n=c.pack.t_hero_artifact_upstar_costs[o]).code==e&&n.level==t)return n}},c.getHeroArtifactUpSectionConfig=function(){return c.pack.t_hero_artifact_upsection_costs},c.heroArtifactResonate=function(e){if(e){var t={};for(var i in c.pack.t_hero_artifact_resonate){var o=c.pack.t_hero_artifact_resonate[i];o.subType==e&&(t[i]=o)}return t}return c.pack.t_hero_artifact_resonate},c.heroArtifactCompound=function(){return c.pack.t_hero_artifact_compound},c.heroArtifactAdditon=function(){return c.pack.t_hero_artifact_addition},c.heroArtifactRollbackConfig=function(e,t){if(null==e||null==t)return c.pack.t_hero_artifact_rollback;for(var i in c.pack.t_hero_artifact_rollback){var o=c.pack.t_hero_artifact_rollback[i];if(o.color==e&&o.section==t)return o}},c.getRiskMapByCode=function(e){return c.pack.t_risk_map[e]},c.getRiskMapItemsByCode=function(e){return c.pack.t_risk_map_items[e]},c.getHeroTreasureConfig=function(){return c.pack.t_treasure},c.getHeroDermaConfig=function(e){return e?c.pack.t_hero_derma[e]:c.pack.t_hero_derma},c.getHeroDermaHandbookConfig=function(){return c.pack.t_hero_derma_handbook},c.getHeroDermaUpCostsConfig=function(e){var t=[];for(var i in c.pack.t_hero_derma_upgrade_costs)c.pack.t_hero_derma_upgrade_costs[i].code==e&&t.push(c.pack.t_hero_derma_upgrade_costs[i]);return t},c.heroDermaActivateConfig=function(e){var t=[];for(var i in c.pack.t_hero_derma){var o=c.pack.t_hero_derma[i];o.code==e&&t.push(o)}return t},c.getHeroTreasureUnlockLevel=function(){var e=JSON.parse(c.pack.t_unlock[MODULE.Treasure].condition)[1],t=c.pack.t_treasure[0].putOnLevel;return t<e?e:t},c.getTreasureLockInfo=function(e,t){var i=c.pack.t_treasure_jewel_unlock[e];if(i)return t>=i.unlockLevel?void 0:i.unlockLevel},c.getTreasureJewelUpgradeConfig=function(t){var i=[];return c.pack.t_treasure_jewel_upgrade.forEach(function(e){e.type==t&&i.push(e)}),i.sort(function(e,t){return e.level-t.level}),i},c.getTreasureResonate=function(e){return c.pack.t_treasure_jewel_resonate[e]},c.immortalConfig=function(){if(!c.custom.t_immortal){var e={};for(var t in c.pack.t_immortal){var i=c.pack.t_immortal[t],o=Utils.ArrayUtil.cloneObj(i);o.code=o.subType,e[t]=o}c.custom.t_immortal=e}return c.custom.t_immortal},c.immortalBaptize=function(){return c.pack.t_immortal_baptize},c.immortalBaptizeAttr=function(e,t){if(!c.custom.t_immortal_baptize_attr){var i={};for(var o in c.pack.t_immortal_baptize_attr){var n=c.pack.t_immortal_baptize_attr[o];i[n.attrType]||(i[n.attrType]={}),i[n.attrType][n.color]=n}c.custom.t_immortal_baptize_attr=i}return null==t?c.custom.t_immortal_baptize_attr[e]:c.custom.t_immortal_baptize_attr[e][t]},c.immortalUpsectionCosts=function(e,t){return c.custom.t_immortal_upSection_costs||(c.custom.t_immortal_upSection_costs=c._formatConvert(c.pack.t_immortal_upSection_costs,"subType","level")),null!=t?c.custom.t_immortal_upSection_costs[e][t]:c.custom.t_immortal_upSection_costs[e]},c.gashaponEntry=function(){return c.pack.t_gashapon_entry},c.gashaponItems=function(){return c.pack.t_gashapon_items},c.gashaponTimes=function(){return c.pack.t_gashapon_times},c.skillBaseConfig=function(){return c.pack.t_skill_base},c.skillEffectConfig=function(){return c.pack.t_skill_effect},c.champion=function(){return c.pack.t_champion},c.championMaxLayer=function(){return c.custom.championMaxLayer||(c.custom.championMaxLayer=Object.keys(c.pack.t_champion).length),c.custom.championMaxLayer},c.championAchievement=function(){return c.pack.t_champion_achievement},c.dailyFortress=function(){return c.pack.t_daily_fortress},c.dailyFortressStage=function(){return c.pack.t_daily_stage},c.expedition=function(){return c.pack.t_expedition},c.expeditionAchievement=function(){return c.pack.t_expedition_achievement},c.teamExpedition=function(){return c.pack.t_team_expedition},c.teamBoss=function(){return c.pack.t_team_boss},c.getTeamExpeditionDetailByChapter=function(e){e=Number(e);var t=[];for(var i in c.pack.t_team_expedition){var o=c.pack.t_team_expedition[i];o.chapterId==e&&t.push(o)}return t.sort(function(e,t){return e.id-t.id}),t},c.teamExpeditionChatper=function(){return c.pack.t_team_chapter},c.teamRewardConfig=function(){return c.pack.t_team_rewards},c.worldKingLevelConfig=function(){return c.pack.t_world_king_levels},c.worldKingRewardConfig=function(e){if(e){var t={},i=1;for(var o in c.pack.t_world_king_rewards){var n=c.pack.t_world_king_rewards[o];n.type==e&&(t[i++]=n)}return t}return c.pack.t_world_king_rewards},c.serverBoss=function(){return c.pack.t_server_boss},c.serverBossReward=function(e){if(e){var t=[];for(var i in c.pack.t_server_boss_reward){var o=c.pack.t_server_boss_reward[i];if(o.type==e){var n=JSON.parse(o.key);t.push({id:o.id,type:o.type,rankUpper:n[0],rankLower:n[1],rewards:o.rewards})}}return t}return c.pack.t_server_boss_reward},c.heroSpriteAchievementReward=function(){return c.pack.t_hero_spirit_achievement},c.getHeroChallengeBoss=function(){return c.pack.t_challenge_boss},c.getHeroChallengeMap=function(){return c.pack.t_challenge_map},c.getHeroChallengeEvent=function(e){if(!e)return c.pack.t_challenge_event;var t=c.pack.t_challenge_event;for(var i in t){var o=t[i];if(o.code==e)return o}},c.questionConfig=function(){return c.pack.t_question},c.storyConfig=function(){return c.pack.t_story},c.storySubConfig=function(){return c.pack.t_story_sub},c.touchGoldHandRewards=function(){return c.pack.t_touchGoldHand_rewards},c.tribeBattleRewards=function(){return c.pack.t_tribeBattle_achieveRewards},c.heroChallengeStage=function(e){if(!e)return c.pack.t_hero_challenge_stage;for(var t in c.pack.t_hero_challenge_stage){var i=c.pack.t_hero_challenge_stage[t];if(i.code==e)return i}},c.heroChallengeCreep=function(){return c.pack.t_hero_challenge_creep},c.heroChallengeBuff=function(){return c.pack.t_hero_challenge_buff},c.heroRollBackConfig=function(){return c.pack.t_hero_rollback},c.operationConfig=function(){return c.pack.t_operation},c.luckyTablePoolConfig=function(){return c.pack.t_lucky_turntable_pool},c.luckyTableConfig=function(){return c.pack.t_lucky_turntable},c.deepNestConfig=function(e){var t=[];for(var i in c.pack.t_abyssLair)if(c.pack.t_abyssLair[i].chapter==e&&(t.push(c.pack.t_abyssLair[i]),5==t.length))break;return t.sort(function(e,t){return e.code-t.code}),t},c.deepNestRewardConfig=function(e){var t=[];for(var i in c.pack.t_abyssLair_box)if(c.pack.t_abyssLair_box[i].chapter==e&&(t.push(c.pack.t_abyssLair_box[i]),3==t.length))break;return t.sort(function(e,t){return e.star-t.star}),t},c.deepNestWayConfig=function(e){return c.pack.t_abyssLair_chapter[e]},c.giftConfig=function(){return c.pack.t_gift},c.vestageItemConfig=function(){return c.pack.t_vestage_item},c.vestageMapConfig=function(){return c.pack.t_vestage_map},c.vestageEventConfig=function(){return c.pack.t_vestage_event},c.vestageResultConfig=function(){return c.pack.t_vestage_result},c.vestageQuestionConfig=function(){return c.pack.t_vestage_question},c.vestageEventDescConfig=function(){return c.pack.t_vestage_event_desc},c.vestageEventDescConfigByCreep=function(){var e=[];for(var t in c.pack.t_vestage_event_desc)c.pack.t_vestage_event_desc[t].eventType==VestageEventType.Creep&&e.push(c.pack.t_vestage_event_desc[t]);return e},c.fashionConfig=function(){return c.pack.t_fashion},c.fashionConfigList=function(){var e=[];for(var t in c.pack.t_fashion)e.push(c.pack.t_fashion[t]);return e},c.fashionBookConfig=function(){return c.pack.t_fashion_handbook},c.fashionUpConfigByCode=function(e){var t=[];for(var i in c.pack.t_fashion_upgrade_costs)c.pack.t_fashion_upgrade_costs[i].code==e&&t.push(c.pack.t_fashion_upgrade_costs[i]);return t},c.fashionMasterConfig=function(){return c.pack.t_fashion_master},c.spirteMasterConfig=function(){return c.pack.t_hero_spirit_master},c.titleConfig=function(){return c.pack.t_title},c.farm_farmConfig=function(){return c.pack.t_topFarm_farm},c.farm_farmConfigByLevel=function(e){for(var t in c.pack.t_topFarm_farm)if(c.pack.t_topFarm_farm[t].farmLevel==e)return c.pack.t_topFarm_farm[t]},c.farm_fruitConfig=function(){return c.pack.t_topFarm_fruit},c.farm_marketConfig=function(){return c.pack.t_topFarm_market},c.farm_collectConfig=function(){return c.pack.t_topFarm_collect},c.farm_seedConfig=function(){return c.pack.t_topFarm_seed},c.farm_buildingConfig=function(){return c.pack.t_topFarm_building},c.farm_ResearchConfig=function(){return c.pack.t_topFarm_research},c.farm_ResearchConfigByLevel=function(e){for(var t in c.pack.t_topFarm_research)if(c.pack.t_topFarm_research[t].level==e)return c.pack.t_topFarm_research[t]},c.farm_skillConfigByTab=function(e){var t=[];for(var i in c.pack.t_topFarm_research_skill)c.pack.t_topFarm_research_skill[i].tab==e&&1==c.pack.t_topFarm_research_skill[i].level&&t.push(c.pack.t_topFarm_research_skill[i]);return t},c.farm_skillConfigByType=function(e){var t=[];for(var i in c.pack.t_topFarm_research_skill)c.pack.t_topFarm_research_skill[i].type==e&&t.push(c.pack.t_topFarm_research_skill[i]);return t},c.farm_skillConfigByTypeAndLevel=function(e,t){for(var i in c.pack.t_topFarm_research_skill)if(c.pack.t_topFarm_research_skill[i].type==e&&c.pack.t_topFarm_research_skill[i].level==t)return c.pack.t_topFarm_research_skill[i]},c.farm_skillResetConfigByNum=function(e){var t=[];for(var i in c.pack.t_topFarm_research_skill_reset)if(t.push(c.pack.t_topFarm_research_skill_reset[i]),c.pack.t_topFarm_research_skill_reset[i].num==e)return c.pack.t_topFarm_research_skill_reset[i];return t[t.length-1]},c.farm_CollectConfigByLevel=function(e){for(var t in c.pack.t_topFarm_collect)if(c.pack.t_topFarm_collect[t].level==e)return c.pack.t_topFarm_collect[t]},c.moduleHelpConfig=function(){return c.pack.t_module_help},c.entranceTimeConfig=function(){return c.pack.t_entrance_time},c.heroSpiritConfigByChapterId=function(e){var t=[];for(var i in c.pack.t_hero_spirit)c.pack.t_hero_spirit[i].chapterId==e&&t.push(c.pack.t_hero_spirit[i]);return t},c.heroSpiritConfigByCode=function(e){for(var t in c.pack.t_hero_spirit)if(c.pack.t_hero_spirit[t].code==e)return c.pack.t_hero_spirit[t]},c.heroSpiritConfigByFirst=function(e){for(var t in c.pack.t_hero_spirit)if(c.pack.t_hero_spirit[t].chapterId==e&&1==c.pack.t_hero_spirit[t].firstCode)return c.pack.t_hero_spirit[t]},c.heroSpiritConfig=function(e){var t=[];for(var i in c.pack.t_hero_spirit)c.pack.t_hero_spirit[i].chapterId==e&&t.push(c.pack.t_hero_spirit[i]);return t},c.heroSpiritChapterConfig=function(){var e=[];for(var t in c.pack.t_hero_spirit_chapter)e.push(c.pack.t_hero_spirit_chapter[t]);return e},c.heroSpiritUpstarConfig=function(e){var t=[];for(var i in c.pack.t_hero_spirit_upstar_costs)c.pack.t_hero_spirit_upstar_costs[i].code==e&&t.push(c.pack.t_hero_spirit_upstar_costs[i]);return t},c.peakWarBaseConfig=function(){return c.pack.t_peakWar_base},c.peakWarFreeReward=function(){return c.pack.t_peakWar_daily_rewards},c.peakWarHighReward=function(){return c.pack.t_peakWar_highLadder_achieve},c.roleSkillTree=function(){var e=[];for(var t in c.pack.t_role_skill_tree)e.push(c.pack.t_role_skill_tree[t]);return e},c.roleSkill=function(){var e=[];for(var t in c.pack.t_role_skill)e.push(c.pack.t_role_skill[t]);return e},c.roleSkillById=function(e){var t=[];for(var i in c.pack.t_role_skill)e==c.pack.t_role_skill[i].treeId&&t.push(c.pack.t_role_skill[i]);return t},c.roleSkillByCode=function(){return c.pack.t_role_skill},c.roleSkillUpByCode=function(e){var t=[];for(var i in c.pack.t_role_skill_upgrade_costs)e==c.pack.t_role_skill_upgrade_costs[i].code&&t.push(c.pack.t_role_skill_upgrade_costs[i]);return t},c.getSecAchievementConfig=function(){return c.pack.t_secondAchievement_task},c.getSecAchievementLevelConfig=function(){return c.pack.t_secondAchievement_level},c.horseConfig=function(){var e=[];for(var t in c.pack.t_horse)e.push(c.pack.t_horse[t]);return e},c.horseConfigList=function(){return c.pack.t_horse},c.horseBookConfig=function(){return c.pack.t_horse_handbook},c.horseGradeConfigByCode=function(e){var t=[];for(var i in c.pack.t_horse_upgrade_costs)e==c.pack.t_horse_upgrade_costs[i].code&&t.push(c.pack.t_horse_upgrade_costs[i]);return t},c.horseStarConfigByCode=function(e){var t=[];for(var i in c.pack.t_horse_upstar_costs)e==c.pack.t_horse_upstar_costs[i].code&&t.push(c.pack.t_horse_upstar_costs[i]);return t},c.stockConfig=function(){return c.pack.t_stock},c.stockNewsConfig=function(){return c.pack.t_stock_news},c.suitAttrConfig=function(){return c.pack.t_suit_attr},c.raceTowerConfig=function(e){if(e){var t={};for(var i in c.pack.t_raceTower){var o=c.pack.t_raceTower[i];o.raceType==e&&(t[o.code]=o)}return t}return c.pack.t_raceTower},c.custom={championMaxLayer:void 0,t_immortal:void 0,t_immortal_upSection_costs:void 0,t_immortal_baptize_attr:void 0},c.pack={t_error_code:void 0,t_const:void 0,t_mail:void 0,t_operation:void 0,t_property_color:void 0,t_public_buy_cost:void 0,t_unlock:void 0,t_module_open:void 0,t_vip:void 0,t_vip_upgrade:void 0,t_way:void 0,t_main_way:void 0,t_target_rewards:void 0,t_random_reward:void 0,t_attribute_restraint:void 0,t_attribute_desc:void 0,t_player_level_upgrade:void 0,t_player_change_avatar:void 0,t_guide_flow:void 0,t_guide_step:void 0,t_guide_hero_show:void 0,t_risk:void 0,t_risk_fortress:void 0,t_risk_layer:void 0,t_risk_layer_theme:void 0,t_risk_maze:void 0,t_risk_mine:void 0,t_risk_creep:void 0,t_risk_quora:void 0,t_risk_event:void 0,t_risk_event_desc:void 0,t_risk_unicursal:void 0,t_risk_task:void 0,t_demon:void 0,t_demon_creep:void 0,t_creep:void 0,t_item:void 0,t_shop:void 0,t_shop_game:void 0,t_shop_work:void 0,t_refresh_shop:void 0,t_task:void 0,t_braveBook_task:void 0,t_progressBar_node:void 0,t_ranking_reward:void 0,t_dailyTaskExp:void 0,t_secondAchievement_level:void 0,t_secondAchievement_task:void 0,t_rand_name_list:void 0,t_perfix_name_list:void 0,t_next_name_list:void 0,t_activity_img:void 0,t_newYear_monster:void 0,t_activity_question:void 0,t_activity_boss:void 0,t_activity_event:void 0,t_relation_reward:void 0,t_magpie_talk:void 0,t_magpie_event:void 0,t_magpie_achieve:void 0,t_national_achieve:void 0,t_broadcast:void 0,t_broadcast_link:void 0,t_broadcast_sentences:void 0,t_lucky_money:void 0,t_devote:void 0,t_guild_level_upgrade:void 0,t_guild_skill:void 0,t_guild_collect:void 0,t_guild_boss:void 0,t_guild_skill_reset:void 0,t_guild_transcript:void 0,t_guild_transcript_ranking:void 0,g_help:void 0,g_skill:void 0,t_buff_res:void 0,t_recharge_level:void 0,t_res_change:void 0,t_chess_hero:void 0,t_chess_level:void 0,t_chess_exp_shop:void 0,t_chess_star_level:void 0,t_chess_recommend:void 0,t_chess_card_pool_grasp:void 0,t_chess_achieve_level:void 0,t_chess_achieve_task:void 0,t_manor_layer:void 0,t_manor:void 0,t_storm_war_layer:void 0,t_storm_war_double_hit:void 0,t_storm_war_creep:void 0,t_storm_war_rewards:void 0,t_abyssLair:void 0,t_abyssLair_box:void 0,t_abyssLair_chapter:void 0,t_hero_spirit:void 0,t_hero_spirit_chapter:void 0,t_hero_spirit_upstar_costs:void 0,t_hero_spirit_achievement:void 0,t_hero:void 0,t_hero_model_offset:void 0,t_hero_exp:void 0,t_hero_upstar_costs:void 0,t_hero_upgrade_costs:void 0,t_hero_section:void 0,t_hero_resonate:void 0,t_hero_resonate_level:void 0,t_replacement:void 0,t_hero_halo:void 0,t_hero_practice:void 0,t_hero_defend:void 0,t_altar_hero_upstar:void 0,t_altar_unlock_costs:void 0,t_pet:void 0,t_pet_upgrade_costs:void 0,t_pet_section:void 0,t_pet_skill_costs:void 0,t_pet_master:void 0,t_courtship_skill_num:void 0,t_magical:void 0,t_magical_upgrade_costs:void 0,t_magical_upsection_costs:void 0,t_magical_master:void 0,t_hero_equip:void 0,t_hero_equip_unlock:void 0,t_hero_equip_upgrade_costs:void 0,t_hero_equip_enchant_costs:void 0,t_hero_equip_suit:void 0,t_hero_equip_compound:void 0,t_hero_equip_quenchce_costs:void 0,t_hero_equip_master:void 0,t_hero_artifact:void 0,t_hero_artifact_level_exp:void 0,t_hero_artifact_upstar_costs:void 0,t_hero_artifact_upgrade_costs:void 0,t_hero_artifact_upsection_costs:void 0,t_hero_artifact_rollback:void 0,t_hero_artifact_baptize:void 0,t_hero_artifact_compound:void 0,t_hero_artifact_resonate:void 0,t_hero_artifact_addition:void 0,t_treasure:void 0,t_treasure_jewel_unlock:void 0,t_treasure_jewel_upgrade:void 0,t_treasure_jewel_resonate:void 0,t_immortal:void 0,t_immortal_baptize:void 0,t_immortal_baptize_attr:void 0,t_immortal_upSection_costs:void 0,t_hero_derma:void 0,t_hero_derma_handbook:void 0,t_hero_derma_upgrade_costs:void 0,t_risk_map:void 0,t_risk_map_items:void 0,t_gashapon_entry:void 0,t_gashapon_items:void 0,t_gashapon_times:void 0,t_skill_base:void 0,t_skill_effect:void 0,t_champion:void 0,t_champion_achievement:void 0,t_daily_fortress:void 0,t_daily_stage:void 0,t_expedition:void 0,t_expedition_achievement:void 0,t_team_expedition:void 0,t_team_chapter:void 0,t_team_rewards:void 0,t_team_boss:void 0,t_world_king_levels:void 0,t_world_king_rewards:void 0,t_server_boss:void 0,t_server_boss_reward:void 0,t_challenge_boss:void 0,t_challenge_map:void 0,t_challenge_event:void 0,t_question:void 0,t_story:void 0,t_story_sub:void 0,t_touchGoldHand_rewards:void 0,t_how_to_strong:void 0,t_arena_hRankReward:void 0,t_braveBook_level:void 0,t_braveBook_starReward:void 0,t_newBraveBook_task:void 0,t_newBraveBook_level:void 0,t_newBraveBook_starReward:void 0,t_hero_challenge_stage:void 0,t_hero_challenge_creep:void 0,t_hero_challenge_buff:void 0,t_hero_rollback:void 0,t_lucky_turntable_pool:void 0,t_lucky_turntable:void 0,t_gift:void 0,t_vestage_item:void 0,t_vestage_map:void 0,t_vestage_event:void 0,t_vestage_result:void 0,t_vestage_question:void 0,t_vestage_event_desc:void 0,t_fashion:void 0,t_fashion_handbook:void 0,t_fashion_upgrade_costs:void 0,t_fashion_master:void 0,t_hero_spirit_master:void 0,t_title:void 0,t_role_skill:void 0,t_role_skill_tree:void 0,t_role_skill_upgrade_costs:void 0,t_entrance_time:void 0,t_tribeBattle_achieveRewards:void 0,t_peakWar_base:void 0,t_peakWar_daily_rewards:void 0,t_peakWar_highLadder_achieve:void 0,t_horse:void 0,t_horse_handbook:void 0,t_horse_upgrade_costs:void 0,t_horse_upstar_costs:void 0,t_quora:void 0,t_zone_quora:void 0,t_topFarm_farm:void 0,t_topFarm_fruit:void 0,t_topFarm_market:void 0,t_topFarm_collect:void 0,t_topFarm_seed:void 0,t_topFarm_building:void 0,t_topFarm_research:void 0,t_topFarm_research_skill:void 0,t_topFarm_research_skill_reset:void 0,t_module_help:void 0,t_stock:void 0,t_stock_news:void 0,t_suit_attr:void 0,t_raceTower:void 0},c._fileToUnzip=[],c.unzipFinish=!1,c._canShowHeroArtifactBaptizeColor=void 0,c);function c(){}n.Config=e,__reflect(e.prototype,"game.Config")}(game=game||{});var FrameUpdateItem=function(){};__reflect(FrameUpdateItem.prototype,"FrameUpdateItem");var FrameUpdateMgr=function(t){function e(){var e=t.call(this)||this;return e.hasInit=!1,e.frameUpateQueue=new Array,e}return __extends(e,t),e.prototype.frameUpdate=function(e){if(0!=this.frameUpateQueue.length){this.frameUpateQueue=this.frameUpateQueue.filter(function(e){return 0<e.waitFrame});for(var t=0,i=this.frameUpateQueue;t<i.length;t++){var o=i[t];o.waitFrame--,o.waitFrame<=0&&o.cb(o.params)}}},e.prototype.insert=function(e){e.cb&&(null==e.delayFrame&&(e.delayFrame=1),e.waitFrame=e.delayFrame,this.frameUpateQueue.push(e),this.hasInit||(this.hasInit=!0,GameRootLayer.gameLayer().addEventListener(egret.Event.ENTER_FRAME,this.frameUpdate,this)))},e}(BaseClass);__reflect(FrameUpdateMgr.prototype,"FrameUpdateMgr"),function(i){var o,e=(__extends(t,o=BaseClass),t.getInstance=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o.getInstance.apply(this,e)},t.prototype.connectLoginSev=function(t,i){egret.log("connectLoginSev"),egret.log(t),egret.log(i);var e=0;Utils.Socket.isConnecting()&&(Utils.Socket.close(),e=200),egret.setTimeout(function(){var e="ws://";Http.isHttps()&&(e="wss://"),Utils.agentConfig.jsPb?Utils.Socket.initServer(t,i,"/ws",e,new ByteArrayMsgByJSProtobuf):Utils.Socket.initServer(t,i,"/ws",e,new ByteArrayMsgByProtobuf),Utils.Socket.connect()},this,e)},t.prototype.connectGameSev=function(t){egret.log("connectGameSev"),egret.log(t);var e=0;Utils.Socket.isConnecting()&&(Utils.Socket.close(),e=200),egret.setTimeout(function(){var e="ws://";Http.isHttps()&&(e="wss://"),Utils.agentConfig.jsPb?Utils.Socket.initServer(t,"","/ws",e,new ByteArrayMsgByJSProtobuf):Utils.Socket.initServer(t,"","/ws",e,new ByteArrayMsgByProtobuf),Utils.Socket.connect()},this,e)},t.prototype.updateTimeDValue=function(e){var t=new Date,i=Math.ceil(t.getTime()/1e3);this.timeDvalue=e-i;var o=t.getTimezoneOffset();this.timeZoneOffset=-480!=o?60*(480+o):0,this.pingSche||this.startPingSche(),this.checkPassDay()},t.prototype.checkPassDay=function(){var e=new Date(1e3*this.serverTime());void 0===this.curDay?this.curDay=e.getHours():this.curDay!=e.getHours()&&(egret.log("触发跨天检查"),egret.log("this.curDay ",this.curDay),egret.log("data.getHours() ",e.getHours()),this.curDay=e.getHours(),Utils.TimerManager.checkEntranceTime())},t.prototype.stopPingSche=function(){this.pingSche&&(clearInterval(this.pingSche),this.pingSche=void 0),this.pingTimeOutSche&&(egret.clearInterval(this.pingTimeOutSche),this.pingTimeOutSche=void 0)},t.prototype.pingTimeoutFunc=function(){Utils.Socket.intervalUpdate(1e3),NoticeManager.intervalUpdate(1e3),Utils.TimerManager.checkEntranceTime()},t.prototype.startPingSche=function(){var t=this;this.pingSche||(this.pingSche=setInterval(function(){Utils.Socket.send("loginGame","Ping",{}).then(function(e){t.updateTimeDValue(e.sysDt)}).catch(function(){}),t.totalTime+=15e3,i.AppFacade.getInstance().sendNotification(CN.GAME_HEARTBEAT,{totalTime:t.totalTime})},15e3,this)),this.pingTimeOutSche||(Utils.TimerManager.updateEntranceTimeList(),this.pingTimeOutSche=egret.setInterval(this.pingTimeoutFunc,this,1e3))},t.prototype.restart=function(){Utils.SDKMgr.restart()},t.prototype.GetServerInfo=function(){Utils.Socket.send("loginGame","GetServerInfo",{}).then(function(e){i.GameMVC.loginPy.loginGameVO.updateInGame(e)})},t.prototype.switchNetChecking=function(e){this.netCheckingPanel&&this.netCheckingPanel.isForceStop||(e?this.netCheckingPanel?(this.netCheckingPanel.visible=!0,this.netCheckingPanel.onResume()):(this.netCheckingPanel=new i.NetCheckingPanel,GameRootLayer.gameLayer().maskLayer.addChild(this.netCheckingPanel)):this.netCheckingPanel&&(this.netCheckingPanel.onPause(),this.netCheckingPanel.visible=!1))},t.prototype.serverTime=function(e){void 0===e&&(e=!0);var t=Math.ceil(Date.now()/1e3);return e?t+this.timeDvalue:t+this.timeDvalue+this.timeZoneOffset},t.prototype.getOnLineTime=function(){var e=i.AppFacade.getInstance().retrieveProxy(i.LoginPy.N).loginGameVO.sysDt;return this.serverTime()-e},t.prototype.showCommonTipsWin=function(e){i.AppFacade.getInstance().showSubView(i.CommonMediator.N,i.CommonMediator.SV.TIPS_DIALOG,e)},t.prototype.showActionBuyCostWin=function(e){PopUpManager.addPopUp({obj:new i.CommonActionBuyTipsDialog(e)})},t.prototype.CommonGpAddReward=function(i,o,n){if(void 0===n&&(n=.8),i&&o)if("string"==typeof o)o=JSON.parse(o),this.CommonGpAddReward(i,o,n);else if(Array.isArray(o))o.forEach(function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=n,Array.isArray(e)?t.updateData({reward:e}):t.updateData(e),i.addChild(t)});else{function e(t){var e=o[t];Array.isArray(e)&&e.forEach(function(e){switch(t){case"rewards":a.push(e);break;case"heros":a.push({uuid:e.uuid,type:EEntityType.EEntityTypeHero});break;case"vestageHeros":a.push({uuid:e.uuid,type:EEntityType.EEntityTypeVestageHero});break;case"heroEquips":a.push({code:e.code,type:EEntityType.EEntityTypeHeroEquip,num:e.num});break;case"heroArtifacts":a.push({code:e.code,type:EEntityType.EEntityTypeHeroArtifact,num:e.num});break;case"maps":a.push({uuid:e.uuid,type:EEntityType.EEntityTypeMap})}})}var a=[];for(var t in o)e(t);this.CommonGpAddReward(i,a,n)}},t.prototype.resetPerformance=function(){dragonBones.EgretFactory.skipFrame=0,Utils.LocalStorageUtil.removeItem("SETTING_PERFORMANCE_MODEL_SKIP_FRAME",!0),GameRootLayer.gameLayer().stage.frameRate=Utils.MathUtils.isNumber(Utils.SDKMgr.getPerformConfig(11))?Number(Utils.SDKMgr.getPerformConfig(11)):30,Utils.LocalStorageUtil.removeItem("SETTING_PERFORMANCE_FPS",!0)},t.prototype.loadPerformance=function(){var e=Utils.LocalStorageUtil.getItem("SETTING_PERFORMANCE_MODEL_SKIP_FRAME",!0);Number(e)&&(dragonBones.EgretFactory.skipFrame=Number(e));var t=Utils.LocalStorageUtil.getItem("SETTING_PERFORMANCE_FPS",!0);Number(t)&&(GameRootLayer.gameLayer().stage.frameRate=Number(t))},t);function t(){var e=o.call(this)||this;return e.timeDvalue=0,e.timeZoneOffset=0,e.totalTime=0,e.pingScheTime=10,e.curDay=void 0,window.showCommonTipsWin=e.showCommonTipsWin,e}i.GameMgr=e,__reflect(e.prototype,"game.GameMgr")}(game=game||{}),function(r){var e=(s.getFrameByColor=function(e){return COLOR_2_FRAME[e]},s.getColorByColor=function(e){return COLOR_2_FONT_COLOR[e]},s.getNameByColor=function(e){switch(e){case EColorType.EColorTypeWhite:return"白色";case EColorType.EColorTypeGreen:return"绿色";case EColorType.EColorTypeBlue:return"蓝色";case EColorType.EColorTypePurple:return"紫色";case EColorType.EColorTypeOrange:return"橙色";case EColorType.EColorTypeRed:return"红色";default:return e.toString()}},s.getAttrName=function(e){return 2e3<e&&(e%=2e3),AttrConfig[e]&&AttrConfig[e].name||"key error"},s.getAttrIcon=function(e){return 2e3<e&&(e%=2e3),AttrConfig[e]&&AttrConfig[e].icon||""},s.getAttrValueWithData=function(e,t,i){if(void 0===t&&(t=1),void 0===i&&(i=0),e<=0)return[0,0];if(1e5<=e){var o=0,n=Math.floor(e%1e5);return o=n<=5e4?n/1e3:-(n-5e4)/1e3,[Math.floor(e/1e5)*(o+1)*t+i,0]}if(e<=5e4){var a=e*t/10+i;return[a=Math.floor(100*a)/100,1]}return[-(e-5e4)*t/10+i,1]},s.getAttrValue=function(e,t,i,o){if(void 0===t&&(t=1),void 0===i&&(i=0),void 0===o&&(o=!1),!e||e<=0)return"0";if(1e5<=e){var n=0,a=Math.floor(e%1e5);return n=a<=5e4?a/1e3:-(a-5e4)/1e3,o?(Math.floor(e/1e5)/10+i).toString():(Math.floor(e/1e5)/10*(n+1)*t+i).toString()}return e<=5e4?(e*t/10+i).toString()+"%":"-"+((e-5e4)*t/10+i).toString()+"%"},s.getImageByTypeCode=function(e,t){for(var i=0,o=r.Config.propertyConfig();i<o.length;i++){var n=o[i];if(n.type==e&&n.code==t)return n.icon+"_png"}return egret.log("Invalid type and code."),null},s.getHeroStarInfo=function(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=!1);var o={src:"",num:0,stage:0};return t?e<6?(o.src=i?"_border_m_json.common_icon_xingji6":"_border_m_json.common_icon_xingji",o.stage=1,o.num=e):e<10?(o.src=i?"_border_m_json.common_icon_xingji7":"_border_m_json.common_icon_xingji2",o.stage=2,o.num=e-5):e<11?(o.src=i?"_border_m_json.common_icon_xingji8":"_border_m_json.common_icon_xingji3",o.stage=3,o.num=e-9):(o.src=i?"_border_m_json.common_icon_xingji9":"_border_m_json.common_icon_xingji4",o.stage=4,o.num=e-10):(o.stage=Math.ceil(e/5),o.num=(e-1)%5+1,o.src="_border_m_json.common_icon_xingji"+(1==o.stage?"":o.stage.toString())),o},s.getEntityConfigByCode=function(e,t){if(t){null==e&&(e=Math.floor(Number(t)/1e7)),e=e||EEntityType.EEntityTypeMoney;var i=void 0;if(Number(t))switch(e){case EEntityType.EEntityTypeItem:i=r.Config.itemConfig()[t];break;case EEntityType.EEntityTypeVestageItem:i=r.Config.vestageItemConfig()[t];break;case EEntityType.EEntityTypeVestageHero:case EEntityType.EEntityTypeHero:i=r.Config.allHeroConfig()[t];break;case EEntityType.EEntityTypeHeroEquip:i=r.Config.getHeroEquipConfig()[t];break;case EEntityType.EEntityTypePet:i=r.Config.allPetConfig()[t];break;case EEntityType.EEntityTypeTreasure:i=r.Config.getHeroTreasureConfig()[t];break;case EEntityType.EEntityTypeHeroArtifact:i=r.Config.getHeroArtifactConfig()[t];break;case EEntityType.EEntityTypeMap:i=r.Config.getRiskMapByCode(t);break;case EEntityType.EEntityTypeExp:case EEntityType.EEntityTypeMoney:for(var o=0,n=r.Config.propertyConfig();o<n.length;o++){var a=n[o];if(a.type===e&&a.code===t)return a}return egret.log("error 配置不存在 t_property_color",t),{color:6,icon:"role_img_buzhengwenhao",name:" 配置不存在 t_property_color code:"+t,shortDesc:"",desc:""};default:return egret.log("error 配置不存在 t_property_color",t),{color:6,icon:"role_img_buzhengwenhao",name:" 配置不存在 t_property_color code:"+t,shortDesc:"",desc:""}}return i}},s.ObjAttr2Arr=function(e){"string"==typeof e&&(e=JSON.parse(e));var t=[];for(var i in e){var o=e[i];t.push([i,o])}return t},s.ArrAttr2Obj=function(e){var t={};for(var i in e){var o=e[i];t[o[0]]=o[1]}return t},s.superAttrAddAttr=function(e,t){return function(e,t){var i=[],o=[];for(var n in e)0==(a=s.getAttrValueWithData(e[n][1]))[1]?a[0]=1e5*Math.floor(a[0]):a[0]=e[n][1],i.push([e[n][0],a[0]]);for(var n in t){var a;0==(a=s.getAttrValueWithData(t[n][1]))[1]?a[0]=1e5*Math.floor(a[0]):a[0]=t[n][1],o.push([t[n][0],a[0]])}return s.AttrAddAttr(i,o)}(e,t)},s.AttrAddAttr=function(e,t){var i={};for(var o in e)i[(a=e[o])[0]]=parseInt(a[1]);for(var o in t)i[(a=t[o])[0]]?i[a[0]]+=parseInt(a[1]):i[a[0]]=parseInt(a[1]);var n=[];for(var o in i){var a=i[o];n.push([parseInt(o),a])}return n},s.AttrMutilAttr=function(e,n){var a=[];return"number"==typeof n?e.forEach(function(e,t){1e5<=e[1]?a.push([e[0],1e5*Math.floor(e[1]*n/1e5)]):a.push([e[0],Math.floor(e[1]*n)])}):"object"==typeof n&&e.forEach(function(i){var o=!1;n.forEach(function(e,t){i[0]==e[0]&&(a.push([i[0],Math.floor(i[1]*(e[1]/1e3+1))]),o=!0)}),o||a.push(i)}),a},s.getHeroJingyingTag=function(e){var t=void 0;if(e instanceof r.HeroVO)0==e.config.tier?t=0:e.config.tier<3?t=1:e.config.tier<5&&(t=2);else{var i=r.Config.allHeroConfig()[e].tier;0==i?t=0:i<3?t=1:i<5&&(t=2)}if(null!=t&&HERO_TIER_IMG_TAG[t])return HERO_TIER_IMG_TAG[t]},s.getTagByColor=function(e){return 7<=e?"_hero_ar_m_json.common_img_shishi":6<=e?"_hero_ar_m_json.common_img_chuanshuo":5<=e?"_hero_ar_m_json.common_img_jingying":"_hero_ar_m_json.common_img_xiyou"},s.getGuajiImg=function(e){if(s.guajiImgConfig[e])return s.guajiImgConfig[e];try{var t="";RES.hasRes(e+"_png")&&(t=e+"_png"),!t&&RES.hasRes("_event_m_json."+e)&&(t="_event_m_json."+e);for(var i=1;i<=6&&!t;i++)RES.hasRes("_dk_0"+i+"_m_json."+e)&&(t="_dk_0"+i+"_m_json."+e);return!t&&RES.hasRes("_guaji_m_json."+e)&&(t="_guaji_m_json."+e),!t&&RES.hasRes("_main_m_json."+e)&&(t="_main_m_json."+e),t?(s.guajiImgConfig[e]=[1,t],[1,t]):(s.guajiImgConfig[t=e]=[2,t],[2,t])}catch(e){console.log(e)}},s.numToChinesNum=function(e){for(var t=["零","一","二","三","四","五","六","七","八","九"],i=["","十","百","千"],o="",n="",a=0,r=!0,s=e;0<e;){var c=e%10;0==c?r||(r=!0,n=t[c]+n):(r=!1,o=t[c],n=(o+=i[a])+n),a++,e=Math.floor(e/10)}return 9<s&&s<20&&(n=n.replace("一","")),n},s.simpleSort=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return function(e,t){for(var i=n.length,o=0;o<i;o++)if(e[n[o]]!=t[n[o]])return e[n[o]]-t[n[o]];return 0}},s.showItemDetail=function(e){var t=e[0],i=e[1],o=s.getEntityConfigByCode(t,i);switch(t){case EEntityType.EEntityTypeHero:r.AppFacade.getInstance().showSubView(r.HeroMediator.N,r.HeroMediator.SV.HERO_DETAIL,{code:i});break;default:if(t==EEntityType.EEntityTypeHeroEquip||t==EEntityType.EEntityTypeHeroArtifact||t==EEntityType.EEntityTypeTreasure){var n=void 0;switch(t){case EEntityType.EEntityTypeHeroEquip:var a=r.Config.getHeroEquipUpgradeConfig(i);r.Config.getHeroEquipEnchantConfig(i),n={code:i,entityType:t,exp:0,fightCap:0,level:0,level2:0};break;case EEntityType.EEntityTypeHeroArtifact:a=r.Config.getHeroArtifactUpgradeConfig(i),r.Config.getHeroArtifactUpstarConfig(i),n={code:i,entityType:t,exp:0,fightCap:0,level:0,level2:0};break;case EEntityType.EEntityTypeTreasure:(a=r.Config.getTreasureJewelUpgradeConfig(TreasureJewelType.Atk))&&a.length&&a[a.length-1].level}r.AppFacade.getInstance().showSubView(r.HeroThingMediator.N,r.HeroThingMediator.SV.MAIN,{entityType:t,vo:n,config:o,source:r.HeroThingMainView.VIEW_SOURCE.HANDBOOK})}else PopUpManager.addPopUp({obj:new r.BaseItemDetailView({code:i,type:t,config:o})})}},s.classCopy=function(e,t){for(var i in e){var o=e[i];t[i]=o}return t},s.rewardsAdd=function(e,t){var i=[];for(var o in e){var n=e[o];i.push([n[0],n[1],n[2]])}for(var o in t){n=t[o];var a=!1;for(var r in i){var s=i[r];if(n[0]==s[0]&&n[1]==s[1]){a=!0,i[r][2]+=n[2];break}}a||i.push([n[0],n[1],n[2]])}return i},s.fixedSizeWH=50,s.guajiImgConfig={},s);function s(){}r.GeneralConfig=e,__reflect(e.prototype,"game.GeneralConfig")}(game=game||{});var NoticeManager,MicMgr=function(t){function o(){var e=t.call(this)||this;return e.init(),egret.ExternalInterface.addCallback("callJS",e.callJS),e}return __extends(o,t),o.prototype.init=function(){this.getChannelName()},o.prototype.callJS=function(e){if(egret.log("MicMgr",e),e){var t=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N);game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N);try{var i=JSON.parse(e);switch(i.method){case"loginCB":if("FromSwitch"==i.type&&500<=game.GameMVC.playerPy.loginStatusVO.state)return void this.restart();i.login_ext&&(t.userVO.login_ext=i.login_ext),Utils.isNeedUuidSot?t.userVO.uuid=i.game_uin+"_uuidsot"+Utils.TimerManager.getServerTime():t.userVO.uuid=i.game_uin,i.username?t.userVO.username=Utils.Http.checkStrLegal(i.username,!1,""):t.userVO.username=t.userVO.uuid,t.userVO.verify_token=i.verify_token,t.userVO.login_ext&&t.userVO.login_ext.isCheckingRecharge&&(Utils.agentConfig.isChecking.Recharge=t.userVO.login_ext.isCheckingRecharge),Utils.agentConfig.other&&Utils.agentConfig.other.openRedBagAct&&(egret.log("openRedBagAct enter"),window.xyxPlatform={_pid:t.userVO.login_ext.pid,_gid:t.userVO.login_ext.gid,_mid:t.userVO.login_ext.mid},getUrlKV().token=t.userVO.verify_token),o._platform_nodeTable={action:"record_login_info",platform:Utils.agentConfig.AgentCode,sub_platform:"",username:t.userVO.uuid,os_code:Utils.DeviceUtils.getPlatform(),user_agent:window.navigator.userAgent,browser_id:Utils.DeviceUtils.getBrowser()},t.goHttpLogin();break;case"buyCB":0===i.payResult?Utils.MsgUtils.addMidMsg("购买成功，请稍后查收邮件"):i.payResultMsg&&""!=i.payResultMsg&&Utils.MsgUtils.addMidMsg(i.payResultMsg);break;case"onGoLogout":case"onGoSwitchUser":egret.setTimeout(function(){window.location.reload()},this,2e3);break;case"getChannelName":egret.log("getChannelName has set",Utils.agentConfig.channelName,i.channelName),Utils.agentConfig.channelName&&""!=Utils.agentConfig.channelName||(Utils.agentConfig.channelName=i.channelName||"");break;case"setStatusBar":getUrlKV().statusBarHeight=Number(i.statusBarHeight),egret.log("getUrlKV()['statusBarHeight'] ",getUrlKV().statusBarHeight)}}catch(e){egret.log("MicMgr exception",e)}}},o.prototype.goSwitchAccount=function(){var e=this,t=JSON.stringify({method:"goSwitchUser"});egret.setTimeout(function(){egret.ExternalInterface.call("callNative",t),e.restart()},this,750)},o.prototype.onLoginPHPSuccess=function(){},o.prototype.showLoadingTips=function(e,t){},o.prototype.dismissLoading=function(){},o.prototype.goLogin=function(){if(1<=game.GameMVC.playerPy.loginStatusVO.state)this.goSwitchAccount();else{var e=JSON.stringify({method:"goLogin"});egret.setTimeout(function(){egret.ExternalInterface.call("callNative",e)},this,750)}},o.prototype.invokeLog=function(e){e.method="invokeLog",egret.ExternalInterface.call("callNative",JSON.stringify(e))},o.prototype.goPurchase=function(e){var t=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N),i=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N),o=(game.AppFacade.getInstance().retrieveProxy(game.GuildPy.N),JSON.stringify({method:"goPurchase",itemId:e.itemId,itemSDKId:e.itemSDKId,itemPrice:e.money,count:e.count||1,orderId:e.serialNumber,itemOriginPrice:e.originMoney||e.money,itemName:e.goodsName,itemDesc:e.goodsDesc||e.goodsName,reserved:e.ext,playerId:i.playerInfoVO.playerId,name:i.playerInfoVO.name,serverId:t.serverSelect.s_id,serverName:t.serverSelect.s_name,rate:10,thirdApplePay:"guoer",uuid:t.userVO.uuid,level:i.playerInfoVO.level}));egret.setTimeout(function(){egret.ExternalInterface.call("callNative",o)},this,500)},o.prototype.restart=function(){egret.log("restart enter"),Utils.Socket.close(),Utils.SoundManager.stopAll(),egret.setTimeout(function(){if(egret.log("restarting"),Utils.SDKMgr.getPerformConfig(43)){var e=JSON.stringify({method:"restart"});egret.ExternalInterface.call("callNative",e)}else window.location.reload()},this,500)},o.prototype.cmd=function(e,t){var i=JSON.stringify({method:"executeCommand",params:e});egret.ExternalInterface.call("callNative",i)},o.prototype.copyToClipBoard=function(e,t){egret.log("copyToClipBoard enter");var i=JSON.stringify({method:"copyToClipBoard",str:e});egret.setTimeout(function(){egret.log("copyToClipBoarding"),egret.ExternalInterface.call("callNative",i)},this,500),t&&egret.setTimeout(function(){t()},this,1e3)},o.prototype.nodeRecord=function(e){if(this.needNodeRecrod)if(egret.log("======nodeRecord",e),-1==e||o._platform_nodeTable){if(!o._platform_nodeTable){var t=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N);o._platform_nodeTable={action:"record_login_info",platform:Utils.agentConfig.AgentCode,sub_platform:Utils.agentConfig.channelName,username:t.userVO.uuid,node:e,os_code:Utils.DeviceUtils.getPlatform(),user_agent:window.navigator.userAgent,browser_id:Utils.DeviceUtils.getBrowser()}}if(!o._platform_nodeTable.username){t=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N);o._platform_nodeTable.username=t.userVO.uuid}o._platform_nodeTable.sub_platform=Utils.agentConfig.channelName,o._platform_nodeTable.node=e,Utils.Http.toGet(o._platform_nodeTable)}else egret.log("还没初始化")},o.prototype.getChannelName=function(){egret.log("getChannelName");var e=JSON.stringify({method:"getChannelName"});egret.ExternalInterface.call("callNative",e)},o.prototype.share=function(e,t){},o.prototype.addShortcut=function(e,t){},o.prototype.enterFlow=function(e,t){var i=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N),o=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N),n=game.AppFacade.getInstance().retrieveProxy(game.GuildPy.N),a={serverId:i.serverSelect&&i.serverSelect.s_id,serverName:i.serverSelect&&i.serverSelect.s_name,severArea:i.serverSelect&&i.serverSelect.area,playerName:o.playerInfoVO.name||o.roleVo.name,roleId:o.playerInfoVO.playerId||o.roleVo.playerId,roleCreateDt:o.playerInfoVO.createDt||o.roleVo.createDt,time:Utils.TimerManager.getServerTime(),money:o.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeDiamond]||0,level:o.playerInfoVO.level||0,vipLevel:o.playerInfoVO.playerVip.vipLevel||0,fightCap:o.playerInfoVO.fightCap||0,camp:o.playerInfoVO.camp&&1==o.playerInfoVO.camp?"male":"famale",guildId:n.guildDetail?n.guildDetail.guildId:"",guildName:n.guildDetail?n.guildDetail.name:"",params:t,type:""};a.type=e,this.invokeLog(a)},o.prototype.onCustomError=function(e){},o}(SDKMgr);__reflect(MicMgr.prototype,"MicMgr",["ISDKInterface"]),function(n){var r={},a=1e3,s=[],c={};function l(e,t){if(void 0===t&&(t=!1),null!=r[e]){if(t)for(var i in t=!1,r[e].childType)if(n.isNoticeShow(r[e].childType[i])){t=!0;break}if(!t)for(var i in r[e].show=!1,r[e].notic&&r[e].notic.parent&&(r[e].notic.visible=h(e)),r[e].parentType)l(r[e].parentType[i],!0)}}function h(e){return null!=r[e]&&(r[e].show&&(null==r[e].unlockId||Utils.UnlockMgr.checkPass(r[e].unlockId).allow))}n.intervalUpdate=function(e){if(0!=s.length&&(a-=e)<=0){function t(t){function e(i){Array.isArray(t[i])&&t[i].forEach(function(e){var t=NT.LOCAL_RES_UPDATE_SENSITIVE_EVENT[i].sub[e];t&&(t.mediators.forEach(function(e){o[e]=!0}),t.cb&&t.cb())});var e=NT.LOCAL_RES_UPDATE_SENSITIVE_EVENT[i];e&&e.mediators&&e.mediators.forEach(function(e){o[e]=!0}),e&&e.cb&&e.cb()}for(var i=Object.keys(t),o={},n=0,a=i;n<a.length;n++){e(r=a[n])}game.AppFacade.getInstance();for(var r in o)game.AppFacade.getInstance().retrieveMediator(r).handleNotice(t)}for(var i=0,o=s;i<o.length;i++){t(o[i])}s.splice(0)}},n.addCareCost=function(e,t){try{for(var i in"string"==typeof e&&(e=JSON.parse(e)),e){var o=e[i];if(o[0]==EEntityType.EEntityTypeItem)NT.LOCAL_RES_UPDATE_SENSITIVE_EVENT[EEntityType.EEntityTypeItem].sub[o[1]]||(NT.LOCAL_RES_UPDATE_SENSITIVE_EVENT[EEntityType.EEntityTypeItem].sub[o[1]]={cb:t,mediators:[]})}}catch(e){console.log(e)}},n.localResUpdate=function(e){s.push(e),a=1e3},n.redp=function(e,t,i){if(void 0===t&&(t=!1),e&&e.parent){var o="NoticeManager_RED_POINT_NAME"+e.hashCode,n=e.parent.getChildByName(o);if(t){if(!n){var a=new eui.Image;a.touchEnabled=!1,a.source="_main_m_json.common_img_hongdian",a.scaleX=a.scaleY=.8,a.name=o,i?(a.x=i.x?i.x+e.x:e.x,a.y=i.y?i.y+e.y:e.y):(a.x=e.x,a.y=e.y),e.parent.addChild(a)}}else n&&e.parent.removeChild(n)}},n.addNoticeListener=function(e,t,i,o){if(t&&e&&t.parent)if(r[e]&&r[e].notic&&r[e].notic.parent&&r[e].notic.parent==t.parent)egret.log("noticeType has registered,can not register again ",e);else{if(null==r[e]&&(r[e]={notic:void 0,parentType:[],childType:{},show:!1}),null==r[e].notic){var n=new eui.Image;n.touchEnabled=!1,RES.getResAsync("_main_m_json.common_img_hongdian",function(e){n.source=e,n.scaleX=n.scaleY=.8},this),r[e].notic=n}else r[e].notic.parent&&r[e].notic.parent.removeChild(r[e].notic);var a=r[e].notic;r[e].show;o?(void 0===o.percentX?a.x=t.x:a.x=t.parent.width*o.percentX,void 0===o.percentY?a.y=t.y:a.y=t.parent.height*o.percentY,o.unlockId&&(r[e].unlockId=o.unlockId)):(a.x=t.x,a.y=t.y),a.visible=h(e),t.parent.addChild(a),o&&!o.noCleanAfterRemove&&t.parent.once(egret.Event.REMOVED_FROM_STAGE,function(){t&&t.parent&&t.parent.contains(a)&&t.parent.removeChild(a)}),(r[e].view=i).registerNotices.indexOf(e)<0&&i.registerNotices.push(e)}else egret.log("obj||noticeType||obj.parent is undefined")},n.addNoticeListenerAtParent=function(e,t,i,o){n.addNoticeListener(e,t.$children[0],i,o)},n.setChildType=function(o,e){null==r[o]&&(r[o]={notic:void 0,parentType:[],childType:{},show:!1}),Array.isArray(e)||(e=[e]),e.forEach(function(e,t,i){null!=e&&(r[o].childType[e]=e,null==r[e]&&(r[e]={notic:void 0,parentType:[],childType:{},show:!1}),r[e].parentType.push(o))})},n.isNoticeShow=h,n.removeNoticeListener=function(e){r[e]&&r[e].notic&&(r[e].notic.parent&&r[e].notic.parent.removeChild(r[e].notic),r[e].notic=void 0,r[e].view=void 0)},n.registerCB=function(e,t,i,o){var n;for(var a in n="number"==typeof e?[e]:e){var r=n[a];c[r]={cb:t,thisObj:i,unlockModule:o}}},n.removeCB=function(e){c[e]=void 0},n.updateNotice=function n(e,a,t){if(void 0===t&&(t=!1),e){var i=e;"number"==typeof e&&(i=[e]),Utils.agentConfig.isChecking&&Utils.agentConfig.isChecking.closeNotice?i.forEach(function(e){l(e)}):i.forEach(function(e){if(function(e){return!(c[e]&&c[e].unlockModule&&!Utils.UnlockMgr.checkPass(c[e].unlockModule,!1).allow)||(console.log("红点未解锁 模块：",c[e].unlockModule),!1)}(e)&&c[e]&&(c[e].cb.call(c[e].thisObj,a)?function e(t){for(var i in null==r[t]?r[t]={notic:void 0,parentType:[],childType:{},show:!0}:(r[t].show=!0,r[t].notic&&r[t].notic.parent&&(r[t].notic.visible=h(t))),r[t].parentType)e(r[t].parentType[i])}(e):l(e)),r[e]){var t=[];for(var i in r[e].childType){var o=r[e].childType[i];t.push(o)}0<t.length&&n(t,a,!0)}})}}}(NoticeManager=NoticeManager||{});var PopUpManager,ObjectPoolMgr=function(t){function e(){var e=t.call(this)||this;return window._content||(window._content=e),e._content={},e._objs=new Array,e}return __extends(e,t),e.prototype.clearAll=function(){for(var e in this._content)this.clearClass(e);this._content={}},e.prototype.pop=function(e,t){var i;this._content[e]||(this._content[e]=[]);var o=this._content[e];return o.length?(i=o.pop()).onOPComeBack(t,!1):((i=new(egret.getDefinitionByName(e))).ObjectPoolKey=e,i.onOPComeBack(t,!0)),i},e.prototype.push=function(e){if(!e)return!1;var t=e.ObjectPoolKey;return!!t&&(!!this._content[t]&&(e.onOPReset(),this._content[t].push(e),!0))},e.prototype.clearClass=function(e,t){void 0===t&&(t=null);for(var i=this._content[e];i&&i.length;){var o=i.pop();o.onOPClean(),o=null}this._content[e]=null,delete this._content[e]},e.prototype.dealFunc=function(e,t){var i=this._content[e];if(null!=i)for(var o=0,n=i.length;o<n;o++)i[o][t]()},e.prototype.check=function(e){this.dealFunc(e,"onOPCheck")},e}(BaseClass);__reflect(ObjectPoolMgr.prototype,"ObjectPoolMgr"),function(h){var p,d,i=new Array;function u(e){var t=this;e?(p.touchEnabled=!0,p.visible=!0,GameRootLayer.gameLayer().panelLayer.setChildIndex(p,-1),egret.Tween.removeTweens(p),0==p.alpha&&egret.Tween.get(p).to({alpha:1},UIActionManager.POP_ACTION_SPEED/4)):(p.alpha=1,egret.Tween.removeTweens(p),egret.Tween.get(p).to({alpha:0},UIActionManager.POP_ACTION_SPEED/4).call(function(){p.touchEnabled=!1,p.visible=!1,egret.setTimeout(function(){0<i.length&&h.addPopUp(i.shift())},t,250)}))}function n(){var e=GameRootLayer.gameLayer().panelLayer.$children.length;if(0<e){var t=GameRootLayer.gameLayer().panelLayer.$children[e-1];for(var i in h.popUpViewQueue)for(var o=0,n=h.popUpViewQueue[i];o<n.length;o++){var a=n[o];if(a.obj===t){a.onDarkClick&&a.onDarkClick()||r(t);break}}}}function r(l,e,t){void 0===e&&(e=0),!l.hasEventListener(egret.Event.REMOVED_FROM_STAGE)&&l.onDestroy&&l.onDestroy();!e&&l.removeActionType&&(e=l.removeActionType()),l.enabled=!1,UIActionManager.playUIAction(l,e,function(){GameRootLayer.gameLayer().panelLayer.contains(l)&&(GameRootLayer.gameLayer().panelLayer.removeChild(l),GameRootLayer.gameLayer().onPopStatusUpdate(l.name,!0)),function(){for(var e in h.popUpViewQueue)for(var t=0,i=0,o=h.popUpViewQueue[e];i<o.length;i++){if((c=o[i]).obj===l){h.popUpViewQueue[e].splice(t,1),c.closeCB&&c.closeCB(l.opperationParams);break}t++}game.AppFacade.getInstance().sendNotification(CN.CHANGE_PANEL,{isRemove:!0}),l.checkForGuide&&game.AppFacade.getInstance().sendNotification(CN.GUIDE_VIEW_STACK_CHANGE);var n=GameRootLayer.gameLayer().panelLayer.$children.length;if(n<=1&&p.visible)u(!1);else if(2<=n){GameRootLayer.gameLayer().panelLayer.setChildIndex(p,GameRootLayer.gameLayer().panelLayer.$children.length-2);var a=GameRootLayer.gameLayer().panelLayer.getChildAt(GameRootLayer.gameLayer().panelLayer.$children.length-1);for(var e in h.popUpViewQueue)for(var r=0,s=h.popUpViewQueue[e];r<s.length;r++){var c;if((c=s[r]).obj===a){p.visible!=c.dark&&u(c.dark),c.dark&&(d=c.clickDarkClose);break}}}}()},this,!0)}h.popUpViewQueue={default:new Array},h.addPopUpQueue=function(e){1==GameRootLayer.gameLayer().panelLayer.numChildren?h.addPopUp(e):i.push(e)},h.addPopUp=function(e){var t=e.obj,i=!0;null!=e.dark&&(i=e.dark);var o=1;null!=e.effectType&&(o=e.effectType),GameRootLayer.gameLayer().panelLayer.contains(t)||(p||((p=new eui.Image).source="common_bg_toumingdi_png",p.width=Utils.DeviceUtils.curWidth(),p.height=Utils.DeviceUtils.curHeight(),p.alpha=0,GameRootLayer.gameLayer().panelLayer.contains(p)||GameRootLayer.gameLayer().panelLayer.addChild(p),p.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0!=d&&n()},this)),u(i),GameRootLayer.gameLayer().panelLayer.addChild(t),GameRootLayer.gameLayer().onPopStatusUpdate(t.name),t.parent&&t.parent.validateNow(),t.alpha=1,h.popUpViewQueue.default.push({exml:t.skinName,obj:t,dark:i,clickDarkClose:e.clickDarkClose,onDarkClick:e.onDarkClick,closeCB:e.closeCB,context:e.context}),d=!1,t.enabled=!1,game.AppFacade.getInstance().sendNotification(CN.CHANGE_PANEL),UIActionManager.playUIAction(t,o,function(){t.enabled=!0,d=e.clickDarkClose,t.checkForGuide&&game.AppFacade.getInstance().sendNotification(CN.GUIDE_VIEW_STACK_CHANGE,{})}))},h.onDarkClick=n,h.removePopUp=r,h.clearViewQueue=function(e,t){void 0===e&&(e=void 0),void 0===t&&(t="default");var i=h.popUpViewQueue[t];if(e)for(var o=i.length-1;0<=o&&(i[o]!=e&&!i[o]);o--)GameRootLayer.gameLayer().panelLayer.contains(i[o].obj)&&GameRootLayer.gameLayer().panelLayer.removeChild(i[o].obj);else for(o=i.length-1;0<=o;o--)GameRootLayer.gameLayer().panelLayer.contains(i[o].obj)&&h.removePopUp(i[o].obj)}}(PopUpManager=PopUpManager||{}),window.PopUpManager=PopUpManager,function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.inButton();var e=new eui.HorizontalLayout;e.horizontalAlign=egret.HorizontalAlign.CENTER,this.gp_enermy.layout=e,this.updateView(this.params)},o.prototype.inButton=function(){var e=this;this.challge_bnt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.params&&(e.hide(),e.params.challengeCB&&e.params.challengeCB())},this),this.btn_rank.visible=!1,this.btn_reward.visible=!1,this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.AppFacade.getInstance().showSubView(t.HeroMediator.N,t.HeroMediator.SV.FORMATION)},this)},o.prototype.updateView=function(e){var i=this;e&&(this.gp_reward_show.removeChildren(),t.GameMVC.activityMed.CommonGpAddReward(this.gp_reward_show,e.rewards),e.enermys&&e.enermys.forEach(function(e){if(null!=e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e}),t.scaleX=t.scaleY=.7,i.gp_enermy.addChild(t)}}))},o);function o(e){var t=i.call(this)||this;return t.skinName="ChallengeViewSkin",t.xtck_tck.img_title_bg.visible=!1,t.params=e,t}t.ChallengeView=e,__reflect(e.prototype,"game.ChallengeView")}(game=game||{});var SoundManager=function(t){function e(){var e=t.call(this)||this;return e._nowBg="",e._nowDelayBg="",e._enableBG=!1,e._enableEff=!1,e._durTDic={},e._soundDic={},e.isPreloadEffect=!1,e}return __extends(e,t),e.prototype.init=function(){"1"==Utils.LocalStorageUtil.getItem("SOUND_INIT",!0)?(this._enableBG="1"==Utils.LocalStorageUtil.getItem("SOUND_BG_ENABLE",!0),this._enableEff="1"==Utils.LocalStorageUtil.getItem("SOUND_EFF_ENABLE",!0)):(Utils.LocalStorageUtil.setItem("SOUND_INIT","1",!0),Utils.LocalStorageUtil.setItem("SOUND_BG_ENABLE","1",!0),Utils.LocalStorageUtil.setItem("SOUND_EFF_ENABLE","1",!0),this._enableBG=!0,this._enableEff=!0)},e.prototype.preloadEffect=function(){var e=new Array,t=0;for(var i in SOUND_EFF_TYPE)e[t]=SOUND_EFF_TYPE[i],t++;RES.createGroup("preloadEffect",e,!0),RES.loadGroup("preloadEffect"),this.isPreloadEffect=!0},Object.defineProperty(e.prototype,"enableBG",{get:function(){return this._enableBG},set:function(e){this._enableBG!=e&&(this._enableBG=e,this._enableBG?this.resumeBg():this.stopBg(),Utils.LocalStorageUtil.setItem("SOUND_BG_ENABLE",e?"1":"0",!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enableEff",{get:function(){return this._enableEff},set:function(e){this._enableEff!=e&&(this._enableEff=e,Utils.LocalStorageUtil.setItem("SOUND_EFF_ENABLE",e?"1":"0",!0))},enumerable:!0,configurable:!0}),e.prototype.activateHandler=function(){this._enableBG&&this.switchBGMVolume(.5)},e.prototype.deactivateHandler=function(){this._enableBG&&this.switchBGMVolume(0)},e.prototype.bindStage=function(){GameRootLayer.gameLayer().stage&&(GameRootLayer.gameLayer().stage.addEventListener(egret.Event.ACTIVATE,this.activateHandler,this),GameRootLayer.gameLayer().stage.addEventListener(egret.Event.DEACTIVATE,this.deactivateHandler,this),this.isBindEvent=!0)},e.prototype.switchBGMVolume=function(e,t){this._bgC&&(egret.Tween.removeTweens(this._bgC),0==e?(this._bgC.volume=e,t&&t()):egret.Tween.get(this._bgC).to({volume:e},3e3).call(function(){t&&t()},this)),this._bgDelayC&&(0==e?this._bgDelayC.stop():this.playDelayBg(),t&&t())},e.prototype.resumeDelayBg=function(){if(this._enableBG){if(!this._bgDelayC){var e=RES.getRes(this._nowDelayBg);if(!e)return void this.playDelayBg();if(e.type=egret.Sound.MUSIC,this._bgDelayC=e.play(0,1),null==this._bgDelayC)return}egret.clearTimeout(this.downTime),this._bgDelayC.volume=.5,this._bgDelayC.addEventListener(egret.Event.SOUND_COMPLETE,function(e){this.downTime=egret.setTimeout(function(){var e=this._nowDelayBg;this._nowDelayBg="",this.playDelayBg(e)},this,2e4)},this)}},e.prototype.resumeBg=function(){if(this._enableBG){if(!this._bgC){var e=RES.getRes(this._nowBg);if(!e)return void this.playDelayBg();if(e.type=egret.Sound.MUSIC,this._bgC=e.play(),null==this._bgC)return}this._bgC.volume=0,this.switchBGMVolume(.5)}},e.prototype.stopBg=function(e){var t=this;void 0===e&&(e=!0),this._bgC&&(this.curPos=e?0:this._bgC.position,this.switchBGMVolume(0,function(){try{t._bgC.stop()}catch(e){egret.log("SoundManager exception",e)}t._bgC=void 0})),this._bgDelayC&&this.switchBGMVolume(0,function(){try{t._bgDelayC.stop()}catch(e){egret.log("SoundManager exception",e)}t._bgDelayC=void 0}),this._nowDelayBg="",this._nowBg=""},e.prototype.stopAll=function(){for(var e in this._bgC&&(this._bgC.stop(),this._bgC=void 0),this._bgDelayC&&(this._bgDelayC.stop(),this._bgDelayC=void 0),this._soundDic){this._soundDic[e].stop()}for(var e in this._soundDic={},this._durTDic){this._durTDic[e].stop()}this._durTDic={}},e.prototype.playBg=function(e,t){var i=this;void 0===t&&(t=0),this._nowDelayBg="",this.isBindEvent||this.bindStage(),this._enableBG&&this._nowBg!=e&&(this.stopBg(),e&&(this._nowBg=e),RES.getResAsync(this._nowBg,function(e){e&&i.resumeBg()},this))},e.prototype.playDelayBg=function(e){var t=this;this._nowBg="",this.isBindEvent||this.bindStage(),this._enableBG&&this._nowDelayBg!=e&&(this.stopBg(),e&&(this._nowDelayBg=e),egret.clearTimeout(this.upTime),RES.getResAsync(this._nowDelayBg,function(e){e&&(t.upTime=egret.setTimeout(function(){this.resumeDelayBg()},t,5e3))},this))},e.prototype.playSoundLoop=function(e,t){if(void 0===t&&(t=1),this.isPreloadEffect&&(this.isBindEvent||this.bindStage(),this._enableEff&&null==this._soundDic.get(e))){var i=RES.getRes(e);if(i){var o=i.play(0,0);null!=o&&(o.volume=t,this._soundDic.set(e,o))}}},e.prototype.stopSoundLoop=function(e){null!=this._soundDic.get(e)&&(this._soundDic.get(e).stop(),this._soundDic.delete(e))},e.prototype.playSound2=function(e,t,i){void 0===t&&(t=1),void 0===i&&(i=0)},e.prototype.playSound=function(e,t,i){if(void 0===t&&(t=1),void 0===i&&(i=0),this.enableEff&&this.isPreloadEffect){if(0<i){null==this._durTDic.get(e)&&this._durTDic.set(e,0);var o=Date.now();if(o-this._durTDic.get(e)<i)return;this._durTDic.set(e,o)}var n=RES.getRes(e);if(n){var a=n.play(0,1);if(null!=a)return a.volume=t,a}}},e}(BaseClass);__reflect(SoundManager.prototype,"SoundManager");var ThemeAdapter=function(){function e(){}return e.prototype.getTheme=function(i,o,n,a){var r=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){o.call(a,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResAsync("gameEui_json",function(e,t){window.JSONParseClass.setData(e),egret.callLater(function(){o.call(a,generateEUI2)},r)},this);else if("undefined"!=typeof generateJSON)if(-1<i.indexOf(".exml")){var e=i.split("/");e.pop();var t=e.join("/")+"_EUI.json";generateJSON.paths[i]?egret.callLater(function(){o.call(a,generateJSON.paths[i])},this):RES.getResByUrl(t,function(e){window.JSONParseClass.setData(e),egret.callLater(function(){o.call(a,generateJSON.paths[i])},r)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){o.call(a,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,function e(t){t.resItem.url==i&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,e,null),n.call(a))},null),RES.getResByUrl(i,function(e){o.call(a,e)},this,RES.ResourceItem.TYPE_TEXT)},e}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var TimerManager=function(t){function e(){var e=t.call(this)||this;return e.num2week={0:"周日",1:"周一",2:"周二",3:"周三",4:"周四",5:"周五",6:"周六",7:"周日"},e.ENTRANCE_CONFIG={},e._handlers=new Array,e._delHandlers=new Array,e._currTime=egret.getTimer(),e._currFrame=0,e._count=0,e._timeScale=1,e._timeScaleExtra=1,e._entranceTimeList=new Array,egret.Ticker.getInstance().register(e.onEnterFrame,e),e}return __extends(e,t),e.prototype.setTimeScale=function(e){this._timeScale=e},e.prototype.setTimeScaleExtra=function(e){this._timeScaleExtra=e},e.prototype.getTimeScale=function(){return this._timeScale*this._timeScaleExtra},e.prototype.updateEntranceTimeList=function(){this._entranceTimeList=[],this._serverTimeForEntrance=game.GameMgr.getInstance().serverTime()-1;function e(e){var t=p.ENTRANCE_CONFIG[e].constTime(),i=game.GameMgr.getInstance().serverTime();if(t){if(p.ENTRANCE_CONFIG[e].needServerDay){var o=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N).loginGameVO.serverOpenDt;if(!o)return"continue";if(Math.floor((i-o)/86400)<p.ENTRANCE_CONFIG[e].needServerDay())return"continue"}var n=t[0],a=t[1],r=t[2];(r=r||[0,1,2,3,4,5,6]).forEach(function(e,t){7==e&&(r[t]=0)});var s=new Date;if(s.setTime(1e3*i),n&&a&&-1!=r.indexOf(s.getDay())&&(s.setHours(a[0]||0,a[1]||0,a[2]||0),s.getTime()/1e3>i)){var c=s.getTime()/1e3,l=new Date(1e3*i);l.setHours(n[0]||0,n[1]||0,n[2]||0);var h=l.getTime()/1e3;p._entranceTimeList.push({beginTime:h,endTime:c,module:e,OpenFunction:p.ENTRANCE_CONFIG[e].OpenFunction,CloseFunction:p.ENTRANCE_CONFIG[e].CloseFunction,hasOpen:!1})}}}var p=this;for(var t in this.ENTRANCE_CONFIG)e(t);this._entranceTimeList.sort(function(e,t){return e.beginTime-t.beginTime})},e.prototype.checkEntranceTime=function(){this._serverTimeForEntrance++,this._entranceTimeList[0]&&!this._entranceTimeList[0].hasOpen&&this._serverTimeForEntrance>=this._entranceTimeList[0].beginTime&&this._serverTimeForEntrance<=this._entranceTimeList[0].endTime?(this._entranceTimeList[0].OpenFunction&&this._entranceTimeList[0].OpenFunction(),this._entranceTimeList[0].hasOpen=!0):this._entranceTimeList[0]&&this._serverTimeForEntrance>=this._entranceTimeList[0].endTime&&(this._entranceTimeList[0].CloseFunction&&this._entranceTimeList[0].CloseFunction(),this._entranceTimeList.shift()),this._serverTimeForEntrance%10==0&&(this._serverTimeForEntrance=game.GameMgr.getInstance().serverTime()-1)},e.prototype.onEnterFrame=function(){this._currFrame++,this._currTime=egret.getTimer();for(var e=0;e<this._count;e++){((t=this._handlers[e]).userFrame?this._currFrame:this._currTime)>=t.exeTime&&(t.method.call(t.methodObj,(this._currTime-t.dealTime)*this._timeScale),t.dealTime=this._currTime,t.exeTime+=t.delay,t.repeat||(1<t.repeatCount?t.repeatCount--:(t.complateMethod&&t.complateMethod.apply(t.complateMethodObj),this._delHandlers.push(t))))}for(;this._delHandlers.length;){var t=this._delHandlers.pop();this.remove(t.method,t.methodObj)}},e.prototype.create=function(e,t,i,o,n,a,r){if(!(t<0||i<0||null==o)){this.remove(o,n);var s=Utils.ObjectPoolMgr.pop("TimerHandler");s.userFrame=e,s.repeat=0==i,s.repeatCount=i,s.delay=t,s.method=o,s.methodObj=n,s.complateMethod=a,s.complateMethodObj=r,s.exeTime=t+(e?this._currFrame:this._currTime),s.dealTime=this._currTime,this._handlers.push(s),this._count++}},e.prototype.doTimer=function(e,t,i,o,n,a){void 0===n&&(n=null),void 0===a&&(a=null),this.create(!1,e,t,i,o,n,a)},e.prototype.doFrame=function(e,t,i,o,n,a){void 0===n&&(n=null),void 0===a&&(a=null),this.create(!0,e,t,i,o,n,a)},Object.defineProperty(e.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0}),e.prototype.remove=function(e,t){for(var i=0;i<this._count;i++){var o=this._handlers[i];if(o.method==e&&o.methodObj==t){this._handlers.splice(i,1),Utils.ObjectPoolMgr.push(o),this._count--;break}}},e.prototype.removeAll=function(e){for(var t=0;t<this._count;t++){var i=this._handlers[t];i.methodObj==e&&(this._handlers.splice(t,1),Utils.ObjectPoolMgr.push(i),this._count--,t--)}},e.prototype.isExists=function(e,t){for(var i=0;i<this._count;i++){var o=this._handlers[i];if(o.method==e&&o.methodObj==t)return!0}return!1},e.prototype.getFormatBySecond1=function(e,t){void 0===e&&(e=0),void 0===t&&(t=":");var i=Math.floor(e/3600),o=Math.floor((e-3600*i)/60),n=Math.floor((e-3600*i)%60);return""+(0==i?"00":i<10?"0"+i:""+i)+t+(0==o?"00":o<10?"0"+o:""+o)+t+(0==n?"00":n<10?"0"+n:""+n)},e.prototype.getFormatBySecond2=function(e){if(void 0===e&&(e=0),0<e){var t=Math.floor(e/86400);e-=86400*t;var i=Math.floor(e/3600);e-=3600*i;var o=Math.floor(e/60);return e-=60*o,0<t?t+"天"+i+"小时":0<i?i+"小时"+o+"分":0<o?o+"分":"小于1分钟"}return"0天0小时"},e.prototype.getFormatBySecond3=function(e){if(void 0===e&&(e=0),0<e){var t=Math.floor(e/86400);e-=86400*t;var i=Math.floor(e/3600);e-=3600*i;var o=Math.floor(e/60);return e-=60*o,0<t?t+"天"+i+"小时":0<i?i+"小时"+o+"分":0<o?o+"分"+e+"秒":e+"秒"}return""},e.prototype.getOfflineDescBySecond=function(e){void 0===e&&(e=0);var t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60),o=Math.floor((e-3600*t)%60);return 720<t?"离线："+Math.floor(t/24/30).toString()+"月":24<t?"离线："+Math.floor(t/24).toString()+"天":1<t?"离线："+t+"小时":1<i?"离线："+i+"分钟":1<o?"离线：1分钟":"在线"},e.prototype.getTimeLeftDescBySecond=function(e){void 0===e&&(e=0);var t=Math.floor(e/3600),i=Math.floor((e-3600*t)/60),o=Math.floor((e-3600*t)%60);return 720<t?Math.floor(t/24/30).toString()+"个月前":24<t?Math.floor(t/24).toString()+"天前":1<t?t+"小时前":1<i?i+"分钟前":1<o?"1分钟前":"刚刚"},e.prototype.getServerTime=function(e){return void 0===e&&(e=!0),game.GameMgr.getInstance().serverTime(e)},e.prototype.getOpenServerTime=function(){return this._openServerTime||(this._openServerTime=game.GameMVC.loginPy.loginGameVO.serverOpenDt),this._openServerTime},e.prototype.getTimeInDaysAfterServerOpen=function(e){return this.getOpenServerTime()+86400*e},e.prototype.getServerOpenDays=function(){return Math.ceil((this.getServerTime()-this.getOpenServerTime())/86400)},e.prototype.checkIsOpen_FormatA=function(e){var t=e;"string"==typeof e&&(t=JSON.parse(e));var i=t[0],o=t[1],n=t[2]||[1,2,3,4,5,6,7],a={isOpen:!0,isWillOpenToday:!0,openTime:i,endTime:o,endTimeDt:0,openTimeDt:0,openDay:n,openDayTip:""},r=Utils.TimerManager.getServerTime(!1),s=new Date;s.setTime(1e3*r);var c,l=s.getDay();if(0==l&&(l=7),(c=new Date(1e3*r)).setHours(i[0]||0,i[1]||0,i[2]||0),r<c.getTime()/1e3&&(a.isOpen=!1),(c=new Date(1e3*r)).setHours(o[0]||0,o[1]||0,o[2]||0),r>c.getTime()/1e3&&(a.isOpen=!1),a.isOpen&&n&&-1==n.indexOf(l)&&(a.isOpen=!1),n&&-1==n.indexOf(l)&&(a.isWillOpenToday=!1),n&&7!=n.length){for(var h in n){0==(f=n[h])&&(f=7)}n.sort(function(e,t){return e-t});var p=[],d=n[0],u=n[0];n.push(n[n.length-1]);for(var g=1;g<n.length&&n[g];g++)n[g]==u+1?u=n[g]:(d==u?p.push(""+this.num2week[d]):p.push(this.num2week[d]+"到"+this.num2week[u]),d=u=n[g]);for(var h in a.openDayTip="每",p){var f=p[h];a.openDayTip+=f+"、"}a.openDayTip=a.openDayTip.slice(0,a.openDayTip.length-1)}else a.openDayTip="每天";var _=0;if(a.isWillOpenToday);else{for(var m=l,y=!1,v=0,T=n;v<T.length;v++){var C=T[v];if(m<C){y=!0,m=C;break}}_=y?24*(m-l):7-l+24*n[0]}return s.setTime(1e3*r),s.setHours(o[0]+_,o[1]||0,o[2]||0),a.endTimeDt=s.getTime()/1e3,s.setTime(1e3*r),s.setHours(i[0]+_,i[1]||0,i[2]||0),a.openTimeDt=s.getTime()/1e3,a},e.prototype.checkIsOpen_FormatB=function(e){var t,i="string"==typeof e&&JSON.parse(e)||e,o=i[0],n=i[1],a=i[2][0],r=i[2][1];null!=i[3]&&(t=Utils.TimerManager.isOddWeek());var s=Utils.TimerManager.getServerTime(!1),c={isOpen:!1,latestOpenDt:0,latestEndDt:0};if(null!=t){function l(e,t){return s>=e.getTime()/1e3&&s<t.getTime()/1e3}var h=t==(0!=i[3]),p=new Date(1e3*s),d=new Date(1e3*s),u=p.getDay()||7;p.setDate(p.getDate()-(u-o)),p.setHours(a[0],a[1],0,0),d.setTime(p.getTime()),d.setDate(p.getDate()+n-1),d.setHours(r[0],r[1],0,0),h||(p.setDate(p.getDate()-7),d.setDate(d.getDate()-7)),l(p,d)||s>=d.getTime()/1e3&&(p.setDate(p.getDate()+14),d.setDate(d.getDate()+14)),c.latestOpenDt=p.getTime()/1e3,c.latestEndDt=d.getTime()/1e3,c.isOpen=l(p,d)}else{var g=new Date(1e3*s),f=0==g.getDay()?7:g.getDay();g.setDate(o<=f&&f<=o+n-1?g.getDate()+n-1-f+o:g.getDate()),g.setHours(r[0],r[1],0,0),c.latestEndDt=o<=f&&f<=o+n-1?g.getTime()/1e3:0,g.setTime(1e3*s),g.setDate(o<f&&f<o+n-1?0<c.latestEndDt-s?g.getDate():0<f-o?g.getDate()+o+7-g.getDay():g.getDate()+o-g.getDay():0<f-o?g.getDate()+o+7-f:g.getDate()+o-f),g.setHours(a[0],a[1],0,0),c.latestOpenDt=o<f&&f<o+n-1?0:0<c.latestEndDt-s?0:g.getTime()/1e3,c.isOpen=s>=c.latestOpenDt&&s<c.latestEndDt}return c},e.prototype.checkIsOpen_FormatC=function(e){var t="string"==typeof e&&JSON.parse(e)||e,i=[],o=Utils.TimerManager.getServerTime(),n=0,a=0;for(var r in t){var s=t[r],c=new Date(1e3*o);c.setHours(s[0][0],s[0][1],s[0][2]||0);var l=Math.floor(c.getTime()/1e3);c.setHours(s[1][0],s[1][1],s[1][2]||0);var h=Math.floor(c.getTime()/1e3);i.push(l),i.push(h)}if(o<i[0])a=1,n=i[0];else if(o>i[i.length-1])a=1,n=i[0]+2073600;else for(var p=0;p<i.length-1;p++)if(o>i[p]&&o<i[p+1]){a=p%2==0?2:1,n=i[p+1];break}return{isOpen:2==a,nextStatusDt:n,status:a}},e.prototype.getPopTipsByOpenTime=function(e){var t=e.openTime[0];t<10&&(t="0"+t);var i=e.openTime[1]||0;i<10&&(i="0"+i);var o=e.openTime[2]||0;o<10&&(o="0"+o);var n=e.endTime[0];n<10&&(n="0"+n);var a=e.endTime[1]||0;a<10&&(a="0"+a);var r=e.endTime[2]||0;return r<10&&(r="0"+r),""+e.openDayTip+t+":"+i+":"+o+"-"+n+":"+a+":"+r},e.prototype.checkIsOpenForSingleServer=function(e){var t=JSON.parse(e),i=t[0],o=t[1],n=t[2][0],a=t[2][1],r=Utils.TimerManager.getServerTime(!1),s={isOpen:!1,latestOpenDt:0,latestEndDt:0},c=new Date(1e3*r),l=this.getServerOpenDays();return o<=l&&(l=(l-(i=1))%o+1),c.setHours(n[0],n[1],0,0),c.setDate(c.getDate()+(i-l)),s.latestOpenDt=c.getTime()/1e3,c.setHours(a[0],a[1],0,0),c.setDate(c.getDate()+o-1),s.latestEndDt=c.getTime()/1e3,r>s.latestEndDt&&(c.setHours(n[0],n[1],0,0),c.setDate(c.getDate()+1),s.latestOpenDt=c.getTime()/1e3,c.setHours(a[0],a[1],0,0),c.setDate(c.getDate()+o-1),s.latestEndDt=c.getTime()/1e3),s.isOpen=s.latestOpenDt<=r&&s.latestEndDt>r,s},e.prototype.getLeftTime=function(e){var t=new Date,i=Utils.TimerManager.getServerTime(!1);return t.setTime(1e3*i),t.setHours(e[0]),t.setMinutes(e[1]),t.setSeconds(e[2]),t.getTime()/1e3-i},e.prototype.createWeeklySchedule=function(){return new WeeklySchedule},e.prototype.getNextDayTime=function(e){var t=new Date(1e3*e);return t.setDate(t.getDate()),t.setHours(24,0,0),t.getTime()/1e3},e.prototype.isOddWeek=function(e){var t=new Date(1e3*(e||Utils.TimerManager.getServerTime(!1))),i=t.getDay()||7;t.setDate(t.getDate()-i+1);var o=Math.floor(t.getTime()/1e3/7/86400)%2==1;return egret.log("【TIME】：目前是"+(o?"单":"双")+"周"),o},e}(BaseClass);__reflect(TimerManager.prototype,"TimerManager");var TimerHandler=function(){function e(){this.delay=0,this.repeatCount=0,this.exeTime=0,this.dealTime=0}return e.prototype.clear=function(){this.method=null,this.methodObj=null,this.complateMethod=null,this.complateMethodObj=null},e}();__reflect(TimerHandler.prototype,"TimerHandler");var UIActionManager,WeeklySchedule=function(){function e(){this._schedule={}}return e.prototype.addSchedule=function(e,t,i,o){Array.isArray(t)||(t=[t]),this._schedule[e]||(this._schedule[e]=[]),this._schedule[e].push({status:e,days:t,interval:i,isOddWeek:o})},e.prototype.checkCurrentStatus=function(e){var a=[],t=new Date(1e3*(e||Utils.TimerManager.getServerTime(!1))),r=t.getDay()||7,s=t.getHours(),c=t.getMinutes(),l=Utils.TimerManager.isOddWeek();for(var i in this._schedule){this._schedule[i].forEach(function(e){var t=e.status,i=e.days,o=e.interval,n=e.isOddWeek;-1==a.indexOf(t)&&-1!=i.indexOf(r)&&(null!=n&&n!=l||(s>o[0][0]||s==o[0][0]&&c>=o[0][1])&&(s<o[1][0]||s==o[1][0]&&c<o[1][1])&&a.push(t))})}return a},e.prototype.getCurrentTimeInterval=function(e){var t={beginDt:0,endDt:0},i=e||this.checkCurrentStatus()[0];if(null!=i){var o=this._schedule[i],n=[],a=Utils.TimerManager.isOddWeek();o.forEach(function(t){var i=t.isOddWeek;t.days.forEach(function(e){void 0===i?n.push([[e,t.interval[0][0],t.interval[0][1]],[e,t.interval[1][0],t.interval[1][1]]]):i===a?(n.push([[e-14,t.interval[0][0],t.interval[0][1]],[e,t.interval[1][0],t.interval[1][1]]]),n.push([[e,t.interval[0][0],t.interval[0][1]],[e,t.interval[1][0],t.interval[1][1]]]),n.push([[e+14,t.interval[0][0],t.interval[0][1]],[e,t.interval[1][0],t.interval[1][1]]])):(n.push([[e-7,t.interval[0][0],t.interval[0][1]],[e-7,t.interval[1][0],t.interval[1][1]]]),n.push([[e+7,t.interval[0][0],t.interval[0][1]],[e+7,t.interval[1][0],t.interval[1][1]]]))})});var r=[],s=Utils.TimerManager.getServerTime(!1),c=new Date(1e3*s),l=c.getDate(),h=c.getDay()||7;n.forEach(function(e){var t=e[0],i=e[1];c.setTime(1e3*s),c.setDate(l+t[0]-h);var o=c.setHours(t[1],t[2],0,0)/1e3;c.setTime(1e3*s),c.setDate(l+i[0]-h);var n=c.setHours(i[1],i[2],0,0)/1e3;r.push([o,n])}),r.sort(function(e,t){return e[0]-t[0]});for(var p=0;p!=r.length-1;){var d=r[p],u=r[p+1];if(d[1]>=u[0]){var g=[Math.min(d[0],u[0]),Math.max(d[1],u[1])];r.splice(p,2,g)}else p+=1}r.forEach(function(e){e[0]<=s&&e[1]>s&&(t.beginDt=e[0],t.endDt=e[1])})}return t},e.prototype.resetSchedule=function(){for(var e in this._schedule)delete this._schedule[e]},e}();__reflect(WeeklySchedule.prototype,"WeeklySchedule"),function(_){_.POP_ACTION_SPEED=500,_.BTN_TOUCH_START_SCALE_SPEED=100,_.playUIAction=function(e,t,i,o,n){void 0===n&&(n=!1),e.onActionComplete&&(e.onActionComplete(),egret.Tween.removeTweens(e));var a=e.width,r=e.height,s=e.y,c=e.x,l=void 0,h=void 0,p=void 0,d=void 0,u=void 0,g=void 0;3==t||4==t?(l=e.left,h=e.right,p=e.horizontalCenter,e.left=void 0,e.right=void 0,e.horizontalCenter=void 0):6!=t&&5!=t||(d=e.top,u=e.bottom,g=e.verticalCenter,e.top=void 0,e.bottom=void 0,e.verticalCenter=void 0);var f=e.onActionComplete=function(){delete e.onActionComplete,3==t||4==t?(e.left=l,e.right=h,e.horizontalCenter=p):6!=t&&5!=t||(e.top=d,e.bottom=u,e.verticalCenter=g),i&&i.call(o)};if(n)switch(t){case 0:f();break;case 1:egret.Tween.get(e).to({alpha:0,scaleX:.5,scaleY:.5},_.POP_ACTION_SPEED,egret.Ease.backIn).call(f,o,void 0,!0);break;case 2:break;case 3:egret.Tween.get(e).to({x:Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale()+e.width},_.POP_ACTION_SPEED,egret.Ease.backInOut).call(f,o,void 0,!0);break;case 4:egret.Tween.get(e).to({x:-e.width},_.POP_ACTION_SPEED,egret.Ease.backInOut).call(f,o,void 0,!0);break;case 5:egret.Tween.get(e).to({y:e.height},_.POP_ACTION_SPEED,egret.Ease.backInOut).call(f,o,void 0,!0);break;case 6:egret.Tween.get(e).to({y:-e.height},_.POP_ACTION_SPEED,egret.Ease.backInOut).call(f,o,void 0,!0)}else switch(t){case 0:f();break;case 1:e.alpha=0,e.scaleX=.8*e.originScaleX,e.scaleY=.8*e.originScaleY,egret.Tween.get(e).to({alpha:1,scaleX:e.originScaleX,scaleY:e.originScaleY},_.POP_ACTION_SPEED,egret.Ease.backOut).call(f,o,void 0,!0);break;case 2:e.alpha=0,e.scaleX=.5*e.originScaleX,e.scaleY=.5*e.originScaleY,egret.Tween.get(e).to({alpha:1,scaleX:e.originScaleX,scaleY:e.originScaleY},_.POP_ACTION_SPEED,egret.Ease.elasticOut).call(f,o,void 0,!0);break;case 3:e.x=-a,egret.Tween.get(e).to({x:c},_.POP_ACTION_SPEED,egret.Ease.backInOut).call(f,o,void 0,!0);break;case 4:e.x=Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale()+a,egret.Tween.get(e).to({x:c},_.POP_ACTION_SPEED,egret.Ease.backInOut).call(f,o,void 0,!0);break;case 5:e.y=-r,egret.Tween.get(e).to({y:s},_.POP_ACTION_SPEED,egret.Ease.backInOut).call(f,o,void 0,!0);break;case 6:e.y=Utils.DeviceUtils.curHeight()+r,egret.Tween.get(e).to({y:s},_.POP_ACTION_SPEED,egret.Ease.backInOut).call(f,o,void 0,!0)}},_.UIActionEffect=function(e,t,i,o){void 0===i&&(i=!1),e.width,e.height;var n=i?1:-1,a=Utils.DeviceUtils.curWidth()*n,r=(Utils.DeviceUtils.curHeight(),e.x);e.x=e.x-a;var s=e.y;e.visible=!0,egret.Tween.get(e).to({x:r,y:s},t,egret.Ease.backOut).wait(100).call(function(){o&&o()})},_.playClickSound=function(e){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)},_.bindClickAction=function(e,t,i){void 0===t&&(t=!0),void 0===i&&(i=!0)},_.hideScrollerBar=function(e){},_.setGrey=function(e,t){if(void 0===t&&(t=!0),!Utils.needToBlockSetGrey())if(t){var i=new egret.ColorMatrixFilter([1,0,0,0,-75,0,1,0,0,-75,0,0,1,0,-75,0,0,0,1,0]);e.filters=[i]}else e.filters=[]},_.setAbsGrey=function(e,t){if(void 0===t&&(t=!0),!Utils.needToBlockSetGrey())if(t){var i=new egret.ColorMatrixFilter([.3,.6,.1,0,1,.3,.6,.1,0,1,.3,.6,.1,0,1,0,0,0,1,0]);e.filters=[i]}else e.filters=[]},_.setOutLineEffect=function(e,t){if(void 0===t&&(t=!0),e)if(t){var i=new egret.GlowFilter(3394815,.8,10,10,2,1,!1,!1);e.filters=e.filters?e.filters.concat([i]):[i]}else e.filters=[]},_.blink=function(e,t){void 0===t&&(t=!1),egret.Tween.get(e,{loop:t}).call(function(){_.setOutLineEffect(e)}).wait(100).call(function(){_.setOutLineEffect(e,!1)}).wait(100).call(function(){_.setOutLineEffect(e)}).wait(100).call(function(){_.setOutLineEffect(e,!1)})},_.fadeBlink=function(e,t,i,o){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===o&&(o=250),i?egret.Tween.get(e,{loop:t}).to({alpha:1},o).to({alpha:0},o):egret.Tween.get(e,{loop:t}).to({alpha:0},o).to({alpha:1},o)},_.shake=function(e){};var c=0;_.breathe=function(e,t){if(e&&e.parent){var i=t&&t.needRandomDelay||!1,o=(t&&t.reset,t&&t.changeAP||!1),n=t&&t.breathTime||800,a=t&&t.scaleX||.01,r=t&&t.scaleY||.06;if(egret.Tween.removeTweens(e),e.scaleX=e.originScaleX||1,e.scaleY=e.originScaleY||1,o&&(e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height),e.hasEventListener(egret.Event.REMOVED_FROM_STAGE)||e.once(egret.Event.REMOVED_FROM_STAGE,function(){egret.Tween.removeTweens(e)},this),i){var s=++c%10*100;egret.setTimeout(function(){egret.Tween.get(e,{loop:!0}).to({scaleX:e.originScaleX+a,scaleY:e.originScaleY+r},n).to({scaleX:e.originScaleX,scaleY:e.originScaleY},n)},this,s)}else egret.Tween.get(e,{loop:!0}).to({scaleX:e.originScaleX+a,scaleY:e.originScaleY+r},n).to({scaleX:e.originScaleX,scaleY:e.originScaleY},n)}},_.drop=function(e,t,i,o){egret.Tween.get(e).to({y:e.y+t},i,egret.Ease.bounceOut).call(function(){o&&o()})},_.drop3D=function(e,t,i,o,n){var a=e.scaleX,r=e.scaleY,s=e.y;e.scaleX*=1.5,e.scaleY*=1.5,e.y-=200,_.shineIn(e,void 0,void 0,t),egret.Tween.get(e).wait(i).to({scaleX:a,scaleY:r,y:s},o,egret.Ease.bounceOut).call(function(){n&&n()})},_.flyIn=function(e,t,i,o,n){if(void 0===o&&(o=function(){}),void 0===n&&(n=!1),!e.uia_flyIning){i=i||2.5*_.POP_ACTION_SPEED,egret.Tween.removeTweens(e),e.originX||(e.originX=e.x),e.originY||(e.originY=e.y);var a=e.originX,r=e.originY,s=Utils.DeviceUtils.curWidth(),c=e.width,l=e.height;e.uia_flyIning=!0,n?1===t?egret.Tween.get(e).to({x:-c-a},i,egret.Ease.circOut).call(function(){e.x=a,e.uia_flyIning=!1,o()}):2===t?egret.Tween.get(e).to({x:s+c},i,egret.Ease.circOut).call(function(){e.x=a,e.uia_flyIning=!1,o()}):egret.Tween.get(e).to({y:r+l},i,egret.Ease.backIn).call(function(){e.y=r,e.uia_flyIning=!1,o()}):1===t?(e.x=-c-a,egret.Tween.get(e).to({x:a},i,egret.Ease.circIn).call(function(){e.uia_flyIning=!1,o()})):2===t?(e.x=s+c,egret.Tween.get(e).to({x:a},i,egret.Ease.circIn).call(function(){e.uia_flyIning=!1,o()})):(e.y=r+l,egret.Tween.get(e).to({y:r},i,egret.Ease.backOut).call(function(){e.uia_flyIning=!1,o()}))}},_.fadeIn=function(e,t,i,o){void 0===o&&(o=!1),egret.Tween.removeTweens(e),o?(e.alpha=1,egret.Tween.get(e).to({alpha:0},t,egret.Ease.circOut).call(function(){i&&i()})):(e.alpha=0,egret.Tween.get(e).to({alpha:1},t,egret.Ease.circOut).call(function(){i&&i()}))},_.shineIn=function(t,i,e,o){if(e){var n=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],a=new egret.ColorMatrixFilter(n);t.filters=[a];var r=void 0;r=egret.setInterval(function(){var e=a.matrix;255<e[4]+50?(t.filters=[],egret.clearInterval(r),i&&i()):(e[4]+=50,e[9]+=50,e[14]+=50),a.matrix=e},this,o||100)}else{n=[1,0,0,0,255,0,1,0,0,255,0,0,1,0,255,0,0,0,1,0];var s=new egret.ColorMatrixFilter(n);t.filters=[s];var c=void 0;c=egret.setInterval(function(){var e=s.matrix;e[4]-50<0?(t.filters=[],egret.clearInterval(c),i&&i()):(e[4]-=50,e[9]-=50,e[14]-=50),s.matrix=e},this,o||100)}},_.douDong=function(e){egret.Tween.removeTweens(e);var t=e.anchorOffsetX,i=e.anchorOffsetY;e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=e.x+(e.anchorOffsetX-t),e.y=e.y+(e.anchorOffsetY-i),e.once(egret.Event.REMOVED_FROM_STAGE,function(){egret.Tween.removeTweens(e)},this),egret.Tween.get(e,{loop:!0}).to({rotation:7},100).to({rotation:-14},200).to({rotation:0},100).to({rotation:7},100).to({rotation:-14},200).to({rotation:0},100).wait(700)},_.jumping=function(e){e&&e.parent&&(egret.Tween.removeTweens(e),e.scaleX=e.originScaleX||1,e.scaleY=e.originScaleY||1,e.hasEventListener(egret.Event.REMOVED_FROM_STAGE)||e.once(egret.Event.REMOVED_FROM_STAGE,function(){egret.Tween.removeTweens(e)},this),egret.Tween.get(e,{loop:!0}).to({y:e.y-5},400).wait(100).to({y:e.y},400))},_.addEffect=function(t,e,i,o){t&&e&&(!t.armature123||i&&i.multi?DragonBoneTools.create(e,function(e){(!t.armature123||i&&i.multi)&&((t.armature123=e).x=t.width/2+(i&&i.offectX||0),e.y=t.height/2+(i&&i.offectY||0),i?(i.scaleX&&(e.scaleX=i.scaleX),i.scaleY&&(e.scaleY=i.scaleY),i.childIndex||0==i.childIndex?t.addChildAt&&t.addChildAt(e,i.childIndex):t.addChild&&t.addChild(e)):t.addChild&&t.addChild(e),e.animation.play(),o&&o(e))},this):t.armature123.visible=!0)},_.hideEffect=function(e,t){if(e&&e.armature123)return e.armature123.visible=!1,void(t&&t())},_.removeEffect=function(e,t){if(e&&e.armature123)return e.removeChild(e.armature123),e.armature123=void 0,void(t&&t());t&&t()},_.popSth=function(o,n,a,r,s,c,l){void 0===s&&(s=4),void 0===c&&(c=7),void 0===l&&(l=o.height),o.alpha=0,o.scaleX=.5*Utils.DeviceUtils.additionScale(),o.scaleY=.5*Utils.DeviceUtils.additionScale(),a.push(o),a.length>s&&a.forEach(function(e,t,i){if(a.length-t>=s){egret.Tween.removeTweens(e);var o=a.shift();o&&o.parent&&o.parent.removeChild(o)}}),a.forEach(function(e,t,i){egret.Tween.removeTweens(e),0===e.alpha&&(e.y=n-(o.height+c)*t),function(e,t){egret.Tween.get(e).to({alpha:1,scaleX:1*Utils.DeviceUtils.additionScale(),scaleY:1*Utils.DeviceUtils.additionScale(),y:n-(l+c)*t},300,egret.Ease.backOut).wait(1500).to({alpha:0,y:n-(l+c)*t*2},300,egret.Ease.backIn).call(function(){for(var e=a.length;0<e;e--){var t=a[e-1];t&&t.parent&&0==t.tween_count&&(a.splice(e),t.parent.removeChild(t))}},r)}(e,a.length-t)})}}(UIActionManager=UIActionManager||{});var UnlockMgr=function(i){function e(){var e=i.call(this)||this;for(var t in e.lockByServer={},e.__unlockCache={},e.__forceUnlockModule={},e.test=!1,e.playerProxy=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N),e.guildProxy=game.AppFacade.getInstance().retrieveProxy(game.GuildPy.N),e.taskProxy=game.AppFacade.getInstance().retrieveProxy(game.TaskPy.N),e.championPy=game.AppFacade.getInstance().retrieveProxy(game.ChampionPy.N),UnlockType)e.__unlockCache[UnlockType[t]]={};return e}return __extends(e,i),e.prototype.forceChangeUnlockInfo=function(e,t){this.__forceUnlockModule[e]=t},e.prototype.checkPass=function(e,t){var i,o=this;if(void 0===t&&(t=!0),i={condition:void 0,id:e,allow:!0,ext:{tips:void 0,requestLevel:void 0}},this.skipAllCheckForDebug||!game.Config.unlockConfig())return i;if(1==this.__forceUnlockModule[e])return i;var n=void 0,a=game.Config.unlockConfig(e);return a&&(this.lockByServer[e]?(i.allow=!1,i.ext.tips="未开启",i.ext.lockType="server"):(n=JSON.parse(a.condition),this.__unlockCache[n[0]][e]?i=this.__unlockCache[n[0]][e]:(function(e){switch(i.condition=e[0],e[0]){case UnlockType.Level:o.playerProxy.playerInfoVO.level<e[1]&&(i.allow=!1),i.ext.requestLevel=e[1],i.ext.tips="角色等级"+e[1]+"级解锁";break;case UnlockType.GuildLevel:(!o.guildProxy.isInGuild()||o.guildProxy.guildDetail.level<e[1])&&(i.allow=!1),i.ext.requestLevel=e[1],i.ext.tips="公会"+e[1]+"级解锁";break;case UnlockType.VipLevel:o.playerProxy.playerInfoVO.playerVip.vipLevel<e[1]&&(i.allow=!1),i.ext.viplevel=e[1],i.ext.tips="VIP"+i.viplevel+"解锁";break;case UnlockType.LevelOrVipLevel:o.playerProxy.playerInfoVO.level<e[1]&&o.playerProxy.playerInfoVO.playerVip.vipLevel<e[2]?i.allow=!1:o.playerProxy.playerInfoVO.level==e[1]&&(i.isCurLevelUnlock=!0),i.ext.requestLevel=e[1],i.ext.viplevel=e[2],i.ext.tips=e[1]+"级或VIP"+e[2]+"解锁";break;case UnlockType.LevelAndVipLevel:o.playerProxy.playerInfoVO.level<e[1]||o.playerProxy.playerInfoVO.playerVip.vipLevel<e[2]?i.allow=!1:o.playerProxy.playerInfoVO.level==e[1]&&(i.isCurLevelUnlock=!0),i.ext.requestLevel=e[1],i.ext.viplevel=e[2],i.ext.tips=e[1]+"级及VIP"+e[2]+"解锁";break;case UnlockType.ChampionNum:o.championPy.championInfo.id-1<e[1]&&(i.allow=!1),i.ext.requestLevel=e[1],i.ext.tips="爬塔通关至"+e[1]+"关解锁";break;case UnlockType.Task:case UnlockType.VipLevelTask:break;case UnlockType.ServerOpenDay:i.allow=Utils.TimerManager.getServerOpenDays()>e[1],i.ext.tips="开服第"+(e[1]+1)+"天解锁",i.ext.needOpen=e[1],i.ext.openDt=Utils.TimerManager.getTimeInDaysAfterServerOpen(e[1]);break;case UnlockType.LevelAndServerOpenDay:i.allow=Utils.TimerManager.getServerOpenDays()>e[1]&&o.playerProxy.playerInfoVO.level>=e[2],i.ext.tips="开服第"+(e[1]+1)+"天且角色等级"+e[2]+"级解锁",i.ext.needOpen=e[1],i.ext.requestLevel=e[2],i.ext.openDt=Utils.TimerManager.getTimeInDaysAfterServerOpen(e[1]);break;case UnlockType.Enable:i.allow=!1,i.ext.tips="敬请期待"}}(n),this.__unlockCache[n[0]][e]=i))),t&&!i.allow&&Utils.MsgUtils.addMidMsg(i.ext.tips),i},e.prototype.getOpenInfo=function(e){var t=Utils.UnlockMgr.checkPass(e,!1),i=game.Config.entranceTimeConfig()[e],o=Utils.TimerManager.checkIsOpen_FormatA(JSON.parse(i.timeConfig)[0]);for(var n in t)o[n]=t[n];return o},e.prototype.addReleaseEvent=function(e,t,i,o){var n=this;e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.checkPass(t).allow&&i(o)},o)},e.prototype.clearCacheByType=function(e){var t=this;e.forEach(function(e){t.__unlockCache[e]={}})},e.prototype.clearLockedInfoByType=function(e){var o=this;e.forEach(function(e){var t=o.__unlockCache[e];for(var i in t)t[i].allow||delete t[i]})},e}(BaseClass);__reflect(UnlockMgr.prototype,"UnlockMgr"),function(s){var i,e=(__extends(t,i=BasePanel),t.prototype.onClick=function(e,t){var i=s.AppFacade.getInstance().retrieveProxy(s.BackpackPy.N),o=!1;1===e?i.getInfoByTypeCodeNum(this.leftCost[0],this.leftCost[1]).haveNum>=this.leftCost[2]&&(o=!0):i.getInfoByTypeCodeNum(this.rightCost[0],this.rightCost[1]).haveNum>=this.rightCost[2]&&(o=!0),o?this.clickCB&&(this.clickCB({type:e,num:t}),this.params.dontCloseAfterClick?(this.params.canBuyCount-=t,this.params.curBuyCount+=t,this.update()):this.hide()):Utils.MsgUtils.addErrMsg(10024)},t.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initForCommonTips(),this.update()},t.prototype.initForCommonTips=function(){var e=this;this.img_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onClick(1,1)},this),this.img_right.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onClick(0,e.rightCount)},this)},t.prototype.update=function(){var t=this,e="行动力",i=this.params.curBuyCount,o=this.params.canBuyCount;this.rightCount=Math.min(5,o);var n=0;this.leftCost=JSON.parse(s.Config.publicBuyCostConfig(this.params.type,i).costs)[0];for(var a=0;a<this.rightCount;a++)n+=JSON.parse(s.Config.publicBuyCostConfig(this.params.type,i+a).costs)[0][2];this.rightCost=[this.leftCost[0],this.leftCost[1],n];var r=s.GeneralConfig.getEntityConfigByCode(this.leftCost[0],this.leftCost[1]);RES.getResAsync(ResourceUtils.png(r.icon),function(e){t.img_left_icon.source=e},this),this.lb_left.text=e+"x1",this.lb_left_num.text="x"+this.leftCost[2],r=s.GeneralConfig.getEntityConfigByCode(this.rightCost[0],this.rightCost[1]),RES.getResAsync(ResourceUtils.png(r.icon),function(e){t.img_right_icon.source=e},this),this.lb_right.text=e+"x"+this.rightCount,this.lb_right_num.text="x"+this.rightCost[2],this.decorateVip()},t.prototype.decorateVip=function(){if(this.params.canBuyCount){var e=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N);this.lb_tips.text="（您当前是VIP"+e.playerInfoVO.playerVip.vipLevel+"，今日剩余购买次数"+this.params.canBuyCount+"次）"}},t.STORAGE_PREFIX="CommonActionBuyTipsDialog",t);function t(e){var t=i.call(this)||this;return t.needTipsToday=!1,t.skinName="CommonActionBuyTipsDialogSkin",t.params=e,t.clickCB=e.clickCB,t}s.CommonActionBuyTipsDialog=e,__reflect(e.prototype,"game.CommonActionBuyTipsDialog")}(game=game||{});var WebMgrQQZone=function(o){function e(){return null!==o&&o.apply(this,arguments)||this}return __extends(e,o),e.prototype.init=function(){var t=this;o.prototype.init.call(this),egret.log("QQ玩吧"),window.__paySuccess=function(){e.invoke("ui","showDialog",{text:"充值成功",needOkBtn:!0,needCancelBtn:!1,okBtnText:"关闭"},function(e){})},window.__payError=function(){"PC"==getUrlKV().qua.app||"WX"==getUrlKV().channel||"xinYueClub"==getUrlKV().channel||"QQLive"==getUrlKV().channel?Utils.MsgUtils.addMidMsg("支付失败了！"):e.invoke("ui","showDialog",{text:"支付失败",needOkBtn:!0,needCancelBtn:!1,okBtnText:"关闭"},function(e){})},window.__payClose=function(){"PC"==getUrlKV().qua.app||"WX"==getUrlKV().channel||"xinYueClub"==getUrlKV().channel||"QQLive"==getUrlKV().channel?Utils.MsgUtils.addMidMsg("支付取消了！"):e.invoke("ui","showDialog",{text:"支付取消",needOkBtn:!0,needCancelBtn:!1,okBtnText:"关闭"},function(e){})};var e=window.mqq;e&&(window.mqq.invoke("ui","setOnShareHandler",function(e){0==e&&"SQ"==getUrlKV().qua.app?window.mqq.ui.shareArkMessage({title:Utils.agentConfig.htmlName||"",desc:CHAT_RANDOM_CONTENT[Utils.MathUtils.getRandomInt(0,CHAT_RANDOM_CONTENT.length-1)],share_url:getUrlKV().shareurl,image_url:getUrlKV().appicon,back:!0},function(e){e&&0==e.retCode&&0==e.retCode&&game.GameMVC.activityPy.getOperationReward(OperationType.Act_Share)}):window.mqq.invoke("ui","shareMessage",{title:Utils.agentConfig.htmlName||"",desc:CHAT_RANDOM_CONTENT[Utils.MathUtils.getRandomInt(0,CHAT_RANDOM_CONTENT.length-1)],share_type:e,share_url:getUrlKV().shareurl,image_url:getUrlKV().appicon,back:!0},function(e){egret.log("分享结果",e),0==e.retCode&&game.GameMVC.activityPy.getOperationReward(OperationType.Act_Share)})}),window.mqq.invoke("ui","setOnAddShortcutHandler",{callback:window.mqq.callback(function(){window.mqq.ui.addShortcut({action:"web",title:Utils.agentConfig.htmlName||"",icon:getUrlKV().appicon,url:getUrlKV().jumpurl,callback:function(e){if(egret.log("生成桌面入口结果",e),0==e.result){game.AppFacade.getInstance().retrieveProxy(game.ActivityPy.N);game.GameMVC.activityPy.getOperationReward(OperationType.Act_ShouCangYouLi)}}})},!1,!0)})),window.getOpenKey(function(e){getUrlKV().openkey=e.data.openkey,t.getVIPInfo()}),getUrlKV().switchRechargeType=2==window.OPEN_DATA.platform;var i=window.innerHeight/window.innerWidth;if(2.08<i&&(getUrlKV().statusBarHeight=64),"xinYueClub"==getUrlKV().channel&&(getUrlKV().statusBarHeight=45),2==window.OPEN_DATA.platform){Utils.agentConfig.AgentCode=Utils.agentConfig.AgentCodeSwitch;window.innerHeight,window.innerWidth;2.08<i&&(getUrlKV().statusBottomHeight=28)}Utils.agentConfig.isChecking.isExtra&&(getUrlKV().sdk_custom1_config={enter_icon:"common_icon_diaochawenjuan_png",canShow:!0,cb:function(){t.extraFuncForAgent({type:"openUrl",params:{url:"https://www.wenjuan.com/s/VNFrYj/"}}),game.GameMVC.activityPy.getOperationReward(7)}})},e.prototype.goSwitchAccount=function(){-1===game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N).userVO.loginState?this.goLogin():Utils.SDKMgr.cmd({type:"SwitchAccount"})},e.prototype.goLogin=function(){var e=this;login({cb:function(){egret.log("html登录回调"),egret.log(getUrlKV()),e.callJS(JSON.stringify({method:"loginCB",game_uin:getUrlKV().game_uin,username:getUrlKV().username||getUrlKV().game_uin,verify_token:getUrlKV().token,login_ext:getUrlKV().login_ext}))}})},e.prototype.enterFlow=function(e,t){var i=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N),o=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N),n=game.AppFacade.getInstance().retrieveProxy(game.GuildPy.N),a={serverId:i.serverSelect&&i.serverSelect.area,serverName:i.serverSelect&&i.serverSelect.s_name,severFlag:i.serverSelect&&i.serverSelect.s_id,playerName:o.roleVo.name,roleId:o.roleVo.playerId,roleCreateDt:o.roleVo.createDt,time:Utils.TimerManager.getServerTime(),money:o.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeDiamond],level:o.playerInfoVO.level,vipLevel:o.playerInfoVO.playerVip.vipLevel,fightCap:o.playerInfoVO.fightCap,camp:o.playerInfoVO.camp&&1==o.playerInfoVO.camp?"male":"famale",guildId:n.guildDetail?n.guildDetail.guildId:"",guildName:n.guildDetail?n.guildDetail.name:"",params:t,type:""};Utils.SDKMgr.cmd({type:"DeliverData",params:{type:e,data:a}}),a.type=e,Utils.agentConfig.other.isReport&&this.invokeLog(a)},e.prototype.invokeLog=function(e){function t(e){a+=e;var t=new egret.HttpRequest;t.responseType=egret.HttpResponseType.TEXT,t.addEventListener(egret.Event.COMPLETE,function(e){console.log(a),console.log(e)},i),t.open(a,"get"),egret.log("toGet",a),t.send()}var i=this,o=e.type,n=getUrlKV(),a="https://report.8zy.com/report/";switch(o){case"CreateRole":t("regchar/"+n.appid+"/"+n.pf+"/"+n.openid+"/"+n.via),egret.setTimeout(function(){window.reportRegister&&window.reportRegister()},this,2e3);break;case"EnterMain":window.reportLogin&&window.reportLogin(),t("login/"+n.appid+"/"+n.pf+"/"+n.openid+"/"+n.via);break;case"Purchased":var r=e.data.params.money;t("pay/"+n.appid+"/"+n.pf+"/"+n.openid+"/"+r+"/0/"+n.via)}},e.prototype.goPurchase=function(e){Utils.SDKMgr.getPerformConfig(1)?Utils.MsgUtils.addMidMsg("暂未开放"):sdkPay(e)},e.prototype.restart=function(){restart()},e.prototype.cmd=function(e,t){cmd(e,t)},e.prototype.copyToClipBoard=function(e,t){Utils.DeviceUtils.copyToClipboardByDOM(e,t)},e.prototype.nodeRecord=function(e){nodeRecord(e)},e.prototype.getChannelName=function(){},e.prototype.share=function(e,t){var i=getUrlKV(),o=window.mqq;"SQ"==i.qua.app?o.ui.shareArkMessage({title:e&&e.title||Utils.agentConfig.htmlName||"",desc:e&&e.desc||CHAT_RANDOM_CONTENT[Utils.MathUtils.getRandomInt(0,CHAT_RANDOM_CONTENT.length-1)],share_url:i.shareurl,image_url:i.appicon,back:!0},function(e){egret.log("分享结果",e),t&&t(e.retCode)}):"PC"==i.qua.app||"WX"==i.qua.app?window.mqq.ui.shareMessage({title:e&&e.title||Utils.agentConfig.htmlName||"",desc:e&&e.desc||CHAT_RANDOM_CONTENT[Utils.MathUtils.getRandomInt(0,CHAT_RANDOM_CONTENT.length-1)],share_type:0,share_url:i.shareurl,image_url:i.appicon,back:!0},function(e){egret.log("分享结果",e),t&&t(e.retCode)}):o.ui.showShareMenu({title:e&&e.title||Utils.agentConfig.htmlName||"",desc:e&&e.desc||CHAT_RANDOM_CONTENT[Utils.MathUtils.getRandomInt(0,CHAT_RANDOM_CONTENT.length-1)],share_url:i.shareurl,image_url:i.appicon},function(e){egret.log("分享结果",e),t&&t(e.retCode)})},e.prototype.addShortcut=function(e,t){window.mqq.ui.addShortcut({action:"web",title:e&&e.title||Utils.agentConfig.htmlName,icon:e.icon||getUrlKV().appicon,url:e.url||getUrlKV().jumpurl,callback:function(e){egret.log("生成桌面入口结果",e),0==e.result&&t&&t(e.result)}}),2==getUrlKV().platform&&t&&t(0)},e.prototype.getVIPInfo=function(){Utils.Http.toGet({action:"get_vipLev",appid:getUrlKV().appid,openid:getUrlKV().openid,openkey:getUrlKV().openkey,pf:getUrlKV().pf,gift_id:getUrlKV().GIFT}).then(function(e){console.log("error vip code  = ",e.vip.ret),console.log("error gift code  = ",e.gift.ret),getUrlKV().giftRet=e.gift,0==e.vip.ret&&(getUrlKV().QQVipLevel=e.vip.level)}).catch(function(){})},e.prototype.extraFuncForAgent=function(t){var e=t&&t.type,i=t.params,o=!1,n=Utils.agentConfig.other.packName||"";switch(e){case"PChutong":break;case"appDownload":window.mqq.app.isAppInstalled(n,function(e){console.log("is install: "+e),1==(o=e)&&t&&t.cb&&t.cb&&t.cb(o)});break;case"isGameApp":o=window.mqq.isGameApp;break;case"followAccount":getUrlKV().isFollowingAccount;break;case"canShow":o=window.mqq.data.canIShow(i&&i.type);break;case"openUrl":window.mqq.invoke("ui","openUrl",{url:i&&i.url,target:1,style:1}),o=!0}return o},e}(WebMgr);__reflect(WebMgrQQZone.prototype,"WebMgrQQZone");var WebMgrXYX=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(){e.prototype.init.call(this),egret.log("微信小游戏"),window.xyxPlatform.init(),window.xyxPlatform&&window.urlKV&&(4==Utils.DeviceUtils.getPlatform()&&"qqzone"==Utils.agentConfig.AgentCode&&(Utils.agentConfig.AgentCode="qqzone_ios"),window.urlKV.os_code=Utils.DeviceUtils.getPlatform(),window.urlKV.platform=Utils.agentConfig.AgentCode)},t.prototype.goSwitchAccount=function(){-1===game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N).userVO.loginState?this.goLogin():Utils.SDKMgr.cmd({type:"SwitchAccount"})},t.prototype.onLoginPHPSuccess=function(){window.xyxPlatform.onLoginPHPSuccess()},t.prototype.showLoadingTips=function(e,t){window.xyxPlatform.showLoadingTips(e,t)},t.prototype.dismissLoading=function(){window.xyxPlatform.dismissLoading()},t.prototype.goLogin=function(){var n=this;window.xyxPlatform.login(function(e){egret.log("html登录回调"),egret.log(getUrlKV()),Utils.SDKMgr.getPerformConfig(50)?200==e.code?n.callJS(JSON.stringify({method:"loginCB",game_uin:getUrlKV().game_uin,username:getUrlKV().username||getUrlKV().game_uin,verify_token:getUrlKV().token,login_ext:getUrlKV().login_ext})):400==e.code&&n.cmd({type:"getCertificationMessage",cb:function(e){var t=e.data&&e.data.realName||"",i=e.data&&e.data.idNumber||"",o=new game.CertificatePanel({name:t,num:i,cb:function(e,t){console.log(e),n.cmd({type:"nameCertification",name:e.name,num:e.num,cb:function(e){e&&200==e.code?(n.goLogin(),t.hide()):Utils.MsgUtils.addMidMsg("认证失败")}})}});PopUpManager.addPopUp({clickDarkClose:!1,obj:o})}}):n.callJS(JSON.stringify({method:"loginCB",game_uin:getUrlKV().game_uin,username:getUrlKV().username||getUrlKV().game_uin,verify_token:getUrlKV().token,login_ext:getUrlKV().login_ext}))})},t.prototype.invokeLog=function(e){},t.prototype.goPurchase=function(e){var n=this;e.ext=e.serialNumber,window.xyxPlatform.goPurchase(e,function(e){e&&400==e.code&&n.cmd({type:"getCertificationMessage",cb:function(e){var t=e.data&&e.data.realName||"",i=e.data&&e.data.idNumber||"",o=new game.CertificatePanel({name:t,num:i,cb:function(e,t){console.log(e),n.cmd({type:"nameCertification",name:e.name,num:e.num,cb:function(e){e&&200==e.code?t.hide():Utils.MsgUtils.addMidMsg("认证失败")}})}});PopUpManager.addPopUp({clickDarkClose:!0,obj:o})}})})},t.prototype.restart=function(){window.xyxPlatform.restart()},t.prototype.cmd=function(e,t){window.xyxPlatform.cmd(e,t)},t.prototype.copyToClipBoard=function(e,t){window.xyxPlatform.setClipboardData&&window.xyxPlatform.setClipboardData(e,t)},t.prototype.nodeRecord=function(e){window.xyxPlatform.nodeRecord(e)},t.prototype.getChannelName=function(){},t.prototype.share=function(e,t){window.xyxPlatform.share(e,t)},t.prototype.addShortcut=function(e,t){},t}(WebMgr);__reflect(WebMgrXYX.prototype,"WebMgrXYX"),function(e){var t,i=(t=eui.Component,__extends(o,t),o.prototype.childrenCreated=function(){var e=this;this.sl_root.horizontalScrollBar.visible=!1,this.sl_root.horizontalScrollBar.autoVisibility=!1,this.img_lastOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.changeSelectIndex(-1,!0)},this),this.img_nextOne.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.changeSelectIndex(1,!0)},this),UIActionManager.bindClickAction(this.img_lastOne),UIActionManager.bindClickAction(this.img_nextOne),this.needAutoScroll=!1,this.changeSelectIndex(0,!1)},Object.defineProperty(o.prototype,"dataProvider",{get:function(){return this.list_root.dataProvider},set:function(e){var t=this;this._needCycle&&(this._originalLength=e.length||this._originalLength,e.addEventListener(eui.CollectionEvent.COLLECTION_CHANGE,function(){t._originalLength=e.length/3},this)),this.list_root.dataProvider=e,this.initDataProvider=!0,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"itemRenderer",{get:function(){return this.list_root.itemRenderer},set:function(e){this.list_root.itemRenderer=e,this.initItemrender=!0,this._itemWidth=e.itemWidth,this.updateView()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"layout",{get:function(){return this.list_root.layout},set:function(e){e&&e!=this.list_root.layout&&(this.list_root.layout=e,this.updateView())},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"needAutoScroll",{get:function(){return this._needAutoScroll},set:function(e){this._needAutoScroll=!!e,this._needAutoScroll?this.sl_root.addEventListener(eui.UIEvent.CHANGE_END,this.autoScroll,this):this.sl_root.hasEventListener(eui.UIEvent.CHANGE_END)&&this.sl_root.removeEventListener(eui.UIEvent.CHANGE_END,this.autoScroll,this)},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"needCycle",{get:function(){return this._needCycle},set:function(e){this._needCycle=e,this._needCycle?this.sl_root.addEventListener(eui.UIEvent.CHANGE_END,this.cycleChange,this):this.sl_root.hasEventListener(eui.UIEvent.CHANGE_END)&&this.sl_root.removeEventListener(eui.UIEvent.CHANGE_END,this.cycleChange,this)},enumerable:!0,configurable:!0}),o.prototype.updateView=function(){return!(!this.initItemrender||!this.initDataProvider)&&!(this.list_root.dataProvider.length<=0)&&(this.validateNow(),void this.changeSelectIndex(0))},o.prototype.changeSelectIndex=function(e,t){if(void 0===t&&(t=!1),!this.initItemrender||!this.initDataProvider)return!1;if(this.list_root.dataProvider.length<=0)return!1;var i=this.curSelectIndex+e;i<0&&(i=0),i>this.list_root.dataProvider.length-1&&(i=this.list_root.dataProvider.length-1);var o=this.list_root.getVirtualElementAt(this.curSelectIndex);o&&(a=o.gp_forChoseFrame?o.gp_forChoseFrame:o)&&a[this.choseImgId]&&(a[this.choseImgId].visible=!1);var n=this.list_root.getVirtualElementAt(i);if(n){var a;if((a=n.gp_forChoseFrame?n.gp_forChoseFrame:n)[this.choseImgId])a[this.choseImgId].visible=!0;else{var r=this.makeChoseFrame();a.addChild(r),a[this.choseImgId]=r}var s=(this.list_root.layout.gap+this._itemWidth)*i;this.sl_root.viewport.scrollH=s-(this.sl_root.width-this._itemWidth)/2,this.sl_root.viewport.scrollH<0&&(this.sl_root.viewport.scrollH=0),this.sl_root.viewport.scrollH>this.list_root.width-this.sl_root.width&&(this.sl_root.viewport.scrollH=this.list_root.width-this.sl_root.width),this.curSelectIndex=i,t&&this.itemTapCB&&this.callItemTapCB(this.curSelectIndex)}var c=this.sl_root.viewport.contentWidth<=this.sl_root.width;this.img_lastOne.visible=0!=i&&!c,i==this.dataProvider.length-1||c?this.img_nextOne.visible=!1:this.img_nextOne.visible=!0,this.sl_root.scrollPolicyH=c?eui.ScrollPolicy.OFF:eui.ScrollPolicy.AUTO},o.prototype.changeTo=function(e){e.itemIndex<0&&(e.itemIndex=0),e.itemIndex>this.list_root.dataProvider.length-1&&(e.itemIndex=this.list_root.dataProvider.length-1),this.callItemTapCB(e.itemIndex),this.changeSelectIndex(e.itemIndex-this.curSelectIndex,!0)},o.prototype.addItemTapEvent=function(e,t){var i=this;this.list_root.hasEventListener(eui.ItemTapEvent.ITEM_TAP)||(this.itemTapCB=e,this.itemTapCB_thisObj=t,this.list_root.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){i.callItemTapCB(e.itemIndex),i.changeSelectIndex(e.itemIndex-i.curSelectIndex,!0)},this))},o.prototype.setChoseFrame=function(e){this.choseImgSource=e},o.prototype.makeChoseFrame=function(){var e=new eui.Image(this.choseImgSource);return e.pixelHitTest=!0,e.touchEnabled=!1,e.top=e.bottom=e.left=e.right=0,e.id=this.choseImgId,e},o.prototype.autoScroll=function(){var e=this.list_root.layout.gap,t=this.list_root.layout.paddingLeft,i=this._itemWidth,o=this.sl_root.viewport.scrollH-t+this.sl_root.width/2,n=Math.floor(o/(i+e));this.changeSelectIndex(n-this.curSelectIndex,!0)},o.prototype.cycleChange=function(){var e=this.sl_root.viewport.scrollH,t=this.list_root.width+this.list_root.layout.gap;t/3/2+t/3*2<e?this.sl_root.viewport.scrollH=e-t/3:e<t/3/2&&(this.sl_root.viewport.scrollH=e+t/3)},o.prototype.callItemTapCB=function(e){this._needCycle?this.itemTapCB.call(this.itemTapCB_thisObj,{itemIndex:e%this._originalLength}):this.itemTapCB.call(this.itemTapCB_thisObj,{itemIndex:e})},o.prototype.initChangeTo=function(e,t){var i=this;void 0===t&&(t=!1),this.delayChange&&!t||(this.delayChange=!0,this.once(egret.Event.ENTER_FRAME,function(){i.changeTo({itemIndex:e})},this))},o);function o(){var e=t.call(this)||this;return e._originalLength=9999999999,e.initDataProvider=!1,e.initItemrender=!1,e._itemWidth=0,e._needAutoScroll=!1,e._needCycle=!1,e.curSelectIndex=0,e.choseImgId="choseImg26465146813",e.choseImgSource="",e.delayChange=!1,e.skinName="CommonArrayListSkin",e}e.CommonArrayList=i,__reflect(i.prototype,"customui.CommonArrayList",["eui.UIComponent","egret.DisplayObject"])}(customui=customui||{}),function(e){var t,i=(t=eui.Component,__extends(o,t),o.prototype.defaultStart=function(e){void 0===e&&(e=[])},o.prototype.addOneMsg=function(e){var t=this;if(e&&e.text){var i=e.startX||this.gp_msg.width,o=e.startY||Math.random()*this.gp_msg.height,n=this.getLabel(e.text);n.x=i,n.y=o,this.gp_msg.addChild(n),egret.Tween.get(n).to({x:-n.textWidth},e.duration||this.duration).call(function(){t.gp_msg.removeChild(n),t.labelPool.push(n),e.doneCB&&e.doneCB()})}},o.prototype.addOneMsgAutoFormat=function(e){var t=this;if(e&&e.text){var i=this.getLabel(e.text),o=this.gp_msg.$children[this.gp_msg.numChildren-1];o?(i.x=Math.max(o.x+o.textWidth/4,this.gp_msg.width),i.y=this.curIndex%(this.height/(e.textHeight||45))*(e.textHeight||45)):(i.x=this.width,i.y=0),console.log(i.x+":"+i.y,o&&o.textWidth),this.gp_msg.addChild(i),this.duration=(i.x+i.textWidth)/(e.speed||200)*1e3,egret.Tween.get(i).to({x:-i.textWidth},this.duration).call(function(){t.gp_msg.removeChild(i),0==t.gp_msg.numChildren&&(t.curIndex=0),t.labelPool.push(i),e.doneCB&&e.doneCB()}),this.curIndex++}},o.prototype.getLabel=function(e){var t;return t=0<this.labelPool.length?this.labelPool.shift():new eui.Label,"string"==typeof e?t.text=e:"object"==typeof e?t.textFlow=e:console.log("弹幕数据类型错误"),t},o);function o(){var e=t.call(this)||this;return e.labelPool=[],e.duration=5e3,e.curIndex=0,e.skinName="CommonBarrage",e}e.CommonBarrage=i,__reflect(i.prototype,"customui.CommonBarrage",["eui.UIComponent","egret.DisplayObject"])}(customui=customui||{});var DynamicChange=function(){function e(){this._dataCache=[],this._pUpdate=new ProxyUpdate(this._dataCache)}return Object.defineProperty(e.prototype,"pUpdate",{get:function(){return this._pUpdate},enumerable:!0,configurable:!0}),e.prototype.getCacheData=function(e){return this._dataCache[e]?this._dataCache[e]:null},e.prototype.clearCache=function(){for(var e=Object.keys(this._dataCache),t=0,i=e.length;t<i;t++){var o=e[t];this._dataCache[o]=null,delete this._dataCache[o]}},e.prototype.getCacheKeyInfos=function(){for(var e=[],t=Object.keys(this._dataCache),i=0,o=t.length;i<o;i++){var n=t[i],a=this._dataCache[n];e.push(a)}return e},e.prototype.isCache=function(e){return this._dataCache[e]},e}();__reflect(DynamicChange.prototype,"DynamicChange");var ProxyUpdate=function(){function e(e){this._cache=e}return e.prototype.isArray=function(e){return e instanceof Array},e.prototype.isObject=function(e){return-1<e.indexOf("object")},e.prototype.isNormal=function(e){var t=-1<e.indexOf("@"),i=-1<e.indexOf("."),o=-1<e.indexOf("_");return!t&&!i&&!o},e.prototype.isAddToArray=function(e){return"@a"==e},e.prototype.isRemoveToArray=function(e){var t=e.split("_");return t.length<=3&&"@d"==t[0]},e.prototype.isFilter=function(e){return"@f"==e.split("_")[0]},e.prototype.isNumeric=function(e){return parseFloat(e).toString()==e.toString()},e.prototype._updateObject=function(e,t,i){var o=e.split(".");"@a"==o[0]||"@s"==o[0]?i[o[1]]=t:"@d"==o[0]&&delete i[o[1]]},e.prototype._getFilterObject=function(e,t){if(t){var i=e.split("_");if(3==i.length&&"@f"==i[0]&&this.isArray(t))for(var o=i[1],n=i[2],a=0;a<t.length;a++){var r=t[a];if(3==i.length&&this.isObject(r.toString())){var s=r[o];if(s&&("@"==n[0]&&(n=n.replace("@","")),n==s))return r}}}return null},e.prototype._addObjectToArray=function(e,t){if(this.isArray(t))for(var i=0;i<t.length;i++)e.push(t[i]);else e.push(t)},e.prototype._removeObjectFromArray=function(e,t,i){var o=t.split("_");if(o.length<=3&&"@d"==o[0]&&this.isArray(e))for(var n=e.length-1;0<=n;n--){var a=e[n];if(3==o.length){if(a.hasOwnProperty(o[1])){var r=o[2];"@"==r[0]&&(r=r.replace("@","")),r==a[o[1]]&&e.splice(n,1)}}else 2==o.length&&a.hasOwnProperty(o[1])?i==a[o[1]]&&e.splice(n,1):1==o.length&&i==a&&e.splice(n,1)}},e.prototype.update=function(e,t){if((this._cache[e]=t).hasOwnProperty("c"))for(var i=t.c,o=Object.keys(i),n=0,a=o.length;n<a;n++){var r=o[n];this._cache[r]&&(this._update(this._cache[r],i[r]),game.AppFacade.getInstance().sendNotification(r+"_HttpUpdate"))}},e.prototype._update=function(e,t){if(e&&t&&this.isObject(t.toString()))for(var i=Object.keys(t),o=0,n=i.length;o<n;o++){var a=i[o],r=t[a];if(this.isNormal(a)&&this.isObject(r.toString()))e.hasOwnProperty(a)&&this._update(e[a],r);else if(this.isNormal(a)&&this.isNumeric(r)){var s=e[a];e[a]=s+r}else if(this.isNormal(a))e[a]=r;else if(this.isAddToArray(a))this._addObjectToArray(e,r);else if(this.isRemoveToArray(a))this._removeObjectFromArray(e,a,r);else if(this.isFilter(a)){var c=this._getFilterObject(a,e);c&&this._update(c,r)}else this._updateObject(a,r,e)}},e}();__reflect(ProxyUpdate.prototype,"ProxyUpdate");var Http=function(t){function i(){var e=t.call(this)||this;return e.loginKey="507310f58a0ac8e3d8ad8f60c8b85b46"+Utils.agentConfig.ProjectName,e.reg=/[^\u4e00-\u9fa5a-zA-Z0-9]/gi,e}return __extends(i,t),i.prototype.dump=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log(""+i.LOG_TAG,e)},i.prototype.initServer=function(e){this._serverUrl=e},i.isHttps=function(){return!(!Utils.agentConfig||!Utils.agentConfig.isHttps)||(document&&document.location&&document.location.protocol?"https:"==document.location.protocol:void 0)},i.prototype.decorateParams=function(e,t,i){var o="",n=1;t&&this.decorateCommonParams(e);var a=Object.keys(e).sort();for(var r in a)o=1==n?i==egret.HttpMethod.GET?o+"?"+a[r]+"="+e[a[r]]:o+(a[r]+"=")+e[a[r]]:o+"&"+a[r]+"="+e[a[r]],n++;var s="";return s="?"==o.charAt(0)?o.substring(1)+this.loginKey:o+this.loginKey,egret.log("strMd5",s),o+"&sign="+(new flamd5).hex_md5(s).toLowerCase()},i.prototype.decorateUrl=function(e,t,i){return void 0===i&&(i=egret.HttpMethod.GET),Utils.agentConfig.HttpSerever+this.decorateParams(e,t,i)},i.prototype.toGet=function(i,o){return void 0===o&&(o=!0),__awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=this.decorateUrl(i,o),[2,this.getByUrl(t)]})})},i.prototype.getByUrl=function(a){return __awaiter(this,void 0,void 0,function(){var o,n=this;return __generator(this,function(e){switch(e.label){case 0:return a=encodeURI(a),(o=new egret.HttpRequest).responseType=egret.HttpResponseType.TEXT,[4,new Promise(function(i,t){o.addEventListener(egret.Event.COMPLETE,function(e){var t=o.data?o.data:o.response;try{i(t&&""!=t&&JSON.parse(t))}catch(e){i(t)}},n),o.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){t(e)},n),o.open(a,"get"),egret.log("toGet",a),o.send()}).catch(function(e){n.dump("exception",e.message)})];case 1:return[2,e.sent()]}})})},i.prototype.decorateCommonParams=function(e){e.serVer=Utils.agentConfig.CodeVersion,e.os_code=Utils.DeviceUtils.getPlatform(),e.platform=Utils.agentConfig.AgentCode,e.project=Utils.agentConfig.ProjectName,e.subPlatform=Utils.agentConfig.channelName,e.time=Date.now()},i.prototype.toPost=function(t,r){return __awaiter(this,void 0,void 0,function(){var n,a=this;return __generator(this,function(e){return n=this.decorateParams(t,!1,egret.HttpMethod.POST),r=encodeURI(r),egret.log("toPost",r,n),[2,new Promise(function(i,t){var o=new egret.HttpRequest;o.responseType=egret.HttpResponseType.TEXT,o.withCredentials=!1,o.open(r,egret.HttpMethod.POST),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(n);o.addEventListener(egret.Event.COMPLETE,function(e){egret.log("onSuccess ret",e);var t=o.data?o.data:o.response;egret.log("data",t);try{i(t&&""!=t&&JSON.parse(t))}catch(e){i(t)}},a),o.addEventListener(egret.IOErrorEvent.IO_ERROR,function(e){t(e)},a)})]})})},i.prototype.checkStrLegal=function(e,t,i){return null!=i?e.replace(this.reg,i):!e.match(this.reg)||!t||(Utils.MsgUtils.addMidMsg("不能包含特殊字符"),!1)},i.LOG_TAG="<--\x3eHttp<--\x3e:",i}(BaseClass);__reflect(Http.prototype,"Http"),function(e){var i,t=(i=eui.Component,__extends(o,i),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.activateComponent()},o.prototype.getCurNum=function(){return Number(this.lb_num.text)},o.prototype.update=function(e){this.maxBuyNum=null==e.maxBuyNum?this.maxBuyNum:e.maxBuyNum,this.minBuyNum=null==e.minBuyNum?this.minBuyNum:e.minBuyNum,this.onUpdate=e.onUpdate,this.maxBuyNum<Number(this.lb_num.text)&&this.setValueTo(this.maxBuyNum)},o.prototype.setValueTo=function(e,t){void 0===t&&(t=0),e>this.maxBuyNum&&(e=this.maxBuyNum),e<this.minBuyNum&&(e=this.minBuyNum),this.lb_num.text=e.toString(),this.updatePrice(t)},o.prototype.updatePrice=function(e){void 0===e&&(e=0),this.onUpdate&&this.onUpdate(Number(this.lb_num.text),e)},o.prototype.activateComponent=function(){var e=this;this.lb_num.addEventListener(egret.Event.CHANGE,function(){Number(e.lb_num.text)>e.maxBuyNum&&(e.lb_num.text=e.maxBuyNum.toString()),e.updatePrice()},this),this.lb_num.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){""!=e.lb_num.text&&Number(e.lb_num.text)||e.setValueTo(e.minBuyNum),Number(e.lb_num.text)>e.maxBuyNum&&(e.lb_num.text=e.maxBuyNum.toString()),e.updatePrice()},this),Utils.TouchUtils.addTouchListener(this.btn_min,function(){e.setValueTo(Number(e.lb_num.text)-10,1)}),Utils.TouchUtils.addTouchListener(this.btn_sub,function(){e.setValueTo(Number(e.lb_num.text)-1,2)}),Utils.TouchUtils.addTouchListener(this.btn_add,function(){e.setValueTo(Number(e.lb_num.text)+1,3)}),Utils.TouchUtils.addTouchListener(this.btn_max,function(){e.setValueTo(Number(e.lb_num.text)+10,4)})},o);function o(e){var t=i.call(this)||this;return t.skinName="CommonBatchNumSkin",t.maxBuyNum=0,t.minBuyNum=1,t}e.CommonBatchNum=t,__reflect(t.prototype,"customui.CommonBatchNum")}(customui=customui||{});var ByteArrayMsgByJSProtobuf=function(t){function e(){var e=t.call(this)||this;return e.pbObjs=null,e.ids=null,e.pbObjs=protobuf.roots.default,e.ids=RES.getRes("package_json"),e}return __extends(e,t),e.prototype.resolvePBNSByID=function(e){return{name:"N"+e,pretty_name:this.ids[e]}},e.prototype.resolvePBClassByID=function(e,t){var i=this.resolvePBNSByID(e);return{name:"C"+t,pretty_name:this.ids[i.pretty_name].id2s[t]}},e.prototype.resolvePBNSByName=function(e){var t=this.ids[e].id;return{id:t,name:"N"+t}},e.prototype.resolvePBClassByName=function(e,t){var i=this.ids[e].id2s[t];return{id:i,name:"C"+i}},e.prototype.receive=function(e){var t;this._msgBuffer.clear(),e.readBytes(this._msgBuffer);try{t=this.decode(this._msgBuffer)}catch(e){return void console.log("协议解析失败",e)}if(t){var i=t.id1Str+"."+t.id2Str,o=t.ssid;if(i)if(0==i.indexOf("test."))t.obj.key=i,game.AppFacade.getInstance().sendNotification("test.CommonR",t.obj);else try{t&&t.obj&&t.obj.clientReward&&this.backpackProxy.handleClientRewardCore(t.obj.clientReward),t&&t.obj&&t.obj.clientCost&&this.backpackProxy.handleClientCostCore(t.obj.clientCost),0==o?(game.AppFacade.getInstance().sendNotification(i,t.obj),game.AppFacade.getInstance().sendNotification(CN.GUIDE_NET_RESP,i)):this.callBackMap[o]&&(this.callBackMap[o].call(this,t.obj),this.callBackMap[o]=void 0)}catch(e){console.log("回调代码执行出错",e)}return t=void 0,0==this._msgBuffer.bytesAvailable&&this._msgBuffer.clear(),o}},e.prototype.decode=function(e){var t=e.length,i=e.readUnsignedShort(),o=e.readUnsignedByte(),n=e.readUnsignedShort(),a=e.readUnsignedByte();if(0===i)return e.position=0,Utils.MsgUtils.addErrMsg(void 0,"解析协议失败"),void console.log("解析协议失败，强行输出",e.readUTF());var r=new egret.ByteArray;e.readBytes(r);var s=this.resolvePBNSByID(o),c=this.resolvePBClassByID(o,n);console.log("正在解析：["+s.pretty_name+" "+c.pretty_name+"] 大小 "+r.length);var l=this.pbObjs[s.name]&&this.pbObjs[s.name][c.name];if(l){var h=l.decode(r.bytes,r.length);if(console.log("解析返回：ssid:"+a+" 总长"+t+" ["+s.pretty_name+" "+c.pretty_name+"]",h),r.clear(),r=void 0,!s.pretty_name||!c.pretty_name)throw new Error("pretty翻译失败");return{obj:h,ssid:a,id1Str:s.pretty_name,id2Str:c.pretty_name}}},e.prototype.encode=function(e){var t=this.resolvePBNSByName(e.id1),i=this.resolvePBClassByName(e.id1,e.id2),o=this.pbObjs[t.name][i.name],n=new o(e.body),a=new egret.ByteArray(o.encode(n).finish()),r=new egret.ByteArray;return r.writeShort(a.length+4),r.writeByte(t.id),r.writeShort(i.id),r.writeByte(e.ssid),r.writeBytes(a),a.clear(),a=void 0,r},e}(ByteArrayMsg);__reflect(ByteArrayMsgByJSProtobuf.prototype,"ByteArrayMsgByJSProtobuf");var ByteArrayMsgByProtobuf=function(t){function e(){var e=t.call(this)||this;return e.pbObjs=null,e.ids=null,e.pbObjs={game:window.dcodeIO.ProtoBuf.loadProto(RES.getRes("game_proto"))},e.ids=RES.getRes("package_json"),e}return __extends(e,t),e.prototype.getPbObj=function(e){return this.pbObjs.game},e.prototype.getId1=function(e){return"number"==typeof e?this.ids[e]:this.ids[e].id},e.prototype.getId2=function(e,t){var i=e;return"number"==typeof e&&(i=this.ids[e]),this.ids[i].id2s[t]},e.prototype.decode=function(e){var t=e.length,i=e.readUnsignedShort(),o=e.readUnsignedByte(),n=e.readUnsignedShort(),a=e.readUnsignedByte();if(0===i)return e.position=0,Utils.MsgUtils.addErrMsg(void 0,"解析协议失败"),void egret.log("解析协议失败，强行输出",e.readUTF());var r=new egret.ByteArray;e.readBytes(r);var s=this.getId1(o),c=this.getId2(o,n),l=this.getPbObj(s).build(s+"."+c).decode(r.buffer);return egret.log("解析返回：ssid:"+a+" 总长"+t+" ["+s+" "+c+"]",l),r.clear(),r=void 0,{obj:l,ssid:a}},e.prototype.encode=function(e){var t=this.getId1([e.id1]),i=this.getId2([e.id1],[e.id2]),o=new(this.getPbObj(e.id1).build(e.id1+"."+e.id2))(e.body),n=new egret.ByteArray(o.toArrayBuffer()),a=new egret.ByteArray;return a.writeShort(n.length+4),a.writeByte(t),a.writeShort(i),a.writeByte(e.ssid),a.writeBytes(n),n.clear(),n=void 0,a},e}(ByteArrayMsg);__reflect(ByteArrayMsgByProtobuf.prototype,"ByteArrayMsgByProtobuf");var Socket=function(t){function i(){var e=t.call(this)||this;return e._needReconnect=!0,e._TIME_OUT_TO_RECONNECT=5,e._TIME_OUT_TO_SHOW_LOADING=99,e._timeInvokeGuard=300,e._time_out_count=30,e._time_out_to_reconnect=e._TIME_OUT_TO_RECONNECT,e._sessionMax=128,e._sessionIdSet={},e._sessionIndex=0,e._timeoutLog=new Array,e._show_juhua_loading_effect_guard_dict={},e._timeInvokeLog={},e}return __extends(i,t),Object.defineProperty(i.prototype,"needReconnect",{set:function(e){this._needReconnect=e},enumerable:!0,configurable:!0}),i.prototype.dump=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log(i.LOG_TAG,e)},i.prototype.addEvents=function(){this._socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this._socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this._socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this)},i.prototype.removeEvents=function(){this._socket&&(this._socket.removeEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this._socket.removeEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this._socket.removeEventListener(egret.Event.CLOSE,this.onSocketClose,this),this._socket.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this))},i.prototype.onSocketOpen=function(){this.dump("onSocketOpen"),this._time_out_to_reconnect=this._TIME_OUT_TO_RECONNECT,this._timeoutLog.splice(0),this._isConnecting=!0,this._reconnecting?game.AppFacade.getInstance().sendNotification(SocketConst.SOCKET_RECONNECT):game.AppFacade.getInstance().sendNotification(SocketConst.SOCKET_CONNECT),this._reconnecting=!1,game.GameMgr.getInstance().switchNetChecking(!1)},i.prototype.onSocketClose=function(){this.dump("onSocketClose"),this._isConnecting=!1,this._needReconnect?(Utils.MsgUtils.addMidMsg("连接已断开，重新连接中"),game.AppFacade.getInstance().sendNotification(SocketConst.SOCKET_START_RECONNECT),game.GameMgr.getInstance().switchNetChecking(!0)):(Utils.MsgUtils.addMidMsg("连接已断开"),game.AppFacade.getInstance().sendNotification(SocketConst.SOCKET_CLOSE))},i.prototype.onSocketError=function(){this.dump("onSocketError"),this._needReconnect&&!this._reconnecting?this.reconnect():game.AppFacade.getInstance().sendNotification(SocketConst.SOCKET_NOCONNECT),this._isConnecting=!1},i.prototype.initServer=function(e,t,i,o,n){this._host=e,this._port=t,this._suffix=i,this._msg=n,this._type=o},i.prototype.connect=function(){!Utils.DeviceUtils.IsHtml5||window.WebSocket?(this._socket=new egret.WebSocket,this._msg instanceof ByteArrayMsg&&(this._socket.type=egret.WebSocket.TYPE_BINARY),this.addEvents(),""!=this._port?(this.dump("WebSocket: "+this._host+":"+this._port+this._suffix,this._msg instanceof ByteArrayMsg),this._socket.connectByUrl(this._type+this._host+":"+this._port+this._suffix)):(this.dump("WebSocket: "+this._host+this._suffix,this._msg instanceof ByteArrayMsg),this._socket.connectByUrl(this._type+this._host+this._suffix))):this.dump("不支持WebSocket")},i.prototype.reconnect=function(e){e&&(this._reconnecting=!1),this._reconnecting?this.dump("已在重连中，不处理"):(this.dump("reconnect"),this._reconnecting=!0,this.loading&&this.loading.switch(!1),this.close(),game.GameMgr.getInstance().switchNetChecking(!0),this.connect())},i.prototype.close=function(){this._socket&&(this.dump("close"),game.GameMgr.getInstance().stopPingSche(),this.removeEvents(),this._socket.close(),this._socket=null,this._isConnecting=!1)},i.prototype.isConnecting=function(){return this._isConnecting},i.prototype.debugInfo=function(e){game.AppFacade.getInstance().sendNotification(SocketConst.SOCKET_DEBUG_INFO,e)},i.prototype.onReceiveMessage=function(e){var t=this._msg.receive(this._socket);0!=t&&this.cleanSessionId(t)},i.prototype.send=function(c,l,h,p,d){return void 0===p&&(p=!1),void 0===d&&(d=!1),__awaiter(this,void 0,void 0,function(){var t,i,o,n,a,r,s;return __generator(this,function(e){if(Utils.agentConfig.OffLineTest)return[2,new Promise(function(e,t){t()})];if(this._isConnecting){if(d=d||UNIQUE_REQ[l]){if(t=Date.now(),i=this._timeInvokeLog[c+l]||0,t-i<this._timeInvokeGuard)return egret.log("调用频率限制",c,l),[2,new Promise(function(e,t){t()})];for(o=0,n=this._timeoutLog;o<n.length;o++)if((a=n[o])[2]===c&&a[3]===l)return egret.log("重复请求",c,l),[2,new Promise(function(e,t){t()})];this._timeInvokeLog[c+l]=t}return r=this.getSessionId(),(s={}).id1=c,s.id2=l,s.ssid=r,s.body=h,egret.log("send",c,l,h),this._timeoutLog.push([r,this._time_out_count,c,l]),[2,this._msg.send(this._socket,s,p)]}return this._needReconnect&&game.GameMgr.getInstance().switchNetChecking(!0),[2]})})},i.prototype.getSessionId=function(){return this._sessionIndex++,this._sessionIndex>this._sessionMax?(this._sessionIndex=0,this.getSessionId()):this._sessionIdSet[this._sessionIndex]?this.getSessionId():(this._sessionIdSet[this._sessionIndex]=!0,this._sessionIndex)},i.prototype.cleanSessionId=function(e){if(this._sessionIdSet[e]){this._sessionIdSet[e]=void 0;for(var t=0,i=0,o=this._timeoutLog;i<o.length;i++){if(o[i][0]===e){this._timeoutLog.splice(t,1);break}t++}}else Utils.MsgUtils.addErrMsg(void 0,"，无效的请求")},i.prototype.handleTimeOut=function(){0===this._time_out_to_reconnect?this.reconnect():this._time_out_to_reconnect--},i.prototype.intervalUpdate=function(e){var i=this,o=void 0,n=!1;this._timeoutLog.forEach(function(e,t){i._show_juhua_loading_effect_guard_dict[e[0]]>=i._TIME_OUT_TO_SHOW_LOADING&&(n=!0),i._show_juhua_loading_effect_guard_dict[e[0]]?i._show_juhua_loading_effect_guard_dict[e[0]]+=1:i._show_juhua_loading_effect_guard_dict[e[0]]=1,e[1]<=0?((o=o||[]).push(t),Utils.MsgUtils.addMidMsg("请求超时："+e[2]+":"+e[3]),i.handleTimeOut()):e[1]-=1}),o&&o.forEach(function(e){i._show_juhua_loading_effect_guard_dict[i._timeoutLog.splice(e,1)[0]]=void 0}),n?this.loading?this._reconnecting||this.loading.switch(!0):(this.loading=new game.LoadingEffect,GameRootLayer.gameLayer().loadLayer.addChild(this.loading)):this.loading&&this.loading.switch(!1)},i.LOG_TAG="<--\x3eSocket<--\x3e:",i}(BaseClass);__reflect(Socket.prototype,"Socket");var SocketConst=function(){function e(){}return e.SOCKET_CONNECT="SOCKET_CONNECT",e.SOCKET_RECONNECT="SOCKET_RECONNECT",e.SOCKET_START_RECONNECT="SOCKET_START_RECONNECT",e.SOCKET_CLOSE="SOCKET_CLOSE",e.SOCKET_DATA="SOCKET_DATA",e.SOCKET_NOCONNECT="SOCKET_NOCONNECT",e.SOCKET_DEBUG_INFO="SOCKET_DEBUG_INFO",e}();__reflect(SocketConst.prototype,"SocketConst"),function(e){var i,t=(i=eui.Component,__extends(o,i),o.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.cui_freshCost.scaleX=e.cui_freshCost.scaleY=.63,e.cui_freshCost.left=40},this),this.addEventListener(egret.TouchEvent.TOUCH_END,function(){e.cui_freshCost.scaleX=e.cui_freshCost.scaleY=.9,e.cui_freshCost.left=23},this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){e.cui_freshCost.scaleX=e.cui_freshCost.scaleY=.9,e.cui_freshCost.left=23},this),this.updateData()},o.prototype.updateData=function(e){if(this.data=e,this.data){var t=this.data.cost;t?(this.cui_freshCost.visible=!0,this.cui_freshCost.updateItem({cost:t}),this.data.text&&(this.btn_oppr.label="    "+this.data.text)):(this.cui_freshCost.visible=!1,this.data.text&&(this.btn_oppr.label=""+this.data.text))}},o);function o(e){var t=i.call(this)||this;return t.data=e,t.skinName="CommonBtnWithNumSkin",t}e.CommonBtnWithNum=t,__reflect(t.prototype,"customui.CommonBtnWithNum")}(customui=customui||{});var UTFMsgByJson=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.decode=function(e){return JSON.parse(e)},t.prototype.encode=function(e){return JSON.stringify(e)},t}(UTFMsg);__reflect(UTFMsgByJson.prototype,"UTFMsgByJson");var AnchorUtil=function(){function i(){}return i.init=function(){i._propertyChange=Object.create(null),i._anchorChange=Object.create(null),i.injectAnchor()},i.setAnchorX=function(e,t){e.anchorX=t},i.setAnchorY=function(e,t){e.anchorY=t},i.setAnchor=function(e,t){e.anchorX=e.anchorY=t},i.getAnchor=function(e){return e.anchorX!=e.anchorY&&egret.log("target's anchorX != anchorY"),e.anchorX||0},i.getAnchorY=function(e){return e.anchorY||0},i.getAnchorX=function(e){return e.anchorX||0},i.injectAnchor=function(){Object.defineProperty(egret.DisplayObject.prototype,"width",{get:function(){return this.$getWidth()},set:function(e){var t=this;this.$setWidth(e),i._propertyChange[this.hashCode]=!0,egret.callLater(function(){i.changeAnchor(t)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"height",{get:function(){return this.$getHeight()},set:function(e){var t=this;this.$setHeight(e),i._propertyChange[this.hashCode]=!0,egret.callLater(function(){i.changeAnchor(t)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorX",{get:function(){return this._anchorX},set:function(e){var t=this;this._anchorX=e,i._propertyChange[this.hashCode]=!0,i._anchorChange[this.hashCode]=!0,egret.callLater(function(){i.changeAnchor(t)},this)},enumerable:!0,configurable:!0}),Object.defineProperty(egret.DisplayObject.prototype,"anchorY",{get:function(){return this._anchorY},set:function(e){var t=this;this._anchorY=e,i._propertyChange[this.hashCode]=!0,i._anchorChange[this.hashCode]=!0,egret.callLater(function(){i.changeAnchor(t)},this)},enumerable:!0,configurable:!0})},i.changeAnchor=function(e){i._propertyChange[e.hashCode]&&i._anchorChange[e.hashCode]&&(e.anchorOffsetX=e._anchorX*e.width,e.anchorOffsetY=e._anchorY*e.height,delete i._propertyChange[e.hashCode])},i.calculateAndSetAr=function(e){e.anchorOffsetX=e.width*e.scaleX/2,e.anchorOffsetY=e.height*e.scaleY/2},i}();__reflect(AnchorUtil.prototype,"AnchorUtil");var ArrayUtil=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.cloneObj=function(e){var t=e.constructor===Array?[]:{};if("object"==typeof e){for(var i in e)e[i]&&(t[i]="object"==typeof e[i]?this.cloneObj(e[i]):e[i]);return t}},t}(BaseClass);__reflect(ArrayUtil.prototype,"ArrayUtil");var Base64Util=function(){function s(){}return Object.defineProperty(s,"nativeBase64",{get:function(){return"function"==typeof window.atob},enumerable:!0,configurable:!0}),s.decode=function(e){if(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),this.nativeBase64)return window.atob(e);for(var t,i,o,n,a,r,s=[],c=0;c<e.length;)t=this._keyStr.indexOf(e.charAt(c++))<<2|(n=this._keyStr.indexOf(e.charAt(c++)))>>4,i=(15&n)<<4|(a=this._keyStr.indexOf(e.charAt(c++)))>>2,o=(3&a)<<6|(r=this._keyStr.indexOf(e.charAt(c++))),s.push(String.fromCharCode(t)),64!==a&&s.push(String.fromCharCode(i)),64!==r&&s.push(String.fromCharCode(o));return s=s.join("")},s.encode=function(e){if(e=e.replace(/\r\n/g,"\n"),this.nativeBase64)return window.btoa(e);for(var t,i,o,n,a,r,s,c=[],l=0;l<e.length;)n=(t=e.charCodeAt(l++))>>2,a=(3&t)<<4|(i=e.charCodeAt(l++))>>4,r=(15&i)<<2|(o=e.charCodeAt(l++))>>6,s=63&o,isNaN(i)?r=s=64:isNaN(o)&&(s=64),c.push(this._keyStr.charAt(n)),c.push(this._keyStr.charAt(a)),c.push(this._keyStr.charAt(r)),c.push(this._keyStr.charAt(s));return c=c.join("")},s.decodeBase64AsArray=function(e,t){t=t||1;var i,o,n,a=s.decode(e),r=new Uint32Array(a.length/t);for(i=0,n=a.length/t;i<n;i++)for(r[i]=0,o=t-1;0<=o;--o)r[i]+=a.charCodeAt(i*t+o)<<(o<<3);return r},s.decompress=function(e,t,i){throw new Error("GZIP/ZLIB compressed TMX Tile Map not supported!")},s.decodeCSV=function(e){for(var t=e.replace("\n","").trim().split(","),i=[],o=0;o<t.length;o++)i.push(+t[o]);return i},s._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s}();__reflect(Base64Util.prototype,"Base64Util");var ComponentUtils=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.registerListener=function(e,t,i,o){switch(t){case egret.TouchEvent.TOUCH_TAP:Utils.TouchUtils.addTouchListener(e,i,o);break;default:if(!o)return void egret.log("【ComponentUtils】：注册非TOUCH_TAP类型事件时没有提供context，注册失败");e.addEventListener(t,i,o),e.once(egret.Event.REMOVED_FROM_STAGE,function(){e.removeEventListener(t,i,o)},this)}},e.prototype.unregisterListener=function(e,t,i,o){switch(t){case egret.TouchEvent.TOUCH_TAP:Utils.TouchUtils.removeTouchListener(e,i,o);break;default:if(!o||!i)return void egret.log("【ComponentUtils】：移除非TOUCH_TAP类型事件时没有提供context或cb，注册失败");e.removeEventListener(t,i,o)}},e.prototype.getNameOfComponent=function(e){var t="",i=this.getBaseView(e);if(i){for(var o="",n=e,a=i,r=[],s=[],c=this.getIdInParent(a,n),l=0,h="",p=0;a!=n;)""==h&&""!=(h=this.getIdInParent(n,e))&&(p=l),""==c?(s[l++]||s.push(this.getIndexInParent(n)),n=n.parent):(l=0,a=n,n=e,r.push(c)),c=this.getIdInParent(a,n);if(s=s.slice(p,l).reverse(),r.forEach(function(e){o+="#"+e}),0<s.length&&(s.forEach(function(e){o+="#"+e}),""!=h&&(o+="#"+h)),""!=(o=o.substring(1)))t=i.skinName+"#"+o}return t},e.prototype.getComponentByName=function(e){var t=e.split("#"),i=t[0],o=GameRootLayer.gameLayer().getViewBySkinName(i);if(o){for(var n=o,a=1;a<t.length;a++){var r=t[a];if(!(n=0<=Number(r)?n.$children[r]:n[r]))break}return n}},e.prototype.getBaseView=function(e){for(var t=e;t&&!(t instanceof BaseView);)t=t.parent;return t},e.prototype.getPosInView=function(e,t,i,o){var n=i||this.getBaseView(e),a=t&&t.x||0,r=t&&t.y||0,s=e.localToGlobal(a,r,o);return n.globalToLocal(s.x,s.y,o)},e.prototype.getIdInParent=function(e,t){var i="";for(var o in e)if("downTarget"!=o&&e[o]==t){i=o;break}return i},e.prototype.getIndexInParent=function(e){var t=-1;return e.parent&&(t=e.parent.$children.indexOf(e)),t},e}();__reflect(ComponentUtils.prototype,"ComponentUtils");var DebugUtils=function(t){function e(){var e=t.call(this)||this;return e._threshold=3,e._startTimes={},e}return __extends(e,t),e.prototype.setNeedDebugTools=function(e){this._isNeedDebugTools=e},Object.defineProperty(e.prototype,"isNeedDebugTools",{get:function(){return this._isNeedDebugTools},enumerable:!0,configurable:!0}),e.prototype.setDebug=function(e){this._isOpen=e},Object.defineProperty(e.prototype,"isDebug",{get:function(){return this._isOpen},enumerable:!0,configurable:!0}),e.prototype.start=function(e){this._isOpen&&(this._startTimes[e]=egret.getTimer())},e.prototype.stop=function(e){if(!this._isOpen)return 0;if(!this._startTimes[e])return 0;var t=egret.getTimer()-this._startTimes[e];return t>this._threshold&&egret.log(e+": "+t),t},e.prototype.setThreshold=function(e){this._threshold=e},e.prototype.dumpWalkInside=function(e,t){if(void 0===t&&(t=1),e&&e.toRaw){for(var i=e.toRaw(),o="\t",n=1;n<t;n++)o+="\t";if(i)for(var a in i)egret.log(""+o+a+":"+e[a]),this.dumpWalkInside(e[a],t++)}},e.prototype.dumpPbMsg=function(e){this._isOpen&&(egret.log(e.toString()),this.dumpWalkInside(e))},e.prototype.showBoundaryForComp=function(e,t){var i=t&&t.lineColor||16711680,o=t&&t.thickness||5,n=new egret.Shape;n.graphics.lineStyle(o,i),n.graphics.beginFill(0,0),n.graphics.drawRect(0,0,e.width,e.height),n.graphics.endFill(),e.addChild(n),e.addEventListener(eui.UIEvent.RESIZE,function(){n.graphics.clear(),n.graphics.lineStyle(o,i),n.graphics.beginFill(0,0),n.graphics.drawRect(0,0,e.width,e.height),n.graphics.endFill()},this)},e.prototype.resetA=function(){Utils.DebugUtils.isDebug&&(window._a=GameRootLayer.gameLayer().getViewBySkinName(GameRootLayer.gameLayer().getCurViewSkinName()))},e.prototype.getFakeName=function(){return game.GameMVC.playerPy.getRandomName()},e.prototype.getFakePlayerId=function(){return Utils.MathUtils.getRandomInt(1e5,2e5)},e.prototype.getFakeServerId=function(){return Utils.MathUtils.getRandomInt(1e5,2e5)},e.prototype.getFakeFightCap=function(){return Utils.MathUtils.getRandomInt(0,7777777)},e.prototype.getFakeAvatar=function(){return"head_1_"+Utils.MathUtils.getRandomInt(10,100)+"_png"},e.prototype.getFakeLevel=function(){return Utils.MathUtils.getRandomInt(1,200)},e.prototype.getFakeVipLevel=function(){return Utils.MathUtils.getRandomInt(1,18)},e.prototype.getFakeGuildName=function(){return""},e.prototype.getFakeServerName=function(){return"???"},e.prototype.getFakeOfflineTime=function(){return 0},e.prototype.getFakeRank=function(){return 0},e}(BaseClass);__reflect(DebugUtils.prototype,"DebugUtils");var DeviceUtils=function(t){function e(){var e=t.call(this)||this;return e.os2Id={iOS:4,Android:5,"Windows Phone":1,"Windows PC":1,"Mac OS":2,Unknown:6},e}return __extends(e,t),Object.defineProperty(e.prototype,"IsHtml5",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.WEB},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsNative",{get:function(){return egret.Capabilities.runtimeType==egret.RuntimeType.NATIVE||egret.Capabilities.runtimeType==egret.RuntimeType.RUNTIME2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsMobile",{get:function(){return egret.Capabilities.isMobile},enumerable:!0,configurable:!0}),e.prototype.needDownMic=function(){return!(4!==Utils.DeviceUtils.getPlatform()&&5!==Utils.DeviceUtils.getPlatform()||this.IsNative||egret.getOption("egretnative"))},Object.defineProperty(e.prototype,"IsPC",{get:function(){return!egret.Capabilities.isMobile},enumerable:!0,configurable:!0}),e.prototype.getPlatform=function(){return getUrlKV().os_code?getUrlKV().os_code:window.$platform_id?window.$platform_id:this.os2Id[egret.Capabilities.os]},e.prototype.getBrowser=function(){return window.$browser_id||""},e.prototype.curWidth=function(){return egret.MainContext.instance.stage.stageWidth},e.prototype.curHeight=function(){return egret.MainContext.instance.stage.stageHeight},e.prototype.additionWidth=function(){return egret.MainContext.instance.stage.stageWidth*(1-this.additionScale())},Object.defineProperty(e.prototype,"statusBarHeight",{get:function(){return getUrlKV().statusBarHeight||0},enumerable:!0,configurable:!0}),e.prototype.additionScale=function(){return this.curHeight()<1280?this.curHeight()/1280:1},Object.defineProperty(e.prototype,"statusBottomHeight",{get:function(){return getUrlKV().statusBottomHeight||0},enumerable:!0,configurable:!0}),e.prototype.deviceId=function(){return"not_unique"},e.prototype.setBottomAdapter=function(e){e&&0!=this.statusBottomHeight&&(isNaN(e.bottom)||null==e.bottom||(e.bottom+=this.statusBottomHeight),isNaN(e.verticalCenter)||null==e.verticalCenter||(e.verticalCenter-=this.statusBottomHeight/2),e.y-=this.statusBottomHeight)},e.prototype.setLiuHaiPingAdapter=function(){for(var t=this,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];e.forEach(function(e){e&&0!=t.statusBarHeight&&(isNaN(e.top)||null==e.top||(e.top+=t.statusBarHeight),isNaN(e.verticalCenter)||null==e.verticalCenter||(e.verticalCenter+=t.statusBarHeight/2),e.y+=t.statusBarHeight)})},e.prototype.copyToClipboardByDOM=function(e,t){try{var i=document.createElement("input");i.readOnly=!0,i.value=e,document.body.appendChild(i),i.select(),i.setSelectionRange(0,i.value.length),document.execCommand("Copy"),document.body.removeChild(i),t&&t(0)}catch(e){console.warn(e),t&&t(-1)}},e}(BaseClass);__reflect(DeviceUtils.prototype,"DeviceUtils");var DragonBoneTools=function(){function g(){}return g.manualClean=function(){for(var e in g.manualCleanDBADs){for(var t=g.manualCleanDBADs[e],i=0,o=t;i<o.length;i++){var n=o[i];n.armature&&(dragonBones.EgretFactory.factory.clock.remove(n.armature),n.dispose())}for(var a=0;a<t.length;a++)Utils.AssetsMgr.reduceRes(e)&&(dragonBones.EgretFactory.factory.removeDragonBonesData(e,!0),dragonBones.EgretFactory.factory.removeTextureAtlasData(e,!0))}g.manualCleanDBADs={}},g.createForHero=function(e,t,i,o){o?o.cacheAsBitmap=!1:o={cacheAsBitmap:!1};var n=game.Config.heroModelOffsetConfig(e);return n&&(null!=o.scaleX?o.scaleX*=n.modelScaleXY/1e3:o.scaleX=n.modelScaleXY/1e3,null!=o.scaleY?o.scaleY*=n.modelScaleXY/1e3:o.scaleY=n.modelScaleXY/1e3),g.create(e,t,i,o)},g.create=function(t,i,o,n){var a="";n=n||{};var e=AssetAdapter.getSrcChangeConfig();t=e&&e[t]||t;var r,s,c,l=dragonBones.EgretFactory.factory;function h(e){e?(r=e,RES.hasRes(t+"_texture_json")?Utils.AssetsMgr.getResAsync(t+"_texture_json",p,this,t):Utils.AssetsMgr.getResAsync(t+"_tex_json",p,this,t)):Utils.MsgUtils.addMidMsg("404(skeleton):"+t)}function p(e){e?(s=e,a=RES.hasRes(t+"_texture_png")?t+"_texture_png":t+"_tex_png",Utils.AssetsMgr.getResAsync(a,d,this,t)):Utils.MsgUtils.addMidMsg("404(json):"+t)}function d(e){e?((c=e)._textureName=a,l.parseDragonBonesData(r,t),l.parseTextureAtlasData(s,c),u()):Utils.MsgUtils.addMidMsg("404(texture):"+t)}function u(){var e=l.buildArmatureDisplay(t,t,void 0,void 0,"Default");e?(g.needCacheAsBitmap&&(n.cacheAsBitmap||n.cacheFrameRate?e.armature.cacheFrameRate=n.cacheFrameRate||12:0==n.cacheAsBitmap||(Utils.isXYX()&&!DB_SKIP_CACHE_FRAME[t]?e.armature.cacheFrameRate=12:c&&g.checkNeeddCacheFrame(c._textureName,c.textureWidth,c.textureHeight)&&(e.armature.cacheFrameRate=12))),n.cleanByManualAfterRemove?e.once(egret.Event.REMOVED_FROM_STAGE,function(){e.animation.stop(),g.manualCleanDBADs[t]||(g.manualCleanDBADs[t]=[]),g.manualCleanDBADs[t].push(e)},this):n.noCleanAfterRemove||e.once(egret.Event.REMOVED_FROM_STAGE,function(){e.animation.stop(),e.dispose(),Utils.AssetsMgr.reduceRes(t)&&(l.removeDragonBonesData(t,!0),l.removeTextureAtlasData(t,!0))},this),e.name="_effectOnObj",i&&i.call(o,e)):Utils.MsgUtils.addMidMsg("读取特效失败(buildArmatureDisplay):"+t)}null==g.needCacheAsBitmap&&(g.needCacheAsBitmap=Utils.DeviceUtils.IsMobile),l.getDragonBonesData(t)&&l.getTextureAtlasData(t)?(Utils.AssetsMgr.raiseRes(t),u()):RES.hasRes(t+"_skeleton_dbbin")?Utils.AssetsMgr.getResAsync(t+"_skeleton_dbbin",h,this,t):RES.hasRes(t+"_ske_dbbin")?Utils.AssetsMgr.getResAsync(t+"_ske_dbbin",h,this,t):Utils.AssetsMgr.getResAsync(t+"_ske_json",h,this,t)},g.playOnce=function(o){return __awaiter(this,void 0,void 0,function(){var i=this;return __generator(this,function(e){return[2,new Promise(function(t,e){""!==o.effectName?g.create(o.effectName,function(e){o.frameCB&&e.addEventListener(dragonBones.EventObject.FRAME_EVENT,function(e){e&&e.eventObject&&o.frameCB(e.eventObject)},this),e.addEventListener(dragonBones.EventObject.COMPLETE,function(){o.loop||(!o.keep&&o.parent&&o.parent.contains(e)&&o.parent.removeChild(e),o.doneCB&&o.doneCB(),o.notWait||t())},this),null!=o.horizontalCenter?e.x=(o.parent.width-e.width)/2+o.horizontalCenter:e.x=null!=o.x?o.x:o.parent.width/2,null!=o.verticalCenter?e.y=(o.parent.height-e.height)/2+o.verticalCenter:e.y=null!=o.y?o.y:o.parent.height/2,e.scaleX=o.scaleX?o.scaleX:1,e.scaleY=o.scaleY?o.scaleY:1,null!=o.z?o.parent.addChildAt(e,o.z):o.parent.addChild(e),o.timeScale&&(e.animation.timeScale=Number(o.timeScale)),e.name=o.name||"_effectOnObj",e.animation.hasAnimation(o.actionName||o.effectName)||t(),o.static?e.animation.stop():e.animation.play(o.actionName||o.effectName,o.loop?0:1),e.visible=!1,e.once(egret.Event.ENTER_FRAME,function(){e.visible=!0},this),o.notWait&&t(),o.loadFinishCB&&o.loadFinishCB(e)},i,{cacheAsBitmap:o.cacheAsBitmap,cacheFrameRate:o.cacheFrameRate,noCleanAfterRemove:o.noCleanAfterRemove,cleanByManualAfterRemove:o.cleanByManualAfterRemove}):t()})]})})},g.playUniqueEffect=function(t){var i=this,o=t.effectName;if(""!==o){function n(e){if(!e.armature||!e.animation.hasAnimation(t.actionName||o))return egret.warn("该特效无指定animation"),void(i.armatureCache[o]&&delete i.armatureCache[o]);e.name="_effectOnObj",null!=t.horizontalCenter?e.x=(t.parent.width-e.width)/2+t.horizontalCenter:e.x=null!=t.x?t.x:t.parent.width/2,null!=t.verticalCenter?e.y=(t.parent.height-e.height)/2+t.verticalCenter:e.y=null!=t.y?t.y:t.parent.height/2,e.scaleX=t.scaleX?t.scaleX:1,e.scaleY=t.scaleY?t.scaleY:1,null!=t.z?t.parent.addChildAt(e,t.z):t.parent.addChild(e),t.timeScale&&(e.animation.timeScale=Number(t.timeScale)),e.animation.play(t.actionName||t.effectName,t.loop?0:1)}this.armatureCache[o]?n(this.armatureCache[o]):g.create(o,function(e){(i.armatureCache[o]=e).addEventListener(dragonBones.EventObject.COMPLETE,function(){t.parent&&t.parent.contains(e)&&t.parent.removeChild(e),i.armatureCache[o]&&delete i.armatureCache[o],t.doneCB&&t.doneCB()},i),e.visible=!1,e.once(egret.Event.ENTER_FRAME,function(){e.visible=!0},i),n(e)},this)}},g.preload=function(c){return __awaiter(this,void 0,void 0,function(){function t(e){e&&(a=e,RES.hasRes(c+"_texture_json")?Utils.AssetsMgr.getResAsync(c+"_texture_json",i,this,c):Utils.AssetsMgr.getResAsync(c+"_tex_json",i,this,c))}function i(e){e&&(r=e,RES.hasRes(c+"_texture_png")?Utils.AssetsMgr.getResAsync(c+"_texture_png",o,this,c):Utils.AssetsMgr.getResAsync(c+"_tex_png",o,this,c))}function o(e){e?(s=e,n.parseDragonBonesData(a,c),n.parseTextureAtlasData(r,s),g.manualCleanDBADs[c]||(g.manualCleanDBADs[c]=[]),g.manualCleanDBADs[c].push(1),console.log("模型预解析完成",c)):Utils.MsgUtils.addMidMsg("404(texture):"+c)}var n,a,r,s;return __generator(this,function(e){return(n=dragonBones.EgretFactory.factory).getDragonBonesData(c)&&n.getTextureAtlasData(c)?console.log("模型数据已在内存，不需要重新下载写入",c):RES.hasRes(c+"_skeleton_dbbin")?Utils.AssetsMgr.getResAsync(c+"_skeleton_dbbin",t,this,c):RES.hasRes(c+"_ske_dbbin")?Utils.AssetsMgr.getResAsync(c+"_ske_dbbin",t,this,c):Utils.AssetsMgr.getResAsync(c+"_ske_json",t,this,c),[2]})})},g.dbStatus=function(){for(var e=0,t=[],i=0,o=[],n=dragonBones.EgretFactory.factory.clock,a=0,r=n._animatebles;a<r.length;a++){var s=r[a];s.display&&!s.display.stage&&(e++,t.push(s.name)),s.lockUpdate&&(i++,o.push(s.name))}return egret.log("\ndbStatus:\n    total:"+n._animatebles.length+"\n    noStage:"+e+", "+t+"\n    lockUpdate:"+i+", "+o+"\n        "),e},g.switchDBClockPause=function(e,t,i){void 0===i&&(i=!1),e&&(e.lockUpdate=t)},g.removeAllNotStageDB=function(){for(var e=0,t=dragonBones.EgretFactory.factory.clock._animatebles;e<t.length;e++){var i=t[e];i&&i.display&&!i.display.stage&&dragonBones.EgretFactory.factory.clock.remove(i)}},g.checkNeeddCacheFrame=function(e,t,i){var o=!0;65536<=t*i&&(o=!1);var n=RES.getResourceInfo(e);return n&&0<=n.url.indexOf("/model/")&&(o=!1),egret.log("特效纹理自动转帧",e,t,i,o),o},g.manualCleanDBADs={},g.needCacheAsBitmap=!0,g.armatureCache={},g}();__reflect(DragonBoneTools.prototype,"DragonBoneTools");var EgretExpandUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.init=function(){AnchorUtil.init()},t}(BaseClass);__reflect(EgretExpandUtils.prototype,"EgretExpandUtils");var FlowUtils=function(t){function e(){var e=t.call(this)||this;return e._isCbQueueWorking=!1,e._cbQueue=[],e}return __extends(e,t),e.prototype.insertCbAfterQueue=function(e){this._cbQueue.push(e),this.updateCbQueue()},e.prototype.updateCbQueue=function(e){e&&(this._isCbQueueWorking=!1),this._isCbQueueWorking||(this._isCbQueueWorking=!0,this._cbQueue.shift()())},e.prototype.enterFlow=function(e){game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N).loginStatusVO.state=500,"EnterMain"==e&&game.GameMVC.activityPy.checkAllSDKReward(),Utils.SDKMgr.enterFlow(e),Utils.SDKMgr.getPerformConfig(31)&&game.GameMgr.getInstance().resetPerformance()},e}(BaseClass);__reflect(FlowUtils.prototype,"FlowUtils");var GlobalEventManager=function(){function e(){this._eventReactor={}}return e.getIntance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.addGlobalEventListener=function(e,t,i){void 0===i&&(i=!1),this._eventReactor[e]||(this._eventReactor[e]=[]),this._eventReactor[e].push({cb:t,once:i})},e.prototype.removeGlocbalEventListener=function(){},e}();__reflect(GlobalEventManager.prototype,"GlobalEventManager");var HookUtils=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.init=function(){egret.Tween._get=egret.Tween.get,egret.Tween.get=this.egret_Tween_get},t.prototype.onRemoveFromStageForTween=function(e){e.target&&e.target.tween_count&&egret.Tween.removeTweens(e.target)},t.prototype.egret_Tween_get=function(e,t,i,o){return t&&t.loop&&e.once&&e.once(egret.Event.REMOVED_FROM_STAGE,Utils.HookUtils.onRemoveFromStageForTween,Utils.HookUtils),5<e.tween_count&&egret.warn("当前对象身上的缓动已经叠加了5次了",e),egret.Tween._get(e,t,i,o)},t}(BaseClass);__reflect(HookUtils.prototype,"HookUtils");var LocalStorageUtil=function(a){function e(){var e,t=a.call(this)||this,i=Utils.agentConfig.HttpSerever,o=0;0===i.indexOf("http://")&&(o=7);var n=i.indexOf("/",o);return e=i.substring(o,n),t.PREFIX=e+"_"+Utils.agentConfig.AgentCode,t}return __extends(e,a),e.prototype.getItem=function(e,t){if(void 0===t&&(t=!1),t)return egret.localStorage.getItem(this.PREFIX+"_"+e);var i=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N);return egret.localStorage.getItem(this.PREFIX+"_"+i.playerInfoVO.playerId+"_"+e)},e.prototype.setItem=function(e,t,i){if(void 0===i&&(i=!1),i)return egret.localStorage.setItem(this.PREFIX+"_"+e,t);var o=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N);return egret.localStorage.setItem(this.PREFIX+"_"+o.playerInfoVO.playerId+"_"+e,t)},e.prototype.removeItem=function(e,t){if(void 0===t&&(t=!1),t)return egret.localStorage.removeItem(this.PREFIX+"_"+e);var i=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N);return egret.localStorage.removeItem(this.PREFIX+"_"+i.playerInfoVO.playerId+"_"+e)},e.prototype.getTodayVaild=function(e){var t=!1,i=Number(this.getItem(e)),o=(new Date).getDate();return i&&i===o&&(t=!0),t},e.prototype.setTodayVaild=function(e){this.setItem(e,(new Date).getDate().toString())},e}(BaseClass);__reflect(LocalStorageUtil.prototype,"LocalStorageUtil");var MathUtils=function(t){function e(){var e=t.call(this)||this;return e.thresholds=[{guard:1e9,dividend:1e8,name:"Y"},{guard:1e5,dividend:1e4,name:"W"}],e}return __extends(e,t),e.prototype.getAngle=function(e,t,i,o){var n=Math.abs(e-i),a=Math.abs(t-o),r=a/Math.sqrt(Math.pow(n,2)+Math.pow(a,2)),s=Math.acos(r),c=Math.floor(180/(Math.PI/s));return e<i&&t<o&&(c=180-c),i==e&&t<o&&(c=180),e<i&&o==t&&(c=90),i<e&&t<o&&(c=180+c),i<e&&o==t&&(c=270),i<e&&o<t&&(c=360-c),c},e.prototype.getDegByAB=function(e,t){return 180*Math.atan2(e,t)/Math.PI},e.prototype.isNumber=function(e){return!isNaN(Number(e))},e.prototype.getRandomInt=function(e,t,i){e=Math.ceil(e),t=Math.floor(t);var o=null!=i?this.getRandomBySeed(i):Math.random();return Math.floor(o*(t-e+1))+e},e.prototype.getRandomBySeed=function(e){return Number("0."+Math.sin(e).toString().substr(7))},e.prototype.toDecimal=function(e,t){var i=parseFloat(e);if(isNaN(i))return"0";var o=i.toString();if(-1!=o.indexOf(".")&&o.length-o.indexOf(".")>t){var n=(i=Math.round(100*e)/100).toString(),a=n.indexOf(".");for(a<0&&(a=n.length,n+=".");n.length<=a+t;)n+="0";return n}return o},e.prototype.formatNumStyle1=function(e){var t=e.toString();return 1e4<=e&&e<1e7?t=Math.floor(e/1e3)+"K":1e7<=e&&e<1e10?t=Math.floor(e/1e6)+"M":1e10<=e&&(t=Math.floor(e/1e9)+"B"),t},e.prototype.formatNumToCharacter=function(e){var t={0:"十",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七",8:"八",9:"九"},i="";return e<100&&(20<e&&(i+=t[Math.floor(e/10)],i+=t[0]),10<e&&e<20&&(i+=t[0]),i+=t[e%10]),i},e.prototype.formatNumStyle2=function(e){return(e=e||0).toString()},e}(BaseClass);__reflect(MathUtils.prototype,"MathUtils");var Vector2D=function(){function t(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this._x=e,this._y=t}return t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.setZero=function(){this._x=0,this._y=0},t.prototype.isZero=function(){return 0==this._x&&0==this._y},Object.defineProperty(t.prototype,"length",{get:function(){return Math.sqrt(this.lengthSQ)},set:function(e){var t=this.angle;this._x=Math.cos(t)*e,this._y=Math.sin(t)*e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"lengthSQ",{get:function(){return this._x*this._x+this._y*this._y},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return Math.atan2(this._y,this._x)},set:function(e){var t=this.length;this._x=Math.cos(e)*t,this._y=Math.sin(e)*t},enumerable:!0,configurable:!0}),t.prototype.normalize=function(){if(0==this.length)return this._x=1,this;var e=this.length;return this._x/=e,this._y/=e,this},t.prototype.truncate=function(e){return this.length=Math.min(e,this.length),this},t.prototype.reverse=function(){return this._x=-this._x,this._y=-this._y,this},t.prototype.isNormalized=function(){return 1==this.length},t.prototype.dotProd=function(e){return this._x*e.x+this._y*e.y},t.prototype.crossProd=function(e){return this._x*e.y-this._y*e.x},t.angleBetween=function(e,t){return e.isNormalized()||(e=e.clone().normalize()),t.isNormalized()||(t=t.clone().normalize()),Math.acos(e.dotProd(t))},t.prototype.dist=function(e){return Math.sqrt(this.distSQ(e))},t.prototype.distSQ=function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},t.prototype.add=function(e){return new t(this._x+e.x,this._y+e.y)},t.prototype.subtract=function(e){return new t(this._x-e.x,this._y-e.y)},t.prototype.multiply=function(e){return new t(this._x*e,this._y*e)},t.prototype.divide=function(e){return new t(this._x/e,this._y/e)},t.prototype.equals=function(e){return this._x==e.x&&this._y==e.y},Object.defineProperty(t.prototype,"x",{get:function(){return this._x},set:function(e){this._x=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._y},set:function(e){this._y=e},enumerable:!0,configurable:!0}),t}();__reflect(Vector2D.prototype,"Vector2D");var MCAnimation=function(){function e(e){this.aniExistDict={},this.root=e}return e.prototype.hasAnimation=function(e){if(null!=this.aniExistDict[e])return this.aniExistDict[e];if(null==this.aniExistDict[e]){for(var t=!1,i=0,o=this.root.frameLabels;i<o.length;i++){if(o[i].name==e){t=!0;break}}this.aniExistDict[e]=t}return this.aniExistDict[e]},e.prototype.gotoAndStop=function(e){this.root.gotoAndStop(e)},e.prototype.play=function(e,t){this.root.gotoAndPlay(e,0==t?-1:t)},e.prototype.stop=function(){this.root.stop()},e}();__reflect(MCAnimation.prototype,"MCAnimation");var BaseMC=function(t){function e(){var e=t.call(this)||this;return e.animation=new MCAnimation(e),e}return __extends(e,t),e.prototype.hide=function(){this.parent&&this.parent.removeChild(this)},e.prototype.destoryMe=function(){this.stop(),this.hide()},e}(egret.MovieClip);__reflect(BaseMC.prototype,"BaseMC");var MovieClipTools=function(){function a(){}return a.create=function(o,n,a){var r;function t(e){if(e){var t=new egret.MovieClipDataFactory(e,r),i=new BaseMC;i.movieClipData=t.generateMovieClipData(o),n.call(a,i)}else Utils.MsgUtils.addMidMsg("404(mc):"+o)}RES.hasRes(o+"_tex_png")?RES.getResAsync(o+"_tex_png",function(e){e?(r=e,RES.getResAsync(o+"_mc_json",t,this)):Utils.MsgUtils.addMidMsg("404(json):"+o)},this):(egret.log("找不到帧动画文件",o),n.call(a,void 0))},a.play=function(n){return __awaiter(this,void 0,void 0,function(){var o=this;return __generator(this,function(e){return[2,new Promise(function(t,i){""!==n.effectName?a.create(n.effectName,function(e){e?(e.addEventListener(egret.MovieClipEvent.FRAME_LABEL,function(e){egret.log(e.type,e.frameLabel,this.mc1.currentFrame)},this),e.addEventListener(egret.Event.COMPLETE,function(){n.loop||(!n.keep&&n.parent&&n.parent.contains(e)&&n.parent.removeChild(e),n.doneCB&&n.doneCB(),n.notWait||t())},this),e.x=n.x?n.x:n.parent.width/2,e.y=n.y?n.y:n.parent.height/2,e.scaleX=n.scaleX?n.scaleX:1,e.scaleY=n.scaleY?n.scaleY:1,e.frameRate=n.frameRate||e.frameRate,null!=n.z?n.parent.addChildAt(e,n.z):n.parent.addChild(e),e.name="_effectOnObj",e.gotoAndPlay(n.actionName||n.effectName,n.loop?-1:1),n.notWait&&t()):i()},o):t()})]})})},a}();__reflect(MovieClipTools.prototype,"MovieClipTools");var GuideChatItem=function(t){function e(){var e=t.call(this)||this;return e.width=720,e.skinName='\n\t\t\t<?xml version="1.0" encoding="utf-8"?>\n\t\t\t<e:Skin class="GuajiMapInfoNode" xmlns:e="http://ns.egret.com/eui"\n\t\t\t\t\txmlns:w="http://ns.egret.com/wing" width="720" height="173">\n\t\t\t\t<e:Image id="img_npc" x="79" y="-351" scaleX="0.82" scaleY="0.82" source=""/>\n\t\t\t\t<e:Image id="img_tips_bg" source="_guide_map_m_json.common_img_jqdh_qipao" horizontalCenter="0" y="0"/>\n\t\t\t\t<e:Label id="lb_tips" text="" x="132" y="55" anchorOffsetX="0" width="469" anchorOffsetY="0" height="100" lineSpacing="5" verticalAlign="middle" size="32" textColor="0x000000"/>\n\t\t\t\t<e:Label id="lb_name" text="" x="81" y="11" size="32" width="221" textAlign="center"/>\n\t\t\t\t<e:Image id="img_say_done" source="_common_m_json.common_img_jqdh_jiantou" x="600" y="119" visible="false"/>\n\t\t\t</e:Skin>\n\t\t\t',e}return __extends(e,t),e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.dismiss=function(e){this.lb_name.visible=!1,this.lb_tips.visible=!1,this.img_say_done.visible=!1,this.img_npc.visible=!1,UIActionManager.fadeIn(this.img_tips_bg,FIGHT_CONST.TIPS_BG_FLY_IN,function(){e&&e()},!0)},e.prototype.show=function(){var e=this;this.img_tips_bg.visible=!0,this.lb_name.visible=!1,this.lb_tips.visible=!1,this.img_npc.visible=!1,UIActionManager.fadeIn(this.img_tips_bg,FIGHT_CONST.TIPS_BG_FLY_IN,function(){e.lb_name.visible=!0,e.lb_tips.visible=!0,e.img_npc.visible=!0})},e.prototype.updateNPCImg=function(e){var t=this;e&&(e.scaleX&&(this.img_npc.scaleX=e.scaleX),e.scaleY&&(this.img_npc.scaleY=e.scaleY),e.offsetX&&(this.img_npc.x+=e.offsetX),e.offsetY&&(this.img_npc.y+=e.offsetY),RES.getResAsync(ResourceUtils.png(e.url),function(e){t.img_npc.source=e},this))},e}(eui.Component);__reflect(GuideChatItem.prototype,"GuideChatItem");var MsgUtils=function(t){function e(){var e=t.call(this)||this;return e.privateChatHeadTimer=void 0,e.privateChatHeadShowTime=1e4,e.privateChatHeadPlayerId=0,e._queue=new Array,e.bannerScroll=new eui.Scroller,e.bannerScroll.touchEnabled=!1,e.bannerScroll.top=170,e.bannerScroll.horizontalCenter=0,e.bannerScroll.width=600,e.bannerScroll.height=36,e.bannerScroll.scrollPolicyH=eui.ScrollPolicy.OFF,e.bannerScroll.scrollPolicyV=eui.ScrollPolicy.OFF,e.bannerScrollViewPort=new eui.Group,e.bannerScrollViewPort.touchEnabled=!1,e.bannerScrollViewPort.width=600,e.bannerScrollViewPort.height=36,e.bannerScroll.viewport=e.bannerScrollViewPort,e.bannerImgBg=new eui.Image,e.bannerImgBg.touchEnabled=!1,e.bannerImgBg.top=170,e.bannerImgBg.horizontalCenter=0,e.bannerImgBg.scaleX=0,GameRootLayer.gameLayer().popMsgLayer.addChild(e.bannerImgBg),GameRootLayer.gameLayer().popMsgLayer.addChild(e.bannerScroll),Utils.DeviceUtils.setLiuHaiPingAdapter(e.bannerScroll),Utils.DeviceUtils.setLiuHaiPingAdapter(e.bannerImgBg),e}return __extends(e,t),e.prototype.switchMidChatMsgDoneImg=function(e){this.guideChatItem&&(e?(this.guideChatItem.img_say_done.visible=!0,UIActionManager.fadeBlink(this.guideChatItem.img_say_done,!0)):(this.guideChatItem.img_say_done.visible=!1,this.guideChatItem.img_say_done.alpha=1,egret.Tween.removeTweens(this.guideChatItem.img_say_done)))},e.prototype.addMidChatMsg=function(c,t,l,h){return void 0===t&&(t=""),void 0===h&&(h=!0),__awaiter(this,void 0,void 0,function(){var i,o,n,a,r,s=this;return __generator(this,function(e){switch(e.label){case 0:return c&&""!==c?(this.guideChatItem||(this.isTipsImgDissing=!0,this.guideChatItem=new GuideChatItem,this.guideChatItem.x=0,this.guideChatItem.y=497,GameRootLayer.gameLayer().popMsgLayer.addChild(this.guideChatItem)),i=0,this.isTipsImgDissing&&(i=FIGHT_CONST.TIPS_BG_FLY_IN,this.guideChatItem.show(),this.isTipsImgDissing=!1),this.guideChatItem.lb_tips.text="",o=0,4,n=c.length+4,a=0,r=Utils.TimerManager.getTimeScale(),this.guideChatItem.lb_name.text=t,this.guideChatItem.updateNPCImg(l),[4,new Promise(function(e,t){s.tipsScheId=egret.setInterval(function(){i<=(a+=20)&&(n<=o?(egret.clearInterval(s.tipsScheId),s.tipsScheId=null,h||(s.guideChatItem.lb_tips.text="",s.isTipsImgDissing=!0,UIActionManager.flyIn(s.guideChatItem.img_tips_bg,3,FIGHT_CONST.TIPS_BG_FLY_IN,function(){s.guideChatItem.parent.removeChild(s.guideChatItem),s.guideChatItem=void 0},!0)),e()):c[o]&&s.guideChatItem.lb_tips.appendText(c[o]),o++)},s,20/r)})]):(this.guideChatItem&&(this.isTipsImgDissing=!0,this.guideChatItem.dismiss(function(){s.guideChatItem.parent.removeChild(s.guideChatItem),s.guideChatItem=void 0})),[2]);case 1:return[2,e.sent()]}})})},e.prototype.addMidMsg=function(a,e){void 0===e&&(e=1500),RES.getResAsync("fenjie_img_tishitiao_png",function(e){if(!(20<this._queue.length)){var t=new eui.Group;t.touchEnabled=!1;var i=new eui.Image;i.touchEnabled=!1,i.source=e;var o=void 0;if(a&&"string"==typeof a?((o=new eui.Label).text=a,o.touchEnabled=!1):a&&"object"==typeof a?o=a:null!=a&&"number"==typeof a&&((o=new eui.Label).text=a.toString(),o.touchEnabled=!1),o){t.width=624,t.height=80;t.addChild(i),t.addChild(o),AnchorUtil.calculateAndSetAr(o),AnchorUtil.calculateAndSetAr(t),i.scale9Grid=new egret.Rectangle(297,10,17,12),i.height=80,i.horizontalCenter=0,i.verticalCenter=0,o.textColor=16769711,o.size=24,o.horizontalCenter=0,o.verticalCenter=0;var n=Utils.DeviceUtils.curHeight()/4;t.horizontalCenter=0,t.y=n,UIActionManager.popSth(t,n,this._queue,this),GameRootLayer.gameLayer().popMsgLayer.addChild(t)}}},this)},e.prototype.addObjMsg=function(e,t){if(e){if(20<this._queue.length){for(var i=0;i<5;i++){var o=this._queue[i];egret.Tween.removeTweens(o),o&&o.parent&&o.parent.removeChild(o)}this._queue.splice(0,5)}var n=t&&t.height||75;e.alpha=0,e.scaleX=e.scaleX*Utils.DeviceUtils.additionScale(),e.scaleY=e.scaleX*Utils.DeviceUtils.additionScale(),e.horizontalCenter=0,e.y=Utils.DeviceUtils.curHeight()/3+(t&&t.offectY||0);var a=this;this._queue.forEach(function(e,t,i){egret.Tween.removeTweens(e),e.y=e.y-n,r(e)}),r(e),this._queue.push(e),GameRootLayer.gameLayer().popMsgLayer.addChild(e)}function r(e){egret.Tween.get(e).to({alpha:1,scaleX:1*Utils.DeviceUtils.additionScale(),scaleY:1*Utils.DeviceUtils.additionScale(),y:e.y-n},300,egret.Ease.backOut).wait(t&&t.stayTime||1500).to({alpha:0,y:e.y-2*n},300,egret.Ease.backIn).call(function(){var e=a._queue.shift();e&&e.parent&&e.parent.removeChild(e)},a)}},e.prototype.clearMsgQueue=function(){for(var e=0;e<this._queue.length;e++){var t=this._queue[e];egret.Tween.removeTweens(t),t&&t.parent&&t.parent.removeChild(t)}this._queue=[]},e.prototype.addErrMsg=function(e,t){void 0===e&&(e=1e4);var i=game.Config.errConfig();if(i){var o=i[e.toString()];o&&1===o.showServerMsg&&this.addMidMsg(o.errorStr+(t||""))}},e.prototype.addCapChangeEffect=function(e,t){var i=e,o=t,n=0<o-i,a=Math.abs(o-i),r=[],s=new eui.Group,c=new eui.Group,l=new eui.Group,h=new eui.Group;for(s.touchEnabled=!1,c.touchEnabled=!1,l.touchEnabled=!1,h.touchEnabled=!1,s.width=Utils.DeviceUtils.curWidth(),s.height=300,AnchorUtil.calculateAndSetAr(s),DragonBoneTools.create("common_zhandouli",function(e){e.x=s.width/2,e.y=s.height/2,s.addChildAt(e,0),e.animation.play()},this,{groupName:"GuajiFixed"});10<=o;){var p=Math.floor(o/10);r.push((o-10*p).toString()),o=p}r.push(o);var d=150;!function(){var e=new eui.HorizontalLayout;e.gap=0,e.horizontalAlign=egret.HorizontalAlign.LEFT,e.verticalAlign=egret.VerticalAlign.MIDDLE,l.layout=e,l.x=s.width/2-17,l.y=s.height/2-18;for(var t=r.length;0<t;t--){var i=new eui.BitmapLabel;i.text=r[t-1],i.font="activity_trigger_fnt",i.scaleX=i.scaleY=.55,i.alpha=0,l.addChild(i),egret.Tween.get(i).wait((r.length-t+1)*d).to({alpha:1})}s.addChildAt(l,1)}(),function(){var e=new eui.HorizontalLayout;e.gap=0,e.horizontalAlign=egret.HorizontalAlign.LEFT,e.verticalAlign=egret.VerticalAlign.MIDDLE,c.layout=e,c.x=s.width/2-17,c.y=s.height/2;function t(t){DragonBoneTools.create("common_zhanli_2",function(e){e.x=20*t,e.scaleX=1.5,c.addChild(e),e.animation.play("common_zhanli_2"),egret.Tween.get(e).wait((t+1)*d).to({alpha:0}).call(function(){c.removeChild(e)},this)},i,{groupName:"GuajiFixed"})}r.length;for(var i=this,o=0;o<r.length;o++)t(o);s.addChildAt(c,2)}(),function(){var e=new eui.BitmapLabel;e.font=n?"green_num_fnt":"RedBlackStrocke_fnt",e.text=n?"+"+a:"-"+a,e.x=s.width/2+30+15*r.length,e.y=s.height/2-25,e.alpha=1,egret.Tween.get(e).to({alpha:1,y:s.height/2-40},300).wait(1150).to({alpha:0,y:s.height/2-53},300).call(function(){s.removeChild(e)},this),s.addChildAt(e,3)}(),s.x=Utils.DeviceUtils.curWidth()/2,s.y=Utils.DeviceUtils.curHeight()/2-150,egret.Tween.get(s).wait(1500).to({scaleX:0,scaleY:0},250).call(function(){GameRootLayer.gameLayer().maskLayer.removeChild(s)},this),GameRootLayer.gameLayer().maskLayer.addChild(s)},e.prototype.addRewardMsg=function(e,r,s){r=r||void 0;var t=e.rewards,i=(e.pokemons,e.equips),c=(e.totes,[]);if(t)for(var o=0,n=t;o<n.length;o++){var a=(u=n[o]).type||u[0],l=u.code||u[1],h=u.num||u[2];c.push(_(a,l,h))}if(i)for(var p=0,d=i;p<d.length;p++){var u;a=(a=(u=d[p]).type||u[0])||EEntityType.EEntityTypeHeroEquip;l=u.code||u[1],h=u.num||u[2];c.push(_(a,l,h))}function g(e){var t=c[e],i=void 0;i=null==r?GameRootLayer.gameLayer().popMsgLayer:r,t.horizontalCenter=0,t.alpha=0;var o=i.height/2;s&&null!=s.oriY&&(o=s.oriY),t.y=o;var n=s&&s.offsetY1||-i.height/4,a=s&&s.offsetY2||-i.height/4;egret.Tween.get(t).to({alpha:1,y:o+n},300,egret.Ease.backOut).wait(700).to({alpha:0,y:o+n+a},300,egret.Ease.backIn).call(function(){t&&t.parent&&t.parent.removeChild(t),s&&s.cb&&s.cb()}),i.addChild(t)}game.AppFacade.getInstance().retrieveProxy(game.GuidePy.N);for(var f=0;f<c.length;f++)g(f);function _(e,t,i){var o,n=new eui.Group,a=new eui.Image,r=new eui.BitmapLabel;switch(r.font="yellow_attr_fnt",e){case EEntityType.EEntityTypeItem:if(o=game.Config.itemConfig()[t]){var s=.9;a.source=ResourceUtils.png(o.icon),a.scaleX=s,a.scaleY=s,r.text="+"+i}break;case EEntityType.EEntityTypeHeroEquip:if(o=game.Config.getHeroEquipConfig()[t]){s=.9;a.source=ResourceUtils.png(o.icon),a.scaleX=s,a.scaleY=s,r.text="+"+i}break;case EEntityType.EEntityTypeHeroArtifact:if(o=game.Config.getHeroArtifactConfig()[t]){s=.9;a.source=ResourceUtils.png(o.icon),a.scaleX=s,a.scaleY=s,r.text="+"+i}break;default:for(var c=0,l=game.Config.propertyConfig();c<l.length;c++){var h=l[c];if(h.code==t&&h.type==e){o=h;break}}if(o){s=.9;a.source=ResourceUtils.png(o.icon),a.scaleX=s,a.scaleY=s,r.text="+"+i}}return n.height=50,a.verticalCenter=0,a.left=0,a.width=a.height=50,r.verticalCenter=0,r.left=40,n.addChild(a),n.addChild(r),AnchorUtil.calculateAndSetAr(n),n}},e.prototype.addNumberEffect=function(e,t,i,o,n){void 0===n&&(n=1);var a=new eui.Group,r=new eui.BitmapLabel(e);r.font="yellow_attr_fnt",a.addChild(r),a.x=i,a.y=o+t.height/2*t.scaleY*n,egret.Tween.get(a).to({x:i,y:o,alpha:0},1e3).call(function(){GameRootLayer.gameLayer().popMsgLayer.removeChild(a)}),GameRootLayer.gameLayer().popMsgLayer.addChild(a)},e.prototype.addBannerMsg=function(e,t){this.bannerScrollViewPort.removeChildren();var i=game.AppFacade.getInstance().retrieveProxy(game.MainPy.N),o=new eui.Label;o.size=26,o.touchEnabled=!1,o.addEventListener(egret.TextEvent.LINK,i.bindChatLinkJump,i),o.textFlow=e.textFlow,this.bannerScrollViewPort.addChild(o),o.x=this.bannerScrollViewPort.width,o.verticalCenter=5,egret.Tween.get(o).to({x:-o.textWidth},t)},e.prototype.switchBannerBg=function(t){var i=this;return new Promise(function(e){""!==i.bannerImgBg.source&&i.bannerImgBg.source||(i.bannerImgBg.source="liaotian_img_piaozidi_png",i.bannerImgBg.touchEnabled=!1),(i.bannerScroll.visible=t)?egret.Tween.get(i.bannerImgBg).to({scaleX:1},300).call(function(){e()}):egret.Tween.get(i.bannerImgBg).to({scaleX:0},300).call(function(){e()})})},e.prototype.addJumpPopUp=function(e){var t=Utils.DeviceUtils.curHeight()/9*8-100,i=new eui.Component;i.skinName="JumpPopUpSkin",i.horizontalCenter=0,i.y=50+t,i.alpha=0,i.lb_desc.text=e.desc,e.jumpId&&i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){game.MainJumpConfig.jumpTo(e.jumpId),egret.Tween.removeTweens(i),egret.Tween.get(i).to({alpha:0,y:t-50},250).call(function(){i&&i.parent&&i.parent.removeChild(i)})},this),GameRootLayer.gameLayer().popMsgLayer.addChild(i),egret.Tween.get(i).to({alpha:1,y:t},250).wait(5e3).to({alpha:0,y:t-50},250).call(function(){i&&i.parent&&i.parent.removeChild(i)})},e.prototype.switchBannerVisible=function(e){this.bannerImgBg&&(this.bannerScroll.visible=e,this.bannerImgBg.visible=e,this.bannerScrollViewPort.visible=e)},e.prototype.addPrivateChatPopUp=function(e){var t=this;if(!this.privateChatHead){this.privateChatHead=new customui.PlayerHead,this.privateChatHead.right=18,this.privateChatHead.bottom=270,this.privateChatHead.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){game.AppFacade.getInstance().showSubView(game.ChatMediator.N,game.ChatMediator.SV.CHAT,{NextChannelType:EChatChannelType.EChatChannelTypePrivate,playerID:t.privateChatHeadPlayerId}),t.privateChatHeadTimer&&egret.clearTimeout(t.privateChatHeadTimer),t.privateChatHead.visible=!1,UIActionManager.fadeBlink(t.privateChatHead,!1)},this),GameRootLayer.gameLayer().popMsgLayer.contains(this.privateChatHead)||GameRootLayer.gameLayer().popMsgLayer.addChild(this.privateChatHead);var i=new eui.Image("_chat_m_json.liaotian_img_new");i.right=i.top=0,this.privateChatHead.addChild(i)}this.privateChatHead.updateData({vo:e}),this.privateChatHead.visible=!0,this.privateChatHeadPlayerId=e.playerId,UIActionManager.fadeBlink(this.privateChatHead,!0,!1,500),this.privateChatHeadTimer&&egret.clearTimeout(this.privateChatHeadTimer),this.privateChatHeadTimer=egret.setTimeout(function(){this.privateChatHead.visible=!1,UIActionManager.fadeBlink(this.privateChatHead,!1)},this,this.privateChatHeadShowTime)},e.prototype.addVipMailHead=function(e){var t=this;if(e){if(this.mailinfo=e,!this.vipMailHead){this.vipMailHead=new customui.PlayerHead,this.vipMailHead.right=18,this.vipMailHead.bottom=180,this.vipMailHead.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new game.VIPMail(t.mailinfo)}),t.addVipMailHead(void 0)},this),GameRootLayer.gameLayer().popMsgLayer.contains(this.vipMailHead)||GameRootLayer.gameLayer().popMsgLayer.addChild(this.vipMailHead);var i=new eui.Image("_chat_m_json.liaotian_img_new");i.right=i.top=0,this.vipMailHead.addChild(i),this.vipMailHead.scaleX=this.vipMailHead.scaleY=.8,this.vipMailHead.updateData({fixedHead:"common_icon_youjian_001"})}UIActionManager.fadeBlink(this.vipMailHead,!0,!1,500),this.vipMailHead.visible=!0}else this.vipMailHead&&(UIActionManager.fadeBlink(this.vipMailHead,!1),this.vipMailHead.visible=!1)},e.prototype.shengjiEffect=function(){var t=GameRootLayer.gameLayer().popMsgLayer;Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shengji),DragonBoneTools.create("common_sj",function(e){e.x=t.width/2||0,e.y=t.height/4||0,e.animation.play(),t.addChild(e)},this,{groupName:"GuajiFixed"})},e.prototype.braveBookShengjiEffect=function(){var t=GameRootLayer.gameLayer().popMsgLayer;Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_shengji),DragonBoneTools.create("common_ysdjts",function(e){e.x=t.width/2||0,e.y=t.height/4||0,e.animation.play("common_ysdjts",1),t.addChild(e)},this,{groupName:"GuajiFixed"})},e.prototype.NewBraveBookShenjiEffect=function(e,t){var i=e,o=t,n=(Math.abs(o-i),[]),a=new eui.Group,r=new eui.Group,s=new eui.Group,c=new eui.Group;for(a.touchEnabled=!1,r.touchEnabled=!1,s.touchEnabled=!1,c.touchEnabled=!1,a.width=Utils.DeviceUtils.curWidth(),a.height=300,AnchorUtil.calculateAndSetAr(a),DragonBoneTools.create("common_yslzshengji_1",function(e){e.x=a.width/2,e.y=a.height/2,a.addChildAt(e,0),e.animation.play("common_yslzshengji_1",0)},this,{groupName:"GuajiFixed"});10<=o;){var l=Math.floor(o/10);n.push((o-10*l).toString()),o=l}n.push(o);var h=150;!function(){var e=new eui.HorizontalLayout;e.gap=0,e.horizontalAlign=egret.HorizontalAlign.LEFT,e.verticalAlign=egret.VerticalAlign.MIDDLE,s.layout=e,s.x=a.width/2+89,s.y=a.height/2+10;for(var t=n.length;0<t;t--){var i=new eui.BitmapLabel;i.text=n[t-1],i.font="activity_trigger_fnt",i.scaleX=i.scaleY=.6,i.alpha=0,s.addChild(i),egret.Tween.get(i).wait((n.length-t+1)*h).to({alpha:1})}a.addChildAt(s,1)}(),function(){var e=new eui.HorizontalLayout;e.gap=0,e.horizontalAlign=egret.HorizontalAlign.LEFT,e.verticalAlign=egret.VerticalAlign.MIDDLE,r.layout=e,r.x=a.width/2+89,r.y=a.height/2+30;function t(t){DragonBoneTools.create("common_yslzshengji_2",function(e){e.x=25*t,e.scaleX=e.scaleY=.6,r.addChild(e),e.animation.play("common_yslzshengji_2"),egret.Tween.get(e).wait((t+1)*h).to({alpha:0}).call(function(){r.removeChild(e)},this)},i,{groupName:"GuajiFixed"})}n.length;for(var i=this,o=0;o<n.length;o++)t(o);a.addChildAt(r,2)}(),a.x=Utils.DeviceUtils.curWidth()/2,a.y=Utils.DeviceUtils.curHeight()/2,egret.Tween.get(a).wait(1500).to({scaleX:0,scaleY:0},250).call(function(){GameRootLayer.gameLayer().maskLayer.removeChild(a)},this),GameRootLayer.gameLayer().maskLayer.addChild(a)},e}(BaseClass);__reflect(MsgUtils.prototype,"MsgUtils");var ResourceUtils=function(t){function i(){var e=t.call(this)||this;return e.behaviourWeakConfig={CITY_MAIN:1,GUAJI_MAIN:1,GUAJI_MAIN_BTN_EFF:0},e}return __extends(i,t),i.png=function(e){return!i.defaultAvatar&&game.Config.constConfig()&&(i.defaultAvatar=JSON.parse(game.Config.constConfig().DefaultAvatar.constValue)[0]),e&&RES.hasRes(e+"_png")?e+"_png":i.defaultAvatar+"_png"},i}(BaseClass);__reflect(ResourceUtils.prototype,"ResourceUtils");var ResVersionManager=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.init=function(){},t.prototype.loadConfig=function(i){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,RES.getResAsync(i)];case 1:return t=e.sent(),this.loadResVersionComplate(t),[2]}})})},t.prototype.loadResVersionComplate=function(e){e?Utils.agentConfig=e:window.fundebug.notifyError("获取resVer失败")},t}(BaseClass);__reflect(ResVersionManager.prototype,"ResVersionManager");var ShakeUtils=function(){function e(){this.count=0,this.timer=new egret.Timer(1e3)}return e.getInstance=function(){return null==this.instance&&(this.instance=new e),this.instance},e.prototype.shakeObj=function(e,t,i,o){this.target=e,this.initX=e.x,this.initY=e.y,this.maxDis=o,this.count=t*i,this.rate=i,this.timer.delay=1e3/i,this.timer.repeatCount=this.count,this.timer.addEventListener(egret.TimerEvent.TIMER,this.shaking,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.shakeComplete,this),this.timer.reset(),this.timer.start()},e.prototype.shaking=function(){egret.Tween.removeTweens(this.target),this.target.x=this.initX-this.maxDis+Math.random()*this.maxDis*2,this.target.y=this.initY-this.maxDis+Math.random()*this.maxDis*2,egret.Tween.get(this.target).to({x:this.initX,y:this.initY},999/this.rate)},e.prototype.shakeComplete=function(){this.target&&(egret.Tween.removeTweens(this.target),this.target.x=this.initX,this.target.y=this.initY),this.timer.removeEventListener(egret.TimerEvent.TIMER,this.shaking,this),this.timer.removeEventListener(egret.TimerEvent.TIMER_COMPLETE,this.shakeComplete,this)},e.prototype.stop=function(){this.shakeComplete()},e}();__reflect(ShakeUtils.prototype,"ShakeUtils");var TouchUtils=function(){function e(){this._globalFuncMap={},this._compFuncMap={}}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.log=function(e){egret.log("【ComponentUtils】:",e)},e.prototype.activateGlobalTouch=function(e){this.log("激活全局点击事件监听"),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this._globalTouch,this)},e.prototype._globalTouch=function(e){this.handleGlobalFunc(e),this.handleCompFunc(e)},e.prototype.addGlobalTouch=function(e,t){this._globalFuncMap[t]=e},e.prototype.removeGlobalTouch=function(e){this._globalFuncMap[e]&&delete this._globalFuncMap[e]},e.prototype.hasGlobalTouch=function(e){return!!this._globalFuncMap[e]},e.prototype.addTouchListener=function(e,t,i,o){var n=this;this._compFuncMap[e.hashCode]||(this._compFuncMap[e.hashCode]={component:e,cbList:[]}),this._compFuncMap[e.hashCode].cbList.every(function(e){return e.cb!=t||e.context!=i})&&(this._compFuncMap[e.hashCode].cbList.push({cb:t,context:i,params:o}),e.once(egret.Event.REMOVED_FROM_STAGE,function(){n.removeTouchListener(e)},this))},e.prototype.hasTouchListener=function(e){return!!this._compFuncMap[e.hashCode]},e.prototype.removeTouchListener=function(e,t,i){if(t){if(this._compFuncMap[e.hashCode]){var o=this._compFuncMap[e.hashCode].cbList;for(var n in o){var a=o[n];if(a.cb==t&&(!i||a.context==i)){o.splice(Number(n),1);break}}o.length||delete this._compFuncMap[e.hashCode]}}else this._compFuncMap[e.hashCode]&&delete this._compFuncMap[e.hashCode]},e.prototype.handleGlobalFunc=function(e){for(var t in this._globalFuncMap){var i=this._globalFuncMap[t];i&&i(e)}},e.prototype.handleCompFunc=function(e){for(var t=e.target;t;)this.onComponentTouch(t,e),t=t.parent},e.prototype.onComponentTouch=function(e,t){var i=this._compFuncMap[e.hashCode];if(i&&i.cbList.length)for(var o in i.cbList){var n=i.cbList[o];this.checkTouchCondition(n.params)&&(n.context?n.cb.call(n.context,t):n.cb(t))}},e.prototype.checkTouchCondition=function(e){return!0},e}();__reflect(TouchUtils.prototype,"TouchUtils");var Utils=function(){function i(){}return Object.defineProperty(i,"Http",{get:function(){return Http.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"SDKMgr",{get:function(){return i.sdkInstance||(i.sdkInstance=i.agentConfig.isRuntime&&(i.DeviceUtils.IsNative||egret.getOption("egretnative"))?MicMgr.getInstance():"qqzone"==i.agentConfig.AgentCode&&"qq_xyx"==i.agentConfig.channelName?WebMgrXYX.getInstance():"qqzone"==i.agentConfig.AgentCode?WebMgrQQZone.getInstance():!i.agentConfig.isHunFu&&i.isXYX()?WebMgrXYX.getInstance():WebMgr.getInstance()),i.sdkInstance},enumerable:!0,configurable:!0}),i.isXYX=function(){return!i.agentConfig.RemoteResHostForWeb&&i.XYX_REMOTE_RES_HOST},Object.defineProperty(i,"MapUtils",{get:function(){return game.MapUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"Socket",{get:function(){return Socket.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"UnlockMgr",{get:function(){return UnlockMgr.getInstance()},enumerable:!0,configurable:!0}),i.needToBlockSetGrey=function(){return null==i.forceCloseFilter&&(i.forceCloseFilter=!!i.SDKMgr.getPerformConfig(36)),i.forceCloseFilter},Object.defineProperty(i,"HookUtils",{get:function(){return HookUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"DebugUtils",{get:function(){return DebugUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"TimerManager",{get:function(){return TimerManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"AssetsMgr",{get:function(){return AssetsMgr.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"MathUtils",{get:function(){return MathUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ComponentUtils",{get:function(){return ComponentUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"TouchUtils",{get:function(){return TouchUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ShakeUtils",{get:function(){return ShakeUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"DeviceUtils",{get:function(){return DeviceUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"EgretExpandUtils",{get:function(){return EgretExpandUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ResourceUtils",{get:function(){return ResourceUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"MsgUtils",{get:function(){return MsgUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ArrayUtil",{get:function(){return ArrayUtil.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"FlowUtils",{get:function(){return FlowUtils.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"LocalStorageUtil",{get:function(){return LocalStorageUtil.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"SoundManager",{get:function(){return SoundManager.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"ObjectPoolMgr",{get:function(){return ObjectPoolMgr.getInstance()},enumerable:!0,configurable:!0}),Object.defineProperty(i,"CacheMgr",{get:function(){return CacheMgr.getInstance()},enumerable:!0,configurable:!0}),i.init=function(){i.DebugUtils.setDebug(i.agentConfig.IsDebug),egret.log("===========Utils init info=========="),egret.log("getPlatform:",i.DeviceUtils.getPlatform()),egret.log("getBrowser:",i.DeviceUtils.getBrowser()),egret.log("runtimeType:",egret.Capabilities.runtimeType),egret.log("egretnative:",egret.getOption("egretnative")),egret.log("href:",window.location.href),egret.log("getUrlKV:",getUrlKV()),i.isXYX()?RES.setMaxLoadingThread(6):RES.setMaxLoadingThread(20),window.fundebug&&(window.fundebug.appversion=i.agentConfig.CodeVersion,window.fundebug.releasestage=i.agentConfig.AgentCode,window.fundebug.silentResource=!0,window.fundebug.silent=i.agentConfig.IsDebug,window.fundebug.silentConsole=!i.agentConfig.IsDebug,window.fundebug.sampleRate=.3);var e=getUrlKV();e.other?e.other.PHP=i.SDKMgr.getPerformConfig(2):e.other={PHP:i.SDKMgr.getPerformConfig(2)},i.isBanShu="banshu"===i.agentConfig.AgentCode,i.agentConfig.channelName||(i.agentConfig.channelName=""),i.SDKMgr.getPerformConfig(44)||(GUILD_POST_INFO.push("英雄评论是一个辨识英雄强弱的好地方哦"),LOADING_TIPS.push("英雄评论是一个辨识英雄强弱的好地方哦")),i.Http.initServer(i.agentConfig.HttpSerever),eui.Scroller.scrollThreshold=15,i.SoundManager.init(),i.HookUtils.init(),NT.initDynamic(),GameRootLayer.gameLayer().stage.frameRate=i.MathUtils.isNumber(i.SDKMgr.getPerformConfig(11))?Number(i.SDKMgr.getPerformConfig(11)):30,game.GameMgr.getInstance().loadPerformance(),i.overRideJsonParse(),i.agentConfig.isChecking&&i.agentConfig.isChecking.HAS_RECHARGE_ACT_CODE&&!Array.isArray(i.agentConfig.isChecking.HAS_RECHARGE_ACT_CODE)&&(i.agentConfig.isChecking.HAS_RECHARGE_ACT_CODE=JSON.parse(i.agentConfig.isChecking.HAS_RECHARGE_ACT_CODE)),i.isInit=!0},i.overRideJsonParse=function(){var o=JSON.parse;JSON.parse=function(t,e){if(Array.isArray(t))return t;if(null==t)return egret.log("Json解析undefined"),[];if(""==t)return egret.log("Json解析空字符串"),[];var i=void 0;try{i=o(t.trim&&t.trim()||t,e)}catch(e){throw"Json解析失败："+t}return i}},i.enterMainOffLine=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,RES.loadGroup("preload_pack")];case 1:return e.sent(),[2,new Promise(function(e,t){i.UnlockMgr.skipAllCheckForDebug=!0,game.Config.unzipSync(void 0,function(){e()})})]}})})},i.renderTextureByRoot=function(e){if(e)try{var t=new egret.RenderTexture;t.drawToTexture(e);t.toDataURL("image/png");var i=Date.now()+"/down.png";t.saveToFile("image/png",i)}catch(e){console.log(e)}},i.ProxyUserFlag="",i.agentConfig=null,i.isBanShu=!1,i.isGuideEditor=!1,i.isNeedGuide=!1,i.isNeedUuidSot=!1,i.isSkipMapGuide=!1,i.sdkInstance=void 0,i.XYX_REMOTE_RES_HOST="__XYX_REMOTE_RES_HOST__",i.isInit=!1,i.forceCloseFilter=void 0,i}();__reflect(Utils.prototype,"Utils"),function(e){var i,t=(i=eui.Component,__extends(o,i),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.updateData()},o.prototype.updateData=function(e){if(this.data=e||this.data,this.data){var t=this.data.cost;t&&(this.CommonIconWithNum.visible=!0,this.CommonIconWithNum.updateItem({cost:t,style:CommonIconStyle.RIGHT}))}},o);function o(e){var t=i.call(this)||this;return t.data=e,t.skinName="CommonCostBtnSkin",t}e.CommonCostBtn=t,__reflect(t.prototype,"customui.CommonCostBtn")}(customui=customui||{}),function(e){var t,i=(t=eui.Component,__extends(o,t),o.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.parent.touchEnabled=!1,this.img_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onCloseCB&&e.onCloseCB()},this)},o);function o(){var e=t.call(this)||this;return e.skinName="CommonDaTanChuKuangSkin",e}e.CommonDaTanChuKuang=i,__reflect(i.prototype,"customui.CommonDaTanChuKuang",["eui.UIComponent","egret.DisplayObject"])}(customui=customui||{}),function(e){var i,t=(i=eui.Component,__extends(o,i),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.fightCap&&this.update()},o.prototype.update=function(e,t){void 0===t&&(t=!1),t?(this.img_icon.left=this.blb_fightCap.right=void 0,this.img_icon.right=-8,this.blb_fightCap.left=17):(this.img_icon.right=this.blb_fightCap.left=void 0,this.img_icon.left=-8,this.blb_fightCap.right=17),this.fightCap=null==e?this.fightCap:e,this.blb_fightCap.text=Utils.MathUtils.formatNumStyle2(this.fightCap)},o);function o(e){var t=i.call(this)||this;return t.skinName="CommonFightCapSkin",t.fightCap=e,t}e.CommonFightCapItem=t,__reflect(t.prototype,"customui.CommonFightCapItem")}(customui=customui||{}),function(t){var i,e=(i=eui.Component,__extends(o,i),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data&&this.updateItem(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this)},o.prototype.updateItem=function(e){if(this.data=e||this.data,this.data){switch(this.img_bg.visible=!1,this.showDetail=this.data.showDetail,this.data.style||CommonIconStyle.BOTTOM){case CommonIconStyle.BOTTOM:this.width=game.GeneralConfig.fixedSizeWH,this.height=game.GeneralConfig.fixedSizeWH,this.blb_num.horizontalCenter=0,this.blb_num.bottom=0,this.blb_num.scaleX=this.blb_num.scaleY=.8;break;case CommonIconStyle.RIGHT:this.height=game.GeneralConfig.fixedSizeWH,this.blb_num.verticalCenter=0,this.blb_num.x=50,this.blb_num.scaleX=this.blb_num.scaleY=.9,this.data.needBg&&(this.img_bg.visible=!0)}this.code=this.data.code||this.data.cost[1];var t=null==this.data.num?this.data.cost[2]:this.data.num,i=this.bpProxy.getInfoByCode(this.code);if(this.img_icon.source=ResourceUtils.png(i.info.icon),this.data.needShowHave){var o=game.AppFacade.getInstance().retrieveProxy(game.BackpackPy.N).getInfoByCode(this.code);this.blb_num.text=Utils.MathUtils.formatNumStyle1(o.haveNum)+"/"+t}else this.data&&this.data.notFormatNum?this.blb_num.text=t:this.blb_num.text=Utils.MathUtils.formatNumStyle1(t);null==this.data.showEnough||this.data.showEnough,this.blb_num.font="white_num_fnt"}},o.prototype.onClick=function(){if(this.showDetail){var e=t.BaseItemFactory.create();e.updateData({code:this.code}),e.onClick(),this.addChild(e),this.removeChild(e)}},o);function o(e){var t=i.call(this)||this;return t.data=e,t.skinName="CommonIconWithNumSkin",t.bpProxy=game.AppFacade.getInstance().retrieveProxy(game.BackpackPy.N),t}t.CommonIconWithNum=e,__reflect(e.prototype,"customui.CommonIconWithNum")}(customui=customui||{}),function(r){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.updateView=function(e){this.params=e,this.clickCB=e.clickCB,this.params.commonTips?this.initForCommonTips():this.initForCost(),this.params.noOKBtn&&(this.btn_confirm.visible=!1,this.btn_cancle.horizontalCenter=0)},i.prototype.initForCommonTips=function(){Array.isArray(this.params.commonTips)?this.lb_content.textFlow=this.params.commonTips:this.lb_content.text=this.params.commonTips,this.decorateBtn()},i.prototype.initForCost=function(){var e,t=this,i="string"==typeof this.params.cost?JSON.parse(this.params.cost)[0]:this.params.cost[0],o=JSON.parse(r.Config.constConfig().QuickBattleGainTime.constValue);if(o&&(e=""+this.params.costTips+(o[0]+this.guajiPy.quickBattleInfo.hCount*o[1])/3600+this.params.costTips2),egret.log(i),i){var n=r.GeneralConfig.getEntityConfigByCode(i[0],i[1]);this.lb_content.text=e?this.params.reset?"是否花费        x"+i[2]+e:"确定消耗        x"+i[2]+e:"确定消耗        x"+i[2]+"，购买一次挑战次数？",egret.log(n);var a=void 0;n.icon&&""!=n.icon?((a=new eui.Image).visible=!1,this.lb_content.parent.addChild(a),RES.getResAsync(ResourceUtils.png(n.icon),function(e){a.source=e,a.width=r.GeneralConfig.fixedSizeWH,a.height=r.GeneralConfig.fixedSizeWH,a.scaleX=a.scaleY=.8,-1!=t.lb_content.text.indexOf("(")||t.lb_content.text.indexOf("（"),a.left=102,a.top=-11},this)):((a=new eui.Label).text=n.name,this.lb_content.parent.addChild(a)),egret.setTimeout(function(){a.visible=!0},this,100)}else egret.log("没有填写消耗信息"),this.lb_content.text=this.params.reset?e:"确定"+e;this.lb_num.text="今日剩余次数："+this.params.num,this.decorateBtn()},i.prototype.decorateBtn=function(){var e=this;this.btn_cancle.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onClick(0)},this),this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),e.params&&0<e.params.num?e.onClick(1):Utils.MsgUtils.addMidMsg("今日快速开采次数已达上限，请提升vip等级！")},this)},i.prototype.onClick=function(e){this.hide(),this.clickCB&&this.clickCB({type:e})},i.BTN_STYLE={CONFIRM:{text:"确定",skin:"skins.ButtonSkinGreen"},CANCEL:{text:"取消",skin:"skins.ButtonSkinRed"},GOTO:{text:"前往",skin:"skins.ButtonSkinYellow"}},i);function i(){var e=t.call(this)||this;return e.guajiPy=r.AppFacade.getInstance().retrieveProxy(r.GuajiPy.N),e.needTipsToday=!1,e.skinName="CommonQuickBattleTipsSkin",e}r.CommonQuickBattleTips=e,__reflect(e.prototype,"game.CommonQuickBattleTips")}(game=game||{});var EasyLoadingUI=function(t){function e(){var e=t.call(this)||this;return e.curPbNextProgressValue=1,e.pbNextProgressStep=0,e.resInitDone=!1,e.isMenShow=!1,e.percentHeight=100,e.percentWidth=100,e.scaleX=Utils.DeviceUtils.additionScale(),e.scaleY=Utils.DeviceUtils.additionScale(),e.once(egret.Event.REMOVED_FROM_STAGE,function(){e.sche&&egret.clearInterval(e.sche),e.scheFade&&(egret.clearTimeout(e.scheFade),e.scheFade=void 0)},e),e}return __extends(e,t),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【EasyLoadingUI】:"].concat(e))},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tf_helpTips=new eui.Label,this.addChild(this.tf_helpTips),this.tf_helpTips.textAlign="center",this.tf_helpTips.width=615,this.tf_helpTips.horizontalCenter=0,this.tf_helpTips.bottom=120,this.tf_helpTips.bold=!0,this.tf_helpTips.italic=!0,this.tf_helpTips.lineSpacing=5,this.tf_helpTips.size=23,this.tf_helpTips.textColor=16777215},e.prototype.initDbAct=function(){var e,t=new eui.Group;for(var i in t.width=200,t.height=200,t.horizontalCenter=t.verticalCenter=0,this.addChildAt(t,1),e={lx:{name:"dljm_wyw",x:140,y:560}})DragonBoneTools.playOnce({cacheAsBitmap:!1,loop:!0,x:e[i].x,y:e[i].y,scaleX:e[i].scale||1,scaleY:e[i].scale||1,effectName:e[i].name,parent:t,timeScale:e[i].timeScale||1})},e.prototype.pbFadeUpdate=function(){var e=this;if(this.resInitDone&&!this.scheFade){var t=this.getRandomInt(50,1e3);this.scheFade=egret.setTimeout(function(){e.log("scheFade: ",t),egret.clearTimeout(e.scheFade),e.scheFade=void 0,e.pbFadeUpdate()},this,t),this.pb_layerProgress_fade.value=0,this.pb_layerProgress_fade.slideDuration=0,this.once(egret.Event.ENTER_FRAME,function(){e.scheFade&&(e.pb_layerProgress_fade.slideDuration=t,e.pb_layerProgress_fade.value=100)},this)}},e.prototype.switchTips=function(){var e=LOADING_TIPS[this.getRandomInt(0,LOADING_TIPS.length-1)];this.tf_helpTips.textFlow=[{text:"提示：",style:{textColor:1895742}},{text:e,style:{textColor:16777215}}]},e.prototype.getRandomInt=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e},e.prototype.defaultResDone=function(){var t=new eui.Image;t.horizontalCenter=0,t.verticalCenter=0;var e="bg_dengluditu_ditu_jpg";Utils.SDKMgr.getPerformConfig(22)?e=Utils.SDKMgr.getPerformConfig(22):Utils.SDKMgr.getPerformConfig(6)&&(e="bg_dengluditu_jpg"),RES.getResAsync(e,function(e){t.source=e,showGame()},this),this.addChildAt(t,0),this.pb_layerProgress=new eui.ProgressBar,this.pb_layerProgress_fade=new eui.ProgressBar,this.pb_layerProgress.slideDuration=this.pb_layerProgress_fade.slideDuration=500,this.pb_layerProgress.width=this.pb_layerProgress_fade.width=500,this.pb_layerProgress.horizontalCenter=this.pb_layerProgress_fade.horizontalCenter=0,this.pb_layerProgress.bottom=231,this.pb_layerProgress_fade.bottom=182;var i=new eui.Image;i.right=i.left=i.top=i.bottom=0,i.scale9Grid=new egret.Rectangle(26,10,1,1),RES.getResAsync("jiazai_img_jindudi_png",function(e){i.source=e},this),this.pb_layerProgress.addChild(i);var o=new eui.Image;o.right=6,o.left=6,o.top=4,o.bottom=9,o.scale9Grid=new egret.Rectangle(34,15,1,1),RES.getResAsync("jiazai_img_jindulan_png",function(e){o.source=e},this),this.pb_layerProgress.addChild(o),this.pb_layerProgress.thumb=o;var n=new eui.Image;n.right=n.left=n.top=n.bottom=0,n.scale9Grid=new egret.Rectangle(26,10,1,1),RES.getResAsync("jiazai_img_jindudi_png",function(e){n.source=e},this),this.pb_layerProgress_fade.addChild(n);var a=new eui.Image;a.right=6,a.left=6,a.top=4,a.bottom=9,a.scale9Grid=new egret.Rectangle(34,15,1,1),RES.getResAsync("jiazai_img_jindulan_png",function(e){a.source=e},this),this.pb_layerProgress_fade.addChild(a),this.pb_layerProgress_fade.thumb=a;var r=new eui.Image;r.horizontalCenter=0,r.bottom=281,RES.getResAsync("jiazai_img_lipin_png",function(e){r.source=e},this),this.addChild(r),this.addChild(this.pb_layerProgress),this.addChild(this.pb_layerProgress_fade),this.resInitDone=!0,this.pbFadeUpdate()},e.prototype.setProgress=function(e,t){var i=this;if(!("LOGIN_INTO_MAP"==this.forceForName&&(t<50?t=50:t+=20,e<this.pb_layerProgress.value))){if(this.log("Loading progress: "+e+"/"+t),1==e){if(this.switchTips(),this.pbNextProgressStep=Math.floor(100/t),!this.sche){var o=0,n=0;this.sche=egret.setInterval(function(){n+=250,3e3<=(o+=250)&&(o=0,i.switchTips()),1e3<=n&&i.pb_layerProgress&&(n=0,i.pb_layerProgress.value<i.curPbNextProgressValue&&(i.pb_layerProgress.value+=1))},this,250)}}else this.curPbNextProgressValue=Math.min(100,(e+1)*this.pbNextProgressStep);this.pb_layerProgress&&(this.pb_layerProgress.value=Math.floor(e/t*100),this.pb_layerProgress.maximum=100)}},e.prototype.onProgress=function(e,t){this.setProgress(e,t)},e.prototype.switchMenLoading=function(e,t,i){if(e){if(i&&(this.forceForName=i),this.isMenShow)return void(t&&t());this.visible=!0,this.pbFadeUpdate(),this.isMenShow=!0,t&&t()}else{if(this.forceForName&&this.forceForName!=i)return void(t&&t());if(this.forceForName=void 0,!this.isMenShow)return void(t&&t());this.pbFadeFullDoneAndHideMen(t)}},e.prototype.pbFadeFullDoneAndHideMen=function(e){var t=this;this.sche&&(egret.clearInterval(this.sche),this.sche=void 0),this.scheFade&&(egret.clearTimeout(this.scheFade),this.scheFade=void 0),this.pb_layerProgress_fade.slideDuration=this.pb_layerProgress.slideDuration=0,this.pb_layerProgress_fade.value=this.pb_layerProgress.value=100,egret.setTimeout(function(){t.pb_layerProgress_fade.slideDuration=t.pb_layerProgress.slideDuration=500,t.pb_layerProgress_fade.value=t.pb_layerProgress.value=0,t.isMenShow=!1,t.visible=!1,e&&e()},this,100)},e}(eui.UILayer);__reflect(EasyLoadingUI.prototype,"EasyLoadingUI",["RES.PromiseTaskReporter"]),function(e){var i,t=(i=eui.Component,__extends(r,i),r.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.costInfo&&this.updateBar(this.costInfo)},r.prototype.updateBar=function(i){var o=this;this.costInfo=this.decodeData(i);var n="string"!=typeof i&&!Array.isArray(i)&&i.width||r.WIDTH_FOR_NUM[this.costInfo.length]||r.WIDTH_FOR_NUM[2],e=i.gap||15;this.gp_root.removeChildren();var t=this.costInfo;this.gp_root.layout.gap=e,Array.isArray(this.costInfo[0])&&(t=[],this.costInfo.forEach(function(e){t.push(e[1])}));var a=!0;Utils.SDKMgr.getPerformConfig(1)&&(Utils.SDKMgr.getPerformConfig(19)||(a=!1)),t.forEach(function(e){var t=o.bpProxy.getInfoByCode(e);t.info&&o.gp_root.addChild(new s({icon:t.info.icon,num:t.haveNum,width:n,addClickWayFunc:a&&i.needAdd&&(r.WAY_CONFIG[e]||i.wayFunc)}))})},r.prototype.decodeData=function(e){return"string"==typeof e?JSON.parse(e):Array.isArray(e)?e:e.costs?this.decodeData(e.costs):[]},r.WAY_CONFIG=((n={})[EPropertyType.EPropertyTypeDiamond]=function(){game.MainJumpConfig.jumpTo(MODULE.Recharge)},n[EPropertyType.EPropertyTypeGold]=function(){game.AppFacade.getInstance().showSubView(game.TouchGoldHandMediator.N,game.TouchGoldHandMediator.SV.MAIN)},n.ActivityZoneDevoteGoods=function(){},n),r.WIDTH_FOR_NUM={2:215,3:185},r);function r(e){var t=i.call(this)||this;return t.costInfo=e,t.skinName="CommonResourceBarSkin",t.bpProxy=game.AppFacade.getInstance().retrieveProxy(game.BackpackPy.N),t}e.CommonResourceBar=t,__reflect(t.prototype,"customui.CommonResourceBar");var o,n,s=(o=eui.Component,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.updateItem()},a.prototype.updateItem=function(){this.data&&(this.width=this.data.width,this.img_icon.source=ResourceUtils.png(this.data.icon),this.blb_num.text=Utils.MathUtils.formatNumStyle1(this.data.num),this.data.addClickWayFunc&&(this.btn_add.visible=!0,this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.data.addClickWayFunc()},this)))},a);function a(e){var t=o.call(this)||this;return t.data=e,t.skinName="CommonResourceBarSkin_ResourceItem",t}e.ResourceItem=s,__reflect(s.prototype,"customui.ResourceItem")}(customui=customui||{}),function(i){var e=(t.registerAll=function(){(new A).register()},t);function t(){}i.BackpackProcessor=e,__reflect(e.prototype,"game.BackpackProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){this.checkCB(e.getBody())&&(Utils.DebugUtils.dumpPbMsg(e.getBody()),i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N).updateItemInfo(e.getBody().items))},a);function a(){return o.call(this,"bag.GetPlayerItemR",a)||this}i.GetPlayerItemR=n,__reflect(n.prototype,"game.GetPlayerItemR");var r,s=(r=i.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){this.checkCB(e.getBody())},c);function c(){return r.call(this,"bag.ExpandEquipBagR",c)||this}i.ExpandEquipBagR=s,__reflect(s.prototype,"game.ExpandEquipBagR");var l,h=(l=i.ProcessorBase,__extends(p,l),p.prototype.execute=function(e){this.checkCB(e.getBody())},p);function p(){return l.call(this,"bag.UsePropR",p)||this}i.UsePropR=h,__reflect(h.prototype,"game.UsePropR");var d,u=(d=i.ProcessorBase,__extends(g,d),g.prototype.execute=function(e){this.checkCB(e.getBody())},g);function g(){return d.call(this,"bag.SellEquipR",g)||this}i.SellEquipR=u,__reflect(u.prototype,"game.SellEquipR");var f,_=(f=i.ProcessorBase,__extends(m,f),m.prototype.execute=function(e){this.checkCB(e.getBody())},m);function m(){return f.call(this,"bag.SellAllEquipR",m)||this}i.SellAllEquipR=_,__reflect(_.prototype,"game.SellAllEquipR");var y,v=(y=i.ProcessorBase,__extends(T,y),T.prototype.execute=function(e){this.checkCB(e.getBody())},T);function T(){return y.call(this,"bag.SetEquipAutoSellR",T)||this}i.SetEquipAutoSellR=v,__reflect(v.prototype,"game.SetEquipAutoSellR");var C,E=(C=i.ProcessorBase,__extends(I,C),I.prototype.execute=function(e){this.checkCB(e.getBody())},I);function I(){return C.call(this,"bag.SellEquipsR",I)||this}i.SellEquipsR=E,__reflect(E.prototype,"game.SellEquipsR");var b,A=(b=i.ProcessorBase,__extends(P,b),P.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N).updateModuleTeam(t.moduleTeam)},P);function P(){return b.call(this,"team.TeamInfoP",P)||this}i.TeamInfoP=A,__reflect(A.prototype,"game.TeamInfoP")}(game=game||{}),function(y){var t,e=(__extends(i,t=BaseProxy),i.prototype.checkChipNotice=function(e){for(var t in this.AllItemInfo){this.AllItemInfo[t];var i=y.Config.itemConfig()[t];if(i&&i.type==EPropType.EPropTypeChip&&(!e||e==Number(t))&&this.getItemNumByCode(t)>=i.effectEx)return!0}return!1},i.prototype.checkSmithyNotice=function(){var e=JSON.parse(y.Config.constConfig().SmithyForgeIronCosts.constValue);return!!this.checkEnough(e,!1)},i.prototype.Decompose=function(t,e){var i=this;void 0===e&&(e=!0);var n={heroUuids:[],equipUuids:[],artifactUuids:[],immortalUuids:[],itemCostList:[],petUuids:[],type:t.type};if(t.chosenItem.forEach(function(e){switch(t.type){case EEntityType.EEntityTypeHero:n.heroUuids.push({heroUuid:e.uuid,num:1});break;case EEntityType.EEntityTypeHeroArtifact:n.artifactUuids.push({artifactUuid:e.uuid,num:e.num||1});break;case EEntityType.EEntityTypeHeroEquip:n.equipUuids.push({equipUuid:e.uuid,num:e.num||1});break;case EEntityType.EEntityTypePet:n.petUuids.push({uuid:e.uuid,num:e.num||1});break;case EEntityType.EEntityTypeImmortal:n.immortalUuids.push({uuid:e.uuid,num:e.num||1});break;case EEntityType.EEntityTypeItem:var i=parseInt(e.code.split("_")[0]),o=!1;n.itemCostList.forEach(function(e,t){e.code==i&&(o=!0,n.itemCostList[t].num++)}),o||n.itemCostList.push({code:i,num:1})}}),e){var o=[];n.heroUuids.forEach(function(e){o.push(e.heroUuid)});var a=y.GameMVC.backpackPy.checkMultiTeamTips(o);a?y.GameMgr.getInstance().showCommonTipsWin({commonTips:"选中的英雄中"+a.name+"在"+a.teamModuleName+"上阵，是否作为材料消耗？",clickCB:function(e){1==e.type&&i.Decompose(t,!1)}}):this.Decompose(t,!1)}else t.preview?Utils.Socket.send("decompose","DecomposePreview",n).then(function(e){i.log("分解预览 DecomposePreviewR",e),t.cb&&t.cb(),y.AppFacade.getInstance().showSubView(y.CommonMediator.N,y.CommonMediator.SV.REWARD_PANEL,{title:"奖励",rewards:e.rewardPreview,btnText:"确定",type:y.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})}):Utils.Socket.send("decompose","Decompose",n).then(function(e){i.log("分解 DecomposeR",e),i.DecomposeInfo=e.info,i.decompose_spirte_temInfo=void 0,t.cb&&t.cb(e),t.noShowReward||i.handleClientReward(e.clientReward,{title:"分解奖励",btnText:"领取",onCloseCB:function(){Utils.MsgUtils.addMidMsg("领取成功")}})})},i.prototype.GetDecomposeInfo=function(){var t=this;Utils.Socket.send("decompose","GetDecomposeInfo",{}).then(function(e){t.DecomposeInfo=e.info})},i.prototype.GetDecomposeRewards=function(e,t){var i=this;Utils.Socket.send("decompose","GetDecomposeRewards",{type:e}).then(function(e){i.DecomposeInfo=e.info,i.handleClientReward(e.clientReward),t&&t()})},i.prototype.getDecomposeProcess=function(e){if(!this.DecomposeInfo||!this.DecomposeInfo.coreInfo)return 0;for(var t in this.DecomposeInfo.coreInfo){var i=this.DecomposeInfo.coreInfo[t];if(i.type==e)return i.num}return 0},i.prototype.switchLock=function(t){Utils.Socket.send("lock",t.lock?"Lock":"Unlock",{type:t.type,uuid:t.uuid}).then(function(e){Utils.MsgUtils.addMidMsg(t.lock?"上锁成功":"解锁成功"),e.hero&&y.GameMVC.heroPy.updateHeroDict(e.hero),e.heroEquip&&y.GameMVC.heroThingPy.updateEquipInfo([e.heroEquip],!1),e.heroArtifact&&y.GameMVC.heroThingPy.updateArtifactInfo([e.heroArtifact]),t.cb&&t.cb(e)})},i.prototype.updateItemInfo=function(e){this.AllItemInfo={};for(var t=0,i=e;t<i.length;t++){var o=i[t];this.AllItemInfo[o.code]||(this.AllItemInfo[o.code]={}),this.AllItemInfo[o.code][o.expiredDt||0]={num:o.num,dt:o.dt}}y.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE)},i.prototype.getItemByType=function(e){var t=[];for(var i in this.AllItemInfo){var o=y.Config.itemConfig()[i];o&&o.type==e&&t.push({c:o,num:this.getItemNumByCode(i)})}return t.sort(function(e,t){return e.c.color!=t.c.color?t.c.color-e.c.color:e.c.code-t.c.code}),t},i.prototype.getHeroAritfactInfoByCode=function(e,t){var i=y.GameMVC.heroThingPy.AllArtiInfo,o=0,n=this.heroThingPy;for(var a in i){var r=i[a];r.code!=e||!n.isArtifactNewOne(r.uuid)||r.heroUuid||void 0!==t&&r.isLocked!==t||(o+=r.num)}return o},i.prototype.checkEnough=function(e,t){void 0===t&&(t=!1);var i=!1;0==e.length&&(i=!0);for(var o=0,n=e;o<n.length;o++){var a=n[o],r=a.type||a[0],s=a.code||a[1],c=a.num||a[2];switch(null!=r?r:Math.floor(Number(s)/1e7)||EEntityType.EEntityTypeMoney){case EEntityType.EEntityTypeMoney:i=c<=this.updateMoneyNum(s);break;case EEntityType.EEntityTypeExp:i=c<=this.updateExpNum(s);break;case EEntityType.EEntityTypeItem:i=c<=this.getItemNumByCode(s);break;case EEntityType.EEntityTypeHero:for(var l in this.heroPy.allHeroByUuid)if(this.heroPy.allHeroByUuid[l].config.code==s){i=!0;break}break;case EEntityType.EEntityTypeHeroEquip:break;case EEntityType.EEntityTypeHeroArtifactCode:case EEntityType.EEntityTypeHeroArtifact:i=c<=this.getHeroAritfactInfoByCode(s,!1);break;case EEntityType.EEntityTypePet:break;case EEntityType.EEntityTypeVestageItem:i=c<=(y.GameMVC.dungeonPy.itemInfo[s]||0)}if(!i){if(t)if(r==EEntityType.EEntityTypeMoney&&s==EPropertyType.EPropertyTypeDiamond)Utils.MsgUtils.addMidMsg("钻石不足"),y.GameMgr.getInstance().showCommonTipsWin({commonTips:"很遗憾，您的钻石不足，购买失败",cb:!1,btnLabel:{cancel:"取消",sure:"前往充值"},clickCB:function(e){0===e.type||1===e.type&&y.MainJumpConfig.jumpTo(MODULE.VIP)}});else{var h=y.GeneralConfig.getEntityConfigByCode(r,s);Utils.MsgUtils.addMidMsg(h.name+"不足"),PopUpManager.addPopUp({obj:new y.BaseItemDetailView({code:s,config:{type:r},showAccessNow:!1})})}break}}return i},i.prototype.updateMoneyNum=function(e,t){void 0===t&&(t=0);var i,o=y.AppFacade.getInstance().retrieveProxy(y.PlayerPy.N);return i=this.playerInfo.playerInfoVO.playerMoney[e]+t,o.playerInfoVO.playerMoney[e]=i,0!=t&&y.AppFacade.getInstance().sendNotification(CN.MONEY_UPDATE),i},i.prototype.updateExpNum=function(e,t){void 0===t&&(t=0);var i=0;if(e==EExpType.EExpTypePlayer)i=(o=y.AppFacade.getInstance().retrieveProxy(y.PlayerPy.N)).playerInfoVO.exp+t,o.playerInfoVO.exp=i;else if(e==EExpType.EExpTypeVip){var o;i=(o=y.AppFacade.getInstance().retrieveProxy(y.PlayerPy.N)).playerInfoVO.playerVip.exp+t,o.playerInfoVO.playerVip.exp=i}else EExpType.EExpTypeGuild;return i},i.prototype.getItemNumByCode=function(e){var t=0;if(this.AllItemInfo[e])for(var i in this.AllItemInfo[e])t+=this.AllItemInfo[e][i].num;return t},i.prototype.getInfoByCode=function(e,t){var i=Math.floor(Number(e)/1e7);return i=i||EEntityType.EEntityTypeMoney,this.getInfoByTypeCodeNum(i,e,t)},i.prototype.getInfoByTypeCodeNum=function(e,t,i){var o={};switch(e==EEntityType.EEntityTypeHeroArtifactCode&&(e=EEntityType.EEntityTypeHeroArtifact),o.info=y.GeneralConfig.getEntityConfigByCode(e,t),o.haveNum=0,o.voData=void 0,e){case EEntityType.EEntityTypeMoney:o.haveNum=this.updateMoneyNum(t);break;case EEntityType.EEntityTypeExp:o.haveNum=this.updateExpNum(t);break;case EEntityType.EEntityTypeItem:o.haveNum=this.getItemNumByCode(t);break;case EEntityType.EEntityTypeHeroArtifact:o.haveNum=this.getHeroAritfactInfoByCode(t,i);break;case EEntityType.EEntityTypeVestageItem:o.haveNum=y.GameMVC.dungeonPy.itemInfo[t]||0}return o},i.prototype.getItemsBySubType=function(e){var t=y.Config.itemConfig(),i=[];for(var o in this.AllItemInfo){this.AllItemInfo[o];var n=t[o];n&&n.type==e&&i.push(o)}return i},i.prototype.handleClientReward=function(e,t){if(e){for(var i=e,o=[],n=0,a=i.rewards;n<a.length;n++){var r=a[n];2==r.type&&5==r.code||o.push(r)}i.rewards=o;var s=!1;for(var c in i){var l=i[c];if(l&&"object"==typeof l&&0<l.length){s=!0;break}}if(s){var h={rewards:i};for(var p in t)h[p]=t[p];if(y.AppFacade.getInstance().showSubView(y.CommonMediator.N,y.CommonMediator.SV.REWARD_PANEL,h),e&&e.rewards)for(var p in e.rewards)switch(e.rewards[p].type){case EEntityType.EEntityTypeMoney:case EEntityType.EEntityTypeItem:this.sendNotification(CN.MONEY_UPDATE),this.sendNotification(CN.PLAYER_INFO_UPDATE)}}}},i.prototype.handleClientRewardCore=function(e,t,i){if(e){y.AppFacade.getInstance().retrieveProxy(y.PlayerPy.N);var o={};for(var n in e.rewards){var a=e.rewards[n];switch(o[a.type]||(o[a.type]=!0),a.type){case EEntityType.EEntityTypeMoney:this.updateMoneyNum(a.code,a.num),this.sendNotification(CN.PLAYER_INFO_UPDATE);break;case EEntityType.EEntityTypeExp:this.updateExpNum(a.code,a.num),this.sendNotification(CN.PLAYER_INFO_UPDATE);break;case EEntityType.EEntityTypeItem:Array.isArray(o[a.type])||(o[a.type]=[]),o[a.type].push(a.code),this.AllItemInfo[a.code]?(this.AllItemInfo[a.code][a.expiredDt||0]||(this.AllItemInfo[a.code][a.expiredDt||0]={num:0,dt:a.dt}),this.AllItemInfo[a.code][a.expiredDt||0].num+=a.num):this.AllItemInfo[a.code]=((_={})[a.expiredDt||0]={num:a.num,dt:a.dt},_);break;case EEntityType.EEntityTypeVestageItem:var r=y.GameMVC.dungeonPy.itemInfo;r[a.code]?r[a.code]+=a.num:r[a.code]=a.num}}var s=e.heros;s&&0<s.length&&(o[EEntityType.EEntityTypeHero]=!0,this.heroPy.updateHeroDict(s));var c=e.heroEquips;if(c&&0<c.length){o[EEntityType.EEntityTypeHeroEquip]=!0;var l=this.heroThingPy.getEquipDifference(c);this.heroThingPy.updateEquipInfo(c,!1),e.heroEquips=l}var h=e.heroArtifacts;h&&0<h.length&&(o[EEntityType.EEntityTypeHeroArtifact]=!0,l=this.heroThingPy.getArtiDifference(h),this.heroThingPy.updateArtifactInfo(h,!1),e.heroArtifacts=l);var p=e.magicals;p&&0<p.length&&(o[EEntityType.EEntityTypeMagical]=!0,this.MagicalPy.updateMagicalDict(p));var d=e.pets;d&&0<d.length&&(o[EEntityType.EEntityTypePet]=!0,this.petPy.updatePetDict(d));var u=e.treasures;u&&0<u.length&&(o[EEntityType.EEntityTypeTreasure]=!0,this.heroThingPy.updateTreasureInfo(u,!1));var g=e.immortals;g&&0<g.length&&(o[EEntityType.EEntityTypeImmortal]=!0,l=this.heroThingPy.getImmortalDifference(g),this.heroThingPy.updateImmortalInfo(g,!1),e.immortals=l);var f=e.maps;f&&0<f.length&&(o[EEntityType.EEntityTypeMap]=!0,this.guajiPy.updateMapInfo(f));var _,m=e.vestageHeros;m&&0<m.length&&(o[EEntityType.EEntityTypeVestageHero]=!0,y.GameMVC.dungeonPy.updateHeroListInfo(m)),NoticeManager.localResUpdate(o),y.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE)}},i.prototype.handleClientCost=function(e){},i.prototype.handleClientCostCore=function(e){if(e){var t={};for(var i in e.costs){var o=e.costs[i];switch(t[o.type]||(t[o.type]=!0),o.type){case EEntityType.EEntityTypeMoney:this.updateMoneyNum(o.code,-o.num),this.sendNotification(CN.PLAYER_INFO_UPDATE);break;case EEntityType.EEntityTypeExp:this.updateExpNum(o.code,-o.num),this.sendNotification(CN.PLAYER_INFO_UPDATE);break;case EEntityType.EEntityTypeItem:Array.isArray(t[o.type])||(t[o.type]=[]),t[o.type].push(o.code),this.AllItemInfo[o.code][o.expiredDt||0].num-=o.num,this.getItemNumByCode(o.code)?this.AllItemInfo[o.code][o.expiredDt||0].num<=0&&delete this.AllItemInfo[o.code][o.expiredDt||0]:delete this.AllItemInfo[o.code];break;case EEntityType.EEntityTypeVestageItem:var n=y.GameMVC.dungeonPy.itemInfo;n[o.code]&&(n[o.code]-=o.num)}}var a=e.heroUuids;a&&0<a.length&&(t[EEntityType.EEntityTypeHero]=!0,this.heroPy.deteleByUuids(a));var r=e.heroEquips;r&&0<r.length&&(t[EEntityType.EEntityTypeHeroEquip]=!0,this.heroThingPy.deleteEquipInfo(r));var s=e.heroArtifacts;s&&0<s.length&&(t[EEntityType.EEntityTypeHeroArtifact]=!0,this.heroThingPy.deleteArtifactInfo(s));var c=e.petUuids;c&&0<c.length&&(t[EEntityType.EEntityTypePet]=!0,this.petPy.deteleByUuids(c));var l=e.magicals;l&&0<l.length&&(t[EEntityType.EEntityTypeMagical]=!0,this.MagicalPy.updateMagicalDict(l));var h=e.immortals;h&&0<h.length&&(t[EEntityType.EEntityTypeImmortal]=!0,this.heroThingPy.deleteImmortal(h));var p=e.treasures;p&&0<p.length&&(t[EEntityType.EEntityTypeTreasure]=!0,this.heroThingPy.updateTreasureInfo(p));var d=e.vestageHeroUuids;d&&0<d.length&&(t[EEntityType.EEntityTypeVestageHero]=!0,y.GameMVC.dungeonPy.deleteHeroByUuids(d)),NoticeManager.localResUpdate(t),y.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE)}},i.prototype.getInfoByUuidAndType=function(e,t){switch(t){case EEntityType.EEntityTypeHero:return this.heroPy.allHeroByUuid[e];case EEntityType.EEntityTypeHeroEquip:return this.heroThingPy.AllEquipInfo[e];case EEntityType.EEntityTypeHeroArtifact:return this.heroThingPy.AllArtiInfo[e];case EEntityType.EEntityTypeTreasure:return this.heroThingPy.AllTreasureInfo[e];default:return}},i.prototype.UseProp=function(e,t,i,o,n,a){var r=this;void 0===o&&(o=!0),void 0===n&&(n=""),Utils.Socket.send("bag","UseProp",{code:e,num:t,id:i,ext:n}).then(function(e){o&&r.handleClientReward(e.clientReward),a&&a()})},i.prototype.GetPlayerItem=function(){var t=this;Utils.Socket.send("bag","GetPlayerItem",{}).then(function(e){t.updateItemInfo(e.items)})},i.prototype.compound=function(t){var i=this;Utils.Socket.send("bag","Compound",{code:t.code,num:t.num}).then(function(e){i.log("合成 CompoundR",e),t.cb&&t.cb(),y.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE),i.handleClientReward(e.clientReward,{type:y.CommonRewardPreviewPanel.REWARD_TYPE.REWARD,action:"Compound"})})},i.prototype.SellProp=function(e,t){Utils.Socket.send("bag","SellProp",{code:e.code,num:e.num}).then(function(e){t&&t(),e.clientReward&&y.AppFacade.getInstance().retrieveProxy(i.N).handleClientReward(e.clientReward,2)})},i.prototype.resetHeroUuid2ModuleTeamCache=function(){this.heroUuid2ModuleTeamCache={}},i.prototype.checkMultiTeamTips=function(e){var t=void 0;if(Array.isArray(e))for(var i=0,o=e;i<o.length;i++){var n,a=o[i];if(n=this.checkHeroInTeam(a)){t={name:this.heroPy.allHeroByUuid[a].config.name,teamModuleName:MULTI_TEAM_MODULE_NAME[n]||"玩法"};break}}else(n=this.checkHeroInTeam(e))&&(t={name:this.heroPy.allHeroByUuid[e].config.name,teamModuleName:MULTI_TEAM_MODULE_NAME[n]||"玩法"});return t},i.prototype.checkHeroInTeam=function(e,t){if(null!=this.heroUuid2ModuleTeamCache[e])return this.heroUuid2ModuleTeamCache[e];var i=void 0;if(!this.heroPy.heroUuid22Pos[e]){if(t&&this.getModuleTeam(t)){e:for(var o=0,n=this.getModuleTeam(t).teams;o<n.length;o++)for(var a=0,r=n[o].heros;a<r.length;a++)if(e==r[a].uuid){i=t;break e}}else e:for(var s in this._moduleTeam)for(var c=0,l=this._moduleTeam[s].teams;c<l.length;c++)for(var h=0,p=l[c].heros;h<p.length;h++)if(e==p[h].uuid){i=s;break e}return this.heroUuid2ModuleTeamCache[e]=i}},i.prototype.getModuleTeam=function(e){return this._moduleTeam[e]?this._moduleTeam[e]:void 0},i.prototype.updateModuleTeam=function(e){var t=this;Array.isArray(e)?(this._moduleTeam={},e.forEach(function(e){t._moduleTeam[e.type]=e})):this._moduleTeam[e.type]=e,this.sendNotification(CN.BACKPACK_MULTI_TEAM_UPDATE)},i.prototype.GetTeamInfo=function(e,t){var i=this;e=e||0,Utils.Socket.send("team","GetTeamInfo",{type:e}).then(function(e){i.updateModuleTeam(e.moduleTeams),t&&t()})},i.prototype.ChangeFormation=function(e,t){var i=this;Utils.Socket.send("team","ChangeFormation",{moduleTeams:e}).then(function(e){i.updateModuleTeam(e.moduleTeams),t&&t()})},i.N="BackpackProxy",i);function i(){var e=t.call(this,i.N)||this;return e._moduleTeam={},e.heroUuid2ModuleTeamCache={},e.decompose_spirte_temInfo=void 0,e.maxSizes=0,e.AllItemInfo={},e.playerInfo=y.AppFacade.getInstance().retrieveProxy(y.PlayerPy.N),e.heroPy=y.AppFacade.getInstance().retrieveProxy(y.HeroPy.N),e.heroThingPy=y.AppFacade.getInstance().retrieveProxy(y.HeroThingPy.N),e.MagicalPy=y.AppFacade.getInstance().retrieveProxy(y.MagicalArtifactPy.N),e.petPy=y.AppFacade.getInstance().retrieveProxy(y.PetPy.N),e.guajiPy=y.AppFacade.getInstance().retrieveProxy(y.GuajiPy.N),NoticeManager.registerCB(NT.BACKPACK_CHIP,e.checkChipNotice,e),NoticeManager.registerCB(NT.SMITHY,e.checkSmithyNotice,e,MODULE.Smithy),NoticeManager.setChildType(NT.SMITHY_ENTRANCE,NT.SMITHY),e}y.BackpackPy=e,__reflect(e.prototype,"game.BackpackPy")}(game=game||{}),function(h){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initTabbar(),this.initList(),this.activateComponent(),this.initialized=!1,this.tabbar_type.visible=!1,this.gp_content.scaleX=this.gp_content.scaleY=1},t.prototype.initList=function(){this.list_item.itemRenderer=h.BackpackUI_Item,this.ac_item=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_item,this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListItemTap,this),this.list_filter.itemRenderer=h.BackpackUI_FilterItem,this.list_filter.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onFilterListItemTap,this)},t.prototype.initTabbar=function(){var e=[];for(var t in this.ITEM_TYPE_CONFIG){var i=this.ITEM_TYPE_CONFIG[t];e.push({source:i.barSource})}this.tabbar_type.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar_type.dataProvider=new eui.ArrayCollection(e),this.tabbar_type.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this),this.tabbar_sort_item.itemRendererSkinName="BackPackUI_SortItem",this.tabbar_sort_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSorterItemTap,this)},t.prototype.onBarItemTap=function(e){e.itemIndex!=this.curType&&(this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0,Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.updateView({type:e.itemIndex}))},t.prototype.onFilterListItemTap=function(e){this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0,this.curFilter&&this.curFilter==e.item.data?this.curFilter=void 0:this.curFilter=e.item.data;var t=this.list_filter.dataProvider;for(var i in t.source){var o=t.source[i];o==e.item?o.chosen=!o.chosen:o.chosen=!1}t.refresh(),this.updateList(!1)},t.prototype.onSorterItemTap=function(e){this.updateList(!0)},t.prototype.onListItemTap=function(e){var t=e.item.type,i=e.item.info;switch(t){case h.BackpackUI.ITEM_TYPE.HERO:h.AppFacade.getInstance().showSubView(h.HeroMediator.N,h.HeroMediator.SV.HERO_QUICK_TRAIN,{uuid:i.uuid,allUuids:this.allUuids});break;case h.BackpackUI.ITEM_TYPE.ITEM:break;case h.BackpackUI.ITEM_TYPE.PET:h.AppFacade.getInstance().showSubView(h.PetMediator.N,h.PetMediator.SV.SELF_PET_DETAIL,{uuid:i.uuid});break;case h.BackpackUI.ITEM_TYPE.EQUIP:case h.BackpackUI.ITEM_TYPE.CHIP:case h.BackpackUI.ITEM_TYPE.ARTIFACT:case h.BackpackUI.ITEM_TYPE.TREASURE:}},t.prototype.updateView=function(e){var t=e&&null!=e.type&&e.type!=this.curType;e&&null!=e.type&&(this.curType=e.type),this.targetConfig=this.ITEM_TYPE_CONFIG[this.curType],!t&&this.initialized||(this.initialized=!0,this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0,this.resetFilterAndSorter()),this.updateList(!0),this.updateNotice(),this.curType==h.BackpackUI.ITEM_TYPE.PET?this.gp_capacity.verticalCenter=368:this.gp_capacity.verticalCenter=314},t.prototype.updateList=function(e){var t=[],i=this.targetConfig.filterConfig&&this.targetConfig.filterConfig.filterFunc||function(){return!0},o=this.targetConfig.sortConfig&&(this.targetConfig.sortConfig.defaultSortFunc||this.targetConfig.sortConfig.getSortFunc(this.tabbar_sort_item.selectedIndex)),n=this.targetConfig.getAllInfo();if(n)for(var a in n){var r=n[a];i(this.curFilter,r)&&t.push({type:this.curType,info:r,view:this})}0<t.length?(this.gp_empty.visible=!1,o&&t.sort(o)):(this.gp_empty.visible=!0,this.lb_empty_tips.text="还没有"+this.targetConfig.desc);var s=[];if(t.forEach(function(e){s.push(e.info.uuid)}),this.allUuids=s,this._listChildrenNum=0,this.list_item.$children.forEach(function(e){e.eventDispatched=!1}),this.ac_item.replaceAll(t),this.list_item.layout.verticalGap=this.curType===h.BackpackUI.ITEM_TYPE.CHIP?5:-15,e){var c=0,l=(h.GameMVC.playerPy.playerInfoVO.playerVip.vipLevel,h.Config.VIPConfig());l&&(c=l.maxBagSize),this.bm_capacity.text="容量 "+n.length+"/"+c}},t.prototype.resetFilterAndSorter=function(){if(this.targetConfig.filterConfig){this.list_filter.visible=!0,this.curFilter=void 0;var e,t=[];"英魂"==this.targetConfig.desc?((e=new eui.HorizontalLayout).horizontalAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE,e.gap=7,this.list_filter.layout=e,this.targetConfig.filterConfig.data.forEach(function(e){t.push({data:e,chosen:!1,isHero:!0})}),this.list_filter.horizontalCenter=-20):((e=new eui.HorizontalLayout).horizontalAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE,e.gap=15,this.list_filter.layout=e,this.targetConfig.filterConfig.data.forEach(function(e){t.push({data:e,chosen:!1,isHero:!1})}),this.list_filter.horizontalCenter=0),this.list_filter.dataProvider=new eui.ArrayCollection(t)}else this.list_filter.visible=!1;this.targetConfig.addBtn?(this.btn_handbook.visible=!0,this.btn_handbook.width=67,this.btn_handbook.label=this.targetConfig.addBtn.label,this.btn_handbook.icon=this.targetConfig.addBtn.icon):(this.btn_handbook.width=0,this.btn_handbook.visible=!1),this.gp_sort.visible=!1,this.blb_title.text=this.targetConfig.desc},t.prototype.activateComponent=function(){var e=this;this.btn_showSort.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_sort_pop.visible=!this.gp_sort_pop.visible},this),this.btn_handbook.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.targetConfig.addBtn&&e.targetConfig.addBtn.btnFunc&&e.targetConfig.addBtn.btnFunc.call(e)},this),this.addEventListener(h.BackpackUI.EVENT_ITEM_CREATED,function(){e._listChildrenNum+=1,e._listChildrenNum==e.list_item.dataProvider.length&&e.dispatchEventWith(h.BackpackUI.EVENT_ALL_ITEM_CREATED)},this),this.addEventListener(h.BackpackUI.EVENT_ALL_ITEM_CREATED,function(){h.AppFacade.getInstance().sendNotification(CN.GUIDE_CHECK_CUR_STEP)},this)},t.prototype.showList=function(){this.list_item.visible=!0,this.updateList(!0)},t);function t(e){var t,s=i.call(this)||this;return s.backpackProxy=h.AppFacade.getInstance().retrieveProxy(h.BackpackPy.N),s.heroPy=h.AppFacade.getInstance().retrieveProxy(h.HeroPy.N),s.allUuids=[],s.ITEM_TYPE_CONFIG=((t={})[h.BackpackUI.ITEM_TYPE.HERO_SPRITE]={desc:"英魂",barSource:{up:"_btn_yq_m_json.beibao_yeqian_suipian_0",down:"_btn_yq_m_json.beibao_yeqian_suipian_1"},getAllInfo:function(){var e=[],t=h.AppFacade.getInstance().retrieveProxy(h.BackpackPy.N).AllItemInfo,i=h.Config.itemConfig(),o=[EPropType.EPropTypeHeroSpirit];for(var n in t){var a=i[n];if(a&&-1!=o.indexOf(a.type))for(var r=s.backpackProxy.getItemNumByCode(n);r--;)e.push({code:Number(n),num:1,race:a.race,color:a.color})}return e},sortConfig:{defaultSortFunc:function(e,t){var i=e.info,o=t.info;return i.color!=o.color?o.color-i.color:i.race!=o.race?o.race-i.race:i.code!=o.code?o.code-i.code:void 0}},filterConfig:{data:[{race:HeroRaceType.Human,icon:"_hero_ar_m_json.common_icon_zhongzu_1",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Orc,icon:"_hero_ar_m_json.common_icon_zhongzu_2",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Elf,icon:"_hero_ar_m_json.common_icon_zhongzu_4",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Athanasy,icon:"_hero_ar_m_json.common_icon_zhongzu_3",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Demon,icon:"_hero_ar_m_json.common_icon_zhongzu_5",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Eldar,icon:"_hero_ar_m_json.common_icon_zhongzu_6",chosenImg:"common_icon_xuanzhongyuan_png"}],filterFunc:function(e,t){return!e||e.race==t.race}},addBtn:{label:"分解",icon:"common_icon_fenjie_png",btnFunc:function(){s.list_item.visible=!1,h.MainJumpConfig.jumpTo(MODULE.DecomposeHeroSpirit)}}},t[h.BackpackUI.ITEM_TYPE.PET]={desc:"宠 物",barSource:{up:"_btn_yq_m_json.beibao_yeqian_suipian_0",down:"_btn_yq_m_json.beibao_yeqian_suipian_1"},getAllInfo:function(){var e=[],t=h.GameMVC.petPy.allPetByUuid;for(var i in t){var o=t[i];e.push({entityType:EEntityType.EEntityTypePet,code:o.code,uuid:o.uuid,level:o.level,fightCap:o.fightCap,sortKey:o.sortKey})}return e},sortConfig:{defaultSortFunc:function(e,t){var i=e.info,o=t.info;return i.level!=o.level?o.level-i.level:i.fightCap!=o.fightCap?o.fightCap-i.fightCap:i.sortKey!=o.sortKey?o.sortKey-i.sortKey:i.code-o.code}},addBtn:{label:"商人",icon:"common_icon_fenjie_png",btnFunc:function(){s.list_item.visible=!1,h.GameMVC.petMed.showSubView(h.PetMediator.SV.DECOMPOSE,{type:EEntityType.EEntityTypePet})}}},t),s.skinName="BackpackPanelSkin",s.params=e,s}h.BackpackPanel=e,__reflect(e.prototype,"game.BackpackPanel")}(game=game||{}),function(p){var t,n=(__extends(h,t=BaseTab),h.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.initTabbar(),this.initList(),this.activateComponent(),this.curType=h.ITEM_TYPE.HERO,this.initialized=!1,this.gp_content.scaleX=this.gp_content.scaleY=1,UIActionManager.playUIAction(this.gp_content,1,function(){e.setGuideAvailable()}),this.initNotice()},h.prototype.initNotice=function(){NoticeManager.addNoticeListener(NT.BACKPACK_CHIP,this.tabbar_type,this,{percentX:365/521.21,percentY:43/73})},h.prototype.initList=function(){this.list_item.itemRenderer=e,this.ac_item=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_item,this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListItemTap,this),this.list_filter.itemRenderer=r,this.list_filter.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onFilterListItemTap,this)},h.prototype.initTabbar=function(){var e=[];for(var t in this.ITEM_TYPE_CONFIG){var i=this.ITEM_TYPE_CONFIG[t];e.push({source:i.barSource})}this.tabbar_type.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar_type.dataProvider=new eui.ArrayCollection(e),this.tabbar_type.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this),this.tabbar_sort_item.itemRendererSkinName="BackPackUI_SortItem",this.tabbar_sort_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onSorterItemTap,this)},h.prototype.onBarItemTap=function(e){e.itemIndex!=this.curType&&(this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0,Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.updateView({type:e.itemIndex}))},h.prototype.onFilterListItemTap=function(e){this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0,this.curFilter&&this.curFilter==e.item.data?this.curFilter=void 0:this.curFilter=e.item.data;var t=this.list_filter.dataProvider;for(var i in t.source){var o=t.source[i];o==e.item?o.chosen=!o.chosen:o.chosen=!1}t.refresh(),this.updateList(!1)},h.prototype.onSorterItemTap=function(e){this.updateList(!0)},h.prototype.onListItemTap=function(e){var t=e.item.type,i=e.item.info;switch(t){case h.ITEM_TYPE.HERO:p.AppFacade.getInstance().showSubView(p.HeroMediator.N,p.HeroMediator.SV.HERO_QUICK_TRAIN,{uuid:i.uuid,allUuids:this.allUuids});break;case h.ITEM_TYPE.ITEM:case h.ITEM_TYPE.EQUIP:case h.ITEM_TYPE.CHIP:case h.ITEM_TYPE.ARTIFACT:case h.ITEM_TYPE.TREASURE:}},h.prototype.updateView=function(e){var t=e&&null!=e.type&&e.type!=this.curType;e&&null!=e.type&&(this.curType=e.type),this.targetConfig=this.ITEM_TYPE_CONFIG[this.curType],!t&&this.initialized||(this.initialized=!0,this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0,this.resetFilterAndSorter()),this.updateList(!0),this.updateNotice()},h.prototype.updateList=function(e){var t=[],i=this.targetConfig.filterConfig&&this.targetConfig.filterConfig.filterFunc||function(){return!0},o=this.targetConfig.sortConfig&&(this.targetConfig.sortConfig.defaultSortFunc||this.targetConfig.sortConfig.getSortFunc(this.tabbar_sort_item.selectedIndex)),n=this.targetConfig.getAllInfo();if(n)for(var a in n){var r=n[a];i(this.curFilter,r)&&t.push({type:this.curType,info:r,view:this})}0<t.length?(this.gp_empty.visible=!1,o&&t.sort(o)):(this.gp_empty.visible=!0,this.lb_empty_tips.text="还没有"+this.targetConfig.desc);var s=[];if(t.forEach(function(e){s.push(e.info.uuid)}),this.allUuids=s,this._listChildrenNum=0,this.list_item.$children.forEach(function(e){e.eventDispatched=!1}),this.ac_item.replaceAll(t),this.list_item.layout.verticalGap=this.curType===h.ITEM_TYPE.CHIP?5:-15,e){var c=0,l=(p.GameMVC.playerPy.playerInfoVO.playerVip.vipLevel,p.Config.VIPConfig());l&&(c=l.maxBagSize),this.bm_capacity.text="容量 "+n.length+"/"+c}},h.prototype.resetFilterAndSorter=function(){if(this.targetConfig.filterConfig){this.list_filter.visible=!0,this.curFilter=void 0;var t=[];if("英雄"==this.targetConfig.desc)(e=new eui.HorizontalLayout).horizontalAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE,e.gap=7,this.list_filter.layout=e,this.targetConfig.filterConfig.data.forEach(function(e){t.push({data:e,chosen:!1,isHero:!0})}),this.list_filter.horizontalCenter=-20;else if("圣物"==this.targetConfig.desc)(e=new eui.HorizontalLayout).horizontalAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE,e.gap=7,this.list_filter.layout=e,this.targetConfig.filterConfig.data.forEach(function(e){t.push({data:e,chosen:!1,isHero:!1})}),this.list_filter.horizontalCenter=-20;else{var e;(e=new eui.HorizontalLayout).horizontalAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE,e.gap=15,this.list_filter.layout=e,this.targetConfig.filterConfig.data.forEach(function(e){t.push({data:e,chosen:!1,isHero:!1})}),this.list_filter.horizontalCenter=0}this.list_filter.dataProvider=new eui.ArrayCollection(t)}else this.list_filter.visible=!1;this.targetConfig.hasHankBook?(this.btn_handbook.visible=!0,this.btn_handbook.width=67):(this.btn_handbook.width=0,this.btn_handbook.visible=!1),this.gp_sort.visible=!1,this.blb_title.text=this.targetConfig.desc},h.prototype.activateComponent=function(){var e=this;this.btn_showSort.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_sort_pop.visible=!this.gp_sort_pop.visible},this),this.btn_handbook.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.scroller.visible=!1,p.AppFacade.getInstance().showSubView(p.HandBookMediator.N,p.HandBookMediator.SV.MAIN,{type:e.curType,closeCB:function(){e.scroller.visible=!0}})},this),this.addEventListener(h.EVENT_ITEM_CREATED,function(){e._listChildrenNum+=1,e._listChildrenNum==e.list_item.dataProvider.length&&e.dispatchEventWith(h.EVENT_ALL_ITEM_CREATED)},this),this.addEventListener(h.EVENT_ALL_ITEM_CREATED,function(){p.AppFacade.getInstance().sendNotification(CN.GUIDE_CHECK_CUR_STEP)},this)},h.EVENT_ITEM_CREATED="EVENT_ITEM_CREATED",h.EVENT_ALL_ITEM_CREATED="EVENT_ALL_ITEM_CREATED",h.ITEM_TYPE={HERO:0,ITEM:1,EQUIP:2,CHIP:3,ARTIFACT:4,HERO_SPRITE:15,TREASURE:6,PET:7},h);function h(){var e,c=t.call(this)||this;return c.backpackProxy=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N),c.heroPy=p.AppFacade.getInstance().retrieveProxy(p.HeroPy.N),c.allUuids=[],c.ITEM_TYPE_CONFIG=((e={})[h.ITEM_TYPE.HERO]={desc:"英雄",hasHankBook:!0,barSource:{up:"_btn_yq_m_json.beibao_yeqian_yingxiong_0",down:"_btn_yq_m_json.beibao_yeqian_yingxiong_1"},getAllInfo:function(){var e=[],t=p.AppFacade.getInstance().retrieveProxy(p.HeroPy.N);for(var i in t.allHeroByUuid){var o=t.allHeroByUuid[i];o.pos||e.push(o)}return e},filterConfig:{data:[{race:HeroRaceType.Human,icon:"_hero_ar_m_json.common_icon_zhongzu_1",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Orc,icon:"_hero_ar_m_json.common_icon_zhongzu_2",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Elf,icon:"_hero_ar_m_json.common_icon_zhongzu_4",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Athanasy,icon:"_hero_ar_m_json.common_icon_zhongzu_3",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Demon,icon:"_hero_ar_m_json.common_icon_zhongzu_5",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Eldar,icon:"_hero_ar_m_json.common_icon_zhongzu_6",chosenImg:"common_icon_xuanzhongyuan_png"}],filterFunc:function(e,t){return!e||e.race==t.config.race}},sortConfig:{data:[{desc:"等级"},{desc:"星级"}],getSortFunc:function(e){switch(e){case 0:return function(e,t){return t.info.level-e.info.level};case 1:return function(e,t){return t.info.starLevel-e.info.starLevel};default:return function(){return-1}}},defaultSortFunc:function(e,t){var i=e.info,o=t.info;if(i.starLevel!=o.starLevel)return o.starLevel-i.starLevel;if(i.level!=o.level)return o.level-i.level;var n=p.Config.allHeroConfig()[i.code],a=p.Config.allHeroConfig()[o.code];return n.race!=a.race?n.race-a.race:n.profession!=a.profession?HERO_SORT_ORDER[a.profession]-HERO_SORT_ORDER[n.profession]:i.code-o.code}}},e[h.ITEM_TYPE.ITEM]={desc:"物品",barSource:{up:"_btn_yq_m_json.beibao_yeqian_daoju_0",down:"_btn_yq_m_json.beibao_yeqian_daoju_1"},getAllInfo:function(){var e=[],t=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N),i=p.AppFacade.getInstance().retrieveProxy(p.GuajiPy.N),o=t.AllItemInfo,n=p.Config.itemConfig(),a=[EPropType.EPropTypeChip,EPropType.EPropTypeHeroSpirit];for(var r in o)if(n[r]&&0!=n[r].showInPropWarehouse&&-1==a.indexOf(n[r].type)){var s=o[r];for(var c in s){var l=s[c];e.push({code:Number(r),num:l.num,expiredDt:Number(c)})}}for(var h in i.AllMapInfo)e.push({entityType:EEntityType.EEntityTypeMap,vo:i.AllMapInfo[h]});return e},filterConfig:{data:[{color:EColorType.EColorTypeWhite,icon:"beibao_btn_pinzhi_1_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeGreen,icon:"beibao_btn_pinzhi_2_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeBlue,icon:"beibao_btn_pinzhi_3_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypePurple,icon:"beibao_btn_pinzhi_4_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeOrange,icon:"beibao_btn_pinzhi_5_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeRed,icon:"beibao_btn_pinzhi_6_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"}],filterFunc:function(e,t){if(e){var i=p.Config.itemConfig()[t.code];return i&&e.color==i.color}return!0}},sortConfig:{defaultSortFunc:function(e,t){var i=e.info,o=t.info;if(!(i.entityType!=EEntityType.EEntityTypeMap||o.entityType&&o.entityType==EEntityType.EEntityTypeMap))return-1;if(!(i.entityType&&i.entityType==EEntityType.EEntityTypeMap||o.entityType!=EEntityType.EEntityTypeMap))return 1;if(i.entityType==EEntityType.EEntityTypeMap&&o.entityType==EEntityType.EEntityTypeMap)return i.vo.code-o.vo.code;var n=p.Config.itemConfig()[i.code],a=p.Config.itemConfig()[o.code];return n.type==EPropType.EPropTypeGem&&a.type!=EPropType.EPropTypeGem?-1:n.type!=EPropType.EPropTypeGem&&a.type==EPropType.EPropTypeGem?1:n.type==EPropType.EPropTypeGem&&a.type==EPropType.EPropTypeGem?o.num-i.num:a.color!=n.color?a.color-n.color:o.num-i.num}}},e[h.ITEM_TYPE.EQUIP]={desc:"装备",barSource:{up:"_btn_yq_m_json.beibao_yeqian_zhuangbei_0",down:"_btn_yq_m_json.beibao_yeqian_zhuangbei_1"},getAllInfo:function(){var e=[],t=p.AppFacade.getInstance().retrieveProxy(p.HeroThingPy.N);for(var i in t.AllEquipInfo){var o=t.AllEquipInfo[i];""==o.heroUuid&&e.push(o)}return e},filterConfig:{data:[{color:EColorType.EColorTypeGreen,icon:"beibao_btn_pinzhi_2_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeBlue,icon:"beibao_btn_pinzhi_3_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypePurple,icon:"beibao_btn_pinzhi_4_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeOrange,icon:"beibao_btn_pinzhi_5_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeRed,icon:"beibao_btn_pinzhi_6_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeLegend,icon:"beibao_btn_pinzhi_7_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"}],filterFunc:function(e,t){return!e||e.color==t.config.color}},sortConfig:{defaultSortFunc:function(e,t){var i=e.info,o=t.info,n=i.config.color,a=o.config.color;return n-a?a-n:o.level2!=i.level2?o.level2-i.level2:o.level!=i.level?o.level-i.level:o.num!=i.num?o.num-i.num:o.code!=i.code?o.code-i.code:void 0}}},e[h.ITEM_TYPE.CHIP]={desc:"碎片",barSource:{up:"_btn_yq_m_json.beibao_yeqian_suipian_0",down:"_btn_yq_m_json.beibao_yeqian_suipian_1"},getAllInfo:function(){var e=[],t=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N).AllItemInfo,i=p.Config.itemConfig(),o=[EPropType.EPropTypeChip];for(var n in t){var a=i[n];if(a&&-1!=o.indexOf(a.type)){var r=JSON.parse(a.effect)[0][1],s=p.Config.allHeroConfig()[r];e.push({code:Number(n),num:c.backpackProxy.getItemNumByCode(n),requestNum:a.effectEx,initStar:s&&s.initStar||0})}}return e},sortConfig:{defaultSortFunc:function(e,t){var i=e.info,o=t.info,n=i.num>=i.requestNum,a=o.num>=o.requestNum;return n!=a?a?1:-1:i.initStar!=o.initStar?o.initStar-i.initStar:i.num!=o.num?o.num-i.num:void 0}},filterConfig:{data:[{color:EColorType.EColorTypeWhite,icon:"beibao_btn_pinzhi_1_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeGreen,icon:"beibao_btn_pinzhi_2_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeBlue,icon:"beibao_btn_pinzhi_3_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypePurple,icon:"beibao_btn_pinzhi_4_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeOrange,icon:"beibao_btn_pinzhi_5_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeRed,icon:"beibao_btn_pinzhi_6_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"}],filterFunc:function(e,t){if(e){var i=p.Config.itemConfig()[t.code];return e.color==i.color}return!0}}},e[h.ITEM_TYPE.ARTIFACT]={desc:"圣物",hasHankBook:!0,barSource:{up:"_btn_yq_m_json.beibao_yeqian_shenqi_0",down:"_btn_yq_m_json.beibao_yeqian_shenqi_1"},getAllInfo:function(){var e=[],t=p.AppFacade.getInstance().retrieveProxy(p.HeroThingPy.N);for(var i in t.AllArtiInfo){var o=t.AllArtiInfo[i];""==o.heroUuid&&e.push(o)}return e},filterConfig:{data:[{color:EColorType.EColorTypeWhite,icon:"beibao_btn_pinzhi_1_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeGreen,icon:"beibao_btn_pinzhi_2_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeBlue,icon:"beibao_btn_pinzhi_3_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypePurple,icon:"beibao_btn_pinzhi_4_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeOrange,icon:"beibao_btn_pinzhi_5_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeRed,icon:"beibao_btn_pinzhi_6_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeLegend,icon:"beibao_btn_pinzhi_7_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"}],filterFunc:function(e,t){return!e||e.color==t.config.color}},sortConfig:{defaultSortFunc:function(e,t){var i=e.info,o=t.info;return i.config.color-o.config.color?o.config.color-i.config.color:i.config.sectionLevel-o.config.sectionLevel?o.config.sectionLevel-i.config.sectionLevel:o.level2!=i.level2?o.level2-i.level2:o.level!=i.level?o.level-i.level:o.additionRace!=i.additionRace?o.additionRace-i.additionRace:o.num!=i.num?o.num-i.num:o.code!=i.code?o.code-i.code:void 0}}},e),c.skinName="BackpackUISkin",c.guideEffectWait=!0,c}p.BackpackUI=n,__reflect(n.prototype,"game.BackpackUI");var o,e=(o=eui.ItemRenderer,__extends(i,o),i.prototype.childrenCreated=function(){var i=this;o.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.gp_bi.addChild(this.baseItem),this.pBar.slideDuration=0,this.pBar.labelFunction=function(e,t){return i.value+"/"+t}},i.prototype.dataChanged=function(e){e&&(this.data=e),this.data.view&&!this.eventDispatched&&(this.eventDispatched=!0,this.data.view.dispatchEventWith(n.EVENT_ITEM_CREATED));var t=this.data.info;switch(this.pBar.visible=!1,this.baseItem.blb_num.visible=!0,this.baseItem.touchEnabled=!0,this.data.type){case n.ITEM_TYPE.HERO:var i=void 0,o=!1;0==t.dermaCode?i=t.config.avatar:(i=p.Config.getHeroDermaConfig()[t.dermaCode].avatar,o=!0),this.baseItem.updateData({uuid:t.uuid,type:EEntityType.EEntityTypeHero,source:BASEITEM_SOURCE.BACKPACK,effect:!0,isShowZhongZhu:!0,avatar:i,isShowEffect:o}),this.baseItem.touchEnabled=!1;break;case n.ITEM_TYPE.CHIP:this.pBar.visible=!0,this.pBar.maximum=t.requestNum,this.pBar.value=this.value=t.num,this.pBar.labelDisplay.text=t.num+"/"+t.requestNum,this.baseItem.updateData({code:t.code,num:t.num,source:BASEITEM_SOURCE.BACKPACK}),this.baseItem.blb_num.visible=!1;break;case n.ITEM_TYPE.HERO_SPRITE:case n.ITEM_TYPE.ITEM:t.vo?this.baseItem.updateData({uuid:t.vo.uuid,vo:t.vo,type:t.vo.entityType,source:BASEITEM_SOURCE.BACKPACK}):this.baseItem.updateData({code:t.code,num:t.num,expiredDt:t.expiredDt,source:BASEITEM_SOURCE.BACKPACK});break;case n.ITEM_TYPE.PET:case n.ITEM_TYPE.ARTIFACT:case n.ITEM_TYPE.TREASURE:case n.ITEM_TYPE.EQUIP:this.baseItem.updateData({uuid:t.uuid,type:t.entityType,source:BASEITEM_SOURCE.BACKPACK})}},i);function i(){var e=o.call(this)||this;return e.eventDispatched=!1,e.backpackProxy=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N),e.skinName="BackpackUI_Item",e}p.BackpackUI_Item=e,__reflect(e.prototype,"game.BackpackUI_Item");var a,r=(a=eui.ItemRenderer,__extends(s,a),s.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this)},s.prototype.dataChanged=function(){this.data.isHero&&(this.width=80,this.scaleX=.9,this.scaleY=.9),this.chosen=this.data.chosen||!1,this.img_icon.source=this.data.data.icon,this.img_chosen.source=this.data.data.chosenImg,this.setChosen(this.chosen)},s.prototype.setChosen=function(e){this.chosen=e,this.img_chosen.visible=this.chosen},s);function s(){var e=a.call(this)||this;return e.skinName="BackpackUI_FilterItem",e}p.BackpackUI_FilterItem=r,__reflect(r.prototype,"game.BackpackUI_FilterItem")}(game=game||{}),function(e){var t,i=(t=eui.Component,__extends(o,t),o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.parent.touchEnabled=!1},o.prototype.makeItem=function(e){var t=this,i=new eui.Component;return i.skinName="CommonSourceJumpLabelSkin_1",i.once(eui.UIEvent.CREATION_COMPLETE,function(){0==e.moduleId?i.lb_tips.textFlow=[{text:e.desc,style:{underline:!1}}]:(i.lb_tips.textFlow=[{text:e.desc,style:{underline:!0}}],i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){game.AppFacade.getInstance().retrieveProxy(game.ActivityPy.N)},t))},this),i},o.prototype.setNeedCode=function(e){var i=this;this.gp_list.removeChildren();var t=void 0,o=void 0;o=(Array.isArray(e)?(t=e[1],e[0]):(t=e,Math.floor(Number(t)/1e7)))==EEntityType.EEntityTypeHero?game.Config.allHeroConfig()[t]:game.Config.itemConfig()[t],this.code=t;do{if(!o||!o.jumpCode||""==o.jumpCode)break;return void JSON.parse(o.jumpCode).forEach(function(e){var t=game.Config.wayConfig()[e];t&&i.gp_list.addChild(i.makeItem(t))})}while(0);this.visible=!1},o.prototype.addWayCode=function(e){var t=game.Config.wayConfig()[e];t&&this.gp_list.addChild(this.makeItem(t))},o);function o(){var e=t.call(this)||this;return e.skinName="CommonSourceJumpLabelSkin",e}e.CommonSourceJumpLabel=i,__reflect(i.prototype,"customui.CommonSourceJumpLabel",["eui.UIComponent","egret.DisplayObject"])}(customui=customui||{}),function(i){var o,e=(__extends(t,o=BasePanel),t.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.item=new i.BackpackUI_Item,this.item.touchEnabled=!1,this.gp_item.addChild(this.item),this.targetNum=1,this.lb_num.visible=!1,this.edt_input.visible=!0,this.activateComponent(),this.updateView()},t.prototype.updateView=function(){var e=i.Config.itemConfig()[this.code];this.lb_name.text=e.name,this.requestNum=e.effectEx,this.num=this.proxy.getItemNumByCode(this.code),this.setTargetNum(Math.floor(this.num/this.requestNum)),this.item.baseItem.touchEnabled=!1},t.prototype.setTargetNum=function(e){e=e||1,this.targetNum=e,this.edt_input.text=e.toString();var t={type:i.BackpackUI.ITEM_TYPE.CHIP,info:{code:this.code,requestNum:this.num,num:this.targetNum*this.requestNum}};this.item.dataChanged(t)},t.prototype.activateComponent=function(){var t=this;this.btn_min.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setTargetNum(1)},this),this.btn_max.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=Math.floor(this.num/this.requestNum);this.setTargetNum(e)},this),this.btn_des.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setTargetNum(this.targetNum-1)},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){(this.targetNum+1)*this.requestNum<=this.num&&this.setTargetNum(this.targetNum+1)},this),this.btn_compound.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;this.num>=this.requestNum*this.targetNum?i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N).compound({code:this.code,num:this.targetNum,cb:function(){PopUpManager.removePopUp(e)}}):Utils.MsgUtils.addMidMsg("碎片不足")},this),this.edt_input.addEventListener(egret.Event.CHANGE,function(){var e=Math.floor(t.num/t.requestNum);t.targetNum=Number(t.edt_input.text),t.targetNum>e&&(t.targetNum=e,t.edt_input.text=e.toString(),Utils.MsgUtils.addMidMsg("超过最大合成数量！"))},this),this.edt_input.addEventListener(egret.Event.FOCUS_OUT,function(){if(!t.edt_input.text.match(/[1-9][0-9]*/gi)){Utils.MsgUtils.addMidMsg("请输入有效数值！");var e=Math.floor(t.num/t.requestNum);t.targetNum=e,t.edt_input.text=e.toString()}},this)},t);function t(e){var t=o.call(this)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N),t.code=e.code,t.skinName="CompoundPanelSkin",t}i.CompoundPanel=e,__reflect(e.prototype,"game.CompoundPanel")}(game=game||{}),function(n){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.lbWithImage.textColor=7491637,this.lbWithImage.size=24},i.prototype.updateView=function(e){this.params=e,this.clickCB=e.clickCB,this.params.commonTips?this.initForCommonTips():this.initForCost(),this.initBtnLabel(),this.params.noOKBtn&&(this.btn_confirm.visible=!1,this.btn_cancle.horizontalCenter=0)},i.prototype.initBtnLabel=function(){if(this.params.btnStyle){function e(e,t){e.label="",e.skinName=t.skin,e.label=t.text}e(this.btn_cancle,this.params.btnStyle.cancel||i.BTN_STYLE.CANCEL),e(this.btn_confirm,this.params.btnStyle.confirm||i.BTN_STYLE.CONFIRM)}},i.prototype.initForCommonTips=function(){if(Array.isArray(this.params.commonTips)){var t=[];this.params.commonTips.forEach(function(e){t.push({type:COMPONENT_ENUM.LABEL,data:{text:e.text,size:e.style&&e.style.size,textColor:e.style&&e.style.textColor}})}),this.lbWithImage.update({data:t})}else this.lbWithImage.update({data:[{type:COMPONENT_ENUM.LABEL,data:{text:this.params.commonTips}}]});this.decorateVip(),this.decorateCB(),this.decorateBtn()},i.prototype.initForCost=function(){var e="string"==typeof this.params.cost?JSON.parse(this.params.cost)[0]:this.params.cost[0],t=[];if(e){var i=n.GeneralConfig.getEntityConfigByCode(e[0],e[1]);if(i.icon&&""!=i.icon){var o={type:COMPONENT_ENUM.IMAGE,data:{source:i.icon+"_png"}};this.params.customTips?t.push({type:COMPONENT_ENUM.LABEL,data:{text:this.params.customTips}}):t.push({type:COMPONENT_ENUM.LABEL,data:{text:this.params.reset?"是否花费":"确定消耗"}}),t.push(o),this.params.costTips?t.push({type:COMPONENT_ENUM.LABEL,data:{text:"x"+e[2]+this.params.costTips}}):t.push({type:COMPONENT_ENUM.LABEL,data:{text:"x"+e[2]+"，购买一次挑战次数？"}})}}else this.params.reset?t.push({type:COMPONENT_ENUM.LABEL,data:{text:this.params.costTips}}):t.push({type:COMPONENT_ENUM.LABEL,data:{text:"确定"+this.params.costTips}});this.lbWithImage.update({data:t}),this.decorateVip(),this.decorateCB(),this.decorateBtn()},i.prototype.decorateVip=function(){if(this.params.vipLeftCount){var e=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N);this.lb_vipTips.text="（您当前是VIP"+e.playerInfoVO.playerVip.vipLevel+"，今日剩余购买次数"+this.params.vipLeftCount+"次）"}else this.lb_vipTips.parent&&this.lb_vipTips.parent.removeChild(this.lb_vipTips)},i.prototype.decorateCB=function(){var t=this;this.params.cb?(this.cb_tips.addEventListener(egret.Event.CHANGE,function(e){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),t.needTipsToday=t.cb_tips.selected},this),Utils.LocalStorageUtil.getTodayVaild(""+i.STORAGE_PREFIX+this.params.source)&&(this.cb_tips.selected=!0)):this.gp_content.removeChild(this.gp_cb)},i.prototype.decorateBtn=function(){var e=this;this.btn_cancle.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onClick(0)},this),this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),e.needTipsToday?Utils.LocalStorageUtil.setTodayVaild(""+i.STORAGE_PREFIX+e.params.source):Utils.LocalStorageUtil.removeItem(""+i.STORAGE_PREFIX+e.params.source),e.onClick(1)},this)},i.prototype.onClick=function(e){this.hide(),this.clickCB&&this.clickCB({type:e})},i.prototype.perShow=function(e){var t=!0;return e.directCall&&e.directCall()?(e.clickCB&&e.clickCB({type:COMPONENT_ENUM.LABEL}),t=!1):e.source&&Utils.LocalStorageUtil.getTodayVaild(""+i.STORAGE_PREFIX+e.source)&&e.clickCB&&(e.clickCB({type:COMPONENT_ENUM.LABEL}),t=!1),t},i.STORAGE_PREFIX="CommonTipsDialog",i.BTN_STYLE={CONFIRM:{text:"确定",skin:"skins.ButtonSkinGreen"},CANCEL:{text:"取消",skin:"skins.ButtonSkinRed"},GOTO:{text:"前往",skin:"skins.ButtonSkinYellow"},RECHARGE:{text:"充值",skin:"skins.ButtonSkinYellow"}},i);function i(){var e=t.call(this)||this;return e.needTipsToday=!1,e.skinName="CommonTipsDialogSkin",e}n.CommonTipsDialog=e,__reflect(e.prototype,"game.CommonTipsDialog")}(game=game||{}),function(l){var a,e=(__extends(t,a=BasePanel),t.prototype.childrenCreated=function(){var e=this;a.prototype.childrenCreated.call(this),this.CommonXiaoTanChuKuang.onCloseCB=function(){PopUpManager.removePopUp(e)},this.scroller_list.scrollPolicyH=eui.ScrollPolicy.OFF,this.scroller_list.verticalScrollBar.visible=!1,this.scroller_list.verticalScrollBar.autoVisibility=!1,this.CommonXiaoTanChuKuang.blb_title.text=this.title;var t=new eui.List;t.itemRenderer=n;var i=this.generateData();t.dataProvider=new eui.ArrayCollection(i);var o=new eui.TileLayout;o.verticalGap=6,t.layout=o,this.gp_list.addChild(t)},t.prototype.generateData=function(){var e=new Array;for(var t in this.config){var i=this.config[t],o=!1;i.level<=this.curLevel&&(o=!0);var n=this.formatString.format([i.level]),a="0",r=void 0;for(var s in i.attrAdd&&""!=i.attrAdd&&(r=JSON.parse(i.attrAdd)),r){var c=r[s];c[0]==EAttrType.Atk&&(a=l.GeneralConfig.getAttrValue(Number(c[1]?c[1]:"0")))}e.push({activated:o,desc:n,attrAdd:a})}return e},t);function t(e,t,i,o){var n=a.call(this)||this;return n.skinName="CommonUpgradePreviewSkin",n.config=e,n.formatString=t,n.curLevel=i,n.title=o,n}l.CommonUpgradePreview=e,__reflect(e.prototype,"game.CommonUpgradePreview");var i,n=(i=eui.ItemRenderer,__extends(o,i),o.prototype.dataChanged=function(){this.img_bg.source=this.data.activated?"pokemon_img_jihuotiao_01_png":"pokemon_img_jihuotiao_02_png",this.img_icon.source=this.data.activated?"pokemon_img_yijihuozhuangshi_png":"pokemon_img_weijiesuozhuangshi_png",this.img_status.source=this.data.activated?"pokemon_txt_yijihuo_png":"subsidiary_txt_weijihuo_png",this.lb_requireLevel.text=this.data.desc,this.lb_desc.text="上阵精灵全属性+"+this.data.attrAdd},o);function o(){var e=i.call(this)||this;return e.skinName="ItemRenderSkin",e}__reflect(n.prototype,"ItemRender")}(game=game||{}),function(c){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent(),DragonBoneTools.playOnce({effectName:"common_zhihuanqian",parent:this.gp_effect,y:this.gp_effect.height,loop:!0}),egret.Tween.get(this.img_add,{loop:!0}).to({alpha:.4},1e3).to({alpha:1},1e3)},i.prototype.updateView=function(e){if(this.curUuid){this.gp_name.visible=!0,this.btn_oper.enabled=!0,this.img_add.visible=!1;var t=this.heroPy.allHeroByUuid[this.curUuid];this.heroModel.update({code:t.code,isStatic:!0}),this.lb_name.text=t.config.name,this.img_raceIcon.source=HeroRaceConfig[t.config.race].raceIconBig;var i=t.starLevel,o=c.GeneralConfig.getHeroStarInfo(i);if(this.gp_stars.removeChildren(),o.stage<4)for(var n=0;n<o.num;n++){var a=new eui.Image(o.src);this.gp_stars.addChild(a),a.scaleX=a.scaleY=.5}else this.gp_stars.addChild(new customui.HighStarLevelIcon({num:o.num,scale:.5}));var r=c.Config.heroRollBackConfig(),s=JSON.parse(r[t.starLevel].costs);this.icon_cost.visible=!0,this.icon_cost.updateItem({cost:s[0],style:CommonIconStyle.RIGHT,needShowHave:!0})}else this.gp_name.visible=!1,this.icon_cost.visible=!1,this.btn_oper.enabled=!1,this.img_add.visible=!0,this.heroModel.update({})},i.prototype.activateComponent=function(){var t=this;this.cu_dtc.blb_title.text="英雄重生",this.cu_dtc.onCloseCB=function(){t.hide()},Utils.TouchUtils.addTouchListener(this.heroModel,function(){c.AppFacade.getInstance().showSubView(c.HeroMediator.N,c.HeroMediator.SV.SELECT,{type:c.HeroSelectPanel.SELECTFORM.HERO_ROLLBACK,btnFunc:function(e){t.curUuid=e,t.updateView(),DragonBoneTools.playOnce({effectName:"common_zhihuanfangru",parent:t.gp_effect,y:t.gp_effect.height})}})}),Utils.TouchUtils.addTouchListener(this.btn_oper,function(){c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.TIPS_DIALOG,{commonTips:"请确定是否重生该英雄，重生后可返还所有本体、培养资源以及若干9或10星通用升星材料。",clickCB:function(e){e.type&&t.heroPy.HeroRollback({uuid:t.curUuid,cb:function(e){DragonBoneTools.playOnce({effectName:"common_zhihuanchenggong",parent:t.gp_effect,y:t.gp_effect.height,doneCB:function(){t.curUuid=void 0,t.updateView(),e()}})}})}})}),Utils.TouchUtils.addTouchListener(this.btn_guide,function(){PopUpManager.addPopUp({obj:new c.HelpDialog({moduleId:MODULE.HeroRollback})})}),Utils.TouchUtils.addTouchListener(this.btn_preview,function(){t.curUuid?t.heroPy.HeroRollbackPreview({uuid:t.curUuid}):Utils.MsgUtils.addMidMsg("未选择英雄")})},i);function i(){var e=t.call(this)||this;return e.code=EActivityType.HeroRollback,e.heroPy=c.AppFacade.getInstance().retrieveProxy(c.HeroPy.N),e.skinName="HeroRollBackViewSkin",e}c.HeroRollBackView=e,__reflect(e.prototype,"game.HeroRollBackView")}(game=game||{}),function(i){var o,e=(__extends(t,o=BasePanel),t.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.item=new i.BackpackUI_Item,this.gp_item.addChild(this.item),this.targetNum=1,this.activateComponent(),this.updateView()},t.prototype.updateView=function(){var e=i.Config.itemConfig()[this.code];this.lb_name.text=e.name,this.requestNum=1,this.num=this.proxy.getItemNumByCode(this.code);var t={type:i.BackpackUI.ITEM_TYPE.ITEM,info:{code:this.code}};this.item.dataChanged(t),this.btn_compound.label=this.params&&this.params.btnText||"合成",this.setTargetNum(Math.floor(this.num/this.requestNum))},t.prototype.setTargetNum=function(e){e=e||1,this.targetNum=e,this.lb_num.text=e.toString()},t.prototype.activateComponent=function(){this.btn_min.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setTargetNum(1)},this),this.btn_max.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=Math.floor(this.num/this.requestNum);this.setTargetNum(e)},this),this.btn_des.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setTargetNum(this.targetNum-1)},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){(this.targetNum+1)*this.requestNum<=this.num&&this.setTargetNum(this.targetNum+1)},this),this.btn_compound.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.params.btnFunc?this.num>=this.requestNum*this.targetNum?(i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N),this.params.btnFunc({num:this.targetNum}),this.hide()):Utils.MsgUtils.addMidMsg("道具不足"):this.num>=this.requestNum*this.targetNum?(i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N).UseProp(this.code,this.targetNum),this.hide()):Utils.MsgUtils.addMidMsg("道具不足")},this)},t);function t(e){var t=o.call(this)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N),t.code=e.code,t.params=e,t.skinName="CompoundPanelSkin",t}i.UsePropPanel=e,__reflect(e.prototype,"game.UsePropPanel")}(game=game||{}),function(r){var t,e=(__extends(s,t=BaseMediator),Object.defineProperty(s.prototype,"rootView",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),s.prototype.initSubView=function(){this.addSubView(s.SV.MAIN,r.ActivityBraveBookView),this.addSubView(s.SV.BAOXIANG,r.BuxiuBaoxiangView),this.addSubView(s.SV.BRAVEBOOKSHOP,r.BraveBookShopView),this.addSubView(s.SV.BRAVEBOOKREWARDS,r.BraveBookRewardsView),this.addSubView(s.SV.BRAVEBOOKTASKS,r.BravebookTasksView),this.addSubView(s.SV.GETWAYS,r.CommonGetWaysView)},s.prototype.listNotificationInterests=function(){return[CN.ACTIVITY_BRAVEBOOKSHOP,CN.HIDE_ALL_SUBVIEW,CN.BRAVEBOOK_LEVEL_UPDATE,CN.NEWBRAVEBOOK_LEVEL_UPDATE]},s.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.ACTIVITY_BRAVEBOOKSHOP:this.getSubView(s.SV.BRAVEBOOKSHOP)&&r.AppFacade.getInstance().hideSubView(s.N,s.SV.BRAVEBOOKSHOP,{unresetChapter:!0});break;case CN.HIDE_ALL_SUBVIEW:this.rootView&&r.AppFacade.getInstance().hideSubView(s.N,s.SV.MAIN);break;case CN.BRAVEBOOK_LEVEL_UPDATE:var i=r.AppFacade.getInstance().retrieveProxy(r.TaskPy.N);(o=t.data.level)!=t.preLevel&&Utils.MsgUtils.braveBookShengjiEffect();break;case CN.NEWBRAVEBOOK_LEVEL_UPDATE:if((i=r.AppFacade.getInstance().retrieveProxy(r.TaskPy.N)).NewBraveBooklevelParams){var o=i.NewBraveBooklevelParams.level,n=i.NewBraveBooklevelParams.preLevel,a=i.NewBraveBooklevelParams&&i.NewBraveBooklevelParams.isShow||!1;o==n||a||(Utils.MsgUtils.NewBraveBookShenjiEffect(n,o),GameRootLayer.gameLayer().getCurViewStack().mainLayer,i.NewBraveBooklevelParams.isShow=!0)}}},s.N="BraveBookMediator",s.SV={MAIN:1,BAOXIANG:2,BRAVEBOOKSHOP:3,BRAVEBOOKREWARDS:4,BRAVEBOOKTASKS:5,GETWAYS:6},s);function s(e){return void 0===e&&(e=null),t.call(this,s.N,e)||this}r.BraveBookMediator=e,__reflect(e.prototype,"game.BraveBookMediator")}(game=game||{}),function(e){var i,t=(i=eui.Component,__extends(o,i),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.vipLevel&&this.update(this.vipLevel)},o.prototype.update=function(e){this.vipLevel=e,this.blb_vipLevel.text=this.vipLevel.toString()},o);function o(e){var t=i.call(this)||this;return t.skinName="CommonVipItemSkin",t.vipLevel=e,t}e.CommonVipItem=t,__reflect(t.prototype,"customui.CommonVipItem")}(customui=customui||{}),function(a){var t,e=(__extends(i,t=BasePanel),i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initUI(),this.initTabbar(),this.initList(),this.onBarItemTap({itemIndex:i.TAB_VIEW.GOLD})},i.prototype.initUI=function(){var e=this;UIActionManager.hideScrollerBar(this.scroller_item),this.commonDaTanKuang.blb_title.text="变强秘籍",this.commonDaTanKuang.onCloseCB=function(){e.hide()}},i.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar.dataProvider=new eui.ArrayCollection([{source:{up:"_btn_yq_m_json.common_yeqian_jinbi_0",down:"_btn_yq_m_json.common_yeqian_jinbi_1",text:"金币"}},{source:{up:"_btn_yq_m_json.common_yeqian_zuanshi_0",down:"_btn_yq_m_json.common_yeqian_zuanshi_1",text:"钻石"}},{source:{up:"_btn_yq_m_json.common_yeqian_ziyuan_0",down:"_btn_yq_m_json.common_yeqian_ziyuan_1",text:"资源"}},{source:{up:"_btn_yq_m_json.common_yeqian_zhanli_0",down:"_btn_yq_m_json.common_yeqian_zhanli_1",text:"战力"}}]),this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this)},i.prototype.initList=function(){this.list_item=new eui.List;var e=new eui.VerticalLayout;e.verticalAlign=egret.VerticalAlign.TOP,e.horizontalAlign=egret.HorizontalAlign.CENTER,e.gap=10,e.paddingTop=15,this.list_item.layout=e,this.gp_slItem.addChild(this.list_item),this.list_item.horizontalCenter=0,this.scroller_item.scrollPolicyH=eui.ScrollPolicy.OFF,this.list_item.itemRenderer=n},i.prototype.onBarItemTap=function(e){e&&null!=e.itemIndex&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex),this.scroller_item.viewport.scrollV=0;var t=a.Config.strongConfig(),i=[];for(var o in t){var n=t[o];n.subType==e.itemIndex+1&&i.push({bg:n.icon,lb_info:n.title,lb_content:n.desc,moduleId:n.moduleId,source:n.source})}this.list_item.dataProvider=new eui.ArrayCollection(i)},i.prototype.perClose=function(){},i.TAB_VIEW={GOLD:0,DIAMOND:1,RESOURCES:2,CMOBAT:3},i);function i(){var e=t.call(this)||this;return e.index=0,e.skinName="StrongUISkin",e}a.StrongUI=e,__reflect(e.prototype,"game.StrongUI");var o,n=(o=eui.ItemRenderer,__extends(r,o),r.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.inintButton(),this.adapterComponent()},r.prototype.adapterComponent=function(){this.lb_content.visible=!0,this.gp_level.visible=!1,this.gp_content.visible=!1,this.img_icon.scaleX=this.img_icon.scaleY=1.2,this.btn_go.y=(this.gp_root.height-this.btn_go.height)/2},r.prototype.dataChanged=function(){this.img_icon.source=this.data.bg+"_png",this.lb_info.text=this.data.lb_info,this.lb_content.text=this.data.lb_content,this.updateItem(this.data.itemIndex)},r.prototype.inintButton=function(){this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(this.data.source){var e=JSON.parse(this.data.source);PopUpManager.addPopUp({obj:new a.BaseItemDetailView({code:e[1],type:e[0],showAccessNow:!0}),closeCB:function(e){e&&a.AppFacade.getInstance().hideSubView(a.StrongMediator.N,a.StrongMediator.SV.MAIN)}})}else a.MainJumpConfig.jumpTo(this.data.moduleId),a.AppFacade.getInstance().hideSubView(a.StrongMediator.N,a.StrongMediator.SV.MAIN)},this)},r.prototype.updateItem=function(e){this.data.serverData,Utils.TimerManager.getServerTime()},r);function r(){var e=o.call(this)||this;return e.skinName="CommonItemRenderLongSkin",e.giftState=new Array,e}__reflect(n.prototype,"StrongItem")}(game=game||{}),function(a){var n,e=(__extends(t,n=BasePanel),t.prototype.onDestroy=function(){n.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_chat")},t.prototype.childrenCreated=function(){var e=this;n.prototype.childrenCreated.call(this),this.addNotices(),this.list_root.useVirtualLayout=!1,this.list_root.itemRenderer=r,this.sl_root.verticalScrollBar.visible=!1,this.sl_root.verticalScrollBar.autoVisibility=!1,this.sl_emoji.verticalScrollBar.visible=!1,this.sl_emoji.verticalScrollBar.autoVisibility=!1,this.sl_privateChat.verticalScrollBar.visible=!1,this.sl_privateChat.verticalScrollBar.autoVisibility=!1,this.initEventListener(),this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.CommonDaTanChuKuang.blb_title.text="聊天";var t=[{up:"_chat_m_json.liaotian_img_yeqian_2",down:"_chat_m_json.liaotian_img_yeqian_1",type:EChatChannelType.EChatChannelTypeZone,text:"世界"},{up:"_chat_m_json.liaotian_img_yeqian_2",down:"_chat_m_json.liaotian_img_yeqian_1",type:EChatChannelType.SameServer,text:"本服"},{up:"_chat_m_json.liaotian_img_yeqian_2",down:"_chat_m_json.liaotian_img_yeqian_1",type:EChatChannelType.EChatChannelTypeGuild,text:"公会"},{up:"_chat_m_json.liaotian_img_yeqian_2",down:"_chat_m_json.liaotian_img_yeqian_1",type:EChatChannelType.EChatChannelTypePrivate,text:"私聊"}];this.tarbar_channel.itemRendererSkinName="TabBarItemSkin2",this.tarbar_channel.selectedIndex=1,a.GameMVC.loginPy,Utils.UnlockMgr.checkPass(MODULE.ChatPrivate,!1).allow||(t.pop(),this.tarbar_channel.selectedIndex=0),this.tarbar_channel.dataProvider=new eui.ArrayCollection(t),this.et_input.maxChars=parseInt(a.Config.constConfig().contentLengthLimit.constValue),this.et_input.multiline=!1,this.once(egret.Event.ENTER_FRAME,function(){e.initEmojiList()},this);for(var i=0;i<this.mainProxy.maxPrivatePlayerNum;i++){var o=new c;o.visible=!1,this.gp_privateChatPlayer.addChild(o)}NoticeManager.updateNotice(this.mainProxy.channel_2_notice[EChatChannelType.EChatChannelTypeGuild],EChatChannelType.EChatChannelTypeGuild,!0),NoticeManager.updateNotice(this.mainProxy.channel_2_notice[EChatChannelType.EChatChannelTypePrivate],EChatChannelType.EChatChannelTypePrivate,!0),NoticeManager.updateNotice(this.mainProxy.channel_2_notice[EChatChannelType.EChatChannelTypeZone],EChatChannelType.EChatChannelTypeZone,!0),NoticeManager.updateNotice(this.mainProxy.channel_2_notice[EChatChannelType.SameServer],EChatChannelType.SameServer,!0)},t.prototype.initEventListener=function(){var o=this;this.btn_send.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.UnlockMgr.checkPass(MODULE.Chat).allow){if(o.mainProxy.scheId)return void Utils.MsgUtils.addMidMsg("口干舌燥，请休息一会");if(""===o.et_input.text)return void Utils.MsgUtils.addMidMsg("请先输入内容");var e=parseInt(a.Config.constConfig().contentLengthLimit.constValue);if(o.et_input.text.length>e)return void Utils.MsgUtils.addMidMsg("最多输入"+e+"个字");var t=EChatChannelType.EChatChannelTypeZone,i=void 0;if(o.curChannelType==EChatChannelType.EChatChannelTypePrivate){if(i=o.mainProxy.curPrivateChoseId,t=EChatChannelType.EChatChannelTypePrivate,!i)return void Utils.MsgUtils.addMidMsg("找不到聊天对象")}else(t=o.curChannelType)&&t!==EChatChannelType.EChatChannelTypeSystem||(t=EChatChannelType.SameServer);o.mainProxy.SendMessage(t,o.et_input.text,i,function(){o.et_input.text=""})}},this),this.btn_emoji.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.gp_emoji.visible=!o.gp_emoji.visible,0==o.gp_emoji.visible&&o.et_input.setFocus()},this),this.gp_emoji_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.gp_emoji.visible=!1},this),this.sl_root.addEventListener(egret.Event.CHANGE,function(e){o.newTips&&o.newTips.visible&&(o.newTipCount=0,o.newTips.visible=!1)},this),this.et_input.addEventListener(egret.Event.FOCUS_IN,function(){o.et_input.textAlign="left"},this),this.et_input.addEventListener(egret.Event.FOCUS_OUT,function(){""==o.et_input.text&&(o.et_input.textAlign="center")},this),Utils.SDKMgr.getPerformConfig(32)?(this.et_input.touchEnabled=!1,this.gp_skip.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.MsgUtils.addMidMsg("聊天系统正在维护升级")},this)):this.gp_skip.parent.removeChild(this.gp_skip),this.tarbar_channel.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){var t=e.item.type;if(t==EChatChannelType.EChatChannelTypeGuild){if(!a.AppFacade.getInstance().retrieveProxy(a.GuildPy.N).isInGuild())return Utils.MsgUtils.addMidMsg("未加入公会"),void(o.tarbar_channel.selectedIndex=o.Channel_2_Index[o.curChannelType]);o.sl_privateChat.visible=!1,o.img_privateChatBg.visible=!1}else if(t==EChatChannelType.EChatChannelTypePrivate){var i=o.mainProxy.getPrivateChatPlayerList();if(!i||0==i.length)return Utils.MsgUtils.addMidMsg("暂无私聊消息"),void(o.tarbar_channel.selectedIndex=o.Channel_2_Index[o.curChannelType]);o.sl_privateChat.visible=!0,o.img_privateChatBg.visible=!0}else o.sl_privateChat.visible=!1,o.img_privateChatBg.visible=!1;o.updateView({NextChannelType:t})},this),this.btn_removePrivateTalk.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.mainProxy.removePrivateChatPlayer(o.mainProxy.curPrivateChoseId)},this)},t.prototype.updateInterval=function(e){e<=0?(egret.clearInterval(this.mainProxy.scheId),this.mainProxy.scheId=void 0,this.btn_send.label="发 送",UIActionManager.setGrey(this.btn_send,!1),this.btn_send.touchEnabled=!0,this.lb_time.text=""):(this.btn_send.label="",this.lb_time.text=e/1e3+"s")},t.prototype.updatePrivateChatPlayer=function(){var i=this;if(this.curChannelType==EChatChannelType.EChatChannelTypePrivate){function e(e){var t=n.gp_privateChatPlayer.getChildAt(e);t&&o[e]?(t.update(o[e].baseInfo,function(){i.mainProxy.curPrivateChoseId=o[e].baseInfo.playerId,i.mainProxy.curPrivateChoseName=o[e].baseInfo.name,i.updateView({NextChannelType:EChatChannelType.EChatChannelTypePrivate,playerId:o[e].baseInfo.playerId}),i.changeSelectIndex(e)},n),t.visible=!0):t&&(t.visible=!1)}for(var o=this.mainProxy.getPrivateChatPlayerList(),n=this,t=0;t<this.mainProxy.maxPrivatePlayerNum;t++)e(t);this.curChannelType==EChatChannelType.EChatChannelTypePrivate&&o.length?this.gp_withWhoTalk.visible=!0:this.gp_withWhoTalk.visible=!1,this.lb_withWhoTalk.text="与 "+this.mainProxy.curPrivateChoseName+" 对话"}},t.prototype.changeSelectIndex=function(e){var t;this.curChannelType==EChatChannelType.EChatChannelTypePrivate&&((t=this.gp_privateChatPlayer.getChildAt(this.curSelectPrivateIndex))&&t.setChosen(!1),(t=this.gp_privateChatPlayer.getChildAt(e))&&t.setChosen(!0),this.curSelectPrivateIndex=e)},t.prototype.updateView=function(e){if(e){if(e.NextChannelType||(e.NextChannelType=this.curChannelType),this.isFirst)this.isFirst=!1;else if(e.NextChannelType==this.curChannelType&&this.curChannelType!=EChatChannelType.EChatChannelTypePrivate)return;this.lastChannelType=this.curChannelType,this.curChannelType=e.NextChannelType,this.mainProxy.curChannel=this.curChannelType,e.NextChannelType==EChatChannelType.EChatChannelTypePrivate?(this.sl_root.height=577,this.gp_withWhoTalk.visible=!0,this.changeDataProvider(e.playerId||this.mainProxy.setLastPrivateTalk()),this.updatePrivateChatPlayer(),this.sl_privateChat.visible=!0,this.img_privateChatBg.visible=!0):(this.sl_root.height=624,this.changeDataProvider(void 0),this.sl_privateChat.visible=!1,this.img_privateChatBg.visible=!1,this.gp_withWhoTalk.visible=!1),this.tarbar_channel.selectedIndex=this.Channel_2_Index[this.curChannelType],this.changeSelectIndex(0),this.mainProxy.noticesTag[this.curChannelType]=!1,NoticeManager.updateNotice(this.mainProxy.channel_2_notice[this.curChannelType],this.curChannelType,!0)}},t.prototype.changeDataProvider=function(e){var t=this.mainProxy.getDataProvider(this.curChannelType,e);this.list_root.dataProvider=new eui.ArrayCollection(t),this.jumpToBottom()},t.prototype.insertItem=function(e){var t=this;if(e.channelType,this.checkCanInsert(e)){this.list_root.dataProvider.addItem(e),this.list_root.dataProvider.length>this.mainProxy.maxMsgShow&&this.list_root.dataProvider.removeItemAt(0),this.sl_root.viewport.scrollV<this.list_root.contentHeight-this.sl_root.height&&this.newTipCount++;var i=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N).playerInfoVO.playerId;e.fromPlayer&&e.fromPlayer.playerId===i||!this.newTipCount?(this.newTipCount=0,this.jumpToBottom()):0<this.newTipCount&&3<this.list_root.dataProvider.length&&(this.newTips||(this.newTips=new eui.Label,this.newTips.horizontalCenter=0,this.newTips.bottom=70,this.newTips.stroke=2,this.newTips.strokeColor=0,this.et_input.parent.parent.addChild(this.newTips),UIActionManager.fadeBlink(this.newTips,!0),this.newTips.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.jumpToBottom()},this)),this.newTips.visible=!0,this.newTips.text=this.newTipCount+"条新的消息")}},t.prototype.jumpToBottom=function(){var e=this;this.newTips&&this.newTips.visible&&(this.newTipCount=0,this.newTips.visible=!1),this.sl_root.stopAnimation(),this.once(egret.Event.ENTER_FRAME,function(){e.sl_root.viewport.scrollV=0<e.list_root.contentHeight-e.sl_root.height?e.list_root.contentHeight-e.sl_root.height:0},this)},t.prototype.checkCanInsert=function(e){var t=e.channelType,i=!1,o=e.broadcastId,n=a.Config.broadcastConfig();return this.curChannelType==EChatChannelType.SameServer?t==EChatChannelType.SameServer?i=!0:t==EChatChannelType.EChatChannelTypeSystem&&(o&&n[o]?0<=JSON.parse(n[o].channel).indexOf(EChatChannelType.EChatChannelTypeSystem)&&(i=!0):i=!0):t==EChatChannelType.EChatChannelTypePrivate&&(e.fromPlayer&&e.fromPlayer.playerId==this.curPrivateId||e.toPlayer&&e.toPlayer.playerId==this.curPrivateId)?i=!0:this.curChannelType==EChatChannelType.EChatChannelTypeZone&&t==EChatChannelType.EChatChannelNewZone?i=!0:t==this.curChannelType&&(o&&n[o]?0<=JSON.parse(n[o].channel).indexOf(t)&&(i=!0):i=!0),i},t.prototype.initEmojiList=function(){var t=this,e=new eui.TileLayout;e.horizontalGap=8,e.requestedColumnCount=10,this.list_emoji.layout=e,this.list_emoji.itemRendererSkinName="ChatEmojiItemSkin";for(var i=[],o=1;o<=100;o++){var n="",a="_chat_m_json.static_"+(n=0<=o&&o<10?"00"+o:10<=o&&o<100?"0"+o:""+o);i.push({source:a,code:"#"+n+"#"})}this.list_emoji.dataProvider=new eui.ArrayCollection(i),this.list_emoji.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),t.et_input.text+=e.item.code,t.gp_emoji.visible=!1},this),this.sl_emoji.bounces=!1},t.prototype.addNotices=function(){a.GameMVC.loginPy,NoticeManager.addNoticeListener(this.mainProxy.channel_2_notice[EChatChannelType.EChatChannelTypeZone],this.tarbar_channel,this,{percentX:100/518}),NoticeManager.addNoticeListener(this.mainProxy.channel_2_notice[EChatChannelType.SameServer],this.tarbar_channel,this,{percentX:230/518}),NoticeManager.addNoticeListener(this.mainProxy.channel_2_notice[EChatChannelType.EChatChannelTypeGuild],this.tarbar_channel,this,{percentX:360/518}),NoticeManager.addNoticeListener(this.mainProxy.channel_2_notice[EChatChannelType.EChatChannelTypePrivate],this.tarbar_channel,this,{percentX:490/518})},t);function t(){var e,t=n.call(this)||this;return t.newTipCount=0,t.curPrivateId=0,t.curSelectPrivateIndex=0,t.Channel_2_Index=((e={})[EChatChannelType.EChatChannelTypeZone]=0,e[EChatChannelType.SameServer]=1,e[EChatChannelType.EChatChannelTypeGuild]=2,e[EChatChannelType.EChatChannelTypePrivate]=3,e),t.isFirst=!0,t.mainProxy=a.AppFacade.getInstance().retrieveProxy(a.MainPy.N),Utils.AssetsMgr.loadGroup("group_chat"),t.skinName="ChatMainSkin",t.curChannelType=EChatChannelType.EChatChannelTypeZone,t.lastChannelType=EChatChannelType.EChatChannelTypeZone,t}a.ChatMain=e,__reflect(e.prototype,"game.ChatMain");var o,r=(o=eui.ItemRenderer,__extends(i,o),i.prototype.dataChanged=function(){this.params=this.data.params,this.data.fromPlayer&&this.data.fromPlayer.playerId==this.playerProxy.playerInfoVO.playerId&&(this.isSelf=!0),(this.data.channelType===EChatChannelType.EChatChannelTypeSystem||this.data.channelType===EChatChannelType.EChatChannelTypeGuild&&this.data.sourceType==ChatMsgSourceType.System)&&(this.isSystem=!0),this.mainProxy.curChannel==EChatChannelType.EChatChannelTypePrivate?this.gp_main.width=500:this.gp_main.width=598,this.decorateTitle(),this.decoratePosition(),this.decorateTitleAvatar(),this.decorateContent()},i.prototype.childrenCreated=function(){var i=this;o.prototype.childrenCreated.call(this),this.playerhead.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),t=a.GameMVC.loginPy;t.loginGameVO.singleSign&&i.data.fromPlayer&&i.data.fromPlayer.serverId!=t.serverSelect.area?Utils.MsgUtils.addMidMsg("无法查看跨服玩家信息"):(i.data.fromPlayer&&i.data.fromPlayer.playerId!=e.playerInfoVO.playerId&&a.AppFacade.getInstance().showSubView(a.FriendMediator.N,a.FriendMediator.SV.INFO,{playerId:i.data.fromPlayer.playerId,hideId:!0}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap))},this),this.decorateLink()},i.prototype.decorateContent=function(){var e=this;this.isSelf?(this.content_bg.source="_chat_m_json.liaotian_img_qipao_2",this.lb_content.textColor=8867361):this.isSystem?(this.content_bg.source="_chat_m_json.liaotian_img_qipao_3",this.lb_content.textColor=6960910):(this.content_bg.source="_chat_m_json.liaotian_img_qipao_1",this.lb_content.textColor=10449482),this.lb_content.width=void 0,this.data.channelType==EChatChannelType.EChatChannelTypePrivate?this.lb_content.maxWidth=400:this.data.channelType==EChatChannelType.EChatChannelTypeSystem?this.lb_content.maxWidth=510:this.lb_content.maxWidth=490,this.getFacialExpression(this.data.textFlow),this.lb_content.textFlow=this.data.textFlow,this.isSystem?1==this.lineCount?this.height=46:2==this.lineCount?this.height=62:3==this.lineCount&&(this.height=88):1==this.lineCount?this.height=69:2==this.lineCount&&(this.height=95),this.once(egret.Event.ENTER_FRAME,function(){e.isSystem?(e.content_bg.width=e.lb_content.width+15,e.content_bg.left=63,e.lb_content.left=71,1==e.lb_content.numLines?(e.content_bg.y=0,e.lb_content.y=10,e.height=46,e.content_bg.height=44):2==e.lb_content.numLines?(e.content_bg.y=0,e.lb_content.y=8,e.height=62,e.content_bg.height=64):3==e.lb_content.numLines&&(e.content_bg.y=0,e.lb_content.y=8,e.height=88,e.content_bg.height=90)):(e.content_bg.y=26.5,e.content_bg.left=85,e.lb_content.y=35,e.lb_content.left=97,e.content_bg.width=e.lb_content.width+17,1==e.lb_content.numLines?(e.content_bg.height=38,e.height=69):2==e.lb_content.numLines&&(e.content_bg.height=64,e.height=95))},this)},i.prototype.getFacialExpression=function(e){var n=this,a=new eui.Label;if(a.size=this.lb_content.size,!this.data.Facial){this.data.Facial={},this.data.Facial.expressionPosi=[],this.data.Facial.text="",this.data.Facial.allLength=0,e.forEach(function(e){n.data.Facial.text+=e.text});for(var t=new RegExp(/#(00[1-9]|0[1-9][0-9]|100)#/g),i=t.exec(this.data.Facial.text);i;)this.data.Facial.expressionPosi.push(i),i=t.exec(this.data.Facial.text);e.forEach(function(e){e.text=e.text.replace(t,"     ")}),this.data.Facial.text=this.data.Facial.text.replace(t,"     "),a.text=this.data.Facial.text,this.data.Facial.allLength=a.textWidth}this.lineCount=Math.ceil(this.data.Facial.allLength/this.lb_content.maxWidth),this.gp_emoji.width=this.data.Facial.allLength,this.data.Facial.expressionPosi.forEach(function(e){var t=new eui.Image,i=e[0].substring(1,e[0].length-1);t.source="_chat_m_json.static_"+i;var o=n.data.Facial.text.slice(0,e.index);a.text=o,a.textWidth-1>n.lb_content.maxWidth?t.left=a.textWidth-1-n.lb_content.maxWidth:t.left=a.textWidth-1,t.y=1,t.right=void 0,t.scaleX=.63,t.scaleY=.63,n.gp_emoji.addChild(t)})},i.prototype.decorateTitle=function(){var e="";this.data.channelType!==EChatChannelType.EChatChannelTypeZone&&this.data.channelType!==EChatChannelType.EChatChannelNewZone&&this.data.channelType!==EChatChannelType.EChatChannelTypePrivate||!this.data.fromPlayer||(e+=this.data.fromPlayer.serverId+"服  "),this.data.fromPlayer&&this.data.fromPlayer.name&&(e+=this.data.fromPlayer.name),this.lb_name.text=e,this.lb_name.width=this.lb_name.textWidth},i.prototype.decorateTitleAvatar=function(){this.data.fromPlayer?(this.playerhead.updateData({vo:this.data.fromPlayer}),this.head_system.visible=!1,this.playerhead.visible=!0):this.data.channelType===EChatChannelType.EChatChannelTypeSystem?(this.playerhead.visible=!1,this.head_system.visible=!0):this.data.channelType===EChatChannelType.EChatChannelTypeGuild&&this.data.sourceType==ChatMsgSourceType.System&&(this.playerhead.visible=!1,this.head_system.visible=!0)},i.prototype.decoratePosition=function(){this.isSelf&&(this.gp_main.scaleX=-this.gp_main.scaleX,this.lb_name.scaleX=-this.lb_name.scaleX,this.lb_content.scaleX=-this.lb_content.scaleX,this.gp_emoji.scaleX=-this.gp_emoji.scaleX,this.playerhead.scaleX=-this.playerhead.scaleX)},i.prototype.decorateLink=function(){var t=this;this.lb_content.touchEnabled=!0,this.lb_content.addEventListener(egret.TextEvent.LINK,function(e){t.mainProxy.bindChatLinkJump(e,{channelType:t.data.channelType})},this)},i.CHANNEL_CONFIG={1:{name:"世界",type:EChatChannelType.EChatChannelTypeWorld},2:{name:"公会",type:EChatChannelType.EChatChannelTypeGuild},3:{name:"系统",type:EChatChannelType.EChatChannelTypeSystem},4:{name:"私聊",type:EChatChannelType.EChatChannelTypePrivate},5:{name:"同服",type:EChatChannelType.SameServer},6:{name:"战区",type:EChatChannelType.EChatChannelTypeZone}},i);function i(){var e=o.call(this)||this;return e.playerProxy=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),e.mainProxy=a.AppFacade.getInstance().retrieveProxy(a.MainPy.N),e.lineCount=1,e.isSelf=!1,e.isSystem=!1,e.skinName="ChatItemSkin",e}__reflect(r.prototype,"ChatItem");var s,c=(s=eui.ItemRenderer,__extends(l,s),l.prototype.childrenCreated=function(){var e=this;s.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.callBack&&e.callBack.call(e.thisObj)},this),this.playerhead.touchEnabled=!1,this.img_chosen.visible=!1},l.prototype.update=function(e,t,i){this.playerhead.updateData({vo:e}),this.playerhead.blb_level.visible=!1,this.blb_level.text=e.level,this.callBack=t,this.thisObj=i},l.prototype.setChosen=function(e){this.img_chosen.visible=e},l);function l(){var e=s.call(this)||this;return e.skinName="chatPlayerHeadSkin",e}__reflect(c.prototype,"chatPlayerHead")}(game=game||{}),function(e){var t,i=(t=eui.Component,__extends(o,t),o.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onCloseCB&&e.onCloseCB()},this)},o);function o(){var e=t.call(this)||this;return e.skinName="CommonXiaoTanChuKuangSkin",e}e.CommonXiaoTanChuKuang=i,__reflect(i.prototype,"customui.CommonXiaoTanChuKuang",["eui.UIComponent","egret.DisplayObject"])}(customui=customui||{}),function(e){var t=(i.CENTER_BTN_CONFIG=[{btnId:"btn_3_3",module:MODULE.HeroGaCha,eff:"zhujiemian_yxzh",effPos:[146,244],effNamePic:"zhujiemian_txt_yxzh_png",staticPic:"",effNamePos:[65,250],noticeType:NT.GASHA_ENTRANCE,noticePos:{percentX:200/292,percentY:240/308},clickFunc:function(){e.MainJumpConfig.jumpTo(MODULE.HeroGaCha)}},{btnId:"btn_2_1",module:MODULE.Decompose,eff:"zhujiemian_yxjt",effPos:[139,219],effNamePic:"zhujiemian_txt_yxjt_png",staticPic:"zhujiemian_img_yxjt_png",effNamePos:[50,230],noticeType:void 0,noticePos:void 0,clickFunc:function(){e.MainJumpConfig.jumpTo(MODULE.Decompose)}},{btnId:"btn_3_11",module:MODULE.Activity+EActivityType.ExtremeBattle,eff:"",effPos:[76.5,93],effNamePic:"zhujiemian_txt_sq_png",staticPic:"",effNamePos:[0,110],noticeType:void 0,noticePos:{percentX:128/153,percentY:100/146},clickFunc:function(){e.AppFacade.getInstance().retrieveMediator(e.ActivityMediator.N).showViewByCode(EActivityType.ExtremeBattle)}},{btnId:"btn_3_10",module:MODULE.Activity+EActivityType.NewYearChallenge,eff:"",effPos:[76.5,93],effNamePic:"zhujiemian_txt_xctz_png",staticPic:"",effNamePos:[0,110],noticeType:function(){return NT.ALL_ACTIVITY[EActivityType.NewYearChallenge]},noticePos:{percentX:138/153,percentY:130/146},clickFunc:function(){e.AppFacade.getInstance().retrieveMediator(e.ActivityMediator.N).showViewByCode(EActivityType.NewYearChallenge)}},{btnId:"btn_3_9",module:MODULE.HeroChallenge,eff:"",effPos:[76.5,93],effNamePic:"zhujiemian_txt_sq_png",staticPic:"",effNamePos:[0,110],noticeType:NT.HERO_CHALLENGE,noticePos:{percentX:160/153,percentY:130/146},clickFunc:function(){e.MainJumpConfig.jumpTo(MODULE.HeroChallenge)}},{btnId:"btn_4_1",module:MODULE.StarDoor,eff:"zhujiemian_skzm",effPos:[97,167.5],effNamePic:"zhujiemian_txt_skzm_png",staticPic:"",effNamePos:[15,160],noticeType:NT.STAR_DOOR_ENTRANCE,noticePos:{percentX:155/194,percentY:157/195},clickFunc:function(){e.MainJumpConfig.jumpTo(MODULE.StarDoor)}},{btnId:"btn_4_5",module:void 0,eff:"",effPos:[97,167.5],effNamePic:"",staticPic:"",effNamePos:[15,160],noticeType:void 0,noticePos:{percentX:155/194,percentY:157/195},clickFunc:function(){e.AppFacade.getInstance().showSubView(e.ExtEntranceMediator.N,e.ExtEntranceMediator.SV.ENTRANCE2)}},{btnId:"btn_5_2",module:MODULE.ServerBoss,eff:"zhujiemian_bstz",effPos:[57,306],effNamePic:"zhujiemian_txt_bstz_png",staticPic:"zhujiemian_img_bstz_png",effNamePos:[0,270],noticeType:NT.WORLD_BOSS,noticePos:{percentX:280/301,percentY:.8125},clickFunc:function(){e.MainJumpConfig.jumpTo(MODULE.ServerBoss)}},{btnId:"btn_3_2",module:MODULE.Arena,eff:"zhujiemian_jjtz",effPos:[151,165],effNamePic:"zhujiemian_txt_jjtz_png",staticPic:"",effNamePos:[65,158],noticeType:NT.CITY_PVP_ENTRANCE,noticePos:{percentX:195/301,percentY:.78125},clickFunc:function(){Utils.UnlockMgr.checkPass(MODULE.Arena).allow&&e.AppFacade.getInstance().showSubView(e.PvpEntranceMediator.N,e.PvpEntranceMediator.SV.ENTRANCE)}},{btnId:"btn_4_2",eff:"",module:void 0,effPos:[0,0],effNamePic:"",staticPic:"",effNamePos:[0,0],noticeType:NT.CITY_EXT_ENTRANCE,noticePos:{percentX:80/153,percentY:293/361},clickFunc:function(){e.AppFacade.getInstance().showSubView(e.ExtEntranceMediator.N,e.ExtEntranceMediator.SV.ENTRANCE)}},{btnId:"btn_4_3",module:MODULE.Champion,eff:"zhujiemian_yhzt",effPos:[96.5,340],effNamePic:"zhujiemian_txt_yhzt_png",staticPic:"zhujiemian_img_yhzt_png",effNamePos:[15,325],noticeType:NT.CHAMPION,noticePos:{percentX:135/153,percentY:320/361},clickFunc:function(){e.MainJumpConfig.jumpTo(MODULE.Champion)}},{btnId:"btn_3_1",module:MODULE.DailyFortress,eff:"zhujiemian_fbtz",effPos:[110,130],effNamePic:"zhujiemian_txt_fbtz_png",staticPic:"zhujiemian_img_fbtz_png",effNamePos:[15,140],noticeType:NT.CITY_COPY_ENTRANCE,noticePos:{percentX:150/184,percentY:130/173},clickFunc:function(){Utils.UnlockMgr.checkPass(MODULE.DailyFortress).allow&&e.AppFacade.getInstance().showSubView(e.CopyEntranceMediator.N,e.CopyEntranceMediator.SV.ENTRANCE)}},{btnId:"btn_3_4",module:MODULE.ShopMystical,eff:"zhujiemian_hssr",effPos:[88,199],effNamePic:"zhujiemian_txt_hssr_png",staticPic:"",effNamePos:[-10,195],noticeType:void 0,noticePos:void 0,clickFunc:function(){e.MainJumpConfig.jumpTo(MODULE.ShopMystical)}},{btnId:"btn_3_12",module:MODULE.Immortal,eff:"",effPos:[88,199],effNamePic:"",staticPic:"",effNamePos:[-10,195],noticeType:void 0,noticePos:void 0,clickFunc:function(){e.MainJumpConfig.jumpTo(MODULE.Immortal)}},{btnId:"btn_4_4",module:MODULE.Magical,eff:"zhujiemian_sq",effPos:[76.5,93],effNamePic:"zhujiemian_txt_sq_png",staticPic:"zhujiemian_img_sq_png",effNamePos:[0,110],noticeType:NT.MAGICAL,noticePos:{percentX:128/153,percentY:100/146},clickFunc:function(){Utils.UnlockMgr.checkPass(MODULE.Magical).allow&&e.AppFacade.getInstance().showSubView(e.MagicalArtifactMediator.N,e.MagicalArtifactMediator.SV.MAIN)}},{btnId:"btn_3_5",module:MODULE.Smithy,eff:"zhujiemian_tjp",effPos:[210,305],staticPic:"",effNamePic:"",effNamePos:[100,330],clickFunc:function(){e.MainJumpConfig.jumpTo(MODULE.Smithy)}},{btnId:"btn_3_5_2",module:MODULE.Smithy,eff:"zhujiemian_ar",effPos:[220,355],effNamePic:"zhujiemian_txt_tjp_png",staticPic:"",effNamePos:[100,330,-.9,.9],noticeType:NT.SMITHY_ENTRANCE,noticePos:{percentX:228/453,percentY:330/443},clickFunc:function(){e.MainJumpConfig.jumpTo(MODULE.Smithy)}},{btnId:"btn_3_6",module:void 0,eff:"",effPos:[88,199],effNamePic:"_yslz_m_json.yslz_img_baoxiang",staticPic:"",effNamePos:[-10,195],noticeType:void 0,noticePos:void 0,clickFunc:function(){e.AppFacade.getInstance().retrieveProxy(e.TaskPy.N).GetTaskReward(TaskType.HideAchievement,500008)}},{btnId:"btn_3_7",module:void 0,eff:"",effPos:[88,199],effNamePic:"_yslz_m_json.yslz_img_baoxiang",staticPic:"",effNamePos:[-10,195],noticeType:void 0,noticePos:void 0,clickFunc:function(){e.AppFacade.getInstance().retrieveProxy(e.TaskPy.N).GetTaskReward(TaskType.HideAchievement,500010)}},{btnId:"btn_3_8",module:MODULE.Challenge,eff:"zhujiemian_yj",effPos:[240,280],effNamePic:"zhujiemian_txt_yjtx_png",staticPic:"zhujiemian_img_yj_png",effNamePos:[160,280],noticeType:void 0,noticePos:void 0,clickFunc:function(){e.MainJumpConfig.jumpTo(MODULE.Challenge)}},{btnId:"btn_2_3",module:MODULE.Altar,eff:"",effPos:[240,280],effNamePic:"",staticPic:"zhujiemian_img_jjst_png",effNamePos:[160,280],noticeType:NT.ALTAR_ENTRANCE,noticePos:{percentX:199/298,percentY:201/288},clickFunc:function(){Utils.UnlockMgr.checkPass(MODULE.Altar).allow&&e.GameMVC.heroAltarMed.showSubView(e.HeroAltarMed.SV.MAIN)}}],i);function i(){}e.CityBtnConfig=t,__reflect(t.prototype,"game.CityBtnConfig")}(game=game||{}),function(g){var i,e=(__extends(f,i=BaseMediator),f.prototype.initNotice=function(){NoticeManager.setChildType(NT.CITY_COPY_ENTRANCE,[NT.DAILY_COPY,NT.EXPEDITION,NT.TEAM_EXPE_REWARD,NT.DEEP_NEST])},f.prototype.initSubView=function(){this.addSubView(f.SV.MAIN,g.CityUI)},f.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.EXTREME_CHALLENGE_MODEL_UPDATE,CN.HERO_CHALLENGE_MODEL_UPDATE,CN.EGGS_UPDATE,CN.NEWYEARCHALLENGE_UPDATE,CN.PLAYER_LEVEL_UP,CN.CITY_SWITCH_DBCLOCKPAUSE]},f.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.log("HIDE_ALL_SUBVIEW");var i=this.getSubView(f.SV.MAIN);i&&(i.visible=!1,i.parent&&i.parent.setChildIndex(i,0),i.perClose());break;case CN.CITY_SWITCH_DBCLOCKPAUSE:(u=this.getSubView(f.SV.MAIN))&&u.switchDBClockPause(t);break;case CN.EGGS_UPDATE:(u=this.getSubView(f.SV.MAIN))&&u.updateEggsBtn();break;case CN.PLAYER_LEVEL_UP:(u=this.getSubView(f.SV.MAIN))&&u.updateBtns();break;case CN.EXTREME_CHALLENGE_MODEL_UPDATE:if(!(p=this.getSubView(f.SV.MAIN)))return;if((d=g.AppFacade.getInstance().retrieveProxy(g.ActivityPy.N).allActivityData[EActivityType.ExtremeBattle])&&d.data){var o=JSON.parse(d.content),n=void 0;for(var a in o[1]){var r=o[1][a];r[0]==d.data.curCycle&&(n=r[1])}if(!n||d.data.passed)return void p.updateExChallengeModel();var s=void 0,c=(s=n[d.data.id-1][2])[0][0];s.forEach(function(e){e[1]&&(c=e[0])});var l=g.Config.creepConfig()[c];if(l){var h=(d.endDt-g.GameMgr.getInstance().serverTime())%(24*o[0]*60*60);p.updateExChallengeModel({code:l.heroId,isStatic:!0,dt:h})}else p.updateExChallengeModel()}else p.updateExChallengeModel();break;case CN.HERO_CHALLENGE_MODEL_UPDATE:var p;if(!(p=this.getSubView(f.SV.MAIN)))return;(d=g.AppFacade.getInstance().retrieveProxy(g.HeroChallenge2Py.N).challengeInfo)&&d.code?p.updateHeroChallengeModel({code:d.creeps[0],isStatic:!0}):p.updateHeroChallengeModel();break;case CN.NEWYEARCHALLENGE_UPDATE:var d=g.AppFacade.getInstance().retrieveProxy(g.ActivityPy.N).allActivityData[EActivityType.NewYearChallenge],u=this.getSubView(f.SV.MAIN);if(!d||!d.data)return void(u&&u.updateNewYearChallenge({visible:!1}));u&&u.updateNewYearChallenge({visible:!0,model:"hero_037_03",endDt:g.ActivityConfig.getActivityEndDt(EActivityType.NewYearChallenge)})}},f.prototype.onViewCreate=function(){},f.N="CityMediator",f.SV={MAIN:1},f);function f(e){void 0===e&&(e=null);var t=i.call(this,f.N,e)||this;return t.cityProxy=g.AppFacade.getInstance().retrieveProxy(g.CityPy.N),t.initNotice(),t}g.CityMediator=e,__reflect(e.prototype,"game.CityMediator")}(game=game||{}),function(e){var t,i=(__extends(o,t=BaseProxy),o.N="CityProxy",o);function o(){return t.call(this,o.N)||this}e.CityPy=i,__reflect(i.prototype,"game.CityPy")}(game=game||{}),function(s){var i,e=(__extends(t,i=BaseTab),t.prototype.fetch=function(){},t.prototype.touchBegin=function(e){for(var t=0,i=this.btns;t<i.length;t++){var o=i[t];if(o.hitTestPoint(e.stageX,e.stageY)){this.curTouchBeginBtn=o,this.curTouchBeginBtn.currentState="down";break}}},t.prototype.touchEnd=function(e){for(var t=0,i=this.btns;t<i.length;t++){var o=i[t];if(o.hitTestPoint(e.stageX,e.stageY)){this.curTouchBeginBtn&&(this.curTouchBeginBtn.currentState="up"),o.touchEnabled&&egret.TouchEvent.dispatchTouchEvent(o,egret.TouchEvent.TOUCH_TAP);break}}},t.prototype.scrollChange=function(){var e=this.cenSH-this.sl_root.viewport.scrollH;this.curTouchBeginBtn&&(this.curTouchBeginBtn.currentState="up"),this.curTouchBeginBtn=void 0,this.gp_img_1.x=1.15*e-1002.2,this.gp_2.x=.7*e*1.15-630.07,this.gp_3.x=.4*e*1.15-406.7,this.gp_4.x=65-534.71+.3*e*1.15,this.gp_5.x=.1*e*1.15-374.62},t.prototype.addNoticType=function(e,t){if(t&&t.noticeType){var i=t.noticeType;"function"==typeof t.noticeType&&(i=t.noticeType()),NoticeManager.removeNoticeListener(i),NoticeManager.addNoticeListener(i,e.getChildAt(0),this,t.noticePos)}},t.prototype.removeNotice=function(){},t.prototype.updateBtns=function(){for(var e in s.CityBtnConfig.CENTER_BTN_CONFIG){var t=s.CityBtnConfig.CENTER_BTN_CONFIG[e];if(t){var i=this[t.btnId];this.updateBtn(i,t)}}},t.prototype.updateBtn=function(e,t){if(e){var i=!t.module||Utils.UnlockMgr.checkPass(t.module,!1).allow;UIActionManager.setAbsGrey(e,!i);var o=e.$children;for(var n in o){var a=o[n];"_effectOnObj"==a.name&&(i?a.animation&&a.animation.play&&a.animation.play(t.eff):a.animation.hasAnimation(t.eff+"_daiji")?a.animation&&a.animation.play&&a.animation.play(t.eff+"_daiji",0):a.animation&&a.animation.gotoAndStopByFrame&&a.animation.gotoAndStopByFrame(t.eff,0))}}},t.prototype.childrenCreated=function(){var n=this;function e(e){var t=s.CityBtnConfig.CENTER_BTN_CONFIG[e];if(!t)return"break";if(r.btns.push(r[t.btnId]),a&&t.staticPic)r[t.btnId].icon=t.staticPic,r.updateBtn(r[t.btnId],t);else if(t.eff){var i=!t.module||Utils.UnlockMgr.checkPass(t.module,!1).allow;DragonBoneTools.playOnce({x:t.effPos[0],y:t.effPos[1],loop:!0,scaleX:t.effNamePos[2]||1,scaleY:t.effNamePos[3]||1,z:0,effectName:t.eff,parent:r[t.btnId],static:!i,loadFinishCB:function(){n.updateBtn(n[t.btnId],t)}});var o=new eui.Image;o.source=t.effNamePic,o.x=t.effNamePos[0],o.y=t.effNamePos[1],r[t.btnId].addChild(o)}else r.updateBtn(r[t.btnId],t);r.bindBtn(r[t.btnId],t),r.addNoticType(r[t.btnId],t)}i.prototype.childrenCreated.call(this),this.sl_root.validateNow(),this.cenSH=this.sl_root.viewport.scrollH,this.sl_root.addEventListener(egret.Event.CHANGE,this.scrollChange,this),this.sl_root.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.sl_root.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this);var a=Utils.SDKMgr.getPerformConfig(6),r=this;for(var t in s.CityBtnConfig.CENTER_BTN_CONFIG)if("break"===e(t))break;this.fetch(),s.AppFacade.getInstance().sendNotification(CN.EXTREME_CHALLENGE_MODEL_UPDATE),s.AppFacade.getInstance().sendNotification(CN.HERO_CHALLENGE_MODEL_UPDATE),s.AppFacade.getInstance().sendNotification(CN.NEWYEARCHALLENGE_UPDATE),this.updateNotice(),this.updateEggsBtn(),this.btns.sort(function(e,t){return t.parent.localToGlobal(t.x,t.y).y-e.parent.localToGlobal(e.x,e.y).y}),s.GameMVC.manorPy.startTimer(3e6),this.sl_root.viewport.scrollH=1606,this.scrollChange()},t.prototype.updateView=function(){var e=this;egret.setTimeout(function(){e.setGuideAvailable()},this,200);var t=Utils.TimerManager.getServerOpenDays();this.localOpenDay!=t&&(Utils.LocalStorageUtil.getTodayVaild("FIRST_INTO_CITY_FOR_EVERYDAY")||(s.AppFacade.getInstance().sendNotification(CN.FIRST_INTO_CITY_FOR_EVERYDAY),Utils.LocalStorageUtil.setTodayVaild("FIRST_INTO_CITY_FOR_EVERYDAY")),this.localOpenDay=t)},t.prototype.bindBtn=function(e,t){e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),t&&null!=t.clickFunc?t.clickFunc():Utils.MsgUtils.addMidMsg("功能开发中")},this)},t.prototype.makeBtn=function(e){var t=new eui.Image;return t.width=t.height=110,RES.getResAsync(e.img,function(e){t.source=e},this),t.x=e.posX,t.y=e.posY,t},t.prototype.perShow=function(){return this.isCreateComplete&&(this.sl_root.stopAnimation(),this.sl_root.viewport.scrollH=1606,this.scrollChange(),this.switchDBClockPause(!1)),this.sl_root.scrollPolicyH=this.sl_root.scrollPolicyV=eui.ScrollPolicy.ON,i.prototype.perShow.call(this)},t.prototype.switchDBClockPause=function(e){for(var t=0,i=this.btns;t<i.length;t++){var o=i[t].getChildByName("_effectOnObj");o&&o.armature&&DragonBoneTools.switchDBClockPause(o.armature,e)}},t.prototype.perClose=function(){this.switchDBClockPause(!0),this.removeNotice()},t.prototype.updateExChallengeModel=function(e){var t=this;e&&e.code?(this.btn_3_11.visible=!0,this.btn_3_11.touchEnabled=!0,this.heroModel_ec.update(e),this.timerDt=e&&e.dt||this.timerDt,this.timer||(this.timer=egret.setInterval(function(){t.bm_3_11_time.text=Utils.TimerManager.getFormatBySecond2(--t.timerDt)},this,1e3))):(this.btn_3_11.visible=!1,this.btn_3_11.touchEnabled=!1)},t.prototype.updateHeroChallengeModel=function(e){var t=this;if(e&&e.code){this.btn_3_9.visible=!0,this.btn_3_9.touchEnabled=!0,this.heroModel_hc.update(e);var i=Utils.TimerManager.getServerTime(!1),o=new Date(1e3*i),n=o.getDay()||7;o.setDate(o.getDate()+7-n),o.setHours(24,0,0,0),this.timerDt=o.getTime()/1e3-i,this.timer||(this.timer=egret.setInterval(function(){t.blb_3_9_time.text=Utils.TimerManager.getFormatBySecond2(--t.timerDt)},this,1e3))}else this.btn_3_9.visible=!1,this.btn_3_9.touchEnabled=!1},t.prototype.updateEggsBtn=function(){var e=s.AppFacade.getInstance().retrieveProxy(s.TaskPy.N).allTasks[TaskType.HideAchievement];for(var t in e){var i=e[t];500008==i.code&&i.isTarget&&(this.btn_3_6.touchEnabled=!1,this.btn_3_6.icon=""),500010==i.code&&i.isTarget&&(this.btn_3_7.touchEnabled=!1,this.btn_3_7.icon="")}},t.prototype.updateNewYearChallenge=function(e){var t=this;if(e.visible){this.btn_3_10.visible=!0,this.btn_3_10.touchEnabled=!0,this.heroModel3_10.update({model:e.model,isStatic:!0});var i=e.endDt;if(!this.timerNewYearChallenge){var o=Utils.TimerManager.getServerTime();this.bm_3_10_time.text=Utils.TimerManager.getFormatBySecond2(0<i-o?i-o:0),this.timerNewYearChallenge=egret.setInterval(function(){var e=Utils.TimerManager.getServerTime();t.bm_3_10_time.text=Utils.TimerManager.getFormatBySecond2(0<i-e?i-e:0)},this,1e3)}}else this.btn_3_10.visible=!1,this.btn_3_10.touchEnabled=!1,this.timerNewYearChallenge&&egret.clearInterval(this.timerNewYearChallenge)},t.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},t);function t(){var e=i.call(this)||this;return e.localOpenDay=0,e.EFF={},e.skinName="CitySkin",e.btns=new Array,e.winWidth=Utils.DeviceUtils.curWidth(),Utils.DebugUtils.isDebug&&(window._city=e),e}s.CityUI=e,__reflect(e.prototype,"game.CityUI")}(game=game||{}),function(a){var i,e=(__extends(o,i=BaseMediator),o.prototype.initSubView=function(){this.addSubView(o.SV.REWARD_PANEL,a.CommonRewardPreviewPanel),this.addSubView(o.SV.TIPS_DIALOG,a.CommonTipsDialog),this.addSubView(o.SV.HELP,a.HelpDialog),this.addSubView(o.SV.QUICK_BATTLE_DIALOG,a.CommonQuickBattleTips),this.addSubView(o.SV.SIMPLE_USE_PANEL,a.SimpleUsePanel),this.addSubView(o.SV.BUY_TIMES,a.CommonBuyTimesPanel),this.addSubView(o.SV.MOP_UP,a.CommonMopUpPanel),this.addSubView(o.SV.CONTINUOUS_BATTLE,a.CommonContinuousBattlePanel),this.addSubView(o.SV.TEAM_CHOOSE,a.CommonTeamChoosePanel),this.addSubView(o.SV.TEAM_PET_ART,a.CommonTeamPetAndArtPanel)},o.prototype.listNotificationInterests=function(){return[CN.REWARD_CLOSE,CN.BACKPACK_MULTI_TEAM_UPDATE]},o.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.REWARD_CLOSE:try{o.RewardCloseCallBack&&o.RewardCloseCallBack(t),o.RewardCloseCallBack=void 0}catch(e){console.log(e)}break;case CN.BACKPACK_MULTI_TEAM_UPDATE:var i=this.getSubView(o.SV.TEAM_CHOOSE);i&&i.updatePetAndArtList()}},o.prototype.showContinuousBattleView=function(t){var i=this;Utils.Socket.send(t.pb1,t.pb2,t.params).then(function(e){i.showSubView(o.SV.CONTINUOUS_BATTLE,{tipsFunc:t.tipsFunc,closeCB:t.closeCB})})},o.prototype.pushBattleRecord=function(e){this.battleResultCache.push(e),a.AppFacade.getInstance().updateView(o.N,o.SV.CONTINUOUS_BATTLE)},o.prototype.commonRollDice=function(e,t){PopUpManager.addPopUp({obj:new a.CommonRollDicePanel({num:e}),closeCB:function(){t&&t()}})},o.prototype.showCommonBuyNum=function(e){a.AppFacade.getInstance().showSubView(o.N,o.SV.BUY_TIMES,e)},o.prototype.showHelpDialog=function(e){var t=a.Config.moduleHelpConfig()[e];if(t){var i=JSON.parse(t.content),o=[];for(var n in i)i[n].split("%a").forEach(function(e,t){parseInt(t)%2==0?o.push({text:e}):o.push({text:e,style:{textColor:36807}})}),o.push({text:"\n",style:{textColor:36807}});PopUpManager.addPopUp({obj:new a.HelpDialog({text:o})})}else Utils.MsgUtils.addMidMsg("未找到说明配置")},o.N="CommonMediator",o.SV={REWARD_PANEL:1,TIPS_DIALOG:2,HELP:3,QUICK_BATTLE_DIALOG:4,SIMPLE_USE_PANEL:5,BUY_TIMES:6,MOP_UP:7,CONTINUOUS_BATTLE:8,TEAM_CHOOSE:9,TEAM_PET_ART:10},o);function o(e){void 0===e&&(e=null);var t=i.call(this,o.N,e)||this;return t.battleResultCache=[],t}a.CommonMediator=e,__reflect(e.prototype,"game.CommonMediator")}(game=game||{}),function(u){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent()},i.prototype.perShow=function(e){var t=e.moduleId;this.curNum=e.curNum,this.maxNum=e.maxNum,this.hasBuyNum=e.hasBuyNum,this.maxBuyNum=e.maxBuyNum,this.buyCB=e.buyCB,this.tips=e.tips;var i=e.numLimit;if(i&&this.curNum>=this.maxNum)return Utils.MsgUtils.addMidMsg("次数已达上限"),!1;if(!this.maxBuyNum||this.hasBuyNum<this.maxBuyNum){this.targetConfig=e.targetConfig||[];var o=u.Config.publicBuyCostConfig();for(var n in o){var a=o[n];a.costs=JSON.parse(a.costs),a.type==t&&(this.targetConfig[a.num]=a)}if(!this.targetConfig.length)return Utils.MsgUtils.addMidMsg("无配置"),!1;var r=u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N);this.resourceInfo=r.getInfoByCode(JSON.parse(this.targetConfig[1].costs)[0][1]);for(var s=0,c=this.resourceInfo.haveNum;;){var l=!1,h=this.targetConfig[this.hasBuyNum+s+1];h||(h=this.targetConfig[this.targetConfig.length-1],l=!0);var p=h.costs[0][2];if(c<p)break;var d=!1;if(l?(s+=Math.floor(c/p),d=!0):(s+=1,c-=p),this.maxBuyNum&&this.hasBuyNum+s>=this.maxBuyNum&&(s=Math.min(this.maxBuyNum-this.hasBuyNum,s),d=!0),i&&this.maxNum&&this.curNum+s==this.maxNum&&(s=Math.min(this.maxNum-this.curNum,s),d=!0),d)break}return this.maxBuyNum=s,!0}return Utils.MsgUtils.addMidMsg("无购买次数"),!1},i.prototype.updateView=function(e){this.setValueTo(1)},i.prototype.setValueTo=function(e){e>this.maxBuyNum&&(e=this.maxBuyNum),e<1&&(e=1),this.lb_num.text=e.toString(),this.updateTips()},i.prototype.updateTips=function(){if(!this.gp_tips.$children.length){var e=new eui.Label,t=new eui.Label;e.size=t.size=24,e.textColor=t.textColor=7491637,e.text="确定消耗";var i=new eui.Image(ResourceUtils.png(this.resourceInfo.info.icon));i.width=i.height=u.GeneralConfig.fixedSizeWH,this.gp_tips.addChild(e),this.gp_tips.addChild(i),this.gp_tips.addChild(t)}var o=this.gp_tips.$children[2],n=this.calPrice(Number(this.lb_num.text));this.tips?o.text="x"+n+"，"+this.tips.replace("%s",this.lb_num.text):o.text="x"+n+"，购买一次挑战次数？"},i.prototype.calPrice=function(e){for(var t=0,i=0;i<e;){var o=!1,n=this.targetConfig[this.hasBuyNum+i+1];n||(n=this.targetConfig[this.targetConfig.length-1],o=!0);var a=n.costs[0][2];if(o){t+=(e-i)*a;break}t+=a,i+=1}return t},i.prototype.activateComponent=function(){var e=this;this.lb_num.addEventListener(egret.Event.CHANGE,function(){Number(e.lb_num.text)>e.maxBuyNum&&(e.lb_num.text=e.maxBuyNum.toString()),e.updateTips()},this),this.lb_num.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){""!=e.lb_num.text&&Number(e.lb_num.text)||e.setValueTo(1)},this),Utils.TouchUtils.addTouchListener(this.btn_min,function(){e.setValueTo(Number(e.lb_num.text)-10)}),Utils.TouchUtils.addTouchListener(this.btn_sub,function(){e.setValueTo(Number(e.lb_num.text)-1)}),Utils.TouchUtils.addTouchListener(this.btn_add,function(){e.setValueTo(Number(e.lb_num.text)+1)}),Utils.TouchUtils.addTouchListener(this.btn_max,function(){e.setValueTo(Number(e.lb_num.text)+10)}),Utils.TouchUtils.addTouchListener(this.btn_cancle,function(){e.hide()}),Utils.TouchUtils.addTouchListener(this.btn_confirm,function(){e.hide(),e.buyCB(Number(e.lb_num.text))})},i);function i(){var e=t.call(this)||this;return e.tips="",e.skinName="CommonBuyTimesSkin",e}u.CommonBuyTimesPanel=e,__reflect(e.prototype,"game.CommonBuyTimesPanel")}(game=game||{}),function(e){var t,i=(t=eui.Component,__extends(o,t),o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.groups=[],this.initConfig(this.config),this.touchChildren=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.gp_touchField.width=this.width,this.gp_touchField.height=this.height},o.prototype.initConfig=function(e){if(e&&(this.config=e,this.groups))for(var t in e){var i=e[t],o=new eui.Group;o.x=i.x,o.y=i.y,o.width=i.w,o.height=i.h,o.touchChildren=!1,this.gp_main.addChild(o),this.groups.push({gp:o,x:i.x,y:i.y,w:i.w,h:i.h,hor:i.x+i.w/2,ver:i.y+i.h/2})}},o.prototype.addItem2Id=function(e,t){var i=this.groups[t];i?i.gp.addChild(e):console.warn("CommonDragGroup: no group id="+t)},Object.defineProperty(o.prototype,"dragDoneCB",{set:function(e){this._dragDoneCB=e},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"onTapCB",{set:function(e){this._tapDoneCB=e},enumerable:!0,configurable:!0}),o.prototype.getGpById=function(e){return this.groups[e]&&this.groups[e].gp},o.prototype.onTouchBegin=function(e){var t=this.getTouchedGroupPos(e);0<=t&&this.groups[t]&&(this.targetItem=this.groups[t].gp,this.curItemId=t,this.targetItemTouchTM=Date.now(),this.gp_main.setChildIndex(this.targetItem,-1),this.startingPos=t,this.gp_touchField.width=this.width,this.gp_touchField.height=this.height,this.beginX=e.stageX,this.beginY=e.stageY)},o.prototype.onTouchMove=function(e){this.targetItem&&this.setModelToXY(this.targetItem,e.stageX,e.stageY)},o.prototype.onTouchEnd=function(e){var t=this;if(this.targetItem){function i(){t.targetItem.x=t.groups[t.curItemId].x,t.targetItem.y=t.groups[t.curItemId].y,t.targetItem=void 0,t.curItemId=void 0,t.startingPos=void 0,t.gp_touchField.width=t.width,t.gp_touchField.height=t.height}var o=this.getTouchedGroupPos(e);Date.now()-this.targetItemTouchTM<DEEP_NEST_CONST.TOUCH_TIME?this._tapDoneCB?this._tapDoneCB(this.curItemId,i.bind(this)):i():this._dragDoneCB?this._dragDoneCB(this.curItemId,o,i.bind(this)):i()}},o.prototype.setModelToXY=function(e,t,i){e.width,e.scaleX,e.height,e.scaleY,e.x+=(t-this.beginX)/this.addScale,e.y+=(i-this.beginY)/this.addScale,this.beginX=t,this.beginY=i},o.prototype.getTouchedGroupPos=function(e){for(var t=0;t<this.groups.length;t++){var i=this.groups[t].gp;if(i!=this.targetItem){var o=i.localToGlobal(),n=i.width*this.addScale,a=i.height*this.addScale;if(this.rect?this.rect.setTo(o.x,o.y,n,a):this.rect=new egret.Rectangle(o.x,o.y,n,a),this.rect.contains(e.stageX,e.stageY))return t}}return-1},o);function o(){var e=t.call(this)||this;return e.beginX=0,e.beginY=0,e.addScale=Utils.DeviceUtils.additionScale(),e.skinName="CommonDragGroup",e}e.CommonDragGroup=i,__reflect(i.prototype,"customui.CommonDragGroup",["eui.UIComponent","egret.DisplayObject"])}(customui=customui||{}),function(s){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){var o=this;i.prototype.childrenCreated.call(this),this.initBtnListener(),this.s_baseitem6.touchEnabled=this.s_baseitem7.touchEnabled=!1,this.scroller_hero.scrollPolicyH=eui.ScrollPolicy.OFF,this.dragGroup.initConfig({0:{x:7,y:4,w:73.5,h:73.5},1:{x:85,y:4,w:73.5,h:73.5},2:{x:163,y:4,w:73.5,h:73.5},3:{x:272,y:4,w:73.5,h:73.5},4:{x:350,y:4,w:73.5,h:73.5},5:{x:428,y:4,w:73.5,h:73.5}});for(var e=0;e<6;e++){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,t.touchEnabled=!1,this.id2baseitem[e]=t,this.id2baseitem[e].resetFixedStyle(EEntityType.EEntityTypeHero),this.dragGroup.addItem2Id(t,e)}this.dragGroup.dragDoneCB=this.exchangeHero.bind(this),this.dragGroup.onTapCB=function(e,t){var i=o.heroList[o.curIndex][e];o.touchHeroEvent(!1,{info:s.GameMVC.heroPy.allHeroByUuid[i]}),o.updateAllHeroByFilter(),t&&t()},this.list_filter.itemRenderer=s.DecomposeUI_FilterItem,this.list_filter.dataProvider=new eui.ArrayCollection([{race:HeroRaceType.Human,icon:HeroRaceConfig[HeroRaceType.Human].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Elf,icon:HeroRaceConfig[HeroRaceType.Elf].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Orc,icon:HeroRaceConfig[HeroRaceType.Orc].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Athanasy,icon:HeroRaceConfig[HeroRaceType.Athanasy].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Demon,icon:HeroRaceConfig[HeroRaceType.Demon].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Eldar,icon:HeroRaceConfig[HeroRaceType.Eldar].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"}]),this.list_filter.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){var t=e.item;o.list_filter.dataProvider,0<=o.curFilter.race.indexOf(t.race)?o.curFilter.race=[]:o.curFilter.race=[t.race],o.list_filter.$children.forEach(function(e){e.setChosen(0<=o.curFilter.race.indexOf(e.data.race))}),o.updateAllHeroByFilter()},this),this.initHeroPetArtLocalList(),this.updateView()},t.prototype.initBtnListener=function(){var t=this;this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.getUpHeroList();if(0!=e.heros.filter(function(e){return!!e}).length)if(this.params.touchHoldCB){var t=this.params.touchHoldCB(e);t&&(this.opperationParams=t,this.hide())}else this.opperationParams=e,this.hide();else Utils.MsgUtils.addMidMsg("至少上阵一个英雄")},this),this.gp_myPet.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new s.CommonChosePanel({getInfos:function(){return s.GameMVC.petPy.allPetByUuid},selectUuids:t.petList[0]?[t.petList[0]]:[],type:EEntityType.EEntityTypePet,checkFull:function(e){return 1<=e.length},sortFunc:function(e,t){return e.info.code-t.info.code},fullTip:"只能上阵一只宠物",title:"请选择出战宠物"}),closeCB:function(e){t.updatePetOrArtUuidByChoose(EEntityType.EEntityTypePet,e)}})},this),this.gp_myArt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new s.CommonChosePanel({getInfos:function(){return s.GameMVC.magicalArtifactPy.allMagicalArtifactByUuid},selectUuids:t.artList[0]?[t.artList[0]]:[],type:EEntityType.EEntityTypeMagical,checkFull:function(e){return 1<=e.length},sortFunc:function(e,t){return e.info.code-t.info.code},fullTip:"只能上阵一个神兵",title:"请选择出战神兵"}),closeCB:function(e){t.updatePetOrArtUuidByChoose(EEntityType.EEntityTypeMagical,e)}})},this)},t.prototype.updateView=function(e){this.params=e||this.params||{},this.getAllHeroList(),this.updateAllHeroByFilter(),this.updateUpHeroBI(),this.updatePetAndArtInfo(),e&&e.formPre?this.btn_yes.label="挑 战":this.btn_yes.label="保 存"},t.prototype.updateUpHeroBI=function(){var i=this;this.heroList[this.curIndex].forEach(function(e,t){e?(i.id2baseitem[t].updateData({type:EEntityType.EEntityTypeHero,uuid:e}),i.id2baseitem[t].img_zudui.visible=!1):i.id2baseitem[t].resetFixedStyle(EEntityType.EEntityTypeHero)})},t.prototype.getAllHeroList=function(){this.allHeroInfo=[];var e=s.GameMVC.heroPy.allHeroByUuid;if(this.params.getAllInfo&&(e=this.params.getAllInfo()),e)for(var t in e){var i=e[t];this.allHeroInfo.push({type:s.BackpackUI.ITEM_TYPE.HERO,info:i,teamNum:this.judgeUpTeam(i.uuid),touchCB:this.touchHeroEvent.bind(this)})}},t.prototype.updateAllHeroByFilter=function(){this.scroller_hero.stopAnimation();var e,t,i=[],o=this.params.sorter||function(e,t){return e.info.level!=t.info.level?t.info.level-e.info.level:e.info.fightCap!=t.info.fightCap?t.info.fightCap-e.info.fightCap:t.info.uuid-e.info.uuid},n=s.GameMVC.heroPy.allHeroByUuid;if(this.params.getAllInfo&&(n=this.params.getAllInfo()),n)for(var a in n){var r=n[a];e=this.curFilter,t=r,(0==e.race.length||0<=e.race.indexOf(t.config.race))&&i.push({type:s.BackpackUI.ITEM_TYPE.HERO,info:r,teamNum:this.judgeUpTeam(r.uuid),touchCB:this.touchHeroEvent.bind(this)})}0<i.length&&o&&i.sort(o),this.dataprovider=new eui.ArrayCollection(i),this.list_hero.itemRenderer=c,this.list_hero.dataProvider=this.dataprovider},t.prototype.initHeroPetArtLocalList=function(){this.heroList=[["","","","","",""]],this.petList=[""],this.artList=[""];var e=this.params.formation;if(e){if(e.heros)for(Array.isArray(e.heros)&&(this.heroList=[[].concat(e.heros)]);this.heroList[this.curIndex].length<6;)this.heroList[this.curIndex].push("");e.pets[0]&&(this.petList=e.pets),e.magicals[0]&&(this.artList=e.magicals),this.updatePetAndArtInfo()}},t.prototype.updatePetAndArtInfo=function(){this.img_addpet_1.visible=!0,this.img_addart_1.visible=!0;var e=this.curIndex,t=void 0,i=void 0,o=this.petList[e],n=this.artList[e];""!=o&&(t=s.GameMVC.petPy.allPetByUuid[o]),""!=n&&(i=s.GameMVC.magicalArtifactPy.allMagicalArtifactByUuid[n]),t?(this.img_addpet_1.visible=!1,this.s_baseitem6.updateData({type:EEntityType.EEntityTypePet,code:t.code}),this.s_baseitem6.visible=!0):(this.img_addpet_1.visible=!0,this.s_baseitem6.visible=!1),i?(this.img_addart_1.visible=!1,this.s_baseitem7.updateData({type:EEntityType.EEntityTypeMagical,code:i.code}),this.s_baseitem7.visible=!0):(this.img_addart_1.visible=!0,this.s_baseitem7.visible=!1)},t.prototype.updatePetOrArtUuidByChoose=function(e,t){e==EEntityType.EEntityTypeMagical?this.artList=t:e==EEntityType.EEntityTypePet&&(this.petList=t),this.updatePetAndArtInfo()},t.prototype.judgeUpTeam=function(i){var o=0;return this.heroList.forEach(function(e,t){o||e.forEach(function(e){e==i&&(o=t+1)})}),o},t.prototype.getUpHeroList=function(){var e=[];for(var t in this.heroList[0]){var i=this.heroList[0][t];e.push(i)}return{heros:e,pets:this.petList[0]?[this.petList[0]]:[],magicals:this.artList[0]?[this.artList[0]]:[]}},t.prototype.touchHeroEvent=function(e,o,t){if(e){var i=0;if(this.heroList[this.curIndex].forEach(function(e,t){i||e||(i=t+1)}),0==i)Utils.MsgUtils.addMidMsg("当前阵容已上满");else{var n=0==o.info.dermaCode?void 0:s.Config.getHeroDermaConfig()[o.info.dermaCode].avatar;o.teamNum=this.curIndex+1,this.id2baseitem[i-1].updateData({vo:o.info,type:EEntityType.EEntityTypeHero,avatar:n}),this.heroList[this.curIndex][i-1]=o.info.uuid,t&&t()}}else{var a=0,r=0;this.heroList.forEach(function(e,i){a||e.forEach(function(e,t){a||e==o.info.uuid&&(a=i+1,r=t+1)})}),0!=a&&(this.id2baseitem[r-1].resetFixedStyle(EEntityType.EEntityTypeHero),o.teamNum=0,this.heroList[a-1][r-1]="",t&&t())}},t.prototype.exchangeHero=function(e,t,i){if(e<0||t<0)i&&i();else{var o=this.heroList[this.curIndex][e];this.heroList[this.curIndex][e]=this.heroList[this.curIndex][t],this.heroList[this.curIndex][t]=o,this.updateUpHeroBI(),i&&i()}},t);function t(e){var t=i.call(this)||this;return t.allHeroInfo=[],t.id2baseitem=[],t.curIndex=0,t.dataprovider=new eui.ArrayCollection,t.curFilter={race:[]},t.heroList=[[],[],[]],t.petList=[],t.artList=[],t.skinName="CommonFormationViewSkin",t.params=e,t}s.CommonFormationView=e,__reflect(e.prototype,"game.CommonFormationView");var o,c=(o=s.GloryArenaTeamHeroItem,__extends(n,o),n);function n(){var e=o.call(this)||this;return e.CHOOSE_NUM=["chuanghao_img_gouxuan_png","chuanghao_img_gouxuan_png","chuanghao_img_gouxuan_png"],e}__reflect(c.prototype,"CommonFormationViewItem")}(game=game||{}),function(n){var t,e=(__extends(i,t=BasePanel),i.prototype.updateView=function(e){this.pb1=e.pb1,this.pb2=e.pb2,this.params=e.params||{},this.mopUpTimes=e.mopUpTimes,this.cb=e.cb,this.tipsFunc=e.tipsFunc,this.pullMopUpResult()},i.prototype.pullMopUpResult=function(){var i=this;this.data=void 0,Utils.Socket.send(this.pb1,this.pb2,this.params).then(function(e){i.mopUpTimes&&(i.mopUpTimes-=1),i.data=e;var t=i.data.records;i.recordsQueue=i.recordsQueue.concat(t),i.startRolling(function(){if((null==i.mopUpTimes||0<i.mopUpTimes)&&1==i.showedRecords[i.showedRecords.length-1].result){var e=!i.cb;e||(e=i.cb(i.data),i.data=void 0),e&&i.pullMopUpResult()}})})},i.prototype.startRolling=function(t){var i=this;if(this.recordsQueue.length){this.curTimes+=1;var e=this.recordsQueue.shift();this.showedRecords.push(e);var o=new c(e);o.lb_tips.text=this.tipsFunc(this.curTimes),this.gp_records.addChild(o),egret.Tween.get(this.scl.viewport).wait(100).call(function(){if(!i.viewClosed){i.scl.validateNow();var e=i.scl.viewport.contentHeight-i.scl.height;e<0&&(e=0),egret.Tween.get(i.scl.viewport).to({scrollV:e},250).wait(250).call(function(){i.startRolling(t)})}})}else t()},i.prototype.perClose=function(){this.viewClosed=!0,egret.Tween.removeTweens(this.scl.viewport),this.data&&this.cb&&this.cb(this.data)},i);function i(){var e=t.call(this)||this;return e.viewClosed=!1,e.skinName="CommonMopUpSkin",e.recordsQueue=[],e.showedRecords=[],e.curTimes=0,e}n.CommonMopUpPanel=e,__reflect(e.prototype,"game.CommonMopUpPanel");var o,a=(__extends(r,o=BasePanel),r.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.gp_touchFeild,egret.TouchEvent.TOUCH_TAP,function(){e.battleOver?e.hide():Utils.MsgUtils.addMidMsg("请等待战斗结束")},this)},r.prototype.updateView=function(e){e&&e.tipsFunc&&(this.tipsFunc=e.tipsFunc),this.startRolling()},r.prototype.startRolling=function(){var t=this;if(!this.rolling){var e=n.GameMVC.commonMed.battleResultCache;if(e.length){this.rolling=!0,this.curTimes+=1;var i=e.shift();this.showedRecords.push(i);var o=new p(i);o.lb_tips.text=this.tipsFunc(this.curTimes),this.gp_records.addChild(o),egret.Tween.get(this.scl.viewport).wait(100).call(function(){t.scl.validateNow();var e=t.scl.viewport.contentHeight-t.scl.height;e<0&&(e=0),egret.Tween.get(t.scl.viewport).to({scrollV:e},250).wait(250).call(function(){t.rolling=!1,0==i.attackEntity.blood||0==i.defenceEntity.blood?(t.battleOver=!0,Utils.MsgUtils.addMidMsg("战斗结束")):t.startRolling()})})}}},r.prototype.perClose=function(){egret.Tween.removeTweens(this.scl.viewport)},r);function r(){var e=o.call(this)||this;return e.firstIn=!0,e.rolling=!1,e.battleOver=!1,e.skinName="CommonContinuousBattleSkin",e.showedRecords=[],e.curTimes=0,e}n.CommonContinuousBattlePanel=a,__reflect(a.prototype,"game.CommonContinuousBattlePanel");var s,c=(s=eui.Component,__extends(l,s),l.prototype.childrenCreated=function(){s.prototype.childrenCreated.call(this),this.update()},l.prototype.update=function(){var i=this;this.img_result.source=1==this.data.result?"yxdyz_img_shengli_png":"yxdyz_img_zhanban_png";var e=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N).playerInfoVO;this.gp_self.addChild(this.makeInfoGroup(e,!0)),this.gp_enemy.addChild(this.makeInfoGroup(this.data.baseInfo,!1)),this.data.rewardShow.length?this.data.rewardShow.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData(e),i.gp_rewardsItem.addChild(t)}):this.gp_content.removeChild(this.gp_rewards)},l.prototype.makeInfoGroup=function(e,t){var i=new eui.Group;i.width=240,i.height=82;var o=customui.PlayerHeadFactory.create();o.scaleX=o.scaleY=.7,o.updateData({vo:e}),i.addChild(o);var n=new eui.Label;n.textColor=15913814,n.size=20,n.text=e.name,i.addChild(n);var a=new customui.CommonFightCapItem;return a.scaleX=a.scaleY=.7,a.update(e.fightCap),i.addChild(a),t?(o.x=o.y=6,n.x=87,n.y=13,a.x=90,a.y=50):(o.x=166,o.y=6,n.right=84,n.y=13,a.x=31,a.y=51),i},l);function l(e){var t=s.call(this)||this;return t.skinName="CommonMopUpPanel_MopUpItem",t.data=e,t}__reflect(c.prototype,"CommonMopUpPanel_MopUpItem");var h,p=(h=eui.Component,__extends(d,h),d.prototype.childrenCreated=function(){var e=this;h.prototype.childrenCreated.call(this),this.playerHead_self=customui.PlayerHeadFactory.create(),this.gp_avatar_self.addChild(this.playerHead_self),this.playerHead_oppo=customui.PlayerHeadFactory.create(),this.gp_avatar_oppo.addChild(this.playerHead_oppo),Utils.ComponentUtils.registerListener(this.btn_review,egret.TouchEvent.TOUCH_TAP,function(){n.GameMVC.fightPy.BattlePlayBack(e.data.uuid)},this),this.update()},d.prototype.update=function(){this.img_result.source=this.data.win==EBattleResult.EBattleResultWin?"yxdyz_img_shengli_png":"yxdyz_img_zhanban_png";var e=this.data.attackEntity,t=this.data.defenceEntity;if(this.playerHead_self.updateData({vo:e.baseInfo}),this.playerHead_oppo.updateData({vo:t.baseInfo}),this.lb_name_self.text=e.baseInfo.name,this.lb_name_oppo.text=t.baseInfo.name,this.fightCap_self.update(e.baseInfo.fightCap),this.fightCap_oppo.update(t.baseInfo.fightCap,!0),this.blb_lost_self.text="-"+e.decreaseBlood+"(剩余"+e.blood+")",this.blb_lost_oppo.text="-"+t.decreaseBlood+"(剩余"+t.blood+")",this.data&&this.data.battleRecord){var i=JSON.parse(this.data.battleRecord.keyStr),o=JSON.parse(this.data.battleRecord.tKeyStr);this.blb_score_l.text="+"+(i.newIntegral-i.oldIntegral)+"("+i.newIntegral+")",this.blb_score_r.text="+"+(o.newIntegral-o.oldIntegral)+"("+o.newIntegral+")"}else this.blb_score_l.text="",this.blb_score_r.text=""},d);function d(e){var t=h.call(this)||this;return t.skinName="CommonContinuousBattlePanel_BattleItem",t.data=e,t}__reflect(p.prototype,"CommonContinuousBattlePanel_BattleItem")}(game=game||{}),function(e){var i,t=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.updateView()},o.prototype.updateView=function(){this.updateBaseInfo(),this.updateHeros(),this.updatePet()},o.prototype.updateBaseInfo=function(){var e=this.params.baseInfo;this.cu_ph.updateData({vo:e}),this.lb_name.text=e.name,this.lb_id.text="ID:"+e.playerId,this.lb_guild.text=e.guildName,this.item_fightCap.update(e.fightCap)},o.prototype.updateHeros=function(){this.gp_heros.removeChildren();for(var e=this.params.heros,t=1;t<=6;t++){var i=!1;for(var o in e)if(e[o].pos==t){i=!0;var n,a={code:e[o].code||e[o].heroId,level:e[o].level,starLevel:e[o].starLevel,defendLevel:e[o].defendLevel};(n=customui.BaseItemFactory.create()).scaleX=n.scaleY=.7,n.updateData({type:EEntityType.EEntityTypeHero,vo:a}),this.gp_heros.addChild(n)}i||((n=customui.BaseItemFactory.create()).resetFixedStyle(EEntityType.EEntityTypeHero),n.scaleX=n.scaleY=.7,this.gp_heros.addChild(n))}},o.prototype.updatePet=function(){this.gp_pet.removeChildren();var e=this.params.pet,t=customui.BaseItemFactory.create();e&&e.code?t.updateData({type:EEntityType.EEntityTypePet,vo:{code:e.code,level:e.level}}):t.resetFixedStyle(EEntityType.EEntityTypeHero),t.verticalCenter=t.horizontalCenter=0,t.scaleX=t.scaleY=.7,this.gp_pet.addChild(t)},o);function o(e){var t=i.call(this)||this;return t.skinName="CommonPlayerInfoPanelSkin",t.params=e,t}e.CommonPlayerInfoPanel=t,__reflect(t.prototype,"game.CommonPlayerInfoPanel")}(game=game||{}),function(y){var t,e=(__extends(a,t=BasePanel),a.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.autoClose=egret.setTimeout(function(){e.hide()},this,3e3),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),DragonBoneTools.create("common_huodewupin",function(e){e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2+45,e.animation.play(),this.gp_effect.addChild(e)},this)},a.prototype.updateView=function(g){var f=this,e=g&&g.type&&g.type.type||a.REWARD_TYPE.REWARD.type;1==e&&Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_dianjin);var t=g&&g.type&&g.type.title||a.REWARD_TYPE.REWARD.title;RES.getResAsync(t,function(e){f.img_tilte.source=e},this),g.top_tips?(this.lb_top_tips.text=g.top_tips,this.lb_top_tips.visible=!0):this.lb_top_tips.visible=!1,g.bottom_tips?(this.lb_bottom_tips.text=g.bottom_tips,this.lb_bottom_tips.visible=!0):this.lb_bottom_tips.visible=!1,g.lb_top_text?(this.lb_top_text.text=g.lb_top_text,this.lb_top_text.visible=!0):this.lb_top_text.visible=!1,g.bottom_tips_offsetY&&(this.lb_bottom_tips.bottom+=g.bottom_tips_offsetY),this.onCloseCB=g.onCloseCB;var _=g.rewards;Array.isArray(_)&&(_={rewards:_}),this.reward_0.removeChildren(),this.rewardNum=0;var m=[];switch(e){case a.REWARD_TYPE.REWARD.type:this.REWARD_NAME.forEach(function(e){var t=_[e]||[];for(var i in t){var o=t[i],n=0,a=0,r=0,s="";switch(e){case"rewards":a=o.type||o[0],n=o.code||o[1],r=o.num||o[2];break;case"heros":s=o.uuid,a=EEntityType.EEntityTypeHero;break;case"vestageHeros":s=o.uuid,a=EEntityType.EEntityTypeVestageHero,y.GameMVC.dungeonPy.hasNewHeroGet=!0;break;case"heroEquips":n=o.code||o[1],a=EEntityType.EEntityTypeHeroEquip,r=o.num;break;case"heroArtifacts":n=o.code||o[1],a=EEntityType.EEntityTypeHeroArtifact,r=o.num;break;case"immortals":n=o.subType||o[1],a=EEntityType.EEntityTypeImmortal,r=o.num;break;case"pets":s=o.uuid,a=EEntityType.EEntityTypePet;break;case"maps":s=o.uuid,a=EEntityType.EEntityTypeMap}if(g&&"Compound"==g.action){if(!o.code)return;for(var c={num:1,vo:o},l=!0,h=0,p=m;h<p.length;h++){var d=p[h];if(d.vo.code==c.vo.code){l=!1,++d.num;break}}l&&(m.push(c),++f.rewardNum)}else{var u=""!=s?{uuid:s,type:a}:{type:a,code:n,num:r};"heroEquips"!=e&&"heroArtifacts"!=e||(u={type:a,code:n,num:r}),m.push(u),++f.rewardNum}}});break;case a.REWARD_TYPE.OBTAIN.type:this.REWARD_NAME.forEach(function(e){var t=_[e]||[];0<t.length&&t.forEach(function(e){var t={type:e.type||e[0],code:e.code||e[1],num:e.num||e[2]||1};m.push(t),++f.rewardNum})}),_.isArray&&0==this.rewardNum&&0<_.length&&(_||[]).forEach(function(e){var t={type:e.type||e[0],code:e.code||e[1],num:e.num||e[2]||1};m.push(t),++f.rewardNum})}var i=5<this.rewardNum?5:this.rewardNum,o=4<Math.ceil(this.rewardNum/5)?4:Math.ceil(this.rewardNum/5);5<this.rewardNum&&(this.gp_root.height=this.gp_root.height+84*(o-1));var n=new eui.ArrayCollection(m);this.reward_1.itemRenderer=s,this.reward_1.dataProvider=n,this.sl_reward.width=84*i+10*(i-1),this.sl_reward.height=84*o+10*(o-1),this.sl_reward.x=(this.gp_root.width-this.sl_reward.width)/2,this.sl_reward.y=(this.gp_root.height-this.sl_reward.height)/2+50,g&&g.closeTimer&&this.autoClose&&egret.clearTimeout(this.autoClose)},a.prototype.perShow=function(e){var i=e.rewards;Array.isArray(i)&&(i={rewards:i});var o=0;return this.REWARD_NAME.forEach(function(e){var t=i[e]||[];o+=t.length}),0!=o},a.prototype.perClose=function(){egret.clearTimeout(this.autoClose),this.onCloseCB&&this.onCloseCB(this.opperationParams),y.AppFacade.getInstance().sendNotification(CN.ACTIVITY_SHOW_TRIGGER),y.AppFacade.getInstance().sendNotification(CN.REWARD_CLOSE),y.AppFacade.getInstance().sendNotification(CN.SHOW_WECHAT_SHARE,{filter:!0}),y.AppFacade.getInstance().sendNotification(CN.NEWBRAVEBOOK_LEVEL_UPDATE,{LevelEffect:!0})},a.REWARD_TYPE={REWARD:{type:1,title:"hdwp_txt_huodewupin_png"},OBTAIN:{type:2,title:"hdwp_txt_wupinyulan_png"}},a);function a(){var e=t.call(this)||this;return e.rewardArr=[],e.REWARD_NAME=["rewards","heros","heroEquips","heroArtifacts","pets","maps","vestageHeros","immortals"],e.skinName="CommonRewardPreviewPanelSkin",e}y.CommonRewardPreviewPanel=e,__reflect(e.prototype,"game.CommonRewardPreviewPanel");var i,o=(i=eui.Component,__extends(n,i),n.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.blb_num.visible=!1,this.gp_baseItem.addChild(this.baseItem),this.data&&this.update(this.data)},n.prototype.update=function(e){this.data=e,this.baseItem.updateData(this.data),this.blb_num.text="x"+(this.data.num||1)},n);function n(e){var t=i.call(this)||this;return t.skinName="BaseItemWithNumSkin",t.data=e,t}__reflect(o.prototype,"BaseItemWithNum");var r,s=(r=eui.ItemRenderer,__extends(c,r),c.prototype.childrenCreated=function(){r.prototype.childrenCreated.call(this)},c.prototype.dataChanged=function(){this.baseItem_1.updateData(this.data)},c);function c(){var e=r.call(this)||this;return e.skinName="BaseItemRenderSkin",e}__reflect(s.prototype,"BaseItemRender")}(game=game||{}),function(e){var i,t=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.gp_root=new eui.Group,this.gp_root.width=Utils.DeviceUtils.curWidth(),this.gp_root.height=Utils.DeviceUtils.curHeight(),this.addChild(this.gp_root),this.rollDice()},o.prototype.rollDice=function(){var t=this,i=this.data.num;DragonBoneTools.playOnce({effectName:"common_toushaizi",parent:this.gp_root,y:this.gp_root.height/2+80,doneCB:function(){var e=new eui.Image("touzi_"+i+"_png");e.horizontalCenter=e.verticalCenter=0,t.gp_root.addChild(e),egret.setTimeout(function(){t.hide()},t,1e3)}})},o);function o(e){var t=i.call(this)||this;return t.data=e,t}e.CommonRollDicePanel=t,__reflect(t.prototype,"game.CommonRollDicePanel")}(game=game||{}),function(l){var n,e=(__extends(t,n=BasePanel),t.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.initFilter(),this.initBtnListener(),this.addListener(),this.chooseHeroPage=0,this.heroList1=[],this.heroList2=[],this.heroList3=[];for(var e=DEEP_NEST_CONST.SHANGZHEN_LINE*DEEP_NEST_CONST.HERO_COUNT,t=1;t<=e;t++){var i=customui.BaseItemFactory.create();this.pos2HeroBI[t]=i,this.pos2HeroBI[t].indexNum=t,this.pos2HeroBI[t].resetFixedStyle(EEntityType.EEntityTypeHero);var o=this.pos2XY(t);i.x=o[0],i.y=o[1],i.scaleX=18<t?.9:.7,i.scaleY=18<t?.9:.7,this.gp_heroList.addChild(i),0<t&&t<7?this.heroList1.push(i):7<=t&&t<13?this.heroList2.push(i):13<=t&&t<19&&this.heroList3.push(i)}this.petList=["","",""],this.artList=["","",""]},t.prototype.initBtnListener=function(){var t=this;this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.getUpHeroList();if(this.params.touchHoldCB){var t=this.params.touchHoldCB(e,!0);t&&this.backProxy.ChangeFormation({type:this.params.module,teams:t},this.hide.bind(this))}else this.backProxy.ChangeFormation({type:this.params.module,teams:e},this.hide.bind(this))},this),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.getUpHeroList();if(this.params.touchHoldCB){var t=this.params.touchHoldCB(e);t&&this.backProxy.ChangeFormation({type:this.params.module,teams:t},this.hide.bind(this))}else this.backProxy.ChangeFormation({type:this.params.module,teams:e},this.hide.bind(this))},this),this.gp_up_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.changeOrderAbove(0)},this),this.gp_up_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.changeOrderAbove(1)},this),this.gp_choosePet_0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){l.AppFacade.getInstance().showSubView(l.CommonMediator.N,l.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypePet,team:1,list:t.petList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.gp_choosePet_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){l.AppFacade.getInstance().showSubView(l.CommonMediator.N,l.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypePet,team:2,list:t.petList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.gp_choosePet_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){l.AppFacade.getInstance().showSubView(l.CommonMediator.N,l.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypePet,team:3,list:t.petList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.gp_chooseArt_0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){l.AppFacade.getInstance().showSubView(l.CommonMediator.N,l.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypeMagical,team:1,list:t.artList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.gp_chooseArt_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){l.AppFacade.getInstance().showSubView(l.CommonMediator.N,l.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypeMagical,team:2,list:t.artList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.gp_chooseArt_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){l.AppFacade.getInstance().showSubView(l.CommonMediator.N,l.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypeMagical,team:3,list:t.artList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.btn_helo.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){},this),this.btn_pet.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){l.AppFacade.getInstance().showSubView(l.CommonMediator.N,l.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypePet,team:0,list:t.petList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.btn_art.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){l.AppFacade.getInstance().showSubView(l.CommonMediator.N,l.CommonMediator.SV.TEAM_PET_ART,{type:EEntityType.EEntityTypeMagical,team:0,list:t.artList,doneCB:t.updatePetOrArtUuidByChoose.bind(t)})},this),this.btn_filter.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_filters.visible=!0;var e=this.gp_filter.globalToLocal(0,0),t=new egret.Sprite;t.touchEnabled=!0,t.graphics.beginFill(0,0),t.graphics.drawRect(e.x,e.y,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),t.graphics.endFill(),this.gp_filter.addChildAt(t,2),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.gp_filters.visible=!1,t.parent&&t.parent.removeChild(t)},this)},this)},t.prototype.initFilter=function(){var o=this;this.gp_filters_list.removeChildren();var e=this.ITEM_TYPE_CONFIG[l.BackpackUI.ITEM_TYPE.HERO].filterConfig.data;e&&0<e.length?(this.gp_filter.visible=!0,e.forEach(function(e){var t=new eui.List;t.itemRenderer=l.DecomposeUI_FilterItem;var i=new eui.HorizontalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER,t.layout=i,t.dataProvider=new eui.ArrayCollection(e),t.addEventListener(eui.ItemTapEvent.ITEM_TAP,o.filterItem_onItemTap,o),o.gp_filters_list.addChild(t)}),this.gp_filters.height=42*e.length+20*(e.length-1)+40):this.gp_filter.visible=!1},t.prototype.filterItem_onItemTap=function(e){var t=e.itemRenderer;if(this.ITEM_TYPE_CONFIG[l.BackpackUI.ITEM_TYPE.HERO].filterConfig.addFilter(this.curFilter,e.item),!t.chosen)for(var i=0,o=this.gp_filters_list.$children;i<o.length;i++){var n=o[i];if(-1!=n.$children.indexOf(t))for(var a=0,r=n.$children;a<r.length;a++){var s=r[a];s.chosen&&s.setChosen(!1)}}t.setChosen(!t.chosen),this.updateAllHero()},t.prototype.addListener=function(){this.gp_touchField.touchChildren=!0,this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},t.prototype.removeListener=function(){this.gp_touchField.touchChildren=!1,this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},t.prototype.updateView=function(e){this.params=e,this.updateAllHeroList(),this.updateUpHero(),this.updateAllHero(),this.updatePetAndArtList(),this.lb_tips.visible=this.params.tips,this.params.tips&&(this.lb_tips.text=this.params.tips),this.params.title&&(this.blb_title.text=this.params.title)},t.prototype.updateUpHero=function(){var e=this.backProxy.getModuleTeam(this.params.module);if(e&&e.teams){for(var t=e.teams,i=1;i<=18;i++)this.pos2HeroBI[i].resetFixedStyle(EEntityType.EEntityTypeHero);for(var o in t)for(var i in t[o].heros){var n=t[o].heros[i].battlePos,a=t[o].heros[i].uuid,r=n+6*(t[o].teamNo-1),s=this.heroProxy.allHeroByUuid[a];if(s){var c=0==s.dermaCode?void 0:l.Config.getHeroDermaConfig()[s.dermaCode].avatar;this.pos2HeroBI[r].updateData({vo:s,type:EEntityType.EEntityTypeHero,avatar:c})}}}},t.prototype.updateAllHeroList=function(){this.allHeroInfo=[];var e=this.ITEM_TYPE_CONFIG[l.BackpackUI.ITEM_TYPE.HERO].getAllInfo();if(e)for(var t in e){var i=e[t];this.allHeroInfo.push({type:l.BackpackUI.ITEM_TYPE.HERO,info:i,teamNum:this.judgeUpTeam(i.uuid),touchCB:this.touchHeroEvent.bind(this)})}},t.prototype.updateAllHero=function(){this.scroller_hero.stopAnimation();var e=[],t=this.ITEM_TYPE_CONFIG[l.BackpackUI.ITEM_TYPE.HERO],i=t.filterConfig&&t.filterConfig.filterFunc||function(){return!0},o=t.sortConfig&&t.sortConfig.defaultSortFunc,n=t.getAllInfo();if(n)for(var a in n){var r=n[a];i(this.curFilter,r)&&e.push({type:l.BackpackUI.ITEM_TYPE.HERO,info:r,teamNum:this.judgeUpTeam(r.uuid),touchCB:this.touchHeroEvent.bind(this)})}0<e.length&&o&&e.sort(o),this.dataprovider=new eui.ArrayCollection(e),this.list_hero.itemRenderer=s,this.list_hero.dataProvider=this.dataprovider},t.prototype.updatePetAndArtList=function(){var e=this.backProxy.getModuleTeam(this.params.module);if(e&&e.teams){for(var t=e.teams,i=0;i<t.length;i++)this.petList[i]=t[i].petUuid?t[i].petUuid:"",this.artList[i]=t[i].magicalUuid?t[i].magicalUuid:"";this.updatePetAndArtInfo()}},t.prototype.updatePetAndArtInfo=function(){this.img_usePet_0.visible=!1,this.img_usePet_1.visible=!1,this.img_usePet_2.visible=!1,this.img_useArt_0.visible=!1,this.img_useArt_1.visible=!1,this.img_useArt_2.visible=!1,this.img_addpet_0.visible=!0,this.img_addpet_1.visible=!0,this.img_addpet_2.visible=!0,this.img_addart_0.visible=!0,this.img_addart_1.visible=!0,this.img_addart_2.visible=!0;for(var e=0;e<3;e++){var t=void 0,i=void 0,o=this.petList[e],n=this.artList[e];""!=o&&(t=this.petProxy.allPetByUuid[o]),""!=n&&(i=this.artProxy.allMagicalArtifactByUuid[n]),0==e?(t&&(this.img_addpet_0.visible=!1,this.img_usePet_0.visible=!0,this.img_usePet_0.source=t.config.avatar+"_png"),i&&(this.img_addart_0.visible=!1,this.img_useArt_0.visible=!0,this.img_useArt_0.source=i.config.model+"_png")):1==e?(t&&(this.img_addpet_1.visible=!1,this.img_usePet_1.visible=!0,this.img_usePet_1.source=t.config.avatar+"_png"),i&&(this.img_addart_1.visible=!1,this.img_useArt_1.visible=!0,this.img_useArt_1.source=i.config.model+"_png")):2==e&&(t&&(this.img_addpet_2.visible=!1,this.img_usePet_2.visible=!0,this.img_usePet_2.source=t.config.avatar+"_png"),i&&(this.img_addart_2.visible=!1,this.img_useArt_2.visible=!0,this.img_useArt_2.source=i.config.model+"_png"))}},t.prototype.updatePetOrArtUuidByChoose=function(e,t){e==EEntityType.EEntityTypeMagical?this.artList=t:e==EEntityType.EEntityTypePet&&(this.petList=t),this.updatePetAndArtInfo()},t.prototype.judgeUpTeam=function(e){for(var t=0,i=1;i<19;i++)this.pos2HeroBI[i].vo&&this.pos2HeroBI[i].vo.uuid&&this.pos2HeroBI[i].vo.uuid==e&&(1<=i&&i<=6?t=1:7<=i&&i<=12?t=2:12<=i&&i<=18&&(t=3));return t},t.prototype.pos2XY=function(e){var t,i;t=Math.ceil((e-6)/DEEP_NEST_CONST.HERO_COUNT),i=(e-1)%DEEP_NEST_CONST.HERO_COUNT;var o=0,n=0,a=0;return t<3?(n=2<i?45:15,o=75):(o=100,n=25),0==t?a=48:1==t?a=67:2==t&&(a=82),[i*o+n,100*t+(2<t?120:a)]},t.prototype.getUpHeroList=function(){for(var e=[],t={heros:[],petUuid:this.petList[0],magicalUuid:this.artList[0],teamNo:1},i={heros:[],petUuid:this.petList[1],magicalUuid:this.artList[1],teamNo:2},o={heros:[],petUuid:this.petList[2],magicalUuid:this.artList[2],teamNo:3},n=1;n<=6;n++)if(this.pos2HeroBI[n].vo&&this.pos2HeroBI[n].vo.uuid){var a={uuid:this.pos2HeroBI[n].vo.uuid,battlePos:(n-1)%DEEP_NEST_CONST.HERO_COUNT+1};t.heros.push(a)}for(n=7;n<=12;n++)this.pos2HeroBI[n].vo&&this.pos2HeroBI[n].vo.uuid&&(a={uuid:this.pos2HeroBI[n].vo.uuid,battlePos:(n-1)%DEEP_NEST_CONST.HERO_COUNT+1},i.heros.push(a));for(n=13;n<=18;n++)this.pos2HeroBI[n].vo&&this.pos2HeroBI[n].vo.uuid&&(a={uuid:this.pos2HeroBI[n].vo.uuid,battlePos:(n-1)%DEEP_NEST_CONST.HERO_COUNT+1},o.heros.push(a));return e.push(t),e.push(i),e.push(o),e},t.prototype.getTouchedGroupPos=function(e){for(var t in this.pos2HeroBI){var i=this.pos2HeroBI[t];if(i!=this.targetItem){var o=i.localToGlobal();if(i.width,this.addScale,i.height,this.addScale,this.rect?this.rect.setTo(o.x,o.y,i.width*this.addScale,i.height*this.addScale):this.rect=new egret.Rectangle(o.x,o.y,i.width*this.addScale,i.height*this.addScale),this.rect.contains(e.stageX,e.stageY))return t}}},t.prototype.onTouchBegin=function(e){var t=this.getTouchedGroupPos(e);if(t&&this.pos2HeroBI[t]){if(this.targetItem=this.pos2HeroBI[t],!this.targetItem.vo)return void(this.targetItem=void 0);this.targetItemTouchTM=Date.now(),this.gp_heroList.setChildIndex(this.targetItem,-1),this.startingPos=t,this.gp_touchField.width=this.width,this.gp_touchField.height=this.height,this.beginX=e.stageX,this.beginY=e.stageY}},t.prototype.onTouchMove=function(e){this.targetItem&&this.setModelToXY(this.targetItem,e.stageX,e.stageY)},t.prototype.onTouchEnd=function(e){if(this.targetItem){var t=this.getTouchedGroupPos(e);Date.now()-this.targetItemTouchTM<DEEP_NEST_CONST.TOUCH_TIME?this.heroDownByteam(this.targetItem,this.startingPos):t?this.setHeroToPos(this.targetItem,t):this.heroDownByteam(this.targetItem,this.startingPos),this.targetItem=void 0,this.startingPos=void 0,this.gp_touchField.width=this.gp_heroList.width,this.gp_touchField.height=this.gp_heroList.height}},t.prototype.setHeroToPos=function(e,t,i){if(void 0===i&&(i=!1),e){this.pos2HeroBI[this.startingPos]=void 0,this.startingPos&&this.startingPos!=t&&this.pos2HeroBI[t]&&this.setHeroToPos(this.pos2HeroBI[t],this.startingPos,!0),this.pos2HeroBI[t]=e;var o=this.pos2XY(t);e.x=o[0],e.y=o[1],e.scaleX=18<Number(t)?.9:.7,e.scaleY=18<Number(t)?.9:.7,i||this.updateAllHero()}},t.prototype.setModelToXY=function(e,t,i){e.width,e.scaleX,e.height,e.scaleY,e.x+=(t-this.beginX)/this.addScale,e.y+=(i-this.beginY)/this.addScale,this.beginX=t,this.beginY=i},t.prototype.heroDownByteam=function(e,t){for(var i in this.allHeroInfo)if(e.vo.uuid==this.allHeroInfo[i].info.uuid){for(var o in this.dataprovider.source){var n=this.list_hero.getVirtualElementAt(Number(o)),a=this.dataprovider.getItemAt(Number(o));if(a.info.uuid==e.vo.uuid&&n&&n.img_bg&&n.img_bg.visible){n.img_bg.visible=!1,a.isUp=!1,a.teamNum=0,UIActionManager.setGrey(n.gp_bi,!1);break}}var r=this.pos2XY(t);e.x=r[0],e.y=r[1],e.resetFixedStyle(EEntityType.EEntityTypeHero);break}},t.prototype.changeOrderAbove=function(e){var t=this;if(!this.isChanging){this.isChanging=!0;var i=6*e+1,o=6+i;this.btn_up_1.touchEnabled=!0,this.btn_up_2.touchEnabled=!0;for(var n=i;n<o;n++){var a=n+6;this.startingPos=a+"";var r=n+"";this.setHeroToPos(this.pos2HeroBI[a],r)}this.changePetAndArt(e,e+1),this.updateAllHero(),egret.Tween.get(this.gp_root).wait(250).call(function(){t.isChanging=!1,t.startingPos=void 0,t.btn_up_1.touchEnabled=!1,t.btn_up_2.touchEnabled=!1})}},t.prototype.changePetAndArt=function(e,t){var i=this.petList[e];this.petList[e]=this.petList[t],this.petList[t]=i;var o=this.artList[e];this.artList[e]=this.artList[t],this.artList[t]=o,this.updatePetAndArtInfo()},t.prototype.touchHeroEvent=function(e,t,i){if(e){for(var o=0,n=1;n<=18;n++)if(!this.pos2HeroBI[n].vo){o=n;break}if(0==o)Utils.MsgUtils.addMidMsg("当前阵容已上满");else{var a=0;1<=o&&o<=6?a=1:7<=o&&o<=12?a=2:12<=o&&o<=18&&(a=3);var r=0==t.info.dermaCode?void 0:l.Config.getHeroDermaConfig()[t.info.dermaCode].avatar;this.pos2HeroBI[o].updateData({vo:t.info,type:EEntityType.EEntityTypeHero,avatar:r}),t.teamNum=a,i&&i()}}else{var s=0;for(n=1;n<=18;n++)if(this.pos2HeroBI[n].vo&&this.pos2HeroBI[n].vo.uuid==t.info.uuid){s=n;break}0!=s&&(this.pos2HeroBI[s].resetFixedStyle(EEntityType.EEntityTypeHero),t.teamNum=0,i&&i())}},t.prototype.perClose=function(){this.params.doneCB&&this.params.doneCB()},t);function t(){var e,t=n.call(this)||this;return t.backProxy=l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N),t.dpProxy=l.AppFacade.getInstance().retrieveProxy(l.DeepNestPy.N),t.playerProxy=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),t.heroProxy=l.AppFacade.getInstance().retrieveProxy(l.HeroPy.N),t.petProxy=l.AppFacade.getInstance().retrieveProxy(l.PetPy.N),t.artProxy=l.AppFacade.getInstance().retrieveProxy(l.MagicalArtifactPy.N),t.allHeroInfo=[],t.chooseHeroPage=0,t.maxHeroPage=0,t.heroList1=[],t.heroList2=[],t.heroList3=[],t.isChanging=!1,t.dataprovider=new eui.ArrayCollection,t.petList=[],t.artList=[],t.beginX=0,t.beginY=0,t.addScale=Utils.DeviceUtils.additionScale(),t.ITEM_TYPE_CONFIG=((e={})[l.BackpackUI.ITEM_TYPE.HERO]={desc:"英雄",hasHankBook:!0,barSource:{up:"_btn_yq_m_json.beibao_yeqian_yingxiong_0",down:"_btn_yq_m_json.beibao_yeqian_yingxiong_1"},getAllInfo:function(){var e=[],t=l.AppFacade.getInstance().retrieveProxy(l.HeroPy.N);for(var i in t.allHeroByUuid){var o=t.allHeroByUuid[i];0==o.config.race&&0==o.config.profession||e.push(o)}return e},filterConfig:{data:[[{race:HeroRaceType.Human,icon:HeroRaceConfig[HeroRaceType.Human].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Elf,icon:HeroRaceConfig[HeroRaceType.Elf].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Orc,icon:HeroRaceConfig[HeroRaceType.Orc].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Athanasy,icon:HeroRaceConfig[HeroRaceType.Athanasy].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Demon,icon:HeroRaceConfig[HeroRaceType.Demon].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Eldar,icon:HeroRaceConfig[HeroRaceType.Eldar].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"}]],filterFunc:function(e,t){var i=!e.race||0==e.race.length||-1!=e.race.indexOf(t.config.race),o=!e.star||0==e.star.length||-1!=e.star.indexOf(t.starLevel);return i&&o},addFilter:function(e,t){var i=t.race?"race":"star";e[i]||(e[i]=[]);var o=e[i].indexOf(t[i]);-1==o?(e[i].splice(0),e[i].push(t[i])):e[i].splice(o,1)},autoFilterFunc:function(e,t){return e.starLevel<=4},autoFilterTipsFunc:function(e){return"无五星以下英雄"}},sortConfig:{data:[{desc:"等级"},{desc:"星级"}],getSortFunc:function(e){switch(e){case 0:return function(e,t){return t.info.level-e.info.level};case 1:return function(e,t){return t.info.starLevel-e.info.starLevel};default:return function(){return-1}}},defaultSortFunc:function(e,t){var i=e.info,o=t.info;if(i.starLevel!=o.starLevel)return o.starLevel-i.starLevel;if(i.level!=o.level)return o.level-i.level;var n=l.Config.allHeroConfig()[i.code],a=l.Config.allHeroConfig()[o.code];return n.race!=a.race?n.race-a.race:n.profession!=a.profession?HERO_SORT_ORDER[a.profession]-HERO_SORT_ORDER[n.profession]:i.code-o.code}}},e),t.skinName="CommonTeamChoosePanelSkin",t.pos2HeroBI={},t.curFilter={},t}l.CommonTeamChoosePanel=e,__reflect(e.prototype,"game.CommonTeamChoosePanel");var i,s=(i=eui.ItemRenderer,__extends(o,i),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.scaleX=this.baseItem.scaleY=.85,this.img_bg.scaleX=this.img_bg.scaleY=.6,this.gp_bi.addChild(this.baseItem),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.touchCB&&this.data.touchCB(!this.img_bg.visible,this.data,this.changeIsUp.bind(this))},this)},o.prototype.dataChanged=function(){var e=this.data,t=0==e.info.dermaCode?void 0:l.Config.getHeroDermaConfig()[e.info.dermaCode].avatar;this.baseItem.updateData({uuid:this.data.info.uuid,type:EEntityType.EEntityTypeHero,effect:!1,isShowZhongZhu:!0,avatar:t}),this.img_bg.visible=0!=this.data.teamNum,this.img_bg.visible&&(this.img_bg.source=this.CHOOSE_NUM[this.data.teamNum-1]),UIActionManager.setGrey(this.gp_bi,this.img_bg.visible)},o.prototype.changeIsUp=function(){this.img_bg.visible=!this.img_bg.visible,this.data.isUp=!this.data.isUp,UIActionManager.setGrey(this.gp_bi,this.img_bg.visible),this.img_bg.visible&&(this.img_bg.source=this.CHOOSE_NUM[this.data.teamNum-1])},o);function o(){var e=i.call(this)||this;return e.CHOOSE_NUM=["sycx_txt_yi1_png","sycx_txt_er1_png","sycx_txt_sani1_png"],e.skinName="CommonTeamHeroItemSkin",e}__reflect(s.prototype,"CommonTeamHeroItem")}(game=game||{}),function(i){var t,e=(__extends(o,t=BasePanel),o.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.challge_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.params.doneCB&&e.params.doneCB(e.params.type,e.getUpList()),e.hide()},this)},o.prototype.getUpList=function(){var e=["","",""];for(var t in this.dataprovider.source)for(var i=this.list.getVirtualElementAt(Number(t)),o=this.dataprovider.getItemAt(Number(t)),n=0;n<this.CHOOSE_NUM.length;n++)i.img_choose.visible&&i.img_choose.source==this.CHOOSE_NUM[n]&&(e[n]=o.info.uuid);return e},o.prototype.updateView=function(e){var t,i={};(this.params=e).type==EEntityType.EEntityTypePet?(this.lb_text.text="请选择将要出战的宠物",i=this.petProxy.allPetByUuid,this.bm_longTap.visible=!0):e.type==EEntityType.EEntityTypeMagical&&(this.lb_text.text="请选择将要出战的神器",i=this.artProxy.allMagicalArtifactByUuid,this.bm_longTap.visible=!1),t=this.params.list;var o=[],n=0;for(var a in i){for(var r=i[a],s=0,c=0;c<t.length;c++)if(t[c]==a){s=c+1;break}var l={type:e.type,info:r,cb:this.updateChoose.bind(this),index:n,chooseNum:s};o.push(l),n++}0<o.length?(e.type==EEntityType.EEntityTypePet&&(o.sort(function(e,t){return e.info.level!=t.info.level?t.info.level-e.info.level:e.info.uuid-t.info.uuid}),o.forEach(function(e,t){e.index=t})),this.dataprovider=new eui.ArrayCollection(o),this.list.itemRenderer=h,this.list.dataProvider=this.dataprovider,this.gp_no.visible=!1):this.gp_no.visible=!0},o.prototype.updateChoose=function(e){if(0==this.params.team){var t=[{num:0,isChoose:!1},{num:0,isChoose:!1},{num:0,isChoose:!1}];for(var i in this.dataprovider.source){if((s=this.list.getVirtualElementAt(Number(i)))&&s.img_choose&&s.img_choose.visible)for(var o in this.CHOOSE_NUM)s.img_choose.source==this.CHOOSE_NUM[o]&&(t[o].num=Number(i),t[o].isChoose=!0);s&&s.img_choose&&s.img_bg&&(UIActionManager.setGrey(s.img_bg,!1),s.img_choose.visible=!1,s.img_choose.source="")}var n=0,a=!1;for(var i in t)if(t[i].isChoose){if(e==t[i].num){t[i].num=0,a=!(t[i].isChoose=!1);continue}n++}if(2<n)this.params.type==EEntityType.EEntityTypePet?Utils.MsgUtils.addMidMsg("所有阵容均已上阵宠物"):Utils.MsgUtils.addMidMsg("所有阵容均已上阵神器");else{for(o=0;o<t.length;o++)if(!t[o].isChoose){n=o;break}t[n].isChoose=!a,t[n].num=a?0:e}for(var i in t){var r=this.list.getVirtualElementAt(t[i].num);r&&r.img_choose&&r.img_bg&&t[i].isChoose&&(UIActionManager.setGrey(r.img_bg,!0),r.img_choose.visible=!0,r.img_choose.source=this.CHOOSE_NUM[i])}}else{n=this.params.team-1;var s,c=!1;for(var i in this.dataprovider.source){var l=this.list.getVirtualElementAt(Number(i));if(l&&l.img_choose&&l.img_choose.visible&&l.img_choose.source==this.CHOOSE_NUM[n]){Number(i)==e&&(c=!0),UIActionManager.setGrey(l.img_bg,!1),l.img_choose.visible=!1,l.img_choose.source="";break}}(s=this.list.getVirtualElementAt(Number(e))).img_choose.visible?s.img_choose.source==this.CHOOSE_NUM[n]?(UIActionManager.setGrey(s.img_bg,!1),s.img_choose.visible=!1,s.img_choose.source=""):(UIActionManager.setGrey(s.img_bg,!0),s.img_choose.visible=!0,s.img_choose.source=this.CHOOSE_NUM[n]):c?(UIActionManager.setGrey(s.img_bg,!1),s.img_choose.visible=!1,s.img_choose.source=""):(UIActionManager.setGrey(s.img_bg,!0),s.img_choose.visible=!0,s.img_choose.source=this.CHOOSE_NUM[n])}},o);function o(){var e=t.call(this)||this;return e.proxy=i.AppFacade.getInstance().retrieveProxy(i.DeepNestPy.N),e.artProxy=i.AppFacade.getInstance().retrieveProxy(i.MagicalArtifactPy.N),e.petProxy=i.AppFacade.getInstance().retrieveProxy(i.PetPy.N),e.dataprovider=new eui.ArrayCollection,e.chooseNum=0,e.CHOOSE_NUM=["sycx_txt_yi1_png","sycx_txt_er1_png","sycx_txt_sani1_png"],e.skinName="CommonTeamPetAndArtPanelSkin",e}i.CommonTeamPetAndArtPanel=e,__reflect(e.prototype,"game.CommonTeamPetAndArtPanel");var n,h=(n=eui.ItemRenderer,__extends(a,n),a.prototype.childrenCreated=function(){var t=this;n.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.data.cb&&t.data.cb(t.data.index)},this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){t.touchBeginTime=(new Date).getTime()},this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_END,function(e){t.data.type==EEntityType.EEntityTypePet&&t.touchBeginTime&&1e3<=(new Date).getTime()-t.touchBeginTime&&i.GameMVC.petMed.showSubView(i.PetMediator.SV.SELF_PET_DETAIL,{uuid:t.data.info.uuid}),t.touchBeginTime=0},this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(e){t.data.type==EEntityType.EEntityTypePet&&t.touchBeginTime&&1e3<=(new Date).getTime()-t.touchBeginTime&&i.GameMVC.petMed.showSubView(i.PetMediator.SV.SELF_PET_DETAIL,{uuid:t.data.info.uuid}),t.touchBeginTime=0},this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(e){t.data.type==EEntityType.EEntityTypePet&&t.touchBeginTime&&1e3<=(new Date).getTime()-t.touchBeginTime&&i.GameMVC.petMed.showSubView(i.PetMediator.SV.SELF_PET_DETAIL,{uuid:t.data.info.uuid}),t.touchBeginTime=0},this)},a.prototype.dataChanged=function(){var e=this.data;this.img_bg.source=e.type==EEntityType.EEntityTypePet?e.info.config.avatar+"_png":e.info.config.model+"_png",this.img_choose.visible=0!=e.chooseNum,this.img_choose.visible?(this.img_choose.source=this.CHOOSE_NUM[e.chooseNum-1],UIActionManager.setGrey(this.img_bg,!0)):(this.img_choose.source="",UIActionManager.setGrey(this.img_bg,!1)),e.type==EEntityType.EEntityTypePet?this.bm_level.text=e.info.level:this.bm_level.text=""},a);function a(){var e=n.call(this)||this;return e.CHOOSE_NUM=["sycx_txt_yi1_png","sycx_txt_er1_png","sycx_txt_sani1_png"],e.touchBeginTime=0,e.skinName="CommonTeamItemSkin",e}i.CommonTeamItem=h,__reflect(h.prototype,"game.CommonTeamItem")}(game=game||{}),function(i){var o,e=(__extends(t,o=BasePanel),t.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.item=new i.BackpackUI_Item,this.item.touchEnabled=!1,this.gp_item.addChild(this.item),this.targetNum=1,this.btn_compound.label=this.data.btnText||"使用",this.lb_num.visible=!1,this.edt_input.visible=!0,this.activateComponent(),this.updateView()},t.prototype.updateView=function(){var e=i.Config.itemConfig()[this.code];this.lb_name.text=e.name,this.requestNum=e.effectEx||this.data.requestNum,this.num=this.proxy.getItemNumByCode(this.code);var t={type:i.BackpackUI.ITEM_TYPE.ITEM,info:{code:this.code,num:this.num}};this.item.dataChanged(t),this.item.baseItem.touchEnabled=!1,this.setTargetNum(Math.floor(this.num/this.requestNum))},t.prototype.setTargetNum=function(e){e=e||1,this.targetNum=e,this.edt_input.text=e.toString()},t.prototype.activateComponent=function(){var t=this;this.btn_min.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setTargetNum(1)},this),this.btn_max.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=Math.floor(this.num/this.requestNum);this.setTargetNum(e)},this),this.btn_des.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setTargetNum(this.targetNum-1)},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){(this.targetNum+1)*this.requestNum<=this.num&&this.setTargetNum(this.targetNum+1)},this),this.btn_compound.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.num>=this.requestNum*this.targetNum?(this.data.callBack&&this.data.callBack({num:this.targetNum}),this.hide()):Utils.MsgUtils.addMidMsg("资源不足")},this),this.edt_input.addEventListener(egret.Event.CHANGE,function(){var e=Math.floor(t.num/t.requestNum);t.targetNum=Number(t.edt_input.text),t.targetNum>e&&(t.targetNum=e,t.edt_input.text=e.toString(),Utils.MsgUtils.addMidMsg("超过最大数量！"))},this),this.edt_input.addEventListener(egret.Event.FOCUS_OUT,function(){if(!t.edt_input.text.match(/[1-9][0-9]*/gi)){Utils.MsgUtils.addMidMsg("请输入有效数值！");var e=Math.floor(t.num/t.requestNum);t.targetNum=e,t.edt_input.text=e.toString()}},this)},t);function t(e){var t=o.call(this)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N),t.data=e,t.code=e.code,t.skinName="CompoundPanelSkin",t}i.SimpleUsePanel=e,__reflect(e.prototype,"game.SimpleUsePanel")}(game=game||{}),function(s){var o,e=(__extends(t,o=BasePanel),t.prototype.childrenCreated=function(){var i=this;if(o.prototype.childrenCreated.call(this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.publicPlayer&&(i.isFriend?(i.friendProxy.delFriend({friendId:i.publicPlayer.baseInfo.playerId}),i.hide()):i.friendProxy.addFriend({friendId:i.publicPlayer.baseInfo.playerId},void 0,void 0))},this),Utils.UnlockMgr.checkPass(MODULE.ChatPrivate,!1).allow?this.btn_chat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(i.publicPlayer){var e=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N);if(!e.isInSameServer(i.publicPlayer.baseInfo.serverId)&&(i.viewSource=="rankingType"+RankingType.RankingTypeWorldWorldKing||i.viewSource=="rankingType"+RankingType.RankingTypeChessGrade))return void Utils.MsgUtils.addMidMsg("无法跨服聊天");var t=e.playerInfoVO.playerId;i.publicPlayer.baseInfo.playerId===t?Utils.MsgUtils.addMidMsg("不能与自己聊天"):i.friendProxy.isInBlacklist(i.publicPlayer.baseInfo.playerId)?Utils.MsgUtils.addMidMsg("对方在黑名单中"):(s.AppFacade.getInstance().retrieveProxy(s.MainPy.N).addPrivatePlayer(i.publicPlayer.baseInfo.playerId),s.AppFacade.getInstance().showSubView(s.ChatMediator.N,s.ChatMediator.SV.CHAT,{NextChannelType:EChatChannelType.EChatChannelTypePrivate,playerId:i.publicPlayer.baseInfo.playerId}),i.hide())}},this):this.btn_chat.parent&&this.btn_chat.parent.removeChild(this.btn_chat),this.btn_addBlackList.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.friendProxy.isInBlacklist(i.publicPlayer.baseInfo.playerId)?Utils.MsgUtils.addMidMsg("该玩家已被加入黑名单"):s.GameMgr.getInstance().showCommonTipsWin({commonTips:"是否要将"+i.publicPlayer.baseInfo.name+"拉入黑名单？\n  拉黑后，将无法接收对方信息。",clickCB:function(e){e.type&&i.friendProxy.JoinBlackList(i.publicPlayer.baseInfo.playerId)}})},this),!this.Gruop_pkm.$children.length)for(var e=1;e<=6;e++){var t;(t=new n).scaleX=t.scaleY=.8,t.touchEnabled=t.touchChildren=!1,this.Gruop_pkm.addChild(t)}(t=new n).scaleX=t.scaleY=.8,t.horizontalCenter=t.verticalCenter=0,t.touchEnabled=t.touchChildren=!1,this.gp_pet.addChild(t)},t.prototype.updateButton=function(e){var t=this.friendProxy.friendList,i=!1;for(var o in t)if(t[o].friendId==e){i=!0;break}this.isFriend=i,this.btn_add.icon=i?"_btn_lb_m_json.common_icon_shanchuhaoyou":"_btn_lb_m_json.common_icon_tianjiahaoyou",this.publicPlayer&&(this.friendProxy.isInBlacklist(this.publicPlayer.baseInfo.playerId)?this.btn_addBlackList.visible=!1:this.btn_addBlackList.visible=!0)},t.prototype.updatePlayerInfo=function(){this.log(this.publicPlayer);var e=this.publicPlayer.baseInfo;if(this.publicPlayer.baseInfo.serverId,this.lb_name.text=e.name,this.item_fightCap.update(e.fightCap),this.lb_id.text="ID："+e.playerId,""==e.guild||null==e.guild||null==e.guild)this.lb_guild.textFlow=[{text:"公会：",style:{textColor:15913814}},{text:"暂未加入公会",style:{textColor:16777215}}];else{var t=e.guild.name;""!=t&&null!=t&&null!=t||(t="暂未加入公会"),this.lb_guild.textFlow=[{text:"公会：",style:{textColor:15913814}},{text:t,style:{textColor:16777215}}]}for(var i=1;i<=6;i++){var o=this.Gruop_pkm.getChildAt(i-1),n=s.Config.unlockConfig(i),a=!0;if(n){var r=JSON.parse(n.condition);switch(r[0]){case UnlockType.Level:e.level<r[1]&&(a=!1)}o.updateItem({vo:this.publicPlayer.heroList[i-1],unlock:a,unlockLevel:r[1]}),o.scaleX=.65,o.scaleY=.65}}o=this.gp_pet.$children[0],(a=Utils.UnlockMgr.checkPass(MODULE.Pet,!1)).allow=this.publicPlayer.baseInfo.level>=a.ext.requestLevel,o.updateItem({uuid:this.publicPlayer.petList[0]&&this.publicPlayer.petList[0].uuid,unlock:a,vo:this.publicPlayer.petList[0],isPet:!0}),o.scaleX=.65,o.scaleY=.65,this.cu_ph.updateData({vo:e})},t.prototype.displayExtraInfo=function(e){void 0===e&&(e=void 0),null!=e&&(this.checkStatus(e.playerName)&&(this.lb_name.text=e.playerName),this.checkStatus(e.playerId)&&(this.lb_id.text=e.playerId),this.checkStatus(e.fightCap)&&this.item_fightCap.update(e.fightCap),this.checkStatus(e.guildName)&&(this.lb_guild.text=e.guildName),this.checkStatus(e.name)&&(this.lb_name.text=e.name))},t.prototype.checkStatus=function(e){return null!=e},t.prototype.updateView=function(e){var t=this;this.displayExtraInfo(e.extra),this.updateButton(e.playerId);var i=e.playerId;this.viewSource=e.source,e.hideId&&(this.lb_id.visible=!1);var o=e.moduleId,n=e.entityIndex;i&&o&&n?Utils.Socket.send("playerInfo","GetMultiTeamPublicPlayer",{tPlayerId:i,moduleId:o,entityIndex:n}).then(function(e){t.publicPlayer=e.publicPlayer,t.updatePlayerInfo(),t.updateButton(t.publicPlayer.baseInfo.playerId)}).catch(function(e){}):i?Utils.Socket.send("playerInfo","GetPublicPlayer",{playerId:i}).then(function(e){t.publicPlayer=e.publicPlayer,t.updatePlayerInfo(),t.updateButton(t.publicPlayer.baseInfo.playerId)}).catch(function(e){}):this.publicPlayer},t.prototype.perClose=function(){this.publicPlayer=void 0},t);function t(){var e=o.call(this)||this;return e.isFriend=!1,e.skinName="FriendInfoSkin",e.friendProxy=s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N),e.pkmBoxs=new Array,e.publicPlayer=void 0,e}s.FriendInfo=e,__reflect(e.prototype,"game.FriendInfo");var i,n=(i=eui.Component,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem),this.gp_baseitem.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.AppFacade.getInstance().updateView(s.HeroMediator.N,s.HeroMediator.SV.MAIN,{upstarData:{},uuid:this.data.uuid})},this),this.gp_empty.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.unlock.allow?s.AppFacade.getInstance().showSubView(s.HeroMediator.N,s.HeroMediator.SV.SELECT):Utils.MsgUtils.addMidMsg(this.data.unlock.ext.tips)},this)},a.prototype.updateItem=function(e){if(this.data=e,this.data.vo){this.gp_baseitem.visible=!0;var t=e.isPet?EEntityType.EEntityTypePet:EEntityType.EEntityTypeHero;if(this.gp_empty.visible=!1,t==EEntityType.EEntityTypeHero)if(e.vo.dermaCode){var i=s.Config.getHeroDermaConfig()[e.vo.dermaCode].avatar;this.baseItem.updateData({vo:e.vo,type:EEntityType.EEntityTypeHero,avatar:i,isShowEffect:!0})}else this.baseItem.updateData({vo:e.vo,type:EEntityType.EEntityTypeHero});else t==EEntityType.EEntityTypePet&&this.baseItem.updateData({vo:this.data.vo,type:t})}else this.gp_baseitem.visible=!1,this.gp_empty.visible=!0,this.data.unlock?(this.img_add.visible=!0,this.img_lock.visible=!1,this.lb_unlock.visible=!1):(this.img_add.visible=!1,this.img_lock.visible=!0,this.lb_unlock.visible=!0,this.lb_unlock.text="LV "+e.unlockLevel)},a);function a(){var e=i.call(this)||this;return e.skinName="HeroMainView_HeroListItem",e.heroThingProxy=s.AppFacade.getInstance().retrieveProxy(s.HeroThingPy.N),e}__reflect(n.prototype,"HeroMainView_HeroListItem")}(game=game||{}),function(e){var t=(i.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.GuildHead",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},i);function i(){}e.GuildHeadFactory=t,__reflect(t.prototype,"customui.GuildHeadFactory");var o,n=(o=eui.Component,__extends(a,o),a.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.tapEvent?e.tapEvent():game.AppFacade.getInstance().showSubView(game.GuildMediator.N,game.GuildMediator.SV.INFO,e.vo)},this)},a.prototype.updateData=function(e){this.vo=e&&e.vo,this.vo?(this.img_icon.source=this.vo.avatar,this.lb_level.text=this.vo.level.toString()):(this.img_icon.source=e.icon,this.gp_level.visible=!0),this.tapEvent=e&&e.tapEvent},a.prototype.reset=function(){this.tapEvent=void 0,this.scaleX=this.scaleY=1,this.gp_level.visible=!0,this.img_icon.source="",this.horizontalCenter=this.verticalCenter=void 0},a.prototype.onOPReset=function(){this.reset()},a.prototype.onOPComeBack=function(e,t){e&&this.updateData(e)},a.prototype.onOPClean=function(){},a.prototype.onOPCheck=function(e){egret.log("alive")},a);function a(){var e=o.call(this)||this;return e.skinName="GuildHeadSkin",e}e.GuildHead=n,__reflect(n.prototype,"customui.GuildHead",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(customui=customui||{}),function(s){var e=(t.registerAll=function(){(new o).register(),(new r).register(),(new h).register(),(new u).register(),(new E).register(),(new _).register(),(new v).register()},t);function t(){}s.FriendProcessor=e,__reflect(e.prototype,"game.FriendProcessor");var i,o=(i=s.ProcessorBase,__extends(n,i),n.prototype.execute=function(e){if(this.checkCB(e.getBody())){this.log("NewRequestP 好友请求推送");var t=e.getBody();Utils.MsgUtils.addMidMsg(t.requestInfo.baseInfo.name+"已申请添加好友"),s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N).updateFriendList([t.requestInfo],s.FriendUI.TAB_VIEW.APPLY)}},n);function n(){return i.call(this,"friend.NewRequestP",n)||this}s.NewRequestP=o,__reflect(o.prototype,"game.NewRequestP");var a,r=(a=s.ProcessorBase,__extends(c,a),c.prototype.execute=function(e){if(this.checkCB(e.getBody())){this.log("AgreeRequestP 申请通过");var t=e.getBody(),i=s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N);i.updateFriendList([t.friendInfo],s.FriendUI.TAB_VIEW.FRIEND),i.getRequestList()}},c);function c(){return a.call(this,"friend.AgreeRequestP",c)||this}s.AgreeRequestP=r,__reflect(r.prototype,"game.AgreeRequestP");var l,h=(l=s.ProcessorBase,__extends(p,l),p.prototype.execute=function(e){if(this.checkCB(e.getBody())){this.log("DelFriendP 被好友删除");var t=e.getBody();s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N).deleteFriendListByIds([t.friendId],s.FriendUI.TAB_VIEW.FRIEND)}},p);function p(){return l.call(this,"friend.DelFriendP",p)||this}s.DelFriendP=h,__reflect(h.prototype,"game.DelFriendP");var d,u=(d=s.ProcessorBase,__extends(g,d),g.prototype.execute=function(e){this.checkCB(e.getBody())&&(this.log("OperateFriendGoodP"),s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N).DealGiftPush(e.getBody()),NoticeManager.updateNotice(NT.PET_FRIEND_GIFT))},g);function g(){return d.call(this,"friend.OperateFriendGoodP",g)||this}s.OperateFriendGoodP=u,__reflect(u.prototype,"game.OperateFriendGoodP");var f,_=(f=s.ProcessorBase,__extends(m,f),m.prototype.execute=function(e){if(this.checkCB(e.getBody())){this.log("FriendFeedInfoP");var t=s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N),i=e.getBody(),o=s.GameMVC.playerPy.playerInfoVO.playerId;if(i.feedInfo.playerId==o){if(t.myFeedInfo.update(i.feedInfo),0==t.myFeedInfo.lootPlayerId)for(var n in t.feedList){var a=t.feedList[n];for(var r in a.lootList)if(a.lootList[r].playerId==o)return a.lootList.splice(parseInt(r),1),s.GameMVC.petMed.updateView(s.PetMediator.SV.FEED,{info:a,noForceUpdate:!0}),void NoticeManager.updateNotice(NT.PET_FRIEND_CAN_LEAVE)}s.GameMVC.petMed.updateView(s.PetMediator.SV.FEED,{self:!0,noForceUpdate:!0}),NoticeManager.updateNotice(NT.PET_BE_LOOTED)}else{for(var n in t.feedList)if((a=t.feedList[n]).playerId==i.feedInfo.playerId){t.feedList[n].update(i.feedInfo),i.feedInfo=t.feedList[n];break}s.GameMVC.petMed.updateView(s.PetMediator.SV.FEED,{info:i.feedInfo,noForceUpdate:!0}),NoticeManager.updateNotice(NT.PET_FRIEND_ENTRANCE)}}},m);function m(){return f.call(this,"friend.FriendFeedInfoP",m)||this}s.FriendFeedInfoP=_,__reflect(_.prototype,"game.FriendFeedInfoP");var y,v=(y=s.ProcessorBase,__extends(T,y),T.prototype.execute=function(e){var t=e.getBody();this.checkCB(t)&&(this.log("FriendLootRecordInfoP"),s.GameMVC.friendPy.recordList.push(t.recordInfo),s.GameMVC.petMed.updateView(s.PetMediator.SV.FEED,{self:!0,noForceUpdate:!0}))},T);function T(){return y.call(this,"friend.FriendLootRecordInfoP",T)||this}s.FriendLootRecordInfoP=v,__reflect(v.prototype,"game.FriendLootRecordInfoP");var C,E=(C=s.ProcessorBase,__extends(I,C),I.prototype.execute=function(e){if(this.checkCB(e.getBody())){var t=e.getBody(),i=s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N);i.cleanFriendList(s.FriendUI.TAB_VIEW.FRIEND),i.updateFriendList(t.friendList,s.FriendUI.TAB_VIEW.FRIEND),i.cleanFriendList(s.FriendUI.TAB_VIEW.APPLY),i.updateFriendList(t.requestList,s.FriendUI.TAB_VIEW.APPLY)}},I);function I(){return C.call(this,"friend.FriendInfoP",I)||this}s.FriendInfoP=E,__reflect(E.prototype,"game.FriendInfoP")}(game=game||{}),function(c){var t,n=(__extends(i,t=BaseProxy),i.prototype.initNotice=function(){NoticeManager.registerCB([NT.FRIEND_GIFT],this.checkGiftNotice,this),NoticeManager.registerCB([NT.FRIEND_APPLY],this.checkApplyNotice,this)},i.prototype.getListByType=function(e){switch(void 0===e&&(e=c.FriendUI.TAB_VIEW.FRIEND),e){case c.FriendUI.TAB_VIEW.FRIEND:return this.friendList;case c.FriendUI.TAB_VIEW.APPLY:return this.requestList;case c.FriendUI.TAB_VIEW.RECOMMEND:return this.recommendList;case c.FriendUI.TAB_VIEW.SEARCH:return this.searchList;case c.FriendUI.TAB_VIEW.BLACKLIST:return this.blackList;default:return[]}},i.prototype.cleanFriendList=function(e){var t=this.getListByType(e);for(var i in t)delete t[i]},i.prototype.getFriendListNum=function(e){void 0===e&&(e=c.FriendUI.TAB_VIEW.FRIEND);var t=0,i=this.getListByType(e);for(var o in i)t++;return t},i.prototype.updateFriendList=function(e,t,i){void 0===t&&(t=c.FriendUI.TAB_VIEW.FRIEND),void 0===i&&(i=!0);var o=this.getListByType(t);for(var n in e){var a=e[n];if(o[a.baseInfo.playerId])o[a.baseInfo.playerId].update(a);else{var r=new s(a);o[a.baseInfo.playerId]=r}}i&&c.AppFacade.getInstance().updateView(c.FriendMediator.N,c.FriendMediator.SV.MAIN,{updateIndex:t}),NoticeManager.updateNotice(NT.FRIEND_APPLY)},i.prototype.deleteFriendListByIds=function(e,t){void 0===t&&(t=c.FriendUI.TAB_VIEW.FRIEND);var i=this.getListByType(t),o=!1;e.forEach(function(e,t){i[e]&&(delete i[e],o=!0)}),o&&c.AppFacade.getInstance().updateView(c.FriendMediator.N,c.FriendMediator.SV.MAIN,{updateIndex:t})},i.prototype.getInitListInfo=function(e,t){return void 0===e&&(e=!1),__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.cleanFriendList(c.FriendUI.TAB_VIEW.FRIEND),this.cleanFriendList(c.FriendUI.TAB_VIEW.APPLY),this.cleanFriendList(c.FriendUI.TAB_VIEW.RECOMMEND),[4,Promise.all([this.getRequestList(),this.getFriendList(),this.getRecommendList()])];case 1:return e.sent(),t&&t(),[2]}})})},i.prototype.getFriendList=function(i,e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){return Promise.all([Utils.Socket.send("friend","GetFriendList",{}).then(function(e){t.updateFriendList(e.friendList,c.FriendUI.TAB_VIEW.FRIEND,!1),console.log("getfriend")}).catch(function(e){t.log(e)}),Utils.Socket.send("friend","GetFriendGoodInfo",{}).then(function(e){e.err||(console.log("gift"),t.decorateGift(e))}).catch(function(e){t.log(e)})]).then(function(){i&&(console.log("callback"),i())}),[2]})})},i.prototype.selectFriend=function(i,o,n){var a=this;void 0===i&&(i={condition:""}),Utils.Socket.send("friend","SelectFriend",i).then(function(e){var t=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N);""==i.condition?(Utils.MsgUtils.addMidMsg("刷新成功"),a.cleanFriendList(c.FriendUI.TAB_VIEW.RECOMMEND),a.updateFriendList(e.friendList,c.FriendUI.TAB_VIEW.RECOMMEND,!0)):(Number(i.condition)==t.roleVo.playerId?Utils.MsgUtils.addMidMsg("不可加自己为好友"):0<e.friendList.length||Utils.MsgUtils.addMidMsg("该名玩家不存在"),a.cleanFriendList(c.FriendUI.TAB_VIEW.SEARCH),a.updateFriendList(e.friendList,c.FriendUI.TAB_VIEW.SEARCH)),o&&o(e,n)}).catch(function(e){})},i.prototype.addFriend=function(i,o,n,a){var r=this;void 0===i&&(i={friendId:null}),void 0===a&&(a=c.FriendUI.TAB_VIEW.RECOMMEND),Utils.Socket.send("friend","AddFriend",i).then(function(e){if(Utils.MsgUtils.addMidMsg("申请成功"),a==c.FriendUI.TAB_VIEW.RECOMMEND)r.deleteFriendListByIds([i.friendId],c.FriendUI.TAB_VIEW.RECOMMEND);else if(a==c.FriendUI.TAB_VIEW.SEARCH){var t=r.getListByType(c.FriendUI.TAB_VIEW.SEARCH);t[i.friendId]&&(t[i.friendId].relation=EFriendType.EFriendTypeApply),c.AppFacade.getInstance().updateView(c.FriendMediator.N,c.FriendMediator.SV.MAIN,{updateIndex:c.FriendUI.TAB_VIEW.SEARCH})}o&&o(e,n)}).catch(function(e){})},i.prototype.getRequestList=function(e,t,i){var o=this;void 0===e&&(e={}),Utils.Socket.send("friend","GetRequestList",e).then(function(e){o.updateFriendList(e.requestList,c.FriendUI.TAB_VIEW.APPLY,!1),t&&t(e,i)}).catch(function(e){})},i.prototype.agreeRequest=function(t){var i=this;void 0===t&&(t={friendId:0}),Utils.Socket.send("friend","AgreeRequest",t).then(function(e){Utils.MsgUtils.addMidMsg("同意成功"),t.friendId?(i.updateFriendList([e.friend],c.FriendUI.TAB_VIEW.FRIEND),i.deleteFriendListByIds([t.friendId],c.FriendUI.TAB_VIEW.APPLY)):i.getFriendList(),c.AppFacade.getInstance().updateView(c.FriendMediator.N,c.FriendMediator.SV.MAIN,{updateIndex:c.FriendUI.TAB_VIEW.APPLY}),i.getGiftMsg()}).catch(function(e){})},i.prototype.rejectRequest=function(t){var i=this;void 0===t&&(t={friendId:0}),Utils.Socket.send("friend","RejectRequest",t).then(function(e){Utils.MsgUtils.addMidMsg("拒绝成功"),t.friendId?i.deleteFriendListByIds([t.friendId],c.FriendUI.TAB_VIEW.APPLY):i.cleanFriendList(c.FriendUI.TAB_VIEW.APPLY),c.AppFacade.getInstance().updateView(c.FriendMediator.N,c.FriendMediator.SV.MAIN,{updateIndex:c.FriendUI.TAB_VIEW.APPLY})}).catch(function(e){})},i.prototype.delFriend=function(i,o,n){var a=this;void 0===i&&(i={friendId:null}),Utils.Socket.send("friend","DelFriend",i).then(function(e){if(Utils.MsgUtils.addMidMsg("删除成功"),a.deleteFriendListByIds([i.friendId]),a.searchList[i.friendId]){var t=a.searchList[i.friendId];t.relation=EFriendType.EFriendTypeStranger,a.updateFriendList([t],c.FriendUI.TAB_VIEW.SEARCH)}o&&o(e,n)}).catch(function(e){})},i.prototype.getRecommendList=function(e,t,i){var o=this;void 0===e&&(e={condition:""}),Utils.Socket.send("friend","SelectFriend",e).then(function(e){o.updateFriendList(e.friendList,c.FriendUI.TAB_VIEW.RECOMMEND),t&&t(e,i)}).catch(function(e){})},i.prototype.getFriendById=function(e){for(var t in this.friendList){var i=this.friendList[t];if(i.friendId==e)return{playerId:e,name:i.friendName,level:i.friendfriendLevel,avatar:i.friendAvatar,vipLevel:i.vipLevel}}},i.prototype.GetFriendLootInfo=function(o,n){var a=this;Utils.Socket.send("friend","GetFriendLootInfo",{}).then(function(e){for(var t in a.myFeedInfo.update(e.feedInfo),a.feedList=[],e.feedList){var i=e.feedList[t];a.feedList.push(new h(i))}o&&o(e,n),NoticeManager.updateNotice(NT.PET_FEED_ENTRANCE)})},i.prototype.LootFriend=function(e,a){var r=this;Utils.Socket.send("friend","LootFriend",{playerId:e}).then(function(e){for(var t in r.myFeedInfo.update(e.feedInfo),e.feedList){var i=e.feedList[t];for(var o in r.feedList){var n=r.feedList[o];n.playerId==i.playerId&&n.update(i)}}a&&a(e)})},i.prototype.LeaveFriend=function(a){function t(){Utils.Socket.send("friend","LeaveFriend",{}).then(function(e){for(var t in r.myFeedInfo.update(e.feedInfo),c.GameMVC.backpackPy.handleClientReward(e.clientReward,2),e.feedList){var i=e.feedList[t];for(var o in r.feedList){var n=r.feedList[o];n.playerId==i.playerId&&n.update(i)}}a&&a(e),NoticeManager.updateNotice(NT.PET_FRIEND_CAN_LEAVE)})}var r=this,e=c.Config.getConstValue("MinFriendLootLeaveCycle"),i=0;for(var o in this.feedList)this.feedList[o].lootList.forEach(function(e){e.playerId==c.GameMVC.playerPy.playerInfoVO.playerId&&(i=e.lootDt)});if(i)if(Utils.TimerManager.getServerTime()-i<e){var n=Utils.TimerManager.getFormatBySecond2(e);c.GameMgr.getInstance().showCommonTipsWin({commonTips:"抢夺时间不足"+n+"，将无法获得奖励，确定离开？",clickCB:function(e){e.type&&t()}})}else t();else Utils.MsgUtils.addMidMsg("没有在抢夺别人")},i.prototype.GetFriendLootRecord=function(t,i){var o=this;Utils.Socket.send("friend","GetFriendLootRecord",{}).then(function(e){o.recordList=e.recordList,t&&t(e,i)})},i.prototype.DriveFriend=function(e,t,i){var o=this;Utils.Socket.send("friend","DriveFriend",e).then(function(e){o.myFeedInfo.update(e.feedInfo),t&&t(e,i),NoticeManager.updateNotice(NT.PET_BE_LOOTED)})},i.prototype.GetSingleFriendLootInfo=function(o,n,a){var r=this;Utils.Socket.send("friend","GetSingleFriendLootInfo",o).then(function(e){for(var t in r.feedList){var i=r.feedList[t];i.playerId==o.playerId&&i.update(e.feedInfo)}n&&n(e,a)})},i.prototype.OperateFriendGift=function(e,i){var o=this;Utils.Socket.send("friend","OperateFriendGood",e).then(function(e){if(!e.err){var t=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N);t.handleClientCost(e.clientCost),t.handleClientReward(e.clientReward,2),o.log(e),o.decorateGift(e),c.AppFacade.getInstance().sendNotification(CN.FRIEND_GIFT_UPDATE)}i&&i(),NoticeManager.updateNotice(NT.PET_FRIEND_GIFT)}).catch(function(e){o.log(e)})},i.prototype.getGiftCount=function(){return this._giftCount},i.prototype.getPetGiftCount=function(t){var e=0;for(var i in this.friendList){var o=this.friendList[i].friendGiftVO,n=0;o&&o.getRecord&&0<o.getRecord.info.filter(function(e){return 0<e.num&&e.code==t}).length&&(n=1),o&&o.bagRecord&&0<o.bagRecord.info.filter(function(e){return 0==e.num&&e.code==t}).length&&(n=1),e+=n}return e},i.prototype.decorateGift=function(e){if(this.friendList||this.getFriendList(),e.friendGoodInfo){for(var t in this.friendList){var i=this.friendList[t],o=void 0,n=void 0,a=void 0;for(var r in e.friendGoodInfo.giveRecord){var s=e.friendGoodInfo.giveRecord[r];if(s.friendId==i.friendId){o=s;break}}for(var c in e.friendGoodInfo.getRecord){var l=e.friendGoodInfo.getRecord[c];if(l.friendId==i.friendId){n=l;break}}for(var h in e.friendGoodInfo.bagRecord){var p=e.friendGoodInfo.bagRecord[h];if(p.friendId==i.friendId){a=p;break}}i.friendGiftVO=new d({giveRecord:o,getRecord:n,bagRecord:a})}for(var t in this._giftCount=0,this.hasGiftToGet=!1,this.hasGiftToGive=!1,e.friendGoodInfo.bagRecord)0<e.friendGoodInfo.bagRecord[t].info.filter(function(e){return 0==e.num&&30000015==e.code}).length?this._giftCount++:this.friendList[e.friendGoodInfo.bagRecord[t].friendId]&&(this.hasGiftToGet=!0);for(var t in this.friendList){if(!(i=this.friendList[t]).friendGiftVO.giveRecord){this.hasGiftToGive=!0;break}if(0<i.friendGiftVO.giveRecord.info.filter(function(e){return 0<e.num&&30000015==e.code}).length){this.hasGiftToGive=!0;break}}NoticeManager.updateNotice(NT.FRIEND_GIFT,{},!0)}},i.prototype.getGiftMsg=function(){var t=this;Utils.Socket.send("friend","GetFriendGoodInfo",{}).then(function(e){e.err||(t.decorateGift(e),c.AppFacade.getInstance().sendNotification(CN.FRIEND_GIFT_UPDATE))}).catch(function(e){t.log(e)})},i.prototype.DealGiftPush=function(e){if(this.friendList||this.getFriendList(),this.friendList[e.newRecord.friendId]){var t=this.friendList[e.newRecord.friendId];if(t.friendGiftVO){var i=t.friendGiftVO.bagRecord;i?s=(s=i.info)?s.concat(e.newRecord.info):e.newRecord.info:t.friendGiftVO.bagRecord=e.newRecord}else t.friendGiftVO=new d({giveRecord:void 0,getRecord:void 0,bagRecord:e.newRecord});this.hasGiftToGet=!1,this.hasGiftToGive=!1;var o=c.Config.getConstValue("FriendGiveRewards");for(var n in this.friendList){var a=this.friendList[n];if(!a.friendGiftVO.giveRecord){this.hasGiftToGive=!0;break}if(a.friendGiftVO.bagRecord)for(var r in a.friendGiftVO.bagRecord.info){var s;(s=a.friendGiftVO.bagRecord.info[r]).code==o[0][1]&&0<s.num&&(this.hasGiftToGet=!0)}}}c.AppFacade.getInstance().sendNotification(CN.FRIEND_GIFT_UPDATE)},i.prototype.checkApplyNotice=function(){var e=!1;for(var t in this.requestList){e=!0;break}return e},i.prototype.checkGiftNotice=function(){var e=!1,t=JSON.parse(c.Config.constConfig().OnceFriendIntimacyNum.constValue),i=JSON.parse(c.Config.constConfig().FriendPokeBallGetLimit.constValue)/t;if(this.getGiftCount()<i)for(var o in this.friendList)if(this.friendList[o].friendGiftVO){var n=this.friendList[o].friendGiftVO.bagRecord;if(n)for(var a in n.info)if(0<n.info[a].num&&30000015==n.info[a].code){e=!0;break}}return e},i.prototype.getInviteHistory=function(e){return this.inviteHistory[e]||(this.inviteHistory[e]=[]),e==MODULE.Wchess?[]:this.inviteHistory[e]},i.prototype.addInviteHistory=function(e,t){this.inviteHistory[e]||(this.inviteHistory[e]=[]),this.inviteHistory[e].push(t)},i.prototype.clearInviteHistory=function(e){this.inviteHistory[e]=[]},i.prototype.isInBlacklist=function(e){return!!this.blackList[e]},i.prototype.getblacklist=function(){var i=this;Utils.Socket.send("friend","GetBlackList",{}).then(function(e){e.blackList&&e.blackList.forEach(function(e){var t=new s(e);i.blackList[t.friendId]=t})})},i.prototype.JoinBlackList=function(t){var i=this;this.isInBlacklist(t)?Utils.MsgUtils.addMidMsg("该玩家已被加入黑名单"):Utils.Socket.send("friend","JoinBlackList",{playerId:t}).then(function(e){i.updateFriendList([e.friend],c.FriendUI.TAB_VIEW.BLACKLIST),i.deleteFriendListByIds([t],c.FriendUI.TAB_VIEW.FRIEND),c.AppFacade.getInstance().updateView(c.FriendMediator.N,c.FriendMediator.SV.MAIN,{updateIndex:c.FriendUI.TAB_VIEW.BLACKLIST}),c.AppFacade.getInstance().updateView(c.FriendMediator.N,c.FriendMediator.SV.INFO,{playerId:t})})},i.prototype.TickOutBlackList=function(t){var i=this;!t||this.isInBlacklist(t)?Utils.Socket.send("friend","TickOutBlackList",{playerId:t}).then(function(e){t?i.deleteFriendListByIds([t],c.FriendUI.TAB_VIEW.BLACKLIST):i.blackList=new Array,c.AppFacade.getInstance().updateView(c.FriendMediator.N,c.FriendMediator.SV.MAIN,{updateIndex:c.FriendUI.TAB_VIEW.BLACKLIST})}):Utils.MsgUtils.addMidMsg("该玩家不在黑名单")},i.N="FriendProxy",i.PetGrainConsumeCycle=1,i.PetFeedCost=[3,30000059,1],i.FriendLootCycle=1,i.FriendLootRewards=[3,30000059,1],i);function i(){var e=t.call(this,i.N)||this;return e.blackList={},e.myFeedInfo=new h({}),e.feedList=[],e.recordList=[],e.inviteHistory={},e._giftCount=0,e.hasGiftToGet=!1,e.hasGiftToGive=!1,e.friendList={},e.requestList={},e.recommendList={},e.searchList={},e.initNotice(),e}c.FriendPy=n,__reflect(n.prototype,"game.FriendPy");var o,s=(o=c.BaseVO,__extends(e,o),e.prototype.update=function(e){this.friendId=e.baseInfo.playerId,this.friendName=e.baseInfo.name,this.friendAvatar=e.baseInfo.avatar,this.friendPower=e.baseInfo.fightCap,this.friendGuild=e.baseInfo.guild,this.lastOnlineTime=e.baseInfo.offlineTime,this.relation=e.relation,this.vipLevel=e.baseInfo.vipLevel,this.camp=e.baseInfo.camp,this.friendLevel=e.baseInfo.level,this.frame=e.baseInfo.frame},e);function e(e){var t=o.call(this)||this;return t.friendId=0,t.friendLevel=0,t.friendPower=0,t.lastOnlineTime=0,t.relation=0,t.vipLevel=0,t.camp=0,t.update(e),t}c.FriendVO=s,__reflect(s.prototype,"game.FriendVO");var a,d=(a=c.BaseVO,__extends(r,a),r.prototype.update=function(e){this.giveRecord=e.giveRecord,this.getRecord=e.getRecord,this.bagRecord=e.bagRecord},r);function r(e){var t=a.call(this)||this;return t.update(e),t}c.FriendGiftVO=d,__reflect(d.prototype,"game.FriendGiftVO");var l,h=(l=c.BaseVO,__extends(p,l),Object.defineProperty(p.prototype,"grainNum",{get:function(){if(this.lastGrainRefreshDt){var e=Utils.TimerManager.getServerTime()-this.lastGrainRefreshDt;e<0&&(e=0);var t=n.PetGrainConsumeCycle,i=n.PetFeedCost[2],o=Math.floor(e/t);return 0<this._grainNum-o*i?this._grainNum-o*i:0}return this._grainNum},enumerable:!0,configurable:!0}),p.prototype.update=function(e){this.playerId=e.playerId||this.playerId,this._grainNum=e.grainNum,this.lastGrainRefreshDt=e.lastGrainRefreshDt,this.code=e.code,this.lootPlayerId=e.lootPlayerId,this.lootList=e.lootList,this.uuid=e.uuid},p);function p(e){var t=l.call(this)||this;return t.update(e),t}c.FriendFeedVo=h,__reflect(h.prototype,"game.FriendFeedVo")}(game=game||{}),function(s){var i,a=(__extends(c,i=BasePanel),c.prototype.onDestroy=function(){i.prototype.onDestroy.call(this)},c.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initUI(),this.initButton(),this.initTabbar(),this.initList(),this.addNotice()},c.prototype.initUI=function(){var t=this;this.commonDaTanKuang.blb_title.text="好友",this.commonDaTanKuang.onCloseCB=function(){t.hide()},this.lb_refresh.text="",this.timer_lb_refresh.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){this.lb_refresh.text="",this.btn_refresh.label="刷新",this.btn_refresh.touchEnabled=!0},this),this.et_roleName.addEventListener(egret.Event.CHANGE,function(e){""==e.target.text&&t.updateView({})},this)},c.prototype.initButton=function(){var t=this;this.img_search.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""===this.et_roleName.text?Utils.MsgUtils.addMidMsg("请先输入关键字"):(this.onBarItemTap({itemIndex:c.TAB_VIEW.SEARCH}),this.friendProxy.selectFriend({condition:this.et_roleName.text},function(e,t){s.AppFacade.getInstance().updateView(s.FriendMediator.N,void 0,{tabbarIndex:c.TAB_VIEW.SEARCH})}))},this),this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.friendProxy.selectFriend(),this.timer_lb_refresh.reset(),this.btn_refresh.touchEnabled=!1,this.btn_refresh.label="";var e=s.Config.constConfig().FriendSelectTime.constValue;this.lb_refresh.text=e.toString(),this.timer_lb_refresh.removeEventListener(egret.TimerEvent.TIMER,function(){},this),this.timer_lb_refresh.addEventListener(egret.TimerEvent.TIMER,function(){e--,this.lb_refresh.text=e.toString()},this),this.timer_lb_refresh.start()},this),this.btn_oneKey.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(this.friendProxy.getFriendListNum()<=0)Utils.MsgUtils.addMidMsg("暂无好友");else if(this.BtnNotice){var e=JSON.parse(s.Config.constConfig().OnceFriendIntimacyNum.constValue),t=JSON.parse(s.Config.constConfig().FriendPokeBallGetLimit.constValue)/e,i=!1;if(this.friendProxy.getGiftCount()<t)for(var o in this.friendProxy.friendList)if(this.friendProxy.friendList[o].friendGiftVO){var n=this.friendProxy.friendList[o].friendGiftVO.bagRecord;if(n)for(var a in n.info)if(0<n.info[a].num){i=!0;break}}i?Utils.MsgUtils.addMidMsg("领取成功"):Utils.MsgUtils.addMidMsg("赠送成功");var r=FriendGoodType.FriendPokeBall;this.friendProxy.OperateFriendGift({friendId:0,operationType:FriendGoodOperationType.QuickGetAndGiveOperation,type:EEntityType.EEntityTypeMoney,code:r,num:e})}},this),this.btn_acceptAll.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.friendProxy.getListByType(c.TAB_VIEW.APPLY);0<Object.keys(e).length?t.friendProxy.agreeRequest({friendId:0}):Utils.MsgUtils.addMidMsg("暂无申请信息")},this),this.btn_deleteAll.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.friendProxy.getListByType(c.TAB_VIEW.APPLY);0<Object.keys(e).length?t.friendProxy.rejectRequest({friendId:0}):Utils.MsgUtils.addMidMsg("暂无申请信息")},this),this.btn_releasrAll.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.friendProxy.TickOutBlackList(0)},this)},c.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar.dataProvider=new eui.ArrayCollection([{source:{up:"_btn_yq_m_json.common_yeqian_haoyou_0",down:"_btn_yq_m_json.common_yeqian_haoyou_1",text:"好友"}},{source:{up:"_btn_yq_m_json.common_yeqian_shenqing_0",down:"_btn_yq_m_json.common_yeqian_shenqing_1",text:"申请"}},{source:{up:"_btn_yq_m_json.common_yeqian_heimingdan_0",down:"_btn_yq_m_json.common_yeqian_heimingdan_1",text:"黑名单"}}]),this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this)},c.prototype.initList=function(){this.list_item.itemRenderer=e,this.collection_list=new eui.ArrayCollection,this.list_item.dataProvider=this.collection_list},c.prototype.onBarItemTap=function(e){var n=this;void 0===e&&(e={itemIndex:c.TAB_VIEW.FRIEND}),e&&null!=e.itemIndex&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex),this.selectTabIndex!=e.itemIndex&&(this.scroller_item.stopAnimation(),this.scroller_item.viewport.scrollV=0),this.selectTabIndex=e.itemIndex;var t=this.friendProxy.getListByType(e.itemIndex);switch(this.btn_oneKey.visible=!1,this.btn_acceptAll.visible=!1,this.btn_deleteAll.visible=!1,this.btn_releasrAll.visible=!1,this.lb_refresh.visible=!1,this.gp_noFriend.visible=!1,this.btn_refresh.visible=!1,this.gp_friendinfo.visible=!1,this.lb_tip.text="",e.itemIndex){case c.TAB_VIEW.FRIEND:this.btn_oneKey.visible=!0,function(){n.gp_friendinfo.visible=!0;var e=s.Config.constConfig().FriendNum.constValue,t=JSON.parse(s.Config.constConfig().OnceFriendIntimacyNum.constValue),i=s.Config.constConfig().FriendPokeBallGetLimit.constValue,o=n.friendProxy.getGiftCount();n.bm_friends.text=n.friendProxy.getFriendListNum(c.TAB_VIEW.FRIEND)+"/"+e,n.bm_friendgift.text=o*t+"/"+i,n.lb_tip.text=""}(),this.gp_search.visible=!1,this.scroller_item.height=641,0==this.friendProxy.getFriendListNum(c.TAB_VIEW.FRIEND)&&(this.gp_noFriend.visible=!0,this.lb_empty_tips.text="暂无好友");break;case c.TAB_VIEW.APPLY:this.btn_acceptAll.visible=!0,this.btn_deleteAll.visible=!0,this.lb_tip.text="收到请求："+this.friendProxy.getFriendListNum(c.TAB_VIEW.APPLY),this.gp_search.visible=!1,this.scroller_item.height=641,0==this.friendProxy.getFriendListNum(c.TAB_VIEW.APPLY)&&(this.gp_noFriend.visible=!0,this.lb_empty_tips.text="暂无信息");break;case c.TAB_VIEW.SEARCH:0==this.friendProxy.getFriendListNum(c.TAB_VIEW.SEARCH)&&(this.gp_noFriend.visible=!0,this.lb_empty_tips.text="搜索不到相关信息。。。"),this.lb_refresh.visible=!0,this.btn_refresh.visible=!0,this.gp_search.visible=!0,this.scroller_item.height=615;break;case c.TAB_VIEW.BLACKLIST:0==this.friendProxy.getFriendListNum(c.TAB_VIEW.BLACKLIST)&&(this.gp_noFriend.visible=!0,this.lb_empty_tips.text="暂无信息"),this.btn_releasrAll.visible=!0,this.gp_search.visible=!1,this.scroller_item.height=641}this.img_bg.height=this.scroller_item.height+10,this.updateList({friendList:t,itemIndex:e.itemIndex})},c.prototype.updateView=function(e){if(null==(e=e||{}).updateIndex||e.updateIndex==this.selectTabIndex){var t=e.tabbarIndex;if(null==t)if(null==this.selectTabIndex){for(var i in this.friendProxy.friendList)break;t=c.TAB_VIEW.FRIEND,this.tabbar.selectedIndex=t}else t=this.selectTabIndex;else t!=c.TAB_VIEW.SEARCH&&(this.tabbar.selectedIndex=t);this.onBarItemTap({itemIndex:t}),this.updateNotice()}},c.prototype.updateList=function(e){void 0===e&&(e={friendList:{},itemIndex:c.TAB_VIEW.FRIEND});var t=new Array;for(var i in e.friendList){var o={serverData:e.friendList[i],itemIndex:e.itemIndex,visible:!0};t.push(o)}for(var n in t.sort(function(e,t){return 0==e.serverData.lastOnlineTime&&0!=t.serverData.lastOnlineTime?-1:0==t.serverData.lastOnlineTime&&0!=e.serverData.lastOnlineTime?1:e.serverData.lastOnlineTime!=t.serverData.lastOnlineTime?t.serverData.lastOnlineTime-e.serverData.lastOnlineTime:e.serverData.friendPower>t.serverData.friendPower?-1:e.serverData.friendPower<t.serverData.friendPower?1:void 0}),this.collection_list.replaceAll(t),this.BtnNotice=!1,t){var a=t[n];if(a.serverData.friendGiftVO&&a.serverData.friendGiftVO.bagRecord){var r=a.serverData.friendGiftVO.bagRecord;for(var s in r.info)if(0<r.info[s].num){this.BtnNotice=!0;break}}a.serverData.friendGiftVO&&!a.serverData.friendGiftVO.giveRecord&&(this.BtnNotice=!0)}UIActionManager.setAbsGrey(this.btn_oneKey,!this.BtnNotice),this.btn_oneKey.touchEnabled=this.BtnNotice},c.prototype.updateGiftData=function(){this.selectTabIndex==c.TAB_VIEW.FRIEND&&(this.friendProxy.getListByType(this.selectTabIndex),this.updateView({tabbarIndex:c.TAB_VIEW.FRIEND,updateIndex:c.TAB_VIEW.FRIEND}))},c.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.FRIEND_GIFT,this.tabbar,this,{percentX:55/290,percentY:50/81}),NoticeManager.addNoticeListener(NT.FRIEND_APPLY,this.tabbar,this,{percentX:140/290,percentY:50/81})},c.prototype.perClose=function(){this.selectTabIndex=void 0,this.serachList=[],this.timer_lb_refresh.stop()},c.TAB_VIEW={FRIEND:0,APPLY:1,RECOMMEND:3,BLACKLIST:2,SEARCH:7},c);function c(){var e=i.call(this)||this;e.index=0,e.BtnNotice=!1,e.skinName="FriendUISkin",e.friendProxy=s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N),e.friendProxy.getFriendList(function(){e.updateView({updateIndex:e.selectTabIndex})});var t=s.Config.constConfig().FriendSelectTime.constValue;return e.timer_lb_refresh=new egret.Timer(1e3,t),e.timer_lb_refresh.reset(),e.selectTabIndex=void 0,e.serachList=[],e}s.FriendUI=a,__reflect(a.prototype,"game.FriendUI");var t,e=(t=eui.ItemRenderer,__extends(o,t),o.prototype.dataChanged=function(){var e=this.data.serverData;this.lb_info.text=e.friendName,this.caculateState();var t=new s.PlayerInfoVO;t.avatar=this.data.serverData.friendAvatar,t.level=this.data.serverData.friendLevel,t.name=this.data.serverData.friendName,t.playerVip=this.data.serverData.vipLevel,t.playerId=this.data.serverData.friendId,t.frame=this.data.serverData.frame,this.playerhead.updateData({vo:t}),this.visible=this.data.visible,this.updateItem(this.data.itemIndex)},o.prototype.caculateState=function(){var t=this;if(this.data.itemIndex==a.TAB_VIEW.FRIEND||this.data.itemIndex==a.TAB_VIEW.SEARCH&&this.friendProxy.friendList[this.data.serverData.friendId]){this.giftState=[];var e=this.data.serverData.friendGiftVO;if(!e)return this.giftState.push(0),this.giftState.push(0),void this.giftState.push(0);if(e.giveRecord&&0<e.giveRecord.info.filter(function(e){return 0<e.num&&e.code==t.giftCode}).length?this.giftState.push(1):this.giftState.push(0),e.getRecord?(0<e.getRecord.info.filter(function(e){return 0<e.num&&e.code==t.giftCode}).length?this.giftState.push(1):this.giftState.push(0),this.giftState.push(1)):this.giftState.push(0),e.bagRecord){var i=0;for(var o in e.bagRecord.info){var n=e.bagRecord.info[o];if(0<n.num&&n.code==this.giftCode&&e.bagRecord.friendId==this.data.serverData.friendId){i=1;break}}this.giftState.push(i)}else this.giftState.push(0)}},o.prototype.inintButton=function(){var e=this;this.playerhead.addTapEvent(function(){s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N),s.AppFacade.getInstance().showSubView(s.FriendMediator.N,s.FriendMediator.SV.INFO,{playerId:e.data.serverData.friendId})}),this.btn_accept.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data&&this.friendProxy.agreeRequest({friendId:this.data.serverData.friendId})},this),this.btn_delete.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data&&this.friendProxy.rejectRequest({friendId:this.data.serverData.friendId})},this),this.btn_apply.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data&&this.friendProxy.addFriend({friendId:this.data.serverData.friendId},void 0,void 0,this.data.itemIndex)},this),this.btn_getGift.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e="",t=!1,i=10*this.giftState[1]+this.giftState[2],o=JSON.parse(s.Config.constConfig().OnceFriendIntimacyNum.constValue);switch(s.Config.constConfig().FriendPokeBallGetLimit.constValue/o<=this.friendProxy.getGiftCount()&&Utils.MsgUtils.addMidMsg("今日已全部领取完成！"),i){case 0:return;case 10:e="已领取!";break;case 1:t=!0,e="领取成功"}if(t){var n=FriendGoodType.FriendPokeBall;this.friendProxy.OperateFriendGift({friendId:this.data.serverData.friendId,operationType:FriendGoodOperationType.GetOperation,type:EEntityType.EEntityTypeMoney,code:n,num:JSON.parse(s.Config.constConfig().OnceFriendIntimacyNum.constValue)})}""!=e&&Utils.MsgUtils.addMidMsg(e)},this),this.btn_giveGift.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e="",t=!1;switch(this.giftState[0]){case 0:t=!0,e="赠送成功!";case 1:e="已赠送!"}if(t){var i=FriendGoodType.FriendPokeBall;this.friendProxy.OperateFriendGift({friendId:this.data.serverData.friendId,operationType:FriendGoodOperationType.GiveOperation,type:EEntityType.EEntityTypeMoney,code:i,num:JSON.parse(s.Config.constConfig().OnceFriendIntimacyNum.constValue)})}""!=e&&Utils.MsgUtils.addMidMsg(e)},this),this.btn_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.playerProxy.ChallengePlayer(e.data.serverData.friendId)},this),this.btn_release.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.friendProxy.TickOutBlackList(e.data.serverData.friendId)},this)},o.prototype.updateItem=function(e){var i=this;this.gp_friend.visible=!1,this.gp_applyList.visible=!1,this.btn_apply.visible=!1,this.btn_getGift.visible=!1,this.btn_giveGift.visible=!1,this.btn_release.visible=!1;var t=this.data.serverData,o=Utils.TimerManager.getServerTime();switch(this.fightCapItem.update(t.friendPower),this.lb_outlineTime_rightTop.text=Utils.TimerManager.getOfflineDescBySecond(t.lastOnlineTime?o-t.lastOnlineTime:0),e){case a.TAB_VIEW.FRIEND:var n=function(){i.gp_friend.visible=!0,i.caculateState();var e=i.friendProxy.getGiftCount(),t=JSON.parse(s.Config.constConfig().OnceFriendIntimacyNum.constValue);s.Config.constConfig().FriendPokeBallGetLimit.constValue/t<=e?i.giftState[0]||(i.btn_giveGift.visible=!0):(i.giftState[0]||(i.btn_giveGift.visible=!0),!i.giftState[1]&&i.giftState[2]&&(i.btn_getGift.visible=!0)),i.btn_giveGift.visible?(i.btn_giveGift.x=67,i.btn_getGift.visible&&(i.btn_getGift.x=0)):i.btn_getGift.visible&&(i.btn_getGift.x=67)};n&&n.call(this);break;case a.TAB_VIEW.APPLY:this.gp_applyList.visible=!0;break;case a.TAB_VIEW.SEARCH:this.friendProxy.friendList[this.data.serverData.friendId]?n&&n.call(this):this.btn_apply.visible=!0;break;case a.TAB_VIEW.BLACKLIST:this.btn_release.visible=!0}},o);function o(){var e=t.call(this)||this;return e.friendProxy=s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N),e.playerProxy=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N),e.giftCode=30000015,e.skinName="FriendItemSkin",e.inintButton(),e.giftState=new Array,e}__reflect(e.prototype,"FriendItem")}(game=game||{}),function(l){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var n=this;if(t.prototype.childrenCreated.call(this),this.params){if(this.initTabbar(),this.initList(),this.params.moduleId==MODULE.TeamExpedition){var a=l.AppFacade.getInstance().retrieveProxy(l.TeamExpePy.N);l.AppFacade.getInstance().retrieveProxy(l.FriendPy.N).getFriendList(function(){var e=l.AppFacade.getInstance().retrieveProxy(l.FriendPy.N),t=(e.friendList,[]);for(var i in e.friendList){var o=e.friendList[i];t.push(o.friendId)}a.GetInviteFriendIds({playerIds:t},function(e){n.invitePlayerIds=e,n.updateView()})})}else l.AppFacade.getInstance().retrieveProxy(l.FriendPy.N).getFriendList(function(){n.updateView()});var e=l.AppFacade.getInstance().retrieveProxy(l.GuildPy.N);e.isInGuild()&&e.getMemberListReq(),this.CommonDaTanChuKuang.onCloseCB=function(){n.hide()}}},i.prototype.initTabbar=function(){var t=this,e=Number(this.params.tabbarType);if(e&&e!=Number.NaN){for(var i=[],o=0;0<e;){var n=e%10;e=Math.floor(e/10),n&&i.push(this.tabbarConfig[o].data),o++}this.tabbar_type.itemRendererSkinName="FriendTabBarItemSkin",this.tabbar_type.dataProvider=new eui.ArrayCollection(i),this.tabbar_type.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){e&&null!=e.itemIndex&&e.itemIndex!=t.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),t.index=e.itemIndex),t.curIndex=e.itemIndex,t.updateView()},this)}},i.prototype.initList=function(){this.list_root.itemRenderer=n},i.prototype.updateView=function(){var t=this;this.CommonDaTanChuKuang.blb_title.text=this.tabbarConfig[this.curIndex].title;var e=this.tabbarConfig[this.curIndex].getList(),i=l.AppFacade.getInstance().retrieveProxy(l.FriendPy.N).getInviteHistory(this.params.moduleId);this.params&&this.params.filter&&(e=e.filter(this.params.filter)),e.forEach(function(e){0<=i.indexOf(e.playerId)&&(e.invited=!0),e.inviteCallback=t.params.inviteCallback}),e.sort(function(e,t){return e.lastOnlineTime-t.lastOnlineTime}),this.list_root.dataProvider=new eui.ArrayCollection(e),e&&e.length<1?this.gp_empty.visible=!0:this.gp_empty.visible=!1},i);function i(e){var c=t.call(this)||this;return c.curIndex=0,c.index=0,c.invitePlayerIds=[],c.tabbarConfig=[{data:{up:"_btn_yq_m_json.common_yeqian_haoyou_0",down:"_btn_yq_m_json.common_yeqian_haoyou_1"},getList:function(){function e(e){var t=i.friendList[e];t&&e==t.friendId&&o.push({playerId:t.friendId,playerName:t.friendName,avatar:t.friendAvatar,level:t.friendLevel,fightCap:t.friendPower,guildId:t.friendGuild,lastOnlineTime:t.lastOnlineTime,vipLevel:t.vipLevel})}var i=l.AppFacade.getInstance().retrieveProxy(l.FriendPy.N),o=[];if(c.params.moduleId==MODULE.TeamExpedition)for(var t=0,n=c.invitePlayerIds;t<n.length;t++){e(n[t])}else for(var a in i.friendList)e(a);return o},index:0,title:"好友列表"},{data:{up:"_btn_yq_m_json.common_yeqian_gonghui_0",down:"_btn_yq_m_json.common_yeqian_gonghui_1"},getList:function(){var e=l.AppFacade.getInstance().retrieveProxy(l.GuildPy.N),t=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N).playerInfoVO.playerId,i=[];if(c.params.moduleId==MODULE.TeamExpedition)for(var o=0,n=c.invitePlayerIds;o<n.length;o++){var a=n[o];for(var r in e.memberList){if((s=e.memberList[r]).baseInfo.playerId!=t&&a==s.baseInfo.playerId){i.push(s.baseInfo);break}}}else for(var r in e.memberList){var s;(s=e.memberList[r]).baseInfo.playerId!=t&&i.push(s.baseInfo)}return i},index:1,title:"公会好友"}],c.skinName="InviteFriendViewSkin",c.params=e,c}l.InviteFriendView=e,__reflect(e.prototype,"game.InviteFriendView");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.btn_invite.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.invited?Utils.MsgUtils.addMidMsg("已邀请"):e.data.lastOnlineTime||e.data.offlineTime?Utils.MsgUtils.addMidMsg("无法邀请离线玩家"):e.data.inviteCallback&&e.data.inviteCallback(e.data.playerId,function(){e.data.invited=!0,e.dataChanged()})},this)},a.prototype.dataChanged=function(){o.prototype.dataChanged.call(this),this.playerhead.updateData({vo:this.data}),this.fightCapItem.update(this.data.fightCap);var e=Utils.TimerManager.getServerTime(),t=this.data.lastOnlineTime||this.data.offlineTime;this.lb_outlineTime_rightTop.text=Utils.TimerManager.getOfflineDescBySecond(t?e-t:0),t?(this.lb_outlineTime_rightTop.text=this.lb_outlineTime_rightTop.text.slice(3)+"前",this.lb_outlineTime_rightTop.textColor=5841675):this.lb_outlineTime_rightTop.textColor=28730,this.lb_info.text=this.data.playerName||this.data.name,this.data.invited?(this.btn_invite.skinName="skins.ButtonSkinSure",this.btn_invite.label="已邀请"):(this.btn_invite.skinName="skins.ButtonSkinYellow2",this.btn_invite.label="邀请")},a);function a(){var e=o.call(this)||this;return e.skinName="InviteFriendViewItemSkin",e}__reflect(n.prototype,"InviteFriendViewItem")}(game=game||{}),function(p){var e=(t.prototype.clearCurEffect=function(e,t){for(var i in void 0===t&&(t=!1),this.guideEffectCache){var o=this.guideEffectCache[i];o.forEach(function(e){e&&e.parent&&(egret.Tween.removeTweens(e),e.parent.removeChild(e))}),o.splice(0),delete this.guideEffectCache[i]}var n=p.AppFacade.getInstance().retrieveMediator(p.GuajiMediator.N);n.guajiUI&&n.guajiUI.map&&n.guajiUI.map.curValidTouchPosXY.splice(0),!t&&e.length&&e.some(function(e){return e.isForce})||GameRootLayer.gameLayer().switchDarkMaskForGuide(!1)},t.prototype.showGuideMask=function(e){var t=egret.Point.create(0,0);e.x&&e.y?(t.x=e.x,t.y=e.y):t=e.component.localToGlobal(e.component.width/2,e.component.height/2,t);var i=e.r||(e.component.width+e.component.height)/4;i*=1.2,GameRootLayer.gameLayer().switchDarkMaskForGuide(!0,{x:t.x,y:t.y,r:i,maskCB:e.maskCB}),egret.Point.release(t)},t.prototype.addGuideEffect=function(t){var i=this,e=t.type,o=t.addOnView||!1,n=t.parent,a=t.component;if(!n)if(o)n=GameRootLayer.gameLayer().maskLayer;else if(a instanceof p.EventPoint){var r=p.AppFacade.getInstance().retrieveMediator(p.GuajiMediator.N);n=r.guajiUI.map}else n=a.addChild?a:a.parent;var s=egret.Point.create(0,0);switch(t.x&&t.y?(s.x=t.x,s.y=t.y):s=Utils.ComponentUtils.getPosInView(a,{x:a.width/2,y:a.height/2},n,s),e){case 1:var c=new eui.Image("xinshou_img_shouzhi_png");c.touchEnabled=!1,c.x=s.x,c.y=s.y,c.scaleX=1/n.scaleX,c.scaleY=1/n.scaleY,n.addChild(c);var l=t.dir||1;c.rotation=90*-(l-1);var h=c.y;egret.Tween.get(c,{loop:!0}).to({y:h-15},500).to({y:h},500),this.guideEffectCache[t.id].push(c),t.cb&&t.cb(),egret.Point.release(s);break;case 2:DragonBoneTools.create("common_dianji",function(e){i.guideEffectCache[t.id]&&(e.animation.play("common_dianji",0),e.scaleX=e.scaleY=1.5,e.x=s.x,e.y=s.y,e.scaleX=1/n.scaleX,e.scaleY=1/n.scaleY,n.addChild(e),i.guideEffectCache[t.id].push(e),t.cb&&t.cb()),egret.Point.release(s)},this,{groupName:"GuajiFixed"})}},t.prototype.addTips=function(e){var t=e.addOnView||e.isForce||!1;9<e.tipsDir[0]&&(t=!0);var i=e.component,o=e.parent;o=o||(t?GameRootLayer.gameLayer().maskLayer:i instanceof p.EventPoint?p.AppFacade.getInstance().retrieveMediator(p.GuajiMediator.N).guajiUI.map:i.addChild?i:i.parent);var n=0,a=0,r=e.tipsDir[0];9<r&&(r/=10);var s=i&&i.width||60,c=i&&i.height||60;r<3?a=3*-c/10:n=3*c/10,n=1==r||4==r?3*-s/10:3*s/10,i&&i instanceof p.EventPoint&&(a=-i.height),e.tipsDir[2]&&(n+=e.tipsDir[2][0],a+=e.tipsDir[2][1]);var l=egret.Point.create(0,0);e.x?(l.x=e.x+n,l.y=e.y+a):l=Utils.ComponentUtils.getPosInView(i,{x:i.width/2+n,y:i.height/2+a},o,l);var h=new p.TipsComponent([r,e.tipsDir[1]]);h.touchChildren=h.touchEnabled=!1,h.x=l.x,h.y=l.y,h.scaleX=1/o.scaleX,h.scaleY=1/o.scaleY,o.addChild(h),egret.Point.release(l),this.guideEffectCache[e.id].push(h)},t.prototype.addTips2=function(e){var t=new p.StoryViewForGuide({text:e.text});t.touchEnabled=t.touchChildren=!1,t.bottom=0,GameRootLayer.gameLayer().maskLayer.addChild(t),UIActionManager.playUIAction(t,3),this.guideEffectCache[e.id].push(t)},t);function t(){this.guideEffectCache={}}p.GuideEffectManager=e,__reflect(e.prototype,"game.GuideEffectManager")}(game=game||{}),function(h){var i,e,t=(__extends(p,i=BaseMediator),Object.defineProperty(p.prototype,"guideUI",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),p.prototype.listNotificationInterests=function(){return[CN.LOGIN_FINAL_DONE,CN.GUIDE_MAKE_FLOW,CN.GUIDE_CHECK_CUR_STEP,CN.GUIDE_NET_RESP,CN.GUIDE_VIEW_STACK_CHANGE,CN.GUAJI_ENTER_EP,CN.GUAJI_ENTER_LAYER,CN.PLAYER_LEVEL_UP,CN.GUAJI_MAP_ON_TOUCH_TILE_POS,CN.GUAJI_ON_ME_STOP_ON,CN.TASK_UPDATE]},p.prototype.handleNotification=function(e){var r=this,t=e.getBody();if(Utils.isNeedGuide)switch(e.getName()){case CN.GUAJI_ON_ME_STOP_ON:function i(e){var t=o.proxy.waitingServerSteps[e];if(t.operation[0]==GuideOperationType.MAP_GUIDE){var i=0;t.target.some(function(e){return e[0]==GuideConditionSubType.GUIDE_RECODRD&&(i=e[1][0],!0)})&&o.proxy.setGuideInfo(i)}}h.AppFacade.getInstance().retrieveMediator(h.GuajiMediator.N),this.proxy.curTodoStep.some(function(e){return e.operation[0]==GuideOperationType.EVENT_INTERACT&&e.isForce})&&GameRootLayer.gameLayer().switchTouchEnable(!0);var o=this;for(var n in this.proxy.waitingServerSteps)i(n);break;case CN.GUAJI_MAP_ON_TOUCH_TILE_POS:t.source&&t.source==MODULE.Risk&&0<h.AppFacade.getInstance().retrieveMediator(h.GuajiMediator.N).guajiUI.map.curValidTouchPosXY.length&&(this.proxy.clearCurEffect(!0),GameRootLayer.gameLayer().switchTouchEnable(!1));break;case CN.TASK_UPDATE:(t.type==TaskType.Guide&&t.newTask||t.type==TaskType.HideAchievement)&&this.proxy.makeTodoFlow();break;case CN.GUAJI_ENTER_LAYER:case CN.PLAYER_LEVEL_UP:case CN.BACKPACK_UPDATE:case CN.GUIDE_MAKE_FLOW:this.proxy.makeTodoFlow();break;case CN.GUIDE_VIEW_STACK_CHANGE:case CN.GUIDE_CHECK_CUR_STEP:this.proxy.checkCurStep();break;case CN.GUIDE_NET_RESP:function a(i){var o=c[i],n=o.target,a=[];if(n.forEach(function(e){var t=p.GUIDE_WAIT_EVENT_MAP[e[0]]||p.GUIDE_WAIT_EVENT_MAP[Math.floor(e[0]/10)];t&&(a=a.concat(t))}),a.length&&-1!=a.indexOf(s)){function e(e){if(c[i]&&r.proxy.checkAllTarget(n)){function t(){o.stepsCache&&(r.proxy.uselessSteps=r.proxy.uselessSteps.concat(o.stepsCache)),r.proxy.makeTodoFlow(),e&&e()}delete c[i],r.log("stepId:"+o.id+"|flowId:"+o.belongFlow.id+"条件已完成，移除等待队列"),r.autoPopupView(o),0<o.tipsAfter.length?r.proxy.showStoryViewWithoutCheck({storyConfig:o.tipsAfter,cb:t}):t()}}o.operation[0]==GuideOperationType.MAP_GUIDE&&o.isForce?egret.setTimeout(function(){e(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)})},l,100):egret.setTimeout(e,l,100)}}var s=t.split(".")[0],c=this.proxy.waitingServerSteps,l=this;for(var n in c)a(n)}},p.prototype.autoPopupView=function(e){1142==e.id&&egret.setTimeout(function(){h.AppFacade.getInstance().sendNotification(CN.GUIDE_FIRST_CHARPTER_END)},this,600),Utils.SDKMgr.getPerformConfig(10021)&&(260==e.id&&(h.GameMVC.activityPy.operationHasExec(OperationType.Act_ShouCangYouLi),egret.setTimeout(function(){getUrlKV().channel&&!h.GameMVC.activityPy.operationHasExec(OperationType.Act_ShouCangYouLi)&&h.AppFacade.getInstance().sendNotification(CN.QQZONE_POPUP_VIEW,{type:2})},this,600)),111==e.id&&egret.setTimeout(function(){"QQLive"==getUrlKV().channel&&h.AppFacade.getInstance().sendNotification(CN.QQZONE_POPUP_VIEW,{type:1})},this,600),1142==e.id&&egret.setTimeout(function(){h.AppFacade.getInstance().sendNotification(CN.QQZONE_POPUP_VIEW,{type:3})},this,600))},p.N="GuideMediator",p.GUIDE_WAIT_EVENT_MAP=((e={})[GuideConditionType.TASK]=["task"],e[GuideConditionType.HERO]=["hero"],e[GuideConditionType.GACHA]=["gashapon"],e[GuideConditionType.RISK]=["risk"],e[GuideConditionType.BAG]=["bag"],e[GuideConditionSubType.GUIDE_RECODRD]=["loginGame"],e),p);function p(e){void 0===e&&(e=null);var t=i.call(this,p.N,e)||this;return t.proxy=h.AppFacade.getInstance().retrieveProxy(h.GuidePy.N),t.playerProxy=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N),t.curDoneStepInCurViewStack={},t}h.GuideMediator=t,__reflect(t.prototype,"game.GuideMediator")}(game=game||{}),function(O){var t,e=(__extends(i,t=BaseProxy),Object.defineProperty(i.prototype,"isInMapGuide",{get:function(){return this._isInMapGuide},enumerable:!0,configurable:!0}),i.prototype.setInMapGuide=function(e){this._isInMapGuide=e},i.prototype.makeTodoFlow=function(){this.curTodoFlow.splice(0);var e=O.Config.guideFlowConfig(),t=O.GameMVC.playerPy.playerInfoVO.level;for(var i in this.log("--------------------MAKE FLOW(BEGIN)----------------------"),e){var o=e[i],n=!1,a=!1;if((0==o.levelLimit||o.levelLimit>t)&&o.enable){var r=JSON.parse(o.cond),s=JSON.parse(o.target);if(n=!this.checkAllTarget(s),o.targetDone){a=!0;continue}n?n=this.checkAllCondition(r):s.every(function(e){var t=e[0];return Math.floor(t/10)!=GuideConditionType.RISK})&&(o.targetDone=!0)}if(n){var c=new O.GuideFlow(o);this.curTodoFlow.push(c)}this.log("id:"+i+"\t描述："+o.remarks+"\t\t有效："+n+"\t\t跳过："+(a?"是":"否"))}this.log("--------------------MAKE FLOW(END)----------------------"),this.checkCurStep(!0)},i.prototype.checkCurStep=function(e){var i=this;if(void 0===e&&(e=!1),this.curTodoStep.splice(0),this.curTodoFlow.forEach(function(e,t){e.steps.forEach(function(e){var t=i.checkAllCondition(e.cond);(t=t&&!i.checkAllTarget(e.target))&&i.curTodoStep.push(e)})}),0<this.curTodoStep.length?this.uselessSteps.splice(0):0<this.uselessSteps.length&&this.uselessSteps.forEach(function(e){e.showTimes=0;var t=i.checkAllCondition(e.cond);(t=t&&!i.checkAllTarget(e.target))&&i.curTodoStep.push(e)}),this.curTodoStep.some(function(e){return e.isForce}))for(var t=this.curTodoStep.length;t--;)this.curTodoStep[t].isForce||this.curTodoStep.splice(t,1);this.clearCurEffect(e),this.handleTodoSteps()},i.prototype.clearCurEffect=function(e){void 0===e&&(e=!1),this.effectManager.clearCurEffect(this.curTodoStep,e)},i.prototype.handleTodoSteps=function(){var t=this;if(0<this.curTodoStep.length)if(this.curTodoStep.some(function(e){if(e.isForce&&0<e.showTimes&&t.checkAllTarget(e.belongFlow.target))return!0}))this.makeTodoFlow();else{var e=1==this.curTodoStep[0].operation[0]?this.curTodoStep[0].operation[1][0].split("#")[0]:GameRootLayer.gameLayer().getCurViewSkinName(),i=GameRootLayer.gameLayer().getViewBySkinName(e);i.adaptForGuide(this.curTodoStep.some(function(e){return e.isForce})),GameRootLayer.gameLayer().switchTouchEnable(!1),i.setGuideCB(function(){t.curTodoStep.forEach(function(e){!e.tipsShowed&&0<e.tips.length?(t.showStoryViewWithoutCheck({storyConfig:e.tips,cb:function(){t.registerEffectForStep(e)}}),e.tipsShowed=!0):t.registerEffectForStep(e)}),GameRootLayer.gameLayer().switchTouchEnable(!0)})}},i.prototype.registerEffectForStep=function(i){var o=this;if(0<i.operation.length){i.showTimes+=1;var e=i.operation,t=e[0],n=e[1],a=this.effectManager.guideEffectCache;switch(a[i.id]?a[i.id].length&&(a[i.id].forEach(function(e){e&&e.parent&&(egret.Tween.removeTweens(e),e.parent.removeChild(e))}),a[i.id].splice(0)):a[i.id]=[],t){case GuideOperationType.BUTTON_TAP:var r=Utils.ComponentUtils.getComponentByName(n[0]);r&&r.parent&&(Utils.ComponentUtils.getBaseView(r),i.isForce&&this.effectManager.showGuideMask({component:r}),this.registGuideEffectForComp(r,i),i.isKeyOppr&&r.once(egret.TouchEvent.TOUCH_TAP,function(){o.onKeyOperateStep(i)},this));break;case GuideOperationType.DRAG:var s=Utils.ComponentUtils.getComponentByName(n[0]),c=Utils.ComponentUtils.getComponentByName(n[1]);if(s&&c){var l=new eui.Image("xinshou_img_shouzhi_png");l.touchEnabled=!1;var h=s.x,p=s.y;l.x=s.width/2+h,l.y=s.height/2+p,s.parent.addChild(l);var d=[c.x-s.x+c.width/2+h,c.y-s.y+c.height/2+p];egret.Tween.get(l,{loop:!0}).to({x:d[0],y:d[1]},700),egret.setTimeout(function(){l.parent&&l.parent.removeChild(l)},this,2100),this.effectManager.guideEffectCache[i.id].push(l)}break;case GuideOperationType.MAP_GUIDE:var u=(v=O.AppFacade.getInstance().retrieveMediator(O.GuajiMediator.N)).guajiUI&&v.guajiUI.map,g=n[0],f=n[1],_=u.tile2Pos(g,f,!0),m=u.localToGlobal(_.x,_.y-38*u.scaleY);if(i.isForce){if(u.curValidTouchPosXY.push({tileX:g,tileY:f}),this.effectManager.showGuideMask({x:m.x,y:m.y,r:35,maskCB:function(){u.handleTouchTap(g,f)}}),16==g&&10==f){var y=new eui.Group;y.percentWidth=100,y.percentHeight=100,GameRootLayer.gameLayer().maskLayer.addChild(y),y.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){GameRootLayer.gameLayer().maskLayer.removeChild(y),egret.log("全局点击"),u.handleTouchTap(g,f)},this)}this.effectManager.addGuideEffect({type:1,parent:GameRootLayer.gameLayer().maskLayer,x:m.x,y:m.y,isForce:!0,id:i.id})}else this.effectManager.addGuideEffect({type:1,parent:u,x:_.x,y:_.y,id:i.id}),O.GameMVC.fightPy.addDelayCBAfterFightExit(function(){egret.setTimeout(function(){var t=0;if(i.target.some(function(e){return e[0]==GuideConditionSubType.GUIDE_RECODRD&&(t=e[1][0],!0)}),t){var e="MapGuide_"+t;Utils.TouchUtils.hasGlobalTouch(e)||Utils.TouchUtils.addGlobalTouch(function(){Utils.TouchUtils.removeGlobalTouch(e),o.setGuideInfo(t)},e)}O.GameMVC.fightPy.queueExceExitCB()},o,100)},"MAP_GUIDE");0<i.tipsDir.length&&this.effectManager.addTips({parent:i.isForce?GameRootLayer.gameLayer().maskLayer:u,x:i.isForce?m.x:_.x,y:i.isForce?m.y:_.y,id:i.id,tipsDir:i.tipsDir}),0<i.tipsDir2.length&&this.effectManager.addTips2({text:i.tipsDir2[1],id:i.id}),this.waitingServerSteps[i.id]||(this.waitingServerSteps[i.id]=i);break;case GuideOperationType.EVENT_INTERACT:var v,T=(v=O.AppFacade.getInstance().retrieveMediator(O.GuajiMediator.N)).guajiUI&&v.guajiUI.map;if(T){var C=T.getEpByEventId(n[0]);C&&(i.isForce&&(this.effectManager.showGuideMask({component:C}),O.AppFacade.getInstance().retrieveMediator(O.GuajiMediator.N).guajiUI.map.curValidTouchPosXY.push({tileX:C.vo.position.x,tileY:C.vo.position.y})),this.registGuideEffectForComp(C,i))}}}},i.prototype.registGuideEffectForComp=function(e,t){var i=this,o=t.figType,n=t.isForce;10<=t.figType&&(o=Math.floor(o/10),n=!0);var a=Number(t.figDir);3==o?this.effectManager.addGuideEffect({type:2,component:e,addOnView:n,dir:a,id:t.id,cb:function(){i.effectManager.addGuideEffect({type:1,component:e,addOnView:n,id:t.id,dir:a})}}):this.effectManager.addGuideEffect({type:o,component:e,addOnView:n,id:t.id,dir:a}),0<t.tipsDir.length&&this.effectManager.addTips({component:e,tipsDir:t.tipsDir,id:t.id,isForce:t.isForce}),0<t.tipsDir2.length&&this.effectManager.addTips2({text:t.tipsDir2[1],id:t.id})},i.prototype.checkAllCondition=function(e){var t=this,i=!0;return e.forEach(function(e){t.checkCondition(e[0],e[1])||(i=!1)}),i},i.prototype.checkAllTarget=function(e){var t=!0;if(e.length)for(var i=0,o=e;i<o.length;i++){var n=o[i];if(n[0]==GuideConditionSubType.GUIDE_RECODRD){t=this.checkCondition(n[0],n[1]);break}t=this.checkCondition(n[0],n[1])&&t}else t=!1;return t},i.prototype.checkCondition=function(e,t){var i=!1;try{switch(e){case GuideConditionSubType.PLAYER_LEVEL_MATCH:1===t[0]?i=this.playerProxy.playerInfoVO.level===t[1]:2===t[0]?i=this.playerProxy.playerInfoVO.level<t[1]:3===t[0]?i=this.playerProxy.playerInfoVO.level>=t[1]:4===t[0]&&(i=this.playerProxy.playerInfoVO.level>=t[1]&&this.playerProxy.playerInfoVO.level<=t[2]);break;case GuideConditionSubType.VIEW_STACK:var o=GameRootLayer.gameLayer().getCurViewSkinName();i=t[0]==o;break;case GuideConditionSubType.VIEW_STACK_NOT:var n=GameRootLayer.gameLayer().getCurViewStack();i=!(0<n.panelLayer.length||1<n.mainLayer.length)&&(o=GameRootLayer.gameLayer().getCurViewSkinName(),t[0]!=o);break;case GuideConditionSubType.VIEW_CUR_RISK_TYPE:0==t[0]?i=this.guajiProxy.curLayerInfo.position.type!=t[0]:1==t[0]&&(i=this.guajiProxy.curLayerInfo.position.type==t[0]);break;case GuideConditionSubType.GUIDE_RECODRD:this.serverGuideInfo[t[0]]&&(i=!0);break;case GuideConditionSubType.GUIDE_FLOW_TARGET:var a=O.Config.guideFlowConfig()[t[0]],r=JSON.parse(a.target);0!=a.levelLimit&&(i=O.GameMVC.playerPy.playerInfoVO.level>=a.levelLimit),i=i||this.checkAllTarget(r);break;case GuideConditionSubType.GUIDE_FLOW_COND:a=O.Config.guideFlowConfig()[t[0]];var s=JSON.parse(a.cond);i=this.checkAllTarget(s);break;case GuideConditionSubType.GACHA_HTIMES:this.heroPy.gashaponInfo[t[0]]&&(i=this.heroPy.gashaponInfo[t[0]].hTimes>=t[1]);break;case GuideConditionSubType.TASK_GUIDE_TASK_CUR_CODE:i=(f=this.taskProxy.getCurGuideTask())&&f.code==t[0];break;case GuideConditionSubType.TASK_GUIDE_TASK_STATUS:var c=t[0],l=t[1],h=TaskStatus.UNDONE,p=!1;for(var d in this.taskProxy.allTasks){var u=this.taskProxy.allTasks[d];for(var g in u){var f;if((f=u[g]).code==c){p=!0,h=this.taskProxy.getTaskStatus(f);break}}}if(!p&&O.Config.taskConfig()[c].type==TaskType.Guide){var _=this.taskProxy.getCurGuideTask();(!_||_.code>c)&&(h=TaskStatus.RECEIVE)}i=l==h;break;case GuideConditionSubType.HERO_HAS_HERO_LEVEL_GREATER:for(var m in this.heroPy.allHeroByUuid)if(this.heroPy.allHeroByUuid[m].level>=t[0]){i=!0;break}break;case GuideConditionSubType.HERO_HAS_HERO_SECTION_GREATER:for(var m in this.heroPy.allHeroByUuid)if(this.heroPy.allHeroByUuid[m].sectionLevel>=t[0]){i=!0;break}break;case GuideConditionSubType.HERO_POS_OCCUPY:i=(this.heroPy.heroUuid22Pos[t[0]]?1:0)==t[1];break;case GuideConditionSubType.HERO_CUR_SELECTED:"HeroMainViewSkin"==GameRootLayer.gameLayer().getCurViewSkinName()&&(C=O.AppFacade.getInstance().retrieveMediator(O.HeroMediator.N).getSubView(O.HeroMediator.SV.MAIN))&&(i=1==t[0]==(this.heroPy.heroUuid22Pos[C.curUuid]==t[1]));break;case GuideConditionSubType.HERO_VIEW_CUR_INDEX:"HeroMainViewSkin"==GameRootLayer.gameLayer().getCurViewSkinName()&&(C=O.AppFacade.getInstance().retrieveMediator(O.HeroMediator.N).getSubView(O.HeroMediator.SV.MAIN))&&(i=1==t[0]==(C.curType==t[1]));break;case GuideConditionSubType.HERO_HAS_FREE:var y=0,v=this.heroPy.allHeroByUuid;for(var m in v)if(!v[m].pos&&++y>=t[0]){i=!0;break}break;case GuideConditionSubType.HERO_NO_SUBTYPE_ON_FORM:i=!0;for(var T=1;T<7;T++)if(this.heroPy.heroUuid22Pos[T]&&this.heroPy.allHeroByUuid[this.heroPy.heroUuid22Pos[T]].config.subType==t[0]){i=!1;break}break;case GuideConditionSubType.BAG_HAS_ENOUGH:i=this.backpackProxy.checkEnough([[t[0],t[1],t[2]]]);break;case GuideConditionSubType.BAG_VIEW_CUR_INDEX:var C;"BackpackUISkin"==GameRootLayer.gameLayer().getCurViewSkinName()&&(C=O.AppFacade.getInstance().retrieveMediator(O.BackpackMediator.N).getSubView(O.BackpackMediator.SV.MAIN))&&(i=1==t[0]==(C.tabbar_type.selectedIndex==t[1]));break;case GuideConditionSubType.BAG_CHIP_AVAILABLE:c=t[0],i=this.backpackProxy.checkChipNotice(c);break;case GuideConditionSubType.BAG_EQUIP_AVAILABLE:c=t[0];var E=this.heroThingPy.AllEquipInfo;for(var m in E){var I=E[m];if((0==c||I.config.code==c)&&""==I.heroUuid){i=!0;break}}break;case GuideConditionSubType.BAG_ARTIFACT_AVAILABLE:c=t[0];var b=this.heroThingPy.AllArtiInfo;for(var m in b){var A=b[m];if((0==c||A.config.code==c)&&""==A.heroUuid){i=!0;break}}break;case GuideConditionSubType.TOWER_LEVEL_PASS:this.championProxy&&this.championProxy.championInfo&&(i=this.championProxy.championInfo.id>t[0]);break;case GuideConditionSubType.FIRST_RECHARGE_OPEN:var P=O.AppFacade.getInstance().retrieveProxy(O.RechargePy.N);i=P.isFirstRechargeOpen()&&1==t[0]||!P.isFirstRechargeOpen()&&0==t[0];break;case GuideConditionSubType.RISK_EVENT_EXIST:var M=(N=O.AppFacade.getInstance().retrieveMediator(O.GuajiMediator.N)).guajiUI&&N.guajiUI.map;M&&(i=!!M.getEpByEventId(t[0]));break;case GuideConditionSubType.RISK_EVENT_COMPLETE:var N=O.AppFacade.getInstance().retrieveMediator(O.GuajiMediator.N),S=(a=O.Config.riskEvent()[t[0]],N.guajiUI&&N.guajiUI.map&&N.guajiUI.map.getEpByEventId(t[0]));switch(a.type){case RiskEventType.Mine:i=S&&!S.checkNotice();break;case RiskEventType.Fortress:i=S&&S.vo.info.hasEnter;break;case RiskEventType.Tavern:case RiskEventType.Box:case RiskEventType.Quora:case RiskEventType.Creep:i=!S}break;case GuideConditionSubType.RISK_CUR_POS:var k=(N=O.AppFacade.getInstance().retrieveMediator(O.GuajiMediator.N)).guajiUI&&N.guajiUI.map&&N.guajiUI.map.me;k&&(i=k.tileX==t[0]&&k.tileY==t[1]);break;case GuideConditionSubType.ACTIVITY_OPEN:O.GameMVC.activityPy.allActivityData[t[0]]&&(i=!0);break;case GuideConditionSubType.UNLOCK_ID_UNLOCK:var U=t[0],L=1===t[1];if((i=L===Utils.UnlockMgr.checkPass(U,!1).allow)&&1==L)switch(U){case MODULE.WorldKing:i=O.GameMVC.worldKingPy.getOpenInfo().isOpen;break;case MODULE.TeamArena:i=O.GameMVC.battleZoneArenaPy.getOpenInfo().isOpen;break;case MODULE.ServerBoss:i=O.GameMVC.worldBossPy.getOpenInfo().isOpen}}}catch(e){egret.error("checkCondition exception",e)}return i},i.prototype.showStoryViewWithoutCheck=function(e){var t=new O.StoryView(e);t.checkForGuide=!1,PopUpManager.addPopUp({obj:t})},i.prototype.onKeyOperateStep=function(e){if(!this.waitingServerSteps[e.id]){this.waitingServerSteps[e.id]=e,this.log("id"+e.id+"加入等待队列");var t=0;e.target.some(function(e){return e[0]==GuideConditionSubType.GUIDE_RECODRD&&(t=e[1][0],!0)})&&this.setGuideInfo(t)}},i.prototype.setGuideInfo=function(t){Utils.Socket.send("loginGame","SetGuideInfo",{guide:t.toString()}).then(function(e){O.AppFacade.getInstance().retrieveProxy(i.N).serverGuideInfo[t]=1})},i.prototype.checkComponentName=function(e){var t=this.getValidCompForGuide(e);return this.log("有效控件：",t),Utils.ComponentUtils.getBaseView(t)?Utils.ComponentUtils.getNameOfComponent(t):"无可用BaseView"},i.prototype.getValidCompForGuide=function(e){var t=e;for(var i in this.BASE_TYPE){var o=this.BASE_TYPE[i];if(e instanceof o.className){if(!(0<o.sensitiveParent.length))break;for(var n in o.sensitiveParent){for(var a=o.sensitiveParent[n],r=e;r&&!(r instanceof a);)r=r.parent;if(r){t=r;break}}break}}return t},i.N="GuideProxy",i);function i(){var e=t.call(this,i.N)||this;return e.guajiProxy=O.AppFacade.getInstance().retrieveProxy(O.GuajiPy.N),e.taskProxy=O.AppFacade.getInstance().retrieveProxy(O.TaskPy.N),e.playerProxy=O.AppFacade.getInstance().retrieveProxy(O.PlayerPy.N),e.backpackProxy=O.AppFacade.getInstance().retrieveProxy(O.BackpackPy.N),e.championProxy=O.AppFacade.getInstance().retrieveProxy(O.ChampionPy.N),e.loginProxy=O.AppFacade.getInstance().retrieveProxy(O.LoginPy.N),e.heroPy=O.AppFacade.getInstance().retrieveProxy(O.HeroPy.N),e.heroThingPy=O.AppFacade.getInstance().retrieveProxy(O.HeroThingPy.N),e.BASE_TYPE={BUTTON:{className:eui.Button,sensitiveParent:[]},IMAGE:{className:eui.Image,sensitiveParent:[eui.ItemRenderer,O.HeroMainView_HeroListItem]}},e.serverGuideInfo={},e.curTodoFlow=new Array,e.curTodoStep=new Array,e.uselessSteps=new Array,e.waitingServerSteps={},e.effectManager=new O.GuideEffectManager,window._p=e}O.GuidePy=e,__reflect(e.prototype,"game.GuidePy")}(game=game||{}),function(e){var t,i=(__extends(o,t=BaseView),o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},o);function o(){var e=t.call(this)||this;return e.skinName="Guajiview",e}e.GuideView=i,__reflect(i.prototype,"game.GuideView")}(game=game||{}),function(e){var i,t=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this);var e=new egret.Sprite;this.addChild(e),e.touchEnabled=!1,e.graphics.clear(),e.graphics.beginFill(0,.8),e.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),e.graphics.endFill(),this.gp_content=new eui.Group,this.gp_content.width=this.gp_content.height=700,this.gp_content.horizontalCenter=0,this.gp_content.verticalCenter=0,this.addChild(this.gp_content);var t=new eui.Label;t.textColor=12829635,t.size=26,t.bold=!0,t.touchEnabled=!1,t.text="点击屏幕跳过",t.horizontalCenter=0,t.bottom=100,this.addChild(t),UIActionManager.fadeBlink(t,!0,void 0,1e3),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showAll,this),this.TimeoutTimer=new egret.Timer(this.timeout,1),this.goPlay()},o.prototype.finish=function(){this.hide(),this.cb&&this.cb()},o.prototype.goPlay=function(){var t=this;this.TimeoutTimer.stop();var e=this.content.length;function i(){if(t.ContentTimer){var e=new eui.Label(t.content[++t.curIndex]);e.bold=!0,e.horizontalCenter=0,e.touchEnabled=!1,e.alpha=0,e.y=600,t.gp_content.addChild(e),egret.Tween.get(e).to({alpha:1},t.labelShowDt).wait(t.labelPopDt-t.labelShowDt-t.labelDismissDt).to({alpha:0},t.labelDismissDt),egret.Tween.get(e).to({y:0},t.labelPopDt).call(function(){e.parent==t.gp_content&&t.gp_content.removeChild(e),0==t.gp_content.numChildren&&t.finish()})}}this.ContentTimer=new egret.Timer(this.talkSpeed,e),this.ContentTimer.addEventListener(egret.TimerEvent.TIMER,i,this),i(),this.ContentTimer.start()},o.prototype.showAll=function(){if(this.ContentTimer){this.ContentTimer.stop(),this.ContentTimer=void 0,this.gp_content.removeChildren();var e=new eui.Label;e.horizontalCenter=0,e.verticalCenter=0,e.bold=!0,e.lineSpacing=50,e.textAlign=egret.HorizontalAlign.CENTER;for(var t=0,i=this.content;t<i.length;t++){var o=i[t];e.appendText(o+"\n")}this.gp_content.addChild(e)}else this.finish()},o.STORAGE_PREFIX="BigStoryView",o);function o(e){var t=i.call(this)||this;return t.curIndex=-1,t.talkSpeed=2e3,t.timeout=2e3,t.labelShowDt=1e3,t.labelDismissDt=1e3,t.labelPopDt=15e3,t.cb=e.cb,t.content=JSON.parse(e.content),t}e.BigStoryView=t,__reflect(t.prototype,"game.BigStoryView")}(game=game||{}),function(o){var i,e=(__extends(n,i=BasePanel),n.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.list_selection.itemRenderer=p,this.scl_heroModel.scrollPolicyH=this.scl_heroModel.scrollPolicyV=eui.ScrollPolicy.OFF,this.TimeoutTimer=new egret.Timer(this.timeout,1),this.TimeoutTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){e.nextStep()},this),this.gp_text.alpha=0,this.gp_text.rotation=-90,this.heroModel.update({model:"hero_009_01",isStatic:!0}),egret.setTimeout(function(){egret.Tween.get(e.gp_text).to({rotation:0,alpha:1},200).call(function(){e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.onViewTouch,e),e.btn_fanhui.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},e),e.nextStep()})},this,500)},n.prototype.onViewTouch=function(){var e=this;this.targetConfig&&20001==this.targetConfig.id?(this.visible=!1,o.AppFacade.getInstance().showSubView(o.PlayerMediator.N,o.PlayerMediator.SV.ROLE_NAME,{clickDarkClose:!1,closeCB:function(){e.visible=!0,e.nextStep()}})):this.nextStep()},n.prototype.nextStep=function(){var e=this;if(this.list_selection.visible=!1,this.TimeoutTimer.stop(),this.ContentTimer&&this.ContentTimer.running)this.showAll();else if(this.curIndex++,this.targetConfig=void 0,this.storyConfig&&this.storyConfig[this.curIndex]?(this.curType=n.TYPE.DIALOG,this.targetConfig=o.Config.storySubConfig()[this.storyConfig[this.curIndex]]):(this.curType=n.TYPE.QUESTION,this.curIndex=-1,this.targetConfig=this.questionConfig),this.lb_content.text="",this.lb_others.text="",this.targetConfig)if(0==this.curIndex&&null==this.isOtherSpeaking){var t=!!this.targetConfig.others;this.gp_content.visible=!t,this.lb_others.visible=t,this.isOtherSpeaking=t,this.curIndex=-1,this.nextStep()}else{if(this.targetContent=this.targetConfig.content||this.targetConfig.question,-1!=this.targetContent.indexOf("%s")&&(this.targetContent=this.targetContent.format([o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N).playerInfoVO.name])),!this.targetContent)return;var i=this.targetContent.length;this.targetLabel=1==this.targetConfig.others?this.lb_others:this.lb_content,1==this.targetConfig.others?(this.isOtherSpeaking||(this.gp_content.visible=!1,this.lb_others.visible=!0),this.isOtherSpeaking=!0):(this.isOtherSpeaking&&(this.lb_others.visible=!1,this.gp_content.visible=!0),this.curType==n.TYPE.DIALOG?(this.targetConfig.npcUrl,this.targetConfig.npcName,2==this.targetConfig.flipX?(this.gp_content.scaleX=-1,this.lb_npcName.scaleX=-1,this.lb_content.scaleX=-1,this.list_selection.scaleX=-1):(this.gp_content.scaleX=1,this.lb_npcName.scaleX=1,this.lb_content.scaleX=1,this.list_selection.scaleX=1)):(this.quoraConfig.model,this.questionConfig.title),this.isOtherSpeaking=!1),this.ContentTimer=new egret.Timer(this.talkSpeed,i),this.ContentTimer.addEventListener(egret.TimerEvent.TIMER,function(){e.ContentTimer&&(e.targetLabel.text=e.targetContent.slice(0,e.ContentTimer.currentCount))},this),this.ContentTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){e.showAll()},this),this.ContentTimer.start()}else this.onclose||(this.onclose=!0,this.onClose())},n.prototype.showAll=function(){this.ContentTimer.stop(),this.ContentTimer=void 0,this.targetLabel.text=this.targetContent,this.onAllContentShow()},n.prototype.onAllContentShow=function(){switch(this.curType){case n.TYPE.DIALOG:this.TimeoutTimer.reset();break;case n.TYPE.QUESTION:this.btn_fanhui.visible=!0,this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onViewTouch,this),this.hide()}},n.prototype.onClose=function(e){this.gp_content.visible=!1,this.hide(),this.cb&&this.cb(e)},n.TYPE={DIALOG:1,QUESTION:2},n.STORAGE_PREFIX="StoryView",n);function n(e){var t=i.call(this)||this;return t.curIndex=-1,t.talkSpeed=20,t.timeout=2e3,t.onclose=!1,t.skinName="StoryViewSkin",t.cb=e.cb,t.storyConfig=e.storyId&&JSON.parse(o.Config.storyConfig()[e.storyId].subs)||e.storyConfig,t.quoraConfig=e.quoraId&&o.Config.riskQuora()[e.quoraId],t.questionConfig=e.questionId&&o.Config.questionConfig()[e.questionId],t.position=e.position,t._popActionType=3,t._removeActionType=4,t}o.StoryView=e,__reflect(e.prototype,"game.StoryView");var a,t=(__extends(r,a=BasePanel),r.prototype.childrenCreated=function(){var e=this;a.prototype.childrenCreated.call(this),this.TimeoutTimer=new egret.Timer(this.timeout,1),this.TimeoutTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){e.nextStep()},this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onViewTouch,this),this.nextStep()},r.prototype.onViewTouch=function(){this.nextStep()},r.prototype.nextStep=function(){var e=this;if(this.TimeoutTimer.stop(),this.ContentTimer&&this.ContentTimer.running)this.showAll();else if(this.curIndex++,this.targetConfig=o.Config.storySubConfig()[this.storyConfig[this.curIndex]],this.lb_content.text="",this.targetConfig){if(this.targetContent=this.targetConfig.content||this.targetConfig.question,-1!=this.targetContent.indexOf("%s")&&(this.targetContent=this.targetContent.format([o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N).playerInfoVO.name])),!this.targetContent)return;var t=this.targetContent.length;2==this.targetConfig.flipX?this.img_bg.source="xinshou_img_juese_png":this.img_bg.source="xinshou_img_fuwan_png",this.ContentTimer=new egret.Timer(this.talkSpeed,t),this.ContentTimer.addEventListener(egret.TimerEvent.TIMER,function(){e.ContentTimer&&(e.lb_content.text=e.targetContent.slice(0,e.ContentTimer.currentCount))},this),this.ContentTimer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){e.showAll()},this),this.ContentTimer.start()}else this.onclose||(this.onclose=!0,this.onClose())},r.prototype.showAll=function(){this.ContentTimer.stop(),this.ContentTimer=void 0,this.lb_content.text=this.targetContent,this.onAllContentShow()},r.prototype.onAllContentShow=function(){this.TimeoutTimer.reset()},r.prototype.onClose=function(e){this.gp_content.visible=!1,this.hide(),this.cb&&this.cb(e)},r.TYPE={DIALOG:1,QUESTION:2},r.STORAGE_PREFIX="StoryView",r);function r(e){var t=a.call(this)||this;return t.curIndex=-1,t.talkSpeed=20,t.timeout=2e3,t.onclose=!1,t.skinName="StoryViewSkin2",t.cb=e.cb,t.storyConfig=e.storyId&&JSON.parse(o.Config.storyConfig()[e.storyId].subs)||e.storyConfig,t.quoraConfig=e.quoraId&&o.Config.riskQuora()[e.quoraId],t.questionConfig=e.questionId&&o.Config.questionConfig()[e.questionId],t.position=e.position,t._popActionType=3,t._removeActionType=4,t}o.StoryView2=t,__reflect(t.prototype,"game.StoryView2");var s,c=(__extends(l,s=BasePanel),l.prototype.childrenCreated=function(){var e=this;s.prototype.childrenCreated.call(this),this.gp_text.alpha=0,this.gp_text.rotation=-90,this.heroModel.update({model:"hero_009_01",isStatic:!0}),egret.setTimeout(function(){egret.Tween.get(e.gp_text).to({rotation:0,alpha:1},200).call(function(){e.update()})},this,500)},l.prototype.update=function(){this.lb_content.text=this.data.text},l);function l(e){var t=s.call(this)||this;return t.skinName="StoryViewForGuideSkin",t.data=e,t.storyConfig=e.storyId&&JSON.parse(o.Config.storyConfig()[e.storyId].subs)||e.storyConfig,t}o.StoryViewForGuide=c,__reflect(c.prototype,"game.StoryViewForGuide");var h,p=(h=eui.ItemRenderer,__extends(d,h),d.prototype.childrenCreated=function(){var i=this;this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(i.data.isFade)i.data.cb(parseInt(i.data.index)+1);else{var e=[];if(i.data.question.costs&&(e=JSON.parse(i.data.question.costs)[parseInt(i.data.index)]),e&&!o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N).checkEnough(e,!0))return void(i.currentState="up");if(i.data.cb&&i.data.cb(parseInt(i.data.index)+1),i.data.question.story){var t=JSON.parse(i.data.question.story);PopUpManager.addPopUp({obj:new o.StoryView({storyId:t[parseInt(i.data.index)+1-1],questionId:void 0,position:void 0,cb:function(){o.AppFacade.getInstance().retrieveProxy(o.GuajiPy.N).Answer(parseInt(i.data.index)+1,i.data.position)}})})}else o.AppFacade.getInstance().retrieveProxy(o.GuajiPy.N).Answer(parseInt(i.data.index)+1,i.data.position)}},this)},d.prototype.dataChanged=function(){this.lb_answer.text=this.data.answer},d);function d(){var e=h.call(this)||this;return e.skinName="GuajiQuoraAnswerItem",e}__reflect(p.prototype,"AnswerItem");var u,g=(u=eui.Component,__extends(f,u),f.prototype.childrenCreated=function(){u.prototype.childrenCreated.call(this),this.direction=this.data[0],this.lb_tips.text=this.data[1]},Object.defineProperty(f.prototype,"direction",{set:function(e){e<3&&(this.img_root.scaleY=-1,this.lb_tips.scaleY=-1),1!=e&&4!=e||(this.img_root.scaleX=-1,this.lb_tips.scaleX=-1)},enumerable:!0,configurable:!0}),f);function f(e){var t=u.call(this)||this;return t.skinName="TipsComponentSkin",t.data=e,t}o.TipsComponent=g,__reflect(g.prototype,"game.TipsComponent")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN_MAP,i.GuildMapView),this.addSubView(n.SV.CREATE_OR_APPLY,i.GuildCreateOrApplyView),this.addSubView(n.SV.MANAGER_VIEW,i.GuildManagerView),this.addSubView(n.SV.HAS_APPLY_VIEW,i.GuildSelfApplyListView),this.addSubView(n.SV.GUILD_APPLY_VIEW,i.GuildApplyListView),this.addSubView(n.SV.INFO,i.GuildInfoPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.GUILD_GUILD_RANKED_LIST_UPDATE,CN.GUILD_GUILD_MEMBER_LIST_UPDATE,CN.GUILD_GUILD_APPLY_LIST_UPDATE,CN.GUILD_INFO_UPDATE,CN.LOGIN_FINAL_DONE]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.LOGIN_FINAL_DONE:break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GUILD_GUILD_RANKED_LIST_UPDATE:this.updateView(n.SV.CREATE_OR_APPLY);break;case CN.GUILD_GUILD_APPLY_LIST_UPDATE:i.AppFacade.getInstance().updateView(n.N,n.SV.GUILD_APPLY_VIEW,this.proxy.applyList);break;case CN.GUILD_GUILD_MEMBER_LIST_UPDATE:i.AppFacade.getInstance().updateView(n.N,n.SV.MANAGER_VIEW);break;case CN.GUILD_INFO_UPDATE:500<=i.AppFacade.getInstance().retrieveProxy(i.PlayerPy.N).loginStatusVO.state&&this.getSubView(n.SV.CREATE_OR_APPLY)&&this.proxy.isInGuild()&&(this.hideSubView(n.SV.CREATE_OR_APPLY),this.showSubView(n.SV.MAIN_MAP)),this.getSubView(n.SV.MAIN_MAP)?this.proxy.isInGuild()?(this.updateView(n.SV.MANAGER_VIEW),this.updateView(n.SV.MAIN_MAP)):(Utils.MsgUtils.addMidMsg("你已经不在公会了"),this.hideAllSubView(),this.showSubView(n.SV.CREATE_OR_APPLY)):this.log("GUILD_INFO_UPDATE 还没进入主界面，不处理")}},n.prototype.onViewCreate=function(){},n.N="GuildMediator",n.SV={MAIN_MAP:1,CREATE_OR_APPLY:2,MANAGER_VIEW:3,HAS_APPLY_VIEW:5,GUILD_APPLY_VIEW:6,SHOP_VIEW:8,INFO:12},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.GuildPy.N),NoticeManager.setChildType(NT.GUILD_MANAGER,[NT.GUILD_SIGNIN,NT.GUILD_APPLY]),t}i.GuildMediator=e,__reflect(e.prototype,"game.GuildMediator")}(game=game||{}),function(o){var e=(t.registerAll=function(){(new n).register()},t);function t(){}o.GuildProcessor=e,__reflect(e.prototype,"game.GuildProcessor");var i,n=(i=o.ProcessorBase,__extends(a,i),a.prototype.execute=function(e){var t=e.getBody(),i=o.AppFacade.getInstance().retrieveProxy(o.GuildPy.N);t.updateType===EGuildUpdateType.Base?i.getPlayerGuildReq():t.updateType===EGuildUpdateType.Member?i.getMemberListReq():t.updateType===EGuildUpdateType.Apply&&i.getApplyListReq()},a);function a(){return i.call(this,"guild.GuildUpdateP",a)||this}o.GuildUpdateP=n,__reflect(n.prototype,"game.GuildUpdateP")}(game=game||{}),function(l){var t,e=(__extends(i,t=BaseProxy),i.prototype.addNotice=function(){NoticeManager.registerCB(NT.GUILD_SIGNIN,this.checkSignInNotice,this),NoticeManager.registerCB(NT.GUILD_APPLY,this.checkApplyListNotice,this)},i.prototype.decorateGuildRankedList=function(e){var t=this;this.allGuildRankedList.splice(0),e.forEach(function(e){t.allGuildRankedList.push(new l.GuildVO(e))}),this.sendNotification(CN.GUILD_GUILD_RANKED_LIST_UPDATE)},i.prototype.decorateInfo=function(e,t){e&&(this.playerProxy.playerGuildVO?this.playerProxy.playerGuildVO.update(e):this.playerProxy.playerGuildVO=new l.PlayerGuildVO(e)),t&&(this.guildDetail?this.guildDetail.update(t):this.guildDetail=new l.GuildDetailVO(t)),this.sendNotification(CN.GUILD_INFO_UPDATE),NoticeManager.updateNotice(NT.GUILD_SIGNIN),NoticeManager.updateNotice(NT.GUILD_APPLY)},i.prototype.fetchGuildList=function(e,t){var i=this;void 0===t&&(t=!1),t?Utils.Socket.send("guild","GetApplyGuild",{}).then(function(e){i.decorateGuildRankedList(e.guildList)}):e?Utils.Socket.send("guild","SearchGuild",{key:e}).then(function(e){i.decorateGuildRankedList(e.guildList),0==e.guildList.length&&Utils.MsgUtils.addMidMsg("找不到对应公会")}):Utils.Socket.send("guild","GetGuildList",{}).then(function(e){i.decorateGuildRankedList(e.guildList)})},i.prototype.getSelfApplyGuild=function(e){Utils.Socket.send("guild","GetApplyGuild",{}).then(function(e){l.AppFacade.getInstance().updateView(l.GuildMediator.N,l.GuildMediator.SV.HAS_APPLY_VIEW,e.guildList)})},i.prototype.GuildDevote=function(t){Utils.Socket.send("guild","GuildDevote",{}).then(function(e){t&&t(e)})},i.prototype.createGuildReq=function(e,t,i,o){var n=this;void 0===i&&(i="");var a=JSON.parse(l.Config.constConfig().CreateGuildCosts.constValue),r=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),s=(l.Config.VIPUpgradeConfig(),Number(a[0][2]));r.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeDiamond]<s?l.GameMgr.getInstance().showCommonTipsWin({commonTips:"很遗憾，您的钻石不足，购买失败",cb:!1,btnLabel:{cancel:"取消",sure:"前往充值"},clickCB:function(e){0===e.type||1===e.type&&l.MainJumpConfig.jumpTo(MODULE.VIP)}}):Utils.Socket.send("guild","CreateGuild",{name:e,avatar:t}).then(function(e){n.playerProxy.playerGuildVO?n.playerProxy.playerGuildVO.update(e.playerGuild):n.playerProxy.playerGuildVO=new l.PlayerGuildVO(e.playerGuild),e.guildDetail&&(n.guildDetail?n.guildDetail.update(e.guildDetail):n.guildDetail=new l.GuildDetailVO(e.guildDetail)),l.MainJumpConfig.jumpTo("GUILD"),""!=i&&n.SetNotice(i),NoticeManager.updateNotice(NT.GUILD_SIGNIN),o&&o()})},i.prototype.getPlayerGuildReq=function(t){var i=this;Utils.Socket.send("guild","GetPlayerGuild",{}).then(function(e){i.decorateInfo(e.playerGuild,e.guildDetail),!e.guildDetail&&i.guildDetail&&(i.guildDetail=void 0),i.isInGuild()?i.getMemberListReq():i.sendNotification(CN.GUILD_INFO_UPDATE),t&&t()})},i.prototype.getMemberListReq=function(o,n){var a=this;void 0===o&&(o=!0),Utils.Socket.send("guild","GetMemberList",{}).then(function(e){a.memberList.splice(0),e.memberList.forEach(function(e){a.memberList.push(new l.GuildMemberVO(e))}),a.memberList.sort(function(e,t){return 0==e.baseInfo.offlineTime&&0!=t.baseInfo.offlineTime?-1:0==t.baseInfo.offlineTime&&0!=e.baseInfo.offlineTime?1:e.position!=t.position?t.position-e.position:e.baseInfo.fightCap-t.baseInfo.fightCap});var t=0;for(var i in a.memberList)t+=a.memberList[i].baseInfo.fightCap;a.guildDetail.fightCap=t,o&&a.sendNotification(CN.GUILD_GUILD_MEMBER_LIST_UPDATE),n&&n()})},i.prototype.getApplyListReq=function(){var t=this;Utils.Socket.send("guild","GetApplyList",{}).then(function(e){t.applyList.splice(0),e.applyList.forEach(function(e){t.applyList.push(new l.ApplyVO(e))}),NoticeManager.updateNotice(NT.GUILD_APPLY),t.sendNotification(CN.GUILD_GUILD_APPLY_LIST_UPDATE)})},i.prototype.SetNotice=function(e){var t=this;l.GameMVC.mainPy.checkTextVaild(e,function(){Utils.Socket.send("guild","SetNotice",{notice:e}).then(function(e){t.decorateInfo(void 0,e.guildDetail),l.AppFacade.getInstance().updateView(l.GuildMediator.N,l.GuildMediator.SV.MANAGER_VIEW)})})},i.prototype.ChangeAvatar=function(e){var t=this;Utils.Socket.send("guild","ChangeAvatar",{avatar:e}).then(function(e){t.decorateInfo(void 0,e.guildDetail),l.AppFacade.getInstance().updateView(l.GuildMediator.N,l.GuildMediator.SV.MAIN_MAP)})},i.prototype.operationReq=function(a,r,s){var c=this;Utils.Socket.send("guild","GuildOperation",{operationType:a,id:r}).then(function(e){if(a===EGuildOperationType.AgreeJoin||a===EGuildOperationType.RejectJoin)for(var t=0,i=0,o=c.applyList;i<o.length;i++){if(o[i].baseInfo.playerId===r){c.applyList.splice(t,1);break}t++}if(a!==EGuildOperationType.AgreeAll&&a!==EGuildOperationType.RejectAll||c.applyList.splice(0),a!=EGuildOperationType.Join&&a!=EGuildOperationType.CancelJoin&&a!=EGuildOperationType.Quit&&a!=EGuildOperationType.CancelAll&&c.getMemberListReq(),c.decorateInfo(e.playerGuild,e.guildDetail),a==EGuildOperationType.Quit){var n=l.GameMVC.mainPy;n.noticesTag[EChatChannelType.EChatChannelTypeGuild]=!1,NoticeManager.updateNotice(n.channel_2_notice[EChatChannelType.EChatChannelTypeGuild],EChatChannelType.EChatChannelTypeGuild),l.GameMVC.playerPy.playerGuildVO.guildId=0,c.guildDetail=void 0}s&&s()})},i.prototype.getMemberById=function(e){for(var t=0,i=this.memberList;t<i.length;t++){var o=i[t];if(o.baseInfo.playerId===e)return o}},i.prototype.isInGuild=function(){return this.playerProxy.playerGuildVO&&this.playerProxy.playerGuildVO.guildId&&0!=this.playerProxy.playerGuildVO.guildId||!1},i.prototype.checkSignInNotice=function(){var e=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N);return this.isInGuild()&&e.playerGuildVO.devoteNum<1},i.prototype.checkApplyListNotice=function(){if(!this.isInGuild())return!1;var e=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N).playerGuildVO;return(e.position==EGuildPositionType.EGuildPositionTypePresident||e.position==EGuildPositionType.EGuildPositionTypeVicePresident)&&0<this.applyList.length},i.prototype.GetGuildBaseInfo=function(e,t){Utils.Socket.send("guild","GetGuildBaseInfo",{guildId:e}).then(function(e){t&&t(e.info)})},i.prototype.changeName=function(e,t){var i=this;Utils.Socket.send("guild","ChangeName",{name:e.name}).then(function(e){i.guildDetail.update(e.guildDetail),i.sendNotification(CN.GUILD_INFO_UPDATE),t&&t()}).catch(function(e){})},i.N="GuildProxy",i);function i(){var e=t.call(this,i.N)||this;return e.subwayNotice=!0,e.skillArr=[],e.skillNotice=!1,e.bountyProNotice=!1,e.bountyNotice=!1,e.devoteRedNotice=!1,e.allGuildRankedList=new Array,e.memberList=new Array,e.applyList=new Array,e.playerProxy=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),e.addNotice(),e}l.GuildPy=e,__reflect(e.prototype,"game.GuildPy")}(game=game||{}),function(i){var t,e=(__extends(o,t=BaseTab),o.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="推荐公会",this.proxy=i.AppFacade.getInstance().retrieveProxy(i.GuildPy.N),this.CommonDaTanChuKuang.img_close.visible=!1,this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_root.verticalScrollBar.visible=!1,this.sl_root.verticalScrollBar.autoVisibility=!1,this.btn_search.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),""===e.et_guildname.text?Utils.MsgUtils.addMidMsg("请输入公会名字"):e.proxy.fetchGuildList(e.et_guildname.text)},this),this.btn_build.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new i.GuildCreatePanel({})})},this),this.CommonDaTanChuKuang.onCloseCB=function(){i.MainJumpConfig.jumpTo()},this.btn_applyList.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.AppFacade.getInstance().showSubView(i.GuildMediator.N,i.GuildMediator.SV.HAS_APPLY_VIEW)},this),this.sl_root.verticalScrollBar.visible=!1,this.sl_root.verticalScrollBar.autoVisibility=!1,this.initList(),this.proxy.fetchGuildList(),this.gp_detail.scaleX=this.gp_detail.scaleY=1,UIActionManager.playUIAction(this.gp_detail,1)},o.prototype.initList=function(){this.lv_root=new eui.List;var e=new eui.VerticalLayout;e.horizontalAlign=egret.HorizontalAlign.CENTER,this.lv_root.layout=e,this.sl_root.viewport=this.lv_root,this.lv_root.itemRenderer=a,this.dataSource=new eui.ArrayCollection,this.lv_root.dataProvider=this.dataSource},o.prototype.updateView=function(){this.dataSource=new eui.ArrayCollection;var e=this.proxy.allGuildRankedList;this.lv_root.dataProvider=new eui.ArrayCollection(e)},o);function o(){var e=t.call(this)||this;return e.skinName="GuildCreateOrApplySkin",e}i.GuildCreateOrApplyView=e,__reflect(e.prototype,"game.GuildCreateOrApplyView");var n,a=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){var e=this;this.adapterComponent(),this.btn_go.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap);var e=i.AppFacade.getInstance().retrieveProxy(i.GuildPy.N);this.data.isApply?e.operationReq(EGuildOperationType.CancelJoin,this.data.id||this.data.guildId,function(){Utils.MsgUtils.addMidMsg("取消成功"),e.getSelfApplyGuild()}):e.operationReq(EGuildOperationType.Join,this.data.id||this.data.guildId,function(){Utils.MsgUtils.addMidMsg("申请成功"),e.fetchGuildList()}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)},this),this.img_icon.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.AppFacade.getInstance().showSubView(i.GuildMediator.N,i.GuildMediator.SV.INFO,e.data)},this)},r.prototype.adapterComponent=function(){this.lb_content.visible=!1,this.gp_content.visible=!0},r.prototype.dataChanged=function(){this.lb_info.text=this.data.guildName||this.data.name,this.lb_guildLv.text=""+this.data.level;var e=i.Config.guildLevelUpgradeConfig()[this.data.level];this.lb_memberCount.text=this.data.num+"/"+e.mLimit,this.img_icon.source=this.data.avatar,this.data.isApply?this.btn_go.labelDisplay.text="取消":this.btn_go.labelDisplay.text="申 请"},r);function r(){var e=n.call(this)||this;return e.skinName="CommonItemRenderLongSkin",e}__reflect(a.prototype,"GuildItemRender");var s,c=(__extends(l,s=BasePanel),l.prototype.childrenCreated=function(){var e=this;s.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="申请列表",this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.proxy.getSelfApplyGuild(),this.list_root.itemRenderer=a,this.btn_cancelAll.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.proxy.operationReq(EGuildOperationType.CancelAll,void 0,function(){e.updateView([])})},this)},l.prototype.updateView=function(e){if(e){for(var t in e)e[t].isApply=!0;this.lb_hasApply.text="申请信息 ： "+e.length,this.list_root.dataProvider=new eui.ArrayCollection(e),0==e.length?this.gp_information.visible=!0:this.gp_information.visible=!1,this.updateCount++}},l.prototype.onDestroy=function(){1<this.updateCount&&this.proxy.fetchGuildList()},l);function l(e){var t=s.call(this)||this;return t.updateCount=0,t.skinName="GuildApplyListViewSkin",t.proxy=i.AppFacade.getInstance().retrieveProxy(i.GuildPy.N),t}i.GuildSelfApplyListView=c,__reflect(c.prototype,"game.GuildSelfApplyListView")}(game=game||{}),function(i){var o,e=(__extends(t,o=BasePanel),t.prototype.childrenCreated=function(){var t=this;this.CommonXiaoTanChuKuang.blb_title.text="建立公会";var e=JSON.parse(i.Config.constConfig().CreateGuildCosts.constValue)[0];this.CommonIconWithNum_cost.updateItem({cost:e,style:CommonIconStyle.RIGHT}),this.btn_build.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(""!=t.et_guildName.text){var e=JSON.parse(i.Config.constConfig().CreateGuildCosts.constValue);i.AppFacade.getInstance().retrieveProxy(i.BackpackPy.N).checkEnough(e,!0)?t.proxy.createGuildReq(t.et_guildName.text,t.img_avatar.source,t.et_announcement.text,function(){t.hide(),i.AppFacade.getInstance().hideSubView(i.GuildMediator.N,i.GuildMediator.SV.CREATE_OR_APPLY)}):Utils.MsgUtils.addMidMsg("钻石不足")}else Utils.MsgUtils.addMidMsg("请输入公会名称")},this),this.btn_choseAvatar.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new a({clickCB:function(e){t.img_avatar.source=e}})})},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this)},t);function t(e){var t=o.call(this)||this;return t.skinName="GuildCreatePanelSkin",t.proxy=i.AppFacade.getInstance().retrieveProxy(i.GuildPy.N),t.clickCB=e.clickCB,t}i.GuildCreatePanel=e,__reflect(e.prototype,"game.GuildCreatePanel");var n,a=(__extends(r,n=BasePanel),r.prototype.childrenCreated=function(){var i=this;UIActionManager.hideScrollerBar(this.sl_root),GUILD_AVATAR_RES.forEach(function(e){var t=new eui.Image(e);t.scaleX=t.scaleY=.8,t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.clickCB&&i.clickCB(e),i.hide()},i),i.gp_content.addChild(t)})},r);function r(e){var t=n.call(this)||this;return t.skinName="GuildAvatarChoseViewSkin",t.proxy=i.AppFacade.getInstance().retrieveProxy(i.GuildPy.N),t.clickCB=e.clickCB,t}i.GuildAvatarChoseView=a,__reflect(a.prototype,"game.GuildAvatarChoseView")}(game=game||{}),function(e){var t,i=(__extends(o,t=BasePanel),o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},o.prototype.updateView=function(e){var t=e;this.lb_name.text=t.name,this.fightItem.update(t.fightCap);var i=customui.GuildHeadFactory.create();i.updateData({vo:t}),this.gp_guildHead.addChild(i),this.lb_presidentName.text=t.presidentName,this.lb_num.text=t.num.toString(),this.lb_oath.text=t.notice},o);function o(){var e=t.call(this)||this;return e.skinName="GuildInfoPanelSkin",e}e.GuildInfoPanel=i,__reflect(i.prototype,"game.GuildInfoPanel")}(game=game||{}),function(d){var t,e=(__extends(i,t=BasePanel),i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this)},i.prototype.childrenCreated=function(){var a=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_head),this.CommonDaTanChuKuang.blb_title.text="公会大厅",this.CommonDaTanChuKuang.onCloseCB=function(){a.hide()},this.sl_member.verticalScrollBar.visible=!1,this.sl_member.verticalScrollBar.autoVisibility=!1,this.img_quit.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=new Array;e.push({text:"（退会不影响个人贡献值）",style:{size:24}}),e.push({text:"\n1.退会将清空您在本公会的历史贡献",style:{size:24}}),e.push({text:"\n2.退会后1小时内无法加入",style:{size:24}}),e.push({text:"\n3.退会后若公会无剩余成员将会解散",style:{size:24}}),d.GameMgr.getInstance().showCommonTipsWin({commonTips:e,clickCB:function(e){1===e.type&&a.proxy.operationReq(EGuildOperationType.Quit,void 0,function(){d.MainJumpConfig.jumpTo("GUAJI")})}})},this),this.playProxy.playerGuildVO.position===EGuildPositionType.EGuildPositionTypeVicePresident||this.playProxy.playerGuildVO.position===EGuildPositionType.EGuildPositionTypePresident?(this.btn_modify.visible=!0,this.btn_name.visible=!0,this.img_applyList.visible=!0,this.img_invite.visible=!0,Utils.SDKMgr.getPerformConfig(47)?this.btn_modify.visible=!1:this.btn_modify.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),Utils.SDKMgr.getPerformConfig(24)?PopUpManager.addPopUp({obj:new d.GuildModifyChooseView}):PopUpManager.addPopUp({obj:new d.GuildModifyView})},this),Utils.SDKMgr.getPerformConfig(46)?this.btn_name.visible=!1:this.btn_name.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),PopUpManager.addPopUp({obj:new d.GuildModifyName})},this),this.img_applyList.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.proxy.getApplyListReq(),d.AppFacade.getInstance().showSubView(d.GuildMediator.N,d.GuildMediator.SV.GUILD_APPLY_VIEW,a.proxy.applyList)},this)):(this.btn_modify.visible=!1,this.btn_name.visible=!1,this.img_applyList.visible=!1,this.img_invite.visible=!1),this.img_devote.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1<=d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N).playerGuildVO.devoteNum?Utils.MsgUtils.addMidMsg("已签到"):a.proxy.GuildDevote(function(t){a.proxy.decorateInfo(t.playerGuild,t.guildDetail),d.AppFacade.getInstance().updateView(d.GuildMediator.N,d.GuildMediator.SV.MANAGER_VIEW);try{DragonBoneTools.playOnce({effectName:"common_gonghuiqiandao_1",parent:a.img_devote,x:a.img_devote.width/2,y:a.img_devote.height/2,scaleX:1.25,scaleY:1.25,doneCB:function(){DragonBoneTools.playOnce({effectName:"common_gonghuiqiandao_2",x:55,y:a.gp_head.height/2,parent:a.gp_head,doneCB:function(){d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N).handleClientReward(t.clientReward,1)}})}})}catch(e){t.err||(a.proxy.decorateInfo(t.playerGuild,t.guildDetail),d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N).handleClientReward(t.clientReward,1),d.AppFacade.getInstance().updateView(d.GuildMediator.N,d.GuildMediator.SV.MANAGER_VIEW))}})},this),this.img_invite.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=Utils.LocalStorageUtil.getItem("GuildInviteTime"),t=0;e&&(t=parseInt(e));var i=Utils.TimerManager.getServerTime(),o=parseInt(d.Config.constConfig().GuildInviteCD.constValue);if(t+o<=i){var n=[[2,a.proxy.guildDetail.name,a.proxy.guildDetail.guildId,EEntityType.EEntityTypeGuild],[1,">>申请加入",a.proxy.guildDetail.guildId,MODULE.GuildHall]];d.AppFacade.getInstance().retrieveProxy(d.MainPy.N).SendMessage(EChatChannelType.SameServer,"%s公会诚意邀请你的加入!%s",0,function(){Utils.MsgUtils.addMidMsg("发送成功"),Utils.LocalStorageUtil.setItem("GuildInviteTime",i.toString()),a.updateView()},EChatSendCheckType.None,JSON.stringify(n))}else Utils.MsgUtils.addMidMsg("邀请信息每"+o/60+"分钟可发送一次，暂时无法发送")},this),this.initList(),this.updateView(),this.addNotice()},i.prototype.initList=function(){this.list_member.itemRenderer=n},i.prototype.updateView=function(){var t=this;if(this.updateMemberView(),this.playProxy.playerGuildVO.position===EGuildPositionType.EGuildPositionTypeVicePresident||this.playProxy.playerGuildVO.position===EGuildPositionType.EGuildPositionTypePresident?(this.btn_modify.visible=!0,this.img_applyList.visible=!0,this.img_invite.visible=!0):(this.btn_modify.visible=!1,this.img_applyList.visible=!1,this.img_invite.visible=!1),this.lb_notice.text=this.proxy.guildDetail.notice&&""!=this.proxy.guildDetail.notice?this.proxy.guildDetail.notice:"这个人很懒，什么都没留下。",1<=this.playProxy.playerGuildVO.devoteNum){if(UIActionManager.setAbsGrey(this.img_devote,!0),!this.timerDevote){var e=Utils.TimerManager.getServerTime(),i=new Date(1e3*e);i.setHours(23,59,59);var o=i.getTime()/1e3;this.lb_nextDevote.text=Utils.TimerManager.getFormatBySecond1(o-e),this.timerDevote=egret.setInterval(function(){var e=Utils.TimerManager.getServerTime();t.lb_nextDevote.text=Utils.TimerManager.getFormatBySecond1(o-e)},this,1e3)}}else this.lb_nextDevote.text="",UIActionManager.setAbsGrey(this.img_devote,!1);var n=Utils.LocalStorageUtil.getItem("GuildInviteTime"),a=0;n&&(a=parseInt(n));var r=Utils.TimerManager.getServerTime(),s=parseInt(d.Config.constConfig().GuildInviteCD.constValue);if(a+s<=r)this.lb_nextInvite.text="",UIActionManager.setAbsGrey(this.img_invite,!1);else{UIActionManager.setAbsGrey(this.img_invite,!0),egret.clearInterval(this.timerInvite);var c=a+s-r;this.lb_nextInvite.text=Utils.TimerManager.getFormatBySecond1(c),this.timerInvite=egret.setInterval(function(){--c<0?t.updateView():t.lb_nextInvite.text=Utils.TimerManager.getFormatBySecond1(c)},this,1e3)}var l=this.proxy.memberList.length,h=this.proxy.guildDetail,p=d.Config.guildLevelUpgradeConfig()[h.level];this.bm_online.text=l+"/"+p.mLimit,this.updateInfoView()},i.prototype.updateInfoView=function(){var t=this;if(this.proxy.isInGuild()){var e=this.proxy.guildDetail,i=d.Config.guildLevelUpgradeConfig()[e.level];this.lb_name.text=e.name,this.lb_num.text=e.num+"/"+i.mLimit,this.lb_lv.text=""+(e.level&&e.level.toString()),this.pb_exp.minimum=0,this.pb_exp.maximum=i.exp,this.pb_exp.value=e.exp,RES.getResAsync(e.avatar,function(e){t.img_avatar.texture=e},this);var o=[1,4,0],n=d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N).getInfoByTypeCodeNum(o[0],o[1]);this.lb_ghb.text=Utils.MathUtils.formatNumStyle1(n.haveNum),this.bitmap_power.text=Utils.MathUtils.formatNumStyle2(this.proxy.guildDetail.fightCap)}},i.prototype.updateMemberView=function(){this.proxy.memberList&&(this.list_member.dataProvider=new eui.ArrayCollection(this.proxy.memberList))},i.prototype.perClose=function(){this.removeNotice()},i.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.GUILD_APPLY,this.img_applyList.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.GUILD_SIGNIN,this.img_devote.getChildAt(0),this,BTN_ICON_NOTICE_POS)},i.prototype.removeNotice=function(){NoticeManager.removeNoticeListener(NT.GUILD_APPLY),NoticeManager.removeNoticeListener(NT.GUILD_SIGNIN)},i);function i(){var e=t.call(this)||this;return e.playProxy=d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N),e.skinName="GuildManagerSkin",e.proxy=d.AppFacade.getInstance().retrieveProxy(d.GuildPy.N),e}d.GuildManagerView=e,__reflect(e.prototype,"game.GuildManagerView");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){var i=this;this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.data.baseInfo.playerId!=i.playProxy.playerInfoVO.playerId&&d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N).GetPublicPlayerInfo([i.data.baseInfo.playerId],function(e,t){e[0].position=i.data.position,PopUpManager.addPopUp({obj:new d.GuildPlayerInfoPanel(e[0])})})},this)},a.prototype.dataChanged=function(){this.lb_name.text=this.data.baseInfo.name,0===this.data.baseInfo.offlineTime?this.lb_offlineTime.text=Utils.TimerManager.getTimeLeftDescBySecond(0):this.data.baseInfo.offlineTime?this.lb_offlineTime.text=Utils.TimerManager.getTimeLeftDescBySecond(Utils.TimerManager.getServerTime()-this.data.baseInfo.offlineTime):this.lb_offlineTime.text="在线",this.cu_ph.updateData({vo:this.data.baseInfo}),this.data.position===EGuildPositionType.EGuildPositionTypeVicePresident?this.lb_position.text="副会长":this.data.position===EGuildPositionType.EGuildPositionTypePresident?this.lb_position.text="会长":this.lb_position.text="成员"},a);function a(){var e=o.call(this)||this;return e.playProxy=d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N),e.skinName="MemberItemRenderSkin",e}__reflect(n.prototype,"MemberItemRender");var r,s=(__extends(c,r=BasePanel),c.prototype.childrenCreated=function(){var e=this;r.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="申请列表",this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.btn_cancelAll.label="删除所有",this.list_root.itemRenderer=h,this.btn_cancelAll.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.proxy.operationReq(EGuildOperationType.RejectAll,void 0,function(){d.AppFacade.getInstance().updateView(d.GuildMediator.N,d.GuildMediator.SV.GUILD_APPLY_VIEW,e.proxy.applyList)})},this)},c.prototype.updateView=function(e){for(var t in e=e||this.proxy.applyList)e[t].isApply=!0;this.lb_hasApply.text="收到的请求 ： "+(e.length||0),this.list_root.dataProvider=new eui.ArrayCollection(e),e.length?this.gp_information.visible=!1:this.gp_information.visible=!0,this.updateCount++},c.prototype.onDestroy=function(){1<this.updateCount&&d.AppFacade.getInstance().updateView(d.GuildMediator.N,d.GuildMediator.SV.MANAGER_VIEW)},c);function c(e){var t=r.call(this)||this;return t.updateCount=0,t.skinName="GuildApplyListViewSkin",t.proxy=d.AppFacade.getInstance().retrieveProxy(d.GuildPy.N),t}d.GuildApplyListView=s,__reflect(s.prototype,"game.GuildApplyListView");var l,h=(l=eui.ItemRenderer,__extends(p,l),p.prototype.childrenCreated=function(){var t=this;this.btn_apply.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=d.AppFacade.getInstance().retrieveProxy(d.GuildPy.N);e.operationReq(EGuildOperationType.AgreeJoin,t.data.baseInfo.playerId,function(){d.AppFacade.getInstance().updateView(d.GuildMediator.N,d.GuildMediator.SV.GUILD_APPLY_VIEW,e.applyList)})},this),this.cu_ph.addTapEvent(function(){d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N),d.AppFacade.getInstance().showSubView(d.FriendMediator.N,d.FriendMediator.SV.INFO,{playerId:t.data.baseInfo.playerId})})},p.prototype.dataChanged=function(){this.lb_name.text=this.data.baseInfo.name,this.CommonFightCap.update(this.data.baseInfo.fightCap),0===this.data.baseInfo.offlineTime?this.lb_offlineTime.text=Utils.TimerManager.getTimeLeftDescBySecond(0):this.data.baseInfo.offlineTime?this.lb_offlineTime.text=Utils.TimerManager.getTimeLeftDescBySecond(Utils.TimerManager.getServerTime()-this.data.baseInfo.offlineTime):this.lb_offlineTime.text="在线",this.cu_ph.updateData({vo:this.data.baseInfo})},p);function p(){var e=l.call(this)||this;return e.skinName="GuildApplyItemRenderSkin",e}__reflect(h.prototype,"ApplyItemRender")}(game=game||{}),function(a){var t,e=(__extends(i,t=BaseView),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_head),this.ShopPy=a.AppFacade.getInstance().retrieveProxy(a.ShopPy.N),this.proxy=a.AppFacade.getInstance().retrieveProxy(a.GuildPy.N),this.proxy.getApplyListReq(),this.proxy.getMemberListReq(!0,function(){e.initView(),e.updateInfoView()}),this.gp_head.visible=!1,this.once(egret.Event.ENTER_FRAME,function(){e.gp_head.visible=!0,UIActionManager.playUIAction(e.gp_head,5)},this),this.img_avatar.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N);e.playerGuildVO.position!=EGuildPositionType.EGuildPositionTypePresident&&e.playerGuildVO.position!=EGuildPositionType.EGuildPositionTypeVicePresident||PopUpManager.addPopUp({obj:new a.GuildAvatarChoseView({clickCB:function(e){a.AppFacade.getInstance().retrieveProxy(a.GuildPy.N).ChangeAvatar(e)}})})},this)},i.prototype.updateView=function(){this.updateInfoView(),this.updateNotice()},i.prototype.updateDragonBone=function(){},i.prototype.updateInfoView=function(){var t=this;if(this.proxy.isInGuild()){var e=this.proxy.guildDetail,i=a.Config.guildLevelUpgradeConfig()[e.level];this.lb_name.text=e.name,this.lb_num.text=e.num+"/"+i.mLimit,this.lb_lv.text=""+(e.level&&e.level.toString()),this.pb_exp.minimum=0,this.pb_exp.maximum=i.exp,this.pb_exp.value=e.exp,RES.getResAsync(e.avatar,function(e){t.img_avatar.texture=e},this);var o=[1,4,0],n=a.AppFacade.getInstance().retrieveProxy(a.BackpackPy.N).getInfoByTypeCodeNum(o[0],o[1]);this.lb_ghb.text=Utils.MathUtils.formatNumStyle1(n.haveNum),this.bitmap_power.text=Utils.MathUtils.formatNumStyle2(this.proxy.guildDetail.fightCap)}},i.prototype.initView=function(){this.initConfig(),this.initButton(),this.pb_exp.slideDuration=0},i.prototype.initConfig=function(){this.config=[{item:this.gp_guild_hall,name:"公会大厅",noticeType:NT.GUILD_MANAGER,noticePos:{percentX:240/347,percentY:170/248},cb:function(){Utils.UnlockMgr.checkPass(MODULE.GuildHall).allow&&a.AppFacade.getInstance().showSubView(a.GuildMediator.N,a.GuildMediator.SV.MANAGER_VIEW)},effect:"gonghui_bg_ghdt",effectPos:{offectX:0,offectY:30}},{item:this.gp_skill,name:"科技中心",module:MODULE.GuildSkill,noticePos:{percentX:240/217,percentY:170/281},cb:function(){a.MainJumpConfig.jumpTo(MODULE.GuildSkill)},effect:"gonghui_bg_kjzx",effectPos:{offectX:0,offectY:95}},{item:this.gp_collect,gp_effect:this.gp_collect0,name:"公会采集",noticeType:NT.FARM_SELF_ENTRANCE,module:MODULE.GuildCollect,noticePos:{percentX:.8,percentY:250/300},cb:function(){Utils.UnlockMgr.checkPass(MODULE.TopFarm).allow&&(a.GameMVC.guildFarmPy.GetTopFarmInfo(void 0,function(){a.AppFacade.getInstance().showSubView(a.GuildFarmMediator.N,a.GuildFarmMediator.SV.MAIN)}),a.GameMVC.guildFarmPy.GetTopFarmResearchInfo())},effect:"gonghui_bg_ghcj",effectPos:{offectX:0,offectY:70}},{item:this.gp_store,noticeType:NT.COMMON_SHOP[ShopType.ShopTypeGuild],noticePos:{percentX:200/307,percentY:190/252},module:MODULE.GuildShop,name:"商店",cb:function(){a.MainJumpConfig.jumpTo(MODULE.GuildShop)},effect:"gonghui_bg_ghsd",effectPos:{offectX:0,offectY:45}},{item:this.gp_challenge,name:"公会boss",noticeType:NT.GUILD_BOSS,cb:function(){a.MainJumpConfig.jumpTo(MODULE.GuildBoss)},module:MODULE.GuildBoss,noticePos:{percentX:200/303,percentY:180/277},effect:"gonghui_bg_ghbs",effectPos:{offectX:0,offectY:40}},{item:this.gp_copy,name:"公会副本",cb:function(){Utils.UnlockMgr.checkPass(MODULE.GuildTranscript).allow&&(a.AppFacade.getInstance().retrieveProxy(a.GuildInstancePy.N).GetGuildFortressInfo(),a.MainJumpConfig.jumpTo(MODULE.GuildTranscript))},noticeType:NT.GUILD_INSTANCE,module:MODULE.GuildTranscript,noticePos:{percentX:185/226,percentY:145/191},effect:"gonghui_bg_ghfb",effectPos:{offectX:0,offectY:30}},{item:this.gp_war,name:"公会战",cb:function(){a.MainJumpConfig.jumpTo(MODULE.GuildWar)},module:MODULE.GuildWar,noticeType:NT.GUILD_WAR,noticePos:{percentX:155/202,percentY:115/192},effect:"gonghui_bg_ghz",effectPos:{offectX:0,offectY:0}},{item:this.gp_tribeBattle,name:"部落争霸",cb:function(){a.MainJumpConfig.jumpTo(MODULE.TribeBattle)},module:MODULE.TribeBattle,noticeType:NT.GUILD_TRIBE_BATTLE,noticePos:{percentX:150/172,percentY:.8},effect:void 0,effectPos:{offectX:0,offectY:0}}]},i.prototype.initButton=function(){var e=this;this.config.forEach(function(t){t.item.addEventListener(egret.TouchEvent.TOUCH_TAP,t.cb,e),t.effect&&DragonBoneTools.create(t.effect,function(e){t.gp_effect?(e.x=t.gp_effect.width/2+(t.effectPos&&t.effectPos.offectX||0),e.y=t.gp_effect.height/2+(t.effectPos&&t.effectPos.offectY||0),t.gp_effect.addChild&&t.gp_effect.addChildAt(e,0)):(e.x=t.item.width/2+(t.effectPos&&t.effectPos.offectX||0),e.y=t.item.height/2+(t.effectPos&&t.effectPos.offectY||0),t.item.addChild&&t.item.addChildAt(e,0)),e.animation.play()},e),null!=t.noticeType&&(t.module?Utils.UnlockMgr.checkPass(t.module,!1).allow&&(NoticeManager.removeNoticeListener(t.noticeType),NoticeManager.addNoticeListener(t.noticeType,t.item.getChildAt(0),e,t.noticePos)):(NoticeManager.removeNoticeListener(t.noticeType),t.item&&NoticeManager.addNoticeListener(t.noticeType,t.item.getChildAt(0),e,t.noticePos)))})},i);function i(){var e=t.call(this)||this;return e.skinName="GuildMapSkin",e}a.GuildMapView=e,__reflect(e.prototype,"game.GuildMapView")}(game=game||{}),function(r){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.proxy=r.AppFacade.getInstance().retrieveProxy(r.GuildPy.N),this.et_notice.text=this.proxy.guildDetail.notice,this.CommonXiaoTanChuKuang.blb_title.text="修改公告",this.btn_save.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),50<e.et_notice.text.length?Utils.MsgUtils.addMidMsg("公告最多50字"):(e.proxy.SetNotice(e.et_notice.text),e.hide())},this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},i.prototype.initLimitNotice=function(){},i);function i(){var e=t.call(this)||this;return e.skinName="GuildModifyViewSkin",e}r.GuildModifyView=e,__reflect(e.prototype,"game.GuildModifyView");var o,n=(__extends(a,o=BasePanel),a.prototype.childrenCreated=function(){var t=this;o.prototype.childrenCreated.call(this),this.cu_ctc.blb_title.text="公会改名",this.btn_comform.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=r.Config.constConfig();Number(e.GuildModifyNameDt.constValue),t.py.guildDetail.lModifyDt,Utils.TimerManager.getServerTime(),t.ed_input.text&&""!=t.ed_input.text?r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N).checkEnough([t.costInfo.costs],!1)?t.py.changeName({name:t.ed_input.text},function(){PopUpManager.removePopUp(t),Utils.MsgUtils.addMidMsg("名字修改成功！")}):Utils.MsgUtils.addMidMsg("你的"+t.costInfo.info.name+"不足"):Utils.MsgUtils.addMidMsg("请输入名字")},this),this.initView()},a.prototype.initView=function(){var e=r.Config.constConfig().ModiyGuildNameCosts,t=JSON.parse(e.constValue),i=r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N),o=t[0][0];r.GameMVC.backpackPy.checkEnough([o],!1)||(o=t[1][0]);var n=i.getInfoByCode(o[1]);this.costInfo={costs:o,info:n.info};var a=n.info.icon;this.img_diamonds.source=a+"_png",this.lb_cost.text="x"+o[2]},a);function a(){var e=o.call(this)||this;return e.py=r.AppFacade.getInstance().retrieveProxy(r.GuildPy.N),e.skinName="GuildModifyNameSkin",e}r.GuildModifyName=n,__reflect(n.prototype,"game.GuildModifyName");var s,c=(__extends(l,s=BasePanel),l.prototype.childrenCreated=function(){var e=this;s.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="修改公告",this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()};var t=[];for(var i in GUILD_POST_INFO){var o={info:GUILD_POST_INFO[i],hideCB:this.hide.bind(this)};t.push(o)}this.list_info.itemRenderer=p,this.list_info.dataProvider=new eui.ArrayCollection(t)},l);function l(){var e=s.call(this)||this;return e.skinName="GuildModifyChooseViewSkin",e}r.GuildModifyChooseView=c,__reflect(c.prototype,"game.GuildModifyChooseView");var h,p=(h=eui.ItemRenderer,__extends(d,h),d.prototype.childrenCreated=function(){var e=this;h.prototype.childrenCreated.call(this),this.proxy=r.AppFacade.getInstance().retrieveProxy(r.GuildPy.N),this.gp_choose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),50<e.lb_info.text.length?Utils.MsgUtils.addMidMsg("公告最多50字"):(e.proxy.SetNotice(e.lb_info.text),e.data&&e.data.hideCB&&e.data.hideCB())},this)},d.prototype.dataChanged=function(){var e=this.data;this.lb_info.text=e.info},d);function d(){var e=h.call(this)||this;return e.skinName="GuildModifyChooseOneSkin",e}__reflect(p.prototype,"GuildModifyChooseOne")}(game=game||{}),function(n){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){var t=this;if(i.prototype.childrenCreated.call(this),this.playerInfo=this.proxy.getMemberById(this.playerId),!this.playerInfo)return Utils.MsgUtils.addMidMsg("找不到该玩家信息"),void this.hide();this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.lb_name.text=this.playerInfo.baseInfo.name,this.blb_level.text=""+this.playerInfo.baseInfo.level,this.lb_wDevote.text="周贡献："+this.playerInfo.wDevote,this.lb_dDevote.text="日贡献："+this.playerInfo.dDevote,this.lb_id.text="ID:"+this.playerInfo.baseInfo.playerId,RES.getResAsync(ResourceUtils.png(this.playerInfo.baseInfo.avatar),function(e){t.img_avatar.source=e},this),this.initBtn()},t.prototype.initBtn=function(){var i=this,e=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N).playerGuildVO.position,t=this.playerInfo.position,o=[{name:"踢出",img:"_common2_m_json.guild_btn_tichu",cb:function(){var e=new Array;e.push({text:"确定将",style:{textColor:16777215,size:29}}),e.push({text:" "+i.playerName+" ",style:{textColor:16711680,size:29}}),e.push({text:"踢出公会吗？",style:{textColor:16777215,size:29}}),e.push({text:"\n\n（被踢出公会玩家保留贡献）",style:{textColor:16777215,size:29}}),n.GameMgr.getInstance().showCommonTipsWin({commonTips:e,clickCB:function(e){1===e.type&&(i.proxy.operationReq(EGuildOperationType.TickOut,i.playerId),i.hide())}})}}];e===EGuildPositionType.EGuildPositionTypePresident&&(o.unshift({name:"转让公会",img:"guild_btn_zhuanranggonghui_png",cb:function(){var e=new Array;e.push({text:"确定将公会转让给",style:{textColor:16777215,size:29}}),e.push({text:" "+i.playerName+" ",style:{textColor:16711680,size:29}}),e.push({text:"吗？",style:{textColor:16777215,size:29}}),e.push({text:"\n\n（转让后会长自动降职为会员）",style:{textColor:16777215,size:29}}),n.GameMgr.getInstance().showCommonTipsWin({commonTips:e,clickCB:function(e){1===e.type&&(i.proxy.operationReq(EGuildOperationType.Transfer,i.playerId),i.hide())}})}}),t===EGuildPositionType.EGuildPositionTypeVicePresident?o.unshift({name:"解除副会长",img:"_common2_m_json.guild_btn_jiechufuhui",cb:function(){i.proxy.operationReq(EGuildOperationType.RelieveVice,i.playerId),i.hide()}}):o.unshift({name:"任命副会长",img:"_common2_m_json.guild_btn_renmingfuhui",cb:function(){i.proxy.operationReq(EGuildOperationType.AppointVice,i.playerId),i.hide()}})),o.forEach(function(e){var t=new eui.Image;RES.getResAsync(e.img,function(e){t.source=e},i),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),e.cb()},i),i.gp_btns.addChild(t)})},t);function t(e){var t=i.call(this)||this;return t.skinName="GuildOperPanelSkin",t.proxy=n.AppFacade.getInstance().retrieveProxy(n.GuildPy.N),t.clickCB=e.clickCB,t.playerId=e.playerId,t.playerName=e.playerName,t}n.GuildOperPanel=e,__reflect(e.prototype,"game.GuildOperPanel")}(game=game||{}),function(c){var o,e=(__extends(t,o=BasePanel),t.prototype.childrenCreated=function(){var t=this,i=this.params.publicPlayer;this.lb_name.text=i.baseInfo.name,this.lb_id.text="ID "+i.baseInfo.playerId,this.CommonFightCap.update(i.baseInfo.fightCap),this.gp_btn.visible=this.show_bnt,this.cu_ph.updateData({vo:i.baseInfo}),this.lb_guild.textFlow=[{text:"公会：",style:{textColor:15913814}},{text:""+(i.baseInfo.guild&&i.baseInfo.guild.name||"无"),style:{textColor:16775908}}];var e=0;for(var o in i.heroList){var n,a=i.heroList[o];(n=new customui.BaseItem).x=80*e,n.scaleY=n.scaleX=.65,e++,n.updateData(a),this.gp_hero.addChild(n)}i.petList&&0<i.petList.length&&((n=new customui.BaseItem).x=80*e+15,n.scaleY=n.scaleX=.65,e++,i.petList[0].type=EEntityType.EEntityTypePet,n.updateData(i.petList[0]),this.gp_hero.addChild(n));var r=c.AppFacade.getInstance().retrieveProxy(c.GuildPy.N);this.btn_kick.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.GameMgr.getInstance().showCommonTipsWin({commonTips:[{text:"确认将 ",style:{textColor:11041365}},{text:""+t.params.publicPlayer.baseInfo.name,style:{textColor:4557956}},{text:" 踢出公会吗\n（被踢出公会玩家保留贡献）",style:{textColor:11041365}}],cb:!1,btnLabel:{cancel:"取消",sure:"确定"},clickCB:function(e){0===e.type||1===e.type&&(r.operationReq(EGuildOperationType.TickOut,i.baseInfo.playerId,function(){c.AppFacade.getInstance().updateView(c.GuildMediator.N,c.GuildMediator.SV.MANAGER_VIEW)}),t.hide())}})},this),this.btn_appoint.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.params.position==EGuildPositionType.EGuildPositionTypeVicePresident?r.operationReq(EGuildOperationType.RelieveVice,i.baseInfo.playerId,function(){c.AppFacade.getInstance().updateView(c.GuildMediator.N,c.GuildMediator.SV.MANAGER_VIEW)}):r.operationReq(EGuildOperationType.AppointVice,i.baseInfo.playerId,function(){c.AppFacade.getInstance().updateView(c.GuildMediator.N,c.GuildMediator.SV.MANAGER_VIEW)}),t.hide()},this),this.btn_transfer.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.GameMgr.getInstance().showCommonTipsWin({commonTips:[{text:"确认将公会转让给 ",style:{textColor:11041365}},{text:""+t.params.publicPlayer.baseInfo.name,style:{textColor:4557956}},{text:" 吗\n（转让后会长自动降职为副会长）",style:{textColor:11041365}}],cb:!1,btnLabel:{cancel:"取消",sure:"确定"},clickCB:function(e){0===e.type||1===e.type&&(r.operationReq(EGuildOperationType.Transfer,i.baseInfo.playerId,function(){c.AppFacade.getInstance().updateView(c.GuildMediator.N,c.GuildMediator.SV.MANAGER_VIEW)}),t.hide())}})},this);var s=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N).playerGuildVO.position;s==EGuildPositionType.EGuildPositionTypePresident?this.img_bg.height=400:s==EGuildPositionType.EGuildPositionTypeVicePresident?(this.btn_appoint.parent.removeChild(this.btn_appoint),this.btn_transfer.parent.removeChild(this.btn_transfer),this.img_bg.height=400):(this.btn_appoint.parent.removeChild(this.btn_appoint),this.btn_transfer.parent.removeChild(this.btn_transfer),this.btn_kick.parent.removeChild(this.btn_kick),this.img_bg.height=336),this.params.position==EGuildPositionType.EGuildPositionTypeVicePresident?this.btn_appoint.label="解除副会":this.btn_appoint.label="任命副会",this.img_addFriend.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().retrieveProxy(c.FriendPy.N).addFriend({friendId:t.params.publicPlayer.baseInfo.playerId})},this)},t);function t(e,t){void 0===t&&(t=!0);var i=o.call(this)||this;return i.params=e,i.show_bnt=t,i.skinName="GuildPlayerInfoPanelSkin",i}c.GuildPlayerInfoPanel=e,__reflect(e.prototype,"game.GuildPlayerInfoPanel")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.GuildBossMainView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.GUILD_INFO_UPDATE,CN.GUILD_BOSS_UPDATE_MAP]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GUILD_INFO_UPDATE:i.AppFacade.getInstance().retrieveProxy(i.GuildPy.N).isInGuild()&&this.proxy.getOpenInfo().isOpen&&this.proxy.GetBossInfo();break;case CN.GUILD_BOSS_UPDATE_MAP:this.getSubView(n.SV.MAIN)&&this.getSubView(n.SV.MAIN).updateCoordInfo()}},n.prototype.onViewCreate=function(){this.sendNotification(CN.CITY_SWITCH_DBCLOCKPAUSE,!0),this.sendNotification(CN.GUAJI_HIDE_ALL_SUBVIEW)},n.N="GuildBossMediator",n.SV={MAIN:1},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.GuildBossPy.N),t}i.GuildBossMediator=e,__reflect(e.prototype,"game.GuildBossMediator")}(game=game||{}),function(n){var e=(t.registerAll=function(){(new o).register(),(new s).register(),(new h).register()},t);function t(){}n.GuildBossProcessor=e,__reflect(e.prototype,"game.GuildBossProcessor");var i,o=(i=n.ProcessorBase,__extends(a,i),a.prototype.execute=function(e){var t=e.getBody();console.log("PushBossInfoP",t),n.AppFacade.getInstance().retrieveProxy(n.GuildBossPy.N).bossInfo.update(t.bossInfo),n.AppFacade.getInstance().retrieveMediator(n.GuildBossMediator.N).updateView(n.GuildBossMediator.SV.MAIN)},a);function a(){return i.call(this,"guildBoss.PushBossInfoP",a)||this}__reflect(o.prototype,"PushBossInfoP");var r,s=(r=n.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody();console.log("PushFinishBattleInfoP",t);var i=n.AppFacade.getInstance().retrieveProxy(n.GuildBossPy.N);i.bossInfo.update(t.bossInfo),i.playerInfo.update(t.playerBossInfo);var o=n.AppFacade.getInstance().retrieveProxy(n.FightPy.N);o.addDelayCBAfterFightExit(function(){var e=n.AppFacade.getInstance().retrieveMediator(n.GuildBossMediator.N);e.updateView(n.GuildBossMediator.SV.MAIN,{type:n.GuildBossMainView.UPDATE_TYPE.CHALLENGE_INFO}),e.updateView(n.GuildBossMediator.SV.MAIN,{type:n.GuildBossMainView.UPDATE_TYPE.BOSS_INFO}),o.queueExceExitCB()},"GUILD_BOSS")},c);function c(){return r.call(this,"guildBoss.PushFinishBattleInfoP",c)||this}__reflect(s.prototype,"PushFinishBattleInfoP");var l,h=(l=n.ProcessorBase,__extends(p,l),p.prototype.execute=function(e){var t=e.getBody();n.AppFacade.getInstance().retrieveProxy(n.GuildBossPy.N).playerInfo.update(t.playerBossInfo)},p);function p(){return l.call(this,"guildBoss.PushPlayerBossInfoP",p)||this}__reflect(h.prototype,"PushPlayerBossInfoP")}(game=game||{}),function(r){var i,o=(i=r.BaseVO,__extends(e,i),e.prototype.update=function(e){e&&(this.hurt=e.hurt,this.hasBuyTimes=e.hasBuyTimes,this.challengeTimes=e.challengeTimes,NoticeManager.updateNotice(NT.GUILD_BOSS_NUM,void 0,!0))},e);function e(e){var t=i.call(this)||this;return e&&t.update(e),t}__reflect(o.prototype,"PlayerBossInfoVO");var n,a=(n=r.BaseVO,__extends(t,n),t.prototype.update=function(e){e&&(null!=this.lives&&(this.isDeadAndReBoth=e.lives>this.lives),this.day=e.day,this.lives=e.lives,this.count=e.count,this.bossId=e.bossId,this.totalLife=e.totalLife)},t);function t(e){var t=n.call(this)||this;return e&&t.update(e),t}__reflect(a.prototype,"BossInfoVO");var s,c=(__extends(l,s=BaseProxy),l.prototype.addNotice=function(){var e=this;NoticeManager.registerCB(NT.GUILD_BOSS_NUM,function(){return!!(e.playerInfo&&0<e.playerInfo.challengeTimes)},this),NoticeManager.setChildType(NT.GUILD_BOSS,[NT.GUILD_BOSS_NUM])},l.prototype.GetBossInfo=function(){var t=this;Utils.UnlockMgr.checkPass(MODULE.GuildBoss,!1).allow&&Utils.Socket.send("guildBoss","GetBossInfo",{}).then(function(e){console.log("公会boss数据获取 GetBossInfoR",e),t.playerInfo||(t.playerInfo=new o),t.bossInfo||(t.bossInfo=new a),t.playerInfo.update(e.playerBossInfo),t.bossInfo.update(e.bossInfo),t.checkNotice(),r.AppFacade.getInstance().updateView(r.GuildBossMediator.N,r.GuildBossMediator.SV.MAIN)})},l.prototype.BuyChallengeTimes=function(e,t){var i=this;Utils.Socket.send("guildBoss","BuyChallengeTimes",{num:e}).then(function(e){console.log("购买公会boss挑战次数 BuyChallengeTimesR",e),i.playerInfo.challengeTimes=e.playerBossInfo.challengeTimes,i.playerInfo.hasBuyTimes=e.playerBossInfo.hasBuyTimes,i.checkNotice(),r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N).handleClientCost(e.clientCost),r.AppFacade.getInstance().retrieveMediator(r.GuildBossMediator.N).updateView(r.GuildBossMediator.SV.MAIN,{type:r.GuildBossMainView.UPDATE_TYPE.CHALLENGE_INFO}),NoticeManager.updateNotice(NT.GUILD_BOSS_NUM,void 0,!0),t&&t()})},l.prototype.Challenge=function(e){var t=this;e.name,e.level,this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeServerBoss,pb1:"guildBoss",pb2:"Challenge",params:{},doneCB:function(e){console.log("战斗结束",e),t.checkNotice(),r.AppFacade.getInstance().retrieveProxy(r.FightPy.N).queueExceExitCB()}})},l.prototype.checkNotice=function(){},l.prototype.getOpenInfo=function(){if(!this.openInfo){this.openInfo={isOpen:!1,openTime:void 0,endTime:void 0,leastOpenDt:void 0,requestLevel:void 0,openDt:void 0,endDt:void 0};var e=r.AppFacade.getInstance().retrieveProxy(r.LoginPy.N),t=Number(r.Config.constConfig().GuildBossUnlockServerOpenDt.constValue),i=new Date(1e3*e.loginGameVO.serverOpenDt);i.setDate(i.getDate()+t),this.openInfo.leastOpenDt=i.getTime()/1e3,this.openInfo.openTime=JSON.parse(r.Config.constConfig().GuildBossStartDt.constValue),this.openInfo.endTime=JSON.parse(r.Config.constConfig().GuildBossEndDt.constValue),this.openInfo.requestLevel=JSON.parse(r.Config.constConfig().GuildBossUnlockLevel.constValue)}var o=r.AppFacade.getInstance().retrieveProxy(r.GuildPy.N).guildDetail.level,n=Utils.TimerManager.getServerTime(),a=new Date;return a.setTime(1e3*n),a.setHours(this.openInfo.openTime[0],this.openInfo.openTime[1],0,0),this.openInfo.openDt=a.getTime()/1e3,a.setHours(this.openInfo.endTime[0],this.openInfo.endTime[1],0,0),this.openInfo.endDt=a.getTime()/1e3,this.openInfo.isOpen=o>=this.openInfo.requestLevel&&n>=this.openInfo.leastOpenDt&&n>=this.openInfo.openDt&&n<this.openInfo.endDt,this.openInfo},l.N="GuildBossPy",l);function l(){var e=s.call(this,l.N)||this;return e.addNotice(),e}r.GuildBossPy=c,__reflect(c.prototype,"game.GuildBossPy")}(game=game||{}),function(l){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var e=this;this.daTanChuKuang0.blb_title.text="奖励",this.daTanChuKuang0.onCloseCB=function(){e.hide()};var t=l.Config.guildBossConfig(),i=l.AppFacade.getInstance().retrieveProxy(l.GuildBossPy.N),o=i.bossInfo&&i.bossInfo.day;if(o){var n=t[1];for(var a in t){var r=t[a];r.day==o&&(n=r)}if(n){var s=JSON.parse(n.hurtReward);this.addReward(s,this.gp_fight);var c=JSON.parse(n.guildReward);this.addReward(c[0],this.gp_first),this.addReward(c[1],this.gp_noFirst)}}},i.prototype.addReward=function(e,t){for(var i in e){var o=e[i],n=customui.BaseItemFactory.create();n.scaleX=n.scaleY=.7,n.updateData({reward:o}),t.addChild(n)}},i);function i(){var e=t.call(this)||this;return e.skinName="GuildBossFightRewardPanel",e}l.GuildBossFightRewardPanel=e,__reflect(e.prototype,"game.GuildBossFightRewardPanel")}(game=game||{}),function(r){var t,e=(__extends(a,t=BaseFull),a.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),this._activateComponent(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btn),this.map=Utils.MapUtils.generateCommon({source:MODULE.GuildBoss,multiLayerScroller:this.cu_mls,loadingParent:this.getParentView(),miniMapParent:Utils.SDKMgr.getPerformConfig(6)?void 0:this.gp_mini_map,onTouchTap:function(e,t){i.mainPy.SyncCoordinateInfo(e,t,"1",MODULE.GuildBoss)}}),this.gp_map.addChildAt(this.map,0)},a.prototype.updateView=function(e,t){var i=this;if(console.log("【chl】updateView1"),!r.AppFacade.getInstance().retrieveProxy(r.FightPy.N).isInFight){var o=this.mainPy.getMyCoordinateInfo(MODULE.GuildBoss);if(!t&&o)if(this.btn_challenge.visible=!0,this.proxy.playerInfo){var n=e&&e.type||a.UPDATE_TYPE.INIT;switch(console.log("【chl】updateView1",n),n){case a.UPDATE_TYPE.INIT:this.updateBossInfo(),this.updateChallengeInfo();break;case a.UPDATE_TYPE.BOSS_INFO:this.updateBossInfo();break;case a.UPDATE_TYPE.CHALLENGE_INFO:this.updateChallengeInfo()}}else this.proxy.GetBossInfo();else this.mainPy.GetCoordinateInfo(MODULE.GuildBoss,function(){i.updateView(e)})}},a.prototype.jumpToChatper=function(e){if(this.curBossday!=e){this.curBossday=e;var t=this.mainPy.getMyCoordinateInfo(MODULE.GuildBoss),i=this.mainPy.getOtherCoordinateInfo(MODULE.GuildBoss),o=r.Config.guildBossConfig()[e],n=JSON.parse(o.initLocation);this.map.tiled!=o.tiled&&this.map.update({isInit:!0,tiled:o.tiled,theme:o.theme,w:o.w,h:o.h,meStartTileX:n[0],meStartTileY:n[1]}),this.proxy.getOpenInfo().isOpen&&(this.map.touchEnabled=!1,this.map.updateNPC({curPosVO:{x:t.coordinate&&t.coordinate.x||n[0],y:t.coordinate&&t.coordinate.y||n[1],isFixed:!0},otherCoordInfos:i}))}},a.prototype.updateBossInfo=function(e){var t=this;if(void 0===e&&(e=!1),console.log("【chl】updateBossInfo",this.isBossDeading),!this.isBossDeading){var i=this.proxy.bossInfo;if(console.log("【chl】updateBossInfo",i&&i.isDeadAndReBoth),i&&i.isDeadAndReBoth){if(r.AppFacade.getInstance().retrieveProxy(r.FightPy.N).isInFight)return;return i.isDeadAndReBoth=void 0,this.isBossDeading=!0,void this.bossDeadAction(function(){t.switchScreenLayer(!0),DragonBoneTools.playOnce({effectName:"common_shijiebossdjs",parent:t,doneCB:function(){t.switchScreenLayer(!1),t.isBossDeading=!1,t.updateBossInfo(!0)}})})}this.bossConfig=r.Config.guildBossConfig()[i.day],this.bossCreepInfo=r.Config.creepConfig(i.bossId),this.jumpToChatper(i.day),this.map.cleanAllEP();var o=r.Config.guildBossConfig()[i.day],n=JSON.parse(o.bossLocation),a=[];a.push(new r.EventVO({fadeType:FadeRiskEventType.BigBoss,position:{x:n[0],y:n[1]},config:{heroC:this.bossCreepInfo,hp:i.lives,initHp:this.proxy.bossInfo.totalLife,module:MODULE.GuildBoss},isDirty:!0,customTrigger:function(e){e&&t.reqFightBoss()},hudongAction:{appear:e}})),this.map.updateLayerEvent({events:a}),this.map.showMePathToPos({tileX:n[0],tileY:n[1]})}},a.prototype.updateChallengeInfo=function(){this.blb_count.text=this.proxy.playerInfo.challengeTimes.toString()},a.prototype.switchScreenLayer=function(e){this.darkSprite||(this.darkSprite=new egret.Sprite,this.darkSprite.touchEnabled=!0,this.gp_main.addChildAt(this.darkSprite,this.gp_main.getChildIndex(this.btn_back)),this.darkSprite.graphics.clear(),this.darkSprite.graphics.beginFill(0,.6),this.darkSprite.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),this.darkSprite.graphics.endFill()),this.darkSprite.visible=e},a.prototype.updateCoordInfo=function(){var e=this.mainPy.getMyCoordinateInfo(MODULE.GuildBoss),t=this.mainPy.getOtherCoordinateInfo(MODULE.GuildBoss);e&&this.map.isInited&&(this.map.updateNPC({curPosVO:{x:e.coordinate&&e.coordinate.x,y:e.coordinate&&e.coordinate.y,isFixed:!0},otherCoordInfos:t}),this.map.resetCamera()),e.coordinate.iAmClean()},a.prototype.bossDeadAction=function(e){if(this.map.isInited){var t=JSON.parse(this.bossConfig.bossLocation),i=this.map.tile2EP(t[0],t[1]);i&&i.hudongWithEP?i.hudongWithEP({playDeadAction:!0,cb:e}):egret.warn("该boss已经不存在，或者该位置上的ep已经不是big boss ep",i)}},a.prototype._activateComponent=function(){this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"GUILD_BOSS"})},this),Utils.UnlockMgr.checkPass(MODULE.BattleFormation,!1).allow?this.btn_mutiTeam.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.GameMVC.heroMutiTeamPy.server_GetBattleFormationInfo(function(){r.GameMVC.heroMutiTeamMed.showSubView(r.HeroMutiTeamMediator.SV.MAIN,{type:2,moduleId:MODULE.GuildBoss})})},this):this.btn_mutiTeam.visible=!1,this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new r.HelpDialog({moduleId:MODULE.GuildBoss})})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new r.GuildBossFightRewardPanel})},this),this.btn_challenge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.proxy.playerInfo.challengeTimes<=0?this.showBuyPanel():this.findBoss()},this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.MainJumpConfig.jumpTo()},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.showBuyPanel()},this)},a.prototype.perClose=function(){this.map.reset()},a.prototype.findBoss=function(){if(!this.isBossDeading&&this.map&&this.bossConfig){var e=JSON.parse(this.bossConfig.bossLocation);this.map.handleTouchTap(e[0],e[1])}},a.prototype.showBuyPanel=function(){var t=this;r.AppFacade.getInstance().showSubView(r.CommonMediator.N,r.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.GuildBoss,hasBuyNum:this.proxy.playerInfo.hasBuyTimes,maxBuyNum:r.Config.VIPConfig().guildBossBuyTimes,buyCB:function(e){t.proxy.BuyChallengeTimes(e,function(){Utils.MsgUtils.addMidMsg("成功购买"+e+"次")})}})},a.prototype.reqFightBoss=function(){var e=this.proxy.getOpenInfo();if(e.isOpen)0==this.proxy.bossInfo.lives?Utils.MsgUtils.addMidMsg("BOSS已被击败"):this.proxy.playerInfo.challengeTimes<=0?this.showBuyPanel():this.bossCreepInfo&&this.bossConfig&&this.proxy.Challenge({name:this.bossCreepInfo.name,level:this.bossConfig.level,day:this.curBossday});else{var t=e.openTime,i=e.endTime,o=9<t[0]?t[0].toString():"0"+t[0].toString(),n=9<t[1]?t[1].toString():"0"+t[1].toString(),a=9<i[0]?i[0].toString():"0"+i[0].toString(),r=9<i[1]?i[1].toString():"0"+i[1].toString();Utils.MsgUtils.addMidMsg(o+":"+n+" ~ "+a+":"+r+"开启挑战")}},a.UPDATE_TYPE={INIT:1,BOSS_INFO:2,CHALLENGE_INFO:3},a);function a(){var e=t.call(this)||this;return e.proxy=r.AppFacade.getInstance().retrieveProxy(r.GuildBossPy.N),e.mainPy=r.AppFacade.getInstance().retrieveProxy(r.MainPy.N),e.skinName="GuildBossMainSkin",e}r.GuildBossMainView=e,__reflect(e.prototype,"game.GuildBossMainView")}(game=game||{}),function(p){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.initList(),this.daTanChuKuang.onCloseCB=function(){e.hide()}},i.prototype.initList=function(){this.item_list=new eui.List;var e=new eui.VerticalLayout;this.item_list.layout=e,this.item_list.itemRenderer=n,this.scroller.viewport=this.item_list,this.scroller.verticalScrollBar.autoVisibility=!1,this.scroller.verticalScrollBar.visible=!1},i.prototype.updateView=function(e){var i=this;this.lb_desc.text="BOSS被击杀后，你可获得以下奖励：";var t=this.proxy.bossInfo,o=p.Config.guildBossConfig()[t.day],n=JSON.parse(o.guildReward),a=n[t.count]||n[n.length-1];this.gp_rewards.removeChildren(),a.forEach(function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,t.updateData({type:e[0],code:e[1],num:e[2]}),i.gp_rewards.addChild(t)});var r=p.Config.rankingRewardByTypeConfig(RankingType.RankingTypeWorldWorldKing),s=[];for(var c in s.push({rewards:o.killReward}),r)for(var l=r[c],h=l.rankUpper;h<=l.rankLower;h++)s.push({rank:h,rewards:l.rewards});s.sort(function(e,t){return(e.rank||0)-(t.rank||0)}),this.item_list.dataProvider=new eui.ArrayCollection(s)},i);function i(){var e=t.call(this)||this;return e.proxy=p.AppFacade.getInstance().retrieveProxy(p.GuildBossPy.N),e.skinName="GuildBossRewardSkin",e}p.GuildBossRewardPanel=e,__reflect(e.prototype,"game.GuildBossRewardPanel");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this);for(var e=1;e<=3;e++){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,this.gp_rewards.addChild(t)}},a.prototype.dataChanged=function(){var e=this.data.rank;e?e<=3?(this.img_icon.visible=!0,this.lb_rank.visible=!1,this.img_icon.source="jjc_icon_pm_"+e+"_png"):(this.img_icon.visible=!1,this.lb_rank.visible=!0,this.lb_rank.text=e.toString()):(this.img_icon.visible=!0,this.lb_rank.visible=!1,this.img_icon.source="");for(var t=JSON.parse(this.data.rewards),i=0;i<3;i++){var o=this.gp_rewards.getChildAt(i),n=t[i];n?(o.visible=!0,o.updateData({type:n[0],code:n[1],num:n[2]})):o.visible=!1}},a);function a(){var e=o.call(this)||this;return e.skinName="GuildBossReward_RewardItem",e}__reflect(n.prototype,"GuildBossReward_RewardItem")}(game=game||{}),function(i){var t,e=(__extends(o,t=BaseMediator),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,i.GuildCollectView),this.addSubView(o.SV.REWARD,i.GuildCollectRewardPanel)},o.prototype.listNotificationInterests=function(){return[CN.GUILD_FIRST_INFO_UPDATE,CN.GUILD_COLLECT_INFO_UPDATE,CN.GENERAL_PASS_DAY,CN.GUILD_INFO_UPDATE,CN.GUILDFARM_FARM_GOLD_UPDATE]},o.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GUILD_INFO_UPDATE:case CN.GENERAL_PASS_DAY:case CN.GUILD_FIRST_INFO_UPDATE:i.AppFacade.getInstance().retrieveProxy(i.GuildCollectPy.N).GetGuildCollectInfo();break;case CN.GUILD_COLLECT_INFO_UPDATE:this.updateView(o.SV.MAIN,{isResh:!0});break;case CN.GUILDFARM_FARM_GOLD_UPDATE:var t=this.getSubView(i.GuildFarmMediator.SV.MAIN);t&&t.updateResBar()}},o.prototype.onViewCreate=function(){},o.N="GuildCollectMediator",o.SV={MAIN:1,REWARD:2},o);function o(e){return void 0===e&&(e=null),t.call(this,o.N,e)||this}i.GuildCollectMediator=e,__reflect(e.prototype,"game.GuildCollectMediator")}(game=game||{}),function(i){var e=(t.registerAll=function(){(new n).register()},t);function t(){}i.GuildCollectProcessor=e,__reflect(e.prototype,"game.GuildCollectProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){var t=e.getBody().info;i.AppFacade.getInstance().retrieveProxy(i.GuildCollectPy.N).collectInfoVO.update(t)},a);function a(){return o.call(this,"guildCollect.GuildCollectInfoP",a)||this}i.GuildCollectInfoP=n,__reflect(n.prototype,"game.GuildCollectInfoP")}(game=game||{}),function(o){var t,e=(__extends(i,t=BaseProxy),i.prototype.initNotice=function(){NoticeManager.registerCB(NT.GUILD_COLLECT,this.checkCollectNotice,this)},i.prototype.checkCollectNotice=function(){return!!(this.collectInfoVO&&this.collectInfoVO.num<this.collectInfoVO.taskList.length)},i.prototype.checkCollectReward=function(){this.collectInfoVO.rewardList.length&&o.GameMVC.fightPy.addDelayCBAfterFightExit(function(){o.AppFacade.getInstance().showSubView(o.GuildCollectMediator.N,o.GuildCollectMediator.SV.REWARD)},"guildCollect")},i.prototype.GetGuildCollectInfo=function(t){var i=this;o.AppFacade.getInstance().retrieveProxy(o.GuildPy.N).isInGuild()&&Utils.Socket.send("guildCollect","GetGuildCollectInfo",{}).then(function(e){i.collectInfoVO.update(e.info),t&&t()})},i.prototype.AcceptGuildCollectTask=function(e,t){var i=this;Utils.Socket.send("guildCollect","AcceptGuildCollectTask",{id:e}).then(function(e){i.collectInfoVO.update(e.info),t&&t()})},i.prototype.FinishGuildCollect=function(e,t){var i=this;Utils.Socket.send("guildCollect","FinishGuildCollect",{id:e}).then(function(e){i.collectInfoVO.update(e.info),o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N).handleClientReward(e.clientReward),t&&t()})},i.prototype.CancelGuildCollect=function(e,t){var i=this;Utils.Socket.send("guildCollect","CancelGuildCollect",{id:e}).then(function(e){i.collectInfoVO.update(e.info),t&&t()})},i.prototype.RefreshGuildCollect=function(t){var i=this;Utils.Socket.send("guildCollect","RefreshGuildCollect",{}).then(function(e){i.collectInfoVO.update(e.info),t&&t()})},i.prototype.GetCollectReward=function(t){var i=this;Utils.Socket.send("guildCollect","GetCollectReward",{uuid:""}).then(function(e){i.collectInfoVO.update(e.info),o.GameMVC.backpackPy.handleClientReward(e.clientReward),t&&t()})},i.N="GuildCollectProxy",i);function i(){var e=t.call(this,i.N)||this;return e.collectInfoVO=new o.GuildCollectInfoVO,e.initNotice(),e}o.GuildCollectPy=e,__reflect(e.prototype,"game.GuildCollectPy")}(game=game||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.actComp()},o.prototype.updateView=function(){var n=this,e=t.GameMVC.guildCollectPy.collectInfoVO,o=[],a=[],r=t.Config.getGuildCollect();e.rewardList.forEach(function(e){var t=e.id,i=r[t];o=o.concat(JSON.parse(i.rewards)),null==a[i.star]&&(a[i.star]=0),a[i.star]+=1}),this.gp_rewards.removeChildren(),o.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),n.gp_rewards.addChild(t)}),this.gp_desc.removeChildren(),a.forEach(function(e,t){if(e){var i=n.LABEL_STYLE[t],o=new eui.Label;o.width=o.height=void 0,o.textColor=i[0],o.size=i[1],o.text=t+"星任务       x"+e,n.gp_desc.addChild(o)}})},o.prototype.perClose=function(){t.GameMVC.guildCollectPy.GetCollectReward()},o.prototype.actComp=function(){var e=this;Utils.TouchUtils.addTouchListener(this.btn_confirm,function(){e.hide()})},o);function o(){var e=i.call(this)||this;return e.LABEL_STYLE={1:[24919,20],2:[9767986,20],3:[5770864,20],4:[944654,20],5:[4003586,20],6:[1584232,20],7:[13123589,20]},e.skinName="GuildCollectRewardSkin",e}t.GuildCollectRewardPanel=e,__reflect(e.prototype,"game.GuildCollectRewardPanel")}(game=game||{}),function(a){var t,n=(__extends(e,t=BasePanel),e.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.initUI(),this.initButton(),this.py.GetGuildCollectInfo(function(){e.updateView(void 0),e.initTimer()})},e.prototype.initTimer=function(){this.scheId||(this.guildCollectRefreshCycle=Number(a.Config.constConfig().GuildCollectRefreshCycle.constValue),this.scheId=egret.setInterval(this.updateTm,this,1e3))},e.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.scheId&&egret.clearInterval(this.scheId)},e.prototype.initButton=function(){var i=this;a.Config.getGuildCollect(),this.cu_dtc.blb_title.text="采集中心",this.cu_dtc.onCloseCB=function(){i.hide()},this.cu_cbwn_refresh.btn_oppr.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=0,e=JSON.parse(a.Config.constConfig().GuildCollectRefreshCosts.constValue)[0];i.py.collectInfoVO.taskList.forEach(function(e){e.dt<=0&&t++}),0<t?a.GameMgr.getInstance().showCommonTipsWin({costTips:"进行刷新任务吗？\n（已接受的任务，不会被刷新）",cost:[[e[0],e[1],t*e[2]]],source:"GUILD_COLLECT_REFREASH",cb:!0,clickCB:function(e){1==e.type&&i.py.RefreshGuildCollect(function(){i.updateList()})}}):Utils.MsgUtils.addMidMsg("无可刷新任务，请先完成")},this),this.cu_cbwn_refresh.updateData({text:"刷新"}),this.cu_cbwn_refresh.btn_oppr.skinName="skins.ButtonSkinBlue"},e.prototype.initUI=function(){this.lv_main=new eui.List;var e=new eui.VerticalLayout;e.gap=10,this.lv_main.layout=e,this.sl_root.viewport=this.lv_main,this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_root.scrollPolicyV=eui.ScrollPolicy.AUTO,this.lv_main.itemRenderer=o,this.dataProvider=new eui.ArrayCollection,this.lv_main.dataProvider=this.dataProvider},e.prototype.updateView=function(e){if(this.isCreateComplete){a.GameMgr.getInstance().serverTime(),a.Config.getGuildCollect();var t=this.py.collectInfoVO.num<Number(this.py.collectInfoVO.taskList.length);UIActionManager.setAbsGrey(this.cu_cbwn_refresh,!t),this.lb_tips.textFlow=[{text:"任务",style:{textColor:7748625}},{text:"("+this.py.collectInfoVO.num+"/"+this.py.collectInfoVO.taskList.length+")",style:{textColor:10158080}},{text:"将在",style:{textColor:7748625}}]}e&&e.isResh&&this.updateList(),this.GuildFarmInfo.updateView({type:TopFarmBuild.Collect}),this.updateResBar()},e.prototype.updateResBar=function(){this.resource_bar.updateBar([[1,EPropertyType.EPropertyTypeTopFarmMoney,1]])},e.prototype.updateList=function(){var i=this,o=a.Config.getGuildCollect();this.dataProvider.removeAll(),this.lv_main.scrollV=0;var n=a.GameMgr.getInstance().serverTime();this.py.collectInfoVO.taskList.forEach(function(e,t){e.flag||i.dataProvider.addItem({id:e.id,c:o[e.id],cb:i.onItemClick,thiz:i,isWorking:0<e.dt,isCanGet:0<e.dt&&n-e.dt>=o[e.id].cycle})}),this.dataProvider.source.sort(function(e,t){return e.isCanGet&&!t.isCanGet?-1:!e.isCanGet&&t.isCanGet?1:e.isWorking&&!t.isWorking?1:!e.isWorking&&t.isWorking?-1:e.c.star!=t.c.star?t.c.star-e.c.star:e.id-t.id}),this.gp_empty.visible=this.dataProvider.length<=0},e.prototype.updateTm=function(){var n=this;if(!this.refreshing){var e=Utils.TimerManager.getNextDayTime(Utils.TimerManager.getServerTime())-Utils.TimerManager.getServerTime();if(!(0<e))return this.refreshing=!0,void this.py.GetGuildCollectInfo(function(){n.refreshing=!1});this.blb_sche.text=Utils.TimerManager.getFormatBySecond1(e)}this.py.collectInfoVO.taskList.forEach(function(e){if(0<e.dt){e.cur+=1;for(var t=0,i=n.dataProvider.source;t<i.length;t++){var o=i[t];if(o.id==e.id){n.dataProvider.itemUpdated(o);break}}}})},e.prototype.onItemClick=function(e,t){for(var i=this,o=void 0,n=0,a=this.dataProvider.source;n<a.length;n++){var r=a[n];if(r.id==e.data.c.id){o=r;break}}2==t?(this.log("开始"),this.py.AcceptGuildCollectTask(e.data.c.id,function(){i.dataProvider.itemUpdated(o)})):1==t?(this.log("done"),this.py.FinishGuildCollect(e.data.c.id,function(){i.updateList(),i.gp_empty.visible=i.dataProvider.length<=0})):3==t?(this.log("加速"),this.py.FinishGuildCollect(e.data.c.id,function(){i.updateList(),i.gp_empty.visible=i.dataProvider.length<=0})):-1==t&&(this.log("取消"),this.py.CancelGuildCollect(e.data.c.id,function(){i.dataProvider.itemUpdated(o)}))},e.prototype.perClose=function(){a.AppFacade.getInstance().updateView(a.GuildMediator.N,a.GuildMediator.SV.MAIN_MAP)},e.TASK_STATUS={READY:0,WORKING:1,GET:2,DONE:3},e);function e(){var e=t.call(this)||this;return e.farmPy=a.AppFacade.getInstance().retrieveProxy(a.GuildFarmPy.N),e.skinName="GuildCollectViewSkin",e.py=a.AppFacade.getInstance().retrieveProxy(a.GuildCollectPy.N),e.playerProxy=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),e}a.GuildCollectView=n,__reflect(n.prototype,"game.GuildCollectView");var i,o=(i=eui.ItemRenderer,__extends(r,i),r.prototype.childrenCreated=function(){var i=this;this.pb_1.slideDuration=0,this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.GameMgr.getInstance().showCommonTipsWin({source:"guild_collect_cancel",commonTips:"关闭该任务将重置当前采集进度。",cb:!1,clickCB:function(e){1===e.type&&i.data.cb&&i.data.cb.call(i.data.thiz,i,-1)}})},this),this.btn_oppr.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.status==n.TASK_STATUS.GET?i.data.cb&&i.data.cb.call(i.data.thiz,i,1):i.data.cb&&i.data.cb.call(i.data.thiz,i,2)},this),this.btn_speed.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.GameMgr.getInstance().showCommonTipsWin({costTips:"钻石，立即完成采集",source:"guild_collect_time",cost:i.data.c.costs,cb:!0,clickCB:function(e){1===e.type&&i.data.cb&&i.data.cb.call(i.data.thiz,i,3)}})},this),this.pb_1.labelFunction=function(e,t){return i.status==n.TASK_STATUS.DONE||i.status==n.TASK_STATUS.GET?"完成":Utils.TimerManager.getFormatBySecond1(t-e)}},r.prototype.lockChange=function(){this.btn_lock.icon="_guild_m_json.gonghui_icon_cjrw"+this.data.c.star},r.prototype.dataChanged=function(){var i=this,e=this.data.c,t=!1;e.id!=this.lastId&&(this.lastId=e.id,t=!0),this.vo=this.py.collectInfoVO.id2TaskVO[e.id],t&&(this.lb_name.text=e.desc,this.blb_star.text="x"+e.star,this.gp_rewards.removeChildren(),JSON.parse(e.rewards).forEach(function(e){var t=customui.BaseItemFactory.create({reward:e});t.scaleX=t.scaleY=.9,i.gp_rewards.addChild(t)}),this.pb_1.maximum=e.cycle);var o=0;this.vo?(this.vo.isLock=!1,0==this.vo.dt?(this.vo.isLock=!0,o=n.TASK_STATUS.READY,this.pb_1.value=0,this.lb_time.text=Utils.TimerManager.getFormatBySecond2(e.cycle)):this.vo.cur>=e.cycle?(o=this.vo.flag?n.TASK_STATUS.DONE:n.TASK_STATUS.GET,this.pb_1.value=e.cycle):(o=n.TASK_STATUS.WORKING,this.pb_1.value=this.vo.cur)):egret.warn("找不到对应id:"+e.id),this.lockChange(),this.switchStatus(o,t)},r.prototype.switchStatus=function(e,t){if(this.status!=e)switch(this.img_bg.source="common_img_kt_4_png",this.status=e){case n.TASK_STATUS.READY:this.btn_oppr.label="接受",this.pb_1.visible=this.btn_speed.visible=this.btn_cancel.visible=!1,this.gp_time.visible=this.btn_oppr.enabled=this.btn_oppr.visible=!0;break;case n.TASK_STATUS.WORKING:this.pb_1.visible=this.btn_speed.visible=this.btn_cancel.visible=!0,this.btn_oppr.label="",this.gp_time.visible=this.btn_oppr.enabled=this.btn_oppr.visible=!1;break;case n.TASK_STATUS.GET:this.gp_time.visible=this.btn_speed.visible=this.btn_cancel.visible=!1,this.img_bg.source="common_img_kt_5_png",this.btn_oppr.label="完成",this.pb_1.visible=this.btn_oppr.enabled=this.btn_oppr.visible=!0;break;case n.TASK_STATUS.DONE:this.gp_time.visible=this.btn_speed.visible=this.btn_cancel.visible=!1,this.btn_oppr.label="已完成",this.btn_oppr.enabled=!1,this.pb_1.visible=this.btn_oppr.visible=!0}},r);function r(){var e=i.call(this)||this;return e.skinName="GuildCollectViewSkin_1",e.py=a.AppFacade.getInstance().retrieveProxy(a.GuildCollectPy.N),e}__reflect(o.prototype,"TaskItemRender")}(game=game||{}),function(n){var i,e=(__extends(a,i=BaseMediator),a.prototype.initSubView=function(){this.addSubView(a.SV.MAIN,n.GuildFarmMainView),this.addSubView(a.SV.CENTER,n.GuildFarmCenter),this.addSubView(a.SV.COLLECT,n.GuildFarmCollect),this.addSubView(a.SV.INSTITUTE,n.GuildFarmInstitute),this.addSubView(a.SV.MARKET,n.GuildFarmMarket),this.addSubView(a.SV.STORE_HOUSE,n.GuildFarmStoreHouse)},a.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.GENERAL_PASS_DAY,CN.LOGIN_FINAL_DONE,CN.GUILDFARM_FARM_LAND_UPDATE,CN.GUILDFARM_FARM_BUILDING_UPDATE,CN.GUILDFARM_FARM_SKILL_UPDATE,CN.GUILDFARM_FARM_GOLD_UPDATE]},a.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GENERAL_PASS_DAY:case CN.LOGIN_FINAL_DONE:n.GameMVC.guildPy.isInGuild()&&(n.GameMVC.guildFarmPy.GetTopFarmInfo(),n.GameMVC.guildFarmPy.GetTopFarmResearchInfo());break;case CN.GUILDFARM_FARM_LAND_UPDATE:this.updateView(a.SV.MAIN);break;case CN.GUILDFARM_FARM_BUILDING_UPDATE:break;case CN.GUILDFARM_FARM_SKILL_UPDATE:(t=this.getSubView(a.SV.INSTITUTE))&&t.updateView();break;case CN.GUILDFARM_FARM_GOLD_UPDATE:var t;(t=this.getSubView(a.SV.INSTITUTE))&&t.updateResBar();var i=this.getSubView(a.SV.CENTER);i&&i.updateResBar();var o=this.getSubView(a.SV.MARKET);o&&o.updateResBar()}},a.N="GuildFarmMediator",a.SV={MAIN:1,CENTER:2,COLLECT:3,INSTITUTE:4,MARKET:5,STORE_HOUSE:6},a);function a(e){void 0===e&&(e=null);var t=i.call(this,a.N,e)||this;return t.guildPy=n.AppFacade.getInstance().retrieveProxy(n.GuildPy.N),t.gwProxy=n.AppFacade.getInstance().retrieveProxy(n.GuildFarmPy.N),t}n.GuildFarmMediator=e,__reflect(e.prototype,"game.GuildFarmMediator")}(game=game||{}),function(i){var e=(t.registerAll=function(){(new n).register(),(new h).register(),(new u).register(),(new s).register(),(new _).register()},t);function t(){}i.GuildFarmProcessor=e,__reflect(e.prototype,"game.GuildFarmProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){var t=e.getBody();console.log("MoneyChangeP",t),i.GameMVC.playerPy.playerInfoVO.updateMoneyByTypeNum(EPropertyType.EPropertyTypeTopFarmMoney,t.money),i.AppFacade.getInstance().sendNotification(CN.GUILDFARM_FARM_GOLD_UPDATE)},a);function a(){return o.call(this,"topFarm.MoneyChangeP",a)||this}__reflect(n.prototype,"MoneyChangeP");var r,s=(r=i.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody();console.log("TopFarmResearchInfoP",t),i.AppFacade.getInstance().retrieveProxy(i.GuildFarmPy.N).updateSkillInfo(t.info),i.AppFacade.getInstance().sendNotification(CN.GUILDFARM_FARM_LAND_UPDATE)},c);function c(){return r.call(this,"topFarmResearch.TopFarmResearchInfoP",c)||this}__reflect(s.prototype,"TopFarmResearchInfoP");var l,h=(l=i.ProcessorBase,__extends(p,l),p.prototype.execute=function(e){var t=e.getBody();console.log("BuildLevelChangeP",t),i.GameMVC.guildFarmPy.updateBuilding(t.buildLevel),i.GameMVC.guildFarmMed.updateView(i.GuildFarmMediator.SV.MAIN)},p);function p(){return l.call(this,"topFarm.BuildLevelChangeP",p)||this}__reflect(h.prototype,"BuildLevelChangeP");var d,u=(d=i.ProcessorBase,__extends(g,d),g.prototype.execute=function(e){var t=e.getBody();console.log("LandChangeP",t),i.GameMVC.guildFarmPy.updateLandInfo(t.land),i.GameMVC.guildFarmMed.updateView(i.GuildFarmMediator.SV.MAIN)},g);function g(){return d.call(this,"topFarm.LandChangeP",g)||this}__reflect(u.prototype,"LandChangeP");var f,_=(f=i.ProcessorBase,__extends(m,f),m.prototype.execute=function(e){var t=e.getBody();console.log("AutoCollectP",t),t.autoCollect&&PopUpManager.addPopUp({obj:new i.GuildFarmRewardPanel({rewards:t.autoCollect,desc:"您在公会农场辛勤工作，种下的作物成熟了",title:"种植收获",closeCB:function(){i.GameMVC.guildFarmPy.GetAutoCollectReward(t.uuid)},model:"mhnc_img_caiji_png"})})},m);function m(){return f.call(this,"topFarm.AutoCollectP",m)||this}__reflect(_.prototype,"AutoCollectP")}(game=game||{}),function(n){var t,e=(__extends(i,t=BaseProxy),i.prototype.addNotice=function(){var i=this;NoticeManager.setChildType(NT.FARM_SELF_ENTRANCE,[NT.FARM_SELF_CANCOLLECT]),NoticeManager.registerCB(NT.FARM_SELF_CANCOLLECT,function(){for(var e in i.farmInfo.land){var t=i.getLand(e);if(t&&2==t.stage&&t.playerId==n.GameMVC.playerPy.playerInfoVO.playerId)return!0}return!1},this,MODULE.Guild)},i.prototype.GetTopFarmInfo=function(e,t){var i=this;Utils.Socket.send("topFarm","GetTopFarmInfo",{}).then(function(e){i.updateLandInfo(e.land),i.farmInfo.workTimes=e.workTimes,i.updateBuilding(e.buildLevel),n.GameMVC.playerPy.playerInfoVO.updateMoneyByTypeNum(EPropertyType.EPropertyTypeTopFarmMoney,e.money),e.autoCollect&&PopUpManager.addPopUp({obj:new n.GuildFarmRewardPanel({rewards:e.autoCollect,desc:"您在公会农场辛勤工作，种下的作物成熟了",title:"种植收获",model:"mhnc_img_caiji_png",closeCB:function(){i.GetAutoCollectReward()}})}),t&&t()})},i.prototype.Plant=function(e,t){Utils.Socket.send("topFarm","Plant",{pos:e.pos,code:e.code}).then(function(e){t&&t()})},i.prototype.Collect=function(e,t){var i=this,o=this.getLand(e.pos).seedCode;Utils.Socket.send("topFarm","Collect",{pos:e.pos}).then(function(e){t&&t(e),e.eventFlag&&i.showEpRewardView({clientReward:e.clientReward,code:o})})},i.prototype.UpGradeBuild=function(t,i){var o=this;Utils.Socket.send("topFarm","UpGradeBuild",{id:t.id}).then(function(e){n.GameMVC.backpackPy.handleClientReward(e.clientReward,2),o.updateBuilding(e.buildLevel),t.id==TopFarmBuild.Research&&n.GameMVC.guildFarmMed.updateView(n.GuildFarmMediator.SV.INSTITUTE),i&&i()})},i.prototype.FarmWork=function(e,t){var i=this;e.id?Utils.Socket.send("topFarm","FarmWork",{id:e.id,pos:e.pos}).then(function(e){n.GameMVC.backpackPy.handleClientReward(e.clientReward,2),i.farmInfo.workTimes=e.workTimes,t&&t()}):t&&t()},i.prototype.GetAutoCollectReward=function(e,t){void 0===e&&(e=""),Utils.Socket.send("topFarm","GetAutoCollectReward",{uuid:e}).then(function(e){n.GameMVC.backpackPy.handleClientReward(e.clientReward,2),t&&t()})},i.prototype.GetShopInfo=function(t,i){Utils.Socket.send("topFarm","GetShopInfo",{type:t.type}).then(function(e){n.GameMVC.shopPy.curShopType==t.type&&n.GameMVC.shopPy.updateShopInfo({info:e.shopInfo,type:t.type}),i&&i(e)})},i.prototype.Buy=function(t,e,i,o){Utils.Socket.send("topFarm","Buy",{type:t,id:e,num:i,grid:o}).then(function(e){n.GameMVC.shopPy.updateShopInfo({info:e.shopInfo,type:t}),Utils.MsgUtils.addMidMsg("购买成功")})},i.prototype.ExChange=function(t,i){var o=this;Utils.Socket.send("topFarm","ExChange",{code:t.code,num:t.num}).then(function(e){e.eventFlag?o.showEpRewardView({clientReward:e.clientReward,code:t.code}):n.GameMVC.backpackPy.handleClientReward(e.clientReward,2),n.GameMVC.guildFarmMed.updateView(n.GuildFarmMediator.SV.MARKET),n.GameMVC.guildFarmMed.updateView(n.GuildFarmMediator.SV.STORE_HOUSE,{fromShop:!0}),i&&i(e)})},i.prototype.showEpRewardView=function(e){var t=e.code,i=(n.Config.farm_fruitConfig()[t]||n.Config.farm_seedConfig()[t]).eventDesc;PopUpManager.addPopUp({obj:new n.BaseEpRewardView({config:{resultDesc:'["<font color=7096888>'+i+'</font>"]',titleFixed:"特殊事件"},rewards:e.clientReward,order:0})})},i.prototype.updateLandInfo=function(e){this.farmInfo.land=e,this.farmInfo.land.forEach(function(e){e.ori_plantDt=e.plantDt,e.plantDt-=e.speedUp}),NoticeManager.updateNotice(NT.FARM_SELF_CANCOLLECT),n.AppFacade.getInstance().sendNotification(CN.GUILDFARM_FARM_LAND_UPDATE)},i.prototype.updateBuilding=function(e){this.farmInfo.buildLevel=e,n.AppFacade.getInstance().sendNotification(CN.GUILDFARM_FARM_BUILDING_UPDATE)},i.prototype.updateSkillInfo=function(e){this.skillInfo=e,n.AppFacade.getInstance().sendNotification(CN.GUILDFARM_FARM_SKILL_UPDATE)},i.prototype.GetTopFarmResearchInfo=function(t){var i=this;Utils.Socket.send("topFarmResearch","GetTopFarmResearchInfo",{}).then(function(e){i.updateSkillInfo(e.info),t&&t()})},i.prototype.LearnResearchSkill=function(e,t){var i=this;Utils.Socket.send("topFarmResearch","LearnResearchSkill",{type:e.type}).then(function(e){i.updateSkillInfo(e.info),n.AppFacade.getInstance().sendNotification(CN.GUILDFARM_FARM_LAND_UPDATE),t&&t()})},i.prototype.ResetResearchSkill=function(e,t){var i=this;Utils.Socket.send("topFarmResearch","ResetResearchSkill",{tab:e.tab}).then(function(e){i.updateSkillInfo(e.info),n.GameMVC.backpackPy.handleClientReward(e.clientReward,2),t&&t()})},i.prototype.getLand=function(e){for(var t in this.farmInfo.land){var i=this.farmInfo.land[t];if(i.pos==e)return i.stage=this.getLandStage(i),i}},i.prototype.getWorkTime=function(){return this.farmInfo.workTimes||0},i.prototype.getLandStage=function(e){var t=1,i=n.Config.farm_seedConfig()[e.seedCode],o=Utils.TimerManager.getServerTime();return i&&o-e.plantDt>=n.GameMVC.guildFarmPy.getTimeBySkill(i.ripeTime)&&(t=2),t},i.prototype.getTimeBySkill=function(e){var t=JSON.parse(this.skillInfo.skills)||[];for(var i in t){var o=n.Config.farm_skillConfigByTypeAndLevel(Number(i),t[i]);if(0<o.ripeTimeRatio)return Math.floor(e*(1-o.ripeTimeRatio/1e3))}return e},i.prototype.getMarketUpPercent=function(){var e=this.farmInfo.buildLevel.marketLevel;return 1+n.Config.farm_marketConfig()[e].upPercent/1e3},i.prototype.getBuildLevel=function(e){switch(e){case 1:return this.farmInfo.buildLevel.farmLevel;case 2:return this.farmInfo.buildLevel.marketLevel;case 3:return this.farmInfo.buildLevel.researchLevel;case 4:return this.farmInfo.buildLevel.collectLevel;default:return 0}},i.prototype.getSelfLandCount=function(){var e=0;for(var t in this.farmInfo.land)this.farmInfo.land[t].playerId==n.GameMVC.playerPy.playerInfoVO.playerId&&e++;return e},i.N="GuildFarmPy",i);function i(){var e=t.call(this,i.N)||this;return e.farmInfo={land:[],workTimes:0,buildLevel:new c({})},e.skillInfo={resetNum:1,skills:""},e.addNotice(),e}n.GuildFarmPy=e,__reflect(e.prototype,"game.GuildFarmPy");var o,a=(o=n.BaseVO,__extends(r,o),r.prototype.update=function(e){this.pos=e&&e.pos||this.pos,this.playerId=e&&e.playerId||this.playerId,this.plantDt=e&&e.plantDt||this.plantDt,this.seedCode=e&&e.seedCode||this.seedCode,this.stealList=e&&e.stealList||this.stealList,this.speedUp=e&&e.speedUp||0,this.plantDt=this.plantDt-this.speedUp},r);function r(e){var t=o.call(this)||this;return t.pos=t.playerId=t.plantDt=t.seedCode=0,t.stealList=[],t.stage=1,t}n.LandInfo=a,__reflect(a.prototype,"game.LandInfo");var s,c=(s=n.BaseVO,__extends(l,s),l.prototype.update=function(e){this.farmLevel=e&&e.farmLevel||this.farmLevel,this.marketLevel=e&&e.marketLevel||this.marketLevel,this.researchLevel=e&&e.researchLevel||this.researchLevel,this.collectLevel=e&&e.collectLevel||this.collectLevel},l);function l(e){var t=s.call(this)||this;return t.farmLevel=t.marketLevel=t.researchLevel=t.collectLevel=1,t}n.BuildLevel=c,__reflect(c.prototype,"game.BuildLevel")}(game=game||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.commonDaTanKuang.img_close.visible=!1,this.commonDaTanKuang.blb_title.text="农 场"},o.prototype.updateView=function(e){this.GuildFarmInfo.updateView({type:TopFarmBuild.Farm}),this.updateResBar()},o.prototype.updateResBar=function(){this.resource_bar.updateBar([[1,EPropertyType.EPropertyTypeTopFarmMoney,1]])},o);function o(){var e=i.call(this)||this;return e.farmPy=t.AppFacade.getInstance().retrieveProxy(t.GuildFarmPy.N),e.moneyType=[],e.isEnough=!1,e.skinName="GuildFarmCenterSkin",e}t.GuildFarmCenter=e,__reflect(e.prototype,"game.GuildFarmCenter")}(game=game||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.initList(),this.commonDaTanKuang.img_close.visible=!1,this.commonDaTanKuang.blb_title.text="战士",this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.isEnough){var e={id:TopFarmBuild.Research};t.farmPy.UpGradeBuild(e,function(){t.updateView(),Utils.MsgUtils.addMidMsg("研究所升级成功")})}else Utils.MsgUtils.addMidMsg("道具不足")},this)},o.prototype.initList=function(){this.dataList=new eui.ArrayCollection,this.list_skill.dataProvider=this.dataList},o);function o(){var e=i.call(this)||this;return e.farmPy=t.AppFacade.getInstance().retrieveProxy(t.GuildFarmPy.N),e.index=0,e.isEnough=!1,e.moneyType=[],e.skinName="GuildFarmInstituteSkin",e}t.GuildFarmCollect=e,__reflect(e.prototype,"game.GuildFarmCollect")}(game=game||{}),function(e){var i,t=(i=eui.Component,__extends(o,i),o.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.sl_content.horizontalScrollBar.autoVisibility=!1,this.sl_content.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_content.scrollPolicyV=eui.ScrollPolicy.AUTO,this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.isEnough){var e={id:t.params.type};game.GameMVC.guildFarmPy.UpGradeBuild(e,function(){t.updateView(t.params),DragonBoneTools.playUniqueEffect({effectName:"common_ty_dj",parent:t,y:t.height/2})})}else Utils.MsgUtils.addMidMsg("道具不足")},this)},o.prototype.updateView=function(e){if(e&&e.type){this.params=e;var t=game.GameMVC.guildFarmPy.getBuildLevel(this.params.type)||1;this.updateText(t),this.gp_up.visible=!0,this.lb_build.text="升级效果：";var i=void 0;switch(e.type){case TopFarmBuild.Farm:i=game.Config.farm_farmConfig(),this.lb_name.text="农场",this.img_icon.source="mhnc_img_jianzhu3_png",this.img_icon.scaleX=this.img_icon.scaleY=.5,this.img_icon.bottom=50;break;case TopFarmBuild.Collect:i=game.Config.farm_collectConfig(),this.lb_name.text="采集中心",this.img_icon.source="mhnc_img_jianzhu1_png",this.img_icon.scaleX=this.img_icon.scaleY=.5,this.lb_build.text="建筑效果：";break;case TopFarmBuild.Research:i=game.Config.farm_ResearchConfig(),this.lb_name.text="研究中心",this.img_icon.source="mhnc_img_jianzhu5_png",this.img_icon.scaleX=this.img_icon.scaleY=.5,this.img_icon.bottom=50;break;case TopFarmBuild.Market:i=game.Config.farm_farmConfig(),this.lb_name.text="市场",this.img_icon.source="mhnc_img_jianzhu4_png",this.img_icon.scaleX=this.img_icon.scaleY=.6}if(i){var o=i[t];e.type!=TopFarmBuild.Collect&&(this.lb_name.text=t+"级"+this.lb_name.text);var n=JSON.parse(o.costs);this.lbl_num.text=Utils.MathUtils.formatNumStyle1(n[0][2]);var a=game.GameMVC.backpackPy.getInfoByTypeCodeNum(n[0][0],n[0][1]).haveNum;this.isEnough=a>=n[0][2],UIActionManager.setAbsGrey(this.btn_up,!this.isEnough),this.isEnough?this.lbl_num.font="white_num_fnt":this.lbl_num.font="RedBlackStrocke_fnt",this.playProxy.playerGuildVO.position===EGuildPositionType.EGuildPositionTypePresident||this.playProxy.playerGuildVO.position===EGuildPositionType.EGuildPositionTypeVicePresident?this.btn_up.visible=!0:this.btn_up.visible=!1,i[t+1]&&e.type!=TopFarmBuild.Collect||(this.gp_up.visible=!1)}}},o.prototype.updateText=function(e){var t=void 0;switch(this.params.type){case TopFarmBuild.Farm:t=game.Config.farm_farmConfig();break;case TopFarmBuild.Collect:t=game.Config.farm_collectConfig();break;case TopFarmBuild.Research:t=game.Config.farm_ResearchConfig();break;case TopFarmBuild.Market:t=game.Config.farm_marketConfig()}if(t){var n=t[e],a=t[e+1];a=a||n;var r=[];switch(this.params.type){case TopFarmBuild.Farm:r.push("land");break;case TopFarmBuild.Collect:r.push("maxStar","num");break;case TopFarmBuild.Research:r.push("skillLevel");break;case TopFarmBuild.Market:r.push("upPercent")}var i=game.Config.farm_buildingConfig()[this.params.type],s=[],o=JSON.parse(i.desc),c=0,l=0;o.forEach(function(e){var t=e[0];if(-1!=t.indexOf("%s")){var i=n[r[c]]||"";"upPercent"==r[c]&&(i/=10),s.push({text:t.format([i])+("upPercent"==r[c]?"%":""),style:{textColor:10514758}}),c++}else if(-1!=t.indexOf("%a")){i=n[r[l]]||"";var o=a[r[l]]||"";"upPercent"==r[l]&&(i/=10,o/=10),i<o&&s.push({text:"+"+(o-i)+("upPercent"==r[l]?"%":""),style:{textColor:830208}}),l++,s.push({text:"\n"})}else s.push({text:t,style:{textColor:10514758}}),s.push({text:"\n"})}),this.lb_content.textFlow=s}},o);function o(){var e=i.call(this)||this;return e.isEnough=!1,e.playProxy=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N),e.skinName="GuildFarmInfoComponent",e}e.GuildFarmInfoComponent=t,__reflect(t.prototype,"customui.GuildFarmInfoComponent",["eui.UIComponent","egret.DisplayObject"])}(customui=customui||{}),function(s){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){var a=this;i.prototype.childrenCreated.call(this),this.initTabbar(),this.initList(),this.commonDaTanKuang.onCloseCB=this.hide.bind(this),this.commonDaTanKuang.blb_title.text="研究中心",this.btn_reset.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=a.farmPy.skillInfo.resetNum||1,t=s.Config.farm_skillResetConfigByNum(e).costs,i=0,o=JSON.parse(a.farmPy.skillInfo.skills)||[];for(var n in o)i+=1;0<i?1==e?s.GameMgr.getInstance().showCommonTipsWin({commonTips:"确定要重置当前页签的技能吗，第一次重置免费",clickCB:function(e){if(1===e.type){var t={tab:a.index+1};a.farmPy.ResetResearchSkill(t,function(){a.updateView(),Utils.MsgUtils.addMidMsg("重置成功")})}}}):s.GameMgr.getInstance().showCommonTipsWin({costTips:"，重置当前页签的技能吗",cost:t,clickCB:function(e){if(1===e.type){var t={tab:a.index+1};a.farmPy.ResetResearchSkill(t,function(){a.updateView(),Utils.MsgUtils.addMidMsg("重置成功")})}}}):Utils.MsgUtils.addMidMsg("当前页签未学习任何技能")},this)},t.prototype.initTabbar=function(){var e=[];for(var t in this.ITEM_TYPE_CONFIG){var i=this.ITEM_TYPE_CONFIG[t];i&&e.push({source:i.barSource})}this.tabbar_type.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar_type.dataProvider=new eui.ArrayCollection(e),this.tabbar_type.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this)},t.prototype.onBarItemTap=function(e){if((3==e.itemIndex?4:e.itemIndex)!=this.index){Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=3==e.itemIndex?4:e.itemIndex;var t=this.farmPy.getBuildLevel(TopFarmBuild.Research)||1;this.updateSkillView(t),this.scroller_skill.viewport.scrollV=0,this.scroller_skill.viewport.validateNow(),this.scroller_skill.stopAnimation()}},t.prototype.initList=function(){this.list_skill.itemRenderer=n,this.dataList=new eui.ArrayCollection,this.list_skill.dataProvider=this.dataList,this.playProxy.playerGuildVO.position===EGuildPositionType.EGuildPositionTypePresident||this.playProxy.playerGuildVO.position===EGuildPositionType.EGuildPositionTypeVicePresident?this.btn_reset.visible=!0:this.btn_reset.visible=!1},t.prototype.updateView=function(e){var t=this.farmPy.getBuildLevel(TopFarmBuild.Research)||1;this.GuildFarmInfo.updateView({type:TopFarmBuild.Research}),this.updateSkillView(t),this.updateResBar()},t.prototype.updateResBar=function(){this.resource_bar.updateBar([[1,EPropertyType.EPropertyTypeTopFarmMoney,1]])},t.prototype.updateSkillView=function(e){var t=s.Config.farm_skillConfigByTab(this.index+1),i=[];for(var o in t){var n={info:this.getNowSkillInfo(t[o].type),nowLevel:e,isCan:this.playProxy.playerGuildVO.position===EGuildPositionType.EGuildPositionTypePresident||this.playProxy.playerGuildVO.position===EGuildPositionType.EGuildPositionTypeVicePresident,cb:this.playEffect.bind(this)};i.push(n)}this.dataList.replaceAll(i)},t.prototype.playEffect=function(){this.gp_effect.removeChildren(),DragonBoneTools.playOnce({effectName:"common_ty_dj",parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/2})},t.prototype.getNowSkillInfo=function(e){var t={nowConfig:void 0,nextConfig:void 0,isMax:!1,isZero:!1},i=s.Config.farm_skillConfigByType(e),o=JSON.parse(this.farmPy.skillInfo.skills)||[],n=0;for(var a in o)Number(a)==e&&(n=o[a]);if(0==n)for(var a in t.isZero=!0,t.isMax=!1,i)1==i[a].level&&(t.nowConfig=i[a]);else for(var a in t.isZero=!1,i)i[a].level==n&&(t.nowConfig=i[a],Number(a)==i.length-1&&(t.isMax=!0)),i[a].level==n+1&&(t.nextConfig=i[a]);return t},t);function t(){var e,t=i.call(this)||this;return t.playProxy=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N),t.farmPy=s.AppFacade.getInstance().retrieveProxy(s.GuildFarmPy.N),t.index=0,t.isEnough=!1,t.moneyType=[],t.ITEM_TYPE_CONFIG=((e={})[HeroProfessionType.Warrior-1]={desc:"普通属性",barSource:{up:"_btn_yq_m_json.common_yeqian_putongshuxing_0",down:"_btn_yq_m_json.common_yeqian_putongshuxing_1"},icon:"_guild_skill_m_json.gonghui_img_jineng1"},e[HeroProfessionType.Enchanter-1]={desc:"特殊属性",barSource:{up:"_btn_yq_m_json.common_yeqian_teshushuxing_0",down:"_btn_yq_m_json.common_yeqian_teshushuxing_1"},icon:"_guild_skill_m_json.gonghui_img_jineng2"},e[HeroProfessionType.Pastor-1]={desc:"科技研发",barSource:{up:"_btn_yq_m_json.common_yeqian_kejiyanfa_0",down:"_btn_yq_m_json.common_yeqian_kejiyanfa_1"},icon:"_guild_skill_m_json.gonghui_img_jineng5"},e),t.skinName="GuildFarmInstituteSkin",t}s.GuildFarmInstitute=e,__reflect(e.prototype,"game.GuildFarmInstitute");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){var t=this;o.prototype.childrenCreated.call(this),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.isEnough)if(t.isLevelEnough){var e={type:t.data.info.nowConfig.type};t.farmPy.LearnResearchSkill(e,function(){t.data.cb&&t.data.cb()})}else Utils.MsgUtils.addMidMsg("研究所等级不足");else Utils.MsgUtils.addMidMsg("道具不足")},this)},a.prototype.dataChanged=function(){var e=this.data,t=s.Config.farm_skillConfigByType(e.info.nowConfig.type);this.img_icon.source=e.info.nowConfig.icon+"_png";var i=JSON.parse(e.info.nowConfig.costs);e.info.isZero?this.lb_level.text="0/"+t.length:(e.info.isMax||(i=JSON.parse(e.info.nextConfig.costs)),this.lb_level.text=e.info.nowConfig.level+"/"+t.length),this.lb_name.text=e.info.nowConfig.name;var o=e.info.nowConfig.desc.split("$"),n=[];for(var a in o)if(e.info.isZero){if(0==Number(a)){n.push({text:o[a],style:{textColor:0==Number(a)?6372142:830208}});break}}else n.push({text:o[a],style:{textColor:0==Number(a)?6372142:830208}});this.lb_des.textFlow=n,this.lbl_num.text=Utils.MathUtils.formatNumStyle1(i[0][2]);var r=s.GameMVC.backpackPy.getInfoByTypeCodeNum(i[0][0],i[0][1]).haveNum;this.isEnough=r>=i[0][2],this.lb_isNot.visible=!1,this.lb_level.visible=!0,e.info.isMax?(this.lb_isNot.visible=!1,this.isLevelEnough=!0):(this.isLevelEnough=!!e.info.isZero||e.nowLevel>=e.info.nextConfig.condition,this.lb_isNot.visible=!1,e.info.isZero&&e.info.nowConfig.condition>e.nowLevel?(this.lb_isNot.visible=!0,this.lb_level.visible=!1,this.lb_isNot.text="研究所"+e.info.nowConfig.condition+"级解锁",this.isLevelEnough=!1):!e.info.isZero&&e.info.nextConfig.condition>e.nowLevel&&(this.lb_isNot.visible=!0,this.lb_level.visible=!1,this.lb_isNot.text="研究所"+e.info.nextConfig.condition+"级解锁",this.isLevelEnough=!1)),UIActionManager.setAbsGrey(this.btn_up,!(this.isEnough&&this.isLevelEnough)),this.gp_up.visible=!e.info.isMax,this.btn_isMax.visible=!!e.info.isMax,this.btn_up.visible=e.isCan},a);function a(){var e=o.call(this)||this;return e.isEnough=!1,e.isLevelEnough=!1,e.farmPy=s.AppFacade.getInstance().retrieveProxy(s.GuildFarmPy.N),e.skinName="GuildFarmInstituteItemSkin",e}__reflect(n.prototype,"GuildFarmInstituteItem")}(game=game||{}),function(u){var t,e=(__extends(i,t=BaseFull),i.prototype.autoMakePos=function(){for(var e=0;e<this.initPos.length;e++)if(this.initPos[e][2])for(var t=0;t<this.oneLandCount;t++){var i=Math.floor(t/3),o=t%3,n=this.initPos[e][0]+102*i+102*o,a=this.initPos[e][1]-55*i+55*o;this.landsPos.push([n,a])}else for(t=0;t<this.oneLandCount;t++)i=Math.floor(t/3),o=t%3,n=this.initPos[e][0]+100*i+100*o,a=this.initPos[e][1]+54*i-54*o,this.landsPos.push([n,a])},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.sl_root.bounces=!1,this.sl_root.scrollPolicyV=eui.ScrollPolicy.OFF,this.sl_root.viewport.scrollH=0,this.list_self.itemRenderer=s,this.heromodel.update({code:41050050,isStatic:!0}),this.heromodel.scaleX=-.5,this.heromodel.scaleY=.5,this.btn_center.iconDisplay.pixelHitTest=!0,this.initFarm(),this._activateComponent(),this.sl_root.addEventListener(eui.UIEvent.CHANGE,this.onScrollChange,this)},i.prototype.updateView=function(e){this.updateLand()},i.prototype.showCollectEffect=function(e,t){var i=this,o=this.lands[e.pos-1];if(o){var n=u.Config.farm_seedConfig()[e.seedCode],a=JSON.parse(n.crop)[0][1],r=u.Config.itemConfig()[a];if(r){var s=new eui.Group;s.width=s.height=83,s.horizontalCenter=o.x+105.5-this.gp_farm.width/2,s.verticalCenter=o.y+93-this.gp_farm.height/2,this.gp_farm.addChild(s);var c=new eui.BitmapLabel;c.font="white_num_fnt",c.text=e.num+"",c.right=c.bottom=0,s.addChild(c);var l=new eui.Image;l.source=r.icon+"_png",s.addChild(l),egret.Tween.get(s).to({horizontalCenter:-150-this.gp_farm.width/2,verticalCenter:200-this.gp_farm.height/2},1e3).call(function(){i.gp_farm.removeChild(s),t&&t()})}}},i.prototype.initFarm=function(){for(var e=0;e<this.allLandCount;e++){var t=new n;t.horizontalCenter=this.landsPos[e][0],t.bottom=this.landsPos[e][1],this.lands.push(t),this.gp_farm.addChild(t)}this.gp_farm.$children.sort(function(e,t){return t.bottom-e.bottom})},i.prototype.updateLand=function(e){for(var t=this,i=u.Config.farm_farmConfig(),o=[],n=0,a=1;a<=this.allLandCount;a++){var r=this.lands[a-1];if(r){var s=u.GameMVC.guildFarmPy.getLand(a);if(s)r.update(s),s.playerId==u.GameMVC.playerPy.playerInfoVO.playerId&&o.push(s);else{var c=void 0;if(n<3)for(var l in i){var h=i[l];if(h.land>=a){c=h.farmLevel;break}}n++,r.update({lock:!0,unlockLevel:c})}}}0<o.length?(o[o.length-1].lastOne=!0,this.gp_empty.visible=!1):this.gp_empty.visible=!0,this.list_self.dataProvider=new eui.ArrayCollection(o),this.timer&&egret.clearInterval(this.timer),this.gp_shop.visible=!1,this.nextStatusTime=0,e&&e.fromTick||(this.onTimerTick(),this.hasUpdateLand={});var p=JSON.parse(u.Config.constConfig().TopFarmSpeedUp.constValue),d=u.GameMVC.backpackPy.getInfoByCode(p[0][0][1]);this.cost_speedUp.updateItem({cost:[p[0][0][0],p[0][0][1],d.haveNum],style:CommonIconStyle.RIGHT,needShowHave:!1}),this.timer=egret.setInterval(function(){t.onTimerTick()},this,1e3)},i.prototype.onTimerTick=function(){for(var e=1;e<=this.allLandCount;e++){var t=this.lands[e-1];if(t&&!this.hasUpdateLand[e]){var i=t.updateTime();if(i&&i<0)return this.hasUpdateLand[e]=1,this.timer&&egret.clearInterval(this.timer),void this.updateLand({fromTick:!0})}}if(this.nextStatusTime)Utils.TimerManager.getServerTime()>=this.nextStatusTime&&(this.nextStatusTime=0);else{var o=JSON.parse(u.Config.constConfig().TopFarmShopTime.constValue),n=!1;for(var a in o){var r=o[a],s=Utils.TimerManager.checkIsOpen_FormatA(r);if(s.isOpen){this.gp_shop.visible=!0,this.nextStatusTime=s.endTimeDt,n=!0;break}if(s.openTimeDt>Utils.TimerManager.getServerTime()){this.gp_shop.visible&&u.GameMVC.shopyMed.hideSubView(u.ShopyMediator.SV.COMMON_SHOP),this.gp_shop.visible=!1,this.nextStatusTime=s.openTimeDt,n=!0;break}}n||(this.gp_shop.visible=!1,this.nextStatusTime=Utils.TimerManager.getLeftTime([23,59,59])+Utils.TimerManager.getServerTime())}},i.prototype.hideAll=function(e){e=!e,this.gp_farm.visible=e},i.prototype.hideAllPlayer=function(){for(var e in this.lands){var t=this.lands[e];t.gp_player.visible=!1,t.showWork()}},i.prototype._activateComponent=function(){var e=this;this.btn_center.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hideAll(!0),u.GameMVC.guildFarmMed.showSubView(u.GuildFarmMediator.SV.CENTER,{closeCB:function(){e.hideAll(!1)}})},this),this.btn_maeket.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hideAll(!0),u.GameMVC.guildFarmMed.showSubView(u.GuildFarmMediator.SV.MARKET,{closeCB:function(){e.hideAll(!1)}})},this),this.btn_store_house.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hideAll(!0),u.GameMVC.guildFarmMed.showSubView(u.GuildFarmMediator.SV.STORE_HOUSE,{closeCB:function(){e.hideAll(!1)}})},this),this.gp_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.GameMVC.shopPy.curShopType=ShopType.ShopTypeTopFarm;var e=u.Config.shopWork(ShopType.ShopTypeTopFarm);u.GameMVC.guildFarmPy.GetShopInfo({type:ShopType.ShopTypeTopFarm},function(){u.GameMVC.shopyMed.hideSubView(u.ShopyMediator.SV.COMMON_SHOP),u.GameMVC.shopyMed.hideSubView(u.ShopyMediator.SV.REFRESH_SHOP),u.GameMVC.shopyMed.showSubView(u.ShopyMediator.SV.COMMON_SHOP,{workType:e.workType,shopType:ShopType.ShopTypeTopFarm})})},this),this.btn_collect.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hideAll(!0),u.AppFacade.getInstance().showSubView(u.GuildCollectMediator.N,u.GuildCollectMediator.SV.MAIN,{closeCB:function(){e.hideAll(!1)}})},this),this.btn_institute.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hideAll(!0),u.GameMVC.guildFarmMed.showSubView(u.GuildFarmMediator.SV.INSTITUTE,{closeCB:function(){e.hideAll(!1)}})},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.btn_handleGpLedt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btn_handleGpLedt.touchEnabled=!1,egret.Tween.removeTweens(e.gp_top_left),0==e.gp_top_left.left?egret.Tween.get(e.gp_top_left).to({left:-390},500,egret.Ease.sineInOut).call(function(){e.btn_handleGpLedt.touchEnabled=!0,e.img_arrow.rotation=-90,e.list_self.visible=!1},e):egret.Tween.get(e.gp_top_left).to({left:0},500,egret.Ease.sineInOut).call(function(){e.btn_handleGpLedt.touchEnabled=!0,e.img_arrow.rotation=90,e.list_self.visible=!0},e)},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.GameMVC.commonMed.showHelpDialog(MODULE.TopFarm)},this),this.gp_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hideAllPlayer()},this)},i.prototype.onScrollChange=function(){var t=this.sl_root.viewport.scrollH;this.lands.forEach(function(e){e.x+211+281<t||e.x+281>t+720?e.visible=!1:e.visible=!0})},i.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},i);function i(){var e=t.call(this)||this;return e.allLandCount=75,e.oneLandCount=15,e.initPos=[[-816,702],[-477,532],[-137,360],[204,191],[-571,232,1]],e.landsPos=[],e.nextStatusTime=0,e.hasUpdateLand={},e.skinName="GuildFarmMainView",e.lands=[],e.autoMakePos(),e}u.GuildFarmMainView=e,__reflect(e.prototype,"game.GuildFarmMainView");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){var n=this;o.prototype.childrenCreated.call(this),this.hasInit=!0,this.img_land.pixelHitTest=!0,this.img_plant.pixelHitTest=!0,this.gp_effect.touchEnabled=!1,this.gp_main.touchEnabled=!1,this.gp_main.touchThrough=!0,this.playerhead.addTapEvent(function(){u.AppFacade.getInstance().showSubView(u.FriendMediator.N,u.FriendMediator.SV.INFO,{playerId:n.params.playerId})}),this.pb_time.labelFunction=function(){return""},this.img_land.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.params.lock||n.plant()},this),this.img_plant.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(n.params.nEvent)u.GameMVC.guildFarmPy.getWorkTime()<=0?(Utils.MsgUtils.addMidMsg("今日务农次数已全部用完，请明天再来。"),(e=u.GameMVC.guildFarmMed.getSubView(u.GuildFarmMediator.SV.MAIN))&&e.hideAllPlayer(),n.gp_player.visible=!n.gp_player.visible,n.img_work.visible=!n.gp_player.visible):n.showEffect({type:n.params.nEvent,doneCB:function(){u.GameMVC.guildFarmPy.FarmWork({id:n.params.nEvent,pos:n.params.pos},function(){var e=u.GameMVC.guildFarmMed.getSubView(u.GuildFarmMediator.SV.MAIN);e&&e.updateLand()})}});else if(1==n.params.stage){var e;(e=u.GameMVC.guildFarmMed.getSubView(u.GuildFarmMediator.SV.MAIN))&&e.hideAllPlayer(),n.gp_player.visible=!n.gp_player.visible,n.img_work.visible=!1}else{var o=n.params.seedCode;u.GameMVC.guildFarmPy.Collect({pos:n.params.pos},function(e){var t=u.GameMVC.guildFarmMed.getSubView(u.GuildFarmMediator.SV.MAIN),i=e.clientReward.rewards[0].num;t&&t.showCollectEffect({pos:n.params.pos,seedCode:o,num:i},function(){t&&t.updateLand()})})}},this),this.img_work.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(n.params.lock||n.params.playerId)if(1==n.params.stage)u.GameMVC.guildFarmPy.getWorkTime()<=0?Utils.MsgUtils.addMidMsg("今日务农次数已全部用完，请明天再来。"):n.showEffect({type:n.params.nEvent,doneCB:function(){u.GameMVC.guildFarmPy.FarmWork({id:n.params.nEvent,pos:n.params.pos},function(){var e=u.GameMVC.guildFarmMed.getSubView(u.GuildFarmMediator.SV.MAIN);e&&e.updateLand()})}});else{var o=n.params.seedCode;u.GameMVC.guildFarmPy.Collect({pos:n.params.pos},function(e){var t=u.GameMVC.guildFarmMed.getSubView(u.GuildFarmMediator.SV.MAIN),i=e.clientReward.rewards[0].num;t&&t.showCollectEffect({pos:n.params.pos,seedCode:o,num:i},function(){t&&t.updateLand()})})}else n.plant()},this),this.update(this.params)},a.prototype.update=function(e){var t=this;if(this.hasInit){if(e){this.lastParams=this.params,this.params=e,this.img_plant.visible=!1,this.img_work.visible=!1,this.img_land.visible=!1,this.gp_player.visible=!1,this.img_lock.visible=!1,this.img_self.visible=!1,this.lb_lock.text="";var i=u.Config.farm_seedConfig()[this.params.seedCode];if(this.params.lock)this.img_land.visible=!0,this.img_land.alpha=1,this.params.unlockLevel&&(this.lb_lock.text="农场"+this.params.unlockLevel+"级解锁",this.img_lock.visible=!0);else if(this.params.playerId)if(1==this.params.stage){switch(this.img_plant.visible=!0,this.img_plant.source="mhnc_img_zw01_png",this.img_work.visible=!0,this.params.nEvent){case TopFarmWork.Worm:this.img_work.source="mhnc_img_chuchong_png";break;case TopFarmWork.Water:this.img_work.source="mhnc_img_jiaoshui_png";break;case TopFarmWork.Fat:this.img_work.source="mhnc_img_shifei_png";break;default:this.img_work.visible=!1}this.playerhead.updateData();var o=JSON.parse(i.crop)[0][1],n=u.Config.itemConfig()[o];if(n&&(this.lb_plantName.text=n.name),i){var a=u.GameMVC.guildFarmPy.getTimeBySkill(i.ripeTime);this.pb_time.maximum=a,this.ripeTime=a}this.params.playerId==u.GameMVC.playerPy.playerInfoVO.playerId?this.img_self.visible=!0:this.img_self.visible=!1,u.GameMVC.playerPy.GetPublicPlayerBaseInfo([this.params.playerId],function(e){t.playerhead.updateData({vo:e[0].baseInfo})},300),this.updateTime()}else{var r=u.Config.farm_seedConfig()[this.params.seedCode];r&&(this.img_plant.visible=!0,this.img_plant.source=r.plant_img+"_png",this.params.stealList&&0<=this.params.stealList.indexOf(u.GameMVC.playerPy.playerInfoVO.playerId)?this.img_work.visible=!1:(this.img_work.visible=!0,this.img_work.source="mhnc_img_kecaiji_png")),this.params.playerId==u.GameMVC.playerPy.playerInfoVO.playerId?this.img_self.visible=!0:this.img_self.visible=!1}else this.img_work.visible=!0,this.img_land.alpha=.2,this.img_land.visible=!0,this.img_work.source="mhnc_img_kongxian_png"}}else this.params=e},a.prototype.showWork=function(){if(this.img_work.visible=!1,1==this.params.stage)switch(this.img_work.visible=!0,this.params.nEvent){case TopFarmWork.Worm:this.img_work.source="mhnc_img_chuchong_png";break;case TopFarmWork.Water:this.img_work.source="mhnc_img_jiaoshui_png";break;case TopFarmWork.Fat:this.img_work.source="mhnc_img_shifei_png";break;default:this.params.playerId?this.img_work.visible=!1:this.img_work.source="mhnc_img_kongxian_png"}else this.params.playerId&&(this.params.stealList&&0<=this.params.stealList.indexOf(u.GameMVC.playerPy.playerInfoVO.playerId)?this.img_work.visible=!1:(this.img_work.visible=!0,this.img_work.source="mhnc_img_kecaiji_png"))},a.prototype.plant=function(){var t=this,e=u.GameMVC.guildFarmPy.getSelfLandCount(),i=parseInt(u.Config.constConfig().TopFarmPlayerLandCount.constValue);i<=e?Utils.MsgUtils.addMidMsg("每人最多同时种植"+i+"块地"):PopUpManager.addPopUp({obj:new u.CommonChosePanel({getInfos:function(){var e={},t=u.GameMVC.backpackPy.AllItemInfo;for(var i in t){var o=u.GeneralConfig.getEntityConfigByCode(EEntityType.EEntityTypeItem,i);o&&o.type==EPropType.EPropTypeTopFarmSeed&&(e[i]={code:i,type:EEntityType.EEntityTypeItem,num:t[i][0].num})}return e},isOnlyCode:!0,type:EEntityType.EEntityTypeItem,checkFull:function(e){return 1<=e.length},sortFunc:function(e,t){return e.info.code-t.info.code},selectUuids:[],fullTip:"一块地只能种植一种作物",title:"请选择种子"}),closeCB:function(e){e[0]&&t.showEffect({doneCB:function(){u.GameMVC.guildFarmPy.Plant({pos:t.params.pos,code:parseInt(e[0])})}})}})},a.prototype.updateTime=function(){if(this.ripeTime&&this.params.plantDt&&this.params.playerId){var e=Utils.TimerManager.getServerTime()-this.params.plantDt;return(this.pb_time.value=e)<this.ripeTime&&(this.bm_time.text=Utils.TimerManager.getFormatBySecond3(this.ripeTime-e)),e>this.ripeTime/2&&(this.img_plant.source="mhnc_img_zw02_png"),this.ripeTime-e}},a.prototype.showEffect=function(e){this.img_work.visible=!1;var t="common_nc_chanzi";switch(GameRootLayer.gameLayer().switchTouchEnable(!1),e.type){case TopFarmWork.Worm:t="common_nc_chuchong";break;case TopFarmWork.Water:t="common_nc_shuihu";break;case TopFarmWork.Fat:t="common_nc_huafei"}DragonBoneTools.playOnce({effectName:t,parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/2,doneCB:function(){GameRootLayer.gameLayer().switchTouchEnable(!0),e.doneCB&&e.doneCB()}})},a.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},a);function a(){var e=o.call(this)||this;return e.hasInit=!1,e.ripeTime=0,e.skinName="GuildFarmItem",e}__reflect(n.prototype,"GuildFarmItem");var r,s=(r=eui.ItemRenderer,__extends(c,r),c.prototype.childrenCreated=function(){var n=this;r.prototype.childrenCreated.call(this),this.pb.labelFunction=function(){return""},this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(2==n.data.stage){var o=n.data.seedCode;u.GameMVC.guildFarmPy.Collect({pos:n.data.pos},function(e){var t=u.GameMVC.guildFarmMed.getSubView(u.GuildFarmMediator.SV.MAIN),i=e.clientReward.rewards[0].num;t&&t.showCollectEffect({pos:n.data.pos,seedCode:o,num:i},function(){t&&t.updateLand()})})}else u.GameMVC.guildFarmPy.getWorkTime()<=0?Utils.MsgUtils.addMidMsg("今日务农次数已全部用完，请明天再来。"):u.GameMVC.guildFarmPy.FarmWork({id:n.data.nEvent,pos:n.data.pos},function(){var e=u.GameMVC.guildFarmMed.getSubView(u.GuildFarmMediator.SV.MAIN);e&&e.updateLand()})},this),this.btn_speedUp.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new h({seedCode:n.data.seedCode,plantDt:n.data.plantDt,pos:n.data.pos})})},this)},c.prototype.dataChanged=function(){var e=this,t=this.data.seedCode,i=u.Config.farm_seedConfig()[t];if(this.timer&&egret.clearInterval(this.timer),i){var o=JSON.parse(i.crop)[0][1],n=u.Config.itemConfig()[o];n&&(this.baseitem.updateData({code:o}),this.lb_name.text=n.name),this.pb.value=0;var a=u.GameMVC.guildFarmPy.getTimeBySkill(i.ripeTime);this.pb.maximum=a;var r=Utils.TimerManager.getServerTime()-this.data.plantDt;this.pb.value=r,this.bm_time.text=a<r?"已成熟":Utils.TimerManager.getFormatBySecond3(a-r),this.timer=egret.setInterval(function(){e.pb.value=r++,e.bm_time.text=a<r?"已成熟":Utils.TimerManager.getFormatBySecond3(a-r)},this,1e3)}if(1==this.data.stage)switch(this.btn_speedUp.visible=!0,this.data.nEvent){case TopFarmWork.Worm:this.btn_ope.icon="mhnc_btn_chuchong_png";break;case TopFarmWork.Water:this.btn_ope.icon="mhnc_btn_jiaoshui_png";break;case TopFarmWork.Fat:this.btn_ope.icon="mhnc_btn_shifei_png";break;default:this.btn_ope.visible=!1}else this.btn_ope.icon="mhnc_btn_shoucheng_png",this.btn_speedUp.visible=!1;this.data.lastOne},c.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},c);function c(){var e=r.call(this)||this;return e.skinName="GuildFarmLeftTipItem",e}__reflect(s.prototype,"GuildFarmLeftTipItem");var l,h=(__extends(p,l=BasePanel),p.prototype.childrenCreated=function(){var t=this;l.prototype.childrenCreated.call(this),this.pb.labelFunction=function(){return""},this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<t.addNum?Utils.Socket.send("topFarm","SpeedUp",{pos:t.params.pos,num:t.addNum}).then(function(e){DragonBoneTools.playOnce({effectName:"common_jiasucg",parent:GameRootLayer.gameLayer().popMsgLayer}),t.hide()}):Utils.MsgUtils.addMidMsg("至少选择1个")},this),this.updateView()},p.prototype.updateView=function(){var t=this,e=u.Config.farm_seedConfig()[this.params.seedCode],i=JSON.parse(e.crop)[0][1],o=u.Config.itemConfig()[i];o&&(this.baseitem.updateData({code:i}),this.lb_name.text=o.name),this.pb.value=0;var n=u.GameMVC.guildFarmPy.getTimeBySkill(e.ripeTime);this.pb.maximum=n,this.passTime=Utils.TimerManager.getServerTime()-this.params.plantDt,this.passTime>n?this.bm_time.text="成熟":this.bm_time.text=Utils.TimerManager.getFormatBySecond3(n-this.passTime);var a=JSON.parse(u.Config.constConfig().TopFarmSpeedUp.constValue);this.CommonResourceBar.updateBar(a[0]);var r=Math.ceil((n-this.passTime)/a[1]);this.pb.value=this.passTime+this.addNum*a[1],this.CommonBatchNum.update({minBuyNum:1,maxBuyNum:r,onUpdate:function(e){t.addNum=e,t.pb.value=t.passTime+t.addNum*a[1],t.pb.value>n?t.bm_time.text="成熟":t.bm_time.text=Utils.TimerManager.getFormatBySecond3(n-t.pb.value)}}),this.timer=egret.setInterval(function(){t.pb.value=++t.passTime+t.addNum*a[1],Math.ceil((n-t.passTime)/a[1])<r&&(r=Math.ceil((n-t.passTime)/a[1]),t.CommonBatchNum.update({minBuyNum:0,maxBuyNum:r,onUpdate:function(e){t.addNum=e}})),t.pb.value>n?t.bm_time.text="成熟":t.bm_time.text=Utils.TimerManager.getFormatBySecond3(n-t.pb.value)},this,1e3)},p.prototype.onDestroy=function(){l.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer)},p);function p(e){var t=l.call(this)||this;return t.timer=0,t.passTime=0,t.addNum=1,t.skinName="GuildFarmSpeedUpPanelSkin",t.params=e,t}__reflect(h.prototype,"GuildFarmSpeedUpPanel")}(game=game||{}),function(a){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.list_root.itemRenderer=n,this.CommonDaTanChuKuang.onCloseCB=this.hide.bind(this),this.sl_root.bounces=!1,this.CommonDaTanChuKuang.blb_title.text="市 场",this.GuildFarmInfo.updateView({type:TopFarmBuild.Market}),this.updateView()},t.prototype.updateView=function(){var e=a.GameMVC.backpackPy.getItemsBySubType(EPropType.EPropTypeTopFarmCrop),t=[],i=a.Config.farm_fruitConfig();e.forEach(function(e){i[e]&&!i[e].flag&&t.push({code:e})}),this.gp_empty.visible=0==t.length,this.list_root.dataProvider=new eui.ArrayCollection(t),this.updateResBar()},t.prototype.updateResBar=function(){this.resource_bar.updateBar([[1,EPropertyType.EPropertyTypeTopFarmMoney,1]])},t);function t(e){var t=i.call(this)||this;return t.skinName="GuildFarmMarket",t.params=e,t}a.GuildFarmMarket=e,__reflect(e.prototype,"game.GuildFarmMarket");var o,n=(o=eui.ItemRenderer,__extends(r,o),r.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.baseitem.touchEnabled=!1,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.onTouch()},this)},r.prototype.dataChanged=function(){this.update()},r.prototype.onTouch=function(){var t=this,e=a.AppFacade.getInstance().retrieveMediator(a.ShopyMediator.N),i=a.GameMVC.backpackPy.getInfoByCode(this.data.code),o=a.Config.farm_fruitConfig()[this.data.code],n=JSON.parse(o.rewards)[0];e.showSubView(a.ShopyMediator.SV.SHOP_SELL_NUM,{shopConfig:{rewards:o.rewards,costs:"[[3, "+this.data.code+", 1]]",name:i.info.name,countFun:function(e){var t=a.GameMVC.guildFarmPy.getMarketUpPercent();return{total:Math.floor(parseInt(n[2])*e*t),unit:e}},info:{code:this.data.code,sellRewards:o.rewards}},maxCount:i.haveNum,doneCB:function(e){e&&e.num&&a.GameMVC.guildFarmPy.ExChange({code:parseInt(t.data.code),num:e.num})}})},r.prototype.update=function(){var e=this.data.code;if(e){var t=a.GameMVC.backpackPy.getInfoByCode(e);this.baseitem.updateData({code:e,num:t.haveNum})}},r);function r(){var e=o.call(this)||this;return e.skinName="GuildFarmMarketItem",e}__reflect(n.prototype,"GuildFarmMarketItem")}(game=game||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.updateView(this.params)},o.prototype.updateView=function(e){e&&(this.params=e,this.gp_rewards.removeChildren(),t.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,e.rewards),this.lb_desc.text=e.desc,this.lb_title.text=e.title,this.img_model.source=e.model)},o.prototype.onDestroy=function(){this.params.closeCB&&this.params.closeCB()},o);function o(e){var t=i.call(this)||this;return t.skinName="GuildFarmRewardPanel",t.params=e,t}t.GuildFarmRewardPanel=e,__reflect(e.prototype,"game.GuildFarmRewardPanel")}(game=game||{}),function(){function e(){}(game||(game={})).GuildFarmShop=e,__reflect(e.prototype,"game.GuildFarmShop")}(),function(l){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList()},i.prototype.initList=function(){this.ac_list=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_list,this.list_item.itemRenderer=n},i.prototype.updateView=function(e){var t=[],i={},o=l.GameMVC.backpackPy.AllItemInfo,n=l.Config.farm_fruitConfig();for(var a in o){var r=o[a][0],s=l.Config.itemConfig()[Number(a)];s.type==EPropType.EPropTypeTopFarmCrop&&(e&&e.fromShop?n[a]&&n[a].flag&&(s.num=r.num,i[""+a]=s):(s.num=r.num,i[""+a]=s))}for(var a in i){var c=i[a];t.push({info:c,fromShop:e&&e.fromShop})}this.ac_list.replaceAll(t),0<t.length?this.gp_empty.visible=!1:this.gp_empty.visible=!0},i);function i(){var e=t.call(this)||this;return e.skinName="GuildFarmStoreHouseSkin",e}l.GuildFarmStoreHouse=e,__reflect(e.prototype,"game.GuildFarmStoreHouse");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.gp_bi.addChild(this.baseItem)},a.prototype.dataChanged=function(){var o=this;this.data.fromShop&&(this.baseItem.touchEnabled=!1,this.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=o.data.info.id,e=l.AppFacade.getInstance().retrieveMediator(l.ShopyMediator.N),i=l.GameMVC.backpackPy.getInfoByCode(t);e.showSubView(l.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:{rewards:"",costs:"[[3, "+t+", 1]]",countFun:function(e){return{unit:1,total:e}},name:i.info.name},maxCount:i.haveNum,buyNum:0,btnLabel:"出售",costTip:"出售消耗",limitTip:"出售次数",doneCB:function(e){l.GameMVC.guildFarmPy.ExChange({code:parseInt(t),num:e.num})}})},this)),this.baseItem.updateData({code:this.data.info.id,type:EEntityType.EEntityTypeItem,num:this.data.info.num}),this.baseItem.blb_num.text=this.data.info.num+"",this.gp_chosen.visible=!1,this.gp_lock.visible=!1},a);function a(){var e=o.call(this)||this;return e.skinName="CommonChosePanelItem",e}__reflect(n.prototype,"CommonChosePanelItem")}(game=game||{}),function(n){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.daTanChuKuang.onCloseCB=function(){n.AppFacade.getInstance().hideSubView(n.GuildSkillMediator.N,n.GuildSkillMediator.SV.ESC)},this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.GuildSkillPy.ResetGuildSkill(e.index)},this)},i.prototype.updateView=function(e){this.index=e;var t=1;t=this.GuildSkillPy.restNum<=0?1:7<=this.GuildSkillPy.restNum?6:this.GuildSkillPy.restNum+1;var i=n.Config.guild_skill_reset()[t],o=JSON.parse(i.costs);this.btn.updateData({cost:o[0],text:o[0]?"重置":"免费"})},i);function i(){var e=t.call(this)||this;return e.index=1,e.skinName="GuildSkillEscSkin",e.GuildSkillPy=n.AppFacade.getInstance().retrieveProxy(n.GuildSkillPy.N),e.daTanChuKuang.blb_title.text="重置",e}n.GuildSkillEscView=e,__reflect(e.prototype,"game.GuildSkillEscView")}(game=game||{}),function(v){var i,e=(__extends(t,i=BasePanel),t.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_guild_skill")},t.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cu_resBar),this.commonDaTanKuang.blb_title.text=this.ITEM_TYPE_CONFIG[0].desc,this.btn_maxLevel.visible=!1,this.initList()},t.prototype.initTabbar=function(){var e=[];for(var t in this.ITEM_TYPE_CONFIG){var i=this.ITEM_TYPE_CONFIG[t];i&&e.push({source:i.barSource})}this.tabbar_type.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar_type.dataProvider=new eui.ArrayCollection(e),this.tabbar_type.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this)},t.prototype.initUI=function(){var e=[EPropertyType.EPropertyTypeDevote,EPropertyType.EPropertyTypeGold];this.cu_resBar.updateBar({costs:e,width:190,needAdd:!0})},t.prototype.initButton=function(){var o=this;function e(e){t.skillView["skill"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.updateSkillSelect(e)})}this.commonDaTanKuang.onCloseCB=function(){v.AppFacade.getInstance().sendNotification(CN.MAIL_CLOSE_MAIN),v.AppFacade.getInstance().hideSubView(v.GuildSkillMediator.N,v.GuildSkillMediator.SV.MAIN)},this.uplevel_bnt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=o.getConfig(o.index,o.select,1);o.GuildSkillPy.LearnGuildSkill(o.index+1,e.type,function(e){DragonBoneTools.playUniqueEffect({effectName:"common_ty_dj",parent:o,x:o.width/2,y:o.height/4,timeScale:1}),DragonBoneTools.playUniqueEffect({effectName:"common_kejizhongxin",parent:o.gp_effect}),o.GuildSkillPy.updateGuildSkillInfo(e.info),v.AppFacade.getInstance().updateView(v.GuildSkillMediator.N,v.GuildSkillMediator.SV.MAIN)})},this),this.rest.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=Object.keys(v.Config.guild_skill_reset()).length,t=1;t=o.GuildSkillPy.restNum<=0?1:o.GuildSkillPy.restNum>=e?e:o.GuildSkillPy.restNum+1;var i=v.Config.guild_skill_reset()[t];i.costs?v.GameMgr.getInstance().showCommonTipsWin({costTips:"钻石重置当前职业\n的公会科技,并返回之前消耗的公会\n币和金币。",source:"guild_skill_time",cost:i.costs,cb:!0,clickCB:function(e){1===e.type&&o.GuildSkillPy.ResetGuildSkill(o.index)}}):v.GameMgr.getInstance().showCommonTipsWin({commonTips:"重置当前职业的公会科技将花费一\n定数额钻石,并返回之前消耗的公会\n币和金币，第一次重置免费。",cb:!1,btnLabel:{cancel:"取消",sure:"重置"},clickCB:function(e){0===e.type||1===e.type&&o.GuildSkillPy.ResetGuildSkill(o.index)}})},this);for(var t=this,i=0;i<8;i++)e(i)},t.prototype.initList=function(){this.initTabbar(),this.initButton()},t.prototype.onBarItemTap=function(e){(3==e.itemIndex?4:e.itemIndex)!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.commonDaTanKuang.blb_title.text=this.ITEM_TYPE_CONFIG[3==e.itemIndex?4:e.itemIndex].desc,this.index=3==e.itemIndex?4:e.itemIndex,this.updateSkillView())},t.prototype.addNotice=function(){},t.prototype.updateView=function(e){this.updateSkillView()},t.prototype.chageSelect=function(e){this.skillView["skill"+this.select].select.visible=!1,this.skillView["skill"+e].select.visible=!0},t.prototype.updateSkillSelect=function(e){var t=this;this.chageSelect(e),this.select=e;var i=this.getConfig(this.index,this.select,1),o=this.GuildSkillPy.GetProSkillInfo(this.index+1,i.type)||0,n=this.getConfig(this.index,this.select,o),a=this.getConfig(this.index,this.select,o+1);this.gp_cost.visible=this.com0.addAttr.visible=this.com0.jiantou.visible=n;var r=!1;if(n){var s=JSON.parse(n.attrAdd),c=a&&JSON.parse(a.attrAdd);this.gp_com.removeChildren();for(var l=0;l<s.length;++l){var h=0<o?this.ITEM_TYPE_CONFIG[this.index].desc+v.GeneralConfig.getAttrName(s[l][0])+"+"+v.GeneralConfig.getAttrValue(s[l][1]):this.ITEM_TYPE_CONFIG[this.index].desc+v.GeneralConfig.getAttrName(s[l][0])+"+0",p="+"+(c&&v.GeneralConfig.getAttrValue(c[l][1])||"0"),d=new T;d.updateData({nameTip:h,addAttr:p,isMaxLevel:!a&&0<o}),this.gp_com.addChild(d)}this.uplevel_bnt.visible=c||!1,this.gp_cost.visible=c||!1,this.btn_maxLevel.visible=!c,this.btn_maxLevel.y=this.gp_com.y+this.gp_com.height+10,this.gp_cost.removeChildren();var u=JSON.parse(a?a.costs:n.costs);for(var g in u){var f=u[g];this.gp_cost.addChild(new customui.CommonIconWithNum({cost:f,style:CommonIconStyle.RIGHT,needBg:!0}))}function _(){var e=JSON.parse(n.condition);0!=e.length&&t.GuildSkillPy.GetProSkillInfo(t.index+1,e[0][0])<e[0][1]?t.redTip.text="需要上一个技能达到"+e[0][1]+"级":t.redTip.text=""}this.gp_cost.visible=!0,UIActionManager.setAbsGrey(this.uplevel_bnt,!1),this.uplevel_bnt.touchEnabled=!0;var m=v.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.GuildSkill,{id:o+1});m.isBelonged?m.unlock?_():(this.redTip.text="封印之地玩法解锁",UIActionManager.setAbsGrey(this.uplevel_bnt,!0),this.uplevel_bnt.touchEnabled=!1,r=!(this.gp_cost.visible=!1)):_()}else a&&(c=JSON.parse(a.attrAdd),this.com0.nameTip.text=this.ITEM_TYPE_CONFIG[this.index].desc+v.GeneralConfig.getAttrName(c[0][0])+"+"+v.GeneralConfig.getAttrValue(c[0][1]),this.redTip.text="",this.uplevel_bnt.visible=!1);var y=this.btn_maxLevel.visible?this.btn_maxLevel:this.gp_com;this.redTip.y=y.height+y.y+10,this.fulllevel.visible=!r&&!this.uplevel_bnt.visible,this.zy.text=this.getConfig(this.index,this.select,o).name,0==o&&(this.zy.text=this.zy.text.slice(0,this.zy.text.length-1)+"0")},t.prototype.updateSkill=function(e){var t=new egret.ColorMatrixFilter(this.EntrancePy.ColorMatrix()),i=this.getConfig(this.index,e,1),o=this.GuildSkillPy.GetProSkillInfo(this.index+1,i.type),n=this.getConfig(this.index,e,o+1),a=this.getConfig(this.index,e,o),r=this.skillView["skill"+e];if(r.jh.visible=!1,r.icon.filters=[],n){JSON.parse(n.attrAdd),JSON.parse(a.attrAdd);var s=JSON.parse(n.condition);0!=s.length&&this.GuildSkillPy.GetProSkillInfo(this.index+1,s[0][0])<s[0][1]?0==o&&(r.icon.filters=[t]):0==o&&(r.jh.visible=!0)}},t.prototype.updateSkillView=function(){this.skillView.occupationIcon.source=this.ITEM_TYPE_CONFIG[this.index].icon;for(var e=0;e<8;e++){var t=this.getConfig(this.index,e,1),i=this.skillView["skill"+e];i.icon.source=ResourceUtils.png(t.icon);var o=this.GuildSkillPy.GetProSkillInfo(this.index+1,t.type);i.text.text=o+"/"+this.GuildSkillPy.getMaxLevelOfType(t.type),this.updateSkill(e)}this.updateSkillSelect(this.select),this.initUI()},t.prototype.getConfig=function(e,t,i){var o=e+1+"0"+(t+1)+this.callBackLevel(i||1);return v.Config.guildSkillConfig()[Number(o)]},t.prototype.callBackLevel=function(e){return e<=9?"00"+e:e<=99?"0"+e:100<=e?e:"001"},t.prototype.perClose=function(){v.AppFacade.getInstance().updateView(v.GuildMediator.N,v.GuildMediator.SV.MAIN_MAP)},t);function t(){var e,t=i.call(this)||this;return t.index=0,t.select=0,t.skillConfig=[],t.playerProxy=v.AppFacade.getInstance().retrieveProxy(v.PlayerPy.N),t.ITEM_TYPE_CONFIG=((e={})[HeroProfessionType.Warrior-1]={desc:"战士",barSource:{up:"_btn_yq_m_json.common_yeqian_zhanshi_0",down:"_btn_yq_m_json.common_yeqian_zhanshi_1"},icon:"_guild_skill_m_json.gonghui_img_jineng1"},e[HeroProfessionType.Enchanter-1]={desc:"法师",barSource:{up:"_btn_yq_m_json.common_yeqian_fashi_0",down:"_btn_yq_m_json.common_yeqian_fashi_1"},icon:"_guild_skill_m_json.gonghui_img_jineng2"},e[HeroProfessionType.Pastor-1]={desc:"牧师",barSource:{up:"_btn_yq_m_json.common_yeqian_mushi_0",down:"_btn_yq_m_json.common_yeqian_mushi_1"},icon:"_guild_skill_m_json.gonghui_img_jineng5"},e[HeroProfessionType.Hunter-1]={desc:"游侠",barSource:{up:"_btn_yq_m_json.common_yeqian_youxia_0",down:"_btn_yq_m_json.common_yeqian_youxia_1"},icon:"_guild_skill_m_json.gonghui_img_jineng3"},e),Utils.AssetsMgr.loadGroup("group_guild_skill"),t.skinName="GuildSkillSkin",t.GuildSkillPy=v.AppFacade.getInstance().retrieveProxy(v.GuildSkillPy.N),t.EntrancePy=v.AppFacade.getInstance().retrieveProxy(v.CopyEntrancePy.N),t}v.GuildSkillMainView=e,__reflect(e.prototype,"game.GuildSkillMainView");var o,T=(o=eui.Component,__extends(n,o),n.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this)},n.prototype.updateData=function(e){this.nameTip.text=e.nameTip,this.addAttr.text=e.addAttr,e.isMaxLevel&&e.addAttr&&(this.nameTip.parent.removeChild(this.addAttr),this.nameTip.parent.removeChild(this.jiantou))},n);function n(){var e=o.call(this)||this;return e.skinName="GuildSkillSayItem",e}v.GuildSkillSayItem=T,__reflect(T.prototype,"game.GuildSkillSayItem")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.GuildSkillMainView),this.addSubView(n.SV.ESC,i.GuildSkillEscView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.MONEY_UPDATE]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:this.guildxy.isInGuild()&&this.proxy.GetGuildSkillInfo();break;case CN.MONEY_UPDATE:var t=this.getSubView(n.SV.MAIN);t&&t.initUI()}},n.N="GuildSkillMediator",n.SV={MAIN:1,ESC:2},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.guildxy=i.AppFacade.getInstance().retrieveProxy(i.GuildPy.N),t.proxy=i.AppFacade.getInstance().retrieveProxy(i.GuildSkillPy.N),t}i.GuildSkillMediator=e,__reflect(e.prototype,"game.GuildSkillMediator")}(game=game||{}),function(i){var e=(t.registerAll=function(){(new n).register(),(new s).register()},t);function t(){}i.GuildSkillProcessor=e,__reflect(e.prototype,"game.GuildSkillProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){var t=e.getBody();t.type,i.AppFacade.getInstance().retrieveProxy(i.GuildSkillPy.N).updateGuildSkillInfo(t.info)},a);function a(){return o.call(this,"guildSkill.GetGuildSkillInfoR",a)||this}i.GetGuildSkillInfoR=n,__reflect(n.prototype,"game.GetGuildSkillInfoR");var r,s=(r=i.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody();console.log("LearnGuildSkillR",t),i.AppFacade.getInstance().retrieveProxy(i.GuildSkillPy.N).updateGuildSkillInfo(t.info)},c);function c(){return r.call(this,"guildSkill.LearnGuildSkillR",c)||this}i.LearnGuildSkillR=s,__reflect(s.prototype,"game.LearnGuildSkillR")}(game=game||{}),function(a){var t,e=(__extends(i,t=BaseProxy),i.prototype.updateGuildSkillInfo=function(e){this.skillInfo=e.skillList,this.restNum=e.resetNum,a.AppFacade.getInstance().updateView(a.GuildSkillMediator.N,a.GuildSkillMediator.SV.MAIN)},i.prototype.GetGuildSkillInfo=function(){var t=this;Utils.Socket.send("guildSkill","GetGuildSkillInfo",{}).then(function(e){t.log("工会技能信息   GetGuildSkillInfoR",e),t.updateGuildSkillInfo(e.info),a.AppFacade.getInstance().updateView(a.GuildSkillMediator.N,a.GuildSkillMediator.SV.MAIN)})},i.prototype.GetProSkillInfo=function(e,t){for(var i=0;i<this.skillInfo.length;i++)if(this.skillInfo[i].professionType==e){var o=JSON.parse(this.skillInfo[i].skill);for(var n in o)if(Number(n)==t)return o[n]}return 0},i.prototype.LearnGuildSkill=function(e,t,i){var o=this;Utils.Socket.send("guildSkill","LearnGuildSkill",{professionType:e,type:t}).then(function(e){e.err||(o.log("技能学习   LearnGuildSkillR",e),i&&i(e))}).catch(function(e){o.log(e)})},i.prototype.ResetGuildSkill=function(e){var t=this;Utils.Socket.send("guildSkill","ResetGuildSkill",{professionType:e+1}).then(function(e){Utils.MsgUtils.addMidMsg("重置成功"),t.log("重置   ResetGuildSkillR",e),t.updateGuildSkillInfo(e.info),a.AppFacade.getInstance().hideSubView(a.GuildSkillMediator.N,a.GuildSkillMediator.SV.ESC),a.AppFacade.getInstance().updateView(a.GuildSkillMediator.N,a.GuildSkillMediator.SV.MAIN)})},i.prototype.getMaxLevelOfType=function(e){var t=0;if(this.skillMaxLevelCache[e])t=this.skillMaxLevelCache[e];else{var i=a.Config.guildSkillConfig();for(var o in i){var n=i[o];n.type==e&&n.level>t&&(t=n.level)}this.skillMaxLevelCache[e]=t}return t},i.N="GuildSkillPy",i);function i(){var e=t.call(this,i.N)||this;return e.skillMaxLevelCache={},e.skillInfo={},e.restNum=1,e}a.GuildSkillPy=e,__reflect(e.prototype,"game.GuildSkillPy")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.GuildWarMainView),this.addSubView(n.SV.FORMATION,i.GuildWarFormationPanel),this.addSubView(n.SV.SEQ,i.GuildWarSelectSeqPanel),this.addSubView(n.SV.RECORD,i.GuildWarBattleRecordPanel),this.addSubView(n.SV.ENROLL,i.GuildWarEnrollPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.GUILD_INFO_UPDATE,CN.GENERAL_PASS_DAY]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GUILD_INFO_UPDATE:this.gwProxy.initSchedule(),i.GameMVC.guildWarPy.getGuildWarStatus()!=GuildWarStatus.Close&&this.guildPy.isInGuild()&&this.gwProxy.GetGuildWarInfo();break;case CN.GENERAL_PASS_DAY:this.gwProxy.initSchedule()}},n.N="GuildWarMediator",n.SV={MAIN:1,FORMATION:2,SEQ:3,RECORD:4,ENROLL:5},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.guildPy=i.AppFacade.getInstance().retrieveProxy(i.GuildPy.N),t.gwProxy=i.AppFacade.getInstance().retrieveProxy(i.GuildWarPy.N),t}i.GuildWarMediator=e,__reflect(e.prototype,"game.GuildWarMediator")}(game=game||{}),function(o){var e=(t.registerAll=function(){(new n).register(),(new s).register()},t);function t(){}o.GuildWarProcessor=e,__reflect(e.prototype,"game.GuildWarProcessor");var i,n=(i=o.ProcessorBase,__extends(a,i),a.prototype.execute=function(e){var t=e.getBody();console.log("WarGuildInfoP",t);var i=o.AppFacade.getInstance().retrieveProxy(o.GuildWarPy.N);i.updateInfo(t),o.AppFacade.getInstance().updateView(o.GuildWarMediator.N,o.GuildWarMediator.SV.MAIN),o.AppFacade.getInstance().updateView(o.GuildWarMediator.N,o.GuildWarMediator.SV.FORMATION),i.curStatus!=GuildWarStatus.Battle&&i.curStatus!=GuildWarStatus.Close&&(i.recordController=void 0)},a);function a(){return i.call(this,"guildWar.WarGuildInfoP",a)||this}__reflect(n.prototype,"WarGuildInfoP");var r,s=(r=o.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody();console.log("BattleRecordP",t),o.AppFacade.getInstance().retrieveProxy(o.GuildWarPy.N).updateBattleRecord(t.records)},c);function c(){return r.call(this,"guildWar.BattleRecordP",c)||this}__reflect(s.prototype,"BattleRecordP")}(game=game||{}),function(r){var t,i=(__extends(o,t=BaseProxy),o.prototype.addNotice=function(){var e=this;NoticeManager.registerCB(NT.GUILD_WAR,function(){return e.curStatus!=GuildWarStatus.Close&&e.nowEnrollable()&&!e.selfInfo.selfEnrolled},this,MODULE.GuildWar)},o.prototype.initSchedule=function(){if(this._schedule.resetSchedule(),this.constValue.GuildWarDailyRewards=JSON.parse(r.Config.constConfig().GuildWarDailyRewards.constValue),this.constValue.GuildWarEnrollLimit=Number(r.Config.constConfig().GuildWarEnrollLimit.constValue),this.constValue.GuildWarRouteLimit=Number(r.Config.constConfig().GuildWarRouteLimit.constValue),r.GameMVC.loginPy.loginGameVO.singleSign)this._schedule.addSchedule(GuildWarStatus.Close,[1,2,3,4,5,6,7],[[0,0],[24,0]]);else{var e=this.constValue.GuildWarDt=JSON.parse(r.Config.constConfig().GuildWarDt.constValue),t=0!=e[2],i=[e[0][0]];this._schedule.addSchedule(GuildWarStatus.Enroll,i,[e[0][1],e[0][2]],!t),this._schedule.addSchedule(GuildWarStatus.Wait,i,[e[0][2],[24,0]],!t),this._schedule.addSchedule(GuildWarStatus.Close,[1,2,3,4,5,6],[[0,0],[24,0]],!t);for(var o=[],n=e[0][0]+1;n<=e[0][0]+e[1][0];n++){var a=(n-1)%7+1;o.push(a)}this._schedule.addSchedule(GuildWarStatus.Adjust,o,[e[1][1],e[1][2]],t),this._schedule.addSchedule(GuildWarStatus.WaitBattle,o,[e[1][2],e[1][3]],t),this._schedule.addSchedule(GuildWarStatus.Battle,o,[e[1][3],e[1][4]],t),this._schedule.addSchedule(GuildWarStatus.BattleEnd,o,[e[1][4],[24,0]],t),this._schedule.addSchedule(GuildWarStatus.Close,7,[[0,0],[24,0]],t)}},o.prototype.getOpenInfo=function(){var e={isOpen:!1,status:0,remainingTime:0};return e.status=this.getGuildWarStatus(),e.isOpen=e.status!=GuildWarStatus.NotOpen&&e.status!=GuildWarStatus.Close,e.remainingTime=this._schedule.getCurrentTimeInterval().endDt-Utils.TimerManager.getServerTime(!1),e},o.prototype.getGuildWarStatus=function(){var e;if(Utils.UnlockMgr.checkPass(MODULE.GuildWar,!1).allow)if(e=this._schedule.checkCurrentStatus()[0]){if(-1!=[GuildWarStatus.Adjust,GuildWarStatus.Battle,GuildWarStatus.Wait,GuildWarStatus.WaitBattle,GuildWarStatus.BattleEnd].indexOf(e)){var t=this.nowEnrollable();this.selfInfo.enrolled||(e=t?GuildWarStatus.Enroll:GuildWarStatus.UnEnroll)}}else e=GuildWarStatus.Close;else e=GuildWarStatus.Close;return e},o.prototype.getTimeInterval=function(e){return this._schedule.getCurrentTimeInterval(e)},o.prototype.getMyRoute=function(){var i=0,o=r.AppFacade.getInstance().retrieveProxy(r.PlayerPy.N).playerInfoVO.playerId;return this.selfInfo.routes.forEach(function(t){t.entities.forEach(function(e){e.baseInfo.playerId==o&&(i=t.index)})}),i},o.prototype.nowEnrollable=function(){var e=!1;if(this.constValue.GuildWarDt){var t=Utils.TimerManager.getServerTime(),i=new Date(1e3*t);i.getHours(),i.getMinutes(),i.setDate(i.getDate()+1),i.setHours(12,0,0,0);var o=this._schedule.checkCurrentStatus()[0],n=this._schedule.checkCurrentStatus(i.getTime()/1e3)[0];if(o!=GuildWarStatus.Close&&n!=GuildWarStatus.Close){i.setTime(1e3*t);var a=this.constValue.GuildWarDt[0];t>=i.setHours(0,0,0,0)/1e3&&t<i.setHours(a[2][0],a[2][1],0,0)/1e3&&(e=!0)}}return e},o.prototype.updateInfo=function(e){var t=this;if(e.opponent&&e.opponent.guild?(this.opponentInfo||(this.opponentInfo=new r.GuildWarGuildEntityVO),this.opponentInfo.update(e.opponent),this.opponentInfo.routes.forEach(function(e){e.entities.forEach(function(e){t.memberMap.opponent[e.baseInfo.playerId]=e})})):this.opponentInfo=void 0,e.self&&(this.selfInfo.update(e.self),this.selfInfo.routes.forEach(function(e){e.entities.forEach(function(e){t.memberMap.self[e.baseInfo.playerId]=e})})),this.curStatus=this.getGuildWarStatus(),this.checkEnroll(),this.curStatus==GuildWarStatus.BattleEnd)for(var i in this.firstRecord)this.firstRecord[i]=!1},o.prototype.checkEnroll=function(){if(NoticeManager.updateNotice(NT.GUILD_WAR),!this.firstRecord.enrollRemind&&this.nowEnrollable()&&this.curStatus!=GuildWarStatus.Close&&!this.selfInfo.selfEnrolled){if(!r.AppFacade.getInstance().retrieveMediator(r.GuajiMediator.N).guajiUI)return;if(this.firstRecord.enrollRemind=!0,!r.AppFacade.getInstance().retrieveMediator(r.GuildWarMediator.N).getSubView(r.GuildWarMediator.SV.MAIN)){var e=new r.GuildWarEnrollPanel;PopUpManager.addPopUp({obj:e,onDarkClick:function(){e.perClose()}})}}},o.prototype.updateBattleRecord=function(e){e.length&&(this.recordController=new n(e),r.AppFacade.getInstance().updateView(r.GuildWarMediator.N,r.GuildWarMediator.SV.MAIN))},o.prototype.GetGuildWarInfo=function(){var t=this;Utils.Socket.send("guildWar","GetGuildWarInfo",{}).then(function(e){t.updateInfo(e),r.AppFacade.getInstance().updateView(r.GuildWarMediator.N,r.GuildWarMediator.SV.MAIN),!t.recordController&&(t.opponentInfo&&t.curStatus==GuildWarStatus.Battle||t.curStatus==GuildWarStatus.BattleEnd)&&t.GetBattleRecord()})},o.prototype.Enroll=function(){var t=this;Utils.Socket.send("guildWar","Enroll",{}).then(function(e){t.updateInfo(e),r.AppFacade.getInstance().updateView(r.GuildWarMediator.N,r.GuildWarMediator.SV.MAIN)})},o.prototype.ChangeRoute=function(e){var t=this,i=e.index;this.selfInfo.routes[i-1].entities.length!=this.constValue.GuildWarRouteLimit?Utils.Socket.send("guildWar","ChangeRoute",e).then(function(e){t.updateInfo(e),r.AppFacade.getInstance().updateView(r.GuildWarMediator.N,r.GuildWarMediator.SV.FORMATION),r.AppFacade.getInstance().updateView(r.GuildWarMediator.N,r.GuildWarMediator.SV.MAIN)}):Utils.MsgUtils.addMidMsg("该线路人数已达上限")},o.prototype.ChangePosition=function(e){var t=this;Utils.Socket.send("guildWar","ChangePosition",e).then(function(e){t.updateInfo(e),r.AppFacade.getInstance().updateView(r.GuildWarMediator.N,r.GuildWarMediator.SV.FORMATION)})},o.prototype.GetBattleRecord=function(){var t=this;Utils.Socket.send("guildWar","GetBattleRecord",{}).then(function(e){t.updateBattleRecord(e.records)})},o.N="GuildWarPy",o);function o(){var e=t.call(this,o.N)||this;return e.constValue={GuildWarDailyRewards:void 0,GuildWarDt:void 0,GuildWarEnrollLimit:void 0,GuildWarRouteLimit:void 0},e._schedule=Utils.TimerManager.createWeeklySchedule(),e.memberMap={self:{},opponent:{}},e.firstRecord={enrollRemind:!1,battleStart:!1,battleResult:!1,matchSuccess:!1},e.playerPy=r.AppFacade.getInstance().retrieveProxy(r.PlayerPy.N),e.selfInfo=new r.GuildWarGuildEntityVO,e.addNotice(),e}r.GuildWarPy=i,__reflect(i.prototype,"game.GuildWarPy");var n=(e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【GuildWar_BattleRecordController】："].concat(e))},e.prototype.initCurRecords=function(){var e=this.proxy.constValue.GuildWarDt[1][3],t=Utils.TimerManager.getServerTime(),i=new Date(1e3*t);i.setHours(e[0],e[1],0,0),this.openDt=i.getTime()/1e3;for(var o=t-this.openDt,n=1;n<=3;n++){for(var a=o,r=this.allBattleRecords[n-1].records[this.curBattleRecords[n].records.length];r&&a>=r.round*this.SEC_PER_ROUND;)this.battlePush(n),a-=r.round*this.SEC_PER_ROUND,r=this.allBattleRecords[n-1].records[this.curBattleRecords[n].records.length];this.setTimerForRoute(n,a)}},e.prototype.setTimerForRoute=function(e,t){var i=this;void 0===t&&(t=0),this.routeTimer[e-1];var o=this.allBattleRecords[e-1].records[this.curBattleRecords[e].records.length];if(o){var n=o.round*this.SEC_PER_ROUND-t;egret.setTimeout(function(){i.onRoundAdded(e),i.setTimerForRoute(e)},this,1e3*n)}},e.prototype.onRoundAdded=function(e){if(this.isRouteBattleOver(e))this.log("##debug## GuildWar_002");else{this.battlePush(e);var t=this.curBattleRecords[e].records[this.curBattleRecords[e].records.length-1],i=this.active?t.challenger:t.beChallenger,o=this.active?t.beChallenger:t.challenger,n=this.active==(t.result==EBattleResult.EBattleResultWin),a={index:e,self:this.proxy.memberMap.self[i].baseInfo.name,opp:this.proxy.memberMap.opponent[o].baseInfo.name,result:n};r.AppFacade.getInstance().updateView(r.GuildWarMediator.N,r.GuildWarMediator.SV.MAIN,{fromCon:!0,record:a})}},e.prototype.battlePush=function(e){if(this.isRouteBattleOver(e))this.log("##debug## GuildWar_001");else{var t=this.allBattleRecords[e-1].records,i=this.curBattleRecords[e],o=t[i.records.length];o.result==EBattleResult.EBattleResultDraw?(i.slay[0]++,i.slay[1]++):this.active==(o.result==EBattleResult.EBattleResultWin)?i.slay[0]++:i.slay[1]++,i.records.push(o),this.isRouteBattleOver(e)&&this.log("##debug## GuildWar_第"+e+"路已经打完"),this.log("##debug## GuildWar_"+e+"路第"+i.records.length+"回合完成"),this.allOver=this.isRouteBattleOver(1)&&this.isRouteBattleOver(2)&&this.isRouteBattleOver(3)}},e.prototype.isRouteBattleOver=function(e){return this.allBattleRecords[e-1].records.length==this.curBattleRecords[e].records.length},e);function e(e){this.SEC_PER_ROUND=4,this.routeTimer=[0,0,0],this.allOver=!1,this.proxy=r.AppFacade.getInstance().retrieveProxy(i.N),this.allBattleRecords=e,this.curBattleRecords={1:{slay:[0,0],records:[]},2:{slay:[0,0],records:[]},3:{slay:[0,0],records:[]}},this.allBattleRecords&&this.allBattleRecords[0]&&this.allBattleRecords[0].records&&this.allBattleRecords[0].records[0]?this.active=!!this.proxy.memberMap.self[this.allBattleRecords[0].records[0].challenger]:this.active=!1,this.initCurRecords()}__reflect(n.prototype,"BattleRecordController")}(game=game||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.rootPanel.blb_title.text="战斗记录",this.rootPanel.onCloseCB=function(){e.hide()},this.initTabbar(),this.initList()},o.prototype.initList=function(){UIActionManager.hideScrollerBar(this.scl_list),this.list_item.itemRenderer=a},o.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="CommonTabWithTextSkin",this.tabbar.dataProvider=new eui.ArrayCollection([{text:"左路"},{text:"中路"},{text:"右路"}]),this.tabbar.selectedIndex=0,this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.updateView,this)},o.prototype.updateView=function(e){e&&null!=e.itemIndex&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex);var t=this.tabbar.selectedIndex+1,i=this.proxy.recordController,o=i.curBattleRecords[t].records,n=i.active?1:2,a=[];for(var r in o){var s=o[r],c=1==n?s.challenger:s.beChallenger,l=1==n?s.beChallenger:s.challenger;a.push({self:this.proxy.memberMap.self[c],opp:this.proxy.memberMap.opponent[l],result:s.result==n,battleUuid:s.battleUuid})}this.list_item.dataProvider=new eui.ArrayCollection(a)},o);function o(){var e=i.call(this)||this;return e.proxy=t.AppFacade.getInstance().retrieveProxy(t.GuildWarPy.N),e.index=0,e.skinName="GuildWarBattleRecordSkin",e}t.GuildWarBattleRecordPanel=e,__reflect(e.prototype,"game.GuildWarBattleRecordPanel");var n,a=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.btn_review.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.fightPy.BattlePlayBack(this.data.battleUuid)},this),this.playerHead_self=customui.PlayerHeadFactory.create(),this.gp_playerHead_self.addChild(this.playerHead_self),this.playerHead_opp=customui.PlayerHeadFactory.create(),this.gp_playerHead_opp.addChild(this.playerHead_opp)},r.prototype.dataChanged=function(){this.lb_self.text=this.data.self.baseInfo.name,this.lb_opp.text=this.data.opp.baseInfo.name,this.playerHead_self.updateData({vo:this.data.self.baseInfo}),this.playerHead_opp.updateData({vo:this.data.opp.baseInfo}),this.img_bg.source=this.data.result==EBattleResult.EBattleResultWin?"gonghui_img_shengfudi_png":"gonghui_img_shengfudi2_png"},r);function r(){var e=n.call(this)||this;return e.fightPy=t.AppFacade.getInstance().retrieveProxy(t.FightPy.N),e.skinName="GuildWarBattleRecordPanel_RecordItem",e}__reflect(a.prototype,"GuildWarBattleRecordPanel_RecordItem")}(game=game||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),Utils.TouchUtils.addTouchListener(this.btn_close,function(){e.hide()}),Utils.TouchUtils.addTouchListener(this.btn_enroll,function(){e.hide(),t.MainJumpConfig.jumpTo(MODULE.GuildWar),t.GameMVC.guildWarPy.Enroll()}),this.updateView()},o.prototype.updateView=function(){var e=this,t=Utils.TimerManager.getServerTime(),i=new Date(1e3*t),o=this.proxy.constValue.GuildWarDt;i.setHours(o[0][2][0],o[0][2][1],0,0);var n=i.getTime()/1e3;this.dt=n-t,this.timer=egret.setInterval(function(){0<=e.dt?(e.blb_time.text=Utils.TimerManager.getFormatBySecond1(e.dt),e.dt--):e.hide()},this,1e3)},o.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},o);function o(){var e=i.call(this)||this;return e.dt=0,e.proxy=t.AppFacade.getInstance().retrieveProxy(t.GuildWarPy.N),e.skinName="GuildWarEnrollPanelSkin",e}t.GuildWarEnrollPanel=e,__reflect(e.prototype,"game.GuildWarEnrollPanel")}(game=game||{}),function(h){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.TouchUtils.addTouchListener(this.btn_close,function(){e.hide()}),this.initTabbar(),this.initList()},i.prototype.initList=function(){UIActionManager.hideScrollerBar(this.scl_list),this.list_item.itemRenderer=n},i.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="CommonTabWithTextSkin",this.tabbar.dataProvider=new eui.ArrayCollection([{text:"左路"},{text:"中路"},{text:"右路"}]),this.tabbar.selectedIndex=0,this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.updateView,this)},i.prototype.updateView=function(e){if(this.firstIn){var t=this.proxy.getMyRoute();this.tabbar.selectedIndex=t-1,this.firstIn=!1}e&&null!=e.itemIndex&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex);var o=[],n=this.tabbar.selectedIndex,a=this.proxy.selfInfo.routes;function i(e){var i=a[e];i.index==n+1&&i.entities.forEach(function(e,t){c=i.entities.length,o.push({index:i.index,pos:t+1,maxPos:c,info:e,self:e.baseInfo.playerId==r,authority:s})})}this.blb_title.text=["左路","中路","右路"][this.tabbar.selectedIndex]+"信息";var r=this.playerProxy.playerInfoVO.playerId,s=this.playerProxy.playerGuildVO.position>=EGuildPositionType.EGuildPositionTypeVicePresident,c=0;for(var l in a)i(l);this.blb_num.text=c+"/"+h.Config.constConfig().GuildWarRouteLimit.constValue,this.list_item.dataProvider=new eui.ArrayCollection(o)},i);function i(){var e=t.call(this)||this;return e.firstIn=!0,e.index=0,e.proxy=h.AppFacade.getInstance().retrieveProxy(h.GuildWarPy.N),e.playerProxy=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N),e.skinName="GuildWarFormationSkin",e}h.GuildWarFormationPanel=e,__reflect(e.prototype,"game.GuildWarFormationPanel");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.dataChanged=function(){var e=this.data.pos,t=this.data.info;this.blb_seq.text=e.toString(),this.playerHead.updateData({vo:t.baseInfo}),this.lb_name.text=t.baseInfo.name,this.blb_fightCap.text=t.baseInfo.fightCap.toString();var i=t.heroList;this.gp_heros.$children.forEach(function(e,t){i[t]?(e.visible=!0,e.updateData({code:i[t].code})):e.visible=!1}),this.btn_seq.visible=this.data.authority,this.btn_lane.visible=this.data.self||this.data.authority,this.btn_lane.y=this.data.authority?53:31},a);function a(){var e=o.call(this)||this;e.skinName="GuildWarFormationPanel_MemberItem";for(var t=0;t<6;t++)e.gp_heros.addChild(customui.BaseItemFactory.create());return e.btn_lane.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1<this.data.maxPos?h.AppFacade.getInstance().showSubView(h.GuildWarMediator.N,h.GuildWarMediator.SV.SEQ,{type:1,playerId:this.data.info.baseInfo.playerId,curPos:this.data.index}):Utils.MsgUtils.addMidMsg("不能少于1支队伍")},e),e.btn_seq.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1<this.data.maxPos?h.AppFacade.getInstance().showSubView(h.GuildWarMediator.N,h.GuildWarMediator.SV.SEQ,{type:2,playerId:this.data.info.baseInfo.playerId,curPos:this.data.pos,maxPos:this.data.maxPos}):Utils.MsgUtils.addMidMsg("该路无其他队伍可更换")},e),e}__reflect(n.prototype,"GuildWarFormationPanel_MemberItem")}(game=game||{}),function(i){var o,e=(__extends(t,o=BaseFull),t.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.activateComponent(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_time);for(var e=1;e<=3;e++){var t=new a;t.bottom=0,this["battleItem_"+e]=t,this["gp_battle_"+e].addChild(t)}var i=new egret.Sprite;i.touchEnabled=!1,i.graphics.beginFill(0,.6),i.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),i.graphics.endFill(),i.name="mask",i.alpha=0,this.gp_msg.addChildAt(i,0),this.guildHead_self=customui.GuildHeadFactory.create(),this.gp_guildHead_self.addChild(this.guildHead_self),this.guildHead_opp=customui.GuildHeadFactory.create(),this.gp_guildHead_opp.addChild(this.guildHead_opp),this.initBuilding()},t.prototype.initBuilding=function(){this.buildings=[void 0];for(var e=1;e<=6;e++){var t=this.BUILDING_POS[e],i=new c;i.initItem({index:3<e?e-3:e,isSelf:e<=3}),i.x=t[0],i.y=t[1],e<=3?this.gp_building_self.addChild(i):this.gp_building_enemy.addChild(i),this.buildings.push(i)}},t.prototype.updateBuilding=function(e,t){void 0===e&&(e=!1);for(var i=1;i<=3;i++){var o=this.buildings[i],n=this.buildings[i+3];if(e){if(this.buildingsHp||this.updateBuilding(),i==t||null==t)if(this.proxy.recordController){var a=this.proxy.recordController.curBattleRecords,r=a[i].slay[0],s=a[i].slay[1],c=o.maxHp;o.updateCurHp(c-s);var l=n.maxHp;n.updateCurHp(l-r)}else n.updateCurHp(0)}else 0<this.proxy.selfInfo.routes[i-1].entities.length?o.updateMaxHp(this.proxy.selfInfo.routes[i-1].entities.length):o.pb_hp.visible=!1,this.proxy.opponentInfo&&0<this.proxy.opponentInfo.routes.length?n.updateMaxHp(this.proxy.opponentInfo.routes[i-1].entities.length):n.pb_hp.visible=!1,this.buildingsHp=!0}},t.prototype.updateView=function(e){var t=this;if(this.firstIn)this.firstIn=!1,this.proxy.GetGuildWarInfo();else{switch(this.gp_enroll.visible=!1,this.gp_formation.visible=!1,this.gp_flag.visible=!1,this.gp_battle.visible=!1,this.proxy.curStatus){case GuildWarStatus.Enroll:this.gp_enroll.visible=!0;var i=this.proxy.selfInfo.selfEnrolled;this.btn_enroll.enabled=!i,this.btn_enroll.label=i?"已报名":"报名",this.blb_enrollNum.text=this.proxy.selfInfo.enrolledMemberNum+"/"+this.proxy.constValue.GuildWarEnrollLimit,this.updateScoreBoard(),this.updateBuilding();break;case GuildWarStatus.Wait:this.gp_flag.visible=!0,this.updateFlag(!1),this.updateScoreBoard(),this.updateBuilding();break;case GuildWarStatus.Adjust:this.gp_formation.visible=!0,this.gp_flag.visible=!0,this.updateFlag(!0),this.updateScoreBoard(),this.updateBuilding();break;case GuildWarStatus.WaitBattle:this.gp_flag.visible=!0,this.updateFlag(!0),this.updateScoreBoard(),this.updateBuilding();break;case GuildWarStatus.Battle:case GuildWarStatus.BattleEnd:this.gp_battle.visible=!0,this.updateBattle(e),this.updateScoreBoard(!0)}if(this.proxy.nowEnrollable()&&!this.proxy.selfInfo.selfEnrolled&&(this.gp_enroll.visible=!0,this.gp_formation.visible=!1,this.blb_enrollNum.text=this.proxy.selfInfo.enrolledMemberNum+"/"+this.proxy.constValue.GuildWarEnrollLimit),this.updateTimer(),(this.proxy.curStatus==GuildWarStatus.Adjust||this.proxy.curStatus==GuildWarStatus.WaitBattle)&&!this.proxy.firstRecord.matchSuccess&&this.proxy.opponentInfo){this.proxy.firstRecord.matchSuccess=!0,this.lb_msg_ms_oppo.text=this.proxy.opponentInfo.guild.name,this.lb_msg_ms_self.text=this.proxy.selfInfo.guild.name;var o=this.gp_msg.getChildByName("mask");function n(e){e.visible&&(e.alpha=0,a.push(e))}egret.Tween.get(o).to({alpha:1},300),this.gp_msg_ms.visible=!0,this.gp_msg_ms.alpha=0;var a=[];n(this.gp_flag),n(this.gp_self),n(this.gp_opp),egret.Tween.get(this.gp_msg_ms).to({alpha:1},300).call(function(){t.gp_msg_ms_oppo.horizontalCenter=-606,t.gp_msg_ms_oppo.verticalCenter=-300,t.gp_msg_ms_oppo.alpha=0,egret.Tween.get(t.gp_msg_ms_oppo).to({horizontalCenter:0,alpha:1},300,egret.Ease.backOut).wait(1e3).to({verticalCenter:-600,alpha:0},300,egret.Ease.backIn).call(function(){egret.Tween.get(t.gp_msg_ms).to({alpha:0},300).call(function(){t.gp_msg_ms.visible=!1}),egret.Tween.get(o).to({alpha:0},300),a.forEach(function(e){egret.Tween.get(e).to({alpha:1},300)})}),t.gp_msg_ms_self.horizontalCenter=606,t.gp_msg_ms_self.verticalCenter=300,t.gp_msg_ms_self.alpha=0,egret.Tween.get(t.gp_msg_ms_self).to({horizontalCenter:0,alpha:1},300,egret.Ease.backOut).wait(1e3).to({verticalCenter:600,alpha:0},300,egret.Ease.backIn)})}}},t.prototype.updateTimer=function(){if(this.timerStatus!=this.proxy.curStatus){var e=Utils.TimerManager.getServerTime(),t=new Date(1e3*e),i=this.proxy.constValue.GuildWarDt;switch(this.proxy.curStatus){case GuildWarStatus.Enroll:t.setHours(i[0][2][0],i[0][2][1],0,0);break;case GuildWarStatus.Adjust:t.setHours(i[1][2][0],i[1][2][1],0,0);break;case GuildWarStatus.Battle:t.setHours(i[1][4][0],i[1][4][1],0,0);break;case GuildWarStatus.Wait:t.setDate(t.getDate()+1),t.setHours(0,0,0,0);break;case GuildWarStatus.WaitBattle:t.setHours(i[1][3][0],i[1][4][1],0,0);break;case GuildWarStatus.BattleEnd:t.setDate(t.getDate()+1),t.setHours(0,0,0,0)}this.timerTargetDt=t.getTime()/1e3-e,this.lb_time_desc.text=this.STATUS_MAP[this.proxy.curStatus]+"时间：",0<this.timerTargetDt&&!this.timer&&(this.timerFunc(),this.timer=egret.setInterval(this.timerFunc,this,1e3)),this.timerStatus=this.proxy.curStatus}},t.prototype.timerFunc=function(){0<this.timerTargetDt?this.lb_time.text=Utils.TimerManager.getFormatBySecond1(--this.timerTargetDt):(egret.clearInterval(this.timer),this.timer=void 0)},t.prototype.updateBattle=function(e){var t=this.proxy.recordController;if(e.fromCon){var i=e.record.index;this.updateBattlePosition(i,!0),this.showBattleResult(e.record)}else{this.updateBuilding(!0);for(var o=1;o<=3;o++)this.proxy.curStatus==GuildWarStatus.Battle&&this.proxy.opponentInfo&&this.proxy.opponentInfo.guild?t&&this.updateBattlePosition(o):(this["battleItem_"+o].visible=!1,this.updateScoreBoard(!0));this.proxy.recordController?this.img_winwin.visible=!1:this.img_winwin.visible=!0}if(!this.proxy.firstRecord.battleStart){this.proxy.firstRecord.battleStart=!0;var n=Utils.TimerManager.getServerTime(),a=new Date(1e3*n),r=this.proxy.constValue.GuildWarDt[1][3];a.setHours(r[0],r[1],0,0),Math.abs(n-a.getTime()/1e3)<5&&DragonBoneTools.playOnce({effectName:"common_gonghuizhanzdks",parent:this.gp_msg})}},t.prototype.updateFlag=function(e){var o=this;if(e){if(!this.gp_flag.numChildren){function t(t){var i=n.FLAG_POS[t];t<=3?DragonBoneTools.create("common_gonghuizhanqzl",function(e){e.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){e&&e.parent&&e.parent.removeChild(e)},o),e.animation.play("common_gonghuizhanqzl"),e.x=i[0],e.y=i[1],e.scaleX=e.scaleY=2==t?.9:.8,o.gp_flag.addChildAt(e,0)}):DragonBoneTools.create("common_gonghuizhanqzh",function(e){e.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){e&&e.parent&&e.parent.removeChild(e)},o),e.animation.play("common_gonghuizhanqzh"),e.x=i[0],e.y=i[1],e.scaleX=e.scaleY=5==t?.9:.8,o.gp_flag.addChildAt(e,0)})}for(var n=this,i=1;i<=6;i++)t(i)}}else this.gp_flag.$children.forEach(function(e){e&&e.parent&&e.parent.removeChild(e)})},t.prototype.updateBattlePosition=function(e,t){void 0===t&&(t=!1);var i=this["battleItem_"+e],o=this.proxy.recordController.curBattleRecords,n=o[e].slay[0],a=o[e].slay[1],r=this.buildings[e].maxHp-a,s=this.buildings[e+3].maxHp-n;i.visible=!0,i.updateHP({self:r,opp:s});var c=this.ROUTE_LENGTH[e],l=-r/(r+s)*2*c+c;this.moveBattleFog(e,l,t)},t.prototype.updateScoreBoard=function(e){var o=this;if(void 0===e&&(e=!1),this.proxy.opponentInfo?(this.gp_opp.visible=!0,this.guildHead_opp.updateData({vo:this.proxy.opponentInfo.guild})):this.gp_opp.visible=!1,this.guildHead_self.updateData({vo:this.proxy.selfInfo.guild}),this.selfScore=0,this.oppoScore=0,e)if(this.proxy.opponentInfo)for(var t=1;t<=3;t++)0==this.buildings[t].curHp&&this.oppoScore++,0==this.buildings[t+3].curHp&&this.selfScore++;else this.selfScore=3;for(t=0;t<3;t++)this.gp_score_self.$children[t].source=t<this.selfScore?"gonghui_img_huangguan_png":"gonghui_img_huangguandi01_png",this.gp_score_opp.$children[t].source=t<this.oppoScore?"gonghui_img_huangguan_png":"gonghui_img_huangguandi02_png";egret.setTimeout(function(){if(o){var e=o.proxy.recordController;if(e&&e.allOver&&!o.proxy.firstRecord.battleResult){o.proxy.firstRecord.battleResult=!0,o.lb_msg_result_oppo.text=o.proxy.opponentInfo.guild.name,o.lb_msg_result_self.text=o.proxy.selfInfo.guild.name,o.img_msg_result_oppo.source=o.proxy.opponentInfo.guild.avatar,o.img_msg_result_self.source=o.proxy.selfInfo.guild.avatar;var t=o.gp_msg.getChildByName("mask");egret.Tween.get(t).to({alpha:1},300),Utils.TouchUtils.hasTouchListener(o.gp_msg_result)||Utils.TouchUtils.addTouchListener(o.gp_msg_result,function(){o.gp_msg_result.visible=!1,o.gp_msg.getChildByName("mask").visible=!1}),o.selfScore>o.oppoScore&&DragonBoneTools.playOnce({effectName:"common_gonghuizhanqplh",parent:o.gp_msg_result,y:0,loop:!0}),o.lb_msg_result_score.text=o.proxy.selfInfo.score.toString(),o.gp_msg_result.visible=!0,o.gp_msg_result.alpha=0,egret.Tween.get(o.gp_msg_result).to({alpha:1},300).call(function(){var e=o.oppoScore>o.selfScore?o.gp_msg_result_oppo_effect:o.gp_msg_result_self_effect;DragonBoneTools.playOnce({effectName:"common_gonghuizhansllh_2",parent:e,x:e.width/2,y:e.height/2-70,z:0,loop:!0}),DragonBoneTools.playOnce({effectName:"common_gonghuizhanVS",parent:o.gp_msg_result,y:o.gp_msg_result.height/2-70,loop:!0});var t=new eui.Image("gonghui_img_huoshengzhe_png");t.horizontalCenter=0,t.top=-80,e.addChild(t);for(var i=0;i<3;i++)DragonBoneTools.playOnce({effectName:i<o.oppoScore?"common_gonghuizhanhsl":"common_gonghuizhanhsb",parent:o.gp_msg_result_oppo_effect,x:120*(i-1)+o.gp_msg_result_oppo_effect.width/2,y:2*o.gp_msg_result_oppo_effect.height/3,keep:!0}),DragonBoneTools.playOnce({effectName:i<o.selfScore?"common_gonghuizhanlsl":"common_gonghuizhanlsb",parent:o.gp_msg_result_self_effect,x:120*(i-1)+o.gp_msg_result_self_effect.width/2,y:2*o.gp_msg_result_self_effect.height/3,keep:!0})})}}},this,2e3)},t.prototype.showScoreEffect=function(e){var t=e?this.gp_msg_score_self:this.gp_msg_score_oppo,i=e?this.gp_msg_score_self_stars:this.gp_msg_score_oppo_stars,o=e?"gonghui_img_wofanghuangguan":"gonghui_img_difanghuangguan";i.removeChildren();for(var n=e?this.selfScore:this.oppoScore,a=0;a<3;a++)if(a<n){var r=new eui.Image(o+"02_png");r.scaleX=r.scaleY=.7,i.addChild(r)}else i.addChild(new eui.Image(o+"01_png"));t.visible=!0,t.alpha=0,egret.Tween.removeTweens(t),egret.Tween.get(t).to({alpha:1},300).wait(1500).to({alpha:0},300).call(function(){t.visible=!1})},t.prototype.showBattleResult=function(e){var t=e.index,i=e.result,o=new eui.Group;o.alpha=0,o.x=this.RESULT_POS[t][0],o.y=this.RESULT_POS[t][1],this.gp_battle.addChild(o);var n=new eui.Image(i==EBattleResult.EBattleResultWin?"gonghui_img_shengfudi_png":"gonghui_img_shengfudi2_png");o.addChild(n);var a=new eui.Label(e.self),r=new eui.Label(e.opp);a.y=r.y=9,a.size=r.size=18,a.horizontalCenter=-83.5,r.horizontalCenter=83.5,o.addChild(a),o.addChild(r),egret.Tween.get(o).to({alpha:1},this.RESULT_DURATION/4).wait(this.RESULT_DURATION).to({alpha:0},this.RESULT_DURATION/4).call(function(){o.parent&&o.parent.removeChild(o)})},t.prototype.moveBattleFog=function(e,t,i){var o=this;void 0===i&&(i=!0);var n=this["gp_battle_"+e];if(i){var a=Math.abs(n.verticalCenter-t)/this.MOVE_SPEED*1e3;egret.Tween.removeTweens(n),egret.Tween.get(n).to({verticalCenter:t},a).call(function(){o.onMoveEnd(e)})}else this.proxy.recordController.isRouteBattleOver(e)?n.visible=!1:(n.verticalCenter=t,this.activateFogEffect(n))},t.prototype.onMoveEnd=function(e){var t=this["gp_battle_"+e];this.updateBuilding(!0,e),this.updateScoreBoard(!0),this.proxy.recordController.isRouteBattleOver(e)?(this.showScoreEffect(e<4),t.visible=!1):this.activateFogEffect(t)},t.prototype.activateFogEffect=function(e){var t=e.verticalCenter,i=e.verticalCenter-this.BATTLE_OFFSET,o=e.verticalCenter+this.BATTLE_OFFSET,n=this.BATTLE_OFFSET/this.EFFECT_SPEED*1e3;egret.Tween.get(e,{loop:!0}).to({verticalCenter:o},n).to({verticalCenter:i},2*n).to({verticalCenter:t},n)},t.prototype.activateComponent=function(){this.btn_enroll.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.proxy.Enroll()},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.AppFacade.getInstance().showSubView(i.GuildWarMediator.N,i.GuildWarMediator.SV.FORMATION)},this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.MainJumpConfig.jumpTo()},this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.proxy.recordController?i.AppFacade.getInstance().showSubView(i.GuildWarMediator.N,i.GuildWarMediator.SV.RECORD):Utils.MsgUtils.addMidMsg("暂无记录")},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.GameMVC.loginPy.loginGameVO.singleSign?i.AppFacade.getInstance().showSubView(i.RankMediator.N,i.RankMediator.SV.COMMON,{module:"GUILD_WAR_SINGLE"}):i.AppFacade.getInstance().showSubView(i.RankMediator.N,i.RankMediator.SV.COMMON,{module:"GUILD_WAR"})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.GameMVC.loginPy.loginGameVO.singleSign?i.AppFacade.getInstance().showSubView(i.RankMediator.N,i.RankMediator.SV.COMMON,{module:"GUILD_WAR_SINGLE",index:1}):i.AppFacade.getInstance().showSubView(i.RankMediator.N,i.RankMediator.SV.COMMON,{module:"GUILD_WAR",index:1})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new i.HelpDialog({moduleId:MODULE.GuildWar})})},this)},t.prototype.perClose=function(){this.timer&&egret.clearInterval(this.timer)},t);function t(){var e,t=o.call(this)||this;return t.buildingsHp=!1,t.firstIn=!0,t.proxy=i.AppFacade.getInstance().retrieveProxy(i.GuildWarPy.N),t.STATUS_MAP=((e={})[GuildWarStatus.NotOpen]="未开启",e[GuildWarStatus.BattleEnd]="等待开启",e[GuildWarStatus.Enroll]="报名",e[GuildWarStatus.Adjust]="调整",e[GuildWarStatus.Battle]="战斗",e[GuildWarStatus.Wait]="等待",e[GuildWarStatus.WaitBattle]="等待",e[GuildWarStatus.UnEnroll]="未报名",e),t.ROUTE_LENGTH={1:230,2:310,3:230},t.BATTLE_OFFSET=20,t.EFFECT_SPEED=60,t.MOVE_SPEED=150,t.RESULT_DURATION=3e3,t.RESULT_POS={1:[-93,605],2:[114,701],3:[320,605]},t.BUILDING_POS={1:[20,-71],2:[223,19],3:[430,-68],4:[23,41],5:[222,-65],6:[433,33]},t.FLAG_POS={1:[58,431],2:[266,514],3:[473,431],4:[64,250],5:[271,160],6:[480,250]},t.skinName="GuildWarMainSkin",t}i.GuildWarMainView=e,__reflect(e.prototype,"game.GuildWarMainView");var n,a=(n=eui.Component,__extends(r,n),r.prototype.childrenCreated=function(){var t=this;n.prototype.childrenCreated.call(this),DragonBoneTools.create("common_gonghuizhanzdz",function(e){e.animation.play("common_gonghuizhanzdz"),e.x=73,e.y=126,t.addChild(e)})},r.prototype.updateHP=function(e){this.blb_self.text=e.self.toString(),this.blb_opp.text=e.opp.toString()},r);function r(){var e=n.call(this)||this;return e.skinName="GuildWarMainView_Battle",e}__reflect(a.prototype,"GuildWarMainView_Battle");var s,c=(s=eui.Component,__extends(l,s),l.prototype.childrenCreated=function(){s.prototype.childrenCreated.call(this),this.pb_hp.labelFunction=function(e,t){return""+e},this.pb_hp.slideDuration=0},l.prototype.initItem=function(e){this.index=e.index,this.isSelf=e.self,this.setBulidingRuin(!1),this.pb_hp.skinName=this.isSelf?"skins.GuildWarHpBarSkinBlue":"skins.GuildWarHpBarSkinRed"},l.prototype.updateMaxHp=function(e){this.maxHp=e,this.pb_hp.maximum=e,this.updateCurHp(e)},l.prototype.updateCurHp=function(e){this.pb_hp.visible=!0,0==e?(0!=this.curHp&&this.showRuinEffect(),this.pb_hp.visible=!1,this.setBulidingRuin(!0)):this.setBulidingRuin(!1),this.curHp=e,this.pb_hp.value=e},l.prototype.showRuinEffect=function(){DragonBoneTools.playOnce({effectName:"common_gonghuizhanjzhh",parent:this})},l.prototype.setBulidingRuin=function(e){if(e)this.img_building.source=2==this.index?"common_guild_chengbaosun_png":"common_guild_jiantasun_png";else{var t=this.isSelf?"lan":"hong",i=2==this.index?"01":"02";this.img_building.source="common_guild_"+t+"_"+i+"_png"}},l);function l(){var e=s.call(this)||this;return e.skinName="GuildWarMainView_Building",e}__reflect(c.prototype,"GuildWarMainView_Building")}(game=game||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this)},o.prototype.updateView=function(o){this.curType=o.type,this.playerId=o.playerId;var n=o.curPos;if(1==this.curType){function e(e){if(e!=n){var t=new eui.Button;t.skinName="skins.ButtonSkinYellow2",t.label=i.route2string[e],t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnClick(e)},i),i.gp_btn.addChild(t)}}this.gp_tips.visible=!1,this.gp_root.width=170,this.gp_root.height=190,this.gp_btn.top=20,this.gp_btn.left=this.gp_btn.right=20,(a=new eui.VerticalLayout).horizontalAlign=egret.HorizontalAlign.CENTER,a.verticalAlign=egret.VerticalAlign.MIDDLE,this.gp_btn.layout=a;for(var i=this,t=1;t<=3;t++)e(t)}else{var a;function r(e){if(!(e<=o.maxPos))return"break";var t=e==n,i=new c({num:e,self:t});i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t||this.btnClick(e)},s),s.gp_btn.addChild(i)}this.gp_tips.visible=!0,this.gp_root.width=395,this.gp_root.height=275,this.gp_btn.top=65,this.gp_btn.left=this.gp_btn.right=38,(a=new eui.TileLayout).requestedColumnCount=5,a.horizontalGap=15,this.gp_btn.layout=a;var s=this;for(t=1;t<=15&&"break"!==r(t);t++);}},o.prototype.btnClick=function(e){1==this.curType?this.proxy.ChangeRoute({playerId:this.playerId,index:e}):this.proxy.ChangePosition({playerId:this.playerId,position:e}),this.hide()},o);function o(){var e=i.call(this)||this;return e.proxy=t.AppFacade.getInstance().retrieveProxy(t.GuildWarPy.N),e.route2string={1:"选择左路",2:"选择中路",3:"选择右路"},e.skinName="GuildWarSelectSeqSkin",e}t.GuildWarSelectSeqPanel=e,__reflect(e.prototype,"game.GuildWarSelectSeqPanel");var n,c=(n=eui.Component,__extends(a,n),a.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.data&&this.update(this.data)},a.prototype.update=function(e){this.data=e,this.blb_num.text=this.data.num.toString(),this.img_bg.source=this.data.self?"_btn_lb_m_json.common_icon_lvkong":"_btn_lb_m_json.common_icon_kong"},a);function a(e){var t=n.call(this)||this;return t.skinName="GuildWarSelectSeqPanel_Item",t.data=e,t}__reflect(c.prototype,"GuildWarSelectSeqPanel_Item")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),Object.defineProperty(n.prototype,"rootView",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.GuildInstanceView),this.addSubView(n.SV.CHAPTERVIEW,i.GuildInstanceChapterView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.GUILD_INSTANCE_OPEN,CN.GUILD_INSTANCE_UPDATE,CN.GUILD_INFO_UPDATE]},n.prototype.handleNotification=function(e){e.getBody();var t=this.getSubView(i.FriendMediator.SV.MAIN);switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GUILD_INSTANCE_OPEN:this.showSubView(n.SV.MAIN);break;case CN.GUILD_INFO_UPDATE:i.AppFacade.getInstance().retrieveProxy(i.GuildPy.N).isInGuild()&&this.proxy.GetGuildFortressInfo();case CN.GUILD_INSTANCE_UPDATE:t&&t.updateView()}},n.prototype.onViewCreate=function(){},n.N="GuildInstanceMediator",n.SV={MAIN:1,CHAPTERVIEW:2},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.GuildInstancePy.N),t}i.GuildInstanceMediator=e,__reflect(e.prototype,"game.GuildInstanceMediator")}(game=game||{}),function(n){var e=(t.registerAll=function(){(new o).register(),(new s).register()},t);function t(){}n.GuildInstanceProcessor=e,__reflect(e.prototype,"game.GuildInstanceProcessor");var i,o=(i=n.ProcessorBase,__extends(a,i),a.prototype.execute=function(e){var t=e.getBody();n.AppFacade.getInstance().retrieveProxy(n.GuildInstancePy.N).updateFortressInfo(t)},a);function a(){return i.call(this,"guild.GuildFortressUpdateP",a)||this}n.GuildFortressUpdateP=o,__reflect(o.prototype,"game.GuildFortressUpdateP");var r,s=(r=n.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody(),i=n.AppFacade.getInstance().retrieveProxy(n.GuildInstancePy.N);i.guildTranscriptInfo.update(t.info),i.guildTranscriptBossInfo.update(t.bossInfo),n.AppFacade.getInstance().sendNotification(CN.GUILD_INSTANCE_UPDATE);var o=n.AppFacade.getInstance().retrieveProxy(n.FightPy.N);o.addDelayCBAfterFightExit(function(){n.AppFacade.getInstance().retrieveMediator(n.GuildInstanceMediator.N).updateView(n.GuildInstanceMediator.SV.MAIN),o.queueExceExitCB()},"GUILD_COPY")},c);function c(){return r.call(this,"guildTranscript.GuildTranscriptInfoP",c)||this}__reflect(s.prototype,"GuildTranscriptInfoP")}(game=game||{}),function(n){var t,e=(__extends(i,t=BaseProxy),i.prototype.addNotice=function(){var i=this;NoticeManager.registerCB(NT.GUILD_INSTANCE,function(){var e=n.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.GuildTranscript,{id:i.guildTranscriptInfo.killedId});if(e.isBelonged&&!e.unlock)return!1;var t=n.Config.getGuildtranscriptConfig()[i.guildTranscriptInfo.killedId];return!(!t||0!=t.zoneBossUnlock)&&0<i.guildTranscriptInfo.count},this)},i.prototype.GetGuildFortressInfo=function(t){var i=this;Utils.Socket.send("guildTranscript","GetGuildTranscriptInfo",{},!0).then(function(e){e.err||(i.clearChapterId=e.info.killedId+1,i.guildTranscriptInfo.update(e.info),i.GetGuildBossInfo(e.info.killedId+1),NoticeManager.updateNotice(NT.GUILD_INSTANCE),t&&t())}).catch(function(e){i.log(e)})},i.prototype.BuyGuildFortressCount=function(){var t=this,e=this.guildTranscriptInfo.buyCount,i=n.Config.VIPConfig().guildTranscriptBuyTimes;e<i?n.AppFacade.getInstance().showSubView(n.CommonMediator.N,n.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.GuildCopy,curNum:this.guildTranscriptInfo.count,maxNum:Number(n.Config.constConfig().MaxGuildTranscriptChallengeNum.constValue),hasBuyNum:e,maxBuyNum:i,buyCB:function(e){t.BuyChallengeTimes(e)}}):Utils.MsgUtils.addMidMsg("您今日可购买次数已达到上限")},i.prototype.GetGuildFortressReward=function(e){var t=this;Utils.Socket.send("guild","GetGuildFortressReward",{id:e}).then(function(e){e.err||(t.guildCapyReward=e.clientReward)}).catch(function(e){t.log(e)})},i.prototype.ChallengeGuildFortress=function(e){var t=this;n.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeGuildTranscript,customParams:{tips:['<b><font color="#ffffff" size="22">恭喜挑战</font><font color="#ffffff" size="22">成功</font></b>','<b><font color="#ffffff" size="22">挑战</font><font color="#ffffff" size="22"> 失败</font></b>','<b><font color="#ffffff" size="22">造成伤害：</font><font color="#00fff0" size="22"> %d</font></b>']},pb1:"guildTranscript",pb2:"ChallengeGuildTranscript",params:{id:e.id},doneCB:function(e){t.log("战斗结束",e),t.GetGuildFortressInfo(),n.AppFacade.getInstance().retrieveProxy(n.FightPy.N).queueExceExitCB()}})},i.prototype.SetFortressResetType=function(e){},i.prototype.SelectRank=function(e){this.rankId=e},i.prototype.GetGuildBossInfo=function(e){var t=this;Utils.Socket.send("guildTranscript","GetGuildTranscriptDetailInfo",{id:e}).then(function(e){e.err||(t.guildTranscriptBossInfo.update(e.bossInfo),n.AppFacade.getInstance().sendNotification(CN.GUILD_INSTANCE_UPDATE),NoticeManager.updateNotice(NT.GUILD_INSTANCE))}).catch(function(e){t.log(e)})},i.prototype.upGetGuildBossInfo=function(e,t){var i=this;Utils.Socket.send("guildTranscript","GetGuildTranscriptDetailInfo",{id:e}).then(function(e){e.err||(i.upGuildTranscriptBossInfo.update(e.bossInfo),t&&t())}).catch(function(e){i.log(e)})},i.prototype.updateFortressInfo=function(e){e.fortressInfo&&(this.guildTranscriptInfo.update(e.fortressInfo),n.AppFacade.getInstance().sendNotification(CN.GUILD_INSTANCE_UPDATE))},i.prototype.BuyChallengeTimes=function(t,i){var o=this;Utils.Socket.send("guildTranscript","PurchaseChallengeTime",{num:t}).then(function(e){Utils.MsgUtils.addMidMsg("成功购买"+t+"次"),o.guildTranscriptInfo.update(e.info),n.AppFacade.getInstance().retrieveProxy(n.BackpackPy.N).handleClientCost(e.clientCost),n.AppFacade.getInstance().retrieveMediator(n.GuildInstanceMediator.N).updateView(n.GuildInstanceMediator.SV.MAIN),n.AppFacade.getInstance().sendNotification(CN.GUILD_INSTANCE_UPDATE),i&&i()})},i.prototype.ColorMatrix=function(){return[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]},i.N="GuildInstanceProxy",i);function i(){var e=t.call(this,i.N)||this;return e.guildTranscriptInfo=new a,e.guildTranscriptBossInfo=new c,e.upGuildTranscriptBossInfo=new c,e.addNotice(),e}n.GuildInstancePy=e,__reflect(e.prototype,"game.GuildInstancePy");var o,a=(o=n.BaseVO,__extends(r,o),r.prototype.update=function(e){this.killedId=e.killedId+1,this.count=e.num,this.buyCount=e.purchasedNum,this.dt=e.lastRefreshDt},r);function r(e){var t=o.call(this)||this;return e&&t.update(e),t}__reflect(a.prototype,"GuildTranscriptInfo");var s,c=(s=n.BaseVO,__extends(l,s),l.prototype.update=function(e){this.killInfo=e.killInfo,this.bossLifeInfo=e.bossLifeInfo,this.sectionId=e.sectionId},l);function l(e){var t=s.call(this)||this;return e&&t.update(e),t}__reflect(c.prototype,"GuildTranscriptBossInfo");var h,p=(h=n.BaseVO,__extends(d,h),d.prototype.update=function(e){this.num=e.num,this.baseInfo=e.baseInfo},d);function d(e){var t=h.call(this)||this;return e&&t.update(e),t}__reflect(p.prototype,"GuildTranscriptKillInfo");var u,g=(u=n.BaseVO,__extends(f,u),f.prototype.update=function(e){this.code=e.code,this.maxLife=e.maxLife,this.curLife=e.curLife},f);function f(e){var t=u.call(this)||this;return e&&t.update(e),t}__reflect(g.prototype,"GuildTranscriptBossLifeInfo")}(game=game||{}),function(c){var t,e=(__extends(i,t=BasePanel),i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_guild_instance")},i.prototype.childrenCreated=function(){var e=this;this.list_copy.itemRenderer=n,UIActionManager.hideScrollerBar(this.cu_pageScroller),this.btn_page_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.cu_pageScroller.scrollToNext(function(){e.tabbar.selectedIndex++,e.btnVisible()})},this),this.btn_page_last.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.cu_pageScroller.scrollToLast(function(){e.tabbar.selectedIndex--,e.btnVisible()})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new c.HelpDialog({moduleId:MODULE.GuildCopy})})},this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.proxy.BuyGuildFortressCount()},this)},i.prototype.initTabbar=function(){var e=this;this.tabbar.itemRendererSkinName="GuildCopy_TabbarSkin";for(var t={up:"_guild_instance_m_json.gonghui_img_yuandiandi",down:"_guild_instance_m_json.gonghui_img_yuandian"},i=[],o=1;o<=this.num;o++)i.push(t);this.tabbar.dataProvider=new eui.ArrayCollection(i);var n=new eui.HorizontalLayout;n.horizontalAlign=egret.HorizontalAlign.CENTER,this.tabbar.layout=n,this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onBarItemTap,this),this.once(egret.Event.ENTER_FRAME,function(){e.tabbar.selectedIndex=Math.floor(Math.abs(e.proxy.guildTranscriptInfo.killedId-1)/9),e.onBarItemTap({itemIndex:e.tabbar.selectedIndex})},this),this.btnVisible(),this.isTabbar=!1},i.prototype.onBarItemTap=function(e){this.cu_pageScroller.scrollerToPage(e.itemIndex),this.btnVisible()},i.prototype.updateView=function(){var e=this,t=c.Config.getGuildtranscriptConfig(),i=1;this.num=0;var o=[];for(var n in this.chapterList=[],t){var a=t[n];0==a.zoneBossUnlock&&o.push({sectionId:this.proxy.guildTranscriptInfo.killedId,name:a.id}),i%9!=0&&0!=a.nextId||(this.chapterList.push({list_items:o}),this.num++,o=[]),i++}var r=this.list_copy.dataProvider;r?r.replaceAll(this.chapterList):this.list_copy.dataProvider=new eui.ArrayCollection(this.chapterList),this.list_copy.validateNow(),this.blb_remaining_times.text=String(this.proxy.guildTranscriptInfo.count),this.isTabbar?this.initTabbar():this.tabbar.selectedIndex!=Math.floor(Math.abs(this.proxy.guildTranscriptInfo.killedId-1)/9)&&this.once(egret.Event.ENTER_FRAME,function(){e.tabbar.selectedIndex=Math.floor(Math.abs(e.proxy.guildTranscriptInfo.killedId-1)/9),e.onBarItemTap({itemIndex:e.tabbar.selectedIndex})},this);var s=c.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.GuildTranscript,{id:this.proxy.guildTranscriptInfo.killedId});s.isBelonged&&!s.unlock?this.lb_newChapter.visible=!0:this.lb_newChapter.visible=!1},i.prototype.btnVisible=function(){this.tabbar.selectedIndex<=0?this.btn_page_last.visible=!1:this.btn_page_last.visible=!0,this.tabbar.selectedIndex>=this.num-1?this.btn_page_next.visible=!1:this.btn_page_next.visible=!0},i);function i(){var e=t.call(this)||this;return e.chapterList=[],Utils.AssetsMgr.loadGroup("group_guild_instance"),e.isTabbar=!0,e.skinName="GuildInstanceViewSkin",e.cu_common_datanchu.blb_title.text="公会副本",e.cu_common_datanchu.onCloseCB=function(){e.hide()},e.proxy=c.AppFacade.getInstance().retrieveProxy(c.GuildInstancePy.N),e.config=c.Config.getGuildtranscriptConfig(),e}c.GuildInstanceView=e,__reflect(e.prototype,"game.GuildInstanceView");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.initUI()},a.prototype.update=function(e){this.list_items=e.list_items},a.prototype.dataChanged=function(){this.collect.removeAll();for(var e=0,t=this.data.list_items;e<t.length;e++){var i=t[e];this.collect.addItem({id:i.name,chapterId:i.sectionId})}},a.prototype.initUI=function(){var e=new eui.TileLayout;e.horizontalGap=10,e.verticalGap=15,e.requestedRowCount=0,e.paddingLeft=20,e.paddingTop=30,e.requestedColumnCount=3,e.columnAlign=eui.ColumnAlign.LEFT,this.list_items.layout=e,this.list_items.itemRenderer=s,this.collect=new eui.ArrayCollection,this.list_items.dataProvider=this.collect},a);function a(){var e=o.call(this)||this;return e.skinName="GuildCopySkin_CapyPage",e}__reflect(n.prototype,"GuildCopySkin_CapyPage");var r,s=(r=eui.ItemRenderer,__extends(l,r),l.prototype.childrenCreated=function(){var t=this;r.prototype.childrenCreated.call(this),this.gp_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),t.touchCallBack()},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.proxy.upGetGuildBossInfo(this.data.id,function(){return c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"GUILD_COPY"})})},this),this.pb_bossHpYellow.slideDuration=0,this.pb_bossHpRed.slideDuration=1e3,this.pb_bossHpYellow.labelFunction=function(e,t){var i=Number((e/t*100).toFixed(2)).toString();return Number(i)<10&&0!=Number(i)&&(i="??"),i+"%"}},l.prototype.updateHp=function(){var t=0,i=0;this.proxy.guildTranscriptBossInfo.bossLifeInfo.forEach(function(e){t+=e.maxLife,i+=e.curLife}),this.pb_bossHpRed.maximum=t,this.pb_bossHpYellow.maximum=t,this.pb_bossHpRed.value=i,this.pb_bossHpYellow.value=i},l.prototype.dataChanged=function(){for(var e=this,t=this.data,i=c.Config.getGuildtranscriptConfig()[t.id],o=1;o<=6;o++){var n=JSON.parse(i["creep"+o]);n&&""!=n&&(1==o&&(this.bossId=n[0]),0<n[1]&&(this.bossId=n[0]))}function a(){t.id==t.chapterId?(e.img_bg.source="_guild_instance_m_json.gonghui_img_beijingtu0"+e.bossCreepInfo.race,e.img_kuang.source="_guild_instance_m_json.gonghui_img_fuben03",e.gp_hp.visible=!0,e.btn_rank.visible=!0,e.model.visible=!0,e.model.isStatic||e.model.update({model:e.bossCreepInfo.model,isStatic:!0}),e.updateHp()):t.id>t.chapterId?(e.img_kuang.source="_guild_instance_m_json.gonghui_img_fuben01",e.gp_hp.visible=!1,e.model.visible=!1,e.btn_rank.visible=!1):(e.img_bg.source="_guild_instance_m_json.gonghui_img_beijingtu0"+e.bossCreepInfo.race,e.img_kuang.source="_guild_instance_m_json.gonghui_img_fuben02",e.img_pass.visible=!0,e.gp_hp.visible=!1,e.btn_rank.visible=!1,e.model.visible=!1,e.img_bg.filters=[new egret.ColorMatrixFilter(e.proxy.ColorMatrix())])}this.bossCreepInfo=c.Config.creepConfig(this.bossId),this.bossCreepInfo||(this.bossCreepInfo=c.Config.creepConfig(this.bossId));var r=c.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.GuildCopy,{id:this.data.id});r.isBelonged?r.unlock?a.call(this):(this.img_kuang.source="_guild_instance_m_json.gonghui_img_fuben01",this.gp_hp.visible=!1,this.model.visible=!1,this.btn_rank.visible=!1):a.call(this),this.lab_name.text=t.id},l.prototype.touchCallBack=function(){function e(){t.data.id==t.proxy.guildTranscriptInfo.killedId?t.proxy.upGetGuildBossInfo(t.data.chapterId,function(){return c.AppFacade.getInstance().showSubView(c.GuildInstanceMediator.N,c.GuildInstanceMediator.SV.CHAPTERVIEW,{id:t.data.chapterId})}):t.data.id>t.proxy.guildTranscriptInfo.killedId?Utils.MsgUtils.addMidMsg("通关上一章节解锁"):t.proxy.upGetGuildBossInfo(t.data.id,function(){return c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"GUILD_COPY"})})}var t=this,i=c.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.GuildCopy,{id:this.data.id});i.isBelonged?i.unlock?e():Utils.MsgUtils.addMidMsg("封印BOSS解锁"):e()},l);function l(){var e=r.call(this)||this;return e.skinName="GuildCopyUIItemSkin",e.proxy=c.AppFacade.getInstance().retrieveProxy(c.GuildInstancePy.N),e}c.GuildCopyUIItem=s,__reflect(s.prototype,"game.GuildCopyUIItem")}(game=game||{}),function(f){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward_items=new Array,this.inButton()},i.prototype.inButton=function(){var e=this;this.challge_bnt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<e.proxy.guildTranscriptInfo.count?(e.EntrancePy.ChallengeGuildFortress({id:e.num}),e.hide()):e.proxy.BuyGuildFortressCount()},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().showSubView(f.RankMediator.N,f.RankMediator.SV.COMMON,{module:"GUILD_COPY"})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().showSubView(f.RankMediator.N,f.RankMediator.SV.COMMON,{module:"GUILD_COPY",index:1})},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().showSubView(f.HeroMediator.N,f.HeroMediator.SV.FORMATION)},this)},i.prototype.updateView=function(e){var i=this;this.num=e.id,this.colorFlilter=new egret.ColorMatrixFilter(this.EntrancePy.ColorMatrix()),this.gp_enermy.filters=this.colorFlilter;for(var t=f.Config.getGuildtranscriptConfig()[e.id],o=0,n=this.reward_items;o<n.length;o++){var a=n[o];a&&a.parent&&a.parent.removeChild(a)}for(var r=0,s=0,c=JSON.parse(t.challengeRewards);s<c.length;s++){var l=c[s],h=customui.BaseItemFactory.create(21);h.updateData({type:l[0],code:l[1],num:l[2]}),h.y=0,h.x=0+r++*(h.width+30)*.7,h.scaleX=.7,h.scaleY=.7,this.reward_items.push(h),this.gp_reward_show.addChild(h)}var p=[];try{for(var d=1;d<=6;d++){var u=t["creep"+d];u&&""!=u&&p.push(JSON.parse(t["creep"+d])[0])}}catch(e){this.log(e)}p.forEach(function(e){if(null!=e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e}),t.scaleX=t.scaleY=.7,i.gp_enermy.addChild(t)}});var g=new eui.HorizontalLayout;g.horizontalAlign=egret.HorizontalAlign.CENTER,this.gp_enermy.layout=g},i.prototype.updateSche=function(){var t=this,e=!1;this.proxy.guildTranscriptInfo.count<=0&&0<Number(f.Config.constConfig().GuildFortressCountRecoveryCD.constValue)-(Utils.TimerManager.getServerTime()-this.proxy.guildTranscriptInfo.dt)?this.scheCountLeft||(this.scheCountLeft=egret.setInterval(function(){var e=Number(f.Config.constConfig().GuildFortressCountRecoveryCD.constValue)-(Utils.TimerManager.getServerTime()-t.proxy.guildTranscriptInfo.dt);0<e?(t.lb_time.text=Utils.TimerManager.getFormatBySecond1(e),t.gp_time.visible=!0):(t.gp_time.visible=!1,egret.clearInterval(t.scheCountLeft),t.scheCountLeft=void 0)},this,1e3)):e=!0,e&&this.scheCountLeft&&(this.gp_time.visible=!1,egret.clearInterval(this.scheCountLeft),this.scheCountLeft=void 0)},i);function i(){var e=t.call(this)||this;return e.EntrancePy=f.AppFacade.getInstance().retrieveProxy(f.GuildInstancePy.N),e.skinName="GuildCopyChallengeSkin",e.xtck_tck.img_title_bg.visible=!1,e.proxy=f.AppFacade.getInstance().retrieveProxy(f.GuildInstancePy.N),e}f.GuildInstanceChapterView=e,__reflect(e.prototype,"game.GuildInstanceChapterView")}(game=game||{}),function(d){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.initList(),this.cu_dtc.blb_title.text="玩法说明",this.cu_dtc.onCloseCB=function(){e.hide()},this.updateView(this.params)},t.prototype.initList=function(){this.list_item=new eui.List;var e=new eui.VerticalLayout;e.verticalAlign=egret.VerticalAlign.TOP,e.horizontalAlign=egret.HorizontalAlign.CENTER,e.paddingTop=5,e.gap=-5,this.list_item.layout=e,this.gp_desc.addChild(this.list_item),this.list_item.horizontalCenter=0,this.list_item.itemRenderer=n},t.prototype.updateView=function(e){var t=this;if(this.params){this.cu_dtc.onCloseCB=function(){t.hide()},this.scroller.verticalScrollBar.visible=!1,this.scroller.verticalScrollBar.autoVisibility=!1;var i=this.params&&this.params.moduleId&&d.Config.unlockConfig()[this.params.moduleId],o=e.text||HELP_CONST[this.params.moduleId].content,n=o;if(!e.text){var a=[];if(null!=i)for(var r=i.condition,s=0,c=JSON.parse(r);s<c.length;s++){var l=c[s];a.push(r[l])}o=o.format(a),n=(new egret.HtmlTextParser).parse(String(o))}Array.isArray(n)||(n=(new egret.HtmlTextParser).parse(String(n)));var h=[],p=0;n.forEach(function(e){null==h[p]&&(h[p]=[]),h[p].push(e),"\n"==e.text&&p++}),this.list_item.dataProvider=new eui.ArrayCollection(h)}},t);function t(e){var t=i.call(this)||this;return t.skinName="HelpDialogSkin",t.params=e,t}d.HelpDialog=e,__reflect(e.prototype,"game.HelpDialog");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.lb_desc.bold=!0,this.lb_desc.size=22,this.lb_desc.textColor=7877150,this.lb_desc.lineSpacing=10},a.prototype.dataChanged=function(){this.lb_desc.textFlow=this.data,this.height=this.lb_desc.height-5},a);function a(){var e=o.call(this)||this;return e.skinName="CommonItemHelp",e}__reflect(n.prototype,"HelpItem")}(game=game||{}),function(i){var o,e=(o=eui.Component,__extends(t,o),t.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.activateComponent()},t.prototype.updateView=function(e){if(this.params=e,this.params&&this.params.code){this.params.type=this.params.type||Math.floor(this.params.code/1e7),this.baseConfig=game.Config.allHeroConfig(this.params.type==EEntityType.EEntityTypePet)[this.params.code]||game.Config.creepConfig(this.params.code),this.upstarConfig=game.Config.heroAndPetUpstarConfig(this.params.type==EEntityType.EEntityTypePet)[this.params.code],this.upgradeConfig=game.Config.heroAndPetUpgradeConfig(this.params.type==EEntityType.EEntityTypePet)[this.params.code];var t=game.Config.heroAndPetSectionConfig(this.params.type==EEntityType.EEntityTypePet),i=this.baseConfig.maxLevel;for(var o in t){var n=t[o];i>parseInt(n.level)&&(this.sectionConfig=n)}this.baseConfig&&(this.updateHeroBaseInfo(),this.updateHeroInfo(),this.updateAttr())}},t.prototype.updateHeroBaseInfo=function(){this.lb_level.text=this.baseConfig.maxLevel+"/"+this.baseConfig.maxLevel,this.lb_desc.text=this.baseConfig.desc,this.gp_skills.visible=!0;for(var e=JSON.parse(this.baseConfig.skillUnlock),t=this.sectionConfig&&this.sectionConfig.id||0,i=1;i<=5;i++){var o=SKILL_CODE[i];if(this["skill_"+i],o){var n={code:this.baseConfig[o],unlock:t>=e[i]};this["skill_"+i].updateItem(n)}else this["skill_"+i].updateItem()}},t.prototype.updateAttr=function(){var e=[],t=JSON.parse(this.baseConfig.baseAttr),i=JSON.parse(this.baseConfig.upAttr),o=this.sectionConfig&&JSON.parse(this.sectionConfig.attr)||[];if(e=game.GeneralConfig.AttrAddAttr(e,t),i=game.GeneralConfig.AttrMutilAttr(i,parseInt(this.baseConfig.maxLevel)-1),e=game.GeneralConfig.AttrAddAttr(e,i),e=game.GeneralConfig.AttrAddAttr(e,o),this.upstarConfig){var n=this.upstarConfig&&JSON.parse(this.upstarConfig.upAttr);e=game.GeneralConfig.AttrMutilAttr(e,n)}this.baseConfig.posSkill1,this.baseConfig.posSkill2,this.baseConfig.posSkill3;for(var a=game.Config.skillBaseConfig(),r=[],s=[],c=JSON.parse(this.baseConfig.skillUnlock),l=this.sectionConfig&&this.sectionConfig.id||0,h=1;h<=5;h++){var p=SKILL_CODE[h-1];if(p&&this.baseConfig[p]){var d=this.baseConfig[p];if(l>=c[h-1]){var u=a[d];if(u){var g=JSON.parse(u.attr);for(var f in g){var _=g[f];1e5<=_[1]?r=game.GeneralConfig.AttrAddAttr(r,[_]):s=game.GeneralConfig.AttrAddAttr(s,[_])}}}}}for(var f in e=game.GeneralConfig.AttrAddAttr(e,r),e=game.GeneralConfig.AttrAddAttr(e,s))e[f][1]=Math.floor(e[f][1]);for(e.sort(function(e,t){return e[0]-t[0]}),this.gp_upgrade_attr.removeChildren(),h=1;h<=4;h++)this.gp_upgrade_attr.addChild(new game.HeroMainView_AttrItem({type:h,num:e[h-1][1]}))},t.prototype.updateHeroInfo=function(){this.lb_name.text=this.baseConfig.name,this.img_race_icon.source=HeroRaceConfig[this.baseConfig.race].raceIconBig,this.img_tier_icon.source=game.GeneralConfig.getHeroJingyingTag(this.baseConfig.code),this.hero_model.update({code:this.params.code,isPet:this.params.type==EEntityType.EEntityTypePet});var e=game.GeneralConfig.getHeroStarInfo(this.baseConfig.initStar);if(this.gp_star.removeChildren(),e.stage<4)for(var t=0;t<e.num;t++)this.gp_star.addChild(new eui.Image(e.src));else this.gp_star.addChild(new i.HighStarLevelIcon(e.num))},t.prototype.bindSkillPanelClick=function(t){var i=this,o=t.target;o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){if(o.data&&o.data.code)for(var e in i.skill_panel.visible=!0,i.skill_panel.updateItem({code:o.data.code}),t)"target"!=e&&(i.skill_panel[e]=t[e])},this),o.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skill_panel.visible=!1},this),o.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skill_panel.visible=!1},this),o.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skill_panel.visible=!1},this)},t.prototype.activateComponent=function(){for(var e=1;e<=5;e++){var t=this["skill_"+e];this.bindSkillPanelClick({target:t,x:34,bottom:e<4?130:73})}this.hero_model.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hero_model.changeAction(i.HeroDynamicModel.TOUCH_ACTION_LIST)},this)},t.prototype.getParentView=function(){return GameRootLayer.gameLayer().panelLayer},t);function t(e){var t=o.call(this)||this;return t.skinName="HeroDetailViewSkin",t.params=e,t}i.HeroCard=e,__reflect(e.prototype,"customui.HeroCard")}(customui=customui||{}),function(m){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.activateComponent()},t.prototype.updateView=function(e){if(this.params=e,this.params&&this.params.code){this.params.type=this.params.type||Math.floor(this.params.code/1e7),this.baseConfig=m.Config.allHeroConfig(this.params.type==EEntityType.EEntityTypePet)[this.params.code]||m.Config.creepConfig(this.params.code),this.upstarConfig=m.Config.heroAndPetUpstarConfig(this.params.type==EEntityType.EEntityTypePet)[this.params.code],this.upgradeConfig=m.Config.heroAndPetUpgradeConfig(this.params.type==EEntityType.EEntityTypePet)[this.params.code];var t=m.Config.heroAndPetSectionConfig(this.params.type==EEntityType.EEntityTypePet),i=this.baseConfig.maxLevel;for(var o in t){var n=t[o];i>=parseInt(n.level)&&(this.sectionConfig=n)}this.baseConfig&&(this.updateHeroBaseInfo(),this.updateHeroInfo(),this.updateAttr())}},t.prototype.updateHeroBaseInfo=function(){this.lb_level.text=this.baseConfig.maxLevel+"/"+this.baseConfig.maxLevel,this.lb_desc.text=this.baseConfig.desc,this.gp_skills.visible=!0;for(var e=JSON.parse(this.baseConfig.skillUnlock),t=this.sectionConfig&&this.sectionConfig.id||0,i=1;i<=5;i++){var o=SKILL_CODE[i];if(this["skill_"+i],o){var n={code:this.baseConfig[o],unlock:t>=e[i]};this["skill_"+i].updateItem(n)}else this["skill_"+i].updateItem()}},t.prototype.updateAttr=function(){var e=[],t=JSON.parse(this.baseConfig.baseAttr),i=JSON.parse(this.baseConfig.upAttr),o=this.sectionConfig&&JSON.parse(this.sectionConfig.attr)||[];if(e=m.GeneralConfig.AttrAddAttr(e,t),i=m.GeneralConfig.AttrMutilAttr(i,parseInt(this.baseConfig.maxLevel)-1),e=m.GeneralConfig.AttrAddAttr(e,i),e=m.GeneralConfig.AttrAddAttr(e,o),this.upstarConfig){var n=this.upstarConfig&&JSON.parse(this.upstarConfig.upAttr);e=m.GeneralConfig.AttrMutilAttr(e,n)}this.baseConfig.posSkill1,this.baseConfig.posSkill2,this.baseConfig.posSkill3;for(var a=m.Config.skillBaseConfig(),r=[],s=[],c=JSON.parse(this.baseConfig.skillUnlock),l=this.sectionConfig&&this.sectionConfig.id||0,h=1;h<=5;h++){var p=SKILL_CODE[h-1];if(p&&this.baseConfig[p]){var d=this.baseConfig[p];if(l>=c[h-1]){var u=a[d];if(u){var g=JSON.parse(u.attr);for(var f in g){var _=g[f];1e5<=_[1]?r=m.GeneralConfig.AttrAddAttr(r,[_]):s=m.GeneralConfig.AttrAddAttr(s,[_])}}}}}for(var f in e=m.GeneralConfig.AttrAddAttr(e,r),e=m.GeneralConfig.AttrAddAttr(e,s))e[f][1]=Math.floor(e[f][1]);for(e.sort(function(e,t){return e[0]-t[0]}),this.gp_upgrade_attr.removeChildren(),h=1;h<=4;h++)this.gp_upgrade_attr.addChild(new m.HeroMainView_AttrItem({type:h,num:e[h-1][1]}))},t.prototype.updateHeroInfo=function(){this.lb_name.text=this.baseConfig.name,this.img_race_icon.source=HeroRaceConfig[this.baseConfig.race].raceIconBig,this.img_profession_icon.source=ProfessionConfig[this.baseConfig.profession].icon,this.img_tier_icon.source=m.GeneralConfig.getHeroJingyingTag(this.baseConfig.code),this.hero_model.update({code:this.params.code,isPet:this.params.type==EEntityType.EEntityTypePet});var e=m.GeneralConfig.getHeroStarInfo(this.baseConfig.initStar);if(this.gp_star.removeChildren(),e.stage<4)for(var t=0;t<e.num;t++)this.gp_star.addChild(new eui.Image(e.src));else this.gp_star.addChild(new customui.HighStarLevelIcon(e.num))},t.prototype.bindSkillPanelClick=function(t){var i=this,o=t.target;o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){if(o.data&&o.data.code)for(var e in i.skill_panel.visible=!0,i.skill_panel.updateItem({code:o.data.code}),t)"target"!=e&&(i.skill_panel[e]=t[e])},this),o.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skill_panel.visible=!1},this),o.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skill_panel.visible=!1},this),o.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skill_panel.visible=!1},this)},t.prototype.activateComponent=function(){for(var e=1;e<=5;e++){var t=this["skill_"+e];this.bindSkillPanelClick({target:t,x:34,bottom:e<4?130:73})}this.hero_model.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hero_model.changeAction(customui.HeroDynamicModel.TOUCH_ACTION_LIST)},this)},t.prototype.getParentView=function(){return GameRootLayer.gameLayer().panelLayer},t);function t(e){var t=i.call(this)||this;return t.skinName="HeroDetailViewSkin",t.heroProxy=m.AppFacade.getInstance().retrieveProxy(m.HeroPy.N),t.params=e,t}m.HeroDetailView=e,__reflect(e.prototype,"game.HeroDetailView")}(game=game||{}),function(n){var i,e=(__extends(t,i=BasePanel),t.prototype.onViewCreated=function(){console.warn("子类需要覆盖该方法")},t.prototype.onViewRemove=function(){console.warn("子类需要覆盖该方法")},t.prototype.onDestroy=function(){this.onViewRemove()},t.prototype.childrenCreated=function(){var o=this;i.prototype.childrenCreated.call(this),this.params.members.forEach(function(t){var e=customui.PlayerHeadFactory.create({vo:t.baseInfo,tapEvent:function(){var e=[];e.push({text:"是否将队长转让给",style:{textColor:11041365,size:24}}),e.push({text:" "+t.baseInfo.name+" ",style:{textColor:4557956,size:24}}),e.push({text:"？",style:{textColor:11041365,size:24}}),n.GameMgr.getInstance().showCommonTipsWin({commonTips:e,cb:!1,clickCB:function(e){0===e.type||1===e.type&&(o.hide(),o.doneCB&&o.doneCB(t))}})}});o.gp_heads.addChild(e);var i=new eui.Label(t.baseInfo.name);i.size=20,o.gp_names.addChild(i)}),this.onViewCreated()},t);function t(e){var t=i.call(this)||this;return t.skinName="CommonJiJieMyTeamSwitchPanelSkin",(t.params=e)&&(t.doneCB=e.doneCB),t}n.CommonJiJieMyTeamSwitchPanel=e,__reflect(e.prototype,"game.CommonJiJieMyTeamSwitchPanel")}(game=game||{}),function(e){var t,i=(t=eui.Group,__extends(o,t),o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.width=Utils.DeviceUtils.curWidth(),this.height=Utils.DeviceUtils.curHeight(),this.init();var e=new egret.Sprite;e.graphics.clear(),e.graphics.beginFill(0,.3),e.graphics.drawRect(0,0,this.width,this.height),e.graphics.endFill(),this.addChild(e)},o.prototype.init=function(){DragonBoneTools.create("common_jiazai",function(e){this.loading=e,this.loading.x=this.width/2,this.loading.y=this.height/2,this.addChild(this.loading),this.loading.visible=!0,this.loading.animation.timeScale=1,this.loading.animation.play()},this)},o.prototype.switch=function(e){this.loading||!e?e?(this.visible=e,this.loading.animation.play()):(this.visible=e,this.loading&&this.loading.animation.stop()):this.init()},o);function o(){return t.call(this)||this}e.LoadingEffect=i,__reflect(i.prototype,"game.LoadingEffect")}(game=game||{}),function(n){var i,e=(__extends(o,i=BaseMediator),Object.defineProperty(o.prototype,"rootUI",{get:function(){return GameRootLayer.gameLayer().loadingUIEasy||GameRootLayer.gameLayer().loadingUI},enumerable:!0,configurable:!0}),o.prototype.listNotificationInterests=function(){return[CN.SHOW_LOADING]},o.prototype.handleNotification=function(e){var t=this;switch(e.getName()){case CN.SHOW_LOADING:var i=e.getBody(),o=i.groupNames;this.resDoneCB=i.resDoneCB,o.forEach(function(e){t.groupNames.push(e)}),this.rootUI?this.onViewCreaeted?this.loadNext():this.onViewCreate():this.addRootView(n.LoadingUI,void 0,GameRootLayer.gameLayer().loadLayer)}},o.prototype.loadNext=function(){RES.loadGroup(this.groupNames[0])},o.prototype.onViewCreate=function(){this.onViewCreaeted=!0,RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.loadNext()},o.prototype.onResLoadComplete=function(t){function e(e){if(e===t.groupName)return a.CUSTOM_CONFIG[e]?(n=!0,a.CUSTOM_CONFIG[e](a.onResProgress,function(){i.groupNames.splice(o,1),i.onResLoadComplete(new RES.ResourceEvent(e))},a)):a.groupNames.splice(o,1),"break";o++}for(var i=this,o=0,n=!1,a=this,r=0,s=this.groupNames;r<s.length&&"break"!==e(s[r]);r++);0===this.groupNames.length?(this.resDoneCB&&this.resDoneCB(),this.resDoneCB=void 0):n||this.loadNext()},o.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},o.prototype.onResLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResLoadComplete(e)},o.prototype.onResProgress=function(e){this.rootUI.setProgress(e.itemsLoaded,e.itemsTotal)},o.N="LoadingMediator",o);function o(e){void 0===e&&(e=null);var t=i.call(this,o.N,e)||this;return t.onViewCreaeted=!1,t.CUSTOM_CONFIG={preload_pack:function(e,t,i){n.Config.unzipFinish?t():n.Config.unzipSync(e,t,i)}},t.groupNames=new Array,Utils.DebugUtils.isDebug&&(window._clm=t),t}n.LoadingMediator=e,__reflect(e.prototype,"game.LoadingMediator")}(game=game||{}),function(e){var t,i=(__extends(o,t=BaseView),o.prototype.pbFadeFullDoneAndHideMen=function(e){var t=this;this.pb_layerProgress_fade.value=this.pb_layerProgress.value=100,this.pb_layerProgress_fade.slideDuration=this.pb_layerProgress.slideDuration=0,this.sche&&(egret.clearInterval(this.sche),this.sche=void 0),this.scheFade&&(egret.clearTimeout(this.scheFade),this.scheFade=void 0),egret.setTimeout(function(){t.img_halo.visible=t.pb_layerProgress_fade.visible=t.pb_layerProgress.visible=!1,t.pb_layerProgress_fade.value=t.pb_layerProgress.value=0,egret.Tween.get(t.img_shang).to({y:0},500,egret.Ease.backInOut),egret.Tween.get(t.img_xia).to({y:1280},500,egret.Ease.backInOut).call(function(){t.isMenShow=!1,t.visible=!1,e&&e()})},this,100)},o.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),this.visible=!1,this.pb_layerProgress_fade.maximum=100,this.pb_layerProgress.labelFunction=function(e,t){return i.labelFunction(e,t)},this.lb_tips.visible=!1,this.img_halo.visible=this.pb_layerProgress_fade.visible=this.pb_layerProgress.visible=!1},o.prototype.labelFunction=function(e,t){return this.curPbNextProgressValue=e/t*this.pb_layerProgress_fade.maximum,Math.floor(e)+"/"+t},o.prototype.showPbAndTips=function(){var e=this;this.pb_layerProgress_fade.value=this.pb_layerProgress.value=0,this.img_halo.visible=this.pb_layerProgress_fade.visible=this.pb_layerProgress.visible=!0,this.lb_tips.visible=!0;var t=0,i=0;this.sche||(this.sche=egret.setInterval(function(){2e3<=(t+=250)&&(e.switchTips(),t=0),1e3<=i&&(e.pb_layerProgress.value<e.curPbNextProgressValue&&(e.pb_layerProgress.value+=.25),i=0)},this,250)),this.switchTips(),this.pbFadeUpdate()},o.prototype.hidePbAndTips=function(){this.lb_tips.visible=!1,this.sche&&(egret.clearInterval(this.sche),this.sche=void 0)},o.prototype.pbFadeUpdate=function(){var e=this;if(!this.scheFade){var t=Utils.MathUtils.getRandomInt(50,1e3);this.scheFade=egret.setTimeout(function(){egret.log("scheFade",t),egret.clearTimeout(e.scheFade),e.scheFade=void 0,e.pbFadeUpdate()},this,t),this.pb_layerProgress_fade.value=0,this.pb_layerProgress_fade.slideDuration=0,this.once(egret.Event.ENTER_FRAME,function(){e.pb_layerProgress_fade.slideDuration=t,e.pb_layerProgress_fade.value=100},this)}},o.prototype.switchTips=function(){var e=LOADING_TIPS[Utils.MathUtils.getRandomInt(0,LOADING_TIPS.length-1)];this.lb_tips.textFlow=[{text:"提示：",style:{textColor:1895742}},{text:e,style:{textColor:16777215}}]},o.prototype.switchMenLoading=function(e,t,i){var o=this;if(e){if(i&&(this.forceForName=i),this.isMenShow)return void(t&&t());this.visible=!0,egret.Tween.get(this.img_shang).to({y:645},500,egret.Ease.backInOut),egret.Tween.get(this.img_xia).to({y:439.12},500,egret.Ease.backInOut).call(function(){o.showPbAndTips(),o.isMenShow=!0,t&&t()})}else{if(this.forceForName&&this.forceForName!=i)return void(t&&t());if(this.forceForName=void 0,!this.isMenShow)return void(t&&t());this.hidePbAndTips(),this.pbFadeFullDoneAndHideMen(t)}},o.prototype.setProgress=function(e,t){"UNTIL_FIGHT_LOADED"==this.forceForName&&(t<50&&(t=50),e<this.pb_layerProgress.value)||(this.pb_layerProgress.value=e,this.pb_layerProgress.maximum=t)},o);function o(){var e=t.call(this)||this;return e.isMenShow=!1,e.curPbNextProgressValue=0,e.skinName="LoadingSkin",e.once(egret.Event.REMOVED_FROM_STAGE,function(){e.sche&&(egret.clearInterval(e.sche),e.sche=void 0),e.scheFade&&(egret.clearTimeout(e.scheFade),e.scheFade=void 0)},e),e}e.LoadingUI=i,__reflect(i.prototype,"game.LoadingUI")}(game=game||{}),function(e){var n,t=(__extends(i,n=BasePanel),i.prototype.onDestroy=function(){n.prototype.onDestroy.call(this);for(var e=0,t=this.gp_content.$children;e<t.length;e++){var i=t[e];i.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&i.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onImageClick,this)}},i.prototype.onImageClick=function(e){this.params&&this.params.cb()},i.prototype.childrenCreated=function(){var o=this;n.prototype.childrenCreated.call(this),this.sl_content.horizontalScrollBar.autoVisibility=!1,this.sl_content.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_content.scrollPolicyV=eui.ScrollPolicy.AUTO,this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this);var e=this.params&&this.params.arrs;e?e.forEach(function(e,t){if(RES.hasRes(e)){var i=new eui.Image;i.source=e,o.gp_content.addChild(i),o.params&&o.params.cb&&i.addEventListener(egret.TouchEvent.TOUCH_TAP,o.onImageClick,o)}}):this.hide()},i);function i(e){var t=n.call(this)||this;return t.skinName="UpdateLogPanelSkin",t.params=e,t}e.AdsPanel=t,__reflect(t.prototype,"game.AdsPanel")}(game=game||{}),function(c){var i,e=(__extends(n,i=BaseFull),n.prototype.showInfo=function(){return __awaiter(this,void 0,void 0,function(){var t,o;return __generator(this,function(e){switch(e.label){case 0:return Utils.MsgUtils.addMidMsg("正在自测检验中，请稍后"),[4,Utils.enterMainOffLine()];case 1:return e.sent(),c.AppFacade.getInstance().hideSubView(c.LoginMediator.N,c.LoginMediator.SV.LOGIN_PANEL),t=JSON.parse(Utils.agentConfig.testCase),o=new c.NoticeBoardPanel({content:JSON.stringify(Utils.agentConfig)}),t.forEach(function(e){if(Array.isArray(e)){var t=customui.BaseItemFactory.create({reward:e});t.scaleX=t.scaleY=.76,o.gp_test_case.addChild(t)}else{var i=new eui.Image(e);i.width=i.height=80,o.gp_test_case.addChild(i)}}),PopUpManager.addPopUp({obj:o}),[2]}})})},n.prototype.showDebugTools=function(){Utils.MsgUtils.addMidMsg("调试模式开启"),Utils.agentConfig.IsDebug=!0,Utils.DebugUtils.setDebug(!0),Utils.SDKMgr.cmd({type:"setDebugModel",value:!0})},n.prototype.caidanCommand=function(e){if(!this.lb_version.visible)return!1;if(this.caidanCommandQueue.push(e),this.caidanCommandQueue.length<3)return!0;var t=this.caidanCommandQueue.join(""),i=t.substring(t.length-3);switch(console.log("finalCommand",i),i){case"000":UIActionManager.blink(this.lb_version),this.caidanCommandQueue.splice(0,this.caidanCommandQueue.length);break;case"012":this.showInfo();break;case"102":this.showDebugTools()}return!0},n.prototype.onDestroy=function(){this.lb_start&&egret.Tween.removeTweens(this.lb_start)},n.prototype.goTestFight=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,Utils.enterMainOffLine()];case 1:return e.sent(),Utils.agentConfig.OffLineTest=!0,c.GameMVC.fightPy.forceCanSkip=!0,c.MainJumpConfig.jumpTo("FIGHT_TEST"),[2]}})})},n.prototype.goTestOL=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,Utils.enterMainOffLine()];case 1:return e.sent(),Utils.agentConfig.OffLineTest=!0,c.AppFacade.getInstance().sendNotification(CN.HIDE_ALL_SUBVIEW),c.AppFacade.getInstance().showSubView(c.LoginMediator.N,c.LoginMediator.SV.OL_TEST),[2]}})})},n.prototype.goTestModel=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,Utils.enterMainOffLine()];case 1:return e.sent(),Utils.agentConfig.OffLineTest=!0,PopUpManager.addPopUp({obj:new c.FightTestModel}),[2]}})})},n.prototype.childrenCreated=function(){var o=this;if(i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.img_logo),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btn),Utils.DeviceUtils.setLiuHaiPingAdapter(this.lb_version),this.btn_FloatingWindow.parent.removeChild(this.btn_FloatingWindow),GameRootLayer.gameLayer().loadLayer.addChild(this.btn_FloatingWindow),this.lb_connact.visible=!!Utils.agentConfig.other.topConnact,this.lb_connact.text="客服QQ："+Utils.agentConfig.other.topConnact,this.btn_account.visible=!Utils.SDKMgr.getPerformConfig(34),"oppo_xyx"!=Utils.agentConfig.AgentCode&&"vivo_xyx"!=Utils.agentConfig.AgentCode&&"xiaomi_xyx"!=Utils.agentConfig.AgentCode&&"meizu_xyx"!=Utils.agentConfig.AgentCode||(this.lb_serverName.text="点击重新登录"),Utils.SDKMgr.cmd({type:"setDebugModel",value:!!Utils.agentConfig.IsDebug}),!Utils.SDKMgr.getPerformConfig(8)){var e=Utils.SDKMgr.getPerformConfig(200003);this.img_logo.source=e||"chuanghao_img_logo_png"}Utils.SDKMgr.getPerformConfig(41)?(this.btn_FloatingWindow.visible=!0,this.btn_FloatingWindow.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){n.flowWindowPos={stageX:e.stageX,stageY:e.stageY,beginX:e.stageX,beginY:e.stageY}},this),this.btn_FloatingWindow.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){if(n.flowWindowPos){var t=n.flowWindowPos.stageX-e.stageX,i=n.flowWindowPos.stageY-e.stageY;o.btn_FloatingWindow.x-=t,o.btn_FloatingWindow.y-=i}n.flowWindowPos={stageX:e.stageX,stageY:e.stageY,beginX:n.flowWindowPos.beginX,beginY:n.flowWindowPos.beginY}},this),this.btn_FloatingWindow.addEventListener(egret.TouchEvent.TOUCH_END,function(e){if(n.flowWindowPos){var t=n.flowWindowPos.beginX-e.stageX,i=n.flowWindowPos.beginY-e.stageY;t*t+i*i<=50&&Utils.SDKMgr.cmd({type:"PopKeFu"})}o.btn_FloatingWindow.x<Utils.DeviceUtils.curWidth()/2?o.btn_FloatingWindow.x=0:o.btn_FloatingWindow.x=Utils.DeviceUtils.curWidth()-o.btn_FloatingWindow.width,n.flowWindowPos=void 0},this),this.btn_FloatingWindow.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(e){o.btn_FloatingWindow.x<Utils.DeviceUtils.curWidth()/2?o.btn_FloatingWindow.x=0:o.btn_FloatingWindow.x=Utils.DeviceUtils.curWidth()-o.btn_FloatingWindow.width,n.flowWindowPos=void 0},this)):this.btn_FloatingWindow.visible=!1;var t=Utils.SDKMgr.getPerformConfig(26);t&&(t.lb_1&&(this.lb_1.text=t.lb_1),t.lb_2&&(this.lb_2.text=t.lb_2),t.lb_3&&(this.lb_3.text=t.lb_3),t.lb_4&&(this.lb_4.text=t.lb_4),t.lb_5&&(this.lb_5.text=t.lb_5),t.lb_6&&(this.lb_6.text=t.lb_6),t.lb_7&&(this.lb_7.text=t.lb_7),t.lb_8&&(this.lb_8.text=t.lb_8)),Utils.SDKMgr.nodeRecord(1),this.loghttpLogin(),this.cb_checkBox.selected=!0,this.addEvents(),UIActionManager.fadeBlink(this.lb_start,!0,void 0,1e3),Utils.DebugUtils.isDebug&&!getUrlKV().banshu?(this.btn_test0.visible=!0,this.btn_test1.visible=!0,this.btn_test2.visible=!0,this.btn_test3.visible=!0,this.cb_needGuide.visible=!0,this.btn_test0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.goTestModel()},this),this.btn_test1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.goTestFight()},this),this.btn_test2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().sendNotification(CN.HIDE_ALL_SUBVIEW),c.AppFacade.getInstance().showSubView(c.LoginMediator.N,c.LoginMediator.SV.EFFECT_TEST)},this),this.btn_test3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.goTestOL()},this),this.cb_needGuide.addEventListener(egret.Event.CHANGE,function(){Utils.isNeedGuide=o.cb_needGuide.selected},this)):(this.btn_test0.visible=!1,this.btn_test1.visible=!1,this.btn_test2.visible=!1,this.btn_test3.visible=!1,this.cb_needGuide.visible=!1,this.cb_needGuide.selected=!0),Utils.SDKMgr.getPerformConfig(17)&&(this.cb_needGuide.selected=!1),Utils.isNeedGuide=this.cb_needGuide.selected,egret.setTimeout(function(){var e;for(var t in Utils.SDKMgr.getPerformConfig(22)?(e={},o.img_startGame.source=Utils.SDKMgr.getPerformConfig(22)):Utils.SDKMgr.getPerformConfig(6)?(e={},o.img_startGame.source="bg_dengluditu_jpg"):(o.img_startGame.source="bg_dengluditu_ditu_jpg",o.img_startGame2.source="bg_dengluditu_ditu2_png",e={lx:{name:"dljm_wyw",x:140,y:560}},GameRootLayer.gameLayer().loadingUIEasy.initDbAct()),e){var i=o.gp_eff;"hc1"==t&&(i=o.gp_eff0),DragonBoneTools.playOnce({cacheAsBitmap:!1,loop:!0,x:e[t].x,y:e[t].y,scaleX:e[t].scale||1,scaleY:e[t].scale||1,effectName:e[t].name,parent:i,timeScale:e[t].timeScale||1})}},this,500),Utils.SDKMgr.getPerformConfig(20)&&PopUpManager.addPopUp({obj:new c.ServerMaintainView({tips:Utils.SDKMgr.getPerformConfig(20)}),clickDarkClose:!1}),this.gp_info2.visible=!Utils.SDKMgr.getPerformConfig(25),Utils.SDKMgr.getPerformConfig(42)&&(this.gp_choose.visible=!0),this.cb_tips.addEventListener(egret.Event.CHANGE,function(e){o.isChoose=o.cb_tips.selected},this),this.cb_tips.selected=!0,this.gp_show1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.Config.helpConfig(function(e){PopUpManager.addPopUp({obj:new c.NoticeBoardPanel({fixedcontent:e.text1})})})},this),this.gp_show2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.Config.helpConfig(function(e){PopUpManager.addPopUp({obj:new c.NoticeBoardPanel({fixedcontent:e.text2})})})},this)},n.prototype.updateView=function(e){var i=this;switch(e.type){case CN.LOGIN_GO_LOGIN_LOGIN_SUCESS:Utils.SDKMgr.nodeRecord(300204);var t=["preload_pack"];GameRootLayer.gameLayer().switchMenLoading(!0,function(){Utils.SDKMgr.nodeRecord(300206),i.mediator.preloadRes(t,function(){GameRootLayer.gameLayer().preloadRes(),Utils.SDKMgr.nodeRecord(300207),c.AppFacade.getInstance().sendNotification(CN.CONFIG_ALL_LOADED),c.GameMgr.getInstance().connectGameSev(Http.isHttps()?i.playerPy.roleVo.sGameUrl:i.playerPy.roleVo.gameUrl)})},"LOGIN_INTO_MAP");break;case CN.LOGIN_HTTP_LOGIN_SUCESS:0===e.data.success&&this.loginPy.getPlayerServer();break;case CN.LOGIN_MAKE_ROLE_SUCCESS:this.delayScreenEnterGame();break;case CN.LOGIN_UPDATE_SERVER:0<this.loginPy.serverList.length&&(this.lb_start.visible=!0);var o=this.loginPy.serverList[0];o?(this.timer&&(egret.clearTimeout(this.timer),this.timer=void 0),this.img_status.source=c.ServerItem.SERVER_STATUS[o.s_healthStatus],this.lb_serverName.text=""+o.list_name+((o.area-1)%48+1)+"服","4"==o.s_healthStatus.toString()?(this.canPopNotice=!1,PopUpManager.addPopUp({obj:new c.ServerMaintainView})):Utils.SDKMgr.getPerformConfig(18)||c.GameMVC.loginPy.getAllPlayerServer(function(e,t){egret.log("是否有账号信息",t),t||i.onEnterBtnClick()})):(this.timer&&egret.clearTimeout(this.timer),this.timer=egret.setTimeout(function(){i.loginPy.getPlayerServer()},this,5e3),this.lb_serverName.text="正在拉取"),this.canPopNotice&&(Utils.SDKMgr.getPerformConfig(7)||(this.canPopNotice=!1,this.loginPy.getGameNotice()));break;case SocketConst.SOCKET_NOCONNECT:this.lb_tips.text=""}},n.prototype.addEvents=function(){var t=this;this.btn_notice.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showNoticeBoard,this),this.btn_account.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showUserPanel,this),this.lb_protocol.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showProtocal,this),this.img_startGame.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this);var i=0;this.gp_0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(10<=++i&&(t.lb_version.visible=!t.lb_version.visible,i=0,t.lb_version.visible)){var e=RES.getResourceInfo("config_all_zip").url.split(".")[0];Utils.agentConfig.AgentKey!=Utils.agentConfig.AgentCode?t.lb_version.text="当前渠道标签："+Utils.agentConfig.AgentName+"\n当前渠道号："+Utils.agentConfig.AgentKey+" 所在专服渠道号："+Utils.agentConfig.AgentCode+" \n推更时间："+Utils.agentConfig.VersionTime+" 配置版本："+e.substring(e.length-6):t.lb_version.text="当前渠道标签："+Utils.agentConfig.AgentName+"\n当前渠道号："+Utils.agentConfig.AgentKey+"\n推更时间："+Utils.agentConfig.VersionTime+" 配置版本："+e.substring(e.length-6)}},this),this.gp_0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.caidanCommand(0)},this),Utils.TouchUtils.addTouchListener(this.gp_server,function(){t.showArea()})},n.prototype.showArea=function(){c.AppFacade.getInstance().showSubView(c.PlayerMediator.N,c.PlayerMediator.SV.SERVER_LIST)},n.prototype.showNoticeBoard=function(){this.caidanCommand(1)||PopUpManager.addPopUp({obj:new c.NoticeBoardPanel})},n.prototype.showUserPanel=function(){this.caidanCommand(2)||(Utils.agentConfig.thirdUserSystem?Utils.SDKMgr.goLogin():c.AppFacade.getInstance().showSubView(c.LoginMediator.N,c.LoginMediator.SV.LOGIN_PANEL))},n.prototype.showProtocal=function(){PopUpManager.addPopUp({obj:new c.NoticeBoardPanel})},n.prototype.startGame=function(){this.playerPy.loginStatusVO.state<1?this.loghttpLogin():this.loginPy.serverList.length<=0||this.onEnterBtnClick()},n.prototype.loghttpLogin=function(){var e=!1;if(Utils.agentConfig.clientPasswd)this.loginPy.clientPasswd=Utils.agentConfig.clientPasswd,this.loginPy.clientPasswd&&""!=this.loginPy.clientPasswd&&(e=!1,Utils.agentConfig.thirdUserSystem=!1,this.loginPy.userVO.uuid=Utils.agentConfig.uuid,getUrlKV().uuid?this.loginPy.userVO.uuid=getUrlKV().uuid:getUrlKV().fadeUuid&&(this.loginPy.userVO.uuid=Base64Util.decode(Base64Util.decode(Base64Util.decode(getUrlKV().fadeUuid)))),Utils.agentConfig.AgentCode=getUrlKV().fadeAgentCode||Utils.agentConfig.AgentCode,Utils.agentConfig.ProjectName=getUrlKV().fadeProjectName||Utils.agentConfig.ProjectName,Utils.agentConfig.HttpSerever=getUrlKV().fadeHttpSerever||Utils.agentConfig.HttpSerever,Utils.Http.loginKey="507310f58a0ac8e3d8ad8f60c8b85b46"+Utils.agentConfig.ProjectName,""!=this.loginPy.userVO.uuid&&this.loginPy.userVO.uuid&&""!=Utils.agentConfig.AgentCode&&Utils.agentConfig.AgentCode?(this.loginPy.userVO.username=this.loginPy.playerProxy.playerInfoVO.name,this.loginPy.getPlayerServer()):Utils.MsgUtils.addMidMsg("请在链接末尾拼接?uuid=XXX&fadeAgentCode=YYY"),this.playerPy.loginStatusVO.state=1);else if(Utils.agentConfig.thirdUserSystem)Utils.SDKMgr.goLogin();else{var t=Utils.LocalStorageUtil.getItem("LoginHistory",!0);if(t){e=!0;var i=JSON.parse(t),o=i[i.length-1];this.loginPy.userVO.username=o.acc,this.loginPy.userVO.uuid=o.acc,this.loginPy.userVO.password=o.pwd}this.loginPy.userVO.username||(e=!1,PopUpManager.addPopUp({obj:new c.NewLoginInput}))}e&&this.loginPy.goHttpLogin()},n.prototype.onEnterBtnClick=function(){if(this.isChoose)if(Utils.SDKMgr.nodeRecord(300100),this.loginPy.userVO.uuid){this.loginPy.serverSelect=this.loginPy.serverList[0];var e=this.loginPy.serverSelect;if(e){if("4"==e.s_healthStatus.toString())return void PopUpManager.addPopUp({obj:new c.ServerMaintainView})}else Utils.SDKMgr.nodeRecord(300103),Utils.MsgUtils.addMidMsg("找不到服务器，请重试"),this.loginPy.getPlayerServer();if(this.img_startGame.touchEnabled){if(this.delayScreenEnterGame(),Utils.Socket.isConnecting())if(Utils.SDKMgr.nodeRecord(300104),this.log("已连接，先断开再重新连接websocket"),Utils.Socket.close(),150<=this.playerPy.loginStatusVO.state)Utils.SDKMgr.nodeRecord(300105),c.GameMgr.getInstance().connectGameSev(Http.isHttps()?this.playerPy.roleVo.sGameUrl:this.playerPy.roleVo.gameUrl),this.lb_tips.text="正在匹配最佳服务器...";else{Utils.SDKMgr.nodeRecord(300106),this.loginPy.serverSelect=this.loginPy.serverList[0];var t=this.loginPy.serverSelect;c.GameMgr.getInstance().connectLoginSev(t.s_ip,Http.isHttps()?t.sPort:t.port),this.lb_tips.text="正在匹配最佳服务器.."}else this.log("没有连接，先连接websocket"),Utils.SDKMgr.nodeRecord(300102),c.GameMgr.getInstance().connectLoginSev(e.s_ip,Http.isHttps()?e.sPort:e.port),this.lb_tips.text="正在匹配最佳服务器..";var i=Utils.LocalStorageUtil.getItem("ServersList"),o=[],n=[];i&&(o=JSON.parse(i));for(var a=0,r=o;a<r.length;a++){var s=r[a];s.s_id!=this.loginPy.serverSelect.s_id&&n.push(s)}n.push(this.loginPy.serverSelect),Utils.LocalStorageUtil.setItem("ServersList",JSON.stringify(n))}}else egret.warn("还没拿到登录uuid");else Utils.MsgUtils.addMidMsg("请先阅读用户协议")},n.prototype.delayScreenEnterGame=function(){var e=this;this.img_startGame.touchEnabled=!1,this.gp_info.visible=!1,egret.setTimeout(function(){e.gp_info&&(e.gp_info.visible=!0,e.img_startGame.touchEnabled=!0,e.lb_tips.text="")},this,3e4)},n);function n(){var e=i.call(this)||this;return e.loginPy=c.AppFacade.getInstance().retrieveProxy(c.LoginPy.N),e.playerPy=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N),e.canPopNotice=!0,e.isChoose=!0,e.skinName="BeforeLoginUISkin",e.caidanCommandQueue=new Array,e}c.BeforeLoginUI=e,__reflect(e.prototype,"game.BeforeLoginUI")}(game=game||{}),function(e){var o,t=(__extends(i,o=BasePanel),i.prototype.childrenCreated=function(){var i=this;o.prototype.childrenCreated.call(this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.et_name.text;if(""!=e){var t=i.et_cerNum.text;if(!/^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/.test(t))return Utils.MsgUtils.addMidMsg("身份证号格式不符合规则，请重填"),!1;i.params&&i.params.cb&&i.params.cb({name:e,num:t},i)}else Utils.MsgUtils.addMidMsg("请输入名字")},this),this.params&&(this.params.num&&(this.et_cerNum.text=this.params.num),this.params.name&&(this.et_name.text=this.params.name))},i.lastSendTime=0,i);function i(e){var t=o.call(this)||this;return t.timer=0,t.skinName="CertificatePanel",t.params=e,t}e.CertificatePanel=t,__reflect(t.prototype,"game.CertificatePanel")}(game=game||{}),function(t){var i,e=(__extends(o,i=BaseView),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.activateComponent()},o.prototype.playEffect=function(t,i){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return t&&this.playing?RES.hasRes(t+"_skeleton_dbbin")||RES.hasRes(t+"_ske_dbbin")?[4,DragonBoneTools.playOnce({effectName:t,parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/(this.onceNum+1)*i+300})]:[3,2]:[2];case 1:return e.sent(),[3,3];case 2:MovieClipTools.play({effectName:t,parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/(this.onceNum+1)*i+300}),e.label=3;case 3:return[2]}})})},o.prototype.beginPlay=function(){this.playing=!0;var e=parseInt(this.et_num.text);e&&e!=Number.NaN?this.onceNum=e:this.onceNum=1,this.effectName=this.et_name.text,this.loop=this.checkBox.selected,this.random=this.checkBox0.selected},o.prototype.reset=function(){this.loop=!1,this.playing=!1,this.onceNum=1,this.gp_effect.removeChildren()},o.prototype.PlayAll=function(){return __awaiter(this,void 0,void 0,function(){var t,i,o,n,a,r,s=this;return __generator(this,function(e){switch(e.label){case 0:if(!this.effectName)return[3,7];if(!this.loop)return[3,4];e.label=1;case 1:return this.playing?[4,this.playEffect(this.effectName,1)]:[3,3];case 2:return e.sent(),[3,1];case 3:return[3,6];case 4:return[4,this.playEffect(this.effectName,1)];case 5:e.sent(),e.label=6;case 6:return[2];case 7:if(t=1,!this.random)return[3,10];for(n=[],a=0;a<this.onceNum;a++)i=function(i){return __awaiter(s,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return this.playing?(t=Utils.MathUtils.getRandomInt(0,this.effects.length),[4,this.playEffect(this.effects[t],i)]):[3,2];case 1:return e.sent(),[3,0];case 2:return[2]}})})},n.push(i(a));return this.playing?[4,Promise.all(n)]:[3,9];case 8:e.sent(),e.label=9;case 9:return[3,15];case 10:if(!t--)return[3,15];this.loop&&(t=99999),o=0,e.label=11;case 11:if(!(o<this.effects.length-this.onceNum+1))return[3,14];for(n=[],a=0;a<this.onceNum;a++)r=a+o,n.push(this.playEffect(this.effects[r],a));return this.playing?[4,Promise.all(n)]:[3,13];case 12:e.sent(),e.label=13;case 13:return o+=this.onceNum,[3,11];case 14:return this.loop&&this.playing?[3,10]:[3,15];case 15:return[2]}})})},o.prototype.activateComponent=function(){var e=this;this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide(),t.AppFacade.getInstance().showSubView(t.LoginMediator.N,t.LoginMediator.SV.BEFORE_LOGIN)},this),this.btn_begin.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.playing||(e.beginPlay(),e.PlayAll())},this),this.btn_reset.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.reset()},this)},o);function o(){var e=i.call(this)||this;return e.playing=!1,e.onceNum=1,e.loop=!1,e.random=!1,e.effectName="",e.effects=["common_skill_ansha_1","common_skill_ansha_2","common_skill_anyinglian_1","common_skill_anyinglian_2","common_skill_anyinglian_3","common_skill_anyinglian_4","common_skill_baonuyiji_1","common_skill_baonuyiji_2","common_skill_baonuyiji_3","common_skill_bing","common_skill_bingdong","common_skill_bingqiu_1","common_skill_bingqiu_2","common_skill_changqiongzhenji_1","common_skill_changqiongzhenji_2","common_skill_changqiongzhenji_3","common_skill_changqiongzhenji_4","common_skill_chaoshengbogongji","common_skill_chenshuizhige_1","common_skill_chenshuizhige_2","common_skill_chongjibo","common_skill_dadaodan_1","common_skill_dadaodan_2","common_skill_dun","common_skill_duqiu_1","common_skill_duqiu_2","common_skill_fengbaozhiquan_1","common_skill_fengbaozhiquan_2","common_skill_fengkuangshengzhang_1","common_skill_fengkuangshengzhang_2","common_skill_gong_1","common_skill_gong_2","common_skill_guangqiu_1","common_skill_guangqiu_2","common_skill_haiguzhongji_1","common_skill_haiguzhongji_2","common_skill_hanshuangbaofa_1","common_skill_hanshuangbaofa_2","common_skill_hanshuangbaofa_3","common_skill_hanshuangxinxing_1","common_skill_hanshuangxinxing_2","common_skill_huikan_1","common_skill_huikan_2","common_skill_huimiefengbao","common_skill_huiyinji","common_skill_huiyinji_1","common_skill_huiyinji_2","common_skill_huoqiu_1","common_skill_huoqiu_2","common_skill_huoyanqiang","common_skill_jiqiang_1","common_skill_jiqiang_2","common_skill_juduxinxing","common_skill_jushichongji_1","common_skill_jushichongji_2","common_skill_leitingzhiji","common_skill_leiyunzhinu_1","common_skill_leiyunzhinu_2","common_skill_lierenbiaoji_1","common_skill_lierenbiaoji_2","common_skill_linghunchongji_1","common_skill_linghunchongji_2","common_skill_linghunchongji_3","common_skill_linghunchongji_4","common_skill_longpozhan","common_skill_maichongxinxing_1","common_skill_maichongxinxing_2","common_skill_nengliangtiaoman","common_skill_rougou_1","common_skill_rougou_2","common_skill_senglue","common_skill_shanbeng_1","common_skill_shanbeng_2","common_skill_shangdizhishou_1","common_skill_shangdizhishou_2","common_skill_shengliaoshu","common_skill_shenglingguanghui_1","common_skill_shenglingguanghui_2","common_skill_shenmizhiyao","common_skill_shenqi","common_skill_sishenliandao","common_skill_siwangdiaoling_1","common_skill_siwangdiaoling_2","common_skill_siwangyizhi_1","common_skill_siwangyizhi_2","common_skill_sizhezhiwo_1","common_skill_sizhezhiwo_2","common_skill_toushiche_1","common_skill_toushiche_2","common_skill_touzhifeibiao_1","common_skill_touzhifeibiao_2","common_skill_wudizhan","common_skill_xiaodaodan_1","common_skill_xiaodaodan_2","common_skill_xindagousazhixi_1","common_skill_xindagousazhixi_2","common_skill_xuanyun","common_skill_yuanshipaoxiao_1","common_skill_yuanshipaoxiao_2","common_skill_yueshi_1","common_skill_yueshi_2","common_skill_yunshishu","common_skill_zhanzhengnuhou_1","common_skill_zhanzhengnuhou_2","common_skill_ziranzhinu_1","common_skill_ziranzhinu_2","common_skill_ziranzhinu_3","common_105100","common_VIPhuizhang","common_VIPhuizhang2","common_ZJMicon","common_ZJMicon_2","common_airenbaozang_1","common_airenbaozang_2","common_airenbaozang_3","common_airenbaozangkcz_1","common_airenbaozangkcz_2","common_baoxiang_1","common_baoxiang_2","common_baoxiang_3","common_baoxiang_4","common_baoxiang_5","common_baoxiangkai","common_bianpao","common_buxiudebaozang_1","common_buxiudebaozang_2","common_buxiudebaozang_bxdk","common_buxiudebaozang_jin","common_buxiudebaozang_lan","common_buxiudebaozang_xbx","common_buxiudebaozang_zi","common_caiquan","common_chouka","common_chouka_1","common_chouka_2","common_choukagaojiekuang","common_choukayingxiong","common_dianji","common_ditutswp","common_duanweitisheng","common_gonghuizhan","common_gonghuizhanVS","common_gonghuizhanhsb","common_gonghuizhanhsl","common_gonghuizhanjzhh","common_gonghuizhanlsb","common_gonghuizhanlsl","common_gonghuizhanqplh","common_gonghuizhanqzh","common_gonghuizhanqzl","common_gonghuizhansllh_1","common_gonghuizhansllh_2","common_gonghuizhanzdks","common_gonghuizhanzdz","common_guanmiwu","common_gxsj","common_hongbaodakai","common_hongbaotiaodong","common_hongbaoyu","common_huaguang","common_huodewupin","common_jiazai","common_jiban","common_jinbishan","common_jingdutiao_1","common_jingdutiao_1lg","common_jingdutiao_2","common_jingdutiaotk","common_kaimiwu","common_kapiandiguang","common_kapianfanzhuan","common_kejihuo","common_kejizhongxin","common_kelingqu","common_lingquanniu","common_maoxianjinbi","common_miwu","common_paihangbang_1","common_paihangbang_2","common_paihangbang_3","common_patabaoxiang","common_patachuansongmen","common_qiriicon","common_shengji","common_shengli_1","common_shengli_2","common_shengli_21","common_shengli_22","common_shenqichuxian","common_shenqichuxian_1","common_shenqichuxian_2","common_shenqihuoyan","common_shenqixuliwancheng","common_shenqixulizhong","common_shenqizs","common_shijiebossdjs","common_shikongzhimen_d","common_shikongzhimen_hong","common_shikongzhimen_lan","common_shikongzhimen_lv","common_shikongzhimen_zi","common_shouchongkuang","common_sj","common_skill_kulouwang_1","common_skill_kulouwang_2","common_skill_longhunqishi","common_skill_shenqi","common_tansuodu","common_tongguan","common_toushaizi","common_ty_bs","common_ty_czcg","common_ty_dj","common_ty_fm","common_ty_jihuo","common_ty_jinjie","common_ty_qh","common_ty_rlian","common_ty_shengjie","common_ty_xilian","common_weixinhongbao","common_xianshilibao","common_xing","common_yingxiongfenjie","common_yingxiongshengxing","common_yingxiongtouxiangkuang","common_ysdjts","common_zbdz","common_zdjindutiaolg","common_zhanbai_1","common_zhanbai_2","common_zhanbai_21","common_zhanbai_22","common_zhandouli","common_zhanli_2","common_zhihuanchenggong","common_zhihuanfangru","common_zhihuanhou","common_zhihuanqian","common_zoumadeng_1","common_zoumadeng_2","common_zoumadeng_3","denglu_05","denglu_06","denglu_07","gonghui_bg_ghbs","gonghui_bg_ghcj","gonghui_bg_ghdt","gonghui_bg_ghfb","gonghui_bg_ghsd","gonghui_bg_ghz","gonghui_bg_kjzx","richangfb_bg_jbbz","richangfb_bg_jysk","richangfb_bg_sjsx","richangfb_bg_sqfz","richangfb_bg_yxbl","yuanzheng_bg_chengbao","yuanzheng_bg_ditu_1","yuanzheng_bg_ditu_2"],e.skinName="EffectTestViewSkin",e}t.EffectTestView=e,__reflect(e.prototype,"game.EffectTestView")}(game=game||{}),function(a){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initListView()},i.prototype.initListView=function(){this.list=new eui.List;var e=new eui.TileLayout;e.requestedColumnCount=1,e.horizontalAlign=egret.HorizontalAlign.CENTER,e.verticalAlign=egret.VerticalAlign.MIDDLE,this.list.layout=e,this.sl_list.viewport=this.list,this.list.itemRenderer=r,this.sl_list.horizontalScrollBar.visible=!1,this.sl_list.horizontalScrollBar.autoVisibility=!1,this.sl_list.scrollPolicyH=eui.ScrollPolicy.OFF;for(var t=[],i=JSON.parse(Utils.LocalStorageUtil.getItem("LoginHistory",!0)),o=i.length-1;0<=o;--o)t.push(i[o]);var n=new eui.ArrayCollection(t);this.list.dataProvider=n},i.prototype.updateData=function(){for(var e=[],t=0,i=JSON.parse(Utils.LocalStorageUtil.getItem("LoginHistory",!0));t<i.length;t++){var o=i[t];e.push(o)}var n=a.AppFacade.getInstance().retrieveProxy(a.LoginPy.N).userVO.username;e.sort(function(e,t){if(e.acc==n)return-1}),this.list.dataProvider.replaceAll(e)},i.prototype.getLoginHistoryList=function(){for(var e=[],t=0,i=a.AppFacade.getInstance().retrieveProxy(a.LoginPy.N).userVO.username;t<i.length;t++){var o=i[t];e.push(o)}},i.prototype.preClose=function(){},i);function i(){var e=t.call(this)||this;return e.skinName="LoginHistoryListSkin",e}a.LoginHistoryPanel=e,__reflect(e.prototype,"game.LoginHistoryPanel");var o,r=(o=eui.ItemRenderer,__extends(n,o),n.prototype.childrenCreated=function(){var n=this;this.btn_delete.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.isDelete=!0;for(var e=[],t=0,i=JSON.parse(Utils.LocalStorageUtil.getItem("LoginHistory",!0));t<i.length;t++){var o=i[t];o.acc!=n.data.acc&&e.push(o)}Utils.LocalStorageUtil.setItem("LoginHistory",JSON.stringify(e),!0),a.AppFacade.getInstance().retrieveMediator(a.LoginMediator.N).getSubView(a.LoginMediator.SV.LOGIN_PANEL).lhl_history.updateData()},this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(!n.isDelete){var e=a.AppFacade.getInstance().retrieveProxy(a.LoginPy.N);e.userVO.username=n.data.acc,e.userVO.password=n.data.pwd;var t=a.AppFacade.getInstance().retrieveMediator(a.LoginMediator.N).getSubView(a.LoginMediator.SV.LOGIN_PANEL);t.lhl_history.visible=!1,t.updateView(),e.saveUserHistory(e.userVO.username,e.userVO.password)}n.isDelete=!1},this)},n.prototype.dataChanged=function(){this.lb_user.text=this.data.acc},n);function n(){var e=o.call(this)||this;return e.isDelete=!1,e.skinName="UserItemSkin",e}a.userItemRenderer=r,__reflect(r.prototype,"game.userItemRenderer")}(game=game||{}),function(o){var i,e=(__extends(n,i=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.BEFORE_LOGIN,o.BeforeLoginUI),this.addSubView(n.SV.MAKE_ROLE,o.MakeRolePanel),this.addSubView(n.SV.LOGIN_PANEL,o.NewLoginUI),this.addSubView(n.SV.LOGIN_INPUT_PANEL,o.NewLoginInput),this.addSubView(n.SV.LOGIN_HISTORY,o.LoginHistoryPanel),this.addSubView(n.SV.EFFECT_TEST,o.EffectTestView),this.addSubView(n.SV.OL_TEST,o.RoleTestView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_HTTP_LOGIN_SUCESS,CN.LOGIN_SERVER_SELECT,CN.LOGIN_UPDATE_SERVER,CN.LOGIN_GO_LOGINGAME_LOGIN_SUCESS,CN.LOGIN_GO_LOGIN_LOGIN_NO_ROLE,CN.LOGIN_MAKE_ROLE_SUCCESS,CN.LOGIN_GO_LOGIN_LOGIN_SUCESS,SocketConst.SOCKET_RECONNECT,SocketConst.SOCKET_CONNECT,SocketConst.SOCKET_NOCONNECT]},n.prototype.handleNotification=function(e){var t=this,i=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case SocketConst.SOCKET_RECONNECT:case SocketConst.SOCKET_CONNECT:150<=this.playerProxy.loginStatusVO.state?(Utils.SDKMgr.nodeRecord(300301),this.loginProxy.goLoginGameLoginGame()):(Utils.SDKMgr.nodeRecord(300201),this.loginProxy.goLoginLogin());break;case CN.LOGIN_GO_LOGIN_LOGIN_SUCESS:case CN.LOGIN_GO_LOGIN_LOGIN_NO_ROLE:case CN.LOGIN_HTTP_LOGIN_SUCESS:case CN.LOGIN_SERVER_SELECT:case CN.LOGIN_UPDATE_SERVER:case CN.LOGIN_GO_LOGIN_LOGIN_FAIL:this.updateView(n.SV.BEFORE_LOGIN,{type:e.getName(),data:i});break;case SocketConst.SOCKET_NOCONNECT:Utils.MsgUtils.addMidMsg("网络连接失败"),this.updateView(n.SV.BEFORE_LOGIN,{type:e.getName(),data:i});break;case CN.LOGIN_GO_LOGINGAME_LOGIN_SUCESS:if(o.GameMVC.loginPy.userVO.checkAddictive())return;this.hideAllSubView(),this.playerProxy.GetPlayerInfo(function(){Utils.SDKMgr.nodeRecord(300401),Utils.SDKMgr.enterFlow("LoginGameR"),o.MainJumpConfig.jumpTo("MAIN"),o.MainJumpConfig.jumpTo("GUAJI"),t.guildPy.getPlayerGuildReq(function(){Utils.SDKMgr.nodeRecord(300402),t.sendNotification(CN.LOGIN_FINAL_DONE)})}),Utils.SDKMgr.getPerformConfig(10018)&&Utils.agentConfig.other.isJhb&&this.activityProxy.getFetchedList();break;case CN.LOGIN_MAKE_ROLE_SUCCESS:this.hideSubView(n.SV.MAKE_ROLE),this.updateView(n.SV.MAIN,{type:e.getName(),data:i}),this.loginProxy.goLoginLogin()}},n.N="LoginMediator",n.SV={MAIN:1,BEFORE_LOGIN:2,ACC_INPUT:3,MAKE_ROLE:5,LOGIN_PANEL:6,LOGIN_INPUT_PANEL:7,LOGIN_HISTORY:8,EFFECT_TEST:9,OL_TEST:10},n);function n(e){void 0===e&&(e=null);var t=i.call(this,n.N,e)||this;return t.loginProxy=o.AppFacade.getInstance().retrieveProxy(o.LoginPy.N),t.playerProxy=o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N),t.activityProxy=o.AppFacade.getInstance().retrieveProxy(o.ActivityPy.N),t.guildPy=o.AppFacade.getInstance().retrieveProxy(o.GuildPy.N),t}o.LoginMediator=e,__reflect(e.prototype,"game.LoginMediator")}(game=game||{}),function(n){var t,e=(__extends(i,t=BaseProxy),Object.defineProperty(i.prototype,"serverList",{get:function(){return this._serverList},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"recentServerList",{get:function(){return this._recentServerList},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"userVO",{get:function(){return this._userVO},enumerable:!0,configurable:!0}),i.prototype.updateServerList=function(e,t){for(var i in this._serverList?this._serverList.splice(0):this._serverList=new Array,e){var o=new n.ServerVO;o.update(e[i]),this._serverList.push(o)}if(""!=t)try{this._recentServerList=t.split(",")}catch(e){this._recentServerList=[]}else this._recentServerList=[]},i.prototype.goLoginLogin=function(){var e,t=this;(e={}).userAgent=window.navigator.userAgent,e.userAgentSDK=getUrlKV().userAgentSDK||"",this.playerProxy.loginStatusVO.state=100,this.log("goLoginLogin",Utils.agentConfig.channelName);var i=getUrlKV().recommendId||void 0,o=getUrlKV().recommendPlatform||void 0;i&&o&&this.log("来自玩家id推荐的用户",i,o),Utils.Socket.send("login","Login",{username:this.userVO.uuid,token:this.userVO.t_token,clientPasswd:this.clientPasswd,platform:Utils.agentConfig.AgentCode,osCode:Utils.DeviceUtils.getPlatform(),codeVersion:Utils.agentConfig.CodeVersion,serverId:this.serverSelect.area,unitServerId:this.serverSelect.s_id,userAgent:JSON.stringify(e),subPlatform:Utils.agentConfig.isHunFu?"":Utils.agentConfig.channelName,recommendId:Number(i),recommendPlatform:o,ext:JSON.stringify(this.userVO.login_loign_ext)}).then(function(e){Utils.SDKMgr.nodeRecord(300202),t.playerProxy.loginStatusVO.state=150,t.playerProxy.roleVo=e.role,t.log("create time",e.role.createDt),t.log("create time",t.playerProxy.roleVo.createDt),e.newRole&&(t.isNewPlayer=!0,Utils.SDKMgr.enterFlow("CreateRole")),t.sendNotification(CN.LOGIN_GO_LOGIN_LOGIN_SUCESS)}).catch(function(e){Utils.SDKMgr.nodeRecord(300203),t.sendNotification(CN.LOGIN_GO_LOGIN_LOGIN_FAIL),e&&10003!=e.err?(t.log("login login 失败",e.err,e),egret.setTimeout(function(){n.GameMgr.getInstance().restart()},t,3e3)):e.role&&e.role.playerId})},i.prototype.goLoginGameLoginGame=function(){var i=this;this.playerProxy.loginStatusVO.state=200,Utils.Socket.send("loginGame","LoginGame",{playerId:this.playerProxy.roleVo.playerId,username:this.userVO.uuid,name:this.playerProxy.playerInfoVO.name,sessionkey:this.playerProxy.roleVo.sessionkey,deviceId:Utils.DeviceUtils.deviceId(),codeVersion:Utils.agentConfig.CodeVersion}).then(function(e){e.isCreated,i.playerProxy.loginStatusVO.state=201,i.loginGameVO.update(e),i.log("进入游戏服成功"+e.initPm),Utils.SDKMgr.nodeRecord(300302),window.fundebug?(i.log("fundebug存在，设置用户名"),window.fundebug.metaData={name:i.userVO.username,uuid:i.userVO.uuid,playerId:i.playerProxy.roleVo.playerId}):i.log("fundebug注册失败"),Utils.Socket.send("loginGame","GetGuideInfo",{}).then(function(e){Utils.SDKMgr.nodeRecord(300304);var t=n.AppFacade.getInstance().retrieveProxy(n.GuidePy.N);try{t.serverGuideInfo=JSON.parse(e.guide)}catch(e){t.serverGuideInfo={}}Utils.SDKMgr.getPerformConfig(50)?i.getIsTodayHoliday(function(){i.sendNotification(CN.LOGIN_GO_LOGINGAME_LOGIN_SUCESS)}):i.sendNotification(CN.LOGIN_GO_LOGINGAME_LOGIN_SUCESS)}),n.GameMVC.mailPy.getMailList()}).catch(function(e){e&&e.err&&Utils.MsgUtils.addErrMsg(e.err),i.log("loginGame失败",e),Utils.SDKMgr.nodeRecord(300303),egret.setTimeout(function(){n.GameMgr.getInstance().restart()},i,1500)})},i.prototype.CreateFirstRole=function(e){},i.prototype.getGameNotice=function(t){var i=this;Utils.Http.toGet({action:"game_notice",game_notice:0}).then(function(e){e&&e.status&&""!=e.notice&&!i.isPopupNotice?(PopUpManager.addPopUp({obj:new n.NoticeBoardPanel({content:e.notice}),closeCB:function(){t&&t()}}),i.isPopupNotice=!0):t&&t()})},i.prototype.getPlayerServer=function(){var t=this;Utils.SDKMgr.nodeRecord(2001);var e="get_player_server";Utils.SDKMgr.getPerformConfig(2)&&(e="get_server_shenhe"),Utils.Http.toGet({action:e,username:this.userVO.uuid}).then(function(e){Utils.SDKMgr.nodeRecord(2002),t.updateServerList(e.svrListT,e.playerList),n.AppFacade.getInstance().sendNotification(CN.LOGIN_UPDATE_SERVER,e)})},i.prototype.getAllPlayerServer=function(c){var e="get_AllServerList";Utils.SDKMgr.getPerformConfig(2)&&(e="get_AllServerList_shenhe"),Utils.Http.toGet({action:e,os_code:Utils.DeviceUtils.getPlatform(),username:n.GameMVC.loginPy.userVO.uuid}).then(function(e){var t=[],i={},o=!1,n=0,a={index:n++,list:[]};for(var r in i["我的区服"]=a,Array.isArray(e)&&e.forEach(function(e){i[e.list_name]||(i[e.list_name]={index:n++,list:[],allNum:Number(e.s_Allnum)}),e.area=Number(e.area),i[e.list_name].list.push(e),e.playerList&&(o=o||!0,a.list.push(e))}),i){var s=i[r];t.push({name:r,index:s.index,list:s.list,allNum:s.allNum})}t.sort(function(e,t){return 0==e.index||0==t.index?0==e.index?-1:1:t.index-e.index}),Utils.SDKMgr.needNodeRecrod=!o,c(t,o)})},i.prototype.switchServer=function(t,i){var o=this;Utils.Http.toGet({action:"set_switchServer",username:this.userVO.uuid,unitServer:t,platform:Utils.agentConfig.AgentCode}).then(function(e){o.serverSelect||(o.serverSelect=new n.ServerVO),o.serverSelect.s_id=t,Utils.SDKMgr.enterFlow("SelectServer"),o.serverSelect=void 0,Utils.MsgUtils.addMidMsg("选服成功，点击登录"),i&&i(),500<=o.playerProxy.loginStatusVO.state?Utils.SDKMgr.restart():o.getPlayerServer()})},i.prototype.goHttpLogin=function(i){var o=this;150!=this.playerProxy.loginStatusVO.state?(Utils.SDKMgr.showLoadingTips({msg:"登录中"}),Utils.Http.toGet({action:"login",username:this.userVO.uuid,nickname:this.userVO.username,password:this.userVO.password,game_uin:this.userVO.uuid,token:this.userVO.verify_token,ext:JSON.stringify(this.userVO.login_ext)}).then(function(e){if(e&&0===e.success)Utils.SDKMgr.onLoginPHPSuccess(),Utils.SDKMgr.dismissLoading(),o.userVO.loginState=0,o.userVO.sign=e.sign,o.userVO.time=e.time,o.userVO.loginTime=Number(e.loginTime),o.userVO.age=Number(e.age),o.userVO.t_token=e.t_token,e.p_uid&&(o.userVO.login_loign_ext={p_uid:e.p_uid}),o.userVO.username&&""!=o.userVO.username||(o.userVO.username=e.game_uin),o.userVO.uuid&&""!=o.userVO.uuid||(o.userVO.uuid=e.game_uin),window.getUrlKV&&!window.getUrlKV().game_uin&&(window.getUrlKV().game_uin=e.game_uin),o.playerProxy.loginStatusVO.state=1,Utils.SDKMgr.nodeRecord(1001),Utils.LocalStorageUtil.setItem("login_et",JSON.stringify({acc:o.userVO.username,pwd:o.userVO.password}),!0),n.AppFacade.getInstance().sendNotification(CN.LOGIN_HTTP_LOGIN_SUCESS,e),i&&i();else{var t=e&&e.msg||"未知错误";Utils.MsgUtils.addMidMsg("登录失败："+t)}})):egret.log("已经通过了登录服了，跳过goHttpLogin")},i.prototype.goHttpRegister=function(t,i,o){var n=this;Utils.Http.toGet({action:"register",username:t,password:i}).then(function(e){0===e.success?(n.userVO.uuid=t,n.userVO.username=t,n.userVO.password=i,n.userVO.loginState=-1,n.goHttpLogin(),n.saveUserHistory(t,i),o&&o()):Utils.MsgUtils.addMidMsg("注册失败："+e.msg)})},i.prototype.saveUserHistory=function(e,t){for(var i=[],o=0,n=JSON.parse(Utils.LocalStorageUtil.getItem("LoginHistory",!0));o<n.length;o++){var a=n[o];a.acc!=e&&i.push(a)}8<=i.length&&i.shift(),i.push({acc:e,pwd:t}),Utils.LocalStorageUtil.setItem("LoginHistory",JSON.stringify(i),!0)},i.prototype.isSelf=function(e){return this.playerProxy.playerInfoVO.playerId==e},i.prototype.getNewAccountApi=function(e,t){Utils.Http.toGet({action:"get_newAccountApi",uuid:this.userVO.uuid,startTime:e}).then(function(e){e&&e.success,t&&t(e&&0===e.success)})},i.prototype.getIsTodayHoliday=function(t,e){var i=this;e&&(this.userVO.loginTime=0),Utils.Http.toGet({action:"holiday_api"}).then(function(e){i.userVO.isTodayHoliday="yes"==e,t&&t(e)})},i.N="LoginProxy",i);function i(){var e=t.call(this,i.N)||this;return e.clientPasswd="",e.playerProxy=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N),e.isPopupNotice=!1,e.isNewPlayer=!1,e._userVO=new n.UserVO,e.loginGameVO=new n.LoginGameVO,e.updateServerList({},""),e}n.LoginPy=e,__reflect(e.prototype,"game.LoginPy")}(game=game||{}),function(t){var i,e=(__extends(o,i=BaseFull),o.prototype.insertRecentPlayer=function(e){void 0===e&&(e=!0);var t=new eui.Group,i=new eui.HorizontalLayout;i.verticalAlign=egret.VerticalAlign.MIDDLE,t.layout=i;var o=new eui.Image(this.RECENT_PLAYER_SEX[Utils.MathUtils.getRandomInt(1,2)]);o.scaleX=.5,o.scaleY=.5;var n=new eui.Label;n.size=18,n.textFlow=[{text:"玩家 ",style:{textColor:16777215}},{text:""+this.playerProxy.getFadeName(),style:{textColor:65514}},{text:" 进入游戏",style:{textColor:16777215}}],t.addChild(o),t.addChild(n),this.gp_enter.addChild(t),e&&(this.sl_enter.stopAnimation(),this.gp_enter.validateNow(),this.gp_enter.scrollV=this.gp_enter.contentHeight-this.sl_enter.height)},o.prototype.showMakeRole=function(){var e=this;this.recentPlayerSche||(this.recentPlayerSche=egret.setInterval(function(){e.insertRecentPlayer()},this,1500),this.insertRecentPlayer(!1),this.insertRecentPlayer(!1),this.insertRecentPlayer(!1),this.insertRecentPlayer(!1),this.insertRecentPlayer(!0)),this.sl_enter.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_enter.scrollPolicyV=eui.ScrollPolicy.OFF,this.gp_name.visible=!0,this.onCampChange(Utils.MathUtils.getRandomInt(1,2)),this.makeRandomName()},o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.sl_enter.verticalScrollBar.visible=!1,this.sl_enter.verticalScrollBar.autoVisibility=!1,this.showMakeRole(),this.img_random.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.makeRandomName()},this),this.gp_boy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onCampChange(ESexType.ESexTypeMale)},this),this.img_small_nan.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onCampChange(ESexType.ESexTypeMale)},this),this.gp_girl.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onCampChange(ESexType.ESexTypeFemale)},this),this.img_small_nv.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onCampChange(ESexType.ESexTypeFemale)},this),this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){""===this.et_roleName.text?Utils.MsgUtils.addMidMsg("请输入角色名"):Utils.Http.checkStrLegal(this.et_roleName.text,!0)&&this.loginProxy.CreateFirstRole(this.et_roleName.text)},this),UIActionManager.breathe(this.img_role)},o.prototype.makeRandomName=function(){this.et_roleName.text=this.playerProxy.getRandomName()},o.prototype.onCampChange=function(e){switch(this.playerProxy.roleVo.camp=e){case ESexType.ESexTypeMale:UIActionManager.setOutLineEffect(this.img_zhenrong1),UIActionManager.setOutLineEffect(this.img_small_nan),UIActionManager.setOutLineEffect(this.img_zhenrong2,!1),UIActionManager.setOutLineEffect(this.img_small_nv,!1),this.playerProxy.roleVo.initCode=1,this.img_role.source="_login_create_role_m_json.login_img_nan",this.img_mask1.visible=!1,this.img_mask2.visible=!0,UIActionManager.setGrey(this.img_small_nan,!1),UIActionManager.setGrey(this.img_small_nv,!0);break;case ESexType.ESexTypeFemale:UIActionManager.setOutLineEffect(this.img_zhenrong2),UIActionManager.setOutLineEffect(this.img_small_nv),UIActionManager.setOutLineEffect(this.img_zhenrong1,!1),UIActionManager.setOutLineEffect(this.img_small_nan,!1),this.playerProxy.roleVo.initCode=2,this.img_role.source="_login_create_role_m_json.login_img_nv",this.img_mask1.visible=!0,this.img_mask2.visible=!1,UIActionManager.setGrey(this.img_small_nan,!0),UIActionManager.setGrey(this.img_small_nv,!1)}this.updateName()},o.prototype.updateName=function(){switch(this.playerProxy.roleVo.camp){case ESexType.ESexTypeMale:break;case ESexType.ESexTypeFemale:}},o.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.recentPlayerSche&&egret.clearInterval(this.recentPlayerSche)},o);function o(){var e=i.call(this)||this;return e.playerProxy=t.AppFacade.getInstance().retrieveProxy(t.PlayerPy.N),e.loginProxy=t.AppFacade.getInstance().retrieveProxy(t.LoginPy.N),e.RECENT_PLAYER_SEX={1:"_login_create_role_m_json.pokemon_nanbiaozhi",2:"_login_create_role_m_json.pokemon_nvbiaozhi"},e.skinName="MakeRole",e}t.MakeRolePanel=e,__reflect(e.prototype,"game.MakeRolePanel")}(game=game||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.ed_account.promptDisplay.size=this.ed_password.promptDisplay.size=24,this.ed_account.textDisplay.size=this.ed_password.textDisplay.size=24,this.lhl_history.visible=!1,this.btn_clear.visible=!1,this.addEvents()},o.prototype.updateView=function(){this.loginProxy.userVO&&(this.ed_account.text=this.loginProxy.userVO.username,this.ed_password.text=this.loginProxy.userVO.password)},o.prototype.addEvents=function(){this.ed_account.textDisplay.addEventListener(egret.Event.FOCUS_IN,this.onChange,this),this.ed_account.textDisplay.addEventListener(egret.Event.CHANGE,this.onChange,this),this.ed_account.textDisplay.addEventListener(egret.Event.FOCUS_OUT,this.onComplete,this),this.btn_list.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showRecentList,this),this.btn_clear.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClear,this),this.btn_logup.addEventListener(egret.TouchEvent.TOUCH_TAP,this.logup,this),this.btn_conform.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this)},o.prototype.onChange=function(){this.lhl_history.visible&&(this.lhl_history.visible=!1),this.ed_account.text&&""!=this.ed_account.text?(this.btn_clear.visible=!0,this.btn_list.visible=!1):(this.btn_clear.visible=!1,this.btn_list.visible=!0)},o.prototype.onComplete=function(){var e=this;egret.setTimeout(function(){e.btn_clear.visible=!1,e.btn_list.visible=!0},this,500)},o.prototype.onClear=function(){this.ed_password.text=void 0,this.ed_account.text=void 0,this.btn_clear.visible=!1,this.btn_list.visible=!0},o.prototype.showRecentList=function(){this.lhl_history.visible=!this.lhl_history.visible},o.prototype.logup=function(){t.AppFacade.getInstance().hideSubView(t.LoginMediator.N,t.LoginMediator.SV.LOGIN_PANEL),PopUpManager.addPopUp({obj:new a})},o.prototype.startGame=function(){var e=this;this.ed_account.text&&""!=this.ed_account.text&&this.ed_password.text&&""!=this.ed_password.text?(this.loginProxy.userVO.uuid=this.ed_account.text,this.loginProxy.userVO.username=this.ed_account.text,this.loginProxy.userVO.password=this.ed_password.text,this.loginProxy.userVO.loginState=-1,this.loginProxy.saveUserHistory(this.ed_account.text,this.ed_password.text),this.loginProxy.goHttpLogin(function(){console.log("登录成功"),e.hide()})):Utils.MsgUtils.addMidMsg("请输入帐号和密码")},o);function o(){var e=i.call(this)||this;return e.loginProxy=t.AppFacade.getInstance().retrieveProxy(t.LoginPy.N),e.playerProxy=t.AppFacade.getInstance().retrieveProxy(t.PlayerPy.N),e.focusOut=!1,e.skinName="NewLoginUISkin",e}t.NewLoginUI=e,__reflect(e.prototype,"game.NewLoginUI");var n,a=(__extends(r,n=BasePanel),r.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.ed_account.promptDisplay.size=this.ed_password.promptDisplay.size=24,this.ed_account.textDisplay.size=this.ed_password.textDisplay.size=24,this.ed_account.text=Utils.TimerManager.getServerTime().toString(),this.ed_password.text=Utils.TimerManager.getServerTime().toString(),this.addEvents()},r.prototype.addEvents=function(){var e=this;this.btn_conform.addEventListener(egret.TouchEvent.TOUCH_TAP,this.logup,this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.AppFacade.getInstance().showSubView(t.LoginMediator.N,t.LoginMediator.SV.LOGIN_PANEL),e.hide()},this),this.ed_account.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this),this.ed_password.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this)},r.prototype.logup=function(){var e=this;""!==this.ed_account.text&&""!==this.ed_password.text?Utils.Http.checkStrLegal(this.ed_account.text,!0)&&t.AppFacade.getInstance().retrieveProxy(t.LoginPy.N).goHttpRegister(this.ed_account.text,this.ed_password.text,function(){Utils.MsgUtils.addMidMsg("注册成功，自动登录中"),e.hide()}):Utils.MsgUtils.addMidMsg("请输入内容")},r.prototype.preClose=function(){},r);function r(){var e=n.call(this)||this;return e.isFinish=!1,e.skinName="NewLoginInputSKin",e}t.NewLoginInput=a,__reflect(a.prototype,"game.NewLoginInput")}(game=game||{}),function(e){var i,t=(__extends(o,i=BasePanel),o.prototype.onDestroy=function(){i.prototype.onDestroy.call(this)},o.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.params&&this.params.content?this.update(this.params.content):this.params&&this.params.fixedcontent?(this.lb_content.size=12,this.lb_content.text=this.params.fixedcontent):Utils.Http.toGet({action:"game_notice",game_notice:0}).then(function(e){e&&e.status&&t.update(e.notice)}),this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.sl_content.horizontalScrollBar.autoVisibility=!1,this.sl_content.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_content.scrollPolicyV=eui.ScrollPolicy.AUTO},o.prototype.update=function(e){var t=(new egret.HtmlTextParser).parser(e),i=[],o=0;t.forEach(function(t){var e=t.text.split("\\n");1<e.length?e.forEach(function(e){i.push({text:e,style:t.style}),i.push({text:"\n",style:{size:10}})}):i.push(t),o+=10}),0==i.length?this.lb_content.textFlow=[{text:"暂无公告"}]:this.lb_content.textFlow=i,588<this.lb_content.height&&(this.lb_content.height=this.lb_content.height-o)},o);function o(e){var t=i.call(this)||this;return t.skinName="NoticeBoardSkin",t.params=e,t}e.NoticeBoardPanel=t,__reflect(t.prototype,"game.NoticeBoardPanel")}(game=game||{}),function(s){var n,e=(__extends(t,n=BaseView),t.prototype.childrenCreated=function(){function e(e){var t=new eui.EditableText;t.size=14,t.width=140,t.prompt=e,t.name=e,i.gp_input.addChild(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.curFocusET=t},i),t.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){this.setV(0)},i)}n.prototype.childrenCreated.call(this),this.arr_rdm.push(this.cu_model0),this.arr_rdm.push(this.cu_model1),this.arr_rdm.push(this.cu_model2),this.arr_rdm.push(this.cu_model3),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide(),s.AppFacade.getInstance().showSubView(s.LoginMediator.N,s.LoginMediator.SV.BEFORE_LOGIN)},this),this.btn_change.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.changeAct()},this),this.btn_begin.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.begin()},this);for(var i=this,t=0,o=this.KEY;t<o.length;t++)e(o[t])},t.prototype.setV=function(e){this.curFocusET?this.curMagicalId?s.Config.pack.t_magical[this.curMagicalId][this.curFocusET.name]=Number(this.curFocusET.text):Utils.MsgUtils.addMidMsg("当前模型没有指定神器"):Utils.MsgUtils.addMidMsg("请选中输入框")},t.prototype.reset=function(){},t.prototype.checkValid=function(){return!0},t.prototype.changeAct=function(){var i=this.actArr[++this.curActIndex%this.actArr.length];this.arr_rdm.forEach(function(e,t){e.curModelAct=i})},t.prototype.begin=function(){var i=this;if(this.checkValid()){if(this.et_shenqi.text){var e=s.Config.pack.t_magical;for(var t in e)if(e[t].ol_model==this.et_shenqi.text){this.curMagicalId=t;break}if(this.curMagicalId)for(var o=0,n=this.KEY;o<n.length;o++){var a=n[o],r=this.gp_input.getChildByName(a);r&&s.Config.pack.t_magical[this.curMagicalId][a]&&(r.text=s.Config.pack.t_magical[this.curMagicalId][a])}}this.arr_rdm.forEach(function(e,t){e.name=t.toString(),e.visible=!0,e.update({fashionModel:i.et_pf.text,titleModel:i.et_chenghao.text,magicalModel:i.et_shenqi.text,horseModel:i.et_zuoqi.text}),e.onChangingDir(i.dirArr[t])})}},t);function t(){var e=n.call(this)||this;return e.playing=!1,e.curActIndex=0,e.dirArr=[3,1,0,2],e.actArr=[ROLE_ACTION_NAME.DJ,ROLE_ACTION_NAME.GJ,ROLE_ACTION_NAME.PB,ROLE_ACTION_NAME.SJ],e.KEY=["ol_scaleXY_z","ol_scaleXY_b","ol_rotation_z","ol_rotation_b","ol_acOffsetX_z","ol_acOffsetX_b","ol_acOffsetY_z","ol_acOffsetY_b","ol_slotKey_z","ol_slotKey_b"],e.skinName="RoleTestViewSkin",e.arr_rdm=new Array,e}s.RoleTestView=e,__reflect(e.prototype,"game.RoleTestView")}(game=game||{}),function(e){var a,t=(__extends(i,a=BasePanel),i.prototype.childrenCreated=function(){var e=this;a.prototype.childrenCreated.call(this),this.lb_hint.visible=!1,this.initView(0,!1),this.timer&&(this.timer=void 0);var t=this.commonT+(this.moveT-this.DrMT),i=2*(this.moveT-this.DrMT)+4*this.disT+600,o=this.moveT+this.commonT,n=2*(this.moveT-this.DrMT)+this.moveT;this.timer=egret.setInterval(function(){if(++e.clock,(0<e.clickTime||(t+i+o+n+3400+4e3)/e.invT<=e.clock)&&++e.endCount,e.endCount<=0)switch(e.clock){case 10:e.curMoveId=1,e.gp1Animation();break;case(t+1e3)/e.invT:e.curMoveId=2,e.gp2Animation();break;case(t+i+2e3)/e.invT:e.curMoveId=3,e.gp3Animation();break;case(t+i+o+3e3)/e.invT:e.curMoveId=4,e.gp4Animation();break;case(t+i+o+n+4e3)/e.invT:e.curMoveId=5,e.gp5Animation()}else 80==e.endCount&&e.startGame(),10==e.endCount&&(e.lb_hint.visible=!0)},this,this.invT),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){2e3<=e.clock*e.invT&&(++e.clickTime,1==e.clickTime?(e.resetTweenAct(e.curMoveId),e.initView(1,!0),egret.Tween.get(e.lb_hint).to({visible:!0},500)):1<e.clickTime&&e.startGame())},this)},i.prototype.initView=function(e,t){for(var i=1;i<8;++i){var o=this["img_"+i];4!=i?o.visible=t:(o.scaleX=o.scaleY=1,o.alpha=e)}for(var n=0;n<13;++n){var a=this["img_fade_"+n];n<=3&&!t?a.visible=t:a.alpha=e}this.img_move_1.visible=t;for(var r=1;r<9;++r){var s=this["img_lb_"+r];s.scaleX=s.scaleY=1,s.alpha=e}},i.prototype.updateView=function(e){},i.prototype.resetTweenAct=function(e){if(2==this.curMoveId){var t=[536.21,380.36,289.11];for(var i in this.tweenArr){var o=this.tweenArr[i];egret.Tween.removeTweens(o)}for(var n=1;n<4;++n){var a=this["img_fade_"+n];a.alpha=1,a.visible=!0,a.x=t[n-1],UIActionManager.breathe(a)}}},i.prototype.gp1Animation=function(){var e=this;this.moveBySide(1,this.img_1,function(){e.showTips(e.img_lb_1,e.commonT)})},i.prototype.gp2Animation=function(){var n=this;this.moveBySide(-1,this.img_2,function(){n.moveBySide(-1,n.img_3,function(){var e=n.img_move_1.y;n.img_move_1.visible=!0,n.img_move_1.y=n.img_move_1.y+250,egret.Tween.get(n.img_move_1).to({y:e},n.disT).call(function(){n.shaking(n.img_move_1)}),n.showTips(n.img_lb_2,n.commonT,function(){egret.setTimeout(function(){var o=function(e,t,i){0<n.clickTime||n.moveBySide(1,e,function(){if(i&&i(),++t<=3){var e=n["img_fade_"+t];o(e,t,function(){UIActionManager.breathe(e)})}},!0)},e=n.img_fade_1;o(e,1,function(){n.tweenArr.push(e),n.showTips(n.img_lb_3,2*n.disT),UIActionManager.breathe(e)})},n,600)})})})},i.prototype.gp3Animation=function(){var e=this,t=this.img_4;t.alpha=0,t.scaleY=.5,t.scaleX=.5,egret.Tween.get(t).to({scaleY:1,scaleX:1,alpha:1},this.moveT).call(function(){e.showTips(e.img_lb_4,e.commonT,function(){})})},i.prototype.gp4Animation=function(){var i=this;this.moveBySide(-1,this.img_5,function(){i.moveBySide(-1,i.img_6,function(){i.showTips(i.img_lb_6,i.commonT);var e=i.img_fade_0;e.visible=!0,e.x=e.x-400;var t=e.x+400;egret.Tween.get(i.img_fade_0).to({x:t},800)})})},i.prototype.gp5Animation=function(e,i,o){var n=this;void 0===e&&(e=1500),void 0===i&&(i=500),void 0===o&&(o=200);var t=e,a=this.img_7;a.visible=!0;var r=a.y,s=this.img_fade_4.y;a.y+=400,this.img_fade_4.y+=400,this.img_fade_4.alpha=1,egret.Tween.get(this.img_lb_7).wait(this.moveT).call(function(){n.showTips(n.img_lb_7,n.commonT)}),egret.Tween.get(this.img_fade_4).to({y:s},t),egret.Tween.get(a).to({y:r},t).call(function(){var e=o,t=i;egret.Tween.get(n.img_fade_5).wait(t).to({alpha:1},n.commonT),egret.Tween.get(n.img_fade_6).wait(t+2*e).to({alpha:1},n.commonT),egret.Tween.get(n.img_fade_7).wait(t+3*e).to({alpha:1},n.commonT),egret.Tween.get(n.img_fade_8).wait(t+4*e).to({alpha:1},n.commonT).call(function(){n.showTips(n.img_lb_8,n.commonT+3*e),egret.Tween.get(n.img_fade_9).to({alpha:1},n.commonT),egret.Tween.get(n.img_fade_10).wait(e).to({alpha:1},n.commonT),egret.Tween.get(n.img_fade_11).wait(2*e).to({alpha:1},n.commonT),egret.Tween.get(n.img_fade_12).wait(3*e).to({alpha:1},n.commonT)})})},i.prototype.moveBySide=function(e,t,i,o,n){var a=t;a.visible=!0;var r=720*e;a.x=a.x+r;var s=a.x-r,c=this.moveT;o?egret.Tween.get(a).to({x:s},c).call(function(){i&&i()}):egret.Tween.get(a).to({x:s-100},c-this.DrMT).call(function(){i&&i()}).to({x:s},this.DrMT,egret.Ease.backOut)},i.prototype.myFadeInOrOut=function(e,t,i,o){var n=e;n.alpha=1-t,egret.Tween.get(n).to({alpha:t},i,egret.Ease.backOut).call(function(){o&&o()})},i.prototype.showTips=function(e,t,i){e.alpha=0,e.scaleY=.5,e.scaleX=.5,egret.Tween.get(e).to({scaleY:1,scaleX:1,alpha:1},t).call(function(){i&&i()})},i.prototype.shaking=function(e){var t=this,i=e.y;egret.Tween.get(e).to({y:i+5},700).to({y:i},700).call(function(){t.shaking(e)})},i.prototype.startGame=function(){this.hide(),this.params&&this.params.cb&&this.params.cb()},i.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},i);function i(e){var t=a.call(this)||this;return t.clickTime=0,t.endCount=0,t.clock=0,t.commonT=350,t.disT=500,t.moveT=500,t.DrMT=200,t.invT=50,t.curMoveId=1,t.tweenArr=[],t.skinName="StartAnimationSkin",t.params=e,t}e.StartAnimation=t,__reflect(t.prototype,"game.StartAnimation")}(game=game||{}),function(e){var o,t=(__extends(i,o=BasePanel),i.prototype.onDestroy=function(){o.prototype.onDestroy.call(this)},i.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.sl_content.horizontalScrollBar.autoVisibility=!1,this.sl_content.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_content.scrollPolicyV=eui.ScrollPolicy.AUTO,this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this);for(var e=1;e<=20;e++){var t="common_gg_0"+e+"_png";if(RES.hasRes(t)){var i=new eui.Image;i.source=t,this.gp_content.addChild(i)}}},i);function i(e){var t=o.call(this)||this;return t.skinName="UpdateLogPanelSkin",t.params=e,t}e.UpdateLogPanel=t,__reflect(t.prototype,"game.UpdateLogPanel")}(game=game||{}),function(C){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.reward_items=new Array,this.commonXiaoTanChuKuang.onCloseCB=function(){C.AppFacade.getInstance().hideSubView(C.MailMediator.N,C.MailMediator.SV.INFO)},this.img_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.btnPressed=!0,Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),e.uuid&&e.mailProxy.readMail({uuid:e.uuid}),C.AppFacade.getInstance().hideSubView(C.MailMediator.N,C.MailMediator.SV.INFO)},this),this.img_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),e.uuid&&e.mailProxy.readMail({uuid:e.uuid},function(){e.img_get.visible=!1,e.img_yilingqu.visible=!0})},this)},i.prototype.updateView=function(e){var t=e.uuid;if(null!=t){this.uuid=t;var i,o,n=this.mailProxy.mailList[t],a=new Date(1e3*n.sendTime),r=C.Config.mailConfig()[n.key],s=n.getContentTextFlow(),c=a.getMonth()+1,l=a.getDate();if(i=c<10?"0"+c:""+c,o=l<10?"0"+l:""+l,this.lb_time.textFlow=new Array({text:"系统管理员\n",style:{textColor:7295027,size:18,bold:!0}},{text:"\n"},{text:i+"月"+o+"日  剩余"+Math.floor((n.expireTime-Utils.TimerManager.getServerTime())/86400)+"天",style:{textColor:7295027,size:18,bold:!0}}),35==r.key){s.push({text:"\n"});var h="        vip客服QQ: "+Utils.agentConfig.other.vipQQ;s.push({text:h,style:{}})}if(this.lb_tip.text=n.theme||r.theme,this.lb_title.textFlow=s,"{}"==n.attachs)this.img_get.visible=!1,this.img_ok.visible=!0,this.img_yilingqu.visible=!1,this.sl_reward.visible=!1;else{this.gp_rewards=new eui.Group;var p=new eui.HorizontalLayout;p.verticalAlign=egret.VerticalAlign.MIDDLE,p.horizontalAlign=egret.HorizontalAlign.CENTER,this.gp_rewards.layout=p,this.sl_reward.viewport=this.gp_rewards,this.sl_reward.scrollPolicyV=eui.ScrollPolicy.OFF,this.sl_reward.visible=!0,this.img_get.visible=!0,this.img_yilingqu.visible=!1,this.img_ok.visible=!1}for(var d=0,u=this.reward_items;d<u.length;d++){var g=u[d];g&&g.parent&&g.parent.removeChild(g)}for(var f=JSON.parse(n.attachs),_=0,m=f;_<m.length;_++){var y=m[_],v=customui.BaseItemFactory.create(21);v.updateData({type:y[0],code:y[1],num:y[2]}),v.scaleX=v.scaleY=.85,this.reward_items.push(v),this.gp_rewards.addChild(v)}var T=f.length;n.status==EMailStatus.EMailStatusRead?(this.img_yilingqu.visible=!("{}"==n.attachs),this.img_get.visible=!1,this.img_ok.visible=!1):T&&(this.img_get.visible=!0,this.img_yilingqu.visible=!1,this.img_ok.visible=!1)}else this.log("uuid == undefined")},i.prototype.perClose=function(){if(!this.btnPressed&&this.uuid&&this.reward_items.length<=0){var e=this.mailProxy.mailList[this.uuid];e&&e.status==EMailStatus.EMailStatusUnread&&this.mailProxy.readMail({uuid:e.uuid})}},i);function i(){var e=t.call(this)||this;return e.btnPressed=!1,e.skinName="MailInfoSkin",e.mailProxy=C.AppFacade.getInstance().retrieveProxy(C.MailPy.N),e}C.MailInfo=e,__reflect(e.prototype,"game.MailInfo")}(game=game||{}),function(e){var i,t=(i=eui.Component,__extends(o,i),Object.defineProperty(o.prototype,"onArmatureLoadCB",{set:function(e){this.creatingArmature?this._onArmatureLoadCB=e:e(this.egretArmDisplay)},enumerable:!0,configurable:!0}),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data&&this.update(this.data),this.once(egret.Event.REMOVED_FROM_STAGE,function(){null!=this.actionChangeTimer&&egret.clearTimeout(this.actionChangeTimer),this.hero_soundchannel&&(this.hero_soundchannel.stop(),this.hero_soundchannel=void 0)},this)},o.prototype.update=function(e,i){var o=this;if(this.data==e||this.data&&this.data.code&&this.data.code==e.code){if(e.derma&&this.data.derma==e.derma)return;if(!e.derma&&!this.data.derma)return}if(this.creatingArmature){var t={arrData:e,arrCreateDoneCb:i};this.creatList.push(t)}else{this.creatingArmature=!0,this.data=e,this.isStatic=this.data.isStatic||!1,this.egretArmDisplay&&this.egretArmDisplay.parent&&this.egretArmDisplay.parent.removeChild(this.egretArmDisplay);var n=this.data.model?this.data.model:this.data.derma?this.data.derma.model:void 0;if(!n){var a=this.data.code;a&&(n=(game.Config.allHeroConfig()[a]||game.Config.creepConfig(a)).model)}""==n&&(n="hero_018_02"),null!=this.actionChangeTimer&&egret.clearTimeout(this.actionChangeTimer),this.actionChangeTimer=void 0,n?DragonBoneTools.createForHero(n,function(e){if(o.creatingArmature=!1,0<o.creatList.length){var t=o.creatList.shift();o.update(t.arrData,t.arrCreateDoneCb)}else e.animation.play("daiji"),e.x=o.gp_root.width/2,e.y=o.gp_root.height,o.gp_root.addChild(e),o.egretArmDisplay=e,o.isStatic||(o.actionChangeTimer=egret.setTimeout(function(){this.changeAction()},o,o.ACTION_CHANGE_INTERVAL)),i&&i(),o._onArmatureLoadCB&&o.once(egret.Event.ENTER_FRAME,function(){o._onArmatureLoadCB&&o._onArmatureLoadCB(o.egretArmDisplay),o._onArmatureLoadCB=void 0},o)},this,{}):this.creatingArmature=!1,this.isStatic?this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.playVoice,this):this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.playVoice,this)}},o.prototype.changeAction=function(e){try{if(this.egretArmDisplay&&this.egretArmDisplay.animation){var t=e||o.RANDOM_ACTION_LIST,i=t[Math.round(Math.random()*(t.length-1))];this.egretArmDisplay.animation.play(i,1),this.actionChangeTimer&&(egret.clearTimeout(this.actionChangeTimer),this.actionChangeTimer=void 0),this.egretArmDisplay.hasEventListener(dragonBones.EventObject.COMPLETE)||this.egretArmDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this.onActionComplete,this)}}catch(e){egret.warn(e)}},o.prototype.playVoice=function(){var t=this;if(this.hero_soundchannel&&this.hero_soundchannel.stop(),!this.isStatic&&this.data.code){var e=game.Config.allHeroConfig()[this.data.code];if(!e)return;var i=e.voice;if(!i)return;RES.getResAsync(i,function(e){t.hero_soundchannel=Utils.SoundManager.playSound(i)},this)}},o.prototype.onActionComplete=function(){this.egretArmDisplay.hasEventListener(dragonBones.EventObject.COMPLETE)&&this.egretArmDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this.onActionComplete,this),this.egretArmDisplay.animation.play("daiji"),this.isStatic||(this.actionChangeTimer=egret.setTimeout(function(){this.changeAction()},this,this.ACTION_CHANGE_INTERVAL))},o.RANDOM_ACTION_LIST=["gongji","shouji"],o.TOUCH_ACTION_LIST=["gongji"],o);function o(e){var t=i.call(this)||this;return t.ACTION_CHANGE_INTERVAL=7e3,t.creatList=[],t.data=e,t.skinName="HeroDynamicModelSkin",t}e.HeroDynamicModel=t,__reflect(t.prototype,"customui.HeroDynamicModel")}(customui=customui||{}),function(i){var e=(t.registerAll=function(){(new n).register(),(new s).register()},t);function t(){}i.MailProcessor=e,__reflect(e.prototype,"game.MailProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){if(this.checkCB(e.getBody())){this.log("NewMailP 下推新邮件");var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.MailPy.N).updateMailList([t.newMail])}},a);function a(){return o.call(this,"mail.NewMailP",a)||this}i.NewMailP=n,__reflect(n.prototype,"game.NewMailP");var r,s=(r=i.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){if(this.checkCB(e.getBody())){this.log("AutoDelMailP 下推自动删除邮件");var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.MailPy.N).deleteMail(t.delList)}},c);function c(){return r.call(this,"mail.AutoDelMailP",c)||this}i.AutoDelMailP=s,__reflect(s.prototype,"game.AutoDelMailP")}(game=game||{}),function(a){var t,e=(__extends(i,t=BaseProxy),i.prototype.addNotice=function(){NoticeManager.registerCB(NT.MAIL,this.checkMailNotice,this)},i.prototype.updateMailList=function(e){for(var t in e){var i=e[t];if(this.mailList[i.uuid])this.mailList[i.uuid].update(i);else{var o=new a.MailVO(i);this.mailList[i.uuid]=o}}a.AppFacade.getInstance().updateView(a.MailMediator.N,a.MailMediator.SV.MAIN),NoticeManager.updateNotice(NT.MAIL);var n=this.get96Mail();Utils.MsgUtils.addVipMailHead(n)},i.prototype.get96Mail=function(){var e=[];for(var t in this.mailList){var i=this.mailList[t];"96"==i.key&&i.status==EMailStatus.EMailStatusUnread&&e.push(i)}return e.sort(function(e,t){return e.sendTime-t.sendTime}),e[0]},i.prototype.deleteMail=function(e){var i=this;e.forEach(function(e,t){i.mailList[e]&&delete i.mailList[e]}),a.AppFacade.getInstance().updateView(a.MailMediator.N,a.MailMediator.SV.MAIN)},i.prototype.getMailList=function(t,i){var o=this;Utils.Socket.send("mail","GetMailList",{}).then(function(e){o.updateMailList(e.mailList),t&&t(e,i)}).catch(function(e){})},i.prototype.readMail=function(e,t,i){var o=this;void 0===e&&(e={uuid:""}),Utils.Socket.send("mail","ReadMail",e).then(function(e){a.AppFacade.getInstance().retrieveProxy(a.BackpackPy.N).handleClientReward(e.clientReward,2),o.updateMailList(e.mailList),t&&t()}).catch(function(e){})},i.prototype.delMail=function(e,t,i){var o=this;void 0===e&&(e={uuid:""}),Utils.Socket.send("mail","DelMail",e).then(function(e){o.deleteMail(e.delList),t&&t(e,i)}).catch(function(e){})},i.prototype.checkMailNotice=function(){for(var e in this.mailList)if(0==this.mailList[e].status)return!0;return!1},i.N="MailProxy",i);function i(){var e=t.call(this,i.N)||this;return e.mailList={},e.addNotice(),e}a.MailPy=e,__reflect(e.prototype,"game.MailPy")}(game=game||{}),function(_){var t,e=(__extends(i,t=BasePanel),i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.commonDaTanKuang.blb_title.font="common_title_fnt",this.initUI(),this.initButton(),this.initList(),this.addNotice()},i.prototype.initUI=function(){this.commonDaTanKuang.blb_title.text="邮件"},i.prototype.initButton=function(){var e=this;this.commonDaTanKuang.onCloseCB=function(){e.hide()},this.img_get_auto.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),this.mailPy.readMail()},this),this.img_delete_auto.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),this.mailPy.delMail()},this)},i.prototype.initList=function(){this.list_item.itemRenderer=n,this.ac_item=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_item},i.prototype.addNotice=function(){},i.prototype.updateView=function(e){var t=new Array,i=this.mailPy.mailList,o=!1;for(var n in this.getNum=0,i){var a=i[n];t.push(i[n]),o||a.status!=EMailStatus.EMailStatusUnread||(o=!0,this.getNum++)}t.sort(function(e,t){var i=JSON.parse(e.attachs).length,o=JSON.parse(t.attachs).length;return e.status==EMailStatus.EMailStatusUnread&&t.status==EMailStatus.EMailStatusRead?-1:t.status==EMailStatus.EMailStatusUnread&&e.status==EMailStatus.EMailStatusRead?1:e.sendTime<t.sendTime?1:t.sendTime<e.sendTime?-1:0<i&&0==o?-1:0==i&&0<o?1:void 0});for(var r=0;r<t.length;r++)t[r].index=r;this.ac_item.replaceAll(t);var s=!1;for(var n in i)if(i[n]){s=!0;break}s&&0<this.getNum?(this.img_get_auto.enabled=!0,UIActionManager.setAbsGrey(this.img_get_auto,!1)):(this.img_get_auto.enabled=!1,UIActionManager.setAbsGrey(this.img_get_auto)),this.gp_empty.visible=!s;var c=_.Config.constConfig().maxMailNum.constValue;this.lb_tip.text="邮箱可容纳"+c+"封邮件，请注\n意收取哦("+t.length+"/"+c+")",this.lb_tip.textFlow=new Array({text:t.length+"/"+c,style:{textColor:5385490,size:18}},{text:"   ",style:{textColor:16777215,size:18}},{text:"邮箱可容纳"+c+"封邮件，请注意查收",style:{textColor:5385490,size:18}})},i);function i(){var e=t.call(this)||this;return e.mailPy=_.GameMVC.mailPy,e.skinName="MailUISkin",e}_.MailUI=e,__reflect(e.prototype,"game.MailUI");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.initList=function(){},a.prototype.dataChanged=function(){var e=_.Config.mailConfig()[this.data.key];if(e){this.scaleX=this.scaleY=.98;var t=new Date(1e3*this.data.sendTime),i=this.data;this.btn_go.visible=!1,i.status==EMailStatus.EMailStatusUnread&&"{}"==i.attachs&&(this.btn_go.visible=!0),this.lb_info.text=t.getMonth()+1+"月 "+t.getDate()+"日   "+(this.data.theme||e.theme);var o=new Array;o=i.getContentTextFlow();var n=new Array;for(var a in o)n.push(o[a].text);var r=n.join("");this.lb_content.text=r,this.lb_hint.text="剩余"+Math.floor((this.data.expireTime-Utils.TimerManager.getServerTime())/86400)+"天",30<this.lb_content.text.length&&(this.lb_content.text=this.lb_content.text.substr(0,30)+"...");for(var s=0,c=this.reward_items;s<c.length;s++)(a=c[s])&&a.parent&&a.parent.removeChild(a);for(var l=JSON.parse(this.data.attachs),h=0,p=0,d=l;p<d.length;p++){var u=d[p],g=customui.BaseItemFactory.create(11);g.updateData({type:u[0],code:u[1],num:u[2]}),g.y=8,g.x=0+h++*(g.width+30)*.4,g.scaleX=.4,g.scaleY=.4,this.reward_items.push(g),this.gp_reward.addChild(g)}var f=l.length;this.img_flag.visible=0<f,this.btn_go.visible=0<f&&this.data.status==EMailStatus.EMailStatusUnread,this.btn_lingqu.visible=0<f&&this.data.status==EMailStatus.EMailStatusRead,this.data.status==EMailStatus.EMailStatusRead?(UIActionManager.setAbsGrey(this.gp_root),this.img_head_bg.source="common_icon_youjian_002_png"):(UIActionManager.setAbsGrey(this.gp_root,!1),this.img_head_bg.source="common_icon_youjian_001_png"),this.gp_reward.visible=!1}},a);function a(){var e=o.call(this)||this;return e.mailProxy=_.AppFacade.getInstance().retrieveProxy(_.MailPy.N),e.backpackProxy=_.AppFacade.getInstance().retrieveProxy(_.BackpackPy.N),e.reward_items=new Array,e.skinName="CommonItemRenderMailSkin",e.initList(),e.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),this.data&&this.mailProxy.readMail({uuid:this.data.uuid})},e),e.gp_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),this.data&&_.AppFacade.getInstance().showSubView(_.MailMediator.N,_.MailMediator.SV.INFO,{uuid:this.data.uuid})},e),e}_.MailItem=n,__reflect(n.prototype,"game.MailItem")}(game=game||{}),function(e){var o,t=(__extends(i,o=BasePanel),i.prototype.childrenCreated=function(){var i=this;if(o.prototype.childrenCreated.call(this),this.mailinfo){var e=/\d{8,}/.exec(this.mailinfo.content);this.qq=e&&e[0]||"";var t=this.mailinfo.getContentTextFlow();this.lb_content0.textFlow=t,this.lb_content1.textFlow=t,this.gp_mail.bottom=-347,this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this),this.btn_copy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.qq?Utils.SDKMgr.copyToClipBoard(i.qq,function(e){0==e?Utils.MsgUtils.addMidMsg("复制成功"):Utils.MsgUtils.addMidMsg("复制失败")}):Utils.MsgUtils.addMidMsg("获取QQ号失败")},this),this.btn_confirm.visible=!1,this.btn_copy.visible=!1,this.lb_content0.height=30,this.lb_content1.height=30,this.lb_content0.alpha=0,this.lb_content1.alpha=0,egret.setTimeout(function(){egret.Tween.get(i.gp_mail).to({bottom:37},500,egret.Ease.cubicIn).call(function(){i.gp_main.swapChildren(i.img_bg_2,i.sl_root),egret.Tween.get(i.sl_root).to({verticalCenter:0},500,egret.Ease.cubicOut).call(function(){var e,t=i.lb_content0.numLines;e=function(){0<--t?(egret.Tween.removeTweens(i.lb_content0),egret.Tween.removeTweens(i.lb_content1),1==i.lb_content0.alpha?(egret.Tween.get(i.lb_content0).to({alpha:0},800),egret.Tween.get(i.lb_content1).to({alpha:1},800).call(function(){i.lb_content0.height+=120,e()},i)):(egret.Tween.get(i.lb_content1).to({alpha:0},800),egret.Tween.get(i.lb_content0).to({alpha:1},800).call(function(){i.lb_content1.height+=120,e()},i))):(egret.Tween.removeTweens(i.lb_content0),egret.Tween.removeTweens(i.lb_content1),i.btn_confirm.visible=!0,i.btn_copy.visible=!0,i.lb_content0.alpha=0,i.lb_content1.alpha=1)},egret.Tween.get(i.lb_content1).to({alpha:1},800).call(function(){i.lb_content0.height+=60,e()},i),i.img_bg_1.visible=i.img_bg_2.visible=!1})})},this,500)}else this.hide()},i.prototype.onDestroy=function(){o.prototype.onDestroy.call(this),this.mailinfo&&e.GameMVC.mailPy.readMail({uuid:this.mailinfo.uuid})},i);function i(e){var t=o.call(this)||this;return t.qq="",t.skinName="VIPMail",t.mailinfo=e,t}e.VIPMail=t,__reflect(t.prototype,"game.VIPMail")}(game=game||{}),function(v){var e=(t.VIEW_GROUP_ORDER={CITY:{TOP:["common_icon_yaoqingyouli_png","common_icon_jingcaihuodong_png","common_icon_xianshihuodong_png","common_icon_denglulibao_png","common_icon_hefuhuodon_png","common_icon_qingminghuodong_png","common_icon_liuyihuodong_png","common_icon_kaixuehuodong_png","common_icon_shuqihuodong_png","common_icon_mofanxiaodao_png","common_icon_guanghuirongyao_png"],RIGHT:["common_icon_xuyuanzhuanpan_png","common_icon_meirihaoli_png","common_icon_chaozhilibao_png","common_icon_shouchonglibao_png","common_icon_guanzhu_png","common_icon_guanzhuhaoli_png","common_icon_shoucangyouli_png","common_icon_viptequan_png","huodong_icon_xingqubuluo_png","common_icon_shimingrenzheng_png","common_icon_weiduanxiazai_png","sdk_custom1_cb","common_icon_yiyuanlingqu_png","common_icon_xinchunhesui_png","common_icon_zunxianglibao_png","common_icon_zhanqujingpai_png","common_icon_jingxibaoxiang_png","_main_m_json.maoxian_icon_msrq02","common_icon_tehuijinka_png","common_icon_fulihuikui_png","common_icon_shouquanrenzheng_png","common_icon_mianfeilingjiang_png","common_icon_yiyuanlingquNew_png","common_icon_meiribuji_png","common_icon_tehuihuikui_png","common_icon_zhuanshutouxiang_png","common_icon_pifulibao_png","wanba_icon_chongzhipaihang_png","common_icon_shuangshiyikuanghuanjie_png","common_icon_shimingrenzheng2_png","common_icon_xianjinhongbao_png","common_icon_gongzhonghaofuli_png","common_icon_fenxianghaoli_png","common_icon_zhuanshuhaoli_png","common_icon_huiguifuli_png"],RIGHT2:["common_icon_jinrihuodong_png","common_icon_hongbao_png","huodong_icon_qqhuangzuantequan_png"],LEFT:["_btn_lb_m_json.common_icon_fenxiang"],LEFT_BOTTOM:["common_icon_chongwu_png","common_icon_yinghunwangshi_png","common_icon_zhujue_png","common_icon_zuoqi_png","common_icon_taozhuangshuxing_png"]},GUAJI:{TOP:[],RIGHT:["empty1_png","empty2_png","common_icon_shouchonglibao_png"],RIGHT2:[],LEFT:[],LEFT_BOTTOM:[]}},t.TOP_BTN_CONFIG=[{img:"common_icon_yaoqingyouli_png",noticeType:void 0,unlockModule:MODULE.Activity+EActivityType.InvitationCode,isOpenCheck:function(){return v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).isOpen(EActivityType.InvitationCode)},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.InvitationCode)}},{img:"common_icon_jingcaihuodong_png",noticeType:NT.ACTIVITY_ENTRANCE[ACTIVITY_ENTRANCE.JINGCAI],unlockModule:void 0,isOpenCheck:function(){var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.JINGCAI),i=!1;return e.forEach(function(e){t.isOpen(e.id)&&(i=!0)}),i},clickFunc:function(){v.AppFacade.getInstance().showSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.JINGCAI})}},{img:"common_icon_xianshihuodong_png",noticeType:NT.ACTIVITY_ENTRANCE[ACTIVITY_ENTRANCE.ACTIVITY],unlockModule:void 0,isOpenCheck:function(){var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.ACTIVITY),i=!1;return e.forEach(function(e){t.isOpen(e.id)&&(i=!0)}),i},clickFunc:function(){v.AppFacade.getInstance().showSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.ACTIVITY})},updateId:["bm_time"],updateFunc:function(e){var n=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"bm_time":var t=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.ACTIVITY),i=0;if(t.forEach(function(e){if(n.isOpen(e.id)){var t=v.ActivityConfig.getActivityEndDt(e.id);i<t&&(i=t)}}),i&&0!=i){var o=i-v.GameMgr.getInstance().serverTime();e.text=Utils.TimerManager.getFormatBySecond2(o)}else e.text=""}})}},{img:"common_icon_denglulibao_png",noticeType:NT.ALL_ACTIVITY[EActivityType.DailyLogin],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.DailyLogin]},unlockModule:void 0,isOpenCheck:function(){var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.DailyLogin];if(!e||!e.data)return!1;var t=JSON.parse(e.content),o=e.data.targeted,n=e.data.key||0,a=(e.data.day,!0);return t.forEach(function(e){var t=e[0],i=REWARD_STATUS.UNAVAILABLE;o.some(function(e){return e.id==t&&0<e.num})?i=REWARD_STATUS.RECEIVED:n>=e[1]&&(i=REWARD_STATUS.AVAILABLE),i!=REWARD_STATUS.AVAILABLE&&i!=REWARD_STATUS.UNAVAILABLE||(a=!1)}),!a},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.DailyLogin)},updateId:["bm_time"],updateFunc:function(e){v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e&&e.forEach(function(e){switch(e.name){case"bm_time":var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.DailyLogin];if(!t||!t.data)return!1;var i=v.ActivityConfig.getActivityEndDt(EActivityType.DailyLogin);if(i&&0!=i){var o=i-v.GameMgr.getInstance().serverTime();e.text=Utils.TimerManager.getFormatBySecond2(o)}}})}},{img:"common_icon_hefuhuodon_png",noticeType:NT.ACTIVITY_ENTRANCE[ACTIVITY_ENTRANCE.HEFU],unlockModule:void 0,isOpenCheck:function(){var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HEFU),i=!1;return e.forEach(function(e){t.isOpen(e.id)&&(i=!0)}),i},clickFunc:function(){v.AppFacade.getInstance().showSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.HEFU})},updateId:["btn","bm_time"],updateFunc:function(e){var n=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"btn":break;case"bm_time":var t=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HEFU),i=0;if(t.forEach(function(e){if(n.isOpen(e.id)){var t=v.ActivityConfig.getActivityEndDt(e.id);i<t&&(i=t)}}),i&&0!=i){var o=i-v.GameMgr.getInstance().serverTime();e.text=Utils.TimerManager.getFormatBySecond2(o)}else e.text=""}})}},{img:"common_icon_qingminghuodong_png",noticeType:NT.ACTIVITY_ENTRANCE[ACTIVITY_ENTRANCE.HOLIDAY],unlockModule:void 0,isOpenCheck:function(){var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HOLIDAY),i=!1;return e.forEach(function(e){t.isOpen(e.id)&&(i=!0)}),i},clickFunc:function(){v.AppFacade.getInstance().showSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.HOLIDAY})},updateId:["btn","bm_time"],updateFunc:function(e){var c=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"btn":var t=v.Config.activityConfigs(),i="";for(var o in t){var n=t[o];0==n.id&&(i=JSON.parse(n.img_icon)[0])}i=v.GeneralConfig.getGuajiImg(i)[1],e.icon!=i&&(e.icon=i);break;case"bm_time":var a=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HOLIDAY),r=0;if(a.forEach(function(e){if(c.isOpen(e.id)){var t=v.ActivityConfig.getActivityEndDt(e.id);r<t&&(r=t)}}),r&&0!=r){var s=r-v.GameMgr.getInstance().serverTime();e.text=Utils.TimerManager.getFormatBySecond2(s)}else e.text=""}})}},{img:"common_icon_liuyihuodong_png",noticeType:NT.ACTIVITY_ENTRANCE[ACTIVITY_ENTRANCE.HOLIDAY2],unlockModule:void 0,isOpenCheck:function(){var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HOLIDAY2),i=!1;return e.forEach(function(e){t.isOpen(e.id)&&(i=!0)}),i},clickFunc:function(){v.AppFacade.getInstance().showSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.HOLIDAY2})},updateId:["btn","bm_time"],updateFunc:function(e){var c=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"btn":var t=v.Config.activityConfigs(),i="";for(var o in t){var n=t[o];0==n.id&&(i=JSON.parse(n.img_icon)[1])}i=v.GeneralConfig.getGuajiImg(i)[1],e.icon!=i&&(e.icon=i);break;case"bm_time":var a=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HOLIDAY2),r=0;if(a.forEach(function(e){if(c.isOpen(e.id)){var t=v.ActivityConfig.getActivityEndDt(e.id);r<t&&(r=t)}}),r&&0!=r){var s=r-v.GameMgr.getInstance().serverTime();e.text=Utils.TimerManager.getFormatBySecond2(s)}else e.text=""}})}},{img:"common_icon_kaixuehuodong_png",noticeType:NT.ACTIVITY_ENTRANCE[ACTIVITY_ENTRANCE.HOLIDAY3],unlockModule:void 0,isOpenCheck:function(){var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HOLIDAY3),i=!1;return e.forEach(function(e){t.isOpen(e.id)&&(i=!0)}),i},clickFunc:function(){v.AppFacade.getInstance().showSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.HOLIDAY3})},updateId:["btn","bm_time"],updateFunc:function(e){var c=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"btn":var t=v.Config.activityConfigs(),i="";for(var o in t){var n=t[o];0==n.id&&(i=JSON.parse(n.img_icon)[2]||"")}i=v.GeneralConfig.getGuajiImg(i)[1],e.icon!=i&&(e.icon=i);break;case"bm_time":var a=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HOLIDAY3),r=0;if(a.forEach(function(e){if(c.isOpen(e.id)){var t=v.ActivityConfig.getActivityEndDt(e.id);r<t&&(r=t)}}),r&&0!=r){var s=r-v.GameMgr.getInstance().serverTime();e.text=Utils.TimerManager.getFormatBySecond2(s)}else e.text=""}})}},{img:"common_icon_shuqihuodong_png",noticeType:NT.ACTIVITY_ENTRANCE[ACTIVITY_ENTRANCE.HOLIDAY4],unlockModule:void 0,isOpenCheck:function(){var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HOLIDAY4),i=!1;return e.forEach(function(e){t.isOpen(e.id)&&(i=!0)}),i},clickFunc:function(){v.AppFacade.getInstance().showSubView(v.ActivityMediator.N,v.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.HOLIDAY4})},updateId:["btn","bm_time"],updateFunc:function(e){var c=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N);e&&e.forEach(function(e){switch(e.name){case"btn":var t=v.Config.activityConfigs(),i="";for(var o in t){var n=t[o];0==n.id&&(i=JSON.parse(n.img_icon)[3]||"")}i=v.GeneralConfig.getGuajiImg(i)[1],e.icon!=i&&(e.icon=i);break;case"bm_time":var a=v.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.HOLIDAY4),r=0;if(a.forEach(function(e){if(c.isOpen(e.id)){var t=v.ActivityConfig.getActivityEndDt(e.id);r<t&&(r=t)}}),r&&0!=r){var s=r-v.GameMgr.getInstance().serverTime();e.text=Utils.TimerManager.getFormatBySecond2(s)}else e.text=""}})}},{img:"common_icon_mofanxiaodao_png",noticeType:NT.ALL_ACTIVITY[EActivityType.IslandEntrance],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.IslandEntrance]},unlockModule:void 0,isOpenCheck:function(){return v.GameMVC.activityPy.allActivityData[EActivityType.Island]&&v.GameMVC.activityPy.allActivityData[EActivityType.Island].data&&!0},clickFunc:function(){v.GameMVC.activityMed.showViewByCode(EActivityType.IslandEntrance)},updateId:["bm_time"],updateFunc:function(e){v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.Island]),e&&e.forEach(function(e){switch(e.name){case"bm_time":var t=v.ActivityConfig.getActivityEndDt(EActivityType.Island)-Utils.TimerManager.getServerTime();e.text=""+Utils.TimerManager.getFormatBySecond2(t)}})}},{img:"common_icon_guanghuirongyao_png",noticeType:NT.ALL_ACTIVITY[EActivityType.HonorOrder],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.HonorOrder]},unlockModule:void 0,isOpenCheck:function(){var e=v.GameMVC.activityPy.allActivityData[EActivityType.HonorOrder];return e&&e.data&&!0},clickFunc:function(){v.GameMVC.activityMed.showViewByCode(EActivityType.HonorOrder)},updateId:["bm_time"],updateFunc:function(e){v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e&&e.forEach(function(e){switch(e.name){case"bm_time":var t=v.ActivityConfig.getActivityEndDt(EActivityType.HonorOrder)-Utils.TimerManager.getServerTime();e.text=""+Utils.TimerManager.getFormatBySecond2(t)}})}}],t.TOP_RIGHT_BTN_CONFIG=[{img:"empty1_png",isOpenCheck:function(){return!0},clickFunc:function(){},updateId:["btn"],updateFunc:function(e){e&&e.forEach(function(e){switch(e.name){case"btn":e.parent.visible=!1}})}},{img:"empty2_png",isOpenCheck:function(){return!Utils.SDKMgr.getPerformConfig(6)},clickFunc:function(){},updateId:["btn"],updateFunc:function(e){e&&e.forEach(function(e){switch(e.name){case"btn":e.parent.visible=!1}})}},{img:"common_icon_xuyuanzhuanpan_png",noticeType:NT.LUCKY_TABLE,unlockModule:MODULE.LuckyTurntable,isOpenCheck:function(){return!(Utils.SDKMgr.getPerformConfig(1)&&Utils.SDKMgr.getPerformConfig(21))},clickFunc:function(){v.MainJumpConfig.jumpTo(MODULE.LuckyTurntable)}},{img:"common_icon_tehuijinka_png",noticeType:NT.ACTIVITY_EnjoyCard1,isOpenCheck:function(){return v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).isOpen(EActivityType.EnjoyCard1)},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.EnjoyCard1)}},{img:"common_icon_meirihaoli_png",noticeType:void 0,unlockModule:void 0,trueNoticeType:function(){for(var e=EActivityType.DailyLuxuryGifts1,t=[,EActivityType.DailyLuxuryGifts1,EActivityType.DailyLuxuryGifts2,EActivityType.DailyLuxuryGifts3,EActivityType.DailyLuxuryGifts4],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),o=0;o<t.length;o++)if(i.isOpen(t[o])){e=t[o];break}return NT.ALL_ACTIVITY[e]},scale:1,isOpenCheck:function(){for(var e=EActivityType.DailyLuxuryGifts1,t=[,EActivityType.DailyLuxuryGifts1,EActivityType.DailyLuxuryGifts2,EActivityType.DailyLuxuryGifts3,EActivityType.DailyLuxuryGifts4],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),o=0;o<t.length;o++)if(i.isOpen(t[o])){e=t[o];break}var n=i.allActivityData[e];if(n&&n.data&&v.ActivityConfig.Config[e]){var a=n.data.targeted,r=n.content,s=n.data.key,c=n.data.day,l=[];for(var h in r)(p=r[h])[0]==c&&l.push(p);if(!l.length)return[];for(v.AppFacade.getInstance().retrieveProxy(v.RechargePy.N).goodList,o=0;o<l.length;o++){(p=l[o])[0];var p,d=p[1],u=p[2],g=(p[3],REWARD_STATUS.GO_RECHARGE);u<=s&&(g=REWARD_STATUS.AVAILABLE);var f=!1;for(var h in a)if(a[h].id==d){f=!0;break}if(f&&(g=REWARD_STATUS.RECEIVED),g==REWARD_STATUS.AVAILABLE||g==REWARD_STATUS.GO_RECHARGE)return!0}return!1}},clickFunc:function(){for(var e=EActivityType.DailyLuxuryGifts1,t=[EActivityType.DailyLuxuryGifts1,EActivityType.DailyLuxuryGifts2,EActivityType.DailyLuxuryGifts3,EActivityType.DailyLuxuryGifts4],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),o=0;o<t.length;o++)if(i.isOpen(t[o])){e=t[o];break}v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(e,{code:e})}},{img:"common_icon_chaozhilibao_png",noticeType:void 0,unlockModule:void 0,scale:1,isOpenCheck:function(){var o=!1,e=v.GameMVC.activityPy.allActivityData[EActivityType.BasicHeroGifts],n=Utils.TimerManager.getServerTime();if(e&&e.endDt>n&&e.data&&e.data.gifts&&0<e.data.gifts.length)o=!0;else{if(!(e=v.GameMVC.activityPy.allActivityData[EActivityType.TriggerGifts])||!e.data)return!1;var t=JSON.parse(e.data.gifts),a=JSON.parse(e.content),r=0;t.forEach(function(e){for(var t in a[0]){var i=a[0][t];i[0]==e.code&&(r=i[3])}!e.buyDt&&n<e.triggerDt+r&&(o=!0)})}return o},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.TriggerGifts)}},{img:"common_icon_zhuanshutouxiang_png",noticeType:NT.ALL_ACTIVITY[EActivityType.QqzoneOpenServerRecharge],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.QqzoneOpenServerRecharge]},unlockModule:void 0,scale:1,isOpenCheck:function(){return v.GameMVC.activityPy.isOpen(EActivityType.QqzoneOpenServerRecharge)&&Utils.SDKMgr.getPerformConfig(10018)},clickFunc:function(){v.MainJumpConfig.jumpTo(MODULE.Activity+EActivityType.QqzoneOpenServerRecharge)}},{img:"common_icon_shouchonglibao_png",noticeType:NT.ALL_ACTIVITY[EActivityType.FirstRecharge1],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.FirstRecharge1]},unlockModule:void 0,effect:"common_qiriicon",isOpenCheck:function(){var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.FirstRecharge1];if(e&&e.data){for(var t=JSON.parse(e.content),i=(JSON.parse(e.data.rechargeTargeted),e.data.rewardTargeted,e.data.key,!1),o=0;o<=3;o++)for(var n=0;n<3;n++){var a=t[3*o+n],r=a[0],s=(a[1],a[2]),c=a[4],l=e.data.key,h=e.data.rewardTargeted,p=JSON.parse(e.data.rechargeTargeted),d=REWARD_STATUS.UNAVAILABLE;s<=l&&(d=REWARD_STATUS.AVAILABLE),0<=h.indexOf(r)&&(d=REWARD_STATUS.RECEIVED);var u=0;for(var g in p){var f=p[g];f[0]==s&&(u=f[1])}if(u<c&&(d=REWARD_STATUS.UNAVAILABLE),d!=REWARD_STATUS.RECEIVED){i=!0;break}}return i}},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.FirstRecharge1)}},{img:"common_icon_yiyuanlingqu_png",noticeType:NT.ALL_ACTIVITY[EActivityType.OneYuanGifts],trueNoticeType:function(){for(var e=EActivityType.OneYuanGifts,t=[EActivityType.OneYuanGifts],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),o=0;o<t.length;o++)if(i.isOpen(t[o])){e=t[o];break}return NT.ALL_ACTIVITY[e]},unlockModule:MODULE.Activity+EActivityType.OneYuanGifts,effect:"common_qiriicon",isOpenCheck:function(){for(var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),t=EActivityType.OneYuanGifts,i=[EActivityType.OneYuanGifts],o=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),n=0;n<i.length;n++)if(o.isOpen(i[n])){t=i[n];break}var a=e.allActivityData[t];if(a&&a.data){var r=a.data.targeted,s=a.content,c=(a.data.key,a.data.day),l=[];for(var h in s)(p=s[h])[0]==c&&l.push(p);if(!l.length)return[];for(n=0;n<l.length;n++){(p=l[n])[0];var p,d=p[1],u=(p[2],p[3],p[4],!1);for(var h in r)if(r[h].id==d){u=!0;break}if(u)return!1}return!0}},clickFunc:function(){for(var e=EActivityType.OneYuanGifts2,t=[EActivityType.OneYuanGifts],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),o=0;o<t.length;o++)if(i.isOpen(t[o])){e=t[o];break}v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(e,{code:e})}},{img:"common_icon_yiyuanlingquNew_png",noticeType:NT.ALL_ACTIVITY[EActivityType.NewOneYuanGifts],trueNoticeType:function(){for(var e=EActivityType.NewOneYuanGifts,t=[EActivityType.NewOneYuanGifts],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),o=0;o<t.length;o++)if(i.isOpen(t[o])){e=t[o];break}return NT.ALL_ACTIVITY[e]},unlockModule:MODULE.Activity+EActivityType.NewOneYuanGifts,effect:"common_qiriicon",isOpenCheck:function(){for(var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),t=EActivityType.NewOneYuanGifts,i=[EActivityType.NewOneYuanGifts],o=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),n=0;n<i.length;n++)if(o.isOpen(i[n])){t=i[n];break}var a=e.allActivityData[t];if(a&&a.data){var r=a.data.targeted,s=a.content,c=(a.data.key,a.data.day);c>s.length&&(c=s.length);var l=[];for(var h in s)(p=s[h])[0]==c&&l.push(p);if(!l.length)return[];for(n=0;n<l.length;n++){(p=l[n])[0];var p,d=p[1],u=(p[2],p[3],p[4],!1);for(var h in r)if(r[h].id==d){u=!0;break}if(u)return!1}return!0}},clickFunc:function(){for(var e=EActivityType.NewOneYuanGifts,t=[EActivityType.NewOneYuanGifts],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),o=0;o<t.length;o++)if(i.isOpen(t[o])){e=t[o];break}v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(e,{code:e})}},{img:"common_icon_zhuanshuhaoli_png",noticeType:NT.ALL_ACTIVITY[EActivityType.DailyLuxuryGifts5],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.DailyLuxuryGifts5]},unlockModule:MODULE.Activity+EActivityType.DailyLuxuryGifts5,isOpenCheck:function(){var e=v.GameMVC.activityPy.allActivityData[EActivityType.DailyLuxuryGifts5];return!(!e||!e.data||!Utils.agentConfig.agentJsFileName)},clickFunc:function(){v.GameMVC.activityMed.showViewByCode(EActivityType.DailyLuxuryGifts5)}},{img:"common_icon_meiribuji_png",noticeType:NT.ALL_ACTIVITY[EActivityType.FifthOpenServerRecharge],trueNoticeType:function(){for(var e=EActivityType.FifthOpenServerRecharge,t=[EActivityType.FifthOpenServerRecharge,EActivityType.FifthOpenServerRecharge1,EActivityType.FifthOpenServerRecharge2,EActivityType.FifthOpenServerRecharge3],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),o=0;o<t.length;o++)if(i.isOpen(t[o])){e=t[o];break}return NT.ALL_ACTIVITY[e]},unlockModule:MODULE.Activity+EActivityType.FifthOpenServerRecharge,isOpenCheck:function(){for(var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),t=EActivityType.FifthOpenServerRecharge,i=[EActivityType.FifthOpenServerRecharge,EActivityType.FifthOpenServerRecharge1,EActivityType.FifthOpenServerRecharge2,EActivityType.FifthOpenServerRecharge3],o=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),n=0;n<i.length;n++)if(o.isOpen(i[n])){t=i[n];break}var a=e.allActivityData[t];if(a&&a.data){var c,r=a.content,l=a.data.amount,h=JSON.parse(a.data.targeted),s=a.data.curCycle||1;for(var p in r[1]){var d=r[1][p];if(d[0]==s){c=d[1];break}}if(!c)return[];function u(e){var t=c[e],i=t[1],o=t[2],n=t[3]||1,a=REWARD_STATUS.AVAILABLE;-1!=h.indexOf(t[0])?a=REWARD_STATUS.RECEIVED:l<i&&(a=REWARD_STATUS.GO_RECHARGE),EActivityType.FourthOpenServerRecharge,EActivityType.FourthOpenServerRecharge1,EActivityType.FourthOpenServerRecharge2,EActivityType.FourthOpenServerRecharge3;var r={id:i,rewards:o,status:a,targetAmount:i};if(f<n){var s=!0;if(g.forEach(function(e){e.status!=REWARD_STATUS.RECEIVED&&(s=!1)}),!s)return"break";if(!c[parseInt(e)+1])return g.push(r),"break";f=n,g.splice(0,g.length),g.push(r)}else g.push(r)}var g=[],f=1;for(var _ in c)if("break"===u(_))break;var m=!1;return g.forEach(function(e){e.status!=REWARD_STATUS.AVAILABLE&&e.status!=REWARD_STATUS.GO_RECHARGE||(m=!0)}),m}},clickFunc:function(){for(var e=EActivityType.FifthOpenServerRecharge,t=[EActivityType.FifthOpenServerRecharge,EActivityType.FifthOpenServerRecharge1,EActivityType.FifthOpenServerRecharge2,EActivityType.FifthOpenServerRecharge3],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),o=0;o<t.length;o++)if(i.isOpen(t[o])){e=t[o];break}v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(e,{code:e})}},{img:"common_icon_tehuihuikui_png",noticeType:NT.ALL_ACTIVITY[EActivityType.VipPreferentialGift],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.VipPreferentialGift]},unlockModule:MODULE.Activity+EActivityType.VipPreferentialGift,isOpenCheck:function(){var e=v.GameMVC.activityPy.allActivityData[EActivityType.VipPreferentialGift];if(e&&e.data){var t=JSON.parse(e.content)[0],i=e.data[0]&&e.data[0].times||0,o=t[1],n=t[2],a=v.GameMVC.playerPy.playerInfoVO.playerVip.vipLevel,r=REWARD_STATUS.UNAVAILABLE;o<=a&&(r=REWARD_STATUS.AVAILABLE);var s=void 0;for(var c in n){var l=n[c];if(l[0]==i+1){s=l;break}}s||(r=REWARD_STATUS.RECEIVED);var h=!1;switch(r){case REWARD_STATUS.UNAVAILABLE:case REWARD_STATUS.AVAILABLE:h=!0;break;case REWARD_STATUS.RECEIVED:}return h}},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.VipPreferentialGift,{code:EActivityType.VipPreferentialGift})}},{img:"common_icon_pifulibao_png",noticeType:NT.ALL_ACTIVITY[EActivityType.SecondDailyGifts],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.SecondDailyGifts]},unlockModule:MODULE.Activity+EActivityType.SecondDailyGifts,isOpenCheck:function(){var e=v.GameMVC.activityPy.allActivityData[EActivityType.SecondDailyGifts];if(!e||!e.data)return!1;var t=JSON.parse(e.content);t.sort(function(e,t){return e[0]-t[0]});for(var i=e.data.day,o=e.data.targeted,n=1;n<=t.length;){var a=!1;for(var r in o)if(o[r].id==n){a=!0;break}if(!a)break;n++}return!!t[n-1]&&(REWARD_STATUS.UNAVAILABLE,(n<=i?REWARD_STATUS.AVAILABLE:REWARD_STATUS.HASBUY)==REWARD_STATUS.AVAILABLE)},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.SecondDailyGifts,{code:EActivityType.SecondDailyGifts})}},{img:"wanba_icon_chongzhipaihang_png",noticeType:NT.ALL_ACTIVITY[EActivityType.WorldRechargeRank],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.WorldRechargeRank]},unlockModule:MODULE.Activity+EActivityType.WorldRechargeRank,isOpenCheck:function(){return v.GameMVC.activityPy.isOpen(EActivityType.WorldRechargeRank)},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.WorldRechargeRank,{code:EActivityType.WorldRechargeRank})}},{img:"common_icon_zunxianglibao_png",noticeType:NT.ALL_ACTIVITY[EActivityType.SixtyEightYuanGifts],trueNoticeType:function(){for(var e=EActivityType.SixtyEightYuanGifts,t=[EActivityType.SixtyEightYuanGifts,EActivityType.OneYuanGifts2],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),o=0;o<t.length;o++)if(i.isOpen(t[o])){e=t[o];break}return NT.ALL_ACTIVITY[e]},unlockModule:MODULE.Activity+EActivityType.SixtyEightYuanGifts,effect:"common_qiriicon",isOpenCheck:function(){for(var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),t=EActivityType.SixtyEightYuanGifts,i=[EActivityType.SixtyEightYuanGifts,EActivityType.OneYuanGifts2],o=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),n=0;n<i.length;n++)if(o.isOpen(i[n])){t=i[n];break}var a=e.allActivityData[t];if(a&&a.data){var r=a.data.targeted,s=a.content,c=(a.data.key,a.data.day),l=[];for(var h in s)(p=s[h])[0]==c&&l.push(p);if(!l.length)return[];for(n=0;n<l.length;n++){(p=l[n])[0];var p,d=p[1],u=(p[2],p[3],p[4],!1);for(var h in r)if(r[h].id==d){u=!0;break}if(u)return!1}return!0}},clickFunc:function(){for(var e=EActivityType.SixtyEightYuanGifts,t=[EActivityType.SixtyEightYuanGifts,EActivityType.OneYuanGifts2],i=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),o=0;o<t.length;o++)if(i.isOpen(t[o])){e=t[o];break}v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(e,{code:e})}},{img:"common_icon_xinchunhesui_png",noticeType:void 0,unlockModule:void 0,scale:1,isOpenCheck:function(){var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.NewYearWeekCrad];return!(!e||!e.data||e.data.day)},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.NewYearWeekCrad)}},{img:"common_icon_shimingrenzheng2_png",noticeType:void 0,unlockModule:void 0,scale:1,isOpenCheck:function(){var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.CertificationReward];return!(!e||!e.data||v.GameMVC.rechargePy.getRechargeInfo().trueRechargeTimes<2||e.data.isTargeted)},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.CertificationReward)}},{img:"common_icon_fenxianghaoli_png",noticeType:NT.ALL_ACTIVITY[EActivityType.ClientTask],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.ClientTask]},unlockModule:void 0,scale:1,isOpenCheck:function(){var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.ClientTask];return!!window.xyxPlatform&&!(!e||!e.data)},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.ClientTask)}},{img:"common_icon_gongzhonghaofuli_png",noticeType:void 0,unlockModule:void 0,scale:1,isOpenCheck:function(){return!v.GameMVC.activityPy.operationHasExec(OperationType.Act_EnterIntoByGongZhongHao)&&getUrlKV().Act_EnterIntoByGongZhongHao},clickFunc:function(){var e=v.Config.operationConfig()[OperationType.Act_EnterIntoByGongZhongHao];PopUpManager.addPopUp({obj:new v.ActivitySDKSMRZView2({title:"公众号礼包",rewards:e.reward,okCB:function(){v.GameMVC.activityPy.getOperationReward(OperationType.Act_EnterIntoByGongZhongHao)}})})}},{img:"common_icon_zhanqujingpai_png",noticeType:NT.ALL_ACTIVITY[EActivityType.ZoneAuction],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.ZoneAuction]},unlockModule:MODULE.Activity+EActivityType.ZoneAuction,isOpenCheck:function(){var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.ZoneAuction];if(e&&e.data)return!!Utils.UnlockMgr.checkPass(MODULE.Activity+EActivityType.ZoneAuction,!1).allow||void 0},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.ZoneAuction1)}},{img:"common_icon_xianjinhongbao_png",noticeType:void 0,isOpenCheck:function(){var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.PlayerRedBag];return!(!e||!e.data)&&Utils.agentConfig.other.openRedBagAct},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.PlayerRedBag)},updateId:["bm_time"],updateFunc:function(e){e&&e.forEach(function(e){switch(e.name){case"bm_time":var t=v.ActivityConfig.getActivityEndDt(EActivityType.PlayerRedBag)-Utils.TimerManager.getServerTime();e.text=""+Utils.TimerManager.getFormatBySecond2(t)}})}},{img:"common_icon_jingxibaoxiang_png",unlockModule:void 0,scale:1,isOpenCheck:function(){var e=v.GameMVC.activityPy.allActivityData[EActivityType.PushGiftBag];if(!e||!e.data)return!1;if(0<e.data.purchaseTime)return!1;if(!Utils.UnlockMgr.checkPass(MODULE.Activity+EActivityType.PushGiftBag,!1).allow)return!1;var t=Utils.TimerManager.getServerOpenDays(),i=e.data.vipLevel,o=JSON.parse(e.content),n=0;for(var a in o){var r=o[a];if(r[0]==t)for(var s in r[1]){var c=r[1][s];c[1]==i&&(n=c[0])}}return!!n},updateId:["bm_time"],updateFunc:function(e){v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e&&e.forEach(function(e){switch(e.name){case"bm_time":var t=v.ActivityConfig.getActivityEndDt(EActivityType.PushGiftBag)-Utils.TimerManager.getServerTime();e.text=0<t?Utils.TimerManager.getFormatBySecond2(t):""}})},clickFunc:function(){v.GameMVC.activityMed.showViewByCode(EActivityType.PushGiftBag)}},{img:"common_icon_guanzhu_png",noticeType:void 0,trueNoticeType:void 0,unlockModule:MODULE.Activity+EActivityType.GuanZhuGongZhongHao,isOpenCheck:function(){return!!Utils.SDKMgr.getPerformConfig(1026)&&!!v.GameMVC.activityPy.allActivityData[EActivityType.GuanZhuGongZhongHao]&&(!v.GameMVC.activityPy.operationHasExec(OperationType.Act_GuanZhuGongZhongHao)||getUrlKV().SwitchGuanzhuAlthoughGet)},clickFunc:function(){v.GameMVC.activityMed.showViewByCode(EActivityType.GuanZhuGongZhongHao)}},{img:"common_icon_guanzhuhaoli_png",noticeType:void 0,trueNoticeType:void 0,unlockModule:void 0,isOpenCheck:function(){return!!Utils.SDKMgr.getPerformConfig(200009)},clickFunc:function(){PopUpManager.addPopUp({obj:new v.ActivityGZGZHView3})}},{img:"common_icon_shimingrenzheng_png",noticeType:void 0,trueNoticeType:void 0,unlockModule:MODULE.Activity+EActivityType.ShiMingRenZheng,isOpenCheck:function(){return!!v.GameMVC.activityPy.allActivityData[EActivityType.ShiMingRenZheng]&&!v.GameMVC.activityPy.operationHasExec(OperationType.Act_ShiMingRenZheng)},clickFunc:function(){v.GameMVC.activityMed.showViewByCode(EActivityType.ShiMingRenZheng)}},{img:"common_icon_weiduanxiazai_png",noticeType:void 0,trueNoticeType:void 0,unlockModule:MODULE.Activity+EActivityType.WeiDuanXiaZai,isOpenCheck:function(){return!!Utils.SDKMgr.getPerformConfig(1016)&&!!v.GameMVC.activityPy.allActivityData[EActivityType.WeiDuanXiaZai]&&(!v.GameMVC.activityPy.operationHasExec(OperationType.Act_AppDownload)||getUrlKV().SwitchMicDownloadAlthoughGet)},clickFunc:function(){v.GameMVC.activityMed.showViewByCode(EActivityType.WeiDuanXiaZai)}},{img:"common_icon_shoucangyouli_png",noticeType:void 0,trueNoticeType:void 0,unlockModule:MODULE.Activity+EActivityType.ShouCangYouLi,updateId:["btn","gp_bottom"],updateFunc:function(e){e&&e.forEach(function(e){switch(e.name){case"btn":Utils.SDKMgr.getPerformConfig(10021)&&"QQLive"==getUrlKV().channel?e.icon="huodong_icon_shoucangyouxi_png":e.icon="common_icon_shoucangyouli_png";break;case"gp_bottom":e.visible=!1}})},isOpenCheck:function(){return Utils.SDKMgr.getPerformConfig(10018)&&Utils.SDKMgr.getPerformConfig(15)?!Utils.SDKMgr.getPerformConfig(10021)||Utils.SDKMgr.extraFuncForAgent({type:"canShow",params:{type:"favoritesToDesktop"}})&&"xinYueClub"!=getUrlKV().channel:!(!v.GameMVC.activityPy.allActivityData[EActivityType.ShouCangYouLi]||(Utils.SDKMgr.getPerformConfig(20001)&&Utils.SDKMgr.getPerformConfig(15)?v.GameMVC.activityPy.operationHasExec(6):!Utils.SDKMgr.getPerformConfig(15)||4!=Utils.DeviceUtils.getPlatform()||v.GameMVC.activityPy.operationHasExec(OperationType.Act_ShouCangYouLi)))},clickFunc:function(){v.GameMVC.activityMed.showViewByCode(EActivityType.ShouCangYouLi)}},{img:"common_icon_viptequan_png",noticeType:void 0,unlockModule:void 0,isOpenCheck:function(){return Utils.SDKMgr.getPerformConfig(10021)?Utils.SDKMgr.extraFuncForAgent({type:"canShow",params:{type:"miniGameVIP"}}):Utils.agentConfig.other.isJhb},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.QQZoneVipGift)}},{img:"huodong_icon_xingqubuluo_png",noticeType:void 0,unlockModule:void 0,isOpenCheck:function(){return Utils.SDKMgr.getPerformConfig(10021)?Utils.SDKMgr.extraFuncForAgent({type:"canShow",params:{type:"buluo"}}):Utils.agentConfig.other.isJhb},clickFunc:function(){var e=Utils.agentConfig.other.buluoUrl||"https://buluo.qq.com/p/barindex.html?bid=409851";Utils.SDKMgr.extraFuncForAgent({type:"openUrl",params:{url:e}})}},{img:"sdk_custom1_cb",noticeType:void 0,trueNoticeType:void 0,unlockModule:void 0,updateId:["btn","gp_bottom"],updateFunc:function(e){e&&e.forEach(function(e){switch(e.name){case"btn":getUrlKV().sdk_custom1_config?e.icon=getUrlKV().sdk_custom1_config.enter_icon||"common_icon_shoucangyouli_png":e.icon="common_icon_shoucangyouli_png";break;case"gp_bottom":e.visible=!1}})},isOpenCheck:function(){return!!getUrlKV().sdk_custom1_config&&getUrlKV().sdk_custom1_config.canShow},clickFunc:function(){getUrlKV().sdk_custom1_config&&getUrlKV().sdk_custom1_config.cb&&getUrlKV().sdk_custom1_config.cb()}},{img:"common_icon_fulihuikui_png",noticeType:NT.ALL_ACTIVITY[EActivityType.NewTurntable],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.NewTurntable]},unlockModule:void 0,isOpenCheck:function(){return v.GameMVC.activityPy.isOpen(EActivityType.NewTurntable)},clickFunc:function(){v.GameMVC.activityMed.showViewByCode(EActivityType.NewTurntable)}},{img:"common_icon_shouquanrenzheng_png",noticeType:void 0,unlockModule:void 0,isOpenCheck:function(){if(Utils.SDKMgr.getPerformConfig(48)&&!v.GameMVC.activityPy.operationHasExec(OperationType.Act_XYX_AUTHORIZE_BINDING_GZH))return!0},clickFunc:function(){PopUpManager.addPopUp({obj:new v.ActivitySQRZView})}},{img:"common_icon_mianfeilingjiang_png",noticeType:void 0,unlockModule:void 0,isOpenCheck:function(){if(Utils.SDKMgr.getPerformConfig(49))return!0},clickFunc:function(){PopUpManager.addPopUp({obj:new v.AdsPanel({arrs:["mflj_res_02_png"],cb:function(){Utils.SDKMgr.cmd({type:"GetcCusward",role_id:v.GameMVC.playerPy.playerInfoVO.playerId,server_id:v.GameMVC.loginPy.serverSelect.s_id})}})})}},{img:"common_icon_huiguifuli_png",noticeType:NT.ALL_ACTIVITY[EActivityType.Regression],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.Regression]},unlockModule:void 0,isOpenCheck:function(){var e=v.GameMVC.activityPy.allActivityData[EActivityType.Regression],t=v.ActivityConfig.getActivityEndDt(EActivityType.Regression);return e&&e.data&&e.data.inActivity&&t>Utils.TimerManager.getServerTime()},clickFunc:function(){v.GameMVC.activityMed.showViewByCode(EActivityType.Regression)},updateId:["bm_time"],updateFunc:function(e){v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e&&e.forEach(function(e){switch(e.name){case"bm_time":var t=v.ActivityConfig.getActivityEndDt(EActivityType.Regression)-Utils.TimerManager.getServerTime();e.text=""+Utils.TimerManager.getFormatBySecond2(t)}})}}],t.TOP_RIGHT2_BTN_CONFIG=[{img:"common_icon_jinrihuodong_png",noticeType:void 0,unlockModule:MODULE.Activity+EActivityType.TodayActivity,isOpenCheck:function(){return!Utils.SDKMgr.getPerformConfig(2)},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.TodayActivity)}},{img:"common_icon_hongbao_png",noticeType:NT.ALL_ACTIVITY[EActivityType.TimerLuckyMoney],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.TimerLuckyMoney]},unlockModule:MODULE.Activity+EActivityType.TimerLuckyMoney,scale:1,isOpenCheck:function(){var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.TimerLuckyMoney];if(!e||!e.data)return!1;var t=v.GameMgr.getInstance().serverTime(),i=JSON.parse(e.content),o=e.data.targeted,n=[],a=new Date(1e3*t);for(var r in a.setHours(0,0,0),n.push(a.getTime()/1e3),i[0]){var s=i[0][r],c=s[0],l=s[1],h=new Date(1e3*t);h.setHours(c[0],c[1],c[2]||0);var p=h.getTime()/1e3,d=new Date(1e3*t);d.setHours(l[0],l[1],l[2]||0);var u=d.getTime()/1e3;n.push(p),n.push(u)}for(var g=!1,f=0;f<n.length-1;f++)t>=n[f]&&t<=n[f+1]&&(g=!0);var _=!1,m=n.length;for(var r in o){var y=o[r];if(y>=n[m-2]&&y<=n[m-1]){_=!0;break}}return g&&!_},clickFunc:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.TimerLuckyMoney)},updateId:["bm_time","gp_bottom"],updateFunc:function(e){function y(t){e&&e.forEach(function(e){switch(e.name){case"gp_bottom":e.visible=!t}})}v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e&&e.forEach(function(e){switch(e.name){case"bm_time":var t=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.TimerLuckyMoney];if(!t||!t.data)return!1;var i=v.GameMgr.getInstance().serverTime(),o=JSON.parse(t.content),n=t.data.targeted,a=[],r=new Date(1e3*i);for(var s in r.setHours(0,0,0),a.push(r.getTime()/1e3),o[0]){var c=o[0][s],l=c[0],h=c[1],p=new Date(1e3*i);p.setHours(l[0],l[1],l[2]||0);var d=p.getTime()/1e3,u=new Date(1e3*i);u.setHours(h[0],h[1],h[2]||0);var g=u.getTime()/1e3;a.push(d),a.push(g)}y(!1);for(var f=0;f<a.length-1;f++)if(i>=a[f]&&i<=a[f+1]){if(f%2==0)return void(e.text=Utils.TimerManager.getFormatBySecond1(a[f+1]-i));var _=!1;for(var s in n){var m=n[s];if(m>=a[f]&&m<=a[f+1]){_=!0;break}}if(_)return void(a[f+2]?e.text=Utils.TimerManager.getFormatBySecond1(a[f+2]-i):y(!1));y(!0)}}})}},{img:"huodong_icon_qqhuangzuantequan_png",noticeType:void 0,unlockModule:void 0,updateId:["btn","gp_bottom"],updateFunc:function(e){v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N),e&&e.forEach(function(e){switch(e.name){case"btn":var t=void 0;"xinYueClub"==getUrlKV().channel?t="huodong_icon_xinyuetequan_png":getUrlKV().qua&&"PC"==getUrlKV().qua.app?t="huodong_icon_dengluyouli_png":"QQVip"==getUrlKV().channel?t="huodong_icon_qqhuiyuantequan_png":"huangzuan"==getUrlKV().channel?t="huodong_icon_qqhuangzuantequan_png":"gameApp"==getUrlKV().channel?t="huodong_icon_weiduanyouli_png":"QQLive"==getUrlKV().channel&&(t=1==getUrlKV().platform?"huodong_icon_aiwanfuli_png":"huodong_icon_gengduojingcai_png"),e.icon!=t&&(e.icon=t);break;case"gp_bottom":e.visible=!1}})},isOpenCheck:function(){if(!Utils.SDKMgr.getPerformConfig(10021))return!1;var e=v.GameMVC.activityPy.giftList,t=getUrlKV(),i="QQLive"==t.channel,o="gameApp"==t.channel&&1==t.platform&&t.qua&&"SQ"==t.qua.app;return"QQVip"==t.channel&&-1==e.indexOf(2404)||"huangzuan"==t.channel&&-1==e.indexOf(2403)||"xinYueClub"==t.channel||t.qua&&"PC"==t.qua.app||o||i},clickFunc:function(){var e=getUrlKV().channel;getUrlKV().qua&&"PC"==getUrlKV().qua.app&&(e="PC"),"xinYueClub"==e?PopUpManager.addPopUp({obj:new v.XinyueCLubView}):"gameApp"==getUrlKV().channel?PopUpManager.addPopUp({obj:new v.NativeDownloadView}):"QQLive"==getUrlKV().channel?PopUpManager.addPopUp({obj:new v.QQLiveView}):PopUpManager.addPopUp({obj:new v.QQCommonGiftView({type:e})})}}],t.TOP_LEFT_BTN_CONFIG=[{img:"_btn_lb_m_json.common_icon_fenxiang",noticeType:NT.ALL_ACTIVITY[EActivityType.FriendShare],trueNoticeType:function(){return NT.ALL_ACTIVITY[EActivityType.FriendShare]},unlockModule:MODULE.Activity+EActivityType.FriendShare,name:"分享",isOpenCheck:function(){if(Utils.SDKMgr.getPerformConfig(16)){if(Utils.SDKMgr.getPerformConfig(10018))return!Utils.SDKMgr.getPerformConfig(10021)||(Utils.SDKMgr.extraFuncForAgent({type:"canShow",params:{type:"share"}})||"WX"==getUrlKV().channel)&&"xinYueClub"!=getUrlKV().channel;var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.FriendShare];if(!e||!e.data)return;if(Utils.UnlockMgr.checkPass(MODULE.Activity+EActivityType.FriendShare,!1).allow)return!0}},clickFunc:function(){var e=v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N);Utils.SDKMgr.getPerformConfig(10018)?e.showViewByCode(EActivityType.WeChatShare):e.showViewByCode(EActivityType.FriendShare)}}],t.BOTTOM_LEFT_BTN_CONFIG=[{img:"common_icon_chongwu_png",noticeType:NT.PET,scale:1,unlockModule:MODULE.Pet,name:"",isOpenCheck:function(){return!0},clickFunc:function(){v.MainJumpConfig.jumpTo(MODULE.Pet)}},{img:"common_icon_yinghunwangshi_png",noticeType:NT.HERO_SPIRIT,scale:1,unlockModule:MODULE.HeroSpirit,name:"",isOpenCheck:function(){return!0},clickFunc:function(){v.GameMVC.heroSpiritPy.GetHeroSpiritInfo(function(){v.AppFacade.getInstance().showSubView(v.HeroSpiritMediator.N,v.HeroSpiritMediator.SV.MAIN,{})})}},{img:"common_icon_zhujue_png",noticeType:NT.FASHION,scale:1,unlockModule:MODULE.Fashion,name:"",isOpenCheck:function(){return!0},clickFunc:function(){v.GameMVC.fashionPy.GetFashionInfo(function(){v.AppFacade.getInstance().showSubView(v.FashionMediator.N,v.FashionMediator.SV.MAIN,{chooseIndex:2})})}},{img:"common_icon_zuoqi_png",noticeType:NT.MOUNT,scale:1,unlockModule:MODULE.Horse,name:"",isOpenCheck:function(){return!0},clickFunc:function(){v.GameMVC.mountPy.GetHorseInfo(function(){var e=0,t=v.GameMVC.mountPy.allMountByUuid,i=v.Config.horseConfig();for(var o in t)for(var n in i)if(t[o].code==i[n].code&&1==t[o].pos){e=Number(n);break}v.AppFacade.getInstance().showSubView(v.MountMediator.N,v.MountMediator.SV.MAIN,{chooseIndex:e})})}},{img:"common_icon_taozhuangshuxing_png",noticeType:void 0,scale:1,unlockModule:MODULE.Horse,name:"",isOpenCheck:function(){return!0},clickFunc:function(){PopUpManager.addPopUp({obj:new v.FPM_Panel})}}],t.BOTTOM_RIGHT_BTN_CONFIG=[{img:"common_icon_yongshilingzhuang2_png",noticeType:NT.NEWBRAVABOOK,unlockModule:void 0,isOpenCheck:function(){var e=v.AppFacade.getInstance().retrieveProxy(v.ActivityPy.N).allActivityData[EActivityType.NewBraveBook];if(!e)return!1;var t=!1,i=Utils.TimerManager.getServerTime(),o=e.endDt;return e.startDt<=i&&i<o?t=!0:v.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN),t},clickFunc:function(){v.GameMVC.taskPy.getNewBraveBookTask({cb:function(){v.AppFacade.getInstance().retrieveMediator(v.ActivityMediator.N).showViewByCode(EActivityType.NewBraveBook)}})},updateId:["btn","gp_bottom"],updateFunc:function(e){var t=v.AppFacade.getInstance().retrieveProxy(v.TaskPy.N).newBraveBookTask,i=t&&t.level||0;e&&e.forEach(function(e){switch(e.name){case"btn":var t=i<1e3&&0<=i?"common_icon_yongshilingzhuang2_png":"common_icon_yongshilingzhuang1_png";e.icon=t,e.labelDisplay.verticalCenter=i<1e3&&0<=i?11:3,e.labelDisplay.size=18,e.labelDisplay.text=""+i;break;case"gp_bottom":e.visible=!1}})}}],t.BOTTOM_RIGHT_BANNER_CONFIG=[{img:"blzb_img_fbzc_png",isOpenCheck:function(){var e=Utils.UnlockMgr.getOpenInfo(MODULE.StormWar);return e.allow&&e.isOpen},clickFunc:function(){v.MainJumpConfig.jumpTo(MODULE.StormWar)}},{img:"jsjhd_img_tnwz_png",isOpenCheck:function(){var e=v.GameMVC.activityPy.allActivityData[EActivityType.NewZoneQuora];if(!e||!e.data)return!1;var t=JSON.parse(e.content)[0][0];return!!Utils.TimerManager.checkIsOpen_FormatA(t).isOpen},clickFunc:function(){v.MainJumpConfig.jumpTo(MODULE.Activity+EActivityType.NewZoneQuora)}},{img:"cjq_img_xinchundati_png",isOpenCheck:function(){var e=v.GameMVC.activityPy.allActivityData[EActivityType.NewZoneQuora1];if(!e||!e.data)return!1;var t=JSON.parse(e.content)[0][0];return!!Utils.TimerManager.checkIsOpen_FormatA(t).isOpen},clickFunc:function(){v.GameMVC.activityMed.showSubView(v.ActivityMediator.SV.SF_QUORA,{index:1})}},{img:"blzb_img_kmzdz_png",isOpenCheck:function(){var e=Utils.UnlockMgr.getOpenInfo(MODULE.Manor);return e.allow&&e.isOpen},clickFunc:function(){v.MainJumpConfig.jumpTo(MODULE.Manor)}}],t.BOTTOM_BTN_CONFIG=[{jumpModule:"CITY",unlockModule:MODULE.CityMain},{jumpModule:"HERO",unlockModule:void 0},{jumpModule:"GUAJI",unlockModule:void 0},{jumpModule:"BACKPACK",unlockModule:void 0},{jumpModule:"GUILD",unlockModule:MODULE.Guild}],t);function t(){}v.MainBtnConfig=e,__reflect(e.prototype,"game.MainBtnConfig")}(game=game||{}),function(h){var e,p=((e={LOGIN:{clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.LoginMediator.N,h.LoginMediator.SV.BEFORE_LOGIN)}},MAIN:{moduleStyle:ModuleStyle.MAIN,clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.MainMediator.N,h.MainMediator.SV.MAIN)}},CITY:{moduleStyle:ModuleStyle.CITY,clickFunc:function(e){var t=h.AppFacade.getInstance().retrieveMediator(h.CityMediator.N).getSubView(h.CityMediator.SV.MAIN);t&&(t.curGuideAvailable=!1,t.perShow()),h.AppFacade.getInstance().showSubView(h.CityMediator.N,h.CityMediator.SV.MAIN),h.AppFacade.getInstance().sendNotification(CN.MAIN_CHANGE_BTN,"CITY")}},HERO:{moduleStyle:ModuleStyle.HERO,clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.HeroMediator.N,h.HeroMediator.SV.MAIN),h.AppFacade.getInstance().sendNotification(CN.MAIN_CHANGE_BTN,"HERO")}},GUAJI:{moduleStyle:ModuleStyle.GUAJI,clickFunc:function(e){var t=h.AppFacade.getInstance().retrieveMediator(h.GuajiMediator.N).guajiUI;t&&(t.curGuideAvailable=!1,t.perShow()),h.AppFacade.getInstance().showSubView(h.GuajiMediator.N,h.GuajiMediator.SV.MAIN,{isFromJump:!0}),h.AppFacade.getInstance().sendNotification(CN.MAIN_CHANGE_BTN,"GUAJI")}},FIGHT:{clickFunc:function(e){h.AppFacade.getInstance().sendNotification(CN.FIGHT_OPEN_FIGHT,e)}},FIGHT_TEST:{config:ModuleStyle.FIGHT,clickFunc:function(e){h.AppFacade.getInstance().sendNotification(CN.FIGHT_OPEN_OR_CLOSE_FIGHT_TEST,e)}},BACKPACK:{moduleStyle:ModuleStyle.BACKPACK,clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.BackpackMediator.N,h.BackpackMediator.SV.MAIN),h.AppFacade.getInstance().sendNotification(CN.MAIN_CHANGE_BTN,"BACKPACK")}},GUILD_CREATE:{moduleStyle:ModuleStyle.BACKPACK,clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.GuildMediator.N,h.GuildMediator.SV.CREATE_OR_APPLY)}},GUILD:{moduleStyle:ModuleStyle.GUILD,clickFunc:function(e){h.AppFacade.getInstance().retrieveProxy(h.GuildPy.N).isInGuild()?h.AppFacade.getInstance().showSubView(h.GuildMediator.N,h.GuildMediator.SV.MAIN_MAP):r.jumpTo("GUILD_CREATE"),h.AppFacade.getInstance().sendNotification(CN.MAIN_CHANGE_BTN,"GUILD")},isOpen:function(){if(Utils.UnlockMgr.checkPass(MODULE.Guild,!0).allow)return!0;for(var e=["CITY","HERO","GUAJI","BACKPACK"],t=r.lastEvents.length;0<t;t--)if(0<=e.indexOf(r.lastEvents[t]))return h.AppFacade.getInstance().sendNotification(CN.MAIN_CHANGE_BTN,r.lastEvents[t]),!1;return!1}},ZZQ_MATCH:{moduleStyle:ModuleStyle.ZZQ,clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.ZzqMediator.N,h.ZzqMediator.SV.MATCHING,e)}},ZZQ:{moduleStyle:ModuleStyle.ZZQ,clickFunc:function(e){if(Utils.SDKMgr.getPerformConfig(9)){if(Utils.UnlockMgr.checkPass(MODULE.Wchess,!0).allow){var t=h.AppFacade.getInstance().retrieveProxy(h.ZzqPy.N);t.GetWchessRoomInfo(function(){t.curRoomInfo.status>=EWchessRoomStatus.Matched?h.AppFacade.getInstance().showSubView(h.ZzqMediator.N,h.ZzqMediator.SV.CHESS_MAIN):r.jumpTo("ZZQ_MATCH",void 0,e)})}}else Utils.MsgUtils.addMidMsg("敬请期待")}},HOLDEM_MATCH:{moduleStyle:ModuleStyle.HOLDEM,clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.HoldemMed.N,h.HoldemMed.SV.MATCHING,e)}},HOLDEM:{moduleStyle:ModuleStyle.HOLDEM,clickFunc:function(e){if(Utils.UnlockMgr.checkPass(MODULE.Cardgame,!0).allow){var t=h.AppFacade.getInstance().retrieveProxy(h.HoldemPy.N);t.GetRoomInfo(function(){t.isIdle()?r.jumpTo("HOLDEM_MATCH",void 0,e):h.AppFacade.getInstance().showSubView(h.HoldemMed.N,h.HoldemMed.SV.MAIN)})}}},XYX_USERINFO:{ignoreStack:!0,clickFunc:function(t){Utils.SDKMgr.cmd({type:"AuthSetting",scope:"scope.userInfo"},function(e){e?Utils.SDKMgr.cmd({type:"GetOpenData"},function(e){t.cb&&t.cb(e)}):h.AppFacade.getInstance().showSubView(h.PlayerMediator.N,h.PlayerMediator.SV.XYX_USERINFO,{cb:function(e){t.cb&&t.cb(e)}})})}}})[MODULE.Manor]={clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.ManorMediator.N,h.ManorMediator.SV.MAIN)}},e[MODULE.StormWar]={clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.StormWarMediator.N,h.StormWarMediator.SV.MAIN)},isOpen:function(){var e=Utils.UnlockMgr.getOpenInfo(MODULE.StormWar);return e.allow?!!e.isOpen||(Utils.MsgUtils.addMidMsg("开放时间："+e.openDayTip),!1):(e.ext&&Utils.MsgUtils.addMidMsg(e.ext.tips),!1)}},e[MODULE.Pet]={clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.PetMediator.N,h.PetMediator.SV.MAIN)}},e[MODULE.RiskDifficulty]={clickFunc:function(e){Utils.UnlockMgr.checkPass(MODULE.RiskDifficulty,!1).allow&&h.GameMVC.guajiPy.GetLayerNum(function(){PopUpManager.addPopUp({obj:new h.GuajiGateListPanel({type:1}),closeCB:function(e){var t=h.AppFacade.getInstance().retrieveProxy(h.GuajiPy.N);e&&t.MiniTriggerEvent(Number(e))}})},1)}},e[MODULE.VIP]={clickFunc:function(e){h.MainJumpConfig.jumpTo(MODULE.Recharge,!1,{viewType:h.RechargeView.VIEW_TYPE.PRIVILEGE})}},e[MODULE.Recharge]={clickFunc:function(e){if("qqzone_ios"==Utils.agentConfig.AgentCode&&Utils.SDKMgr.getPerformConfig(1)&&Utils.SDKMgr.getPerformConfig(19))h.GameMVC.activityMed.showViewByCode(EActivityType.ShouCangYouLi,{source:"scbz_img_chongzhizhiyin_png"});else if(Utils.SDKMgr.getPerformConfig(1)){var t=Utils.SDKMgr.getPerformConfig(4);Utils.SDKMgr.getPerformConfig(19)?h.GameMVC.activityMed.showViewByCode(EActivityType.ShouCangYouLi):Utils.MsgUtils.addMidMsg(t||"暂未开启")}else h.GameMVC.rechargeMed.showSubView(h.RechargeMediator.SV.MAIN,e)}},e[MODULE.Bag]={clickFunc:function(e){h.MainJumpConfig.jumpTo("BACKPACK")}},e[MODULE.Hero]={clickFunc:function(e){h.MainJumpConfig.jumpTo("HERO")}},e[MODULE.Wchess]={clickFunc:function(e){h.MainJumpConfig.jumpTo("ZZQ")}},e[MODULE.Cardgame]={clickFunc:function(e){h.MainJumpConfig.jumpTo("HOLDEM")}},e[MODULE.Risk]={clickFunc:function(e){h.MainJumpConfig.jumpTo("GUAJI")}},e[MODULE.ShopMystical]={clickFunc:function(e){h.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeRefresh})}},e[MODULE.Immortal]={clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.ImmortalMed.N,h.ImmortalMed.SV.MAIN)}},e[MODULE.ShopExpedition]={clickFunc:function(e){h.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeExpedition})}},e[MODULE.ShopTeamExpedition]={clickFunc:function(e){h.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeTeamExpedition})}},e[MODULE.ShopArean]={clickFunc:function(e){h.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeArena})}},e[MODULE.ShopDecompose]={clickFunc:function(e){h.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeDecompose})}},e[MODULE.ShopRaceGashapon]={clickFunc:function(e){h.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeRaceGashapon})}},e[MODULE.ShopNationalDay]={clickFunc:function(e){h.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeNationalDay})}},e[MODULE.ShopTypeThanksGiving]={clickFunc:function(e){h.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeThanksGiving})}},e[MODULE.ShopPeakWar]={clickFunc:function(e){h.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypePeakWar,closeCB:function(){var e=h.GameMVC.fashionMed.getSubView(h.FashionMediator.SV.MAIN);e&&e.updateFashion()}})}},e[MODULE.HeroEquip]={clickFunc:function(e){r.jumpTo("HERO")}},e[MODULE.HeroArtifact]={clickFunc:function(e){r.jumpTo("HERO")}},e[MODULE.AbyssLair]={clickFunc:function(e){if(Utils.UnlockMgr.checkPass(MODULE.AbyssLair).allow){h.GameMVC.DeepNestPy;h.GameMVC.DeepNestPy.GetAbyssLairInfo(function(e){GameRootLayer.gameLayer().switchCloudLoading(!0),h.AppFacade.getInstance().showSubView(h.DeepNestMediator.N,h.DeepNestMediator.SV.MAIN,{chalCount:e.chalCount,chapterInfos:e.chapterInfos,isOpen:!0})})}}},e[MODULE.Vestage]={clickFunc:function(e){var t=h.GameMVC.dungeonPy;t.GetVestageMapInfo(function(){t.baseInfo.processStatus===VestageProcessType.EnterMap?h.AppFacade.getInstance().showSubView(h.DungeonMed.N,h.DungeonMed.SV.MAP,e):h.GameMVC.dungeonMed.switchMenLoading(["group_dungeon_main"],function(){h.AppFacade.getInstance().showSubView(h.DungeonMed.N,h.DungeonMed.SV.MAIN,e)})})}},e[MODULE.TeamArena]={clickFunc:function(e){h.GameMVC.battleZoneArenaPy.GetBattleZoneArenaInfo(function(){h.AppFacade.getInstance().showSubView(h.BattleZoneArenaMediator.N,h.BattleZoneArenaMediator.SV.MAIN)})},isOpen:function(){return!!h.GameMVC.battleZoneArenaPy.getOpenInfo().isOpen||(Utils.MsgUtils.addMidMsg("未开启"),!1)}},e[MODULE.RiskMulti]={clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.GuajiMediator.N,h.GuajiMediator.SV.MULTI)},isOpen:function(){return Utils.SDKMgr.getPerformConfig(40)}},e[MODULE.WorldKing]={clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.WorldKingMediator.N,h.WorldKingMediator.SV.MAIN)},isOpen:function(){var e=h.AppFacade.getInstance().retrieveProxy(h.WorldKingPy.N).getOpenInfo();return e.isOpen||Utils.MsgUtils.addMidMsg("暂未开启"),e.isOpen}},e[MODULE.ServerBoss]={clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.WorldBossMediator.N,h.WorldBossMediator.SV.MAIN)},isOpen:function(){var e=Utils.UnlockMgr.getOpenInfo(MODULE.ServerBoss);return e.allow?!!e.isOpen||(Utils.MsgUtils.addMidMsg("不在活动期限内"),!1):(e.ext&&Utils.MsgUtils.addMidMsg(e.ext.tips),!1)}},e[MODULE.Guild]={clickFunc:function(e){r.jumpTo("GUILD")}},e[MODULE.GuildBoss]={clickFunc:function(e){Utils.UnlockMgr.checkPass(MODULE.GuildBoss).allow&&h.AppFacade.getInstance().showSubView(h.GuildBossMediator.N,h.GuildBossMediator.SV.MAIN)},isOpen:function(){var e=h.AppFacade.getInstance().retrieveProxy(h.GuildBossPy.N).getOpenInfo();return e.isOpen||Utils.MsgUtils.addMidMsg("暂未开启"),e.isOpen}},e[MODULE.GuildShop]={clickFunc:function(e){var t=h.AppFacade.getInstance().retrieveProxy(h.GuildPy.N);r.jumpTo("GUILD"),Utils.UnlockMgr.checkPass(MODULE.GuildShop).allow&&t.isInGuild()&&h.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeGuild})}},e[MODULE.LuckyTurntable]={clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.LuckyTableMed.N,h.LuckyTableMed.SV.MAIN)}},e[MODULE.GloryArena]={isOpen:function(){if(Utils.UnlockMgr.checkPass(MODULE.GloryArena).allow){var e=Utils.TimerManager.getServerTime(!1);h.GameMVC.gloryArenaPy.arenaInfo.endDt;return!(0<h.GameMVC.gloryArenaPy.arenaInfo.startDt-e)||(Utils.MsgUtils.addMidMsg("未开启"),!1)}return!1},clickFunc:function(e){if(Utils.UnlockMgr.checkPass(MODULE.GloryArena,!1).allow){var t=Utils.TimerManager.getServerTime(!1);h.GameMVC.gloryArenaPy.arenaInfo.endDt;0<h.GameMVC.gloryArenaPy.arenaInfo.startDt-t?Utils.MsgUtils.addMidMsg("未开启"):h.GameMVC.gloryArenaMed.showSubView(h.GloryArenaMed.SV.MAIN)}}},e[MODULE.RaceTower]={isOpen:function(){return Utils.UnlockMgr.checkPass(MODULE.RaceTower,!1).allow},clickFunc:function(e){Utils.UnlockMgr.checkPass(MODULE.RaceTower,!1).allow&&h.GameMVC.raceTowerMed.showSubView(h.RaceTowerMed.SV.MAIN)}},e[MODULE.GuildWar]={noCheck:!0,isOpen:function(){var e=h.AppFacade.getInstance().retrieveProxy(h.GuildWarPy.N).getGuildWarStatus();if(e!=GuildWarStatus.Close)return e!=GuildWarStatus.UnEnroll||(Utils.MsgUtils.addMidMsg("当前阶段不可报名"),!1);Utils.UnlockMgr.checkPass(MODULE.GuildWar).allow&&Utils.MsgUtils.addMidMsg("当前阶段不可进入")},clickFunc:function(e){var t=h.AppFacade.getInstance().retrieveProxy(h.GuildPy.N);r.jumpTo("GUILD"),Utils.UnlockMgr.checkPass(MODULE.GuildWar).allow&&(t.isInGuild()?h.AppFacade.getInstance().showSubView(h.GuildWarMediator.N,h.GuildWarMediator.SV.MAIN):Utils.MsgUtils.addMidMsg("还没加入公会"))}},e[MODULE.GuildTranscript]={clickFunc:function(e){var t=h.AppFacade.getInstance().retrieveProxy(h.GuildPy.N);r.jumpTo("GUILD"),Utils.UnlockMgr.checkPass(MODULE.GuildTranscript).allow&&t.isInGuild()&&h.AppFacade.getInstance().showSubView(h.GuildInstanceMediator.N,h.GuildInstanceMediator.SV.MAIN)}},e[MODULE.Challenge]={clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.HeroChallengeMediator.N,h.HeroChallengeMediator.SV.MAIN)}},e[MODULE.HeroChallenge]={clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.HeroChallenge2Mediator.N,h.HeroChallenge2Mediator.SV.MAIN)}},e[MODULE.GuildCollect]={clickFunc:function(e){var t=h.AppFacade.getInstance().retrieveProxy(h.GuildPy.N);r.jumpTo("GUILD"),Utils.UnlockMgr.checkPass(MODULE.GuildCollect).allow&&t.isInGuild()&&h.AppFacade.getInstance().showSubView(h.GuildCollectMediator.N,h.GuildCollectMediator.SV.MAIN)}},e[MODULE.GuildSkill]={clickFunc:function(e){var t=h.AppFacade.getInstance().retrieveProxy(h.GuildPy.N),i=h.AppFacade.getInstance().retrieveProxy(h.GuildSkillPy.N);r.jumpTo("GUILD"),Utils.UnlockMgr.checkPass(MODULE.GuildSkill).allow&&t.isInGuild()&&(null==i.skillInfo.length&&i.GetGuildSkillInfo(),h.AppFacade.getInstance().showSubView(h.GuildSkillMediator.N,h.GuildSkillMediator.SV.MAIN))}},e[MODULE.Ranking]={clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.RankMediator.N,h.RankMediator.SV.MAIN)}},e[MODULE.Decompose]={clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.BackpackMediator.N,h.BackpackMediator.SV.DECOMPOSE,{type:EEntityType.EEntityTypeHero})}},e[MODULE.DecomposeEquip]={clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.BackpackMediator.N,h.BackpackMediator.SV.DECOMPOSE,{type:EEntityType.EEntityTypeHeroEquip})}},e[MODULE.DecomposeHeroSpirit]={clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.BackpackMediator.N,h.BackpackMediator.SV.DECOMPOSE_PANEL,{type:EEntityType.EEntityTypeItem+1e4*EPropType.EPropTypeHeroSpirit})}},e[MODULE.RiskFingerToXY]={ignoreStack:!0,clickFunc:function(e){e?(Array.isArray(e)||(e=JSON.parse(e)),h.AppFacade.getInstance().sendNotification(CN.GUAJI_FINGER_TO_XY,{tileX:e[0],tileY:e[1],num:e[2]})):h.AppFacade.getInstance().sendNotification(CN.GUAJI_FINGER_TO_XY)}},e[MODULE.RiskMeToXY]={ignoreStack:!0,clickFunc:function(e){e&&(Array.isArray(e)||(e=JSON.parse(e)),h.AppFacade.getInstance().sendNotification(CN.GUAJI_PRETEND_CLICK_TILED,{tileX:e[0],tileY:e[1],num:e[2]}))}},e[MODULE.RiskFingerAppearToXY]={ignoreStack:!0,clickFunc:function(e){e&&(Array.isArray(e)||(e=JSON.parse(e)),h.AppFacade.getInstance().sendNotification(CN.GUAJI_FINGER_APPEAR_TO_XY,{tileX:e[0],tileY:e[1],num:e[2],time:1e3}))}},e[MODULE.Activity]={clickFunc:function(e){if(!(e&&e%MODULE.Activity)){var t=h.AppFacade.getInstance().retrieveProxy(h.ActivityPy.N),i=h.ActivityConfig.getActivityConfigByType(ACTIVITY_ENTRANCE.JINGCAI),o=!1;return i.forEach(function(e){t.isOpen(e.id)&&(o=!0)}),void(o?(r.jumpTo("CITY"),h.AppFacade.getInstance().showSubView(h.ActivityMediator.N,h.ActivityMediator.SV.MAIN,{viewType:ACTIVITY_ENTRANCE.ACTIVITY})):Utils.MsgUtils.addMidMsg("活动未开启"))}var n=h.AppFacade.getInstance().retrieveMediator(h.ActivityMediator.N),a=e%MODULE.Activity;h.AppFacade.getInstance().retrieveProxy(h.ActivityPy.N).isOpen(a)?(n.hideAllSubView(),h.AppFacade.getInstance().retrieveMediator(h.ActivityMediator.N).showViewByCode(a)):Utils.MsgUtils.addMidMsg("活动未开启")}},e[MODULE.Activity+EActivityType.ZoneAuction1]={clickFunc:function(e){var t=h.AppFacade.getInstance().retrieveProxy(h.ActivityPy.N),i=h.AppFacade.getInstance().retrieveMediator(h.ActivityMediator.N);t.isOpen(EActivityType.ZoneAuction)?(i.hideAllSubView(),h.AppFacade.getInstance().retrieveMediator(h.ActivityMediator.N).showViewByCode(EActivityType.ZoneAuction1)):Utils.MsgUtils.addMidMsg("活动未开启")}},e[MODULE.ActivityBrave]={clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.BraveBookMediator.N,h.BraveBookMediator.SV.MAIN)}},e[MODULE.ActivityNewBrave]={clickFunc:function(e){h.AppFacade.getInstance().retrieveMediator(h.ActivityMediator.N).showViewByCode(EActivityType.NewBraveBook)}},e[MODULE.ActivityBraveBaoZang]={clickFunc:function(e){h.AppFacade.getInstance().showSubView(h.BraveBookMediator.N,h.BraveBookMediator.SV.BAOXIANG)}},e[MODULE.TribeBattle]={isOpen:function(){var e=Utils.UnlockMgr.getOpenInfo(MODULE.TribeBattle);return!(!e.isOpen||!e.allow)||(Utils.MsgUtils.addMidMsg("暂未开启"),!1)},clickFunc:function(){h.GameMVC.tribeBattlePy.GetTribeBattleInfo(function(){h.AppFacade.getInstance().showSubView(h.TribeBattleMed.N,h.TribeBattleMed.SV.MAIN)})}},e[MODULE.PeakWar]={isOpen:function(){return h.GameMVC.peakWarPy.updateCurType()!==PEAK_WAR_TYPE.HIGH_END||(Utils.MsgUtils.addMidMsg("当前已结束"),!1)},clickFunc:function(){h.GameMVC.peakWarPy.curType===PEAK_WAR_TYPE.FREE||h.GameMVC.peakWarPy.curType===PEAK_WAR_TYPE.FREE_END?h.AppFacade.getInstance().showSubView(h.PeakWarMed.N,h.PeakWarMed.SV.FREE):h.AppFacade.getInstance().showSubView(h.PeakWarMed.N,h.PeakWarMed.SV.HIGH)}},e[MODULE.Altar]={isOpen:function(){return!(!Utils.UnlockMgr.checkPass(MODULE.Altar).allow||!Utils.UnlockMgr.checkPass(MODULE.AltarHero).allow)&&(0!=h.GameMVC.heroAltarPy.getJijieInfo(MODULE.Hero,void 0).sixthInfo.length||(Utils.MsgUtils.addMidMsg("英雄集结需要至少6个五星英雄"),!1))},clickFunc:function(e){h.GameMVC.heroAltarMed.showSubView(h.HeroAltarMed.SV.MAIN)}},e[MODULE.AltarHero]={isOpen:function(){return!(!Utils.UnlockMgr.checkPass(MODULE.Altar).allow||!Utils.UnlockMgr.checkPass(MODULE.AltarHero).allow)&&(0!=h.GameMVC.heroAltarPy.getJijieInfo(MODULE.Hero,void 0).sixthInfo.length||(Utils.MsgUtils.addMidMsg("英雄集结需要至少6个五星英雄"),!1))},clickFunc:function(e){h.GameMVC.heroAltarMed.showSubView(h.HeroAltarMed.SV.MAIN)}},e[MODULE.AltarHeroEquip]={isOpen:function(){return!(!Utils.UnlockMgr.checkPass(MODULE.Altar).allow||!Utils.UnlockMgr.checkPass(MODULE.AltarHeroEquip).allow)&&(0!=h.GameMVC.heroAltarPy.getJijieInfo(MODULE.HeroEquip,void 0).sixthInfo.length||(Utils.MsgUtils.addMidMsg("装备集结需要至少24件金色或以上品质的装备"),!1))},clickFunc:function(e){h.GameMVC.heroAltarMed.showSubView(h.HeroAltarMed.SV.MAIN,{module:MODULE.HeroEquip})}},e[MODULE.AltarHeroArtifact]={isOpen:function(){return!(!Utils.UnlockMgr.checkPass(MODULE.Altar).allow||!Utils.UnlockMgr.checkPass(MODULE.AltarHeroArtifact).allow)&&(0!=h.GameMVC.heroAltarPy.getJijieInfo(MODULE.HeroArtifact,void 0).sixthInfo.length||(Utils.MsgUtils.addMidMsg("圣物集结需要至少6件金色圣物"),!1))},clickFunc:function(e){h.GameMVC.heroAltarMed.showSubView(h.HeroAltarMed.SV.MAIN,{module:MODULE.HeroArtifact})}},e),r=(d.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【MainJumpConfig】："].concat(e))},d.getConfig=function(e){return p[e]},d.confirmPush=function(){if(""!=d.lastEvent){var e=d.lastEvent;return d.lastEvent="",d.lastEvents.push(e),8<d.lastEvents.length&&d.lastEvents.splice(0,1),e}},d.getCurEvent=function(){return d.lastEvents[d.lastEvents.length-1]},d.confirmSpliceIfTop=function(e){d.lastEvents[d.lastEvents.length-1]==e&&d.lastEvents.pop()},d.jumpTo=function(e,t,i){if(void 0===t&&(t=!1),!e){d.lastEvents.pop();var o=d.lastEvents.pop();return d.jumpTo(o||"GUAJI",!0),!0}var n=i,a=void 0,r=void 0;if(Number(e))a=e;else{if("object"==typeof e)return void egret.warn("暂不支持对象跳转");"string"==typeof e&&(a=e)}if(r=p[a],!a&&r&&(a=r.moduleId),!(r&&r.noCheck||Utils.UnlockMgr.checkPass(a,!0).allow))return!1;if(r&&r.isOpen&&!r.isOpen())return!1;if(e==d.getCurEvent())return this.log("重复点击"),!1;if(r&&(!r||r.ignoreStack)||(d.lastEvent=e),r&&r.moduleStyle&&(r.moduleStyle.mainUIStyle&&h.AppFacade.getInstance().sendNotification(CN.CHANGE_STYLE,r.moduleStyle.mainUIStyle),h.AppFacade.getInstance().sendNotification(CN.HIDE_ALL_SUBVIEW)),r)return"function"==typeof r?(r(n),!0):"function"==typeof r.clickFunc?(r.clickFunc(n),!0):(this.log("暂不支持当前跳转模式"),!1);if(!Number(e))return this.log("暂不支持当前跳转模式"),!1;var s=e%100,c=Math.floor(e/100);if(!(100<=c)){var l=d.id_2_mediator[c];return l&&l.SV?(h.AppFacade.getInstance().showSubView(l.N,s),!0):(this.log("mediator或mediator.SV不存在"),!1)}d.jumpTo(MODULE.Activity,!1,e)},d.lastEvent="",d.lastEvents=new Array,d.id_2_mediator={3:h.TaskMediator,7:h.ChatMediator,8:h.FriendMediator,10:h.BackpackMediator,11:h.StrongMediator,13:h.ChampionMediator,17:h.HeroMediator,19:h.ArenaMediator,20:h.BattleZoneArenaMediator,21:h.CopyEntranceMediator,22:h.MailMediator,23:h.TeamExpeMediator,24:h.WorldKingMediator,25:h.WorldBossMediator,26:h.MagicalArtifactMediator,27:h.GuajiMediator,28:h.TouchGoldHandMediator,29:h.SmithyMediator},d);function d(){}h.MainJumpConfig=r,__reflect(r.prototype,"game.MainJumpConfig")}(game=game||{}),function(w){var i,e=(__extends(o,i=BaseMediator),Object.defineProperty(o.prototype,"mainUI",{get:function(){return this.viewComponent},enumerable:!0,configurable:!0}),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,w.MainUI)},o.prototype.listNotificationInterests=function(){return[CN.MAIN_DEBUG_INFO_UPDATE,CN.LOGIN_FINAL_DONE,CN.CHANGE_STYLE,CN.GAME_HEARTBEAT,CN.UPDATE_BG,CN.PLAYER_INFO_UPDATE,CN.PLAYER_LEVEL_UP,CN.MAIN_CHAT_UPDATE,CN.MAIN_CHAT_PRIVATEPLAYER_UPDATE,CN.MAIN_CHAT_TASK_STEP,CN.TASK_GET_REWARDS_POP_CLOSE,CN.ACTIVITY_LIST_UPDATED,CN.GENERAL_PASS_DAY,CN.MAIN_CHANGE_BTN,CN.MAIN_UPDATE_BTN,CN.CONFIG_ALL_LOADED,CN.FIGHT_ON_FIGHT_VISIBLE_SWITCH,CN.GUAJI_UPDATE_RES_NOTICE,CN.MAIN_FORCE_UPDATE_BANNER]},o.prototype.handleNotification=function(e){var t=this,i=e.getBody();switch(e.getName()){case CN.GENERAL_PASS_DAY:w.GameMVC.loginPy.getIsTodayHoliday(void 0,!0),w.GameMgr.getInstance().GetServerInfo(),Utils.SDKMgr.getPerformConfig(10018)&&Utils.agentConfig.other.isJhb&&(Utils.LocalStorageUtil.setItem("msgTime","0",!1),Utils.LocalStorageUtil.setItem("huangzuan","0",!1),Utils.LocalStorageUtil.setItem("QQVip","0",!1));break;case CN.LOGIN_FINAL_DONE:egret.setTimeout(function(){Utils.SoundManager.preloadEffect()},this,2e4),w.AppFacade.getInstance().retrieveProxy(w.GuajiPy.N).getQuickBattleInfo();break;case CN.CHANGE_STYLE:this.mainUI&&(this.mainUI.curGuideAvailable=!1),this.changeStyle(i);break;case CN.CONFIG_ALL_LOADED:break;case CN.FIGHT_ON_FIGHT_VISIBLE_SWITCH:egret.clearTimeout(this.bannerScheId),this.bannerScheId=0,egret.setTimeout(function(){t.handleBanner()},this,500);break;case CN.MAIN_FORCE_UPDATE_BANNER:this.handleBanner();break;case CN.PLAYER_INFO_UPDATE:this.mainUI&&this.mainUI.updatePlayerInfo();break;case CN.MAIN_DEBUG_INFO_UPDATE:null!=i.serverTime&&(this.mainUI.initServerTimeSche(),this.mainUI.lb_serTime.visible=i.serverTime);break;case CN.PLAYER_LEVEL_UP:Utils.SDKMgr.isCloseIAPByAgent?Utils.SDKMgr.cmd({type:"CheckRecharge",level:this.playerProxy.playerInfoVO.level},function(){t.mainUI&&t.mainUI.updatePlayerInfo()}):this.mainUI&&this.mainUI.updatePlayerInfo(),Utils.SDKMgr.enterFlow("PlayerLevelUp"),this.updateBtn();break;case CN.PLAYER_VIP_LEVEL_UP:this.mainUI&&this.mainUI.updatePlayerInfo(),this.updateBtn();break;case CN.ACTIVITY_LIST_UPDATED:case CN.MAIN_UPDATE_BTN:this.updateBtn();break;case CN.GAME_HEARTBEAT:this.updateBtn(),i.totalTime%6e4==0&&w.GameMVC.loginPy.userVO.checkAddictive(i.totalTime)&&egret.setTimeout(function(){w.GameMgr.getInstance().restart()},this,11e3);break;case CN.GUAJI_UPDATE_RES_NOTICE:this.mainUI&&this.mainUI.updateGuajiNotice(i);break;case CN.MAIN_CHANGE_BTN:if(!this.mainUI)return;for(var o=this.mainUI.getBtnByModule("ALL"),n=1;n<=5;n++){var a=o[n];a.scaleX=a.scaleY=1,a&&egret.Tween.removeTweens(a),a&&(a.touchEnabled=!0)}var r=this.mainUI.getBtnByModule(i),s=w.AppFacade.getInstance().retrieveProxy(w.GuajiPy.N);"CITY"==i?Utils.SoundManager.playDelayBg(SOUND_BGM_TYPE.zhu_cheng):"GUAJI"==i&&Utils.SoundManager.playDelayBg(s.curLayerTheme.bgm),r&&r.touchEnabled&&(r.touchEnabled=!1,Utils.SDKMgr.getPerformConfig(6)||r&&egret.Tween.get(r,{loop:!0}).to({scaleX:.95,scaleY:.95},600).to({scaleX:1,scaleY:1},600)),w.AppFacade.getInstance().retrieveProxy(w.GuajiPy.N).updateNotice()}},o.prototype.onViewCreate=function(){if(Utils.SDKMgr.getPerformConfig(27))for(var e=0,t=w.MainBtnConfig.TOP_LEFT_BTN_CONFIG;e<t.length;e++){var i=t[e];"分享"==i.name&&(i.name="邀请")}w.AppFacade.getInstance().retrieveProxy(w.GuidePy.N),this.updateBtn(),egret.clearInterval(this.updateBtnTimer),this.updateBtnTimer=egret.setInterval(this.updateBtnAccessory,this,5e3);for(var o=0,n=0,a=w.MainBtnConfig.BOTTOM_BTN_CONFIG;n<a.length;n++){var r=a[n],s=this.bindBottomFiveBtn(r,o++);this.bindBtn(s,r,!0)}Utils.agentConfig.OffLineTest?(this.playerProxy.makeFadePlayerInfo(),this.sendNotification(CN.PLAYER_INFO_UPDATE)):this.playerProxy.GetPlayerInfo()},o.prototype.updateBtn=function(){if(this.mainUI){var e=void 0;e=[];var t=this.curModuleName||"GUAJI";if(w.MainBtnConfig.VIEW_GROUP_ORDER[t]){for(var i=0,o=w.MainBtnConfig.TOP_BTN_CONFIG;i<o.length;i++){(C=o[i])._dismiss=!0;for(var n=0,a=w.MainBtnConfig.VIEW_GROUP_ORDER[t].TOP;n<a.length;n++){var r=a[n];if(C.img==r){C._dismiss=!1;break}}}for(var s=0,c=w.MainBtnConfig.TOP_RIGHT_BTN_CONFIG;s<c.length;s++){(C=c[s])._dismiss=!0;for(var l=0,h=w.MainBtnConfig.VIEW_GROUP_ORDER[t].RIGHT;l<h.length;l++)if(r=h[l],C.img==r){C._dismiss=!1;break}}for(var p=0,d=w.MainBtnConfig.TOP_RIGHT2_BTN_CONFIG;p<d.length;p++){(C=d[p])._dismiss=!0;for(var u=0,g=w.MainBtnConfig.VIEW_GROUP_ORDER[t].RIGHT2;u<g.length;u++)if(r=g[u],C.img==r){C._dismiss=!1;break}}for(var f=0,_=w.MainBtnConfig.TOP_LEFT_BTN_CONFIG;f<_.length;f++){(C=_[f])._dismiss=!0;for(var m=0,y=w.MainBtnConfig.VIEW_GROUP_ORDER[t].LEFT;m<y.length;m++)if(r=y[m],C.img==r){C._dismiss=!1;break}}for(var v=0,T=w.MainBtnConfig.BOTTOM_LEFT_BTN_CONFIG;v<T.length;v++){var C;(C=T[v])._dismiss=!0;for(var E=0,I=w.MainBtnConfig.VIEW_GROUP_ORDER[t].LEFT_BOTTOM;E<I.length;E++)if(r=I[E],C.img==r){C._dismiss=!1;break}}}e.push({obj:this.mainUI.gp_top,c:w.MainBtnConfig.TOP_BTN_CONFIG,commonSize:[86,86]}),e.push({obj:this.mainUI.gp_top_right,c:w.MainBtnConfig.TOP_RIGHT_BTN_CONFIG,commonSize:[86,86]}),e.push({obj:this.mainUI.gp_top_right2,c:w.MainBtnConfig.TOP_RIGHT2_BTN_CONFIG,commonSize:[86,86]}),e.push({obj:this.mainUI.gp_top_left2,c:w.MainBtnConfig.TOP_LEFT_BTN_CONFIG,commonSize:[86,86]}),e.push({obj:this.mainUI.gp_bottom_left,c:w.MainBtnConfig.BOTTOM_LEFT_BTN_CONFIG,commonSize:[86,86]}),e.push({obj:this.mainUI.gp_bottom_right,c:w.MainBtnConfig.BOTTOM_RIGHT_BTN_CONFIG,commonSize:[86,86]}),e.push({obj:this.mainUI.gp_bottom_banner,c:w.MainBtnConfig.BOTTOM_RIGHT_BANNER_CONFIG,commonSize:[245,94]}),window._aaa=this.mainUI;for(var b=0,A=e;b<A.length;b++)for(var P=A[b],M=0,N=0,S=P.c;N<S.length;N++){var k=S[N];if(M++,k._dismiss||k.isOpenCheck&&(!k.isOpenCheck()||k.unlockModule&&!Utils.UnlockMgr.checkPass(k.unlockModule,!1).allow))this._all_top_btns_img2BtnGP[k.img]&&(O=this._all_top_btns_img2BtnGP[k.img],Utils.CacheMgr.setCacheComponent(k.img,O));else{if(!this._all_top_btns_img2BtnGP[k.img]){var U=this.makeTopXXBtnGP(k,P.commonSize),L=U.getChildByName("btn");this.bindBtn(L,k,!1),P.obj.addChildAt(U,M),k.trueNoticeType&&(k.noticeType=k.trueNoticeType()),k.noticeType&&NoticeManager.addNoticeListener(k.noticeType,L,this.mainUI,{percentX:60/86,percentY:8/86,noCleanAfterRemove:!0}),this._all_top_btns_img2BtnGP[k.img]=U}var O=this._all_top_btns_img2BtnGP[k.img];P.obj.contains(O)||Utils.CacheMgr.getCacheComponent(k.img,P.obj),P.obj.setChildIndex(O,M),O.getChildByName("btn")&&O.getChildByName("btn").updateFunc&&O.getChildByName("btn").updateFunc()}}this.updateBtnAccessory(),this.recalSizeGpTop()}},o.prototype.updateBtnAccessory=function(){if(this.mainUI)for(var e in this._all_top_btns_img2BtnGP)if(this._all_top_btns_img2BtnGP[e]){var t=this._all_top_btns_img2BtnGP[e].getChildByName("btn");t&&t.updateFunc&&t.updateFunc()}},o.prototype.topBtnNum=function(e){var t=0;if(this.mainUI)switch(e){case"TOP":t=this.mainUI.gp_top.numChildren;break;case"TOP_LEFT":t=this.mainUI.gp_top_left.numChildren;break;case"TOP_RIGHT":t=this.mainUI.gp_top_right.numChildren}return t},o.prototype.switchViewGroup=function(e){this.mainUI&&(this.curModuleName=e,this.updateBtn(),"CITY"==e?(this.mainUI.vs_top_left.selectedIndex=0,this.sendNotification(CN.SWITCH_TO_CITY)):this.mainUI.vs_top_left.selectedIndex=1)},o.prototype.bindBtn=function(i,e,t){if(void 0===t&&(t=!1),e.isOpenCheck&&(i.isOpenCheck=e.isOpenCheck),e.updateFunc){var o;if(Array.isArray(e.updateId))o=[],e.updateId.forEach(function(e){var t=i[e]||i.parent&&i.parent[e];t&&(t.name=e,o.push(t))});else{var n=i[e.updateId];n.name=e.updateId,o=n}i.updateFunc=function(){e.updateFunc(o)},i.parent.gp_bottom&&(i.parent.gp_bottom.visible=!0)}i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t&&(i.touchEnabled=!1,e.jumpModule!=this.lastEvent&&this.lastbtn&&(this.lastbtn.touchEnabled=!0),this.lastEvent=e.jumpModule,this.lastbtn=i),null!=e.clickFunc?e.clickFunc():w.MainJumpConfig.jumpTo(e.jumpModule)},this)},o.prototype.makeTopXXBtnGP=function(t,e){var i=new eui.Group;i.touchEnabled=!1;var o=new eui.Button;t.name?(o.skinName="skins.ButtonSkinIcon2",o.label=t.name):o.skinName="skins.ButtonSkinIcon",RES.hasRes(t.img)?o.icon=t.img:o.icon="",o.x=t.posX||0,o.y=t.posY||0,o.name="btn",i.addChild(o);var n=new eui.Group,a=new eui.Image("common_img_heiditiao_08_png");n.width=a.width=81,n.height=a.height=22,a.x=a.y=0;var r=new eui.BitmapLabel;if(r.horizontalCenter=0,r.verticalCenter=0,r.scaleX=r.scaleY=.6,r.name="bm_time",r.font="white_num_fnt",n.addChild(a),n.addChild(r),n.bottom=-20,n.horizontalCenter=0,i.addChild(n),i.bm_time=r,i.gp_bottom=n,i.btn=o,n.visible=!1,o.width=i.width=t.width||e[0],o.height=i.height=t.height||e[1],t.scale&&(i.scaleX=i.scaleY=t.scale),t.effect&&!Utils.ResourceUtils.behaviourWeakConfig.GUAJI_MAIN_BTN_EFF&&MovieClipTools.create(t.effect,function(e){o.addChild(e),e.scaleX=e.scaleY=t.effectOffset&&t.effectOffset[2]||.95,e.x=.5*o.width+(t.effectOffset&&t.effectOffset[0]||0),e.y=.5*o.height+(t.effectOffset&&t.effectOffset[1]||0),e.animation&&e.animation.play&&e.animation.play(t.effect,-1)},this),t.effectBg){var s=i.effectBg;s||((s=new customui.SteadyArmature).x=i.width/2,s.y=i.height/2,i.addChild(s),i.effectBg=s),s.armatureName=t.effectBg}return i},o.prototype.bindBottomFiveBtn=function(e,t){var i=this.mainUI.gp_bottom.getChildAt(t+1);return e.scale&&(i.scaleX=i.scaleY=e.scale),e.noticeType,i},o.prototype.changeStyle=function(e){this.mainUI&&(this.mainUI.changeStyle(e),this.switchViewGroup(w.MainJumpConfig.lastEvent))},o.prototype.recalSizeGpTop=function(){},o.prototype.handleBanner=function(){return __awaiter(this,void 0,void 0,function(){var t,i,o=this;return __generator(this,function(e){switch(e.label){case 0:return this.bannerScheId?[2]:(t=0)===this.mainProxy.broadcastChatList.length||"FIGHT"==w.MainJumpConfig.getCurEvent()||"ZZQ"==w.MainJumpConfig.getCurEvent()?(Utils.MsgUtils.switchBannerBg(!1),[2]):(t=7e3,[4,Utils.MsgUtils.switchBannerBg(!0)]);case 1:return e.sent(),this.bannerScheId||(this.bannerScheId=egret.setTimeout(function(){o.bannerScheId=void 0,o.handleBanner()},this,t),i=this.mainProxy.broadcastChatList.shift(),Utils.MsgUtils.addBannerMsg(i,t-500)),[2]}})})},o.N="MainMediator",o.SV={MAIN:1},o);function o(e){void 0===e&&(e=null);var t=i.call(this,o.N,e)||this;return t._all_top_btns_img2BtnGP={},t.curModuleName="GUAJI",t.lastEvent="",t.playerProxy=w.AppFacade.getInstance().retrieveProxy(w.PlayerPy.N),t.taskProxy=w.AppFacade.getInstance().retrieveProxy(w.TaskPy.N),t.mainProxy=w.AppFacade.getInstance().retrieveProxy(w.MainPy.N),t.guideProxy=w.AppFacade.getInstance().retrieveProxy(w.GuidePy.N),t}w.MainMediator=e,__reflect(e.prototype,"game.MainMediator")}(game=game||{}),function(r){var e=(t.registerAll=function(){(new u).register(),(new _).register(),(new v).register(),(new h).register(),(new s).register(),(new o).register(),(new A).register(),(new E).register()},t);function t(){}r.MainProcessor=e,__reflect(e.prototype,"game.MainProcessor");var i,o=(i=r.ProcessorBase,__extends(n,i),n.prototype.execute=function(e){if(this.checkCB(e.getBody())){var t=e.getBody();if(!t)return;r.AppFacade.getInstance().retrieveProxy(r.MainPy.N).updateCoordinate(t.type,t.infos)}},n);function n(){return i.call(this,"coordinate.CoordinateInfoP",n)||this}r.CoordinateInfoP=o,__reflect(o.prototype,"game.CoordinateInfoP");var a,s=(a=r.ProcessorBase,__extends(c,a),c.prototype.execute=function(e){if(this.checkCB(e.getBody())){var t=r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N),i=e.getBody();if(i&&i.info)for(var o=0,n=i.info;o<n.length;o++){var a=n[o];t.handleClientRewardCore(a.clientReward)}}},c);function c(){return a.call(this,"unlock.UnlockRewardInfoP",c)||this}r.UnlockRewardInfoP=s,__reflect(s.prototype,"game.UnlockRewardInfoP");var l,h=(l=r.ProcessorBase,__extends(p,l),p.prototype.execute=function(e){if(this.checkCB(e.getBody())){var t=e.getBody(),i=r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N);switch(t.rewardSource){case PushRewardSource.Redeem:case PushRewardSource.RiskEvent:i.handleClientReward(t.clientReward)}}},p);function p(){return l.call(this,"playerInfo.PushRewardP",p)||this}r.PushRewardP=h,__reflect(h.prototype,"game.PushRewardP");var d,u=(d=r.ProcessorBase,__extends(g,d),g.prototype.execute=function(e){Utils.MsgUtils.addMidMsg("修改成功");var t=e.getBody(),i=r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N),o=r.AppFacade.getInstance().retrieveProxy(r.PlayerPy.N);switch(t.key){case"test.addItemR":t.num&&i.handleClientRewardCore({rewards:{1:{type:EEntityType.EEntityTypeItem,code:t.code,num:t.num}}});break;case"test.AddVestageItemR":t.clientReward&&(i.handleClientRewardCore(t.clientReward),r.AppFacade.getInstance().updateView(r.DungeonMed.N,r.DungeonMed.SV.MAP));break;case"test.addMoneyR":t.playerMoney&&(o.playerInfoVO.updateMoney(t.playerMoney),this.sendNotification(CN.PLAYER_INFO_UPDATE));break;default:t.clientReward&&i.handleClientRewardCore(t.clientReward),r.AppFacade.getInstance().retrieveProxy(r.PlayerPy.N).GetPlayerInfo(),r.AppFacade.getInstance().retrieveProxy(r.GuildPy.N).getPlayerGuildReq()}},g);function g(){return d.call(this,"test.CommonR",g)||this}r.TestCommonR=u,__reflect(u.prototype,"game.TestCommonR");var f,_=(f=r.ProcessorBase,__extends(m,f),m.prototype.execute=function(e){var t=e.getBody();if(t){var i=r.AppFacade.getInstance().retrieveProxy(r.FriendPy.N);if((!t.message.fromPlayer||!i.isInBlacklist(t.message.fromPlayer.playerId))&&(t.message.channelType!=EChatChannelType.EChatChannelTypePrivate||Utils.UnlockMgr.checkPass(MODULE.ChatPrivate,!1).allow))try{var o=r.AppFacade.getInstance().retrieveProxy(r.MainPy.N),n=o.preTreatMsg(t.message);if(n){if(48==n.broadcastId)return void egret.setTimeout(function(){o.onReceiveMsg(n)},this,1e4);o.onReceiveMsg(n)}}catch(e){this.log("广播处理失败",t)}}},m);function m(){return f.call(this,"chat.NewMessageP",m)||this}r.NewMessageP=_,__reflect(_.prototype,"game.NewMessageP");var y,v=(y=r.ProcessorBase,__extends(T,y),T.prototype.execute=function(e){e.getBody()},T);function T(){return y.call(this,"chat.BroadcastP",T)||this}r.BroadcastP=v,__reflect(v.prototype,"game.BroadcastP");var C,E=(C=r.ProcessorBase,__extends(I,C),I.prototype.execute=function(e){var t=e.getBody();r.GameMVC.mainPy.serverBlackList=t.playerIdList},I);function I(){return C.call(this,"chat.ServerBlackListP",I)||this}r.ServerBlackListP=E,__reflect(E.prototype,"game.ServerBlackListP");var b,A=(b=r.ProcessorBase,__extends(P,b),P.prototype.execute=function(e){var t=e.getBody();r.AppFacade.getInstance().retrieveProxy(r.MainPy.N).deleteChatList(t)},P);function P(){return b.call(this,"chat.DeleteChatMsgP",P)||this}r.DeleteChatMsgP=A,__reflect(A.prototype,"game.DeleteChatMsgP")}(game=game||{}),function(d){var o,e=(__extends(n,o=BaseProxy),n.prototype.checkNotice=function(e){return Utils.UnlockMgr.checkPass(MODULE.Chat,!1)&&!!this.noticesTag[e]},n.prototype.getAllChatList=function(){for(var e in EChatChannelType)EChatChannelType[e]!=EChatChannelType.EChatChannelTypeWorld&&this.getChatList(EChatChannelType[e]);this.maxMsgShow=parseInt(d.Config.constConfig().SystemMessageShowMax.constValue)},n.prototype.getServerBlackList=function(){var t=this;Utils.Socket.send("chat","GetServerBlackList",{}).then(function(e){t.serverBlackList=e.playerIdList})},n.prototype.makeTextStyle=function(e,t,i){void 0===e&&(e=""),void 0===t&&(t=void 0),void 0===i&&(i=[]);var o=i&&0<i.length;return{text:e,style:{textColor:t,href:o?"event:"+JSON.stringify(i):void 0,underline:o}}},n.prototype.getTrueParams=function(e,t,i,o){var n=[];if(t&&i){for(var a=0;a<i.length;a++)n.push(i[a]);for(a=0;a<e.length;a++)n[a+1]||(n[a+1]=e[a])}else for(a=0;a<e.length;a++)n.push(e[a]);var r=void 0;if(n[1]&&""!=n[1])n[0]==EChatJumpType.JumpModule?r=o==EChatChannelType.EChatChannelTypePrivate||o==EChatChannelType.EChatChannelNewZone?3115552:1244928:n[0]==EChatJumpType.ShowInfo&&(n[3]!=EEntityType.EEntityTypePlayer&&n[3]!=EEntityType.EEntityTypeGuild||(r=o==EChatChannelType.EChatChannelTypePrivate||o==EChatChannelType.EChatChannelNewZone?2263677:1048560));else{var s=n[2],c=Math.floor(Number(s)/1e7),l=d.GeneralConfig.getEntityConfigByCode(void 0,s);if(l)if(n[1]=l.name,c!=EEntityType.EEntityTypeHero)r=COLOR_2_FONT_COLOR[l.color||l.initStar];else{var h=l.initStar;[[1,2],[3,3],[4,5],[6,9],[10,13],[14,15]].forEach(function(e,t){h>=e[0]&&h<=e[1]&&(r=0==t?COLOR_2_FONT_COLOR[t+2]:COLOR_2_FONT_COLOR[t+1])})}}return n[2]||n[3]?{text:n[1]+"",params:[n[0]].concat(n.slice(2)),color:r}:{text:n[1]+"",params:[],color:o==EChatChannelType.EChatChannelTypePrivate?12603493:16773120}},n.prototype.preTreatMsg=function(o){var a=this,n=[],r=[];if(o.broadcastId){var e=d.Config.broadcastConfig()[o.broadcastId];if(!e)return o;1!=o.broadcastId&&(o.content=e.content),n=JSON.parse(e.param),o.ShowType=e.show,r=JSON.parse(e.colorOffect)}else o.ShowType=SystemMessageShow.ChatChannel;var s=JSON.parse(o.params);25==o.broadcastId&&(s[2][0]=s[2][0]%5==0?5:s[2][0]%5);var t=o.content.split("%s"),c=[],l=0;t.forEach(function(e,t){if(c.push({text:e}),s[t]){var i=a.getTrueParams(s[t],o.broadcastId,n[t],o.channelType);c.push({text:i.text,color:i.color,params:i.params,colorOffect:r[l++]})}}),c.forEach(function(e,t){e.colorOffect&&(e.colorOffect[0]||e.colorOffect[1])&&(e.colorOffect[0]&&c[t-1]&&(c[t-1].selfOffect2={offect:e.colorOffect[0],color:e.color}),e.colorOffect[1]&&c[t+1]&&(c[t+1].selfOffect1={offect:e.colorOffect[1],color:e.color}))});var h=[];if(c.forEach(function(e,t){if(e.selfOffect1||e.selfOffect2){var i=e.text;if(e.selfOffect1){var o=i.slice(0,e.selfOffect1.offect);i=i.slice(e.selfOffect1.offect,i.length),h.push(a.makeTextStyle(o,e.selfOffect1.color,e.params))}if(e.selfOffect2){var n=e.text.slice(e.text.length-e.selfOffect2.offect,e.text.length);i=i.slice(0,i.length-e.selfOffect2.offect),h.push(a.makeTextStyle(i,e.color,e.params)),h.push(a.makeTextStyle(n,e.selfOffect2.color,e.params))}else h.push(a.makeTextStyle(i,e.color,e.params))}else h.push(a.makeTextStyle(e.text,e.color,e.params))}),h=h.filter(function(e){return!!e.text},this),29==o.broadcastId)for(var i=0;i<2;i++)for(var p in h)if("、"==h[p].text&&"0"==h[parseInt(p)+1].text){h.splice(parseInt(p),2);break}return o.textFlow=h,o},n.prototype.SendMessage=function(e,t,i,o,n,a,r){var s=this;void 0===i&&(i=0),void 0===n&&(n=0),void 0===a&&(a=""),void 0===r&&(r=!1),r||!this.scheId?(e==EChatChannelType.EChatChannelTypeZone&&(e=EChatChannelType.EChatChannelNewZone),this.checkTextVaild(t,function(){Utils.Socket.send("chat","SendMessage",{channelType:e,content:t,playerId:i,checkType:n,params:a}).then(function(){o&&o(),s.setInterval()})})):Utils.MsgUtils.addMidMsg("口干舌燥，请休息一会")},n.prototype.checkTextVaild=function(e,t,i,o){void 0===i&&(i=13),void 0===o&&(o="输入内容不合法"),Utils.SDKMgr.getPerformConfig(i)&&e?Utils.SDKMgr.cmd({type:"CheckTextVaild",text:e},function(e){e.vaild?t&&t():Utils.MsgUtils.addMidMsg(o)}):t&&t()},n.prototype.setInterval=function(){var e=this,t=d.Config.constConfig().chatSendDuration.constValue,i=d.AppFacade.getInstance().retrieveMediator(d.ChatMediator.N).getSubView(d.ChatMediator.SV.CHAT);i&&i.updateInterval(t),this.scheId||(this.scheId=egret.setInterval(function(){(t-=1e3)<=0&&(egret.clearInterval(e.scheId),e.scheId=void 0),i&&i.updateInterval(t)},this,1e3))},n.prototype.bindChatLinkJump=function(e,t){try{var i=JSON.parse(e.text);switch(i[0]){case EChatJumpType.JumpModule:this.jumpModule(i,t);break;case EChatJumpType.ShowInfo:this.showInfo(i)}}catch(e){this.log(e)}},n.prototype.showInfo=function(e){if(this.fightPy.isInFight)this.log("战斗中无法跳转");else{var t=e[1];switch(e[2]){case EEntityType.EEntityTypePlayer:d.AppFacade.getInstance().showSubView(d.FriendMediator.N,d.FriendMediator.SV.INFO,{playerId:t});break;case EEntityType.EEntityTypeHero:d.AppFacade.getInstance().showSubView(d.HeroMediator.N,d.HeroMediator.SV.HERO_DETAIL,{code:t});break;case EEntityType.EEntityTypeGuild:d.AppFacade.getInstance().retrieveProxy(d.GuildPy.N).GetGuildBaseInfo(t,function(e){d.AppFacade.getInstance().showSubView(d.GuildMediator.N,d.GuildMediator.SV.INFO,e)});break;case EEntityType.EEntityTypeMoney:case EEntityType.EEntityTypeItem:PopUpManager.addPopUp({obj:new d.BaseItemDetailView({code:t})});break;default:return}}},n.prototype.jumpModule=function(e,t){if(this.fightPy.isInFight)this.log("战斗中无法跳转");else{var i=e[1],o=e[2];if(o==MODULE.GuildHall){if(!Utils.UnlockMgr.checkPass(MODULE.Guild,!0).allow)return}else if(!Utils.UnlockMgr.checkPass(o,!0).allow)return;switch(d.GameMVC.DeepNestPy.isFirst=!0,o){case MODULE.TeamExpedition:function n(){var e=t&&t.channelType==EChatChannelType.EChatChannelTypePrivate;a.Apply(i,function(){e&&(d.MainJumpConfig.jumpTo(MODULE.TeamExpedition),d.AppFacade.getInstance().showSubView(d.TeamExpeMediator.N,d.TeamExpeMediator.SV.JIJIE_MY_TEAM))},e)}var a=d.AppFacade.getInstance().retrieveProxy(d.TeamExpePy.N);a.info?a.isInTeam()?a.info.teamInfo.team.id!=i?d.GameMgr.getInstance().showCommonTipsWin({commonTips:"你现在已经在其他队伍中\n是否退出并加入该队伍？",clickCB:function(e){1==e.type&&a.Quit(function(){n()},!0)}}):Utils.MsgUtils.addMidMsg("你已经在该队伍了"):n():a.GetTeamExpeditionInfo(n);break;case MODULE.TeamArena:function r(){d.MainJumpConfig.jumpTo(MODULE.TeamArena),s.Apply(i,function(){d.AppFacade.getInstance().showSubView(d.BattleZoneArenaMediator.N,d.BattleZoneArenaMediator.SV.JIJIE_MY_TEAM)},t&&t.channelType==EChatChannelType.EChatChannelTypePrivate)}var s=d.AppFacade.getInstance().retrieveProxy(d.BattleZoneArenaPy.N);s.arenaInfo?r():s.GetBattleZoneArenaInfo(r);break;case MODULE.GuildHall:return(c=d.AppFacade.getInstance().retrieveProxy(d.GuildPy.N)).isInGuild()?void Utils.MsgUtils.addMidMsg("已在公会中"):void c.operationReq(EGuildOperationType.Join,i,function(){Utils.MsgUtils.addMidMsg("申请成功")});case MODULE.Wchess:(c=d.AppFacade.getInstance().retrieveProxy(d.ZzqPy.N)).isIdle()?d.MainJumpConfig.jumpTo("ZZQ",void 0,{id:e[1]}):c.isCanJoinTeam()?c.JoinRoom(e[1]):Utils.MsgUtils.addMidMsg("当前已在房间，无法加入");break;case MODULE.Cardgame:(c=d.AppFacade.getInstance().retrieveProxy(d.HoldemPy.N)).isIdle()?d.MainJumpConfig.jumpTo("HOLDEM",void 0,{id:e[1]}):c.isCanJoinTeam()?c.Join(e[1]):Utils.MsgUtils.addMidMsg("当前已在房间，无法加入");break;case MODULE.RiskMulti:(c=d.AppFacade.getInstance().retrieveProxy(d.GuajiPy.N)).riskMultiRoomInfo.id&&1!=c.riskMultiRoomInfo.members.length?Utils.MsgUtils.addMidMsg("当前已在房间，无法加入"):c.RiskMultiCommand("ApplyRoom",{id:e[1],isInvite:!0},function(){d.MainJumpConfig.jumpTo(MODULE.RiskMulti)});break;case MODULE.ChampionHelp:var c;(c=d.AppFacade.getInstance().retrieveProxy(d.ChampionPy.N)).HelpChallenge(i);break;case MODULE.Manor:d.MainJumpConfig.jumpTo(MODULE.Manor);break;default:d.MainJumpConfig.jumpTo(o)}d.AppFacade.getInstance().hideSubView(d.ChatMediator.N,d.ChatMediator.SV.CHAT)}},n.prototype.BroadcastMsgProcess=function(e){var t=new d.SChatMsg(e);return t.content=t.content.replace(/#324450/g,"#ffffff"),t.content=t.content.replace(/#007fba/g,"#00d8ff"),t.content=t.content.replace(/#00984b/g,"#ffde00"),t},n.prototype.onReceiveMsg=function(e){if(e){this.log("收到新消息",e);var t=!1;if(e.ShowType!=SystemMessageShow.Broadcast&&e.ShowType!=SystemMessageShow.BroadChatChannel||(e.channelType===EChatChannelType.EChatChannelTypeSystem&&(this.broadcastChatList.push(this.preTreatMsg(e)),this.broadcastChatList.sort(function(e,t){if(e.sendDt-t.sendDt!=0)return t.sendDt-e.sendDt})),this.ChatList[e.channelType].push(e),t=!0),e.channelType==EChatChannelType.EChatChannelTypePrivate){var i=d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N),o=e.fromPlayer.playerId;o==i.playerInfoVO.playerId&&(o=e.toPlayer.playerId),this.setLastPrivateTalk(o,e.sendDt)}e.ShowType!=SystemMessageShow.ChatChannel&&e.ShowType!=SystemMessageShow.BroadChatChannel||t||this.ChatList[e.channelType].push(e),e.channelType!=EChatChannelType.EChatChannelTypePrivate&&this.ChatList[e.channelType].length>this.maxMsgShow&&this.ChatList[e.channelType].splice(0,this.ChatList[e.channelType].length-this.maxMsgShow),this.facade.sendNotification(CN.MAIN_CHAT_UPDATE,e);var n=e.channelType;if(!this.noticesTag[n]&&n!=EChatChannelType.EChatChannelTypeSystem){var a=d.AppFacade.getInstance().retrieveMediator(d.ChatMediator.N).getSubView(d.ChatMediator.SV.CHAT);n==EChatChannelType.EChatChannelNewZone&&(n=EChatChannelType.EChatChannelTypeZone),a&&n==this.curChannel||(this.noticesTag[n]=!0,NoticeManager.updateNotice(this.channel_2_notice[n],n))}}},n.prototype.setLastPrivateTalk=function(e,t){if(e&&t){var i=!1;for(var o in this.addedPrivatePlayerList){var n=this.addedPrivatePlayerList[o];if(n.baseInfo.playerId==e){n.dt=t,i=!0,this.addedPrivatePlayerList.sort(function(e,t){return t.dt-e.dt}),d.AppFacade.getInstance().sendNotification(CN.MAIN_CHAT_PRIVATEPLAYER_UPDATE);break}}i||this.addPrivatePlayer(e)}else 0<this.addedPrivatePlayerList.length?(this.curPrivateChoseId=this.addedPrivatePlayerList[0].baseInfo.playerId,this.curPrivateChoseName=this.addedPrivatePlayerList[0].baseInfo.name):(this.curPrivateChoseId=void 0,this.curPrivateChoseName=void 0);return this.curPrivateChoseId},n.prototype.addPrivatePlayer=function(e){var t=this;e&&Utils.Socket.send("chat","AddChatList",{tPlayerId:e}).then(function(e){t.updateResentPrivatePlayer(e.chatList)})},n.prototype.removePrivateChatPlayer=function(e){var t=this;e&&Utils.Socket.send("chat","RemoveChatList",{tPlayerId:e}).then(function(e){t.updateResentPrivatePlayer(e.chatList)})},n.prototype.updateResentPrivatePlayer=function(o,e){var n=this;this.addedPrivatePlayerList=[];var t=[],i=d.AppFacade.getInstance().retrieveProxy(d.FriendPy.N);for(var a in o.sort(function(e,t){return e.dt-t.dt}),o.length>this.maxPrivatePlayerNum&&o.splice(0,o.length-this.maxPrivatePlayerNum),o){var r=o[a];i.isInBlacklist(r.playerId)||t.push(r.playerId)}d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N).GetPublicPlayerBaseInfo(t,function(e,t){for(var i in e)e[i].dt=o[i].dt,n.addedPrivatePlayerList.push(e[i]);n.addedPrivatePlayerList.sort(function(e,t){return t.dt-e.dt}),n.setLastPrivateTalk(),d.AppFacade.getInstance().sendNotification(CN.MAIN_CHAT_UPDATE),d.AppFacade.getInstance().sendNotification(CN.MAIN_CHAT_PRIVATEPLAYER_UPDATE)})},n.prototype.getPrivateChatPlayerList=function(){var e=[],t=d.AppFacade.getInstance().retrieveProxy(d.FriendPy.N);for(var i in this.addedPrivatePlayerList){var o=this.addedPrivatePlayerList[i];t.isInBlacklist(o.baseInfo.playerId)||e.push(o)}return e},n.prototype.getDataProvider=function(t,i,e){var o=new Array,n=d.AppFacade.getInstance().retrieveProxy(d.FriendPy.N),a=d.Config.broadcastConfig();t==EChatChannelType.SameServer?(d.GameMVC.loginPy,this.ChatList[EChatChannelType.EChatChannelTypeSystem].forEach(function(e){e.broadcastId&&a[e.broadcastId]?0<=JSON.parse(a[e.broadcastId].channel).indexOf(EChatChannelType.EChatChannelTypeSystem)&&o.push(e):o.push(e)}),this.ChatList[t].forEach(function(e){o.push(e)})):t==EChatChannelType.EChatChannelTypePrivate?this.ChatList[EChatChannelType.EChatChannelTypePrivate].forEach(function(e){(e.fromPlayer&&e.fromPlayer.playerId==i||e.toPlayer&&e.toPlayer.playerId==i)&&o.push(e)}):t==EChatChannelType.EChatChannelTypeZone?(this.ChatList[EChatChannelType.EChatChannelTypeZone].forEach(function(e){o.push(e)}),this.ChatList[EChatChannelType.EChatChannelNewZone].forEach(function(e){o.push(e)}),this.ChatList[EChatChannelType.EChatChannelTypeSystem].forEach(function(e){e.broadcastId&&a[e.broadcastId]&&0<=JSON.parse(a[e.broadcastId].channel).indexOf(t)&&o.push(e)})):(this.ChatList[EChatChannelType.EChatChannelTypeSystem].forEach(function(e){e.broadcastId&&a[e.broadcastId]&&0<=JSON.parse(a[e.broadcastId].channel).indexOf(t)&&o.push(e)}),this.ChatList[t].forEach(function(e){o.push(e)}));var r=new Array;for(var s in o){var c=o[s];c.fromPlayer&&(n.isInBlacklist(c.fromPlayer.playerId)||0<=this.serverBlackList.indexOf(c.fromPlayer.playerId))||r.push(c)}r.sort(function(e,t){return e.sendDt-t.sendDt});var l=parseInt(d.Config.constConfig().SystemMessageShowMax.constValue);return r.length>l&&(r=r.slice(r.length-l)),r},n.prototype.getChatList=function(n,a){var r=this,e=0;for(var t in this.ChatList[n]){var i=this.ChatList[n][t].msgId;e=i<e?e:i}Utils.Socket.send("chat","GetChatList",{msgId:e,channelType:n}).then(function(e){r.ChatList[n].splice(0,r.ChatList[n].length);for(var t=0,i=e.messageList;t<i.length;t++){var o=i[t];r.ChatList[n].push(r.preTreatMsg(o))}r.ChatList[n].sort(function(e,t){return e.sendDt-t.sendDt}),n==EChatChannelType.EChatChannelTypePrivate&&r.updateResentPrivatePlayer(e.chatList),a&&a(e)}).catch(function(e){})},n.prototype.deleteChatList=function(e){for(var t in this.ChatList){var i=this.ChatList[t],o=!1;for(var n in i){var a=i[n];for(var r in e){var s=e[r];if(a.msgId==s){i.splice(parseInt(n),1),o=!0;break}}if(o)break}}},n.prototype.getMyCoordinateInfo=function(e){if(this.coordinateBases[e])return this.coordinateBases[e].me},n.prototype.getOtherCoordinateInfo=function(e){if(this.coordinateBases[e])return this.coordinateBases[e].others},n.prototype.updateCoordinate=function(e,t){if(Array.isArray(t)){this.coordinateBases[e]||(this.coordinateBases[e]={me:void 0,others:new Array});for(var i=this.coordinateBases[e].others,o=0,n=0,a=t;n<a.length;n++){var r=a[n];if(r.playerBaseInfo&&r.playerBaseInfo.playerId){if(r.playerBaseInfo.playerId==this.playerProxy.playerInfoVO.playerId){this.coordinateBases[e].me||(this.coordinateBases[e].me=new d.SCoordianteBase),this.coordinateBases[e].me.update(r),this.coordinateBases[e].me.amILeader=!0;continue}}else{var s=!1;r.team.leader==this.playerProxy.playerInfoVO.playerId&&(s=!0);for(var c=0,l=r.team.members;c<l.length;c++)l[c].baseInfo.playerId!=this.playerProxy.playerInfoVO.playerId||(this.coordinateBases[e].me||(this.coordinateBases[e].me=new d.SCoordianteBase),this.coordinateBases[e].me.update(r),this.coordinateBases[e].me.amILeader=s)}i[o]?i[o].update(r):i.push(new d.SCoordianteBase(r)),o++}i.splice(o),d.AppFacade.getInstance().sendNotification(CN.MAIN_COORDINATEINFO_UPDATE,{type:e})}},n.prototype.GetCoordinateInfo=function(t,i){var o=this;Utils.Socket.send("coordinate","GetCoordinateInfo",{type:t}).then(function(e){o.updateCoordinate(t,e.infos),i&&i()})},n.prototype.SyncCoordinateInfo=function(e,t,i,o,n){var a=this,r=this.getMyCoordinateInfo(o);if(r&&r.amILeader){var s={x:null==e?r.coordinate.x:Number(e),y:null==t?r.coordinate.y:Number(t),z:null==i?r.coordinate.z:Number(i)};Utils.Socket.send("coordinate","SyncCoordinateInfo",{type:o,coordinate:s}).then(function(e){var t=a.getMyCoordinateInfo(o);t.coordinate.x=s.x,t.coordinate.y=s.y,t.coordinate.z=s.z,d.AppFacade.getInstance().sendNotification(CN.MAIN_COORDINATEINFO_UPDATE,{type:o}),n&&n()})}else console.log("C2S同步坐标失败!")},n.N="MainProxy",n);function n(){var e,t=o.call(this,n.N)||this;for(var i in t.scheId=void 0,t.maxMsgShow=15,t.curChannel=EChatChannelType.SameServer,t.serverBlackList=[],t.maxPrivatePlayerNum=20,t.addedPrivatePlayerList=[],t.playerProxy=d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N),t.fightPy=d.AppFacade.getInstance().retrieveProxy(d.FightPy.N),t.noticesTag={},t.channel_2_notice=((e={})[EChatChannelType.SameServer]=NT.CHAT_SAME_SERVER,e[EChatChannelType.EChatChannelTypeGuild]=NT.CHAT_GUILD,e[EChatChannelType.EChatChannelTypeZone]=NT.CHAT_ZONE,e[EChatChannelType.EChatChannelTypePrivate]=NT.CHAT_PRIVATE,e),t.ChatList=new Array,t.ChatList.push(new Array),EChatChannelType)t.ChatList.push(new Array);return t.broadcastChatList=new Array,t.coordinateBases={},NoticeManager.setChildType(NT.CHAT_MAIN,[NT.CHAT_GUILD,NT.CHAT_PRIVATE,NT.CHAT_SAME_SERVER,NT.CHAT_ZONE]),NoticeManager.setChildType(NT.CHAT_MAIN2,[NT.CHAT_GUILD,NT.CHAT_PRIVATE,NT.CHAT_SAME_SERVER,NT.CHAT_ZONE]),NoticeManager.registerCB([NT.CHAT_GUILD],function(){return d.GameMVC.guildPy.isInGuild()&&t.checkNotice(EChatChannelType.EChatChannelTypeGuild)},t,MODULE.Chat),NoticeManager.registerCB([NT.CHAT_PRIVATE],function(){return t.checkNotice(EChatChannelType.EChatChannelTypePrivate)},t,MODULE.Chat),NoticeManager.registerCB([NT.CHAT_SAME_SERVER],function(){return t.checkNotice(EChatChannelType.SameServer)},t,MODULE.Chat),NoticeManager.registerCB([NT.CHAT_ZONE],function(){return t.checkNotice(EChatChannelType.EChatChannelTypeZone)},t,MODULE.Chat),t}d.MainPy=e,__reflect(e.prototype,"game.MainPy")}(game=game||{}),function(l){var t,e=(__extends(i,t=BaseView),i.prototype.getBtnByModule=function(e){switch(e){case"CITY":return this.gp_bottom.$children[1];case"HERO":return this.gp_bottom.$children[2];case"GUAJI":return this.gp_bottom.$children[3];case"BACKPACK":return this.gp_bottom.$children[4];case"GUILD":return this.gp_bottom.$children[5];case"ALL":return this.gp_bottom.$children;default:return}},i.prototype.getParentView=function(){return GameRootLayer.gameLayer().mainLayer},i.prototype.addNotice=function(){var e=this.getBtnByModule("GUAJI");this.resFullImg.right=-10,this.resFullImg.visible=!1,e&&e.addChild(this.resFullImg),NoticeManager.addNoticeListener(NT.FRIEND,this.btn_haoyou.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.TASK_ENTRANCE,this.btn_task.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.MAIL,this.bnt_mail.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.SECOND_ACHIEVEMENT,this.btn_achieve.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.CHAT_MAIN,this.btn_chat.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.CHAT_MAIN2,this.btn_chat2.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.GUAJI_MULTI,this.btn_multi_guaji.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.GUAJI_GZGZH,this.btn_gzgzh.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.GUAJI_GZGZH2,this.btn_gzgzh2.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.GOLDHAND,this.cu_resBar,this,{percentX:175/406,percentY:-.06}),NoticeManager.addNoticeListener(NT.VIP_ENTRANCE,this.cu_resBar,this,{percentX:379/406,percentY:-.06})},i.prototype.updateGuajiNotice=function(e){if(e){var t=l.AppFacade.getInstance().retrieveMediator(l.GuajiMediator.N).getSubView(l.GuajiMediator.SV.MAIN);t&&t.visible?this.resFullImg.visible=!1:this.resFullImg.visible=!0}else this.resFullImg.visible=!1},i.prototype.vipEffect=function(e){var t;5<e&&e<12?t=this.VIP_CONFIG[1]:12<=e&&(t=this.VIP_CONFIG[2]),5<e&&(!this.effect||this.vip&&this.vip!=t?(this.gp_effect.removeChildren(),MovieClipTools.create(t,function(e){this.effect=e,this.effect.x=this.gp_effect.width/2,this.effect.y=this.gp_effect.height/2,this.effect.visible=!0,this.effect.animation.play(t,0),this.effect.animation.timeScale=1,this.gp_effect.addChild(this.effect)},this)):this.effect.animation.play(t,0)),this.vip=t},i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_head),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top_right),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top_right2),Utils.DeviceUtils.setLiuHaiPingAdapter(this.vs_top_left),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top_left2),this.gp_plug.parent.removeChild(this.gp_plug),GameRootLayer.gameLayer().popMsgLayer.addChild(this.gp_plug),this.btn_plug.parent.removeChild(this.btn_plug),GameRootLayer.gameLayer().loadLayer.addChild(this.btn_plug),this.lb_serTime.parent.removeChild(this.lb_serTime),GameRootLayer.gameLayer().loadLayer.addChild(this.lb_serTime),this.btn_record.parent.removeChild(this.btn_record),GameRootLayer.gameLayer().loadLayer.addChild(this.btn_record),this.sl_inputs.verticalScrollBar.visible=!1,this.sl_inputs.verticalScrollBar.autoVisibility=!1,Utils.DebugUtils.isDebug&&!getUrlKV().banshu?(this.btn_plug.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.changePlugFloatView(!this.gp_plug.visible)},this),this.btn_close_plug.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.changePlugFloatView(!this.gp_plug.visible)},this)):this.btn_plug.visible=!1,Utils.agentConfig.isChecking&&Utils.agentConfig.isChecking.needRecord?this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,this.record,this):this.btn_record.visible=!1,this.btn_vip.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.MainJumpConfig.jumpTo(MODULE.VIP)},this),this.gp_avatar.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.AppFacade.getInstance().showSubView(l.PlayerMediator.N,l.PlayerMediator.SV.MAIN)},this),this.bnt_mail.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.AppFacade.getInstance().showSubView(l.MailMediator.N,l.MailMediator.SV.MAIN)},this),this.btn_achieve.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.AppFacade.getInstance().showSubView(l.TaskMediator.N,l.TaskMediator.SV.SECOND_ACHIEVEMENT)},this),this.btn_chat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.UnlockMgr.checkPass(MODULE.Chat).allow&&l.AppFacade.getInstance().showSubView(l.ChatMediator.N,l.ChatMediator.SV.CHAT,{NextChannelType:EChatChannelType.SameServer})},this),this.btn_chat2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.UnlockMgr.checkPass(MODULE.Chat).allow&&l.AppFacade.getInstance().showSubView(l.ChatMediator.N,l.ChatMediator.SV.CHAT,{NextChannelType:EChatChannelType.SameServer})},this),Utils.SDKMgr.getPerformConfig(200002)?(this.btn_gzgzh.visible=this.btn_gzgzh2.visible=!0,this.btn_gzgzh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.GameMVC.activityMed.showViewByCode(EActivityType.GuanZhuGongZhongHao)},this),this.btn_gzgzh2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.GameMVC.activityMed.showViewByCode(EActivityType.GuanZhuGongZhongHao)},this)):(this.btn_gzgzh.height=this.btn_gzgzh2.height=0,this.btn_gzgzh.visible=this.btn_gzgzh2.visible=!1),Utils.SDKMgr.getPerformConfig(40)?(this.btn_multi_guaji.visible=!0,this.btn_multi_guaji.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.UnlockMgr.checkPass(MODULE.RiskMulti).allow&&l.AppFacade.getInstance().showSubView(l.GuajiMediator.N,l.GuajiMediator.SV.MULTI)},this)):(this.btn_multi_guaji.height=0,this.btn_multi_guaji.visible=!1),this.btn_haoyou.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.AppFacade.getInstance().showSubView(l.FriendMediator.N,l.FriendMediator.SV.MAIN)},this),this.btn_paihangbang.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.MainJumpConfig.jumpTo(MODULE.Ranking)},this),this.btn_strong.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.AppFacade.getInstance().showSubView(l.StrongMediator.N,l.StrongMediator.SV.MAIN)},this),this.btn_task.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.AppFacade.getInstance().showSubView(l.TaskMediator.N,l.TaskMediator.SV.MAIN)},this),Utils.SDKMgr.getPerformConfig(6)?this.gp_bottom.getChildAt(3).icon="_main_m_json.common_icon_zhutubiao_maoxian2":this.effectChuanSongMen?this.effectChuanSongMen.animation.play("common_patachuansongmen",0):DragonBoneTools.create("common_patachuansongmen",function(e){this.effectChuanSongMen=e,this.effectChuanSongMen.x=360,this.effectChuanSongMen.y=35,this.effectChuanSongMen.visible=!0,this.effectChuanSongMen.animation.timeScale=1,this.effectChuanSongMen.animation.play("common_patachuansongmen",0),this.gp_bottom.addChildAt(this.effectChuanSongMen,-1)},this,{groupName:"GuajiFixed"}),Utils.DebugUtils.setNeedDebugTools(this.btn_plug.visible),Utils.DeviceUtils.setBottomAdapter(this.gp_bottom),this.validateNow(),this.addNotice(),Utils.SDKMgr.getPerformConfig(2)&&(this.btn_chat.visible=this.btn_chat2.visible=!1),Utils.SDKMgr.getPerformConfig(200008)&&(this.btn_gzgzh.label=this.btn_gzgzh2.label=Utils.SDKMgr.getPerformConfig(200008)),egret.setTimeout(function(){GameRootLayer.gameLayer().onEnterMain()},this,500),Utils.SDKMgr.cmd({type:"CheckRecharge",level:this.playerProxy.playerInfoVO.level},function(){e.updatePlayerInfo()})},i.prototype.changeStyle=function(e){var t=this;this.curUIStyle=e,egret.Tween.removeTweens(this.gp_head),egret.Tween.removeTweens(this.vs_top_left),egret.Tween.removeTweens(this.gp_top_left2),egret.Tween.removeTweens(this.gp_bottom_left),egret.Tween.removeTweens(this.gp_bottom_right),egret.Tween.removeTweens(this.gp_top_right),egret.Tween.removeTweens(this.gp_top_right2),egret.Tween.removeTweens(this.gp_top),null==this.gp_head.originY&&(this.gp_head.originY=this.gp_head.y),this.gp_head.y=this.gp_head.originY,this.vs_top_left.x=0,1&e?this.gp_head.visible||(this.gp_head.visible=!0,UIActionManager.playUIAction(this.gp_head,5)):this.gp_head.visible=!1,this.gp_bottom.visible=!!(2&e),8&e?this.gp_top.visible||(this.gp_top.visible=!0,this.gp_top_right.visible=!0,this.gp_top_right2.visible=!0,UIActionManager.playUIAction(this.gp_top,4),UIActionManager.playUIAction(this.gp_top_right,4),UIActionManager.playUIAction(this.gp_top_right2,4)):this.gp_top.visible&&(this.gp_top.visible=!1,this.gp_top_right.visible=!1,this.gp_top_right2.visible=!1),32&e?this.gp_bottom_right.visible||(this.gp_bottom_right.visible=!0,UIActionManager.playUIAction(this.gp_bottom_right,4)):this.gp_bottom_right.visible&&(this.gp_bottom_right.visible=!1),32&e?this.gp_bottom_right.visible||(this.gp_bottom_right.visible=!0,UIActionManager.playUIAction(this.gp_bottom_right,4)):this.gp_bottom_right.visible&&(this.gp_bottom_right.visible=!1),16&e?(this.vs_top_left.visible||(this.vs_top_left.visible=!0,UIActionManager.playUIAction(this.vs_top_left,3)),this.gp_top_left2.visible||(this.gp_top_left2.visible=!0,UIActionManager.playUIAction(this.gp_top_left2,3)),this.gp_bottom_left.visible||(this.gp_bottom_left.visible=!0,UIActionManager.playUIAction(this.gp_bottom_left,3))):(this.vs_top_left.visible=!1,this.gp_top_left2.visible=!1,this.gp_bottom_left.visible=!1,this.gp_bottom_right.visible=!1),64&e?("GUAJI"===l.MainJumpConfig.lastEvent?(this.gp_bottom_banner.bottom=void 0,this.gp_bottom_banner.top=(Utils.SDKMgr.getPerformConfig(6)?280:400)+Utils.DeviceUtils.statusBarHeight):(this.gp_bottom_banner.top=void 0,this.gp_bottom_banner.bottom=270),this.gp_bottom_banner.visible||(this.gp_bottom_banner.visible=!0,UIActionManager.playUIAction(this.gp_bottom_banner,4))):this.gp_bottom_banner.visible&&(this.gp_bottom_banner.visible=!1),this.gp_top.visible&&this.gp_top_right.visible&&this.updateNotice(),egret.setTimeout(function(){t.setGuideAvailable()},this,UIActionManager.POP_ACTION_SPEED)},i.prototype.updatePlayerInfo=function(){var e=this.playerProxy.playerInfoVO;if(e){this.btn_vip.labelDisplay.text=String(e.playerVip.vipLevel),this.vipEffect(e.playerVip.vipLevel),this.lb_name.text=e.name,this.blb_level.text=""+e.level.toString(),this.blb_fightCap.text=e.fightCap.toString(),this.gp_avatar.removeChildren(),this.cu_ph.updateData({vo:this.playerProxy.playerInfoVO,ignoreLevel:1,effect:!0});var t=l.Config.playerLevelUpgrade(),i=t[e.level],o=Number(l.Config.constConfig().maxLevel.constValue);t[e.level+1],this.pb_exp.minimum=0,e.exp<i.exp?(this.pb_exp.maximum=i.exp,this.pb_exp.value=e.exp):e.level>=o&&(this.pb_exp.maximum=100,this.pb_exp.value=100);var n=[EPropertyType.EPropertyTypeGold,EPropertyType.EPropertyTypeDiamond];this.cu_resBar.updateBar({costs:n,width:190,needAdd:!0})}},i.prototype.record=function(){var t=this,e="begin",i=Utils.TimerManager.getServerTime();i-this.lastRecordTime<1||(this.lastRecordTime=i,l.SystemSettingPanel.isRecording&&(e="end"),"begin"==e?(this.btn_record.label="录制中",Utils.SDKMgr.cmd({type:"VideoRecord",recordType:"begin",thisObj:this},function(e){t.btn_record.label="录制",l.SystemSettingPanel.isRecording=!1,e?Utils.MsgUtils.addMidMsg(e):Utils.MsgUtils.addMidMsg("录屏失败")}),l.SystemSettingPanel.isRecording=!0):(this.btn_record.label="录制",Utils.SDKMgr.cmd({type:"VideoRecord",recordType:e,thisObj:this},function(e){e?Utils.MsgUtils.addMidMsg(e):Utils.MsgUtils.addMidMsg("录屏失败")}),l.SystemSettingPanel.isRecording=!1))},i.prototype.changePlugFloatView=function(e){if(this.gp_plug.visible=e){var c=new eui.Group,t=new eui.VerticalLayout;t.paddingTop=10,t.paddingBottom=10,t.paddingLeft=20,t.paddingTop=20,c.layout=t,this.sl_inputs.viewport=c,this.sl_inputs.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_inputs.scrollPolicyV=eui.ScrollPolicy.ON,this.PLUG_CONFIG.forEach(function(n,e){var a=new eui.Group;a.percentWidth=100;var t=new eui.TileLayout;t.verticalAlign=egret.VerticalAlign.MIDDLE,t.horizontalAlign=egret.HorizontalAlign.LEFT,t.horizontalGap=5,t.requestedColumnCount=4,a.layout=t;var r=new eui.Label;if(r.stroke=2,r.size=24,r.text=n.pb,a.addChild(r),n.inputs)for(var i in n.inputs){var o=new eui.EditableText;o.prompt=n.inputs[i][0],o.size=24,o.width=80,o.name=n.inputs[i][0],o.text=n.inputs[i][2]?n.inputs[i][2]:"",a.addChild(o)}var s=new eui.Button;s.width=60,s.height=44,s.label="ok",s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),n.inputs){var e={},t=!0;for(var i in n.inputs){var o=a.getChildByName(n.inputs[i][0]).text;if("协议测试"!=n.pb&&(a.getChildByName(n.inputs[i][0]).text=""),""===o){UIActionManager.blink(a.getChildByName(n.inputs[i][0])),Utils.MsgUtils.addMidMsg("请输入内容"),t=!1;break}"number"==n.inputs[i][1]?e[n.inputs[i][0]]=Number(o):e[n.inputs[i][0]]=o}t&&(n.cb?n.cb(e,r):"协议测试"===n.pb?Utils.Socket.send(e.pb1Str,e.pb2Str,JSON.parse(e.jsonParams)):"铁匠铺"===n.pb?Utils.Socket.send("smithy","SmithyForgeIron",e).then(function(e){l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N).handleClientReward(e.rewardPreview)}):Utils.Socket.send("test",n.pb,e))}else n.cb&&n.cb.call()},this),a.addChild(s),c.addChild(a)})}else this.sl_inputs.removeChildren()},i.prototype.initServerTimeSche=function(){var e=this;if(!this.serverTimeSche){var t=new Date;this.serverTimeSche=egret.setInterval(function(){e.lb_serTime.visible&&(t.setTime(1e3*Utils.TimerManager.getServerTime(!1)),e.lb_serTime.text=t.format("yyyy/M/d hh:mm:ss"),e.lb_serTime.text+="\n星期"+(t.getDay()||7))},this,1e3)}},i);function i(){var a=t.call(this)||this;return a.resFullImg=new eui.Image("_main_m_json.maoxian_icon_man"),a.lastRecordTime=0,a.isHasClosePet=!1,a.playerProxy=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),a.loginPy=l.AppFacade.getInstance().retrieveProxy(l.LoginPy.N),a.VIP_CONFIG={1:"common_VIPhuizhang",2:"common_VIPhuizhang2"},a.PLUG_CONFIG=[{pb:"打开德扑",cb:function(){a.changePlugFloatView(!a.gp_plug.visible),l.MainJumpConfig.jumpTo(MODULE.Cardgame)}},{pb:"AddRaceTowerCount",inputs:[["count","number"]]},{pb:"变成回归",inputs:[],cb:function(e){l.GameMVC.activityPy.DoCommonOperation(EActivityType.Regression,1,3)}},{pb:"显示服务器时间",cb:function(){l.AppFacade.getInstance().sendNotification(CN.MAIN_DEBUG_INFO_UPDATE,{serverTime:!0})}},{pb:"上报性能信息",cb:function(){a.changePlugFloatView(!a.gp_plug.visible);if(egret.Tween._tweens&&Array.isArray(egret.Tween._tweens)){"缓动数量:"+egret.Tween._tweens.length;for(var e=0,t=0,i=egret.Tween._tweens;t<i.length;t++){var o=i[t];o._target.stage||(e++,egret.Tween.removeTweens(o._target))}"_清空数量:"+e}DragonBoneTools.dbStatus()}},{pb:"_d",inputs:[["name","string"]],cb:function(e){var t=e.name,i=Utils.ComponentUtils.getComponentByName(t);i?(Utils.MsgUtils.addMidMsg("Done."),window._d=i):Utils.MsgUtils.addMidMsg("无效控件名")}},{pb:"战斗测试",cb:function(){a.changePlugFloatView(!a.gp_plug.visible),l.MainJumpConfig.jumpTo("FIGHT_TEST",!1,{type:l.FightTestInput.FIGHT_TYPE.REGULAR})}},{pb:"打开战斗跳过",cb:function(){l.AppFacade.getInstance().retrieveProxy(l.FightPy.N).forceCanSkip=!0}},{pb:"【快捷操作】一堆经验",inputs:[],cb:function(e){for(var t in EExpType){var i=EExpType[t];Utils.Socket.send("test","addExp",{code:i,num:99999999999}).then(function(e){})}}},{pb:"【快捷操作】一堆钱",inputs:[],cb:function(e){for(var t in EPropertyType){var i=EPropertyType[t];Utils.Socket.send("test","addMoney",{code:i,num:999999999}).then(function(e){})}}},{pb:"【快捷操作】\n1:全套神器\n2:全套装备\n3:全套宝物+宝石\n9:王+一堆培养材料+经验",inputs:[["type","string"]],cb:function(e){if(1==e.type){var t=l.Config.getHeroArtifactConfig();for(var i in t)Utils.Socket.send("test","addHeroArtifact",{code:Number(i),num:2==t[i].type?1e5:1})}else if(2==e.type){t=l.Config.getHeroEquipConfig();for(var i in t)Utils.Socket.send("test","addHeroEquip",{code:Number(i),num:1})}else if(3==e.type){t=l.Config.getHeroTreasureConfig();for(var i in t)Utils.Socket.send("test","addTreasure",{code:Number(i),num:1});Utils.Socket.send("test","addItem",{code:Number(30000009),num:100}),Utils.Socket.send("test","addItem",{code:Number(30000010),num:100}),Utils.Socket.send("test","addItem",{code:Number(30000011),num:100}),Utils.Socket.send("test","addItem",{code:Number(30000012),num:100})}else 9==e.type&&(Utils.Socket.send("test","addHeroNew",{code:41000001,num:1}),Utils.Socket.send("test","addItem",{code:30000001,num:1e8}),Utils.Socket.send("test","addItem",{code:30000002,num:1e8}),Utils.Socket.send("test","addItem",{code:30000003,num:1e8}),Utils.Socket.send("test","addItem",{code:30000004,num:1e8}),Utils.Socket.send("test","addItem",{code:30000005,num:1e8}),Utils.Socket.send("test","addMoney",{code:1,num:1e8}),Utils.Socket.send("test","addMoney",{code:2,num:1e8}))}},{pb:"【快捷操作】按品质加神器",inputs:[["color","number"]],cb:function(t){function e(e){i[e].color==t.color&&(egret.setTimeout(function(){Utils.Socket.send("test","addHeroArtifact",{code:Number(e),num:2==i[e].type?1e5:1})},a,100*o),o++)}var i=l.Config.getHeroArtifactConfig(),o=0;for(var n in i)e(n)}},{pb:"指定装备",inputs:[["code","number"],["num","number"],["level","number"],["attachLevel","number"],["quenchceLevel","number"]],cb:function(e){Utils.Socket.send("test","AddSpecialHeroEquip",{code:e.code,num:e.num,level:e.level,attachLevel:e.attachLevel,quenchceLevel:e.quenchceLevel}).then(function(e){l.GameMVC.heroThingPy.updateEquipInfo(e.equipList,!1)})}},{pb:"【快捷操作】全套不朽神兵",inputs:[],cb:function(e){var t=l.Config.immortalConfig(),i=[];for(var o in t){var n=t[o];i.push([EEntityType.EEntityTypeImmortal,n.subType,100])}Utils.Socket.send("test","AddRewards",JSON.stringify(i))}},{pb:"【快捷操作】直接上王",inputs:[],cb:function(e){Utils.Socket.send("test","addHeroNew",{code:41000001,num:1}).then(function(e){for(var t=l.AppFacade.getInstance().retrieveProxy(l.HeroPy.N),i=0,o=1;o<=6;o++)if(!t.heroUuid22Pos[o]){i=o;break}i&&t.HeroPutOn({uuid:e.clientReward.heros[0].uuid,pos:i})})}},{pb:"【快捷操作】全套N星英雄",inputs:[["N","number"]],cb:function(e){var t=l.Config.allHeroConfig();for(var i in t){var o=t[i];o.initStar==e.N&&Utils.Socket.send("test","addHeroNew",{code:o.code,num:1}).then(function(e){})}}},{pb:"【快捷操作】宠物各N只",inputs:[["num","number"]],cb:function(e){var t=l.Config.allPetConfig(),i=[];for(var o in t){var n=t[o];i.push([10,n.code,e.num])}Utils.Socket.send("test","AddRewards",{rewards:JSON.stringify(i)}).then(function(e){})}},{pb:"【快捷操作】一键英雄999",inputs:[],cb:function(e){Utils.Socket.send("test","UpHeroMax",{})}},{pb:"【快捷操作】冒险进入下一层",inputs:[],cb:function(e){Utils.Socket.send("test","EnterNextLayer",{})}},{pb:"【快捷操作】冒险进入上一层",inputs:[],cb:function(e){Utils.Socket.send("test","EnterPreLayer",{})}},{pb:"【快捷操作】完成冒险主线任务",inputs:[],cb:function(e){Utils.Socket.send("test","RiskTaskUnlock",{})}},{pb:"提取当前窗口条件配置",inputs:[],cb:function(e){a.changePlugFloatView(!a.gp_plug.visible);var t="["+GuideConditionSubType.VIEW_STACK+", ["+GameRootLayer.gameLayer().getViewStackJsonStr()+"]";a.log("提取当前窗口条件配置",t)}},{pb:"addExp",inputs:[["code","number"],["num","number"]]},{pb:"addMoney",inputs:[["code","number"],["num","number"]]},{pb:"addItem",inputs:[["code","number"],["num","number"]]},{pb:"AddRewards",inputs:[["rewards","string"]]},{pb:"AddVestageItem",inputs:[["code","number"],["num","number"]]},{pb:"addHeroNew",inputs:[["code","number"],["num","number"]]},{pb:"addHeroEquip",inputs:[["code","number"],["num","number"]]},{pb:"addHeroArtifact",inputs:[["code","number"],["num","number"]]},{pb:"测试跳转",inputs:[["jumpModule","number"]],cb:function(e){a.changePlugFloatView(!a.gp_plug.visible),l.MainJumpConfig.jumpTo(e.jumpModule,void 0,e.jumpModuleParams)}},{pb:"AddAttr",inputs:[["pos","number"],["attrs","string"]]},{pb:"AddSpecialImmortal",inputs:[["code","number"],["sectionLevel","number"],["slotNum","number"],["num","number"]]},{pb:"UpdateZoneBossPro",inputs:[["type","number"],["value","number"]]},{pb:"ZoneBossAutoNextRound",inputs:[]},{pb:"SetVipLevel",inputs:[["code","string"]]},{pb:"SendSystemMail",inputs:[["key","string","1"],["propertys","string","[]"],["attachs","string","[]"]]},{pb:"AddRiskMap",inputs:[["code","number"],["num","number"]]},{pb:"riskUnlock",inputs:[]},{pb:"协议测试",inputs:[["pb1Str","string"],["pb2Str","string"],["jsonParams","string"]]},{pb:"铁匠铺",inputs:[["num","number"]]},{pb:"特效测试",inputs:[["fileName","string"],["actionName","string"]],cb:function(e){a.changePlugFloatView(!a.gp_plug.visible),DragonBoneTools.playOnce({effectName:e.fileName,actionName:e.actionName,parent:GameRootLayer.gameLayer().maskLayer,x:Utils.DeviceUtils.curWidth()/2,y:Utils.DeviceUtils.curHeight()/2})}},{pb:"开场动画测试",cb:function(){a.gp_plug.visible=!1,PopUpManager.addPopUp({effectType:0,obj:new l.StartAnimation})}},{pb:"自走棋战斗测试",cb:function(){a.changePlugFloatView(!a.gp_plug.visible),l.MainJumpConfig.jumpTo("FIGHT_TEST",!1,{type:l.FightTestInput.FIGHT_TYPE.CHESS})}},{pb:"对话框测试",inputs:[["storyId","number"],["questionId","number"]],cb:function(e){PopUpManager.addPopUp({obj:new l.StoryView({storyId:e.storyId,questionId:e.questionId,cb:function(){}})})}},{pb:"新手.获取控件名",inputs:[],cb:function(e){var t="GUIDE_COMP_GET";Utils.TouchUtils.hasGlobalTouch(t)?Utils.TouchUtils.removeGlobalTouch(t):Utils.TouchUtils.addGlobalTouch(function(e){a.log("当前点击target：",e.target);var t=l.AppFacade.getInstance().retrieveProxy(l.GuidePy.N).checkComponentName(e.target);-1!=t.indexOf("#")?a.log("      【GUIDE】view：",t.split("#")[0],"控件名：",t):a.log("      【GUIDE】",t)},t)}},{pb:"部落争霸增加积分",inputs:[["grade","number"]],cb:function(e){Utils.Socket.send("test","AddTribeBattleIntegral",{num:e.grade})}},{pb:"自走棋战斗恢复正常速度",inputs:[],cb:function(e){l.GameMVC.zzqPy.debug_slowFight=!0}},{pb:"自走棋加钱",inputs:[["num","number"]],cb:function(e){Utils.Socket.send("test","AddWchessMoney",{num:e.num})}},{pb:"自走棋加英雄",inputs:[["code","number"],["num","number"]],cb:function(e){Utils.Socket.send("test","AddWchessHero",{code:e.code,num:e.num})}},{pb:"自走棋增加段位积分",inputs:[["grade","number"]],cb:function(e){Utils.Socket.send("test","AddWchessGrade",{num:e.grade})}},{pb:"自走棋成就奖杯",inputs:[["code","number"],["tp","number"],["key","number"]],cb:function(e){Utils.Socket.send("test","DoneWchessAchieve",{code:e.code,tp:e.tp,key:e.key})}},{pb:"矿战增加行动力",inputs:[["num","number"]],cb:function(e){Utils.Socket.send("test","AddManorWalkNum",{num:e.num})}},{pb:"矿战刷新矿",inputs:[],cb:function(e){Utils.Socket.send("test","RefreshManor",{})}},{pb:"矿战增加机器人",inputs:[["guildId","number"],["num","number"]],cb:function(e){Utils.Socket.send("test","AddManorRobot",{guildId:e.guildId,num:e.num})}},{pb:"【测试】部落争霸开启",inputs:[],cb:function(e){Utils.Socket.send("test","OpenTribeBattle",{}).then(function(){Utils.MsgUtils.addMidMsg("已开启")})}},{pb:"【测试】部落争霸关闭",inputs:[],cb:function(e){Utils.Socket.send("test","CloseTribeBattle",{}).then(function(){Utils.MsgUtils.addMidMsg("已关闭")})}},{pb:"公会副本挑战次数",inputs:[["num","number"]],cb:function(e){Utils.Socket.send("test","AddGuildTranscriptChallengeNum",{num:e.num})}},{pb:"【测试】手动进入天梯赛",cb:function(){Utils.Socket.send("test","EnterHighLadder",{}).then(function(e){})}},{pb:"【测试】天梯赛加机器人",cb:function(){Utils.Socket.send("test","PeakWarAddRobot",{}).then(function(e){})}},{pb:"风暴战场添加机器人外挂",cb:function(){Utils.Socket.send("test","AddStormWarRobot",{}).then(function(e){})}},{pb:"遗迹探险指定步数",inputs:[["stepNum","number"]],cb:function(e){Utils.Socket.send("challenge","ThrowDice",{stepNum:e.stepNum}).then(function(e){l.AppFacade.getInstance().updateView(l.HeroChallengeMediator.N,l.HeroChallengeMediator.SV.MAIN,e)})}},{pb:"设置排行榜数据拉取延迟",inputs:[["sec","number"]],cb:function(e){l.AppFacade.getInstance().retrieveProxy(l.RankPy.N).REFRESH_INTERVAL=e.sec}},{pb:"【快捷操作】英雄挑战模式切换",inputs:[],cb:function(e){Utils.Socket.send("test","HeroChallengeNextModel",{})}},{pb:"【快捷操作】英雄挑战跳关",inputs:[["level","number"]],cb:function(e){Utils.Socket.send("test","HeroChallengeJump",{num:e.level})}},{pb:"【快捷操作】组队副本跳关",inputs:[["level","number"]],cb:function(e){Utils.Socket.send("test","SetTeamExpeditionNum",{num:e.level})}},{pb:"【快捷操作】爬塔跳关",inputs:[["level","number"]],cb:function(e){Utils.Socket.send("test","setChampionNum",{num:e.level})}},{pb:"【快捷操作】勇士令状切章节",inputs:[],cb:function(e){Utils.Socket.send("test","DoneAllNewBraveBookTasks",{})}},{pb:"【快捷操作】触发魔神",inputs:[],cb:function(e){Utils.Socket.send("test","TriggerDemon",{}).then(function(){l.GameMVC.guajiPy.GetDemonList()})}},{pb:"【快捷操作】成就加进度",inputs:[["taskSubType","number"],["taskKey","number"]],cb:function(e){Utils.Socket.send("test","HandleUpdateProgress",{taskSubType:e.taskSubType,taskKey:e.taskKey}).then(function(){})}},{pb:"【快捷操作】自走棋提前结束",inputs:[],cb:function(e){Utils.Socket.send("test","FinishWchess",{})}},{pb:"【组队竞技】time",inputs:[],cb:function(e){Utils.Socket.send("test","TeamArenaChangeDt",{})}},{pb:"【组队竞技】生成队伍",inputs:[],cb:function(e){Utils.Socket.send("test","EnrollTeamArena",{})}},{pb:"【组队竞技】拉人",inputs:[],cb:function(e){Utils.Socket.send("test","TeamArenaRandomMember",{})}},{pb:"模块解锁",inputs:[["moduleId","number"]],cb:function(e){Utils.UnlockMgr.forceChangeUnlockInfo(e.moduleId,!0),Utils.Socket.send("test","UnlockModule",{moduleId:e.moduleId})}},{pb:"深渊巢穴开启地图配置模式",inputs:[["mapID","number"]],cb:function(e){l.AppFacade.getInstance().sendNotification(CN.DEEP_NEST_SETPOSBYWAIGUA,{mapId:e.mapID})}},{pb:"微信分享测试",inputs:[["type","number"]],cb:function(e){l.AppFacade.getInstance().retrieveMediator(l.ActivityMediator.N).showViewByCode(EActivityType.WeChatShare,{type:e.type})}},{pb:"模拟超时",cb:function(){Utils.Socket.send("risk","LayerInfoP",{})}},{pb:"【快捷操作】钻石乐透加次数",inputs:[["num","number"]],cb:function(e){Utils.Socket.send("test","AddDiamondLotteryCount",{num:e.num})}},{pb:"显示开服天数",cb:function(){Utils.MsgUtils.addMidMsg(Utils.TimerManager.getServerOpenDays()+"天")}},{pb:"空阵位上阵英雄",cb:function(){var i=l.AppFacade.getInstance().retrieveProxy(l.HeroPy.N),e=[void 0,void 0,void 0,void 0,void 0],o=[];for(var t in i.allHeroByUuid){var n=i.allHeroByUuid[t];n.pos?e[n.pos-1]=t:o.length<5&&o.push(n.uuid)}e.forEach(function(e,t){!e&&0<o.length&&i.HeroPutOn({uuid:o.pop(),pos:t+1})})}},{pb:"模拟报错",cb:function(){(void 0).asdlfjlk=12323}},{pb:"重启游戏",cb:function(){l.GameMgr.getInstance().restart()}},{pb:"清空英雄",cb:function(){Utils.Socket.send("test","ClearHeroBag",{})}}],a.skinName="MainUISkin",a.touchEnabled=!1,a.curUIStyle=65535,Utils.DebugUtils.isDebug&&(window._mainUI=a),a.guideEffectWait=!0,a}l.MainUI=e,__reflect(e.prototype,"game.MainUI")}(game=game||{}),function(e){var i,t=(__extends(o,i=BasePanel),o.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.cb&&this.cb()},o.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap),PopUpManager.removePopUp(this,0)},this),RES.getRes("_login_create_role_m_json.login_img_kaishimaoxian")?this.img_root.source=RES.getRes("_login_create_role_m_json.login_img_kaishimaoxian"):RES.getResAsync("_login_create_role_m_json.login_img_kaishimaoxian",function(e){t.img_root.source=e},this),DragonBoneTools.create("common_zhiyin",function(e){e.x=320,e.y=330,this.gp_root.addChild(e),e.armature.getSlot("shouzhi").getDisplay().visible=!1,e.animation.play("common_zhiyin",-1)},this),GameRootLayer.gameLayer().makeTouchLayer(function(){PopUpManager.removePopUp(t,0)},this,7e3)},o);function o(e){var t=i.call(this)||this;return t.skinName="EnterGuajiPanelSkin",t.cb=e&&e.cb,t}e.EnterGuajiPanel=t,__reflect(t.prototype,"game.EnterGuajiPanel")}(game=game||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.cb&&this.cb()},o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this);var e=t.AppFacade.getInstance().retrieveProxy(t.PlayerPy.N);this.lb_tips.text="恭喜你升到"+e.playerInfoVO.level+"级"},o);function o(e){var t=i.call(this)||this;return t.skinName="LevelUpPanelSkin",t.cb=e&&e.cb,t._popActionType=1,t}t.LevelUpPanel=e,__reflect(e.prototype,"game.LevelUpPanel")}(game=game||{}),function(i){var t,e=(__extends(o,t=BasePanel),o.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.sche&&(egret.clearInterval(this.sche),this.sche=void 0),this.rerunSche&&(egret.clearTimeout(this.rerunSche),this.rerunSche=void 0)},o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.lb_tips.stroke=2,this.lb_tips.strokeColor=0,this.btn_exit.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.lb_tips.visible=!0,this.gp_btns.visible=!1,this.onResume(!0)},this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.GameMgr.getInstance().restart()},this),this.onResume(),this.HeroDynamicModel.update({model:"hero_040_01"})},o.prototype.onResume=function(e){var t=this;if(!this.sche){var i=0;this.sche=egret.setInterval(function(){var e=++i%3;t.lb_tips.text=0==e?"网络重连中.":1==e?"网络重连中..":"网络重连中..."},this,1e3),this.lb_tips.text="网络重连中...",this.checking(e)}this.rerunSche||(this.rerunSche=egret.setTimeout(function(){egret.clearTimeout(t.rerunSche),t.rerunSche=void 0,egret.clearInterval(t.sche),t.sche=void 0,t.lb_tips.text="失去网络连接...",t.gp_btns.visible=!0},this,1e3*this.RERUN_WAIT_TIME))},o.prototype.onPause=function(){this.sche&&(egret.clearInterval(this.sche),this.sche=void 0),this.rerunSche&&(egret.clearTimeout(this.rerunSche),this.rerunSche=void 0)},o.prototype.checking=function(e){var t=i.AppFacade.getInstance().retrieveProxy(i.PlayerPy.N);i.AppFacade.getInstance().retrieveProxy(i.LoginPy.N),201<=t.loginStatusVO.state?Utils.Socket.reconnect(e):i.GameMgr.getInstance().restart()},o.prototype.forceStop=function(){this.visible=!1,this.isForceStop=!0},o);function o(){var e=t.call(this)||this;return e.RERUN_WAIT_TIME=5,e.isForceStop=!1,e.skinName="NetCheckingPanelSkin",e}i.NetCheckingPanel=e,__reflect(e.prototype,"game.NetCheckingPanel")}(game=game||{}),function(e){var i,t=(__extends(o,i=BasePanel),o.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.sche&&(egret.clearInterval(this.sche),this.sche=void 0)},o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.lb_tips.stroke=2,this.lb_tips.strokeColor=0,this.btn_exit.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_exit.label="确 定",this.btn_exit.x=70,this.btn_go.parent.removeChild(this.btn_go),this.gp_btns.visible=!0,this.HeroDynamicModel.update({model:"hero_040_01"});var e=!0;this.params&&this.params.tips&&(this.btn_exit.visible=!1,this.lb_tips.text=this.params.tips,e=!1),e&&this.onResume()},o.prototype.onResume=function(e){var t=this;if(!this.sche){var i=0;this.sche=egret.setInterval(function(){var e=++i%3;t.lb_tips.text=0==e?"抱歉\n \n服务器正在维护中.":1==e?"抱歉\n \n服务器正在维护中..":"抱歉\n \n服务器正在维护中..."},this,1e3),this.lb_tips.text="抱歉\n \n服务器正在维护中...",this.checking(e)}},o.prototype.checking=function(e){},o);function o(e){var t=i.call(this)||this;return t.RERUN_WAIT_TIME=5,t.skinName="NetCheckingPanelSkin",t.params=e,t}e.ServerMaintainView=t,__reflect(t.prototype,"game.ServerMaintainView")}(game=game||{}),function(h){var o,e=(__extends(p,o=BaseMediator),p.prototype.initSubView=function(){this.addSubView(p.SV.MAIN,h.ModuleOpenView)},p.prototype.listNotificationInterests=function(){return[CN.PLAYER_LEVEL_UP,CN.PLAYER_VIP_LEVEL_UP,CN.GENERAL_PASS_DAY,CN.SWITCH_TO_CITY,CN.PLAYER_INFO_UPDATE]},p.prototype.handleNotification=function(e){var t=this;switch(e.getName()){case CN.PLAYER_LEVEL_UP:case CN.PLAYER_VIP_LEVEL_UP:case CN.GENERAL_PASS_DAY:case CN.SWITCH_TO_CITY:if(this.playerPy.playerInfoVO){var i=h.Config.getModuleConfig(),o=[];for(var n in i){var a=i[n];(s=Utils.UnlockMgr.checkPass(a.moduleId,!1)).allow&&-1==this.hasUnlockWhenLogin.indexOf(Number(a.moduleId))&&(s.condition==UnlockType.ServerOpenDay||s.condition==UnlockType.LevelAndServerOpenDay?h.GameMVC.guidePy.serverGuideInfo["MODULE_OPEN_"+a.moduleId]||(h.GameMVC.guidePy.setGuideInfo("MODULE_OPEN_"+a.moduleId),o.push(a)):o.push(a),this.hasUnlockWhenLogin.push(a.moduleId))}0<o.length&&egret.setTimeout(function(){t.showSubView(p.SV.MAIN,{popModule:o})},this,500)}break;case CN.PLAYER_INFO_UPDATE:if(null==this.hasUnlockWhenLogin){this.hasUnlockWhenLogin=[],i=h.Config.getModuleConfig();var r=h.Config.unlockConfig();for(var n in i){var s,c=r[(a=i[n]).moduleId],l=JSON.parse(c.condition)[0];this.CAN_POP_TYPE[l]&&((s=Utils.UnlockMgr.checkPass(a.moduleId,!1)).allow?s.condition==UnlockType.ServerOpenDay||s.condition==UnlockType.LevelAndServerOpenDay?h.GameMVC.guidePy.serverGuideInfo["MODULE_OPEN_"+a.moduleId]&&this.hasUnlockWhenLogin.push(a.moduleId):this.hasUnlockWhenLogin.push(a.moduleId):egret.log("【ModuleOpenMediator】模块"+a.name+"，"+s.ext.tips))}}}},p.N="ModuleOpenMediator",p.SV={MAIN:1},p);function p(e){void 0===e&&(e=null);var t,i=o.call(this,p.N,e)||this;return i.CAN_POP_TYPE=((t={})[UnlockType.Level]=1,t[UnlockType.VipLevel]=1,t[UnlockType.LevelOrVipLevel]=1,t[UnlockType.LevelAndVipLevel]=1,t[UnlockType.ServerOpenDay]=1,t[UnlockType.LevelAndServerOpenDay]=1,t),i.playerPy=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N),i}h.ModuleOpenMediator=e,__reflect(e.prototype,"game.ModuleOpenMediator")}(game=game||{}),function(o){var n,e=(__extends(t,n=BaseFull),t.prototype.childrenCreated=function(e){var t=this;n.prototype.childrenCreated.call(this);var i=new egret.Sprite;i.graphics.clear(),i.graphics.beginFill(0,.8),i.width=Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),i.height=Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale(),i.graphics.drawRect(0,0,i.width,i.height),i.graphics.endFill(),i.alpha=.5,this.gp_bg.addChild(i),Utils.DebugUtils.isDebug&&Utils.ComponentUtils.registerListener(this.gp_root,egret.TouchEvent.TOUCH_TAP,function(){t.gp_root.$children.forEach(function(e){egret.Tween.removeTweens(e)}),t.closeView()},this)},t.prototype.updateView=function(e){if(e){if(this.popModule=e.popModule,0<this.popModule.length){this.gp_root.removeChildren();for(var t=0;t<this.popModule.length;){var i=this.popModule[t],o=new a;o.scaleX=.8,o.scaleY=.8,this.popModule.length;var n=this.gp_root.width/2-o.width*o.scaleX*(this.popModule.length/2-t);o.x=n,o.y=(this.gp_root.height-o.height*o.scaleY)/2,o.updateData({config:i}),this.gp_root.addChild(o),++t}}this.iconFly()}else this.closeView()},t.prototype.iconFly=function(){function e(e){u=JSON.parse(e.flyView),g=JSON.parse(e.flyPos);for(var t=0,i=void 0,o=!1,n=0,a=u;n<a.length;n++){if(a[n],d==u[t]){var r;o=!0,g[t],(r=Utils.ComponentUtils.getComponentByName(g[t]))&&"NULL"!=r&&(i=Utils.ComponentUtils.getPosInView(r));break}++t}if(o||"Default"!=u[0]||(r=Utils.ComponentUtils.getComponentByName(g[0]))&&"NULL"!=r&&(i=Utils.ComponentUtils.getPosInView(r)),i){1==f.gp_root.$children.length&&egret.Tween.get(f.gp_bg).wait(1500).to({alpha:0},100);var s=f.gp_root.getChildAt(p);s.alpha=0,f.popModule.length;var c=f.gp_root.width/2-s.width*(f.popModule.length/2-p),l=(f.gp_root.height-s.height)/2;egret.Tween.get(s).wait(400*p).to({alpha:1,scaleX:1,scaleY:1,x:c,y:l},400,egret.Ease.backOut),egret.Tween.get(s).wait(1500*(p+1)-700*p).to({x:i.x+30,y:i.y+30,scaleX:.3,scaleY:.3},700,egret.Ease.quartIn).call(function(){h.gp_root.removeChild(s),h.gp_root.$children.length<=0&&h.closeView()})}else f.closeView();++p}for(var h=this,p=0,d=(o.AppFacade.getInstance().retrieveMediator(o.MainMediator.N),this.getCurTabView()),u=[],g=[],f=this,t=0,i=this.popModule;t<i.length;t++)e(i[t]);this.popModule.length<=0&&this.closeView()},t.prototype.getCurTabView=function(){var e=GameRootLayer.gameLayer().getCurViewStack();return 1<e.mainLayer.length?e.mainLayer[e.mainLayer.length-1]:e.tabLayer[e.tabLayer.length-1]},t.prototype.getParentView=function(){return GameRootLayer.gameLayer().popMsgLayer},t.prototype.closeView=function(){this.hide(),o.AppFacade.getInstance().sendNotification(CN.ACTIVITY_SHOW_TRIGGER)},t.prototype.perClose=function(){},t);function t(e){var t=n.call(this)||this;return t.popModule=[],t.skinName="ModuleOpenSkin",t}o.ModuleOpenView=e,__reflect(e.prototype,"game.ModuleOpenView");var i,a=(i=eui.Component,__extends(r,i),r.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this)},r.prototype.updateData=function(e){var t=this;if(e){var i=e.config;RES.getResAsync(ResourceUtils.png(i.pic),function(e){t.img_icon.source=e},this),this.blb_activity.text=i.name,this.createEffect()}},r.prototype.createEffect=function(){DragonBoneTools.create("common_patabaoxiang",function(e){e.x=this.gp_effect.width/2,e.y=this.gp_effect.height/2+20,e.scaleX=e.scaleY=2.5,e.animation.play(),this.gp_effect.addChild(e)},this)},r.prototype.onOPReset=function(){},r.prototype.onOPComeBack=function(e,t){},r.prototype.onOPClean=function(){},r.prototype.onOPCheck=function(e){},r);function r(){var e=i.call(this)||this;return e.skinName="ModuleOpenItemSkin",e}o.ModuleOpenItem=a,__reflect(a.prototype,"game.ModuleOpenItem",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(game=game||{}),function(e){var t,i=(__extends(o,t=BasePanel),o.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),this.configs.forEach(function(e){var t=new a(e);i.gp_btns.addChild(t)})},o);function o(){var e=t.call(this)||this;return e.configs=[{title:"客服",btnName:"",btnIcon:"_btn_lb_m_json.chuanghao_btn_kefu",initFunc:function(e){},onClickFunc:function(e){Utils.MsgUtils.addMidMsg("点击按钮"+e.lb_title.text)}}],e.skinName="FlowWindowPanel",e}e.FlowWindowPanel=i,__reflect(i.prototype,"game.FlowWindowPanel");var n,a=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){var e=this;n.prototype.childrenCreated.call(this),this.config&&(this.lb_title.text=this.config.title||"",this.btn.label=this.config.btnName||"",this.btn.icon=this.config.btnIcon||"",this.config.initFunc&&this.config.initFunc(this),this.config.onClickFunc&&this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.config.onClickFunc(e)},this))},r);function r(e){var t=n.call(this)||this;return t.skinName="FlowWindowPanelBtn",t.config=e,t}__reflect(a.prototype,"FlowWindowPanelBtn")}(game=game||{}),function(m){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="套 装",this.CommonDaTanChuKuang.onCloseCB=function(){t.hide()},this.list_root.itemRenderer=n,this.list_root.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){t.curIndex=e.itemIndex,t.updateView()},this),this.updateList(),this.skill0.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.SkillDetailsPanel.visible=!0,t.SkillDetailsPanel.updateItem(t.skill0.data)},this),this.skill0.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.SkillDetailsPanel.visible=!1},this),this.skill0.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){t.SkillDetailsPanel.visible=!1},this),this.skill0.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.SkillDetailsPanel.visible=!1},this),this.skill1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.SkillDetailsPanel.visible=!0,t.SkillDetailsPanel.updateItem(t.skill1.data)},this),this.skill1.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.SkillDetailsPanel.visible=!1},this),this.skill1.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){t.SkillDetailsPanel.visible=!1},this),this.skill1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.SkillDetailsPanel.visible=!1},this),this.skill2.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.SkillDetailsPanel.visible=!0,t.SkillDetailsPanel.updateItem(t.skill2.data)},this),this.skill2.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.SkillDetailsPanel.visible=!1},this),this.skill2.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){t.SkillDetailsPanel.visible=!1},this),this.skill2.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.SkillDetailsPanel.visible=!1},this),this.img_lock0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.MsgUtils.addMidMsg("敬请期待")},this),this.img_lock1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.MsgUtils.addMidMsg("敬请期待")},this),this.img_lock2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.MsgUtils.addMidMsg("敬请期待")},this),this.updateView()},t.prototype.updateView=function(){var e=this,t=m.Config.suitAttrConfig()[this.curIndex+1];this.gp_attrs.removeChildren();var i=JSON.parse(t.attr);for(var o in i){var n=i[o],a=new eui.Label;a.size=20,a.textColor=parseInt(o)%2==0?12917513:1795733,a.text="+"+m.GeneralConfig.getAttrValue(n[1])+m.GeneralConfig.getAttrName(n[0]),this.gp_attrs.addChild(a)}var r=JSON.parse(t.unlock),s=r[0],c=r[1],l=r[2],h=m.Config.allPetConfig()[s];h&&(this.model_pet.update({model:h.model}),this.lb_name_pet.text=h.name);var p=m.Config.fashionConfig()[l];p&&(this.lb_name_fashion.text=p.name);var d=m.Config.horseConfig();for(var o in d)(n=d[o]).code==c&&(this.lb_name_horse.text=n.name);this.model_horse.update({vo:{horseCode:c},reqStyle:ROLE_STYLE.Horse}),this.model_horse._onArmatureLoadCB=function(){e.model_horse.ead_model1&&(e.model_horse.ead_model1.visible=!1),e.model_horse.ead_model2&&(e.model_horse.ead_model2.visible=!1)},this.model_fashion.update({vo:{fashionCode:l},reqStyle:ROLE_STYLE.Fashion});for(var u=JSON.parse(t.skills),g=0;g<3;g++)u[g]?(this["skill"+g].updateItem({code:u[g][2]}),this["skill"+g].touchEnable=!0,this["img_lock"+g].visible=!1):(this["skill"+g].updateItem(),this["skill"+g].touchEnable=!1,this["img_lock"+g].visible=!0);this.img_bg.source=t.background+"_png",this.img_icon.source=t.titleImg+"_png";var f=0,_=!1;for(var o in m.GameMVC.petPy.allPetByUuid)(n=m.GameMVC.petPy.allPetByUuid[o]).code==s&&(_=!0);for(var o in _?(UIActionManager.setGrey(this.model_pet,!1),UIActionManager.addEffect(this.gp_pet,"common_activity_chunjiehuodong_04",{childIndex:0}),f++):(UIActionManager.setGrey(this.model_pet,!0),UIActionManager.hideEffect(this.gp_pet)),_=!1,m.GameMVC.fashionPy.allFashionByUuid)(n=m.GameMVC.fashionPy.allFashionByUuid[o]).code==l&&(_=!0);for(var o in _?(UIActionManager.setGrey(this.model_fashion,!1),UIActionManager.addEffect(this.gp_role,"common_activity_chunjiehuodong_04",{childIndex:0}),f++):(UIActionManager.setGrey(this.model_fashion,!0),UIActionManager.hideEffect(this.gp_role)),_=!1,m.GameMVC.mountPy.allMountByUuid)(n=m.GameMVC.mountPy.allMountByUuid[o]).code==c&&(_=!0);_?(UIActionManager.setGrey(this.model_horse,!1),UIActionManager.addEffect(this.gp_horse,"common_activity_chunjiehuodong_04",{childIndex:0}),f++):(UIActionManager.setGrey(this.model_horse,!0),UIActionManager.hideEffect(this.gp_horse)),this.bm_tip.text=3==f?"已获得加成":"激活套装所有部件，即可获得该加成"},t.prototype.updateList=function(){var e=m.Config.suitAttrConfig(),t=[];for(var i in e){var o=e[i],n=JSON.parse(o.unlock),a=n[0],r=n[1],s=n[2],c=0,l=!1;for(var h in m.GameMVC.petPy.allPetByUuid)m.GameMVC.petPy.allPetByUuid[h].code==a&&(l=!0);for(var p in l&&c++,l=!1,m.GameMVC.fashionPy.allFashionByUuid)m.GameMVC.fashionPy.allFashionByUuid[p].code==s&&(l=!0);for(var d in l&&c++,l=!1,m.GameMVC.mountPy.allMountByUuid)m.GameMVC.mountPy.allMountByUuid[d].code==r&&(l=!0);l&&c++,t.push({icon:o.icon,activated:3==c})}this.list_root.dataProvider=new eui.ArrayCollection(t)},t);function t(){var e=i.call(this)||this;return e.curIndex=0,e.skinName="FPM_PanelSkin",e}m.FPM_Panel=e,__reflect(e.prototype,"game.FPM_Panel");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.dataChanged=function(){this.img_icon.source=this.data.icon+"_png",this.img_pass.visible=this.data.activated},a);function a(){var e=o.call(this)||this;return e.skinName="FPM_PanelItem",e}__reflect(n.prototype,"FPM_PanelItem")}(game=game||{}),function(a){var t,e=(__extends(i,t=BasePanel),i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initView(),this.addBtnEvents()},i.prototype.initView=function(){var e=this;this.initHeroList(),this.playerPy.GetPlayerInfo(function(){e.initProgressBar()});var t=0<a.AppFacade.getInstance().retrieveProxy(a.HeroPy.N).HeroHistoryListlength;this.btn_modifyIcon.touchEnabled=t,UIActionManager.setGrey(this.btn_modifyIcon,!t)},i.prototype.vipEffect=function(e){var t;5<e&&e<12?t=this.VIP_CONFIG[1]:12<=e&&(t=this.VIP_CONFIG[2]),5<e&&(!this.effect||this.vip&&this.vip!=t?(this.gp_effect.removeChildren(),MovieClipTools.create(t,function(e){this.effect=e,this.effect.x=this.gp_effect.width/2,this.effect.y=this.gp_effect.height/2,this.effect.visible=!0,this.effect.animation.play(t,0),this.effect.animation.timeScale=1,this.gp_effect.addChild(this.effect)},this)):this.effect.animation.play(t,0)),this.vip=t},i.prototype.updateView=function(){var e=a.AppFacade.getInstance().retrieveProxy(a.GuildPy.N);this.lb_guldText.text="未加入公会",e.isInGuild()&&e.guildDetail&&e.guildDetail.name&&(this.lb_guldText.text=e.guildDetail.name),this.btn_vip.labelDisplay.text=String(this.playerPy.playerInfoVO.playerVip.vipLevel),this.vipEffect(this.playerPy.playerInfoVO.playerVip.vipLevel),this.lb_name.text=this.loginPy.playerProxy.playerInfoVO.name,this.lb_IDtext.text=String(this.playerPy.playerInfoVO.playerId),this.blb_fightCapText.text=Utils.MathUtils.formatNumStyle2(this.playerPy.playerInfoVO.fightCap),this.lb_levelText.text=this.loginPy.playerProxy.playerInfoVO.level.toString(),this.player_heah.updateData({vo:this.playerPy.playerInfoVO,effect:!0}),this.player_heah.blb_level.visible=!1,this.blb_level.text=this.playerPy.playerInfoVO.level.toString()},i.prototype.initProgressBar=function(){for(var e=0,t=a.Config.playerLevelUpgrade(),i=1,o=t[i];o;){if(o.level==this.playerPy.playerInfoVO.level){e=o.exp;break}o=t[++i]}var n=this.playerPy.playerInfoVO.exp;this.pro_exp.slideDuration=0,this.pro_exp.labelDisplay.scaleX=.68,this.pro_exp.labelDisplay.scaleY=1,this.pro_exp.maximum=e,this.pro_exp.minimum=0,this.pro_exp.value=n},i.prototype.initHeroList=function(){var a=this;Utils.Socket.send("playerInfo","GetPublicPlayer",{playerId:this.playerPy.playerInfoVO.playerId}).then(function(e){if(!a.gp_formation.$children.length)for(var t=1;t<=6;t++)(i=new r).name=t.toString(),i.scaleX=.85,i.scaleY=.85,a.gp_formation.addChild(i);for((i=new r).scaleX=.85,i.scaleY=.85,i.horizontalCenter=i.verticalCenter=0,a.gp_pet.addChild(i),t=1;t<=6;t++){var i=a.gp_formation.getChildByName(t.toString()),o=Utils.UnlockMgr.checkPass(t,!1);i.updateItem({uuid:a.heroProxy.heroUuid22Pos[t],unlock:o,info:a.heroProxy.allHeroByUuid[a.heroProxy.heroUuid22Pos[t]]}),i.scaleX=.85,i.scaleY=.85}i=a.gp_pet.$children[0],(o=Utils.UnlockMgr.checkPass(MODULE.Pet,!1)).unlock=e.publicPlayer.baseInfo.level>=o.ext.requestLevel,i.updateItem({uuid:e.publicPlayer.petList[0]&&e.publicPlayer.petList[0].uuid,unlock:o,vo:e.publicPlayer.petList[0],isPet:!0}),i.scaleX=.85,i.scaleY=.85;var n=new eui.HorizontalLayout;n.horizontalAlign=egret.HorizontalAlign.CENTER,a.gp_formation.layout=n}).catch(function(e){console.log("获取英雄失败")})},i.prototype.addBtnEvents=function(){if(this.btn_modifyIcon.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showAvatarSetting,this),Utils.SDKMgr.getPerformConfig(23)){var e=this.btn_sysSetting;e&&e.parent&&e.parent.removeChild(e)}else this.btn_sysSetting.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showSystemSetting,this);this.btn_servers.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showServers,this),Utils.SDKMgr.getPerformConfig(45)?this.btn_imput.visible=!1:this.btn_imput.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showRoleNameSetting,this),this.btn_vip.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.MainJumpConfig.jumpTo(MODULE.VIP)},this),a.GameMVC.playerPy.getCanShowUpdateLog()?this.btn_updateLog.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new a.UpdateLogPanel})},this):this.btn_updateLog.parent.removeChild(this.btn_updateLog)},i.prototype.showServers=function(){a.AppFacade.getInstance().showSubView(a.PlayerMediator.N,a.PlayerMediator.SV.SERVER_LIST)},i.prototype.showAvatarSetting=function(){a.AppFacade.getInstance().showSubView(a.PlayerMediator.N,a.PlayerMediator.SV.MODIFY_AVATAR)},i.prototype.showSystemSetting=function(){a.AppFacade.getInstance().showSubView(a.PlayerMediator.N,a.PlayerMediator.SV.SYSTEM_SETTING)},i.prototype.showRoleNameSetting=function(){a.AppFacade.getInstance().showSubView(a.PlayerMediator.N,a.PlayerMediator.SV.ROLE_NAME)},i.prototype.perClose=function(){},i);function i(){var e=t.call(this)||this;return e.VIP_CONFIG={1:"common_VIPhuizhang",2:"common_VIPhuizhang2"},e.skinName="PlayerInfoSkin",e.playerPy=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),e.loginPy=a.AppFacade.getInstance().retrieveProxy(a.LoginPy.N),e.heroProxy=a.AppFacade.getInstance().retrieveProxy(a.HeroPy.N),e}a.PlayerInfoPanel=e,__reflect(e.prototype,"game.PlayerInfoPanel");var o,r=(o=eui.Component,__extends(n,o),n.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem),this.gp_baseitem.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().updateView(a.HeroMediator.N,a.HeroMediator.SV.MAIN,{upstarData:{},uuid:this.data.uuid})},this),this.gp_empty.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.unlock.allow?a.AppFacade.getInstance().showSubView(a.HeroMediator.N,a.HeroMediator.SV.SELECT):Utils.MsgUtils.addMidMsg(this.data.unlock.ext.tips)},this)},n.prototype.updateItem=function(e){if(this.data=e,this.data.uuid){var t=e.isPet?EEntityType.EEntityTypePet:EEntityType.EEntityTypeHero;if(this.gp_baseitem.visible=!0,this.gp_empty.visible=!1,t==EEntityType.EEntityTypeHero)if(0!=e.info.dermaCode){var i=a.Config.getHeroDermaConfig()[e.info.dermaCode].avatar;this.baseItem.updateData({uuid:this.data.uuid,type:t,effect:!0,avatar:i,isShowEffect:!0})}else this.baseItem.updateData({uuid:this.data.uuid,type:t,effect:!0});else t==EEntityType.EEntityTypePet&&this.baseItem.updateData({vo:this.data.vo,type:t})}else this.gp_baseitem.visible=!1,this.gp_empty.visible=!0,this.data.unlock.allow?(this.img_add.visible=!0,this.img_lock.visible=!1,this.lb_unlock.visible=!1):(this.img_add.visible=!1,this.img_lock.visible=!0,this.lb_unlock.visible=!0,this.lb_unlock.text="LV "+this.data.unlock.ext.requestLevel)},n);function n(){var e=o.call(this)||this;return e.skinName="HeroMainView_HeroListItem",e.heroThingProxy=a.AppFacade.getInstance().retrieveProxy(a.HeroThingPy.N),e}__reflect(r.prototype,"HeroMainView_HeroListItem")}(game=game||{}),function(p){var n,e=(__extends(a,n=BasePanel),a.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.addEvents();var e=1==Utils.SoundManager.enableEff?"":"2",t=a.img_res.effect+e;this.btn_effect.icon=t;var i=1==Utils.SoundManager.enableBG?"":"2",o=a.img_res.music+i;this.btn_music.icon=o,Utils.SDKMgr.getPerformConfig(28)&&this.gp_3.parent.removeChild(this.gp_3),Utils.SDKMgr.getPerformConfig(29)&&this.gp_4.parent.removeChild(this.gp_4),Utils.SDKMgr.getPerformConfig(31)&&this.gp_5.parent.removeChild(this.gp_5)},a.prototype.preClose=function(){this.removeEvents()},a.prototype.addEvents=function(){this.btn_effect.addEventListener(egret.TouchEvent.TOUCH_TAP,this.soundEffectSetting,this),this.btn_music.addEventListener(egret.TouchEvent.TOUCH_TAP,this.musicSetting,this),this.btn_contact.addEventListener(egret.TouchEvent.TOUCH_TAP,this.contactServices,this),this.btn_switch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SDKMgr.goSwitchAccount()},this),this.btn_performance.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new i})},this)},a.prototype.removeEvents=function(){this.btn_effect.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.soundEffectSetting,this),this.btn_music.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.musicSetting,this),this.btn_contact.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.contactServices,this)},a.prototype.soundEffectSetting=function(){Utils.SoundManager.enableEff=!Utils.SoundManager.enableEff;var e=1==Utils.SoundManager.enableEff?"":"2",t=a.img_res.effect+e;this.btn_effect.icon=t},a.prototype.musicSetting=function(){Utils.SoundManager.enableBG=!Utils.SoundManager.enableBG;var e=1==Utils.SoundManager.enableBG?"":"2",t=a.img_res.music+e;this.btn_music.icon=t},a.prototype.contactServices=function(){PopUpManager.addPopUp({obj:new m})},a.isRecording=!1,a.img_res={music:"_btn_lb_m_json.chuanghao_btn_yinyue",effect:"_btn_lb_m_json.chuanghao_btn_yinxiao"},a);function a(){var e=n.call(this)||this;return e.skinName="SysytemSettingSkin",e}p.SystemSettingPanel=e,__reflect(e.prototype,"game.SystemSettingPanel");var t,i=(__extends(o,t=BasePanel),o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rb_1_0.groupName="rb_1",this.rb_1_1.groupName="rb_1",this.rb_2_0.groupName="rb_2",this.rb_2_1.groupName="rb_2",this.rb_1_0.addEventListener(eui.UIEvent.CHANGE,this.radioChangeHandler,this),this.rb_1_1.addEventListener(eui.UIEvent.CHANGE,this.radioChangeHandler,this),this.rb_2_0.addEventListener(eui.UIEvent.CHANGE,this.radioChangeHandler,this),this.rb_2_1.addEventListener(eui.UIEvent.CHANGE,this.radioChangeHandler,this),60==GameRootLayer.gameLayer().stage.frameRate?this.rb_1_1.selected=!0:this.rb_1_0.selected=!0,dragonBones.EgretFactory.skipFrame?this.rb_2_0.selected=!0:this.rb_2_1.selected=!0},o.prototype.radioChangeHandler=function(e){},o.prototype.onDestroy=function(){this.rb_1_1.selected?(egret.log("高帧率"),GameRootLayer.gameLayer().stage.frameRate=60,Utils.LocalStorageUtil.setItem("SETTING_PERFORMANCE_FPS",GameRootLayer.gameLayer().stage.frameRate.toString(),!0)):(egret.log("默认帧率"),GameRootLayer.gameLayer().stage.frameRate=Utils.MathUtils.isNumber(Utils.SDKMgr.getPerformConfig(11))?Number(Utils.SDKMgr.getPerformConfig(11)):30,Utils.LocalStorageUtil.removeItem("SETTING_PERFORMANCE_FPS",!0)),this.rb_2_0.selected?(egret.log("简洁模型"),dragonBones.EgretFactory.skipFrame=Utils.agentConfig.other&&Utils.agentConfig.other.performance&&Utils.agentConfig.other.performance.skipFrame||1,Utils.LocalStorageUtil.setItem("SETTING_PERFORMANCE_MODEL_SKIP_FRAME",dragonBones.EgretFactory.skipFrame.toString(),!0)):(egret.log("标准模型"),dragonBones.EgretFactory.skipFrame=0,Utils.LocalStorageUtil.removeItem("SETTING_PERFORMANCE_MODEL_SKIP_FRAME",!0))},o);function o(){var e=t.call(this)||this;return e.skinName="SysytemPerformanceSettingSkin",e}p.SysytemPerformanceSettingPanel=i,__reflect(i.prototype,"game.SysytemPerformanceSettingPanel");var r,s=(__extends(c,r=BasePanel),c.prototype.childrenCreated=function(){var t=this;r.prototype.childrenCreated.call(this),this.btn_hero.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.onScorllerData(1)},this),this.btn_special.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.SDKMgr.getPerformConfig(10)&&Utils.isXYX()&&p.MainJumpConfig.jumpTo("XYX_USERINFO",void 0,{cb:function(e){e&&(t.xyxHeadLink=e.avatarUrl),2==t.selectType&&t.onScorllerData(2)}}),t.onScorllerData(2)},this),this.btn_frame.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.onScorllerData(3)},this),this.list=new eui.List;var e=new eui.TileLayout;e.verticalGap=10,e.horizontalGap=10,e.requestedColumnCount=5,this.list.layout=e,this.scr_avavarList.viewport=this.list,this.list.itemRenderer=h,this.onScorllerData()},c.prototype.onScorllerData=function(e){var i=this;switch(this.array=[],this.selectType=e||1,this.selectType){case 1:var t=this.heroPy.heroHistoryInfo;for(var o in t){var n={code:o,avatar:(s=p.Config.allHeroConfig()[o]).avatar,type:EEntityType.EEntityTypeHero,dt:t[o].dt,initStar:s.initStar,subType:1};this.array.push(n)}var a=this.heroThingProxy.dermaiHostory;for(var r in a){var s=p.Config.getHeroDermaConfig()[a[r].code];n={code:a[r].code,avatar:s.avatar,type:EEntityType.EEntityTypeHero,dt:a[r].dt,subType:1},this.array.push(n)}for(var r in this.array)(n=this.array[r]).avatar==this.playerProxy.playerInfoVO.avatar&&(n.chosen=!0);break;case 2:var c=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N).AllItemInfo,l=p.Config.itemConfig();for(var o in c)l[o]&&l[o].type==EPropType.EPropTypeAvatar&&this.array.push({code:o,avatar:l[o].icon,type:EEntityType.EEntityTypeItem,dt:c[o][0].dt,subType:2});for(var r in this.array)(n=this.array[r]).avatar==this.playerProxy.playerInfoVO.avatar&&(n.chosen=!0);this.xyxHeadLink&&this.array.push({code:0,avatar:this.xyxHeadLink,type:0,dt:0,subType:2});break;case 3:for(var o in c=p.AppFacade.getInstance().retrieveProxy(p.BackpackPy.N).AllItemInfo,l=p.Config.itemConfig(),c)l[o]&&l[o].type==EPropType.EPropTypeFrame&&this.array.push({code:o,avatar:l[o].icon,frame:l[o].icon,type:this.selectType,dt:c[o][0].dt,subType:3});for(var r in this.array.push({code:0,avatar:"",frame:JSON.parse(p.Config.constConfig().DefaultFrame.constValue)[0],type:this.selectType,dt:1e16,subType:3}),this.array)(n=this.array[r]).frame!=this.playerProxy.playerInfoVO.frame&&(this.playerProxy.playerInfoVO.frame||0!=n.code)||(n.chosen=!0)}this.array.sort(function(e,t){return i.compareFunc(e,t)}),this.removeDuplicateAvatar();var h=new eui.ArrayCollection(this.array);this.list.dataProvider=h,this.gp_empty.visible=0==this.array.length},c.prototype.updateView=function(){},c.prototype.perClose=function(){},c.prototype.removeDuplicateAvatar=function(){var t=[],i={};this.array.forEach(function(e){i[e.avatar]||(i[e.avatar]={dt:e.dt},t.push(e))}),this.array=[],this.array=t.reverse()},c.prototype.compareFunc=function(e,t){return e.dt<t.dt?-1:e.dt>t.dt?1:e.code-t.code},c);function c(){var e=r.call(this)||this;return e.array=[],e.playerProxy=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N),e.heroPy=p.AppFacade.getInstance().retrieveProxy(p.HeroPy.N),e.heroThingProxy=p.AppFacade.getInstance().retrieveProxy(p.HeroThingPy.N),e.skinName="ModifyAvatarSkin",e}p.ModifyAvatar=s,__reflect(s.prototype,"game.ModifyAvatar");var l,h=(l=eui.ItemRenderer,__extends(d,l),d.prototype.dataChanged=function(){this.player_head.updateData({vo:this.data,effect:!0});var e=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N);this.data.level&&this.data.level>e.playerInfoVO.level&&UIActionManager.setGrey(this.player_head),this.img_chose.visible=!!this.data.chosen},d);function d(e){var t=l.call(this)||this;return t.skinName="AvatarItemSkin",e&&(t.data=e),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){console.log("更换头像");var e=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N);3==t.data.subType?e.changeFrame({type:t.data.type,code:t.data.code}):e.changeAvatar({type:t.data.type,code:t.data.code,avatar:t.data.avatar}),p.AppFacade.getInstance().hideSubView(p.PlayerMediator.N,p.PlayerMediator.SV.MODIFY_AVATAR)},t),t}p.AvatarItem=h,__reflect(h.prototype,"game.AvatarItem");var u,g=(__extends(f,u=BasePanel),f.prototype.childrenCreated=function(){var t=this;if(u.prototype.childrenCreated.call(this),this.addEvents(),this.cu_ctc.blb_title.text="改名",this.loginProxy.loginGameVO.isCreated){this.gp_created.visible=!0,this.gp_noCreate.visible=!1,this.gp_cost.visible=!0;var e=JSON.parse(p.Config.constConfig().ChangeNameExpense.constValue),i=e[0];p.GameMVC.backpackPy.checkEnough(i,!1)||(i=e[1]);var o=p.GeneralConfig.getEntityConfigByCode(i[0][0],i[0][1]);RES.getResAsync(ResourceUtils.png(o.icon),function(e){t.img_diamonds.source=e},this),this.lb_cost.text="x"+i[0][2]}else this.gp_created.visible=!1,this.gp_noCreate.visible=!0,this.gp_cost.visible=!1,this.ed_input.y+=30,this.btn_random.y+=30;this.randomName(),Utils.isXYX()&&!Utils.SDKMgr.getPerformConfig(33)&&(this.btn_wechat.visible=!0)},f.prototype.addEvents=function(){var t=this;this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.cancelFunc,this),this.btn_conform.addEventListener(egret.TouchEvent.TOUCH_TAP,this.conformFunc,this),this.btn_random.addEventListener(egret.TouchEvent.TOUCH_TAP,this.randomName,this),this.btn_conform2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.conformFunc,this),this.btn_wechat.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){p.MainJumpConfig.jumpTo("XYX_USERINFO",void 0,{cb:function(e){e&&(t.ed_input.text=Utils.Http.checkStrLegal(e.nickName,!1,""))}})},this)},f.prototype.removeEvents=function(){this.btn_cancel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.cancelFunc,this),this.btn_conform.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.conformFunc,this),this.btn_random.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.randomName,this),this.btn_conform2.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.conformFunc,this)},f.prototype.cancelFunc=function(){p.AppFacade.getInstance().hideSubView(p.PlayerMediator.N,p.PlayerMediator.SV.ROLE_NAME)},f.prototype.conformFunc=function(){if(""==this.ed_input.text)Utils.MsgUtils.addMidMsg("请输入角色名字");else if(Utils.SDKMgr.getPerformConfig(30)){if(Utils.Http.checkStrLegal(this.ed_input.text,!1,"")){var e=Utils.Http.checkStrLegal(this.ed_input.text,!1,"");e!=this.playerPy.playerInfoVO.name?this.playerPy.changeName(e):Utils.MsgUtils.addMidMsg("该名称已存在")}}else Utils.Http.checkStrLegal(this.ed_input.text,!0)&&(this.ed_input.text!=this.playerPy.playerInfoVO.name?this.playerPy.changeName(this.ed_input.text):Utils.MsgUtils.addMidMsg("该名称已存在"))},f.prototype.randomName=function(){this.ed_input.text=this.playerPy.getRandomName()},f.prototype.preClose=function(){this.removeEvents()},f);function f(){var e=u.call(this)||this;return e.loginProxy=p.AppFacade.getInstance().retrieveProxy(p.LoginPy.N),e.playerPy=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N),e.skinName="ModifyRoleNameSkin",e}p.ChangeRoleNamePanel=g,__reflect(g.prototype,"game.ChangeRoleNamePanel");var _,m=(__extends(y,_=BasePanel),y.prototype.childrenCreated=function(){_.prototype.childrenCreated.call(this),this.addEvents(),this.edt_input.textColor=9991254,this.lb_qq.text=getUrlKV().qq||Utils.agentConfig.other.qq||"",this.lb_email.text=getUrlKV().email||Utils.agentConfig.other.email||"",this.lb_qqTtile.text=getUrlKV().qqTitle||Utils.agentConfig.other.qqTitle||"官方QQ群:",this.lb_emallTitle.text=getUrlKV().emailTitle||Utils.agentConfig.other.emailTitle||"客服邮箱:",Utils.agentConfig.other&&Utils.agentConfig.other.dismissContact&&(this.gp_contact.visible=!1)},y.prototype.addEvents=function(){this.btn_comform.addEventListener(egret.TouchEvent.TOUCH_TAP,this.conform,this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,this.cancel,this)},y.prototype.removeEvents=function(){this.btn_comform.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.conform,this),this.btn_cancel.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.cancel,this)},y.prototype.conform=function(){var t=this;if(100<this.edt_input.text.length)Utils.MsgUtils.addMidMsg("长度过长！");else if(0==this.edt_input.text.length)Utils.MsgUtils.addMidMsg("内容不得为空！");else{var e=p.AppFacade.getInstance().retrieveProxy(p.LoginPy.N),i=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N);(new Http).toGet({action:"player_feedback",content:this.edt_input.text,player_id:i.playerInfoVO.playerId,username:e.userVO.username,name:i.playerInfoVO.name,server_id:e.serverSelect.s_id}).then(function(e){"success"==e.msg?(Utils.MsgUtils.addMidMsg("发送成功"),PopUpManager.removePopUp(t)):Utils.MsgUtils.addMidMsg("发送失败，请重试！")})}},y.prototype.cancel=function(){PopUpManager.removePopUp(this)},y.prototype.preClose=function(){this.removeEvents()},y);function y(){var e=_.call(this)||this;return e.skinName="ContactServicesSkin",e}p.ContactServices=m,__reflect(m.prototype,"game.ContactServices")}(game=game||{}),function(i){var t,e=(__extends(o,t=BaseMediator),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,i.PlayerInfoPanel),this.addSubView(o.SV.SERVER_LIST,i.ServersPanel),this.addSubView(o.SV.MODIFY_AVATAR,i.ModifyAvatar),this.addSubView(o.SV.SYSTEM_SETTING,i.SystemSettingPanel),this.addSubView(o.SV.ROLE_NAME,i.ChangeRoleNamePanel),this.addSubView(o.SV.XYX_USERINFO,i.XYXUserInfoView)},o.prototype.listNotificationInterests=function(){return[CN.PLAYERINFO_MAIN_UPDATE,CN.PLAYER_LEVEL_UP]},o.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.PLAYERINFO_MAIN_UPDATE:this.getSubView(o.SV.MAIN)&&this.getSubView(o.SV.MAIN).updateView();break;case CN.PLAYER_LEVEL_UP:Utils.MsgUtils.shengjiEffect(),i.AppFacade.getInstance().sendNotification(CN.QQZONE_PUSH_MESSAGE,{data:t,type:"playerLevelUp"})}},o.N="PlayerMediator",o.SV={MAIN:1,SERVER_LIST:2,MODIFY_AVATAR:3,SYSTEM_SETTING:4,ROLE_NAME:5,XYX_USERINFO:6},o);function o(e){return void 0===e&&(e=null),t.call(this,o.N,e)||this}i.PlayerMediator=e,__reflect(e.prototype,"game.PlayerMediator")}(game=game||{}),function(o){var e=(t.registerAll=function(){(new n).register(),(new s).register(),(new h).register(),(new u).register(),(new _).register(),(new v).register(),(new E).register(),(new A).register(),(new N).register()},t);function t(){}o.PlayerProcessor=e,__reflect(e.prototype,"game.PlayerProcessor");var i,n=(i=o.ProcessorBase,__extends(a,i),a.prototype.execute=function(e){var t=e.getBody();if(this.checkCB(t)){Utils.DebugUtils.dumpPbMsg(t);var i=o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N);i.playerInfoVO.fightCap-t.fightCap!=0&&(this.playerProxy.checkFight(i.playerInfoVO.fightCap,t.fightCap,t.source),Utils.SDKMgr.cmd({type:"qqxyx_postMessage",fightCap:t.fightCap})),t.level!=i.playerInfoVO.level?egret.setTimeout(function(){i.playerInfoVO.update(t)},this,500):i.playerInfoVO.update(t),this.sendNotification(CN.PLAYER_INFO_UPDATE)}},a);function a(){var e=i.call(this,"playerInfo.PlayerInfoP",a)||this;return e.playerProxy=o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N),e}o.PlayerInfoP=n,__reflect(n.prototype,"game.PlayerInfoP");var r,s=(r=o.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody();this.checkCB(t)&&(o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N).handleClientReward(t.clientReward),o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N).playerInfoVO.playerVip.update(t.playerVipInfo),this.sendNotification(CN.PLAYER_INFO_UPDATE),o.AppFacade.getInstance().sendNotification(CN.MONEY_UPDATE),o.AppFacade.getInstance().sendNotification(CN.RECHARGE_GET_DATA),Utils.MsgUtils.addMidMsg("充值成功"),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.VipGift]),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.VipWelfare]),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.VipPreferentialGift]),NoticeManager.updateNotice(NT.VIP_GIFT),o.GameMVC.activityMed.updateViewByCode(EActivityType.VipWelfare),o.GameMVC.activityMed.updateViewByCode(EActivityType.NewHuntTreasure),o.GameMVC.activityMed.updateViewByCode(EActivityType.IslandExplore),o.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_BTN),o.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_PET))},c);function c(){return r.call(this,"playerInfo.PushRechargeP",c)||this}o.PushRechargeP=s,__reflect(s.prototype,"game.PushRechargeP");var l,h=(l=o.ProcessorBase,__extends(p,l),p.prototype.execute=function(e){var t=e.getBody();this.checkCB(t)&&(o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N).playerInfoVO.playerVip.update(t.playerVipInfo),this.sendNotification(CN.PLAYER_INFO_UPDATE),o.AppFacade.getInstance().sendNotification(CN.MONEY_UPDATE),o.AppFacade.getInstance().sendNotification(CN.RECHARGE_GET_DATA),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.VipWelfare]),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.VipGift]),NoticeManager.updateNotice(NT.VIP_GIFT),o.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_PET))},p);function p(){return l.call(this,"playerInfo.PushPlayerVipP",p)||this}o.PushPlayerVipP=h,__reflect(h.prototype,"game.PushPlayerVipP");var d,u=(d=o.ProcessorBase,__extends(g,d),g.prototype.execute=function(e){var t=e.getBody();this.log("PushMonthCardP",t),o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N).playerInfoVO.playerVip.update(t.playerVipInfo),this.sendNotification(CN.PLAYER_INFO_UPDATE)},g);function g(){return d.call(this,"playerInfo.PushMonthCardP",g)||this}o.PushMonthCardP=u,__reflect(u.prototype,"game.PushMonthCardP");var f,_=(f=o.ProcessorBase,__extends(m,f),m.prototype.execute=function(e){this.checkCB(e.getBody())&&(e.getBody(),o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N))},m);function m(){return f.call(this,"playerInfo.redeemRewardP",m)||this}o.RedeemRewardP=_,__reflect(_.prototype,"game.RedeemRewardP");var y,v=(y=o.ProcessorBase,__extends(T,y),T.prototype.execute=function(e){Utils.UnlockMgr.clearLockedInfoByType([UnlockType.ServerOpenDay,UnlockType.LevelAndServerOpenDay]),o.AppFacade.getInstance().sendNotification(CN.GENERAL_PASS_DAY)},T);function T(){return y.call(this,"playerInfo.OnNewDayP",T)||this}o.OnNewDayP=v,__reflect(v.prototype,"game.OnNewDayP");var C,E=(C=o.ProcessorBase,__extends(I,C),I.prototype.execute=function(e){var t=e.getBody();o.GameMVC.playerPy.playerInfoVO.frame=t.frame,o.AppFacade.getInstance().sendNotification(CN.PLAYER_INFO_UPDATE)},I);function I(){return C.call(this,"playerInfo.FrameInfoP",I)||this}o.FrameInfoP=E,__reflect(E.prototype,"game.FrameInfoP");var b,A=(b=o.ProcessorBase,__extends(P,b),P.prototype.execute=function(e){var t=e.getBody();o.AppFacade.getInstance().sendNotification(CN.PLAYER_INFO_ERROR,{error:t.err})},P);function P(){return b.call(this,"playerInfo.PushErrorP",P)||this}o.PushErrorP=A,__reflect(A.prototype,"game.PushErrorP");var M,N=(M=o.ProcessorBase,__extends(S,M),S.prototype.execute=function(e){},S);function S(){return M.call(this,"playerInfo.GmRewardCostP",S)||this}o.GmRewardCostP=N,__reflect(N.prototype,"game.GmRewardCostP")}(game=game||{}),function(n){var t,e=(__extends(i,t=BaseProxy),i.prototype.getCanShowUpdateLog=function(){return 14<=Utils.TimerManager.getServerOpenDays()},i.prototype.checkNeedAndPopUpdateLog=function(){if(this.getCanShowUpdateLog()&&30<=this.playerInfoVO.level&&Utils.SDKMgr.getPerformConfig(12)){var e=Utils.LocalStorageUtil.getItem("POP_UPDATE_LOG_URL",!0),t=RES.getResourceInfo("common_gg_01_png");if(t&&e!=t.url)return Utils.LocalStorageUtil.setItem("POP_UPDATE_LOG_URL",t.url,!0),PopUpManager.addPopUpQueue({obj:new n.UpdateLogPanel}),!0}},i.prototype.checkAndPopAds=function(){if(30<=this.playerInfoVO.level&&Array.isArray(Utils.SDKMgr.getPerformConfig(200001))&&0<Utils.SDKMgr.getPerformConfig(200001).length){var e=Utils.LocalStorageUtil.getItem("POP_ADS_URL",!1),t=RES.getResourceInfo(Utils.SDKMgr.getPerformConfig(200001)[0]);if(t&&e!=t.url)return Utils.LocalStorageUtil.setItem("POP_ADS_URL",t.url,!1),PopUpManager.addPopUpQueue({obj:new n.AdsPanel({arrs:Utils.SDKMgr.getPerformConfig(200001)})}),!0}},i.prototype.checkAndPopSthWhenFirstGuideEnd=function(){if(Utils.SDKMgr.getPerformConfig(200006)){var e=Utils.LocalStorageUtil.getItem("GZGZH_FULL_PIC_EXIT_URL",!1);(t=RES.getResourceInfo(Utils.SDKMgr.getPerformConfig(200006)))&&e!=t.url&&(Utils.LocalStorageUtil.setItem("GZGZH_FULL_PIC_EXIT_URL",t.url,!1),n.GameMVC.activityMed.showViewByCode(EActivityType.GuanZhuGongZhongHao,{source:Utils.SDKMgr.getPerformConfig(200006)}))}var t;Array.isArray(Utils.SDKMgr.getPerformConfig(200004))&&0<Utils.SDKMgr.getPerformConfig(200004).length&&(e=Utils.LocalStorageUtil.getItem("POP_FIRST_GUIDE_END_IMG_URL",!1),(t=RES.getResourceInfo(Utils.SDKMgr.getPerformConfig(200004)[0]))&&e!=t.url&&(Utils.LocalStorageUtil.setItem("POP_FIRST_GUIDE_END_IMG_URL",t.url,!1),PopUpManager.addPopUp({obj:new n.AdsPanel({arrs:Utils.SDKMgr.getPerformConfig(200004)})})))},i.prototype.checkFight=function(e,t,i){this.canShow?(0!=e&&0!=t&&e!=t&&i!=EFightCapChangeSource.ChangeFormation&&Utils.MsgUtils.addCapChangeEffect(e,t),this.fightObj.beforeFight=0,this.fightObj.afterFight=0,this.fightObj.isFirst=!0):this.fightObj.isFirst?(this.fightObj.beforeFight=e,this.fightObj.afterFight=t,this.fightObj.isFirst=!1):this.fightObj.afterFight=t},i.prototype.getRandomName=function(){var e=n.Config.getPerNameList(),t=n.Config.getNextNameList();return e[Math.floor(1e4*Math.random())%e.length]+"的"+t[Math.floor(1e4*Math.random())%t.length]},i.prototype.getFadeName=function(){var e=n.Config.getRandNameList();return e[Utils.MathUtils.getRandomInt(0,e.length-1)]},i.prototype.makeFadePlayerInfo=function(){this.playerInfoVO.name=this.getRandomName(),this.playerInfoVO.level=Math.floor(100*Math.random())+1,this.playerInfoVO.avatar=DefaultValue.avatar,this.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeDiamond]=Math.floor(1e4*Math.random()),this.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeGold]=Math.floor(1e3*Math.random()),this.playerInfoVO.exp=Math.floor(100*Math.random()),this.playerInfoVO.playerVip.vipLevel=Math.floor(10*Math.random())%9+1,this.playerInfoVO.fightCap=Math.floor(1e6*Math.random())},i.prototype.changeName=function(i){var o=this;n.GameMVC.mainPy.checkTextVaild(i,function(){Utils.Socket.send("playerInfo","ChangeName",{name:i}).then(function(e){Utils.MsgUtils.addMidMsg("您的名字已更新"),o.GetPlayerInfo();var t=o.playerInfoVO.name;o.roleVo.name=o.playerInfoVO.name=i,Utils.SDKMgr.enterFlow("PlayerRename",{oldName:t}),n.AppFacade.getInstance().retrieveProxy(n.LoginPy.N).loginGameVO.isCreated=!0,n.AppFacade.getInstance().hideSubView(n.PlayerMediator.N,n.PlayerMediator.SV.ROLE_NAME)}).catch(function(e){})},14)},i.prototype.changeAvatar=function(e){var t=this;Utils.Socket.send("playerInfo","ChangeAvatar",{type:e.type,code:e.code,avatar:e.avatar}).then(function(e){t.GetPlayerInfo()}).catch(function(e){})},i.prototype.changeFrame=function(e){var t=this;Utils.Socket.send("playerInfo","ChangeFrame",{code:e.code}).then(function(e){t.GetPlayerInfo()}).catch(function(e){})},i.prototype.GetPlayerInfo=function(t){var i=this;Utils.Socket.send("playerInfo","GetPlayerInfo",{}).then(function(e){i.playerInfoVO.update(e),t&&t(),i.sendNotification(CN.PLAYER_INFO_UPDATE),i.sendNotification(CN.PLAYERINFO_MAIN_UPDATE),i.sendNotification(CN.PLAYER_OUTLOOK_UPDATE)})},i.prototype.isInSameServer=function(e){return e==n.GameMVC.loginPy.serverSelect.area},i.prototype.GetPublicPlayerBaseInfo=function(i,o,c){return void 0===c&&(c=void 0),__awaiter(this,void 0,void 0,function(){var t,n,a,r,s=this;return __generator(this,function(e){switch(e.label){case 0:return t=[],n={},a=[],r=Utils.TimerManager.getServerTime(),null==c&&(c=this.publicPlayerBaseInfoCashTime),i.forEach(function(i,o){s.publicPlayerBaseInfoCash[i]&&r-s.publicPlayerBaseInfoCash[i].getDataTime<c?(a[o]=s.publicPlayerBaseInfoCash[i],n[i]=s.publicPlayerBaseInfoCash[i]):t.push(Utils.Socket.send("playerInfo","GetBasePlayerInfo",{playerId:i}).then(function(e){var t=Utils.TimerManager.getServerTime();e.getDataTime=t,s.publicPlayerBaseInfoCash[i]=e,a[o]=e,n[i]=e}))}),[4,Promise.all(t)];case 1:return e.sent(),o(a,n),[2]}})})},i.prototype.GetPublicPlayerInfo=function(i,o){return __awaiter(this,void 0,void 0,function(){var t,n,a,r,s=this;return __generator(this,function(e){switch(e.label){case 0:return t=[],n={},a=[],r=Utils.TimerManager.getServerTime(),i.forEach(function(i,o){s.publicPlayerInfoCash[i]&&r-s.publicPlayerInfoCash[i].getDataTime<s.publicPlayerInfoCashTime?(a[o]=s.publicPlayerInfoCash[i],n[i]=s.publicPlayerInfoCash[i]):t.push(Utils.Socket.send("playerInfo","GetPublicPlayer",{playerId:i}).then(function(e){var t=Utils.TimerManager.getServerTime();e.getDataTime=t,s.publicPlayerInfoCash[i]=e,a[o]=e,n[i]=e}))}),[4,Promise.all(t)];case 1:return e.sent(),o(a,n),[2]}})})},i.prototype.ChallengePlayer=function(e){this.challengePlayerId=e,this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypePvP,pb1:"battle",pb2:"ChallengePlayer",params:{playerId:e}})},i.N="PlayerProxy",i);function i(){var e=t.call(this,i.N)||this;return e.fightObj={beforeFight:0,afterFight:0,isFirst:!0},e.publicPlayerBaseInfoCash={},e.publicPlayerBaseInfoCashTime=0,e.publicPlayerInfoCash={},e.publicPlayerInfoCashTime=0,e.roleVo=new n.RoleVO,e.loginStatusVO=new n.LoginStatusVO,e.playerInfoVO=new n.PlayerInfoVO,e.fightCapRanks=new Array,e.levelRanks=new Array,e.playerGuildVO=new n.PlayerGuildVO({}),e.fightObj.beforeFight=0,e.fightObj.afterFight=0,e.canShow=!0,e}n.PlayerPy=e,__reflect(e.prototype,"game.PlayerPy")}(game=game||{}),function(n){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.rootPanel.gp_title.visible=!1,this.rootPanel.onCloseCB=function(){e.hide()},this.initList()},i.prototype.initList=function(){this.list_serverList.itemRenderer=a,this.list_areaList.itemRenderer=c,this.list_areaList.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onAreaItemTap,this)},i.prototype.onAreaItemTap=function(e){var i=this;e&&null!=e.itemIndex&&(this.selectAreaIndex=e&&e.itemIndex);var t=this.list_areaList.dataProvider;t.source.forEach(function(e,t){e.selected=t==i.selectAreaIndex}),t.refresh(),this.updateServerList()},i.prototype.updateAreaList=function(){var t=[];this.data.forEach(function(e){t.push({name:e.name,selected:!1})}),this.list_areaList.dataProvider=new eui.ArrayCollection(t)},i.prototype.updateServerList=function(){this.scr_serverList.stopAnimation(),this.scr_serverList.viewport.scrollV=0;var t=[],i=this.data[this.selectAreaIndex];i.list.forEach(function(e){t.push({info:e,showServer:0==i.index})}),t.sort(function(e,t){return t.info.area-e.info.area}),this.list_serverList.dataProvider=new eui.ArrayCollection(t)},i.prototype.updateView=function(e){var t=this;this.data.length?(null==this.selectAreaIndex&&(this.selectAreaIndex=0==this.data[0].list.length&&1<this.data.length?1:0),this.onAreaItemTap()):n.GameMVC.loginPy.getAllPlayerServer(function(e){t.data=e,t.updateAreaList(),t.updateView()})},i.prototype.perClose=function(){this.list_areaList.removeEventListener(eui.ItemTapEvent.ITEM_TAP,this.onAreaItemTap,this)},i);function i(){var e=t.call(this)||this;return e.array=[],e.data=[],e.skinName="ServersSkin",e}n.ServersPanel=e,__reflect(e.prototype,"game.ServersPanel");var o,a=(o=eui.ItemRenderer,__extends(r,o),r.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.switchServer,this),this.playerHead=customui.PlayerHeadFactory.create(),this.playerHead.scaleX=this.playerHead.scaleY=.7,this.playerHead.x=290,this.playerHead.verticalCenter=0,this.addChild(this.playerHead)},r.prototype.switchServer=function(){var e=this.data.info;1!=e.s_healthStatus?n.GameMVC.loginPy.serverSelect&&e.s_id==n.GameMVC.loginPy.serverSelect.s_id?Utils.MsgUtils.addMidMsg("就在本服无需切换"):n.GameMVC.loginPy.switchServer(e.s_id,function(){n.AppFacade.getInstance().retrieveMediator(n.PlayerMediator.N).hideSubView(n.PlayerMediator.SV.SERVER_LIST)}):Utils.MsgUtils.addMidMsg("该服已满！")},r.prototype.dataChanged=function(){var t=this,e=this.data.info;if(this.lb_serverName.text=""+(this.data.showServer?e.list_name:"")+((e.area-1)%48+1)+"服",e.playerList){this.img_flag.visible=!1,this.lb_roleName.visible=!0,this.playerHead.visible=!0;var i=JSON.parse(n.Config.constConfig().DefaultAvatar.constValue)[0],o={level:e.playerList.lev,avatar:e.playerList.head&&""!=e.playerList.head?e.playerList.head:i,name:e.playerList.name};this.playerHead.updateData({vo:o}),this.lb_roleName.text=e.playerList.name}else this.lb_roleName.visible=!1,this.playerHead.visible=!1,this.img_flag.visible=!1,r.SERVER_FLAG[e.s_healthStatus]&&RES.getResAsync(r.SERVER_FLAG[e.s_healthStatus],function(e){t.img_flag.source=e,t.img_flag.visible=!0},this);r.SERVER_STATUS[e.s_healthStatus]&&RES.getResAsync(r.SERVER_STATUS[e.s_healthStatus],function(e){t.img_status.visible=!0,t.img_status.source=e},this),this.lb_roleName.visible=!1},r.SERVER_STATUS={1:"chuanghao_img_hongdian_png",2:"chuanghao_img_lvdian_png",3:"chuanghao_img_lvdian_png",4:"chuanghao_img_huidian_png"},r.SERVER_FLAG={1:"chuanghao_img_man_png",2:"",3:"chuanghao_img_xin_png",4:"chuanghao_img_weihu_png"},r);function r(){var e=o.call(this)||this;return e.skinName="ServerItemSkin",e}n.ServerItem=a,__reflect(a.prototype,"game.ServerItem");var s,c=(s=eui.ItemRenderer,__extends(l,s),l.prototype.childrenCreated=function(){s.prototype.childrenCreated.call(this)},l.prototype.dataChanged=function(){this.lb_name.text=this.data.name,this.img_bg.source=this.data.selected?"chuanghao_img_duandi1_png":"chuanghao_img_duandi0_png",this.icon_selected.visible=this.data.selected},l);function l(){var e=s.call(this)||this;return e.skinName="AreaItemSKin",e}__reflect(c.prototype,"AreaItem")}(game=game||{}),function(e){var t,i=(__extends(o,t=BasePanel),o.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},o.prototype.updateView=function(t,e){var i=this;void 0===e&&(e=!1),Utils.SDKMgr.cmd({type:"GetOpenData"},function(e){t&&t.cb&&t.cb(e),i.hide()})},o.prototype.onDestroy=function(){Utils.SDKMgr.cmd({type:"HideUserBtn"})},o);function o(){var e=t.call(this)||this;return e.skinName="XYXUserInfoViewSkin",e}e.XYXUserInfoView=i,__reflect(i.prototype,"game.XYXUserInfoView")}(game=game||{}),function(e){var i,t=(i=eui.Component,__extends(o,i),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.data&&this.update(this.data)},o.prototype.update=function(e){this.data=e;var t=this.data.num||this.data;this.blb_num.text=t.toString(),this.data.scale&&(this.scaleX=this.scaleY=this.data.scale)},o);function o(e){var t=i.call(this)||this;return t.skinName="HighStarLevelIconSkin",t.data=e,t}e.HighStarLevelIcon=t,__reflect(t.prototype,"customui.HighStarLevelIcon")}(customui=customui||{}),function(h){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initScroll(),this.initTabbar(),this._activateComponent(),this.initEffect()},o.prototype.initEffect=function(){var t=this;DragonBoneTools.create("common_paihangbang_1",function(e){e.x=103,e.y=135,e.animation.play(),t.gp_rank1.addChild(e)}),DragonBoneTools.create("common_paihangbang_2",function(e){e.x=83,e.y=115,e.animation.play(),t.gp_rank2.addChild(e)}),DragonBoneTools.create("common_paihangbang_3",function(e){e.x=83,e.y=115,e.animation.play(),t.gp_rank3.addChild(e)})},o.prototype.initScroll=function(){this.list_item.itemRenderer=n,UIActionManager.hideScrollerBar(this.scl_rankList)},o.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin";var e=[];for(var t in this.CONFIG)e.push({source:this.CONFIG[t].source});this.tabbar.dataProvider=new eui.ArrayCollection(e),this.tabbar.selectedIndex=0,this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.updateView,this)},o.prototype.updateView=function(e){var c=this;e&&null!=e.itemIndex&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex);var l=this.CONFIG[this.tabbar.selectedIndex];this.scl_rankList.stopAnimation(),this.scl_rankList.viewport.scrollV=0,this.rankProxy.GetRankList(l,function(e){var t=(c.curRanks=e).ranks,i=e.selfRank;if(0!=t.length){for(var o=1;o<4;o++){var n=t[o-1];c.updateTop3Rank(o,n)}var a=[];t.forEach(function(e,t){2<t&&a.push({rankInfo:e,config:l})}),c.list_item.dataProvider=new eui.ArrayCollection(a)}var r=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N).playerInfoVO,s=h.AppFacade.getInstance().retrieveProxy(h.GuildPy.N).guildDetail;c.lb_title.text=l.title,c.lb_tips_self.visible=!1,c.item_fightCap_self.visible=!1,l.isGuild?i&&i.rank&&s?(c.playerHead_self.visible=!1,c.guildHead_self.visible=!0,c.lb_rank_self.text=i.rank,c.lb_name_self.text=s.name,c.guildHead_self.updateData({vo:s}),c.item_fightCap_self.visible=!0,c.item_fightCap_self.update(s.fightCap)):(c.lb_rank_self.text="",c.playerHead_self.visible=!0,c.guildHead_self.visible=!1,c.playerHead_self.updateData({vo:r}),c.lb_name_self.text=r.name,c.lb_tips_self.visible=!0,c.lb_tips_self.text="暂无公会"):(c.playerHead_self.visible=!0,c.guildHead_self.visible=!1,c.lb_rank_self.text=i.rank,c.playerHead_self.updateData({vo:r}),c.lb_name_self.text=r.name,c.item_fightCap_self.visible=!0,c.item_fightCap_self.update(r.fightCap))})},o.prototype.updateTop3Rank=function(e,t){var i=this.CONFIG[this.tabbar.selectedIndex],o=this["playerHead_"+e],n=this["guildHead_"+e],a=(this["gp_info_"+e],this["lb_name_"+e]),r=this["lb_fightCap_"+e];i.isGuild?(o.visible=!1,n.visible=!0,n.updateData({vo:t.guildBaseInfo}),r.text=t.guildBaseInfo.fightCap.toString(),a.text=t.guildBaseInfo.name):(o.visible=!0,n.visible=!1,o.updateData({vo:t.playerBaseInfo}),r.text=t.playerBaseInfo.fightCap.toString(),a.text=t.playerBaseInfo.name)},o.prototype._activateComponent=function(){var i=this;function e(t){o["playerHead_"+(t+1)].addTapEvent(function(){var e=i.curRanks&&i.curRanks.ranks[t];e&&(h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N),e.playerBaseInfo&&e.playerBaseInfo.playerId&&h.AppFacade.getInstance().showSubView(h.FriendMediator.N,h.FriendMediator.SV.INFO,{playerId:e.playerBaseInfo.playerId})),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)})}this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this);for(var o=this,t=0;t<3;++t)e(t)},o.VIEW_TYPE={FIGHTCAP:0,LEVEL:1,GUILD:2},o);function o(){var e,t=i.call(this)||this;return t.CONFIG=((e={})[o.VIEW_TYPE.FIGHTCAP]={title:"战力榜",rankType:RankingType.RankingTypeFightCap,keyword:"战力",isGuild:!1,source:{up:"_btn_yq_m_json.common_yeqian_zhanli_0",down:"_btn_yq_m_json.common_yeqian_zhanli_1"}},e[o.VIEW_TYPE.LEVEL]={title:"等级榜",rankType:RankingType.RankingTypeLevel,keyword:"等级",isGuild:!1,source:{up:"_btn_yq_m_json.common_yeqian_dengjii_0",down:"_btn_yq_m_json.common_yeqian_dengjii_1"}},e[o.VIEW_TYPE.GUILD]={title:"公会榜",rankType:RankingType.RankingTypeGuild,keyword:"公会",isGuild:!0,source:{up:"_btn_yq_m_json.common_yeqian_gonghui_0",down:"_btn_yq_m_json.common_yeqian_gonghui_1"}},e),t.skinName="MainRankViewSkin",t.rankProxy=h.AppFacade.getInstance().retrieveProxy(h.RankPy.N),t}h.MainRankPanel=e,__reflect(e.prototype,"game.MainRankPanel");var t,n=(t=eui.ItemRenderer,__extends(a,t),a.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.playerHead.addTapEvent(function(){h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N),e.data.rankInfo.playerBaseInfo&&e.data.rankInfo.playerBaseInfo.playerId&&h.AppFacade.getInstance().showSubView(h.FriendMediator.N,h.FriendMediator.SV.INFO,{playerId:e.data.rankInfo.playerBaseInfo.playerId}),Utils.SoundManager.playSound2(SOUND_EFF_TYPE.btn_tap)})},a.prototype.dataChanged=function(){var e=this.data.config,t=this.data.rankInfo;if(this.lb_rank.text=t.rank.toString()||"",e.isGuild){var i=t.guildBaseInfo;this.playerHead.visible=!1,this.guildHead.visible=!0,this.guildHead.updateData({vo:i}),this.lb_name.text=i.name,this.item_fightCap.update(i.fightCap)}else{var o=t.playerBaseInfo;this.playerHead.visible=!0,this.guildHead.visible=!1,this.playerHead.updateData({vo:o}),this.lb_name.text=o.name,this.item_fightCap.update(o.fightCap)}},a);function a(){var e=t.call(this)||this;return e.skinName="MainRankPanel_RankItem",e}__reflect(n.prototype,"MainRankPanel_RankItem")}(game=game||{}),function(u){var e=(t.Config={TEMPLATE:{rankType:void 0,keywordIcon:void 0,getExtraItem:function(e){},updateExtraItem:function(e,t){}},WORLD_KING_RANK:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,keyWord:"段位",rankType:RankingType.RankingTypeWorldWorldKing,getExtraItem:function(e){var t=new customui.WorldKingBadge;return t.scaleX=t.scaleY=.14,t.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.WORLD_KING,grade:e.key,fromRank:!0}),t},updateExtraItem:function(e,t){e.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.WORLD_KING,grade:t.key,fromRank:!0})}}],WORLD_KING_REWARD:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){return i(RankingType.RankingTypeWorldWorldKing)},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=u.AppFacade.getInstance().retrieveProxy(u.WorldKingPy.N).worldKingInfo.cWorldRank;e.topRank=t;var i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeWorldWorldKing);for(var o in i){var n=i[o];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}},{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,title:"成就奖励",desc:["成就","奖励"],getRewardList:function(){function e(e){var t=p[e],i=u.Config.worldKingLevelConfig()[JSON.parse(t.key)[0]],o=-1!=h.indexOf(t.code),n=!o&&l.hLevel>=JSON.parse(t.key)[0],a=t.code,r=void 0;r=o?REWARD_STATUS.RECEIVED:n?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,d.push({desc:"段位达到"+i.name,requestRank:a,pbMax:c,pbValue:a,status:r,rewards:t.rewards,btnFunc:function(){s.GetReward({type:t.type,id:t.code})}})}var s=u.AppFacade.getInstance().retrieveProxy(u.WorldKingPy.N),c=s.worldKingInfo.cWorldRank,l=s.worldKingInfo,h=JSON.parse(l.gotRewards),p=u.Config.worldKingRewardConfig(WorldKingRewardType.Level),d=[];for(var t in p)e(t);return d.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),d},bottomBtn:{label:"一键领取",callback:function(){u.AppFacade.getInstance().retrieveProxy(u.WorldKingPy.N).GetReward({type:1,id:0})}}}]}],ACTIVITY_QUORA:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){var e=i(RankingType.RankingTypeNewZoneActivityQuora);for(var t in e)e[t].backColor=!0;return e},img_bestRank:"jsjhd_txt_nddqpm_png",getTopRankInfo:function(){var e,t={topRank:void 0,desc:"描述：",targetRewards:[]},i=u.GameMVC.rankPy.getSelfRank(RankingType.RankingTypeNewZoneActivityQuora);e=t.topRank=i&&i.rank||999,t.topRank=e;var o=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeNewZoneActivityQuora);for(var n in o){var a=o[n];e>=a.rankUpper&&e<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],SF_ACTIVITY_QUORA:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){var e=i(RankingType.RankingTypeNewZoneActivityQuora1);for(var t in e)e[t].backColor=!0;return e},img_bestRank:"jsjhd_txt_nddqpm_png",getTopRankInfo:function(){var e,t={topRank:void 0,desc:"描述：",targetRewards:[]},i=u.GameMVC.rankPy.getSelfRank(RankingType.RankingTypeNewZoneActivityQuora1);e=t.topRank=i&&i.rank||"暂无排名",t.topRank=e;var o=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeNewZoneActivityQuora1);for(var n in o){var a=o[n];e>=a.rankUpper&&e<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],ARENA:{rankType:RankingType.RankingTypeArena,type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK},ARENA2:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){return i(RankingType.RankingTypeArena)},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=u.AppFacade.getInstance().retrieveProxy(u.ArenaPy.N).arenaInfo.hRank;e.topRank=t;var i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeArena);for(var o in i){var n=i[o];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}},{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,title:"成就奖励",desc:["成就","奖励"],notice:NT.ARENA_REWARD_LINQU,getRewardList:function(){function e(e){var t=s[e],i=t.rank;if(!i)return"continue";var o=REWARD_STATUS.UNAVAILABLE;-1!=a.indexOf(t.rank)?o=REWARD_STATUS.RECEIVED:n<=i&&(o=REWARD_STATUS.AVAILABLE),c.push({desc:"排名达到"+i+"名",requestRank:i,pbMax:r,pbValue:i,status:o,rewards:t.rewards,btnFunc:function(){Utils.Socket.send("arena","ReceiveHRankReward",{rank:i}).then(function(e){u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N).handleClientReward(e.clientReward,2),u.AppFacade.getInstance().retrieveProxy(u.ArenaPy.N).arenaInfo.update(e.arenaInfo),u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}})}var t=u.AppFacade.getInstance().retrieveProxy(u.ArenaPy.N),n=t.arenaInfo.hRank,a=t.arenaInfo.hRankTargeted,r=t.arenaInfo.rank,s=u.Config.arena_hRankReward(),c=[];for(var i in s)e(i);return c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),c},bottomBtn:{label:"一键领取",callback:function(){Utils.Socket.send("arena","ReceiveHRankReward",{rank:0}).then(function(e){u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N).handleClientReward(e.clientReward,2),u.AppFacade.getInstance().retrieveProxy(u.ArenaPy.N).arenaInfo.update(e.arenaInfo),u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}}}]}],WORLD_BOSS_RANK:{configs:[{rankType:RankingType.RankingTypePlayerServerBossHurt,keyWord:"伤害",title:"日排行"}]},WORLD_BOSS_REWARD:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"日奖励",getRewardList:function(){return i(RankingType.RankingTypePlayerServerBossHurt,{backColor:!0})},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypePlayerServerBossHurt,function(e){i=t.topRank=e.selfRank.rank});var o=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypePlayerServerBossHurt);for(var n in o){var a=o[n];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],WORLD_BOSS_ACHIEVE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){function e(e){var t=l[e].id,i=void 0,o=0<=s.indexOf(t),n=l[e].rankUpper,a=n<=c;i=o?REWARD_STATUS.RECEIVED:a?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,h.push({desc:"挑战BOSS"+n+"次",requestRank:n,status:i,rewards:l[e].rewards,btnFunc:function(){r.GetPlayerTimesReward(t,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}})}var r=u.AppFacade.getInstance().retrieveProxy(u.WorldBossPy.N),t=r.playerInfo||r.temInfo.playerBossInfo,s=JSON.parse(t.timesReward),c=t.challengeTimes,l=u.Config.serverBossReward(2),h=[];for(var i in l)e(i);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),h},bottomBtn:{label:"一键领取",callback:function(){u.AppFacade.getInstance().retrieveProxy(u.WorldBossPy.N).GetPlayerTimesReward(0,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}}}]}],HERO_SPRITE_RANK:{configs:[{rankType:RankingType.RankingTypeHeroSpirit,keyWord:"激活页数",title:"排行"}]},HERO_SPRITE_ACHIEVE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){function e(e){var t=l[e].id,i=void 0,o=0<=s.indexOf(t),n=l[e].num,a=n<=c;i=o?REWARD_STATUS.RECEIVED:a?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,h.push({desc:"激活"+n+"页",request:n,status:i,rewards:l[e].rewards,btnFunc:function(){r.GetHeroSpiritAchievementRewards(t,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}})}var r=u.GameMVC.heroSpiritPy,s=JSON.parse(r.achieveTargeted),c=r.getAllLevelInfo(),l=u.Config.heroSpriteAchievementReward(),h=[];for(var t in l)e(t);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.request-t.request}),h},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.heroSpiritPy.GetHeroSpiritAchievementRewards(0,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}}}]}],GUILD_BOSS:[{rankType:RankingType.RankingTypeGuildBoss,keyWord:"伤害"}],GUILD_COPY:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeGuildTranscript,keyWord:"伤害",getRankList:function(){var e=u.AppFacade.getInstance().retrieveProxy(u.GuildInstancePy.N).upGuildTranscriptBossInfo.killInfo,t=[];for(var i in e){var o=e[i];t.push({rank:Number(i)+1,playerBaseInfo:o.baseInfo,key:o.num})}return t},getRank:function(){var e,t,i=u.AppFacade.getInstance().retrieveProxy(u.GuildInstancePy.N),o=u.AppFacade.getInstance().retrieveProxy(u.PlayerPy.N),n=o.playerInfoVO.playerId,a=1,r=i.upGuildTranscriptBossInfo.killInfo;for(var s in r){var c=r[s];c.baseInfo.playerId==n?(e=c,t=Number(s)+1):a++}var l=[];return l.push({rank:t||a,playerBaseInfo:o.playerInfoVO,key:e?e.num:0}),l}},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){var e=u.AppFacade.getInstance().retrieveProxy(u.GuildInstancePy.N).upGuildTranscriptBossInfo.sectionId,t=u.Config.getGuildtranscriptRewardConfig(),i=[];for(var o in t){var n=t[o];n.sectionId==e&&i.push({rank:0<n.rankLower-n.rankUpper?9999<=n.rankLower?n.rankUpper+"-":n.rankUpper+"-"+n.rankLower:n.rankUpper,rewards:n.rewards,index:n.rankUpper,backColor:!0})}i.sort(function(e,t){return e.index-t.index});var a=u.AppFacade.getInstance().retrieveProxy(u.GuildInstancePy.N).upGuildTranscriptBossInfo.sectionId,r=u.Config.getGuildtranscriptConfig()[a];return r&&(i=[{icon:"jjc_icon_pm_jisha_png",rewards:JSON.parse(r.killRewards),backColor:!0}].concat(i)),i},getTopRankInfo:function(){var e,t={topRank:void 0,desc:"描述：",targetRewards:void 0},i=u.AppFacade.getInstance().retrieveProxy(u.GuildInstancePy.N),o=u.AppFacade.getInstance().retrieveProxy(u.PlayerPy.N).playerInfoVO.playerId,n=i.upGuildTranscriptBossInfo.killInfo;for(var a in n)n[a].baseInfo.playerId==o&&(e=Number(a)+1);t.topRank=e||1;var r=i.upGuildTranscriptBossInfo.sectionId,s=u.Config.getGuildtranscriptConfig()[r];if(s){var c=JSON.parse(s.challengeRewards);t.targetRewards=c}return t.desc="每次挑战时，可以获得以下奖励",t}}]}],GUILD_WAR:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeGuildWarScore,keyWord:"积分",isGuild:!0},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){return i(RankingType.RankingTypeGuildWarScore,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:void 0,topRank:1,desc:"每次公会战胜利，可获得以下奖励："},t=u.AppFacade.getInstance().retrieveProxy(u.GuildWarPy.N);return e.targetRewards=t.constValue.GuildWarDailyRewards[0],e}}]}],CHAMPION:{rankType:RankingType.RankingTypeChampion,keyWord:"关卡数"},DeepNest:{rankType:RankingType.RankingTypeAbyssLair,keyWord:"总星数"},FishingRank:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeActivityZoneFishing,keyWord:"总积分"},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityZoneFishing,{backColor:!0})}}]}],ZoneDevoteGoods:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeActivityZoneDevoteGoodsRank,keyWord:"祈愿积分"},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityZoneDevoteGoodsRank,{backColor:!0})}}]}],ActivityNewZoneConsumeRank:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeActivityNewZoneConsumeRank,keyWord:"祈愿积分"},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityNewZoneConsumeRank,{backColor:!0})}}]}],ActivityNewZoneConsumeRank1:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityNewZoneConsumeRank1,{backColor:!0})}}]}],TopFarmMoneyRank:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeNewZoneActivityTopFarmMoneyRank,{backColor:!0})}}]}],NewZoneZongZiGradeRank:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeActivityNewZoneZongZiGradeRank,keyWord:"粽子积分"},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityNewZoneZongZiGradeRank,{backColor:!0})}}]}],DragonBoatGradeRank:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeActivityNewZoneDragonBoatGradeRank,keyWord:"龙舟里程"},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityNewZoneDragonBoatGradeRank,{backColor:!0})}}]}],TEAM_COPY:{rankType:RankingType.RankingTypeTeamExpedition,keyWord:"关卡数"},TEAM_BOSS:{rankType:RankingType.RankingTypeTeamBoss,keyWord:"关卡数"},RankingTypeGloryArena:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeGloryArena,keyWord:"积分"},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){return i(RankingType.RankingTypeGloryArena,{backColor:!0})},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeGloryArena,function(e){i=t.topRank=e.selfRank.rank});var o=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeGloryArena);for(var n in o){var a=o[n];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],RankingTypeRaceTowerHuman:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeRaceTowerHuman,keyWord:"通关关卡数"}],RankingTypeRaceTowerOrc:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeRaceTowerOrc,keyWord:"通关关卡数"}],RankingTypeRaceTowerElf:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeRaceTowerElf,keyWord:"通关关卡数"}],RankingTypeRaceTowerAthanasy:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeRaceTowerAthanasy,keyWord:"通关关卡数"}],RankingTypeRaceTowerDemonNEldar:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeRaceTowerDemonNEldar,keyWord:"通关关卡数"}],TEAM_ARENA_RANK:[{rankType:RankingType.RankingTypeTeamArena,keyWord:"积分",isTeam:!0}],TEAM_ARENA_REWARD:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"本服奖励",getRewardList:function(){return i(RankingType.RankingTypeTeamArenaMatch,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=u.AppFacade.getInstance().retrieveProxy(u.BattleZoneArenaPy.N).arenaInfo.teamInfo.rank;e.topRank=t;var i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeTeamArena);for(var o in i){var n=i[o];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}},{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"晋级奖励",getRewardList:function(){var e=i(RankingType.RankingTypeTeamArenaEliminate),t=JSON.parse(u.Config.constConfig().TeamArenaVoteConfig.constValue);return t&&(e=[{icon:"zdjj_icon_toupiao_png",rewards:t[1]}].concat(e)),e},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=u.AppFacade.getInstance().retrieveProxy(u.BattleZoneArenaPy.N).arenaInfo.teamInfo.rank;e.topRank=t;var i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeTeamArena);for(var o in i){var n=i[o];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}}]}],TEAMCOPY:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){function e(e){var t=l[e],i=-1!=c.indexOf(t.id),o=!i&&s.sectionId>=t.id,n=t.id,a=void 0;a=i?REWARD_STATUS.RECEIVED:o?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,h.push({desc:"通关第"+u.Config.teamExpedition()[n].chapterId+"章"+u.Config.teamExpedition()[n].name,requestRank:n,pbMax:r,pbValue:n,status:a,rewards:t.rewards,btnFunc:function(){Utils.Socket.send("teamExpedition","GetTeamExpeditionRewards",{sectionId:n}).then(function(e){u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N).handleClientReward(e.clientReward,2),u.AppFacade.getInstance().retrieveProxy(u.TeamExpePy.N).info.update(e.info),u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD),NoticeManager.updateNotice(NT.TEAM_EXPE_REWARD)})}})}var t=u.AppFacade.getInstance().retrieveProxy(u.TeamExpePy.N),r=t.info.sectionId,s=t.info,c=s.targeted,l=u.Config.teamRewardConfig(),h=[];for(var i in l)e(i);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),h},bottomBtn:{label:"一键领取",callback:function(){Utils.Socket.send("teamExpedition","GetTeamExpeditionRewards",{sectionId:0}).then(function(e){u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N).handleClientReward(e.clientReward,2),u.AppFacade.getInstance().retrieveProxy(u.TeamExpePy.N).info.update(e.info),u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD),NoticeManager.updateNotice(NT.TEAM_EXPE_REWARD)})}}}]}],HERO_CHALLENGE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeHeroChallenge,keyWord:"关卡数"}],ZZQ_RANK:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,keyWord:"段位",rankType:RankingType.RankingTypeChessGrade,getExtraItem:function(e){var t=new customui.WorldKingBadge;return t.scaleX=t.scaleY=.14,t.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.ZZQ,grade:e.key,fromRank:!0}),t},updateExtraItem:function(e,t){e.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.ZZQ,grade:t.key,fromRank:!0})},blockTouch:!0},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){return i(RankingType.RankingTypeChessGrade,{backColor:!0})},getTopRankInfo:function(){var e={topRank:u.GameMVC.zzqPy.curPlayer.maxRank,desc:"描述：",targetRewards:[]},t=u.GameMVC.rankPy.getSelfRank(RankingType.RankingTypeChessGrade).rank,i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeChessGrade);for(var o in i){var n=i[o];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}}]}],GACHA_HIGH_ACHIEVMENT:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,mainTitle:"成就",configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){function e(e){var t=l[e];if(t.type==GashaponType.High){var i=t.times,o=-1!=s.timesTargeted.indexOf(t.code),n=!o&&i<=c,a=void 0;a=o?REWARD_STATUS.RECEIVED:n?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,h.push({desc:"高级招募"+i+"次",pbMax:i,pbValue:c,status:a,rewards:t.rewards,btnFunc:function(){r.GetTimesRewards(GashaponType.High,t.code,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}})}}var r=u.GameMVC.heroPy,s=r.gashaponInfo[GashaponType.High],c=s.hTimes,l=u.Config.gashaponTimes(),h=[];for(var t in l)e(t);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.pbMax-t.pbMax}),h},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.heroPy.GetTimesRewards(GashaponType.High,0,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}},getBottomLeftLabel:function(){return"已完成次数："+u.GameMVC.heroPy.gashaponInfo[GashaponType.High].hTimes}}]}],GACHA_RACE_ACHIEVMENT:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,mainTitle:"成就",configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){function e(e){var t=l[e];if(t.type==GashaponType.Race){var i=t.times,o=-1!=s.timesTargeted.indexOf(t.code),n=!o&&i<=c,a=void 0;a=o?REWARD_STATUS.RECEIVED:n?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,h.push({desc:"时空召唤"+i+"次",pbMax:i,pbValue:c,status:a,rewards:t.rewards,btnFunc:function(){r.GetTimesRewards(GashaponType.Race,t.code,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}})}}var r=u.GameMVC.heroPy,s=r.gashaponInfo[GashaponType.Race],c=s.hTimes,l=u.Config.gashaponTimes(),h=[];for(var t in l)e(t);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.pbMax-t.pbMax}),h},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.heroPy.GetTimesRewards(GashaponType.Race,0,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}},getBottomLeftLabel:function(){return"已完成次数："+u.GameMVC.heroPy.gashaponInfo[GashaponType.Race].hTimes}}]}],STORM_WAR_RANK:{configs:[{rankType:RankingType.RankingTypeActivityStormWarPlayer,keyWord:"积分",title:"个人排行"},{rankType:RankingType.RankingTypeActivityStormWarGuild,keyWord:"积分",title:"公会排行",isGuild:!0}]},STORM_WAR_REWARD:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"个人奖励",getRewardList:function(){var e=i(RankingType.RankingTypeActivityStormWarPlayer,{backColor:!0});return e=[{icon:"_stormWar_m_json.fbzc_icon_guanjun",rewards:JSON.parse(u.Config.constConfig().StormWarChampionAccountRewards.constValue),backColor:!0}].concat(e)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeActivityStormWarPlayer,function(e){i=t.topRank=e.selfRank&&e.selfRank.rank||0});var o=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeActivityStormWarPlayer);for(var n in o){var a=o[n];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}},{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"公会奖励",getRewardList:function(){return i(RankingType.RankingTypeActivityStormWarGuild)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeActivityStormWarGuild,function(e){i=t.topRank=e.selfRank.rank});var o=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeActivityStormWarGuild);for(var n in o){var a=o[n];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],STORM_WAR_ACHIEVE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){function e(e){var t=s[e],i=t.score,o=void 0;o=a.some(function(e){return e.rewardId===t.code})?REWARD_STATUS.RECEIVED:i<=r?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,c.push({desc:"积分达到"+i,requestRank:i,status:o,rewards:t.rewards,btnFunc:function(){n.GetRewards(1,t.code,function(e){u.GameMVC.backpackPy.handleClientReward(e.clientReward),u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}})}var n=u.GameMVC.stormWarPy,a=n.selfPlayer.targeted,r=n.selfPlayer.score,s=u.Config.stormWarRewards(),c=[];for(var t in s)e(t);return c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),c},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.stormWarPy.GetRewards(2,0,function(e){u.GameMVC.backpackPy.handleClientReward(e.clientReward),u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}}}]}],MANOR_RANK:{configs:[{rankType:RankingType.RankingTypeManorPlayer,keyWord:"积分",title:"个人排行"},{rankType:RankingType.RankingTypeManorGuild,keyWord:"积分",title:"公会排行",isGuild:!0}]},MANOR_REWARD:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"个人奖励",getRewardList:function(){return i(RankingType.RankingTypeManorPlayer,{backColor:!0})},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeManorPlayer,function(e){i=t.topRank=e.selfRank&&e.selfRank.rank||0});var o=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeManorPlayer);for(var n in o){var a=o[n];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}},{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"公会奖励",getRewardList:function(){return i(RankingType.RankingTypeManorGuild)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeManorGuild,function(e){i=t.topRank=e.selfRank.rank});var o=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeManorGuild);for(var n in o){var a=o[n];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],TRIBE_BATTLE_RANK:{configs:[{rankType:RankingType.RankingTypeTribeBattlePlayer,keyWord:"积分",title:"个人排行"},{rankType:RankingType.RankingTypeTribeBattleGuild,keyWord:"积分",title:"公会排行",isGuild:!0}]},TRIBE_BATTLE_REWARD:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"个人奖励",getRewardList:function(){return i(RankingType.RankingTypeTribeBattlePlayer,{backColor:!0})},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeTribeBattlePlayer,function(e){i=t.topRank=e.selfRank&&e.selfRank.rank||0});var o=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeTribeBattlePlayer);for(var n in o){var a=o[n];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}},{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"公会奖励",getRewardList:function(){return i(RankingType.RankingTypeTribeBattleGuild)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypeTribeBattleGuild,function(e){i=t.topRank=e.selfRank&&e.selfRank.rank||0});var o=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeTribeBattleGuild);for(var n in o){var a=o[n];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],TRIBE_BATTLE_ACHIEVE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,title:"个人奖励",getRewardList:function(){function e(e){var t=s[e];if(t.rewardsType===TribeBattleAchieveType.SelfAchieve){var i=t.goods,o=void 0;o=r.private.some(function(e){return e.rewardId===t.code})?REWARD_STATUS.RECEIVED:i<=a?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,c.push({desc:"个人物资达到"+i,backColor:!0,requestRank:i,status:o,rewards:t.rewards,btnFunc:function(){n.GetAchieveRewards({type:TribeBattleAchieveType.SelfAchieve,code:t.code,oneKey:0,cb:function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)}})}})}}var n=u.GameMVC.tribeBattlePy,t=n.battleInfo.playerInfo,a=t.playerMaxGoods,r=t.targeted,s=u.Config.tribeBattleRewards(),c=[];for(var i in s)e(i);return c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),c},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.tribeBattlePy.GetAchieveRewards({type:TribeBattleAchieveType.SelfAchieve,code:0,oneKey:1,cb:function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)}})}}},{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,title:"公会奖励",getRewardList:function(){function e(e){var t=s[e];if(t.rewardsType===TribeBattleAchieveType.GuildAchieve){var i=t.goods,o=void 0;o=r.guild.some(function(e){return e.rewardId===t.code})?REWARD_STATUS.RECEIVED:i<=a?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,c.push({desc:"公会物资达到"+i,requestRank:i,status:o,rewards:t.rewards,btnFunc:function(){n.GetAchieveRewards({type:TribeBattleAchieveType.GuildAchieve,code:t.code,oneKey:0,cb:function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)}})}})}}var n=u.GameMVC.tribeBattlePy,t=n.battleInfo.playerInfo,a=t.guildMaxGoods,r=t.targeted,s=u.Config.tribeBattleRewards(),c=[];for(var i in s)e(i);return c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),c},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.tribeBattlePy.GetAchieveRewards({type:TribeBattleAchieveType.GuildAchieve,code:0,oneKey:1,cb:function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)}})}}}]}],PEAK_WAR_RANK_FREE:{configs:[{rankType:RankingType.RankingTypePeakWarFreedom,keyWord:"积分",title:"个人排行"}]},PEAK_WAR_RANK_HIGH:{configs:[{rankType:RankingType.RankingTypePeakWarHighLadder,title:"个人排行"}]},PEAK_WAR_REWARD_FREE:{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){return i(RankingType.RankingTypePeakWarFreedom,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=e.topRank=u.GameMVC.peakWarPy.freeInfo.rank,i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypePeakWarFreedom);for(var o in i){var n=i[o];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}},{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,title:"挑战奖励",notice:NT.PEAK_WAR_REWARD_FREE_TAB,getRewardList:function(){function e(e){var t=s[e],i=t.target,o=void 0;o=r.some(function(e){return e===t.code})?REWARD_STATUS.RECEIVED:i<=a?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,c.push({desc:"获胜"+i+"次",requestRank:i,status:o,rewards:t.rewards,btnFunc:function(){n.FreedomGetDailyReward({code:t.code,cb:function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)}})}})}var n=u.GameMVC.peakWarPy,t=n.freeInfo,a=t.winCount,r=t.dailyTargeted,s=u.Config.peakWarFreeReward(),c=[];for(var i in s)e(i);return c.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),c},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.peakWarPy.FreedomGetDailyReward({code:0,cb:function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)}})}}}]},PEAK_WAR_REWARD_HIGH:{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){return i(RankingType.RankingTypePeakWarHighLadder,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=e.topRank=u.GameMVC.peakWarPy.highInfo&&u.GameMVC.peakWarPy.highInfo.hRank||0,i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypePeakWarHighLadder);for(var o in i){var n=i[o];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}}]},WORLD_KING_RANK_SINGLE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,keyWord:"段位",rankType:RankingType.RankingTypeServerWorldKing,getExtraItem:function(e){var t=new customui.WorldKingBadge;return t.scaleX=t.scaleY=.14,t.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.WORLD_KING,grade:e.key,fromRank:!0}),t},updateExtraItem:function(e,t){e.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.WORLD_KING,grade:t.key,fromRank:!0})}}],WORLD_KING_REWARD_SINGLE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"排名奖励",getRewardList:function(){return i(RankingType.RankingTypeServerWorldKing)},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=u.GameMVC.worldKingPy.worldKingInfo.cWorldRank;e.topRank=t;var i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeServerWorldKing);for(var o in i){var n=i[o];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}},{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,title:"成就奖励",desc:["成就","奖励"],getRewardList:function(){function e(e){var t=h[e],i=u.Config.worldKingLevelConfig()[JSON.parse(t.key)[0]],o=-1!=l.indexOf(t.code),n=!o&&c.hLevel>=JSON.parse(t.key)[0],a=t.code,r=void 0;r=o?REWARD_STATUS.RECEIVED:n?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,p.push({desc:"段位达到"+i.name,backColor:!0,requestRank:a,pbMax:s,pbValue:a,status:r,rewards:t.rewards,btnFunc:function(){u.GameMVC.worldKingPy.GetReward({type:t.type,id:t.code})}})}var s=u.GameMVC.worldKingPy.worldKingInfo.cWorldRank,c=u.GameMVC.worldKingPy.worldKingInfo,l=JSON.parse(c.gotRewards),h=u.Config.worldKingRewardConfig(WorldKingRewardType.SingleLevel),p=[];for(var t in h)e(t);return p.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),p},bottomBtn:{label:"一键领取",callback:function(){u.GameMVC.worldKingPy.GetReward({type:WorldKingRewardType.SingleLevel,id:0})}}}]}],TEAM_ARENA_RANK_SINGLE:[{rankType:RankingType.RankingTypeTeamArena,keyWord:"积分",isTeam:!0}],TEAM_ARENA_REWARD_SINGLE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){return i(RankingType.RankingTypeTeamArenaEliminateSingle,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:[]},t=u.GameMVC.battleZoneArenaPy.arenaInfo.teamInfo.rank;e.topRank=t;var i=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeSingleTeamArena);for(var o in i){var n=i[o];t>=n.rankUpper&&t<=n.rankLower&&(e.targetRewards=JSON.parse(n.rewards))}return e.desc="保持当前排名，结算后可获得奖励",e}}]}],WORLD_BOSS_RANK_SINGLE:{configs:[{rankType:RankingType.RankingTypePlayerServerBossHurt,keyWord:"伤害",title:"日排行"}]},WORLD_BOSS_REWARD_SINGLE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"日奖励",getRewardList:function(){return i(RankingType.RankingTypeSinglePlayerServerBossHurt)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypePlayerServerBossHurt,function(e){i=t.topRank=e.selfRank.rank});var o=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeSinglePlayerServerBossHurt);for(var n in o){var a=o[n];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}],WORLD_BOSS_ACHIEVE_SINGLE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.SCORE_REWARD2,topTitle:!0,getRewardList:function(){function e(e){var t=l[e].id,i=void 0,o=0<=s.indexOf(t),n=l[e].rankUpper,a=n<=c;i=o?REWARD_STATUS.RECEIVED:a?REWARD_STATUS.AVAILABLE:REWARD_STATUS.UNAVAILABLE,h.push({desc:"挑战BOSS"+n+"次",requestRank:n,status:i,rewards:l[e].rewards,btnFunc:function(){r.GetPlayerTimesReward(t,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}})}var r=u.AppFacade.getInstance().retrieveProxy(u.WorldBossPy.N),t=r.playerInfo||r.temInfo.playerBossInfo,s=JSON.parse(t.timesReward),c=t.challengeTimes,l=u.Config.serverBossReward(2),h=[];for(var i in l)e(i);return h.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.requestRank-t.requestRank}),h},bottomBtn:{label:"一键领取",callback:function(){u.AppFacade.getInstance().retrieveProxy(u.WorldBossPy.N).GetPlayerTimesReward(0,function(){u.AppFacade.getInstance().updateView(u.RankMediator.N,u.RankMediator.SV.COMMON_REWARD)})}}}]}],GUILD_WAR_SINGLE:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.RANK,rankType:RankingType.RankingTypeGuildWarScore,keyWord:"积分",isGuild:!0},{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,getRewardList:function(){return i(RankingType.RankingTypeSingleGuildWarScore,{backColor:!0})},getTopRankInfo:function(){var e={topRank:void 0,desc:"描述：",targetRewards:void 0,topRank:1,desc:"每次公会战胜利，可获得以下奖励："},t=u.AppFacade.getInstance().retrieveProxy(u.GuildWarPy.N);return e.targetRewards=t.constValue.GuildWarDailyRewards[0],e}}]}],RankingTypeIslandBadgeGradeRank:[{type:u.CommonRankAndRewardPanel.VIEW_TYPE.REWARD,configs:[{type:u.CommonRewardPanel.VIEW_TYPE.RANK_REWARD,title:"奖励",getRewardList:function(){return i(RankingType.RankingTypeIslandBadgeGradeRank)},getTopRankInfo:function(){var t={topRank:void 0,desc:"描述：",targetRewards:[]},e=u.AppFacade.getInstance().retrieveProxy(u.RankPy.N),i=99999;e.GetRankList(RankingType.RankingTypePlayerServerBossHurt,function(e){i=t.topRank=e.selfRank.rank});var o=u.Config.rankingRewardByTypeConfig(RankingType.RankingTypeIslandBadgeGradeRank);for(var n in o){var a=o[n];i>=a.rankUpper&&i<=a.rankLower&&(t.targetRewards=JSON.parse(a.rewards))}return t.desc="保持当前排名，结算后可获得奖励",t}}]}]},t);function t(){}function i(e,t){var i=[],o=u.Config.rankingRewardByTypeConfig(e);for(var n in o){var a=o[n],r={rankSort:a.rankUpper,rank:0<a.rankLower-a.rankUpper?9999<=a.rankLower?a.rankUpper+"-":a.rankUpper+"-"+a.rankLower:a.rankUpper,rewards:a.rewards};if(t)for(var s in t)r[s]=t[s];i.push(r)}return i.sort(function(e,t){return e.rankSort-t.rankSort}),i}u.RankConfig=e,__reflect(e.prototype,"game.RankConfig")}(game=game||{});var Main=function(a){function e(){var e=null!==a&&a.apply(this,arguments)||this;return e.test=!1,e}return __extends(e,a),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];egret.log.apply(egret,["【Main】:"].concat(e))},e.prototype.createChildren=function(){var i=this;a.prototype.createChildren.call(this),this.log("__CUR_JS_NAME__:",window.__CUR_JS_NAME__);var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.addChild(GameRootLayer.gameLayer()),this.loadingView=new EasyLoadingUI,GameRootLayer.gameLayer().loadingUIEasy=this.loadingView,GameRootLayer.gameLayer().loadLayer.addChild(this.loadingView),ResVersionManager.getInstance().init();var t=new egret.HttpRequest;t.responseType=egret.HttpResponseType.TEXT,t.once(egret.Event.COMPLETE,function(e){var t=e.currentTarget;try{i.agentConfig=JSON.parse(t.response)}catch(e){egret.warn(e)}i.runGame()},this);var o="https://cfgdat.binghu.fmggames.cn/binghu_web/agent/qq_xyx/agent_1_43_1.json";do{if(this.checkUrl(o))break;var n="http://";if(Http.isHttps()&&(n="https://"),o=n+o,this.checkUrl(o))break}while(0);this.checkUrl(o)?(t.open(o,egret.HttpMethod.GET),t.send()):(egret.log("agentUrl不合法，进入zauto模式",document.location.protocol,o),this.runGame())},e.prototype.checkUrl=function(e){return/^http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?$/i.test(e)},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),Utils.init(),game.ActivityConfig.init(),this.startUp(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,i,o,n;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,14,,15]),t=8,i=0,GameRootLayer.gameLayer().switchMenLoading(!0),egret.ImageLoader.crossOrigin="anonymous",this.agentConfig&&this.agentConfig.RemoteResHost?this.agentConfig.isChecking&&this.agentConfig.isChecking.PHP?Utils.XYX_REMOTE_RES_HOST=this.agentConfig.RemoteResHost+"_shenhe":Utils.XYX_REMOTE_RES_HOST=this.agentConfig.RemoteResHost:this.agentConfig&&this.agentConfig.RemoteResHostForWeb?Utils.XYX_REMOTE_RES_HOST=this.agentConfig.RemoteResHostForWeb:2==Utils.XYX_REMOTE_RES_HOST.indexOf("XYX_REMOTE_RES_HOST")&&(Utils.XYX_REMOTE_RES_HOST=void 0),o=void 0,o=this.agentConfig&&"test"!=this.agentConfig.AgentCode?(this.log("使用动态配置"),"default.res.json?v="+this.agentConfig.JSVer):(this.log("使用时间戳"),"default.res.json?v="+Date.now()),this.loadingView.setProgress(++i,t),Utils.XYX_REMOTE_RES_HOST?[4,RES.loadConfig(o,Utils.XYX_REMOTE_RES_HOST+"/resource/")]:[3,2];case 1:return e.sent(),[3,4];case 2:return[4,RES.loadConfig(o,"resource/")];case 3:e.sent(),e.label=4;case 4:return this.loadingView.setProgress(++i,t),this.agentConfig?(ResVersionManager.getInstance().loadResVersionComplate(this.agentConfig),this.loadingView.defaultResDone(),[3,7]):[3,5];case 5:return[4,ResVersionManager.getInstance().loadConfig("agent_json")];case 6:e.sent(),this.loadingView.defaultResDone(),e.label=7;case 7:return this.loadingView.setProgress(++i,t),[4,this.loadTheme()];case 8:return e.sent(),this.loadingView.setProgress(++i,t),[4,RES.getResAsync("t_error_code_json")];case 9:return e.sent(),this.loadingView.setProgress(++i,t),[4,RES.getResAsync("t_const_json")];case 10:return e.sent(),this.loadingView.setProgress(++i,t),[4,RES.getResAsync("package_json")];case 11:return e.sent(),Utils.agentConfig.jsPb?[3,13]:(this.loadingView.setProgress(++i,t),[4,RES.getResAsync("game_proto")]);case 12:e.sent(),e.label=13;case 13:return GameRootLayer.gameLayer().switchMenLoading(!1),[3,15];case 14:return n=e.sent(),console.error(n),[3,15];case 15:return[2]}})})},e.prototype.loadTheme=function(){var i=this;return new Promise(function(e,t){new eui.Theme("resource/default.thm.json",i.stage).addEventListener(eui.UIEvent.COMPLETE,function(){e()},i)})},e.prototype.startUp=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.log("startUp"),game.AppFacade.getInstance().startUp(GameRootLayer.gameLayer()),this.test?[3,4]:Utils.agentConfig.OffLineTest?[3,1]:(game.MainJumpConfig.jumpTo("LOGIN"),[3,3]);case 1:return[4,Utils.enterMainOffLine()];case 2:e.sent(),game.MainJumpConfig.jumpTo("GUAJI"),e.label=3;case 3:case 4:return[2]}})})},e}(eui.UILayer);__reflect(Main.prototype,"Main");var TestScreenAdapter=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.calculateStageSize=function(e,t,i,o,n){var a=t,r=i,s=o=720,c=n=1280,l=t/s||0,h=i/c||0,p=t/i;return 20/3<p?(s=o=Math.round(20/3*1280),a=Math.round(o*h)):p<9/16?(c=n=Math.round(1280),r=Math.round(n*l)):s=Math.round(t/h),a%2!=0&&(a+=1),r%2!=0&&(r+=1),{stageWidth:s,stageHeight:c,displayWidth:a,displayHeight:r}},t}(egret.HashObject);__reflect(TestScreenAdapter.prototype,"TestScreenAdapter",["egret.sys.IScreenAdapter"]);var lastScriptURI=void 0;window.onerror=function(e,t,i,o,n){if(Utils.isInit&&lastScriptURI!=t){console.log("错误信息：",e),console.log("出错文件：",t),console.log("出错行号：",i),console.log("出错列号：",o),console.log("错误详情：",n);var a={errorMessage:e,scriptURI:lastScriptURI=t,lineNumber:i,columnNumber:o,errorObj:n&&n.stack&&n.stack.toString()||""},r=game.AppFacade.getInstance().retrieveProxy(game.LoginPy.N),s=game.AppFacade.getInstance().retrieveProxy(game.PlayerPy.N);Utils.Http.toGet({action:"get_error",platform:Utils.agentConfig&&Utils.agentConfig.AgentCode||"",username:r&&r.userVO&&r.userVO.uuid||"空",os_code:Utils.DeviceUtils.getPlatform(),user_agent:window.navigator.userAgent,browser_id:Utils.DeviceUtils.getBrowser(),version_time:(window.__CUR_JS_NAME__?window.__CUR_JS_NAME__.substring(0,6):"")+"_"+(Utils.agentConfig&&Utils.agentConfig.VersionTime),agent_name:Utils.agentConfig&&Utils.agentConfig.AgentName||"",last_events:game.MainJumpConfig.lastEvents.toString(),name:s.playerInfoVO.name,detail:JSON.stringify(a)}).then(function(e){console.log("上报结果",e&&e.msg)}),Utils.SDKMgr.onCustomError(a)}},function(o){var e=(t.registerAll=function(){(new n).register()},t);function t(){}o.RankProcessor=e,__reflect(e.prototype,"game.RankProcessor");var i,n=(i=o.ProcessorBase,__extends(a,i),a.prototype.execute=function(e){var t,i=e.getBody();this.log("CommonRankP",i),o.AppFacade.getInstance().retrieveProxy(o.RankPy.N).updateRankData(i),i.rankType!=RankingType.RankingTypeNewZoneActivityQuora||(t=o.GameMVC.activityMed.getViewByCode(EActivityType.NewZoneQuora))&&t.updateRank(),i.rankType==RankingType.RankingTypeNewZoneActivityQuora1&&(t=o.GameMVC.activityMed.getViewByCode(EActivityType.NewZoneQuora1))&&t.updateRank()},a);function a(){return i.call(this,"ranking.CommonRankP",a)||this}o.CommonRankP=n,__reflect(n.prototype,"game.CommonRankP")}(game=game||{}),function(c){var t,e=(__extends(i,t=BaseProxy),i.prototype.GetRankList=function(e,t){var i=this,o="object"!=typeof e&&e||e.rankType||e.rankingType,n=null!=e.refreshInterval?e.refreshInterval:this.REFRESH_INTERVAL,a=e.isTeam,r=Utils.TimerManager.getServerTime();if(this._rankList[o]&&r-this._rankList[o].dt<n)this.log("获取旧排行榜数据  ",this._rankList[o].rankList),t&&t(this._rankList[o].rankList);else{var s=a?"GetTeamCommonRank":"GetCommonRank";o&&Utils.Socket.send("ranking",s,{rankType:o}).then(function(e){i._rankList[o]||(i._rankList[o]={}),i._rankList[o].rankList=e,i._rankList[o].dt=Utils.TimerManager.getServerTime(),t&&t(i._rankList[o].rankList)})}},i.prototype.getSelfRank=function(e){var t;return this._rankList[e]&&(t=this._rankList[e].rankList.selfRank),t},i.prototype.rankIcon=function(e){var t="";return e<=3&&(t="jjc_icon_pm_"+e+"_png"),t},i.prototype.rankBg=function(e){return 0==e?"common_img_kt_5_png":e<=3?"common_img_kt_"+e:"common_img_kt_4_png"},i.prototype.keywordBg=function(e){return 0==e?"common_img_ktsz_1_png":e<=3?"common_img_ktsz_"+e:"common_img_ktsz_4_png"},i.prototype.updateRankData=function(e){var t=e.rankType,i=e.ranks;this._rankList[t]||(this._rankList[t]={});for(var o={ranks:i,selfRank:void 0},n=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N).playerInfoVO.playerId,a=0,r=i;a<r.length;a++){var s=r[a];if(s.playerId==n||s.playerBaseInfo&&s.playerBaseInfo.playerId==n){o.selfRank=s;break}}this._rankList[t].rankList=o,this._rankList[t].dt=Utils.TimerManager.getServerTime()},i.N="RankProxy",i);function i(){var e=t.call(this,i.N)||this;return e.REFRESH_INTERVAL=15,e._rankList={},e}c.RankPy=e,__reflect(e.prototype,"game.RankPy")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.RechargeView)},n.prototype.initNotice=function(){},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.RECHARGE_GET_DATA,CN.LOGIN_FINAL_DONE,CN.RECHARGE_OPEN]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:case CN.RECHARGE_GET_DATA:this.rechargeProxy.getGoodList();break;case CN.RECHARGE_OPEN:this.updateView(n.SV.MAIN,{viewType:i.RechargeView.VIEW_TYPE.RECHARGE})}},n.N="RechargeMediator",n.SV={MAIN:1},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.rechargeProxy=i.AppFacade.getInstance().retrieveProxy(i.RechargePy.N),t.initNotice(),t}i.RechargeMediator=e,__reflect(e.prototype,"game.RechargeMediator")}(game=game||{}),function(g){var t,e=(__extends(r,t=BaseProxy),r.prototype.getGoodList=function(){var t=this;Utils.Http.toGet({action:"pay_goods_list",os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,area:this.loginProxy.serverSelect.s_id,server_id:this.loginProxy.serverSelect.s_id,playerId:this.playerProxy.playerInfoVO.playerId,zoneid:getUrlKV().platform}).then(function(e){t.goodList=e.recharge,t.monthCard=e.vip_month,g.AppFacade.getInstance().updateView(g.RechargeMediator.N,g.RechargeMediator.SV.MAIN)}).catch(function(e){t.log("异常",e)})},r.prototype.getRechargeInfo=function(){return this.playerProxy.playerInfoVO.playerVip.rechargeInfo},r.prototype.getGoodInfo=function(e){for(var t in this.goodList){var i=this.goodList[t];if(i.id==e)return i}},r.prototype.getMonthCardInfoById=function(e){for(var t in this.monthCard){var i=this.monthCard[t];if(i.id==e)return i}},r.prototype.getOrder=function(t){var i=this,e={action:"getOrder",device_id:"",flag:"custom",gold:this.purchaseInfo.gold,goldEx:this.purchaseInfo.goldEx,level:this.playerProxy.playerInfoVO.level,money:this.purchaseInfo.itemPrice,name:this.purchaseInfo.playerName,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,player_id:this.purchaseInfo.playerId,product_id:this.purchaseInfo.itemId,month_card:this.purchaseInfo.isMonthCard,purchase_type:this.purchaseInfo.type,regist_dt:this.playerProxy.playerInfoVO.createDt,server_id:this.purchaseInfo.serverId,server_name:this.purchaseInfo.serverName,sub_platform:Utils.agentConfig.channelName,udid:"",user_id:this.purchaseInfo.userID,code:this.purchaseInfo.code,itemSDKId:this.purchaseInfo.itemSDKId,itemName:this.purchaseInfo.itemName,modulePayExt:JSON.stringify(this.purchaseInfo.modulePayExt)};Utils.agentConfig.needGetOrderBySDK&&Utils.SDKMgr.cmd({type:"GetOrderBySDK",params:e}),Utils.Http.toGet(e).then(function(e){e&&"ok"==e.status?(i.purchaseInfo.orderID=e.data.order_id,i.purchaseInfo.orderDt=e.data.order_time,Utils.agentConfig.needGetOrderBySDK&&Utils.SDKMgr.cmd({type:"SetOrderBySDK",params:e.data}),t({err:0})):t({err:1})}).catch(function(e){i.log("异常",e),t({err:1})})},r.prototype.testBuy=function(){var t=this;Utils.Http.toGet({action:"test_pay",order_id:this.purchaseInfo.orderID,product_id:this.purchaseInfo.itemId,playerID:this.purchaseInfo.playerId,server_id:this.purchaseInfo.serverId,money:this.purchaseInfo.itemPrice,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,code:this.purchaseInfo.code}).then(function(e){e&&"success"==e.msg?t.buyFinish({res:0}):t.buyFinish({res:1})}).catch(function(e){t.log("异常",e),t.buyFinish({res:1})})},r.prototype.sdkPurchase=function(){this.log("sdkPurchase");var e=getUrlKV(),t=Date.now(),i=""+this.purchaseInfo.orderID+e.guopanAppId+this.purchaseInfo.itemPrice+t+this.loginProxy.userVO.uuid+Utils.agentConfig.SERVER_KEY;this.log("strMd5",i);var o={player_id:this.playerProxy.playerInfoVO.playerId,player_level:this.playerProxy.playerInfoVO.level,area:this.purchaseInfo.serverId,areaName:this.purchaseInfo.serverName,item_id:this.purchaseInfo.itemId,platform:Utils.agentConfig.AgentCode,uuid:this.loginProxy.userVO.uuid,app_store_checking:Utils.agentConfig.other&&Utils.agentConfig.other.app_store_checking&&1==Utils.agentConfig.other.app_store_checking?1:0},n=(new flamd5).hex_md5(i),a={guopanAppId:e.guopanAppId,serialNumber:this.purchaseInfo.orderID,itemId:this.purchaseInfo.itemId,itemSDKId:this.purchaseInfo.itemSDKId,goodsName:this.purchaseInfo.itemName,game_uin:this.loginProxy.userVO.uuid,ext:encodeURI(JSON.stringify(o)),gameUrl:e.gameUrl,time:t,money:this.purchaseInfo.itemPrice,sign:n,name:this.playerProxy.playerInfoVO.name,playerId:this.playerProxy.playerInfoVO.playerId,level:this.playerProxy.playerInfoVO.level,doneCB:function(e){e.msg&&g.GameMgr.getInstance().showCommonTipsWin({noOKBtn:!0,commonTips:e.msg,btnStyle:{cancel:g.CommonTipsDialog.BTN_STYLE.CONFIRM},clickCB:function(e){}})},code:this.purchaseInfo.code};Utils.SDKMgr.goPurchase(a),this.buyFinish({res:0})},r.prototype.buy=function(){0==Utils.agentConfig.thirdUserSystem?this.testBuy():this.sdkPurchase()},r.prototype.buyFinish=function(e){delete this.purchaseInfo,this.purchaseInfo=void 0,this.purchaseCB&&this.purchaseCB(),this.purchaseCB=void 0,0==e.res||Utils.MsgUtils.addMidMsg("充值失败")},r.prototype.isFirstRechargeOpen=function(){var e=g.AppFacade.getInstance().retrieveProxy(g.ActivityPy.N),t=e.allActivityData[EActivityType.SecondGiftBag];return!!t&&!!t.data&&t.data.targeted.length<2&&e.isOpen(EActivityType.SecondGiftBag)},r.prototype.isFirstRechargeOpenAndFirstGift=function(){var e=g.AppFacade.getInstance().retrieveProxy(g.ActivityPy.N),t=e.allActivityData[EActivityType.SecondGiftBag];return!!t&&!!t.data&&t.data.targeted.length<=0&&e.isOpen(EActivityType.SecondGiftBag)},r.prototype.isMonthCardGot=function(){var e=g.AppFacade.getInstance().retrieveProxy(g.ActivityPy.N),t=e.isOpen(EActivityType.MonthCard),i=!1,o=e.allActivityData[EActivityType.MonthCard];return t&&o&&o.data&&1===o.data.flag&&(i=!0),i},r.prototype.getMonthCardInfo=function(){return this.monthCard[0]},r.prototype.getEnjoyCardInfo=function(e){switch(e){case EActivityType.EnjoyCard:return this.monthCard[1];case EActivityType.EnjoyCard1:return this.monthCard[4];case EActivityType.EnjoyCard2:return this.monthCard[5];case EActivityType.EnjoyCard3:return this.monthCard[6];case EActivityType.EnjoyCard4:case EActivityType.EnjoyCard5:case EActivityType.EnjoyCard5:return this.monthCard[7];default:return}},r.prototype.getGrowFund=function(e){var t=0;switch(e){case EActivityType.NewGrowFund:t=401}if(t)for(var i in this.goodList){var o=this.goodList[i];if(o.id==t)return o}},r.prototype.getWholeLifeCardInfo=function(){return this.monthCard[2]},r.prototype.getNewYearCardInfo=function(){return this.monthCard[3]},r.prototype.purchase=function(t,e,i,o,n,a){var r=this;if(void 0===i&&(i=""),void 0===o&&(o=""),this.log("purchase",t.id,t.productid),Utils.SDKMgr.getPerformConfig(3)){var s=g.Config.itemConfig(),c=void 0,l=parseInt(t.id);for(var h in s){var p=s[h];if(p.type==EPropType.EPropTypeRecharge&&(0<=JSON.parse(p.effect).indexOf(l)&&(c=p.id),c))break}if(c){var d=g.AppFacade.getInstance().retrieveProxy(g.BackpackPy.N);if(d.checkEnough([[EEntityType.EEntityTypeItem,c,1]],!1))return void g.GameMgr.getInstance().showCommonTipsWin({costTips:"进行购买",cost:JSON.stringify([[EEntityType.EEntityTypeItem,c,1]]),clickCB:function(e){1==e.type&&d.UseProp(c,1,t.id,!1,o,function(){a&&a()})}})}}if("qqzone_ios"==Utils.agentConfig.AgentCode&&Utils.SDKMgr.getPerformConfig(1)&&Utils.SDKMgr.getPerformConfig(19))g.GameMVC.activityMed.showViewByCode(EActivityType.ShouCangYouLi,{source:"scbz_img_chongzhizhiyin_png"});else if(Utils.SDKMgr.getPerformConfig(1)){var u=Utils.SDKMgr.getPerformConfig(4);Utils.SDKMgr.getPerformConfig(19)?g.GameMVC.activityMed.showViewByCode(EActivityType.ShouCangYouLi):Utils.MsgUtils.addMidMsg(u||"暂未开启")}else this.purchaseInfo?Utils.MsgUtils.addMidMsg("有未完成的支付，请等待结果"):(this.purchaseInfo=new g.PurchaseVO,this.purchaseInfo.count=1,this.purchaseInfo.itemId=t.id,this.purchaseInfo.itemSDKId=t.productid,this.purchaseInfo.itemName=t.productname,this.purchaseInfo.itemPrice=t.price,this.purchaseInfo.gold=t.diamond,this.purchaseInfo.goldEx=0,this.purchaseInfo.orderID="",this.purchaseInfo.isMonthCard=!!t.isMonthCard&&t.isMonthCard,this.purchaseInfo.playerName=this.playerProxy.playerInfoVO.name,this.purchaseInfo.playerId=this.playerProxy.playerInfoVO.playerId,this.purchaseInfo.serverId=this.loginProxy.serverSelect.s_id,this.purchaseInfo.serverName=this.loginProxy.serverSelect.s_name,this.purchaseInfo.type=null==e?0:e,this.purchaseInfo.userID=this.loginProxy.userVO.uuid,this.purchaseInfo.code=i,this.purchaseInfo.modulePayExt=n||{},this.purchaseCB=a,this.getOrder(function(e){0==e.err?r.buy():(Utils.MsgUtils.addMidMsg("获取订单失败"),delete r.purchaseInfo,r.purchaseInfo=void 0,r.purchaseCB=void 0)}))},r.prototype.GetVipLevelGift=function(e,t){var i=this,o=g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N),n=g.Config.VIPUpgradeConfig(),a=JSON.parse(n[e].costs)[0][2];o.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeDiamond]<a?g.GameMgr.getInstance().showCommonTipsWin({commonTips:"很遗憾，您的钻石不足，购买失败",cb:!1,btnLabel:{cancel:"取消",sure:"前往充值"},clickCB:function(e){if(0===e.type);else if(1===e.type){var t=g.AppFacade.getInstance().retrieveProxy(g.ActivityPy.N).allActivityData[EActivityType.FirstRecharge1],i=g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N).playerInfoVO.playerVip,o=g.AppFacade.getInstance().retrieveProxy(r.N).goodList;t&&i.rechargeInfo.count<=0&&0<o.length&&g.MainJumpConfig.jumpTo(MODULE.VIP)}}}):Utils.Socket.send("playerInfo","GetVipLevelGift",{vipLevel:e}).then(function(e){i.log("GetVipLevelGiftR",e),g.AppFacade.getInstance().retrieveProxy(g.BackpackPy.N).handleClientReward(e.clientReward),g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N).playerInfoVO.playerVip.update(e.playerVip),g.AppFacade.getInstance().updateView(g.RechargeMediator.N,g.RechargeMediator.SV.MAIN,{isJump:!0}),t&&t()}).catch(function(e){})},r.prototype.checkVipGiftNotice=function(){for(var e=g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N),t=e.playerInfoVO.playerVip.vipLevel||0,i=1;i<=t;i++)if(!e.playerInfoVO.playerVip.vipGiftGot[i])return!0;return!1},r.N="RechargeProxy",r);function r(){var e=t.call(this,r.N)||this;return e.playerProxy=g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N),e.loginProxy=g.AppFacade.getInstance().retrieveProxy(g.LoginPy.N),e.purchaseInfo=void 0,NoticeManager.setChildType(NT.VIP_MAIN,[NT.VIP_GIFT]),NoticeManager.setChildType(NT.VIP_ENTRANCE,[NT.VIP_GIFT]),NoticeManager.registerCB(NT.VIP_GIFT,e.checkVipGiftNotice,e),e}g.RechargePy=e,__reflect(e.prototype,"game.RechargePy")}(game=game||{}),function(p){var t,e=(__extends(i,t=BasePanel),i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_recharge")},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._activateComponent(),this.initTabbar(),this.initial(),this.addNotice(),this.checkPageBtnStatus(),this.gp_content.scaleX=this.gp_content.scaleY=1,UIActionManager.playUIAction(this.gp_content,1),this.updateQqxyxXingbi(),this.ressourceItem_qqxyx.visible=!!Utils.SDKMgr.getPerformConfig(20001)},i.prototype.updateQqxyxXingbi=function(){var i=this;Utils.SDKMgr.cmd({type:"get_xingbi_money",buyDoneCb:function(){var e=p.GameMVC.rechargeMed.getSubView(p.RechargeMediator.SV.MAIN);e&&e.updateQqxyxXingbi()}},function(e){var t=p.GeneralConfig.getEntityConfigByCode(1,EPropertyType.EPropertyTypeQqxyxXingBi);i.ressourceItem_qqxyx&&(i.ressourceItem_qqxyx.data={icon:t.icon,num:e||0,width:215},i.ressourceItem_qqxyx.updateItem())})},i.prototype.initial=function(){this.vType=i.VIEW_TYPE.RECHARGE,this.list_recharge.itemRenderer=n,UIActionManager.hideScrollerBar(this.scl_recharge),this.list_vip.itemRenderer=s,UIActionManager.hideScrollerBar(this.cu_pageScroller)},i.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar.dataProvider=new eui.ArrayCollection([{source:{up:"_btn_yq_m_json.common_yeqian_zuanshi_0",down:"_btn_yq_m_json.common_yeqian_zuanshi_1"},type:i.VIEW_TYPE.RECHARGE},{source:{up:"_btn_yq_m_json.common_yeqian_tequanlibao_0",down:"_btn_yq_m_json.common_yeqian_tequanlibao_1"},type:i.VIEW_TYPE.PRIVILEGE}]),this.tabbar.selectedIndex=0,this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabbarItemTap,this)},i.prototype.onTabbarItemTap=function(e){e&&null!=e.itemIndex&&e.itemIndex!=this.index&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex);var t=e.item.type;this.switchView(t),this.img_DownNotice.visible=this.gp_notice.parent.visible&&this.gp_notice.parent.$children[1].visible},i.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.VIP_GIFT,this.gp_notice,this,{percentX:4/12})},i.prototype.updateView=function(e){this.rechargeProxy.goodList&&(this.vipInfo=this.playerProxy.playerInfoVO.playerVip,this.updateBaseInfo(),e&&null!=e.viewType&&(this.vType=e.viewType),this.tabbar.selectedIndex=this.vType,this.onTabbarItemTap({item:{type:this.vType}}),this.updateRedPoint()),e&&e.isJump&&this.JumpIndexReward(),NoticeManager.updateNotice(NT.VIP_GIFT)},i.prototype.JumpIndexReward=function(){var e=this;this.isJump&&this.cu_pageScroller.scrollerToPage(this.cu_pageScroller.curPage+this.isJump,!0,function(){e.once(egret.Event.ENTER_FRAME,function(){e.updateRedPoint(),e.checkPageBtnStatus(),e.vipInfo.vipGiftGot[e.cu_pageScroller.curPage+1]&&0<e.cu_pageScroller.curPage&&e.JumpIndexReward()},e)})},i.prototype.switchView=function(e){switch(this.vType=e,this.gp_recharge.visible=!1,this.gp_vip.visible=!1,this.btn_oppr.visible=!0,this.vType){case i.VIEW_TYPE.RECHARGE:this.gp_recharge.visible=!0,this.cu_common_datanchu.blb_title.text="充 值",this.btn_oppr.label="vip特权",this.gp_notice.parent.visible=!0,this.updateRecharge();break;case i.VIEW_TYPE.WELFARE:this.btn_oppr.visible=!1;break;case i.VIEW_TYPE.PRIVILEGE:this.gp_vip.visible=!0,this.cu_common_datanchu.blb_title.text="VIP特权",this.btn_oppr.label="充值",this.gp_notice.parent.visible=!1,this.updateVip();break;case i.VIEW_TYPE.DAILY_SHOP:this.btn_oppr.visible=!1}},i.prototype.updateBaseInfo=function(){var e=p.Config.VIPUpgradeConfig()[this.vipInfo.vipLevel+1];if(this.vipitem_current.update(this.vipInfo.vipLevel),e){this.gp_tips.visible=!0,this.pb_vipExp.maximum=e.exp,this.pb_vipExp.value=this.vipInfo.exp;var t=Math.ceil(e.exp-this.vipInfo.exp);this.blb_num.text=(t/10).toString(),this.vipitem_toBe.update(this.vipInfo.vipLevel+1)}else e=p.Config.VIPUpgradeConfig()[this.vipInfo.vipLevel],this.gp_tips.visible=!1,this.pb_vipExp.maximum=this.vipInfo.exp,this.pb_vipExp.value=this.vipInfo.exp;"元"!=Utils.SDKMgr.globalIAPSuffix&&(this.gp_tips.visible=!1)},i.prototype.updateRecharge=function(){var e=this.rechargeProxy.goodList,a=0,r=0,s=[];if(e.forEach(function(e){1==e.is_show&&r++}),e.forEach(function(e){1==e.is_show&&s.push({info:e,index:a++,maxLength:r})}),p.GameMVC.activityPy.isOpen(EActivityType.RechargeItem)){var t=p.GameMVC.activityPy.allActivityData[EActivityType.RechargeItem];t&&t.content.forEach(function(e){if(p.GameMVC.playerPy.playerInfoVO.playerVip.rechargeInfo.totalMoney>=e[2]){for(var t=void 0,i=0,o=p.GameMVC.rechargePy.goodList;i<o.length;i++){var n=o[i];if(n.id==e[1]){t=n;break}}s.push({info:t,fixedConfig:{code:e[0],activityType:EActivityType.RechargeItem,rewards:e[3],icon:e[4]},index:a++,maxLength:r})}})}s.sort(function(e,t){return Number(t.index)-Number(e.index)}),this.list_recharge.dataProvider=new eui.ArrayCollection(s)},i.prototype.updateVip=function(){var e=this,t={quickBattleTimes:["矿场每日可钻石购买快速开采","次"],dailyFortressTimes:["日常副本每日可购买","次"],serverBossBuyTimes:["世界boss可购买","次挑战次数"],peakWarFreedomChalBuy:["巅峰竞技场每日可购买","次挑战次数"],vipGiftsLevel:["可购买VIP","超值礼包"],autoChallenge:"遗迹探险批量投骰",expeditionSaoDang:"英雄远征自动战斗",autoArena:"竞技场自动扫荡",touchGoldTen:"矮人宝藏批量开10次",fightSpeed:"开启战斗2倍速",maxBagSize:["背包容量增加","格"]},i=[],o=p.Config.VIPConfig(!0)[999999],n=1,a=p.Config.VIPConfig(!0)[n];for(this.isJump=0;a&&n<=this.playerProxy.playerInfoVO.playerVip.vipLevel+3;){var r={vipLevel:n,info:[]};for(var s in this.vipInfo.vipGiftGot[n]||(n<=this.cu_pageScroller.curPage+1?this.isJump=-1:n<=this.playerProxy.playerInfoVO.playerVip.vipLevel&&n>this.cu_pageScroller.curPage+1&&-1!=this.isJump&&(this.isJump=1)),t){var c=a[s];if("maxBagSize"==s&&(c-=1e3),t[s]&&1==o[s]&&c)if(Array.isArray(t[s])){var l=[{text:t[s][0],style:{}},{text:c,style:{}},{text:t[s][1],style:{}}];r.info.push(l)}else a[s]&&(l=[{text:t[s],style:{}},{text:"",style:{}},{text:"",style:{}}],r.info.push(l))}i.push(r),a=p.Config.VIPConfig(!0)[++n],++this.curPageNum}var h=this.list_vip.dataProvider;h?h.replaceAll(i):this.list_vip.dataProvider=new eui.ArrayCollection(i),this.isFirst?(this.once(egret.Event.ENTER_FRAME,function(){e.cu_pageScroller.scrollerToPage(e.vipInfo.vipLevel-1,!1,function(){e.checkPageBtnStatus(),e.updateRedPoint()})},this),this.isFirst=!1):(this.checkPageBtnStatus(),this.updateRedPoint())},i.prototype.updateRedPoint=function(){for(var e=!1,t=!1,i=1;i<this.cu_pageScroller.curPage+1&&i<=this.vipInfo.vipLevel;i++)if(null==this.vipInfo.vipGiftGot[i]||1!=this.vipInfo.vipGiftGot[i]){e=!0;break}for(i=this.cu_pageScroller.curPage+2;i<=this.vipInfo.vipLevel;i++)if(null==this.vipInfo.vipGiftGot[i]||1!=this.vipInfo.vipGiftGot[i]){t=!0;break}this.img_LeftNotice.visible=e,this.img_RightNotice.visible=t},i.prototype._activateComponent=function(){var e=this;this.cu_common_datanchu.onCloseCB=function(){e.hide()},this.btn_oppr.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){switch(this.vType){case i.VIEW_TYPE.PRIVILEGE:this.updateView({viewType:i.VIEW_TYPE.RECHARGE});break;case i.VIEW_TYPE.RECHARGE:this.updateView({viewType:i.VIEW_TYPE.PRIVILEGE})}},this),this.btn_page_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.cu_pageScroller.scrollToNext(function(){e.updateRedPoint(),e.checkPageBtnStatus()})},this),this.btn_page_last.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.cu_pageScroller.scrollToLast(function(){e.updateRedPoint(),e.checkPageBtnStatus()})},this)},i.prototype.checkPageBtnStatus=function(){this.btn_page_last.visible=0!=this.cu_pageScroller.curPage,this.btn_page_next.visible=this.cu_pageScroller.curPage!=(14<=this.playerProxy.playerInfoVO.playerVip.vipLevel?19:this.playerProxy.playerInfoVO.playerVip.vipLevel+2)},i.prototype.perClose=function(){},i.VIEW_TYPE={RECHARGE:0,WELFARE:1,PRIVILEGE:2,DAILY_SHOP:3},i);function i(){var e=t.call(this)||this;return e.index=0,e.isJump=0,e.isFirst=!0,e.rechargeProxy=p.AppFacade.getInstance().retrieveProxy(p.RechargePy.N),e.playerProxy=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N),e.pageNode={},Utils.AssetsMgr.loadGroup("group_recharge"),e.skinName="RechargeSkin",p.AppFacade.getInstance().sendNotification(CN.RECHARGE_GET_DATA),e.curPageNum=0,e}p.RechargeView=e,__reflect(e.prototype,"game.RechargeView");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){var t=this;o.prototype.childrenCreated.call(this),Utils.SDKMgr.globalIAPIcon&&(this.img_price_icon.width=this.img_price_icon.height=35,this.img_price_icon.source=Utils.SDKMgr.globalIAPIcon),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=p.AppFacade.getInstance().retrieveProxy(p.RechargePy.N);t.data.fixedConfig?e.purchase(t.data.info,2,t.data.fixedConfig.code,JSON.stringify({uuid:t.data.fixedConfig.code,activityType:t.data.fixedConfig.activityType}),{activityType:t.data.fixedConfig.activityType}):e.purchase(t.data.info)},this)},a.prototype.dataChanged=function(){if(this.blb_price.text=""+this.data.info.price*Utils.SDKMgr.globalIAPRate+Utils.SDKMgr.globalIAPSuffix,getUrlKV().switchRechargeType){var e=Utils.agentConfig.other.rate||1,t=Utils.agentConfig.other.unit||"元",i=Number(this.data.info.price)*Number(e);this.blb_price.text=""+i+t}var o=this.data.maxLength-this.data.index,n={1:{icon:"chongzhi_img_zuanshi01_png",bg:"chongzhi_img_wupinkuan01_png"},2:{icon:"chongzhi_img_zuanshi02_png",bg:"chongzhi_img_wupinkuan02_png"},3:{icon:"chongzhi_img_zuanshi03_png",bg:"chongzhi_img_wupinkuan03_png"},4:{icon:"chongzhi_img_zuanshi04_png",bg:"chongzhi_img_wupinkuan03_png"}};if(this.img_bg.source=n[o]&&n[o].bg||n[4].bg,this.img_icon.source=n[o]&&n[o].icon||n[4].icon,this.data.info.give?(this.gp_extra.visible=!0,this.blb_extra.text=""+this.data.info.give):this.gp_extra.visible=!1,this.data.info.buy_num<=0?this.gp_double.visible=!0:this.gp_double.visible=!1,this.data.fixedConfig){this.gp_double.visible=!1,this.gp_extra.visible=!1,this.img_icon.source=this.data.fixedConfig.icon,this.img_bg.source=n[1].bg;var a=p.GeneralConfig.getEntityConfigByCode(this.data.fixedConfig.rewards[0][0],this.data.fixedConfig.rewards[0][1]);a&&(this.img_canGet.source=ResourceUtils.png(a.icon)),this.blb_obtain.text=this.data.fixedConfig.rewards[0][2]}else this.blb_obtain.text=(this.data.info.diamond-this.data.info.give).toString(),this.img_canGet.source="item_icon_zuanshi_png"},a);function a(){var e=o.call(this)||this;return e.skinName="RechargeView_RechargeItem",e}__reflect(n.prototype,"RechargeView_RechargeItem");var r,s=(r=eui.ItemRenderer,__extends(c,r),c.prototype.childrenCreated=function(){r.prototype.childrenCreated.call(this),this.initialize(),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.vipInfo.vipGiftGot[this.data.vipLevel]?Utils.MsgUtils.addMidMsg("已购买"):this.rechargeProxy.GetVipLevelGift(this.data.vipLevel)},this)},c.prototype.initialize=function(){UIActionManager.hideScrollerBar(this.scl_desc),this.scl_desc.touchEnabled=!1},c.prototype.dataChanged=function(){var r=this;this.vipInfo=this.playerProxy.playerInfoVO.playerVip,this.gp_desc.removeChildren(),this.data.info.forEach(function(e){var t=new eui.Group,i=new eui.HorizontalLayout;i.verticalAlign=egret.VerticalAlign.MIDDLE,t.layout=i,t.addChild(new eui.Image("chongzhi_img_dian_png"));var o=new eui.Label,n=new eui.Label,a=new eui.BitmapLabel;n.size=o.size=22,n.textColor=o.textColor=10050862,a.font="btn_fnt_yellow2_fnt",a.text="可购买VIP"==e[0].text?Number(e[1].text)-1:e[1].text,o.text=e[0].text,n.text=e[2].text,t.addChild(o),t.addChild(a),t.addChild(n),r.gp_desc.addChild(t)});var e=this.data.vipLevel;this.vipItem.update(e);var t=p.Config.VIPUpgradeConfig()[e],i=JSON.parse(t.wholeLifeCardEmailRewards),o=JSON.parse(t.gifts),n=JSON.parse(t.costs)[0][2];if(this.blb_price_cur.text=n.toString(),this.lb_price_origin.text=""+n/(t.discount/100),this.gp_reward.removeChildren(),this.gp_dailyreward.removeChildren(),o.forEach(function(e){var t=customui.BaseItemFactory.create();if(4<o.length?t.scaleX=t.scaleY=.6:t.scaleX=t.scaleY=.8,e[0]==EEntityType.EEntityTypeHeroEquip||e[0]==EEntityType.EEntityTypeHeroArtifact){var i={code:e[1],entityType:e[0],exp:0,fightCap:0,level:0,level2:0,filterShow:!0};t.updateData({reward:e,vo:i})}else t.updateData({reward:e});r.gp_reward.addChild(t)}),p.GameMVC.activityPy.isOpen(EActivityType.VipWelfare)){var a=p.GameMVC.activityPy.allActivityData[EActivityType.VipWelfare];if(a&&a.data){var s=JSON.parse(a.content)[0];for(var c in s){var l=s[c];if(l[1]==e){i=l[2];break}}}}i.forEach(function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,t.updateData({reward:e}),r.gp_dailyreward.addChild(t)}),e>this.vipInfo.vipLevel?(this.btn_buy.label="购买",UIActionManager.setAbsGrey(this.btn_buy,!0)):this.vipInfo.vipGiftGot[e]?(this.btn_buy.label="已购买",this.btn_buy.enabled=!1,UIActionManager.setAbsGrey(this.btn_buy,!0)):(this.btn_buy.label="购买",this.btn_buy.enabled=!0,UIActionManager.setAbsGrey(this.btn_buy,!1))},c);function c(){var e=r.call(this)||this;return e.rechargeProxy=p.AppFacade.getInstance().retrieveProxy(p.RechargePy.N),e.playerProxy=p.AppFacade.getInstance().retrieveProxy(p.PlayerPy.N),e.skinName="RechargeView_VipPage",e}__reflect(s.prototype,"RechargeView_VipPage")}(game=game||{}),function(t){var i,e=(i=eui.ItemRenderer,__extends(o,i),o.prototype.childrenCreated=function(){this.baseItem=customui.BaseItemFactory.create(),this.gp_baseitem.addChild(this.baseItem),this.activateComponent()},o.prototype.activateComponent=function(){this.btn_purchase.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.btnFunc&&this.btnFunc()},this)},o.prototype.dataChanged=function(){var e=this.data;this.btnFunc=e.btnFunc;var t=JSON.parse(e.reward)[0];this.backpackProxy.getInfoByTypeCodeNum(t[0],t[1],t[2]),this.baseItem.updateData({type:t[0],code:t[1],num:t[2]});for(var i=this.data.buyNum,o=100,n=JSON.parse(e.discount),a=0;a<n.length;a++){if(i>=n[a][0]-1&&i<n[a][1]){o=n[a][2];break}if(i>=n[a][0]-1&&0==n[a][1]){o=n[a][2];break}}var r=this.shopProxy.getMaxNum(e.id);this.leftNum=r-i,this.leftNum<=0?UIActionManager.setGrey(this.btn_purchase):UIActionManager.setGrey(this.btn_purchase,!1),1==e.discountDisplay?100==o?this.gp_discount.visible=!1:(this.gp_discount.visible=!0,this.blb_discount.text=""+o/10):this.gp_discount.visible=!1,this.cost=JSON.parse(e.costs)[0];var s=this.cost[2];this.price=s*o/100,this.blb_price.text=""+this.price;var c=this.backpackProxy.getInfoByTypeCodeNum(this.cost[0],this.cost[1],this.cost[2]);c&&c.info&&(this.img_costIcon.source=ResourceUtils.png(c.info.icon));var l=JSON.parse(e.unlock);switch(this.unlockType=l[0],this.unlockType){case ShopItemUnlockType.None:}},o);function o(){var e=i.call(this)||this;return e.shopProxy=t.AppFacade.getInstance().retrieveProxy(t.ShopPy.N),e.backpackProxy=t.AppFacade.getInstance().retrieveProxy(t.BackpackPy.N),e.unlock=!0,e.skinName="ShopUIItemSkin",e}t.ShopActiviteUI=e,__reflect(e.prototype,"game.ShopActiviteUI")}(game=game||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.item=customui.BaseItemFactory.create(10),this.item.x=2,this.item.y=2,this.Gropu_box.addChild(this.item),this.initButton()},o.prototype.initButton=function(){var e=this;this.lb_num.addEventListener(egret.Event.CHANGE,function(){Number(e.lb_num.text)>e.maxNum&&(e.lb_num.text=e.maxNum.toString()),e.curNum=Number(e.lb_num.text),e.updatePrice()},this),this.lb_num.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){""!=e.lb_num.text&&Number(e.lb_num.text)||e.setCount(1)},this),this.img_min.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum-100)},this),this.img_m10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum-10)},this),this.img_m1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum-1)},this),this.img_a1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum+1)},this),this.img_a10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum+10)},this),UIActionManager.bindClickAction(this.img_max),this.img_max.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum+100)},this),this.img_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.AppFacade.getInstance().hideSubView(t.ShopyMediator.N,t.ShopyMediator.SV.SHOP_BUY_NUM)},this),this.img_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.AppFacade.getInstance().hideSubView(t.ShopyMediator.N,t.ShopyMediator.SV.SHOP_BUY_NUM),this.doneCB?this.doneCB.call(this.context,{type:this.data.type,id:this.data.id,num:this.curNum}):this.shopProxy.Buy(this.data.type,this.data.id,this.curNum,this.grid)},this)},o.prototype.setCount=function(e){this.curNum=e,this.curNum<=0&&(this.curNum=1),this.curNum>this.maxNum&&(this.curNum=this.maxNum),this.lb_num.text=this.curNum,this.updatePrice()},o.prototype.updatePrice=function(){if(this.data.countFun){var e=this.data.countFun(this.curNum);this.lb_sum_money.text="x"+e.total,this.lb_money.text=""+e.unit}else{var t=(e=this.shopProxy.calPriceInfoById(this.data.id,this.curNum)).unitPrice*this.curNum;this.lb_sum_money.text="x"+t,this.lb_money.text=""+e.unitPrice}},o.prototype.updateView=function(e){var t=e.shopConfig;null!=e.type&&(this.type=e.type),null!=e.grid?this.grid=e.grid:this.grid=void 0,e.doneCB&&(this.doneCB=e.doneCB),this.data=t,this.log("当前数据",t),this.lb_name.text=t.name;var i=JSON.parse(t.reward||t.rewards)[0];if(i){var o=this.backpackProxy.getInfoByTypeCodeNum(i[0],i[1],i[2]);this.lb_hasNum.text="库存："+o.haveNum,this.item.updateData({type:i[0],code:i[1]})}else this.lb_hasNum.text="",this.item.visible=!1,this.lb_name.horizontalCenter=0;var n=e.buyNum?e.buyNum:this.shopProxy.getPurchasedNum(t.id,this.grid),a=JSON.parse(t.cost||t.costs)[0],r=this.backpackProxy.getInfoByTypeCodeNum(a[0],a[1],a[2]);this.img_cost_icon.source=r.info.icon+"_png",this.img_cost_icon2.source=r.info.icon+"_png";var s=JSON.parse(this.data.limit);if(s[0]){this.gp_buyInfo.y=165,this.lb_buyCountTip.visible=!0;var c=this.LIMITTYPE[s[0]],l=s[1]-n;this.lb_buyCountTip.text=""+c+(e.limitTip||"限购次数")+l+"次"}else this.gp_buyInfo.y+=20,this.lb_buyCountTip.visible=!1;1==e.leftNum&&(this.gp_info.y=this.gp_info.y+25,this.gp_buyInfo.visible=!1);var h=100;if(1==t.discountDisplay){if(t.discount)for(var p=JSON.parse(t.discount),d=0;d<p.length;d++)if(n>=p[d][0]-1&&n<p[d][1]){h=p[d][2];break}this.lb_cut.text=h/10==10?"":h/10+"折"}else this.lb_cut.text="";this.maxNum=e.maxCount?e.maxCount:this.shopProxy.calPriceInfoById(t.id).num,this.lb_costTip.text=e.costTip||"购买花费：",this.img_2.label=e.btnLabel||"购买",this.setCount(1)},o);function o(){var e=i.call(this)||this;return e.LIMITTYPE={1:"每天",2:"每周",3:"每月",4:"每年",5:""},e.skinName="ShopBuyNumSkin",e.shopProxy=t.AppFacade.getInstance().retrieveProxy(t.ShopPy.N),e.backpackProxy=t.AppFacade.getInstance().retrieveProxy(t.BackpackPy.N),e.type=1,e}t.ShopBuyNumView=e,__reflect(e.prototype,"game.ShopBuyNumView")}(game=game||{}),function(c){var e,t=(i.ShopInfo=((e={})[ShopType.ShopTypeArena]={name:"竞技商店",title:"竞技商店",refreshShop:!1,tabbar:function(){return[{up:"common_yeqian_shangdian_2_png",down:"common_yeqian_shangdian_1_png"},{up:"common_yeqian_jiangli_2_png",down:"common_yeqian_jiangli_1_png"}]},money:[1,3,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeArena],heroModel:{model:"hero_037_03",isStatic:!0}},e[ShopType.ShopTypeGuild]={moduleId:MODULE.GuildShop,name:"公会商店",title:"公会商店",refreshShop:!0,tabbar:function(){return[]},money:[1,4,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeGuild],heroModel:{model:"hero_037_03",isStatic:!0}},e[ShopType.ShopTypeRefresh]={moduleId:MODULE.ShopMystical,name:"神秘商店",title:"神秘商店",refreshShop:!0,tabbar:function(){return[]},money:[1,1,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeRefresh]},e[ShopType.ShopTypeWorldKing]={name:"排位商店",title:"排位商店",refreshShop:!1,tabbar:function(){return[{up:"shop_btn_shangdian_02_png",down:"shop_btn_shangdian_01_png"}]},money:[1,6,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeWorldKing]},e[ShopType.ShopTypeTeamArena]={name:"组队竞技场商店",title:"组队竞技场商店",refreshShop:!1,tabbar:function(){return[{up:"shop_btn_jiangli_02_png",down:"shop_btn_jiangli_01_png"}]},money:[1,2,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},heroModel:{model:"hero_037_03",isStatic:!0}},e[ShopType.ShopTypeExpedition]={moduleId:MODULE.ShopExpedition,name:"英雄的远征商店",title:"英雄的远征商店",refreshShop:!1,tabbar:function(){return[{up:"shop_btn_shangdian_02_png",down:"shop_btn_shangdian_01_png"},{up:"shop_btn_jiangli_02_png",down:"shop_btn_jiangli_01_png"}]},money:[1,1,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},heroModel:{model:"hero_037_03",isStatic:!0}},e[ShopType.ShopTypeTeamExpedition]={moduleId:MODULE.ShopTeamExpedition,name:"组队副本商店",title:"组队副本商店",refreshShop:!1,tabbar:function(){return[]},money:[1,1,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},heroModel:{model:"hero_037_03",isStatic:!0}},e[ShopType.ShopTypeDecompose]={moduleId:MODULE.ShopDecompose,name:"分解商店",title:"分解商店",refreshShop:!1,tabbar:function(){return[]},money:[1,1,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},heroModel:{model:"hero_037_03",isStatic:!0}},e[ShopType.ShopTypeSmithy]={moduleId:MODULE.Smithy,name:"分解商店",title:"分解商店",refreshShop:!1,tabbar:function(){return[]},money:[1,1,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"}},e[ShopType.ShopTypeRaceGashapon]={moduleId:MODULE.ShopRaceGashapon,name:"时空商店",title:"时空商店",refreshShop:!1,tabbar:function(){return[]},money:[1,1,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},heroModel:{model:"hero_037_03",isStatic:!0}},e[ShopType.ShopTypeShare]={moduleId:void 0,name:"分享商店",title:"分享商店",refreshShop:!1,tabbar:function(){return[]},money:[1,1,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},checkRed:function(){var o=this,n=c.AppFacade.getInstance().retrieveProxy(c.ShopPy.N),e=n.getShopList(ShopType.ShopTypeShare),a=new Array,t=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N),r=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N),s=(t.playerInfoVO.playerVip.vipLevel,!1);return e.forEach(function(e){var t={isFull:n.getPurchasedNum(e.id)<n.getMaxNum(e.id),data:e,shopType:o.curShopType,grid:e.grid,type:2};a.push(t);var i=JSON.parse(e.costs);r.checkEnough(i,!1)&&(s=!0)}),s},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeShare]},e[ShopType.ShopTypeHeroChallenge]={moduleId:MODULE.ShopHeroChallenge,name:"英雄挑战商店",title:"英雄挑战商店",refreshShop:!0,tabbar:function(){return[]},money:[1,4,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},checkRed:function(){var e=c.GameMVC.shopPy;return!(e.curShopType!=ShopType.ShopTypeHeroChallenge||!e.curShopInfo||!e.curShopInfo.buyRecords.length)},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeHeroChallenge]},e[ShopType.ShopTypeManor]={moduleId:MODULE.Manor,name:"商店",title:"商店",refreshShop:!1,tabbar:function(){return[]},money:[1,EPropertyType.EPropertyTypeManor,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},checkRed:function(){return!1},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeManor]},e[ShopType.ShopTypePeakWar]={moduleId:MODULE.PeakWar,name:"巅峰战场商店",title:"巅峰战场商店",refreshShop:!1,tabbar:function(){return[]},money:[1,EPropertyType.EPropertyTypePeakWarMoney,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},checkRed:function(){if(c.GameMVC.peakWarPy.curType===PEAK_WAR_TYPE.HIGH_END)return!1;var e=c.GameMVC.shopPy.getShopList(ShopType.ShopTypePeakWar),n=c.GameMVC.shopPy,a=c.GameMVC.backpackPy,r=!1;return e.forEach(function(e){var t=n.getPurchasedNum(e.id),i=n.getMaxNum(e.id),o=JSON.parse(e.costs);t<i&&a.checkEnough(o,!1)&&(r=!0)}),r},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypePeakWar],heroModel:{model:"hero_037_03",isStatic:!0}},e[ShopType.ShopTypeHeroSpirit]={moduleId:MODULE.ShopHeroSpirit,name:"英魂商店",title:"英魂商店",money:[3,30000046,0],refreshShop:!0,tabbar:function(){return[]},getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},checkRed:function(){var e=c.GameMVC.shopPy;return!(e.curShopType!=ShopType.ShopTypeHeroSpirit||!e.curShopInfo||!e.curShopInfo.buyRecords.length)},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeHeroSpirit]},e[ShopType.ShopTypeNationalDay]={moduleId:MODULE.ShopNationalDay,name:"菜谱",title:"菜谱",money:[1,1,0],refreshShop:!0,tabbar:function(){return[]},getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},checkRed:function(){var e=c.GameMVC.shopPy;return!(e.curShopType!=ShopType.ShopTypeNationalDay||!e.curShopInfo||!e.curShopInfo.buyRecords.length)},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeNationalDay],heroModel:{model:"hero_skin_052_01",isStatic:!0}},e[ShopType.ShopTypeDoubleTwelve]={moduleId:MODULE.ShopTypeDoubleTwelve,name:"商店",title:"商店",money:[1,1,0],refreshShop:!0,tabbar:function(){return[]},getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},checkRed:function(){return!1},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeDoubleTwelve]},e[ShopType.ShopTypeSF2020]={moduleId:MODULE.ShopTypeSF2020,name:"商店",title:"商店",money:[1,1,0],refreshShop:!0,tabbar:function(){return[]},getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},checkRed:function(){return!1},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeSF2020]},e[ShopType.ShopTypeTopFarm]={moduleId:MODULE.TopFarm,name:"农场商店",title:"神秘商人",money:[1,1,0],refreshShop:!1,tabbar:function(){return[]},getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},checkRed:function(){return!1},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeTopFarm],refreshBtnText:"出售",refreshTapCB:function(){c.GameMVC.guildFarmMed.showSubView(c.GuildFarmMediator.SV.STORE_HOUSE,{fromShop:!0})},getEndDt:function(){var e=JSON.parse(c.Config.constConfig().TopFarmShopTime.constValue);for(var t in e){var i=e[t],o=Utils.TimerManager.checkIsOpen_FormatA(i);if(o.isOpen)return o.endTimeDt}return 0},heroModel:{model:"hero_050_01",isStatic:!0}},e[ShopType.ShopTypeGloryArena]={name:"荣誉竞技商店",title:"荣誉竞技商店",refreshShop:!1,tabbar:function(){return[{up:"common_yeqian_shangdian_2_png",down:"common_yeqian_shangdian_1_png"},{up:"common_yeqian_jiangli_2_png",down:"common_yeqian_jiangli_1_png"}]},money:[1,3,0],getTargetTips:function(){return"最新商品已上架!\n快来抢购吧!"},NoticeTypes:NT.COMMON_SHOP[ShopType.ShopTypeGloryArena],heroModel:{model:"hero_037_03",isStatic:!0}},e),i);function i(){}c.ShopConfig=t,__reflect(t.prototype,"game.ShopConfig")}(game=game||{}),function(e){var i,t=(i=eui.Component,__extends(o,i),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.init(),this.data&&this.update(this.data)},o.prototype.init=function(){var e=this;this.gp=new eui.Group,this.gp.percentHeight=this.gp.percentWidth=100,this.addChild(this.gp);var t=new eui.VerticalLayout;t.gap=3,t.verticalAlign=egret.VerticalAlign.MIDDLE,t.horizontalAlign=egret.HorizontalAlign.CENTER,this.gp.layout=t,this.addEventListener(eui.UIEvent.RESIZE,this.update,this),this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.removeEventListener(eui.UIEvent.RESIZE,e.update,e)},this)},o.prototype.update=function(e){var c=this;if(this.data=e||this.data,this.gp&&this.data&&this.data.data){function l(){return i.push([]),i[i.length-1]}function h(e){var t=!1,i=e.charCodeAt(0);return o.forEach(function(e){i>=e[0]&&i<=e[1]&&(t=!0)}),t}this.gp.removeChildren();var t=this.data.data,p=this.width,d=this.width,i=[],u=l(),o=[["0".charCodeAt(0),"9".charCodeAt(0)],["a".charCodeAt(0),"z".charCodeAt(0)],["A".charCodeAt(0),"Z".charCodeAt(0)]];t.forEach(function(e){switch(e.type){case COMPONENT_ENUM.LABEL:for(var t=e.data.text,i=e.data.size||c.size,o={type:COMPONENT_ENUM.LABEL,data:{text:"",size:i,textColor:e.data.textColor}};t.length;){var n=t[0],a=h(n)?i/2:i,r="\n"==n;r&&(t=t.slice(1)),!r&&(null==d||a<=d)?(o.data.text+=n,t=t.slice(1),d-=a):(o.data.text.length&&u.push(o),u=l(),o={type:COMPONENT_ENUM.LABEL,data:{text:"",size:i,textColor:e.data.textColor}},d=p)}o.data.text.length&&u.push(o);break;case COMPONENT_ENUM.IMAGE:var s=e.data.width||c.iconWidth;d<s&&(u=l(),d=p),u.push({type:COMPONENT_ENUM.IMAGE,data:{source:e.data.source}}),d-=s}}),i.forEach(function(e){var t=c.makeRowContainer();e.forEach(function(e){t.addChild(c.makeComponent(e))}),c.gp.addChild(t)})}},o.prototype.makeRowContainer=function(){var e=new eui.Group,t=new eui.HorizontalLayout;return t.gap=0,t.verticalAlign=egret.VerticalAlign.MIDDLE,t.horizontalAlign=egret.HorizontalAlign.CENTER,e.layout=t,e},o.prototype.makeComponent=function(e){var t;switch(e.type){case COMPONENT_ENUM.LABEL:(t=new eui.Label).text=e.data.text,t.size=e.data.size||this.size,t.textColor=e.data.textColor||this.textColor;break;case COMPONENT_ENUM.IMAGE:(t=new eui.Image(e.data.source)).width=e.data.width||this.iconWidth,t.height=e.data.height||this.iconHeight}return t},o);function o(e){var t=i.call(this)||this;return t.size=20,t.textColor=0,t.iconWidth=game.GeneralConfig.fixedSizeWH,t.iconHeight=game.GeneralConfig.fixedSizeWH,t.data=e,t}e.LabelWithImage=t,__reflect(t.prototype,"customui.LabelWithImage")}(customui=customui||{}),function(o){var e=(t.registerAll=function(){(new s).register(),(new n).register()},t);function t(){}o.ShopProcessor=e,__reflect(e.prototype,"game.ShopProcessor");var i,n=(i=o.ProcessorBase,__extends(a,i),a.prototype.execute=function(e){var t=o.GameMVC.shopPy;switch(e.getBody().type){case ShopType.ShopTypeHeroChallenge:var i;t.curShopInfo&&t.curShopInfo.type==ShopType.ShopTypeHeroChallenge&&(i=t.curShopInfo.buyRecords.length),t.GetShopInfo(ShopType.ShopTypeHeroChallenge,function(e){var t=e&&e.shopInfo&&e.shopInfo.buyRecords.length;t&&0<t&&(null==i||i<t)&&o.GameMVC.fightPy.addDelayCBAfterFightExit(function(){DragonBoneTools.playOnce({effectName:"common_chuxian",parent:GameRootLayer.gameLayer().popMsgLayer,y:Utils.DeviceUtils.curHeight()/3,scaleX:1.5,scaleY:1.5}),o.GameMVC.fightPy.queueExceExitCB()},"HC2ShopRefresh")})}},a);function a(){return i.call(this,"shop.ShopRefreshP",a)||this}o.ShopRefreshP=n,__reflect(n.prototype,"game.ShopRefreshP");var r,s=(r=o.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){},c);function c(){return r.call(this,"shop.ShopRedPointP",c)||this}o.ShopRedPointP=s,__reflect(s.prototype,"game.ShopRedPointP")}(game=game||{}),function(u){var i,o=(i=u.BaseVO,__extends(e,i),e.prototype.update=function(e){this.id=e.id,this.num=e.num,this.name=e.name,this.grid=e.grid},e);function e(e){var t=i.call(this)||this;return e&&t.update(e),t}__reflect(o.prototype,"SBuyRecordVO");var n,a=(n=u.BaseVO,__extends(t,n),t.prototype.update=function(e){var t=this;this.count=e.count,this.buyCount=e.buyCount,this.lRCD=e.lRCD,this.buyRecords.splice(0),Array.isArray(e.buyRecords)&&e.buyRecords.forEach(function(e){t.buyRecords.push(new o(e))})},t);function t(e){var t=n.call(this)||this;return t.buyRecords=new Array,e&&t.update(e),t}__reflect(a.prototype,"SShopInfoVO");var r,s=(__extends(c,r=BaseProxy),c.prototype.addNotice=function(){var e=u.ShopConfig.ShopInfo;if(e)for(var t in ShopType){var i=ShopType[t];e[i]&&e[i].checkRed&&e[i].NoticeTypes&&NoticeManager.registerCB(e[i].NoticeTypes,e[i].checkRed,this)}},c.prototype.updateShopInfo=function(e){var t=this;this.curShopGoodsBuyCount=[];var i=e.info;i.buyRecords.forEach(function(e){t.curShopGoodsBuyCount.push(e)}),this.curShopInfo||(this.curShopInfo=new a),this.curShopInfo.type=e.type,this.curShopInfo.update(i),this.sendNotification(CN.SHOP_INFO_UPDATE,{shopType:e.type}),NoticeManager.updateNotice(NT.COMMON_SHOP[e.type])},c.prototype.RefeshShop=function(t,i){var o=this;Utils.Socket.send("shop","RefreshShop",{type:t}).then(function(e){o.updateShopInfo({info:e.shopInfo,type:t}),i&&i()})},c.prototype.BuyRefreshCount=function(t,i){var o=this;Utils.Socket.send("shop","BuyRefreshCount",{type:t,num:1}).then(function(e){o.updateShopInfo({info:e.shopInfo,type:t}),i&&i()})},c.prototype.GetShopInfo=function(t,i){var o=this;Utils.Socket.send("shop","GetShopInfo",{type:t}).then(function(e){o.curShopType==t&&o.updateShopInfo({info:e.shopInfo,type:t}),i&&i(e)})},c.prototype.Buy=function(t,e,i,o){var n=this;Utils.Socket.send("shop","Buy",{type:t,id:e,num:i,grid:o}).then(function(e){n.updateShopInfo({info:e.shopInfo,type:t}),Utils.MsgUtils.addMidMsg("购买成功")})},c.prototype.getPurchasedNum=function(e,t){for(var i=0,o=0,n=this.curShopGoodsBuyCount;o<n.length;o++)if((d=n[o]).id==e&&(d.grid&&d.grid==t||!d.grid&&!t)){i=d.num;break}for(var a=EActivityType.CommonShopSpecialItem,r=[EActivityType.CommonShopSpecialItem,EActivityType.CommonShopSpecialItem1,EActivityType.CommonShopSpecialItem2],s=u.AppFacade.getInstance().retrieveProxy(u.ActivityPy.N),c=0;c<r.length;c++)if(s.isOpen(r[c])){a=r[c];break}if(!i&&s.isOpen(a)){var l=s.allActivityData[a];if(l&&l.data){var h=JSON.parse(l.data.buyRecords);for(var p in h){var d;(d=h[p]).id==e&&(i=d.num)}}}return i},c.prototype.getMaxNum=function(e){var t=u.Config.shop()[e],i=0;if(t){var o=u.AppFacade.getInstance().retrieveProxy(u.PlayerPy.N),n=o.playerInfoVO.playerVip.vipLevel,a=o.playerInfoVO.level,r=JSON.parse(t.unlock);if(0==r[0]||1==r[0]&&a>=r[1]||2==r[0]&&n>=r[1]){var s=JSON.parse(t.limit);i=0==s[0]?99999999:s[1]}}return i},c.prototype.getShopList=function(e,t){var i=u.Config.shop(),o=new Array;for(var n in i){var a=i[n];a.type!=e||t&&a.subType!=t||o.push(a)}return o},c.prototype.calPriceInfoById=function(e,t){var i=this.getPurchasedNum(e),o=u.Config.shop()[e],n=this.getMaxNum(e),a={unitPrice:0,totalPrice:0,num:0};if(o){var r=void 0;r=u.GameMVC.activityPy.hasWholeLifeCard()?JSON.parse(o.wholeLifeCosts)[0]:JSON.parse(o.costs)[0],a.unitPrice=r[2];var s=u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N).getInfoByTypeCodeNum(r[0],r[1],r[2]).haveNum;n=Math.min(n-i,Math.floor(s/a.unitPrice)),a.num=null==t?n:Math.min(t,n),a.totalPrice=a.num*a.unitPrice}return a},c.prototype.showRefreshShopNotice=function(e){},c.N="ShopProxy",c);function c(){var e=r.call(this,c.N)||this;return e.noticeShowOnceDict={},e.curShopType=0,e.curShopGoodsBuyCount=[],e.addNotice(),e}u.ShopPy=s,__reflect(s.prototype,"game.ShopPy")}(game=game||{}),function(c){var t,e=(__extends(i,t=BaseFull),i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.scheCountLeft&&(egret.clearInterval(this.scheCountLeft),this.scheCountLeft=void 0)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.resource_bar),this.curShopType=this.shopProxy.curShopType;var e=c.Config.shopWork(this.curShopType);this.refreshShopRefreshDt=Number(e.reFreeRefreshTimesCD),this.refreshLimit=Number(e.maxFreeRefreshTimes),c.ShopConfig.ShopInfo[this.shopProxy.curShopType].heroModel?this.heroModel.update(c.ShopConfig.ShopInfo[this.shopProxy.curShopType].heroModel):this.heroModel.update(c.ShopUI.HERODATA),this.initButton(),this.initUI()},i.prototype.initButton=function(){var s=this;this.img_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().hideSubView(c.ShopyMediator.N,c.ShopyMediator.SV.REFRESH_SHOP)},this),this.btn_refresh.btn_oppr.skinName="skins.ButtonSkinBlue",this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<this.shopProxy.curShopInfo.count?this.shopProxy.RefeshShop(this.curShopType,function(){Utils.MsgUtils.addMidMsg("刷新成功")}):this.buyCount()},this),Utils.ComponentUtils.registerListener(this.btn_discount,egret.TouchEvent.TOUCH_TAP,function(){c.GameMgr.getInstance().showCommonTipsWin({commonTips:"购买终生卡可享受黑市商人额外8折优惠",btnStyle:{cancel:c.CommonTipsDialog.BTN_STYLE.CANCEL,confirm:c.CommonTipsDialog.BTN_STYLE.GOTO},clickCB:function(e){1==e.type&&(s.hide(),c.GameMVC.activityMed.showViewByCode(EActivityType.MonthCard))}})},this),this.curShopType==ShopType.ShopTypeRefresh&&(this.btn_help.visible=!0,Utils.ComponentUtils.registerListener(this.btn_help,egret.TouchEvent.TOUCH_TAP,function(){var e=[];e.push({text:"1、黑市商人可以购买到多种优惠道具，并且每天第一次可以免费刷新商店道具。\n2、每次自动刷新间隔时间为"}),e.push({text:s.refreshShopRefreshDt/60+"分钟",style:{textColor:36807}}),e.push({text:"，同时也可以手动使用钻石刷新。\n3、某些道具拥有每日购买上限数量和等级限制，当日达到购买上限数量"}),e.push({text:"（每日重置）",style:{textColor:36807}}),e.push({text:"或未达到该等级条件，将不会刷新获得："});for(var t={},i=0,o=c.Config.refreshShop();i<o.length;i++)if((r=o[i]).shopType==ShopType.ShopTypeRefresh){var n=c.Config.shop()[r.id];"时空契约"!=n.name&&"觉醒石"!=n.name&&"守护石"!=n.name||(t[n.name]?t[n.name].num+=JSON.parse(n.reward)[0][2]*r.timesLimit:t[n.name]={num:JSON.parse(n.reward)[0][2]*r.timesLimit,level:r.level})}for(var a in t){var r;(r=t[a]).level&&r.num?(e.push({text:"\n"+a+"("+r.level+"级解锁)：每日可购买"}),e.push({text:""+(r.num?r.num:"无限制"),style:{textColor:36807}}),e.push({text:"个"})):r.level?e.push({text:"\n"+a+"("+r.level+"级解锁)"}):r.num&&(e.push({text:"\n"+a+"：每日可购买"}),e.push({text:""+(r.num?r.num:"无限制"),style:{textColor:36807}}),e.push({text:"个"}))}PopUpManager.addPopUp({obj:new c.HelpDialog({text:e})})},this))},i.prototype.initUI=function(){var e=new eui.TileLayout;e.horizontalGap=95,e.verticalGap=25,e.requestedRowCount=0,e.paddingLeft=25,e.paddingTop=5,e.requestedColumnCount=3,e.columnAlign=eui.ColumnAlign.LEFT,this.list_items.layout=e,this.list_items.itemRenderer=c.ShopUIItem,this.collect=new eui.ArrayCollection,this.list_items.dataProvider=this.collect},i.prototype.updateSche=function(){var t=this,e=!1;this.shopProxy.curShopInfo.count<=0&&0<this.refreshShopRefreshDt-(Utils.TimerManager.getServerTime()-this.shopProxy.curShopInfo.lRCD)?this.scheCountLeft||(this.lb_time.visible=!0,this.scheCountLeft=egret.setInterval(function(){var e=t.refreshShopRefreshDt-(Utils.TimerManager.getServerTime()-t.shopProxy.curShopInfo.lRCD);0<e?t.lb_time.text=Utils.TimerManager.getFormatBySecond1(e):(t.lb_time.visible=!1,egret.clearInterval(t.scheCountLeft),t.scheCountLeft=void 0)},this,1e3)):e=!0,e&&this.scheCountLeft&&(this.lb_time.visible=!1,egret.clearInterval(this.scheCountLeft),this.scheCountLeft=void 0)},i.prototype.buyCount=function(){var t=this,e=this.shopProxy.curShopInfo.buyCount,i=c.ShopConfig.ShopInfo[this.shopProxy.curShopType].moduleId,o=c.Config.publicBuyCostConfig(i,e);if(!o)return egret.warn("t_public_buy_cost里当前购买次数"+e+"的"+i+"找不到配置"),void Utils.MsgUtils.addMidMsg("暂时无法购买");var n=JSON.parse(o.costs);c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).checkEnough(n)?c.GameMgr.getInstance().showCommonTipsWin({costTips:"钻石，刷新一次商店吗",source:"heishishop",cost:o.costs,cb:!0,clickCB:function(e){1===e.type&&t.shopProxy.BuyRefreshCount(t.curShopType,function(){Utils.MsgUtils.addMidMsg("刷新成功")})}}):Utils.MsgUtils.addMidMsg("刷新所需钻石不足")},i.prototype.updateList=function(){var e=c.Config.shop(),t=this.shopProxy.curShopInfo.buyRecords;this.collect.removeAll();for(var i=c.GameMVC.activityPy.hasWholeLifeCard(),o=0,n=t;o<n.length;o++){var a=n[o],r=e[a.id];this.collect.addItem({data:r,shopType:this.curShopType,vo:a,grid:a.grid,isPopup:r.isPopup,buyNum:a.num,hasWholeLifeCard:i,effect:r.isSpecial})}},i.prototype.updateView=function(e){var t=this,i=c.GameMVC.activityPy.hasWholeLifeCard();UIActionManager.setAbsGrey(this.btn_discount,!i),this.btn_discount.enabled=!i;var o=Utils.SDKMgr.getPerformConfig(1)&&Utils.SDKMgr.getPerformConfig(21);if(this.btn_discount.visible=!o,this.lb_discount.visible=!o&&!i,this.shopProxy.curShopInfo){this.workType=e&&e.workType||this.workType,this.onCloseCB=e&&e.onCloseCB||this.onCloseCB;var n=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N),a=c.ShopConfig.ShopInfo[this.curShopType].money,r=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).getInfoByTypeCodeNum(a[0],a[1],a[2]),s=[[n.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeGold],2],[r.haveNum,r.info.code]];this.resource_bar.updateBar({costs:s,width:190,needAdd:!0}),this.refreshBtnUpdate(),this.updateSche(),this.curShopType!=ShopType.ShopTypeHeroSpirit&&this.curShopType!=ShopType.ShopTypeNationalDay&&this.curShopType!=ShopType.ShopTypeThanksGiving||(this.btn_discount.visible=!1,this.lb_discount.visible=!1,this.resource_bar.updateBar({costs:[a],width:190,needAdd:!1})),this.once(egret.Event.ENTER_FRAME,function(){t.updateList()},this)}},i.prototype.refreshBtnUpdate=function(){var e=this.shopProxy.curShopInfo;if(e.count<=0){var t=e.buyCount,i=c.ShopConfig.ShopInfo[this.shopProxy.curShopType].moduleId||MODULE.ShopMystical,o=c.Config.publicBuyCostConfig(i,t),n=JSON.parse(o.costs);this.btn_refresh.updateData({cost:n[0],text:"刷新"})}else this.btn_refresh.updateData({text:"刷新"});this.lb_refresh_left.text="今日剩余刷新次数:"+(this.refreshLimit-e.buyCount)+"次"},i.prototype.perClose=function(){this.onCloseCB&&this.onCloseCB()},i);function i(){var e=t.call(this)||this;return e.skinName="ShopRefreshViewSkin",e.shopProxy=c.AppFacade.getInstance().retrieveProxy(c.ShopPy.N),e}c.ShopRefreshView=e,__reflect(e.prototype,"game.ShopRefreshView");var o,n=(__extends(a,o=BasePanel),a.prototype.onDestroy=function(){o.prototype.onDestroy.call(this),this.scheCountLeft&&(egret.clearInterval(this.scheCountLeft),this.scheCountLeft=void 0)},a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.resource_bar),this.curShopType=this.shopProxy.curShopType;var e=c.Config.shopWork(this.curShopType);this.refreshShopRefreshDt=Number(e.reFreeRefreshTimesCD),this.refreshLimit=Number(e.maxFreeRefreshTimes),c.ShopConfig.ShopInfo[this.shopProxy.curShopType].heroModel?this.heroModel.update(c.ShopConfig.ShopInfo[this.shopProxy.curShopType].heroModel):this.heroModel.update(c.ShopUI.HERODATA),this.initButton(),this.initUI()},a.prototype.initButton=function(){var s=this;this.img_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().hideSubView(c.ShopyMediator.N,c.ShopyMediator.SV.REFRESH_SHOP_PANEL)},this),this.btn_refresh.btn_oppr.skinName="skins.ButtonSkinBlue",this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<this.shopProxy.curShopInfo.count?this.shopProxy.RefeshShop(this.curShopType,function(){Utils.MsgUtils.addMidMsg("刷新成功")}):this.buyCount()},this),Utils.ComponentUtils.registerListener(this.btn_discount,egret.TouchEvent.TOUCH_TAP,function(){c.GameMgr.getInstance().showCommonTipsWin({commonTips:"购买终生卡可享受黑市商人额外8折优惠",btnStyle:{cancel:c.CommonTipsDialog.BTN_STYLE.CANCEL,confirm:c.CommonTipsDialog.BTN_STYLE.GOTO},clickCB:function(e){1==e.type&&(s.hide(),c.GameMVC.activityMed.showViewByCode(EActivityType.MonthCard))}})},this),this.curShopType==ShopType.ShopTypeRefresh&&(this.btn_help.visible=!0,Utils.ComponentUtils.registerListener(this.btn_help,egret.TouchEvent.TOUCH_TAP,function(){var e=[];e.push({text:"1、黑市商人可以购买到多种优惠道具，并且每天第一次可以免费刷新商店道具。\n2、每次自动刷新间隔时间为"}),e.push({text:s.refreshShopRefreshDt/60+"分钟",style:{textColor:36807}}),e.push({text:"，同时也可以手动使用钻石刷新。\n3、某些道具拥有每日购买上限数量和等级限制，当日达到购买上限数量"}),e.push({text:"（每日重置）",style:{textColor:36807}}),e.push({text:"或未达到该等级条件，将不会刷新获得："});for(var t={},i=0,o=c.Config.refreshShop();i<o.length;i++)if((r=o[i]).shopType==ShopType.ShopTypeRefresh){var n=c.Config.shop()[r.id];"时空契约"!=n.name&&"觉醒石"!=n.name&&"守护石"!=n.name||(t[n.name]?t[n.name].num+=JSON.parse(n.reward)[0][2]*r.timesLimit:t[n.name]={num:JSON.parse(n.reward)[0][2]*r.timesLimit,level:r.level})}for(var a in t){var r;(r=t[a]).level&&r.num?(e.push({text:"\n"+a+"("+r.level+"级解锁)：每日可购买"}),e.push({text:""+(r.num?r.num:"无限制"),style:{textColor:36807}}),e.push({text:"个"})):r.level?e.push({text:"\n"+a+"("+r.level+"级解锁)"}):r.num&&(e.push({text:"\n"+a+"：每日可购买"}),e.push({text:""+(r.num?r.num:"无限制"),style:{textColor:36807}}),e.push({text:"个"}))}PopUpManager.addPopUp({obj:new c.HelpDialog({text:e})})},this))},a.prototype.initUI=function(){var e=new eui.TileLayout;e.horizontalGap=95,e.verticalGap=0,e.requestedRowCount=0,e.paddingLeft=30,e.paddingTop=5,e.requestedColumnCount=3,e.columnAlign=eui.ColumnAlign.LEFT,this.list_items.layout=e,this.list_items.itemRenderer=c.ShopUIItem,this.collect=new eui.ArrayCollection,this.list_items.dataProvider=this.collect},a.prototype.updateSche=function(){var t=this,e=!1;this.shopProxy.curShopInfo.count<=0&&0<this.refreshShopRefreshDt-(Utils.TimerManager.getServerTime()-this.shopProxy.curShopInfo.lRCD)?this.scheCountLeft||(this.lb_time.visible=!0,this.scheCountLeft=egret.setInterval(function(){var e=t.refreshShopRefreshDt-(Utils.TimerManager.getServerTime()-t.shopProxy.curShopInfo.lRCD);0<e?t.lb_time.text=Utils.TimerManager.getFormatBySecond1(e):(t.lb_time.visible=!1,egret.clearInterval(t.scheCountLeft),t.scheCountLeft=void 0)},this,1e3)):e=!0,e&&this.scheCountLeft&&(this.lb_time.visible=!1,egret.clearInterval(this.scheCountLeft),this.scheCountLeft=void 0)},a.prototype.buyCount=function(){var t=this,e=this.shopProxy.curShopInfo.buyCount,i=c.ShopConfig.ShopInfo[this.shopProxy.curShopType].moduleId,o=c.Config.publicBuyCostConfig(i,e);if(!o)return egret.warn("t_public_buy_cost里当前购买次数"+e+"的"+i+"找不到配置"),void Utils.MsgUtils.addMidMsg("暂时无法购买");var n=JSON.parse(o.costs);c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).checkEnough(n)?c.GameMgr.getInstance().showCommonTipsWin({costTips:"钻石，刷新一次商店吗",source:"heishishop",cost:o.costs,cb:!0,clickCB:function(e){1===e.type&&t.shopProxy.BuyRefreshCount(t.curShopType,function(){Utils.MsgUtils.addMidMsg("刷新成功")})}}):Utils.MsgUtils.addMidMsg("刷新所需钻石不足")},a.prototype.updateList=function(){var e=c.Config.shop(),t=this.shopProxy.curShopInfo.buyRecords;this.collect.removeAll();for(var i=c.GameMVC.activityPy.hasWholeLifeCard(),o=0,n=t;o<n.length;o++){var a=n[o],r=e[a.id];this.collect.addItem({data:r,shopType:this.curShopType,vo:a,grid:a.grid,isPopup:r.isPopup,buyNum:a.num,hasWholeLifeCard:i,effect:r.isSpecial})}},a.prototype.updateView=function(e){var t=this,i=c.GameMVC.activityPy.hasWholeLifeCard();UIActionManager.setAbsGrey(this.btn_discount,!i),this.btn_discount.enabled=!i;var o=Utils.SDKMgr.getPerformConfig(1)&&Utils.SDKMgr.getPerformConfig(21);if(this.btn_discount.visible=!o,this.lb_discount.visible=!o&&!i,this.shopProxy.curShopInfo){this.workType=e&&e.workType||this.workType,this.onCloseCB=e&&e.onCloseCB||this.onCloseCB;var n=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N),a=c.ShopConfig.ShopInfo[this.curShopType].money,r=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).getInfoByTypeCodeNum(a[0],a[1],a[2]),s=[[n.playerInfoVO.playerMoney[EPropertyType.EPropertyTypeGold],2],[r.haveNum,r.info.code]];this.resource_bar.updateBar({costs:s,width:190,needAdd:!0}),this.refreshBtnUpdate(),this.updateSche(),this.curShopType!=ShopType.ShopTypeHeroSpirit&&this.curShopType!=ShopType.ShopTypeNationalDay&&this.curShopType!=ShopType.ShopTypeThanksGiving&&this.curShopType!=ShopType.ShopTypeDoubleTwelve&&e.shopType!=ShopType.ShopTypeSF2020||(this.btn_discount.visible=!1,this.lb_discount.visible=!1,this.resource_bar.updateBar({costs:[a],width:190,needAdd:!1})),this.once(egret.Event.ENTER_FRAME,function(){t.updateList()},this)}},a.prototype.refreshBtnUpdate=function(){var e=this.shopProxy.curShopInfo;if(e.count<=0){var t=e.buyCount,i=c.ShopConfig.ShopInfo[this.shopProxy.curShopType].moduleId||MODULE.ShopMystical,o=c.Config.publicBuyCostConfig(i,t),n=JSON.parse(o.costs);this.btn_refresh.updateData({cost:n[0],text:"刷新"})}else this.btn_refresh.updateData({text:"刷新"});this.lb_refresh_left.text="今日剩余刷新次数:"+(this.refreshLimit-e.buyCount)+"次"},a.prototype.perClose=function(){this.onCloseCB&&this.onCloseCB()},a);function a(){var e=o.call(this)||this;return e.skinName="ShopRefreshPanelSkin",e.shopProxy=c.AppFacade.getInstance().retrieveProxy(c.ShopPy.N),e}c.ShopRefreshPanel=n,__reflect(n.prototype,"game.ShopRefreshPanel")}(game=game||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.item=customui.BaseItemFactory.create(10),this.item.x=2,this.item.y=2,this.Gropu_box.addChild(this.item),this.initButton()},o.prototype.initButton=function(){var e=this;this.lb_num.addEventListener(egret.Event.CHANGE,function(){Number(e.lb_num.text)>e.maxNum&&(e.lb_num.text=e.maxNum.toString()),e.curNum=Number(e.lb_num.text),e.updatePrice()},this),this.lb_num.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){""!=e.lb_num.text&&Number(e.lb_num.text)||e.setCount(1)},this),this.img_min.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum-100)},this),this.img_m10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum-10)},this),this.img_m1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum-1)},this),this.img_a1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum+1)},this),this.img_a10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum+10)},this),UIActionManager.bindClickAction(this.img_max),this.img_max.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.setCount(this.curNum+100)},this),this.img_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.img_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.doneCB?(this.hide(),this.doneCB({num:this.curNum})):this.backpackProxy.SellProp({code:this.data.info.id,num:this.curNum},this.hide.bind(this))},this)},o.prototype.setCount=function(e){this.curNum=e,this.curNum<=0&&(this.curNum=1),this.curNum>this.maxNum&&(this.curNum=this.maxNum),this.lb_num.text=this.curNum,this.updatePrice()},o.prototype.updatePrice=function(){if(this.data.countFun){var e=this.data.countFun(this.curNum);this.lb_sum_money.text="x"+e.total,this.lb_money.text=""+e.unit}else{e=this.shopProxy.calPriceInfoById(this.data.id,this.curNum);var t=this.nowOne*this.curNum;this.lb_sum_money.text="x"+t,this.lb_money.text=""+e.unitPrice}},o.prototype.updateView=function(e){var t=e.shopConfig;null!=e.type&&(this.type=e.type),null!=e.grid?this.grid=e.grid:this.grid=void 0,e.doneCB&&(this.doneCB=e.doneCB),this.data=t,this.log("当前数据",t),this.lb_name.text=t.name,this.data.info&&this.data.info.uuid?this.item.updateData({uuid:this.data.info.uuid,type:this.data.type}):this.item.updateData(this.data.info),this.lb_hasNum.text="拥有："+e.maxCount;var i=JSON.parse(this.data.info.sellRewards)[0],o=this.backpackProxy.getInfoByTypeCodeNum(i[0],i[1],i[2]);this.img_cost_icon2.source=o.info.icon+"_png",this.nowOne=i[2],this.maxNum=e.maxCount?e.maxCount:this.shopProxy.calPriceInfoById(t.id).num,this.lb_costTip.text=e.costTip||"出售获得：",this.img_2.label=e.btnLabel||"出售",this.setCount(1)},o);function o(){var e=i.call(this)||this;return e.skinName="ShopSellNumSkin",e.shopProxy=t.AppFacade.getInstance().retrieveProxy(t.ShopPy.N),e.backpackProxy=t.AppFacade.getInstance().retrieveProxy(t.BackpackPy.N),e.type=1,e}t.ShopSellNumView=e,__reflect(e.prototype,"game.ShopSellNumView")}(game=game||{}),function(P){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cur_resource),this.curShopType=this.shopProxy.curShopType,this.bm_title.text="商店",this.initUI(),this.initTabbar(),this.sl_otherShop.scrollPolicyV=eui.ScrollPolicy.OFF;var e=new egret.Shape;e.graphics.beginFill(0,.6),e.graphics.drawRect(0,0,this.gp_empty.width,this.gp_empty.height),e.graphics.endFill(),this.gp_empty.addChildAt(e,0)},i.prototype.initUI=function(){var e=this;UIActionManager.hideScrollerBar(this.pageScroller),this.btn_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.pageScroller.scrollToNext(function(){e.updatePageBtnStatus()})},this),this.btn_last.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.pageScroller.scrollToLast(function(){e.updatePageBtnStatus()})},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.pageScroller.curPage=0,P.ShopConfig.ShopInfo[this.shopProxy.curShopType].heroModel?this.heroModel.update(P.ShopConfig.ShopInfo[this.shopProxy.curShopType].heroModel):this.heroModel.update(i.HERODATA),this.initRefreshUI(),this.initList()},i.prototype.initList=function(){this.list_item.itemRenderer=h,this.collection_list=new eui.ArrayCollection,this.list_item.dataProvider=this.collection_list},i.prototype.updateResourceBar=function(){this.cur_resource.updateBar({costs:this.moneyType,width:190,needAdd:!0})},i.prototype.updateView=function(e){var t=this;if(e&&e.shopType){var n=this.shopProxy.getShopList(e.shopType),i=this.shopProxy.curShopInfo,o=P.Config.shopWork(this.curShopType);if(o.workType==ShopWorkType.FreeAndBuyRefresh&&i.lRCD){var a=i.lRCD;this.timer_lb_refresh=egret.setInterval(function(){var e=Utils.TimerManager.getServerTime();t.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(a-e)},this,1e3)}else if(o.workType==ShopWorkType.BuyRefresh){var r=i.buyCount,s=P.Config.publicBuyCostConfig(P.ShopConfig.ShopInfo[this.curShopType].moduleId,r);if(s)if(i.count<=0){var c=JSON.parse(s.costs);this.btn_refresh.updateData({cost:c[0],text:"刷新"})}else this.btn_refresh.updateData({text:"刷新"});var l=i.buyRecords,h=[];l.forEach(function(e){for(var t=0;t<n.length;++t)if(e.id==n[t].id){var i=n[t];i.grid=e.grid,h.push(i);break}}),n=h}else if(o.workType==ShopWorkType.Drop){this.lb_target_tips.text="每5关胜利后，将新增商品哦！",P.Config.shop();var p=this.shopProxy.curShopInfo.buyRecords,d=[];p.forEach(function(e){var t=e.id;for(var i in n){var o=n[i];o.id==t&&(o.grid=e.grid,d.push(o))}}),n=d}else if(o.workType==ShopWorkType.Common){P.Config.shop();for(var u=P.AppFacade.getInstance().retrieveProxy(P.ActivityPy.N),g=EActivityType.CommonShopSpecialItem,f=[EActivityType.CommonShopSpecialItem,EActivityType.CommonShopSpecialItem1,EActivityType.CommonShopSpecialItem2],_=P.AppFacade.getInstance().retrieveProxy(P.ActivityPy.N),m=0;m<f.length;m++)if(_.isOpen(f[m])){g=f[m];break}if(u.isOpen(g)){var y=u.allActivityData[g];if(y&&y.data){var v=y.content,T=[];for(var C in v)(I=v[C])[0]==e.shopType&&(T=I[1]||[]);var E=P.Config.shop();for(var C in E){var I=E[C];0<=T.indexOf(I.id)&&(I.endDt=y.endDt,I.customCB=function(e){P.AppFacade.getInstance().retrieveProxy(P.ActivityPy.N).DoCommonOperation(g,e.num,e.id,function(){t.updateView({shopType:t.curShopType})})},n.push(I))}}}}else if(this.curShopType==ShopType.ShopTypeTopFarm){l=i.buyRecords;var b=[];l.forEach(function(t,e){for(var i=0;i<n.length;++i)if(t.id==n[i].id){var o={};P.GeneralConfig.classCopy(n[i],o),o.grid=t.grid,o.customCB=function(e){P.GameMVC.guildFarmPy.Buy(ShopType.ShopTypeTopFarm,e.id,e.num,t.grid)},b.push(o);break}}),n=b;var A=P.ShopConfig.ShopInfo[this.curShopType].getEndDt();this.timer_lb_refresh=egret.setInterval(function(){var e=Utils.TimerManager.getServerTime();e<A&&(t.bm_time.text=""+Utils.TimerManager.getFormatBySecond1(A-e))},this,1e3)}P.ShopConfig.ShopInfo[this.curShopType].refreshBtnText&&this.btn_refresh.updateData({text:P.ShopConfig.ShopInfo[this.curShopType].refreshBtnText}),this.updateList({list:n}),this.pageScroller.curPage>this.collection_list.source.length-1?this.pageScroller.scrollToLast(function(){t.updatePageBtnStatus()}):this.updatePageBtnStatus(),this.updateResourceBar()}},i.prototype.updatePageBtnStatus=function(){this.btn_last.visible=0!=this.pageScroller.curPage,this.btn_next.visible=this.pageScroller.curPage!=this.pageNumber-1},i.prototype.initTabbar=function(){var o=this,n=[{icon:"shangdian_icon_dfjjsd_png",module:MODULE.ShopPeakWar,title:"巅峰商店",shopType:ShopType.ShopTypePeakWar,chosen:!1},{icon:"shangdian_icon_jjsd_png",module:MODULE.ShopArean,title:"竞技商店",shopType:ShopType.ShopTypeArena,chosen:!1},{icon:"shangdian_icon_jtsd_png",module:MODULE.ShopDecompose,title:"分解商店",shopType:ShopType.ShopTypeDecompose,chosen:!1},{icon:"shangdian_icon_sksd_png",module:MODULE.ShopRaceGashapon,title:"时空商店",shopType:ShopType.ShopTypeRaceGashapon,chosen:!1},{icon:"shangdian_img_yzsd_png",module:MODULE.ShopExpedition,title:"远征商店",shopType:ShopType.ShopTypeExpedition,chosen:!1},{icon:"shangdian_icon_zdsd_png",module:MODULE.ShopTeamExpedition,title:"组队商店",shopType:ShopType.ShopTypeTeamExpedition,chosen:!1},{icon:"shangdian_icon_ghsd_png",module:MODULE.GuildShop,title:"公会商店",shopType:ShopType.ShopTypeGuild,chosen:!1},{icon:"shangdian_img_kzsd_png",module:MODULE.Manor,title:"矿战商店",shopType:ShopType.ShopTypeManor,chosen:!1},{icon:"shangdian_icon_rongyubi_png",module:MODULE.GloryArena,title:"荣誉商店",shopType:ShopType.ShopTypeGloryArena,chosen:!1}],e=!1;for(var t in n)if(n[t].shopType==this.curShopType){e=!0,n[t].chosen=!0;break}if(e){for(var t in this.sl_otherShop.visible=!0,n){var i=n[t].module,a=Utils.UnlockMgr.checkPass(i,!1);a.allow&&(i!=MODULE.GuildShop||P.GameMVC.guildPy.isInGuild())?n[t].unlockLevel=a.ext.requestLevel||0:n.splice(parseInt(t),1)}n.sort(function(e,t){return e.unlockLevel==t.unlockLevel?e.module-t.module:e.unlockLevel-t.unlockLevel}),n.forEach(function(e,t){e.chosen&&5<=t&&(o.bm_title.text=e.title,egret.setTimeout(function(){o.sl_otherShop.viewport.scrollH=132*(t-4)},o,100))}),this.list_otherShop.itemRenderer=u,this.list_otherShop.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){o.bm_title.text=n[e.itemIndex].title,o.curShopType=o.shopProxy.curShopType=n[e.itemIndex].shopType;var t=P.Config.shopWork(o.shopProxy.curShopType),i={shopType:o.shopProxy.curShopType,workType:t.workType};o.shopProxy.GetShopInfo(o.shopProxy.curShopType,function(){o.updateView(i)}),o.onTabbarItemTap(e)},this),this.list_otherShop.dataProvider=new eui.ArrayCollection(n)}else this.sl_otherShop.visible=!1},i.prototype.onTabbarItemTap=function(e){var t=this.list_otherShop.dataProvider,i=t.source;for(var o in i){var n=i[o];n.chosen=n.shopType==this.curShopType}t.replaceAll(i)},i.prototype.initRefreshUI=function(){var e=P.Config.shopWork(this.curShopType),t=P.Config.publicBuyCostConfig(P.ShopConfig.ShopInfo[this.curShopType].moduleId,this.shopProxy.curShopInfo.buyCount);this.btn_refresh.btn_oppr.skinName="skins.ButtonSkinBlue",e.workType==ShopWorkType.FreeAndBuyRefresh?(this.gp_time.visible=!0,this.btn_refresh.visible=!1):e.workType==ShopWorkType.BuyRefresh&&t?(this.gp_time.visible=!1,this.btn_refresh.visible=!0):e.workType==ShopWorkType.TimeOpen&&this.curShopType==ShopType.ShopTypeTopFarm?(this.gp_time.visible=!0,this.btn_refresh.visible=!0,this.lb_timeTip.text="剩余时间：",this.btn_refresh.btn_oppr.skinName="skins.ButtonSkinGreen"):(this.gp_time.visible=!1,this.btn_refresh.visible=!1),this.btn_refresh.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){P.ShopConfig.ShopInfo[this.curShopType].refreshTapCB?P.ShopConfig.ShopInfo[this.curShopType].refreshTapCB():0<this.shopProxy.curShopInfo.count?this.shopProxy.RefeshShop(this.curShopType,function(){Utils.MsgUtils.addMidMsg("刷新成功")}):this.buyCount()},this)},i.prototype.updateList=function(e){var n=this;void 0===e&&(e={list:[]}),e.list.length?this.gp_empty.visible=!1:this.gp_empty.visible=!0,this.pageNumber=Math.ceil(e.list.length/9)||1,this.moneyType=[];var t=[],a=new Array;e.list.forEach(function(e){var t={isFull:n.shopProxy.getPurchasedNum(e.id)<n.shopProxy.getMaxNum(e.id),data:e,shopType:n.curShopType,grid:e.grid,type:2};a.push(t);var i=JSON.parse(e.costs);if(i&&i.length){var o=!0;n.moneyType.forEach(function(e){e[0]==i[0][0]&&e[1]==i[0][1]&&(o=!1)}),o&&n.moneyType.push([i[0][0],i[0][1]])}}),a.sort(function(e,t){return e.isFull==t.isFull?e.data.displayPriority===t.data.displayPriority?e.data.id-t.data.id:e.data.displayPriority-t.data.displayPriority:e.isFull?-1:1});for(var i=1,o=[],r=0,s=a;r<s.length;r++){var c=s[r];o.push(c),i%9==0?(t.push({list_items:o}),o=[]):i>=a.length&&t.push({list_items:o}),++i}this.collection_list.replaceAll(t)},i.prototype.buyCount=function(){var t=P.AppFacade.getInstance().retrieveProxy(P.ShopPy.N),e=t.curShopInfo.buyCount,i=P.ShopConfig.ShopInfo[t.curShopType].moduleId,o=P.Config.publicBuyCostConfig(i,e);if(!o)return egret.warn("t_public_buy_cost里当前购买次数"+e+"的"+i+"找不到配置"),void Utils.MsgUtils.addMidMsg("暂时无法购买");var n=JSON.parse(o.costs);P.AppFacade.getInstance().retrieveProxy(P.BackpackPy.N).checkEnough(n,!0)&&P.GameMgr.getInstance().showCommonTipsWin({costTips:"，刷新一次商店吗",source:"shop",cost:o.costs,cb:!0,clickCB:function(e){1===e.type&&t.BuyRefreshCount(t.curShopType,function(){Utils.MsgUtils.addMidMsg("刷新成功")})}})},i.prototype.perClose=function(){if(this.moneyType&&this.moneyType.length)switch(this.moneyType[0][1]){case EPropertyType.EPropertyTypeSoul:P.AppFacade.getInstance().updateView(P.BackpackMediator.N,P.BackpackMediator.SV.DECOMPOSE,{type:EEntityType.EEntityTypeHero});break;case EPropertyType.EPropertyTypeDevote:P.AppFacade.getInstance().updateView(P.GuildMediator.N,P.GuildMediator.SV.MAIN_MAP)}this.timer_lb_refresh&&egret.clearInterval(this.timer_lb_refresh)},i.HERODATA={code:41100065,modell:"hero_065_03",isStatic:!0},i);function i(){var e=t.call(this)||this;return e.moneyType=[],e.pageNumber=0,e.skinName="ShopSkin",e.shopProxy=P.AppFacade.getInstance().retrieveProxy(P.ShopPy.N),e}P.ShopUI=e,__reflect(e.prototype,"game.ShopUI");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){this.baseItem=customui.BaseItemFactory.create(),this.gp_baseitem.addChildAt(this.baseItem,0),this.baseItem.touchEnabled=!1,this.activateComponent(),this.img_onlyOne.visible=!1,this.cacheData&&(this.data=this.cacheData)},a.prototype.activateComponent=function(){this.btn_purchase.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.buyFunc?this.data.buyFunc():this.leftNum<=0?Utils.MsgUtils.addMidMsg("该商品已无购买次数"):this.unlock?this.backpackProxy.checkEnough([[this.cost[0],this.cost[1],this.price]],!0)&&P.AppFacade.getInstance().showSubView(P.ShopyMediator.N,P.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:this.data.data,type:this.data.shopType,grid:this.data.grid,doneCB:this.data.customCB||this.data.data&&this.data.data.customCB,leftNum:this.leftNum}):Utils.MsgUtils.addMidMsg(SHOP_NOT_ALLOW_TIPS[this.unlockType])},this),this.gp_baseitem.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=JSON.parse(this.data.data.reward);if(e[0][0]==EEntityType.EEntityTypeHero||e[0][0]==EEntityType.EEntityTypeVestageHero)P.AppFacade.getInstance().showSubView(P.HeroMediator.N,P.HeroMediator.SV.HERO_DETAIL,{code:e[0][1]});else if(e[0][0]==EEntityType.EEntityTypeHeroArtifact||e[0][0]==EEntityType.EEntityTypeHeroEquip){var t=e[0],i={code:t[1],entityType:t[0],exp:0,fightCap:0,level:0,level2:0,filterShow:!0};P.AppFacade.getInstance().showSubView(P.HeroThingMediator.N,P.HeroThingMediator.SV.MAIN,{entityType:e[0][0],vo:i,source:P.HeroThingMainView.VIEW_SOURCE.BACKPACK})}else PopUpManager.addPopUp({obj:new P.BaseItemDetailView({code:e[0][1],type:e[0][0]})})},this)},a.prototype.dataChanged=function(){var t=this,e=this.data.data,i=JSON.parse(e.reward)[0];this.baseItem.updateData({type:i[0],code:i[1],num:i[2]});var o=null!=this.data.buyNum?this.data.buyNum:this.shopProxy.getPurchasedNum(e.id,this.data.grid);this.config=P.GeneralConfig.getEntityConfigByCode(i[0],i[1]);var n=this.shopProxy.getMaxNum(e.id);this.leftNum=n-o,this.leftNum<=0?(UIActionManager.setGrey(this.btn_purchase),UIActionManager.setGrey(this.gp_baseitem),this.img_buyok.visible=!0):(UIActionManager.setGrey(this.btn_purchase,!1),UIActionManager.setGrey(this.gp_baseitem,!1),this.img_buyok.visible=!1);var a=100,r=this.data.hasWholeLifeCard&&e.wholeLifeDiscountDisplay;r?0<e.wholeLifeDiscountReview&&(a=e.wholeLifeDiscountReview):e.discountDisplay&&0<e.discountReview&&(a=e.discountReview),this.data.hideDiscount||100==a?this.gp_discount.visible=!1:(this.gp_discount.visible=!0,this.blb_discount.text=""+a/10),this.cost=r?JSON.parse(e.wholeLifeCosts)[0]:JSON.parse(e.costs)[0],this.price=this.cost[2],this.btn_purchase.label=""+Utils.MathUtils.formatNumStyle1(this.price);var s=this.backpackProxy.getInfoByTypeCodeNum(this.cost[0],this.cost[1],this.cost[2]);s&&s.info&&(this.btn_purchase.iconDisplay.source=ResourceUtils.png(s.info.icon)),2==this.data.type&&(this.gp_discount.y=50,this.gp_discount.x=105,this.gp_discount.scaleX=this.gp_discount.scaleY=.8,this.gp_baseitem.y=65,this.gp_baseitem.scaleX=this.gp_baseitem.scaleY=.85,this.gp_btn.scaleX=this.gp_btn.scaleY=.85);var c=JSON.parse(e.unlock);switch(this.unlockType=c[0],this.unlockType){case ShopItemUnlockType.None:}if(this.timer&&egret.clearInterval(this.timer),e.endDt){function l(){var e=Utils.TimerManager.getServerTime();t.lb_time.text=e<h?Utils.TimerManager.getFormatBySecond1(h-e):"已结束"}this.gp_time.visible=!0;var h=e.endDt;l(),this.timer=egret.setInterval(function(){l()},this,1e3)}else this.gp_time.visible=!1;this.data.effect?this.gp_effect.numChildren||DragonBoneTools.playOnce({effectName:"common_choukagaojiekuang",parent:this.gp_effect,loop:!0}):this.gp_effect.numChildren&&this.gp_effect.removeChildren()},a);function a(e){var t=o.call(this)||this;return t.shopProxy=P.AppFacade.getInstance().retrieveProxy(P.ShopPy.N),t.backpackProxy=P.AppFacade.getInstance().retrieveProxy(P.BackpackPy.N),t.unlock=!0,t.skinName="ShopUIItemSkin",t.cacheData=e,t}P.ShopUIItem=n,__reflect(n.prototype,"game.ShopUIItem");var r,s=(r=eui.ItemRenderer,__extends(c,r),c.prototype.childrenCreated=function(){this.baseItem=customui.BaseItemFactory.create(),this.gp_baseitem.addChildAt(this.baseItem,0),this.baseItem.touchEnabled=!1,this.activateComponent()},c.prototype.activateComponent=function(){this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.leftNum<=0?Utils.MsgUtils.addMidMsg("该商品已无购买次数"):this.unlock?this.backpackProxy.checkEnough([[this.cost[0],this.cost[1],this.price]],!0)&&P.AppFacade.getInstance().showSubView(P.ShopyMediator.N,P.ShopyMediator.SV.SHOP_BUY_NUM,{shopConfig:this.data.data,type:this.data.shopType,grid:this.data.grid,doneCB:this.data.customCB||this.data.data&&this.data.data.customCB,leftNum:this.leftNum}):Utils.MsgUtils.addMidMsg(SHOP_NOT_ALLOW_TIPS[this.unlockType])},this)},c.prototype.dataChanged=function(){var e=this.data.data,t=JSON.parse(e.reward)[0];this.baseItem.updateData({type:t[0],code:t[1],num:t[2]});for(var i=null!=this.data.buyNum?this.data.buyNum:this.shopProxy.getPurchasedNum(e.id,this.data.grid),o=100,n=JSON.parse(e.discount),a=0;a<n.length;a++){if(i>=n[a][0]-1&&i<n[a][1]){o=n[a][2];break}if(i>=n[a][0]-1&&0==n[a][1]){o=n[a][2];break}}var r=this.shopProxy.getMaxNum(e.id);this.leftNum=r-i,this.leftNum<=0?UIActionManager.setGrey(this):UIActionManager.setGrey(this,!1),1==e.discountDisplay?100==o?this.gp_discount.visible=!1:(this.gp_discount.visible=!0,this.blb_discount.text=""+o/10):this.gp_discount.visible=!1,this.cost=JSON.parse(e.costs)[0];var s=this.cost[2];this.price=s*o/100,P.AppFacade.getInstance().retrieveProxy(P.BackpackPy.N),this.costIconAndNum.updateItem({style:CommonIconStyle.RIGHT,cost:this.cost,showEnough:!1}),this.costIconAndNum.blb_num.x-=5,this.costIconAndNum.blb_num.scaleX=this.costIconAndNum.blb_num.scaleY=.8,this.costIconAndNum.img_icon.scaleX=this.costIconAndNum.img_icon.scaleY=.8,this.costIconAndNum.img_icon.x=5;var c=JSON.parse(e.unlock);switch(this.unlockType=c[0],this.unlockType){case ShopItemUnlockType.None:}},c);function c(){var e=r.call(this)||this;return e.shopProxy=P.AppFacade.getInstance().retrieveProxy(P.ShopPy.N),e.backpackProxy=P.AppFacade.getInstance().retrieveProxy(P.BackpackPy.N),e.unlock=!0,e.skinName="ShopUIItemSkin2",e}P.ShopUIItem2=s,__reflect(s.prototype,"game.ShopUIItem2");var l,h=(l=eui.ItemRenderer,__extends(p,l),p.prototype.childrenCreated=function(){l.prototype.childrenCreated.call(this);var e=new eui.TileLayout;e.horizontalGap=60,e.verticalGap=-34,e.requestedRowCount=3,e.paddingLeft=65,e.paddingTop=6,e.requestedColumnCount=3,this.list_item.layout=e,this.list_item.itemRenderer=n,this.collect=new eui.ArrayCollection,this.list_item.dataProvider=this.collect},p.prototype.update=function(e){this.list_item=e.list_items},p.prototype.dataChanged=function(){this.collect.removeAll();for(var e=0,t=this.data.list_items;e<t.length;e++){var i=t[e];this.collect.addItem(i)}},p);function p(){var e=l.call(this)||this;return e.skinName="ShopPageItemSkin",e}P.ShopPageItem=h,__reflect(h.prototype,"game.ShopPageItem");var d,u=(d=eui.ItemRenderer,__extends(g,d),g.prototype.dataChanged=function(){this.img_icon.source=this.data.icon,this.bm_title.text=this.data.title,this.updateSelected()},g.prototype.updateSelected=function(){this.data.chosen?egret.Tween.get(this.img_icon,{loop:!0}).to({y:this.oldY-15},500).to({y:this.oldY},500):(egret.Tween.removeTweens(this.img_icon),this.img_icon.y=this.oldY)},g);function g(){var e=d.call(this)||this;return e.oldY=-5,e.oldId=0,e.activityProxy=P.AppFacade.getInstance().retrieveProxy(P.ActivityPy.N),e.skinName="ActivityRootPanel_ActivityItem",e}__reflect(u.prototype,"ShopChosenItem")}(game=game||{}),function(e){var t,i=(t=eui.Component,__extends(o,t),o);function o(){var e=t.call(this)||this;return e.skinName="TaskItemOnMainSkin",e}e.TaskItemOnMain=i,__reflect(i.prototype,"customui.TaskItemOnMain",["eui.UIComponent","egret.DisplayObject"])}(customui=customui||{}),function(e){var t=(i.create=function(e){var t=Utils.ObjectPoolMgr.pop("customui.PlayerHead",e);return t.once(egret.Event.REMOVED_FROM_STAGE,function(){Utils.ObjectPoolMgr.push(t)},this),t},i);function i(){}e.PlayerHeadFactory=t,__reflect(t.prototype,"customui.PlayerHeadFactory");var o,n=(o=eui.Component,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this)},a.prototype.addTapEvent=function(e){Utils.TouchUtils.removeTouchListener(this),Utils.TouchUtils.addTouchListener(this,e)},a.prototype.updateData=function(e){var i=this,t=e&&e.vo;if(this.gp_effect.removeChildren(),this.gp_effect1.removeChildren(),t){if(t.frame)this.img_frame.source=t.frame&&game.GeneralConfig.getGuajiImg(t.frame)[1],this.addFrameEffect(t.frame);else{var o=JSON.parse(game.Config.constConfig().DefaultFrame.constValue)[0];this.img_frame.source=game.GeneralConfig.getGuajiImg(o)[1]}if(t.level?(this.blb_level.visible=!0,this.blb_level.text=""+t.level):this.blb_level.visible=!1,3==t.subType)this.img_icon.source="";else if(t.avatar)0==t.avatar.indexOf("http")?RES.getResByUrl(t.avatar,function(e){if(e)i.img_icon.visible=!0,i.img_icon.source=e,i.img_icon.width=i.img_icon.height=86;else{var t=JSON.parse(game.Config.constConfig().DefaultAvatar.constValue)[0];i.img_icon.source=t+"_png"}},this,RES.ResourceItem.TYPE_IMAGE):RES.getResAsync(game.GeneralConfig.getGuajiImg(t.avatar)[1],function(e){i.img_icon.visible=!0,i.img_icon.source=e},this);else{var n=JSON.parse(game.Config.constConfig().DefaultAvatar.constValue)[0];this.img_icon.visible=!0,this.img_icon.source=n+"_png"}}else e&&e.fixedHead?(this.img_icon.visible=!0,this.img_icon.source=ResourceUtils.png(e.fixedHead)):(this.img_bg.source="_border_m_json.common_img_jichuwupingkuang",this.blb_level.visible=this.img_icon.visible=!1);e&&e.ignoreLevel&&(this.blb_level.visible=!1),this.img_tag.visible=e&&e.showTag,this.tapEvent=e&&e.tapEvent,e&&e.tapEvent&&this.addTapEvent(e&&e.tapEvent),e&&e.effect&&(this.effectData=t,this.headEffect())},a.prototype.reset=function(){this.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.tapEvent,this),this.tapEvent=void 0,this.scaleX=this.scaleY=1,this.x=this.y=0,this.img_tag.visible=this.blb_level.visible=this.img_icon.visible=!1,this.visible=!0,this.blb_level.text="",this.img_icon.source="",this.img_frame.source="",this.img_icon.width=this.img_icon.height=void 0,this.horizontalCenter=this.verticalCenter=void 0},a.prototype.onOPReset=function(){this.reset()},a.prototype.onOPComeBack=function(e,t){e&&this.updateData(e)},a.prototype.onOPClean=function(){},a.prototype.onOPCheck=function(e){egret.log("alive")},a.prototype.headEffect=function(){game.AppFacade.getInstance().retrieveProxy(game.HeroPy.N);var e=this.effectData&&this.effectData.initStar||0,t=!1,i=!1;if(0==e){var o=game.Config.allHeroConfig();for(var n in o){var a=o[n];if(a.avatar==this.effectData.avatar){e=a.initStar;break}}var r=game.Config.getHeroDermaConfig();for(var n in r)if(r[n].avatar==this.effectData.avatar){t=!0;break}var s=game.Config.itemConfig();for(var n in s){var c=s[n];if(c.icon==this.effectData.avatar&&c.effectEx&&c.type==EPropType.EPropTypeAvatar){i=!0;break}}}(10<=e||t||i)&&DragonBoneTools.create("common_yingxiongtouxiangkuang",function(e){e.anchorOffsetX=0,e.anchorOffsetY=0,e.x=this.img_bg.width/2,e.y=this.img_bg.height/2,e.animation.play("common_yingxiongtouxiangkuang",0),this.gp_effect.addChild(e)},this)},a.prototype.addFrameEffect=function(e){RES.hasRes(e+"_texture_json")&&DragonBoneTools.create(e,function(e){e.scaleX=e.scaleY=1,e.anchorOffsetX=0,e.anchorOffsetY=0,e.x=0,e.y=0,e.animation.play(),this.gp_effect1.addChild(e)},this)},a);function a(){var e=o.call(this)||this;return e.skinName="PlayerHeadSkin",e}e.PlayerHead=n,__reflect(n.prototype,"customui.PlayerHead",["eui.UIComponent","egret.DisplayObject","IObjectPoolInterface"])}(customui=customui||{}),function(a){var e=(t.registerAll=function(){(new o).register(),(new h).register(),(new u).register(),(new s).register()},t);function t(){}a.TaskAllProcessor=e,__reflect(e.prototype,"game.TaskAllProcessor");var i,o=(i=a.ProcessorBase,__extends(n,i),n.prototype.execute=function(e){var t=e.getBody();a.AppFacade.getInstance().retrieveProxy(a.TaskPy.N).update(t.tasks)},n);function n(){return i.call(this,"task.TaskP",n)||this}a.TaskP=o,__reflect(o.prototype,"game.TaskP");var r,s=(r=a.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody(),i=a.AppFacade.getInstance().retrieveProxy(a.TaskPy.N);if(t.tasks&&t.tasks[0]){var o=t.tasks[0].code,n=a.Config.taskConfig()[o];i.updateTaskDone(n.type,t.tasks)}},c);function c(){return r.call(this,"task.DoneTaskP",c)||this}a.DoneTaskP=s,__reflect(s.prototype,"game.DoneTaskP");var l,h=(l=a.ProcessorBase,__extends(p,l),p.prototype.execute=function(e){var t=e.getBody(),i=a.AppFacade.getInstance().retrieveProxy(a.TaskPy.N);a.AppFacade.getInstance().sendNotification(CN.BRAVEBOOK_LEVEL_UPDATE,{data:t.braveBookTask,preLevel:i.braveBookTask.level}),i.braveBookTask=t.braveBookTask,a.AppFacade.getInstance().retrieveMediator(a.BraveBookMediator.N).updateView(a.BraveBookMediator.SV.MAIN)},p);function p(){return l.call(this,"task.BraveBookTaskP",p)||this}__reflect(h.prototype,"BraveBookTaskP");var d,u=(d=a.ProcessorBase,__extends(g,d),g.prototype.execute=function(e){var t=e.getBody(),i=a.AppFacade.getInstance().retrieveProxy(a.TaskPy.N);i.NewBraveBooklevelParams={level:t.braveBookTask.level,preLevel:i.newBraveBookTask.level},i.newBraveBookTask=t.braveBookTask,a.AppFacade.getInstance().retrieveMediator(a.ActivityMediator.N).updateViewByCode(EActivityType.NewBraveBook)},g);function g(){return d.call(this,"task.NewBraveBookTaskP",g)||this}__reflect(u.prototype,"NewBraveBookTaskP")}(game=game||{}),function(W){var t,e=(__extends(j,t=BaseProxy),j.prototype.initNotice=function(){var e=this;NoticeManager.setChildType(NT.TASK_ENTRANCE,[NT.DAILY_TASK]),NoticeManager.registerCB(NT.DAILY_TASK,function(){return e.checkTaskNotice(TaskType.Daily)},this),NoticeManager.registerCB(NT.BRAVABOOK,function(){return e.checkTaskNotice(TaskType.BraveBook)},this),NoticeManager.registerCB(NT.NEWBRAVABOOK,function(){return e.checkTaskNotice(TaskType.NewBraveBook)},this),NoticeManager.registerCB(NT.NEWBRAVABOOK,function(){return e.checkTaskNotice(TaskType.NewNewBraveBook)},this),NoticeManager.registerCB(NT.SECOND_ACHIEVEMENT,this.checkSecondAchievementNotice,this)},j.prototype.checkTaskNotice=function(e){var t,i,o,n,a,r=W.Config.taskConfigByTypeSperBySubtype(e),s=W.AppFacade.getInstance().retrieveProxy(W.ActivityPy.N),c=W.AppFacade.getInstance().retrieveProxy(W.BackpackPy.N),l=[];if(e==TaskType.BraveBook)t=s.allActivityData[EActivityType.BraveBook],i=W.Config.braveBook(),o=W.Config.braveBookLevelConfigs(),a=W.Config.braveBookstarRewardConfigs(),n=this.braveBookTask;else if(e==TaskType.NewBraveBook||e==TaskType.NewNewBraveBook){t=s.allActivityData[EActivityType.NewBraveBook];var h=W.Config.newBraveBookTasksConfig();i=[];var p=this.allTasks&&this.allTasks[e].length;if(0<p){l=[];for(var d=p-1;p-21<d;--d){var u=this.allTasks[e][d];for(var g in h){var f=h[g];if(u.code==f.code){i.push(f),l.push(u);break}}}}a=W.Config.newBraveBookRewardConfig(),o=W.Config.newBraveBookLevelConfig(),n=this.newBraveBookTask}var _={},m=[];for(var y in this.allTasks[e])(U=this.allTasks[e][y])&&(_[U.code]=U);for(var v in r){var T=r[v],C=parseInt(v);for(var y in T){var E=T[y],I=JSON.parse(E.target)[0],b=this.getTaskKey(e,E.code);if(C==TaskSubType.ArenaChallengeRank||C==TaskSubType.TeamArenaChallengeRank){if(b&&b<=I&&(!_[E.code]||!_[E.code].isTarget))return!0}else if(I<=b&&(!_[E.code]||!_[E.code].isTarget))return!0}}if((e==TaskType.BraveBook||e==TaskType.NewBraveBook||e==TaskType.NewNewBraveBook)&&t&&t.data){var A=!0;if(e==TaskType.BraveBook&&(A=t.data.isBuy),A){var P=W.AppFacade.getInstance().retrieveProxy(j.N),M=t.content[1],N=e==TaskType.BraveBook?P.braveBookTask.starTargeted:P.newBraveBookTask.starTargeted,S=[];if(c.checkEnough([M[0][1][0]],!1))return!0;for(var k in o){var U;if(""!=(U=o[k]).rewards&&n&&n.level>=Number(k)&&-1==n.levelTargeted.indexOf(Number(k)))return!0}for(var v in i){C=(T=i[v]).subType;var L=(b=P.getBraveTask(e,T.code))&&b.isTarget||!1;if(I=JSON.parse(T.target)[0],0<N.length)for(var O=0,w=N;O<w.length;O++)(B=w[O])==T.chapterCode&&(S[T.chapterCode]=!0);if((C==TaskSubType.ArenaChallengeRank?b&&0<b.key&&b.key<=I||!1:b&&b.key>=I||!1)&&1==L&&(null==m[T.chapterCode]?m[T.chapterCode]=1:m[T.chapterCode]++),27<=m[T.chapterCode]&&!S[T.chapterCode])return!0;for(var y in T){E=T;var x=this.getTaskKey(e,E.code);if(C==TaskSubType.ArenaChallengeRank||C==TaskSubType.TeamArenaChallengeRank){if(x&&x<=I&&(!_[E.code]||!_[E.code].isTarget))return!0}else if(I<=x&&(!_[E.code]||!_[E.code].isTarget))return!0}}for(var R in a){var B,D=1;for(var g in i){D=i[g].chapterCode;break}if((B=a[R]).chapterCode==D&&B.type==e){var V=this.newBraveBookTask&&this.newBraveBookTask.starTargeted;if(0<V.length&&-1==V.indexOf(B.code)){for(var H=0,G=0,F=l;G<F.length&&0!=F[G].isTarget;G++)++H;if(H>=W.ActivityBraveBookViewNew.MAXTASKNUM)return!0}}}}}return!1},j.prototype.update=function(e,t,i){var o=!1;if(!t){var n=e[0].code;t=(W.Config.taskConfig()[n]||W.Config.braveBook()[n]||W.Config.newBraveBookTasksConfig()[n]||W.Config.getSecAchievementConfig()[n]).type}var a=this.allTasks[t];for(var r in e){for(var s=e[r],c=!1,l=0,h=a;l<h.length;l++){var p=h[l];p.code===s.code&&(p.update(s),c=!0)}if(!c){var d=new W.TaskVO(s);d.type=t,a.push(d),o=!0}}var u={type:t};switch(t){case TaskType.Daily:W.AppFacade.getInstance().updateView(W.TaskMediator.N,W.TaskMediator.SV.MAIN),NoticeManager.updateNotice(NT.DAILY_TASK);break;case TaskType.Achievement:break;case TaskType.Guide:case TaskType.DifficultyGuide:W.AppFacade.getInstance().updateView(W.GuajiMediator.N,W.GuajiMediator.SV.MAIN,{fromGuide:!0}),u.newTask=o;break;case TaskType.HideAchievement:break;case TaskType.BraveBook:var g=W.AppFacade.getInstance().retrieveMediator(W.BraveBookMediator.N);this.braveBookTask||this.getBraveBookTask(),g.updateView(W.BraveBookMediator.SV.MAIN,i),NoticeManager.updateNotice(NT.BRAVABOOK,void 0,!0);break;case TaskType.NewNewBraveBook:case TaskType.NewBraveBook:this.braveBookTask||this.getNewBraveBookTask(),(g=W.AppFacade.getInstance().retrieveMediator(W.ActivityMediator.N)).updateViewByCode(EActivityType.NewBraveBook,i),NoticeManager.updateNotice(NT.NEWBRAVABOOK,void 0,!0);break;case TaskType.SecondAchievement:NoticeManager.updateNotice(NT.SECOND_ACHIEVEMENT),W.AppFacade.getInstance().updateView(W.TaskMediator.N,W.TaskMediator.SV.SECOND_ACHIEVEMENT)}W.AppFacade.getInstance().sendNotification(CN.TASK_UPDATE,u)},j.prototype.fetch=function(t,i){var o=this;this.allTasks[t]||(this.allTasks[t]=new Array),Utils.Socket.send("task","GetTaskInfo",{type:t}).then(function(e){e&&(o.update(e.tasks,t),i&&i(),t==TaskType.HideAchievement&&W.AppFacade.getInstance().sendNotification(CN.EGGS_UPDATE))})},j.prototype.getTaskInfo=function(i,o){var n=this;Utils.Socket.send("task","GetTaskInfo",{type:i.type,condKey:i.condKey}).then(function(e){if(e&&(i.type==TaskType.NewBraveBook||i.type==TaskType.NewNewBraveBook)){var t=e.tasks;i.condKey,n.newBraveBookTaskHistory[i.condKey]=t,o&&o()}})},j.prototype.getTaskKey=function(e,t){for(var i in W.Config.taskConfig(),this.allTasks[e]){var o=this.allTasks[e][i];if(o.code==t)return o.key}return 0},j.prototype.getCurGuideTask=function(e){null==e&&(e=TaskType.Guide);var t=this.allTasks[e];for(var i in t){var o=t[i];if(!o.isTarget)return o}},j.prototype.getTaskStatus=function(e){var t;if(e.isTarget)t=TaskStatus.RECEIVE;else{var i=JSON.parse(e.config.target);t=e.config.subType==TaskSubType.ArenaChallengeRank||e.config.subType==TaskSubType.TeamArenaChallengeRank?e.key<=i[0]?TaskStatus.DONE:TaskStatus.UNDONE:e.key>=i[0]?TaskStatus.DONE:TaskStatus.UNDONE}return t},j.prototype.GetTaskAllReward=function(i,o,n){var a=this;Utils.Socket.send("task","GetTaskAllReward",{type:i,id:n&&n.id}).then(function(e){if(W.AppFacade.getInstance().retrieveProxy(W.BackpackPy.N).handleClientReward(e.clientReward,{closeCB:function(){a.sendNotification(CN.TASK_GET_REWARDS_POP_CLOSE),o&&o()}}),a.update(e.tasks,i,n),i==TaskType.NewBraveBook||i==TaskType.NewNewBraveBook){var t=e.tasks[0].chapterCode;a.newBraveBookTaskHistory[t]=e.tasks}})},j.prototype.GetTaskReward=function(n,a,r,s){var c=this;Utils.Socket.send("task","GetTaskReward",{code:a,type:n}).then(function(e){var t=W.AppFacade.getInstance().retrieveProxy(W.BackpackPy.N);for(var i in t.handleClientReward(e.clientReward,{closeCB:function(){c.sendNotification(CN.TASK_GET_REWARDS_POP_CLOSE),r&&r()}}),e.secondAchievementTask&&c.secAchInfo.update(e.secondAchievementTask),c.allTasks[n]){var o=c.allTasks[n][i];o.code==a&&(o.isTarget=!0)}c.update(e.tasks,n,s),500008!=a&&500010!=a||W.AppFacade.getInstance().sendNotification(CN.EGGS_UPDATE)})},j.prototype.getBraveBookTask=function(t){var i=this;Utils.Socket.send("task","GetBraveBookTask",{}).then(function(e){i.braveBookTask=e.braveBookTask,NoticeManager.updateNotice(NT.BRAVABOOK,void 0,!0),t&&t.cb&&t.cb()}).catch(function(e){})},j.prototype.getBraveLevelReward=function(t){var i=this;Utils.Socket.send("task","GetBraveBookLevelReward",{levels:t.levels}).then(function(e){i.braveBookTask=e.braveBookTask,W.AppFacade.getInstance().retrieveProxy(W.BackpackPy.N).handleClientReward(e.clientReward,2),t&&t.cb&&t.cb()}).catch(function(e){})},j.prototype.getBraveBookStarReward=function(t){var i=this;Utils.Socket.send("task","GetBraveBookStarReward",{code:t.code}).then(function(e){i.braveBookTask=e.braveBookTask,W.AppFacade.getInstance().retrieveProxy(W.BackpackPy.N).handleClientReward(e.clientReward),t&&t.cb&&t.cb()}).catch(function(e){})},j.prototype.getNewBraveBookTask=function(t){var i=this;Utils.Socket.send("task","GetNewBraveBookTask",{}).then(function(e){i.newBraveBookTask=e.braveBookTask,NoticeManager.updateNotice(NT.NEWBRAVABOOK,void 0,!0),t&&t.cb&&t.cb()}).catch(function(e){})},j.prototype.getNewBraveLevelReward=function(t){var i=this;Utils.Socket.send("task","GetNewBraveBookLevelReward",{levels:t.levels}).then(function(e){i.newBraveBookTask=e.braveBookTask,W.AppFacade.getInstance().retrieveProxy(W.BackpackPy.N).handleClientReward(e.clientReward,2),t&&t.cb&&t.cb()}).catch(function(e){})},j.prototype.getNewBraveBookStarReward=function(t){var i=this;Utils.Socket.send("task","GetNewBraveBookStarReward",{code:t.code}).then(function(e){i.newBraveBookTask=e.braveBookTask,i.update(e.tasks,t.type),W.AppFacade.getInstance().retrieveProxy(W.BackpackPy.N).handleClientReward(e.clientReward),t&&t.cb&&t.cb()}).catch(function(e){})},j.prototype.getBraveTask=function(e,t){for(var i in this.allTasks[e]){var o=this.allTasks[e][i];if(o.code==t)return o}},j.prototype.GetTaskDone=function(t){var i=this;void 0===t&&(t=TaskType.Guide),Utils.Socket.send("task","GetTaskDone",{type:t}).then(function(e){i.TaskDone[t]=e.tasks})},j.prototype.updateTaskDone=function(e,t){this.TaskDone[e]||(this.TaskDone[e]=[]),this.TaskDone[e]=this.TaskDone[e].concat(t)},j.prototype.GetSecondAchievementTask=function(){var t=this;Utils.Socket.send("task","GetSecondAchievementTask",{}).then(function(e){t.secAchInfo.update(e.secondAchievementTask)})},j.prototype.GetSecondAchievementLevelReward=function(e,t){var i=this;Utils.Socket.send("task","GetSecondAchievementLevelReward",{level:e}).then(function(e){W.GameMVC.backpackPy.handleClientReward(e.clientReward),i.secAchInfo.update(e.secondAchievementTask),NoticeManager.updateNotice(NT.SECOND_ACHIEVEMENT),t&&t()})},j.prototype.GetSecondAchievementReward=function(e,t){var i=this;Utils.Socket.send("task","GetTaskReward",{code:e,type:TaskType.SecondAchievement}).then(function(e){W.GameMVC.backpackPy.handleClientReward(e.clientReward,{closeCB:function(){i.sendNotification(CN.TASK_GET_REWARDS_POP_CLOSE),t&&t()}}),i.secAchInfo.update(e.secondAchievementTask),i.allTasks[TaskType.SecondAchievement].splice(0),i.update(e.tasks,TaskType.SecondAchievement)})},j.prototype.checkSecondAchievementNotice=function(){var e=this.allTasks[TaskType.SecondAchievement];for(var t in e){var i=e[t];if(!i.isTarget){var o=JSON.parse(i.config.target)[0];if(i.key>=o)return!0}}var n=this.secAchInfo.level,a=W.Config.getSecAchievementLevelConfig();for(var r in a){var s=a[r];if(s.isShow&&n>=s.level&&this.secAchInfo.levelTargeted.indexOf(s.level)<0)return!0}return!1},j.N="TaskProxy",j);function j(){var e=t.call(this,j.N)||this;return e.newBraveBookTaskHistory={},e.lastUnlockTaskStatus=!1,e.TaskDone={},e.proInterval=0,e.proMax=0,e.guildProInterval=0,e.guildProMax=0,e.allTasks=new Array,e.allProgresss=new Array,e.secAchInfo=new W.SecondAchievementInfoVO,e.initNotice(),e}W.TaskPy=e,__reflect(e.prototype,"game.TaskPy")}(game=game||{}),function(o){var n,e=(__extends(t,n=BasePanel),t.prototype.onDestroy=function(){n.prototype.onDestroy.call(this)},t.prototype.childrenCreated=function(){var e=this;if(n.prototype.childrenCreated.call(this),UIActionManager.hideScrollerBar(this.sl_root),this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.topProgress||(this.topProgress=new r,this.topProgress.horizontalCenter=0,this.topProgress.img_bg.source="common_img_kt_7_png",this.topProgress.img_title_bg.visible=!1,this.gp_progress.addChild(this.topProgress)),this.initTabbar(),this.addNotice(),this.list_root.dataProvider=new eui.ArrayCollection,this.list_root.itemRenderer=r,!this.timer){var t=Utils.TimerManager.getServerTime(),i=new Date(1e3*t);i.setHours(23,59,59),this.leftTime=i.getTime()/1e3-t,this.lb_time.text=Utils.TimerManager.getFormatBySecond1(this.leftTime),this.timer=egret.setInterval(function(){e.leftTime--,(!e.leftTime||e.leftTime<0)&&(e.leftTime=86400,e.updateView({})),e.lb_time.text=Utils.TimerManager.getFormatBySecond1(e.leftTime)},this,1e3)}this.btn_onekey.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.proxy.GetTaskAllReward(TaskType.Daily)},this),this.onTabbarTap({itemIndex:this.curSelectIndex})},t.prototype.updateView=function(e){if(e&&e.taskType){if(!this.taskType_2_tabbarIndex[e.taskType])return;this.onTabbarTap({itemIndex:this.taskType_2_tabbarIndex[e.taskType]})}else this.updateList()},t.prototype.onTabbarTap=function(e){this.curSelectIndex=e.itemIndex;var t=new eui.VerticalLayout;t.horizontalAlign=egret.HorizontalAlign.CENTER,t.gap=10,this.list_root.layout=t,0==this.curSelectIndex?(this.CommonDaTanChuKuang.blb_title.text="任务",this.sl_root.height=522,this.sl_root.y=226,t.paddingTop=0,this.gp_progress.visible=!0,this.gp_refreshTime.visible=!0):(this.CommonDaTanChuKuang.blb_title.text="成就",this.sl_root.height=740,this.sl_root.y=70,t.paddingTop=15,this.gp_progress.visible=!1,this.gp_refreshTime.visible=!1),this.updateList()},t.prototype.updateTopProgress=function(e){this.topProgress.data=e,this.topProgress.dataChanged()},t.prototype.updateList=function(){var e=[],t=0==this.curSelectIndex?TaskType.Daily:TaskType.Achievement,i=0==this.curSelectIndex?this.DailyConfig:this.AchieveConfig,o={};for(var n in this.proxy.allTasks[t]){var a=this.proxy.allTasks[t][n];a&&(o[a.code]=a)}var r=!1;for(var s in i){var c=i[s],l=parseInt(s),h={code:0,current:0,type:t,subType:l,total:99999999,desc:"",finish:!1,rewards:[],isTarget:!1,jumpModule:void 0};for(var n in l!=TaskSubType.ArenaChallengeRank&&l!=TaskSubType.TeamArenaChallengeRank||(h.total=-1),c){var p=c[n],d=JSON.parse(p.target)[0];l==TaskSubType.ArenaChallengeRank||l==TaskSubType.TeamArenaChallengeRank?o[p.code]&&!o[p.code].isTarget&&d>h.total&&(h.code=p.code,h.current=this.proxy.getTaskKey(t,h.code),h.desc=p.desc,h.rewards=p.rewards,h.jumpModule=p.jumpModule,h.finish=h.current&&h.current<=d,h.total=d):o[p.code]&&!o[p.code].isTarget&&d<h.total&&(h.code=p.code,h.current=this.proxy.getTaskKey(t,h.code),h.total=d,h.desc=p.desc,h.finish=h.current>=h.total,h.rewards=p.rewards,h.jumpModule=p.jumpModule)}if(!h.code){var u=c[c.length-1].code;o[u]&&o[u].isTarget&&(d=JSON.parse(c[c.length-1].target)[0],h.code=u,h.current=h.total=d,h.rewards=c[c.length-1].rewards,h.finish=!0,h.isTarget=!0,h.desc=c[c.length-1].desc)}if(l==TaskSubType.ArenaChallengeRank||l==TaskSubType.TeamArenaChallengeRank){var g=h.total;h.total=h.current,h.current=g}0==h.total&&(h.total=1,h.current=1),h.subType!=TaskSubType.DoneAllDailyTask?e.push(h):this.updateTopProgress(h),h.finish&&!h.isTarget&&(r=!0)}e.sort(function(e,t){return e.isTarget!=t.isTarget?e.isTarget?1:-1:e.finish!=t.finish?e.finish?-1:1:e.code-t.code}),this.list_root.dataProvider.replaceAll(e),this.sl_root.stopAnimation(),this.list_root.validateNow(),this.sl_root.viewport.scrollV>this.list_root.height-this.sl_root.height&&(this.sl_root.viewport.scrollV=this.list_root.height-this.sl_root.height),UIActionManager.setAbsGrey(this.btn_onekey,!r)},t.prototype.initTabbar=function(){var t=this;this.tabbar.itemRendererSkinName="BackpackUI_TabbarItemSkin",this.tabbar.dataProvider=new eui.ArrayCollection([{source:{up:"_btn_yq_m_json.common_yeqian_renwu_0",down:"_btn_yq_m_json.common_yeqian_renwu_1",text:"任务"}},{source:{up:"_btn_yq_m_json.common_yeqian_chengjiu_0",down:"_btn_yq_m_json.common_yeqian_chengjiu_1",text:"成就"}}]),this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){t.sl_root.viewport.scrollV=0,t.onTabbarTap(e)},this)},t.prototype.addNotice=function(){},t.prototype.perClose=function(){n.prototype.perClose.call(this),this.timer&&egret.clearInterval(this.timer)},t);function t(){var e,t=n.call(this)||this;return t.curSelectIndex=0,t.taskType_2_tabbarIndex=((e={})[TaskType.Daily]=0,e[TaskType.Achievement]=1,e),t.skinName="TaskViewSkin",t.proxy=o.AppFacade.getInstance().retrieveProxy(o.TaskPy.N),t.backpackProxy=o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N),t.DailyConfig=o.Config.taskConfigByTypeSperBySubtype(TaskType.Daily),t.AchieveConfig=o.Config.taskConfigByTypeSperBySubtype(TaskType.Achievement),t}o.TaskView=e,__reflect(e.prototype,"game.TaskView");var a,r=(a=eui.ItemRenderer,__extends(i,a),i.prototype.childrenCreated=function(){var i=this;a.prototype.childrenCreated.call(this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.data.isTarget||(i.data.finish?o.AppFacade.getInstance().retrieveProxy(o.TaskPy.N).GetTaskReward(i.data.type,i.data.code):i.data.jumpModule&&i.data.jumpModule!=MODULE.Task?(o.MainJumpConfig.jumpTo(i.data.jumpModule),o.AppFacade.getInstance().hideSubView(o.TaskMediator.N,o.TaskMediator.SV.MAIN)):i.data.jumpModule!=MODULE.Task&&Utils.MsgUtils.addMidMsg("无跳转途径"))},this),this.progressBar.slideDuration=0,this.progressBar.labelDisplay.scaleX=1/this.progressBar.scaleX,this.progressBar.labelDisplay.scaleY=1/this.progressBar.scaleY,this.progressBar.labelFunction=function(e,t){return i.data&&i.data.current+"/"+i.data.total}},i.prototype.dataChanged=function(){if(this.progressBar.maximum!=this.data.total&&(this.progressBar.maximum=this.data.total),this.progressBar.value=this.data.current,this.lb_info.text=this.data.desc,this.data.isTarget?(this.btn_go.visible=!1,this.btn_gone.visible=!0):(this.btn_go.visible=!0,this.btn_gone.visible=!1,this.data.finish||this.data.subType==TaskSubType.DoneAllDailyTask?(this.data.subType!=TaskSubType.DoneAllDailyTask||this.data.finish?this.data.subType==TaskSubType.DoneAllDailyTask&&this.data.finish&&(this.btn_go.touchEnabled=!0,UIActionManager.setGrey(this.btn_go,!1)):(this.btn_go.touchEnabled=!1,UIActionManager.setGrey(this.btn_go,!0)),this.btn_go.label="领取"):this.btn_go.label="前往"),this.gp_reward.removeChildren(),this.data.rewards){var e=JSON.parse(this.data.rewards);for(var t in e){var i=e[t],o=customui.BaseItemFactory.create();o.updateData({reward:i}),o.scaleX=o.scaleY=.8,o.x=5,o.y=3,this.gp_reward.addChild(o)}}},i);function i(){var e=a.call(this)||this;return e.skinName="CommonItemRenderTaskSkin",e}__reflect(r.prototype,"taskItem")}(game=game||{}),function(c){var t,e=(__extends(i,t=BasePanel),i.prototype.initList=function(){this.list_items.itemRenderer=n,this.ac_items=new eui.ArrayCollection,this.list_items.dataProvider=this.ac_items},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.activateComponent()},i.prototype.updateView=function(e){var t=this.taskPy.secAchInfo;this.targetLevelConfig=void 0;var i=c.Config.getSecAchievementLevelConfig();for(var o in i){var n=i[o];if(n.isShow){if(t.level>=n.level&&t.levelTargeted.indexOf(n.level)<0){this.targetLevelConfig=n;break}if(n.level>t.level){this.targetLevelConfig=n;break}}}this.gp_rewards.removeChildren(),this.targetLevelConfig?(this.gp_level.visible=!0,this.blb_progress.visible=!0,this.gp_rewards.visible=!0,this.blb_maxLevel.visible=!1,this.btn_obtain.visible=t.level>=this.targetLevelConfig.level,this.blb_level.text=t.level.toString(),this.blb_progress.text="("+t.level+"/"+this.targetLevelConfig.level+")",t.level>=this.targetLevelConfig.level?(this.img_bg.source="cj_img_tu01_png",this.blb_progress.font="green_num_fnt",this.blb_progress.y=75,this.gp_rewards.y=118):(this.img_bg.source="cj_img_tu02_png",this.blb_progress.font="white_num_fnt",this.blb_progress.y=91,this.gp_rewards.y=141),c.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,JSON.parse(this.targetLevelConfig.rewards),1)):(this.gp_level.visible=!1,this.blb_progress.visible=!1,this.gp_rewards.visible=!1,this.btn_obtain.visible=!1,this.blb_maxLevel.visible=!0,this.blb_maxLevel.text=t.level.toString(),this.img_bg.source="cj_img_tu03_png",this.btn_obtain.visible=!1);var a=this.taskPy.allTasks[TaskType.SecondAchievement],r=[],s=c.Config.getSecAchievementConfig();a.forEach(function(e){var t=s[e.code],i=JSON.parse(t.target)[0],o=REWARD_STATUS.UNAVAILABLE;e.isTarget?o=REWARD_STATUS.RECEIVED:e.key>=i&&(o=REWARD_STATUS.AVAILABLE);var n={info:e,config:t,target:i,status:o};r.push(n)}),r.sort(function(e,t){return e.status!=t.status?e.status-t.status:e.config.code-t.config.code}),this.ac_items.replaceAll(r)},i.prototype.activateComponent=function(){var e=this;this.rootPanel.blb_title.text="成长成就",this.rootPanel.onCloseCB=function(){e.hide()},this.btn_obtain.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.taskPy.GetSecondAchievementLevelReward(e.targetLevelConfig.level,function(){e.updateView()})},this)},i);function i(){var e=t.call(this)||this;return e.taskPy=c.GameMVC.taskPy,e.skinName="SecondAchievementPanelSkin",e}c.SecondAchievementPanel=e,__reflect(e.prototype,"game.SecondAchievementPanel");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.btn_obtain.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.GameMVC.taskPy.GetSecondAchievementReward(e.data.config.code)},this)},a.prototype.dataChanged=function(){var e=this.data.info,t=this.data.config;this.img_icon.source=t.icon+"_png",this.lb_desc.text=t.desc,1==t.progress?this.lb_progress.text=(Number(e.key)<this.data.target?0:t.progress)+"/"+t.progress:this.lb_progress.text=e.key+"/"+this.data.target;var i=JSON.parse(t.rewards);this.gp_rewards.removeChildren(),c.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,i,1);var o=this.data.status;o===REWARD_STATUS.RECEIVED?(this.btn_obtain.label="已完成",this.btn_obtain.skinName="skins.ButtonSkinSure",UIActionManager.setAbsGrey(this.btn_obtain,!1),this.btn_obtain.enabled=!1,this.lb_progress.visible=!1,this.btn_obtain.verticalCenter=0):(this.btn_obtain.label="领取",this.btn_obtain.skinName="skins.ButtonSkinYellow",o===REWARD_STATUS.AVAILABLE?(UIActionManager.setAbsGrey(this.btn_obtain,!1),this.btn_obtain.enabled=!0,this.lb_progress.textColor=2460433):(UIActionManager.setAbsGrey(this.btn_obtain,!0),this.btn_obtain.enabled=!1,this.lb_progress.textColor=4536106),this.lb_progress.visible=!0,this.btn_obtain.verticalCenter=20)},a);function a(){var e=o.call(this)||this;return e.skinName="SecondAchievementPanel_Item",e}__reflect(n.prototype,"SecondAchievementPanel_Item")}(game=game||{}),function(e){var t,i=(__extends(o,t=BasePanel),o);function o(){return null!==t&&t.apply(this,arguments)||this}e.UnlockTaskPanel=i,__reflect(i.prototype,"game.UnlockTaskPanel")}(game=game||{}),function(h){var n,e=(__extends(t,n=BasePanel),t.prototype.onDestroy=function(){n.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_touch_gold_hand")},t.prototype.childrenCreated=function(){var t=this;n.prototype.childrenCreated.call(this);var e=h.Config.VIPConfig(!0),i=0;for(var o in e)if(1==e[o].touchGoldTen){i=Number(o);break}this.btn_click_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.clickFunc(1)},this),this.btn_click_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.isLockTen)t.clickFunc(10);else{var e="vip"+i+"开启十连宝藏功能";Utils.MsgUtils.addMidMsg(e)}},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.initView(),this.initEffect()},t.prototype.initEffect=function(){var t=this;DragonBoneTools.playOnce({effectName:"common_airenbaozang_1",parent:this.gp_effect,x:100,y:115,loop:!0}),DragonBoneTools.create("common_airenbaozang_3",function(e){t.effect=e,t.effect.x=100,t.effect.y=128,t.effect.visible=!1,t.effect.animation.stop(),t.gp_effect.addChild(t.effect)})},t.prototype.initView=function(){for(var e=h.Config.touchGoldHandRewards(),t=this.playerpy.playerInfoVO.level,i=1;e[i];){var o=e[i],n=JSON.parse(o.levelLimit);if(n[0]<=t&&n[1]>=t){var a=JSON.parse(o.rewards),r=h.GeneralConfig.getEntityConfigByCode(a[0][0],a[0][1]);this.img_rewardIcon.source=ResourceUtils.png(r.icon),this.lb_reward.text=""+Utils.MathUtils.formatNumStyle1(a[0][2]);break}++i}},t.prototype.updateView=function(){var e=h.Config.VIPConfig();if(this.touchGoldHandPy.touchGoldHandInfo&&0<this.touchGoldHandPy.touchGoldHandInfo.freeTimes&&e.touchGoldTen<=0){this.btn_click_1.label="免费",this.common_1.visible=!1,UIActionManager.setGrey(this.btn_click_10,!0);var t=this.touchGoldHandPy.touchGoldHandInfo.hBuyTimes,i=h.Config.publicBuyCostConfig(MODULE.TouchGoldHand,t),o=[(a=JSON.parse(i.costs))[0][0],a[0][1],10*a[0][2]];this.common_10.updateItem({cost:o,style:CommonIconStyle.RIGHT,showEnough:!1})}else if(this.touchGoldHandPy.touchGoldHandInfo){this.playerpy.playerInfoVO.level,t=this.touchGoldHandPy.touchGoldHandInfo.hBuyTimes;var n=this.touchGoldHandPy.touchGoldHandInfo.freeTimes,a=(i=h.Config.publicBuyCostConfig(MODULE.TouchGoldHand,t),JSON.parse(i.costs));if(h.GeneralConfig.getEntityConfigByCode(a[0][0],a[0][1]),0<e.touchGoldTen){var r=0<n;this.btn_click_1.label=1==r?"免费":"1次宝藏",this.isLockTen=!0;for(var s=1;s<3;++s){var c=this["common_"+(1==s?1:10)];c.visible=1!=s||!r;var l=1==s?a[0][2]:10*a[0][2];o=[a[0][0],a[0][1],l],c.updateItem({cost:o,style:CommonIconStyle.RIGHT,showEnough:!1})}}else this.common_1.visible=!0,this.isLockTen=!1,this.btn_click_1.label="1次宝藏",this.common_1.updateItem({cost:a[0],style:CommonIconStyle.RIGHT,showEnough:!1});UIActionManager.setGrey(this.btn_click_10,!this.isLockTen)}},t.prototype.playEffect=function(i){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return this.btn_click_1.touchEnabled=!1,this.playing=!0,this.img_box.source="arbz_img_baoxiangkai_png",this.effect&&(this.effect.animation.play(),this.effect.visible=!0),[4,DragonBoneTools.playOnce({effectName:"common_airenbaozang_2",parent:this.gp_effect,x:100,y:115,loop:!1,doneCB:function(){egret.setTimeout(function(){t.effect&&t.effect.armature&&(h.AppFacade.getInstance().retrieveProxy(h.BackpackPy.N).handleClientReward(i.clientReward),t.img_box&&(t.img_box.source="arbz_img_baoxiangguan_png"),t.effect&&t.effect.armature&&t.effect.animation.stop(),t.effect&&(t.effect.visible=!1),t.btn_click_1.touchEnabled=!0,t.playing=!1)},t,500)}})];case 1:return e.sent(),[2]}})})},t.prototype.clickFunc=function(e){var t=this;Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_dianjin),this.touchGoldHandPy.touchGold({times:e,doneCB:function(e){t.playEffect(e)}})},t);function t(){var e=n.call(this)||this;return e.playing=!1,e.isLockTen=!1,e.touchGoldHandPy=h.AppFacade.getInstance().retrieveProxy(h.TouchGoldHandPy.N),e.playerpy=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N),Utils.AssetsMgr.loadGroup("group_touch_gold_hand"),e.skinName="TouchGoldHandSkin",e}h.TouchGoldHand=e,__reflect(e.prototype,"game.TouchGoldHand")}(game=game||{}),function(e){var t,i=(t=eui.ItemRenderer,__extends(o,t),o.prototype.dataChanged=function(){this.img_icon.source=this.data.img,this.lb_name.text=this.data.name},o);function o(){var e=t.call(this)||this;return e.skinName="src/component/RewardItemRender.exml",e.touchChildren=!0,e}e.RewardItemRender=i,__reflect(i.prototype,"game.RewardItemRender")}(game=game||{}),function(i){var t,e=(__extends(o,t=BaseProxy),o.prototype.checkNotice=function(){return!Utils.SDKMgr.getPerformConfig(2)&&this.touchGoldHandInfo&&0<this.touchGoldHandInfo.freeTimes},o.prototype.touchGold=function(t){var i=this;Utils.Socket.send("touchGoldHand","TouchGold",{times:t.times}).then(function(e){t.doneCB&&t.doneCB(e),i.getTouchGoldHandInfo()}).catch(function(e){console.log("TouchGold error --"+e)})},o.prototype.getTouchGoldHandInfo=function(){var t=this;Utils.Socket.send("touchGoldHand","GetTouchGoldHandInfo",{}).then(function(e){t.touchGoldHandInfo=e.info,i.AppFacade.getInstance().retrieveMediator(i.TouchGoldHandMediator.N).updateView(i.TouchGoldHandMediator.SV.MAIN),NoticeManager.updateNotice(NT.GOLDHAND)}).catch(function(e){console.log(e)})},o.N="TouchGoldHandPy",o);function o(){var e=t.call(this,o.N)||this;return NoticeManager.registerCB(NT.GOLDHAND,e.checkNotice,e),e}i.TouchGoldHandPy=e,__reflect(e.prototype,"game.TouchGoldHandPy")}(game=game||{}),function(e){var i,t=(i=eui.Component,__extends(o,i),Object.defineProperty(o.prototype,"onArmatureLoadCB",{set:function(e){this.isCreating?this._onArmatureLoadCB=e:e&&e()},enumerable:!0,configurable:!0}),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.width=this.height=0,this.data&&this.update(this.data)},o.prototype.update=function(l,e){return __awaiter(this,void 0,void 0,function(){var t,i,o,n,a,r,s,c;return __generator(this,function(e){switch(e.label){case 0:if(l=l||{vo:game.GameMVC.playerPy.playerInfoVO},this.data=l,this.cacheFrameRate=!1,this.curStyle=ROLE_STYLE.Fashion,this.loadingStyle=0,t=this.data.reqStyle||65535,a=n=o=i=void 0,this.data){if(this.cacheFrameRate=this.data.cacheFrameRate||!1,this.data.vo?(this.data.fashionCode=this.data.vo.fashionCode,this.data.horseCode=this.data.vo.horseCode,this.data.titleCode=this.data.vo.titleCode,this.data.magicalCode=this.data.vo.magicalCode):(r=game.GameMVC.playerPy.playerInfoVO,this.data.fashionCode=this.data.fashionCode?this.data.fashionCode:r.fashionCode,this.data.horseCode=this.data.horseCode?this.data.horseCode:r.horseCode,this.data.titleCode=this.data.titleCode?this.data.titleCode:r.titleCode,this.data.magicalCode=this.data.magicalCode?this.data.magicalCode:r.magicalCode),t&ROLE_STYLE.Fashion||(this.data.fashionCode=0),t&ROLE_STYLE.Horse||(this.data.horseCode=0),t&ROLE_STYLE.Title||(this.data.titleCode=0),t&ROLE_STYLE.Magical||(this.data.magicalCode=0),this.data.fashionModel){for(s in i=[this.data.fashionModel+"_z",this.data.fashionModel+"_b"],c=game.Config.fashionConfig())if(c[s].model==this.data.fashionModel){this.fashionHeight=c[s].ol_height;break}}else if(this.data.fashionCode){if(!(c=game.Config.fashionConfig()[this.data.fashionCode]))return[2];this.fashionHeight=c.ol_height,i=[c.model+"_z",c.model+"_b"]}if(i=i||["zhujiao_01_z","zhujiao_01_b"],this.data.horseModel)o=[this.data.horseModel+"_z_t",this.data.horseModel+"_z_s",this.data.horseModel+"_b_t",this.data.horseModel+"_b_s"],this.curStyle|=ROLE_STYLE.Horse;else if(this.data.horseCode){if(!(c=game.Config.horseConfigList()[this.data.horseCode]))return[2];o=[c.modelId+"_z_t",c.modelId+"_z_s",c.modelId+"_b_t",c.modelId+"_b_s"],this.curStyle|=ROLE_STYLE.Horse}if(this.data.titleModel)n=this.data.titleModel+"_png",this.curStyle|=ROLE_STYLE.Title;else if(this.data.titleCode){if(!(c=game.Config.titleConfig()[this.data.titleCode]))return[2];n=c.icon,this.curStyle|=ROLE_STYLE.Title}if(this.data.magicalModel){for(s in a=this.data.magicalModel+"_z_png",c=game.Config.allMagicalConfig())if(c[s].ol_model==this.data.magicalModel){this.curMagicalConfig=c[s];break}this.curStyle|=ROLE_STYLE.Magical}else if(this.data.magicalCode){if(!(c=game.Config.allMagicalConfig()[this.data.magicalCode])||!c.ol_model)return[2];RES.hasRes(c.ol_model+"_z_png")&&(this.curMagicalConfig=c,a=c.ol_model+"_z_png",this.curStyle|=ROLE_STYLE.Magical)}}return egret.log("当前模型配置",this.isCreating,i,o,n,a),this.isCreating=!0,[4,this.makeFashion(i)];case 1:return e.sent(),this.makeHorse(o),this.makeTitle(n),this.makeMagical(a),[2]}})})},o.prototype.updateSelf=function(){egret.log("自身形象变化，刷新模型"),this.update()},o.prototype.makeFashion=function(i){var o=this;return new Promise(function(t){(o.creatingDict[ROLE_STYLE.Fashion]=i)?DragonBoneTools.create(i[0],function(e){o.creatingDict[ROLE_STYLE.Fashion]&&o.creatingDict[ROLE_STYLE.Fashion][0]!=i[0]||(o.cleanChild(o.ead_model1),o.ead_model1=e,o.ead_model1.scaleX=o.ead_model1.scaleY=.55,o.addChild(o.ead_model1),DragonBoneTools.create(i[1],function(e){o.creatingDict[ROLE_STYLE.Fashion]&&o.creatingDict[ROLE_STYLE.Fashion][1]!=i[1]||(o.cleanChild(o.ead_model2),o.ead_model2=e,o.ead_model2.scaleX=o.ead_model2.scaleY=.55,o.ead_model2.visible=!1,o.addChild(o.ead_model2),o.markLoadDone(ROLE_STYLE.Fashion),t())},o,{cacheFrameRate:o.cacheFrameRate}))},o,{cacheFrameRate:o.cacheFrameRate}):(o.cleanChild(o.ead_model1),o.ead_model1=void 0,o.cleanChild(o.ead_model2),o.ead_model2=void 0,o.markLoadDone(ROLE_STYLE.Fashion),t())})},o.prototype.makeHorse=function(t){var i=this;(this.creatingDict[ROLE_STYLE.Horse]=t)?DragonBoneTools.create(t[0],function(e){i.creatingDict[ROLE_STYLE.Horse]&&i.creatingDict[ROLE_STYLE.Horse][0]!=t[0]||(i.cleanChild(i.ead_horse_z_t),i.ead_horse_z_t=e,i.ead_horse_z_t.scaleX=i.ead_horse_z_t.scaleY=.55,i.addChild(i.ead_horse_z_t),DragonBoneTools.create(t[1],function(e){i.creatingDict[ROLE_STYLE.Horse]&&i.creatingDict[ROLE_STYLE.Horse][1]!=t[1]||(i.cleanChild(i.ead_horse_z_s),i.ead_horse_z_s=e,i.ead_horse_z_s.scaleX=i.ead_horse_z_s.scaleY=.55,i.addChild(i.ead_horse_z_s),DragonBoneTools.create(t[2],function(e){i.creatingDict[ROLE_STYLE.Horse]&&i.creatingDict[ROLE_STYLE.Horse][2]!=t[2]||(i.cleanChild(i.ead_horse_b_t),i.ead_horse_b_t=e,i.ead_horse_b_t.scaleX=i.ead_horse_b_t.scaleY=.55,i.ead_horse_b_t.visible=!1,i.addChild(i.ead_horse_b_t),DragonBoneTools.create(t[3],function(e){i.creatingDict[ROLE_STYLE.Horse]&&i.creatingDict[ROLE_STYLE.Horse][3]!=t[3]||(i.cleanChild(i.ead_horse_b_s),i.ead_horse_b_s=e,i.ead_horse_b_s.scaleX=i.ead_horse_b_s.scaleY=.55,i.ead_horse_b_s.visible=!1,i.addChild(i.ead_horse_b_s),i.markLoadDone(ROLE_STYLE.Horse))},i,{cacheFrameRate:i.cacheFrameRate}))},i,{cacheFrameRate:i.cacheFrameRate}))},i,{cacheFrameRate:i.cacheFrameRate}))},this,{cacheFrameRate:this.cacheFrameRate}):(this.cleanChild(this.ead_horse_z_t),this.ead_horse_z_t=void 0,this.cleanChild(this.ead_horse_z_s),this.ead_horse_z_s=void 0,this.cleanChild(this.ead_horse_b_s),this.ead_horse_b_s=void 0,this.cleanChild(this.ead_horse_b_t),this.ead_horse_b_t=void 0,this.markLoadDone(ROLE_STYLE.Horse))},o.prototype.makeTitle=function(t){var i=this;(this.creatingDict[ROLE_STYLE.Title]=t)?(this.img_title||(this.img_title=new eui.Image,this.img_title.scaleX=this.img_title.scaleY=.5,this.img_title.horizontalCenter=0,this.img_title.visible=!1,this.addChild(this.img_title)),RES.getResAsync(t,function(e){i.creatingDict[ROLE_STYLE.Title]==t&&(i.img_title.source=e,i.markLoadDone(ROLE_STYLE.Title))},this)):(this.cleanChild(this.img_title),this.img_title=void 0)},o.prototype.replaceMagicalWithTex=function(e,t,i,o){try{var n=this.curMagicalConfig||{},a=(n["ol_scaleXY"+o]||1e6)/1e6,r=n["ol_slotKey"+o]||"wuqi_01",s=new eui.Image;s.source=t,s.width=t.textureWidth*a,s.height=t.textureHeight*a,s.anchorOffsetX=(n["ol_acOffsetX"+o]||0)/1e4*a,s.anchorOffsetY=(n["ol_acOffsetY"+o]||0)/1e4*a,i.armature.getSlot(r)&&(i.armature.getSlot(r).display=s),i.armature.getBone(r)&&(i.armature.getBone(r).offset.rotation=(n["ol_rotation"+o]||0)/1e4)}catch(e){egret.warn("模型武器绑定失败",e)}},o.prototype.makeMagical=function(t){var i=this;(this.creatingDict[ROLE_STYLE.Magical]=t)?RES.getResAsync(t,function(e){i.replaceMagicalWithTex(t,e,i.ead_model1,"_z"),i.replaceMagicalWithTex(t,e,i.ead_model2,"_b"),i.markLoadDone(ROLE_STYLE.Magical)},this):this.curMagicalConfig&&(this.curMagicalConfig=void 0,RES.getResAsync("wuqi_01_z_png",function(e){i.replaceMagicalWithTex(t,e,i.ead_model1,"_z"),i.replaceMagicalWithTex(t,e,i.ead_model2,"_b"),i.markLoadDone(ROLE_STYLE.Magical)},this))},o.prototype.cleanChild=function(e){e&&e.parent&&e.parent.removeChild(e)},o.prototype.markLoadDone=function(e){var t=this;if(this.curStyle&e&&(this.loadingStyle|=e),this.loadingStyle==this.curStyle){if(this.isCreating=!1,null!=this.curDir?this.onChangingDir(this.curDir):this.onChangingDir(3),this._curModelAct?this.curModelAct=this._curModelAct:this.curModelAct=ROLE_ACTION_NAME.DJ,this.curStyle&ROLE_STYLE.Horse){if(this.ead_horse_z_s.armature&&this.ead_horse_z_s.armature.getBone("an")){var i=this.ead_horse_z_s.armature.getBone("an").global;this.ead_model1.x=i.x*this.ead_model1.scaleX,this.ead_model1.y=i.y*this.ead_model1.scaleY}this.ead_horse_b_s.armature&&this.ead_horse_b_s.armature.getBone("an")&&(i=this.ead_horse_b_s.armature.getBone("an").global,this.ead_model2.x=i.x*this.ead_model2.scaleX,this.ead_model2.y=i.y*this.ead_model2.scaleY)}else this.ead_model1.x=this.ead_model2.x=0,this.ead_model1.y=this.ead_model2.y=0;this.titleOffsetY(),this._onArmatureLoadCB&&this.once(egret.Event.ENTER_FRAME,function(){t._onArmatureLoadCB&&t._onArmatureLoadCB(),t._onArmatureLoadCB=void 0},this)}},o.prototype.titleOffsetY=function(e){void 0===e&&(e=0),this.img_title&&(this.curStyle&ROLE_STYLE.Title?(this.img_title.visible=!0,this.curStyle&ROLE_STYLE.Horse?this.img_title.y=this.ead_model1.y-(this.fashionHeight||220)/4*3*this.ead_model1.scaleY-this.img_title.height*this.img_title.scaleY+e:this.img_title.y=-(this.fashionHeight||220)*this.ead_model1.scaleY-this.img_title.height*this.img_title.scaleY+e):this.img_title.visible=!1)},o.prototype.getHeadNameBottom=function(){return this.curStyle&ROLE_STYLE.Horse?Math.abs(this.ead_model1.y-(this.fashionHeight||220)/4*3*this.ead_model1.scaleY):Math.abs(-(this.fashionHeight||220)*this.ead_model1.scaleY)},o.prototype.changeAction=function(e){},o.prototype.onActionComplete=function(){},o.prototype.playEach=function(e,t){e&&e.animation&&(e.animation.hasAnimation(t)?e.animation.play(t):e.animation.play(ROLE_ACTION_NAME.DJ))},o.prototype.setOrder=function(e,t){e&&e.parent.setChildIndex(e,t)},Object.defineProperty(o.prototype,"curModelAct",{get:function(){return this._curModelAct},set:function(e){this._curModelAct=e,this.curStyle&ROLE_STYLE.Horse?(this.playEach(this.ead_model1,ROLE_ACTION_NAME_WHILE_H[e]),this.playEach(this.ead_model2,ROLE_ACTION_NAME_WHILE_H[e]),this.playEach(this.ead_horse_z_t,e),this.playEach(this.ead_horse_z_s,e),this.playEach(this.ead_horse_b_t,e),this.playEach(this.ead_horse_b_s,e)):(this.playEach(this.ead_model1,e),this.playEach(this.ead_model2,e))},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"flipX",{set:function(e){e<0?(this.scaleX=-Math.abs(this.scaleX),this.img_title&&(this.img_title.scaleX=-Math.abs(this.img_title.scaleX))):(this.scaleX=Math.abs(this.scaleX),this.img_title&&(this.img_title.scaleX=Math.abs(this.img_title.scaleX)))},enumerable:!0,configurable:!0}),o.prototype.calZOrder=function(){var e=0;this.setOrder(this.ead_horse_b_s,e++),this.setOrder(this.ead_horse_z_s,e++),this.setOrder(this.ead_model1,e++),this.setOrder(this.ead_model2,e++),this.setOrder(this.ead_horse_b_t,e++),this.setOrder(this.ead_horse_z_t,e++)},o.prototype.onChangingDir=function(e){null!=e&&(this.curDir=e),this.isCreating||(3==e||1==e?(this.ead_model1&&(this.ead_model1.visible=!0),this.ead_model2&&(this.ead_model2.visible=!1),this.ead_horse_z_t&&(this.ead_horse_z_t.visible=!0),this.ead_horse_z_s&&(this.ead_horse_z_s.visible=!0),this.ead_horse_b_t&&(this.ead_horse_b_t.visible=!1),this.ead_horse_b_s&&(this.ead_horse_b_s.visible=!1),this.flipX=1==e?-1:1):(this.ead_model1&&(this.ead_model1.visible=!1),this.ead_model2&&(this.ead_model2.visible=!0),this.ead_horse_z_t&&(this.ead_horse_z_t.visible=!1),this.ead_horse_z_s&&(this.ead_horse_z_s.visible=!1),this.ead_horse_b_t&&(this.ead_horse_b_t.visible=!0),this.ead_horse_b_s&&(this.ead_horse_b_s.visible=!0),this.flipX=0==e?1:-1),this.calZOrder())},o.prototype.reset=function(){this._curModelAct=ROLE_ACTION_NAME.DJ,this.curDir=3,this.flipX=1},o);function o(e){var t=i.call(this)||this;return t.isCreating=!1,t.creatingDict={},t.data=e,t}e.RoleDynamicModel=t,__reflect(t.prototype,"customui.RoleDynamicModel")}(customui=customui||{}),function(e){var t,i=(t=eui.Component,__extends(o,t),o.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.sl_root.scrollPolicyV=eui.ScrollPolicy.OFF,this.sl_root.bounces=!1,this.sl_root.throwSpeed=.3,this.gp_paddingLeft.childIndexCash=-1,this.gp_paddingRight.childIndexCash=99999,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.inTween&&(egret.Tween.removeTweens(e.sl_root.viewport),e.inTween=!1)},this),this.sl_root.addEventListener(eui.UIEvent.CHANGE_END,this.onSHChangeEnd,this),this.sl_root.addEventListener(eui.UIEvent.CHANGE,this.onSHChange,this)},Object.defineProperty(o.prototype,"itemRenderer",{get:function(){return this._itemRenderer},set:function(e){this._itemRenderer=e,this.initItemrender=!0,this._itemWidth=e.itemWidth,this.updatePaddingGroup()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"gap",{get:function(){return this._gap},set:function(e){this._gap=e,this.updatePaddingGroup()},enumerable:!0,configurable:!0}),o.prototype.setDataProvider=function(e,t){void 0===t&&(t=!0),this.dataProvider=e,this.initDataProvider=!0,this.updateList(t)},o.prototype.setItemTapEvent=function(e,t){this.itemTapCB=e,this.itemTapCB_thisObj=t},o.prototype.updatePaddingGroup=function(){this.initItemrender&&(this.gp_paddingRight.width=this.gp_paddingLeft.width=(this.width-this._itemWidth)/2)},o.prototype.updateList=function(e){var i=this;if(void 0===e&&(e=!0),this.initDataProvider&&this.initItemrender){function t(e){var t;e==r.gp_list.$children.length-1?((t=new r.itemRenderer).verticalCenter=0,r.gp_list.addChildAt(t,e)):t=r.gp_list.$children[e],r.once(egret.Event.ENTER_FRAME,function(){t.x=n+(e-1)*i._itemWidth+(e-1)*o,t.dataChildIndex=e-1,t.data=i.dataProvider[e-1],t.dataChanged(),e==a&&(i.gp_paddingRight.x=t.x+i._itemWidth,i.onSHChange())},r)}this.inTween&&(egret.Tween.removeTweens(this.sl_root.viewport),this.inTween=!1);for(var o=this._gap||0,n=this.gp_paddingLeft.width,a=this.dataProvider.length,r=this,s=1;s<=a;s++)t(s);this.gp_list.$children.length-2>this.dataProvider.length&&this.gp_list.$children.splice(this.dataProvider.length+1,this.dataProvider.length-this.gp_list.$children.length-2),e&&(this.sl_root.viewport.scrollH=0)}},o.prototype.callItemTapCB=function(e){this.itemTapCB&&this.itemTapCB.call(this.itemTapCB_thisObj,{itemIndex:e})},o.prototype.refresh=function(){this.updateList(!1)},o.prototype.getItemAt=function(e){return this.gp_list.$children[e+1]?this.gp_list.$children[e+1]:null},o.prototype.onSHChange=function(){this.caculateChildrenIndexList(),this.sortChildren();for(var e=this.gp_list.$children.length,t=1;t<e-1;t++)this.gp_list.$children[t].onScrollHChange()},o.prototype.onSHChangeEnd=function(){var e=this,t=this.caculateCurIndex();console.log("onSHChangeEnd",t,this.lastSelectIndex2,this.lastScrollerH,this.sl_root.viewport.scrollH),t==this.lastSelectIndex2&&(this.lastScrollerH>this.sl_root.viewport.scrollH?t--:this.lastScrollerH<this.sl_root.viewport.scrollH&&t++),this.tweenTo(t,function(){e.lastSelectIndex2=t})},o.prototype.caculateChildrenIndexList=function(){var i=this,o=this._itemWidth/2-this.sl_root.viewport.scrollH-this.width/2,e=this.gp_list.$children.length,n=2/this.width;if(2<e){function t(e){a.childIndexCash[e]=Math.abs(a.gp_list.$children[e].x+o)*n;var t=a.gp_list.$children[e].dataChildIndex;a.childIndexCash[e]<a.onClickValidInterval&&a.lastSelectIndex!=t&&(a.inTween?a.tweenDoneCB=function(){i.lastSelectIndex=t,i.callItemTapCB(t)}:(a.lastSelectIndex=t,a.callItemTapCB(t))),a.gp_list.$children[e].childIndexCash=a.childIndexCash[e]}for(var a=this,r=1;r<e-1;r++)t(r)}},o.prototype.sortChildren=function(){this.gp_list.$children.sort(function(e,t){return t.childIndexCash-e.childIndexCash})},o.prototype.tweenTo=function(e,t){var i=this;this.inTween&&(egret.Tween.removeTweens(this.sl_root.viewport),this.inTween=!1),e<0&&(e=0),e>this.dataProvider.length-1&&(e=this.dataProvider.length-1);var o=this.gp_paddingLeft.width+e*(this._itemWidth+this._gap)+this._itemWidth/2-this.width/2;this.inTween=!0,console.log("tween target",o),egret.Tween.get(this.sl_root.viewport,{onChange:this.onSHChange,onChangeObj:this}).to({scrollH:o},800,egret.Ease.cubicOut).call(function(){i.inTween=!1,i.lastScrollerH=o,i.tweenDoneCB&&(i.tweenDoneCB(),i.tweenDoneCB=void 0),t&&t()},this)},o.prototype.jumpTo=function(e,t){this.inTween&&(egret.Tween.removeTweens(this.sl_root.viewport),this.inTween=!1),e<0&&(e=0),e>this.dataProvider.length-1&&(e=this.dataProvider.length-1);var i=this.gp_paddingLeft.width+e*(this._itemWidth+this._gap)+this._itemWidth/2-this.width/2;this.sl_root.viewport.scrollH=i,this.lastScrollerH=i,this.lastSelectIndex2=e,this.onSHChange(),t&&t()},o.prototype.caculateCurIndex=function(){for(var e=9999,t=0,i=this.gp_list.$children.length,o=1;o<i-1;o++){var n=this.gp_list.$children[o].childIndexCash;n<e&&(e=n,t=this.gp_list.$children[o].dataChildIndex)}return t},o);function o(){var e=t.call(this)||this;return e._itemWidth=0,e.dataProvider=[],e.initDataProvider=!1,e.initItemrender=!1,e.inTween=!1,e.childIndexCash=[],e.lastSelectIndex=-1,e.lastSelectIndex2=-1,e.lastScrollerH=0,e.scrollerH=0,e.onClickValidInterval=.1,e.skinName="scroller2p0",e}e.scroller2p0=i,__reflect(i.prototype,"customui.scroller2p0",["eui.UIComponent","egret.DisplayObject"]);var n,a=(n=eui.Component,__extends(r,n),r.prototype.onScrollHChange=function(){if(1.5<this.childIndexCash)this.visible=!1;else{this.visible=!0;var e=(this.maxScale-this.minScale)*(1-this.childIndexCash)+this.minScale;e<this.minScale&&(e=this.minScale),this.gp_scale.scaleX=this.scaleY=e}},r.prototype.dataChanged=function(){},r);function r(){var e=n.call(this)||this;return e.maxScale=1,e.minScale=.8,e.childIndexCash=0,e.dataChildIndex=0,e}e.scroller2p0Item=a,__reflect(a.prototype,"customui.scroller2p0Item")}(customui=customui||{}),function(i){var e=(t.registerAll=function(){(new n).register(),(new s).register(),(new h).register()},t);function t(){}i.ArenaProcessor=e,__reflect(e.prototype,"game.ArenaProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.ArenaPy.N).updateArenaInfo(t.arenaInfo)},a);function a(){return o.call(this,"arena.ArenaInfoP",a)||this}i.ArenaInfoP=n,__reflect(n.prototype,"game.ArenaInfoP");var r,s=(r=i.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.ArenaPy.N).updateRecordInfo(t.arenaRecord,!0),i.GameMVC.arenaMed.getSubView(i.ArenaMediator.SV.MAIN)&&i.GameMVC.arenaPy.GetArenaInfo(function(){i.GameMVC.arenaPy.ChangeOpponent()})},c);function c(){return r.call(this,"arena.NewArenaRecordP",c)||this}i.NewArenaRecordP=s,__reflect(s.prototype,"game.NewArenaRecordP");var l,h=(l=i.ProcessorBase,__extends(p,l),p.prototype.execute=function(e){var t=e.getBody();t.clientReward&&(i.AppFacade.getInstance().retrieveProxy(i.ArenaPy.N).highestRewardData=t)},p);function p(){return l.call(this,"arena.ArenaRankRewardP",p)||this}i.ArenaRankRewardP=h,__reflect(h.prototype,"game.ArenaRankRewardP")}(game=game||{}),function(r){var t,e=(__extends(i,t=BaseProxy),i.prototype.checkArenaRewardNotice=function(){if(!this.arenaInfo)return!1;var e=this.arenaInfo.hRank,t=this.arenaInfo.hRankTargeted,i=(this.arenaInfo.rank,r.Config.arena_hRankReward());for(var o in i){var n=i[o],a=n.rank;if(a)if(REWARD_STATUS.UNAVAILABLE,-1!=t.indexOf(n.rank))REWARD_STATUS.RECEIVED;else if(e<=a)return REWARD_STATUS.AVAILABLE,!0}return!1},i.prototype.handleDotInfo=function(e){void 0===e&&(e=!1),Utils.UnlockMgr.checkPass(MODULE.Arena,!1).allow&&(e?this.GetArenaInfo():(parseInt(r.Config.constConfig().ArenaMaxCount.constValue),this.arenaInfo.challengeInfo.count))},i.prototype.GetArenaInfo=function(t){var i=this;Utils.Socket.send("arena","GetArenaInfo",{}).then(function(e){i.updateArenaInfo(e.arenaInfo),t&&t()})},i.prototype.ChangeOpponent=function(){var t=this;Utils.Socket.send("arena","ChangeOpponent",{}).then(function(e){t.updateOpponentInfo(e.opponents)})},i.prototype.BuyChallengeCount=function(t,i){var o=this;Utils.Socket.send("arena","BuyChallengeCount",{num:t}).then(function(e){Utils.MsgUtils.addMidMsg("成功购买"+t+"次"),o.arenaInfo.challengeInfo.count=e.challengeInfo.count,o.arenaInfo.challengeInfo.buyCount=e.challengeInfo.buyCount,r.AppFacade.getInstance().sendNotification(CN.ARENA_UPDATE_OPPONENT),i&&i()})},i.prototype.Challenge=function(e,t){var i=this,o='<b><font color="#ffffff" size="22">排名 '+this.arenaInfo.rank+' → </font><font color="#00fff0" size="22">'+e+"</font></b>",n='<b><font color="#ffffff" size="22">排名未发生变化</font></b>';r.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeArena,customParams:{fightBg:"fight_scene_jjc",tips:[this.arenaInfo.rank<=e?n:o,n]},pb1:"arena",pb2:"Challenge",params:{rank:e},doneCB:function(e){console.log("战斗结束",e),t&&t(),i.highestRewardData&&(PopUpManager.addPopUp({obj:new r.ArenaHigherRankPanel(i.highestRewardData),closeCB:function(){r.AppFacade.getInstance().sendNotification(CN.SHOW_WECHAT_SHARE)}}),r.AppFacade.getInstance().sendNotification(CN.QQZONE_PUSH_MESSAGE,{type:"areanChallenge"})),r.AppFacade.getInstance().retrieveProxy(r.FightPy.N).queueExceExitCB()}})},i.prototype.GetArenaRecord=function(t){var i=this;Utils.Socket.send("arena","GetArenaRecord",{}).then(function(e){i.updateRecordInfo(e.arenaRecords),t&&t()})},i.prototype.updateArenaInfo=function(e){this.arenaInfo||(this.arenaInfo=new r.ArenaInfo),this.arenaInfo.update(e),r.AppFacade.getInstance().sendNotification(CN.ARENA_UPDATE_INFO),this.handleDotInfo()},i.prototype.updateOpponentInfo=function(e){var t=this;this.opponents.splice(0),e&&(e.forEach(function(e){t.opponents.push(new r.ArenaPlayerInfo(e))}),this.opponents.sort(function(e,t){return e.rank-t.rank})),r.AppFacade.getInstance().sendNotification(CN.ARENA_UPDATE_OPPONENT)},i.prototype.updateRecordInfo=function(e,t){var i=this;void 0===t&&(t=!1),t?(this.latestRecord=e,this.arenaRecords.push(e)):(this.arenaRecords.splice(0),e.forEach(function(e){i.arenaRecords.push(new r.BattleRecord(e))})),this.arenaRecords.sort(function(e,t){return t.battleDt-e.battleDt})},i.N="ArenaProxy",i);function i(){var e=t.call(this,i.N)||this;return e.highestRewardData=void 0,e.opponents=new Array,e.arenaRecords=new Array,NoticeManager.setChildType(NT.ARENA,NT.ARENA_REWARD),NoticeManager.setChildType(NT.ARENA_REWARD,NT.ARENA_REWARD_LINQU),NoticeManager.registerCB(NT.ARENA_REWARD_LINQU,e.checkArenaRewardNotice,e,MODULE.Arena),e}r.ArenaPy=e,__reflect(e.prototype,"game.ArenaPy")}(game=game||{}),function(a){var t,e=(__extends(i,t=BaseFull),i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.removeNotice(),Utils.AssetsMgr.destroyGroup("group_arena")},i.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.ARENA_REWARD,this.btn_reward.$children[0],this,BTN_ICON_NOTICE_POS)},i.prototype.removeNotice=function(){NoticeManager.removeNoticeListener(NT.COMMON_SHOP[ShopType.ShopTypeArena])},i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.arenaPlayerItems=[this.gp_1,this.gp_2,this.gp_3,this.gp_4,this.gp_5,this.gp_6],this.gp_mine.addChild(this.cu_myPH),this.cu_myPH.scaleX=this.cu_myPH.scaleY=.85,this.cu_myPH.x=40,this.cu_myPH.y=12,this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.MainJumpConfig.jumpTo()},this),this.btn_back1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.MainJumpConfig.jumpTo()},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeArena})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().showSubView(a.RankMediator.N,a.RankMediator.SV.COMMON,{module:"ARENA"})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().showSubView(a.RankMediator.N,a.RankMediator.SV.COMMON,{module:"ARENA2"})},this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().showSubView(a.FightMediator.N,a.FightMediator.SV.RECORD,{pb1:"arena",pb2:"GetArenaRecord",key:"arenaRecords"})},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.buyCount()},this),this.btn_change.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.proxy.ChangeOpponent()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new a.HelpDialog({moduleId:MODULE.Arena})})},this),this.fetch(),this.addNotice()},i.prototype.buyCount=function(){var t=this;Number(a.Config.constConfig().ArenaMaxCount.constValue)<=this.proxy.arenaInfo.challengeInfo.count?Utils.MsgUtils.addMidMsg("当前次数已满"):a.AppFacade.getInstance().showSubView(a.CommonMediator.N,a.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.Arena,hasBuyNum:this.proxy.arenaInfo.challengeInfo.buyCount,buyCB:function(e){t.proxy.BuyChallengeCount(e)},curNum:this.proxy.arenaInfo.challengeInfo.count,maxNum:Number(a.Config.constConfig().ArenaMaxCount.constValue),maxBuyNum:a.Config.VIPConfig().arenaBuyTimes})},i.prototype.fetch=function(){var e=this;this.proxy.ChangeOpponent(),egret.setTimeout(function(){e.proxy.GetArenaInfo()},this,500)},i.prototype.updateView=function(e){var o=this;if(this.proxy.arenaInfo){this.blb_count.text=""+this.proxy.arenaInfo.challengeInfo.count,this.blb_rank.text=""+this.proxy.arenaInfo.rank,this.blb_cap.text=""+Utils.MathUtils.formatNumStyle2(this.playerPy.playerInfoVO.fightCap),this.cu_myPH.updateData({vo:this.playerPy.playerInfoVO});var n=Utils.UnlockMgr.checkPass(MODULE.ArenaSaoDang,!1).allow;this.arenaPlayerItems.forEach(function(e,t){var i=o.proxy.opponents[t];i&&e.update({vo:i,fightCB:function(e){0<o.proxy.arenaInfo.challengeInfo.count?o.proxy.Challenge(e.rank,function(){o.proxy.ChangeOpponent()}):(Utils.MsgUtils.addMidMsg("挑战次数不足"),o.buyCount())},mopUpCB:function(){0<o.proxy.arenaInfo.challengeInfo.count?a.AppFacade.getInstance().showSubView(a.CommonMediator.N,a.CommonMediator.SV.MOP_UP,{pb1:"arena",pb2:"MopUp",params:{rank:i.rank},mopUpTimes:10,cb:function(e){return o.proxy.arenaInfo.challengeInfo.count=e.challengeInfo.count,o.blb_count.text=""+o.proxy.arenaInfo.challengeInfo.count,i.rank>a.GameMVC.arenaPy.arenaInfo.rank?0<o.proxy.arenaInfo.challengeInfo.count:(Utils.MsgUtils.addMidMsg("排名发生变化"),!1)},tipsFunc:function(e){return"第"+e+"次"}}):Utils.MsgUtils.addMidMsg("挑战次数不足")},canFight:1<t||o.proxy.arenaInfo.rank<=10,canMopUp:n&&i.rank>o.proxy.arenaInfo.rank})})}},i);function i(){var e=t.call(this)||this;return Utils.AssetsMgr.loadGroup("group_arena"),e.skinName="ArenaViewSkin",e.proxy=a.AppFacade.getInstance().retrieveProxy(a.ArenaPy.N),e.backPy=a.AppFacade.getInstance().retrieveProxy(a.BackpackPy.N),e.playerPy=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),e.cu_myPH=customui.PlayerHeadFactory.create(),e}a.ArenaView=e,__reflect(e.prototype,"game.ArenaView")}(game=game||{}),function(e){var i,t=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){var e=this;this.params&&(this.bm_cur.text=this.params.rank+"名",this.bm_highest.text=this.params.preHRank+"名",this.bm_diff.text=Number(this.params.preHRank)-Number(this.params.rank)+"",this.CommonIconWithNum.updateItem({code:this.params.clientReward.rewards[0].code,type:this.params.clientReward.rewards[0].type,num:this.params.clientReward.rewards[0].num,style:CommonIconStyle.RIGHT}),this.btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this))},o.prototype.onDestroy=function(){e.AppFacade.getInstance().sendNotification(CN.SHOW_WECHAT_SHARE),e.AppFacade.getInstance().retrieveProxy(e.ArenaPy.N).highestRewardData=void 0},o);function o(e){var t=i.call(this)||this;return t.skinName="ArenaHigherRankPanelSkin",t.params=e,t}e.ArenaHigherRankPanel=t,__reflect(t.prototype,"game.ArenaHigherRankPanel")}(game=game||{}),function(s){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.sl_list.verticalScrollBar.visible=!1,this.sl_list.verticalScrollBar.autoVisibility=!1,this.cu_dtc.onCloseCB=function(){s.AppFacade.getInstance().hideSubView(s.ChampionMediator.N,s.ChampionMediator.SV.ACHIEVEMENT)},this.cu_dtc.blb_title.text="成就奖励"},i.prototype.updateView=function(){var e=this.proxy.championInfo.targeted,t=s.Config.championAchievement();this.sl_list.removeChildren();var i=new eui.List,o=new eui.VerticalLayout;o.horizontalAlign=egret.HorizontalAlign.CENTER,i.layout=o,this.sl_list.viewport=i;var n=new eui.ArrayCollection,a=new Array;for(var r in t)a.push({hasGot:e[r],obj:t[r]});a.sort(function(e,t){return e.hasGot&&!t.hasGot?1:!e.hasGot&&t.hasGot?-1:e.obj.id-t.obj.id}),a.forEach(function(e){n.addItem(e)}),i.dataProvider=n,i.itemRenderer=c},i);function i(){var e=t.call(this)||this;return e.skinName="ChampionAchievementSkin",e.proxy=s.AppFacade.getInstance().retrieveProxy(s.ChampionPy.N),e}s.ChampionAchievement=e,__reflect(e.prototype,"game.ChampionAchievement");var o,c=(o=eui.ItemRenderer,__extends(n,o),n.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.btn_oppr.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.proxy.ChampionAchievement(e.data.obj.id)},this)},n.prototype.dataChanged=function(){var i=this,e=this.proxy.championInfo.id-1,t=this.data.obj.id;this.lb_name.textFlow=[{text:"通关第"},{text:t,style:{textColor:13584896}},{text:"关，可领取"}],this.lb_sche.textFlow=[{text:"进度："},{text:""+e,style:{textColor:e<t?15400960:55839}},{text:"/"+t}],this.gp_rewards.removeChildren(),JSON.parse(this.data.obj.reachReward).forEach(function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,t.updateData({id:e[1],num:e[2]}),i.gp_rewards.addChild(t)}),e<t?(this.btn_oppr.enabled=!1,this.btn_oppr.visible=!0):this.data.hasGot?(this.btn_oppr.visible=!1,this.lb_tips.visible=!0):(this.btn_oppr.visible=this.btn_oppr.enabled=!0,this.lb_tips.visible=!1)},n);function n(){var e=o.call(this)||this;return e.skinName="ChampionAchievementItemSkin",e.proxy=s.AppFacade.getInstance().retrieveProxy(s.ChampionPy.N),e}__reflect(c.prototype,"ChampionAchievementItem")}(game=game||{}),function(s){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),egret.setTimeout(function(){t.setGuideAvailable()},this,500),this.btn_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide();var e=s.AppFacade.getInstance().retrieveProxy(s.ChampionPy.N);0<e.championInfo.challengeInfo.count?e.ChampionBattle():s.AppFacade.getInstance().retrieveMediator(s.ChampionMediator.N).getSubView(s.ChampionMediator.SV.MAIN).buyCount()},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){s.AppFacade.getInstance().showSubView(s.HeroMediator.N,s.HeroMediator.SV.FORMATION)},this),this.btn_seekHelp.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=s.GameMVC.championPy,t=s.GameMVC.mainPy,i=parseInt(s.Config.constConfig().ChampionHelpNumLimit.constValue);e.championInfo.id>=i?0==e.championInfo.challengeInfo.requestCount?t.scheId?Utils.MsgUtils.addMidMsg("口干舌燥，请休息一会"):(t.setInterval(),e.RequestHelp(),Utils.MsgUtils.addMidMsg("求助成功")):Utils.MsgUtils.addMidMsg("求助冷却中"):Utils.MsgUtils.addMidMsg(i+"关后可求助")},this)},t.prototype.updateView=function(e){var i=this,t=s.Config.champion()[e.id];this.lb_title.text=""+t.name,this.blb_cap.text=Utils.MathUtils.formatNumStyle2(t.fightCapacity),JSON.parse(t.passReward).forEach(function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,t.updateData({type:e[0],id:e[1],num:e[2]}),i.gp_rewards.addChild(t)});var o=[];try{for(var n=1;n<=6;n++){var a=t["creep"+n];a&&""!=a&&o.push(JSON.parse(t["creep"+n])[0])}}catch(e){this.log(e)}if(o.forEach(function(e){if(null!=e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e}),t.scaleX=t.scaleY=.7,t.touchEnabled=!1,i.gp_enermy.addChild(t)}}),0<s.GameMVC.championPy.championInfo.challengeInfo.requestCount){UIActionManager.setAbsGrey(this.btn_seekHelp,!0),this.btn_seekHelp.touchEnabled=!1;var r=Utils.TimerManager.getLeftTime([23,59,59]);this.timer&&egret.clearInterval(this.timer),this.timer=egret.setInterval(function(){0<--r&&(i.bm_seekHelpTime.text=Utils.TimerManager.getFormatBySecond1(r))},this,1e3)}else this.btn_seekHelp.touchEnabled=!0,UIActionManager.setAbsGrey(this.btn_seekHelp,!1),this.timer&&egret.clearInterval(this.timer),this.bm_seekHelpTime.text=""},t);function t(e){var t=i.call(this)||this;return t.skinName="ChampionBossPreviewSkin",t._popActionType=5,t._removeActionType=6,t.guideEffectWait=!0,t}s.ChampionBossPreview=e,__reflect(e.prototype,"game.ChampionBossPreview")}(game=game||{}),function(e){var o,t=(o=e.BaseItem,__extends(i,o),i.prototype.updateData=function(e){o.prototype.updateData.call(this,e),this.bloodMax=e.bloodMax,this.bloodNum=e.bloodNum,this.bloodSpr()},i.prototype.bloodSpr=function(){this.blood.maximum=this.bloodMax,this.blood.value=this.bloodNum},i);function i(e,t){var i=o.call(this)||this;return i.skinName="BaseItemExpeditionSkin",i}e.BaseExpeditionItem=t,__reflect(t.prototype,"customui.BaseExpeditionItem")}(customui=customui||{}),function(i){var e=(t.registerAll=function(){(new n).register()},t);function t(){}i.ChampionProcessor=e,__reflect(e.prototype,"game.ChampionProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.ChampionPy.N).updateInfo(t.info)},a);function a(){return o.call(this,"champion.PushChampionInfoP",a)||this}i.PushChampionInfoP=n,__reflect(n.prototype,"game.PushChampionInfoP")}(game=game||{}),function(r){var t,e=(__extends(i,t=BaseProxy),i.prototype.updateInfo=function(e){this.championInfo.update(e),this.sendNotification(CN.CHAMPION_UPDATE_INFO)},i.prototype.checkCurLayerCanGet=function(){var e=this.championInfo.id;this.championInfo.allPassed||(e-=1);var t=r.Config.champion()[e],i=!1;if(t&&""!=t.achievementReward&&(i=!0,this.championInfo.targeted))for(var o=0,n=this.championInfo.targeted;o<n.length;o++){var a=n[o];if(a.id==t.id){1<=a.num&&(i=!1);break}}return i},i.prototype.ChampionBattle=function(){var t=this,e=r.Config.champion()[this.championInfo.id];this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeChampion,pb1:"champion",pb2:"ChampionBattle",customParams:{fightBg:"fight_scene_gjzl",tips:['<b><font color="#ffffff" size="22">恭喜挑战 </font><font color="#00fff0" size="22">'+e.name+'</font><font color="#ffffff" size="22"> 成功</font></b>','<b><font color="#ffffff" size="22">很遗憾挑战 </font><font color="#00fff0" size="22">'+e.name+'</font><font color="#ffffff" size="22"> 失败</font></b>']},params:{},doneCB:function(e){console.log("战斗结束",e),e.result==EBattleResult.EBattleResultWin?t.sendNotification(CN.CHAMPION_UPDATE_INFO,{playWinActionBeforUpdate:!0,isNext:!1,isMove:!0}):t.sendNotification(CN.CHAMPION_UPDATE_INFO),r.AppFacade.getInstance().retrieveProxy(r.FightPy.N).queueExceExitCB()}})},i.prototype.Champion=function(){var t=this;Utils.Socket.send("champion","Champion",{}).then(function(e){t.updateInfo(e.info)})},i.prototype.ChampionMopUp=function(){var t=this;Utils.Socket.send("champion","ChampionMopUp",{}).then(function(e){t.updateInfo(e.info),r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N)})},i.prototype.ChampionClearCd=function(){var t=this;Utils.Socket.send("champion","ChampionClearCd",{}).then(function(e){t.updateInfo(e.info),r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N)})},i.prototype.BuyChallengeCount=function(t,i){var o=this;Utils.Socket.send("champion","BuyChallengeCount",{num:t}).then(function(e){Utils.MsgUtils.addMidMsg("成功购买"+t+"次"),o.championInfo.challengeInfo.update(e.challengeInfo),o.sendNotification(CN.CHAMPION_UPDATE_INFO),i&&i()})},i.prototype.ChampionAchievement=function(t,i){var o=this;Utils.Socket.send("champion","ChampionAchievement",{id:t}).then(function(e){o.championInfo.update(e.info),r.AppFacade.getInstance().retrieveProxy(r.BackpackPy.N).handleClientReward(e.clientReward,{onCloseCB:i}),r.AppFacade.getInstance().sendNotification(CN.QQZONE_PUSH_MESSAGE,{type:"championAchievement",data:{id:t,targetId:e.info.id}})})},i.prototype.RequestHelp=function(){Utils.Socket.send("champion","RequestHelp",{}).then(function(e){})},i.prototype.HelpChallenge=function(e,t){Utils.Socket.send("champion","HelpChallenge",{uuid:e}).then(function(e){})},i.N="ChampionProxy",i);function i(){var e=t.call(this,i.N)||this;return e.isZiDong=!0,e.isFist=!0,e.championInfo=new r.ChampionInfoVO,NoticeManager.registerCB(NT.CHAMPION,e.checkCurLayerCanGet,e),e}r.ChampionPy=e,__reflect(e.prototype,"game.ChampionPy")}(game=game||{}),function(g){var t,e=(__extends(i,t=BaseFull),i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.scheCountLeft&&(egret.clearInterval(this.scheCountLeft),this.scheCountLeft=void 0),this.removeNotice(),Utils.AssetsMgr.destroyGroup("group_champion")},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gp_main.touchChildren=!0,this._activateComponent(),this.addNotice(),this.initView(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btn),Utils.DeviceUtils.setLiuHaiPingAdapter(this.img_top)},i.prototype.initView=function(){this.sl_root.verticalScrollBar.visible=!1,this.sl_root.verticalScrollBar.autoVisibility=!1,this.collection=new eui.ArrayCollection,this.list=new eui.List,this.list.itemRenderer=n,this.list.dataProvider=this.collection,this.sl_root.viewport=this.list,this.cu_head=customui.PlayerHeadFactory.create(),this.cu_head.x=108,this.cu_head.y=27,this.cu_head.scaleX=this.cu_head.scaleY=.7,this.gp_bottom.addChild(this.cu_head)},i.prototype.addNotice=function(){},i.prototype.removeNotice=function(){},i.prototype.playWinActionBeforUpdate=function(r){return __awaiter(this,void 0,void 0,function(){var i,t,o,n,a=this;return __generator(this,function(e){for(i=!0,t=function(e){var t=o.list.getElementAt(e);if(t&&t.img_cloud_l.visible&&r)o.sl_root.stopAnimation(),o.gp_main.touchChildren=!1,egret.Tween.get(o.list).to({scrollV:o.list.contentHeight-o.sl_root.height-t.height},1e3).call(function(){a.gp_main.touchChildren=!0,t.hideCloud(function(){i&&(a.championProxy.isFist=!1,a.updateView({isStay:!0}),i=!1)})});else if(t&&!r)return o.sl_root.stopAnimation(),o.list.scrollV=o.list.contentHeight-o.sl_root.height,o.gp_main.touchChildren=!1,egret.Tween.get(o.list).to({scrollV:o.list.contentHeight-o.sl_root.height-t.height},1e3).call(function(){if(a.gp_main.touchChildren=!0,a.championProxy.isFist=!1,a.updateView(),a.championProxy.isTwo){var e=g.AppFacade.getInstance().retrieveProxy(g.ChampionPy.N);0<a.championProxy.championInfo.challengeInfo.count?(a.championProxy.isTwo=!1,e.ChampionBattle()):g.AppFacade.getInstance().retrieveMediator(g.ChampionMediator.N).getSubView(g.ChampionMediator.SV.MAIN).buyCount()}}),"break"},n=(o=this).list.numElements;0<n&&"break"!==t(n);n--);return[2]})})},i.prototype.updateView=function(e){var t=this;if(void 0===e&&(e=void 0),!this.fightPy.isInFight){var i=this.championProxy.championInfo;if(i.id){var o=this.championProxy.checkCurLayerCanGet();if(e&&e.playWinActionBeforUpdate&&!o&&e.id)this.playWinActionBeforUpdate(e&&e.id);else{this.collection.removeAll();var n=i.id,a=n;o&&n!=g.Config.championMaxLayer()?a=n-=1:e&&e.isMove&&!i.allPassed&&(a-=1),i.allPassed&&!o&&(a++,n++),this.collection.addItemAt({fade:!0,config:{id:a-1,achievementReward:""}},0);for(var r=n+10,s=a;s<r;s++){var c=g.Config.champion()[s],l=g.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.Champion,{id:c&&c.id||1});c?this.collection.addItem({config:c,lock:n+1<s||l.isBelonged&&!l.unlock||!!c.forceLock,isCur:!(e&&e.isMove||o||s!=n),canGet:o&&s==n,id:n,isStay:!!e&&!!e.isStay&&e.isStay}):(c={id:s,achievementReward:"",names:" "},this.collection.addItem({config:c,lock:!0,isCur:!1,canGet:!1,id:n,isStay:!!e&&!!e.isStay&&e.isStay,forceClound:!0}))}if(this.collection.length<4&&this.collection.addItemAt({fade:!0},0),this.collection.source.reverse(),this.collection.refresh(),this.list.validateNow(),!e||!e.playWinActionBeforUpdate||o||e.id){this.sl_root.stopAnimation(),this.list.scrollV=this.list.contentHeight-this.sl_root.height;var h=Number(g.Config.constConfig().ChampionRecoveryCD.constValue);this.blb_count.text=""+this.championProxy.championInfo.challengeInfo.count,this.scheCountLeft||(this.lb_recover.visible=!0,this.img_left_suffix.visible=!0,this.scheCountLeft=egret.setInterval(function(){var e=h-(Utils.TimerManager.getServerTime()-t.championProxy.championInfo.challengeInfo.lRCD);t.championProxy.championInfo.challengeInfo.count<g.Config.constConfig().ChampionMaxCount.constValue?0<e?t.lb_recover.text=Utils.TimerManager.getFormatBySecond1(e):t.championProxy.Champion():t.scheCountLeft&&(egret.clearInterval(t.scheCountLeft),t.scheCountLeft=void 0,t.lb_recover.visible=!1,t.img_left_suffix.visible=!1)},this,1e3));var p=h-(Utils.TimerManager.getServerTime()-this.championProxy.championInfo.challengeInfo.lRCD);0<p&&this.championProxy.championInfo.challengeInfo.count<g.Config.constConfig().ChampionMaxCount.constValue?this.lb_recover.text=Utils.TimerManager.getFormatBySecond1(p):(this.lb_recover.visible=!1,this.img_left_suffix.visible=!1),this.championProxy.isFist?(this.list.scrollV=0,this.once(egret.Event.ENTER_FRAME,function(){egret.Tween.get(t.list).to({scrollV:t.list.contentHeight-t.sl_root.height-80},1e3,egret.Ease.backOut).call(function(){t.setGuideAvailable()}),t.championProxy.isFist=!1},this)):this.setGuideAvailable();var d=g.Config.constConfig().ChampionHelpCount.constValue,u=this.championProxy.championInfo.challengeInfo.helpCount;this.bm_helpTimes.text=(u<d?d-u:0)+"/"+d}else this.playWinActionBeforUpdate(e&&e.id)}}}},i.prototype.buyCount=function(){var t=this;Number(g.Config.constConfig().ChampionMaxCount.constValue)!==this.championProxy.championInfo.challengeInfo.count?g.AppFacade.getInstance().showSubView(g.CommonMediator.N,g.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.Champion,curNum:this.championProxy.championInfo.challengeInfo.count,maxNum:Number(g.Config.constConfig().ChampionMaxCount.constValue),hasBuyNum:this.championProxy.championInfo.challengeInfo.buyCount,numLimit:!0,buyCB:function(e){t.championProxy.BuyChallengeCount(e)}}):Utils.MsgUtils.addMidMsg("当前次数已满")},i.prototype.adaptForGuide=function(e){t.prototype.adaptForGuide.call(this,e),e&&(this.list.useVirtualLayout=!1)},i.prototype._activateComponent=function(){var e=this;this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.championProxy.isFist=!0,g.MainJumpConfig.jumpTo()},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){g.AppFacade.getInstance().showSubView(g.RankMediator.N,g.RankMediator.SV.COMMON,{module:"CHAMPION"})},this),Utils.UnlockMgr.checkPass(MODULE.BattleFormation,!1).allow?this.btn_mutiTeam.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){g.GameMVC.heroMutiTeamPy.server_GetBattleFormationInfo(function(){g.GameMVC.heroMutiTeamMed.showSubView(g.HeroMutiTeamMediator.SV.MAIN,{type:2,moduleId:MODULE.Champion})})},this):this.btn_mutiTeam.visible=!1,this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.buyCount()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new g.HelpDialog({moduleId:MODULE.Champion})})},this)},i);function i(){var e=t.call(this)||this;return Utils.AssetsMgr.loadGroup("group_champion"),e.skinName="ChampionSkin",e.championProxy=g.AppFacade.getInstance().retrieveProxy(g.ChampionPy.N),e.playerPy=g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N),e.fightPy=g.AppFacade.getInstance().retrieveProxy(g.FightPy.N),e.guideEffectWait=!0,e}g.ChampionView=e,__reflect(e.prototype,"game.ChampionView");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.touchChildren=!0,this.gp_baoxiang.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.canGet?(e.touchChildren=!1,e.gp_effectGuang.visible=e.gp_effect.visible=e.gp_lingqu.visible=!1,e.championProxy.ChampionAchievement(e.data.config.id,function(){DragonBoneTools.playOnce({effectName:"common_baoxiangkai",parent:e.gp_baoxiang,x:e.gp_baoxiang.width/2,y:e.gp_baoxiang.height/2,z:2,doneCB:function(){e.data.config.names?Utils.MsgUtils.addMidMsg("已通关最后一层，敬请期待"):e.championProxy.isTwo=!1,e.touchChildren=!0,g.AppFacade.getInstance().sendNotification(CN.CHAMPION_UPDATE_INFO,{playWinActionBeforUpdate:!0,id:e.id})}})})):g.AppFacade.getInstance().showSubView(g.CommonMediator.N,g.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(e.data.config&&e.data.config.achievementReward),type:g.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this),this.gp_light.alpha=0,this.gp_light.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){!e.data.fade&&e.data.config&&e.data.config.id==e.championProxy.championInfo.id&&g.AppFacade.getInstance().showSubView(g.ChampionMediator.N,g.ChampionMediator.SV.PREVIEW,{id:e.data.config.id})},this)},a.prototype.switchChuanSongMen=function(t){t&&!this.effectChuanSongMen?DragonBoneTools.create("common_patachuansongmen",function(e){this.effectChuanSongMen=e,this.effectChuanSongMen.y=this.gp_light.y/2-30,this.effectChuanSongMen.x=50,this.effectChuanSongMen.visible=t,this.effectChuanSongMen.animation.timeScale=1,this.effectChuanSongMen.animation.play("common_patachuansongmen",0),this.gp_light.addChild(this.effectChuanSongMen)},this):this.effectChuanSongMen&&(this.effectChuanSongMen.visible=t)},a.prototype.effectBaoXiang=function(e){e?(this.gp_baoxiang.visible=e,this.gp_effect.visible=e,this.gp_effectGuang.visible=e,this.effect||(this.gp_effectGuang.removeChildren(),DragonBoneTools.create("common_patabaoxiang",function(e){this.effect=e,this.effect.x=this.gp_baoxiang.width/2,this.effect.y=this.gp_baoxiang.height/2,this.effect.scaleX=this.effect.scaleY=1.2,this.effect.visible=!0,this.effect.animation.play(),this.effect.animation.timeScale=1,this.gp_effectGuang.addChild(this.effect)},this)),e&&!this.effect_baoxiang&&(this.gp_effect.removeChildren(),DragonBoneTools.create("common_baoxiang_5",function(e){this.effect_baoxiang=e,this.effect_baoxiang.x=this.gp_baoxiang.width/2,this.effect_baoxiang.y=this.gp_baoxiang.height/2+15,this.effect_baoxiang.visible=!0,this.effect_baoxiang.animation.timeScale=1,this.gp_effect.addChild(this.effect_baoxiang)},this))):this.gp_baoxiang.visible=e},a.prototype.dataChanged=function(){var e,t=this;this.gp_lock.visible=!1,this.data.fade?(this.img_cloud_l.visible=this.img_cloud_r.visible=!1,this.img_kongmen.visible=!1,this.cu_model.visible=!1,this.gp_light.visible=!1,this.blb_floor.visible=!1,this.switchChuanSongMen(!1)):(this.img_kongmen.visible=!1,this.blb_floor.visible=!0,this.id=this.data.config.id,this.blb_floor.text=this.data.config.names||""+this.id,this.data.lock?(this.id-this.data.id>5-(this.data.id%5==0?5:this.data.id%5)||this.data.forceClound?(this.cu_model.visible=!1,this.img_cloud_l.visible=this.img_cloud_r.visible=!0):(0==this.cu_model.visible&&(this.data.isStay?egret.Tween.get(this.cu_model).to({alpha:0,visible:!0},100,egret.Ease.cubicIn).wait(250).to({alpha:1},100,egret.Ease.cubicOut):this.cu_model.visible=!0),this.img_cloud_l.visible=this.img_cloud_r.visible=!1),this.switchChuanSongMen(!1),this.gp_light.visible=!1):(this.data.isCur?(this.img_kongmen.visible=!0,egret.Tween.get(this.gp_light).to({alpha:0,visible:!0},100,egret.Ease.cubicIn).wait(250).to({alpha:1},100,egret.Ease.cubicOut),this.switchChuanSongMen(!0)):(this.switchChuanSongMen(!1),this.gp_light.visible=!1,this.img_kongmen.visible=!1),this.id-this.data.id>5-(this.data.id%5==0?5:this.data.id%5)?(this.cu_model.visible=!1,this.img_cloud_l.visible=this.img_cloud_r.visible=!0):(this.cu_model.visible||this.data.canGet||(this.data.isStay?egret.Tween.get(this.cu_model).to({alpha:0,visible:!0},100,egret.Ease.cubicIn).wait(250).to({alpha:1},100,egret.Ease.cubicOut):this.cu_model.visible=!0),this.img_cloud_l.visible=this.img_cloud_r.visible=!1)),(e=g.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.Champion,{id:t.data.config.id})).isBelonged&&(e.unlock||(t.cu_model.visible=!1,t.gp_lock.visible=!0,t.img_cloud_l.visible=t.img_cloud_r.visible=!0))),(this.cu_model.visible||this.data.isStay)&&this.cu_model.update({isStatic:!0,code:JSON.parse(this.data.config.creep1)[0]}),this.data.config&&this.data.config.id%2?this.currentState="you":this.currentState="zuo",this.effectBaoXiang(this.data.config&&""!=this.data.config.achievementReward&&!0),this.effect_baoxiang&&this.effect_baoxiang.animation.stop(),this.data.canGet?(this.cu_model.visible=!1,this.gp_lingqu.visible=!0,this.effect_baoxiang&&this.effect_baoxiang.animation.play(),egret.Tween.get(this.gp_lingqu,{loop:!0}).to({y:-22},500).to({y:-37},500)):this.gp_lingqu.visible=!1},a.prototype.hideCloud=function(e){var t=this;if(this.data.forceClound)e();else{var i=this.img_cloud_l.x,o=this.img_cloud_r.x;egret.Tween.get(this.img_cloud_l).to({x:this.img_cloud_l.x-150,alpha:0},900,egret.Ease.sineOut),egret.Tween.get(this.img_cloud_r).to({x:this.img_cloud_r.x+150,alpha:0},1e3,egret.Ease.sineOut).call(function(){t.img_cloud_l.x=i,t.img_cloud_r.x=o,t.img_cloud_l.alpha=1,t.img_cloud_r.alpha=1,e()})}},a);function a(){var e=o.call(this)||this;return e.skinName="ChampionFloorItemSkin",e.championProxy=g.AppFacade.getInstance().retrieveProxy(g.ChampionPy.N),e}__reflect(n.prototype,"ChampionFloorItem")}(game=game||{}),function(e){var t,i=(t=eui.ProgressBar,__extends(o,t),o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.slideDuration=0},o.prototype.setAddTimes=function(t,i,o){var n=this;return new Promise(function(e){n.addTimes(t,o,function(){null!=i&&i!=n.maximum?n.setBarValue(i,function(){e()}):e()})})},o.prototype.setAddValueWithInterval=function(t,i,o){var n=this;return new Promise(function(e){n.addValueWithInterval(t,i,o,function(){e()})})},o.prototype.setDuration=function(e){this.FIXED_SLIDE_DURATION=e},o.prototype.setPauseTime=function(e){this.FIXED_PAUSE_TIME=e},o.prototype.addTimes=function(e,t,i){var o=this;0!=e?this.setBarValue(this.maximum,function(){o.addTimes(e-1,t,i),t&&t()}):i&&i()},o.prototype.addValueWithInterval=function(e,t,i,o){var n=this;e<t&&(t=e),0<e?this.setBarValue(this.value+t,function(){n.addValueWithInterval(e-t,t,i,o),i&&i(t)}):o&&o()},o.prototype.setBarValue=function(e,t){var i=this;this.value==this.maximum&&this.resetProgress(),e>this.maximum?egret.Tween.get(this).to({value:this.maximum},this.getDuration(this.maximum-this.value)).call(function(){i.setBarValue(e-i.maximum,t)}):egret.Tween.get(this).to({value:e},this.getDuration(e-this.value)).wait(this.FIXED_PAUSE_TIME).call(function(){t&&t()})},o.prototype.getDuration=function(e){return e/this.maximum*this.FIXED_SLIDE_DURATION},o.prototype.resetProgress=function(){this.value=0},o);function o(){var e=t.call(this)||this;return e.FIXED_SLIDE_DURATION=200,e.FIXED_PAUSE_TIME=20,e}e.SpecialProgressBar=i,__reflect(i.prototype,"customui.SpecialProgressBar")}(customui=customui||{}),function(i){var e=(t.registerAll=function(){(new n).register(),(new s).register()},t);function t(){}i.CopyEntranceProcessor=e,__reflect(e.prototype,"game.CopyEntranceProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){var t=e.getBody();console.log("DailyFortressP",t),i.AppFacade.getInstance().retrieveProxy(i.CopyEntrancePy.N).updateDailyFortressInfo(t.dailyFortress)},a);function a(){return o.call(this,"fortress.DailyFortressP",a)||this}i.DailyFortressP=n,__reflect(n.prototype,"game.DailyFortressP");var r,s=(r=i.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody();console.log("ExpeditionInfoP",t),i.AppFacade.getInstance().retrieveProxy(i.CopyEntrancePy.N).updateExpeditionInfo(t.info)},c);function c(){return r.call(this,"expedition.ExpeditionInfoP",c)||this}i.ExpeditionInfoP=s,__reflect(s.prototype,"game.ExpeditionInfoP")}(game=game||{}),function(s){var t,e=(__extends(i,t=BaseProxy),i.prototype.addNotice=function(){var e=this;NoticeManager.registerCB(NT.EXPEDITION_CHALLENGE,function(){return Utils.UnlockMgr.checkPass(MODULE.Expedition,!1).allow&&!Utils.LocalStorageUtil.getTodayVaild("expedtionNotice")&&e.expeditionInfo&&0==e.expeditionInfo.sectionId},this),NoticeManager.registerCB(NT.DAILY_COPY,this.checkDailyNotice,this),NoticeManager.registerCB(NT.EXPEDITION_REWARD,this.checkExpedRewardNotice,this),NoticeManager.setChildType(NT.EXPEDITION,[NT.EXPEDITION_REWARD,NT.EXPEDITION_CHALLENGE])},i.prototype.updateDailyFortressInfo=function(e){var t=this;Array.isArray(e)||(e=[e]),e.forEach(function(e){t.dailyFortressInfo[e.fortressId]?t.dailyFortressInfo[e.fortressId].update(e):t.dailyFortressInfo[e.fortressId]=new s.DailyFortressVO(e)}),NoticeManager.updateNotice(NT.DAILY_COPY,void 0,!0)},i.prototype.GetDailyFortress=function(){var t=this;Utils.Socket.send("fortress","GetDailyFortress",{}).then(function(e){t.log("获取日常副本信息   GetDailyFortressR",e),t.updateDailyFortressInfo(e.dailyFortresses),s.AppFacade.getInstance().updateView(s.CopyEntranceMediator.N,s.CopyEntranceMediator.SV.DAILY_COPY)})},i.prototype.BuyDailyChallenge=function(e){var t=this;Utils.Socket.send("fortress","BuyDailyChallenge",{fortressId:e.fortressId,num:e.num}).then(function(e){t.log("购买次数   BuyDailyChallengeR",e),Utils.MsgUtils.addMidMsg("购买成功"),t.updateDailyFortressInfo(e.dailyFortress),s.AppFacade.getInstance().updateView(s.CopyEntranceMediator.N,s.CopyEntranceMediator.SV.DAILY_COPY_LIST),s.AppFacade.getInstance().updateView(s.CopyEntranceMediator.N,s.CopyEntranceMediator.SV.DAILY_COPY)})},i.prototype.makePlayerInfo=function(e,t,i,o){var n=new s.PlayerInfoVO;return n.name=e,n.level=t,n.playerVip.vipLevel=i,n.fightCap=o,n},i.prototype.ChallengeDailyFortress=function(e){this.curFortessId=e&&e.id,s.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeDailyFortress,customParams:{fightBg:"fight_scene_jjc",tips:['<b><font color="#ffffff" size="22">挑战成功</font>','<b><font color="#ffffff" size="22">挑战失败</font></b>']},pb1:"fortress",pb2:"ChallengeDailyFortress",params:{stageId:e.id},doneCB:function(e){console.log("战斗结束",e),s.AppFacade.getInstance().updateView(s.CopyEntranceMediator.N,s.CopyEntranceMediator.SV.DAILY_COPY_LIST);var t=s.AppFacade.getInstance().retrieveProxy(s.FightPy.N);t.queueExceExitCB(),t.dailyFakeFight=!1}})},i.prototype.GetExpeditionInfo=function(){var t=this;Utils.Socket.send("expedition","GetExpeditionInfo",{}).then(function(e){t.log("远征信息   GetExpeditionInfoR",e),t.updateExpeditionInfo(e.info)})},i.prototype.GetExpeditionRewards=function(e,t){var i=this;Utils.Socket.send("expedition","GetExpeditionRewards",{id:e}).then(function(e){i.log("获取远征奖励   GetExpeditionRewardsR",e),t||egret.setTimeout(function(){s.AppFacade.getInstance().retrieveProxy(s.BackpackPy.N).handleClientReward(e.clientReward)},i,600),i.updateExpeditionInfo(e.info),s.AppFacade.getInstance().updateView(s.CopyEntranceMediator.N,s.CopyEntranceMediator.SV.ACHIEVE_REWARD)})},i.prototype.ChallengeExpedtion=function(){s.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeBattleExpedition,customParams:{fightBg:"fight_scene_jjc",tips:['<b><font color="#ffffff" size="22">挑战成功</font>','<b><font color="#ffffff" size="22">挑战失败</font></b>']},pb1:"expedition",pb2:"ChallengeExpedition",params:{},doneCB:function(e){console.log("战斗结束",e),s.AppFacade.getInstance().updateView(s.CopyEntranceMediator.N,s.CopyEntranceMediator.SV.EXPEDITION),Utils.LocalStorageUtil.setTodayVaild("expedtionNotice"),NoticeManager.updateNotice(NT.EXPEDITION_CHALLENGE),s.AppFacade.getInstance().retrieveProxy(s.FightPy.N).queueExceExitCB()}})},i.prototype.getrewardInfo=function(e){var t=this.expeditionInfo.opponentList;if(0!=t.length)for(var i=0;i<t.length;i++)if(e==t[i].sectionId)return t[i]},i.prototype.checkExpedRewardNotice=function(){var e=this.expeditionInfo.sectionId,t=this.expeditionInfo.targeted,i=s.Config.expeditionAchievement();for(var o in i){var n=i[o],a=t&&-1!=t.indexOf(n.id),r=!a&&n.id<=e;if(!a&&r)return!0}return!1},i.prototype.updateExpeditionInfo=function(e){this.expeditionInfo&&this.expeditionInfo.sectionId<e.sectionId&&(this.openAnm=!0),this.expeditionInfo.update(e),NoticeManager.updateNotice(NT.EXPEDITION_REWARD,{},!0),s.AppFacade.getInstance().updateView(s.CopyEntranceMediator.N,s.CopyEntranceMediator.SV.EXPEDITION)},i.prototype.closeAnm=function(){this.openAnm=!1},i.prototype.ColorMatrix=function(){return[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]},i.prototype.checkDailyNotice=function(){var e=s.Config.dailyFortress(),t=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N).playerInfoVO.level;for(var i in e)if(!(t<e[i].levelLimit))for(var o in this.dailyFortressInfo){var n=this.dailyFortressInfo[o];if(n.fortressId==parseInt(i)&&0<n.leftChallenge)return!0}return!1},i.N="CopyEntrancePy",i);function i(){var e=t.call(this,i.N)||this;return e.openAnm=!1,e.dailyFortressInfo={},e.expeditionInfo=new s.ExpeditionVO,e.addNotice(),e}s.CopyEntrancePy=e,__reflect(e.prototype,"game.CopyEntrancePy")}(game=game||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_copy_entrance")},o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initList(),this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.img_title.source="wfrk_txt_fbtz_png"},o.prototype.initList=function(){this.item_list=new eui.List;var e=new eui.VerticalLayout;(this.item_list.layout=e).gap=10,e.horizontalAlign=egret.HorizontalAlign.CENTER,this.item_list.itemRenderer=a,this.scroller.viewport=this.item_list},o.prototype.updateView=function(){var e=[];for(var t in this.ENTRANCE_CONFIG)this.ENTRANCE_CONFIG[t].view=this,e.push(this.ENTRANCE_CONFIG[t]);this.item_list.dataProvider=new eui.ArrayCollection(e),this.gp_root.height=179*e.length+10*(e.length-1)},o);function o(){var e=i.call(this)||this;return e.ENTRANCE_CONFIG={DAILY:{desc:"日常副本",rankingType:void 0,moduleId:MODULE.DailyFortress,bg:"wfrk_img_rukou_rcfb_png",notice:NT.DAILY_COPY,descDown:"每日可获取大量培养道具"},EXPED:{desc:"英雄远征",rankingType:void 0,moduleId:MODULE.Expedition,bg:"wfrk_img_rukou_yxyz_png",notice:NT.EXPEDITION,descDown:"可获取远征币，兑换英雄和碎片"},TEAM_COPY:{desc:"组队副本",rankingType:void 0,notice:NT.TEAM_EXPE_REWARD_ENTRANCE,moduleId:MODULE.TeamExpedition,bg:"wfrk_img_rukou_zdfb_png",descDown:"可获取各种稀有道具和英雄"},DEEP_NEST:{desc:"深渊巢穴",rankingType:void 0,notice:NT.DEEP_NEST,moduleId:MODULE.AbyssLair,bg:"wfrk_img_shenyuanchaoxue_png",descDown:"可获取淬炼石和其他道具"},RACETOWER:{desc:"种族塔",rankingType:void 0,notice:NT.RACETOWER_ENTRANCE,moduleId:MODULE.RaceTower,bg:"wfrk_img_rukou_zzsy_png",descDown:"可获取各种稀有道具和英雄"}},Utils.AssetsMgr.loadGroup("group_copy_entrance"),e.skinName="PvpEntranceViewSkin",e._popActionType=5,e._removeActionType=6,e}t.CopyEntranceView=e,__reflect(e.prototype,"game.CopyEntranceView");var n,a=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){var e=this;n.prototype.childrenCreated.call(this),this.gp_black.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.jumpFunc?this.data.jumpFunc()?t.AppFacade.getInstance().hideSubView(t.CopyEntranceMediator.N,t.CopyEntranceMediator.SV.ENTRANCE):this.parent.selectedIndex=void 0:t.MainJumpConfig.jumpTo(this.data.moduleId)?t.AppFacade.getInstance().hideSubView(t.CopyEntranceMediator.N,t.CopyEntranceMediator.SV.ENTRANCE):this.parent.selectedIndex=void 0},this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){e.skin.currentState=""},this)},r.prototype.dataChanged=function(){this.img_bg.source=this.data.bg,this.data.notice&&NoticeManager.addNoticeListener(this.data.notice,this.gp_bg,this.data.view,{percentX:554/578,percentY:0});var e=Utils.UnlockMgr.checkPass(this.data.moduleId,!1);this.lb_unlock.text=this.data.descDown||"",e.allow?this.data.moduleId:(UIActionManager.setAbsGrey(this,!0),this.lb_unlock.text=e.ext.requestLevel?e.ext.requestLevel+"级可开启":e.ext.tips)},r);function r(){var e=n.call(this)||this;return e.skinName="EntranceView_ListItem",e}__reflect(a.prototype,"EntranceView_ListItem")}(game=game||{}),function(r){var t,e=(__extends(i,t=BaseFull),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.resource_bar),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_help),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.MainJumpConfig.jumpTo()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new r.HelpDialog({moduleId:MODULE.DailyFortress})})},this)},i.prototype.updateView=function(){if(this.firstIn)this.firstIn=!1,this.proxy.GetDailyFortress();else{var o=r.Config.dailyFortress(),n=r.AppFacade.getInstance().retrieveProxy(r.PlayerPy.N).playerInfoVO.level;function e(e){var t=o[e],i=a["gp_"+e];n<t.levelLimit?UIActionManager.setGrey(i,!0):UIActionManager.setGrey(i,!1),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n<t.levelLimit?Utils.MsgUtils.addMidMsg(t.levelLimit+"级开启"):r.AppFacade.getInstance().showSubView(r.CopyEntranceMediator.N,r.CopyEntranceMediator.SV.DAILY_COPY_LIST,{id:t.id})},a),a.effectNameMap[e]&&""!=a.effectNameMap[e]&&DragonBoneTools.playOnce({effectName:a.effectNameMap[e],parent:i,loop:!0,y:2*i.height/3,z:0,static:n<t.levelLimit})}this.resource_bar.updateBar({costs:[EPropertyType.EPropertyTypeDiamond],width:190,needAdd:!0});var a=this;for(var t in o)e(t)}},i);function i(){var e=t.call(this)||this;return e.proxy=r.AppFacade.getInstance().retrieveProxy(r.CopyEntrancePy.N),e.firstIn=!0,e.effectNameMap={1:"richangfb_bg_jysk",2:"richangfb_bg_jbbz",3:"richangfb_bg_sjsx",4:"richangfb_bg_yxbl",5:"",6:"richangfb_bg_sqfz"},e.skinName="DailyCopyEntranceSkin",e}r.DailyCopyEntrance=e,__reflect(e.prototype,"game.DailyCopyEntrance")}(game=game||{}),function(h){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.daTanChuKuang.onCloseCB=function(){h.AppFacade.getInstance().hideSubView(h.CopyEntranceMediator.N,h.CopyEntranceMediator.SV.DAILY_COPY_LIST)},this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this,e=this.proxy.dailyFortressInfo[this.id].leftChallenge,i=h.Config.dailyFortress()[this.id].initTimes,o=h.Config.VIPConfig().dailyFortressTimes,n=this.proxy.dailyFortressInfo[this.id];h.AppFacade.getInstance().showSubView(h.CommonMediator.N,h.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.DailyFortress,curNum:e,maxNum:i,hasBuyNum:n.buyChallenge,maxBuyNum:o,buyCB:function(e){t.proxy.BuyDailyChallenge({fortressId:t.id,num:e})}})},this),this.list_item.useVirtualLayout=!1},i.prototype.initList=function(){this.list_item.itemRenderer=n,UIActionManager.hideScrollerBar(this.scroller)},i.prototype.updateView=function(e){var t=this;this.id=e&&e.id||this.id;var i=h.Config.dailyFortress()[this.id],o=this.proxy.dailyFortressInfo[this.id];this.daTanChuKuang.blb_title.text=i.name;var n=h.Config.dailyFortressStage(),a=[],r=JSON.parse(i.stages),s=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N).playerInfoVO.level,c=0;r.forEach(function(e,t){s>=n[e].levelLimit&&c++,a.push({config:n[e],info:o})}),this.list_item.dataProvider=new eui.ArrayCollection(a);var l=108*c+6*(c-1)-this.scroller.height;l<0&&(l=0),egret.setTimeout(function(){t.scroller.viewport.scrollV=l},this,100),this.blb_remaining_times.text=o.leftChallenge+"/"+i.initTimes},i);function i(){var e=t.call(this)||this;return e.proxy=h.AppFacade.getInstance().retrieveProxy(h.CopyEntrancePy.N),e.playerProxy=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N),e.skinName="DailyCopyListSkin",e}h.DailyCopyListPanel=e,__reflect(e.prototype,"game.DailyCopyListPanel");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.btn_enter.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<this.data.info.leftChallenge?this.EntrPy.ChallengeDailyFortress({id:this.data.config.id}):Utils.MsgUtils.addMidMsg("次数不足")},this)},a.prototype.dataChanged=function(){var i=this;this.img_icon.source=DAILY_COPY_DIFFICULT_ICON[Number(this.data.config.name)];var e=JSON.parse(this.data.config.rewards);function t(){o<i.data.config.levelLimit?(i.gp_fightCap.visible=!1,i.lb_lock.visible=!0,i.lb_lock.text=i.data.config.levelLimit+"级开启",i.btn_enter.enabled=!1,UIActionManager.setAbsGrey(i.btn_enter)):(i.gp_fightCap.visible=!0,i.lb_lock.visible=!1,i.blb_fightCap.text=i.data.config.fightCap.toString(),i.btn_enter.enabled=!0,UIActionManager.setAbsGrey(i.btn_enter,!1))}this.gp_rewards.removeChildren(),e.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({reward:e}),t.scaleX=t.scaleY=.65,i.gp_rewards.addChild(t)});var o=this.playerPy.playerInfoVO.level,n=(h.GameMVC.zoneBossProxy,h.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.DailyFortress,{id:this.data.config.id}));n.isBelonged?n.unlock?t():(this.gp_fightCap.visible=!1,this.lb_lock.visible=!0,this.lb_lock.text="封印之地解锁",this.btn_enter.enabled=!1,UIActionManager.setAbsGrey(this.btn_enter)):t()},a);function a(){var e=o.call(this)||this;return e.playerPy=h.AppFacade.getInstance().retrieveProxy(h.PlayerPy.N),e.EntrPy=h.AppFacade.getInstance().retrieveProxy(h.CopyEntrancePy.N),e.skinName="DailyCopyListPanel_ItemList",e}__reflect(n.prototype,"DailyCopyListPanel_ItemList")}(game=game||{}),function(h){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initProgressBar(),this.initRewardPreviewGroup(),this.xiaotanchuang.blb_title.text="奖励"},i.prototype.initProgressBar=function(){this.progressBar.maximum=this.progressBar.width-24,this.progressBar.minimum=0;for(var e=1;e<6;e++)this.progressBar["lb_"+e].text=(3*e).toString()},i.prototype.initRewardPreviewGroup=function(){var e=new egret.Sprite;e.graphics.beginFill(0,0),e.graphics.drawRect(0,0,this.gp_root.width,this.gp_root.height),e.graphics.endFill(),this.gp_preview.addChildAt(e,0),e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_preview.visible=!1},this)},i.prototype.updateView=function(){function e(e){var t=c[e],i=-1!=s.indexOf(t.id),o=!i&&t.id<=r;if(l.gp_items.getChildByName(e)){var n=l.gp_items.getChildByName(e);n.updateReceived(i),n.updateAvailable(o)}else{var a=new p({config:t,received:i,available:o});a.name=e,a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.rewardItemTap(a,t)},l),l.gp_items.addChild(a)}}var r=this.proxy.expeditionInfo.sectionId,s=this.proxy.expeditionInfo.targeted,c=h.Config.expeditionAchievement(),l=this;for(var t in c)e(t);this.setProgressBarValue(r),this.allRewardsOpen()},i.prototype.allRewardsOpen=function(){var l=this;this.once(egret.Event.ENTER_FRAME,function(){egret.setTimeout(function(){var e=h.Config.expeditionAchievement(),t=l.proxy.expeditionInfo.targeted,i=l.proxy.expeditionInfo.sectionId,o=[];for(var n in e){var a=e[n],r=!(-1!=t.indexOf(a.id))&&a.id<=i,s=JSON.parse(e[n].rewards);if(r){for(var c=0;c<s.length;++c)o[c]?o[c][2]+=s[c][2]:o.push(s[c]);l.proxy.GetExpeditionRewards(a.id,!0)}}0<o.length&&egret.setTimeout(function(){h.AppFacade.getInstance().showSubView(h.CommonMediator.N,h.CommonMediator.SV.REWARD_PANEL,{rewards:o,type:h.CommonRewardPreviewPanel.REWARD_TYPE.REWARD})},l,600)},l,500)},this)},i.prototype.rewardItemTap=function(e,t){e.available?this.proxy.GetExpeditionRewards(t.id):h.AppFacade.getInstance().showSubView(h.CommonMediator.N,h.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(e.data.config.rewards),type:h.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},i.prototype.setProgressBarValue=function(e){var t=(this.progressBar.lb_pro.text=e)-this.progressBar.value;if(0<e){var i=this.progressBar.maximum*this.progressBar.scaleX*e/15+20-e/15*4;this.progressBar.value=this.progressBar.maximum*this.progressBar.scaleX*e/15+10-e/15*4,egret.Tween.get(this.progressBar.gp_section).to({x:i},this.progressBar.slideDuration*Math.abs(t)/this.progressBar.maximum)}},i.prototype.updateRewardPreviewGroup=function(e){var i=this,t=JSON.parse(e.rewards);this.gp_preview_rewards.removeChildren(),t.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({code:e[1],num:e[2]}),i.gp_preview_rewards.addChild(t)})},i);function i(){var e=t.call(this)||this;return e.proxy=h.AppFacade.getInstance().retrieveProxy(h.CopyEntrancePy.N),e.skinName="ExpeditionAchievementRewardSkin",e}h.ExpeditionAchievementRewardPanel=e,__reflect(e.prototype,"game.ExpeditionAchievementRewardPanel");var o,p=(o=eui.Component,__extends(n,o),n.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.data&&this.updateItem(this.data)},n.prototype.updateItem=function(e){this.data=e,this.updateReceived(this.data.received),this.updateAvailable(this.data.available)},n.prototype.updateReceived=function(e){this.received=e},n.prototype.updateAvailable=function(e){var t,i=this;this.available=e;var o=this.data.config.id/3;if(this.received||this.available?this.received&&!this.available&&(t="jiangli_icon_baoxiang0"+o+"_02_png"):t="jiangli_icon_baoxiang0"+o+"_01_png",t&&RES.getResAsync(t,function(e){i.img_bg.source=e,i.img_bg.visible=!0},this),this.available&&!this.received){this.img_bg.visible=!1;var n="common_baoxiang_"+o;this.box_effect||DragonBoneTools.create(n,function(e){var t=this;this.box_effect=e,this.box_effect.x=this.gp_effect.width/2-5,this.box_effect.y=65,this.box_effect.scaleX=this.box_effect.scaleY=.85,this.box_effect.animation.play(),this.gp_effect.addChild(this.box_effect),egret.setTimeout(function(){t.gp_effect.removeChildren()},this,500)},this)}else!this.available&&this.received&&!this.box_effect_kai&&this.box_effect&&DragonBoneTools.playOnce({effectName:"common_baoxiangkai",parent:this,x:this.gp_root.width/2-5,y:this.img_bg.height-25,scaleX:.85,scaleY:.85})},n);function n(e){var t=o.call(this)||this;return t.data=e,t.skinName="AchievementRewardPanel_RewardItem",t}__reflect(p.prototype,"AchievementRewardPanel_RewardItem")}(game=game||{}),function(g){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.reward_items=new Array,this.inButton()},i.prototype.inButton=function(){var e=this;this.challge_bnt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide(),e.EntrancePy.ChallengeExpedtion()},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){g.AppFacade.getInstance().showSubView(g.HeroMediator.N,g.HeroMediator.SV.FORMATION)},this);var t=new eui.HorizontalLayout;t.horizontalAlign=egret.HorizontalAlign.CENTER,this.gp_enermy.layout=t},i.prototype.updateView=function(e){var i=this;this.num=e.id;var t=this.EntrancePy.expeditionInfo,o=t.opponentInfo;e.cu||(o=t=this.EntrancePy.getrewardInfo(e.id)),this.currentState=e.cu?"can":"no";var n=this.EntrancePy.makePlayerInfo(o.baseInfo.name,o.baseInfo.level,o.baseInfo.vlevel,o.baseInfo.fightCap);this.headName.text=o.baseInfo.name,this.severId.text="S"+(o.baseInfo.serverId||0),this.cu_playerHead.updateData({vo:n}),this.cfc_fightcap.update(o.baseInfo.fightCap),this.colorFlilter=new egret.ColorMatrixFilter(this.EntrancePy.ColorMatrix()),this.gp_enermy.filters=e.cu?[]:[this.colorFlilter];for(var a=g.Config.expedition()[e.id],r=0,s=this.reward_items;r<s.length;r++){var c=s[r];c&&c.parent&&c.parent.removeChild(c)}for(var l=0,h=0,p=JSON.parse(a.rewards);h<p.length;h++){var d=p[h],u=customui.BaseItemFactory.create(21);u.updateData({type:d[0],code:d[1],num:d[2]}),u.y=0,u.x=0+l++*(u.width+30)*.7,u.scaleX=.7,u.scaleY=.7,this.reward_items.push(u),this.gp_reward_show.addChild(u)}o.heroList.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e.code,level:e.level}),t.scaleX=t.scaleY=.7,i.gp_enermy.addChild(t)})},i);function i(){var e=t.call(this)||this;return e.EntrancePy=g.AppFacade.getInstance().retrieveProxy(g.CopyEntrancePy.N),e.skinName="HearExpeditionChallengeSkin",e.proxy=g.AppFacade.getInstance().retrieveProxy(g.ArenaPy.N),e}g.ExpeditionehCallengeView=e,__reflect(e.prototype,"game.ExpeditionehCallengeView")}(game=game||{}),function(a){var t,e=(__extends(i,t=BaseFull),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent(),this.addSceneEffect(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btn),NoticeManager.addNoticeListener(NT.EXPEDITION_REWARD,this.btn_reward.$children[0],this,BTN_ICON_NOTICE_POS)},i.prototype.addSceneEffect=function(){function e(t){var i=o[t];DragonBoneTools.create(t,function(e){e.x=i.x,e.y=i.y,e.animation.play(),this.gp_effs.addChild(e),"yuanzheng_bg_chengbao"==t&&(this.tip_14_eff=e,this.tip_14_eff.visible=15!=this.proxy.expeditionInfo.sectionId)},n)}this.gp_effs.removeChildren();var o={yuanzheng_bg_chengbao:{x:335,y:244},yuanzheng_bg_ditu_1:{x:338,y:525},yuanzheng_bg_ditu_2:{x:151,y:1e3}},n=this;for(var t in o)e(t)},i.prototype.isPass=function(e){var t=this.proxy.expeditionInfo.sectionId;e==t?a.AppFacade.getInstance().showSubView(a.CopyEntranceMediator.N,a.CopyEntranceMediator.SV.EXPEDITION_CHALLENGE,{id:e+1,cu:!0}):(t<e&&Utils.MsgUtils.addMidMsg("未开启"),e<t&&a.AppFacade.getInstance().showSubView(a.CopyEntranceMediator.N,a.CopyEntranceMediator.SV.EXPEDITION_CHALLENGE,{id:e+1,cu:!1}))},i.prototype.updateView=function(){if(this.init){this.curSectionId=this.proxy.expeditionInfo.sectionId,this.init=!1,this.showCurPosBtn();for(var e=0;e<this.LEVEL_NUM;e++){if(this.curSectionId<e)for(var t=0;t<this.AinImg.length;t++)this[this.AinImg[t]+e].visible=!1;if(this.curSectionId>e)if(14==e){var i=this["tip_"+e];15==this.curSectionId?(this.tip_14_eff&&(this.tip_14_eff.visible=!1),i.source="yuanzheng_bg_chengbao1_png",i.visible=!0,i.touchEnabled=!1,this.img_tip_14.visible=!1):UIActionManager.setAbsGrey(i,!0)}else this["img_tip_"+e].alpha=1,this["img_tip_"+e].touchEnabled=!1,this["img_tip_"+e].visible=!0,this["img_tip_cur_"+e].visible=!1}}else this.stepping||this.startStepping();var o=Utils.UnlockMgr.checkPass(MODULE.ExpeditionSaoDang,!1).allow;if(this.isLock=o){var n=15==this.proxy.expeditionInfo.sectionId;this.btn_mopUp.enabled=!n,UIActionManager.setGrey(this.btn_mopUp,n)}else UIActionManager.setGrey(this.btn_mopUp,!0)},i.prototype.showCurPosBtn=function(){for(var e=a.AppFacade.getInstance().retrieveProxy(a.PlayerPy.N),t=JSON.parse(a.Config.constConfig().DefaultAvatar.constValue)[0],i=e.playerInfoVO.avatar||t,o=0;o<this.LEVEL_NUM;o++)this["img_tip_cur_"+o]&&(this["img_tip_cur_"+o].visible=!1,o<this.curSectionId&&(this["img_tip_"+o].visible=!0));if(15!=this.curSectionId){var n=this["img_tip_cur_"+this.curSectionId];n.visible=!0,this["img_tip_"+this.curSectionId].visible=!1,this.curSectionId<14&&(n.iconDisplay.source=ResourceUtils.png(i),UIActionManager.jumping(n.gp_head))}},i.prototype.startStepping=function(){var e=this;if(this.stepping=!0,this.curSectionId<this.proxy.expeditionInfo.sectionId){this.curSectionId+=1,this.showCurPosBtn();var t=this["img_tip_cur_"+this.curSectionId];if(t&&(t.alpha=0),15!=this.curSectionId){for(var i=0;i<this.AinImg.length-1;i++)this[this.AinImg[i]+this.curSectionId].visible=!0,this[this.AinImg[i]+this.curSectionId].alpha=0;egret.Tween.get(this["x_"+this.curSectionId]).wait(0).to({alpha:1},500,egret.Ease.backOut),egret.Tween.get(this["y_"+this.curSectionId]).wait(500).to({alpha:1},500,egret.Ease.backOut),egret.Tween.get(this["z_"+this.curSectionId]).wait(1e3).to({alpha:1},500,egret.Ease.backOut),egret.Tween.get(t).wait(1e3).to({alpha:1},500,egret.Ease.backOut).call(function(){e.curSectionId<e.proxy.expeditionInfo.sectionId?e.startStepping():egret.Tween.get(t).to({alpha:1},500,egret.Ease.backOut).call(function(){e.startStepping()})})}else 15==this.curSectionId&&(this.img_tip_14.touchEnabled=!1,this.img_tip_14.visible=!1,this.tip_14_eff&&(this.tip_14_eff.visible=!1),this.tip_14.visible=!0)}else this.stepping=!1},i.prototype.activateComponent=function(){var t=this;function e(e){i["img_tip_cur_"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.isPass(e)},i)}this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().showSubView(a.CopyEntranceMediator.N,a.CopyEntranceMediator.SV.ACHIEVE_REWARD)},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeExpedition})},this);for(var i=this,o=0;o<this.LEVEL_NUM;o++)e(o);this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.MainJumpConfig.jumpTo()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new a.HelpDialog({moduleId:MODULE.Expedition})})},this),Utils.TouchUtils.addTouchListener(this.btn_mopUp,function(){Utils.UnlockMgr.checkPass(MODULE.ExpeditionSaoDang,!0).allow&&(15!=t.proxy.expeditionInfo.sectionId?a.AppFacade.getInstance().showSubView(a.CommonMediator.N,a.CommonMediator.SV.MOP_UP,{pb1:"expedition",pb2:"MopUpExpedition",cb:function(e){return Utils.LocalStorageUtil.setTodayVaild("expedtionNotice"),NoticeManager.updateNotice(NT.EXPEDITION_CHALLENGE),t.proxy.updateExpeditionInfo(e.info),a.AppFacade.getInstance().updateView(a.CopyEntranceMediator.N,a.CopyEntranceMediator.SV.EXPEDITION),15!=t.proxy.expeditionInfo.sectionId},tipsFunc:function(e){return"第"+(t.proxy.expeditionInfo.sectionId+1)+"关"}}):Utils.MsgUtils.addMidMsg("已通关"))})},i);function i(){var e=t.call(this)||this;return e.init=!0,e.stepping=!1,e.curSectionId=0,e.isLock=!1,e.LEVEL_NUM=15,e.AinImg=["x_","y_","z_","img_tip_"],e.skinName="HearExpeditionSkin",e.proxy=a.AppFacade.getInstance().retrieveProxy(a.CopyEntrancePy.N),e}a.ExpeditionView=e,__reflect(e.prototype,"game.ExpeditionView")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.DeepNestMainView),this.addSubView(n.SV.CHALLENGE,i.DeepNestChallengePanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.DEEP_NEST_UPDATEMAIN,CN.DEEP_NEST_UPDATEHERO,CN.DEEP_NEST_UPDATEPETANDART,CN.DEEP_NEST_UPDATEREWARD,CN.DEEP_NEST_UPDATECOUNT,CN.DEEP_NEST_SETPOSBYWAIGUA,CN.BACKPACK_MULTI_TEAM_UPDATE]},n.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.AbyssLair,!1).allow&&(this.proxy.isFirst=!0,this.proxy.GetAbyssLairInfo());break;case CN.DEEP_NEST_UPDATEMAIN:var i=this.getSubView(n.SV.MAIN);i&&i.updateView(t);break;case CN.BACKPACK_MULTI_TEAM_UPDATE:(o=this.getSubView(n.SV.MAIN))&&(o.updateNowPetAndArt(),o.updateNowHeroList());case CN.DEEP_NEST_UPDATEPETANDART:break;case CN.DEEP_NEST_UPDATEREWARD:(o=this.getSubView(n.SV.MAIN))&&o.updateNowReward();break;case CN.DEEP_NEST_UPDATECOUNT:(o=this.getSubView(n.SV.MAIN))&&o.updateChalCount();break;case CN.DEEP_NEST_SETPOSBYWAIGUA:var o;(o=this.getSubView(n.SV.MAIN))&&o.setLevelPosByWaigua(t)}},n.N="DeepNestMediator",n.SV={MAIN:1,CHALLENGE:2},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.DeepNestPy.N),t}i.DeepNestMediator=e,__reflect(e.prototype,"game.DeepNestMediator")}(game=game||{}),function(e){var t=(i.registerAll=function(){},i);function i(){}e.DeepNestProcessor=t,__reflect(t.prototype,"game.DeepNestProcessor")}(game=game||{}),function(c){var i,t=(i=c.BaseVO,__extends(e,i),e.prototype.updateInfo=function(e){this.chapterInfos=e},e);function e(e){var t=i.call(this)||this;return e&&t.updateInfo(e),t}__reflect(t.prototype,"DeepNestInfoVO");var o,n=(o=c.BaseVO,__extends(a,o),a.prototype.updateInfo=function(e){this.chalCount=e},a);function a(e){var t=o.call(this)||this;return t.chalCount=0,e&&t.updateInfo(e),t}__reflect(n.prototype,"DeepNestCountVO");var r,s=(r=c.BaseVO,__extends(l,r),l.prototype.updateInfo=function(e){e&&(this.heroList=e)},l);function l(e){var t=r.call(this)||this;return t.heroList=[],e&&t.updateInfo(e),t}__reflect(s.prototype,"HeroListInfoVO");var h,p=(h=c.BaseVO,__extends(d,h),d.prototype.updateInfo=function(e){e&&(this.petList=e)},d);function d(e){var t=h.call(this)||this;return t.petList=[],e&&t.updateInfo(e),t}__reflect(p.prototype,"PetListInfoVO");var u,g=(u=c.BaseVO,__extends(f,u),f.prototype.updateInfo=function(e){e&&(this.artList=e)},f);function f(e){var t=u.call(this)||this;return t.artList=[],e&&t.updateInfo(e),t}__reflect(g.prototype,"ArtListInfoVO");var _,m=(__extends(y,_=BaseProxy),y.prototype.initNotice=function(){NoticeManager.registerCB(NT.DEEP_NEST,this.checkCountNotice,this),NoticeManager.registerCB(NT.DEEP_NEST_REWARD,this.checkRewardNotice,this)},y.prototype.checkCountNotice=function(){if(Utils.UnlockMgr.checkPass(MODULE.AbyssLair,!1).allow){if(this.deepNestCountVO){if(0<this.deepNestCountVO.chalCount)return!0;var e=this.checkRewardNotice();for(var t in e)if(e[t])return!0;return!1}return!0}return!1},y.prototype.checkRewardNotice=function(){for(var e=[],t=0;t<this.deepNestInfoVO.chapterInfos.length;t++){e.push(!1);for(var i=this.deepNestInfoVO.chapterInfos[t].fetched,o=this.deepNestInfoVO.chapterInfos[t].stars,n=[!1,!1,!1],a=c.Config.deepNestRewardConfig(t+1),r=0;r<a.length;r++)if(5*(r+1)<=o)for(var s in n[r]=!1,i)i[s]==a[r].code&&(n[r]=!0);else n[r]=!0;for(var s in n)n[s]||(e[t]=!0)}return e},y.prototype.updateHeroList=function(e){this.heroListInfoVO?this.heroListInfoVO.updateInfo(e):this.heroListInfoVO=new s(e)},y.prototype.updatePetList=function(e){this.petListInfoVO?this.petListInfoVO.updateInfo(e):this.petListInfoVO=new p(e)},y.prototype.updateArtList=function(e){this.artListInfoVO?this.artListInfoVO.updateInfo(e):this.artListInfoVO=new g(e)},y.prototype.updateChapterInfo=function(e){this.deepNestInfoVO?this.deepNestInfoVO.updateInfo(e):this.deepNestInfoVO=new t(e)},y.prototype.updateCountInfo=function(e){this.deepNestCountVO?this.deepNestCountVO.updateInfo(e):this.deepNestCountVO=new n(e),NoticeManager.updateNotice(NT.DEEP_NEST)},y.prototype.GetAbyssLairInfo=function(t){var i=this;Utils.Socket.send("abyssLair","GetAbyssLairInfo",{}).then(function(e){i.updateChapterInfo(e.chapterInfos),i.updateCountInfo(e.chalCount),i.updateHeroList(e.heroTeams),i.updatePetList(e.pets),i.updateArtList(e.magicals),i.buyCount=e.buyCount,i.isFirst&&t&&(t&&t(e),i.isFirst=!1)})},y.prototype.HeroChangeFormation=function(e,t){var i=this;Utils.Socket.send("abyssLair","HeroChangeFormation",{heroTeams:e}).then(function(e){i.updateHeroList(e.heroTeams),c.AppFacade.getInstance().sendNotification(CN.DEEP_NEST_UPDATEHERO),t&&t()})},y.prototype.ChangePets=function(e,t){var i=this;Utils.Socket.send("abyssLair","ChangePets",{pets:e}).then(function(e){i.updatePetList(e.pets),c.AppFacade.getInstance().sendNotification(CN.DEEP_NEST_UPDATEPETANDART),t&&t()})},y.prototype.ChangeMagicals=function(e,t){var i=this;Utils.Socket.send("abyssLair","ChangeMagicals",{magicals:e}).then(function(e){i.updateArtList(e.magicals),c.AppFacade.getInstance().sendNotification(CN.DEEP_NEST_UPDATEPETANDART),t&&t()})},y.prototype.Challenge=function(n,a,e){var r=this;this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeAbyssLair,pb1:"abyssLair",pb2:"Challenge",params:{code:n},ignoreStringWay:!0,doneCB:function(e){console.log("战斗结束",e);var t=!1,i=void 0,o=void 0;(t=e.cbRet.chapterInfos.length!=r.deepNestInfoVO.chapterInfos.length&&!!e.cbRet.chapterInfos[e.cbRet.chapterInfos.length-1].isOpen)?(GameRootLayer.gameLayer().switchCloudLoading(!0),i=1+Math.floor(n/5),0!=(o=n-5*Math.floor(n/5))&&(o-=1)):(i=1+Math.floor((n-1)/5),o=1+(n-1)%5),r.updateChapterInfo(e.cbRet.chapterInfos),r.updateCountInfo(e.cbRet.chalCount),r.isFirst||(a?t?r.deepNestInfoVO.chapterInfos[r.deepNestInfoVO.chapterInfos.length-1].isOpen?c.AppFacade.getInstance().showSubView(c.DeepNestMediator.N,c.DeepNestMediator.SV.MAIN,{chalCount:r.deepNestCountVO.chalCount,chapterInfos:r.deepNestInfoVO.chapterInfos,isOpen:t}):c.AppFacade.getInstance().showSubView(c.DeepNestMediator.N,c.DeepNestMediator.SV.MAIN,{chalCount:r.deepNestCountVO.chalCount,chapterInfos:r.deepNestInfoVO.chapterInfos,isOpen:t,nowIndex:i,nowLevel:o}):c.AppFacade.getInstance().showSubView(c.DeepNestMediator.N,c.DeepNestMediator.SV.MAIN,{chalCount:r.deepNestCountVO.chalCount,chapterInfos:r.deepNestInfoVO.chapterInfos,isOpen:t}):c.AppFacade.getInstance().showSubView(c.DeepNestMediator.N,c.DeepNestMediator.SV.MAIN,{chalCount:r.deepNestCountVO.chalCount,chapterInfos:r.deepNestInfoVO.chapterInfos,isOpen:t,nowIndex:i,nowLevel:o})),c.AppFacade.getInstance().retrieveProxy(c.FightPy.N).queueExceExitCB()}})},y.prototype.BuyAbyssLairChal=function(t,i){var o=this;Utils.Socket.send("abyssLair","BuyAbyssLairChal",{num:t}).then(function(e){Utils.MsgUtils.addMidMsg("成功购买"+t+"次"),o.updateCountInfo(e.chalCount),o.buyCount=e.buyCount,c.AppFacade.getInstance().sendNotification(CN.DEEP_NEST_UPDATECOUNT),i&&i()})},y.prototype.GetBoxReward=function(e,t){var i=this;Utils.Socket.send("abyssLair","GetBoxReward",{boxCode:e}).then(function(e){i.updateChapterInfo(e.chapterInfos),NoticeManager.updateNotice(NT.DEEP_NEST),c.AppFacade.getInstance().sendNotification(CN.DEEP_NEST_UPDATEREWARD),e.clientReward&&c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).handleClientReward(e.clientReward,2),t&&t()})},y.N="DeepNestPy",y);function y(){var e=_.call(this,y.N)||this;return e.isFirst=!0,e.initNotice(),e.isFirst=!0,e}c.DeepNestPy=m,__reflect(m.prototype,"game.DeepNestPy")}(game=game||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.challge_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.isCanFight()?e.proxy.Challenge(e.params.code,e.isNew):(Utils.MsgUtils.addMidMsg("请先上阵英雄"),t.AppFacade.getInstance().showSubView(t.CommonMediator.N,t.CommonMediator.SV.TEAM_CHOOSE,{module:MODULE.AbyssLair,touchHoldCB:void 0,doneCB:void 0,clickDarkClose:!1})),e.mediator.hideSubView(e)},this),this.commonDaTanKuang.onCloseCB=function(){e.hide()}},o.prototype.isCanFight=function(){var e=this.backProxy.getModuleTeam(MODULE.AbyssLair),t=0;if(e&&e.teams&&0!=e.teams.length){for(var i in e.teams)0==e.teams[i].heros.length&&t++;return 3!=t}return!1},o.prototype.updateView=function(e){var i=this;if(e&&e.info&&e.nowChoose){this.params=e.info,this.commonDaTanKuang.blb_title.text=this.params.name,this.cfc_fightcap.update(this.params.fightCap);var t=JSON.parse(this.params.rewards);for(var o in t){var n=customui.BaseItemFactory.create();n.scaleX=n.scaleY=.7,n.updateData({id:t[o][1],num:t[o][2]}),this.gp_reward_show.addChild(n)}var a=e.nowChoose.stages;for(var o in this.isNew=!0,a)if(e.info.code==a[o].code){this.isNew=!1;break}this.img_get.visible=!this.isNew;var r=[],s=[],c=[];try{for(var l=1;l<=6;l++){var h=this.params["creep1"+l];h&&""!=h&&r.push(JSON.parse(this.params["creep1"+l])[0]);var p=this.params["creep2"+l];p&&""!=p&&s.push(JSON.parse(this.params["creep2"+l])[0]);var d=this.params["creep3"+l];d&&""!=d&&c.push(JSON.parse(this.params["creep3"+l])[0])}}catch(e){this.log(e)}r.forEach(function(e){if(null!=e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e}),t.scaleX=t.scaleY=.6,t.touchEnabled=!1,i.gp_list_0.addChild(t)}}),s.forEach(function(e){if(null!=e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e}),t.scaleX=t.scaleY=.6,t.touchEnabled=!1,i.gp_list_1.addChild(t)}}),c.forEach(function(e){if(null!=e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e}),t.scaleX=t.scaleY=.6,t.touchEnabled=!1,i.gp_list_2.addChild(t)}})}},o);function o(){var e=i.call(this)||this;return e.proxy=t.AppFacade.getInstance().retrieveProxy(t.DeepNestPy.N),e.backProxy=t.AppFacade.getInstance().retrieveProxy(t.BackpackPy.N),e.skinName="DeepNestChallengePanelSkin",e}t.DeepNestChallengePanel=e,__reflect(e.prototype,"game.DeepNestChallengePanel")}(game=game||{}),function(d){var i,e=(__extends(t,i=BaseFull),t.prototype.onDestroy=function(){i.prototype.onDestroy.call(this)},t.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_title),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_start),this.heroModel=new customui.RoleDynamicModel({reqStyle:ROLE_STYLE.Fashion}),this.heroModel.x=50,this.heroModel.y=60,this.gp_player.addChild(this.heroModel),this.initBtnListener(),this.heroList1=[],this.heroList2=[],this.heroList3=[],this.petList1=[],this.petList2=[],this.petList3=[];for(var e=0;e<6;e++)(t=new s).updateItem({uuid:void 0,type:EEntityType.EEntityTypeHero}),t.scaleX=.6,t.scaleY=.6,this.gp_heroList_0.addChild(t),this.heroList1.push(t);for(e=0;e<6;e++)(t=new s).updateItem({uuid:void 0,type:EEntityType.EEntityTypeHero}),t.scaleX=.6,t.scaleY=.6,this.gp_heroList_1.addChild(t),this.heroList2.push(t);for(e=0;e<6;e++)(t=new s).updateItem({uuid:void 0,type:EEntityType.EEntityTypeHero}),t.scaleX=.6,t.scaleY=.6,this.gp_heroList_2.addChild(t),this.heroList3.push(t);for(e=0;e<2;e++)(t=new s).updateItem({uuid:void 0,type:0==e?EEntityType.EEntityTypePet:EEntityType.EEntityTypeMagical}),t.scaleX=.3,t.scaleY=.3,this.gp_petList_0.addChild(t),this.petList1.push(t);for(e=0;e<2;e++)(t=new s).updateItem({uuid:void 0,type:0==e?EEntityType.EEntityTypePet:EEntityType.EEntityTypeMagical}),t.scaleX=.3,t.scaleY=.3,this.gp_petList_1.addChild(t),this.petList2.push(t);for(e=0;e<2;e++){var t;(t=new s).updateItem({uuid:void 0,type:0==e?EEntityType.EEntityTypePet:EEntityType.EEntityTypeMagical}),t.scaleX=.3,t.scaleY=.3,this.gp_petList_2.addChild(t),this.petList3.push(t)}},t.prototype.chooseNewList=function(e){return e},t.prototype.initBtnListener=function(){var n=this;this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.dpProxy.isFirst=!0,d.MainJumpConfig.jumpTo()},this),this.gp_heroList.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.AppFacade.getInstance().showSubView(d.CommonMediator.N,d.CommonMediator.SV.TEAM_CHOOSE,{module:MODULE.AbyssLair,touchHoldCB:this.chooseNewList.bind(this),doneCB:void 0,clickDarkClose:!1})},this),this.btn_choose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.AppFacade.getInstance().showSubView(d.CommonMediator.N,d.CommonMediator.SV.TEAM_CHOOSE,{module:MODULE.AbyssLair,touchHoldCB:this.chooseNewList.bind(this),doneCB:void 0,clickDarkClose:!1})},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.buyCount()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new d.HelpDialog({moduleId:MODULE.AbyssLair})})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){d.AppFacade.getInstance().showSubView(d.RankMediator.N,d.RankMediator.SV.COMMON,{module:"DeepNest"})},this),this.btn_right.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=n.curSelectIndex+1,i=n.dpProxy.deepNestInfoVO.chapterInfos[t];if(i.isOpen)n.curSelectIndex++,n.updateNovicePos(n.curSelectIndex);else{var o="总星数达到"+d.Config.deepNestWayConfig(i.chapter).unlock+"后解锁该章节";Utils.MsgUtils.addMidMsg(o)}},this),this.btn_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){n.curSelectIndex--,n.updateNovicePos(n.curSelectIndex)},this),this.gp_choose1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){n.showChallengePanel(0)},this),this.gp_choose2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){n.showChallengePanel(1)},this),this.gp_choose3.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){n.showChallengePanel(2)},this),this.gp_choose4.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){n.showChallengePanel(3)},this),this.gp_choose5.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){n.showChallengePanel(4)},this),this.gp_0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=d.Config.deepNestRewardConfig(n.curSelectIndex+1),i=n.judgeIsGet(n.curSelectIndex);5<=n.nowStarNum&&!i[0]?DragonBoneTools.playOnce({effectName:"common_baoxiangkai",parent:n.gp_effect_0,x:n.gp_effect_0.width/2-5,y:50,scaleX:.85,scaleY:.85,doneCB:function(){n.dpProxy.GetBoxReward(t[0].code)}}):d.AppFacade.getInstance().showSubView(d.CommonMediator.N,d.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(t[0].rewards),type:d.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this),this.gp_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=d.Config.deepNestRewardConfig(n.curSelectIndex+1),i=n.judgeIsGet(n.curSelectIndex);10<=n.nowStarNum&&!i[1]?DragonBoneTools.playOnce({effectName:"common_baoxiangkai",parent:n.gp_effect_1,x:n.gp_effect_1.width/2-5,y:50,scaleX:.85,scaleY:.85,doneCB:function(){n.dpProxy.GetBoxReward(t[1].code)}}):d.AppFacade.getInstance().showSubView(d.CommonMediator.N,d.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(t[1].rewards),type:d.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this),this.gp_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=d.Config.deepNestRewardConfig(n.curSelectIndex+1),i=n.judgeIsGet(n.curSelectIndex);15<=n.nowStarNum&&!i[2]?DragonBoneTools.playOnce({effectName:"common_baoxiangkai",parent:n.gp_effect_2,x:n.gp_effect_2.width/2-5,y:50,scaleX:.85,scaleY:.85,doneCB:function(){n.dpProxy.GetBoxReward(t[2].code)}}):d.AppFacade.getInstance().showSubView(d.CommonMediator.N,d.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(t[2].rewards),type:d.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this)},t.prototype.buyCount=function(){var t=this,e=JSON.parse(d.Config.publicBuyCostConfig(MODULE.AbyssLair).costs);d.GameMVC.backpackPy.checkEnough(e,!1)?d.AppFacade.getInstance().showSubView(d.CommonMediator.N,d.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.AbyssLair,hasBuyNum:this.dpProxy.buyCount,buyCB:function(e){t.dpProxy.BuyAbyssLairChal(e)},curNum:this.dpProxy.deepNestCountVO.chalCount,maxNum:20}):Utils.MsgUtils.addMidMsg("您的货币不足")},t.prototype.updateAllStartNum=function(){var e=0;for(var t in this.dpProxy.deepNestInfoVO.chapterInfos)e+=this.dpProxy.deepNestInfoVO.chapterInfos[t].stars;this.lbl_allStart.text=e+""},t.prototype.updateView=function(e,t){var i=this;e&&e.nowIndex?(this.curSelectIndex=e.nowIndex-1,this.updateChapter(!1)):this.updateChapter(!0),this.updateNowHeroList(),this.updateNowPetAndArt(),this.updateChalCount(),this.updateAllStartNum();var o=this.scroller_chapter.viewport.$children.length<=6;this.scroller_chapter.scrollPolicyH=o?eui.ScrollPolicy.OFF:eui.ScrollPolicy.AUTO,egret.setTimeout(function(){e&&e.nowLevel&&i.updatePlayerPos(e.nowLevel-1),i.updateListDataInfo(i.curSelectIndex),i.scroller_chapter.viewport.scrollH=150*i.curSelectIndex-60},this,200),egret.setTimeout(function(){e&&e.isOpen&&GameRootLayer.gameLayer().switchCloudLoading(!1)},this,500)},t.prototype.updateChalCount=function(){this.blb_count.text=this.dpProxy.deepNestCountVO.chalCount+""},t.prototype.updateChapter=function(e){if(this.maxIndex=this.dpProxy.deepNestInfoVO.chapterInfos.length,e){this.curSelectIndex=this.dpProxy.deepNestInfoVO.chapterInfos[this.dpProxy.deepNestInfoVO.chapterInfos.length-1].chapter-1;for(var t=0;t<this.dpProxy.deepNestInfoVO.chapterInfos.length;t++)if(!this.dpProxy.deepNestInfoVO.chapterInfos[t].isOpen){this.curSelectIndex=0<t-1?t-1:0;break}}var i=[];for(t=0;t<this.maxIndex;t++){var o={level:t+1,touchCB:this.updateNovicePos.bind(this),info:this.dpProxy.deepNestInfoVO.chapterInfos[t],title:"第"+this.toChinesNum(t+1)+"章",icon:d.Config.deepNestWayConfig(t+1).icon+"_png",scale:.7};i.push(o)}var n={level:0};i.unshift(n),i.unshift(n),i.push(n),i.push(n),this.dataprovider=new eui.ArrayCollection(i),this.list_chapter.itemRenderer=a,this.list_chapter.dataProvider=this.dataprovider,this.updateNovicePos(this.curSelectIndex)},t.prototype.updateNovicePos=function(e){e>this.maxIndex?e=this.maxIndex:e<0&&(e=0),this.curSelectIndex=e,this.btn_left.visible=0!=this.curSelectIndex,this.btn_right.visible=this.curSelectIndex!=this.maxIndex-1,this.lbl_text.text="第"+this.toChinesNum(this.curSelectIndex+1)+"章",this.updateListDataInfo(this.curSelectIndex),this.updateLineInfo(this.curSelectIndex),this.updateNowReward(),this.scroller_chapter.viewport.scrollH=150*this.curSelectIndex-60,this.nowChapterInfo=d.Config.deepNestConfig(this.curSelectIndex+1),this.nowBoxInfo=d.Config.deepNestRewardConfig(this.curSelectIndex+1)},t.prototype.updateListDataInfo=function(e){var t=e+2;for(var i in this.dataprovider.source){this.dataprovider.source[i].choose=Number(i)==t;var o=this.list_chapter.getVirtualElementAt(Number(i)),n=this.dataprovider.getItemAt(Number(i));o&&o.gp_root&&(o.gp_root.scaleX=Number(i)==t?.85:.7,o.gp_root.scaleY=Number(i)==t?.85:.7,n.scale=Number(i)==t?.85:.7)}},t.prototype.showChallengePanel=function(e){0<this.dpProxy.deepNestCountVO.chalCount?this.nowLevel>=e?(this.mediator.showSubView(d.DeepNestMediator.SV.CHALLENGE,{info:this.nowChapterInfo[e],nowChoose:this.dpProxy.deepNestInfoVO.chapterInfos[this.curSelectIndex]}),this.updatePlayerPos(e)):Utils.MsgUtils.addMidMsg("请先解锁前置关卡"):(Utils.MsgUtils.addMidMsg("挑战次数不足"),this.buyCount())},t.prototype.updateLineInfo=function(e){var t=d.Config.deepNestWayConfig(e+1),i=JSON.parse(t.points);this.img_map.source=t.img+"_png";var o=[this.gp_start_0,this.gp_start_1,this.gp_start_2,this.gp_start_3,this.gp_start_4],n=[this.gp_level_0,this.gp_level_1,this.gp_level_2,this.gp_level_3,this.gp_level_4],a=[this.gp_choose1,this.gp_choose2,this.gp_choose3,this.gp_choose4,this.gp_choose5],r=this.dpProxy.deepNestInfoVO.chapterInfos[e];this.nowStarNum=r.stars,this.lbl_startNum.text=this.nowStarNum+"/15",this.nowLevel=r.stages.length;for(var s=0;s<n.length;s++)n[s].x=i[s][0],n[s].y=i[s][1],n[s].visible=!1,a[s].x=i[s][0],a[s].y=i[s][1],a[s].visible=!1;for(var c in this.gp_start_0.$children)UIActionManager.setAbsGrey(this.gp_start_0.$children[c],!0),UIActionManager.setAbsGrey(this.gp_start_1.$children[c],!0),UIActionManager.setAbsGrey(this.gp_start_2.$children[c],!0),UIActionManager.setAbsGrey(this.gp_start_3.$children[c],!0),UIActionManager.setAbsGrey(this.gp_start_4.$children[c],!0);for(s=0;s<=r.stages.length;s++)s<5&&(n[s].visible=!0,a[s].visible=!0);for(var c in r.stages){var l=(r.stages[c].code-1)%5,h=r.stages[c].star;for(s=0;s<h;s++)UIActionManager.setAbsGrey(o[l].$children[s],!1)}var p=this.nowLevel;4<p&&(p=4),this.updatePlayerPos(p)},t.prototype.updatePlayerPos=function(e){var t=d.Config.deepNestWayConfig(this.curSelectIndex+1),i=JSON.parse(t.points);this.gp_player.x=i[e][0],this.gp_player.y=i[e][1]},t.prototype.updateNowHeroList=function(){for(var e=0;e<this.heroList1.length;e++)this.heroList1[e].updateItem({uuid:void 0,type:EEntityType.EEntityTypeHero}),this.heroList2[e].updateItem({uuid:void 0,type:EEntityType.EEntityTypeHero}),this.heroList3[e].updateItem({uuid:void 0,type:EEntityType.EEntityTypeHero});var t=this.backProxy.getModuleTeam(MODULE.AbyssLair);if(t&&t.teams){var i=t.teams;for(var o in i)for(var e in i[o].heros){var n=i[o].heros[e].battlePos-1,a=i[o].heros[e].uuid;1==i[o].teamNo?this.heroList1[n].updateItem({uuid:a,type:EEntityType.EEntityTypeHero}):2==i[o].teamNo?this.heroList2[n].updateItem({uuid:a,type:EEntityType.EEntityTypeHero}):3==i[o].teamNo&&this.heroList3[n].updateItem({uuid:a,type:EEntityType.EEntityTypeHero})}}},t.prototype.updateNowPetAndArt=function(){for(var e=0;e<this.petList1.length;e++)this.petList1[e].updateItem({uuid:void 0,type:0==e?EEntityType.EEntityTypePet:EEntityType.EEntityTypeMagical}),this.petList2[e].updateItem({uuid:void 0,type:0==e?EEntityType.EEntityTypePet:EEntityType.EEntityTypeMagical}),this.petList3[e].updateItem({uuid:void 0,type:0==e?EEntityType.EEntityTypePet:EEntityType.EEntityTypeMagical});var t=this.backProxy.getModuleTeam(MODULE.AbyssLair);if(t&&t.teams){var i=t.teams;for(var o in i){var n=i[o].petUuid,a=i[o].magicalUuid,r=i[o].teamNo;1==r?(n&&this.petList1[0].updateItem({uuid:n,type:EEntityType.EEntityTypePet}),a&&this.petList1[1].updateItem({uuid:a,type:EEntityType.EEntityTypeMagical})):2==r?(n&&this.petList2[0].updateItem({uuid:n,type:EEntityType.EEntityTypePet}),a&&this.petList2[1].updateItem({uuid:a,type:EEntityType.EEntityTypeMagical})):3==r&&(n&&this.petList3[0].updateItem({uuid:n,type:EEntityType.EEntityTypePet}),a&&this.petList3[1].updateItem({uuid:a,type:EEntityType.EEntityTypeMagical}))}}},t.prototype.updateNowReward=function(){var e=this;this.gp_effect_0.removeChildren(),this.gp_effect_1.removeChildren(),this.gp_effect_2.removeChildren(),this.img_di.width=Math.floor(320*this.nowStarNum/15);var t=this.judgeIsGet(this.curSelectIndex);this.img_reward_0.visible=!0,this.img_reward_0.source=5<=this.nowStarNum&&t[0]?"jiangli_icon_baoxiang03_02_png":"jiangli_icon_baoxiang03_01_png",this.img_get_0.visible=5<=this.nowStarNum&&!!t[0],this.img_reward_1.visible=!0,this.img_reward_1.source=10<=this.nowStarNum&&t[1]?"jiangli_icon_baoxiang04_02_png":"jiangli_icon_baoxiang04_01_png",this.img_get_1.visible=10<=this.nowStarNum&&!!t[1],this.img_reward_2.visible=!0,this.img_reward_2.source=10<=this.nowStarNum&&t[2]?"jiangli_icon_baoxiang05_02_png":"jiangli_icon_baoxiang05_01_png",this.img_get_2.visible=10<=this.nowStarNum&&!!t[2],!this.img_get_0.visible&&5<=this.nowStarNum&&!t[0]&&DragonBoneTools.create("common_baoxiang_3",function(e){this.gp_effect_0.removeChildren(),e.x=this.gp_effect_0.width/2-5,e.y=50,e.scaleX=e.scaleY=.85,e.animation.play(),this.gp_effect_0.visible=!0,this.gp_effect_0.addChild(e),this.img_reward_0.visible=!1},this),!this.img_get_1.visible&&10<=this.nowStarNum&&!t[1]&&DragonBoneTools.create("common_baoxiang_4",function(e){this.gp_effect_1.removeChildren(),e.x=this.gp_effect_1.width/2-5,e.y=50,e.scaleX=e.scaleY=.85,e.animation.play(),this.gp_effect_1.visible=!0,this.gp_effect_1.addChild(e),this.img_reward_1.visible=!1},this),!this.img_get_2.visible&&15<=this.nowStarNum&&!t[2]&&DragonBoneTools.create("common_baoxiang_5",function(e){this.gp_effect_2.removeChildren(),e.x=this.gp_effect_2.width/2-5,e.y=50,e.scaleX=e.scaleY=.85,e.animation.play(),this.gp_effect_2.visible=!0,this.gp_effect_2.addChild(e),this.img_reward_2.visible=!1},this),egret.setTimeout(function(){e.updateChaterRed()},this,100)},t.prototype.updateChaterRed=function(){var e=this.dpProxy.checkRewardNotice();for(var t in this.dataprovider.source){var i=this.list_chapter.getVirtualElementAt(Number(t)),o=this.dataprovider.getItemAt(Number(t));i&&i.img_red&&0!=o.level&&(i.img_red.visible=e[o.level-1])}},t.prototype.judgeIsGet=function(e){for(var t=d.Config.deepNestRewardConfig(e+1),i=[!1,!1,!1],o=this.dpProxy.deepNestInfoVO.chapterInfos[e].fetched,n=0;n<t.length;n++)for(var a in o)o[a]==t[n].code&&(i[n]=!0);return i},t.prototype.toChinesNum=function(e){for(var t=["零","一","二","三","四","五","六","七","八","九"],i=["","十","百","千"],o="",n="",a=0,r=!0,s=e;0<e;){var c=e%10;0==c?r||(r=!0,n=t[c]+n):(r=!1,o=t[c],n=(o+=i[a])+n),a++,e=Math.floor(e/10)}return 9<s&&s<20&&(n=n.replace("一","")),n},t.prototype.perClose=function(){},t.prototype.setLevelPosByWaigua=function(e){this.gp_touchPos2.visible=!0,this.gp_root.visible=!1,this.img_map1.source=["sycx_img_ditu1_png","sycx_img_ditu2_png","sycx_img_ditu3_png"][e.mapId],this.gp_touchPos.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.gp_touchPos.addEventListener(egret.TouchEvent.TOUCH_TAP,this.setPosByWaiGua,this)},t.prototype.setPosByWaiGua=function(e){var t=Number(this.text_num.text),i=[this.gp_pos_0,this.gp_pos_1,this.gp_pos_2,this.gp_pos_3,this.gp_pos_4];0<t&&t<6&&(i[t-1].x=e.stageX,i[t-1].y=e.stageY);for(var o=0;o<5;o++){0==o&&console.log("当前地图：",this.img_map1.source);var n=o+1;console.log("第"+n+"个坐标：",i[o].x,i[o].y)}},t);function t(){var e=i.call(this)||this;return e.backProxy=d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N),e.dpProxy=d.AppFacade.getInstance().retrieveProxy(d.DeepNestPy.N),e.playerProxy=d.AppFacade.getInstance().retrieveProxy(d.PlayerPy.N),e.heroProxy=d.AppFacade.getInstance().retrieveProxy(d.HeroPy.N),e.dataprovider=new eui.ArrayCollection,e.curSelectIndex=0,e.maxIndex=5,e.nowLevel=0,e.nowStarNum=0,e.heroList1=[],e.heroList2=[],e.heroList3=[],e.petList1=[],e.petList2=[],e.petList3=[],e.LEVEL_TITLE=["sycx_txt_diyizhang_png","sycx_txt_dierzhang_png","sycx_txt_disanzhang_png","sycx_txt_disizhang_png","sycx_txt_diwuzhang_png","sycx_txt_diliuzhang_png","sycx_txt_diqizhang_png","sycx_txt_dibazhang_png","sycx_txt_dijiuzhang_png","sycx_txt_dishizhang_png"],e.skinName="DeepNestMainViewSkin",e.chestInterval=[],e.pos2HeroBI={},e}d.DeepNestMainView=e,__reflect(e.prototype,"game.DeepNestMainView");var o,a=(o=eui.ItemRenderer,__extends(n,o),n.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(this.data.info.isOpen)this.data&&this.data.touchCB&&this.data.level&&this.data.touchCB(this.data.level-1);else{var e="总星数达到"+d.Config.deepNestWayConfig(this.data.info.chapter).unlock+"后解锁该章节";Utils.MsgUtils.addMidMsg(e)}},this)},n.prototype.dataChanged=function(){var e=this.data;if(0==e.level)this.gp_root.visible=!1;else{if(this.gp_root.visible=!0,this.gp_root.scaleX=e.scale,this.gp_root.scaleY=e.scale,this.img_pic.source=e.icon,this.img_perfect.visible=e.choose,e.info.isOpen)this.lb_jindu.text=Math.floor(100*e.info.stars/15)+"%";else{var t=d.Config.deepNestWayConfig(this.data.info.chapter).unlock;this.lb_jindu.text=t+"可解锁"}this.img_perfect.visible=15==e.info.stars,this.lbl_text.text=e.title,UIActionManager.setAbsGrey(this.gp_root,!e.info.isOpen)}},n);function n(){var e=o.call(this)||this;return e.skinName="DeepNestChapterSkin",e}__reflect(a.prototype,"DeepNestChapterItem");var r,s=(r=eui.Component,__extends(c,r),c.prototype.childrenCreated=function(){r.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem)},c.prototype.updateItem=function(e){if(this.data=e,this.data.uuid){this.gp_baseitem.visible=!0,this.gp_empty.visible=!1;var t=void 0;if(this.data.type==EEntityType.EEntityTypeHero){var i=this.heroProxy.allHeroByUuid[this.data.uuid];t=0==i.dermaCode?void 0:d.Config.getHeroDermaConfig()[i.dermaCode].avatar}this.baseItem.updateData({uuid:this.data.uuid,type:this.data.type,effect:!1,isShowZhongZhu:!0,avatar:t})}else this.gp_baseitem.visible=!1,this.gp_empty.visible=!0,this.img_add.visible=!0;this.img_lock.visible=!1,this.lb_unlock.visible=!1},c);function c(){var e=r.call(this)||this;return e.heroProxy=d.AppFacade.getInstance().retrieveProxy(d.HeroPy.N),e.skinName="HeroMainView_HeroListItem",e}d.DeepNest_HeroItem=s,__reflect(s.prototype,"game.DeepNest_HeroItem")}(game=game||{}),function(d){var t,e=(__extends(i,t=BasePanel),i.prototype.perClose=function(){this.doneCB&&this.doneCB()},i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},i.prototype.updateView=function(e){this.params=e.info,this.doneCB=e.doneCB;var t=0<this.params.winC,i=t?"common_shengli_22":"common_zhanbai_22";this.gp_win.visible=t,this.gp_lose.visible=!t,DragonBoneTools.create(i,function(e){e.x=this.gp_effect.width/2,e.y=this.gp_effect.height,e.animation.play(),this.gp_effect.addChild(e)},this),UIActionManager.setAbsGrey(this.img_star0,!(0<this.params.winC)),UIActionManager.setAbsGrey(this.img_star1,!(1<this.params.winC)),UIActionManager.setAbsGrey(this.img_star2,!(2<this.params.winC));var o=this.params.clientReward.rewards;for(var n in o){var a=customui.BaseItemFactory.create();a.scaleX=a.scaleY=.7,a.updateData({code:o[n].code,type:o[n].type,num:o[n].num}),this.gp_reward.addChild(a)}for(var r=[],s=0;s<this.params.battleResultEach.length;s++){var c={info:this.params.battleResultEach[s],index:s+1};r.push(c)}this.list.dataProvider=new eui.ArrayCollection(r),this.list.itemRenderer=l},i);function i(){var e=t.call(this)||this;return e.params=void 0,e.doneCB=void 0,e.skinName="DeepNestResultPanelSkin",e}d.DeepNestResultPanel=e,__reflect(e.prototype,"game.DeepNestResultPanel");var o,l=(o=eui.ItemRenderer,__extends(n,o),n.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this)},n.prototype.dataChanged=function(){this.gp_myTeam.removeChildren(),this.gp_otherTeam.removeChildren(),this.gp_myPetList.removeChildren(),this.gp_otherPetList.removeChildren();var e=this.data,t=e.info;this.lb_team.text="第 "+e.index+" 队",this.img_my.source=1==t.result?"zdjj_txt_sheng_png":"zdjj_txt_bai_png",this.img_other.source=2==t.result?"zdjj_txt_sheng_png":"zdjj_txt_bai_png";var i=d.GameMVC.playerPy.playerInfoVO.name;for(var o in t.teams){var n=t.teams[o].name==i?this.gp_myTeam:this.gp_otherTeam,a=t.teams[o].name==i?this.gp_myPetList:this.gp_otherPetList;for(var r in t.teams[o].entities){var s=new u;s.scaleX=s.scaleY=.5;var c=EEntityType.EEntityTypeHero;t.teams[o].entities[r].type==BattleEntityType.Magical?c=EEntityType.EEntityTypeMagical:t.teams[o].entities[r].type==BattleEntityType.Pet&&(c=EEntityType.EEntityTypePet);var l={isMagical:!1,code:t.teams[o].entities[r].code,entityId:t.teams[o].entities[r].entityId,dermaCode:t.teams[o].entities[r].dermaCode,type:c};t.teams[o].entities[r].type==BattleEntityType.Pet?(s.scaleX=s.scaleY=.3,a.addChild(s)):n.addChild(s),s.updateData(l)}if(t.teams[o].magical){var h={code:t.teams[o].magical.code,type:EEntityType.EEntityTypeMagical,entityId:t.teams[o].magical.entityId},p=new u;p.scaleX=p.scaleY=.3,a.addChild(p),p.updateData(h)}}this.img_petdi.visible=0<this.gp_myPetList.$children.length,this.img_petdi2.visible=0<this.gp_otherPetList.$children.length,this.gp_otherPetList.visible=0<this.gp_otherPetList.$children.length},n);function n(){var e=o.call(this)||this;return e.skinName="DeepNestResultItemSkin",e}d.DeepNestResultItem=l,__reflect(l.prototype,"game.DeepNestResultItem");var a,u=(a=eui.Component,__extends(r,a),r.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.gp_baseitem.removeChildren(),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem)},r.prototype.updateData=function(e){var t=e.code,i=void 0;e.dermaCode&&0!=e.dermaCode&&(i=d.Config.getHeroDermaConfig()[e.dermaCode].avatar),this.baseItem.updateData({code:t,type:e.type,avatar:i,isShowZhongZhu:!0})},r);function r(){var e=a.call(this)||this;return e.skinName="HeroMainView_HeroListItem",e}__reflect(u.prototype,"DeepNestResult_Item")}(game=game||{}),function(e){var t,i=(__extends(o,t=BaseMediator),o.prototype.initSubView=function(){this.addSubView(o.SV.ENTRANCE,e.ExtEntranceView),this.addSubView(o.SV.ENTRANCE2,e.Ext2EntranceView)},o.prototype.listNotificationInterests=function(){return[CN.HIDE_LOADING]},o.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_LOADING:this.hideAllSubView()}},o.N="ExtEntranceMediator",o.SV={ENTRANCE:1,ENTRANCE2:2},o);function o(e){return void 0===e&&(e=null),t.call(this,o.N,e)||this}e.ExtEntranceMediator=i,__reflect(i.prototype,"game.ExtEntranceMediator")}(game=game||{}),function(i){var t,e=(__extends(o,t=BasePanel),o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.img_title.source="wfrk_txt_ysjhs_png"},o.prototype.initList=function(){this.item_list=new eui.List;var e=new eui.VerticalLayout;(this.item_list.layout=e).gap=10,e.horizontalAlign=egret.HorizontalAlign.CENTER,this.item_list.itemRenderer=a,this.scroller.viewport=this.item_list},o.prototype.updateView=function(){var e=[];for(var t in this.ENTRANCE_CONFIG)this.ENTRANCE_CONFIG[t].view=this,e.push(this.ENTRANCE_CONFIG[t]);this.item_list.dataProvider=new eui.ArrayCollection(e),this.gp_root.height=179*e.length+10*(e.length-1)},o);function o(){var e=t.call(this)||this;return e.ENTRANCE_CONFIG={GUILD_WAR:{desc:"可获取命运之骰、圣物碎片等资源",rankingType:void 0,moduleId:MODULE.TribeBattle,bg:"wfrk_img_rukou_blzb_png",descDown:"可获取命运之骰、圣物碎片等资源",notice:void 0,shopType:void 0},STORMWAR:{desc:"可获取宠物口粮和圣物洗练石",rankingType:void 0,moduleId:MODULE.StormWar,bg:"wfrk_img_rukou_fbzc_png",descDown:"可获取宠物口粮和圣物洗练石",notice:NT.STORM_WAR},MANOR:{desc:"挖矿",rankingType:void 0,moduleId:MODULE.Manor,bg:"wfrk_img_rukou_kmzdz_png",descDown:"占领高级矿脉，赢取丰富资源",notice:NT.MANOR_ENTRANCE,shopType:ShopType.ShopTypeManor,changeFormationFunc:function(){i.AppFacade.getInstance().hideSubView(i.ExtEntranceMediator.N,i.ExtEntranceMediator.SV.ENTRANCE2),i.AppFacade.getInstance().showSubView(i.CommonMediator.N,i.CommonMediator.SV.TEAM_CHOOSE,{module:MODULE.Manor,touchHoldCB:function(e){var t=Utils.UnlockMgr.getOpenInfo(MODULE.Manor);return i.GameMVC.manorPy.checkFormation(e,!t.isOpen)},doneCB:function(){i.AppFacade.getInstance().showSubView(i.ExtEntranceMediator.N,i.ExtEntranceMediator.SV.ENTRANCE2)},tips:"只有在安全区才能编辑队伍",clickDarkClose:!1})}}},e.skinName="PvpEntranceViewSkin",Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_view_close),e._popActionType=5,e._removeActionType=6,e}i.Ext2EntranceView=e,__reflect(e.prototype,"game.Ext2EntranceView");var n,a=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){var e=this;n.prototype.childrenCreated.call(this),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.MainJumpConfig.jumpTo(this.data.moduleId)?i.AppFacade.getInstance().hideSubView(i.ExtEntranceMediator.N,i.ExtEntranceMediator.SV.ENTRANCE2):(this.gp_bg.scaleX=1,this.gp_bg.scaleY=1)},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.currentState="up"},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.shopType&&i.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:e.shopType})},this),this.btn_changeFormation.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.currentState="up"},this),this.btn_changeFormation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.changeFormationFunc&&e.data.changeFormationFunc()},this)},r.prototype.dataChanged=function(){this.img_bg.source=this.data.bg,this.data.notice&&NoticeManager.addNoticeListener(this.data.notice,this.gp_bg,this.data.view,{percentX:554/578,percentY:0});var e=Utils.UnlockMgr.checkPass(this.data.moduleId,!1);if(e.allow)switch(this.lb_unlock.text=this.data.desc||"",this.data.moduleId){case MODULE.StormWar:this.countdownForStorm();break;case MODULE.Manor:this.countdownForManor()}else this.lb_unlock.text=this.data.descDown||"",this.data.moduleId==MODULE.StormWar&&(this.lb_unlock.text=e.ext.tips),UIActionManager.setAbsGrey(this,!0),e.ext&&"server"!=e.ext.lockType&&(this.lb_unlock.text=e.ext.tips.replace("解锁","开启"));this.data.shopType?(this.shopType=this.data.shopType,this.btn_shop.visible=!0):this.btn_shop.visible=!1,this.data.notice&&NoticeManager.addNoticeListener(this.data.notice,this.gp_bg,this.data.view,{percentX:554/578,percentY:0}),this.btn_changeFormation.visible=!!this.data.changeFormationFunc},r.prototype.getRemainingTime=function(e){return Utils.TimerManager.getFormatBySecond1(e)},r.prototype.countdownForStorm=function(){var e=this,t=Utils.UnlockMgr.getOpenInfo(MODULE.StormWar),i=t.isOpen;if(i)this.endingTimer&&egret.clearInterval(this.endingTimer),this.lb_unlock.text=this.data.descDown||"",this.lb_unlock.visible=!0;else{if(0==t.endTimeDt||Utils.TimerManager.getServerTime(!1)>=t.endTimeDt)return this.lb_unlock.visible=!0,this.lb_unlock.text="今日已结束",UIActionManager.setAbsGrey(this.gp_bg,!i),void(this.gp_bg.touchEnabled=i);this.timerDt=t.openTimeDt-Utils.TimerManager.getServerTime(!1),this.lb_unlock.visible=!1,this.gp_time.visible=!0,this.lb_miaoshu.text=i?"":"开启倒计时：",this.blb_time.text=this.getRemainingTime(this.timerDt),UIActionManager.setAbsGrey(this.gp_bg,!i),this.gp_bg.touchEnabled=i,this.endingTimer||(this.endingTimer=egret.setInterval(function(){0<=e.timerDt?e.blb_time.text=e.getRemainingTime(--e.timerDt):(egret.clearInterval(e.endingTimer),e.dataChanged())},this,1e3))}},r.prototype.countdownForManor=function(){var e=this;this.gp_time.visible=!0,this.lb_unlock.text="",this.lb_miaoshu.text="";var t=Utils.UnlockMgr.getOpenInfo(MODULE.Manor);if(!t.allow)return this.lb_unlock.text="未开启",void UIActionManager.setAbsGrey(this.gp_bg,!0);if(t.isOpen)this.lb_unlock.text=this.data.descDown;else{if(!t.isWillOpenToday)return this.lb_unlock.text="今日不开放",void UIActionManager.setAbsGrey(this.gp_bg,!0);var i=Utils.TimerManager.getServerTime(!1),o=t.openTimeDt,n=t.endTimeDt;if(0==n||n<=i)return this.lb_unlock.text="今日已结束",void UIActionManager.setAbsGrey(this.gp_bg,!0);this.lb_unlock.text="",this.lb_miaoshu.text="开启倒计时：",this.timerDt=o-i,this.blb_time.visible=!0,this.blb_time.text=this.getRemainingTime(this.timerDt--),this.endingTimer1||(this.endingTimer1=egret.setInterval(function(){0<=e.timerDt?e.blb_time.text=e.getRemainingTime(e.timerDt--):(e.countdownForManor(),e.endingTimer1&&egret.clearTimeout(e.endingTimer1))},this,1e3)),UIActionManager.setAbsGrey(this.gp_bg,!0)}},r.prototype.onDestroy=function(){egret.clearInterval(this.endingTimer),egret.clearInterval(this.endingTimer1),egret.clearInterval(this.startTimer)},r);function r(){var e=n.call(this)||this;return e.skinName="EntranceView_ListItem",e.once(egret.Event.REMOVED_FROM_STAGE,e.onDestroy,e),e}__reflect(a.prototype,"EntranceView_ListItem")}(game=game||{}),function(e){var t,i=(__extends(o,t=BasePanel),o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.img_title.source="wfrk_txt_myzc_png"},o.prototype.initList=function(){this.item_list=new eui.List;var e=new eui.VerticalLayout;(this.item_list.layout=e).gap=10,e.horizontalAlign=egret.HorizontalAlign.CENTER,this.item_list.itemRenderer=a,this.scroller.viewport=this.item_list},o.prototype.updateView=function(){var e=[];for(var t in this.ENTRANCE_CONFIG)this.ENTRANCE_CONFIG[t].view=this,e.push(this.ENTRANCE_CONFIG[t]);this.item_list.dataProvider=new eui.ArrayCollection(e),this.gp_root.height=179*e.length+10*(e.length-1)},o);function o(){var e=t.call(this)||this;return e.ENTRANCE_CONFIG={WCHESS:{desc:"提高战旗段位，获取丰厚奖励",rankingType:void 0,moduleId:MODULE.Wchess,bg:"wfrk_img_rukou_myzq_png",descDown:"提高战棋段位，获取丰厚奖励",notice:void 0},VESTAGE:{desc:"挑战副本，赢取海量稀有道具",rankingType:void 0,moduleId:MODULE.Vestage,bg:"wfrk_img_rukou_shzyj_png",descDown:"挑战副本，赢取海量稀有道具",notice:void 0}},Utils.SDKMgr.getPerformConfig(38)||delete e.ENTRANCE_CONFIG.VESTAGE,e.skinName="PvpEntranceViewSkin",Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_view_close),e._popActionType=5,e._removeActionType=6,e}e.ExtEntranceView=i,__reflect(i.prototype,"game.ExtEntranceView");var n,a=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.gp_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.gp_bg.scaleX=1,this.gp_bg.scaleY=1,e.MainJumpConfig.jumpTo(this.data.moduleId)&&e.AppFacade.getInstance().hideSubView(e.ExtEntranceMediator.N,e.ExtEntranceMediator.SV.ENTRANCE)},this)},r.prototype.dataChanged=function(){this.img_bg.source=this.data.bg,this.data.notice&&NoticeManager.addNoticeListener(this.data.notice,this.gp_bg,this.data.view,{percentX:554/578,percentY:0});var e=Utils.UnlockMgr.checkPass(this.data.moduleId,!1);e.allow?(this.lb_unlock.text=this.data.desc||"",this.data.moduleId):(this.lb_unlock.text=this.data.descDown||"",this.data.moduleId==MODULE.StormWar&&(this.lb_unlock.text=e.ext.tips),UIActionManager.setAbsGrey(this,!0),e.ext&&"server"!=e.ext.lockType&&(this.lb_unlock.text=e.ext.tips.replace("解锁","开启"))),this.data.notice&&NoticeManager.addNoticeListener(this.data.notice,this.gp_bg,this.data.view,{percentX:554/578,percentY:0})},r.prototype.getRemainingTime=function(e){return Utils.TimerManager.getFormatBySecond1(e)},r.prototype.onDestroy=function(){egret.clearInterval(this.endingTimer),egret.clearInterval(this.endingTimer1),egret.clearInterval(this.startTimer)},r);function r(){var e=n.call(this)||this;return e.skinName="EntranceView_ListItem",e.once(egret.Event.REMOVED_FROM_STAGE,e.onDestroy,e),e}__reflect(a.prototype,"EntranceView_ListItem")}(game=game||{}),function(t){var i,e=(__extends(o,i=BaseMediator),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,t.GloryArenaView)},o.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.GENERAL_PASS_DAY,CN.ARENA_UPDATE_INFO,CN.ARENA_UPDATE_OPPONENT,CN.PLAYER_LEVEL_UP,CN.LOGIN_FINAL_DONE]},o.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.ARENA_UPDATE_INFO:case CN.ARENA_UPDATE_OPPONENT:this.updateView(o.SV.MAIN);break;case CN.PLAYER_LEVEL_UP:t.GameMVC.gloryArenaPy.arenaInfo||t.GameMVC.gloryArenaPy.GetGloryArenaInfo(),Utils.UnlockMgr.checkPass(MODULE.GloryArena,!1).allow&&(t.GameMVC.backpackPy.getModuleTeam(MODULE.GloryArena)||t.GameMVC.backpackPy.GetTeamInfo());break;case CN.GENERAL_PASS_DAY:case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.GloryArena,!1).allow&&t.GameMVC.gloryArenaPy.GetGloryArenaInfo()}},o.N="GloryArenaMed",o.SV={MAIN:1},o);function o(e){return void 0===e&&(e=null),i.call(this,o.N,e)||this}t.GloryArenaMed=e,__reflect(e.prototype,"game.GloryArenaMed")}(game=game||{}),function(i){var e=(t.registerAll=function(){(new n).register(),(new s).register()},t);function t(){}i.GloryArenaProcessor=e,__reflect(e.prototype,"game.GloryArenaProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){var t=e.getBody();i.GameMVC.gloryArenaPy.updateArenaInfo(t.info)},a);function a(){return o.call(this,"gloryArena.PlayerGloryArenaInfoP",a)||this}i.PlayerGloryArenaInfoP=n,__reflect(n.prototype,"game.PlayerGloryArenaInfoP");var r,s=(r=i.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody();i.GameMVC.gloryArenaPy.arenaInfo.endDt=t.endDt,i.GameMVC.gloryArenaPy.arenaInfo.startDt=t.startDt},c);function c(){return r.call(this,"gloryArena.GloryArenaDtP",c)||this}i.GloryArenaDtP=s,__reflect(s.prototype,"game.GloryArenaDtP")}(game=game||{}),function(a){var e,t=(__extends(i,e=BaseProxy),i.prototype.GetGloryArenaInfo=function(t){var i=this;Utils.UnlockMgr.checkPass(MODULE.GloryArena,!1)&&Utils.Socket.send("gloryArena","GetGloryArenaInfo",{}).then(function(e){e.info.startDt=e.startDt,e.info.endDt=e.endDt,i.updateArenaInfo(e.info),t&&t()})},i.prototype.ChangeOpponent=function(t){var i=this;Utils.Socket.send("gloryArena","ChangeOpponent",{}).then(function(e){i.updateOpponentInfo(e.opponents),t&&t()})},i.prototype.GetGloryArenaPlayerInfo=function(e,t){Utils.Socket.send("gloryArena","GetGloryArenaPlayerInfo",{playerId:e}).then(function(e){t&&t(e)})},i.prototype.GetGloryDefendTeam=function(e,t){Utils.Socket.send("gloryArena","GetGloryDefendTeam",{playerId:e}).then(function(e){t&&t(e.teams)})},i.prototype.BuyChallengeTimes=function(t,i){var o=this;Utils.Socket.send("gloryArena","BuyChallengeTimes",{count:t}).then(function(e){Utils.MsgUtils.addMidMsg("成功购买"+t+"次"),o.updateArenaInfo(e.info),a.AppFacade.getInstance().sendNotification(CN.ARENA_UPDATE_OPPONENT),i&&i()})},i.prototype.Challenge=function(t,i){var o=this;for(var e in this.fightCount=3,this.opponents){var n=this.opponents[e];n.playerId==t&&(this.lastFightData.before=n)}a.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeGloryArena,customParams:{fightBg:"fight_scene_jjc"},pb1:"gloryArena",pb2:"Challenge",params:{playerId:t},reqCB:function(e){o.lastFightData.info=e.info,o.GetGloryArenaPlayerInfo(t,function(e){o.lastFightData.after=e})},doneCB:function(e){console.log("战斗结束",e);var t=e.cbRet;t&&o.updateArenaInfo(t.info),i&&i(),a.AppFacade.getInstance().retrieveProxy(a.FightPy.N).queueExceExitCB(),a.GameMVC.gloryArenaMed.showSubView(a.GloryArenaMed.SV.MAIN)}})},i.prototype.GetBattleRecord=function(t){var i=this;Utils.Socket.send("gloryArena","GetBattleRecord",{}).then(function(e){i.updateRecordInfo(e.arenaRecords),t&&t()})},i.prototype.updateArenaInfo=function(e){this.arenaInfo||(this.arenaInfo=new p),this.arenaInfo.update(e),NoticeManager.updateNotice(NT.GLORT_ARENA)},i.prototype.updateOpponentInfo=function(e){var t=this;this.opponents.splice(0),e&&(e.forEach(function(e){t.opponents.push(new c(e))}),this.opponents.sort(function(e,t){return e.rank-t.rank})),a.AppFacade.getInstance().sendNotification(CN.ARENA_UPDATE_OPPONENT)},i.prototype.updateRecordInfo=function(e,t){var i=this;void 0===t&&(t=!1),t?(this.latestRecord=e,this.arenaRecords.push(e)):(this.arenaRecords.splice(0),e.forEach(function(e){i.arenaRecords.push(new a.BattleRecord(e))})),this.arenaRecords.sort(function(e,t){return t.battleDt-e.battleDt})},i.N="GloryArenaPy",i);function i(){var t=e.call(this,i.N)||this;return t.fightCount=0,t.opponents=new Array,t.arenaRecords=new Array,t.lastFightData={},NoticeManager.setChildType(NT.GLORT_ARENA,NT.GLORT_ARENA_CAN_FIGHT),NoticeManager.registerCB(NT.GLORT_ARENA_CAN_FIGHT,function(){var e=Utils.TimerManager.getServerTime(!1);a.GameMVC.gloryArenaPy.arenaInfo.endDt;return!(0<a.GameMVC.gloryArenaPy.arenaInfo.startDt-e)&&0<t.arenaInfo.count},t,MODULE.GloryArena),t}a.GloryArenaPy=t,__reflect(t.prototype,"game.GloryArenaPy");var o,n=(o=a.BaseVO,__extends(r,o),r.prototype.update=function(e){this.teamNo=e.teamNo,this.heroList=e.heroList,this.magicalList=e.magicalList,this.petList=e.petList},r);function r(e){var t=o.call(this)||this;return t.heroList=[],t.magicalList=[],t.petList=[],t.update(e),t}a.BattleTeamInfo=n,__reflect(n.prototype,"game.BattleTeamInfo");var s,c=(s=a.BaseVO,__extends(l,s),l.prototype.update=function(e){this.playerId=e.baseInfo.playerId,this.name=e.baseInfo.name,this.level=e.baseInfo.level,this.vLevel=e.baseInfo.vLevel,this.fightCap=e.baseInfo.fightCap,this.avatar=e.baseInfo.avatar,this.rank=e.rank,this.old_grade=this.grade||0,this.grade=e.grade},l);function l(e){var t=s.call(this)||this;return t.update(e),t}a.GloryPlayerInfo=c,__reflect(c.prototype,"game.GloryPlayerInfo");var h,p=(h=a.BaseVO,__extends(d,h),Object.defineProperty(d.prototype,"inToGame",{get:function(){var e=a.GameMVC.backpackPy.getModuleTeam(MODULE.GloryArenaDef);if(e&&e.teams){var t=!0;return e.teams.forEach(function(e){0==e.heros.length&&(t=!1)}),t}return!1},enumerable:!0,configurable:!0}),d.prototype.update=function(e){e&&(this.count=e.count,this.rank=e.rank||this.rank||1e5,this.buyTimes=e.buyTimes,this.grade=e.grade,this.endDt=null==e.endDt?this.endDt:e.endDt,this.startDt=null==e.startDt?this.startDt:e.startDt,a.GameMVC.gloryArenaMed.updateView(a.GloryArenaMed.SV.MAIN))},d);function d(e){var t=h.call(this)||this;return t.startDt=0,t.endDt=0,t.update(e),t}a.GloryArenaInfo=p,__reflect(p.prototype,"game.GloryArenaInfo")}(game=game||{}),function(n){var i,e=(__extends(t,i=BaseFull),t.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.removeNotice(),Utils.AssetsMgr.destroyGroup("group_arena")},t.prototype.addNotice=function(){},t.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.gp_top.addChild(this.gp_1),this.gp_top.addChild(this.gp_2),this.gp_bottom.addChild(this.gp_3),this.gp_bottom.addChild(this.gp_4),this.gp_bottom.addChild(this.gp_5),this.gp_bottom.addChild(this.gp_6),this.arenaPlayerItems=[this.gp_1,this.gp_2,this.gp_3,this.gp_4,this.gp_5,this.gp_6],this.gp_mine.addChild(this.cu_myPH),this.cu_myPH.scaleX=this.cu_myPH.scaleY=.85,this.cu_myPH.x=40,this.cu_myPH.y=12,this.btn_back1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.MainJumpConfig.jumpTo()},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeGloryArena})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.AppFacade.getInstance().showSubView(n.RankMediator.N,n.RankMediator.SV.COMMON,{module:"RankingTypeGloryArena"})},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.formationDefend()},this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.AppFacade.getInstance().showSubView(n.FightMediator.N,n.FightMediator.SV.RECORD,{pb1:"gloryArena",pb2:"GetBattleRecord",key:"records",isGradeType:!0,tips:"积分"})},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.buyCount()},this),this.btn_change.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.GameMVC.gloryArenaPy.ChangeOpponent()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){n.GameMVC.commonMed.showHelpDialog(MODULE.GloryArena)},this),this.addNotice(),n.GameMVC.gloryArenaPy.arenaInfo.inToGame?this.fetch():this.formationDefend()},t.prototype.formationDefend=function(){var i=this,t=n.GameMVC.gloryArenaPy.arenaInfo.inToGame;n.AppFacade.getInstance().showSubView(n.CommonMediator.N,n.CommonMediator.SV.TEAM_CHOOSE,{module:MODULE.GloryArenaDef,title:"守卫阵容",touchHoldCB:function(e,t){return t?(n.AppFacade.getInstance().hideSubView(n.CommonMediator.N,n.CommonMediator.SV.TEAM_CHOOSE),n.GameMVC.gloryArenaPy.arenaInfo.inToGame||i.hide(),!1):0<e[0].heros.length&&0<e[1].heros.length&&0<e[2].heros.length?e:(Utils.MsgUtils.addMidMsg("每队至少上阵1个英雄"),!1)},doneCB:function(){var e=n.GameMVC.gloryArenaPy.arenaInfo.inToGame;!t&&e&&i.fetch()},clickDarkClose:!1})},t.prototype.buyCount=function(){var e=Number(n.Config.constConfig().GloryArenaMaxCount.constValue);e<=n.GameMVC.gloryArenaPy.arenaInfo.count?Utils.MsgUtils.addMidMsg("当前次数已满"):n.AppFacade.getInstance().showSubView(n.CommonMediator.N,n.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.GloryArena,hasBuyNum:n.GameMVC.gloryArenaPy.arenaInfo.buyTimes,buyCB:function(e){n.GameMVC.gloryArenaPy.BuyChallengeTimes(e)},curNum:n.GameMVC.gloryArenaPy.arenaInfo.count,maxNum:e,maxBuyNum:n.Config.VIPConfig().gloryArenaBuyTimes})},t.prototype.fetch=function(){n.GameMVC.gloryArenaPy.ChangeOpponent(function(){n.GameMVC.gloryArenaPy.GetGloryArenaInfo()})},t.prototype.updateView=function(e){var o=this;if(n.GameMVC.gloryArenaPy.arenaInfo){this.blb_count.text=""+n.GameMVC.gloryArenaPy.arenaInfo.count,this.blb_rank.text=""+n.GameMVC.gloryArenaPy.arenaInfo.rank,this.blb_cap.text=""+Utils.MathUtils.formatNumStyle2(n.GameMVC.playerPy.playerInfoVO.fightCap),this.bm_myGrade.text=n.GameMVC.gloryArenaPy.arenaInfo.grade+"",this.cu_myPH.updateData({vo:n.GameMVC.playerPy.playerInfoVO}),this.arenaPlayerItems.forEach(function(e,t){var i=n.GameMVC.gloryArenaPy.opponents[t];i?(e.visible=!0,e.update({vo:i,fightCB:function(t){0<n.GameMVC.gloryArenaPy.arenaInfo.count?n.GameMVC.gloryArenaPy.GetGloryDefendTeam(t.playerId,function(e){PopUpManager.addPopUp({obj:new n.GloryArenaFormationView1({module:MODULE.GloryArena,touchHoldCB:function(e){return 0<e[0].heros.length&&0<e[1].heros.length&&0<e[2].heros.length?e:(Utils.MsgUtils.addMidMsg("每队至少上阵1个英雄"),!1)},enermy:{playerId:t.playerId,name:t.name,fightCap:t.fightCap,avatar:t.avatar,grade:t.grade,rank:t.rank,teams:e}}),closeCB:function(e){e&&n.GameMVC.gloryArenaPy.Challenge(t.playerId,function(){n.GameMVC.gloryArenaPy.ChangeOpponent()})}})}):(Utils.MsgUtils.addMidMsg("挑战次数不足"),o.buyCount())},canFight:1<t||n.GameMVC.gloryArenaPy.arenaInfo.rank<=10})):e.visible=!1}),this.timer&&egret.clearInterval(this.timer);var t=Utils.TimerManager.getServerTime();if(n.GameMVC.gloryArenaPy.arenaInfo.endDt>t){var i=n.GameMVC.gloryArenaPy.arenaInfo.endDt-t;this.bm_time.text=Utils.TimerManager.getFormatBySecond1(i),this.timer=egret.setInterval(function(){0<=--i?o.bm_time.text=Utils.TimerManager.getFormatBySecond1(i):o.updateView()},this,1e3)}else Utils.MsgUtils.addMidMsg("当前赛季已结束"),n.MainJumpConfig.jumpTo()}},t);function t(){var e=i.call(this)||this;Utils.AssetsMgr.loadGroup("group_arena"),e.skinName="GloryArenaViewSkin",e.cu_myPH=customui.PlayerHeadFactory.create();for(var t=1;t<=6;t++)e["gp_"+t]=new a;return e}n.GloryArenaView=e,__reflect(e.prototype,"game.GloryArenaView");var o,a=(o=eui.Component,__extends(r,o),r.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.btn_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.fightCB&&e.fightCB(e.vo)},this),this.addChild(this.cu_playerHead),this.cu_playerHead.scaleX=this.cu_playerHead.scaleY=.7,this.cu_playerHead.x=137,this.cu_playerHead.y=14,this.cu_playerHead.addTapEvent(function(){e.vo&&n.AppFacade.getInstance().showSubView(n.FriendMediator.N,n.FriendMediator.SV.INFO,{playerId:e.vo.playerId})})},r.prototype.update=function(e){var t=this;if(e){this.vo=e.vo,this.fightCB=e.fightCB;var i=e.canFight;this.vo?(this.lb_name.text=this.vo.name,3<this.vo.rank?(this.blb_rank.visible=!0,this.img_rank.visible=!1,this.blb_rank.text=this.vo.rank.toString()):(this.blb_rank.visible=!1,this.img_rank.visible=!0,RES.getResAsync("jjc_icon_pm_"+this.vo.rank+"_png",function(e){t.img_rank.source=e},this)),this.cu_playerHead.updateData({vo:this.vo}),this.item_fightCap.update(this.vo.fightCap),this.bm_grade.text=this.vo.grade+"",this.btn_fight.visible=i,this.vo.rank==n.GameMVC.gloryArenaPy.arenaInfo.rank&&(this.btn_fight.visible=!1)):this.btn_fight.visible=!1}},r);function r(){var e=o.call(this)||this;return e.skinName="gloryArenaPlayerItemSkin",e.cu_playerHead=customui.PlayerHeadFactory.create(),e}__reflect(a.prototype,"gloryArenaPlayerItem",["eui.UIComponent","egret.DisplayObject"])}(game=game||{}),function(f){var t,e=(__extends(i,t=BasePanel),i.prototype.perClose=function(){this.doneCB&&this.doneCB()},i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.btn_ok.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},i.prototype.updateView=function(e){this.params=e.info,this.doneCB=e.doneCB;var t=2;f.GameMVC.gloryArenaPy.fightCount--;var i=[];i=0==f.GameMVC.gloryArenaPy.fightCount?(t=2,[this.params.battleResultEach[0],this.params.battleResultEach[1],this.params.battleResultEach[2]]):1==f.GameMVC.fightPy.multiFightOriginPushs.length?(t=1,[this.params.battleResultEach[1]]):(t=0,[this.params.battleResultEach[0]]);var o=1<this.params.winC;if(2!=t)o=i[0].result==EBattleResult.EBattleResultWin,this.gp_allResult.visible=!1,this.btn_ok.label="下一场",this.gp_main.height=620,this.gp_win.height=this.gp_lose.height=470,this.scroller.height=150;else{this.gp_allResult.visible=!0,this.btn_ok.label="确定",this.gp_main.height=1160,this.gp_win.height=this.gp_lose.height=1e3,this.scroller.height=500,this.bm_count.text=this.params.winC+":"+(3-this.params.winC);var n=i[0].teams;for(var a in n)if(n[a].name==f.GameMVC.playerPy.playerInfoVO.name){this.playerHead_self.updateData({vo:f.GameMVC.playerPy.playerInfoVO});var r=f.GameMVC.gloryArenaPy.arenaInfo.grade,s=0<(c=f.GameMVC.gloryArenaPy.lastFightData.info.grade-r)?"+"+c:c;this.bm_grad_self.text="积分:"+r+"("+s+")",this.bm_rank_self.text="排名:"+f.GameMVC.gloryArenaPy.arenaInfo.rank}else{var c;this.playerHead_enermy.updateData({vo:f.GameMVC.gloryArenaPy.lastFightData.before}),r=f.GameMVC.gloryArenaPy.lastFightData.before.grade,s=0<(c=f.GameMVC.gloryArenaPy.lastFightData.after.grade-r)?"+"+c:c,this.bm_grad_enermy.text="积分:"+r+"("+s+")",this.bm_rank_enermy.text="排名:"+f.GameMVC.gloryArenaPy.lastFightData.before.rank}}var l=o?"common_shengli_22":"common_zhanbai_22";this.gp_win.visible=o,this.gp_lose.visible=!o,DragonBoneTools.create(l,function(e){e.x=this.gp_effect.width/2,e.y=this.gp_effect.height,e.animation.play(),this.gp_effect.addChild(e)},this);var h=this.params.clientReward.rewards;for(var a in h){var p=customui.BaseItemFactory.create();p.scaleX=p.scaleY=.7,p.updateData({code:h[a].code,type:h[a].type,num:h[a].num}),this.gp_reward.addChild(p)}for(var d=[],u=0;u<i.length;u++){var g={info:i[u],index:2==t?u+1:t+1};d.push(g)}this.list.dataProvider=new eui.ArrayCollection(d),this.list.itemRenderer=f.DeepNestResultItem},i);function i(){var e=t.call(this)||this;return e.params=void 0,e.doneCB=void 0,e.skinName="GloryArenaFightResultPanelSkin",e}f.GloryArenaFightResultPanel=e,__reflect(e.prototype,"game.GloryArenaFightResultPanel")}(game=game||{}),function(e){var i,t=(i=eui.Component,__extends(o,i),Object.defineProperty(o.prototype,"armatureName",{get:function(){return this._armature&&this._armature.armature&&this._armature.armature.name},set:function(e){null!=e?this.setArmatureName(e):this.warn("未提供有效骨骼名")},enumerable:!0,configurable:!0}),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.width=this.height=0},o.prototype.setOnArmatureCreated=function(e,t){this._armatureCreating?t?this._uniqueCB[t]=e:this._normalCB.push(e):e()},o.prototype.hasAnimation=function(e){return!!this._armature&&this._armature.animation.hasAnimation(e)},o.prototype.play=function(e,t,i,o){var n=this;void 0===t&&(t=!1),void 0===i&&(i=0),this._armatureCreating?this.setOnArmatureCreated(function(){n.play(e,t,i,o)},"playAnimation"):this._armature?this.hasAnimation(e)?!t&&this._armature.animation.isPlaying&&this._armature.animation.lastAnimationName==e||(this._armature.animation.play(e,i),o&&this._armature.once(dragonBones.EgretEvent.COMPLETE,o,this)):this.warn("play error:不存在指定动画    当前骨骼名："+this.armatureName+"    当前动画列表："+this._armature.animation.animationNames+"    待播放动画名："+e):this.warn("play error: 没有已创建或正在创建的骨骼")},o.prototype.stop=function(){var e=this;this._armatureCreating?this.setOnArmatureCreated(function(){e.stop()},"stopAnimation"):this._armature.animation.stop()},o.prototype.resume=function(){var e=this;this._armatureCreating?this.setOnArmatureCreated(function(){e.resume()},"resumeAnimation"):this._armature.animation.play()},o.prototype.onArmatureCreated=function(){for(var e in this._armatureCreating=!1,this.play(this.armatureName),this._normalCB.forEach(function(e){e&&e()}),this._normalCB.splice(0),this._uniqueCB){var t=this._uniqueCB[e];t&&t(),delete this._uniqueCB[e]}},o.prototype.setArmatureName=function(e){var t=this;this._armatureCreating?this.setOnArmatureCreated(function(){t.setArmatureName(e)},"setName"):this.armatureName!=e?(this._armature&&(this._armature.parent&&this._armature.parent.removeChild(this._armature),this._armature=void 0),e&&(this._armatureCreating=!0,DragonBoneTools.create(e,function(e){t.addChild(e),t._armature=e,t.onArmatureCreated()}))):this.log("已存在指定骨骼，放弃创建")},o.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.LOG_ENABLE&&egret.log.apply(egret,["【SteadyArmature】:"].concat(e))},o.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.LOG_ENABLE&&egret.warn.apply(egret,["【SteadyArmature】:"].concat(e))},o.LOG_ENABLE=!1,o);function o(e){var t=i.call(this)||this;return t._armatureCreating=!1,t._uniqueCB={},t._normalCB=[],e&&(t.armatureName=e),t}e.SteadyArmature=t,__reflect(t.prototype,"customui.SteadyArmature")}(customui=customui||{}),function(e){var o,t=(__extends(i,o=BasePanel),i.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.commonDaTanChuKuang.blb_title.text="队伍调整",this.commonDaTanChuKuang.onCloseCB=this.hide.bind(this),this.btn_2up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.exchangeTeams(1,2)},this),this.btn_3up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.exchangeTeams(2,3)},this),this.btn_comfirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.opperationParams=e.teamOrder,e.hide()},this),this.commonDragGroup.initConfig({0:{x:0,y:0,w:0,h:0},1:{x:0,y:0,w:249,h:109},2:{x:0,y:120,w:249,h:109},3:{x:0,y:240,w:249,h:109}}),this.commonDragGroup.dragDoneCB=this.exchangeTeams.bind(this);for(var t=0;t<3;t++){var i=new a;this.commonDragGroup.addItem2Id(i,t+1),this.myTeams.push(i),i=new a,this.gp_enermy.addChild(i),this.enemyTeams.push(i)}this.player0.updateData({vo:this.params.self.vo}),this.lb_name0.text=this.params.self.vo.name,this.fightCapItem0.update(this.params.self.vo.fightCap),this.player1.updateData({vo:this.params.enemy.vo}),this.lb_name1.text=this.params.enemy.vo.name,this.fightCapItem1.update(this.params.enemy.vo.fightCap),this.updateView()},i.prototype.updateView=function(){function e(t){var e=i.params.self.teams.filter(function(e){return e.teamNo==t})[0]||{heroList:[],petList:"",magicalList:""};i.myTeams[t-1].update(e),e=i.params.enemy.teams.filter(function(e){return e.teamNo==t})[0]||{heroList:[],petList:"",magicalList:""},i.enemyTeams[t-1].update(e)}for(var i=this,t=1;t<=3;t++)e(t)},i.prototype.exchangeTeams=function(e,t,i){if(e<=0||t<=0)i&&i();else{this.myTeams[this.teamOrder[e]-1].parent.removeChild(this.myTeams[this.teamOrder[e]-1]),this.myTeams[this.teamOrder[t]-1].parent.removeChild(this.myTeams[this.teamOrder[t]-1]),this.commonDragGroup.getGpById(t).addChild(this.myTeams[this.teamOrder[e]-1]),this.commonDragGroup.getGpById(e).addChild(this.myTeams[this.teamOrder[t]-1]);var o=this.teamOrder[e];this.teamOrder[e]=this.teamOrder[t],this.teamOrder[t]=o,i&&i()}},i.prototype.onDestroy=function(){this.opperationParams=this.teamOrder},i);function i(e){var t=o.call(this)||this;return t.teamOrder=[0,1,2,3],t.myTeams=[],t.enemyTeams=[],t.skinName="GloryArenaFormationView2Skin",t.params=e,t}e.GloryArenaFormationView2=t,__reflect(t.prototype,"game.GloryArenaFormationView2");var n,a=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.update(this.data)},r.prototype.update=function(e){var t,i,o=this;if(e&&(this.data=e,this.gp_main))if(this.data.petList?(t=this.data.petList[0]&&this.data.petList[0].code)?(this.e_baseitem_pet.updateData({type:EEntityType.EEntityTypePet,code:t}),this.e_baseitem_pet.visible=!0):this.e_baseitem_pet.visible=!1:(t=this.data.petUuid)?(this.e_baseitem_pet.updateData({type:EEntityType.EEntityTypePet,uuid:t}),this.e_baseitem_pet.visible=!0):this.e_baseitem_pet.visible=!1,this.data.magicalList?(i=this.data.magicalList[0]&&this.data.magicalList[0].code)?(this.e_baseitem_magic.updateData({type:EEntityType.EEntityTypeMagical,code:i}),this.e_baseitem_magic.visible=!0):this.e_baseitem_magic.visible=!1:(i=this.data.magicalUuid)?(this.e_baseitem_magic.updateData({type:EEntityType.EEntityTypeMagical,uuid:i}),this.e_baseitem_magic.visible=!0):this.e_baseitem_magic.visible=!1,this.data.heroList){function n(i){a.forEach(function(e,t){e.battlePos!=i+1&&e.pos!=i+1||(e.uuid="",o["e_baseitem"+i].updateData({type:EEntityType.EEntityTypeHero,vo:e}))})}for(var a=this.data.heroList||this.data.heros,r=0;r<6;r++)n(r)}else{function s(i){a.forEach(function(e,t){e.battlePos!=i+1&&e.pos!=i+1||o["e_baseitem"+i].updateData({type:EEntityType.EEntityTypeHero,uuid:e.uuid})})}for(a=this.data.heros,r=0;r<6;r++)s(r)}},r);function r(){var e=n.call(this)||this;return e.skinName="GloryArenaFormationView2ItemSkin",e}__reflect(a.prototype,"GloryArenaFormationView2Item")}(game=game||{}),function(s){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initList(),this.activateComponent(),this.initialized=!1,this.gp_content.scaleX=this.gp_content.scaleY=1,UIActionManager.playUIAction(this.gp_content,1),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new c})},this)},t.prototype.initList=function(){this.list_item.itemRenderer=n,UIActionManager.hideScrollerBar(this.scroller),this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListItemTap,this),this.list_filter.itemRenderer=s.BackpackUI_FilterItem,this.list_filter.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onFilterListItemTap,this)},t.prototype.onFilterListItemTap=function(e){this.curFilter&&this.curFilter==e.item.data?this.curFilter=void 0:this.curFilter=e.item.data;var t=this.list_filter.dataProvider;for(var i in t.source){var o=t.source[i];o==e.item?o.chosen=!o.chosen:o.chosen=!1}t.refresh(),this.updateList()},t.prototype.fadeFilterListItemTap=function(e){this.curFilter&&this.curFilter==e.item.data?this.curFilter=void 0:this.curFilter=e.item.data;var t=this.list_filter.dataProvider;for(var i in t.source){var o=t.source[i];o.data.race==e.item.data.race?o.chosen=!o.chosen:o.chosen=!1}t.refresh(),this.updateList()},t.prototype.onListItemTap=function(e){var t=e.item.info,i=t.code;switch(Math.floor(i/1e7)){case EEntityType.EEntityTypeHero:s.AppFacade.getInstance().showSubView(s.HeroMediator.N,s.HeroMediator.SV.HERO_DETAIL,{code:i});break;case EEntityType.EEntityTypeHeroArtifact:var o=s.Config.getHeroArtifactUpgradeConfig(t.code),n=s.Config.getHeroArtifactUpstarConfig(t.code);s.AppFacade.getInstance().showSubView(s.HeroThingMediator.N,s.HeroThingMediator.SV.MAIN,{entityType:EEntityType.EEntityTypeHeroArtifact,vo:{code:t.code,entityType:EEntityType.EEntityTypeHeroArtifact,exp:0,fightCap:12e3,level:o.length?o[o.length-1].level:0,level2:n.length?n[n.length-1].level:0},source:s.HeroThingMainView.VIEW_SOURCE.HANDBOOK})}},t.prototype.updateView=function(e){this.params=e,this.curType=e.type,this.targetConfig=this.ITEM_TYPE_CONFIG[this.curType],this.targetConfig&&(this.initialized||(this.initialized=!0,this.resetFilterAndSorter(),this.curType==s.BackpackUI.ITEM_TYPE.HERO&&this.fadeFilterListItemTap({item:{isHero:!0,data:this.targetConfig.filterConfig.data[0],chosen:!1}})),this.btn_help.visible=!!this.targetConfig.needHelp,this.updateList())},t.prototype.updateList=function(){var e=[],t=this.targetConfig.filterConfig&&this.targetConfig.filterConfig.filterFunc||function(){return!0},i=this.targetConfig.sortConfig&&this.targetConfig.sortConfig.defaultSortFunc,o=this.targetConfig.getAllInfo();if(o){var n=this.targetConfig.historyInfo();for(var a in o){var r=o[a];t(this.curFilter,r)&&e.push({info:r,get:n[r.code]&&!!n[r.code].num})}}0<e.length?(this.gp_empty.visible=!1,this.scroller.visible=!0,i&&e.sort(i),this.list_item.dataProvider=new eui.ArrayCollection(e),this.scroller.stopAnimation(),this.scroller.viewport.scrollV=0):(this.gp_empty.visible=!0,this.scroller.visible=!1)},t.prototype.resetFilterAndSorter=function(){if(this.targetConfig.filterConfig){this.list_filter.visible=!0,this.curFilter=void 0;var t=[];"英雄"==this.targetConfig.type||"碎片"==this.targetConfig.type?(this.targetConfig.filterConfig.data.forEach(function(e){t.push({data:e,chosen:!1,isHero:!0})}),this.list_filter.x=(this.gp_content.width-(80*t.length+15*(t.length-1)))/2+15):(this.targetConfig.filterConfig.data.forEach(function(e){t.push({data:e,chosen:!1,isHero:!1})}),this.list_filter.x=(this.gp_content.width-(60*t.length+15*(t.length-1)))/2),this.list_filter.dataProvider=new eui.ArrayCollection(t)}else this.list_filter.visible=!1;this.blb_title.text=this.targetConfig.desc},t.prototype.activateComponent=function(){var e=this;this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},t.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.params&&this.params.closeCB&&this.params.closeCB()},t);function t(){var e,t=i.call(this)||this;return t.curType=EEntityType.EEntityTypeHero,t.ITEM_TYPE_CONFIG=((e={})[s.BackpackUI.ITEM_TYPE.HERO]={desc:"图鉴",type:"英雄",needHelp:!0,barSource:{up:"_btn_yq_m_json.beibao_yeqian_yingxiong_0",down:"_btn_yq_m_json.beibao_yeqian_yingxiong_1"},getAllInfo:function(){var e=[],t=s.Config.allHeroConfig();for(var i in t){var o=t[i];o.isShow&&e.push(o)}return e},historyInfo:function(){return s.AppFacade.getInstance().retrieveProxy(s.HeroPy.N).heroHistoryInfo},filterConfig:{data:[{race:HeroRaceType.Human,icon:"_hero_ar_m_json.common_icon_zhongzu_1",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Orc,icon:"_hero_ar_m_json.common_icon_zhongzu_2",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Elf,icon:"_hero_ar_m_json.common_icon_zhongzu_4",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Athanasy,icon:"_hero_ar_m_json.common_icon_zhongzu_3",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Demon,icon:"_hero_ar_m_json.common_icon_zhongzu_5",chosenImg:"common_icon_xuanzhongyuan_png"},{race:HeroRaceType.Eldar,icon:"_hero_ar_m_json.common_icon_zhongzu_6",chosenImg:"common_icon_xuanzhongyuan_png"}],filterFunc:function(e,t){return!e||e.race==t.race}},sortConfig:{data:[{desc:"等级"},{desc:"星级"}],defaultSortFunc:function(e,t){var i=e.info,o=t.info;return i.initStar!=o.initStar?i.initStar-o.initStar:i.tier!=o.tier?o.tier-i.tier:i.race!=o.race?i.race-o.race:i.profession!=o.profession?HERO_SORT_ORDER[o.profession]-HERO_SORT_ORDER[i.profession]:i.subType!=o.subType?i.subType-o.subType:i.code-o.code}}},e[s.BackpackUI.ITEM_TYPE.ARTIFACT]={desc:"图鉴",type:"圣物",needHelp:!1,barSource:{up:"_btn_yq_m_json.beibao_yeqian_shenqi_0",down:"_btn_yq_m_json.beibao_yeqian_shenqi_1"},getAllInfo:function(){var e=[],t=s.Config.getHeroArtifactConfig();for(var i in t){var o=t[i];if(""!=o.handbookShow){var n=s.Config.getHeroArtifactUpgradeConfig(o.code),a=s.Config.getHeroArtifactUpstarConfig(o.code),r={code:o.code,entityType:EEntityType.EEntityTypeHeroArtifact,exp:0,fightCap:0,level:n&&n.length?n[n.length-1].level:0,level2:a&&a.length?a[a.length-1].level:0};e.push({code:o.code,vo:r,type:EEntityType.EEntityTypeHeroArtifact,isNum:!0,color:o.color,source:0})}}return e},filterConfig:{data:[{color:EColorType.EColorTypeWhite,icon:"beibao_btn_pinzhi_1_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeGreen,icon:"beibao_btn_pinzhi_2_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeBlue,icon:"beibao_btn_pinzhi_3_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypePurple,icon:"beibao_btn_pinzhi_4_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeOrange,icon:"beibao_btn_pinzhi_5_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeRed,icon:"beibao_btn_pinzhi_6_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:EColorType.EColorTypeLegend,icon:"beibao_btn_pinzhi_7_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"}],filterFunc:function(e,t){return!e||e.color==t.color}},sortConfig:{defaultSortFunc:function(e,t){var i=e.info,o=t.info,n=i.color,a=o.color;return n!=a?n-a:i.code-o.code}},historyInfo:function(){return s.AppFacade.getInstance().retrieveProxy(s.HeroThingPy.N).artiHostory}},e),t.skinName="HandBookMainViewSkin",t}s.HandBookMainView=e,__reflect(e.prototype,"game.HandBookMainView");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){this.baseitem=customui.BaseItemFactory.create(),this.baseitem.touchEnabled=!1,this.gp_content.addChild(this.baseitem)},a.prototype.dataChanged=function(){var e=this.data.info;e.isShowZhongZhu=!0;var t=0;switch(Math.floor(e.code/1e7)){case EEntityType.EEntityTypeHero:t=e.maxLevel,this.baseitem.updateData(e),t?(this.baseitem.blb_level.visible=!0,this.baseitem.blb_level.text=t+""):this.baseitem.blb_level.visible=!1;break;case EEntityType.EEntityTypeHeroArtifact:this.baseitem.updateData(e)}this.data.get?UIActionManager.setGrey(this.baseitem,!1):UIActionManager.setGrey(this.baseitem,!0)},a);function a(){var e=o.call(this)||this;return e.skinName="HandBookItemSkin",e}__reflect(n.prototype,"handbookItem");var r,c=(__extends(l,r=BasePanel),l.prototype.childrenCreated=function(){var e=this;r.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="说明",this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.updateLabel(0,"人类是勤劳的化身，创造了璀璨的文明。"),this.updateLabel(1,"拥有野兽的力量，是追求自由的强大族群。"),this.updateLabel(2,"侵入世界的恐怖力量，强大的存在。"),this.updateLabel(3,"居住在森林，具有神秘的力量。"),this.updateLabel(4,"神秘的族群，有着统治一切的魔力。"),this.updateLabel(5,"和魔族抗衡的正义力量，光明的使者。"),this.updateLabel(6,"作为团队的肉盾，具有超强的生存能力。"),this.updateLabel(7,"拥有爆炸的技能伤害，瞬间秒杀一切。"),this.updateLabel(8,"团队的守护神，是不容忽视的职业。"),this.updateLabel(9,"持续强大的核心输出，保证团队战无不胜。")},l.prototype.updateLabel=function(e,t){var i=this["lb_"+e];i&&(i.text=t)},l);function l(){var e=r.call(this)||this;return e.skinName="HandBookHeroHelp",e}__reflect(c.prototype,"HandBookHeroHelp")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.HandBookMainView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:}},n.N="HandBookMediator",n.SV={MAIN:1},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.HandBookPy.N),t}i.HandBookMediator=e,__reflect(e.prototype,"game.HandBookMediator")}(game=game||{}),function(e){var t,i=(__extends(o,t=BaseProxy),o.N="HandBookPy",o);function o(){return t.call(this,e.CopyEntrancePy.N)||this}e.HandBookPy=i,__reflect(i.prototype,"game.HandBookPy")}(game=game||{}),function(e){var t,i=(t=eui.Component,__extends(o,t),o.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.tapEvent&&e.tapEvent()},this)},o.prototype.updateData=function(e){var t=this,i=e&&e.vo;if(i){if(i.level?(this.blb_level.visible=!0,this.blb_level.text=""+i.level):this.blb_level.visible=!1,""!=i.avatar)RES.getResAsync(ResourceUtils.png(i.avatar),function(e){t.img_icon.visible=!0,t.img_icon.source=e},this);else{var o=JSON.parse(game.Config.constConfig().DefaultAvatar.constValue)[0];this.img_icon.visible=!0,this.img_icon.source=o+"_png"}var n=i;this.vipLevel.text=""+(n.vipLevel||0),this.vipLevel.visible=!0,this.btn_vip.visible=!0}else this.blb_level.visible=this.img_icon.visible=!1;this.img_tag.visible=e&&e.showTag,this.tapEvent=e&&e.tapEvent},o.prototype.reset=function(){this.tapEvent=void 0,this.scaleX=this.scaleY=1,this.img_tag.visible=this.blb_level.visible=this.img_icon.visible=!1,this.blb_level.text="",this.img_icon.source="",this.horizontalCenter=this.verticalCenter=void 0},o);function o(){var e=t.call(this)||this;return e.skinName="VipPlayerHeadSkin",e}e.VipPlayerHead=i,__reflect(i.prototype,"customui.VipPlayerHead",["eui.UIComponent","egret.DisplayObject"])}(customui=customui||{}),function(i){var e=(t.registerAll=function(){(new s).register(),(new h).register(),(new u).register(),(new _).register(),(new n).register(),(new v).register()},t);function t(){}i.HeroProcessor=e,__reflect(e.prototype,"game.HeroProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N).updateResonateList(t.resonateList)},a);function a(){return o.call(this,"hero.HeroResonateInfoP",a)||this}i.HeroResonateInfoP=n,__reflect(n.prototype,"game.HeroResonateInfoP");var r,s=(r=i.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N).gashaponInfo[t.info.type]=t.info},c);function c(){return r.call(this,"gashapon.ReFreeTimesP",c)||this}i.ReFreeTimesP=s,__reflect(s.prototype,"game.ReFreeTimesP");var l,h=(l=i.ProcessorBase,__extends(p,l),p.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N).updateHeroDict(t.heroList),i.AppFacade.getInstance().updateView(i.HeroMediator.N,i.HeroMediator.SV.MAIN),i.GameMVC.heroMed.updateView(i.HeroMediator.SV.HERO_QUICK_TRAIN)},p);function p(){return l.call(this,"hero.HeroInfoP",p)||this}i.HeroInfoP=h,__reflect(h.prototype,"game.HeroInfoP");var d,u=(d=i.ProcessorBase,__extends(g,d),g.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N).updateHeroDict(t.heroList),i.GameMVC.heroMed.updateView(i.HeroMediator.SV.MAIN)},g);function g(){return d.call(this,"hero.HeroPutOnInfoP",g)||this}i.HeroPutOnInfoP=u,__reflect(u.prototype,"game.HeroPutOnInfoP");var f,_=(f=i.ProcessorBase,__extends(m,f),m.prototype.execute=function(e){var t=e.getBody();i.AppFacade.getInstance().retrieveProxy(i.HeroPy.N).updateHeroHistoryInfo(t.historyList)},m);function m(){return f.call(this,"hero.HeroHistoryListP",m)||this}i.HeroHistoryListP=_,__reflect(_.prototype,"game.HeroHistoryListP");var y,v=(y=i.ProcessorBase,__extends(T,y),T.prototype.execute=function(e){var t=e.getBody();i.GameMVC.heroPy.updateHeroDict(t.hero)},T);function T(){return y.call(this,"hero.SingleHeroInfoP",T)||this}i.SingleHeroInfoP=v,__reflect(v.prototype,"game.SingleHeroInfoP")}(game=game||{}),function(I){var t,e=(__extends(b,t=BaseProxy),b.prototype.addNotice=function(){var e=this;NoticeManager.registerCB([NT.HERO_ARTIFACT],this.checkHeroArtifactNotice,this),NoticeManager.registerCB([NT.HERO_ARTIFACT_RESONATE],this.checkHeroArtifactResonateNotice,this,MODULE.HeroArtifactResoante),NoticeManager.registerCB([NT.HERO_TREASURE],this.checkTreasureNotice,this),NoticeManager.registerCB([NT.HERO_UPSTAIR],this.checkUpstarNotice,this),NoticeManager.registerCB(NT.HERO_RESONATE_RESONATE,this.checkResonateNotice,this),NoticeManager.registerCB(NT.HERO_RESONATE_UNLOCK,this.checkResonateUnlockNotice,this,MODULE.HeroAwaken),NoticeManager.registerCB([NT.HERO_UPSECTION],this.checkUpSectionNotice,this),NoticeManager.registerCB(NT.HERO_EQUIP,this.checkHeroEquipNotice,this),NoticeManager.registerCB(NT.HERO_CAN_FORMATION,this.checkFormationNotice,this),NoticeManager.setChildType(NT.HERO_THING,[NT.HERO_ARTIFACT,NT.HERO_TREASURE]),NoticeManager.setChildType(NT.HERO_THING,NT.HERO_EQUIP),NoticeManager.setChildType(NT.HERO_THING,NT.HERO_ARTIFACT_RESONATE),NoticeManager.setChildType(NT.HERO_RESONATE,[NT.HERO_RESONATE_RESONATE,NT.HERO_RESONATE_UNLOCK]),NoticeManager.setChildType(NT.STAR_DOOR_ENTRANCE,[NT.GASHA_RACE_TIMES]),NoticeManager.setChildType(NT.GASHA_ENTRANCE,[NT.GASHA_FREE,NT.GASHA_HIGH_TIMES]),NoticeManager.registerCB(NT.GASHA_FREE,this.checkGashaNotice,this),NoticeManager.registerCB(NT.GASHA_HIGH_TIMES,function(){return e.checkGashaTimeRewardNotice(GashaponType.High)},this),NoticeManager.registerCB(NT.GASHA_RACE_TIMES,function(){return e.checkGashaTimeRewardNotice(GashaponType.Race)},this)},b.prototype.updateGashaInfo=function(e){(this.gashaponInfo[e.type]=e).type===GashaponType.High?NoticeManager.updateNotice(NT.GASHA_HIGH_TIMES):e.type===GashaponType.Race&&NoticeManager.updateNotice(NT.GASHA_RACE_TIMES)},b.prototype.GetUserGashaponInfos=function(){var t=this;Utils.Socket.send("gashapon","GetUserGashaponInfos",{}).then(function(e){e.infos.forEach(function(e){t.updateGashaInfo(e)})})},b.prototype.MakeProgressGashapon=function(){var t=this;Utils.Socket.send("gashapon","MakeProgressGashapon",{entryCode:3}).then(function(e){e.err||(t.updateGashaInfo(e.info),I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.GACHA),I.AppFacade.getInstance().showSubView(I.HeroMediator.N,I.HeroMediator.SV.GACHA_RESULT,{type:2,subType:0,result:e.clientReward,rewards:e.clientReward.heros,isGacha:!0}))}).catch(function(e){t.log(e)})},b.prototype.GetTimesRewards=function(e,t,i){var o=this;Utils.Socket.send("gashapon","GetTimesRewards",{type:e,code:t}).then(function(e){I.GameMVC.backpackPy.handleClientReward(e.clientReward),o.updateGashaInfo(e.info),i&&i()})},b.prototype.MakeGashapon=function(r){return __awaiter(this,void 0,void 0,function(){var t,o,i,n,a=this;return __generator(this,function(e){switch(e.label){case 0:if(!this.canMakeGasha)return[2];for(i in this.canMakeGasha=!1,t=I.Config.gashaponEntry(),o=0,t)if((n=t[i]).type==r.type&&n.subType==r.subType&&n.times==r.times){o=n.code;break}return o?[4,DragonBoneTools.preload("common_choukayingxiong")]:[3,2];case 1:return e.sent(),Utils.Socket.send("gashapon","MakeGashapon",{entryCode:o}).then(function(e){function t(){I.AppFacade.getInstance().showSubView(I.HeroMediator.N,I.HeroMediator.SV.GACHA_RESULT,{type:r.type,subType:r.subType,result:e.clientReward,rewards:e.rewardShow,entryCode:o,isGacha:!1})}if(a.updateGashaInfo(e.info),r.type!=GashaponType.Race?I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.GACHA):I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.STARDOOR),r.type!=GashaponType.Race&&r.type!=GashaponType.High||r.hideLeiShenEffect)t();else if(r.type==GashaponType.Race){var i=I.GameMVC.heroMed.getSubView(I.HeroMediator.SV.STARDOOR);i?i.playEffect(t):t()}else PopUpManager.addPopUp({obj:new I.HeroGachaResultEffectView({fromResult:r.fromResult,type:r.type}),dark:r.type==GashaponType.Race,clickDarkClose:!1,closeCB:t});NoticeManager.updateNotice(NT.GASHA_FREE,void 0,!0),r.type===GashaponType.High?NoticeManager.updateNotice(NT.GASHA_HIGH_TIMES,GashaponType.High):r.type===GashaponType.Race&&NoticeManager.updateNotice(NT.GASHA_RACE_TIMES,GashaponType.Race)}).catch(function(e){a.canMakeGasha=!0}),[3,3];case 2:Utils.MsgUtils.addMidMsg("没有code"),e.label=3;case 3:return[2]}})})},b.prototype.checkGashaNotice=function(){return!(!this.gashaponInfo[GashaponType.Lower]||!this.gashaponInfo[GashaponType.Lower].freeTimes)||!(!this.gashaponInfo[GashaponType.High]||!this.gashaponInfo[GashaponType.Lower].freeTimes)},b.prototype.checkGashaTimeRewardNotice=function(e){var t=this.gashaponInfo[e];if(!t)return!1;var i=I.Config.gashaponTimes();for(var o in i){var n=i[o];if(n.type==e&&t.hTimes>=n.times&&t.timesTargeted.indexOf(n.code)<0)return!0}return!1},b.prototype.updateHeroDict=function(e){var i=this;Array.isArray(e)||(e=[e]),e.forEach(function(e){if(i.allHeroByUuid[e.uuid])i.allHeroByUuid[e.uuid].update(e);else{var t=new I.HeroVO(e);i.allHeroByUuid[e.uuid]=t}i.heroUuid22Pos[e.uuid]?e.pos?e.pos!=i.heroUuid22Pos[e.uuid]&&(i.heroUuid22Pos[i.heroUuid22Pos[e.uuid]]==e.uuid&&delete i.heroUuid22Pos[i.heroUuid22Pos[e.uuid]],i.heroUuid22Pos[e.uuid]=e.pos,i.heroUuid22Pos[e.pos]=e.uuid):(i.heroUuid22Pos[i.heroUuid22Pos[e.uuid]]==e.uuid&&delete i.heroUuid22Pos[i.heroUuid22Pos[e.uuid]],delete i.heroUuid22Pos[e.uuid]):0!=e.pos&&(i.heroUuid22Pos[i.heroUuid22Pos[e.pos]]&&delete i.heroUuid22Pos[i.heroUuid22Pos[e.pos]],i.heroUuid22Pos[e.uuid]=e.pos,i.heroUuid22Pos[e.pos]=e.uuid)}),this.allHeroNum=Object.keys(this.allHeroByUuid).length,I.AppFacade.getInstance().sendNotification(CN.HERO_UPDATE),I.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE)},b.prototype.updateHeroHistoryInfo=function(e){var t=this;e.forEach(function(e){t.heroHistoryInfo[e.code]=e})},b.prototype.deteleByUuids=function(e){var i=this;e.forEach(function(e){if(delete i.allHeroByUuid[e],i.heroUuid22Pos[e]){var t=i.heroUuid22Pos[e];delete i.heroUuid22Pos[e],delete i.heroUuid22Pos[t]}}),this.allHeroNum-=e.length},b.prototype.updateResonateList=function(e){var o=this;this.resonateList={},e.forEach(function(e){var t=e.subType,i=e.order;o.resonateList[t]||(o.resonateList[t]=[]),o.resonateList[t].push(i)})},b.prototype.getActivatedHaloId=function(e,o){void 0===o&&(o=!1);var h,n=["slot1","slot2","slot3","slot4","slot5","slot6"];function t(e){var t=a[e];if(o==(t.haloType==HaloType.Chess)){var i=[];n.forEach(function(e){t[e]&&i.push(t[e])}),p.push({id:t.id,type:t.type,codes:i})}}h=o?I.Config.chessHero():I.Config.allHeroConfig();var a=I.Config.heroHaloConfig(),p=[];for(var i in a)t(i);var d=[];return e.forEach(function(e){for(var t=h[e]||I.Config.allPetConfig()[e],i=t.race,o=t.subProfession||t.profession,n=p.length;n--;){var a=p[n],r=a.id,s=a.type,c=a.codes,l=-1;s==HeroHaloType.Profession?l=c.indexOf(o):s==HeroHaloType.Race&&(l=c.indexOf(i)),-1<l&&c.splice(l,1),c.length||(d.push(r),p.splice(n,1))}}),d.sort(function(e,t){return e-t}),d},b.prototype.getHeroResonateOrders=function(e){var t=[];t=t.concat(e.resonate);var i=e.config.subType;return this.resonateList[i]&&(t=t.concat(this.resonateList[i])),t},b.prototype.checkJingYing=function(e){return e instanceof I.HeroVO?e.config.tier<3:I.Config.allHeroConfig()[e].tier<3},b.prototype.showCurHeroHalo=function(){for(var e=[],t=1;t<=6;t++){var i=this.heroUuid22Pos[t];i&&e.push(this.allHeroByUuid[i].config.code)}I.AppFacade.getInstance().showSubView(I.HeroMediator.N,I.HeroMediator.SV.HERO_HALO,{codeList:e})},b.prototype.GetHeroInfo=function(){var t=this;Utils.Socket.send("hero","GetHeroInfo",{}).then(function(e){t.updateHeroDict(e.heroList),t.HeroHistoryListlength=e.historyList.length,t.updateHeroHistoryInfo(e.historyList),t.updateResonateList(e.resonateList),I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.MAIN)})},b.prototype.HeroPutOn=function(t){var i=this;Utils.Socket.send("hero","HeroPutOn",{uuid:t.uuid,pos:t.pos}).then(function(e){i.updateHeroDict(e.heroList),I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.MAIN,{uuid:t.uuid,upstarData:{}})})},b.prototype.HeroChangeFormation=function(e){var t=this;Utils.Socket.send("hero","HeroChangeFormation",{formation:JSON.stringify(e)}).then(function(e){t.updateHeroDict(e.heroList)})},b.prototype.HeroUpGrade=function(o){var n=this;Utils.Socket.send("hero","HeroUpGrade",{uuid:o.uuid,num:o.num}).then(function(e){function t(e){for(var t=JSON.parse(e.attr),i={},o=1;o<=4;o++)i[o]=t[o];return i}n.waitingServOper.upgrade=!1;var i=t(n.allHeroByUuid[o.uuid]);n.updateHeroDict(e.hero),I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.MAIN),o.cb&&o.cb(i,t(n.allHeroByUuid[o.uuid]))}).catch(function(e){n.waitingServOper.upgrade=!1})},b.prototype.HeroUpStar=function(n,e){var a=this;if(void 0===e&&(e=!0),e){var t=[];n.uuidInfos.forEach(function(e){t.push(e.uuid)});var i=I.GameMVC.backpackPy.checkMultiTeamTips(t);i?I.GameMgr.getInstance().showCommonTipsWin({commonTips:"选中的英雄中"+i.name+"在"+i.teamModuleName+"上阵，是否作为材料消耗？",clickCB:function(e){1==e.type&&a.HeroUpStar(n,!1)}}):this.HeroUpStar(n,!1)}else Utils.Socket.send("hero","HeroUpStar",{uuid:n.uuid,uuidInfos:n.uuidInfos}).then(function(e){var t=a.allHeroByUuid[n.uuid],i={code:t.code,sectionLevel:t.sectionLevel,attr:JSON.parse(t.attr),skillList:t.skillList},o={code:e.hero.code,sectionLevel:e.hero.sectionLevel,attr:JSON.parse(e.hero.attr),skillList:e.hero.skillList};n.cb&&n.cb(i,o),a.updateHeroDict(e.hero),egret.setTimeout(function(){I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.MAIN,{upstarData:{}}),PopUpManager.addPopUp({obj:new I.HeroUpResultPanel({oldData:i,newData:o,type:"HeroUpStar"})})},a,1e3)})},b.prototype.UpHeroDefend=function(t,e){var i=this;if(void 0===e&&(e=!0),e){var o=[];t.uuidInfos.forEach(function(e){o.push(e.uuid)});var n=I.GameMVC.backpackPy.checkMultiTeamTips(o);n?I.GameMgr.getInstance().showCommonTipsWin({commonTips:"选中的英雄中"+n.name+"在"+n.teamModuleName+"上阵，是否作为材料消耗？",clickCB:function(e){1==e.type&&i.UpHeroDefend(t,!1)}}):this.UpHeroDefend(t,!1)}else Utils.Socket.send("hero","UpHeroDefend",{uuid:t.uuid,uuidInfos:t.uuidInfos}).then(function(e){i.updateHeroDict(e.hero),I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.MAIN,{upstarData:{}}),t.cb&&t.cb()}).catch(function(e){})},b.prototype.HeroUpSection=function(n){var a=this;Utils.Socket.send("hero","HeroUpSection",{uuid:n.uuid}).then(function(e){var t=a.allHeroByUuid[n.uuid],i={code:t.code,sectionLevel:t.sectionLevel,attr:JSON.parse(t.attr),skillList:t.skillList},o={code:e.hero.code,sectionLevel:e.hero.sectionLevel,attr:JSON.parse(e.hero.attr),skillList:e.hero.skillList};a.updateHeroDict(e.hero),I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.MAIN),I.AppFacade.getInstance().hideSubView(I.HeroMediator.N,I.HeroMediator.SV.SECTION),PopUpManager.addPopUp({obj:new I.HeroUpResultPanel({oldData:i,newData:o,type:"HeroUpSection",heroCode:e.hero.code})})})},b.prototype.HeroResonate=function(t){var i=this;Utils.Socket.send("hero","HeroResonate",{uuid:t.uuid,order:t.order}).then(function(e){i.updateHeroDict(e.hero),i.updateResonateList(e.resonateList),I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.MAIN),t.cb&&t.cb()})},b.prototype.UnlockHeroResonate=function(t,e){var i=this;if(void 0===e&&(e=!0),e){var o=I.GameMVC.backpackPy.checkMultiTeamTips(t.uuids);o?I.GameMgr.getInstance().showCommonTipsWin({commonTips:"选中的英雄中"+o.name+"在"+o.teamModuleName+"上阵，是否作为材料消耗？",clickCB:function(e){1==e.type&&i.UnlockHeroResonate(t,!1)}}):this.UnlockHeroResonate(t,!1)}else Utils.Socket.send("hero","UnlockHeroResonate",{uuid:t.uuid,level:t.level,uuids:t.uuids}).then(function(e){i.updateHeroDict(e.hero),I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.MAIN),DragonBoneTools.playOnce({effectName:"common_jxcg",parent:GameRootLayer.gameLayer().popMsgLayer}),t.cb&&t.cb(e)})},b.prototype.HeroPractice=function(t,e){var i=this;if(void 0===e&&(e=!0),e){var o=I.GameMVC.backpackPy.checkMultiTeamTips(t.uuids);o?I.GameMgr.getInstance().showCommonTipsWin({commonTips:"选中的英雄中"+o.name+"在"+o.teamModuleName+"上阵，是否作为材料消耗？",clickCB:function(e){1==e.type&&i.HeroPractice(t,!1)}}):this.HeroPractice(t,!1)}else Utils.Socket.send("hero","HeroPractice",{uuid:t.uuid}).then(function(e){i.updateHeroDict(e.hero),I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.MAIN),DragonBoneTools.playOnce({effectName:"common_xlcg",parent:GameRootLayer.gameLayer().popMsgLayer}),t.cb&&t.cb(e)})},b.prototype.HeroOneKeyPutOn=function(e,i){var o=this,t=I.GameMVC.heroThingPy.AllEquipInfo,n=!1;for(var a in t)if(!t[a].heroUuid){n=!0;break}n?Utils.Socket.send("hero","HeroOneKeyPutOn",{uuid:e}).then(function(e){o.updateHeroDict(e.hero);var t=I.AppFacade.getInstance().retrieveProxy(I.HeroThingPy.N);t.updateEquipInfo(e.heroEquipList),t.updateArtifactInfo(e.heroArtifactList),t.updateTreasureInfo(e.treasureList),t.updateImmortalInfo(e.immortalList,!1),I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.MAIN),i&&i()}):Utils.MsgUtils.addMidMsg("暂无可穿戴装备")},b.prototype.HeroOneKeyPutDown=function(e){var i=this,t=I.GameMVC.heroThingPy.AllEquipInfo,o=!1;for(var n in t)if(t[n].heroUuid==e){o=!0;break}o?Utils.Socket.send("hero","HeroOneKeyPutDown",{uuid:e}).then(function(e){i.updateHeroDict(e.hero);var t=I.AppFacade.getInstance().retrieveProxy(I.HeroThingPy.N);t.updateEquipInfo(e.heroEquipList),t.updateArtifactInfo(e.heroArtifactList),t.updateTreasureInfo(e.treasureList),t.updateImmortalInfo(e.immortalList,!1),I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.MAIN)}):Utils.MsgUtils.addMidMsg("暂无可卸下装备")},b.prototype.getReplaceInfo=function(){var t=this;Utils.Socket.send("replacement","GetReplaceInfo",{}).then(function(e){e.info&&e.info.uuid&&t.affirmReplaceHero({uuid:e.info.uuid,isReplace:!0,isInit:!0})}).catch(function(e){})},b.prototype.replaceHero=function(e){var t=this;Utils.Socket.send("replacement","ReplaceHero",{uuid:e.uuid}).then(function(e){t.replaceHeroInfo={uuid:e.info.uuid,code:e.info.code},I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.HERO_REPLACEMENT,{costs:e.clientCost,isReplace:!0,effect:I.HeroReplacementView.EFFECT_TYPE.CHENGGONG}),t.affirmReplaceHero({uuid:e.info.uuid,isReplace:!0})}).catch(function(e){})},b.prototype.affirmReplaceHero=function(a){var r=this;Utils.Socket.send("replacement","AffirmReplaceHero",{uuid:a.uuid,isReplace:a.isReplace}).then(function(e){if(!a.isInit){var t=e.info&&e.info.uuid,i=e.info&&e.info.code;r.replaceHeroInfo={uuid:t,code:i};var o=!0===a.isReplace?e.clientReward.heros[0]:{uuid:a.uuid},n=!0===a.isReplace?I.HeroReplacementView.EFFECT_TYPE.QIAN:I.HeroReplacementView.EFFECT_TYPE.CHENGGONG;egret.setTimeout(function(){I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.HERO_REPLACEMENT,{hero:o,effect:n}),I.AppFacade.getInstance().updateView(I.HeroMediator.N,I.HeroMediator.SV.STARDOOR)},r,750),Utils.MsgUtils.addMidMsg("英雄置换成功")}}).catch(function(e){})},b.prototype.HeroRollback=function(t){Utils.Socket.send("hero","HeroRollback",{uuid:t.uuid}).then(function(e){t.cb(function(){I.AppFacade.getInstance().retrieveProxy(I.BackpackPy.N).handleClientReward(e.clientReward)})}).catch(function(e){})},b.prototype.HeroRollbackPreview=function(t){Utils.Socket.send("hero","HeroRollbackPreview",{uuid:t.uuid}).then(function(e){I.AppFacade.getInstance().showSubView(I.CommonMediator.N,I.CommonMediator.SV.REWARD_PANEL,{title:"奖励",rewards:e.rewardPreview,btnText:"确定",type:I.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN}),t.cb&&t.cb()}).catch(function(e){})},b.prototype.ActiveArtifactResonate=function(t){var i=this;Utils.Socket.send("hero","ActiveArtifactResonate",{uuid:t.uuid,color:t.color}).then(function(e){i.updateHeroDict(e.hero),t.cb&&t.cb()}).catch(function(e){})},b.prototype.checkFormationNotice=function(e){if(this.heroUuid22Pos[e]||!Utils.UnlockMgr.checkPass(e,!1).allow)return!1;for(var t in this.allHeroByUuid)if(!this.allHeroByUuid[t].pos)return!0},b.prototype.checkUpSectionNotice=function(e){if(!e)return!1;var t=e.config,i=I.Config.heroAndPetSectionConfig()[e.sectionLevel+1];if(e.level==t.maxLevel)return!1;var o=e.config;if(e.level!=Math.min(o.maxLevel,i&&i.level||9999999))return!1;var n=JSON.parse(i.costs);return!!I.AppFacade.getInstance().retrieveProxy(I.BackpackPy.N).checkEnough(n,!1)},b.prototype.checkResonateNotice=function(e){var n=this;if(!e)return!1;var t=e.resonateLevelList[e.resonateLevelList.length-1]||0,i=I.Config.heroResonateConfig(e.config.subType,t),a=this.getHeroResonateOrders(e),r=!1;return i.forEach(function(e){var t=0<=a.indexOf(e.order),i=JSON.parse(e.heroId),o=!0;i.forEach(function(e){n.heroHistoryInfo[e]||(o=!1)}),r=r||!t&&o}),r},b.prototype.checkResonateUnlockNotice=function(t){if(!t)return!1;var e=t.resonateLevelList[t.resonateLevelList.length-1]||0;if(this.getHeroResonateOrders(t).length<4*(e+1))return!1;var i=t.config.subType,o=I.Config.heroPracticeConfig(t.config.subType,e),n=void 0;if(!o.length)return!1;if(o.some(function(e){if(e.order===t.practiceLevel+1)return n=e,!0})){if(t.config.initStar<n.starLevel)return!1;if(!I.GameMVC.backpackPy.checkEnough(JSON.parse(n.costs)))return!1}else{var a=I.Config.heroResonateLevelConfig(i,e+1);if(t.config.initStar<a.starLevel)return!1;var r=a.selfNum,s=0;for(var c in this.allHeroByUuid){var l=this.allHeroByUuid[c];if(!l.pos&&l.uuid!=t.uuid&&l.config.subType===i&&5===l.config.initStar&&!l.isLocked&&(s+=1)===r)break}if(s<r)return!1;if(!I.GameMVC.backpackPy.checkEnough(JSON.parse(a.costs)))return!1}return!0},b.prototype.checkHeroEquipNotice=function(e){if(!e||!e.info)return!1;var t=e.info.uuid,i=I.AppFacade.getInstance().retrieveProxy(I.HeroThingPy.N).AllEquipInfo,o=I.Config.getHeroEquipConfig();if(!Utils.UnlockMgr.checkPass(MODULE.HeroEquip,!1).allow)return!1;var n=e.type,a=0,r=-1;for(var s in i){var c,l=i[s];l.type==n&&l.heroUuid==t&&(r=(c=o[l.code])&&c.color),l.type!=n||l.heroUuid||(c=o[l.code])&&(a=c.color>a?c.color:a)}return 0<a&&r<a},b.prototype.checkHeroArtifactNotice=function(e){if(!e)return!1;if(I.Config.getHeroArtifactUnlockLevel(),!Utils.UnlockMgr.checkPass(MODULE.HeroArtifact,!1).allow)return!1;var t=e.uuid,i=I.AppFacade.getInstance().retrieveProxy(I.HeroThingPy.N).AllArtiInfo,o=I.Config.getHeroArtifactConfig(),n=0,a=-1,r=void 0;for(var s in i){var c,l=i[s];l.heroUuid==t&&(a=(c=o[l.code])&&c.color,r=l),l.heroUuid||(c=o[l.code])&&c.type==HeroArtifactType.Normal&&e.level>=c.putOnLevel&&(n=c.color>n?c.color:n)}if(0<n&&a<n)return!0;if(r&&!r.additionRace){var h=o[r.code],p=I.Config.heroArtifactAdditon()[h.subType];if(p){var d=JSON.parse(p.costs);if(I.GameMVC.backpackPy.checkEnough(d,!1))return!0}}return!1},b.prototype.checkHeroArtifactResonateNotice=function(e){var t=e.heroInfo,i=!1;if(!e.inTab){var o=I.GameMVC.heroThingPy.getHeroArtifactByHeroUuid(t.uuid);if(o.length){var n=o[0].config.color,a=I.Config.heroArtifactResonate(t.config.subType);for(var r in a){var s=a[r];if(s.color<=n&&t.artifactResonate.indexOf(s.color)<0){i=!0;break}}}}return i},b.prototype.checkTreasureNotice=function(e){if(!e)return!1;if(!Utils.UnlockMgr.checkPass(MODULE.Treasure,!1).allow)return!1;var t,i=e.uuid,o=I.AppFacade.getInstance().retrieveProxy(I.HeroThingPy.N).AllTreasureInfo;for(var n in o){var a=o[n];a.heroUuid==i&&(t=a)}if(t){var r=!1;for(var n in TreasureJewelType){var s=TreasureJewelType[n];if(!(d=I.Config.getTreasureLockInfo(s,e.level))){var c=t.jewelLevel&&t.jewelLevel[s]||0,l=I.Config.getTreasureJewelUpgradeConfig(s);if(!l[0<=c?c:0])return!1;var h=l[c+1];if(h){var p=JSON.parse(h.costs);r=r||I.AppFacade.getInstance().retrieveProxy(I.BackpackPy.N).checkEnough(p)}}}return r}var d=I.Config.getHeroTreasureUnlockLevel();return e.level>=d},b.prototype.checkUpstarNotice=function(a,l){if(void 0===l&&(l={}),!a)return!1;var r=I.Config.allHeroConfig();if(!r[a.code])return!1;if(r[a.code].initStar<=3)return!1;var s=I.AppFacade.getInstance().retrieveProxy(b.N),h=s.allHeroByUuid,e=I.Config.heroAndPetUpstarConfig()[a.code],p=!0;if(e){var t=e.level;if(I.AppFacade.getInstance().retrieveProxy(I.PlayerPy.N).playerInfoVO.level<t)return!1;var i=JSON.parse(e.fiveSlotCosts);if(0<i.length&&!I.AppFacade.getInstance().retrieveProxy(I.BackpackPy.N).checkEnough(i[1],!1))return!1;_=[];var d=[];for(var o in y=["oneSlotCosts","twoSlotCosts","threeSlotCosts","fourSlotCosts"])v=y[o],l[parseInt(o)+1]={condition:e[v],uuids:[],full:!1},_.push(JSON.parse(e[v])),d.push(0);var u=0;function n(e){var i=parseInt(e)+1,t=_[e];if(0==t.length)return"continue";if(E&&2==t[0]&&t[1][1]==E){if(d[e]<t[1][3]+u[2])return p=!1,"break";function o(e){var t=l[i].uuids[e];l[1].uuids.some(function(e){return e==t})||n.push(t)}var n=[];for(var a in l[i].uuids)o(a);var r={};for(var s in h){var c=h[s];r[c.code]||(r[c.code]=0),r[c.code]++}r[u[1]]&&(r[u[1]]-=u[2]),n.sort(function(e,t){return r[h[e].code]-r[h[t].code]}),n=n.slice(0,t[1][3]),l[i].uuids=n}else if(1==t[0]){if(d[e]<t[1][2])return p=!1,"break";l[i].uuids&&(l[i].uuids=l[i].uuids.slice(0,t[1][2]))}else{if(d[e]<t[1][3])return p=!1,"break";l[i].uuids&&(l[i].uuids=l[i].uuids.slice(0,t[1][3]))}}for(var o in _.forEach(function(e){1==e[0]&&(u=e[1][0],e[1]=e[1][0])}),_.forEach(function(e,t){if(0<e.length)for(var i in h){var o=h[i];if(i!=a.uuid&&!s.heroUuid22Pos[i]&&!o.isLocked)if(1==e[0])o.code==e[1][1]&&(d[t]++,l[t+1]&&l[t+1].uuids||(l[t+1]={},l[t+1].uuids=[]),l[t+1].uuids.push(o.uuid));else if(2==e[0]){var n=r[o.code];0!=e[1][0]&&n.race!=e[1][0]||0!=e[1][1]&&o.starLevel!=e[1][1]||0!=e[1][2]&&n.profession!=e[1][2]||(d[t]++,l[t+1]&&l[t+1].uuids||(l[t+1]={},l[t+1].uuids=[]),o.code!=u[1]?l[t+1].uuids.push(o.uuid):l[t+1].uuids.unshift(o.uuid))}}}),E=u&&r[u[1]].initStar,_)if("break"===n(o))break;if(p)for(var o in l)(v=l[o]).full=!0}else{if(15!=a.config.initStar)return!1;if(!(Utils.UnlockMgr.checkPass(MODULE.HeroDefend,!1).allow&&a.defendLevel<4))return!1;var c=I.Config.heroDefendConfig(a.config.subType);if(!(0<c.length))return!1;var g=void 0;for(var o in c)c[o].level==a.defendLevel+1&&(g=c[o]);var f=JSON.parse(g.fiveSlotCosts);if(0<f.length&&!I.AppFacade.getInstance().retrieveProxy(I.BackpackPy.N).checkEnough(f[1],!1))return!1;var _=[],m=[],y=["oneSlotCosts","twoSlotCosts","threeSlotCosts","fourSlotCosts"];for(var o in y){var v=y[o];l[parseInt(o)+1]={condition:g[v],uuids:[],full:!1},_.push(JSON.parse(g[v])),m.push(0)}var T=0;function C(e){var i=parseInt(e)+1,t=_[e];if(0==t.length)return"continue";if(E&&3==t[0]&&t[1][2]==E){if(m[e]<t[1][2]+T[2])return p=!1,"break";function o(e){var t=l[i].uuids[e];l[1].uuids.some(function(e){return e==t})||n.push(t)}var n=[];for(var a in l[i].uuids)o(a);var r={};for(var s in h){var c=h[s];r[c.code]||(r[c.code]=0),r[c.code]++}r[T[1]]&&(r[T[1]]-=T[2]),n.sort(function(e,t){return r[h[e].code]-r[h[t].code]}),n=n.slice(0,t[1][2]),l[i].uuids=n}else if(1==t[0]){if(m[e]<t[1][2])return p=!1,"break";l[i].uuids&&(l[i].uuids=l[i].uuids.slice(0,t[1][2]))}else if(2==t[0]){if(m[e]<t[1][3])return p=!1,"break";l[i].uuids&&(l[i].uuids=l[i].uuids.slice(0,t[1][3]))}else if(3==t[0]){if(m[e]<t[1][2])return p=!1,"break";l[i].uuids&&(l[i].uuids=l[i].uuids.slice(0,t[1][2]))}}_.forEach(function(e){1==e[0]&&(T=e[1][0],e[1]=e[1][0])}),_.forEach(function(e,t){if(0<e.length)for(var i in h){var o=h[i];if(i!=a.uuid&&!s.heroUuid22Pos[i]&&!o.isLocked)if(1==e[0])o.code==e[1][1]&&(m[t]++,l[t+1]&&l[t+1].uuids||(l[t+1]={},l[t+1].uuids=[]),l[t+1].uuids.push(o.uuid));else if(2==e[0]){var n=r[o.code];0!=e[1][0]&&n.race!=e[1][0]||0!=e[1][1]&&o.starLevel!=e[1][1]||0!=e[1][2]&&n.profession!=e[1][2]||(m[t]++,l[t+1]&&l[t+1].uuids||(l[t+1]={},l[t+1].uuids=[]),o.code!=T[1]?l[t+1].uuids.push(o.uuid):l[t+1].uuids.unshift(o.uuid))}else 3==e[0]&&(n=r[o.code],e[1][1]==n.initStar&&e[1][0]==n.color&&m[t]++,l[t+1]&&l[t+1].uuids||(l[t+1]={},l[t+1].uuids=[]),o.code!=T[1]?l[t+1].uuids.push(o.uuid):l[t+1].uuids.unshift(o.uuid))}});var E=T&&r[T[1]].initStar;for(var o in _)if("break"===C(o))break;if(p)for(var o in l)(v=l[o]).full=!0}return p},b.prototype.getMaxLevelByCodeAndSection=function(e,t){var i=I.Config.allHeroConfig()[e],o=I.Config.heroAndPetSectionConfig()[t+1];if(!i)return 0;var n=i.maxLevel;return o&&(n=n<o.level?n:o.level),n},b.N="HeroPy",b);function b(){var e=t.call(this,b.N)||this;return e.allHeroNum=0,e.canMakeGasha=!0,e.gashaponInfo={},e.allHeroByUuid={},e.heroUuid22Pos={},e.heroHistoryInfo={},e.resonateList={},e.replaceHeroInfo={uuid:void 0,code:void 0},e.waitingServOper={},e.addNotice(),e}I.HeroPy=e,__reflect(e.prototype,"game.HeroPy")}(game=game||{}),function(e){var t=(Object.defineProperty(i.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){this._fontSize=e,this.p.style.fontSize=this._fontSize+"px"},enumerable:!0,configurable:!0}),i.prototype.setValue=function(e){this.p.style.display="inline",this.p.innerHTML=e},i.prototype.setPosition=function(e,t,i,o){var n=document.body.clientWidth/Utils.DeviceUtils.curWidth(),a=document.body.clientHeight/Utils.DeviceUtils.curHeight();this.p.style.left=e*n+"px",this.p.style.top=t*a-this.fontSize+"px",this.p.style.width=i*n+"px",this.p.style.height=o*a+"px",this.p.style.display="inline"},i.prototype.show=function(){this.p&&(this.p.style.display="inline")},i.prototype.hide=function(){this.p&&(this.p.style.display="none")},i.prototype.remove=function(){var e=document.getElementById("gameDiv");this.p.parentNode==e&&e.removeChild(this.p)},i);function i(){this._fontSize=18;var e=document.getElementById("gameDiv");this.p=document.createElement("p"),e.appendChild(this.p),this.p.style.border="0px",this.p.style.backgroundColor="transparent",this.p.style.position="absolute",this.p.style.fontSize=this.fontSize+"px",this.p.style.display="none",this.p.style.color="#000000",this.p.style.textAlign="center"}e.HTMLText=t,__reflect(t.prototype,"customui.HTMLText")}(customui=customui||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.lv_desc.itemRenderer=a,this.commonTanKuang.onCloseCB=function(){e.hide()}},o.prototype.updateView=function(e,t){if(void 0===t&&(t=!1),this.info=e,this.commonTanKuang.blb_title.text=this.info.title,this.info.config){var i=[];for(var o in this.info.config){var n=this.info.config[o];i.push({c:n,totalLevel:this.info.totalLevel})}this.lv_desc.dataProvider=new eui.ArrayCollection(i),e&&e.bottomText&&(this.lb_bottom_desc.text=e.bottomText)}},o);function o(){var e=i.call(this)||this;return e.skinName="CommonLevelMasterPanelSkin",e}t.CommonLevelMasterPanel=e,__reflect(e.prototype,"game.CommonLevelMasterPanel");var n,a=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this)},r.prototype.dataChanged=function(){n.prototype.dataChanged.call(this);var e=JSON.parse(this.data.c.attr)[0];this.lb_prefix.text="总等级"+this.data.c.level+"级",this.lb_suffix.text="上阵英雄"+t.GeneralConfig.getAttrName(e[0])+"+"+t.GeneralConfig.getAttrValue(e[1]).toString(),this.data.totalLevel<this.data.c.level?(this.lb_prefix.textColor=16777215,this.img_bg.source="shenbing_img_weijihuo_png"):(this.lb_prefix.textColor=15587767,this.img_bg.source="shenbing_img_yijihuo_png")},r);function r(){var e=n.call(this)||this;return e.skinName="CommonLevelMasterListItemRenderSkin",e}__reflect(a.prototype,"CommonLevelMasterListItemRender")}(game=game||{}),function(s){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.initList(),this.rootPanel.onCloseCB=function(){e.hide()},this.rootPanel.blb_title.text="圣物羁绊"},i.prototype.initList=function(){this.list_item.itemRenderer=n},i.prototype.updateView=function(e){this.heroVO=e&&e.vo||this.heroVO,this.config=s.Config.heroArtifactResonate(this.heroVO.config.subType),this.updateList()},i.prototype.updateList=function(){var o=this,n=0,e=s.GameMVC.heroThingPy.getHeroArtifactByHeroUuid(this.heroVO.uuid);function t(e){var t=r.config[e],i={config:t,info:r.heroVO,curColor:n,activated:0<=r.heroVO.artifactResonate.indexOf(t.color),func:function(){s.GameMVC.heroPy.ActiveArtifactResonate({uuid:o.heroVO.uuid,color:t.color,cb:function(){DragonBoneTools.playOnce({effectName:"common_ty_jihuo",parent:GameRootLayer.gameLayer().popMsgLayer}),o.updateView(),NoticeManager.updateNotice([NT.HERO_ARTIFACT_RESONATE],{heroInfo:o.heroVO},!0)}})}};a.push(i)}e.length&&(n=e[0].config.color);var a=[],r=this;for(var i in this.config)t(i);this.list_item.dataProvider=new eui.ArrayCollection(a)},i);function i(){var e=t.call(this)||this;return e.skinName="HeroArtifactResonateSkin",e}s.HeroArtifactResonatePanel=e,__reflect(e.prototype,"game.HeroArtifactResonatePanel");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_activate,egret.TouchEvent.TOUCH_TAP,function(){e.data.func()},this)},a.prototype.dataChanged=function(){var e=this.data.config,t=e.color;this.img_frame.source=COLOR_2_FRAME[t],this.img_icon.source="jiban_img_huizhang0"+(t-1)+"_png",this.lb_title.text="穿戴"+COLOR_CONFIG[t].name+"品质以上的圣物";var i="";JSON.parse(e.attr).forEach(function(e){i+=AttrConfig[e[0]].name+"+"+s.GeneralConfig.getAttrValue(e[1])+"  "}),this.lb_attr.text=i,this.data.activated?(this.btn_activate.scaleX=this.btn_activate.scaleY=1,this.btn_activate.skinName="skins.ButtonSkinSure",this.btn_activate.label="已激活",this.btn_activate.enabled=!1,UIActionManager.setAbsGrey(this.btn_activate,!1)):(this.btn_activate.scaleX=this.btn_activate.scaleY=.85,this.btn_activate.skinName="skins.ButtonSkinYellow",this.btn_activate.label="激活",this.btn_activate.enabled=this.data.curColor>=t,UIActionManager.setAbsGrey(this.btn_activate,this.data.curColor<t))},a);function a(){var e=o.call(this)||this;return e.skinName="HeroArtifactResonatePanel_ListItem",e}__reflect(n.prototype,"HeroArtifactResonatePanel_ListItem")}(game=game||{}),function(T){var i,n=(i=T.CommonComment,__extends(e,i),e.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_msg),this.btn_zan.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.dianZan(e)},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.skill_panel.visible=!1,this.tinput_text.textDisplay.size=24,this.initMidView(),this.initBottomView(),this.timer=egret.setInterval(function(){t.getPlayerTuphero()},this,3e4)},e.prototype.updateView=function(e){var t=e&&e.info;this.params=T.Config.allHeroConfig()[t.code],this.playerStatus(),this.getPlayerTuphero(),this.once(egret.Event.ENTER_FRAME,this.initTopView,this)},e.prototype.playerStatus=function(){var t=this,e=T.AppFacade.getInstance().retrieveProxy(T.LoginPy.N);Utils.Http.toGet({action:"get_HeroStatus",code:this.params.subType,player_id:e.playerProxy.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,project:Utils.agentConfig.ProjectName}).then(function(e){t.lb_zanCounts.text=""+e.num,t.zanNumber=e.num,t.isZan=e.status}).catch(function(e){console.log("----get_HeroStatus",e)})},e.prototype.initTopView=function(){this.lb_title.text=this.params.name,this.hero_model.update({isStatic:!0,code:this.params.code,model:this.params.model}),this.hero_model.scaleX=this.hero_model.scaleY=.75,this.lb_profession.text=ProfessionConfig[this.params.profession].name,this.img_race.source=HeroRaceConfig[this.params.race].raceIconBig,this.img_profession_icon.source=ProfessionConfig[this.params.profession].icon,this.lb_desc.text="    "+this.params.desc,this.lb_lv.text=this.params.maxLevel+"/"+this.params.maxLevel,this.lb_zanCounts.text=this.zanNumber.toString();var e=T.GeneralConfig.getHeroStarInfo(this.params.initStar);if(this.gp_stars.removeChildren(),e.stage<4)for(var t=0;t<e.num;t++){var i=new eui.Image(e.src);i.scaleX=i.scaleY=.67,this.gp_stars.addChild(i)}else this.gp_stars.addChild(new customui.HighStarLevelIcon({num:e.num,scale:.7}));for(t=1;t<=5;t++){var o=this["skill"+t];this.bindSkillPanelClick({target:o,x:34,bottom:t<4?200:132})}this.updateAttr(),this.updateHeroBaseInfo()},e.prototype.updateHeroBaseInfo=function(){this.gp_skill.visible=!0;for(var e=JSON.parse(this.params.skillUnlock),t=this.sectionConfig&&this.sectionConfig.id||0,i=1;i<=5;i++){var o=SKILL_CODE[i],n=this["skill"+i];if(o){var a={code:this.params[o],unlock:t>=e[i]};this["skill"+i].updateItem(a)}else this["skill"+i].updateItem()}for(i=1;i<=5;i++)n=this["skill"+i],this.bindSkillPanelClick({target:n,x:34,bottom:i<4?130:73})},e.prototype.bindSkillPanelClick=function(t){var i=this,o=t.target;o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){if(o.data&&o.data.code)for(var e in i.skill_panel.visible=!0,i.skill_panel.updateItem({code:o.data.code}),t)"target"!=e&&(i.skill_panel[e]=t[e])},this),o.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skill_panel.visible=!1},this),o.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skill_panel.visible=!1},this),o.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skill_panel.visible=!1},this)},e.prototype.dianZan=function(e){0==this.isZan?(Utils.MsgUtils.addNumberEffect("+1",this.btn_zan,e.stageX,e.stageY,1),this.thumbsUp()):Utils.MsgUtils.addMidMsg("已赞过此英雄")},e.prototype.updateAttr=function(){var e=T.Config.heroAndPetSectionConfig(this.params.type==EEntityType.EEntityTypePet),t=this.params.maxLevel;for(var i in e){var o=e[i];t>parseInt(o.level)&&(this.sectionConfig=o)}var n=T.Config.heroAndPetUpstarConfig(this.params.type==EEntityType.EEntityTypePet)[this.params.code],a=[],r=JSON.parse(this.params.baseAttr),s=JSON.parse(this.params.upAttr),c=this.sectionConfig&&JSON.parse(this.sectionConfig.attr)||[];if(a=T.GeneralConfig.AttrAddAttr(a,r),s=T.GeneralConfig.AttrMutilAttr(s,parseInt(this.params.maxLevel)-1),a=T.GeneralConfig.AttrAddAttr(a,s),a=T.GeneralConfig.AttrAddAttr(a,c),n){var l=n&&JSON.parse(n.upAttr);a=T.GeneralConfig.AttrMutilAttr(a,l)}this.params.posSkill1,this.params.posSkill2,this.params.posSkill3;for(var h=T.Config.skillBaseConfig(),p=[],d=[],u=JSON.parse(this.params.skillUnlock),g=this.sectionConfig&&this.sectionConfig.id||0,f=1;f<=5;f++){var _=SKILL_CODE[f-1];if(_&&this.params[_]){var m=this.params[_];if(g>=u[f-1]){var y=h[m];if(y){var v=JSON.parse(y.attr);for(var i in v)1e5<=(o=v[i])[1]?p=T.GeneralConfig.AttrAddAttr(p,[o]):d=T.GeneralConfig.AttrAddAttr(d,[o])}}}}for(var i in a=T.GeneralConfig.AttrAddAttr(a,p),a=T.GeneralConfig.AttrAddAttr(a,d))a[i][1]=Math.floor(a[i][1]);for(a.sort(function(e,t){return e[0]-t[0]}),this.gp_upgrade_attr.removeChildren(),f=1;f<=4;f++)this.gp_upgrade_attr.addChild(new T.HeroMainView_AttrItem({type:f,num:a[f-1][1]}))},e.prototype.thumbsUp=function(){var t=this,e=T.AppFacade.getInstance().retrieveProxy(T.PlayerPy.N);Utils.Http.toGet({action:"set_HerothumbsUp",moduleType:EEntityType.EEntityTypeHero,code:this.params.subType,player_id:e.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,project:Utils.agentConfig.ProjectName,server_id:this.loginProxy.serverSelect.s_id,area:this.loginProxy.serverSelect.area}).then(function(e){console.log("set_HerothumbsUp"+e),t.playerStatus()}).catch(function(e){console.log("set_HerothumbsUp"+e)})},e.prototype.initMidView=function(){this.list=new eui.List;var e=new eui.TileLayout;e.horizontalGap=5,e.requestedColumnCount=1,this.list.layout=e,this.list.itemRenderer=t,this.sl_center.viewport=this.list,this.sl_center.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_center.scrollPolicyV=eui.ScrollPolicy.AUTO},e.prototype.initBottomView=function(){this.btn_send.addEventListener(egret.TouchEvent.TOUCH_TAP,this.playerTupHero,this)},e.prototype.playerTupHero=function(){Utils.MsgUtils.addMidMsg("评论功能维护中")},e.prototype.getPlayerTuphero=function(s){var c=this;if(s&&0<this.array.length&&s.type==e.commentType.DIANZAN)return s.info,this.array.sort(function(e,t){return c.sortByTime(e,t)}),this.sortByLike(),void this.list.dataProvider.replaceAll(this.array);Utils.Http.toGet({action:"get_PlayerTup_hero",code:this.params.subType,player_id:this.playerPy.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,project:Utils.agentConfig.Project}).then(function(e){for(var t in c.commentNum=0,c.array=[],e)if(e[t].content&&e[t].player_id&&e[t].name){++c.commentNum;var i={code:c.params.subType,id:e[t].player_id,name:e[t].name,head:e[t].head,content_id:t,content:e[t].content,num:Number(e[t].num),tup_player:e[t].tup_player,time:e[t].createTime,strTime:Number(e[t].strTime),serverId:e[t].area};c.array.push(i)}if(c.array.sort(function(e,t){return c.sortByTime(e,t)}),c.origin_arr.length<=0)for(var o=0,n=c.array;o<n.length;o++)t=n[o],c.origin_arr.push(t),c.commonArr.push(t);if(c.newArr=[],c.origin_arr.length!=c.array.length)for(var a=c.array.length-c.origin_arr.length,r=0;r<a;)c.newArr.push(c.array[r]),++r;s&&s.priority?c.commentsFloatingEffect({priority:s.priority,id:s.id}):c.commentsFloatingEffect(),c.sortByLike(),c.list.dataProvider=new eui.ArrayCollection(c.array),c.gp_null.visible=0==c.commentNum})},e.prototype.perClose=function(){egret.Tween.removeTweens(this.gp_msg),egret.clearInterval(this.timer)},e.prototype.onDestroy=function(){i.prototype.onDestroy.call(this)},e.commentType={PINGLUN:1,DIANZAN:2},e);function e(e){var t=i.call(this)||this;return t.array=[],t.zanNumber=0,t.commentNum=0,t.playerPy=T.AppFacade.getInstance().retrieveProxy(T.PlayerPy.N),t.loginProxy=T.AppFacade.getInstance().retrieveProxy(T.LoginPy.N),t.skinName="HeroCommentSkin",t}T.HeroCommentView=n,__reflect(n.prototype,"game.HeroCommentView");var o,t=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){var t=this;o.prototype.childrenCreated.call(this);var e=this.btn_love.labelDisplay;e.size=19,e.stroke=1,this.btn_love.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.playerTupHero(e)},this)},a.prototype.dataChanged=function(){this.lb_time.text="["+this.data.time+"]",this.lb_comments.text=""+this.data.content,this.lb_playerName.text=this.data.name,this.playerHead.updateData({vo:{avatar:this.data.head}}),this.btn_love.labelDisplay.text=this.data.num.toString(),this.data.tup_player?(UIActionManager.setGrey(this.btn_love,!0),this.btn_love.touchEnabled=!1):(UIActionManager.setGrey(this.btn_love,!1),this.btn_love.touchEnabled=!0)},a.prototype.playerTupHero=function(t){var i=this,o=T.AppFacade.getInstance().retrieveProxy(T.PlayerPy.N),e=T.AppFacade.getInstance().retrieveProxy(T.LoginPy.N);Utils.Http.toGet({action:"set_PlayerTup_hero",moduleType:EEntityType.EEntityTypeHero,code:this.data.code,player_id:this.data.id,name:this.data.name,content:this.data.content,head:this.data.head,type:n.commentType.DIANZAN,tup_player:o.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,subPlatform:Utils.agentConfig.channelName||"",project:Utils.agentConfig.ProjectName,server_id:e.serverSelect.s_id,area:this.data.serverId,from_server_id:e.serverSelect.area}).then(function(e){Utils.MsgUtils.addNumberEffect("+1",i.btn_love,t.stageX,t.stageY,-1),++i.data.num,i.data.tup_player=o.playerInfoVO.playerId,T.AppFacade.getInstance().sendNotification(CN.HEROCOMMENT_UPDATE,{info:i.data,type:n.commentType.DIANZAN})}).catch(function(e){console.log("set_PlayerTup_hero"+e)})},a);function a(){var e=o.call(this)||this;return e.skinName="CommentItemSkin",e}__reflect(t.prototype,"heroCommentItem")}(game=game||{}),function(p){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.updateView=function(e){this.data=e.info;var t=this.data.defendLevel;e&&e.chooseLevel&&(t=e.chooseLevel),this.list_item.itemRenderer=d;var i=p.Config.heroDefendConfig(this.data.config.subType),o=void 0;for(var n in i)i[n].level==t-1?i[n]:i[n].level==t&&(o=i[n]);this.lb_title.text="属性加成";var a=[],r=[];for(var n in i)if(t>=i[n].level){var s=JSON.parse(i[n].attr);for(var c in s)1e5<s[c][1]?a=p.GeneralConfig.superAttrAddAttr(a,[s[c]]):r=p.GeneralConfig.superAttrAddAttr(r,[s[c]])}var l=a.concat(r),h=[];h.push({desc:"等级提升至：",after:o.maxLevel}),l.forEach(function(e){var t={desc:AttrConfig[e[0]].name+"：",after:"+"+p.GeneralConfig.getAttrValue(e[1])};h.push(t)}),this.list_item.dataProvider=new eui.ArrayCollection(h)},i);function i(){var e=t.call(this)||this;return e.upstarData={},e.skinName="HeroDefendAllAttrPanelSkin",e.heroPy=p.AppFacade.getInstance().retrieveProxy(p.HeroPy.N),e}p.HeroDefendAllAttrPanel=e,__reflect(e.prototype,"game.HeroDefendAllAttrPanel");var o,d=(o=eui.ItemRenderer,__extends(n,o),n.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this)},n.prototype.dataChanged=function(){var e=this.data;this.lb_name.text=e.desc,this.lb_num.text=e.after},n);function n(){var e=o.call(this)||this;return e.skinName="HeroDefendAllPanel_AttrItem",e}__reflect(d.prototype,"HeroDefendAll_Item")}(game=game||{}),function(m){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addListener()},i.prototype.addListener=function(){this.skill_item0.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.showSkillDetail0,this),this.skill_item0.addEventListener(egret.TouchEvent.TOUCH_END,this.hideSkillDetail0,this),this.skill_item0.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.hideSkillDetail0,this),this.skill_item0.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.hideSkillDetail0,this),this.skill_item1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.showSkillDetail1,this),this.skill_item1.addEventListener(egret.TouchEvent.TOUCH_END,this.hideSkillDetail1,this),this.skill_item1.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.hideSkillDetail1,this),this.skill_item1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.hideSkillDetail1,this)},i.prototype.updateView=function(e){this.data=e.info;var t=this.data.defendLevel;e&&e.chooseLevel&&(t=e.chooseLevel),this.list_item.itemRenderer=y;var i=m.Config.heroDefendConfig(this.data.config.subType),o=void 0,n=void 0;for(var a in i)i[a].level==t-1?o=i[a]:i[a].level==t&&(n=i[a]);if(e.isAll){this.gp_skill.visible=!1,this.igm_lock.visible=!1,this.skillDetailPanel0.visible=!1,this.skillDetailPanel1.visible=!1,this.lb_title.text="属性加成";var r=[],s=[];for(var a in i)if(t>=i[a].level){var c=JSON.parse(i[a].attr);for(var l in c)1e5<c[l][1]?r=m.GeneralConfig.superAttrAddAttr(r,[c[l]]):s=m.GeneralConfig.superAttrAddAttr(s,[c[l]])}var h=r.concat(s),p=[];p.push({desc:"等级提升至：",after:n.maxLevel}),h.forEach(function(e){var t={desc:AttrConfig[e[0]].name+"：",after:"+"+m.GeneralConfig.getAttrValue(e[1])};p.push(t)}),this.list_item.dataProvider=new eui.ArrayCollection(p)}else{this.gp_skill.visible=!0,this.igm_lock.visible=!0,this.lb_title.text="神灵守护";var d=JSON.parse(n&&n.attr),u=[];u.push({desc:"等级提升至：",after:n.maxLevel}),d.forEach(function(e){var t={desc:AttrConfig[e[0]].name+"：",after:"+"+m.GeneralConfig.getAttrValue(e[1])};u.push(t)}),this.list_item.dataProvider=new eui.ArrayCollection(u);for(var g=JSON.parse(o.skills),f=JSON.parse(n.skills),_=0;_<g.length;_++)g[_]!=f[_]&&(this.skill0=g[_],this.skill1=f[_]);this.skill0?(this.skill_item0.updateItem({code:this.skill0}),this.skillDetailPanel0.updateItem({code:this.skill0})):this.skill_item0.reset(),this.skill1?(this.skill_item1.updateItem({code:this.skill1}),this.skillDetailPanel1.updateItem({code:this.skill1})):this.skill_item1.reset()}},i.prototype.showSkillDetail0=function(){this.skillDetailPanel0.updateItem({code:this.skill0}),this.skillDetailPanel0.visible=!0},i.prototype.hideSkillDetail0=function(){this.skillDetailPanel0.visible=!1},i.prototype.showSkillDetail1=function(){this.skillDetailPanel1.updateItem({code:this.skill1}),this.skillDetailPanel1.visible=!0},i.prototype.hideSkillDetail1=function(){this.skillDetailPanel1.visible=!1},i);function i(){var e=t.call(this)||this;return e.upstarData={},e.skinName="HeroDefendAllPanelSkin",e.heroPy=m.AppFacade.getInstance().retrieveProxy(m.HeroPy.N),e}m.HeroDefendAllPanel=e,__reflect(e.prototype,"game.HeroDefendAllPanel");var o,y=(o=eui.ItemRenderer,__extends(n,o),n.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this)},n.prototype.dataChanged=function(){var e=this.data;this.lb_name.text=e.desc,this.lb_num.text=e.after},n);function n(){var e=o.call(this)||this;return e.skinName="HeroDefendAllPanel_AttrItem",e}__reflect(y.prototype,"HeroDefendAll_Item")}(game=game||{}),function(h){var s=function(e){this.model=e.model,this.info=e.info,this.dermaInfo=e.dermaInfo};__reflect(s.prototype,"HeroFormationItem");var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addListener(),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){h.AppFacade.getInstance().hideSubView(h.HeroMediator.N,h.HeroMediator.SV.FORMATION)},this)},i.prototype.showBoundary=function(e){var t=new egret.Shape;t.graphics.lineStyle(10,16711680),t.graphics.beginFill(0,0),t.graphics.drawRect(0,0,e.width,e.height),t.graphics.endFill(),e.addChild(t)},i.prototype.initForDebug=function(){for(var e=1;e<=6;e++)this.showBoundary(this["gp_f_"+e])},i.prototype.addListener=function(){this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.gp_touchField.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},i.prototype.removeListener=function(){this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.onTouchEnd,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.onTouchEnd,this),this.gp_touchField.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this)},i.prototype.initModel=function(e){var a=this,r=this.heroPy.allHeroByUuid;e.forEach(function(e){var t=r[e.uuid],i=new customui.HeroDynamicModel;i.scaleX=i.scaleY=a.MODEL_SCALE,a.MODEL_WIDTH||(a.MODEL_WIDTH=i.width*i.scaleX,a.MODEL_HEIGHT=i.height*i.scaleY);var o=void 0;0!=t.dermaCode?(o=h.Config.getHeroDermaConfig()[t.dermaCode],i.update({model:o.model})):i.update({code:t.code,isStatic:!0});var n=new s({model:i,info:t,dermaInfo:o});a.gp_formation.addChild(i),a.setHeroToPos(n,e.battlePos)})},i.prototype.updateView=function(e){this.cb=e&&e.cb;var t=e&&e.battlePosInfo;if(!t){t=[];var i=this.heroPy.allHeroByUuid;for(var o in i){var n=i[o];n.battlePos&&t.push({uuid:o,battlePos:n.battlePos})}}this.initModel(t)},i.prototype.setHeroToPos=function(e,t){if(e){this.pos2item[this.startingPos]=void 0,this.startingPos&&this.startingPos!=t&&(this.changed=!0,this.pos2item[t]&&this.setHeroToPos(this.pos2item[t],this.startingPos));var i=(this.pos2item[t]=e).model,o=this["gp_f_"+t];i.x=o.x+(o.width-this.MODEL_WIDTH)/2,i.y=o.y+(o.height-this.MODEL_HEIGHT-this.FIXED_BOTTOM);var n=this["gp_info_"+t],a=this.gp_formation.getChildIndex(e.model);this.gp_formation.getChildIndex(n)<a&&this.gp_formation.swapChildren(e.model,n),n.visible=!0,e.dermaInfo?this["lb_name_"+t].text=e.dermaInfo.name:this["lb_name_"+t].text=e.info.config.name,this["lb_level_"+t].text=e.info.level;var r=this["gp_stars_"+t],s=e.info.starLevel,c=h.GeneralConfig.getHeroStarInfo(s);if(r.removeChildren(),c.stage<4)for(var l=0;l<c.num;l++)r.addChild(new eui.Image(c.src));else r.addChild(new customui.HighStarLevelIcon({num:c.num,scale:.8}))}},i.prototype.setModelToXY=function(e,t,i){this.MODEL_WIDTH,e.scaleX,this.MODEL_HEIGHT,e.scaleY,e.x+=(t-this.beginX)/this.addScale,e.y+=(i-this.beginY)/this.addScale,this.beginX=t,this.beginY=i},i.prototype.getTouchedGroupPos=function(e){for(var t=1;t<=6;t++){var i=this["gp_f_"+t],o=i.localToGlobal();if(new egret.Rectangle(o.x,o.y,i.width*Utils.DeviceUtils.additionScale(),i.height*Utils.DeviceUtils.additionScale()).contains(e.stageX,e.stageY))return t}},i.prototype.onTouchBegin=function(e){var t=this.getTouchedGroupPos(e);if(t&&this.pos2item[t]){this.targetItem=this.pos2item[t];var i=this.targetItem.model;this.gp_formation.setChildIndex(i,this.gp_formation.numChildren-1),this.startingPos=t,this["gp_info_"+t].visible=!1,this.gp_touchField.width=this.width,this.gp_touchField.height=this.height,this.beginX=e.stageX,this.beginY=e.stageY}},i.prototype.onTouchMove=function(e){if(this.targetItem){var t=this.targetItem.model;this.setModelToXY(t,e.stageX,e.stageY)}},i.prototype.onTouchEnd=function(e){if(this.targetItem){var t=this.getTouchedGroupPos(e);t?this.setHeroToPos(this.targetItem,t):this.setHeroToPos(this.targetItem,this.startingPos),this.targetItem=void 0,this.startingPos=void 0,this.gp_touchField.width=this.gp_formation.width,this.gp_touchField.height=this.gp_formation.height}},i.prototype.onPanelClose=function(){if(this.changed)if(this.cb)this.cb(this.pos2item);else{var e={};for(var t in this.pos2item){var i=this.pos2item[t];i&&(e[t]=i.info.uuid)}this.heroPy.HeroChangeFormation(e)}},i.prototype.perClose=function(){this.removeListener(),this.onPanelClose()},i);function i(){var e=t.call(this)||this;return e.pos2item={},e.changed=!1,e.addScale=Utils.DeviceUtils.additionScale(),e.beginX=0,e.beginY=0,e.FIXED_BOTTOM=20,e.MODEL_WIDTH=void 0,e.MODEL_HEIGHT=void 0,e.MODEL_SCALE=.35,e.heroPy=h.AppFacade.getInstance().retrieveProxy(h.HeroPy.N),e.HeroThingPy=h.AppFacade.getInstance().retrieveProxy(h.HeroThingPy.N),e.skinName="HeroFormationPanelSkin",e}h.HeroFormationPanel=e,__reflect(e.prototype,"game.HeroFormationPanel")}(game=game||{}),function(v){var o,e=(__extends(t,o=BaseFull),t.prototype.onDestroy=function(){o.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_hero_gacha")},t.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),Utils.SDKMgr.getPerformConfig(39)&&(this.lb_shuoming.visible=!0),this.initConfig(),this.pb_Exp.maximum=100,this.gachaBtnEvent(),this.contentStatus(),this.activeHeroAnim(),egret.setTimeout(function(){e.viewActionEffect()},this,100);var t=v.AppFacade.getInstance().retrieveProxy(v.TaskPy.N);if(t.allTasks[TaskType.HideAchievement].some(function(e){return 500009==e.code&&!e.isTarget})){var i=new eui.Image("_yslz_m_json.yslz_img_baoxiang");i.x=215,i.y=600,this.sl_resource_race.viewport.addChild(i),Utils.TouchUtils.addTouchListener(i,function(){t.GetTaskReward(TaskType.HideAchievement,500009),i&&i.parent&&i.parent.removeChild(i)})}egret.setTimeout(function(){this.addNotice()},this,100)},t.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.GASHA_HIGH_TIMES,this.btn_reward.iconDisplay,this,BTN_ICON_NOTICE_POS)},t.prototype.removeNotice=function(){NoticeManager.removeNoticeListener(NT.GASHA_HIGH_TIMES)},t.prototype.initConfig=function(){this.GACHA_TYPE_INFO=((e={})[GashaponType.Lower]={1:{},10:{},suffix:"low",money:"低级币",heroData:{code:41110030,model:"hero_030_03",isStatic:!0}},e[GashaponType.High]={1:{},10:{},suffix:"high",money:"钻石",heroData:{code:41110014,model:"hero_014_03",isStatic:!0}},e[GashaponType.Friend]={1:{},10:{},suffix:"race",money:"友情币",heroData:{code:41100009,model:"hero_009_03",isStatic:!0}},e);var e,t=v.Config.gashaponEntry();for(var i in t){var o=t[i];o.type!=GashaponType.Race&&(this.GACHA_TYPE_INFO[o.type][o.times].itemCosts=JSON.parse(o.itemCosts),this.GACHA_TYPE_INFO[o.type][o.times].moneyCosts=JSON.parse(o.moneyCosts))}},t.prototype.updateView=function(e){for(var t in this.GACHA_TYPE_INFO){var i=this.GACHA_TYPE_INFO[t],o=i.suffix,n=i[1].itemCosts[0],a=0<i[1].moneyCosts.length?i[1].moneyCosts[0]:void 0,r=a,s=0<i[10].moneyCosts.length?i[10].moneyCosts[0]:void 0;!this.backPackProxy.checkEnough([n],!1)&&a||(r=n),!this.backPackProxy.checkEnough([i[10].itemCosts[0]],!1)&&s||(s=i[10].itemCosts[0]),this["icon_resource_1_"+o].updateItem({cost:r,style:CommonIconStyle.RIGHT,showEnough:!1}),this["icon_resource_10_"+o].updateItem({cost:s,style:CommonIconStyle.RIGHT,showEnough:!1})}this.updateTimes(),this.resourceBarComponent()},t.prototype.updateTimes=function(){var e=this.heroPy.gashaponInfo,t=Utils.TimerManager.getServerTime();for(var i in this.GACHA_TYPE_INFO){var o=this.GACHA_TYPE_INFO[i].suffix,n=this["lb_time_"+o],a=this["btn_gacha_1_"+o],r=this["icon_resource_1_"+o];0<e[i].freeTimes?(a.label="免费",a.labelDisplay.horizontalCenter=0,n.visible=!1,r.visible=!1):(a.label="召唤",r.visible=!0,n.visible=0!=e[i].nextFreeDt,n.text=Utils.TimerManager.getFormatBySecond1(e[i].nextFreeDt-t)+" 后免费",this.freeTimeTimer||(this.freeTimeTimer=egret.setInterval(this.updateTimes,this,1e3)))}},t.prototype.resourceBarComponent=function(){for(var e in this.GACHA_TYPE_INFO){var t=this.GACHA_TYPE_INFO[e].suffix,i=[this.GACHA_TYPE_INFO[e][1].itemCosts[0]];Number(e)==GashaponType.High&&(i=[this.GACHA_TYPE_INFO[e][1].itemCosts[0],this.GACHA_TYPE_INFO[e][1].moneyCosts[0]]),this["cu_resBar_"+t].updateBar({costs:i,width:190,needAdd:!0})}},t.prototype.gachaBtnEvent=function(){function e(o){var n=t.GACHA_TYPE_INFO[o],e=t.GACHA_TYPE_INFO[o].suffix,a=t.heroPy.gashaponInfo;t["btn_gacha_1_"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this,e=this.backPackProxy.checkEnough([n[1].itemCosts[0]],!1),i=n[1].moneyCosts[0]&&this.backPackProxy.checkEnough([n[1].moneyCosts[0]],!1);!e&&!i&&a[o].freeTimes<=0?Utils.MsgUtils.addMidMsg("您的"+this.GACHA_TYPE_INFO[o].money+"不足"):i&&a[o].freeTimes<=0&&!e?v.GameMgr.getInstance().showCommonTipsWin({commonTips:"亲爱的玩家，当前召唤需要消耗钻石，请您确认是否继续进行召唤。",source:"HeroGachaDiamondCost",cb:!0,clickCB:function(e){1===e.type&&t.heroPy.MakeGashapon({type:Number(o),subType:0,times:1})}}):this.heroPy.MakeGashapon({type:Number(o),subType:0,times:1})},t),t["btn_gacha_10_"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this,e=this.backPackProxy.checkEnough([n[10].itemCosts[0]],!1),i=n[10].moneyCosts[0]&&this.backPackProxy.checkEnough([n[10].moneyCosts[0]],!1);!e&&!i&&a[o].freeTimes<10?Utils.MsgUtils.addMidMsg("您的"+this.GACHA_TYPE_INFO[o].money+"不足"):i&&a[o].freeTimes<10&&!e?v.GameMgr.getInstance().showCommonTipsWin({commonTips:"亲爱的玩家，当前召唤需要消耗钻石，请您确认是否继续进行召唤。",source:"HeroGachaDiamondCost",cb:!0,clickCB:function(e){1===e.type&&t.heroPy.MakeGashapon({type:Number(o),subType:0,times:10})}}):this.heroPy.MakeGashapon({type:Number(o),subType:0,times:10})},t)}var t=this;for(var i in this.GACHA_TYPE_INFO)e(i);this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.MainJumpConfig.jumpTo()},this),this.gp_jindu.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=v.Config.constConfig().HeroBagMaxSize.constValue;100<=this.value?this.heroPy.allHeroNum>=e?Utils.MsgUtils.addMidMsg("英雄背包已满，无法领取"):this.heroPy.MakeProgressGashapon():Utils.MsgUtils.addMidMsg("进度值不足")},this),this.btn_info.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new v.HelpDialog({moduleId:MODULE.HeroGaCha})})},this),Utils.ComponentUtils.registerListener(this.btn_reward,egret.TouchEvent.TOUCH_TAP,function(){v.AppFacade.getInstance().showSubView(v.RankMediator.N,v.RankMediator.SV.COMMON,{module:"GACHA_HIGH_ACHIEVMENT"})},this)},t.prototype.activeHeroAnim=function(){for(var e in this.GACHA_TYPE_INFO){var t=this.GACHA_TYPE_INFO[e].heroData;this["hero_model_"+this.GACHA_TYPE_INFO[e].suffix].update(t)}},t.prototype.viewActionEffect=function(){function e(e){var t=n.GACHA_TYPE_INFO[e].suffix,i=Number(e)%2!=1;UIActionManager.UIActionEffect(n["img_bg_"+t],500,i,function(){o.setGuideAvailable()}),UIActionManager.UIActionEffect(n["cu_resBar_"+t],500,i),UIActionManager.UIActionEffect(n["sl_resource_"+t],500,!i,function(){UIActionManager.fadeIn(o["gp_dt_"+t],1e3)})}var o=this,n=this;for(var t in this.GACHA_TYPE_INFO)e(t)},t.prototype.contentStatus=function(){for(var e in this.GACHA_TYPE_INFO){var t=this.GACHA_TYPE_INFO[e].suffix;this["gp_dt_"+t].alpha=0,this["img_bg_"+t].visible=!1,this["cu_resBar_"+t].visible=!1,this["sl_resource_"+t].visible=!1}},t.prototype.perClose=function(){egret.clearInterval(this.freeTimeTimer)},t);function t(){var e=o.call(this)||this;return e.moneyType=[],Utils.AssetsMgr.loadGroup("group_hero_gacha"),e.skinName="HeroGachaSkin",e.heroPy=v.AppFacade.getInstance().retrieveProxy(v.HeroPy.N),e.backPackProxy=v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N),e.guideEffectWait=!0,e}v.HeroGachaView=e,__reflect(e.prototype,"game.HeroGachaView");var i,n=(__extends(a,i=BaseFull),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cus_resourceBar),this.invisibleMask=new egret.Sprite,this.invisibleMask.graphics.beginFill(0,0),this.invisibleMask.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),this.invisibleMask.graphics.endFill(),this.invisibleMask.touchEnabled=!0,this.invisibleMask.visible=!1,this.gp_root.addChild(this.invisibleMask),this.darkMask=new egret.Sprite,this.darkMask.graphics.beginFill(0,.7),this.darkMask.graphics.drawRect(-100,-100,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale()+200,Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()+200),this.darkMask.graphics.endFill(),this.darkMask.touchEnabled=!0,this.gp_cardEffect.addChildAt(this.darkMask,0),this.gp_cardEffect.visible=!1,this.heroConfig=v.Config.allHeroConfig(),this.activateComponent()},a.prototype.updateView=function(e){var t=this;this.curIndex=0,this.gp_effect.removeChildren(),DragonBoneTools.create("common_chouka_1",function(e){e.animation.play("common_chouka_1"),t.gp_effect.addChild(e)}),this.chosenType=e&&e.type,this.chosenSubtype=e&&e.subType,this.isGacha=e&&e.isGacha;var i=e&&e.entryCode;this.costs=[];var o=v.Config.gashaponEntry();for(var n in o){var a=o[n];if(a.type==this.chosenType&&a.subType==this.chosenSubtype){var r=JSON.parse(a.itemCosts),s=JSON.parse(a.moneyCosts),c=0<s.length?s:void 0,l=c;!v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N).checkEnough(r,!1)&&c||(l=r),this.costs.push(l),this["icon_cost_"+a.times].updateItem({cost:l[0],style:CommonIconStyle.RIGHT}),this.cus_resourceBar.updateBar(r.concat(s))}}var h,p=o[i];if(p)if(p.fixedRewards){this.gp_top_fixed.visible=!0;var d=JSON.parse(p.fixedRewards)[0],u=v.GeneralConfig.getEntityConfigByCode(d[0],d[1]);u&&(this.img_top_fixed_icon.source=ResourceUtils.png(u.icon),this.blb_top_fixed_num.text=d[2])}else this.gp_top_fixed.visible=!1;if(0<this.heroPy.gashaponInfo[this.chosenType].freeTimes?(this.icon_cost_1.visible=!1,this.btn_gacha_1.label="免费"):(this.icon_cost_1.visible=!0,this.btn_gacha_1.label="召唤"),this.gp_component.visible=!1,this.btn_close.visible=!1,this.rewards=e.rewards,1<this.rewards.length?((h=new eui.TileLayout).horizontalGap=15,h.verticalGap=10,h.requestedColumnCount=5):((h=new eui.HorizontalLayout).horizontalAlign=egret.HorizontalAlign.CENTER,h.verticalAlign=egret.VerticalAlign.MIDDLE),this.gp_result.layout=h,this.gp_result.removeChildren(),this.gp_fixedReward.removeChildren(),this.isJump)for(var g in Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_chouka),this.rewards){var f=this.rewards[g],_=this.heroConfig[f.code],m=new eui.Group;m.height=105,m.width=105;var y=customui.BaseItemFactory.create();y.updateData({type:f.type,code:f.code,num:f.num}),y.horizontalCenter=0,m.addChild(y),Number(g)<10?this.gp_result.addChild(m):(this.rewards.length<16?m.scaleX=m.scaleY=1:m.scaleX=m.scaleY=.8,this.gp_fixedReward.addChild(m)),_&&4<_.initStar&&DragonBoneTools.playOnce({effectName:"common_choukagaojiekuang",parent:m,loop:!0}),this.rewards[Number(g)+1]||this.chouKaEnd()}else this.showSingleResult(this.curIndex)},a.prototype.showSingleResult=function(e,t){var i=this;if(void 0===t&&(t=!1),e==this.curIndex){this.insuranceTimer&&(egret.clearTimeout(this.insuranceTimer),this.insuranceTimer=void 0);var o=this.rewards[this.curIndex++];if(o){var n=this.heroConfig[o.code];if(!t&&n&&4<n.initStar)this.showCardEffectForCode(o.code),this.curIndex-=1;else{var a=new eui.Group;a.height=105,a.width=105;var r=customui.BaseItemFactory.create();r.updateData({type:o.type,code:o.code,num:o.num}),r.alpha=0,r.scaleX=.3,r.horizontalCenter=0,a.addChild(r),this.curIndex<11?this.gp_result.addChild(a):this.gp_fixedReward.addChild(a);var s=this.curIndex;egret.Tween.get(r).wait(200).to({alpha:1,scaleX:1},170),Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_chouka),DragonBoneTools.playOnce({effectName:"common_choukayingxiong",parent:a,doneCB:function(){n&&4<n.initStar&&DragonBoneTools.playOnce({effectName:"common_choukagaojiekuang",parent:a,loop:!0}),i.showSingleResult(s)}}),this.insuranceTimer=egret.setTimeout(function(){i.showSingleResult(i.curIndex)},this,1500)}}else this.chouKaEnd()}},a.prototype.chouKaEnd=function(){var t=this;DragonBoneTools.create("common_chouka_2",function(e){e.animation.play("common_chouka_2"),t.gp_effect.addChild(e),e.addEventListener(dragonBones.EventObject.COMPLETE,function(){},t)}),egret.Tween.get(this.gp_effect).wait(800).to({alpha:0},200).call(function(){t.gp_effect.removeChildren(),t.gp_effect.alpha=1,t.gp_fixedReward.numChildren?t.gp_component.verticalCenter=195.5:t.gp_component.verticalCenter=55.5,t.gp_component.visible=!t.isGacha,t.btn_close.visible=!0,t.heroPy.canMakeGasha=!0,t.setGuideAvailable(),v.AppFacade.getInstance().sendNotification(CN.SHOW_WECHAT_SHARE)})},a.prototype.showCardEffectForCode=function(e){var t=this;this.heroCard.alpha=0,this.heroCard.scaleX=.4,this.heroCard.updateView({code:e}),this.darkMask.alpha=0,this.gp_cardEffect.visible=!0,egret.Tween.get(this.darkMask).to({alpha:1},500).wait(200).call(function(){Utils.ShakeUtils.shakeObj(t.gp_cardEffect,1.21,60,7),egret.Tween.get(t.heroCard).wait(1210).call(function(){Utils.ShakeUtils.stop(),Utils.ShakeUtils.shakeObj(t.gp_cardEffect,.2,60,30)}).wait(540).to({alpha:1,scaleX:1},210),Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_chouka_wuxingka),DragonBoneTools.playOnce({effectName:"common_kapianfanzhuan",parent:t.gp_cardEffect,timeScale:1,doneCB:function(){t.invisibleMask.visible=!0}}),t.hideEffectTimer=egret.setTimeout(function(){t.hideCardEffect()},t,7e3)})},a.prototype.hideCardEffect=function(){var e=this;this.hideEffectTimer&&(egret.clearTimeout(this.hideEffectTimer),this.hideEffectTimer=void 0),this.invisibleMask.visible=!1,egret.Tween.get(this.gp_cardEffect).to({alpha:0},200).call(function(){e.gp_cardEffect.visible=!1,e.gp_cardEffect.alpha=1,e.showSingleResult(e.curIndex,!0)})},a.prototype.resourceCheck=function(e,t){var i=this.heroPy.gashaponInfo[e],o=1==t?this.costs[0]:this.costs[1];return!((!o||!this.backPackProxy.checkEnough(o,!1))&&i.freeTimes<=0&&(Utils.MsgUtils.addMidMsg("您的"+a.MONEY_TYPE[e]+"不足"),1))},a.prototype.activateComponent=function(){var e=this;this.btn_gacha_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;if(this.resourceCheck(this.chosenType,1)){var e=this.heroPy.gashaponInfo[this.chosenType],i=this.costs[0];e.freeTimes<=0&&i[0][1]==EPropertyType.EPropertyTypeDiamond?v.GameMgr.getInstance().showCommonTipsWin({commonTips:"亲爱的玩家，当前召唤需要消耗钻石，请您确认是否继续进行召唤。",source:"HeroGachaDiamondCost",cb:!0,clickCB:function(e){1===e.type&&(t.chosenType!=GashaponType.Race||t.isJump||t.hide(),t.heroPy.MakeGashapon({type:t.chosenType,subType:t.chosenSubtype,times:1,hideLeiShenEffect:t.isJump,fromResult:!0}))}}):(this.chosenType!=GashaponType.Race||this.isJump||this.hide(),this.heroPy.MakeGashapon({type:this.chosenType,subType:this.chosenSubtype,times:1,hideLeiShenEffect:this.isJump,fromResult:!0}))}},this),this.btn_gacha_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;if(this.resourceCheck(this.chosenType,10)){var e=this.heroPy.gashaponInfo[this.chosenType],i=this.costs[1];e.freeTimes<=10&&i[0][1]==EPropertyType.EPropertyTypeDiamond?v.GameMgr.getInstance().showCommonTipsWin({commonTips:"亲爱的玩家，当前召唤需要消耗钻石，请您确认是否继续进行召唤。",source:"HeroGachaDiamondCost",cb:!0,clickCB:function(e){1===e.type&&(t.chosenType!=GashaponType.Race||t.isJump||t.hide(),t.heroPy.MakeGashapon({type:t.chosenType,subType:t.chosenSubtype,times:10,hideLeiShenEffect:t.isJump,fromResult:!0}))}}):(this.chosenType!=GashaponType.Race||this.isJump||this.hide(),this.heroPy.MakeGashapon({type:this.chosenType,subType:this.chosenSubtype,times:10,hideLeiShenEffect:this.isJump,fromResult:!0}))}},this),this.img_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){v.AppFacade.getInstance().sendNotification(CN.HERO_GACHA_UPDATE),this.hide()},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.invisibleMask.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hideCardEffect()},this),this.cb_needGuide.addEventListener(egret.Event.CHANGE,function(){e.isJump=e.cb_needGuide.selected},this)},a.prototype.onDestroy=function(){v.AppFacade.getInstance().sendNotification(CN.ACTIVITY_SHOW_TRIGGER)},a.MONEY_TYPE=((h={})[GashaponType.Lower]="低级币",h[GashaponType.High]="钻石",h[GashaponType.Race]="道具",h[GashaponType.Friend]="友情币",h),a);function a(){var e=i.call(this)||this;return e.costs=[],e.isGacha=!1,e.curIndex=0,e.skinName="HeroGachaResultSkin",e.heroPy=v.AppFacade.getInstance().retrieveProxy(v.HeroPy.N),e.backPackProxy=v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N),e.isJump=!1,e.guideEffectWait=!0,e}v.HeroGachaResultView=n,__reflect(n.prototype,"game.HeroGachaResultView");var r,s=(__extends(c,r=BasePanel),c.prototype.childrenCreated=function(){var e=this;r.prototype.childrenCreated.call(this),this.img_effectBg.visible=!1,this.updateView(),egret.setTimeout(function(){e.hide()},this,7e3)},c.prototype.updateView=function(){this.params&&this.params.fromResult?this.playEffect3_2():this.playEffect3()},c.prototype.playEffect3_2=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,DragonBoneTools.preload("common_chouka_03")];case 1:return e.sent(),this.playEffect1(),egret.setTimeout(function(){var t=this;DragonBoneTools.create("common_chouka_03",function(e){e.x=300,e.y=1250,e.scaleX=e.scaleY=2,t.gp_root.addChild(e),e.animation.play(),egret.setTimeout(function(){egret.Tween.get(e).to({y:1800},270).call(function(){e.animation&&e.animation.stop(),e.parent.removeChild(e)})},t,350),t.img_bg.alpha=1,e.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,function(){e.animation.stop(),e.parent.removeChild(e)},t)},this)},this,200),[2]}})})},c.prototype.playEffect3=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return[4,DragonBoneTools.preload("common_chouka_01")];case 1:return e.sent(),DragonBoneTools.create("common_chouka_03",function(e){e.x=170,e.y=780,e.scaleX=e.scaleY=1.7,t.gp_root.addChild(e),t.img_bg.alpha=0,egret.Tween.get(t.img_bg).to({alpha:1},500),egret.setTimeout(function(){this.playEffect1()},t,300),egret.Tween.get(e).to({x:300,y:1250,scaleX:2,scaleY:2},500).call(function(){e.animation.play(),egret.setTimeout(function(){egret.Tween.get(e).to({y:1800},270).call(function(){e.animation&&e.animation.stop(),e.parent.removeChild(e)})},t,350),e.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,function(){e.animation.stop(),e.parent.removeChild(e)},t)})},this),[2]}})})},c.prototype.playEffect1=function(){var e=this;DragonBoneTools.playOnce({effectName:"common_chouka_01",parent:this.gp_root,x:this.gp_root.width/2,y:this.gp_root.height/2,z:1,doneCB:function(){e.img_effectBg.visible=!0,e.playEffect2()}})},c.prototype.playEffect2=function(){var e=this;DragonBoneTools.playOnce({effectName:"common_chouka_02",parent:this.gp_root,x:this.gp_root.width/2,y:this.gp_root.height/2,doneCB:function(){e.hide()}})},c);function c(e){var t=r.call(this)||this;return t.skinName="HeroGachaResultEffectView",t.params=e,t}v.HeroGachaResultEffectView=s,__reflect(s.prototype,"game.HeroGachaResultEffectView");var l,h,p=(__extends(d,l=BaseFull),d.prototype.childrenCreated=function(){l.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cus_resourceBar),this.invisibleMask=new egret.Sprite,this.invisibleMask.graphics.beginFill(0,0),this.invisibleMask.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),this.invisibleMask.graphics.endFill(),this.invisibleMask.touchEnabled=!0,this.invisibleMask.visible=!1,this.gp_root.addChild(this.invisibleMask),this.darkMask=new egret.Sprite,this.darkMask.graphics.beginFill(0,.7),this.darkMask.graphics.drawRect(-100,-100,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale()+200,Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()+200),this.darkMask.graphics.endFill(),this.darkMask.touchEnabled=!0,this.gp_cardEffect.addChildAt(this.darkMask,0),this.gp_cardEffect.visible=!1,this.heroConfig=v.Config.allHeroConfig(),this.activateComponent()},d.prototype.updateView=function(e){var t,i=this;if(e)if(this.params=e,this.curIndex=0,this.gp_effect.removeChildren(),DragonBoneTools.create("common_chouka_1",function(e){e.animation.play("common_chouka_1"),i.gp_effect.addChild(e)}),this.params.cost1&&(this.icon_cost_1.updateItem({cost:this.params.cost1,style:CommonIconStyle.RIGHT}),this.cus_resourceBar.updateBar([this.params.cost1])),this.params.cost10&&this.icon_cost_10.updateItem({cost:this.params.cost10,style:CommonIconStyle.RIGHT}),0<e.freeTimes?(this.icon_cost_1.visible=!1,this.btn_gacha_1.label="免费"):(this.icon_cost_1.visible=!0,this.btn_gacha_1.label="召唤"),this.gp_component.visible=!1,this.btn_close.visible=!1,this.rewards=e.rewards,1<this.params.rewardLength?((t=new eui.TileLayout).horizontalGap=15,t.verticalGap=10,t.requestedColumnCount=5):((t=new eui.HorizontalLayout).horizontalAlign=egret.HorizontalAlign.CENTER,t.verticalAlign=egret.VerticalAlign.MIDDLE),this.gp_result.layout=t,this.gp_result.removeChildren(),this.gp_fixedReward.removeChildren(),this.isJump)for(var o in Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_chouka),this.rewards){var n=this.rewards[o],a=this.heroConfig[n.code],r=new eui.Group;r.height=105,r.width=105;var s=customui.BaseItemFactory.create();s.updateData({type:n.type,code:n.code,num:n.num}),s.horizontalCenter=0,r.addChild(s),Number(o)<10?this.gp_result.addChild(r):(this.rewards.length<16?r.scaleX=r.scaleY=1:r.scaleX=r.scaleY=.8,this.gp_fixedReward.addChild(r)),a&&4<a.initStar&&DragonBoneTools.playOnce({effectName:"common_choukagaojiekuang",parent:r,loop:!0}),this.rewards[Number(o)+1]||this.chouKaEnd()}else this.showSingleResult(this.curIndex)},d.prototype.showSingleResult=function(e,t){var i=this;if(void 0===t&&(t=!1),e==this.curIndex){this.insuranceTimer&&(egret.clearTimeout(this.insuranceTimer),this.insuranceTimer=void 0);var o=this.rewards[this.curIndex++];if(o){var n=this.heroConfig[o.code];if(t||this.params.showSpecialEffect&&!this.params.showSpecialEffect(o.code)){var a=new eui.Group;a.height=105,a.width=105;var r=customui.BaseItemFactory.create();r.updateData({type:o.type,code:o.code,num:o.num}),r.alpha=0,r.scaleX=.3,r.horizontalCenter=0,a.addChild(r),this.curIndex<11?this.gp_result.addChild(a):this.gp_fixedReward.addChild(a);var s=this.curIndex;egret.Tween.get(r).wait(200).to({alpha:1,scaleX:1},170),Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_chouka),DragonBoneTools.playOnce({effectName:"common_choukayingxiong",parent:a,doneCB:function(){n&&4<n.initStar&&DragonBoneTools.playOnce({effectName:"common_choukagaojiekuang",parent:a,loop:!0}),i.showSingleResult(s)}}),this.insuranceTimer=egret.setTimeout(function(){i.showSingleResult(i.curIndex)},this,1500)}else this.showCardEffectForCode(o.code),this.curIndex-=1}else this.chouKaEnd()}},d.prototype.chouKaEnd=function(){var t=this;DragonBoneTools.create("common_chouka_2",function(e){e.animation.play("common_chouka_2"),t.gp_effect.addChild(e),e.addEventListener(dragonBones.EventObject.COMPLETE,function(){},t)}),egret.Tween.get(this.gp_effect).wait(800).to({alpha:0},200).call(function(){t.gp_effect.removeChildren(),t.gp_effect.alpha=1,t.gp_fixedReward.numChildren?t.gp_component.verticalCenter=195.5:t.gp_component.verticalCenter=55.5,t.gp_component.visible=!0,t.btn_close.visible=!0,t.heroPy.canMakeGasha=!0,v.AppFacade.getInstance().sendNotification(CN.SHOW_WECHAT_SHARE),t.params.choukaEnd_cb&&t.params.choukaEnd_cb()})},d.prototype.showCardEffectForCode=function(e){var t=this;this.heroCard.alpha=0,this.heroCard.scaleX=.4,this.heroCard.updateView({code:e}),this.darkMask.alpha=0,this.gp_cardEffect.visible=!0,egret.Tween.get(this.darkMask).to({alpha:1},500).wait(200).call(function(){Utils.ShakeUtils.shakeObj(t.gp_cardEffect,1.21,60,7),egret.Tween.get(t.heroCard).wait(1210).call(function(){Utils.ShakeUtils.stop(),Utils.ShakeUtils.shakeObj(t.gp_cardEffect,.2,60,30)}).wait(540).to({alpha:1,scaleX:1},210),Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_chouka_wuxingka),DragonBoneTools.playOnce({effectName:"common_kapianfanzhuan",parent:t.gp_cardEffect,timeScale:1,doneCB:function(){t.invisibleMask.visible=!0}}),t.hideEffectTimer=egret.setTimeout(function(){t.hideCardEffect()},t,7e3)})},d.prototype.hideCardEffect=function(){var e=this;this.hideEffectTimer&&(egret.clearTimeout(this.hideEffectTimer),this.hideEffectTimer=void 0),this.invisibleMask.visible=!1,egret.Tween.get(this.gp_cardEffect).to({alpha:0},200).call(function(){e.gp_cardEffect.visible=!1,e.gp_cardEffect.alpha=1,e.showSingleResult(e.curIndex,!0)})},d.prototype.perShow=function(){return l.prototype.perShow.call(this)},d.prototype.activateComponent=function(){var e=this;this.btn_gacha_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.params.gacha_1_cb&&this.params.gacha_1_cb()},this),this.btn_gacha_10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.params.gacha_10_cb&&this.params.gacha_10_cb()},this),this.img_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.invisibleMask.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hideCardEffect()},this),this.cb_needGuide.addEventListener(egret.Event.CHANGE,function(){e.isJump=e.cb_needGuide.selected},this)},d.prototype.hide=function(e){l.prototype.hide.call(this),this.params.close_cb&&this.params.close_cb()},d.prototype.onDestroy=function(){v.AppFacade.getInstance().sendNotification(CN.ACTIVITY_SHOW_TRIGGER)},d);function d(){var e=l.call(this)||this;return e.curIndex=0,e.skinName="HeroGachaResultSkin",e.heroPy=v.AppFacade.getInstance().retrieveProxy(v.HeroPy.N),e.backPackProxy=v.AppFacade.getInstance().retrieveProxy(v.BackpackPy.N),e.isJump=!1,e}v.CommonGachaResultView=p,__reflect(p.prototype,"game.CommonGachaResultView")}(game=game||{}),function(p){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list_item.itemRenderer=n},i.prototype.updateView=function(e){function t(e){var i=c[e];if(i.haloType==HaloType.Normal){var t=i.type,o=i.subType;s[o]||(s[o]={type:t,subType:o,slot:[],showNum:0,attr:{},img:i.img});var n=s[o],a=n.slot;l.forEach(function(e,t){!a[t]&&i[e]&&a.push(i[e])}),0<=r.indexOf(i.id)&&(n.showNum=a.length),n.attr[a.length]=JSON.parse(i.attr)}}var i=e.codeList,r=this.heroPy.getActivatedHaloId(i),s={},c=p.Config.heroHaloConfig(),l=["slot1","slot2","slot3","slot4","slot5","slot6"];for(var o in c)t(o);var n=[];for(var a in s){var h=s[a];n.push(h)}n.sort(function(e,t){var i=0<e.showNum,o=0<t.showNum;return i!=o?o?1:-1:e.subType-t.subType}),n[0].first=!0,this.list_item.dataProvider=new eui.ArrayCollection(n)},i);function i(){var e=t.call(this)||this;return e.heroPy=p.AppFacade.getInstance().retrieveProxy(p.HeroPy.N),e.skinName="HeroHaloSkin",e}p.HeroHaloPanel=e,__reflect(e.prototype,"game.HeroHaloPanel");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this);for(var e=0;e<6;e++)this.gp_condIcon.addChild(new eui.Image)},a.prototype.dataChanged=function(){var a=this;UIActionManager.setAbsGrey(this.img_haloIcon,0==this.data.showNum),this.img_haloIcon.source=this.data.img+"_png";for(var e=this.data.type,t=this.data.slot,i=0;i<6;i++){var o=t[i],n=this.gp_condIcon.$children[i];o?(n.visible=!0,n.source=e==HeroHaloType.Race?HeroRaceConfig[o].raceIconBig:ProfessionConfig[o].icon,UIActionManager.setAbsGrey(n,i>=this.data.showNum)):n.visible=!1}this.gp_line.removeChildren();var r=this.data.attr,s=[],c=Object.keys(r);c.forEach(function(e,t){var i=r[e],o="";if(i.forEach(function(e){o+=AttrConfig[e[0]].name+"+"+p.GeneralConfig.getAttrValue(e[1])+"  "}),o=o.slice(0,-2),s.push({text:"("+e+")"+o+"  ",style:{textColor:Number(e)<=a.data.showNum?8060672:8553090}}),t!=c.length-1){var n=new eui.Image("yingxiong_img_fengexian_png");n.x=44.2*Number(e)+26*(Number(e)-1+.5),a.gp_line.addChild(n)}}),this.lb_desc.textFlow=s,this.img_line.visible=!this.data.first},a);function a(){var e=o.call(this)||this;return e.skinName="HeroHaloPanel_HaloItem",e}__reflect(n.prototype,"HeroHaloPanel_HaloItem")}(game=game||{}),function(e){var t,i=(t=eui.Component,__extends(o,t),o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.shape=new egret.Shape,this.shape.width=this.width,this.shape.height=this.height,this.addChild(this.shape)},o.prototype.bindXRender=function(e){this.xItemRender=e},o.prototype.update=function(e){var i=this;this.midNum=0,this.datas=e,this.datas.forEach(function(e,t){e>=2*i.midNum&&(i.midNum=e)}),this.lbs.forEach(function(e){e.parent.removeChild(e)}),this.lbs.splice(0),this.imgShuxians.forEach(function(e){e.parent.removeChild(e)}),this.imgShuxians.splice(0),this.img_firstLine&&(this.img_firstLine.visible=!1),this.renderX(),this.renderY(),this.render()},o.prototype.calX=function(e){return this.width/this.datas.length*e},o.prototype.calY=function(e){return this.height-e*this.height/2/this.midNum},o.prototype.generateLB=function(e){var t=new eui.Label(e.toString());return t.size=18,t.textColor=16776681,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height,this.addChild(t),this.lbs.push(t),t},o.prototype.renderX=function(){var n=this;this.xItemRender&&this.datas.forEach(function(e,t){var i=n.xItemRender(t,function(e){return n.generateLB(e)});if(i){var o=new eui.Image("shenbing_img_baitiao_png");o.anchorOffsetX=o.width/2,o.anchorOffsetY=o.height,o.x=i.x,o.y=n.height-10,n.addChild(o),n.imgShuxians.push(o)}})},o.prototype.renderY=function(){for(var e=this.height/this.yStep,t=2*this.midNum/this.yStep,i=0;i<this.yStep;i++)if(i%4==0){var o=this.generateLB(Number(Utils.MathUtils.toDecimal(i*t,2))+" -");o.anchorOffsetX=o.width,o.anchorOffsetY=o.height/2,o.x=7,o.y=this.height-i*e}},o.prototype.render=function(){var a=this;this.shape.graphics.clear(),this.shape.graphics.lineStyle(3,16776681,1),this.shape.graphics.moveTo(0,0),this.shape.graphics.lineTo(0,this.height),this.shape.graphics.moveTo(0,this.height),this.shape.graphics.lineTo(this.width,this.height),this.datas.forEach(function(e,t){var i=a.calX(t),o=a.calY(e);if(0==t?(a.shape.graphics.moveTo(i,o),a.showFirstLine&&(a.img_firstLine||(a.img_firstLine=new eui.Image,a.img_firstLine.source="shenbing_img_gushifengexian_png",a.addChild(a.img_firstLine)),a.img_firstLine.visible=!0,a.img_firstLine.x=i,a.img_firstLine.y=o)):a.shape.graphics.lineTo(i,o),a.shape.graphics.drawCircle(i,o,2),a.showLbOnLine){var n=a.generateLB(e);n.x=i,n.y=o}}),this.shape.graphics.endFill()},o);function o(){var e=t.call(this)||this;return e.showLbOnLine=!1,e.showFirstLine=!0,e.yStep=64,e.midNum=0,e.skinName="LineChartSkin",e.lbs=new Array,e.imgShuxians=new Array,e}e.LineChart=i,__reflect(i.prototype,"customui.LineChart",["eui.UIComponent","egret.DisplayObject"])}(customui=customui||{}),function(h){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.activateComponent(),this.rootPanel.blb_title.text="强者修炼",this.rootPanel.onCloseCB=function(){e.hide()}},i.prototype.updateView=function(e){var t=this;if(this.vo=e&&e.vo||this.vo,!this.heroModel.data){var i=void 0;0!=this.vo.dermaCode&&(i=h.Config.getHeroDermaConfig()[this.vo.dermaCode]),this.heroModel.update({code:this.vo.code,derma:i})}var o=this.vo.resonateLevelList[this.vo.resonateLevelList.length-1]||0;switch(this.pracConfigs=h.Config.heroPracticeConfig(this.vo.config.subType,o),this.pracConfigs.length?this.pracConfigs.some(function(e){if(e.order===t.vo.practiceLevel+1)return t.curPracConfig=e,!0})?this.curStatus=this.STATUS.PRACTICE:this.curStatus=this.STATUS.AWAKE:this.curStatus=this.STATUS.MAX,this.updateTopPart(),this.gp_practiceAttr.visible=!1,this.gp_baseitem.visible=!1,this.lb_max.visible=!1,this.btn_operate.visible=!0,this.icon_cost.visible=!0,this.curStatus){case this.STATUS.PRACTICE:this.gp_practiceAttr.visible=!0,this.updateForPractice();break;case this.STATUS.AWAKE:this.gp_baseitem.visible=!0,this.updateForAwake();break;case this.STATUS.MAX:this.lb_max.visible=!0,this.btn_operate.visible=this.icon_cost.visible=!1,this.updateForMax()}},i.prototype.updateTopPart=function(){var c=this,e=this.vo.resonateLevelList[this.vo.resonateLevelList.length-1]||0,t=this.curStatus===this.STATUS.MAX?e:e+1,l=this.vo.practiceLevel;this.pracConfigs=h.Config.heroPracticeConfig(this.vo.config.subType,t-1),this.pracConfigs.forEach(function(e){e.order===l+1&&(c.curPracConfig=e);var t=(e.order-1)%6+1,i=c["gp_attr_"+t],o=c["img_attr_"+t],n=c["blb_attr_"+t];o.source=e.icon+"_png";var a=JSON.parse(e.attr)[0][0];n.text=AttrConfig[a].name+"修炼",UIActionManager.setAbsGrey(i,l<e.order);var r=i.getChildByName("_effectOnObj");r&&r.parent.removeChild(r),l>=e.order&&DragonBoneTools.playOnce({effectName:"common_qzxljie",parent:i,loop:!0,z:1});var s=c["img_link_"+t];s&&(l<e.order?s.source=3==t?"juexing_img_xiantiao3_png":"juexing_img_xiantiao4_png":s.source=3==t?"juexing_img_xiantiao1_png":"juexing_img_xiantiao2_png")}),2<this.gp_badge.numChildren&&this.gp_badge.removeChildAt(1),DragonBoneTools.playOnce({effectName:"common_qzxlhuizhang_"+t,parent:this.gp_badge,loop:!0,z:1}),this.img_badge.source="juexing_img_duanwei"+t+"_png",this.blb_badge.text="修炼"+NUM_TO_ROMAN_NUM[t]+"阶"},i.prototype.updateForPractice=function(){this.scl_attrs.height=115;var e=JSON.parse(this.curPracConfig.attr)[0];this.lb_nextAttrName.text=""+AttrConfig[e[0]].name,this.blb_nextAttrValue.text="+"+h.GeneralConfig.getAttrValue(e[1]),this.gp_attrs.removeChildren();var t=h.Config.heroPracticeConfig(this.vo.config.subType),i={};for(var o in this.pracConfigs){var n=this.pracConfigs[o];i[JSON.parse(n.attr)[0][0]]="0"}for(var o in t){if((n=t[o]).order>this.vo.practiceLevel)break;var a=JSON.parse(n.attr)[0],r=h.GeneralConfig.getAttrValue(a[1]);i[a[0]]||(i[a[0]]="0");var s=i[a[0]];r.indexOf("%")<0?i[a[0]]=(Number(s)+Number(r)).toString():i[a[0]]=(Number(s.split("%")[0])+Number(r.split("%")[0])).toString()+"%"}for(var c in i)this.gp_attrs.addChild(this.makeAttrGp(Number(c),"+"+i[c]));var l=JSON.parse(this.curPracConfig.costs)[0];this.icon_cost.updateItem({cost:l,style:CommonIconStyle.RIGHT,needShowHave:!0}),this.lb_desc.text="当前修炼属性加成",this.btn_operate.label="修 炼"},i.prototype.updateForAwake=function(){var o=this;this.scl_attrs.height=65;var e=this.vo.resonateLevelList[this.vo.resonateLevelList.length-1]||0;if(!this.gp_baseitem.numChildren){var t=customui.BaseItemFactory.create();t.touchEnabled=!1,t.updateData({code:this.materialCode()}),this.gp_baseitem.addChild(t);var i=new eui.Image("common_img_jia_png");i.horizontalCenter=i.verticalCenter=0,this.gp_baseitem.addChild(i)}var n=this.gp_baseitem.getChildAt(0),a=this.gp_baseitem.getChildAt(1),r=!!this.selectedUuids.length;this.availableHeroNum(),UIActionManager.setAbsGrey(n,!r),egret.Tween.removeTweens(a),r?a.visible=!1:(a.visible=!0,a.alpha=1,this.availableHeroNum()&&UIActionManager.fadeBlink(a,!0,!1,1e3)),this.gp_attrs.removeChildren(),h.Config.heroResonateConfig(this.vo.config.subType,e+1).forEach(function(e,t){var i=JSON.parse(e.attrAdd1)[0];o.gp_attrs.addChild(o.makeAttrGp(i[0],"+"+h.GeneralConfig.getAttrValue(i[1])))}),this.awakeLevelConfig=h.Config.heroResonateLevelConfig(this.vo.config.subType,e+1);var s=JSON.parse(this.awakeLevelConfig.costs)[0];this.icon_cost.updateItem({cost:s,style:CommonIconStyle.RIGHT,needShowHave:!0}),this.lb_desc.text="下一羁绊属性",this.btn_operate.label="觉醒"},i.prototype.updateForMax=function(){this.scl_attrs.height=190,this.scl_attrs.verticalCenter=308,this.img_bg.height=220,this.gp_attrs.removeChildren();var e=h.Config.heroPracticeConfig(this.vo.config.subType),t={};for(var i in this.pracConfigs){var o=this.pracConfigs[i];t[(n=JSON.parse(o.attr)[0])[0]]="0"}for(var i in e){if((o=e[i]).order>this.vo.practiceLevel)break;var n=JSON.parse(o.attr)[0],a=h.GeneralConfig.getAttrValue(n[1]);t[n[0]]||(t[n[0]]="0");var r=t[n[0]];a.indexOf("%")<0?t[n[0]]=(Number(r)+Number(a)).toString():t[n[0]]=(Number(r.split("%")[0])+Number(a.split("%")[0])).toString()+"%"}for(var s in t)this.gp_attrs.addChild(this.makeAttrGp(Number(s),"+"+t[s]))},i.prototype.makeAttrGp=function(e,t){var i=new eui.Group;i.width=160;var o=new eui.HorizontalLayout;o.verticalAlign=egret.VerticalAlign.MIDDLE,o.gap=10,i.layout=o;var n=new eui.Label(AttrConfig[e].name);n.size=22,n.textColor=8866344,i.addChild(n);var a=new eui.BitmapLabel;return a.font="white_num_fnt",a.text=t,i.addChild(a),i},i.prototype.availableHeroNum=function(){var e=h.GameMVC.heroPy.allHeroByUuid,t=0;for(var i in e){var o=e[i];this.heroFilter(o)&&(t+=1)}return t},i.prototype.heroFilter=function(e){return 0==e.pos&&e.config.subType==this.vo.config.subType&&e.uuid!=this.vo.uuid&&5==e.config.initStar},i.prototype.materialCode=function(){var e=h.Config.allHeroConfig(),t=this.vo.config.subType;for(var i in e){var o=e[i];if(o.subType===t&&5==o.initStar)return o.code}},i.prototype.checkAllActivated=function(){var e=this.vo.resonateLevelList[this.vo.resonateLevelList.length-1]||0;return this.heroPy.getHeroResonateOrders(this.vo).length==4*(e+1)},i.prototype.activateComponent=function(){var n=this;Utils.ComponentUtils.registerListener(this.btn_operate,egret.TouchEvent.TOUCH_TAP,function(){switch(n.curStatus){case n.STATUS.PRACTICE:if(n.vo.config.initStar<n.curPracConfig.starLevel)return void Utils.MsgUtils.addMidMsg("当前英雄星级不足");if(!n.checkAllActivated())return void Utils.MsgUtils.addMidMsg("当前羁绊未全部激活");var e=JSON.parse(n.curPracConfig.costs);if(!h.GameMVC.backpackPy.checkEnough(e,!1)){var t=h.GameMVC.backpackPy.getInfoByCode(e[0][1]);return void Utils.MsgUtils.addMidMsg("当前"+t.info.name+"不足")}n.heroPy.HeroPractice({uuid:n.vo.uuid,cb:function(){n.curPracConfig.order,n.updateView()}});break;case n.STATUS.AWAKE:if(n.vo.config.initStar<n.awakeLevelConfig.starLevel)return void Utils.MsgUtils.addMidMsg("当前英雄星级不足");if(e=JSON.parse(n.awakeLevelConfig.costs),!h.GameMVC.backpackPy.checkEnough(e,!1))return t=h.GameMVC.backpackPy.getInfoByCode(e[0][1]),void Utils.MsgUtils.addMidMsg("当前"+t.info.name+"不足");var i=n.vo.resonateLevelList[n.vo.resonateLevelList.length-1]||0;n.selectedUuids.length?n.heroPy.UnlockHeroResonate({uuid:n.vo.uuid,level:i+1,uuids:n.selectedUuids,cb:function(){DragonBoneTools.playOnce({effectName:"common_qzxlbaoqi",parent:n.heroModel.gp_root,y:n.heroModel.gp_root.height,doneCB:function(){h.AppFacade.getInstance().hideSubView(h.HeroMediator.N,h.HeroMediator.SV.HERO_PRACTICE)}})}}):Utils.MsgUtils.addMidMsg("未放入英雄");break;case n.STATUS.MAX:Utils.MsgUtils.addMidMsg("你能点到这个按钮说明程序出问题了")}},this),Utils.ComponentUtils.registerListener(this.gp_baseitem,egret.TouchEvent.TOUCH_TAP,function(){if(PopUpManager.addPopUp({obj:new h.CommonChosePanel({getInfos:function(){var e={},t=h.GameMVC.heroPy.allHeroByUuid;for(var i in t){var o=t[i];n.heroFilter(o)&&(e[o.uuid]=o)}return e},type:EEntityType.EEntityTypeHero,checkFull:function(e){return 1<=e.length},selectUuids:n.selectedUuids,title:"请选择英雄"}),closeCB:function(e){n.updateView()}}),!n.availableHeroNum()){var e=n.materialCode();Utils.MsgUtils.addMidMsg("当前没有5星"+h.Config.allHeroConfig()[e].name)}},this)},i);function i(){var e=t.call(this)||this;return e.maxAwake=!1,e.selectedUuids=[],e.heroPy=h.GameMVC.heroPy,e.STATUS={PRACTICE:1,AWAKE:2,MAX:3},e.skinName="HeroPracticePanelSkin",e}h.HeroPracticePanel=e,__reflect(e.prototype,"game.HeroPracticePanel")}(game=game||{}),function(l){var t,e=(__extends(o,t=BasePanel),o.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.dtck_dtck.blb_title.text="置换",this.dtck_dtck.img_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.initUIEffect(this.EFFECT_CONFIG[o.EFFECT_TYPE.QIAN],o.EFFECT_TYPE.QIAN),this.addEvents(),this.initView()},o.prototype.initView=function(){this.btn_exchange.visible=!0,this.btn_cost.visible=!1,this.gp_stars.visible=!1,this.gp_name.visible=!1},o.prototype.addEvents=function(){this.btn_select.addEventListener(egret.TouchEvent.TOUCH_TAP,this.HelpDialog,this),this.btn_exchange.addEventListener(egret.TouchEvent.TOUCH_TAP,this.readyReplcement,this),this.hero_model0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectHero,this)},o.prototype.updateView=function(e){if(this.heroPy.replaceHeroInfo&&this.heroPy.replaceHeroInfo.uuid||e.uuid||e.hero){var t=void 0;this.curHeroInfo=e&&e.hero||this.heroPy.replaceHeroInfo;var i=e&&e.uuid||this.curHeroInfo.uuid;this.isReplace=e&&e.isReplace,this.isReplace?(this.hero_model0.touchEnabled=!1,this.hero_model0.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.selectHero,this),this.curHeroInfo=l.Config.allHeroConfig()[this.heroPy.replaceHeroInfo.code],t=this.curHeroInfo,this.curHeroInfo.uuid=i,this.curHeroInfo.starLevel=this.curHeroInfo.initStar):(this.hero_model0.touchEnabled=!0,this.hero_model0.addEventListener(egret.TouchEvent.TOUCH_TAP,this.selectHero,this),this.curHeroInfo=this.heroPy.allHeroByUuid[i],t=this.curHeroInfo.config),this.curHeroInfo?(this.btn_cost.visible=!0,this.gp_stars.visible=!0,this.gp_name.visible=!0):(this.btn_cost.visible=!1,this.gp_stars.visible=!1,this.gp_name.visible=!1),this.lb_name.text=t.name,this.hero_model.update({code:t.code,model:t.model,isStatic:!0}),this.img_race.source=HeroRaceConfig[t.race].raceIconBig,this.img_tier.source=l.GeneralConfig.getHeroJingyingTag(t.code);var o=l.GeneralConfig.getHeroStarInfo(this.curHeroInfo.starLevel);if(this.gp_stars.removeChildren(),o.stage<4)for(var n=0;n<o.num;n++)this.gp_stars.addChild(new eui.Image(o.src));else this.gp_stars.addChild(new customui.HighStarLevelIcon(o.num));var a=l.Config.heroReplacementConfig()[this.curHeroInfo.code];if(a){var r=JSON.parse(a.costs)[0],s=l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N).getInfoByCode(r[1]).haveNum||0,c=!(r[2]-s<0);this.btn_cost.updateItem({style:CommonIconStyle.RIGHT,cost:r,showEnough:c}),this.btn_cost.blb_num.text=s+"/"+r[2]}e&&e.effect&&this.switchEffect(e.effect)}else this.initView()},o.prototype.HelpDialog=function(){PopUpManager.addPopUp({obj:new l.HelpDialog({moduleId:MODULE.Replacement})})},o.prototype.selectHero=function(){l.AppFacade.getInstance().showSubView(l.HeroMediator.N,l.HeroMediator.SV.SELECT,{type:l.HeroSelectPanel.SELECTFORM.HERO_EXCHANGE,isPet:!1})},o.prototype.ensureReplacement=function(){this.isReplace=!1,this.btn_exchange.visible=!0,this.heroPy.affirmReplaceHero({uuid:this.curHeroInfo.uuid,isReplace:!0})},o.prototype.readyReplcement=function(){var t=this;if(this.curHeroInfo||this.heroPy.replaceHeroInfo.uuid){var e=l.Config.heroReplacementConfig()[this.curHeroInfo.code],i=JSON.parse(e.costs)[0],o=l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N).getInfoByCode(i[1]).haveNum||0;i[2]>o?Utils.MsgUtils.addMidMsg("您的道具不足"):"_hero_ar_m_json.common_img_chuanshuo"==this.img_tier.source?l.GameMgr.getInstance().showCommonTipsWin({commonTips:"当前英雄已经为传说级，是否需要置换？                          ",source:"hero_exchange",cb:!0,clickCB:function(e){1==e.type&&t.exchangeHero()}}):this.exchangeHero()}else Utils.MsgUtils.addMidMsg("未放入英雄")},o.prototype.exchangeHero=function(){var e=this;this.btn_exchange.touchEnabled=!1;var t=this.curHeroInfo&&this.curHeroInfo.uuid||this.heroPy.replaceHeroInfo&&this.heroPy.replaceHeroInfo.code;this.curHeroInfo,this.isReplace=!0,this.heroPy.replaceHero({uuid:t}),l.AppFacade.getInstance().updateView(l.HeroMediator.N,l.HeroMediator.SV.STARDOOR),egret.setTimeout(function(){e.btn_exchange.touchEnabled=!0},this,1e3)},o.prototype.cancelReplacement=function(){this.btn_exchange.visible=!0,this.heroPy.affirmReplaceHero({uuid:this.curHeroInfo.uuid,isReplace:!1})},o.prototype.initUIEffect=function(e,t,i){this["effect_"+t]?(this["effect_"+t].animation.play(),i&&i()):DragonBoneTools.create(e,function(e){this["effect_"+t]=e,this["effect_"+t].x=this.gp_effects.width/2,this["effect_"+t].y=this.gp_effects.height-100,this["effect_"+t].visible=!0,this["effect_"+t].animation.timeScale=1,this["effect_"+t].animation.play(),this.gp_effects.addChild(this["effect_"+t]),i&&i()},this)},o.prototype.switchEffect=function(e){var t,i=this;(this.curEffect=this.curEffect?this.curEffect:o.EFFECT_TYPE.QIAN,e)?(e!=this.curEffect&&(t=function(){i.curEffect!=o.EFFECT_TYPE.QIAN&&(i["effect_"+i.curEffect].animation.stop(),i["effect_"+i.curEffect].visible=!1),i["effect_"+e].visible=!0,i.curEffect=e}),this.initUIEffect(this.EFFECT_CONFIG[e],e,t)):this.initUIEffect(this.EFFECT_CONFIG[this.curEffect],this.curEffect,function(){i.curEffect=e})},o.prototype.perClose=function(){this.heroPy.replaceHeroInfo&&this.isReplace&&this.cancelReplacement()},o.EFFECT_TYPE={QIAN:1,FANGRU:2,CHENGGONG:3},o);function o(){var e=t.call(this)||this;return e.heroPy=l.AppFacade.getInstance().retrieveProxy(l.HeroPy.N),e.isReplace=!1,e.EFFECT_CONFIG={1:"common_zhihuanqian",2:"common_zhihuanfangru",3:"common_zhihuanchenggong"},e.skinName="HeroReplacementSkin",e.heroPy.getReplaceInfo(),e}l.HeroReplacementView=e,__reflect(e.prototype,"game.HeroReplacementView")}(game=game||{}),function(d){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.list_item.itemRenderer=n,this.ac_item=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_item},i.prototype.updateView=function(e){var t=e.vo,i=t.config.subType,o=d.GameMVC.heroPy.getHeroResonateOrders(t),n=[{level:0,attrs:[],activated:!0}],a=d.Config.heroResonateConfig(i,0);for(var r in a){var s=a[r],c=JSON.parse(s.attrAdd1);n[0].attrs.push({attr:c,activated:0<=o.indexOf(s.order)})}for(var l=1,h=d.Config.heroResonateLevelConfig(i,l);h;){a=d.Config.heroResonateConfig(i,l);var p={level:l,starLevel:h.starLevel,attrs:[],activated:!1};for(var r in a)s=a[r],p.attrs.push({attr:JSON.parse(s.attrAdd1),activated:0<=o.indexOf(s.order)});p.activated=0<=t.resonateLevelList.indexOf(l),n.push(p),h=d.Config.heroResonateLevelConfig(i,++l)}this.ac_item.replaceAll(n)},i);function i(){var e=t.call(this)||this;return e.skinName="HeroResonateAttrSkin",e}d.HeroResonateAttrPanel=e,__reflect(e.prototype,"game.HeroResonateAttrPanel");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this)},a.prototype.dataChanged=function(){var o=this,e=[];0===this.data.level?e.push({text:"初级羁绊属性"}):e.push({text:"羁绊"+NUM_TO_ROMAN_NUM[this.data.level]+"属性"});var t=this.data.attrs,n=!0;t.forEach(function(e,t){var i=e.attr;o["lb_attr"+(t+1)].text=AttrConfig[i[0][0]].name+"加成："+d.GeneralConfig.getAttrValue(i[0][1]),o["lb_attr"+(t+1)].textColor=e.activated?16775908:8878698,n=n&&e.activated}),n?this.img_status.visible=!1:(this.img_status.visible=!0,this.img_status.source=this.data.activated?"jiban_img_yijihuo_png":"jiban_img_weijihuo_png",0!=this.data.level&&e.push({text:"（"+this.data.starLevel+"星解锁）",style:{textColor:6091519}})),this.lb_title.textFlow=e},a);function a(){var e=o.call(this)||this;return e.skinName="HeroResonateAttrPanel_ListItem",e}__reflect(n.prototype,"HeroResonateAttrPanel_ListItem")}(game=game||{}),function(a){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent()},i.prototype.updateView=function(e){var o=this;this.heroVO=e&&e.vo||this.heroVO;var t=this.heroVO.config.subType;this.curLevel=this.heroVO.resonateLevelList[this.heroVO.resonateLevelList.length-1]||0,this.targetConfig=a.Config.heroResonateLevelConfig(t,this.curLevel+1);var i=this.targetConfig.selfNum;if(this.gp_slots.numChildren||this.gp_slots.addChild(new r),this.gp_slots.getChildAt(0).update({uuids:this.selectedUuids,requestNum:i,vo:this.heroVO,availableHeroNum:function(){return o.availableHeroNum()},heroFilter:function(e){return o.heroFilter(e)}}),a.Config.heroResonateConfig(t,this.curLevel).forEach(function(e,t){var i=JSON.parse(e.attrAdd1)[0];o["lb_cur_"+(t+1)].text=AttrConfig[i[0]].name+"加成："+a.GeneralConfig.getAttrValue(i[1])}),a.Config.heroResonateConfig(t,this.curLevel+1).forEach(function(e,t){var i=JSON.parse(e.attrAdd1)[0];o["lb_next_"+(t+1)].text=AttrConfig[i[0]].name+"加成："+a.GeneralConfig.getAttrValue(i[1])}),this.available){this.icon_cost.visible=!0,this.lb_tips.visible=!1;var n=JSON.parse(this.targetConfig.costs)[0];this.icon_cost.updateItem({cost:n,style:CommonIconStyle.RIGHT,needShowHave:!0})}else this.icon_cost.visible=!1,this.lb_tips.visible=!0,this.lb_tips.text="到达"+this.targetConfig.starLevel+"星且当前羁绊全部激活后可觉醒"},i.prototype.availableHeroNum=function(){var e=a.GameMVC.heroPy.allHeroByUuid,t=0;for(var i in e){var o=e[i];this.heroFilter(o)&&(t+=1)}return t},i.prototype.checkAllActivated=function(){var e=this.heroVO.resonateLevelList[this.heroVO.resonateLevelList.length-1]||0;return this.heroPy.getHeroResonateOrders(this.heroVO).length==4*(e+1)},i.prototype.checkStarAvailable=function(){var e=this.heroVO.config.subType,t=this.heroVO.resonateLevelList[this.heroVO.resonateLevelList.length-1]||0,i=a.Config.heroResonateLevelConfig(e,t+1);return this.heroVO.config.initStar>=i.starLevel},i.prototype.heroFilter=function(e){return 0==e.pos&&e.config.subType==this.heroVO.config.subType&&e.uuid!=this.heroVO.uuid&&5==e.config.initStar},i.prototype.activateComponent=function(){var n=this;Utils.ComponentUtils.registerListener(this.btn_auto,egret.TouchEvent.TOUCH_TAP,function(){if(n.selectedUuids.length<n.targetConfig.selfNum)if(n.availableHeroNum()){var e=[],t=n.heroPy.allHeroByUuid;for(var i in t){var o=t[i];n.heroFilter(o)&&e.push(o)}if(e.every(function(e){return e.isLocked}))Utils.MsgUtils.addMidMsg("该英雄已经被锁住");else{for(e.sort(function(e,t){var i=a.GameMVC.backpackPy.checkHeroInTeam(e.uuid);if(i!=a.GameMVC.backpackPy.checkHeroInTeam(t.uuid))return i?1:-1});n.selectedUuids.length<n.targetConfig.selfNum&&e.length;)n.selectedUuids.push(e.shift().uuid);n.updateView()}}else Utils.MsgUtils.addMidMsg("所需英雄不足")},this),Utils.ComponentUtils.registerListener(this.btn_unlock,egret.TouchEvent.TOUCH_TAP,function(){var e=n.checkAllActivated(),t=n.checkStarAvailable();e||t?t?e?n.selectedUuids.length<n.targetConfig.selfNum?Utils.MsgUtils.addMidMsg("觉醒条件不足"):n.heroPy.UnlockHeroResonate({uuid:n.heroVO.uuid,level:n.curLevel+1,uuids:n.selectedUuids,cb:function(){n.hide()}}):Utils.MsgUtils.addMidMsg("当前羁绊未全部激活"):Utils.MsgUtils.addMidMsg("该英雄星级未满足条件"):Utils.MsgUtils.addMidMsg(n.lb_tips.text)},this)},i.prototype.perShow=function(e){if(this.heroVO=e.vo,this.checkAllActivated()){if(!this.checkStarAvailable()){var t=this.heroVO.config.subType,i=this.heroVO.resonateLevelList[this.heroVO.resonateLevelList.length-1]||0,o=a.Config.heroResonateLevelConfig(t,i+1);Utils.MsgUtils.addMidMsg("该英雄需要到达"+o.starLevel+"星方可觉醒"),this.available=!1}}else Utils.MsgUtils.addMidMsg("需要激活当前全部羁绊方可觉醒"),this.available=!1;return!0},i);function i(){var e=t.call(this)||this;return e.heroPy=a.GameMVC.heroPy,e.available=!0,e.selectedUuids=[],e.skinName="HeroResonateUnlockSkin",e}a.HeroResonateUnlockPanel=e,__reflect(e.prototype,"game.HeroResonateUnlockPanel");var o,r=(o=eui.Component,__extends(n,o),n.prototype.childrenCreated=function(){var n=this;o.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this,egret.TouchEvent.TOUCH_TAP,function(){if(PopUpManager.addPopUp({obj:new a.CommonChosePanel({getInfos:function(){var e={},t=a.GameMVC.heroPy.allHeroByUuid;for(var i in t){var o=t[i];n.heroFilter(o)&&(e[o.uuid]=o)}return e},type:EEntityType.EEntityTypeHero,checkFull:function(e){return e.length>=n.data.requestNum},selectUuids:n.data.uuids,title:"请选择英雄"}),closeCB:function(e){a.AppFacade.getInstance().updateView(a.HeroMediator.N,a.HeroMediator.SV.RESONATE_UNLOCK)}}),!n.availableHeroNum()){var e=n.getSelfCode();Utils.MsgUtils.addMidMsg("当前没有5星"+a.Config.allHeroConfig()[e].name)}},this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_bi.addChild(this.baseItem),this.data&&this.update(this.data)},n.prototype.update=function(e){this.data=e,this.availableHeroNum=e.availableHeroNum,this.heroFilter=e.heroFilter;var t=this.data.uuids.length,i=this.data.requestNum;this.blb_num.text=t+"/"+i,egret.Tween.removeTweens(this.img_add),this.img_add.alpha=1,t==i?(this.img_add.visible=!1,this.blb_num.font="green_num_fnt",UIActionManager.setGrey(this.gp_bi,!1)):(this.img_add.visible=!0,this.blb_num.font="white_num_fnt",this.availableHeroNum()>=this.data.requestNum&&UIActionManager.fadeBlink(this.img_add,!0,!1,1e3),UIActionManager.setGrey(this.gp_bi,!0)),this.baseItem.updateData({code:this.getSelfCode()})},n.prototype.getSelfCode=function(){var e=a.Config.allHeroConfig(),t=this.data.vo.config.subType;for(var i in e){var o=e[i];if(o.subType===t&&5==o.initStar)return o.code}},n);function n(e){var t=o.call(this)||this;return t.skinName="HeroArtifactPeiYangView4_SlotItem",t.data=e,t}__reflect(r.prototype,"HeroResonateUnlockPanel_SlotItem")}(game=game||{}),function(u){var t,i=(__extends(g,t=BasePanel),g.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.initFilterList(),this.activateComponent()},g.prototype.perShow=function(e){return this.selectType=this.selectType=e&&e.type||g.SELECTFORM.HERO_MAIN,!0},g.prototype.initList=function(){this.list_item.itemRenderer=e,UIActionManager.hideScrollerBar(this.scl_list)},g.prototype.initFilterList=function(){var e;switch(this.selectType){case g.SELECTFORM.HERO_MAIN:case g.SELECTFORM.HERO_MUTI_TEAM:case g.SELECTFORM.HERO_ROLLBACK:e=[{icon:"_hero_ar_m_json.common_icon_zhongzu_1",race:HeroRaceType.Human},{icon:"_hero_ar_m_json.common_icon_zhongzu_2",race:HeroRaceType.Orc},{icon:"_hero_ar_m_json.common_icon_zhongzu_4",race:HeroRaceType.Elf},{icon:"_hero_ar_m_json.common_icon_zhongzu_3",race:HeroRaceType.Athanasy},{icon:"_hero_ar_m_json.common_icon_zhongzu_5",race:HeroRaceType.Demon},{icon:"_hero_ar_m_json.common_icon_zhongzu_6",race:HeroRaceType.Eldar}];break;case g.SELECTFORM.HERO_EXCHANGE:e=[{icon:"_hero_ar_m_json.common_icon_zhongzu_1",race:HeroRaceType.Human},{icon:"_hero_ar_m_json.common_icon_zhongzu_2",race:HeroRaceType.Orc},{icon:"_hero_ar_m_json.common_icon_zhongzu_4",race:HeroRaceType.Elf},{icon:"_hero_ar_m_json.common_icon_zhongzu_3",race:HeroRaceType.Athanasy}]}this.list_filter.itemRenderer=r,this.list_filter.dataProvider=new eui.ArrayCollection(e),this.list_filter.x=(this.gp_content.width-(80*e.length+15*(e.length-1)))/2,this.list_filter.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onItemTap,this)},g.prototype.onItemTap=function(e){var t=e.item.race;for(var i in this.selectedRace=this.selectedRace==t?0:t,this.list_filter.$children){var o=this.list_filter.$children[i];o.updateSelected(o.data.race==this.selectedRace)}this.scl_list.stopAnimation(),this.scl_list.viewport.scrollV=0,this.updateView()},g.prototype.updateView=function(e){var c=this;function t(e){for(var t in l){var i=l[t];c.selectedRace&&i.config.race!=c.selectedRace||i.pos||!i.config.race||e(i)}}this.rootPanel.blb_title.text="英雄",this.btnFunc=e&&e.btnFunc||this.btnFunc;var a=[],l=this.heroProxy.allHeroByUuid;switch(this.selectType){case g.SELECTFORM.HERO_MAIN:if(this.targetPos=e&&e.pos||this.targetPos,!this.targetPos)for(var i=1;i<=6;i++)if(!this.heroProxy.heroUuid22Pos[i]){this.targetPos=i;break}t(function(s){a.push({type:c.selectType,info:s,btnFunc:function(){var e=u.GameMVC.heroThingPy.AllEquipInfo,t="",i="",o=u.Config.allHeroConfig();for(var n in u.GameMVC.heroPy.heroUuid22Pos)(r=u.GameMVC.heroPy.heroUuid22Pos[n])==c.targetPos&&(i=o[l[n].code].name);for(var a in e){var r;if((r=e[a]).heroUuid&&(r.heroUuid==s.uuid&&(t=o[l[r.heroUuid].code].name),t&&i)){Utils.MsgUtils.addMidMsg(t+"所戴装备已移交于"+i);break}}c.heroProxy.HeroPutOn({uuid:s.uuid,pos:c.targetPos}),c.hide()}})});break;case g.SELECTFORM.HERO_EXCHANGE:t(function(e){var t=u.Config.constConfig().HeroReplaceRange,i=u.Config.allHeroConfig(),o=JSON.parse(t.constValue);e.starLevel>=o[0]&&e.starLevel<=o[1]&&i[e.code]&&i[e.code].race!=HeroRaceType.Demon&&i[e.code].race!=HeroRaceType.Eldar&&a.push({type:c.selectType,info:e,btnFunc:function(){e.isLocked?Utils.MsgUtils.addMidMsg("该英雄已上锁"):(u.AppFacade.getInstance().updateView(u.HeroMediator.N,u.HeroMediator.SV.HERO_REPLACEMENT,{uuid:e.uuid,effect:u.HeroReplacementView.EFFECT_TYPE.FANGRU}),c.hide())}})});break;case g.SELECTFORM.HERO_ROLLBACK:var o=u.Config.heroRollBackConfig();t(function(e){o[e.starLevel]&&e.config.race&&e.config.profession&&a.push({type:c.selectType,info:e,btnFunc:function(){e.isLocked?Utils.MsgUtils.addMidMsg("该英雄已上锁"):(c.btnFunc&&c.btnFunc(e.uuid),c.hide())}})});break;case g.SELECTFORM.HERO_MUTI_TEAM:this.targetPos=e&&e.pos||this.targetPos,this.teamId=e&&e.teamId||this.teamId||1;var r=u.GameMVC.heroMutiTeamPy.getTeam(this.teamId);if(r&&!this.targetPos)for(i=1;i<=6;i++){var n=!1;for(var s in r.heroList)if(r.heroList[s].pos==i){n=!0;break}if(!n){this.targetPos=i;break}}function h(e){var t=l[e],i="";for(var o in r.heroList){var n=r.heroList[o];if(n.originalUuid==t.uuid){i=n.uuid;break}}i||p.selectedRace&&t.config.race!=p.selectedRace||!t.config.race||a.push({type:p.selectType,info:t,btnFunc:function(){c.btnFunc&&c.btnFunc(t.uuid),c.hide()}})}var p=this;for(var d in l)h(d)}a.sort(function(e,t){var i=e.info,o=t.info;return e.type!=g.SELECTFORM.HERO_MAIN&&i.isLocked!=o.isLocked?i.isLocked?1:-1:i.starLevel!=o.starLevel?o.starLevel-i.starLevel:i.level!=o.level?o.level-i.level:i.config.race!=o.config.race?i.config.race-o.config.race:i.config.profession!=o.config.profession?HERO_SORT_ORDER[o.config.profession]-HERO_SORT_ORDER[i.config.profession]:i.config.code-o.config.code}),this.list_item.dataProvider=new eui.ArrayCollection(a),0<a.length?this.gp_empty.visible=!1:this.gp_empty.visible=!0},g.prototype.activateComponent=function(){var e=this;this.rootPanel.onCloseCB=function(){e.hide()}},g.SELECTFORM={HERO_MAIN:1,HERO_EXCHANGE:2,HERO_ROLLBACK:3,HERO_MUTI_TEAM:4},g);function g(){var e=t.call(this)||this;return e.skinName="HeroSelectSkin",e.heroProxy=u.AppFacade.getInstance().retrieveProxy(u.HeroPy.N),e}u.HeroSelectPanel=i,__reflect(i.prototype,"game.HeroSelectPanel");var o,e=(o=eui.ItemRenderer,__extends(n,o),n.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.btn_oper.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.btnFunc&&this.data.btnFunc()},this),this.gp_baseitem.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.AppFacade.getInstance().showSubView(u.HeroMediator.N,u.HeroMediator.SV.HERO_DETAIL,{code:this.data.info.code})},this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem)},n.prototype.dataChanged=function(){var e=void 0,t=!1;0==this.data.info.dermaCode?(e=this.data.info.config.avatar,this.lb_name.text=this.data.info.config.name):(e=u.Config.getHeroDermaConfig()[this.data.info.dermaCode].avatar,this.lb_name.text=u.Config.getHeroDermaConfig()[this.data.info.dermaCode].name,t=!0),this.baseItem.updateData({uuid:this.data.info.uuid,type:EEntityType.EEntityTypeHero,effect:!0,isShowZhongZhu:!0,avatar:e,isShowEffect:t}),this.data.type!=i.SELECTFORM.HERO_MAIN?(this.gp_lock.visible=this.data.info.isLocked,UIActionManager.setGrey(this.gp_baseitem,this.data.info.isLocked)):this.gp_lock.visible=!1},n);function n(){var e=o.call(this)||this;return e.skinName="HeroSelectPanel_HeroItem",e}__reflect(e.prototype,"HeroSelectPanel_HeroItem");var a,r=(a=eui.ItemRenderer,__extends(s,a),s.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.selected=!1},s.prototype.dataChanged=function(){this.width=80,this.img_icon.source=this.data.icon,this.updateSelected(this.selected)},s.prototype.updateSelected=function(e){this.selected=e,this.img_selected.visible=this.selected},s);function s(){var e=a.call(this)||this;return e.skinName="HeroSelectPanel_TabbarItem",e}__reflect(r.prototype,"HeroSelectPanel_TabbarItem")}(game=game||{}),function(I){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.addListener(),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this,t=!0;for(var i in this.upstarData)if(!this.upstarData[i].full){t=!1;break}if(t){var o=[];for(var i in this.upstarData)for(var n=0,a=this.upstarData[i].uuids;n<a.length;n++){var r=a[n];o.push({slotNum:Number(i),uuid:r})}this.heroPy.UpHeroDefend({uuid:this.data.uuid,uuidInfos:o,cb:function(){e.hide(),e.cb&&e.cb()}})}else Utils.MsgUtils.addMidMsg("道具不足")},this)},i.prototype.addListener=function(){this.skill_item.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.showSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_END,this.hideSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.hideSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.hideSkillDetail,this)},i.prototype.initList=function(){this.attr_list.itemRendererSkinName="HeroUpsectionPanel_AttrItem",this.attr_list_1.itemRendererSkinName="HeroDefendPanel_AttrItem"},i.prototype.updateView=function(e){var t=this;e&&e.info&&(this.data=e.info,this.cb=e.cb);var i=this.data.defendLevel,o=I.Config.heroDefendConfig(this.data.config.subType),n=void 0,a=void 0;for(var r in o)o[r].level==i?n=o[r]:o[r].level==i+1&&(a=o[r]);I.Config.allHeroConfig()[this.data.code];var s=[];s.push({desc:"等级上限：",before:n&&n.maxLevel||300,after:a.maxLevel}),this.attr_list.dataProvider=new eui.ArrayCollection(s);var c=JSON.parse(a&&a.attr),l=[];c.forEach(function(e){var t={desc:AttrConfig[e[0]].name+"：",after:"+"+I.GeneralConfig.getAttrValue(e[1])};l.push(t)}),this.attr_list_1.dataProvider=new eui.ArrayCollection(l);var h=[];h=n?JSON.parse(n.skills):[this.data.config.actSkill,this.data.config.posSkill1,this.data.config.posSkill2,this.data.config.posSkill3],this.gp_unlock.visible=!1;for(var p=JSON.parse(a.skills),d=0;d<h.length;d++)h[d]!=p[d]&&(this.skill=p[d]);this.skill?(this.gp_unlock.visible=!0,this.skill_item.updateItem({code:this.skill}),this.skillDetailPanel.updateItem({code:this.skill})):this.gp_unlock.visible=!1,this.gp_cost.removeChildren();var u=JSON.parse(a.fiveSlotCosts)[1];for(u.forEach(function(e){t.gp_cost.addChild(new customui.CommonIconWithNum({cost:e,showEnough:!0,style:CommonIconStyle.RIGHT}))}),this.gp_chosenHero.removeChildren(),d=1;d<=4;d++)if(""!=a[this.conditionMap[d]]){this.upstarData[d]||(this.upstarData[d]={condition:a[this.conditionMap[d]],full:!1,uuids:[]}),this.upstarData[d];var g=new f({data:this.upstarData,slot:d,targetUuid:this.data.uuid});g.scaleX=g.scaleY=1.2,this.gp_chosenHero.addChild(g)}this.resource_bar.updateBar(u)},i.prototype.showSkillDetail=function(){this.skillDetailPanel.updateItem({code:this.skill}),this.skillDetailPanel.visible=!0},i.prototype.hideSkillDetail=function(){this.skillDetailPanel.visible=!1},i);function i(){var e=t.call(this)||this;return e.conditionMap={1:"oneSlotCosts",2:"twoSlotCosts",3:"threeSlotCosts",4:"fourSlotCosts"},e.upstarData={},e.cb=void 0,e.skinName="HeroStarDefendSkin",e.heroPy=I.AppFacade.getInstance().retrieveProxy(I.HeroPy.N),e}I.HeroStarDefendPanel=e,__reflect(e.prototype,"game.HeroStarDefendPanel");var o,f=(o=eui.Component,__extends(n,o),n.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_avatar.addChild(this.baseItem),this.updateItem(),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){I.AppFacade.getInstance().showSubView(I.HeroMediator.N,I.HeroMediator.SV.SELECT_UPSTAR,{data:this.data.data,targetUuid:this.data.targetUuid,slot:this.data.slot})},this)},n.prototype.updateItem=function(e){var t=this.data.data[this.data.slot],i=JSON.parse(t.condition),o=t.uuids.length,n=0,a=this.heroProxy.allHeroByUuid,r=I.Config.allHeroConfig(),s=0,c=0,l=0,h=[],p=this.heroThingProxy.AllDermaInfo,d=void 0;for(var u in p)if(p[u].heroUuid==this.data.uuid){d=p[u].config.avatar;break}if(this.baseItem.img_tag.visible=!1,1==i[0])this.baseItem.img_icon.visible=!0,d?this.baseItem.updateData({code:i[1][0][1],avatar:d,isShowEffect:!0}):this.baseItem.updateData({code:i[1][0][1]}),n=i[1][0][2];else if(2==i[0]){var g=this.findRandomHero(i[1]);d?this.baseItem.updateData({code:g,avatar:d,isShowEffect:!0}):this.baseItem.updateData({code:g}),i[1][0]?this.baseItem.img_type.visible=!0:this.baseItem.img_type.visible=!1;var f=I.Config.allHeroConfig()[g].initStar,_=1;[[0,3],[4,4],[5,5],[6,8],[9,9],[10,15]].forEach(function(e,t){f>=e[0]&&f<=e[1]&&(_=t+1)}),this.baseItem.img_icon.source="beibao_img_sptb_"+_+"_png",n=i[1][3]}else if(3==i[0]){g=this.findRandomHero(i[1]),this.baseItem.updateData({code:g}),this.baseItem.img_type.visible=!1;var m=I.Config.allHeroConfig()[g].initStar,y=1;[[0,3],[4,4],[5,5],[6,8],[9,9],[10,15]].forEach(function(e,t){m>=e[0]&&m<=e[1]&&(y=t+1)}),this.baseItem.img_icon.source="beibao_img_sptb_"+y+"_png",this.baseItem.img_tag.visible=!0,1==i[1][0]?this.baseItem.img_tag.visible=!1:2==i[1][0]?this.baseItem.img_tag.source="yingxion_txt_xiyou_png":3==i[1][0]?this.baseItem.img_tag.source="yingxion_txt_jingying_png":this.baseItem.img_tag.source="yingxion_txt_chuanshuo_png",n=i[1][2]}for(var v in this.blb_num.text=o+"/"+n,this.data.data)h=h.concat(this.data.data[v].uuids);for(var T in a){var C=a[T],E=r[C.code];T==this.data.targetUuid||-1!=h.indexOf(T)||this.heroProxy.heroUuid22Pos[T]||(1==i[0]?C.code==i[1][0][1]&&s++:2==i[0]?0!=i[1][0]&&E.race!=i[1][0]||0!=i[1][1]&&C.starLevel!=i[1][1]||0!=i[1][2]&&E.profession!=i[1][2]||c++:3==i[0]&&i[1][1]==E.initStar&&i[1][0]==E.color&&l++)}UIActionManager.setAbsGrey(this.gp_avatar,o!=n),this.img_add.visible=o!=n?n<=s||n<=c||n<=l:o!=n,UIActionManager.setGrey(this.baseItem,this.img_add.visible),this.gp_effect.removeChildren(),this.img_add.visible?egret.Tween.get(this.img_add,{loop:!0}).to({alpha:0},700,egret.Ease.cubicIn).wait(250).to({alpha:1},700,egret.Ease.cubicOut):e&&e.effect&&DragonBoneTools.playOnce({effectName:"common_yingxiongshengxing",parent:this.gp_effect,y:this.gp_effect.height/2,x:this.gp_effect.width/2})},n.prototype.findRandomHero=function(e){var t=I.Config.allHeroConfig();for(var i in t){var o=t[i];if(!(0!=e[0]&&o.race!=e[0]||0!=e[1]&&o.initStar!=e[1]||0!=e[2]&&o.profession!=e[2]))return Number(i)}},n);function n(e){var t=o.call(this)||this;return t.heroProxy=I.AppFacade.getInstance().retrieveProxy(I.HeroPy.N),t.data=e,t.skinName="HeroMainView_UpstarItem",t.heroThingProxy=I.AppFacade.getInstance().retrieveProxy(I.HeroThingPy.N),t}__reflect(f.prototype,"HeroMainView_UpstarItem")}(game=game||{}),function(g){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.addListener(),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.heroPy.HeroUpSection({uuid:this.data.uuid})},this)},i.prototype.addListener=function(){this.skill_item.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.showSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_END,this.hideSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.hideSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.hideSkillDetail,this)},i.prototype.initList=function(){this.attr_list.itemRendererSkinName="HeroUpsectionPanel_AttrItem"},i.prototype.updateView=function(e){var t=this;this.data=e.data,this.isPet=e.isPet,this.data.level;var i=g.Config.heroAndPetSectionConfig(this.isPet),o=i[this.data.sectionLevel+1],n=i[this.data.sectionLevel],a=i[this.data.sectionLevel+2],r=g.Config.allHeroConfig(this.isPet)[this.data.code],s=[];s.push({desc:"等级上限：",before:o.level,after:Math.min(r.maxLevel,a&&a.level||9999999)});var c=JSON.parse(o.attr),l=JSON.parse(n&&n.attr),h=JSON.parse(this.data.attr);c.forEach(function(t){var i=0;l.forEach(function(e){t[0]==e[0]&&(i=e[1])});var e={desc:AttrConfig[t[0]].name+"：",before:Math.floor(Number(g.GeneralConfig.getAttrValue(h[t[0]]))).toString()};e.after=Math.floor(Number(e.before)+Number(g.GeneralConfig.getAttrValue(t[1]))-Number(g.GeneralConfig.getAttrValue(i))).toString(),s.push(e)}),this.attr_list.dataProvider=new eui.ArrayCollection(s),this.gp_unlock.visible=!1;var p=JSON.parse(r.skillUnlock).indexOf(o.id);if(-1!=p){var d=r[SKILL_CODE[p]];d?(this.gp_unlock.visible=!0,this.skill_item.updateItem({code:d}),this.skillDetailPanel.updateItem({code:d})):this.skill_item.reset()}var u=JSON.parse(o.costs);u.forEach(function(e){t.gp_cost.addChild(new customui.CommonIconWithNum({cost:e,showEnough:!0,style:CommonIconStyle.RIGHT}))}),this.resource_bar.updateBar(u)},i.prototype.showSkillDetail=function(){this.skillDetailPanel.visible=!0},i.prototype.hideSkillDetail=function(){this.skillDetailPanel.visible=!1},i);function i(){var e=t.call(this)||this;return e.skinName="HeroUpsectionSkin",e.heroPy=g.AppFacade.getInstance().retrieveProxy(g.HeroPy.N),e}g.HeroUpsectionPanel=e,__reflect(e.prototype,"game.HeroUpsectionPanel")}(game=game||{}),function(_){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.activateComponent()},i.prototype.initList=function(){this.ac_list=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_list,this.list_item.itemRenderer=n,this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onListItemTap,this)},i.prototype.onListItemTap=function(e){var o=this,t=e.item,n=t.info;n.isLocked?Utils.MsgUtils.addMidMsg("该"+ENTITY_2_NAME[n.entityType]+"已经被锁住"):t.chosen?(this.upstarData[this.slot].uuids.splice(this.upstarData[this.slot].uuids.indexOf(n.uuid),1),this.full=!1,this.upstarData[this.slot].full=this.full,t.chosen=!1,this.ac_list.replaceAll(this.ac_list.source),this.updateCondition()):this.full?Utils.MsgUtils.addMidMsg("当前已选满"):_.GameMgr.getInstance().showCommonTipsWin({commonTips:"该英雄为高级英雄，升星后会被消耗，请确认选择。",clickCB:function(e){e.type&&(o.upstarData[o.slot].uuids.push(n.uuid),o.full=o.checkFull(),o.upstarData[o.slot].full=o.full,t.chosen=!0,o.ac_list.replaceAll(o.ac_list.source),o.updateCondition())},directCall:function(){var e=JSON.parse(_.Config.constConfig().HeroUpstarHintLimit.constValue),t=_.GameMVC.playerPy.playerInfoVO.level,i=_.Config.allHeroConfig()[n.code].tier;return!(t>=e[0]&&t<e[1]&&0<=e[2].indexOf(i))||1===JSON.parse(o.upstarData[o.slot].condition)[0]},source:"HERO_UPSTAR_SELECT",cb:!0})},i.prototype.checkFull=function(){var e=JSON.parse(this.upstarData[this.slot].condition);return 1==e[0]&&this.upstarData[this.slot].uuids.length==e[1][0][2]||2==e[0]&&this.upstarData[this.slot].uuids.length==e[1][3]||3==e[0]&&this.upstarData[this.slot].uuids.length==e[1][2]},i.prototype.updateView=function(e){var n=this,t=[],i=_.Config.allHeroConfig();this.upstarData=e&&e.data||this.upstarData,this.slot=e&&e.slot||this.slot,this.full=this.checkFull(),this.targetHero=this.heroProxy.allHeroByUuid[e.targetUuid];var o=[];for(var a in this.upstarData)o=o.concat(this.upstarData[a].uuids);for(var r=JSON.parse(this.upstarData[this.slot].condition),s=this.heroProxy.allHeroByUuid,c=0,l=this.upstarData[this.slot].uuids;c<l.length;c++)s[u=l[c]]&&t.push({info:s[u],chosen:!0});if(1==r[0])(f=_.Config.allHeroConfig()[r[1][0][1]])&&(this.lb_title.text="请选择"+f.name+"英雄");else if(2==r[0]){var h="请选择";r[1][0]&&(h+=HeroRaceConfig[r[1][0]].name),r[1][1]&&(h+=r[1][1]+"星"),r[1][2]&&(h+=ProfessionConfig[r[1][2]].name),h+="英雄",this.lb_title.text=h}else if(3==r[0]){if(h="请选择",r[1][1]&&(h+=r[1][1]+"星"),r[1][0]){var p=r[1][0],d="";4==p?d="传说":3==p?d="精英":2==p&&(d="稀有"),h+=d}h+="英雄",this.lb_title.text=h}for(var u in s){var g=s[u],f=i[g.code];g&&u!=this.targetHero.uuid&&-1==o.indexOf(u)&&!this.heroProxy.heroUuid22Pos[u]&&(1==r[0]?g.code==r[1][0][1]&&t.push({info:g,chosen:!1}):2==r[0]?0!=r[1][0]&&f.race!=r[1][0]||0!=r[1][1]&&g.starLevel!=r[1][1]||0!=r[1][2]&&f.profession!=r[1][2]||t.push({info:g,chosen:!1}):3==r[0]&&r[1][1]==f.initStar&&r[1][0]==f.color&&t.push({info:g,chosen:!1}))}t.length?(this.gp_empty.visible=!1,this.btn_confirm.visible=!0):(this.gp_empty.visible=!0,this.btn_confirm.visible=!1),t.sort(function(e,t){var i=e.info,o=t.info;return i.isLocked!=o.isLocked?i.isLocked?1:-1:n.backpackPy.checkHeroInTeam(i.uuid)&&!n.backpackPy.checkHeroInTeam(o.uuid)?1:!n.backpackPy.checkHeroInTeam(i.uuid)&&n.backpackPy.checkHeroInTeam(o.uuid)?-1:i.code!=o.code?i.code-o.code:i.level-o.level}),this.ac_list.replaceAll(t)},i.prototype.updateCondition=function(){var e=JSON.parse(this.upstarData[this.slot].condition),t=_.Config.allHeroConfig();1==e[0]?(t[e[1][0][1]].name,e[1][0][2],this.upstarData[this.slot].uuids.length):2==e[0]?(0<e[1][1]&&e[1][1],0<e[1][2]&&ProfessionConfig[e[1][1]],0<e[1][0]&&HeroRaceConfig[e[1][0]],e[1][3],this.upstarData[this.slot].uuids.length):3==e[0]&&(0<e[1][1]&&e[1][1],7<=e[1][0]||6<=e[1][0]||e[1][0],e[1][2],this.upstarData[this.slot].uuids.length)},i.prototype.activateComponent=function(){this.btn_confirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){_.AppFacade.getInstance().hideSubView(_.HeroMediator.N,_.HeroMediator.SV.SELECT_UPSTAR)},this)},i.prototype.perClose=function(){_.AppFacade.getInstance().updateView(_.HeroMediator.N,_.HeroMediator.SV.MAIN),_.AppFacade.getInstance().updateView(_.HeroMediator.N,_.HeroMediator.SV.HERO_QUICK_TRAIN),_.AppFacade.getInstance().updateView(_.HeroMediator.N,_.HeroMediator.SV.HERO_STAR_DEFEND)},i);function i(){var e=t.call(this)||this;return e.heroProxy=_.AppFacade.getInstance().retrieveProxy(_.HeroPy.N),e.backpackPy=_.AppFacade.getInstance().retrieveProxy(_.BackpackPy.N),e.skinName="HeroUpstarSelectSkin",e}_.HeroUpstarSelectPanel=e,__reflect(e.prototype,"game.HeroUpstarSelectPanel");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_bi.addChild(this.baseItem)},a.prototype.dataChanged=function(){this.baseItem.updateData({uuid:this.data.info.uuid,type:EEntityType.EEntityTypeHero}),this.data.info.isLocked?this.gp_lock.visible=!0:this.gp_lock.visible=!1,this.updateChosen(this.data.chosen),UIActionManager.setGrey(this.gp_bi,this.data.chosen||this.data.info.isLocked)},a.prototype.updateChosen=function(e){this.gp_chosen.visible=e},a);function a(){var e=o.call(this)||this;return e.skinName="CommonChosePanelItem",e}__reflect(n.prototype,"HeroUpstarSelectPanel_HeroItem")}(game=game||{}),function(o){var i,e=(__extends(t,i=BaseFull),t.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_star_door")},t.prototype.childrenCreated=function(){var e,t;i.prototype.childrenCreated.call(this),this.gp_effect.visible=!1,Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btn),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cu_resBar),this.race=1,this.dicPoint=((e={})[1]=1,e[2]=2,e[3]=3,e[4]=4,e[5]=5,e),this.POINT=((t={})[1]={position:{x:Utils.DeviceUtils.curWidth()/2-133-100+225,y:670},sacle:1.6,index:3},t[2]={position:{x:Utils.DeviceUtils.curWidth()/2-270-100+135,y:505},sacle:1,index:2},t[3]={position:{x:Utils.DeviceUtils.curWidth()/2-100+6,y:376},sacle:.7,index:0},t[4]={position:{x:Utils.DeviceUtils.curWidth()/2-100+206,y:376},sacle:.7,index:0},t[5]={position:{x:Utils.DeviceUtils.curWidth()/2+174-100+146,y:505},sacle:1,index:1},t),this.initConfig(),this.activeComponent(),this.initEffect(),this.addNotice()},t.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.GASHA_RACE_TIMES,this.btn_reward.iconDisplay,this,BTN_ICON_NOTICE_POS)},t.prototype.removeNotice=function(){NoticeManager.removeNoticeListener(NT.GASHA_RACE_TIMES)},t.prototype.initEffect=function(){function e(e){var t=o.heroType[e],i=o.POINT[t];o["group_race"+t]=new eui.Group,o["group_race"+t].touchEnabled=!1,o["group_race"+t].x=i.position.x,o["group_race"+t].y=i.position.y,o["group_race"+t].width=10,o["group_race"+t].height=10,o.gp_chooseRace.addChildAt(o["group_race"+t],i.index),DragonBoneTools.create(o.XIYOU_CONFIG[t],function(e){this["effect_race_"+t]=e,this["effect_race_"+t].x=0,this["effect_race_"+t].y=0,this["effect_race_"+t].scaleX=this["effect_race_"+t].scaleY=this.POINT[this.dicPoint[t]].sacle,this["effect_race_"+t].animation.timeScale=1,t==this.race&&this["effect_race_"+t].animation.play(this.XIYOU_CONFIG[t]),this["group_race"+t].addChild(this["effect_race_"+t])},o)}var o=this;for(var t in this.heroType)e(t)},t.prototype.ScrollToMove=function(i){function e(e){var t=n.heroType[e];i<0?(egret.Tween.removeTweens(n["group_race"+t]),egret.Tween.get(n["group_race"+t]).to({x:n.POINT[n.dicPoint[t]-1<1?5:n.dicPoint[t]-1].position.x,y:n.POINT[n.dicPoint[t]-1<1?5:n.dicPoint[t]-1].position.y,scaleY:1,scaleX:1},500).call(function(){o.Xmove2(t)}),n["effect_race_"+t]&&egret.Tween.get(n["effect_race_"+t]).to({x:0,y:0,scaleY:n.POINT[n.dicPoint[t]-1<1?5:n.dicPoint[t]-1].sacle,scaleX:n.POINT[n.dicPoint[t]-1<1?5:n.dicPoint[t]-1].sacle},500).call(function(){}),n.gp_chooseRace.setChildIndex(n["group_race"+t],n.POINT[n.dicPoint[t]-1<1?5:n.dicPoint[t]-1].index),n.dicPoint[t]=n.dicPoint[t]-1<1?5:n.dicPoint[t]-1):(egret.Tween.removeTweens(n["group_race"+t]),egret.Tween.get(n["group_race"+t]).to({x:n.POINT[5<n.dicPoint[t]+1?1:n.dicPoint[t]+1].position.x,y:n.POINT[5<n.dicPoint[t]+1?1:n.dicPoint[t]+1].position.y,scaleY:1,scaleX:1},500).call(function(){o.Xmove2(t)}),n["effect_race_"+t]&&egret.Tween.get(n["effect_race_"+t]).to({x:0,y:0,scaleY:n.POINT[5<n.dicPoint[t]+1?1:n.dicPoint[t]+1].sacle,scaleX:n.POINT[5<n.dicPoint[t]+1?1:n.dicPoint[t]+1].sacle},500).call(function(){}),n.gp_chooseRace.setChildIndex(n["group_race"+t],n.POINT[5<n.dicPoint[t]+1?1:n.dicPoint[t]+1].index),n.dicPoint[t]=5<n.dicPoint[t]+1?1:n.dicPoint[t]+1),n["effect_race_"+t]&&n["effect_race_"+t].animation.stop(),1==n.dicPoint[t]&&(n.race=t,n["effect_race_"+t]&&n["effect_race_"+t].animation.play())}var o=this,n=this;for(var t in this.heroType)e(t)},t.prototype.Xmove2=function(e){5==e&&(this.isRote=!0)},t.prototype.initConfig=function(){this.GACHA_TYPE_INFO={1:{money:"时空契约"},10:{money:"时空契约"}};var e=o.Config.gashaponEntry();for(var t in e){var i=e[t];i.type==GashaponType.Race&&(this.GACHA_TYPE_INFO[i.times].itemCosts=JSON.parse(i.itemCosts),this.GACHA_TYPE_INFO[i.times].moneyCosts=JSON.parse(i.moneyCosts))}},t.prototype.updateView=function(e){var t=this.GACHA_TYPE_INFO;this.icon_resource_1_race.updateItem({cost:t[1].itemCosts[0],style:CommonIconStyle.RIGHT,showEnough:!1}),this.icon_resource_10_race.updateItem({cost:t[10].itemCosts[0],style:CommonIconStyle.RIGHT,showEnough:!1}),this.updateTimes(),this.updateResourceBar()},t.prototype.updateTimes=function(){var e=this.heroPy.gashaponInfo,t=(Utils.TimerManager.getServerTime(),this.GACHA_TYPE_INFO.suffix,this.gp_dt_race,this.btn_gacha_1_race);this.icon_resource_1_race,e[3].freeTimes&&0<e[3].freeTimes?(t.label="免费"+e[3].freeTimes+"次",t.labelDisplay.horizontalCenter=0):(t.label="召唤",this.freeTimeTimer||(this.freeTimeTimer=egret.setInterval(this.updateTimes,this,1e3)))},t.prototype.updateResourceBar=function(){this.moneyType=[],this.moneyType.push(this.GACHA_TYPE_INFO[1].itemCosts[0]);var e=o.Config.heroReplacementConfig();for(var t in e){var i=JSON.parse(e[t].costs);this.moneyType.push(i[0]);break}this.cu_resBar.updateBar({costs:this.moneyType,width:190,needAdd:!0})},t.prototype.activeComponent=function(){var i=this;this.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){if(i.isFromCurTouchBegin&&i.isRote&&Math.abs(i.startPosX-e.localX)>i.moveGuild){i.isFromCurTouchBegin=!1;var t=e.localX-i.startPosX;i.ScrollToMove(0<t?-1:0),i.startPosX=void 0,i.isRote=!1}},this),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){i.isFromCurTouchBegin=!0,i.startPosX=e.localX},this),this.addEventListener(egret.TouchEvent.TOUCH_END,function(e){i.isFromCurTouchBegin=!1,i.startPosX=void 0},this);var t=this.heroPy.gashaponInfo;Utils.TimerManager.getServerTime(),this.btn_gacha_1_race.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.GACHA_TYPE_INFO;!(this.backPackProxy.checkEnough([e[1].itemCosts[0]],!1)||e[1].moneyCosts[0]&&this.backPackProxy.checkEnough([e[1].moneyCosts[0]],!1))&&t[3].freeTimes&&t[3].freeTimes<=0?Utils.MsgUtils.addMidMsg("您的"+this.GACHA_TYPE_INFO[1].money+"不足"):this.heroPy.MakeGashapon({type:GashaponType.Race,subType:this.race,times:1})},this),this.btn_gacha_10_race.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.GACHA_TYPE_INFO;!(this.backPackProxy.checkEnough([e[10].itemCosts[0]],!1)||e[10].moneyCosts[0]&&this.backPackProxy.checkEnough([e[10].moneyCosts[0]],!1))&&t[3].freeTimes&&t[3].freeTimes<=0?Utils.MsgUtils.addMidMsg("您的"+this.GACHA_TYPE_INFO[10].money+"不足"):this.heroPy.MakeGashapon({type:GashaponType.Race,subType:this.race,times:10})},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeRaceGashapon})},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_page_last.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.isRote&&(this.ScrollToMove(0),this.isRote=!1)},this),this.btn_page_next.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.isRote&&(this.ScrollToMove(-1),this.isRote=!1)},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new o.HelpDialog({moduleId:MODULE.StarDoor})})},this),this.btn_replace.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.AppFacade.getInstance().showSubView(o.HeroMediator.N,o.HeroMediator.SV.HERO_REPLACEMENT)},this),Utils.ComponentUtils.registerListener(this.btn_reward,egret.TouchEvent.TOUCH_TAP,function(){o.AppFacade.getInstance().showSubView(o.RankMediator.N,o.RankMediator.SV.COMMON,{module:"GACHA_RACE_ACHIEVMENT"})},this)},t.prototype.playEffect=function(i){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(e){switch(e.label){case 0:return this.gp_effect.visible=!0,this.img_effectBg.visible=!1,[4,DragonBoneTools.preload("common_chouka_02")];case 1:return e.sent(),DragonBoneTools.playOnce({effectName:"common_shikong_01",parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/2,z:1,doneCB:function(){t.img_effectBg.visible=!0,DragonBoneTools.playOnce({effectName:"common_chouka_02",parent:t.gp_effect,x:t.gp_effect.width/2,y:t.gp_effect.height/2,doneCB:function(){i&&i(),t.gp_effect.visible=!1}})}}),[2]}})})},t.prototype.perClose=function(){for(var e in egret.clearInterval(this.freeTimeTimer),this.heroType){var t=this.heroType[e];this["effect_race_"+t]&&egret.Tween.removeTweens(this["effect_race_"+t])}},t);function t(){var t=i.call(this)||this;return t.moveGuild=100,t.moneyType=[],t.XIYOU_CONFIG={1:"common_shikongzhimen_lan",2:"common_shikongzhimen_hong",3:"common_shikongzhimen_lv",4:"common_shikongzhimen_zi",5:"common_shikongzhimen_ga"},t.heroType={Human:1,Orc:2,Elf:3,Athanasy:4,DemonEldar:5},Utils.AssetsMgr.loadGroup("group_star_door"),t.skinName="StarDoorSkin",t.heroPy=o.AppFacade.getInstance().retrieveProxy(o.HeroPy.N),t.backPackProxy=o.AppFacade.getInstance().retrieveProxy(o.BackpackPy.N),t.isRote=!0,t.once(egret.Event.REMOVED_FROM_STAGE,function(){for(var e in t.heroType)t.heroType[e]},t),t}o.StarDoorView=e,__reflect(e.prototype,"game.StarDoorView")}(game=game||{}),function(t){var i,e=(__extends(o,i=BaseMediator),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,t.HeroAltarMainView)},o.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.PLAYER_LEVEL_UP,CN.HERO_UPDATE,CN.HERO_EQUIP_UPDATE,CN.HERO_ARTIFACT_UPDATE]},o.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.PLAYER_LEVEL_UP:Utils.UnlockMgr.checkPass(MODULE.AltarHero,!1).allow&&!t.GameMVC.heroAltarPy.allAltarInfo[MODULE.Hero]&&t.GameMVC.heroAltarPy.GetAltarInfo(MODULE.Hero),Utils.UnlockMgr.checkPass(MODULE.AltarHeroEquip,!1).allow&&!t.GameMVC.heroAltarPy.allAltarInfo[MODULE.HeroEquip]&&t.GameMVC.heroAltarPy.GetAltarInfo(MODULE.HeroEquip),Utils.UnlockMgr.checkPass(MODULE.AltarHeroArtifact,!1).allow&&!t.GameMVC.heroAltarPy.allAltarInfo[MODULE.HeroArtifact]&&t.GameMVC.heroAltarPy.GetAltarInfo(MODULE.HeroArtifact);break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.Altar,!1).allow&&(Utils.UnlockMgr.checkPass(MODULE.AltarHero,!1).allow&&t.GameMVC.heroAltarPy.GetAltarInfo(MODULE.Hero),Utils.UnlockMgr.checkPass(MODULE.AltarHeroEquip,!1).allow&&t.GameMVC.heroAltarPy.GetAltarInfo(MODULE.HeroEquip),Utils.UnlockMgr.checkPass(MODULE.AltarHeroArtifact,!1).allow&&t.GameMVC.heroAltarPy.GetAltarInfo(MODULE.HeroArtifact));break;case CN.HERO_UPDATE:case CN.HERO_EQUIP_UPDATE:case CN.HERO_ARTIFACT_UPDATE:this.updateView(o.SV.MAIN,{forceUpdate:!0})}},o.N="HeroAltarMed",o.SV={MAIN:1},o);function o(e){return void 0===e&&(e=null),i.call(this,o.N,e)||this}t.HeroAltarMed=e,__reflect(e.prototype,"game.HeroAltarMed")}(game=game||{}),function(i){var e=(t.registerAll=function(){(new n).register(),(new s).register()},t);function t(){}i.HeroAltarProcessor=e,__reflect(e.prototype,"game.HeroAltarProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){var t=e.getBody();i.GameMVC.heroAltarPy.allAltarInfo[t.info.type]=t.info,NoticeManager.updateNotice(NT.ALTAR_ENTRANCE)},a);function a(){return o.call(this,"altar.AltarInfoP",a)||this}i.AltarInfoP=n,__reflect(n.prototype,"game.AltarInfoP");var r,s=(r=i.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody();i.GameMVC.heroAltarPy.allAltarInfo[t.info.typ]=t.info,NoticeManager.updateNotice(NT.ALTAR_ENTRANCE)},c);function c(){return r.call(this,"altar.AltarModifyInfoP",c)||this}i.AltarModifyInfoP=s,__reflect(s.prototype,"game.AltarModifyInfoP")}(game=game||{}),function(v){var t,e=(__extends(l,t=BaseProxy),l.prototype.addNotice=function(){var n=this;NoticeManager.setChildType(NT.ALTAR_ENTRANCE,NT.ALTAR_ACTIVATE),NoticeManager.registerCB(NT.ALTAR_ACTIVATE,function(){for(var e in n.allAltarInfo){var t=n.allAltarInfo[e];if(Utils.UnlockMgr.checkPass(e,!1)){var i=0;for(var o in t.entityList)t.entityList[o].uuid&&i++;if(t.slotNum>i)return!0}}return!1},this,MODULE.Altar)},l.prototype.GetAltarInfo=function(t,i){var o=this;Utils.Socket.send("altar","GetAltarInfo",{typ:t}).then(function(e){o.allAltarInfo[t]=e.info,NoticeManager.updateNotice(NT.ALTAR_ENTRANCE),i&&i()})},l.prototype.EnterIntoAltar=function(t,e,i,o){var n=this;Utils.Socket.send("altar","EnterIntoAltar",{typ:t,buildInfo:e,pos:i}).then(function(e){n.allAltarInfo[t]=e.info,NoticeManager.updateNotice(NT.ALTAR_ENTRANCE),o&&o(e)})},l.prototype.LeaveAltar=function(t,e,i,o){var n=this;Utils.Socket.send("altar","LeaveAltar",{typ:t,uuid:e,pos:i}).then(function(e){n.allAltarInfo[t]=e.info,NoticeManager.updateNotice(NT.ALTAR_ENTRANCE),v.GameMVC.backpackPy.handleClientReward(e.clientReward,2),o&&o()})},l.prototype.UnlockAltar=function(t,e,i){var o=this;Utils.Socket.send("altar","UnlockAltar",{typ:t,pos:e}).then(function(e){o.allAltarInfo[t]=e.info,NoticeManager.updateNotice(NT.ALTAR_ENTRANCE),i&&i()})},l.prototype.ResetAltar=function(t,e,i){var o=this;Utils.Socket.send("altar","ResetAltar",{typ:t,pos:e}).then(function(e){o.allAltarInfo[t]=e.info,NoticeManager.updateNotice(NT.ALTAR_ENTRANCE),i&&i()})},l.prototype.isInAltar=function(e,t,i){var o=this.allAltarInfo[t];for(var n in o.entityList){var a=o.entityList[n];if(a.uuid==e&&(null==i||a.pos>=i*l.colCount+1&&a.pos<=i*l.colCount+l.colCount))return!0}return!1},l.prototype.getJijieInfo=function(e,t){var i={codeList:[],sixthInfo:[],excludeUuidList:[]},o={},n=[],a=JSON.parse(v.Config.constConfig().AltarCountInfo.constValue),r=6,s=!1;if(e==MODULE.Hero){var c=v.GameMVC.heroPy.allHeroByUuid;for(var l in c){var h=c[l];!this.isInAltar(h.uuid,e,t)&&!h.isAltar&&5<=h.starLevel&&(o[h.uuid]=h)}r=a[0]||6,n=["level","starLevel"]}else if(e==MODULE.HeroEquip){var p=v.Config.getHeroEquipConfig();c=v.GameMVC.heroThingPy.AllEquipInfo,r=a[1]||24;var d=0;for(var l in c)p[(h=c[l]).code]&&8<=p[h.code].color&&!h.isAltar&&(d+=h.num);for(var l in s=r<=d,c)p[(h=c[l]).code]&&7<=p[h.code].color&&!h.isAltar&&(o[h.uuid]=h);n=["level","attachLevel","quenchceLevel","color"]}else if(e==MODULE.HeroArtifact){for(var l in p=v.Config.getHeroArtifactConfig(),c=v.GameMVC.heroThingPy.AllArtiInfo)h=c[l],!this.isInAltar(h.uuid,e,t)&&p[h.code]&&7<=p[h.code].color&&!h.isAltar&&(o[h.uuid]=h);n=["level","sectionLevel","baptizeLevel","color"],r=a[2]||6}var u=0;for(var g in o)u+=(h=o[g]).num||1;if(u<r)return i;var f=[];for(var l in n){var _=n[l];c=[],this.countAndSort(o,_,c,n),f.push(c)}e!=MODULE.HeroArtifact&&e!=MODULE.HeroEquip||(p=e==MODULE.HeroArtifact?v.Config.getHeroArtifactConfig():v.Config.getHeroEquipConfig(),f.forEach(function(e){e.forEach(function(e){e.uuids.sort(function(e,t){return o[e].code-o[t].code})})}));var m={},y=this.getExcludeUuid(f,r,m,i.sixthInfo,o,s);return i.excludeUuidList=y,i.codeList=this.getCodeList(o,m,e,t),i},l.prototype.countAndSort=function(t,n,a,e){function i(e){var i=t[e],o=!1;a.forEach(function(e,t){e.key==i[n]&&(e.uuids.push(i.uuid),o=!0)}),o||a.push({key:i[n],uuids:[i.uuid]})}for(var o in t)i(o);a.sort(function(e,t){return t.key-e.key})},l.prototype.getExcludeUuid=function(s,c,l,h,p,d){function e(e){function t(e){var t=o[e].uuids;d&&(t=t.filter(function(e,t){if(8<=p[e].color)return!0}));var i=0;if(t.forEach(function(e){i+=p[e].num||1}),n<i?(n-=i,a=t[0],r=r.concat(t)):(t.forEach(function(e){r.push(e),l[e]=1}),0<r.length&&(a=r[r.length-1]),n-=i),n<=0)return"break"}var o=s[e],n=c,a="",r=[];for(var i in o)if("break"===t(i))break;u.push({uuidList:r,sixthUuid:a}),h.push(a)}void 0===l&&(l={}),void 0===h&&(h=[]);var u=[];for(var t in s)e(t);return u},l.prototype.getCodeList=function(e,t,i,o){var n=[],a=this.getRowInStand(i,o),r=this.getConfigByType(i);for(var s in e){var c=e[s],l=r[c.code].subType||0;if(!t[c.uuid]&&c.isAltarInit&&!a[l]){var h=!1;for(var p in n){var d=n[p];if(d.code==c.code){d.num++,h=!0;break}}h||n.push({code:c.code,num:c.num||1})}}return n},l.prototype.getConfigByType=function(e){return e==MODULE.Hero?v.Config.allHeroConfig():e==MODULE.HeroEquip?v.Config.getHeroEquipConfig():e==MODULE.HeroArtifact?v.Config.getHeroArtifactConfig():void 0},l.prototype.getRowInStand=function(e,t){if(e==MODULE.HeroEquip)return{};var i={},o=this.allAltarInfo[e],n=e==MODULE.Hero?v.GameMVC.heroPy.allHeroByUuid:v.GameMVC.heroThingPy.AllArtiInfo,a=e==MODULE.Hero?v.Config.allHeroConfig():v.Config.getHeroArtifactConfig();for(var r in o.entityList){var s=o.entityList[r];if(s.pos>=t*l.colCount+1&&s.pos<=t*l.colCount+l.colCount){var c=n[s.uuid]&&n[s.uuid].code;c&&a[c]&&(i[a[c].subType]=1)}}return i},l.N="HeroAltarPy",l.colCount=6,l);function l(){var e=t.call(this,l.N)||this;return e.allAltarInfo={},e.addNotice(),e}v.HeroAltarPy=e,__reflect(e.prototype,"game.HeroAltarPy");var i,o=(i=v.BaseVO,__extends(n,i),n.prototype.updateData=function(e){this.uuid=e.uuid,this.pos=e.pos,this.dt=e.dt},n);function n(e){var t=i.call(this)||this;return e&&t.updateData(e),t}v.AltarEntityInfo=o,__reflect(o.prototype,"game.AltarEntityInfo");var a,r=(a=v.BaseVO,__extends(s,a),s.prototype.updateData=function(e){this.uuid=e&&e.uuid||this.uuid,this.costList=e&&e.costList||this.costList},s);function s(e){var t=a.call(this)||this;return t.costList=[],t.uuid="",e&&t.updateData(e),t}v.AltarBuildInfo=r,__reflect(r.prototype,"game.AltarBuildInfo");var c,h=(c=v.BaseVO,__extends(p,c),p.prototype.updateData=function(e){this.typ=e.typ,this.slotNum=e.slotNum,this.entityList=e.entityList},p);function p(e){var t=c.call(this)||this;return t.entityList=[],e&&t.updateData(e),t}v.AltarInfo=h,__reflect(h.prototype,"game.AltarInfo")}(game=game||{}),function(y){var n,e=(__extends(t,n=BaseFull),t.prototype.perShow=function(){return 0!=y.GameMVC.heroAltarPy.getJijieInfo(this.curModule,void 0).sixthInfo.length||(Utils.MsgUtils.addMidMsg("英雄集结需要至少6个五星英雄"),!1)},t.prototype.childrenCreated=function(){var i=this;function e(e){t["baseitem"+e].addTapEvent(function(){i.curModule==MODULE.Hero?PopUpManager.addPopUp({obj:new T({module:i.curModule,index:e-1})}):PopUpManager.addPopUp({obj:new T({module:i.curModule,index:1==e?0:4-e})})})}n.prototype.childrenCreated.call(this),this.list_root.itemRenderer=a,this.gp_effect1.visible=!1,this.gp_effect2.visible=!1,this.gp_effect3.visible=!1,this.tabbar.itemRendererSkinName="TabBarItemSkin5",this.tabbar.dataProvider=new eui.ArrayCollection([{up:"maoxian_btn_yeqiana01_png",down:"maoxian_btn_yeqianl01_png",up2:"jjst_txt_yingxionganniu2_png",down2:"jjst_txt_yingxionganniu1_png",scaleX:1,text:""},{up:"maoxian_btn_yeqiana02_png",down:"maoxian_btn_yeqianl02_png",up2:"jjst_txt_shengwuanniu2_png",down2:"jjst_txt_shengwuanniu1_png",scaleX:1,text:""},{up:"maoxian_btn_yeqiana01_png",down:"maoxian_btn_yeqianl01_png",up2:"jjst_txt_zhuangbeianniu2_png",down2:"jjst_txt_zhuangbeianniu1_png",scaleX:-1,text:""}]),this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){switch(e.itemIndex){case 0:i.jijieInfo=y.GameMVC.heroAltarPy.getJijieInfo(MODULE.Hero,void 0),i.curModule=MODULE.Hero;break;case 2:if(!Utils.UnlockMgr.checkPass(MODULE.HeroEquip).allow||!Utils.UnlockMgr.checkPass(MODULE.AltarHeroEquip).allow)return void(i.tabbar.selectedIndex=i.curModule==MODULE.Hero?0:1);if(0==(t=y.GameMVC.heroAltarPy.getJijieInfo(MODULE.HeroEquip,void 0)).sixthInfo.length)return i.tabbar.selectedIndex=i.curModule==MODULE.Hero?0:1,void Utils.MsgUtils.addMidMsg("装备集结需要至少24件金色或以上品质的装备");i.curModule=MODULE.HeroEquip,i.jijieInfo=t;break;case 1:if(!Utils.UnlockMgr.checkPass(MODULE.HeroArtifact).allow||!Utils.UnlockMgr.checkPass(MODULE.AltarHeroArtifact).allow)return void(i.tabbar.selectedIndex=0);var t;if(0==(t=y.GameMVC.heroAltarPy.getJijieInfo(MODULE.HeroArtifact,void 0)).sixthInfo.length)return i.tabbar.selectedIndex=i.curModule==MODULE.Hero?0:2,void Utils.MsgUtils.addMidMsg("圣物集结需要至少6件金色圣物");i.curModule=MODULE.HeroArtifact,i.jijieInfo=t}i.updateView()},this);for(var t=this,o=1;o<=3;o++)e(o);this.activateComponent()},t.prototype.updateView=function(e){var l=this;e&&e.module&&(this.curModule=e.module,this.tabbar.selectedIndex=this.curModule==MODULE.HeroEquip?2:1);var o=y.GameMVC.heroAltarPy.allAltarInfo[this.curModule];(!this.jijieInfo||e&&e.forceUpdate)&&(this.jijieInfo=y.GameMVC.heroAltarPy.getJijieInfo(this.curModule,void 0));var t=this.jijieInfo,n=EEntityType.EEntityTypeHero;this.baseitem3.parent.visible=!1;var i=[],a="",r=y.GameMVC.heroPy.allHeroByUuid;switch(this.curModule){case MODULE.Hero:this.img_desc.source="jjst_txt_yingxiongishuoming_png",this.img_icon.source="jjst_icon_yingxiong_png",a="当前集结神坛可提升英雄至%s级、%s星",i.push(r[t.sixthInfo[0]].level),this.bm_altarTip1.text="集结:"+r[t.sixthInfo[0]].level+"级",i.push(r[t.sixthInfo[1]].starLevel),this.bm_altarTip2.text="集结:"+r[t.sixthInfo[1]].starLevel+"星",this.baseitem2.updateData({type:n,source:BASEITEM_SOURCE.BACKPACK,uuid:t.sixthInfo[1]}),this.bm_sameTip.text="同一行不可集结相同英雄";break;case MODULE.HeroEquip:n=EEntityType.EEntityTypeHeroEquip,this.baseitem3.updateData({type:n,source:BASEITEM_SOURCE.BACKPACK,uuid:t.sixthInfo[1]}),this.baseitem2.updateData({type:n,source:BASEITEM_SOURCE.BACKPACK,uuid:t.sixthInfo[2]}),this.baseitem3.parent.visible=!0,this.img_desc.source="jjst_txt_zhuangbeishuoming_png",this.img_icon.source="jjst_icon_zhuangbei_png",a="当前集结神坛可提升装备至强化%s级、附魔%s级、淬炼%s级",8==(r=y.GameMVC.heroThingPy.AllEquipInfo)[t.sixthInfo[3]].color&&(a+="、暗金品质"),i.push(r[t.sixthInfo[0]].level),this.bm_altarTip1.text="集结:强化"+r[t.sixthInfo[0]].level+"级",i.push(r[t.sixthInfo[1]].attachLevel),this.bm_altarTip3.text="集结:附魔"+r[t.sixthInfo[1]].attachLevel+"级",i.push(r[t.sixthInfo[2]].quenchceLevel),this.bm_altarTip2.text="集结:淬炼"+r[t.sixthInfo[2]].quenchceLevel+"级",this.bm_sameTip.text="";break;case MODULE.HeroArtifact:n=EEntityType.EEntityTypeHeroArtifact,this.baseitem3.updateData({type:n,source:BASEITEM_SOURCE.BACKPACK,uuid:t.sixthInfo[1]}),this.baseitem2.updateData({type:n,source:BASEITEM_SOURCE.BACKPACK,uuid:t.sixthInfo[2]}),this.baseitem3.parent.visible=!0,this.img_desc.source="jjst_txt_shengwushuoming_png",this.img_icon.source="jjst_icon_shengwu_png",a="当前集结神坛可提升圣物至%s级、%s星、洗练%s进度",this.bm_sameTip.text="同一行不可集结相同圣物",8==(r=y.GameMVC.heroThingPy.AllArtiInfo)[t.sixthInfo[3]].color&&(a+="、暗金品质"),i.push(r[t.sixthInfo[0]].level),this.bm_altarTip1.text="集结:"+r[t.sixthInfo[0]].level+"级",i.push(r[t.sixthInfo[1]].sectionLevel),this.bm_altarTip3.text="集结:"+r[t.sixthInfo[1]].sectionLevel+"星",i.push(r[t.sixthInfo[2]].baptizeLevel),this.bm_altarTip2.text="集结:洗练"+r[t.sixthInfo[2]].baptizeLevel+"进度"}this.baseitem1.updateData({type:n,source:BASEITEM_SOURCE.BACKPACK,uuid:t.sixthInfo[0]}),this.bm_tip.text=a.format(i);var h=[],s=18,c=JSON.parse(y.Config.constConfig().AltarMaxSlotInfo.constValue);for(var p in c)(m=c[p])[0]==this.curModule&&(s=m[1]);function d(s){if(s<o.slotNum){var c="",e=0;for(var t in o.entityList){var i=o.entityList[t];if(i.pos==s+1){c=i.uuid,e=i.dt;break}}h.push({unlock:!0,uuid:c,index:s,dt:e,module:u.curModule,type:n,btnFunc:c?function(){var e=JSON.parse(y.Config.constConfig().AltarPosRefreshCycle.constValue),t=[];switch(l.curModule){case MODULE.Hero:var i=y.GameMVC.heroPy.allHeroByUuid[c].starLevel,o=y.Config.allHeroConfig()[y.GameMVC.heroPy.allHeroByUuid[c].code],n=o&&o.name,a=y.Config.heroAltarConfig()[i];t=[{text:"离开集结神坛的英雄将被还原\n同时",style:{textColor:6901043}},{text:n,style:{textColor:14684160}},{text:"×"+(a&&a.num||0)+"将会回归到您的背包\n",style:{textColor:6901043}},{text:e/3600+"小时",style:{textColor:40715}},{text:"后当前槽位可重新添加英雄",style:{textColor:6901043}}];break;case MODULE.HeroEquip:case MODULE.HeroArtifact:var r=l.curModule==MODULE.HeroEquip?"装备":"圣物";t=[{text:"离开集结神坛的"+r+"将被还原\n",style:{textColor:6901043}},{text:e/3600+"小时",style:{textColor:40715}},{text:"后当前槽位可重新添加"+r,style:{textColor:6901043}}]}y.AppFacade.getInstance().showSubView(y.CommonMediator.N,y.CommonMediator.SV.TIPS_DIALOG,{commonTips:t,clickCB:function(e){e.type&&y.GameMVC.heroAltarPy.LeaveAltar(l.curModule,c,s+1,function(){y.GameMVC.heroAltarMed.updateView(y.HeroAltarMed.SV.MAIN)})}})}:void 0})}else h.push({unlock:!1,index:s,slotNum:o.slotNum,btnFunc:function(){l.unlockNew()}})}o.slotNum>=s?this.btn_add.visible=!1:this.btn_add.visible=!0;for(var u=this,g=0;g<s;g++)d(g);this.list_root.dataProvider=new eui.ArrayCollection(h),this.bm_cur.text=o.slotNum+"",this.bm_max.text="/"+s;var f=y.Config.heroAltarUnlockCostConfig(this.curModule),_=[];for(var p in f){var m;if(_=(m=f[p]).costs,m.slotNum==o.slotNum+1)break}this.CommonResourceBar.updateBar(_)},t.prototype.activateComponent=function(){var e=this;this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.unlockNew()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){y.GameMVC.commonMed.showHelpDialog(MODULE.Altar)},this)},t.prototype.unlockNew=function(){var t=this,i=y.GameMVC.heroAltarPy.allAltarInfo[this.curModule],e=y.Config.heroAltarUnlockCostConfig(this.curModule),o=[];for(var n in e){var a=e[n];if(o=a.costs,a.slotNum==i.slotNum+1)break}y.GameMgr.getInstance().showCommonTipsWin({costTips:"解锁新位置",cost:o,clickCB:function(e){1==e.type&&y.GameMVC.heroAltarPy.UnlockAltar(t.curModule,i.slotNum+1,function(){Utils.MsgUtils.addMidMsg("解锁成功"),y.GameMVC.heroAltarMed.updateView(y.HeroAltarMed.SV.MAIN)})}})},t.prototype.playEffect=function(e,t){var i=this;this.gp_effect1.visible=!0,this.gp_effect2.visible=!0,this.gp_effect3.visible=e!=EEntityType.EEntityTypeHero,GameRootLayer.gameLayer().switchTouchEnable(!1),DragonBoneTools.playOnce({effectName:"common_jijieshentan_02",parent:this.baseitem1.parent,x:this.baseitem1.parent.width/2,y:this.baseitem1.parent.height/2,doneCB:function(){DragonBoneTools.playOnce({effectName:"common_jijieshentan_01",parent:i.gp_effect1,x:i.gp_effect1.width/2,y:i.gp_effect1.height/2,doneCB:function(){DragonBoneTools.playOnce({effectName:"common_jijieshentan_03",parent:i.gp_effect4,x:i.gp_effect4.width/2,y:i.gp_effect4.height/2+45,doneCB:function(){GameRootLayer.gameLayer().switchTouchEnable(!0),i.gp_effect1.visible=!1,i.gp_effect2.visible=!1,i.gp_effect3.visible=!1,t&&t()}})}}),DragonBoneTools.playOnce({effectName:"common_jijieshentan_01",parent:i.gp_effect2,x:i.gp_effect2.width/2,y:i.gp_effect2.height/2}),e!=EEntityType.EEntityTypeHero&&DragonBoneTools.playOnce({effectName:"common_jijieshentan_01",parent:i.gp_effect3,x:i.gp_effect3.width/2,y:i.gp_effect3.height/2})}}),DragonBoneTools.playOnce({effectName:"common_jijieshentan_02",parent:this.baseitem2.parent,x:this.baseitem2.parent.width/2,y:this.baseitem2.parent.height/2}),e!=EEntityType.EEntityTypeHero&&DragonBoneTools.playOnce({effectName:"common_jijieshentan_02",parent:this.baseitem3.parent,x:this.baseitem3.parent.width/2,y:this.baseitem3.parent.height/2})},t);function t(){var e=n.call(this)||this;return e.curModule=MODULE.Hero,e.skinName="HeroAltarMainViewSkin",e}y.HeroAltarMainView=e,__reflect(e.prototype,"game.HeroAltarMainView");var i,a=(i=eui.ItemRenderer,__extends(o,i),o.prototype.childrenCreated=function(){var s=this;this.baseitem.touchEnabled=!1,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(s.data.btnFunc)s.data.btnFunc();else if(s.bm_time.text){var e=JSON.parse(y.Config.constConfig().AltarRefreshCosts.constValue),i=[],t=1;e.forEach(function(e){e[0]==s.data.module&&(t=e[1],i=e[2])});var o=Utils.TimerManager.getServerTime(),n=JSON.parse(y.Config.constConfig().AltarPosRefreshCycle.constValue)-(o-s.data.dt),a=Math.ceil(n/t);i.forEach(function(e,t){i[t][2]*=a}),y.GameMgr.getInstance().showCommonTipsWin({costTips:"消除冷却时间",cost:JSON.stringify(i),clickCB:function(e){1==e.type&&y.GameMVC.heroAltarPy.ResetAltar(s.data.module,s.data.index+1,function(){Utils.MsgUtils.addMidMsg("消除冷却时间成功"),y.GameMVC.heroAltarMed.updateView(y.HeroAltarMed.SV.MAIN)})}})}else{var r=y.Config.allHeroConfig();s.data.module==MODULE.HeroEquip&&(r=y.Config.getHeroEquipConfig()),s.data.module==MODULE.HeroArtifact&&(r=y.Config.getHeroArtifactConfig()),PopUpManager.addPopUp({obj:new c({getInfos:function(){var e=Math.floor(s.data.index/y.HeroAltarPy.colCount),t=y.GameMVC.heroAltarPy.getJijieInfo(s.data.module,e),i={};for(var o in t.codeList){var n=t.codeList[o];i[n.code]={code:n.code,type:s.data.type,num:n.num}}return i},checkFull:function(e){return 1<=e.length},sortFunc:function(e,t){return e.info.num!=t.info.num?t.info.num-e.info.num:r[t.uuid].color!=r[e.uuid].color?r[t.uuid].color-r[e.uuid].color:r[t.uuid].code-r[e.uuid].code},selectUuids:[],uniNum:!1,type:s.data.type,isOnlyCode:!0,singleChoose:!0,noCloseAsConfirm:!0,title:"请选择"+ENTITY_2_NAME[s.data.type]}),closeCB:function(e){if(e&&0<e.length)if(s.data.module==MODULE.Hero)s.showSelectPanel2(e[0]);else{var t=s.data.module==MODULE.HeroEquip?y.GameMVC.heroThingPy.AllEquipInfo:y.GameMVC.heroThingPy.AllArtiInfo;for(var i in t){var o=t[i];if(o.code==e[0]&&o.isAltarInit&&!o.isAltar){s.EnterIntoAltar([o.uuid]);break}}}}})}},this),UIActionManager.fadeBlink(this.img_jia,!0,!1,750)},o.prototype.dataChanged=function(){var e=this;if(this.timer&&egret.clearInterval(this.timer),this.bm_time.text="",this.img_jia.visible=!1,this.data.unlock){this.baseitem.visible=!0;var t=this.data.type;if(this.data.uuid)this.baseitem.updateData({uuid:this.data.uuid,type:t});else{var i=this.data.dt,o=JSON.parse(y.Config.constConfig().AltarPosRefreshCycle.constValue),n=Utils.TimerManager.getServerTime();if(o<=n-i)this.img_jia.visible=!0;else{var a=o-(n-i);this.bm_time.text=Utils.TimerManager.getFormatBySecond1(a),this.timer=egret.setInterval(function(){e.bm_time.text=Utils.TimerManager.getFormatBySecond1(a),--a<0&&(e.timer&&egret.clearInterval(e.timer),e.dataChanged())},this,1e3)}}this.gp_lock.visible=!1}else this.baseitem.visible=!1,this.img_jia.visible=!1,this.gp_lock.visible=!0},o.prototype.EnterIntoAltar=function(e){var s=this;void 0===e&&(e=[]);var t=new y.AltarBuildInfo;t.uuid=e[0];for(var i=0;i<e.length;i++)t.costList.push({uuid:e[i],num:1});var c={},o=Math.floor(this.data.index/y.HeroAltarPy.colCount);switch(y.GameMVC.heroAltarPy.getJijieInfo(this.data.module,o),this.data.module){case MODULE.Hero:c={level:1,starLevel:5};break;case MODULE.HeroEquip:c={level:0,attachLevel:0,quenchceLevel:0,color:y.GameMVC.heroThingPy.AllEquipInfo[t.uuid].color};break;case MODULE.HeroArtifact:c={level:0,sectionLevel:0,color:y.GameMVC.heroThingPy.AllArtiInfo[t.uuid].color,baptizeLevel:0}}y.GameMVC.heroAltarPy.EnterIntoAltar(this.data.module,t,this.data.index+1,function(e){var t=e.clientReward,i="",o={};switch(s.data.module){case MODULE.Hero:var n=t.heros[0];n&&(i=n.uuid,o=y.GameMVC.heroPy.allHeroByUuid[i]);case MODULE.HeroEquip:var a=t.heroEquips[0];a&&(i=a.uuid,o=y.GameMVC.heroThingPy.AllEquipInfo[i]);case MODULE.HeroArtifact:var r=t.heroArtifacts[0];r&&(i=r.uuid,o=y.GameMVC.heroThingPy.AllArtiInfo[i])}y.GameMVC.heroAltarMed.getSubView(y.HeroAltarMed.SV.MAIN).playEffect(s.data.type,function(){PopUpManager.addPopUp({obj:new _({new_vo:o,uuid:i,old_vo:c,type:s.data.module}),closeCB:function(){0<t.rewards.length&&(t.heros=[],y.GameMVC.backpackPy.handleClientReward(t))}}),Utils.MsgUtils.addMidMsg("提升成功"),y.GameMVC.heroAltarMed.updateView(y.HeroAltarMed.SV.MAIN,{forceUpdate:!0})})})},o.prototype.showSelectPanel2=function(e){var t=this,i=y.Config.heroAltarConfig(),o=y.GameMVC.heroAltarPy.getJijieInfo(this.data.module,void 0).sixthInfo[1],n=y.GameMVC.heroPy.allHeroByUuid[o].starLevel,a=0;for(var r in i){var s=i[r];a<s.num&&s.starLevel<=n&&(a=s.num)}var c=y.GameMVC.heroPy.allHeroByUuid,l={};for(var r in c)(s=c[r]).code==e&&s.isAltarInit&&(l[s.uuid]={code:e,uuid:s.uuid,type:this.data.type,num:1,pos:s.pos,isLocked:!!s.pos||s.isLocked,entityType:EEntityType.EEntityTypeHero});var h=[],p=0;for(var d in l)if(!(s=l[d]).isLocked&&(h.push(d),a<=++p))break;PopUpManager.addPopUp({obj:new u({getInfos:function(){return l},max:a,checkFull:function(e){return e.length>=a},selectUuids:h,type:this.data.type,noCloseAsConfirm:!0,singleChoose:!1,title:"请选择材料",fullTip:"已达最大星级",lockedTip:function(e){return e.pos?"在阵上，请先下阵":"被锁住，请先解锁"}}),closeCB:function(e){e&&0<e.length&&t.EnterIntoAltar(e)}})},o.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},o);function o(){var e=i.call(this)||this;return e.timer=0,e.skinName="HeroAltarMainViewItem",e}__reflect(a.prototype,"HeroAltarMainViewItem");var r,c=(r=y.CommonChosePanel,__extends(s,r),s.prototype.childrenCreated=function(){r.prototype.childrenCreated.call(this),this.list_item.itemRenderer=h},s);function s(e){var t=r.call(this,e)||this;return t.skinName="HeroAltarSelectPanelSkin",t}__reflect(c.prototype,"HeroAltarSelectPanel");var l,h=(l=y.CommonChosePanelItem,__extends(p,l),p.prototype.dataChanged=function(){l.prototype.dataChanged.call(this),this.bm_num.text="数量:"+this.data.info.num,this.baseItem.blb_num.text=""},p);function p(){var e=l.call(this)||this;return e.skinName="HeroAltarSelectPanelItemSkin",e}__reflect(h.prototype,"HeroAltarSelectPanelItem");var d,u=(d=y.CommonChosePanel,__extends(g,d),g.prototype.childrenCreated=function(){d.prototype.childrenCreated.call(this),this.list_item.itemRenderer=y.CommonChosePanelItem,this.updateNum()},g.prototype.onListItemTap=function(e){d.prototype.onListItemTap.call(this,e),this.updateNum()},g.prototype.updateNum=function(){var e=y.Config.heroAltarConfig(),t=this.selectUuids.length,i=this.params.max,o=void 0,n=void 0;for(var a in e){var r=e[a];if(!(t>=r.num)){for(var s in e)if(a<=s){var c=e[s];c.num==r.num&&c.num<=i&&(n=c)}break}o=r}this.lb_desc.text=n?o?"当前已选择"+t+"个英雄,可提升至"+o.starLevel+"星,\n提升至"+n.starLevel+"星还需"+(n.num-t)+"个英雄":"当前已选择"+t+"个英雄,\n提升至"+n.starLevel+"星还需"+(n.num-t)+"个英雄":"当前已选择"+t+"个英雄,可提升至"+o.starLevel+"星"},g);function g(e){var t=d.call(this,e)||this;return t.skinName="HeroAltarSelectPanel2Skin",t}__reflect(u.prototype,"HeroAltarSelectPanel2");var f,_=(__extends(m,f=BasePanel),m.prototype.childrenCreated=function(){f.prototype.childrenCreated.call(this),this.updateView()},m.prototype.updateView=function(){var e=[],t=[];switch(this.params.type){case MODULE.Hero:this.baseitem.updateData({uuid:this.params.uuid,type:EEntityType.EEntityTypeHero}),e.push(this.params.old_vo.level+"级"),e.push(this.params.old_vo.starLevel+"星"),t.push(this.params.new_vo.level+"级"),t.push(this.params.new_vo.starLevel+"星"),this.gp_attrOld.height=110,this.gp_attrNew.height=110,this.gp_main.height=358,this.img_tips.source="jjst_txt_yingxiongshengji_png";break;case MODULE.HeroEquip:this.baseitem.updateData({uuid:this.params.uuid,type:EEntityType.EEntityTypeHeroEquip}),e.push(this.params.old_vo.level+"强化等级"),e.push(this.params.old_vo.attachLevel+"附魔等级"),e.push(this.params.old_vo.quenchceLevel+"淬炼等级"),t.push(this.params.new_vo.level+"强化等级"),t.push(this.params.new_vo.attachLevel+"附魔等级"),t.push(this.params.new_vo.quenchceLevel+"淬炼等级"),this.gp_attrOld.height=180,this.gp_attrNew.height=180,this.img_tips.source="jjst_txt_zhuangbeishengji_png",this.gp_main.height=427,7==this.params.old_vo.color&&8==this.params.new_vo.config.color&&t.push("暗金装备品质");break;case MODULE.HeroArtifact:this.baseitem.updateData({uuid:this.params.uuid,type:EEntityType.EEntityTypeHeroArtifact}),e.push(this.params.old_vo.level+"级"),e.push(this.params.old_vo.sectionLevel+"星"),e.push("+"+this.params.old_vo.baptizeLevel+"洗练进度"),t.push(this.params.new_vo.level+"级");var i=y.Config.getHeroArtifactConfig()[this.params.new_vo.code];t.push(i.sectionLevel+"星");var o=this.params.new_vo.baptizeLevel;t.push("+"+o+"洗练进度"),this.gp_main.height=377,7==this.params.old_vo.color&&this.params.new_vo.additionRace&&(t.push("暗金圣物品质"),this.gp_main.height=427),this.gp_attrOld.height=180,this.gp_attrNew.height=180,this.img_tips.source="jjst_txt_shengwushengji_png"}for(var n in this.gp_attrOld.removeChildren(),this.gp_attrNew.removeChildren(),e){var a=e[n];(r=new eui.Label(a)).textColor=16772550,r.size=22,this.gp_attrOld.addChild(r)}for(var n in t){var r;a=t[n],(r=new eui.Label(a)).textColor=16759075,r.size=22,this.gp_attrNew.addChild(r)}},m);function m(e){var t=f.call(this)||this;return t.skinName="HeroAltarResultPanelSkin",t.params=e,t}__reflect(_.prototype,"HeroAltarResultPanel");var v,T=(__extends(C,v=BasePanel),C.prototype.childrenCreated=function(){var t=this;switch(v.prototype.childrenCreated.call(this),this.tabbar.itemRendererSkinName="CommonTabWithTextSkin",this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){t.curIndex!=e.itemIndex&&(t.curIndex=e.itemIndex,t.updateView())},this),this.tabbar.selectedIndex=this.curIndex,this.list_item.itemRenderer=I,this.CommonDaTanChuKuang.onCloseCB=function(){t.hide()},this.jijieInfo=y.GameMVC.heroAltarPy.getJijieInfo(this.curModule,void 0),this.curModule){case MODULE.Hero:this.CommonDaTanChuKuang.blb_title.text="英雄集结",this.tabbar.dataProvider=new eui.ArrayCollection([{text:"等级"},{text:"星级"}]),this.curType=EEntityType.EEntityTypeHero,this.keys=["level","starLevel"],this.allInfos=y.GameMVC.heroPy.allHeroByUuid;break;case MODULE.HeroEquip:this.CommonDaTanChuKuang.blb_title.text="装备集结",this.tabbar.dataProvider=new eui.ArrayCollection([{text:"强化"},{text:"附魔"},{text:"淬炼"}]),this.curType=EEntityType.EEntityTypeHeroEquip,this.keys=["level","attachLevel","quenchceLevel","color"],this.allInfos=y.GameMVC.heroThingPy.AllEquipInfo,this.count=24;break;case MODULE.HeroArtifact:this.CommonDaTanChuKuang.blb_title.text="圣物集结",this.tabbar.dataProvider=new eui.ArrayCollection([{text:"等级"},{text:"星级"},{text:"洗练"}]),this.curType=EEntityType.EEntityTypeHeroArtifact,this.keys=["level","sectionLevel","baptizeLevel","color"],this.allInfos=y.GameMVC.heroThingPy.AllArtiInfo}this.updateView()},C.prototype.updateView=function(){var e=this.jijieInfo,t=e.excludeUuidList[this.curIndex].uuidList,i=e.sixthInfo[this.curIndex],o=this.keys[this.curIndex],n=[],a=this.allInfos[i][o];for(var r in t){var s=t[r],c=this.allInfos[s];c&&n.push({chose:s==i,key:c[o],uuid:s,pos:c.pos||c.heroUuid,type:this.curType,hideFunc:this.hide.bind(this)})}switch(this.bm_level.text=a,n.sort(function(e,t){return e.key!=t.key?e.key-t.key:e.uuid==i?1:t.uuid==i?-1:e.pos&&!t.pos?1:t.pos&&!e.pos?-1:e.uuid-t.uuid}),n.splice(0,n.length-this.count),n.sort(function(e,t){return e.key!=t.key?e.key-t.key:e.uuid==i?-1:t.uuid==i?1:e.uuid-t.uuid}),this.list_item.dataProvider=new eui.ArrayCollection(n),this.curModule){case MODULE.Hero:switch(this.curIndex){case 0:this.bm_title0.text="集结等级";break;case 1:this.bm_title0.text="集结星级"}break;case MODULE.HeroEquip:switch(this.curIndex){case 0:this.bm_title0.text="集结强化等级";break;case 1:this.bm_title0.text="集结附魔等级";break;case 2:this.bm_title0.text="集结淬炼等级"}break;case MODULE.HeroArtifact:switch(this.curIndex){case 0:this.bm_title0.text="集结等级";break;case 1:this.bm_title0.text="集结星级";break;case 2:this.bm_title0.text="集结洗练进度"}}},C);function C(e){var t=v.call(this)||this;return t.curModule=MODULE.Hero,t.curIndex=0,t.count=6,t.keys=[],t.curType=EEntityType.EEntityTypeHero,t.allInfos={},t.skinName="HeroAltarTheSixPanelSkin",t.curModule=e.module,t.curIndex=e.index,t}__reflect(T.prototype,"HeroAltarTheSixPanel");var E,I=(E=eui.ItemRenderer,__extends(b,E),b.prototype.childrenCreated=function(){var e=this;E.prototype.childrenCreated.call(this),this.baseitem.touchEnabled=!1,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.data.type==EEntityType.EEntityTypeHero?(y.AppFacade.getInstance().showSubView(y.HeroMediator.N,y.HeroMediator.SV.HERO_QUICK_TRAIN,{uuid:e.data.uuid}),e.data.hideFunc()):(e.baseitem.touchEnabled=!0,e.baseitem.onClick(),e.baseitem.touchEnabled=!1)},this);var t=this.baseitem.verticalCenter;egret.Tween.get(this.baseitem,{loop:!0}).to({verticalCenter:t-10},500).to({verticalCenter:t},500)},b.prototype.dataChanged=function(){this.img_di.source=this.data.chose?"jjst_img_dizuo2_png":"jjst_img_dizuo1_png",this.img_chose.visible=this.data.chose,this.baseitem.updateData({type:this.data.type,uuid:this.data.uuid,source:BASEITEM_SOURCE.BACKPACK})},b);function b(){var e=E.call(this)||this;return e.skinName="HeroAltarTheSixPanelItemSkin",e}__reflect(I.prototype,"HeroAltarTheSixPanelItem")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.HeroChallengeMainView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:this.proxy.GetChessInfo()}},n.prototype.onViewCreate=function(){this.sendNotification(CN.CITY_SWITCH_DBCLOCKPAUSE,!0)},n.N="HeroChallengeMediator",n.SV={MAIN:1,LIST:2},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.HeroChallengePy.N),t}i.HeroChallengeMediator=e,__reflect(e.prototype,"game.HeroChallengeMediator")}(game=game||{}),function(i){var e=(t.registerAll=function(){(new n).register()},t);function t(){}i.HeroChallengeProcessor=e,__reflect(e.prototype,"game.HeroChallengeProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){var t=e.getBody();console.log("ChessInfoP",t),i.AppFacade.getInstance().retrieveProxy(i.HeroChallengePy.N).chessInfo.update(t.chessInfo)},a);function a(){return o.call(this,"activity.ChessInfoP",a)||this}i.ChessInfoP=n,__reflect(n.prototype,"game.ChessInfoP")}(game=game||{}),function(i){var o,t=(o=i.BaseVO,__extends(e,o),e.prototype.update=function(e){this.eventCode=e.eventCode,this.isValid=e.isValid},e);function e(e){var t=o.call(this)||this;return e&&t.update(e),t}__reflect(t.prototype,"HCEventVO");var n,a=(n=i.BaseVO,__extends(r,n),r.prototype.update=function(e){this.mapCode=e.mapCode,this.event=new t(e.event)},r);function r(e){var t=n.call(this)||this;return e&&t.update(e),t}__reflect(a.prototype,"MapInfoVO");var s,c=(s=i.BaseVO,__extends(l,s),l.prototype.update=function(e){var t=this;this.effects=e.effects,this.cMapCode=e.cMapCode,this.map.splice(0),e.map.forEach(function(e){t.map[e.mapCode]=e})},l);function l(e){var t=s.call(this)||this;return t.map=[],e&&t.update(e),t}__reflect(c.prototype,"ChessInfoVO");var h,p=(__extends(d,h=BaseProxy),d.prototype.GetChessInfo=function(){var t=this;this.constValue.ChallengeThrowDiceCosts||(this.constValue.ChallengeThrowDiceCosts=JSON.parse(i.Config.constConfig().ChallengeThrowDiceCosts.constValue)),Utils.Socket.send("challenge","GetChessInfo",{}).then(function(e){t.chessInfo||(t.chessInfo=new c),t.chessInfo.update(e.chessInfo)})},d.prototype.ThrowDice=function(){Utils.Socket.send("challenge","ThrowDice",{}).then(function(e){i.AppFacade.getInstance().updateView(i.HeroChallengeMediator.N,i.HeroChallengeMediator.SV.MAIN,e)})},d.prototype.OneKeyThrowDice=function(){Utils.Socket.send("challenge","OneKeyThrowDice",{}).then(function(e){i.AppFacade.getInstance().updateView(i.HeroChallengeMediator.N,i.HeroChallengeMediator.SV.MAIN,e)})},d.N="HeroChallengePy",d);function d(){var e=h.call(this,d.N)||this;return e.constValue={ChallengeThrowDiceCosts:void 0},e}i.HeroChallengePy=p,__reflect(p.prototype,"game.HeroChallengePy")}(game=game||{}),function(e){var t,i=(__extends(o,t=BasePanel),o);function o(){var e=t.call(this)||this;return e.skinName="",e}e.HeroChallengeListPanel=i,__reflect(i.prototype,"game.HeroChallengeListPanel")}(game=game||{}),function(I){var i,e=(__extends(t,i=BaseFull),t.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_hero_challenge")},t.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_produce),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_guide),Utils.DeviceUtils.setLiuHaiPingAdapter(this.resource_bar);var t=new egret.Shape;t.graphics.beginFill(0,.6),t.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),t.graphics.endFill(),this.gp_dice.addChildAt(t,0),this.gp_dice.visible=!1,DragonBoneTools.playOnce({effectName:"common_zoumadeng_1",parent:this.gp_machine,loop:!0,name:"effect"}),this.scl_map.scrollPolicyV=eui.ScrollPolicy.OFF,Utils.UnlockMgr.checkPass(MODULE.Challenge10x,!1).allow?(UIActionManager.setGrey(this.btn_oneKey,!1),Utils.TouchUtils.addTouchListener(this.btn_oneKey,function(){e.proxy.OneKeyThrowDice()})):(UIActionManager.setGrey(this.btn_oneKey,!0),Utils.TouchUtils.addTouchListener(this.btn_oneKey,function(){Utils.UnlockMgr.checkPass(MODULE.Challenge10x,!0)})),this.initMapPos(),this.activateComponent(),this.initTips()},t.prototype.initTips=function(){this.lb_produce1.textFlow=(new egret.HtmlTextParser).parse(String("<font>产出<font color= 0x50ff3e >绿</font>、<font color= 0x3febff >蓝</font>、<font color= 0xff5cf5 >紫</font>圣物</font>")),this.lb_produce2.textFlow=(new egret.HtmlTextParser).parse(String("<font>产出<font color= 0xff981f >橙色圣物</font></font>")),this.lb_produce3.textFlow=(new egret.HtmlTextParser).parse(String("<font>产出<font color= 0xff4949 >红色圣物</font></font>")),this.lb_produce4.textFlow=(new egret.HtmlTextParser).parse(String("<font>产出英雄碎片x50、</font>\n<font><font color= 0xff4949 >红色圣物</font>碎片x10</font>"))},t.prototype.initMapPos=function(){var o=this,n={1:[1,-1],2:[1,1],3:[-1,1],4:[-1,-1]},a=[this.startPoint.x,this.startPoint.y];this.startPoint.parent.removeChild(this.startPoint),this.posArr.push([a[0],a[1]]),[[1,2],[4,1],[1,4],[4,2],[3,1],[4,2],[1,3],[2,1],[1,1],[2,3],[1,1],[2,1],[1,2],[4,1],[1,2],[2,3],[3,1],[2,1],[3,4],[2,3],[3,2],[2,3],[3,2],[4,1],[3,1],[4,2],[1,1],[4,4],[3,2],[2,2],[3,1],[2,1],[3,2],[4,4]].forEach(function(e){for(var t=e[0],i=e[1];0<i--;)a[0]+=140*n[t][0]/2,a[1]+=74*n[t][1]/2,o.posArr.push([a[0],a[1]])}),this.gridNum=this.posArr.length},t.prototype.updateView=function(e){var t=this;if(this.proxy.chessInfo,e&&e.walkInfos){this.switchBtnAvailable(!1),this.walkInfos=e.walkInfos,this.curWalkRound=0;var i=e.diceNums;this.gp_dice2.removeChildren(),i.forEach(function(e){t.gp_dice2.addChild(new eui.Image("touzi_"+e+"_png"))}),this.gp_dice.visible=!0,this.gp_dice.alpha=0,this.gp_dice2.visible=!1,egret.Tween.get(this.gp_dice).to({alpha:1},300).call(function(){DragonBoneTools.playOnce({effectName:"common_toushaizi",parent:t.gp_dice,y:t.gp_dice.height/2+80,doneCB:function(){t.gp_dice2.visible=!0,egret.Tween.get(t.gp_dice).wait(700).to({alpha:0},300).call(function(){t.gp_dice.visible=!1,t.handleWalkInfo()})}})})}else e&&e.chessInfo?(this.switchBtnAvailable(!1),this.walkInfos=e,this.handleWalkInfo(!0)):this.realUpdate()},t.prototype.realUpdate=function(e){void 0===e&&(e=!0),this.me||(this.me=new s,this.me.scaleX=this.me.scaleY=1.1,this.gp_map.addChild(this.me),this.setObjToPos(this.me,this.proxy.chessInfo.cMapCode),this.me.dir=this.checkMyDir(),this.updateCamera(!0)),this.updateChessBoard();var t=this.proxy.constValue.ChallengeThrowDiceCosts[0];this.icon_cost.updateItem({cost:t,style:CommonIconStyle.RIGHT,needShowHave:!1}),this.gp_onekey.visible&&this.icon_costOnekey.updateItem({code:t[1],num:10*t[2],style:CommonIconStyle.RIGHT,needShowHave:!1}),this.icon_cost.blb_num.scaleX=this.icon_cost.blb_num.scaleY=this.icon_costOnekey.blb_num.scaleX=this.icon_costOnekey.blb_num.scaleY=1.15,this.resource_bar.updateBar({costs:this.proxy.constValue.ChallengeThrowDiceCosts}),e&&this.checkBoss()},t.prototype.checkBoss=function(){var t=this;if(0!=this.proxy.chessInfo.cMapCode){var e=this.proxy.chessInfo.cMapCode;this.proxy.chessInfo.map[e].event.isValid&&I.Config.getHeroChallengeEvent(this.proxy.chessInfo.map[e].event.eventCode).type==ChallengeEventType.AttackBoss&&I.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeHeroChallenge,pb1:"challenge",pb2:"ChallengeBoss",params:{mapCode:e},doneCB:function(e){t.proxy.chessInfo.update(e.cbRet.chessInfo),t.updateView()}})}},t.prototype.checkMyDir=function(){var e=this.me.mapCode,t=e+1==this.gridNum?0:e+1,i=this.posArr[e],o=this.posArr[t],n=o[0]-i[0],a=o[1]-i[1];return 0<n?0<a?2:1:0<a?3:4},t.prototype.handleWalkInfo=function(e){var i=this;if(void 0===e&&(e=!1),e){var o=this.me.mapCode;function t(){var e=o+1;e>=a.gridNum&&(e-=a.gridNum),o=e;var t=a.posArr[e];n.call(function(){i.me.mapCode=e,i.updateCamera(!1,i.MOVE_TIME/3)}).to({x:t[0],y:t[1]},a.MOVE_TIME/3).call(function(){i.me.dir=i.checkMyDir()})}(s=this.walkInfos.chessInfo.cMapCode)==this.gridNum&&(s=0),this.me.switchStatus(!0);for(var n=egret.Tween.get(this.me),a=this;o!=s;)t();n.call(function(){i.me.switchStatus(!1),new Promise(function(e){I.AppFacade.getInstance().showSubView(I.CommonMediator.N,I.CommonMediator.SV.REWARD_PANEL,{rewards:i.walkInfos.clientReward,onCloseCB:e})}).then(function(){i.proxy.chessInfo.update(i.walkInfos.chessInfo),i.switchBtnAvailable(!0),i.realUpdate(!1)})})}else{var r=this.walkInfos[this.curWalkRound++];if(r){this.log("【DEBUG】: 第"+r.round+"轮移动开始"),o=this.me.mapCode;var s=r.endCode,c=this.proxy.chessInfo.map[s].event.isValid&&this.proxy.chessInfo.map[s].event.eventCode||ChallengeEventType.Empty;function l(){var e=o+1;e>=h.gridNum&&(e-=h.gridNum),o=e;var t=h.posArr[e];n.call(function(){i.me.mapCode=e,i.updateCamera()}).to({x:t[0],y:t[1]},h.MOVE_TIME).call(function(){i.me.dir=i.checkMyDir()})}s==this.gridNum&&(s=0),this.me.switchStatus(!0),n=egret.Tween.get(this.me);for(var h=this;o!=s;)l();n.call(function(){i.me.switchStatus(!1),i.log("【DEBUG】: 第"+r.round+"轮移动结束，开始处理表现"),i.log("【DEBUG】: eventType "+c+"     result "+r.result),new Promise(function(e){i.handleResule(r.result,c,e)}).then(function(){i.log("【DEBUG】: 第"+r.round+"轮移动表现处理完毕，准备下一步移动"),i.proxy.chessInfo.update(r.chessInfo),i.realUpdate(),i.handleWalkInfo()})})}else this.switchBtnAvailable(!0),this.log("【DEBUG】:所有移动完毕")}},t.prototype.handleResule=function(e,t,i){var o=this,n=JSON.parse(e);switch(t){case ChallengeEventType.Stop:Utils.MsgUtils.addMidMsg("停止"),i();break;case ChallengeEventType.Move:Utils.MsgUtils.addMidMsg("瞬移"),i();break;case ChallengeEventType.Empty:n&&n.rewardInfos?I.AppFacade.getInstance().showSubView(I.CommonMediator.N,I.CommonMediator.SV.REWARD_PANEL,{rewards:n.rewardInfos,onCloseCB:i}):i();break;case ChallengeEventType.Ahead:Utils.MsgUtils.addMidMsg("前进"),i();break;case ChallengeEventType.Backward:Utils.MsgUtils.addMidMsg("后退"),i();break;case ChallengeEventType.Ending:Utils.MsgUtils.addMidMsg("到达终点"),I.AppFacade.getInstance().showSubView(I.CommonMediator.N,I.CommonMediator.SV.REWARD_PANEL,{rewards:n.rewardInfos,onCloseCB:i});break;case ChallengeEventType.Box:this.log("宝箱事件类型"),I.AppFacade.getInstance().showSubView(I.CommonMediator.N,I.CommonMediator.SV.REWARD_PANEL,{rewards:n.rewardInfos,onCloseCB:i});break;case ChallengeEventType.Box2:this.log("宝箱事件类型2"),I.AppFacade.getInstance().showSubView(I.CommonMediator.N,I.CommonMediator.SV.REWARD_PANEL,{rewards:n.rewardInfos,onCloseCB:i});break;case ChallengeEventType.OnearmBandit:this.gp_machine.visible=!0;var a=this.gp_machine.getChildByName("effect"),r=[],s=[],c=I.Config.allHeroConfig();for(var l in c){var h=c[l];10==h.initStar&&h.isShow&&s.push(h)}for(;10!=r.length;){var p=Math.ceil(Math.random()*(s.length-1));r.push(s.splice(p,1)[0].avatar+"_png")}function d(){var e=Math.round(9*Math.random());return r[e]}function u(e){for(var t=d();-1!=e.indexOf(t);)t=d();return t}var g=[],f=n.playInfos[0].isWin;if(1==f){var _=d();g.push(_,_,_)}else 2==f?(_=d(),g.push(_,_)):(g.push(u(g)),g.push(u(g))),g.push(u(g));for(var m=g.length-1;m;){var y=Math.round(Math.random()*m),v=g[y];g[y]=g[m],g[m]=v,m-=1}function T(e,t){var i=o["img_slot_"+e];E[e-1]&&(egret.clearInterval(E[e-1]),E[e-1]=0),E[e-1]=egret.setInterval(function(){!function(e){e.source=d()}(i)},o,1e3/t)}function C(e){egret.clearInterval(E[e-1]),E[e-1]=0,o["img_slot_"+e].source=g[e-1]}var E=[0,0,0];egret.Tween.get(this).call(function(){T(1,10),T(2,10),T(3,10),a.animation.timeScale=1}).wait(1500).call(function(){C(1),T(2,20),T(3,20),a.animation.timeScale=1.5}).wait(1500).call(function(){C(2),T(3,30),a.animation.timeScale=2}).wait(1500).call(function(){a.animation.timeScale=0,C(3)}).wait(1e3).call(function(){I.AppFacade.getInstance().showSubView(I.CommonMediator.N,I.CommonMediator.SV.REWARD_PANEL,{rewards:n.rewardInfos,onCloseCB:function(){i(),o.gp_machine.visible=!1}})});break;case ChallengeEventType.PlayFinger:n&&n.rewardInfos.length?(this.log("猜拳赢了"),I.AppFacade.getInstance().showSubView(I.CommonMediator.N,I.CommonMediator.SV.REWARD_PANEL,{rewards:n.rewardInfos,onCloseCB:i})):(this.log("猜拳输了"),i());break;case ChallengeEventType.DoubleDice:Utils.MsgUtils.addMidMsg("双骰子"),i();break;case ChallengeEventType.AttackBoss:this.log("boss"),i()}},t.prototype.updateChessBoard=function(){var o=this,e=this.proxy.chessInfo;if(0==this.me.mapCode)for(var t in this.eventObjs){var i=this.eventObjs[t];i.parent&&i.parent.removeChild(i),delete this.eventObjs[t]}e.map.forEach(function(e){if(e){var t=e.event;if(t.isValid&&t.eventCode!=ChallengeEventType.Empty){if(!o.eventObjs[e.mapCode]){var i=o.createObj(t);o.gp_event.addChild(i),o.setObjToPos(i,e.mapCode),o.eventObjs[e.mapCode]=i}}else o.eventObjs[e.mapCode]&&((i=o.eventObjs[e.mapCode]).parent&&i.parent.removeChild(i),delete o.eventObjs[e.mapCode])}}),this.gp_event.$children.sort(function(e,t){return e.y-t.y})},t.prototype.createObj=function(e){var t;switch(e.eventCode){case ChallengeEventType.AttackBoss:t=new _(e);break;case ChallengeEventType.Ending:t=this.endingBox=new u(e);break;default:t=new h(e)}return t},t.prototype.updateCamera=function(e,t,i){var o=this;void 0===e&&(e=!1),this.scl_map.stopAnimation(),this.scl_map.validateNow();var n,a,r=(n=this.me.mapCode,(a=o.posArr[n][0]-o.scl_map.width/2)<0?a=0:a>o.scl_map.viewport.contentWidth-o.scl_map.width&&(a=o.scl_map.viewport.contentWidth-o.scl_map.width),a);e?(this.scl_map.viewport.scrollH=r,i&&i()):egret.Tween.get(this.scl_map.viewport).to({scrollH:r},t||this.MOVE_TIME).call(function(){i&&i()})},t.prototype.setObjToPos=function(e,t,i){void 0===i&&(i=!0),t==this.gridNum&&(t=0);var o=this.posArr[t];i?(e.x=o[0],e.y=o[1],e.mapCode=t):egret.Tween.get(e).to({x:o[0],y:o[1]}).call(function(){e.mapCode=t})},t.prototype.switchBtnAvailable=function(e){this.btn_roll.enabled=e,this.btn_return.enabled=e,this.btn_oneKey.enabled=e,this.scl_map.scrollPolicyH=e?eui.ScrollPolicy.ON:eui.ScrollPolicy.OFF},t.prototype.activateComponent=function(){var e=this;Utils.TouchUtils.addTouchListener(this.btn_return,function(){I.MainJumpConfig.jumpTo()}),Utils.TouchUtils.addTouchListener(this.btn_roll,function(){e.proxy.ThrowDice()}),Utils.TouchUtils.addTouchListener(this.btn_guide,function(){PopUpManager.addPopUp({obj:new I.HelpDialog({moduleId:MODULE.Challenge})})})},t);function t(){var e=i.call(this)||this;return e.posArr=[],e.eventObjs={},e.gridNum=0,e.MOVE_TIME=300,e.PAUSE_TIME=200,e.proxy=I.AppFacade.getInstance().retrieveProxy(I.HeroChallengePy.N),Utils.AssetsMgr.loadGroup("group_hero_challenge"),e.skinName="HeroChallengeMainSkin",e}I.HeroChallengeMainView=e,__reflect(e.prototype,"game.HeroChallengeMainView");var o,n=(o=eui.Component,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.updateObj()},a.prototype.updateObj=function(){},a);function a(){return o.call(this)||this}__reflect(n.prototype,"ChessObject");var r,s=(__extends(c,r=n),c.prototype.childrenCreated=function(){var e=this;r.prototype.childrenCreated.call(this),this.anchorOffsetX=50,this.anchorOffsetY=200,this.heroModel=new customui.RoleDynamicModel({reqStyle:ROLE_STYLE.Fashion}),this.heroModel.onArmatureLoadCB=function(){e.dir=e._dir},this.heroModel.x=this.gp_root.width/2,this.heroModel.y=this.gp_root.height,this.gp_root.addChild(this.heroModel)},c.prototype.updateObj=function(){},Object.defineProperty(c.prototype,"dir",{set:function(e){var t=this._dir=e;switch(this._dir){case 1:t=2;break;case 2:t=1;break;case 3:t=3;break;case 4:t=0}this.heroModel.onChangingDir(t)},enumerable:!0,configurable:!0}),c.prototype.switchStatus=function(e){this.heroModel.curModelAct=e?ROLE_ACTION_NAME.PB:ROLE_ACTION_NAME.DJ},c);function c(){var e=r.call(this)||this;return e.skinName="HeroChallengeMainView_MapObject_Me",e}__reflect(s.prototype,"Me");var l,h=(__extends(p,l=n),p.prototype.childrenCreated=function(){var i=this;l.prototype.childrenCreated.call(this),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.data.eventCode!=ChallengeEventType.Box&&this.data.eventCode!=ChallengeEventType.Box2||Utils.TouchUtils.addTouchListener(this,function(){var e=I.Config.getHeroChallengeEvent(i.data.eventCode),t=JSON.parse(e.contents);I.AppFacade.getInstance().showSubView(I.CommonMediator.N,I.CommonMediator.SV.REWARD_PANEL,{rewards:t,type:{title:"hdwp_txt_huodewupin_png"}})})},p.prototype.updateObj=function(){var e=I.Config.getHeroChallengeEvent(this.data.eventCode);this.img.source=e.img+"_png"},p);function p(e){var t=l.call(this)||this;return t.data=e,t.skinName="HeroChallengeMainView_MapObject_EventObject",t}__reflect(h.prototype,"EventObject");var d,u=(__extends(g,d=n),g.prototype.childrenCreated=function(){d.prototype.childrenCreated.call(this),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height;var e=new eui.Image("yxtz_icon_qizhi_png");e.horizontalCenter=8,e.bottom=-12,this.addChild(e);var t=new eui.Image("yxtz_txt_qidian_png");t.horizontalCenter=-10,t.bottom=100,this.addChild(t),Utils.TouchUtils.addTouchListener(this,function(){var e=I.Config.getHeroChallengeEvent(ChallengeEventType.Ending),t=JSON.parse(e.contents);I.AppFacade.getInstance().showSubView(I.CommonMediator.N,I.CommonMediator.SV.REWARD_PANEL,{rewards:t,type:{title:"hdwp_txt_huodewupin_png"}})})},g);function g(e){var t=d.call(this)||this;return t.data=e,t.skinName="HeroChallengeMainView_MapObject_EventObject",t}__reflect(u.prototype,"EndingObject");var f,_=(__extends(m,f=n),m.prototype.childrenCreated=function(){f.prototype.childrenCreated.call(this),this.anchorOffsetX=50,this.anchorOffsetY=200},m.prototype.updateObj=function(){if(!this.model){var e=new eui.Image("_guaji_m_json.yingxion_img_touying");e.horizontalCenter=0,e.bottom=-20,e.scaleX=e.scaleY=.6,this.gp_root.addChild(e),this.model=new customui.HeroDynamicModel,this.model.bottom=0,this.model.horizontalCenter=0,this.model.scaleX=this.model.scaleY=.4,this.gp_root.addChild(this.model)}var t=JSON.parse(this.data.content).bossCode,i=I.Config.getHeroChallengeBoss()[t],o=JSON.parse(i.creep1)[0];this.model.update({model:I.Config.allHeroConfig()[I.Config.creepConfig()[o].heroId].model,isStatic:!0})},m);function m(e){var t=f.call(this)||this;return t.data=e,t.skinName="HeroChallengeMainView_MapObject_Me",t}__reflect(_.prototype,"Creep")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.addNotice=function(){NoticeManager.setChildType(NT.HERO_CHALLENGE,NT.COMMON_SHOP[ShopType.ShopTypeHeroChallenge])},n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.HeroChallenge2MainView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.GENERAL_PASS_DAY]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GENERAL_PASS_DAY:case CN.LOGIN_FINAL_DONE:this.proxy.isOpen()&&this.proxy.GetHeroChallengeInfo()}},n.N="HeroChallenge2Mediator",n.SV={MAIN:1},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.HeroChallenge2Py.N),t.addNotice(),t}i.HeroChallenge2Mediator=e,__reflect(e.prototype,"game.HeroChallenge2Mediator")}(game=game||{}),function(i){var e=(t.registerAll=function(){(new n).register()},t);function t(){}i.HeroChallenge2Processor=e,__reflect(e.prototype,"game.HeroChallenge2Processor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){var t=e.getBody();console.log("HeroChallengeInfoP",t),i.AppFacade.getInstance().retrieveProxy(i.HeroChallenge2Py.N).updateInfo(t.info)},a);function a(){return o.call(this,"heroChallenge.HeroChallengeInfoP",a)||this}i.HeroChallengeInfoP=n,__reflect(n.prototype,"game.HeroChallengeInfoP")}(game=game||{}),function(o){__reflect(function(){}.prototype,"HeroPositionVO");var t=(e.prototype.updateData=function(e){var t=this;this.code=e.code,this.creeps=e.creeps,this.heros=e.heros,this.hCode=e.hCode,this.clear=e.clea,this.waitSelect=e.waitSelect,this.buffs=e.buffs,this.uuid22pos={},this.heros.forEach(function(e){t.uuid22pos[e.uuid]=e.battlePos,t.uuid22pos[e.battlePos]=e.uuid})},e.prototype.addHero=function(e){for(var t=0,i=1;i<=6;i++)if(!this.uuid22pos[i]){t=i;break}this.heros.push({uuid:e,battlePos:t}),this.uuid22pos[e]=t,this.uuid22pos[t]=e},e.prototype.removeHero=function(e){for(var t in this.heros){var i=this.heros[t];if(i.uuid==e){delete this.uuid22pos[i.uuid],delete this.uuid22pos[i.battlePos],this.heros.splice(Number(t),1);break}}},e);function e(e){this.heros=[],this.uuid22pos={},e&&this.updateData(e)}__reflect(t.prototype,"HeroChallengeInfo");var i,n=(__extends(a,i=BaseProxy),a.prototype.updateInfo=function(e){if(this.challengeInfo.updateData(e),this.curMode=o.Config.heroChallengeStage(this.challengeInfo.code).model,o.AppFacade.getInstance().updateView(o.HeroChallenge2Mediator.N,o.HeroChallenge2Mediator.SV.MAIN),o.AppFacade.getInstance().sendNotification(CN.HERO_CHALLENGE_MODEL_UPDATE),this.firstGetData){this.firstGetData=!1;var t=o.AppFacade.getInstance().retrieveProxy(o.ShopPy.N);t.GetShopInfo(ShopType.ShopTypeHeroChallenge,function(e){t.curShopType=ShopType.ShopTypeHeroChallenge,t.updateShopInfo({info:e.shopInfo,type:ShopType.ShopTypeHeroChallenge})})}},a.prototype.GetHeroChallengeInfo=function(){var t=this;Utils.Socket.send("heroChallenge","GetHeroChallengeInfo",{}).then(function(e){t.updateInfo(e.info)})},a.prototype.HeroChangeFormation=function(t){Utils.Socket.send("heroChallenge","HeroChangeFormation",{heros:this.challengeInfo.heros}).then(function(e){t&&t()})},a.prototype.SelectBuff=function(e,t){var i=this;Utils.Socket.send("heroChallenge","SelectBuff",{index:e}).then(function(e){i.updateInfo(e.info),t&&t()})},a.prototype.isOpen=function(){if(!this.openDt){var e=o.AppFacade.getInstance().retrieveProxy(o.LoginPy.N),t=Number(o.Config.constConfig().HeroChallengeUnlockServerOpenDt.constValue),i=new Date(1e3*e.loginGameVO.serverOpenDt+24*t*3600*1e3);this.openDt=i.getTime()/1e3}return Utils.TimerManager.getServerTime()>=this.openDt},a.prototype.Challenge=function(){var i=this;o.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeHeroChallenge2,pb1:"heroChallenge",pb2:"Challenge",params:{heros:this.challengeInfo.heros},doneCB:function(e){e&&e.cbRet&&i.updateInfo(e.cbRet.info);var t=o.AppFacade.getInstance().retrieveProxy(o.FightPy.N);t.dailyFakeFight=!1,t.queueExceExitCB()}})},a.N="HeroChallenge2Py",a);function a(){var e=i.call(this,a.N)||this;return e.firstGetData=!0,e.challengeInfo=new t,e}o.HeroChallenge2Py=n,__reflect(n.prototype,"game.HeroChallenge2Py")}(game=game||{}),function(l){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initFormation(),this.addNotice(),this.activateComponent()},i.prototype.initFormation=function(){for(var n=this,a=this.challengePy.challengeInfo,e=a.heros.length-1;0<=e;){var t=a.heros[e].uuid;t&&!this.heroPy.heroUuid22Pos[t]&&a.removeHero(t),e-=1}function i(e){var t=r.heroPy.heroUuid22Pos[e];if(t){var i=new l.HeroMainView_HeroListItem;r.gp_formation.addChild(i),i.touchChildren=!1,Utils.TouchUtils.addTouchListener(i,function(){n.onItemTap(e)});var o=Utils.UnlockMgr.checkPass(e,!1);i.updateItem({uuid:t,unlock:o,info:r.heroPy.allHeroByUuid[r.heroPy.heroUuid22Pos[e]]}),a.uuid22pos[t]&&r.setItemChosenEffect(i,!0,!1)}}for(var r=this,o=1;o<=6;o++)i(o)},i.prototype.updateView=function(e){var i=this,t=this.challengePy.challengeInfo;if(t.clear)this.hide();else{this.stageConfig=l.Config.heroChallengeStage(t.code),this.creepConfig=l.Config.heroChallengeCreep()[this.stageConfig.creep];var o=t.creeps[0],n=l.Config.allHeroConfig()[o];this.model.update({model:n.model,isStatic:!0}),this.lb_name.text="第"+this.stageConfig.num+"关",this.gp_boss_formation.removeChildren(),t.creeps.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({code:e}),i.gp_boss_formation.addChild(t)});var a=JSON.parse(this.stageConfig.rewards);for(var r in this.gp_rewards.removeChildren(),a){var s=a[r],c=customui.BaseItemFactory.create();c.scaleX=c.scaleY=.9,c.updateData({reward:s}),this.gp_rewards.addChild(c)}this.stageConfig.model==HeroChallengeModel.OneVsOne?this.maxNum=1:this.stageConfig.model==HeroChallengeModel.ThreeVsThree?this.maxNum=3:this.stageConfig.model==HeroChallengeModel.SixVsSix&&(this.maxNum=6),this.blb_maxNum.text=t.heros.length+"/"+this.maxNum,this.lb_clear.visible=t.clear&&!0,this.checkFull(),t.waitSelect.length&&PopUpManager.addPopUp({obj:new h({waitSelect:t.waitSelect}),clickDarkClose:!1})}},i.prototype.onItemTap=function(e){var t=this.gp_formation.getChildAt(e-1);(t.chosen||this.maxNum!=this.challengePy.challengeInfo.heros.length)&&t.data.uuid&&(t.chosen?this.challengePy.challengeInfo.removeHero(t.data.uuid):this.challengePy.challengeInfo.addHero(t.data.uuid),this.setItemChosenEffect(t,!t.chosen),this.blb_maxNum.text=this.challengePy.challengeInfo.heros.length+"/"+this.maxNum)},i.prototype.setItemChosenEffect=function(e,t,i){if(void 0===i&&(i=!0),UIActionManager.setGrey(e.gp_baseitem,t),e.chosen=t){var o=new eui.Image("common_img_gouxuan_png");o.name="chosenSign",o.horizontalCenter=o.verticalCenter=0,e.addChild(o)}else{var n=e.getChildByName("chosenSign");n&&e.removeChild(n)}i&&this.checkFull()},i.prototype.checkFull=function(){var e=0<this.challengePy.challengeInfo.heros.length&&!this.challengePy.challengeInfo.clear;this.btn_battle.enabled=e,UIActionManager.setAbsGrey(this.btn_battle,!e);for(var t=1;t<=this.gp_formation.numChildren;t++){var i=this.gp_formation.getChildAt(t-1);i.chosen||UIActionManager.setAbsGrey(i,this.maxNum==this.challengePy.challengeInfo.heros.length)}},i.prototype.perClose=function(){this.challengePy.HeroChangeFormation()},i.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.COMMON_SHOP[ShopType.ShopTypeHeroChallenge],this.btn_shop,this,{percentX:.8})},i.prototype.activateComponent=function(){var n=this;this.gp_boss.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){n.gp_boss_details.visible=!0},this),this.gp_boss.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){n.gp_boss_details.visible=!1},this),this.gp_boss.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){n.gp_boss_details.visible=!1},this),this.gp_boss.addEventListener(egret.TouchEvent.TOUCH_END,function(){n.gp_boss_details.visible=!1},this),Utils.TouchUtils.addTouchListener(this.btn_battle,function(){n.challengePy.challengeInfo.clear?Utils.MsgUtils.addMidMsg("已通关"):n.challengePy.challengeInfo.heros.length?n.challengePy.Challenge():Utils.MsgUtils.addMidMsg("至少选择一名英雄出战")}),Utils.TouchUtils.addTouchListener(this.btn_rank,function(){l.AppFacade.getInstance().showSubView(l.RankMediator.N,l.RankMediator.SV.COMMON,{module:"HERO_CHALLENGE"})}),Utils.TouchUtils.addTouchListener(this.btn_formation,function(){n.challengePy.challengeInfo.heros.length?l.AppFacade.getInstance().showSubView(l.HeroMediator.N,l.HeroMediator.SV.FORMATION,{battlePosInfo:n.challengePy.challengeInfo.heros,cb:function(e){var t=[];for(var i in e){var o=e[i];o&&t.push({uuid:o.info.uuid,battlePos:Number(i)})}n.challengePy.challengeInfo.heros=t,n.challengePy.HeroChangeFormation()}}):Utils.MsgUtils.addMidMsg("未选择英雄")}),Utils.TouchUtils.addTouchListener(this.btn_buffEffect,function(){l.AppFacade.getInstance().showSubView(l.HeroMediator.N,l.HeroMediator.SV.ATTR_DETAIL,{info:{attr:n.challengePy.challengeInfo.buffs},fromHeroChallenge:!0})}),Utils.TouchUtils.addTouchListener(this.btn_shop,function(){l.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeHeroChallenge})}),Utils.TouchUtils.addTouchListener(this.btn_guide,function(){PopUpManager.addPopUp({obj:new l.HelpDialog({moduleId:MODULE.HeroChallenge})})}),Utils.TouchUtils.addTouchListener(this.btn_back,function(){l.MainJumpConfig.jumpTo()})},i);function i(){var e=t.call(this)||this;return e.heroPy=l.AppFacade.getInstance().retrieveProxy(l.HeroPy.N),e.challengePy=l.AppFacade.getInstance().retrieveProxy(l.HeroChallenge2Py.N),e.skinName="HeroChallegne2MainSkin",e}l.HeroChallenge2MainView=e,__reflect(e.prototype,"game.HeroChallenge2MainView");var o,h=(__extends(n,o=BasePanel),n.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.data&&this.updateView(this.data)},n.prototype.updateView=function(e){var o=this,t=e.waitSelect,n=l.Config.heroChallengeBuff();t.forEach(function(e,t){var i=new s({config:n[e]});Utils.TouchUtils.addTouchListener(i,function(){l.AppFacade.getInstance().retrieveProxy(l.HeroChallenge2Py.N).SelectBuff(t+1,function(){o.hide()})}),o.gp_root.addChild(i)})},n);function n(e){var t=o.call(this)||this;return t.skinName="HeroChallenge2BuffSelectSkin",t.data=e,t}__reflect(h.prototype,"HeroChallenge2BuffSelectPanel");var a,r,s=(a=eui.Button,__extends(c,a),c.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.update()},c.prototype.update=function(){var e=this.data.config,t=e.attrType;this.img_icon.source=c.SRC_MAP[t].icon+"_png",this.img_attrName.source=c.SRC_MAP[t].attrName+"_png",this.blb_attr.text="+"+l.GeneralConfig.getAttrValue(e.value),this.lb_desc.text=AttrConfig[t].name+"增加"+l.GeneralConfig.getAttrValue(e.value)},c.SRC_MAP=((r={})[EAttrType.Atk]={icon:"yxtz2_img_gongji",attrName:"yxtz2_img_gonjizi"},r[EAttrType.Life]={icon:"yxtz2_img_shengming",attrName:"yxtz2_img_shengmingzi"},r[EAttrType.Defence]={icon:"yxtz2_img_fangyu",attrName:"yxtz2_img_fangyuzi"},r[EAttrType.ArmorBreak]={icon:"yxtz2_img_pojia",attrName:"yxtz2_img_pojiazi"},r[EAttrType.Crit]={icon:"yxtz2_img_baoji",attrName:"yxtz2_img_baojizi"},r[EAttrType.Parry]={icon:"yxtz2_img_gedang",attrName:"yxtz2_img_gedangzi"},r[EAttrType.FreeControl]={icon:"yxtz2_img_miankong",attrName:"yxtz2_img_miankongzi"},r[EAttrType.AntiInjury]={icon:"yxtz2_img_fanshang",attrName:"yxtz2_img_fanshangzi"},r[EAttrType.Miss]={icon:"yxtz2_img_shanbi",attrName:"yxtz2_img_shanbizi"},r[EAttrType.SockBlood]={icon:"yxtz2_img_xixue",attrName:"yxtz2_img_xixuezi"},r),c);function c(e){var t=a.call(this)||this;return t.skinName="HeroChallenge2MainView_BuffItem",t.data=e,t}__reflect(s.prototype,"HeroChallenge2MainView_BuffItem")}(game=game||{}),function(l){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.list_root.itemRenderer=o,this.defaultItem||(this.defaultItem=new o,this.defaultItem.horizontalCenter=this.defaultItem.verticalCenter=0,this.gp_default.addChild(this.defaultItem)),this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.CommonDaTanChuKuang.blb_title.text="选阵",this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.GameMVC.commonMed.showHelpDialog(MODULE.BattleFormation)},this)},i.prototype.updateView=function(e){this.params=e||this.params;for(var t=this.params&&this.params.type||1,i=this.params&&this.params.moduleId||0,o=l.GameMVC.heroMutiTeamPy.getModuleTeamId(i),n=[],a=0;a<2;a++){var r=l.GameMVC.heroMutiTeamPy.getBattleFormationTeamInfo(a+1);n.push({type:t,isDefault:0,teamId:a+1,curTeamId:o,moduleId:i,formation:r})}this.list_root.dataProvider=new eui.ArrayCollection(n),this.updateDefault()},i.prototype.updateDefault=function(){var e=new l.BattleFormationTeamInfo({}),t=this.params&&this.params.moduleId||0,i=l.GameMVC.heroMutiTeamPy.getModuleTeamId(t);for(var o in l.GameMVC.heroPy.heroUuid22Pos)if(l.GameMVC.heroPy.allHeroByUuid[o]){var n=l.GameMVC.heroPy.heroUuid22Pos[o];e.battleFormationHeroList.push({heroUuid:o,pos:n,heroEquipUuids:[],heroArtifactUuid:""})}for(var a in e.battleFormationHeroList.sort(function(e,t){return e.pos-t.pos}),l.GameMVC.petPy.allPetByUuid)if(1==(r=l.GameMVC.petPy.allPetByUuid[a]).pos){e.petUuid=r.uuid;break}for(var a in l.GameMVC.magicalArtifactPy.allMagicalArtifactByUuid){var r;if((r=l.GameMVC.magicalArtifactPy.allMagicalArtifactByUuid[a]).pos){e.magicalUuid=r.uuid;break}}this.defaultItem.data={type:this.params&&this.params.type||1,isDefault:1,teamId:0,curTeamId:i,moduleId:t,formation:e},this.defaultItem.dataChanged()},i);function i(){var e=t.call(this)||this;return e.skinName="HeroMutiTeamView",e}l.HeroMutiTeamView=e,__reflect(e.prototype,"game.HeroMutiTeamView");var n,o=(n=eui.ItemRenderer,__extends(a,n),a.prototype.childrenCreated=function(){var c=this;function e(n){var e=i.makeItems();e.verticalCenter=0,e.x=85*n,i.items.push(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(1==c.data.type||2==c.data.type)if(c.data.isDefault)l.GameMVC.heroMutiTeamMed.hideSubView(l.HeroMutiTeamMediator.SV.MAIN),2==c.data.type&&l.MainJumpConfig.jumpTo("HERO");else if(l.GameMVC.heroMutiTeamPy.getHeroByPos(c.data.teamId,n+1))l.GameMVC.heroMutiTeamMed.hideSubView(l.HeroMutiTeamMediator.SV.MAIN),l.GameMVC.heroMutiTeamMed.showSubView(l.HeroMutiTeamMediator.SV.DETAIL,{teamId:c.data.teamId,pos:n+1});else{var e=l.GameMVC.heroMutiTeamPy.getTeam(c.data.teamId),t=[1,2,3,4,5,6];for(var i in e.heroList){var o=e.heroList[i];0<=t.indexOf(o.pos)&&t.splice(t.indexOf(o.pos),1)}l.GameMVC.heroMed.showSubView(l.HeroMediator.SV.SELECT,{pos:n+1,teamId:c.data.teamId,type:l.HeroSelectPanel.SELECTFORM.HERO_MUTI_TEAM,btnFunc:function(e){l.GameMVC.heroMutiTeamPy.changeHero(c.data.teamId,n+1,e,function(){l.GameMVC.heroMutiTeamMed.hideSubView(l.HeroMutiTeamMediator.SV.MAIN),l.GameMVC.heroMutiTeamMed.showSubView(l.HeroMutiTeamMediator.SV.DETAIL,{teamId:c.data.teamId,pos:t[0]})})}})}},i),i.gp_heros.addChild(e)}n.prototype.childrenCreated.call(this);for(var t,i=this,o=0;o<6;o++)e(o);(t=this.makeItems()).verticalCenter=0,t.horizontalCenter=0,this.items.push(t),this.gp_pet.addChild(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.UnlockMgr.checkPass(MODULE.Pet,!1).allow){var t=void 0;if(c.data.isDefault)for(var e in l.GameMVC.petPy.allPetByUuid)1==(i=l.GameMVC.petPy.allPetByUuid[e]).pos&&(t=i.uuid);else for(var e in l.GameMVC.heroMutiTeamPy.battleFormationList){var i;if((i=l.GameMVC.heroMutiTeamPy.battleFormationList[e]).teamId==c.data.teamId){if(0==i.heroList.length)return void Utils.MsgUtils.addMidMsg("该阵容没有上阵英雄");t=i.pet.originalUuid}}PopUpManager.addPopUp({obj:new l.CommonChosePanel({getInfos:function(){var e=l.GameMVC.petPy.allPetByUuid,t={};for(var i in e)t[i]=e[i];return t},singleChoose:!0,noCloseAsConfirm:!0,type:EEntityType.EEntityTypePet,uniNum:!0,checkFull:function(e){return 1<=e.length},selectUuids:t?[t]:[],title:"请选择宠物"}),closeCB:function(e){e&&0<e.length&&e[0]&&e[0]!=t&&(c.data.isDefault?l.GameMVC.petPy.PetPutOn({uuid:e[0],pos:1},function(){l.GameMVC.heroMutiTeamMed.updateView(l.HeroMutiTeamMediator.SV.MAIN)}):l.GameMVC.heroMutiTeamPy.changePet(c.data.teamId,e[0]))}})}else Utils.MsgUtils.addMidMsg("未开启")},this),(t=this.makeItems()).verticalCenter=0,t.horizontalCenter=0,this.items.push(t),this.gp_magic.addChild(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(Utils.UnlockMgr.checkPass(MODULE.Magical,!1).allow){var t=void 0;if(c.data.isDefault)for(var e in l.GameMVC.magicalArtifactPy.allMagicalArtifactByUuid)(i=l.GameMVC.magicalArtifactPy.allMagicalArtifactByUuid[e]).pos&&(t=i.uuid);else for(var e in l.GameMVC.heroMutiTeamPy.battleFormationList){var i;if((i=l.GameMVC.heroMutiTeamPy.battleFormationList[e]).teamId==c.data.teamId){if(0==i.heroList.length)return void Utils.MsgUtils.addMidMsg("该阵容没有上阵英雄");t=i.magical.originalUuid}}PopUpManager.addPopUp({obj:new l.CommonChosePanel({getInfos:function(){var e=l.GameMVC.magicalArtifactPy.allMagicalArtifactByUuid,t={};for(var i in e)t[i]=e[i];return t},singleChoose:!0,noCloseAsConfirm:!0,type:EEntityType.EEntityTypeMagical,uniNum:!0,checkFull:function(e){return 1<=e.length},selectUuids:t?[t]:[],title:"请选择神兵"}),closeCB:function(e){e&&0<e.length&&e[0]&&e[0]!=t&&(c.data.isDefault?l.GameMVC.magicalArtifactPy.MagicalPutOn({uuid:e[0]},function(){l.GameMVC.heroMutiTeamMed.updateView(l.HeroMutiTeamMediator.SV.MAIN)}):l.GameMVC.heroMutiTeamPy.changeMagical(c.data.teamId,e[0]))}})}else Utils.MsgUtils.addMidMsg("未开启")},this),this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(1==c.data.type)c.showFormationPanel();else if(c.data.teamId==c.data.curTeamId)Utils.MsgUtils.addMidMsg("已上阵");else{for(var e in l.GameMVC.heroMutiTeamPy.battleFormationList){var t=l.GameMVC.heroMutiTeamPy.battleFormationList[e];if(t.teamId==c.data.teamId&&0==t.heroList.length)return void Utils.MsgUtils.addMidMsg("该阵容没有上阵英雄")}l.GameMVC.heroMutiTeamPy.server_ChooseBattleFormationTeam(c.data.moduleId,c.data.teamId,function(){Utils.MsgUtils.addMidMsg("选择成功")})}},this),this.btn_halo.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=[];if(c.data.isDefault){for(var t in l.GameMVC.heroPy.heroUuid22Pos){var i=l.GameMVC.heroPy.allHeroByUuid[t]&&l.GameMVC.heroPy.allHeroByUuid[t].code;i&&e.push(i)}l.AppFacade.getInstance().showSubView(l.HeroMediator.N,l.HeroMediator.SV.HERO_HALO,{codeList:e})}else{var o=l.GameMVC.heroMutiTeamPy.battleFormationList;for(var n in o){var a=o[n];if(a.teamId==c.data.teamId)for(var r in a.heroList){var s=a.heroList[r];e.push(s.code)}}l.AppFacade.getInstance().showSubView(l.HeroMediator.N,l.HeroMediator.SV.HERO_HALO,{codeList:e})}},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.showFormationPanel()},this),this.et_teamName.addEventListener(eui.UIEvent.FOCUS_OUT,function(){var e=parseInt(l.Config.constConfig().MaxBattleFormationNameNum.constValue);if(c.et_teamName.text.length>e)Utils.MsgUtils.addMidMsg("队伍名称最多"+e+"个字");else{var t=l.GameMVC.heroMutiTeamPy.getTeam(c.data.teamId);c.et_teamName.text!=t.teamName&&l.GameMVC.heroMutiTeamPy.server_ModifyBattleFormationName(c.data.teamId,c.et_teamName.text)}},this)},a.prototype.dataChanged=function(){var e=this.data.type,t=this.data.formation;if(this.data.isDefault)this.img_titleBg.source="dzr_img_di1_png",this.et_teamName.text="阵容（默认）",this.et_teamName.touchEnabled=!1;else{this.img_titleBg.source="dzr_img_di2_png";var i=l.GameMVC.heroMutiTeamPy.getTeam(this.data.teamId);this.et_teamName.text=i.teamName||"阵容"+this.data.teamId}this.btn_ope.scaleX=this.btn_ope.scaleY=.7,1==e?(this.btn_formation.visible=!1,this.btn_ope.label="",this.btn_ope.skinName="skins.ButtonSkinYellow",this.btn_ope.label="布阵"):(this.btn_formation.visible=!0,this.btn_ope.label="",this.data.curTeamId==this.data.teamId?(this.btn_ope.skinName="skins.ButtonSkinSure",this.btn_ope.label="已选择",this.btn_ope.scaleX=this.btn_ope.scaleY=1):(this.btn_ope.skinName="skins.ButtonSkinBlue",this.btn_ope.label="选择"));for(var o=0;o<6;o++){var n="";if(t.battleFormationHeroList)for(var a in t.battleFormationHeroList){var r=t.battleFormationHeroList[a];if(r.pos==o+1){n=r.heroUuid;break}}this.updateItem(this.items[o],EEntityType.EEntityTypeHero,n)}this.updateItem(this.items[6],EEntityType.EEntityTypePet,t.petUuid),this.updateItem(this.items[7],EEntityType.EEntityTypeMagical,t.magicalUuid)},a.prototype.makeItems=function(){var e=new eui.Group;e.width=e.height=80;var t=customui.BaseItemFactory.create();t.horizontalCenter=t.verticalCenter=0,t.scaleX=t.scaleY=.75,t.touchEnabled=!1;var i=new eui.Image;i.scaleX=i.scaleY=.8,i.horizontalCenter=i.verticalCenter=0;var o=new eui.Image;o.horizontalCenter=o.verticalCenter=0,o.source="common_img_jia_png";var n=new eui.Image;return n.scaleX=n.scaleY=.75,n.horizontalCenter=n.verticalCenter=0,n.source="_border_m_json.common_img_jichuwupingkuang2",e.addChild(n),e.addChild(i),e.addChild(o),e.addChild(t),e},a.prototype.updateItem=function(e,t,i){var o=e.$children[1],n=e.$children[2],a=e.$children[3];if(i)switch(o.visible=!1,n.visible=!1,a.visible=!0,egret.Tween.removeTweens(n),t){case EEntityType.EEntityTypeHero:var r=l.GameMVC.heroMutiTeamPy.getHeroOriginalUuid(i),s=l.GameMVC.heroPy.allHeroByUuid[r];if(s.dermaCode){var c=l.Config.getHeroDermaConfig()[s.dermaCode].avatar;a.updateData({type:t,uuid:r,avatar:c})}else a.updateData({type:t,uuid:r});break;case EEntityType.EEntityTypePet:case EEntityType.EEntityTypeMagical:a.updateData({type:t,uuid:i})}else switch(o.visible=!0,n.visible=!0,a.visible=!1,UIActionManager.fadeBlink(n,!0,!1,500),t){case EEntityType.EEntityTypeHero:o.source="dzr_icon_yingxiong_png";break;case EEntityType.EEntityTypePet:o.source="dzr_icon_chongwu_png";break;case EEntityType.EEntityTypeMagical:o.source="dzr_icon_zhuangbei_png"}},a.prototype.showFormationPanel=function(){var a=this;if(this.data.isDefault)l.AppFacade.getInstance().showSubView(l.HeroMediator.N,l.HeroMediator.SV.FORMATION);else{var e=[],t=l.GameMVC.heroMutiTeamPy.getBattleFormationTeamInfo(this.data.teamId);for(var i in t.battleFormationHeroList){var o=t.battleFormationHeroList[i];e.push({uuid:l.GameMVC.heroMutiTeamPy.getHeroOriginalUuid(o.heroUuid),battlePos:o.battlePos})}l.AppFacade.getInstance().showSubView(l.HeroMediator.N,l.HeroMediator.SV.FORMATION,{battlePosInfo:e,cb:function(e){var t=[];for(var i in e){var o=e[i];if(o){var n=l.GameMVC.heroMutiTeamPy.originalUuid2TeamVO(a.data.teamId,o.info.uuid);t.push({uuid:n&&n.uuid||o.info.uuid,pos:Number(i)})}}t.sort(function(e,t){return e.pos-t.pos}),l.GameMVC.heroMutiTeamPy.changeFormation(a.data.teamId,t,function(){l.GameMVC.heroMutiTeamMed.updateView(l.HeroMutiTeamMediator.SV.DETAIL,{pos:t[0].pos}),l.GameMVC.heroMutiTeamMed.updateView(l.HeroMutiTeamMediator.SV.MAIN)})}})}},a);function a(){var e=n.call(this)||this;return e.items=[],e.skinName="HeroMutiTeamViewItem",e}__reflect(o.prototype,"HeroMutiTeamViewItem")}(game=game||{}),function(C){var t,e=(__extends(o,t=BaseFull),o.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_hero_list),this.initGPRightBtn(),this.initGPLeftBtn(),this.initTabbar(),this.initThing(),this.activateComponent(),this.gp_heroInfo.visible=this.gp_right_btn.visible=this.gp_left_btn.visible=this.gp_hero_list.visible=!1,this.once(egret.Event.ENTER_FRAME,function(){e.gp_heroInfo.visible=e.gp_right_btn.visible=e.gp_left_btn.visible=e.gp_hero_list.visible=!0,e.gp_hero_list.y,UIActionManager.playUIAction(e.gp_right_btn,4),UIActionManager.playUIAction(e.gp_left_btn,3),UIActionManager.playUIAction(e.gp_hero_list,5)},this)},o.prototype.initGPRightBtn=function(){for(var e in o.BTN_TYPE){var t=o.BTN_TYPE[e],i=new eui.Button;i.skinName="skins.ButtonSkinIcon2",i.width=80,i.height=94,i.icon=t.icon,i.label=t.text,this[t.id]=i,this.gp_right_btn.addChild(this[t.id])}},o.prototype.initGPLeftBtn=function(){for(var e in o.BTN_LEFT_TYPE){var t=o.BTN_LEFT_TYPE[e],i=new eui.Button;i.skinName="skins.ButtonSkinIcon2",i.width=80,i.height=94,i.icon=t.icon,i.label=t.text,this[t.id]=i,this.gp_left_btn.addChild(this[t.id])}},o.prototype.initTabbar=function(e){void 0===e&&(e=!0),this.heroInfo_tabbar.itemRendererSkinName="HeroMainView_HeroInfoTabItem",this.heroInfo_tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabbarItemTap,this),this.heroInfo_tabbar.dataProvider=new eui.ArrayCollection([{up:"_btn_yq_m_json.common_yeqian_zhuangbei_0",down:"_btn_yq_m_json.common_yeqian_zhuangbei_1"},{up:"_btn_yq_m_json.common_yeqian_shengji_0",down:"_btn_yq_m_json.common_yeqian_shengji_1"}])},o.prototype.initThing=function(){var e=this,t=0;for(var i in HeroEquipType){var o=new C.HeroEquipBox(HeroEquipType[i]);this.heroThingItems.push(o);var n=this.heroThingPos[t++];o.x=n[0],o.y=n[1],this.gp_thingBox.addChild(o)}o=new C.HeroTreasureBox,this.heroThingItems.push(o),n=this.heroThingPos[t++],o.x=n[0],o.y=n[1],this.gp_thingBox.addChild(o),o=new C.HeroArtifactBox,this.heroThingItems.push(o),n=this.heroThingPos[t++],o.x=n[0],o.y=n[1],this.gp_thingBox.addChild(o),o=new C.HeroImmortalBox,this.heroThingItems.push(o),n=this.heroThingPos[t++],o.x=n[0],o.y=n[1],this.gp_thingBox.addChild(o),this.btn_putOn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){C.GameMVC.heroMutiTeamPy.server_PutHeroOnByOneKey(e.curTeamId,e.curInfo.uuid)},this),this.btn_putOff.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){C.GameMVC.heroMutiTeamPy.oneKeyPutDown(e.curTeamId,e.curInfo.uuid)},this)},o.prototype.updateView=function(e){switch(this.curPos=e&&e.pos||this.curPos||1,this.curTeamId=e&&e.teamId||this.curTeamId||1,this.curInfo=C.GameMVC.heroMutiTeamPy.getHeroByPos(this.curTeamId,this.curPos),this.updateHeroList(),this.updateAppearance(),this.updateMagicBtn(),this.gp_heroThing.visible=!1,this.gp_up.visible=!1,this.curTabbarIndex){case 0:this.gp_heroThing.visible=!0,this.blb_title.text="装备";break;case 1:this.gp_up.visible=!0,this.blb_title.text="信息"}this.updateHeroThing(),this.updateHeroUpgrade()},o.prototype.onHeroItemTap=function(t){var i=this;if(1<=t&&t<=6){var e=C.GameMVC.heroMutiTeamPy.getHeroByPos(this.curTeamId,t);if(e)this.curPos=t,this.curInfo=e,this.updateAppearance(),this.updateMagicBtn(),this.updateHeroThing(),this.updateHeroUpgrade();else{var o=C.GameMVC.heroMutiTeamPy.getTeam(this.curTeamId),n=[1,2,3,4,5,6];for(var a in o.heroList){var r=o.heroList[a];0<=n.indexOf(r.pos)&&n.splice(n.indexOf(r.pos),1)}0<n.length&&C.GameMVC.heroMed.showSubView(C.HeroMediator.SV.SELECT,{pos:t,teamId:this.curTeamId,type:C.HeroSelectPanel.SELECTFORM.HERO_MUTI_TEAM,btnFunc:function(e){C.GameMVC.heroMutiTeamPy.changeHero(i.curTeamId,t,e,function(){i.updateView({pos:n[0]})})}})}}else Utils.MsgUtils.addMidMsg("位置不合法")},o.prototype.onTabbarItemTap=function(e){switch(e&&e.itemIndex!=this.curTabbarIndex&&(Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_beibaohuanye),this.index=e.itemIndex,this.curTabbarIndex=e.itemIndex),this.gp_heroThing.visible=!1,this.gp_up.visible=!1,this.curTabbarIndex){case 0:this.gp_heroThing.visible=!0,this.blb_title.text="装备";break;case 1:this.gp_up.visible=!0,this.blb_title.text="信息"}},o.prototype.updateHeroThing=function(){var f=this,_=C.GameMVC.heroMutiTeamPy.getHeroEquips(this.curTeamId,this.curInfo&&this.curInfo.uuid),m=C.GameMVC.heroMutiTeamPy.getHeroArtifact(this.curTeamId,this.curInfo&&this.curInfo.uuid),e=C.GameMVC.heroMutiTeamPy.getHeroOriginalUuid(this.curInfo&&this.curInfo.uuid),y=C.GameMVC.heroThingPy.getHeroTreasuresByUuid(e),v=C.GameMVC.heroMutiTeamPy.getHeroImmortal(this.curTeamId,this.curInfo&&this.curInfo.uuid),T=[];this.heroThingItems.forEach(function(e,t){for(var i=!1,o=0,n=_;o<n.length;o++){var a=n[o];if(e.entityType==EEntityType.EEntityTypeHeroEquip&&a.type==e.type){T.push(t),i=!0,e.update({hero:f.curInfo,vo:a,source:C.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM,teamId:f.curTeamId});break}}if(!i)for(var r=0,s=m;r<s.length;r++){var c=s[r];if(e.entityType==EEntityType.EEntityTypeHeroArtifact&&c.type==e.type){i=!0,T.push(t),e.update({hero:f.curInfo,vo:c,source:C.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM,teamId:f.curTeamId});break}}if(!i)for(var l=0,h=y;l<h.length;l++){var p=h[l];if(e.entityType==EEntityType.EEntityTypeTreasure&&p.type==e.type){i=!0,T.push(t),e.update({hero:f.curInfo,vo:p,source:C.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM,teamId:f.curTeamId});break}}if(!i)for(var d=0,u=v;d<u.length;d++){var g=u[d];if(e.entityType==EEntityType.EEntityTypeImmortal&&g.type==e.type){i=!0,T.push(t),e.update({hero:f.curInfo,vo:g,source:C.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM,teamId:f.curTeamId});break}}}),this.heroThingItems.forEach(function(e,t){T.indexOf(t)<0&&e.update({hero:f.curInfo,source:C.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM_PUTON,teamId:f.curTeamId})})},o.prototype.updateHeroList=function(){var i=this;if(!this.gp_heroitems.$children.length){function e(e){var t=new C.HeroMainView_HeroListItem;t.name=e.toString(),t.x=12.5+115*(e-1),t.gp_empty.touchChildren=t.gp_empty.touchEnabled=!1,t.gp_baseitem.touchChildren=t.gp_baseitem.touchEnabled=!1,o.gp_heroitems.addChildAt(t,0),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.onHeroItemTap(e)},o)}for(var o=this,t=1;t<=6;t++)e(t)}for(t=1;t<=6;t++){var n=this.gp_heroitems.getChildByName(t.toString()),a=Utils.UnlockMgr.checkPass(t,!1),r=C.GameMVC.heroMutiTeamPy.getHeroByPos(this.curTeamId,t);n.updateItem({uuid:r&&r.originalUuid,unlock:a,info:r})}},o.prototype.updateAppearance=function(){var e="",t=C.GameMVC.heroPy.allHeroByUuid;for(var i in this.img_race_icon.source=HeroRaceConfig[this.curInfo.config.race].raceIconBig,this.img_tier_icon.source=C.GeneralConfig.getHeroJingyingTag(this.curInfo.config.code),t){var o=t[i];if(o.uuid==this.curInfo.originalUuid){e=o.dermaCode;break}}var n=void 0;if(""==e){this.hero_model.update({code:this.curInfo.code,isPet:!1});var a=C.Config.allHeroConfig()[this.curInfo.code];this.lb_name.text=a.name,n=a.avatar}else{this.lb_name.text=C.Config.getHeroDermaConfig()[e].name;var r=C.Config.getHeroDermaConfig()[e];this.hero_model.update({code:this.curInfo.code,isPet:!1,derma:r}),n=C.Config.getHeroDermaConfig()[e].avatar}var s=C.GeneralConfig.getHeroStarInfo(this.curInfo.starLevel);if(this.gp_star.removeChildren(),s.stage<4)for(var c=0;c<s.num;c++)this.gp_star.addChild(new eui.Image(s.src));else this.gp_star.addChild(new customui.HighStarLevelIcon(s.num));var l=this.curPos,h=this.gp_heroitems.getChildByName(l.toString()),p=Utils.UnlockMgr.checkPass(l,!1);h.updateItem({uuid:this.curInfo&&this.curInfo.uuid,unlock:p,info:this.curInfo,oneAvatar:n})},o.prototype.bindSkillPanelClick=function(t){var i=this,o=t.target;o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){if(o.data&&o.data.code)for(var e in i.skill_panel.visible=!0,i.skill_panel.updateItem({code:o.data.code,tips:o.data.unlockTips,heroVo:i.curInfo}),t)"target"!=e&&(i.skill_panel[e]=t[e])},this),o.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skill_panel.visible=!1},this),o.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skill_panel.visible=!1},this),o.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skill_panel.visible=!1},this)},o.prototype.updateHeroUpgrade=function(){var c=this.curInfo,l=C.Config.allHeroConfig()[c.code];this.item_fightCap.update(c.fightCap),this.img_profession.source=ProfessionConfig[l.profession].icon,this.img_race.source=HeroRaceConfig[l.race].raceIconBig,this.lb_profession.text=l.name,this.lb_desc.text=l.desc,this.baseItem_avatar||(this.baseItem_avatar=customui.BaseItemFactory.create(),this.baseItem_avatar.scaleX=this.baseItem_avatar.scaleY=.7,this.baseItem_avatar.touchEnabled=!1,this.gp_heroAvatar.addChild(this.baseItem_avatar)),this.baseItem_avatar.updateData({code:c.code,effect:!0}),this.baseItem_avatar.gp_star_hero.visible=this.baseItem_avatar.img_type.visible=this.baseItem_avatar.gp_star_hero2.visible=!1,this.gp_upgrade_attr.removeChildren();for(var e=JSON.parse(c.attr),t=1;t<=4;t++)this.gp_upgrade_attr.addChild(new C.HeroMainView_AttrItem({type:t,num:e[t]}));function i(e){var t=d["skill_"+e];if(p)t.reset();else{var i=SKILL_CODE[e],o=void 0;if(0<c.defendLevel){var n=C.Config.heroDefendConfig(l.subType);o=JSON.parse(n[c.defendLevel-1].skills)[e-1]}else o=l[i];if(o){var a=c.skillList.some(function(e){return e.code===o}),r="";a||(r=h[e]+"阶解锁");var s={code:o,unlock:a,unlockTips:r};d["skill_"+e].updateItem(s)}else d["skill_"+e].updateItem(),p=!0}}this.gp_skills.visible=!0;var h=JSON.parse(l.skillUnlock),p=!1,d=this;for(t=1;t<=5;t++)i(t);var o=C.Config.heroAndPetSectionConfig()[c.sectionLevel+1],n=o&&o.level||9999999,a=l.maxLevel;if(0<c.defendLevel){var r=C.Config.heroDefendConfig(l.subType);0<r.length&&(a=r[c.defendLevel-1].maxLevel)}var s=Math.min(n,a);this.lb_level.text=c.level+"/"+s},o.prototype.activateComponent=function(){for(var r=this,e=1;e<=5;e++){var t=this["skill_"+e];this.bindSkillPanelClick({target:t,x:34,bottom:e<4?200:132})}this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.hide()},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var a=this,e=[],t=C.GameMVC.heroMutiTeamPy.getBattleFormationTeamInfo(this.curTeamId);for(var i in t.battleFormationHeroList){var o=t.battleFormationHeroList[i];e.push({uuid:C.GameMVC.heroMutiTeamPy.getHeroOriginalUuid(o.heroUuid),battlePos:o.battlePos})}C.AppFacade.getInstance().showSubView(C.HeroMediator.N,C.HeroMediator.SV.FORMATION,{battlePosInfo:e,cb:function(e){var t=[];for(var i in e){var o=e[i];if(o){var n=C.GameMVC.heroMutiTeamPy.originalUuid2TeamVO(a.curTeamId,o.info.uuid);t.push({uuid:n&&n.uuid||o.info.uuid,pos:Number(i)})}}t.sort(function(e,t){return e.pos-t.pos}),C.GameMVC.heroMutiTeamPy.changeFormation(a.curTeamId,t,function(){C.GameMVC.heroMutiTeamMed.updateView(C.HeroMutiTeamMediator.SV.DETAIL)})}})},this),this.btn_change.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;C.GameMVC.heroMed.showSubView(C.HeroMediator.SV.SELECT,{pos:this.curPos,teamId:this.curTeamId,type:C.HeroSelectPanel.SELECTFORM.HERO_MUTI_TEAM,btnFunc:function(e){C.GameMVC.heroMutiTeamPy.changeHero(t.curTeamId,t.curPos,e,function(){t.updateView()})}})},this),this.hero_model.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hero_model.changeAction(customui.HeroDynamicModel.TOUCH_ACTION_LIST)},this),this.btn_details.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){C.AppFacade.getInstance().showSubView(C.HeroMediator.N,C.HeroMediator.SV.ATTR_DETAIL,{info:this.curInfo})},this),this.btn_magic.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new n({heroUuid:r.curInfo.uuid,teamId:r.curTeamId})})},this),Utils.TouchUtils.addTouchListener(this.btn_halo,function(){var e=[],t=C.GameMVC.heroMutiTeamPy.battleFormationList;for(var i in t){var o=t[i];if(o.teamId==r.curTeamId)for(var n in o.heroList){var a=o.heroList[n];e.push(a.code)}}C.AppFacade.getInstance().showSubView(C.HeroMediator.N,C.HeroMediator.SV.HERO_HALO,{codeList:e})})},o.prototype.updateMagicBtn=function(){if(Utils.UnlockMgr.checkPass(MODULE.MagicalPutOn,!1).allow){var e=C.GameMVC.heroMutiTeamPy.getTeam(this.curTeamId).magicalList;for(var t in e){var i=e[t];if(C.GameMVC.heroMutiTeamPy.getMagicHeroUuid(this.curTeamId,i.uuid)==this.curInfo.originalUuid){var o=i.code%100;return void(this.btn_magic.icon="icon_shenbing_"+(o<10?"0"+o:o)+"_png")}}this.btn_magic.icon="dzr_img_dikuang2_png"}else this.btn_magic.visible=!1},o.BTN_TYPE={buzhen:{icon:"_btn_lb_m_json.common_icon_buzhen",text:"布阵",id:"btn_formation"},halo:{icon:"_btn_lb_m_json.common_icon_guanghuan",text:"光环",id:"btn_halo"},huanzhen:{icon:"_btn_lb_m_json.common_icon_huanzhen",text:"换阵",id:"btn_change"}},o.BTN_LEFT_TYPE={magical:{icon:"dzr_img_dikuang2_png",text:"神 器",id:"btn_magic"}},o);function o(){var e=t.call(this)||this;return e.index=0,e.curTeamId=1,e.curPos=1,e.curTabbarIndex=0,e.heroThingPos=[[-67,131],[67,7],[253,7],[382,131],[253,261],[67,261],[160,135]],e.skinName="HeroMutiTeamDetailView",e.heroThingItems=new Array,e.guideEffectWait=!0,e}C.HeroMutiTeamDetailView=e,__reflect(e.prototype,"game.HeroMutiTeamDetailView");var i,n=(__extends(a,i=BasePanel),a.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.list_root.dataProvider=new eui.ArrayCollection,this.list_root.itemRenderer=C.MagicPutOnPanelItem,this.CommonDaTanChuKuang.blb_title.text="神器佩戴",this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.updateView()},a.prototype.updateView=function(){var n=this,e=C.Config.allMagicalConfig(),t=[],i=0;for(var o in e){var a=C.GameMVC.magicalArtifactPy.getInfoByCode(e[o].code),r=C.Config.magicalUpgradeConfig(e[o].code),s=JSON.parse(r[0].skills),c=void 0,l=!(c={});a?(c={code:e[o].code,level:a.level,uuid:a.uuid,sectionLevel:a.sectionLevel,skillList:a.skillList,attr:a.attr,originalUuid:a.originalUuid||a.uuid,heroUuid:C.GameMVC.heroMutiTeamPy.getMagicHeroUuid(this.params.teamId,a.uuid)},l=!0):c={code:e[o].code,level:0,sectionLevel:0,skillList:[{code:s[0]}],fightCap:0},l&&(t.push({vo:c,curHeroUuid:C.GameMVC.heroMutiTeamPy.getHeroOriginalUuid(this.params.heroUuid),hasActivate:l,index:i,teamId:this.params.teamId,updateView:function(){n.updateView()},operationCB:function(t){if(t.hasActivate){function i(){var e=o.uuid;o.heroUuid==t.curHeroUuid&&(e=""),C.GameMVC.heroMutiTeamPy.changeHeroMagical(t.teamId,t.curHeroUuid,e,function(){t.updateView()})}var o=t.vo;o.heroUuid&&o.heroUuid!=t.curHeroUuid?C.GameMgr.getInstance().showCommonTipsWin({commonTips:"该神器已佩戴于其它英雄，请确认是否继续佩戴？",clickCB:function(e){1===e.type&&i()}}):i()}else Utils.MsgUtils.addMidMsg("神兵未激活")},updateSkillPanel:function(e,t,i,o){n.updateSkillPanel(e,t,i,o)}}),i++)}this.list_root.dataProvider.replaceAll(t)},a.prototype.updateSkillPanel=function(e,t,i,o){if(t){this.SkillDetailsPanel.visible=!0;var n=this.sl_root.viewport.scrollV,a=166*parseInt(e)-n-27;this.SkillDetailsPanel.top=a,this.SkillDetailsPanel.updateItem({code:i,tips:o})}else this.SkillDetailsPanel.visible=!1},a);function a(e){var t=i.call(this)||this;return t.skinName="MagicPutOnPanel",t.params=e,t}__reflect(n.prototype,"MutilTeamMagicPutOnPanel")}(game=game||{}),function(e){var t=(i.registerAll=function(){},i);function i(){}e.HeroMutiTeamProcess=t,__reflect(t.prototype,"game.HeroMutiTeamProcess")}(game=game||{}),function(g){var t,e=(__extends(i,t=BaseProxy),i.prototype.getBattleFormationTeamInfo=function(e){var t=new g.BattleFormationTeamInfo({});if(e){for(var i in this.battleFormationList){var o=this.battleFormationList[i];if(o.teamId==e){var n=[];for(var a in o.heroList){var r=o.heroList[a],s=new g.BattleFormationHeroInfo({});s.heroUuid=r.uuid,s.pos=r.pos,s.battlePos=r.battlePos;var c=this.getHeroOriginalUuid(r.uuid);for(var l in o.heroEquipList){var h=o.heroEquipList[l];h.heroUuid==c&&s.heroEquipUuids.push(h.uuid)}for(var l in o.heroArtifactList){var p=o.heroArtifactList[l];p.heroUuid==c&&(s.heroArtifactUuid=p.uuid)}for(var l in o.magicalList){var d=o.magicalList[l];d.heroUuid==c&&(s.magicalUuid=d.uuid)}for(var l in o.immortalList){var u=o.immortalList[l];u.heroUuid==c&&(s.immortalUuid=u.uuid)}n.push(s)}t.update({battleFormationHeroList:n,petUuid:o.pet&&o.pet.originalUuid||"",magicalUuid:o.magical&&o.magical.originalUuid||""})}}return t}},i.prototype.getHeroOriginalUuid=function(e){for(var t in this.battleFormationList){var i=this.battleFormationList[t];for(var o in i.heroList){var n=i.heroList[o];if(n.uuid==e)return n.originalUuid}}return e},i.prototype.getTeam=function(e){for(var t in this.battleFormationList){var i=this.battleFormationList[t];if(i.teamId==e)return i}},i.prototype.getModuleTeamId=function(e){for(var t in this.battleFormationModuleList){var i=this.battleFormationModuleList[t];if(i.moduleId==e)return i.teamId}return 0},i.prototype.getMutilHeroUuid=function(e,t){for(var i in this.battleFormationList){var o=this.battleFormationList[i];if(o.teamId==t)for(var n in o.heroList){var a=o.heroList[n];if(a.originalUuid==e)return a.uuid}}return e},i.prototype.getHeroByPos=function(e,t){for(var i in this.battleFormationList){var o=this.battleFormationList[i];if(o.teamId==e)for(var n in o.heroList){var a=o.heroList[n];if(a.pos==t)return a}}},i.prototype.getHeroEquips=function(e,t){void 0===t&&(t="");var i=[],o=g.GameMVC.heroThingPy.AllEquipInfo;for(var n in t=this.getHeroOriginalUuid(t),this.battleFormationList){var a=this.battleFormationList[n];if(a.teamId==e)for(var r in a.heroEquipList){var s=a.heroEquipList[r];s.heroUuid!=t&&t||(s.type=o[s.originalUuid].type,i.push(s))}}return i},i.prototype.getHeroArtifact=function(e,t){void 0===t&&(t="");var i=[];for(var o in g.GameMVC.heroThingPy.AllArtiInfo,t=this.getHeroOriginalUuid(t),this.battleFormationList){var n=this.battleFormationList[o];if(n.teamId==e)for(var a in n.heroArtifactList){var r=n.heroArtifactList[a];r.heroUuid!=t&&t||i.push(r)}}return i},i.prototype.getHeroImmortal=function(e,t){void 0===t&&(t="");var i=[];for(var o in t=this.getHeroOriginalUuid(t),this.battleFormationList){var n=this.battleFormationList[o];if(n.teamId==e)for(var a in n.immortalList){var r=n.immortalList[a];r.heroUuid!=t&&t||i.push(r)}}return i},i.prototype.getEquipOriginalUuid=function(e,t){for(var i in this.battleFormationList){var o=this.battleFormationList[i];if(o.teamId==e)for(var n in o.heroEquipList){var a=o.heroEquipList[n];if(a.uuid==t)return a.originalUuid}}return t},i.prototype.getArtifactOriginalUuid=function(e,t){for(var i in this.battleFormationList){var o=this.battleFormationList[i];if(o.teamId==e)for(var n in o.heroArtifactList){var a=o.heroArtifactList[n];if(a.uuid==t)return a.originalUuid}}return t},i.prototype.getImmortalOriginalUuid=function(e,t){for(var i in this.battleFormationList){var o=this.battleFormationList[i];if(o.teamId==e)for(var n in o.immortalList){var a=o.immortalList[n];if(a.uuid==t)return a.originalUuid}}return t},i.prototype.getHeroMagicOriginalUuid=function(e,t){for(var i in this.battleFormationList){var o=this.battleFormationList[i];if(o.teamId==e)for(var n in o.magicalList){var a=o.magicalList[n];if(a.uuid==t)return a.originalUuid}}return t},i.prototype.originalUuid2TeamVO=function(e,t){for(var i in this.battleFormationList){var o=this.battleFormationList[i];if(o.teamId==e)for(var n in o.heroList){var a=o.heroList[n];if(a.originalUuid==t)return a}}},i.prototype.getMagicHeroUuid=function(e,t){if(!e){var i=g.GameMVC.magicalArtifactPy.allMagicalArtifactByUuid;return i[t]?i[t].heroUuid:""}var o=this.getTeam(e);if(o)for(var n in o.magicalList){var a=o.magicalList[n];if(a.uuid==t||a.originalUuid==t)return this.getHeroOriginalUuid(a.heroUuid)}return""},i.prototype.getHeroMagicHeroOriginalUuid=function(e,t){var i=this.getTeam(e);for(var o in i.magicalList){var n=i.magicalList[o];if(n.uuid==t)return n.originalUuid}return t},i.prototype.changeHero=function(e,t,i,o){var n=this.getBattleFormationTeamInfo(e),a=!1;for(var r in n.battleFormationHeroList)if((l=n.battleFormationHeroList[r]).pos==t){a=!0,n.battleFormationHeroList[r].heroUuid=i;break}if(!a){var s=[1,2,3,4,5,6],c=[1,2,3,4,5,6];for(var r in n.battleFormationHeroList){var l=n.battleFormationHeroList[r];0<=c.indexOf(l.battlePos)&&c.splice(c.indexOf(l.battlePos),1),0<=s.indexOf(l.pos)&&s.splice(s.indexOf(l.pos),1)}0<c.length&&0<s.length?n.battleFormationHeroList.push(new g.BattleFormationHeroInfo({heroUuid:i,pos:s[0],battlePos:c[0],heroEquipUuids:[],heroArtifactUuid:"",immortalUuid:""})):Utils.MsgUtils.addMidMsg("没有上阵位置")}this.server_ModifyBattleFormationTeam(e,n,o)},i.prototype.changeFormation=function(e,t,i){var o=this.getBattleFormationTeamInfo(e);for(var n in t){var a=t[n];for(var r in o.battleFormationHeroList)o.battleFormationHeroList[r].heroUuid==a.uuid&&(o.battleFormationHeroList[r].battlePos=a.pos)}this.server_ModifyBattleFormationTeam(e,o,i)},i.prototype.changeEquip=function(e,t,i,o,n){var a=this.getBattleFormationTeamInfo(e);for(var r in t=this.getMutilHeroUuid(t,e),a.battleFormationHeroList){var s=a.battleFormationHeroList[r];if(s.heroUuid==t){var c=s.heroEquipUuids,l=c.indexOf(i);0<=l&&c.splice(l,1),o&&c.push(o)}}this.server_ModifyBattleFormationTeam(e,a,n,!0)},i.prototype.changeArtifact=function(e,t,i,o){var n=this.getBattleFormationTeamInfo(e);for(var a in t=this.getMutilHeroUuid(t,e),n.battleFormationHeroList){var r=n.battleFormationHeroList[a];r.heroUuid==t&&(r.heroArtifactUuid=i)}this.server_ModifyBattleFormationTeam(e,n,o,!0)},i.prototype.changeImmortal=function(e,t,i,o){var n=this.getBattleFormationTeamInfo(e);for(var a in t=this.getMutilHeroUuid(t,e),n.battleFormationHeroList){var r=n.battleFormationHeroList[a];r.heroUuid==t&&(r.immortalUuid=i)}this.server_ModifyBattleFormationTeam(e,n,o,!0)},i.prototype.changePet=function(e,t,i){var o=this.getBattleFormationTeamInfo(e);o.petUuid=t,this.server_ModifyBattleFormationTeam(e,o,i,!0)},i.prototype.changeMagical=function(e,t,i){var o=this.getBattleFormationTeamInfo(e);o.magicalUuid=t,this.server_ModifyBattleFormationTeam(e,o,i,!0)},i.prototype.changeHeroMagical=function(e,t,i,o){var n=this.getBattleFormationTeamInfo(e);for(var a in t=this.getMutilHeroUuid(t,e),n.battleFormationHeroList){var r=n.battleFormationHeroList[a];this.getHeroMagicOriginalUuid(e,r.magicalUuid)==i&&(r.magicalUuid=""),r.heroUuid==t&&(r.magicalUuid=i)}this.server_ModifyBattleFormationTeam(e,n,o,!0)},i.prototype.oneKeyPutDown=function(e,t,i){var o=this.getBattleFormationTeamInfo(e);for(var n in t=this.getMutilHeroUuid(t,e),o.battleFormationHeroList){var a=o.battleFormationHeroList[n];a.heroUuid==t&&(a.heroEquipUuids=[],a.heroArtifactUuid="",a.immortalUuid="")}this.server_ModifyBattleFormationTeam(e,o,i,!0)},i.prototype.server_GetBattleFormationInfo=function(o){var n=this;Utils.Socket.send("battleFormation","GetBattleFormationInfo",{}).then(function(e){for(var t in n.battleFormationList=[],e.battleFormationList){var i=e.battleFormationList[t];n.battleFormationList.push(new g.BattleFormationInfo(i))}n.battleFormationModuleList=e.battleFormationModuleList,o&&o()})},i.prototype.server_ModifyBattleFormationName=function(o,n){var a=this;Utils.Socket.send("battleFormation","ModifyBattleFormationName",{teamId:o,teamName:n}).then(function(e){for(var t in a.battleFormationList){var i=a.battleFormationList[t];i.teamId==o&&(i.teamName=n)}g.GameMVC.heroMutiTeamMed.updateView(g.HeroMutiTeamMediator.SV.MAIN)})},i.prototype.server_ModifyBattleFormationTeam=function(o,t,n,a){var r=this;function e(e){var i=t.battleFormationHeroList[e];i.heroUuid=s.getHeroOriginalUuid(i.heroUuid),i.heroEquipUuids.forEach(function(e,t){i.heroEquipUuids[t]=r.getEquipOriginalUuid(o,i.heroEquipUuids[t])}),i.heroArtifactUuid=s.getArtifactOriginalUuid(o,i.heroArtifactUuid),i.magicalUuid=s.getHeroMagicOriginalUuid(o,i.magicalUuid),i.immortalUuid=s.getImmortalOriginalUuid(o,i.immortalUuid)}void 0===a&&(a=!1);var s=this;for(var i in t.battleFormationHeroList)e(i);Utils.Socket.send("battleFormation","ModifyBattleFormationTeam",{teamId:o,battleFormationTeamInfo:t}).then(function(e){var t=!1;for(var i in r.battleFormationList)r.battleFormationList[i].teamId==o&&(r.battleFormationList[i].update(e.battleFormationInfo),t=!0);t||r.battleFormationList.push(new g.BattleFormationInfo(e.battleFormationInfo)),n&&n(),a&&(g.GameMVC.heroMutiTeamMed.updateView(g.HeroMutiTeamMediator.SV.DETAIL),g.GameMVC.heroMutiTeamMed.updateView(g.HeroMutiTeamMediator.SV.MAIN))})},i.prototype.server_ChooseBattleFormationTeam=function(e,t,i){var o=this;Utils.Socket.send("battleFormation","ChooseBattleFormationTeam",{moduleId:e,teamId:t}).then(function(e){o.battleFormationModuleList=e.battleFormationModuleList,g.GameMVC.heroMutiTeamMed.updateView(g.HeroMutiTeamMediator.SV.MAIN),i&&i()})},i.prototype.server_PutHeroOnByOneKey=function(e,t,o){var n=this;Utils.Socket.send("battleFormation","PutHeroOnByOneKey",{teamId:e,uuid:t}).then(function(e){for(var t in n.battleFormationList){var i=n.battleFormationList[t];i.teamId==e.battleFormationInfo.teamId&&i.update(e.battleFormationInfo)}o&&o(),g.GameMVC.heroMutiTeamMed.updateView(g.HeroMutiTeamMediator.SV.DETAIL)})},i.N="HeroMutiTeamPy",i);function i(){var e=t.call(this,i.N)||this;return e.battleFormationList=[],e}g.HeroMutiTeamPy=e,__reflect(e.prototype,"game.HeroMutiTeamPy")}(game=game||{}),function(e){var t,i=(__extends(o,t=BaseMediator),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,e.HeroMutiTeamView),this.addSubView(o.SV.DETAIL,e.HeroMutiTeamDetailView)},o.prototype.listNotificationInterests=function(){return[CN.LOGIN_FINAL_DONE,CN.HIDE_ALL_SUBVIEW]},o.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.LOGIN_FINAL_DONE:}},o.N="HeroMutiTeamMediator",o.SV={MAIN:1,DETAIL:2},o);function o(e){return void 0===e&&(e=null),t.call(this,o.N,e)||this}e.HeroMutiTeamMediator=i,__reflect(i.prototype,"game.HeroMutiTeamMediator")}(game=game||{}),function(o){var i,e=(i=o.BaseVO,__extends(t,i),t.prototype.update=function(e){if(e){if(e.heroList)for(var t in this.heroList=[],e.heroList){var i=e.heroList[t];this.heroList.push(new o.HeroVO(i))}if(e.heroEquipList)for(var t in this.heroEquipList=[],e.heroEquipList)i=e.heroEquipList[t],this.heroEquipList.push(new o.HeroEquipVO(i));if(e.heroArtifactList)for(var t in this.heroArtifactList=[],e.heroArtifactList)i=e.heroArtifactList[t],this.heroArtifactList.push(new o.HeroArtifactVO(i));if(e.magicalList)for(var t in this.magicalList=[],e.magicalList)i=e.magicalList[t],this.magicalList.push(new o.MagicalVO(i));if(e.immortalList)for(var t in this.immortalList=[],e.immortalList)i=e.immortalList[t],this.immortalList.push(new o.HeroImmortalVO(i));e.pet&&this.pet.update(e.pet),e.magical&&this.magical.update(e.magical),e.teamId&&(this.teamId=e.teamId),e.fightCap&&(this.fightCap=e.fightCap),e.teamName&&(this.teamName=e.teamName)}},t);function t(e){var t=i.call(this)||this;return t.heroList=[],t.heroEquipList=[],t.heroArtifactList=[],t.magicalList=[],t.pet=new o.PetVO,t.magical=new o.MagicalVO,t.teamId=0,t.fightCap=0,t.teamName="",t.update(e),t}o.BattleFormationInfo=e,__reflect(e.prototype,"game.BattleFormationInfo");var n,a=(n=o.BaseVO,__extends(r,n),r.prototype.update=function(e){e&&(e.heroUuid&&(this.heroUuid=e.heroUuid),e.heroEquipUuids&&(this.heroEquipUuids=e.heroEquipUuids),e.pos&&(this.pos=e.pos),e.battlePos&&(this.battlePos=e.battlePos),e.heroArtifactUuid&&(this.heroArtifactUuid=e.heroArtifactUuid),e.magicalUuid&&(this.magicalUuid=e.magicalUuid),e.immortalUuid&&(this.immortalUuid=e.immortalUuid))},r);function r(e){var t=n.call(this)||this;return t.heroUuid="",t.pos=0,t.heroEquipUuids=[],t.heroArtifactUuid="",t.magicalUuid="",t.immortalUuid="",t.update(e),t}o.BattleFormationHeroInfo=a,__reflect(a.prototype,"game.BattleFormationHeroInfo");var s,c=(s=o.BaseVO,__extends(l,s),l.prototype.update=function(e){e&&(e.battleFormationHeroList&&(this.battleFormationHeroList=e.battleFormationHeroList),e.petUuid&&(this.petUuid=e.petUuid),e.magicalUuid&&(this.magicalUuid=e.magicalUuid))},l);function l(e){var t=s.call(this)||this;return t.battleFormationHeroList=[],t.petUuid="",t.magicalUuid="",t.update(e),t}o.BattleFormationTeamInfo=c,__reflect(c.prototype,"game.BattleFormationTeamInfo");var h,p=(h=o.BaseVO,__extends(d,h),d.prototype.update=function(e){e&&(e.moduleId&&(this.moduleId=e.moduleId),e.teamId&&(this.teamId=e.teamId))},d);function d(e){var t=h.call(this)||this;return t.moduleId=0,t.teamId=0,t.update(e),t}o.BattleFormationModuleInfo=p,__reflect(p.prototype,"game.BattleFormationModuleInfo")}(game=game||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this)},o.prototype.updateView=function(e){var t=(this.params=e).list;this.list_list.itemRenderer=a,this.list_list.dataProvider=new eui.ArrayCollection(t)},o);function o(){var e=i.call(this)||this;return e.skinName="HeroSpiritAllAttrPanelSkin",e}t.HeroSpiritAllAttrPanel=e,__reflect(e.prototype,"game.HeroSpiritAllAttrPanel");var n,a=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this)},r.prototype.dataChanged=function(){var e=this.data;this.lb_attr.text=AttrConfig[e[0]].name+"加成：",this.lb_num.text=t.GeneralConfig.getAttrValue(e[1])+""},r);function r(){var e=n.call(this)||this;return e.skinName="HeroSpiritAllAttrItemSkin",e}__reflect(a.prototype,"HeroSpiritAllAttrItem")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.HeroSpiritMainView),this.addSubView(n.SV.UP_STAR_PANEL,i.HeroSpiritUpstarView),this.addSubView(n.SV.UP_INFO_PANEL,i.HeroSpiritUpInfoView),this.addSubView(n.SV.ALL_ATTR_SHOW,i.HeroSpiritAllAttrPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.CONFIG_ALL_LOADED,CN.HERO_SPIRIT_UPDATEMAIN]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.HeroSpirit,!1).allow&&this.proxy.GetHeroSpiritInfo();break;case CN.HERO_SPIRIT_UPDATEMAIN:var t=this.getSubView(n.SV.MAIN);t&&t.updateView();var i=this.getSubView(n.SV.UP_STAR_PANEL);i&&i.updateView();var o=this.getSubView(n.SV.UP_INFO_PANEL);o&&o.updateView()}},n.N="HeroSpiritMediator",n.SV={MAIN:1,UP_STAR_PANEL:2,UP_INFO_PANEL:3,ALL_ATTR_SHOW:4},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.HeroSpiritPy.N),t}i.HeroSpiritMediator=e,__reflect(e.prototype,"game.HeroSpiritMediator")}(game=game||{}),function(e){var t=(i.registerAll=function(){},i);function i(){}e.HeroSpiritProcessor=t,__reflect(t.prototype,"game.HeroSpiritProcessor")}(game=game||{}),function(g){var t,e=(__extends(i,t=BaseProxy),i.prototype.addNotice=function(){NoticeManager.registerCB(NT.HERO_SPIRIT_PAGE,this.checkChaterNotice,this),NoticeManager.registerCB(NT.HERO_SPIRIT_ACHIEVEMENT,this.checkAchievementNotice,this),NoticeManager.setChildType(NT.HERO_SPIRIT,[NT.HERO_SPIRIT_PAGE,NT.HERO_SPIRIT_ACHIEVEMENT])},i.prototype.checkAchievementNotice=function(){return!1},i.prototype.checkChaterNotice=function(){var e=this.getChaterList();for(var t in e)if(e[t])return!0;return!1},i.prototype.getLevelNum=function(e,t){var i=g.Config.heroSpiritConfig(e),o=0;for(var n in i)for(var a in this.HeroSpiritInfo)if(i[n].code==this.HeroSpiritInfo[a].code){o++;break}return o},i.prototype.judgeLock=function(e){var t={needLevel:0,needLevelNum:0,nowLockChapterNum:0,needLockChapterNum:0,lockNum:0},i=JSON.parse(g.Config.heroSpiritConfigByFirst(e.id).condition);if(t.needLevel=i[0],t.needLevelNum=i[1],this.playerproxy.playerInfoVO.level>=i[0]&&t.lockNum++,0!=i[1]){var o=this.getLevelNum(i[1],i[2]);t.nowLockChapterNum=o,t.needLockChapterNum=i[2],o>=i[2]&&t.lockNum++}else t.lockNum++;return t},i.prototype.getChaterList=function(){for(var e=[],t=this.HeroSpiritInfo,i=g.Config.heroSpiritChapterConfig(),o=0;o<i.length;o++){var n=2<=(s=this.judgeLock(i[o])).lockNum;if(o<2)e.push(!1);else if(e.push(!1),!n)break}for(var a=0;a<i.length;a++){var r=i[a].id,s=this.judgeLock(i[a]),c=g.Config.heroSpiritConfigByChapterId(r);for(var o in c){var l=!1;for(var h in t)if(t[h].code==c[o].code){l=!0;break}if(!l){for(var p=JSON.parse(c[o].costs),d=0,u=0;u<p.length;u++)g.GameMVC.backpackPy.getItemNumByCode(p[u][1])>=p[u][2]&&d++;if(d>=p.length&&2<=s.lockNum){e[a]=!0;break}}}}return e},i.prototype.getAllLevelInfo=function(){var e=0;for(var t in this.HeroSpiritInfo)e+=this.HeroSpiritInfo[t].level+1;return e},i.prototype.GetHeroSpiritInfo=function(t){var i=this;Utils.Socket.send("heroSpirit","GetHeroSpiritInfo",{}).then(function(e){i.HeroSpiritInfo=e.info.coreInfo,i.achieveTargeted=e.info.targeted,NoticeManager.updateNotice(NT.HERO_SPIRIT),t&&t()})},i.prototype.ActivateHeroSpirit=function(e,t){var i=this;Utils.Socket.send("heroSpirit","ActivateHeroSpirit",{code:e}).then(function(e){i.HeroSpiritInfo=e.info.coreInfo,i.achieveTargeted=e.info.targeted,g.AppFacade.getInstance().sendNotification(CN.HERO_SPIRIT_UPDATEMAIN),NoticeManager.updateNotice(NT.HERO_SPIRIT),t&&t()})},i.prototype.UpHeroSpiritStar=function(e,t){var i=this;Utils.Socket.send("heroSpirit","UpHeroSpiritStar",{code:e}).then(function(e){i.HeroSpiritInfo=e.info.coreInfo,i.achieveTargeted=e.info.targeted,g.AppFacade.getInstance().sendNotification(CN.HERO_SPIRIT_UPDATEMAIN),NoticeManager.updateNotice(NT.HERO_SPIRIT),t&&t()})},i.prototype.GetHeroSpiritAchievementRewards=function(e,t){var i=this;Utils.Socket.send("heroSpirit","GetHeroSpiritAchievementRewards",{id:e}).then(function(e){i.HeroSpiritInfo=e.info.coreInfo,i.achieveTargeted=e.info.targeted,g.GameMVC.backpackPy.handleClientReward(e.clientReward),NoticeManager.updateNotice(NT.HERO_SPIRIT),t&&t()})},i.N="HeroSpiritPy",i);function i(){var e=t.call(this,i.N)||this;return e.HeroSpiritInfo=void 0,e.playerproxy=g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N),e.addNotice(),e}g.HeroSpiritPy=e,__reflect(e.prototype,"game.HeroSpiritPy")}(game=game||{}),function(r){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.updateView=function(e){e&&(this.params=e);var t=r.Config.heroSpiritUpstarConfig(this.params.code),i=[];for(var o in t)i.push(t[o]);this.list_recommend.itemRenderer=n,this.list_recommend.dataProvider=new eui.ArrayCollection(i)},i);function i(){var e=t.call(this)||this;return e.skinName="HeroSpiritUpInfoView",e}r.HeroSpiritUpInfoView=e,__reflect(e.prototype,"game.HeroSpiritUpInfoView");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this)},a.prototype.dataChanged=function(){this.lb_attr.text=this.data.level+"星属性总加成";var e=!0;for(var t in this.py.HeroSpiritInfo)if(this.data.code==this.py.HeroSpiritInfo[t].code&&this.data.level<=this.py.HeroSpiritInfo[t].level){e=!1;break}this.img_get.visible=e,this.gp_attrs.removeChildren();var i=JSON.parse(this.data.attr);for(var o in i){var n=new eui.Label;n.textAlign="left",n.size=20,n.height=20,n.width=190;var a=[];a.push({text:AttrConfig[i[o][0]].name+"加成：",style:{textColor:e?8285791:16777215}}),a.push({text:r.GeneralConfig.getAttrValue(i[o][1]),style:{textColor:e?8285791:5177088}}),n.textFlow=a,this.gp_attrs.addChild(n)}},a);function a(){var e=o.call(this)||this;return e.py=r.AppFacade.getInstance().retrieveProxy(r.HeroSpiritPy.N),e.skinName="HeroSpiritUpInfoViewItem",e}__reflect(n.prototype,"HeroSpiritUpInfoViewItem")}(game=game||{}),function(l){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()}},i.prototype.updateView=function(e){e&&(this.params=e),this.CommonDaTanChuKuang.blb_title.text="第"+this.params.code+"章";var t,i=l.Config.heroSpiritConfig(this.params.code),o=[],n=[],a=[];for(var r in i){var s={nameConfig:i[r],costConfig:this.judgeIsUp(i[r].code,i[r]),activateDoneCB:this.doneCB.bind(this)},c=this.judgeListNum(s);0==c?o.push(s):1==c?n.push(s):2==c&&a.push(s)}t=o.concat(n,a),this.list_root.itemRenderer=h,this.list_root.dataProvider=new eui.ArrayCollection(t)},i.prototype.judgeListNum=function(e){var t=e.nameConfig,i=t.code;for(var o in this.py.HeroSpiritInfo)if(this.py.HeroSpiritInfo[o].code==i)return 2;for(var n=JSON.parse(t.costs),a=0,r=0;r<n.length;r++)l.GameMVC.backpackPy.getItemNumByCode(n[r][1])>=n[r][2]&&a++;return a>=n.length?0:1},i.prototype.judgeIsUp=function(e,t){var i=-1,o=this.py.HeroSpiritInfo;for(var n in o)o[n].code==e&&(i=o[n].level);if(-1==i)return-1;if(0==i)return 0;var a=l.Config.heroSpiritUpstarConfig(e);for(var n in a)if(a[n].level==i)return a[n]},i.prototype.doneCB=function(){this.gp_effect.removeChildren(),DragonBoneTools.playOnce({effectName:"common_ty_jihuo",parent:this.gp_effect,x:this.gp_effect.width/2,y:this.gp_effect.height/2})},i);function i(){var e=t.call(this)||this;return e.py=l.AppFacade.getInstance().retrieveProxy(l.HeroSpiritPy.N),e.skinName="HeroSpiritUpstarView",e}l.HeroSpiritUpstarView=e,__reflect(e.prototype,"game.HeroSpiritUpstarView");var o,h=(o=eui.ItemRenderer,__extends(n,o),n.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.isEnough?e.isCanUp?e.py.UpHeroSpiritStar(e.data.nameConfig.code):e.py.ActivateHeroSpirit(e.data.nameConfig.code,function(){e.data.activateDoneCB&&e.data.activateDoneCB()}):Utils.MsgUtils.addMidMsg("所需英魂不足")},this)},n.prototype.updateCosts=function(e){var t=0;if(e&&e.level&&(t=e.level),0==t)return JSON.parse(this.data.nameConfig.costs);var i=void 0,o=l.Config.heroSpiritUpstarConfig(this.data.nameConfig.code);for(var n in o)if(o[n].level==t+1){i=o[n];break}return i?JSON.parse(i.costs):void 0},n.prototype.dataChanged=function(){this.lb_title.text=this.data.nameConfig.name;var n=void 0,e=void 0,t=!1;0==this.data.costConfig?(n=JSON.parse(this.data.nameConfig.costs),e=JSON.parse(this.data.nameConfig.attr),t=!0,this.isCanUp=!0):-1==this.data.costConfig?(n=JSON.parse(this.data.nameConfig.costs),e=JSON.parse(this.data.nameConfig.attr),t=!1,this.isCanUp=!1):(n=this.updateCosts(this.data.costConfig),t=!0,this.isCanUp=!0,this.data.costConfig.level==l.Config.heroSpiritUpstarConfig(this.data.nameConfig.code).length&&this.btn_operate&&this.btn_operate.parent&&this.btn_operate.parent.removeChild(this.btn_operate)),this.gp_costs.removeChildren();var a=0;if(n){function i(e){var t=new eui.Group;t.width=t.height=86;var i=customui.BaseItemFactory.create();i.scaleX=i.scaleY=.7,i.horizontalCenter=i.verticalCenter=0,i.updateData({id:n[e][1],num:n[e][2]});var o=l.GameMVC.backpackPy.getItemNumByCode(n[e][1])>=n[e][2];t.addChild(i),r.gp_costs.addChild(t),0==r.data.costConfig?DragonBoneTools.create("common_jiban",function(e){e.x=t.width/2,e.y=t.height/2,e.scaleX=e.scaleY=1.2,e.animation.play(),t.addChild(e)},r):(UIActionManager.setAbsGrey(i,!o),o&&a++)}for(var r=this,o=0;o<n.length;o++)i(o);this.isEnough=a>=n.length}else this.isEnough=!1;this.btn_isGet.visible=0==this.data.costConfig,this.btn_operate.visible=0!=this.data.costConfig,UIActionManager.setAbsGrey(this.gp_attrs,!t),this.btn_operate&&(this.isCanUp?this.btn_operate.label="升星":this.btn_operate.label="激活",UIActionManager.setAbsGrey(this.btn_operate,!this.isEnough)),this.btn_operate.visible?this.img_red.visible=this.isEnough:this.img_red.visible=!1,-1==this.data.costConfig?(e=JSON.parse(this.data.nameConfig.attr),this.updateAttrShow(e)):0==this.data.costConfig?(e=JSON.parse(this.data.nameConfig.attr),this.updateAttrShow(e)):this.updateAttrInfo()},n.prototype.updateAttrInfo=function(){var e=this.py.HeroSpiritInfo,t=[];for(var i in e)if(this.data.nameConfig.code==e[i].code){e[i].level;var o=l.Config.heroSpiritUpstarConfig(e[i].code);for(var n in o)if(o[n].level<=this.data.costConfig.level){var a=JSON.parse(o[n].attr);t.push(a)}}var r=JSON.parse(this.data.nameConfig.attr);t.push(r);var s=[];for(var i in t)s=l.GeneralConfig.superAttrAddAttr(s,t[i]);this.updateAttrShow(s)},n.prototype.updateAttrShow=function(e){for(var t in this.gp_attrs.removeChildren(),e){var i=new eui.Label;i.height=18,i.textAlign="right",i.width=180,i.size=18,i.text=AttrConfig[e[t][0]].name+"加成："+l.GeneralConfig.getAttrValue(e[t][1]),i.textColor=16777215,this.gp_attrs.addChild(i)}},n);function n(){var e=o.call(this)||this;return e.py=l.AppFacade.getInstance().retrieveProxy(l.HeroSpiritPy.N),e.backpackproxy=l.AppFacade.getInstance().retrieveProxy(l.BackpackPy.N),e.isEnough=!1,e.isCanUp=!1,e.skinName="HeroSpiritUpstarViewItem",e}__reflect(h.prototype,"HeroSpiritUpstarViewItem")}(game=game||{}),function(f){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent(),NoticeManager.addNoticeListener(NT.HERO_SPIRIT_ACHIEVEMENT,this.btn_achieve.$children[0],this,BTN_ICON_NOTICE_POS)},i.prototype.updateView=function(e){for(var t=f.Config.heroSpiritChapterConfig(),i=[],o=0,n=0;n<t.length;n++){var a={config:t[n],lockInfo:this.judgeLock(t[n]),indexNum:n},r=2<=a.lockInfo.lockNum;if(r&&o++,n<2)i.push(a);else if(i.push(a),!r)break}this.dataprovider=new eui.ArrayCollection(i),this.list_root.itemRenderer=_,this.list_root.dataProvider=this.dataprovider;var s=this.py.HeroSpiritInfo,c=[],l=[],h=void 0;for(var p in s){var d=s[p].code;for(var n in s[p].level,f.Config.heroSpiritUpstarConfig(d),h=JSON.parse(f.Config.heroSpiritConfigByCode(d).attr))1e5<h[n][1]?c.push(h[n]):l.push(h[n])}this.bm_unlockChapter.text=o+"",this.bm_allPage.text=s.length+"";var u=[];for(var p in c)u=f.GeneralConfig.superAttrAddAttr(u,[c[p]]);var g=[];for(var p in l)g=f.GeneralConfig.superAttrAddAttr(g,[l[p]]);this.gp_attrs.removeChildren(),this.updateAllAttrShow(u),this.updateAllAttrShow(g),this.allAttrList=u.concat(g),this.img_have.visible=!(0<this.allAttrList.length)},i.prototype.updateAllAttrShow=function(e){for(var t in e){var i=new eui.Label;i.size=24,i.textAlign="left",i.width=220,i.height=24;var o=[];o.push({text:AttrConfig[e[t][0]].name+"加成：",style:{textColor:16777215}}),o.push({text:f.GeneralConfig.getAttrValue(e[t][1]),style:{textColor:5177088}}),i.textFlow=o,this.gp_attrs.addChild(i)}this.img_arrow.visible=4<e.length},i.prototype.judgeLock=function(e){var t={needLevel:0,needLevelNum:0,nowLockChapterNum:0,needLockChapterNum:0,lockNum:0},i=JSON.parse(f.Config.heroSpiritConfigByFirst(e.id).condition);if(t.needLevel=i[0],t.needLevelNum=i[1],this.playerproxy.playerInfoVO.level>=i[0]&&t.lockNum++,0!=i[1]){var o=this.getLevelNum(i[1],i[2]);t.nowLockChapterNum=o,t.needLockChapterNum=i[2],o>=i[2]&&t.lockNum++}else t.lockNum++;return t},i.prototype.getLevelNum=function(e,t){var i=f.Config.heroSpiritConfig(e),o=0;for(var n in i)for(var a in this.py.HeroSpiritInfo)if(i[n].code==this.py.HeroSpiritInfo[a].code){o++;break}return o},i.prototype.activateComponent=function(){var t=this;this.img_arrow.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().showSubView(f.HeroSpiritMediator.N,f.HeroSpiritMediator.SV.ALL_ATTR_SHOW,{list:t.allAttrList})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new f.HelpDialog({moduleId:MODULE.HeroSpirit})})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().showSubView(f.RankMediator.N,f.RankMediator.SV.COMMON,{module:"HERO_SPRITE_RANK"})},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.btn_backpack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.GameMVC.backpackMed.showSubView(f.BackpackMediator.SV.BACKPACK_PANEL,{type:f.BackpackUI.ITEM_TYPE.HERO_SPRITE})},this),this.btn_achieve.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().showSubView(f.RankMediator.N,f.RankMediator.SV.COMMON,{module:"HERO_SPRITE_ACHIEVE"})},this),this.btn_master.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.py.HeroSpiritInfo.length;f.AppFacade.getInstance().showSubView(f.HeroMediator.N,f.HeroMediator.SV.COMMON_LEVEL_MASTER,{title:"英魂修炼",config:f.Config.spirteMasterConfig(),totalLevel:e})},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide(),f.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeHeroSpirit,onCloseCB:function(){f.GameMVC.heroSpiritMed.showSubView(f.HeroSpiritMediator.SV.MAIN)}})},this)},i);function i(){var e=t.call(this)||this;return e.backpackproxy=f.AppFacade.getInstance().retrieveProxy(f.BackpackPy.N),e.py=f.AppFacade.getInstance().retrieveProxy(f.HeroSpiritPy.N),e.playerproxy=f.AppFacade.getInstance().retrieveProxy(f.PlayerPy.N),e.initComplete=!1,e.allAttrList=[],e.dataprovider=new eui.ArrayCollection,e.skinName="HeroSpiritMainView",e}f.HeroSpiritMainView=e,__reflect(e.prototype,"game.HeroSpiritMainView");var o,_=(o=eui.ItemRenderer,__extends(n,o),n.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.isLock?f.AppFacade.getInstance().showSubView(f.HeroSpiritMediator.N,f.HeroSpiritMediator.SV.UP_STAR_PANEL,{code:e.data.config.id}):Utils.MsgUtils.addMidMsg("该章节未达到解锁条件")},this)},n.prototype.dataChanged=function(){this.img_bg.source=this.data.config.img+"_png",this.isLock=2<=this.data.lockInfo.lockNum,this.img_lock.visible=!this.isLock,this.lb_condition.visible=!this.isLock,this.gp_hasActivate.visible=this.isLock;var e=JSON.parse(f.Config.heroSpiritConfigByFirst(this.data.config.id).condition),t=[];0!=e[0]&&t.push({text:"等级达到"+e[0]+"级",style:{textColor:this.playerproxy.playerInfoVO.level>=e[0]?8904280:15814479}}),0!=e[1]&&(t.push({text:"\n"}),t.push({text:"第"+e[1]+"章激活"+e[2]+"页",style:{textColor:this.data.lockInfo.nowLockChapterNum>=this.data.lockInfo.needLockChapterNum?8904280:15814479}})),this.lb_condition.textFlow=t;var i=f.Config.heroSpiritConfig(this.data.config.id),o=0,n=this.py.HeroSpiritInfo;for(var a in n)for(var r in i)n[a].code==i[r].code&&o++;o==i.length?(this.bm_cur.font="green_num_fnt",this.bm_max.font="green_num_fnt"):(this.bm_cur.font="white_num_fnt",this.bm_max.font="white_num_fnt"),this.bm_ActivateiPages.text=o+"",this.bm_cur.text=o+"/",this.bm_max.text=i.length+"",this.pb_progress.value=Math.ceil(100*o/i.length);var s=this.py.getChaterList();this.img_red.visible=!1,s&&s[this.data.indexNum]&&(this.img_red.visible=s[this.data.indexNum])},n);function n(){var e=o.call(this)||this;return e.backpackproxy=f.AppFacade.getInstance().retrieveProxy(f.BackpackPy.N),e.playerproxy=f.AppFacade.getInstance().retrieveProxy(f.PlayerPy.N),e.py=f.AppFacade.getInstance().retrieveProxy(f.HeroSpiritPy.N),e.isLock=!1,e.skinName="HeroSpiritItem",e}__reflect(_.prototype,"HeroSpiritItem")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.HeroThingMainView),this.addSubView(n.SV.SELECT,i.HeroThingSelectPanel),this.addSubView(n.SV.TREASURE_PEIYANG,i.HeroTreasurePeiYangView),this.addSubView(n.SV.ARTIFACT_PEIYANG,i.HeroArtifactPeiYangView),this.addSubView(n.SV.ARTIFACT_PEIYANG2,i.HeroArtifactPeiYangView2),this.addSubView(n.SV.ARTIFACT_PEIYANG3,i.HeroArtifactPeiYangView3),this.addSubView(n.SV.ARTIFACT_PEIYANG4,i.HeroArtifactPeiYangView4),this.addSubView(n.SV.ARTIFACT_PEIYANG5,i.HeroArtifactPeiYangView5),this.addSubView(n.SV.ARTIFACT_PEIYANG6,i.HeroArtifactPeiYangView6),this.addSubView(n.SV.SPECIAL_TREASURE,i.TreasureSpecialView),this.addSubView(n.SV.ARTIFACT_INFO,i.HeroArtifactInfoPanel),this.addSubView(n.SV.IMMORTAL_MAIN,i.HeroImmortalMainView),this.addSubView(n.SV.IMMORTAL_UPSECTION,i.HeroImmortalUpsectionPanel),this.addSubView(n.SV.IMMORTAL_BAPTIZE,i.HeroImmortalBaptizePanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.HERO_ARTIFACT_UPDATE,CN.HERO_EQUIP_UPDATE,CN.HERO_DERMA_UPDATE,CN.MONEY_UPDATE]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:this.heroThingPy.GetHeroArtifactInfo(),this.heroThingPy.GetHeroEquipInfo(),this.heroThingPy.GetTreasureInfo(),this.heroThingPy.GetDermaInfo(),Utils.UnlockMgr.checkPass(MODULE.Immortal,!1).allow&&this.heroThingPy.GetImmortalInfo();break;case CN.HERO_EQUIP_UPDATE:case CN.HERO_ARTIFACT_UPDATE:case CN.HERO_DERMA_UPDATE:this.updateView(n.SV.MAIN);break;case CN.MONEY_UPDATE:var t=this.getSubView(n.SV.MAIN);t&&t.updateView()}},n.prototype.showSubView=function(e,t){void 0===t&&(t=void 0),e==n.SV.MAIN&&t&&t.entityType==EEntityType.EEntityTypeImmortal?o.prototype.showSubView.call(this,n.SV.IMMORTAL_MAIN,t):o.prototype.showSubView.call(this,e,t)},n.N="HeroThingMediator",n.SV={MAIN:1,SELECT:2,TREASURE_PEIYANG:3,ARTIFACT_PEIYANG:4,ARTIFACT_PEIYANG2:5,ARTIFACT_PEIYANG3:6,ARTIFACT_PEIYANG4:8,ARTIFACT_PEIYANG5:13,ARTIFACT_PEIYANG6:14,SPECIAL_TREASURE:7,ARTIFACT_INFO:9,IMMORTAL_MAIN:10,IMMORTAL_UPSECTION:11,IMMORTAL_BAPTIZE:12},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.heroThingPy=i.AppFacade.getInstance().retrieveProxy(i.HeroThingPy.N),t}i.HeroThingMediator=e,__reflect(e.prototype,"game.HeroThingMediator")}(game=game||{}),function(i){var e=(t.registerAll=function(){(new u).register(),(new n).register(),(new v).register(),(new h).register(),(new E).register(),(new s).register(),(new _).register()},t);function t(){}i.HeroThingProcessor=e,__reflect(e.prototype,"game.HeroThingProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){var t=e.getBody();this.log("HeroEquipInfoP",t),i.AppFacade.getInstance().retrieveProxy(i.HeroThingPy.N).updateEquipInfo(t.heroEquipList)},a);function a(){return o.call(this,"heroEquip.HeroEquipInfoP",a)||this}i.HeroEquipInfoP=n,__reflect(n.prototype,"game.HeroEquipInfoP");var r,s=(r=i.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody();this.log("HeroEquipListP",t),i.AppFacade.getInstance().retrieveProxy(i.HeroThingPy.N).updateEquipInfo(t.heroEquipList,!1)},c);function c(){return r.call(this,"heroEquip.HeroEquipListP",c)||this}i.HeroEquipListP=s,__reflect(s.prototype,"game.HeroEquipListP");var l,h=(l=i.ProcessorBase,__extends(p,l),p.prototype.execute=function(e){var t=e.getBody();this.log("TreasureInfoP",t),i.AppFacade.getInstance().retrieveProxy(i.HeroThingPy.N).updateTreasureInfo(t.treasureList)},p);function p(){return l.call(this,"treasure.TreasureInfoP",p)||this}i.TreasureInfoP=h,__reflect(h.prototype,"game.TreasureInfoP");var d,u=(d=i.ProcessorBase,__extends(g,d),g.prototype.execute=function(e){var t=e.getBody();this.log("HeroArtifactInfoP",t),i.AppFacade.getInstance().retrieveProxy(i.HeroThingPy.N).updateArtifactInfo(t.heroArtifactList)},g);function g(){return d.call(this,"heroArtifact.HeroArtifactInfoP",g)||this}i.HeroArtifactInfoP=u,__reflect(u.prototype,"game.HeroArtifactInfoP");var f,_=(f=i.ProcessorBase,__extends(m,f),m.prototype.execute=function(e){var t=e.getBody();this.log("HeroArtifactListP",t),i.AppFacade.getInstance().retrieveProxy(i.HeroThingPy.N).updateArtifactInfo(t.heroArtifactList,!1)},m);function m(){return f.call(this,"heroArtifact.HeroArtifactListP",m)||this}i.HeroArtifactListP=_,__reflect(_.prototype,"game.HeroArtifactListP");var y,v=(y=i.ProcessorBase,__extends(T,y),T.prototype.execute=function(e){var t=e.getBody();this.log("ArtifactHistoryListP",t),i.AppFacade.getInstance().retrieveProxy(i.HeroThingPy.N).updateArtiHistoryInfo(t.historyList)},T);function T(){return y.call(this,"heroArtifact.ArtifactHistoryListP",T)||this}i.ArtifactHistoryListP=v,__reflect(v.prototype,"game.ArtifactHistoryListP");var C,E=(C=i.ProcessorBase,__extends(I,C),I.prototype.execute=function(e){var t=e.getBody();this.log("ImmortalListP",t),i.GameMVC.heroThingPy.updateImmortalInfo(t.immortalList,!1)},I);function I(){return C.call(this,"immortal.ImmortalListP",I)||this}i.ImmortalListP=E,__reflect(E.prototype,"game.ImmortalListP")}(game=game||{}),function(u){var t,e=(__extends(i,t=BaseProxy),i.prototype.isArtifactNewOne=function(e){var t=this.AllArtiInfo[e];return!!t&&!!t.isInit},i.prototype.checkDermaNotice=function(e){if(e&&e.info){var t=u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N),i=u.Config.getHeroDermaConfig();for(var o in i)if(e.info.config.subType==i[o].subType){var n=!1;for(var a in this.AllDermaInfo)this.AllDermaInfo[a].code==i[o].code&&(n=!0);if(n)return!1;var r=JSON.parse(i[o].costs);if(t.checkEnough(r,!1))return!0}return!1}},i.prototype.checkEquipCompoundNotice=function(){var e=u.Config.HeroEquipCompound(),t=u.Config.getHeroEquipConfig(),i=u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N),o={};for(var n in this.AllEquipInfo){var a=t[(r=this.AllEquipInfo[n]).code];a&&!r.heroUuid&&(o[a.color]?o[a.color]+=r.num:o[a.color]=r.num)}for(var n in e){var r,s=o[(r=e[n]).color]||0;if(1===r.type&&s>=r.num){var c=JSON.parse(r.costs);if(!(0<c.length))return!0;if(i.checkEnough(c,!1))return!0}}return!1},i.prototype.GetHeroArtifactInfo=function(){var t=this;Utils.Socket.send("heroArtifact","GetHeroArtifactInfo",{}).then(function(e){t.updateArtifactInfo(e.heroArtifactList,!0),t.updateArtiHistoryInfo(e.historyList)})},i.prototype.updateArtifactInfo=function(e,t){var i=this;void 0===t&&(t=!0);var o=!1;e.forEach(function(e){if(i.AllArtiInfo[e.uuid])i.AllArtiInfo[e.uuid].update(e),0==i.AllArtiInfo[e.uuid].num&&delete i.AllArtiInfo[e.uuid];else{var t=new u.HeroArtifactVO(e);i.AllArtiInfo[e.uuid]=t}o=!0}),o&&(u.AppFacade.getInstance().sendNotification(CN.HERO_ARTIFACT_UPDATE),u.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE))},i.prototype.getArtiDifference=function(e){var i=this,o=[];return e.forEach(function(e){var t=new u.HeroArtifactVO(e);i.AllArtiInfo[e.uuid]&&(t.num>i.AllArtiInfo[e.uuid].num?t.num=t.num-i.AllArtiInfo[e.uuid].num:console.log(e,"数量对不上")),o.push(t)}),o},i.prototype.updateArtiHistoryInfo=function(e){var t=this;e.forEach(function(e){t.artiHostory[e.code]=e})},i.prototype.deleteArtifactInfo=function(e){var t=this;e.forEach(function(e){t.AllArtiInfo[e.artifactUuid].reduceByNum(e.num)||delete t.AllArtiInfo[e.artifactUuid]})},i.prototype.getHeroArtifactsByUuid=function(e){var t=[];for(var i in this.AllArtiInfo){var o=this.AllArtiInfo[i];o.heroUuid==e&&t.push(o)}return t},i.prototype.HeroArtifactPutOn=function(e,t,i,o){var n=this;Utils.Socket.send("heroArtifact","HeroArtifactPutOn",{uuid:e,heroUuid:t}).then(function(e){n.updateArtifactInfo(e.heroArtifactList),o&&o()})},i.prototype.HeroArtifactPutDown=function(e,t,i){var o=this;Utils.Socket.send("heroArtifact","HeroArtifactPutDown",{uuid:e,heroUuid:t}).then(function(e){o.updateArtifactInfo(e.heroArtifactList),i&&i()})},i.prototype.HeroArtifactUpGrade=function(e,t,i){var o=this;Utils.Socket.send("heroArtifact","HeroArtifactUpGrade",{uuid:e,uuids:t}).then(function(e){o.updateArtifactInfo(e.heroArtifactList,!1),i&&i(e)})},i.prototype.HeroArtifactUpStar=function(e,t,i){var o=this;Utils.Socket.send("heroArtifact","HeroArtifactUpStar",{uuid:e,uuids:t}).then(function(e){o.updateArtifactInfo(e.heroArtifactList,!1),i&&i()})},i.prototype.getHeroArtifactByHeroUuid=function(e){var t=new Array;for(var i in this.AllArtiInfo){var o=this.AllArtiInfo[i];o.heroUuid==e&&t.push(o)}return t},i.prototype.HeroArtifactBaptize=function(e,t,i){var o=this;Utils.Socket.send("heroArtifact","HeroArtifactBaptize",{uuid:e,num:t}).then(function(e){o.updateArtifactInfo([e.heroArtifact],!1),i&&i()})},i.prototype.HeroArtifactBaptizeReset=function(e,t){var i=this;Utils.Socket.send("heroArtifact","HeroArtifactBaptizeReset",{uuid:e}).then(function(e){i.updateArtifactInfo([e.heroArtifact],!1),t&&t()})},i.prototype.HeroArtifactCompound=function(t){Utils.Socket.send("heroArtifact","HeroArtifactCompound",{id:t.id,uuidInfos:t.uuidInfos,uuid:t.uuid}).then(function(e){u.GameMVC.backpackPy.handleClientReward(e.clientReward),Utils.MsgUtils.addMidMsg("升品成功"),t.cb&&t.cb()})},i.prototype.HeroArtifactNewUpStar=function(t){var i=this;Utils.Socket.send("heroArtifact","HeroArtifactNewUpStar",{uuidInfos:t.uuidInfos,uuid:t.uuid}).then(function(e){u.GameMVC.backpackPy.handleClientReward(e.clientReward),i.updateArtifactInfo(e.heroArtifactList),DragonBoneTools.playOnce({effectName:"common_sxcg",parent:GameRootLayer.gameLayer().popMsgLayer}),t.cb&&t.cb(e)})},i.prototype.HeroArtifactRollback=function(t){var i=this;Utils.Socket.send("heroArtifact","HeroArtifactRollback",{uuid:t.uuid}).then(function(e){u.GameMVC.backpackPy.handleClientReward(e.clientReward),i.updateArtifactInfo(e.heroArtifactList),DragonBoneTools.playOnce({effectName:"common_hycg",parent:GameRootLayer.gameLayer().popMsgLayer,y:.3*Utils.DeviceUtils.curHeight()}),t.cb&&t.cb()})},i.prototype.HeroArtifactRollbackPreview=function(t){Utils.Socket.send("heroArtifact","HeroArtifactRollbackPreview",{uuid:t.uuid}).then(function(e){u.AppFacade.getInstance().showSubView(u.CommonMediator.N,u.CommonMediator.SV.REWARD_PANEL,{title:"奖励",rewards:e.rewardPreview,btnText:"确定",type:u.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN}),t.cb&&t.cb()})},i.prototype.HeroArtifactAddition=function(e,t){var i=this;Utils.Socket.send("heroArtifact","MakeHeroArtifactAddition",{uuid:e}).then(function(e){i.updateArtifactInfo([e.heroArtifact],!1),t&&t()})},i.prototype.HeroArtifactModify=function(e,t,i){var o=this;Utils.Socket.send("heroArtifact","ModifyHeroArtifactAddition",{uuid:e,race:t}).then(function(e){o.updateArtifactInfo([e.heroArtifact],!1),i&&i()})},i.prototype.GetHeroEquipInfo=function(){var t=this;Utils.Socket.send("heroEquip","GetHeroEquipInfo",{}).then(function(e){t.updateEquipInfo(e.heroEquipList,!0)})},i.prototype.getEquipDifference=function(e){var i=this,o=[];return e.forEach(function(e){var t=new u.HeroEquipVO(e);i.AllEquipInfo[e.uuid]&&(t.num>i.AllEquipInfo[e.uuid].num?t.num=t.num-i.AllEquipInfo[e.uuid].num:console.log(e,"数量对不上")),o.push(t)}),o},i.prototype.updateEquipInfo=function(e,t){var i=this;void 0===t&&(t=!0);var o=!1;if(t)for(var n in this.AllEquipInfo)this.AllEquipInfo[n].isExpire=!0;for(var n in e.forEach(function(e){if(i.AllEquipInfo[e.uuid])i.AllEquipInfo[e.uuid].update(e),0==i.AllEquipInfo[e.uuid].num&&(i.AllEquipInfo[e.uuid].isExpire=!0);else{var t=new u.HeroEquipVO(e);i.AllEquipInfo[e.uuid]=t}o=!0}),this.AllEquipInfo)this.AllEquipInfo[n].isExpire&&delete this.AllEquipInfo[n];o&&u.AppFacade.getInstance().sendNotification(CN.HERO_EQUIP_UPDATE),NoticeManager.updateNotice(NT.HERO_THING_COMPOUND)},i.prototype.deleteEquipInfo=function(e){var t=this;e.forEach(function(e){t.AllEquipInfo[e.equipUuid].reduceByNum(e.num)||delete t.AllEquipInfo[e.equipUuid]}),NoticeManager.updateNotice(NT.HERO_THING_COMPOUND)},i.prototype.getHeroEquipsByUuid=function(e){var t=[];for(var i in this.AllEquipInfo){var o=this.AllEquipInfo[i];o.heroUuid==e&&t.push(o)}return t},i.prototype.checkHeroHasEquipByUuid=function(e){for(var t in this.AllEquipInfo)if(this.AllEquipInfo[t].heroUuid==e)return!0},i.prototype.HeroEquipPutOn=function(e,t,i,o){var n=this;Utils.Socket.send("heroEquip","HeroEquipPutOn",{uuid:e,heroUuid:t,type:i}).then(function(e){n.updateEquipInfo(e.heroEquipList,!1),u.GameMVC.heroMed.updateView(u.HeroMediator.SV.MASTER,{}),o&&o()})},i.prototype.HeroEquipPutDown=function(e,t,i){var o=this;Utils.Socket.send("heroEquip","HeroEquipPutDown",{uuid:e,heroUuid:t}).then(function(e){o.updateEquipInfo(e.heroEquipList,!1),u.GameMVC.heroMed.updateView(u.HeroMediator.SV.MASTER,{}),i&&i()})},i.prototype.HeroEquipUpgrade=function(e,t,i){var o=this;void 0===t&&(t=1),Utils.Socket.send("heroEquip","HeroEquipUpGrade",{uuid:e,num:t}).then(function(e){var t=[e.heroEquip];e.newHeroEquip&&t.push(e.newHeroEquip),o.updateEquipInfo(t,!1),u.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE),u.GameMVC.heroMed.updateView(u.HeroMediator.SV.MASTER,{}),i&&i(e)})},i.prototype.HeroEquipEnchant=function(e,t,i){var o=this;void 0===t&&(t=1),Utils.Socket.send("heroEquip","HeroEquipEnchant",{uuid:e,num:t}).then(function(e){var t=[e.heroEquip];e.newHeroEquip&&t.push(e.newHeroEquip),o.updateEquipInfo(t,!1),u.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE),u.GameMVC.heroMed.updateView(u.HeroMediator.SV.MASTER,{}),i&&i(e)})},i.prototype.HeroEquipQuenchce=function(e,t,i){var o=this;void 0===t&&(t=1),Utils.Socket.send("heroEquip","HeroEquipQuenchce",{uuid:e,num:t}).then(function(e){var t=[e.heroEquip];e.newHeroEquip&&t.push(e.newHeroEquip),o.updateEquipInfo(t,!1),u.AppFacade.getInstance().sendNotification(CN.BACKPACK_UPDATE),u.GameMVC.heroMed.updateView(u.HeroMediator.SV.MASTER,{}),i&&i(e)})},i.prototype.HeroEquipCompound=function(t){Utils.Socket.send("heroEquip","HeroEquipCompound",{id:t.id,uuidInfos:t.uuidInfos,compoundType:t.type,code:t.code||0}).then(function(e){t.beforeCB?t.beforeCB(function(){u.GameMVC.backpackPy.handleClientReward(e.clientReward),t.cb&&t.cb()}):(u.GameMVC.backpackPy.handleClientReward(e.clientReward),t.cb&&t.cb())})},i.prototype.HeroEquipImprove=function(t){Utils.Socket.send("heroEquip","ImproveHeroEquip",{costList:t.costList,typ:t.type}).then(function(e){t.beforeCB?t.beforeCB(function(){u.GameMVC.backpackPy.handleClientReward(e.clientReward),t.cb&&t.cb()},e):(u.GameMVC.backpackPy.handleClientReward(e.clientReward),t.cb&&t.cb())})},i.prototype.getHeroEquips=function(e,t){var i=new Array;if(t){var o=!1,n=u.GameMVC.heroMutiTeamPy.battleFormationList;for(var a in n){var r=n[a];for(var s in r.heroList)if(r.heroList[s].originalUuid==e){for(var c in o=!0,r.heroEquipList){var l=r.heroEquipList[c];l.heroUuid==e&&i.push(l)}break}if(o)break}}else for(var h in this.AllEquipInfo){var p=this.AllEquipInfo[h];p.heroUuid==e&&i.push(p)}return i},i.prototype.getHeroSuitCount=function(e,t){var i=0,o=u.Config.getHeroEquipConfig();if(u.GameMVC.heroPy.allHeroByUuid[e]){var n=this.getHeroEquips(e);for(var a in n){var r=n[a];o[r.code]&&t==o[r.code].suitType&&i++}return i}var s=u.GameMVC.heroMutiTeamPy.battleFormationList;for(var a in s){var c=s[a];for(var l in c.heroList)if(c.heroList[l].uuid==e){for(var h in c.heroEquipList){var p=c.heroEquipList[h];o[p.code]&&t==o[p.code].suitType&&i++}return i}}return 0},i.prototype.GetTreasureInfo=function(t){var i=this;Utils.Socket.send("treasure","GetTreasureInfo",{}).then(function(e){i.updateTreasureInfo(e.treasureList,!0),t&&t()})},i.prototype.updateTreasureInfo=function(e,t){var i=this;void 0===t&&(t=!0);var o=!1;if(t)for(var n in this.AllTreasureInfo)this.AllTreasureInfo[n].isExpire=!0;for(var n in e.forEach(function(e){if(i.AllTreasureInfo[e.uuid])i.AllTreasureInfo[e.uuid].update(e);else{var t=new u.HeroTreasureVO(e);i.AllTreasureInfo[e.uuid]=t}o=!0}),this.AllTreasureInfo)this.AllTreasureInfo[n].isExpire&&delete this.AllTreasureInfo[n];o&&u.AppFacade.getInstance().sendNotification(CN.HERO_ARTIFACT_UPDATE)},i.prototype.deleteTreasureInfo=function(e){var t=this;e.forEach(function(e){t.AllTreasureInfo[e.artifactUuid].reduceByNum(e.num)||delete t.AllTreasureInfo[e.artifactUuid]})},i.prototype.getHeroTreasuresByUuid=function(e){var t=[];for(var i in this.AllTreasureInfo){var o=this.AllTreasureInfo[i];o.heroUuid==e&&t.push(o)}return t},i.prototype.TreasurePutOn=function(e,t,i,o){var n=this;Utils.Socket.send("treasure","TreasurePutOn",{uuid:e,heroUuid:t}).then(function(e){n.updateTreasureInfo(e.treasureList,!1),o&&o(e)})},i.prototype.TreasurePutDown=function(e,t,i){var o=this;Utils.Socket.send("treasure","TreasurePutDown",{uuid:e,heroUuid:t}).then(function(e){o.updateTreasureInfo(e.treasureList),i&&i()})},i.prototype.TreasureInlayUpGrade=function(e,t,i){var o=this;Utils.Socket.send("treasure","TreasureInlayUpGrade",{uuid:e,type:t}).then(function(e){o.updateTreasureInfo([e.treasure],!1),i&&i()})},i.prototype.updateImmortalInfo=function(e,t){var i=this;void 0===t&&(t=!0);var o=!1;e.forEach(function(e){if(e.num)if(i.AllImmortalInfo[e.uuid])i.AllImmortalInfo[e.uuid].update(e);else{var t=new u.HeroImmortalVO(e);i.AllImmortalInfo[e.uuid]=t}else i.AllImmortalInfo[e.uuid]&&delete i.AllImmortalInfo[e.uuid];o=!0}),o&&u.AppFacade.getInstance().sendNotification(CN.HERO_IMMORTAL_UPDATE)},i.prototype.getImmortalDifference=function(e){var i=this,o=[];return e.forEach(function(e){var t=new u.HeroImmortalVO(e);i.AllImmortalInfo[e.uuid]&&(t.num>i.AllImmortalInfo[e.uuid].num?t.num=t.num-i.AllImmortalInfo[e.uuid].num:console.log(e,"数量对不上")),o.push(t)}),o},i.prototype.deleteImmortalByUuid=function(e,t){if(this.AllImmortalInfo[e]){var i=this.AllImmortalInfo[e];null!=t?i.num-=1:i.num=0,i.num<=0&&delete this.AllImmortalInfo[e]}},i.prototype.deleteImmortal=function(e){var i=this;e.forEach(function(e){var t=i.AllImmortalInfo[e.uuid];t&&(t.num-=e.num,t.num<=0&&delete i.AllImmortalInfo[e.uuid])})},i.prototype.getImmortalNum=function(e,t,i){void 0===i&&(i=!1);var o=0;for(var n in this.AllImmortalInfo){var a=this.AllImmortalInfo[n];i&&""!=a.heroUuid||a.code!=e||t&&a.sectionLevel!=t||(o+=a.num)}return o},i.prototype.getSlotUnlockNum=function(e,t){var i=[],o=u.Config.immortalUpsectionCosts(e,t),n=JSON.parse(o.haloUnlock);if(1==n.length)i.push(n[0][1]);else if(1<n.length){var a=1/0,r=-1/0;n.forEach(function(e){a=Math.min(a,e[1]),r=Math.max(r,e[1])}),i.push(a,r)}else i.push(0);return i},i.prototype.getMaxSlotNum=function(e,t){for(var i=0,o=1;o<=t;o++){var n=this.getSlotUnlockNum(e,o);i+=n[1]||n[0]}return i},i.prototype.isAwesomeImmortal=function(e){return 1<e.sectionLevel&&e.slotNum==this.getMaxSlotNum(e.code,e.sectionLevel)},i.prototype.getHeroImmortalByUuid=function(e){var t=[];for(var i in this.AllImmortalInfo){var o=this.AllImmortalInfo[i];o.heroUuid==e&&t.push(o)}return t},i.prototype.GetImmortalInfo=function(t){var i=this;Utils.Socket.send("immortal","GetImmortalInfo",{}).then(function(e){i.updateImmortalInfo(e.immortalList,!0),t&&t()})},i.prototype.PutImmortalOn=function(e,t){var i=this;Utils.Socket.send("immortal","PutImmortalOn",{uuid:e.uuid,heroUuid:e.heroUuid}).then(function(e){i.updateImmortalInfo(e.immortalList,!1),t&&t()})},i.prototype.PutImmortalDown=function(e,t){var i=this;Utils.Socket.send("immortal","PutImmortalDown",{uuid:e.uuid,heroUuid:e.heroUuid}).then(function(e){i.updateImmortalInfo(e.immortalList,!1),t&&t()})},i.prototype.UpImmortalSection=function(e,t){var i=this;Utils.Socket.send("immortal","UpImmortalSection",{uuid:e.uuid,uuids:e.uuids}).then(function(e){i.updateImmortalInfo(e.immortalList,!1),DragonBoneTools.playOnce({effectName:"common_ty_jinjie",parent:GameRootLayer.gameLayer().popMsgLayer}),t&&t(e)})},i.prototype.BaptizeImmortal=function(t,i){var o=this;Utils.Socket.send("immortal","BaptizeImmortal",{uuid:t.uuid}).then(function(e){o.updateImmortalInfo(e.immortalList,!1),o.ConfirmBaptizeImmortal({uuid:t.uuid,isSure:!0},function(){i&&i()})})},i.prototype.BaptizeImmortalVTwo=function(e,t){var i=this;Utils.Socket.send("immortal","BaptizeImmortalVTwo",{uuid:e.uuid,baptizeInfoList:e.infoList}).then(function(e){i.updateImmortalInfo(e.immortalList,!1),t&&t()})},i.prototype.ConfirmBaptizeImmortal=function(e,t){var i=this;Utils.Socket.send("immortal","ConfirmBaptizeImmortal",{uuid:e.uuid,isSure:e.isSure}).then(function(e){i.updateImmortalInfo(e.immortalList,!1),t&&t()})},i.prototype.LockBaptizeImmortal=function(e,t){var i=this;Utils.Socket.send("immortal","LockBaptizeImmortal",{uuid:e.uuid,id:e.id}).then(function(e){i.updateImmortalInfo([e.immortal],!1),t&&t()})},i.prototype.GetDermaInfo=function(t){var i=this;Utils.Socket.send("heroDerma","GetHeroDermaInfo",{}).then(function(e){i.updateDermaInfo(e.dermaList,!1),i.updateDermaHistoryInfo(e.historyList),t&&t()})},i.prototype.updateDermaHistoryInfo=function(e){var t=this;e.forEach(function(e){t.dermaiHostory[e.code]=e})},i.prototype.updateDermaInfo=function(e,t){var i=this;e.forEach(function(e){if(i.AllDermaInfo[e.uuid])i.AllDermaInfo[e.uuid].update(e);else{var t=new u.HeroDermaVO(e);i.AllDermaInfo[e.uuid]=t}}),t&&u.AppFacade.getInstance().sendNotification(CN.HERO_DERMA_UPDATE)},i.prototype.HeroDermaActivate=function(e,t,i){var o=this;Utils.Socket.send("heroDerma","HeroDermaActivate",{code:e}).then(function(e){o.GetDermaInfo(t),i&&i()})},i.prototype.HeroDermaPutOn=function(t,i,o,n){var a=this;Utils.Socket.send("heroDerma","HeroDermaPutOn",{uuid:t,heroUuid:i}).then(function(e){o&&o(),u.GameMVC.heroPy.allHeroByUuid[i].dermaCode=a.AllDermaInfo[t].code,a.updateDermaInfo(e.dermaList,!0),n&&n(e)})},i.prototype.HeroDermaPutDown=function(e,t,i,o){var n=this;Utils.Socket.send("heroDerma","HeroDermaPutDown",{uuid:e,heroUuid:t}).then(function(e){i&&i(),u.GameMVC.heroPy.allHeroByUuid[t].dermaCode=0,n.updateDermaInfo(e.dermaList,!0),o&&o()})},i.prototype.HeroDermaUpGrade=function(e,t){Utils.Socket.send("heroDerma","HeroDermaUpGrade",{uuid:e}).then(function(e){t&&t()})},i.prototype.HeroDermaUpStar=function(e,t){Utils.Socket.send("heroDerma","HeroDermaUpStar",{uuid:e}).then(function(e){t&&t()})},i.prototype.getMasterLevel=function(e,t,i,o){void 0===i&&(i=!1);var n=this.getHeroEquips(e,o);if(n.length<4)return 0;var a=0,r=u.Config.getHeroEquipMasterConfig(t),s=9999999999,c=u.Config.getHeroEquipConfig(),l=void 0;if(t==HeroEquipMasterType.Quenchce&&i)for(var h in n){if(!(c[(d=n[h]).code]&&0<c[d.code].professionSuit))return 0;if(null==l)l=c[d.code].professionSuit;else if(l!=c[d.code].professionSuit)return 0}var p="level";switch(t){case HeroEquipMasterType.Upgrade:p="level";break;case HeroEquipMasterType.Enchant:p="attachLevel";break;case HeroEquipMasterType.Quenchce:p="quenchceLevel"}for(var h in n)(d=n[h])[p]<s&&(s=d[p]);for(var h in r){var d;if(!(s>=(d=r[h]).level))break;a=d.showLevel}return a},i.N="HeroThingPy",i);function i(){var e=t.call(this,i.N)||this;return e.AllArtiInfo={},e.AllEquipInfo={},e.AllTreasureInfo={},e.AllImmortalInfo={},e.AllDermaInfo={},e.artiHostory={},e.dermaiHostory={},NoticeManager.registerCB(NT.HERO_THING_COMPOUND,e.checkEquipCompoundNotice,e,MODULE.Smithy),NoticeManager.setChildType(NT.SMITHY_ENTRANCE,NT.HERO_THING_COMPOUND),NoticeManager.registerCB(NT.HERO_DERMA,e.checkDermaNotice,e),e}u.HeroThingPy=e,__reflect(e.prototype,"game.HeroThingPy")}(game=game||{}),function(s){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.updateView=function(e){var n=this,t=e.code,a=s.Config.getHeroArtifactConfig()[t],r=0;if(e.vo&&e.vo.additionRace){var i=s.Config.heroArtifactAdditon()[a.subType];i&&(r=i.baseImprove)}s.Config.getHeroArtifactConfig(a.subType).forEach(function(e,t){if(e.sectionLevel){var i=s.GeneralConfig.AttrMutilAttr(JSON.parse(e.sectionAttr),1+r/1e3),o=new c({title:Utils.MathUtils.formatNumToCharacter(e.sectionLevel)+"星",attrs:i,skillCode:e.sectionSkill,activated:a.sectionLevel>=e.sectionLevel});o.width=420,n.gp_items.addChild(o)}}),this.gp_items.$children.forEach(function(e,t){if(0!=t){var i=new eui.Image("common_img_fengexian_02_png");i.width=420,i.horizontalCenter=0,i.top=-20,e.addChild(i)}})},i);function i(){var e=t.call(this)||this;return e.skinName="HeroArtifactInfoSkin",e}s.HeroArtifactInfoPanel=e,__reflect(e.prototype,"game.HeroArtifactInfoPanel");var o,c=(o=eui.Component,__extends(n,o),n.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.data&&this.update(this.data),this.btn_op.visible=!1,this.lb_activated.visible=!0},n.prototype.update=function(e){this.data=e;var t=this.data.title,i=this.data.attrs,o=[];o.push({text:t,style:HEROTHING_ATTR_STYLE[0]}),i.forEach(function(e,t){o.push({text:"\n    +"+s.GeneralConfig.getAttrValue(e[1])+AttrConfig[e[0]].name,style:HEROTHING_ATTR_STYLE[1]})}),this.lb_attr.textFlow=o;var n=this.data.skillCode;if(n){this.skillItem.updateItem({code:n});var a=s.Config.skillBaseConfig()[n];this.lb_skillName.text=a.name,this.lb_skillDesc.text=a.desc}else this.gp_main.removeChild(this.gp_skill);var r=this.data.activated;this.lb_activated.text=r?"已激活":"未激活",r||(this.lb_activated.text="未激活",this.lb_activated.textColor=HEROTHING_ATTR_STYLE[1].textColor,UIActionManager.setGrey(this.gp_main))},n);function n(e){var t=o.call(this)||this;return t.skinName="HeroThingUICompoent_HeroThingArtifactUpSection",t.data=e,t}__reflect(c.prototype,"HeroArtifactInfoPanel_ListItem")}(game=game||{}),function(M){var i,e=(__extends(t,i=BasePanel),t.prototype.switchAutoBtn=function(e){this.btn_auto.label=void 0===e?"全选"==this.btn_auto.label?"取消全选":"全选":e?"全选":"取消全选"},t.prototype.jumpToPage=function(e){var i=this;this.curPage=e<0?Math.max(this.curPage+=e,0):Math.min(this.curPage+=e,this.curMaxPage),0==this.curPage?this.img_arrow_left.visible=!1:this.img_arrow_left.visible=!0,this.curPage==this.curMaxPage?this.img_arrow_right.visible=!1:this.img_arrow_right.visible=!0,this.itemObjs.forEach(function(e,t){i.dataList[t+i.curPage*i.countPerPage]?e.update(i.dataList[t+i.curPage*i.countPerPage]):e.update()})},t.prototype.autoSelect=function(e){var t=this.heroThingProxy.AllArtiInfo;if(e){var i=Number(M.Config.constConfig().ArtifactColorFilter.constValue),o=[],n=M.Config.getHeroArtifactConfig(),a=n[this.vo.code];for(var r in o=1==this.curMode?[0,Math.min(a.color,EColorType.EColorTypePurple)]:[i,10],t){var s=n[(c=t[r]).code];""==c.heroUuid&&!c.isLocked&&(1<c.num||c.uuid!=this.vo.uuid)&&o[0]<=s.color&&s.color<=o[1]&&(1==s.type||s.type==this.curMode+1)&&(c.selected=e)}}else for(var r in t){var c;(c=t[r]).selected=!1}this.selectedChange(),this.jumpToPage(0)},t.prototype.childrenCreated=function(){var l=this;i.prototype.childrenCreated.call(this),this.autoSelect(!1),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.pb_root.labelDisplay.visible=!1,this.btn_auto.label="全选",this.btn_auto.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"全选"==l.btn_auto.label?(l.autoSelect(!0),l.switchAutoBtn()):"取消全选"==l.btn_auto.label&&l.autoSelect(!1)},this),this.btn_oper.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(l.curExp<l.pb_root.maximum)return 1==l.curMode?void Utils.MsgUtils.addMidMsg("你所填入的下一级经验不足"):void Utils.MsgUtils.addMidMsg("你所填入的下一阶经验不足");var t=[],e=l.heroThingProxy.AllArtiInfo,i=M.Config.getHeroArtifactConfig(),o=i[l.vo.code].color,n=!1,a=!1;for(var r in e){var s=e[r];s.selected&&(t.push(s.uuid),s.code,(i[s.code].color>o||4<i[s.code].color)&&(n=!0),i[s.code].color==o&&4<i[s.code].color&&(a=!0))}if(0<t.length){function c(e){DragonBoneTools.playOnce({effectName:"common_ty_dj",parent:l,x:l.width/2,y:l.height/2}),e.newHeroArtifact&&(l.vo=l.heroThingProxy.AllArtiInfo[e.newHeroArtifact.uuid]),l.updateView()}1==l.curMode?a?M.GameMgr.getInstance().showCommonTipsWin({commonTips:"所选圣物中含有高级的圣物，\n是否消耗该圣物？",clickCB:function(e){1==e.type&&l.heroThingProxy.HeroArtifactUpGrade(l.vo.uuid,t,c)}}):l.heroThingProxy.HeroArtifactUpGrade(l.vo.uuid,t,c):n?M.GameMgr.getInstance().showCommonTipsWin({commonTips:"所选圣物中含有高级的圣物，\n是否消耗该圣物？",clickCB:function(e){1==e.type&&l.heroThingProxy.HeroArtifactUpStar(l.vo.uuid,t,c)}}):l.heroThingProxy.HeroArtifactUpStar(l.vo.uuid,t,c)}else Utils.MsgUtils.addMidMsg("请先选择")},this),this.img_arrow_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.jumpToPage(-1)},this),this.img_arrow_right.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){l.jumpToPage(1)},this);for(var e=0;e<this.countPerPage;e++){var t=new n;this.gp_items.addChild(t),this.itemObjs.push(t)}},t.prototype.updateView=function(e){var i=this;e&&(this.vo=e.vo),e&&e.mode&&(this.curMode=e.mode),this.dataList.splice(0);var t=Number(M.Config.constConfig().ArtifactColorFilter.constValue),o=this.heroThingProxy.AllArtiInfo,n=[],a=M.Config.getHeroArtifactConfig(),r=a[this.vo.code];for(var s in 1==this.curMode?(n=[0,Math.min(r.color,EColorType.EColorTypePurple)],this.key="exp",this.key2="level"):(n=[t,10],this.key="advanceExp",this.key2="level2"),o){var c=o[s],l=a[c.code];""==c.heroUuid&&(c.uuid!=this.vo.uuid||1<c.num)&&n[0]<=l.color&&l.color<=n[1]&&(1==l.type||l.type==this.curMode+1)&&0==l.sectionLevel&&this.dataList.push({vo:c,c:l,self:c.uuid===this.vo.uuid,selectedChange:function(){i.selectedChange()}})}this.dataList.sort(function(e,t){if(e.vo.isLocked!=t.vo.isLocked)return e.vo.isLocked?1:-1;if(e.c.type!=t.c.type)return e.c.type==i.curMode+1?-1:t.c.type==i.curMode+1?1:e.c.type-t.c.type;if(e.c.color!=t.c.color)return e.c.color-t.c.color;if(1==i.curMode){if(e.vo.level!=t.vo.level)return e.vo.level-t.vo.level}else if(e.vo.level2!=t.vo.level2)return e.vo.level2-t.vo.level2;return e.vo.num-t.vo.num}),this.itemObjs.forEach(function(e,t){i.dataList[t]?e.update(i.dataList[t]):e.update()}),this.curMaxPage=Math.ceil(this.dataList.length/this.countPerPage)-1,0<this.curMaxPage&&(this.img_arrow_right.visible=!0),this.baseitemOriginal.updateData({uuid:this.vo.uuid,code:this.vo.code,type:this.vo.entityType});var h="";if(this.vo.additionRace&&(A=M.Config.heroArtifactAdditon()[r.subType])){for(var p=this.vo.additionRace,d=JSON.parse(A.skillList),u=0,g=0;g<d.length;g++)if(d[g][0]==p){u=d[g][1];break}if(u){var f=M.Config.skillBaseConfig()[u];f&&(h=f.name+"·")}}if(this.lb_nameOriginal.text=h+r.name,h){var _=JSON.parse(M.Config.constConfig().HeroArtifactAdditionShow.constValue);this.lb_nameOriginal.textColor=_[0]}else this.lb_nameOriginal.textColor=M.GeneralConfig.getColorByColor(r.color);this.baseitemTarget.updateData({uuid:this.vo.uuid,code:this.vo.code,type:this.vo.entityType}),this.lb_nameTarget.text=h+r.name;var m=[],y=[],v=[],T=[];if(1==this.curMode){this.btn_oper.label="升级",this.lb_prefix.text="升级属性";var C=void 0,E=M.Config.getHeroArtifactUpgradeConfig(this.vo.code,this.vo.level||0);this.vo.level?(C=M.Config.getHeroArtifactUpgradeConfig(this.vo.code,this.vo.level||0))&&(m=JSON.parse(C.attr)):(C=M.Config.getHeroArtifactConfig()[this.vo.code])&&(m=JSON.parse(C.baseAttr));var I=M.Config.getHeroArtifactUpgradeConfig(this.vo.code,this.vo.level+1);E&&(this.pb_root.maximum=E.exp),I?(y=JSON.parse(I.attr),this.baseitemTarget.decorateLevel(this.vo.level+1)):(this.baseitemTarget.visible=!1,this.lb_nameTarget.visible=!1,this.img_right_max.visible=!0,this.pb_root.value=this.pb_root.maximum,this.img_arrowAttr.visible=!1)}else if(2==this.curMode){this.btn_oper.label="进阶",this.lb_prefix.text="进阶属性";var b=M.Config.getHeroArtifactUpstarConfig(this.vo.code,this.vo.level2);I=M.Config.getHeroArtifactUpstarConfig(this.vo.code,this.vo.level2+1),b&&(m=JSON.parse(b.attr),this.pb_root.maximum=b.exp),I?(y=JSON.parse(I.attr),this.baseitemTarget.decorateStar(this.vo.level2+1)):(this.baseitemTarget.visible=!1,this.lb_nameTarget.visible=!1,this.img_right_max.visible=!0,RES.getResAsync("shenqi_txt_yimanjie_png",function(e){i.img_right_max.source},this),this.img_arrowAttr.visible=!1,this.pb_root.value=this.pb_root.maximum)}if(this.vo.additionRace){var A,P=M.Config.getHeroArtifactConfig()[this.vo.code];(A=M.Config.heroArtifactAdditon()[P.subType])&&(m=M.GeneralConfig.AttrMutilAttr(m,1+A.baseImprove/1e3),y=M.GeneralConfig.AttrMutilAttr(y,1+A.baseImprove/1e3))}m.forEach(function(e){e[2]?v.push({text:"+"+M.GeneralConfig.getAttrValue(e[1])+" 对"+ProfessionConfig[e[3]].name+M.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]}):v.push({text:"+"+M.GeneralConfig.getAttrValue(e[1])+" "+M.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]})}),this.lb_BasicAttr.textFlow=v,y.forEach(function(e){e[2]?T.push({text:"+"+M.GeneralConfig.getAttrValue(e[1])+" 对"+ProfessionConfig[e[3]].name+M.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]}):T.push({text:"+"+M.GeneralConfig.getAttrValue(e[1])+" "+M.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]})}),this.lb_NextAttr.textFlow=T,this.labelDisplay.text="0/"+this.pb_root.maximum,this.selectedChange()},t.prototype.addLeveExp=function(e,t,i){M.Config.getHeroArtifactConfig()[e];var o=0;if(0<t){for(var n=0;n<t;n++)"exp"==this.key?o+=M.Config.getHeroArtifactUpgradeConfig(e,n).exp:o+=M.Config.getHeroArtifactUpstarConfig(e,n).exp;o+=i}else this.key,o+=i;return o},t.prototype.selectedChange=function(){var t=this;this.curExp=0,this.dataList.forEach(function(e){e.vo.selected&&(t.curExp+=t.addLeveExp(e.vo.code,e.vo[t.key2],e.c[t.key])*(e.self?e.vo.num-1:e.vo.num))}),this.curExp=Math.max(0,this.curExp),this.pb_root.value=this.curExp,0==this.pb_root.value&&this.switchAutoBtn(!0),this.labelDisplay.text=this.curExp+"/"+this.pb_root.maximum},t.prototype.onDestroy=function(){},t);function t(){var e=i.call(this)||this;return e.curExp=0,e.countPerPage=10,e.curPage=0,e.curMaxPage=0,e.skinName="HeroArtifactPeiYangViewSkin",e.heroThingProxy=M.AppFacade.getInstance().retrieveProxy(M.HeroThingPy.N),e.itemObjs=new Array,e.dataList=new Array,e}M.HeroArtifactPeiYangView=e,__reflect(e.prototype,"game.HeroArtifactPeiYangView");var o,n=(o=eui.Component,__extends(a,o),a.prototype.childrenCreated=function(){var e=this;this.scaleX=this.scaleY=.7,this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseItem.addChild(this.baseItem),Utils.ComponentUtils.registerListener(this,egret.TouchEvent.TOUCH_TAP,function(){e.vo&&(e.vo.isLocked?Utils.MsgUtils.addMidMsg("该圣物已上锁"):(e.vo.selected=!e.vo.selected,e.updateSelected(),e.selectedChange&&e.selectedChange()))},this)},a.prototype.update=function(e){this.vo=void 0,e&&(this.vo=e.vo,this.c=e.c,this.selectedChange=e.selectedChange,this.self=e.self),this.vo?(this.gp_empty.visible=!1,this.gp_notEmpty.visible=!0,this.baseItem.updateData({uuid:this.vo.uuid,code:this.vo.code,type:this.vo.entityType,num:this.self?this.vo.num-1:this.vo.num}),this.updateLocked(),this.updateSelected()):(this.gp_empty.visible=!0,this.gp_notEmpty.visible=!1)},a.prototype.updateSelected=function(){this.gp_selected.visible=this.vo.selected,UIActionManager.setGrey(this.gp_baseItem,this.vo.selected||this.vo.isLocked)},a.prototype.updateLocked=function(){this.gp_lock.visible=this.vo.isLocked},a);function a(){var e=o.call(this)||this;return e.skinName="HeroArtifactPeiYangView_Item",e}__reflect(n.prototype,"HeroArtifactPeiYangView_Item")}(game=game||{}),function(v){var o,e=(__extends(t,o=BasePanel),t.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cu_resBar),this.activateComponent();var e=JSON.parse(v.Config.constConfig().HeroArtifactBaptizeActivateCosts.constValue);this.CommonIconWithNum.updateItem({cost:e[0],style:CommonIconStyle.RIGHT,needShowHave:!1}),e=JSON.parse(v.Config.constConfig().HeroArtifactBaptizeCosts.constValue),this.CommonIconWithNum1.updateItem({cost:e[0],style:CommonIconStyle.RIGHT,needShowHave:!1}),this.CommonIconWithNum1.blb_num.scaleX=this.CommonIconWithNum1.blb_num.scaleY=1.5;for(var t=0;t<5;t++){var i=this["pb_"+t];i&&(i.slideDuration=0)}},t.prototype.updateView=function(e){if(e&&(this.vo=e.vo),this.vo){this.baseitemOriginal.updateData({vo:this.vo});var t=this.vo.code,i=this.vo.config,o="";if(this.vo.additionRace){var n=v.Config.heroArtifactAdditon()[i.subType];if(n){for(var a=this.vo.additionRace,r=JSON.parse(n.skillList),s=0,c=0;c<r.length;c++)if(r[c][0]==a){s=r[c][1];break}if(s){var l=v.Config.skillBaseConfig()[s];l&&(o=l.name+"·")}}}if(this.lb_nameOriginal.text=o+i.name,o){var h=JSON.parse(v.Config.constConfig().HeroArtifactAdditionShow.constValue);this.lb_nameOriginal.textColor=h[0]}else this.lb_nameOriginal.textColor=v.GeneralConfig.getColorByColor(i.color);var p=JSON.parse(v.Config.constConfig().HeroArtifactBaptizeCosts.constValue);if(this.cu_resBar.updateBar({costs:[p[0][1]],width:190,needAdd:!0}),i){var d=JSON.parse(this.vo.baptizeAttr),u=[];for(var g in d){var f=d[g];1e4<parseInt(g)?u.push([parseInt(g)%1e4,f]):u.push([g,f])}if(0==u.length)this.gp_empty.visible=!0,this.btn_activate.visible=!0,this.gp_1.visible=!1,this.gp_attrs.visible=!1,this.btn_reset.visible=!1,this.gp_activateCost.visible=!0;else{for(this.gp_empty.visible=!1,this.btn_activate.visible=!1,this.gp_1.visible=!0,this.gp_attrs.visible=!0,this.btn_reset.visible=!0,this.gp_activateCost.visible=!1,c=0;c<5;c++)this["gp_shuxing"+c].visible=!1,this["lb_unlock"+c].visible=!0,this["lb_unlock"+c].text="圣物"+JSON.parse(i.baptizeUnlock)[c]+"级开启新的洗炼条目";for(var g in u)f=u[g],this.updatePbs(f[0],f[1],g,this.vo.code)}}else Utils.MsgUtils.addMidMsg("找不到神器"+t+"配置")}},t.prototype.updatePbs=function(e,t,i,o){var n=this["lb_attrName"+i],a=this["labelDisplay"+i],r=this["pb_"+i],s=this["gp_shuxing"+i],c=this["lb_unlock"+i];if(s.visible=!0,c.visible=!1,n&&r){var l=v.Config.getHeroArtifactBaptizeConfig(),h=0;for(var p in v.GeneralConfig.getAttrValue(t),l){var d=l[p];if(d.attrType==e){var u=JSON.parse(d.attr);(1e5<=u[0][1]&&1e5<=t||u[0][1]<1e5&&t<1e5)&&(h=parseInt(v.GeneralConfig.getAttrValue(d.maxValue*u[0][1]*10)),d.color)}}a.text="+"+v.GeneralConfig.getAttrValue(t),t=parseInt(v.GeneralConfig.getAttrValue(10*t));var g=r.value;if(n.text=v.GeneralConfig.getAttrName(e),r.value=0,r.maximum=h,r.value=t,0<=g&&r.value>g){DragonBoneTools.playOnce({effectName:"common_zdjindutiaolg",scaleX:1.3,parent:r});var f=new eui.Label;f.textColor=5699335,f.size=19,f.text="+"+(r.value-g)/10,f.x=r.parent.width-46,f.y=r.parent.height/2-25,f.alpha=1,egret.Tween.get(f).to({alpha:1,y:r.parent.height/2-40},300).wait(500).to({alpha:0,y:r.parent.height/2-53},100).call(function(){r.parent.removeChild(f)},this),r.parent.addChildAt(f,3)}r.labelDisplay.visible=!1}},t.prototype.activateComponent=function(){var t=this;this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.btn_reset.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.vo)if(t.vo.newBaptizeAttr&&"{}"!=t.vo.newBaptizeAttr)PopUpManager.addPopUp({obj:new n({uuid:t.vo.uuid})});else{var e=JSON.parse(v.Config.constConfig().HeroArtifactBaptizeResetCosts.constValue);v.GameMgr.getInstance().showCommonTipsWin({costTips:"重置洗炼属性",cost:e,clickCB:function(e){e.type&&t.heroThingProxy.HeroArtifactBaptizeReset(t.vo.uuid,function(){PopUpManager.addPopUp({obj:new n({uuid:t.vo.uuid})})})}})}},this),this.btn_baptize1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.vo.newBaptizeAttr&&"{}"!=t.vo.newBaptizeAttr?Utils.MsgUtils.addMidMsg("请先确认重铸属性"):t.heroThingProxy.HeroArtifactBaptize(t.vo.uuid,1,function(){t.playEffrctAndUpdateView("common_ty_xilian")})},this),this.btn_activate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.heroThingProxy.HeroArtifactBaptize(t.vo.uuid,1,function(){t.playEffrctAndUpdateView("common_ty_jihuo")})},this)},t.prototype.playEffrctAndUpdateView=function(e){DragonBoneTools.playUniqueEffect({effectName:e,x:this.width/2,y:this.height/2-300,parent:this}),this.updateView()},t.prototype.onDestroy=function(){},t);function t(){var e=o.call(this)||this;return e.skinName="HeroArtifactPeiYangViewSkin2",e.heroThingProxy=v.AppFacade.getInstance().retrieveProxy(v.HeroThingPy.N),e}v.HeroArtifactPeiYangView2=e,__reflect(e.prototype,"game.HeroArtifactPeiYangView2");var i,n=(__extends(a,i=BasePanel),a.prototype.childrenCreated=function(){var i=this;this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.Socket.send("heroArtifact","MakeSureBaptizeReset",{uuid:i.params.uuid,isSure:!1}).then(function(e){v.GameMVC.heroThingPy.updateArtifactInfo([e.heroArtifact],!1),v.GameMVC.heroThingMed.updateView(v.HeroThingMediator.SV.ARTIFACT_PEIYANG2),i.hide()})},this),this.btn_comfirm.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.Socket.send("heroArtifact","MakeSureBaptizeReset",{uuid:i.params.uuid,isSure:!0}).then(function(e){v.GameMVC.heroThingPy.updateArtifactInfo([e.heroArtifact],!1);var t=v.GameMVC.heroThingMed.getSubView(v.HeroThingMediator.SV.ARTIFACT_PEIYANG2);t&&t.playEffrctAndUpdateView("common_ty_czcg"),i.hide()})},this),this.updateView()},a.prototype.updateView=function(){var t=this,e=this.params&&this.params.uuid;if(e){var i=v.GameMVC.heroThingPy.AllArtiInfo[e],o=i.code,n=v.Config.getHeroArtifactConfig()[o];if(n){this.baseitemOriginal.updateData({uuid:e,type:EEntityType.EEntityTypeHeroArtifact}),this.lb_nameOriginal.text=n.name;var a=JSON.parse(i.baptizeAttr),r=JSON.parse(i.newBaptizeAttr);this.gp_attrOld.$children.forEach(function(e){e.text="新属性未解锁",e.textColor=14076875}),this.gp_attrNew.$children.forEach(function(e){e.text="新属性未解锁",e.visible=!1,e.textColor=14076875});var s={},c=v.Config.getHeroArtifactBaptizeConfig();for(var l in c){var h=c[l],p=JSON.parse(h.attr)[0];1e5<=p[1]?s[1e5*p[0]]=p[1]/100*h.maxValue:s[p[0]]=p[1]/100*h.maxValue}var d=[];for(var u in a){var g=1;g=1e5<=a[u]?s[parseInt(u)%1e4*1e5]||1:s[parseInt(u)%1e4]||1,d.push([u,a[u],a[u]/g])}d.sort(function(e,t){return e[2]-t[2]});var f=[];for(var u in r)g=1,g=1e5<=r[u]?s[parseInt(u)%1e4*1e5]||1:s[parseInt(u)%1e4]||1,f.push(r[u]=[u,r[u],r[u]/g]);for(var l in f.sort(function(e,t){return e[2]-t[2]}),d){var _;if(u=d[l]&&d[l][0],(_=this.gp_attrOld.$children[l])&&(_.text=v.GeneralConfig.getAttrName(parseInt(u)),_.textColor=16777215),_=this.gp_attrNew.$children[l]){var m=f[l]&&f[l][0];_.text=m?v.GeneralConfig.getAttrName(parseInt(m)):"解析错误",_.textColor=851730}}this.timer&&egret.clearInterval(this.timer);var y=5;this.img_arrow.visible=!1,this.timer=egret.setInterval(function(){if(5==y)t.img_arrow.visible=!0;else{var e=t.gp_attrNew.$children[y-6];e&&(e.visible=!0)}11<=++y&&t.timer&&egret.clearInterval(t.timer)},this,160)}}},a.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},a);function a(e){var t=i.call(this)||this;return t.params=e,t.skinName="HeroArtifactPeiYangConfirmView",t}__reflect(n.prototype,"HeroArtifactPeiYangConfirmView")}(game=game||{}),function(l){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_op,egret.TouchEvent.TOUCH_TAP,function(){if(i.curNum==i.requireNum){var t=[];for(var e in i.selectedUuids)i.selectedUuids[e].forEach(function(e){t.push({artifactUuid:e,num:1})});l.GameMVC.heroThingPy.HeroArtifactCompound({id:i.config.id,uuidInfos:t,uuid:i.heroThingVO.uuid,cb:function(){i.hide(),l.AppFacade.getInstance().updateView(l.HeroMediator.N,l.HeroMediator.SV.MAIN),DragonBoneTools.playOnce({effectName:"common_ty_shengpinchenggong",parent:GameRootLayer.gameLayer().popMsgLayer})}})}else Utils.MsgUtils.addMidMsg("材料不足")},this),Utils.ComponentUtils.registerListener(this.btn_back,egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this)},i.prototype.updateView=function(e){var r=this;if(this.heroThingVO=e&&e.vo||this.heroThingVO,this.heroThingVO){this.config=l.Config.heroArtifactCompound()[this.heroThingVO.code];var t=this.config.rewards=JSON.parse(this.config.rewards),i=this.config.requireList=JSON.parse(this.config.requireList),o=this.config.costs=JSON.parse(this.config.costs),n=this.heroThingVO.code,a=t[0][1],s=l.Config.getHeroArtifactConfig()[n],c=l.Config.getHeroArtifactConfig()[a];this.img_icon1.source=s.icon+"_png",this.img_icon2.source=c.icon+"_png",this.lb_name1.text=s.name,this.lb_name2.text=c.name,this.lb_name1.textColor=COLOR_2_FONT_COLOR[s.color],this.lb_name2.textColor=COLOR_2_FONT_COLOR[c.color],this.gp_attr1.removeChildren(),JSON.parse(s.baseAttr).forEach(function(e){var t=new eui.Label;t.textColor=16775908,t.size=23,t.text="+"+l.GeneralConfig.getAttrValue(e[1])+" "+AttrConfig[e[0]].name,r.gp_attr1.addChild(t)}),this.gp_attr2.removeChildren(),JSON.parse(c.baseAttr).forEach(function(e){var t=new eui.Label;t.textColor=16714810,t.size=23,t.text="+"+l.GeneralConfig.getAttrValue(e[1])+" "+AttrConfig[e[0]].name,r.gp_attr2.addChild(t)}),this.curNum=0,this.requireNum=0,i.forEach(function(n,a){r.selectedUuids[a]||(r.selectedUuids[a]=[]);var e=r.selectedUuids[a],t=r.gp_slots.$children[a];t?t.updateNum(e.length):(t=new h({color:n[0],requireNum:n[1],curNum:e.length,clickFunc:function(){PopUpManager.addPopUp({obj:new l.CommonChosePanel({getInfos:function(){var e={},t=l.GameMVC.heroThingPy.AllArtiInfo;for(var i in t){var o=t[i];""==o.heroUuid&&o.config.color==n[0]&&r.uuidFilter(o.uuid,a)&&(e[o.uuid]=o)}return e},type:EEntityType.EEntityTypeHeroArtifact,checkFull:function(e){return e.length>=n[1]},selectUuids:e,title:"请选择圣物"}),closeCB:function(e){r.updateView()}})}}),r.gp_slots.addChild(t)),r.curNum+=e.length,r.requireNum+=n[1]}),this.icon_cost.visible=0<o.length,this.cu_resBar.visible=0<o.length,o.length&&(this.icon_cost.updateItem({cost:o[0],style:CommonIconStyle.RIGHT}),this.cu_resBar.updateBar({costs:o}))}},i.prototype.uuidFilter=function(e,t){var i=!0;for(var o in this.selectedUuids){var n=this.selectedUuids[o];if(Number(o)!=t&&0<n.indexOf(e)){i=!1;break}}return i},i);function i(){var e=t.call(this)||this;return e.selectedUuids={},e.curNum=0,e.requireNum=0,e.skinName="HeroArtifactPeiYangViewSkin3",e}l.HeroArtifactPeiYangView3=e,__reflect(e.prototype,"game.HeroArtifactPeiYangView3");var o,h=(o=eui.Component,__extends(n,o),n.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.data&&this.update(this.data),Utils.ComponentUtils.registerListener(this,egret.TouchEvent.TOUCH_TAP,function(){e.data.clickFunc&&e.data.clickFunc()},this)},n.prototype.update=function(e){this.data=e,this.img_bg.source="beibao_img_sptb_"+this.data.color+"_png",this.updateNum(this.data.curNum)},n.prototype.updateNum=function(e){this.data.curNum=e;var t=this.data.requireNum;if(this.blb_num.text=e+"/"+t,UIActionManager.setAbsGrey(this.img_bg,e<t),egret.Tween.removeTweens(this.img_add),e<t){var i=0,o=l.GameMVC.heroThingPy.AllArtiInfo;for(var n in o){var a=o[n];if(""==a.heroUuid&&a.config.color==this.data.color&&t<=(i+=1))break}this.img_add.visible=t<=i}else this.img_add.visible=!1;this.img_add.visible&&UIActionManager.fadeBlink(this.img_add,!0)},n);function n(e){var t=o.call(this)||this;return t.skinName="HeroArtifactPeiYangView3_SlotItem",t.data=e,t}__reflect(h.prototype,"HeroArtifactPeiYangView3_SlotItem")}(game=game||{}),function(I){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var h=this;t.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_op,egret.TouchEvent.TOUCH_TAP,function(){if("一键升星"!=h.btn_op.label){var e=0,t=0;for(var i in h.selectedUuids)e+=(l=h.selectedUuids[i]).uuids.length,t+=l.requestNum;if(e===t){var o=[];h.selectedUuids.forEach(function(t,e){t.uuids.forEach(function(e){o.push({slotNum:t.slotNum,uuid:e.split("#")[0]})})}),I.GameMVC.heroThingPy.HeroArtifactNewUpStar({uuid:h.heroThingVO.uuid,uuidInfos:o,cb:function(e){h.selectedUuids.splice(0),e.newHeroArtifact&&(h.heroThingVO=I.GameMVC.heroThingPy.AllArtiInfo[e.newHeroArtifact.uuid]),h.config=I.Config.getHeroArtifactUpSectionConfig()[h.heroThingVO.code],h.updateAutoUuid(),h.updateView(void 0,!0)}})}else 0<e?Utils.MsgUtils.addMidMsg("所需材料不足"):Utils.MsgUtils.addMidMsg("当前没有满足条件的材料")}else{for(var n=h.selectedUuids.length>h.autoUuids.length?h.selectedUuids.length:h.autoUuids.length,i=0;i<n;i++)for(var a in h.selectedUuids[i].uuids=[],h.autoUuids[i]){var r=h.autoUuids[i][a];h.selectedUuids[i].uuids.push(r)}h.updateView(void 0,!1);var s=0,c=0;for(var i in h.selectedUuids){var l;s+=(l=h.selectedUuids[i]).uuids.length,c+=l.requestNum}s===c||Utils.MsgUtils.addMidMsg("圣物不足")}},this),Utils.ComponentUtils.registerListener(this.btn_back,egret.TouchEvent.TOUCH_TAP,function(){h.hide()},this),Utils.ComponentUtils.registerListener(this.btn_info,egret.TouchEvent.TOUCH_TAP,function(){I.AppFacade.getInstance().showSubView(I.HeroThingMediator.N,I.HeroThingMediator.SV.ARTIFACT_INFO,{code:h.heroThingVO.code,vo:h.heroThingVO})},this)},i.prototype.updateView=function(e,t){var n=this;if(this.heroThingVO=e&&e.vo||this.heroThingVO,this.heroThingVO){this.config=I.Config.getHeroArtifactUpSectionConfig()[this.heroThingVO.code];var i=I.Config.getHeroArtifactConfig()[this.heroThingVO.code],o=I.Config.getHeroArtifactConfig()[this.config&&this.config.nextCode||0];if(t){if(this.gp_stars.removeChildren(),i.sectionLevel){this.lb_upStar.visible=!1;var a=I.GeneralConfig.getHeroStarInfo(i.sectionLevel);if(4==a.stage){var r=new eui.Group;(c=new eui.Image(a.src)).y=-60,c.scaleX=c.scaleY=1.2,r.addChild(c),this.gp_stars.addChild(r),(l=new eui.BitmapLabel).font="white_num_fnt",l.text=a.num+"",l.horizontalCenter=0,l.bottom=7,r.addChild(l)}else for(var s=0;s<a.num;s++)this.gp_stars.addChild(new eui.Image(a.src));if(o){var c,l,h=I.GeneralConfig.getHeroStarInfo(o.sectionLevel);if(this.gp_stars.numChildren){var p=new eui.Image("yingxion_img_xiaojiantou_png");p.scaleX=p.scaleY=1.5,this.gp_stars.addChild(p)}if(4==h.stage)r=new eui.Group,(c=new eui.Image(h.src)).y=-60,c.scaleX=c.scaleY=1.2,r.addChild(c),this.gp_stars.addChild(r),(l=new eui.BitmapLabel).font="white_num_fnt",l.text=h.num+"",l.horizontalCenter=0,l.bottom=7,r.addChild(l);else for(s=0;s<h.num;s++)this.gp_stars.addChild(new eui.Image(h.src))}}else this.lb_upStar.visible=!0;this.gp_slots.removeChildren(),o?(this.lb_slot.text="所需材料",this.lb_slot.height=24,["oneSlotCosts","twoSlotCosts","threeSlotCosts","fourSlotCosts"].forEach(function(e,t){var i=n.config[e];if(i&&""!=i){var o=0;1==(i=JSON.parse(i))[0]?o=i[1][0][2]:2==i[0]&&(o=i[1][2]),n.selectedUuids.push({uuids:[],condition:i,requestNum:o,slotNum:t+1}),n.gp_slots.addChild(new b)}})):(this.lb_slot.text="已满星",this.lb_slot.height=120);var d=JSON.parse(i.sectionAttr),u=o&&JSON.parse(o.sectionAttr)||[];if(this.heroThingVO.additionRace){var g=I.Config.getHeroArtifactConfig()[this.heroThingVO.code],f=I.Config.heroArtifactAdditon()[g.subType];f&&(d=I.GeneralConfig.AttrMutilAttr(d,1+f.baseImprove/1e3),u=I.GeneralConfig.AttrMutilAttr(u,1+f.baseImprove/1e3))}var _=[];u.forEach(function(t){var e=t[1],i=0;d.forEach(function(e){e[0]===t[0]&&(i=e[1])}),e!=i&&(e<1e5?_.push([t[0],I.GeneralConfig.getAttrValue(e-i)]):_.push([t[0],(Number(I.GeneralConfig.getAttrValue(e))-Number(I.GeneralConfig.getAttrValue(i))).toString()]))}),_.forEach(function(t){d.some(function(e){if(e[0]==t[0])return e.push(t[1]),!0})||d.push([t[0],0,t[1]])});var m=[];if(d.forEach(function(e,t){0!=t&&m.push({text:"\n"}),m.push({text:AttrConfig[e[0]].name+"："+I.GeneralConfig.getAttrValue(e[1])}),e[2]&&(0===e[1]&&"%"==e[2][e[2].length-1]&&(m[m.length-1].text+="%"),m.push({text:"（+"+e[2]+"）",style:{textColor:1507094}}))}),this.lb_attr.textFlow=m,this.gp_skills.removeChildren(),o&&o.sectionSkill===i.sectionSkill)this.gp_skills.scaleY=0,this.gp_skills.visible=!1;else{if(this.gp_skills.scaleY=.9,this.gp_skills.visible=!0,i.sectionSkill){var y=new customui.SkillItem({code:i.sectionSkill});this.bindSkillPanelClick({target:y}),this.gp_skills.addChild(y)}o&&o.sectionSkill&&(i.sectionSkill&&this.gp_skills.addChild(new eui.Image("shenqi_img_jiantou_png")),y=new customui.SkillItem({code:o.sectionSkill}),this.bindSkillPanelClick({target:y}),this.gp_skills.addChild(y))}5==this.heroThingVO.config.color&&this.updateAutoUuid()}if(o){if(this.btn_op.skinName="skins.ButtonSkinGreen",5==this.heroThingVO.config.color){var v=0,T=0;for(var C in this.selectedUuids){var E=this.selectedUuids[C];v+=E.uuids.length,T+=E.requestNum}this.btn_op.label=v===T?"升 星":"一键升星"}else this.btn_op.label="升 星",this.hasEnoughtArti=!0;UIActionManager.setGrey(this.btn_op,!this.hasEnoughtArti)}else UIActionManager.setGrey(this.btn_op,!1),this.btn_op.skinName="skins.ButtonSkinSure",this.btn_op.label="已满星";this.selectedUuids.forEach(function(e,t){n.gp_slots.getChildAt(t).update({targetUuid:n.heroThingVO.uuid,uuidInfo:n.selectedUuids,index:t})})}},i.prototype.bindSkillPanelClick=function(e){var t=this,i=e.target;i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.data&&i.data.code&&(t.skillDeatils.visible=!0,t.skillDeatils.updateItem({code:i.data.code}))},this),i.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.skillDeatils.visible=!1},this),i.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){t.skillDeatils.visible=!1},this),i.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.skillDeatils.visible=!1},this)},i.prototype.updateAutoUuid=function(){var r=this;if(this.config){this.autoUuids=[];var i={},e=["oneSlotCosts","twoSlotCosts","threeSlotCosts","fourSlotCosts"],s=[],t=I.GameMVC.heroThingPy.AllArtiInfo;for(var o in t){var n=t[o];n.heroUuid||n.uuid==this.heroThingVO.uuid||(s.push(n),i[n.code]?i[n.code]++:i[n.code]=1)}var a=0;e.forEach(function(e,t){var i=r.config[e];i&&""!=i&&1==(i=JSON.parse(i))[0]&&(a=i[1][0][1])}),s.sort(function(e,t){if(e.code!=t.code){if(e.code==a)return 1;if(t.code==a)return-1}return e.level!=t.level?e.level-t.level:i[e.code]!=i[t.code]?i[e.code]-i[t.code]:e.code-t.code}),e.forEach(function(e,t){var i=r.config[e];if(i&&""!=i){r.autoUuids[t]||r.autoUuids.push([]),i=JSON.parse(i);var o=0;for(var n in 1==i[0]?o=i[1][0][2]:2==i[0]&&(o=i[1][2]),s){var a=s[n];if(r.artifactFilter(a,i)&&(r.autoUuids[r.autoUuids.length-1].push(a.uuid+"#0"),s.splice(parseInt(n),1),o--),!o)break}o&&(r.hasEnoughtArti=!1)}})}},i.prototype.artifactFilter=function(e,t){return""==e.heroUuid&&(1===t[0]?e.code===t[1][0][1]:2===t[0]?t[1][0]===e.config.color&&t[1][1]===e.config.sectionLevel:void 0)},i);function i(){var e=t.call(this)||this;return e.selectedUuids=[],e.autoUuids=[],e.hasEnoughtArti=!0,e.curNum=0,e.requireNum=0,e.skinName="HeroArtifactPeiYangViewSkin4",e}I.HeroArtifactPeiYangView4=e,__reflect(e.prototype,"game.HeroArtifactPeiYangView4");var o,b=(o=eui.Component,__extends(n,o),Object.defineProperty(n.prototype,"info",{get:function(){return this.data.uuidInfo[this.data.index]},enumerable:!0,configurable:!0}),n.prototype.childrenCreated=function(){var c=this;o.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this,egret.TouchEvent.TOUCH_TAP,function(){var s=[];if(c.data.uuidInfo.forEach(function(e,t){t!=c.data.index&&(s=s.concat(e.uuids))}),PopUpManager.addPopUp({obj:new I.CommonChosePanel({getInfos:function(){var e={},t=I.GameMVC.heroThingPy.AllArtiInfo;for(var i in t){var o=t[i];if(c.artifactFilter(o)){var n=c.data.targetUuid==o.uuid?o.num-1:o.num;if(n)for(var a=0;a<n;a++){var r=o.uuid+"#"+a;s.indexOf(r)<0&&(e[r]=o)}}}return e},type:EEntityType.EEntityTypeHeroArtifact,uniNum:!0,checkFull:function(e){return e.length>=c.info.requestNum},selectUuids:c.info.uuids,title:"请选择圣物"}),closeCB:function(e){e&&(c.info.uuids=e),I.AppFacade.getInstance().updateView(I.HeroThingMediator.N,I.HeroThingMediator.SV.ARTIFACT_PEIYANG4)}}),!c.checkAvailable()){var e=c.info.condition;if(1===e[0]){var t=e[1][0][1];Utils.MsgUtils.addMidMsg("当前没有圣物"+I.Config.getHeroArtifactConfig()[t].name)}else 2===e[0]&&Utils.MsgUtils.addMidMsg("当前没有"+COLOR_CONFIG[e[1][0]].name+e[1][1]+"星圣物")}},this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_bi.addChild(this.baseItem),this.data&&this.update(this.data)},n.prototype.update=function(e){this.data=e;var t=this.info,i=t.condition,o=t.uuids.length,n=t.requestNum;if(this.blb_num.text=o+"/"+n,egret.Tween.removeTweens(this.img_add),this.img_add.alpha=1,o==n?(this.img_add.visible=!1,this.blb_num.font="green_num_fnt",UIActionManager.setGrey(this.gp_bi,!1)):(this.img_add.visible=!0,this.blb_num.font="white_num_fnt",this.checkAvailable()&&UIActionManager.fadeBlink(this.img_add,!0,!1,1e3),UIActionManager.setGrey(this.gp_bi,!0)),1==i[0])this.baseItem.updateData({code:i[1][0][1],isNum:!0});else if(2==i[0]){var a=this.getRandomArtifactCode(i[1]);this.baseItem.updateData({code:a,isNum:!0});var r=i[1][0];r==EColorType.EColorTypeOrange?this.baseItem.img_icon.source="baowu_img_shengwucheng_png":r==EColorType.EColorTypeRed?this.baseItem.img_icon.source="baowu_img_shengwuhong_png":r==EColorType.EColorTypeLegend&&(this.baseItem.img_icon.source="baowu_img_shengwujin_png")}},n.prototype.checkAvailable=function(){var e=0,t=I.GameMVC.heroThingPy.AllArtiInfo;for(var i in t){var o=t[i];this.artifactFilter(o)&&(e+=o.num)}return e},n.prototype.artifactFilter=function(e){var t=this.info.condition;return""==e.heroUuid&&(1===t[0]?e.code===t[1][0][1]:2===t[0]?t[1][0]===e.config.color&&t[1][1]===e.config.sectionLevel:void 0)},n.prototype.getRandomArtifactCode=function(e){var t=I.Config.getHeroArtifactConfig();for(var i in t){var o=t[i];if(!(0!=e[0]&&e[0]!=o.color||0!=e[1]&&e[1]!=o.sectionLevel))return o.code}},n);function n(e){var t=o.call(this)||this;return t.skinName="HeroArtifactPeiYangView4_SlotItem",t.data=e,t}__reflect(b.prototype,"HeroArtifactPeiYangView4_SlotItem")}(game=game||{}),function(C){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_oper,egret.TouchEvent.TOUCH_TAP,function(){e.isEnough?(e.btn_oper.touchEnabled=!1,C.GameMVC.heroThingPy.HeroArtifactAddition(e.heroThingVO.uuid,function(){DragonBoneTools.playOnce({effectName:"common_jxcg",parent:e.gp_effect,x:e.gp_effect.width/2,y:e.gp_effect.height/2,doneCB:function(){e.hide()}})})):Utils.MsgUtils.addMidMsg("所需材料不足")},this),Utils.ComponentUtils.registerListener(this.btn_back,egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cu_resBar)},i.prototype.updateView=function(e,t){if(this.heroThingVO=e&&e.vo||this.heroThingVO,this.heroThingVO){this.btn_oper.touchEnabled=!0,this.heroArtVO=C.GameMVC.heroThingPy.AllArtiInfo[this.heroThingVO.uuid];var i=C.Config.getHeroArtifactConfig()[this.heroThingVO.code].subType;this.config=C.Config.heroArtifactAdditon()[i];var o=void 0,n=[];n=0<this.heroThingVO.level?(o=C.Config.getHeroArtifactUpgradeConfig(this.heroThingVO.code,this.heroThingVO.level),JSON.parse(o.attr)):(o=C.Config.getHeroArtifactConfig()[this.heroThingVO.code],JSON.parse(o.baseAttr));var a=this.heroArtVO.config,r=a&&a.sectionAttr&&JSON.parse(a.sectionAttr)||[],s=this.config.baseImprove,c=this.config.starImprove;this.item_0.updateData({type:EEntityType.EEntityTypeHeroArtifact,code:this.heroThingVO.code}),this.item_1.updateData({type:EEntityType.EEntityTypeHeroArtifact,code:this.heroThingVO.code,additionRace:!0});var l=[];l.push({text:"基础属性",style:HEROTHING_ATTR_STYLE[0]}),n.forEach(function(e){l.push({text:"\n"});var t=e[1];t<1e5?l.push({text:AttrConfig[e[0]].name+"："+C.GeneralConfig.getAttrValue(t)}):l.push({text:AttrConfig[e[0]].name+"："+Number(C.GeneralConfig.getAttrValue(t)).toString()})}),this.lb_base0.textFlow=l;var h=[];if(h.push({text:"基础属性",style:HEROTHING_ATTR_STYLE[0]}),n.forEach(function(e){h.push({text:"\n"});var t=C.GeneralConfig.AttrMutilAttr([e],1+s/1e3);t[0][1]<1e5?h.push({text:AttrConfig[t[0][0]].name+"："+C.GeneralConfig.getAttrValue(t[0][1])}):h.push({text:AttrConfig[t[0][0]].name+"："+Number(C.GeneralConfig.getAttrValue(t[0][1])).toString()})}),this.lb_base1.textFlow=h,0<r.length){var p=[];p.push({text:"升星属性",style:HEROTHING_ATTR_STYLE[0]}),r.forEach(function(e){p.push({text:"\n"});var t=e[1];t<1e5?p.push({text:AttrConfig[e[0]].name+"："+C.GeneralConfig.getAttrValue(t)}):p.push({text:AttrConfig[e[0]].name+"："+Number(C.GeneralConfig.getAttrValue(t)).toString()})}),this.lb_star0.textFlow=p;var d=[];d.push({text:"升星属性",style:HEROTHING_ATTR_STYLE[0]}),r.forEach(function(e){d.push({text:"\n"});var t=C.GeneralConfig.AttrMutilAttr([e],1+c/1e3);t[0][1]<1e5?d.push({text:AttrConfig[t[0][0]].name+"："+C.GeneralConfig.getAttrValue(t[0][1])}):d.push({text:AttrConfig[t[0][0]].name+"："+Number(C.GeneralConfig.getAttrValue(t[0][1])).toString()})}),this.lb_star1.textFlow=d}else this.gp_star.parent&&this.gp_star.parent.removeChild(this.gp_star);var u=JSON.parse(this.config.skillList);this.skillItem.updateItem({code:u[0][1]});var g=C.Config.skillBaseConfig()[u[0][1]];this.lb_skillName.text=g.name,this.lb_skillDesc.text=g.desc;var f=JSON.parse(this.config.costs),_=0;if(this.gp_cost.removeChildren(),f&&f.length){for(var m=0;m<f.length;m++){var y=new customui.CommonIconWithNum({code:f[m][1],num:f[m][2],style:CommonIconStyle.RIGHT,showEnough:!0});y.scaleX=y.scaleY=1,this.gp_cost.addChild(y);var v=C.GameMVC.backpackPy.getItemNumByCode(f[m][1])>=f[m][2];UIActionManager.setAbsGrey(y,!v),v&&_++}this.isEnough=_>=f.length}else this.gp_cost.removeChildren();if(UIActionManager.setAbsGrey(this.btn_oper,!this.isEnough),this.moneyType=[],f&&f.length){var T=!0;this.moneyType.forEach(function(e){e[0]==f[0][0]&&e[1]==f[0][1]&&(T=!1)}),T&&this.moneyType.push([f[0][0],f[0][1]])}this.cu_resBar.updateBar({costs:this.moneyType,width:170,gap:70,needAdd:!0})}},i.prototype.bindSkillPanelClick=function(e){var t=this,i=e.target;i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.data&&i.data.code&&(t.skillDeatils.visible=!0,t.skillDeatils.updateItem({code:i.data.code}))},this),i.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.skillDeatils.visible=!1},this),i.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){t.skillDeatils.visible=!1},this),i.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.skillDeatils.visible=!1},this)},i);function i(){var e=t.call(this)||this;return e.moneyType=[],e.isEnough=!1,e.skinName="HeroArtifactPeiYangViewSkin5",e}C.HeroArtifactPeiYangView5=e,__reflect(e.prototype,"game.HeroArtifactPeiYangView5")}(game=game||{}),function(r){var n,e=(__extends(t,n=BasePanel),t.prototype.childrenCreated=function(){var t=this;function e(e){Utils.ComponentUtils.registerListener(i["btn_change_"+e],egret.TouchEvent.TOUCH_TAP,function(){t.updateBtnType(e)},i)}n.prototype.childrenCreated.call(this);for(var i=this,o=1;o<7;o++)e(o);Utils.ComponentUtils.registerListener(this.btn_yes,egret.TouchEvent.TOUCH_TAP,function(){0!=t.chooseNum?t.nowSkillNum!=t.chooseNum?(t.btn_yes.touchEnabled=!1,r.GameMVC.heroThingPy.HeroArtifactModify(t.heroThingVO.uuid,t.chooseNum,function(){DragonBoneTools.playOnce({effectName:"common_qhjncg",parent:t.gp_effect,x:t.gp_effect.width/2,y:t.gp_effect.height/2,doneCB:function(){}}),t.updateView()})):Utils.MsgUtils.addMidMsg("当前已为此技能"):Utils.MsgUtils.addMidMsg("请选择需要转换的技能")},this),Utils.ComponentUtils.registerListener(this.btn_back,egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.effectList=[this.gp_effect1,this.gp_effect2,this.gp_effect3,this.gp_effect4,this.gp_effect5,this.gp_effect6],this.btnList=[this.btn_change_1,this.btn_change_2,this.btn_change_3,this.btn_change_4,this.btn_change_5,this.btn_change_6],DragonBoneTools.create("common_zhongzujineng",function(e){e.x=this.gp_effect1.width/2,e.y=this.gp_effect1.height/2,e.animation.play(),this.gp_effect1.addChild(e)},this),DragonBoneTools.create("common_zhongzujineng",function(e){e.x=this.gp_effect2.width/2,e.y=this.gp_effect2.height/2,e.animation.play(),this.gp_effect2.addChild(e)},this),DragonBoneTools.create("common_zhongzujineng",function(e){e.x=this.gp_effect3.width/2,e.y=this.gp_effect3.height/2,e.animation.play(),this.gp_effect3.addChild(e)},this),DragonBoneTools.create("common_zhongzujineng",function(e){e.x=this.gp_effect4.width/2,e.y=this.gp_effect4.height/2,e.animation.play(),this.gp_effect4.addChild(e)},this),DragonBoneTools.create("common_zhongzujineng",function(e){e.x=this.gp_effect5.width/2,e.y=this.gp_effect5.height/2,e.animation.play(),this.gp_effect5.addChild(e)},this),DragonBoneTools.create("common_zhongzujineng",function(e){e.x=this.gp_effect6.width/2,e.y=this.gp_effect6.height/2,e.animation.play(),this.gp_effect6.addChild(e)},this)},t.prototype.updateView=function(e,t){if(this.heroThingVO=e&&e.vo||this.heroThingVO,this.heroThingVO){this.btn_yes.touchEnabled=!0,this.heroArtVO=r.GameMVC.heroThingPy.AllArtiInfo[this.heroThingVO.uuid];var i=r.Config.getHeroArtifactConfig()[this.heroThingVO.code].subType;this.config=r.Config.heroArtifactAdditon()[i];var o=this.heroArtVO.additionRace-1;this.nowSkillNum=1+o,this.chooseNum=this.nowSkillNum;var n=JSON.parse(this.config.skillList);this.skillItem.updateItem({code:n[o][1]});var a=r.Config.skillBaseConfig()[n[o][1]];this.lb_skillName.text=a.name,this.lb_skillDesc.text=a.desc,this.lb_text.text="将"+["人族","兽族","精灵族","不死族","魔族","神族"][o]+"替换成以下哪个种族",this.updateBtnType(this.chooseNum)}},t.prototype.updateBtnType=function(e){this.chooseNum=e;var t=["fnj_btn_renzu1_png","fnj_btn_shouzu1_png","fnj_btn_jinglingzu1_png","fnj_btn_busizu1_png","fnj_btn_mozu1_png","fnj_btn_shenzu1_png"];for(var i in this.btnList)this.btnList[i].touchEnabled=!0,this.btnList[i].source=t[i],this.effectList[i].visible=!1;this.btnList[e-1].touchEnabled=!1,this.btnList[e-1].source=["fnj_btn_renzu2_png","fnj_btn_shouzu2_png","fnj_btn_jinglingzu2_png","fnj_btn_busizu2_png","fnj_btn_mozu2_png","fnj_btn_shenzu2_png"][e-1],this.effectList[this.nowSkillNum-1].visible=!0},t);function t(){var e=n.call(this)||this;return e.nowSkillNum=0,e.btnList=[],e.effectList=[],e.chooseNum=0,e.skinName="HeroArtifactPeiYangViewSkin6",e}r.HeroArtifactPeiYangView6=e,__reflect(e.prototype,"game.HeroArtifactPeiYangView6")}(game=game||{}),function(c){var t,e=(__extends(i,t=BasePanel),i.prototype.perClose=function(){},i.prototype.childrenCreated=function(){var o=this;t.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.hide()},this),this.btn_activate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=c.Config.getHeroDermaConfig()[o.dermaConfig.code].costs,t=JSON.parse(e);c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).checkEnough(t)?o.HeroThingPy.HeroDermaActivate(o.dermaConfig.code,function(){o.isCanActivate=!1;var e=o.HeroThingPy.AllDermaInfo,t=void 0;for(var i in e)e[i].config.subType==o.dermaConfig.subType&&(t=e[i].uuid);o.HeroThingPy.HeroDermaPutOn(t,o.uuid,function(){o.isCanPutOn=!1,o.isCanPutDown=!0},function(){o.putCB&&o.putData&&(o.putCB(o.putData,t),o.updateListLockInfo(!0))})},function(){o.playEffect()}):Utils.MsgUtils.addMidMsg("道具不足")},this),this.btn_0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=o.HeroThingPy.AllDermaInfo,t=void 0;for(var i in e)e[i].config.subType==o.dermaConfig.subType&&(t=e[i].uuid);o.HeroThingPy.HeroDermaPutDown(t,o.uuid,function(){o.isCanPutOn=!0,o.isCanPutDown=!1},function(){o.putCB&&o.putData&&(o.putCB(o.putData,""),o.updateListLockInfo(!1))})},this),this.btn_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=o.HeroThingPy.AllDermaInfo,t=void 0;for(var i in e)e[i].config.subType==o.dermaConfig.subType&&(t=e[i].uuid);o.HeroThingPy.HeroDermaPutOn(t,o.uuid,function(){o.isCanPutOn=!1,o.isCanPutDown=!0},function(){o.putCB&&o.putData&&(o.putCB(o.putData,t),o.updateListLockInfo(!0))})},this),this.btn_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=c.GameMVC.heroThingPy;c.AppFacade.getInstance().showSubView(c.FashionMediator.N,c.FashionMediator.SV.ALL_INFO,{module:MODULE.HeroDerma,allUuid:e.AllDermaInfo,bookConfig:c.Config.getHeroDermaHandbookConfig(),modelConfig:c.Config.getHeroDermaConfig()})},this),this.hero_model0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hero_model0.changeAction(customui.HeroDynamicModel.TOUCH_ACTION_LIST)},this),this.item.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().showSubView(c.HeroMediator.N,c.HeroMediator.SV.HERO_DETAIL,{code:this.params.code})},this)},i.prototype.updateView=function(e){e&&e.info&&(this.params=e.info,this.uuid=e.uuid,this.dermaCode=e.dermaCode,this.isCanPutOn=e.isCanPutOn,this.isCanPutDown=e.isCanPutDown,this.isCanActivate=e.isCanActivate,this.isShowAllBtn=e.isShowAllBtn,this.putCB=e.putCB,this.putData=e.putData),this.updateDermaInfo(),this.initList(),this.updateBtnInfo(),this.item.updateData({code:this.params.code,type:EEntityType.EEntityTypeHero,isShowZhongZhu:!0,isNotShowStar:!0,effect:!1})},i.prototype.updateBtnInfo=function(){this.btn_0.visible=this.isCanPutDown,this.btn_1.visible=this.isCanPutOn,this.gp_activate.visible=this.isCanActivate,this.btn_2.visible=this.isShowAllBtn;var e=c.Config.getHeroDermaConfig()[this.dermaConfig.code].costs,t=JSON.parse(e),i=c.Config.itemConfig()[t[0][1]].icon+"_png";if(this.img_costType.source=i,this.blb_activateNum.text=t[0][2],!c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).checkEnough(t))return this.btn_activate.enabled=!1,void UIActionManager.setAbsGrey(this.btn_activate,!0);this.btn_activate.enabled=!0,UIActionManager.setAbsGrey(this.btn_activate,!1)},i.prototype.playEffect=function(){DragonBoneTools.playOnce({effectName:"common_ty_jihuo",y:400,parent:this.gp_hero})},i.prototype.initList=function(){var e=c.Config.getHeroDermaConfig(),t=[];for(var i in e)e[i].subType==this.params.subType&&(e[i].isLock=!1,e[i].isLast=!1,e[i].choose=1==e[i].index,e[i].updateShowCb=this.updateDermaInfo.bind(this),e[i].updateChooseCb=this.updateListDataInfo.bind(this),t.push(e[i]));for(var o in t)t[o].code==this.dermaCode&&(t[o].isLock=!0);t.push({isLast:!0}),this.dataprovider.replaceAll(t),this.list_derma.itemRenderer=n,this.list_derma.dataProvider=this.dataprovider},i.prototype.updateListLockInfo=function(e){for(var t in this.dataprovider.source)this.dataprovider.source[t].isLock=!1;e&&(this.dataprovider.getItemAt(this.curSelectIndex).isLock=!0),this.dataprovider.refresh()},i.prototype.updateListDataInfo=function(e){for(var t in this.curSelectIndex=e-1,this.dataprovider.source)this.dataprovider.source[t].choose=!1;this.dataprovider.getItemAt(this.curSelectIndex).choose=!0,this.dataprovider.refresh()},i.prototype.updateDermaInfo=function(){var e=c.Config.getHeroDermaConfig(),t=void 0;for(var i in e)e[i].subType==this.params.subType&&1==e[i].index&&(t=e[i],this.dermaConfig=e[i]);if(t){this.lb_name0.text=t.name,this.img_race_icon0.source=HeroRaceConfig[this.params.race].raceIconBig,this.hero_model0.update({code:this.params.code,model:t.model});var o=JSON.parse(t.attr),n=[this.gp_type0,this.gp_type1,this.gp_type2],a=[this.img_type0,this.img_type1,this.img_type2],r=[this.blb_typeNum0,this.blb_typeNum1,this.blb_typeNum2],s=[!1,!1,!1];for(i=0;i<o.length;i++)a[i].source=this.getAttrType(o[i][0]),r[i].text="+"+c.GeneralConfig.getAttrValue(o[i][1]),s[i]=!0;for(i=0;i<s.length;i++)s[i]||n[i]&&n[i].parent&&n[i].parent.removeChild(n[i])}},i.prototype.getAttrType=function(e){var t="";switch(e){case EAttrType.Atk:t="pf_img_gonjizi";break;case EAttrType.Life:t="pf_img_shengmingzi";break;case EAttrType.Defence:t="pf_img_fangyu";break;case EAttrType.Speed:t="pf_img_sudu";break;case EAttrType.Crit:t="pf_img_baojizi";break;case EAttrType.CritHurt:t="pf_img_baoshang";break;case EAttrType.Toughness:t="pf_img_kangbao";break;case EAttrType.Hit:t="pf_img_mingzhong";break;case EAttrType.Miss:t="pf_img_shanbizi";break;case EAttrType.HurtRate:t="pf_img_zengshang";break;case EAttrType.FreeHurtRate:t="yxtz2_img_mianshang";break;case EAttrType.Precise:break;case EAttrType.Parry:t="pf_img_gedangzi";break;case EAttrType.ParryCoff:break;case EAttrType.FreeControl:t="pf_img_miankongzi";break;case EAttrType.ArmorBreak:t="pf_img_pojiazi";break;case EAttrType.SockBlood:t="pf_img_xixuezi";break;case EAttrType.AntiInjury:t="pf_img_fanshangzi";break;case EAttrType.Crue:t="pf_img_zhiliaoliang";break;case EAttrType.BeCrue:case EAttrType.SkillHurt:case EAttrType.BeSkillHurt:case EAttrType.SkillHurtAdd:case EAttrType.SkillHurtFree:break;case EAttrType.Tenacity:t="pf_img__renxing"}return t+"_png"},i);function i(){var e=t.call(this)||this;return e.dataprovider=new eui.ArrayCollection,e.curSelectIndex=0,e.HeroThingPy=c.AppFacade.getInstance().retrieveProxy(c.HeroThingPy.N),e.skinName="HeroDermaPanelSkin",e}c.HeroDermaPanel=e,__reflect(e.prototype,"game.HeroDermaPanel");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this)},a.prototype.dataChanged=function(){var e=this.data;this.img_choose.visible=!!e.choose,this.img_isLock.visible=e.isLock,this.lb_name.text=e.name,e.isLast?this.img_choose.visible=!1:(this.img_dermaType.source=""==e.dermaPic?"pf_img_hspz03_png":e.dermaPic+"_png",this.img_dermaType.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.choose||(e.updateShowCb&&e.updateShowCb(),e.updateChooseCb&&e.updateChooseCb(e.index))},this))},a);function a(){var e=o.call(this)||this;return e.skinName="HeroDermaItemSkin",e}__reflect(n.prototype,"HeroDermaItem")}(game=game||{}),function(p){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._fixedCost=JSON.parse(p.Config.constConfig().ImmortalBaptizeCosts.constValue)[0],this.addListener()},i.prototype.updateView=function(e,t){var i=this;if(this.vo=e&&e.vo||this.vo,t&&this._initBaptizeItems(),Object.keys(this.vo.newBaptizeAttr).length)this.heroThingPy.ConfirmBaptizeImmortal({uuid:this.vo.uuid,isSure:!0},function(){i.updateView()});else{var o=this.vo.config;this.lb_name.text=o.name,this.img_icon.source=o.img+"_png",this.lb_level.text=this.vo.sectionLevel+"阶",this._updateAllItems(),this._refreshCostIcons();var n=[];n.push(this._fixedCost[1]);var a=JSON.parse(p.Config.constConfig().ImmortalLockCosts.constValue);n.push(a[0][0][1],a[1][0][0]),this.resBar.updateBar(n)}},i.prototype._initBaptizeItems=function(){var o=this;this._baptizeItemDatas=[];for(var e=0;e<this.vo.slotNum;e++)this._baptizeItemDatas.push({activated:!0,desc:""});var t=p.Config.immortalUpsectionCosts(this.vo.code),i=Object.keys(t).length;if(this.vo.sectionLevel<i)for(e=this.vo.sectionLevel+1;e<=i;e++){var n=t[e],a=this.heroThingPy.getSlotUnlockNum(this.vo.code,e);1<a.length?this._baptizeItemDatas.push({activated:!1,desc:"强化至"+n.level+"阶必定开启"+a[0]+"-"+a[1]+"孔位"}):a[0]&&this._baptizeItemDatas.push({activated:!1,desc:"强化至"+n.level+"阶必定开启"})}var r=this._baptizeItemDatas.length;this._baptizeItemDatas.forEach(function(e,t){e.offset=Math.pow(55*(t-(r-1)/2),2)/550;var i=new p.HeroImmortal_BaptizeItem(e);o.gp_baptizeItems.addChild(i)})},i.prototype._updateAllItems=function(){var c=this,l=p.Config.immortalBaptize(),h=this.vo.baptizeAttr;this.vo.orderList.forEach(function(e,t){if(e){null==c._lockDict[t]&&(c._lockDict[t]=0);var i=l[e].attrType,o=h[e][1],n=h[e][0],a=p.Config.immortalBaptizeAttr(i,n),r=o<1e5?JSON.parse(a.percentRange)[1]:JSON.parse(a.fixedRange)[1],s=c._baptizeItemDatas[t];s.id=e,s.color=n,s.desc="+"+p.GeneralConfig.getAttrValue(o)+p.GeneralConfig.getAttrName(i)+"（"+p.GeneralConfig.getAttrValue(r)+"满）",s.lock=!!c._lockDict[t],s.lockFunc=function(){c._onLockBtnTap(t)}}}),this._baptizeItemDatas.forEach(function(e,t){c.gp_baptizeItems.getChildAt(t).update(e)})},i.prototype._onLockBtnTap=function(t){var i=this;if(this._lockDict[t])this._setPosLock(t,0);else{var e=JSON.parse(p.Config.constConfig().ImmortalLockCosts.constValue),o=e[0][0],n=p.Config.itemConfig()[o[1]].name;p.GameMgr.getInstance().showCommonTipsWin({cost:e[1],costTips:"或 "+n+"x"+o[2]+" 锁定该铸炼属性？",btnStyle:{cancel:{text:"钻石锁定",skin:"skins.ButtonSkinGreen"},confirm:{text:"道具锁定",skin:"skins.ButtonSkinGreen"}},clickCB:function(e){e.type?i._setPosLock(t,1):i._setPosLock(t,2)}})}},i.prototype._setPosLock=function(e,t){this._lockDict[e]=t;var i=this.vo.orderList[e];for(var o in this._baptizeItemDatas)if(this._baptizeItemDatas[o].id==i){this.gp_baptizeItems.getChildAt(Number(o)).updateLock(0!=t);break}this._refreshCostIcons()},i.prototype._refreshCostIcons=function(){var i=this,o={},e=JSON.parse(p.Config.constConfig().ImmortalLockCosts.constValue),t=e[0][0],n=e[1][0];for(var a in this._lockDict){var r=this._lockDict[a];1==r?(o[t[1]]||(o[t[1]]=0),o[t[1]]+=t[2]):2==r&&(o[n[1]]||(o[n[1]]=0),o[n[1]]+=n[2])}var s=0;for(var c in this._lockDict)this._lockDict[c]&&(s+=1);o[this._fixedCost[1]]||(o[this._fixedCost[1]]=0),o[this._fixedCost[1]]+=this._fixedCost[2]*(this.vo.slotNum-s);for(var l=Object.keys(o);this.gp_costs.numChildren!=l.length;)this.gp_costs.numChildren>l.length?this.gp_costs.removeChildAt(0):this.gp_costs.addChild(new customui.CommonIconWithNum);l.forEach(function(e,t){i.gp_costs.getChildAt(t).updateItem({cost:[void 0,Number(e),o[e]],style:CommonIconStyle.RIGHT})})},i.prototype.addListener=function(){var r=this;Utils.TouchUtils.addTouchListener(this.btn_baptize,function(){var e=0;for(var t in r._lockDict)0<r._lockDict[t]&&(e+=1);if(e==r.vo.slotNum)Utils.MsgUtils.addMidMsg("当前无可铸炼属性");else{var i=[];for(var o in r._lockDict){var n=r._lockDict[o],a=r.vo.orderList[o];i.push({id:a,costType:n})}r.heroThingPy.BaptizeImmortalVTwo({uuid:r.vo.uuid,infoList:i},function(){r.updateView()})}})},i);function i(){var e=t.call(this)||this;return e._lockDict={},e._baptizeItemDatas=[],e._fixedCost=void 0,e.heroThingPy=p.GameMVC.heroThingPy,e.skinName="HeroImmortalBaptizePanelSkin",e}p.HeroImmortalBaptizePanel=e,__reflect(e.prototype,"game.HeroImmortalBaptizePanel")}(game=game||{}),function(f){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.root.blb_title.text="至宝",this.root.onCloseCB=function(){e.hide()},this._addListener()},i.prototype.updateView=function(e){e&&(this.vo=e.vo,this.hero=e.hero,this.source=e.source,this.doneCB=e.doneCB,this.entityType=e.entityType,this.params=e),this._updateImmortalInfo(),this._updateBtn()},i.prototype._updateImmortalInfo=function(){var i=this,e=this.vo.config;this.lb_name.text=e.name,this.img_icon.source=e.img+"_png",this.lb_level.text=this.vo.sectionLevel+"阶";var t=this.vo.slotNum||0;0==t?this.img_pure.source="shenbing_img_weikaikong_png":t==this.heroThingPy.getMaxSlotNum(this.vo.code,this.vo.sectionLevel)?this.img_pure.source="shenbing_img_jueshi_png":this.img_pure.source="";var o=f.Config.immortalUpsectionCosts(e.subType,this.vo.sectionLevel);JSON.parse(o.attr).forEach(function(e){var t=new eui.Label;t.bold=!0,t.textColor=16180429,t.size=18,t.text="+"+f.GeneralConfig.getAttrValue(e[1])+f.GeneralConfig.getAttrName(Number(e[0])),i.gp_attrs.addChild(t)});var n=f.Config.immortalUpsectionCosts(this.vo.code),a=n[this.vo.sectionLevel].skill,r=f.Config.skillBaseConfig()[a];this.skillItem.updateItem({code:a}),this.lb_skillName.text=r.name,this.lb_skillDesc.text=r.desc;var s=f.Config.immortalBaptize(),c=this.vo.baptizeAttr,l=[];for(this.vo.orderList&&this.vo.orderList.forEach(function(e){if(e){var t=s[e].attrType,i=c[e][1],o=c[e][0],n=f.Config.immortalBaptizeAttr(t,o),a=i<1e5?JSON.parse(n.percentRange)[1]:JSON.parse(n.fixedRange)[1];l.push({activated:!0,color:o,desc:"+"+f.GeneralConfig.getAttrValue(i)+f.GeneralConfig.getAttrName(t)+"（"+f.GeneralConfig.getAttrValue(a)+"满）"})}else l.push({activated:!0,desc:""})});l.length<this.vo.slotNum;)l.push({activated:!0,desc:""});var h=Object.keys(n).length;if(this.vo.sectionLevel<h)for(var p=this.vo.sectionLevel+1;p<=h;p++){var d=n[p],u=this.heroThingPy.getSlotUnlockNum(this.vo.code,p);1<u.length?l.push({activated:!1,desc:"强化至"+d.level+"阶概率开启"+u[0]+"-"+u[1]+"孔位"}):u[0]&&l.push({activated:!1,desc:"强化至"+d.level+"阶必定开启1孔位"})}for(;this.gp_baptizeItems.numChildren!=l.length;)this.gp_baptizeItems.numChildren<l.length?this.gp_baptizeItems.addChild(new _):this.gp_baptizeItems.removeChildAt(0);var g=l.length;l.forEach(function(e,t){e.offset=Math.pow(55*(t-(g-1)/2),2)/550,i.gp_baptizeItems.getChildAt(t).update(e)})},i.prototype._updateBtn=function(){switch(this.source){case f.HeroThingMainView.VIEW_SOURCE.HANDBOOK:this.gp_topBtn.visible=this.gp_bottomBtn.visible=!1;break;case f.HeroThingMainView.VIEW_SOURCE.BACKPACK:this.gp_topBtn.visible=!0,this.gp_bottomBtn.visible=!1;break;case f.HeroThingMainView.VIEW_SOURCE.MASTER:this.gp_topBtn.visible=this.gp_bottomBtn.visible=!1;break;case f.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM:this.gp_topBtn.visible=!1,this.gp_bottomBtn.visible=!0,this.btn_equip.visible=!1,this.btn_replace.visible=this.btn_unequip.visible=!0;break;case f.HeroThingMainView.VIEW_SOURCE.HERO:this.gp_topBtn.visible=this.gp_bottomBtn.visible=!0,this.btn_equip.visible=!1,this.btn_replace.visible=this.btn_unequip.visible=!0;break;case f.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM_PUTON:case f.HeroThingMainView.VIEW_SOURCE.PUTON:this.gp_topBtn.visible=!1,this.gp_bottomBtn.visible=!0,this.btn_equip.visible=!0,this.btn_replace.visible=this.btn_unequip.visible=!1}},i.prototype._addListener=function(){var t=this;this.btn_upSection.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.vo.sectionLevel+1;f.Config.immortalUpsectionCosts(t.vo.code,e)?(t.hide(),f.AppFacade.getInstance().showSubView(f.HeroThingMediator.N,f.HeroThingMediator.SV.IMMORTAL_UPSECTION,{vo:t.vo})):Utils.MsgUtils.addMidMsg("当前已满阶")},this),this.btn_baptize.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.vo.slotNum?(t.hide(),f.AppFacade.getInstance().showSubView(f.HeroThingMediator.N,f.HeroThingMediator.SV.IMMORTAL_BAPTIZE,{vo:t.vo})):Utils.MsgUtils.addMidMsg("当前无洗炼孔位")},this),this.btn_replace.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.hide(),t.doneCB&&t.doneCB(),t.source==f.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM){var c=f.GameMVC.heroMutiTeamPy.getHeroImmortal(t.params.teamId);PopUpManager.addPopUp({obj:new f.CommonChosePanel({getInfos:function(){function e(e){var t=s[e],i=c.filter(function(e){return e.originalUuid==t.uuid}).length;if(i<t.num)for(var o=t.num-i,n=0;n<o;n++){var a=t.uuid+"#"+n;r[a]=t}}var r={},s=f.GameMVC.heroThingPy.AllImmortalInfo;for(var t in s)e(t);return r},singleChoose:!0,sortFunc:function(e,t){var i=e.info,o=t.info;return f.Config.immortalConfig(),i.sectionLevel!=o.sectionLevel?o.sectionLevel-i.sectionLevel:i.code!=o.code?o.code-i.code:void 0},type:EEntityType.EEntityTypeImmortal,uniNum:!0,checkFull:function(e){return 1<=e.length},title:"请选择神兵"}),closeCB:function(e){e&&e[0]&&f.GameMVC.heroMutiTeamPy.changeImmortal(t.params.teamId,t.hero.uuid,e[0].split("#")[0])}})}else t.mediator.showSubView(f.HeroThingMediator.SV.SELECT,{entityType:t.entityType,heroUuid:t.hero.uuid,type:t.vo.type,teamId:t.params&&t.params.teamId,source:t.source==f.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM?f.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM_PUTON:void 0,doneCB:function(e){t.source==f.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM?f.GameMVC.heroMutiTeamPy.changeImmortal(t.params.teamId,t.hero.uuid,e.uuid):t.heroThingPy.PutImmortalOn({uuid:e.uuid,heroUuid:t.hero.uuid})}})},this),this.btn_equip.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide(),t.doneCB&&t.doneCB(),t.source==f.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM_PUTON?f.GameMVC.heroMutiTeamPy.changeImmortal(t.params.teamId,t.hero.uuid,t.vo.uuid):t.heroThingPy.PutImmortalOn({uuid:t.vo.uuid,heroUuid:t.hero.uuid})},this),this.btn_unequip.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide(),t.source==f.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM?f.GameMVC.heroMutiTeamPy.changeImmortal(t.params.teamId,t.hero.uuid,""):t.heroThingPy.PutImmortalDown({uuid:t.vo.uuid,heroUuid:t.hero.uuid})},this)},i);function i(){var e=t.call(this)||this;return e.heroThingPy=f.GameMVC.heroThingPy,e.backpackPy=f.GameMVC.backpackPy,e.skinName="HeroImmortalMainViewSkin",e}f.HeroImmortalMainView=e,__reflect(e.prototype,"game.HeroImmortalMainView");var o,_=(o=eui.Component,__extends(n,o),n.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.data&&this.update(this.data),Utils.TouchUtils.addTouchListener(this.btn_lock,function(){e.data.lockFunc(e.data.lock)})},n.prototype.update=function(e){this.data=e;var t=this.data.offset||0;this.gp_root.x=t;var i=this.data.color||1;this.data.activated?(this.img_activated.visible=!0,this.img_activated.source="shenbing_img_kongwei"+(i+1)+"_png"):this.img_activated.visible=!1,this.lb_desc.text=this.data.desc||"待铸炼",this.lb_desc.textColor=this.data.activated?this.COLOR_2_FONTCOLOR[i]:6118749,this.data.lockFunc?(this.btn_lock.visible=!0,this.btn_lock.x=315-t):this.btn_lock.visible=!1,this.updateLock(this.data.lock)},n.prototype.updateLock=function(e){this.data.lock=e,this.btn_lock.icon=e?"common_btn_suoguan_png":"common_btn_suokai_png"},n);function n(e){var t=o.call(this)||this;return t.COLOR_2_FONTCOLOR={1:16776169,2:65400,3:3123711,4:14309631,5:16761612,6:16726329},t.skinName="HeroImmortal_BaptizeItem",t.data=e,t}f.HeroImmortal_BaptizeItem=_,__reflect(_.prototype,"game.HeroImmortal_BaptizeItem")}(game=game||{}),function(g){var t,e=(__extends(i,t=BasePanel),i.prototype._initList=function(){this.ac_list=new eui.ArrayCollection,this.list_items.dataProvider=this.ac_list,this.list_items.itemRenderer=n,this.list_items.addEventListener(eui.ItemTapEvent.ITEM_TAP,this._onListItemTap,this)},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.pb_root.labelDisplay.parent.parent.visible=!1,this._initList(),this.addListener()},i.prototype.updateView=function(e){this.vo=e&&e.vo||this.vo,this.curExp=0;var t=g.Config.immortalConfig()[this.vo.code],i=g.Config.immortalUpsectionCosts(this.vo.code),o=i[this.vo.sectionLevel],n=i[this.vo.sectionLevel+1];this.img_origin.source=t.img+"_png",this.lb_origin.text=this.vo.sectionLevel+"阶"+t.name,this.lb_origin.textColor=COLOR_2_FONT_COLOR[this.vo.sectionLevel+2],this.isMax=!n,this.isMax?this.gp_preview.includeInLayout=this.gp_preview.visible=this.img_arrow.includeInLayout=this.img_arrow.visible=!1:(this.img_preview.source=t.img+"_png",this.lb_preview.text=this.vo.sectionLevel+1+"阶"+t.name,this.lb_preview.textColor=COLOR_2_FONT_COLOR[this.vo.sectionLevel+1+2]);var a={},r={},s=JSON.parse(o.attr);for(var c in s.forEach(function(e){a[e[0]]=e[1]}),this.isMax||(s=JSON.parse(n.attr)).forEach(function(e){r[e[0]]=e[1],a[e[0]]||(a[e[0]]=0)}),this.gp_attr.removeChildren(),a){var l=a[c];this.gp_attr.addChild(this._makeAttrItem(Number(c),l,r[c]))}this.isMax?(this.gp_attr.addChild(this._makeAttrItem(0,this.vo.slotNum,void 0)),this.gp_attr.addChild(this._makeAttrItem(999,o.skill,void 0))):(this.gp_attr.addChild(this._makeAttrItem(0,this.vo.slotNum,this.heroThingPy.getSlotUnlockNum(this.vo.code,this.vo.sectionLevel+1))),this.gp_attr.addChild(this._makeAttrItem(999,o.skill,n.skill))),this.isMax?(this.pb_root.maximum=o.exp,this.curExp=o.exp):(this.pb_root.maximum=n.exp,this.curExp=this.vo.exp||0),this._updateProgressBar();var h=[],p=this.heroThingPy.AllImmortalInfo;for(var d in p){var u=p[d];u.uuid==this.vo.uuid&&1==u.num||""!=u.heroUuid||u.isLocked||u.code==this.vo.code&&(u.sectionLevel>this.vo.sectionLevel||this.heroThingPy.isAwesomeImmortal(u)||h.push({vo:u,selected:!1,self:u.uuid==this.vo.uuid}))}h.sort(function(e,t){return e.vo.sectionLevel!=t.vo.sectionLevel?e.vo.sectionLevel-t.vo.sectionLevel:e.vo.slotNum!=t.vo.slotNum?e.vo.slotNum-t.vo.slotNum:e.vo.num!=t.vo.num?e.vo.num-t.vo.num:e.vo.subType-t.vo.subType}),this.ac_list.source=h,this.ac_list.refresh(),this.isMax&&(this.gp_list.includeInLayout=this.gp_list.visible=!1),this.isMax?(this.btn_max.visible=!0,this.btn_auto.visible=this.btn_oper.visible=this.lb_tips.visible=!1):(this.btn_max.visible=!1,this.btn_auto.visible=this.btn_oper.visible=this.lb_tips.visible=!0)},i.prototype._onListItemTap=function(e){if(!this.isMax){var t=e.item;t.selected,this._selectItem(t,!t.selected)}},i.prototype._selectItem=function(e,t,i){if(void 0===i&&(i=!0),e.selected!=t){e.selected=t;for(var o=e.vo.config.exp,n=1;n<=e.vo.sectionLevel;n++)o+=g.Config.immortalUpsectionCosts(e.vo.code,n).exp;o+=e.vo.exp||0,o*=e.self?e.vo.num-1:e.vo.num,t?this.curExp+=o:this.curExp-=o,i&&(this.ac_list.itemUpdated(e),this._updateProgressBar())}},i.prototype._autoSelect=function(){var e=this.ac_list.source;for(var t in e){var i=e[t];if(!(1<i.vo.sectionLevel)){if(!(this.curExp<this.pb_root.maximum))break;this._selectItem(i,!0,!1)}}this.ac_list.replaceAll(e),this._updateProgressBar()},i.prototype._updateProgressBar=function(){this.pb_root.value=this.curExp,this.blb_expProgress.text=this.curExp+"/"+this.pb_root.maximum},i.prototype._makeAttrItem=function(e,t,i){var o=new eui.Group;o.width=400;var n=new eui.HorizontalLayout;n.gap=0,n.verticalAlign=egret.VerticalAlign.MIDDLE,n.horizontalAlign=egret.HorizontalAlign.CENTER,o.layout=n;var a=new eui.Label;if(a.width=80,a.bold=!0,a.textColor=15913814,a.size=20,o.addChild(a),a.text=999===e?"技能：":0==e?"孔位：":g.GeneralConfig.getAttrName(e)+"：",999==e){var r=new eui.Group;r.width=145,o.addChild(r);var s=new customui.SkillItem;if(s.scaleX=s.scaleY=.7,s.explicitWidth=145,s.updateItem({code:t}),s.horizontalCenter=0,r.addChild(s),this._bindSkillPanelClick({target:s}),i){(p=new eui.Image("zq_img_jiantou_png")).rotation=-90,o.addChild(p);var c=new eui.Group;c.width=145,o.addChild(c);var l=new customui.SkillItem;l.scaleX=l.scaleY=.7,l.explicitWidth=145,l.updateItem({code:i}),l.horizontalCenter=0,c.addChild(l),this._bindSkillPanelClick({target:l})}}else{var h=new eui.Label;if(h.width=145,h.size=20,h.textColor=16775908,h.bold=!0,h.textAlign=egret.HorizontalAlign.CENTER,o.addChild(h),h.text=0==e?t+"孔位":"+"+g.GeneralConfig.getAttrValue(t)+g.GeneralConfig.getAttrName(e),i){var p;(p=new eui.Image("zq_img_jiantou_png")).rotation=-90,o.addChild(p);var d=new eui.Label;d.width=145,d.size=20,d.textColor=16714810,d.bold=!0,d.textAlign=egret.HorizontalAlign.CENTER,o.addChild(d),0==e?1<i.length?d.text=t+i[0]+"-"+(t+i[1])+"孔位":d.text=t+i[0]+"孔位":d.text="+"+g.GeneralConfig.getAttrValue(i)+g.GeneralConfig.getAttrName(e)}}return o},i.prototype._bindSkillPanelClick=function(t){var i=this,o=t.target;o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){if(o.data&&o.data.code)for(var e in i.skillPanel.visible=!0,i.skillPanel.updateItem({code:o.data.code}),t)"target"!=e&&(i.skillPanel[e]=t[e])},this),o.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skillPanel.visible=!1},this),o.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skillPanel.visible=!1},this),o.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skillPanel.visible=!1},this)},i.prototype.addListener=function(){var i=this;this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_auto.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i._autoSelect()},this),this.btn_oper.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(i.curExp<i.pb_root.maximum)Utils.MsgUtils.addMidMsg("你所填入的下一阶经验不足");else{var t=[];i.ac_list.source.forEach(function(e){e.selected&&t.push(e.vo.uuid)}),i._materialConfirm(t)?g.GameMgr.getInstance().showCommonTipsWin({commonTips:"当前选择至宝中有部分经过铸炼，是否继续铸炼？",clickCB:function(e){e.type&&i._upsection(t)}}):i._upsection(t)}},this)},i.prototype._upsection=function(e){var i=this;this.heroThingPy.UpImmortalSection({uuid:this.vo.uuid,uuids:e},function(e){var t=i.vo.uuid;e.immortalList.some(function(e){if(e.uuid!=t)return t=e.uuid,!0}),i.vo=i.heroThingPy.AllImmortalInfo[t],i.updateView()})},i.prototype._materialConfirm=function(e){var t=this.heroThingPy.AllImmortalInfo;return e.some(function(e){if(1<t[e].sectionLevel)return!0})},i);function i(){var e=t.call(this)||this;return e.heroThingPy=g.GameMVC.heroThingPy,e.curExp=0,e.skinName="HeroImmortalUpsectionPanelSkin",e}g.HeroImmortalUpsectionPanel=e,__reflect(e.prototype,"game.HeroImmortalUpsectionPanel");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseItem.addChild(this.baseItem)},a.prototype.dataChanged=function(){var e=this.data.vo;this.baseItem.updateData({code:e.code,vo:e,type:e.entityType,num:this.data.self?e.num-1:e.num}),this.gp_selected.visible=this.data.selected,this.gp_lock.visible=!1},a);function a(){var e=o.call(this)||this;return e.skinName="HeroImmortalUpsectionPanel_Item",e}__reflect(n.prototype,"HeroImmortalUpsectionPanel_Item")}(game=game||{}),function(b){var t,e=(__extends(A,t=BasePanel),A.prototype.childrenCreated=function(){var a=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cu_resBar),Utils.DeviceUtils.setLiuHaiPingAdapter(this.cu_resBar2),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.btn_putOff.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.hide(),a.source==A.VIEW_SOURCE.MUTI_TEAM?a.entityType==EEntityType.EEntityTypeHeroArtifact?b.GameMVC.heroMutiTeamPy.changeArtifact(a.params.teamId,a.hero.uuid,"",function(){a.hide()}):a.entityType==EEntityType.EEntityTypeHeroEquip?b.GameMVC.heroMutiTeamPy.changeEquip(a.params.teamId,a.hero.uuid,a.vo.uuid,"",function(){a.hide()}):(a.entityType,EEntityType.EEntityTypeTreasure):a.entityType==EEntityType.EEntityTypeHeroArtifact?a.heroTingProxy.HeroArtifactPutDown(a.vo.uuid,a.hero.uuid):a.entityType==EEntityType.EEntityTypeHeroEquip?a.heroTingProxy.HeroEquipPutDown(a.vo.uuid,a.hero.uuid):a.entityType==EEntityType.EEntityTypeTreasure&&a.heroTingProxy.TreasurePutDown(a.vo.uuid,a.hero.uuid)},this),this.btn_replace.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.hide(),a.doneCB&&a.doneCB(),a.source==A.VIEW_SOURCE.HERO||a.source==A.VIEW_SOURCE.MASTER?a.mediator.showSubView(b.HeroThingMediator.SV.SELECT,{entityType:a.entityType,heroUuid:a.hero.uuid,type:a.vo.type,doneCB:function(e){a.entityType==EEntityType.EEntityTypeHeroArtifact?a.heroTingProxy.HeroArtifactPutOn(e.uuid,a.hero.uuid):a.entityType==EEntityType.EEntityTypeHeroEquip?a.heroTingProxy.HeroEquipPutOn(e.uuid,a.hero.uuid,e.type):a.entityType==EEntityType.EEntityTypeTreasure&&a.heroTingProxy.TreasurePutOn(e.uuid,a.hero.uuid,e.type)}}):a.source==A.VIEW_SOURCE.PUTON?a.entityType==EEntityType.EEntityTypeHeroArtifact?a.heroTingProxy.HeroArtifactPutOn(a.vo.uuid,a.hero.uuid):a.entityType==EEntityType.EEntityTypeHeroEquip?a.heroTingProxy.HeroEquipPutOn(a.vo.uuid,a.hero.uuid,a.vo.type,function(){var e=b.GameMVC.heroThingPy.getHeroEquips(a.hero.uuid),t=b.Config.getHeroEquipConfig(),i=4<=e.length;for(var o in e){var n=e[o];t[n.code]&&t[n.code].color<7&&(i=!1)}i&&DragonBoneTools.playOnce({effectName:"common_zbdsjh",parent:GameRootLayer.gameLayer().mainLayer,x:GameRootLayer.gameLayer().mainLayer.width/2,y:GameRootLayer.gameLayer().mainLayer.height/2-100})}):a.entityType==EEntityType.EEntityTypeTreasure&&a.heroTingProxy.TreasurePutOn(a.vo.uuid,a.hero.uuid,a.vo.type):a.source==A.VIEW_SOURCE.MUTI_TEAM_PUTON?a.entityType==EEntityType.EEntityTypeHeroArtifact?b.GameMVC.heroMutiTeamPy.changeArtifact(a.params.teamId,a.hero.uuid,a.vo.uuid,function(){a.hide()}):a.entityType==EEntityType.EEntityTypeHeroEquip?b.GameMVC.heroMutiTeamPy.changeEquip(a.params.teamId,a.hero.uuid,"",a.vo.uuid,function(){a.hide()}):(a.entityType,EEntityType.EEntityTypeTreasure):a.source==A.VIEW_SOURCE.MUTI_TEAM&&(a.entityType==EEntityType.EEntityTypeHeroArtifact?a.mutiTeamArtifactPutOn():a.entityType==EEntityType.EEntityTypeHeroEquip?a.mutiTeamEquipPutOn():(a.entityType,EEntityType.EEntityTypeTreasure))},this),this.btn_upgrade.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.entityType==EEntityType.EEntityTypeTreasure&&(a.hide(),b.AppFacade.getInstance().showSubView(b.HeroThingMediator.N,b.HeroThingMediator.SV.TREASURE_PEIYANG,{vo:a.vo,hero:a.hero}))},this),Utils.ComponentUtils.registerListener(this.btn_compound,egret.TouchEvent.TOUCH_TAP,function(){a.hide(),b.AppFacade.getInstance().showSubView(b.HeroThingMediator.N,b.HeroThingMediator.SV.ARTIFACT_PEIYANG3,{vo:a.vo})},this),Utils.ComponentUtils.registerListener(this.btn_lock,egret.TouchEvent.TOUCH_TAP,function(){b.GameMVC.backpackPy.switchLock({lock:!a.vo.isLocked,type:a.vo.entityType,uuid:a.vo.uuid,cb:function(){a.updateView()}})},this),this.bi_left.touchEnabled=!1},A.prototype.updateView=function(e,t){var o=this;if(void 0===t&&(t=!1),e&&(this.vo=e.vo,this.hero=e.hero,this.source=e.source,this.entityType=e.entityType,this.doneCB=e.doneCB,this.vo.entityType=this.entityType,this.params=e),this.vo){var i=void 0;this.entityType==EEntityType.EEntityTypeHeroArtifact?(i=b.Config.getHeroArtifactConfig()[this.vo.code],this.lb_quenchce.text=""):this.entityType==EEntityType.EEntityTypeHeroEquip?(i=b.Config.getHeroEquipConfig()[this.vo.code],this.vo.quenchceLevel?this.lb_quenchce.text="淬炼"+this.vo.quenchceLevel+"级":this.lb_quenchce.text=""):this.entityType==EEntityType.EEntityTypeTreasure&&(i=b.Config.getHeroTreasureConfig()[this.vo.code],this.btn_putOff.visible=this.btn_replace.visible=!1,this.source!=A.VIEW_SOURCE.MUTI_TEAM&&this.source!=A.VIEW_SOURCE.MUTI_TEAM_PUTON?this.btn_upgrade.visible=!0:this.btn_upgrade.parent&&this.btn_upgrade.parent.removeChild(this.btn_upgrade),this.lb_quenchce.text="",this.img_firstLine.parent&&this.img_firstLine.parent.removeChild(this.img_firstLine));var n,a="";if(this.vo.entityType===EEntityType.EEntityTypeHeroArtifact&&this.vo.additionRace&&(n=b.Config.heroArtifactAdditon()[i.subType])){for(var r=this.vo.additionRace,s=JSON.parse(n.skillList),c=0,l=0;l<s.length;l++)if(s[l][0]==r){c=s[l][1];break}if(c){var h=b.Config.skillBaseConfig()[c];h&&(a=h.name+"·")}}if(this.lb_name.text=a+i.name,this.bi_left.updateData({type:this.entityType,code:i.code,vo:this.vo,isNum:!0}),a){var p=JSON.parse(b.Config.constConfig().HeroArtifactAdditionShow.constValue);this.lb_name.textColor=p[0]}else this.lb_name.textColor=COLOR_2_FONT_COLOR[this.bi_left.config.color];switch(this.source){case A.VIEW_SOURCE.HANDBOOK:case A.VIEW_SOURCE.BACKPACK:this.gp_btns.parent&&this.gp_btns.parent.removeChild(this.gp_btns),this.commonSourceJumpLabel.visible=!0,this.commonSourceJumpLabel.setNeedCode(this.vo.code);break;case A.VIEW_SOURCE.MASTER:this.gp_btns.parent&&this.gp_btns.parent.removeChild(this.gp_btns),this.commonSourceJumpLabel.visible=!1,Utils.UnlockMgr.checkPass(MODULE.HeroArtifactUpQuality,!1).allow&&b.Config.heroArtifactCompound()[this.vo.code]&&(this.btn_compound.visible=!0);break;case A.VIEW_SOURCE.MUTI_TEAM:case A.VIEW_SOURCE.HERO:this.gp_btns.visible=!0,this.commonSourceJumpLabel.visible=!1,Utils.UnlockMgr.checkPass(MODULE.HeroArtifactUpQuality,!1).allow&&b.Config.heroArtifactCompound()[this.vo.code]&&(this.btn_compound.visible=!0);break;case A.VIEW_SOURCE.MUTI_TEAM_PUTON:case A.VIEW_SOURCE.PUTON:this.gp_btns.visible=!0,this.commonSourceJumpLabel.visible=!1,this.btn_replace.label="穿戴",this.btn_replace.horizontalCenter=0,this.btn_putOff.visible=!1}if(this.vo.entityType===EEntityType.EEntityTypeHeroArtifact&&this.source!=A.VIEW_SOURCE.HANDBOOK&&this.vo.config.color>EColorType.EColorTypePurple&&this.source!=A.VIEW_SOURCE.MUTI_TEAM&&this.source!=A.VIEW_SOURCE.MUTI_TEAM_PUTON?(this.btn_lock.visible=!0,this.btn_lock.icon=this.vo.isLocked?"common_btn_suoguan_png":"common_btn_suokai_png"):this.btn_lock.visible=!1,this.heroThingAttrs[0]||this.entityType!=EEntityType.EEntityTypeTreasure&&(this.heroThingAttrs[0]=new b.HeroThingAttr1({cb2:function(e){if(o.entityType==EEntityType.EEntityTypeHeroArtifact)b.AppFacade.getInstance().hideSubView(b.HeroThingMediator.N,b.HeroThingMediator.SV.MAIN),b.AppFacade.getInstance().showSubView(b.HeroThingMediator.N,b.HeroThingMediator.SV.ARTIFACT_PEIYANG,{vo:o.vo,mode:1});else if(o.entityType==EEntityType.EEntityTypeHeroEquip&&o.backpackPy.checkEnough(e,!0)){var i=o.hero&&b.GameMVC.heroThingPy.getMasterLevel(o.hero.uuid,HeroEquipMasterType.Upgrade)||0;o.heroTingProxy.HeroEquipUpgrade(o.vo.uuid,void 0,function(e){var t=o.hero&&b.GameMVC.heroThingPy.getMasterLevel(o.hero.uuid,HeroEquipMasterType.Upgrade)||0;i<t?DragonBoneTools.playOnce({effectName:"common_qhdssj",parent:o.gp_root,x:o.gp_root.width/2,y:o.gp_root.height/2-400}):DragonBoneTools.playOnce({effectName:"common_ty_qh",parent:o.gp_root,x:o.gp_root.width/2,y:o.gp_root.height/2}),e.newHeroEquip&&(o.vo=o.heroTingProxy.AllEquipInfo[e.newHeroEquip.uuid],o.updateView())})}},cb3:function(e){if(o.entityType==EEntityType.EEntityTypeHeroArtifact)b.AppFacade.getInstance().hideSubView(b.HeroThingMediator.N,b.HeroThingMediator.SV.MAIN),b.AppFacade.getInstance().showSubView(b.HeroThingMediator.N,b.HeroThingMediator.SV.ARTIFACT_PEIYANG2,{vo:o.vo});else if(o.entityType==EEntityType.EEntityTypeHeroEquip&&o.backpackPy.checkEnough(e,!0)){var i=o.hero&&b.GameMVC.heroThingPy.getMasterLevel(o.hero.uuid,HeroEquipMasterType.Enchant)||0;o.heroTingProxy.HeroEquipEnchant(o.vo.uuid,void 0,function(e){var t=o.hero&&b.GameMVC.heroThingPy.getMasterLevel(o.hero.uuid,HeroEquipMasterType.Enchant)||0;i<t?DragonBoneTools.playOnce({effectName:"common_fmdssj",parent:o.gp_root,x:o.gp_root.width/2,y:o.gp_root.height/2-400}):DragonBoneTools.playOnce({effectName:"common_ty_fm",parent:o.gp_root,x:o.gp_root.width/2,y:o.gp_root.height/2}),e.newHeroEquip&&(o.vo=o.heroTingProxy.AllEquipInfo[e.newHeroEquip.uuid],o.updateView())})}},cb4:function(e){if(o.entityType==EEntityType.EEntityTypeHeroEquip&&o.backpackPy.checkEnough(e,!0)){var i=o.hero&&b.GameMVC.heroThingPy.getMasterLevel(o.hero.uuid,HeroEquipMasterType.Quenchce)||0;o.heroTingProxy.HeroEquipQuenchce(o.vo.uuid,void 0,function(e){var t=o.hero&&b.GameMVC.heroThingPy.getMasterLevel(o.hero.uuid,HeroEquipMasterType.Quenchce)||0;i<t?DragonBoneTools.playOnce({effectName:"common_cldssj",parent:o.gp_root,x:o.gp_root.width/2,y:o.gp_root.height/2-400}):DragonBoneTools.playOnce({effectName:"common_ty_cuilianchenggong",parent:o.gp_root,x:o.gp_root.width/2,y:o.gp_root.height/2}),e.newHeroEquip&&(o.vo=o.heroTingProxy.AllEquipInfo[e.newHeroEquip.uuid],o.updateView())})}}}),this.gp_attr.addChild(this.heroThingAttrs[0])),!this.heroThingAttrs[1])if(this.entityType==EEntityType.EEntityTypeHeroArtifact)(n=b.Config.heroArtifactAdditon()[i.subType])&&(this.gp_attr.addChild(new eui.Image("common_img_fengexian_02_png")),this.heroThingAttrs[2]=new b.HeroThingArtifactAddition({hero:this.hero,closeFunc:function(){o.hide()},isLock:Utils.UnlockMgr.checkPass(MODULE.HeroArtifactAddition,!1)}),this.gp_attr.addChild(this.heroThingAttrs[2])),this.source!=A.VIEW_SOURCE.HANDBOOK&&i.sectionMax&&(this.gp_attr.addChild(new eui.Image("common_img_fengexian_02_png")),this.heroThingAttrs[1]=new b.HeroThingArtifactUpSection({hero:this.hero,closeFunc:function(){o.hide()},isLock:Utils.UnlockMgr.checkPass(MODULE.HeroArtifactUpStar,!1)}),this.gp_attr.addChild(this.heroThingAttrs[1]));else if(this.entityType==EEntityType.EEntityTypeHeroEquip){b.GameMVC.heroThingPy.getHeroEquips(this.hero&&this.hero.uuid);var d=b.Config.getHeroEquipConfig()[this.vo.code];8==d.color&&(this.gp_attr.addChild(new eui.Image("common_img_fengexian_02_png")),this.heroThingAttrs[2]=new b.HeroThingSkill({hero:this.hero,closeFunc:function(){o.hide()},tip:"（暗金专属技能）",isLock:Utils.UnlockMgr.checkPass(MODULE.HeroEquipQuenchce,!1)}),this.gp_attr.addChild(this.heroThingAttrs[2])),this.gp_attr.addChild(new eui.Image("common_img_fengexian_02_png"));var u=b.Config.getHeroEquipSuitConfig(d.suitType);this.heroThingAttrs[1]=new b.HeroThingSuit({hero:this.hero}),u&&0<u.length?this.gp_attr.addChild(this.heroThingAttrs[1]):this.img_secondLine.parent.removeChild(this.img_secondLine)}else this.entityType==EEntityType.EEntityTypeTreasure&&(this.gp_attr.addChild(new eui.Image("common_img_fengexian_02_png")),this.heroThingAttrs[2]=new b.HeroThingBaoshi({hero:this.hero,cb:function(){}}),this.gp_attr.addChild(this.heroThingAttrs[2]),this.gp_attr.addChild(new eui.Image("common_img_fengexian_02_png")),this.heroThingAttrs[3]=new b.HeroThingGongMing({hero:this.hero}),this.gp_attr.addChild(this.heroThingAttrs[3]));this.heroThingAttrs.forEach(function(e){e.update(o.vo,o.source)});var g=b.Config.getHeroEquipUpgradeConfig(this.vo.code,this.vo.level+1)||b.Config.getHeroEquipUpgradeConfig(this.vo.code,this.vo.level),f=b.Config.getHeroEquipEnchantConfig(this.vo.code,(this.vo.level2||0)+1)||b.Config.getHeroEquipEnchantConfig(this.vo.code,this.vo.level2||0),_=new eui.HorizontalLayout;_.horizontalAlign=egret.HorizontalAlign.CENTER,this.cu_resBar.gp_root.layout=_;var m=new eui.HorizontalLayout;if(m.horizontalAlign=egret.HorizontalAlign.CENTER,this.cu_resBar2.gp_root.layout=m,f&&f.costs&&g&&g.costs){this.cu_resBar.visible=!0;var y=JSON.parse(f.costs),v=JSON.parse(g.costs),T=[];v.forEach(function(e){T.push(e)}),T.push(y[0]),this.cu_resBar.updateBar({costs:T,width:190,needAdd:!0})}else if(f&&f.costs&&g&&!g.costs){this.cu_resBar.visible=!0,y=JSON.parse(f.costs);var C=[];y.forEach(function(e){C.push(e)}),this.cu_resBar.updateBar({costs:C,width:190,needAdd:!0})}else if(g&&g.costs&&!i.costs){this.cu_resBar.visible=!0;var E=JSON.parse(g.costs),I=[];E.forEach(function(e){I.push(e)}),this.cu_resBar.updateBar({costs:I,width:190,needAdd:!0})}(0<i.professionSuit||8==i.color&&this.entityType==EEntityType.EEntityTypeHeroEquip)&&Utils.UnlockMgr.checkPass(MODULE.HeroEquipQuenchce,!1).allow?(this.cu_resBar2.visible=!0,v=b.Config.getHeroEquipQuenchceConfig(this.vo.code,1).costs,this.cu_resBar2.updateBar({costs:v,width:190})):this.cu_resBar2.visible=!1,this.source!=A.VIEW_SOURCE.MASTER&&this.source!=A.VIEW_SOURCE.HERO&&this.source!=A.VIEW_SOURCE.BACKPACK&&(this.cu_resBar.visible=!1,this.cu_resBar2.visible=!1),this.lb_desc.textFlow=[{text:"介绍\n",style:HEROTHING_ATTR_STYLE[0]},{text:"   "+(i.desc||"暂无介绍"),style:HEROTHING_ATTR_STYLE[1]}]}},A.prototype.mutiTeamEquipPutOn=function(){var c=this,l=b.GameMVC.heroMutiTeamPy.getHeroEquips(this.params.teamId);PopUpManager.addPopUp({obj:new b.CommonChosePanel({getInfos:function(){function e(e){var t=s[e],i=l.filter(function(e){return e.originalUuid==t.uuid}).length;if(function(e){return e.type==c.vo.type}(t)&&i<t.num)for(var o=t.num-i,n=0;n<o;n++){var a=t.uuid+"#"+n;r[a]={uuid:t.uuid,type:EEntityType.EEntityTypeHeroEquip,code:t.code}}}var r={},s=b.GameMVC.heroThingPy.AllEquipInfo;for(var t in s)e(t);return r},singleChoose:!0,sortFunc:function(e,t){var i=e.info,o=t.info,n=b.Config.getHeroEquipConfig();return i.isLocked!=o.isLocked?i.isLocked?1:-1:n[i.code].color!=n[o.code].color?n[o.code].color-n[i.code].color:n[i.code].starLevel!=n[o.code].starLevel?n[o.code].starLevel-n[i.code].starLevel:i.level!=o.level?o.level-i.level:i.code!=o.code?o.code-i.code:void 0},type:EEntityType.EEntityTypeHeroEquip,uniNum:!0,checkFull:function(e){return 1<=e.length},title:"请选择装备"}),closeCB:function(e){e&&e[0]&&b.GameMVC.heroMutiTeamPy.changeEquip(c.params.teamId,c.hero.uuid,c.vo.uuid,e[0].split("#")[0],function(){c.hide()})}})},A.prototype.mutiTeamArtifactPutOn=function(){var t=this,h=b.GameMVC.heroMutiTeamPy.getHeroArtifact(this.params.teamId);b.Config.getHeroArtifactConfig(),PopUpManager.addPopUp({obj:new b.CommonChosePanel({getInfos:function(){var e={},t=b.GameMVC.heroThingPy.AllArtiInfo,i={};for(var o in h){var n=h[o];i[n.originalUuid]?i[n.originalUuid]++:i[n.originalUuid]=1}for(var a in t){var r=t[a],s=i[r.uuid]||0;if(1==r.config.type&&s<r.num)for(var c=r.num-s,l=0;l<c;l++)e[r.uuid+"#"+l]={uuid:r.uuid,type:EEntityType.EEntityTypeHeroArtifact,code:r.code}}return e},singleChoose:!0,sortFunc:function(e,t){var i=e.info,o=t.info,n=b.Config.getHeroArtifactConfig();return i.isLocked!=o.isLocked?i.isLocked?1:-1:n[i.code].color!=n[o.code].color?n[o.code].color-n[i.code].color:n[i.code].sectionLevel!=n[o.code].sectionLevel?n[o.code].sectionLevel-n[i.code].sectionLevel:i.level!=o.level?o.level-i.level:i.code!=o.code?o.code-i.code:void 0},type:EEntityType.EEntityTypeHeroArtifact,uniNum:!0,checkFull:function(e){return 1<=e.length},title:"请选择圣物"}),closeCB:function(e){e&&e[0]&&b.GameMVC.heroMutiTeamPy.changeArtifact(t.params.teamId,t.hero.uuid,e[0].split("#")[0])}})},A.VIEW_SOURCE={BACKPACK:0,HERO:1,PUTON:2,HANDBOOK:3,MASTER:5,MUTI_TEAM:6,MUTI_TEAM_PUTON:7},A);function A(){var e=t.call(this)||this;return e.skinName="HeroThingMainViewSkin",e.heroTingProxy=b.AppFacade.getInstance().retrieveProxy(b.HeroThingPy.N),e.backpackPy=b.AppFacade.getInstance().retrieveProxy(b.BackpackPy.N),e.heroThingAttrs=new Array,e}b.HeroThingMainView=e,__reflect(e.prototype,"game.HeroThingMainView")}(game=game||{}),function(S){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this);for(var e=0;e<4;e++){var t=new n;this.gp_equips.addChild(t),this.equipItems.push(t)}this.attrItemOld=new s,this.gp_attrLeft.addChild(this.attrItemOld),this.attrItemNew=new s,this.gp_attrRight.addChild(this.attrItemNew),this.tabbar_top.itemRendererSkinName="SimpleTabbarItemSkin",this.tabbar_top.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabbarTap,this)},t.prototype.onTabbarTap=function(e){this.seleceIndex=e.itemIndex,this.updateView({})},t.prototype.updateView=function(e){if(e&&(e.heroUuid&&(this.heroUuid=e.heroUuid),this.heroUuid)){var t=S.GameMVC.heroThingPy.getHeroEquips(this.heroUuid),i=S.Config.getHeroEquipConfig();if(this.isFirst){var o=[{source:{up:"_btn_yq_m_json.jiban_txt_qhds1",down:"_btn_yq_m_json.jiban_txt_qhds2",text:""}},{source:{up:"_btn_yq_m_json.jiban_txt_fods1",down:"_btn_yq_m_json.jiban_txt_fods2",text:""}}];if(Utils.UnlockMgr.checkPass(MODULE.HeroEquipQuenchce,!1).allow)for(var n in t)if(i[(N=t[n]).code]&&0<i[N.code].professionSuit||8==i[N.code].color){o.push({source:{up:"_btn_yq_m_json.jiban_txt_clds1",down:"_btn_yq_m_json.jiban_txt_clds2",text:""}});break}this.tabbar_top.dataProvider=new eui.ArrayCollection(o),this.isFirst=!1}var a=0;for(var n in t)i[(N=t[n]).code]&&7<=i[N.code].color&&a++;this.lb_conditionName.visible=a<4;var r="level",s="";switch(this.seleceIndex){case 0:r="level",s="强化",this.lb_conditionName.text="仅限穿戴4件橙色及以上装备";break;case 1:r="attachLevel",s="附魔",this.lb_conditionName.text="仅限穿戴4件橙色及以上装备";break;case 2:r="quenchceLevel",s="淬炼",this.lb_conditionName.text="穿戴任意暗金装备或4件金色职业套装后可激活技能"}this.lb_masterName.text=s+"大师",this.lb_processName.text=s+"进度",this.lb_quickName.text="点击装备可直接进行"+s;var c=9999999999,l=0,h=0,p=!(this.canBeOneSuit=!0),d=S.GameMVC.heroPy.allHeroByUuid[this.heroUuid].code,u=S.Config.allHeroConfig()[d],g=!1;for(var n in t)c=c<(N=t[n])[r]?c:N[r],i[N.code]&&8==i[N.code].color&&(g=!0),i[N.code]&&i[N.code].professionSuit?(l&&l!=i[N.code].professionSuit&&(this.canBeOneSuit=!1),p||(l=i[N.code].professionSuit,h=i[N.code].suitType,p=u.profession==l)):this.canBeOneSuit=!1;t.sort(function(e,t){return e.type-t.type});for(var f=0;f<4;f++)this.equipItems[f]&&this.equipItems[f].update({vo:t[f]||{type:f+1},professionSuit:l,miniLevel:c,type:this.seleceIndex+1,key:r,heroUuid:this.heroUuid});var _=S.Config.getHeroEquipMasterConfig(this.seleceIndex+1),m=0,y=0,v=0,T=0,C="",E="";for(var n in _)if((N=_[n]).level<=c)m=N.showLevel,C=N.attr;else if(!y){y=N.level,E=N.attr;break}var I=!0;for(var n in _)if((N=_[n]).showLevel==m+1){I=!1;break}I?(this.gp_attrLeft.horizontalCenter=0,this.gp_attrRight.visible=!1,this.img_arrow.visible=!1):(this.gp_attrLeft.horizontalCenter=-167.5,this.gp_attrRight.visible=!0,this.img_arrow.visible=!0);var b=m;if(this.canBeOneSuit||2!=this.seleceIndex?(2==this.seleceIndex&&(this.canBeOneSuit?this.lb_conditionName.visible=!p:this.lb_conditionName.visible=!0),this.lb_conditionName.top=846):(m=0,this.canBeOneSuit?this.lb_conditionName.visible=!p:this.lb_conditionName.visible=!0,this.lb_conditionName.top=753),2==this.seleceIndex&&g&&(this.lb_conditionName.visible=!1),l){var A=S.Config.getHeroEquipSuitConfig(h),P=void 0;for(var n in A)if(4==(N=A[n]).num){P=N;break}if(P){var M=JSON.parse(P.talent);for(var n in M)(N=M[n])[1]==m&&(v=N[0]),N[1]==m+1&&(T=N[0])}}if(g&&2==this.seleceIndex)for(var n in M=JSON.parse(S.Config.constConfig().DarkGoldSkillList.constValue)){var N;(N=M[n])[1]==b&&(v=N[0]),N[1]==b+1&&(T=N[0])}this.attrItemOld.update({skillCode:v,attrs:C,type:this.seleceIndex+1,isOld:!0,nextLevel:y,curMasterLevel:m,truecurMasterLevel:b,canBeOneSuit:this.canBeOneSuit||g}),this.attrItemNew.update({skillCode:T,attrs:E,type:this.seleceIndex+1,isOld:!1,nextLevel:y,truecurMasterLevel:b+1,curMasterLevel:m+1,canBeOneSuit:this.canBeOneSuit||g})}},t);function t(){var e=i.call(this)||this;return e.equipItems=[],e.isFirst=!0,e.canBeOneSuit=!0,e.seleceIndex=0,e.skinName="HeroThingMasterView",e}S.HeroThingMasterView=e,__reflect(e.prototype,"game.HeroThingMasterView");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.baseitem_equip.addTapEvent(function(){e.params&&e.params.vo.uuid&&S.AppFacade.getInstance().showSubView(S.HeroThingMediator.N,S.HeroThingMediator.SV.MAIN,{entityType:EEntityType.EEntityTypeHeroEquip,vo:e.params.vo,hero:S.GameMVC.heroPy.allHeroByUuid[e.params.heroUuid],source:S.HeroThingMainView.VIEW_SOURCE.MASTER})},this)},a.prototype.update=function(e){if(e){var t=e.vo;if(this.params=e,t){this.baseitem_equip.updateData({code:t.code,num:""});var i=S.Config.getHeroEquipConfig()[t.code];this.lb_name.text=i&&i.name;var o=S.Config.getHeroEquipMasterConfig(e.type),n=void 0;for(var a in o){var r=o[a];if(e.miniLevel<r.level){n=r;break}}var s=t[e.key]||0,c=n&&n.level||o[o.length-1].level;c<=s?(this.pb_progress.labelDisplay.visible=!1,this.bm_full.visible=!0):(this.pb_progress.labelDisplay.visible=!0,this.bm_full.visible=!1),this.pb_progress.maximum=c,this.pb_progress.value=s,this.bm_full.text=s+"/"+c}else this.lb_name.text="暂无装备",this.baseitem_equip.visible=!1,this.pb_progress.visible=!1;this.baseitem_equip.blb_num.visible=!1}},a);function a(){var e=o.call(this)||this;return e.skinName="HeroThingMasterEquipItem",e}__reflect(n.prototype,"HeroThingMasterEquipItem");var r,s=(r=eui.ItemRenderer,__extends(c,r),c.prototype.update=function(e){if(e){var t=e.skillCode,i=JSON.parse(e.attrs),o=e.type,n=e.isOld,a=e.nextLevel,r=(e.curMasterLevel,e.truecurMasterLevel),s="",c=[];switch(o){case HeroEquipMasterType.Upgrade:c.push({text:"强化大师"+r+"级",style:{textColor:15913814,size:25}}),s="强化",this.gp_skill.visible=!1,this.lb_name.top=30,this.lb_attr.verticalCenter=55;break;case HeroEquipMasterType.Enchant:c.push({text:"附魔大师"+r+"级",style:{textColor:15913814,size:25}}),s="附魔",this.gp_skill.visible=!1,this.lb_name.top=30,this.lb_attr.verticalCenter=55;break;case HeroEquipMasterType.Quenchce:c.push({text:"淬炼大师"+r+"级",style:{textColor:15913814,size:25}}),s="淬炼",this.gp_skill.visible=e.canBeOneSuit,e.canBeOneSuit?(this.lb_name.top=0,this.lb_attr.verticalCenter=-29.5):(this.lb_name.top=30,this.lb_attr.verticalCenter=55)}var l=!0,h=S.Config.getHeroEquipMasterConfig(o);for(var p in h)if((u=h[p]).showLevel==r+1){l=!1;break}if(l&&n&&c.push({text:"(已满级)",style:{textColor:15913814,size:25}}),n?(this.lb_attr.textColor=16775908,this.lb_skillDesc.textColor=16775908):(this.lb_attr.textColor=9539985,this.lb_skillDesc.textColor=9539985,c.push({text:"\n(全身装备"+s+"至"+a+"级)",style:{textColor:16775908,size:20}})),this.lb_name.lineSpacing=5,a||n?this.lb_name.textFlow=c:(this.lb_name.textFlow=[{text:"已满级",style:{textColor:15913814,size:25}}],this.gp_skill.visible=!1),this.lb_attr.lineSpacing=5,0<i.length){var d=[];for(var p in i){var u,g=(2e3<(u=i[p])[0]?"装备":"")+S.GeneralConfig.getAttrName(u[0]),f=S.GeneralConfig.getAttrValue(u[1]);d.push({text:g+"+"+f+"\n"})}this.lb_attr.textFlow=d}else this.lb_attr.textFlow=l&&0!=r?[{text:"满属性\n"}]:[{text:"无属性\n"}];this.skillItem.updateItem({code:t});var _=S.Config.skillBaseConfig()[t];this.lb_skillDesc.text=_&&_.desc||""}},c);function c(){var e=r.call(this)||this;return e.skinName="HeroThingMasterAttrItem",e}__reflect(s.prototype,"HeroThingMasterAttrItem")}(game=game||{}),function(s){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.initList()},t.prototype.initList=function(){this.collection=new eui.ArrayCollection,this.list_item.itemRenderer=n,this.list_item.dataProvider=this.collection,this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){var t=this,i=s.AppFacade.getInstance().retrieveProxy(s.HeroPy.N);if(this.params&&this.params.source==s.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM||this.params&&this.params.source==s.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM_PUTON){var o=s.GameMVC.heroMutiTeamPy.getHeroOriginalUuid(this.params.heroUuid);o&&s.AppFacade.getInstance().showSubView(s.HeroThingMediator.N,s.HeroThingMediator.SV.MAIN,{vo:e.item.vo,source:this.params.source,entityType:this.params.entityType,hero:i.allHeroByUuid[o],teamId:this.params.teamId,doneCB:function(){t.hide()}})}else i.allHeroByUuid[this.params.heroUuid]&&s.AppFacade.getInstance().showSubView(s.HeroThingMediator.N,s.HeroThingMediator.SV.MAIN,{vo:e.item.vo,source:s.HeroThingMainView.VIEW_SOURCE.PUTON,entityType:this.params.entityType,hero:i.allHeroByUuid[this.params.heroUuid],doneCB:function(){t.hide()}})},this)},t.prototype.perShow=function(e){if(e.entityType!=EEntityType.EEntityTypeHeroArtifact&&e.entityType!=EEntityType.EEntityTypeHeroEquip&&e.entityType!=EEntityType.EEntityTypeImmortal)return!0;var t=void 0,i=this.heroThingProxy.AllArtiInfo,o=void 0;for(var n in e.entityType==EEntityType.EEntityTypeHeroEquip?(i=this.heroThingProxy.AllEquipInfo,o=e.type):e.entityType==EEntityType.EEntityTypeHeroArtifact?(i=this.heroThingProxy.AllArtiInfo,t=s.Config.getHeroArtifactConfig()):e.entityType==EEntityType.EEntityTypeTreasure?i=this.heroThingProxy.AllTreasureInfo:e.entityType==EEntityType.EEntityTypeImmortal&&(i=this.heroThingProxy.AllImmortalInfo),i){var a=i[n];if(""==a.heroUuid&&(null==o||o==a.type)&&(e.entityType!=EEntityType.EEntityTypeHeroArtifact||t[a.code]&&t[a.code].type==HeroArtifactType.Normal))return!0}var r=this.typeStr[e.entityType];return Utils.MsgUtils.addMidMsg("无替换的"+r),!1},t.prototype.updateView=function(e){this.doneCB=e.doneCB,this.params=e;var i,t=this.heroThingProxy.AllArtiInfo,o=void 0;for(var n in e.entityType==EEntityType.EEntityTypeHeroEquip?(t=this.heroThingProxy.AllEquipInfo,o=e.type,this.lb_title.text="请选择英雄装备"):e.entityType==EEntityType.EEntityTypeHeroArtifact?(t=this.heroThingProxy.AllArtiInfo,this.lb_title.text="请选择英雄圣物",i=s.Config.getHeroArtifactConfig()):e.entityType==EEntityType.EEntityTypeTreasure?(t=this.heroThingProxy.AllTreasureInfo,this.lb_title.text="请选择英雄宝物"):e.entityType==EEntityType.EEntityTypeImmortal&&(t=this.heroThingProxy.AllImmortalInfo,this.lb_title.text="请选择英雄至宝"),this.collection.removeAll(),t){var a=t[n];""!=a.heroUuid||null!=o&&o!=a.type||!(e.entityType!=EEntityType.EEntityTypeHeroArtifact||i[a.code]&&i[a.code].type==HeroArtifactType.Normal)||this.collection.addItem({vo:a,entityType:e.entityType})}if(e.entityType==EEntityType.EEntityTypeHeroArtifact?this.collection.source.sort(function(e,t){return t.vo.config.color!=e.vo.config.color?t.vo.config.color-e.vo.config.color:i[t.vo.code].sectionLevel!=i[e.vo.code].sectionLevel?i[t.vo.code].sectionLevel-i[e.vo.code].sectionLevel:t.vo.level!=e.vo.level?t.vo.level-e.vo.level:t.vo.num!=e.vo.num?e.vo.num-t.vo.num:t.vo.code!=e.vo.code?e.vo.code-t.vo.code:void 0}):this.collection.source.sort(function(e,t){return t.vo.fightCap-e.vo.fightCap}),this.collection.length<=0&&(e.entityType==EEntityType.EEntityTypeHeroArtifact||e.entityType==EEntityType.EEntityTypeHeroEquip||e.entityType==EEntityType.EEntityTypeImmortal)){var r=this.typeStr[e.entityType];Utils.MsgUtils.addMidMsg("无替换的"+r),this.hide()}this.collection.refresh()},t);function t(e){var t=i.call(this)||this;return t.typeStr={8:"装备",9:"圣物",11:"宝物",21:"至宝"},t.heroThingProxy=s.AppFacade.getInstance().retrieveProxy(s.HeroThingPy.N),t.skinName="HeroThingSelectPanelSkin",t}s.HeroThingSelectPanel=e,__reflect(e.prototype,"game.HeroThingSelectPanel");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){this.width=this.height=97,this.baseitem=customui.BaseItemFactory.create(),this.baseitem.touchEnabled=!1,this.addChild(this.baseitem)},a.prototype.dataChanged=function(){this.baseitem.updateData({uuid:this.data.vo.uuid,code:this.data.vo.code,type:this.data.entityType})},a);function a(){return o.call(this)||this}__reflect(n.prototype,"ItemRender")}(game=game||{}),function(S){var e,t=(e=eui.Component,__extends(i,e),i.prototype.update=function(e,t){this.vo=e},i);function i(){return null!==e&&e.apply(this,arguments)||this}S.HeroThingAttrBase=t,__reflect(t.prototype,"game.HeroThingAttrBase");var k,o=(__extends(n,k=t),n.prototype.childrenCreated=function(){k.prototype.childrenCreated.call(this)},n.prototype.update=function(e,t){var n=this;k.prototype.update.call(this,e),this.vo.entityType==EEntityType.EEntityTypeHeroArtifact&&(this.lb_1.width=250,this.gp_costAll1.width=200,this.lb_2.width=250,this.gp_costAll2.width=200,this.lb_3.width=250,this.gp_costAll3.width=200),t!=S.HeroThingMainView.VIEW_SOURCE.MASTER&&t!=S.HeroThingMainView.VIEW_SOURCE.HERO&&t!=S.HeroThingMainView.VIEW_SOURCE.BACKPACK&&(this.gp_costAll1.visible=this.gp_costAll2.visible=this.gp_costAll3.visible=this.gp_costAll4.visible=!1),Number(S.Config.constConfig().ArtifactColorFilter.constValue);var i=[];switch(this.vo.entityType){case EEntityType.EEntityTypeHeroEquip:(p=S.Config.getHeroEquipConfig()[this.vo.code])&&(i=JSON.parse(p.baseAttr));break;case EEntityType.EEntityTypeHeroArtifact:if(this.vo.level?(p=S.Config.getHeroArtifactUpgradeConfig(this.vo.code,this.vo.level||0))&&(i=JSON.parse(p.attr)):(p=S.Config.getHeroArtifactConfig()[this.vo.code])&&(i=JSON.parse(p.baseAttr)),this.vo.additionRace){var o=S.Config.getHeroArtifactConfig()[this.vo.code],a=S.Config.heroArtifactAdditon()[o.subType];a&&(i=S.GeneralConfig.AttrMutilAttr(i,1+a.baseImprove/1e3))}if(this.gp_cost1.removeChildren(),Utils.UnlockMgr.checkPass(MODULE.HeroArtifactUpGrade,!1).allow)(r=S.Config.getHeroArtifactUpgradeConfig(this.vo.code,(this.vo.level||0)+1))&&t!=S.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM&&t!=S.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM_PUTON&&((M=new eui.Button).skinName="skins.ButtonSkinGreen",M.label="升 级",M.scaleX=.7,M.scaleY=.7,this.gp_cost1.addChild(M),M.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.cb2&&n.cb2()},this));else{var r=S.Config.getHeroArtifactUpgradeConfig(this.vo.code,(this.vo.level||0)+1);(P=new eui.Label("")).text=Utils.UnlockMgr.checkPass(MODULE.HeroArtifactUpGrade,!1).ext.tips,P.size=23,P.percentWidth=100,P.height=41,P.verticalCenter=5,P.horizontalCenter=20,P.verticalAlign="middle",P.textAlign="center",this.gp_cost1.addChild(P)}}var s=[];s.push({text:"基础属性\n",style:HEROTHING_ATTR_STYLE[0]}),i.forEach(function(e){e[2]?s.push({text:"   +"+S.GeneralConfig.getAttrValue(e[1])+" 对"+ProfessionConfig[e[3]].name+S.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]}):s.push({text:"   +"+S.GeneralConfig.getAttrValue(e[1])+" "+S.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]})}),this.lb_1.textFlow=s;var c=!1,l=[],h=[];if(this.vo.entityType==EEntityType.EEntityTypeHeroEquip){if(Utils.UnlockMgr.checkPass(MODULE.HeroEquipUpGrade,!1).allow){var p=S.Config.getHeroEquipUpgradeConfig(this.vo.code,this.vo.level);if(r=S.Config.getHeroEquipUpgradeConfig(this.vo.code,this.vo.level+1),p?h=JSON.parse(p.attr):this.gp2.parent&&this.gp2.parent.removeChild(this.gp2),r){this.gp_cost2.removeChildren();var d=JSON.parse(r.costs);d.length<3&&(this.gp_cost2.layout.gap=30),d.forEach(function(e){var t=new customui.CommonIconWithNum({code:e[1],num:e[2],style:CommonIconStyle.RIGHT,showEnough:!0,showDetail:!0});t.width=100,n.gp_cost2.addChild(t)}),t!=S.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM&&t!=S.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM_PUTON&&((M=new eui.Button).skinName="skins.ButtonSkinIcon",M.icon="common_btn_shang_png",M.width=40,M.height=37,this.gp_cost2.addChild(M),M.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.cb2&&n.cb2(d)},this))}else this.gp_cost2.removeChildren(),(P=new eui.Label("已满级")).size=25,P.percentWidth=100,P.height=41,P.verticalCenter=5,P.horizontalCenter=20,P.verticalAlign="middle",P.textAlign="center",this.gp_cost2.addChild(P),this.img_bg2.left=100,this.img_bg2.right=80}else this.gp_cost2.removeChildren(),(P=new eui.Label("")).text=Utils.UnlockMgr.checkPass(MODULE.HeroEquipUpGrade,!1).ext.tips,P.size=23,P.percentWidth=100,P.height=41,P.verticalCenter=5,P.horizontalCenter=20,P.verticalAlign="middle",P.textAlign="center",this.gp_cost2.addChild(P);l.push({text:"强化属性\n",style:HEROTHING_ATTR_STYLE[0]})}else this.vo.entityType==EEntityType.EEntityTypeHeroArtifact&&(c=!0,this.gp2.parent&&this.gp2.parent.removeChild(this.gp2));c||(0==h.length||1==h.length&&0==h[0][1]?(this.vo&&this.vo.filterShow&&this.gp2.parent&&this.gp2.parent.removeChild(this.gp2),l.push({text:"   无\n",style:HEROTHING_ATTR_STYLE[1]})):h.forEach(function(e){l.push({text:"   +",style:HEROTHING_ATTR_STYLE[1]}),l.push({text:S.GeneralConfig.getAttrValue(e[1])+" "+S.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]})}),this.gp2&&(this.lb_2.textFlow=l));var u=[],g=[];if(this.vo.entityType==EEntityType.EEntityTypeHeroEquip){if(Utils.UnlockMgr.checkPass(MODULE.HeroEquipEnchat,!1).allow)if(p=S.Config.getHeroEquipEnchantConfig(this.vo.code,this.vo.level2||0),r=S.Config.getHeroEquipEnchantConfig(this.vo.code,(this.vo.level2||0)+1),p?g=JSON.parse(p.attr):this.gp3.parent&&this.gp3.parent.removeChild(this.gp3),r){this.gp_cost3.removeChildren();var f=JSON.parse(r.costs);f.length<3&&(this.gp_cost3.layout.gap=30),f.forEach(function(e){var t=new customui.CommonIconWithNum({code:e[1],num:e[2],style:CommonIconStyle.RIGHT,showEnough:!0,showDetail:!0});t.width=100,n.gp_cost3.addChild(t)}),t!=S.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM&&t!=S.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM_PUTON&&((M=new eui.Button).skinName="skins.ButtonSkinIcon",M.icon="common_btn_shang_png",M.width=40,M.height=37,this.gp_cost3.addChild(M),M.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.cb3&&n.cb3(f)},this))}else this.gp_cost3.removeChildren(),(P=new eui.Label("已满级")).size=25,P.percentWidth=100,P.height=41,P.verticalCenter=5,P.horizontalCenter=20,P.verticalAlign="middle",P.textAlign="center",this.gp_cost3.addChild(P),this.img_bg3.left=100,this.img_bg3.right=80;else this.gp_cost3.removeChildren(),(P=new eui.Label("")).text=Utils.UnlockMgr.checkPass(MODULE.HeroEquipEnchat,!1).ext.tips,P.size=23,P.percentWidth=100,P.height=41,P.verticalCenter=5,P.horizontalCenter=20,P.verticalAlign="middle",P.textAlign="center",this.gp_cost3.addChild(P);u.push({text:"附魔属性\n",style:HEROTHING_ATTR_STYLE[0]})}else if(this.vo.entityType==EEntityType.EEntityTypeHeroArtifact){t==S.HeroThingMainView.VIEW_SOURCE.HANDBOOK&&this.gp3.parent&&this.gp3.parent.removeChild(this.gp3);var _=JSON.parse(this.vo.baptizeAttr),m=[];for(var y in _){var v=_[y];1e4<parseInt(y)?m.push([parseInt(y)%1e4,v]):m.push([y,v])}m.length||this.gp3.parent&&this.gp3.parent.removeChild(this.gp3),this.img_bg3.parent&&this.img_bg3.parent.removeChild(this.img_bg3);var T=JSON.parse(this.vo.baptizeAttr);for(var y in T)v=T[y],1e4<parseInt(y)?g.push([parseInt(y)%1e4,v]):g.push([y,v]);this.gp_cost3.removeChildren();var C=new eui.Group;C.width=65,this.gp_cost3.addChild(C),t!=S.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM&&t!=S.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM_PUTON&&((M=new eui.Button).skinName="skins.ButtonSkinGreen",M.label="洗 炼",M.scaleX=.7,M.scaleY=.7,this.vo.config&&this.vo.config.color>=S.Config.getCanShowHeroArtifactBaptizeColor()&&Utils.UnlockMgr.checkPass(MODULE.HeroArtifactBaptize,!1).allow?this.gp_cost3.addChild(M):(this.gp_cost3.removeChildren(),(P=new eui.Label("")).text=Utils.UnlockMgr.checkPass(MODULE.HeroArtifactBaptize,!1).ext.tips,P.size=23,P.percentWidth=100,P.height=41,P.verticalCenter=5,P.horizontalCenter=20,P.verticalAlign="middle",P.textAlign="center",this.gp_cost3.addChild(P),g=[]),M.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.cb3&&n.cb3()},this)),u.push({text:"洗炼属性\n",style:HEROTHING_ATTR_STYLE[0]})}0==g.length?u.push({text:"   无\n",style:HEROTHING_ATTR_STYLE[1]}):g.forEach(function(e){if(n.vo.entityType==EEntityType.EEntityTypeHeroArtifact){var t=S.Config.getHeroArtifactConfig()[n.vo.code].color;u.push({text:"   +",style:{size:26,textColor:COLOR_2_FONT_COLOR[t]}}),e[2]?u.push({text:S.GeneralConfig.getAttrValue(e[1])+" 对"+ProfessionConfig[e[3]].name+S.GeneralConfig.getAttrName(e[0])+"\n",style:{size:21,textColor:COLOR_2_FONT_COLOR[t]}}):u.push({text:S.GeneralConfig.getAttrValue(e[1])+" "+S.GeneralConfig.getAttrName(e[0])+"\n",style:{size:21,textColor:COLOR_2_FONT_COLOR[t]}})}else u.push({text:"   +",style:HEROTHING_ATTR_STYLE[3]}),u.push({text:S.GeneralConfig.getAttrValue(e[1])+" "+S.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[3]})}),this.lb_3.textFlow=u;var E,I=[],b=[];c=!1,E=this.vo;var A=S.Config.getHeroEquipConfig()[E.code];if(this.vo.entityType==EEntityType.EEntityTypeHeroEquip&&A&&0<A.professionSuit||A&&8==A.color){var P;if(Utils.UnlockMgr.checkPass(MODULE.HeroEquipQuenchce,!1).allow)if(p=S.Config.getHeroEquipQuenchceConfig(this.vo.code,E.quenchceLevel||0),r=S.Config.getHeroEquipQuenchceConfig(this.vo.code,(E.quenchceLevel||0)+1),p?b=JSON.parse(p.attr):this.gp4.parent&&this.gp4.parent.removeChild(this.gp4),r){this.gp_cost4.removeChildren();var M,N=JSON.parse(r.costs);N.length<3&&(this.gp_cost4.layout.gap=30),N.forEach(function(e,t,i){var o=new customui.CommonIconWithNum({code:e[1],num:e[2],style:CommonIconStyle.RIGHT,showEnough:!0,showDetail:!0});o.width=100,n.gp_cost4.addChild(o)}),t!=S.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM&&t!=S.HeroThingMainView.VIEW_SOURCE.MUTI_TEAM_PUTON&&((M=new eui.Button).skinName="skins.ButtonSkinIcon",M.icon="common_btn_shang_png",M.width=40,M.height=37,this.gp_cost4.addChild(M),M.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.cb4&&n.cb4(N)},this))}else this.gp_cost4.removeChildren(),(P=new eui.Label("已满级")).size=25,P.percentWidth=100,P.height=41,P.verticalCenter=5,P.horizontalCenter=20,P.verticalAlign="middle",P.textAlign="center",this.gp_cost4.addChild(P),this.img_bg4.left=100,this.img_bg4.right=80;else this.gp_cost4.removeChildren(),(P=new eui.Label("")).text=Utils.UnlockMgr.checkPass(MODULE.HeroEquipQuenchce,!1).ext.tips,P.size=23,P.percentWidth=100,P.height=41,P.verticalCenter=5,P.horizontalCenter=20,P.verticalAlign="middle",P.textAlign="center",this.gp_cost4.addChild(P);I.push({text:"淬炼属性\n",style:HEROTHING_ATTR_STYLE[0]})}else c=!0,this.gp4.parent&&this.gp4.parent.removeChild(this.gp4);c||(0==b.length?I.push({text:"   无\n",style:HEROTHING_ATTR_STYLE[1]}):b.forEach(function(e){I.push({text:"   +",style:HEROTHING_ATTR_STYLE[3]}),I.push({text:S.GeneralConfig.getAttrValue(e[1])+" "+S.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[3]})})),this.lb_4.textFlow=I},n);function n(e){var t=k.call(this)||this;return t.skinName="HeroThingUICompoent_HeroThingAttr1Skin",t.cb2=e.cb2,t.cb3=e.cb3,t.cb4=e.cb4,t}S.HeroThingAttr1=o,__reflect(o.prototype,"game.HeroThingAttr1");var a,r=(__extends(s,a=t),s.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this);var e=new eui.Group,t=new eui.VerticalLayout;e.layout=t,this.addChild(e),this.lb_1=new eui.Label,this.lb_1.lineSpacing=8,this.lb_1.width=450,e.addChild(this.lb_1)},s.prototype.update=function(g){var f=this;a.prototype.update.call(this,g);var _=[],e=S.Config.getHeroEquipConfig()[this.vo.code],t=S.Config.getHeroEquipSuitConfig(e.suitType);if(t.length){var m=this.hero&&S.GameMVC.heroThingPy.getHeroSuitCount(this.hero.uuid,e.suitType)||0,y=!0;if(1==t[0].professionType)_.push({text:"套装属性\n",style:HEROTHING_ATTR_STYLE[0]});else if(2==t[0].professionType){y=this.hero&&this.hero.config.profession==e.professionSuit;var i=e.color;_.push({text:COLOR_CONFIG[i].name+"职业套装属性（"+ProfessionConfig[e.professionSuit].name+"）\n",style:HEROTHING_ATTR_STYLE[0]})}t.forEach(function(t){var e=!1;if(t.talent){var i=JSON.parse(t.talent);f.gp_skill&&f.gp_skill.parent&&f.gp_skill.parent.removeChild(f.gp_skill);var o=g.heroUuid,n=S.GameMVC.heroThingPy.getMasterLevel(o,HeroEquipMasterType.Quenchce,!0,g.originalUuid),a=0;for(var r in i){var s=i[r];s[1]==n&&(a=s[0])}var c=S.Config.skillBaseConfig()[a];if(c){e=!0;var l=new eui.Group;l.y=80,l.width=450,l.height=110,f.gp_skill=l,f.addChild(l);var h=m>=t.num&&y,p=new customui.SkillItem;p.scaleX=p.scaleY=.8,p.x=0,p.y=17,p.updateItem({code:a}),UIActionManager.setGrey(p,!h),l.addChild(p);var d=new eui.Label;d.x=82,d.y=22,d.size=24,d.textColor=16755754,d.text=c.name||"未配置名字",l.addChild(d);var u=new eui.Label;u.left=82,u.right=2,u.y=51,u.size=20,u.textColor=h?16775908:9539985,u.text=c.desc+"（穿戴"+t.num+"件激活）\n",l.addChild(u)}}e||(JSON.parse(t.attrAdd).forEach(function(e){_.push({text:"   +"+S.GeneralConfig.getAttrValue(e[1])+" "+S.GeneralConfig.getAttrName(e[0]),style:m>=t.num&&y?HEROTHING_ATTR_STYLE[1]:HEROTHING_ATTR_STYLE[4]})}),_.push({text:m>=t.num&&y?"\n":"（穿戴"+t.num+"件激活）\n",style:HEROTHING_ATTR_STYLE[4]}))})}this.lb_1&&(this.lb_1.textFlow=_)},s);function s(e){var t=a.call(this)||this;return t.hero=e.hero,t}S.HeroThingSuit=r,__reflect(r.prototype,"game.HeroThingSuit");var c,l=(__extends(h,c=t),h.prototype.childrenCreated=function(){c.prototype.childrenCreated.call(this)},h.prototype.update=function(e){c.prototype.update.call(this,e);var t=0;if(this.vo.entityType==EEntityType.EEntityTypeHeroEquip){var i=0;this.params.hero&&(i=this.params.hero&&S.GameMVC.heroThingPy.getMasterLevel(this.params.hero.uuid,HeroEquipMasterType.Quenchce)||0);var o=JSON.parse(S.Config.constConfig().DarkGoldSkillList.constValue);for(var n in o){var a=o[n];a[1]==i&&(t=a[0])}}if(t){this.gp_skill.scaleY=1,this.gp_skill.visible=!0;var r=S.Config.skillBaseConfig()[t];this.skillItem.updateItem({code:t}),this.lb_skillName.textFlow=[{text:r.name},{text:this.params&&this.params.tip||"",style:HEROTHING_ATTR_STYLE[0]}],this.lb_skillDesc.text=r.desc}},h);function h(e){var t=c.call(this)||this;return t.skinName="HeroThingSkill",t.params=e,t}S.HeroThingSkill=l,__reflect(l.prototype,"game.HeroThingSkill");var p,d=(__extends(u,p=t),u.prototype.childrenCreated=function(){p.prototype.childrenCreated.call(this),this.gp_root=new eui.Group;var e=new eui.VerticalLayout;e.gap=0,this.gp_root.layout=e,this.addChild(this.gp_root);var t=[],i=new eui.Label;t.push({text:"宝石属性\n",style:HEROTHING_ATTR_STYLE[0]}),i.height=40,i.textFlow=t,this.gp_root.addChild(i)},u.prototype.update=function(e,t){p.prototype.update.call(this,e);var i=(this.vo=e).heroUuid,o=S.AppFacade.getInstance().retrieveProxy(S.HeroPy.N).allHeroByUuid[i];for(var n in TreasureJewelType){var a=TreasureJewelType[n],r=this.makeGroup(a),s=this.makeLabel(a,o.level);r.addChild(s),this.gp_root.addChild(r)}},u.prototype.makeLabel=function(e,t){var i=new eui.Label,o=S.Config.getTreasureLockInfo(e,t),n=[],a=this.vo;if(o)n.push({text:o+"级解锁",style:HEROTHING_ATTR_STYLE[1]});else{n.push({text:(a.jewelLevel[e]||0)+"级"+TREASURE_ICON_NAME[e][1],style:HEROTHING_ATTR_STYLE[5]});var r=S.Config.getTreasureJewelUpgradeConfig(e)[a.jewelLevel[e]||0],s=JSON.parse(r.attr);s.forEach(function(e){n.push({text:"   +"+S.GeneralConfig.getAttrValue(e[1])+" "+S.GeneralConfig.getAttrName(e[0]),style:HEROTHING_ATTR_STYLE[3]})}),0==s.length&&n.push({text:"   无\n",style:HEROTHING_ATTR_STYLE[3]})}return i.textFlow=n,i},u.prototype.makeGroup=function(e){var t=new eui.Group,i=new eui.HorizontalLayout;i.verticalAlign=egret.VerticalAlign.MIDDLE,t.layout=i,this.gp_root.addChild(t);var o=new eui.Group;t.addChild(o);var n=new eui.Image("_border_m_json.common_img_jichuwupingkuang2");n.width=n.height=30,n.verticalCenter=n.horizontalCenter=0,o.addChild(n);var a=new eui.Image(TREASURE_ICON_NAME[e][0]);return a.width=a.height=26,a.verticalCenter=a.horizontalCenter=0,o.addChild(a),t},u);function u(e){var t=p.call(this)||this;return t.hero=e.hero,t.cb=e.cb,t}S.HeroThingBaoshi=d,__reflect(d.prototype,"game.HeroThingBaoshi");var g,f=(__extends(_,g=t),_.prototype.childrenCreated=function(){g.prototype.childrenCreated.call(this);var e=new eui.Group,t=new eui.VerticalLayout;e.layout=t,this.addChild(e),this.lb_1=new eui.Label,this.lb_1.lineSpacing=8,e.addChild(this.lb_1)},_.prototype.update=function(e){g.prototype.update.call(this,e);var t=this.vo,i=S.Config.getHeroTreasureConfig(),o=0;if(4==Object.keys(t.jewelLevel).length)for(var n in o=99999,t.jewelLevel)o=Math.min(t.jewelLevel[n],o);var a=void 0,r=void 0;for(var n in i){if(!(o>=(h=i[n]).level)){r=h.level;break}a=h}var s=[];if(a.resonateLevel){var c="("+a.resonateLevel+"级)";r&&(c+="(下级共鸣于全身宝石"+r+"级解锁)"),s.push({text:"宝石共鸣"+c+"\n",style:HEROTHING_ATTR_STYLE[0]})}else s.push({text:"宝石共鸣\n",style:HEROTHING_ATTR_STYLE[0]});if(0==a.level){var l=0;for(var n in i){var h;if((h=i[n]).level){l=h.level;break}}s.push({text:" 全身宝石等级达到"+l+"级可激活\n",style:HEROTHING_ATTR_STYLE[4]})}else JSON.parse(a.resonateAttr).forEach(function(e){s.push({text:"   +"+S.GeneralConfig.getAttrValue(e[1])+" "+S.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]})});this.lb_1.textFlow=s},_);function _(e){var t=g.call(this)||this;return t.hero=e.hero,t}S.HeroThingGongMing=f,__reflect(f.prototype,"game.HeroThingGongMing");var m,y=(__extends(v,m=t),v.prototype.childrenCreated=function(){var e=this;m.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_op,egret.TouchEvent.TOUCH_TAP,function(){e.closeFunc(),S.AppFacade.getInstance().showSubView(S.HeroThingMediator.N,S.HeroThingMediator.SV.ARTIFACT_PEIYANG4,{vo:e.vo})},this),this.btn_op.visible=this.isLock.allow,this.lb_lock.visible=!this.isLock.allow,this.lb_lock.visible&&(this.lb_lock.text=this.isLock.ext.tips)},v.prototype.update=function(e,t){m.prototype.update.call(this,e);var i=S.Config.getHeroArtifactConfig()[e.code],o=[];o.push({text:"升星属性",style:HEROTHING_ATTR_STYLE[0]});var n=JSON.parse(i.sectionAttr);if(e.additionRace){var a=S.Config.getHeroArtifactConfig()[this.vo.code],r=S.Config.heroArtifactAdditon()[a.subType];r&&(n=S.GeneralConfig.AttrMutilAttr(n,1+r.baseImprove/1e3))}if(n.length?n.forEach(function(e){o.push({text:"\n    +"+S.GeneralConfig.getAttrValue(e[1])+" "+AttrConfig[e[0]].name,style:HEROTHING_ATTR_STYLE[1]})}):o.push({text:"\n    无",style:HEROTHING_ATTR_STYLE[1]}),this.lb_attr.textFlow=o,i.sectionSkill){this.gp_skill.scaleY=1,this.gp_skill.visible=!0;var s=S.Config.skillBaseConfig()[i.sectionSkill];this.skillItem.updateItem({code:i.sectionSkill}),this.lb_skillName.text=s.name,this.lb_skillDesc.text=s.desc}else this.gp_skill.scaleY=0,this.gp_skill.visible=!1;this.isLock.allow?this.btn_op.visible=t===S.HeroThingMainView.VIEW_SOURCE.MASTER||t===S.HeroThingMainView.VIEW_SOURCE.HERO||t===S.HeroThingMainView.VIEW_SOURCE.BACKPACK&&i.sectionLevel<i.sectionMax:this.btn_op.visible=!1},v);function v(e){var t=m.call(this)||this;return t.skinName="HeroThingUICompoent_HeroThingArtifactUpSection",t.closeFunc=e&&e.closeFunc,t.isLock=e&&e.isLock,t}S.HeroThingArtifactUpSection=y,__reflect(y.prototype,"game.HeroThingArtifactUpSection");var T,C=(__extends(E,T=t),E.prototype.childrenCreated=function(){var e=this;T.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_op,egret.TouchEvent.TOUCH_TAP,function(){e.closeFunc(),e.vo.additionRace?S.AppFacade.getInstance().showSubView(S.HeroThingMediator.N,S.HeroThingMediator.SV.ARTIFACT_PEIYANG6,{vo:e.vo}):S.AppFacade.getInstance().showSubView(S.HeroThingMediator.N,S.HeroThingMediator.SV.ARTIFACT_PEIYANG5,{vo:e.vo})},this),this.btn_op.visible=this.isLock.allow,this.lb_lock.visible=!this.isLock.allow,this.lb_lock.visible&&(this.lb_lock.text=this.isLock.ext.tips)},E.prototype.update=function(e,t){T.prototype.update.call(this,e);var i=S.Config.getHeroArtifactConfig()[e.code],o=S.Config.heroArtifactAdditon()[i.subType],n=[];n.push({text:"暗金加成",style:HEROTHING_ATTR_STYLE[0]}),n.push({text:"\n    圣物基础属性 +"+o.baseImprove/10+"%",style:HEROTHING_ATTR_STYLE[1]}),n.push({text:"\n    圣物升星属性 +"+o.starImprove/10+"%",style:HEROTHING_ATTR_STYLE[1]}),this.lb_attr.textFlow=n;var a=this.vo.additionRace||1;if(o.skillList){var r=JSON.parse(o.skillList),s=0;if(r.forEach(function(e){e[0]==a&&(s=e[1])}),s){this.gp_skill.scaleY=1,this.gp_skill.visible=!0;var c=S.Config.skillBaseConfig()[s];this.skillItem.updateItem({code:s}),this.lb_skillName.text=c.name,this.lb_skillDesc.text=c.desc}else this.gp_skill.scaleY=0,this.gp_skill.visible=!1}else this.gp_skill.scaleY=0,this.gp_skill.visible=!1;if(this.isLock.allow?this.btn_op.visible=t===S.HeroThingMainView.VIEW_SOURCE.MASTER||t===S.HeroThingMainView.VIEW_SOURCE.HERO||t===S.HeroThingMainView.VIEW_SOURCE.BACKPACK:this.btn_op.visible=!1,this.img_notice.visible=!1,e.additionRace)this.btn_op.label="技能转换",UIActionManager.setGrey(this.lb_attr,!1),UIActionManager.setGrey(this.lb_skillName,!1),UIActionManager.setGrey(this.lb_skillDesc,!1),UIActionManager.setAbsGrey(this.skillItem,!1);else{UIActionManager.setGrey(this.lb_attr,!0),UIActionManager.setGrey(this.lb_skillName,!0),UIActionManager.setGrey(this.lb_skillDesc,!0),UIActionManager.setAbsGrey(this.skillItem,!0),this.btn_op.label="觉 醒";var l=JSON.parse(o.costs);S.GameMVC.backpackPy.checkEnough(l,!1)&&this.btn_op.visible&&(this.img_notice.visible=!0)}},E);function E(e){var t=T.call(this)||this;return t.skinName="HeroThingUICompoent_HeroThingArtifactAddition",t.closeFunc=e&&e.closeFunc,t.isLock=e&&e.isLock,t}S.HeroThingArtifactAddition=C,__reflect(C.prototype,"game.HeroThingArtifactAddition")}(game=game||{}),function(c){var o,e=(__extends(t,o=BasePanel),t.prototype.childrenCreated=function(){var i=this;for(var e in o.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this),this.btn_oper.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.heroThingProxy.TreasureInlayUpGrade(i.vo.uuid,i.curType,function(){i.updateView(),DragonBoneTools.playOnce({effectName:"common_ty_bs",parent:i.gp_root0,x:i.gp_root0.width/2,y:i.gp_root0.height/2})})},this),TreasureJewelType){var t=new a(TreasureJewelType[e],function(e){if(null!=e.vo.level)i.curType=e.type,i.updateView();else{var t=c.Config.getTreasureLockInfo(e.vo.type,e.vo.heroLevel);if(t)return void Utils.MsgUtils.addMidMsg("英雄"+t+"级解锁");i.heroThingProxy.TreasureInlayUpGrade(i.vo.uuid,e.vo.type,function(){i.updateView()})}});this.gp_root.addChild(t)}},t.prototype.updateView=function(e){var o=this;e&&(this.vo=e.vo),0!=this.gp_root.numChildren&&this.gp_root.$children.forEach(function(e,t){o.vo.jewelLevel&&o.vo.jewelLevel[t+1];var i=c.AppFacade.getInstance().retrieveProxy(c.HeroPy.N).allHeroByUuid[o.vo.heroUuid];e.update({vo:{level:o.vo.jewelLevel&&o.vo.jewelLevel[t+1],type:t+1,uuid:o.vo.uuid,heroLevel:i.level},chosen:t+1==o.curType})});var t=this.vo.jewelLevel&&this.vo.jewelLevel[this.curType]||0,i=[];this.lb_prefix.text=0<=t?"当前属性："+t+"级":"未解锁";var n=c.Config.getTreasureJewelUpgradeConfig(this.curType),a=n[0<=t?t:0];if(a){JSON.parse(a.attr).forEach(function(e){i.push({text:"+"+(0<=t?c.GeneralConfig.getAttrValue(e[1]):0)+" "+c.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[1]})}),this.lb_BasicAttr.textFlow=i,this.gp_costs.removeChildren();var r=n[t+1];if(r){this.lb_prefix0.y=209,this.lb_BasicAttr0.visible=!0,this.btn_oper.visible=!0,this.lb_prefix0.text="下级属性："+(t+1)+"级";var s=[];JSON.parse(r.attr).forEach(function(e){s.push({text:"+"+c.GeneralConfig.getAttrValue(e[1])+" "+c.GeneralConfig.getAttrName(e[0])+"\n",style:HEROTHING_ATTR_STYLE[2]})}),this.lb_BasicAttr0.textFlow=s,JSON.parse(r.costs).forEach(function(e){o.gp_costs.addChild(new customui.CommonIconWithNum({cost:e,style:CommonIconStyle.RIGHT,needShowHave:!0}))})}else this.lb_prefix0.y=240,this.lb_BasicAttr0.visible=!1,this.btn_oper.visible=!1,this.lb_prefix0.text="已满级"}},t);function t(){var e=o.call(this)||this;return e.skinName="HeroTreasurePeiYangViewSkin",e.heroThingProxy=c.AppFacade.getInstance().retrieveProxy(c.HeroThingPy.N),e.curType=TreasureJewelType.Atk,e}c.HeroTreasurePeiYangView=e,__reflect(e.prototype,"game.HeroTreasurePeiYangView");var n,a=(n=eui.Component,__extends(i,n),i.prototype.childrenCreated=function(){var e=this;n.prototype.childrenCreated.call(this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.clickFunction&&e.clickFunction(e)},this),this.once(egret.Event.REMOVED_FROM_STAGE,function(){e.img_zhanwei&&egret.Tween.removeTweens(e.img_zhanwei)},this),this.img_jewel=new eui.Image,this.img_jewel.verticalCenter=this.img_jewel.horizontalCenter=0,this.addChildAt(this.img_jewel,1),this.img_chosen=new eui.Image("common_img_touxiangxuanzhon_png"),this.img_chosen.horizontalCenter=0,this.img_chosen.verticalCenter=-1,this.img_chosen.left=this.img_chosen.right=this.img_chosen.top=this.img_chosen.bottom=-10,this.addChild(this.img_chosen),this.img_canLevelUp=new eui.Image("_main_m_json.common_img_hongdian"),this.img_canLevelUp.right=this.img_canLevelUp.top=0,this.addChild(this.img_canLevelUp),this.img_canPuton.visible=!1},i.prototype.update=function(e){this.vo=e.vo,egret.Tween.removeTweens(this.img_zhanwei);var t=c.Config.getTreasureLockInfo(this.type,this.vo.heroLevel);if(t)this.img_jewel.visible=!1,this.img_zhanwei.visible=!0,this.img_zhanwei.source="common_img_suo_png",this.img_zhanwei.verticalCenter=-10,this.lb_unlock.visible=!0,this.lb_unlock.text="LV "+t,this.img_canLevelUp.visible=!1;else{this.img_zhanwei.visible=!1,this.lb_unlock.visible=!1,this.img_jewel.visible=!0,this.img_jewel.source=TREASURE_ICON_NAME[this.type][0];var i=c.Config.getTreasureJewelUpgradeConfig(this.vo.type)[this.vo.level+1];if(this.img_canLevelUp.visible=!1,i){var o=JSON.parse(i.costs);c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).checkEnough(o)&&(this.img_canLevelUp.visible=!0)}}this.img_chosen.visible=e.chosen},i);function i(e,t){var i=n.call(this)||this;return i.skinName="HeroMainView_HeroThingItem",i.type=e,i.clickFunction=t,i}__reflect(a.prototype,"TreasureBox")}(game=game||{}),function(a){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){var n=this;i.prototype.childrenCreated.call(this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,this.hide,this),this.bi_left.touchEnabled=!1,this.commonSourceJumpLabel.visible=!1,this.btn_putOff.visible=!1,this.btn_replace.horizontalCenter=0,this.btn_replace.skinName="skins.ButtonSkinYellow",this.btn_replace.label="激活",this.img_firstLine.parent.removeChild(this.img_firstLine),this.btn_replace.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.AppFacade.getInstance().retrieveProxy(a.HeroThingPy.N).TreasurePutOn(void 0,n.vo.hero.uuid,void 0,function(e){n.hide();var t=a.AppFacade.getInstance().retrieveProxy(a.HeroThingPy.N),i=n.vo,o=t.getHeroTreasuresByUuid(n.vo.hero.uuid)[0];a.AppFacade.getInstance().showSubView(a.HeroThingMediator.N,a.HeroThingMediator.SV.MAIN,{entityType:EEntityType.EEntityTypeTreasure,vo:o,hero:i.hero,source:a.HeroThingMainView.VIEW_SOURCE.HERO})})},this)},t.prototype.updateView=function(e){this.vo=e;var t=a.Config.getHeroTreasureConfig(),i=a.Config.getHeroTreasureConfig()[0];for(var o in t){var n=t[o];0==n.level&&(i=n)}this.lb_name.text=i.name,this.lb_name.textColor=COLOR_2_FONT_COLOR[i.color],this.bi_left.updateData({type:EEntityType.EEntityTypeTreasure,code:i.code,isNum:!0}),this.lb_desc.textFlow=[{text:"介绍\n",style:HEROTHING_ATTR_STYLE[0]},{text:"   "+(i.desc||"暂无介绍"),style:HEROTHING_ATTR_STYLE[1]}]},t);function t(e){var t=i.call(this)||this;return t.skinName="HeroThingMainViewSkin",t.vo=e,t}a.TreasureSpecialView=e,__reflect(e.prototype,"game.TreasureSpecialView")}(game=game||{}),function(i){var o,e=(__extends(t,o=BaseFull),t.prototype.onDestroy=function(){o.prototype.onDestroy.call(this),i.GameMVC.stockMed.hideAllSubView()},t.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.initTabbar(),this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()}},t.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="CommonTabWithTextSkin";var e=[];for(var t in this.CONFIG)e.push({text:this.CONFIG[t].text});this.tabbar.dataProvider=new eui.ArrayCollection(e),this.tabbar.selectedIndex=0,this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.updateView,this)},t.prototype.updateView=function(e){e&&null!=e.itemIndex&&(this.viewIndex=e.itemIndex),0==this.viewIndex?(i.GameMVC.immortalMed.hideSubView(i.ImmortalMed.SV.MARKET),i.GameMVC.stockMed.showSubView(i.StockMed.SV.MAIN)):(i.GameMVC.immortalMed.showSubView(i.ImmortalMed.SV.MARKET,{viewType:1==this.viewIndex?i.ImmortalMarketView.VIEW_TYPE.MARKET:i.ImmortalMarketView.VIEW_TYPE.BACKPACK}),i.GameMVC.stockMed.hideSubView(i.StockMed.SV.MAIN)),this.CommonDaTanChuKuang.blb_title.text=this.CONFIG[this.viewIndex].text},t);function t(){var e,t=o.call(this)||this;return t.viewIndex=0,t.CONFIG=((e={})[i.MainRankPanel.VIEW_TYPE.FIGHTCAP]={text:"股市"},e[i.MainRankPanel.VIEW_TYPE.LEVEL]={text:"市场"},e[i.MainRankPanel.VIEW_TYPE.GUILD]={text:"背包"},e),t.skinName="ImmortalMainViewSkin",t}i.ImmortalMainView=e,__reflect(e.prototype,"game.ImmortalMainView")}(game=game||{}),function(o){var t,e=(__extends(n,t=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.ImmortalMainView),this.addSubView(n.SV.MARKET,o.ImmortalMarketView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.MARKET_SELL_INFO_UPDATED,CN.MARKET_MARKET_INFO_UPDATED,CN.MARKET_LIKED_INFO_UPDATED,CN.HERO_IMMORTAL_UPDATE]},n.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.Immortal,!1).allow&&(o.GameMVC.immortalPy.GetIMAttentionInfo(),o.GameMVC.immortalPy.GetIMSellInfo());break;case CN.HERO_IMMORTAL_UPDATE:case CN.MARKET_LIKED_INFO_UPDATED:case CN.MARKET_SELL_INFO_UPDATED:case CN.MARKET_MARKET_INFO_UPDATED:var i=this.getSubView(n.SV.MARKET);i&&i.handleNotification(e.getName(),t)}},n.N="ImmortalMed",n.SV={MAIN:1,MARKET:2},n);function n(e){return void 0===e&&(e=null),t.call(this,n.N,e)||this}o.ImmortalMed=e,__reflect(e.prototype,"game.ImmortalMed")}(game=game||{}),function(i){var e=(t.registerAll=function(){(new n).register()},t);function t(){}i.ImmortalProcessor=e,__reflect(e.prototype,"game.ImmortalProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){var t=e.getBody().uuid;i.GameMVC.immortalPy.deleteLikedInfos([t]),i.GameMVC.immortalPy.deleteMarketInfos([t]),i.GameMVC.immortalPy.deleteSellingInfos([t])},a);function a(){return o.call(this,"immortalMarket.SellImmortalP",a)||this}i.SellImmortalP=n,__reflect(n.prototype,"game.SellImmortalP")}(game=game||{}),function(a){var i,n=(i=a.BaseVO,__extends(e,i),e.prototype.update=function(e){i.prototype.update.call(this,e),this.immortal?this.immortal.update(e.immortal):this.immortal=new a.HeroImmortalVO(e.immortal),this.dt=e.dt,this.attentionNum=e.attentionNum,this.price=e.price,this.avatar=e.avatar,this.name=e.name},e);function e(e){var t=i.call(this)||this;return e&&t.update(e),t}a.ImtSellInfoVO=n,__reflect(n.prototype,"game.ImtSellInfoVO");var t,o=(__extends(r,t=BaseProxy),r.prototype.getCostArrForPrice=function(e){var t=JSON.parse(a.Config.constConfig().ImmortalMarketPurchaseCosts.constValue)[0];return t[2]*=e,t},r.prototype.updateMarketInfos=function(e,t){var i=this;if(void 0===t&&(t=!1),t)for(var o in this.marketInfos)this.marketInfos[o].isExpire=!0;if(e.forEach(function(e){i.marketInfos[e.immortal.uuid]||(i.marketInfos[e.immortal.uuid]=new n),i.marketInfos[e.immortal.uuid].update(e)}),t)for(var o in this.marketInfos)this.marketInfos[o].isExpire&&delete this.marketInfos[o];a.AppFacade.getInstance().sendNotification(CN.MARKET_MARKET_INFO_UPDATED)},r.prototype.deleteMarketInfos=function(e){var t=this;e.forEach(function(e){delete t.marketInfos[e]}),a.AppFacade.getInstance().sendNotification(CN.MARKET_MARKET_INFO_UPDATED)},r.prototype.updateSellingInfos=function(e,t){var i=this;if(void 0===t&&(t=!1),t)for(var o in this.sellingInfos)this.sellingInfos[o].isExpire=!0;if(e.forEach(function(e){i.sellingInfos[e.immortal.uuid]||(i.sellingInfos[e.immortal.uuid]=new n),i.sellingInfos[e.immortal.uuid].update(e)}),t)for(var o in this.sellingInfos)this.sellingInfos[o].isExpire&&delete this.sellingInfos[o];a.AppFacade.getInstance().sendNotification(CN.MARKET_SELL_INFO_UPDATED)},r.prototype.deleteSellingInfos=function(e){var t=this;e.forEach(function(e){delete t.sellingInfos[e]}),a.AppFacade.getInstance().sendNotification(CN.MARKET_SELL_INFO_UPDATED)},r.prototype.updateLikedInfos=function(e,t){var i=this;if(void 0===t&&(t=!1),t)for(var o in this.likedInfos)this.likedInfos[o].isExpire=!0;if(e.forEach(function(e){i.likedInfos[e.immortal.uuid]||(i.likedInfos[e.immortal.uuid]=new n),i.likedInfos[e.immortal.uuid].update(e)}),t)for(var o in this.likedInfos)this.likedInfos[o].isExpire&&delete this.likedInfos[o];a.AppFacade.getInstance().sendNotification(CN.MARKET_LIKED_INFO_UPDATED)},r.prototype.deleteLikedInfos=function(e){var t=this;e.forEach(function(e){delete t.likedInfos[e]}),a.AppFacade.getInstance().sendNotification(CN.MARKET_LIKED_INFO_UPDATED)},r.prototype.GetImmortalMarketInfo=function(t,i){var o=this;Utils.Socket.send("immortalMarket","GetImmortalMarketInfo",t).then(function(e){o.updateMarketInfos(e.immortalSellList,1==t.pagination),o.totalPage=e.totalPagination,i&&i()})},r.prototype.GetIMSellInfo=function(t){var i=this;Utils.Socket.send("immortalMarket","GetIMSellInfo",{}).then(function(e){i.updateSellingInfos(e.sellList,!0),t&&t()})},r.prototype.GetIMAttentionInfo=function(t){var i=this;Utils.Socket.send("immortalMarket","GetIMAttentionInfo",{}).then(function(e){i.updateLikedInfos(e.attentionList,!0),t&&t()})},r.prototype.PurchaseImmortal=function(i,e,o){var n=this;Utils.Socket.send("immortalMarket","PurchaseImmortal",{uuid:i,price:e}).then(function(e){a.GameMVC.backpackPy.handleClientReward(e.clientReward),n.deleteMarketInfos([i]),n.deleteLikedInfos([i]),o&&o()}).catch(function(t){if(11164==t.err||11167==t.err)n.deleteMarketInfos([i]),n.deleteLikedInfos([i]);else if(11170==t.err){var e=n.getCostArrForPrice(t.price);a.GameMgr.getInstance().showCommonTipsWin({cost:[e],customTips:"商品价格已变为",costTips:"，是否仍购买该商品？",clickCB:function(e){e.type&&n.PurchaseImmortal(i,t.price,o)}})}})},r.prototype.SellImmortal=function(e,t){var i=this,o=e.isResell,n=e.uuid||e.info.immortal.uuid;Utils.Socket.send("immortalMarket","SellImmortal",{uuid:n,price:e.price,isResell:o}).then(function(e){o?(i.deleteMarketInfos([n]),i.deleteSellingInfos([n])):a.GameMVC.heroThingPy.deleteImmortalByUuid(n,1),i.updateSellingInfos(e.sellList),t&&t()})},r.prototype.CancelSellImmortal=function(e,t){var i=this,o=e.immortal.uuid;Utils.Socket.send("immortalMarket","CancelSellImmortal",{uuid:o}).then(function(e){i.deleteMarketInfos([o]),i.deleteSellingInfos([o]),t&&t()}).catch(function(e){11164!=e.err&&11167!=e.err||(i.deleteMarketInfos([o]),i.deleteSellingInfos([o]))})},r.prototype.FollowImmortal=function(t,i){var o=this,n=t.immortal.uuid;Utils.Socket.send("immortalMarket","FollowImmortal",{uuid:n}).then(function(e){e.isAttention?(t.attentionNum+=1,o.updateLikedInfos([t])):(t.attentionNum-=1,o.deleteLikedInfos([n])),i&&i()}).catch(function(e){11164!=e.err&&11167!=e.err||(o.deleteMarketInfos([n]),o.deleteLikedInfos([n]))})},r.N="ImmortalPy",r);function r(){var e=t.call(this,r.N)||this;return e.totalPage=0,e.marketInfos={},e.likedInfos={},e.sellingInfos={},e}a.ImmortalPy=o,__reflect(o.prototype,"game.ImmortalPy")}(game=game||{}),function(n){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),Utils.TouchUtils.addTouchListener(this.btn_confirm,function(){e.hide()}),this.updateView()},t.prototype.updateView=function(){var t=this;1==this.data.source?this.gp_layout.addChild(this._makeFilter(this.CONFIG[0])):2==this.data.source&&this.CONFIG.forEach(function(e){t.gp_layout.addChild(t._makeFilter(e))})},t.prototype._makeFilter=function(e){var t=new eui.Group;t.width=500;var i=new eui.Image("common_img_fengexian_02_png");i.horizontalCenter=0,t.addChild(i);var o=new eui.Label(e.name);o.size=22,o.bold=!0,o.textColor=15913814,o.horizontalCenter=0,o.y=20,t.addChild(o);var n=new eui.List;n.y=60;var a=new eui.TileLayout;a.requestedColumnCount=3,a.horizontalGap=28,a.verticalGap=15,n.layout=a,t.addChild(n);var r=e.getDatas();return n.requireSelection=!0,n.itemRendererSkinName="ImmortalFilterPanel_FilterItem",n.dataProvider=new eui.ArrayCollection(r),n.selectedIndex=r.length-1,t},t.prototype._getCurSelected=function(){var i=[];return this.gp_layout.$children.forEach(function(e){var t=e.$children[2];i.push(t.selectedItem.key)}),i},t.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.data.closeCB&&this.data.closeCB(this._getCurSelected())},t);function t(e){var t=i.call(this)||this;return t.CONFIG=[{name:"至宝种类",getDatas:function(){var e=[],t=n.Config.immortalConfig();for(var i in t){var o=t[i];e.push({key:o.subType,text:""+o.name})}return e.push({key:0,text:"全选"}),e}},{name:"至宝阶级",getDatas:function(){for(var e=[],t=1;t<6;t++)e.push({key:t,text:Utils.MathUtils.formatNumToCharacter(t)+" 阶"});return e.push({key:0,text:"全 选"}),e}},{name:"至宝孔位",getDatas:function(){for(var e=[],t=1;t<8;t++)e.push({key:t,text:Utils.MathUtils.formatNumToCharacter(t)+" 孔"});return e.push({key:0,text:"全 选"}),e}}],t.skinName="ImmortalFilterPanelSkin",t.data=e,t}n.ImmortalFilterPanel=e,__reflect(e.prototype,"game.ImmortalFilterPanel")}(game=game||{}),function(h){var t,i=(__extends(n,t=BaseView),n.prototype._initList=function(){this.ac_market=new eui.ArrayCollection,this.list_market.dataProvider=this.ac_market,this.list_market.itemRenderer=e,this.ac_backpack=new eui.ArrayCollection,this.list_backpack.dataProvider=this.ac_backpack,this.list_backpack.itemRenderer=s,this.list_backpack.addEventListener(eui.ItemTapEvent.ITEM_TAP,this._onBackpackItemTap,this)},n.prototype._initTabbar=function(){this.tabbar.itemRendererSkinName="TabBarItemSkin4",this.tabbar.dataProvider=new eui.ArrayCollection([{text:"购 买",type:n.VIEW_TYPE.MARKET},{text:"出 售",type:n.VIEW_TYPE.SELL},{text:"关 注",type:n.VIEW_TYPE.LIKE}]),this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this._onTabbarTap,this)},n.prototype._onTabbarTap=function(e){var t=e.item.type;if(this.curType!=t){switch(this._resetScrollerV(),this.curType){case n.VIEW_TYPE.MARKET:this._marketPage=0}this.updateView({viewType:t,fromTabbar:!0})}},n.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this._initList(),this._initTabbar(),this.addListener()},n.prototype.handleNotification=function(e,t){switch(e){case CN.MARKET_MARKET_INFO_UPDATED:this.curType==n.VIEW_TYPE.MARKET&&this._updateForMarket();break;case CN.MARKET_SELL_INFO_UPDATED:this.curType==n.VIEW_TYPE.SELL&&this._updateForSell();break;case CN.MARKET_LIKED_INFO_UPDATED:this.curType==n.VIEW_TYPE.MARKET?this._updateForMarket():this.curType==n.VIEW_TYPE.LIKE&&this._updateForLike();break;case CN.HERO_IMMORTAL_UPDATE:this.curType==n.VIEW_TYPE.BACKPACK&&this._updateForBackpack()}},n.prototype.updateView=function(e,t){if(void 0===t&&(t=!1),this.curType=e&&e.viewType||this.curType,this._adaptView(),this._clearTimer(),this.curType==n.VIEW_TYPE.MARKET){var i=!1;if(e&&e.fromTabbar||t){var o=Utils.TimerManager.getServerTime();(!this._lastFetchDt||o-this._lastFetchDt>=this.DT_THRESHOLD)&&(i=!0,this._lastFetchDt=o)}this._updateForMarket(i)}else this.curType==n.VIEW_TYPE.SELL?this._updateForSell():this.curType==n.VIEW_TYPE.LIKE?this._updateForLike(t):this.curType==n.VIEW_TYPE.BACKPACK&&this._updateForBackpack()},n.prototype._adaptView=function(){switch(this.btn_filter.visible=this.curType==n.VIEW_TYPE.MARKET,this.curType){case n.VIEW_TYPE.MARKET:this.tabbar.visible=!0,this.gp_market.visible=!0,this.gp_backpack.visible=!1,this.gp_market.height=887,this.tabbar.selectedIndex=0;break;case n.VIEW_TYPE.SELL:this.tabbar.visible=!0,this.gp_market.visible=!0,this.gp_backpack.visible=!0,this.gp_market.height=460,this.gp_backpack.height=420,this.tabbar.selectedIndex=1;break;case n.VIEW_TYPE.LIKE:this.tabbar.visible=!0,this.gp_market.visible=!0,this.gp_backpack.visible=!1,this.gp_market.height=887,this.tabbar.selectedIndex=2;break;case n.VIEW_TYPE.BACKPACK:this.tabbar.visible=!1,this.gp_market.visible=!1,this.gp_backpack.visible=!0,this.gp_backpack.height=927}},n.prototype._updateForMarket=function(e){if(void 0===e&&(e=!1),e)this.immortalPy.GetImmortalMarketInfo({sectionLevel:2,code:this._filterType,pagination:++this._marketPage});else{var t=this.immortalPy.marketInfos,i=this.immortalPy.likedInfos,o=this.immortalPy.sellingInfos,n=[];for(var a in t){var r=t[a],s={type:this.curType,info:r,liked:!!i[a],self:!!o[a]};n.push(s)}this.ac_market.replaceAll(n),this.gp_empty.visible=0==this.ac_market.source.length}},n.prototype._updateForSell=function(){var e=this,t=this.immortalPy.sellingInfos,i=[];for(var o in t){var n=t[o],a={type:this.curType,info:n};i.push(a)}this.ac_market.replaceAll(i),this.gp_empty.visible=0==this.ac_market.source.length;var r=[],s=h.GameMVC.heroThingPy.AllImmortalInfo,c=JSON.parse(h.Config.constConfig().ImmortalDealRequire.constValue);for(var o in s){var l=s[o];""==l.heroUuid&&l.sectionLevel==c[0]&&l.slotNum==c[1]&&(a={type:this.curType,info:l},r.push(a))}r.sort(function(e,t){if(e.info.code!=t.info.code)return e.info.code-t.info.code}),this.ac_backpack.replaceAll(r),this._timer||(this._timer=egret.setInterval(function(){e.list_market.$children.forEach(function(e){e.updateDt()})},this,1e3))},n.prototype._updateForLike=function(e){if(void 0===e&&(e=!1),e)this.immortalPy.GetIMAttentionInfo();else{var t=this.immortalPy.likedInfos,i=[];for(var o in t){var n=t[o],a={type:this.curType,info:n,liked:!!t[o]};i.push(a)}this.ac_market.replaceAll(i),this.gp_empty.visible=0==this.ac_market.source.length}},n.prototype._updateForBackpack=function(){var e=[],t=h.GameMVC.heroThingPy.AllImmortalInfo;for(var i in t){var o=t[i];if(""==o.heroUuid){var n={type:this.curType,info:o};e.push(n)}}e.sort(function(e,t){var i=e.info,o=t.info;return i.sectionLevel!=o.sectionLevel?o.sectionLevel-i.sectionLevel:i.slotNum!=o.slotNum?o.slotNum-i.slotNum:i.code!=o.code?i.code-o.code:void 0}),this.ac_backpack.replaceAll(e)},n.prototype._onBackpackItemTap=function(e){if(!e.itemRenderer.baseItem.touchEnabled){var t=e.item;PopUpManager.addPopUp({obj:new h.ImmortalSellPanel({vo:t.info})})}},n.prototype._resetScrollerV=function(){this.scl_market.stopAnimation(),this.scl_market.validateNow(),this.scl_market.viewport.scrollV=0,this.scl_backpack.stopAnimation(),this.scl_backpack.validateNow(),this.scl_backpack.viewport.scrollV=0},n.prototype._changeFilterType=function(e){this._filterType!=e&&(this._filterType=e,this._marketPage=0,this._resetScrollerV(),this._updateForMarket(!0))},n.prototype.addListener=function(){var i=this;Utils.TouchUtils.addTouchListener(this.btn_filter,function(){PopUpManager.addPopUp({obj:new h.ImmortalFilterPanel({source:1,closeCB:function(e){var t=e[0];i._changeFilterType(t)}})})}),this.scl_market.addEventListener(eui.UIEvent.CHANGE_END,function(){i.curType==n.VIEW_TYPE.MARKET&&i._marketPage<i.immortalPy.totalPage&&i.scl_market.viewport.scrollV==i.scl_market.viewport.contentHeight-i.scl_market.height&&(i.btn_more.visible=!0)},this),Utils.TouchUtils.addTouchListener(this.btn_more,function(){i.btn_more.visible=!1,i._updateForMarket(!0)})},n.prototype._clearTimer=function(){this._timer&&(egret.clearInterval(this._timer),this._timer=void 0)},n.prototype.perClose=function(){t.prototype.perClose.call(this),this._clearTimer()},n.prototype.getParentView=function(){return h.GameMVC.immortalMed.getSubView(h.ImmortalMed.SV.MAIN).gp_subview_container},n.VIEW_TYPE={MARKET:1,SELL:2,LIKE:3,BACKPACK:4},n);function n(){var e=t.call(this)||this;return e._marketPage=0,e._filterType=0,e._lastFetchDt=0,e.DT_THRESHOLD=30,e.immortalPy=h.GameMVC.immortalPy,e.skinName="ImmortalMarketViewSkin",e.scaleX=e.scaleY=1,e}h.ImmortalMarketView=i,__reflect(i.prototype,"game.ImmortalMarketView");var o,e=(o=eui.ItemRenderer,__extends(a,o),a.prototype.createChildren=function(){o.prototype.createChildren.call(this),this.baseItem=customui.BaseItemFactory.create(),this.gp_baseitem.addChild(this.baseItem)},a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.addListener()},a.prototype.dataChanged=function(){var e=this.data.info,t=e.immortal;this.baseItem.updateData({type:EEntityType.EEntityTypeImmortal,vo:t,isNum:!0}),this.lb_name.text=t.config.name,this.icon_cost.updateItem({cost:this.immortalPy.getCostArrForPrice(e.price),style:CommonIconStyle.RIGHT}),this.data.type==i.VIEW_TYPE.SELL?(this.gp_market.visible=!1,this.gp_sell.visible=!0,this._dt=e.dt+Number(h.Config.constConfig().MaxImmortalMarketSellCycle.constValue)-Utils.TimerManager.getServerTime(),this.updateDt(!0)):(this.gp_market.visible=!0,this.gp_sell.visible=!1,this.img_liked.visible=!!this.data.liked,this.img_popular.visible=10<=e.attentionNum,this.data.self?(this.btn_like.visible=!1,this.btn_purchase.visible=!1):(this.btn_like.visible=!0,this.btn_purchase.visible=!0,this.btn_like.label=this.data.liked?"取消关注":"关注"))},a.prototype.updateDt=function(e){void 0===e&&(e=!1),0<this._dt?(this.btn_reShelf.visible=this.btn_unShelf2.visible=!1,this.btn_unShelf.visible=!0,this.gp_dt.visible=!0,e||(this._dt-=1),this.blb_dt.text=Utils.TimerManager.getFormatBySecond1(this._dt)):(this.btn_reShelf.visible=this.btn_unShelf2.visible=!0,this.btn_unShelf.visible=this.gp_dt.visible=!1)},a.prototype.addListener=function(){var e=this;Utils.TouchUtils.addTouchListener(this.btn_like,function(){e.immortalPy.FollowImmortal(e.data.info)}),Utils.TouchUtils.addTouchListener(this.btn_purchase,function(){e.immortalPy.PurchaseImmortal(e.data.info.immortal.uuid,e.data.info.price)}),Utils.TouchUtils.addTouchListener(this.btn_reShelf,function(){PopUpManager.addPopUp({obj:new h.ImmortalSellPanel({info:e.data.info,resell:!0})})}),Utils.TouchUtils.addTouchListener(this.btn_unShelf,function(){e.immortalPy.CancelSellImmortal(e.data.info)}),Utils.TouchUtils.addTouchListener(this.btn_unShelf2,function(){e.immortalPy.CancelSellImmortal(e.data.info)})},a);function a(){var e=o.call(this)||this;return e.immortalPy=h.GameMVC.immortalPy,e.skinName="ImmortalMarketView_MarketItem",e}__reflect(e.prototype,"ImmortalMarketView_MarketItem");var r,s=(r=eui.ItemRenderer,__extends(c,r),c.prototype.createChildren=function(){r.prototype.createChildren.call(this),this.gp_root=new eui.Group,this.gp_root.width=this.gp_root.height=105,this.addChild(this.gp_root),this.baseItem=customui.BaseItemFactory.create(),this.gp_root.addChild(this.baseItem)},c.prototype.childrenCreated=function(){r.prototype.childrenCreated.call(this)},c.prototype.dataChanged=function(){this.baseItem.touchEnabled=this.data.type==i.VIEW_TYPE.BACKPACK,this.baseItem.updateData({type:EEntityType.EEntityTypeImmortal,vo:this.data.info,source:BASEITEM_SOURCE.BACKPACK})},c);function c(){return r.call(this)||this}__reflect(s.prototype,"ImmortalMarketView_BackpackItem")}(game=game||{}),function(l){var i,e=(__extends(t,i=BasePanel),t.prototype._initList=function(){this.ac_list=new eui.ArrayCollection,this.list_others.dataProvider=this.ac_list,this.list_others.itemRenderer=n},t.prototype.createChildren=function(){i.prototype.createChildren.call(this),this.baseItem=customui.BaseItemFactory.create(),this.gp_baseitem.addChild(this.baseItem)},t.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this._initList(),this.addListener(),this.data&&this.updateView(this.data)},t.prototype.updateView=function(e){var i=this;this.data=e;var t=this.data.vo||this.data.info.immortal;this.baseItem.updateData({type:EEntityType.EEntityTypeImmortal,vo:t}),this.lb_name.text=t.config.name,this.lb_level.text=t.sectionLevel+"阶"+t.slotNum+"孔";var o=l.Config.immortalUpsectionCosts(t.code,t.sectionLevel);JSON.parse(o.attr).forEach(function(e){var t=new eui.Label;t.bold=!0,t.textColor=16775908,t.size=20,t.text="+"+l.GeneralConfig.getAttrValue(e[1])+l.GeneralConfig.getAttrName(Number(e[0])),i.gp_attrs.addChild(t)}),this.batchNum.update({maxBuyNum:999999});var n=this.immortalPy.marketInfos,a=this.immortalPy.sellingInfos,r=[];for(var s in n){var c=n[s];a[s]||c.immortal.code==t.code&&r.push({info:c})}r.sort(function(e,t){return e.info.price-t.info.price}),this.ac_list.replaceAll(r),this.gp_empty.visible=0==r.length},t.prototype.addListener=function(){var e=this;Utils.TouchUtils.addTouchListener(this.btn_cancel,function(){e.hide()}),Utils.TouchUtils.addTouchListener(this.btn_sell,function(){e.data.resell?l.GameMVC.immortalPy.SellImmortal({info:e.data.info,price:e.batchNum.getCurNum(),isResell:!0},function(){e.hide()}):l.GameMVC.immortalPy.SellImmortal({uuid:e.data.vo.uuid,price:e.batchNum.getCurNum(),isResell:!1},function(){e.hide()})})},t);function t(e){var t=i.call(this)||this;return t.immortalPy=l.GameMVC.immortalPy,t.skinName="ImmortalSellPanelSkin",t.data=e,t}l.ImmortalSellPanel=e,__reflect(e.prototype,"game.ImmortalSellPanel");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(),this.gp_baseItem.addChild(this.baseItem)},a.prototype.dataChanged=function(){var e=this.data.info,t=e.immortal;this.baseItem.updateData({type:EEntityType.EEntityTypeImmortal,vo:t,isNum:!0}),this.lb_name.text=t.config.name,this.icon_cost.updateItem({cost:l.GameMVC.immortalPy.getCostArrForPrice(e.price),style:CommonIconStyle.RIGHT})},a);function a(){var e=o.call(this)||this;return e.skinName="ImmortalSellPanel_OthersItem",e}__reflect(n.prototype,"ImmortalSellPanel_OthersItem")}(game=game||{}),function(t){var i,e=(__extends(o,i=BaseMediator),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,t.LuckyTableMainView)},o.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.GENERAL_PASS_DAY]},o.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.GENERAL_PASS_DAY:case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.LuckyTurntable,!1).allow&&t.GameMVC.luckyTablePy.GetLuckyTurntable()}},o.N="LuckyTableMed",o.SV={MAIN:1},o);function o(e){return void 0===e&&(e=null),i.call(this,o.N,e)||this}t.LuckyTableMed=e,__reflect(e.prototype,"game.LuckyTableMed")}(game=game||{}),function(o){var e=(t.registerAll=function(){(new n).register()},t);function t(){}o.LuckyTableProcessor=e,__reflect(e.prototype,"game.LuckyTableProcessor");var i,n=(i=o.ProcessorBase,__extends(a,i),a.prototype.execute=function(e){var t=e.getBody(),i=o.GameMVC.luckyTablePy.tableInfo.times==t.info.times;o.GameMVC.luckyTablePy.updateInfo(t.info,i)},a);function a(){return i.call(this,"luckyTurntable.LuckyTurntableP",a)||this}o.LuckyTurntableP=n,__reflect(n.prototype,"game.LuckyTurntableP")}(game=game||{}),function(i){var o,n=(o=i.BaseVO,__extends(e,o),e.prototype.updateData=function(e){this.code=e.code,this.itemCode=e.itemCode,this.dt=e.dt},e);function e(e){var t=o.call(this)||this;return e&&t.updateData(e),t}__reflect(n.prototype,"LuckyTableItemVO");var a,t=(a=i.BaseVO,__extends(r,a),r.prototype.updateData=function(e){var t=this;this.itemList.splice(0),e.itemList.forEach(function(e){t.itemList.push(new n(e))}),this.nAutoRefreshDt=e.nAutoRefreshDt,this.times=e.times},r);function r(e){var t=a.call(this)||this;return t.itemList=[],e&&t.updateData(e),t}__reflect(t.prototype,"LuckyTableVO");var s,c=(__extends(l,s=BaseProxy),l.prototype.addNotice=function(){NoticeManager.registerCB(NT.LUCKY_TABLE,function(){var e=JSON.parse(i.Config.constConfig().LuckyTurntableCosts.constValue);return i.GameMVC.backpackPy.checkEnough(e)},this)},l.prototype.updateInfo=function(e,t){void 0===t&&(t=!1),this.tableInfo.updateData(e),i.AppFacade.getInstance().updateView(i.LuckyTableMed.N,i.LuckyTableMed.SV.MAIN,{refresh:t}),NoticeManager.updateNotice(NT.LUCKY_TABLE)},l.prototype.GetLuckyTurntable=function(){var t=this;Utils.Socket.send("luckyTurntable","GetLuckyTurntable",{}).then(function(e){t.updateInfo(e.info)})},l.prototype.Refresh=function(t){Utils.Socket.send("luckyTurntable","Refresh",{}).then(function(e){t&&t(e)})},l.prototype.Turn=function(t){Utils.Socket.send("luckyTurntable","Turn",{}).then(function(e){t&&t(e)})},l.N="LuckyTablePy",l);function l(){var e=s.call(this,l.N)||this;return e.tableInfo=new t,e.addNotice(),e}i.LuckyTablePy=c,__reflect(c.prototype,"game.LuckyTablePy")}(game=game||{}),function(a){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.activateComponent(),this.btn_refresh.btn_oppr.skinName="skins.ButtonSkinBlue",DragonBoneTools.playOnce({effectName:"common_zhuanpandeng_1",parent:this.gp_effect,loop:!0})},i.prototype.updateView=function(e){var s=this;if(this.rotating)this.waitingUpdate=!0;else{var t=this.proxy.tableInfo,c=a.Config.luckyTablePoolConfig();t.itemList.forEach(function(e,t){e.code;var i=e.itemCode,o=s["gp_Reward"+t];if(o&&!o.$children[0]){var n=customui.BaseItemFactory.create();o.addChild(n)}var a=o.$children[0];a.reset(),a.scaleX=a.scaleY=70/105,a.updateData({reward:JSON.parse(c[i].rewards)[0]});var r=e.dt&&!0;UIActionManager.setAbsGrey(o,r)});var i=JSON.parse(a.Config.constConfig().LuckyTurntableCosts.constValue);if(this.resorceBar.updateBar(i),this.dt=t.nAutoRefreshDt-Utils.TimerManager.getServerTime(),this.blb_time.text=Utils.TimerManager.getFormatBySecond1(this.dt),this.timer||(this.timer=egret.setInterval(function(){0<s.dt&&(s.blb_time.text=Utils.TimerManager.getFormatBySecond1(--s.dt))},this,1e3)),0==t.times?this.btn_refresh.updateData({cost:JSON.parse(a.Config.constConfig().LuckyTurntableRefreshCosts.constValue)[0],text:"刷新"}):this.btn_refresh.updateData({text:"刷新"}),e&&e.refresh){var o=-Utils.MathUtils.getRandomInt(360,720);DragonBoneTools.playOnce({effectName:"common_zhuanpanquan",parent:this.gp_effect}),this.rotateToAngle(o,function(){},1630)}}},i.prototype.rotateToIndex=function(e,t){if(!this.rotating){var i=e*this.itemAngle+this.itemAngle/2+360*this.FIXED_LAP;this.rotateToAngle(i,t)}},i.prototype.rotateToAngle=function(e,t,i){var o=this;void 0===i&&(i=5e3);for(var n=[],a=0;a<8;a++){var r=this["gp_Reward"+a];r&&n.push(r)}this.rotating=!0,GameRootLayer.gameLayer().switchTouchEnable(!1),this.gp_roll.rotation=this.gp_roll.rotation%360,egret.Tween.get(this.gp_roll,{onChange:function(){var t=360*(o.FIXED_LAP+1)-o.gp_roll.rotation;n.forEach(function(e){e.rotation=t})},onChangeObj:this}).to({rotation:e},i,function(e){return 1-Math.pow(1-e,3)}).call(function(){o.rotating=!1,GameRootLayer.gameLayer().switchTouchEnable(!0),t&&t()})},i.prototype.activateComponent=function(){var i=this;Utils.ComponentUtils.registerListener(this.btn_roll,egret.TouchEvent.TOUCH_TAP,function(){i.proxy.tableInfo.itemList.some(function(e){return 0==e.dt})?i.proxy.Turn(function(e){i.gp_effect.$children[0].visible=!1,DragonBoneTools.playOnce({effectName:"common_zhuanpandeng_2",parent:i.gp_effect,loop:!0}),i.rotateToIndex(e.info.resultCode-1,function(){i.waitingUpdate?(i.waitingUpdate=!1,i.updateView()):i.proxy.updateInfo(e.info),a.GameMVC.backpackPy.handleClientReward(e.clientReward),i.gp_effect.removeChildAt(1),i.gp_effect.$children[0].visible=!0})}):Utils.MsgUtils.addMidMsg("已获得所有奖励")},this),Utils.ComponentUtils.registerListener(this.btn_refresh,egret.TouchEvent.TOUCH_TAP,function(){function t(){i.proxy.Refresh(function(e){i.proxy.updateInfo(e.info);var t=-Utils.MathUtils.getRandomInt(360,720);DragonBoneTools.playOnce({effectName:"common_zhuanpanquan",parent:i.gp_effect}),i.rotateToAngle(t,function(){},1630)})}if(0==i.proxy.tableInfo.times){var e=JSON.parse(a.Config.constConfig().LuckyTurntableRefreshCosts.constValue);a.GameMgr.getInstance().showCommonTipsWin({cost:e,costTips:"刷新转盘？",needTipsToday:!0,source:"LUCKY_TABLE_REFRESH",cb:!0,clickCB:function(e){e.type&&t()}})}else t()},this),Utils.ComponentUtils.registerListener(this.btn_goto,egret.TouchEvent.TOUCH_TAP,function(){var e=JSON.parse(a.Config.constConfig().LuckyTurntableJumpCode.constValue),t=a.GameMVC.activityPy.allActivityData,i=!1;for(var o in e){var n=e[o];if(t[n]){i=!0,a.MainJumpConfig.jumpTo(),a.MainJumpConfig.jumpTo(MODULE.Activity+n);break}}i||Utils.MsgUtils.addMidMsg("暂无活动")},this),Utils.ComponentUtils.registerListener(this.btn_back,egret.TouchEvent.TOUCH_TAP,function(){a.MainJumpConfig.jumpTo()},this),Utils.ComponentUtils.registerListener(this.btn_guide,egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new a.HelpDialog({moduleId:MODULE.LuckyTurntable})})},this)},i.prototype.onDestroy=function(){this.timer&&egret.clearInterval(this.timer)},i);function i(){var e=t.call(this)||this;return e.FIXED_LAP=5,e.itemAngle=45,e.rotating=!1,e.curIndex=0,e.waitingUpdate=!1,e.proxy=a.GameMVC.luckyTablePy,e.skinName="LuckyTableMainViewSkin",e}a.LuckyTableMainView=e,__reflect(e.prototype,"game.LuckyTableMainView")}(game=game||{}),function(e){var t,i=(t=eui.Scroller,__extends(o,t),o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.removeChild(this.verticalScrollBar),this.removeChild(this.horizontalScrollBar),this.winWidth=Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),this.winHeight=Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale(),this.img_bg=new eui.Image,this.img_bg.horizontalCenter=0,this.addChildAt(this.img_bg,0)},o.prototype.updateBg=function(e){var i=this;RES.getResAsync(ResourceUtils.png(e),function(e){if(i.img_bg.source=e,i.viewport.contentWidth<=i.winWidth){var t=i.winWidth/i.img_bg.width;i.img_bg.width=i.winWidth,i.img_bg.height*=t}else t=i.winHeight/i.img_bg.height,i.img_bg.height=i.winHeight,i.img_bg.width*=t;i.img_bg.anchorOffsetX=i.img_bg.width/2,i.img_bg.anchorOffsetY=i.img_bg.height/2,i.img_bg.y=i.winHeight/2},this)},o);function o(){return t.call(this)||this}e.MultiLayerScroller=i,__reflect(i.prototype,"customui.MultiLayerScroller")}(customui=customui||{}),function(g){var t,e=(__extends(i,t=BaseProxy),i.prototype.addNotice=function(){NoticeManager.registerCB(NT.MAGICAL,this.checkNotice,this)},i.prototype.checkNotice=function(){var h=this,e=g.Config.allMagicalConfig(),t=[];for(var i in e){var o=e[i];t.push(o)}t.sort(function(e,t){return e.code-t.code});var p=Utils.UnlockMgr.checkPass(MODULE.MagicalUpGrade,!1).allow,d=Utils.UnlockMgr.checkPass(MODULE.MagicalUpSection,!1).allow,u=g.AppFacade.getInstance().retrieveProxy(g.BackpackPy.N);t.forEach(function(e,t){var i=e.code,o=h.getInfoByCode(i);if(o){var n=g.Config.magicalSectionConfig(i),a=(l=g.Config.magicalUpgradeConfig(i),n[o.sectionLevel+1]),r=0;r=a?a.magicalLevel:l[l.length-1].level;var s=l[o.level+1];if(s&&d)if(o.level==r){var c=JSON.parse(a.costs);u.checkEnough(c)?h.localNotice[t]=!0:h.localNotice[t]=!1}else c=JSON.parse(s.costs),u.checkEnough(c)?h.localNotice[t]=!0:h.localNotice[t]=!1;else h.localNotice[t]=!1}else{var l=g.Config.magicalUpgradeConfig(i)[0];u.checkEnough(JSON.parse(l.costs))&&p?h.localNotice[t]=!0:h.localNotice[t]=!1}});var n=!1;return this.localNotice.forEach(function(e){n=e||n}),n},i.prototype.updateMagicalDict=function(e,t){var i=this;void 0===t&&(t=!1),Array.isArray(e)||(e=[e]),e.forEach(function(e){if(i.allMagicalArtifactByUuid[e.uuid])i.allMagicalArtifactByUuid[e.uuid].update(e);else{var t=new g.MagicalVO(e);i.allMagicalArtifactByUuid[e.uuid]=t}e.pos&&(i.onFormationUuid=e.uuid)})},i.prototype.getInfoByCode=function(e){for(var t in this.allMagicalArtifactByUuid){var i=this.allMagicalArtifactByUuid[t];if(i.code==e)return i}},i.prototype.deteleByUuids=function(e){var t=this;e.forEach(function(e){delete t.allMagicalArtifactByUuid[e]})},i.prototype.GetMagicalInfo=function(){var t=this;Utils.Socket.send("magical","GetMagicalInfo",{}).then(function(e){t.log("获取神兵信息 GetMagicalInfoR",e),t.updateMagicalDict(e.magicalList)})},i.prototype.MagicalUpGrade=function(e){var t=this;Utils.Socket.send("magical","MagicalUpGrade",{uuid:e.uuid,num:e.num}).then(function(e){t.log("神兵升级 MagicalUpGradeR",e),t.updateMagicalDict(e.magical),g.AppFacade.getInstance().updateView(g.MagicalArtifactMediator.N,g.MagicalArtifactMediator.SV.MAIN)})},i.prototype.MagicalActivate=function(e){var t=this;Utils.Socket.send("magical","MagicalActivate",{code:e}).then(function(e){t.log("神兵激活 MagicalActivateR",e),g.AppFacade.getInstance().retrieveProxy(g.BackpackPy.N).handleClientReward(e.clientReward),g.AppFacade.getInstance().updateView(g.MagicalArtifactMediator.N,g.MagicalArtifactMediator.SV.MAIN)})},i.prototype.MagicalUpSection=function(e,t){var i=this;Utils.Socket.send("magical","MagicalUpSection",{uuid:e.uuid}).then(function(e){i.log("神兵升阶 MagicalUpSectionR",e),i.updateMagicalDict(e.magical),t&&t(),g.AppFacade.getInstance().updateView(g.MagicalArtifactMediator.N,g.MagicalArtifactMediator.SV.MAIN)})},i.prototype.MagicalPutOn=function(e,t){var i=this;Utils.Socket.send("magical","MagicalPutOn",{uuid:e.uuid,pos:1}).then(function(e){i.log("神兵上阵 MagicalPutOnR",e),i.updateMagicalDict(e.magicalList),g.AppFacade.getInstance().updateView(g.MagicalArtifactMediator.N,g.MagicalArtifactMediator.SV.MAIN),t&&t()})},i.prototype.MagicalPutDown=function(e){var t=this;Utils.Socket.send("magical","MagicalPutDown",{uuid:e.uuid}).then(function(e){t.log("神兵下阵 MagicalPutDownR",e),t.updateMagicalDict(e.magicalList),g.AppFacade.getInstance().updateView(g.MagicalArtifactMediator.N,g.MagicalArtifactMediator.SV.MAIN)})},i.N="MagicalArtifactPy",i);function i(){var e=t.call(this,i.N)||this;return e.localNotice=[],e.allMagicalArtifactByUuid={},e.onFormationUuid="",e.addNotice(),e}g.MagicalArtifactPy=e,__reflect(e.prototype,"game.MagicalArtifactPy")}(game=game||{}),function(y){var n,e=(__extends(t,n=BasePanel),t.prototype.onDestroy=function(){n.prototype.onDestroy.call(this),egret.Tween.removeTweens(this.img_model),Utils.AssetsMgr.destroyGroup("group_magical_artifact"),y.GameMVC.playerPy.GetPlayerInfo()},t.prototype.childrenCreated=function(){var i=this;n.prototype.childrenCreated.call(this),this.img_lock2.visible=!1,this.img_lock3.visible=!1,this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.hide()},this),this.list.itemRenderer=o,this.list.dataProvider=this.dataprovider,this.list.addItemTapEvent(function(e){i.dataprovider.getItemAt(i.curSelectIndex).chose=!1,i.curSelectIndex=e.itemIndex,i.dataprovider.getItemAt(i.curSelectIndex).chose=!0,i.dataprovider.refresh(),i.updateBaseInfo(),i.updateServerInfo(),i.updateHero()},this),DragonBoneTools.create("common_shenqihuoyan",function(e){e.x=this.effect.width/2-190,e.y=this.effect.height/2,e.animation.play(),this.effect.addChild(e)},this),DragonBoneTools.create("common_shenqihuoyan",function(e){e.x=this.effect.width/2+190,e.y=this.effect.height/2,e.animation.play(),this.effect.addChild(e)},this),DragonBoneTools.create("common_shenqizs",function(e){e.x=this.effect.width/2,e.y=this.effect.height/2,e.scaleX=e.scaleY=.9,e.animation.play(),this.effect.addChild(e)},this),this.btn_upgrade.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.config[i.curSelectIndex];if(e){y.Config.magicalSectionConfig(e.code),y.Config.magicalUpgradeConfig(e.code);var t=i.py.getInfoByCode(e.code);t?i.curLevel==i.maxLevel?y.AppFacade.getInstance().showSubView(y.MagicalArtifactMediator.N,y.MagicalArtifactMediator.SV.UP_SECTION_PANEL,{data:t}):i.py.MagicalUpGrade({uuid:t.uuid,num:1}):Utils.MsgUtils.addMidMsg("未拥有")}},this),this.btn_putOn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.config[i.curSelectIndex];if(e){y.Config.magicalSectionConfig(e.code),y.Config.magicalUpgradeConfig(e.code);var t=i.py.getInfoByCode(e.code);t?1==t.pos?i.py.MagicalPutDown({uuid:t.uuid}):i.py.MagicalPutOn({uuid:t.uuid}):Utils.MsgUtils.addMidMsg("未拥有")}},this),this.btn_activate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.config[i.curSelectIndex];e&&(i.backpackproxy.checkEnough(i.costs)?(i.isJiHuo=!0,DragonBoneTools.playOnce({effectName:"common_ty_jihuo",parent:i.img_model.parent,y:i.img_model.height-100}),i.py.MagicalActivate(e.code)):PopUpManager.addPopUp({obj:new y.BaseItemDetailView({type:i.costs[0][0],code:i.costs[0][1],showAccessNow:!0})}))},this),this.btn_comment.visible=!Utils.SDKMgr.getPerformConfig(44),this.btn_comment.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.config[i.curSelectIndex];y.AppFacade.getInstance().showSubView(y.MagicalArtifactMediator.N,y.MagicalArtifactMediator.SV.MAGIC_COMMENT,{info:{code:e.code}})},this),this.btn_master.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=0;for(var t in i.py.allMagicalArtifactByUuid)e+=i.py.allMagicalArtifactByUuid[t].level;y.AppFacade.getInstance().showSubView(y.HeroMediator.N,y.HeroMediator.SV.COMMON_LEVEL_MASTER,{title:"神器共鸣",config:y.Config.magicalMasterConfig(),totalLevel:e})},this),this.skillItem_1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.SkillDetailsPanel.visible=!0,i.SkillDetailsPanel.updateItem(i.skillItem_1.data)},this),this.skillItem_1.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.SkillDetailsPanel.visible=!1},this),this.skillItem_1.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.SkillDetailsPanel.visible=!1},this),this.skillItem_1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.SkillDetailsPanel.visible=!1},this),this.skillItem_2.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.SkillDetailsPanel.visible=!0,i.SkillDetailsPanel.updateItem(i.skillItem_2.data)},this),this.skillItem_2.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.SkillDetailsPanel.visible=!1},this),this.skillItem_2.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.SkillDetailsPanel.visible=!1},this),this.skillItem_2.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.SkillDetailsPanel.visible=!1},this),this.skillItem_3.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){i.SkillDetailsPanel.visible=!0,i.SkillDetailsPanel.updateItem(i.skillItem_3.data)},this),this.skillItem_3.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.SkillDetailsPanel.visible=!1},this),this.skillItem_3.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.SkillDetailsPanel.visible=!1},this),this.skillItem_3.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.SkillDetailsPanel.visible=!1},this),this.gp_attr.removeChildren();for(var e=1;e<=2;e++){var t=new y.HeroMainView_AttrItem(void 0);this.attrItems[e]=t,this.gp_attr.addChild(t)}this.skillItem_2.reset(),this.skillItem_3.reset(),egret.Tween.get(this.img_model,{loop:!0}).to({verticalCenter:-45},600).to({verticalCenter:-60},1e3)},t.prototype.jiHuoEffect=function(){},t.prototype.updateView=function(e){NoticeManager.updateNotice(NT.MAGICAL);var t=this.config[this.curSelectIndex],i=y.Config.magicalUpgradeConfig(t.code)[1];this.top_resourceBar.updateBar(i.costs),this.resBar_has.updateBar("[[3,30000005,10]]"),this.updateBaseInfo(),this.updateServerInfo(),this.updateBottomList(),this.updateHero()},t.prototype.updateHero=function(){var e=this.config[this.curSelectIndex],t=this.py.getInfoByCode(e.code);if(t&&t.heroUuid){var i=y.GameMVC.heroPy.allHeroByUuid[t.heroUuid];if(0!=i.dermaCode){var o=y.Config.getHeroDermaConfig()[i.dermaCode].avatar;this.baseitem_hero.updateData({uuid:t.heroUuid,type:EEntityType.EEntityTypeHero,effect:!0,isShowZhongZhu:!0,avatar:o,isShowEffect:!0})}else this.baseitem_hero.updateData({uuid:t.heroUuid,type:EEntityType.EEntityTypeHero,effect:!0,isShowZhongZhu:!0});this.baseitem_hero.visible=!0}else this.baseitem_hero.visible=!1},t.prototype.updateBaseInfo=function(){var e=this.config[this.curSelectIndex];e&&(this.lb_name.text=e.name,this.img_model.source=e.model+"_png",this.lb_desc.text="    "+(e.desc||"暂无简介"))},t.prototype.updateServerInfo=function(){var t=this,e=this.config[this.curSelectIndex];if(e){var i=y.Config.magicalSectionConfig(e.code),o=y.Config.magicalUpgradeConfig(e.code),n=this.py.getInfoByCode(e.code),a=!!n;this.effect.visible=a,UIActionManager.setAbsGrey(this.img_model,!a);var r=JSON.parse(o[0].skills),s=JSON.parse(o[0].skillUnlock);n?(this.gp_fight.visible=!0,this.blb_fightCap.text=""+n.fightCap):(n=new y.MagicalVO({code:e.code,level:0,sectionLevel:0,attr:e.initAttr,skillList:[{code:r[0]}],fightCap:0}),this.gp_fight.visible=!1),this.skillItem_1.updateItem(n.skillList[0]);var c=JSON.parse(n.attr),l={};Array.isArray(c)?c.forEach(function(e){l[e[0]]=e[1]}):l=c;for(var h=1,p=1;h<=4&&p<=2;h++)l[h]&&(this.attrItems[p].updateItem({type:h,num:l[h]||0}),p++);var d=i[n.sectionLevel+1],u=0;if(u=d?d.magicalLevel:o[o.length-1].level,this.lb_level.text=n.level+"/"+u,this.curLevel=n.level,this.maxLevel=u,a){this.btn_activate.visible=!1,this.btn_putOn.visible=!0;var g=o[n.level+1];if(g||d){if(this.btn_upgrade.visible=!0,this.curLevel==this.maxLevel)this.btn_maxLevel.visible=!0,this.gp_cost.visible=!1,this.btn_upgrade.skinName="skins.ButtonSkinYellow",this.btn_upgrade.label="进阶";else{this.btn_maxLevel.visible=!1,this.gp_cost.visible=!0,this.btn_upgrade.skinName="skins.ButtonSkinGreen",this.btn_upgrade.label="升级";var f=JSON.parse(g.costs);this.gp_cost.removeChildren(),f.forEach(function(e){t.gp_cost.addChild(new customui.CommonIconWithNum({cost:e,style:CommonIconStyle.RIGHT}))})}this.btn_maxLevel.bottom=77}else this.btn_upgrade.visible=!1,this.gp_cost.visible=!1,this.btn_maxLevel.visible=!0,this.btn_maxLevel.bottom=41;this.lb_way.text="",r=n.level==i[n.sectionLevel].magicalLevel?JSON.parse(i[n.sectionLevel].skills):JSON.parse(o[n.level].skills)}else{this.btn_activate.visible=!0,this.btn_maxLevel.visible=!1,this.btn_upgrade.visible=!1;var _=o[0],m=(f=JSON.parse(_.costs),y.AppFacade.getInstance().retrieveProxy(y.BackpackPy.N));this.btn_activate.updateData({text:"激活"}),m.checkEnough(f)?(this.lb_way.text="",UIActionManager.setGrey(this.btn_activate,!1),this.btn_activate.touchEnabled=!0,this.btn_activate.touchChildren=!0):(this.lb_way.text=""+e.wayDesc,UIActionManager.setGrey(this.btn_activate,!0),this.btn_activate.touchEnabled=!1,this.btn_activate.touchChildren=!1),this.costs=f,this.gp_cost.visible=!1,this.btn_putOn.visible=!1}1==n.pos?(this.btn_putOn.icon="_btn_lb_m_json.common_icon_xiexia",this.btn_putOn.label="卸下"):(this.btn_putOn.label="佩戴",this.btn_putOn.icon="_btn_lb_m_json.common_icon_peidai"),this.skillItem_2.updateItem({code:r[1],tips:i[s[1]].magicalLevel+"级进阶解锁"}),this.skillItem_3.updateItem({code:r[2],tips:i[s[2]].magicalLevel+"级进阶解锁"}),UIActionManager.setAbsGrey(this.skillItem_2,!(n.sectionLevel>=s[1])),UIActionManager.setAbsGrey(this.skillItem_3,!(n.sectionLevel>=s[2]))}},t.prototype.updateBottomList=function(){var e=[],t=y.AppFacade.getInstance().retrieveProxy(y.BackpackPy.N);for(var i in this.config){var o=this.config[i],n=o.code,a=this.py.getInfoByCode(n);if(o.chose=!1,a)o.activate=!0,1==a.pos?(o.puton=!0,this.initComplete||(this.curSelectIndex=parseInt(i))):o.puton=!1,o.canActivate=!1;else{var r=y.Config.magicalUpgradeConfig(n)[0];t.checkEnough(JSON.parse(r.costs))?o.canActivate=!0:o.canActivate=!1,o.activate=!1,o.puton=!1}o.notice=this.py.localNotice[i],e.push(o)}e[this.curSelectIndex].chose=!0,this.dataprovider.replaceAll(e),this.initComplete||(this.list.validateNow(),this.initComplete=!0,this.list.changeTo({itemIndex:this.curSelectIndex}))},t);function t(){var e=n.call(this)||this;e.backpackproxy=y.AppFacade.getInstance().retrieveProxy(y.BackpackPy.N),e.py=y.AppFacade.getInstance().retrieveProxy(y.MagicalArtifactPy.N),e.curSelectIndex=0,e.dataprovider=new eui.ArrayCollection,e.attrItems=new Array,e.curLevel=0,e.maxLevel=0,e.costs=[[]],e.isJiHuo=!1,Utils.AssetsMgr.loadGroup("group_magical_artifact"),e.skinName="MagicalArtifactViewSkin";var t=y.Config.allMagicalConfig();for(var i in e.config=[],t){var o=t[i];e.config.push(o)}return e.config.sort(function(e,t){return e.code-t.code}),e}y.MagicalArtifactView=e,__reflect(e.prototype,"game.MagicalArtifactView");var i,o=(i=eui.ItemRenderer,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.gp_main.scaleX=this.gp_main.scaleY=a.choseScale},a.prototype.dataChanged=function(){this.data.activate?(this.img_bg.source="shenbing_img_diyipeidai_png",this.data.puton?(this.bm_tip.text="已佩戴",this.bm_tip.verticalCenter=-79.5):this.bm_tip.text="",UIActionManager.setGrey(this.img_model,!1)):this.data.canActivate?(this.img_bg.source="shenbing_img_dikejihuo_png",this.bm_tip.text="",this.bm_tip.verticalCenter=0,UIActionManager.setGrey(this.img_model,!1)):(this.img_bg.source="shenbing_img_diweijihuo_png",this.bm_tip.verticalCenter=0,this.bm_tip.text="未激活",UIActionManager.setGrey(this.img_model,!0)),this.img_model.source=this.data.model+"_png",this.lb_name.text=this.data.name,this.gp_main.scaleX=this.gp_main.scaleY=this.data.chose?1:a.choseScale},a.itemWidth=164,a.choseScale=.85,a);function a(){var e=i.call(this)||this;return e.skinName="MagicalItem",e}__reflect(o.prototype,"MagicalItem")}(game=game||{}),function(l){var i,e=(i=l.CommonComment,__extends(t,i),t.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.btn_zan.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.dianZan(e)},this),this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide()},this),this.skill_panel.visible=!1,this.tinput_text.textDisplay.size=24,this.initMidView(),this.initBottomView(),egret.Tween.get(this.img_model,{loop:!0}).to({verticalCenter:25},600).to({verticalCenter:10},1e3),this.timer=egret.setInterval(function(){t.getPlayerTupMagic()},this,3e4)},t.prototype.updateView=function(e){var t=e&&e.info;this.params=l.Config.allMagicalConfig()[t.code],this.playerStatus(),this.getPlayerTupMagic(),this.once(egret.Event.ENTER_FRAME,this.initTopView,this)},t.prototype.playerStatus=function(){var t=this,e=l.AppFacade.getInstance().retrieveProxy(l.LoginPy.N);Utils.Http.toGet({action:"get_HeroStatus",code:this.params.code,player_id:e.playerProxy.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,project:Utils.agentConfig.ProjectName}).then(function(e){t.lb_zanCounts.text=""+e.num,t.zanNumber=e.num,t.isZan=e.status}).catch(function(e){console.log("----get_MagicStatus",e)})},t.prototype.initTopView=function(){this.lb_title.text=this.params.name,this.img_model.source=ResourceUtils.png(this.params.model),this.lb_desc.text="    "+this.params.desc;var e=l.Config.magicalUpgradeConfig(this.params.code),t=e[e.length-1].level;this.lb_lv.text=t+"/"+t,this.lb_zanCounts.text=this.zanNumber.toString();var i=l.Config.magicalSectionConfig(this.params.code),o=i[0];for(var n in i){var a=i[n];a.level>o.level&&(o=a)}var r=JSON.parse(o.skills);this.skillItem_0.updateItem({code:r[0]}),this.bindSkillPanelClick({target:this.skillItem_0,x:34,bottom:200}),this.skillItem_1.updateItem({code:r[1]}),this.bindSkillPanelClick({target:this.skillItem_1,x:34,bottom:200}),this.skillItem_2.updateItem({code:r[2]}),this.bindSkillPanelClick({target:this.skillItem_2,x:34,bottom:200}),this.updateAttr()},t.prototype.bindSkillPanelClick=function(t){var i=this,o=t.target;o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){if(o.data&&o.data.code)for(var e in i.skill_panel.visible=!0,i.skill_panel.updateItem({code:o.data.code}),t)"target"!=e&&(i.skill_panel[e]=t[e])},this),o.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.skill_panel.visible=!1},this),o.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.skill_panel.visible=!1},this),o.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.skill_panel.visible=!1},this)},t.prototype.dianZan=function(e){0==this.isZan?(Utils.MsgUtils.addNumberEffect("+1",this.btn_zan,e.stageX,e.stageY,1),this.thumbsUp()):Utils.MsgUtils.addMidMsg("已赞过此神器")},t.prototype.updateAttr=function(){var e=this.params,t=l.Config.magicalUpgradeConfig(this.params.code),i=l.Config.magicalSectionConfig(this.params.code),o=[],n=JSON.parse(e.initAttr),a=JSON.parse(t[t.length-1].attr),r=JSON.parse(i[i.length-1].attr);for(var s in o=l.GeneralConfig.AttrAddAttr(o,n),o=l.GeneralConfig.AttrAddAttr(o,a),o=l.GeneralConfig.AttrAddAttr(o,r))o[s][1]=Math.floor(o[s][1]);o.sort(function(e,t){return e[0]-t[0]}),this.gp_upgrade_attr.removeChildren();for(var c=1;c<=4;c++)o[c-1]&&this.gp_upgrade_attr.addChild(new l.HeroMainView_AttrItem({type:c,num:o[c-1][1]}))},t.prototype.thumbsUp=function(){var t=this,e=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N);Utils.Http.toGet({action:"set_HerothumbsUp",moduleType:EEntityType.EEntityTypeHeroArtifact,code:this.params.code,player_id:e.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,project:Utils.agentConfig.ProjectName,server_id:this.loginProxy.serverSelect.s_id,area:this.loginProxy.serverSelect.area}).then(function(e){console.log("set_HerothumbsUp"+e),t.playerStatus()}).catch(function(e){console.log("set_HerothumbsUp"+e)})},t.prototype.initMidView=function(){this.list=new eui.List;var e=new eui.TileLayout;e.horizontalGap=5,e.requestedColumnCount=1,this.list.layout=e,this.list.itemRenderer=n,this.sl_center.viewport=this.list,this.sl_center.scrollPolicyH=eui.ScrollPolicy.OFF,this.sl_center.scrollPolicyV=eui.ScrollPolicy.AUTO},t.prototype.initBottomView=function(){this.btn_send.addEventListener(egret.TouchEvent.TOUCH_TAP,this.playerTupMagic,this)},t.prototype.playerTupMagic=function(){Utils.MsgUtils.addMidMsg("评论功能维护中")},t.prototype.getPlayerTupMagic=function(s){var c=this;if(s&&0<this.array.length&&s.params.type==l.HeroCommentView.commentType.DIANZAN)return s.params.info,this.array.sort(function(e,t){return c.sortByTime(e,t)}),this.sortByLike(),void this.list.dataProvider.replaceAll(this.array);Utils.Http.toGet({action:"get_PlayerTup_hero",code:this.params.code,player_id:this.playerPy.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,project:Utils.agentConfig.Project}).then(function(e){for(var t in c.commentNum=0,c.array=[],e)if(e[t].content&&e[t].player_id&&e[t].name){++c.commentNum;var i={code:c.params.code,id:e[t].player_id,name:e[t].name,head:e[t].head,content_id:t,content:e[t].content,num:Number(e[t].num),tup_player:e[t].tup_player,time:e[t].createTime,strTime:Number(e[t].strTime),serverId:e[t].area};c.array.push(i)}if(c.array.sort(function(e,t){return c.sortByTime(e,t)}),c.origin_arr.length<=0)for(var o=0,n=c.array;o<n.length;o++)t=n[o],c.origin_arr.push(t),c.commonArr.push(t);if(c.newArr=[],c.origin_arr.length!=c.array.length)for(var a=c.array.length-c.origin_arr.length,r=0;r<a;)c.newArr.push(c.array[r]),++r;s&&s.priority?c.commentsFloatingEffect({priority:s.priority,id:s.id}):c.commentsFloatingEffect(),c.sortByLike(),c.list.dataProvider=new eui.ArrayCollection(c.array),c.gp_null.visible=0==c.commentNum})},t.prototype.onDestroy=function(){egret.Tween.removeTweens(this.img_model),egret.clearInterval(this.timer),i.prototype.onDestroy.call(this)},t.commentType={PINGLUN:1,DIANZAN:2},t);function t(e){var t=i.call(this)||this;return t.array=[],t.zanNumber=0,t.commentNum=0,t.playerPy=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),t.loginProxy=l.AppFacade.getInstance().retrieveProxy(l.LoginPy.N),t.skinName="MagicCommentSkin",t}l.MagicCommentView=e,__reflect(e.prototype,"game.MagicCommentView");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){var t=this;o.prototype.childrenCreated.call(this);var e=this.btn_love.labelDisplay;e.size=19,e.stroke=1,this.btn_love.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){t.playerTupMagic(e)},this)},a.prototype.dataChanged=function(){this.lb_time.text="["+this.data.time+"]",this.lb_comments.text=""+this.data.content,this.lb_playerName.text=this.data.name,this.playerHead.updateData({vo:{level:1,avatar:this.data.head}}),this.btn_love.labelDisplay.text=this.data.num.toString(),this.data.tup_player?(UIActionManager.setGrey(this.btn_love,!0),this.btn_love.touchEnabled=!1):(UIActionManager.setGrey(this.btn_love,!1),this.btn_love.touchEnabled=!0)},a.prototype.playerTupMagic=function(t){var i=this,o=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),e=l.AppFacade.getInstance().retrieveProxy(l.LoginPy.N);Utils.Http.toGet({action:"set_PlayerTup_hero",moduleType:EEntityType.EEntityTypeHeroArtifact,code:this.data.code,player_id:this.data.id,name:this.data.name,content:this.data.content,head:this.data.head,type:l.HeroCommentView.commentType.DIANZAN,tup_player:o.playerInfoVO.playerId,os_code:Utils.DeviceUtils.getPlatform(),platform:Utils.agentConfig.AgentCode,subPlatform:Utils.agentConfig.channelName||"",project:Utils.agentConfig.ProjectName,server_id:e.serverSelect.s_id,area:this.data.serverId,from_server_id:e.serverSelect.area}).then(function(e){Utils.MsgUtils.addNumberEffect("+1",i.btn_love,t.stageX,t.stageY,-1),++i.data.num,i.data.tup_player=o.playerInfoVO.playerId,l.AppFacade.getInstance().sendNotification(CN.MAGICCOMMENT_UPDATE,{info:i.data,type:l.HeroCommentView.commentType.DIANZAN})}).catch(function(e){console.log("set_PlayerTup_magic"+e)})},a);function a(){var e=o.call(this)||this;return e.skinName="CommentItemSkin",e}__reflect(n.prototype,"magicCommentItem")}(game=game||{}),function(i){var e=(t.registerAll=function(){(new n).register()},t);function t(){}i.MagicalProcessor=e,__reflect(e.prototype,"game.MagicalProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){var t=e.getBody();console.log("MagicalInfoP",t),i.AppFacade.getInstance().retrieveProxy(i.MagicalArtifactPy.N).updateMagicalDict(t.magicalList)},a);function a(){return o.call(this,"magical.MagicalInfoP",a)||this}i.MagicalInfoP=n,__reflect(n.prototype,"game.MagicalInfoP")}(game=game||{}),function(u){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.list_root.dataProvider=new eui.ArrayCollection,this.list_root.itemRenderer=o,this.CommonDaTanChuKuang.blb_title.text="神器佩戴",this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.updateView()},t.prototype.updateView=function(){var n=this,e=u.Config.allMagicalConfig(),t=[],i=0;for(var o in e){var a=u.GameMVC.magicalArtifactPy.getInfoByCode(e[o].code),r=u.Config.magicalUpgradeConfig(e[o].code),s=JSON.parse(r[0].skills),c=void 0,l=!(c={});a?(c=a,l=!0):c={code:e[o].code,level:0,sectionLevel:0,attr:e[o].initAttr,skillList:[{code:s[0]}],fightCap:0},l&&(t.push({vo:c,curHeroUuid:this.params.heroUuid,hasActivate:l,index:i,updateView:function(){n.updateView()},operationCB:this.params&&this.params.operationCB,updateSkillPanel:function(e,t,i,o){n.updateSkillPanel(e,t,i,o)}}),i++)}this.list_root.dataProvider.replaceAll(t)},t.prototype.updateSkillPanel=function(e,t,i,o){if(t){this.SkillDetailsPanel.visible=!0;var n=this.sl_root.viewport.scrollV,a=166*parseInt(e)-n-27;this.SkillDetailsPanel.top=a,this.SkillDetailsPanel.updateItem({code:i,tips:o})}else this.SkillDetailsPanel.visible=!1},t);function t(e){var t=i.call(this)||this;return t.skinName="MagicPutOnPanel",t.params=e,t}u.MagicPutOnPanel=e,__reflect(e.prototype,"game.MagicPutOnPanel");var n,o=(n=eui.ItemRenderer,__extends(a,n),a.prototype.childrenCreated=function(){var o=this;n.prototype.childrenCreated.call(this),this.gp_attrs.removeChildren();for(var e=1;e<=2;e++){var t=new u.HeroMainView_AttrItem(void 0);this.attrItems[e]=t,this.gp_attrs.addChild(t)}this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(o.data.operationCB)o.data.operationCB(o.data);else if(o.data.hasActivate){function t(){var e="PutMagicalOn";i.heroUuid==o.data.curHeroUuid&&(e="PutMagicalDown"),Utils.Socket.send("magical",e,{uuid:i.uuid,heroUuid:o.data.curHeroUuid}).then(function(e){u.GameMVC.magicalArtifactPy.updateMagicalDict(e.magicalList,!1),o.data.updateView(),u.GameMVC.heroMed.updateView(u.HeroMediator.SV.MAIN),u.GameMVC.heroMed.updateView(u.HeroMediator.SV.HERO_QUICK_TRAIN)})}var i=o.data.vo;i.heroUuid&&i.heroUuid!=o.data.curHeroUuid?u.GameMgr.getInstance().showCommonTipsWin({commonTips:"该神器已佩戴于其它英雄，请确认是否继续佩戴？",clickCB:function(e){1===e.type&&t()}}):t()}else Utils.MsgUtils.addMidMsg("神兵未激活")},this),this.skillItem_1.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){o.data.updateSkillPanel(o.data.index,!0,o.skillItem_1.data.code,o.skillItem_1.data.tips)},this),this.skillItem_1.addEventListener(egret.TouchEvent.TOUCH_END,function(){o.data.updateSkillPanel(o.data.index,!1)},this),this.skillItem_1.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){o.data.updateSkillPanel(o.data.index,!1)},this),this.skillItem_1.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){o.data.updateSkillPanel(o.data.index,!1)},this),this.skillItem_2.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){o.data.updateSkillPanel(o.data.index,!0,o.skillItem_2.data.code,o.skillItem_2.data.tips)},this),this.skillItem_2.addEventListener(egret.TouchEvent.TOUCH_END,function(){o.data.updateSkillPanel(o.data.index,!1)},this),this.skillItem_2.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){o.data.updateSkillPanel(o.data.index,!1)},this),this.skillItem_2.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){o.data.updateSkillPanel(o.data.index,!1)},this)},a.prototype.dataChanged=function(){var e=this.data.vo,t=(e.level,e.sectionLevel,u.Config.allMagicalConfig()[e.code]);this.lb_magicName.text=t.name;var i=u.Config.magicalUpgradeConfig(t.code),o=u.Config.magicalSectionConfig(t.code),n=JSON.parse(i[0].skillUnlock),a=JSON.parse(i[0].skills),r=JSON.parse(e.attr),s={};Array.isArray(r)?r.forEach(function(e){s[e[0]]=e[1]}):s=r;for(var c=1,l=1;c<=4&&l<=2;c++)s[c]&&(this.attrItems[l].updateItem({type:c,num:s[c]||0}),l++);if(a=e.level==o[e.sectionLevel].magicalLevel?JSON.parse(o[e.sectionLevel].skills):JSON.parse(i[e.level].skills),this.skillItem_1.updateItem(e.skillList[0]),this.skillItem_1.updateItem({code:a[1],tips:e.sectionLevel>=n[1]?"":o[n[1]].magicalLevel+"级进阶解锁"}),this.skillItem_2.updateItem({code:a[2],tips:e.sectionLevel>=n[2]?"":o[n[2]].magicalLevel+"级进阶解锁"}),UIActionManager.setAbsGrey(this.skillItem_1,!(e.sectionLevel>=n[1])),UIActionManager.setAbsGrey(this.skillItem_2,!(e.sectionLevel>=n[2])),this.btn_ope.label="",this.data.hasActivate?(UIActionManager.setAbsGrey(this.btn_ope,!1),e.heroUuid==this.data.curHeroUuid?(this.btn_ope.skinName="skins.ButtonSkinBlue",this.btn_ope.label="卸下"):(this.btn_ope.skinName="skins.ButtonSkinYellow",this.btn_ope.label="佩戴")):(UIActionManager.setAbsGrey(this.btn_ope,!0),this.btn_ope.skinName="skins.ButtonSkinYellow",this.btn_ope.label="佩戴"),this.lb_heroName.text="",e.heroUuid){var h=u.GameMVC.heroPy.allHeroByUuid[e.heroUuid],p=u.Config.allHeroConfig()[h.code];this.lb_heroName.text="（"+p.name+"已佩戴）"}var d=JSON.parse(i[0].costs);this.baseitem.updateData({reward:d[0]}),this.baseitem.blb_num.text=e.level+""},a);function a(){var e=n.call(this)||this;return e.attrItems=new Array,e.skinName="MagicPutOnPanelItem",e}u.MagicPutOnPanelItem=o,__reflect(o.prototype,"game.MagicPutOnPanelItem")}(game=game||{}),function(_){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.addListener(),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;this.magicalArtifactPy.MagicalUpSection({uuid:this.data.uuid},function(){e.hide()})},this),this.resource_bar.visible=!0},i.prototype.addListener=function(){this.skill_item.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.showSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_END,this.hideSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.hideSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.hideSkillDetail,this)},i.prototype.initList=function(){this.attr_list.itemRendererSkinName="HeroUpsectionPanel_AttrItem"},i.prototype.updateView=function(e){var t=this;this.data=e.data,this.data.level;var i=_.Config.magicalSectionConfig(this.data.code),o=(_.Config.allMagicalConfig()[this.data.code],_.Config.magicalUpgradeConfig(this.data.code)),n=i[this.data.sectionLevel+1],a=i[this.data.sectionLevel],r=i[this.data.sectionLevel+2],s=[],c=0;for(var l in o){var h=o[l];h.level>c&&(c=h.level)}s.push({desc:"等级上限：",before:n.magicalLevel,after:Math.min(c,r&&r.magicalLevel||9999999)});var p=JSON.parse(n.attr),d=JSON.parse(a&&a.attr),u=JSON.parse(this.data.attr);p.forEach(function(t){var i=0;d.forEach(function(e){t[0]==e[0]&&(i=e[1])});var e={desc:AttrConfig[t[0]].name+"：",before:Math.floor(Number(_.GeneralConfig.getAttrValue(u[t[0]]))).toString()};e.after=Math.floor(Number(e.before)+Number(_.GeneralConfig.getAttrValue(t[1]))-Number(_.GeneralConfig.getAttrValue(i))).toString(),s.push(e)}),this.attr_list.dataProvider=new eui.ArrayCollection(s);var g=n.skillShow;g?(this.gp_unlock.visible=!0,this.skill_item.updateItem({code:g}),this.skillDetailPanel.updateItem({code:g})):this.gp_unlock.visible=!1;var f=JSON.parse(n.costs);this.resource_bar.updateBar(f),f.forEach(function(e){t.gp_cost.addChild(new customui.CommonIconWithNum({cost:e,showEnough:!0,style:CommonIconStyle.RIGHT}))})},i.prototype.showSkillDetail=function(){this.skillDetailPanel.visible=!0},i.prototype.hideSkillDetail=function(){this.skillDetailPanel.visible=!1},i);function i(){var e=t.call(this)||this;return e.skinName="HeroUpsectionSkin",e.heroPy=_.AppFacade.getInstance().retrieveProxy(_.HeroPy.N),e.magicalArtifactPy=_.AppFacade.getInstance().retrieveProxy(_.MagicalArtifactPy.N),e}_.MagicUpsectionPanel=e,__reflect(e.prototype,"game.MagicUpsectionPanel")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.MountMainView),this.addSubView(n.SV.UP_STAR,i.MountUpstarPanel),this.addSubView(n.SV.UP_STAR_RESULT,i.MountUpstarResultPanel)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.MOUNT_UPDATEMAIN,CN.MOUNT_UPDATESTAR]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.Horse,!1).allow&&this.proxy.GetHorseInfo();break;case CN.MOUNT_UPDATEMAIN:(t=this.getSubView(n.SV.MAIN))&&t.updateView();break;case CN.MOUNT_UPDATESTAR:var t;(t=this.getSubView(n.SV.UP_STAR))&&t.updateInfo()}},n.N="MountMediator",n.SV={MAIN:1,UP_STAR:2,UP_STAR_RESULT:3},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.MountPy.N),t}i.MountMediator=e,__reflect(e.prototype,"game.MountMediator")}(game=game||{}),function(e){var t=(i.registerAll=function(){},i);function i(){}e.MountProcessor=t,__reflect(t.prototype,"game.MountProcessor")}(game=game||{}),function(g){var t,e=(__extends(i,t=BaseProxy),i.prototype.addNotice=function(){NoticeManager.registerCB(NT.MOUNT_ACTIVATE,this.checkNoticeByActivate,this),NoticeManager.registerCB(NT.MOUNT_UPDATE,this.checkNoticeByLevel,this),NoticeManager.registerCB(NT.MOUNT_UPSTAR,this.checkNoticeByStar,this),NoticeManager.setChildType(NT.MOUNT,[NT.MOUNT_ACTIVATE,NT.MOUNT_UPDATE,NT.MOUNT_UPSTAR])},i.prototype.checkNoticeByActivate=function(){for(var e=!1,t=g.Config.horseConfig(),i=this.allMountByUuid,o=0;o<t.length;o++){var n=!1;for(var a in i)if(i[a].code==t[o].code){n=!0;break}if(!n){var r=JSON.parse(t[o].costs);if(e=this.judgeIsEnough(r))return e}}return e},i.prototype.checkNoticeByLevel=function(){var e=!1,t=this.allMountByUuid;for(var i in t){var o=g.Config.horseGradeConfigByCode(t[i].code);if(t[i].level<o.length-1){for(var n=t[i].level+1,a=void 0,r=0;r<o.length;r++)if(n==o[r].level){a=o[r];break}if(a&&a.costs){var s=JSON.parse(a.costs);if(e=this.judgeIsEnough(s))return e}}}return e},i.prototype.checkNoticeByStar=function(){var e=!1,t=this.allMountByUuid;for(var i in t){var o=g.Config.horseStarConfigByCode(t[i].code);if(t[i].starLevel<o.length-1){for(var n=t[i].starLevel+1,a=void 0,r=0;r<o.length;r++)if(n==o[r].level){a=o[r];break}if(a&&a.costs){var s=JSON.parse(a.costs);if(e=this.judgeIsEnough(s))return e}}}return e},i.prototype.judgeIsEnough=function(e){var t=!1,i=0;if(e&&e.length){for(var o=0;o<e.length;o++)g.GameMVC.backpackPy.getItemNumByCode(e[o][1])>=e[o][2]&&i++;t=i>=e.length}return t},i.prototype.checkNoticeStarByConfig=function(e){var t=!1,i=!1,o=this.allMountByUuid,n=g.Config.horseStarConfigByCode(e.code),a=void 0;for(var r in o)o[r].code==e.code&&(i=!0,a=o[r]);if(i&&a.starLevel<n.length-1&&a.starLevel<n.length-1){for(var s=a.starLevel+1,c=void 0,l=0;l<n.length;l++)if(s==n[l].level){c=n[l];break}if(c&&c.costs){var h=JSON.parse(c.costs);if(t=this.judgeIsEnough(h))return t}}return t},i.prototype.checkNoticeByConfig=function(e){var t=!1,i=!1,o=this.allMountByUuid,n=g.Config.horseGradeConfigByCode(e.code),a=g.Config.horseStarConfigByCode(e.code),r=JSON.parse(e.costs),s=void 0;for(var c in o)o[c].code==e.code&&(i=!0,s=o[c]);if(i){if(s.level<n.length-1){for(var l=s.level+1,h=void 0,p=0;p<n.length;p++)if(l==n[p].level){h=n[p];break}if(h&&h.costs&&(r=JSON.parse(h.costs),t=this.judgeIsEnough(r)))return t}if(s.starLevel<a.length-1&&s.starLevel<a.length-1){l=s.starLevel+1;var d=void 0;for(p=0;p<a.length;p++)if(l==a[p].level){d=a[p];break}if(d&&d.costs){var u=JSON.parse(d.costs);if(t=this.judgeIsEnough(u))return t}}}else t=this.judgeIsEnough(r);return t},i.prototype.updateMountDict=function(e,t){var i=this;void 0===t&&(t=!1),Array.isArray(e)||(e=[e]),e.forEach(function(e){if(i.allMountByUuid[e.uuid])i.allMountByUuid[e.uuid].update(e);else{var t=new g.MountVO(e);i.allMountByUuid[e.uuid]=t}e.pos&&(i.onMountUuid=e.uuid)})},i.prototype.getInfoByCode=function(e){for(var t in this.allMountByUuid){var i=this.allMountByUuid[t];if(i.code==e)return i}},i.prototype.deteleByUuids=function(e){var t=this;e.forEach(function(e){delete t.updateMountDict[e]})},i.prototype.GetHorseInfo=function(t){var i=this;Utils.Socket.send("horse","GetHorseInfo",{}).then(function(e){i.updateMountDict(e.horseList),i.horseCoreInfo=e.info.coreInfo,i.handbookList=e.info.handbookList,NoticeManager.updateNotice(NT.MOUNT),t&&t()})},i.prototype.ActivateHorse=function(e,i){var o=this;Utils.Socket.send("horse","ActivateHorse",{code:e}).then(function(e){if(e.clientReward&&e.clientReward.horses)for(var t in e.clientReward.horses)o.updateMountDict(e.clientReward.horses[t]);g.AppFacade.getInstance().sendNotification(CN.MOUNT_UPDATEMAIN),NoticeManager.updateNotice(NT.MOUNT),i&&i()})},i.prototype.UpHorseGrade=function(e,t){var i=this;Utils.Socket.send("horse","UpHorseGrade",{uuid:e}).then(function(e){i.updateMountDict(e.horse),i.horseCoreInfo=e.info.coreInfo,i.handbookList=e.info.handbookList,g.AppFacade.getInstance().sendNotification(CN.MOUNT_UPDATEMAIN),NoticeManager.updateNotice(NT.MOUNT),t&&t()})},i.prototype.UpHorseStar=function(e,t){var i=this;Utils.Socket.send("horse","UpHorseStar",{uuid:e}).then(function(e){i.updateMountDict(e.horse),i.horseCoreInfo=e.info.coreInfo,i.handbookList=e.info.handbookList,g.AppFacade.getInstance().sendNotification(CN.MOUNT_UPDATEMAIN),NoticeManager.updateNotice(NT.MOUNT),t&&t(),g.AppFacade.getInstance().sendNotification(CN.MOUNT_UPDATESTAR)})},i.prototype.PutHorseOn=function(e,t){var i=this;Utils.Socket.send("horse","PutHorseOn",{uuid:e}).then(function(e){i.updateMountDict(e.horse),i.updateMountDict(e.oldHorse),g.AppFacade.getInstance().sendNotification(CN.MOUNT_UPDATEMAIN),t&&t()})},i.prototype.PutHorseDown=function(e,t){var i=this;Utils.Socket.send("horse","PutHorseDown",{uuid:e}).then(function(e){i.updateMountDict(e.horse),g.AppFacade.getInstance().sendNotification(CN.MOUNT_UPDATEMAIN),t&&t()})},i.N="MountPy",i);function i(){var e=t.call(this,i.N)||this;return e.horseCoreInfo=void 0,e.handbookList=[],e.playerPy=g.AppFacade.getInstance().retrieveProxy(g.PlayerPy.N),e.allMountByUuid={},e.onMountUuid="",e.addNotice(),e}g.MountPy=e,__reflect(e.prototype,"game.MountPy")}(game=game||{}),function(u){var t,e=(__extends(i,t=BasePanel),i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),u.GameMVC.playerPy.GetPlayerInfo()},i.prototype.childrenCreated=function(){var o=this;t.prototype.childrenCreated.call(this),this.resFullImg.right=-10,this.resFullImg.visible=!1,this.btn_master&&this.btn_master.addChild(this.resFullImg),this.cu_model.scaleX=this.cu_model.scaleY=1.5,this.head.touchEnabled=!1,this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.hide()},this),this.list.img_lastOne.source=4<u.Config.horseConfig().length?"yslz_btn_jiantouyou_png":"",this.list.img_nextOne.source=4<u.Config.horseConfig().length?"yslz_btn_jiantouyou_png":"",this.list.itemRenderer=n,this.list.dataProvider=this.dataprovider,this.list.addItemTapEvent(function(e){o.dataprovider.getItemAt(o.curSelectIndex).choose=!1;var t=o.list.list_root.getVirtualElementAt(o.curSelectIndex);t&&t.img_chose&&(t.img_chose.visible=!1),o.curSelectIndex=e.itemIndex,o.dataprovider.getItemAt(o.curSelectIndex).choose=!0;var i=o.list.list_root.getVirtualElementAt(o.curSelectIndex);i&&i.img_chose&&(i.img_chose.visible=!0),o.updateInfo()},this),this.btn_putOn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.uuid&&o.py.PutHorseOn(o.uuid,function(){o.updateUseShow(),Utils.MsgUtils.addMidMsg("出战成功")})},this),this.btn_putDown.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.uuid&&o.py.PutHorseDown(o.uuid,function(){o.updateUseShow(),Utils.MsgUtils.addMidMsg("休息成功")})},this),this.btn_activate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.code&&(o.isEnoughByLevel?o.py.ActivateHorse(o.code,function(){o.updateUseShow(),o.gp_effect.removeChildren(),DragonBoneTools.playOnce({effectName:"common_ty_jihuo",parent:o.gp_effect,x:o.gp_effect.width/2,y:o.gp_effect.height/2})}):Utils.MsgUtils.addMidMsg("道具不足,无法激活"))},this),this.btn_upgrade.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.uuid&&(o.isEnoughByLevel?o.py.UpHorseGrade(o.uuid,function(){o.gp_effect.removeChildren(),DragonBoneTools.playOnce({effectName:"common_ty_dj",parent:o.gp_effect,y:o.gp_effect.height/2,x:o.gp_effect.width/2})}):Utils.MsgUtils.addMidMsg("道具不足,无法升级"))},this),this.btn_jump.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.jumpModule?(u.MainJumpConfig.jumpTo(o.jumpModule),o.jumpModule==MODULE.RiskDifficulty&&(o.hide(),u.MainJumpConfig.jumpTo("GUAJI"))):Utils.MsgUtils.addMidMsg("暂无获取途径")},this),this.btn_master.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.AppFacade.getInstance().showSubView(u.MountMediator.N,u.MountMediator.SV.UP_STAR,{code:o.code,uuid:o.uuid})},this),this.btn_book.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.AppFacade.getInstance().showSubView(u.FashionMediator.N,u.FashionMediator.SV.ALL_INFO,{module:MODULE.Horse,allUuid:o.py.allMountByUuid,bookConfig:u.Config.horseBookConfig(),modelConfig:u.Config.horseConfigList()})},this)},i.prototype.judgeListIndex=function(e){var t=this.py.allMountByUuid;for(var i in t)if(t[i].code==e.code)return 1==t[i].pos?2:3;for(var o=0,n=JSON.parse(e.costs),a=0;a<n.length;a++)u.GameMVC.backpackPy.getItemNumByCode(n[a][1])>=n[a][2]&&o++;return o>=n.length?1:4},i.prototype.judgeIsUse=function(e){var t=!1,i=this.py.allMountByUuid;for(var o in i)if(i[o].code==e.code&&1==i[o].pos){t=!0;break}return t},i.prototype.judgeIsEnough=function(e){var t=!1,i=this.py.allMountByUuid;for(var o in i)if(i[o].code==e.code){t=!0;break}if(t)return!0;var n=!1,a=JSON.parse(e.costs),r=0;if(a&&a.length){for(var s=0;s<a.length;s++)u.GameMVC.backpackPy.getItemNumByCode(a[s][1])>=a[s][2]&&r++;n=r>=a.length}else n=!1;return n},i.prototype.updateList=function(e){this.dataList=[];for(var t=u.Config.horseConfig(),i=0;i<t.length;i++){var o={indexNum:this.judgeListIndex(t[i]),config:t[i],isUse:this.judgeIsUse(t[i]),choose:!1,isEnough:this.judgeIsEnough(t[i]),isNotice:this.py.checkNoticeByConfig(t[i])};this.dataList.push(o)}this.dataList[this.curSelectIndex].choose=!0,this.dataprovider.replaceAll(this.dataList)},i.prototype.updateUseShow=function(){var e=this.py.allMountByUuid;for(var t in this.dataprovider.source){var i=this.dataprovider.getItemAt(Number(t)),o=this.list.list_root.getVirtualElementAt(Number(t));for(var n in i.isUse=!1,o.img_putOn.visible=!1,e)e[n].code==i.config.code&&1==e[n].pos&&(i.isUse=!0,o.img_putOn.visible=!0)}},i.prototype.updateModel=function(e){var t=this;if(e){if(this.code==e)return;this.code=e,this.cu_model.visible=!1,this.cu_model.update({reqStyle:ROLE_STYLE.Fashion|ROLE_STYLE.Horse|ROLE_STYLE.Magical,horseCode:this.code}),this.cu_model.onArmatureLoadCB=function(){t.cu_model.visible=!0,t.cu_model.onChangingDir(1)}}else this.cu_model.visible=!1,this.cu_model.update({reqStyle:ROLE_STYLE.Fashion|ROLE_STYLE.Horse|ROLE_STYLE.Magical,horseCode:this.code}),this.cu_model.onArmatureLoadCB=function(){t.cu_model.visible=!0,t.cu_model.onChangingDir(1)}},i.prototype.updateView=function(e){e&&(this.curSelectIndex=e.chooseIndex),this.updateList(),this.updateInfo(),e&&(this.list.validateNow(),this.list.changeTo({itemIndex:this.curSelectIndex}))},i.prototype.updateInfo=function(){var e=this.curSelectIndex,t=this.dataList[e].config;this.updateModel(t.code),this.img_rarity.source=u.GeneralConfig.getTagByColor(t.color),this.config=t,this.uuid=void 0,this.lb_perfession.text=this.lb_name.text=t.name,this.lb_desc.text="    "+t.desc,this.head.updateData({vo:{avatar:t.avatar}});var i,o=0;i=u.Config.horseGradeConfigByCode(t.code).length-1;var n=0,a=JSON.parse(t.attr),r=!1,s=!1,c=!1;this.item_fightCap.update(0);var l=this.py.allMountByUuid;for(var h in l)if(l[h].code==this.code){r=!0,a=JSON.parse(l[h].attr),o=l[h].level,n=l[h].starLevel,this.uuid=l[h].uuid,0==l[h].pos?s=!0:1==l[h].pos&&(c=!0),this.item_fightCap.update(l[h].fightCap);break}this.lb_level.text=o+"/"+i,this.btn_putOn.visible=s,this.btn_putDown.visible=c;var p=u.GeneralConfig.getHeroStarInfo(n);if(this.gp_star.removeChildren(),p.stage<4)for(var d=0;d<p.num;d++)this.gp_star.addChild(new eui.Image(p.src));else this.gp_star.addChild(new customui.HighStarLevelIcon(p.num));this.updateCostBar(r,t),this.updateAttr(r,a),i<=o?(this.gp_cost.removeChildren(),this.btn_maxLevel.visible=!0,this.btn_upgrade.visible=!1,this.btn_activate.visible=!1,this.gp_costs_tip.visible=!1):(this.btn_maxLevel.visible=!1,this.btn_activate.visible=!r,this.btn_upgrade.visible=r,this.updateLevelCosts(r,t,o)),this.updateSkillInfo(o,t,n),this.btn_master.visible=!!r,UIActionManager.setAbsGrey(this.btn_upgrade,!this.isEnoughByLevel),UIActionManager.setAbsGrey(this.btn_activate,!this.isEnoughByLevel),this.btn_master.getChildAt(1).visible=this.py.checkNoticeStarByConfig(t)},i.prototype.updateAttr=function(e,t){if(this.gp_attr.removeChildren(),e)for(var i in t)(o=new u.HeroMainView_AttrItem(void 0)).scaleX=o.scaleY=.9,o.updateItem({type:i,num:t[i]||0}),this.gp_attr.addChild(o);else for(var i in t){var o;(o=new u.HeroMainView_AttrItem(void 0)).scaleX=o.scaleY=.9,o.updateItem({type:t[i][0],num:t[i][1]||0}),this.gp_attr.addChild(o)}},i.prototype.updateCostBar=function(e,t){var i=JSON.parse(t.costs);if(e){var o=u.Config.horseGradeConfigByCode(t.code);i=JSON.parse(o[1].costs)}if(this.moneyType=[],i&&i.length){var n=!0;this.moneyType.forEach(function(e){e[0]==i[0][0]&&e[1]==i[0][1]&&(n=!1)}),n&&this.moneyType.push([i[0][0],i[0][1]])}this.top_resourceBar.updateBar({costs:this.moneyType,width:170,gap:70,needAdd:!0})},i.prototype.updateLevelCosts=function(e,t,i){var o=JSON.parse(t.costs);this.gp_cost.removeChildren();var n=u.Config.horseGradeConfigByCode(t.code);if(e)for(var a in n)n[a].level==i+1&&(o=JSON.parse(n[a].costs));var r=0;if(this.jumpModule=t.jumpcode,o&&o.length){for(var s=0;s<o.length;s++){var c=new customui.CommonIconWithNum({code:o[s][1],num:o[s][2],style:CommonIconStyle.RIGHT,showEnough:!0});c.scaleX=c.scaleY=1,this.gp_cost.addChild(c);var l=u.GameMVC.backpackPy.getItemNumByCode(o[s][1])>=o[s][2];UIActionManager.setAbsGrey(c,!l),l&&r++}this.isEnoughByLevel=r>=o.length,this.isEnoughByLevel?(this.gp_cost.visible=!0,this.gp_costs_tip.visible=!1):(this.gp_cost.visible=!1,this.gp_costs_tip.visible=!0,this.lb_costTip.text=t.wayDesc||"暂无获取途径")}else this.gp_cost.removeChildren();e&&(this.gp_cost.visible=!0,this.gp_costs_tip.visible=!1)},i.prototype.updateSkillInfo=function(i,e,t){var o=this,n=u.Config.horseStarConfigByCode(e.code),a=[this.skillItem_0,this.skillItem_1,this.skillItem_2],r=JSON.parse(e.skills);if(0!=t)for(var s in n)if(t==n[s].level){r=JSON.parse(n[s].skills);break}function c(t){if(r[t]){a[t].updateItem({code:r[t][2]}),a[t].gp_non.visible=!1,a[t].addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){var e="";i<l[t]&&(e=l[t]+"级解锁"),o.skill_panel.visible=!0,o.skill_panel.updateItem({code:r[t][2],tips:e})},h),a[t].addEventListener(egret.TouchEvent.TOUCH_END,function(){o.skill_panel.visible=!1},h),a[t].addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){o.skill_panel.visible=!1},h),a[t].addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){o.skill_panel.visible=!1},h);var e=i<l[t];UIActionManager.setAbsGrey(a[t],e)}else a[t].reset(),a[t].gp_non.visible=!1}for(var l=JSON.parse(e.skillUnlock),h=this,p=0;p<a.length;p++)c(p)},i);function i(){var e=t.call(this)||this;return e.moneyType=[],e.isFirst=!1,e.params=void 0,e.backpackproxy=u.AppFacade.getInstance().retrieveProxy(u.BackpackPy.N),e.py=u.AppFacade.getInstance().retrieveProxy(u.MountPy.N),e.playerPy=u.AppFacade.getInstance().retrieveProxy(u.PlayerPy.N),e.config=void 0,e.dataList=[],e.curSelectIndex=0,e.dataprovider=new eui.ArrayCollection,e.code=0,e.uuid=void 0,e.isEnoughByLevel=!1,e.jumpModule=0,e.needLevel=0,e.resFullImg=new eui.Image("_main_m_json.common_img_hongdian"),e.skinName="MountMainViewSkin",e}u.MountMainView=e,__reflect(e.prototype,"game.MountMainView");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.head.touchEnabled=!1},a.prototype.dataChanged=function(){var e=this.data;this.dermaAvatar=this.data.config.avatar,this.head.updateData({vo:{avatar:this.dermaAvatar}}),this.img_chose.visible=e.choose,this.img_putOn.visible=e.isUse,UIActionManager.setAbsGrey(this.gp_main,!e.isEnough),this.img_notice.visible=e.isNotice},a.itemWidth=95,a);function a(){var e=o.call(this)||this;return e.py=u.AppFacade.getInstance().retrieveProxy(u.MountPy.N),e.dermaAvatar=void 0,e.skinName="MountItemSkin",e}__reflect(n.prototype,"MountAvatarItem")}(game=game||{}),function(b){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.addListener(),this.btn_up.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this;this.isEnough&&this.uuid?this.py.UpHorseStar(this.uuid,function(){b.AppFacade.getInstance().showSubView(b.MountMediator.N,b.MountMediator.SV.UP_STAR_RESULT,{info:e.info})}):Utils.MsgUtils.addMidMsg("道具不足")},this),this.resource_bar.visible=!0},i.prototype.addListener=function(){this.skill_item.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.showSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_END,this.hideSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.hideSkillDetail,this),this.skill_item.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.hideSkillDetail,this)},i.prototype.initList=function(){this.attr_list.itemRendererSkinName="HeroUpsectionPanel_AttrItem"},i.prototype.updateView=function(e){this.data=e,this.uuid=e.uuid,this.updateInfo()},i.prototype.updateInfo=function(){var e=this.py.allMountByUuid,t=0,n=void 0;for(var i in e)e[i].code==this.data.code&&(t=e[i].starLevel,n=e[i].attr);var o=b.Config.horseStarConfigByCode(this.data.code),a=[],r=void 0,s=void 0;for(var i in o)o[i].level==t?r=o[i]:o[i].level==t+1&&(s=o[i]);var c=t>=o.length-1;if(this.img_max.visible=c,this.img_max0.visible=c,this.btn_up.visible=!c,c)this.showMax(t,r,n);else{var l=JSON.parse(r.attr),h=JSON.parse(s&&s.attr);function p(e){var t=h[e],i=0;l.forEach(function(e){t[0]==e[0]&&(i=e[1])});var o={desc:AttrConfig[t[0]].name+"：  ",before:Number(n[t[0]]),after:Number(n[t[0]])};o.after=o.before+t[1]-i,o.before=Number(d.getValue(o.before)),o.after=Number(d.getValue(o.after)),a.push(o)}n=JSON.parse(n);var d=this;for(var i in h)p(i);this.attr_list.dataProvider=new eui.ArrayCollection(a);for(var u=JSON.parse(r.skills),g=JSON.parse(s.skills),f=void 0,_=0;_<u.length;_++)u[_][2]!=g[_][2]&&(f=g[_][2]);f?(this.gp_unlock.visible=!0,this.skill_item.updateItem({code:f}),this.skillDetailPanel.updateItem({code:f})):this.gp_unlock.visible=!1,this.gp_cost.removeChildren();var m=0,y=JSON.parse(s.costs);if(y&&y.length){for(_=0;_<y.length;_++){var v=new customui.CommonIconWithNum({code:y[_][1],num:y[_][2],style:CommonIconStyle.RIGHT,showEnough:!0});v.scaleX=v.scaleY=1,this.gp_cost.addChild(v);var T=b.GameMVC.backpackPy.getItemNumByCode(y[_][1])>=y[_][2];UIActionManager.setAbsGrey(v,!T),T&&m++}this.isEnough=m>=y.length}var C=b.GeneralConfig.getHeroStarInfo(t);if(this.gp_now.removeChildren(),C.stage<4)for(_=0;_<C.num;_++)(I=new eui.Image(C.src)).scaleX=I.scaleY=.4,this.gp_now.addChild(I);else(I=new customui.HighStarLevelIcon(C.num)).scaleX=I.scaleY=.4,this.gp_now.addChild(I);var E=b.GeneralConfig.getHeroStarInfo(t+1);if(this.gp_next.removeChildren(),E.stage<4)for(_=0;_<E.num;_++){var I;(I=new eui.Image(E.src)).scaleX=I.scaleY=.4,this.gp_next.addChild(I)}else(I=new customui.HighStarLevelIcon(E.num)).scaleX=I.scaleY=.4,this.gp_next.addChild(I);UIActionManager.setAbsGrey(this.btn_up,!this.isEnough),this.resource_bar.updateBar(y),this.info={skill:f,dataList:a,starInfo1:C,starInfo2:E}}},i.prototype.showMax=function(e,t,i){this.gp_cost.removeChildren();var o=JSON.parse(i),n=[];for(var a in o){var r=o[a],s={desc:AttrConfig[Number(a)].name+"：  ",before:Number(r),after:""};s.before=Number(this.getValue(s.before)),s.after="",n.push(s)}this.attr_list.dataProvider=new eui.ArrayCollection(n);var c=b.GeneralConfig.getHeroStarInfo(e);if(this.gp_now.removeChildren(),this.gp_next.removeChildren(),c.stage<4)for(var l=0;l<c.num;l++)(r=new eui.Image(c.src)).scaleX=r.scaleY=.4,this.gp_now.addChild(r);else(r=new customui.HighStarLevelIcon(c.num)).scaleX=r.scaleY=.4,this.gp_now.addChild(r);this.skill_item.visible=!1},i.prototype.getValue=function(e){var t=b.GeneralConfig.getAttrValue(e);return null==Number(t)||isNaN(Number(t))?t:Math.floor(Number(t)).toString()},i.prototype.showSkillDetail=function(){this.skillDetailPanel.visible=!0},i.prototype.hideSkillDetail=function(){this.skillDetailPanel.visible=!1},i);function i(){var e=t.call(this)||this;return e.backpackproxy=b.AppFacade.getInstance().retrieveProxy(b.BackpackPy.N),e.py=b.AppFacade.getInstance().retrieveProxy(b.MountPy.N),e.isEnough=!1,e.info=void 0,e.uuid=void 0,e.skinName="MountUpStarSkin",e}b.MountUpstarPanel=e,__reflect(e.prototype,"game.MountUpstarPanel")}(game=game||{}),function(e){var t,i=(__extends(o,t=BasePanel),o.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.gp_root.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this)},o.prototype.updateView=function(e){var t=e.info;t&&t.skill?(this.gp_skill.visible=!0,this.SkillItem.updateItem({code:t.skill})):this.gp_skill.visible=!1,this.attr_list.itemRenderer=s;var i=t.dataList;this.attr_list.dataProvider=new eui.ArrayCollection(i);var o=t.starInfo1;if(this.gp_now.removeChildren(),o.stage<4)for(var n=0;n<o.num;n++)(r=new eui.Image(o.src)).scaleX=r.scaleY=.5,this.gp_now.addChild(r);else(r=new customui.HighStarLevelIcon(o.num)).scaleX=r.scaleY=.5,this.gp_now.addChild(r);var a=t.starInfo2;if(this.gp_next.removeChildren(),a.stage<4)for(n=0;n<a.num;n++){var r;(r=new eui.Image(a.src)).scaleX=r.scaleY=.5,this.gp_next.addChild(r)}else(r=new customui.HighStarLevelIcon(a.num)).scaleX=r.scaleY=.5,this.gp_next.addChild(r)},o);function o(){var e=t.call(this)||this;return e.info=void 0,e.skinName="MountUpResultPanelSkin",e}e.MountUpstarResultPanel=i,__reflect(i.prototype,"game.MountUpstarResultPanel");var n,s=(n=eui.ItemRenderer,__extends(a,n),a.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this)},a.prototype.dataChanged=function(){var e=this.data,t=e.desc.split("：");this.lbl_name.text=t[0]+":",this.lbl_now.text=e.before,this.lbl_next.text=e.after},a);function a(){var e=n.call(this)||this;return e.skinName="MountUpResultItemSkin",e}__reflect(s.prototype,"MountUpResultItem")}(game=game||{}),function(o){var t,e=(__extends(n,t=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.FREE,o.PeakWarFreeWarView),this.addSubView(n.SV.HIGH,o.PeakWarHighWarView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.PEAK_WAR_FREE_INFO_UPDATED,CN.PEAK_WAR_HIGH_INFO_UPDATED]},n.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:var t=o.GameMVC.peakWarPy;t.initSchedule();var i=t.updateCurType();Utils.UnlockMgr.checkPass(MODULE.PeakWar,!1).allow&&t.GetWarInfo(i);break;case CN.PEAK_WAR_FREE_INFO_UPDATED:NoticeManager.updateNotice(NT.PEAK_WAR),this.updateView(n.SV.FREE);break;case CN.PEAK_WAR_HIGH_INFO_UPDATED:NoticeManager.updateNotice(NT.PEAK_WAR),this.updateView(n.SV.HIGH)}},n.N="PeakWarMed",n.SV={FREE:1,HIGH:2},n);function n(e){return void 0===e&&(e=null),t.call(this,n.N,e)||this}o.PeakWarMed=e,__reflect(e.prototype,"game.PeakWarMed")}(game=game||{}),function(i){var e=(t.registerAll=function(){(new s).register(),(new n).register()},t);function t(){}i.PeakWarProcessor=e,__reflect(e.prototype,"game.PeakWarProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){var t=e.getBody();i.GameMVC.peakWarPy.updateInfo(PEAK_WAR_TYPE.HIGH,t.info)},a);function a(){return o.call(this,"peakWar.HighLadderInfoP",a)||this}i.HighLadderInfoP=n,__reflect(n.prototype,"game.HighLadderInfoP");var r,s=(r=i.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){e.getBody()},c);function c(){return r.call(this,"peakWar.NewHighLadderRecordP",c)||this}i.NewHighLadderRecordP=s,__reflect(s.prototype,"game.NewHighLadderRecordP")}(game=game||{}),function(r){var t,e=(__extends(i,t=BaseProxy),i.prototype.initSchedule=function(){var e=JSON.parse(r.Config.constConfig().PeakWarFreedomTime.constValue);this.schedule.addSchedule(PEAK_WAR_TYPE.FREE,e[0][2],[e[0][0],e[0][1]]),this.schedule.addSchedule(PEAK_WAR_TYPE.FREE,e[1][2],[e[1][0],e[1][1]]),this.schedule.addSchedule(PEAK_WAR_TYPE.FREE_END,e[1][2],[e[1][1],[24,0]]);var t=JSON.parse(r.Config.entranceTimeConfig()[MODULE.PeakWar].timeConfig);this.schedule.addSchedule(PEAK_WAR_TYPE.HIGH,t[0][2],[t[0][0],t[0][1]]),this.schedule.addSchedule(PEAK_WAR_TYPE.HIGH_WAITING,t[0][2],[[0,0],t[0][0]]),this.schedule.addSchedule(PEAK_WAR_TYPE.HIGH_END,t[0][2],[t[0][1],[24,0]])},i.prototype.initNotice=function(){NoticeManager.setChildType(NT.PEAK_WAR,[NT.PEAK_WAR_CHALLENGE,NT.PEAK_WAR_REWARD_FREE,NT.COMMON_SHOP[ShopType.ShopTypePeakWar]]),NoticeManager.setChildType(NT.PEAK_WAR_REWARD_FREE,[NT.PEAK_WAR_REWARD_FREE_TAB]),NoticeManager.registerCB(NT.PEAK_WAR_CHALLENGE,this.checkChallengeNotice,this,MODULE.PeakWar),NoticeManager.registerCB(NT.PEAK_WAR_REWARD_FREE_TAB,this.checkRewardNotice,this,MODULE.PeakWar)},i.prototype.updateCurType=function(){return this.curType=this.schedule.checkCurrentStatus()[0],this.curType},i.prototype.updateInfo=function(e,t){switch(e){case PEAK_WAR_TYPE.FREE:case PEAK_WAR_TYPE.FREE_END:this.freeInfo.updateData(t),r.AppFacade.getInstance().sendNotification(CN.PEAK_WAR_FREE_INFO_UPDATED);break;case PEAK_WAR_TYPE.HIGH_END:case PEAK_WAR_TYPE.HIGH_WAITING:case PEAK_WAR_TYPE.HIGH:this.highInfo.updateData(t),r.AppFacade.getInstance().sendNotification(CN.PEAK_WAR_HIGH_INFO_UPDATED)}},i.prototype.GetWarInfo=function(t,i){var e,o=this;switch(t){case PEAK_WAR_TYPE.FREE:case PEAK_WAR_TYPE.FREE_END:e=Utils.Socket.send("peakWar","GetPeakWarFreedomInfo",{});break;case PEAK_WAR_TYPE.HIGH_END:case PEAK_WAR_TYPE.HIGH_WAITING:case PEAK_WAR_TYPE.HIGH:e=Utils.Socket.send("peakWar","GetPeakWarHighLadderInfo",{})}e.then(function(e){o.updateCurType(),o.updateInfo(t,e.info),i&&i()})},i.prototype.Challenge=function(i){var o=this,n=i.type,e=n===PEAK_WAR_TYPE.FREE?"FreedomChallenge":"HighLadderChallenge";r.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypePeakWar,pb1:"peakWar",pb2:e,params:{targetId:i.playerId,rank:i.rank},doneCB:function(e){if(e.cbRet){var t=e.cbRet;o.updateInfo(n,t.info),i.cb&&i.cb(t)}r.GameMVC.fightPy.queueExceExitCB()}})},i.prototype.RefreshChallengeList=function(t,i){var o=this;switch(t){case PEAK_WAR_TYPE.FREE:Utils.Socket.send("peakWar","FreedomRefresh",{}).then(function(e){o.updateInfo(t,e.info),i&&i()});break;case PEAK_WAR_TYPE.HIGH:Utils.Socket.send("peakWar","HighLadderRefresh",{}).then(function(e){o.highInfo.updateChallengeList(e.chalList),i&&i()})}},i.prototype.BuyChallengeTime=function(t){var e,i=this;switch(t.type){case PEAK_WAR_TYPE.FREE:e=Utils.Socket.send("peakWar","FreedomBuyChallenge",{num:t.num});break;case PEAK_WAR_TYPE.HIGH:e=Utils.Socket.send("peakWar","HighLadderBuyChallenge",{num:t.num})}e.then(function(e){i.updateInfo(t.type,e.info),t.cb&&t.cb()})},i.prototype.FreedomGetDailyReward=function(t){var i=this;Utils.Socket.send("peakWar","FreedomGetDailyReward",{code:t.code}).then(function(e){r.GameMVC.backpackPy.handleClientReward(e.clientReward),i.updateInfo(PEAK_WAR_TYPE.FREE,e.info),t.cb&&t.cb()})},i.prototype.BuyRefreshCount=function(e,t){var i=this;Utils.Socket.send("peakWar","FreedomBuyFreCount",{num:e}).then(function(e){i.updateInfo(PEAK_WAR_TYPE.FREE,e.info),t&&t()})},i.prototype.GetHighLadderRecord=function(e){Utils.Socket.send("peakWar","GetHighLadderRecord",{}).then(function(e){})},i.prototype.checkRewardNotice=function(){if(this.curType!==PEAK_WAR_TYPE.FREE)return!1;function e(e){var t=a[e],i=t.target;if(n.every(function(e){return e!=t.code})&&i<=o)return{value:!0}}var o=this.freeInfo.winCount,n=this.freeInfo.dailyTargeted,a=r.Config.peakWarFreeReward();for(var t in a){var i=e(t);if("object"==typeof i)return i.value}return!1},i.prototype.checkChallengeNotice=function(){return this.curType===PEAK_WAR_TYPE.FREE?0<this.freeInfo.chalCount:this.curType===PEAK_WAR_TYPE.HIGH&&0<this.highInfo.chalCount},i.N="PeakWarPy",i);function i(){var e=t.call(this,i.N)||this;return e.schedule=Utils.TimerManager.createWeeklySchedule(),e.freeInfo=new r.PWFreeMatchInfoVO,e.highInfo=new r.PWHighMatchInfoVO,e.initNotice(),e}r.PeakWarPy=e,__reflect(e.prototype,"game.PeakWarPy")}(game=game||{}),function(f){var t,e=(__extends(i,t=BaseFull),Object.defineProperty(i.prototype,"info",{get:function(){return this.proxy.freeInfo},enumerable:!0,configurable:!0}),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.addNotice(),this.initModel(),this.initTimer(),this.activateComponent()},i.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.PEAK_WAR_REWARD_FREE,this.btn_reward.getChildAt(0),this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.COMMON_SHOP[ShopType.ShopTypePeakWar],this.btn_shop.getChildAt(0),this,BTN_ICON_NOTICE_POS)},i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer)},i.prototype.updateView=function(e,t){if(t)this.proxy.GetWarInfo(PEAK_WAR_TYPE.FREE);else{var i=this.info,o=this.proxy.curType,n=this.bpProxy.getInfoByCode(EPropertyType.EPropertyTypePeakWarMoney);this.blb_honor.text=n.haveNum.toString(),this.blb_score.text=i.grade.toString(),this.blb_rank.text=""+(i.rank||"无排名");for(var a=f.GameMVC.loginPy.serverSelect.area,r=0;r<3;r++){var s=i.chalList[r];if(s){var c=this["gp_challenge_"+r],l=this["lb_name_"+r],h=this["lb_server_"+r],p=this["fightItem_"+r],d=this["blb_reward_"+r];l.text=s.baseInfo.name,h.text=(s.baseInfo.serverId||a)+"服",p.update(s.baseInfo.fightCap),d.text=""+this.calWinScore(s.baseInfo.fightCap);var u=this["img_isChallenged_"+r];this["model_"+r].update({reqStyle:ROLE_STYLE.Fashion,vo:s.baseInfo}),s.isChallenged?(UIActionManager.setAbsGrey(c,!0),u.visible=!0):(UIActionManager.setAbsGrey(c,!1),u.visible=!1)}}if(o===PEAK_WAR_TYPE.FREE){this.gp_times.visible=this.btn_formation.visible=!0,this.blb_refreshTimes.text=i.freCount.toString(),this.blb_challengeTimes.text=i.chalCount.toString();var g=f.Config.publicBuyCostConfig(MODULE.PeakWarFreedomRefresh,this.info.buyFreCount);this.btn_buy.updateData({cost:JSON.parse(g.costs)[0],text:"刷新"}),0<i.freCount?(this.btn_refresh.visible=!0,this.btn_buy.visible=!1):(this.btn_refresh.visible=!1,this.btn_buy.visible=!0)}else o===PEAK_WAR_TYPE.FREE_END?this.gp_times.visible=this.btn_formation.visible=!1:(f.MainJumpConfig.jumpTo(),f.MainJumpConfig.jumpTo(MODULE.PeakWar))}},i.prototype.calWinScore=function(e){var t=[[5e5,1e4,50,1],[2e6,1e4,250,3],[5e6,1e4,700,6],[void 0,1e4,1500,10]],i=0;for(var o in t){var n=t[o];if(!n[0]||e<n[0]){i=Math.ceil((e/n[1]+n[2])/n[3]);break}}return Math.min(i,700)},i.prototype.initModel=function(){for(var e=0;e<3;e++)this["model_"+e].curModelAct=ROLE_ACTION_NAME.DJ},i.prototype.initTimer=function(){var e=this,t=this.proxy.schedule.getCurrentTimeInterval().endDt;this.dt=t-Utils.TimerManager.getServerTime(),this.blb_time.text=""+Utils.TimerManager.getFormatBySecond1(this.dt),this.timer=egret.setInterval(function(){0<=e.dt?e.blb_time.text=""+Utils.TimerManager.getFormatBySecond1(--e.dt):(e.timer&&egret.clearInterval(e.timer),e.proxy.updateCurType(),e.initTimer(),e.updateView())},this,1e3)},i.prototype.challengeByIndex=function(e){if(this.proxy.curType===PEAK_WAR_TYPE.FREE){var t=this.info.chalList[e];0<this.info.chalCount?t.isChallenged||this.proxy.Challenge({type:PEAK_WAR_TYPE.FREE,playerId:t.baseInfo.playerId,cb:function(){}}):Utils.MsgUtils.addMidMsg("挑战次数不足")}else Utils.MsgUtils.addMidMsg("当前不可挑战")},i.prototype.showPlayerDetail=function(e){var t=this.info.chalList[e];f.AppFacade.getInstance().showSubView(f.FriendMediator.N,f.FriendMediator.SV.INFO,{playerId:t.baseInfo.playerId})},i.prototype.activateComponent=function(){function e(e){t["btn_detail_"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.showPlayerDetail(e)},t),t["model_"+e].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.challengeByIndex(e)},t)}for(var i=this,t=this,o=0;o<3;o++)e(o);this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypePeakWar})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().showSubView(f.RankMediator.N,f.RankMediator.SV.COMMON,{module:"PEAK_WAR_RANK_FREE"})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().showSubView(f.RankMediator.N,f.RankMediator.SV.COMMON,{module:"PEAK_WAR_REWARD_FREE"})},this),this.btn_guide.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new f.HelpDialog({moduleId:MODULE.PeakWar})})},this),this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<i.info.freCount&&i.proxy.RefreshChallengeList(PEAK_WAR_TYPE.FREE,function(){Utils.MsgUtils.addMidMsg("刷新成功")})},this),this.btn_buy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=f.Config.publicBuyCostConfig(MODULE.PeakWarFreedomRefresh,i.info.buyFreCount);f.GameMgr.getInstance().showCommonTipsWin({cost:e.costs,costTips:"，购买一次刷新次数？",source:"PEAK_WAR_FREE_REFRESH",cb:!0,clickCB:function(e){e.type&&i.proxy.RefreshChallengeList(PEAK_WAR_TYPE.FREE,function(){Utils.MsgUtils.addMidMsg("刷新成功")})}})},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.info,t=f.Config.VIPConfig().peakWarFreedomChalBuy;f.GameMVC.commonMed.showCommonBuyNum({moduleId:MODULE.PeakWarFreedomChallenge,hasBuyNum:e.buyChalCount,buyCB:function(e){i.proxy.BuyChallengeTime({type:PEAK_WAR_TYPE.FREE,num:e,cb:function(){Utils.MsgUtils.addMidMsg("购买成功")}})},maxBuyNum:t})},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.AppFacade.getInstance().showSubView(f.HeroMediator.N,f.HeroMediator.SV.FORMATION)},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.MainJumpConfig.jumpTo()},this)},i);function i(){var e=t.call(this)||this;return e.proxy=f.GameMVC.peakWarPy,e.bpProxy=f.GameMVC.backpackPy,e.scoreCode=32500001,e.skinName="PeakWarFreeWarSkin",e}f.PeakWarFreeWarView=e,__reflect(e.prototype,"game.PeakWarFreeWarView")}(game=game||{}),function(r){var i,e=(__extends(t,i=BaseFull),Object.defineProperty(t.prototype,"info",{get:function(){return this.proxy.highInfo},enumerable:!0,configurable:!0}),t.prototype.initChallengeItem=function(){for(var e=1;e<=6;e++){var t=Math.min(e,4),i=new n;i.currentState=t.toString(),e<=2?this.gp_top.addChild(i):this.gp_bottom.addChild(i),this.itemArr.push(i)}},t.prototype.initTimer=function(){var e=this,t=this.proxy.schedule.getCurrentTimeInterval().endDt;this.dt=t-Utils.TimerManager.getServerTime(),this.updateCountdown(),this.timer||(this.timer=egret.setInterval(function(){0<e.dt?(e.dt-=1,e.updateCountdown()):e.updateView(void 0,!0)},this,1e3))},t.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.timer&&egret.clearInterval(this.timer)},t.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.avatar=customui.PlayerHeadFactory.create({vo:r.GameMVC.playerPy.playerInfoVO}),this.gp_avatar.addChild(this.avatar),this.addNotice(),this.initChallengeItem(),this.activateComponent()},t.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.COMMON_SHOP[ShopType.ShopTypePeakWar],this.btn_shop.getChildAt(0),this,BTN_ICON_NOTICE_POS)},t.prototype.updateView=function(e,t){var i=this;t?this.proxy.GetWarInfo(PEAK_WAR_TYPE.HIGH,function(){i.initTimer()}):this.proxy.curType===PEAK_WAR_TYPE.HIGH_END?(Utils.MsgUtils.addMidMsg("天梯赛已结束"),r.MainJumpConfig.jumpTo()):this.realUpdate()},t.prototype.realUpdate=function(){var e=this.info;e.inMatch?(this.blb_fightCap.text=r.GameMVC.playerPy.playerInfoVO.fightCap.toString(),this.blb_rank.text=e.rank.toString(),this.proxy.curType===PEAK_WAR_TYPE.HIGH?(this.gp_challenge.visible=!0,this.blb_challengeTimes.text=e.chalCount.toString()):this.gp_challenge.visible=!1):(this.blb_fightCap.text=r.GameMVC.playerPy.playerInfoVO.fightCap.toString(),this.blb_rank.text="未获得天梯赛参与资格",this.gp_challenge.visible=!1),this.updateChallengeItem()},t.prototype.updateChallengeItem=function(){var a=this;this.proxy.RefreshChallengeList(PEAK_WAR_TYPE.HIGH,function(){var o=r.GameMVC.playerPy.playerInfoVO.playerId,n=a.proxy.highInfo.inMatch&&a.proxy.curType===PEAK_WAR_TYPE.HIGH;a.itemArr.forEach(function(e,t){var i=a.info.chalList[t];i?e.update({info:i,fightCB:function(){0<a.info.chalCount?a.proxy.Challenge({type:PEAK_WAR_TYPE.HIGH,rank:i.rank,cb:function(){a.updateChallengeItem()}}):Utils.MsgUtils.addMidMsg("挑战次数不足")},mopUpCB:function(){},canFight:i.baseInfo.playerId!=o&&n,canMopUp:!1}):e.update()})})},t.prototype.updateCountdown=function(){this.blb_time.text=this.TYPE_TO_DESC[this.proxy.curType]+":"+Utils.TimerManager.getFormatBySecond1(this.dt)},t.prototype.activateComponent=function(){var i=this;this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypePeakWar})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"PEAK_WAR_RANK_HIGH"})},this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.info.inMatch?r.AppFacade.getInstance().showSubView(r.FightMediator.N,r.FightMediator.SV.RECORD,{pb1:"peakWar",pb2:"GetHighLadderRecord",key:"records"}):Utils.MsgUtils.addMidMsg("无战斗记录")},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"PEAK_WAR_REWARD_HIGH"})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new r.HelpDialog({moduleId:MODULE.PeakWar})})},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.info,t=r.Config.VIPConfig().peakWarHighLadderChalBuy;r.GameMVC.commonMed.showCommonBuyNum({moduleId:MODULE.PeakWarHighLadderChallenge,hasBuyNum:e.buyChalCount,buyCB:function(e){i.proxy.BuyChallengeTime({type:PEAK_WAR_TYPE.HIGH,num:e,cb:function(){Utils.MsgUtils.addMidMsg("购买成功")}})},maxBuyNum:t})},this),this.btn_refresh.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.updateChallengeItem()},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.MainJumpConfig.jumpTo()},this)},t);function t(){var e,t=i.call(this)||this;return t.proxy=r.GameMVC.peakWarPy,t.itemArr=[],t.TYPE_TO_DESC=((e={})[PEAK_WAR_TYPE.HIGH]="剩余时间",e[PEAK_WAR_TYPE.HIGH_END]="下次开启",e[PEAK_WAR_TYPE.HIGH_WAITING]="准备开启",e),t.skinName="PeakWarHighWarSkin",t}r.PeakWarHighWarView=e,__reflect(e.prototype,"game.PeakWarHighWarView");var o,n=(o=customui.ArenaPlayerItem,__extends(a,o),a.prototype.update=function(e){if(e){this.vo=e.info.baseInfo,this.fightCB=e.fightCB,this.mopUpCB=e.mopUpCB;var t=e.info.rank,i=e.canFight,o=e.canMopUp;this.lb_name.text=this.vo.name+"·S"+this.vo.serverId,3<t?(this.blb_rank.visible=!0,this.img_rank.visible=!1,this.blb_rank.text=t.toString()):(this.blb_rank.visible=!1,this.img_rank.visible=!0,this.img_rank.source="jjc_icon_pm_"+t+"_png"),this.cu_playerHead.updateData({vo:this.vo}),this.item_fightCap.update(this.vo.fightCap),this.btn_fight.visible=i,this.btn_mopUp.visible=o}else this.btn_fight.visible=!1,this.btn_mopUp.visible=!1,this.blb_rank.visible=!1,this.img_rank.visible=!1,this.cu_playerHead.img_icon.source="",this.cu_playerHead.blb_level.text="",this.lb_name.text="----",this.item_fightCap.blb_fightCap.text="----"},a);function a(){return null!==o&&o.apply(this,arguments)||this}__reflect(n.prototype,"PeakWarHighWarView_ChallengeItem")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.PetMainView),this.addSubView(n.SV.SELECT_PANEL,i.PetSelecePanel),this.addSubView(n.SV.ATTR_DETAIL,i.PetAttrDetailsPanel),this.addSubView(n.SV.SELF_PET_DETAIL,i.PetDetailPanel),this.addSubView(n.SV.DECOMPOSE,i.PetDecomposePanel),this.addSubView(n.SV.COURTSHIP,i.CourtshipMainView),this.addSubView(n.SV.OTHER_PET_DETAIL,i.PetOtherPetDetail),this.addSubView(n.SV.FEED,i.PetFeedView),this.addSubView(n.SV.FRIEND,i.PetFriendView)},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.CONFIG_ALL_LOADED,CN.PLAYER_LEVEL_UP]},n.prototype.handleNotification=function(e){var t=this;switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.PLAYER_LEVEL_UP:i.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_PET),Utils.UnlockMgr.checkPass(MODULE.Pet,!1).allow&&this.proxy.GetCourtshipSuccessInfo(),Utils.UnlockMgr.checkPass(MODULE.Pet,!1).allow&&(i.GameMVC.friendPy.GetFriendLootInfo(),this.proxy.GetCourtshipSuccessInfo());break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.Pet,!1).allow&&this.proxy.GetPetInfo(),Utils.UnlockMgr.checkPass(MODULE.Pet,!1).allow&&egret.setTimeout(function(){i.GameMVC.friendPy.GetFriendLootInfo(),t.proxy.GetCourtshipSuccessInfo()},this,1e3);break;case CN.CONFIG_ALL_LOADED:}},n.N="PetMediator",n.SV={MAIN:1,SELECT_PANEL:2,ATTR_DETAIL:3,SELF_PET_DETAIL:4,DECOMPOSE:5,COURTSHIP:6,OTHER_PET_DETAIL:7,FEED:8,FRIEND:9},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.proxy=i.AppFacade.getInstance().retrieveProxy(i.PetPy.N),t}i.PetMediator=e,__reflect(e.prototype,"game.PetMediator")}(game=game||{}),function(a){var e=(t.registerAll=function(){(new o).register(),(new s).register()},t);function t(){}a.PetProcessor=e,__reflect(e.prototype,"game.PetProcessor");var i,o=(i=a.ProcessorBase,__extends(n,i),n.prototype.execute=function(e){var t=e.getBody();a.GameMVC.petPy.updatePetDict(t.petList),a.GameMVC.petMed.updateView(a.PetMediator.SV.MAIN),a.GameMVC.petMed.updateView(a.PetMediator.SV.FEED)},n);function n(){return i.call(this,"pet.PetInfoP",n)||this}a.PetInfoP=o,__reflect(o.prototype,"game.PetInfoP");var r,s=(r=a.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody();this.log("CourtshipSuccessInfoP",t);var i=t.successInfo,o=a.AppFacade.getInstance().retrieveProxy(a.PetPy.N);if(i.courtshipList&&0<i.courtshipList.length){var n=!1;o.courtshipInfo.successList.forEach(function(e,t){e.courtshipList[0].uuid==i.courtshipList[0].uuid&&(e.update(i),n=!0)}),n||o.courtshipInfo.successList.push(t.successInfo)}else o.courtshipInfo.successList=[];a.GameMVC.petMed.updateView(a.PetMediator.SV.COURTSHIP),NoticeManager.updateNotice(NT.PET_COURTSHIP_ENTRANCE)},c);function c(){return r.call(this,"courtship.CourtshipSuccessInfoP",c)||this}a.CourtshipSuccessInfoP=s,__reflect(s.prototype,"game.CourtshipSuccessInfoP")}(game=game||{}),function(p){var t,e=(__extends(i,t=BaseProxy),i.prototype.addNotice=function(){NoticeManager.setChildType(NT.PET,[NT.PET_SKILL_UPGRADE,NT.PET_UPGRADE,NT.PET_FEED_ENTRANCE,NT.PET_COURTSHIP_ENTRANCE]),NoticeManager.setChildType(NT.PET_FEED_ENTRANCE,[NT.PET_FRIEND_ENTRANCE,NT.PET_FEED,NT.PET_BE_LOOTED]),NoticeManager.setChildType(NT.PET_FRIEND_ENTRANCE,[NT.PET_FRIEND_GIFT,NT.PET_FRIEND_CAN_LEAVE]),NoticeManager.setChildType(NT.PET_COURTSHIP_ENTRANCE,[NT.PET_COURTSHIP_BIRTH]),NoticeManager.registerCB(NT.PET_FRIEND_GIFT,this.checkFriendGift,this,MODULE.Pet),NoticeManager.registerCB(NT.PET_FRIEND_CAN_LEAVE,this.checkCanLeave,this,MODULE.Pet),NoticeManager.registerCB(NT.PET_FEED,this.checkCanFeed,this,MODULE.Pet),NoticeManager.registerCB(NT.PET_COURTSHIP_BIRTH,this.checkCanBirth,this,MODULE.Pet),NoticeManager.registerCB(NT.PET_COURTSHIP_BIRTH,function(){return p.GameMVC.friendPy.myFeedInfo.lootList&&0<p.GameMVC.friendPy.myFeedInfo.lootList.length},this,MODULE.Pet)},i.prototype.checkNoticeUpgrade=function(){},i.prototype.checkNoticeSkillUpgrade=function(e){var t=this.allPetByUuid[e];if(!t)return!1;var i=p.Config.allPetConfig()[t.code];if(i){var o=[];for(var n in t.skillDetailList){var a=t.skillDetailList[n];if((c=p.Config.petSkillConfig(i.subType,n))[a-1]){var r=c[a-1].skill;o.push({code:r,subType:parseInt(n),level:a})}}for(var s in p.Config.skillBaseConfig(),o){o[s],r=o[s].code;var c,l=o[s].subType,h=(a=o[s].level,(c=p.Config.petSkillConfig(i.subType,l))[a]);if(h&&p.GameMVC.backpackPy.checkEnough(JSON.parse(h.costs),!1))return!0}return!1}},i.prototype.checkFriendGift=function(){if(0==Object.keys(this.allPetByUuid).length)return!1;var t=p.Config.getConstValue("FriendGivePetGrainRewards")[0][1],e=p.GameMVC.friendPy.friendList;for(var i in e){var o=e[i].friendGiftVO;if(o){var n=!1;if(o.bagRecord&&0<o.bagRecord.info.filter(function(e){return 0<=e.num&&e.code==t}).length&&(n=!0),o.getRecord&&0<o.getRecord.info.filter(function(e){return 0<e.num&&e.code==t}).length&&(n=!1),n)return!0}}return!1},i.prototype.checkCanLeave=function(){var e=p.GameMVC.friendPy.myFeedInfo;if(e.lootPlayerId&&e.lootList){var t=0,i=p.Config.getConstValue("MinFriendLootLeaveCycle");for(var o in p.GameMVC.friendPy.feedList)p.GameMVC.friendPy.feedList[o].lootList.forEach(function(e){e.playerId==p.GameMVC.playerPy.playerInfoVO.playerId&&(t=e.lootDt)});if(t)return Utils.TimerManager.getServerTime()-t>=i}},i.prototype.checkCanFeed=function(){if(0==Object.keys(this.allPetByUuid).length)return!1;var e=p.Config.getConstValue("PetFeedInfo");if(p.GameMVC.backpackPy.checkEnough(e[1][1],!1)){var t=p.GameMVC.friendPy.myFeedInfo;if(t.grainNum<=0||!t.uuid)return!0}return!1},i.prototype.checkCanBirth=function(){for(var e in this.courtshipInfo.successList)if(this.courtshipInfo.successList[e].isNewPet)return!0;return!1},i.prototype.updatePetDict=function(e,t){var i=this;void 0===t&&(t=!1),Array.isArray(e)||(e=[e]),e.forEach(function(e){if(i.allPetByUuid[e.uuid])i.allPetByUuid[e.uuid].update(e);else{var t=new p.PetVO(e);i.allPetByUuid[e.uuid]=t}e.pos&&(i.onFormationUuid=e.uuid)})},i.prototype.getLockType=function(e){var t=this.allPetByUuid[e];if(!t)return 0;if(t.pos)return 1;if(e==p.GameMVC.friendPy.myFeedInfo.uuid)return 2;if(p.GameMVC.petPy.isInCourtship(e))return 3;for(var i in ERaceTowerType){var o=ERaceTowerType[i],n=p.GameMVC.raceTowerPy.getInfoByType(o);if(n&&n.formation.pets&&n.formation.pets[0]==e)return 4}return 0},i.prototype.getInfoByCode=function(e){var t=[];for(var i in this.allPetByUuid){var o=this.allPetByUuid[i];o.code==e&&t.push(o)}return t},i.prototype.getInfoByPos=function(e){for(var t in this.allPetByUuid){var i=this.allPetByUuid[t];if(i.pos==e)return i}},i.prototype.getMaxByType=function(e){if(this.growMaxConst[e])return this.growMaxConst[e];if(0==e){var t=p.Config.getConstValue("PetGrowthInfo"),i=0;for(var o in t)(a=t[o])[2]>i&&(i=a[2]);return this.growMaxConst[e]=i}if(1<=e&&e<=4){var n=p.Config.getConstValue("PetQualificationInfo");for(var o in i=0,n){var a;if((a=n[o])[0]==e)for(var r in a[1]){var s=a[1][r];i=i>s[2]?i:s[2]}}return this.growMaxConst[e]=i}return p.Config.getConstValue("CourtshipMaxSkillNum")},i.prototype.deteleByUuids=function(e){var t=this;e.forEach(function(e){delete t.allPetByUuid[e]})},i.prototype.GetPetInfo=function(){var t=this;Utils.Socket.send("pet","GetPetInfo",{}).then(function(e){t.log("获取宠物信息 GetPetInfoR",e),t.updatePetDict(e.petList),t.petHistory=e.historyList,NoticeManager.updateNotice(NT.PET),p.AppFacade.getInstance().sendNotification(CN.MAIN_UPDATE_PET)})},i.prototype.PetUpGrade=function(e,t){var i=this;Utils.Socket.send("pet","PetUpGrade",{uuid:e.uuid,typ:e.typ,num:e.num}).then(function(e){i.log("宠物升级 PetUpGradeR",e),e.pet&&i.updatePetDict(e.pet),p.AppFacade.getInstance().updateView(p.PetMediator.N,p.PetMediator.SV.MAIN),e.feedInfo&&(p.GameMVC.friendPy.myFeedInfo._grainNum=e.feedInfo.grainNum,p.GameMVC.friendPy.myFeedInfo.lastGrainRefreshDt=e.feedInfo.lastGrainRefreshDt,p.GameMVC.friendPy.myFeedInfo.uuid=e.feedInfo.uuid),NoticeManager.updateNotice(NT.PET_FEED),t&&t()})},i.prototype.PetActivate=function(e,t){var i=this;Utils.Socket.send("pet","ActivatePet",{code:e}).then(function(e){i.log("宠物激活 ActivatePetR",e),p.AppFacade.getInstance().updateView(p.PetMediator.N,p.PetMediator.SV.MAIN),i.petHistory=e.historyList,t&&t()})},i.prototype.PetUpSection=function(e,t){var i=this;Utils.Socket.send("pet","PetUpSection",{uuid:e.uuid}).then(function(e){i.log("宠物升阶 PetUpSectionR",e),i.updatePetDict(e.pet),t&&t(),p.AppFacade.getInstance().updateView(p.PetMediator.N,p.PetMediator.SV.MAIN)})},i.prototype.PetPutOn=function(e,t){var i=this;Utils.Socket.send("pet","PutOnPet",{uuid:e.uuid,pos:e.pos}).then(function(e){i.log("宠物上阵 PutOnPetR",e),i.updatePetDict(e.petList),p.AppFacade.getInstance().updateView(p.PetMediator.N,p.PetMediator.SV.MAIN),t&&t()})},i.prototype.PetPutDown=function(e,t){var i=this;Utils.Socket.send("pet","PutDownPet",{uuid:e.uuid}).then(function(e){i.log("宠物下阵 PutDownPetR",e),i.updatePetDict(e.petList),p.AppFacade.getInstance().updateView(p.PetMediator.N,p.PetMediator.SV.MAIN),t&&t()})},i.prototype.UpGradeSkill=function(e,t){var i=this;Utils.Socket.send("pet","UpGradeSkill",{uuid:e.uuid,code:e.code}).then(function(e){i.log("宠物技能升级 UpGradeSkillR",e),i.updatePetDict(e.pet),t&&t(),NoticeManager.updateNotice(NT.PET_SKILL_UPGRADE),p.AppFacade.getInstance().updateView(p.PetMediator.N,p.PetMediator.SV.MAIN)})},i.prototype.FeedPet=function(e,i){var o=this;Utils.Socket.send("pet","FeedPet",{uuid:e.uuid,feedStatus:e.feedStatus}).then(function(e){o.log("喂猴子 FeedPetR",e);var t=p.GameMVC.friendPy.myFeedInfo;t.uuid=e.feedInfo.uuid,t._grainNum=e.feedInfo.grainNum,t.lastGrainRefreshDt=e.feedInfo.lastGrainRefreshDt,i&&i(e),NoticeManager.updateNotice(NT.PET_FEED)})},i.prototype.isInPeidui=function(e){for(var t in this.courtshipInfo.successList)if(this.courtshipInfo.successList[t].courtshipList[0].uuid==e)return!0;return!1},i.prototype.isInMarket=function(e){for(var t in this.courtshipInfo.successList){var i=this.courtshipInfo.successList[t];if(i.courtshipList[0].uuid==e&&(i.courtshipList[0].status==CourtshipStatusType.Courtship||i.courtshipList[0].status==CourtshipStatusType.Success))return!0}return!1},i.prototype.isInCourtship=function(t){for(var e in this.courtshipInfo.successList)if(0<this.courtshipInfo.successList[e].courtshipList.filter(function(e){return e.uuid==t}).length)return!0;return!1},i.prototype.GetCourtshipInfo=function(e,o){var n=this;Utils.Socket.send("courtship","GetCourtshipInfo",{code:e.code,requireInfo:e.requireInfo,pagination:e.pagination}).then(function(e){for(var t in n.log("拉市场数据 GetCourtshipInfoR",e),n.courtshipInfo.courtshipList=[],e.courtshipList){var i=e.courtshipList[t];n.courtshipInfo.courtshipList.push(new p.CourtshipVo(i))}n.courtshipInfo.totalPagination=e.totalPagination,o&&o()})},i.prototype.GetCourtshipSuccessInfo=function(e,o){var n=this;Utils.Socket.send("courtship","GetCourtshipSuccessInfo",{}).then(function(e){for(var t in n.log("拉和自己配对的数据 GetCourtshipSuccessInfoR",e),n.courtshipInfo.successList=[],e.successList){var i=e.successList[t];n.courtshipInfo.successList.push(new p.CourtshipSuccessVo(i))}o&&o(),NoticeManager.updateNotice(NT.PET_COURTSHIP_BIRTH)})},i.prototype.Courtship=function(e,t){var i=this;Utils.Socket.send("courtship","Courtship",{uuid:e.uuid,requireInfo:e.requireInfo}).then(function(e){i.log("把自己的丢到市场上 CourtshipR",e),i.courtshipInfo.successList=[new p.CourtshipSuccessVo(e.successInfo)],t&&t()})},i.prototype.CancelCourtship=function(i,o){var n=this;Utils.Socket.send("courtship","CancelCourtship",{uuid:i.uuid}).then(function(e){for(var t in n.log("把自己的丢到市场上的拿回来 CancelCourtshipR",e),n.courtshipInfo.successList)if(n.courtshipInfo.successList[t].courtshipList[0].uuid==i.uuid){n.courtshipInfo.successList.splice(parseInt(t),1);break}o&&o()})},i.prototype.ApplyCourtship=function(n,e){var t=this;Utils.Socket.send("courtship","ApplyCourtship",{uuid:n.uuid,tUuid:n.tUuid}).then(function(i){t.log("申请和别人生猴子  ApplyCourtshipR",i);var o=!1;t.courtshipInfo.successList.forEach(function(e,t){e.courtshipList[0].uuid==n.uuid&&(e.update(i.successInfo),o=!0)}),o||t.courtshipInfo.successList.push(new p.CourtshipSuccessVo(i.successInfo)),e&&e()})},i.prototype.RefuseCourtship=function(o,t){var n=this;Utils.Socket.send("courtship","RefuseCourtship",{uuid:o.uuid,tUuid:o.tUuid}).then(function(e){n.log("拒绝和别人生猴子 RefuseCourtshipR",e),n.courtshipInfo.successList.forEach(function(e,t){if(e.courtshipList[0].uuid==o.uuid){for(var i in e.courtshipList)if(e.courtshipList[i].uuid==o.tUuid){e.courtshipList.splice(parseInt(i),1);break}1==e.courtshipList.length&&e.courtshipList[0].status!=CourtshipStatusType.Courtship&&n.courtshipInfo.successList.splice(t,1)}}),t&&t()})},i.prototype.AgreeCourtship=function(e,t){var i=this;Utils.Socket.send("courtship","AgreeCourtship",{uuid:e.uuid,tUuid:e.tUuid}).then(function(e){i.log("同意和别人生猴子 AgreeCourtshipR",e),i.courtshipInfo.successList=[new p.CourtshipSuccessVo(e.successInfo)],t&&t()})},i.prototype.MakeChild=function(t,i){var o=this;Utils.Socket.send("courtship","MakeChild",{uuid:t.uuid}).then(function(e){o.log("生猴子 MakeChildR",e),o.courtshipInfo.successList=[],o.allPetByUuid[t.uuid].birthDt=0,i&&i(e),NoticeManager.updateNotice(NT.PET_COURTSHIP_BIRTH)})},i.prototype.CancelApplyCourtship=function(n,a){var r=this;Utils.Socket.send("courtship","CancelApplyCourtship",{uuid:n.uuid,tUuid:n.tUuid}).then(function(e){r.log("取消申请生猴子 CancelApplyCourtshipR",e);var t=e.successInfo;if(t&&0<t.courtshipList.length)for(var i in r.courtshipInfo.successList){var o=r.courtshipInfo.successList[i];o.courtshipList[0].uuid==n.uuid&&o.update(t)}else r.courtshipInfo.successList=[];a&&a(e)})},i.N="PetPy",i);function i(){var e=t.call(this,i.N)||this;return e.petHistory=[],e.localNotice=[],e.localSkillNotice=[],e.localUpgradeNotice=[],e.growMaxConst={},e.allPetByUuid={},e.onFormationUuid="",e.courtshipInfo={courtshipList:[],totalPagination:0,successList:[]},e.addNotice(),e}p.PetPy=e,__reflect(e.prototype,"game.PetPy")}(game=game||{}),function(P){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.onCloseCB=this.hide.bind(this),this.btn_filter.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0!=t.pageIndex?2!=t.pageIndex||PopUpManager.addPopUp({obj:new v({filterInfo:[].concat(t.successFilterInfo.filterInfo),courtshipRequireVo:new P.CourtshipRequireVo(t.successFilterInfo.courtshipRequireVo),requireCode:t.successFilterInfo.requireCode}),closeCB:function(e){e&&(t.successFilterInfo={filterInfo:[].concat(e.filterInfo),courtshipRequireVo:new P.CourtshipRequireVo(e.courtshipRequireVo),requireCode:e.requireCode},t.updateView(),Utils.MsgUtils.addMidMsg("筛选成功"))}}):PopUpManager.addPopUp({obj:new _({courtshipRequireVo:t.courtshipRequireVo,requireCode:t.requireCode}),closeCB:function(e){e&&(t.courtshipRequireVo.update(e.courtshipRequireVo),t.requireCode=e.requireCode,t.filterChanged=!0,t.pagination=1,t.updateView(),Utils.MsgUtils.addMidMsg("筛选成功"))}})},this),this.tabbar.itemRendererSkinName="TabBarItemSkin3",this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){t.pageIndex!=e.itemIndex&&(t.pageIndex=e.itemIndex,t.updateView())},this);var e=[];e.push({up:"common_yeqian_qiuou_0_png",down:"common_yeqian_qiuou_1_png",text:""}),e.push({up:"common_yeqian_wodeyaoqing_0_png",down:"common_yeqian_wodeyaoqing_1_png",text:""}),e.push({up:"common_yeqian_peiduijieguo_0_png",down:"common_yeqian_peiduijieguo_1_png",text:""}),this.tabbar.dataProvider=new eui.ArrayCollection(e),this.list_item.dataProvider=this.dataprovider,this.CommonBatchNum.btn_max.visible=!1,this.CommonBatchNum.btn_min.visible=!1,this.CommonBatchNum.btn_add.icon="chongwu_btn_xiayiye_png",this.CommonBatchNum.btn_sub.icon="chongwu_btn_shangyiye_png",this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){P.GameMVC.commonMed.showHelpDialog(MODULE.Courtship)},this)},t.prototype.updateView=function(){var t=this;switch(this.dataprovider.removeAll(),this.btn_filter.visible=!1,this.bm_tip.text="",this.CommonBatchNum.visible=!1,this.pageIndex){case 1:this.list_item.itemRenderer=n,this.updateProvider(this.getSelfPetsList()),this.bm_tip.text="仅限成长期宠物可进行配对",this.gp_scroller.height=756,this.bm_tip.verticalCenter=392,this.CommonDaTanChuKuang.blb_title.text="我的宠物";break;case 0:this.list_item.itemRenderer=s,this.filterChanged?this.updateMarketList(function(){t.updateProvider(t.getMarketList()),0<t.dataprovider.length?t.gp_empty.visible=!1:t.gp_empty.visible=!0,t.CommonBatchNum.setValueTo(t.pagination),t.CommonBatchNum.update({minBuyNum:1,maxBuyNum:P.GameMVC.petPy.courtshipInfo.totalPagination,onUpdate:function(e){e!=t.pagination&&(t.filterChanged=!0,t.pagination=e,t.updateView())}})}):this.updateProvider(this.getMarketList()),this.gp_scroller.height=716,this.bm_tip.verticalCenter=377,this.CommonDaTanChuKuang.blb_title.text="求 偶",this.CommonBatchNum.visible=!0,this.btn_filter.visible=!0;break;case 2:this.list_item.itemRenderer=h,this.updateProvider(this.getSuccessList()),this.gp_scroller.height=716,this.bm_tip.verticalCenter=377,this.CommonDaTanChuKuang.blb_title.text="配对结果",this.bm_tip.text="同一时间段内，仅限一次配对",this.btn_filter.visible=!0}},t.prototype.updateProvider=function(e){this.dataprovider.source=e,this.dataprovider.refresh(),0<this.dataprovider.length?this.gp_empty.visible=!1:this.gp_empty.visible=!0,this.sl_item.viewport.scrollV=0},t.prototype.getSelfPetsList=function(){var e=[],t=P.GameMVC.petPy.allPetByUuid,i=P.Config.getConstValue("PetAdultCycle"),o=Utils.TimerManager.getServerTime(),n=!1;for(var a in t){var r=t[a],s=r.birthDt,c=2;s?i<=o-s&&(c=1):c=3;var l=P.GameMVC.petPy.isInMarket(r.uuid);e.push({info:r,status:c,isInMarket:l}),P.GameMVC.petPy.isInPeidui(r.uuid)&&(n=!0)}return e.sort(function(e,t){return e.isInMarket&&!t.isInMarket?-1:!e.isInMarket&&t.isInMarket?1:e.status!=t.status?e.status-t.status:e.info.elderNum!=t.info.elderNum?e.info.elderNum-t.info.elderNum:e.info.sortKey!=t.info.sortKey?t.info.sortKey-e.info.sortKey:t.info.skillCount-e.info.skillCount}),e.forEach(function(e){e.hasOneInMarket=n}),e},t.prototype.getMarketList=function(){if(0!=this.marketList.length)return this.marketList;var e=[],t=P.GameMVC.petPy.courtshipInfo.courtshipList,i=P.GameMVC.petPy.allPetByUuid,o={};for(var n in P.GameMVC.petPy.courtshipInfo.successList)if(i[(r=P.GameMVC.petPy.courtshipInfo.successList[n]).courtshipList[0].uuid])for(var a=1;a<r.courtshipList.length;a++)o[r.courtshipList[a].uuid]=1;for(var n in t){var r;i[(r=t[n]).uuid]||e.push({info:r,hasInvite:!!o[r.uuid]})}return this.marketList=e},t.prototype.updateMarketList=function(e){this.marketList=[],GameRootLayer.gameLayer().switchTouchEnable(!1);var t=egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this,2e3);P.GameMVC.petPy.GetCourtshipInfo({code:this.requireCode,requireInfo:this.courtshipRequireVo,pagination:this.pagination},function(){GameRootLayer.gameLayer().switchTouchEnable(!0),egret.clearTimeout(t),e&&e()})},t.prototype.getSuccessList=function(){var e=[],t=P.GameMVC.petPy.courtshipInfo.successList;for(var i in t)for(var o=t[i],n=o.dt,a=o.isNewPet,r=o.isSuccess,s=1;s<o.courtshipList.length;s++)this.successFilterFunc(o.courtshipList[s])&&e.push({self:o.courtshipList[0],other:o.courtshipList[s],dt:n,isNewPet:a,isSuccess:r});return e.sort(function(e,t){var i=e.self,o=t.self;if(i.status!=o.status)return i.status==CourtshipStatusType.Courtship?1:-1;if(i.growthNum!=o.growthNum)return o.growthNum-i.growthNum;var n=Object.keys(i.skillDetailList).length,a=Object.keys(o.skillDetailList).length;return n!=a?a-n:i.dt-o.dt}),e},t.prototype.successFilterFunc=function(e){if(e.growthNum<this.successFilterInfo.filterInfo[0])return!1;if(this.successFilterInfo.requireCode&&e.code!=this.successFilterInfo.requireCode)return!1;for(var t in e.qualificationList){var i=(s=e.qualificationList[t])[0];if(s[1]<this.successFilterInfo.filterInfo[i])return!1}if(Object.keys(e.skillDetailList).length<this.successFilterInfo.filterInfo[5])return!1;var o=e.skillDetailList;for(var t in this.successFilterInfo.courtshipRequireVo.skills){var n=this.successFilterInfo.courtshipRequireVo.skills[t],a=!1;for(var r in o){var s;if((s=o[r])[0]==n){a=!0;break}}if(!a)return!1}return e.status==CourtshipStatusType.Courtship?!!this.successFilterInfo.filterInfo[6]:!!this.successFilterInfo.filterInfo[7]},t.prototype.showSkillPanel=function(e,t,i){i?(this.SkillDetailsPanel.visible=!0,this.SkillDetailsPanel.updateItem({code:t}),this.SkillDetailsPanel.top=e-this.sl_item.viewport.scrollV-this.SkillDetailsPanel.height):this.SkillDetailsPanel.visible=!1},t);function t(){var e=i.call(this)||this;return e.pageIndex=0,e.dataprovider=new eui.ArrayCollection,e.courtshipRequireVo=new P.CourtshipRequireVo({}),e.successFilterInfo={filterInfo:[0,0,0,0,0,0,1,1],courtshipRequireVo:new P.CourtshipRequireVo({}),requireCode:0},e.requireCode=0,e.pagination=1,e.filterChanged=!0,e.marketList=[],e.skinName="CourtshipMainViewSkin",e}P.CourtshipMainView=e,__reflect(e.prototype,"game.CourtshipMainView");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){var t=this;o.prototype.childrenCreated.call(this),this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.data.isInMarket)P.GameMVC.petPy.CancelCourtship({uuid:t.data.info.uuid},function(){Utils.MsgUtils.addMidMsg("取消成功"),P.GameMVC.petMed.updateView(P.PetMediator.SV.COURTSHIP)});else{if(t.data.hasOneInMarket)return void Utils.MsgUtils.addMidMsg("同一时间段只能进行一次配对");var e=P.Config.getConstValue("MaxPetCourtshipElderNum");if(t.data.info.elderNum>e)return void Utils.MsgUtils.addMidMsg("第"+t.data.info.elderNum+"代宠物无法配对");1==t.data.status?PopUpManager.addPopUp({obj:new u,closeCB:function(e){e&&P.GameMVC.petPy.Courtship({uuid:t.data.info.uuid,requireInfo:e},function(){Utils.MsgUtils.addMidMsg("发布成功"),P.GameMVC.petMed.updateView(P.PetMediator.SV.COURTSHIP)})}}):Utils.MsgUtils.addMidMsg("只有成长期宠物才能求偶")}},this),this.gp_look.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){P.GameMVC.petMed.showSubView(P.PetMediator.SV.SELF_PET_DETAIL,{uuid:t.data.info.uuid})},this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){t.timer&&egret.clearInterval(t.timer),t.timer2&&egret.clearInterval(t.timer2)},this)},a.prototype.dataChanged=function(){var n=this,a=this.data.info;this.data.isInMarket?(this.btn_ope.skinName="skins.ButtonSkinRed",this.btn_ope.label="取 消"):(this.btn_ope.skinName="skins.ButtonSkinYellow",this.btn_ope.label="求 偶");var e=P.Config.allPetConfig()[a.code];switch(this.heroModel.update({model:e.model,isStatic:!0}),this.lb_name.text=e.name,this.timer&&egret.clearInterval(this.timer),this.data.status){case 1:this.lb_name.text+="(成长期)";var t=P.Config.getConstValue("MaxPetCourtshipElderNum");this.data.info.elderNum<=t?UIActionManager.setGrey(this.btn_ope,!1):UIActionManager.setGrey(this.btn_ope,!0);break;case 2:var i=Utils.TimerManager.getServerTime()-a.birthDt,o=P.Config.getConstValue("PetAdultCycle");this.lb_name.text=e.name+"("+Utils.TimerManager.getFormatBySecond3(o-i)+"后进入成长期)",UIActionManager.setGrey(this.btn_ope,!0),this.timer=egret.setInterval(function(){i++,n.lb_name.text=e.name+"("+Utils.TimerManager.getFormatBySecond3(o-i)+"后进入成长期)",o-i<=1&&(n.data.status=1,n.timer&&egret.clearInterval(n.timer),n.dataChanged())},this,1e3);break;case 3:this.lb_name.text+="(成熟期)",UIActionManager.setGrey(this.btn_ope,!0)}var r=a.growthNum,s=0;for(var c in a.qualificationList.forEach(function(e){s+=e.num}),this.bm_grow.text=r+"",this.bm_quali.text=s+"",this.gp_skill.$children){var l=this.gp_skill.$children[c];this.skillItems.push(l)}this.gp_skill.removeChildren();var h=[];for(var p in a.skillDetailList){var d=a.skillDetailList[p],u=P.Config.petSkillConfig(e.subType,p);if(u[d-1]){var g=u[d-1].skill;h.push({code:g,subType:p,level:d})}}if(h.sort(function(e,t){return e.subType-t.subType}),h.forEach(function(e){if(n.skillItems[0])(t=n.skillItems[0]).updateItem(e),n.gp_skill.addChild(t),n.skillItems.shift();else{var t=new P.PetSkillItem(e);n.gp_skill.addChild(t),t.touchChildren=!1,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){n.showSkillPanel(n.y,e.target.data.code,!0)},n),t.addEventListener(egret.TouchEvent.TOUCH_END,function(){n.showSkillPanel(0,0,!1)},n),t.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){n.showSkillPanel(0,0,!1)},n),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){n.showSkillPanel(0,0,!1)},n)}}),this.bm_skillCount.text=h.length+"",this.timer2&&egret.clearInterval(this.timer2),this.bm_time.text="",this.data.isInMarket){function f(e){var t=_[e];if(t.courtshipList[0].uuid==a.uuid&&t.courtshipList[0].status==CourtshipStatusType.Courtship){var i=t.courtshipList[0].dt,o=P.Config.getConstValue("CourtshipCycle")-(Utils.TimerManager.getServerTime()-i);0<o?(m.bm_time.font="green_num_fnt",m.bm_time.text=Utils.TimerManager.getFormatBySecond1(o),m.timer2=egret.setInterval(function(){o--,n.bm_time.font="green_num_fnt",n.bm_time.text=Utils.TimerManager.getFormatBySecond1(o),o<=0&&(n.timer2&&egret.clearInterval(n.timer2),P.GameMVC.petMed.updateView(P.PetMediator.SV.COURTSHIP))},m,1e3)):(m.bm_time.font="white_num_fnt",m.bm_time.text="已过期")}}var _=P.GameMVC.petPy.courtshipInfo.successList,m=this;for(var c in _)f(c)}},a.prototype.showSkillPanel=function(e,t,i){var o=P.GameMVC.petMed.getSubView(P.PetMediator.SV.COURTSHIP);o&&o.showSkillPanel(this.y,t,i)},a);function a(){var e=o.call(this)||this;return e.skillItems=[],e.skinName="CourtshipMainViewSelfItemSkin",e}__reflect(n.prototype,"CourtshipMainViewSelfItem");var r,s=(r=eui.ItemRenderer,__extends(c,r),c.prototype.childrenCreated=function(){var d=this;r.prototype.childrenCreated.call(this),this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(d.data.hasInvite)Utils.MsgUtils.addMidMsg("已邀请");else{var e=d.data.info.dt;if(P.Config.getConstValue("CourtshipCycle")-(Utils.TimerManager.getServerTime()-e)<=0)return void Utils.MsgUtils.addMidMsg("该宠物求偶已过期");var t={},i=P.GameMVC.petPy.allPetByUuid,o=P.Config.getConstValue("PetAdultCycle"),n=Utils.TimerManager.getServerTime(),a=d.data.info,r=a.requireInfo,s=P.Config.getConstValue("MaxPetCourtshipElderNum");for(var c in i){var l=i[c],h=l.birthDt;if(h&&o<=n-h&&l.qualificationSum>=r.totalQualification&&l.growthNum>=r.growthNum&&l.skillCount>=r.skillNum&&l.code==a.code&&l.elderNum<=s){var p=P.GameMVC.petPy.isInMarket(l.uuid);t[l.uuid]={uuid:l.uuid,entityType:EEntityType.EEntityTypePet,isLocked:p,level:l.level,elderNum:l.elderNum,sortKey:l.sortKey,code:l.code,skillCount:l.skillCount}}}if(0==Object.keys(t).length)return void Utils.MsgUtils.addMidMsg("没有符合标准的宠物");PopUpManager.addPopUp({obj:new P.CommonChosePanel({getInfos:function(){return t},type:EEntityType.EEntityTypePet,needLongTap:!0,noCloseAsConfirm:!0,singleChoose:!0,lockedTip:"已发出邀请",source:BASEITEM_SOURCE.BACKPACK,checkFull:function(e){return 1<=e.length},selectUuids:[],title:"请选择宠物",sortFunc:function(e,t){return e.info.sortKey!=t.info.sortKey?e.info.sortKey-t.info.sortKey:e.info.skillCount!=t.info.skillCount?e.info.skillCount-t.info.skillCount:e.info.code-t.info.code}}),closeCB:function(e){e&&0<e.length&&P.GameMVC.petPy.ApplyCourtship({uuid:e[0],tUuid:d.data.info.uuid},function(){Utils.MsgUtils.addMidMsg("邀请成功"),P.GameMVC.petMed.updateView(P.PetMediator.SV.COURTSHIP)})}})}},this),this.gp_look.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){P.GameMVC.petMed.showSubView(P.PetMediator.SV.OTHER_PET_DETAIL,{info:d.data.info})},this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(){d.timer&&egret.clearInterval(d.timer)},this)},c.prototype.dataChanged=function(){var e=this,t=this.data.info,i=P.Config.allPetConfig()[t.code];this.heroModel.update({model:i.model,isStatic:!0}),this.lb_name.text=i.name,this.lb_ownerName.text=t.ownerName,this.bm_grow.text=(t.requireInfo.growthNum||"0")+"",this.bm_quali.text=(t.requireInfo.totalQualification||"0")+"",this.bm_skillCount.text=(t.requireInfo.skillNum||"0")+"",this.data.hasInvite?(this.btn_ope.skinName="skins.ButtonSkinSure",this.btn_ope.label="已申请",this.btn_ope.scaleX=this.btn_ope.scaleY=1):(this.btn_ope.skinName="skins.ButtonSkinYellow",this.btn_ope.label="申 请",this.btn_ope.scaleX=this.btn_ope.scaleY=.7),this.timer&&egret.clearInterval(this.timer);var o=t.dt,n=P.Config.getConstValue("CourtshipCycle")-(Utils.TimerManager.getServerTime()-o);this.bm_time.font="green_num_fnt",this.bm_time.text=Utils.TimerManager.getFormatBySecond1(n),0<n?this.timer=egret.setInterval(function(){n--,e.bm_time.font="green_num_fnt",e.bm_time.text=Utils.TimerManager.getFormatBySecond1(n),n<=0&&(e.timer&&egret.clearInterval(e.timer),e.bm_time.font="white_num_fnt",e.bm_time.text="已过期")},this,1e3):(this.bm_time.font="white_num_fnt",this.bm_time.text="已过期")},c);function c(){var e=r.call(this)||this;return e.skinName="CourtshipMainViewMarketItemSkin",e}__reflect(s.prototype,"CourtshipMainViewMarketItem");var l,h=(l=eui.ItemRenderer,__extends(p,l),p.prototype.childrenCreated=function(){var t=this;l.prototype.childrenCreated.call(this),this.btn_agree.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.data.isSuccess){var e=Utils.TimerManager.getServerTime();P.Config.getConstValue("CourtshipMakeChildCycle")<=e-t.data.dt&&P.GameMVC.petPy.MakeChild({uuid:t.data.self.uuid},function(e){P.GameMVC.petMed.updateView(P.PetMediator.SV.COURTSHIP);var t=e.clientReward.pets;t&&t[0]&&PopUpManager.addPopUp({obj:new E({uuid:t[0].uuid})})})}else t.data.other.status!=CourtshipStatusType.Courtship?P.GameMgr.getInstance().showCommonTipsWin({commonTips:"确定和"+t.data.other.ownerName+"配对吗？",clickCB:function(e){1==e.type&&P.GameMVC.petPy.AgreeCourtship({uuid:t.data.self.uuid,tUuid:t.data.other.uuid},function(){Utils.MsgUtils.addMidMsg("配对成功"),P.GameMVC.petMed.updateView(P.PetMediator.SV.COURTSHIP)})}}):Utils.MsgUtils.addMidMsg("请等待对方同意")},this),this.btn_refuse.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.data.other.status!=CourtshipStatusType.Courtship?P.GameMVC.petPy.RefuseCourtship({uuid:t.data.self.uuid,tUuid:t.data.other.uuid},function(){P.GameMVC.petMed.updateView(P.PetMediator.SV.COURTSHIP)}):P.GameMVC.petPy.CancelApplyCourtship({uuid:t.data.self.uuid,tUuid:t.data.other.uuid},function(){P.GameMVC.petMed.updateView(P.PetMediator.SV.COURTSHIP)})},this),this.gp_left.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){P.GameMVC.petMed.showSubView(P.PetMediator.SV.SELF_PET_DETAIL,{uuid:t.data.self.uuid})},this),this.gp_right.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){P.GameMVC.petMed.showSubView(P.PetMediator.SV.OTHER_PET_DETAIL,{info:t.data.other})},this);var e=P.Config.getConstValue("CourtshipMakeChildCycle");this.pb_time.maximum=e,this.pb_time.labelFunction=function(){return""},this.btn_result_detail.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){P.GameMVC.petMed.showSubView(P.PetMediator.SV.OTHER_PET_DETAIL,{info:t.result_info})},this)},p.prototype.dataChanged=function(){var e=this;this.result_info={code:0,growthNum:"",qualificationList:[],skillDetailList:[],skillCountTip:"0-0",fromCourtshipResult:!0},this.timer&&egret.clearInterval(this.timer),this.updateBaseInfo(),this.btn_agree.visible=!1,this.btn_refuse.visible=!1,this.pb_time.parent.visible=!1,this.btn_agree.scaleX=this.btn_agree.scaleY=.8;var t=this.data.isSuccess;if(this.btn_agree.verticalCenter=30,t){var i=Utils.TimerManager.getServerTime(),o=P.Config.getConstValue("CourtshipMakeChildCycle"),n=i-this.data.dt;o<=n?(this.btn_agree.verticalCenter=62.5,this.btn_agree.visible=!0,this.btn_agree.label="",this.btn_agree.skinName="skins.ButtonSkinYellow",this.btn_agree.label="领取"):(this.pb_time.parent.visible=!0,this.pb_time.value=n,this.bm_time.text=Utils.TimerManager.getFormatBySecond1(o-n),this.timer=egret.setInterval(function(){n++,e.pb_time.value=n,e.bm_time.text=Utils.TimerManager.getFormatBySecond1(o-n),o<n&&(egret.clearInterval(e.timer),e.dataChanged())},this,1e3))}else this.btn_agree.visible=!0,this.btn_refuse.visible=!0,this.data.other.status!=CourtshipStatusType.Courtship?(this.btn_agree.label="",this.btn_agree.skinName="skins.ButtonSkinYellow",this.btn_agree.label="同 意",this.btn_refuse.label="拒 绝"):(this.btn_agree.label="",this.btn_agree.skinName="skins.ButtonSkinSure",this.btn_agree.label="等待同意",this.btn_agree.scaleX=this.btn_agree.scaleY=1,this.btn_refuse.label="取 消")},p.prototype.updateBaseInfo=function(){var e=0,t={},i={},o=this.data.self;this.result_info.code=o.code,this.bm_grow_self.text=o.growthNum+"";var n=0;for(var a in o.qualificationList)n+=(m=o.qualificationList[a])[1],t[m[0]]=m[1];this.bm_quali_self.text=n+"",this.bm_skill_self.text=Object.keys(o.skillDetailList).length+"";var r=P.Config.allPetConfig();for(var a in this.hero_model_self.update({model:r[o.code].model,isStatic:!0}),e+=o.growthNum,o.skillDetailList)i[(m=o.skillDetailList[a])[0]]=1;for(var a in o=this.data.other,this.bm_grow_other.text=o.growthNum+"",n=0,o.qualificationList)n+=(m=o.qualificationList[a])[1],t[m[0]]=(m[1]+t[m[0]])/2;for(var a in this.bm_quali_other.text=n+"",this.bm_skill_other.text=Object.keys(o.skillDetailList).length+"",r=P.Config.allPetConfig(),this.hero_model_other.update({model:r[o.code].model,isStatic:!0}),this.lb_name_other.text=o.ownerName,e+=o.growthNum,o.skillDetailList)i[(m=o.skillDetailList[a])[0]]=1;e/=2;var s=P.Config.getConstValue("CourtshipGrowthFloat"),c=Math.floor(e*(1+s[0]/1e3)),l=Math.floor(e*(1+s[1]/1e3)),h=P.GameMVC.petPy.getMaxByType(0);h<l&&(l=h),P.Config.courtshipSkillNumConfig();var p=P.Config.getConstValue("CourtshipMinSkillNum"),d=P.Config.getConstValue("CourtshipMaxSkillNum"),u=Object.keys(i).length,g=u-5<3?3:u-5,f=Math.floor(.4*g);f+=p;var _=u<d?u:d;for(var a in this.bm_grow_result.text=c+"-"+l,this.bm_skill_result.text=f+"-"+_,this.result_info.skillCountTip=f+"-"+_,this.result_info.growthNum=c+"-"+l,i){var m=i[a];this.result_info.skillDetailList.push([a,1])}var y=0,v=0,T=P.Config.getConstValue("CourtshipQualificationFloat");for(var C in t){var E=t[C],I=Math.floor(E*(1+T[0]/1e3)),b=Math.floor(E*(1+T[1]/1e3)),A=P.GameMVC.petPy.getMaxByType(C);A<b&&(b=A),this.result_info.qualificationList.push([C,I+"-"+b]),y+=I,v+=b}this.bm_quali_result.text=y+"-"+v},p);function p(){var e=l.call(this)||this;return e.result_info={code:0,growthNum:"",qualificationList:[],skillDetailList:[],fromCourtshipResult:!0,skillCountTip:""},e.skinName="CourtshipMainViewSuccessItemSkin",e}__reflect(h.prototype,"CourtshipMainViewSuccessItem");var d,u=(__extends(g,d=BasePanel),g.prototype.childrenCreated=function(){var o=this;d.prototype.childrenCreated.call(this);var e=P.GameMVC.petPy.getMaxByType(0);this.CommonBatchNum0.update({minBuyNum:0,maxBuyNum:e}),this.CommonBatchNum0.btn_max.visible=!1,this.CommonBatchNum0.btn_min.visible=!1;for(var t=0,i=[EAttrType.Atk,EAttrType.Life,EAttrType.Defence,EAttrType.Speed],n=0;n<i.length;n++){var a=i[n];t+=P.GameMVC.petPy.getMaxByType(a)}this.CommonBatchNum1.update({minBuyNum:0,maxBuyNum:t}),this.CommonBatchNum1.btn_max.visible=!1,this.CommonBatchNum1.btn_min.visible=!1,this.CommonBatchNum2.update({minBuyNum:0,maxBuyNum:P.Config.getConstValue("CourtshipMaxSkillNum")}),this.CommonBatchNum2.btn_max.visible=!1,this.CommonBatchNum2.btn_min.visible=!1,this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.hide()},this),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=o.CommonBatchNum0.getCurNum(),t=o.CommonBatchNum1.getCurNum(),i=o.CommonBatchNum2.getCurNum();o.opperationParams={growthNum:e,totalQualification:t,skillNum:i},o.hide()},this)},g);function g(){var e=d.call(this)||this;return e.skinName="CourtshipInviteStandardPanelSkin",e}__reflect(u.prototype,"CourtshipInviteStandardPanel");var f,_=(__extends(m,f=BasePanel),m.prototype.childrenCreated=function(){var a=this;this.list_pet.itemRenderer=P.DecomposeUI_Item,this.list_pet.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){var t=a.list_pet.dataProvider;if(e.itemIndex==a.petIndex)return t.getItemAt(a.petIndex).chosen=!1,a.requireCode=0,a.petIndex=-1,void t.replaceAll(t.source);0<=a.petIndex&&(t.getItemAt(a.petIndex).chosen=!1),a.petIndex=e.itemIndex;var i=t.getItemAt(e.itemIndex);i.chosen=!0,a.requireCode=i.info.code,t.replaceAll(t.source)},this),this.list_skill.itemRenderer=P.PetSkillUpgradePanelItem,this.list_skill.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){var t=a.list_skill.dataProvider,i=t.getItemAt(e.itemIndex),o=parseInt(i.subType),n=a.courtshipRequireVo.skills.indexOf(o);0<=n?(a.courtshipRequireVo.skills.splice(n,1),i.chose=!1):(a.courtshipRequireVo.skills.push(o),i.chose=!0),t.replaceAll(t.source)},this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(a.courtshipRequireVo.growthNum=0,a.courtshipRequireVo.skillNum=0,a.courtshipRequireVo.qualificationList=[0,0,0,0],a.courtshipRequireVo.skills=[],0<=a.petIndex){var e=a.list_pet.dataProvider;e.getItemAt(a.petIndex).chosen=!1,a.petIndex=-1,e.replaceAll(e.source)}a.requireCode=0,a.updateView(),Utils.MsgUtils.addMidMsg("清空成功")},this),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.courtshipRequireVo.growthNum=parseInt(a.et_num0.text),a.courtshipRequireVo.qualificationList[0]=parseInt(a.et_num1.text||"0"),a.courtshipRequireVo.qualificationList[1]=parseInt(a.et_num2.text||"0"),a.courtshipRequireVo.qualificationList[2]=parseInt(a.et_num3.text||"0"),a.courtshipRequireVo.qualificationList[3]=parseInt(a.et_num4.text||"0"),a.courtshipRequireVo.skillNum=parseInt(a.et_num5.text),a.opperationParams={courtshipRequireVo:a.courtshipRequireVo,requireCode:a.requireCode},a.hide()},this),this.updateView()},m.prototype.updateView=function(){this.et_num0.text=this.courtshipRequireVo.growthNum+"",this.et_num1.text=(this.courtshipRequireVo.qualificationList[0]||0)+"",this.et_num2.text=(this.courtshipRequireVo.qualificationList[1]||0)+"",this.et_num3.text=(this.courtshipRequireVo.qualificationList[2]||0)+"",this.et_num4.text=(this.courtshipRequireVo.qualificationList[3]||0)+"",this.et_num5.text=this.courtshipRequireVo.skillNum+"";var e=[],t=P.Config.allPetConfig(),i=0;for(var o in t){var n=t[o];e.push({type:EEntityType.EEntityTypePet,info:{code:n.code},chosen:n.code==this.requireCode}),n.code==this.requireCode&&(this.petIndex=i),i++}this.list_pet.dataProvider=new eui.ArrayCollection(e);var a={},r=P.Config.petSkillConfig(0,0);for(var o in r)1==(n=r[o]).level&&1!=n.skillCode&&(a[n.skill]=n.skillCode);var s=[];for(var c in a){var l=a[c];s.push({code:c,subType:l,showSkillPanel:this.showSkillPanel.bind(this),chose:0<=this.courtshipRequireVo.skills.indexOf(parseInt(l))})}this.list_skill.dataProvider=new eui.ArrayCollection(s)},m.prototype.showSkillPanel=function(e,t,i){i?(this.SkillDetailsPanel.visible=!0,this.SkillDetailsPanel.updateItem({code:t})):this.SkillDetailsPanel.visible=!1},m);function m(e){var t=f.call(this)||this;return t.courtshipRequireVo=new P.CourtshipRequireVo({}),t.requireCode=0,t.petIndex=-1,t.skinName="CourtshipMarketFilterPanelSkin",e&&(t.courtshipRequireVo.update(e.courtshipRequireVo),t.requireCode=e.requireCode||0),t}__reflect(_.prototype,"CourtshipMarketFilterPanel");var y,v=(__extends(T,y=BasePanel),T.prototype.childrenCreated=function(){var a=this;function e(e){var t=o["et_num"+e],i=P.GameMVC.petPy.getMaxByType(e);t.addEventListener(egret.Event.CHANGE,function(){Number(t.text)>i&&(t.text=i.toString())},o),t.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){""!=t.text&&Number(t.text)||(t.text="0"),Number(t.text)>i&&(t.text=i.toString())},o)}y.prototype.childrenCreated.call(this);for(var o=this,t=0;t<6;t++)e(t);this.list_pet.itemRenderer=P.DecomposeUI_Item,this.list_pet.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){var t=a.list_pet.dataProvider;if(e.itemIndex==a.petIndex)return t.getItemAt(a.petIndex).chosen=!1,a.requireCode=0,a.petIndex=-1,void t.replaceAll(t.source);0<=a.petIndex&&(t.getItemAt(a.petIndex).chosen=!1),a.petIndex=e.itemIndex;var i=t.getItemAt(e.itemIndex);i.chosen=!0,a.requireCode=i.info.code,t.replaceAll(t.source)},this),this.list_skill.itemRenderer=P.PetSkillUpgradePanelItem,this.list_skill.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){var t=a.list_skill.dataProvider,i=t.getItemAt(e.itemIndex),o=parseInt(i.subType),n=a.courtshipRequireVo.skills.indexOf(o);0<=n?(a.courtshipRequireVo.skills.splice(n,1),i.chose=!1):(a.courtshipRequireVo.skills.push(o),i.chose=!0),t.replaceAll(t.source)},this),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){for(var e=0;e<6;e++){var t=a["et_num"+e];a.filterInfo[e]=parseInt(t.text)}a.filterInfo[6]=a.checkBox0.selected?1:0,a.filterInfo[7]=a.checkBox1.selected?1:0,a.opperationParams={filterInfo:a.filterInfo,courtshipRequireVo:a.courtshipRequireVo,requireCode:a.requireCode},a.hide()},this),this.btn_cancel.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){for(var e=0;e<6;e++)a.filterInfo[e]=0;var t;a.filterInfo[6]=1,a.filterInfo[7]=1,(a.requireCode=0)<=a.petIndex&&((t=a.list_pet.dataProvider).getItemAt(a.petIndex).chosen=!1,a.petIndex=-1,t.replaceAll(t.source)),a.courtshipRequireVo.skills=[],(t=a.list_skill.dataProvider).replaceAll([]),a.updateView()},this),this.updateView()},T.prototype.updateView=function(){for(var e=0;e<6;e++)this["et_num"+e].text=this.filterInfo[e]+"";this.checkBox0.selected=!!this.filterInfo[6],this.checkBox1.selected=!!this.filterInfo[7];var t=[],i=P.Config.allPetConfig(),o=0;for(var n in i){var a=i[n];t.push({type:EEntityType.EEntityTypePet,info:{code:a.code},chosen:a.code==this.requireCode}),a.code==this.requireCode&&(this.petIndex=o),o++}this.list_pet.dataProvider=new eui.ArrayCollection(t);var r={},s=P.Config.petSkillConfig(0,0);for(var n in s)1==(a=s[n]).level&&1!=a.skillCode&&(r[a.skill]=a.skillCode);var c=[];for(var l in r){var h=r[l];c.push({code:l,subType:h,showSkillPanel:this.showSkillPanel.bind(this),chose:0<=this.courtshipRequireVo.skills.indexOf(parseInt(h))})}c.sort(function(e,t){return e.subType-t.subType}),this.list_skill.dataProvider=new eui.ArrayCollection(c)},T.prototype.showSkillPanel=function(e,t,i){i?(this.SkillDetailsPanel.visible=!0,this.SkillDetailsPanel.updateItem({code:t})):this.SkillDetailsPanel.visible=!1},T);function T(e){var t=y.call(this)||this;return t.filterInfo=[0,0,0,0,0,0,1,1],t.courtshipRequireVo=new P.CourtshipRequireVo({}),t.requireCode=0,t.petIndex=-1,t.skinName="CourtshipSuccessFilterPanelSkin",t.filterInfo=e.filterInfo,t.courtshipRequireVo=e.courtshipRequireVo,t.requireCode=e.requireCode,t}__reflect(v.prototype,"CourtshipSuccessFilterPanel");var C,E=(__extends(I,C=BasePanel),I.prototype.childrenCreated=function(){var i=this;C.prototype.childrenCreated.call(this);var e=this.params&&this.params.uuid;if(e){var r=P.GameMVC.petPy.allPetByUuid[e];if(r){var t=P.Config.allPetConfig()[r.code];this.hero_model.update({model:t.model,isStatic:!0}),GameRootLayer.gameLayer().switchTouchEnable(!1);var s=egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this,15e3);egret.setTimeout(function(){var a=function(o){var n=i["lb_"+o];DragonBoneTools.playOnce({effectName:"common_UI_newchongwu_02",parent:n.parent,x:n.parent.width/2+45,y:n.parent.height/2,doneCB:function(){if(0==o)n.text=r.growthNum+"",o=5;else if(1<=o&&o<=4){var e=r.qualificationList;for(var t in e){var i=e[t];if(i.typ==o){n.text=i.num+"";break}}if(5==++o)return GameRootLayer.gameLayer().switchTouchEnable(!0),void egret.clearTimeout(s)}else o=1,n.text=Object.keys(r.skillDetailList).length+"";a(o)}})};a(0)},this,1e3);var o=[];for(var n in r.skillDetailList){var a=r.skillDetailList[n],c=P.Config.petSkillConfig(t.subType,n);if(c[a-1]){var l=c[a-1].skill;o.push({code:l,subType:n,level:a})}}o.sort(function(e,t){return e.subType-t.subType}),o.forEach(function(e){var t=new P.PetSkillItem(e);i.gp_skill.addChild(t),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){e.target&&e.target.data&&(i.SkillDetailsPanel.visible=!0,i.SkillDetailsPanel.updateItem(e.target.data))},i),t.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.SkillDetailsPanel.visible=!1},i),t.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.SkillDetailsPanel.visible=!1},i),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.SkillDetailsPanel.visible=!1},i)}),o.length<=5?(this.sl_skill.height=101,this.gp_main.height=522,this.hero_model.verticalCenter=-50):(this.sl_skill.height=204,this.gp_main.height=625),r.elderNum?this.img_generation.source="wuyi_img_xuetong"+r.elderNum+"_png":this.img_generation.source=""}}},I);function I(e){var t=C.call(this)||this;return t.skinName="CourtshipMakeResultPanelSkin",t.params=e,t}P.CourtshipMakeResultPanel=E,__reflect(E.prototype,"game.CourtshipMakeResultPanel")}(game=game||{}),function(o){var t,e=(t=o.DecomposePanel,__extends(i,t),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.btn_decompose.label="出 售",this.cu_resBar.visible=!1},i.prototype.updateChosenList=function(){for(var e=o.Config.allPetConfig(),t=0;t<4;t++){var i=this.chosenList[t];i?(this["hero_model"+t].visible=!0,this["hero_model"+t].update({model:e[i.code].model,isStatic:!0})):this["hero_model"+t].visible=!1}},i.prototype.playEffect=function(i){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return(t=this["hero_model"+i])?[4,DragonBoneTools.playOnce({effectName:"common_yingxiongfenjie",parent:t.parent,x:t.parent.width/2,y:t.parent.height/2,loop:!1,cacheAsBitmap:!0})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},i);function i(){var e=t.call(this)||this;return e.skinName="PetDecomposePanelSkin",e.MAX_NUM=4,e}o.PetDecomposePanel=e,__reflect(e.prototype,"game.PetDecomposePanel")}(game=game||{}),function(E){var a,e=(__extends(t,a=BasePanel),t.prototype.childrenCreated=function(){var e=this;a.prototype.childrenCreated.call(this),this.img_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.gp_attr.removeChildren();for(var t=1;t<=4;t++){var i=new E.HeroMainView_AttrItem(void 0);this.attrItems[t]=i,this.gp_attr.addChild(i)}this.pb_attr0.maximum=E.GameMVC.petPy.getMaxByType(0);var o=[EAttrType.Atk,EAttrType.Life,EAttrType.Defence,EAttrType.Speed];for(t=0;t<o.length;t++){var n=o[t];this["pb_attr"+(t+1)].maximum=E.GameMVC.petPy.getMaxByType(n)}for(t=0;t<5;t++)this["pb_attr"+t].labelDisplay.visible=!1},t.prototype.updateView=function(e){this.uuid=e&&e.uuid||this.uuid,this.uuid&&(this.updateBaseInfo(),this.updateServerInfo())},t.prototype.updateBaseInfo=function(){var e=E.GameMVC.petPy.allPetByUuid[this.uuid];if(e){var t=E.Config.allPetConfig()[e.code];this.lb_name.text=t.name,this.heroModel.update({model:t.model,isStatic:!0}),this.lb_desc.text=""+(t.desc||"暂无简介")}},t.prototype.updateServerInfo=function(){var i=this,e=E.GameMVC.petPy.allPetByUuid[this.uuid];if(e){var t=E.Config.petUpgradeConfig(e.code),o=JSON.parse(e.attr),n={};Array.isArray(o)?o.forEach(function(e){n[e[0]]=e[1]}):n=o;for(var a=1,r=1;a<=4&&r<=4;a++)null!=n[a]&&(this.attrItems[r].updateItem({type:a,num:n[a]||0}),r++);var s=t[t.length-1];this.bm_curLevel.text=""+e.level,this.bm_maxLevel.text="/"+s.level,this.pb_attr0.value=e.growthNum,this.bm_attr0.text=e.growthNum+"";var c=[EAttrType.Atk,EAttrType.Life,EAttrType.Defence,EAttrType.Speed];for(a=0;a<c.length;a++){var l=c[a];for(var h in e.qualificationList)(p=e.qualificationList[h]).typ==l&&(this["pb_attr"+(a+1)].value=p.num,this["bm_attr"+(a+1)].text=p.num+"")}for(var h in this.gp_skillList.$children){var p=this.gp_skillList.$children[h];this.skillItems.push(p)}this.gp_skillList.removeChildren();var d=[],u=E.Config.allPetConfig()[e.code];for(var g in e.skillDetailList){var f=e.skillDetailList[g],_=E.Config.petSkillConfig(u.subType,g);if(_[f-1]){var m=_[f-1].skill;d.push({code:m,subType:g,level:f})}}d.sort(function(e,t){return e.subType-t.subType}),this.bm_skillCount.text=d.length+"";for(var y=E.Config.getConstValue("CourtshipMaxSkillNum");d.length<y;)d.push({code:0,subType:999999,level:1});d.forEach(function(e){if(i.skillItems[0])(t=i.skillItems[0]).updateItem(e),i.gp_skillList.addChild(t),i.skillItems.shift();else{var t=new E.PetSkillItem(e);i.gp_skillList.addChild(t),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){e.target&&e.target.data&&e.target.data.code&&(i.SkillDetailsPanel.visible=!0,i.SkillDetailsPanel.updateItem(e.target.data))},i),t.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.SkillDetailsPanel.visible=!1},i),t.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.SkillDetailsPanel.visible=!1},i),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.SkillDetailsPanel.visible=!1},i)}});var v=e.birthDt;if(v){var T=E.Config.getConstValue("PetAdultCycle"),C=Utils.TimerManager.getServerTime();this.img_status.source=T<=C-v?"chongwu_img_yzczq_png":"chongwu_img_yzynq_png"}else this.img_status.source="chongwu_img_yzcsq_png";e.elderNum?this.img_generation.source="wuyi_img_xuetong"+e.elderNum+"_png":this.img_generation.source=""}},t);function t(){var e=a.call(this)||this;return e.attrItems=new Array,e.skillItems=[],e.skinName="PetDetailPanelSkin",e}E.PetDetailPanel=e,__reflect(e.prototype,"game.PetDetailPanel")}(game=game||{}),function(f){var t,e=(__extends(i,t=BaseFull),i.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.CommonResourceBar),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_record_parent),Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_friend),Utils.DeviceUtils.setLiuHaiPingAdapter(this.btn_help),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_loot0),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_loot1),NoticeManager.addNoticeListenerAtParent(NT.PET_FEED,this.btn_feed,this,{percentX:.8,percentY:-.1}),NoticeManager.addNoticeListenerAtParent(NT.PET_FRIEND_ENTRANCE,this.btn_friend,this,BTN_ICON_NOTICE_POS),this.pb_exp.labelFunction=function(){return""},UIActionManager.fadeBlink(this.img_add,!0,!1,1e3),UIActionManager.addEffect(this.gp_hand,"common_UI_newchongwu_01");var e=this.gp_hand.verticalCenter;egret.Tween.get(this.gp_hand,{loop:!0}).to({verticalCenter:e-10},500).to({verticalCenter:e},500),this.activateComponent();var o=0;egret.setInterval(function(){for(var e=1;e<4;e++){var t=i.gp_feeding.$children[e];t.visible=e<=o}o=++o%4},this,500)},i.prototype.updateView=function(e){var t=this;if(e&&e.noForceUpdate){if(e.self&&this.info.playerId!=f.GameMVC.playerPy.playerInfoVO.playerId)return;if(e.info&&e.info.playerId!=this.info.playerId)return}if(e&&e.info?this.info=e.info:e&&e.self&&(this.info=f.GameMVC.friendPy.myFeedInfo),this.info){var i=this.info.playerId==f.GameMVC.playerPy.playerInfoVO.playerId;this.CommonResourceBar.visible=i,this.gp_record_parent.visible=i,this.btn_friend.visible=i,this.btn_help.visible=i,this.pb_exp.parent.visible=i,this.CommonBatchNum.visible=i,this.btn_feed.visible=i,this.bm_canEatTime.parent.visible=i,this.btn_change.visible=i,this.img_add.visible=i,this.lb_ownerName.parent.visible=!i,this.btn_drive0.visible=i,this.btn_drive1.visible=i,this.gp_hand.visible=!1,this.gp_feeding.visible=!1,this.timerFeed&&egret.clearInterval(this.timerFeed);var o=f.Config.getConstValue("PetFeedInfo");this.bm_foodLeft.text=this.info.grainNum+"";var n=o[2];if(0==this.info.grainNum?this.img_bow.source="chongwu_img_kouliang1_png":this.info.grainNum<=.33*n?this.img_bow.source="chongwu_img_kouliang2_png":this.info.grainNum<=.66*n?this.img_bow.source="chongwu_img_kouliang3_png":this.img_bow.source="chongwu_img_kouliang4_png",i){this.CommonResourceBar.updateBar(o[1][1]),this.updateRecord();var a=f.GameMVC.friendPy.myFeedInfo.uuid;if(a){var r=f.GameMVC.petPy.allPetByUuid[a];this.hero_model.update({model:f.Config.allPetConfig()[r.code].model,isStatic:!0}),this.lb_level.text=r.level+"";var s=f.Config.petUpgradeConfig();s[r.level+1]?(this.pb_exp.maximum=s[r.level+1].exp,this.pb_exp.value=r.exp,this.bm_maxExp.text="/"+s[r.level+1].exp,this.bm_curExp.text=r.exp+""):(this.pb_exp.maximum=Number.MAX_VALUE,this.pb_exp.value=Number.MAX_VALUE,this.bm_maxExp.text="",this.bm_curExp.text=""),this.img_add.visible=!1,this.gp_feeding.visible=0<this.info.grainNum}else this.pb_exp.parent.visible=!1,this.hero_model.update({model:""});var c=f.FriendPy.PetGrainConsumeCycle,l=f.FriendPy.FriendLootRewards,h=Math.floor(this.info._grainNum/l[2])*c-(Utils.TimerManager.getServerTime()-this.info.lastGrainRefreshDt);this.bm_canEatTime.text=function(e){e<0&&(e=0);var t=Math.floor(e/3600);return e-=3600*t,t+"时"+Math.floor(e/60)+"分"}(h),0<h?(this.bm_canEatTime.parent.visible=!0,this.timerFeed=egret.setInterval(function(){h-=1,t.bm_foodLeft.text=t.info.grainNum+"",t.bm_canEatTime.text=Utils.TimerManager.getFormatBySecond3(h),h<=0&&t.updateView()},this,1e3)):this.bm_canEatTime.parent.visible=!1;var p=o[1][1][0][1],d=f.GameMVC.backpackPy.getInfoByCode(p),u=n-this.info.grainNum;this.CommonBatchNum.update({maxBuyNum:d<u?d:u,minBuyNum:0}),this.CommonBatchNum.setValueTo(0)}else{this.info.code?(this.hero_model.update({model:f.Config.allPetConfig()[this.info.code].model,isStatic:!0}),this.gp_feeding.visible=0<this.info.grainNum):this.hero_model.update({model:"",isStatic:!0}),f.GameMVC.friendPy.myFeedInfo.lootPlayerId||(this.gp_hand.visible=!0);var g=f.GameMVC.friendPy.getFriendById(this.info.playerId);this.lb_ownerName.text=g.name+"的宠物屋"}this.updateLooter()}},i.prototype.updateLooter=function(){var o=this;function e(e){var t=Math.floor(e/n),i=a[2]*t;return i<o.info.grainNum?i:o.info.grainNum}this.timerLoot0&&egret.clearInterval(this.timerLoot0),this.timerLoot1&&egret.clearInterval(this.timerLoot1),f.Config.getConstValue("PetFeedInfo");var n=f.FriendPy.FriendLootCycle,a=f.FriendPy.FriendLootRewards;if(this.info.lootList[0]){var r=this.info.lootList[0];r.playerId==f.GameMVC.playerPy.playerInfoVO.playerId?(this.lb_name0.text=f.GameMVC.playerPy.playerInfoVO.name,this.playerHead0.updateData({vo:f.GameMVC.playerPy.playerInfoVO}),this.gp_loot0.visible=!0,this.btn_drive0.icon="chongwu_btn_likai_png",this.btn_drive0.visible=!0):(f.GameMVC.friendPy.getFriendById(r.playerId)?(this.gp_loot0.visible=!0,f.GameMVC.playerPy.GetPublicPlayerBaseInfo([r.playerId],function(e,t){var i=t[r.playerId].baseInfo;o.playerHead0.updateData({vo:i}),o.lb_name0.text=i.name})):this.gp_loot0.visible=!1,this.btn_drive0.icon="chongwu_btn_ganzou_png");var t=Utils.TimerManager.getServerTime()-r.lootDt;this.bm_lootTime0.text=Utils.TimerManager.getFormatBySecond1(t),this.bm_caculate0.text="预计抢夺:"+e(t),this.timerLoot0=egret.setInterval(function(){t++,o.bm_caculate0.text="预计抢夺:"+e(t),o.bm_lootTime0.text=Utils.TimerManager.getFormatBySecond1(t)},this,1e3)}else this.gp_loot0.visible=!1;if(this.info.lootList[1]){var s=this.info.lootList[1];s.playerId==f.GameMVC.playerPy.playerInfoVO.playerId?(this.lb_name1.text=f.GameMVC.playerPy.playerInfoVO.name,this.playerHead1.updateData({vo:f.GameMVC.playerPy.playerInfoVO}),this.gp_loot1.visible=!0,this.btn_drive1.icon="chongwu_btn_likai_png",this.btn_drive1.visible=!0):(f.GameMVC.friendPy.getFriendById(s.playerId)?(this.gp_loot1.visible=!0,f.GameMVC.playerPy.GetPublicPlayerBaseInfo([s.playerId],function(e,t){var i=t[s.playerId].baseInfo;o.playerHead1.updateData({vo:i}),o.lb_name1.text=i.name})):this.gp_loot1.visible=!1,this.btn_drive1.icon="chongwu_btn_ganzou_png");var i=Utils.TimerManager.getServerTime()-s.lootDt;this.bm_lootTime1.text=Utils.TimerManager.getFormatBySecond1(i),this.bm_caculate1.text="预计抢夺:"+e(i),this.timerLoot1=egret.setInterval(function(){i++,o.bm_lootTime1.text=Utils.TimerManager.getFormatBySecond1(i),o.bm_caculate1.text="预计抢夺:"+e(i)},this,1e3)}else this.gp_loot1.visible=!1},i.prototype.updateRecord=function(){function e(){var e=f.GameMVC.playerPy.playerInfoVO.playerId,t=(f.GameMVC.playerPy.playerInfoVO.name,f.FriendPy.FriendLootRewards),i=f.GeneralConfig.getEntityConfigByCode(t[0],t[1]);for(var o in c.gp_record.removeChildren(),f.GameMVC.friendPy.recordList){var n=f.GameMVC.friendPy.recordList[o],a=[];switch(n.status){case FriendLootType.Loot:n.playerId==e?(a.push({text:"幸运至极，",style:{textColor:16777215}}),a.push({text:"你抢夺了",style:{textColor:16777215}}),a.push({text:n.name,style:{textColor:6347775}}),a.push({text:"的",style:{textColor:16777215}})):(a.push({text:"非常遗憾，",style:{textColor:16777215}}),a.push({text:n.name,style:{textColor:6347775}}),a.push({text:"抢夺了你的",style:{textColor:16777215}})),a.push({text:n.num+"",style:{textColor:6355204}}),a.push({text:"个"+i.name,style:{textColor:16777215}});break;case FriendLootType.Drive:n.playerId!=e?(a.push({text:n.name,style:{textColor:6347775}}),a.push({text:"非常生气，愤怒地把您打跑了",style:{textColor:16777215}})):(a.push({text:"您非常生气、狂殴",style:{textColor:16777215}}),a.push({text:n.name,style:{textColor:6347775}}),a.push({text:"，把他赶跑了",style:{textColor:16777215}}));break;case FriendLootType.DriveSoftly:n.playerId!=e?(a.push({text:n.name,style:{textColor:6347775}}),a.push({text:"友好地请您离开他的宠物领地",style:{textColor:16777215}})):(a.push({text:"你非常友好和善地请",style:{textColor:16777215}}),a.push({text:n.name,style:{textColor:6347775}}),a.push({text:"离开了",style:{textColor:16777215}}))}var r=new eui.Label;r.size=18,r.textFlow=a,c.gp_record.addChild(r)}var s=28*c.gp_record.$children.length-c.sl_record.height+10;c.sl_record.viewport.scrollV=0<s?s:0}var c=this;0!=f.GameMVC.friendPy.recordList.length?e():f.GameMVC.friendPy.GetFriendLootRecord(function(){e()})},i.prototype.activateComponent=function(){var t=this;this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.info.playerId==f.GameMVC.playerPy.playerInfoVO.playerId?t.hide():f.GameMVC.petMed.updateView(f.PetMediator.SV.FEED,{self:!0})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.GameMVC.commonMed.showHelpDialog(MODULE.PetFeed)},this),this.btn_drive0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.info.lootList[0].playerId==f.GameMVC.playerPy.playerInfoVO.playerId?f.GameMVC.friendPy.LeaveFriend(function(e){t.updateView({info:e.feedList[0]})}):PopUpManager.addPopUp({obj:new n,closeCB:function(e){e&&f.GameMVC.friendPy.DriveFriend({playerId:t.info.lootList[0].playerId,status:e},function(){t.updateView({self:!0})})}})},this),this.btn_drive1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.info.lootList[1].playerId==f.GameMVC.playerPy.playerInfoVO.playerId?f.GameMVC.friendPy.LeaveFriend(function(){t.updateView()}):PopUpManager.addPopUp({obj:new n,closeCB:function(e){e&&f.GameMVC.friendPy.DriveFriend({playerId:t.info.lootList[1].playerId,status:e},function(){t.updateView({self:!0})})}})},this),this.btn_change.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new f.CommonChosePanel({getInfos:function(){var e=f.GameMVC.petPy.allPetByUuid,t=f.Config.petUpgradeConfig(),i=0;for(var o in t)(a=t[o]).level>i&&(i=a.level);var n={};for(var o in e){var a;(a=e[o]).level<i&&(n[a.uuid]=a)}return n},selectUuids:[t.info.uuid],type:EEntityType.EEntityTypePet,checkFull:function(e){return 1<=e.length},sortFunc:function(e,t){return e.info.sortKey!=t.info.sortKey?e.info.sortKey-t.info.sortKey:e.info.skillCount!=t.info.skillCount?e.info.skillCount-t.info.skillCount:e.info.code-t.info.code},singleChoose:!0,needLongTap:!0,title:"请选择喂养的宠物"}),closeCB:function(e){e&&0<e.length?e[0]!=t.info.uuid&&f.GameMVC.petPy.FeedPet({uuid:e[0],feedStatus:!0},function(){f.GameMVC.petMed.updateView(f.PetMediator.SV.FEED,{self:!0})}):f.GameMVC.petPy.FeedPet({uuid:t.info.uuid,feedStatus:!1},function(){f.GameMVC.petMed.updateView(f.PetMediator.SV.FEED,{self:!0})})}})},this),this.img_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.btn_change.dispatchEvent(new egret.TouchEvent(egret.TouchEvent.TOUCH_TAP))},this),this.btn_feed.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=t.CommonBatchNum.getCurNum();0<e&&f.GameMVC.petPy.PetUpGrade({uuid:t.info.uuid,typ:PetUpGradeType.FeedSlowly,num:e},function(){t.updateView({self:!0})})},this),this.gp_hand.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.GameMVC.friendPy.LootFriend(t.info.playerId,function(e){t.updateView({info:e.feedList[0]})})},this),this.btn_friend.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){f.GameMVC.petMed.showSubView(f.PetMediator.SV.FRIEND)},this)},i);function i(){var e=t.call(this)||this;return e.skinName="PetFeedViewSkin",e}f.PetFeedView=e,__reflect(e.prototype,"game.PetFeedView");var o,n=(__extends(a,o=BasePanel),a.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.gp_1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.opperationParams=FriendLootType.Drive,e.hide()},this),this.gp_2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.opperationParams=FriendLootType.DriveSoftly,e.hide()},this)},a);function a(){var e=o.call(this)||this;return e.skinName="PetFriendDrivePanelSkin",e}__reflect(n.prototype,"PetFriendDrivePanel")}(game=game||{}),function(u){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.commonDaTanKuang.blb_title.text="好 友",this.commonDaTanKuang.onCloseCB=function(){e.hide()},this.initButton(),this.initList()},i.prototype.initButton=function(){var e=this;this.btn_oneKey.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.collection_list.length<=0?Utils.MsgUtils.addMidMsg("暂无好友"):u.GameMVC.friendPy.OperateFriendGift({friendId:0,operationType:FriendGoodOperationType.QuickGetAndGiveOperation,rewardType:FriendRewardGiveType.PetGrain},function(){u.GameMVC.petMed.updateView(u.PetMediator.SV.FRIEND),Utils.MsgUtils.addMidMsg("操作成功")})},this),this.btn_leave.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.GameMVC.friendPy.LeaveFriend(function(){e.updateView()})},this)},i.prototype.initList=function(){this.list_item.itemRenderer=n,this.collection_list=new eui.ArrayCollection,this.list_item.dataProvider=this.collection_list},i.prototype.updateView=function(){var s=this,c=u.GameMVC.friendPy.friendList,l=u.GameMVC.friendPy.feedList,e=[];for(var t in l){var i=l[t],o=c[i.playerId];o&&e.push({playerId:i.playerId,grainNum:i.grainNum,avatar:o.friendAvatar,name:o.friendName,level:o.friendLevel,fightCap:o.friendPower,lastOnlineTime:o.lastOnlineTime,vipLevel:o.vipLevel,friendGiftVO:o.friendGiftVO})}e.sort(function(e,t){return 0==e.lastOnlineTime&&0!=t.lastOnlineTime?-1:0==t.lastOnlineTime&&0!=e.lastOnlineTime?1:e.lastOnlineTime!=t.lastOnlineTime?t.lastOnlineTime-e.lastOnlineTime:t.fightCap-e.fightCap}),this.collection_list.replaceAll(e),this.gp_noFriend.visible=0==e.length;var n=u.Config.getConstValue("FriendGivePetGrainRewards"),a=u.Config.getConstValue("FriendPetGrainGetLimit"),r=u.GameMVC.friendPy.getPetGiftCount(n[0][1]);this.bm_max.text="/"+a,this.bm_count.text=r+"";var h=u.GameMVC.friendPy.myFeedInfo;if(this.bm_loot_max.text="",h.lootPlayerId){function p(e){var t=l[e];if(t.playerId!=h.lootPlayerId)return"continue";var i=c[t.playerId];if(i){d.lb_loot_name.text=i.friendName,d.playerhead_loot.updateData({vo:{playerId:t.playerId,avatar:i.friendAvatar,level:i.friendLevel,vipLevel:i.vipLevel}});var o=0;function n(e,t){var i=Math.floor(e/a),o=r[2]*i;return o<t?o:t}t.lootList.forEach(function(e){e.playerId==u.GameMVC.playerPy.playerInfoVO.playerId&&(o=e.lootDt)});var a=u.FriendPy.FriendLootCycle,r=u.FriendPy.FriendLootRewards;d.passTime=Utils.TimerManager.getServerTime()-o,d.bm_stayTime.text=Utils.TimerManager.getFormatBySecond1(d.passTime),d.bm_loot_cur.text=n(d.passTime,t.grainNum)+"",d.timer=egret.setInterval(function(){s.passTime++,s.bm_stayTime.text=Utils.TimerManager.getFormatBySecond1(s.passTime),s.bm_loot_cur.text=n(s.passTime,t.grainNum)+""},d,1e3)}}this.gp_bottom.visible=!0,this.scroller_item.bottom=171;var d=this;for(var t in l)p(t)}else this.gp_bottom.visible=!1,this.scroller_item.bottom=10},i);function i(){var e=t.call(this)||this;return e.skinName="PetFriendViewSkin",e}u.PetFriendView=e,__reflect(e.prototype,"game.PetFriendView");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.inintButton()},a.prototype.dataChanged=function(){this.lb_name.text=this.data.name;var e=Utils.TimerManager.getServerTime();this.lb_outlineTime_rightTop.text=Utils.TimerManager.getOfflineDescBySecond(this.data.lastOnlineTime?e-this.data.lastOnlineTime:0),this.playerhead.updateData({vo:this.data}),this.bm_food.text=this.data.grainNum,this.caculateState()},a.prototype.caculateState=function(){var t=this,e=this.data.friendGiftVO;if(!e)return this.btn_getGift.visible=!0,void(this.btn_giveGift.visible=!0);this.btn_giveGift.visible=!0,this.canGive=!0,!e.giveRecord||0<e.giveRecord.info.filter(function(e){return 0<e.num&&e.code==t.giftCode}).length&&(this.btn_giveGift.visible=!1,this.canGive=!1),this.btn_getGift.visible=!1,this.canGet=!1,!e.bagRecord||0<e.bagRecord.info.filter(function(e){return 0<=e.num&&e.code==t.giftCode}).length&&(this.btn_getGift.visible=!0,this.canGet=!0),e.getRecord&&0<e.getRecord.info.filter(function(e){return 0<e.num&&e.code==t.giftCode}).length&&(this.btn_getGift.visible=!1,this.canGet=!1),this.canGet?this.btn_giveGift.x=0:this.btn_giveGift.x=67},a.prototype.inintButton=function(){var e=this;this.playerhead.addTapEvent(function(){u.AppFacade.getInstance().retrieveProxy(u.PlayerPy.N),u.AppFacade.getInstance().showSubView(u.FriendMediator.N,u.FriendMediator.SV.INFO,{playerId:e.data.playerId})}),this.btn_getGift.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.Config.getConstValue("FriendPetGrainGetLimit")<=u.GameMVC.friendPy.getPetGiftCount(this.giftCode)?Utils.MsgUtils.addMidMsg("今日已达领取次数上限"):this.canGet&&u.GameMVC.friendPy.OperateFriendGift({friendId:this.data.playerId,operationType:FriendGoodOperationType.GetOperation,rewardType:FriendRewardGiveType.PetGrain},function(){u.GameMVC.petMed.updateView(u.PetMediator.SV.FRIEND),u.GameMVC.petMed.updateView(u.PetMediator.SV.FEED),Utils.MsgUtils.addMidMsg("领取成功")})},this),this.btn_giveGift.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.canGive&&u.GameMVC.friendPy.OperateFriendGift({friendId:this.data.playerId,operationType:FriendGoodOperationType.GiveOperation,rewardType:FriendRewardGiveType.PetGrain},function(){u.GameMVC.petMed.updateView(u.PetMediator.SV.FRIEND),Utils.MsgUtils.addMidMsg("赠送成功")})},this),this.btn_visit.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){u.GameMVC.petMed.hideSubView(u.PetMediator.SV.FRIEND),u.GameMVC.friendPy.GetSingleFriendLootInfo({playerId:e.data.playerId},function(e){u.GameMVC.petMed.updateView(u.PetMediator.SV.FEED,{info:e.feedInfo})})},this)},a);function a(){var e=o.call(this)||this;e.giftCode=30000015,e.canGive=!1,e.canGet=!1,e.skinName="PetFriendItemSkin";var t=u.Config.getConstValue("FriendGivePetGrainRewards");return e.giftCode=t[0][1],e}__reflect(n.prototype,"PetFriendItem")}(game=game||{}),function(b){var a,e=(__extends(t,a=BaseFull),t.prototype.childrenCreated=function(){var t=this;a.prototype.childrenCreated.call(this),this.activateComponent(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top),Utils.DeviceUtils.setLiuHaiPingAdapter(this.top_resourceBar),NoticeManager.addNoticeListenerAtParent(NT.PET_COURTSHIP_ENTRANCE,this.btn_courtship,this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListenerAtParent(NT.PET_FEED_ENTRANCE,this.btn_feed,this,BTN_ICON_NOTICE_POS),this.baseitem_0=new r,this.baseitem_0.left=46,this.baseitem_0.verticalCenter=0,this.gp_top.addChild(this.baseitem_0),this.list_assist.itemRenderer=r,this.list_assist.dataProvider=this.dataprovider,this.list_assist.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){t.curSelectIndex!=e.itemIndex+1&&(t.py.getInfoByPos(e.itemIndex+2)?(0<t.curSelectIndex?t.dataprovider.getItemAt(t.curSelectIndex-1).chose=!1:(t.baseitem_0.data.chose=!1,t.baseitem_0.dataChanged()),t.curSelectIndex=e.itemIndex+1,t.dataprovider.getItemAt(e.itemIndex).chose=!0,t.dataprovider.refresh(),t.updateBaseInfo(),t.updateServerInfo()):t.putOnPet(e.itemIndex+2))},this),this.baseitem_0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0!=t.curSelectIndex&&(0<t.curSelectIndex&&(t.dataprovider.getItemAt(t.curSelectIndex-1).chose=!1,t.dataprovider.refresh()),t.curSelectIndex=0,t.baseitem_0.data.chose=!0,t.baseitem_0.dataChanged(),t.updateBaseInfo(),t.updateServerInfo())},this),this.gp_attr.removeChildren();for(var e=1;e<=4;e++){var i=new b.HeroMainView_AttrItem(void 0);this.attrItems[e]=i,this.gp_attr.addChild(i)}this.pb_attr0.maximum=this.py.getMaxByType(0);var o=[EAttrType.Atk,EAttrType.Life,EAttrType.Defence,EAttrType.Speed];for(e=0;e<o.length;e++){var n=o[e];this["pb_attr"+(e+1)].maximum=this.py.getMaxByType(n)}for(e=0;e<5;e++)this["pb_attr"+e].labelDisplay.visible=!1;this.pb_exp.labelDisplay.visible=!1},t.prototype.updateView=function(e){var t=-1,i=!1;for(var o in this.py.allPetByUuid){var n=this.py.allPetByUuid[o];if(n.pos==this.curSelectIndex+1){i=!0;break}t<0&&n.pos&&(t=n.pos)}if(!i)return 0<=t?(this.curSelectIndex=t-1,void this.updateView()):(Utils.MsgUtils.addMidMsg("还没有获得宠物"),void this.hide());NoticeManager.updateNotice(NT.PET);var a=this.py.getInfoByPos(this.curSelectIndex+1);if(a){var r=b.Config.petUpgradeConfig(a.code)[1];this.top_resourceBar.updateBar(r.costs)}this.updateBaseInfo(),this.updateServerInfo(),this.updateTopList()},t.prototype.upgradeLogic=function(e){var t=this;void 0===e&&(e=0),e=e||this.upgradeCount;var i=this.py.getInfoByPos(this.curSelectIndex+1);if(i)if(this.curLevel==this.maxLevel)Utils.MsgUtils.addMidMsg("已满级");else{var o=i.level;this.waitCallBack=1,this.py.PetUpGrade({uuid:i.uuid,num:e,typ:1},function(){t.waitCallBack=0;var e=t.py.getInfoByPos(t.curSelectIndex+1).level;o<e&&DragonBoneTools.playUniqueEffect({effectName:"common_ty_dj",parent:t.gp_effect,x:t.gp_effect.width/2,y:t.gp_effect.height/2})})}else Utils.MsgUtils.addMidMsg("该阵位没有上阵宠物")},t.prototype.updateBaseInfo=function(){var e=this.py.getInfoByPos(this.curSelectIndex+1);if(e){var t=b.Config.allPetConfig()[e.code];this.baseitem_icon.updateData(t),this.lb_name.text=t.name,this.heroModel.update({model:t.model,isStatic:!0}),this.lb_desc.text="    "+(t.desc||"暂无简介"),this.btn_putDown.visible=0!=this.curSelectIndex,e.elderNum?this.img_generation.source="wuyi_img_xuetong"+e.elderNum+"_png":this.img_generation.source=""}},t.prototype.updateServerInfo=function(){var i=this,e=this.py.getInfoByPos(this.curSelectIndex+1);if(e){var t=b.Config.petUpgradeConfig(e.code),o=JSON.parse(e.attr),n={};Array.isArray(o)?o.forEach(function(e){n[e[0]]=e[1]}):n=o;for(var a=1,r=1;a<=4&&r<=4;a++)null!=n[a]&&(this.attrItems[r].updateItem({type:a,num:n[a]||0}),r++);var s=t[t.length-1];this.bm_curLevel.text=""+e.level,this.bm_maxLevel.text="/"+s.level,this.curLevel=e.level,this.maxLevel=s.level,this.blb_fightCap.text=Utils.MathUtils.formatNumStyle2(e.fightCap)+"",this.pb_attr0.value=e.growthNum,this.bm_attr0.text=e.growthNum+"";var c=[EAttrType.Atk,EAttrType.Life,EAttrType.Defence,EAttrType.Speed];for(a=0;a<c.length;a++){var l=c[a];for(var h in e.qualificationList){var p=e.qualificationList[h];p.typ==l&&(this["pb_attr"+(a+1)].value=p.num,this["bm_attr"+(a+1)].text=p.num+"")}}this.img_skillNotice.visible=this.py.checkNoticeSkillUpgrade(e.uuid),this.gp_skillList.removeChildren();var d=[],u=b.Config.allPetConfig()[e.code];for(var g in e.skillDetailList){var f=e.skillDetailList[g],_=b.Config.petSkillConfig(u.subType,g);if(_[f-1]){var m=_[f-1].skill;d.push({code:m,subType:g,level:f})}}d.sort(function(e,t){return e.subType-t.subType});for(var y=b.Config.getConstValue("CourtshipMaxSkillNum");d.length<y;)d.push({code:0,subType:999999,level:1});d.forEach(function(e){if(i.skillItems[0])(t=i.skillItems[0]).updateItem(e),i.gp_skillList.addChild(t),i.skillItems.shift();else{var t=new A(e);i.gp_skillList.addChild(t),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){e.target&&e.target.data&&e.target.data.code&&(i.SkillDetailsPanel.visible=!0,i.SkillDetailsPanel.updateItem(e.target.data))},i),t.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.SkillDetailsPanel.visible=!1},i),t.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.SkillDetailsPanel.visible=!1},i),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.SkillDetailsPanel.visible=!1},i)}}),t[e.level];var v=t[e.level+1];if(v){this.btn_upgrade.visible=!0;var T=JSON.parse(s.costs)[0];this.btn_upgrade.updateData({cost:[T[0],T[1],1],text:"喂食"}),this.bm_curExp.text=e.exp+"",this.bm_maxExp.text="/"+v.exp,this.pb_exp.maximum=v.exp,this.pb_exp.value=e.exp}else this.btn_upgrade.visible=!1,this.bm_curExp.text="已满级",this.bm_maxExp.text="",this.pb_exp.maximum=1,this.pb_exp.value=1;var C=e.birthDt;if(C){var E=b.Config.getConstValue("PetAdultCycle"),I=Utils.TimerManager.getServerTime();this.img_status.source=E<=I-C?"chongwu_img_yzczq_png":"chongwu_img_yzynq_png"}else this.img_status.source="chongwu_img_yzcsq_png"}},t.prototype.updateTopList=function(){for(var e=[],t=(b.AppFacade.getInstance().retrieveProxy(b.BackpackPy.N),1);t<6;t++){var i=this.py.getInfoByPos(t+1);i?e.push({uuid:i.uuid,notice:this.py.localNotice[t+1],chose:!1}):e.push({chose:t==this.curSelectIndex})}this.dataprovider.replaceAll(e);var o=this.py.getInfoByPos(1);this.baseitem_0.data=o?{uuid:o.uuid,type:EEntityType.EEntityTypePet,chose:0==this.curSelectIndex}:{},this.baseitem_0.dataChanged()},t.prototype.putOnPet=function(t){var i=this;b.GameMVC.petMed.showSubView(b.PetMediator.SV.SELECT_PANEL,{btnFunc:function(e){b.GameMVC.petPy.PetPutOn({uuid:e,pos:t},function(){0<i.curSelectIndex?i.dataprovider.getItemAt(i.curSelectIndex-1).chose=!1:(i.baseitem_0.data.chose=!1,i.baseitem_0.dataChanged()),i.curSelectIndex=t-1,0<=i.curSelectIndex-1?i.dataprovider.getItemAt(i.curSelectIndex-1).chose=!0:(i.baseitem_0.data.chose=!0,i.baseitem_0.dataChanged()),i.dataprovider.refresh(),i.updateBaseInfo(),i.updateServerInfo()})}})},t.prototype.activateComponent=function(){var p=this;this.btn_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){p.hide()},this),this.btn_upgrade.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){var o=this;if(Utils.UnlockMgr.checkPass(MODULE.Pet,!1).allow){this.upgradeCount=0;var n=b.Config.getConstValue("PetFeedInfo");this.timer=egret.setInterval(function(){if(!o.waitCallBack){var e=b.GameMVC.backpackPy.getInfoByCode(n[0][1][0][1]).haveNum;if(e<=0)return Utils.MsgUtils.addMidMsg("口粮不足"),void(o.timer&&egret.clearInterval(o.timer));if(o.upgradeCount<e){var t=Math.ceil(o.py.getInfoByPos(o.curSelectIndex+1).level/5);e-o.upgradeCount<t&&(t=e-o.upgradeCount),o.upgradeCount+=t;var i=o.py.getInfoByPos(o.curSelectIndex+1);o.pb_exp.value=i.exp+o.upgradeCount*n[0][0],o.bm_curExp.text=i.exp+o.upgradeCount*n[0][0],o.top_resourceBar.gp_root.$children[0].blb_num.text=e-o.upgradeCount+"",o.pb_exp.value>=o.pb_exp.maximum&&(o.upgradeLogic(),o.upgradeCount=0)}else o.upgradeLogic(),o.upgradeCount=0,o.timer&&egret.clearInterval(o.timer)}},this,100)}this.upgradeLogic(1)},this),this.btn_upgrade.addEventListener(egret.TouchEvent.TOUCH_END,function(){this.timer&&egret.clearInterval(this.timer),0<this.upgradeCount&&(this.upgradeLogic(),this.upgradeCount=0)},this),this.btn_upgrade.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){this.timer&&egret.clearInterval(this.timer),0<this.upgradeCount&&(this.upgradeLogic(),this.upgradeCount=0)},this),this.btn_upgrade.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){p.timer&&egret.clearInterval(p.timer),0<p.upgradeCount&&(p.upgradeLogic(),p.upgradeCount=0)},this),this.btn_attrDetail.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=p.py.getInfoByPos(p.curSelectIndex+1);if(e){var t=[],i=b.GameMVC.heroPy.allHeroByUuid,o=0;for(var n in i)0!=(l=i[n]).pos&&(t=b.GeneralConfig.superAttrAddAttr(t,b.GeneralConfig.ObjAttr2Arr(l.attr)),o++);t=b.GeneralConfig.AttrMutilAttr(t,1/o);var a=b.GeneralConfig.ObjAttr2Arr(JSON.parse(e.skillAttr));t=b.GeneralConfig.superAttrAddAttr(t,a),t=b.GeneralConfig.superAttrAddAttr(t,[]);var r=e.qualificationList,s=[],c=b.Config.getConstValue("PetBattleAttrRateValue");for(var n in r){var l=r[n];s.push([l.typ,c[0]+l.num/c[1]])}var h=[];t.forEach(function(o){var n=!1;s.forEach(function(e,t){if(o[0]==e[0]){var i=o[1]*e[1];1e5<i&&(i-=i%1e5),h.push([o[0],i]),n=!0}}),n||h.push(o)}),b.AppFacade.getInstance().showSubView(b.PetMediator.N,b.PetMediator.SV.ATTR_DETAIL,{info:{attr:JSON.stringify(b.GeneralConfig.ArrAttr2Obj(h))}})}},this),this.btn_reborn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=p.curSelectIndex+1,t=p.py.getInfoByPos(e);t?Utils.Socket.send("pet","RebirthPetReview",{uuid:t.uuid}).then(function(e){0<e.rewardPreview.rewards.length?PopUpManager.addPopUp({obj:new y({rewards:e.rewardPreview,uuid:t.uuid})}):Utils.MsgUtils.addMidMsg("没有可返还材料")}):Utils.MsgUtils.addMidMsg("该阵位没有上阵宠物")},this),this.btn_skillUp.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=p.py.getInfoByPos(p.curSelectIndex+1);e?PopUpManager.addPopUp({obj:new l({uuid:e.uuid}),closeCB:function(e){e&&p.updateView()}}):Utils.MsgUtils.addMidMsg("未拥有宠物")},this),this.btn_change.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){p.putOnPet(p.curSelectIndex+1)},this),this.btn_master.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=0;for(var t in p.py.allPetByUuid)p.py.allPetByUuid[t].pos&&(e+=p.py.allPetByUuid[t].level);b.AppFacade.getInstance().showSubView(b.HeroMediator.N,b.HeroMediator.SV.COMMON_LEVEL_MASTER,{title:"驯兽大师",bottomText:"总等级为出战宠物加助阵宠物等级和（属性累加）",config:b.Config.petMasterConfig(),totalLevel:e})},this),this.btn_backpack.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){b.GameMVC.backpackMed.showSubView(b.BackpackMediator.SV.BACKPACK_PANEL,{type:b.BackpackUI.ITEM_TYPE.PET})},this),this.btn_courtship.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){b.GameMVC.petMed.showSubView(b.PetMediator.SV.COURTSHIP)},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){b.GameMVC.commonMed.showHelpDialog(MODULE.Pet)},this),this.btn_feed.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){b.GameMVC.friendPy.GetFriendLootInfo(function(){b.GameMVC.petMed.showSubView(b.PetMediator.SV.FEED,{self:!0})})},this),this.btn_putDown.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=p.py.getInfoByPos(p.curSelectIndex+1);e&&0<p.curSelectIndex&&b.GameMVC.petPy.PetPutDown({uuid:e.uuid},function(){0<p.curSelectIndex&&(p.dataprovider.getItemAt(p.curSelectIndex-1).chose=!1,p.dataprovider.refresh()),p.curSelectIndex=0,p.baseitem_0.data.chose=!0,p.baseitem_0.dataChanged(),p.updateView()})},this)},t);function t(){var e=a.call(this)||this;e.py=b.AppFacade.getInstance().retrieveProxy(b.PetPy.N),e.curSelectIndex=0,e.dataprovider=new eui.ArrayCollection,e.attrItems=new Array,e.skillItems=[],e.timer=0,e.curLevel=0,e.maxLevel=0,e.costs=[[]],e.upgradeCount=0,e.waitCallBack=0,e.skinName="PetMainViewSkin";b.Config.allPetConfig();return e}b.PetMainView=e,__reflect(e.prototype,"game.PetMainView");var i,r=(i=eui.ItemRenderer,__extends(o,i),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.baseitem.touchEnabled=!1,UIActionManager.fadeBlink(this.img_add,!0,!1,1e3)},o.prototype.dataChanged=function(){this.data.uuid?(this.baseitem.updateData({type:EEntityType.EEntityTypePet,uuid:this.data.uuid}),this.img_add.visible=!1):(this.baseitem.resetFixedStyle(EEntityType.EEntityTypeHero),this.img_add.visible=!0),this.img_notice.visible=!!this.data.notice,this.img_chose.visible=!!this.data.chose},o.itemWidth=101,o.choseScale=.85,o);function o(){var e=i.call(this)||this;return e.skinName="PetItem",e}__reflect(r.prototype,"PetItem");var n,A=(n=customui.SkillItem,__extends(s,n),s.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.addChild(this.img_zhuzhan)},s.prototype.updateItem=function(e){n.prototype.updateItem.call(this,e);var t=this.data&&this.data.code;if(t){var i=b.Config.skillBaseConfig()[t];i&&2==i.action?this.img_zhuzhan.visible=!0:this.img_zhuzhan.visible=!1}else this.img_zhuzhan.visible=!1},s);function s(e){var t=n.call(this,e)||this;t.skinName="SkillItemSkin",t.touchChildren=!1;var i=new eui.Image("chongwu_img_zhujineng_png");return i.right=i.top=0,t.img_zhuzhan=i,t.scaleX=t.scaleY=.9,t}b.PetSkillItem=A,__reflect(A.prototype,"game.PetSkillItem");var c,l=(__extends(h,c=BasePanel),h.prototype.childrenCreated=function(){var t=this;c.prototype.childrenCreated.call(this),this.btn_upgrade.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.py.UpGradeSkill({uuid:t.params.uuid,code:t.skillList[t.selectIndex].subType},function(){t.updateView(),DragonBoneTools.playUniqueEffect({effectName:"common_ty_dj",parent:t,x:t.width/2,y:t.height/2})})},this),this.list_skill.dataProvider=this.dataProvider,this.list_skill.itemRenderer=d,this.list_skill.addEventListener(eui.ItemTapEvent.ITEM_TAP,function(e){t.dataProvider.getItemAt(t.selectIndex).chose=!1,t.selectIndex=e.itemIndex,t.dataProvider.getItemAt(t.selectIndex).chose=!0,t.dataProvider.refresh(),t.updateInfo()},this),this.updateView()},h.prototype.updateView=function(){if(this.params&&this.params.uuid){var e=this.py.allPetByUuid[this.params.uuid];if(e){var t=b.Config.allPetConfig()[e.code];if(t){var i=[];for(var o in e.skillDetailList){var n=e.skillDetailList[o],a=b.Config.petSkillConfig(t.subType,o);if(a[n-1]){var r=a[n-1].skill;i.push({code:r,subType:parseInt(o),level:n})}}i.sort(function(e,t){return e.subType-t.subType}),i[this.selectIndex].chose=!0,this.dataProvider.replaceAll(i),this.skillList=i,this.updateInfo()}}}},h.prototype.updateInfo=function(){var e=this.py.allPetByUuid[this.params.uuid];if(e){var t=b.Config.allPetConfig()[e.code];if(t){var i=this.skillList[this.selectIndex].code,o=this.skillList[this.selectIndex].subType,n=this.skillList[this.selectIndex].level,a=b.Config.skillBaseConfig();if(i){var r=b.Config.petSkillConfig(t.subType,o),s=r[n-1];if(this.CommonResourceBar.updateBar(r[1].costs),a[s.skill]){var c=a[s.skill];this.lb_nameBefore.text=c.name,this.lb_descBefore.text=c.desc,this.lb_levelBefore.text=n}var l=r[n];l?(c=a[l.skill],this.lb_nameAfter.text=c.name,this.lb_descAfter.text=c.desc,this.lb_levelAfter.text=n+1,this.gp_after.visible=!0,this.img_arrow.visible=!0,this.btn_upgrade.visible=!0,this.CommonIconWithNum.visible=!0,this.CommonIconWithNum.updateItem({cost:JSON.parse(l.costs)[0],style:CommonIconStyle.RIGHT}),this.gp_before.top=250):(this.CommonIconWithNum.visible=!1,this.gp_after.visible=!1,this.img_arrow.visible=!1,this.btn_upgrade.visible=!1,this.gp_before.top=370)}}}},h);function h(e){var t=c.call(this)||this;return t.py=b.AppFacade.getInstance().retrieveProxy(b.PetPy.N),t.selectIndex=0,t.skillList=[],t.dataProvider=new eui.ArrayCollection,t.skinName="PetSkillUpgradePanel",t.params=e,t}__reflect(l.prototype,"PetSkillUpgradePanel");var p,d=(p=eui.ItemRenderer,__extends(u,p),u.prototype.childrenCreated=function(){var t=this;p.prototype.childrenCreated.call(this),this.skillItem.gp_item.addChildAt(this.img_select,2),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){t.data.showSkillPanel&&t.data.showSkillPanel(0,t.data.code,!0)},this),this.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.data.showSkillPanel&&t.data.showSkillPanel(0,t.data.code,!1)},this),this.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){t.data.showSkillPanel&&t.data.showSkillPanel(0,t.data.code,!1)},this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.data.showSkillPanel&&t.data.showSkillPanel(0,t.data.code,!1)},this)},u.prototype.dataChanged=function(){this.skillItem.updateItem(this.data),this.img_select.visible=!!this.data.chose},u);function u(){var e=p.call(this)||this;return e.skinName="PetSkillUpgradePanelItemSkin",e.img_select=new eui.Image("_guild_skill_m_json.gonghui_img_jinengkuang1"),e.img_select.horizontalCenter=0,e.img_select.verticalCenter=0,e.img_select.visible=!1,e}b.PetSkillUpgradePanelItem=d,__reflect(d.prototype,"game.PetSkillUpgradePanelItem");var g,f=(g=b.HeroAttrDetailsPanel,__extends(_,g),_.prototype.childrenCreated=function(){g.prototype.childrenCreated.call(this);var e=new eui.Group;e.horizontalCenter=0,e.bottom=-60;var t=new eui.Image;t.source="maoxian_img_kaicaidi_png",t.scaleX=t.scaleY=.5,t.horizontalCenter=t.verticalCenter=0,e.addChild(t);var i=new eui.Label("宠物属性受自身资质和出战英雄属性影响");i.size=20,i.horizontalCenter=i.verticalCenter=0,e.addChild(i),this.gp_root.addChild(e)},_);function _(){return null!==g&&g.apply(this,arguments)||this}b.PetAttrDetailsPanel=f,__reflect(f.prototype,"game.PetAttrDetailsPanel");var m,y=(__extends(v,m=BasePanel),v.prototype.childrenCreated=function(){var t=this;m.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.onCloseCB=function(){t.hide()},this.CommonDaTanChuKuang.blb_title.text="宠物重置",this.gp_rewards.removeChildren(),b.GameMVC.activityMed.CommonGpAddReward(this.gp_rewards,this.params.rewards);var e=b.Config.constConfig().PetRebirthCosts,i=JSON.parse(e.constValue);this.cost.updateItem({cost:i[0]}),this.CommonResourceBar.updateBar(i),this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.Socket.send("pet","RebirthPet",{uuid:t.params.uuid}).then(function(e){b.GameMVC.petPy.updatePetDict([e.pet]),b.GameMVC.backpackPy.handleClientReward(e.clientReward,2),b.GameMVC.petMed.updateView(b.PetMediator.SV.MAIN),t.hide()})},this)},v);function v(e){var t=m.call(this)||this;return t.skinName="PetRebornPanelSkin",t.params=e,t}__reflect(y.prototype,"PetRebornPanel")}(game=game||{}),function(f){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},i.prototype.updateView=function(e){var i=this,t=e&&e.info;if(t){var o=f.Config.allPetConfig()[t.code];this.hero_model.update({model:o.model,isStatic:!0}),this.lb_ownerName.text=t.ownerName,this.lb_grow.text=t.growthNum+"";for(var n=[EAttrType.Atk,EAttrType.Life,EAttrType.Defence,EAttrType.Speed],a=[this.lb_attack,this.lb_life,this.lb_defence,this.lb_speed],r=0;r<n.length;r++){var s=n[r];for(var c in t.qualificationList){var l=t.qualificationList[c];l[0]==s&&(a[r].text=l[1]+"")}}var h=[];for(var c in t.skillDetailList){var p=t.skillDetailList[c][0],d=t.skillDetailList[c][1],u=f.Config.petSkillConfig(o.subType,p);if(u[d-1]){var g=u[d-1].skill;h.push({code:g,subType:p,level:d})}}h.sort(function(e,t){return e.subType-t.subType}),h.forEach(function(e){var t=new f.PetSkillItem(e);i.gp_skill.addChild(t),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){e.target&&e.target.data&&(i.SkillDetailsPanel.visible=!0,i.SkillDetailsPanel.updateItem(e.target.data))},i),t.addEventListener(egret.TouchEvent.TOUCH_END,function(){i.SkillDetailsPanel.visible=!1},i),t.addEventListener(egret.TouchEvent.TOUCH_CANCEL,function(){i.SkillDetailsPanel.visible=!1},i),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){i.SkillDetailsPanel.visible=!1},i)}),t.fromCourtshipResult?(this.lb_skillCount.text=t.skillCountTip,this.lb_ownerNameTip.text=o.name,this.lb_ownerName.text="",this.lb_skillTip.visible=!0):(this.lb_skillCount.text=h.length+"",this.lb_skillTip.visible=!1),h.length<=5?(this.sl_skill.height=101,this.gp_main.height=643):(this.sl_skill.height=204,this.gp_main.height=763)}},i);function i(){var e=t.call(this)||this;return e.skinName="PetOtherPetDetailSkin",e}f.PetOtherPetDetail=e,__reflect(e.prototype,"game.PetOtherPetDetail")}(game=game||{}),function(r){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.rootPanel.blb_title.text="宠 物",this.initList(),this.activateComponent()},i.prototype.initList=function(){this.list_item.itemRenderer=n},i.prototype.updateView=function(e){var t=this;this.btnFunc=e&&e.btnFunc||this.btnFunc;var i=[],o=r.GameMVC.petPy.allPetByUuid;for(var n in o){var a=o[n];a.pos||i.push({info:a,btnFunc:function(e){t.btnFunc&&t.btnFunc(e.info.uuid),t.hide()}})}i.sort(function(e,t){var i=e.info,o=t.info;return i.level!=o.level?o.level-i.level:i.fightCap!=o.fightCap?o.fightCap-i.fightCap:i.sortKey!=o.sortKey?o.sortKey-i.sortKey:i.config.code-o.config.code}),this.list_item.dataProvider=new eui.ArrayCollection(i),0<i.length?this.gp_empty.visible=!1:this.gp_empty.visible=!0},i.prototype.activateComponent=function(){var e=this;this.rootPanel.onCloseCB=function(){e.hide()}},i);function i(){var e=t.call(this)||this;return e.skinName="HeroSelectSkin",e}r.PetSelecePanel=e,__reflect(e.prototype,"game.PetSelecePanel");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.btn_oper.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.btnFunc&&this.data.btnFunc(this.data)},this),this.gp_baseitem.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().showSubView(r.PetMediator.N,r.PetMediator.SV.SELF_PET_DETAIL,{uuid:this.data.info.uuid})},this),this.baseItem=customui.BaseItemFactory.create(),this.baseItem.touchEnabled=!1,this.gp_baseitem.addChild(this.baseItem)},a.prototype.dataChanged=function(){this.lb_name.text=this.data.info.config.name,this.baseItem.updateData({uuid:this.data.info.uuid,type:EEntityType.EEntityTypePet}),this.gp_lock.visible=!1},a);function a(){var e=o.call(this)||this;return e.skinName="HeroSelectPanel_HeroItem",e}__reflect(n.prototype,"PetSelectPanel_HeroItem")}(game=game||{}),function(e){var i,t=(__extends(o,i=BaseMediator),o.prototype.initSubView=function(){this.addSubView(o.SV.ENTRANCE,e.PvpEntranceView)},o.prototype.listNotificationInterests=function(){return[CN.HIDE_LOADING,CN.PLAYER_LEVEL_UP]},o.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_LOADING:this.hideAllSubView();break;case CN.PLAYER_LEVEL_UP:NoticeManager.updateNotice(NT.CITY_PVP_ENTRANCE)}},o.N="PvpEntranceMediator",o.SV={ENTRANCE:1},o);function o(e){void 0===e&&(e=null);var t=i.call(this,o.N,e)||this;return NoticeManager.setChildType(NT.CITY_PVP_ENTRANCE,[NT.ARENA]),t}e.PvpEntranceMediator=t,__reflect(t.prototype,"game.PvpEntranceMediator")}(game=game||{}),function(e){var t=(i.registerAll=function(){},i);function i(){}e.PvpEntranceProcessor=t,__reflect(t.prototype,"game.PvpEntranceProcessor")}(game=game||{}),function(e){var t,i=(__extends(o,t=BaseProxy),o.N="PvpEntrancePy",o);function o(){return t.call(this,o.N)||this}e.PvpEntrancePy=i,__reflect(i.prototype,"game.PvpEntrancePy")}(game=game||{}),function(a){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.scroller.scrollPolicyH=eui.ScrollPolicy.OFF,this.img_title.source="wfrk_txt_jjtz_png"},i.prototype.initList=function(){this.item_list=new eui.List;var e=new eui.VerticalLayout;(this.item_list.layout=e).gap=10,e.horizontalAlign=egret.HorizontalAlign.CENTER,this.item_list.itemRenderer=n,this.scroller.viewport=this.item_list},i.prototype.updateView=function(){var e=[];for(var t in this.ENTRANCE_CONFIG)this.ENTRANCE_CONFIG[t].view=this,e.push(this.ENTRANCE_CONFIG[t]);this.item_list.dataProvider=new eui.ArrayCollection(e),this.gp_root.height=179*e.length+10*(e.length-1)},i);function i(){var e=t.call(this)||this;return e.ENTRANCE_CONFIG={ARENA:{desc:"竞技场",rankingType:void 0,moduleId:MODULE.Arena,bg:"wfrk_img_rukou_jjc_png",descDown:"可获取竞技币、兑换道具和碎片",notice:NT.ARENA},TEAM_ARENA:{desc:"组队竞技场",rankingType:void 0,moduleId:MODULE.TeamArena,bg:"wfrk_img_rukou_zdjj_png",descDown:"",notice:NT.TEAM_ARENA_ENTRANCE},PEAK_WAR:{desc:"巅峰竞技场",rankingType:void 0,moduleId:MODULE.PeakWar,bg:"wfrk_img_rukou_dfjjc_png",descDown:"可获取主角和时装培养资源",notice:NT.PEAK_WAR,shopType:ShopType.ShopTypePeakWar},WORLD_KING:{desc:"排位赛",rankingType:void 0,moduleId:MODULE.WorldKing,bg:"wfrk_img_rukou_pws_png",descDown:"",notice:NT.WORLD_KING},GLORY_ARENA:{desc:"荣誉竞技场",rankingType:void 0,moduleId:MODULE.GloryArena,bg:"wfrk_img_rukou_ryjjc_png",descDown:"可获取荣誉币、兑换道具和碎片",notice:NT.GLORT_ARENA}},e.skinName="PvpEntranceViewSkin",Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_view_close),e._popActionType=5,e._removeActionType=6,e}a.PvpEntranceView=e,__reflect(e.prototype,"game.PvpEntranceView");var o,n=(o=eui.ItemRenderer,__extends(r,o),r.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.gp_touch.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.MainJumpConfig.jumpTo(this.data.moduleId)?a.AppFacade.getInstance().hideSubView(a.PvpEntranceMediator.N,a.PvpEntranceMediator.SV.ENTRANCE):(this.gp_bg.scaleX=1,this.gp_bg.scaleY=1)},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.currentState="up"},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.shopType&&a.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:e.shopType})},this)},r.prototype.dataChanged=function(){this.img_bg.source=this.data.bg,this.lb_unlock.text=this.data.descDown||"",this.data.notice&&NoticeManager.addNoticeListener(this.data.notice,this.gp_bg,this.data.view,{percentX:554/578,percentY:0});var e=Utils.UnlockMgr.checkPass(this.data.moduleId,!1);if(e.allow)switch(this.data.moduleId){case MODULE.TeamArena:this.countdownForTeamArena();break;case MODULE.WorldKing:this.countdownForWorldKing();break;case MODULE.PeakWar:this.countdownForPeakWar();break;case MODULE.GloryArena:this.countDownGloryArena()}else UIActionManager.setAbsGrey(this,!0),e.ext&&"server"!=e.ext.lockType&&(this.lb_unlock.text=e.ext.tips.replace("解锁","开启"));this.data.shopType?(this.shopType=this.data.shopType,this.btn_shop.visible=!0):this.btn_shop.visible=!1,this.data.notice&&NoticeManager.addNoticeListener(this.data.notice,this.gp_bg,this.data.view,{percentX:554/578,percentY:0})},r.prototype.getRemainingTime=function(e){return Utils.TimerManager.getFormatBySecond1(e)},r.prototype.countdownForTeamArena=function(){var e=this;this.gp_time.visible=!0;var t=a.GameMVC.battleZoneArenaPy.getOpenInfo();this.timerDt=t.remainingTime;var i=t.isOpen;this.lb_miaoshu.text=i?"结束倒计时：":"开启倒计时：",this.blb_time.text=this.getRemainingTime(this.timerDt),UIActionManager.setAbsGrey(this.gp_bg,!i),this.gp_bg.touchEnabled=i,this.endingTimer||(this.endingTimer=egret.setInterval(function(){0<=e.timerDt?e.blb_time.text=e.getRemainingTime(--e.timerDt):(egret.clearInterval(e.endingTimer),e.dataChanged())},this,1e3))},r.prototype.countdownForWorldKing=function(){var e=this,t=a.AppFacade.getInstance().retrieveProxy(a.WorldKingPy.N).getOpenInfo(),i=Utils.TimerManager.getServerTime(!1),o=t.latestEndDt-i,n=t.latestOpenDt-i;this.gp_time.visible=!0,0<n?(this.gp_bg.touchEnabled=!1,this.lb_miaoshu.text="开启倒计时：",this.timerDt=o,this.blb_time.text=this.getRemainingTime(n),UIActionManager.setAbsGrey(this.gp_bg,!0)):(this.gp_bg.touchEnabled=!0,this.lb_miaoshu.text="结束倒计时：",this.timerDt=o,this.blb_time.text=this.getRemainingTime(o),UIActionManager.setAbsGrey(this.gp_bg,!1)),this.endingTimer||(this.endingTimer=egret.setInterval(function(){0<=e.timerDt?e.blb_time.text=""+e.getRemainingTime(--e.timerDt):(e.countdownForWorldKing(),e.endingTimer&&egret.clearTimeout(e.endingTimer))},this,1e3))},r.prototype.onDestroy=function(){egret.clearInterval(this.endingTimer),egret.clearInterval(this.endingTimer1),egret.clearInterval(this.startTimer)},r.prototype.countdownForPeakWar=function(){a.GameMVC.peakWarPy.curType===PEAK_WAR_TYPE.HIGH_END?(this.lb_unlock.text="当前已结束",UIActionManager.setAbsGrey(this.gp_bg,!0)):(this.lb_unlock.text=this.data.descDown,UIActionManager.setAbsGrey(this.gp_bg,!1))},r.prototype.countDownGloryArena=function(){var e=this;this.lb_unlock.text="";var t=Utils.TimerManager.getServerTime(!1),i=a.GameMVC.gloryArenaPy.arenaInfo.endDt-t,o=a.GameMVC.gloryArenaPy.arenaInfo.startDt-t;i<0&&o<0||(this.gp_time.visible=!0,0<o?(this.gp_bg.touchEnabled=!1,this.lb_miaoshu.text="开启倒计时：",this.timerDt=i,this.blb_time.text=this.getRemainingTime(o),UIActionManager.setAbsGrey(this.gp_bg,!0)):(this.gp_bg.touchEnabled=!0,this.lb_miaoshu.text="结束倒计时：",this.timerDt=i,this.blb_time.text=this.getRemainingTime(i),UIActionManager.setAbsGrey(this.gp_bg,!1)),this.endingTimer||(this.endingTimer=egret.setInterval(function(){0<=e.timerDt?e.blb_time.text=""+e.getRemainingTime(--e.timerDt):(e.countDownGloryArena(),e.endingTimer&&egret.clearTimeout(e.endingTimer))},this,1e3)))},r);function r(){var e=o.call(this)||this;return e.skinName="EntranceView_ListItem",e.once(egret.Event.REMOVED_FROM_STAGE,e.onDestroy,e),e}__reflect(n.prototype,"EntranceView_ListItem")}(game=game||{}),function(t){var i,e=(__extends(o,i=BaseMediator),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,t.RaceTowerMainView),this.addSubView(o.SV.CHALLENGE,t.RaceTowerChallengeView),this.addSubView(o.SV.PREVIEW,t.RaceTowerBossPreviewPanel)},o.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.PLAYER_LEVEL_UP,CN.GENERAL_PASS_DAY,CN.LOGIN_FINAL_DONE]},o.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.PLAYER_LEVEL_UP:!t.GameMVC.raceTowerPy.info.infos.length&&Utils.UnlockMgr.checkPass(MODULE.RaceTower,!1).allow&&t.GameMVC.raceTowerPy.GetRaceTowerInfo();break;case CN.GENERAL_PASS_DAY:case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.RaceTower,!1).allow&&t.GameMVC.raceTowerPy.GetRaceTowerInfo()}},o.N="RaceTowerMed",o.SV={MAIN:1,CHALLENGE:2,PREVIEW:3},o);function o(e){return void 0===e&&(e=null),i.call(this,o.N,e)||this}t.RaceTowerMed=e,__reflect(e.prototype,"game.RaceTowerMed")}(game=game||{}),function(e){var t=(i.registerAll=function(){},i);function i(){}e.RaceTowerProcessor=t,__reflect(t.prototype,"game.RaceTowerProcessor")}(game=game||{}),function(a){var t,e=(__extends(i,t=BaseProxy),i.prototype.getInfoByType=function(e){for(var t in this.info.infos){var i=this.info.infos[t];if(i.type==e)return i}},i.prototype.GetRaceTowerInfo=function(e,t){var i=this;void 0===e&&(e=0),Utils.UnlockMgr.checkPass(MODULE.RaceTower,!1)&&Utils.Socket.send("raceTower","GetRaceTowerInfo",{type:e}).then(function(e){i.info.update(e.info),t&&t()})},i.prototype.ChangeFormation=function(e,t,i){var o=this;void 0===e&&(e=0),Utils.UnlockMgr.checkPass(MODULE.RaceTower,!1)&&Utils.Socket.send("raceTower","ChangeFormation",{type:e,formation:t}).then(function(e){o.info.update({infos:[e.info]}),i&&i()})},i.prototype.Challenge=function(t,i){var o=this;a.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeRaceTower,pb1:"raceTower",pb2:"Challenge",params:{type:t},reqCB:function(e){o.info.update({challengeInfo:e.challengeInfo,infos:[e.info]})},doneCB:function(e){i&&i(),a.AppFacade.getInstance().retrieveProxy(a.FightPy.N).queueExceExitCB(),a.GameMVC.raceTowerMed.showSubView(a.RaceTowerMed.SV.CHALLENGE,{type:t,afterFight:!!e.winC})}})},i.prototype.BuyChallengeCount=function(t,i){var o=this;Utils.Socket.send("raceTower","BuyChallengeCount",{num:t}).then(function(e){Utils.MsgUtils.addMidMsg("成功购买"+t+"次"),o.info.update({challengeInfo:e.challengeInfo}),i&&i()})},i.N="RaceTowerPy",i);function i(){var e=t.call(this,i.N)||this;return e.info=new n,NoticeManager.setChildType(NT.RACETOWER_ENTRANCE,NT.RACETOWER_CAN_FIGHT),NoticeManager.registerCB(NT.RACETOWER_CAN_FIGHT,function(){return e.info&&e.info.challengeInfo&&0<e.info.challengeInfo.count},e,MODULE.RaceTower),e}a.RaceTowerPy=e,__reflect(e.prototype,"game.RaceTowerPy");var o,n=(o=a.BaseVO,__extends(r,o),r.prototype.update=function(e){if(this.challengeInfo=e.challengeInfo||this.challengeInfo,e.infos)for(var t in e.infos){var i=e.infos[t];a.Config.raceTowerConfig(i.type)[i.id]||(i.id--,i.pass=!0);var o=!1;for(var n in this.infos)this.infos[n].type==i.type&&(this.infos[n]=i,o=!0);o||this.infos.push(i)}NoticeManager.updateNotice(NT.RACETOWER_ENTRANCE)},r);function r(){var e=o.call(this)||this;return e.challengeInfo={count:0,buyCount:0},e.infos=[],e}a.RaceTowerInfo=n,__reflect(n.prototype,"game.RaceTowerInfo")}(game=game||{}),function(r){var i,e=(__extends(t,i=BasePanel),t.prototype.childrenCreated=function(){var n=this;i.prototype.childrenCreated.call(this),this.btn_seekHelp.visible=!1,this.bm_seekHelpTime.visible=!1,this.btn_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=r.GameMVC.raceTowerPy.getInfoByType(n.params.type);if(e){var t=e.formation,i=0;for(var o in t.heros)if(t.heros[o]){i++;break}0==i?PopUpManager.addPopUp({obj:new r.RaceTowerFormationView({type:n.params.type,formPre:!0}),closeCB:function(e){e&&(n.hide(),r.GameMVC.raceTowerMed.hideAllSubView(),r.GameMVC.raceTowerPy.Challenge(n.params.type))}}):(n.hide(),r.GameMVC.raceTowerMed.hideAllSubView(),r.GameMVC.raceTowerPy.Challenge(n.params.type))}},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;PopUpManager.addPopUp({obj:new r.RaceTowerFormationView({type:this.params.type,formPre:!0}),closeCB:function(e){e&&(t.hide(),r.GameMVC.raceTowerMed.hideAllSubView(),r.GameMVC.raceTowerPy.Challenge(t.params.type))}})},this)},t.prototype.updateView=function(e){var i=this;this.params=e||this.params;var t=r.Config.raceTowerConfig()[e.id];this.lb_title.text=""+t.name,this.blb_cap.text=Utils.MathUtils.formatNumStyle2(t.fightCapacity),JSON.parse(t.passReward).forEach(function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,t.updateData({type:e[0],id:e[1],num:e[2]}),i.gp_rewards.addChild(t)});var o=[];try{for(var n=1;n<=6;n++){var a=t["creep"+n];a&&""!=a&&o.push(JSON.parse(t["creep"+n])[0])}}catch(e){this.log(e)}o.forEach(function(e){if(null!=e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e}),t.scaleX=t.scaleY=.7,t.touchEnabled=!1,i.gp_enermy.addChild(t)}})},t);function t(e){var t=i.call(this)||this;return t.skinName="RaceTowerBossPreviewPanelSkin",t._popActionType=5,t._removeActionType=6,t}r.RaceTowerBossPreviewPanel=e,__reflect(e.prototype,"game.RaceTowerBossPreviewPanel")}(game=game||{}),function(u){var t,e=(__extends(i,t=BaseFull),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.gp_creep1.touchEnabled=this.gp_creep2.touchEnabled=this.gp_creep3.touchEnabled=!1,this.activateComponent(),this.makeTween(!0)},i.prototype.updateView=function(e){this.params=e||this.params,this.updateBaseInfo(),this.updateModelAndPos(e&&e.afterFight)},i.prototype.activateComponent=function(){var t=this;this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.hide(),u.GameMVC.raceTowerMed.showSubView(u.RaceTowerMed.SV.MAIN)},this),this.gp_creep0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=u.GameMVC.raceTowerPy.getInfoByType(t.params.type);e&&(e.pass?Utils.MsgUtils.addMidMsg("已通关"):u.AppFacade.getInstance().showSubView(u.RaceTowerMed.N,u.RaceTowerMed.SV.PREVIEW,{id:e.id,type:t.params.type}))},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e;switch(t.params.type){case ERaceTowerType.Human:e="RankingTypeRaceTowerHuman";break;case ERaceTowerType.Athanasy:e="RankingTypeRaceTowerAthanasy";break;case ERaceTowerType.Orc:e="RankingTypeRaceTowerOrc";break;case ERaceTowerType.DemonNEldar:e="RankingTypeRaceTowerDemonNEldar";break;case ERaceTowerType.Elf:e="RankingTypeRaceTowerElf"}u.AppFacade.getInstance().showSubView(u.RankMediator.N,u.RankMediator.SV.COMMON,{module:e})},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.buyCount()},this),this.btn_formation.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new u.RaceTowerFormationView({type:t.params.type})})},this)},i.prototype.updateBaseInfo=function(){switch(this.blb_count.text=u.GameMVC.raceTowerPy.info.challengeInfo.count+"",this.params.type){case ERaceTowerType.Human:this.img_top.source="zzt_img_rzsy_png";break;case ERaceTowerType.Athanasy:this.img_top.source="zzt_img_bssy_png";break;case ERaceTowerType.Orc:this.img_top.source="zzt_img_szsy_png";break;case ERaceTowerType.DemonNEldar:this.img_top.source="zzt_img_smsy_png";break;case ERaceTowerType.Elf:this.img_top.source="zzt_img_jlsy_png"}},i.prototype.updateModelAndPos=function(e){var t=this;void 0===e&&(e=!1);var i=u.GameMVC.raceTowerPy.getInfoByType(this.params.type);if(i){for(var o=e?i.id-1:i.id,n=u.Config.raceTowerConfig(this.params.type),a=u.Config.creepConfig(),r=0;r<4;r++){var s=n[o+r],c=this["gp_creep"+r];if(c){c.visible=!0;var l=c.$children[2],h=c.$children[3],p=c.$children[4];if(l.text="第"+(o+r)+"关",s){var d=JSON.parse(s.creep1)[0];h.visible=!0,p&&(p.visible=!1),h.update({code:a[d]&&a[d].heroId,isStatic:!0}),c.horizontalCenter=this.initPos[r+1][0],c.verticalCenter=this.initPos[r+1][1],c.scaleX=this.initPos[r+1][2],c.scaleY=this.initPos[r+1][2]}else h.visible=!1,p&&(p.visible=!0)}}e&&egret.setTimeout(function(){t.moveCreepAfterFight()},this,500)}},i.prototype.moveCreepAfterFight=function(){var e=this,t=0;GameRootLayer.gameLayer().switchTouchEnable(!1);for(var i=0;i<4;i++){var o=this["gp_creep"+i];o&&egret.Tween.get(o).to({horizontalCenter:this.initPos[i][0],verticalCenter:this.initPos[i][1],scaleX:this.initPos[i][2],scaleY:this.initPos[i][2]},1e3).call(function(){t++,GameRootLayer.gameLayer().switchTouchEnable(!0),4==t&&e.updateView()})}},i.prototype.buyCount=function(){var t=this;Number(u.Config.constConfig().RaceTowerMaxCount.constValue)<=u.GameMVC.raceTowerPy.info.challengeInfo.count?Utils.MsgUtils.addMidMsg("当前次数已满"):u.AppFacade.getInstance().showSubView(u.CommonMediator.N,u.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.RaceTower,hasBuyNum:u.GameMVC.raceTowerPy.info.challengeInfo.buyCount,buyCB:function(e){u.GameMVC.raceTowerPy.BuyChallengeCount(e,function(){t.blb_count.text=u.GameMVC.raceTowerPy.info.challengeInfo.count+""})},curNum:u.GameMVC.raceTowerPy.info.challengeInfo.count,maxNum:Number(u.Config.constConfig().RaceTowerMaxCount.constValue),maxBuyNum:u.Config.VIPConfig().raceTowerBuyTimes})},i.prototype.makeTween=function(e){e?(egret.Tween.get(this.gp_creep0.$children[0],{loop:!0}).to({bottom:10},500).to({bottom:0},500),egret.Tween.get(this.gp_creep1.$children[0],{loop:!0}).to({bottom:10},600).to({bottom:0},600),egret.Tween.get(this.gp_creep2.$children[0],{loop:!0}).to({bottom:10},800).to({bottom:0},800),egret.Tween.get(this.gp_creep3.$children[0],{loop:!0}).to({bottom:10},1e3).to({bottom:0},1e3),egret.Tween.get(this.gp_creep0.$children[3],{loop:!0}).to({bottom:286},500).to({bottom:276},500),egret.Tween.get(this.gp_creep1.$children[3],{loop:!0}).to({bottom:286},600).to({bottom:276},600),egret.Tween.get(this.gp_creep2.$children[3],{loop:!0}).to({bottom:286},800).to({bottom:276},800),egret.Tween.get(this.gp_creep3.$children[3],{loop:!0}).to({bottom:286},1e3).to({bottom:276},1e3)):(egret.Tween.removeTweens(this.gp_creep0.$children[0]),egret.Tween.removeTweens(this.gp_creep1.$children[0]),egret.Tween.removeTweens(this.gp_creep2.$children[0]),egret.Tween.removeTweens(this.gp_creep3.$children[0]),egret.Tween.removeTweens(this.gp_creep0.$children[3]),egret.Tween.removeTweens(this.gp_creep1.$children[3]),egret.Tween.removeTweens(this.gp_creep2.$children[3]),egret.Tween.removeTweens(this.gp_creep3.$children[3]))},i);function i(){var e=t.call(this)||this;return e.initPos=[[209,1100,1.2],[0,259,1],[209,-76,.45],[-193,-173,.34],[32,-284,.17]],e.skinName="RaceTowerChallengeViewSkin",e}u.RaceTowerChallengeView=e,__reflect(e.prototype,"game.RaceTowerChallengeView")}(game=game||{}),function(l){var n,e=(__extends(t,n=BasePanel),t.prototype.childrenCreated=function(){var o=this;n.prototype.childrenCreated.call(this),this.initBtnListener(),this.s_baseitem6.touchEnabled=this.s_baseitem7.touchEnabled=!1,this.scroller_hero.scrollPolicyH=eui.ScrollPolicy.OFF,this.dragGroup.initConfig({0:{x:7,y:4,w:73.5,h:73.5},1:{x:85,y:4,w:73.5,h:73.5},2:{x:163,y:4,w:73.5,h:73.5},3:{x:272,y:4,w:73.5,h:73.5},4:{x:350,y:4,w:73.5,h:73.5},5:{x:428,y:4,w:73.5,h:73.5}});for(var e=0;e<6;e++){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,t.touchEnabled=!1,this.id2baseitem[e]=t,this.id2baseitem[e].resetFixedStyle(EEntityType.EEntityTypeHero),this.dragGroup.addItem2Id(t,e)}this.dragGroup.dragDoneCB=this.exchangeHero.bind(this),this.dragGroup.onTapCB=function(e,t){var i=o.heroList[o.curIndex][e];o.touchHeroEvent(!1,{info:l.GameMVC.heroPy.allHeroByUuid[i]}),o.updateAllHeroByFilter(),t&&t()},this.initHeroPetArtLocalList(),this.updateView()},t.prototype.initBtnListener=function(){var e,t,i=this;switch(this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.hide()},this),this.btn_yes.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.getUpHeroList();if(0!=e.heros.filter(function(e){return!!e}).length)if(this.params.touchHoldCB){var t=this.params.touchHoldCB(e);t&&(this.opperationParams=1,l.GameMVC.raceTowerPy.ChangeFormation(this.params.type,t,this.hide.bind(this)))}else this.opperationParams=1,l.GameMVC.raceTowerPy.ChangeFormation(this.params.type,e,this.hide.bind(this));else Utils.MsgUtils.addMidMsg("至少上阵一个英雄")},this),this.gp_myPet.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new l.CommonChosePanel({getInfos:function(){return l.GameMVC.petPy.allPetByUuid},needLongTap:!0,singleChoose:!0,selectUuids:i.petList[0]?i.petList:[],type:EEntityType.EEntityTypePet,checkFull:function(e){return 1<=e.length},sortFunc:function(e,t){return e.info.code-t.info.code},fullTip:"只能上阵一只宠物",title:"请选择出战宠物"}),closeCB:function(e){i.updatePetOrArtUuidByChoose(EEntityType.EEntityTypePet,e)}})},this),this.gp_myArt.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new l.CommonChosePanel({getInfos:function(){return l.GameMVC.magicalArtifactPy.allMagicalArtifactByUuid},singleChoose:!0,selectUuids:i.artList[0]?i.artList:[],type:EEntityType.EEntityTypeMagical,checkFull:function(e){return 1<=e.length},sortFunc:function(e,t){return e.info.code-t.info.code},fullTip:"只能上阵一个神兵",title:"请选择出战神兵"}),closeCB:function(e){i.updatePetOrArtUuidByChoose(EEntityType.EEntityTypeMagical,e)}})},this),this.params.type){case ERaceTowerType.Human:e=HeroRaceType.Human;break;case ERaceTowerType.Athanasy:e=HeroRaceType.Athanasy;break;case ERaceTowerType.Orc:e=HeroRaceType.Orc;break;case ERaceTowerType.DemonNEldar:e=HeroRaceType.Demon,t=HeroRaceType.Eldar;break;case ERaceTowerType.Elf:e=HeroRaceType.Elf}for(var o=0;o<6;o++){var n=this.gp_filters_list.$children[o];n&&(o+1==e||o+1==t||(UIActionManager.setGrey(n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.params.type==ERaceTowerType.DemonNEldar?Utils.MsgUtils.addMidMsg("只能出战神族或魔族英雄"):Utils.MsgUtils.addMidMsg("只能出战"+HeroRaceConfig[e].name+"英雄")},this)))}},t.prototype.updateView=function(e){this.params=e||this.params||{},this.getAllHeroList(),this.updateAllHeroByFilter(),this.updateUpHeroBI(),this.updatePetAndArtInfo(),e&&e.formPre?this.btn_yes.label="挑 战":this.btn_yes.label="保 存"},t.prototype.updateUpHeroBI=function(){var i=this;this.heroList[this.curIndex].forEach(function(e,t){e?(i.id2baseitem[t].updateData({type:EEntityType.EEntityTypeHero,uuid:e}),i.id2baseitem[t].img_zudui.visible=!1):i.id2baseitem[t].resetFixedStyle(EEntityType.EEntityTypeHero)})},t.prototype.getAllHeroList=function(){this.allHeroInfo=[];var e=this.ITEM_TYPE_CONFIG[l.BackpackUI.ITEM_TYPE.HERO].getAllInfo();if(e)for(var t in e){var i=e[t];this.allHeroInfo.push({type:l.BackpackUI.ITEM_TYPE.HERO,info:i,teamNum:this.judgeUpTeam(i.uuid),touchCB:this.touchHeroEvent.bind(this)})}},t.prototype.updateAllHeroByFilter=function(){this.scroller_hero.stopAnimation();var e,t,i=[],o=this.ITEM_TYPE_CONFIG[l.BackpackUI.ITEM_TYPE.HERO];switch(this.params.type){case ERaceTowerType.Human:e=HeroRaceType.Human;break;case ERaceTowerType.Athanasy:e=HeroRaceType.Athanasy;break;case ERaceTowerType.Orc:e=HeroRaceType.Orc;break;case ERaceTowerType.DemonNEldar:e=HeroRaceType.Demon,t=HeroRaceType.Eldar;break;case ERaceTowerType.Elf:e=HeroRaceType.Elf}var n,a=o.sortConfig&&o.sortConfig.defaultSortFunc,r=o.getAllInfo();if(r)for(var s in r){var c=r[s];this.curFilter,(n=c).config.race!=e&&n.config.race!=t||i.push({type:l.BackpackUI.ITEM_TYPE.HERO,info:c,teamNum:this.judgeUpTeam(c.uuid),touchCB:this.touchHeroEvent.bind(this)})}0<i.length&&a&&i.sort(a),this.dataprovider=new eui.ArrayCollection(i),this.list_hero.itemRenderer=h,this.list_hero.dataProvider=this.dataprovider},t.prototype.initHeroPetArtLocalList=function(){this.heroList=[["","","","","",""]],this.petList=[""],this.artList=[""];var e=l.GameMVC.raceTowerPy.getInfoByType(this.params.type);e&&(6==e.formation.heros.length&&(this.heroList[0]=e.formation.heros),e.formation.pets[0]&&(this.petList=e.formation.pets),e.formation.magicals[0]&&(this.artList=e.formation.magicals),this.updatePetAndArtInfo())},t.prototype.updatePetAndArtInfo=function(){this.img_addpet_1.visible=!0,this.img_addart_1.visible=!0;var e=this.curIndex,t=void 0,i=void 0,o=this.petList[e],n=this.artList[e];""!=o&&(t=l.GameMVC.petPy.allPetByUuid[o]),""!=n&&(i=l.GameMVC.magicalArtifactPy.allMagicalArtifactByUuid[n]),t?(this.img_addpet_1.visible=!1,this.s_baseitem6.updateData({type:EEntityType.EEntityTypePet,code:t.code}),this.s_baseitem6.visible=!0):(this.img_addpet_1.visible=!0,this.s_baseitem6.visible=!1),i?(this.img_addart_1.visible=!1,this.s_baseitem7.updateData({type:EEntityType.EEntityTypeMagical,code:i.code}),this.s_baseitem7.visible=!0):(this.img_addart_1.visible=!0,this.s_baseitem7.visible=!1)},t.prototype.updatePetOrArtUuidByChoose=function(e,t){e==EEntityType.EEntityTypeMagical?this.artList=t:e==EEntityType.EEntityTypePet&&(this.petList=t),this.updatePetAndArtInfo()},t.prototype.judgeUpTeam=function(i){var o=0;return this.heroList.forEach(function(e,t){o||e.forEach(function(e){e==i&&(o=t+1)})}),o},t.prototype.getUpHeroList=function(){var e=[];for(var t in this.heroList[0]){var i=this.heroList[0][t];e.push(i)}return{heros:e,pets:this.petList[0]?[this.petList[0]]:[],magicals:this.artList[0]?[this.artList[0]]:[]}},t.prototype.touchHeroEvent=function(e,o,t){if(e){var i=0;if(this.heroList[this.curIndex].forEach(function(e,t){i||e||(i=t+1)}),0==i)Utils.MsgUtils.addMidMsg("当前阵容已上满");else{var n=0==o.info.dermaCode?void 0:l.Config.getHeroDermaConfig()[o.info.dermaCode].avatar;o.teamNum=this.curIndex+1,this.id2baseitem[i-1].updateData({vo:o.info,type:EEntityType.EEntityTypeHero,avatar:n}),this.heroList[this.curIndex][i-1]=o.info.uuid,t&&t()}}else{var a=0,r=0;this.heroList.forEach(function(e,i){a||e.forEach(function(e,t){a||e==o.info.uuid&&(a=i+1,r=t+1)})}),0!=a&&(this.id2baseitem[r-1].resetFixedStyle(EEntityType.EEntityTypeHero),o.teamNum=0,this.heroList[a-1][r-1]="",t&&t())}},t.prototype.exchangeHero=function(e,t,i){if(e<0||t<0)i&&i();else{var o=this.heroList[this.curIndex][e];this.heroList[this.curIndex][e]=this.heroList[this.curIndex][t],this.heroList[this.curIndex][t]=o,this.updateUpHeroBI(),i&&i()}},t.prototype.perClose=function(){this.params.doneCB&&this.params.doneCB()},t);function t(e){var t,i=n.call(this)||this;return i.allHeroInfo=[],i.id2baseitem=[],i.curIndex=0,i.dataprovider=new eui.ArrayCollection,i.curFilter={},i.heroList=[[],[],[]],i.petList=[],i.artList=[],i.ITEM_TYPE_CONFIG=((t={})[l.BackpackUI.ITEM_TYPE.HERO]={desc:"英雄",hasHankBook:!0,barSource:{up:"_btn_yq_m_json.beibao_yeqian_yingxiong_0",down:"_btn_yq_m_json.beibao_yeqian_yingxiong_1"},getAllInfo:function(){var e=[],t=l.AppFacade.getInstance().retrieveProxy(l.HeroPy.N);for(var i in t.allHeroByUuid){var o=t.allHeroByUuid[i];0==o.config.race&&0==o.config.profession||e.push(o)}return e},filterConfig:{data:[[{race:HeroRaceType.Human,icon:HeroRaceConfig[HeroRaceType.Human].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Elf,icon:HeroRaceConfig[HeroRaceType.Elf].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Orc,icon:HeroRaceConfig[HeroRaceType.Orc].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Athanasy,icon:HeroRaceConfig[HeroRaceType.Athanasy].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Demon,icon:HeroRaceConfig[HeroRaceType.Demon].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"},{race:HeroRaceType.Eldar,icon:HeroRaceConfig[HeroRaceType.Eldar].raceIconBig,chosenImg:"beibao_img_daxuanzhongq_png"}]],filterFunc:function(e,t){var i=!e.race||0==e.race.length||-1!=e.race.indexOf(t.config.race),o=!e.star||0==e.star.length||-1!=e.star.indexOf(t.starLevel);return i&&o},addFilter:function(e,t){var i=t.race?"race":"star";e[i]||(e[i]=[]);var o=e[i].indexOf(t[i]);-1==o?(e[i].splice(0),e[i].push(t[i])):e[i].splice(o,1)},autoFilterFunc:function(e,t){return e.starLevel<=4},autoFilterTipsFunc:function(e){return"无五星以下英雄"}},sortConfig:{data:[{desc:"等级"},{desc:"星级"}],getSortFunc:function(e){switch(e){case 0:return function(e,t){return t.info.level-e.info.level};case 1:return function(e,t){return t.info.starLevel-e.info.starLevel};default:return function(){return-1}}},defaultSortFunc:function(e,t){var i=e.info,o=t.info;if(i.starLevel!=o.starLevel)return o.starLevel-i.starLevel;if(i.level!=o.level)return o.level-i.level;var n=l.Config.allHeroConfig()[i.code],a=l.Config.allHeroConfig()[o.code];return n.race!=a.race?n.race-a.race:n.profession!=a.profession?HERO_SORT_ORDER[a.profession]-HERO_SORT_ORDER[n.profession]:i.code-o.code}}},t),i.skinName="RaceTowerFormationViewSkin",i.params=e,i}l.RaceTowerFormationView=e,__reflect(e.prototype,"game.RaceTowerFormationView");var i,h=(i=l.GloryArenaTeamHeroItem,__extends(o,i),o);function o(){var e=i.call(this)||this;return e.CHOOSE_NUM=["chuanghao_img_gouxuan_png","chuanghao_img_gouxuan_png","chuanghao_img_gouxuan_png"],e}__reflect(h.prototype,"RaceTowerHeroItem")}(game=game||{}),function(p){var t,e=(__extends(i,t=BaseFull),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),UIActionManager.addEffect(this.gp_god,"common_ui_zhongzuta_01_1",{childIndex:0,offectY:-10}),UIActionManager.addEffect(this.gp_orc,"common_ui_zhongzuta_01_2",{childIndex:0,offectY:-20}),UIActionManager.addEffect(this.gp_human,"common_ui_zhongzuta_01_3",{childIndex:0,offectY:-30}),UIActionManager.addEffect(this.gp_elf,"common_ui_zhongzuta_01_4",{childIndex:0,offectY:-20,offectX:-10}),UIActionManager.addEffect(this.gp_ath,"common_ui_zhongzuta_01_5",{childIndex:0,offectY:-20}),this.activateComponent()},i.prototype.updateView=function(e){this.blb_count.text=p.GameMVC.raceTowerPy.info.challengeInfo.count+"";var t=["",this.gp_human,this.gp_orc,this.gp_elf,this.gp_ath,this.gp_god];for(var i in ERaceTowerType){var o=ERaceTowerType[i],n=t[o];if(n){var a=n.$children[2],r=a.$children[0],s=a.$children[1],c=p.GameMVC.raceTowerPy.getInfoByType(o);c?c.pass?r.text=c.id+"":r.text=c.id-1+"":r.text="0";var l=p.Config.raceTowerConfig(o),h=Object.keys(l).length;s.text="/"+h}}},i.prototype.activateComponent=function(){var e=this;this.gp_ath.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide(),p.GameMVC.raceTowerMed.showSubView(p.RaceTowerMed.SV.CHALLENGE,{type:ERaceTowerType.Athanasy})},this),this.gp_human.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide(),p.GameMVC.raceTowerMed.showSubView(p.RaceTowerMed.SV.CHALLENGE,{type:ERaceTowerType.Human})},this),this.gp_elf.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide(),p.GameMVC.raceTowerMed.showSubView(p.RaceTowerMed.SV.CHALLENGE,{type:ERaceTowerType.Elf})},this),this.gp_orc.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide(),p.GameMVC.raceTowerMed.showSubView(p.RaceTowerMed.SV.CHALLENGE,{type:ERaceTowerType.Orc})},this),this.gp_god.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide(),p.GameMVC.raceTowerMed.showSubView(p.RaceTowerMed.SV.CHALLENGE,{type:ERaceTowerType.DemonNEldar})},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.buyCount()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){p.GameMVC.commonMed.showHelpDialog(MODULE.RaceTower)},this)},i.prototype.buyCount=function(){var t=this;Number(p.Config.constConfig().RaceTowerMaxCount.constValue)<=p.GameMVC.raceTowerPy.info.challengeInfo.count?Utils.MsgUtils.addMidMsg("当前次数已满"):p.AppFacade.getInstance().showSubView(p.CommonMediator.N,p.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.RaceTower,hasBuyNum:p.GameMVC.raceTowerPy.info.challengeInfo.buyCount,buyCB:function(e){p.GameMVC.raceTowerPy.BuyChallengeCount(e,function(){t.blb_count.text=p.GameMVC.raceTowerPy.info.challengeInfo.count+""})},curNum:p.GameMVC.raceTowerPy.info.challengeInfo.count,maxNum:Number(p.Config.constConfig().RaceTowerMaxCount.constValue),maxBuyNum:p.Config.VIPConfig().raceTowerBuyTimes})},i);function i(){var e=t.call(this)||this;return e.skinName="RaceTowerMainViewSkin",e}p.RaceTowerMainView=e,__reflect(e.prototype,"game.RaceTowerMainView")}(game=game||{}),function(d){var n,e=(__extends(t,n=BasePanel),t.prototype.childrenCreated=function(){var e=this;n.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="装备合成",this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.sl_root.scrollPolicyH=eui.ScrollPolicy.OFF;var t=this.heroThingPy.AllEquipInfo;for(var i in t){var o=t[i];this.allEquipsNum[i]=o.num}this.list_root.itemRenderer=a,this.updateView()},t.prototype.updateView=function(){function e(e){var a=i[e];if(1!=a.type)return"continue";a.selectUuids=o.id2Uuids[a.id]||[],a.onSelect=function(e,t){r.onSelect(e,t)},a.btnFunc=function(){var e={};for(var t in r.id2Uuids[a.id])e[o=(o=r.id2Uuids[a.id][t]).split("#")[0]]?e[o]++:e[o]=1;var i=[];for(var o in e){var n=e[o];i.push({equipUuid:o,num:n})}r.heroThingPy.HeroEquipCompound({id:a.id,uuidInfos:i,type:1,cb:function(){r.onSelect([],0),r.updateView()}})},t.push(a)}var r=this,t=[],i=d.Config.HeroEquipCompound(),o=this;for(var n in i)e(n);this.list_root.dataProvider?this.list_root.dataProvider.replaceAll(t):this.list_root.dataProvider=new eui.ArrayCollection(t)},t.prototype.onSelect=function(e,t){for(var i in void 0===e&&(e=[]),this.id2Uuids)this.id2Uuids[i]=[];this.id2Uuids[t]=e,this.updateView()},t);function t(){var e=n.call(this)||this;return e.id2Uuids={},e.allEquipsNum={},e.heroThingPy=d.AppFacade.getInstance().retrieveProxy(d.HeroThingPy.N),e.skinName="EquipCompound",e}d.EquipCompound=e,__reflect(e.prototype,"game.EquipCompound");var i,a=(i=eui.ItemRenderer,__extends(o,i),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.btn_operate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.data,t=!0,i=JSON.parse(e.costs);(!this.data.num||this.data.selectUuids.length<this.data.num)&&(t=!1),0<i.length&&(d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N).checkEnough(i,!1)||(t=!1)),t?this.btnFunc&&this.btnFunc(this.data):Utils.MsgUtils.addMidMsg("材料不足")},this);var e=new eui.HorizontalLayout;e.verticalAlign="middle",e.gap=0,this.gp_rewards.layout=e},o.prototype.dataChanged=function(){var r=this,e=this.data;this.gp_rewards.removeChildren();var t=JSON.parse(e.costs),i=d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N);if(this.data.color&&this.data.num){var o=new u({targetNum:this.data.num,color:this.data.color,num:this.data.selectUuids.length});o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new d.CommonChosePanel({getInfos:function(){var e=d.AppFacade.getInstance().retrieveProxy(d.HeroThingPy.N).AllEquipInfo,t=d.Config.getHeroEquipConfig(),i={};for(var o in e){var n=e[o];if(t[n.code]&&t[n.code].color==r.data.color&&!n.heroUuid)for(var a=0;a<n.num;a++)i[n.uuid+"#"+a]=n}return i},type:EEntityType.EEntityTypeHeroEquip,uniNum:!0,checkFull:function(e){return e.length>=r.data.num},selectUuids:r.data.selectUuids,title:"请选择材料装备"}),closeCB:function(e){e&&r.data.onSelect(e,r.data.id)}})},this),this.gp_rewards.addChild(o)}if(0<t.length){var n=new eui.Image("common_img_jia_png");this.gp_rewards.addChild(n);for(var a=0;a<t.length-1;a++){var s;(s=customui.BaseItemFactory.create()).scaleX=s.scaleY=.7,s.updateData({reward:t[a]});var c=i.getInfoByCode(t[a][1]).haveNum;s.blb_num.text=c+"/"+t[a][2],c>=t[a][2]?UIActionManager.setAbsGrey(s,!1):UIActionManager.setAbsGrey(s,!0),this.gp_rewards.addChild(s);var l=new eui.Image("common_img_jia_png");this.gp_rewards.addChild(l)}(s=customui.BaseItemFactory.create()).scaleX=s.scaleY=.7,s.updateData({reward:t[t.length-1]}),this.gp_rewards.addChild(s),c=i.getInfoByCode(t[t.length-1][1]).haveNum,s.blb_num.text=c+"/"+t[t.length-1][2],c>=t[t.length-1][2]?UIActionManager.setAbsGrey(s,!1):UIActionManager.setAbsGrey(s,!0)}var h=new eui.Image("newactivity_img_denghao_png");this.gp_rewards.addChild(h),JSON.parse(e.rewards).forEach(function(e,t){var i=customui.BaseItemFactory.create();i.scaleX=i.scaleY=.7,i.updateData({reward:e}),r.gp_rewards.addChild(i)}),this.btnFunc=e.btnFunc;var p=!0;(!this.data.num||this.data.selectUuids.length<this.data.num)&&(p=!1),0<t.length&&(d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N).checkEnough(t,!1)||(p=!1)),UIActionManager.setAbsGrey(this.btn_operate,!p)},o);function o(){var e=i.call(this)||this;return e.skinName="EquipCompoundItem",e}__reflect(a.prototype,"EquipCompoundItem");var r,u=(r=eui.Component,__extends(s,r),s.prototype.childrenCreated=function(){r.prototype.childrenCreated.call(this),this.baseitem.touchEnabled=!1,UIActionManager.fadeBlink(this.img_jia,!0,!1,1e3),this.updateItem(this.data)},s.prototype.findRandomEquip=function(e){var t=d.Config.getHeroEquipConfig();for(var i in t)if(t[i].color==e)return Number(i)},s.prototype.updateItem=function(e){if(e)if(e.targetNum){this.bm_num.text=e.num+"/"+e.targetNum;var t=e.color;this.baseitem.updateData({code:this.findRandomEquip(t)}),this.baseitem.img_icon.source="equip_ty_"+t+"_png",e.num>=e.targetNum?UIActionManager.setGrey(this.gp_main,!1):UIActionManager.setGrey(this.gp_main,!0);var i=d.AppFacade.getInstance().retrieveProxy(d.HeroThingPy.N),o=0,n=d.Config.getHeroEquipConfig();for(var a in i.AllEquipInfo){var r=i.AllEquipInfo[a];n[r.code]&&n[r.code].color==e.color&&!r.heroUuid&&(o+=r.num)}o>=e.targetNum&&e.num<e.targetNum?this.img_jia.visible=!0:this.img_jia.visible=!1}else this.baseitem.updateData({reward:e.costs}),d.AppFacade.getInstance().retrieveProxy(d.BackpackPy.N).checkEnough([e.costs],!1)?UIActionManager.setGrey(this.gp_main,!1):UIActionManager.setGrey(this.gp_main,!0)},s);function s(e){var t=r.call(this)||this;return t.data=e,t.skinName="EquipCompoundCostItem",t}__reflect(u.prototype,"EquipCompoundCostItem")}(game=game||{}),function(c){var i,e=(__extends(t,i=BaseFull),t.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_smithy")},t.prototype.childrenCreated=function(){var t=this;i.prototype.childrenCreated.call(this),this.initial(),this.initList(),this.initTabbar(),this.btn_shop.visible=!0,this.btn_preview.visible=!1,DragonBoneTools.create("common_shenqixulizhong",function(e){t.eff_jindutiao=e,t.eff_jindutiao.visible=!1,t.gp_pb_fade.addChild(e),e.animation.play("common_shenqixulizhong")}),UIActionManager.addEffect(this.gp_effect,"zhujiemian_ar",{scaleX:1.3,scaleY:1.3},function(e){e&&e.animation.play("zhujiemian_ar_daiji2")}),this.activateComponent(),NoticeManager.addNoticeListener(NT.HERO_THING_COMPOUND,this.btn_shop.$children[0],this,BTN_ICON_NOTICE_POS),this.rb_baseItem=customui.BaseItemFactory.create(),this.rb_baseItem.touchEnabled=!1,this.gp_rb_baseItem.addChildAt(this.rb_baseItem,0),UIActionManager.fadeBlink(this.img_rb_add,!0,!1,1e3)},t.prototype.initial=function(){var i=this;this.targetConfig=this.DECOMPOSE_TYPE_CONFIG[this.curType],this.chosenList.splice(0);var e=c.Config.getHeroEquipConfig(),t=[];for(var o in e){var n=e[o];n.isShow&&t.push(n)}t.sort(function(e,t){return e.isShow!=t.isShow?e.isShow-t.isShow:e.code-t.code}),t.forEach(function(e){var t=customui.BaseItemFactory.create();c.Config.getHeroEquipUpgradeConfig(e.code),c.Config.getHeroEquipEnchantConfig(e.code),e.code,EEntityType.EEntityTypeHeroEquip,t.updateData({code:e.code}),t.scaleX=t.scaleY=.7,i.gp_topEquips.addChild(t)}),this.initFilter()},t.prototype.initList=function(){this.list_item.itemRenderer=n,this.list_item.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.itemList_onItemTap,this)},t.prototype.initTabbar=function(){var e=this;this.btn_2smithy.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){1!=e.curIndex&&(e.updateView({index:1}),e.btn_2smithy.icon="tjp_btn_dazao1_png",e.btn_2decompose.icon="tjp_btn_ronglian0_png",e.btn_2fenjie.icon="tjp_btn_huanyuan0_png",e.btn_2decompose2.icon="tjp_btn_zhibao0_png",e.btn_shop.visible=!0,e.btn_preview.visible=!1,e.btn_auto.visible=!0)},this),this.btn_2decompose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){2!=e.curIndex&&(e.updateView({index:2}),e.btn_2smithy.icon="tjp_btn_dazao0_png",e.btn_2decompose.icon="tjp_btn_ronglian1_png",e.btn_2fenjie.icon="tjp_btn_huanyuan0_png",e.btn_2decompose2.icon="tjp_btn_zhibao0_png",e.img_tips.visible=!1,e.gp_jindu.visible=!0,e.gp_filter.visible=!0,e.btn_shop.visible=!0,e.btn_preview.visible=!1,e.btn_preview2.visible=!1,e.btn_auto.visible=!0,e.btn_decompose.label="熔炼")},this),this.btn_2fenjie.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Utils.UnlockMgr.checkPass(MODULE.HeroArtifactDecompose).allow&&3!=e.curIndex&&(e.updateView({index:3}),e.btn_2smithy.icon="tjp_btn_dazao0_png",e.btn_2decompose.icon="tjp_btn_ronglian0_png",e.btn_2fenjie.icon="tjp_btn_huanyuan1_png",e.btn_2decompose2.icon="tjp_btn_zhibao0_png",e.gp_jindu.visible=!1,e.gp_filter.visible=!1,e.btn_shop.visible=!1,e.btn_preview.visible=!0,e.btn_auto.visible=!1)},this),this.btn_2decompose2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){4!=e.curIndex&&(e.updateView({index:4}),e.btn_2smithy.icon="tjp_btn_dazao0_png",e.btn_2decompose.icon="tjp_btn_ronglian0_png",e.btn_2fenjie.icon="tjp_btn_huanyuan0_png",e.btn_2decompose2.icon="tjp_btn_zhibao1_png",e.img_tips.visible=!0,e.gp_jindu.visible=!1,e.gp_filter.visible=!0,e.btn_shop.visible=!1,e.btn_preview.visible=!1,e.btn_preview2.visible=!0,e.btn_auto.visible=!0,e.btn_decompose.label="分解")},this)},t.prototype.initFilter=function(){var o=this;this.gp_filters_list.removeChildren(),this.gp_filter.visible=!0;var e=this.targetConfig.filterConfig.data;e&&0<e.length&&(e.forEach(function(e){var t=new eui.List;t.itemRenderer=c.DecomposeUI_FilterItem;var i=new eui.HorizontalLayout;i.horizontalAlign=egret.HorizontalAlign.CENTER,t.layout=i,t.dataProvider=new eui.ArrayCollection(e),t.addEventListener(eui.ItemTapEvent.ITEM_TAP,o.filterItem_onItemTap,o),o.gp_filters_list.addChild(t)}),this.gp_filters.height=42*e.length+20*(e.length-1)+40)},t.prototype.chosenList_onItemTap=function(e){e.item.info&&this.selectItem(e.item.info,!1)},t.prototype.itemList_onItemTap=function(e){(this.targetConfig.checdkChoosabel||function(){return!0})(e.item.info)&&(-1==this.chosenList.indexOf(e.item.info)?this.chosenList.length<this.MAX_NUM&&this.selectItem(e.item.info,!0):this.selectItem(e.item.info,!1))},t.prototype.filterItem_onItemTap=function(e){var t=e.itemRenderer;if(this.targetConfig.filterConfig.addFilter(this.curFilter,e.item),!t.chosen)for(var i=0,o=this.gp_filters_list.$children;i<o.length;i++){var n=o[i];if(-1!=n.$children.indexOf(t))for(var a=0,r=n.$children;a<r.length;a++){var s=r[a];s.chosen&&s.setChosen(!1)}}t.setChosen(!t.chosen),this.updateItemList()},t.prototype.selectItem=function(e,t){var i=this.list_item.dataProvider;for(var o in i.source){var n=i.source[o];if(n.info==e){n.chosen=t,i.itemUpdated(n);break}}t?this.chosenList.push(e):this.chosenList.splice(this.chosenList.indexOf(e),1),this.updatePb()},t.prototype.updateView=function(e){switch(this.gp_smithy.visible=!1,this.gp_decompose.visible=!1,this.gp_rollBack.visible=!1,this.curIndex=e&&e.index||this.curIndex,this.curIndex){case 1:this.gp_smithy.visible=!0,this.updateCost();break;case 2:this.gp_decompose.visible=!0,this.curType=EEntityType.EEntityTypeHeroEquip,this.targetConfig=this.DECOMPOSE_TYPE_CONFIG[this.curType],this.updateItemList(),this.updatePlayerInfo(),this.updatePb();break;case 3:this.gp_rollBack.visible=!0,this.updateRollback();break;case 4:this.gp_decompose.visible=!0,this.curType=EEntityType.EEntityTypeImmortal,this.targetConfig=this.DECOMPOSE_TYPE_CONFIG[this.curType],this.updateItemList(),this.updatePlayerInfo()}},t.prototype.updateCost=function(){var e=JSON.parse(c.Config.constConfig().SmithyForgeIronCosts.constValue);this.CommonIconWithNum1.updateItem({cost:e[0],style:CommonIconStyle.RIGHT,needShowHave:!0}),this.CommonIconWithNum10.updateItem({cost:[e[0][0],e[0][1],10*e[0][2]],style:CommonIconStyle.RIGHT,needShowHave:!0})},t.prototype.updateRollback=function(){var e=this.rollBackUuid?this.rollBackUuid.split("#")[0]:"";if(egret.Tween.removeTweens(this.img_rb_add),this.img_rb_add.alpha=1,""!=e){this.gp_rb_empty.visible=!1,this.rb_baseItem.visible=!0,this.icon_rb_cost.visible=!0,this.rb_baseItem.updateData({uuid:e,type:EEntityType.EEntityTypeHeroArtifact,isNum:!0});var t=c.GameMVC.heroThingPy.AllArtiInfo[e],i=c.Config.heroArtifactRollbackConfig(t.config.color,t.config.sectionLevel);this.icon_rb_cost.updateItem({cost:JSON.parse(i.costs)[0],style:CommonIconStyle.RIGHT,needShowHave:!0})}else this.gp_rb_empty.visible=!0,this.rb_baseItem.visible=!1,this.icon_rb_cost.visible=!1,this.checkCanRollback()&&UIActionManager.fadeBlink(this.img_rb_add,!0,!1,1e3)},t.prototype.checkCanRollback=function(){var e=c.GameMVC.heroThingPy.AllArtiInfo;for(var t in e)if(this.checkRollbackAvailable(t))return!0;return!1},t.prototype.checkRollbackAvailable=function(e){var t=c.GameMVC.heroThingPy.AllArtiInfo[e];return""==t.heroUuid&&c.Config.heroArtifactRollbackConfig(t.config.color,t.config.sectionLevel)&&!c.GameMVC.heroThingPy.isArtifactNewOne(e)},t.prototype.activateComponent=function(){var a=this;this.btn_smithy1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.proxy.SmithyForgeIron(1,function(e){a.onSmithyFinish(e,1)})},this),this.btn_smithy10.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.proxy.SmithyForgeIron(10,function(e){a.onSmithyFinish(e,10)})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new c.HelpDialog({moduleId:MODULE.Smithy})})},this),this.btn_auto.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.autoSelect()},this),this.btn_decompose.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var i=this,o=[];for(var e in this.chosenList){var t=this.chosenList[e];o.push(t.uuid)}0<this.chosenList.length?(GameRootLayer.gameLayer().switchTouchEnable(!1),this.timer=egret.setTimeout(function(){GameRootLayer.gameLayer().switchTouchEnable(!0)},this,4e3),2==this.curIndex?this.backpackPy.Decompose({chosenItem:this.chosenList,type:this.curType,cb:function(t){if(i.gp_effect.armature123){var e=i.gp_effect.armature123;e.animation.play("zhujiemian_ar"),e.once(dragonBones.EventObject.LOOP_COMPLETE,function(){var e=this.gp_effect.armature123;e&&e.animation.play("zhujiemian_ar_daiji2"),this.doneCB(t,o)},i)}},noShowReward:!0}):this.backpackPy.Decompose({chosenItem:this.chosenList,type:this.curType,noShowReward:!0,cb:function(e){i.chosenList.splice(0),c.GameMVC.backpackPy.handleClientReward(e.clientReward),i.updateItemList()}})):Utils.MsgUtils.addMidMsg("未放入"+this.targetConfig.name)},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.MainJumpConfig.jumpTo()},this),this.btn_filter.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=this;if(2==this.curIndex){this.gp_filters.visible=!0;var e=this.gp_filter.globalToLocal(0,0),i=new egret.Sprite;i.touchEnabled=!0,i.graphics.beginFill(0,0),i.graphics.drawRect(e.x,e.y,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),i.graphics.endFill(),this.gp_filter.addChildAt(i,2),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){this.gp_filters.visible=!1,i.parent&&i.parent.removeChild(i)},this)}else 4==this.curIndex&&PopUpManager.addPopUp({obj:new c.ImmortalFilterPanel({source:2,closeCB:function(e){t.targetConfig.filterConfig.addFilter(t.curFilter,{code:e[0],sectionLevel:e[1],slotNum:e[2]}),t.updateItemList()}})})},this),this.btn_details.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){2==this.curIndex&&(0<this.chosenList.length?this.backpackPy.Decompose({chosenItem:this.chosenList,type:this.curType,preview:!0}):Utils.MsgUtils.addMidMsg("未放入"+this.targetConfig.name))},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new c.EquipCompound,closeCB:function(){a.updateView()}})},this),this.btn_get.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=a.backpackPy.getDecomposeProcess(EEntityType.EEntityTypeHeroEquip);JSON.parse(c.Config.constConfig().HeroEquipDecomposeProcess.constValue)<=e?a.backpackPy.GetDecomposeRewards(EEntityType.EEntityTypeHeroEquip,function(){a.updateView()}):c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(c.Config.constConfig().HeroEquipDecomposeRewards.constValue),type:c.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this),this.btn_preview.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.rollBackUuid?c.GameMVC.heroThingPy.HeroArtifactRollbackPreview({uuid:a.rollBackUuid.split("#")[0]}):Utils.MsgUtils.addMidMsg("未放入圣物")},this),this.btn_preview2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){4==a.curIndex&&(0<a.chosenList.length?a.backpackPy.Decompose({chosenItem:a.chosenList,type:a.curType,preview:!0}):Utils.MsgUtils.addMidMsg("未放入"+a.targetConfig.name))},this),Utils.ComponentUtils.registerListener(this.gp_rb_baseItem,egret.TouchEvent.TOUCH_TAP,function(){a.checkCanRollback()||Utils.MsgUtils.addMidMsg("当前无已培养过的橙色、红色，金色品质圣物"),PopUpManager.addPopUp({obj:new c.CommonChosePanel({getInfos:function(){var e={},t=c.GameMVC.heroThingPy.AllArtiInfo;for(var i in t){var o=t[i];if(a.checkRollbackAvailable(i))for(var n=0;n<o.num;n++)e[o.uuid+"#"+n]=o}return e},type:EEntityType.EEntityTypeHeroArtifact,uniNum:!0,selectUuids:a.rollBackUuid&&[a.rollBackUuid]||[],title:"请选择圣物",singleChoose:!0}),closeCB:function(e){e&&(a.rollBackUuid=e[0],a.updateView())}})},this),Utils.ComponentUtils.registerListener(this.btn_rollback,egret.TouchEvent.TOUCH_TAP,function(){a.rollBackUuid?c.GameMVC.heroThingPy.HeroArtifactRollback({uuid:a.rollBackUuid.split("#")[0],cb:function(){a.rollBackUuid=void 0,a.updateView()}}):Utils.MsgUtils.addMidMsg("未放入圣物")},this)},t.prototype.updateItemList=function(){var e=[],t=this.targetConfig.filterConfig&&this.targetConfig.filterConfig.filterFunc||function(){return!0},i=this.targetConfig.sortFunc||function(){return-1},o=this.targetConfig.getAllInfo(),n=0;if(o)for(var a in o){n+=1;var r=o[a];t(this.curFilter,r)&&e.push({type:this.curType,info:r,chosen:-1!=this.chosenList.indexOf(r)})}e.sort(i),this.list_item.dataProvider=new eui.ArrayCollection(e),this.lb_num.text=this.targetConfig.name+"数量：";var s=c.Config.constConfig().HeroBagMaxSize.constValue;this.blb_num.text=n+"/"+s},t.prototype.autoSelect=function(){if(!(this.chosenList.length>=this.MAX_NUM)){var e=this.list_item.dataProvider.source,t=this.targetConfig.filterConfig&&this.targetConfig.filterConfig.autoFilterFunc||function(){return!0},i=this.targetConfig.checdkChoosabel||function(){return!0},o=0;if(e.length)for(var n in e){var a=e[n].info;if(t(a)&&i(a)&&-1==this.chosenList.indexOf(a)&&(this.chosenList.push(a),o++,this.chosenList.length>=this.MAX_NUM))break}o?this.updateItemList():Utils.MsgUtils.addMidMsg(this.targetConfig.filterConfig.autoFilterTips),this.updatePb()}},t.prototype.playEffect=function(i){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return(t=this.list_item.$children[i])?[4,DragonBoneTools.playOnce({effectName:"common_yingxiongfenjie",parent:t,x:t.width/2,y:t.height/2,loop:!1,cacheAsBitmap:!0})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.doneCB=function(r,s){return void 0===s&&(s=[]),__awaiter(this,void 0,void 0,function(){var t,i,o,n,a;return __generator(this,function(e){switch(e.label){case 0:for(o in t=[],i=this.list_item.dataProvider.source)n=i[o].info,0<=s.indexOf(n.uuid)&&t.push(this.playEffect(parseInt(o)));return a="common_ty_rlian",3==this.curIndex&&(a="common_fjcg"),t.push(DragonBoneTools.playOnce({effectName:a,parent:this,x:this.width/2,y:this.height/2,loop:!1})),[4,Promise.all(t)];case 1:return e.sent(),this.chosenList.splice(0),this.updateItemList(),this.updatePlayerInfo(),this.updatePb(),GameRootLayer.gameLayer().switchTouchEnable(!0),this.timer&&egret.clearTimeout(this.timer),this.backpackPy.handleClientReward(r.clientReward,{title:"分解奖励",btnText:"领取",onCloseCB:function(){Utils.MsgUtils.addMidMsg("领取成功")}}),[2]}})})},t.prototype.onSmithyFinish=function(t,e){var i=this;if(this.btn_smithy1.touchEnabled=this.btn_smithy10.touchEnabled=!1,t){var o="zhujiemian_ar";if(this.gp_effect.armature123){10==e&&(o="zhujiemian_ar_2");var n=this.gp_effect.armature123;n.animation.play(o),n.once(dragonBones.EventObject.LOOP_COMPLETE,function(){!function(){c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).handleClientReward(t.rewardPreview),i.updateView({index:1}),i.btn_smithy1.touchEnabled=i.btn_smithy10.touchEnabled=!0;var e=i.gp_effect.armature123;e&&e.animation.play("zhujiemian_ar_daiji2")}()},this)}}},t.prototype.updatePlayerInfo=function(){},t.prototype.getFadeValue=function(){var e=c.Config.getHeroEquipConfig(),t=0;for(var i in this.chosenList){var o=this.chosenList[i];e[o.code]&&(t+=e[o.code].decomposeProcesses*o.num)}return t},t.prototype.updatePb=function(){var t=this;if(2==this.curIndex){var i=this.backpackPy.getDecomposeProcess(EEntityType.EEntityTypeHeroEquip);i+=this.getFadeValue(),this.labelDisplay.text=i+"/100",100<=(this.pb_Exp.value=i)?(this.addEffect("common_jingdutiao_2",this.gp_effect_1,!0,{scaleX:1.4}),this.addEffect("common_jingdutiaotk",this.gp_effect_2,!0),this.eff_jindutiao&&(this.eff_jindutiao.visible=!1),UIActionManager.setAbsGrey(this.btn_get,!1)):(8<i?this.eff_jindutiao?(this.eff_jindutiao.visible=!0,this.eff_jindutiao.x=i/100*this.gp_pb_fade.width*.94):(this.gp_pb_fade.removeChildren(),DragonBoneTools.create("common_shenqixulizhong",function(e){t.eff_jindutiao=e,t.eff_jindutiao.x=i/100*t.gp_pb_fade.width*.94,t.gp_pb_fade.addChild(e),e.animation.play("common_shenqixulizhong")})):this.eff_jindutiao&&(this.eff_jindutiao.visible=!1),this.addEffect(void 0,this.gp_effect_1,!1),this.addEffect(void 0,this.gp_effect_2,!1),UIActionManager.setAbsGrey(this.btn_get))}},t.prototype.addEffect=function(e,t,i,o){t&&!e?t.visible=i:e&&(t.visible=i,t.numChildren<=0&&(t.removeChildren(),DragonBoneTools.create(e,function(e){e.x=t.width/2,e.y=t.height/2,e.scaleX=o&&o.scaleX||1,e.animation.play(),t.addChild(e)},this)))},t.prototype.perClose=function(){},t);function t(){var e,t=i.call(this)||this;return t.proxy=c.AppFacade.getInstance().retrieveProxy(c.SmithyPy.N),t.curType=EEntityType.EEntityTypeHeroEquip,t.chosenList=new Array,t.curIndex=1,t.heroPy=c.AppFacade.getInstance().retrieveProxy(c.HeroPy.N),t.backpackPy=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N),t.MAX_NUM=20,t.DECOMPOSE_TYPE_CONFIG=((e={})[EEntityType.EEntityTypeHeroEquip]={name:"装备",getAllInfo:function(){var e=c.AppFacade.getInstance().retrieveProxy(c.HeroThingPy.N),t=[],i=c.Config.getHeroEquipConfig();for(var o in e.AllEquipInfo){var n=e.AllEquipInfo[o];i[n.code]&&!i[n.code].canDecompose&&t.push(n)}return t},filterConfig:{data:[[{color:2,icon:"beibao_btn_pinzhi_2_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:3,icon:"beibao_btn_pinzhi_3_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:4,icon:"beibao_btn_pinzhi_4_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:5,icon:"beibao_btn_pinzhi_5_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:6,icon:"beibao_btn_pinzhi_6_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"}]],filterFunc:function(e,t){return!e||!e.color||0==e.color.length||-1!=e.color.indexOf(t.config.color)},addFilter:function(e,t){var i="color";e[i]||(e[i]=[]);var o=e[i].indexOf(t[i]);-1==o?(e[i].splice(0),e[i].push(t[i])):e[i].splice(o,1)},autoFilterFunc:function(e){return e.config.color<=3},autoFilterTips:"无紫色品质以下装备"},checdkChoosabel:function(e){return""==e.heroUuid},sortFunc:function(e,t){var i=e.info,o=t.info,n=""!=i.heroUuid;return n!=(""!=o.heroUuid)?n?1:-1:i.config.color!=o.config.color?i.config.color-o.config.color:i.code!=o.code?i.code-o.code:i.level-o.level}},e[EEntityType.EEntityTypeHeroArtifact]={name:"圣物",getAllInfo:function(){var e=c.AppFacade.getInstance().retrieveProxy(c.HeroThingPy.N),t=[],i=c.Config.getHeroArtifactConfig();for(var o in e.AllArtiInfo){var n=e.AllArtiInfo[o];i[n.code]&&5<=i[n.code].color&&i[n.code].decomposeRewards&&t.push(n)}return t},filterConfig:{data:[[{color:2,icon:"beibao_btn_pinzhi_2_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:3,icon:"beibao_btn_pinzhi_3_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:4,icon:"beibao_btn_pinzhi_4_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:5,icon:"beibao_btn_pinzhi_5_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"},{color:6,icon:"beibao_btn_pinzhi_6_png",chosenImg:"beibao_img_xiaoxuanzhongq_png"}]],filterFunc:function(e,t){return!e||!e.color||0==e.color.length||-1!=e.color.indexOf(t.config.color)},addFilter:function(e,t){var i="color";e[i]||(e[i]=[]);var o=e[i].indexOf(t[i]);-1==o?(e[i].splice(0),e[i].push(t[i])):e[i].splice(o,1)},autoFilterFunc:function(e){return e.config.color<=3},autoFilterTips:"无紫色品质以下装备"},checdkChoosabel:function(e){return""==e.heroUuid},sortFunc:function(e,t){var i=e.info,o=t.info,n=""!=i.heroUuid;return n!=(""!=o.heroUuid)?n?1:-1:i.config.color!=o.config.color?i.config.color-o.config.color:i.code!=o.code?i.code-o.code:i.level-o.level}},e[EEntityType.EEntityTypeImmortal]={name:"至宝",getAllInfo:function(){var e=[],t=c.GameMVC.heroThingPy.AllImmortalInfo;for(var i in t){var o=t[i];o.heroUuid||o.sectionLevel<2||2==o.sectionLevel&&4==o.slotNum||e.push(o)}return e},filterConfig:{filterFunc:function(e,t){return(!e.code||t.code==e.code)&&((!e.sectionLevel||t.sectionLevel==e.sectionLevel)&&(!e.slotNum||t.slotNum==e.slotNum))},addFilter:function(e,t){e.code=t.code,e.sectionLevel=t.sectionLevel,e.slotNum=t.slotNum},autoFilterFunc:function(e){return 5!=e.sectionLevel},autoFilterTips:"无二至四阶至宝"},checdkChoosabel:function(e){return""==e.heroUuid},sortFunc:function(e,t){var i=e.info,o=t.info,n=""!=i.heroUuid;return n!=(""!=o.heroUuid)?n?1:-1:i.config.color!=o.config.color?i.config.color-o.config.color:i.code!=o.code?i.code-o.code:i.level-o.level}},e),Utils.AssetsMgr.loadGroup("group_smithy"),t.skinName="SmithyMainView",t.curFilter={},t}c.SmithyMainView=e,__reflect(e.prototype,"game.SmithyMainView");var o,n=(o=c.DecomposeUI_Item,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.scaleX=this.scaleY=.7},a);function a(){return null!==o&&o.apply(this,arguments)||this}__reflect(n.prototype,"DecomposeUI_ItemLocal")}(game=game||{}),function(e){var t,i=(t=eui.Scroller,__extends(r,t),r.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initialize()},r.prototype.initialize=function(){UIActionManager.hideScrollerBar(this),this.scrollPolicyH=eui.ScrollPolicy.OFF,this.scrollPolicyV=eui.ScrollPolicy.OFF,this.throwSpeed=0,this.bounces=!1},r.prototype.getItemNum=function(){var e=this.viewport;return e instanceof eui.List?e.dataProvider.source.length:e.numChildren},r.prototype.scrollerToPage=function(e,t,i){var o=this;if(void 0===t&&(t=!1),this.curPage!=e){var n=this.getItemNum();if(n<=e)this.scrollerToPage(n-1,t,i);else if(e<0)this.scrollerToPage(0,t,i);else{this.bScrolling=!0;var a=t?0:this.scrollDuration;(this.isHScroller?egret.Tween.get(this.viewport).to({scrollH:e*(this.pageSize||this.width)},a):egret.Tween.get(this.viewport).to({scrollV:e*(this.pageSize||this.height)},a)).call(function(){o.bScrolling=!1,o.curPage=e,i&&i(),o.dispatchEventWith(r.EVENT_SCROLL_COMPLETE,!1,o.curPage)})}}else i&&i()},r.prototype.scrollToNext=function(e){this.bScrolling||this.scrollerToPage(this.curPage+1,!1,e)},r.prototype.scrollToLast=function(e){this.bScrolling||this.scrollerToPage(this.curPage-1,!1,e)},r.EVENT_SCROLL_COMPLETE="EVENT_SCROLL_COMPLETE",r);function r(){var e=t.call(this)||this;return e.curPage=0,e.scrollDuration=250,e.isHScroller=!0,e.bScrolling=!1,e}e.PageScroller=i,__reflect(i.prototype,"customui.PageScroller")}(customui=customui||{}),function(e){var t,i=(__extends(o,t=BaseProxy),o.prototype.GetSmithyInfo=function(t){var i=this;Utils.Socket.send("smithy","GetSmithyInfo",{}).then(function(e){i.smithyInfo=e.info,t&&t()})},o.prototype.SmithyForgeIron=function(e,t){var i=this;void 0===e&&(e=1),Utils.Socket.send("smithy","SmithyForgeIron",{num:e}).then(function(e){i.smithyInfo=e.info,t&&t(e)})},o.N="SmithyPy",o);function o(){return t.call(this,o.N)||this}e.SmithyPy=i,__reflect(i.prototype,"game.SmithyPy")}(game=game||{}),function(r){var o,e=(__extends(t,o=BasePanel),t.prototype.onDestory=function(){o.prototype.onDestroy.call(this)},t.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this);var t=this.py.buyCosts[0],i=r.GeneralConfig.getEntityConfigByCode(t[0],t[1]);this.img_cost.source=ResourceUtils.png(i.icon),this.initTabbarOppr(),this.dataProvider=new eui.ArrayCollection,this.list_root.dataProvider=this.dataProvider,this.py.GetStockDealInfo(function(){e.tabbar_oppr.visible=!0,e.onTabbarOpprItemTap()})},t.prototype.initTabbarOppr=function(){this.tabbar_oppr.visible=!1,this.tabbar_oppr.itemRendererSkinName="Immortal_TabbarItemSkin",this.tabbar_oppr.dataProvider=new eui.ArrayCollection([{source:{up:"shenbing_btn_wodeyingkui1_png",down:"shenbing_btn_wodeyingkui2_png"}},{source:{up:"shenbing_btn_jiaoyijilu1_png",down:"shenbing_btn_jiaoyijilu2_png"}}]),this.tabbar_oppr.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabbarOpprItemTap,this)},t.prototype.onTabbarOpprItemTap=function(e){0==(e&&null!=e.itemIndex?e.itemIndex:0)?this.showMine():this.showLog()},t.prototype.showMine=function(){var t=this,i=(this.py.dealInfo[1]-this.py.dealInfo[0])/100;this.py.stockHoldList.forEach(function(e){i+=t.py.getStockInfoByCode(e.code).price/100*r.GameMVC.heroThingPy.getImmortalNum(r.Config.stockConfig()[e.code].immortalCode,1,!0)}),this.lb_count.textColor=i<0?65328:16667218,this.lb_count.text=Utils.MathUtils.toDecimal(i,2),this.sl_list.height=194,this.gp_mine.visible=!0,this.list_root.itemRenderer=n,this.dataProvider.removeAll(),this.py.stockHoldList.forEach(function(e){0<r.GameMVC.heroThingPy.getImmortalNum(r.Config.stockConfig()[e.code].immortalCode,1,!0)&&t.dataProvider.addItem(e)})},t.prototype.showLog=function(){var t=this;this.sl_list.height=this.gp_mine.height,this.gp_mine.visible=!1,this.list_root.itemRenderer=c,this.dataProvider.removeAll(),this.py.stockDealList.forEach(function(e){t.dataProvider.addItem(e)})},t);function t(){var e=o.call(this)||this;return e.skinName="StockDealListViewSkin",e.py=r.GameMVC.stockPy,e}r.StockDealListView=e,__reflect(e.prototype,"game.StockDealListView");var i,n=(i=eui.ItemRenderer,__extends(a,i),a.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this)},a.prototype.dataChanged=function(){var e=this.data,t=r.Config.stockConfig()[e.code];this.lb_desc.textFlow=[{text:t.name,style:{textColor:57087,size:20}}];var i=r.GameMVC.stockPy.getStockInfoByCode(e.code).price/100,o=(i-e.averageCost/100)*e.num+i*(r.GameMVC.heroThingPy.getImmortalNum(t.immortalCode,1,!0)-e.num),n=void 0;n=o<0?65328:16667218,this.lb_desc2.textFlow=[{text:Utils.MathUtils.toDecimal(o,2),style:{textColor:n,size:20}}]},a);function a(){var e=i.call(this)||this;return e.skinName="StockDealListView_StockItem1",e}__reflect(n.prototype,"StockDealListView_StockItem1");var s,c=(s=eui.ItemRenderer,__extends(l,s),l.prototype.childrenCreated=function(){s.prototype.childrenCreated.call(this)},l.prototype.dataChanged=function(){var e=this.data,t=r.Config.stockConfig()[e.code],i=void 0,o=void 0,n=r.GameMVC.stockPy.buyCosts[0],a=r.GeneralConfig.getEntityConfigByCode(n[0],n[1]);o=e.isPurchase?(i="我购买了","花费"):(i="我出售了","获得"),this.lb_desc.textFlow=[{text:i,style:{textColor:16775908,size:20}},{text:t.name,style:{textColor:57087,size:20}},{text:"的",style:{textColor:16775908,size:20}},{text:e.num.toString(),style:{textColor:3735331,size:20}},{text:"股，总计"+o+a.name,style:{textColor:16775908,size:20}},{text:Utils.MathUtils.formatNumStyle1(e.totalPrice/100).toString(),style:{textColor:16721446,size:20}},{text:"。",style:{textColor:16775908,size:20}}]},l);function l(){var e=s.call(this)||this;return e.skinName="StockDealListView_StockItem2",e}__reflect(c.prototype,"StockDealListView_StockItem2")}(game=game||{}),function(c){var l,e;(e=l=l||{})[e.BUY=0]="BUY",e[e.SELL=1]="SELL";var t,i=(__extends(o,t=BasePanel),o.prototype.onDestory=function(){t.prototype.onDestroy.call(this)},o.prototype.childrenCreated=function(){var o=this;t.prototype.childrenCreated.call(this),this.curStockItem=new c.StockMainView_StockItem,this.gp_curStockItem.addChild(this.curStockItem),this.curStockItem.scaleX=this.curStockItem.scaleY=1,this.curStockItem.btn_detail.parent.removeChild(this.curStockItem.btn_detail),this.curStockItem.img_bg.parent.removeChild(this.curStockItem.img_bg);var e=new eui.HorizontalLayout;(this.curStockItem.gp_info.layout=e).gap=13,this.curStockItem.$children.forEach(function(e,t){var i=o.curStockItem["lb_desc"+t];i.textColor=16775908,i.size=18}),Utils.TouchUtils.addTouchListener(this.btn_oppr,this.onOpprClick,this),this.initTabbar(),this.initTabbarOppr()},o.prototype.initTabbar=function(){this.tabbar.itemRendererSkinName="Immortal_TabbarItemSkin",this.tabbar.dataProvider=new eui.ArrayCollection([{source:{up:"shenbing_btn_jinri1_png",down:"shenbing_btn_jinri2_png"}},{source:{up:"shenbing_btn_jinyizhou1_png",down:"shenbing_btn_jinyizhou2_png"}},{source:{up:"shenbing_btn_jinyiyue1_png",down:"shenbing_btn_jinyiyue2_png"}}]),this.tabbar.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabbarItemTap,this),this.tabbar.visible=!1},o.prototype.initTabbarOppr=function(){this.tabbar_oppr.itemRendererSkinName="Immortal_TabbarItemSkin",this.tabbar_oppr.dataProvider=new eui.ArrayCollection([{source:{up:"shenbing_btn_mairugupiao1_png",down:"shenbing_btn_mairugupiao2_png"}},{source:{up:"shenbing_btn_maichugupiao1_png",down:"shenbing_btn_maichugupiao2_png"}}]),this.tabbar_oppr.addEventListener(eui.ItemTapEvent.ITEM_TAP,this.onTabbarOpprItemTap,this)},o.prototype.onTabbarOpprItemTap=function(e){var t=this;if(!e||!e.itemIndex||e.itemIndex!=this.tabItemIndex){this.tabItemIndex=e&&null!=e.itemIndex?e.itemIndex:this.tabItemIndex,this.gp_buy_info.visible=this.gp_sell_info.visible=!1,0==this.tabItemIndex?(this.model=l.BUY,this.btn_oppr.label="买 入",this.lb_opprTips.text="今天可买入份数：",this.gp_buy_info.visible=!0):(this.model=l.SELL,this.btn_oppr.label="卖 出",this.lb_opprTips.text="可卖出份数：",this.gp_sell_info.visible=!0);var i=Math.max(this.py.maxCanBuy-(this.hookInfo&&this.hookInfo.purchaseNum||0),0);if(this.model==l.SELL){var o=c.GameMVC.heroThingPy.getImmortalNum(this.stockConfig.immortalCode,1,!0);i=Math.max(o,0)}this.cu_batchNum.update({maxBuyNum:i,minBuyNum:0,onUpdate:function(e){t.updatePrice(e)}}),this.lb_opprCount.text=i.toString(),this.updatePrice()}},o.prototype.onTabbarItemTap=function(e){var t=this;e&&e.itemIndex&&e.itemIndex==this.tabItemIndex||(this.tabItemIndex=e&&null!=e.itemIndex?e.itemIndex:this.tabItemIndex,this.py.GetStockDetailInfo(this.code,function(e){t.updateChar(e)}))},o.prototype.onOpprClick=function(){var t=this;if(this.py.getStockTime().isOpen){var e=this.cu_batchNum.getCurNum();if(this.log("当前操作数",e),0!=e){var i=this.serverData.price,o=(c.Config.immortalConfig()[this.stockConfig.immortalCode],this.py.buyCosts[0]),n=c.GeneralConfig.getEntityConfigByCode(o[0],o[1]),a=void 0,r=void 0;if(this.model==l.BUY){var s=o[2]*e*i/100;r="是否花费"+Math.floor(s*(1+this.py.rate))+n.name+"购买"+this.stockConfig.name+"的"+e+"股？",a=function(){t.py.PurchaseStock(t.code,e,i,function(e){c.GameMVC.backpackPy.handleClientReward(e.clientReward),t.onTabbarOpprItemTap()})}}else this.model==l.SELL&&(r="是否出售"+this.stockConfig.name+"的"+e+"股，将获得"+Math.floor(i/100*e)+n.name+"？",a=function(){t.py.SellStock(t.code,e,i,function(e){c.GameMVC.backpackPy.handleClientReward(e.clientReward),t.onTabbarOpprItemTap()})});c.GameMgr.getInstance().showCommonTipsWin({commonTips:r,source:"StockOppr",clickCB:function(e){1===e.type&&a()}})}else Utils.MsgUtils.addMidMsg("数量不能为0")}else Utils.MsgUtils.addMidMsg("未到开盘时间")},o.prototype.updateView=function(e,t){e&&(this.code=e.code);var i=c.Config.stockConfig();this.stockConfig=i[this.code],this.serverData=this.py.getStockInfoByCode(this.stockConfig.code),this.hookInfo=this.py.getHoldStockInfoByCode(this.stockConfig.code),this.curStockItem.data={code:this.stockConfig.code,keys:[this.stockConfig.name,this.serverData&&this.serverData.price||this.stockConfig.price,this.serverData&&this.serverData.change||0,this.serverData&&this.serverData.num||0,c.GameMVC.heroThingPy.getImmortalNum(this.stockConfig.immortalCode,1,!0),this.hookInfo&&this.hookInfo.averageCost||0]},this.updatePrice(),t&&(this.tabbar.visible=!0,this.onTabbarItemTap(),this.onTabbarOpprItemTap())},o.prototype.updatePrice=function(e){if(this.serverData)if(null==e&&(e=this.cu_batchNum.getCurNum()),this.model==l.SELL){var t=c.Config.stockConfig()[this.code],i=c.Config.immortalConfig()[t.immortalCode];this.cu_bi.updateData({type:EEntityType.EEntityTypeImmortal,code:t.immortalCode,num:1}),this.lb_sell_shenbing.text="("+i.name+")",this.lb_sell_shenbing_num.text=e}else{var o=this.py.buyCosts[0],n=o[2]*e*this.serverData.price/100;this.costIcon.updateItem({type:o[0],code:o[1],num:Math.floor(n*(1+this.py.rate)),style:CommonIconStyle.RIGHT,showEnough:!0,notFormatNum:!0}),this.lb_rate_tips.text="（含"+100*this.py.rate+"%手续费）"}},o.prototype.xRenderMonthAndWeek=function(e){var a=this,r=[];e.forEach(function(e,t){r.push(Number(Utils.MathUtils.toDecimal(e/100,2)))});var s=void 0,c=this.cu_lineChart.width/r.length;return this.cu_lineChart.bindXRender(function(e,t){if(e%2==0){var i=new Date(1e3*Utils.TimerManager.getServerTime(!1));i.setDate(i.getDate()-(r.length-1-e));var o="";o=s&&s!=i.getMonth()+1?i.getMonth()+1+"月"+i.getDate()+"日":i.getDate()+"日",s=i.getMonth()+1;var n=t(o);return n.anchorOffsetY=0,n.scaleX=.65,n.x=e*c,n.y=a.cu_lineChart.height+15,n}}),r},o.prototype.xRenderDay=function(e){var a=this,r=3600/this.py.dailyDealCycle,t=this.py.getStockTime(),s=t.openTimeDt,i=3600*(t.endTime[0]-t.openTime[0])/this.py.dailyDealCycle,c=[];e.forEach(function(e,t){t<=i&&t%r==0&&c.push(Number(Utils.MathUtils.toDecimal(e/100,2)))});var l=this.cu_lineChart.width/c.length;return this.cu_lineChart.bindXRender(function(e,t){var i=new Date(1e3*(s+r*a.py.dailyDealCycle*e)),o=void 0;o=i.getMinutes()<10?"0"+i.getMinutes():i.getMinutes();var n=t(i.getHours()+":"+o);return n.anchorOffsetY=0,n.scaleX=.65,n.x=e*l,10<c.length?n.y=e%2==0?a.cu_lineChart.height+7.5:a.cu_lineChart.height+27.5:n.y=a.cu_lineChart.height+7.5,n}),c},o.prototype.updateChar=function(e){e&&e.detailInfo&&(this.serverData.dayDealList=e.detailInfo.dayDealList,this.serverData.weekDealList=e.detailInfo.weekDealList,this.serverData.monthDealList=e.detailInfo.monthDealList);var t=void 0;switch(this.tabItemIndex){case 0:t=this.xRenderDay(this.serverData.dayDealList);break;case 1:t=this.xRenderMonthAndWeek(this.serverData.weekDealList);break;case 2:t=this.xRenderMonthAndWeek(this.serverData.monthDealList)}this.cu_lineChart.update(t)},o);function o(){var e=t.call(this)||this;return e.model=l.BUY,e.tabItemIndex=0,e.skinName="StockDetailViewSkin",e.py=c.GameMVC.stockPy,e}c.StockDetailView=i,__reflect(i.prototype,"game.StockDetailView")}(game=game||{}),function(d){var i,e=(__extends(t,i=BaseView),t.prototype.childrenCreated=function(){var e=this;i.prototype.childrenCreated.call(this),this.gp_title.scaleX=this.gp_title.scaleY=1/Utils.DeviceUtils.additionScale(),this.dataProvider=new eui.ArrayCollection,this.list_root.dataProvider=this.dataProvider,this.list_root.itemRenderer=n,this.originPoss.lb_news_title=[this.lb_news_title.x,this.lb_news_title.y],this.originPoss.lb_news_content=[this.lb_news_content.x,this.lb_news_content.y],Utils.TouchUtils.addTouchListener(this.bnt_deal,function(){e.mediator.showSubView(d.StockMed.SV.DEAL_LIST)}),Utils.TouchUtils.addTouchListener(this.btn_help,function(){d.GameMVC.commonMed.showHelpDialog(MODULE.Stock)},this),Utils.TouchUtils.addTouchListener(this.btn_exchange,function(){PopUpManager.addPopUp({obj:new s})},this);var t=new customui.HeroDynamicModel;t.scaleX=t.scaleY=.9,t.update({code:41040009,isStatic:!0}),this.gp_model.addChild(t),t.x=110,t.y=100,this.py.GetStockInfo()},t.prototype.dtUpdate=function(){if(this.isOpen){var e=this.py.dailyDealCycle-(Utils.TimerManager.getServerTime()-this.py.lastUpdateDt);this.blb_nextRefresh.text=Utils.TimerManager.getFormatBySecond1(e),e<=0&&(this.py.lastUpdateDt=Utils.TimerManager.getServerTime(),this.py.GetStockInfo())}this.updateBanner()},t.prototype.updateBanner=function(){var e=this;if(0==this.curNewsLoopPassTime||this.curNewsLoopPassTime>=this.NEWS_LOOP_DURA)if(this.curNewsLoopPassTime=1,0==this.py.newsList.length)this.lb_news_title.text="暂无新闻",this.lb_news_content.text="";else{this.curNewsLoopDuraIndex>=this.py.newsList.length&&(this.curNewsLoopDuraIndex=0);var t=this.py.newsList[this.curNewsLoopDuraIndex++],i=d.Config.stockNewsConfig()[t.code];i&&(this.lb_news_title.scaleX=this.lb_news_title.scaleY=0,this.lb_news_title.alpha=.5,this.lb_news_title.text=i.title,this.lb_news_content.text=i.content,this.lb_news_content.validateNow(),egret.Tween.removeTweens(this.lb_news_title),egret.Tween.get(this.lb_news_title).to({scaleX:1,scaleY:1,alpha:1},500).call(function(){e.lb_news_content.x=e.gp_news_banner.width,egret.Tween.get(e.lb_news_content).to({x:-e.lb_news_content.textWidth},1e3*e.NEWS_LOOP_DURA-1e3-1e3)}).wait(1e3*this.NEWS_LOOP_DURA-1e3-1e3).to({scaleX:0,scaleY:0,alpha:.5},500))}this.curNewsLoopPassTime++},t.prototype.updateView=function(e,t){var i=this;if(!t){var o=d.Config.stockConfig();for(var n in this.dataProvider.removeAll(),o){var a=o[n],r=this.py.getStockInfoByCode(a.code),s=this.py.getHoldStockInfoByCode(a.code);this.dataProvider.addItem({code:a.code,keys:[a.name,r&&r.price||a.price,r&&r.change||0,r&&r.num||0,d.GameMVC.heroThingPy.getImmortalNum(a.immortalCode,1,!0),s&&s.averageCost||0]})}var c=this.py.buyCosts[0],l=d.GameMVC.backpackPy.getInfoByTypeCodeNum(c[0],c[1]);this.cu_iconWithNum.updateItem({cost:[c[0],c[1],l&&l.haveNum||0],style:CommonIconStyle.RIGHT,needBg:!1}),this.dataProvider.refresh();var h=this.py.getStockTime();if(h.isWillOpenToday?this.lb_openTime.text=Utils.TimerManager.getPopTipsByOpenTime(h):this.lb_openTime.text="今日休市",this.isOpen=h.isOpen,this.isOpen)this.lb_newRefreshTips.visible=this.blb_nextRefresh.visible=!0;else{this.lb_newRefreshTips.visible=this.blb_nextRefresh.visible=!1;var p=0;p=h.openTimeDt>=Utils.TimerManager.getServerTime()?h.openTimeDt-Utils.TimerManager.getServerTime():h.openTimeDt+86400-Utils.TimerManager.getServerTime(),this.scheOpenId=egret.setTimeout(function(){egret.clearTimeout(i.scheOpenId),i.scheOpenId=0,i.py.GetStockInfo()},this,1e3*(p+1))}this.scheId||(this.scheId=egret.setInterval(this.dtUpdate,this,1e3))}},t.prototype.getParentView=function(){return d.GameMVC.immortalMed.getSubView(d.ImmortalMed.SV.MAIN).gp_subview_container},t.prototype.onDestroy=function(){i.prototype.onDestroy.call(this),this.scheId&&(egret.clearInterval(this.scheId),this.scheId=void 0),this.scheOpenId&&(egret.clearTimeout(this.scheOpenId),this.scheOpenId=void 0)},t);function t(){var e=i.call(this)||this;return e.curNewsLoopDuraIndex=0,e.curNewsLoopPassTime=0,e.NEWS_LOOP_DURA=15,e.originPoss={},e.skinName="StockMainViewSkin",e.py=d.GameMVC.stockPy,e}d.StockMainView=e,__reflect(e.prototype,"game.StockMainView");var o,n=(o=eui.ItemRenderer,__extends(a,o),a.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.scaleX=this.scaleY=1/Utils.DeviceUtils.additionScale(),Utils.TouchUtils.addTouchListener(this.btn_detail,this.onClick,this)},a.prototype.onClick=function(){d.GameMVC.stockMed.showSubView(d.StockMed.SV.DETAIL,{code:this.data.code})},a.prototype.updateItem=function(e){this.data=e,this.dataChanged()},a.prototype.dataChanged=function(){var o=this;this.data.keys.forEach(function(e,t){var i=o.data.keys[t];1==t?i=Utils.MathUtils.toDecimal(i/100,2):2==t?(o["lb_desc"+t].textColor=1e8<i?(i=-i%1e8,65328):16667218,i=Utils.MathUtils.toDecimal(i/100,2)+"%"):3==t||4==t?i=Utils.MathUtils.formatNumStyle1(i):5==t&&(i=o.py.getAvgCost(i)),o["lb_desc"+t].text=i})},a);function a(){var e=o.call(this)||this;return e.skinName="StockMainView_StockItem",e.py=d.GameMVC.stockPy,e}d.StockMainView_StockItem=n,__reflect(n.prototype,"game.StockMainView_StockItem");var r,s=(__extends(c,r=BasePanel),c.prototype.childrenCreated=function(){var t=this;r.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.onCloseCB=function(){t.hide()},this.CommonDaTanChuKuang.blb_title.text="黄金兑换",this.CommonBatchNum.btn_max.visible=!1,this.CommonBatchNum.btn_min.visible=!1,this.CommonIconWithNum_get.blb_num.scaleX=this.CommonIconWithNum_get.blb_num.scaleY=1.2,this.CommonIconWithNum_have.blb_num.scaleX=this.CommonIconWithNum_have.blb_num.scaleY=1.2;var e=JSON.parse(d.Config.constConfig().StockGoldPurchaseInfo.constValue),i=e[0][0],o=e[1][0];this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){0<t.curNum?d.AppFacade.getInstance().showSubView(d.CommonMediator.N,d.CommonMediator.SV.TIPS_DIALOG,{commonTips:"确定消耗"+i[2]*t.curNum+"钻石兑换"+o[2]*t.curNum+"黄金",clickCB:function(e){e.type&&Utils.Socket.send("stock","PurchaseGold",{num:t.curNum}).then(function(e){d.GameMVC.backpackPy.handleClientReward(e.clientReward),t.updateView()})}}):Utils.MsgUtils.addMidMsg("请输入数量")},this),this.updateView()},c.prototype.updateView=function(){var e=d.GameMVC.backpackPy.getInfoByCode(EPropertyType.EPropertyTypeDiamond);this.CommonIconWithNum_have.updateItem({cost:[1,1,e.haveNum],style:CommonIconStyle.RIGHT});var t=JSON.parse(d.Config.constConfig().StockGoldPurchaseInfo.constValue),i=t[0][0],o=t[1][0];this.CommonBatchNum.update({minBuyNum:0,maxBuyNum:Math.floor(e.haveNum/i[2]),onUpdate:this.updateNum.bind(this)}),this.bm_diamond.text=i[2],this.bm_gold.text=o[2],this.CommonBatchNum.setValueTo(0),this.updateNum(0)},c.prototype.updateNum=function(e){this.curNum=e;var t=JSON.parse(d.Config.constConfig().StockGoldPurchaseInfo.constValue)[1][0];this.CommonIconWithNum_get.updateItem({cost:[t[0],t[1],t[2]*e],style:CommonIconStyle.RIGHT})},c);function c(){var e=r.call(this)||this;return e.curNum=0,e.skinName="StockBuyPanelSkin",e}__reflect(s.prototype,"StockBuyPanel")}(game=game||{}),function(e){var t,i=(__extends(o,t=BaseMediator),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,e.StockMainView),this.addSubView(o.SV.DETAIL,e.StockDetailView),this.addSubView(o.SV.DEAL_LIST,e.StockDealListView)},o.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.STOCK_INFO_UPDATE,CN.STOCK_DETAIL_INFO_UPDATE]},o.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.STOCK_INFO_UPDATE:this.updateView(o.SV.MAIN),this.updateView(o.SV.DETAIL);break;case CN.STOCK_DETAIL_INFO_UPDATE:this.updateView(o.SV.DETAIL)}},o.N="StockMed",o.SV={MAIN:1,DETAIL:2,DEAL_LIST:3},o);function o(e){return void 0===e&&(e=null),t.call(this,o.N,e)||this}e.StockMed=i,__reflect(i.prototype,"game.StockMed")}(game=game||{}),function(e){var t=(i.registerAll=function(){},i);function i(){}e.StockProcessor=t,__reflect(t.prototype,"game.StockProcessor")}(game=game||{}),function(o){var t,e=(__extends(i,t=BaseProxy),i.prototype.getStockInfoByCode=function(e){for(var t=0,i=this.stockList;t<i.length;t++){var o=i[t];if(o.code==e)return o}},i.prototype.getHoldStockInfoByCode=function(e){for(var t=0,i=this.stockHoldList;t<i.length;t++){var o=i[t];if(o.code==e)return o}},i.prototype.initConstValue=function(){this.stockPurchaseCosts=JSON.parse(o.Config.constConfig().StockPurchaseCosts.constValue),this.stockSellCosts=JSON.parse(o.Config.constConfig().StockSellCosts.constValue),this.stockOpenTimeRange=JSON.parse(o.Config.constConfig().StockOpenTimeRange.constValue),this.stockPurchaseServiceCharge=Number(o.Config.constConfig().StockPurchaseServiceCharge.constValue)/100,this.stockPurchaseLimit=Number(o.Config.constConfig().StockPurchaseLimit.constValue),this.stockPriceRefreshCycle=Number(o.Config.constConfig().StockPriceRefreshCycle.constValue),this.isInit=!0},i.prototype.updateStockInfo=function(e){this.isInit||this.initConstValue(),this.lastUpdateDt=e.dt,this.newsList.splice(0),this.stockList.splice(0),this.stockDealList.splice(0),this.stockHoldList.splice(0),this.newsList=e.newsList,this.stockList=e.stockList,this.stockHoldList=e.stockHoldList,this.dealInfo=e.dealInfo,o.AppFacade.getInstance().sendNotification(CN.STOCK_INFO_UPDATE)},i.prototype.isInStockTime=function(){var e=this.getStockTime();return e&&e.isOpen},i.prototype.getStockTime=function(){return Utils.TimerManager.checkIsOpen_FormatA(this.stockOpenTimeRange)},Object.defineProperty(i.prototype,"rate",{get:function(){return this.stockPurchaseServiceCharge},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"buyCosts",{get:function(){return this.stockPurchaseCosts},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sellCosts",{get:function(){return this.stockSellCosts},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"maxCanBuy",{get:function(){return this.stockPurchaseLimit},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dailyDealCycle",{get:function(){return this.stockPriceRefreshCycle},enumerable:!0,configurable:!0}),i.prototype.getAvgCost=function(e){return Math.floor(e/100)+"."+((e-e%10)%100+e%10)},i.prototype.GetStockInfo=function(){var t=this;Utils.Socket.send("stock","GetStockInfo",{}).then(function(e){t.updateStockInfo(e.info)}).catch(function(e){10046==e&&(Utils.MsgUtils.addMidMsg("股市因某些问题暂时关闭，请耐心等待开启"),egret.setTimeout(function(){o.MainJumpConfig.jumpTo("CITY")},t,2e3))})},i.prototype.PurchaseStock=function(e,t,i,o){var n=this;Utils.Socket.send("stock","PurchaseStock",{code:e,price:i,num:t}).then(function(e){n.updateStockInfo(e.info),o&&o(e)})},i.prototype.SellStock=function(e,t,i,o){var n=this;Utils.Socket.send("stock","SellStock",{code:e,price:i,num:t}).then(function(e){n.updateStockInfo(e.info),o&&o(e)})},i.prototype.GetStockDetailInfo=function(t,i){Utils.Socket.send("stock","GetStockDetailInfo",{code:t}).then(function(e){o.AppFacade.getInstance().sendNotification(CN.STOCK_DETAIL_INFO_UPDATE,{code:t,detailInfo:e.detailInfo}),i&&i(e)})},i.prototype.GetStockDealInfo=function(t){var i=this;Utils.Socket.send("stock","GetStockDealInfo",{}).then(function(e){i.stockDealList=e.stockDealList,t&&t(e)})},i.N="StockPy",i);function i(){var e=t.call(this,i.N)||this;return e.isInit=!1,e.newsList=new Array,e.stockList=new Array,e.stockDealList=new Array,e.stockHoldList=new Array,e.lastUpdateDt=0,e}o.StockPy=e,__reflect(e.prototype,"game.StockPy")}(game=game||{}),function(i){var o,e=(__extends(n,o=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,i.TeamBossView),this.addSubView(n.SV.DETAIL,i.TeamBossChallengeView),this.addSubView(n.SV.JIJIE_CENTER,i.TeamBossJiJieCenterPanel),this.addSubView(n.SV.JIJIE_MY_TEAM,i.TeamBossJiJieMyTeamPanel)},n.prototype.initNotice=function(){NoticeManager.setChildType(NT.TEAM_BOSS_APPLY_CENTER,[NT.TEAM_BOSS_APPLY_BTN]),NoticeManager.setChildType(NT.ALL_ACTIVITY[EActivityType.TeamBoss],[NT.TEAM_BOSS_APPLY_CENTER])},n.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.TEAMBOSS_UPDATE_INFO,CN.TEAMBOSS_UPDATE_TEAM_INFO,CN.FIGHT_ALL_DONE_AND_EXIT,CN.TEAMBOSS_UPDATE_APPLYRECORDS]},n.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:break;case CN.TEAMBOSS_UPDATE_INFO:this.updateView(n.SV.MAIN);break;case CN.TEAMBOSS_UPDATE_TEAM_INFO:this.updateView(n.SV.JIJIE_CENTER),this.updateView(n.SV.JIJIE_MY_TEAM),this.getSubView(n.SV.MAIN)&&this.getSubView(n.SV.MAIN).updateTeamInfo(),i.AppFacade.getInstance().retrieveProxy(i.FriendPy.N).clearInviteHistory(MODULE.TeamBoss);break;case CN.FIGHT_ALL_DONE_AND_EXIT:break;case CN.TEAMBOSS_UPDATE_APPLYRECORDS:Utils.UnlockMgr.checkPass(MODULE.TeamBoss,!1).allow&&i.AppFacade.getInstance().retrieveProxy(i.TeamBossPy.N).updateApplyList(t.list)}},n.N="TeamBossMediator",n.SV={MAIN:1,DETAIL:2,JIJIE_CENTER:3,JIJIE_MY_TEAM:4},n);function n(e){void 0===e&&(e=null);var t=o.call(this,n.N,e)||this;return t.initNotice(),t}i.TeamBossMediator=e,__reflect(e.prototype,"game.TeamBossMediator")}(game=game||{}),function(o){var e=(t.registerAll=function(){(new n).register(),(new h).register(),(new u).register(),(new s).register()},t);function t(){}o.TeamBossProcessor=e,__reflect(e.prototype,"game.TeamBossProcessor");var i,n=(i=o.ProcessorBase,__extends(a,i),a.prototype.execute=function(e){var t=e.getBody();o.AppFacade.getInstance().retrieveProxy(o.TeamBossPy.N).updateInfo(t.info,!0)},a);function a(){return i.call(this,"teamBoss.TeamBossInfoP",a)||this}__reflect(n.prototype,"TeamBossInfoP");var r,s=(r=o.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody(),i=o.AppFacade.getInstance().retrieveProxy(o.TeamBossPy.N);i.info?(Array.isArray(t.teams)&&(i.centerTeams.splice(0),t.teams.forEach(function(e){if(e.sectionId<=i.info.sectionId+1){var t=new o.TeamVO(e.team);t.otherInfo={sectionId:e.sectionId},i.centerTeams.push(t)}})),o.AppFacade.getInstance().updateView(o.TeamBossMediator.N,o.TeamBossMediator.SV.JIJIE_CENTER)):egret.warn("还没拉取组队boss数据，不处理队伍下推")},c);function c(){return r.call(this,"teamBoss.TeamListP",c)||this}__reflect(s.prototype,"TeamBossTeamListP");var l,h=(l=o.ProcessorBase,__extends(p,l),p.prototype.execute=function(e){var t=e.getBody();o.AppFacade.getInstance().retrieveProxy(o.TeamBossPy.N).updateInfo(t.info)},p);function p(){return l.call(this,"teamBoss.TeamBossAssistInfoP",p)||this}__reflect(h.prototype,"TeamBossAssistInfoP");var d,u=(d=o.ProcessorBase,__extends(g,d),g.prototype.execute=function(e){var t=o.AppFacade.getInstance().retrieveProxy(o.TeamBossPy.N);if(t.amILeader()){var i=e.getBody();t.applyRecords.push(new o.ApplyRecordVO(i.record)),NoticeManager.updateNotice(NT.TEAM_BOSS_APPLY_BTN)}},g);function g(){return d.call(this,"teamBoss.ApplyRecordP",g)||this}__reflect(u.prototype,"ApplyRecordP")}(game=game||{}),function(l){var t,e=(__extends(i,t=BaseProxy),i.prototype.addNotice=function(){NoticeManager.registerCB(NT.TEAM_BOSS_APPLY_BTN,this.handleApplyDotInfo,this,MODULE.TeamBoss)},i.prototype.handleApplyDotInfo=function(){return this.amILeader()&&this.applyRecords&&0<this.applyRecords.length},i.prototype.updateApplyList=function(e){var t=this;this.applyRecords.splice(0),Array.isArray(e)&&e.forEach(function(e){t.applyRecords.push(new l.ApplyRecordVO(e))}),NoticeManager.updateNotice(NT.TEAM_BOSS_APPLY_BTN)},i.prototype.GetTeamBossInfo=function(t){var i=this;Utils.Socket.send("teamBoss","GetTeamBossInfo",{}).then(function(e){i.updateInfo(e.info),t&&t()})},i.prototype.Challenge=function(e){l.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeTeamBoss,pb1:"teamBoss",pb2:"Challenge",params:{sectionId:e}})},i.prototype.GetTeamBattleRecord=function(t){var i=this;Utils.Socket.send("teamBoss","GetArenaRecord",{}).then(function(e){i.updateRecordInfo(e.arenaRecords),t&&t()})},i.prototype.updateInfo=function(e,t){if(void 0===t&&(t=!1),this.info||(this.info=new l.TeamBossInfoVO),t){var i=this.playerProxy.roleVo.playerId;if(this.isInTeam())if(e.teamInfo&&e.teamInfo.team){if(i==e.teamInfo.team.leader&&i!=this.info.teamInfo.team.leader)Utils.MsgUtils.addMidMsg('你已经成为"勇士集结"队长');else if(i==e.teamInfo.team.leader&&e.teamInfo.team.members.length>this.info.teamInfo.team.members.length)for(var o=0,n=e.teamInfo.team.members;o<n.length;o++){for(var a=n[o],r=!1,s=0,c=this.info.teamInfo.team.members;s<c.length;s++)if(c[s].baseInfo.playerId==a.baseInfo.playerId){r=!0;break}r||Utils.MsgUtils.addMidMsg(a.baseInfo.name+' 加入了你的"勇士集结"队伍')}}else Utils.MsgUtils.addMidMsg('你已经被踢出"勇士集结"队伍了')}this.info.update(e),l.AppFacade.getInstance().retrieveProxy(l.FightPy.N).isInFight||(l.AppFacade.getInstance().sendNotification(CN.TEAMBOSS_UPDATE_INFO),l.AppFacade.getInstance().sendNotification(CN.TEAMBOSS_UPDATE_TEAM_INFO))},i.prototype.updateRecordInfo=function(e){var t=this;this.arenaRecords.splice(0),e.forEach(function(e){t.arenaRecords.push(new l.TeamBattleRecord(e))}),this.arenaRecords.sort(function(e,t){return t.battleDt-e.battleDt})},i.prototype.updateTeam=function(e){this.info.teamInfo.update(e),l.AppFacade.getInstance().sendNotification(CN.TEAMBOSS_UPDATE_TEAM_INFO)},i.prototype.isInTeam=function(){return this.info&&this.info.teamInfo&&this.info.teamInfo.team&&this.info.teamInfo.team.id&&!0},i.prototype.GetPlayerTeamBossInfo=function(e,t){Utils.Socket.send("teamBoss","GetPlayerTeamBossInfo",{playerId:e}).then(function(e){t&&t(e.info)})},Object.defineProperty(i.prototype,"team",{get:function(){return this.info.teamInfo.team},enumerable:!0,configurable:!0}),i.prototype.amILeader=function(){return this.isInTeam()&&this.info.teamInfo.team.leader==this.playerProxy.playerInfoVO.playerId},i.prototype.GetCenterTeam=function(t){var i=this;Utils.Socket.send("teamBoss","GetTeamList",{}).then(function(e){i.centerTeams.splice(0),Array.isArray(e.teams)&&e.teams.forEach(function(e){var t=new l.TeamVO(e.team);t.otherInfo={sectionId:e.sectionId},i.centerTeams.push(t)}),t&&t()})},i.prototype.GetApplyRecord=function(s){var c=this;Utils.Socket.send("teamBoss","GetApplyRecord",{}).then(function(e){for(var t=[],a={},i=0,o=e.records;i<o.length;i++){var n=o[i];t.push(n.member.baseInfo.playerId),a[n.member.baseInfo.playerId]=n}var r=[];c.GetInviteFriendIds({playerIds:t},function(e){for(var t=0,i=e;t<i.length;t++){var o=i[t],n=a[o];n&&r.push(n)}c.updateApplyList(r),s&&s()})})},i.prototype.Quit=function(t,i){var o=this;void 0===i&&(i=!1),Utils.Socket.send("teamBoss","QuitTeam",{}).then(function(e){i||Utils.MsgUtils.addMidMsg("你已退出了队伍"),o.updateTeam(e.teams),t&&t(),l.AppFacade.getInstance().retrieveProxy(l.FriendPy.N).clearInviteHistory(MODULE.TeamBoss)})},i.prototype.Create=function(e,t,i){var o=this;Utils.Socket.send("teamBoss","CreateTeam",{name:e,sectionId:i&&i.sectionId}).then(function(e){o.updateTeam(e.team),t&&t()})},i.prototype.Refresh=function(e){return this.GetCenterTeam(e)},i.prototype.Search=function(e,t){var i=this;Utils.MathUtils.isNumber(e)?Utils.Socket.send("teamBoss","SearchTeam",{id:Number(e)}).then(function(e){i.centerTeams.splice(0),Array.isArray(e.teams)&&e.teams.forEach(function(e){i.centerTeams.push(new l.TeamVO(e.team))}),t&&t()}):Utils.MsgUtils.addMidMsg("请输入正确的队伍ID")},i.prototype.Apply=function(e,t,i){var o=this;void 0===i&&(i=!1),this.info&&this.info.teamInfo.team.id==e?t&&t():Utils.UnlockMgr.checkPass(MODULE.TeamBoss,!1).allow&&Utils.Socket.send("teamBoss","ApplyTeam",{id:e,isInvite:i}).then(function(e){i||Utils.MsgUtils.addMidMsg("已申请"),e.team&&o.updateTeam(e.team),t&&t()})},i.prototype.Kick=function(e,t){var i=this;Utils.Socket.send("teamBoss","TickMember",{playerId:e}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.Agree=function(e,t){var i=this;Utils.Socket.send("teamBoss","AgreeMember",{playerId:e}).then(function(e){i.updateTeam(e.team),i.updateApplyList(e.records),t&&t()})},i.prototype.Refuse=function(e,t){var i=this;Utils.Socket.send("teamBoss","RefuseMember",{playerId:e}).then(function(e){i.updateTeam(e.team),i.updateApplyList(e.records),t&&t()})},i.prototype.SwitchLeader=function(e,t){var i=this;Utils.Socket.send("teamBoss","TransferLeader",{playerId:e}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.SaveFormation=function(e,t){var i=this;Utils.Socket.send("teamBoss","ChangeFormation",{playerIds:e}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.Archive=function(t){var i=this;Utils.Socket.send("teamBoss","Archive",{}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.Invite=function(t){var i=this;Utils.Socket.send("teamBoss","Invite",{}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.GetInviteFriendIds=function(e,t){var i=this;Utils.Socket.send("teamBoss","GetInviteFriendIds",{playerIds:e.playerIds}).then(function(e){i.invitePlayerIds=e.playerIds,t&&t(e.playerIds)})},i.N="TeamBossPy",i);function i(){var e=t.call(this,i.N)||this;return e.isZiDong=!0,e.playerProxy=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),e.arenaRecords=new Array,e.centerTeams=new Array,e.applyRecords=new Array,e.addNotice(),e}l.TeamBossPy=e,__reflect(e.prototype,"game.TeamBossPy",["ICommonJiJieInterface"])}(game=game||{}),function(n){var t,e=(__extends(i,t=BasePanel),i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.removeNotice()},i.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.TEAM_BOSS_APPLY_CENTER,this.btn_center.$children[0],this,{percentX:90/146,percentY:8/85})},i.prototype.removeNotice=function(){NoticeManager.removeNoticeListener(NT.TEAM_BOSS_APPLY_CENTER)},i.prototype.showCenter=function(){this.proxy.isInTeam()?n.AppFacade.getInstance().showSubView(n.TeamBossMediator.N,n.TeamBossMediator.SV.JIJIE_MY_TEAM):n.AppFacade.getInstance().showSubView(n.TeamBossMediator.N,n.TeamBossMediator.SV.JIJIE_CENTER)},i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btn),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top),this.img_add0.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.showCenter()},this),this.img_add1.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.showCenter()},this),this.img_add2.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.showCenter()},this),UIActionManager.breathe(this.img_add0,{scaleX:.3,scaleY:.3}),UIActionManager.breathe(this.img_add1,{scaleX:.3,scaleY:.3}),UIActionManager.breathe(this.img_add2,{scaleX:.3,scaleY:.3}),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),this.btn_go.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.go()},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){n.AppFacade.getInstance().showSubView(n.RankMediator.N,n.RankMediator.SV.COMMON,{module:"TEAM_BOSS"})},this),this.btn_center.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.showCenter()},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){var t=n.GameMVC.activityPy.allActivityData[EActivityType.TeamBoss];if(t&&t.data){var i=JSON.parse(t.content);n.GameMVC.activityMed.showHelpDialog(i[4])}},this),this.gp_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){n.AppFacade.getInstance().showSubView(n.CommonMediator.N,n.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(n.Config.constConfig().TeamBossHelpRewards.constValue),type:n.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this),DragonBoneTools.create("common_activity_qingrenjie_03",function(e){e.animation.play("common_activity_qingrenjie_03",-1),this.gp_help_eff.addChild(e)},this),DragonBoneTools.create("common_activity_qingrenjie_01",function(e){e.animation.play("common_activity_qingrenjie_01",-1),e.x=165,e.y=330,this.gp_boss.addChild(e)},this),this.addNotice(),this.fetchExpeInfo()},i.prototype.fetchExpeInfo=function(){this.proxy.GetTeamBossInfo(function(){})},i.prototype.updateView=function(e,t){if(!t&&this.proxy.info){this.gp_rewards.removeChildren();var i=n.Config.teamBoss()[this.proxy.info.sectionId+1];i?(this.btn_go.visible=this.cu_boss.visible=!0,this.cu_boss.update({model:i.model||"hero_018_02",isStatic:!0}),this.lb_curLevel.text=""+i.name,n.GameMgr.getInstance().CommonGpAddReward(this.gp_rewards,i.rewards)):(this.btn_go.visible=this.cu_boss.visible=!1,this.lb_curLevel.text="已通关",this.gp_rewards.removeChildren());var o=Number(n.Config.constConfig().MaxTeamBossHelpRewardTime.constValue);this.blb_count.text=o-(this.proxy.info.helpTime||0)+"/"+o,this.gp_help_eff.visible=0<o-(this.proxy.info.helpTime||0),this.proxy.isInTeam()||this.updateTeamInfo()}},i.prototype.updateTeamInfo=function(){var r=this;this.img_leader0.visible=this.cu_team_member0.visible=!1,this.img_leader1.visible=this.cu_team_member1.visible=!1,this.img_leader2.visible=this.cu_team_member2.visible=!1,this.img_add0.visible=!0,this.img_add1.visible=!0,this.img_add2.visible=!0,UIActionManager.hideEffect(this.gp_role0),UIActionManager.hideEffect(this.gp_role1),UIActionManager.hideEffect(this.gp_role2),this.lb_name0.text="",this.lb_name1.text="",this.lb_name2.text="",this.btn_go.touchEnabled=!0,this.btn_go.label="挑 战",this.btn_go.skinName="skins.ButtonSkinYellow",this.proxy.isInTeam()?(this.proxy.team.members.forEach(function(e,t){var i=r["cu_team_member"+t];i&&(i.visible=!0,i.update({reqStyle:ROLE_STYLE.Fashion,vo:e.baseInfo})),e.isLeader&&(r["img_leader"+t].visible=!0);var o=r["lb_name"+t];o&&(o.text=e.baseInfo.name);var n=r["img_add"+t];n&&(n.visible=!1);var a=r["gp_role"+t];UIActionManager.addEffect(a,"common_activity_qingrenjie_02",{offectX:0,offectY:-15})}),this.proxy.amILeader()||(this.btn_go.touchEnabled=!1,this.btn_go.label="已组队",this.btn_go.skinName="skins.ButtonSkinSure")):(this.cu_team_member1.update({reqStyle:ROLE_STYLE.Fashion}),UIActionManager.addEffect(this.gp_role1,"common_activity_qingrenjie_02",{offectX:0,offectY:-15}),this.cu_team_member1.visible=!0,this.img_add1.visible=!1,this.lb_name1.text=this.playerPy.playerInfoVO.name)},i.prototype.go=function(){var e=n.Config.teamBoss()[this.proxy.info.sectionId+1];n.AppFacade.getInstance().showSubView(n.TeamBossMediator.N,n.TeamBossMediator.SV.DETAIL,{config:e})},i);function i(){var e=t.call(this)||this;return e.skinName="TeamBossViewSkin",e.proxy=n.AppFacade.getInstance().retrieveProxy(n.TeamBossPy.N),e.backPy=n.AppFacade.getInstance().retrieveProxy(n.BackpackPy.N),e.playerPy=n.AppFacade.getInstance().retrieveProxy(n.PlayerPy.N),e}n.TeamBossView=e,__reflect(e.prototype,"game.TeamBossView")}(game=game||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.reward_items=new Array,this.inButton()},o.prototype.inButton=function(){var e=this;this.challge_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.proxy.isInTeam()?e.proxy.amILeader()?e.proxy.Challenge(e.curSectionId):Utils.MsgUtils.addMidMsg("只有队长可发起挑战"):e.proxy.Challenge(e.curSectionId),e.mediator.hideSubView(e)},this),this.challge_join.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.mediator.hideSubView(e),t.AppFacade.getInstance().showSubView(t.TeamBossMediator.N,t.TeamBossMediator.SV.JIJIE_CENTER)},this),this.commonTanKuang.img_title_bg.visible=!1,this.commonTanKuang.onCloseCB=function(){e.mediator.hideSubView(e)}},o.prototype.updateView=function(e,t){var i=this;this.proxy.isInTeam()&&(this.challge_fight.label="挑战",this.challge_join.parent&&this.challge_join.parent.removeChild(this.challge_join));var o=e.config;this.curSectionId=o.id,this.img_ylq.visible=this.img_ytg.visible=this.proxy.info.sectionId>=this.curSectionId,this.currentState="can";for(var n=0,a=this.reward_items;n<a.length;n++){var r=a[n];r&&r.parent&&r.parent.removeChild(r)}for(var s=0,c=0,l=JSON.parse(o.rewards);c<l.length;c++){var h=l[c],p=customui.BaseItemFactory.create(21);p.updateData({type:h[0],code:h[1],num:h[2]}),p.y=0,p.x=0+s++*(p.width+30)*.7,p.scaleX=.7,p.scaleY=.7,this.reward_items.push(p),this.gp_reward_show.addChild(p)}this.gp_enermy.removeChildren();var d=JSON.parse(o.creeps);Array.isArray(d)&&d.forEach(function(e){var t=customui.BaseItemFactory.create();t.updateData({type:EEntityType.EEntityTypeHero,id:e[0]}),t.scaleX=t.scaleY=.7,i.gp_enermy.addChild(t)})},o);function o(){var e=i.call(this)||this;return e.skinName="TeamExpeditionChallengeSkin",e.proxy=t.AppFacade.getInstance().retrieveProxy(t.TeamBossPy.N),e}t.TeamBossChallengeView=e,__reflect(e.prototype,"game.TeamBossChallengeView")}(game=game||{}),function(r){var t,e=(t=r.CommonJiJieCenterPanel,__extends(i,t),i.prototype.onViewCreated=function(){this.list.itemRenderer=n,this.cu_dtc.blb_title.text="勇士集结"},i.prototype.onViewRemove=function(){},i.prototype.onShowMyTeam=function(){var e=r.Config.teamBoss()[this.commonPy.info.teamInfo.sectionId];r.AppFacade.getInstance().showSubView(r.TeamBossMediator.N,r.TeamBossMediator.SV.JIJIE_MY_TEAM,{tips:e.name})},i.prototype.showCreatePanel=function(e){var t=this,i=Object.keys(r.Config.teamBoss()),o=Number(i[i.length-1]),n=Math.min(this.TeamBossPy.info.sectionId+1,o),a=r.Config.teamBoss()[n];PopUpManager.addPopUp({obj:new r.CommonJiJieTeamCreatePanel({defaultName:this.playerPy.playerInfoVO.name,tips:"创建 "+a.name+" 的队伍，\n给你的队伍起个名字吧",doneCB:function(e){t.commonPy.Create(e,function(){t.hide(),t.onShowMyTeam()},{sectionId:n})}})})},i);function i(){var e=t.call(this)||this;return e.TeamBossPy=r.AppFacade.getInstance().retrieveProxy(r.TeamBossPy.N),e.commonPy=r.AppFacade.getInstance().retrieveProxy(r.TeamBossPy.N),e}r.TeamBossJiJieCenterPanel=e,__reflect(e.prototype,"game.TeamBossJiJieCenterPanel");var o,n=(o=r.CommonJiJieCenterItemRender,__extends(a,o),a.prototype.dataChanged=function(){o.prototype.dataChanged.call(this);var e=r.Config.teamBoss()[this.vo.otherInfo.sectionId];e&&(this.lb_time.visible=!0,this.lb_time.text=""+e.name)},a);function a(){return null!==o&&o.apply(this,arguments)||this}__reflect(n.prototype,"TeamBossJiJieCenterItemRender")}(game=game||{}),function(i){var o,e=(o=i.CommonJiJieMyTeamApplyPanel,__extends(t,o),t.prototype.onViewCreated=function(){},t.prototype.onViewRemove=function(){},t.prototype.onShowMyTeam=function(){i.AppFacade.getInstance().showSubView(i.TeamBossMediator.N,i.TeamBossMediator.SV.JIJIE_MY_TEAM)},t.prototype.onFetch=function(e){this.commonPy.GetApplyRecord(function(){e()})},t);function t(e){var t=o.call(this,e)||this;return t.commonPy=i.AppFacade.getInstance().retrieveProxy(i.TeamBossPy.N),t}i.TeamBossJiJieMyTeamApplyPanel=e,__reflect(e.prototype,"game.TeamBossJiJieMyTeamApplyPanel")}(game=game||{}),function(s){var i,e=(i=s.CommonJiJieMyTeamPanel,__extends(t,i),Object.defineProperty(t.prototype,"py",{get:function(){return this.commonPy},enumerable:!0,configurable:!0}),t.prototype.canKick=function(){return!0},t.prototype.inviteCallback=function(){var e=s.AppFacade.getInstance().retrieveProxy(s.TeamBossPy.N),a=s.Config.broadcastConfig()[56].content,t=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N),r=[[2,t.playerInfoVO.name,t.playerInfoVO.playerId,EEntityType.EEntityTypePlayer],[2,Math.ceil(e.info.teamInfo.sectionId)],[1,"<<点击申请",e.info.teamInfo.team.id,MODULE.TeamBoss]];s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N).getFriendList(function(){PopUpManager.addPopUp({obj:new s.InviteFriendView({moduleId:MODULE.TeamBoss,tabbarType:11,inviteCallback:function(i,o){for(var e=s.AppFacade.getInstance().retrieveProxy(s.TeamBossPy.N),t=0,n=e.team.members;t<n.length;t++)if(n[t].baseInfo.playerId==i)return void Utils.MsgUtils.addMidMsg("该好友已经在队伍里面了");e.GetPlayerTeamBossInfo(i,function(e){if(null!=e.sectionId){var t=s.AppFacade.getInstance().retrieveProxy(s.MainPy.N);t.addPrivatePlayer(i),t.SendMessage(EChatChannelType.EChatChannelTypePrivate,a,i,void 0,EChatSendCheckType.None,JSON.stringify(r),!0),s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N).addInviteHistory(MODULE.TeamBoss,i),o&&o()}else Utils.MsgUtils.addMidMsg("高通关数队长不能邀请低通关数好友玩家")})}})})})},t.prototype.onViewCreated=function(){NoticeManager.addNoticeListener(NT.TEAM_BOSS_APPLY_BTN,this.btn_apply.$children[0],this,{percentX:.8,percentY:.02}),NoticeManager.addNoticeListener},t.prototype.onViewRemove=function(){NoticeManager.removeNoticeListener(NT.TEAM_BOSS_APPLY_BTN)},t.prototype.updateView=function(e){if(i.prototype.updateView.call(this),this.btn_switch.enabled=this.btn_apply.enabled=this.btn_switch.enabled=this.commonPy.amILeader(),this.lb_tips.visible=!1,e&&this.py.isInTeam()&&this.py.info.teamInfo.sectionId){var t=s.Config.teamBoss()[this.py.info.teamInfo.sectionId];this.cu_dtc.blb_title.text=""+t.name}NoticeManager.updateNotice(NT.TEAM_BOSS_APPLY_BTN)},t.prototype.onShowCenter=function(){s.AppFacade.getInstance().showSubView(s.TeamBossMediator.N,s.TeamBossMediator.SV.JIJIE_CENTER)},t.prototype.onShowApply=function(t){var i=[];this.py.applyRecords.forEach(function(e){i.push(e.member.baseInfo.playerId)}),this.py.GetInviteFriendIds({playerIds:i},function(e){PopUpManager.addPopUp({obj:new s.TeamBossJiJieMyTeamApplyPanel({doneCB:function(){t&&t()},moduleId:MODULE.TeamBoss})})})},t.prototype.onFetch=function(e){this.py.GetTeamBossInfo()},t);function t(){var e=i.call(this)||this;return e.commonPy=s.AppFacade.getInstance().retrieveProxy(s.TeamBossPy.N),e}s.TeamBossJiJieMyTeamPanel=e,__reflect(e.prototype,"game.TeamBossJiJieMyTeamPanel")}(game=game||{}),function(e){var t,i=(t=eui.Component,__extends(o,t),o.prototype.initView=function(e){var a=this;this.config=e,this.keyMap=e.keyMap,this.maxs=e.max,this.curs=e.cur?e.cur:[0,0,0,0,0,0],this.shape?this.shape.graphics.clear():(this.shape=new egret.Shape,this.shape.width=this.width,this.shape.height=this.height,this.addChild(this.shape)),this.nameGPRoot.forEach(function(e){a.removeChild(e)}),this.lbs.splice(0),this.nameGPRoot.splice(0),this.dots.forEach(function(e){a.removeChild(e)}),this.dots.splice(0),this.config.name.forEach(function(e,t){var i=new eui.Label;i.bold=!0,i.size=23,i.textColor=16777215,i.strokeColor=0,i.stroke=2;var o=0,n=15;0===t?(o=-25,n=25):1===t?(o=-3,n=25):2===t?o=-20:3===t?(o=-3,n=-6):4===t?(o=-20,n=-6):5===t&&(o=-20),i.x=a.POSS[t].x*(a.R+a.nameLbOffset)+a.C.x+o,i.y=a.POSS[t].y*(a.R+a.nameLbOffset)+a.C.y+n,a.addChild(i),a.lbs.push(i),a.nameGPRoot.push(i)})},o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},o.prototype.updateCurs=function(e){for(var t in e){var i=0;(i=this.keyMap?this.keyMap[t]:Number(t))<=this.curs.length-1&&(this.curs[i]=e[t])}this.update()},o.prototype.getCurValue=function(){return this.curs},o.prototype.getMaxValue=function(){return this.maxs},o.prototype.cal=function(e){var t=this.curs[e]/this.maxs[e];return{x:this.POSS[e].x*this.R*t+this.C.x,y:this.POSS[e].y*this.R*t+this.C.y}},o.prototype.update=function(){var n=this;this.shape.graphics.clear(),this.shape.graphics.beginFill(16769138,1),this.shape.graphics.lineStyle(1,16769138,1);var a=void 0;this.curs.forEach(function(e,t){var i=n.cal(t);0===t?(a=i,n.shape.graphics.moveTo(i.x,i.y)):n.shape.graphics.lineTo(i.x,i.y);var o=n.lbs[t];o&&(o.text=""+Utils.MathUtils.toDecimal(n.curs[t]/n.maxs[t]*100,1))}),this.shape.graphics.lineTo(a.x,a.y),this.shape.graphics.endFill()},o.prototype.setPkmCode=function(e){var t=game.Config.allHeroConfig()[e],i=JSON.parse(t.talentScore),o=[4,0,1,5,2,3],n={name:[],max:[]},a={},r=0;for(var s in o)n.name.push(""),n.max.push("100"),a[r++]=i[Number(s)];o.forEach(function(e,t){n.max.push("100"),a[t]=i[e]}),this.initView(n),this.updateCurs(a)},o);function o(){var e=t.call(this)||this;return e.index2Name={},e.R=86,e.nameLbOffset=46,e.C={x:156,y:122},e.POSS=[{x:-.5,y:-.865},{x:.5,y:-.865},{x:1,y:0},{x:.5,y:.865},{x:-.5,y:.865},{x:-1,y:0}],e.skinName="RadarChartSkin",e.nameGPRoot=new Array,e.lbs=new Array,e.dots=new Array,e}e.RadarChart=i,__reflect(i.prototype,"customui.RadarChart",["eui.UIComponent","egret.DisplayObject"])}(customui=customui||{}),function(o){var e=(t.registerAll=function(){(new n).register(),(new h).register(),(new u).register(),(new _).register(),(new s).register()},t);function t(){}o.TeamExpeProcessor=e,__reflect(e.prototype,"game.TeamExpeProcessor");var i,n=(i=o.ProcessorBase,__extends(a,i),a.prototype.execute=function(e){var t=e.getBody();o.AppFacade.getInstance().retrieveProxy(o.TeamExpePy.N).updateInfo(t.info,!0)},a);function a(){return i.call(this,"teamExpedition.TeamExpeditionInfoP",a)||this}__reflect(n.prototype,"TeamExpeInfoP");var r,s=(r=o.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody(),i=o.AppFacade.getInstance().retrieveProxy(o.TeamExpePy.N);i.info?(Array.isArray(t.teams)&&(i.centerTeams.splice(0),t.teams.forEach(function(e){if(e.sectionId<=i.info.sectionId+1){var t=new o.TeamVO(e.team);t.otherInfo={sectionId:e.sectionId},i.centerTeams.push(t)}})),o.AppFacade.getInstance().updateView(o.TeamExpeMediator.N,o.TeamExpeMediator.SV.JIJIE_CENTER)):egret.warn("还没拉取组队副本数据，不处理队伍下推")},c);function c(){return r.call(this,"teamExpedition.TeamExpeditionTeamListP",c)||this}__reflect(s.prototype,"TeamExpeditionTeamListP");var l,h=(l=o.ProcessorBase,__extends(p,l),p.prototype.execute=function(e){var t=e.getBody();o.AppFacade.getInstance().retrieveProxy(o.TeamExpePy.N).updateInfo(t.info)},p);function p(){return l.call(this,"teamExpedition.TeamExpeditionAssistInfoP",p)||this}__reflect(h.prototype,"TeamExpeditionAssistInfoP");var d,u=(d=o.ProcessorBase,__extends(g,d),g.prototype.execute=function(e){var t=e.getBody();o.AppFacade.getInstance().retrieveProxy(o.TeamExpePy.N).updateRecordInfo(t.record)},g);function g(){return d.call(this,"teamExpedition.NewTeamArenaRecordP",g)||this}__reflect(u.prototype,"NewTeamExpeRecordP");var f,_=(f=o.ProcessorBase,__extends(m,f),m.prototype.execute=function(e){var t=o.AppFacade.getInstance().retrieveProxy(o.TeamExpePy.N);if(t.amILeader()){var i=e.getBody();t.applyRecords.push(new o.ApplyRecordVO(i.record)),NoticeManager.updateNotice(NT.TEAM_EXPE_APPLY_BTN)}},m);function m(){return f.call(this,"teamExpedition.ApplyRecordP",m)||this}__reflect(_.prototype,"ApplyRecordP")}(game=game||{}),function(l){var t,e=(__extends(i,t=BaseProxy),i.prototype.addNotice=function(){NoticeManager.registerCB(NT.TEAM_EXPE_REWARD,this.handleDotInfo,this,MODULE.TeamExpedition),NoticeManager.registerCB(NT.TEAM_EXPE_APPLY_BTN,this.handleApplyDotInfo,this,MODULE.TeamExpedition)},i.prototype.handleApplyDotInfo=function(){return this.amILeader()&&this.applyRecords&&0<this.applyRecords.length},i.prototype.handleDotInfo=function(){if(!this.info)return!1;this.info.sectionId;var e=this.info,t=e.targeted,i=l.Config.teamRewardConfig();for(var o in i){var n=i[o],a=-1!=t.indexOf(n.id),r=!a&&e.sectionId>=n.id;if(n.id,!a&&r)return!0}},i.prototype.updateApplyList=function(e){var t=this;this.applyRecords.splice(0),Array.isArray(e)&&e.forEach(function(e){t.applyRecords.push(new l.ApplyRecordVO(e))}),NoticeManager.updateNotice(NT.TEAM_EXPE_APPLY_BTN)},i.prototype.GetTeamExpeditionInfo=function(t){var i=this;Utils.Socket.send("teamExpedition","GetTeamExpeditionInfo",{}).then(function(e){i.updateInfo(e.info),t&&t()})},i.prototype.Challenge=function(o){l.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeTeamExpedition,customParams:{fightBg:"fight_scene_jjc"},pb1:"teamExpedition",pb2:"Challenge",params:{sectionId:o},doneCB:function(e){var t=l.Config.teamExpedition()[o],i=l.Config.teamExpedition()[o+1];i&&t.chapterId!=i.chapterId&&e&&1==e.winC&&l.Config.teamExpedition()[o+2]&&l.AppFacade.getInstance().sendNotification(CN.TEAMEXPE_OPEN_GATE),l.AppFacade.getInstance().sendNotification(CN.TEAMEXPE_UPDATE_MAP),l.AppFacade.getInstance().sendNotification(CN.TEAMEXPE_UPDATE_INFO),l.AppFacade.getInstance().sendNotification(CN.TEAMEXPE_UPDATE_TEAM_INFO)}})},i.prototype.GetTeamBattleRecord=function(t){var i=this;Utils.Socket.send("teamExpedition","GetArenaRecord",{}).then(function(e){i.updateRecordInfo(e.arenaRecords),t&&t()})},i.prototype.updateInfo=function(e,t){if(void 0===t&&(t=!1),this.info||(this.info=new l.TeamExpeInfoVO),t){var i=this.playerProxy.roleVo.playerId;if(this.isInTeam())if(e.teamInfo&&e.teamInfo.team){if(i==e.teamInfo.team.leader&&i!=this.info.teamInfo.team.leader)Utils.MsgUtils.addMidMsg('你已经成为"组队副本"队长');else if(i==e.teamInfo.team.leader&&e.teamInfo.team.members.length>this.info.teamInfo.team.members.length)for(var o=0,n=e.teamInfo.team.members;o<n.length;o++){for(var a=n[o],r=!1,s=0,c=this.info.teamInfo.team.members;s<c.length;s++)if(c[s].baseInfo.playerId==a.baseInfo.playerId){r=!0;break}r||Utils.MsgUtils.addMidMsg(a.baseInfo.name+' 加入了你的"组队副本"队伍')}}else Utils.MsgUtils.addMidMsg('你已经被踢出"组队副本"队伍了')}this.info.update(e),this.handleDotInfo(),l.AppFacade.getInstance().retrieveProxy(l.FightPy.N).isInFight||(l.AppFacade.getInstance().sendNotification(CN.TEAMEXPE_UPDATE_INFO),l.AppFacade.getInstance().sendNotification(CN.TEAMEXPE_UPDATE_TEAM_INFO))},i.prototype.updateRecordInfo=function(e){var t=this;this.arenaRecords.splice(0),e.forEach(function(e){t.arenaRecords.push(new l.TeamBattleRecord(e))}),this.arenaRecords.sort(function(e,t){return t.battleDt-e.battleDt})},i.prototype.updateTeam=function(e){this.info.teamInfo.update(e),l.AppFacade.getInstance().sendNotification(CN.TEAMEXPE_UPDATE_TEAM_INFO)},i.prototype.isInTeam=function(){return this.info&&this.info.teamInfo&&this.info.teamInfo.team&&this.info.teamInfo.team.id&&!0},i.prototype.GetPlayerTeamExpeditionInfo=function(e,t){Utils.Socket.send("teamExpedition","GetPlayerTeamExpeditionInfo",{playerId:e}).then(function(e){t&&t(e.info)})},Object.defineProperty(i.prototype,"team",{get:function(){return this.info.teamInfo.team},enumerable:!0,configurable:!0}),i.prototype.amILeader=function(){return this.isInTeam()&&this.info.teamInfo.team.leader==this.playerProxy.playerInfoVO.playerId},i.prototype.GetCenterTeam=function(t){var i=this;Utils.Socket.send("teamExpedition","GetTeamList",{}).then(function(e){i.centerTeams.splice(0),Array.isArray(e.teams)&&e.teams.forEach(function(e){var t=new l.TeamVO(e.team);t.otherInfo={sectionId:e.sectionId},i.centerTeams.push(t)}),t&&t()})},i.prototype.GetApplyRecord=function(s){var c=this;Utils.Socket.send("teamExpedition","GetApplyRecord",{}).then(function(e){for(var t=[],a={},i=0,o=e.records;i<o.length;i++){var n=o[i];t.push(n.member.baseInfo.playerId),a[n.member.baseInfo.playerId]=n}var r=[];c.GetInviteFriendIds({playerIds:t},function(e){for(var t=0,i=e;t<i.length;t++){var o=i[t],n=a[o];n&&r.push(n)}c.updateApplyList(r),s&&s()})})},i.prototype.Quit=function(t,i){var o=this;void 0===i&&(i=!1),Utils.Socket.send("teamExpedition","QuitTeam",{}).then(function(e){i||Utils.MsgUtils.addMidMsg("你已退出了队伍"),o.updateTeam(e.teams),t&&t(),l.AppFacade.getInstance().retrieveProxy(l.FriendPy.N).clearInviteHistory(MODULE.TeamExpedition)})},i.prototype.Create=function(e,t,i){var o=this;Utils.Socket.send("teamExpedition","CreateTeam",{name:e,sectionId:i&&i.sectionId}).then(function(e){o.updateTeam(e.team),t&&t()})},i.prototype.Refresh=function(e){return this.GetCenterTeam(e)},i.prototype.Search=function(e,t){var i=this;Utils.MathUtils.isNumber(e)?Utils.Socket.send("teamExpedition","SearchTeam",{id:Number(e)}).then(function(e){i.centerTeams.splice(0),Array.isArray(e.teams)&&e.teams.forEach(function(e){i.centerTeams.push(new l.TeamVO(e.team))}),t&&t()}):Utils.MsgUtils.addMidMsg("请输入正确的队伍ID")},i.prototype.Apply=function(e,t,i){var o=this;void 0===i&&(i=!1),this.info&&this.info.teamInfo.team.id==e?t&&t():Utils.UnlockMgr.checkPass(MODULE.TeamExpedition,!1).allow&&Utils.Socket.send("teamExpedition","ApplyTeam",{id:e,isInvite:i}).then(function(e){i||Utils.MsgUtils.addMidMsg("已申请"),e.team&&o.updateTeam(e.team),t&&t()})},i.prototype.Kick=function(e,t){var i=this;Utils.Socket.send("teamExpedition","TickMember",{playerId:e}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.Agree=function(e,t){var i=this;Utils.Socket.send("teamExpedition","AgreeMember",{playerId:e}).then(function(e){i.updateTeam(e.team),i.updateApplyList(e.records),t&&t()})},i.prototype.Refuse=function(e,t){var i=this;Utils.Socket.send("teamExpedition","RefuseMember",{playerId:e}).then(function(e){i.updateTeam(e.team),i.updateApplyList(e.records),t&&t()})},i.prototype.SwitchLeader=function(e,t){var i=this;Utils.Socket.send("teamExpedition","TransferLeader",{playerId:e}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.SaveFormation=function(e,t){var i=this;Utils.Socket.send("teamExpedition","ChangeFormation",{playerIds:e}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.Archive=function(t){var i=this;Utils.Socket.send("teamExpedition","Archive",{}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.Invite=function(t){var i=this;Utils.Socket.send("teamExpedition","Invite",{}).then(function(e){i.updateTeam(e.team),t&&t()})},i.prototype.GetInviteFriendIds=function(e,t){var i=this;Utils.Socket.send("teamExpedition","GetInviteFriendIds",{playerIds:e.playerIds}).then(function(e){i.invitePlayerIds=e.playerIds,t&&t(e.playerIds)})},i.N="TeamExpePy",i);function i(){var e=t.call(this,i.N)||this;return e.isZiDong=!0,e.playerProxy=l.AppFacade.getInstance().retrieveProxy(l.PlayerPy.N),e.arenaRecords=new Array,e.centerTeams=new Array,e.applyRecords=new Array,e.addNotice(),e}l.TeamExpePy=e,__reflect(e.prototype,"game.TeamExpePy",["ICommonJiJieInterface"])}(game=game||{}),function(c){var t,e=(__extends(i,t=BaseFull),i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),this.removeNotice(),this.map.reset()},i.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.TEAM_EXPE_REWARD,this.btn_reward.$children[0],this,BTN_ICON_NOTICE_POS),NoticeManager.addNoticeListener(NT.TEAM_EXPE_APPLY_CENTER,this.btn_center.$children[0],this,{percentX:90/146,percentY:8/85})},i.prototype.removeNotice=function(){NoticeManager.removeNoticeListener(NT.TEAM_EXPE_REWARD),NoticeManager.removeNoticeListener(NT.TEAM_EXPE_APPLY_CENTER)},i.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btn),this.visible=!1,this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.MainJumpConfig.jumpTo()},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeTeamExpedition})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"TEAM_COPY"})},this),Utils.UnlockMgr.checkPass(MODULE.BattleFormation,!1).allow?this.btn_mutiTeam.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.GameMVC.heroMutiTeamPy.server_GetBattleFormationInfo(function(){c.GameMVC.heroMutiTeamMed.showSubView(c.HeroMutiTeamMediator.SV.MAIN,{type:2,moduleId:MODULE.TeamExpedition})})},this):this.btn_mutiTeam.visible=!1,this.btn_gate.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.openGate()},this),this.btn_center.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){i.proxy.isInTeam()?c.AppFacade.getInstance().showSubView(c.TeamExpeMediator.N,c.TeamExpeMediator.SV.JIJIE_MY_TEAM):c.AppFacade.getInstance().showSubView(c.TeamExpeMediator.N,c.TeamExpeMediator.SV.JIJIE_CENTER)},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new c.HelpDialog({moduleId:MODULE.TeamExpedition})})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"TEAMCOPY"})},this),this.gp_map.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGpMapClick,this),this.addNotice(),this.map=Utils.MapUtils.generateCommon({source:MODULE.TeamExpedition,multiLayerScroller:this.cu_mls,loadingParent:this.getParentView(),miniMapParent:Utils.SDKMgr.getPerformConfig(6)?void 0:this.gp_mini_map,onTouchTap:function(e,t){i.mainPy.SyncCoordinateInfo(e,t,i.curChapterId,MODULE.TeamExpedition)}}),this.gp_map.addChildAt(this.map,0),this.fetchExpeInfo()},i.prototype.openGate=function(){var t=this;PopUpManager.addPopUp({obj:new c.TeamGate,closeCB:function(e){e&&t.jumpToChatper(e,!1)}})},i.prototype.fetchExpeInfo=function(){var i=this;this.proxy.GetTeamExpeditionInfo(function(){i.mainPy.GetCoordinateInfo(MODULE.TeamExpedition,function(){var e=i.mainPy.getMyCoordinateInfo(MODULE.TeamExpedition);if(e.coordinate.z)i.jumpToChatper(e.coordinate.z||1);else{var t=c.Config.teamExpedition()[i.proxy.info.sectionId+1];t?i.jumpToChatper(t.chapterId):i.jumpToChatper(1)}i.updateCoordInfo()})})},i.prototype.jumpToChatper=function(e,t){var i=this;if(void 0===t&&(t=!0),e!=this.curChapterId)if(t){var o=this.mainPy.getMyCoordinateInfo(MODULE.TeamExpedition);this.curChapterId=e;var n=c.Config.teamExpeditionChatper()[e];n||(egret.error("组队副本跳转失败",e),n=c.Config.teamExpeditionChatper()[1]);var a=JSON.parse(n.initLocation);this.map.update({isInit:!0,tiled:n.tiled,theme:n.theme,w:n.w,h:n.h,meStartTileX:a[0],meStartTileY:a[1]}),this.map.updateNPC({curPosVO:{x:o.coordinate.x,y:o.coordinate.y,isFixed:!0},followers:o.team.members}),this.updateMap(),this.visible=!0}else{var r=c.Config.teamExpeditionChatper()[e],s=JSON.parse(r.initLocation);this.mainPy.SyncCoordinateInfo(s[0],s[1],e,MODULE.TeamExpedition,function(){i.jumpToChatper(e)})}},i.prototype.updateMap=function(){if(this.curChapterId){var e=c.Config.getTeamExpeditionDetailByChapter(this.curChapterId),a=[],r=this.proxy.info.sectionId,s=void 0;function t(t){var e=!1,i=!1,o=!1;if(t.id<=r?o=e=!0:t.id==r+1&&(e=!0),null!=s&&t.id>s&&(i=!0),!e)return"continue";var n=JSON.parse(t.sectionLocation);a.push(new c.EventVO({fadeType:1==t.type?FadeRiskEventType.Creep:FadeRiskEventType.Boss,position:{x:n[0],y:n[1]},config:t,isDirty:!0,customTrigger:function(e){e&&c.AppFacade.getInstance().showSubView(c.TeamExpeMediator.N,c.TeamExpeMediator.SV.DETAIL,{config:t})},hudongAction:{showSign:!!o&&"maoxian_txt_ytg_png",needGray:i}}))}this.proxy.info.teamInfo&&this.proxy.info.teamInfo.sectionId&&(s=this.proxy.info.teamInfo.sectionId);for(var i=0,o=e;i<o.length;i++)t(o[i]);0<a.length&&r==a[a.length-1].config.id-1&&(a[a.length-1].hudongAction.showSign="_guaji_m_json.mx_img_jian3"),this.map.cleanAllEP(),this.map.updateLayerEvent({events:a})}},i.prototype.updateView=function(e){if(this.proxy.info){var t=c.Config.constConfig().MaxTeamExpeditionHelpRewardTime.constValue;this.blb_count.text=Number(t)-this.proxy.info.helpTime+"/"+t;var i=this.mainPy.getMyCoordinateInfo(MODULE.TeamExpedition);if(i&&null!=i.coordinate.z&&i.coordinate.z){var o=c.Config.teamExpeditionChatper()[i.coordinate.z];this.lb_info.text=o.name,this.lb_title.text=o.name}else{var n=c.Config.teamExpedition()[this.proxy.info.sectionId||1];o=c.Config.teamExpeditionChatper()[n.chapterId],this.lb_info.text=o.name,this.lb_title.text=o.name}}},i.prototype.onGpMapClick=function(){this.map.touchChildren||Utils.MsgUtils.addMidMsg("只有队长可以操作")},i.prototype.updateCoordInfo=function(){var e=this.mainPy.getMyCoordinateInfo(MODULE.TeamExpedition);if(e.amILeader?this.map.touchEnabled=this.map.touchChildren=!0:(this.map.touchEnabled=this.map.touchChildren=!1,e.coordinate.isDirty?this.jumpToChatper(e.coordinate.z):this.map.handleTouchTap(e.coordinate.x,e.coordinate.y)),e.coordinate.z){var t=c.Config.teamExpeditionChatper()[e.coordinate.z];this.lb_info.text=t.name,this.lb_title.text=t.name}this.lb_info2.text="X:"+e.coordinate.x+" Y:"+e.coordinate.y,this.map.isInited&&this.map.updateNPC({followers:e.team.members}),e.coordinate.iAmClean()},i.prototype.updateTeamInfo=function(){this.updateMap()},i);function i(){var e=t.call(this)||this;return e.skinName="TeamExpeViewSkin",e.proxy=c.AppFacade.getInstance().retrieveProxy(c.TeamExpePy.N),e.backPy=c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N),e.playerPy=c.AppFacade.getInstance().retrieveProxy(c.PlayerPy.N),e.mainPy=c.AppFacade.getInstance().retrieveProxy(c.MainPy.N),e}c.TeamExpeView=e,__reflect(e.prototype,"game.TeamExpeView")}(game=game||{}),function(f){var u,e=(__extends(t,u=BasePanel),t.prototype.childrenCreated=function(){var o=this;u.prototype.childrenCreated.call(this),this.img_close.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.hide()},this);var e=1,t=this.mainpy.getMyCoordinateInfo(MODULE.TeamExpedition),i=f.Config.teamExpedition(),n=f.Config.teamExpeditionChatper();if(t.coordinate.z)e=t.coordinate.z;else{var a=i[this.teamExpePy.info.sectionId+1];e=a?a.chapterId:1}function r(e){var t=c["gp_gate"+e];if(t){function i(e){for(var t=1;t<=s;t++){var i=o["gate_"+t];i&&(i.source=1<t&&t<s?t==e+1?"maoxian_btn_yeqianl02_png":"maoxian_btn_yeqiana02_png":t==e+1?"maoxian_btn_yeqianl01_png":"maoxian_btn_yeqiana01_png",o["gate_lab_"+t]&&(o["gate_lab_"+t].source=t==e+1?o.GATE_LAB[t].down:o.GATE_LAB[t].up))}}1==e&&i(c.curSelectIndex),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.curSelectIndex=e-1,i(o.curSelectIndex),o.updateView()},c)}}e%20==0&&this.teamExpePy.info.sectionId%5==0?this.curSelectIndex=Math.floor(e/20):this.curSelectIndex=Math.floor((e-1)/20);for(var s=this.gp_gate.$children.length,c=this,l=1;l<=s;l++)r(l);function h(e){var t=p["map_"+n[e].id];t&&(t.pixelHitTest=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.opperationParams=20*o.curSelectIndex+e,o.hide()},p),t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.scaleX=t.scaleY=1.1},p),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.scaleX=t.scaleY=1},p))}this.gp_gate.visible=!i[this.teamExpePy.info.sectionId+1]||20<i[this.teamExpePy.info.sectionId+1].chapterId;for(var p=this,d=1;d<=20;d++)h(d);this.updateView()},t.prototype.updateView=function(){var l=this,h=1,e=this.mainpy.getMyCoordinateInfo(MODULE.TeamExpedition);if(e.coordinate.z)h=e.coordinate.z;else{var t=f.Config.teamExpedition()[this.teamExpePy.info.sectionId+1];h=t?t.chapterId:1}var p=f.Config.teamExpedition(),d=f.Config.teamExpeditionChatper(),u=!0;function i(e){var t=g["map_"+d[e].id];t.touchEnabled=!1,UIActionManager.setAbsGrey(t,!1);var i=e-1&&g["gp_line_"+d[e-1].id];i&&(i.visible=!1);var o=20*g.curSelectIndex+e;if(t)if(u){var n=p[g.teamExpePy.info.sectionId+1],a=f.GameMVC.zoneBossProxy.isFeaturesUnlock(MODULE.TeamExpedition,{id:o});if(d[o]&&g.py.playerInfoVO.level<d[o].unlockLv||n&&d[o]&&d[o].id>n.chapterId||a.isBelonged&&!a.unlock){function r(){l.py.playerInfoVO.level<d[e].unlockLv?(l.lb_content.text="("+d[o].unlockLv+"级后解锁)",l.lb_content.x=l.lockBack.x+23,l.lb_content.y=l.lockBack.y+5,l.lockBack.width=l.lb_content.width+50):(l.lb_content.text="(通过前一章解锁)",l.lb_content.x=l.lockBack.x,l.lb_content.y=l.lockBack.y+5,l.lockBack.width=l.lb_content.width+50,l.lockBack.x=l.lockBack.x-23)}g["lb_"+d[e].id].text=d[o].name,t.touchEnabled=!1,g.lock.visible=!0,g.lock.source="maoxian_img_suo_png",g.lockBack.visible=!0,g.lockBack.source="_guaji_m_json.mx_img_mingchengdi",UIActionManager.setAbsGrey(t),g.lock.scaleX=g.lock.scaleX=.9,g.lock.x=g["lb_"+d[e].id].x-31,g.lock.y=g["lb_"+d[e].id].y-10,g.lockBack.x=g["lb_"+d[e].id].x-28,g.lockBack.y=g["lb_"+d[e].id].y+22,g.lb_content.visible=!0,g.lb_content.size=17,g.lb_content.textColor=16187392,g.lock.parent||g.gp_lab.addChild(g.lock),g.lockBack.parent||g.gp_lab.addChild(g.lockBack),a.isBelonged?a.unlock?r():(g.lb_content.text="(封印之地解锁)",g.lb_content.x=g.lockBack.x,g.lb_content.y=g.lockBack.y+5,g.lockBack.width=g.lb_content.width+50):r(),g.lb_content.parent||g.gp_lab.addChild(g.lb_content),u=!1}else if(d[o])t.touchEnabled=!0,i&&(i.visible=!0),g["lb_"+d[e].id].text=d[o].name;else{var s=d[e];t.touchEnabled=!1,g.lockBack.visible=!0,g.lockBack.source="_guaji_m_json.mx_img_mingchengdi",g.lock.visible=!0,g.lock.source="maoxian_img_suo_png",UIActionManager.setAbsGrey(t),g.lock.scaleX=g.lock.scaleX=.9,g.lock.x=g["lb_"+s.id].x+20,g.lock.y=g["lb_"+s.id].y-15,g.lockBack.x=g["lb_"+s.id].x-28,g.lockBack.y=g["lb_"+s.id].y+22,g.lb_content.visible=!0,g.lb_content.size=17,g.lb_content.textColor=16187392,g.lock.parent||g.gp_lab.addChild(g.lock),g.lockBack.parent||g.gp_lab.addChild(g.lockBack),g.lb_content.text="(当前章节未开放)",g.lb_content.x=g.lockBack.x,g.lb_content.y=g.lockBack.y+5,g.lockBack.width=g.lb_content.width+50,g.lockBack.x=g.lockBack.x-23,g.lb_content.parent||g.gp_lab.addChild(g.lb_content),g["lb_"+d[e].id].text="",u=!1,g.teamExpePy.info.sectionId<5*(o-1)&&(g.lock.visible=!1,g.lockBack.visible=!1,g.lb_content.visible=!1)}}else UIActionManager.setAbsGrey(t),t.touchEnabled=!1,g["lb_"+d[e].id].text="";if(d[o]&&h==d[o].id){g.heroModel.visible=!0,g.heroModel.scaleX=g.heroModel.scaleY=.7,g.heroModel.update({reqStyle:ROLE_STYLE.Fashion});var c=g["lb_"+d[e].id];c&&(g.heroModel.x=c.x+42,g.heroModel.y=c.y-16,g.pk.visible=!0,g.pk.x=c.x+25,g.pk.y=c.y-28,g.gp_lab.addChild(g.pk),g.heroModel.parent||g.gp_lab.addChild(g.heroModel))}}this.pk.source="mx_img_dizuo_png",this.heroModel.visible=!1,this.lb_content.visible=!1,this.pk.visible=!1,this.lock.visible=!1,this.lockBack.visible=!1;for(var g=this,o=1;o<=20;o++)i(o)},t);function t(e){var t,i=u.call(this)||this;return i.mainpy=f.AppFacade.getInstance().retrieveProxy(f.MainPy.N),i.GATE_LAB=((t={})[1]={up:"maoxian_txt_wujinhuangyuan00_png",down:"maoxian_txt_wujinhuangyuan01_png",enable:!1},t[2]={up:"maoxian_txt_mihuanshazhou00_png",down:"maoxian_txt_mihuanshazhou01_png",enable:!1},t[3]={up:"maoxian_txt_heianconglin00_png",down:"maoxian_txt_heianconglin01_png",enable:!1},t),i.curSelectIndex=0,i.heroModel=new customui.RoleDynamicModel,i.pk=new eui.Image,i.lock=new eui.Image,i.lockBack=new eui.Image,i.lb_content=new eui.Label,i.skinName="GuajiGateListPanelSkin2",i.params=e,i.py=f.AppFacade.getInstance().retrieveProxy(f.PlayerPy.N),i.teamExpePy=f.AppFacade.getInstance().retrieveProxy(f.TeamExpePy.N),i}f.TeamGate=e,__reflect(e.prototype,"game.TeamGate")}(game=game||{}),function(t){var i,e=(__extends(o,i=BasePanel),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.reward_items=new Array,this.inButton()},o.prototype.inButton=function(){var e=this;this.challge_fight.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.proxy.isInTeam()?e.proxy.amILeader()?e.proxy.Challenge(e.curSectionId):Utils.MsgUtils.addMidMsg("只有队长可发起挑战"):e.proxy.Challenge(e.curSectionId),e.mediator.hideSubView(e)},this),this.challge_join.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.mediator.hideSubView(e),t.AppFacade.getInstance().showSubView(t.TeamExpeMediator.N,t.TeamExpeMediator.SV.JIJIE_CENTER)},this),this.commonTanKuang.img_title_bg.visible=!1,this.commonTanKuang.onCloseCB=function(){e.mediator.hideSubView(e)}},o.prototype.updateView=function(e,t){this.proxy.isInTeam()&&(this.challge_fight.label="挑战",this.challge_join.parent&&this.challge_join.parent.removeChild(this.challge_join));var i=e.config;this.curSectionId=i.id,this.img_ylq.visible=this.img_ytg.visible=this.proxy.info.sectionId>=this.curSectionId,this.currentState="can";for(var o=0,n=this.reward_items;o<n.length;o++){var a=n[o];a&&a.parent&&a.parent.removeChild(a)}for(var r=0,s=0,c=JSON.parse(i.rewards);s<c.length;s++){var l=c[s],h=customui.BaseItemFactory.create(21);h.updateData({type:l[0],code:l[1],num:l[2]}),h.y=0,h.x=0+r++*(h.width+30)*.7,h.scaleX=.7,h.scaleY=.7,this.reward_items.push(h),this.gp_reward_show.addChild(h)}this.gp_enermy.removeChildren();for(var p=1;p<=6;p++){var d=JSON.parse(i["creep"+p]);if(d&&""!=d){var u=customui.BaseItemFactory.create();u.updateData({type:EEntityType.EEntityTypeHero,id:d[0]}),u.scaleX=u.scaleY=.7,this.gp_enermy.addChild(u),u.touchEnabled=!1}}},o);function o(){var e=i.call(this)||this;return e.skinName="TeamExpeditionChallengeSkin",e.proxy=t.AppFacade.getInstance().retrieveProxy(t.TeamExpePy.N),e}t.TeamExpeditionChallengeView=e,__reflect(e.prototype,"game.TeamExpeditionChallengeView")}(game=game||{}),function(s){var t,e=(t=s.CommonJiJieCenterPanel,__extends(i,t),i.prototype.onViewCreated=function(){this.list.itemRenderer=n},i.prototype.onViewRemove=function(){},i.prototype.onShowMyTeam=function(){var e=s.Config.teamExpedition()[this.commonPy.info.teamInfo.sectionId];s.AppFacade.getInstance().showSubView(s.TeamExpeMediator.N,s.TeamExpeMediator.SV.JIJIE_MY_TEAM,{tips:e.name})},i.prototype.showCreatePanel=function(e){var t=this,i=Object.keys(s.Config.teamExpedition()),o=Number(i[i.length-1]),n=Math.min(this.teamExpePy.info.sectionId+1,o),a=s.Config.teamExpedition()[n],r=s.Config.teamExpeditionChatper()[a.chapterId];PopUpManager.addPopUp({obj:new s.CommonJiJieTeamCreatePanel({defaultName:this.playerPy.playerInfoVO.name,tips:"创建 "+r.name+"-"+a.name+" 的队伍，\n给你的队伍起个名字吧",doneCB:function(e){t.commonPy.Create(e,function(){t.hide(),t.onShowMyTeam()},{sectionId:n})}})})},i);function i(){var e=t.call(this)||this;return e.teamExpePy=s.AppFacade.getInstance().retrieveProxy(s.TeamExpePy.N),e.mainPy=s.AppFacade.getInstance().retrieveProxy(s.MainPy.N),e.commonPy=s.AppFacade.getInstance().retrieveProxy(s.TeamExpePy.N),e}s.TeamExpeJiJieCenterPanel=e,__reflect(e.prototype,"game.TeamExpeJiJieCenterPanel");var o,n=(o=s.CommonJiJieCenterItemRender,__extends(a,o),a.prototype.dataChanged=function(){o.prototype.dataChanged.call(this);var e=s.Config.teamExpedition()[this.vo.otherInfo.sectionId];if(e){var t=s.Config.teamExpeditionChatper()[e.chapterId];t&&(this.lb_time.visible=!0,this.lb_time.text=t.name+"-"+e.name)}},a);function a(){return null!==o&&o.apply(this,arguments)||this}__reflect(n.prototype,"TeamExpeJiJieCenterItemRender")}(game=game||{}),function(i){var o,e=(o=i.CommonJiJieMyTeamApplyPanel,__extends(t,o),t.prototype.onViewCreated=function(){},t.prototype.onViewRemove=function(){},t.prototype.onShowMyTeam=function(){i.AppFacade.getInstance().showSubView(i.TeamExpeMediator.N,i.TeamExpeMediator.SV.JIJIE_MY_TEAM)},t.prototype.onFetch=function(e){this.commonPy.GetApplyRecord(function(){e()})},t);function t(e){var t=o.call(this,e)||this;return t.commonPy=i.AppFacade.getInstance().retrieveProxy(i.TeamExpePy.N),t}i.TeamExpeJiJieMyTeamApplyPanel=e,__reflect(e.prototype,"game.TeamExpeJiJieMyTeamApplyPanel")}(game=game||{}),function(s){var o,e=(o=s.CommonJiJieMyTeamPanel,__extends(t,o),Object.defineProperty(t.prototype,"py",{get:function(){return this.commonPy},enumerable:!0,configurable:!0}),t.prototype.canKick=function(){return!0},t.prototype.inviteCallback=function(){var e=s.AppFacade.getInstance().retrieveProxy(s.TeamExpePy.N),a=s.Config.broadcastConfig()[26].content,t=s.AppFacade.getInstance().retrieveProxy(s.PlayerPy.N),r=[[2,t.playerInfoVO.name,t.playerInfoVO.playerId,EEntityType.EEntityTypePlayer],[2,Math.ceil(e.info.teamInfo.sectionId/5)],[2,e.info.teamInfo.sectionId%5==0?5:e.info.teamInfo.sectionId%5],[1,"<<点击入队",e.info.teamInfo.team.id,MODULE.TeamExpedition]];s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N).getFriendList(function(){PopUpManager.addPopUp({obj:new s.InviteFriendView({moduleId:MODULE.TeamExpedition,tabbarType:11,inviteCallback:function(i,o){for(var e=s.AppFacade.getInstance().retrieveProxy(s.TeamExpePy.N),t=0,n=e.team.members;t<n.length;t++)if(n[t].baseInfo.playerId==i)return void Utils.MsgUtils.addMidMsg("该好友已经在队伍里面了");e.GetPlayerTeamExpeditionInfo(i,function(e){if(null!=e.sectionId){var t=s.AppFacade.getInstance().retrieveProxy(s.MainPy.N);t.addPrivatePlayer(i),t.SendMessage(EChatChannelType.EChatChannelTypePrivate,a,i,void 0,EChatSendCheckType.None,JSON.stringify(r),!0),s.AppFacade.getInstance().retrieveProxy(s.FriendPy.N).addInviteHistory(MODULE.TeamExpedition,i),o&&o()}else Utils.MsgUtils.addMidMsg("高通关数队长不能邀请低通关数好友玩家")})}})})})},t.prototype.onViewCreated=function(){NoticeManager.addNoticeListener(NT.TEAM_EXPE_APPLY_BTN,this.btn_apply.$children[0],this,{percentX:.8,percentY:.02}),NoticeManager.addNoticeListener},t.prototype.onViewRemove=function(){NoticeManager.removeNoticeListener(NT.TEAM_EXPE_APPLY_BTN)},t.prototype.updateView=function(e){if(o.prototype.updateView.call(this),this.btn_switch.enabled=this.btn_apply.enabled=this.btn_switch.enabled=this.commonPy.amILeader(),this.lb_tips.visible=!1,e&&this.py.isInTeam()&&this.py.info.teamInfo.sectionId){var t=s.Config.teamExpedition()[this.py.info.teamInfo.sectionId],i=s.Config.teamExpeditionChatper()[t.chapterId];this.cu_dtc.blb_title.text=i.name+"-"+t.name}NoticeManager.updateNotice(NT.TEAM_EXPE_APPLY_BTN)},t.prototype.onShowCenter=function(){s.AppFacade.getInstance().showSubView(s.TeamExpeMediator.N,s.TeamExpeMediator.SV.JIJIE_CENTER)},t.prototype.onShowApply=function(t){var i=[];this.py.applyRecords.forEach(function(e){i.push(e.member.baseInfo.playerId)}),this.py.GetInviteFriendIds({playerIds:i},function(e){PopUpManager.addPopUp({obj:new s.TeamExpeJiJieMyTeamApplyPanel({doneCB:function(){t&&t()},moduleId:MODULE.TeamExpedition})})})},t.prototype.onFetch=function(e){this.py.GetTeamExpeditionInfo()},t);function t(){var e=o.call(this)||this;return e.commonPy=s.AppFacade.getInstance().retrieveProxy(s.TeamExpePy.N),e}s.TeamExpeJiJieMyTeamPanel=e,__reflect(e.prototype,"game.TeamExpeJiJieMyTeamPanel")}(game=game||{}),function(e){var t,i=(__extends(o,t=BaseMediator),o.prototype.initSubView=function(){this.addSubView(o.SV.ENTRANCE,e.TeamPlayEntranceView)},o.prototype.listNotificationInterests=function(){return[CN.HIDE_LOADING]},o.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_LOADING:this.hideAllSubView()}},o.N="TeamPlayEntranceMediator",o.SV={ENTRANCE:1},o);function o(e){return void 0===e&&(e=null),t.call(this,o.N,e)||this}e.TeamPlayEntranceMediator=i,__reflect(i.prototype,"game.TeamPlayEntranceMediator")}(game=game||{}),function(e){var t=(i.registerAll=function(){},i);function i(){}e.TeamPlayEntranceProcessor=t,__reflect(t.prototype,"game.TeamPlayEntranceProcessor")}(game=game||{}),function(e){var t,i=(__extends(o,t=BaseProxy),o.N="TeamPlayEntrancePy",o);function o(){return t.call(this,o.N)||this}e.TeamPlayEntrancePy=i,__reflect(i.prototype,"game.TeamPlayEntrancePy")}(game=game||{}),function(e){var t,i=(__extends(o,t=BasePanel),o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList(),this.img_title.source="wfrk_txt_fbtz_png"},o.prototype.initList=function(){this.item_list=new eui.List;var e=new eui.VerticalLayout;(this.item_list.layout=e).gap=10,e.horizontalAlign=egret.HorizontalAlign.CENTER,this.item_list.itemRenderer=a,this.scroller.viewport=this.item_list},o.prototype.updateView=function(){var e=[];for(var t in this.ENTRANCE_CONFIG)e.push(this.ENTRANCE_CONFIG[t]);this.item_list.dataProvider=new eui.ArrayCollection(e),this.gp_root.height=179*e.length+10*(e.length-1)+73+236},o);function o(){var e=t.call(this)||this;return e.ENTRANCE_CONFIG={TEAM_ARENA:{desc:"组队竞技场",rankingType:void 0,moduleId:MODULE.TeamArena,bg:"wfrk_img_rukou_zdjj_png"},TEAM_COPY:{desc:"组队副本",rankingType:void 0,moduleId:MODULE.TeamExpedition,bg:"wfrk_img_rukou_zdfb_png"}},e.skinName="TeamEntranceViewSkin",Utils.SoundManager.playSound(SOUND_EFF_TYPE.sound_view_close),e._popActionType=5,e._removeActionType=6,e}e.TeamPlayEntranceView=i,__reflect(i.prototype,"game.TeamPlayEntranceView");var n,a=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){n.prototype.childrenCreated.call(this),this.gp_bg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.MainJumpConfig.jumpTo(this.data.moduleId)&&e.AppFacade.getInstance().hideSubView(e.TeamPlayEntranceMediator.N,e.TeamPlayEntranceMediator.SV.ENTRANCE)},this)},r.prototype.dataChanged=function(){this.img_bg.source=this.data.bg},r);function r(){var e=n.call(this)||this;return e.skinName="EntranceView_ListItem",e}__reflect(a.prototype,"EntranceView_ListItem")}(game=game||{}),function(l){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){var e=this;t.prototype.childrenCreated.call(this),this.CommonDaTanChuKuang.blb_title.text="称 号",this.CommonDaTanChuKuang.onCloseCB=function(){e.hide()},this.roleModel.update({reqStyle:ROLE_STYLE.Fashion|ROLE_STYLE.Horse|ROLE_STYLE.Magical|ROLE_STYLE.Title}),this.gp_attrs.removeChildren(),this.initList(),this.activateComponent(),this.img_icon.visible=!1},i.prototype.initList=function(){this.list_root.itemRenderer=r,this.list_root.addItemTapEvent(this.onItemTap,this),this.list_root.setChoseFrame("ch_img_xuanzhong_png"),this.list_root.img_lastOne.source="sycx_img_jiantou_png",this.list_root.img_nextOne.source="sycx_img_jiantou_png";var e=new eui.HorizontalLayout;e.gap=15,this.list_root.layout=e;var t=l.Config.titleConfig();for(var i in this.data=[],t){var o=t[i],n=this.proxy.getCodeDt(o.code),a=JSON.parse(o.costs);this.data.push({code:o.code,icon:o.icon,frame:"ch_img_dikuang0"+o.color+"_png",notice:-1==n&&l.GameMVC.backpackPy.checkEnough(a,!1)?0:1,putOn:o.code==this.proxy.titleInfo.code?0:1})}this.data.sort(l.GeneralConfig.simpleSort("putOn","notice","code"))},i.prototype.onItemTap=function(e){this.selectIndex=e.itemIndex,this.updateBaseInfo()},i.prototype.updateView=function(e){var t=l.Config.titleConfig(),i=this.proxy.titleInfo;for(var o in this.updateBaseInfo(),this.data=[],t){var n=t[o],a=this.proxy.getCodeDt(n.code),r=JSON.parse(n.costs);this.data.push({code:n.code,icon:n.icon,jumpModule:n.jumpModule,frame:"ch_img_dikuang0"+n.color+"_png",notice:-1==a&&l.GameMVC.backpackPy.checkEnough(r,!1)?0:1,putOn:n.code==i.code?0:1,hasActivate:0<=a?0:1})}this.data.sort(l.GeneralConfig.simpleSort("putOn","notice","hasActivate","code")),this.list_root.dataProvider=new eui.ArrayCollection(this.data),this.list_root.initChangeTo(e&&e.index||0,!0)},i.prototype.updateBaseInfo=function(){var a=this,e=l.Config.titleConfig(),t=this.data[this.selectIndex]&&this.data[this.selectIndex].code||0,i=e[t];if(i){this.img_icon.source=i.icon,this.roleModel.update({reqStyle:ROLE_STYLE.Fashion|ROLE_STYLE.Horse|ROLE_STYLE.Magical|ROLE_STYLE.Title,titleCode:t}),this.lb_desc.text=i.desc,this.timer&&egret.clearInterval(this.timer),this.gp_time.visible=!1;var o=this.proxy.titleInfo,n=this.proxy.getCodeDt(t);if(0<n){var r=n+i.cycle-Utils.TimerManager.getServerTime();0<r&&(this.gp_time.visible=!0,this.bm_leftTime.text=Utils.TimerManager.getFormatBySecond1(r),this.timer=egret.setInterval(function(){a.bm_leftTime.text=Utils.TimerManager.getFormatBySecond1(r)},this,1e3))}if(UIActionManager.setAbsGrey(this.btn_ope,!1),t==o.code)this.btn_ope.label="",this.btn_ope.skinName="skins.ButtonSkinRed",this.btn_ope.label="卸下",this.btnFunc=function(){a.proxy.PutTitleDown(t,function(){a.updateView(),Utils.MsgUtils.addMidMsg("卸下成功")})};else if(0<=n)this.btn_ope.label="",this.btn_ope.skinName="skins.ButtonSkinGreen",this.btn_ope.label="穿戴",this.btnFunc=function(){a.proxy.PutTitleOn(t,function(){a.updateView(),Utils.MsgUtils.addMidMsg("穿戴成功")})};else{this.btn_ope.label="",this.btn_ope.skinName="skins.ButtonSkinGreen",this.btn_ope.label="激活",this.btnFunc=function(){a.proxy.ActivateTitle(t,function(){a.updateView()})};var s=l.GameMVC.backpackPy.checkEnough(JSON.parse(i.costs),!1);UIActionManager.setAbsGrey(this.btn_ope,!s)}var c=JSON.parse(i.attr);this.gp_attrs.$children.forEach(function(e){a.attrGpsFree.push(e)}),this.gp_attrs.removeChildren(),c.forEach(function(e,t){var i=a.makeAttrGp(),o=l.GeneralConfig.getAttrName(e[0]),n=l.GeneralConfig.getAttrValue(e[1]);i.$children[0].text=o,i.$children[1].text="+"+n,a.gp_attrs.addChild(i)})}else Utils.MsgUtils.addMidMsg("找不到称号配置")},i.prototype.activateComponent=function(){var t=this;this.btn_ope.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.btnFunc&&t.btnFunc()},this),this.btn_attrs.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new s({attr:t.proxy.titleInfo.attr})})},this),this.btn_jump.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(t.data[t.selectIndex]){var e=t.data[t.selectIndex].jumpModule;e?(l.MainJumpConfig.jumpTo(e),t.hide()):Utils.MsgUtils.addMidMsg("暂无获取途径")}else Utils.MsgUtils.addMidMsg("数据错误")},this)},i.prototype.makeAttrGp=function(){if(0<this.attrGpsFree.length)return this.attrGpsFree.pop();var e=new eui.Group;e.width=170;var t=new eui.BitmapLabel;t.font="green_num_fnt",t.left=89;var i=new eui.Label;return i.size=22,i.textColor=8866344,e.addChild(i),e.addChild(t),e},i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this);var e=l.GameMVC.fashionMed.getSubView(l.FashionMediator.SV.MAIN);e&&e.updateModelForce()},i);function i(){var e=t.call(this)||this;return e.proxy=l.AppFacade.getInstance().retrieveProxy(l.TitlePy.N),e.selectIndex=0,e.attrGpsFree=[],e.data=[],e.skinName="TitleMainView",e}l.TitleMainView=e,__reflect(e.prototype,"game.TitleMainView");var o,r=(o=eui.ItemRenderer,__extends(n,o),n.prototype.dataChanged=function(){this.img_frame.source=this.data.frame,this.img_icon.source=this.data.icon,this.img_notice.visible=!this.data.notice,this.img_putOn.visible=!this.data.putOn,this.data.hasActivate&&this.data.notice?UIActionManager.setGrey(this.gp_main,!0):UIActionManager.setGrey(this.gp_main,!1)},n.itemWidth=146,n);function n(){var e=o.call(this)||this;return e.skinName="TitleItem",e}__reflect(r.prototype,"TitleItem");var a,s=(__extends(c,a=BasePanel),c.prototype.childrenCreated=function(){var e=this;a.prototype.childrenCreated.call(this),Utils.ComponentUtils.registerListener(this.btn_left,egret.TouchEvent.TOUCH_TAP,function(){e.updateView({type:1})},this),Utils.ComponentUtils.registerListener(this.btn_right,egret.TouchEvent.TOUCH_TAP,function(){e.updateView({type:2})},this),this.updateView(this.info,!0)},c.prototype.updateView=function(e,t){var a=this;if(void 0===t&&(t=!1),this.info=e||this.info,t){var i=l.Config.attrDescConfig(),o=[];for(var n in i){var r=i[n];r.isShow&&o.push(r)}o.sort(function(e,t){return e.priority-t.priority});var s=this.info.attr;"string"==typeof s&&(s=JSON.parse(this.info.attr)),o.forEach(function(e){var t=s[e.type]||0;if(0!=t){var i=t%1e5,o=t-i;if(0!=o){var n=a.makeGroup(e.shortDesc,o);a.gp_listAttr.addChild(n)}0!=i&&(n=a.makeGroup(e.shortDesc,i),a.gp_listAttr.addChild(n))}}),this.gp_listAttr.$children.length?this.gp_empty.visible=!1:this.gp_empty.visible=!0,o.forEach(function(e){var t=new eui.Group;t.width=320;var i=new eui.Label(e.shortDesc+"：");i.y=2,i.textColor=764145,i.size=20,i.right=222,t.addChild(i);var o=new eui.Label(e.desc);o.y=2,o.size=20,o.width=230,o.left=100,o.lineSpacing=6,t.addChild(o),a.gp_listDesc.addChild(t)})}switch(e&&e.type||1){case 1:this.gp_attr.visible=!0,this.gp_desc.visible=!1,this.btn_left.visible=!1,this.btn_right.visible=!0;break;case 2:this.gp_attr.visible=!1,this.gp_desc.visible=!0,this.btn_left.visible=!0,this.btn_right.visible=!1}},c.prototype.makeGroup=function(e,t){var i=new eui.Group;i.width=300,i.height=27;var o=new eui.Label(e);o.size=24,i.addChild(o);var n=l.GeneralConfig.getAttrValue(t),a=new eui.Label(""+n);return a.size=24,a.right=3,i.addChild(a),a.verticalCenter=o.verticalCenter=0,i},c);function c(e){var t=a.call(this)||this;return t.skinName="HeroAttrDetailsPanelSkin",t.info=e,t}l.CommonAttrDetailsPanel=s,__reflect(s.prototype,"game.CommonAttrDetailsPanel")}(game=game||{}),function(n){var i,e=(__extends(o,i=BaseMediator),o.prototype.initSubView=function(){this.addSubView(o.SV.MAIN,n.TitleMainView)},o.prototype.listNotificationInterests=function(){return[CN.HIDE_ALL_SUBVIEW,CN.LOGIN_FINAL_DONE,CN.CONFIG_ALL_LOADED]},o.prototype.handleNotification=function(e){switch(e.getBody(),e.getName()){case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.LOGIN_FINAL_DONE:Utils.UnlockMgr.checkPass(MODULE.Title,!1).allow&&this.proxy.GetTitleInfo();break;case CN.CONFIG_ALL_LOADED:var t=n.Config.titleConfig();for(var i in t){var o=t[i];NoticeManager.addCareCost(o.costs,function(){NoticeManager.updateNotice(NT.TITLE)})}}},o.N="TitleMediator",o.SV={MAIN:1},o);function o(e){void 0===e&&(e=null);var t=i.call(this,o.N,e)||this;return t.proxy=n.AppFacade.getInstance().retrieveProxy(n.TitlePy.N),t}n.TitleMediator=e,__reflect(e.prototype,"game.TitleMediator")}(game=game||{}),function(i){var e=(t.registerAll=function(){(new n).register()},t);function t(){}i.TitleProcessor=e,__reflect(e.prototype,"game.TitleProcessor");var o,n=(o=i.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){var t=e.getBody();console.log("TitleInfoP",t),i.GameMVC.titlePy.titleInfo.update(t.info)},a);function a(){return o.call(this,"Title.TitleInfoP",a)||this}i.TitleInfoP=n,__reflect(n.prototype,"game.TitleInfoP")}(game=game||{}),function(n){var t,e=(__extends(i,t=BaseProxy),i.prototype.updateNotice=function(){var e=n.Config.titleConfig();for(var t in e){var i=e[t];if(-1==this.getCodeDt(i.code)){var o=JSON.parse(i.costs);if(n.GameMVC.backpackPy.checkEnough(o,!1))return!0}}return!1},i.prototype.GetTitleInfo=function(t){var i=this;Utils.Socket.send("title","GetTitleInfo",{}).then(function(e){i.titleInfo.update(e.info),t&&t()})},i.prototype.ActivateTitle=function(e,t){var i=this;Utils.Socket.send("title","ActivateTitle",{code:e}).then(function(e){i.titleInfo.update(e.info),n.AppFacade.getInstance().sendNotification(CN.TITLE_UPDATE),t&&t()})},i.prototype.PutTitleOn=function(e,t){var i=this;Utils.Socket.send("title","PutTitleOn",{code:e}).then(function(e){i.titleInfo.code=e.code,n.GameMVC.playerPy.playerInfoVO.titleCode=e.code,n.AppFacade.getInstance().sendNotification(CN.TITLE_UPDATE),t&&t()})},i.prototype.PutTitleDown=function(e,t){var i=this;Utils.Socket.send("title","PutTitleDown",{code:e}).then(function(e){i.titleInfo.code=e.code,n.GameMVC.playerPy.playerInfoVO.titleCode=e.code,n.AppFacade.getInstance().sendNotification(CN.TITLE_UPDATE),t&&t()})},i.prototype.getCodeDt=function(t){var i=-1;return this.titleInfo.titleList.forEach(function(e){e.code!=t||(i=e.dt)}),i},i.N="TitlePy",i);function i(){var e=t.call(this,i.N)||this;return e.titleInfo=new a({}),NoticeManager.registerCB(NT.TITLE,e.updateNotice,e,MODULE.Title),e}n.TitlePy=e,__reflect(e.prototype,"game.TitlePy");var o,a=(o=n.BaseVO,__extends(r,o),r.prototype.update=function(e){this.titleList=e.titleList||this.titleList,this.attr=e.attr&&JSON.parse(e.attr)||this.attr,this.code=e.code||this.code,this.fightCap=e.fightCap||this.fightCap},r);function r(e){var t=o.call(this)||this;return t.titleList=new Array,t.attr={},t.code=0,t.fightCap=0,t.update(e),t}n.TitleInfo=a,__reflect(a.prototype,"game.TitleInfo")}(game=game||{}),function(o){var t,e=(__extends(n,t=BaseMediator),n.prototype.initSubView=function(){this.addSubView(n.SV.MAIN,o.TribeBattleMainView),this.addSubView(n.SV.CHALLENGE,o.TribeBattleChallengePanel),this.addSubView(n.SV.REVENGE,o.TribeBattleRevengePanel)},n.prototype.listNotificationInterests=function(){return[CN.LOGIN_FINAL_DONE,CN.HIDE_ALL_SUBVIEW,CN.TRIBE_BATTLE_INFO_UPDATED,CN.TRIBE_BATTLE_REVENGE_UPDATED]},n.prototype.handleNotification=function(e){var t=e.getBody();switch(e.getName()){case CN.LOGIN_FINAL_DONE:if(o.GameMVC.guildPy.isInGuild()){var i=Utils.UnlockMgr.getOpenInfo(MODULE.TribeBattle);i.allow&&i.isOpen&&o.GameMVC.tribeBattlePy.GetTribeBattleInfo()}break;case CN.HIDE_ALL_SUBVIEW:this.hideAllSubView();break;case CN.TRIBE_BATTLE_INFO_UPDATED:NoticeManager.updateNotice(NT.GUILD_TRIBE_BATTLE),this.updateView(n.SV.MAIN,t);break;case CN.TRIBE_BATTLE_REVENGE_UPDATED:this.updateView(n.SV.REVENGE)}},n.N="TribeBattleMed",n.SV={MAIN:1,CHALLENGE:2,REVENGE:3},n);function n(e){return void 0===e&&(e=null),t.call(this,n.N,e)||this}o.TribeBattleMed=e,__reflect(e.prototype,"game.TribeBattleMed")}(game=game||{}),function(e){var t=(i.registerAll=function(){},i);function i(){}e.TribeBattleProcessor=t,__reflect(t.prototype,"game.TribeBattleProcessor");var o,n=(o=e.ProcessorBase,__extends(a,o),a.prototype.execute=function(e){e.getBody()},a);function a(){return o.call(this,"tribeBattle.BattleRecordEntityInfoP",a)||this}e.BattleRecordEntityInfoP=n,__reflect(n.prototype,"game.BattleRecordEntityInfoP")}(game=game||{}),function(c){var t,e=(__extends(i,t=BaseProxy),i.prototype.updateInfo=function(e,t){var i=this.battleInfo.playerInfo.holdGoods+this.battleInfo.playerInfo.fixedGoods;e&&this.battleInfo.updatePlayer(e),t&&this.battleInfo.updateGuildList(t);var o=this.battleInfo.playerInfo.holdGoods+this.battleInfo.playerInfo.fixedGoods;c.AppFacade.getInstance().sendNotification(CN.TRIBE_BATTLE_INFO_UPDATED,{fGoods:i,cGoods:o})},i.prototype.updateBattleRecord=function(e){var t=this;this.battleRecords.splice(0),e.forEach(function(e){t.battleRecords.push(new c.TBBattleRecordVO(e))}),c.AppFacade.getInstance().sendNotification(CN.TRIBE_BATTLE_REVENGE_UPDATED)},i.prototype.GetTribeBattleInfo=function(t){var i=this;Utils.Socket.send("tribeBattle","GetTribeBattleInfo",{}).then(function(e){i.updateInfo(e.info.playerEntityInfo,e.info.guildEntityList),t&&t()})},i.prototype.GetTribeBattleDetailInfo=function(t){var i=this;Utils.Socket.send("tribeBattle","GetTribeBattleDetailInfo",{guildId:t.guildId}).then(function(e){i.updateInfo(void 0,e.guildEntityInfo),t.cb&&t.cb(e)})},i.prototype.GetRevengeList=function(t){var i=this;Utils.Socket.send("tribeBattle","GetRevengeList",{}).then(function(e){i.updateBattleRecord(e.battleRecords),t&&t(i.battleRecords)})},i.prototype.RefreshGuildEntityList=function(t){var i=this;Utils.Socket.send("tribeBattle","RefreshGuildEntityList",{}).then(function(e){i.updateInfo(e.playerEntityInfo,e.guildEntityList),t&&t(e)})},i.prototype.PurchaseChallengeTime=function(t){var i=this;Utils.Socket.send("tribeBattle","PurchaseChallengeTime",{num:t.num}).then(function(e){i.updateInfo(e.playerEntityInfo),t.cb&&t.cb(e)})},i.prototype.PurchaseRevengeTime=function(t){var i=this;Utils.Socket.send("tribeBattle","PurchaseRevengeTime",{num:t.num}).then(function(e){i.updateInfo(e.playerEntityInfo),t.cb&&t.cb(e)})},i.prototype.GetAchieveRewards=function(t){var i=this;Utils.Socket.send("tribeBattle","GetAchieveRewards",{rewardsType:t.type,tar:t.oneKey,rewardsId:t.code}).then(function(e){c.GameMVC.backpackPy.handleClientReward(e.clientReward),i.updateInfo(e.playerEntityInfo),t.cb&&t.cb(e)})},i.prototype.Challenge=function(i){var o=this;c.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeTribeBattle,pb1:"tribeBattle",pb2:"Challenge",params:{guildId:i.guildId,tPlayerId:i.playerId},doneCB:function(e){if(e.cbRet){var t=e.cbRet;o.updateInfo(t.playerEntityInfo,t.guildEntityInfo),i.cb&&i.cb(t)}c.GameMVC.fightPy.queueExceExitCB()}})},i.prototype.Revenge=function(i){var o=this;c.AppFacade.getInstance().sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeTribeBattle,pb1:"tribeBattle",pb2:"Revenge",params:{tPlayerId:i.playerId},doneCB:function(e){if(e.cbRet){var t=e.cbRet;o.updateInfo(t.playerEntityInfo),i.cb&&i.cb(t)}c.GameMVC.fightPy.queueExceExitCB()}})},i.prototype.addNotice=function(){NoticeManager.setChildType(NT.GUILD_TRIBE_BATTLE,[NT.GUILD_TRIBE_BATTLE_CHALLENGE,NT.GUILD_TRIBE_BATTLE_REWARD]),NoticeManager.registerCB(NT.GUILD_TRIBE_BATTLE_CHALLENGE,this.checkChallengeTimeNotice,this,MODULE.TribeBattle),NoticeManager.registerCB(NT.GUILD_TRIBE_BATTLE_REWARD,this.checkRewardAvailable,this,MODULE.TribeBattle)},i.prototype.checkChallengeTimeNotice=function(){return 0<this.battleInfo.playerInfo.challengeTimes},i.prototype.checkRewardAvailable=function(){function e(e){var t=a[e];if(t.rewardsType===TribeBattleAchieveType.SelfAchieve&&i>=t.goods&&n.private.every(function(e){return e.rewardId!=t.code})||t.rewardsType===TribeBattleAchieveType.GuildAchieve&&o>=t.goods&&n.guild.every(function(e){return e.rewardId!=t.code}))return{value:!0}}var t=this.battleInfo.playerInfo,i=t.playerMaxGoods,o=t.guildMaxGoods,n=t.targeted,a=c.Config.tribeBattleRewards();for(var r in a){var s=e(r);if("object"==typeof s)return s.value}return!1},i.N="TribeBattlePy",i);function i(){var e=t.call(this,i.N)||this;return e.battleInfo=new c.TBInfoVO,e.battleRecords=[],e.addNotice(),e}c.TribeBattlePy=e,__reflect(e.prototype,"game.TribeBattlePy")}(game=game||{}),function(a){var t,e=(__extends(i,t=BasePanel),i.prototype.initList=function(){this.ac_list=new eui.ArrayCollection,this.list_items.dataProvider=this.ac_list,this.list_items.itemRenderer=n},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.initList()},i.prototype.updateView=function(e){var t=this;this.guildId=e&&e.guildId||this.guildId;var i=void 0;a.GameMVC.tribeBattlePy.battleInfo.guildList.forEach(function(e){e.baseInfo.id===t.guildId&&(i=e)}),this.lb_name.text="S"+i.baseInfo.serverId+"·"+i.baseInfo.name;var o=[];i.playerList.forEach(function(e){o.push({guildInfo:i,playerInfo:e})}),o.sort(function(e,t){return t.playerInfo.lootGoods-e.playerInfo.lootGoods}),this.ac_list.replaceAll(o)},i);function i(){var e=t.call(this)||this;return e.skinName="TribeBattleChallengeSkin",e}a.TribeBattleChallengePanel=e,__reflect(e.prototype,"game.TribeBattleChallengePanel");var o,n=(o=eui.ItemRenderer,__extends(r,o),r.prototype.childrenCreated=function(){var n=this;o.prototype.childrenCreated.call(this),this.tribeBattleColorNumPersion=Number(a.Config.constConfig().TribeBattleColorNumPersion.constValue),this.avatar=customui.PlayerHeadFactory.create(),Utils.TouchUtils.addTouchListener(this.avatar,function(){a.AppFacade.getInstance().showSubView(a.FriendMediator.N,a.FriendMediator.SV.INFO,{playerId:n.data.playerInfo.baseInfo.playerId})},this),this.gp_avatar.addChild(this.avatar),this.btn_challenge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(0<a.GameMVC.tribeBattlePy.battleInfo.playerInfo.challengeTimes){var e=n.data.guildInfo,t=n.data.playerInfo,i=Utils.TimerManager.getServerTime()-t.lastBeLootedDt,o=Number(a.Config.constConfig().TribeBattleForbidLootCycle.constValue)+5;i<o?Utils.MsgUtils.addMidMsg("该玩家刚被掠夺过，请等待"+(o-i)+"秒"):a.GameMVC.tribeBattlePy.Challenge({guildId:e.baseInfo.id,playerId:t.baseInfo.playerId,cb:function(){a.AppFacade.getInstance().updateView(a.TribeBattleMed.N,a.TribeBattleMed.SV.CHALLENGE)}})}else Utils.MsgUtils.addMidMsg("挑战次数不足")},this)},r.prototype.dataChanged=function(){var e=this.data.playerInfo;this.avatar.updateData({vo:e.baseInfo}),this.lb_name.text=e.baseInfo.name,this.lb_curRes.text=""+(e.holdGoods+e.fixedGoods),e.lootGoods>=this.tribeBattleColorNumPersion?(this.lb_lootRes.font="RedBlackStrocke_fnt",this.lb_lootRes.scaleX=this.lb_lootRes.scaleY=.8):(this.lb_lootRes.font="white_num_fnt",this.lb_lootRes.scaleX=this.lb_lootRes.scaleY=.9),this.lb_lootRes.text=""+e.lootGoods,this.fightCapItem.update(e.baseInfo.fightCap)},r);function r(){var e=o.call(this)||this;return e.skinName="TribeBattleChallengePanel_MemberItem",e}__reflect(n.prototype,"TribeBattleChallengePanel_MemberItem")}(game=game||{}),function(r){var t,e=(__extends(i,t=BaseFull),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.tribeBattleColorNumPersion=Number(r.Config.constConfig().TribeBattleColorNumPersion.constValue),this.activateComponent(),this.activateUpdater(),this.activateCountdown(),this.addNotice(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.img_title),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_goodsInfo),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_btns)},i.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.GUILD_TRIBE_BATTLE_REWARD,this.btn_achievement.getChildAt(0),this,BTN_ICON_NOTICE_POS)},i.prototype.onDestroy=function(){for(var e in t.prototype.onDestroy.call(this),this.timerDict)this.removeTimer(e);this.updaterTimer&&egret.clearInterval(this.updaterTimer)},i.prototype.updateView=function(e){var n=this,t=this.proxy.battleInfo,i=t.playerInfo;r.GameMVC.rankPy.GetRankList(RankingType.RankingTypeTribeBattlePlayer,function(e){var t=e.selfRank&&e.selfRank.rank||0;n.lb_selfGoods.textFlow=[{text:""+(i.holdGoods+i.fixedGoods)},{text:"("+(t?"第"+t+"名":"未上榜")+")",style:{textColor:2943688}}]}),r.GameMVC.rankPy.GetRankList(RankingType.RankingTypeTribeBattleGuild,function(e){var t=e.selfRank&&e.selfRank.rank||0;n.lb_guildGoods.textFlow=[{text:""+i.guildGoods},{text:"("+(t?"第"+t+"名":"未上榜")+")",style:{textColor:16766777}}]}),t.guildList.forEach(function(e,t){var i=n["lb_target_name"+t],o=n["lb_target_goods"+t];i.textFlow=[{text:"S"+e.baseInfo.serverId+"·",style:{textColor:10682351}},{text:e.baseInfo.name}],e.maxPlayerlootGoods>=n.tribeBattleColorNumPersion?(o.font="RedBlackStrocke_fnt",o.scaleX=o.scaleY=.9):(o.font="white_num_fnt",o.scaleX=o.scaleY=1),o.text=""+e.totalGoods}),Number(r.Config.constConfig().TribeBattleInitRevengeTime.constValue);var o=i.challengeTimes;if(this.blb_challengeTimes.text=o.toString(),i.lastChallengeRefreshDt){this.blb_recTime.visible=!0;var a=i.lastChallengeRefreshDt+Number(r.Config.constConfig().TribeBattleChallengeTimeRefreshCycle.constValue)-Utils.TimerManager.getServerTime();this.addTimer("challengeTimeRec",a,1e3,function(e){0<e?n.blb_recTime.text=Utils.TimerManager.getFormatBySecond1(e)+"后回复一次":(n.removeTimer("challengeTimeRec"),i.hasChallengedTime-=1,i.lastChallengeRefreshDt+=60,n.updateView())})}else this.blb_recTime.visible=!1,this.removeTimer("challengeTimeRec");this.handleGoodsDiff(e)},i.prototype.addTimer=function(e,t,i,o){var n=this;this.removeTimer(e),this.timerDict[e]={timer:void 0,dt:t,cb:o};var a=egret.setInterval(function(){n.timerDict[e].dt--,n.timerDict[e].cb(n.timerDict[e].dt)},this,i);this.timerDict[e].timer=a,o(t)},i.prototype.removeTimer=function(e){this.timerDict[e]&&(this.timerDict[e].timer&&egret.clearInterval(this.timerDict[e].timer),delete this.timerDict[e])},i.prototype.handleGoodsDiff=function(e){if(e&&e.fGoods&&e.cGoods){var t=e.cGoods-e.fGoods;if(0!=t){var i=new eui.Group,o=new eui.HorizontalLayout;o.verticalAlign=egret.VerticalAlign.MIDDLE,i.layout=o;var n=new eui.Image("item_icon_wuzi_png");n.scaleX=n.scaleY=.8,i.addChild(n);var a=new eui.BitmapLabel((0<t?"+":"-")+Math.abs(t));a.font="yellow_attr_fnt",i.addChild(a),i.horizontalCenter=0,i.verticalCenter=100,i.alpha=0,this.gp_root.addChild(i),egret.Tween.get(i).to({verticalCenter:0,alpha:1},300,egret.Ease.backOut).wait(1e3).to({verticalCenter:-100,alpha:0},300,egret.Ease.backIn).call(function(){i&&i.parent&&i.parent.removeChild(i)})}}},i.prototype.activateCountdown=function(){var t=this,e=Utils.UnlockMgr.getOpenInfo(MODULE.TribeBattle);this.addTimer("endTime",e.endTimeDt-Utils.TimerManager.getServerTime(!1),1e3,function(e){0<e?t.blb_time.text="距离结束:"+Utils.TimerManager.getFormatBySecond1(e):(t.removeTimer("endTime"),r.MainJumpConfig.jumpTo(),Utils.MsgUtils.addMidMsg("部落争霸已结束"))})},i.prototype.activateUpdater=function(){var e=this;this.updaterTimer=egret.setInterval(function(){e.proxy.GetTribeBattleInfo()},this,1e4)},i.prototype.activateComponent=function(){var o=this;function e(t){i["gp_target"+t].addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=o.proxy.battleInfo.guildList[t];o.proxy.GetTribeBattleDetailInfo({guildId:e.baseInfo.id,cb:function(){r.AppFacade.getInstance().showSubView(r.TribeBattleMed.N,r.TribeBattleMed.SV.CHALLENGE,{guildId:e.baseInfo.id})}})},i)}this.btn_guide.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopUpManager.addPopUp({obj:new r.HelpDialog({moduleId:MODULE.TribeBattle})})},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"TRIBE_BATTLE_RANK"})},this),this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"TRIBE_BATTLE_REWARD"})},this),this.btn_achievement.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.AppFacade.getInstance().showSubView(r.RankMediator.N,r.RankMediator.SV.COMMON,{module:"TRIBE_BATTLE_ACHIEVE"})},this),this.btn_revenge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.proxy.GetRevengeList(function(){r.AppFacade.getInstance().showSubView(r.TribeBattleMed.N,r.TribeBattleMed.SV.REVENGE)})},this),this.btn_change.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.proxy.RefreshGuildEntityList(function(){Utils.MsgUtils.addMidMsg("刷新成功"),o.btn_change.enabled=!1,o.blb_changeCd.visible=!0,UIActionManager.setAbsGrey(o.btn_change,!0),o.addTimer("change",5,1e3,function(e){0<e?o.blb_changeCd.text=""+e:(o.removeTimer("change"),o.btn_change.enabled=!0,o.blb_changeCd.visible=!1,UIActionManager.setAbsGrey(o.btn_change,!1))})})},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=o.proxy.battleInfo.playerInfo,t=r.Config.VIPConfig();if(t.tribeBattleChallengePurchaseTime<=e.hasPurchasedTime)r.GameMgr.getInstance().showCommonTipsWin({commonTips:"主人，听闻提升VIP等级可获得更多购买次数哦！",clickCB:function(e){e.type&&r.MainJumpConfig.jumpTo(MODULE.Recharge)}});else{var i=o.proxy.battleInfo.playerInfo.challengeTimes;r.AppFacade.getInstance().showSubView(r.CommonMediator.N,r.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.TribeBattleChallenge,hasBuyNum:e.hasPurchasedTime,buyCB:function(e){o.proxy.PurchaseChallengeTime({num:e})},curNum:i,maxBuyNum:t.tribeBattleChallengePurchaseTime})}},this),this.btn_return.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){r.MainJumpConfig.jumpTo()},this);for(var i=this,t=0;t<4;t++)e(t)},i);function i(){var e=t.call(this)||this;return e.proxy=r.GameMVC.tribeBattlePy,e.timerDict={},e.skinName="TribeBattleMainSkin",e}r.TribeBattleMainView=e,__reflect(e.prototype,"game.TribeBattleMainView")}(game=game||{}),function(a){var t,e=(__extends(i,t=BasePanel),i.prototype.initList=function(){this.ac_item=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_item,this.list_item.itemRenderer=n},i.prototype.childrenCreated=function(){var n=this;t.prototype.childrenCreated.call(this),this.rootPanel.blb_title.text="记录",this.rootPanel.onCloseCB=function(){n.hide(0)},this.initList(),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var t=a.GameMVC.tribeBattlePy,e=t.battleInfo.playerInfo,i=a.Config.VIPConfig();if(i.tribeBattleRevengePurchaseTime<=e.hasPurchasedRevengeTime)a.GameMgr.getInstance().showCommonTipsWin({commonTips:"主人，听闻提升VIP等级可获得更多购买次数哦！",clickCB:function(e){e.type&&a.MainJumpConfig.jumpTo(MODULE.Recharge)}});else{var o=Number(a.Config.constConfig().TribeBattleInitRevengeTime.constValue)+t.battleInfo.playerInfo.hasPurchasedRevengeTime-t.battleInfo.playerInfo.hasRevengedTime;a.AppFacade.getInstance().showSubView(a.CommonMediator.N,a.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.TribeBattleRevenge,hasBuyNum:e.hasPurchasedRevengeTime,buyCB:function(e){t.PurchaseRevengeTime({num:e,cb:function(){n.updateView()}})},curNum:o,maxBuyNum:i.tribeBattleRevengePurchaseTime})}},this)},i.prototype.updateView=function(e){var t=a.GameMVC.tribeBattlePy.battleRecords,i=[];t.forEach(function(e){i.push({info:e})}),this.ac_item.replaceAll(i),this.gp_empty.visible=!i.length,this.blb_challengeTimes.text=""+this.proxy.battleInfo.playerInfo.revengeTimes},i);function i(){var e=t.call(this)||this;return e.proxy=a.GameMVC.tribeBattlePy,e.skinName="TribeBattleRevengeSkin",e}a.TribeBattleRevengePanel=e,__reflect(e.prototype,"game.TribeBattleRevengePanel");var o,n=(o=eui.ItemRenderer,__extends(r,o),r.prototype.childrenCreated=function(){var e=this;o.prototype.childrenCreated.call(this),this.avatar=customui.PlayerHeadFactory.create(),this.gp_avatar.addChild(this.avatar),this.btn_challenge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a.GameMVC.tribeBattlePy.Revenge({playerId:e.data.info.playerInfo.baseInfo.playerId,cb:function(){a.GameMVC.tribeBattlePy.GetRevengeList()}})},this)},r.prototype.dataChanged=function(){var e=this.data.info,t=e.playerInfo.baseInfo;this.avatar.updateData({vo:t}),this.lb_name.text=t.name,this.lb_lootedRes.text=e.beLootedGoods.toString(),this.lb_revengeRes.text=""+e.playerInfo.lootGoods,this.fightCapItem.update(t.fightCap)},r);function r(){var e=o.call(this)||this;return e.skinName="TribeBattleRevengePanel_Item",e}__reflect(n.prototype,"TribeBattleRevengePanel_Item")}(game=game||{}),function(e){var t,i=(t=eui.Component,__extends(o,t),Object.defineProperty(o.prototype,"maximum",{get:function(){return this._maximum},set:function(e){this._maximum=e,this._value>this._maximum&&(this._value=this._maximum),this.updateProgress()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e>this._maximum?this._maximum:e,this.updateProgress(),this.firstMdfValue=!1},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"startingAngle",{get:function(){return this._startingAngle},set:function(e){this._startingAngle=e,this.updateProgress()},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"antiClockwise",{get:function(){return this._antiClockwise},set:function(e){this._antiClockwise=e,this.updateProgress()},enumerable:!0,configurable:!0}),o.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.thumb&&(this.updateAvailable=!0),this.updateProgress()},o.prototype.updateProgress=function(){if(this.updateAvailable){if(this.thumb.validateNow(),!this.thumb.mask){var e=new egret.Shape;this.thumb.mask=e,this.thumb.parent.addChild(e)}var t=this.thumb.mask,i=Utils.ComponentUtils.getPosInView(this.thumb,{x:this.thumb.width/2,y:this.thumb.height/2},this.thumb.parent),o=i.x,n=i.y,a=1.42*Math.max(this.thumb.width,this.thumb.height)/2,r=Math.PI/180*this._startingAngle+this.angleOffset,s=this._startingAngle*Math.PI/180+this._value/this._maximum*2*Math.PI*(this._antiClockwise?-1:1)+this.angleOffset;t.graphics.clear(),t.graphics.beginFill(0),t.graphics.moveTo(o,n),t.graphics.lineTo(o+a*Math.cos(r),n+a*Math.sin(r)),t.graphics.drawArc(o,n,a,r,s,this._antiClockwise),t.graphics.lineTo(o,n),t.graphics.endFill(),this.labelDisplay&&(this.firstMdfValue||!this.needStep?(this._curValue=this._value,this.labelDisplay.text=this.labelFunction(this._value,this._maximum)):this.addProgressEffect())}},o.prototype.addProgressEffect=function(){var e=this;if(this._curValue!=this._value){var t=this._curValue>this._value;this._curValue=t?this._curValue-this.step:this._curValue+this.step,t!=this._curValue>this._value&&(this._curValue=this._value),this.labelDisplay.text=this.labelFunction(this._curValue,this._maximum),this.labelDisplay.scaleX=this.labelDisplay.scaleY=.7,egret.Tween.get(this.labelDisplay).to({scaleX:1,scaleY:1},100).call(function(){e.addProgressEffect()})}},o);function o(){var e=null!==t&&t.apply(this,arguments)||this;return e._maximum=100,e._value=0,e.labelFunction=function(e,t){return e+"/"+t},e._curValue=0,e.step=1,e.needStep=!1,e._startingAngle=0,e._antiClockwise=!0,e.updateAvailable=!1,e.angleOffset=-Math.PI/2,e.firstMdfValue=!0,e}e.RoundProgressBar=i,__reflect(i.prototype,"customui.RoundProgressBar")}(customui=customui||{}),function(n){var e=(t.registerAll=function(){(new o).register(),(new s).register(),(new h).register(),(new u).register()},t);function t(){}n.WorldBossProcessor=e,__reflect(e.prototype,"game.WorldBossProcessor");var i,o=(i=n.ProcessorBase,__extends(a,i),a.prototype.execute=function(e){var t=e.getBody();console.log("PushBossInfoP",t);var i=n.AppFacade.getInstance().retrieveProxy(n.WorldBossPy.N);i.bossInfo&&i.bossInfo.update(t.bossInfo),n.AppFacade.getInstance().retrieveMediator(n.WorldBossMediator.N).updateView(n.WorldBossMediator.SV.MAIN)},a);function a(){return i.call(this,"serverBoss.PushBossInfoP",a)||this}__reflect(o.prototype,"PushBossInfoP");var r,s=(r=n.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody();console.log("PushFinishBattleInfoP",t);var i=n.AppFacade.getInstance().retrieveProxy(n.WorldBossPy.N);i.bossInfo&&i.bossInfo.update(t.bossInfo),i.playerInfo&&i.playerInfo.update(t.playerBossInfo);var o=n.AppFacade.getInstance().retrieveProxy(n.FightPy.N);o.addDelayCBAfterFightExit(function(){var e=n.AppFacade.getInstance().retrieveMediator(n.WorldBossMediator.N);e.updateView(n.WorldBossMediator.SV.MAIN,{type:n.WorldBossMainView.UPDATE_TYPE.BOSS_INFO}),e.updateView(n.WorldBossMediator.SV.MAIN,{type:n.WorldBossMainView.UPDATE_TYPE.CHALLENGE_INFO}),o.queueExceExitCB()},"WORLD_BOSS")},c);function c(){return r.call(this,"serverBoss.PushFinishBattleInfoP",c)||this}__reflect(s.prototype,"PushFinishBattleInfoP");var l,h=(l=n.ProcessorBase,__extends(p,l),p.prototype.execute=function(e){var t=e.getBody();n.AppFacade.getInstance().retrieveProxy(n.WorldBossPy.N).updatePlayerInfo(t.info)},p);function p(){return l.call(this,"serverBoss.PushPlayerBossInfoP",p)||this}__reflect(h.prototype,"PushPlayerBossInfoP");var d,u=(d=n.ProcessorBase,__extends(g,d),g.prototype.execute=function(e){egret.setTimeout(function(){NoticeManager.updateNotice(NT.WORLD_BOSS)},this,5e3)},g);function g(){return d.call(this,"serverBoss.OnCloseP",g)||this}__reflect(u.prototype,"OnCloseP")}(game=game||{}),function(c){var i,t=(i=c.BaseVO,__extends(e,i),e.prototype.update=function(e){this.hurt=e.hurt,this.hurtReward=e.hurtReward,this.careerReward=e.careerReward,this.hasBuyTimes=e.hasBuyTimes,this.initPLevel=e.initPLevel,this.honor=e.honor,this.challengeCD=e.challengeCD,this.timesReward=e.timesReward,this.challengeTimes=e.challengeTimes,this.cTimes=e.cTimes,this.reTimesDt=e.reTimesDt,NoticeManager.updateNotice(NT.WORLD_BOSS_REWARD,void 0,!0),NoticeManager.updateNotice(NT.WORLD_BOSS_NUM,void 0,!0)},e);function e(e){var t=i.call(this)||this;return e&&t.update(e),t}__reflect(t.prototype,"PlayerBossInfoVO");var o,n=(o=c.BaseVO,__extends(a,o),a.prototype.update=function(e){null!=this.lives&&(this.isDeadAndReBoth=e.lives>this.lives),this.configId=e.configId,this.bossId=e.bossId,this.bornDt=e.bornDt,this.lives=e.lives,this.refreshDt=e.refreshDt,this.careerRecord=e.careerRecord,this.openDt=e.openDt,this.luckyName=e.luckyName},a);function a(e){var t=o.call(this)||this;return e&&t.update(e),t}__reflect(n.prototype,"BossInfoVO");var r,s=(__extends(l,r=BaseProxy),l.prototype.updateBossInfo=function(e){this.bossInfo||(this.bossInfo=new n),this.bossInfo.update(e)},l.prototype.updatePlayerInfo=function(e){this.playerInfo||(this.playerInfo=new t),this.playerInfo.update(e),c.GameMVC.worldBossMed.updateView(c.WorldBossMediator.SV.MAIN,{type:c.WorldBossMainView.UPDATE_TYPE.CHALLENGE_INFO})},l.prototype.GetServerBossInfo=function(){var t=this;Utils.Socket.send("serverBoss","GetServerBossInfo",{}).then(function(e){t.updatePlayerInfo(e.playerBossInfo),t.updateBossInfo(e.bossInfo),c.AppFacade.getInstance().updateView(c.WorldBossMediator.N,c.WorldBossMediator.SV.MAIN)})},l.prototype.BuyChanllengeTimes=function(t,i,o){var n=this;Utils.Socket.send("serverBoss","BuyChanllengeTimes",{times:t}).then(function(e){Utils.MsgUtils.addMidMsg("成功购买"+t+"次"),n.playerInfo.update(e.playerBossInfo),c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).handleClientCost(e.clientCost),c.AppFacade.getInstance().retrieveMediator(c.WorldBossMediator.N).updateView(c.WorldBossMediator.SV.MAIN,{type:c.WorldBossMainView.UPDATE_TYPE.CHALLENGE_INFO}),i&&(o?i.call(o):i())})},l.prototype.GetPlayerTimesReward=function(e,i){Utils.Socket.send("serverBoss","PlayerTimesReward",{id:e}).then(function(e){var t=c.AppFacade.getInstance().retrieveProxy(l.N);t.playerInfo.update(e.playerBossInfo),t.bossInfo.update(e.bossInfo),c.AppFacade.getInstance().retrieveProxy(c.BackpackPy.N).handleClientReward(e.clientReward,2),i&&i()})},l.prototype.Challenge=function(e){this.bossInfo.lives,this.bossInfo.configId,e.name,e.level,this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeServerBoss,pb1:"serverBoss",pb2:"Challenge",params:{},doneCB:function(e){c.AppFacade.getInstance().retrieveProxy(c.FightPy.N).queueExceExitCB()}})},l.prototype.checkNotice=function(){var e=this.playerInfo;if(!e)return!1;if(!this.getOpenInfo().isOpen)return!1;var t=JSON.parse(e.timesReward),i=e.challengeTimes,o=c.Config.serverBossReward(2);for(var n in o){var a=o[n].id,r=0<=t.indexOf(a),s=o[n].rankUpper;if(!r&&s<=i)return!0}return!1},l.prototype.getOpenInfo=function(){return Utils.UnlockMgr.getOpenInfo(MODULE.ServerBoss)},l.prototype.getTemInfo=function(t){var i=this;Utils.Socket.send("serverBoss","GetPlayerServerBossInfo",{}).then(function(e){i.temInfo=e,t&&t()})},l.N="WorldBossPy",l);function l(){var e=r.call(this,l.N)||this;return NoticeManager.setChildType(NT.WORLD_BOSS,[NT.WORLD_BOSS_REWARD,NT.WORLD_BOSS_NUM]),NoticeManager.registerCB(NT.WORLD_BOSS_REWARD,e.checkNotice,e),NoticeManager.registerCB(NT.WORLD_BOSS_NUM,function(){return!!e.getOpenInfo().isOpen&&!!(e.playerInfo&&0<e.playerInfo.cTimes)},e),e}c.WorldBossPy=s,__reflect(s.prototype,"game.WorldBossPy")}(game=game||{}),function(c){var t,e=(__extends(a,t=BaseFull),a.prototype.childrenCreated=function(){var i=this;t.prototype.childrenCreated.call(this),NoticeManager.addNoticeListener(NT.WORLD_BOSS_REWARD,this.btn_achieve.$children[0],this,BTN_ICON_NOTICE_POS),this._activateComponent(),Utils.DeviceUtils.setLiuHaiPingAdapter(this.gp_top),this.map=Utils.MapUtils.generateCommon({source:MODULE.ServerBoss,multiLayerScroller:this.cu_mls,loadingParent:this.getParentView(),miniMapParent:Utils.SDKMgr.getPerformConfig(6)?void 0:this.gp_mini_map,onTouchTap:function(e,t){i.mainPy.SyncCoordinateInfo(e,t,"1",MODULE.ServerBoss)}}),this.updateRankTimer||(this.updateRankTimer=egret.setInterval(this.updateRank,this,5e3)),this.gp_map.addChildAt(this.map,0)},a.prototype.updateView=function(e,t){var i=this,o=this.proxy.getOpenInfo();if(!o.isOpen)return this.gp_reward.visible=this.gp_challenge.visible=this.btn_challenge.visible=!1,this.blb_dt_tips1.text="每日",o.openTime[1]<10?this.blb_dt_tips2.text=o.openTime[0]+":0"+o.openTime[1]:this.blb_dt_tips2.text=o.openTime[0]+":"+o.openTime[1],this.blb_dt_tips3.text="开启世界Boss",void this.jumpToChatper(1);this.gp_endDt.visible=!0,this.endingTimer||(this.endingTimer=egret.setInterval(function(){var e=o.endTimeDt-Utils.TimerManager.getServerTime(!1),t=Utils.TimerManager.getFormatBySecond1(e);0<e?i.blb_dt_end.text=""+t:(egret.clearInterval(i.endingTimer),i.gp_endDt.visible=!1)},this,1e3));var n=this.mainPy.getMyCoordinateInfo(MODULE.ServerBoss);if(!t&&n)if(this.gp_reward.visible=this.gp_challenge.visible=this.btn_challenge.visible=!0,this.proxy.bossInfo&&this.proxy.playerInfo){switch(e&&e.type||c.GuildBossMainView.UPDATE_TYPE.INIT){case a.UPDATE_TYPE.INIT:this.updateBossInfo(),this.updateChallengeInfo();break;case a.UPDATE_TYPE.BOSS_INFO:this.updateBossInfo();break;case a.UPDATE_TYPE.CHALLENGE_INFO:this.updateChallengeInfo()}this.lb_luckyName.text=this.proxy.bossInfo.luckyName||"暂无获得者"}else this.proxy.GetServerBossInfo();else this.mainPy.GetCoordinateInfo(MODULE.ServerBoss,function(){i.updateView(e)})},a.prototype.updateAct=function(){},a.prototype.jumpToChatper=function(e){if(this.curBossConfigId!=e||1==e||1==this.curBossConfigId){this.curBossConfigId=e;var t=this.mainPy.getMyCoordinateInfo(MODULE.ServerBoss),i=this.mainPy.getOtherCoordinateInfo(MODULE.ServerBoss),o=c.Config.serverBoss()[e],n=JSON.parse(o.initLocation);this.map.tiled!=o.tiled&&this.map.update({isInit:!0,tiled:o.tiled,theme:o.theme,w:o.w,h:o.h,meStartTileX:n[0],meStartTileY:n[1]}),this.proxy.getOpenInfo().isOpen?(this.map.hasEventListener(egret.TouchEvent.TOUCH_TAP)&&this.map.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchEventFunc,this),this.map.touchChildren=!0,this.map.touchEnabled=!1,this.map.updateNPC({curPosVO:{x:t.coordinate&&t.coordinate.x||n[0],y:t.coordinate&&t.coordinate.y||n[1],isFixed:!0},otherCoordInfos:i})):(this.map.touchChildren=!1,this.map.touchEnabled=!0,this.map.hasEventListener(egret.TouchEvent.TOUCH_TAP)||this.map.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchEventFunc,this),this.map.updateNPC({curPosVO:{x:n[0],y:n[1],isFixed:!0}}))}},a.prototype.touchEventFunc=function(){Utils.MsgUtils.addMidMsg("世界boss未开启")},a.prototype.updateBossInfo=function(e){var t=this;if(void 0===e&&(e=!1),!this.isBossDeading&&this.proxy.bossInfo){var i=this.proxy.bossInfo;if(i&&i.isDeadAndReBoth){if(c.AppFacade.getInstance().retrieveProxy(c.FightPy.N).isInFight)return;return i.isDeadAndReBoth=void 0,this.isBossDeading=!0,this.switchScreenLayer(!0),void this.bossDeadAction(function(){DragonBoneTools.playOnce({effectName:"common_shijiebossdjs",parent:t,doneCB:function(){t.switchScreenLayer(!1),t.isBossDeading=!1,t.updateBossInfo(!0)}})})}var o=!1;if(0==i.configId?(this.log("boss消失了"),i.configId=1,o=!0):(this.bossConfig=c.Config.serverBoss()[i.configId],this.bossCreepInfo=c.Config.creepConfig(i.bossId)),this.jumpToChatper(i.configId),this.map.cleanAllEP(),!o){var n=c.Config.serverBoss()[i.configId],a=JSON.parse(n.bossLocation),r=[];r.push(new c.EventVO({fadeType:FadeRiskEventType.BigBoss,position:{x:a[0],y:a[1]},config:{heroC:this.bossCreepInfo,hp:i.lives,initHp:this.bossConfig.lives,module:MODULE.ServerBoss},isDirty:!0,customTrigger:function(e){e&&t.reqFightBoss()},hudongAction:{appear:e}})),this.map.updateLayerEvent({events:r}),this.map.showMePathToPos({tileX:a[0],tileY:a[1]})}}},a.prototype.updateChallengeInfo=function(){var e=this.proxy.playerInfo;this.blb_count.text=this.proxy.playerInfo.cTimes.toString(),0<e.reTimesDt?(this.recoverCD=e.reTimesDt-Utils.TimerManager.getServerTime(),0<this.recoverCD&&(this.recoverCdTimer||(this.recoverCdTimer=egret.setInterval(this.updateRecoverCd,this,1e3)),this.gp_recoverDt.visible=!0)):this.recoverCD=0,this.updateRecoverCd()},a.prototype.updateRecoverCd=function(){0<this.recoverCD?(this.blb_dt_tips2.text=""+Utils.TimerManager.getFormatBySecond1(this.recoverCD),this.recoverCD--):(this.gp_recoverDt.visible=!1,egret.clearInterval(this.recoverCdTimer),this.recoverCdTimer=void 0)},a.prototype.switchScreenLayer=function(e){this.darkSprite||(this.darkSprite=new egret.Sprite,this.darkSprite.touchEnabled=!0,this.gp_main.addChildAt(this.darkSprite,this.gp_main.getChildIndex(this.btn_back)),this.darkSprite.graphics.clear(),this.darkSprite.graphics.beginFill(0,.6),this.darkSprite.graphics.drawRect(0,0,Utils.DeviceUtils.curWidth()/Utils.DeviceUtils.additionScale(),Utils.DeviceUtils.curHeight()/Utils.DeviceUtils.additionScale()),this.darkSprite.graphics.endFill()),this.darkSprite.visible=e},a.prototype.updateCoordInfo=function(){var e=this.mainPy.getMyCoordinateInfo(MODULE.ServerBoss),t=this.mainPy.getOtherCoordinateInfo(MODULE.ServerBoss);e&&this.map.isInited&&(this.map.updateNPC({curPosVO:{x:e.coordinate&&e.coordinate.x,y:e.coordinate&&e.coordinate.y,isFixed:!0},otherCoordInfos:t}),this.map.resetCamera()),e.coordinate.iAmClean()},a.prototype.bossDeadAction=function(e){if(this.map.isInited){var t=JSON.parse(this.bossConfig.bossLocation),i=this.map.tile2EP(t[0],t[1]);i&&i.hudongWithEP?i.hudongWithEP({playDeadAction:!0,cb:e}):(egret.warn("该boss已经不存在，或者该位置上的ep已经不是big boss ep",i),e&&e())}else e&&e()},a.prototype._activateComponent=function(){var e=this;this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.GameMVC.loginPy.loginGameVO.singleSign?c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"WORLD_BOSS_RANK_SINGLE"}):c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"WORLD_BOSS_RANK"})},this),Utils.UnlockMgr.checkPass(MODULE.BattleFormation,!1).allow?this.btn_mutiTeam.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.GameMVC.heroMutiTeamPy.server_GetBattleFormationInfo(function(){c.GameMVC.heroMutiTeamMed.showSubView(c.HeroMutiTeamMediator.SV.MAIN,{type:2,moduleId:MODULE.ServerBoss})})},this):this.btn_mutiTeam.visible=!1,this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.GameMVC.rankPy.GetRankList(RankingType.RankingTypeWeekPlayerServerBossHurt,void 0),c.GameMVC.rankPy.GetRankList(RankingType.RankingTypePlayerServerBossHurt,function(){c.GameMVC.loginPy.loginGameVO.singleSign?c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"WORLD_BOSS_REWARD_SINGLE"}):c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"WORLD_BOSS_REWARD"})})},this),this.btn_achieve.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.proxy.getTemInfo(function(){c.GameMVC.loginPy.loginGameVO.singleSign?c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"WORLD_BOSS_ACHIEVE_SINGLE"}):c.AppFacade.getInstance().showSubView(c.RankMediator.N,c.RankMediator.SV.COMMON,{module:"WORLD_BOSS_ACHIEVE"})})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new c.HelpDialog({moduleId:MODULE.ServerBoss})})},this),this.btn_challenge.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.proxy.playerInfo.cTimes<=0?this.showBuyPanel():this.findBoss()},this),this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){c.MainJumpConfig.jumpTo()},this),this.btn_jisha.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.proxy.bossInfo,t=c.Config.serverBoss()[e.configId];c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(t.killReward),type:c.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},this),this.cb_autoFight.addEventListener(egret.Event.CHANGE,function(){e.autoChallenge=e.cb_autoFight.selected,e.autoChallenge&&!e.recoverCdTimer&&e.findBoss()},this),this.btn_add.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.showBuyPanel()},this)},a.prototype.perClose=function(){this.recoverCdTimer&&egret.clearInterval(this.recoverCdTimer),this.map.reset(),this.updateRankTimer&&egret.clearInterval(this.updateRankTimer),this.endingTimer&&egret.clearInterval(this.endingTimer)},a.prototype.findBoss=function(){if(!this.isBossDeading&&this.map&&this.bossConfig){var e=JSON.parse(this.bossConfig.bossLocation);this.map.handleTouchTap(e[0],e[1])}},a.prototype.showBuyPanel=function(){var t=this;c.AppFacade.getInstance().showSubView(c.CommonMediator.N,c.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.ServerBoss,hasBuyNum:this.proxy.playerInfo.hasBuyTimes,maxBuyNum:c.Config.VIPConfig().serverBossBuyTimes,buyCB:function(e){t.proxy.BuyChanllengeTimes(e)}})},a.prototype.reqFightBoss=function(){var e=this.proxy.getOpenInfo();if(e.isOpen)0==this.proxy.bossInfo.lives?Utils.MsgUtils.addMidMsg("BOSS已被击败"):this.proxy.playerInfo.cTimes<=0?this.showBuyPanel():this.bossCreepInfo&&this.bossConfig&&this.proxy.Challenge({name:this.bossCreepInfo.name,level:this.bossConfig.level,configId:this.curBossConfigId});else if(0==this.proxy.bossInfo.configId)Utils.MsgUtils.addMidMsg("当前没有BOSS");else{var t=e.openTime,i=e.endTime,o=9<t[0]?t[0].toString():"0"+t[0].toString(),n=9<t[1]?t[1].toString():"0"+t[1].toString(),a=9<i[0]?i[0].toString():"0"+i[0].toString(),r=9<i[1]?i[1].toString():"0"+i[1].toString();Utils.MsgUtils.addMidMsg(o+":"+n+" ~ "+a+":"+r+"开启挑战")}},a.prototype.updateRank=function(){var s=this;c.AppFacade.getInstance().retrieveProxy(c.RankPy.N).GetRankList({rankType:RankingType.RankingTypePlayerServerBossHurt,refreshInterval:0},function(e){var t=e.ranks;if(0==t.length)s.gp_rank.visible=!1,s.gp_rankBm.visible=!1,s.gp_empty.visible=!0;else{s.gp_rank.visible=!0,s.gp_rankBm.visible=!0,s.gp_empty.visible=!1;for(var i=0;i<4;i++){var o=t[i];if(!o)break;var n=s.gp_rank.$children[i],a={index:i,rank:o.rank,name:o.playerBaseInfo.name,hurt:o.key};n||(n=new l,s.gp_rank.addChild(n)),n.update(a)}}var r=e.selfRank;s.bm_selfHurt.text="我的伤害:"+Utils.MathUtils.formatNumStyle1(r.key),s.bm_selfRank.text="我的排名:"+Utils.MathUtils.formatNumStyle1(r.rank)})},a.UPDATE_TYPE={INIT:1,BOSS_INFO:2,CHALLENGE_INFO:3},a);function a(){var e=t.call(this)||this;return e.proxy=c.AppFacade.getInstance().retrieveProxy(c.WorldBossPy.N),e.autoChallenge=!0,e.mainPy=c.AppFacade.getInstance().retrieveProxy(c.MainPy.N),e.skinName="WorldBossMainSkin",e}c.WorldBossMainView=e,__reflect(e.prototype,"game.WorldBossMainView");var i,l=(i=eui.Component,__extends(o,i),o.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this)},o.prototype.update=function(e){this.data=e;var t=this.data.rank;t<=3?(this.img_icon.visible=!0,this.bm_rank.visible=!1,this.img_icon.source="jjc_icon_pm_"+t+"_png"):(this.img_icon.visible=!1,this.bm_rank.visible=!0,this.bm_rank.text=t.toString()),this.lb_name.text=this.data.name,this.lb_hurt.text=Utils.MathUtils.formatNumStyle1(this.data.hurt)},o);function o(e){var t=i.call(this)||this;return t.skinName="WorldBossRankItem",e&&t.update(e),t}c.WorldBossMainView_RankItem=l,__reflect(l.prototype,"game.WorldBossMainView_RankItem")}(game=game||{});var customui,GameRootLayer=function(t){function r(){var e=t.call(this)||this;return e.tabLayer=new eui.UILayer,e.mainLayer=new eui.UILayer,e.panelLayer=new eui.UILayer,e.popMsgLayer=new eui.UILayer,e.maskLayer=new eui.UILayer,e.loadLayer=new eui.UILayer,e.fixedTopFrame=new egret.Sprite,e.fixedBottomFrame=new egret.Sprite,e.masks=new Array,e.GUIDE_MASK_NAME="GUIDE_MASK",e.GUIDE_MASK_RADIUS=22,e.GUIDE_MASK_SIZE=1e3,e.globalOffsetY=0,e.isSizeDirty=!1,e._touchBlockSource=[],e.init(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStageView,e),e.viewStack={tabLayer:[],mainLayer:[],panelLayer:[]},window.addEventListener("resize",function(){r.gameLayer().isSizeDirty||(r.gameLayer().isSizeDirty=!0,egret.setTimeout(function(){"portrait"==(window.innerWidth>window.innerHeight?"landscape":"portrait")?r.gameLayer().stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH:(r.gameLayer().stage.orientation=egret.OrientationMode.AUTO,r.gameLayer().stage.scaleMode=egret.StageScaleMode.SHOW_ALL),r.gameLayer().isSizeDirty=!1},e,350))},!1),e}return __extends(r,t),r.prototype.onAddToStageView=function(){egret.log("当前stage尺寸",Utils.DeviceUtils.curWidth(),Utils.DeviceUtils.curHeight(),window.innerWidth,window.innerHeight),"portrait"==(window.innerWidth>window.innerHeight?"landscape":"portrait")?this.stage.scaleMode=egret.StageScaleMode.FIXED_WIDTH:(this.stage.orientation=egret.OrientationMode.AUTO,this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL),this.stage.frameRate=30,Utils.TouchUtils.activateGlobalTouch(this),Utils.TouchUtils.addGlobalTouch(function(e){e.target instanceof eui.Button&&Utils.SoundManager.playSound(SOUND_EFF_TYPE.btn_tap)},"CLICK_SOUND_EFFECT")},r.gameLayer=function(){return this._instance||(this._instance=new r),this._instance},r.prototype.init=function(){this.touchEnabled=!1,this.mainLayer.touchEnabled=!1,this.tabLayer.touchEnabled=!1,this.panelLayer.touchEnabled=!1,this.popMsgLayer.touchEnabled=!1,this.maskLayer.touchEnabled=!1,this.loadLayer.touchEnabled=!1,this.addChild(this.tabLayer),this.addChild(this.mainLayer),this.addChild(this.panelLayer),this.addChild(this.maskLayer),this.addChild(this.loadLayer),this.addChild(this.popMsgLayer)},r.prototype.preloadRes=function(){var t=this;this.loadingEffectKaiGuan||DragonBoneTools.create("common_miwu",function(e){e.x=t.maskLayer.width/2,e.y=t.maskLayer.height/2,e.visible=!1,t.loadingEffectKaiGuan=e,t.loadLayer.addChild(e)})},r.prototype.reset=function(){this.touchEnabled=!1,this.mainLayer.touchEnabled=!1,this.tabLayer.touchEnabled=!1,this.panelLayer.touchEnabled=!1,this.popMsgLayer.touchEnabled=!1,this.maskLayer.touchEnabled=!1,this.loadLayer.touchEnabled=!1,this.removeChild(this.tabLayer),this.removeChild(this.mainLayer),this.removeChild(this.panelLayer)},r.prototype.bindView=function(e,t,i,o,n){void 0===t&&(t=0),void 0===i&&(i=void 0),void 0===o&&(o=void 0),(i=i||r.gameLayer().tabLayer).contains(e)||(null!=o?i.addChildAt(e,o):i.addChild(e)),r.gameLayer().arrangeViewVisible(),n&&n(),UIActionManager.playUIAction(e,t,function(){})},r.prototype.switchTouchEnable=function(e,t){var i=this._touchBlockSource.indexOf(t);e?t&&0<=i&&this._touchBlockSource.splice(i,1):t&&i<0&&this._touchBlockSource.push(t);var o=0==this._touchBlockSource.length;this.touchEnabled=this.touchChildren=e&&o},r.prototype.colorSignCB=function(){Utils.MsgUtils.addMidMsg("请按当前指引点击")},r.prototype.switchDarkMaskForGuide=function(e,t){var i=this.makeMaskGp();if(e){i.visible=!0;var o=1.3*(t.r&&t.r+5||70)/this.GUIDE_MASK_RADIUS;i.scaleX=i.scaleY=o,i.x=t.x,i.y=t.y,this.maskTouchCB=t&&t.maskCB,t.cb&&t.cb()}else i.visible=!1},r.prototype.makeMaskGp=function(){var e=this,t=r.gameLayer().maskLayer.getChildByName(this.GUIDE_MASK_NAME);if(!t){(t=new eui.Group).width=t.height=this.GUIDE_MASK_SIZE,t.anchorOffsetX=t.anchorOffsetY=this.GUIDE_MASK_SIZE/2,t.name=this.GUIDE_MASK_NAME,t.touchEnabled=!1,r.gameLayer().maskLayer.addChild(t);var i=new eui.Image("xinshou_img_zhedang_png");i.touchEnabled=!1,t.addChild(i);for(var o=0;o<4;o++){var n=new eui.Group;n.width=this.GUIDE_MASK_SIZE/2-.6*this.GUIDE_MASK_RADIUS,n.height=this.GUIDE_MASK_SIZE/2+.6*this.GUIDE_MASK_RADIUS,n.rotation=90*o,0<o&&o<3&&(n.x=this.GUIDE_MASK_SIZE),1<o&&o<4&&(n.y=this.GUIDE_MASK_SIZE),Utils.TouchUtils.addTouchListener(n,function(){e.maskTouchCB&&e.maskTouchCB()}),t.addChild(n);var a=new eui.Group;a.width=.2*this.GUIDE_MASK_RADIUS,a.height=.2*this.GUIDE_MASK_RADIUS,a.rotation=90*o,a.x=0<o&&o<3?n.height:n.width,a.y=1<o&&o<4?n.height:n.width,t.addChild(a)}}return t},r.prototype.makeTouchLayer=function(e,t,i){var o,n=this,a=new eui.Group;a.percentWidth=100,a.percentHeight=100,this.popMsgLayer.addChild(a);var r=new eui.Label;if(r.text="点击屏幕继续",r.horizontalCenter=0,r.bottom=250,UIActionManager.fadeBlink(r,!0),a.addChild(r),a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o&&egret.clearInterval(o),this.popMsgLayer.removeChild(a),e&&e.call(t)},this),i){var s=i;r.text="点击屏幕继续("+s/1e3+"s)",o=egret.setInterval(function(){(s-=1e3)<=0?(egret.clearInterval(o),o=void 0,n.popMsgLayer.removeChild(a),e&&e.call(t)):r.text="点击屏幕继续("+s/1e3+"s)"},this,1e3)}r.visible=!1},r.prototype.onPopStatusUpdate=function(e,t){this.setViewStackDirty()},r.prototype.arrangeViewVisible=function(){function r(e){var t=0;return e.$children.forEach(function(e){e.skinName&&t++}),t}function e(e,t,i){void 0===i&&(i=!1);var o=r(e);for(var n in e.$children){var a=e.$children[n];if(!(0<o))break;if(a.skinName){if(o-=1,"FightUISkin"==a.skinName)break;a.visible=!(!i||0!=o)||t}}}var t=r(this.mainLayer);r(this.tabLayer);this.panelLayer.$children.some(function(e){return"FightUISkin"==e.skinName})?(e(this.mainLayer,!1),e(this.tabLayer,!1),e(this.panelLayer,!1)):(1<t?(e(this.mainLayer,!1,!0),e(this.tabLayer,!1)):(e(this.mainLayer,!0),e(this.tabLayer,!1,!0)),e(this.panelLayer,!0))},r.prototype.showCurViewVisible=function(){function e(i){t[i].forEach(function(e){var t=o.getViewBySkinName(e);t&&egret.log("【DEBUG】"+i+"#"+e+"_visible:",t.visible)})}var o=this,t=this.getCurViewStack();for(var i in t)e(i);egret.log("【DEBUG】----------------------------------------------")},r.prototype.setViewStackDirty=function(){this.isViewStackDirty=!0},r.prototype.getCurViewStack=function(){if(this.isViewStackDirty){this.isViewStackDirty=!1,this.viewStack={tabLayer:[],mainLayer:[],panelLayer:[]};for(var e=0,t=this.tabLayer.$children;e<t.length;e++){var i=t[e];BaseTab.prototype.isPrototypeOf(i)&&i.skinName&&this.viewStack.tabLayer.push(i.skinName)}for(var o=0,n=this.mainLayer.$children;o<n.length;o++){i=n[o];(BasePanel.prototype.isPrototypeOf(i)||BaseView.prototype.isPrototypeOf(i))&&i.skinName&&this.viewStack.mainLayer.push(i.skinName)}for(var a=0,r=this.panelLayer.$children;a<r.length;a++){i=r[a];(BasePanel.prototype.isPrototypeOf(i)||BaseView.prototype.isPrototypeOf(i))&&i.skinName&&this.viewStack.panelLayer.push(i.skinName)}}return this.viewStack},r.prototype.getViewStackJsonStr=function(){if(this.viewStack)return this.getCurViewStack(),JSON.stringify(this.viewStack)},r.prototype.getCurViewSkinName=function(){var e=r.gameLayer().getCurViewStack();return 0<e.panelLayer.length?e.panelLayer[e.panelLayer.length-1]:1<e.mainLayer.length?e.mainLayer[e.mainLayer.length-1]:0<e.tabLayer.length?e.tabLayer[e.tabLayer.length-1]:e.mainLayer[e.mainLayer.length-1]},r.prototype.getViewBySkinName=function(i){function e(e){for(var t in e.$children)if(e.$children[t].skinName==i)return e.$children[t]}return e(this.panelLayer)||e(this.mainLayer)||e(this.tabLayer)},r.prototype.showSkipBtn=function(e){var t=this;this.skipBtn&&this.skipBtn.parent&&this.skipBtn.parent.removeChild(this.skipBtn),this.skipBtn=new eui.Image,RES.getResAsync("_common_m_json.common_img_tiaoguojuqing",function(e){t.skipBtn.source=e},this),this.skipBtn.right=10,this.skipBtn.top=25,this.popMsgLayer.addChild(this.skipBtn),this.skipBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e(),t.hideSkipBtn()},this)},r.prototype.hideSkipBtn=function(){this.skipBtn&&this.skipBtn.parent&&this.skipBtn.parent.removeChild(this.skipBtn),this.skipBtn=void 0},r.prototype.switchCloudLoading=function(e,t){var i=this;e?this.loadingEffectKaiGuan?(this.loadingEffectKaiGuan.visible=!0,this.loadingEffectKaiGuan.animation.play("guan"),egret.setTimeout(function(){t&&t()},this,700)):t&&t():this.loadingEffectKaiGuan&&this.loadingEffectKaiGuan.visible?(this.loadingEffectKaiGuan.animation.play("kai"),egret.setTimeout(function(){i.loadingEffectKaiGuan.visible=!1,t&&t()},this,900)):t&&t()},Object.defineProperty(r.prototype,"isMenShow",{get:function(){return this.loadingUIEasy?this.loadingUIEasy.isMenShow:this.loadingUI?this.loadingUI.isMenShow:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isMiWuShow",{get:function(){return this.loadingEffectKaiGuan.visible},enumerable:!0,configurable:!0}),r.prototype.onEnterMain=function(){var e=this;this.loadingUI||(this.loadingUI=new game.LoadingUI,this.loadLayer.addChild(this.loadingUI));var t=void 0,i=game.AppFacade.getInstance().retrieveProxy(game.GuidePy.N);1!=game.GameMVC.playerPy.playerInfoVO.level||i.serverGuideInfo[3e7+1]||Utils.SDKMgr.getPerformConfig(37)||(t=function(){i.setGuideInfo(3e7+1),PopUpManager.addPopUp({effectType:0,obj:new game.StartAnimation}),game.GameMVC.activityPy.checkRedBag()}),t||(Utils.SDKMgr.getPerformConfig(7)?game.GameMVC.loginPy.getGameNotice(function(){game.GameMVC.playerPy.checkNeedAndPopUpdateLog(),game.GameMVC.playerPy.checkAndPopAds(),game.GameMVC.activityPy.checkRedBag()}):(game.GameMVC.playerPy.checkNeedAndPopUpdateLog(),game.GameMVC.playerPy.checkAndPopAds(),game.GameMVC.activityPy.checkRedBag())),r.gameLayer().switchMenLoading(!1,t,"LOGIN_INTO_MAP"),egret.setTimeout(function(){Utils.FlowUtils.enterFlow("EnterMain"),e.loadingUIEasy&&e.loadingUIEasy.parent&&e.loadingUIEasy.parent.removeChild(e.loadingUIEasy),e.loadingUIEasy=void 0},this,250)},r.prototype.switchMenLoading=function(e,t,i){this.loadingUIEasy?this.loadingUIEasy.switchMenLoading(e,t,i):this.loadingUI?this.loadingUI.switchMenLoading(e,t,i):t&&t()},r}(eui.UILayer);__reflect(GameRootLayer.prototype,"GameRootLayer"),function(o){var e=(t.registerAll=function(){(new n).register(),(new s).register()},t);function t(){}o.WorldKingProcessor=e,__reflect(e.prototype,"game.WorldKingProcessor");var i,n=(i=o.ProcessorBase,__extends(a,i),a.prototype.execute=function(e){var t=e.getBody();console.log("PushOpponentInfoP",t);var i=o.AppFacade.getInstance().retrieveProxy(o.WorldKingPy.N);t.err?i.matchingFail():i.matchingSucceed()},a);function a(){return i.call(this,"worldKing.PushOpponentInfoP",a)||this}o.PushOpponentInfoP=n,__reflect(n.prototype,"game.PushOpponentInfoP");var r,s=(r=o.ProcessorBase,__extends(c,r),c.prototype.execute=function(e){var t=e.getBody();console.log("InfoUpdateP",t),o.AppFacade.getInstance().retrieveProxy(o.WorldKingPy.N).updateInfo(t.info)},c);function c(){return r.call(this,"worldKing.InfoUpdateP",c)||this}o.InfoUpdateP=s,__reflect(s.prototype,"game.InfoUpdateP")}(game=game||{}),function(a){var i,o=(i=a.BaseVO,__extends(e,i),e.prototype.updateInfo=function(e){this.grade=e.grade,this.challengeTimes=e.challengeTimes,this.gotRewards=e.gotRewards,this.opponentInfo=e.opponentInfo,this.battleRecord=e.battleRecord,this.hLevel=e.hLevel,this.hWorldRank=e.hWorldRank,this.cWorldRank=e.cWorldRank,this.hBuyTimes=e.hBuyTimes,this.times=e.times;var t=this.levelConfigId;this.levelConfigId=e.levelConfigId;var i=e.levelConfigId;if(t&&t<i){var o=a.Config.worldKingLevelConfig();if(o[i].stars<o[t].stars){var n=a.AppFacade.getInstance().retrieveProxy(a.FightPy.N);n.addDelayCBAfterFightExit(function(){DragonBoneTools.playOnce({effectName:"common_duanweitisheng",parent:GameRootLayer.gameLayer().popMsgLayer,doneCB:function(){n.queueExceExitCB()}})},"world_king_level_up")}}},e);function e(e){var t=i.call(this)||this;return t.battleRecord=[],e&&t.updateInfo(e),t}__reflect(o.prototype,"WorldKingInfoVO");var t,n=(__extends(r,t=BaseProxy),r.prototype.initNotice=function(){NoticeManager.setChildType(NT.CITY_PVP_ENTRANCE,NT.WORLD_KING),NoticeManager.setChildType(NT.WORLD_KING,[NT.WORLD_KING_REWARD,NT.WORLD_KING_TIMES_OR_CHEST]),NoticeManager.registerCB(NT.WORLD_KING_REWARD,this.checkRewardNotice,this),NoticeManager.registerCB(NT.WORLD_KING_TIMES_OR_CHEST,this.checkTimesNotice,this)},r.prototype.updateInfo=function(e){this.worldKingInfo.updateInfo(e),a.AppFacade.getInstance().updateView(a.WorldKingMediator.N,a.WorldKingMediator.SV.MAIN),a.AppFacade.getInstance().updateView(a.RankMediator.N,a.RankMediator.SV.COMMON_REWARD),NoticeManager.updateNotice(NT.WORLD_KING_REWARD),NoticeManager.updateNotice(NT.WORLD_KING_TIMES_OR_CHEST),a.AppFacade.getInstance().sendNotification(CN.QQZONE_PUSH_MESSAGE,{data:{curLevel:e.levelConfigId,oldLevel:this.worldKingInfo.levelConfigId},type:"worldKingRank"})},r.prototype.GetWorldKingInfo=function(){var t=this;Utils.Socket.send("worldKing","GetInfo",{}).then(function(e){t.log("获取排位赛数据   GetInfoR",e),t.worldKingInfo||(t.worldKingInfo=new o),t.updateInfo(e.info)})},r.prototype.GetReward=function(t){var i=this;Utils.Socket.send("worldKing","GetReward",{type:t.type,id:t.id}).then(function(e){i.log("领取跨服排位奖励  GetRewardR",e),t.cb&&t.cb(),a.AppFacade.getInstance().retrieveProxy(a.BackpackPy.N).handleClientReward(e.clientReward),i.GetWorldKingInfo()})},r.prototype.JoinMatching=function(){var t=this;Utils.Socket.send("worldKing","JoinMatching",{}).then(function(e){t.setMatchingStatus(!0)})},r.prototype.CancelMatch=function(){var t=this;Utils.Socket.send("worldKing","CancelMatch",{}).then(function(e){t.setMatchingStatus(!1)})},r.prototype.BuyChallengeTimes=function(t,i){var o=this;Utils.Socket.send("worldKing","BuyChallengeTimes",{num:t}).then(function(e){Utils.MsgUtils.addMidMsg("成功购买"+t+"次"),o.updateInfo(e.info),i&&i()})},r.prototype.matchingSucceed=function(){this.setMatchingStatus(!1),this.fight()},r.prototype.matchingFail=function(){this.setMatchingStatus(!1),Utils.MsgUtils.addMidMsg("匹配失败，清稍后再试")},r.prototype.setMatchingStatus=function(e){this.isMatching=e,a.AppFacade.getInstance().updateView(a.WorldKingMediator.N,a.WorldKingMediator.SV.MAIN,{matching:e})},r.prototype.checkTimesNotice=function(){if(this.getOpenInfo().latestEndDt<Utils.TimerManager.getServerTime())return!1;var e=!1;if(this.worldKingInfo)if(0<this.worldKingInfo.times)e=!0;else{var t=a.Config.worldKingRewardConfig(WorldKingRewardType.BattleTimes),i=JSON.parse(this.worldKingInfo.gotRewards);for(var o in t){var n=t[o];if(i.indexOf(n.code)<0&&this.worldKingInfo.challengeTimes>=JSON.parse(n.key)[0]){e=!0;break}}}return e},r.prototype.checkRewardNotice=function(){if(this.getOpenInfo().latestEndDt<Utils.TimerManager.getServerTime())return!1;if(this.worldKingInfo){var e=JSON.parse(this.worldKingInfo.gotRewards),t=WorldKingRewardType.Level;a.GameMVC.loginPy.loginGameVO.singleSign&&(t=WorldKingRewardType.SingleLevel);var i=a.Config.worldKingRewardConfig(t);for(var o in i){var n=i[o];if(a.Config.worldKingLevelConfig()[JSON.parse(n.key)[0]],-1==e.indexOf(n.code)&&this.worldKingInfo.hLevel>=JSON.parse(n.key)[0])return!0}return!1}},r.prototype.fight=function(){var e=this;this.sendNotification(CN.FIGHT_REQ_ANY_FIGHT,{type:EBattleType.EBattleTypeWorldKing,customParams:{},isPassive:!0,doneCB:function(){e.GetWorldKingInfo(),a.AppFacade.getInstance().retrieveProxy(a.FightPy.N).queueExceExitCB()}})},r.prototype.getOpenInfo=function(){return a.GameMVC.loginPy.loginGameVO.singleSign?Utils.TimerManager.checkIsOpenForSingleServer(a.Config.constConfig().SingleWorldKingDt.constValue):Utils.TimerManager.checkIsOpen_FormatB(a.Config.constConfig().WorldKingDt.constValue)},r.N="WorldKingPy",r);function r(){var e=t.call(this,r.N)||this;return e.isMatching=!1,e.initNotice(),e}a.WorldKingPy=n,__reflect(n.prototype,"game.WorldKingPy")}(game=game||{}),function(e){var i,t=(i=eui.Component,__extends(p,i),p.prototype.childrenCreated=function(){i.prototype.childrenCreated.call(this),this.rankData&&this.updateBadge(this.rankData),this.pb_score.startingAngle=-90,this.pb_score.antiClockwise=!0},p.prototype.updateBadge=function(e,t){var i=this;if(void 0===t&&(t=!1),this.noStar=t,this.rankData=e,this.curType=this.rankData.type,this.grade=this.rankData.grade,null!=this.grade){var o;switch(this.curType){case p.RANK_TYPE.WORLD_KING:o=game.Config.worldKingLevelConfig();break;case p.RANK_TYPE.ZZQ:o=game.Config.chessStarLevel()}if(o){this.levelId=0;var n,a,r=-1,s=!1;for(var c in o){var l=o[c];if(s||(this.grade>=l.requestGrade?(this.levelId=l.code,n=l,r=Number(n.stars)):s=!0),s&&!a&&(a=l),s){if(!(r<Number(l.stars)))break;r=Number(l.stars)}}for(var h in egret.setTimeout(function(){i.pb_score.labelFunction=function(e,t){return"积分:"+i.grade+"/"+(a&&a.requestGrade||n.requestGrade)},a?(i.pb_score.maximum=2*(a.requestGrade-n.requestGrade),i.pb_score.value=0<i.grade-n.requestGrade?i.grade-n.requestGrade:0):(i.pb_score.maximum=2*n.requestGrade,i.pb_score.value=i.grade)},this,300),this.adaptStars(n.stars,-1==r?n.stars:r),this.img_icon.source=ResourceUtils.png(n.icon),e.fromRank?this.gp_rank.scaleX=this.gp_rank.scaleY=2.5:this.gp_rank.scaleX=this.gp_rank.scaleY=1,this.RANK_IMAGE)-1!=n.name.search(h)&&(this.img_rank_prefix.source=ResourceUtils.png(this.RANK_IMAGE[h]));0!=n.num?(this.gp_rank.contains(this.img_rank_suffix)||this.gp_rank.addChild(this.img_rank_suffix),this.img_rank_suffix.source="paiweisai_img_"+n.num+"_png"):this.gp_rank.contains(this.img_rank_suffix)&&this.gp_rank.removeChild(this.img_rank_suffix)}}},p.prototype.adaptStars=function(e,t){if(this.gp_stars_3.visible=!1,this.gp_stars_4.visible=!1,this.gp_stars_5.visible=!1,t=0==t?3:t,5==e&&-1==t&&this.curType==p.RANK_TYPE.ZZQ&&(t=5),!this.noStar){this["gp_stars_"+t].visible=!0;for(var i=1;i<=t;i++){var o=this["star_"+t+"_"+i];o.source=i<=e?"paiweisai_icon_xing1_png":"paiweisai_icon_xing2_png"}}},p.RANK_TYPE={WORLD_KING:1,ZZQ:2},p);function p(e){var t=i.call(this)||this;return t.RANK_IMAGE={"青铜":"paiweisai_txt_qingtong","白银":"paiweisai_txt_baiyin","黄金":"paiweisai_txt_huangjin","铂金":"paiweisai_txt_bojin","钻石":"paiweisai_txt_zuanshi","星耀":"paiweisai_txt_xingyao","王者":"paiweisai_txt_wangzhe"},t.rankData=e,t.skinName="WorldKingBadgeSkin",t}e.WorldKingBadge=t,__reflect(t.prototype,"customui.WorldKingBadge")}(customui=customui||{}),function(o){var t,e=(__extends(i,t=BaseFull),i.prototype.onDestroy=function(){t.prototype.onDestroy.call(this),Utils.AssetsMgr.destroyGroup("group_world_king")},i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.setMatchingEffectEnable(this.wkProxy.isMatching),this.initRewardsPB(),this.initPreviewGroup(),this.activateEndingTimer(),this._activateComponent(),this.addNotice()},i.prototype.initRewardsPB=function(){function e(e){var t=n.rewardsConfig[e],i=JSON.parse(t.key)[0];n.pb_rewards["lb_"+e].text=i.toString();var o=n["gp_"+e];n["effect_"+e]=new eui.Group,o.addChild(n["effect_"+e]),o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.onChestBtnTap(e)},n),n.chestInterval.push(i)}this.chestInterval.push(0),this.rewardsConfig=o.Config.worldKingRewardConfig(WorldKingRewardType.BattleTimes);var n=this;for(var t in this.rewardsConfig)e(t);this.chestInterval.sort(function(e,t){return e-t}),this.pb_rewards.maximum=100*this.chestInterval[this.chestInterval.length-1]},i.prototype.initPreviewGroup=function(){},i.prototype.updateView=function(e){if(e&&null!=e.matching)this.setMatchingEffectEnable(e.matching);else{var t=this.wkProxy.worldKingInfo;if(t){var i=t.levelConfigId;o.Config.worldKingLevelConfig()[i],this.rankBadge.updateBadge({type:customui.WorldKingBadge.RANK_TYPE.WORLD_KING,grade:t.grade}),this.blb_fightCap.text=this.playerProxy.playerInfoVO.fightCap.toString(),this.blb_score.text=""+t.grade,this.blb_rank.text=""+t.cWorldRank,this.playerHead.updateData({vo:this.playerProxy.playerInfoVO}),this.blb_count.text=t.times.toString(),this.updateRewardsChest()}else this.wkProxy.GetWorldKingInfo()}},i.prototype.updateRewardsChest=function(){function e(e){var t=h.rewardsConfig[e],i=h["btn_reward_"+e],o=h["img_received_"+e],n=-1!=l.indexOf(t.code),a=c.challengeTimes>=JSON.parse(t.key)[0];i.available=!n&&a,UIActionManager.setAbsGrey(i,!a),o.visible=n;var r=h["effect_"+e];if(r.removeChildren(),i.available){i.visible=!1;var s="common_baoxiang_"+e;DragonBoneTools.create(s,function(e){e.visible=!0,e.scaleX=e.scaleY=.9,e.x=i.width/2,e.y=i.height/2+20,e.animation.play(),r.addChild(e)},h)}else i.visible=!0,i.icon=n?"jiangli_icon_baoxiang0"+e+"_02_png":"jiangli_icon_baoxiang0"+e+"_01_png"}var c=this.wkProxy.worldKingInfo,l=JSON.parse(c.gotRewards),h=this;for(var t in this.rewardsConfig)e(t);for(var i=c.challengeTimes,o=this.pb_rewards.maximum/100/(this.chestInterval.length-1),n=0,a=0;a<this.chestInterval.length&&i>=this.chestInterval[a];a++)n=o*a,this.chestInterval[a+1]&&i<this.chestInterval[a+1]&&(n+=(i-this.chestInterval[a])*o/(this.chestInterval[a+1]-this.chestInterval[a]));this.pb_rewards.value=100*n},i.prototype.openRewardEffect=function(n){function e(e){var t=r["btn_reward_"+e];if(t.available){a=a||e;var i=e;r["effect_"+e].removeChildren(),t.visible=!0,t.icon="jiangli_icon_baoxiang0"+e+"_02_png";var o=r["gp_"+e];DragonBoneTools.playOnce({effectName:"common_baoxiangkai",parent:o,y:o.height/2,doneCB:function(){i==a&&n&&n()}})}}for(var a=0,r=this,t=1;t<6;t++)e(t)},i.prototype.onChestBtnTap=function(e){var t=this;this["btn_reward_"+e].available?this.openRewardEffect(function(){t.wkProxy.GetReward({type:WorldKingRewardType.BattleTimes,id:t.rewardsConfig[e].code})}):this.updateRewardPreviewGroup(this.rewardsConfig[e])},i.prototype.updateRewardPreviewGroup=function(e){var t=JSON.parse(e.rewards);o.AppFacade.getInstance().showSubView(o.CommonMediator.N,o.CommonMediator.SV.REWARD_PANEL,{rewards:JSON.parse(t),type:o.CommonRewardPreviewPanel.REWARD_TYPE.OBTAIN})},i.prototype.setMatchingEffectEnable=function(e){var t=this;if(e){this.btn_match.label="匹配中";var i=this.btn_match.label.length;this.matchingEffectTimer=egret.setInterval(function(){t.btn_match.label.length<i+3?t.btn_match.label+=".":t.btn_match.label="匹配中"},this,300)}else this.matchingEffectTimer&&(egret.clearInterval(this.matchingEffectTimer),this.matchingEffectTimer=void 0),this.btn_match.label="匹配"},i.prototype.getRemainingTime=function(e){return Utils.TimerManager.getFormatBySecond1(e)},i.prototype.activateEndingTimer=function(){var t=this,i=this.wkProxy.getOpenInfo();this.lb_countdown.text=this.getRemainingTime(i.latestEndDt-Utils.TimerManager.getServerTime(!1)),this.endingTimer||(this.endingTimer=egret.setInterval(function(){var e=i.latestEndDt-Utils.TimerManager.getServerTime(!1);0<e?t.lb_countdown.text=""+t.getRemainingTime(e):(Utils.MsgUtils.addMidMsg("跨服争霸赛已结束"),o.MainJumpConfig.jumpTo())},this,1e3))},i.prototype.showBuyPanel=function(){var t=this;o.AppFacade.getInstance().showSubView(o.CommonMediator.N,o.CommonMediator.SV.BUY_TIMES,{moduleId:MODULE.WorldKing,hasBuyNum:this.wkProxy.worldKingInfo.hBuyTimes,maxBuyNum:Number(o.Config.constConfig().WorldKingMaxBuyChallengeTimes.constValue),buyCB:function(e){t.wkProxy.BuyChallengeTimes(e)}})},i.prototype.addNotice=function(){NoticeManager.addNoticeListener(NT.WORLD_KING_REWARD,this.btn_reward.$children[0],this,BTN_ICON_NOTICE_POS)},i.prototype._activateComponent=function(){var e=this;this.btn_back.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.MainJumpConfig.jumpTo()},this),this.btn_match.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=this.wkProxy.worldKingInfo;this.wkProxy.isMatching?this.wkProxy.CancelMatch():0<e.times?this.wkProxy.JoinMatching():this.wkProxy.worldKingInfo.hBuyTimes<Number(o.Config.constConfig().WorldKingMaxBuyChallengeTimes.constValue)?this.showBuyPanel():Utils.MsgUtils.addMidMsg("挑战次数不足")},this),this.btn_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.GameMVC.loginPy.loginGameVO.singleSign?o.AppFacade.getInstance().showSubView(o.RankMediator.N,o.RankMediator.SV.COMMON,{module:"WORLD_KING_RANK_SINGLE"}):o.AppFacade.getInstance().showSubView(o.RankMediator.N,o.RankMediator.SV.COMMON,{module:"WORLD_KING_RANK"})},this),Utils.UnlockMgr.checkPass(MODULE.BattleFormation,!1).allow?this.btn_mutiTeam.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.GameMVC.heroMutiTeamPy.server_GetBattleFormationInfo(function(){o.GameMVC.heroMutiTeamMed.showSubView(o.HeroMutiTeamMediator.SV.MAIN,{type:2,moduleId:MODULE.WorldKing})})},this):this.btn_mutiTeam.visible=!1,this.btn_reward.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.GameMVC.loginPy.loginGameVO.singleSign?o.AppFacade.getInstance().showSubView(o.RankMediator.N,o.RankMediator.SV.COMMON,{module:"WORLD_KING_REWARD_SINGLE"}):o.AppFacade.getInstance().showSubView(o.RankMediator.N,o.RankMediator.SV.COMMON,{module:"WORLD_KING_REWARD"})},this),this.btn_shop.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.AppFacade.getInstance().sendNotification(CN.SHOP_OPEN_BY_TYPE,{shopType:ShopType.ShopTypeWorldKing})},this),this.btn_record.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){o.AppFacade.getInstance().showSubView(o.FightMediator.N,o.FightMediator.SV.RECORD,{records:this.wkProxy.worldKingInfo.battleRecord})},this),this.btn_help.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){PopUpManager.addPopUp({obj:new o.HelpDialog({moduleId:MODULE.WorldKing})})},this),Utils.TouchUtils.addTouchListener(this.btn_add,function(){e.wkProxy.worldKingInfo.hBuyTimes<Number(o.Config.constConfig().WorldKingMaxBuyChallengeTimes.constValue)?e.showBuyPanel():Utils.MsgUtils.addMidMsg("今日已达购买次数上限")})},i.prototype.perClose=function(){egret.clearInterval(this.matchingEffectTimer),egret.clearInterval(this.endingTimer)},i);function i(){var e=t.call(this)||this;return e.wkProxy=o.AppFacade.getInstance().retrieveProxy(o.WorldKingPy.N),e.playerProxy=o.AppFacade.getInstance().retrieveProxy(o.PlayerPy.N),Utils.AssetsMgr.loadGroup("group_world_king"),e.skinName="WorldKingMainSkin",e.chestInterval=[],e}o.WorldKingMainView=e,__reflect(e.prototype,"game.WorldKingMainView")}(game=game||{}),function(h){var t,e=(__extends(i,t=BasePanel),i.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.currentState="rank",this.initial(),this.activateComponent()},i.prototype.initial=function(){this.item_list=new eui.List;var e=new eui.VerticalLayout;this.item_list.layout=e,this.scroller.viewport=this.item_list,this.scroller.verticalScrollBar.autoVisibility=!1,this.scroller.verticalScrollBar.visible=!1},i.prototype.updateView=function(){switch(this.scroller.viewport.scrollV=0,this.scroller.stopAnimation(),this.currentState){case"rank":this.updateRank();break;case"segment":this.updateSegment()}},i.prototype.updateRank=function(){var i=this;this.item_list.itemRenderer=p;var e=this.wkProxy.worldKingInfo.hWorldRank;this.blb_highest.text=e.toString();var t=this.wkProxy.worldKingInfo.cWorldRank;this.lb_desc.text="你的当前排名为"+t+"，保持排名你可以获得：";var o="",n=h.Config.rankingRewardByTypeConfig(RankingType.RankingTypeWorldWorldKing),a=[];for(var r in n){var s=n[r];t>=s.rankUpper&&t<=s.rankLower&&(o=s.rewards);for(var c=s.rankUpper;c<=s.rankLower;c++)a.push({rank:c,rewards:s.rewards})}a.sort(function(e,t){return e.rank-t.rank}),this.item_list.dataProvider=new eui.ArrayCollection(a);var l=JSON.parse(o);this.gp_rewards.removeChildren(),l.forEach(function(e){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,t.updateData({type:e[0],code:e[1],num:e[2]}),i.gp_rewards.addChild(t)})},i.prototype.updateSegment=function(){this.item_list.itemRenderer=c;var e=this.wkProxy.worldKingInfo,t=JSON.parse(e.gotRewards),i=h.Config.worldKingRewardConfig(WorldKingRewardType.Level),o=[];for(var n in i){var a=i[n],r=-1!=t.indexOf(a.code),s=!r&&e.hLevel>=JSON.parse(a.key)[0];o.push({config:a,available:s,received:r})}o.sort(function(e,t){return e.available!=t.available?t.available?1:-1:t.config.code-e.config.code}),this.item_list.dataProvider=new eui.ArrayCollection(o)},i.prototype.activateComponent=function(){this.daTanChuKuang.blb_title.text="奖励",this.daTanChuKuang.onCloseCB=function(){h.AppFacade.getInstance().hideSubView(h.WorldKingMediator.N,h.WorldKingMediator.SV.REWARD)},this.gp_rank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"rank"!=this.currentState&&(this.currentState="rank",this.updateView())},this),this.gp_segment.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"segment"!=this.currentState&&(this.currentState="segment",this.updateView())},this)},i);function i(){var e=t.call(this)||this;return e.wkProxy=h.AppFacade.getInstance().retrieveProxy(h.WorldKingPy.N),e.skinName="WorldKingRewardSkin",e}h.WorldKingRewardPanel=e,__reflect(e.prototype,"game.WorldKingRewardPanel");var o,p=(o=eui.ItemRenderer,__extends(n,o),n.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this);for(var e=1;e<=3;e++){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,this.gp_rewards.addChild(t)}},n.prototype.dataChanged=function(){var e=this.data.rank;e<=3?(this.img_icon.visible=!0,this.lb_rank.visible=!1,this.img_icon.source="jjc_icon_pm_"+e+"_png"):(this.img_icon.visible=!1,this.lb_rank.visible=!0,this.lb_rank.text=e.toString());for(var t=JSON.parse(this.data.rewards),i=0;i<3;i++){var o=this.gp_rewards.getChildAt(i),n=t[i];n?(o.visible=!0,o.updateData({type:n[0],code:n[1],num:n[2]})):o.visible=!1}},n);function n(){var e=o.call(this)||this;return e.skinName="WorldKingRewardPanel_RankItem",e}__reflect(p.prototype,"WorldKingRewardPanel_RankItem");var a,c=(a=eui.ItemRenderer,__extends(r,a),r.prototype.childrenCreated=function(){a.prototype.childrenCreated.call(this),this.btn_receive.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){this.data.available?this.wkProxy.GetReward({tyep:this.data.config.type,id:this.data.config.code}):Utils.MsgUtils.addMidMsg("条件未达成")},this);for(var e=1;e<=3;e++){var t=customui.BaseItemFactory.create();t.scaleX=t.scaleY=.7,this.gp_rewards.addChild(t)}},r.prototype.dataChanged=function(){var e=this.data.config,t=h.Config.worldKingLevelConfig()[JSON.parse(e.key)[0]];this.lb_desc.text="段位达到"+t.name;for(var i=JSON.parse(e.rewards),o=0;o<3;o++){var n=this.gp_rewards.getChildAt(o),a=i[o];a?(n.visible=!0,n.updateData({type:a[0],code:a[1],num:a[2]})):n.visible=!1}this.data.received?(this.lb_received.visible=!0,this.btn_receive.visible=!1):(this.lb_received.visible=!1,this.btn_receive.visible=!0,this.data.available?(this.btn_receive.enabled=!0,this.btn_receive.label="领取"):(this.btn_receive.enabled=!1,this.btn_receive.label="未达成"))},r);function r(){var e=a.call(this)||this;return e.wkProxy=h.AppFacade.getInstance().retrieveProxy(h.WorldKingPy.N),e.skinName="WorldKingRewardPanel_SegmentItem",e}__reflect(c.prototype,"WorldKingRewardPanel_SegmentItem")}(game=game||{}),function(e){var t,i=(__extends(o,t=BaseProxy),o.prototype.isFeaturesUnlock=function(e,t){return{isBelonged:!1,unlock:!1}},o.prototype.getOpenInfo=function(){return{isOpen:!0}},o.prototype.GetZoneBossTaskInfo=function(e){},o.prototype.GetZoneBossInfo=function(e){},o.N="ZoneBossProxy",o);function o(){return t.call(this,o.N)||this}e.ZoneBossPy=i,__reflect(i.prototype,"game.ZoneBossPy")}(game=game||{}),function(r){var i,e=(i=r.BaseVO,__extends(t,i),t.prototype.update=function(e){this.code=e.code,this.startDt=e.startDt,this.endDt=e.endDt,this.content=JSON.parse(e.content),this.skinId=e.skinId},t.prototype.updateData=function(e,t){void 0===t&&(t=!1);try{"string"==typeof e&&(e=JSON.parse(e))}catch(e){}switch(this.code){case r.Activity235.groupActivityCode.keng:this.data?(this.data.keng=e.keng||this.data.keng,this.data.playerInfo=e.playerInfo||this.data.playerInfo):this.data=e;break;case EActivityType.LimitNumGift:case EActivityType.LimitNumGift1:if(!((this.data&&this.data.cId||0)<=(e&&e.cId)))return;this.data=e;break;case EActivityType.Island:if(this.data=e,this.data){var i=this.data.robRecord,o=(this.data.robRecordInfos,this.content[3]);for(var n in i)i[n][1]-=o}break;default:this.data=e}for(var n in e){var a=e[n];a&&"object"==typeof a&&0==Object.keys(a).length&&(e[n]=[])}t||this.onDataUpdate()},t.prototype.onDataUpdate=function(){NoticeManager.updateNotice(NT.ALL_ACTIVITY[this.code]);var e=r.AppFacade.getInstance().retrieveMediator(r.ActivityMediator.N);switch(e.updateViewByCode(this.code),this.code){case EActivityType.WholeLifeCard:e.updateViewByCode(EActivityType.MonthCard);break;case r.Activity235.groupActivityCode.keng:this.data.playerInfo&&this.data.playerInfo.treeRewards&&this.data.playerInfo.treeRewards.length&&r.GameMVC.fightPy.addDelayCBAfterFightExit(function(){r.AppFacade.getInstance().showSubView(r.ActivityMediator.N,r.ActivityMediator.SV.MID_AUTUMN_IDEL_REWARD),r.GameMVC.fightPy.queueExceExitCB()},"LanternFestival"),r.GameMVC.activityMed.updateViewByCode(r.Activity235.groupActivityCode.entrance);break;case EActivityType.ExtremeBattle:r.AppFacade.getInstance().sendNotification(CN.EXTREME_CHALLENGE_MODEL_UPDATE);break;case EActivityType.IslandPassCard:case EActivityType.Island:r.GameMVC.activityMed.updateViewByCode(EActivityType.IslandEntrance);break;case EActivityType.HonorOrderTask:NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.HonorOrder])}},t);function t(e){var t=i.call(this)||this;return e&&t.update(e),t}r.ActivityVO=e,__reflect(e.prototype,"game.ActivityVO")}(game=game||{});var game,CN=function(){function e(){}return e.CHANGE_PANEL="CHANGE_PANEL",e.GENERAL_PASS_DAY="GENERAL_PASS_DAY",e.HIDE_ALL_SUBVIEW="HIDE_ALL_SUBVIEW",e.LOGIN_FINAL_DONE="LOGIN_FINAL_DONE",e.CONFIG_ALL_LOADED="CONFIG_ALL_LOADED",e.SWITCH_TO_CITY="SWITCH_TO_CITY",e.GAME_HEARTBEAT="GAME_HEARTBEAT",e.SHOW_LOADING="SHOW_LOADING",e.HIDE_LOADING="HIDE_LOADING",e.LOGIN_HTTP_LOGIN_SUCESS="LOGIN_UPDATE_LOGIN",e.LOGIN_SERVER_SELECT="LOGIN_SERVER_SELECT",e.LOGIN_UPDATE_SERVER="LOGIN_UPDATE_SERVER",e.LOGIN_GO_LOGIN_LOGIN_SUCESS="LOGIN_GO_LOGIN_LOGIN_SUCESS",e.LOGIN_GO_LOGIN_LOGIN_FAIL="LOGIN_GO_LOGIN_LOGIN_FAIL",e.LOGIN_GO_LOGIN_LOGIN_NO_ROLE="LOGIN_GO_LOGIN_LOGIN_NO_ROLE",e.LOGIN_GO_LOGINGAME_LOGIN_SUCESS="LOGIN_GO_LOGINGAME_LOGIN_SUCESS",e.LOGIN_MAKE_ROLE_SUCCESS="LOGIN_MAKE_ROLE_SUCCESS",e.MAIN_COORDINATEINFO_UPDATE="MAIN_COORDINATEINFO_UPDATE",e.UPDATE_BG="UPDATE_BG",e.CHANGE_STYLE="CHANGE_STYLE",e.PRETEND_TAB_BTN_CLICK="MainNotify_SET_BTN_CLICK",e.PRETEND_TAB_BTN_CLICK_AFTER="MainNotify_SET_BTN_CLICK_AFTER",e.MAIN_CHAT_UPDATE="MAIN_CHAT_UPDATE",e.MAIN_CHAT_PRIVATEPLAYER_UPDATE="MAIN_CHAT_PRIVATEPLAYER_UPDATE",e.MAIN_CHAT_TASK_STEP="MAIN_CHAT_TASK_STEP",e.MAIN_DEBUG_INFO_UPDATE="MAIN_DEBUG_INFO_UPDATE",e.MAIN_CHANGE_BTN="MAIN_CHANGE_BTN",e.MAIN_UPDATE_BTN="MAIN_UPDATE_BTN",e.MAIN_FORCE_UPDATE_BANNER="MAIN_FORCE_UPDATE_BANNER",e.MAIN_UPDATE_PET="MAIN_UPDATE_PET",e.PLAYERINFO_MAIN_UPDATE="PLAYERINFO_MAIN_UPDATE",e.PLAYER_INFO_ERROR="PLAYER_INFO_ERROR",e.QQZONE_POPUP_VIEW="QQZONE_POPUP_VIEW",e.QQZONE_GIFT_VIEW="QQZONE_GIFT_VIEW",e.QQZONE_PUSH_MESSAGE="QQZONE_PUSH_MESSAGE",e.GOLDHAND_UPDATE="GOLDHAND_UPDATE",e.FIRST_INTO_CITY_FOR_EVERYDAY="FIRST_INTO_CITY_FOR_EVERYDAY",e.EXTREME_CHALLENGE_MODEL_UPDATE="EXTREME_CHALLENGE_MODEL_UPDATE",e.HERO_CHALLENGE_MODEL_UPDATE="HERO_CHALLENGE_MODEL_UPDATE",e.EGGS_UPDATE="EGGS_UPDATE",e.NEWYEARCHALLENGE_UPDATE="NEWYEARCHALLENGE_UPDATE",e.CITY_SWITCH_DBCLOCKPAUSE="CITY_SWITCH_DBCLOCKPAUSE",e.MAIL_OPEN_MAIN="MAIL_OPEN_MAIN",e.MAIL_CLOSE_MAIN="MAIL_CLOSE_MAIN",e.STRONG_OPEN_MAIN="STRONG_OPEN_MAIN",e.STRONG_CLOSE_MAIN="STRONG_CLOSE_MAIN",e.FRIEND_OPEN_MAIN="FRIEND_OPEN_MAIN",e.FRIEND_GIFT_UPDATE="FRIEND_GIFT_UPDATE",e.FRIEND_CLOSE_MAIN="FRIEND_CLOSE_MAIN",e.PLAYER_INFO_UPDATE="PLAYER_INFO_UPDATE",e.PLAYER_LEVEL_UP="PLAYER_LEVEL_UP",e.PLAYER_VIP_LEVEL_UP="PLAYER_VIP_LEVEL_UP",e.PLAYER_OUTLOOK_UPDATE="PLAYER_OUTLOOK_UPDATE",e.FIGHT_REQ_ANY_FIGHT="FIGHT_REQ_ANY_FIGHT",e.FIGHT_SPEED_UPDATE="FIGHT_SPEED_UPDATE",e.FIGHT_MODEL_CREATED="FIGHT_MODEL_CREATED",e.FIGHT_OPEN_FIGHT="FIGHT_OPEN_FIGHT",e.FIGHT_OPEN_OR_CLOSE_FIGHT_TEST="FIGHT_OPEN_OR_CLOSE_FIGHT_TEST",e.FIGHT_CLOSE_FIGHT="FIGHT_CLOSE_FIGHT",e.FIGHT_SKIP_FIGHT="FIGHT_SKIP_FIGHT",e.FIGHT_PZ="FIGHT_PZ",e.FIGHT_RESP_FIGHT_RESULT="FIGHT_RESP_FIGHT_RESULT",e.FIGHT_FIGHT_STATUS_SWITCH="FIGHT_FIGHT_STATUS_SWITCH",e.FIGHT_ON_FIGHT_VISIBLE_SWITCH="FIGHT_ON_FIGHT_VISIBLE_SWITCH",e.FIGHT_FIGHT_UPDATE_UI="FIGHT_FIGHT_UPDATE_UI",e.FIGHT_PAUSE="FIGHT_PAUSE",e.FIGHT_ALL_DONE_AND_EXIT="FIGHT_ALL_DONE_AND_EXIT",e.FIGHT_LET_OBJ_RELEASE_SKILL="FIGHT_LET_OBJ_RELEASE_SKILL",e.FIGHT_CHANGE_ALL_MODEL="FIGHT_CHANGE_ALL_MODEL",e.FIGHT_SHOW_RESULT="FIGHT_SHOW_RESULT",e.FIGHT_TEAM_RECORD_PLAYBACK="FIGHT_TEAM_RECORD_PLAYBACK",e.WORLD_KING_GET_DATA="WORLD_KING_GET_DATA",e.WORLD_KING_ENTER_MODULE="WORLD_KING_ENTER_MODULE",e.BACKPACK_UPDATE="BACKPACK_UPDATE",e.BACKPACK_MULTI_TEAM_UPDATE="BACKPACK_MULTI_TEAM_UPDATE",e.ACTIVITY_OPEN_BY_ENUM="ACTIVITY_OPEN_BY_ENUM",e.ACTIVITY_LIST_UPDATED="ACTIVITY_LIST_UPDATED",e.ACTIVITY_SHOW_TRIGGER="ACTIVITY_SHOW_TRIGGER",e.ACTIVITY_ADD_TRIGGER="ACTIVITY_ADD_TRIGGER",e.ACTIVITY_BASIC_HERO_GIFG_UPDATE="ACTIVITY_SHOW_BASIC_HERO_GIFG",e.ACTIVITY_MID_ALLGIFT_UPDATE="ACTIVITY_MID_ALLGIFT_UPDATE",e.ACTIVITY_BRAVEBOOKSHOP="ACTIVITY_BRAVEBOOKSHOP",e.BRAVEBOOK_LEVEL_UPDATE="BRAVEBOOK_LEVEL_UPDATE",e.NEWBRAVEBOOK_LEVEL_UPDATE="NEWBRAVEBOOK_LEVEL_UPDATE",e.RECHARGE_OPEN="RECHARGE_OPEN",e.RECHARGE_GET_DATA="RECHARGE_GET_DATA",e.SHOP_GET_ALL_DATA="SHOP_GET_ALL_DATA",e.SHOP_OPEN_BY_TYPE="SHOP_OPEN_BY_TYPE",e.SHOP_INFO_UPDATE="SHOP_INFO_UPDATE",e.GUIDE_INFO_UPDATE="GUIDE_INFO_UPDATE",e.GUIDE_KEY_BTN_CLICK="GUIDE_KEY_BTN_CLICK",e.GUIDE_KEY_BTN_CLICK_2="GUIDE_KEY_BTN_CLICK_2",e.GUIDE_MAKE_FLOW="GUIDE_INIT_FLOW",e.GUIDE_CHECK_CUR_STEP="GUIDE_CHECK_CUR",e.GUIDE_VIEW_STACK_CHANGE="GUIDE_VIEW_STACK_CHANGE",e.GUIDE_NET_RESP="GUIDE_NET_RESP",e.GUIDE_UPDATE_MASK_AND_SCREEN_CONFIG="GUIDE_UPDATE_MASK_AND_SCREEN_CONFIG",e.GUIDE_UPDATE_TIPS_CONFIG="GUIDE_UPDATE_TIPS_CONFIG",e.GUIDE_STEP_UPDATE="GUIDE_GO",e.GUIDE_SWITCH_EDITOR="GUIDE_SWITCH_EDITOR",e.GUIDE_MARK_TAKS_DONE="GUIDE_MARK_TAKS_DONE",e.GUIDE_EDIT_RESET="GUIDE_EDIT_RESET",e.GUIDE_SE_POP_JINHUA_WIN="GUIDE_SE_POP_JINHUA_WIN",e.GUIDE_SE_FAKE_EVO_MY_PKM="GUIDE_SE_FAKE_EVO_MY_PKM",e.GUIDE_SE_DRAG_FORMATION="GUIDE_SE_DRAG_FORMATION",e.GUIDE_SE_DRAG_FORMATION_2="GUIDE_SE_DRAG_FORMATION_2",e.GUIDE_SE_FIGHT_TURN_BLACK="GUIDE_SE_FIGHT_TURN_BLACK",e.GUIDE_SE_FIGHT_TURN_BLACK_REVERT="GUIDE_SE_FIGHT_TURN_BLACK_REVERT",e.GUIDE_SWITCH_SHOWING_GUIDE="GUIDE_SWITCH_SHOWING_GUIDE",e.GUIDE_FIRST_CHARPTER_END="GUIDE_FIRST_CHARPTER_END",e.TASK_GET_REWARDS_POP_CLOSE="TASK_GET_REWARDS_POP_CLOSE",e.TASK_OPEN_MAIN="TASK_OPEN_MAIN",e.TASK_DAILY_UPDATE="TASK_DAILY_UPDATE",e.TASK_UPDATE="TASK_GUIDE_UPDATE",e.UNLOCK_TASK_GET_DATA="UNLOCK_TASK_GET_DATA",e.UNLOCK_TASK_UPDATE="UNLOCK_TASK_UPDATE",e.RANK_OPEN_MAIN="RANK_OPEN_MAIN",e.GUILD_FIRST_INFO_UPDATE="GUILD_FIRST_INFO_UPDATE",e.GUILD_GUILD_RANKED_LIST_UPDATE="GUILD_GUILD_RANKED_LIST_UPDATE",e.GUILD_GUILD_MEMBER_LIST_UPDATE="GUILD_GUILD_MEMBER_LIST_UPDATE",e.GUILD_GUILD_APPLY_LIST_UPDATE="GUILD_GUILD_APPLY_LIST_UPDATE",e.GUILD_INFO_UPDATE="GUILD_INFO_UPDATE",e.GUILD_INBREAK_GET_DATA="GUILD_INBREAK_GET_DATA",e.GUILD_INSTANCE_OPEN="GUILD_INSTANCE_OPEN",e.GUILD_INSTANCE_UPDATE="GUILD_INSTANCE_UPDATE",e.GUILD_COLLECT_INFO_UPDATE="GUILD_COLLECT_INFO_UPDATE",e.GUILD_BOSS_UPDATE_MAP="GUILD_BOSS_UPDATE_MAP",e.GUAJI_HIDE_ALL_SUBVIEW="GUAJI_HIDE_ALL_SUBVIEW",e.GUAJI_ON_ME_WALK_TO="GUAJI_ON_ME_WALK_TO",e.GUAJI_ON_ME_STOP_ON="GUAJI_ON_ME_STOP_ON",e.GUAJI_LAYER_INFO_UPDATE="GUAJI_LAYER_INFO_UPDATE",e.GUAJI_LAYER_INFO_TIPS_UPDATE="GUAJI_LAYER_INFO_TIPS_UPDATE",e.GUAJI_LAYER_EVENT_INFO_UPDATE="GUAJI_LAYER_EVENT_INFO_UPDATE",e.GUAJI_PRETEND_CLICK_TILED="GUAJI_PRETEND_CLICK_TILED",e.GUAJI_RESET_CAMERA="GUAJI_RESET_CAMERA",e.GUAJI_MAP_SCALE="GUAJI_MAP_SCALE",e.GUAJI_MAP_INIT_ALL_DONE="GUAJI_MAP_INIT_ALL_DONE",e.GUAJI_GOLD_REFRESH="GUAJI_GOLD_REFRESH",e.GUAJI_OPEN_CBT="GUAJI_OPEN_CBT",e.GUAJI_FINGER_TO_XY="GUAJI_FINGER_TO_XY",e.GUAJI_ENTER_EP="GUAJI_ENTER_EP",e.GUAJI_ENTER_LAYER="GUAJI_ENTER_LAYER",e.GUAJI_FINGER_APPEAR_TO_XY="GUAJI_FINGER_APPEAR_TO_XY",e.GUAJI_UPDATE_MINE="GUAJI_UPDATE_MINE",e.GUAJI_HUDONG_WITH_EP="GUAJI_HUDONG_WITH_EP",e.GUAJI_SHOW_ME_PATH_TO_POS="GUAJI_SHOW_ME_PATH_TO_POS",e.GUAJI_MAP_ON_TOUCH_TILE_POS="GUAJI_MAP_ON_TOUCH_TILE_POS",e.GUAJI_UPDATE_RES_NOTICE="GUAJI_UPDATE_RES_NOTICE",e.GUAJI_MAP_BACKPACK_UPDATE="GUAJI_MAP_BACKPACK_UPDATE",e.GUAJI_DEMON_UPDATE="GUAJI_DEMON_UPDATE",e.GUAJI_MULTI_GUAJI_ROOM_UPDATE="GUAJI_MULTI_GUAJI_ROOM_UPDATE",e.MANOR_FORCE_EXIT="MANOR_FORCE_EXIT",e.MANOR_ALL_PLAYER_UPDATE="MANOR_ALL_PLAYER_UPDATE",e.MANOR_ALL_MANOR_UPDATE="MANOR_ALL_MANOR_UPDATE",e.MANOR_DETAIL_UPDATE="MANOR_DETAIL_UPDATE",e.MANOR_REQUIRE_DETAIL="MANOR_REQUIRE_DETAIL",e.MANOR_RECORD_UPDATE="MANOR_RECORD_UPDATE",e.MANOR_WALKNUM_UPDATE="MANOR_WALKNUM_UPDATE",e.MANOR_BLOODNUM_UPDATE="MANOR_BLOODNUM_UPDATE",e.MANOR_GET_AWARD="MANOR_GET_AWARD",e.MANOR_OPEN_MINI_MAP="MANOR_OPEN_MINI_MAP",e.MANOR_CHOICE_MINI_MAP_POINT="MANOR_CHOICE_MINI_MAP_POINT",e.MANOR_PLAYER_PROXY_INFO_UPDATE="MANOR_PLAYER_PROXY_INFO_UPDATE",e.MANOR_AUTO_CAPTURE_UPDATE="MANOR_AUTO_CAPTURE_UPDATE",e.MANOR_COLLECT_REWARD_SHOW="MANOR_COLLECT_REWARD_SHOW",e.MANOR_COLLECT_SETTING_UPDATE="MANOR_COLLECT_SETTING_UPDATE",e.MANOR_REMOVE_ONE_MANOR="MANOR_REMOVE_ONE_MANOR",e.MANOR_REMOVE_ONE_PLAYER="MANOR_REMOVE_ONE_PLAYER",e.MANOR_CAPTURE_SUCCESS="MANOR_CAPTURE_SUCCESS",e.MANOR_UPDATE_RANKS="MANOR_UPDATE_RANKS",e.ME_MOVE_FINISH="ME_MOVE_FINISH",e.ME_MOVE_ONE_TILE="ME_MOVE_ONE_TILE",e.DEEP_NEST_UPDATEMAIN="DEEP_NEST_UPDATEMAIN",e.DEEP_NEST_UPDATEHERO="DEEP_NEST_UPDATEHERO",e.DEEP_NEST_UPDATEPETANDART="DEEP_NEST_UPDATEPETANDART",e.DEEP_NEST_UPDATEREWARD="DEEP_NEST_UPDATEREWARD",e.DEEP_NEST_UPDATECOUNT="DEEP_NEST_UPDATECOUNT",e.DEEP_NEST_SETPOSBYWAIGUA="DEEP_NEST_SETPOSBYWAIGUA",e.HERO_SPIRIT_UPDATEMAIN="HERO_SPIRIT_UPDATEMAIN",e.FASHION_UPDATEMAIN="FASHION_UPDATEMAIN",e.SKILL_UPDATE="SKILL_UPDATE",e.SKILL_CHOOSE_CLEAN="SKILL_CHOOSE_CLEAN",e.MOUNT_UPDATEMAIN="MOUNT_UPDATEMAIN",e.MOUNT_UPDATESTAR="MOUNT_UPDATESTAR",e.HERO_UPDATE="HERO_UPDATE",e.HERO_EQUIP_UPDATE="HERO_EQUIP_UPDATE",e.HERO_ARTIFACT_UPDATE="HERO_ARTIFACT_UPDATE",e.HERO_IMMORTAL_UPDATE="HERO_IMMORTAL_UPDATE",e.HERO_DERMA_UPDATE="HERO_DERMA_UPDATE",e.HERO_GACHA_UPDATE="HERO_GACHA_UPDATE",e.ARENA_UPDATE_INFO="ARENA_UPDATE_INFO",e.ARENA_UPDATE_OPPONENT="ARENA_UPDATE_OPPONENT",e.TEAM_ARENA_UPDATE_INFO="TEAM_ARENA_UPDATE_INFO",e.TEAM_ARENA_UPDATE_TEAM_INFO="TEAM_ARENA_UPDATE_TEAM_INFO",e.TEAM_ARENA_UPDATE_GROUP_INFO="TEAM_ARENA_UPDATE_GROUP_INFO",e.TEAMEXPE_UPDATE_INFO="TEAMEXPE_UPDATE_INFO",e.TEAMEXPE_UPDATE_MAP="TEAMEXPE_UPDATE_MAP",e.TEAMEXPE_UPDATE_TEAM_INFO="TEAMEXPE_UPDATE_TEAM_INFO",e.TEAMEXPE_JUMP_TO_CHAPTER="TEAMEXPE_JUMP_TO_CHAPTER",e.TEAMEXPE_OPEN_GATE="TEAMEXPE_OPEN_GATE",e.UPDATE_APPLYRECORDS="UPDATE_APPLYRECORDS,",e.TEAMBOSS_UPDATE_INFO="TEAMBOSS_UPDATE_INFO",e.TEAMBOSS_UPDATE_TEAM_INFO="TEAMBOSS_UPDATE_TEAM_INFO",e.TEAMBOSS_UPDATE_APPLYRECORDS="TEAMBOSS_UPDATE_APPLYRECORDS",e.CHAMPION_UPDATE_INFO="CHAMPION_UPDATE_INFO",e.HEROCOMMENT_UPDATE="HEROCOMMENT_UPDATE",e.MAGICCOMMENT_UPDATE="MAGICCOMMENT_UPDATE",e.WORLD_BOSS_UPDATE_MAP="WORLD_BOSS_UPDATE_MAP",e.MARKET_MARKET_INFO_UPDATED="MARKET_MARKET_INFO_UPDATED",e.MARKET_SELL_INFO_UPDATED="MARKET_SELL_INFO_UPDATED",e.MARKET_LIKED_INFO_UPDATED="MARKET_LIKED_INFO_UPDATED",e.MONEY_UPDATE="MONEY_UPDATE",e.REWARD_CLOSE="REWARD_CLOSE",e.FIGHT_RESULT_CLOSE="FIGHT_RESULT_CLOSE",e.SHOW_WECHAT_SHARE="WECHAT_SHARE",e.ADD_WECHAT_SHARE_INFO="ADD_WECHAT_SHARE_INFO",e.ZZQ_UPDATE_ROOM_INFO="ZZQ_UPDATE_ROOM_INFO",e.ZZQ_UPDATE_HERO_INFO="ZZQ_UPDATE_HERO_INFO",e.ZZQ_UPDATE_CARD_INFO="ZZQ_UPDATE_CARD_INFO",e.ZZQ_UPDATE_CUR_PLAYER="ZZQ_UPDATE_CUR_PLAYER",e.ZZQ_UPDATE_BARRAGE="ZZQ_UPDATE_BARRAGE",e.ZZQ_UPDATE_REWARD_INFO="ZZQ_UPDATE_REWARD_INFO",e.ZZQ_UPDATE_REWARDCUP_INFO="ZZQ_UPDATE_REWARDCUP_INFO",e.ZZQ_STATUS_FIGHT_DAOJISHI="ZZQ_STATUS_FIGHT_DAOJISHI",e.ZZQ_STATUS_FIGHT_END="ZZQ_STATUS_FIGHT_END",e.ZZQ_STATUS_QUIT="ZZQ_STATUS_QUIT",e.DUNGEON_UPDATE_HEROLIST="DUNGEON_UPDATE_HEROLIST",e.DUNGEON_UPDATE_HEROLIST_EFFECT="DUNGEON_UPDATE_HEROLIST_EFFECT",e.DUNGEON_RANDOM_EVENT_ADDLIFE="DUNGEON_RANDOM_EVENT_ADDLIFE",e.DUNGEON_RANDOM_EVENT_MINUSLIFE="DUNGEON_RANDOM_EVENT_MINUSLIFE",e.DUNGEON_RANDOM_EVENT_MINUSLIFE_TEXT="DUNGEON_RANDOM_EVENT_MINUSLIFE_TEXT",e.DUNGEON_RANDOM_EVENT_MINUSGOLD="DUNGEON_RANDOM_EVENT_MINUSGOLD",e.DUNGEON_RANDOM_EVENT_ADDGOLD="DUNGEON_RANDOM_EVENT_ADDGOLD",e.DUNGEON_RANDOM_EVENT_GETHERO="DUNGEON_RANDOM_EVENT_GETHERO",e.DUNGEON_UPDATE_ONE_HERO="DUNGEON_UPDATE_ONE_HERO",e.DUNGEON_USE_ITEM="DUNGEON_USE_ITEM",e.DUNGEON_BOSS_CLEAR="DUNGEON_BOSS_CLEAR",e.DUNGEON_NEW_CHAPTER="DUNGEON_NEW_CHAPTER",e.STORM_WAR_UPDATE_LAYER="STORM_WAR_UPDATE_LAYER",e.STORM_WAR_UPDATE_CREEPS="STORM_WAR_UPDATE_CREEPS",e.STORM_WAR_UPDATE_PLAYERS="STORM_WAR_UPDATE_PLAYERS",e.STORM_WAR_UPDATE_SELF_PLAYER="STORM_WAR_UPDATE_SELF_PLAYER",e.STORM_WAR_UPDATE_WAR="STORM_WAR_UPDATE_WAR",e.STORM_WAR_REMOVE_PLAYER="STORM_WAR_REMOVE_PLAYER",e.STORM_WAR_REMOVE_CREEP="STORM_WAR_REMOVE_CREEP",e.STORM_WAR_FORCE_EXIT="STORM_WAR_FORCE_EXIT",e.STORM_WAR_UPDATE_RANKS="STORM_WAR_UPDATE_RANK",e.STORM_WAR_BATTLE_FINISH="STORM_WAR_BATTLE_FINISH",e.TRIBE_BATTLE_INFO_UPDATED="TRIBE_BATTLE_INFO_UPDATED",e.TRIBE_BATTLE_REVENGE_UPDATED="TRIBE_BATTLE_REVENGE_UPDATED",e.PEAK_WAR_FREE_INFO_UPDATED="PEAK_WAR_FREE_INFO_UPDATED",e.PEAK_WAR_HIGH_INFO_UPDATED="PEAK_WAR_HIGH_INFO_UPDATED",e.TITLE_UPDATE="TITLE_UPDATE",e.GUILDFARM_FARM_LAND_UPDATE="GUILDFARM_FARM_LAND_UPDATE",e.GUILDFARM_FARM_BUILDING_UPDATE="GUILDFARM_FARM_BUILDING_UPDATE",e.GUILDFARM_FARM_SKILL_UPDATE="GUILDFARM_FARM_SKILL_UPDATE",e.GUILDFARM_FARM_GOLD_UPDATE="GUILDFARM_FARM_GOLD_UPDATE",e.STOCK_INFO_UPDATE="STOCK_INFO_UPDATE",e.STOCK_DETAIL_INFO_UPDATE="STOCK_DETAIL_INFO_UPDATE",e.HOLDEM_UPDATE_ROOM_INFO="HOLDEM_UPDATE_ROOM_INFO",e.HOLDEM_UPDATE_HERO_INFO="HOLDEM_UPDATE_HERO_INFO",e.HOLDEM_UPDATE_BARRAGE="HOLDEM_UPDATE_BARRAGE",e.HOLDEM_STATUS_FIGHT_END="HOLDEM_STATUS_FIGHT_END",e.HOLDEM_STATUS_QUIT="HOLDEM_STATUS_QUIT",e}();__reflect(CN.prototype,"CN"),function(i){var o,e=(__extends(t,o=BasePanel),t.prototype.childrenCreated=function(){o.prototype.childrenCreated.call(this),this.initList(),this.activateComponent(),this.params&&this.updateView(this.params)},t.prototype.initList=function(){this.ac_list=new eui.ArrayCollection,this.list_item.dataProvider=this.ac_list,this.list_item.itemRenderer=a},t.prototype.updateView=function(e){var o=this;this.params=e||this.params;var n=this.params.source===BASEITEM_SOURCE.BACKPACK;n||(this.btn_cancel.visible=!1,this.btn_confirm.visible=!0,this.btn_confirm.horizontalCenter=0,this.scl.y=this.list_item.y=100);var t=i.Config.itemConfig()[this.params.code],a=[];JSON.parse(t.effect).forEach(function(e,t){var i={id:e[1],reward:e,selected:!n&&void 0,chooseCb:function(){o.updateSelected(e[1])}};a.push(i)}),this.ac_list.replaceAll(a),3<a.length&&(this.scl.viewport=this.list_item)},t.prototype.updateSelected=function(e){var t=this;this.selectedId===e?this.selectedId=void 0:this.selectedId=e,this.ac_list.source.forEach(function(e){e.selected=e.id===t.selectedId}),this.ac_list.replaceAll(this.ac_list.source)},t.prototype.activateComponent=function(){var e=this;Utils.ComponentUtils.registerListener(this.btn_cancel,egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this),Utils.ComponentUtils.registerListener(this.btn_confirm,egret.TouchEvent.TOUCH_TAP,function(){e.params.source===BASEITEM_SOURCE.BACKPACK?e.selectedId?e.bpProxy.UseProp(e.params.code,1,e.selectedId,!0,"",function(){e.hide()}):Utils.MsgUtils.addMidMsg("请选择一份奖励"):e.hide()},this)},t);function t(e){var t=o.call(this)||this;return t.bpProxy=i.GameMVC.backpackPy,t.skinName="BaseItemChoseViewSkin",t.params=e,t}i.BaseItemChoseView=e,__reflect(e.prototype,"game.BaseItemChoseView");var n,a=(n=eui.ItemRenderer,__extends(r,n),r.prototype.childrenCreated=function(){var e=this;n.prototype.childrenCreated.call(this),this.baseItem=customui.BaseItemFactory.create(11),this.gp_baseitem.addChild(this.baseItem),Utils.ComponentUtils.registerListener(this.checkBox,egret.TouchEvent.TOUCH_TAP,function(){e.data.chooseCb&&e.data.chooseCb()},this)},r.prototype.dataChanged=function(){this.baseItem.updateData({reward:this.data.reward}),null!=this.data.selected?(this.checkBox.visible=!0,this.checkBox.selected=this.data.selected):this.checkBox.visible=!1},r);function r(){var e=n.call(this)||this;return e.playerProxy=i.GameMVC.playerPy,e.skinName="BaseItemChoseView_ChoseItem",e}i.BaseItemChoseView_ChoseItem=a,__reflect(a.prototype,"game.BaseItemChoseView_ChoseItem")}(game=game||{}),function(o){var i,n=(i=o.BaseVO,__extends(e,i),e);function e(e){var t=i.call(this)||this;return t.playerId=e.playerId,t.playerName=e.playerName,t.area=e.area,t.serverName=e.serverName,t.avatar=e.avatar,t.level=e.level,t}o.SChatEntity=n,__reflect(n.prototype,"game.SChatEntity");var a,t=(a=o.BaseVO,__extends(r,a),r);function r(e){var t=a.call(this)||this;return t.hasInit=!1,t.level=e.level,t.priority=e.priority,t.isTextFlow=e.isTextFlow,t.msgId=e.msgId,t.channelType=e.channelType,t.sendDt=e.sendDt,t.content=e.content,t.ShowType=e.ShowType,t.ShowChannel=e.ShowChannel,t.SystemMsgType=e.SystemMsgType,t.params=e.params,e.fromPlayer&&(t.fromPlayer=new n(e.fromPlayer)),e.toPlayer&&(t.toPlayer=new n(e.toPlayer)),t}o.SChatMsg=t,__reflect(t.prototype,"game.SChatMsg");var s,c=(s=o.BaseVO,__extends(l,s),l);function l(e){var t=s.call(this)||this;return t.id=e.id,t.type=e.type,t.effect=e.effect,t}o.VictoryCell=c,__reflect(c.prototype,"game.VictoryCell");var h,p=(h=o.BaseVO,__extends(d,h),d);function d(e){var t=h.call(this)||this;return t.layer=e.layer,t.vit=e.vit,t.buffs=e.buffs,t.buyCount=e.buyCount,t.rewardGot=e.rewardGot,e.cells&&(t.cells=new Array,e.cells.forEach(function(e){t.cells.push(new c(e))})),t}o.VictoryInfo=p,__reflect(p.prototype,"game.VictoryInfo");var u,g=(u=o.BaseVO,__extends(f,u),f);function f(e){var t=u.call(this)||this;return t.id=e.id,t.beginRewardTime=e.beginRewardTime,t.winTime=e.winTime,t.level=e.level,t.rLevel=e.rLevel,t}o.ExploredInfo=g,__reflect(g.prototype,"game.ExploredInfo");var _,m=(_=o.BaseVO,__extends(y,_),y.prototype.update=function(e){this.count=e.count,this.buyCount=e.buyCount,this.lRCD=e.lRCD},y);function y(){return _.call(this)||this}o.ChallengeInfo=m,__reflect(m.prototype,"game.ChallengeInfo");var v,T=(v=o.BaseVO,__extends(C,v),C.prototype.update=function(e){e.rank&&(this.rank=e.rank),e.hRank&&(this.hRank=e.hRank),e.hRankTargeted&&(this.hRankTargeted=e.hRankTargeted),this.challengeInfo||(this.challengeInfo=new m),e.challengeInfo&&this.challengeInfo.update(e.challengeInfo),NoticeManager.updateNotice(NT.ARENA_REWARD_LINQU,void 0,!0)},C);function C(e){var t=v.call(this)||this;return e&&t.update(e),t}o.ArenaInfo=T,__reflect(T.prototype,"game.ArenaInfo");var E,I=(E=o.BaseVO,__extends(b,E),b);function b(e){var t=E.call(this)||this;return t.playerId=e.playerId,t.battleDt=e.battleDt,t.result=e.result,t.pKey=e.pKey,t.rKey=e.rKey,t.tPKey=e.tPKey,t.tRKey=e.tRKey,t.battleUuid=e.battleUuid,t.challengerId=e.challengerId,t.baseInfo=new Pe(e.baseInfo),t}o.BattleRecord=I,__reflect(I.prototype,"game.BattleRecord");var A,P=(A=o.BaseVO,__extends(M,A),M);function M(e){var t=A.call(this)||this;return t.challengerId=e.challengerId,t.beChallengerId=e.beChallengerId,t.battleDt=e.battleDt,t.result=e.result,t.battleUuid=e.battleUuid,t.cHeroList=e.cHeroList,t.bHeroList=e.bHeroList,t}o.BattleMemberRecord=P,__reflect(P.prototype,"game.BattleMemberRecord");var N,S=(N=o.BaseVO,__extends(k,N),k);function k(e){var t=N.call(this)||this;return t.teamId=e.teamId,t.battleDt=e.battleDt,t.result=e.result,t.pKey=e.pKey,t.rKey=e.rKey,t.battleUuids=e.battleUuids,t.challengerTeamId=e.challengerTeamId,t.memberRecords=e.memberRecords,t.team=new o.TeamVO(e.team),t.team.members.forEach(function(e){t.fightCap+=e.baseInfo.fightCap}),t}o.TeamBattleRecord=S,__reflect(S.prototype,"game.TeamBattleRecord");var U,L=(U=o.BaseVO,__extends(O,U),O);function O(e){var t=U.call(this)||this;return t.playerId=e.playerId,t.name=e.name,t.level=e.level,t.vLevel=e.vLevel,t.fightCap=e.fightCap,t.rank=e.rank,t.camp=e.camp,t.avatar=e.avatar,t.serverId=e.serverId,t}o.ArenaPlayerInfo=L,__reflect(L.prototype,"game.ArenaPlayerInfo");var w,x=(w=o.BaseVO,__extends(R,w),Object.defineProperty(R.prototype,"memberNum",{get:function(){return this.team.members.length},enumerable:!0,configurable:!0}),R.prototype.update=function(e){e?(this.rank=e.rank,this.score=e.score,this.enrolled=e.enrolled,this.ballot=e.ballot,this.winNum=e.winNum,this.loseNum=e.loseNum,this.team.update(e.team)):(this.rank=0,this.score=0,this.enrolled=!1,this.ballot=0,this.winNum=0,this.loseNum=0,this.team.update())},R.makeFakeData=function(){var e=new R;return e.rank=0,e.score=0,e.team=o.TeamVO.makeFakeData(),e.enrolled=!0,e.ballot=Utils.MathUtils.getRandomInt(0,100),e},R);function R(e){var t=w.call(this)||this;return t.team=new o.TeamVO(e),e&&t.update(e),t}o.TATeamInfoVO=x,__reflect(x.prototype,"game.TATeamInfoVO");var B,D=(B=o.BaseVO,__extends(V,B),V.prototype.update=function(e){this.teamInfo.update(e.teamInfo),this.voteTeamId=e.voteTeamId},V);function V(e){var t=B.call(this)||this;return t.teamInfo=new x,e&&t.update(e),t}o.TeamArenaInfoVO=D,__reflect(D.prototype,"game.TeamArenaInfoVO");var H,G=(H=o.BaseVO,__extends(F,H),F.prototype.update=function(e){var t=this;this.teams.splice(0),e.teams.forEach(function(e){t.teams.push(new x(e))}),this.ballot=e.ballot},F.makeFakeData=function(e){var t=new F;t.id=Utils.DebugUtils.getFakePlayerId(),e=e||4;for(var i=0;i<e;i++){var o=x.makeFakeData();t.teams.push(o)}return t.ballot=0,t.teams.forEach(function(e){t.ballot+=e.ballot}),t},F);function F(e){var t=H.call(this)||this;return t.teams=[],e&&t.update(e),t}o.TeamArenaGroupVO=G,__reflect(G.prototype,"game.TeamArenaGroupVO");var W,j=(W=o.BaseVO,__extends(Y,W),Y.prototype.update=function(e){e?(this.sectionId=e.sectionId,this.team.update(e.team)):(this.sectionId=0,this.team.update())},Y);function Y(e){var t=W.call(this)||this;return t.team=new o.TeamVO(e),e&&t.update(e),t}o.TETeamInfoVO=j,__reflect(j.prototype,"game.TETeamInfoVO");var z,q=(z=o.BaseVO,__extends(K,z),K.prototype.update=function(e){this.sectionId=e.sectionId,this.num=e.num},K);function K(e){var t=z.call(this)||this;return e&&t.update(e),t}o.TeamExpeChallengeInfoVO=q,__reflect(q.prototype,"game.TeamExpeChallengeInfoVO");var J,X=(J=o.BaseVO,__extends(Z,J),Z.prototype.update=function(e){this.sectionId=e.sectionId,this.helpTime=e.helpTime,this.targeted=e.targeted,this.teamInfo.update(e.teamInfo),NoticeManager.updateNotice(NT.TEAM_EXPE_REWARD)},Z);function Z(e){var t=J.call(this)||this;return t.teamInfo=new j,t.challengeList=new Array,t.targeted=new Array,e&&t.update(e),t}o.TeamExpeInfoVO=X,__reflect(X.prototype,"game.TeamExpeInfoVO");var Q,$=(Q=o.BaseVO,__extends(ee,Q),ee.prototype.update=function(e){this.sectionId=e.sectionId,this.helpTime=e.helpTime,this.teamInfo.update(e.teamInfo)},ee);function ee(e){var t=Q.call(this)||this;return t.teamInfo=new j,e&&t.update(e),t}o.TeamBossInfoVO=$,__reflect($.prototype,"game.TeamBossInfoVO");var te,ie=(te=o.BaseVO,__extends(oe,te),oe.prototype.update=function(e){this.rank=e.rank,this.key=e.key,this.playerBaseInfo.update(e.playerBaseInfo),this.guildBaseInfo.update(e.guildBaseInfo),this.additionInfo=e.additionInfo},oe);function oe(e){var t=te.call(this)||this;return t.playerBaseInfo=new o.PlayerInfoVO,t.guildBaseInfo=new o.GuildVO,e&&t.update(e),t}o.CommonRankItemVO=ie,__reflect(ie.prototype,"game.CommonRankItemVO");var ne,ae=(ne=o.BaseVO,__extends(re,ne),re.prototype.update=function(e){this.rank=e.rank,this.key=e.key,this.team=e.team},re);function re(e){var t=ne.call(this)||this;return e&&t.update(e),t}o.TeamCommonRankItemVO=ae,__reflect(ae.prototype,"game.TeamCommonRankItemVO");var se,ce=(se=o.BaseVO,__extends(le,se),le);function le(e){var t=se.call(this)||this;return t.rank=e.rank,t.guildLevel=e.guildLevel,t.presidentId=e.presidentId,t.presidentName=e.presidentName,t.guildFightCap=e.guildFightCap,t.guildAvatar=e.guildAvatar,t.guildName=e.guildName,t.key=e.key,t.vLevel=e.vLevel,t}o.GuildRankItem=ce,__reflect(ce.prototype,"game.GuildRankItem");var he,pe=(he=o.BaseVO,__extends(de,he),de.prototype.update=function(e){this.playerId=e.playerId,this.name=e.name,this.level=e.level,this.avatar=e.avatar,this.serverId=e.serverId,this.serverName=e.serverName,this.num=e.num,this.dt=e.dt,this.fightCap=e.fightCap,this.isShareGotten=e.isShareGotten,this.extraData=e.extraData},de);function de(e){var t=he.call(this)||this;return t.playerId=e.playerId,t.name=e.name,t.level=e.level,t.avatar=e.avatar,t.serverId=e.serverId,t.serverName=e.serverName,t.num=e.num,t.dt=e.dt,t.fightCap=e.fightCap,t.isShareGotten=e.isShareGotten,t.extraData=e.extraData,t}o.RelationInfoVO=pe,__reflect(pe.prototype,"game.RelationInfoVO");var ue,ge=(ue=o.BaseVO,__extends(fe,ue),fe);function fe(e){var t=ue.call(this)||this;return t.playerId=e.playerId,t.num=e.num,t.uuid=e.uuid,t}o.RelationRedBagInfoVO=ge,__reflect(ge.prototype,"game.RelationRedBagInfoVO");var _e,me=(_e=o.BaseVO,__extends(ye,_e),ye.prototype.update=function(e){this.id=e.id,this.num=e.num},ye);function ye(){return _e.call(this)||this}o.ChampionAchievementInfoVO=me,__reflect(me.prototype,"game.ChampionAchievementInfoVO");var ve,Te=(ve=o.BaseVO,__extends(Ce,ve),Ce.prototype.update=function(e){this.count=e.count,this.buyCount=e.buyCount,this.lRCD=e.lRCD,this.requestCount=e.requestCount,this.helpCount=e.helpCount},Ce);function Ce(){return ve.call(this)||this}o.ChallengeInfoVO=Te,__reflect(Te.prototype,"game.ChallengeInfoVO");var Ee,Ie=(Ee=o.BaseVO,__extends(be,Ee),be.prototype.update=function(e){var i=this;o.Config.champion()[e.id]?(this.id=e.id,this.allPassed=!1):(this.id=e.id-1,this.allPassed=!0),Array.isArray(e.targeted)&&e.targeted.forEach(function(e,t){i.targeted[t]||(i.targeted[t]=new me),i.targeted[t].update(e)}),this.mopUpNum=e.mopUpNum,this.lastMopUpDt=e.lastMopUpDt,this.num=e.num,this.canMopUp=e.canMopUp,this.curNum=e.curNum,this.challengeInfo.update(e.challengeInfo),NoticeManager.updateNotice(NT.CHAMPION)},be);function be(){var e=Ee.call(this)||this;return e.challengeInfo=new Te,e.targeted=[],e}o.ChampionInfoVO=Ie,__reflect(Ie.prototype,"game.ChampionInfoVO");var Ae,Pe=(Ae=o.BaseVO,__extends(Me,Ae),Me.prototype.update=function(e){this.playerId=e.playerId,this.name=e.name,this.rank=e.rank,this.fightCap=e.fightCap,this.avatar=e.avatar,this.frame=e.frame,this.guild=e.guild,this.level=e.level,this.vipLevel=e.vipLevel,this.serverId=e.serverId,this.serverName=e.serverName,this.offlineTime=e.offlineTime,this.fashionCode=e.fashionCode,this.titleCode=e.titleCode,this.horseCode=e.horseCode,this.magicalCode=e.magicalCode},Me.prototype.reset=function(){this.playerId=void 0,this.name=void 0,this.rank=void 0,this.fightCap=void 0,this.avatar=void 0,this.frame=void 0,this.guild=void 0,this.level=void 0,this.vipLevel=void 0,this.serverId=void 0,this.serverName=void 0,this.offlineTime=void 0},Me.makeFakeData=function(){var e=new Me;return e.playerId=Utils.DebugUtils.getFakePlayerId(),e.name=Utils.DebugUtils.getFakeName(),e.rank=Utils.DebugUtils.getFakeRank(),e.fightCap=Utils.DebugUtils.getFakeFightCap(),e.avatar=Utils.DebugUtils.getFakeAvatar(),e.frame="",e.guild=Utils.DebugUtils.getFakeGuildName(),e.level=Utils.DebugUtils.getFakeLevel(),e.vipLevel=Utils.DebugUtils.getFakeVipLevel(),e.serverId=Utils.DebugUtils.getFakeServerId(),e.serverName=Utils.DebugUtils.getFakeServerName(),e.offlineTime=Utils.DebugUtils.getFakeOfflineTime(),e},Me);function Me(e){var t=Ae.call(this)||this;return e&&t.update(e),t}o.BaseInfoVO=Pe,__reflect(Pe.prototype,"game.BaseInfoVO");function Ne(){}o.SRewardVO=Ne,__reflect(Ne.prototype,"game.SRewardVO");var Se,ke=(Se=o.BaseVO,__extends(Ue,Se),Ue);function Ue(e){var t=Se.call(this)||this;return t.got=e.got,t.rewards=e.rewards,t}o.SRewardInfoVO=ke,__reflect(ke.prototype,"game.SRewardInfoVO");var Le,Oe=(Le=o.DirtyValueVO,__extends(we,Le),we.prototype.update=function(e){this.x=e.x,this.y=e.y,this.z!=e.z&&(this.isDirty=!0),this.z=e.z},we);function we(e){var t=Le.call(this)||this;return e&&t.update(e),t}o.SCoordinate=Oe,__reflect(Oe.prototype,"game.SCoordinate");var xe,Re=(xe=o.BaseVO,__extends(Be,xe),Be.prototype.update=function(e){this.amILeader=!1,e.playerBaseInfo?this.playerBaseInfo.update(e.playerBaseInfo):this.playerBaseInfo.reset(),e.team?this.team.update(e.team):this.team.reset(),e.coordinate&&this.coordinate.update(e.coordinate)},Be);function Be(e){var t=xe.call(this)||this;return t.coordinate=new Oe,t.playerBaseInfo=new Pe,t.team=new o.TeamVO,e&&t.update(e),t}o.SCoordianteBase=Re,__reflect(Re.prototype,"game.SCoordianteBase")}(game=game||{}),function(e){var i,o=(i=e.BaseVO,__extends(t,i),t.prototype.update=function(e){e&&(this.code=e.code,this.growthNum=e.growthNum,this.qualificationList=JSON.parse(e.qualificationList),this.skillDetailList=JSON.parse(e.skillDetailList),this.ownerName=e.ownerName,this.dt=e.dt,this.requireInfo=e.requireInfo,this.uuid=e.uuid,this.status=e.status)},t);function t(e){var t=i.call(this)||this;return t.update(e),t}e.CourtshipVo=o,__reflect(o.prototype,"game.CourtshipVo");var n,a=(n=e.BaseVO,__extends(r,n),Object.defineProperty(r.prototype,"totalQualification",{get:function(){var t=0;return this.qualificationList.forEach(function(e){t+=e}),t},enumerable:!0,configurable:!0}),r.prototype.update=function(e){e&&(this.growthNum=e.growthNum||0,this.skillNum=e.skillNum||0,this.skills=e.skills?[].concat(e.skills):[],this.qualificationList=e.qualificationList||[0,0,0,0],this.skillNum<this.skills.length&&(this.skillNum=this.skills.length))},r);function r(e){var t=n.call(this)||this;return t.update(e),t}e.CourtshipRequireVo=a,__reflect(a.prototype,"game.CourtshipRequireVo");var s,c=(s=e.BaseVO,__extends(l,s),l.prototype.update=function(e){if(e){for(var t in this.courtshipList=[],e.courtshipList){var i=e.courtshipList[t];this.courtshipList.push(new o(i))}this.dt=e.dt,this.isNewPet=e.isNewPet,this.isSuccess=e.isSuccess}},l);function l(e){var t=s.call(this)||this;return t.update(e),t}e.CourtshipSuccessVo=c,__reflect(c.prototype,"game.CourtshipSuccessVo")}(game=game||{}),function(t){var e=(i.prototype.update=function(e){this.from=e.from,this.to=e.to},i);function i(){}__reflect(e.prototype,"DungeonMapEdge");var o,n=(o=t.BaseVO,__extends(a,o),Object.defineProperty(a.prototype,"fadeType",{get:function(){if(this.eventInfo&&this.eventInfo.actualEventId){var e=t.Config.vestageEventConfig()[this.eventInfo.actualEventId];if(e)return e.type;egret.warn("找不到事件id",this.eventInfo.actualEventId)}},enumerable:!0,configurable:!0}),a.prototype.update=function(e){o.prototype.update.call(this,e),this.id=e.id,this.depth=e.depth,this.status=e.status,this.eventType=e.eventType,this.eventSubType=e.eventSubType,"string"==typeof e.eventInfo?this.eventInfo=e.eventInfo&&JSON.parse(e.eventInfo)||{}:this.eventInfo=e.eventInfo,this.eventId=e.eventId},a);function a(e){var t=o.call(this)||this;return e&&t.update(e),t}t.DungeonPointVO=n,__reflect(n.prototype,"game.DungeonPointVO");var r,s=(r=t.BaseVO,__extends(c,r),c.prototype.update=function(e){var t=this;for(var i in this.uuid=e.uuid,this.code=e.code,this.edges=e.edges,this.genDt=e.genDt,this.curPointId=void 0,this.points)this.points[i].isExpire=!0;for(var i in e.points.forEach(function(e){t.points[e.id]?t.points[e.id].update(e):t.points[e.id]=new n(e),e.status!=VestagePointStatus.UnPassed&&e.status!=VestagePointStatus.Passed&&(t.curPointId=e.id)}),this.points)this.points[i].isExpire&&delete this.points[i]},c);function c(){var e=r.call(this)||this;return e.edges=[],e.points={},e}t.DungeonMapVO=s,__reflect(s.prototype,"game.DungeonMapVO");var l,h=(l=t.BaseVO,__extends(p,l),p.prototype.update=function(e){this.challengeTimes=e.challengeTimes,this.cScore=e.cScore,this.hScore=e.hScore,this.processStatus=e.processStatus,this.isCompleted=e.isCompleted,this.records=e.records&&JSON.parse(e.records)||void 0},p);function p(){return l.call(this)||this}t.DungeonBaseInfoVO=h,__reflect(h.prototype,"game.DungeonBaseInfoVO");var d,u=(d=t.DirtyValueVO,__extends(g,d),g.prototype.update=function(e){d.prototype.update.call(this,e),this.code=e.code,this.count=e.count,this.dt=e.dt},g);function g(e){var t=d.call(this)||this;return e&&t.update(e),t.isDirty=!0,t}t.DungeonSBuffVO=u,__reflect(u.prototype,"game.DungeonSBuffVO");var f,_=(f=t.BaseVO,__extends(m,f),Object.defineProperty(m.prototype,"config",{get:function(){return this._config&&!this.isExpire||(this.isExpire=!1,this._config=t.Config.allHeroConfig()[this.code]),this._config},enumerable:!0,configurable:!0}),m.prototype.update=function(e){this.uuid=e.uuid,this.level=e.level,this.attr=e.attr,this.pos=e.pos,this.starLevel=e.starLevel,this.skillList=e.skillList,this.fightCap=e.fightCap,this.haloAttr=e.haloAttr,this.dermaCode=e.dermaCode,this.anger=e.anger,this.maxAnger=e.maxAnger,this.life=e.life,this.maxLife=e.maxLife,e.code!=this.code&&(this.isExpire=!0),this.code=e.code||this.code},m);function m(e){var t=f.call(this)||this;return t.skillList=[],e&&t.update(e),t}t.DungeonHeroVO=_,__reflect(_.prototype,"game.DungeonHeroVO")}(game=game||{}),function(e){var i,t=(i=e.BaseVO,__extends(o,i),o.prototype.update=function(e){this.targeted=e.targeted,this.sectionId=e.sectionId,this.opponentInfo=e.opponentInfo,this.opponentList=e.opponentList},o);function o(e){var t=i.call(this)||this;return e&&t.update(e),t}e.ExpeditionVO=t,__reflect(t.prototype,"game.ExpeditionVO")}(game=game||{}),function(e){var i,t=(i=e.BaseVO,__extends(o,i),o.prototype.update=function(e){this.uuid=e.uuid,this.level=e.level,this.attr=e.attr,this.pos=e.pos,this.skillList=e.skillList,this.fightCap=e.fightCap,this.code=e.code},o);function o(e){var t=i.call(this)||this;return t.skillList=[],e&&t.update(e),t}e.FashionVO=t,__reflect(t.prototype,"game.FashionVO")}(game=game||{}),function(w){!function(e){var i,c=(i=w.BaseVO,__extends(t,i),t.prototype.update=function(e){this.type=e.type,this.value=e.value},t);function t(e){var t=i.call(this)||this;return e&&t.update(e),t}e.Buff=c,__reflect(c.prototype,"game.FightVO.Buff");var o,n=(o=w.BaseVO,__extends(a,o),a.prototype.update=function(e){this.playerId=e.playerId,this.name=e.name,this.camp=e.camp,this.avatar=e.avatar,this.level=e.level,this.positionType=e.positionType,this.entities.splice(0);for(var t=0,i=e.entities;t<i.length;t++){var o=i[t];this.entities.push(new p(o))}this.magical.update(e.magical)},a);function a(e){var t=o.call(this)||this;return t.entities=new Array,t.magical=new s,e&&t.update(e),t}e.SBattleTeam=n,__reflect(n.prototype,"game.FightVO.SBattleTeam");var r,s=(r=w.BaseVO,__extends(l,r),l.prototype.update=function(e){e&&(this.entityId=e.entityId,this.code=e.code,this.anger=e.anger,this.angerMax=e.angerMax)},l);function l(e){var t=r.call(this)||this;return e&&t.update(e),t}e.SMagicalEntity=s,__reflect(s.prototype,"game.FightVO.SMagicalEntity");var h,p=(h=w.BaseVO,__extends(d,h),d.prototype.update=function(e){this.entityId=e.entityId,this.code=e.code,this.type=e.type,this.life=e.life,this.lifeMax=e.lifeMax,this.anger=e.anger,this.angerMax=e.angerMax,this.level=e.level,this.dermaCode=e.dermaCode},d);function d(e){var t=h.call(this)||this;return e&&t.update(e),t}e.SBattleEntity=p,__reflect(p.prototype,"game.FightVO.SBattleEntity");var u,g=(u=w.BaseVO,__extends(f,u),f.prototype.update=function(e){this.entityId=e.entityId,this.status=e.status,this.value=e.value,this.beSockedBlood=e.beSockedBlood,this.life=e.life,this.anger=e.anger,this.skillId=e.skillId,this.buffAdd.splice(0);for(var t=0,i=e.buffAdd;t<i.length;t++){var o=i[t];this.buffAdd.push(new c(o))}this.buffRemove.splice(0);for(var n=0,a=e.buffRemove;n<a.length;n++)o=a[n],this.buffRemove.push(o)},f);function f(e){var t=u.call(this)||this;return t.buffAdd=new Array,t.buffRemove=new Array,e&&t.update(e),t}e.SBattleRes=g,__reflect(g.prototype,"game.FightVO.SBattleRes");var _,m=(_=w.BaseVO,__extends(y,_),y.prototype.update=function(e){this.effectId=e.effectId,this.sockBlood=e.sockBlood,this.antiInjury=e.antiInjury,this.seqBattleRes.splice(0);for(var t=0,i=e.seqBattleRes;t<i.length;t++){var o=i[t];this.seqBattleRes.push(new g(o))}},y);function y(e){var t=_.call(this)||this;return t.seqBattleRes=new Array,e&&t.update(e),t}e.SBattleEffect=m,__reflect(m.prototype,"game.FightVO.SBattleEffect");var v,T=(v=w.BaseVO,__extends(C,v),C.prototype.update=function(e){this.entityId=e.entityId,this.skillId=e.skillId,this.life=e.life,this.anger=e.anger,this.combo=e.combo,this.p=e.p,this.ext=e.ext,this.buffStatus.splice(0);for(var t=0,i=e.buffStatus;t<i.length;t++){var o=i[t];this.buffStatus.push(new c(o))}this.seqBattleEffect.splice(0);for(var n=0,a=e.seqBattleEffect;n<a.length;n++)o=a[n],this.seqBattleEffect.push(new m(o));this.buffRemove.splice(0);for(var r=0,s=e.buffRemove;r<s.length;r++)o=s[r],this.buffRemove.push(o)},C);function C(e){var t=v.call(this)||this;return t.buffStatus=new Array,t.seqBattleEffect=new Array,t.buffRemove=new Array,e&&t.update(e),t}e.SBattleAttack=T,__reflect(T.prototype,"game.FightVO.SBattleAttack");var E,I=(E=w.BaseVO,__extends(b,E),b.prototype.update=function(e){this.roundNum=e.roundNum,this.seqAttack.splice(0);for(var t=0,i=e.seqAttack;t<i.length;t++){var o=i[t];this.seqAttack.push(new T(o))}this.afterBattleRes.splice(0);for(var n=0,a=e.afterBattleRes;n<a.length;n++)o=a[n],this.afterBattleRes.push(new g(o));this.beforeBattleRes.splice(0);for(var r=0,s=e.beforeBattleRes;r<s.length;r++)o=s[r],this.beforeBattleRes.push(new g(o))},b);function b(e){var t=E.call(this)||this;return t.seqAttack=new Array,t.afterBattleRes=new Array,t.beforeBattleRes=new Array,e&&t.update(e),t}e.SBattleRound=I,__reflect(I.prototype,"game.FightVO.SBattleRound");var A,P=(A=w.BaseVO,__extends(M,A),M.prototype.update=function(e,t){if(void 0===t&&(t=!1),this.rounds.splice(0),e){this.uuid=e.uuid;for(var i=0,o=e.rounds;i<o.length;i++){var n=o[i];this.rounds.push(new I(n))}t&&this.rounds.sort(function(e,t){return e.roundNum-t.roundNum})}else this.uuid=Utils.TimerManager.getServerTime().toString()},M.prototype.pushRounds=function(e){if(e)if(e.uuid==this.uuid&&Array.isArray(e.rounds)){for(var t=0,i=e.rounds;t<i.length;t++){var o=i[t];this.rounds.push(new I(o))}this.rounds.sort(function(e,t){return e.roundNum-t.roundNum})}else egret.warn("拼接战报失败",e.uuid==this.uuid)},M.prototype.reset=function(){this.uuid=void 0,this.rounds.splice(0)},M);function M(e){var t=A.call(this)||this;return t.rounds=new Array,e&&t.update(e),t}e.SBattleInfo=P,__reflect(P.prototype,"game.FightVO.SBattleInfo");var N,S=(N=w.BaseVO,__extends(k,N),k.prototype.update=function(e){this.result=e.result,this.hurt=e.hurt,this.star=e.star,this.battleType=e.battleType,this.clientReward=e.clientReward,this.normalRewards=e.normalRewards,this.extRewards=e.extRewards,this.entityResults=e.entityResults,this.escaped=e.escaped,this.vestageRecords=e.vestageRecords,this.teams.splice(0);for(var t=0,i=e.teams;t<i.length;t++){var o=i[t];this.teams.push(new n(o))}},k);function k(e){var t=N.call(this)||this;return t.teams=new Array,e&&t.update(e),t}e.SBattleResult=S,__reflect(S.prototype,"game.FightVO.SBattleResult");var U,L=(U=w.BaseVO,__extends(O,U),Object.defineProperty(O.prototype,"result",{get:function(){return this.winC>this.totalC/2?EBattleResult.EBattleResultWin:EBattleResult.EBattleResultLose},enumerable:!0,configurable:!0}),O.prototype.sum=function(e){this.totalC+=1,e.result==EBattleResult.EBattleResultWin&&this.winC++,this.battleType=e.battleType,this.hurt+=e.hurt,this.star=Math.floor((this.star+e.star)/this.totalC),e.clientReward&&Array.isArray(e.clientReward.rewards)&&(this.clientReward.rewards=this.clientReward.rewards.concat(e.clientReward.rewards)),this.battleResultEach.push(e)},O.prototype.reset=function(){this.star=0,this.hurt=0,this.totalC=0,this.winC=0,this.clientReward.rewards.splice(0),this.cbRet=void 0,this.battleResultEach.splice(0)},O);function O(){var e=U.call(this)||this;return e.clientReward={rewards:[]},e.battleResultEach=new Array,e.reset(),e}e.SFinalBattleResult=L,__reflect(L.prototype,"game.FightVO.SFinalBattleResult")}(w.FightVO||(w.FightVO={}))}(game=game||{}),function(e){var i,t=(i=e.BaseVO,__extends(o,i),o.prototype.update=function(e){this.fortressId=e.fortressId,this.leftChallenge=e.leftChallenge,this.buyChallenge=e.buyChallenge,this.stages=e.fortressId},o);function o(e){var t=i.call(this)||this;return e&&t.update(e),t}e.DailyFortressVO=t,__reflect(t.prototype,"game.DailyFortressVO")}(game=game||{}),function(e){var i,t=(i=e.BaseVO,__extends(o,i),o.prototype.update=function(e){this.id=e.id||this.id,this.level=e.level||this.level,this.fightCap=e.fightCap||this.fightCap},o);function o(e){var t=i.call(this)||this;return t.id=e.id,t.level=e.level,t.fightCap=e.fightCap,t}e.HandbookType=t,__reflect(t.prototype,"game.HandbookType");var n,a=(n=e.BaseVO,__extends(r,n),r.prototype.update=function(e){this.type=e.type||this.type,this.key=e.key||this.key,this.targeted=e.targeted||this.targeted},r);function r(e){var t=n.call(this)||this;return t.type=e.type,t.key=e.key||0,t.targeted=e.targeted||[],t}e.ProgressBarInfo=a,__reflect(a.prototype,"game.ProgressBarInfo");var s,c=(s=e.BaseVO,__extends(l,s),Object.defineProperty(l.prototype,"config",{get:function(){if(!this._config)switch(this.type){case TaskType.BraveBook:this._config=e.Config.braveBook()[this.code];break;case TaskType.NewNewBraveBook:case TaskType.NewBraveBook:this._config=e.Config.newBraveBookTasksConfig()[this.code];break;case TaskType.SecondAchievement:this._config=e.Config.getSecAchievementConfig()[this.code];break;default:this._config=e.Config.taskConfig()[this.code]}return this._config},enumerable:!0,configurable:!0}),l.prototype.update=function(e){this.code=e.code||e.id,this.key=e.key,this.isTarget=e.isTarget},l);function l(e){var t=s.call(this)||this;return t.update(e),t}e.TaskVO=c,__reflect(c.prototype,"game.TaskVO");var h,p=(h=e.BaseVO,__extends(d,h),d.prototype.update=function(e){var t=this;this.targeted={},e?(this.currentExp=null!=e.currentExp?e.currentExp:e.progress,e.targeted.forEach(function(e){t.targeted[e]=!0})):this.currentExp=0},d);function d(e){var t=h.call(this)||this;return t.targeted={},t.update(e),t}e.DailyTaskExpVO=p,__reflect(p.prototype,"game.DailyTaskExpVO");var u,g=(u=e.BaseVO,__extends(f,u),f.prototype.update=function(e){this.pmId=e.pmId,this.activated=e.activated},f);function f(e){var t=u.call(this)||this;return t.update(e),t}__reflect(g.prototype,"GroupItemVO");var _,m=(_=e.BaseVO,__extends(y,_),y.prototype.update=function(e){this.id=e.id,this.items=e.items,this.fightCaps=e.fightCaps},y);function y(e){var t=_.call(this)||this;return t.update(e),t}e.GroupHandbookVO=m,__reflect(m.prototype,"game.GroupHandbookVO");var v,T=(v=e.BaseVO,__extends(C,v),C.prototype.update=function(e){this.groups=e.groups,this.fightCap=e.fightCap},C);function C(e){var t=v.call(this)||this;return t.groups=new Array,t.update(e),t}e.GroupHandbookInfoVO=T,__reflect(T.prototype,"game.GroupHandbookInfoVO");var E,I=(E=e.BaseVO,__extends(b,E),b.prototype.update=function(e){this.level=e.level,this.levelTargeted=e.levelTargeted},b);function b(e){var t=E.call(this)||this;return t.levelTargeted=[],e&&t.update(e),t}e.SecondAchievementInfoVO=I,__reflect(I.prototype,"game.SecondAchievementInfoVO")}(game=game||{}),function(i){function e(){}i.SMineVO=e,__reflect(e.prototype,"game.SMineVO");function t(){}i.SShopItemVO=t,__reflect(t.prototype,"game.SShopItemVO");function o(){}i.SShopInfoVO=o,__reflect(o.prototype,"game.SShopInfoVO");var n,c=(n=i.DirtyValueVO,__extends(a,n),a.prototype.update=function(e){n.prototype.update.call(this,e),this.isDiff(e)&&(this.isDirty=!0,this.type=e.type,this.fadeType=e.fadeType,this.eventId=e.eventId||this.eventId,this.dt=e.dt,this.position.update(e.position),this.info=JSON.parse(e.info),this.config=e.config,this.customTrigger=e.customTrigger,this.hudongAction=e.hudongAction)},a);function a(e){var t=n.call(this)||this;return t.caseDirtyKeys=["type","fadeType","position","eventId","config","customTrigger","hudongAction","info"],t.position=new s,e&&t.update(e),t}i.EventVO=c,__reflect(c.prototype,"game.EventVO");var r,s=(r=i.DirtyValueVO,__extends(l,r),l.prototype.reset=function(){this.num=this._layerId=this.id=this.type=this.x=this.y=void 0,this.position&&this.position.reset()},Object.defineProperty(l.prototype,"layerId",{get:function(){return this._layerId},set:function(e){(this._layerId=e)&&this.caculateDifficultyType()},enumerable:!0,configurable:!0}),l.prototype.caculateDifficultyType=function(){var e=i.Config.risk()[this.layerId];e&&(this.difficultyType=e.type)},l.prototype.update=function(e){e?this.isDiff(e)&&(this.isDirty=!0,this.x=e.x,this.y=e.y,this.type=e.type,this.num=e.num,this.layerId=e.layerId,this.id=e.id,e.position?(this.position||(this.position=new l),this.position.update(e.position)):this.position&&this.position.update()):(this.isDirty=!0,this.x=this.y=this.type=this.layerId=this.num=this.id=void 0)},l.prototype.match=function(e){if(!e)return!1;if(this.num==e.num&&this.type==e.type){if(this.position&&this.position.id)return this.position.match(e.position);if(!this.position||!this.position.num)return!0}return!1},l);function l(e){var t=r.call(this)||this;return t.difficultyType=0,t.caseDirtyKeys=["x","y","type","id","layerId","num","position"],e&&t.update(e),t}i.SPositionVO=s,__reflect(s.prototype,"game.SPositionVO");var h,p=(h=i.BaseVO,__extends(d,h),d.prototype.update=function(e){h.prototype.update.call(this,e),this.x=e.x,this.y=e.y,this.long=e.long,this.wide=e.wide},d);function d(e){var t=h.call(this)||this;return e&&t.update(e),t}i.GridVO=p,__reflect(p.prototype,"game.GridVO");var u,g=(u=i.BaseVO,__extends(f,u),f.prototype.reset=function(){this.events.splice(0),this.grids.splice(0),this.position.reset()},f.prototype.walkIntoPos=function(e){return e.position&&e.position.type?this.walkIntoPos(e.position):e},f.prototype.update=function(e){if(u.prototype.update.call(this,e),this.uuid=e.uuid,this.clear=e.clear,this.position.update(e.position),this.curPosVO=this.walkIntoPos(this.position),Array.isArray(e.events)){for(var t=0,i=0,o=e.events;i<o.length;i++){var n=o[i];this.events[t]?this.events[t].update(n):this.events.push(new c(n)),t++}this.events.splice(t)}if(Array.isArray(e.grids)){for(var a=t=0,r=e.grids;a<r.length;a++){var s=r[a];this.grids[t]?this.grids[t].update(s):this.grids.push(new p(s)),t++}this.grids.splice(t)}},f);function f(e){var t=u.call(this)||this;return t.events=new Array,t.grids=new Array,t.position=new s,e&&t.update(e),t}i.LayerVO=g,__reflect(g.prototype,"game.LayerVO");var _,m=(_=i.BaseVO,__extends(y,_),y.prototype.update=function(e){this.requestCount=e.requestCount,this.helpCount=e.helpCount},y);function y(){var e=null!==_&&_.apply(this,arguments)||this;return e.requestCount=0,e.helpCount=0,e}i.FortressHelpInfo=m,__reflect(m.prototype,"game.FortressHelpInfo");var v,T=(v=i.BaseVO,__extends(C,v),C.prototype.update=function(e){v.prototype.update.call(this,e),this.uuid=e.uuid,this.code=e.code,this.position.update(e.position),this.position.id=this.position.num},C);function C(e){var t=v.call(this)||this;return t.entityType=EEntityType.EEntityTypeMap,t.position=new s,e&&t.update(e),t}i.MapVO=T,__reflect(T.prototype,"game.MapVO");var E,I=(E=i.BaseVO,__extends(b,E),Object.defineProperty(b.prototype,"config",{get:function(){return this._config||(this._config=i.Config.demonConfig()[this.code]),this._config},enumerable:!0,configurable:!0}),b.prototype.update=function(e){this.uuid=e.uuid,this.dt=e.dt,this.baseInfo.update(e.baseInfo),this.creeps=e.creeps,this.totalLife=e.totalLife,this.leftLife=e.leftLife,this.code=e.code,this.excapeDt=e.excapeDt,this.foundRewards=e.foundRewards},b);function b(e){var t=E.call(this)||this;return t.baseInfo=new i.BaseInfoVO,t.creeps=[],t.foundRewards=[],e&&t.update(e),t}i.DemonVO=I,__reflect(I.prototype,"game.DemonVO");var A,P=(A=i.BaseVO,__extends(M,A),M.prototype.update=function(e){this.dt=e.dt,this.pos=e.pos,this.baseInfo.update(e.baseInfo)},M);function M(e){var t=A.call(this)||this;return t.baseInfo=new i.BaseInfoVO,e&&t.update(e),t}i.RiskMultiSMultiPlayer=P,__reflect(P.prototype,"game.RiskMultiSMultiPlayer");var N,S=(N=i.BaseVO,__extends(k,N),k.prototype.amIOwner=function(){return this.ownerId==i.GameMVC.playerPy.playerInfoVO.playerId},k.prototype.update=function(e){this.id=e.id,this.ownerId=e.ownerId,this.gain=e.gain,i.BaseVO.updateArr(e.members,this.members,P)},k);function k(e){var t=N.call(this)||this;return t.members=new Array,e&&t.update(e),t}i.RiskMultiSRoomInfo=S,__reflect(S.prototype,"game.RiskMultiSRoomInfo")}(game=game||{}),function(i){var o,e=(o=i.BaseVO,__extends(t,o),t);function t(e){var n=o.call(this)||this;n.id=e.id,n.order=e.order||0,n.cond=JSON.parse(e.cond),n.target=JSON.parse(e.target),n.steps=new Array;var a=i.Config.guideStepConfig(),t=JSON.parse(e.steps);return t.forEach(function(){n.steps.push(new r)}),t.forEach(function(e,t){var i=a[e];if(!i)throw egret.log(n.id+"新手配置错误"),n.id+"新手配置错误";var o=n.steps[t];o.belongFlow=n,o.index=t,o.update(i)}),n}i.GuideFlow=e,__reflect(e.prototype,"game.GuideFlow");var n,r=(n=i.BaseVO,__extends(a,n),a.prototype.update=function(e){this.id=e.id,this.isForce=e.isForce,this.isKeyOppr=e.isKeyOppr,this.figDir=e.figDir,this.figType=e.figType,this.tips=JSON.parse(e.tips),this.tipsAfter=JSON.parse(e.tipsAfter),this.cond=JSON.parse(e.cond),this.target=JSON.parse(e.target),this.operation=JSON.parse(e.operation),this.tipsPos=JSON.parse(e.tipsPos),this.tipsDir=JSON.parse(e.tipsDir),this.tipsDir2=JSON.parse(e.tipsDir2),this.onInitialized()},a.prototype.onInitialized=function(){if(this.tipsShowed=!1,this.isKeyOppr){var e=this.belongFlow;if(this.index<e.steps.length-1){this.stepsCache=[];for(var t=this.index+1;t<e.steps.length;t++)this.stepsCache.push(e.steps[t])}}},a);function a(){var e=n.call(this)||this;return e.showTimes=0,e}i.GuideStep=r,__reflect(r.prototype,"game.GuideStep")}(game=game||{}),function(e){var i,t=(i=e.BaseVO,__extends(o,i),o.prototype.update=function(e){this.playerId=e.playerId,this.opponentInfo=e.opponentInfo,this.playerManorInfo=e.playerManorInfo},o);function o(e){var t=i.call(this)||this;return t.opponentInfo=new a,t.playerManorInfo=new c,e&&t.update(e),t}e.ManorVO=t,__reflect(t.prototype,"game.ManorVO");var n,a=(n=e.BaseVO,__extends(r,n),r.prototype.update=function(e){this.playerId=e.playerId,this.name=e.name,this.level=e.level,this.vLevel=e.vLevel,this.fightCap=e.fightCap,this.rank=e.rank,this.camp=e.camp,this.avatar=e.avatar,this.subsidiary=e.subsidiary,this.fashion=e.fashion,this.guildName=e.guildName},r);function r(){return n.call(this)||this}e.ManorOpponentVO=a,__reflect(a.prototype,"game.ManorOpponentVO");var s,c=(s=e.BaseVO,__extends(l,s),l.prototype.update=function(e){this.id=e.id,this.type=e.type,this.lootTime=e.lootTime,this.lootTimeRefreshDt=e.lootTimeRefreshDt,this.totalGoodsNum=e.totalGoodsNum,this.canLootGoodsNum=e.canLootGoodsNum,this.lootBeginDt=e.lootBeginDt},l);function l(){return s.call(this)||this}e.PlayerManorVO=c,__reflect(c.prototype,"game.PlayerManorVO")}(game=game||{}),function(o){var i,e=(i=o.BaseVO,__extends(t,i),t.prototype.update=function(e){this.id=e.id,this.name=e.name,this.avatar=e.avatar,this.fightCap=e.fightCap,this.level=e.level,this.serverId=e.serverId,this.serverName=e.serverName,this.num=e.num,this.notice=e.notice,this.presidentId=e.presidentId,this.presidentName=e.presidentName},t);function t(e){var t=i.call(this)||this;return e&&t.update(e),t}o.GuildVO=e,__reflect(e.prototype,"game.GuildVO");var n,a=(n=o.BaseVO,__extends(r,n),r.prototype.update=function(e){this.exp=e.exp,this.guildId=e.guild.guildId||e.guild.id,this.rank=e.guild.rank,this.name=e.guild.name,this.noticeDt=e.guild.noticeDt,this.avatar=e.guild.avatar,this.num=e.guild.num,this.devoteProgress=e.guild.devoteProgress,this.notice=e.guild.notice,this.presidentName=e.guild.presidentName,this.lModifyDt=e.lModifyDt,e.guild.level!=this.level&&Utils.UnlockMgr.clearCacheByType([UnlockType.GuildLevel]),this.level=e.guild.level},r);function r(e){var t=n.call(this)||this;return t.fightCap=0,e&&t.update(e),t}o.GuildDetailVO=a,__reflect(a.prototype,"game.GuildDetailVO");var s,c=(s=o.BaseVO,__extends(l,s),l.prototype.update=function(e){!this.guildId&&e.guildId&&o.AppFacade.getInstance().sendNotification(CN.GUILD_FIRST_INFO_UPDATE),this.guildId=e.guildId,this.lastQuitGuildDt=e.lastQuitGuildDt,this.position=e.position,this.dDevote=e.dDevote,this.wDevote=e.wDevote,this.devoteNum=e.devoteNum||0,e.devoteInfo&&(this.devoteInfo=JSON.parse(e.devoteInfo)),e.skill&&(this.skill=JSON.parse(e.skill))},l);function l(e){var t=s.call(this)||this;return t.update(e),t}o.PlayerGuildVO=c,__reflect(c.prototype,"game.PlayerGuildVO");var h,p=(h=o.BaseVO,__extends(d,h),d.prototype.update=function(e){this.baseInfo.update(e.baseInfo),this.dDevote=e.dDevote,this.wDevote=e.wDevote,this.position=e.position},d);function d(e){var t=h.call(this)||this;return t.baseInfo=new o.BaseInfoVO,e&&t.update(e),t}o.GuildMemberVO=p,__reflect(p.prototype,"game.GuildMemberVO");var u,g=(u=o.BaseVO,__extends(f,u),f.prototype.update=function(e){this.baseInfo.update(e.baseInfo),this.applyDt=e.applyDt},f);function f(e){var t=u.call(this)||this;return t.baseInfo=new o.BaseInfoVO,e&&t.update(e),t}o.ApplyVO=g,__reflect(g.prototype,"game.ApplyVO");var _,m=(_=o.BaseVO,__extends(y,_),y.prototype.update=function(e){this.index=e.index,this.id=e.id,this.excapeDt=e.excapeDt},y);function y(e){var t=_.call(this)||this;return t.update(e),t}o.InbreakBossVO=m,__reflect(m.prototype,"game.InbreakBossVO");var v,T=(v=o.BaseVO,__extends(C,v),C.prototype.update=function(e){this.count=e.count,this.bossList=e.bossList,this.triggerDt=e.triggerDt},C);function C(e){var t=v.call(this)||this;return t.update(e),t}o.InbreakBossInfoVO=T,__reflect(T.prototype,"game.InbreakBossInfoVO");var E,I=(E=o.BaseVO,__extends(b,E),b.prototype.update=function(e){this.name=e.name,this.level=e.level,this.buff=e.buff,this.maxPassNum=e.maxPassNum,this.currentCount=e.currentCount,this.mopUpCount=e.mopUpCount,this.canMopUp=e.canMopUp,this.playerId=e.playerId},b);function b(e){var t=E.call(this)||this;return t.update(e),t}o.PlayerBattleSubwayInfo=I,__reflect(I.prototype,"game.PlayerBattleSubwayInfo");var A,P=(A=o.BaseVO,__extends(M,A),M.prototype.update=function(e){this.id=e.id,this.status=e.status},M);function M(e){var t=A.call(this)||this;return t.update(e),t}o.BountyVO=P,__reflect(P.prototype,"game.BountyVO");var N,S=(N=o.BaseVO,__extends(k,N),k.prototype.update=function(e){var t=this;this.bountyList=e.bountyList,this.bountyPro=e.bountyPro,this.bountyRefresh=e.bountyRefresh,this.bountyTimes=e.bountyTimes,this.targetedPro=e.targetedPro,this.targetedPro={},e.targetedPro.forEach(function(e){t.targetedPro[e]=!0})},k);function k(e){var t=N.call(this)||this;return t.update(e),t}o.BountyInfoVO=S,__reflect(S.prototype,"game.BountyInfoVO");var U,L=(U=o.BaseVO,__extends(O,U),O.prototype.update=function(e){this.uid=e.uid,this.configId=e.configId,this.ownerId=e.ownerId,this.status=e.status,this.bornDt=e.bornDt,this.sendDt=e.sendDt,this.giveList=e.giveList,this.leftNum=e.leftNum,this.leftAmount=e.leftAmount,this.emptyDt=e.emptyDt},O);function O(e){var t=U.call(this)||this;return t.update(e),t}o.GuildLuckyMoneyVO=L,__reflect(L.prototype,"game.GuildLuckyMoneyVO");var w,x=(w=o.BaseVO,__extends(R,w),R);function R(e){var t=w.call(this)||this;return t.id=e.id,t.dt=e.dt,t.flag=e.flag,0<t.dt&&(t.cur=o.GameMgr.getInstance().serverTime()-t.dt),t}o.GuildCollectTaskInfoVO=x,__reflect(x.prototype,"game.GuildCollectTaskInfoVO");var B,D=(B=o.BaseVO,__extends(V,B),V.prototype.update=function(e){var i=this;this.num=e.num,this.dt=e.dt,this.yesterdayNum=e.yesterdayNum,this.rewardList=e.rewardList,this.taskList.splice(0),this.id2TaskVO={},Array.isArray(e.taskList)&&e.taskList.forEach(function(e){var t=new x(e);i.id2TaskVO[e.id]=t,i.taskList.push(t)}),o.GameMVC.guildCollectPy.checkCollectReward(),NoticeManager.updateNotice(NT.GUILD_COLLECT),o.AppFacade.getInstance().sendNotification(CN.GUILD_COLLECT_INFO_UPDATE)},V);function V(e){var t=B.call(this)||this;return t.taskList=new Array,e&&t.update(e),t}o.GuildCollectInfoVO=D,__reflect(D.prototype,"game.GuildCollectInfoVO");var H,G=(H=o.BaseVO,__extends(F,H),F);function F(){return null!==H&&H.apply(this,arguments)||this}__reflect(G.prototype,"GuildWarSimpleHeroVO");var W,j=(W=o.BaseVO,__extends(Y,W),Y);function Y(){return null!==W&&W.apply(this,arguments)||this}__reflect(j.prototype,"GuildWarPlayerEntity");var z,q=(z=o.BaseVO,__extends(K,z),K);function K(){return null!==z&&z.apply(this,arguments)||this}__reflect(q.prototype,"GuildWarRouteInfo");var J,X=(J=o.BaseVO,__extends(Z,J),Z.prototype.update=function(e){this.guild=e.guild,this.routes=e.routes,this.score=e.score,this.enrolled=e.enrolled,this.selfEnrolled=e.selfEnrolled,this.guild||(this.guild=o.AppFacade.getInstance().retrieveProxy(o.GuildPy.N).guildDetail),this.updateCustom()},Z.prototype.updateCustom=function(){var t=this;this.enrolledMemberNum=0,this.routes.forEach(function(e){t.enrolledMemberNum+=e.entities.length})},Z);function Z(e){var t=J.call(this)||this;return t.routes=[],e&&t.update(e),t}o.GuildWarGuildEntityVO=X,__reflect(X.prototype,"game.GuildWarGuildEntityVO")}(game=game||{}),function(e){var t,i=(t=e.BaseVO,__extends(o,t),o.prototype.update=function(e){this.gymId=e.gymId,this.pointList=e.pointList,this.isClear=e.isClear},o);function o(){return t.call(this)||this}e.GymInfoVO=i,__reflect(i.prototype,"game.GymInfoVO")}(game=game||{}),function(e){var i,t=(i=e.BaseVO,__extends(o,i),o);function o(e){var t=i.call(this)||this;return t.beginHatchDt=e.beginHatchDt,t.endHatchDt=e.endHatchDt,t.leftSnatchCount=e.leftSnatchCount,t.uuid=e.uuid,t.configId=e.configId,t.ownerId=e.ownerId,t.costs=e.costs,t.snatchRecord=e.snatchRecord,t}e.HatchEggVO=t,__reflect(t.prototype,"game.HatchEggVO");var n,a=(n=e.BaseVO,__extends(r,n),r.prototype.update=function(e){if(this.hatchCount=e.hatchCount,this.snatchCount=e.snatchCount,this.refreshCount=e.refreshCount,this.cacheConfigId=e.cacheConfigId,this.revengeList=e.revengeList,this.snatchRecord=e.snatchRecord,this.eggs.splice(0),e.eggs)for(var t=0,i=e.eggs;t<i.length;t++){var o=i[t];this.eggs.push(o)}},r);function r(e){var t=n.call(this)||this;return t.eggs=new Array,e&&t.update(e),t}e.PlayerHatchVO=a,__reflect(a.prototype,"game.PlayerHatchVO")}(game=game||{}),function(l){var i,e=(i=l.BaseVO,__extends(t,i),Object.defineProperty(t.prototype,"config",{get:function(){return this._config&&!this.isExpire||(this.isExpire=!1,this._config=l.Config.allHeroConfig()[this.code]),this._config},enumerable:!0,configurable:!0}),t.prototype.update=function(e){this.uuid=e.uuid,this.originalUuid=e.originalUuid,this.level=e.level,this.attr=e.attr,this.pos=e.pos,this.starLevel=e.starLevel,this.skillList=e.skillList,this.sectionLevel=e.sectionLevel,this.fightCap=e.fightCap,this.resonate=e.resonate,this.battlePos=e.battlePos,this.haloAttr=e.haloAttr,this.isLocked=e.isLocked,this.artifactResonate=e.artifactResonate,this.dermaCode=e.dermaCode,this.resonateLevelList=e.resonateLevelList,this.practiceLevel=e.practiceLevel,this.defendLevel=e.defendLevel,this.isAltar=e.isAltar,e.code!=this.code&&(this.isExpire=!0),this.code=e.code||this.code},Object.defineProperty(t.prototype,"isAltarInit",{get:function(){return 5==this.starLevel},enumerable:!0,configurable:!0}),t);function t(e){var t=i.call(this)||this;return t.entityType=EEntityType.EEntityTypeHero,t.skillList=[],t.resonate=[],t.artifactResonate=[],t.resonateLevelList=[],e&&t.update(e),t}l.HeroVO=e,__reflect(e.prototype,"game.HeroVO");var a,o=(a=l.BaseVO,__extends(n,a),Object.defineProperty(n.prototype,"config",{get:function(){},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"level2",{get:function(){return this._level2},enumerable:!0,configurable:!0}),n.prototype.update=function(e){a.prototype.update.call(this,e),this.uuid=e.uuid,this.level=e.level,this.heroUuid=e.heroUuid,this.num=e.num,this.fightCap=e.fightCap,this.filterShow=e.filterShow||!1,this.isLocked=e.isLocked,this.originalUuid=e.originalUuid,this.isAltar=e.isAltar,this.code=e.code,this.attr=[];var t=JSON.parse(e.attr);for(var i in t){var o=t[i];this.attr.push([parseInt(i),o])}if(this.entityType==EEntityType.EEntityTypeHeroEquip)(n=l.Config.getHeroEquipConfig()[this.code])&&(this.type=n.type);else if(this.entityType==EEntityType.EEntityTypeTreasure){var n;(n=l.Config.getHeroTreasureConfig()[this.code])&&(this.type=n.type)}},n.prototype.reduceByNum=function(e){return this.num-=e,this.num<0&&(this.num=0),this.num},n);function n(e){var t=a.call(this)||this;return t.entityType=EEntityType.EEntityTypeHeroEquip,t.uuid="",t.code=0,t.level=0,t.attr=[],t.heroUuid="",t.selected=!1,e&&t.update(e),t}l.HeroThingVO=o,__reflect(o.prototype,"game.HeroThingVO");var r,s=(__extends(c,r=o),Object.defineProperty(c.prototype,"config",{get:function(){return l.Config.getHeroEquipConfig()[this.code]},enumerable:!0,configurable:!0}),c.prototype.update=function(e){r.prototype.update.call(this,e),this.attachLevel=this._level2=e.attachLevel,this.quenchceLevel=e.quenchceLevel||0},Object.defineProperty(c.prototype,"isAltarInit",{get:function(){return 0==this.level&&0==this.attachLevel&&0==this.quenchceLevel},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"color",{get:function(){return this.config.color},enumerable:!0,configurable:!0}),c);function c(e){var t=r.call(this,e)||this;return t.attachLevel=0,t.quenchceLevel=0,t.entityType=EEntityType.EEntityTypeHeroEquip,t.update(e),t}l.HeroEquipVO=s,__reflect(s.prototype,"game.HeroEquipVO");var h,p=(__extends(d,h=o),Object.defineProperty(d.prototype,"config",{get:function(){return l.Config.getHeroArtifactConfig()[this.code]},enumerable:!0,configurable:!0}),d.prototype.update=function(e){h.prototype.update.call(this,e),this.exp=e.exp,this.advanceExp=e.advanceExp,this.advanceLevel=this._level2=e.advanceLevel,this.baptizeAttr=e.baptizeAttr,this.newBaptizeAttr=e.newBaptizeAttr,l.Config.heroArtifactAdditon()[this.config.subType]?this.additionRace=e.additionRace||0:this.additionRace=0,this.isInit=e.isInit},Object.defineProperty(d.prototype,"color",{get:function(){return this.additionRace?8:this.config.color},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"baptizeLevel",{get:function(){var e={},t=l.Config.getHeroArtifactBaptizeConfig();for(var i in t){var o=t[i],n=JSON.parse(o.attr)[0];1e5<=n[1]?e[1e5*n[0]]=n[1]/100*o.maxValue:e[n[0]]=n[1]/100*o.maxValue}var a=JSON.parse(this.baptizeAttr),r=0;for(var s in a){var c=1;c=1e5<=a[s]?e[parseInt(s)%1e4*1e5]||1:e[parseInt(s)%1e4]||1,r+=a[s]/c}return r},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"isAltarInit",{get:function(){return this.isInit&&0==this.config.sectionLevel&&7<=this.config.color},enumerable:!0,configurable:!0}),Object.defineProperty(d.prototype,"sectionLevel",{get:function(){return this.config.sectionLevel},enumerable:!0,configurable:!0}),d);function d(e){var t=h.call(this,e)||this;return t.exp=0,t.advanceExp=0,t.advanceLevel=0,t.additionRace=0,t.entityType=EEntityType.EEntityTypeHeroArtifact,t.update(e),t}l.HeroArtifactVO=p,__reflect(p.prototype,"game.HeroArtifactVO");var u,g=(__extends(f,u=o),Object.defineProperty(f.prototype,"config",{get:function(){return l.Config.getHeroTreasureConfig()[this.code]},enumerable:!0,configurable:!0}),f.prototype.update=function(e){u.prototype.update.call(this,e),this.jewelAttr=JSON.parse(e.jewelAttr),this.jewelLevel=JSON.parse(e.jewelLevel)},f);function f(e){var t=u.call(this,e)||this;return t.entityType=EEntityType.EEntityTypeTreasure,t.update(e),t}l.HeroTreasureVO=g,__reflect(g.prototype,"game.HeroTreasureVO");var _,m=(__extends(y,_=o),Object.defineProperty(y.prototype,"config",{get:function(){return l.Config.immortalConfig()[this.code]},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"subType",{get:function(){return this.code},enumerable:!0,configurable:!0}),y.prototype.update=function(e){_.prototype.update.call(this,e),this.code=e.subType||e.code,this.sectionLevel=e.sectionLevel,this.baptizeAttr="string"==typeof e.baptizeAttr&&JSON.parse(e.baptizeAttr)||e.baptizeAttr,this.newBaptizeAttr="string"==typeof e.newBaptizeAttr&&JSON.parse(e.newBaptizeAttr)||e.newBaptizeAttr,this.orderList=e.orderList,this.newOrderList=e.newOrderList,this.slotNum=e.slotNum,this.exp=e.exp},y);function y(e){var t=_.call(this,e)||this;return t.entityType=EEntityType.EEntityTypeImmortal,t.update(e),t}l.HeroImmortalVO=m,__reflect(m.prototype,"game.HeroImmortalVO");var v,T=(__extends(C,v=o),Object.defineProperty(C.prototype,"config",{get:function(){return l.Config.getHeroDermaConfig()[this.code]},enumerable:!0,configurable:!0}),C.prototype.update=function(e){v.prototype.update.call(this,e)},C);function C(e){var t=v.call(this,e)||this;return t.entityType=EEntityType.EEntityTypeDerma,t.update(e),t}l.HeroDermaVO=T,__reflect(T.prototype,"game.HeroDermaVO")}(game=game||{}),function(a){var o,r=(o=a.BaseVO,__extends(e,o),e.prototype.isInFormation=function(){return this.pos<=6},Object.defineProperty(e.prototype,"config",{get:function(){return a.Config.allHeroConfig()[this.code]},enumerable:!0,configurable:!0}),e.prototype.update=function(e,t){void 0===t&&(t=void 0),this.code=e.code,null==e.pos?e.pos=t+1+6:this.pos=e.pos},e);function e(e,t){void 0===t&&(t=void 0);var i=o.call(this)||this;return e&&i.update(e,t),i}a.CG_SHero=r,__reflect(r.prototype,"game.CG_SHero");var i,t=(i=a.BaseVO,__extends(n,i),n.prototype.update=function(e){a.BaseVO.updateArr(e.heros,this.heros,r)},n);function n(e){var t=i.call(this)||this;return e&&t.update(e),t}a.CG_SPlayerInfo=t,__reflect(t.prototype,"game.CG_SPlayerInfo");var s,c=(s=a.BaseVO,__extends(l,s),l.prototype.update=function(e){if(this.id=999,this.status=e.status,this.battleDt=e.battleDt,this.tInfo=e.tInfo,a.BaseVO.updateArr(e.players,this.players,a.BaseInfoVO),Array.isArray(e.buffs)){for(var t=0,i=0,o=e.buffs;i<o.length;i++){var n=o[i];this.buffs[t]?this.buffs[t].update(n,t):this.buffs.push(new r(n,t)),t++}this.buffs.splice(t)}},l);function l(e){var t=s.call(this)||this;return t.players=new Array,t.buffs=new Array,e&&t.update(e),t}a.CG_SRoomInfo=c,__reflect(c.prototype,"game.CG_SRoomInfo")}(game=game||{}),function(t){var i,e=(i=t.BaseVO,__extends(o,i),Object.defineProperty(o.prototype,"sdkUuid",{get:function(){return"wechat"==Utils.agentConfig.AgentCode?getUrlKV().sdk_uin:this.uuid},enumerable:!0,configurable:!0}),o.prototype.isValid=function(){return""!=this.username&&""!=this.password},o.prototype.checkAddictive=function(e){if(!(Utils.SDKMgr.getPerformConfig(50)&&Utils.MathUtils.isNumber(this.age)&&this.age<18))return!1;this.loginTime||(this.loginTime=0);var t=Utils.TimerManager.getServerTime(!1),i=new Date(1e3*t).getHours();if(22<=i||i<8)return Utils.MsgUtils.addMidMsg("未成年人晚上22点-次日早上8点为防沉迷时间段",1e4),!0;null==this.isTodayHoliday&&egret.warn("还没拿到今天是否节日的信息");var o=5400;return this.isTodayHoliday&&(o=10800),this.loginTime+(e||0)/1e3>=o?(Utils.MsgUtils.addMidMsg("今日已进入防沉迷时间限制(节假日3小时，其他时间1.5小时)",1e4),!0):void 0},o);function o(){var e=i.call(this)||this;return e.loginState=-1,e.login_ext={},e}t.UserVO=e,__reflect(e.prototype,"game.UserVO");var n,a=(n=t.BaseVO,__extends(r,n),r.prototype.update=function(e){this.s_id=e.s_id,this.s_ip=e.s_ip,this.port=e.port,this.sPort=e.sPort,this.s_name=e.s_name,this.s_healthStatus=e.s_healthStatus,this.area=e.area,this.list_name=e.list_name,this.s_Allnum=e.s_Allnum},r);function r(e){var t=n.call(this)||this;return e&&t.update(e),t}t.ServerVO=a,__reflect(a.prototype,"game.ServerVO");var s,c=(s=t.BaseVO,__extends(l,s),l.prototype.update=function(e){this.sysDt=e.sysDt,this.timeZone=e.timeZone,this.serverOpenDt=e.serverOpenDt,this.initPm=e.initPm,this.offlineTime=e.offlineTime,this.isCreated=e.isCreated,this.singleSign=e.singleSign,t.GameMgr.getInstance().updateTimeDValue(this.sysDt)},l.prototype.updateInGame=function(e){this.sysDt=e.sysDt,this.timeZone=e.timeZone,this.serverOpenDt=e.serverOpenDt,this.singleSign=e.singleSign,t.GameMgr.getInstance().updateTimeDValue(this.sysDt)},l);function l(){var e=s.call(this)||this;return e.initPm=0,e}t.LoginGameVO=c,__reflect(c.prototype,"game.LoginGameVO")}(game=game||{}),function(e){var i,t=(i=e.BaseVO,__extends(o,i),Object.defineProperty(o.prototype,"config",{get:function(){return this._config&&!this.isExpire||(this.isExpire=!1,this._config=e.Config.allMagicalConfig()[this.code]),this._config},enumerable:!0,configurable:!0}),o.prototype.update=function(e){this.uuid=e.uuid,this.originalUuid=e.originalUuid,this.level=e.level,this.attr=e.attr,this.pos=e.pos,this.heroUuid=e.heroUuid,this.skillList=e.skillList,this.sectionLevel=e.sectionLevel,this.fightCap=e.fightCap,this.code!=e.code&&(this.isExpire=!0),this.code=e.code},o);function o(e){var t=i.call(this)||this;return t.skillList=[],e&&t.update(e),t}e.MagicalVO=t,__reflect(t.prototype,"game.MagicalVO")}(game=game||{}),function(y){var i,e=(i=y.BaseVO,__extends(t,i),t.prototype.update=function(e){this.uuid=e.uuid,this.key=e.key,this.content=e.content,this.sendTime=e.sendTime,this.expireTime=e.expireTime,this.status=e.status,this.attachs=e.attachs,this.propertys=e.propertys,this.theme=e.theme},t.prototype.getContentTextFlow=function(){var t=new Array,e=y.Config.mailConfig()[this.key],i=void 0;e?(i=e.content,""==this.content||e.key!=EMailType.EMailTypeReward&&e.key!=EMailType.EMailTypeSystem&&e.key!=EMailType.EMailTypeVipMail&&e.key!=EMailType.EMailTypeCreateRole||(i=this.content)):(egret.log("找不到邮件配置",this.key),i="[]");var o=[];try{o=JSON.parse(i)}catch(e){return t.push({text:i,style:{}}),t}for(var n=JSON.parse(this.propertys),a=0,r=0,s=o;r<s.length;r++){for(var c=s[r],l=0,h=(new egret.HtmlTextParser).parser(c);l<h.length;l++){var p=h[l];"brbrbr"==p.text?t.push({text:"\n"}):t.push(p)}if(n[a]){var d=n[a][0];if(EMailValueType.EMailValueTypeText==d)t.push({text:" "+n[a][1],style:{}});else if(EMailValueType.EMailValueTypeCode==d)for(var u=0,g=n[a][1];u<g.length;u++){var f=g[u],_=y.GeneralConfig.getEntityConfigByCode(f[0],f[1]),m=y.GeneralConfig.getColorByColor(_.color);5==_.color&&(m=13080844),t.push({text:" "+_.name,style:{textColor:m}}),t.push({text:" x"+f[2],style:{}})}}a++}return t},t);function t(e){var t=i.call(this)||this;return t.update(e),t}y.MailVO=e,__reflect(e.prototype,"game.MailVO")}(game=game||{}),function(i){var o,n=(o=i.BaseVO,__extends(e,o),e.prototype.update=function(e){this.x=e.x,this.y=e.y},e);function e(e){var t=o.call(this)||this;return e&&t.update(e),t}i.CoordinateInfo=n,__reflect(n.prototype,"game.CoordinateInfo");var a,t=(a=i.BossVO,__extends(r,a),r.prototype.update=function(e){for(var t in this.baseInfo.update(e.baseInfo),this.walkNum=e.walkNum,this.lastWalkRecoverDt=e.lastWalkRecoverDt,e.playerEntityList)e.playerEntityList[t].baseInfo=e.baseInfo;this.updatePlayerEntityList(e.playerEntityList),this.lastEntityIndex=e.lastEntityIndex,this.integral=e.integral,this.guildIntegral=e.guildIntegral},r.prototype.updatePlayerEntityList=function(e){if(this.playerEntityList.splice(0),e)for(var t=0,i=e;t<i.length;t++){var o=i[t];this.playerEntityList.push(new g(o))}},r);function r(e){var t=a.call(this)||this;return t.baseInfo=new i.BaseInfoVO,t.playerEntityList=new Array,e&&t.update(e),t}i.PlayerProxyInfo=t,__reflect(t.prototype,"game.PlayerProxyInfo");var s,c=(s=i.BaseVO,__extends(l,s),l.prototype.update=function(e){this.code=e.code,this.dermaCode=e.dermaCode,this.battlePos=e.battlePos},l);function l(e){var t=s.call(this)||this;return e&&t.update(e),t}i.PlayerHeroBaseInfo=c,__reflect(c.prototype,"game.PlayerHeroBaseInfo");var h,p=(h=i.BaseVO,__extends(d,h),d.prototype.update=function(e){this.updatePlayerHeroBaseInfo(e.heroBaseInfoList),this.petList=e.petList,this.magicalList=e.magicalList,this.fightCap=e.fightCap||0},d.prototype.updatePlayerHeroBaseInfo=function(e){if(this.heroBaseInfoList.splice(0),e)for(var t=0,i=e;t<i.length;t++){var o=i[t];this.heroBaseInfoList.push(new c(o))}},d);function d(e){var t=h.call(this)||this;return t.heroBaseInfoList=new Array,t.petList=new Array,t.magicalList=new Array,e&&t.update(e),t}i.TeamInfo=p,__reflect(p.prototype,"game.TeamInfo");var u,g=(u=i.BaseVO,__extends(f,u),f.prototype.update=function(e){this.baseInfo.update(e.baseInfo),this.walkNum=e.walkNum,this.blood=e.blood,this.lastWalkRecoverDt=e.lastWalkRecoverDt,this.lastBloodRecoverDt=e.lastBloodRecoverDt,this.gameNum=e.gameNum,this.purchaseNum=e.purchaseNum,this.coordinateInfo=e.coordinateInfo,this.isInSafeArea=e.isInSafeArea,this.manorId=e.manorId,this.captureDt=e.captureDt,this.coordinateStatus=e.coordinateStatus,this.rewards=e.rewards,this.entityIndex=e.entityIndex,e.teamInfo?this.teamInfo.update(e.teamInfo):console.log("服务器数据有误 params.teamInfo=null"),this.autoCaptureInfo.update(e.autoCaptureInfo),this.enterIntoSafeAreaDt=e.enterIntoSafeAreaDt,this.revivalBeginDt=e.revivalBeginDt||0,this.isSelf=i.GameMVC.loginPy.isSelf(e.baseInfo.playerId)},f);function f(e){var t=u.call(this)||this;return t.baseInfo=new i.BaseInfoVO,t.coordinateInfo=new n,t.teamInfo=new p,t.autoCaptureInfo=new S,e&&t.update(e),t}i.PlayerEntityInfo=g,__reflect(g.prototype,"game.PlayerEntityInfo");var _,m=(_=i.DirtyValueVO,__extends(y,_),y.prototype.update=function(e){if(_.prototype.update.call(this,e),this.manorId=e.manorId,this.coordinateInfo.update(e.coordinateInfo),this.isSpecial=e.isSpecial,this.beCapturedDt=e.beCapturedDt,this.updatePlayerEntityList(e.playerManorList),this.initDt=e.initDt,this.id=e.id,this.isSameGuild=e.isSameGuild,this.isBattleStatus=e.isBattleStatus,this.collectedTime=e.collectedTime,this.guildName=e.guildName||"",this.num=e.num||0,e.guildId)this.guildId=e.guildId;else if(e.isSameGuild||!e.isBattleStatus){for(var t=0;t<this.playerManorList.length;t++)if(this.playerManorList[t]&&this.playerManorList[t].baseInfo.guild&&this.playerManorList[t].baseInfo.guild.name&&""!=this.playerManorList[t].baseInfo.guild.name){this.guildId=this.playerManorList[t].baseInfo.guild.id;break}}else if(e.isBattleStatus){var i=new Array;for(t=0;t<this.playerManorList.length;t++)if(this.playerManorList[t]&&this.playerManorList[t].baseInfo.guild&&this.playerManorList[t].baseInfo.guild.name&&""!=this.playerManorList[t].baseInfo.guild.name){var o=this.playerManorList[t].baseInfo.guild.id;i[o]||(i[o]=0),i[o]+=1}var n=0;for(var t in i)i[t]>n&&(n=i[t],this.guildId=Number(t))}0!=this.guildId?this.guildServerId=parseInt((this.guildId/1e4).toFixed(0)):this.guildServerId=0,this.remove=e.remove||!1},y.prototype.updatePlayerEntityList=function(e){if(this.playerManorList.splice(0),e)for(var t=0,i=e;t<i.length;t++){var o=i[t];this.playerManorList.push(new g(o))}},y);function y(e){var t=_.call(this)||this;return t.coordinateInfo=new n,t.playerManorList=new Array,t.guildServerId=0,t.guildId=0,t.remove=!1,e&&t.update(e),t}i.ManorEntityInfo=m,__reflect(m.prototype,"game.ManorEntityInfo");var v,T=(v=i.BaseVO,__extends(C,v),C.prototype.update=function(e){this.baseInfo.update(e.baseInfo),this.blood=e.blood,this.decreaseBlood=e.decreaseBlood,this.entityIndex=e.entityIndex},C);function C(e){var t=v.call(this)||this;return t.baseInfo=new i.BaseInfoVO,e&&t.update(e),t}i.PlayerRecordEntityInfo=T,__reflect(T.prototype,"game.PlayerRecordEntityInfo");var E,I=(E=i.BaseVO,__extends(b,E),b.prototype.update=function(e){this.uuid=e.uuid,this.dt=e.dt,this.attackEntity.update(e.attackEntity),this.defenceEntity.update(e.defenceEntity),this.win=e.win,this.battleRecord=e.battleRecord},b);function b(e){var t=E.call(this)||this;return t.attackEntity=new T,t.defenceEntity=new T,e&&t.update(e),t}i.BattleRecordEntityInfo=I,__reflect(I.prototype,"game.BattleRecordEntityInfo");var A,P=(A=i.BaseVO,__extends(M,A),M.prototype.update=function(e){this.updatePlayerEntityList(e.playerEntityList),this.updateManorEntityList(e.manorEntityList)},M.prototype.updatePlayerEntityList=function(e){if(this.playerEntityList.splice(0),e)for(var t=0,i=e;t<i.length;t++){var o=i[t];this.playerEntityList.push(new g(o))}},M.prototype.updateManorEntityList=function(e){if(this.manorEntityList.splice(0),e)for(var t=0,i=e;t<i.length;t++){var o=i[t];this.manorEntityList.push(new m(o))}},M);function M(e){var t=A.call(this)||this;return t.playerEntityList=new Array,t.manorEntityList=new Array,e&&t.update(e),t}i.ManorInfoVO=P,__reflect(P.prototype,"game.ManorInfoVO");var N,S=(N=i.BaseVO,__extends(k,N),k.prototype.update=function(e){this.manorId=e.manorId||0,this.isAutoCapture=e.isAutoCapture||!1,this.isAutoChallenge=e.isAutoChallenge||!1,this.isChallengePowerHouse=e.isChallengePowerHouse||!1,this.isAutoPurchaseWalk=e.isAutoPurchaseWalk||!1,this.isAutoPurchaseBlood=e.isAutoPurchaseBlood||!1,this.totalWalkDiamond=e.totalWalkDiamond||0,this.totalBloodDiamond=e.totalBloodDiamond||0,this.isOpen=e.isOpen||!1,this.resurgenceNum=e.resurgenceNum||0,this.isAutoResurgence=e.isAutoResurgence||!1},k);function k(e){var t=N.call(this)||this;return e&&t.update(e),t}i.AutoCaptureInfo=S,__reflect(S.prototype,"game.AutoCaptureInfo")}(game=game||{}),function(e){var i,o=(i=e.BaseVO,__extends(t,i),t.prototype.update=function(e){e&&(this.teamId=e.teamId,this.totalGoodsNum=e.totalGoodsNum,this.lootBeginDt=e.lootBeginDt,this.isInManor=e.isInManor,this.isMining=e.isMining,this.campId=e.campId)},t);function t(e){var t=i.call(this)||this;return t.update(e),t}e.SelfManorInfo=o,__reflect(o.prototype,"game.SelfManorInfo");var n,a=(n=e.BaseVO,__extends(r,n),r);function r(){return null!==n&&n.apply(this,arguments)||this}e.SinglePlayerInfo=a,__reflect(a.prototype,"game.SinglePlayerInfo");var s,c=(s=e.BaseVO,__extends(l,s),l.prototype.update=function(e){if(e){if(e.playerTeamInfo){this.playerTeamInfo.splice(0);for(var t=0,i=e.playerTeamInfo;t<i.length;t++){var o=i[t];this.playerTeamInfo.push(new g(o))}}this.teamManorInfo.update(e.teamManorInfo)}},l);function l(e){var t=s.call(this)||this;return t.teamManorInfo=new m,t.playerTeamInfo=new Array,t.update(e),t}e.SelfTeamInfo=c,__reflect(c.prototype,"game.SelfTeamInfo");var h,p=(h=e.BaseVO,__extends(d,h),d.prototype.update=function(e){if(e&&(this.manorId=e.manorId,this.lootBeginDt=e.lootBeginDt,this.firstTeamId=e.firstTeamId,e.teamManorInfo)){this.teamManorInfo.splice(0);for(var t=0,i=e.teamManorInfo;t<i.length;t++){var o=i[t];this.teamManorInfo.push(new m(o))}}},d);function d(e){var t=h.call(this)||this;return t.teamManorInfo=new Array,t.update(e),t}e.SingleManorInfo=p,__reflect(p.prototype,"game.SingleManorInfo");var u,g=(u=e.BaseVO,__extends(f,u),f.prototype.update=function(e){e&&(this.playerId=e.playerId,this.leader=e.leader,this.dt=e.lootBeginDt,this.isOnline=e.isOnline,this.serverId=e.serverId,this.name=e.name,this.avatar=e.avatar,this.fightCap=e.fightCap,this.maxTeamLife=e.maxTeamLife,this.curTeamLife=e.curTeamLife)},f);function f(e){var t=u.call(this)||this;return t.update(e),t}e.PlayerTeamInfo=g,__reflect(g.prototype,"game.PlayerTeamInfo");var _,m=(_=e.BaseVO,__extends(y,_),y.prototype.resetPos=function(){this.campId},y.prototype.update=function(e){if(e&&(this.teamId=e.teamId,this.manorId=e.manorId,this.playerId=e.playerId,this.num=e.num,this.fightCap=e.fightCap,this.beginMoveDt=e.beginMoveDt,this.endMoveDt=e.endMoveDt,this.campId=e.campId,this.isMoving=e.isMoving,this.beginCoordinate.setTo(e.beginCoordinate.x,e.beginCoordinate.y),this.endCoordinate.setTo(e.endCoordinate.x,e.endCoordinate.y),this.teammateInfos.splice(0),e.teammateInfos))for(var t=0,i=e.teammateInfos;t<i.length;t++){var o=i[t];this.teammateInfos.push(new g(o))}},y.prototype.getDis=function(){return egret.Point.distance(this.endCoordinate,this.beginCoordinate)},y.prototype.getCurPos=function(){},y);function y(e){var t=_.call(this)||this;return t.beginCoordinate=egret.Point.create(0,0),t.endCoordinate=egret.Point.create(0,0),t.teammateInfos=new Array,t.update(e),t.resetPos(),t}e.TeamManorInfo=m,__reflect(m.prototype,"game.TeamManorInfo");var v,T=(v=e.BaseVO,__extends(C,v),C.prototype.update=function(e){if(e){for(var t={},i=0,o=e.teamList;i<o.length;i++){for(var n=o[i],a=!(t[n.teamId]=!0),r=0,s=this.teamList;r<s.length;r++){var c=s[r];if(c.teamId==n.teamId){a=!0,c.update(n);break}}a||this.teamList.push(new m(n))}this.teamList=this.teamList.filter(function(e){return t[e.teamId]}),this.selfTeamInfo.update(e.selfTeamInfo)}else this.teamList.splice(0)},C);function C(e){var t=v.call(this)||this;return t.teamList=new Array,t.selfTeamInfo=new c,t.update(e),t}__reflect(T.prototype,"TeamInfo");var E,I=(E=e.BaseVO,__extends(b,E),b.prototype.update=function(e){e&&(this.campId=e.campId,this.dt=e.dt,this.goods=e.goods)},b);function b(e){var t=E.call(this)||this;return t.update(e),t}e.CampGoodsInfo=I,__reflect(I.prototype,"game.CampGoodsInfo");var A,P=(A=e.BaseVO,__extends(M,A),M.prototype.update=function(e){e&&(this.updateManorList(e.manorList),this.updateCampGoodsInfo(e.goodsInfo),this.updatePlayerList(e.playerList),this.selfInfo.update(e.selfInfo),this.teamInfo.update(e.teamInfo))},M.prototype.updateManorList=function(e){if(this.manorList.splice(0),e)for(var t=0,i=e;t<i.length;t++){var o=i[t];this.manorList.push(new p(o))}},M.prototype.updateCampGoodsInfo=function(e){var i=this;e&&(e.forEach(function(e,t){i.goodsInfo[t]?i.goodsInfo[t].update(e):i.goodsInfo[t]=new I(e)}),this.goodsInfo.sort(function(e,t){return t.goods-e.goods}))},M.prototype.updatePlayerList=function(e){e&&(this.playerList=e)},M.prototype.cleanUp=function(){this.update({})},M);function M(e){var t=A.call(this)||this;return t.selfInfo=new o,t.manorList=new Array,t.goodsInfo=new Array,t.playerList=new Array,t.teamInfo=new T,t.update(e),t}e.ManorInfo=P,__reflect(P.prototype,"game.ManorInfo")}(game=game||{}),function(e){var i,t=(i=e.BaseVO,__extends(o,i),o.prototype.update=function(e){this.uuid=e.uuid,this.level=e.level,this.attr=e.attr,this.pos=e.pos,this.skillList=e.skillList,this.fightCap=e.fightCap,this.code=e.code,this.starLevel=e.starLevel},o);function o(e){var t=i.call(this)||this;return t.skillList=[],e&&t.update(e),t}e.MountVO=t,__reflect(t.prototype,"game.MountVO")}(game=game||{}),function(t){var i=(e.prototype.updateData=function(e){this.baseInfo.update(e.baseInfo),this.isChallenged=e.isChallenged,this.rank=e.rank},e);function e(e){this.baseInfo=new t.PlayerInfoVO,this.isChallenged=!1,e&&this.updateData(e)}t.PWChallengeInfoVO=i,__reflect(i.prototype,"game.PWChallengeInfoVO");var o=(n.prototype.updateData=function(e){this.grade=e.grade,this.rank=e.rank,this.chalCount=e.chalCount,this.buyChalCount=e.buyChalCount,this.freCount=e.freCount,this.buyFreCount=e.buyFreCount,this.winCount=e.winCount,this.dailyTargeted=e.dailyTargeted,this.updateChallengeList(e.chalList)},n.prototype.updateChallengeList=function(e){var t=this;this.chalList.splice(0),e.forEach(function(e){t.chalList.push(new i(e))})},n);function n(e){this.chalList=[],this.dailyTargeted=[],e&&this.updateData(e)}t.PWFreeMatchInfoVO=o,__reflect(o.prototype,"game.PWFreeMatchInfoVO");var a=(r.prototype.updateData=function(e){this.rank=e.rank,this.chalCount=e.chalCount,this.buyChalCount=e.buyChalCount,this.hRank=e.hRank,this.targeted=e.targeted,this.inMatch=e.inMatch},r.prototype.updateChallengeList=function(e){var t=this;this.chalList.splice(0),e.forEach(function(e){t.chalList.push(new i(e))}),this.chalList.sort(function(e,t){return e.rank-t.rank})},r);function r(e){this.targeted=[],this.chalList=[],e&&this.updateData(e)}t.PWHighMatchInfoVO=a,__reflect(a.prototype,"game.PWHighMatchInfoVO")}(game=game||{}),function(a){var i,e=(i=a.BaseVO,__extends(t,i),Object.defineProperty(t.prototype,"config",{get:function(){return this._config&&!this.isExpire||(this.isExpire=!1,this._config=a.Config.allPetConfig()[this.code]),this._config},enumerable:!0,configurable:!0}),t.prototype.update=function(e){this.uuid!=e.uuid&&(this.isExpire=!0),this.uuid=e.uuid,this.originalUuid=e.originalUuid,this.level=e.level,this.exp=e.exp,this.attr=e.attr,this.pos=e.pos,this.skillList=e.skillList,this.starLevel=e.starLevel,this.sectionLevel=e.sectionLevel,this.fightCap=e.fightCap,this.skillAttr=e.skillAttr,this.skillDetailList=JSON.parse(e.skillDetailList),this.code=e.code,this.growthNum=e.growthNum,this.qualificationList=e.qualificationList,this.birthDt=e.birthDt,this.grainNum=e.grainNum,this.lastGrainRefreshDt=e.lastGrainRefreshDt,this.elderNum=e.elderNum,this.skillCount=Object.keys(this.skillDetailList).length,this.qualificationSum=0;var t=100*this.growthNum/a.GameMVC.petPy.getMaxByType(0);for(var i in this.qualificationList){var o=this.qualificationList[i],n=a.GameMVC.petPy.getMaxByType(o.typ);t+=100*o.num/n,this.qualificationSum+=o.num}this.sortKey=t},t);function t(e){var t=i.call(this)||this;return t.sortKey=0,t.skillCount=0,t.qualificationSum=0,t.skillList=[],e&&t.update(e),t}a.PetVO=e,__reflect(e.prototype,"game.PetVO")}(game=game||{}),function(n){var e,t=(e=n.BaseVO,__extends(i,e),i);function i(){return null!==e&&e.apply(this,arguments)||this}n.RoleVO=t,__reflect(t.prototype,"game.RoleVO");var o,a=(o=n.BaseVO,__extends(r,o),r);function r(){var e=o.call(this)||this;return e.state=0,e}n.LoginStatusVO=a,__reflect(a.prototype,"game.LoginStatusVO");var s,c=(s=n.BaseVO,__extends(l,s),l.prototype.update=function(e){var t=this;egret.log("玩家数据",e),this.playerId=e.playerId,this.name=e.name;var i=this.level;if(this.level=e.level,this.exp=null==e.exp?this.exp:e.exp,this.fightCap=e.fightCap,this.createDt=e.createDt,this.avatar=e.avatar||this.avatar,this.frame=e.frame,this.camp=e.camp,this.pNum=e.pNum,this.serverName=e.serverName,this.serverId=e.serverId,this.fashionCode=e.fashionCode,this.titleCode=e.titleCode,this.horseCode=e.horseCode,this.magicalCode=e.magicalCode,e.playerMoney&&this.updateMoney(e.playerMoney),e.playerVip&&this.playerVip.update(e.playerVip),i!=this.level&&(Utils.UnlockMgr.clearCacheByType([UnlockType.Level,UnlockType.VipLevel,UnlockType.LevelAndVipLevel,UnlockType.LevelOrVipLevel,UnlockType.LevelAndServerOpenDay]),0<i)){var o=n.AppFacade.getInstance().retrieveProxy(n.FightPy.N);o.addDelayCBAfterFightExit(function(){n.AppFacade.getInstance().sendNotification(CN.PLAYER_LEVEL_UP,{oldLevel:i,newLevel:t.level}),o.queueExceExitCB()},"levelUp",5)}},l.prototype.updateMoney=function(e){var i=this;e.money.forEach(function(e,t){i.playerMoney[t+1]=e})},l.prototype.updateMoneyByTypeNum=function(e,t){this.playerMoney[e]=t},l);function l(){var e=s.call(this)||this;return e.fightCap=0,e.createDt=0,e.exp=0,e.avatar="",e.frame="",e.level=0,e.playerMoney=new Array,e.playerVip=new p,e}n.PlayerInfoVO=c,__reflect(c.prototype,"game.PlayerInfoVO");var h,p=(h=n.BaseVO,__extends(d,h),d.prototype.update=function(e){var t=this.isInited;h.prototype.update.call(this,e);var i=this.vipLevel;this.vipLevel=e.vipLevel,this.exp=e.exp,this.vipGiftGot=JSON.parse(e.vipGiftGot),this.rechargeInfo.update(e.rechargeInfo),t&&i!=e.vipLevel&&(Utils.UnlockMgr.clearCacheByType([UnlockType.VipLevel,UnlockType.LevelAndVipLevel,UnlockType.LevelOrVipLevel,UnlockType.VipLevelTask]),n.AppFacade.getInstance().sendNotification(CN.PLAYER_VIP_LEVEL_UP)),this.checkNotick()},d.prototype.checkNotick=function(){NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.VipWelfare]),NoticeManager.updateNotice(NT.ALL_ACTIVITY[EActivityType.VipGift]),NoticeManager.updateNotice(NT.VIP_GIFT)},d);function d(){var e=h.call(this)||this;return e.vipLevel=0,e.exp=0,e.vipGiftGot={},e.rechargeInfo=new g,e}n.PlayerVipVO=p,__reflect(p.prototype,"game.PlayerVipVO");var u,g=(u=n.BaseVO,__extends(f,u),f.prototype.update=function(e){this.count=e.count,this.trueRechargeTimes=e.trueRechargeTimes,this.totalMoney=e.totalMoney,this.record=JSON.parse(e.record)},f);function f(){var e=u.call(this)||this;return e.count=0,e.trueRechargeTimes=0,e.totalMoney=0,e.record={},e}n.RechargeInfo=g,__reflect(g.prototype,"game.RechargeInfo");var _,m=(_=n.BaseVO,__extends(y,_),y);function y(){var e=_.call(this)||this;return e.itemId="",e.itemSDKId="",e.itemName="",e.itemPrice=0,e.count=0,e.gold=0,e.goldEx=0,e.orderID="",e.playerName="",e.playerId=0,e.serverId="",e.serverName="",e.type=0,e.userID="",e.orderDt=0,e.isMonthCard=!1,e.code="",e.modulePayExt={},e}n.PurchaseVO=m,__reflect(m.prototype,"game.PurchaseVO")}(game=game||{}),function(e){var i,t=(i=e.BaseVO,__extends(o,i),o.prototype.update=function(e){this.code=e.code,this.color=e.color},o);function o(e){var t=i.call(this)||this;return t.code=0,t.color=0,t.update(e),t}e.CharacterInfoVO=t,__reflect(t.prototype,"game.CharacterInfoVO");var n,a=(n=e.BaseVO,__extends(r,n),r.prototype.update=function(e){this.code=e.code},r);function r(e){var t=n.call(this)||this;return t.code=0,t.update(e),t}e.PokemonSkillVO=a,__reflect(a.prototype,"game.PokemonSkillVO");var s,c=(s=e.BaseVO,__extends(l,s),l.prototype.update=function(e){this.type=e.type,this.score=e.score},l);function l(e){var t=s.call(this)||this;return t.type=0,t.score=0,t.update(e),t}e.PokemonScoreVO=c,__reflect(c.prototype,"game.PokemonScoreVO");var h,p=(h=e.BaseVO,__extends(d,h),d.prototype.update=function(e){this.uuid=e.uuid,this.id=e.id,this.code=this.id,this.level=e.level,this.exp=e.exp,this.attr=e.attr,this.pos=e.pos,this.advanceLevel=e.advanceLevel,this.foster=e.foster,this.characterInfoList=e.characterInfoList,this.pokemonSkill=e.pokemonSkill,this.isInit=e.isInit,this.evolutionLevel=e.evolutionLevel,this.scoreInfo=e.scoreInfo,this.fosterLevel=e.fosterLevel,this.fosterAttr=e.fosterAttr,this.fightCap=e.fightCap,this.breakLevel=e.breakLevel,this.advanceExp=e.advanceExp,this.breakExp=e.breakExp,this.megaLevel=e.megaLevel,this.skinId=e.skinId},d);function d(e){var t=h.call(this)||this;return t.id=0,t.code=0,t.level=0,t.exp=0,t.pos=0,t.advanceLevel=0,t.characterInfoList=new Array,t.pokemonSkill=new Array,t.scoreInfo=new Array,t.update(e),t}e.PokemonVO=p,__reflect(p.prototype,"game.PokemonVO");var u,g=(u=e.BaseVO,__extends(f,u),f.prototype.update=function(e){this.uuid=e.uuid,this.pkmUuid=e.pkmUuid,this.code=e.code,this.level=e.level,this.refine=e.refine,this.exp=e.exp,this.attr=e.attr},f);function f(e){var t=u.call(this)||this;return t.pkmUuid="",t.code=0,t.level=0,t.refine=0,t.exp=0,t.update(e),t}e.ToteVO=g,__reflect(g.prototype,"game.ToteVO")}(game=game||{}),function(t){var i,o=(i=t.BaseVO,__extends(e,i),e.prototype.update=function(e){this.x=e.x,this.y=e.y},e);function e(e){var t=i.call(this)||this;return e&&t.update(e),t}t.SPos=o,__reflect(o.prototype,"game.SPos");var n,a=(n=t.BaseVO,__extends(r,n),r.prototype.update=function(e){this.creepCode=e.creepCode,this.pos.update(e.pos),this.status=e.status,this.remove=e.remove||!1},r);function r(e){var t=n.call(this)||this;return t.pos=new o,t.remove=!1,e&&t.update(e),t}t.SCreepBase=a,__reflect(a.prototype,"game.SCreepBase");var s,c=(s=t.BaseVO,__extends(l,s),l.prototype.update=function(e){this.playerId=e.playerId,this.pos.update(e.pos),this.status=e.status,this.layerCode=e.layerCode,this.name=e.name,this.serverId=e.serverId,this.fashionCode=e.fashionCode,this.horseCode=e.horseCode,this.titleCode=e.titleCode,this.magicalCode=e.magicalCode,this.isSelf=t.GameMVC.loginPy.isSelf(e.playerId)},l);function l(e){var t=s.call(this)||this;return t.pos=new o,t.isSelf=!1,e&&t.update(e),t}t.SPlayerBase=c,__reflect(c.prototype,"game.SPlayerBase");var h,p=(h=t.BaseVO,__extends(d,h),d.prototype.update=function(e){this.rewardId=e.rewardId,this.dt=e.dt},d);function d(e){var t=h.call(this)||this;return e&&t.update(e),t}t.Targeted=p,__reflect(p.prototype,"game.Targeted");var u,g=(u=t.BaseVO,__extends(f,u),f.prototype.update=function(e){this.playerId=e.playerId,this.pos.update(e.pos),this.status=e.status,this.hangUpIncome=e.hangUpIncome,this.layerCode=e.layerCode,this.name=e.name,this.serverId=e.serverId,this.hangUpIncomeDuration=e.hangUpIncomeDuration,this.doubleHit=e.doubleHit||0,this.targeted=e.targeted,this.score=e.score,this.lBattleDt=e.lBattleDt},f);function f(e){var t=u.call(this)||this;return t.pos=new o,t.hangUpIncome=new Array,t.targeted=new Array,e&&t.update(e),t}t.SPlayer=g,__reflect(g.prototype,"game.SPlayer");var _,m=(_=t.BaseVO,__extends(y,_),y.prototype.update=function(e){this.layerCode=e.layerCode,this.updateCreeps(e.creeps),this.updatePlayers(e.players)},y.prototype.updateCreeps=function(e){if(this.creeps.splice(0),e)for(var t=0,i=e;t<i.length;t++){var o=i[t];this.creeps.push(new a(o))}},y.prototype.updatePlayers=function(e){if(this.players.splice(0),e)for(var t=0,i=e;t<i.length;t++){var o=i[t];this.players.push(new c(o))}},y);function y(e){var t=_.call(this)||this;return t.creeps=new Array,t.players=new Array,e&&t.update(e),t}t.SLayer=m,__reflect(m.prototype,"game.SLayer");var v,T=(v=t.BaseVO,__extends(C,v),C.prototype.update=function(e){this.champion=e.champion},C);function C(e){var t=v.call(this)||this;return t.champion=new c,e&&t.update(e),t}t.SWar=T,__reflect(T.prototype,"game.SWar")}(game=game||{}),function(i){var o,n=(o=i.BaseVO,__extends(t,o),t.prototype.update=function(e){this.baseInfo.update(e),this.isLeader=e.isLeader},t.makeFakeData=function(){var e=new t;return e.baseInfo=i.BaseInfoVO.makeFakeData(),e.isLeader=!1,e.index=0,e},t);function t(e){var t=o.call(this)||this;return t.baseInfo=new i.BaseInfoVO,e&&t.update(e),t}i.TeamMemberVO=n,__reflect(n.prototype,"game.TeamMemberVO");var a,e=(a=i.BaseVO,__extends(r,a),r.prototype.update=function(e){var i=this;this.members.splice(0),e?(this.id=e.id,this.name=e.name,this.leader=e.leader,this.serverName=e.serverName,this.serverId=e.serverId,this.avatar=e.avatar,this.level=e.level,this.fightCap=0,Array.isArray(e.members)&&e.members.forEach(function(e,t){i.fightCap+=e.baseInfo.fightCap,e.index=t,i.leader==e.baseInfo.playerId&&(e.baseInfo.isLeader=!0,i.leaderVO=e),i.members.push(new n(e.baseInfo))})):this.id=void 0},r.prototype.reset=function(){this.id=void 0,this.members.splice(0)},r.makeFakeData=function(e){var t=new r;e=e||3;for(var i=0;i<e;i++){var o=n.makeFakeData();o.index=i,o.isLeader=0==o.index,t.members.push(o)}return t.leaderVO=t.members[0],t.leader=t.leaderVO.baseInfo.playerId,t.serverId=Utils.DebugUtils.getFakeServerId(),t.avatar=t.leaderVO.baseInfo.avatar,t.level=t.leaderVO.baseInfo.level,t.fightCap=0,t.name=t.leaderVO.baseInfo.name,t.members.forEach(function(e){t.fightCap+=e.baseInfo.fightCap}),t},r);function r(e){var t=a.call(this)||this;return t.otherInfo={},t.members=new Array,t.fightCap=0,e&&t.update(e),t}i.TeamVO=e,__reflect(e.prototype,"game.TeamVO");var s,c=(s=i.BaseVO,__extends(l,s),l.prototype.update=function(e){this.dt=e.dt,this.member.update(e.member&&e.member.baseInfo)},l);function l(e){var t=s.call(this)||this;return t.member=new n,e&&t.update(e),t}i.ApplyRecordVO=c,__reflect(c.prototype,"game.ApplyRecordVO");var h,p=(h=i.BaseVO,__extends(d,h),d.prototype.update=function(e){this.uuid=e.uuid,this.battlePos=e.battlePos},d);function d(e){var t=h.call(this)||this;return e&&t.update(e),t}i.SHeroPosition=p,__reflect(p.prototype,"game.SHeroPosition");var u,g=(u=i.BaseVO,__extends(f,u),f.prototype.update=function(e){var i=this;this.teamNo=e.teamNo,this.heros.splice(0),Array.isArray(e.heros)&&e.heros.forEach(function(e,t){i.heros.push(new p(e))})},f);function f(e){var t=u.call(this)||this;return t.heros=new Array,e&&t.update(e),t}i.SHeroTeam=g,__reflect(g.prototype,"game.SHeroTeam");var _,m=(_=i.BaseVO,__extends(y,_),y.prototype.update=function(e){var i=this;this.teamNo=e.teamNo,this.petUuid=e.petUuid,this.magicalUuid=e.magicalUuid,this.heros.splice(0),Array.isArray(e.heros)&&e.heros.forEach(function(e,t){i.heros.push(new p(e))})},y);function y(e){var t=_.call(this)||this;return t.heros=new Array,e&&t.update(e),t}i.PlayerMultiTeamVO=m,__reflect(m.prototype,"game.PlayerMultiTeamVO");var v,T=(v=i.BaseVO,__extends(C,v),C.prototype.update=function(e){var i=this;this.type=e.type,this.teams.splice(0),Array.isArray(e.teams)&&e.teams.forEach(function(e,t){i.teams.push(new m(e))})},C);function C(e){var t=v.call(this)||this;return t.teams=new Array,e&&t.update(e),t}i.SModuleTeam=T,__reflect(T.prototype,"game.SModuleTeam")}(game=game||{}),function(n){var i=(Object.defineProperty(e.prototype,"challengeTimes",{get:function(){return Number(n.Config.constConfig().TribeBattleInitChallengeTime.constValue)+this.hasPurchasedTime-this.hasChallengedTime+this.refreshTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"revengeTimes",{get:function(){return Number(n.Config.constConfig().TribeBattleInitRevengeTime.constValue)+n.GameMVC.tribeBattlePy.battleInfo.playerInfo.hasPurchasedRevengeTime-n.GameMVC.tribeBattlePy.battleInfo.playerInfo.hasRevengedTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lootGoods",{get:function(){var e=Number(n.Config.constConfig().TribeBattleChallengeGoodsReduceRatio.constValue),t=Number(n.Config.constConfig().TribeBattleMaxRatioReduceTime.constValue),i=Number(n.Config.constConfig().TribeBattleChallengeFixedGoods.constValue);return Math.floor((this.holdGoods+this.fixedGoods)*Math.max(e-this.beChallengedTime,t)/100)+i},enumerable:!0,configurable:!0}),e.prototype.update=function(e){this.baseInfo.update(e.baseInfo),this.fixedGoods=e.fixedGoods,this.holdGoods=e.holdGoods,this.hasChallengedTime=e.hasChallengedTime,this.hasPurchasedTime=e.hasPurchasedTime,this.lastChallengeRefreshDt=e.lastChallengeRefreshDt,this.hasRevengedTime=e.hasRevengedTime,this.hasPurchasedRevengeTime=e.hasPurchasedRevengeTime,this.targeted=e.targeted,this.guildGoods=e.guildGoods,this.refreshTime=e.refreshTime,this.playerMaxGoods=e.playerMaxGoods,this.guildMaxGoods=e.guildMaxGoods,this.beChallengedTime=e.beChallengedTime,this.lastBeLootedDt=e.lastBeLootedDt},e);function e(e){this.baseInfo=new n.PlayerInfoVO,this.targeted=[],e&&this.update(e)}n.TBPlayerEntityVO=i,__reflect(i.prototype,"game.TBPlayerEntityVO");var a=(Object.defineProperty(t.prototype,"maxPlayerlootGoods",{get:function(){var e=Number(n.Config.constConfig().TribeBattleChallengeGoodsReduceRatio.constValue),t=Number(n.Config.constConfig().TribeBattleMaxRatioReduceTime.constValue),i=Number(n.Config.constConfig().TribeBattleChallengeFixedGoods.constValue);return Math.floor(this.maxPlayerGoods*Math.max(e-this.maxGoodsPlayerBeChallengedTime,t)/100)+i},enumerable:!0,configurable:!0}),t.prototype.update=function(e){var t=this;this.baseInfo.update(e.baseInfo),this.totalGoods=e.totalGoods,this.maxPlayerGoods=e.maxPlayerGoods,this.maxGoodsPlayerBeChallengedTime=e.maxGoodsPlayerBeChallengedTime,this.playerList.splice(0),e.playerEntityList.forEach(function(e){t.playerList.push(new i(e))})},t);function t(e){this.baseInfo=new n.GuildVO,this.playerList=[],e&&this.update(e)}n.TBGuildEntityVO=a,__reflect(a.prototype,"game.TBGuildEntityVO");var o=(r.prototype.updateData=function(e){this.playerInfo.update(e.playerEntityInfo),this.beLootedGoods=e.beLootedGoods},r);function r(e){this.playerInfo=new i,e&&this.updateData(e)}n.TBBattleRecordVO=o,__reflect(o.prototype,"game.TBBattleRecordVO");var s=(c.prototype.update=function(e){this.updatePlayer(e.playerEntityInfo),this.updateGuildList(e.guildEntityList)},c.prototype.updatePlayer=function(e){this.playerInfo.update(e)},c.prototype.updateGuildList=function(t){var i=this;if(Array.isArray(t)){this.guildList.splice(0);var o=n.GameMVC.guildPy.guildDetail.guildId;t.forEach(function(e){e.baseInfo.id===o?i.guildInfo.update(e):i.guildList.push(new a(e))})}else this.guildList.forEach(function(e){e.baseInfo.id===t.baseInfo.id&&e.update(t)})},c);function c(){this.playerInfo=new i,this.guildInfo=new a,this.guildList=[]}n.TBInfoVO=s,__reflect(s.prototype,"game.TBInfoVO")}(game=game||{}),function(t){var i,e=(i=t.BaseVO,__extends(o,i),o.prototype.update=function(e){this.uuid=e.uuid,this.code=e.code,this.dt=e.dt},o);function o(e){var t=i.call(this)||this;return e&&t.update(e),t}t.BarrageInfoVO=e,__reflect(e.prototype,"game.BarrageInfoVO");var n,a=(n=t.BaseVO,__extends(r,n),r.prototype.update=function(e){this.attackUuid=e.attackUuid,this.defenceUuid=e.defenceUuid,this.win=e.win,this.round=e.round,this.attackNum=e.attackNum,this.defenceNum=e.defenceNum},r);function r(e){var t=n.call(this)||this;return e&&t.update(e),t}t.BattleDetailInfoVO=a,__reflect(a.prototype,"game.BattleDetailInfoVO");var s,c=(s=t.BaseVO,__extends(l,s),l.prototype.update=function(e){this.pos=e.pos,this.code=e.code},l);function l(e){var t=s.call(this)||this;return e&&t.update(e),t}t.SWchessCardVO=c,__reflect(c.prototype,"game.SWchessCardVO");var h,p=(h=t.BaseVO,__extends(d,h),d.prototype.isInFormation=function(){return this.pos<=ZZQ_CONST.SHANGZHEN_NUM},Object.defineProperty(d.prototype,"config",{get:function(){return t.Config.chessHero()[this.code]},enumerable:!0,configurable:!0}),d.prototype.update=function(e){this.uuid=e.uuid,this.code=e.code,this.attr=e.attr,this.pos=e.pos,this.starLevel=e.starLevel,this.skillList=e.skillList,this.fightCap=e.fightCap},d);function d(e){var t=h.call(this)||this;return t.voType="chess",e&&t.update(e),t}t.SWchessHeroVO=p,__reflect(p.prototype,"game.SWchessHeroVO");var u,g=(u=t.BaseVO,__extends(f,u),f.prototype.update=function(e){this.uuid=e.uuid,this.dt=e.dt,this.attackUuid=e.attackUuid,this.defenceUuid=e.defenceUuid,this.win=e.win},f);function f(e){var t=u.call(this)||this;return e&&t.update(e),t}t.BattleRecordInfoVO=g,__reflect(g.prototype,"game.BattleRecordInfoVO");var _,m=(_=t.BaseVO,__extends(y,_),y.prototype.update=function(e){this.name=e.name,this.level=e.level,this.avatar=e.avatar,this.life=e.life,this.exp=e.exp,this.gold=e.gold,this.uuid=e.uuid,this.dt=e.dt,this.isAutoRefresh=e.isAutoRefresh,this.winLoseStreak=e.winLoseStreak,this.stationList=e.stationList,this.winNum=e.winNum,this.loseNum=e.loseNum,this.killNum=e.killNum,this.grade=e.grade,this.hGrade=e.hGrade,this.starLevelTargeted=e.starLevelTargeted,this.maxRank=e.maxRank,1e3<=this.life&&(this.life=-this.life%1e3),t.BaseVO.updateArr(e.battleRecordList,this.battleRecordList,g)},y);function y(e){var t=_.call(this)||this;return t.battleRecordList=new Array,e&&t.update(e),t}t.SWchessPlayerVO=m,__reflect(m.prototype,"game.SWchessPlayerVO");var v,T=(v=t.BaseVO,__extends(C,v),C.prototype.update=function(e){this.id=e.id,this.status=e.status,this.dt=e.dt,this.leader=e.leader,this.uuid=e.uuid,this.sysDt=e.sysDt,this.opponentList=e.opponentList,this.endDt=e.endDt,t.BaseVO.updateArr(e.players,this.players,m)},C);function C(e){var t=v.call(this)||this;return t.players=new Array,e&&t.update(e),t}t.SWchessRoomVO=T,__reflect(T.prototype,"game.SWchessRoomVO")}(game=game||{}),window.Main=Main;;
var classExport=function(){window.BaseMediator=BaseMediator;window.BaseClass=BaseClass;window.BaseView=BaseView;window.SDKMgr=SDKMgr;window.BaseFull=BaseFull;window.BasePanel=BasePanel;window.BaseTab=BaseTab;window.UTFMsg=UTFMsg;window.ModuleStyle=ModuleStyle;window.NT=NT;window.WebMgr=WebMgr;window.BaseProxy=BaseProxy;window.ByteArrayMsg=ByteArrayMsg;window.AssetAdapter=AssetAdapter;window.AssetsMgr=AssetsMgr;window.CacheMgr=CacheMgr;window.FrameUpdateItem=FrameUpdateItem;window.FrameUpdateMgr=FrameUpdateMgr;window.MicMgr=MicMgr;window.ObjectPoolMgr=ObjectPoolMgr;window.SoundManager=SoundManager;window.ThemeAdapter=ThemeAdapter;window.TimerManager=TimerManager;window.TimerHandler=TimerHandler;window.WeeklySchedule=WeeklySchedule;window.UnlockMgr=UnlockMgr;window.WebMgrQQZone=WebMgrQQZone;window.WebMgrXYX=WebMgrXYX;window.DynamicChange=DynamicChange;window.ProxyUpdate=ProxyUpdate;window.Http=Http;window.ByteArrayMsgByJSProtobuf=ByteArrayMsgByJSProtobuf;window.ByteArrayMsgByProtobuf=ByteArrayMsgByProtobuf;window.Socket=Socket;window.SocketConst=SocketConst;window.UTFMsgByJson=UTFMsgByJson;window.AnchorUtil=AnchorUtil;window.ArrayUtil=ArrayUtil;window.Base64Util=Base64Util;window.ComponentUtils=ComponentUtils;window.DebugUtils=DebugUtils;window.DeviceUtils=DeviceUtils;window.DragonBoneTools=DragonBoneTools;window.EgretExpandUtils=EgretExpandUtils;window.FlowUtils=FlowUtils;window.GlobalEventManager=GlobalEventManager;window.HookUtils=HookUtils;window.LocalStorageUtil=LocalStorageUtil;window.MathUtils=MathUtils;window.Vector2D=Vector2D;window.MCAnimation=MCAnimation;window.BaseMC=BaseMC;window.MovieClipTools=MovieClipTools;window.GuideChatItem=GuideChatItem;window.MsgUtils=MsgUtils;window.ResourceUtils=ResourceUtils;window.ResVersionManager=ResVersionManager;window.ShakeUtils=ShakeUtils;window.TouchUtils=TouchUtils;window.Utils=Utils;window.EasyLoadingUI=EasyLoadingUI;window.Main=Main;window.TestScreenAdapter=TestScreenAdapter;window.GameRootLayer=GameRootLayer;window.CN=CN;window.UIActionManager=UIActionManager;window.NoticeManager=NoticeManager;window.PopUpManager=PopUpManager;window.FIGHT_CONST=FIGHT_CONST;}();;
var ClientEnumExport=function(){window.GuideConditionType=GuideConditionType;window.GuideConditionSubType=GuideConditionSubType;window.GuideOperationType=GuideOperationType;window.TaskStatus=TaskStatus;window.AttrConfig=AttrConfig;window.ChessAttrConfig=ChessAttrConfig;window.ProfessionConfig=ProfessionConfig;window.SubProfessionConfig=SubProfessionConfig;window.GachaTypeInfo=GachaTypeInfo;window.HeroRaceConfig=HeroRaceConfig;window.COMPONENT_ENUM=COMPONENT_ENUM;window.NUM_TO_ROMAN_NUM=NUM_TO_ROMAN_NUM;window.SKILL_CODE=SKILL_CODE;window.DAILY_COPY_DIFFICULT_ICON=DAILY_COPY_DIFFICULT_ICON;window.CommonIconStyle=CommonIconStyle;window.DefaultValue=DefaultValue;window.COLOR_2_FRAME=COLOR_2_FRAME;window.SPRITE_COLOR_2_FRAME=SPRITE_COLOR_2_FRAME;window.COLOR_2_FONT_COLOR=COLOR_2_FONT_COLOR;window.COLOR_CONFIG=COLOR_CONFIG;window.MAIL_STATUS_ICON=MAIL_STATUS_ICON;window.SEX_HEAD=SEX_HEAD;window.EQUIP_COLOR_NAME_IMG=EQUIP_COLOR_NAME_IMG;window.EQUIP_PART_ICON=EQUIP_PART_ICON;window.CHAMPION_GROUP_RES=CHAMPION_GROUP_RES;window.EXPLORED_BUILDING_RES=EXPLORED_BUILDING_RES;window.EXPLORED_BACKGROUND_RES=EXPLORED_BACKGROUND_RES;window.GUIDE_QIANQI_END_LEVEL=GUIDE_QIANQI_END_LEVEL;window.MAP_GUIDE_START_CODE=MAP_GUIDE_START_CODE;window.MAP_GUIDE_END_CODE=MAP_GUIDE_END_CODE;window.GUIDE_WELCOME_CONTENT=GUIDE_WELCOME_CONTENT;window.GUIDE_EVO_AFTER_CATCH=GUIDE_EVO_AFTER_CATCH;window.GUIDE_SPECIAL_DISMISS_WHEN_WAIT_STEP=GUIDE_SPECIAL_DISMISS_WHEN_WAIT_STEP;window.GUIDE_SPECIAL_FLOW=GUIDE_SPECIAL_FLOW;window.GUIDE_ILLUSTRATE=GUIDE_ILLUSTRATE;window.GUILD_AVATAR_RES=GUILD_AVATAR_RES;window.GUILD_POSITION_NAME=GUILD_POSITION_NAME;window.MID_EFFECT_RES=MID_EFFECT_RES;window.MID_EFFECT_RES_SECOND=MID_EFFECT_RES_SECOND;window.HARM_TIPS_RES=HARM_TIPS_RES;window.HARM_TIPS_TEXT=HARM_TIPS_TEXT;window.BOSS_POS_CONFIG=BOSS_POS_CONFIG;window.CHAT_RANDOM_CONTENT=CHAT_RANDOM_CONTENT;window.ECharactorType=ECharactorType;window.BADGE_LOCATION_ENUM=BADGE_LOCATION_ENUM;window.GUILD_POST_INFO=GUILD_POST_INFO;window.UNIQUE_REQ=UNIQUE_REQ;window.LOADING_TIPS=LOADING_TIPS;window.ACTIVITY_ENTRANCE=ACTIVITY_ENTRANCE;window.GOAL_REWARD_DESC=GOAL_REWARD_DESC;window.REWARD_STATUS=REWARD_STATUS;window.COMMON_DIRECTION=COMMON_DIRECTION;window.SOUND_EFF_TYPE=SOUND_EFF_TYPE;window.SOUND_BGM_TYPE=SOUND_BGM_TYPE;window.ACTIVITY_COMMON_UI_STYLE=ACTIVITY_COMMON_UI_STYLE;window.BADGE_STATUS=BADGE_STATUS;window.SHOP_NOT_ALLOW_TIPS=SHOP_NOT_ALLOW_TIPS;window.HATCH_COLOR_PIC=HATCH_COLOR_PIC;window.CHANGE_ARRAY_TYPE=CHANGE_ARRAY_TYPE;window.ACTIVITY_TO_MODULE=ACTIVITY_TO_MODULE;window.MULTI_CAMP_TO_COLOR=MULTI_CAMP_TO_COLOR;window.MULTI_CAMP_TO_NAME=MULTI_CAMP_TO_NAME;window.MULTI_CAMP_TO_SOURCE=MULTI_CAMP_TO_SOURCE;window.GUILD_NOTICE_LIMIT=GUILD_NOTICE_LIMIT;window.EQUIPTYPE_TO_NAME=EQUIPTYPE_TO_NAME;window.MODEL_ACTION_NAME=MODEL_ACTION_NAME;window.ROLE_ACTION_NAME=ROLE_ACTION_NAME;window.ROLE_ACTION_NAME_WHILE_H=ROLE_ACTION_NAME_WHILE_H;window.ROLE_STYLE=ROLE_STYLE;window.DETAIL_VIEW_SHOW_TYPE=DETAIL_VIEW_SHOW_TYPE;window.HEROTHING_ATTR_STYLE=HEROTHING_ATTR_STYLE;window.TREASURE_ICON_NAME=TREASURE_ICON_NAME;window.TEAMEXPEMAP_POS=TEAMEXPEMAP_POS;window.MAP_EP_TYPE_NAME=MAP_EP_TYPE_NAME;window.MAP_EP_TYPE_IMG_MNM=MAP_EP_TYPE_IMG_MNM;window.MAP_EP_GATE_IMG=MAP_EP_GATE_IMG;window.BASEITEM_SOURCE=BASEITEM_SOURCE;window.PROPERTY_2_KEY=PROPERTY_2_KEY;window.HERO_SORT_ORDER=HERO_SORT_ORDER;window.BTN_ICON_NOTICE_POS=BTN_ICON_NOTICE_POS;window.DB_SKIP_CACHE_FRAME=DB_SKIP_CACHE_FRAME;window.FadeRiskEventType=FadeRiskEventType;window.SHARE_RESOURCE_FILTER=SHARE_RESOURCE_FILTER;window.ZZQ_CONST=ZZQ_CONST;window.DEEP_NEST_CONST=DEEP_NEST_CONST;window.MULTI_TEAM_MODULE_NAME=MULTI_TEAM_MODULE_NAME;window.G_REWARD_NAME=G_REWARD_NAME;window.ENTITY_2_NAME=ENTITY_2_NAME;window.HERO_TIER_IMG_TAG=HERO_TIER_IMG_TAG;window.PEAK_WAR_TYPE=PEAK_WAR_TYPE;window.HOLDER_CONST=HOLDER_CONST;}();;
var EnumExport=function(){window.EPropertyType=EPropertyType;window.EExpType=EExpType;window.EPropType=EPropType;window.EVictoryPropType=EVictoryPropType;window.EGemType=EGemType;window.EEntityType=EEntityType;window.BattleEntityType=BattleEntityType;window.EColorType=EColorType;window.EAttrType=EAttrType;window.ESAttrType=ESAttrType;window.EBuffType=EBuffType;window.PropAttr=PropAttr;window.EConditionType=EConditionType;window.EBuffOverlayType=EBuffOverlayType;window.EBuffActionType=EBuffActionType;window.EEffectStatus=EEffectStatus;window.EBuffDispelType=EBuffDispelType;window.EBuffGainType=EBuffGainType;window.ETargetType=ETargetType;window.EHurtTargetType=EHurtTargetType;window.ESkillType=ESkillType;window.ESkillActionType=ESkillActionType;window.EBattleSide=EBattleSide;window.PositionType=PositionType;window.BattleNumberSource=BattleNumberSource;window.EHurtUp=EHurtUp;window.EHurtAddition=EHurtAddition;window.EFreeDeadType=EFreeDeadType;window.EComboType=EComboType;window.EEquipPartType=EEquipPartType;window.EBattleResult=EBattleResult;window.EEnergyRecovery=EEnergyRecovery;window.EBattleType=EBattleType;window.EMailStatus=EMailStatus;window.EMailType=EMailType;window.EMailValueType=EMailValueType;window.EChatStatus=EChatStatus;window.EChatChannelType=EChatChannelType;window.EChatSendCheckType=EChatSendCheckType;window.EChatJumpType=EChatJumpType;window.EFriendType=EFriendType;window.FriendRewardGiveType=FriendRewardGiveType;window.EGuildPositionType=EGuildPositionType;window.EGuildQuitType=EGuildQuitType;window.EGuildUpdateType=EGuildUpdateType;window.EGuildOperationType=EGuildOperationType;window.ESexType=ESexType;window.ShopType=ShopType;window.ShopWorkType=ShopWorkType;window.ShopItemUnlockType=ShopItemUnlockType;window.ShopBuyLimitType=ShopBuyLimitType;window.VictoryEventType=VictoryEventType;window.VictoryBuffType=VictoryBuffType;window.MODULE=MODULE;window.RankingType=RankingType;window.RankingSubType=RankingSubType;window.RobotType=RobotType;window.TaskTarget=TaskTarget;window.TaskType=TaskType;window.TaskSubType=TaskSubType;window.TaskUpdateType=TaskUpdateType;window.TaskResetType=TaskResetType;window.GuideActionType=GuideActionType;window.GuideDir=GuideDir;window.RoleMapDir=RoleMapDir;window.ActivityStartType=ActivityStartType;window.ActivityOper=ActivityOper;window.EActivityType=EActivityType;window.ActivityPushType=ActivityPushType;window.ETargetActivityType=ETargetActivityType;window.ModuleGoalType=ModuleGoalType;window.EChampionRedPointType=EChampionRedPointType;window.GuildBountyStatus=GuildBountyStatus;window.CollectPokemonActivityCollectType=CollectPokemonActivityCollectType;window.BroadcastType=BroadcastType;window.FriendGoodType=FriendGoodType;window.FriendGoodOperationType=FriendGoodOperationType;window.PlayerOnlineState=PlayerOnlineState;window.RelationType=RelationType;window.SyncOperationType=SyncOperationType;window.RelationRewardRequireType=RelationRewardRequireType;window.RewardSendType=RewardSendType;window.OperationType=OperationType;window.DailyRechargeLevel=DailyRechargeLevel;window.ChatMsgSourceType=ChatMsgSourceType;window.ManorType=ManorType;window.ManorCancelType=ManorCancelType;window.ManorBattleRecordType=ManorBattleRecordType;window.ManorQualityType=ManorQualityType;window.ManorMapType=ManorMapType;window.ManorRewardType=ManorRewardType;window.RechargeType=RechargeType;window.LuckyMoneyStatus=LuckyMoneyStatus;window.PushRewardSource=PushRewardSource;window.AdvancedRotateRewardType=AdvancedRotateRewardType;window.SystemMessageShow=SystemMessageShow;window.SystemMessageTrigger=SystemMessageTrigger;window.UnlockType=UnlockType;window.QuoraResult=QuoraResult;window.QuoraStatus=QuoraStatus;window.EFightCapChangeSource=EFightCapChangeSource;window.UseTaskUnlockType=UseTaskUnlockType;window.WeChatTargetType=WeChatTargetType;window.HeroProfessionType=HeroProfessionType;window.HeroProfessionSubType=HeroProfessionSubType;window.HeroRaceType=HeroRaceType;window.HeroUpStarCostType=HeroUpStarCostType;window.HeroArtifactUpStarCostType=HeroArtifactUpStarCostType;window.HeroEquipKind=HeroEquipKind;window.HeroEquipType=HeroEquipType;window.HeroEquipColor=HeroEquipColor;window.HeroArtifactCostType=HeroArtifactCostType;window.HeroArtifactType=HeroArtifactType;window.GashaponType=GashaponType;window.GashaponSubType=GashaponSubType;window.TreasureJewelType=TreasureJewelType;window.TeamExpeditionType=TeamExpeditionType;window.WorldKingRewardType=WorldKingRewardType;window.ServerBossRewardType=ServerBossRewardType;window.ChallengeEventType=ChallengeEventType;window.ChallengeEffectType=ChallengeEffectType;window.RiskDifficultyType=RiskDifficultyType;window.RiskEventType=RiskEventType;window.RiskTrigger2Type=RiskTrigger2Type;window.FingerGameType=FingerGameType;window.GuessSizeType=GuessSizeType;window.RiskShopType=RiskShopType;window.GateType=GateType;window.RiskDataType=RiskDataType;window.RiskNodeType=RiskNodeType;window.RiskTaskStatus=RiskTaskStatus;window.GuildWarStatus=GuildWarStatus;window.TeamArenaStatus=TeamArenaStatus;window.TeamArenaTeamStatus=TeamArenaTeamStatus;window.TriggerGiftsTriggerType=TriggerGiftsTriggerType;window.RiskMineType=RiskMineType;window.EItemUseType=EItemUseType;window.CommentType=CommentType;window.HeroChallengeModel=HeroChallengeModel;window.HeroHaloType=HeroHaloType;window.HaloType=HaloType;window.EWchessRoomStatus=EWchessRoomStatus;window.HeroEquipDecomposeType=HeroEquipDecomposeType;window.EHaleAttrType=EHaleAttrType;window.ZoneAuctionInfoPType=ZoneAuctionInfoPType;window.AuctionItemStatus=AuctionItemStatus;window.ZoneAuctionRewardPType=ZoneAuctionRewardPType;window.HeroEquipCompoundType=HeroEquipCompoundType;window.EZoneBossStatusType=EZoneBossStatusType;window.EZoneBossTaskType=EZoneBossTaskType;window.EChessAchieveType=EChessAchieveType;window.EGiftType=EGiftType;window.ChatFilterResult=ChatFilterResult;window.ManorPlayerCoordinateChangeType=ManorPlayerCoordinateChangeType;window.ManorRewardShowType=ManorRewardShowType;window.ERaceTowerType=ERaceTowerType;window.ERoleKeepType=ERoleKeepType;window.HeroEquipMasterType=HeroEquipMasterType;window.FishingActivityOper=FishingActivityOper;window.VestagePointStatus=VestagePointStatus;window.VestageEventType=VestageEventType;window.VestageCreepType=VestageCreepType;window.VestagePropType=VestagePropType;window.VestageItemUseType=VestageItemUseType;window.VestageChoiceType=VestageChoiceType;window.VestageResultSubType=VestageResultSubType;window.VestageProcessType=VestageProcessType;window.StormWarPlayerStatus=StormWarPlayerStatus;window.WishTreeOper=WishTreeOper;window.MagpieEventType=MagpieEventType;window.MagpiePointStatus=MagpiePointStatus;window.MagpieActivityOper=MagpieActivityOper;window.MagpieAchieveType=MagpieAchieveType;window.TribeBattleAchieveType=TribeBattleAchieveType;window.SkillEffectType=SkillEffectType;window.FashionMasterType=FashionMasterType;window.RoleSkillUnlockType=RoleSkillUnlockType;window.NationalAchieveType=NationalAchieveType;window.SkillStealType=SkillStealType;window.TopFarmBuild=TopFarmBuild;window.TopFarmWork=TopFarmWork;window.TopFarmResearchSkillUnlockType=TopFarmResearchSkillUnlockType;window.DoubleElevenPlace=DoubleElevenPlace;window.ImmortalBaptizeAttrType=ImmortalBaptizeAttrType;window.ImmortalMarketSortType=ImmortalMarketSortType;window.HeroEquipImproveType=HeroEquipImproveType;window.MemAndDbExpeditionType=MemAndDbExpeditionType;window.ECardGameStatus=ECardGameStatus;window.PetUpGradeType=PetUpGradeType;window.CourtshipStatusType=CourtshipStatusType;window.FriendLootType=FriendLootType;window.FlowerEvents=FlowerEvents;}();